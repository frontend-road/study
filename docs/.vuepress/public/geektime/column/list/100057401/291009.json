{"id":291009,"title":"22ï½œRUMçŒœæƒ³ï¼šæƒ³è¦è¯»å†™å¿«è¿˜æ˜¯å­˜å‚¨çœï¼Ÿåˆæ˜¯ä¸‰é€‰äºŒ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç‹ç£Šã€‚</p><p>ä»ç¬¬18è®²ï¼Œæˆ‘ä»¬å¼€å§‹ä»‹ç»æŸ¥è¯¢è¿‡ç¨‹ä¸­å…¨éƒ¨é‡è¦èŠ‚ç‚¹çš„ç›¸å…³æŠ€æœ¯ï¼Œä»å¹¶è¡Œæ¡†æ¶åˆ°æŸ¥è¯¢æ‰§è¡Œå¼•æ“ï¼Œå†ä»å…³è”è¿ç®—ç¬¦åˆ°è¡Œå¼å’Œåˆ—å¼å­˜å‚¨ã€‚ä»Šå¤©è¿™ä¸€è®²æˆ‘ä»¬é¢ä¸´æœ€åçš„ä¸€ä¸ªæ­¥éª¤ï¼Œç›´æ¥å’Œç£ç›˜æ‰“äº¤é“ï¼Œå®ç°æœ€ç»ˆçš„æ•°æ®å­˜å‚¨ï¼Œè¿™å°±æ˜¯å­˜å‚¨å¼•æ“ã€‚</p><h2>RUMçŒœæƒ³</h2><p>è¯´åˆ°æ•°æ®å­˜å‚¨ï¼Œæˆ‘ç›¸ä¿¡å¾ˆå¤šäººéƒ½æœ‰ä¸€ç§ç›´è§‰ï¼Œé‚£å°±æ˜¯è¯»å†™ä¸¤ç§æ“ä½œçš„ä¼˜åŒ–åœ¨å¾ˆå¤šæ—¶å€™æ˜¯äº’æ–¥çš„ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æƒ³ä¸€ä¸‹ï¼Œæ•°æ®ä»¥ä»€ä¹ˆå½¢å¼å­˜å‚¨ï¼Œå¯ä»¥å®ç°æœ€å¿«çš„å†™å…¥é€Ÿåº¦ï¼Ÿç­”æ¡ˆè‚¯å®šæ˜¯æŒ‰ç…§é¡ºåºå†™å…¥ï¼Œæ¯æ¬¡æ–°å¢æ•°æ®éƒ½è¿½åŠ åœ¨æ–‡ä»¶å°¾éƒ¨ï¼Œå› ä¸ºè¿™æ ·ç‰©ç†ç£ç›˜çš„ç£å¤´ç§»åŠ¨è·ç¦»æœ€å°ã€‚</p><p>ä½†è¿™ç§æ–¹å¼å¯¹äºè¯»å–æ˜¾ç„¶æ˜¯ä¸å‹å¥½çš„ï¼Œå› ä¸ºæ²¡æœ‰ä»»ä½•æœ‰æ„ä¹‰çš„æ•°æ®ç»“æ„åšè¾…åŠ©ï¼Œè¯»æ“ä½œå¿…é¡»ä»å¤´åˆ°å°¾æ‰«ææ–‡ä»¶ã€‚åè¿‡æ¥ï¼Œå¦‚æœè¦å®ç°æ›´é«˜æ•ˆçš„è¯»å–ï¼Œå°±è¦è®¾è®¡æ›´å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œé‚£ä¹ˆå†™å…¥çš„é€Ÿåº¦å½“ç„¶å°±é™ä½äº†ï¼ŒåŒæ—¶åœ¨å­˜å‚¨ç©ºé—´ä¸Šä¹Ÿä¼šæœ‰é¢å¤–çš„è¦æ±‚ã€‚</p><p>2016å¹´çš„ä¸€ç¯‡è®ºæ–‡å°†æˆ‘ä»¬è¿™ç§æœ´ç´ çš„ç†è§£æå‡åˆ°ç†è®ºå±‚é¢ï¼Œè¿™å°±æ˜¯RUMçŒœæƒ³ã€‚RUMçŒœæƒ³æ¥è‡ªè®ºæ–‡â€œ<a href=\"https://stratos.seas.harvard.edu/files/stratos/files/rum.pdf\">Designing Access Methods: The RUM Conjecture</a>â€ï¼ˆManos Athanassoulis et al.(2016)ï¼‰ï¼ŒåŒæ—¶è¢«SIGMODå’ŒEDBTæ”¶å½•ã€‚å®ƒè¯´çš„æ˜¯ï¼Œå¯¹ä»»ä½•æ•°æ®ç»“æ„æ¥è¯´ï¼Œåœ¨Read Overheadï¼ˆè¯»ï¼‰ã€Update Overheadï¼ˆå†™ï¼‰ å’Œ Memory or Storage Overheadï¼ˆå­˜å‚¨ï¼‰ ä¸­ï¼ŒåŒæ—¶ä¼˜åŒ–ä¸¤é¡¹æ—¶ï¼Œéœ€è¦ä»¥å¦ä¸€é¡¹åŠ£åŒ–ä½œä¸ºä»£ä»·ã€‚è®ºæ–‡ç”¨ä¸€å¹…å›¾å±•ç¤ºäº†å¸¸è§æ•°æ®ç»“æ„åœ¨è¿™ä¸‰ä¸ªä¼˜åŒ–æ–¹å‘ä¸­çš„ä½ç½®ï¼Œè¿™é‡Œæˆ‘æ‘˜å½•ä¸‹æ¥ä¾¿äºä½ ç†è§£ã€‚</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/ea/15/eafcd1bd0c76c600f576b4a364bf7f15.png?wh=2406*1308\" alt=\"\" title=\"å¼•è‡ªManos Athanassoulis et al.(2016)\"></p><p>åœ¨è¿™å¼ å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªéå¸¸ç†Ÿæ‚‰çš„æ•°æ®ç»“æ„B-Treeå’ŒLSMï¼Œå®ƒä»¬è¢«ç”¨äºåˆ†å¸ƒå¼æ•°æ®åº“çš„å­˜å‚¨å¼•æ“ä¸­ï¼Œå‰è€…ï¼ˆå®é™…æ˜¯B+Treeï¼ŒB-Treeçš„å˜ä½“ï¼‰ä¸»è¦ç”¨äºPGXCï¼Œåè€…åˆ™ä¸»è¦ç”¨äºNewSQLã€‚è¿™æ˜¯ä¸æ˜¯ä»£è¡¨PGXCå°±æ˜¯è¦é’ˆå¯¹è¯»æ“ä½œï¼Œè€ŒNewSQLæ˜¯é’ˆå¯¹å†™æ“ä½œå‘¢ï¼Ÿå¹¶æ²¡æœ‰è¿™ä¹ˆç®€å•ï¼Œè¿˜æ˜¯è¦å…·ä½“åˆ†ææ•°æ®ç»“æ„çš„ä½¿ç”¨è¿‡ç¨‹ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å…ˆä»B+Treeè¯´èµ·ï¼Œå®ƒä¹Ÿæ˜¯å•ä½“æ•°æ®åº“å¹¿æ³›ä½¿ç”¨çš„æ•°æ®ç»“æ„ã€‚</p><h2>å­˜å‚¨ç»“æ„</h2><h3>B+Tree</h3><p>B+Treeæ˜¯å¯¹è¯»æ“ä½œä¼˜åŒ–çš„å­˜å‚¨ç»“æ„ï¼Œèƒ½å¤Ÿæ”¯æŒé«˜æ•ˆçš„èŒƒå›´æ‰«æï¼Œå¶èŠ‚ç‚¹ä¹‹é—´ä¿ç•™é“¾æ¥å¹¶ä¸”æŒ‰ä¸»é”®æœ‰åºæ’åˆ—ï¼Œæ‰«ææ—¶é¿å…äº†è€—æ—¶çš„éå†æ ‘æ“ä½œã€‚</p><p>æˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­æ¥æ¼”ç¤ºä¸‹MySQLæ•°æ®åº“çš„B+Treeå†™æ“ä½œè¿‡ç¨‹ã€‚</p><p>ä¸‹é¢è¿™å¼ å›¾ä¸­å±•ç¤ºäº†ä¸€æ£µé«˜åº¦ä¸º2çš„B+Treeï¼Œæ•°æ®å­˜å‚¨åœ¨5ä¸ªé¡µè¡¨ä¸­ï¼Œæ¯é¡µå¯å­˜æ”¾4æ¡è®°å½•ã€‚ä¸ºäº†æ–¹ä¾¿ä½ ç†è§£ï¼Œæˆ‘ç•¥å»äº†å¶å­èŠ‚ç‚¹æŒ‡å‘æ•°æ®çš„æŒ‡é’ˆä»¥åŠå¶å­èŠ‚ç‚¹ä¹‹é—´çš„é¡ºåºæŒ‡é’ˆã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/6b/c8/6bd6149970b0b760bf61a80fea54ffc8.jpg?wh=2700*1019\" alt=\"\"></p><p>B+Treeç”±å†…èŠ‚ç‚¹ï¼ˆInterNodeï¼‰å’Œå¶èŠ‚ç‚¹ï¼ˆLeafNodeï¼‰ä¸¤ç±»èŠ‚ç‚¹æ„æˆï¼Œå‰è€…ä»…åŒ…å«ç´¢å¼•ä¿¡æ¯ï¼Œåè€…åˆ™æºå¸¦äº†æŒ‡å‘æ•°æ®çš„æŒ‡é’ˆã€‚å½“æ’å…¥ä¸€ä¸ªç´¢å¼•å€¼ä¸º70çš„è®°å½•ï¼Œç”±äºå¯¹åº”é¡µè¡¨çš„è®°å½•å·²æ»¡ï¼Œéœ€è¦å¯¹B+Treeé‡æ–°æ’åˆ—ï¼Œå˜æ›´å…¶çˆ¶èŠ‚ç‚¹æ‰€åœ¨é¡µè¡¨çš„è®°å½•ï¼Œå¹¶è°ƒæ•´ç›¸é‚»é¡µè¡¨çš„è®°å½•ã€‚å®Œæˆé‡æ–°åˆ†å¸ƒåçš„æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/60/46/6069eba71bb31754e85940d34526ae46.jpg?wh=2700*1223\" alt=\"\"></p><p>åœ¨è¿™ä¸ªå†™å…¥è¿‡ç¨‹ä¸­å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol>\n<li>å†™æ”¾å¤§</li>\n</ol><p>æœ¬æ¥æˆ‘ä»¬ä»…éœ€è¦ä¸€æ¡å†™å…¥è®°å½•ï¼ˆé»„è‰²æ ‡æ³¨ï¼‰ï¼Œå®é™…ä¸Šæ›´æ–°äº†3ä¸ªé¡µè¡¨ä¸­çš„7æ¡ç´¢å¼•è®°å½•ï¼Œé¢å¤–çš„6æ¡è®°å½•ï¼ˆç»¿è‰²æ ‡æ³¨ï¼‰æ˜¯ä¸ºäº†ç»´æŠ¤B+Treeç»“æ„äº§ç”Ÿçš„å†™æ”¾å¤§ã€‚</p><p>ä¸ºäº†åº¦é‡å†™æ”¾å¤§çš„ç¨‹åº¦ï¼Œç›¸å…³ç ”ç©¶ä¸­å¼•å…¥äº†å†™æ”¾å¤§ç³»æ•°ï¼ˆWrite Amplification Factorï¼ŒWAFï¼‰è¿™ä¸ªæŒ‡æ ‡ï¼Œå°±æ˜¯æŒ‡å®é™…å†™å…¥ç£ç›˜çš„æ•°æ®é‡å’Œåº”ç”¨ç¨‹åºè¦æ±‚å†™å…¥æ•°æ®é‡ä¹‹æ¯”ã€‚å¯¹äºç©ºé—´æ”¾å¤§æœ‰ç±»ä¼¼çš„åº¦é‡å•ä½ï¼Œä¹Ÿå°±æ˜¯ç©ºé—´æ”¾å¤§ç³»æ•°ï¼ˆSpace Amplification Factor, SAFï¼‰ã€‚</p><p>æˆ‘ä»¬è¿™ä¸ªä¾‹å­ä¸­çš„WAFæ˜¯7ã€‚</p><ol start=\"2\">\n<li>å­˜å‚¨ä¸è¿ç»­</li>\n</ol><p>è™½ç„¶æ–°å¢å¶èŠ‚ç‚¹ä¼šåŠ å…¥åˆ°åŸæœ‰å¶èŠ‚ç‚¹æ„æˆçš„æœ‰åºé“¾è¡¨ä¸­ï¼Œæ•´ä½“åœ¨é€»è¾‘ä¸Šæ˜¯è¿ç»­çš„ï¼Œä½†æ˜¯åœ¨ç£ç›˜å­˜å‚¨ä¸Šï¼Œæ–°å¢é¡µè¡¨ç”³è¯·çš„å­˜å‚¨ç©ºé—´ä¸åŸæœ‰é¡µè¡¨å¾ˆå¯èƒ½æ˜¯ä¸ç›¸é‚»çš„ã€‚è¿™æ ·ï¼Œåœ¨åç»­åŒ…å«æ–°å¢å¶èŠ‚ç‚¹çš„æŸ¥è¯¢ä¸­ï¼Œå°†ä¼šå‡ºç°å¤šæ®µè¿ç»­è¯»å–ï¼Œç£ç›˜å¯»å€çš„æ—¶é—´å°†ä¼šå¢åŠ ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè™½ç„¶B+Treeç»“æ„æ˜¯ä¸ºè¯»å–åšäº†ä¼˜åŒ–ï¼Œä½†å¦‚æœè¿›è¡Œå¤§é‡éšæœºå†™è¿˜æ˜¯ä¼šé€ æˆå­˜å‚¨çš„ç¢ç‰‡åŒ–ï¼Œä»è€Œå¯¼è‡´å†™æ”¾å¤§å’Œè¯»æ”¾å¤§ã€‚</p><h4>å¡«å……å› å­</h4><p>å¡«å……å› å­ï¼ˆFactor Fillï¼‰æ˜¯ä¸€ç§å¸¸è§çš„ä¼˜åŒ–æ–¹æ³•ï¼Œå®ƒçš„åŸç†å°±æ˜¯åœ¨é¡µè¡¨ä¸­é¢„ç•™ä¸€äº›ç©ºé—´ï¼Œè¿™æ ·ä¸ä¼šå› ä¸ºå°‘é‡çš„æ•°æ®å†™å…¥é€ æˆæ ‘ç»“æ„çš„å¤§å¹…å˜åŠ¨ã€‚ä½†å¡«å……å› å­çš„è®¾ç½®ä¹Ÿå¾ˆéš¾æ‹¿æï¼Œè¿‡å¤§åˆ™æ— æ³•è§£å†³å†™æ”¾å¤§é—®é¢˜ï¼›è¿‡å°ä¼šé€ æˆé¡µè¡¨æ•°é‡è†¨èƒ€ï¼Œå¢å¤§å¯¹ç£ç›˜çš„æ‰«æèŒƒå›´ï¼Œé™ä½æŸ¥è¯¢æ€§èƒ½ã€‚</p><p>ç›¸å¯¹äºPGXCï¼ŒNewSQLé£æ ¼åˆ†å¸ƒå¼æ•°æ®åº“çš„åº•å±‚å­˜å‚¨å¼•æ“åˆ™ä¸»è¦é‡‡ç”¨LSM-Treeã€‚</p><h3>LSM-Tree</h3><p>LSM-Treeï¼ˆLog Structured-Merge Treeï¼‰ç”±Patrick Oâ€™Neilåœ¨1996å¹´çš„<a href=\"http://db.cs.berkeley.edu/cs286/papers/lsm-acta1996.pdf\">åŒåè®ºæ–‡</a>ä¸­é¦–å…ˆæå‡ºã€‚è€ŒåGoogleåœ¨<a href=\"https://www2.cs.duke.edu/courses/cps399.28/current/papers/osdi06-ChangDeanEtAl-bigtable.pdf\">Bigtable</a>ï¼ˆFay Chang et al.(2008)ï¼‰ä¸­ä½¿ç”¨äº†è¿™ä¸ªæ¨¡å‹ï¼Œå®ƒçš„å¤§è‡´å¤„ç†è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/21/39/21dc63cef862c71f5614445cb6477839.png?wh=2184*1164\" alt=\"\" title=\"å¼•è‡ªFay Chang et al.(2008)\"></p><p>ç³»ç»Ÿæ¥æ”¶åˆ°å†™æ“ä½œåä¼šè®°å½•æ—¥å¿—ï¼ˆTablet Logï¼‰å¹¶å°†æ•°æ®å†™å…¥å†…å­˜ï¼ˆMemtableï¼‰ï¼Œè¿™æ—¶å†™æ“ä½œå°±å¯ä»¥è¿”å›æˆåŠŸäº†ã€‚è€Œåœ¨ç³»ç»Ÿæ¥æ”¶åˆ°è¯»æ“ä½œæ—¶ï¼Œä¼šåœ¨å†…å­˜å’Œç£ç›˜æ–‡ä»¶ä¸­æŸ¥æ‰¾å¯¹åº”çš„æ•°æ®ã€‚</p><p>ä½ è‚¯å®šä¼šè¯´ä¸å¯¹å‘€ï¼Œå¦‚æœå†™å…¥çš„æ•°æ®éƒ½åœ¨å†…å­˜ä¸­ï¼Œç£ç›˜æ–‡ä»¶åˆæ˜¯å“ªæ¥çš„å‘¢ï¼Ÿ</p><p>çš„ç¡®ï¼Œè¿™ä¸­é—´è¿˜å°‘äº†é‡è¦çš„ä¸€æ­¥ï¼Œå°±æ˜¯æ•°æ®è½ç›˜çš„è¿‡ç¨‹ï¼Œè¿™ä¹Ÿæ˜¯LSM-Treeæœ€æœ‰ç‰¹ç‚¹çš„è®¾è®¡ã€‚å…¶å®ï¼ŒLSMæ˜¯åˆ†æˆä¸‰æ­¥å®Œæˆäº†æ•°æ®çš„è½ç›˜ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/71/8e/71ae4696ce4d5cbbfedfc6f5d9f0518e.jpg?wh=2700*1423\" alt=\"\"></p><ol>\n<li>ç¬¬ä¸€æ­¥å·²ç»è¯´è¿‡äº†ï¼Œå°±æ˜¯å†™å…¥Memtableï¼ŒåŒæ—¶è®°å½•Tablet Logï¼›</li>\n<li>å½“Memtableçš„æ•°æ®è¾¾åˆ°ä¸€å®šé˜ˆå€¼åï¼Œç³»ç»Ÿä¼šæŠŠå…¶å†»ç»“å¹¶å°†å…¶ä¸­çš„æ•°æ®é¡ºåºå†™å…¥ç£ç›˜ä¸Šçš„æœ‰åºæ–‡ä»¶ï¼ˆSorted String Tableï¼ŒSSTableï¼‰ä¸­ï¼Œè¿™ä¸ªæ“ä½œè¢«ç§°ä¸ºFlushï¼›å½“ç„¶ï¼Œæ‰§è¡Œè¿™ä¸ªåŠ¨ä½œçš„åŒæ—¶ï¼Œç³»ç»Ÿä¼šåŒæ­¥åˆ›å»ºä¸€ä¸ªæ–°çš„Memtableï¼Œå¤„ç†å†™å…¥è¯·æ±‚ã€‚</li>\n<li>æ ¹æ®ç¬¬äºŒæ­¥çš„å¤„ç†é€»è¾‘ï¼ŒMemtableä¼šå‘¨æœŸæ€§åœ°äº§ç”ŸSSTableã€‚å½“æ»¡è¶³ä¸€å®šçš„è§„åˆ™æ—¶ï¼Œè¿™äº›SSTableä¼šè¢«åˆå¹¶ä¸ºä¸€ä¸ªå¤§çš„SSTableã€‚è¿™ä¸ªæ“ä½œç§°ä¸ºCompactã€‚</li>\n</ol><p>ä¸B+Treeçš„æœ€å¤§ä¸åŒæ˜¯LSMå°†éšæœºå†™è½¬æ¢ä¸ºé¡ºåºå†™ï¼Œè¿™æ ·æå‡äº†å†™å…¥æ€§èƒ½ã€‚å¦å¤–ï¼ŒFlushæ“ä½œä¸ä¼šåƒB+Treeé‚£æ ·äº§ç”Ÿå†™æ”¾å¤§ã€‚</p><p>æˆ‘çŒœä½ ä¼šè¯´ï¼Œä¸å¯¹å‘€ï¼ŒFlushæ˜¯æ²¡æœ‰å†™æ”¾å¤§ï¼Œä½†è¿˜æœ‰Compactå‘¢ï¼Ÿ</p><p>è¯´çš„æ²¡é”™ï¼ŒçœŸæ­£çš„å†™æ”¾å¤§å°±å‘ç”Ÿåœ¨Compactè¿™ä¸ªåŠ¨ä½œä¸Šã€‚Compactæœ‰ä¸¤ä¸ªå…³é”®ç‚¹ï¼Œä¸€æ˜¯é€‰æ‹©ä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼ŒäºŒæ˜¯è¦å°†å“ªäº›SSTableåˆå¹¶æˆä¸€ä¸ªSSTableã€‚è¿™ä¸¤ç‚¹åŠ èµ·æ¥ç§°ä¸ºâ€œåˆå¹¶ç­–ç•¥â€ã€‚</p><p>æˆ‘ä»¬åˆšåˆšåœ¨ä¾‹å­ä¸­æè¿°çš„å°±æ˜¯ä¸€ç§åˆå¹¶ç­–ç•¥ï¼Œç§°ä¸ºSize-Tiered Compact Strategyï¼Œç®€ç§°Tieredã€‚BigTableå’ŒHBaseéƒ½é‡‡ç”¨äº†Tieredç­–ç•¥ã€‚å®ƒçš„åŸºæœ¬åŸç†æ˜¯ï¼Œæ¯å½“æŸä¸ªå°ºå¯¸çš„SSTableæ•°é‡è¾¾åˆ°æ—¢å®šä¸ªæ•°æ—¶ï¼Œå°†æ‰€æœ‰SSTableåˆå¹¶æˆä¸€ä¸ªå¤§çš„SSTableã€‚è¿™ç§ç­–ç•¥çš„ä¼˜ç‚¹æ˜¯æ¯”è¾ƒç›´è§‚ï¼Œå®ç°ç®€å•ï¼Œä½†æ˜¯ç¼ºç‚¹ä¹Ÿå¾ˆçªå‡ºã€‚ä¸‹é¢æˆ‘ä»¬ä»RUMçš„ä¸‰ä¸ªè§’åº¦æ¥åˆ†æä¸‹ï¼š</p><ol>\n<li>è¯»æ”¾å¤§</li>\n</ol><p>æ‰§è¡Œè¯»æ“ä½œæ—¶ï¼Œç”±äºå•ä¸ªSSTableå†…éƒ¨æ˜¯æŒ‰ç…§Keyé¡ºåºæ’åˆ—çš„ï¼Œé‚£ä¹ˆæŸ¥æ‰¾æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯O(logN)ã€‚å› ä¸ºSSTableæ–‡ä»¶æ˜¯æŒ‰ç…§æ—¶é—´é—´éš”äº§ç”Ÿçš„ï¼Œåœ¨Keyçš„èŒƒå›´ä¸Šå°±ä¼šå­˜åœ¨äº¤å‰ï¼Œæ‰€ä»¥æ¯æ¬¡è¯»æ“ä½œéƒ½è¦éå†æ‰€æœ‰SSTableã€‚å¦‚æœæœ‰Mä¸ªSSTableï¼Œæ•´ä½“æ—¶é—´å¤æ‚åº¦å°±æ˜¯O(M<em>logN)ã€‚æ‰§è¡ŒCompactåï¼Œæ—¶é—´å¤æ‚åº¦é™ä½ä¸ºO(log(M</em>N))ã€‚åœ¨åªæœ‰ä¸€ä¸ªSSTableæ—¶ï¼Œè¯»æ“ä½œæ²¡æœ‰æ”¾å¤§ã€‚</p><ol start=\"2\">\n<li>å†™æ”¾å¤§</li>\n</ol><p>Compactä¼šé™ä½è¯»æ”¾å¤§ï¼Œä½†å´å¸¦æ¥æ›´å¤šçš„å†™æ”¾å¤§å’Œç©ºé—´æ”¾å¤§ã€‚å…¶å®LSMåªæ˜¯æ¨è¿Ÿäº†å†™æ”¾å¤§ï¼ŒçŸ­æ—¶é—´å†…ï¼Œå¯ä»¥æ‰¿è½½å¤§é‡å¹¶å‘å†™å…¥ï¼Œä½†å¦‚æœæ˜¯æŒç»­å†™å…¥ï¼Œåˆ™éœ€è¦ä¸€éƒ¨åˆ†I/Oå¼€é”€ç”¨äºå¤„ç†Compactã€‚</p><p>ä½ å¯èƒ½å¬è¯´åˆ°è¿‡å…³äºB+Treeå’ŒLSMçš„ä¸€ä¸ªäº‰è®ºï¼Œå°±æ˜¯åˆ°åº•è°çš„å†™æ”¾å¤§æ›´ä¸¥é‡ã€‚å¦‚æœæ˜¯é‡‡ç”¨Tieredç­–ç•¥ï¼ŒLSMçš„å†™æ”¾å¤§æ¯”B+Treeè¿˜ä¸¥é‡ã€‚æ­¤å¤–ï¼ŒCompactæ˜¯ä¸€ä¸ªå¾ˆé‡çš„æ“ä½œï¼Œå ç”¨å¤§é‡çš„ç£ç›˜I/Oï¼Œä¼šå½±å“åŒæ—¶è¿›è¡Œçš„è¯»æ“ä½œã€‚</p><ol start=\"3\">\n<li>ç©ºé—´æ”¾å¤§</li>\n</ol><p>ä»ç©ºé—´æ”¾å¤§çš„è§’åº¦çœ‹ï¼ŒTieredç­–ç•¥éœ€è¦æœ‰ä¸¤å€äºæ•°æ®å¤§å°çš„ç©ºé—´ï¼Œåˆ†åˆ«å­˜å‚¨åˆå¹¶å‰çš„å¤šä¸ªSSTableå’Œåˆå¹¶åçš„ä¸€ä¸ªSSTableï¼Œæ‰€ä»¥SAFæ˜¯2ï¼Œè€ŒB+Treeçš„SAFæ˜¯1.33ã€‚</p><p>çœ‹åˆ°è¿™ä½ å¯èƒ½ä¼šè§‰å¾—å¥‡æ€ªï¼ŒLSMå¥½åƒä¹Ÿä¸æ˜¯å¤ªä¼˜ç§€å‘€ã€‚åªæœ‰çŸ­æ—¶é—´å†…å†™å…¥é€Ÿåº¦å¿«å’Œé˜¶æ®µæ€§çš„æ§åˆ¶è¯»æ”¾å¤§è¿™ä¸¤ä¸ªä¼˜åŠ¿ï¼Œåœ¨å†™æ”¾å¤§å’Œç©ºé—´æ”¾å¤§ä¸Šéƒ½åšå¾—ä¸å¥½ï¼Œè€Œä¸”è¿˜æœ‰Compactè¿™ç§è€—è´¹I/Oçš„é‡é‡çº§æ“ä½œã€‚é‚£LSMä¸ºä»€ä¹ˆè¿˜è¿™ä¹ˆæµè¡Œå‘¢?</p><p>è¿™æ˜¯å› ä¸ºLSMè¿˜æœ‰å¦ä¸€ç§åˆå¹¶ç­–ç•¥ï¼ŒLeveled Compact Strategyï¼Œç®€ç§°Leveledç­–ç•¥ã€‚</p><h4>Leveled Compact Strategy</h4><p>Tieredç­–ç•¥ä¹‹æ‰€ä»¥æœ‰ä¸¥é‡çš„å†™æ”¾å¤§å’Œç©ºé—´æ”¾å¤§é—®é¢˜ï¼Œä¸»è¦æ˜¯å› ä¸ºæ¯æ¬¡Compactéœ€è¦å…¨é‡æ•°æ®å‚ä¸ï¼Œå¼€é”€è‡ªç„¶å°±å¾ˆå¤§ã€‚é‚£ä¹ˆå¦‚æœæ¯æ¬¡åªå¤„ç†å°éƒ¨åˆ†SSTableæ–‡ä»¶ï¼Œå°±å¯ä»¥æ”¹å–„è¿™ä¸ªé—®é¢˜äº†ã€‚</p><p>Leveledå°±æ˜¯è¿™ä¸ªæ€è·¯ï¼Œå®ƒçš„è®¾è®¡æ ¸å¿ƒå°±æ˜¯å°†æ•°æ®åˆ†æˆä¸€ç³»åˆ—Keyäº’ä¸é‡å ä¸”å›ºå®šå¤§å°çš„SSTableæ–‡ä»¶ï¼Œå¹¶åˆ†å±‚ï¼ˆLevelï¼‰ç®¡ç†ã€‚åŒæ—¶ï¼Œç³»ç»Ÿè®°å½•æ¯ä¸ªSSTableæ–‡ä»¶å­˜å‚¨çš„Keyçš„èŒƒå›´ã€‚Leveledç­–ç•¥æœ€å…ˆåœ¨LevelDBä¸­ä½¿ç”¨ï¼Œä¹Ÿå› æ­¤å¾—åã€‚åæ¥ä»LevelDBä¸Šå‘å±•èµ·æ¥çš„RocksDBä¹Ÿé‡‡ç”¨è¿™ä¸ªç­–ç•¥ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¯¦ç»†è¯´æ˜ä¸€ä¸‹è¿™ä¸ªå¤„ç†è¿‡ç¨‹ã€‚</p><ol>\n<li>ç¬¬ä¸€æ­¥å¤„ç†Leveledå’ŒTieredæ˜¯ä¸€æ ·çš„ã€‚å½“å†…å­˜çš„æ•°æ®è¾ƒå¤šæ—¶ï¼Œå°±ä¼šFlushåˆ°SSTableæ–‡ä»¶ã€‚å¯¹åº”å†…å­˜çš„è¿™ä¸€å±‚SSTableå®šä¹‰ä¸ºL0ï¼Œå…¶ä»–å±‚çš„æ–‡ä»¶æˆ‘ä»¬åŒæ ·é‡‡ç”¨Lnçš„å½¢å¼è¡¨ç¤ºï¼Œnä¸ºå¯¹åº”çš„å±‚æ•°ã€‚å› ä¸ºL0çš„æ–‡ä»¶ä»ç„¶æ˜¯æŒ‰ç…§æ—¶é—´é¡ºåºç”Ÿæˆçš„ï¼Œæ‰€ä»¥æ–‡ä»¶ä¹‹é—´å°±å¯èƒ½æœ‰é‡å çš„Keyã€‚L0ä¸åšæ•´ç†çš„åŸå› æ˜¯ä¸ºäº†ä¿è¯å†™ç›˜é€Ÿåº¦ã€‚</li>\n</ol><p><img src=\"https://static001.geekbang.org/resource/image/40/ac/404015015046166f426ab3f159864bac.jpg?wh=2700*1276\" alt=\"\"></p><ol start=\"2\">\n<li>é€šå¸¸ç³»ç»Ÿä¼šé€šè¿‡æŒ‡å®šSSTableæ•°é‡å’Œå¤§å°çš„æ–¹å¼æ§åˆ¶æ¯ä¸€ä¸ªå±‚çš„æ•°æ®æ€»é‡ã€‚å½“L0è¶…è¿‡é¢„å®šæ–‡ä»¶æ•°é‡ï¼Œå°±ä¼šè§¦å‘L0å‘L1çš„Compactã€‚å› ä¸ºåœ¨L0çš„SSTableä¸­Keyæ˜¯äº¤å‰çš„ï¼Œæ‰€ä»¥è¦è¯»å–L0çš„æ‰€æœ‰SSTableï¼Œå†™å…¥L1ï¼Œå®Œæˆåå†åˆ é™¤L0æ–‡ä»¶ã€‚ä»L1å¼€å§‹ï¼ŒSSTableéƒ½æ˜¯ä¿è¯Keyä¸é‡å çš„ã€‚</li>\n</ol><p><img src=\"https://static001.geekbang.org/resource/image/a7/95/a7c9c1ca7723cfaa180461c1b3a8fd95.jpg?wh=2700*1271\" alt=\"\"></p><ol start=\"3\">\n<li>éšç€L1å±‚æ•°æ®é‡çš„å¢å¤šï¼ŒSSTableå¯èƒ½ä¼šé‡æ–°åˆ’åˆ†è¾¹ç•Œï¼Œç›®çš„æ˜¯ä¿è¯æ•°æ®ç›¸å¯¹å‡è¡¡çš„å­˜å‚¨ã€‚</li>\n</ol><p><img src=\"https://static001.geekbang.org/resource/image/f6/d6/f65536e12e95565ebe36c1596c53f9d6.jpg?wh=2700*1267\" alt=\"\"></p><ol start=\"4\">\n<li>ç”±äºL1çš„æ–‡ä»¶å¤§å°å’Œæ•°é‡ä¹Ÿæ˜¯å—é™çš„ï¼Œæ‰€ä»¥éšç€æ•°æ®é‡çš„å¢åŠ åˆä¼šè§¦å‘L1å‘L2çš„Compactã€‚å› ä¸ºL1çš„æ–‡ä»¶æ˜¯ä¸é‡å çš„ï¼Œæ‰€ä»¥ä¸ç”¨æ‰€æœ‰L1çš„æ–‡ä»¶éƒ½å‚ä¸Compactï¼Œè¿™å°±å»¶ç¼“äº†ç£ç›˜I/Oçš„å¼€é”€ã€‚è€ŒL2çš„å•ä¸ªæ–‡ä»¶å®¹é‡ä¼šæ›´å¤§ï¼Œé€šå¸¸ä»L1å¼€å§‹æ¯å±‚çš„å­˜å‚¨æ•°æ®é‡ä»¥10å€çš„é€Ÿåº¦å¢é•¿ã€‚è¿™æ ·ï¼Œæ¯æ¬¡Lnåˆ°L(n+1)çš„compactåªä¼šæ¶‰åŠå°‘æ•°çš„SSTableï¼Œé—´éš”çš„æ—¶é—´ä¹Ÿä¼šè¶Šæ¥è¶Šé•¿ã€‚</li>\n</ol><p><img src=\"https://static001.geekbang.org/resource/image/8c/50/8c891780dd19146d4454a6636c052c50.jpg?wh=2700*1548\" alt=\"\"></p><p>è¯´å®Œå¤„ç†æµç¨‹ï¼Œæˆ‘ä»¬å†ä»RUMä¸‰ä¸ªè§’åº¦æ¥åˆ†æä¸‹ã€‚</p><ol>\n<li>è¯»æ”¾å¤§</li>\n</ol><p>å› ä¸ºå­˜åœ¨å¤šä¸ªSSTableï¼ŒLeveledç­–ç•¥æ˜¾ç„¶æ˜¯å­˜åœ¨è¯»æ”¾å¤§çš„ã€‚å› ä¸ºSSTableæ˜¯æœ‰åºçš„ï¼Œå¦‚æœæœ‰Mä¸ªæ–‡ä»¶ï¼Œåˆ™æ•´ä½“è®¡ç®—çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(MlogN)ã€‚è¿™ä¸ªåœ°æ–¹è¿˜å¯ä»¥ä¼˜åŒ–ã€‚é€šå¸¸çš„æ–¹æ³•æ˜¯åœ¨SSTableä¸­å¼•å…¥Bloom Filterï¼ˆBFï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäºæ¦‚ç‡çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥å¿«é€Ÿåœ°ç¡®å®šä¸€ä¸ªKeyæ˜¯å¦å­˜åœ¨ã€‚è¿™æ ·æ‰§è¡ŒGetæ“ä½œæ—¶ï¼Œå…ˆè¯»å–æ¯ä¸€ä¸ªSSTableçš„BFï¼Œåªæœ‰è¿™ä¸ªKeyå­˜åœ¨æ‰ä¼šçœŸçš„å»æ–‡ä»¶ä¸­æŸ¥æ‰¾ã€‚</p><p>é‚£ä¹ˆå¯¹äºå¤šæ•°SSTableï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(1)ã€‚L0å±‚çš„SSTableæ— åºï¼Œæ‰€æœ‰éƒ½éœ€è¦éå†ï¼Œè€Œä»L1å±‚å¼€å§‹ï¼Œæ¯å±‚ä»…éœ€è¦æŸ¥æ‰¾ä¸€ä¸ªSSTableã€‚é‚£ä¹ˆä¼˜åŒ–åçš„æ•´ä½“æ—¶é—´å¤æ‚åº¦å°±æ˜¯O(X+L-1+logN)ï¼Œå…¶ä¸­Xæ˜¯L0çš„SSTableæ•°é‡ï¼ŒLæ˜¯å±‚æ•°ã€‚</p><ol start=\"2\">\n<li>å†™æ”¾å¤§</li>\n</ol><p>Leveledç­–ç•¥å¯¹å†™æ”¾å¤§æ˜¯æœ‰æ˜æ˜¾æ”¹å–„çš„ï¼Œé™¤äº†L0ä»¥å¤–ï¼Œæ¯æ¬¡æ›´æ–°ä»…æ¶‰åŠå°‘é‡SSTableã€‚ä½†æ˜¯L0çš„Compactæ¯”è¾ƒé¢‘ç¹ï¼Œæ‰€ä»¥ä»ç„¶æ˜¯è¯»å†™æ“ä½œçš„ç“¶é¢ˆã€‚</p><ol start=\"3\">\n<li>ç©ºé—´æ”¾å¤§</li>\n</ol><p>æ•°æ®åœ¨åŒå±‚çš„SSTableä¸é‡å ï¼Œè¿™å°±ä¿è¯äº†åŒå±‚ä¸ä¼šå­˜åœ¨é‡å¤è®°å½•ã€‚è€Œç”±äºæ¯å±‚å­˜å‚¨çš„æ•°æ®é‡æ˜¯æŒ‰ç…§æ¯”ä¾‹é€’å¢çš„ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æ•°æ®ä¼šå­˜å‚¨åœ¨åº•å±‚ã€‚å› æ­¤ï¼Œå¤§éƒ¨åˆ†æ•°æ®æ˜¯æ²¡æœ‰é‡å¤è®°å½•çš„ï¼Œæ‰€ä»¥æ•°æ®çš„ç©ºé—´æ”¾å¤§ä¹Ÿå¾—åˆ°äº†æœ‰æ•ˆæ§åˆ¶ã€‚</p><h2>åˆ†å¸ƒå¼æ•°æ®åº“çš„å®ç°</h2><p>åˆ°è¿™é‡Œæˆ‘ä»¬å·²ç»ä»‹ç»äº†å­˜å‚¨ç»“æ„çš„å®ç°åŸç†å’Œå®ƒä»¬åœ¨å•ä½“æ•°æ®åº“ä¸­çš„è¿è½¬è¿‡ç¨‹ã€‚åœ¨åˆ†å¸ƒå¼æ•°æ®åº“ä¸­ï¼Œæ•°æ®å­˜å‚¨æ˜¯åœ¨æ¯ä¸ªæ•°æ®èŠ‚ç‚¹ä¸Šå„è‡ªè¿›è¡Œçš„ï¼Œæ‰€ä»¥åŸç†å’Œè¿‡ç¨‹æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚å› æ­¤ï¼ŒTiDBå’ŒCockroachDBå¹²è„†ç›´æ¥ä½¿ç”¨RocksDBä½œä¸ºå•æœºå­˜å‚¨å¼•æ“ã€‚åœ¨è¿™ä¸¤ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“çš„æ¶æ„ä¸­ï¼ŒRocksDBéƒ½ä½äºRaftåè®®ä¹‹ä¸‹ï¼Œæ‰¿æ‹…å…·ä½“çš„æ•°æ®è½åœ°å·¥ä½œã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/19/9f/19a017c90e3cb51c59a96f54563f019f.jpg?wh=2700*1155\" alt=\"\"></p><p>ä»–ä»¬ä¸ºä»€ä¹ˆé€‰æ‹©RocksDBå‘¢ï¼ŸCockroachDBçš„å®˜æ–¹è§£é‡Šæ˜¯ï¼Œä»–ä»¬çš„é€‰æ‹©å®Œå…¨ä¸æ˜¯å› ä¸ºè¦è€ƒè™‘LSMçš„å†™ä¼˜åŒ–èƒ½åŠ›ï¼Œè€Œæ˜¯å› ä¸ºRocksDBä½œä¸ºä¸€ä¸ªæˆç†Ÿçš„å•æœºå­˜å‚¨å¼•æ“ï¼Œå¯ä»¥åŠ é€ŸCockroachDBçš„å¼€å‘è¿‡ç¨‹ï¼Œè€ŒRocksDBæœ¬èº«ä¹Ÿéå¸¸ä¼˜ç§€ï¼Œæ˜¯ä»–ä»¬èƒ½æ‰¾åˆ°çš„æœ€å¥½é€‰æ‹©ã€‚å¦ä¸€æ–¹é¢ï¼ŒTiDBè™½ç„¶æ²¡æœ‰æåˆ°é€‰æ‹©ä¸€ä¸ªå†™ä¼˜åŒ–çš„å­˜å‚¨å¼•æ“æ˜¯å¦æœ‰ç‰¹æ®Šæ„ä¹‰ï¼Œä½†åŒæ ·ä¹Ÿè®¤ä¸ºRocksDB æ˜¯ä¸€ä¸ªéå¸¸ä¼˜ç§€å¼€æºé¡¹ç›®ï¼Œå¯ä»¥æ»¡è¶³ä»–ä»¬å¯¹å•æœºå¼•æ“çš„å„ç§è¦æ±‚ã€‚</p><p>ä¸è¿‡ï¼Œå¾ˆæœ‰æ„æ€çš„åœ°æ–¹æ˜¯ï¼Œç»è¿‡äº†æ—©æœŸç‰ˆæœ¬çš„æ¼”è¿›ï¼ŒTiDBå’ŒCockroachDBä¸çº¦è€ŒåŒéƒ½æ¨å‡ºäº†è‡ªå·±çš„å•æœºå­˜å‚¨å¼•æ“ã€‚</p><p>ä½ çŒœæ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿæˆ‘åœ¨ç¨åå†ç»™å‡ºç­”æ¡ˆã€‚ç°åœ¨è®©æˆ‘ä»¬å…ˆçœ‹çœ‹å¦ä¸€æ¬¾NewSQLé£æ ¼åˆ†å¸ƒå¼æ•°æ®åº“OceanBaseçš„å®ç°ã€‚</p><h3>OceanBase</h3><p>OceanBaseé€‰æ‹©äº†è‡ªç ”æ–¹å¼ï¼Œä¹Ÿå°±æ²¡æœ‰ç›´æ¥å¼•ç”¨RocksDBï¼Œä½†å®ƒçš„å­˜å‚¨æ¨¡å‹åŸºæœ¬ä¸Šä¹Ÿæ˜¯LSMï¼Œä¹Ÿå°±åŒæ ·éœ€è¦é¢å¯¹Compactå¸¦æ¥çš„ä¸€ç³»åˆ—é—®é¢˜ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹OceanBaseæ˜¯æ€ä¹ˆä¼˜åŒ–çš„ã€‚</p><h4>å®å—ä¸å¾®å—</h4><p>åœ¨Compactè¿‡ç¨‹ä¸­ï¼Œè¢«åˆå¹¶æ–‡ä»¶ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½è¦é‡å†™åˆ°æ–°æ–‡ä»¶ä¸­ã€‚å…¶å®ï¼Œå¯¹äºé‚£äº›æ²¡æœ‰ä»»ä½•ä¿®æ”¹çš„æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å¯ä»¥è¢«ä¼˜åŒ–çš„ã€‚</p><p>OceanBaseå¼•å…¥äº†å®å—ä¸å¾®å—çš„æ¦‚å¿µï¼Œå¾®å—æ˜¯æ•°æ®çš„ç»„ç»‡å•å…ƒï¼Œå®å—åˆ™ç”±å¾®å—ç»„æˆã€‚è¿™æ ·åœ¨è¿›è¡ŒCompactæ“ä½œæ—¶ï¼Œå¯ä»¥åœ¨å®å—å’Œå¾®å—ä¸¤ä¸ªçº§åˆ«åˆ¤æ–­ï¼Œæ˜¯å¦å¯ä»¥å¤ç”¨ã€‚å¦‚æœåœ¨è¿™ä¸¤ä¸ªçº§åˆ«æ•°æ®æ²¡æœ‰å‘ç”Ÿå®è´¨å˜åŒ–ï¼Œåˆ™ç›´æ¥è¿›è¡Œå—çº§åˆ«çš„æ‹·è´ï¼Œè¿™æ ·å°±çœå»äº†æ›´ç»†ç²’åº¦çš„æ•°æ®è§£æã€ç¼–ç ä»¥åŠè®¡ç®—æ ¡éªŒå’Œï¼ˆChecksumï¼‰ç­‰æ“ä½œã€‚</p><h4>è½®è½¬åˆå¹¶</h4><p>OceanBaseè¿˜åœ¨å¤šå‰¯æœ¬åŸºç¡€ä¸Šè®¾è®¡äº†è½®è½¬åˆå¹¶æœºåˆ¶ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œæ ¹æ®Raftåè®®æˆ–è€…Paxosåè®®ï¼Œæ€»æœ‰å¤šä¸ªå‰¯æœ¬åŒæ—¶å­˜å‚¨ç€æœ€æ–°çš„æ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç”¨å¤šå‰¯æœ¬æ¥è§£è€¦Compactæ“ä½œå’ŒåŒæ—¶æ®µçš„æŸ¥è¯¢æ“ä½œï¼Œé¿å…ç£ç›˜I/Oä¸Šçš„ç«äº‰ã€‚</p><p>å®ƒçš„å¤§è‡´è®¾è®¡æ€è·¯æ˜¯è¿™æ ·çš„ï¼Œå°†Compactæ“ä½œæ”¾åœ¨ä¸Leaderä¿æŒæ•°æ®åŒæ­¥çš„Followerä¸Šæ‰§è¡Œï¼Œè€ŒLeaderèŠ‚ç‚¹åˆ™ä¿æŒå¯¹å¤–æä¾›æŸ¥è¯¢æœåŠ¡ã€‚å½“Compactå®Œæˆåï¼Œæ”¹ç”±é‚£ä¸ªFollowerå¯¹å¤–æä¾›æŸ¥è¯¢æœåŠ¡ï¼ŒLeaderå’Œå…¶ä»–å‰¯æœ¬åˆ™å»æ‰§è¡ŒCompactã€‚</p><p>OceanBaseçš„è¿™ä¸¤é¡¹ä¼˜åŒ–è™½ç„¶æ²¡æœ‰é™ä½å†™æ”¾å¤§ç³»æ•°ï¼Œä½†å´æœ‰æ•ˆå‡å°‘äº†Compactè¿‡ç¨‹ä¸­çš„I/Oç«äº‰ã€‚</p><h3>TiDBï¼šWiscKey</h3><p>OceanBaseçš„ä¼˜åŒ–è¿˜åœç•™åœ¨å·¥ç¨‹å±‚é¢ï¼Œé‚£ä¹ˆè¿˜æœ‰æ²¡æœ‰æ›´å¥½çš„ç†è®ºæ¨¡å‹å‘¢?</p><p>2016å¹´çœŸçš„å‡ºç°äº†æ–°çš„æ¨¡å‹ï¼Œè¿™å°±æ˜¯WiscKeyã€‚è®ºæ–‡â€œ<a href=\"https://www.usenix.org/system/files/conference/fast16/fast16-papers-lu.pdf\">WiscKey: Separating Keys from Values in SSD-conscious Storage</a>â€ï¼ˆLanyue Lu et al.(2016)ï¼‰é˜è¿°äº†è¿™ç§æ¨¡å‹çš„è®¾è®¡æ€æƒ³ã€‚WiscKey æå‡ºçš„æ”¹è¿›æ˜¯é€šè¿‡å°† value åˆ†ç¦»å‡ºLSM-Treeçš„æ–¹æ³•æ¥é™ä½å†™æ”¾å¤§ã€‚</p><p>WiscKeyçš„ä¸»è¦è®¾è®¡æ€æƒ³æ˜¯ï¼Œåœ¨SSTableçš„é‡å†™è¿‡ç¨‹ä¸­ï¼Œæ ¸å¿ƒå·¥ä½œæ˜¯å¯¹Keyè¿›è¡Œæ•´ç†ï¼Œä¿è¯å¤šä¸ªSSTableçš„KeyèŒƒå›´ä¸é‡å ï¼Œä¸”å†…éƒ¨æœ‰åºã€‚è€Œè¿™ä¸ªè¿‡ç¨‹ä¸­Valueçš„é‡å†™æ˜¯æ²¡æœ‰å¤ªå¤§ä»·å€¼çš„ï¼Œè€Œä»å®è·µçœ‹ï¼ŒValueå ç”¨çš„å­˜å‚¨ç©ºé—´è¿œè¿œå¤§äºKeyã€‚è¿™æ„å‘³ç€å¤§é‡çš„å†™æ“ä½œå’Œç©ºé—´æˆæœ¬è¢«æµªè´¹äº†ã€‚æ‰€ä»¥WiscKeyæå‡ºå°†Valueä»SSTableä¸­åˆ†ç¦»å‡ºæ¥å•ç‹¬å­˜å‚¨ï¼Œè¿™æ ·å°±é™ä½äº†å†™æ”¾å¤§ç³»æ•°ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/d0/a9/d0eda0529ce4c9796f777c95d46914a9.png?wh=2418*958\" alt=\"\" title=\"å¼•è‡ªLanyue Lu et al.(2016)\"></p><p>Valueå•ç‹¬å­˜å‚¨çš„é—®é¢˜æ˜¯æŒ‰ç…§Keyè¿ç»­è¯»å–æ•°æ®æ—¶ï¼Œå¯¹åº”çš„Valueå¹¶ä¸æ˜¯è¿ç»­å­˜å‚¨ï¼Œç£ç›˜å¯»å€æˆæœ¬å¢å¤§ã€‚è€ŒWiscKeyçš„è®¾è®¡å‰ææ˜¯ä½¿ç”¨SSDæ›¿æ¢HDDï¼ŒSSDçš„éšæœºè¯»å†™æ•ˆç‡æ¥è¿‘äºé¡ºåºè¯»å†™ï¼Œæ‰€ä»¥èƒ½å¤Ÿä¿æŒè¾ƒé«˜çš„æ•´ä½“æ•ˆç‡ã€‚äº‹å®ä¸Šï¼Œè¿‡é«˜çš„å†™æ”¾å¤§ä¹Ÿä¼šä¸¥é‡ç¼©çŸ­SSDçš„ä½¿ç”¨å¯¿å‘½ã€‚WiscKeyå°±æ˜¯é’ˆå¯¹SSDæå‡ºçš„å­˜å‚¨æ¨¡å‹ã€‚</p><p>è¯´å®ŒWiscKeyï¼Œä½ æˆ–è®¸çŒœåˆ°äº†TiDBå’ŒCockroachæ”¾å¼ƒRocksDBçš„åŸå› ã€‚</p><p>æ²¡é”™ï¼ŒTiDBçš„æ–°å­˜å‚¨å¼•æ“TiTanå°±æ˜¯å—åˆ°WiscKeyçš„å¯å‘ï¼Œå®ƒç›®æ ‡ä¹‹ä¸€å°±æ˜¯å°† Value ä» LSM-Tree ä¸­åˆ†ç¦»å‡ºæ¥å•ç‹¬å­˜å‚¨ï¼Œä»¥é™ä½å†™æ”¾å¤§ã€‚</p><h3>CockroachDBï¼šPebble</h3><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹ï¼ŒCockroachDBçš„å•æœºå­˜å‚¨å¼•æ“Pebbleã€‚è¿™é‡Œå¯èƒ½ä¼šè®©ä½ æœ‰ç‚¹æ„å¤–ï¼ŒPebbleå¹¶ä¸æ˜¯ç”±äºWiscKeyçš„æ¨¡å‹æ”¹è¿›ï¼Œå®ƒçš„å‡ºç°å®Œå…¨æ˜¯å·¥ç¨‹å› ç´ ã€‚é¦–å…ˆæ˜¯Goä¸Cä¹‹é—´çš„è°ƒç”¨éšœç¢ï¼ˆCGo barrierï¼‰ã€‚</p><h4>CGo barrier</h4><p>CockroachDBé‡‡ç”¨Goä½œä¸ºç¼–ç¨‹è¯­è¨€ï¼Œè€ŒRocksDBæ˜¯ç”±C++ç¼–å†™çš„ã€‚æ‰€ä»¥CockroachDBè¦é¢ä¸´Goåˆ°Cçš„ä¹‹é—´çš„è°ƒç”¨éšœç¢ã€‚æµ‹è¯•è¡¨æ˜ï¼Œæ¯ä¸€æ¬¡å¯¹RocksDBçš„è°ƒç”¨éƒ½è¦é¢å¤–ä»˜å‡º70çº³ç§’çš„å»¶è¿Ÿã€‚è¿™ä¸ªæ•°å­—è™½ç„¶çœ‹ä¸Šå»å¹¶ä¸å¤§ï¼Œä½†æ˜¯ç”±äºK/Væ“ä½œéå¸¸é¢‘ç¹ï¼Œæ€»ä½“æˆæœ¬ä»ç„¶å¾ˆå¯è§‚ã€‚CockroachDBä¹Ÿé€šè¿‡ä¸€äº›è®¾è®¡æ¥é™ä½å»¶è¿Ÿï¼Œæ¯”å¦‚å°†å¤šæ¬¡K/Væ“ä½œåˆå¹¶æˆä¸€æ¬¡å¯¹RocksDBçš„æ“ä½œï¼Œä½†æ˜¯è¿™ä¸€æ–¹é¢å¸¦æ¥è®¾è®¡çš„å¤æ‚æ€§ï¼Œå¦å¤–ä¹Ÿæ— æ³•ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜ã€‚</p><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒTiDBä¹Ÿä½¿ç”¨äº†Goè¯­è¨€ä½œä¸ºä¸»åŠ›å¼€å‘è¯­è¨€ï¼ŒåŒæ ·é¢ä¸´äº†è¿™ä¸ªé—®é¢˜ã€‚TiDBæœ€ç»ˆæ˜¯åœ¨åº•å±‚å­˜å‚¨TiVKæ”¾å¼ƒGoè€Œé€‰æ‹©Rustçš„ï¼Œéƒ¨åˆ†åŸå› å°±æ˜¯Rustä¸C++ä¹‹é—´çš„è°ƒç”¨æˆæœ¬è¦ä½å¾—å¤šã€‚</p><h4>ä»£ç è†¨èƒ€</h4><p>CockroachDBæ›¿æ¢å­˜å‚¨å¼•æ“çš„å¦ä¸€ä¸ªåŸå› æ˜¯ï¼ŒRocksDBçš„ä»£ç é‡æ—¥ç›Šè†¨èƒ€ã€‚æ—©æœŸRocksDBçš„ä»£ç è¡Œæ•°ä»…æ˜¯30kï¼Œè€Œä»Šå¤©å·²ç»å¢åŠ åˆ°350k+ã€‚è¿™å¾ˆå¤§ç¨‹åº¦æ˜¯ç”±äºRocksDBçš„æˆåŠŸï¼Œå¾ˆå¤šè½¯ä»¶é€‰æ‹©äº†RocksDBä½œä¸ºå­˜å‚¨å¼•æ“ï¼ŒåŒ…æ‹¬MySQLï¼ˆMyRocksï¼‰ã€Flinkç­‰ï¼Œè¿™é©±åŠ¨RocksDBå¢åŠ äº†æ›´ä¸°å¯Œçš„ç‰¹æ€§ï¼Œä¹Ÿå¯¼è‡´ä½“é‡è¶Šæ¥è¶Šå¤§ã€‚ä½†è¿™äº›ä¸°å¯Œçš„ç‰¹æ€§å¯¹CockroachDBæ¥è¯´å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œåè€Œå¼•å…¥äº†ä¸å¿…è¦çš„å˜æ›´é£é™©ã€‚è€ŒCockraochå¼€å‘çš„Pebbleï¼Œä»£ç è¡Œæ•°åˆ™ä»…æœ‰45kï¼Œçš„ç¡®æ˜¯å°å·§å¾—å¤šäº†ã€‚</p><p>æ‰€ä»¥ï¼Œæ€»çš„æ¥è¯´ï¼ŒCockraochDBæ›¿æ¢å­˜å‚¨å¼•æ“æ˜¯å·¥ç¨‹åŸå› ï¼Œè€Œå…¶ä¸­CGO barrierçš„è¿™ä¸ªé—®é¢˜æ›´åƒæ˜¯åœ¨å¿è¿˜æŠ€æœ¯å€ºã€‚</p><h3>TiFlash</h3><p>åˆ°è¿™é‡Œï¼Œåˆ†å¸ƒå¼æ•°æ®åº“ä¸‹å…¸å‹çš„å­˜å‚¨å¼•æ“å°±ä»‹ç»å®Œäº†ï¼Œå®ƒä»¬éƒ½é€‚ç”¨äºOLTPåœºæ™¯ï¼Œè¦æ±‚åœ¨å°æ•°æ®é‡ä¸‹å…·æœ‰é«˜æ•ˆçš„è¯»å†™èƒ½åŠ›ã€‚è€ŒOLAPä¸‹çš„å­˜å‚¨å¼•æ“åˆ™æœ‰å¾ˆå¤§çš„ä¸åŒï¼Œé€šå¸¸ä¸ä¼šå¯¹å•ç¬”å†™å…¥æœ‰å¤ªé«˜çš„è¦æ±‚ï¼Œä½†ä¹Ÿæœ‰ä¾‹å¤–ï¼Œè¿˜è®°å¾—æˆ‘åœ¨<a href=\"https://time.geekbang.org/column/article/287246\">ç¬¬18è®²</a>æåˆ°è¿‡çš„OLAPå­˜å‚¨å¼•æ“TiFlashå—ï¼Ÿç”±äºå®æ—¶åˆ†æçš„è¦æ±‚ï¼Œå®ƒå¿…é¡»åŠæ—¶è½ç›˜æ¥è‡ªTiKVçš„æ•°æ®ï¼ŒåŒæ ·éœ€è¦å¾ˆé«˜çš„å†™å…¥é€Ÿåº¦ã€‚</p><p>åœ¨18è®²ä¸­å¹¶æ²¡å¯¹TiFlashå±•å¼€è¯´æ˜ï¼Œæˆ‘æƒ³ï¼Œç°åœ¨ä½ åº”è¯¥èƒ½å¤ŸçŒœå‡ºTiFlashçš„å…³é”®è®¾è®¡äº†å§ã€‚æ˜¯çš„ï¼Œé«˜æ•ˆå†™å…¥çš„ç§˜å¯†å°±åœ¨äºå®ƒçš„å­˜å‚¨æ¨¡å‹Delta Treeé‡‡ç”¨äº†ç±»ä¼¼LSMçš„ç»“æ„ã€‚å…¶ä¸­çš„Delta Layer å’Œ Stable Layerï¼Œåˆ†åˆ«å¯¹åº” LSM Tree çš„ L0 å’Œ L1ï¼ŒDelta Layerå¯ä»¥é¡ºåºå†™å…¥ã€‚</p><h2>å°ç»“</h2><p>é‚£ä¹ˆï¼Œä»Šå¤©çš„è¯¾ç¨‹å°±åˆ°è¿™é‡Œäº†ï¼Œè®©æˆ‘ä»¬æ¢³ç†ä¸€ä¸‹è¿™ä¸€è®²çš„è¦ç‚¹ã€‚</p><ol>\n<li>RUMçŒœæƒ³æå‡ºè¯»è´Ÿè½½ã€å†™è´Ÿè½½ã€ç©ºé—´è´Ÿè½½è¿™ä¸‰è€…ä¹‹é—´åªèƒ½ä¼˜åŒ–ä¸¤ä¸ªç›®æ ‡ï¼Œå¦å¤–ä¸€ä¸ªç›®æ ‡åªèƒ½è¢«å¼±åŒ–ã€‚åœ¨å…¸å‹æ•°æ®ç»“æ„ä¸­ï¼ŒB+Treeæ˜¯è¯»å–ä¼˜åŒ–ï¼ŒLSMæ˜¯å†™å…¥ä¼˜åŒ–ï¼Œè¿™ä¸¤ç§å­˜å‚¨ç»“æ„æ­£å¥½å¯¹åº”äº†ä¸¤ç§é£æ ¼åˆ†å¸ƒå¼æ•°æ®åº“çš„å­˜å‚¨å¼•æ“ã€‚</li>\n<li>PGXCå’Œå•ä½“æ•°æ®åº“é‡‡ç”¨äº†B+Treeï¼Œéšæœºå†™ä¼šå¸¦æ¥é¡µè¡¨åˆ†è£‚å’Œå­˜å‚¨ä¸è¿ç»­ï¼Œå¯¼è‡´å†™æ”¾å¤§å’Œè¯»æ”¾å¤§ã€‚å¸¸ç”¨çš„ä¼˜åŒ–æ–¹å¼æ˜¯é€šè¿‡å¡«å……å› å­é¢„ç•™é¡µç©ºé—´ã€‚LSMå°†éšæœºå†™è½¬æ¢ä¸ºé¡ºåºå†™æå‡äº†å†™å…¥é€Ÿåº¦ï¼Œä½†åªæ˜¯å»¶ç¼“äº†å†™æ”¾å¤§å¹¶æ²¡æœ‰çœŸæ­£å‡å°‘å†™æ”¾å¤§ã€‚å¦‚æœé‡‡ç”¨Tieredç­–ç•¥ï¼ŒLSMçš„å†™æ”¾å¤§å’Œç©ºé—´æ”¾å¤§éƒ½é«˜äºB+Treeã€‚ä¸è¿‡ï¼ŒLSMå¯ä»¥å¾ˆå¥½åœ°æ§åˆ¶è¯»æ”¾å¤§ï¼Œè¯»æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯O(logN)ã€‚</li>\n<li>Levelç­–ç•¥ï¼Œé™ä½äº†å†™æ”¾å¤§å’Œç©ºé—´æ”¾å¤§ï¼ŒåŒæ—¶è¯»æ“ä½œçš„æˆæœ¬ä¹Ÿæ²¡æœ‰å¤§å¹…å¢åŠ ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¹¿æ³›ä½¿ç”¨çš„å­˜å‚¨æ¨¡å‹ã€‚RocksDBé‡‡ç”¨äº†è¿™ç§å­˜å‚¨æ¨¡å‹ï¼ŒåŠ ä¸Šä¼˜ç§€çš„å·¥ç¨‹å®ç°ï¼Œè¢«å¾ˆå¤šè½¯ä»¶å¼•ç”¨ã€‚TiDBå’ŒCockroachDBä¹Ÿä½¿ç”¨RocksDBä½œä¸ºå•æœºå­˜å‚¨å¼•æ“ã€‚OceanBaseåœ¨å·¥ç¨‹å±‚é¢å¯¹LSMè¿›è¡Œäº†ä¼˜åŒ–ã€‚</li>\n<li>WiscKeyæ˜¯å¯¹LSMçš„ç†è®ºæ¨¡å‹ä¼˜åŒ–ï¼Œé€šè¿‡Key/Valueåˆ†ç¦»å­˜å‚¨çš„æ–¹å¼é™ä½å†™æ”¾å¤§ï¼Œä½†è¿™ç§è®¾è®¡ä¼šå¢åŠ éšæœºè¯»å†™ï¼Œè¦ä»¥ä½¿ç”¨SSDä¸ºå‰æã€‚TiDBå—åˆ°WiscKeyçš„å¯å‘ï¼Œè‡ªç ”äº†TiTanã€‚</li>\n<li>CockroachDBä¹Ÿæ¨å‡ºäº†è‡ªå·±çš„å­˜å‚¨å¼•æ“Pebbleï¼Œä¸»è¦ç›®çš„æ˜¯è§£å†³å·¥ç¨‹é—®é¢˜ï¼ŒåŒ…æ‹¬è§£å†³CGo barrieré—®é¢˜å’Œé¿å…RuståŠŸèƒ½è†¨èƒ€å¸¦æ¥çš„å˜æ›´é£é™©ã€‚</li>\n</ol><p>è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ç®€å•ä»‹ç»äº†è¿‘å¹´æ¥çš„ä¸»æµå­˜å‚¨æ¨¡å‹ï¼Œä¸éš¾å‘ç°LSMå æ®äº†ä¸»å¯¼ä½ç½®ã€‚ä½†è¿™å¹¶ä¸ä»£è¡¨B+Treeæ˜¯ä¸€ç§å¤±è´¥çš„è®¾è®¡ï¼Œä¸¤è€…åªæ˜¯åœ¨RUMä¹‹é—´é€‰æ‹©äº†ä¸åŒçš„ä¼˜åŒ–æ–¹å‘ã€‚åŒæ—¶ï¼Œæ˜¯å¦æœ‰å¯é çš„å¼€æºå·¥ç¨‹å®ç°ä¹Ÿç›´æ¥å½±å“åˆ°äº†å¯¹åº”å­˜å‚¨æ¨¡å‹çš„æµè¡Œåº¦ï¼Œè¿™ä¸€ç‚¹å’ŒRaftåè®®çš„å¤§è§„æ¨¡ä½¿ç”¨å¾ˆç›¸ä¼¼ã€‚</p><p>æˆ‘çš„ä¸€ç‚¹å»ºè®®æ˜¯ï¼Œè®°ä¸‹è¿™äº›å­˜å‚¨æ¨¡å‹è™½ç„¶é‡è¦ï¼Œä½†æ›´åŠ å…³é”®çš„æ˜¯å¯¹RUMçŒœæƒ³çš„æ·±å…¥æ€è€ƒï¼Œå› ä¸ºæ¶æ„è®¾è®¡çš„ç²¾é«“å°±åœ¨äºåšå‡ºé€‚å½“çš„å–èˆã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/5b/32/5bbd48e644e90fda6ce91a0360e7e332.jpg?wh=2700*2916\" alt=\"\"></p><h2>æ€è€ƒé¢˜</h2><p>è¯¾ç¨‹çš„æœ€åï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä»Šå¤©çš„æ€è€ƒé¢˜ã€‚ä»Šå¤©çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†ä¸åŒçš„å­˜å‚¨æ¨¡å‹ï¼Œå…¶ä¸­ä¹Ÿæåˆ°äº†Bloom Filterçš„ä½¿ç”¨ã€‚å®ƒæ˜¯ä¸€ç§ç¥å¥‡çš„æ•°æ®ç»“æ„ï¼Œåœ¨RUMä¸­æ˜¯ç©ºé—´ä¼˜åŒ–çš„å…¸å‹ï¼Œç”¨å¾ˆå°‘çš„ç©ºé—´å°±å¯ä»¥è®°å½•å¾ˆå¤šæ•°å€¼æ˜¯å¦å­˜åœ¨ã€‚è¿™ç§æ•°æ®ç»“æ„æä¾›äº†ä¸¤ç§æ“ä½œæ–¹å¼ï¼Œç”¨äºæ•°å€¼çš„å†™å…¥å’Œæ•°å€¼çš„æ£€æ ¸ï¼Œä½†æ•°æ®åº“æŸ¥è¯¢æ›´å¤šæ˜¯èŒƒå›´æŸ¥è¯¢ï¼Œåœ¨K/Vä¸­ä½“ç°ä¸ºScanæ“ä½œï¼Œæ˜¾ç„¶ä¸èƒ½ç›´æ¥å¯¹åº”ã€‚æ‰€ä»¥æˆ‘çš„é—®é¢˜æ˜¯ï¼ŒScanæ“ä½œæ˜¯å¦å¯ä»¥ä½¿ç”¨Bloom Filteræ¥åŠ é€Ÿï¼Œå¦‚æœå¯ä»¥åˆè¯¥å¦‚ä½•è®¾è®¡å‘¢ï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨è¯„è®ºåŒºç•™è¨€å’Œæˆ‘ä¸€èµ·è®¨è®ºï¼Œæˆ‘ä¼šåœ¨ç­”ç–‘ç¯‡å’Œä½ ç»§ç»­è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚å¦‚æœä½ èº«è¾¹çš„æœ‹å‹ä¹Ÿå¯¹å­˜å‚¨å¼•æ“è¿™ä¸ªè¯é¢˜æ„Ÿå…´è¶£ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠä»Šå¤©è¿™ä¸€è®²åˆ†äº«ç»™ä»–ï¼Œæˆ‘ä»¬ä¸€èµ·è®¨è®ºã€‚</p><h2>å­¦ä¹ èµ„æ–™</h2><p>Fay Chang et al.: <a href=\"https://www2.cs.duke.edu/courses/cps399.28/current/papers/osdi06-ChangDeanEtAl-bigtable.pdf\"><em>Bigtable: A Distributed Storage System for Structured Data</em></a></p><p>Lanyue Lu et al.: <a href=\"https://www.usenix.org/system/files/conference/fast16/fast16-papers-lu.pdf\"><em>WiscKey: Separating Keys from Values in SSD-conscious Storage</em></a></p><p>Manos Athanassoulis et al: <a href=\"https://stratos.seas.harvard.edu/files/stratos/files/rum.pdf\"><em>Designing Access Methods: The RUM Conjecture</em></a></p><p>Patrick Oâ€™Neil et al.: <a href=\"https://dsf.berkeley.edu/cs286/papers/lsm-acta1996.pdf\"><em>The Log-Structured Merge-Tree (LSM-Tree)</em></a></p>","neighbors":{"left":{"article_title":"21 | æŸ¥è¯¢æ‰§è¡Œå¼•æ“ï¼šå¦‚ä½•è®©èšåˆè®¡ç®—åŠ é€Ÿï¼Ÿ","id":289971},"right":{"article_title":"23 | æ•°æ®åº“æŸ¥è¯¢ä¸²è®²ï¼šé‡éš¾ç‚¹å›é¡¾+æ€è€ƒé¢˜ç­”ç–‘+çŸ¥è¯†å…¨æ™¯å›¾","id":292334}},"comments":[{"had_liked":false,"id":250859,"user_name":"æ‰©æ•£æ€§ç™¾ä¸‡å’¸é¢åŒ…","can_delete":false,"product_type":"c1","uid":1905171,"ip_address":"","ucode":"6D703D51553B42","user_header":"https://static001.geekbang.org/account/avatar/00/1d/12/13/e103a6e3.jpg","comment_is_top":false,"comment_ctime":1601263122,"is_pvip":false,"replies":[{"id":"91789","content":"è¯´çš„å…¨ä¸­ï¼Œç‚¹èµã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹ç£Š(Ivan)","uid":"1602401","ctime":1601278676,"ip_address":"","comment_id":250859,"utype":1}],"discussion_count":1,"race_medal":0,"score":"35961001490","product_id":100057401,"comment_content":"æ€è€ƒé¢˜ï¼š<br>ä½¿ç”¨Bloom Filterçš„æ”¹é€ ç‰ˆï¼Œç°åœ¨ä¸ç”¨æ¥åˆ¤æ–­æŸä¸ªkeyæ˜¯å¦ä¸å­˜åœ¨ï¼Œè€Œåˆ¤æ–­æŸä¸ªkeyçš„å‰ç¼€æ˜¯å¦ä¸å­˜åœ¨ã€‚æ¯”å¦‚è¯´æˆ‘è¦æŸ¥300-000 åˆ° 300-999çš„åŒºé—´ï¼Œé‚£ä¹ˆä»–ä»¬æ‹¥æœ‰å…±åŒå‰ç¼€300ï¼Œæˆ‘åªè¦åˆ¤æ–­è¿™ä¸ªå‰ç¼€æ˜¯ä¸æ˜¯åœ¨å½“å‰SSTableé‡Œå³å¯ã€‚","like_count":9,"discussions":[{"author":{"id":1602401,"avatar":"https://static001.geekbang.org/account/avatar/00/18/73/61/3059679f.jpg","nickname":"ç‹ç£Š(Ivan)","note":"","ucode":"CF0B955A06FE2A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506314,"discussion_content":"è¯´çš„å…¨ä¸­ï¼Œç‚¹èµã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601278676,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":250868,"user_name":"æœ‰é“­","can_delete":false,"product_type":"c1","uid":1046302,"ip_address":"","ucode":"2C7CB36CA5C04C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/3XbCueYYVWTiclv8T5tFpwiblOxLphvSZxL4ujMdqVMibZnOiaFK2C5nKRGv407iaAsrI0CDICYVQJtiaITzkjfjbvrQ/132","comment_is_top":false,"comment_ctime":1601265754,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14486167642","product_id":100057401,"comment_content":"ä¸ºä»€ä¹ˆRUMæ˜¯ä¸ªçŒœæƒ³è€Œä¸æ˜¯ä¸ªå®šè®ºå‘¢ï¼Ÿè¿™ä¸œè¥¿ç¬¬ä¸€çœ¼çœ‹ä¸Šå»å¥½åƒCAPç†è®ºï¼Œä¸è¿‡CAPå·²ç»è¢«è¯æ˜äº†","like_count":4},{"had_liked":false,"id":250860,"user_name":"Jxin","can_delete":false,"product_type":"c1","uid":1251111,"ip_address":"","ucode":"4C03928388C413","user_header":"https://static001.geekbang.org/account/avatar/00/13/17/27/ec30d30a.jpg","comment_is_top":false,"comment_ctime":1601263385,"is_pvip":false,"replies":[{"id":"91779","content":"å—¯ï¼Œè°¢è°¢ï¼Œä½ çš„å»ºè®®å¾ˆä¸­è‚¯ã€‚å› ä¸ºè¿™ä¸ªä¸“æ æ˜¯ä¸­ç«‹è§†è§’ï¼Œå¸Œæœ›è·³å‡ºæŸä¸ªå…·ä½“çš„äº§å“ï¼Œè®²ä¸€äº›å…±æ€§çš„ã€åŸç†å±‚é¢çš„ç ”ç©¶è¿›å±•ï¼Œç„¶åé€‰æ‹©æœ‰ä»£è¡¨æ€§çš„äº§å“åšä¸€äº›æ˜ å°„ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ‰€æœ‰çš„å†…å®¹å°±ä¸èƒ½ä¸æŸä¸€æ¬¾äº§å“å®Œå…¨åŒ¹é…ï¼Œä¼šæœ‰äº›æŠ½è±¡ï¼Œä½†æˆ‘ç›¸ä¿¡åé¢ä¸€å®šä¼šæœ‰æ›´å¤šåˆ†å¸ƒå¼æ•°æ®åº“çš„è¯¾ç¨‹ä½œä¸ºè¡¥å……ï¼Œåšåˆ°è™šå®ç»“åˆã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹ç£Š(Ivan)","uid":"1602401","ctime":1601268650,"ip_address":"","comment_id":250860,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10191197977","product_id":100057401,"comment_content":"è¯¾åé¢˜ï¼š<br>è¿™æ ·é—®ï¼Œé‚£å°±ä¸€å®šæ˜¯å¯ä»¥äº†ã€‚ä½†å¾ˆé—æ†¾ï¼Œèƒ½åŠ›æœ‰é™æƒ³ä¸åˆ°ã€‚scanäº†çš„è¯ï¼Œå¦‚æœæ˜¯å¸¸è§„çš„è¡Œå¼å­˜å‚¨,bfèµ·ä¸åˆ°ä½œç”¨ï¼Œæ¯•ç«Ÿè¾¹ç•Œä¸å­˜åœ¨ä¸ç­‰äºè¾¹ç•Œå†…éƒ¨ä¸å­˜åœ¨ã€‚<br><br>22è®²ä¸‹æ¥çš„æ„Ÿè§‰:<br>æœ‰ç§æ­å»ºç©ºä¸­æ¥¼é˜çš„æ„Ÿè§‰,è´¹åŠ›è¿˜å®¹æ˜“å¿˜ã€‚è¿™ç¯‡ä¸“æ å‰è¾¹,å…¶å®æœ€å¥½æœ‰ç¯‡å®æˆ˜åšé“ºå«,æ¯”å¦‚tidbã€‚ä¸¤ç›¸éªŒè¯è™šå®ç»“åˆæ‰èƒ½å­¦å¾—æ‰å®ã€‚","like_count":2,"discussions":[{"author":{"id":1602401,"avatar":"https://static001.geekbang.org/account/avatar/00/18/73/61/3059679f.jpg","nickname":"ç‹ç£Š(Ivan)","note":"","ucode":"CF0B955A06FE2A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506315,"discussion_content":"å—¯ï¼Œè°¢è°¢ï¼Œä½ çš„å»ºè®®å¾ˆä¸­è‚¯ã€‚å› ä¸ºè¿™ä¸ªä¸“æ æ˜¯ä¸­ç«‹è§†è§’ï¼Œå¸Œæœ›è·³å‡ºæŸä¸ªå…·ä½“çš„äº§å“ï¼Œè®²ä¸€äº›å…±æ€§çš„ã€åŸç†å±‚é¢çš„ç ”ç©¶è¿›å±•ï¼Œç„¶åé€‰æ‹©æœ‰ä»£è¡¨æ€§çš„äº§å“åšä¸€äº›æ˜ å°„ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ‰€æœ‰çš„å†…å®¹å°±ä¸èƒ½ä¸æŸä¸€æ¬¾äº§å“å®Œå…¨åŒ¹é…ï¼Œä¼šæœ‰äº›æŠ½è±¡ï¼Œä½†æˆ‘ç›¸ä¿¡åé¢ä¸€å®šä¼šæœ‰æ›´å¤šåˆ†å¸ƒå¼æ•°æ®åº“çš„è¯¾ç¨‹ä½œä¸ºè¡¥å……ï¼Œåšåˆ°è™šå®ç»“åˆã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601268650,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1224750,"avatar":"","nickname":"paul","note":"","ucode":"E20BE3E0892A9D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1602401,"avatar":"https://static001.geekbang.org/account/avatar/00/18/73/61/3059679f.jpg","nickname":"ç‹ç£Š(Ivan)","note":"","ucode":"CF0B955A06FE2A","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":590204,"discussion_content":"ç‰¹åˆ«å–œæ¬¢æ‚¨è¿™ç§è®²æˆé£æ ¼ï¼Œå¦‚æœé™äºå…·ä½“çš„äº§å“å®æˆ˜å°±å¤ªå±€é™äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665615667,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":506315,"ip_address":"æ±Ÿè‹"},"score":590204,"extra":""}]}]},{"had_liked":false,"id":275568,"user_name":"James","can_delete":false,"product_type":"c1","uid":1036309,"ip_address":"","ucode":"7A0DC75746CB3A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d0/15/c5dc2b0d.jpg","comment_is_top":false,"comment_ctime":1611585781,"is_pvip":false,"replies":[{"id":"100022","content":"ä»L1å¼€å§‹ï¼Œæ¯å±‚çš„SSTableçš„Keyå€¼èŒƒå›´æ˜¯ä¸é‡å çš„ã€‚æ‰€ä»¥ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šæ¯æ¬¡é€šè¿‡æ–‡ä»¶çš„åŒºé—´ä¿¡æ¯é”å®šä¸€ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯å½“å‰Keyæ‰€åœ¨çš„åŒºé—´ï¼Œç„¶ååœ¨æ–‡ä»¶å†…éƒ¨æŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰å¯¹åº”çš„æ•°æ®åˆ™ç»§ç»­å‘L2å±‚æŸ¥æ‰¾ï¼Œå¦‚æ­¤é€å±‚å‘ä¸‹ï¼Œæœ€ç»ˆæ‰¾åˆ°Keyçš„å¯¹åº”é”®å€¼å¯¹ï¼Œæˆ–è€…ç¡®å®šä¸å­˜åœ¨å¯¹åº”æ•°æ®ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹ç£Š(Ivan)","uid":"1602401","ctime":1611625000,"ip_address":"","comment_id":275568,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5906553077","product_id":100057401,"comment_content":"æƒ³é—®ä¸‹è€å¸ˆï¼Œå°±æ˜¯æˆ‘æŸ¥ä¸€ä¸ªé”®å€¼å¯¹çš„æ—¶å€™ï¼Œå¯¹äºL1 å¾€åçš„å±‚çº§æˆ‘æ˜¯æ€ä¹ˆæ‰¾åˆ°å¯¹åº”çš„keyçš„ï¼Œæˆ‘çœ‹å›¾ä¸­ç”»çš„æ˜¯å¾ˆå¤šä¸ªåŒºé—´ï¼Œæ˜¯å»é¡ºåºéå†ä¸€éè¿™äº›åŒºé—´ï¼Œç„¶åå»å¯¹åº”çš„åŒºé—´æ‰¾å…ƒç´ å—ï¼ˆåœ¨åŒºé—´å†…æ˜¯é€šè¿‡è°ƒè¡¨ç®—æ³•æ¥æ‰¾å…ƒç´ çš„ï¼‰ï¼Œè¿˜æ˜¯è¯´ç”¨äºŒåˆ†æ³•è¿™ç±»çš„ç®—æ³•æ¥æ‰¾åˆ°æ˜¯å“ªä¸ªåŒºé—´å‘¢ã€‚PS:è¿™ä¸ªåŒºé—´æ˜¯å¯ä»¥ä¸è¿ç»­çš„å§ï¼ˆåªè¦ä¸é‡åˆå°±è¡Œï¼‰,æ¯”å¦‚[a,b) [e,f]<br>","like_count":1,"discussions":[{"author":{"id":1602401,"avatar":"https://static001.geekbang.org/account/avatar/00/18/73/61/3059679f.jpg","nickname":"ç‹ç£Š(Ivan)","note":"","ucode":"CF0B955A06FE2A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514399,"discussion_content":"ä»L1å¼€å§‹ï¼Œæ¯å±‚çš„SSTableçš„Keyå€¼èŒƒå›´æ˜¯ä¸é‡å çš„ã€‚æ‰€ä»¥ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šæ¯æ¬¡é€šè¿‡æ–‡ä»¶çš„åŒºé—´ä¿¡æ¯é”å®šä¸€ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯å½“å‰Keyæ‰€åœ¨çš„åŒºé—´ï¼Œç„¶ååœ¨æ–‡ä»¶å†…éƒ¨æŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰å¯¹åº”çš„æ•°æ®åˆ™ç»§ç»­å‘L2å±‚æŸ¥æ‰¾ï¼Œå¦‚æ­¤é€å±‚å‘ä¸‹ï¼Œæœ€ç»ˆæ‰¾åˆ°Keyçš„å¯¹åº”é”®å€¼å¯¹ï¼Œæˆ–è€…ç¡®å®šä¸å­˜åœ¨å¯¹åº”æ•°æ®ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611625000,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1036309,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/d0/15/c5dc2b0d.jpg","nickname":"James","note":"","ucode":"7A0DC75746CB3A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344910,"discussion_content":"å—¯å—¯ æˆ‘æƒ³çŸ¥é“ä»–æ˜¯å¦‚ä½•é”å®šä»–æ˜¯åœ¨å“ªä¸ªåŒºé—´çš„ï¼Œä¸€å±‚æœ‰å¤šä¸ªåŒºé—´ï¼Œæ˜¯æ ¹æ®å“åº”çš„æ¯”è¾ƒç®—æ³•ä¸€ä¸ªåŒºé—´ä¸€ä¸ªåŒºé—´çš„å»æ¯”è¾ƒåŒºé—´å·¦å³çš„å€¼å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611625450,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":250981,"user_name":"licl1008","can_delete":false,"product_type":"c1","uid":1265135,"ip_address":"","ucode":"6467D6DB97A00A","user_header":"","comment_is_top":false,"comment_ctime":1601297403,"is_pvip":false,"replies":[{"id":"92752","content":"å†™å…¥åŒæ ·æ•°æ®ï¼Œç©ºé—´å ç”¨ä¹Ÿä¼šæœ‰åŒºåˆ«ã€‚è¿™ä¸»è¦å’Œå¢é‡æ•°æ®çš„å­˜å‚¨æ¨¡å¼æœ‰å…³ï¼Œæ¯”å¦‚ç›´æ¥updateç©ºé—´å°±å°äº›ï¼Œè€Œè½¬æ¢ä¸ºdeleteåŠ insertç©ºé—´å°±å¤§äº›ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹ç£Š(Ivan)","uid":"1602401","ctime":1602992252,"ip_address":"","comment_id":250981,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5896264699","product_id":100057401,"comment_content":"æƒ³é—®ä¸€ä¸‹ å†™æ”¾å¤§å’Œç©ºé—´æ”¾å¤§å…·ä½“æœ‰å•¥åŒºåˆ« å†™å¾—å¤šäº†ä¸æ˜¯ç£ç›˜ç©ºé—´å°±å ç”¨æ›´å¤šäº†å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1602401,"avatar":"https://static001.geekbang.org/account/avatar/00/18/73/61/3059679f.jpg","nickname":"ç‹ç£Š(Ivan)","note":"","ucode":"CF0B955A06FE2A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506354,"discussion_content":"å†™å…¥åŒæ ·æ•°æ®ï¼Œç©ºé—´å ç”¨ä¹Ÿä¼šæœ‰åŒºåˆ«ã€‚è¿™ä¸»è¦å’Œå¢é‡æ•°æ®çš„å­˜å‚¨æ¨¡å¼æœ‰å…³ï¼Œæ¯”å¦‚ç›´æ¥updateç©ºé—´å°±å°äº›ï¼Œè€Œè½¬æ¢ä¸ºdeleteåŠ insertç©ºé—´å°±å¤§äº›ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602992252,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":250963,"user_name":"piboye","can_delete":false,"product_type":"c1","uid":1066752,"ip_address":"","ucode":"7CFD8712857A85","user_header":"https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg","comment_is_top":false,"comment_ctime":1601292225,"is_pvip":true,"replies":[{"id":"91811","content":"é¦–å…ˆèŒƒå›´æŸ¥è¯¢å¯èƒ½æ˜¯æ— æ³•ç©·ä¸¾çš„ï¼Œä¾‹å¦‚å¯¹æµ®ç‚¹æ•°çš„èŒƒå›´æŸ¥è¯¢ã€‚å¦å¤–å³ä½¿å¯ä»¥ç©·ä¸¾ï¼Œæ¯ä¸ªéƒ½æŸ¥çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯O(N)äº†ï¼Œè€Œç£ç›˜æ–‡ä»¶æ˜¯æœ‰åºçš„ï¼ŒåŠ ä¸Šç£ç›˜ä¼šåšé¢„å–ï¼Œå¯èƒ½è¿˜æ˜¯ç£ç›˜å¿«äº›ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹ç£Š(Ivan)","uid":"1602401","ctime":1601300828,"ip_address":"","comment_id":250963,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5896259521","product_id":100057401,"comment_content":"å³ä½¿ä¸æ˜¯å‰ç¼€ç›¸åŒï¼ŒèŒƒå›´æŸ¥è¯¢ä¹Ÿå¯ä»¥ä¸€ä¸ªä¸€ä¸ªkeyå»å°è¯•ï¼Œbfæ˜¯å†…å­˜æ“ä½œï¼Œè¿˜æ˜¯æ¯”ç£ç›˜å¿«å§","like_count":1,"discussions":[{"author":{"id":1602401,"avatar":"https://static001.geekbang.org/account/avatar/00/18/73/61/3059679f.jpg","nickname":"ç‹ç£Š(Ivan)","note":"","ucode":"CF0B955A06FE2A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506347,"discussion_content":"é¦–å…ˆèŒƒå›´æŸ¥è¯¢å¯èƒ½æ˜¯æ— æ³•ç©·ä¸¾çš„ï¼Œä¾‹å¦‚å¯¹æµ®ç‚¹æ•°çš„èŒƒå›´æŸ¥è¯¢ã€‚å¦å¤–å³ä½¿å¯ä»¥ç©·ä¸¾ï¼Œæ¯ä¸ªéƒ½æŸ¥çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯O(N)äº†ï¼Œè€Œç£ç›˜æ–‡ä»¶æ˜¯æœ‰åºçš„ï¼ŒåŠ ä¸Šç£ç›˜ä¼šåšé¢„å–ï¼Œå¯èƒ½è¿˜æ˜¯ç£ç›˜å¿«äº›ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601300828,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":292394,"user_name":"sanstyle","can_delete":false,"product_type":"c1","uid":1236868,"ip_address":"","ucode":"B24B199668742E","user_header":"https://static001.geekbang.org/account/avatar/00/12/df/84/28b633bd.jpg","comment_is_top":false,"comment_ctime":1620804483,"is_pvip":false,"replies":[{"id":"106008","content":"å°±æ˜¯åœ¨æ•°æ®èªŠå†™ï¼ˆä¹Ÿå°±æ˜¯compactï¼‰çš„è¿‡ç¨‹ä¸­ï¼Œæ§åˆ¶æ¯ä¸ªæ–‡ä»¶å†™å…¥çš„æ•°æ®ä¸è¾¹ç•Œç›¸ç¬¦ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹ç£Š(Ivan)","uid":"1602401","ctime":1620993568,"ip_address":"","comment_id":292394,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1620804483","product_id":100057401,"comment_content":"L0 ä¸­çš„ key æ˜¯äº¤å‰çš„ï¼Œæ‰€ä»¥è¯»å– L0 çš„æ‰€æœ‰ SSTable å†™å…¥ L1ï¼Œæ¥ä¿è¯ L1 å¼€å§‹çš„ SSTable éƒ½æ˜¯ key ä¸é‡å çš„ã€‚<br>åœ¨ L1 åˆ’åˆ†è¾¹ç•Œçš„æ—¶å€™ï¼Œ[e, k) é‡Œé¢æ˜¯æœ‰äº¤å‰ key çš„ï¼Œé‡æ–°åˆ’åˆ†ä¸º [e, f), [f, k)ï¼Œæ€ä¹ˆä¿è¯è¿™ä¸¤ä¸ª SSTable ä¸äº¤å‰ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1602401,"avatar":"https://static001.geekbang.org/account/avatar/00/18/73/61/3059679f.jpg","nickname":"ç‹ç£Š(Ivan)","note":"","ucode":"CF0B955A06FE2A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519811,"discussion_content":"å°±æ˜¯åœ¨æ•°æ®èªŠå†™ï¼ˆä¹Ÿå°±æ˜¯compactï¼‰çš„è¿‡ç¨‹ä¸­ï¼Œæ§åˆ¶æ¯ä¸ªæ–‡ä»¶å†™å…¥çš„æ•°æ®ä¸è¾¹ç•Œç›¸ç¬¦ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620993568,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":289962,"user_name":"Jackson","can_delete":false,"product_type":"c1","uid":1061404,"ip_address":"","ucode":"FD22D39510CF8C","user_header":"https://static001.geekbang.org/account/avatar/00/10/32/1c/3e3cdad2.jpg","comment_is_top":false,"comment_ctime":1619278615,"is_pvip":false,"replies":[{"id":"105208","content":"åº”è¯¥æ˜¯Rocksdbï¼Œçœ‹å¾—å¾ˆä»”ç»†","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹ç£Š(Ivan)","uid":"1602401","ctime":1619481862,"ip_address":"","comment_id":289962,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1619278615","product_id":100057401,"comment_content":"CockroachDB ä¹Ÿæ¨å‡ºäº†è‡ªå·±çš„å­˜å‚¨å¼•æ“ Pebbleï¼Œä¸»è¦ç›®çš„æ˜¯è§£å†³å·¥ç¨‹é—®é¢˜ï¼ŒåŒ…æ‹¬è§£å†³ CGo barrier é—®é¢˜å’Œé¿å… Rust åŠŸèƒ½è†¨èƒ€å¸¦æ¥çš„å˜æ›´é£é™©ã€‚â€”â€” Ruståº”è¯¥æ˜¯Rocksdbå§ï¼Ÿç¬”è¯¯ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1602401,"avatar":"https://static001.geekbang.org/account/avatar/00/18/73/61/3059679f.jpg","nickname":"ç‹ç£Š(Ivan)","note":"","ucode":"CF0B955A06FE2A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519068,"discussion_content":"åº”è¯¥æ˜¯Rocksdbï¼Œçœ‹å¾—å¾ˆä»”ç»†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619481862,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":286000,"user_name":"è¾¹åŸè·¯è¿œ","can_delete":false,"product_type":"c1","uid":1286741,"ip_address":"","ucode":"214ECD8981E87F","user_header":"https://static001.geekbang.org/account/avatar/00/13/a2/55/1092ebb8.jpg","comment_is_top":false,"comment_ctime":1617098613,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617098613","product_id":100057401,"comment_content":"è€å¸ˆï¼Œæœ‰ä¸ªåœ°æ–¹æœ‰ç‚¹é—®é¢˜ï¼Œåº”è¯¥æ˜¯&quot;Delta Tree é‡‡ç”¨äº†ç±»ä¼¼ B+ Tree çš„ç»“æ„&quot;","like_count":0},{"had_liked":false,"id":276528,"user_name":"wy","can_delete":false,"product_type":"c1","uid":1064681,"ip_address":"","ucode":"41C1B304E7F032","user_header":"https://static001.geekbang.org/account/avatar/00/10/3e/e9/116f1dee.jpg","comment_is_top":false,"comment_ctime":1611990291,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1611990291","product_id":100057401,"comment_content":"å¦‚æœä»¥åå›ºæ€ç¡¬ç›˜æˆæœ¬é™ä¸‹æ¥ï¼Œéƒ½æ˜¯ç”¨å›ºæ€ç¡¬ç›˜çš„è¯ï¼Œlsmtreeçš„ä½œç”¨æ˜¯ä¸æ˜¯å°±ä¸å¤§äº†","like_count":0},{"had_liked":false,"id":260770,"user_name":"kylexy_0817","can_delete":false,"product_type":"c1","uid":1068372,"ip_address":"","ucode":"392DD9DD5E4B6E","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/54/9c214885.jpg","comment_is_top":false,"comment_ctime":1605102463,"is_pvip":false,"replies":[{"id":"94742","content":"ï¼šï¼‰","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹ç£Š(Ivan)","uid":"1602401","ctime":1605159672,"ip_address":"","comment_id":260770,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1605102463","product_id":100057401,"comment_content":"NewSQLçš„å­˜å‚¨æ•°æ®ç»“æ„å’Œç­–ç•¥å’ŒESçš„ååˆ†ç›¸ä¼¼ã€‚ESç¡®å®ä¸æ˜¯æ•°æ®åº“ï¼Œå®ƒä¸å…·å¤‡æ•°æ®åº“åº”æœ‰çš„ç‰¹æ€§ï¼Œä¾‹å¦‚äº‹åŠ¡ç­‰ã€‚ä¹‹å‰çš„ç•™è¨€ä¸ä¸¥è°¨ğŸ˜„","like_count":0,"discussions":[{"author":{"id":1602401,"avatar":"https://static001.geekbang.org/account/avatar/00/18/73/61/3059679f.jpg","nickname":"ç‹ç£Š(Ivan)","note":"","ucode":"CF0B955A06FE2A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":509285,"discussion_content":"ï¼šï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605159672,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":250967,"user_name":"piboye","can_delete":false,"product_type":"c1","uid":1066752,"ip_address":"","ucode":"7CFD8712857A85","user_header":"https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg","comment_is_top":false,"comment_ctime":1601292790,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1601292790","product_id":100057401,"comment_content":"lsmæœ€æ ¸å¿ƒçš„æ˜¯é¡ºåºå†™ç‰¹æ€§ï¼Œå³ä½¿å†™æ”¾å¤§å’Œb+ä¸€æ ·å¤§ï¼Œå› ä¸ºé¡ºåºå†™æ¯”éšæœºå†™è¿˜æ˜¯å¿«å¾ˆå¤šã€‚å†™æ”¾å¤§å’Œç©ºé—´æ”¾å¤§æ¯”è¾ƒå½±å“ssdçš„å¯¿å‘½ã€‚","like_count":0},{"had_liked":false,"id":250866,"user_name":"å¯æ€œå¤§ç°ç‹¼","can_delete":false,"product_type":"c1","uid":1928373,"ip_address":"","ucode":"6CA9D6D460B967","user_header":"https://static001.geekbang.org/account/avatar/00/1d/6c/b5/32374f93.jpg","comment_is_top":false,"comment_ctime":1601265218,"is_pvip":true,"replies":[{"id":"91788","content":"è¯´çš„å¾ˆå¥½ï¼Œç‚¹èµã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹ç£Š(Ivan)","uid":"1602401","ctime":1601278655,"ip_address":"","comment_id":250866,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1601265218","product_id":100057401,"comment_content":"æ•°æ®å—é‡Œæ˜¯æŒ‰ç…§é¡ºåºå­˜å‚¨äº†å¾ˆå¤šæ¡æ•°æ®ã€‚æˆ‘æƒ³å¯¹æ•°æ®å—å»ºç«‹ä¸€çº§å¸ƒéš†è¿‡æ»¤å™¨å®ä¾‹ï¼Œè¿™æ ·scanå®šä½èµ·å§‹å’Œç»ˆæ­¢å¯¹åº”çš„æ•°æ®å—ï¼Œåº”è¯¥èƒ½æé€Ÿä¸å°‘ã€‚<br>å¦‚æœæŠŠæ•°æ®å—æŒ‰ç…§å¤§å°åˆ†çº§ï¼Œç±»ä¼¼LSMçš„levelå±‚é‚£æ ·ã€‚æ˜¯ä¸æ˜¯ä¼šæ›´å¿«äº›ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1602401,"avatar":"https://static001.geekbang.org/account/avatar/00/18/73/61/3059679f.jpg","nickname":"ç‹ç£Š(Ivan)","note":"","ucode":"CF0B955A06FE2A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506317,"discussion_content":"è¯´çš„å¾ˆå¥½ï¼Œç‚¹èµã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601278655,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}