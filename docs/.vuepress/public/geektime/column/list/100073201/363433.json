{"id":363433,"title":"17 | è§¦å‘å™¨ï¼šå¦‚ä½•è®©æ•°æ®ä¿®æ”¹è‡ªåŠ¨è§¦å‘å…³è”æ“ä½œï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æœ±æ™“å³°ã€‚ä»Šå¤©ï¼Œæˆ‘æ¥å’Œä½ èŠä¸€èŠè§¦å‘å™¨ã€‚</p><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°è¿™æ ·çš„æƒ…å†µï¼šæœ‰2ä¸ªæˆ–è€…å¤šä¸ªç›¸äº’å…³è”çš„è¡¨ï¼Œå¦‚å•†å“ä¿¡æ¯å’Œåº“å­˜ä¿¡æ¯åˆ†åˆ«å­˜æ”¾åœ¨2ä¸ªä¸åŒçš„æ•°æ®è¡¨ä¸­ï¼Œæˆ‘ä»¬åœ¨æ·»åŠ ä¸€æ¡æ–°å•†å“è®°å½•çš„æ—¶å€™ï¼Œä¸ºäº†ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ï¼Œå¿…é¡»åŒæ—¶åœ¨åº“å­˜è¡¨ä¸­æ·»åŠ ä¸€æ¡åº“å­˜è®°å½•ã€‚</p><p>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±å¿…é¡»æŠŠè¿™ä¸¤ä¸ªå…³è”çš„æ“ä½œæ­¥éª¤å†™åˆ°ç¨‹åºé‡Œé¢ï¼Œè€Œä¸”è¦ç”¨äº‹åŠ¡åŒ…è£¹èµ·æ¥ï¼Œç¡®ä¿è¿™ä¸¤ä¸ªæ“ä½œæˆä¸ºä¸€ä¸ªåŸå­æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œã€‚è¦æ˜¯é‡åˆ°ç‰¹æ®Šæƒ…å†µï¼Œå¯èƒ½è¿˜éœ€è¦å¯¹æ•°æ®è¿›è¡Œæ‰‹åŠ¨ç»´æŠ¤ï¼Œè¿™æ ·å°±å¾ˆå®¹æ˜“å¿˜è®°å…¶ä¸­çš„ä¸€æ­¥ï¼Œå¯¼è‡´æ•°æ®ç¼ºå¤±ã€‚</p><p>è¿™ä¸ªæ—¶å€™ï¼Œå…¶å®å’±ä»¬å¯ä»¥ä½¿ç”¨è§¦å‘å™¨ã€‚ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªè§¦å‘å™¨ï¼Œè®©å•†å“ä¿¡æ¯æ•°æ®çš„æ’å…¥æ“ä½œè‡ªåŠ¨è§¦å‘åº“å­˜æ•°æ®çš„æ’å…¥æ“ä½œã€‚è¿™æ ·ä¸€æ¥ï¼Œå°±ä¸ç”¨æ‹…å¿ƒå› ä¸ºå¿˜è®°æ·»åŠ åº“å­˜æ•°æ®è€Œå¯¼è‡´çš„æ•°æ®ç¼ºå¤±äº†ã€‚</p><p>å¬ä¸Šå»å¥½åƒå¾ˆä¸é”™ï¼Œé‚£è§¦å‘å™¨åˆ°åº•æ€ä¹ˆä½¿ç”¨å‘¢ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘å°±é‡ç‚¹ç»™ä½ èŠèŠã€‚æˆ‘ä¼šå…ˆç»™ä½ è®²è§£åˆ›å»ºã€æŸ¥çœ‹å’Œåˆ é™¤è§¦å‘å™¨çš„å…·ä½“æ“ä½œï¼Œç„¶åå€ŸåŠ©ä¸€ä¸ªæ¡ˆä¾‹å¸¦ä½ å®æˆ˜ä¸€ä¸‹ã€‚</p><h2>å¦‚ä½•æ“ä½œè§¦å‘å™¨ï¼Ÿ</h2><p>é¦–å…ˆï¼Œå’±ä»¬æ¥å­¦ä¹ ä¸‹è§¦å‘å™¨çš„åŸºæœ¬æ“ä½œã€‚</p><h3>åˆ›å»ºè§¦å‘å™¨</h3><p>åˆ›å»ºè§¦å‘å™¨çš„è¯­æ³•ç»“æ„æ˜¯ï¼š</p><pre><code>CREATE TRIGGER è§¦å‘å™¨åç§° {BEFORE|AFTER} {INSERT|UPDATE|DELETE}\nON è¡¨å FOR EACH ROW è¡¨è¾¾å¼ï¼›\n</code></pre><p>åœ¨åˆ›å»ºæ—¶ï¼Œä½ ä¸€å®šè¦æ³¨æ„è§¦å‘å™¨çš„ä¸‰ä¸ªè¦ç´ ã€‚</p><ul>\n<li>è¡¨åï¼šè¡¨ç¤ºè§¦å‘å™¨ç›‘æ§çš„å¯¹è±¡ã€‚</li>\n<li>INSERT|UPDATE|DELETEï¼šè¡¨ç¤ºè§¦å‘çš„äº‹ä»¶ã€‚INSERTè¡¨ç¤ºæ’å…¥è®°å½•æ—¶è§¦å‘ï¼›UPDATEè¡¨ç¤ºæ›´æ–°è®°å½•æ—¶è§¦å‘ï¼›DELETEè¡¨ç¤ºåˆ é™¤è®°å½•æ—¶è§¦å‘ã€‚</li>\n<li>BEFORE|AFTERï¼šè¡¨ç¤ºè§¦å‘çš„æ—¶é—´ã€‚BEFOREè¡¨ç¤ºåœ¨äº‹ä»¶ä¹‹å‰è§¦å‘ï¼›AFTERè¡¨ç¤ºåœ¨äº‹ä»¶ä¹‹åè§¦å‘ã€‚</li>\n</ul><!-- [[[read_end]]] --><p>åªæœ‰æŠŠè¿™ä¸‰ä¸ªè¦ç´ å®šä¹‰å¥½ï¼Œæ‰èƒ½æ­£ç¡®ä½¿ç”¨è§¦å‘å™¨ã€‚</p><p>åˆ›å»ºå¥½è§¦å‘å™¨ä¹‹åï¼Œå’±ä»¬è¿˜è¦çŸ¥é“è§¦å‘å™¨æ˜¯ä¸æ˜¯åˆ›å»ºæˆåŠŸäº†ã€‚æ€ä¹ˆæŸ¥çœ‹å‘¢ï¼Ÿæˆ‘æ¥ä»‹ç»ä¸‹ã€‚</p><h3>æŸ¥çœ‹è§¦å‘å™¨</h3><p>æŸ¥çœ‹è§¦å‘å™¨çš„è¯­å¥æ˜¯ï¼š</p><pre><code>SHOW TRIGGERS\\G;\n</code></pre><h3>åˆ é™¤è§¦å‘å™¨</h3><p>åˆ é™¤è§¦å‘å™¨å¾ˆç®€å•ï¼Œä½ åªè¦çŸ¥é“è¯­æ³•ç»“æ„å°±å¯ä»¥äº†ï¼š</p><pre><code>DROP TRIGGER è§¦å‘å™¨åç§°;\n</code></pre><p>çŸ¥é“äº†è§¦å‘å™¨çš„æ“ä½œæ–¹æ³•ï¼Œæ¥ä¸‹æ¥å’±ä»¬å°±å€ŸåŠ©è¶…å¸‚é¡¹ç›®çš„å®é™…æ¡ˆä¾‹ï¼Œåœ¨çœŸå®çš„åœºæ™¯ä¸­å®æˆ˜ä¸€ä¸‹ï¼Œæ¯•ç«Ÿï¼Œå®æˆ˜æ˜¯æŒæ¡æ“ä½œçš„æœ€å¥½æ–¹æ³•ã€‚</p><h2>æ¡ˆä¾‹è®²è§£</h2><p>è¶…å¸‚é¡¹ç›®å®é™…å®æ–½è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç»å¸¸è¦æŸ¥è¯¢å‚¨å€¼ä½™é¢å˜åŠ¨çš„æ˜ç»†ï¼Œä½†æ˜¯ï¼ŒæŸ¥è¯¢ä¼šå‘˜æ¶ˆè´¹æµæ°´æ—¶ï¼Œå­˜åœ¨æ•°æ®æ±‡æ€»ä¸åŠæ—¶ã€æŸ¥è¯¢é€Ÿåº¦æ¯”è¾ƒæ…¢çš„é—®é¢˜ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å°±æƒ³åˆ°ç”¨è§¦å‘å™¨ï¼ŒåŠæ—¶æŠŠä¼šå‘˜å‚¨å€¼é‡‘é¢çš„å˜åŒ–ä¿¡æ¯è®°å½•åˆ°ä¸€ä¸ªä¸“é—¨çš„è¡¨ä¸­ã€‚</p><p>æˆ‘å…ˆç”¨å’±ä»¬ç†Ÿæ‚‰çš„SQLè¯­å¥æ¥å®ç°è®°å½•å‚¨å€¼é‡‘é¢å˜åŠ¨çš„æ“ä½œï¼Œåé¢å†å¸¦ä½ ä½¿ç”¨è§¦å‘å™¨æ¥æ“ä½œã€‚é€šè¿‡ä¸¤ç§æ“ä½œçš„å¯¹æ¯”ï¼Œä½ å°±èƒ½æ›´å¥½åœ°ç†è§£ï¼Œåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ï¼Œè§¦å‘å™¨èƒ½å¤Ÿæ¯”æ™®é€šçš„SQLè¯­å¥æ›´åŠ ç®€æ´é«˜æ•ˆï¼Œä»è€Œå¸®åŠ©ä½ ç”¨å¥½è§¦å‘å™¨è¿™ä¸ªå·¥å…·ï¼Œæé«˜å¼€å‘çš„èƒ½åŠ›ã€‚</p><p>ä¸‹é¢æˆ‘å°±å€ŸåŠ©å…·ä½“æ•°æ®ï¼Œæ¥è¯¦ç»†è¯´æ˜ä¸€ä¸‹ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¼šå‘˜ä¿¡æ¯è¡¨ï¼ˆdemo.membermasterï¼‰å’Œä¼šå‘˜å‚¨å€¼å†å²è¡¨ï¼ˆdemo.deposithistï¼‰ã€‚</p><p>ä¼šå‘˜ä¿¡æ¯è¡¨ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/26/34/26166082e21c2cbd38e4c21d03e76734.jpeg?wh=1725*608\" alt=\"\"></p><p>ä¼šå‘˜å‚¨å€¼å†å²è¡¨ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/f0/c5/f0b59f65801543af6c52b208c71925c5.jpeg?wh=1591*384\" alt=\"\"></p><p>å‡å¦‚åœ¨2020å¹´12æœˆ20æ—¥è¿™ä¸€å¤©ï¼Œä¼šå‘˜ç¼–å·æ˜¯2çš„ä¼šå‘˜æå››ï¼Œåˆ°è¶…å¸‚çš„æŸå®¶è¿é”åº—è´­ä¹°äº†ä¸€æ¡çƒŸï¼Œæ¶ˆè´¹äº†150å…ƒã€‚ç°åœ¨ï¼Œæˆ‘ä»¬ç”¨ä¹‹å‰å­¦è¿‡çš„SQLè¯­å¥ï¼ŒæŠŠè¿™ä¸ªä¼šå‘˜å‚¨å€¼ä½™é¢çš„å˜åŠ¨æƒ…å†µè®°å½•åˆ°ä¼šå‘˜å‚¨å€¼å†å²è¡¨ä¸­ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼ŒæŸ¥è¯¢å‡ºç¼–å·æ˜¯2çš„ä¼šå‘˜å¡çš„å‚¨å€¼é‡‘é¢æ˜¯å¤šå°‘ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç æ¥å®ç°ï¼š</p><pre><code>mysql&gt; SELECT memberdeposit\n-&gt; FROM demo.membermaster\n-&gt; WHERE memberid = 2;\n+---------------+\n| memberdeposit |\n+---------------+\n| 200.00 |\n+---------------+\n1 row in set (0.00 sec)\n</code></pre><p>ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬æŠŠä¼šå‘˜ç¼–å·æ˜¯2çš„ä¼šå‘˜çš„å‚¨å€¼é‡‘é¢å‡å»150ã€‚</p><pre><code>mysql&gt; UPDATE demo.membermaster\n-&gt; SET memberdeposit = memberdeposit - 150\n-&gt; WHERE memberid = 2;\nQuery OK, 1 row affected (0.01 sec)\nRows matched: 1 Changed: 1 Warnings: 0\n</code></pre><p>ç¬¬ä¸‰æ­¥ï¼Œè¯»å‡ºä¼šå‘˜ç¼–å·æ˜¯2çš„ä¼šå‘˜å½“å‰çš„å‚¨å€¼é‡‘é¢ã€‚</p><pre><code>mysql&gt; SELECT memberdeposit\n-&gt; FROM demo.membermaster\n-&gt; WHERE memberid = 2;\n+---------------+\n| memberdeposit |\n+---------------+\n| 50.00 |\n+---------------+\n1 row in set (0.00 sec)\n</code></pre><p>ç¬¬å››æ­¥ï¼ŒæŠŠä¼šå‘˜ç¼–å·å’Œå‰é¢æŸ¥è¯¢ä¸­è·å¾—çš„å‚¨å€¼èµ·å§‹é‡‘é¢ã€å‚¨å€¼ä½™é¢å’Œå‚¨å€¼é‡‘é¢å˜åŒ–å€¼ï¼Œå†™å…¥ä¼šå‘˜å‚¨å€¼å†å²è¡¨ã€‚</p><pre><code>mysql&gt; INSERT INTO demo.deposithist\n-&gt; (\n-&gt; memberid,\n-&gt; transdate,\n-&gt; oldvalue,\n-&gt; newvalue,\n-&gt; changedvalue\n-&gt; )\n-&gt; SELECT 2,NOW(),200,50,-150;\nQuery OK, 1 row affected (0.02 sec)\nRecords: 1 Duplicates: 0 Warnings: 0\n</code></pre><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†è®°å½•ä¼šå‘˜å‚¨å€¼é‡‘é¢å˜åŠ¨çš„æ“ä½œã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ¥æŸ¥è¯¢ä¸€ä¸‹è®°å½•çš„ç»“æœï¼š</p><pre><code>mysql&gt; SELECT *\n-&gt; FROM demo.deposithist;\n+----+----------+---------------------+----------+----------+--------------+\n| id | memberid | transdate | oldvalue | newvalue | changedvalue |\n+----+----------+---------------------+----------+----------+--------------+\n| 1 | 2 | 2020-12-20 10:37:51 | 200.00 | 50.00 | -150.00 |\n+----+----------+---------------------+----------+----------+--------------+\n1 row in set (0.00 sec)\n</code></pre><p>ç»“æœæ˜¾ç¤ºï¼Œä¼šå‘˜ç¼–å·æ˜¯2çš„ä¼šå‘˜å¡å‚¨å€¼é‡‘é¢åœ¨2020-12-20 10:37:51æ—¶æœ‰å˜åŠ¨ï¼Œå˜åŠ¨å‰æ˜¯200å…ƒï¼Œå˜åŠ¨åæ˜¯50å…ƒï¼Œå‡å°‘äº†150å…ƒã€‚</p><p>ä½ çœ‹è¿™ä¸ªè®°å½•ä¼šå‘˜å‚¨å€¼é‡‘é¢å˜åŠ¨çš„æ“ä½œéå¸¸å¤æ‚ï¼Œæˆ‘ä»¬ç”¨äº†4æ­¥æ‰å®Œæˆã€‚è€Œä¸”ä¸ºäº†ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ï¼Œæˆ‘ä»¬è¿˜è¦ç”¨äº‹åŠ¡æŠŠè¿™å‡ ä¸ªå…³è”çš„æ“ä½œåŒ…è£¹èµ·æ¥ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæ¶ˆè€—çš„èµ„æºå°±æ¯”è¾ƒå¤šã€‚</p><p>é‚£å¦‚æœç”¨è§¦å‘å™¨æ¥å®ç°ï¼Œæ•ˆæœä¼šæ€æ ·å‘¢ï¼Ÿæˆ‘ä»¬æ¥å®æ“ä¸€ä¸‹ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ•°æ®è¡¨demo.membermasterçš„è§¦å‘å™¨ã€‚æ¯å½“æ›´æ–°è¡¨ä¸­çš„æ•°æ®æ—¶ï¼Œå…ˆè§¦å‘è§¦å‘å™¨ï¼Œå¦‚æœå‘ç°ä¼šå‘˜å‚¨å€¼é‡‘é¢æœ‰å˜åŒ–ï¼Œå°±æŠŠä¼šå‘˜ç¼–å·ä¿¡æ¯ã€æ›´æ–°çš„æ—¶é—´ã€æ›´æ–°å‰çš„å‚¨å€¼é‡‘é¢ã€æ›´æ–°åçš„å‚¨å€¼é‡‘é¢å’Œå˜åŠ¨é‡‘é¢ï¼Œå†™å…¥ä¼šå‘˜å‚¨å€¼å†å²è¡¨ã€‚ç„¶åï¼Œå†æ‰§è¡Œä¼šå‘˜ä¿¡æ¯è¡¨çš„æ›´æ–°æ“ä½œã€‚</p><p>åˆ›å»ºè§¦å‘å™¨çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>DELIMITER //\nCREATE TRIGGER demo.upd_membermaster BEFORE UPDATE  -- åœ¨æ›´æ–°å‰è§¦å‘\nON demo.membermaster\nFOR EACH ROW                              -- è¡¨ç¤ºæ¯æ›´æ–°ä¸€æ¡è®°å½•ï¼Œè§¦å‘ä¸€æ¬¡\nBEGIN                                     -- å¼€å§‹ç¨‹åºä½“\nIF (new.memberdeposit &lt;&gt; old.memberdeposit)  -- å¦‚æœå‚¨å€¼é‡‘é¢æœ‰å˜åŒ–\nTHEN\nINSERT INTO demo.deposithist\n(\nmemberid,\ntransdate,\noldvalue,\nnewvalue,\nchangedvalue\n)\nSELECT\nNEW.memberid,\nNOW(),\nOLD.memberdeposit,                  -- æ›´æ–°å‰çš„å‚¨å€¼é‡‘é¢\nNEW.memberdeposit,                  -- æ›´æ–°åçš„å‚¨å€¼é‡‘é¢\nNEW.memberdeposit-OLD.memberdeposit; -- å‚¨å€¼é‡‘é¢å˜åŒ–å€¼\nEND IF;\nEND\n//\nDELIMITER ;\n</code></pre><p>åˆ›å»ºå®Œæˆä¹‹åï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹è§¦å‘å™¨ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯çœŸçš„åˆ›å»ºæˆåŠŸäº†ï¼š</p><pre><code>mysql&gt; SHOW TRIGGERS \\G;\n*************************** 1. row ***************************\nTrigger: upd_membermaster -- è§¦å‘å™¨åç§°\nEvent: UPDATE -- è§¦å‘çš„äº‹ä»¶\nTable: membermaster -- è¡¨åç§°\nStatement: BEGIN -- è¢«è§¦å‘æ—¶è¦æ‰§è¡Œçš„ç¨‹åºä½“\nIF (new.memberdeposit &lt;&gt; old.memberdeposit) -- å‚¨å€¼é‡‘é¢å˜åŠ¨æ—¶æ’å…¥å†å²å‚¨å€¼è¡¨\nTHEN\nINSERT INTO demo.deposithist\n(\nmemberid,\ntransdate,\noldvalue,\nnewvalue,\nchangedvalue\n)\nSELECT\nNEW.memberid,\nNOW(),\nOLD.memberdeposit,\nNEW.memberdeposit,\nNEW.memberdeposit-OLD.memberdeposit;\nEND IF;\nEND\nTiming: BEFORE\nCreated: 2021-04-03 15:02:48.18\nsql_mode: STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION\nDefiner: root@localhost\ncharacter_set_client: utf8mb4\ncollation_connection: utf8mb4_0900_ai_ci\nDatabase Collation: utf8mb4_0900_ai_ci\n1 row in set (0.00 sec)\n</code></pre><p>ä»ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“è§¦å‘å™¨çš„å…·ä½“ä¿¡æ¯ï¼š</p><ul>\n<li>Triggerè¡¨ç¤ºè§¦å‘å™¨åç§°ï¼Œè¿™é‡Œæ˜¯upd_membermasterï¼›</li>\n<li>Eventè¡¨ç¤ºè§¦å‘äº‹ä»¶ï¼Œè¿™é‡Œæ˜¯UPDATEï¼Œè¡¨ç¤ºæ›´æ–°è§¦å‘ï¼›</li>\n<li>Tableè¡¨ç¤ºå®šä¹‰è§¦å‘å™¨çš„æ•°æ®è¡¨ï¼Œè¿™é‡Œæ˜¯membermasterï¼›</li>\n<li>Statementè¡¨ç¤ºè§¦å‘æ—¶è¦æ‰§è¡Œçš„ç¨‹åºä½“ã€‚</li>\n</ul><p>çœ‹åˆ°è¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¡®è®¤ï¼Œè§¦å‘å™¨åˆ›å»ºæˆåŠŸäº†ã€‚</p><p>åˆ›å»ºæˆåŠŸä»¥åï¼Œæˆ‘ä»¬å°è¯•æ›´æ–°ä¸€ä¸‹ä¼šå‘˜ç¼–å·æ˜¯1çš„ä¼šå‘˜çš„å‚¨å€¼é‡‘é¢ï¼Œè¿™é‡Œå‡è®¾æŠŠä¼šå‘˜1çš„å‚¨å€¼é‡‘é¢å¢åŠ 10å…ƒã€‚ç®€å•è¯´æ˜ä¸€ä¸‹ï¼Œä¼šå‘˜ä¹Ÿå¯ä»¥æŠŠé’±å­˜åˆ°ä¼šå‘˜å¡é‡Œï¼Œéœ€è¦çš„æ—¶å€™è¿›è¡Œæ¶ˆè´¹ï¼Œå¯¹åº”çš„å°±æ˜¯å‚¨å€¼é‡‘é¢çš„å¢åŠ ã€‚</p><p>æˆ‘ä»¬ç”¨ä¸‹é¢çš„ä»£ç æ¥å®Œæˆè¿™ä¸ªæ“ä½œï¼š</p><pre><code>mysql&gt; UPDATE demo.membermaster\n-&gt; SET memberdeposit = memberdeposit + 10\n-&gt; WHERE memberid = 1;\nQuery OK, 1 row affected (0.03 sec)\nRows matched: 1 Changed: 1 Warnings: 0\n</code></pre><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥æŸ¥çœ‹ä¸€ä¸‹ä¼šå‘˜ä¿¡æ¯è¡¨å’Œä¼šå‘˜å‚¨å€¼å†å²è¡¨ï¼š</p><pre><code>mysql&gt; SELECT *\n-&gt; FROM demo.membermaster;\n+----------+----------+------------+---------+-------------+---------------+\n| memberid | cardno | membername | address | phone | memberdeposit |\n+----------+----------+------------+---------+-------------+---------------+\n| 1 | 10000001 | å¼ ä¸‰ | åŒ—äº¬ | 13812345678 | 110.00 |\n| 2 | 10000002 | æå›› | å¤©æ´¥ | 18512345678 | 50.00 |\n+----------+----------+------------+---------+-------------+---------------+\n2 rows in set (0.00 sec)\n \nmysql&gt; SELECT *\n-&gt; FROM demo.deposithist;\n+----+----------+---------------------+----------+----------+--------------+\n| id | memberid | transdate | oldvalue | newvalue | changedvalue |\n+----+----------+---------------------+----------+----------+--------------+\n| 1 | 2 | 2020-12-20 10:37:51 | 200.00 | 50.00 | -150.00 |\n| 2 | 1 | 2020-12-20 11:32:09 | 100.00 | 110.00 | 10.00 |\n+----+----------+---------------------+----------+----------+--------------+\n2 rows in set (0.01 sec)\n</code></pre><p>ç»“æœæ˜¾ç¤ºï¼Œè§¦å‘å™¨æ­£ç¡®åœ°è®°å½•äº†ä¿®æ”¹ä¼šå‘˜å‚¨å€¼é‡‘é¢çš„æ“ä½œã€‚</p><p>å¦‚æœä½ ä¸€ç›´è·Ÿç€æˆ‘è¿›è¡Œæ“ä½œï¼Œåˆ°è¿™é‡Œï¼Œä½ å¯èƒ½ä¼šæœ‰ç–‘é—®ï¼Œåœ¨ä¼šå‘˜å†å²å‚¨å€¼è¡¨ä¸­è®°å½•ä¿®æ”¹ä¼šå‘˜å‚¨å€¼é‡‘é¢çš„æ“ä½œï¼Œå’Œå®é™…ä¿®æ”¹ä¼šå‘˜ä¿¡æ¯è¡¨æ˜¯2ä¸ªæ“ä½œï¼Œæœ‰æ²¡æœ‰å¯èƒ½ä¸€ä¸ªæˆåŠŸï¼Œä¸€ä¸ªå¤±è´¥ï¼Ÿæ¯”å¦‚è¯´ï¼Œè®°å½•ä¿®æ”¹ä¼šå‘˜å‚¨å€¼é‡‘é¢çš„æ“ä½œå¤±è´¥äº†ï¼Œä½†æ˜¯ä¼šå‘˜çš„å‚¨å€¼é‡‘é¢è¢«ä¿®æ”¹äº†ã€‚</p><p>å…¶å®ï¼Œåœ¨MySQLä¸­ï¼Œå¦‚æœè§¦å‘å™¨ä¸­çš„æ“ä½œå¤±è´¥äº†ï¼Œé‚£ä¹ˆè§¦å‘è¿™ä¸ªè§¦å‘å™¨çš„æ•°æ®æ“ä½œä¹Ÿä¼šå¤±è´¥ï¼Œä¸ä¼šå‡ºç°ä¸€ä¸ªæˆåŠŸã€ä¸€ä¸ªå¤±è´¥çš„æƒ…å†µã€‚</p><p>æˆ‘è¿˜æ˜¯å€ŸåŠ©ä¸€ä¸ªä¾‹å­æ¥è§£é‡Šä¸‹ã€‚å‡è®¾æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªè§¦å‘å™¨ï¼Œè¿™ä¸ªè§¦å‘å™¨çš„ç¨‹åºä½“ä¸­çš„SQLè¯­å¥æœ‰è¯¯ï¼Œæ¯”å¦‚å¤šäº†ä¸€ä¸ªå­—æ®µã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè§¦å‘å™¨æ‰§è¡Œä¼šå¤±è´¥ï¼Œå› æ­¤ï¼Œæ•°æ®æ›´æ–°çš„æ“ä½œä¹Ÿä¸ä¼šæ‰§è¡Œã€‚æˆ‘ä»¬ç”¨ä¸‹é¢çš„ä»£ç æ¥éªŒè¯ä¸€ä¸‹ï¼š</p><pre><code>DELIMITER //\nCREATE TRIGGER demo.upd_membermaster BEFORE UPDATE\nON demo.membermaster\nFOR EACH ROW\nBEGIN\nIF (new.memberdeposit &lt;&gt; old.memberdeposit)\nTHEN\nINSERT INTO demo.deposithist\n(\naa, -- ä¸å­˜åœ¨çš„å­—æ®µ\nmemberid,\ntransdate,\noldvalue,\nnewvalue,\nchangedvalue\n)\nSELECT\n1, -- ç»™ä¸å­˜åœ¨çš„å­—æ®µèµ‹å€¼\nNEW.memberid,\nNOW(),\nOLD.memberdeposit,\nNEW.memberdeposit,\nNEW.memberdeposit-OLD.memberdeposit;\nEND IF;\nEND\n//\nDELIMITER ;\n</code></pre><p>ç°åœ¨ï¼Œå‡è®¾æˆ‘ä»¬è¦æŠŠä¼šå‘˜ç¼–å·æ˜¯2çš„ä¼šå‘˜å¡çš„å‚¨å€¼é‡‘é¢æ›´æ–°ä¸º20ï¼š</p><pre><code>mysql&gt; update demo.membermaster set memberdeposit=20 where memberid = 2;\nERROR 1054 (42S22): Unknown column 'aa' in 'field list'\n</code></pre><p>ç³»ç»Ÿæç¤ºï¼šå› ä¸ºå­—æ®µâ€œaaâ€ä¸å­˜åœ¨ï¼Œå¯¼è‡´è§¦å‘å™¨æ‰§è¡Œå¤±è´¥ã€‚ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹ä¼šå‘˜å‚¨å€¼é‡‘é¢æœ‰æ²¡æœ‰è¢«ä¿®æ”¹ï¼š</p><pre><code>mysql&gt; select * from demo.membermaster;\n+----------+----------+------------+---------+-------------+---------------+\n| memberid | cardno | membername | address | phone | memberdeposit |\n+----------+----------+------------+---------+-------------+---------------+\n| 1 | 10000001 | å¼ ä¸‰ | åŒ—äº¬ | 13812345678 | 110.00 |\n| 2 | 10000002 | æå›› | å¤©æ´¥ | 18512345678 | 50.00 |\n+----------+----------+------------+---------+-------------+---------------+\n2 rows in set (0.00 sec)\n</code></pre><p>ç»“æœæ˜¾ç¤ºï¼Œä¼šå‘˜å‚¨å€¼é‡‘é¢ä¸å˜ã€‚è¿™ä¸ªæ—¶å€™ï¼Œä¸ºäº†è®©åº”ç”¨ç¨‹åºçŸ¥é“è§¦å‘å™¨æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ROW_COUNT()å‡½æ•°æ¥å‘ç°é”™è¯¯ï¼š</p><pre><code>mysql&gt; select row_count();\n+-------------+\n| row_count() |\n+-------------+\n| -1 |\n+-------------+\n1 row in set (0.00 sec)\n</code></pre><p>ç»“æœæ˜¯-1ï¼Œè¯´æ˜æˆ‘ä»¬å¯ä»¥é€šè¿‡ROW_COUNT()å‡½æ•°æ•è·åˆ°é”™è¯¯ã€‚</p><p>æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ï¼šå¯¹äºè®°å½•ä¼šå‘˜å‚¨å€¼é‡‘é¢å˜åŒ–çš„æ“ä½œï¼Œå¯ä»¥é€šè¿‡åº”ç”¨å±‚å‘å‡ºSQLè¯­å¥æŒ‡ä»¤ï¼Œæˆ–è€…ç”¨ä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹æ¥å®ç°ã€‚æ— è®ºå“ªç§æ–¹å¼ï¼Œéƒ½è¦é€šè¿‡å¥½å‡ æ­¥ç›¸äº’å…³è”çš„æ“ä½œï¼Œè€Œä¸”è¦åšæˆä¸€ä¸ªäº‹åŠ¡ï¼Œå¤„ç†è¿‡ç¨‹å¤æ‚ï¼Œæ¶ˆè€—çš„èµ„æºä¹Ÿè¾ƒå¤šã€‚å¦‚æœç”¨è§¦å‘å™¨ï¼Œæ•ˆç‡å°±ä¼šæé«˜å¾ˆå¤šï¼Œæ¶ˆè€—çš„èµ„æºä¹Ÿå°‘ã€‚åŒæ—¶ï¼Œè¿˜å¯ä»¥èµ·åˆ°äº‹åŠ¡çš„ç±»ä¼¼åŠŸèƒ½ï¼Œä¿è¯å…³è”æ“ä½œå…¨éƒ¨å®Œæˆæˆ–å…¨éƒ¨å¤±è´¥ã€‚</p><h2>è§¦å‘å™¨çš„ä¼˜ç¼ºç‚¹</h2><p>é€šè¿‡åˆšåˆšçš„æ¡ˆä¾‹ï¼Œä½ åº”è¯¥æ„Ÿå—åˆ°è§¦å‘å™¨çš„é«˜æ•ˆäº†ã€‚ç°åœ¨ï¼Œå’±ä»¬æŠŠè§†è§’æ‹”é«˜ä¸€ä¸‹ï¼Œæ¥çœ‹çœ‹è§¦å‘å™¨å…·ä½“éƒ½æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ã€‚æ¯•ç«Ÿï¼ŒçŸ¥å·±çŸ¥å½¼ï¼Œæ‰èƒ½ç™¾æˆ˜ä¸æ®†ã€‚åªæœ‰éå¸¸æ¸…æ¥šå®ƒçš„ä¼˜ç¼ºç‚¹ï¼Œä½ æ‰èƒ½å……åˆ†å‘æŒ¥å®ƒçš„ä½œç”¨ã€‚</p><p>æˆ‘å…ˆæ¥è¯´è¯´è§¦å‘å™¨çš„ä¼˜ç‚¹ã€‚</p><p><strong>é¦–å…ˆï¼Œè§¦å‘å™¨å¯ä»¥ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§</strong>ã€‚è¿™æ˜¯æ€ä¹ˆä½“ç°çš„å‘¢ï¼Ÿæˆ‘æ¥ä¸¾ä¸ªå°ä¾‹å­ã€‚</p><p>å‡è®¾æˆ‘ä»¬ç”¨è¿›è´§å•å¤´è¡¨ï¼ˆdemo.importheadï¼‰æ¥ä¿å­˜è¿›è´§å•çš„æ€»ä½“ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿›è´§å•ç¼–å·ã€ä¾›è´§å•†ç¼–å·ã€ä»“åº“ç¼–å·ã€æ€»è®¡è¿›è´§æ•°é‡ã€æ€»è®¡è¿›è´§é‡‘é¢å’ŒéªŒæ”¶æ—¥æœŸã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/5b/e8/5b36cf11405b0159a1388ee23639aee8.jpeg?wh=1602*383\" alt=\"\"></p><p>ç”¨è¿›è´§å•æ˜ç»†è¡¨ï¼ˆdemo.importdetailsï¼‰æ¥ä¿å­˜è¿›è´§å•†å“çš„æ˜ç»†ï¼ŒåŒ…æ‹¬è¿›è´§å•ç¼–å·ã€å•†å“ç¼–å·ã€è¿›è´§æ•°é‡ã€è¿›è´§ä»·æ ¼å’Œè¿›è´§é‡‘é¢ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b8/0e/b8e3fc8e001da9af2c85c22be5e6780e.jpeg?wh=1554*486\" alt=\"\"></p><p>æ¯å½“æˆ‘ä»¬å½•å…¥ã€åˆ é™¤å’Œä¿®æ”¹ä¸€æ¡è¿›è´§å•æ˜ç»†æ•°æ®çš„æ—¶å€™ï¼Œè¿›è´§å•æ˜ç»†è¡¨é‡Œçš„æ•°æ®å°±ä¼šå‘ç”Ÿå˜åŠ¨ã€‚è¿™ä¸ªæ—¶å€™ï¼Œåœ¨è¿›è´§å•å¤´è¡¨ä¸­çš„æ€»è®¡æ•°é‡å’Œæ€»è®¡é‡‘é¢å°±å¿…é¡»é‡æ–°è®¡ç®—ï¼Œå¦åˆ™ï¼Œè¿›è´§å•å¤´è¡¨ä¸­çš„æ€»è®¡æ•°é‡å’Œæ€»è®¡é‡‘é¢å°±ä¸ç­‰äºè¿›è´§å•æ˜ç»†è¡¨ä¸­æ•°é‡åˆè®¡å’Œé‡‘é¢åˆè®¡äº†ï¼Œè¿™å°±æ˜¯æ•°æ®ä¸ä¸€è‡´ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è§¦å‘å™¨ï¼Œè§„å®šæ¯å½“è¿›è´§å•æ˜ç»†è¡¨æœ‰æ•°æ®æ’å…¥ã€ä¿®æ”¹å’Œåˆ é™¤çš„æ“ä½œæ—¶ï¼Œè‡ªåŠ¨è§¦å‘2æ­¥æ“ä½œï¼š</p><ol>\n<li>é‡æ–°è®¡ç®—è¿›è´§å•æ˜ç»†è¡¨ä¸­çš„æ•°é‡åˆè®¡å’Œé‡‘é¢åˆè®¡ï¼›</li>\n<li>ç”¨ç¬¬ä¸€æ­¥ä¸­è®¡ç®—å‡ºæ¥çš„å€¼æ›´æ–°è¿›è´§å•å¤´è¡¨ä¸­çš„åˆè®¡æ•°é‡ä¸åˆè®¡é‡‘é¢ã€‚</li>\n</ol><p>è¿™æ ·ä¸€æ¥ï¼Œè¿›è´§å•å¤´è¡¨ä¸­çš„åˆè®¡æ•°é‡ä¸åˆè®¡é‡‘é¢çš„å€¼ï¼Œå°±å§‹ç»ˆä¸è¿›è´§å•æ˜ç»†è¡¨ä¸­è®¡ç®—å‡ºæ¥çš„åˆè®¡æ•°é‡ä¸åˆè®¡é‡‘é¢çš„å€¼ç›¸åŒï¼Œæ•°æ®å°±æ˜¯ä¸€è‡´çš„ï¼Œä¸ä¼šäº’ç›¸çŸ›ç›¾ã€‚</p><p><strong>å…¶æ¬¡ï¼Œè§¦å‘å™¨å¯ä»¥å¸®åŠ©æˆ‘ä»¬è®°å½•æ“ä½œæ—¥å¿—ã€‚</strong></p><p>åˆ©ç”¨è§¦å‘å™¨ï¼Œå¯ä»¥å…·ä½“è®°å½•ä»€ä¹ˆæ—¶é—´å‘ç”Ÿäº†ä»€ä¹ˆã€‚æˆ‘ä»¬å‰é¢çš„è®°å½•ä¿®æ”¹ä¼šå‘˜å‚¨å€¼é‡‘é¢çš„è§¦å‘å™¨ï¼Œå°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚è¿™å¯¹æˆ‘ä»¬è¿˜åŸæ“ä½œæ‰§è¡Œæ—¶çš„å…·ä½“åœºæ™¯ï¼Œæ›´å¥½åœ°å®šä½é—®é¢˜åŸå› å¾ˆæœ‰å¸®åŠ©ã€‚</p><p><strong>å¦å¤–ï¼Œè§¦å‘å™¨è¿˜å¯ä»¥ç”¨åœ¨æ“ä½œæ•°æ®å‰ï¼Œå¯¹æ•°æ®è¿›è¡Œåˆæ³•æ€§æ£€æŸ¥ã€‚</strong></p><p>ä¸¾ä¸ªå°ä¾‹å­ã€‚è¶…å¸‚è¿›è´§çš„æ—¶å€™ï¼Œéœ€è¦åº“ç®¡å½•å…¥è¿›è´§ä»·æ ¼ã€‚ä½†æ˜¯ï¼Œäººä¸ºæ“ä½œå¾ˆå®¹æ˜“çŠ¯é”™è¯¯ï¼Œæ¯”å¦‚è¯´åœ¨å½•å…¥æ•°é‡çš„æ—¶å€™ï¼ŒæŠŠæ¡å½¢ç æ‰«è¿›å»äº†ï¼›å½•å…¥é‡‘é¢çš„æ—¶å€™ï¼Œçœ‹ä¸²äº†è¡Œï¼Œå½•å…¥çš„ä»·æ ¼è¿œè¶…å”®ä»·ï¼Œå¯¼è‡´è´¦é¢ä¸Šçš„å·¨äºâ€¦â€¦è¿™äº›éƒ½å¯ä»¥é€šè¿‡è§¦å‘å™¨ï¼Œåœ¨å®é™…æ’å…¥æˆ–è€…æ›´æ–°æ“ä½œä¹‹å‰ï¼Œå¯¹ç›¸åº”çš„æ•°æ®è¿›è¡Œæ£€æŸ¥ï¼ŒåŠæ—¶æç¤ºé”™è¯¯ï¼Œé˜²æ­¢é”™è¯¯æ•°æ®è¿›å…¥ç³»ç»Ÿã€‚</p><p>è¯´äº†è¿™ä¹ˆå¤šè§¦å‘å™¨çš„ä¼˜ç‚¹ï¼Œé‚£æ˜¯ä¸æ˜¯æ‰€æœ‰äº‹ä»¶å¯ä»¥é©±åŠ¨çš„æ“ä½œï¼Œéƒ½åº”è¯¥ç”¨è§¦å‘å™¨å‘¢ï¼Ÿè¦æ˜¯ä½ è¿™ä¹ˆæƒ³ï¼Œå°±æ‰å‘é‡Œäº†ã€‚</p><p>ä¸‹é¢æˆ‘æ¥è¯´è¯´è§¦å‘å™¨çš„ç¼ºç‚¹ã€‚</p><p><strong>è§¦å‘å™¨æœ€å¤§çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¯è¯»æ€§å·®ã€‚</strong></p><p>å› ä¸ºè§¦å‘å™¨å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå¹¶ä¸”ç”±äº‹ä»¶é©±åŠ¨ï¼Œè¿™å°±æ„å‘³ç€è§¦å‘å™¨æœ‰å¯èƒ½ä¸å—åº”ç”¨å±‚çš„æ§åˆ¶ã€‚è¿™å¯¹ç³»ç»Ÿç»´æŠ¤æ˜¯éå¸¸æœ‰æŒ‘æˆ˜çš„ã€‚</p><p>è¿™æ˜¯å•¥æ„æ€å‘¢ï¼Ÿæˆ‘ä¸¾ä¸ªä¾‹å­ï¼Œä½ ä¸€çœ‹å°±æ˜ç™½äº†ã€‚</p><p>è¿˜æ˜¯æ‹¿æˆ‘ä»¬åˆ›å»ºè§¦å‘å™¨æ—¶è®²åˆ°çš„ä¿®æ”¹ä¼šå‘˜å‚¨å€¼æ“ä½œçš„é‚£ä¸ªè§¦å‘å™¨ä¸ºä¾‹ã€‚å¦‚æœè§¦å‘å™¨ä¸­çš„æ“ä½œå‡ºäº†é—®é¢˜ï¼Œä¼šå¯¼è‡´ä¼šå‘˜å‚¨å€¼é‡‘é¢æ›´æ–°å¤±è´¥ã€‚æˆ‘ç”¨ä¸‹é¢çš„ä»£ç æ¼”ç¤ºä¸€ä¸‹ï¼š</p><pre><code>mysql&gt; update demo.membermaster set memberdeposit=20 where memberid = 2;\nERROR 1054 (42S22): Unknown column 'aa' in 'field list'\n</code></pre><p>ç»“æœæ˜¾ç¤ºï¼Œç³»ç»Ÿæç¤ºé”™è¯¯ï¼Œå­—æ®µâ€œaaâ€ä¸å­˜åœ¨ã€‚</p><p>è¿™æ˜¯å› ä¸ºï¼Œè§¦å‘å™¨ä¸­çš„æ•°æ®æ’å…¥æ“ä½œå¤šäº†ä¸€ä¸ªå­—æ®µï¼Œç³»ç»Ÿæç¤ºé”™è¯¯ã€‚å¯æ˜¯ï¼Œå¦‚æœä½ ä¸äº†è§£è¿™ä¸ªè§¦å‘å™¨ï¼Œå¾ˆå¯èƒ½ä¼šè®¤ä¸ºæ˜¯æ›´æ–°è¯­å¥æœ¬èº«çš„é—®é¢˜ï¼Œæˆ–è€…æ˜¯ä¼šå‘˜ä¿¡æ¯è¡¨çš„ç»“æ„å‡ºäº†é—®é¢˜ã€‚è¯´ä¸å®šä½ è¿˜ä¼šç»™ä¼šå‘˜ä¿¡æ¯è¡¨æ·»åŠ ä¸€ä¸ªå«â€œaaâ€çš„å­—æ®µï¼Œè¯•å›¾è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç»“æœåªèƒ½æ˜¯ç™½è´¹åŠ›ã€‚</p><p>å¦å¤–ï¼Œç›¸å…³æ•°æ®çš„å˜æ›´ï¼Œç‰¹åˆ«æ˜¯æ•°æ®è¡¨ç»“æ„çš„å˜æ›´ï¼Œéƒ½å¯èƒ½ä¼šå¯¼è‡´è§¦å‘å™¨å‡ºé”™ï¼Œè¿›è€Œå½±å“æ•°æ®æ“ä½œçš„æ­£å¸¸è¿è¡Œã€‚è¿™äº›éƒ½ä¼šç”±äºè§¦å‘å™¨æœ¬èº«çš„éšè”½æ€§ï¼Œå½±å“åˆ°åº”ç”¨ä¸­é”™è¯¯åŸå› æ’æŸ¥çš„æ•ˆç‡ã€‚</p><h2>æ€»ç»“</h2><p>ä»Šå¤©è¿™èŠ‚è¯¾ï¼Œæˆ‘ç»™ä½ ä»‹ç»äº†å¦‚ä½•æ“ä½œè§¦å‘å™¨ã€‚ä¸ºäº†æ–¹ä¾¿ä½ å­¦ä¹ ï¼Œæˆ‘æ±‡æ€»äº†ç›¸å…³çš„è¯­æ³•ç»“æ„ï¼š</p><pre><code>åˆ›å»ºè§¦å‘å™¨çš„è¯­æ³•ç»“æ„æ˜¯\nCREATE TRIGGER è§¦å‘å™¨åç§° {BEFORE|AFTER} {INSERT|UPDATE|DELETE}\nON è¡¨å FOR EACH ROW è¡¨è¾¾å¼ï¼›\n\næŸ¥çœ‹è§¦å‘å™¨çš„è¯­å¥æ˜¯ï¼š\nSHOW TRIGGERS\\G;\n\nåˆ é™¤è§¦å‘å™¨çš„è¯­æ³•ç»“æ„æ˜¯ï¼š\nDROP TRIGGER è§¦å‘å™¨åç§°;\n</code></pre><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å­¦ä¹ äº†è§¦å‘å™¨çš„ä¼˜ç¼ºç‚¹ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯å¯ä»¥ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€è®°å½•æ“ä½œæ—¥å¿—å’Œæ£€æŸ¥æ•°æ®åˆæ³•æ€§ã€‚ä¸è¿‡ï¼Œå®ƒä¹Ÿå­˜åœ¨å¯è¯»æ€§å·®ï¼Œä¼šå¢åŠ ç³»ç»Ÿç»´æŠ¤çš„æˆæœ¬çš„ç¼ºç‚¹ã€‚åœ¨ä½¿ç”¨è§¦å‘å™¨çš„æ—¶å€™ï¼Œä½ ä¸€å®šè¦ç»¼åˆè€ƒé‡ã€‚</p><p>æœ€åï¼Œæˆ‘è¿˜æƒ³å†ç»™ä½ æä¸€ä¸ªå°å»ºè®®ï¼š<strong>ç»´æŠ¤ä¸€ä¸ªå®Œæ•´çš„æ•°æ®åº“è®¾è®¡æ–‡æ¡£</strong>ã€‚å› ä¸ºè¿ç»´äººå‘˜å¯èƒ½ä¼šç»å¸¸å˜åŠ¨ï¼Œå¦‚æœæœ‰ä¸€ä¸ªå®Œæ•´çš„æ•°æ®åº“è®¾è®¡æ–‡æ¡£ï¼Œå°±å¯ä»¥å¸®åŠ©æ–°äººå¿«é€Ÿäº†è§£è§¦å‘å™¨çš„è®¾è®¡æ€è·¯ï¼Œä»è€Œå‡å°‘é”™è¯¯ï¼Œé™ä½ç³»ç»Ÿç»´æŠ¤çš„æˆæœ¬ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æˆ‘åœ¨è¯¾ç¨‹ä¸­æåˆ°ï¼Œæ¯å½“åœ¨è¿›è´§å•æ˜ç»†è¡¨ä¸­æ’å…¥æˆ–ä¿®æ”¹æ•°æ®çš„æ—¶å€™ï¼Œéƒ½è¦æ›´æ–°è¿›è´§å•å¤´è¡¨ä¸­çš„æ€»è®¡æ•°é‡å’Œæ€»è®¡é‡‘é¢ï¼Œè¿™ä¸ªé—®é¢˜å¯ä»¥ç”¨è§¦å‘å™¨æ¥è§£å†³ã€‚ä½ èƒ½ä¸èƒ½åˆ›å»ºä¸€ä¸ªè§¦å‘å™¨ï¼Œè¦æ±‚æ˜¯å½“æ“ä½œäººå‘˜æ›´æ–°è¿›è´§å•æ˜ç»†è¡¨ä¸­ç›¸å…³æ•°æ®çš„æ—¶å€™ï¼Œè‡ªåŠ¨è§¦å‘å¯¹è¿›è´§å•å¤´è¡¨ä¸­ç›¸å…³æ•°æ®çš„æ›´æ”¹ï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ï¼Ÿ</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºå†™ä¸‹ä½ çš„æ€è€ƒå’Œç­”æ¡ˆï¼Œæˆ‘ä»¬ä¸€èµ·äº¤æµè®¨è®ºã€‚å¦‚æœä½ è§‰å¾—ä»Šå¤©çš„å†…å®¹å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œæ¬¢è¿ä½ æŠŠå®ƒåˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–åŒäº‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ã€‚</p>","neighbors":{"left":{"article_title":"16 | æ¸¸æ ‡ï¼šå¯¹äºæ•°æ®é›†ä¸­çš„è®°å½•ï¼Œè¯¥æ€ä¹ˆé€æ¡å¤„ç†ï¼Ÿ","id":362233},"right":{"article_title":"18 | æƒé™ç®¡ç†ï¼šå¦‚ä½•æ§åˆ¶æ•°æ®åº“è®¿é—®ï¼Œæ¶ˆé™¤å®‰å…¨éšæ‚£ï¼Ÿ","id":364695}},"comments":[{"had_liked":false,"id":293156,"user_name":"æœ±æ™“å³°","can_delete":false,"product_type":"c1","uid":2356905,"ip_address":"","ucode":"D2F84F44329C29","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","comment_is_top":true,"comment_ctime":1621246846,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"9.2233720384759992e+18","product_id":100073201,"comment_content":"ä½ å¥½ï¼Œæˆ‘æ˜¯æœ±æ™“å³°ï¼Œä¸‹é¢æˆ‘å°±æ¥å…¬å¸ƒä¸€ä¸‹ä¸ŠèŠ‚è¯¾æ€è€ƒé¢˜çš„ç­”æ¡ˆï¼š<br><br>ä¸ŠèŠ‚è¯¾ï¼Œæˆ‘ä»¬å­¦ä¹ äº†æ¸¸æ ‡ã€‚ä¸‹é¢æ˜¯æ€è€ƒé¢˜çš„ç­”æ¡ˆï¼š<br><br>DELIMITER &#47;&#47;<br>CREATE PROCEDURE demo.myproc()<br>BEGIN<br>\tDECLARE myid INT;<br>    DECLARE myq INT;<br>    DECLARE done INT DEFAULT FALSE;<br>\tDECLARE cursor_test CURSOR FOR <br>    SELECT * FROM demo.test;<br>\tDECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;<br>    <br>\tOPEN cursor_test;<br>    FETCH cursor_test INTO myid,myq;<br>    REPEAT<br>\t\tIF (myid MOD 2 = 0) THEN    -- å¦‚æœæ˜¯å¶æ•°ï¼ŒåŠ 1<br>            UPDATE demo.test SET myquant = myquant + 1 WHERE id = myid;<br>\t\tELSE                                       -- å¥‡æ•°åŠ 2<br>\t\t\tUPDATE demo.test SET myquant = myquant + 2 WHERE id = myid;<br>\t\tEND IF;<br>        FETCH cursor_test INTO myid,myq;<br>\tUNTIL done END REPEAT;<br>    CLOSE cursor_test;<br>END<br>&#47;&#47;<br>DELIMITER ;<br>","like_count":0,"discussions":[{"author":{"id":1701572,"avatar":"https://static001.geekbang.org/account/avatar/00/19/f6/c4/e14686d4.jpg","nickname":"shk1230","note":"","ucode":"9E39279C23FF8F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555976,"discussion_content":"æ–‡ä¸­â€œINSERT INTO .....SELECT.....â€ï¼Œåé¢æ˜¯å¦å¯ä»¥ç”¨values(....)ï¼Œæœ‰å•¥ä¸åŒå—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647154540,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2719812,"avatar":"","nickname":"Geek_989379","note":"","ucode":"3DB7D29E9CA816","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391987,"discussion_content":"æˆ‘æ˜¯é£é£ï¼Œè€å¸ˆæ‚¨å¥½ï¼Œè¿™ä¸ªåœ°æ–¹CREATE PROCEDURE demo.myproc()æ˜¯ä¸æ˜¯éœ€è¦ä¿®æ”¹æˆï¼šCREATE PROCEDURE demo.myproc(myid int)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630746561,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1701572,"avatar":"https://static001.geekbang.org/account/avatar/00/19/f6/c4/e14686d4.jpg","nickname":"shk1230","note":"","ucode":"9E39279C23FF8F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":2719812,"avatar":"","nickname":"Geek_989379","note":"","ucode":"3DB7D29E9CA816","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555975,"discussion_content":"ä¸éœ€è¦ï¼Œä½ ä¼ å‚æ•°å¹²å—ï¼Œæ ¹æœ¬ç”¨ä¸åˆ°å‚æ•°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647154308,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":391987,"ip_address":""},"score":555975,"extra":""}]}]},{"had_liked":false,"id":288797,"user_name":"giteebravo","can_delete":false,"product_type":"c1","uid":1005290,"ip_address":"","ucode":"C087E8D6B5A98B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/56/ea/32608c44.jpg","comment_is_top":false,"comment_ctime":1618679386,"is_pvip":false,"replies":[{"id":"106439","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™“å³°","uid":"2356905","ctime":1621560126,"ip_address":"","comment_id":288797,"utype":1}],"discussion_count":1,"race_medal":1,"score":"44568352346","product_id":100073201,"comment_content":"<br>è§†å›¾ï¼Œå­˜å‚¨è¿‡ç¨‹ï¼Œå­˜å‚¨å‡½æ•°ï¼Œè§¦å‘å™¨<br>è¿™äº›å¯¹è±¡éƒ½ä¿å­˜åœ¨æ•°æ®åº“ä¸­<br>å¯¹äºåº”ç”¨ç³»ç»Ÿæ¥è¯´å…·æœ‰å¾ˆå¤§çš„éšè”½æ€§<br>ç»´æŠ¤å’Œç®¡ç†å®ƒä»¬è¿˜æ˜¯æœ‰å¾ˆé«˜æˆæœ¬çš„","like_count":11,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"æœ±æ™“å³°","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518741,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621560126,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":288796,"user_name":"giteebravo","can_delete":false,"product_type":"c1","uid":1005290,"ip_address":"","ucode":"C087E8D6B5A98B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/56/ea/32608c44.jpg","comment_is_top":false,"comment_ctime":1618679090,"is_pvip":false,"replies":[{"id":"106438","content":"ä¸€èˆ¬æ¥è¯´åº”è¯¥åŒ…æ‹¬éœ€æ±‚åˆ†æã€å»ºæ¨¡ï¼ˆERï¼‰ã€é€»è¾‘è®¾è®¡ï¼ˆæ¯”å¦‚å»ºåº“å»ºè¡¨ï¼‰ã€ç‰©ç†è®¾è®¡ï¼ˆæ¯”å¦‚ç´¢å¼•ï¼‰ã€å®æ–½ã€è¿ç»´ï¼ˆå®¹ç¾å’Œå¤‡ä»½ï¼‰ç­‰ï¼Œæ ¹æ®å®é™…éœ€æ±‚ï¼Œå¯ä»¥è¿›ä¸€æ­¥ç»†åŒ–","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™“å³°","uid":"2356905","ctime":1621560109,"ip_address":"","comment_id":288796,"utype":1}],"discussion_count":1,"race_medal":1,"score":"27388482866","product_id":100073201,"comment_content":"<br>è¯·é—®è€å¸ˆï¼Œ<br>ä¸€ä¸ªå®Œæ•´çš„æ•°æ®åº“è®¾è®¡æ–‡æ¡£åº”è¯¥åŒ…å«å“ªäº›å†…å®¹å‘¢ï¼Ÿ<br>","like_count":6,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"æœ±æ™“å³°","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518740,"discussion_content":"ä¸€èˆ¬æ¥è¯´åº”è¯¥åŒ…æ‹¬éœ€æ±‚åˆ†æã€å»ºæ¨¡ï¼ˆERï¼‰ã€é€»è¾‘è®¾è®¡ï¼ˆæ¯”å¦‚å»ºåº“å»ºè¡¨ï¼‰ã€ç‰©ç†è®¾è®¡ï¼ˆæ¯”å¦‚ç´¢å¼•ï¼‰ã€å®æ–½ã€è¿ç»´ï¼ˆå®¹ç¾å’Œå¤‡ä»½ï¼‰ç­‰ï¼Œæ ¹æ®å®é™…éœ€æ±‚ï¼Œå¯ä»¥è¿›ä¸€æ­¥ç»†åŒ–","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1621560109,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":288798,"user_name":"giteebravo","can_delete":false,"product_type":"c1","uid":1005290,"ip_address":"","ucode":"C087E8D6B5A98B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/56/ea/32608c44.jpg","comment_is_top":false,"comment_ctime":1618679417,"is_pvip":false,"replies":[{"id":"106444","content":"è§¦å‘å™¨æ—¶ä¸€ç§ç”±SQLæ“ä½œè§¦å‘çš„å­˜å‚¨ç¨‹åºã€‚äº‹åŠ¡æ˜¯æŒ‡ä¸€ç³»åˆ—SQLæ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œã€‚è§¦å‘å™¨ä¸­çš„SQLæ“ä½œå¯ä»¥æ˜¯äº‹åŠ¡æ“ä½œï¼Œä¹Ÿå¯ä»¥ä¸æ˜¯ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™“å³°","uid":"2356905","ctime":1621560469,"ip_address":"","comment_id":288798,"utype":1}],"discussion_count":1,"race_medal":1,"score":"10208614009","product_id":100073201,"comment_content":"<br>è§¦å‘å™¨å’Œäº‹åŠ¡çš„æ ¹æœ¬å·®åˆ«åœ¨å“ªå‘¢ï¼Ÿ<br>","like_count":2,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"æœ±æ™“å³°","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518742,"discussion_content":"è§¦å‘å™¨æ—¶ä¸€ç§ç”±SQLæ“ä½œè§¦å‘çš„å­˜å‚¨ç¨‹åºã€‚äº‹åŠ¡æ˜¯æŒ‡ä¸€ç³»åˆ—SQLæ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œã€‚è§¦å‘å™¨ä¸­çš„SQLæ“ä½œå¯ä»¥æ˜¯äº‹åŠ¡æ“ä½œï¼Œä¹Ÿå¯ä»¥ä¸æ˜¯ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1621560469,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332545,"user_name":"jjn0703","can_delete":false,"product_type":"c1","uid":1076652,"ip_address":"","ucode":"83AF403AC7DFB7","user_header":"https://static001.geekbang.org/account/avatar/00/10/6d/ac/6128225f.jpg","comment_is_top":false,"comment_ctime":1643334941,"is_pvip":true,"replies":[{"id":"123473","content":"å»ºè®®å¯¹æµç¨‹è¿›è¡Œç®¡æ§ï¼Œä¹Ÿå¯ä»¥å€ŸåŠ©ä¸€äº›æµç¨‹æ§åˆ¶è½¯ä»¶ï¼Œè¾…åŠ©ä»¥å…¬å¸çš„è§„ç« åˆ¶åº¦ã€åŸ¹è®­ç­‰æ‰‹æ®µï¼Œè¿™ä¸ªé—®é¢˜åº”è¯¥å¯ä»¥å¾—åˆ°è§£å†³","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2356905","ctime":1647072817,"ip_address":"","comment_id":332545,"utype":1}],"discussion_count":1,"race_medal":5,"score":"5938302237","product_id":100073201,"comment_content":"è¯·æ•™ä¸€ä¸‹è€å¸ˆï¼Œæ•°æ®åº“è®¾è®¡æ–‡æ¡£å¦‚ä½•åšçš„ç‰ˆæœ¬ç®¡ç†ï¼Œå›¢é˜Ÿåä½œæ—¶å€™ï¼Œå˜æ›´æœ‰çš„åŒäº‹ç›´æ¥å°±åœ¨Navicatä¸Šæ“ä½œæäº¤äº†","like_count":1,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"æœ±æ™“å³°","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555779,"discussion_content":"å»ºè®®å¯¹æµç¨‹è¿›è¡Œç®¡æ§ï¼Œä¹Ÿå¯ä»¥å€ŸåŠ©ä¸€äº›æµç¨‹æ§åˆ¶è½¯ä»¶ï¼Œè¾…åŠ©ä»¥å…¬å¸çš„è§„ç« åˆ¶åº¦ã€åŸ¹è®­ç­‰æ‰‹æ®µï¼Œè¿™ä¸ªé—®é¢˜åº”è¯¥å¯ä»¥å¾—åˆ°è§£å†³","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647072817,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":310810,"user_name":"æµäº‘è¿½é£","can_delete":false,"product_type":"c1","uid":2611950,"ip_address":"","ucode":"16D738406CB191","user_header":"https://static001.geekbang.org/account/avatar/00/27/da/ee/63090718.jpg","comment_is_top":false,"comment_ctime":1630919274,"is_pvip":false,"replies":[{"id":"113741","content":"åŒæ„","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™“å³°","uid":"2356905","ctime":1632798683,"ip_address":"","comment_id":310810,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5925886570","product_id":100073201,"comment_content":"å¤§é‡æ•°æ®æ›´æ–°æˆ–æ’å…¥æ—¶,å¦‚æœå­˜åœ¨è¡¨ä¸Šçš„è§¦å‘å™¨ä¼šå½±å“æ€§èƒ½çš„","like_count":1,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"æœ±æ™“å³°","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526363,"discussion_content":"åŒæ„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632798683,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":290080,"user_name":"å°æ˜é’ˆä¸æˆ³","can_delete":false,"product_type":"c1","uid":2016188,"ip_address":"","ucode":"64D729196221E2","user_header":"https://static001.geekbang.org/account/avatar/00/1e/c3/bc/77549ce4.jpg","comment_is_top":false,"comment_ctime":1619351234,"is_pvip":true,"replies":[{"id":"106473","content":"å¯ä»¥åœ¨ç½‘ä¸Šæœä¸€ä¸‹â€œæ•°æ®åº“è®¾è®¡æ–‡æ¡£â€ï¼Œæœ‰å¾ˆå¤šä¿¡æ¯å¯ä»¥å‚è€ƒã€‚ä¸è¿‡åœ¨æˆ‘çœ‹æ¥ï¼Œå½¢å¼å¹¶ä¸æ˜¯æœ€é‡è¦çš„ã€‚é‡è¦çš„æ˜¯è¦æŠŠè®¾è®¡çš„ç»†èŠ‚éƒ½è®°å½•ä¸‹æ¥å¹¶ä¸”åŠæ—¶æ›´æ–°ï¼Œè¿™æ ·æ‰èƒ½èµ·åˆ°ä½œç”¨ã€‚ä½†æ˜¯æ–‡æ¡£ç»´æŠ¤éœ€è¦è€—è´¹å¤§é‡æ—¶é—´ç²¾åŠ›ï¼Œæ˜¯éå¸¸æœ‰æŒ‘æˆ˜æ€§çš„å·¥ä½œã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™“å³°","uid":"2356905","ctime":1621561580,"ip_address":"","comment_id":290080,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5914318530","product_id":100073201,"comment_content":"è€å¸ˆèƒ½ä¸èƒ½æä¾›ä¸€ä¸ªæ•°æ®åº“è®¾è®¡æ–‡æ¡£ç»™æˆ‘ä»¬å­¦ä¹ ä¸€ä¸‹å•Š..","like_count":1,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"æœ±æ™“å³°","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519105,"discussion_content":"å¯ä»¥åœ¨ç½‘ä¸Šæœä¸€ä¸‹â€œæ•°æ®åº“è®¾è®¡æ–‡æ¡£â€ï¼Œæœ‰å¾ˆå¤šä¿¡æ¯å¯ä»¥å‚è€ƒã€‚ä¸è¿‡åœ¨æˆ‘çœ‹æ¥ï¼Œå½¢å¼å¹¶ä¸æ˜¯æœ€é‡è¦çš„ã€‚é‡è¦çš„æ˜¯è¦æŠŠè®¾è®¡çš„ç»†èŠ‚éƒ½è®°å½•ä¸‹æ¥å¹¶ä¸”åŠæ—¶æ›´æ–°ï¼Œè¿™æ ·æ‰èƒ½èµ·åˆ°ä½œç”¨ã€‚ä½†æ˜¯æ–‡æ¡£ç»´æŠ¤éœ€è¦è€—è´¹å¤§é‡æ—¶é—´ç²¾åŠ›ï¼Œæ˜¯éå¸¸æœ‰æŒ‘æˆ˜æ€§çš„å·¥ä½œã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1621561580,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1658413,"avatar":"https://static001.geekbang.org/account/avatar/00/19/4e/2d/06d3f9f5.jpg","nickname":"é™âœ¨","note":"","ucode":"1B33229C206339","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"æœ±æ™“å³°","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":574849,"discussion_content":"åœ¨æ—¥æœ¬å¼€å‘ï¼Œæ·±æ„Ÿå…¶å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654406260,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":519105,"ip_address":""},"score":574849,"extra":""}]}]},{"had_liked":false,"id":288792,"user_name":"lesserror","can_delete":false,"product_type":"c1","uid":1351076,"ip_address":"","ucode":"25A54D1165FCF6","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","comment_is_top":false,"comment_ctime":1618675457,"is_pvip":false,"replies":[{"id":"106431","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™“å³°","uid":"2356905","ctime":1621559758,"ip_address":"","comment_id":288792,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5913642753","product_id":100073201,"comment_content":"è§¦å‘å™¨å®ç°çš„åŠŸèƒ½è®©æˆ‘æƒ³åˆ°äº†webæ¡†æ¶çš„æ¨¡å‹äº‹ä»¶ã€‚å®ç°çš„ä¹Ÿæ˜¯æ¨¡å‹æ›´æ–°ã€åˆ é™¤ç­‰å‰åéœ€è¦æ‰§è¡Œçš„æ“ä½œã€‚<br><br>æ‰€ä»¥ç°åœ¨åœ¨ä»£ç å±‚é¢å¤„ç†è¿™ç±»å¤šä¸ªè¡¨æ•°æ®ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§æ“ä½œå˜å¾—æ²¡æœ‰é‚£ä¹ˆéº»çƒ¦ã€‚<br><br>è§¦å‘å™¨æœ€å¤§çš„å¼Šç«¯å°±æ˜¯éšè”½äº†ï¼Œå¦‚æœä¸šåŠ¡ä¸­å¤§é‡ä½¿ç”¨äº†è§¦å‘å™¨ï¼Œéœ€è¦åœ¨ç¼–ç¨‹è¯­è¨€å’Œè§¦å‘å™¨è¯­æ³•ä¹‹é—´æ¥å›æ¨ªè·³ï¼ŒåŠ å¤§äº†ç³»ç»Ÿç»´æŠ¤æˆæœ¬ã€‚","like_count":2,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"æœ±æ™“å³°","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518739,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621559758,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":347768,"user_name":"é™âœ¨","can_delete":false,"product_type":"c1","uid":1658413,"ip_address":"","ucode":"1B33229C206339","user_header":"https://static001.geekbang.org/account/avatar/00/19/4e/2d/06d3f9f5.jpg","comment_is_top":false,"comment_ctime":1654407141,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1654407141","product_id":100073201,"comment_content":"é€‚ç”¨äºé¢‘ç¹æˆ–è€…å¤§æ‰¹é‡çš„æ•°æ®çŠ¶æ€åŒæ­¥å¤„ç†ã€‚è¿˜æœ‰è€å¸ˆè¯´çš„è®°logå’Œå…¥å‚æ£€æŸ¥ã€‚<br>å°è±¡é‡Œåªæœ‰ä¸€ä¸ªæ—¥æœ¬çš„ç°åœºç”¨åˆ°äº†è§¦å‘å™¨ï¼Œåˆšå¼€å§‹è¿˜æƒŠå¥‡ï¼Œç°åœ¨æƒ³äº†ä¸€ä¸‹å¤§æ¦‚æ˜¯å› ä¸ºä»–ä»¬ç»´æŠ¤äº†æ‰€æœ‰çš„æ–‡æ¡£å§ğŸ˜‚ è¿˜åŒ…å«å­˜å‚¨è¿‡ç¨‹å’Œå„ç§è§†å›¾ã€‚","like_count":0},{"had_liked":false,"id":313163,"user_name":"å½­å½¬","can_delete":false,"product_type":"c1","uid":2680555,"ip_address":"","ucode":"5AF4F4D7163DFE","user_header":"https://static001.geekbang.org/account/avatar/00/28/e6/eb/7b7c0101.jpg","comment_is_top":false,"comment_ctime":1632299913,"is_pvip":false,"replies":[{"id":"116483","content":"æˆ‘æ²¡æœ‰å‘ç°","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™“å³°","uid":"2356905","ctime":1636622539,"ip_address":"","comment_id":313163,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1632299913","product_id":100073201,"comment_content":"Oracleçš„è¡Œçº§è§¦å‘å™¨æœ‰å˜å¼‚è¡¨çš„é—®é¢˜ï¼ŒMySQLçš„è§¦å‘å™¨æœ‰è¿™ä¸ªé—®é¢˜å—ï¼Ÿ<br>","like_count":0,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"æœ±æ™“å³°","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527253,"discussion_content":"æˆ‘æ²¡æœ‰å‘ç°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636622539,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":305468,"user_name":"å¤§è–","can_delete":false,"product_type":"c1","uid":2485664,"ip_address":"","ucode":"5FD991D883BE78","user_header":"https://static001.geekbang.org/account/avatar/00/25/ed/a0/cc89c128.jpg","comment_is_top":false,"comment_ctime":1627983520,"is_pvip":false,"replies":[{"id":"112601","content":"\\G çš„ä½œç”¨æ˜¯æ§åˆ¶è¾“å‡ºçš„æ ¼å¼ï¼Œä½¿å¾—æŸ¥çœ‹è§¦å‘å™¨çš„æ˜¾ç¤ºç»“æœæ›´ç›´è§‚ä¸€äº›","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™“å³°","uid":"2356905","ctime":1630906822,"ip_address":"","comment_id":305468,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1627983520","product_id":100073201,"comment_content":"<br>SHOW TRIGGERS\\G;   åé¢å¤šå‡ºæ¥çš„\\Gæ˜¯ä¸æ˜¯ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰äº†è¿˜æ˜¯å•¥ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"æœ±æ™“å³°","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524395,"discussion_content":"\\G çš„ä½œç”¨æ˜¯æ§åˆ¶è¾“å‡ºçš„æ ¼å¼ï¼Œä½¿å¾—æŸ¥çœ‹è§¦å‘å™¨çš„æ˜¾ç¤ºç»“æœæ›´ç›´è§‚ä¸€äº›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630906822,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2641149,"avatar":"https://static001.geekbang.org/account/avatar/00/28/4c/fd/237ee970.jpg","nickname":"è§å­—å¦‚æ™¤","note":"","ucode":"2CBA86D3254B85","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"æœ±æ™“å³°","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":570332,"discussion_content":"SHOW TRIGGERS\\G\tError Code: 1064. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;\\G&#39; at line 1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651735297,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":524395,"ip_address":""},"score":570332,"extra":""}]}]},{"had_liked":false,"id":297701,"user_name":"å‡¯","can_delete":false,"product_type":"c1","uid":1405256,"ip_address":"","ucode":"60DB11CF72C7B0","user_header":"https://static001.geekbang.org/account/avatar/00/15/71/48/44df7f4e.jpg","comment_is_top":false,"comment_ctime":1623739995,"is_pvip":false,"replies":[{"id":"109148","content":"1. æ˜¯çš„ï¼Œnew&#47;oldè¡¨ç¤ºè§¦å‘å‰åçš„æ•°æ®ï¼Œæœ‰ä¸ªnew&#47;oldï¼Œæ‰èƒ½æ–¹ä¾¿æˆ‘ä»¬å†™è§¦å‘ç¨‹åº<br>2. å…ˆå†™deposithistï¼Œå†ä¿®æ”¹membermasterï¼Œè¿™æ ·åšä¸å¥½ï¼ŒåŸå› æ˜¯ç¨‹åºçš„å¯è¯»æ€§å·®","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™“å³°","uid":"2356905","ctime":1625717992,"ip_address":"","comment_id":297701,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1623739995","product_id":100073201,"comment_content":"<br><br>NEW.memberid,NOW(),<br>OLD.memberdeposit,<br>NEW.memberdeposit,<br>NEW.memberdeposit-OLD.memberdeposit;<br>åˆ›å»ºè§¦å‘å™¨çš„æ—¶å€™ï¼Œé‡Œé¢æœ‰å¤§é‡çš„newã€oldï¼Œè¿™ä¸ªæ˜¯è§¦å‘å™¨ç‰¹æœ‰çš„å˜é‡ä¹ˆï¼Ÿ<br><br>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¿®æ”¹é€»è¾‘è¿™ä¸ªä¸¤ä¸ªè¡¨çš„ä¿®æ”¹é¡ºåºèƒ½ä¸èƒ½åˆ‡æ¢ä¸€ä¸‹ï¼Œå…ˆä¿®æ”¹deposithistï¼Œå†ä¿®æ”¹membermasterï¼Œåˆ›å»ºè§¦å‘å™¨ç›‘æ§deposithistï¼Œå¦‚æœè¿™ä¸ªè¡¨æœ‰å˜åŠ¨ï¼Œç›´æ¥å§membermasterçš„ç›´æ¥ç›´æ¥ä¿®æ”¹ã€‚<br>","like_count":0,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"æœ±æ™“å³°","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521912,"discussion_content":"1. æ˜¯çš„ï¼Œnew/oldè¡¨ç¤ºè§¦å‘å‰åçš„æ•°æ®ï¼Œæœ‰ä¸ªnew/oldï¼Œæ‰èƒ½æ–¹ä¾¿æˆ‘ä»¬å†™è§¦å‘ç¨‹åº\n2. å…ˆå†™deposithistï¼Œå†ä¿®æ”¹membermasterï¼Œè¿™æ ·åšä¸å¥½ï¼ŒåŸå› æ˜¯ç¨‹åºçš„å¯è¯»æ€§å·®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625717992,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}