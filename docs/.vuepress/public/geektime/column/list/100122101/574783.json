{"id":574783,"title":"04 | å¦‚ä½•é€šè¿‡ç»„åˆã€ç®¡é“å’Œreducerè®©å‡½æ•°æŠ½è±¡åŒ–ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯çŸ³å·ã€‚</p><p>ä¸ŠèŠ‚è¯¾æˆ‘ä»¬è®²åˆ°ï¼Œé€šè¿‡éƒ¨åˆ†åº”ç”¨å’ŒæŸ¯é‡ŒåŒ–ï¼Œæˆ‘ä»¬åšåˆ°äº†ä»æŠ½è±¡åˆ°å…·è±¡åŒ–ã€‚é‚£ä¹ˆï¼Œä»Šå¤©æˆ‘ä»¬è¦è®²çš„ç»„åˆå’Œç®¡é“ï¼Œå°±æ˜¯åè¿‡æ¥å¸®åŠ©æˆ‘ä»¬æŠŠå‡½æ•°<strong>ä»å…·è±¡åŒ–å˜åˆ°æŠ½è±¡åŒ–</strong>çš„è¿‡ç¨‹ã€‚å®ƒç›¸å½“äºæ˜¯ç³»ç»ŸåŒ–åœ°æŠŠä¸åŒçš„ç»„ä»¶å‡½æ•°ï¼Œå°è£…åœ¨äº†åªæœ‰ä¸€ä¸ªå…¥å£å’Œå‡ºå£çš„å‡½æ•°å½“ä¸­ã€‚</p><p>å…¶å®ï¼Œæˆ‘ä»¬åœ¨ä¸ŠèŠ‚è¯¾è®²å¤„ç†å‡½æ•°è¾“å…¥é—®é¢˜çš„æ—¶å€™ï¼Œåœ¨ä»‹ç»unaryçš„ç›¸å…³ä¾‹å­ä¸­ï¼Œå·²ç»çœ‹åˆ°äº†ç»„åˆçš„é›å½¢ã€‚åœ¨å‡½æ•°å¼ç¼–ç¨‹é‡Œï¼Œç»„åˆï¼ˆCompositionï¼‰çš„æ¦‚å¿µå°±æ˜¯æŠŠç»„ä»¶å‡½æ•°ç»„åˆèµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„å‡½æ•°ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/50/a0/5087972778481dd701518185a2866fa0.jpg?wh=1920x944\" alt=\"å›¾ç‰‡\"></p><p>æˆ‘ä»¬å¯ä»¥å…ˆæ¥çœ‹ä¸ªç®€å•çš„ç»„åˆå‡½æ•°ä¾‹å­ï¼Œæ¯”å¦‚è¦åˆ›å»ºä¸€ä¸ªâ€œåˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦ä¸ºå¥‡æ•°â€çš„isOddå‡½æ•°ï¼Œå¯ä»¥å…ˆå†™ä¸€ä¸ªâ€œè®¡ç®—ç›®æ ‡æ•°å€¼é™¤ä»¥2çš„ä½™æ•°â€çš„å‡½æ•°ï¼Œç„¶åå†å†™ä¸€ä¸ªâ€œçœ‹ç»“æœæ˜¯ä¸æ˜¯ç­‰äº1â€çš„å‡½æ•°ã€‚è¿™æ ·ï¼ŒisOddå‡½æ•°å°±æ˜¯å»ºç«‹åœ¨ä¸¤ä¸ªç»„ä»¶å‡½æ•°çš„åŸºç¡€ä¸Šã€‚</p><pre><code class=\"language-javascript\">var isOdd = compose(equalsToOne, remainderOfTwo);\n</code></pre><p>ä¸è¿‡ï¼Œä½ ä¼šçœ‹åˆ°è¿™ä¸ªç»„åˆçš„é¡ºåºæ˜¯åç›´è§‰çš„ï¼Œå› ä¸ºå¦‚æœæŒ‰ç…§æ­£å¸¸çš„é¡ºåºï¼Œåº”è¯¥æ˜¯å…ˆæŠŠremainderByTwoæ”¾åœ¨å‰é¢æ¥è®¡ç®—ä½™æ•°ï¼Œç„¶åå†æ‰§è¡Œåé¢çš„equalsToOneï¼Œ çœ‹ç»“æœæ˜¯ä¸æ˜¯ç­‰äº1ã€‚</p><p>é‚£ä¹ˆï¼Œè¿™é‡Œä¸ºä»€ä¹ˆä¼šæœ‰ä¸€ä¸ªåç›´è§‰çš„è®¾è®¡å‘¢ï¼Ÿä»Šå¤©è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°±é€šè¿‡å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæ¥çœ‹çœ‹ç»„åˆå’Œç®¡é“è¦å¦‚ä½•åšåˆ°æŠ½è±¡åŒ–ï¼Œè€Œreduceråˆæ˜¯å¦‚ä½•åœ¨ä¸€ç³»åˆ—çš„æ“ä½œä¸­ï¼Œæé«˜é’ˆå¯¹å€¼çš„å¤„ç†æ€§èƒ½çš„ã€‚</p><!-- [[[read_end]]] --><h2>ç»„åˆCompose</h2><p>åœ¨è®²ç»„åˆå‰ï¼Œæˆ‘æƒ³å…ˆå¸¦ä½ æ¥çœ‹çœ‹Point-Freeå’Œå‡½æ•°ç»„ä»¶ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬è¿˜æ˜¯ç”¨åˆšåˆšæåˆ°çš„â€œåˆ¤æ–­ä¸€ä¸ªå€¼æ˜¯ä¸æ˜¯å¥‡æ•°â€çš„isOddå‡½æ•°ï¼Œæ¥ä¸€æ­¥æ­¥çœ‹ä¸‹å®ƒçš„å®ç°ã€‚</p><h3>Point-Free</h3><p>é‚£ä¹ˆé¦–å…ˆï¼Œä»€ä¹ˆæ˜¯Point-Freeå‘¢ï¼Ÿå®é™…ä¸Šï¼ŒPoint-Preeæ˜¯å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„ä¸€ç§ç¼–ç¨‹é£æ ¼ï¼Œå…¶ä¸­çš„Pointæ˜¯æŒ‡å‚æ•°ï¼Œfreeæ˜¯æŒ‡æ²¡æœ‰ã€‚åŠ åœ¨ä¸€èµ·ï¼ŒPoint-Freeçš„æ„æ€å°±æ˜¯<strong>æ²¡æœ‰å‚æ•°çš„å‡½æ•°</strong>ã€‚</p><p>è€Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå…¶å®é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå°±å¯ä»¥å°†ä¸€ä¸ªå‡½æ•°å’Œå¦å¤–ä¸€ä¸ªå‡½æ•°ç»“åˆèµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªæ–°å‡½æ•°ã€‚æ¯”å¦‚ï¼Œä¸ºäº†è¦åˆ›å»ºisOddå‡½æ•°ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠè¿™ä¸¤ä¸ªå‡½æ•°â€œç»„åˆâ€åœ¨ä¸€èµ·ï¼Œå¾—åˆ°isOddã€‚</p><pre><code class=\"language-javascript\">var isOdd = (x) =&gt; equalsToOne(remainderOfTwo(x));\n</code></pre><h3>å‡½æ•°ç»„ä»¶</h3><p>æ¥ç€ï¼Œæˆ‘ä»¬å†æ¥çœ‹å‡½æ•°ç»„ä»¶ã€‚</p><p>åœ¨ä»¥ä¸‹çš„ä»£ç ç¤ºä¾‹å½“ä¸­ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰äº†ä¸¤ä¸ªå‡½æ•°ï¼šç¬¬ä¸€ä¸ªæ˜¯dividedByï¼Œå®ƒçš„ä½œç”¨æ˜¯è®¡ç®—xé™¤ä»¥yçš„ä½™æ•°ï¼›ç¬¬äºŒä¸ªæ˜¯equalsToï¼Œå®ƒæ˜¯ç”¨æ¥çœ‹ä½™æ•°æ˜¯å¦ç­‰äº1ã€‚</p><p>è¿™ä¸¤ä¸ªå‡½æ•°å…¶å®å°±æ˜¯æˆ‘ä»¬ç”¨åˆ°çš„ç»„ä»¶å‡½æ•°ã€‚ä½ å¯ä»¥å‘ç°ï¼Œè¿™ä¸¤ä¸ªç»„ä»¶çš„ç‰¹ç‚¹éƒ½æ˜¯åŠªåŠ›ä¸“æ³¨åšå¥½ä¸€ä»¶å°äº‹ã€‚</p><pre><code class=\"language-javascript\">var dividedBy = (y) =&gt; {\n    return function forX(x) {\n        return x % y;\n    }\n}\nvar equalsTo = (y) =&gt; {\n    return function forX(x) {\n        return x === y;\n    }\n}\n</code></pre><p>ç„¶åï¼Œåœ¨dividedByå’ŒequalsToOneçš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºä¸¤ä¸ªPoint-Freeçš„å‡½æ•°ï¼ŒremainderOfTwoå’ŒequalsToOneã€‚</p><pre><code class=\"language-javascript\">var remainderOfTwo = dividedBy(2);\nvar equalsToOne = equalsTo(1);\n</code></pre><p>æœ€åï¼Œæˆ‘ä»¬åªéœ€è¦ä¼ å…¥å‚æ•° xï¼Œå°±å¯ä»¥è®¡ç®—ç›¸åº”çš„isOddçš„ç»“æœäº†ã€‚</p><pre><code class=\"language-javascript\">var isOdd = (x) =&gt; equalsToOne(remainderOfTwo(x));\n</code></pre><p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬çŸ¥é“äº†ï¼Œå‡½æ•°æ˜¯å¯ä»¥é€šè¿‡å†™æˆç»„ä»¶æ¥åº”ç”¨çš„ã€‚è¿™é‡Œå…¶å®å°±æ˜¯ç”¨åˆ°äº†å‡½æ•°å¼ç¼–ç¨‹<strong>å£°æ˜å¼</strong>çš„æ€æƒ³ï¼ŒequalsToOneå’ŒremainderByTwoï¼Œä¸ä»…æŠŠè¿‡ç¨‹è¿›è¡Œäº†å°è£…ï¼Œè€Œä¸”æŠŠå‚æ•°ä¹Ÿå»æ‰äº†ï¼Œæš´éœ²ç»™ä½¿ç”¨è€…çš„å°±æ˜¯<strong>åŠŸèƒ½æœ¬èº«</strong>ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠè¿™ä¸¤ä¸ªå‡½æ•°ç»„ä»¶çš„åŠŸèƒ½ç»“åˆèµ·æ¥ï¼Œå°±å¯ä»¥å®ç°isOddå‡½æ•°äº†ã€‚</p><h3>ç‹¬ç«‹çš„ç»„åˆå‡½æ•°</h3><p>ä¸‹é¢æˆ‘ä»¬å†æ¥çœ‹çœ‹ç‹¬ç«‹çš„ç»„åˆå‡½æ•°ã€‚</p><p>å…¶å®ä»ä¸Šé¢çš„ä¾‹å­é‡Œï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†ç»„åˆçš„å½±å­ã€‚é‚£ä¹ˆæ›´è¿›ä¸€æ­¥åœ°ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠç»„åˆæŠ½è±¡æˆä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-javascript\">function compose(...fns) {\n&nbsp; &nbsp; return fns.reverse().reduce( function reducer(fn1,fn2){\n&nbsp; &nbsp; &nbsp; &nbsp; return function composed(...args){\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return fn2( fn1( ...args ) );\n&nbsp; &nbsp; &nbsp; &nbsp; };\n&nbsp; &nbsp; } );\n}\n</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŸºäºè¿™é‡ŒæŠ½è±¡å‡ºæ¥çš„composeåŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¹‹å‰çš„ç»„ä»¶å‡½æ•°ç»„åˆèµ·æ¥ã€‚</p><pre><code class=\"language-javascript\">var isOdd = compose(equalsToOne, remainderOfTwo);\n</code></pre><p>æ‰€ä»¥ï¼Œå›åˆ°è¯¾ç¨‹ä¸€å¼€å§‹æåˆ°çš„é—®é¢˜ï¼šä¸ºä»€ä¹ˆç»„åˆæ˜¯åç›´è§‰çš„ï¼Ÿå› ä¸ºå®ƒæ˜¯æŒ‰ç…§<strong>ä¼ å‚é¡ºåº</strong>æ¥æ’åˆ—çš„ã€‚</p><p>å‰é¢è®²çš„è¿™ä¸ªç»„åˆï¼Œå…¶å®å°±æ˜¯ <code>equalsToOne(remainderOfTwo(x))</code>ã€‚åœ¨æ•°å­¦ä¸­ï¼Œç»„åˆå†™æˆ <code>fog</code>ï¼Œæ„æ€å°±æ˜¯ä¸€ä¸ªå‡½æ•°æ¥æ”¶ä¸€ä¸ªå‚æ•°xï¼Œå¹¶è¿”å›æˆä¸€ä¸ª <code>f(g(x))</code>ã€‚</p><p>å¥½ï¼Œä¸è¿‡çœ‹åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½è¿˜æ˜¯è§‰å¾—ï¼Œå³ä½¿è‡ªå·±ç†è§£äº†å®ƒçš„æ¦‚å¿µï¼Œä½†æ˜¯ä»ç„¶è§‰å¾—å®ƒåç›´è§‰ï¼Œå› æ­¤æƒ³è¦ä¸€ç§æ›´ç›´è§‚çš„é¡ºåºæ¥å®Œæˆä¸€ç³»åˆ—æ“ä½œã€‚è¿™ä¸ªä¹Ÿæœ‰ç›¸åº”çš„è§£å†³æ–¹æ¡ˆï¼Œé‚£å°±æ˜¯ç”¨å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„<strong>ç®¡é“</strong>ã€‚</p><h2>ç®¡é“Pipeline</h2><p>å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„ç®¡é“ï¼Œæ˜¯å¦å¤–ä¸€ç§å‡½æ•°çš„åˆ›å»ºæ–¹å¼ã€‚è¿™æ ·åˆ›å»ºå‡ºæ¥çš„å‡½æ•°çš„ç‰¹ç‚¹æ˜¯ï¼š<strong>ä¸€ä¸ªå‡½æ•°çš„è¾“å‡ºä¼šä½œä¸ºä¸‹ä¸€ä¸ªå‡½æ•°çš„è¾“å…¥ï¼Œç„¶åæŒ‰é¡ºåºæ‰§è¡Œ</strong>ã€‚</p><p>æ‰€ä»¥ï¼Œç®¡é“å°±æ˜¯ä»¥ç»„åˆåè¿‡æ¥çš„æ–¹å¼æ¥å¤„ç†çš„ã€‚</p><h3>Unix/Linuxä¸­çš„ç®¡é“</h3><p>å…¶å®ç®¡é“çš„æ¦‚å¿µæœ€æ—©æ˜¯æºäºUnix/Linuxï¼Œè¿™ä¸ªæ¦‚å¿µçš„åˆ›å§‹äººé“æ ¼æ‹‰æ–¯Â·éº¦å…‹ç½—ä¼Šï¼ˆDouglas McIlroyï¼‰åœ¨è´å°”å®éªŒå®¤çš„æ–‡ç« ä¸­ï¼Œæ›¾ç»æåˆ°è¿‡ä¸¤ä¸ªå¾ˆé‡è¦çš„ç‚¹ï¼š</p><ul>\n<li>ä¸€æ˜¯è®©æ¯ä¸ªç¨‹åºåªä¸“æ³¨åšå¥½ä¸€ä»¶äº‹ã€‚å¦‚æœæœ‰å…¶å®ƒæ–°çš„ä»»åŠ¡ï¼Œé‚£ä¹ˆåº”è¯¥é‡æ–°æ„å»ºï¼Œè€Œä¸æ˜¯é€šè¿‡æ·»åŠ æ–°åŠŸèƒ½ä½¿æ—§ç¨‹åºå¤æ‚åŒ–ã€‚</li>\n<li>äºŒæ˜¯è®©æ¯ä¸ªç¨‹åºçš„è¾“å‡ºï¼Œå¯ä»¥æˆä¸ºå¦ä¸€ä¸ªç¨‹åºçš„è¾“å…¥ã€‚</li>\n</ul><p><span class=\"reference\">æ„Ÿå…´è¶£çš„è¯ä½ ä¹Ÿå¯ä»¥è¯»ä¸€ä¸‹<a href=\"http://emulator.pdp-11.org.ru/misc/1978.07_-_Bell_System_Technical_Journal.pdf\">è¿™ç¯‡æ‚å¿—æ–‡ç« </a>ï¼Œè™½ç„¶è¿™æ˜¯1978å¹´çš„æ–‡ç« ï¼Œä½†æ˜¯å®ƒçš„è®¾è®¡æ€æƒ³åˆ°ç°åœ¨éƒ½ä¸ç®—è¿‡æ—¶ã€‚</span></p><p><img src=\"https://static001.geekbang.org/resource/image/41/43/413491e226569ec2b52ed3f1e397b543.jpg?wh=1920x355\" alt=\"å›¾ç‰‡\"></p><p>å¥½ï¼Œé‚£ä¹ˆç°åœ¨ï¼Œæˆ‘ä»¬å°±æ¥çœ‹ä¸€ä¸ªç®€å•çš„ç®¡é“ä¾‹å­ï¼Œåœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å½“å‰ç›®å½•ä¸‹é¢æ‰€æœ‰çš„JavaScriptæ–‡ä»¶ã€‚</p><pre><code class=\"language-powershell\">$ ls -1 | grep \"js$\" | wc -l\n</code></pre><p>ä½ èƒ½å‘ç°ï¼Œè¿™ä¸ªç®¡é“æœ‰ç«–çº¿â€œ | â€éš”å¼€çš„ä¸‰ä¸ªéƒ¨åˆ†ã€‚ç¬¬ä¸€ä¸ªéƒ¨åˆ† <code>ls -1</code>ï¼Œåˆ—å‡ºå¹¶è¿”å›äº†å½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶ï¼Œè¿™ä¸ªç»“æœä½œä¸ºäº†ç¬¬äºŒæ­¥ <code>grep \"js$\"</code> çš„è¾“å…¥ï¼›ç¬¬äºŒä¸ªéƒ¨åˆ†ä¼šè¿‡æ»¤å‡ºæ‰€æœ‰çš„ä»¥ <code>js</code> ç»“å°¾çš„æ–‡ä»¶ï¼›ç„¶åç¬¬äºŒæ­¥çš„ç»“æœä¼šä½œä¸ºç¬¬ä¸‰éƒ¨åˆ†çš„è¾“å…¥ï¼Œåœ¨ç¬¬ä¸‰æ­¥ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°æœ€åè®¡ç®—çš„ç»“æœã€‚</p><h3>JavaScriptä¸­çš„ç®¡é“</h3><p>å›åˆ°JavaScriptä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨isOddçš„ä¾‹å­ï¼Œæ¥çœ‹çœ‹åŒæ ·çš„åŠŸèƒ½è¦å¦‚ä½•é€šè¿‡ç®¡é“æ¥å®ç°ã€‚</p><p>å…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡ä¸€ä¸ªreverseArgså‡½æ•°ï¼Œå°†composeä¸­æ¥æ”¶å‚æ•°çš„é¡ºåºåè¿‡æ¥å³å¯ã€‚</p><p>ä½ å¯èƒ½ä¼šæƒ³åˆ°æˆ‘ä»¬åœ¨ä¸ŠèŠ‚è¯¾è®²unaryçš„æ—¶å€™ï¼Œæ˜¯æŠŠå‡½æ•°çš„è¾“å…¥å‚æ•°å‡å°‘åˆ°1ï¼Œè€Œè¿™é‡Œæ˜¯<strong>æŠŠå‚æ•°åšå€’åºå¤„ç†ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„å‡½æ•°</strong>ã€‚åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œè¿™ç®—æ˜¯ä¸€ä¸ªæ¯”è¾ƒç»å…¸çš„é«˜é˜¶å‡½æ•°çš„ä¾‹å­ã€‚</p><pre><code class=\"language-javascript\">function reverseArgs(fn) {\n&nbsp; &nbsp; return function argsReversed(...args){\n&nbsp; &nbsp; &nbsp; &nbsp; return fn( ...args.reverse() );\n&nbsp; &nbsp; };\n}\n\nvar pipe = reverseArgs( compose );\n</code></pre><p>ç„¶åæˆ‘ä»¬å¯ä»¥æµ‹è¯•ä¸‹ç®¡é“æ˜¯å¦â€œç•…é€šâ€ã€‚è¿™æ¬¡ï¼Œæˆ‘ä»¬æŠŠremainderOfTwoå’ŒequalsToOneæŒ‰ç…§æ¯”è¾ƒç›´è§‚çš„æ–¹å¼è¿›è¡Œæ’åºã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼ŒisOdd(1)è¿”å›çš„ç»“æœæ˜¯trueï¼ŒisOdd(2)è¿”å›çš„ç»“æœæ˜¯falseï¼Œå’Œæˆ‘ä»¬é¢„æœŸçš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚</p><pre><code class=\"language-javascript\">const isOdd = pipe(remainderOfTwo, equalsToOne);\n\nisOdd(1); // è¿”å› true\nisOdd(2); // è¿”å› false\n</code></pre><h2>Transduction</h2><p>è®²å®Œäº†ç»„åˆå’Œç®¡é“ä¹‹åï¼Œè¿˜æœ‰ä¸€ä¸ªåœ°æ–¹æƒ³å†è·Ÿä½ å¼ºè°ƒä¸‹ã€‚</p><p>æˆ‘ä¸€å†è¯´è¿‡ï¼Œå‡½æ•°å¼ç¼–ç¨‹ä¸­çš„å¾ˆå¤šæ¦‚å¿µï¼Œéƒ½æ¥è‡ªäºå¯¹å¤æ‚ã€åŠ¨åŠ›ç³»ç»Ÿç ”ç©¶ä¸æ§åˆ¶ç­‰é¢†åŸŸã€‚è€Œé€šè¿‡ç»„åˆå’Œç®¡é“ï¼Œæˆ‘ä»¬å¯ä»¥å†å»¶ä¼¸æ¥çœ‹ä¸€ä¸‹è½¬å¯¼ï¼ˆtransducingï¼‰ã€‚</p><p><strong>è½¬å¯¼ä¸»è¦ç”¨äºæ§åˆ¶ç³»ç»Ÿ</strong>ï¼ˆControl Systemï¼‰ï¼Œæ¯”å¦‚å£°æ³¢ä½œä¸ºè¾“å…¥ï¼Œé€šè¿‡éº¦å…‹é£è¿›å…¥åˆ°ä¸€ä¸ªåŠŸæ”¾ï¼Œç„¶ååŠŸæ”¾è¿›è¡Œèƒ½é‡è½¬æ¢ï¼Œæœ€åé€šè¿‡å–‡å­ä¼ å‡ºå£°éŸ³çš„è¿™æ ·ä¸€ä¸ªç³»ç»Ÿï¼Œå°±å¯ä»¥æˆä¸ºè½¬å¯¼ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/cc/c4/ccf13111a8c165e93da865dcdf1b44c4.jpg?wh=1920x614\" alt=\"å›¾ç‰‡\"></p><p>å½“ç„¶ï¼Œå•ç‹¬çœ‹è¿™ä¸ªè¯ï¼Œä½ æˆ–è®¸å¹¶æ²¡æœ‰ä»€ä¹ˆå°è±¡ï¼Œä½†æ˜¯å¦‚æœè¯´React.jsï¼Œä½ åº”è¯¥çŸ¥é“è¿™æ˜¯ä¸€ä¸ªå¾ˆè‘—åçš„å‰ç«¯æ¡†æ¶ã€‚åœ¨è¿™é‡Œé¢çš„reducerçš„æ¦‚å¿µï¼Œå°±ç”¨åˆ°äº†transducingã€‚</p><p>åœ¨åé¢çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬è®²åˆ°å“åº”å¼ç¼–ç¨‹å’Œè§‚å¯Ÿè€…æ¨¡å¼çš„æ—¶å€™ï¼Œè¿˜ä¼šæ›´æ·±å…¥äº†è§£reducerã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å°±å…ˆæ¥çœ‹çœ‹transduceå’Œreducerçš„ä½œç”¨ä»¥åŠåŸç†ã€‚</p><p>é‚£ä¹ˆï¼Œ<strong>reduceræ˜¯åšä»€ä¹ˆç”¨çš„å‘¢ï¼Ÿ</strong>å®ƒæœ€ä¸»è¦çš„ä½œç”¨å…¶å®æ˜¯è§£å†³åœ¨ä½¿ç”¨å¤šä¸ªmapã€filterã€reduceæ“ä½œå¤§å‹æ•°ç»„æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿçš„æ€§èƒ½é—®é¢˜ã€‚</p><p>è€Œé€šè¿‡ä½¿ç”¨transducerå’Œreducerï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¼˜åŒ–ä¸€ç³»åˆ—mapã€filterã€reduceæ“ä½œï¼Œä½¿å¾—è¾“å…¥æ•°ç»„åªè¢«å¤„ç†ä¸€æ¬¡å¹¶ç›´æ¥äº§ç”Ÿè¾“å‡ºç»“æœï¼Œè€Œä¸éœ€è¦åˆ›å»ºä»»ä½•ä¸­é—´æ•°ç»„ã€‚</p><p>å¯èƒ½æˆ‘è¿™ä¹ˆè®²ï¼Œä½ è¿˜æ˜¯ä¸å¤ªå¥½ç†è§£ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆæ¥ä¸¾ä¸€ä¸ªä¸ç”¨tansduceræˆ–reducerä¾‹å­å§ã€‚</p><pre><code class=\"language-javascript\">var oldArray = [36, 29, 18, 7, 46, 53];\nvar newArray = oldArray\n  .filter(isEven)\n  .map(double)\n  .filter(passSixty)\n  .map(addFive);\n  \nconsole.log (newArray); // è¿”å›ï¼š[77,97]\n</code></pre><p>åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬å¯¹ä¸€ç»„æ•°ç»„è¿›è¡Œäº†ä¸€ç³»åˆ—çš„æ“ä½œï¼Œå…ˆæ˜¯ç­›é€‰å‡ºå¥‡æ•°ï¼Œå†ä¹˜ä»¥äºŒï¼Œä¹‹åç­›å‡ºå¤§äºå…­åçš„å€¼ï¼Œæœ€ååŠ ä¸Šäº”ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¼šä¸æ–­ç”Ÿæˆä¸­é—´æ•°ç»„ã€‚</p><p>è¿™ä¸ªå®é™…å‘ç”Ÿçš„è¿‡ç¨‹å¦‚ä¸‹å›¾å·¦åŠéƒ¨åˆ†æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/aa/45/aa5dbd1ff55485d4c596e77801759545.jpg?wh=1920x1080\" alt=\"å›¾ç‰‡\"></p><p>è€Œå¦‚æœä½¿ç”¨reducerçš„è¯ï¼Œæˆ‘ä»¬å¯¹æ¯ä¸ªå€¼åªéœ€è¦æ“ä½œä¸€æ¬¡ï¼Œå°±å¯äº§å‡ºæœ€ç»ˆçš„ç»“æœã€‚å¦‚ä¸Šå›¾çš„å³åŠéƒ¨åˆ†æ‰€ç¤ºã€‚</p><p>é‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ˜¯å…ˆå°†ä¸€ä¸ªå‡½æ•°ï¼Œæ¯”å¦‚isEvenä½œä¸ºè¾“å…¥ï¼Œæ”¾åˆ°äº†ä¸€ä¸ªtransduceré‡Œï¼Œç„¶åä½œä¸ºè¾“å‡ºï¼Œæˆ‘ä»¬å¾—åˆ°çš„æ˜¯ä¸€ä¸ªisEvenRçš„reducerå‡½æ•°ã€‚</p><p>æ˜¯çš„ï¼Œè¿™é‡Œçš„transducerå…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªç»å…¸çš„é«˜é˜¶å‡½æ•°ï¼ˆå³è¾“å…¥ä¸€ä¸ªå‡½æ•°ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼‰çš„ä¾‹å­ï¼</p><p>å®é™…ä¸Šï¼Œåƒ <strong>doubleå’ŒaddFiveéƒ½å…·æœ‰æ˜ å°„ç±»çš„åŠŸèƒ½</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç±»ä¼¼mapReducerè¿™æ ·çš„ä¸€ä¸ªtransducerï¼Œæ¥æŠŠå®ƒä»¬è½¬æ¢æˆreducerã€‚è€Œåƒ <strong>isEvenå’ŒpassSixtyéƒ½æ˜¯ç­›é€‰ç±»çš„åŠŸèƒ½</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç±»ä¼¼filterReducerè¿™æ ·çš„ä¸€ä¸ªtransducerï¼Œæ¥æŠŠå®ƒä»¬è½¬æ¢æˆ reducerã€‚</p><p>å¦‚æœæˆ‘ä»¬æŠ½è±¡åŒ–æ¥çœ‹ï¼Œå…¶ä»£ç å¤§è‡´å¦‚ä¸‹ã€‚å®ƒçš„å…·ä½“å®ç°è¿™é‡Œæˆ‘å–ä¸ªå…³å­ï¼Œä½ å¯ä»¥å…ˆè‡ªå·±æ€è€ƒä¸‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†æ¢è®¨ã€‚</p><pre><code class=\"language-javascript\">var oldArray = [36, 29, 18, 7, 46, 53];\n\nvar newArray = composeReducer(oldArray, [\n  filterTR(isEven),\n  mapTR(double),\n  filterTR(passSixty),\n  mapTR(addfive),\n]); \n\nconsole.log (newArray); // è¿”å›ï¼š[77,97]\n</code></pre><p>æ€»è€Œè¨€ä¹‹ï¼Œä»ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥composeReducerç”¨çš„å°±æ˜¯ä¸€ä¸ªç±»ä¼¼ç»„åˆçš„åŠŸèƒ½ã€‚</p><h2>æ€»ç»“</h2><p>è¿™èŠ‚è¯¾é€šè¿‡å¯¹ç»„åˆå’Œç®¡é“çš„äº†è§£ï¼Œç›¸ä¿¡ä½ å¯ä»¥çœ‹å‡ºæ¥ï¼Œå®ƒä»¬å’Œä¸ŠèŠ‚è¯¾æˆ‘ä»¬è®²åˆ°çš„éƒ¨åˆ†åº”ç”¨å’ŒæŸ¯é‡ŒåŒ–æ­£å¥½ç›¸åï¼Œä¸€ä¸ªæ˜¯ä»å…·è±¡èµ°å‘æŠ½è±¡ï¼Œä¸€ä¸ªæ˜¯ä»æŠ½è±¡èµ°å‘å…·è±¡ã€‚</p><p>ä¸è¿‡ï¼Œè™½ç„¶è¯´å®ƒä»¬çš„æ–¹å‘æ˜¯ç›¸åçš„ï¼Œä½†æœ‰ä¸€æ¡åŸåˆ™æ˜¯ä¸€è‡´çš„ï¼Œé‚£å°±æ˜¯<strong>æ¯ä¸ªå‡½æ•°å°½é‡æœ‰ä¸€ä¸ªå•ä¸€èŒè´£ï¼Œåªä¸“æ³¨åšå¥½ä¸€ä»¶äº‹</strong>ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„æ–¹å‘ä¸åŒï¼Œå¹¶ä¸æ˜¯æŒ‡æˆ‘ä»¬è¦ç”¨æŠ½è±¡å–ä»£å…·è±¡ï¼Œæˆ–è€…æ˜¯ç”¨å…·è±¡å–ä»£æŠ½è±¡ã€‚è€Œæ˜¯è¯´å®ƒä»¬éƒ½æ˜¯ä¸ºäº†<strong>å•ä¸€èŒè´£å‡½æ•°</strong>çš„åŸåˆ™ï¼Œç›¸è¾…ç›¸æˆåœ°å»å…·è±¡åŒ–æˆ–æŠ½è±¡åŒ–ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/69/16/691043e9f3cayy8fc8c03934b4daaf16.jpg?wh=1920x807\" alt=\"å›¾ç‰‡\"></p><p>å¦å¤–ï¼Œé€šè¿‡reducerçš„ä¾‹å­ï¼Œæˆ‘ä»¬ä¹ŸçŸ¥é“äº†å¦‚ä½•é€šè¿‡reducerçš„ç»„åˆï¼Œåšåˆ°æ™®é€šçš„ç»„åˆè¾¾ä¸åˆ°çš„<strong>æ€§èƒ½æå‡</strong>ã€‚</p><p>åœ¨è¿™èŠ‚è¯¾é‡Œï¼Œæˆ‘ä»¬æ˜¯å…ˆä»ä¸€ä¸ªæŠ½è±¡å±‚é¢ç†è§£äº†reducerï¼Œä¸è¿‡ä½ å¯èƒ½ä»ç„¶å¯¹mapã€filterã€reduceç­‰æ¦‚å¿µå’Œå…·ä½“å®ç°æ„Ÿåˆ°æœ‰äº›é™Œç”Ÿã€‚ä¸ç”¨æ‹…å¿ƒï¼Œä¸‹èŠ‚è¯¾æˆ‘å°±å¸¦ä½ æ¥è¿›ä¸€æ­¥äº†è§£è¿™ä¸€ç³»åˆ—é’ˆå¯¹å€¼çš„æ“ä½œå·¥å…·çš„æœºåˆ¶ï¼Œä»¥åŠfunctorå’Œmonadã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æˆ‘ä»¬è®²åˆ°reduceå¯ä»¥ç”¨æ¥å®ç°mapå’Œfilter ï¼Œé‚£ä¹ˆä½ çŸ¥é“è¿™èƒŒåçš„åŸç†å—ï¼Ÿæ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„ç­”æ¡ˆï¼Œæˆ–è€…ä½ å¦‚æœå¯¹æ­¤å¹¶ä¸ååˆ†äº†è§£ï¼Œä¹Ÿå¸Œæœ›ä½ èƒ½æ‰¾æ‰¾èµ„æ–™ï¼Œä½œä¸ºä¸‹èŠ‚è¯¾çš„é¢„ä¹ å†…å®¹ã€‚</p><p>å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨è¯„è®ºåŒºäº¤æµä¸‹è‡ªå·±çš„ç–‘é—®ï¼Œæˆ‘ä»¬ä¸€èµ·è®¨è®ºã€å…±åŒè¿›æ­¥ã€‚</p>","neighbors":{"left":{"article_title":"03 | å¦‚ä½•é€šè¿‡éƒ¨åˆ†åº”ç”¨å’ŒæŸ¯é‡ŒåŒ–è®©å‡½æ•°å…·è±¡åŒ–ï¼Ÿ","id":574132},"right":{"article_title":"05ï½œmapã€reduceå’Œmonadå¦‚ä½•å›´ç»•å€¼è¿›è¡Œæ“ä½œï¼Ÿ","id":576500}},"comments":[{"had_liked":false,"id":358366,"user_name":"å¡å¡","can_delete":false,"product_type":"c1","uid":1379414,"ip_address":"åŒ—äº¬","ucode":"C50FF72A04F742","user_header":"https://static001.geekbang.org/account/avatar/00/15/0c/56/9b2bca2f.jpg","comment_is_top":false,"comment_ctime":1664248635,"is_pvip":false,"replies":[{"id":"130434","content":"æ˜¯çš„ï¼Œè¿™é‡Œåˆ©ç”¨äº†reduceçš„ç¬¬äºŒä¸ªå‚æ•°çš„åˆå§‹å€¼å¯ä»¥æ˜¯ä¸€ä¸ªâ€œç©ºæ•°ç»„â€ï¼Œæ˜ å°„æˆ–è¿‡æ»¤åï¼Œæ”¾å…¥â€œæ–°æ•°ç»„â€ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2785919","ctime":1664354742,"ip_address":"åŒ—äº¬","comment_id":358366,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14549150523","product_id":100122101,"comment_content":"æˆ‘çš„ç†è§£æ˜¯ï¼šreduceå¯ä»¥å¯¹åŸé›†åˆçš„æ¯ä¸ªå…ƒç´ ä½¿ç”¨mapå›è°ƒå‡½æ•°è¿›è¡Œæ˜ å°„æˆ–è€…ä½¿ç”¨filterå›è°ƒå‡½æ•°è¿›è¡Œè¿‡æ»¤ï¼Œç„¶åå°†æ–°å€¼æ”¾å…¥æ–°çš„é›†åˆ<br><br>mapReduceçš„å®ç°ï¼š<br>Array.prototype.mapReduce = function (cb, initValue) {<br>  return this.reduce(function (mappedArray, curValue, curIndex, array) {<br>    mappedArray[curIndex] = cb.call(initValue, curValue, curIndex, array);<br>    return mappedArray;<br>  }, []);<br>};<br><br>filterReduceçš„å®ç°ï¼š<br>Array.prototype.filterReduce = function (cb, initValue) {<br>  return this.reduce(function (mappedArray, curValue, curIndex, array) {<br>    if (cb.call(initValue, curValue, curIndex, array)) {<br>      mappedArray.push(curValue);<br>    }<br>    return mappedArray;<br>  }, []);<br>};","like_count":3,"discussions":[{"author":{"id":2785919,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/82/7f/c22de3a3.jpg","nickname":"çŸ³å·","note":"","ucode":"99E480A265E25F","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589033,"discussion_content":"æ˜¯çš„ï¼Œè¿™é‡Œåˆ©ç”¨äº†reduceçš„ç¬¬äºŒä¸ªå‚æ•°çš„åˆå§‹å€¼å¯ä»¥æ˜¯ä¸€ä¸ªâ€œç©ºæ•°ç»„â€ï¼Œæ˜ å°„æˆ–è¿‡æ»¤åï¼Œæ”¾å…¥â€œæ–°æ•°ç»„â€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1664354742,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358418,"user_name":"é˜","can_delete":false,"product_type":"c1","uid":1518535,"ip_address":"åŒ—äº¬","ucode":"0106652D5F7BD9","user_header":"https://static001.geekbang.org/account/avatar/00/17/2b/c7/9c8647c8.jpg","comment_is_top":false,"comment_ctime":1664281466,"is_pvip":true,"replies":[{"id":"130636","content":"å¸¥ï¼ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2785919","ctime":1665327380,"ip_address":"åŒ—äº¬","comment_id":358418,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10254216058","product_id":100122101,"comment_content":"éœä¸‹å¿ƒä¾†é‡çœ‹ä¸€æ¬¡, å¥½åƒçœ‹æ‡‚äº†, ä»¥ä¸‹æ˜¯æˆ‘å°æ–¼ composeReducer çš„å¯¦ä½œï¼š<br><br>```<br>const { filterTR, mapTR, composeReducer } = (() =&gt; {<br>\tfunction applyTypeForFunction(fn, type) {<br>\t\tfn.type = type;<br>\t\treturn fn;<br>\t}<br><br>\tfunction filterTR(fn) {<br>\t\treturn applyTypeForFunction(fn, &quot;filter&quot;);<br>\t}<br><br>\tfunction mapTR(fn) {<br>\t\treturn applyTypeForFunction(fn, &quot;map&quot;);<br>\t}<br><br>\tfunction composeReducer(inputArray, fnArray) {<br>\t\treturn inputArray.reduce((sum, element) =&gt; {<br>\t\t\tlet tmpVal = element;<br>\t\t\tlet tmpFn;<br><br>\t\t\tfor (let i = 0; i &lt; fnArray.length; i++) {<br>\t\t\t\ttmpFn = fnArray[i];<br>\t\t\t\tif (tmpFn.type === &quot;filter&quot; &amp;&amp; tmpFn(tmpVal) === false) {<br>\t\t\t\t\tconsole.log(`failed to pass filter: ${element} `);<br>\t\t\t\t\treturn sum;<br>\t\t\t\t}<br>\t\t\t\tif (tmpFn.type === &quot;map&quot;) {<br>\t\t\t\t\ttmpVal = tmpFn(tmpVal);<br>\t\t\t\t}<br>\t\t\t}<br><br>\t\t\tconsole.log(`${element} pass, result = ${tmpVal}`);<br>\t\t\tsum.push(tmpVal);<br><br>\t\t\treturn sum;<br>\t\t}, []);<br>\t}<br><br>\treturn {<br>\t\tfilterTR,<br>\t\tmapTR,<br>\t\tcomposeReducer<br>\t};<br>})();<br><br>const isEven = (v) =&gt; v % 2 === 0;<br>const passSixty = (v) =&gt; v &gt; 60;<br>const double = (v) =&gt; 2 * v;<br>const addFive = (v) =&gt; v + 5;<br><br>var oldArray = [36, 29, 18, 7, 46, 53];<br>var newArray = composeReducer(oldArray, [<br>\tfilterTR(isEven),<br>\tmapTR(double),<br>\tfilterTR(passSixty),<br>\tmapTR(addFive)<br>]);<br><br>console.log(newArray);<br>```","like_count":2,"discussions":[{"author":{"id":2785919,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/82/7f/c22de3a3.jpg","nickname":"çŸ³å·","note":"","ucode":"99E480A265E25F","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589823,"discussion_content":"å¸¥ï¼ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665327380,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358475,"user_name":"I keep my idealsğŸ’¤","can_delete":false,"product_type":"c1","uid":1483413,"ip_address":"åŒ—äº¬","ucode":"38E68A0BCABA01","user_header":"https://static001.geekbang.org/account/avatar/00/16/a2/95/8f34237c.jpg","comment_is_top":false,"comment_ctime":1664346657,"is_pvip":true,"replies":[{"id":"130501","content":"1. å¼‚æ­¥å¯ä»¥è€ƒè™‘ç»“åˆCPSçš„promise&#47;thenï¼Œæˆ– async&#47;awaitæ¥è§£å†³ã€‚<br>2. æ²¡æœ‰è¿”å›å€¼ï¼Œå¯ä»¥è€ƒè™‘ç”¨Justå’ŒNothingç»„æˆMaybe monadã€‚<br>3. å¤šæ¡ä»¶åˆ†æ”¯çš„æƒ…å†µä¸‹å¯ä»¥è€ƒè™‘åœ¨Maybe monadä¸­åˆ›å»ºorElseçš„æ–¹æ³•ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2785919","ctime":1664691370,"ip_address":"åŒ—äº¬","comment_id":358475,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5959313953","product_id":100122101,"comment_content":"æƒ³è¯·æ•™ä¸€ä¸‹è€å¸ˆcomposeç»„åˆçš„æ–°å‡½æ•°é‡Œé¢å¦‚æœæœ‰æŸä¸€ä¸ªæ˜¯å¼‚æ­¥å‡½æ•°ï¼Œæˆ–è€…æ²¡æœ‰è¿”å›å€¼çš„æƒ…å†µä¸‹è¯¥æ€ä¹ˆå¤„ç†å‘¢ã€‚è¿˜æœ‰å¤šæ¡ä»¶åˆ†æ”¯çš„æƒ…å†µä¸‹åˆè¯¥å¦‚ä½•å¤„ç†å‘¢","like_count":1,"discussions":[{"author":{"id":2785919,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/82/7f/c22de3a3.jpg","nickname":"çŸ³å·","note":"","ucode":"99E480A265E25F","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589321,"discussion_content":"1. å¼‚æ­¥å¯ä»¥è€ƒè™‘ç»“åˆCPSçš„promise/thenï¼Œæˆ– async/awaitæ¥è§£å†³ã€‚\n2. æ²¡æœ‰è¿”å›å€¼ï¼Œå¯ä»¥è€ƒè™‘ç”¨Justå’ŒNothingç»„æˆMaybe monadã€‚\n3. å¤šæ¡ä»¶åˆ†æ”¯çš„æƒ…å†µä¸‹å¯ä»¥è€ƒè™‘åœ¨Maybe monadä¸­åˆ›å»ºorElseçš„æ–¹æ³•ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1664691370,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358362,"user_name":"å¤©æ‹©","can_delete":false,"product_type":"c1","uid":2166878,"ip_address":"åŒ—äº¬","ucode":"ED2B08DB2F2B38","user_header":"https://static001.geekbang.org/account/avatar/00/21/10/5e/42f4faf7.jpg","comment_is_top":false,"comment_ctime":1664246063,"is_pvip":true,"replies":[{"id":"130425","content":"å—¯å—¯ï¼Œæ˜¯è¿™æ ·çš„ï¼Œæ— è®ºå…·è±¡è¿˜æ˜¯æŠ½è±¡ï¼Œç›®çš„éƒ½æ˜¯å­¦ä»¥è‡´ç”¨","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2785919","ctime":1664331079,"ip_address":"åŒ—äº¬","comment_id":358362,"utype":1}],"discussion_count":1,"race_medal":1,"score":"5959213359","product_id":100122101,"comment_content":"æœ€è¿‘ä¸¤ç¯‡æ–‡ç« çš„çŸ¥è¯†å¸¸åœ¨æ¡†æ¶å’Œåº“çš„ä»£ç é‡Œé¢è§åˆ°ï¼Œä¹Ÿä¼šç»™æˆ‘ä»¬é˜…è¯»æºç æä¾›å¸®åŠ©ã€‚<br>å…·ä½“å’ŒæŠ½è±¡éƒ½æ˜¯ä¸ºä½¿ç”¨ç›®æ ‡æœåŠ¡çš„ï¼Œä¸ç®¡æ˜¯æŸ¯é‡ŒåŒ–è¿˜æ˜¯å‡½æ•°ç»„ä»¶ï¼Œéƒ½æ˜¯ç»™ä½¿ç”¨è€…æä¾›æŸç§åœºæ™¯ä¸‹çš„ä¾¿åˆ©æ€§ï¼Œåªä¸è¿‡æœ‰çš„éœ€è¦å…·ä½“çš„æ‰‹æ®µï¼Œæœ‰çš„éœ€è¦æŠ½è±¡çš„æ‰‹æ®µã€‚","like_count":1,"discussions":[{"author":{"id":2785919,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/82/7f/c22de3a3.jpg","nickname":"çŸ³å·","note":"","ucode":"99E480A265E25F","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589006,"discussion_content":"å—¯å—¯ï¼Œæ˜¯è¿™æ ·çš„ï¼Œæ— è®ºå…·è±¡è¿˜æ˜¯æŠ½è±¡ï¼Œç›®çš„éƒ½æ˜¯å­¦ä»¥è‡´ç”¨","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1664331079,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360620,"user_name":"weineel","can_delete":false,"product_type":"c1","uid":1049741,"ip_address":"æ±Ÿè‹","ucode":"6DC6EF4F256A53","user_header":"https://static001.geekbang.org/account/avatar/00/10/04/8d/005c2ff3.jpg","comment_is_top":false,"comment_ctime":1666692807,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1666692807","product_id":100122101,"comment_content":"ç»å¸¸å†™å‡½æ•°å¼ä»£ç çš„æ—¶å€™å‡½æ•°å¥—å‡½æ•°ï¼Œä¸çŸ¥é“å¦‚ä½•é«˜æ•ˆè°ƒè¯•ï¼Œä¸çŸ¥é“è€å¸ˆåé¢æœ‰æ²¡æœ‰ç»éªŒåˆ†äº«ã€‚","like_count":0},{"had_liked":false,"id":359819,"user_name":"laoergege","can_delete":false,"product_type":"c1","uid":1288733,"ip_address":"åŒ—äº¬","ucode":"559CCF36805A04","user_header":"https://static001.geekbang.org/account/avatar/00/13/aa/1d/b8fdd622.jpg","comment_is_top":false,"comment_ctime":1665933320,"is_pvip":false,"replies":[{"id":"131018","content":"å› ä¸ºè¿™é‡Œæ˜¯composeï¼Œä¸æ˜¯pipelineï¼Œæ‰€ä»¥éœ€è¦reverseã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2785919","ctime":1666316219,"ip_address":"åŒ—äº¬","comment_id":359819,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1665933320","product_id":100122101,"comment_content":"```js<br><br>function compose(...fns) {<br>    return fns.reverse().reduce( function reducer(fn1,fn2){<br>        return function composed(...args){<br>            return fn2( fn1( ...args ) );<br>        };<br>    } );<br>}<br>```<br>è¿™é‡Œ reverse æ˜¯ä¸æ˜¯å¤šä½™äº†ã€‚ã€‚","like_count":0,"discussions":[{"author":{"id":2785919,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/82/7f/c22de3a3.jpg","nickname":"çŸ³å·","note":"","ucode":"99E480A265E25F","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591131,"discussion_content":"å› ä¸ºè¿™é‡Œæ˜¯composeï¼Œä¸æ˜¯pipelineï¼Œæ‰€ä»¥éœ€è¦reverseã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666316219,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":359721,"user_name":"Condor Hero","can_delete":false,"product_type":"c1","uid":1528334,"ip_address":"åŒ—äº¬","ucode":"BD850FE812D22F","user_header":"https://static001.geekbang.org/account/avatar/00/17/52/0e/c5ff46d2.jpg","comment_is_top":false,"comment_ctime":1665803010,"is_pvip":true,"replies":[{"id":"131017","content":"è¿™é‡Œæ˜¯è¯´remainderOfTwoå’ŒequalsToOneæ˜¯point-freeã€‚isOddæ˜¯ä¼ å‚çš„ï¼Œæ‰€ä»¥å®ƒä¸ç®—æ˜¯point-freeã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2785919","ctime":1666316111,"ip_address":"åŒ—äº¬","comment_id":359721,"utype":1}],"discussion_count":1,"race_medal":2,"score":"1665803010","product_id":100122101,"comment_content":"Point-Free è¿™ä¸ªä¾‹å­æ˜¯ä¸æ˜¯ä¸å¯¹ï¼Œæ¯•ç«Ÿ x å‚æ•°è¢«æ˜¾ç¤ºå®šä¹‰äº†ã€‚<br>&#47;&#47; Not point-free - `x` is an explicit argument<br>var isOdd = (x) =&gt; equalsToOne(remainderOfTwo(x));<br><br>Pointe-Free Style<br><br>å®šä¹‰å‡½æ•°æ—¶ï¼Œä¸æ˜¾å¼åœ°æŒ‡å‡ºå‡½æ•°æ‰€å¸¦å‚æ•°ã€‚è¿™ç§é£æ ¼é€šå¸¸éœ€è¦æŸ¯é‡ŒåŒ–æˆ–è€…é«˜é˜¶å‡½æ•°ã€‚ä¹Ÿå« Tacit programmingã€‚<br><br>&#47;&#47; å·²çŸ¥ï¼š<br>const map = (fn) =&gt; (list) =&gt; list.map(fn)<br>const add = (a) =&gt; (b) =&gt; a + b<br><br>&#47;&#47; æ‰€ä»¥ï¼š<br><br>&#47;&#47; éPoints-Free â€”â€” number æ˜¯æ˜¾å¼å‚æ•°<br>const incrementAll = (numbers) =&gt; map(add(1))(numbers)<br><br>&#47;&#47; Points-Free â€”â€” list æ˜¯éšå¼å‚æ•°<br>const incrementAll2 = map(add(1))<br><br>incrementAll è¯†åˆ«å¹¶ä¸”ä½¿ç”¨äº† numbers å‚æ•°ï¼Œå› æ­¤å®ƒä¸æ˜¯ Point-Free é£æ ¼çš„ã€‚ incrementAll2 ä»…è¿æ¥å‡½æ•°ä¸å€¼ï¼Œå¹¶ä¸æåŠå®ƒæ‰€ä½¿ç”¨çš„å‚æ•°ï¼Œå› ä¸ºå®ƒæ˜¯ Point-Free é£æ ¼çš„ã€‚<br><br>Point-Free é£æ ¼çš„å‡½æ•°å°±åƒå¹³å¸¸çš„èµ‹å€¼ï¼Œä¸ä½¿ç”¨ function æˆ–è€… =&gt;ã€‚","like_count":0,"discussions":[{"author":{"id":2785919,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/82/7f/c22de3a3.jpg","nickname":"çŸ³å·","note":"","ucode":"99E480A265E25F","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591130,"discussion_content":"è¿™é‡Œæ˜¯è¯´remainderOfTwoå’ŒequalsToOneæ˜¯point-freeã€‚isOddæ˜¯ä¼ å‚çš„ï¼Œæ‰€ä»¥å®ƒä¸ç®—æ˜¯point-freeã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1666316111,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358653,"user_name":"æ·±å±±ä½•å¤„é’Ÿ","can_delete":false,"product_type":"c1","uid":1100117,"ip_address":"åŒ—äº¬","ucode":"5D42024E40D751","user_header":"https://static001.geekbang.org/account/avatar/00/10/c9/55/3b2526ce.jpg","comment_is_top":false,"comment_ctime":1664518859,"is_pvip":false,"replies":[{"id":"130634","content":"å¦‚æœä¸ç”¨reverseArgsï¼Œpipeæ˜¯å¯ä»¥ç®€å•ç†è§£æˆè¿™æ ·çš„ï¼š <br>var pipe = (...fns) =&gt; (x) =&gt; fns.reduce((v, f) =&gt; f(v), x);","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2785919","ctime":1665312905,"ip_address":"åŒ—äº¬","comment_id":358653,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1664518859","product_id":100122101,"comment_content":"è¯·é—®è€å¸ˆï¼Œcomposeé‚£ä¸ªå‡½æ•°ï¼Œç›´æ¥fnsåä¸æ¥reverseï¼Œæ˜¯ä¸æ˜¯å°±æ˜¯pipeçš„æ•ˆæœå‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2785919,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/82/7f/c22de3a3.jpg","nickname":"çŸ³å·","note":"","ucode":"99E480A265E25F","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589805,"discussion_content":"å¦‚æœä¸ç”¨reverseArgsï¼Œpipeæ˜¯å¯ä»¥ç®€å•ç†è§£æˆè¿™æ ·çš„ï¼š \nvar pipe = (...fns) =&gt; (x) =&gt; fns.reduce((v, f) =&gt; f(v), x);","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665312905,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358463,"user_name":"ç¯ç«é˜‘çŠ","can_delete":false,"product_type":"c1","uid":1289991,"ip_address":"åŒ—äº¬","ucode":"D07A1D2101B9A9","user_header":"https://static001.geekbang.org/account/avatar/00/13/af/07/a32e3f4e.jpg","comment_is_top":false,"comment_ctime":1664335230,"is_pvip":false,"replies":[{"id":"130489","content":"æ˜¯çš„ï¼Œè¯´æ˜ç”Ÿæ´»ä¸­çš„ä¾‹å­æ— å¤„ä¸åœ¨ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2785919","ctime":1664678319,"ip_address":"åŒ—äº¬","comment_id":358463,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1664335230","product_id":100122101,"comment_content":"æˆ‘æ˜¯ä»åˆ¶é€ ä¸šè½¬è¡Œçš„ï¼Œå¯¹pipeå’Œæµæ°´çº¿æœ‰å¤©ç„¶çš„æ¥å—åº¦ï¼Œä¸Šä¸ªå·¥åºçš„åŠæˆå“å°±æ˜¯ä¸‹ä¸ªå·¥åºçš„å…¥å‚ã€‚","like_count":0,"discussions":[{"author":{"id":2785919,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/82/7f/c22de3a3.jpg","nickname":"çŸ³å·","note":"","ucode":"99E480A265E25F","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589303,"discussion_content":"æ˜¯çš„ï¼Œè¯´æ˜ç”Ÿæ´»ä¸­çš„ä¾‹å­æ— å¤„ä¸åœ¨ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1664678320,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358359,"user_name":"å¤©æ‹©","can_delete":false,"product_type":"c1","uid":2166878,"ip_address":"åŒ—äº¬","ucode":"ED2B08DB2F2B38","user_header":"https://static001.geekbang.org/account/avatar/00/21/10/5e/42f4faf7.jpg","comment_is_top":false,"comment_ctime":1664245753,"is_pvip":true,"replies":[{"id":"130426","content":"æ˜¯è¿™æ ·çš„","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2785919","ctime":1664332206,"ip_address":"åŒ—äº¬","comment_id":358359,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1664245753","product_id":100122101,"comment_content":"point freeçš„ç†è§£ï¼šæŠŠå‚æ•°å»æ‰ï¼Œæ˜¯æŒ‡å‚æ•°çš„å«ä¹‰å·²ç»ä½“ç°åœ¨å‡½æ•°å£°æ˜ï¼ˆåå­—ï¼‰é‡Œé¢äº†ï¼Œæ¯”å¦‚equalsToOneï¼Œé‚£å°±æ˜¯è¯´ä¼ å…¥çš„å€¼æ˜¯å¦ç­‰äº1ï¼Œå¦‚æœæ˜¯equalsToAï¼Œé‚£ä¹ˆè¿™ä¸ªAå°±å¾—ä¼ ä¸ºå‚æ•°ï¼ŒåŠ ä¸Šè¦æ¯”è¾ƒçš„xå°±æ˜¯ä¸¤ä¸ªå‚æ•°äº†ã€‚è¿™å°±æ˜¯æ‰€è°“â€œæš´éœ²ç»™ä½¿ç”¨è€…çš„å°±æ˜¯åŠŸèƒ½æœ¬èº«â€ã€‚","like_count":0,"discussions":[{"author":{"id":2785919,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/82/7f/c22de3a3.jpg","nickname":"çŸ³å·","note":"","ucode":"99E480A265E25F","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589008,"discussion_content":"æ˜¯è¿™æ ·çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1664332206,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}