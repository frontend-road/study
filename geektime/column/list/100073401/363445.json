{"id":363445,"title":"16 | å†…å­˜è§†è§’ï¼ˆäºŒï¼‰ï¼šå¦‚ä½•æœ‰æ•ˆé¿å…Cacheæ»¥ç”¨ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å´ç£Šã€‚</p><p>åœ¨Sparkçš„åº”ç”¨å¼€å‘ä¸­ï¼Œæœ‰æ•ˆåˆ©ç”¨Cacheå¾€å¾€èƒ½å¤§å¹…æå‡æ‰§è¡Œæ€§èƒ½ã€‚</p><p>ä½†æŸä¸€å¤©ï¼Œæœ‰ä½åŒå­¦å´å’Œæˆ‘è¯´ï¼Œè‡ªå·±åŠ äº†Cacheä¹‹åï¼Œæ‰§è¡Œæ€§èƒ½åè€Œå˜å·®äº†ã€‚ä»”ç»†çœ‹äº†è¿™ä½åŒå­¦çš„ä»£ç ä¹‹åï¼Œæˆ‘å“äº†ä¸€è·³ã€‚ä»£ç ä¸­å……æ–¥ç€å¤§é‡çš„<code>.cache</code>ï¼Œæ— è®ºæ˜¯RDDï¼Œè¿˜æ˜¯DataFrameï¼Œä½†å‡¡æœ‰åˆ†å¸ƒå¼æ•°æ®é›†çš„åœ°æ–¹ï¼Œåé¢å‡ ä¹éƒ½è·Ÿç€ä¸ª<code>.cache</code>ã€‚æ˜¾ç„¶ï¼ŒCacheæ»¥ç”¨æ˜¯æ‰§è¡Œæ€§èƒ½å˜å·®çš„å§‹ä½œä¿‘è€…ã€‚</p><p>å®é™…ä¸Šï¼Œåœ¨æœ‰äº›åœºæ™¯ä¸­ï¼ŒCacheæ˜¯çµä¸¹å¦™è¯ï¼Œè€Œåœ¨å¦ä¸€äº›åœºåˆï¼Œå¤§è‚†ä½¿ç”¨Cacheå´æˆäº†é¥®é¸©æ­¢æ¸´ã€‚é‚£Cacheåˆ°åº•è¯¥åœ¨ä»€ä¹ˆæ—¶å€™ç”¨ã€æ€ä¹ˆç”¨ï¼Œéƒ½æœ‰å“ªäº›æ³¨æ„äº‹é¡¹å‘¢ï¼Ÿä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å…ˆä¸€èµ·å›é¡¾Cacheçš„å·¥ä½œåŸç†ï¼Œå†æ¥å›ç­”è¿™äº›é—®é¢˜ã€‚</p><h2>Cacheçš„å·¥ä½œåŸç†</h2><p>åœ¨<a href=\"https://time.geekbang.org/column/article/355081\">å­˜å‚¨ç³»ç»Ÿ</a>é‚£ä¸€è®²ï¼Œæˆ‘ä»¬å…¶å®ä»‹ç»è¿‡RDDçš„ç¼“å­˜è¿‡ç¨‹ï¼Œåªä¸è¿‡å½“æ—¶çš„è§†è§’æ˜¯ä»¥MemoryStoreä¸ºä¸­å¿ƒï¼Œç›®çš„åœ¨äºç†è§£å­˜å‚¨ç³»ç»Ÿçš„å·¥ä½œåŸç†ï¼Œä»Šå¤©å’±ä»¬æŠŠé‡ç‚¹é‡æ–°èšç„¦åˆ°ç¼“å­˜ä¸Šæ¥ã€‚</p><p>Sparkçš„Cacheæœºåˆ¶ä¸»è¦æœ‰3ä¸ªæ–¹é¢éœ€è¦æˆ‘ä»¬æŒæ¡ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š</p><ul>\n<li>ç¼“å­˜çš„å­˜å‚¨çº§åˆ«ï¼šå®ƒé™å®šäº†æ•°æ®ç¼“å­˜çš„å­˜å‚¨ä»‹è´¨ï¼Œå¦‚å†…å­˜ã€ç£ç›˜ç­‰</li>\n<li>ç¼“å­˜çš„è®¡ç®—è¿‡ç¨‹ï¼šä»RDDå±•å¼€åˆ°åˆ†ç‰‡ä»¥Blockçš„å½¢å¼ï¼Œå­˜å‚¨äºå†…å­˜æˆ–ç£ç›˜çš„è¿‡ç¨‹</li>\n<li>ç¼“å­˜çš„é”€æ¯è¿‡ç¨‹ï¼šç¼“å­˜æ•°æ®ä»¥ä¸»åŠ¨æˆ–æ˜¯è¢«åŠ¨çš„æ–¹å¼ï¼Œè¢«é©±é€å‡ºå†…å­˜æˆ–æ˜¯ç£ç›˜çš„è¿‡ç¨‹</li>\n</ul><!-- [[[read_end]]] --><p>ä¸‹é¢ï¼Œæˆ‘ä»¬ä¸€ä¸€æ¥çœ‹ã€‚</p><h3>å­˜å‚¨çº§åˆ«</h3><p>Sparkä¸­çš„Cacheæ”¯æŒå¾ˆå¤šç§å­˜å‚¨çº§åˆ«ï¼Œæ¯”å¦‚MEMORY_AND_DISK_SER_2ã€MEMORY_ONLYç­‰ç­‰ã€‚è¿™äº›é•¿å¾—å·®ä¸å¤šçš„å­—ç¬¦ä¸²æˆ‘ä»¬è¯¥æ€ä¹ˆè®°å¿†å’ŒåŒºåˆ†å‘¢ï¼Ÿå…¶å®ï¼Œ<strong>æ¯ä¸€ç§å­˜å‚¨çº§åˆ«éƒ½åŒ…å«3ä¸ªåŸºæœ¬è¦ç´ </strong>ã€‚</p><ul>\n<li>å­˜å‚¨ä»‹è´¨ï¼šå†…å­˜è¿˜æ˜¯ç£ç›˜ï¼Œæˆ–æ˜¯ä¸¤è€…éƒ½æœ‰ã€‚</li>\n<li>å­˜å‚¨å½¢å¼ï¼šå¯¹è±¡å€¼è¿˜æ˜¯åºåˆ—åŒ–çš„å­—èŠ‚æ•°ç»„ï¼Œå¸¦SERå­—æ ·çš„è¡¨ç¤ºä»¥åºåˆ—åŒ–æ–¹å¼å­˜å‚¨ï¼Œä¸å¸¦SERåˆ™è¡¨ç¤ºé‡‡ç”¨å¯¹è±¡å€¼ã€‚</li>\n<li>å‰¯æœ¬æ•°é‡ï¼šå­˜å‚¨çº§åˆ«åå­—æœ€åçš„æ•°å­—ä»£è¡¨æ‹·è´æ•°é‡ï¼Œæ²¡æœ‰æ•°å­—é»˜è®¤ä¸º1ä»½å‰¯æœ¬ã€‚</li>\n</ul><p><img src=\"https://static001.geekbang.org/resource/image/4e/e2/4ecdfd4b62b1c6e151d029c38088yye2.jpeg?wh=1920*1000\" alt=\"\" title=\"Cacheå­˜å‚¨çº§åˆ«\"></p><p>å½“æˆ‘ä»¬å¯¹äº”èŠ±å…«é—¨çš„å­˜å‚¨çº§åˆ«æ‹†è§£ä¹‹åå°±ä¼šå‘ç°ï¼Œå®ƒä»¬ä¸è¿‡æ˜¯å­˜å‚¨ä»‹è´¨ã€å­˜å‚¨å½¢å¼å’Œå‰¯æœ¬æ•°é‡è¿™3ç±»ä¸åŒåŸºæœ¬å…ƒç´ çš„æ’åˆ—ç»„åˆè€Œå·²ã€‚æˆ‘åœ¨ä¸Šè¡¨ä¸­åˆ—å‡ºäº†ç›®å‰Sparkæ”¯æŒçš„æ‰€æœ‰å­˜å‚¨çº§åˆ«ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒåŠ æ·±ç†è§£ã€‚</p><p>å°½ç®¡ç¼“å­˜çº§åˆ«å¤šå¾—è®©äººçœ¼èŠ±ç¼­ä¹±ï¼Œä½†å®é™…ä¸Š<strong>æœ€å¸¸ç”¨çš„åªæœ‰ä¸¤ä¸ªï¼šMEMORY_ONLYå’ŒMEMORY_AND_DISKï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯RDDç¼“å­˜å’ŒDataFrameç¼“å­˜çš„é»˜è®¤å­˜å‚¨çº§åˆ«</strong>ã€‚åœ¨æ—¥å¸¸çš„å¼€å‘å·¥ä½œä¸­ï¼Œå½“ä½ åœ¨RDDå’ŒDataFrameä¹‹ä¸Šè°ƒç”¨<code>.cache</code>å‡½æ•°æ—¶ï¼ŒSparké»˜è®¤é‡‡ç”¨çš„å°±æ˜¯MEMORY_ONLYå’ŒMEMORY_AND_DISKã€‚</p><h3>ç¼“å­˜çš„è®¡ç®—è¿‡ç¨‹</h3><p>åœ¨MEMORY_AND_DISKæ¨¡å¼ä¸‹ï¼ŒSparkä¼šä¼˜å…ˆå°è¯•æŠŠæ•°æ®é›†å…¨éƒ¨ç¼“å­˜åˆ°å†…å­˜ï¼Œå†…å­˜ä¸è¶³çš„æƒ…å†µä¸‹ï¼Œå†æŠŠå‰©ä½™çš„æ•°æ®è½ç›˜åˆ°æœ¬åœ°ã€‚MEMORY_ONLYåˆ™ä¸ç®¡å†…å­˜æ˜¯å¦å……è¶³ï¼Œè€Œæ˜¯ä¸€è‚¡è„‘åœ°æŠŠæ•°æ®å¾€å†…å­˜é‡Œå¡ï¼Œå³ä¾¿å†…å­˜ä¸å¤Ÿä¹Ÿä¸ä¼šè½ç›˜ã€‚ä¸éš¾å‘ç°ï¼Œ<strong>è¿™ä¸¤ç§å­˜å‚¨çº§åˆ«éƒ½æ˜¯å…ˆå°è¯•æŠŠæ•°æ®ç¼“å­˜åˆ°å†…å­˜</strong>ã€‚æ•°æ®åœ¨å†…å­˜ä¸­çš„å­˜å‚¨è¿‡ç¨‹æˆ‘ä»¬åœ¨<a href=\"https://time.geekbang.org/column/article/355081\">ç¬¬6è®²</a>ä¸­è®²è¿‡äº†ï¼Œè¿™é‡Œæˆ‘ä»¬å†ä¸€èµ·å›é¡¾ä¸€ä¸‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/8f/e2/8fc350146a7yyb0448303d7f1f094be2.jpg?wh=3936*1818\" alt=\"\" title=\"åˆ†å¸ƒå¼æ•°æ®é›†ç¼“å­˜åˆ°å†…å­˜\"></p><p>æ— è®ºæ˜¯RDDè¿˜æ˜¯DataFrameï¼Œå®ƒä»¬çš„æ•°æ®åˆ†ç‰‡éƒ½æ˜¯ä»¥è¿­ä»£å™¨Iteratorçš„å½¢å¼å­˜å‚¨çš„ã€‚å› æ­¤ï¼Œè¦æŠŠæ•°æ®ç¼“å­˜ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆå¾—æŠŠè¿­ä»£å™¨å±•å¼€æˆå®å®åœ¨åœ¨çš„æ•°æ®å€¼ï¼Œè¿™ä¸€æ­¥å«åšUnrollï¼Œå¦‚æ­¥éª¤1æ‰€ç¤ºã€‚å±•å¼€çš„å¯¹è±¡å€¼æš‚æ—¶å­˜å‚¨åœ¨ä¸€ä¸ªå«åšValuesHolderçš„æ•°æ®ç»“æ„é‡Œï¼Œç„¶åè½¬æ¢ä¸ºMemoryEntryã€‚è½¬æ¢çš„å®ç°æ–¹å¼æ˜¯toArrayï¼Œå› æ­¤å®ƒä¸äº§ç”Ÿé¢å¤–çš„å†…å­˜å¼€é”€ï¼Œè¿™ä¸€æ­¥è½¬æ¢å«åšTransferï¼Œå¦‚æ­¥éª¤2æ‰€ç¤ºã€‚æœ€ç»ˆï¼ŒMemoryEntryå’Œä¸ä¹‹å¯¹åº”çš„BlockIDï¼Œä»¥Keyã€Valueçš„å½¢å¼å­˜å‚¨åˆ°å“ˆå¸Œå­—å…¸ï¼ˆLinkedHashMapï¼‰ä¸­ï¼Œå¦‚å›¾ä¸­çš„æ­¥éª¤3æ‰€ç¤ºã€‚</p><p>å½“åˆ†å¸ƒå¼æ•°æ®é›†æ‰€æœ‰çš„æ•°æ®åˆ†ç‰‡éƒ½ä»Unrollåˆ°Transferï¼Œå†åˆ°æ³¨å†Œå“ˆå¸Œå­—å…¸ä¹‹åï¼Œæ•°æ®åœ¨å†…å­˜ä¸­çš„ç¼“å­˜è¿‡ç¨‹å°±å®£å‘Šå®Œæ¯•ã€‚</p><h3>ç¼“å­˜çš„é”€æ¯è¿‡ç¨‹</h3><p>ä½†æ˜¯å¾ˆå¤šæƒ…å†µä¸‹ï¼Œåº”ç”¨ä¸­æ•°æ®ç¼“å­˜çš„éœ€æ±‚ä¼šè¶…è¿‡Storage MemoryåŒºåŸŸçš„ç©ºé—´ä¾›ç»™ã€‚è™½ç„¶ç¼“å­˜ä»»åŠ¡å¯ä»¥æŠ¢å Execution MemoryåŒºåŸŸçš„ç©ºé—´ï¼Œä½†â€œå‡ºæ¥æ··ï¼Œè¿Ÿæ—©æ˜¯è¦è¿˜çš„â€ï¼Œéšç€æ‰§è¡Œä»»åŠ¡çš„æ¨è¿›ï¼Œç¼“å­˜ä»»åŠ¡æŠ¢å çš„å†…å­˜ç©ºé—´è¿˜æ˜¯è¦â€œåâ€å‡ºæ¥ã€‚è¿™ä¸ªæ—¶å€™ï¼ŒSparkå°±è¦æ‰§è¡Œç¼“å­˜çš„é”€æ¯è¿‡ç¨‹ã€‚</p><p>ä½ ä¸å¦¨æŠŠStorage Memoryæƒ³è±¡æˆä¸€å®¶ç«çˆ†çš„ç½‘çº¢é¤å…ï¼Œå¾…ç¼“å­˜çš„æ•°æ®åˆ†ç‰‡æ˜¯ä¸€ä½åˆä¸€ä½ç­‰å¾…å°±é¤çš„é¡¾å®¢ã€‚å½“éœ€æ±‚å¤§äºä¾›ç»™ï¼Œé¡¾å®¢æ•°é‡è¿œè¶…é¤ä½æ•°é‡çš„æ—¶å€™ï¼ŒSparkè‡ªç„¶è¦åˆ¶å®šä¸€äº›è§„åˆ™ï¼Œæ¥åˆç†åœ°â€œé©±é€â€é‚£äº›å°¸ä½ç´ é¤çš„é¡¾å®¢ï¼ŒæŠŠä½ç½®è…¾å‡ºæ¥åŠæ—¶æœåŠ¡é‚£äº›æ’é˜Ÿç­‰é¤çš„äººã€‚</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼ŒSparkåŸºäºä»€ä¹ˆè§„åˆ™â€œé©±é€â€é¡¾å®¢å‘¢ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘å°±ä»¥åŒæ—¶ç¼“å­˜å¤šä¸ªåˆ†å¸ƒå¼æ•°æ®é›†çš„æƒ…å†µä¸ºä¾‹ï¼Œå¸¦ä½ å»åˆ†æä¸€ä¸‹åœ¨å†…å­˜å—é™çš„æƒ…å†µä¸‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p><p>æˆ‘ä»¬ç”¨ä¸€å¼ å›¾æ¥æ¼”ç¤ºè¿™ä¸ªè¿‡ç¨‹ï¼Œå‡è®¾MemoryStoreä¸­å­˜æœ‰4ä¸ªRDD/Data  Frameçš„ç¼“å­˜æ•°æ®ï¼Œè¿™4ä¸ªåˆ†å¸ƒå¼æ•°æ®é›†å„è‡ªç¼“å­˜äº†ä¸€äº›æ•°æ®åˆ†ç‰‡ä¹‹åï¼ŒStorage MemoryåŒºåŸŸå°±è¢«å æ»¡äº†ã€‚å½“RDD1å°è¯•æŠŠç¬¬6ä¸ªåˆ†ç‰‡ç¼“å­˜åˆ°MemoryStoreæ—¶ï¼Œå´å‘ç°å†…å­˜ä¸è¶³ï¼Œå¡ä¸è¿›å»äº†ã€‚</p><p>è¿™ç§æƒ…å†µä¸‹ï¼Œ<strong>Sparkå°±ä¼šé€ä¸€æ¸…é™¤ä¸€äº›â€œå°¸ä½ç´ é¤â€çš„MemoryEntryæ¥é‡Šæ”¾å†…å­˜ï¼Œä»è€Œè·å–æ›´å¤šçš„å¯ç”¨ç©ºé—´æ¥å­˜å‚¨æ–°çš„æ•°æ®åˆ†ç‰‡</strong>ã€‚è¿™ä¸ªè¿‡ç¨‹å«åšEvictionï¼Œå®ƒçš„ä¸­æ–‡ç¿»è¯‘è¿˜æ˜¯è›®å½¢è±¡çš„ï¼Œå°±å«åšé©±é€ï¼Œä¹Ÿå°±æ˜¯æŠŠMemoryStoreä¸­é‚£äº›å€’éœ‰çš„MemoryEntryé©±é€å‡ºå†…å­˜ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b7/14/b73308328ef549579d02c72afb2ab114.jpg?wh=5828*1798\" alt=\"\" title=\"å¤šä¸ªåˆ†å¸ƒå¼æ•°æ®é›†åŒæ—¶ç¼“å­˜åˆ°å†…å­˜\"></p><p>å›åˆ°åˆšæ‰çš„é—®é¢˜ï¼ŒSparkæ˜¯æ ¹æ®ä»€ä¹ˆè§„åˆ™é€‰ä¸­çš„è¿™äº›å€’éœ‰è›‹å‘¢ï¼Ÿè¿™ä¸ªè§„åˆ™å«ä½œLRUï¼ˆLeast Recently Usedï¼‰ï¼ŒåŸºäºè¿™ä¸ªç®—æ³•ï¼Œæœ€è¿‘è®¿é—®é¢‘ç‡æœ€ä½çš„é‚£ä¸ªå®¶ä¼™å°±æ˜¯å€’éœ‰è›‹ã€‚å› ä¸º<a href=\"https://baike.baidu.com/item/LRU/1269842?fr=aladdin\">LRU</a>æ˜¯æ¯”è¾ƒåŸºç¡€çš„æ•°æ®ç»“æ„ç®—æ³•ï¼Œç¬”è¯•ã€é¢è¯•çš„æ—¶å€™ç»å¸¸ä¼šè€ƒï¼Œæ‰€ä»¥å®ƒçš„æ¦‚å¿µæˆ‘å°±ä¸å¤šè¯´äº†ã€‚</p><p>æˆ‘ä»¬è¦çŸ¥é“çš„æ˜¯ï¼ŒSparkæ˜¯å¦‚ä½•å®ç°LRUçš„ã€‚è¿™é‡Œï¼Œ<strong>Sparkä½¿ç”¨äº†ä¸€ä¸ªå·§å¦™çš„æ•°æ®ç»“æ„ï¼šLinkedHashMapï¼Œè¿™ç§æ•°æ®ç»“æ„å¤©ç„¶åœ°æ”¯æŒLRUç®—æ³•</strong>ã€‚</p><p>LinkedHashMapä½¿ç”¨ä¸¤ä¸ªæ•°æ®ç»“æ„æ¥ç»´æŠ¤æ•°æ®ï¼Œä¸€ä¸ªæ˜¯ä¼ ç»Ÿçš„HashMapï¼Œå¦ä¸€ä¸ªæ˜¯åŒå‘é“¾è¡¨ã€‚HashMapçš„ç”¨é€”åœ¨äºå¿«é€Ÿè®¿é—®ï¼Œæ ¹æ®æŒ‡å®šçš„BlockIdï¼ŒHashMapä»¥O(1)çš„æ•ˆç‡è¿”å›MemoryEntryã€‚åŒå‘é“¾è¡¨åˆ™ä¸åŒï¼Œå®ƒä¸»è¦ç”¨äºç»´æŠ¤å…ƒç´ ï¼ˆä¹Ÿå°±æ˜¯BlockIdå’ŒMemoryEntryé”®å€¼å¯¹ï¼‰çš„è®¿é—®é¡ºåºã€‚å‡¡æ˜¯è¢«è®¿é—®è¿‡çš„å…ƒç´ ï¼Œæ— è®ºæ˜¯æ’å…¥ã€è¯»å–è¿˜æ˜¯æ›´æ–°éƒ½ä¼šè¢«æ”¾ç½®åˆ°é“¾è¡¨çš„å°¾éƒ¨ã€‚å› æ­¤ï¼Œé“¾è¡¨å¤´éƒ¨ä¿å­˜çš„åˆšå¥½éƒ½æ˜¯â€œæœ€è¿‘æœ€å°‘è®¿é—®â€çš„å…ƒç´ ã€‚</p><p>å¦‚æ­¤ä¸€æ¥ï¼Œå½“å†…å­˜ä¸è¶³éœ€è¦é©±é€ç¼“å­˜çš„æ•°æ®å—æ—¶ï¼ŒSparkåªåˆ©ç”¨LinkedHashMapå°±å¯ä»¥åšåˆ°æŒ‰ç…§â€œæœ€è¿‘æœ€å°‘è®¿é—®â€çš„åŸåˆ™ï¼Œå»ä¾æ¬¡é©±é€ç¼“å­˜ä¸­çš„æ•°æ®åˆ†ç‰‡äº†ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨å­˜å‚¨ç³»ç»Ÿé‚£ä¸€è®²ï¼Œæœ‰åŒå­¦é—®MemoryStoreä¸ºä»€ä¹ˆä½¿ç”¨LinkedHashMapï¼Œè€Œä¸ç”¨æ™®é€šçš„Mapæ¥å­˜å‚¨BlockIdå’ŒMemoryEntryçš„é”®å€¼å¯¹ã€‚æˆ‘åˆšæ‰è¯´çš„å°±æ˜¯ç­”æ¡ˆäº†ã€‚</p><p>å›åˆ°å›¾ä¸­çš„ä¾‹å­ï¼Œå½“RDD1è¯•å›¾ç¼“å­˜ç¬¬6ä¸ªæ•°æ®åˆ†ç‰‡ï¼Œä½†å¯ç”¨å†…å­˜ç©ºé—´ä¸è¶³æ—¶ï¼ŒSpark ä¼šå¯¹LinkedHashMapä»å¤´è‡³å°¾æ‰«æï¼Œè¾¹æ‰«æè¾¹è®°å½•MemoryEntryå¤§å°ï¼Œå½“å€’éœ‰è›‹çš„æ€»å¤§å°è¶…è¿‡ç¬¬6ä¸ªæ•°æ®åˆ†ç‰‡æ—¶ï¼ŒSparkåœæ­¢æ‰«æã€‚</p><p>æœ‰æ„æ€çš„æ˜¯ï¼Œ<strong>å€’éœ‰è›‹çš„é€‰å–è§„åˆ™éµå¾ªâ€œå…”å­ä¸åƒçªè¾¹è‰â€ï¼ŒåŒå±ä¸€ä¸ªRDDçš„MemoryEntryä¸ä¼šè¢«é€‰ä¸­</strong>ã€‚å°±åƒå›¾ä¸­çš„æ­¥éª¤4å±•ç¤ºçš„ä¸€æ ·ï¼Œç¬¬ä¸€ä¸ªè“è‰²çš„MemoryEntryä¼šè¢«è·³è¿‡ï¼Œç´§éšå…¶åæ‰“å‰çš„ä¸¤ä¸ªMemoryEntryè¢«é€‰ä¸­ã€‚</p><p>å› æ­¤ï¼Œæ€»ç»“ä¸‹æ¥ï¼Œåœ¨æ¸…é™¤ç¼“å­˜çš„è¿‡ç¨‹ä¸­ï¼ŒSparkéµå¾ªä¸¤ä¸ªåŸºæœ¬åŸåˆ™ï¼š</p><ul>\n<li>LRUï¼šæŒ‰ç…§å…ƒç´ çš„è®¿é—®é¡ºåºï¼Œä¼˜å…ˆæ¸…é™¤é‚£äº›â€œæœ€è¿‘æœ€å°‘è®¿é—®â€çš„BlockIdã€MemoryEntryé”®å€¼å¯¹</li>\n<li>å…”å­ä¸åƒçªè¾¹è‰ï¼šåœ¨æ¸…é™¤çš„è¿‡ç¨‹ä¸­ï¼ŒåŒå±ä¸€ä¸ªRDDçš„MemoryEntryæ‹¥æœ‰â€œèµ¦å…æƒâ€</li>\n</ul><h3>é€€åŒ–ä¸ºMapReduce</h3><p>å°½ç®¡æœ‰ç¼“å­˜é”€æ¯è¿™ä¸ªç¯èŠ‚çš„å­˜åœ¨ï¼ŒStorage Memoryå†…å­˜ç©ºé—´ä¹Ÿæ€»ä¼šè€—å°½ï¼ŒMemoryStoreä¹Ÿæ€»ä¼šâ€œé©±æ— å¯é©±â€ã€‚è¿™ä¸ªæ—¶å€™ï¼ŒMEMORY_ONLYæ¨¡å¼å°±ä¼šæ”¾å¼ƒå‰©ä½™çš„æ•°æ®åˆ†ç‰‡ã€‚æ¯”å¦‚ï¼Œåœ¨Spark UIä¸Šï¼Œä½ æ—¶å¸¸ä¼šçœ‹åˆ°Storage Tabä¸­çš„ç¼“å­˜æ¯”ä¾‹ä½äº100%ã€‚è€Œæˆ‘ä»¬ä»Storage Tabä¹Ÿå¯ä»¥è§‚å¯Ÿåˆ°ï¼Œåœ¨MEMORY_AND_DISKæ¨¡å¼ä¸‹ï¼Œæ•°æ®é›†åœ¨å†…å­˜å’Œç£ç›˜ä¸­å„å ä¸€éƒ¨åˆ†æ¯”ä¾‹ã€‚</p><p>è¿™æ˜¯å› ä¸ºå¯¹äºMEMORY_AND_DISKå­˜å‚¨çº§åˆ«æ¥è¯´ï¼Œå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ‰€æœ‰çš„RDDæ•°æ®åˆ†ç‰‡çš„æ—¶å€™ï¼ŒSparkä¼šæŠŠå°šæœªå±•å¼€çš„RDDåˆ†ç‰‡é€šè¿‡DiskStoreç¼“å­˜åˆ°ç£ç›˜ä¸­ã€‚DiskStoreçš„å·¥ä½œåŸç†ï¼Œæˆ‘ä»¬åœ¨å­˜å‚¨ç³»ç»Ÿé‚£ä¸€è®²æœ‰è¿‡è¯¦ç»†ä»‹ç»ï¼Œä½ å¯ä»¥å›å»çœ‹ä¸€çœ‹ï¼Œæˆ‘å»ºè®®ä½ ç»“åˆDiskStoreçš„çŸ¥è¯†æŠŠRDDåˆ†ç‰‡åœ¨ç£ç›˜ä¸Šçš„ç¼“å­˜è¿‡ç¨‹æ¨å¯¼å‡ºæ¥ã€‚</p><p>å› æ­¤ï¼Œ<strong>ç›¸æ¯”MEMORY_ONLYï¼ŒMEMORY_AND_DISKæ¨¡å¼èƒ½å¤Ÿä¿è¯æ•°æ®é›†100%åœ°ç‰©åŒ–åˆ°å­˜å‚¨ä»‹è´¨</strong>ã€‚å¯¹äºè®¡ç®—é“¾æ¡è¾ƒé•¿çš„RDDæˆ–æ˜¯DataFrameæ¥è¯´ï¼ŒæŠŠæ•°æ®ç‰©åŒ–åˆ°ç£ç›˜ä¹Ÿæ˜¯å€¼å¾—çš„ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½é€¢RDDã€DataFrameå°±è°ƒç”¨<code>.cache</code>ï¼Œå› ä¸ºåœ¨æœ€å·®çš„æƒ…å†µä¸‹ï¼ŒSparkçš„å†…å­˜è®¡ç®—å°±ä¼šé€€åŒ–ä¸ºHadoop MapReduceæ ¹æ®ç£ç›˜çš„è®¡ç®—æ¨¡å¼ã€‚</p><p>æ¯”å¦‚è¯´ï¼Œä½ ç”¨DataFrame APIå¼€å‘åº”ç”¨ï¼Œè®¡ç®—è¿‡ç¨‹æ¶‰åŠ10æ¬¡DataFrameä¹‹é—´çš„è½¬æ¢ï¼Œæ¯ä¸ªDataFrameéƒ½è°ƒç”¨<code>.cache</code>è¿›è¡Œç¼“å­˜ã€‚ç”±äºStorage Memoryå†…å­˜ç©ºé—´å—é™ï¼ŒMemoryStoreæœ€å¤šåªèƒ½å®¹çº³ä¸¤ä¸ªDataFrameçš„æ•°æ®é‡ã€‚å› æ­¤ï¼ŒMemoryStoreä¼šæœ‰8æ¬¡ä»¥DataFrameä¸ºç²’åº¦çš„æ¢è¿›æ¢å‡ºã€‚æœ€ç»ˆï¼ŒMemoryStoreå­˜å‚¨çš„æ˜¯è®¿é—®é¢‘æ¬¡æœ€é«˜çš„DataFrameæ•°æ®åˆ†ç‰‡ï¼Œå…¶ä»–çš„æ•°æ®åˆ†ç‰‡å…¨éƒ¨è¢«é©±é€åˆ°äº†ç£ç›˜ä¸Šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¹³å‡ä¸‹æ¥ï¼Œè‡³å°‘æœ‰8æ¬¡DataFrameçš„è½¬æ¢éƒ½ä¼šå°†è®¡ç®—ç»“æœè½ç›˜ï¼Œè¿™ä¸å°±æ˜¯Hadoopçš„MapReduceè®¡ç®—æ¨¡å¼å—ï¼Ÿ</p><p>å½“ç„¶ï¼Œå’±ä»¬è€ƒè™‘çš„æ˜¯æœ€å·®çš„æƒ…å†µï¼Œä½†è¿™ä¹Ÿèƒ½è®©æˆ‘ä»¬ä½“ä¼šåˆ°æ»¥ç”¨Cacheå¯èƒ½å¸¦æ¥çš„éšæ‚£å’Œå±å®³äº†ã€‚</p><h2>Cacheçš„ç”¨æ­¦ä¹‹åœ°</h2><p>æ—¢ç„¶æ»¥ç”¨Cacheå±å®³æ— ç©·ï¼Œé‚£åœ¨ä»€ä¹ˆæƒ…å†µä¸‹é€‚åˆä½¿ç”¨Cacheå‘¢ï¼Ÿæˆ‘å»ºè®®ä½ åœ¨åšå†³ç­–çš„æ—¶å€™éµå¾ªä»¥ä¸‹2æ¡åŸºæœ¬åŸåˆ™ï¼š</p><ul>\n<li>å¦‚æœRDD/DataFrame/Datasetåœ¨åº”ç”¨ä¸­çš„å¼•ç”¨æ¬¡æ•°ä¸º1ï¼Œå°±åšå†³ä¸ä½¿ç”¨Cache</li>\n<li>å¦‚æœå¼•ç”¨æ¬¡æ•°å¤§äº1ï¼Œä¸”è¿è¡Œæˆæœ¬å æ¯”è¶…è¿‡30%ï¼Œåº”å½“è€ƒè™‘å¯ç”¨Cache</li>\n</ul><p>ç¬¬ä¸€æ¡å¾ˆå¥½ç†è§£ï¼Œæˆ‘ä»¬è¯¦ç»†è¯´è¯´ç¬¬äºŒæ¡ã€‚è¿™é‡Œå’±ä»¬å®šä¹‰äº†ä¸€ä¸ªæ–°æ¦‚å¿µï¼š<strong>è¿è¡Œæˆæœ¬å æ¯”ã€‚å®ƒæŒ‡çš„æ˜¯è®¡ç®—æŸä¸ªåˆ†å¸ƒå¼æ•°æ®é›†æ‰€æ¶ˆè€—çš„æ€»æ—¶é—´ä¸ä½œä¸šæ‰§è¡Œæ—¶é—´çš„æ¯”å€¼</strong>ã€‚æˆ‘ä»¬æ¥ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸ªæ•°æ®åˆ†æçš„åº”ç”¨ï¼Œç«¯åˆ°ç«¯çš„æ‰§è¡Œæ—¶é—´ä¸º1å°æ—¶ã€‚åº”ç”¨ä¸­æœ‰ä¸ªDataFrameè¢«å¼•ç”¨äº†2æ¬¡ï¼Œä»è¯»å–æ•°æ®æºï¼Œç»è¿‡ä¸€ç³»åˆ—è®¡ç®—ï¼Œåˆ°ç”Ÿæˆè¿™ä¸ªDataFrameéœ€è¦èŠ±è´¹12åˆ†é’Ÿï¼Œé‚£ä¹ˆè¿™ä¸ªDataFrameçš„è¿è¡Œæˆæœ¬å æ¯”åº”è¯¥ç®—ä½œï¼š12 * 2 / 60 = 40%ã€‚</p><p>ä½ å¯èƒ½ä¼šè¯´ï¼šâ€œä½œä¸šæ‰§è¡Œæ—¶é—´å¥½ç®—ï¼Œç›´æ¥æŸ¥çœ‹Spark UIå°±å¥½äº†ï¼ŒDataFrameçš„è¿è¡Œæ—¶é—´æ€ä¹ˆç®—å‘¢ï¼Ÿâ€è¿™é‡Œæ¶‰åŠä¸€ä¸ªå°æŠ€å·§ï¼Œæˆ‘ä»¬å¯ä»¥ä»ç°æœ‰åº”ç”¨ä¸­ æŠŠDataFrameçš„è®¡ç®—é€»è¾‘å•æ‹å‡ºæ¥ï¼Œç„¶ååˆ©ç”¨Spark 3.0æä¾›çš„Noopæ¥ç²¾ç¡®åœ°å¾—åˆ°DataFrameçš„è¿è¡Œæ—¶é—´ã€‚å‡è®¾dfæ˜¯é‚£ä¸ªè¢«å¼•ç”¨2æ¬¡çš„DataFrameï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠdfä¾èµ–çš„æ‰€æœ‰ä»£ç æ‹·è´æˆä¸€ä¸ªæ–°çš„ä½œä¸šï¼Œç„¶ååœ¨dfä¸Šè°ƒç”¨Noopå»è§¦å‘è®¡ç®—ã€‚Noopçš„ä½œç”¨å¾ˆå·§å¦™ï¼Œå®ƒåªè§¦å‘è®¡ç®—ï¼Œè€Œä¸æ¶‰åŠè½ç›˜ä¸æ•°æ®å­˜å‚¨ï¼Œå› æ­¤ï¼Œæ–°ä½œä¸šçš„æ‰§è¡Œæ—¶é—´åˆšå¥½å°±æ˜¯DataFrameçš„è¿è¡Œæ—¶é—´ã€‚</p><pre><code>//åˆ©ç”¨noopç²¾ç¡®è®¡ç®—DataFrameè¿è¡Œæ—¶é—´\ndf.write\n.format(â€œnoopâ€)\n.save()\n</code></pre><p>ä½ å¯èƒ½ä¼šè§‰å¾—æ¯æ¬¡è®¡ç®—å æ¯”ä¼šå¾ˆéº»çƒ¦ï¼Œä½†åªè¦ä½ å¯¹æ•°æ®æºè¶³å¤Ÿäº†è§£ã€å¯¹è®¡ç®—DataFrameçš„ä¸­é—´è¿‡ç¨‹å¿ƒä¸­æœ‰æ•°äº†ä¹‹åï¼Œå…¶å®ä¸å¿…æ¯æ¬¡éƒ½å»ç²¾ç¡®åœ°è®¡ç®—è¿è¡Œæˆæœ¬å æ¯”ï¼Œå°è¯•å‡ æ¬¡ï¼Œä½ å°±èƒ½å¯¹åˆ†å¸ƒå¼æ•°æ®é›†çš„è¿è¡Œæˆæœ¬å æ¯”ä¼°æ‘¸å¾—å…«ä¹ä¸ç¦»åäº†ã€‚</p><h2>Cacheçš„æ³¨æ„äº‹é¡¹</h2><p>å¼„æ¸…æ¥šäº†åº”è¯¥ä»€ä¹ˆæ—¶å€™ä½¿ç”¨Cacheä¹‹åï¼Œæˆ‘ä»¬å†æ¥è¯´è¯´Cacheçš„æ³¨æ„äº‹é¡¹ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œ<code>.cache</code>æ˜¯æƒ°æ€§æ“ä½œï¼Œå› æ­¤åœ¨è°ƒç”¨<code>.cache</code>ä¹‹åï¼Œéœ€è¦å…ˆç”¨Actionç®—å­è§¦å‘ç¼“å­˜çš„ç‰©åŒ–è¿‡ç¨‹ã€‚ä½†æ˜¯ï¼Œæˆ‘å‘ç°å¾ˆå¤šåŒå­¦åœ¨é€‰æ‹©Actionç®—å­çš„æ—¶å€™å¾ˆéšæ„ï¼Œfirstã€takeã€showã€countä¸­å“ªä¸ªé¡ºæ‰‹å°±ç”¨å“ªä¸ªã€‚</p><p>è¿™è‚¯å®šæ˜¯ä¸å¯¹çš„ï¼Œ<strong>è¿™4ä¸ªç®—å­ä¸­åªæœ‰countæ‰ä¼šè§¦å‘ç¼“å­˜çš„å®Œå…¨ç‰©åŒ–ï¼Œè€Œfirstã€takeå’Œshowè¿™3ä¸ªç®—å­åªä¼šæŠŠæ¶‰åŠçš„æ•°æ®ç‰©åŒ–</strong>ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œshowé»˜è®¤åªäº§ç”Ÿ20æ¡ç»“æœï¼Œå¦‚æœæˆ‘ä»¬åœ¨.cacheä¹‹åè°ƒç”¨showç®—å­ï¼Œå®ƒåªä¼šç¼“å­˜æ•°æ®é›†ä¸­è¿™20æ¡è®°å½•ã€‚</p><p>é€‰æ‹©å¥½äº†ç®—å­ä¹‹åï¼Œæˆ‘ä»¬å†æ¥è®¨è®ºä¸€ä¸‹æ€ä¹ˆCacheè¿™ä¸ªé—®é¢˜ã€‚ä½ å¯èƒ½ä¼šè¯´ï¼šâ€œè¿™è¿˜ç”¨è¯´å—ï¼Ÿåœ¨RDDã€DataFrameåé¢è°ƒç”¨<code>.cache</code>ä¸å°±å¾—äº†â€ã€‚è¿˜çœŸæ²¡è¿™ä¹ˆç®€å•ï¼Œæˆ‘å‡ºä¸€é“é€‰æ‹©é¢˜æ¥è€ƒè€ƒä½ ï¼Œå¦‚æœç»™å®šåŒ…å«æ•°ååˆ—çš„DataFrame dfå’Œåç»­çš„æ•°æ®åˆ†æï¼Œä½ åº”è¯¥é‡‡ç”¨ä¸‹è¡¨ä¸­çš„å“ªç§Cacheæ–¹å¼ï¼Ÿ</p><pre><code>val filePath: String = _\nval df: DataFrame = spark.read.parquet(filePath)\n \n//Cacheæ–¹å¼ä¸€\nval cachedDF = df.cache\n//æ•°æ®åˆ†æ\ncachedDF.filter(col2 &gt; 0).select(col1, col2)\ncachedDF.select(col1, col2).filter(col2 &gt; 100)\n \n//Cacheæ–¹å¼äºŒ\ndf.select(col1, col2).filter(col2 &gt; 0).cache\n//æ•°æ®åˆ†æ\ndf.filter(col2 &gt; 0).select(col1, col2)\ndf.select(col1, col2).filter(col2 &gt; 100)\n \n//Cacheæ–¹å¼ä¸‰\nval cachedDF = df.select(col1, col2).cache\n//æ•°æ®åˆ†æ\ncachedDF.filter(col2 &gt; 0).select(col1, col2)\ncachedDF.select(col1, col2).filter(col2 &gt; 100)\n\n</code></pre><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œç”±äºStorage Memoryå†…å­˜ç©ºé—´å—é™ï¼Œå› æ­¤Cacheåº”è¯¥éµå¾ª<strong>æœ€å°å…¬å…±å­é›†åŸåˆ™</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¼€å‘è€…åº”è¯¥ä»…ä»…ç¼“å­˜åç»­æ“ä½œå¿…éœ€çš„é‚£äº›æ•°æ®åˆ—ã€‚æŒ‰ç…§è¿™ä¸ªåŸåˆ™ï¼Œå®ç°æ–¹å¼1åº”å½“æ’é™¤åœ¨å¤–ï¼Œæ¯•ç«Ÿdfæ˜¯ä¸€å¼ åŒ…å«æ•°ååˆ—çš„å®½è¡¨ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹ç¬¬äºŒç§Cacheæ–¹å¼ï¼Œæ–¹å¼2ç¼“å­˜çš„æ•°æ®åˆ—æ˜¯<code>col1</code>å’Œ<code>col2</code>ï¼Œä¸”<code>col2</code>æ•°å€¼å¤§äº0ã€‚ç¬¬ä¸€æ¡åˆ†æè¯­å¥åªæ˜¯æŠŠ<code>filter</code>å’Œ<code>select</code>è°ƒæ¢äº†é¡ºåºï¼›ç¬¬äºŒæ¡è¯­å¥<code>filter</code>æ¡ä»¶é™åˆ¶<code>col2</code>æ•°å€¼è¦å¤§äº100ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªè¯­å¥çš„ç»“æœå°±æ˜¯ç¼“å­˜æ•°æ®çš„å­é›†ã€‚å› æ­¤ï¼Œä¹çœ‹ä¸Šå»ï¼Œä¸¤æ¡æ•°æ®åˆ†æè¯­å¥åœ¨é€»è¾‘ä¸Šåˆšå¥½éƒ½èƒ½åˆ©ç”¨ç¼“å­˜çš„æ•°æ®å†…å®¹ã€‚</p><p>ä½†é—æ†¾çš„æ˜¯ï¼Œè¿™ä¸¤æ¡åˆ†æè¯­å¥éƒ½ä¼šè·³è¿‡ç¼“å­˜æ•°æ®ï¼Œåˆ†åˆ«å»ç£ç›˜ä¸Šè¯»å–Parquetæºæ–‡ä»¶ï¼Œç„¶åä»å¤´è®¡ç®—æŠ•å½±å’Œè¿‡æ»¤çš„é€»è¾‘ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿç©¶å…¶ç¼˜ç”±æ˜¯ï¼Œ<strong>Cache Managerè¦æ±‚ä¸¤ä¸ªæŸ¥è¯¢çš„Analyzed Logical Planå¿…é¡»å®Œå…¨ä¸€è‡´ï¼Œæ‰èƒ½å¯¹DataFrameçš„ç¼“å­˜è¿›è¡Œå¤ç”¨</strong>ã€‚</p><p>Analyzed Logical Planæ˜¯æ¯”è¾ƒåˆçº§çš„é€»è¾‘è®¡åˆ’ï¼Œä¸»è¦è´Ÿè´£ASTæŸ¥è¯¢è¯­æ³•æ ‘çš„è¯­ä¹‰æ£€æŸ¥ï¼Œç¡®ä¿æŸ¥è¯¢ä¸­å¼•ç”¨çš„è¡¨ã€åˆ—ç­‰å…ƒä¿¡æ¯çš„æœ‰æ•ˆæ€§ã€‚åƒè°“è¯ä¸‹æ¨ã€åˆ—å‰ªæè¿™äº›æ¯”è¾ƒæ™ºèƒ½çš„æ¨ç†ï¼Œè¦ç­‰åˆ°åˆ¶å®šOptimized Logical Planæ‰ä¼šç”Ÿæ•ˆã€‚å› æ­¤ï¼Œå³ä½¿æ˜¯åŒä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œä»…ä»…æ˜¯è°ƒæ¢äº†<code>select</code>å’Œ<code>filter</code>çš„é¡ºåºï¼Œåœ¨Analyzed Logical Plané˜¶æ®µä¹Ÿä¼šè¢«åˆ¤å®šä¸ºä¸åŒçš„é€»è¾‘è®¡åˆ’ã€‚</p><p>å› æ­¤ï¼Œä¸ºäº†é¿å…å› ä¸ºAnalyzed Logical Planä¸ä¸€è‡´é€ æˆçš„Cache missï¼Œæˆ‘ä»¬åº”è¯¥é‡‡ç”¨ç¬¬ä¸‰ç§å®ç°æ–¹å¼ï¼ŒæŠŠæˆ‘ä»¬æƒ³è¦ç¼“å­˜çš„æ•°æ®èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼Œå‡¡æ˜¯åœ¨è¿™ä¸ªå˜é‡ä¹‹ä¸Šçš„åˆ†ææ“ä½œï¼Œéƒ½ä¼šå®Œå…¨å¤ç”¨ç¼“å­˜æ•°æ®ã€‚ä½ çœ‹ï¼Œç¼“å­˜çš„ä½¿ç”¨å¯ä¸ä»…ä»…æ˜¯è°ƒç”¨<code>.cache</code>é‚£ä¹ˆç®€å•ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿåº”å½“åŠæ—¶æ¸…ç†ç”¨è¿‡çš„Cacheï¼Œå°½æ—©è…¾å‡ºå†…å­˜ç©ºé—´ä¾›å…¶ä»–æ•°æ®é›†æ¶ˆè´¹ï¼Œä»è€Œå°½é‡é¿å…Evictionçš„å‘ç”Ÿã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šç”¨.unpersistæ¥æ¸…ç†å¼ƒç”¨çš„ç¼“å­˜æ•°æ®ï¼Œå®ƒæ˜¯.cacheçš„é€†æ“ä½œã€‚unpersistæ“ä½œæ”¯æŒåŒæ­¥ã€å¼‚æ­¥ä¸¤ç§æ¨¡å¼ï¼š</p><ul>\n<li>å¼‚æ­¥æ¨¡å¼ï¼šè°ƒç”¨unpersist()æˆ–æ˜¯unpersist(False)</li>\n<li>åŒæ­¥æ¨¡å¼ï¼šè°ƒç”¨unpersist(True)</li>\n</ul><p>åœ¨å¼‚æ­¥æ¨¡å¼ä¸‹ï¼ŒDriveræŠŠæ¸…ç†ç¼“å­˜çš„è¯·æ±‚å‘é€ç»™å„ä¸ªExecutorsä¹‹åï¼Œä¼šç«‹å³è¿”å›ï¼Œå¹¶ä¸”ç»§ç»­æ‰§è¡Œç”¨æˆ·ä»£ç ï¼Œæ¯”å¦‚åç»­çš„ä»»åŠ¡è°ƒåº¦ã€å¹¿æ’­å˜é‡åˆ›å»ºç­‰ç­‰ã€‚åœ¨åŒæ­¥æ¨¡å¼ä¸‹ï¼ŒDriverå‘é€å®Œè¯·æ±‚ä¹‹åï¼Œä¼šä¸€ç›´ç­‰å¾…æ‰€æœ‰Executorsç»™å‡ºæ˜ç¡®çš„ç»“æœï¼ˆç¼“å­˜æ¸…é™¤æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼‰ã€‚å„ä¸ªExecutorsæ¸…é™¤ç¼“å­˜çš„æ•ˆç‡ã€è¿›åº¦å„ä¸ç›¸åŒï¼ŒDriverè¦ç­‰åˆ°æœ€åä¸€ä¸ªExecutorè¿”å›ç»“æœï¼Œæ‰ä¼šç»§ç»­æ‰§è¡ŒDriverä¾§çš„ä»£ç ã€‚æ˜¾ç„¶ï¼ŒåŒæ­¥æ¨¡å¼ä¼šå½±å“Driverçš„å·¥ä½œæ•ˆç‡ã€‚å› æ­¤ï¼Œé€šå¸¸æ¥è¯´ï¼Œåœ¨éœ€è¦ä¸»åŠ¨æ¸…é™¤Cacheçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¾€å¾€é‡‡ç”¨å¼‚æ­¥çš„è°ƒç”¨æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨unpersist()æˆ–æ˜¯unpersist(False)ã€‚</p><h2>å°ç»“</h2><p>æƒ³è¦æœ‰æ•ˆé¿å…Cacheçš„æ»¥ç”¨ï¼Œæˆ‘ä»¬å¿…é¡»ä»Cacheçš„å·¥ä½œåŸç†å‡ºå‘ï¼Œå…ˆæŒæ¡Cacheçš„3ä¸ªé‡è¦æœºåˆ¶ï¼Œåˆ†åˆ«æ˜¯å­˜å‚¨çº§åˆ«ã€ç¼“å­˜è®¡ç®—å’Œç¼“å­˜çš„é”€æ¯è¿‡ç¨‹ã€‚</p><p>å¯¹äºå­˜å‚¨çº§åˆ«æ¥è¯´ï¼Œå®é™…å¼€å‘ä¸­æœ€å¸¸ç”¨åˆ°çš„æœ‰ä¸¤ä¸ªï¼ŒMEMORY_ONLYå’ŒMEMORY_AND_DISKï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯RDDç¼“å­˜å’ŒDataFrameç¼“å­˜çš„é»˜è®¤å­˜å‚¨çº§åˆ«ã€‚</p><p>å¯¹äºç¼“å­˜è®¡ç®—æ¥è¯´ï¼Œå®ƒåˆ†ä¸º3ä¸ªæ­¥éª¤ï¼Œç¬¬ä¸€æ­¥æ˜¯Unrollï¼ŒæŠŠRDDæ•°æ®åˆ†ç‰‡çš„Iteratorç‰©åŒ–ä¸ºå¯¹è±¡å€¼ï¼Œç¬¬äºŒæ­¥æ˜¯Transferï¼ŒæŠŠå¯¹è±¡å€¼å°è£…ä¸ºMemoryEntryï¼Œç¬¬ä¸‰æ­¥æ˜¯æŠŠBlockIdã€MemoryEntryä»·å€¼å¯¹æ³¨å†Œåˆ°LinkedHashMapæ•°æ®ç»“æ„ã€‚</p><p>å¦å¤–ï¼Œå½“æ•°æ®ç¼“å­˜éœ€æ±‚è¿œå¤§äºStorage MemoryåŒºåŸŸçš„ç©ºé—´ä¾›ç»™æ—¶ï¼ŒSparkåˆ©ç”¨LinkedHashMapæ•°æ®ç»“æ„æä¾›çš„ç‰¹æ€§ï¼Œä¼šéµå¾ªLRUå’Œå…”å­ä¸åƒçªè¾¹è‰è¿™ä¸¤ä¸ªåŸºæœ¬åŸåˆ™æ¥æ¸…é™¤å†…å­˜ç©ºé—´ï¼š</p><ul>\n<li>LRUï¼šæŒ‰ç…§å…ƒç´ çš„è®¿é—®é¡ºåºï¼Œä¼˜å…ˆæ¸…é™¤é‚£äº›â€œæœ€è¿‘æœ€å°‘è®¿é—®â€çš„BlockIdã€MemoryEntryé”®å€¼å¯¹</li>\n<li>å…”å­ä¸åƒçªè¾¹è‰ï¼šåœ¨æ¸…é™¤çš„è¿‡ç¨‹ä¸­ï¼ŒåŒå±ä¸€ä¸ªRDDçš„MemoryEntryæ‹¥æœ‰â€œèµ¦å…æƒâ€</li>\n</ul><p>å…¶æ¬¡ï¼Œæˆ‘ä»¬è¦æŒæ¡ä½¿ç”¨Cacheçš„ä¸€èˆ¬æ€§åŸåˆ™å’Œæ³¨æ„äº‹é¡¹ï¼Œæˆ‘æŠŠå®ƒä»¬æ€»ç»“ä¸º3æ¡ï¼š</p><ul>\n<li>å¦‚æœRDD/DataFrame/Datasetåœ¨åº”ç”¨ä¸­çš„å¼•ç”¨æ¬¡æ•°ä¸º1ï¼Œæˆ‘ä»¬å°±åšå†³ä¸ä½¿ç”¨Cache</li>\n<li>å¦‚æœå¼•ç”¨æ¬¡æ•°å¤§äº1ï¼Œä¸”è¿è¡Œæˆæœ¬å æ¯”è¶…è¿‡30%ï¼Œæˆ‘ä»¬å°±è€ƒè™‘å¯ç”¨Cacheï¼ˆå…¶ä¸­ï¼Œè¿è¡Œæˆæœ¬å æ¯”çš„è®¡ç®—ï¼Œå¯ä»¥åˆ©ç”¨Spark 3.0æ¨å‡ºçš„noopåŠŸèƒ½ï¼‰</li>\n<li>Actionç®—å­è¦é€‰æ‹©countæ‰èƒ½å®Œå…¨ç‰©åŒ–ç¼“å­˜æ•°æ®ï¼Œä»¥åŠåœ¨è°ƒç”¨Cacheçš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦æŠŠå¾…ç¼“å­˜æ•°æ®èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ã€‚è¿™æ ·ä¸€æ¥ï¼Œåªè¦æ˜¯åœ¨è¿™ä¸ªå˜é‡ä¹‹ä¸Šçš„åˆ†ææ“ä½œéƒ½ä¼šå®Œå…¨å¤ç”¨ç¼“å­˜æ•°æ®ã€‚</li>\n</ul><h2>æ¯æ—¥ä¸€ç»ƒ</h2><ol>\n<li>ä½ èƒ½ç»“åˆDiskStoreçš„çŸ¥è¯†ï¼Œæ¨å¯¼å‡ºMEMORY_AND_DISKæ¨¡å¼ä¸‹RDDåˆ†ç‰‡ç¼“å­˜åˆ°ç£ç›˜çš„è¿‡ç¨‹å—ï¼Ÿ</li>\n<li>ä½ è§‰å¾—ï¼Œä¸ºä»€ä¹ˆEvictionè§„åˆ™è¦éµå¾ªâ€œå…”å­ä¸åƒçªè¾¹è‰â€å‘¢ï¼Ÿå¦‚æœå…è®¸åŒä¸€ä¸ªRDDçš„MemoryEntryè¢«é©±é€ï¼Œæœ‰ä»€ä¹ˆå±å®³å—ï¼Ÿ</li>\n<li>å¯¹äºDataFrameçš„ç¼“å­˜å¤ç”¨ï¼ŒCache Managerä¸ºä»€ä¹ˆæ²¡æœ‰é‡‡ç”¨æ ¹æ®Optimized Logical Plançš„æ–¹å¼ï¼Œä½ è§‰å¾—éš¾ç‚¹åœ¨å“ªé‡Œï¼Ÿå¦‚æœè®©ä½ å®ç°Cache Managerçš„è¯ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ</li>\n</ol><p>æœŸå¾…åœ¨ç•™è¨€åŒºçœ‹åˆ°ä½ çš„æ€è€ƒå’Œç­”æ¡ˆï¼Œå¦‚æœä½ çš„æœ‹å‹ä¹Ÿæ­£åœ¨ä¸ºæ€ä¹ˆä½¿ç”¨Cacheè€Œå›°æ‰°ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ä¸€è®²è½¬å‘ç»™ä»–ã€‚æˆ‘ä»¬ä¸‹ä¸€è®²è§ï¼</p>","comments":[{"had_liked":false,"id":301487,"user_name":"é™ˆå¨æ´‹","can_delete":false,"product_type":"c1","uid":2264679,"ip_address":"","ucode":"DCF84B4D3A7354","user_header":"https://static001.geekbang.org/account/avatar/00/22/8e/67/afb412fb.jpg","comment_is_top":false,"comment_ctime":1625713415,"is_pvip":false,"replies":[{"id":"109202","content":"å¥½é—®é¢˜å“ˆï¼Œç¬¬ä¸‰é—®ç¡®å®å¾ˆéš¾ï¼Œè¿™é‡Œè€å“¥æˆ‘æŒ–äº†ä¸ªå¤©å‘ï¼Œè€å¼Ÿè§è°…å“ˆ~<br><br>Sparkä½¿ç”¨cachedData = IndexedSeq[CachedData]()æ¥å­˜å‚¨ï¼ˆLogicalPlanï¼ŒInMemoryRelationï¼‰é”®å€¼å¯¹åˆ—è¡¨ï¼Œå…¶ä¸­çš„LogicalPlanå°±æ˜¯Analyzed Logical Planã€‚å’±ä»¬çš„é—®é¢˜æ˜¯ï¼Œä¸ºä»€ä¹ˆSparké€‰æ‹©äº†ä½¿ç”¨Analyzed LPä½œä¸ºKeyï¼Œè€Œæ²¡æœ‰é€‰æ‹©Optimized LPã€‚è¿™ä¸ªé—®é¢˜çš„å…³é”®ï¼Œå…¶å®æ˜¯Sparkå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¾…è®¡ç®—çš„æ‰§è¡Œè®¡åˆ’æ˜¯å¦å·²ç»å­˜åœ¨ç¼“å­˜ç»“æœäº†ã€‚Sparkæ€ä¹ˆæ¥åˆ¤æ–­å‘¢ï¼Ÿç®€å•çš„è¯´ï¼Œå°±æ˜¯é€šè¿‡è§„èŒƒåŒ–çš„Logical Planï¼ˆCanonicalizedPlanï¼‰æ¥è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœä¸¤ä¸ªæŸ¥è¯¢çš„CanonicalizedPlanæ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œé‚£ä¹ˆSpark SQLè®¤ä¸ºï¼šOKï¼Œè¿™ä¸ªè®¡åˆ’åœ¨ç¼“å­˜ä¸­å·²ç»æœ‰ç»“æœäº†ï¼Œç›´æ¥æ‹¿æ¥ç”¨å°±å¥½ã€‚<br><br>é‚£ä¹ˆæ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯ï¼Œç»™å®šä¸€ä¸ªLogical Planï¼ŒSpark SQLå¦‚ä½•ç”Ÿäº§CanonicalizedPlanï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŠŠASTè¯­æ³•æ ‘ä¸­çš„fieldsã€idsä¸å¤ªå½’ä¸€åŒ–çš„å­—æ®µè¿›è¡Œå½’ä¸€åŒ–ï¼Œä»è€Œæ¶ˆé™¤ä¸åŒæŸ¥è¯¢è®¡åˆ’ä¹‹é—´é‚£äº›â€œæ— å…³ç—›ç—’â€çš„ç»†å¾®å·®åˆ«ï¼Œè¿™äº›ç»†å¾®å·®åˆ«ä¸æŸ¥è¯¢ç»“æœæ— å…³ï¼Œæ‰€ä»¥åœ¨ç”ŸæˆCanonicalizedPlançš„è¿‡ç¨‹ä¸­ï¼ŒSparkä¼šæŠŠè¿™äº›â€œç»†å¾®å·®åˆ«â€å»æ‰ï¼Œä»è€Œä¸å½±å“ä¸¤ä¸ªCanonicalizedPlanä¹‹é—´æ˜¯å¦ç›¸åŒçš„å¯¹æ¯”ã€‚<br><br>ä½†æ˜¯ï¼Œè¿™ä¸ªè§„èŒƒåŒ–æˆ–æ˜¯å½’ä¸€åŒ–çš„è¿‡ç¨‹ï¼ŒSpark SQLå…¶å®å¹¶ä¸æ•¢å®Œå…¨ä¿è¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ¬æ¥è®¡ç®—ç»“æœç›¸åŒçš„ä¸¤ä¸ªæŸ¥è¯¢ï¼Œä»–ä»¬çš„CanonicalizedPlanä¾ç„¶æœ‰å¯èƒ½ä¸ä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„false negativeã€‚å¯¹äºä¸¤ä¸ªPlanä¹‹é—´CanonicalizedPlançš„å¯¹æ¯”ï¼ŒSpark SQLé‡‡å–ä¿å®ˆçš„ç­–ç•¥ï¼Œå°±æ˜¯å®å¯é”™æ€1000ï¼Œä¹Ÿä¸èƒ½æ¼æ”¾ä¸€ä¸ªã€‚ä¹Ÿå°±æ˜¯ï¼ŒSpark SQLå®å¯æŠŠä¸¤ä¸ªæ‰§è¡Œç»“æœä¸€æ ·çš„Logical Planåˆ¤å®šä¸ºä¸åŒï¼Œä¹Ÿè¦100%åœ°ä¿è¯ï¼šæ‰§è¡Œç»“æœä¸åŒçš„ä¸¤ä¸ªæŸ¥è¯¢ï¼Œä»–ä»¬çš„CanonicalizedPlanä¸€å®šæ˜¯100%æ˜¯ä¸åŒçš„ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½å…è®¸å‡ºç°false positiveçš„æƒ…å†µã€‚<br><br>æ­£æ˜¯å› ä¸ºCanonicalizedPlanæ— æ³•å®Œå…¨ç¡®ä¿æ‰§è¡Œè®¡åˆ’ä¸è®¡ç®—ç»“æœå®Œå…¨ä¸€ä¸€å¯¹åº”ï¼Œæ‰€ä»¥cachedDataè¿™ä¸ªä¸œè¥¿è¶Šæ—©æ£€æŸ¥è¶Šçœäº‹ï¼Œå¦‚æœæ¨è¿Ÿåˆ°Optimized Logical Planä¹‹åï¼Œé‚£ä¹ˆå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¦ä¹ˆç¼“å­˜å¾ˆéš¾å‘½ä¸­ï¼Œè¦ä¹ˆç¼“å­˜å¥½ä¸å®¹æ˜“å‘½ä¸­äº†ï¼Œä½†æ˜¯Optimizedé˜¶æ®µçš„ä¼˜åŒ–å°±éƒ½ç™½åšäº†ã€‚æ‰€ä»¥æ€»ç»“ä¸‹æ¥ï¼ŒæŠŠCacheæ£€æŸ¥æ”¾åœ¨Analyzed LPä¹‹åã€Optimized LPä¹‹å‰ï¼Œå°±æ˜¯ä¸Šé¢è¯´çš„è¿™ä¸ªåŸå› ã€‚è¿™ä¸ªç¡®å®æ¯”è¾ƒå˜æ€ï¼Œroot causeåˆ†æèµ·æ¥å¾ˆå›°éš¾ï¼Œè¿™ä¸ªå…¶å®éœ€è¦ç»“åˆæºç å»é¡ºè—¤æ‘¸ç“œã€‚è¾›è‹¦è€å¼Ÿäº†å“ˆ~ <br><br>å¦å¤–åˆ†äº«ç»™è€å¼Ÿä¸€ä¸ªå°tipsï¼šå½“ä½ å‘ç°ï¼Œä½ çš„é—®é¢˜ï¼Œç™¾åº¦ã€googleæˆ–æ˜¯èº«è¾¹çš„äººï¼Œéƒ½æ²¡åŠæ³•å¸®ä½ è§£ç­”çš„æ—¶å€™ï¼Œæºç æ˜¯æœ€å¥½çš„â€œè€å¸ˆâ€ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªæ˜¯å¼€æºé¡¹ç›®æœ€å¤§çš„æ„ä¹‰ï¼Œåˆ†äº«ç»™è€å¼Ÿ~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1625817439,"ip_address":"","comment_id":301487,"utype":1}],"discussion_count":2,"race_medal":0,"score":"53165320967","product_id":100073401,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼~æˆ‘çš„çŸ¥è¯†ç›²åŒºçªç°äº†ï¼š<br>å¯¹äºè€å¸ˆçš„ç¬¬ä¸‰é—®ï¼Œè‡ªå·±æ‘¸ä¸ç€å¤´è„‘ï¼Œçœ‹è€å¸ˆå’ŒåŒå­¦çš„å›ç­”ä¹Ÿçœ‹å¾—è’™è’™ï¼Œæ„Ÿè§‰ç¼ºå°‘äº†æŸéƒ¨åˆ†åŸºç¡€çŸ¥è¯†ï¼Œä½†åˆä¸çŸ¥é“ä»å“ªé‡Œè¡¥ï¼Œè¿™ç§æ„Ÿè§‰å¾ˆç—›è‹¦~<br><br>å¸Œæœ›è€å¸ˆèƒ½æŒ‡ç‚¹è¿·æ´¥ã€‚","like_count":13,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523010,"discussion_content":"å¥½é—®é¢˜å“ˆï¼Œç¬¬ä¸‰é—®ç¡®å®å¾ˆéš¾ï¼Œè¿™é‡Œè€å“¥æˆ‘æŒ–äº†ä¸ªå¤©å‘ï¼Œè€å¼Ÿè§è°…å“ˆ~\n\nSparkä½¿ç”¨cachedData = IndexedSeq[CachedData]()æ¥å­˜å‚¨ï¼ˆLogicalPlanï¼ŒInMemoryRelationï¼‰é”®å€¼å¯¹åˆ—è¡¨ï¼Œå…¶ä¸­çš„LogicalPlanå°±æ˜¯Analyzed Logical Planã€‚å’±ä»¬çš„é—®é¢˜æ˜¯ï¼Œä¸ºä»€ä¹ˆSparké€‰æ‹©äº†ä½¿ç”¨Analyzed LPä½œä¸ºKeyï¼Œè€Œæ²¡æœ‰é€‰æ‹©Optimized LPã€‚è¿™ä¸ªé—®é¢˜çš„å…³é”®ï¼Œå…¶å®æ˜¯Sparkå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¾…è®¡ç®—çš„æ‰§è¡Œè®¡åˆ’æ˜¯å¦å·²ç»å­˜åœ¨ç¼“å­˜ç»“æœäº†ã€‚Sparkæ€ä¹ˆæ¥åˆ¤æ–­å‘¢ï¼Ÿç®€å•çš„è¯´ï¼Œå°±æ˜¯é€šè¿‡è§„èŒƒåŒ–çš„Logical Planï¼ˆCanonicalizedPlanï¼‰æ¥è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœä¸¤ä¸ªæŸ¥è¯¢çš„CanonicalizedPlanæ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œé‚£ä¹ˆSpark SQLè®¤ä¸ºï¼šOKï¼Œè¿™ä¸ªè®¡åˆ’åœ¨ç¼“å­˜ä¸­å·²ç»æœ‰ç»“æœäº†ï¼Œç›´æ¥æ‹¿æ¥ç”¨å°±å¥½ã€‚\n\né‚£ä¹ˆæ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯ï¼Œç»™å®šä¸€ä¸ªLogical Planï¼ŒSpark SQLå¦‚ä½•ç”Ÿäº§CanonicalizedPlanï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŠŠASTè¯­æ³•æ ‘ä¸­çš„fieldsã€idsä¸å¤ªå½’ä¸€åŒ–çš„å­—æ®µè¿›è¡Œå½’ä¸€åŒ–ï¼Œä»è€Œæ¶ˆé™¤ä¸åŒæŸ¥è¯¢è®¡åˆ’ä¹‹é—´é‚£äº›â€œæ— å…³ç—›ç—’â€çš„ç»†å¾®å·®åˆ«ï¼Œè¿™äº›ç»†å¾®å·®åˆ«ä¸æŸ¥è¯¢ç»“æœæ— å…³ï¼Œæ‰€ä»¥åœ¨ç”ŸæˆCanonicalizedPlançš„è¿‡ç¨‹ä¸­ï¼ŒSparkä¼šæŠŠè¿™äº›â€œç»†å¾®å·®åˆ«â€å»æ‰ï¼Œä»è€Œä¸å½±å“ä¸¤ä¸ªCanonicalizedPlanä¹‹é—´æ˜¯å¦ç›¸åŒçš„å¯¹æ¯”ã€‚\n\nä½†æ˜¯ï¼Œè¿™ä¸ªè§„èŒƒåŒ–æˆ–æ˜¯å½’ä¸€åŒ–çš„è¿‡ç¨‹ï¼ŒSpark SQLå…¶å®å¹¶ä¸æ•¢å®Œå…¨ä¿è¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ¬æ¥è®¡ç®—ç»“æœç›¸åŒçš„ä¸¤ä¸ªæŸ¥è¯¢ï¼Œä»–ä»¬çš„CanonicalizedPlanä¾ç„¶æœ‰å¯èƒ½ä¸ä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„false negativeã€‚å¯¹äºä¸¤ä¸ªPlanä¹‹é—´CanonicalizedPlançš„å¯¹æ¯”ï¼ŒSpark SQLé‡‡å–ä¿å®ˆçš„ç­–ç•¥ï¼Œå°±æ˜¯å®å¯é”™æ€1000ï¼Œä¹Ÿä¸èƒ½æ¼æ”¾ä¸€ä¸ªã€‚ä¹Ÿå°±æ˜¯ï¼ŒSpark SQLå®å¯æŠŠä¸¤ä¸ªæ‰§è¡Œç»“æœä¸€æ ·çš„Logical Planåˆ¤å®šä¸ºä¸åŒï¼Œä¹Ÿè¦100%åœ°ä¿è¯ï¼šæ‰§è¡Œç»“æœä¸åŒçš„ä¸¤ä¸ªæŸ¥è¯¢ï¼Œä»–ä»¬çš„CanonicalizedPlanä¸€å®šæ˜¯100%æ˜¯ä¸åŒçš„ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½å…è®¸å‡ºç°false positiveçš„æƒ…å†µã€‚\n\næ­£æ˜¯å› ä¸ºCanonicalizedPlanæ— æ³•å®Œå…¨ç¡®ä¿æ‰§è¡Œè®¡åˆ’ä¸è®¡ç®—ç»“æœå®Œå…¨ä¸€ä¸€å¯¹åº”ï¼Œæ‰€ä»¥cachedDataè¿™ä¸ªä¸œè¥¿è¶Šæ—©æ£€æŸ¥è¶Šçœäº‹ï¼Œå¦‚æœæ¨è¿Ÿåˆ°Optimized Logical Planä¹‹åï¼Œé‚£ä¹ˆå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¦ä¹ˆç¼“å­˜å¾ˆéš¾å‘½ä¸­ï¼Œè¦ä¹ˆç¼“å­˜å¥½ä¸å®¹æ˜“å‘½ä¸­äº†ï¼Œä½†æ˜¯Optimizedé˜¶æ®µçš„ä¼˜åŒ–å°±éƒ½ç™½åšäº†ã€‚æ‰€ä»¥æ€»ç»“ä¸‹æ¥ï¼ŒæŠŠCacheæ£€æŸ¥æ”¾åœ¨Analyzed LPä¹‹åã€Optimized LPä¹‹å‰ï¼Œå°±æ˜¯ä¸Šé¢è¯´çš„è¿™ä¸ªåŸå› ã€‚è¿™ä¸ªç¡®å®æ¯”è¾ƒå˜æ€ï¼Œroot causeåˆ†æèµ·æ¥å¾ˆå›°éš¾ï¼Œè¿™ä¸ªå…¶å®éœ€è¦ç»“åˆæºç å»é¡ºè—¤æ‘¸ç“œã€‚è¾›è‹¦è€å¼Ÿäº†å“ˆ~ \n\nå¦å¤–åˆ†äº«ç»™è€å¼Ÿä¸€ä¸ªå°tipsï¼šå½“ä½ å‘ç°ï¼Œä½ çš„é—®é¢˜ï¼Œç™¾åº¦ã€googleæˆ–æ˜¯èº«è¾¹çš„äººï¼Œéƒ½æ²¡åŠæ³•å¸®ä½ è§£ç­”çš„æ—¶å€™ï¼Œæºç æ˜¯æœ€å¥½çš„â€œè€å¸ˆâ€ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªæ˜¯å¼€æºé¡¹ç›®æœ€å¤§çš„æ„ä¹‰ï¼Œåˆ†äº«ç»™è€å¼Ÿ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625817439,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2264679,"avatar":"https://static001.geekbang.org/account/avatar/00/22/8e/67/afb412fb.jpg","nickname":"é™ˆå¨æ´‹","note":"","ucode":"DCF84B4D3A7354","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383008,"discussion_content":"éå¸¸æ„Ÿè°¢è€å¸ˆçš„å›å¤ï¼Œæˆ‘å·²ç»çœ‹äº†3éå¤šï¼Œå¼€å§‹æœ‰ç‚¹å¤´ç»ªï¼Œå¿ƒæƒ…ä¹Ÿæ…¢æ…¢æ¢å¤ä¸€äº›[å“­]ï¼Œè¿˜ä¼šç»§ç»­æ·±å…¥ç ”ç©¶ï¼Œè€å¸ˆçš„æç¤ºéå¸¸é‡è¦ï¼Œæºç ç¡®å®éå¸¸é‡è¦ï¼Œé‚£ä¹ˆé—®é¢˜åˆæ¥äº†ï¼ˆè¯·åŸè°…æˆ‘ï¼‰ï¼Œç£Šå“¥ï¼Œå¯¹äºè¿˜æ²¡çœ‹è¿‡Sparkæºç ï¼Œæœ‰ç¼–ç¨‹ç»éªŒçš„äººæ¥è¯´ï¼Œå¦‚ä½•ç§‘å­¦çš„å­¦ä¹ Sparkæºç ï¼Œå“ªéƒ¨åˆ†åŠŸèƒ½å…ˆå…¥æ‰‹æ¯”è¾ƒå¥½ï¼Ÿï¼ˆå°±æ˜¯æƒ³ä»ç®€å•çš„å¼€å§‹å­¦ä¹ ~~ï¼‰","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1625822122,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":289075,"user_name":"FendoraèŒƒä¸œ_","can_delete":false,"product_type":"c1","uid":1187106,"ip_address":"","ucode":"63EE9DBEE08D70","user_header":"https://static001.geekbang.org/account/avatar/00/12/1d/22/f04cea4c.jpg","comment_is_top":false,"comment_ctime":1618842735,"is_pvip":false,"replies":[{"id":"104939","content":"ç­”å¾—éƒ½å¯¹ï¼Œå…·ä½“ç»†èŠ‚åˆšåˆšåœ¨ä¸Šä¸€ä¸ªthreadéƒ½å±•å¼€äº†ï¼Œå¯ä»¥çœ‹çœ‹å“ˆ~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1618916148,"ip_address":"","comment_id":289075,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27388646511","product_id":100073401,"comment_content":"1.M_A_Dåœ¨storage memoryå¯ç”¨çš„æƒ…å†µä¸‹ï¼Œç¼“å­˜blockè¿‡ç¨‹å’ŒM_Oè¿‡ç¨‹ä¸€æ ·ï¼ŒåŒºåˆ«åœ¨äºstorage_memoryä¸å¤Ÿæƒ…å†µä¸‹çš„å¤„ç†ã€‚M_Oæ˜¯é€šè¿‡LRUæ¥é©±é€blockæ¥è·å–å¯ç”¨ç¼“å­˜;è€ŒM_A_Dæ˜¯é€šè¿‡è½ç›˜ï¼Œè½ç›˜æµç¨‹å°±æ˜¯æŠŠunrollå‡ºæ¥çš„blockï¼Œé€šè¿‡putBytes()æ–¹æ³•ç›´æ¥è¿›è¡Œè½ç›˜ï¼ŒBlockIDä¸ºè½ç›˜æ–‡ä»¶åï¼Œä¾¿äºæŸ¥æ‰¾ã€‚<br>2.åœ¨M_Oæ¨¡å¼ä¸‹ï¼Œä¸ºå•¥ä¸é©±é€åŒä¸€ä¸ªRDDçš„memoryentryã€‚æˆ‘ç†è§£ï¼Œå½“å‰RDDæ­£åœ¨ç¼“å­˜ï¼Œé‚£å®ƒé©¬ä¸Šè¢«ç”¨åˆ°çš„æ¦‚ç‡æ˜¯æœ€é«˜çš„(ç±»ä¼¼LRUæ€æƒ³)ï¼Œå¦‚æœå®ƒé‡Œé¢memoryentryè¢«é©±é€ï¼Œé‚£éœ€è¦ç”¨çš„æ—¶å€™åˆè¦é‡æ–°è®¡ç®—ï¼Œç™½ç™½å¢åŠ è€—æ—¶ã€‚<br>3.åœ¨analyzedé˜¶æ®µåŒ¹é…ï¼Œæˆ‘è®°å¾—æ˜¯å› ä¸ºåœ¨analyzerç”Ÿæ•ˆé˜¶æ®µä¼šæŠŠunresolverelationç›´æ¥è§£æä¸ºInMemoryRelationã€‚è¿™æ ·åœ¨åœ¨Optimizeré˜¶æ®µæœ‰äº›ä¼˜åŒ–è§„åˆ™å°±çœç•¥äº†ï¼Œé¿å…åº”ç”¨è§„åˆ™æµªè´¹æ—¶é—´","like_count":7,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518808,"discussion_content":"ç­”å¾—éƒ½å¯¹ï¼Œå…·ä½“ç»†èŠ‚åˆšåˆšåœ¨ä¸Šä¸€ä¸ªthreadéƒ½å±•å¼€äº†ï¼Œå¯ä»¥çœ‹çœ‹å“ˆ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618916148,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":289077,"user_name":"FendoraèŒƒä¸œ_","can_delete":false,"product_type":"c1","uid":1187106,"ip_address":"","ucode":"63EE9DBEE08D70","user_header":"https://static001.geekbang.org/account/avatar/00/12/1d/22/f04cea4c.jpg","comment_is_top":false,"comment_ctime":1618843429,"is_pvip":false,"replies":[{"id":"104938","content":"å¥½é—®é¢˜~<br><br>1. æ˜¯çš„ï¼Œä¸€ä¸ªç©ºé—´ä¸å¤Ÿï¼Œå› æ­¤ç»§ç»­å‘åæ‰«æï¼Œæ‰«äº†ä¸¤ä¸ªä¹‹åï¼Œå‘ç°ç©ºé—´å¤Ÿäº†ï¼Œå°±åœæ­¢äº†ã€‚<br><br>2. è¿™ä¸ªè¦èµä¸€ä¸ª~ ğŸ‘ï¼Œæ€è€ƒå¾ˆç»†è‡´ã€‚è¿™é‡Œå’±ä»¬å›¾çœäº‹ï¼Œæˆ‘æ²¡æœ‰äº¤ä»£çš„ç‰¹åˆ«æ¸…æ¥šï¼Œå®é™…ä¸Šï¼ŒblockIdä¸æ˜¯Stringï¼Œè€Œæ˜¯ä¸€ä¸ªsealed classï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªç±»ã€‚è¿™ä¸ªç±»æœ‰ä¸å°‘å±æ€§ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯asRDDIdï¼Œè¿™ä¸ªå‡½æ•°å°±å¯ä»¥ç”¨æ¥è·å–RDD Idï¼Œä»è€ŒåŒºåˆ†æ‰«æçš„Blockï¼Œæ˜¯å±äºå“ªä¸ªRDDçš„ï¼Œä»è€Œå®ç°â€œå…”å­ä¸åƒçªè¾¹è‰â€~<br><br>3. å¯¹ï¼Œç°åœ¨çš„è®¾è®¡ï¼Œæ˜¯æ”¾åœ¨Analyzed LPä¹‹åã€Optimized LPä¹‹å‰ï¼Œç›¸å½“äºæ˜¯ä¸€ç§é€»è¾‘ä¼˜åŒ–ï¼Œå°±åƒä½ è¯´çš„ï¼Œèƒ½çœç•¥æ‰ä¸€äº›Rulesã€æˆ–è€…é€‰å–ä¸€äº›æ›´ä¼˜çš„Rulesã€‚<br><br>å…³äºCache Managerçš„ä¼˜åŒ–ï¼Œæœ‰ä¸ªæ€è·¯æ˜¯SQL Re-writeï¼Œå…¶å®è¿™ä¸ªæ€è·¯å°±æ¥æºäºä¼ ç»Ÿçš„DBMSï¼ŒSpark SQLæ²¡æœ‰è¿™ä¸ªç¯èŠ‚ã€‚å¦‚æœèƒ½å¤Ÿç”¨SQL Re-writerï¼ŒæŠŠAnalyzed LPé‡å†™ï¼Œé‚£ä¹ˆå…¶å®potentiallyï¼Œå¾ˆå¤šçš„Analyzed LPéƒ½å¯ä»¥å…±äº«ä¸€ä»½æ•°æ®ã€‚Query Re-writeræœ¬èº«ä¹Ÿå¹¶ä¸å¤æ‚ï¼Œå‚è€ƒä¼ ç»ŸDBMSï¼Œå°±å¯ä»¥å¾ˆå¿«å®ç°å‡ºä¸€ä¸ªæ¥ã€‚å¦‚æœCache Managerå‚è€ƒçš„ï¼Œä¸å†æ˜¯â€œçº¯å­—ç¬¦ä¸²â€çš„Analyzed LPï¼Œè€Œæ˜¯é‡å†™ä¹‹åçš„æŸ¥è¯¢ï¼Œæƒ³å¿…æ•ˆæœè¦å¥½å¾ˆå¤š~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1618915835,"ip_address":"","comment_id":289077,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23093679909","product_id":100073401,"comment_content":"è¿˜æœ‰å‡ ä¸ªç–‘é—®ï¼Œ<br>1.é©±é€memoryentryçš„æ—¶å€™ï¼Œå›¾ä¸Šä¸¤ä¸ªæ‰“å‰ï¼Œæˆ‘ç†è§£å¦‚æœé©±é€ä¸€ä¸ªå†…å­˜è¿˜æ˜¯ä¸å¤Ÿï¼Œå°±é©±é€äº†ä¸¤ä¸ªï¼Ÿ<br>2.linkedhashmapæ˜¯æ€æ ·åŒºåˆ†ä¸åŒRDDçš„blockçš„ï¼Œkæ˜¯blockidï¼Œvæ˜¯memoryentryã€‚æ²¡çœ‹åˆ°æ‰€å±RDDçš„å±æ€§<br>3.è‡ªå·±è®¾è®¡cacheManageræ²¡å•¥æ›´å¥½æƒ³æ³•ï¼Œæ±‚ç£Šå“¥æç¤ºä¸‹ã€‚ã€‚ã€‚æˆ‘ç†è§£è¿™ä¸ªä¸œè¥¿æ”¾åœ¨æœ€å‰é¢æ¯”è¾ƒåˆç†ï¼Œåé¢é’ˆå¯¹ç¼“å­˜çš„é€»è¾‘è®¡åˆ’è¿›ä¸€æ­¥åº”ç”¨æˆ–çœç•¥ä¼˜åŒ–è§„åˆ™","like_count":5,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518810,"discussion_content":"å¥½é—®é¢˜~\n\n1. æ˜¯çš„ï¼Œä¸€ä¸ªç©ºé—´ä¸å¤Ÿï¼Œå› æ­¤ç»§ç»­å‘åæ‰«æï¼Œæ‰«äº†ä¸¤ä¸ªä¹‹åï¼Œå‘ç°ç©ºé—´å¤Ÿäº†ï¼Œå°±åœæ­¢äº†ã€‚\n\n2. è¿™ä¸ªè¦èµä¸€ä¸ª~ ğŸ‘ï¼Œæ€è€ƒå¾ˆç»†è‡´ã€‚è¿™é‡Œå’±ä»¬å›¾çœäº‹ï¼Œæˆ‘æ²¡æœ‰äº¤ä»£çš„ç‰¹åˆ«æ¸…æ¥šï¼Œå®é™…ä¸Šï¼ŒblockIdä¸æ˜¯Stringï¼Œè€Œæ˜¯ä¸€ä¸ªsealed classï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªç±»ã€‚è¿™ä¸ªç±»æœ‰ä¸å°‘å±æ€§ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯asRDDIdï¼Œè¿™ä¸ªå‡½æ•°å°±å¯ä»¥ç”¨æ¥è·å–RDD Idï¼Œä»è€ŒåŒºåˆ†æ‰«æçš„Blockï¼Œæ˜¯å±äºå“ªä¸ªRDDçš„ï¼Œä»è€Œå®ç°â€œå…”å­ä¸åƒçªè¾¹è‰â€~\n\n3. å¯¹ï¼Œç°åœ¨çš„è®¾è®¡ï¼Œæ˜¯æ”¾åœ¨Analyzed LPä¹‹åã€Optimized LPä¹‹å‰ï¼Œç›¸å½“äºæ˜¯ä¸€ç§é€»è¾‘ä¼˜åŒ–ï¼Œå°±åƒä½ è¯´çš„ï¼Œèƒ½çœç•¥æ‰ä¸€äº›Rulesã€æˆ–è€…é€‰å–ä¸€äº›æ›´ä¼˜çš„Rulesã€‚\n\nå…³äºCache Managerçš„ä¼˜åŒ–ï¼Œæœ‰ä¸ªæ€è·¯æ˜¯SQL Re-writeï¼Œå…¶å®è¿™ä¸ªæ€è·¯å°±æ¥æºäºä¼ ç»Ÿçš„DBMSï¼ŒSpark SQLæ²¡æœ‰è¿™ä¸ªç¯èŠ‚ã€‚å¦‚æœèƒ½å¤Ÿç”¨SQL Re-writerï¼ŒæŠŠAnalyzed LPé‡å†™ï¼Œé‚£ä¹ˆå…¶å®potentiallyï¼Œå¾ˆå¤šçš„Analyzed LPéƒ½å¯ä»¥å…±äº«ä¸€ä»½æ•°æ®ã€‚Query Re-writeræœ¬èº«ä¹Ÿå¹¶ä¸å¤æ‚ï¼Œå‚è€ƒä¼ ç»ŸDBMSï¼Œå°±å¯ä»¥å¾ˆå¿«å®ç°å‡ºä¸€ä¸ªæ¥ã€‚å¦‚æœCache Managerå‚è€ƒçš„ï¼Œä¸å†æ˜¯â€œçº¯å­—ç¬¦ä¸²â€çš„Analyzed LPï¼Œè€Œæ˜¯é‡å†™ä¹‹åçš„æŸ¥è¯¢ï¼Œæƒ³å¿…æ•ˆæœè¦å¥½å¾ˆå¤š~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618915835,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":291458,"user_name":"é™å¿ƒ","can_delete":false,"product_type":"c1","uid":1789481,"ip_address":"","ucode":"B80DE4B5C923D3","user_header":"https://static001.geekbang.org/account/avatar/00/1b/4e/29/adcb78e7.jpg","comment_is_top":false,"comment_ctime":1620294581,"is_pvip":false,"replies":[{"id":"105586","content":"å¥½é—®é¢˜ï¼ŒRDDç¡®å®ä¸å­˜åœ¨Cache missçš„é—®é¢˜ï¼›å’±ä»¬æ–‡ä¸­è¯´çš„Cache missï¼Œéƒ½æ˜¯å›´ç»•ç€DataFrameï¼ŒDataFrameã€Datasetã€SQLéƒ½èµ°Spark SQLä¼˜åŒ–æµç¨‹ã€‚Spark SQLæœ‰å•ç‹¬çš„Cache Manageræ¥ç®¡ç†Cacheå¤ç”¨ï¼Œå®ƒæœ¬èº«çš„ä¸€äº›ç¼ºé™·ï¼Œä¼šå¯¼è‡´ä¸Šè¿°è¿™äº›APIï¼Œåœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œä¼šæœ‰Cache missçš„éšæ‚£~ <br><br>å…³äºSpark SQLçš„ä¼˜åŒ–æµç¨‹ï¼Œå¯ä»¥å‚è€ƒåé¢Spark SQLé‚£ä¸‰è®²ï¼Œé‚£å‡ è®²å±•å¼€çš„æ¯”è¾ƒç»†å“ˆ~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1620312458,"ip_address":"","comment_id":291458,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18800163765","product_id":100073401,"comment_content":"è€å¸ˆï¼ŒRDDè°ƒç”¨ Cache çš„æ—¶å€™ï¼Œæ–‡ä¸­è®²åˆ°æˆ‘ä»¬è¦æŠŠå¾…ç¼“å­˜æ•°æ®èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼Œç„¶ååŸºäºè¿™ä¸ªå˜é‡åšåç»­çš„etlï¼Œèƒ½å¤Ÿé˜²æ­¢cache missé—®é¢˜ï¼Œä½†æ˜¯æˆ‘çœ‹äº†ä¸€ä¸‹rdd cacheæºç ï¼Œè¿”å›å€¼å°±æ˜¯åŸæ¥çš„RDDï¼Œåªæ˜¯æ›´æ”¹äº†rddçš„storageLevelä¸ºMEMORY_ONLYï¼ˆrddé»˜è®¤ç¼“å­˜çº§åˆ«ï¼‰ï¼Œæ‰€ä»¥rdd è°ƒç”¨cacheåèµ‹å€¼åˆ°ä¸€ä¸ªæ–°å˜é‡å†åšetl ä¸ ä¸èµ‹å€¼è€Œæ˜¯åŸºäºåŸæœ‰RDDè¿›è¡Œetlåº”è¯¥ä¸ä¼šæœ‰cache missé—®é¢˜å§ï¼Œæœ‰ç‚¹ä¸å¤ªç†è§£ï¼Œæœ›è€å¸ˆè§£ç–‘ï¼Œè°¢è°¢ã€‚","like_count":4,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519476,"discussion_content":"å¥½é—®é¢˜ï¼ŒRDDç¡®å®ä¸å­˜åœ¨Cache missçš„é—®é¢˜ï¼›å’±ä»¬æ–‡ä¸­è¯´çš„Cache missï¼Œéƒ½æ˜¯å›´ç»•ç€DataFrameï¼ŒDataFrameã€Datasetã€SQLéƒ½èµ°Spark SQLä¼˜åŒ–æµç¨‹ã€‚Spark SQLæœ‰å•ç‹¬çš„Cache Manageræ¥ç®¡ç†Cacheå¤ç”¨ï¼Œå®ƒæœ¬èº«çš„ä¸€äº›ç¼ºé™·ï¼Œä¼šå¯¼è‡´ä¸Šè¿°è¿™äº›APIï¼Œåœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œä¼šæœ‰Cache missçš„éšæ‚£~ \n\nå…³äºSpark SQLçš„ä¼˜åŒ–æµç¨‹ï¼Œå¯ä»¥å‚è€ƒåé¢Spark SQLé‚£ä¸‰è®²ï¼Œé‚£å‡ è®²å±•å¼€çš„æ¯”è¾ƒç»†å“ˆ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620312458,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":292032,"user_name":"ç§‘å­¦å…»ç‰›","can_delete":false,"product_type":"c1","uid":1489525,"ip_address":"","ucode":"B205209A814AC8","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI9X140JXPuaDB8PibXpwFWds6mZvg1w7THkyB6NjBkP7x4HqSk2wuUvcmDb9O2l0fCkxvB3ibL0L2A/132","comment_is_top":false,"comment_ctime":1620649986,"is_pvip":false,"replies":[{"id":"105751","content":"å¯¹ï¼Œæ˜¯çš„ï¼Œè¦å…ˆç”¨Actionç®—å­æ¥è§¦å‘ç¼“å­˜çš„è®¡ç®—ï¼Œè®©SparkçœŸæ­£æŠŠåˆ†å¸ƒå¼æ•°æ®é›†ç¼“å­˜åˆ°å†…å­˜æˆ–æ˜¯ç£ç›˜ä¸­å»ã€‚å¦åˆ™çš„è¯ï¼Œå°±åƒä½ è¯´çš„ï¼Œâ€œå°±ç®—ç”¨äº†cachedRddè¿™ä¸ªå˜é‡å¤šæ¬¡ç¼“å­˜ä¹Ÿä¸èµ·æ•ˆæœâ€ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1620661063,"ip_address":"","comment_id":292032,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14505551874","product_id":100073401,"comment_content":"è€å¸ˆï¼Œä½ çš„æ„æ€æ˜¯è°ƒç”¨.cacheä¹‹åï¼Œéœ€è¦é©¬ä¸Šæ¥ä¸€ä¸ªactionç®—å­å—ï¼Ÿ<br>å¦‚æœæˆ‘ä¸é©¬ä¸Šæ¥actionç®—å­ï¼Œåªåœ¨æœ€åè°ƒç”¨ä¸€ä¸ªactionç®—å­ï¼Œæ¯”å¦‚saveAsTableï¼Œé‚£åœ¨ä¹‹å‰å°±ç®—ç”¨äº†cachedRddè¿™ä¸ªå˜é‡å¤šæ¬¡ç¼“å­˜ä¹Ÿä¸èµ·æ•ˆæœæ˜¯å—ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519642,"discussion_content":"å¯¹ï¼Œæ˜¯çš„ï¼Œè¦å…ˆç”¨Actionç®—å­æ¥è§¦å‘ç¼“å­˜çš„è®¡ç®—ï¼Œè®©SparkçœŸæ­£æŠŠåˆ†å¸ƒå¼æ•°æ®é›†ç¼“å­˜åˆ°å†…å­˜æˆ–æ˜¯ç£ç›˜ä¸­å»ã€‚å¦åˆ™çš„è¯ï¼Œå°±åƒä½ è¯´çš„ï¼Œâ€œå°±ç®—ç”¨äº†cachedRddè¿™ä¸ªå˜é‡å¤šæ¬¡ç¼“å­˜ä¹Ÿä¸èµ·æ•ˆæœâ€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620661063,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2767208,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/39/68/56dfc8c0.jpg","nickname":"å­å…®","note":"","ucode":"BA213EAB26DF16","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":531344,"discussion_content":"è€å¸ˆï¼Œ b = a.map.cache;   c= b.map;   d = b.map;   d.count; è¿™ç§åœ¨spark graphx é‡ŒbRDD ä¸èƒ½è¢«cache å—ï¼Ÿ æˆ‘ç†è§£æ˜¯cache ä¹Ÿæ˜¯lazy ç®—å­å’Œmap ä¸€æ ·ï¼Œ count ç”Ÿæˆjob ï¼Œæ‰§è¡Œdag , å°±ä¼šç¼“å­˜ï¼Œè¿˜è¯·è€å¸ˆæŒ‡æ•™ï¼Œè°¢è°¢è€å¸ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637290099,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":291291,"user_name":"aof","can_delete":false,"product_type":"c1","uid":1062864,"ip_address":"","ucode":"5815D63C4926BC","user_header":"https://static001.geekbang.org/account/avatar/00/10/37/d0/26975fba.jpg","comment_is_top":false,"comment_ctime":1620190234,"is_pvip":false,"replies":[{"id":"105749","content":"1 æ²¡é—®é¢˜ï¼Œæˆ‘ä¹‹å‰çœ‹è¿‡ä½ çš„å›ç­”~<br><br>2ã€3 ä¹Ÿéƒ½å¯¹ï¼Œæ»¡åˆ†ğŸ’¯~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1620659469,"ip_address":"","comment_id":291291,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10210124826","product_id":100073401,"comment_content":"1. ç¬¬ä¸€é¢˜ï¼Œåœ¨å‰é¢å¹¿æ’­å˜é‡é‚£ä¸€èŠ‚çš„è¯¾åæ€è€ƒé¢˜å·²ç»å›ç­”è¿‡æ•´ä¸ªMemoryStoreå’ŒDiskStoreçš„ç¼“å­˜è¿‡ç¨‹äº†å“ˆå“ˆ<br>2. å› ä¸ºåŒä¸€ä¸ªRDDçš„Blockå¤§æ¦‚ç‡åœ¨æ¥ä¸‹æ¥å°±ä¼šè¢«ç”¨åˆ°ï¼Œå› ä¸ºæœ¬èº«è¦ç¼“å­˜çš„å°±æ˜¯åŒä¸€ä¸ªRDDçš„å…¶ä»–Blockï¼Œå¦‚æœä¸è¿™æ ·åšçš„è¯ï¼Œå¾ˆå¯èƒ½è¦ç¼“å­˜çš„Blockè¢«ç¼“å­˜åˆ°å†…å­˜äº†ï¼Œå´å‘ç°è¦ç”¨çš„Blockå´è¢«é©±é€å‡ºå†…å­˜äº†<br>3. è¿™æ˜¯æˆ‘è‡ªå·±çš„çŒœæµ‹ä¸çŸ¥é“å¯¹ä¸å¯¹å“ˆå“ˆï¼šåƒç¬¬äºŒç§æ–¹å¼é‚£æ ·åœ¨æ•°æ®é›†ä¸Šåšäº†ä¸€äº›å¤„ç†ä¹‹åè¿›è¡Œcacheï¼Œåç»­Cache Managerå¦‚æœé‡‡ç”¨æ ¹æ® Optimized Logical Plan çš„æ–¹å¼æ¥è¿›è¡Œä¼˜åŒ–çš„è¯ï¼Œé‚£åé¢æ‰€æœ‰ç”¨åˆ°dfè¿™ä¸ªDataframeçš„åœ°æ–¹ï¼ŒSparkéƒ½è¦è§£æå¯¹åº”çš„Optimized Logical Planå’Œæˆ‘ä»¬ä¹‹å‰cacheçš„é‚£ä¸ªæ˜¯å¦ç›¸åŒï¼Œè¿™å°†ä¼šéå¸¸ä¸å¯æ§ã€‚è€Œä¸”ç”±äºRDD&#47;Dataset&#47;Dataframeçš„ä¸å¯å˜æ€§ï¼Œæˆ‘ä»¬æ¯æ¬¡åœ¨å¯¹æ•°æ®é›†è¿›è¡Œå¤„ç†ä¹‹åï¼Œå…¶å®éƒ½åº”è¯¥å…»æˆå°†å…¶èµ‹å€¼ç»™ä¸€ä¸ªæ–°å˜é‡çš„ä¹ æƒ¯ã€‚","like_count":2,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519431,"discussion_content":"1 æ²¡é—®é¢˜ï¼Œæˆ‘ä¹‹å‰çœ‹è¿‡ä½ çš„å›ç­”~\n\n2ã€3 ä¹Ÿéƒ½å¯¹ï¼Œæ»¡åˆ†ğŸ’¯~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620659469,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":289273,"user_name":"è¾°","can_delete":false,"product_type":"c1","uid":2172635,"ip_address":"","ucode":"2E898EAC5AA141","user_header":"https://static001.geekbang.org/account/avatar/00/21/26/db/27724a6f.jpg","comment_is_top":false,"comment_ctime":1618965321,"is_pvip":false,"replies":[{"id":"105006","content":"ç‰©åŒ–ï¼ˆMaterializationï¼‰ï¼šæŠŠåˆ†å¸ƒå¼æ•°æ®é›†çš„Iteratorè¿­ä»£å™¨ï¼Œå±•å¼€å¹¶å­˜å‚¨åˆ°å†…å­˜æˆ–æ˜¯ç£ç›˜çš„è¿‡ç¨‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1619018930,"ip_address":"","comment_id":289273,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5913932617","product_id":100073401,"comment_content":"ä»¥åŠç¼“å­˜çš„å®Œå…¨ç‰©åŒ–çš„ç‰©åŒ–æ˜¯æŒ‡ä»€ä¹ˆæ„æ€å‘¢","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518870,"discussion_content":"ç‰©åŒ–ï¼ˆMaterializationï¼‰ï¼šæŠŠåˆ†å¸ƒå¼æ•°æ®é›†çš„Iteratorè¿­ä»£å™¨ï¼Œå±•å¼€å¹¶å­˜å‚¨åˆ°å†…å­˜æˆ–æ˜¯ç£ç›˜çš„è¿‡ç¨‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619018930,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":289272,"user_name":"è¾°","can_delete":false,"product_type":"c1","uid":2172635,"ip_address":"","ucode":"2E898EAC5AA141","user_header":"https://static001.geekbang.org/account/avatar/00/21/26/db/27724a6f.jpg","comment_is_top":false,"comment_ctime":1618965246,"is_pvip":false,"replies":[{"id":"105005","content":"æ–‡ä¸­çš„ä¸‰ç§æ–¹å¼ï¼Œä¸»è¦æ˜¯ä¸ºäº†åŒºåˆ«ç¤ºæ„å“ˆï¼Œç›®çš„æ˜¯ä¸ºäº†è¯´æ¸…æ¥šç¼“å­˜å¤ç”¨ã€‚å®é™…å¼€å‘çš„æ—¶å€™ï¼Œè‚¯å®šæ˜¯éœ€è¦Actionç®—å­æ¥è§¦å‘ç¼“å­˜è®¡ç®—çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1619018857,"ip_address":"","comment_id":289272,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5913932542","product_id":100073401,"comment_content":"è€å¸ˆï¼Œæ–‡ä¸­çš„ä¸‰ç§cacheæ–¹å¼ï¼Œæˆ‘çœ‹éƒ½æ²¡æœ‰è°ƒç”¨actionç®—å­ï¼ˆæ’é™¤ç¬¬äºŒç§ä¸ä¼šcacheçš„åœºæ™¯ï¼‰ï¼Œæ˜¯ä¸æ˜¯æ„å‘³ç€éƒ½ä¸ä¼šç¼“å­˜è½ç›˜çš„æ“ä½œ","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518869,"discussion_content":"æ–‡ä¸­çš„ä¸‰ç§æ–¹å¼ï¼Œä¸»è¦æ˜¯ä¸ºäº†åŒºåˆ«ç¤ºæ„å“ˆï¼Œç›®çš„æ˜¯ä¸ºäº†è¯´æ¸…æ¥šç¼“å­˜å¤ç”¨ã€‚å®é™…å¼€å‘çš„æ—¶å€™ï¼Œè‚¯å®šæ˜¯éœ€è¦Actionç®—å­æ¥è§¦å‘ç¼“å­˜è®¡ç®—çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619018857,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":289008,"user_name":"Jay","can_delete":false,"product_type":"c1","uid":1066131,"ip_address":"","ucode":"488BF5D01D3CFD","user_header":"https://static001.geekbang.org/account/avatar/00/10/44/93/2d3d5868.jpg","comment_is_top":false,"comment_ctime":1618818515,"is_pvip":false,"replies":[{"id":"104940","content":"ä¸æ˜¯å“ˆï¼ŒRDDè¿˜ä¸å¦‚DataFrameï¼Œå› ä¸ºDFä¼šèµ°Spark SQLï¼ŒCache Manageræ˜¯Spark SQLçš„ç»„ä»¶ä¹‹ä¸€ã€‚è™½ç„¶CMæ•ˆç‡ä¸é«˜ã€å®¹æ˜“missï¼Œä½†æ˜¯Spark SQLå¥½æ­¹è¿˜æœ‰è¿™ä¹ˆä¸ªç»„ä»¶å¸®ä»–å¤ç”¨Cacheã€‚<br><br>RDDæ›´æƒ¨ï¼Œæ²¡æœ‰å“ªä¸ªç»„ä»¶æ¥å¸®ä»–åšâ€œå¤ç”¨â€è¿™ä»¶äº‹ï¼Œæ‰€ä»¥ï¼Œè¦æƒ³å……åˆ†åˆ©ç”¨ã€å¤ç”¨RDD Cacheï¼Œä½ åªèƒ½ç”¨ç¬¬ä¸‰ç§æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯å˜é‡èµ‹å€¼çš„æ–¹å¼ï¼Œæ˜ç¡®åœ°å¼•ç”¨RDD Cacheã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1618916524,"ip_address":"","comment_id":289008,"utype":1}],"discussion_count":4,"race_medal":0,"score":"5913785811","product_id":100073401,"comment_content":"è€å¸ˆï¼Œå¦‚æœç”¨çš„æ˜¯RDDï¼Œæ–‡ä¸­çš„â€œCacheæ–¹å¼äºŒâ€æ˜¯ä¸æ˜¯å°±æ²¡æœ‰é—®é¢˜äº†ï¼Ÿ ","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518792,"discussion_content":"ä¸æ˜¯å“ˆï¼ŒRDDè¿˜ä¸å¦‚DataFrameï¼Œå› ä¸ºDFä¼šèµ°Spark SQLï¼ŒCache Manageræ˜¯Spark SQLçš„ç»„ä»¶ä¹‹ä¸€ã€‚è™½ç„¶CMæ•ˆç‡ä¸é«˜ã€å®¹æ˜“missï¼Œä½†æ˜¯Spark SQLå¥½æ­¹è¿˜æœ‰è¿™ä¹ˆä¸ªç»„ä»¶å¸®ä»–å¤ç”¨Cacheã€‚\n\nRDDæ›´æƒ¨ï¼Œæ²¡æœ‰å“ªä¸ªç»„ä»¶æ¥å¸®ä»–åšâ€œå¤ç”¨â€è¿™ä»¶äº‹ï¼Œæ‰€ä»¥ï¼Œè¦æƒ³å……åˆ†åˆ©ç”¨ã€å¤ç”¨RDD Cacheï¼Œä½ åªèƒ½ç”¨ç¬¬ä¸‰ç§æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯å˜é‡èµ‹å€¼çš„æ–¹å¼ï¼Œæ˜ç¡®åœ°å¼•ç”¨RDD Cacheã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618916524,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1021794,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/97/62/1a2d7825.jpg","nickname":"è‡»æœçˆ¸çˆ¸","note":"","ucode":"03DC9615B024A4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385713,"discussion_content":"å¦‚æœæŠŠdfæ³¨å†Œä¸ºä¸´æ—¶è¡¨ï¼Œåç»­åŸºäºè¿™ä¸ªè¡¨çš„sparksqléƒ½ä¼šå¤ç”¨ç¼“å­˜å§ï¼Œè¿™æ ·æ–¹å¼äºŒå’Œä¸‰å°±æ²¡æœ‰åŒºåˆ«å§ï¼Œæºç é‡Œé¢è¿”å›çš„ä¹Ÿæ˜¯åŒä¸€ä¸ªå¼•ç”¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627222381,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1021794,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/97/62/1a2d7825.jpg","nickname":"è‡»æœçˆ¸çˆ¸","note":"","ucode":"03DC9615B024A4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385712,"discussion_content":"æ–¹å¼2åº”è¯¥ä¼šä½¿ç”¨ç¼“å­˜çš„å§ï¼Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627221911,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1168504,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d4/78/66b3f2a2.jpg","nickname":"æ–¯ç›–ä¸¸","note":"","ucode":"B881D14B028F14","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368805,"discussion_content":"ä¸æ˜¯ï¼Œä¹Ÿæœ‰çš„ï¼Œç¼“å­˜å’Œå¼•ç”¨çš„ä¸æ˜¯åŒä¸€ä¸ªä¸œè¥¿ã€‚å‡½æ•°å¼æ“ä½œæ¯æ¬¡éƒ½è¿”å›ä¸€ä¸ªæ–°å˜é‡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618836011,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354960,"user_name":"ä¸‰èƒ–","can_delete":false,"product_type":"c1","uid":1373454,"ip_address":"åŒ—äº¬","ucode":"CD69FCD606FC5C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/1hp9kzzuLUVHzmmddIPIO2OgUWr1ibJRr8cMoB7K0fwx8Vmn34L8yN2NoYUtgNicfPGaXKF02pQ2huXd59r2I0kw/132","comment_is_top":false,"comment_ctime":1660911287,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1660911287","product_id":100073401,"comment_content":"è€å¸ˆï¼Œå¦‚æœç¼“å­˜çº§åˆ«æ˜¯MEMORY_ONLYï¼Œç„¶åå¤šä¸ªrddæŠ¢å èµ„æºï¼Œç»“æœå¯¼è‡´å„ä¸ªrddçš„ç¼“å­˜æ¯”ä¾‹éƒ½æ²¡æœ‰è¾¾åˆ°100%ï¼Œè¯´æ˜ç¼“å­˜çš„æ•°æ®æ˜¯ç¼ºå¤±çš„ï¼Œä¸‹æ¸¸è¦ç”¨åˆ°ç¼“å­˜çš„rddï¼Œä½†æ˜¯æ‹¿åˆ°çš„æ˜¯æœ‰ç¼ºå¤±çš„æ•°æ®ï¼Œè¿™è¿˜èƒ½ç”¨å—","like_count":0},{"had_liked":false,"id":348333,"user_name":"Geek_73cee2","can_delete":false,"product_type":"c1","uid":2828185,"ip_address":"","ucode":"54848FF6BE74B1","user_header":"","comment_is_top":false,"comment_ctime":1655002612,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1655002612","product_id":100073401,"comment_content":"è€å¸ˆ æ‚¨è¯´çš„è¿™äº›å†…å­˜æ˜¯æ•´ä¸ªé›†ç¾¤çš„ è€Œä¸æ˜¯å•ä¸ªçš„executorså†…æœ‰å¤šå°‘å†…å­˜å—  æ¯”å¦‚storage memory usermemory  è¿˜æœ‰å‘¢ä¸ªresever m 300mé‚£ä¸ª","like_count":0},{"had_liked":false,"id":322786,"user_name":"tiankonghewo","can_delete":false,"product_type":"c1","uid":1476427,"ip_address":"","ucode":"7A55A9C17DD9DF","user_header":"https://static001.geekbang.org/account/avatar/00/16/87/4b/16ea3997.jpg","comment_is_top":false,"comment_ctime":1637587294,"is_pvip":false,"replies":[{"id":"117412","content":"å¹¶æ²¡æœ‰é‡å¤è®¡ç®—çš„æƒ…å†µå“ˆï¼ŒSparkçš„è¿è¡Œæœºåˆ¶æ˜¯Lazy evaluationï¼Œæ‰€ä»¥è¯´ï¼ŒåŠ äº†cacheï¼Œä¸€å®šè¦å…ˆtriggerè®¡ç®—ï¼Œå¦åˆ™åé¢çš„å¤šä¸ªactionï¼Œæ²¡æœ‰åŠæ³•åˆ©ç”¨åˆ°ç¼“å­˜çš„ä¼˜åŠ¿ã€‚å…·ä½“æ¥è¯´ï¼Œæ˜¯åé¢æœ€è¿‘çš„é‚£ä¸ªactionï¼Œæ²¡æ³•åˆ©ç”¨ç¼“å­˜ã€‚<br><br>è€å¼Ÿä¸å¦¨å†å›é¡¾ä¸‹DAGã€å†…å­˜è®¡ç®—é‚£ä¸¤è®²ï¼Œå…³äºå»¶è¿Ÿè®¡ç®—ï¼Œé‚£é‡Œé¢ä»‹ç»çš„æ¯”è¾ƒå¤š","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1043100","ctime":1637986923,"ip_address":"","comment_id":322786,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1637587294","product_id":100073401,"comment_content":"ä¸ºä»€ä¹ˆcacheè¦åœ¨actionç®—å­ä¹‹å,å†å•ç‹¬å¯åŠ¨ä¸€ä¸ªjobç¼“å­˜æ•°æ®,è¿™æ ·ä¸æ˜¯é‡å¤è®¡ç®—äº†å—?å·²ç»è®¡ç®—ä¸€éäº†,ä¸ºä»€ä¹ˆä¸åˆ©ç”¨å‘¢?","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":533823,"discussion_content":"å¹¶æ²¡æœ‰é‡å¤è®¡ç®—çš„æƒ…å†µå“ˆï¼ŒSparkçš„è¿è¡Œæœºåˆ¶æ˜¯Lazy evaluationï¼Œæ‰€ä»¥è¯´ï¼ŒåŠ äº†cacheï¼Œä¸€å®šè¦å…ˆtriggerè®¡ç®—ï¼Œå¦åˆ™åé¢çš„å¤šä¸ªactionï¼Œæ²¡æœ‰åŠæ³•åˆ©ç”¨åˆ°ç¼“å­˜çš„ä¼˜åŠ¿ã€‚å…·ä½“æ¥è¯´ï¼Œæ˜¯åé¢æœ€è¿‘çš„é‚£ä¸ªactionï¼Œæ²¡æ³•åˆ©ç”¨ç¼“å­˜ã€‚\n\nè€å¼Ÿä¸å¦¨å†å›é¡¾ä¸‹DAGã€å†…å­˜è®¡ç®—é‚£ä¸¤è®²ï¼Œå…³äºå»¶è¿Ÿè®¡ç®—ï¼Œé‚£é‡Œé¢ä»‹ç»çš„æ¯”è¾ƒå¤š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637986923,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":313355,"user_name":"Hiway","can_delete":false,"product_type":"c1","uid":1169895,"ip_address":"","ucode":"3E97C70A04018C","user_header":"https://static001.geekbang.org/account/avatar/00/11/d9/e7/45d9e964.jpg","comment_is_top":false,"comment_ctime":1632387185,"is_pvip":false,"replies":[{"id":"113542","content":"æ˜¯çš„ï¼Œæ˜¯è¿™æ ·çš„å“ˆã€‚cacheçš„ç›®çš„æ˜¯å¤ç”¨ï¼Œæ²¡æœ‰actionçš„è¯ï¼Œcacheä¸ä¼šç”Ÿæ•ˆã€‚åªæœ‰é‡åˆ°actionç®—å­ï¼Œcacheæ‰ä¼šè§¦å‘ï¼Œæ‰ä¼šçœŸçš„ç¼“å­˜æ•°æ®åˆ°å†…å­˜æˆ–ç£ç›˜ã€‚countè¿™ç§æ“ä½œï¼Œæ²¡æœ‰å¤šå¤§å¼€é”€çš„ï¼Œç›¸æ¯”ä¸šåŠ¡é€»è¾‘ï¼Œcountå¯ä»¥å¿½ç•¥ä¸è®¡","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1632484700,"ip_address":"","comment_id":313355,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1632387185","product_id":100073401,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ã€‚çœ‹åˆ°ä½ ä¹‹å‰çš„å›ç­”â€œæ˜¯çš„ï¼Œè¦å…ˆç”¨Actionç®—å­æ¥è§¦å‘ç¼“å­˜çš„è®¡ç®—ï¼Œè®©SparkçœŸæ­£æŠŠåˆ†å¸ƒå¼æ•°æ®é›†ç¼“å­˜åˆ°å†…å­˜æˆ–æ˜¯ç£ç›˜ä¸­å»ã€‚â€æˆ‘å¯¹è¿™å¥è¯æœ‰ç‚¹ç–‘æƒ‘ï¼Œè¯·é—®å®é™…å·¥ä½œç¯å¢ƒä½¿ç”¨cacheä¹Ÿæ˜¯è¿™æ ·çš„å—ï¼Ÿcacheå®Œåæ¥ä¸€ä¸ªcountç”¨äºè§¦å‘cacheè®¡ç®—ã€‚ç„¶åå†ç»§ç»­å†™ä¸šåŠ¡é€»è¾‘å—ï¼Ÿ<br>é‚£ä¸æ˜¯é™¤äº†cacheçš„å¼€é”€ï¼Œè¿˜å¤šäº†ä¸€ä¸ªcountè®¡ç®—çš„å¼€é”€","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527324,"discussion_content":"æ˜¯çš„ï¼Œæ˜¯è¿™æ ·çš„å“ˆã€‚cacheçš„ç›®çš„æ˜¯å¤ç”¨ï¼Œæ²¡æœ‰actionçš„è¯ï¼Œcacheä¸ä¼šç”Ÿæ•ˆã€‚åªæœ‰é‡åˆ°actionç®—å­ï¼Œcacheæ‰ä¼šè§¦å‘ï¼Œæ‰ä¼šçœŸçš„ç¼“å­˜æ•°æ®åˆ°å†…å­˜æˆ–ç£ç›˜ã€‚countè¿™ç§æ“ä½œï¼Œæ²¡æœ‰å¤šå¤§å¼€é”€çš„ï¼Œç›¸æ¯”ä¸šåŠ¡é€»è¾‘ï¼Œcountå¯ä»¥å¿½ç•¥ä¸è®¡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632484700,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":306047,"user_name":"wow_xiaodi","can_delete":false,"product_type":"c1","uid":1511712,"ip_address":"","ucode":"B3FB301556A7EA","user_header":"https://static001.geekbang.org/account/avatar/00/17/11/20/9f31c4f4.jpg","comment_is_top":false,"comment_ctime":1628320336,"is_pvip":false,"replies":[{"id":"111330","content":"ä¸€ä¸ªä¸ªæ¥è¯´å“ˆ~<br><br>1. ä¼˜å…ˆå†…å­˜ï¼Œå†…å­˜ä¸è¶³æ”¾ç£ç›˜ï¼Œç£ç›˜æ–‡ä»¶å‰ç¼€æ˜¯broadcast<br><br>2. å¥½é—®é¢˜ï¼Œæˆ‘ä»¬çŸ¥é“ï¼ŒåŒä¸€ä¸ªRDDï¼Œæ˜¯â€œå…”å­ä¸åƒçªè¾¹è‰â€ï¼ŒåŒä¸€ä¸ªRDDå¦‚æœå†…å­˜ä¸è¶³ï¼Œåé¢çš„åˆ†ç‰‡æ˜¯ä¸ä¼šé©±é€å†…å­˜å½“ä¸­åŒä¸€ä¸ªRDDçš„åˆ†ç‰‡çš„ã€‚ä½†å¦‚æœæ˜¯ä¸åŒçš„RDDï¼Œå†…å­˜æ”¾ä¸ä¸‹ï¼Œå°±ä¼šå°è¯•å»é©±èµ¶å…¶ä»–RDDå·²ç»ç¼“å­˜çš„æ•°æ®åˆ†ç‰‡ï¼Œæ¯”è¾ƒé‡è›®<br><br>3. è¿™ä¸ªæ¯”ä¾‹å’±ä»¬å¼€å‘è€…äº‹å…ˆæ˜¯ç®—ä¸å‡ºæ¥çš„ï¼Œä¸è¿‡ï¼Œä½ å€’æ˜¯å¯ä»¥é€šè¿‡Spark UIæ¥çœ‹Storage Tabï¼Œè§‚å¯Ÿæ¯ä¸ªRDDçš„ç¼“å­˜æƒ…å†µï¼Œå®ƒä¼šåˆ—å‡ºï¼Œå¤šå°‘æ•°æ®ç¼“å­˜åˆ°å†…å­˜ï¼Œå¤šå°‘æ•°æ®ç¼“å­˜åˆ°ç£ç›˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1629127803,"ip_address":"","comment_id":306047,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1628320336","product_id":100073401,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼Œæœ‰å‡ ä¸ªé—®é¢˜æƒ³é—®ä¸‹ï¼š<br>(1)å¹¿æ’­å˜é‡é»˜è®¤æ˜¯å­˜å‚¨çº§åˆ«æ˜¯ï¼Ÿå¦‚æœå†…å­˜ä¸è¶³ï¼Œæ˜¯å¦æ˜¯å­˜åˆ°diskä¸­ï¼Ÿ<br>(2)å¯¹äºmemory onlyæ¨¡å¼ï¼Œé‡‡ç”¨lruæ·˜æ±°ç¼“å­˜ã€‚é‚£ä¹ˆå¦‚æœæ˜¯memory and diskæ¨¡å¼ï¼Œæ­¤æ—¶å¦‚æœå†…å­˜ä¸è¶³ï¼Œæ˜¯å¦å…ˆè¿›è¡Œlruæ·˜æ±°å‘¢ï¼Ÿ<br>(3)memory and diskæ–‡ä¸­è¯´åˆ°éƒ¨åˆ†å†…å­˜ï¼Œéƒ¨åˆ†diskï¼Œé‚£ä¹ˆè¿™ä¸ªå­˜å‚¨å æ¯”å¦‚ä½•å»ç¡®å®šå‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524607,"discussion_content":"ä¸€ä¸ªä¸ªæ¥è¯´å“ˆ~\n\n1. ä¼˜å…ˆå†…å­˜ï¼Œå†…å­˜ä¸è¶³æ”¾ç£ç›˜ï¼Œç£ç›˜æ–‡ä»¶å‰ç¼€æ˜¯broadcast\n\n2. å¥½é—®é¢˜ï¼Œæˆ‘ä»¬çŸ¥é“ï¼ŒåŒä¸€ä¸ªRDDï¼Œæ˜¯â€œå…”å­ä¸åƒçªè¾¹è‰â€ï¼ŒåŒä¸€ä¸ªRDDå¦‚æœå†…å­˜ä¸è¶³ï¼Œåé¢çš„åˆ†ç‰‡æ˜¯ä¸ä¼šé©±é€å†…å­˜å½“ä¸­åŒä¸€ä¸ªRDDçš„åˆ†ç‰‡çš„ã€‚ä½†å¦‚æœæ˜¯ä¸åŒçš„RDDï¼Œå†…å­˜æ”¾ä¸ä¸‹ï¼Œå°±ä¼šå°è¯•å»é©±èµ¶å…¶ä»–RDDå·²ç»ç¼“å­˜çš„æ•°æ®åˆ†ç‰‡ï¼Œæ¯”è¾ƒé‡è›®\n\n3. è¿™ä¸ªæ¯”ä¾‹å’±ä»¬å¼€å‘è€…äº‹å…ˆæ˜¯ç®—ä¸å‡ºæ¥çš„ï¼Œä¸è¿‡ï¼Œä½ å€’æ˜¯å¯ä»¥é€šè¿‡Spark UIæ¥çœ‹Storage Tabï¼Œè§‚å¯Ÿæ¯ä¸ªRDDçš„ç¼“å­˜æƒ…å†µï¼Œå®ƒä¼šåˆ—å‡ºï¼Œå¤šå°‘æ•°æ®ç¼“å­˜åˆ°å†…å­˜ï¼Œå¤šå°‘æ•°æ®ç¼“å­˜åˆ°ç£ç›˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629127803,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1549032,"avatar":"","nickname":"Zzz","note":"","ucode":"9323254354868B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":395963,"discussion_content":"åº”è¯¥æ˜¯ç›´æ¥ä¸¢å¼ƒå’Œå­˜å…¥ç£ç›˜çš„åŒºåˆ«ï¼Œlruçš„æœºæ™ºéƒ½ä¸€æ ·ï¼Œå…·ä½“å¯ä»¥çœ‹ä¸‹æºç ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632369176,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":301543,"user_name":"é˜³å°","can_delete":false,"product_type":"c1","uid":2340596,"ip_address":"","ucode":"CD76C0917139AF","user_header":"","comment_is_top":false,"comment_ctime":1625733301,"is_pvip":false,"replies":[{"id":"109184","content":"å¥½é—®é¢˜ï¼Œ3ä¸ªåœŸè±†ï¼ˆæ›´å‡†ç¡®åœ°è¯´ï¼Œæ˜¯å¤šä¸ªï¼Œä¸‰ä¸ªéº»è¢‹é‡Œé¢çš„æ‰€æœ‰åœŸè±†ï¼‰ä¸€èµ·ï¼Œæ„æˆä¸€ä¸ªRDDå“ˆ~ RDDæ˜¯æ•°æ®â€œæŠ½è±¡â€ï¼Œå®ƒæ˜¯ç”¨æ¥â€œå›Šæ‹¬â€åˆ†å¸ƒå¼æ•°æ®é›†çš„ï¼Œåˆ†å¸ƒå¼æ•°æ®é›†ç”±æ•°æ®åˆ†ç‰‡&#47;åˆ†åŒºæ„æˆï¼ŒåœŸè±†å·¥åŠé‡Œé¢çš„æ¯ä¸€ä¸ªåœŸè±†ï¼Œéƒ½æ˜¯ä¸€ä¸ªRDDæ•°æ®åˆ†ç‰‡ï¼Œä¸æ˜¯RDDæœ¬èº«ï¼Œä»–ä»¬å‡‘åœ¨ä¸€èµ·ï¼Œå¤Ÿäº†ä¸€ä¸ªRDDã€‚<br><br>RDDæ˜¯æŠ½è±¡çš„æ¦‚å¿µï¼Œè€Œæ•°æ®åˆ†ç‰‡æ˜¯å®ä½“ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1625802161,"ip_address":"","comment_id":301543,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1625733301","product_id":100073401,"comment_content":"è¯·é—®ä¸€ä¸‹è€å¸ˆï¼Œä»€ä¹ˆæ˜¯åŒå±ä¸€ä¸ªRddæ•°æ®ï¼Ÿç¬¬ä¸€èŠ‚é‡Œé¢çš„ä¸€ä¸ªåœŸè±†æ˜¯ä¸€ä¸ªrddæ•°æ®ï¼Œè¿˜æ˜¯ä¸‰ä¸ªåœŸè±†åœ¨ä¸€èµ·è¢«ç§°ä¸ºä¸€ä¸ªrddæ•°æ®","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523024,"discussion_content":"å¥½é—®é¢˜ï¼Œ3ä¸ªåœŸè±†ï¼ˆæ›´å‡†ç¡®åœ°è¯´ï¼Œæ˜¯å¤šä¸ªï¼Œä¸‰ä¸ªéº»è¢‹é‡Œé¢çš„æ‰€æœ‰åœŸè±†ï¼‰ä¸€èµ·ï¼Œæ„æˆä¸€ä¸ªRDDå“ˆ~ RDDæ˜¯æ•°æ®â€œæŠ½è±¡â€ï¼Œå®ƒæ˜¯ç”¨æ¥â€œå›Šæ‹¬â€åˆ†å¸ƒå¼æ•°æ®é›†çš„ï¼Œåˆ†å¸ƒå¼æ•°æ®é›†ç”±æ•°æ®åˆ†ç‰‡/åˆ†åŒºæ„æˆï¼ŒåœŸè±†å·¥åŠé‡Œé¢çš„æ¯ä¸€ä¸ªåœŸè±†ï¼Œéƒ½æ˜¯ä¸€ä¸ªRDDæ•°æ®åˆ†ç‰‡ï¼Œä¸æ˜¯RDDæœ¬èº«ï¼Œä»–ä»¬å‡‘åœ¨ä¸€èµ·ï¼Œå¤Ÿäº†ä¸€ä¸ªRDDã€‚\n\nRDDæ˜¯æŠ½è±¡çš„æ¦‚å¿µï¼Œè€Œæ•°æ®åˆ†ç‰‡æ˜¯å®ä½“ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625802161,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1811813,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a5/65/898bc6c5.jpg","nickname":"wayne","note":"","ucode":"988E1F2F0B419A","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543866,"discussion_content":"è€å¸ˆ spark.sql(sql_query).cache().createorreplacetempview()è¿™ç§æ–¹å¼ä¹Ÿéœ€è¦actionç®—å­è§¦å‘å—ï¼Ÿ\nè¿™ç§æ–¹å¼ä¹Ÿéµå¾ªæ‚¨è¯´çš„cache missè§„åˆ™å—ï¼Ÿ\næ€ä¹ˆä½¿ç”¨æ¯”è¾ƒå¥½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641334415,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}