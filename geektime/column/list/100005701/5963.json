{"id":5963,"title":"第12讲 | 深入区块链技术（四）：PoW共识","content":"<p>上一篇文章中，我们谈到了区块链其实就是一种分布式系统，它在技术上并没有跳出分布式系统的理论框架，只是给出了一种不同于计算科学领域的解决方案。今天，我们就来重点聊聊区块链的这种解决方案： PoW 共识机制。</p>\n<h2 id=\"pow-\">PoW工作量证明</h2>\n<p>因为比特币\b采用了PoW共识机制，所以这个概念才得以被广泛传播。PoW全称Proof of Work，中文名是工作量证明，PoW共识机制其实是一种设计思路，而不是一种具体的实现。</p>\n<p>PoW机制其实早在1997年就被提出了，它早期多被应用在抵抗滥用软件服务的场景中，例如抵抗垃圾邮件（所以PoW\b在邮件服务系统会有所涉及）。</p>\n<p>我们借用维基百科的一张图来解释一下PoW机制是如何用在这个场景中的。</p>\n<p>为了防止垃圾消息泛滥，接收者并不直接接受来自任意发送者的消息，所以在一次有效的会话中，发送者需要计算一个按照规则约定难题的答案，发送给接受者的同时，需要附带验证这个答案，如果这个答案被验证有效，那么接受者才会接受这个消息。</p>\n<p><img src=\"https://static001.geekbang.org/resource/image/c5/82/c5ddd1f74c990471750a8db6ad177182.png?wh=960*268\" alt=\"\"></p>\n<p>可以看出PoW的核心设计思路是提出一个计算难题，但是这个难题答案的验证过程是非常容易的，这种特性我们称之为计算不对称特性，我们在“浅谈区块链共识机制”中举的24点游戏的例子就具备了\b计算不对称特性。</p>\n<h2 id=\"-pow\">如何理解区块链PoW</h2>\n<p>上面介绍了一般的PoW是什么，那么区块链上的PoW又是如何设计的呢，我们还是以比特币为例子来讲一讲，这个部分会有代码演示，如果你在收听音频，可以点击文稿查看。</p>\n<p>在分析拜占庭将军问题的时候可以看出，如果所有节点在同一时刻发起提案，那么这个系统的\b记账过程将会非常的复杂混乱，为了\b降低具有\b提案权的节点数量，采用工作量证明不失为一个好办法。</p>\n<p>所以我们需要构造一个计算不对称的难题，这个难题在比特币中被选定为\b以SHA256算法计算一个目标哈希，使得这个哈希值符合前N位全是0。</p>\n<p>\b举个例子，假设我们给定一个字符串“geekbang”，我们提出的难题是，计算一个数字，与给定的字符串连接起来，使这个字符串的SHA256计算结果的前4位是0，这个数字我们称作nonce，\b比如字符串&quot;geekbang1234&quot;，nonce就是1234，我们要找到符合条件的nonce。</p>\n<p>我们以Python代码作为示例。</p>\n<pre><code>\n#!/usr/bin/env python\nimport hashlib\n\ndef main():\n    base_string = &quot;geekbang&quot;\n    nonce = 10000\n    count = 0\n    while True:\n        target_string = base_string + str(nonce)\n        pow_hash = hashlib.sha256(target_string).hexdigest()\n        count = count + 1\n        if pow_hash.startswith(&quot;0000&quot;):\n            print pow_hash\n            print &quot;nonce: %s  scan times: %s&quot; % (nonce, count)\n            break\n        nonce = nonce + 1\n\nif __name__ == &#39;__main__&#39;:\n    main()\n</code></pre><p> 代码中，我规定了基础字符串是&quot;geekbang&quot;，nonce从10000开始自增往上搜索，直到找到符合条件的nonce值。</p>\n<p>我们计算的结果放在图中，你可以点击查看。</p>\n<pre><code># 前4位是0\n0000250248f805c558bc28864a6bb6bf0c244d836a6b1a0c5078987aa219a404\nnonce: 68828  scan times: 58829\n# 前5位是0\n0000067fc247325064f685c32f8a079584b19106c5228b533f10c775638d454c\nnonce: 1241205  scan times: 1231206\n# 前7位是0\n00000003f41b126ec689b1a2da9e7d46d13d0fd1bece47983d53c5d32eb4ac90\nnonce: 165744821  scan times: 165734822\n</code></pre><p>可以看出，每次要求哈希结果的前N位多一个0，计算次数就多了很多倍，当要求前7位都是0时，计算次数达到了1.6亿次。这里我同时截图了操作系统当时CPU的负载，可以看到单核CPU负载长时间达到100%。</p>\n<p><img src=\"https://static001.geekbang.org/resource/image/6c/b5/6c4b21deef14e84091e477ac1ff6b3b5.png?wh=1462*444\" alt=\"\"></p>\n<p>通过上述程序，希望你对区块链PoW机制有个直观的了解。\b由于结果只能暴力搜索，而且搜索空间非常巨大，作弊几乎不可能，另外符合条件的nonce值也是均匀分布在整个空间中的，所以哈希是一个非常公平且粗暴的算法。</p>\n<p>以上代码的基本逻辑就是PoW挖矿过程，搜索到一个目标值就会获得记账权，\b距离上一次打包到现在未确认的交易，矿工就可以一次性将未确认的交易打包并广播了，并从Coinbase获得奖励。</p>\n<p>\b实际挖矿的基本步骤如下。</p>\n<ol>\n<li>生成Coinbase交易，并与其他所有准备打包进区块的交易组成交易列表，\b并生成默克尔哈希；</li>\n<li>把\b默克尔哈希及其他相关字段组装成区块头，将区块头（Block Header）作为工作量证明的输入，区块头中包含了前一区块的哈希，区块头一共80字节数据；</li>\n<li>不停地变更区块头中的随机数即nonce的数值，也就是暴力搜索，并对每次变更后的的区块头做双重SHA256运算，即SHA256(SHA256(Block_Header))），将结果值与当前网络的目标值做对比，如果小于目标值，则解题成功，工作量证明完成。</li>\n</ol>\n<p>如果更深程度去理解的话，PoW机制是将现实世界的物理资源转化成区块链上虚拟资源的过程，这种转化为区块链提供了可信的前提。</p>\n<!-- [[[read_end]]] -->\n<h2 id=\"pow-\">PoW挖矿的发展历程</h2>\n<p>好了，现在我们知道了，PoW的过程其实就是计算一个难题解的过程。</p>\n<p>在区块链的发展史上，PoW经历了大致两个阶段。分为早期\b分散挖矿阶段和中心化矿池挖矿阶段。我们目前处于第二个阶段，并且将会长期处于这个阶段。</p>\n<p>早期分散挖矿是中本聪的愿景，期望是1CPU=1票，所以如果CPU挖矿，那么将会是非常理想化的情况，而现实的情况是，SHA256只需要非常简单的重复计算逻辑，它不需要复杂的逻辑控制。</p>\n<p>那么CPU\b这种重控制逻辑，轻重复计算的计算单元来搞这么低端的暴力计算非常吃力不讨好，大部分人的第一反应肯定是用GPU呀，\b非常正确。</p>\n<p>所以这个时期，出现了GPU挖矿，它的效率是CPU的十几甚至上百倍，那么1CPU=1票的逻辑就被打破了，挖矿工具的改\b变让人们意识到挖矿技术也是极大改进的。除了GPU挖矿，我们还有ASIC芯片挖矿，这部分内容我们在讨论挖矿算法分类时会详细讲解。</p>\n<p>同期我们也慢慢进入到了中心化挖矿阶段。中心化挖矿很好理解，算力如果越分散，也就意味着竞争越激烈，如果某个节点计算出答案了，那么\b也意味着其他矿工这段时间的工作量几乎都白费了，\b投入了物理资源结果零收益，可以说是负收益。</p>\n<p>那怎么办呢？思路就是把分散的算力汇聚到一个池子里面，这个池子我们称作矿池，就像四面八方的小溪流最终汇总成一条大江一样。</p>\n<p>矿工参与到某个矿池，相当于矿工把算力租给矿池了，与其他矿工联合挖矿，最后看起来矿池这个节点的算力就会很大，获得记账权的概率就越大，如果这个矿池计算出了答案，将获得Coinbase的奖励，\b矿池就会按既定的分配比例打给每一位参与的矿工。</p>\n<p>我们借用一下《精通比特币》一书中的部分图来看一下：</p>\n<p><img src=\"https://static001.geekbang.org/resource/image/39/3e/391f50f6f720912df35cebd501efd43e.png?wh=826*474\" alt=\"\"></p>\n<p>矿池作为一个中心节点，可以被矿工连接，而在比特币全网来看，矿池节点本质上也只是一个全节点，它与其他全节点一起组成了\b比特币的点对点网络，特殊的地方仅仅在于它可以产生新的区块。</p>\n<h2 id=\"pow-\">PoW挖矿算法分类与简介</h2>\n<p>PoW挖矿算法大致分为两个大类，第一类叫做\b计算困难，第二类叫内存困难。</p>\n<p>这两类的区别在于对于提供工作量证明的组件要求不同。我们知道计算机的组成分为计算单元和存储单元，通过以往的编程经验我们还可以知道，一个计算机的瓶颈往往是IO，如果要制造大量的IO操作，可以通过写程序撑大内存，制造大量的数据处理过程，使\b工作量证明从计算单元转变为存储单元。</p>\n<p>那为什么要这么做呢？</p>\n<p>其实在PoW挖矿中心化以后，又出现了一次挖矿工具改进，这次超越了GPU，人们先是尝试在FPGA上尝试SHA256的计算过程，结果计算效率成倍于GPU。</p>\n<p>FPGA出现的时间比较短暂，最终人们开发出了ASIC专业芯片来计算SHA256，这就是我们常说的专业矿机。</p>\n<p>专业矿机的出现加速了PoW挖矿的中心化过程，因为购买专业矿机需要额外的时间和精力，配置运行还有一定的门槛，普通人也只能从专业机构手里购买专业矿机。</p>\n<p>所以这些专业矿机直接就是数字货币印钞机，生产专业挖矿芯片的商业公司几乎成了数字货币的货币发行司，这不得不说到市值直逼英伟达的比特大陆公司，它用的就是专业生产数字货币挖矿芯片。</p>\n<p>新的数字货币开发者们为了防止情况重演，不断发明新的挖矿算法。有名的有Scrypt、X11、SHA-3，不过这些依然是计算困难型的挖矿算法，依然没有逃脱出现专业矿机的命运。</p>\n<p>这里不得不提到以太坊的PoW挖矿算法：ETHASH，ETHASH是Dagger-Hashimoto的修改版本，它是典型的内存困难型挖矿算法。直到如今，也没有芯片厂商设计出挖矿芯片。</p>\n<p>正如我们上文所说，因为工作量证明要求的组件从计算资源转变为内存资源，而对内存的高要求使得矿工必须加内存。</p>\n<p>在专业矿机上加一块内存的收益\b与在GPU上加一块内存获得的收益是差不多的，所以厂商并没有研发内存困难型专业矿机的动力，没有专业矿机的出现，这从某种程度上也缓解了算力中心化的问题。</p>\n<h2 id=\"pow-\">PoW的优势和劣势</h2>\n<p>PoW共识的内在优势在于可以稳定币价，因为在PoW币种下，矿工的纯收益来自Coinbase奖励减去设备和运营成本，成本会驱使矿工至少将币价维持在一个稳定水平，所以攻击者很难在短时间内获得大量算力来攻击主链。</p>\n<p>PoW共识的外在优势是目前\b它看起来依然是工业成熟度最高的区块共识算法，所以在用户信任度上、矿工基础上都有很好的受众。</p>\n<p>PoW共识最大的缺点是非常消耗计算资源，耗电耗能源，这一点也一直为人们所诟病。因为每次产生新的区块都会让相当一部分工作量证明白白浪费了，也就是将计算资源浪费了。</p>\n<p>目前来看这个是无解的，只要是PoW共识，一定会遇到计算资源浪费的问题。不过人们也想了一些改进方案，早期如素数币，近期有比原币，它们都号称深度学习友好型的工作量证明方法。</p>\n<p>从理论上来看，PoW会一直有51%算力攻击的问题，即攻击者只需要购买超过全网51%算力设备，即可发起“双花攻击”，甚至“重放攻击”等多种高收益攻击，这个问题目前没有解决方案。</p>\n<p>除了51%攻击，PoW共识还有自私挖矿的问题，自私挖矿是一种特殊的攻击类型，不会影响区块链正常运转，但是会形成矿霸，间接造成51%攻击，我们就曾经遇到过这样的自私挖矿攻击。</p>\n<p>PoW共识机制是一种简单粗暴的共识算法，它不要求高质量的P2P网络资源，它可以为公链提供稳定有效的记账者筛选机制。同时它也面临了挖矿中心化严重的问题，这也促使人们研究出了新的共识机制，我们留到下一篇讲解。</p>\n<h2 id=\"-\">总结</h2>\n<p>今天我介绍了PoW工作量证明，并且使用Python语言演示了一遍基于SHA256的挖矿算法工作过程，又介绍了发展历程和算法分类，最后提到了PoW的优势和缺陷。相信你对PoW机制的理解可以更加深入了。</p>\n<p>PoW工作量证明的挖矿过程是否可以替换成有意义的算法呢，历史上是否有过类似创新？你可以调查一下，我们一起分享。</p>\n<p></p>\n","comments":[{"had_liked":false,"id":6107,"user_name":"熊猫","can_delete":false,"product_type":"c1","uid":1074792,"ip_address":"","ucode":"51A1833A26B8F8","user_header":"https://static001.geekbang.org/account/avatar/00/10/66/68/812ffbac.jpg","comment_is_top":false,"comment_ctime":1524386354,"is_pvip":false,"replies":[{"id":"1734","content":"全节点是一个独立节点，可以自己验证交易并且可以挖矿的节点。<br>自私挖矿是指矿工先通过较大算力积累优势，挖出多的块的同时不广播，等别人广播一个新区块的时候，自己一下广播2个甚至更多区块，让别人一直处于被分分叉的状态，自己成为矿霸，可以形成100%出块率。<br>双花攻击就是指一个币可以花费两次，属于数据库一致性问题。<br>重放攻击与传统it的重放不同，是指硬分叉的两条链的交易都是合法的，可以在a生成交易后去b上去花费。","user_name":"作者回复","comment_id":6107,"uid":"1075874","ip_address":"","utype":1,"ctime":1524487017,"user_name_real":"betachen"}],"discussion_count":1,"race_medal":0,"score":"100308634162","product_id":100005701,"comment_content":"自私挖，全节点，双花攻击和重放攻击能分别讲解是什么意思吗？","like_count":24,"discussions":[{"author":{"id":1075874,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Tm6wv99GcGd6n5qLQHNRzdL7w3yBEWPKQkQy5otblQTrh0P6OV1nlMd1FKm5YSCBCXVKtT2GdFaJZxRw7VvvUQ/132","nickname":"陈浩","note":"","ucode":"F906AED9E2AC2F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":416960,"discussion_content":"全节点是一个独立节点，可以自己验证交易并且可以挖矿的节点。\n自私挖矿是指矿工先通过较大算力积累优势，挖出多的块的同时不广播，等别人广播一个新区块的时候，自己一下广播2个甚至更多区块，让别人一直处于被分分叉的状态，自己成为矿霸，可以形成100%出块率。\n双花攻击就是指一个币可以花费两次，属于数据库一致性问题。\n重放攻击与传统it的重放不同，是指硬分叉的两条链的交易都是合法的，可以在a生成交易后去b上去花费。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1524487017,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":6051,"user_name":"朱显杰","can_delete":false,"product_type":"c1","uid":1072683,"ip_address":"","ucode":"F7B8258B941D9D","user_header":"https://static001.geekbang.org/account/avatar/00/10/5e/2b/df3983e2.jpg","comment_is_top":false,"comment_ctime":1524302904,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18704172088","product_id":100005701,"comment_content":"PoS和DPoS就是对pow不环保的改进，不过也带来了新的问题，所以不可能三角还是有一定道理的","like_count":4},{"had_liked":false,"id":17391,"user_name":"sunshuai","can_delete":false,"product_type":"c1","uid":1187604,"ip_address":"","ucode":"46F4F5C00FD990","user_header":"https://static001.geekbang.org/account/avatar/00/12/1f/14/2c0a2cc7.jpg","comment_is_top":false,"comment_ctime":1532609619,"is_pvip":false,"replies":[{"id":"9306","content":"是的，但效率提升只有两倍，很明显不像其他ASIC提升千倍以上。所以谈不上威胁，毕竟内存困难型的还是吃内存的。","user_name":"作者回复","comment_id":17391,"uid":"1075874","ip_address":"","utype":1,"ctime":1537373910,"user_name_real":"betachen"}],"discussion_count":1,"race_medal":0,"score":"14417511507","product_id":100005701,"comment_content":"老师   现在是不是出了一个ant e3型号的asic矿机是针对ethash的","like_count":3,"discussions":[{"author":{"id":1075874,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Tm6wv99GcGd6n5qLQHNRzdL7w3yBEWPKQkQy5otblQTrh0P6OV1nlMd1FKm5YSCBCXVKtT2GdFaJZxRw7VvvUQ/132","nickname":"陈浩","note":"","ucode":"F906AED9E2AC2F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":421137,"discussion_content":"是的，但效率提升只有两倍，很明显不像其他ASIC提升千倍以上。所以谈不上威胁，毕竟内存困难型的还是吃内存的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537373910,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":6001,"user_name":"沃野阡陌","can_delete":false,"product_type":"c1","uid":1078723,"ip_address":"","ucode":"F506FED18BB5B2","user_header":"https://static001.geekbang.org/account/avatar/00/10/75/c3/deae021f.jpg","comment_is_top":false,"comment_ctime":1524254701,"is_pvip":false,"replies":[{"id":"1735","content":"系统奖励给挖出块矿工的交易类型","user_name":"作者回复","comment_id":6001,"uid":"1075874","ip_address":"","utype":1,"ctime":1524487106,"user_name_real":"betachen"}],"discussion_count":1,"race_medal":0,"score":"14409156589","product_id":100005701,"comment_content":"什麽是coinbase奖励？","like_count":3,"discussions":[{"author":{"id":1075874,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Tm6wv99GcGd6n5qLQHNRzdL7w3yBEWPKQkQy5otblQTrh0P6OV1nlMd1FKm5YSCBCXVKtT2GdFaJZxRw7VvvUQ/132","nickname":"陈浩","note":"","ucode":"F906AED9E2AC2F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":416924,"discussion_content":"系统奖励给挖出块矿工的交易类型","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1524487106,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":171957,"user_name":"杨家荣","can_delete":false,"product_type":"c1","uid":1259241,"ip_address":"","ucode":"3DA65396C7F002","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/g1icQRbcv1QvJ5U8Cqk0ZqMH5PcMTXcZ8TpS5utE4SUzHcnJA3FYGelHykpzTfDh55ehE8JO9Zg9VGSJW7Wxibxw/132","comment_is_top":false,"comment_ctime":1579057961,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5874025257","product_id":100005701,"comment_content":"极客时间第二期<br>21天打卡行动 9&#47;21<br>&lt;&lt;深入浅出区块链11&gt;&gt;共识算法与分布式一致性算法<br>回答老师问题<br>PoW 工作量证明的挖矿过程是否可以替换成有意义的算法呢，历史上是否有过类似创新?<br>我想到的是POS权益证明机制;<br>POS是否会取代POW，好的算法机制需要时间和市场的验证，没有哪个机制会一直适用于社会发展，一定时期内可能会存在一个当时最好的算法机制。<br>当随着时间的推移社会的进步技术的成熟，必定会有一个更好的算法机制出现，这是事物发展的必然过程。就像电力的早期发明者没有尝试发明太阳能技术或地热能源。但随着时间的发展，事情总会发展到这个阶段。<br>[来源:https:&#47;&#47;baijiahao.baidu.com&#47;s?id=1631392991136867009&amp;wfr=spider&amp;for=pc]<br>今日所学:<br>1,因为比特币\b采用了 PoW 共识机制，所以这个概念才得以被广泛传播。PoW 全称 Proof of Work，中文名是工作量证明，PoW 共识机制其实是一种设计思路，而不是一种具体的实现。<br>2,挖矿的基本步骤:<br>生成 Coinbase 交易，并与其他所有准备打包进区块的交易组成交易列表，\b并生成默克尔哈希；<br>把\b默克尔哈希及其他相关字段组装成区块头，将区块头（Block Header）作为工作量证明的输入，区块头中包含了前一区块的哈希，区块头一共 80 字节数据；<br>不停地变更区块头中的随机数即 nonce 的数值，也就是暴力搜索，并对每次变更后的的区块头做双重 SHA256 运算，即 SHA256(SHA256(Block_Header))），将结果值与当前网络的目标值做对比，如果小于目标值，则解题成功，工作量证明完成;<br>3,PoW 挖矿算法大致分为两个大类，第一类叫做\b计算困难，第二类叫内存困难。<br>4,PoW 的优势和劣势:<br>PoW 共识的内在优势在于可以稳定币价，因为在 PoW 币种下，矿工的纯收益来自 Coinbase 奖励减去设备和运营成本，成本会驱使矿工至少将币价维持在一个稳定水平，所以攻击者很难在短时间内获得大量算力来攻击主链。<br>PoW 共识的外在优势是目前\b它看起来依然是工业成熟度最高的区块共识算法，所以在用户信任度上、矿工基础上都有很好的受众。<br>PoW 共识最大的缺点是非常消耗计算资源，耗电耗能源，这一点也一直为人们所诟病。因为每次产生新的区块都会让相当一部分工作量证明白白浪费了，也就是将计算资源浪费了<br>5,PoW 共识机制是一种简单粗暴的共识算法，它不要求高质量的 P2P 网络资源，它可以为公链提供稳定有效的记账者筛选机制。同时它也面临了挖矿中心化严重的问题，这也促使人们研究出了新的共识机制，","like_count":1},{"had_liked":false,"id":160077,"user_name":"小老鼠","can_delete":false,"product_type":"c1","uid":1257460,"ip_address":"","ucode":"C663A0C863A515","user_header":"https://static001.geekbang.org/account/avatar/00/13/2f/f4/2dede51a.jpg","comment_is_top":false,"comment_ctime":1575864578,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5870831874","product_id":100005701,"comment_content":"51%是如何算出来的，比特币出现分支的概率有多大？","like_count":1},{"had_liked":false,"id":121050,"user_name":"sunny","can_delete":false,"product_type":"c1","uid":1094714,"ip_address":"","ucode":"1F8F1A30B26BD2","user_header":"https://static001.geekbang.org/account/avatar/00/10/b4/3a/02ea71fa.jpg","comment_is_top":false,"comment_ctime":1565053046,"is_pvip":false,"replies":[{"id":"49948","content":"这个要看哪种共识算法，如果是代理式中心化记账的，矿工也是有内部账本的，通常就是传统数据库记一下，这个在比特币矿池非常常见。","user_name":"作者回复","comment_id":121050,"uid":"1075874","ip_address":"","utype":1,"ctime":1567786425,"user_name_real":"betachen"}],"discussion_count":1,"race_medal":0,"score":"5860020342","product_id":100005701,"comment_content":"矿池进行计算挖矿，那最终的账簿记账就是由矿池这个中心节点记账，那么矿池内的矿工还会进行记账吗，矿工还会有自己的账簿吗","like_count":1,"discussions":[{"author":{"id":1075874,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Tm6wv99GcGd6n5qLQHNRzdL7w3yBEWPKQkQy5otblQTrh0P6OV1nlMd1FKm5YSCBCXVKtT2GdFaJZxRw7VvvUQ/132","nickname":"陈浩","note":"","ucode":"F906AED9E2AC2F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461595,"discussion_content":"这个要看哪种共识算法，如果是代理式中心化记账的，矿工也是有内部账本的，通常就是传统数据库记一下，这个在比特币矿池非常常见。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567786425,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":304930,"user_name":"山哥","can_delete":false,"product_type":"c1","uid":1172679,"ip_address":"","ucode":"7C8585B021CAC4","user_header":"https://static001.geekbang.org/account/avatar/00/11/e4/c7/7f8be879.jpg","comment_is_top":false,"comment_ctime":1627706013,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627706013","product_id":100005701,"comment_content":"老师的表达能力还要在简洁下。<br><br><br>\b举个例子，假设我们给定一个字符串“geekbang”，我们提出的难题是，计算一个数字，与给定的字符串连接起来，使这个字符串的 SHA256 计算结果的前 4 位是 0，这个数字我们称作 nonce，\b比如字符串 &quot;geekbang1234&quot;，nonce 就是 1234，我们要找到符合条件的 nonce。<br><br><br>这段文字写的很拗口。。。py代码简单明了。","like_count":1},{"had_liked":false,"id":279080,"user_name":"A君","can_delete":false,"product_type":"c1","uid":1940105,"ip_address":"","ucode":"FE96F089C2312C","user_header":"https://static001.geekbang.org/account/avatar/00/1d/9a/89/babe8b52.jpg","comment_is_top":false,"comment_ctime":1613611535,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1613611535","product_id":100005701,"comment_content":"pow，通过遍历区块头中nonce，直到找到对区块头双重sha后得到比目标值还小的哈希值，即认为解题成功，具有记账权。pow是计算型问题，提高算力就能提高记账概率，要达到控制记账权的目的，需要拥有超过全网51%的算力，这个算力成本极大，但在现在算力集中化的环境下，如果多个矿池联合起来是可以超过这个门槛的，这怎么破？","like_count":0},{"had_liked":false,"id":161216,"user_name":"Jeff","can_delete":false,"product_type":"c1","uid":1344632,"ip_address":"","ucode":"3E22C18FF4986F","user_header":"https://static001.geekbang.org/account/avatar/00/14/84/78/c246f6d5.jpg","comment_is_top":false,"comment_ctime":1576150027,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576150027","product_id":100005701,"comment_content":"这一节单独剖析PoW还是不错的。这个过程需要多理解，我也在反复看，希望老师有一套Java的demo供参考。","like_count":0},{"had_liked":false,"id":29479,"user_name":"八神","can_delete":false,"product_type":"c1","uid":1253946,"ip_address":"","ucode":"3A7A111743012F","user_header":"https://static001.geekbang.org/account/avatar/00/13/22/3a/23453336.jpg","comment_is_top":false,"comment_ctime":1538389350,"is_pvip":false,"replies":[{"id":"12028","content":"你好，并不是用收款方的公钥加密，而是使用收款方公钥的哈希作为地址，通过构造一个交易脚本，使得收款方能辨别并且必须出具签名才能操作。交易都是公开的，所有人都可以验证。具体:发送者通过地址构造一个ScriptPubKey的“锁”，收款方必须构造一个ScriptSig的“钥匙”，才能花费这些币。","user_name":"作者回复","comment_id":29479,"uid":"1075874","ip_address":"","utype":1,"ctime":1539777370,"user_name_real":"betachen"}],"discussion_count":1,"race_medal":0,"score":"1538389350","product_id":100005701,"comment_content":"交易是用收款方的公钥加密的，除了收款方可以查看，别人无法看，校验这笔交易的人该如何校验呢？必须是收款方才能校验吗？","like_count":1,"discussions":[{"author":{"id":1075874,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Tm6wv99GcGd6n5qLQHNRzdL7w3yBEWPKQkQy5otblQTrh0P6OV1nlMd1FKm5YSCBCXVKtT2GdFaJZxRw7VvvUQ/132","nickname":"陈浩","note":"","ucode":"F906AED9E2AC2F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425632,"discussion_content":"你好，并不是用收款方的公钥加密，而是使用收款方公钥的哈希作为地址，通过构造一个交易脚本，使得收款方能辨别并且必须出具签名才能操作。交易都是公开的，所有人都可以验证。具体:发送者通过地址构造一个ScriptPubKey的“锁”，收款方必须构造一个ScriptSig的“钥匙”，才能花费这些币。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539777370,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27756,"user_name":"Calios","can_delete":false,"product_type":"c1","uid":1004758,"ip_address":"","ucode":"B1AA60164DC42A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/d6/124e2e93.jpg","comment_is_top":false,"comment_ctime":1537936800,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1537936800","product_id":100005701,"comment_content":"python代码示例在iPhone上看不到，有其他同学有这个问题么？","like_count":0},{"had_liked":false,"id":13214,"user_name":"锐","can_delete":false,"product_type":"c1","uid":1110915,"ip_address":"","ucode":"A245BA96C9471F","user_header":"https://static001.geekbang.org/account/avatar/00/10/f3/83/e2612d81.jpg","comment_is_top":false,"comment_ctime":1529456159,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1529456159","product_id":100005701,"comment_content":"自私挖矿是个什么概念？老师解释一下呢","like_count":0},{"had_liked":false,"id":6767,"user_name":"skevy","can_delete":false,"product_type":"c1","uid":1070966,"ip_address":"","ucode":"14896A0C3E4BEA","user_header":"https://static001.geekbang.org/account/avatar/00/10/57/76/6f10ba8e.jpg","comment_is_top":false,"comment_ctime":1524923673,"is_pvip":false,"replies":[{"id":"2308","content":"这个由挖矿算法的细节决定的，一般是变化的，通过历史记录计算出来的，例如以太的DAG生成。","user_name":"作者回复","comment_id":6767,"uid":"1075874","ip_address":"","utype":1,"ctime":1525832051,"user_name_real":"betachen"}],"discussion_count":1,"race_medal":0,"score":"1524923673","product_id":100005701,"comment_content":"举个例子，假设我们给定一个字符串“geekbang”，我们提出的难题是，计算一个数字，与给定的字符串连接起来，使这个字符串的 SHA256 计算结果的前 4 位是 0，这个数字我们称作 nonce，比如字符串 &quot;geekbang1234&quot;，nonce 就是 1234，我们要找到符合条件的 nonce。<br><br>老师请问下上边这一段中，给定的字符串geekbang，会随时变化吗？还是固定的<br>","like_count":0,"discussions":[{"author":{"id":1075874,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Tm6wv99GcGd6n5qLQHNRzdL7w3yBEWPKQkQy5otblQTrh0P6OV1nlMd1FKm5YSCBCXVKtT2GdFaJZxRw7VvvUQ/132","nickname":"陈浩","note":"","ucode":"F906AED9E2AC2F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":417133,"discussion_content":"这个由挖矿算法的细节决定的，一般是变化的，通过历史记录计算出来的，例如以太的DAG生成。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1525832051,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":6705,"user_name":"塞翁","can_delete":false,"product_type":"c1","uid":1070126,"ip_address":"","ucode":"E05FAEC653FEA3","user_header":"","comment_is_top":false,"comment_ctime":1524907512,"is_pvip":false,"replies":[{"id":"1944","content":"不存在完整性这一说的，有就有，没有就不会被打包了，完全取决于记账节点与你的网络是否可以路由通，如果不通说明网络分叉了。<br>也就是纯粹的先来后到，一起打包。","user_name":"作者回复","comment_id":6705,"uid":"1075874","ip_address":"","utype":1,"ctime":1525092558,"user_name_real":"betachen"}],"discussion_count":2,"race_medal":0,"score":"1524907512","product_id":100005701,"comment_content":"生成 Coinbase 交易，并与其他所有准备打包进区块的交易组成交易列表，\b并生成默克尔哈希；<br><br>这段中，怎么保证收到的交易列表的完整性，如果漏收交易，所有运算都白费了？或者说，这个交易列表完整性是怎么判断的？纯粹按照时间？","like_count":0,"discussions":[{"author":{"id":1075874,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Tm6wv99GcGd6n5qLQHNRzdL7w3yBEWPKQkQy5otblQTrh0P6OV1nlMd1FKm5YSCBCXVKtT2GdFaJZxRw7VvvUQ/132","nickname":"陈浩","note":"","ucode":"F906AED9E2AC2F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":417130,"discussion_content":"不存在完整性这一说的，有就有，没有就不会被打包了，完全取决于记账节点与你的网络是否可以路由通，如果不通说明网络分叉了。\n也就是纯粹的先来后到，一起打包。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1525092558,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1531348,"avatar":"https://static001.geekbang.org/account/avatar/00/17/5d/d4/e5ea1c25.jpg","nickname":"sun留白","note":"","ucode":"53FEEA5E244C9A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":171795,"discussion_content":"会不会存在两笔交易都是对同一个账户转出，且呗放在同一个包中，那么这个包是成功还是不成功，是剔除第二笔交易吗？请问这个细节是如何处理的？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581748219,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":6171,"user_name":"ylshuibugou","can_delete":false,"product_type":"c1","uid":1025849,"ip_address":"","ucode":"06303E63E5509A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a7/39/c0c41d51.jpg","comment_is_top":false,"comment_ctime":1524495875,"is_pvip":false,"replies":[{"id":"1814","content":"代码中约定的","user_name":"作者回复","comment_id":6171,"uid":"1075874","ip_address":"","utype":1,"ctime":1524717689,"user_name_real":"betachen"}],"discussion_count":1,"race_medal":0,"score":"1524495875","product_id":100005701,"comment_content":"为什么矿池的特殊在于它可以产生新的区块","like_count":0,"discussions":[{"author":{"id":1075874,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Tm6wv99GcGd6n5qLQHNRzdL7w3yBEWPKQkQy5otblQTrh0P6OV1nlMd1FKm5YSCBCXVKtT2GdFaJZxRw7VvvUQ/132","nickname":"陈浩","note":"","ucode":"F906AED9E2AC2F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":416984,"discussion_content":"代码中约定的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1524717689,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":6128,"user_name":"小5","can_delete":false,"product_type":"c1","uid":1074736,"ip_address":"","ucode":"F99936F37D04E4","user_header":"https://static001.geekbang.org/account/avatar/00/10/66/30/ce2cc535.jpg","comment_is_top":false,"comment_ctime":1524441909,"is_pvip":false,"replies":[{"id":"1726","content":"基础概念其实是相同的，这个计算机教材入门讲都差不多是类似的，不过为了小白读起来容易花了不少功夫哇。下一篇开始逐渐深入了。希望继续关注哈","user_name":"作者回复","comment_id":6128,"uid":"1075874","ip_address":"","utype":1,"ctime":1524486088,"user_name_real":"betachen"}],"discussion_count":1,"race_medal":0,"score":"1524441909","product_id":100005701,"comment_content":"看了下精通比特币电子书，这些基本的概念里面都有讲，什么时候能上一些网上搜不到的东西","like_count":0,"discussions":[{"author":{"id":1075874,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Tm6wv99GcGd6n5qLQHNRzdL7w3yBEWPKQkQy5otblQTrh0P6OV1nlMd1FKm5YSCBCXVKtT2GdFaJZxRw7VvvUQ/132","nickname":"陈浩","note":"","ucode":"F906AED9E2AC2F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":416970,"discussion_content":"基础概念其实是相同的，这个计算机教材入门讲都差不多是类似的，不过为了小白读起来容易花了不少功夫哇。下一篇开始逐渐深入了。希望继续关注哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1524486088,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":6074,"user_name":"良辰美景","can_delete":false,"product_type":"c1","uid":1074803,"ip_address":"","ucode":"B36E6955A2872D","user_header":"https://static001.geekbang.org/account/avatar/00/10/66/73/fd1e37a2.jpg","comment_is_top":false,"comment_ctime":1524323613,"is_pvip":false,"replies":[{"id":"1727","content":"PoW是的，其他算法PoS，DPoS是环保的。","user_name":"作者回复","comment_id":6074,"uid":"1075874","ip_address":"","utype":1,"ctime":1524486157,"user_name_real":"betachen"}],"discussion_count":1,"race_medal":0,"score":"1524323613","product_id":100005701,"comment_content":"我最近听得到吴军老师说比特币交易成本极高。去中心化带来了大量资源的浪费。如果有好的解决办法是个暴富的机会哦","like_count":0,"discussions":[{"author":{"id":1075874,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Tm6wv99GcGd6n5qLQHNRzdL7w3yBEWPKQkQy5otblQTrh0P6OV1nlMd1FKm5YSCBCXVKtT2GdFaJZxRw7VvvUQ/132","nickname":"陈浩","note":"","ucode":"F906AED9E2AC2F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":416950,"discussion_content":"PoW是的，其他算法PoS，DPoS是环保的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1524486157,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":6045,"user_name":"不了峰","can_delete":false,"product_type":"c1","uid":1013424,"ip_address":"","ucode":"E23B96D6A3D4EC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/76/b0/14fec62f.jpg","comment_is_top":false,"comment_ctime":1524298843,"is_pvip":false,"replies":[{"id":"1729","content":"可以的，正常矿机就是部署6~8张显卡。目前cpu挖矿的币种极少。","user_name":"作者回复","comment_id":6045,"uid":"1075874","ip_address":"","utype":1,"ctime":1524486332,"user_name_real":"betachen"}],"discussion_count":1,"race_medal":0,"score":"1524298843","product_id":100005701,"comment_content":"「ETHASH 是 Dagger-Hashimoto 的修改版本，它是典型的内存困难型挖矿算法。」请问以太坊的挖矿，矿机是占用大量内存还是占用大量cpu？<br><br>我其实是想问，一台主机上能不能部多个挖矿机，比如，门罗和ETH，我以为一个是消耗cpu，一个是消耗内存。","like_count":1,"discussions":[{"author":{"id":1075874,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Tm6wv99GcGd6n5qLQHNRzdL7w3yBEWPKQkQy5otblQTrh0P6OV1nlMd1FKm5YSCBCXVKtT2GdFaJZxRw7VvvUQ/132","nickname":"陈浩","note":"","ucode":"F906AED9E2AC2F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":416942,"discussion_content":"可以的，正常矿机就是部署6~8张显卡。目前cpu挖矿的币种极少。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1524486332,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}