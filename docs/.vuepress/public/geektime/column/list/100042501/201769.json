{"id":201769,"title":"27丨案例：带宽消耗以及Swap（上）","content":"<p>今天我们来看一个真实的案例。事情是这样的，之前有人在微信上问我一个问题，这个问题的现象很典型：典型的TPS上不去，响应时间增加，资源用不上。</p><p>大概的情况是这样的：有两台4C8G的服务器，一台服务器上有2个Tomcat，一台服务器上是DB。压测的混合场景有4个功能模块，其中3个访问一个Tomcat，另外一个访问一个Tomcat。</p><p>Tomcat的监控页面如下：</p><p><img src=\"https://static001.geekbang.org/resource/image/53/0b/532bbd1525be0ad0d08da7335645260b.png?wh=882*262\" alt=\"\"></p><p>应用服务器\b系统资源监控页面如下：</p><p><img src=\"https://static001.geekbang.org/resource/image/19/e5/1944bc692902fed979815a538d879be5.png?wh=892*687\" alt=\"\"></p><p>数据库服务器系统资源监控如下：</p><p><img src=\"https://static001.geekbang.org/resource/image/50/f0/50a996ac196dbfd2b9a23858e87dc8f0.png?wh=1174*745\" alt=\"\"></p><p>JMeter结果如下：</p><p><img src=\"https://static001.geekbang.org/resource/image/f8/33/f8b228a61b980c338046fbb3c8875033.png?wh=1099*219\" alt=\"\"></p><p>综上现象就是，单业务场景执行起来并不慢，但是一混合起来就很慢，应用服务器和数据库服务器的系统资源使用率并不高。请问慢在哪？</p><p>这是非常典型的询问性能问题的方式，虽然多给了系统资源信息，但是这些信息也不足以说明瓶颈在哪。</p><p>为什么呢？在现在多如牛毛的监控工具中，除非我们在系统中提前做好分析算法或警告，否则不会有监控工具主动告诉你， 监控出的某个数据有问题，而这个只能靠做性能分析的人来判断。</p><p>我在很多场合听一些“专家”说：性能分析判断要遵守木桶原理。但是在做具体技术分析的时候，又不给人说明白木桶的短板在哪里。这就好像，一个\b赛车手说要是有一个各方面都好的车，我肯定能得第一名，但是，我没有车。</p><!-- [[[read_end]]] --><p>话说出来轻而易举，但是请问木桶的短板怎么判断呢？因为CPU高，所以CPU就是短板吗？所以就要加CPU吗？这肯定是不对的。</p><p>因为这个例子并不大，所以可以细细地写下去。今天文章的目的就是要告诉你，性能问题分析到底应该是个什么分析思路。</p><h2>分析的第一阶段</h2><h3>画架构图</h3><p>做性能测试时，我们需要先画一个架构图，虽然简单，但是让自己脑子里时时记得架构图，是非常有必要的。因为架构级的分析，就是要胸怀架构，在看到一个问题点时，可以从架构图中立即反应出来问题的相关性。</p><p><img src=\"https://static001.geekbang.org/resource/image/fe/2c/fe8abb747bdeebfefd833ae8a5f4e12c.jpg?wh=638*171\" alt=\"\"></p><p>上面这张图是自己脑子里的逻辑图，数据在网络中的流转并不是这样，而是像下图这样。</p><p><img src=\"https://static001.geekbang.org/resource/image/72/8c/72fdc9310d5678fc1988f96f3026b28c.jpg?wh=436*265\" alt=\"\"></p><p>数据流是从压力机到应用服务器，应用服务器再到网络设备，再到数据库服务器；数据库把数据返回给应用服务器，应用服务器再通过网络设备给压力机。</p><p>如果把里面的Redis、ActiveMQ和MySQL的逻辑再细说明白，那么这个小小的应用都可以描述好一会。所以这里，我先大概描述一下，如果后面的分析中涉及到了相应的逻辑，再一点点加进来。</p><p>应用服务器只有一台，上面有两个Tomcat实例；数据库服务器有三个应用。混合场景中有四个业务，其中三个访问Tomcat1，第四个访问Tomcat2。</p><h3>场景\b描述</h3><p>有了场景大概的画像之后，我们再来看场景。根据测试工程师描述：</p><ol>\n<li>响应时间慢的，都是可视化页面，有不少图片、JS、CSS等静态资源。公网上是用CDN的，现在只测试内网的部分。静态资源已经做了压缩。</li>\n<li>单业务测试的容量是可以满足要求的，但混合场景响应时间就长。系统资源用得并不多。</li>\n<li>压力场景是300线程，Ramp-up period是1秒。</li>\n<li>Duration是72000。</li>\n<li>各参数化都已经做了，参数化数据也合理。</li>\n<li>测试环境都是内网。</li>\n<li>服务器是CentOS，压力机是Win10。</li>\n</ol><p>既然这样，我们还是要看看系统的各个资源，再来判断方向。我在很多场合都强调证据链。对架构比较简单的应用来说，我们都不用再做时间的拆分了，直接到各主机上看看资源就好了。</p><h3>瓶颈\b分析定位</h3><p>根据我们之前画的架构图，我们从应用服务器、数据库服务器和压力数据分别定位一下。</p><ul>\n<li>应用服务器</li>\n</ul><p><img src=\"https://static001.geekbang.org/resource/image/5f/b0/5f3f4fc313c833ff2ad979d63de7f9b0.png?wh=892*687\" alt=\"\"></p><p>从前面的应用服务器资源来看，CPU使用率现在还不高，也基本都在us CPU（就是user消耗的CPU）上，比例也比较合理。</p><p>物理内存8G，还有3.5G。即使不多，对Java应用来说，也要先看JVM，只要不是page fault过多，我们可以先不用管物理内存。</p><p>网络资源接收900KB/s左右，发送11M左右。这样的带宽应该说是比较敏感的，因为对100Mbps和1000Mbps来说，我们要心里有一个数，一个是12.5MB（对应100Mbps），一个是125MB（对应1000Mbps），当和这样的带宽值接近的时候，就要考虑下是不是带宽导致的压力上不去。不过这里我们也不用先下定论。只是留个疑问在这里。</p><p>磁盘资源，基本上没有读写，很正常。</p><p>从Process列表中，也没看到什么异常数据。faults也都是min，major fault并没有。但在这个案例中，还部署了另一个监控工具，上面显示如下：</p><p><img src=\"https://static001.geekbang.org/resource/image/9e/b9/9e9bc7528dac06fcbef811eed0ae8bb9.png?wh=596*160\" alt=\"\"></p><p>为什么这个Swapping要标黄呢？那肯定是过大了嘛。是的，你可以觉得swap过多。这个扣，我们也记在心里。在这里标红加粗敲黑板！</p><ul>\n<li>数据库服务器</li>\n</ul><p><img src=\"https://static001.geekbang.org/resource/image/23/14/23b3ce5e2d551a54c59ef24c3601ad14.png?wh=1086*720\" alt=\"\"></p><p>照样分析，CPU、内存、网络、磁盘、Process列表，并没看到哪里有异常的数据，连网络都只有500多k的发送。</p><p>这样的数据库资源状态\b告诉我们，它不在我们的问题分析主线上。接下来是压力数据。</p><ul>\n<li>压力数据</li>\n</ul><p>这是JMeter中的聚合报告：</p><p><img src=\"https://static001.geekbang.org/resource/image/ee/98/eecc1affbdeca2484d2964a93d75fe98.png?wh=828*143\" alt=\"\"></p><p>从上面这张图也能看出，响应时间确实挺长的，并且，\b300线程只有37的TPS，带宽总量10M左右。这个带宽倒是和应用服务器上的带宽使用量相当。关于这个带宽的判断请你一定注意，对于性能分析来说，带宽能不能对得上非常重要。\b比如，客户端接收了多少流量，服务端就应该是发出了多少流量。如果服务端发了很多包，但是客户端没有接收，那就是堵在队列上了。</p><p>既然其它的资源暂时没出现什么瓶颈。其实在这个时间里，如果是复杂的应用的话，我们最应该干的一件事情就是拆分时间。如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/e7/41/e77401663a74e38dacf6cd05f3c96f41.jpg?wh=769*223\" alt=\"\"></p><p>这里我把时间拆为t1-t5，具体分析哪一段为什么消耗了时间。我们可以在Tomcat中加上%D和%F两个参数来记录request和response的时间。</p><p>\b在没有做这个动作之前，我们先把前面的扣解决一下。首先，带宽是不是受了100Mbps的限制？</p><p>一般来说，判断网络的时候，我们会有几个判断点。</p><p>首先是带宽的流量大小，也就是前面我们看到的11M左右的值。一般来说，100Mbps是指的bit per second，但是在应用层基本上都是byte，所以对100Mbps来说，是12.5MB。</p><p>其次是，全连接和半连接队列是否已经溢出？</p><p><img src=\"https://static001.geekbang.org/resource/image/c7/07/c7a67037f03d82378eec8b6c70c32207.png?wh=425*32\" alt=\"\"></p><p>我们通过SYNs to LISTEN sockets dropped来判断半连接队列是否溢出，通过times the listen queue of a socket overflowed来判断全连接队列是否溢出。</p><p>通过实时的查看，这两个值的增加并不多。所以这里不会是问题点。</p><p>最后是发送和接收队列是否堆积？</p><p><img src=\"https://static001.geekbang.org/resource/image/fe/72/fe954bf48b860464923418ca90800572.png?wh=781*430\" alt=\"\"></p><p>通过应用服务器上的send-Q（前面数第三列），可以看到服务器和压力机之间的的队列还是很长的，基本上每次查看都存在，这说明队列一直都有堆积。</p><p>我们再到压力机上看看带宽用了多少：</p><p><img src=\"https://static001.geekbang.org/resource/image/f2/4d/f2a3e24763892f2eab807adc6934ac4d.png?wh=627*549\" alt=\"\"></p><p>看这里也是用到了93Mbps，那么到这里我们就可以确定是网络问题导致的TPS上不去，响应时间增加，系统资源也用不上了。</p><p>和系统管理员确认宿主机的带宽后，被告知宿主机确实是100Mbps。</p><p>似乎这个分析到这里就可以结束了，直接把带宽加上再接着测试呗。但是，从项目实施的角度上说，这个问题，并不是阻塞性的。</p><p>为了把更多的性能问题提前找出来，现在我们先不下载静态\b资源，只发接口请求找下其他\b\b性能问题。这个带宽的问题，记一个bug就行了。</p><h3>优化结果</h3><p>我们将静态资源全都过滤掉之后，再次执行场景，结果是下面这样的。</p><p>JMeter压力数据：</p><p><img src=\"https://static001.geekbang.org/resource/image/77/aa/771ee29f154f43bc84c8e8df66431caa.png?wh=1227*167\" alt=\"\"></p><p>应用服务器带宽：</p><p><img src=\"https://static001.geekbang.org/resource/image/ed/b6/ed896cecbdfbb6c9cc4beba10f5744b6.png?wh=137*150\" alt=\"\"></p><p>数据库服务器带宽：</p><p><img src=\"https://static001.geekbang.org/resource/image/74/b8/74a2516200a297a062730341eacf60b8.png?wh=172*206\" alt=\"\"></p><p>应用服务器网络队列：</p><p><img src=\"https://static001.geekbang.org/resource/image/75/73/750402d3482cba2c6e77cd9043616373.png?wh=1041*543\" alt=\"\"></p><p>应用服务器资源监控：</p><p><img src=\"https://static001.geekbang.org/resource/image/75/7c/75423cd11a411b3847252d479554a97c.png?wh=889*570\" alt=\"\"></p><p>通过上面的结果可以看出：</p><ol>\n<li>TPS可以达到221.5了，并且Received和Sent的字节加一起不到4MB。</li>\n<li>应用服务器和数据库服务器的带宽都用到了近40Mbps，和JMeter结果也相当。</li>\n<li>应用服务器上的网络队列也没有堆积。</li>\n<li>应用服务器的CPU也已经能消耗到66%了，</li>\n</ol><p>当正在想通过过滤掉静态资源绕过带宽不足的现状来测试其他性能问题的时候，这时，Swap双向都标黄了。这时，性能测试工程师更纠结了，它为什么双向都黄了？CPU使用率才66%嘛。</p><p>其实，这两句话之间并没有什么关系，CPU使用率不管是多少，Swap该黄还是会黄。</p><p>这是为什么呢？这里卖个关子，在下一篇文章中，我们接着分析。</p><h2>总结</h2><p>带宽问题是性能分析中常见的问题之一，其难点就在于，带宽不像CPU使用率那么清晰可理解，它和TCP/IP协议的很多细节有关，像三次握手，四次挥手，队列长度，网络抖动、丢包、延时等等，都会影响性能，关键是这些判断点还不在同一个界面中，所以需要做分析的人有非常明确的分析思路才可以做得到。而且现在的监控分析工具中，对网络的判断也是非常薄弱的。</p><p>而Swap问题不能算是常见，只要出现，基本上就会很多人晕乎。解决的关键就是要明白Swap的原理，查到关联参数，然后就可以很快地定位了。</p><h2>思考题</h2><p>结合今天的内容，你能说一下网络的瓶颈如何判断吗？有哪几个队列？</p><p>欢迎你在评论区写下你的思考，也欢迎把这篇文章分享给你的朋友或者同事，一起交流一下。</p>","neighbors":{"left":{"article_title":"26丨案例：手把手带你理解TPS趋势分析","id":200152},"right":{"article_title":"28丨案例：带宽消耗以及Swap（下）","id":201745}},"comments":[{"had_liked":false,"id":231165,"user_name":"土耳其小土豆","can_delete":false,"product_type":"c1","uid":1785659,"ip_address":"","ucode":"B16574EF28525E","user_header":"https://static001.geekbang.org/account/avatar/00/1b/3f/3b/119fd0ef.jpg","comment_is_top":false,"comment_ctime":1593598071,"is_pvip":false,"replies":[{"id":"87982","content":"netstat -naop就可以。","user_name":"作者回复","user_name_real":"高楼(Zee)","uid":"1785562","ctime":1596077007,"ip_address":"","comment_id":231165,"utype":1}],"discussion_count":1,"race_medal":0,"score":"44543271031","product_id":100042501,"comment_content":"高老师，网络队列的截图的具体命令能告知以下嘛？我想打印跟你那一样的","like_count":10,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"高楼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500184,"discussion_content":"netstat -naop就可以。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1596077007,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":322865,"user_name":"Geek_9e9d56","can_delete":false,"product_type":"c1","uid":2791742,"ip_address":"","ucode":"F6333DA18E4EB0","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/aCVlj0fom8geRoXFkO34Jbpf9oia79QxdbwDuyyLqL1WAVC7iaViaE4YNUvcatEwwUF6102MeH6kBxo5CwLibrCiajg/132","comment_is_top":false,"comment_ctime":1637636645,"is_pvip":true,"replies":[{"id":"117401","content":"我最常用的就是iftop。","user_name":"作者回复","user_name_real":"编辑","uid":"1785562","ctime":1637945358,"ip_address":"","comment_id":322865,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14522538533","product_id":100042501,"comment_content":"高老师，应用和数据库服务器带宽截图的具体命令能否告知一下？谢谢","like_count":3,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"高楼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":533771,"discussion_content":"我最常用的就是iftop。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637945358,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":290744,"user_name":"糯糯","can_delete":false,"product_type":"c1","uid":1397372,"ip_address":"","ucode":"9EC18EE28591F8","user_header":"https://static001.geekbang.org/account/avatar/00/15/52/7c/cc192a8c.jpg","comment_is_top":false,"comment_ctime":1619716842,"is_pvip":false,"replies":[{"id":"105647","content":"瓶颈是上限的绊脚石，得先解决，再把资源占满才有意义。","user_name":"作者回复","user_name_real":"高楼(Zee)","uid":"1785562","ctime":1620452674,"ip_address":"","comment_id":290744,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14504618730","product_id":100042501,"comment_content":"老师 有个问题，如果说要找到系统上限，是找到系统瓶颈呢，还是尽可能的压测至服务器资源沾满呢","like_count":3,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"高楼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519279,"discussion_content":"瓶颈是上限的绊脚石，得先解决，再把资源占满才有意义。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1620452674,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":200728,"user_name":"Geek_237b86","can_delete":false,"product_type":"c1","uid":1806349,"ip_address":"","ucode":"3B862469A1D009","user_header":"","comment_is_top":false,"comment_ctime":1585644015,"is_pvip":false,"replies":[{"id":"75160","content":"spotlight。","user_name":"作者回复","user_name_real":"高楼(Zee)","uid":"1785562","ctime":1585662326,"ip_address":"","comment_id":200728,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14470545903","product_id":100042501,"comment_content":"老师swapping标黄的是什么工具？","like_count":3,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"高楼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490121,"discussion_content":"spotlight。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585662326,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":310277,"user_name":"Geek_Jean","can_delete":false,"product_type":"c1","uid":1787629,"ip_address":"","ucode":"7C23EC4D22C9D6","user_header":"https://static001.geekbang.org/account/avatar/00/1b/46/ed/a7cb8b2a.jpg","comment_is_top":false,"comment_ctime":1630575896,"is_pvip":false,"replies":[{"id":"112437","content":"有积压时，发送方和接收方的值确实不会对等，但这个偏差很小，你可以查看一下发送方的发送缓冲区大小和内核限制的写缓冲区最大值、以及接收方的接收缓冲区大小和内核限制的读缓冲区大小。<br>如果你可以在两边抓到同一时刻（记住是同一时刻）的网络带宽，那就会看到区别。<br><br>不过我觉得你不用纠结这一点。因为这个队列要长期有值才说明阻塞严重，偶尔有值或间歇性有值是不用关心的。 ","user_name":"作者回复","user_name_real":"高楼(Zee)","uid":"1785562","ctime":1630632093,"ip_address":"","comment_id":310277,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10220510488","product_id":100042501,"comment_content":"高老师，谢谢您给大家分享这么多的干货，真的受益非浅，但看完这讲后，我有3个问题没明白：<br>1. 我有这样一个认知：服务端Send-Q如果有积压，那实时查看网络带宽的时候服务端的发送量和客户端的接收量不会对等。这个认知对吗？<br>如果上面说的是对的，那我又有一个新问题：<br>服务端网络资源接收 900KB&#47;s 左右，发送 11M 左右；然后通过查看压力机上的网络接收流量可以看到是93Mbps，换算之后也就是11M左右,<br>这么看服务端的发送量和客户端的接收量是一样的，带宽是对得上的。依据这样的推断服务端的Send-Q应该不会有积压才对。这个怎么理解呢？<br>如果上面的认知不对：那我有另外一个新问题：<br>实时查看服务端的时候Send-Q都有积压了，那说明这些数据还没有到达客户端，那客户端的接收量就不会接近服务端的发送量了。但实际上他们都是93Mbps.这是怎么回事呢？","like_count":2,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"高楼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526182,"discussion_content":"有积压时，发送方和接收方的值确实不会对等，但这个偏差很小，你可以查看一下发送方的发送缓冲区大小和内核限制的写缓冲区最大值、以及接收方的接收缓冲区大小和内核限制的读缓冲区大小。\n如果你可以在两边抓到同一时刻（记住是同一时刻）的网络带宽，那就会看到区别。\n\n不过我觉得你不用纠结这一点。因为这个队列要长期有值才说明阻塞严重，偶尔有值或间歇性有值是不用关心的。 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630632093,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":205806,"user_name":"bettynie","can_delete":false,"product_type":"c1","uid":1580609,"ip_address":"","ucode":"84372D4B8761D6","user_header":"https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83epFQPMPrP3V6HhlGLPp0JKMiaHQDibFKnE7z8To27tYEH42XvvmmQGyYvL4CK1lLJBIUAw7jtBnezibA/132","comment_is_top":false,"comment_ctime":1586742211,"is_pvip":false,"replies":[{"id":"77264","content":"如果有必要的话，可以这样做。只是在内网中，网络设备的背板吞吐都是很大的。你的应用有这么大的流量吗？","user_name":"作者回复","user_name_real":"高楼(Zee)","uid":"1785562","ctime":1586958865,"ip_address":"","comment_id":205806,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10176676803","product_id":100042501,"comment_content":"高老师，我们做内网测试时采用直连的方式，是不是可以更好的避免内网的网络问题，只考虑网卡的限制，这样可以把精力放在程序本身，先找出比较严重的性能问题再来考虑网络影响？","like_count":2,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"高楼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491588,"discussion_content":"如果有必要的话，可以这样做。只是在内网中，网络设备的背板吞吐都是很大的。你的应用有这么大的流量吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586958865,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":180334,"user_name":"大拇哥","can_delete":false,"product_type":"c1","uid":1167218,"ip_address":"","ucode":"77EAA268C6B4C8","user_header":"https://static001.geekbang.org/account/avatar/00/11/cf/72/72a8bcfd.jpg","comment_is_top":false,"comment_ctime":1582258761,"is_pvip":false,"replies":[{"id":"70041","content":"1，当网络有问题的时候，主要看队列，不用再对比流量了，因为已经没有意义了。<br>2，对。","user_name":"作者回复","user_name_real":"高楼(Zee)","uid":"1785562","ctime":1582279979,"ip_address":"","comment_id":180334,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10172193353","product_id":100042501,"comment_content":"1）查看服务器发包数量，客户端接口数据包的量是不基本一致，如果出现明显的差别，可以基本确定客户端网络问题<br>2）查看jmeter聚会报告上面客户端接口数据量是否已经接近宽带的限制<br>队列：<br>服务端消息发送队列<br>客户端接收数据的队列<br>服务端超时队列","like_count":2,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"高楼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484614,"discussion_content":"1，当网络有问题的时候，主要看队列，不用再对比流量了，因为已经没有意义了。\n2，对。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582279979,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":280828,"user_name":"Geek_a8d2eb","can_delete":false,"product_type":"c1","uid":2169031,"ip_address":"","ucode":"B3EA4F3318B307","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLx577ko7FBh90vfSFM4oqSz8wFBW4ztau8PUxY18R7yKJnRD4WB4sF7ibOmlqBYAZqwNsEbWT6bbg/132","comment_is_top":false,"comment_ctime":1614411658,"is_pvip":false,"replies":[{"id":"103248","content":"短暂的非0确实是可能接受的。如果tps和响应时间跟网络队列相关，这就要有证据才可以了。那你需要的是拆分响应时间，看有没有在网络上消耗。","user_name":"作者回复","user_name_real":"高楼(Zee)","uid":"1785562","ctime":1616422765,"ip_address":"","comment_id":280828,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5909378954","product_id":100042501,"comment_content":"压测时在应用服务上执行命令netstat -naop，发现Recv-Q和send-Q都有间歇性的非0状态，5秒内就恢复0了。网上搜说可接受短暂的非0情况，短暂的Send-Q队列发送pakets非0是正常状态。请问这种说法靠谱么，观察tps和响应曲线也会出现相应的锯齿状","like_count":1,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"高楼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":516219,"discussion_content":"短暂的非0确实是可能接受的。如果tps和响应时间跟网络队列相关，这就要有证据才可以了。那你需要的是拆分响应时间，看有没有在网络上消耗。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616422765,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":266512,"user_name":"😂","can_delete":false,"product_type":"c1","uid":2318485,"ip_address":"","ucode":"59C0AE9D557C77","user_header":"https://static001.geekbang.org/account/avatar/00/23/60/95/ef2af905.jpg","comment_is_top":false,"comment_ctime":1607365924,"is_pvip":false,"replies":[{"id":"96814","content":"看队列。","user_name":"作者回复","user_name_real":"高楼(Zee)","uid":"1785562","ctime":1607428513,"ip_address":"","comment_id":266512,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5902333220","product_id":100042501,"comment_content":"老师，如何判断带宽不够呀？1.服务器接受和发送的流量接近或超过带宽，说明带宽不够？2.压力机接受和发送的流量接近或变过带宽，说明带宽不够？","like_count":1,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"高楼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511293,"discussion_content":"看队列。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607428513,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1122311,"avatar":"https://static001.geekbang.org/account/avatar/00/11/20/07/aef14454.jpg","nickname":"hoppaz","note":"","ucode":"2CBA5C1784AC6D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535964,"discussion_content":"看队列怎么个看法呢？感觉看每一篇文章，就很突然的冒出来结果，分析的过程几乎没有提到，太跳跃了，听不懂。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1638621294,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":215894,"user_name":"nelson","can_delete":false,"product_type":"c1","uid":1271183,"ip_address":"","ucode":"773BE75A23C1C9","user_header":"","comment_is_top":false,"comment_ctime":1589127255,"is_pvip":false,"replies":[{"id":"81949","content":"这里提的单业务不慢，是因为对于同样的带宽来说，单业务的TPS是没有业务限定的。而混合场景中会有业务目标限定。","user_name":"作者回复","user_name_real":"高楼(Zee)","uid":"1785562","ctime":1590739551,"ip_address":"","comment_id":215894,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5884094551","product_id":100042501,"comment_content":"文稿中提及“综上现象就是，单业务场景执行起来并不慢，但是一混合起来就很慢，应用服务器和数据库服务器的系统资源使用率并不高。请问慢在哪？”<br>经过一系列分析，没有给出单业务为什么不慢，如果是带宽问题，单业务也一定会慢","like_count":1,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"高楼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494597,"discussion_content":"这里提的单业务不慢，是因为对于同样的带宽来说，单业务的TPS是没有业务限定的。而混合场景中会有业务目标限定。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590739551,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":204207,"user_name":"月亮和六便士","can_delete":false,"product_type":"c1","uid":1080894,"ip_address":"","ucode":"EFFCB9171D4B4E","user_header":"https://static001.geekbang.org/account/avatar/00/10/7e/3e/82202cc8.jpg","comment_is_top":false,"comment_ctime":1586351613,"is_pvip":false,"replies":[{"id":"76414","content":"你说的小是多少？有没有数据发出来看看？","user_name":"作者回复","user_name_real":"高楼(Zee)","uid":"1785562","ctime":1586398589,"ip_address":"","comment_id":204207,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5881318909","product_id":100042501,"comment_content":"为什么同一个服务器，同一个环境，用Nmon监控，显示swap正常，page fault 也很小，用spotlight监控，swap就黄了，不科学啊。","like_count":1,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"高楼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491103,"discussion_content":"你说的小是多少？有没有数据发出来看看？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586398589,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":359761,"user_name":"Geek_588072","can_delete":false,"product_type":"c1","uid":2459800,"ip_address":"四川","ucode":"BF6F51CBA00A53","user_header":"","comment_is_top":false,"comment_ctime":1665845138,"is_pvip":false,"replies":[{"id":"130954","content":"netstat","user_name":"作者回复","user_name_real":"编辑","uid":"1785562","ctime":1666188800,"ip_address":"四川","comment_id":359761,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1665845138","product_id":100042501,"comment_content":"老师和同学好。<br>想请教一个简单的问题，&quot;应用服务器网络队列&quot;那张图的记录是用什么命令得到的？","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"高楼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590958,"discussion_content":"netstat","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666188801,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"四川"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":339470,"user_name":"徐峥","can_delete":false,"product_type":"c1","uid":1015660,"ip_address":"","ucode":"315B26AA43B08A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7f/6c/18bf99bf.jpg","comment_is_top":false,"comment_ctime":1648117949,"is_pvip":false,"replies":[{"id":"124354","content":"netstat。","user_name":"作者回复","user_name_real":"编辑","uid":"1785562","ctime":1648601071,"ip_address":"","comment_id":339470,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1648117949","product_id":100042501,"comment_content":"高老師，您好。查看发送和接收队列是否堆积的命令是什麽？","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"高楼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559062,"discussion_content":"netstat。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648601071,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":303643,"user_name":"Allister🏅","can_delete":false,"product_type":"c1","uid":1363379,"ip_address":"","ucode":"5CC2DA8CADFD59","user_header":"https://static001.geekbang.org/account/avatar/00/14/cd/b3/4e518c2c.jpg","comment_is_top":false,"comment_ctime":1626913285,"is_pvip":false,"replies":[{"id":"109919","content":"你是说nmon吗？","user_name":"作者回复","user_name_real":"高楼(Zee)","uid":"1785562","ctime":1626936037,"ip_address":"","comment_id":303643,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1626913285","product_id":100042501,"comment_content":"高老师，第一张资源监控（cpu，内存，网络等）用什么看的呢？","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"高楼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523773,"discussion_content":"你是说nmon吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626936037,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":302085,"user_name":"jy","can_delete":false,"product_type":"c1","uid":1785172,"ip_address":"","ucode":"F4E179C435451B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJ6G2xZvNRmhyXBjmGbI5G8icGCCMPupr6yxZ1IcURwp7GTRHcpWGWpg9A0fLlyicmVdDwzqZqwiaOQ/132","comment_is_top":false,"comment_ctime":1626074759,"is_pvip":false,"replies":[{"id":"109436","content":"建立连接的状态。 ","user_name":"作者回复","user_name_real":"高楼(Zee)","uid":"1785562","ctime":1626230140,"ip_address":"","comment_id":302085,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1626074759","product_id":100042501,"comment_content":"请问下，应用服务器上的 send-Q那个图，是应用listen状态还是非listen状态的截图？","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"高楼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523174,"discussion_content":"建立连接的状态。 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626230140,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":279799,"user_name":"Geek_a8d2eb","can_delete":false,"product_type":"c1","uid":2169031,"ip_address":"","ucode":"B3EA4F3318B307","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLx577ko7FBh90vfSFM4oqSz8wFBW4ztau8PUxY18R7yKJnRD4WB4sF7ibOmlqBYAZqwNsEbWT6bbg/132","comment_is_top":false,"comment_ctime":1613965642,"is_pvip":false,"replies":[{"id":"103261","content":"因为数据包拆分成大小不一的包之后是很难达到线性的呀。","user_name":"作者回复","user_name_real":"高楼(Zee)","uid":"1785562","ctime":1616423120,"ip_address":"","comment_id":279799,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1613965642","product_id":100042501,"comment_content":"高老师，带宽分析那里没看懂，应用服务器发送约11MB，约等于88Mbqs。压力机接收的带宽是93Mbqs。怎么就是带宽的问题呢，发出的比接收的还小呀？","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"高楼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":515874,"discussion_content":"因为数据包拆分成大小不一的包之后是很难达到线性的呀。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616423120,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1122311,"avatar":"https://static001.geekbang.org/account/avatar/00/11/20/07/aef14454.jpg","nickname":"hoppaz","note":"","ucode":"2CBA5C1784AC6D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535963,"discussion_content":"没明白其中的因果关系。能用因为，所以的方式表达一下推理的因果逻辑吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638621164,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":201800,"user_name":"Geek_ed7255","can_delete":false,"product_type":"c1","uid":1906934,"ip_address":"","ucode":"F8FC154643CD8C","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKlMfib72C2pyeiclc7U5ybwN0rVUMIwox8TcAjIjJKywfPIWSvyiaVpCFQccvaeSZ7M8Oko4EA09icrw/132","comment_is_top":false,"comment_ctime":1585838972,"is_pvip":false,"replies":[{"id":"75579","content":"主要就是网络。没其他区别。","user_name":"作者回复","user_name_real":"高楼(Zee)","uid":"1785562","ctime":1585970212,"ip_address":"","comment_id":201800,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1585838972","product_id":100042501,"comment_content":"老师，内网和外网压测有什么区别","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"高楼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490425,"discussion_content":"主要就是网络。没其他区别。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585970212,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":197197,"user_name":"餘生","can_delete":false,"product_type":"c1","uid":1705643,"ip_address":"","ucode":"3F15F78D4004B5","user_header":"https://static001.geekbang.org/account/avatar/00/1a/06/ab/ba20f342.jpg","comment_is_top":false,"comment_ctime":1585362937,"is_pvip":false,"replies":[{"id":"74719","content":"对于网络来说，不分客户端，服务端。只要分发送和接收端就可以。 <br>并且，也不会出现某一端发的大，另一端接的少的这种情况，接收端接不了，发送端肯定就排队去了。<br>所以，你说的其实是一种现象。","user_name":"作者回复","user_name_real":"高楼(Zee)","uid":"1785562","ctime":1585469046,"ip_address":"","comment_id":197197,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1585362937","product_id":100042501,"comment_content":"对于性能分析来说，带宽能不能对得上非常重要。\b比如，客户端接收了多少流量，服务端就应该是发出了多少流量。如果服务端发了很多包，但是客户端没有接收，那就是堵在队列上了。<br><br>关于这一段话，我想请问下，为什么没有提到客户端发出请求的流量大于服务端接收的情况？这种情况需要考虑吗？如果要考虑的话，通常会出现哪几种现象，要如何分析","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"高楼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489472,"discussion_content":"对于网络来说，不分客户端，服务端。只要分发送和接收端就可以。 \n并且，也不会出现某一端发的大，另一端接的少的这种情况，接收端接不了，发送端肯定就排队去了。\n所以，你说的其实是一种现象。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585469046,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1974099,"avatar":"","nickname":"binxue168","note":"","ucode":"E4F3A91418BC3C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":261189,"discussion_content":"发送大，接收小，有可能是网络设备有问题，导致网络丢包","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588945474,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":185857,"user_name":"啊啊","can_delete":false,"product_type":"c1","uid":1511478,"ip_address":"","ucode":"3F8F17C508A19D","user_header":"https://static001.geekbang.org/account/avatar/00/17/10/36/fc9e80c4.jpg","comment_is_top":false,"comment_ctime":1583714433,"is_pvip":false,"replies":[{"id":"71813","content":"这个例子里没有写单场景的，直接就是混合场景了。","user_name":"作者回复","user_name_real":"高楼(Zee)","uid":"1785562","ctime":1583719487,"ip_address":"","comment_id":185857,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1583714433","product_id":100042501,"comment_content":"单场景时网络的情况是怎样的？没想明白为什么单场景网络不是瓶颈？","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"高楼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486531,"discussion_content":"这个例子里没有写单场景的，直接就是混合场景了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583719487,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1511478,"avatar":"https://static001.geekbang.org/account/avatar/00/17/10/36/fc9e80c4.jpg","nickname":"啊啊","note":"","ucode":"3F8F17C508A19D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":200839,"discussion_content":"看文章描述，单场景时挺快，混合场景就慢。感觉如果是网络问题在单场景时就应该暴漏出来啊。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583729003,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":182037,"user_name":"Geek_454a8f","can_delete":false,"product_type":"c1","uid":1787821,"ip_address":"","ucode":"BB7083330C41E2","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIc8vg1BUJPaajoaylfCmicNGyj1ggoFtJwM86s5lZIicBIFAvOPuQ6u85n2xboHRQHG8ibHNgkRDUDA/132","comment_is_top":false,"comment_ctime":1582697526,"is_pvip":false,"replies":[{"id":"70492","content":"本例中没分析tomcat，一开始的的监控图是个老旧的工具probe。","user_name":"作者回复","user_name_real":"高楼(Zee)","uid":"1785562","ctime":1582713162,"ip_address":"","comment_id":182037,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1582697526","product_id":100042501,"comment_content":"tomcat使用什么监控的","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"高楼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485205,"discussion_content":"本例中没分析tomcat，一开始的的监控图是个老旧的工具probe。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582713162,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":181739,"user_name":"Melody","can_delete":false,"product_type":"c1","uid":1712966,"ip_address":"","ucode":"4F188D002FAE78","user_header":"https://static001.geekbang.org/account/avatar/00/1a/23/46/d1d548d1.jpg","comment_is_top":false,"comment_ctime":1582625998,"is_pvip":false,"replies":[{"id":"70397","content":"网络呢？","user_name":"作者回复","user_name_real":"高楼(Zee)","uid":"1785562","ctime":1582630569,"ip_address":"","comment_id":181739,"utype":1}],"discussion_count":4,"race_medal":0,"score":"1582625998","product_id":100042501,"comment_content":"老师，有一个问题想请教您，服务器使用的是容器，且做了负载均衡，在加压的过程中会报连接超时的错误，服务器cpu，内存，带宽都正常，压力机也未出现瓶颈，该如何分析？","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"高楼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485101,"discussion_content":"网络呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582630569,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2556640,"avatar":"https://static001.geekbang.org/account/avatar/00/27/02/e0/5e11188d.jpg","nickname":"BMB","note":"","ucode":"91CC67459B6FBD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":412046,"discussion_content":"具体的报错信息呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636071023,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1974099,"avatar":"","nickname":"binxue168","note":"","ucode":"E4F3A91418BC3C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":261186,"discussion_content":"还可能是你应用程序本身的问题，例如：连接池占用满了导致排队超时；线程死锁等~~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588945317,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1712966,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/23/46/d1d548d1.jpg","nickname":"Melody","note":"","ucode":"4F188D002FAE78","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":186289,"discussion_content":"用的内网","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582675030,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}