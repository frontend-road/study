{"id":406179,"title":"01ï½œå®ç°ä¸€é—¨è¶…ç®€å•çš„è¯­è¨€æœ€å¿«éœ€è¦å¤šä¹…ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å®«æ–‡å­¦ã€‚</p><p>è¯´åˆ°å®ç°ä¸€é—¨è®¡ç®—æœºè¯­è¨€ï¼Œä½ è‚¯å®šè§‰å¾—è¿™æ˜¯ä¸€ä¸ªåºå¤§åˆå¤æ‚çš„å·¥ç¨‹ï¼Œå·¥ä½œé‡å·¨å¤§ï¼</p><p>è¿™ä¸ªç†è§£ï¼Œæˆ‘åªèƒ½è¯´éƒ¨åˆ†æ­£ç¡®ã€‚å…¶å®ï¼Œæœ‰çš„æ—¶å€™ï¼Œå®ç°ä¸€é—¨è¯­è¨€çš„é€Ÿåº¦ä¹Ÿå¯ä»¥å¾ˆå¿«ã€‚æ¯”å¦‚ï¼Œå½“å¹´å…°ç™»Â·è‰¾å…‹ï¼ˆBrendan Eichï¼‰åªèŠ±äº†10å¤©æ—¶é—´å°±æŠŠJavaScriptè¯­è¨€è®¾è®¡å‡ºæ¥äº†ã€‚å½“ç„¶ï¼Œè¯­è¨€è·Ÿå…¶ä»–è½¯ä»¶ä¸€æ ·ï¼Œä¹Ÿéœ€è¦ä¸æ–­è¿­ä»£ï¼Œè‡³ä»ŠJSçš„æ ‡å‡†å’Œå®ç°ä»åœ¨ä¸åœçš„æ¼”åŒ–ã€‚</p><p>å¦‚æœæˆ‘è¯´ï¼Œä½ ä¹Ÿå®Œå…¨å¯ä»¥åœ¨è¿™ä¹ˆçŸ­çš„æ—¶é—´å†…å®ç°ä¸€é—¨è¯­è¨€ï¼Œç”šè‡³éƒ½ä¸éœ€è¦é‚£ä¹ˆé•¿æ—¶é—´ï¼Œä½ ä¸€å®šä¼šè§‰å¾—æˆ‘æ˜¯åœ¨å“—ä¼—å–å® ã€æ ‡é¢˜å…šã€‚</p><p>åˆ«æ€¥ï¼Œæˆ‘å†è¡¥å……è¯´æ˜ä¸€ä¸‹ï¼Œä½ é©¬ä¸Šå°±ä¼šè®¤å¯æˆ‘çš„è¯´æ³•äº†ã€‚è¿™ä¸ªè®©ä½ ä¸€å¼€å§‹å®ç°çš„ç‰ˆæœ¬ï¼Œåªæ˜¯ä¸ºäº†å»æ¢ç´¢è®¡ç®—æœºè¯­è¨€çš„åŸç†ï¼Œæ˜¯é«˜åº¦ç®€åŒ–çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸è¦æ±‚é©¬ä¸Šèƒ½å®ç”¨ã€‚ä½ å¯ä»¥æŠŠå®ƒçœ‹åšæ˜¯ä¸€ä¸ªåŸå‹ç³»ç»Ÿï¼Œä»…æ­¤è€Œå·²ï¼Œå®ç°èµ·æ¥ä¸ä¼šå¤ªå¤æ‚ã€‚</p><p>å¥½å§ï¼Œæˆ‘çŸ¥é“ä½ è‚¯å®šè¿˜åœ¨å¿ƒé‡Œæ‰“é¼“ï¼šå†ç®€å•çš„è®¡ç®—æœºè¯­è¨€ï¼Œé‚£ä¹Ÿæ˜¯ä¸€é—¨è¯­è¨€å‘€ï¼Œéš¾åº¦åˆèƒ½ä½åˆ°å“ªé‡Œå»ï¼Ÿ</p><p>è¿™æ ·ï¼Œå…ˆä¿ç•™ä½ çš„ç–‘è™‘ï¼Œæˆ‘ä»¬è¿›å…¥ä»Šå¤©çš„è¯¾ç¨‹ã€‚<strong>ä»Šå¤©æˆ‘å°±è¦å¸¦ä½ æŒ‘æˆ˜ï¼Œä»…ä»…åªç”¨ä¸€èŠ‚è¯¾æ—¶é—´ï¼Œå°±å®ç°ä¸€é—¨è¶…ç®€æ´çš„è¯­è¨€ã€‚</strong>æˆ‘ä¼šæš‚æ—¶å¿½ç•¥å¾ˆå¤šçš„æŠ€æœ¯ç»†èŠ‚ï¼Œå¸¦ä½ æŠ“ä½å®ç°ä¸€é—¨è®¡ç®—æœºè¯­è¨€çš„éª¨å¹²éƒ¨åˆ†ï¼ŒæŒæ¡å…¶æ ¸å¿ƒåŸç†ã€‚åœ¨è¿™èŠ‚è¯¾ä¸­ï¼Œä½ ä¼šå¿«é€Ÿè·å¾—ä¸¤ä¸ªæŠ€èƒ½ï¼š</p><ul>\n<li>å¦‚ä½•é€šè¿‡ç¼–è¯‘å™¨æ¥ç†è§£æŸä¸ªç¨‹åºï¼›</li>\n<li>å¦‚ä½•è§£é‡Šæ‰§è¡Œè¿™ä¸ªç¨‹åºã€‚</li>\n</ul><!-- [[[read_end]]] --><p>è¿™ä¸¤ä¸ªç‚¹ï¼Œåˆ†åˆ«æ˜¯ç¼–è¯‘æ—¶çš„æ ¸å¿ƒå’Œè¿è¡Œæ—¶çš„æ ¸å¿ƒã€‚ç†è§£äº†è¿™ä¸¤ä¸ªçŸ¥è¯†ç‚¹ï¼Œä½ å°±å¤§è‡´ç†è§£è®¡ç®—æœºè¯­è¨€æ˜¯å¦‚ä½•å·¥ä½œçš„äº†ï¼</p><h2>æˆ‘ä»¬çš„ä»»åŠ¡</h2><p>è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬è¦è®©ä¸‹é¢è¿™ä¸ªç¨‹åºè¿è¡Œèµ·æ¥ï¼š</p><pre><code class=\"language-plain\">//ä¸€ä¸ªå‡½æ•°çš„å£°æ˜ï¼Œè¿™ä¸ªå‡½æ•°å¾ˆç®€å•ï¼Œåªæ‰“å°\"Hello World!\"\nfunction sayHello(){\n    println(\"Hello World!\");\n}\n//è°ƒç”¨åˆšæ‰å£°æ˜çš„å‡½æ•°\nsayHello();\n</code></pre><p>è¿™ä¸ªç¨‹åºåšäº†ä¸¤ä»¶äº‹ï¼šç¬¬ä¸€ä»¶æ˜¯å£°æ˜äº†ä¸€ä¸ªå‡½æ•°ï¼Œå«åšsayHelloï¼›ç¬¬äºŒä»¶äº‹ï¼Œå°±æ˜¯è°ƒç”¨sayHello()å‡½æ•°ã€‚è¿è¡Œè¿™ä¸ªç¨‹åºçš„æ—¶å€™ï¼Œæˆ‘ä»¬æœŸå¾…å®ƒä¼šè¾“å‡ºâ€œHello Worldï¼â€ã€‚</p><p>è¿™ä¸ªç¨‹åºçœ‹ä¸Šå»è¿˜æŒºåƒé‚£ä¹ˆå›äº‹çš„ï¼Œä½†å…¶å®ä¸ºé™ä½éš¾åº¦ï¼Œæˆ‘ä»¬å¯¹JavaScript/TypeScriptåšäº†æåº¦çš„ç®€åŒ–ï¼šå®ƒåªæ”¯æŒå£°æ˜å‡½æ•°å’Œè°ƒç”¨å‡½æ•°ï¼Œåœ¨æˆ‘ä»¬çš„sayHello()å‡½æ•°é‡Œï¼Œå®ƒåªèƒ½è°ƒç”¨å‡½æ•°ã€‚ä½ å¯ä»¥è°ƒç”¨ä¸€ä¸ªè‡ªå·±å£°æ˜çš„å‡½æ•°ï¼Œå¦‚fooï¼Œä¹Ÿå¯ä»¥è°ƒç”¨è¯­è¨€å†…ç½®çš„å‡½æ•°ï¼Œå¦‚ç¤ºä¾‹ä¸­çš„println()ã€‚</p><p>è¿™è¿˜ä¸å¤Ÿï¼Œä¸ºäº†è¿›ä¸€æ­¥é™ä½éš¾åº¦ï¼Œæˆ‘ä»¬çš„ç¼–è¯‘å™¨æ˜¯ä»ä¸€ä¸ªæ•°ç»„é‡Œè¯»å–ç¨‹åºï¼Œè€Œä¸æ˜¯è¯»ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ã€‚è¿™ä¸ªæ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªå•è¯ï¼Œåˆ†åˆ«æ˜¯functionã€sayHelloã€å·¦æ‹¬å·ã€å³æ‹¬å·ç­‰ç­‰ï¼Œè¿™äº›å•è¯ï¼Œæˆ‘ä»¬å«å®ƒTokenï¼Œå®ƒä»¬æ˜¯ç¨‹åºçš„æœ€å°æ„æˆå•ä½ã€‚æ³¨æ„ï¼Œæœ€åä¸€ä¸ªTokenæ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒå«åšEOFï¼Œæœ‰æ—¶ä¼šè®°åš$ï¼Œè¡¨ç¤ºç¨‹åºçš„ç»“å°¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/7a/be/7aea783003f9758f40bd3efdd2de48be.jpg?wh=1920x329\" alt=\"å›¾ç‰‡\" title=\"å›¾1ï¼šTokenä¸²ï¼ˆå›¾ä¸­ä¸åŒçš„é¢œè‰²ä»£è¡¨ä¸åŒç±»å‹çš„Tokenï¼‰\n\"></p><p>å¥½äº†ï¼Œç°åœ¨ä»»åŠ¡æ¸…æ¥šäº†ï¼Œé‚£æˆ‘ä»¬å¼€å§‹ç¬¬ä¸€æ­¥ï¼Œè§£æè¿™ä¸ªç¨‹åºã€‚</p><h2>è§£æè¿™ä¸ªç¨‹åº</h2><p>è§£æï¼Œè‹±æ–‡å«åšParseï¼Œæ˜¯æŒ‡è¯»å…¥ç¨‹åºï¼Œå¹¶å½¢æˆä¸€ä¸ªè®¡ç®—æœºå¯ä»¥ç†è§£çš„æ•°æ®ç»“æ„çš„è¿‡ç¨‹ã€‚èƒ½å¤Ÿå®Œæˆè§£æå·¥ä½œçš„ç¨‹åºï¼Œå°±å«åšè§£æå™¨ï¼ˆParserï¼‰ï¼Œå®ƒæ˜¯ç¼–è¯‘å™¨çš„ç»„æˆéƒ¨åˆ†ä¹‹ä¸€ã€‚</p><p>é‚£ä¹ˆï¼Œä»€ä¹ˆæ•°æ®ç»“æ„æ˜¯è®¡ç®—æœºèƒ½å¤Ÿç†è§£çš„å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œå…¶å®å°±æ˜¯ä¸€æ£µæ ‘ï¼Œè¿™æ£µæ ‘å«åš<strong>æŠ½è±¡è¯­æ³•æ ‘ï¼Œè‹±æ–‡ç¼©å†™æ˜¯ASTï¼ˆAbstract Syntax Treeï¼‰</strong>ã€‚é’ˆå¯¹æˆ‘ä»¬çš„ä¾‹å­ï¼Œè¿™æ£µASTæ˜¯ä¸‹é¢çš„æ ·å­ï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/c3/37/c3109f472253e98057f255f7dbf57c37.jpg?wh=1920x1080\" alt=\"å›¾ç‰‡\" title=\"å›¾2ï¼šç¤ºä¾‹ä»£ç å¯¹åº”çš„AST\"></p><p>ä½ ä»”ç»†çœ‹ä¸€ä¸‹è¿™æ£µæ ‘ï¼Œä½ ä¼šå‘ç°å®ƒè·Ÿæˆ‘ä»¬ç¨‹åºæƒ³è¡¨è¾¾çš„æ€æƒ³æ˜¯ä¸€æ ·çš„ï¼š</p><ul>\n<li>æ ¹èŠ‚ç‚¹ä»£è¡¨äº†æ•´ä¸ªç¨‹åºï¼›</li>\n<li>æ ¹èŠ‚ç‚¹æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œåˆ†åˆ«ä»£è¡¨ä¸€ä¸ªå‡½æ•°å£°æ˜å’Œä¸€ä¸ªå‡½æ•°è°ƒç”¨è¯­å¥ï¼›</li>\n<li>å‡½æ•°å£°æ˜èŠ‚ç‚¹ï¼ŒåˆåŒ…å«äº†ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œä¸€ä¸ªæ˜¯å‡½æ•°åç§°ï¼Œä¸€ä¸ªæ˜¯å‡½æ•°ä½“ï¼›</li>\n<li>å‡½æ•°ä½“ä¸­åˆåŒ…å«ä¸€ä¸ªå‡½æ•°è°ƒç”¨è¯­å¥ï¼›</li>\n<li>è€Œå‡½æ•°è°ƒç”¨è¯­å¥å‘¢ï¼Œåˆ™æ˜¯ç”±å‡½æ•°åç§°å’Œå‚æ•°åˆ—è¡¨æ„æˆçš„ï¼›</li>\n<li>â€¦â€¦</li>\n</ul><p>é€šè¿‡è¿™æ ·è‡ªé¡¶å‘ä¸‹çš„å±‚å±‚åˆ†æï¼Œä½ ä¼šå‘ç°è¿™æ£µæ ‘ç¡®å®ä½“ç°äº†æˆ‘ä»¬åŸæ¥çš„ç¨‹åºæƒ³è¡¨è¾¾çš„æ„æ€ã€‚å…¶å®ï¼Œè¿™å°±è·Ÿæˆ‘ä»¬è‡ªå·±åœ¨é˜…è¯»æ–‡ç« çš„æ—¶å€™æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬çš„å¤§è„‘ä¹Ÿæ˜¯æŠŠæ®µè½åˆ†è§£æˆå¥å­ï¼Œå†æŠŠå¥å­åˆ†è§£æˆä¸»è¯­ã€è°“è¯­ã€å®¾è¯­ç­‰ä¸€ä¸ªä¸ªè¯­æ³•å•å…ƒï¼Œæœ€ç»ˆå½¢æˆä¸€æ£µæ ‘å‹çš„ç»“æ„ï¼Œæˆ‘ä»¬çš„å¤§è„‘æ˜¯èƒ½å¤Ÿç†è§£è¿™ç§æ ‘å‹ç»“æ„çš„ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œ<strong>è§£æå™¨çš„å·¥ä½œï¼Œå°±æ˜¯è¦è¯»å–ä¸€ä¸ªTokenä¸²ï¼Œç„¶åæŠŠå®ƒè½¬æ¢æˆä¸€æ£µAST</strong>ã€‚</p><p>å¥½äº†ï¼ŒçŸ¥é“äº†è§£æçš„å·¥ä½œç›®æ ‡åï¼Œæˆ‘ä»¬å°±æ¥å®ç°è¿™ä¸ªè§£æå™¨å§ï¼</p><p>å¯æ˜¯ï¼Œè¿™æ€ä¹ˆä¸‹æ‰‹å‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥ç¢ç£¨ä¸€ä¸‹ï¼Œä½ çš„å¤§è„‘æ˜¯å¦‚ä½•ç†è§£è¿™äº›ç¨‹åºï¼Œå¹¶ä¸”æŠŠå®ƒä»¬åœ¨ä¸çŸ¥ä¸è§‰ä¹‹é—´è½¬åŒ–æˆä¸€æ£µæ ‘çš„ã€‚æˆ‘ä»¬å‡è®¾ï¼Œäººç±»çš„å¤§è„‘é‡‡ç”¨äº†ä¸€ç§è‡ªé¡¶å‘ä¸‹çš„åˆ†ææ–¹å¼ï¼Œä¹Ÿå°±æ˜¯æŠŠä¸€ä¸ªå¤§çš„è§£æä»»åŠ¡é€æ­¥åˆ†è§£æˆå°çš„ä»»åŠ¡ï¼Œè½å®åˆ°è§£æå™¨çš„å®ç°ä¸Šä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯è¯†åˆ«Tokenä¸²çš„ç‰¹å¾ï¼Œå¹¶æŠŠå®ƒè½¬æ¢æˆASTã€‚æˆ‘ä»¬æš‚æ—¶å¿½ç•¥ç»†èŠ‚ï¼Œå‡è®¾æˆ‘ä»¬èƒ½å¤ŸæˆåŠŸåœ°å®Œæˆè¿™ä¸ªè§£æï¼Œé‚£ä¹ˆæŠŠè¿™ä¸ªè§£æåŠ¨ä½œå†™æˆä»£ç ï¼Œå°±æ˜¯ï¼š</p><pre><code class=\"language-plain\">prog = parseProg()ï¼›\n</code></pre><p>æˆ‘ä»¬å†å…·ä½“ä¸€ç‚¹ï¼Œçœ‹çœ‹å®ç°parseProg()éœ€è¦åšä»€ä¹ˆäº‹æƒ…ã€‚</p><p>parseProg()éœ€è¦å»ºç«‹ç¨‹åºçš„å­èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯å‡½æ•°å£°æ˜æˆ–è€…å‡½æ•°è°ƒç”¨ã€‚æˆ‘ä»¬è§„å®šä¸€ä¸ªç¨‹åºå¯ä»¥æœ‰é›¶åˆ°å¤šä¸ªå‡½æ•°å£°æ˜æˆ–å‡½æ•°è°ƒç”¨ã€‚æˆ‘ä»¬æŠŠè¿™ä¸ªè¯­æ³•è§„åˆ™ç”¨æ¯”è¾ƒä¸¥è°¨çš„æ–¹æ³•è¡¨è¾¾å‡ºæ¥ï¼Œæ˜¯è¿™æ ·çš„ï¼š</p><pre><code class=\"language-plain\">prog = (functionDecl | functionCall)* ;\n</code></pre><p>å’¦ï¼Ÿè¿™ä¸ªè¡¨è¾¾æ–¹å¼çœ‹ä¸Šå»æœ‰ç‚¹ç†Ÿæ‚‰å‘€ï¼Ÿè¿™ä¸ªå¼å­çš„æ ¼å¼å«åšEBNFæ ¼å¼ï¼ˆæ‰©å±•å·´ç§‘æ–¯èŒƒå¼ï¼‰ã€‚ä½ å¯ä»¥çœ‹åˆ°ï¼Œå®ƒçš„å·¦è¾¹æ˜¯ä¸€ä¸ªè¯­æ³•æˆä»½çš„åç§°ï¼Œå³è¾¹è¯´çš„æ˜¯è¿™ä¸ªè¯­æ³•æˆä»½æ˜¯ç”±å“ªäº›å­æˆåˆ†æ„æˆçš„ã€‚è¿™æ ·ï¼Œæ•´ä¸ªå¼å­å°±æ„æˆäº†ä¸€æ¡è¯­æ³•è§„åˆ™ã€‚</p><p>ä¸è¿‡ï¼Œç¼–è¯‘åŸç†çš„æ•™ç§‘ä¹¦é‡Œï¼Œæœ‰æ—¶ä¼šç”¨äº§ç”Ÿå¼çš„æ ¼å¼ã€‚EBNFæ ¼å¼å’Œäº§ç”Ÿå¼æ˜¯ç­‰ä»·çš„ï¼ŒåŒºåˆ«æ˜¯äº§ç”Ÿå¼ä¸å…è®¸ä½¿ç”¨ï¼Ÿã€*å’Œ+å·ï¼Œè€Œæ˜¯ç”¨é€’å½’æ¥è¡¨ç¤ºå¤šä¸ªå…ƒç´ çš„é‡å¤ï¼Œç”¨Îµæ¥è¡¨ç¤ºä¸ç”Ÿæˆä»»ä½•å­—ç¬¦ä¸²ã€‚å¦‚æœæˆ‘ä»¬æŠŠä¸Šè¿°è¯­æ³•è§„åˆ™ç”¨äº§ç”Ÿå¼æ¥è¡¨ç¤ºçš„è¯ï¼Œç›¸å½“äºä¸‹é¢å››æ¡ï¼š</p><pre><code class=\"language-plain\">prog -&gt; statement prog\nprog -&gt; Îµ\nstatement -&gt; functionDecl\nstatement -&gt; functionCall\n</code></pre><p>ä½ é©¬ä¸Šå°±èƒ½çœ‹å‡ºæ¥ï¼Œè¿˜æ˜¯EBNFæ ¼å¼æ›´ç®€æ´å§ï¼Ÿ</p><p>å¥½äº†ï¼Œæ ¹æ®è¿™æ¡è¯­æ³•è§„åˆ™ï¼Œä¸€ä¸ªç¨‹åºè¦ä¹ˆæ˜¯ç”±å‡½æ•°å£°æ˜æ„æˆçš„ï¼Œè¦ä¹ˆæ˜¯ç”±å‡½æ•°è°ƒç”¨æ„æˆçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æŠŠå®ƒä»¬ä¸€ä¸€è§£æå‡ºæ¥ï¼Œå˜æˆprogçš„å­èŠ‚ç‚¹å°±å¥½äº†ï¼</p><p>å¯æ˜¯ï¼Œæˆ‘ä»¬å¦‚ä½•çŸ¥é“æ¥ä¸‹æ¥é‡åˆ°çš„æ˜¯å‡½æ•°å£°æ˜è¿˜æ˜¯å‡½æ•°è°ƒç”¨å‘¢ï¼Ÿ</p><p>æœ‰åŠæ³•ï¼åŠæ³•å°±æ˜¯ï¼šè¯•è¯•çœ‹ï¼</p><p>ä»€ä¹ˆå«è¯•è¯•çœ‹ï¼Ÿå°±æ˜¯å…ˆè¯•è¯•æ˜¯ä¸æ˜¯å‡½æ•°å£°æ˜ã€‚å¦‚æœæˆåŠŸçš„è¯ï¼Œè§£æå™¨å°±ä¼šè¿”å›ä¸€æ£µä»£è¡¨å‡½æ•°å£°æ˜çš„å­æ ‘ï¼›å¦‚æœä¸æˆåŠŸçš„è¯ï¼Œè§£æå™¨å°±ä¼šè¿”å›nullï¼Œç„¶åä½ å¯ä»¥å†è¯•è¯•çœ‹æ˜¯ä¸æ˜¯å‡½æ•°è°ƒç”¨ã€‚ä½ å¯èƒ½ä¼šé—®ï¼šå°±è¿™ä¹ˆç®€å•ï¼Ÿå¯¹ï¼Œå°±è¿™ä¹ˆç®€å•ã€‚</p><p>å®ç°ä¸Šè¿°é€»è¾‘çš„ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">parseProg():Prog{\n    let stmts: Statement[] = [];\n    let stmt: Statement|null|void = null;\n    while(true){  //æ¯æ¬¡å¾ªç¯è§£æä¸€ä¸ªè¯­å¥\n        //å°è¯•ä¸€ä¸‹å‡½æ•°å£°æ˜\n        stmt = this.parseFunctionDecl();\n        if (stmt != null){\n            stmts.push(stmt);  \n            continue;\n        }\n        \n        //å¦‚æœå‰ä¸€ä¸ªå°è¯•ä¸æˆåŠŸï¼Œé‚£ä¹ˆå†å°è¯•ä¸€ä¸‹å‡½æ•°è°ƒç”¨\n        stmt = this.parseFunctionCall();\n        if (stmt != null){\n            stmts.push(stmt);  \n            continue; \n        }\n\n        //å¦‚æœéƒ½æ²¡æˆåŠŸï¼Œé‚£å°±ç»“æŸ\n        if (stmt == null){\n            break;\n        }\n    }\n    return new Prog(stmts);\n}\n</code></pre><p>ç°åœ¨æˆ‘ä»¬å†å¾€ä¸‹ä¸€å±‚ï¼Œçœ‹çœ‹å¦‚ä½•è§£æå‡½æ•°å£°æ˜ã€‚</p><p>å‡½æ•°å£°æ˜åŒ…æ‹¬functionå…³é”®å­—ã€å‡½æ•°åç§°ã€ä¸€å¯¹æ‹¬å·å’Œå‡½æ•°ä½“ã€‚æˆ‘ä»¬ä¾ç„¶å°†å®ƒè¡¨è¾¾æˆè¯­æ³•è§„åˆ™ï¼Œæ˜¯è¿™æ ·çš„ï¼š</p><pre><code class=\"language-plain\">functionDecl: \"function\" Identifier \"(\" \")\"  functionBody; \n</code></pre><p>æ³¨æ„ï¼Œåœ¨è¿™ä¸ªæ–°çš„è¯­æ³•è§„åˆ™é‡Œï¼Œæˆ‘ä»¬å‘ç°äº†â€œfunctionâ€ã€â€œIdentifierâ€è¿™æ ·çš„å…ƒç´ ï¼Œè¿™äº›å…ƒç´ æ˜¯ä¸èƒ½å†å±•å¼€çš„ï¼Œæˆ‘ä»¬æŠŠå®ƒä»¬å«åšç»ˆç»“ç¬¦ã€‚ä½ ä¼šå‘ç°ï¼Œç»ˆç»“ç¬¦éƒ½æ˜¯ä»Tokenè½¬åŒ–è€Œæ¥çš„ã€‚è€Œåƒâ€œfunctionBodyâ€è¿™äº›ç”¨å°å†™å­—æ¯å¼€å¤´çš„å…ƒç´ ï¼Œè¿˜å¯ä»¥å†ç»§ç»­å±•å¼€ï¼Œæ‰€ä»¥å«åšéç»ˆç»“ç¬¦ã€‚</p><p>é‚£è¿™è¯¥æ€ä¹ˆè§£æå‘¢ï¼Ÿ</p><p>è¿˜æ˜¯å¾—æŒ¨ä¸ªå»è¯•ã€‚å…ˆè¯•ä¸€ä¸‹ç¬¬ä¸€ä¸ªTokenæ˜¯ä¸æ˜¯â€œfunctionâ€ï¼Œå†è¯•ä¸‹ç¬¬äºŒä¸ªTokenæ˜¯ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„æ ‡è¯†ç¬¦ï¼Œæ¥ç€è¯•ç¬¬ä¸‰ä¸ªTokenæ˜¯ä¸æ˜¯å·¦æ‹¬å·ï¼Œä¾æ­¤ç±»æ¨å°±è¡Œäº†ã€‚</p><p>å…¶å®ï¼Œåœ¨å‡½æ•°å£°æ˜çš„è¯­æ³•è§„åˆ™é‡Œï¼Œåƒâ€œfunctionâ€ã€â€œIdentifierâ€è¿™äº›ï¼Œéƒ½å·²ç»æ˜¯æœ€ç»ˆçš„Tokenäº†ï¼Œæ‰€ä»¥ç›´æ¥æŠŠå®ƒä»¬ä»Tokenä¸²ä¸­å–å‡ºæ¥å°±è¡Œäº†ï¼Œå…¶ä¸­â€œIdentifierâ€å˜æˆäº†ASTä¸­çš„å‡½æ•°åç§°ã€‚</p><p>è€Œå‡½æ•°å£°æ˜ä¸­çš„å¦ä¸€éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯å‡½æ•°ä½“ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„ç»“æ„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å®ƒæ‹†å‡ºæ¥å•ç‹¬å®šä¹‰ã€‚ä½“ç°åœ¨ASTä¸­ï¼Œå®ƒå°±æ˜¯å‡½æ•°å£°æ˜çš„å­èŠ‚ç‚¹ã€‚è¿™é‡Œï¼Œæˆ‘ç´¢æ€§æŠŠå‰©ä½™çš„æœ‰å…³å‡½æ•°ä½“ã€å‡½æ•°è°ƒç”¨çš„è¯­æ³•è§„åˆ™éƒ½å†™å‡ºæ¥ã€‚</p><pre><code class=\"language-plain\">functionBody : '{' functionCall* '}' ;\nfunctionCall : Identifier '(' parameterList? ')' ;\nparameterList : StringLiteral (',' StringLiteral)* ;\n</code></pre><p>è§£æä¸Šè¿°è¯­æ³•è§„åˆ™å¯¹åº”çš„ç¨‹åºå¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">/**\n     * è§£æå‡½æ•°å£°æ˜\n     * è¯­æ³•è§„åˆ™ï¼š\n     * functionDecl: \"function\" Identifier \"(\" \")\"  functionBody;\n     */\n    parseFunctionDecl():FunctionDecl|null|void{\n        let oldPos:number = this.tokenizer.position();\n        let t:Token = this.tokenizer.next();\n        if (t.kind == TokenKind.Keyword &amp;&amp; t.text == \"function\"){\n            t = this.tokenizer.next();       \n            if (t.kind == TokenKind.Identifier){\n                //è¯»å–\"(\"å’Œ\")\"\n                let t1 = this.tokenizer.next();\n                if (t1.text==\"(\"){\n                    let t2 = this.tokenizer.next();\n                    if (t2.text==\")\"){\n                        let functionBody = this.parseFunctionBody();\n                        if (functionBody != null){\n                            //å¦‚æœè§£ææˆåŠŸï¼Œä»è¿™é‡Œè¿”å›\n                            return new FunctionDecl(t.text, functionBody);\n                        }\n                    }\n                    else{\n                        console.log(\"Expecting ')' in FunctionDecl, while we got a \" + t.text);\n                        return;\n                    }\n                }\n                else{\n                    console.log(\"Expecting '(' in FunctionDecl, while we got a \" + t.text);\n                    return;\n                }            \n            }\n        }\n\n        //å¦‚æœè§£æä¸æˆåŠŸï¼Œå›æº¯ï¼Œè¿”å›nullã€‚\n        this.tokenizer.traceBack(oldPos);\n        return null;\n    }\n\n    /**\n     * è§£æå‡½æ•°ä½“\n     * è¯­æ³•è§„åˆ™ï¼š\n     * functionBody : '{' functionCall* '}' ;\n     */\n    parseFunctionBody():FunctionBody|null|void{\n        let oldPos:number = this.tokenizer.position();\n        let stmts:FunctionCall[] = [];\n        let t:Token = this.tokenizer.next();\n        if(t.text == \"{\"){\n            let functionCall = this.parseFunctionCall();\n            while(functionCall != null){  //è§£æå‡½æ•°ä½“\n                stmts.push(functionCall);\n                functionCall = this.parseFunctionCall();\n            }\n            t = this.tokenizer.next();\n            if (t.text == \"}\"){\n                return new FunctionBody(stmts);\n            }\n            else{\n                console.log(\"Expecting '}' in FunctionBody, while we got a \" + t.text);\n                return;\n            }\n        }\n        else{\n            console.log(\"Expecting '{' in FunctionBody, while we got a \" + t.text);\n            return;\n        }\n        \n        //å¦‚æœè§£æä¸æˆåŠŸï¼Œå›æº¯ï¼Œè¿”å›nullã€‚\n        this.tokenizer.traceBack(oldPos);\n        return null;\n    }\n\n    /**\n     * è§£æå‡½æ•°è°ƒç”¨\n     * è¯­æ³•è§„åˆ™ï¼š\n     * functionCall : Identifier '(' parameterList? ')' ;\n     * parameterList : StringLiteral (',' StringLiteral)* ;\n     */\n    parseFunctionCall():FunctionCall|null|void{\n        let oldPos:number = this.tokenizer.position();\n        let params:string[] = [];\n        let t:Token = this.tokenizer.next();\n        if(t.kind == TokenKind.Identifier){\n            let t1:Token = this.tokenizer.next();\n            if (t1.text == \"(\"){\n                let t2:Token = this.tokenizer.next();\n                //å¾ªç¯ï¼Œè¯»å‡ºæ‰€æœ‰\n                while(t2.text != \")\"){\n                    if (t2.kind == TokenKind.StringLiteral){\n                        params.push(t2.text);\n                    }\n                    else{\n                        console.log(\"Expecting parameter in FunctionCall, while we got a \" + t2.text);\n                        return;  //å‡ºé”™æ—¶ï¼Œå°±ä¸åœ¨é”™è¯¯å¤„å›æº¯äº†ã€‚\n                    }\n                    t2 = this.tokenizer.next();\n                    if (t2.text != \")\"){\n                        if (t2.text == \",\"){\n                            t2 = this.tokenizer.next();\n                        }\n                        else{\n                            console.log(\"Expecting a comma in FunctionCall, while we got a \" + t2.text);\n                            return;\n                        }\n                    }\n                }\n                //æ¶ˆåŒ–æ‰ä¸€ä¸ªåˆ†å·ï¼š;\n                t2 = this.tokenizer.next();\n                if (t2.text == \";\"){\n                    return new FunctionCall(t.text, params);\n                }\n                else{\n                    console.log(\"Expecting a comma in FunctionCall, while we got a \" + t2.text);\n                    return;\n                }\n            }\n        }\n\n        //å¦‚æœè§£æä¸æˆåŠŸï¼Œå›æº¯ï¼Œè¿”å›nullã€‚\n        this.tokenizer.traceBack(oldPos);\n        return null;\n    }\n}\n</code></pre><p>åˆ°è¿™é‡Œä½ ä¼šå‘ç°ï¼Œæˆ‘ä»¬åšè¯­æ³•åˆ†æçš„æ€è·¯å¾ˆç®€å•ï¼š</p><ul>\n<li><strong>é¦–å…ˆï¼Œå†™å‡ºè¯­æ³•è§„åˆ™</strong>ï¼Œæ¯”å¦‚è¯´ç”¨EBNFæ ¼å¼ã€‚</li>\n<li><strong>ç¬¬äºŒï¼Œæ ¹æ®è¯­æ³•è§„åˆ™ï¼Œåˆ†åˆ«åŒ¹é…æ¯ä¸ªå­å…ƒç´ ã€‚</strong>å¦‚æœè¿™ä¸ªè¯­æ³•è§„åˆ™ä¸­ç”¨åˆ°äº†å¦ä¸€ä¸ªè¯­æ³•è§„åˆ™ï¼Œå°±åƒå‡½æ•°å£°æ˜é‡Œç”¨åˆ°äº†å‡½æ•°ä½“ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦é€’å½’åœ°åŒ¹é…è¿™æ¡è¯­æ³•è§„åˆ™ã€‚è¿™ä¸ªå±‚å±‚ä¸‹é™çš„åŒ¹é…è¿‡ç¨‹ï¼Œå«åšâ€œ<strong>é€’å½’ä¸‹é™ï¼ˆRecursive Descentï¼‰</strong>â€ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬åˆšåˆšé‡‡ç”¨çš„ç®—æ³•ï¼ŒJavaã€V8ç­‰å¾ˆå¤šç¼–è¯‘å™¨ä¹Ÿéƒ½é‡‡ç”¨äº†è¿™ä¸ªé€’å½’ä¸‹é™ç®—æ³•ã€‚</li>\n<li><strong>ç¬¬ä¸‰ï¼Œå¦‚æœä¸€æ¡è¯­æ³•è§„åˆ™å¯èƒ½æœ‰å¤šä¸ªå±•å¼€æ–¹å¼</strong>ï¼Œå°±åƒç¨‹åºé‡Œé¢æ—¢å¯ä»¥æ˜¯å‡½æ•°å£°æ˜ï¼Œä¹Ÿå¯ä»¥æ˜¯å‡½æ•°è°ƒç”¨ï¼Œ<strong>é‚£ä¹ˆæˆ‘ä»¬å°±è¦ä¾æ¬¡å°è¯•å»åŒ¹é…</strong>ã€‚å¦‚æœå°è¯•å¤±è´¥ï¼Œå°±å›é€€ï¼Œå†å»å°è¯•å¦ä¸€ä¸ªå±•å¼€æ–¹å¼ã€‚</li>\n</ul><p>å¥½äº†ï¼Œä½ ä¹ŸçŸ¥é“äº†ï¼Œæˆ‘ä»¬åˆšæ‰ç”¨åˆ°çš„æ–¹æ³•å°±æ˜¯å¤§åé¼é¼çš„â€œé€’å½’ä¸‹é™ç®—æ³•â€ã€‚å½“ç„¶ï¼Œè¿™æ˜¯å®ƒçš„åˆçº§ç‰ˆæœ¬ï¼Œä¼šå­˜åœ¨ä¸€äº›ç¼ºé™·ï¼Œè¿™ä¸ªæˆ‘ä»¬åé¢ä¼šè®²ã€‚ä¸è¿‡ï¼Œå³ä½¿æ˜¯åƒJDKé‡Œçš„Javaç¼–è¯‘å™¨ã€V8çš„JaveScriptç¼–è¯‘å™¨ã€Goè¯­è¨€çš„ç¼–è¯‘å™¨è¿™äº›æˆç†Ÿçš„ç¼–è¯‘å™¨ï¼Œé‡‡ç”¨çš„éƒ½æ˜¯é€’å½’ä¸‹é™ç®—æ³•ï¼Œæ‰€ä»¥ä½ åº”è¯¥è¶³å¤Ÿé‡è§†å®ƒã€‚</p><h2>åšä¸€ç‚¹ç®€å•çš„è¯­ä¹‰åˆ†æ</h2><p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»å®Œæˆäº†è¯­æ³•åˆ†æå·¥ä½œï¼Œå¹¶å½¢æˆäº†ASTã€‚ä½†æ˜¯ï¼Œåœ¨è§£é‡Šæ‰§è¡Œè¿™ä¸ªç¨‹åºä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜è¦åšä¸€ç‚¹å¾®å°çš„å·¥ä½œï¼šå°±æ˜¯<strong>å¼•ç”¨æ¶ˆè§£ï¼ˆRefrence Resolvingï¼‰</strong>ã€‚</p><p>è¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p><p>åœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­æœ‰ä¸¤å¤„å‡½æ•°è°ƒç”¨ï¼šä¸€å¤„æ˜¯println()ï¼Œæˆ‘ä»¬ç°åœ¨æŠŠå®ƒçœ‹åšå†…ç½®å‡½æ•°å°±å¥½äº†ï¼Œè€Œå¦ä¸€å¤„ï¼Œæ˜¯è°ƒç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„å‡½æ•°sayHello()ã€‚é‚£ä¹ˆ<strong>å¼•ç”¨æ¶ˆè§£ï¼Œå°±æ˜¯æŠŠå‡½æ•°çš„è°ƒç”¨å’Œå‡½æ•°çš„å®šä¹‰å…³è”åˆ°ä¸€èµ·</strong>ï¼Œå¦åˆ™ï¼Œç¨‹åºå°±æ²¡æ³•æ­£å¸¸è¿è¡Œã€‚ç”±äºæˆ‘ä»¬ç›®å‰çš„è¯­è¨€å¾ˆç®€å•ï¼Œæ‰€ä»¥å¼•ç”¨æ¶ˆè§£å·¥ä½œä¹Ÿå¾ˆç®€å•ï¼Œä½ å¯ä»¥çœ‹çœ‹ä¸‹é¢çš„å‚è€ƒä»£ç ï¼š</p><pre><code class=\"language-plain\">//éå†progä¸­çš„æ‰€æœ‰è¯­å¥ï¼Œæ‰¾åˆ°ä¸€ä¸ªåç§°åŒ¹é…çš„å‡½æ•°å£°æ˜\nprivate findFunctionDecl(prog:Prog, name:string):FunctionDecl|null{\n    for(let x of prog?.stmts){\n        let functionDecl = x as FunctionDecl;\n        if (typeof functionDecl.body === 'object' &amp;&amp; \n            functionDecl.name == name){\n            return functionDecl;\n        }\n    }\n    return null;\n}\n</code></pre><p>å¼•ç”¨æ¶ˆè§£æ˜¯è¯­ä¹‰åˆ†æè¿‡ç¨‹ä¸­å¿…é¡»è¦åšçš„ä¸€é¡¹å·¥ä½œï¼Œå…¶ä»–æ›´å¤šçš„è¯­ä¹‰åˆ†æå·¥ä½œæˆ‘ä»¬ä»ç„¶å¯ä»¥å¿½ç•¥ã€‚åšå®Œäº†è¯­ä¹‰åˆ†æä»¥åï¼ŒASTä¸Šå¢åŠ äº†ä¸€äº›ä¿¡æ¯ï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/31/f0/3136fc4f3d74f607e0edc9454d71e6f0.jpg?wh=1920x1080\" alt=\"å›¾ç‰‡\" title=\"å›¾3ï¼šåœ¨ASTå¢åŠ äº†å¼•ç”¨ä¿¡æ¯ï¼Œå¯ä»¥æ‰¾åˆ°å‡½æ•°çš„å®šä¹‰\"><br>\nåœ¨ä¸Šå›¾ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°å¯¹sayHello()å‡½æ•°åšè°ƒç”¨çš„ASTèŠ‚ç‚¹ï¼ŒæŒ‡å‘äº†sayHelloçš„å‡½æ•°å£°æ˜èŠ‚ç‚¹ã€‚è¿™æ ·ï¼Œåœ¨è§£é‡Šå™¨é‡Œæ‰§è¡ŒsayHello()çš„æ—¶å€™ï¼Œå°±èƒ½æ‰¾åˆ°è¯¥æ‰§è¡Œä»€ä¹ˆä»£ç äº†ï¼</p><h2>åšä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨æ¥è¿è¡Œè¿™ä¸ªç¨‹åº</h2><p>å¥½äº†ï¼Œå®Œæˆå¥½ä¸Šé¢å„é¡¹å‡†å¤‡å·¥ä½œï¼Œæ¥ä¸‹æ¥è¦å®ç°è§£é‡Šå™¨äº†ã€‚</p><p>è§£é‡Šå™¨æ€ä¹ˆè¿è¡Œå‘¢ï¼Ÿå¾ˆç®€å•ï¼Œè‡ªé¡¶å‘ä¸‹ã€æ·±åº¦ä¼˜å…ˆåœ°éå†ä¸€ä¸‹ASTå°±è¡Œäº†ã€‚</p><p>å…·ä½“è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/0e/ff/0e90bfdb9ec8fb4dc1866025d72d18ff.jpg?wh=1920x1080\" alt=\"å›¾ç‰‡\" title=\"å›¾4ï¼šé€šè¿‡éå†ASTæ¥è§£é‡Šæ‰§è¡Œç¨‹åº\"><br>\nç¬¬1æ­¥ï¼Œæˆ‘ä»¬è¦æ¥è®¿é—®progèŠ‚ç‚¹ã€‚</p><p>ç¬¬2æ­¥ï¼Œæ¥ç€è®¿é—®progçš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹çš„ï¼Œä½†è¿™ä¸ªå­èŠ‚ç‚¹æ˜¯ä¸€ä¸ªå‡½æ•°å£°æ˜ï¼Œå‡½æ•°å£°æ˜æ˜¯ä¸èƒ½ç›´æ¥è¿è¡Œçš„ï¼Œæ‰€ä»¥æ­¤æ—¶è®¿é—®è¿™ä¸ªèŠ‚ç‚¹ä¸ä¼šäº§ç”Ÿä»»ä½•åŠ¨ä½œã€‚</p><p>ç¬¬3æ­¥ï¼Œè®¿é—®progçš„ç¬¬äºŒä¸ªå­èŠ‚ç‚¹ã€‚è¿™ä¸ªå­èŠ‚ç‚¹æ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œç”±äºæˆ‘ä»¬å·²ç»åšäº†å¼•ç”¨æ¶ˆè§£ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“è¿™ä¸ªå‡½æ•°åœ¨ASTä¸­çš„ä½ç½®äº†ã€‚</p><p>ç¬¬4æ­¥ï¼Œæˆ‘ä»¬è¦è·³åˆ°å‡½æ•°å®šä¹‰çš„ä½ç½®å»æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œç„¶ååœ¨ç¬¬5æ­¥ä¸­æ‰§è¡Œè¿™ä¸ªå‡½æ•°çš„å‡½æ•°ä½“ã€‚</p><p>ç¬¬6æ­¥ï¼Œæˆ‘ä»¬å†æ‰§è¡Œå‡½æ•°ä½“çš„ä¸‹ä¸€çº§èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯println(â€œHello Worldâ€)ã€‚è¿™å®é™…ä¸Šæ˜¯è°ƒç”¨ä¸€ä¸ªå†…ç½®å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬æŠŠâ€œHello Worldâ€ä½œä¸ºå‚æ•°ä¼ é€’ç»™å†…ç½®å‡½æ•°å°±è¡Œäº†ã€‚</p><p>åˆ°æ­¤ï¼Œç¨‹åºæ‰§è¡Œå®Œæ¯•ï¼Œè¾“å‡ºäº†â€œHello Worldâ€ã€‚</p><p>ä¸ºäº†åŠ æ·±ä½ çš„ç†è§£ï¼Œæˆ‘å†ä¸¾ä¸€ä¸ªä¾‹å­ã€‚</p><p>å‡å¦‚æˆ‘ä»¬çš„è¯­è¨€ç°åœ¨å·²ç»æ”¯æŒè¡¨è¾¾å¼äº†ï¼Œé‚£ä¹ˆå¯¹äº2+3*5è¿™æ ·ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè§£æå™¨ä¹Ÿä¼šè‡ªåŠ¨å½¢æˆä¸€æ£µASTã€‚è¿™æ—¶ï¼Œå¯¹è¡¨è¾¾å¼æ±‚å€¼çš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯éå†ASTçš„è¿‡ç¨‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/3c/ae/3cf0eb845e3e03f54b81a14ffe7cc9ae.jpg?wh=1920x917\" alt=\"å›¾ç‰‡\" title=\"å›¾5ï¼šé€šè¿‡éå†ASTæ¥è®¡ç®—è¡¨è¾¾å¼çš„å€¼ï¼ˆå›¾ä¸­æ ‡å·ï¼Œæ˜¯å®Œå…¨è®¿é—®å®Œæ¯•ä¸€æ£µå­æ ‘çš„é¡ºåºï¼‰\"></p><h2>è¯¾ç¨‹å°ç»“</h2><p>å¥½äº†ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ä»Šå¤©çš„å…¨éƒ¨å†…å®¹äº†ã€‚è™½ç„¶æˆ‘ä»¬åšäº†å¾ˆå¤šçš„ç®€åŒ–ï¼Œä½†æˆ‘ä»¬æ¯•ç«Ÿå·²ç»èƒ½è®©ä¸€ä¸ªç¨‹åºè¿è¡Œèµ·æ¥äº†ã€‚ä½ è¿˜å¯ä»¥æŠŠç¤ºä¾‹ç¨‹åºæ”¹å†™ä¸€ä¸‹ï¼Œæ¯”å¦‚å¤šå†™å‡ ä¸ªè‡ªå®šä¹‰çš„å‡½æ•°ï¼Œå¤šåšå‡ ä¸ªå‡½æ•°è°ƒç”¨ï¼Œæ‰“å°å‡ºè°ƒç”¨è¿‡ç¨‹ï¼Œç­‰ç­‰ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨ä¸‹é¢çš„ç¤ºä¾‹ç¨‹åºä¸­ï¼Œæˆ‘åˆæ–°å£°æ˜äº†ä¸€ä¸ªå‡½æ•°barï¼Œå¹¶åœ¨barä¸­è°ƒç”¨fooï¼Œæ£€éªŒä¸€ä¸‹å¤šçº§å‡½æ•°è°ƒç”¨æ˜¯å¦ä¼šæ­£å¸¸è¿è¡Œã€‚</p><pre><code class=\"language-plain\">function foo(){\n  println(\"in foo...\");\n}\n\nfunction bar(){\n  println(\"in bar...\");\n  foo();\n}\n\nbar();\n</code></pre><p>ä½ çœ‹ï¼Œè™½ç„¶æˆ‘ä»¬çš„ç¨‹åºç‰¹æ€§å¾ˆå°‘ï¼Œä½†æ¯•ç«Ÿèƒ½ç©èµ·æ¥äº†ã€‚ä½ åªè¦éµå®ˆè¯­è¨€çš„ç‰¹æ€§ï¼Œç¼–å†™å‡ºæ¥çš„ä»»æ„ç¨‹åºéƒ½æ˜¯èƒ½æ­£ç¡®æ‰§è¡Œçš„ï¼Œè¿™å°±æ˜¯è®¡ç®—æœºè¯­è¨€æœ€æœ‰é­…åŠ›çš„åœ°æ–¹ï¼è€Œä¸”ï¼Œä½ ä¹Ÿå¯ä»¥äº²æ‰‹å®ç°ã€‚</p><p>æˆ‘ç»™ä½ æŠŠè¿™èŠ‚è¯¾çš„è¦ç‚¹æ€»ç»“ä¸€ä¸‹ï¼š</p><ul>\n<li>è¦å®ç°ä¸€é—¨è®¡ç®—æœºè¯­è¨€ï¼Œé¦–å…ˆè¦æœ‰ä¸€ä¸ªç¼–è¯‘å™¨æ¥æŠŠç¨‹åºè½¬åŒ–æˆè®¡ç®—æœºå¯ç†è§£çš„æ•°æ®ï¼ˆè¿™é‡Œæ˜¯ASTï¼‰ï¼Œç„¶åéœ€è¦æœ‰ä¸€ä¸ªè§£é‡Šå™¨æ¥æ‰§è¡Œå®ƒã€‚</li>\n<li>ç¼–è¯‘å™¨æœ‰å¾ˆå¤šåŠŸèƒ½ï¼Œè¯æ³•åˆ†æåŠŸèƒ½åœ¨è¿™è®²è¢«æˆ‘ä»¬æ•…æ„è·³è¿‡äº†ã€‚åœ¨è¯­æ³•åˆ†æéƒ¨åˆ†ï¼Œæˆ‘ä»¬äº†è§£äº†å¦‚ä½•ç”¨EBNFæ ¼å¼æ¥è¡¨è¾¾è¯­æ³•è§„åˆ™ï¼Œå¹¶åˆæ­¥ä»‹ç»äº†é€’å½’ä¸‹é™ç®—æ³•ï¼›åœ¨è¯­ä¹‰åˆ†æéƒ¨åˆ†ï¼Œæˆ‘ä»¬åšäº†å‡½æ•°çš„å¼•ç”¨æ¶ˆè§£ã€‚</li>\n<li>æˆ‘ä»¬å½“å‰ç‰ˆæœ¬çš„è§£é‡Šå™¨ï¼Œæ˜¯é€šè¿‡éå†ASTæ¥è¿è¡Œç¨‹åºçš„ï¼Œæ–¹ä¾¿ä½ ç†è§£åŸç†ã€‚åœ¨åé¢çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šæŠŠASTè½¬æ¢æˆæ›´é€‚åˆè§£é‡Šæ‰§è¡Œçš„ä¸­é—´ä»£ç ï¼ˆIntermediate Representationï¼ŒIRï¼‰ï¼Œå°±åƒJavaçš„å­—èŠ‚ç ä¸€æ ·ï¼Œç„¶åæˆ‘ä»¬å†å®ç°ä¸€ä¸ªæ–°çš„è§£é‡Šå™¨ã€‚</li>\n</ul><p>è¿™èŠ‚è¯¾æˆ‘ä»¬å¿½ç•¥äº†å¾ˆå¤šæŠ€æœ¯ç»†èŠ‚ï¼Œåˆ«æ‹…å¿ƒï¼Œä¹‹åçš„è¯¾ç¨‹ï¼Œæˆ‘ä»¬ä¼šä¸€ä¸€è¡¥ä¸Šè¿™äº›çŸ¥è¯†ç‚¹ï¼Œè®©ä½ å¹³æ»‘åœ°å­¦åˆ°å®ç°ä¸€é—¨è¯­è¨€çš„æ‰€æœ‰æŠ€èƒ½ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æˆ‘ä»¬ä»Šå¤©çš„è¯¾ç¨‹å°±åˆ°è¿™é‡Œäº†ï¼Œæˆ‘ç»™ä½ å¸ƒç½®äº†ä¸¤ä¸ªæ€è€ƒé¢˜æ¥å·©å›ºä¸‹ä»Šå¤©å­¦ä¹ çš„å†…å®¹ã€‚</p><p>é—®é¢˜1ï¼šåœ¨è¿™èŠ‚è¯¾è®²è¿°çš„è¯­æ³•è§„åˆ™ä¸­ï¼Œæˆ‘ä»¬åšäº†ä¸€äº›ç®€åŒ–ï¼Œæ¯”å¦‚åœ¨å‡½æ•°å£°æ˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ç®¡å‚æ•°ã€‚å¦‚æœåŠ ä¸Šå‚æ•°ï¼Œä½ ä¼šæ€æ ·æ”¹å†™ä¸€ä¸‹è¯­æ³•è§„åˆ™å‘¢ï¼Ÿå¦å¤–ï¼Œæˆ‘ä»¬ç›®å‰ç”¨çš„è¿˜æ˜¯JavaScriptçš„è¯­æ³•ï¼Œå¦‚æœæ”¹æˆTypeScriptçš„è¯­æ³•ï¼Œå¸¦ä¸Šç±»å‹å£°æ˜ï¼Œè¯­æ³•è§„åˆ™åˆä¼šæ˜¯ä»€ä¹ˆæ ·å­å‘¢ï¼Ÿä½ å¯ä»¥ç»ƒä¹ ä¸€ä¸‹ã€‚</p><p>é—®é¢˜2ï¼šåœ¨ä»Šå¤©çš„è¯¾ç¨‹é‡Œï¼Œæˆ‘ä»¬çš„è¯­æ³•åˆ†æçš„ç®—æ³•æ˜¯â€œé€’å½’ä¸‹é™â€ç®—æ³•ã€‚ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰å‘ç°ï¼Œæˆ‘ä»¬çš„ç¨‹åºé‡Œå¹¶æ²¡æœ‰å‡ºç°å‡½æ•°çš„é€’å½’è°ƒç”¨å‘€ï¼Œä¸ºä»€ä¹ˆè¿˜è¦è¯´å®ƒæ˜¯é€’å½’çš„å‘¢ï¼Ÿ</p><p>æ„Ÿè°¢ä½ å’Œæˆ‘ä¸€èµ·å­¦ä¹ ï¼Œå¦‚æœä½ è§‰å¾—æˆ‘è¿™èŠ‚è¯¾è®²å¾—è¿˜ä¸é”™ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠå®ƒåˆ†äº«ç»™æ›´å¤šå¯¹ç¼–ç¨‹è¯­è¨€æ„Ÿå…´è¶£çš„æœ‹å‹ã€‚æˆ‘æ˜¯å®«æ–‡å­¦ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ã€‚</p><h2>èµ„æºé“¾æ¥</h2><p><a href=\"https://gitee.com/richard-gong/craft-a-language/blob/master/01/play.ts\">è¿™èŠ‚è¯¾çš„ç¤ºä¾‹ä»£ç åœ¨è¿™é‡Œï¼</a></p>","comments":[{"had_liked":false,"id":306380,"user_name":"é’ç‰ç™½éœ²","can_delete":false,"product_type":"c1","uid":2619436,"ip_address":"","ucode":"96FE2D4D2B94A0","user_header":"https://static001.geekbang.org/account/avatar/00/27/f8/2c/92969c48.jpg","comment_is_top":false,"comment_ctime":1628519848,"is_pvip":false,"replies":[{"id":"111000","content":"å¤šè°¢æ”¯æŒï¼","user_name":"ä½œè€…å›å¤","comment_id":306380,"uid":"1543380","ip_address":"","utype":1,"ctime":1628644422,"user_name_real":"å®«æ–‡å­¦Richard"}],"discussion_count":1,"race_medal":0,"score":"23103356328","product_id":100085201,"comment_content":"è¿™é—¨è¯¾æˆ‘è¿½å®šäº†ï¼å®«è€å¸ˆåŠ ç´§æ›´æ–°å“ˆï¼Œå†…å®¹å¾ˆèµ","like_count":5,"discussions":[{"author":{"id":1543380,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8c/d4/5972b7cc.jpg","nickname":"å®«æ–‡å­¦Richard","note":"","ucode":"09EADF0CB62C91","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524736,"discussion_content":"å¤šè°¢æ”¯æŒï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628644422,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":306646,"user_name":"å¼ è´º","can_delete":false,"product_type":"c1","uid":1283181,"ip_address":"","ucode":"0254E40FB3EB5F","user_header":"https://static001.geekbang.org/account/avatar/00/13/94/6d/5cd6e8c7.jpg","comment_is_top":false,"comment_ctime":1628655487,"is_pvip":true,"discussion_count":2,"race_medal":0,"score":"18808524671","product_id":100085201,"comment_content":"ä»£ç ä¸­RefResolverä¸­çš„visitFunctionBodyæ–¹æ³•ä¸åº”è¯¥returnå§","like_count":4,"discussions":[{"author":{"id":1628867,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIicr82CnrdEjibibAvyeKRQHszSzIAqoCWxN0kqC442XcjEae6S9j6NDtKLpg4Da4CUQQeUFUicWqiaDw/132","nickname":"æœ‰å­¦è¯†çš„å…”å­","note":"","ucode":"D1D654B1562FC9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388703,"discussion_content":"æ˜¯åº”è¯¥å»æ‰ï¼Œå‡½æ•°ä½“å¯èƒ½æœ‰å¤šä¸ªå‡½æ•°è°ƒç”¨ï¼Œéƒ½éœ€è¦éå†æ¥è¿›è¡Œå¼•ç”¨æ¶ˆè§£ï¼Œåªå¤„ç†ä¸€ä¸ªå°±è¿”å›æ˜¯ä¸å¯¹çš„ã€‚ä¸è¿‡demoé‡Œå‡½æ•°ä½“å†…å°±ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œæ‰€ä»¥ä¹Ÿä¸å½±å“demoçš„å±•ç¤ºç»“æœã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1628920104,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1074098,"avatar":"https://static001.geekbang.org/account/avatar/00/10/63/b2/9223bc53.jpg","nickname":"Fenix","note":"","ucode":"AA8C1EECDFD405","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391034,"discussion_content":"èµåŒï¼Œ\n\nfunction foo(){\n  println(&#34;in foo...&#34;);\n}\n\nfunction bar(){\n  println(&#34;in bar...&#34;);\n  foo();\n}\n\nbar();\n\nä½†æ˜¯å¦‚æœæ˜¯è¿™ä¸ªdemoçš„è¯ï¼Œå°±åº”è¯¥æŠŠreturnå»æ‰çš„ã€‚ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630238275,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":316316,"user_name":"è¢«è®¨åŒçš„å‹‡æ°”","can_delete":false,"product_type":"c1","uid":1547913,"ip_address":"","ucode":"AE3B3CA27D91A2","user_header":"https://static001.geekbang.org/account/avatar/00/17/9e/89/6e9c05d6.jpg","comment_is_top":false,"comment_ctime":1634266985,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14519168873","product_id":100085201,"comment_content":"é€’å½’æ€æƒ³ï¼Œåœ¨ç¨‹åºä¸­å¸¸è§çš„å®ç°æ˜¯ï¼šè‡ªå·±è°ƒç”¨è‡ªå·±ï¼Œå³å‡½æ•°è°ƒç”¨è‡ªèº«ã€‚<br>é€’å½’æ€æƒ³çš„æœ¬ä¹‰æ˜¯ï¼šå°†ä¸€ä¸ªå¤æ‚é—®é¢˜åˆ†è§£æˆè§„æ¨¡è¾ƒå°çš„å‡ ä¸ªå­é—®é¢˜ã€‚ä»é€’å½’æ€æƒ³çš„è§’åº¦æ¥çœ‹ï¼Œé€’å½’ä¸‹é™ç®—æ³•å°†è¯­æ³•åˆ†æåˆ†è§£ä¸ºå‡½æ•°å£°æ˜åˆ†æã€å‡½æ•°è°ƒç”¨åˆ†æï¼Œä¸”å­é—®é¢˜å¯ä»¥è¿›ä¸€æ­¥åˆ†è§£ï¼Œæ‰€ä»¥ç§°ä¹‹ä¸ºâ€œé€’å½’â€ã€‚","like_count":3},{"had_liked":false,"id":307518,"user_name":"å¥‹æ–—çš„èœ—ç‰›","can_delete":false,"product_type":"c1","uid":2326308,"ip_address":"","ucode":"F4324049E3F717","user_header":"https://static001.geekbang.org/account/avatar/00/23/7f/24/ceab0e7b.jpg","comment_is_top":false,"comment_ctime":1629129182,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10219063774","product_id":100085201,"comment_content":"æœŸå¾…åé¢åç«¯çš„å†…å®¹ï¼Œä¸€ç›´å¡åœ¨è¿™å—ï¼Œæ‰¾ä¸åˆ°å­¦ä¹ çš„æ€è·¯ï¼Œè€å¸ˆæ°´å¹³çœŸé«˜ï¼Œæ·±å…¥æµ…å‡ºï¼ï¼","like_count":2},{"had_liked":false,"id":309174,"user_name":"Geek_9a1bc6","can_delete":false,"product_type":"c1","uid":2731718,"ip_address":"","ucode":"0D1FCC50D9D580","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJZa7kzYIicRuA6vXj9J0zVHpJI1mIrxhUZXYu2zLn32egqlOroO2M4qYzSFqhmUibUIicHDCqqsaHkg/132","comment_is_top":false,"comment_ctime":1629968667,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5924935963","product_id":100085201,"comment_content":"ä»£ç nodeå‘½ä»¤æ‰§è¡Œæ²¡é—®é¢˜ï¼Œç”¨tscå‘½ä»¤ç¼–è¯‘æŠ¥é”™ï¼š Type &#39;void&#39; is not assignable to type &#39;FunctionCall&#39;. æœ‰æ²¡æœ‰é‡åˆ°çš„ç«¥é‹ï¼Ÿ","like_count":1},{"had_liked":false,"id":308227,"user_name":"Juude","can_delete":false,"product_type":"c1","uid":1183409,"ip_address":"","ucode":"9B793A5952433E","user_header":"https://static001.geekbang.org/account/avatar/00/12/0e/b1/9ec5c110.jpg","comment_is_top":false,"comment_ctime":1629458872,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5924426168","product_id":100085201,"comment_content":"è¯·é—®ä»£ç ä¿®æ”¹åæ€ä¹ˆè¿è¡Œå‘¢","like_count":1},{"had_liked":false,"id":306472,"user_name":"å…¨å›½ç¬¬ä¸€èœ","can_delete":false,"product_type":"c1","uid":1118602,"ip_address":"","ucode":"CBB341155DE21F","user_header":"https://static001.geekbang.org/account/avatar/00/11/11/8a/534b3c2d.jpg","comment_is_top":false,"comment_ctime":1628575069,"is_pvip":false,"replies":[{"id":"110995","content":"è°¢è°¢è‚¯å®šï¼ŒåŠ æ²¹ï¼","user_name":"ä½œè€…å›å¤","comment_id":306472,"uid":"1543380","ip_address":"","utype":1,"ctime":1628644071,"user_name_real":"å®«æ–‡å­¦Richard"}],"discussion_count":1,"race_medal":0,"score":"5923542365","product_id":100085201,"comment_content":"å¶ç„¶é—´ä¹ å¾—å®«è€å¸ˆçš„å‰ä¸¤é—¨è¯¾ï¼Œå¦‚è·è‡³å®ï¼Œå¯¹ä¸ªäººæå‡æ˜¾è‘—ã€‚ä»Šå¤©çœ‹åˆ°å¼€æ–°è¯¾äº†ï¼Œç¬¬ä¸€æ—¶é—´æ¥æ”¯æŒï¼Œå› ä¸ºçŸ¥é“è‡ªå·±åˆè¦å˜å¼ºäº†ï¼ï¼åŠ æ²¹","like_count":1,"discussions":[{"author":{"id":1543380,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8c/d4/5972b7cc.jpg","nickname":"å®«æ–‡å­¦Richard","note":"","ucode":"09EADF0CB62C91","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524781,"discussion_content":"è°¢è°¢è‚¯å®šï¼ŒåŠ æ²¹ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628644071,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":306466,"user_name":"ğŸ‡µ ğŸ‡¦ ğŸ‡³ ğŸ‡© ğŸ‡¦","can_delete":false,"product_type":"c1","uid":2623263,"ip_address":"","ucode":"2BD3EEABB860EF","user_header":"https://static001.geekbang.org/account/avatar/00/28/07/1f/fd9e757f.jpg","comment_is_top":false,"comment_ctime":1628572856,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5923540152","product_id":100085201,"comment_content":"å¤ªç‰›äº†ï¼","like_count":1},{"had_liked":false,"id":359810,"user_name":"blue","can_delete":false,"product_type":"c1","uid":1447292,"ip_address":"å¹¿ä¸œ","ucode":"BC183E857A0B8D","user_header":"https://static001.geekbang.org/account/avatar/00/16/15/7c/2d8d0778.jpg","comment_is_top":false,"comment_ctime":1665927784,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1665927784","product_id":100085201,"comment_content":"è€å¸ˆï¼Œå›¾5é‚£ä¸ªASTéå†ã€‚ â€œè¿”å›4â€æ˜¯ä¸æ˜¯æœ‰é—®é¢˜ï¼Œä¸æ˜¯åº”è¯¥â€œè¿”å›3â€å—","like_count":0},{"had_liked":false,"id":356916,"user_name":"if...else...","can_delete":false,"product_type":"c1","uid":2550743,"ip_address":"æµ™æ±Ÿ","ucode":"D0565908C99695","user_header":"https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg","comment_is_top":false,"comment_ctime":1662701578,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1662701578","product_id":100085201,"comment_content":"astçš„æ·±åº¦ä¼˜å…ˆéå†ï¼Œä¸€èˆ¬å°±æ˜¯ç”¨é€’å½’çš„ã€‚","like_count":0},{"had_liked":false,"id":353741,"user_name":"åŠŸå¤«ç†ŠçŒ«","can_delete":false,"product_type":"c1","uid":2732243,"ip_address":"æ±Ÿè‹","ucode":"D124F4FA4E816F","user_header":"https://static001.geekbang.org/account/avatar/00/29/b0/d3/200e82ff.jpg","comment_is_top":false,"comment_ctime":1659720446,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1659720446","product_id":100085201,"comment_content":"é€’å½’çš„æœ¬è´¨è¿˜æ˜¯å°†ä¸€ä¸ªå¤æ‚çš„å¤§é—®é¢˜è½¬æ¢ä¸ºå°é—®é¢˜ã€‚å›æœ”å’ŒåŠ¨æ€è§„åˆ’éƒ½æ˜¯ä¹Ÿæ˜¯è¿™ä¸ªæ„æ€ã€‚è€Œä¸”ä¸€èˆ¬çš„é€’å½’ç¨‹åºæ˜¯å¯ä»¥æ”¹ä¸ºç”¨æ ˆæˆ–è€…é˜Ÿåˆ—å®ç°çš„","like_count":0},{"had_liked":false,"id":331840,"user_name":"Geek_9a1bc6","can_delete":false,"product_type":"c1","uid":2731718,"ip_address":"","ucode":"0D1FCC50D9D580","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJZa7kzYIicRuA6vXj9J0zVHpJI1mIrxhUZXYu2zLn32egqlOroO2M4qYzSFqhmUibUIicHDCqqsaHkg/132","comment_is_top":false,"comment_ctime":1642819946,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1642819946","product_id":100085201,"comment_content":"è¿™ä¸ªè§„åˆ™ï¼š<br><br>functionDecl: &quot;function&quot; Identifier &quot;(&quot; &quot;)&quot;  functionBody; <br><br>å’Œantlrçš„g4æ–‡ä»¶çš„è¯­æ³•è§„åˆ™æ˜¯ä¸€æ ·çš„ï¼Ÿ","like_count":0},{"had_liked":false,"id":307279,"user_name":"äº”æœ¨è€ç¥–","can_delete":false,"product_type":"c1","uid":2027798,"ip_address":"","ucode":"92AF53B434C99C","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f1/16/9eda1d16.jpg","comment_is_top":false,"comment_ctime":1629000802,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1629000802","product_id":100085201,"comment_content":"å¥½åƒè¿˜æ˜¯æ²¡æœ‰æ˜ç™½tokenæ€ä¹ˆè½¬æ¢ä¸ºAstçš„ã€‚","like_count":0,"discussions":[{"author":{"id":1547913,"avatar":"https://static001.geekbang.org/account/avatar/00/17/9e/89/6e9c05d6.jpg","nickname":"è¢«è®¨åŒçš„å‹‡æ°”","note":"","ucode":"AE3B3CA27D91A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":404245,"discussion_content":"ASTï¼ŒæŠ½è±¡è¯­æ³•æ ‘ï¼Œè¿™é‡Œçš„æ ‘ç»“æ„ä¸å¸¸è§çš„æ•°æ®ç»“æ„æ ‘ä¸åŒã€‚æˆ‘ä»¬å¸¸è§çš„æ•°æ®ç»“æ„æ ‘ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯åŒä¸€ç»“æ„ä½“ nodeï¼Œè¿™ AST æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸åŒçš„ç»“æ„ä½“ï¼Œæ¯”å¦‚ Progã€FunctionDecl ç­‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634267283,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":307078,"user_name":"haha","can_delete":false,"product_type":"c1","uid":2623098,"ip_address":"","ucode":"E8F99449B78882","user_header":"https://static001.geekbang.org/account/avatar/00/28/06/7a/9a60b72f.jpg","comment_is_top":false,"comment_ctime":1628850999,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1628850999","product_id":100085201,"comment_content":"å°‘printlnï¼Œç›®å‰cloneä¸‹æ¥çš„ä»£ç æ˜¯ä¸æ˜¯è¿˜ä¸èƒ½æ­£å¸¸æ‰§è¡Œï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1146704,"avatar":"https://static001.geekbang.org/account/avatar/00/11/7f/50/3e952cfa.jpg","nickname":"é’å±±","note":"","ucode":"8B12013E2A6171","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":401208,"discussion_content":"çœ‹ä½œè€…ç»™çš„ä»£ç  https://gitee.com/richard-gong/craft-a-language/blob/master/01/play.ts ï¼Œè¿™ä¸ª println æ˜¯ä½œä¸ºå†…ç½®å‡½æ•°å®ç°çš„ï¼Œé‡Œé¢è°ƒç”¨äº† console.log()ã€‚TS åŸç”Ÿåº”è¯¥æ˜¯ä¸æ”¯æŒ println çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633602661,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1527329,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoc8sReia18fc3LgNBcL1lQ1OfdcNvSNPichaiccDHxNG4Arx21CjgrZJG2y8KibniaLlbibtOo53qEEnAw/132","nickname":"Hezhen","note":"","ucode":"C8C0AAA23D3302","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":400943,"discussion_content":"æˆ‘ä¹Ÿé‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œè¯·é—®æ€ä¹ˆè§£å†³çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633495258,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":306872,"user_name":"haha","can_delete":false,"product_type":"c1","uid":2623098,"ip_address":"","ucode":"E8F99449B78882","user_header":"https://static001.geekbang.org/account/avatar/00/28/06/7a/9a60b72f.jpg","comment_is_top":false,"comment_ctime":1628759843,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1628759843","product_id":100085201,"comment_content":"class FunctionCall extends Statement{<br>    name: string;<br>    parameters: string[];<br>    definition: FunctionDecl | null = null; &#47;&#47;æŒ‡å‘å‡½æ•°çš„å£°æ˜<br>    constructor(name:string, parameters: string[]){<br>        super();<br>        this.name = name;<br>        this.parameters = parameters;<br>    }<br>    public dump(prefix:string){<br>        console.log(prefix+&quot;FunctionCall&quot;+this.name+(this.definition!=null?&quot;,resolved&quot; : &quot;not resolved&quot;));<br>        this.parameters.forEach(x =&gt; console.log(prefix+&quot;\\t&quot;+&quot;Parameter&quot;+x));<br>    }<br>}<br>è¯·é—®åŒå­¦ä»¬ï¼š<br>forEach ä¸­çš„xä»£è¡¨çš„æ˜¯string[]çš„æ¯ä¸€ä¸ªparameterå—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2623098,"avatar":"https://static001.geekbang.org/account/avatar/00/28/06/7a/9a60b72f.jpg","nickname":"haha","note":"","ucode":"E8F99449B78882","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388937,"discussion_content":"è°¢è°¢ï¼æˆ‘ç°åœ¨æ˜¯ä¸ªå°ç™½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629074333,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1318243,"avatar":"https://static001.geekbang.org/account/avatar/00/14/1d/63/62078f19.jpg","nickname":"å¼ å›½æ——","note":"","ucode":"AF519777AB262E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388624,"discussion_content":"å¯¹\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628855722,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":306775,"user_name":"æœ‰å­¦è¯†çš„å…”å­","can_delete":false,"product_type":"c1","uid":1628867,"ip_address":"","ucode":"D1D654B1562FC9","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIicr82CnrdEjibibAvyeKRQHszSzIAqoCWxN0kqC442XcjEae6S9j6NDtKLpg4Da4CUQQeUFUicWqiaDw/132","comment_is_top":false,"comment_ctime":1628697181,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1628697181","product_id":100085201,"comment_content":"é—®é¢˜2:å±‚å±‚ä¸‹é™çš„åŒ¹é…è¿‡ç¨‹ï¼Œæ˜¯â€œé€’å½’ä¸‹é™â€ã€‚ç¨‹åºä¸­è™½ç„¶æ²¡æœ‰é€’å½’è°ƒç”¨ï¼Œä½†æœ‰whileè¯­å¥å¾ªç¯è°ƒç”¨åŒä¸€ä¸ªå‡½æ•°ï¼Œæ˜¯ä¸æ˜¯é€’å½’è°ƒç”¨ä¸€ç§æ”¹å†™ï¼Ÿè¿™æ ·å®ç°è‡ªæˆ‘è°ƒç”¨ï¼ŒåŒæ—¶ä¸åƒé€’å½’è°ƒç”¨æ¶ˆè€—è¿‡å¤§çš„æ ˆç©ºé—´ï¼Ÿ","like_count":0},{"had_liked":false,"id":306754,"user_name":"æœ‰å­¦è¯†çš„å…”å­","can_delete":false,"product_type":"c1","uid":1628867,"ip_address":"","ucode":"D1D654B1562FC9","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIicr82CnrdEjibibAvyeKRQHszSzIAqoCWxN0kqC442XcjEae6S9j6NDtKLpg4Da4CUQQeUFUicWqiaDw/132","comment_is_top":false,"comment_ctime":1628690857,"is_pvip":false,"replies":[{"id":"111130","content":"è°¢è°¢è‚¯å®šï¼Œä¸€èµ·Fightingï¼","user_name":"ä½œè€…å›å¤","comment_id":306754,"uid":"1543380","ip_address":"","utype":1,"ctime":1628762008,"user_name_real":"å®«æ–‡å­¦Richard"}],"discussion_count":1,"race_medal":0,"score":"1628690857","product_id":100085201,"comment_content":"ç»™å®«è€å¸ˆç‚¹èµï¼Œè€å¸ˆæä¾›å‡ºæ¥çš„è¯¾ç¨‹éƒ½æ˜¯å¤¯å®ç¼–ç¨‹èƒ½åŠ›çš„çŸ¥è¯†ã€‚å·¥ä½œä¸­åŠŸèƒ½ä¸šåŠ¡å›´ç»•ä¸šåŠ¡å±•å¼€ï¼ŒåŸºäºæˆç†Ÿçš„æ¡†æ¶è®¾è®¡æ¨¡å¼åšåŠŸèƒ½å¼€å‘æˆ–å±€éƒ¨ä¼˜åŒ–ï¼Œè¿‡ç¨‹ä¸­ä¹Ÿéšçº¦æ„Ÿå—ç¼ºå¤±å¯¹ç¼–ç¨‹ä¸–ç•Œæ•´ä½“äº†è§£å¸¦æ¥çš„éº»çƒ¦ã€‚ä¹‹å‰ä¹Ÿå­¦ä¹ äº†ä¸€ç‚¹ç‚¹å®«è€å¸ˆã€Šç¼–è¯‘åŸç†ä¹‹ç¾ã€‹ï¼Œå¾ˆåº†å¹¸æ„Ÿå—è¿™é—¨å®æˆ˜è¯¾ã€‚Fighting !","like_count":0,"discussions":[{"author":{"id":1543380,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8c/d4/5972b7cc.jpg","nickname":"å®«æ–‡å­¦Richard","note":"","ucode":"09EADF0CB62C91","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524900,"discussion_content":"è°¢è°¢è‚¯å®šï¼Œä¸€èµ·Fightingï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628762008,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":306576,"user_name":"_______R","can_delete":false,"product_type":"c1","uid":1979948,"ip_address":"","ucode":"419DE0EE06FA66","user_header":"https://static001.geekbang.org/account/avatar/00/1e/36/2c/34bacff9.jpg","comment_is_top":false,"comment_ctime":1628611797,"is_pvip":false,"replies":[{"id":"111035","content":"å¯ä»¥å‘€ã€‚ä½ å»ºä¸€ä¸ªè‡ªå·±çš„ä»“åº“ï¼Œå¯ä»¥æŠŠé“¾æ¥åˆ†äº«å‡ºæ¥ï¼","user_name":"ä½œè€…å›å¤","comment_id":306576,"uid":"1543380","ip_address":"","utype":1,"ctime":1628652299,"user_name_real":"å®«æ–‡å­¦Richard"}],"discussion_count":2,"race_medal":0,"score":"1628611797","product_id":100085201,"comment_content":"å®«è€å¸ˆï¼Œæˆ‘ä¹‹å‰çœ‹è¿‡ä¸€ç‚¹ç‚¹ tsï¼Œç°åœ¨ä¸»å­¦ goï¼Œä»Šå¤©åˆšæŠŠ 01 çš„ä»£ç ç”¨ go é‡å†™ï¼Œå¯ä»¥æäº¤åˆ°ç äº‘ä¸Šå—","like_count":0,"discussions":[{"author":{"id":1543380,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8c/d4/5972b7cc.jpg","nickname":"å®«æ–‡å­¦Richard","note":"","ucode":"09EADF0CB62C91","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524816,"discussion_content":"å¯ä»¥å‘€ã€‚ä½ å»ºä¸€ä¸ªè‡ªå·±çš„ä»“åº“ï¼Œå¯ä»¥æŠŠé“¾æ¥åˆ†äº«å‡ºæ¥ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628652299,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1979948,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/36/2c/34bacff9.jpg","nickname":"_______R","note":"","ucode":"419DE0EE06FA66","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389163,"discussion_content":"https://gitee.com/Boii/craft-a-language-goï¼Œè¿™æ˜¯ä»“åº“åœ°å€ï¼Œå¦‚æœå¯ä»¥çš„è¯æˆ‘æƒ³ fork æ‚¨çš„ä»“åº“å¹¶æ–°å»ºä¸€ä¸ª go åˆ†æ”¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629163608,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":306478,"user_name":"qinsi","can_delete":false,"product_type":"c1","uid":1667175,"ip_address":"","ucode":"090D9C4068FF12","user_header":"https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg","comment_is_top":false,"comment_ctime":1628578791,"is_pvip":true,"replies":[{"id":"110998","content":"æ²¡é—®é¢˜ï¼Œä½ å¯ä»¥ä¿®æ”¹ä¼˜åŒ–ä¸€ä¸‹ã€‚<br>äº‹å®ä¸Šï¼Œåœ¨åé¢çš„ç« èŠ‚ä¸­ï¼Œè¿™äº›ä»£ç çš„ç»“æ„å°±ä¿®æ”¹äº†ï¼Œå˜æˆäº†ç›´çº¿å¼çš„ä»£ç ï¼ŒåŒæ—¶å¢åŠ äº†è¯­æ³•é”™è¯¯çš„å¤„ç†èƒ½åŠ›ã€‚<br>è¿™ä¸€èŠ‚çš„ä»£ç ï¼Œæ˜¯ä¸ºäº†å°½é‡é¿å…å¤ªå¤šåŠŸèƒ½ï¼Œå°½é‡é¿å…å¤æ‚åŒ–ã€‚","user_name":"ä½œè€…å›å¤","comment_id":306478,"uid":"1543380","ip_address":"","utype":1,"ctime":1628644373,"user_name_real":"å®«æ–‡å­¦Richard"}],"discussion_count":1,"race_medal":0,"score":"1628578791","product_id":100085201,"comment_content":"ifåµŒå¥—çœ‹ç€è„‘é˜”ç–¼ï¼Œå»ºè®®æ‰©å……tokenç±»å‹ï¼Œå¢åŠ ä¸€äº›helperæ–¹æ³•ï¼š<br><br>```typescript<br>  &#47;**<br>   * è§£æå‡½æ•°è°ƒç”¨ <br>   * è¯­æ³•è§„åˆ™:<br>   * functionCall = Identifier &quot;(&quot; parameterList? &quot;)&quot; &quot;;&quot;<br>   * parameterList = StringLiteral (&quot;,&quot; StringLiteral)*<br>   *&#47;<br>  private parseFunctionCall(): FunctionCall | undefined {<br>    if (!this.hasNext(TokenKind.Identifier)) return;<br><br>    const funcName = this.consume(TokenKind.Identifier);<br><br>    this.consume(TokenKind.LParen);<br><br>    const params = [];<br>    if (this.hasNext(TokenKind.StringLiteral)) {<br>      params.push(this.consume(TokenKind.StringLiteral));<br><br>      while (this.hasConsumed(TokenKind.Comma)) {<br>        params.push(this.consume(TokenKind.StringLiteral));<br>      }<br>    }<br><br>    this.consume(TokenKind.RParen);<br><br>    this.consume(TokenKind.Semi);<br><br>    return new FunctionCall(funcName, params);<br>  }<br>}<br>```<br>","like_count":0,"discussions":[{"author":{"id":1543380,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8c/d4/5972b7cc.jpg","nickname":"å®«æ–‡å­¦Richard","note":"","ucode":"09EADF0CB62C91","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524785,"discussion_content":"æ²¡é—®é¢˜ï¼Œä½ å¯ä»¥ä¿®æ”¹ä¼˜åŒ–ä¸€ä¸‹ã€‚\näº‹å®ä¸Šï¼Œåœ¨åé¢çš„ç« èŠ‚ä¸­ï¼Œè¿™äº›ä»£ç çš„ç»“æ„å°±ä¿®æ”¹äº†ï¼Œå˜æˆäº†ç›´çº¿å¼çš„ä»£ç ï¼ŒåŒæ—¶å¢åŠ äº†è¯­æ³•é”™è¯¯çš„å¤„ç†èƒ½åŠ›ã€‚\nè¿™ä¸€èŠ‚çš„ä»£ç ï¼Œæ˜¯ä¸ºäº†å°½é‡é¿å…å¤ªå¤šåŠŸèƒ½ï¼Œå°½é‡é¿å…å¤æ‚åŒ–ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628644373,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":306474,"user_name":"åƒæ— ","can_delete":false,"product_type":"c1","uid":1813715,"ip_address":"","ucode":"C43C9D532AE50A","user_header":"https://static001.geekbang.org/account/avatar/00/1b/ac/d3/3e461046.jpg","comment_is_top":false,"comment_ctime":1628577107,"is_pvip":true,"replies":[{"id":"110993","content":"éå¸¸å¥½ï¼Œè¿™é—¨è¯¾å°±æ˜¯æå€¡åŠ¨æ‰‹å®è·µçš„ï¼","user_name":"ä½œè€…å›å¤","comment_id":306474,"uid":"1543380","ip_address":"","utype":1,"ctime":1628644042,"user_name_real":"å®«æ–‡å­¦Richard"}],"discussion_count":1,"race_medal":0,"score":"1628577107","product_id":100085201,"comment_content":"å¾ˆèµï¼Œè¯¾åä¹ é¢˜ä¸€å®šè¦åšï¼Œè¿™æ‰æ˜¯è¿™é—¨è¯¾çš„ç²¾é«“ï¼Œå®è·µå®ƒæŒæ¡å®ƒï¼Œè¯¾å°±è¶…å€¼","like_count":0,"discussions":[{"author":{"id":1543380,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8c/d4/5972b7cc.jpg","nickname":"å®«æ–‡å­¦Richard","note":"","ucode":"09EADF0CB62C91","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524783,"discussion_content":"éå¸¸å¥½ï¼Œè¿™é—¨è¯¾å°±æ˜¯æå€¡åŠ¨æ‰‹å®è·µçš„ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628644042,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}