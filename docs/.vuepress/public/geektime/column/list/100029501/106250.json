{"id":106250,"title":"13丨什么是存储过程，在实际项目中用得多么？","content":"<p>上一节我介绍了视图，它是SQL中的一个重要应用，使用视图对SQL查询进行封装，可以让SQL的代码结构更清晰，让用户权限管理更安全。</p><p>今天我来讲一下SQL的存储过程，它是SQL中另一个重要应用，和视图一样，都是对SQL代码进行封装，可以反复利用。它和视图有着同样的优点，清晰、安全，还可以减少网络传输量。不过它和视图不同，视图是虚拟表，通常不对底层数据表直接操作，而存储过程是程序化的SQL，可以直接操作底层数据表，相比于面向集合的操作方式，能够实现一些更复杂的数据处理。存储过程可以说是由SQL语句和流控制语句构成的语句集合，它和我们之前学到的函数一样，可以接收输入参数，也可以返回输出参数给调用者，返回计算结果。</p><p>今天有关存储过程的内容，你将重点掌握以下几个部分：</p><ol>\n<li>什么是存储过程，如何创建一个存储过程？</li>\n<li>流控制语句都有哪些，如何使用它们？</li>\n<li>各大公司是如何看待存储过程的？在实际工作中，我们该如何使用存储过程？</li>\n</ol><h2>什么是存储过程，如何创建一个存储过程</h2><p>存储过程的英文是Stored Procedure。它的思想很简单，就是SQL语句的封装。一旦存储过程被创建出来，使用它就像使用函数一样简单，我们直接通过调用存储过程名即可。我在前面讲过，存储过程实际上由SQL语句和流控制语句共同组成。流控制语句都有哪些呢？这个我稍后讲解。</p><!-- [[[read_end]]] --><p>我们先来看下如何定义一个存储过程：</p><pre><code>CREATE PROCEDURE 存储过程名称([参数列表])\nBEGIN\n    需要执行的语句\nEND    \n</code></pre><p>在这里，我们使用CREATE PROCEDURE创建一个存储过程，后面是存储过程的名称，以及过程所带的参数，可以包括输入参数和输出参数。最后由BEGIN和END来定义我们所要执行的语句块。</p><p>和视图一样，我们可以删除已经创建的存储过程，使用的是DROP PROCEDURE。如果要更新存储过程，我们需要使用ALTER PROCEDURE。</p><p>讲完了如何创建，更新和删除一个存储过程，下面我们来看下如何实现一个简单的存储过程。比如我想做一个累加运算，计算1+2+…+n等于多少，我们可以通过参数n来表示想要累加的个数，那么如何用存储过程实现这一目的呢？这里我做一个add_num的存储过程，具体的代码如下：</p><pre><code>CREATE PROCEDURE `add_num`(IN n INT)\nBEGIN\n       DECLARE i INT;\n       DECLARE sum INT;\n       \n       SET i = 1;\n       SET sum = 0;\n       WHILE i &lt;= n DO\n              SET sum = sum + i;\n              SET i = i +1;\n       END WHILE;\n       SELECT sum;\nEND\n</code></pre><p>当我们需要再次使用这个存储过程的时候，直接使用 <code>CALL add_num(50);</code>即可。这里我传入的参数为50，也就是统计1+2+…+50的积累之和，查询结果为：</p><p><img src=\"https://static001.geekbang.org/resource/image/e4/1e/e4e29b71160980a9208c8da4dc2a6f1e.png?wh=220*121\" alt=\"\"><br>\n这就是一个简单的存储过程，除了理解1+2+…+n的实现过程，还有两点你需要理解，一个是DELIMITER定义语句的结束符，另一个是存储过程的三种参数类型。</p><p>我们先来看下DELIMITER的作用。如果你使用Navicat这个工具来管理MySQL执行存储过程，那么直接执行上面这段代码就可以了。如果用的是MySQL，你还需要用DELIMITER来临时定义新的结束符。因为默认情况下SQL采用（；）作为结束符，这样当存储过程中的每一句SQL结束之后，采用（；）作为结束符，就相当于告诉SQL可以执行这一句了。但是存储过程是一个整体，我们不希望SQL逐条执行，而是采用存储过程整段执行的方式，因此我们就需要临时定义新的DELIMITER，新的结束符可以用（//）或者（$$）。如果你用的是MySQL，那么上面这段代码，应该写成下面这样：</p><pre><code>DELIMITER //\nCREATE PROCEDURE `add_num`(IN n INT)\nBEGIN\n       DECLARE i INT;\n       DECLARE sum INT;\n       \n       SET i = 1;\n       SET sum = 0;\n       WHILE i &lt;= n DO\n              SET sum = sum + i;\n              SET i = i +1;\n       END WHILE;\n       SELECT sum;\nEND //\nDELIMITER ;\n</code></pre><p>首先我用（//）作为结束符，又在整个存储过程结束后采用了（//）作为结束符号，告诉SQL可以执行了，然后再将结束符还原成默认的（;）。</p><p>需要注意的是，如果你用的是Navicat工具，那么在编写存储过程的时候，Navicat会自动设置DELIMITER为其他符号，我们不需要再进行DELIMITER的操作。</p><p>我们再来看下存储过程的3种参数类型。在刚才的存储过程中，我们使用了IN类型的参数，另外还有OUT类型和INOUT类型，作用如下：</p><p><img src=\"https://static001.geekbang.org/resource/image/8c/29/8c12ca959dbc6cfe1d62459481454429.png?wh=1016*323\" alt=\"\"><br>\nIN和OUT的结合，既用于存储过程的传入参数，同时又可以把计算结果放到参数中，调用者可以得到返回值。</p><p>你能看到，IN参数必须在调用存储过程时指定，而在存储过程中修改该参数的值不能被返回。而OUT参数和INOUT参数可以在存储过程中被改变，并可返回。</p><p>举个例子，这里会用到我们之前讲过的王者荣耀的英雄数据表heros。假设我想创建一个存储类型get_hero_scores，用来查询某一类型英雄中的最大的最大生命值，最小的最大魔法值，以及平均最大攻击值，那么该怎么写呢？</p><pre><code>CREATE PROCEDURE `get_hero_scores`(\n       OUT max_max_hp FLOAT,\n       OUT min_max_mp FLOAT,\n       OUT avg_max_attack FLOAT,  \n       s VARCHAR(255)\n       )\nBEGIN\n       SELECT MAX(hp_max), MIN(mp_max), AVG(attack_max) FROM heros WHERE role_main = s INTO max_max_hp, min_max_mp, avg_max_attack;\nEND\n</code></pre><p>你能看到我定义了4个参数类型，其中3个为OUT类型，分别为max_max_hp、min_max_mp和avg_max_attack，另一个参数s为IN类型。</p><p>这里我们从heros数据表中筛选主要英雄定位为s的英雄数据，即筛选条件为role_main=s，提取这些数据中的最大的最大生命值，最小的最大魔法值，以及平均最大攻击值，分别赋值给变量max_max_hp、min_max_mp和avg_max_attack。</p><p>然后我们就可以调用存储过程，使用下面这段代码即可：</p><pre><code>CALL get_hero_scores(@max_max_hp, @min_max_mp, @avg_max_attack, '战士');\nSELECT @max_max_hp, @min_max_mp, @avg_max_attack;\n</code></pre><p>运行结果：</p><p><img src=\"https://static001.geekbang.org/resource/image/7f/e9/7f059f3cb9c345530c67db42af5d04e9.png?wh=825*117\" alt=\"\"></p><h2>流控制语句</h2><p>流控制语句是用来做流程控制的，我刚才讲了两个简单的存储过程的例子，一个是1+2+…+n的结果计算，一个是王者荣耀的数据查询，你能看到这两个例子中，我用到了下面的流控制语句：</p><ol>\n<li>BEGIN…END：BEGIN…END中间包含了多个语句，每个语句都以（;）号为结束符。</li>\n<li>DECLARE：DECLARE用来声明变量，使用的位置在于BEGIN…END语句中间，而且需要在其他语句使用之前进行变量的声明。</li>\n<li>SET：赋值语句，用于对变量进行赋值。</li>\n<li>SELECT…INTO：把从数据表中查询的结果存放到变量中，也就是为变量赋值。</li>\n</ol><p>除了上面这些用到的流控制语句以外，还有一些常用的流控制语句：</p><p>1.IF…THEN…ENDIF：条件判断语句，我们还可以在IF…THEN…ENDIF中使用ELSE和ELSEIF来进行条件判断。<br>\n2.CASE：CASE语句用于多条件的分支判断，使用的语法是下面这样的。</p><pre><code>CASE \n\tWHEN expression1 THEN ...\n\tWHEN expression2 THEN ...\n\t...\n    ELSE \n    --ELSE语句可以加，也可以不加。加的话代表的所有条件都不满足时采用的方式。\nEND\n</code></pre><p>3.LOOP、LEAVE和ITERATE：LOOP是循环语句，使用LEAVE可以跳出循环，使用ITERATE则可以进入下一次循环。如果你有面向过程的编程语言的使用经验，你可以把LEAVE理解为BREAK，把ITERATE理解为CONTINUE。<br>\n4.REPEAT…UNTIL…END REPEAT：这是一个循环语句，首先会执行一次循环，然后在UNTIL中进行表达式的判断，如果满足条件就退出，即END REPEAT；如果条件不满足，则会就继续执行循环，直到满足退出条件为止。<br>\n5.WHILE…DO…END WHILE：这也是循环语句，和REPEAT循环不同的是，这个语句需要先进行条件判断，如果满足条件就进行循环，如果不满足条件就退出循环。</p><p>我们之前说过SQL是声明型语言，使用SQL就像在使用英语，简单直接。今天讲的存储过程，尤其是在存储过程中使用到的流控制语句，属于过程性语言，类似于C++语言中函数，这些语句可以帮我们解决复杂的业务逻辑。</p><h2>关于存储过程使用的争议</h2><p>尽管存储过程有诸多优点，但是对于存储过程的使用，一直都存在着很多争议，比如有些公司对于大型项目要求使用存储过程，而有些公司在手册中明确禁止使用存储过程，为什么这些公司对存储过程的使用需求差别这么大呢？</p><p>我们得从存储过程的特点来找答案。</p><p>你能看到存储过程有很多好处。</p><p>首先存储过程可以一次编译多次使用。存储过程只在创造时进行编译，之后的使用都不需要重新编译，这就提升了SQL的执行效率。其次它可以减少开发工作量。将代码封装成模块，实际上是编程的核心思想之一，这样可以把复杂的问题拆解成不同的模块，然后模块之间可以重复使用，在减少开发工作量的同时，还能保证代码的结构清晰。还有一点，存储过程的安全性强，我们在设定存储过程的时候可以设置对用户的使用权限，这样就和视图一样具有较强的安全性。最后它可以减少网络传输量，因为代码封装到存储过程中，每次使用只需要调用存储过程即可，这样就减少了网络传输量。同时在进行相对复杂的数据库操作时，原本需要使用一条一条的SQL语句，可能要连接多次数据库才能完成的操作，现在变成了一次存储过程，只需要连接一次即可。</p><p>基于上面这些优点，不少大公司都要求大型项目使用存储过程，比如微软、IBM等公司。但是国内的阿里并不推荐开发人员使用存储过程，这是为什么呢？</p><p>存储过程虽然有诸如上面的好处，但缺点也是很明显的。</p><p>它的可移植性差，存储过程不能跨数据库移植，比如在MySQL、Oracle和SQL Server里编写的存储过程，在换成其他数据库时都需要重新编写。</p><p>其次调试困难，只有少数DBMS支持存储过程的调试。对于复杂的存储过程来说，开发和维护都不容易。</p><p>此外，存储过程的版本管理也很困难，比如数据表索引发生变化了，可能会导致存储过程失效。我们在开发软件的时候往往需要进行版本管理，但是存储过程本身没有版本控制，版本迭代更新的时候很麻烦。</p><p>最后它不适合高并发的场景，高并发的场景需要减少数据库的压力，有时数据库会采用分库分表的方式，而且对可扩展性要求很高，在这种情况下，存储过程会变得难以维护，增加数据库的压力，显然就不适用了。</p><p>了解了存储过程的优缺点之后，我想说的是，存储过程既方便，又有局限性。尽管不同的公司对存储过程的态度不一，但是对于我们开发人员来说，不论怎样，掌握存储过程都是必备的技能之一。</p><p><img src=\"https://static001.geekbang.org/resource/image/54/9f/54a0d3b0c0e5336c1da6fc84c909a49f.jpg?wh=2376*2313\" alt=\"\"><br>\n最后我们做一个小练习吧。针对王者荣耀的英雄数据表heros表，请编写存储过程get_sum_score，用来得到某一类型英雄（主要定位为某一类型即可）的最大生命值的总和。</p><p>欢迎你在评论区写下你的答案，也欢迎把这篇文章分享给你的朋友或者同事，一起交流一下。</p>","neighbors":{"left":{"article_title":"12丨视图在SQL中的作用是什么，它是怎样工作的？","id":105643},"right":{"article_title":"14丨什么是事务处理，如何使用COMMIT和ROLLBACK进行操作？","id":107143}},"comments":[{"had_liked":false,"id":112254,"user_name":"捞鱼的搬砖奇","can_delete":false,"product_type":"c1","uid":1021539,"ip_address":"","ucode":"2FD194C4DA26E5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/96/63/7eb32c9b.jpg","comment_is_top":false,"comment_ctime":1562691411,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"147591579475","product_id":100029501,"comment_content":"DELIMITER &#47;&#47;<br>create procedure `get_sum_score`(IN roleMain VARCHAR(255),OUT total FLOAT)<br>BEGIN<br>select sum(hp_max) as sum_hp_max from heros where role_main=roleMain INTO total;<br>END&#47;&#47;<br>DELIMITER ;<br><br>call get_sum_score(&#39;坦克&#39;,@total);<br>select @total","like_count":34},{"had_liked":false,"id":113168,"user_name":"毛豆","can_delete":false,"product_type":"c1","uid":1547185,"ip_address":"","ucode":"7D838CA50D044D","user_header":"https://static001.geekbang.org/account/avatar/00/17/9b/b1/74b04ee6.jpg","comment_is_top":false,"comment_ctime":1562906690,"is_pvip":false,"replies":[{"id":"41206","content":"可以 考虑在进阶篇加一篇关于存储过程的使用。这个在工作中还比较常用","user_name":"作者回复","comment_id":113168,"uid":"1306094","ip_address":"","utype":1,"ctime":1562920012,"user_name_real":"cy"}],"discussion_count":2,"race_medal":0,"score":"61692448834","product_id":100029501,"comment_content":"存储过程很重要，可不可以详细讲讲","like_count":14,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458089,"discussion_content":"可以 考虑在进阶篇加一篇关于存储过程的使用。这个在工作中还比较常用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562920012,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1508654,"avatar":"https://static001.geekbang.org/account/avatar/00/17/05/2e/5a6b6b6e.jpg","nickname":"Fortune","note":"","ucode":"6B9465AC996523","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":299744,"discussion_content":"进阶篇也在这个课程吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597804596,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":144478,"user_name":"半瓶醋","can_delete":false,"product_type":"c1","uid":1282746,"ip_address":"","ucode":"8C898E244D0417","user_header":"https://static001.geekbang.org/account/avatar/00/13/92/ba/9833f06f.jpg","comment_is_top":false,"comment_ctime":1571933537,"is_pvip":true,"replies":[{"id":"63770","content":"Good Job 对的 不是单引号","user_name":"作者回复","comment_id":144478,"uid":"1306094","ip_address":"","utype":1,"ctime":1577540916,"user_name_real":"cy"}],"discussion_count":6,"race_medal":0,"score":"57406508385","product_id":100029501,"comment_content":"注意：CREATE PROCEDURE `get_sum_score`这里不是单引号，是` `号哦~<br># 编写存储过程get_sum_score，用来得到某一类型英雄的最大生命值的总和<br><br>CREATE PROCEDURE `get_sum_score`(<br>        OUT sum_max_hp FLOAT,<br>        IN s VARCHAR(255)<br>    )<br>BEGIN<br>    SELECT<br>        sum(hp_max)<br>    FROM heros <br>    WHERE role_main = s<br>    INTO sum_max_hp;<br>END<br><br># 调用存储过程<br>CALL get_sum_score(@sum_max_hp,&#39;战士&#39;)<br>SELECT @sum_max_hp;","like_count":14,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471964,"discussion_content":"Good Job 对的 不是单引号","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577540916,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1868570,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/83/1a/f9d9225f.jpg","nickname":"欧阳啊","note":"","ucode":"CF1D0F0802713B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":188017,"discussion_content":"很感谢这个提醒","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1582788347,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1170379,"avatar":"https://static001.geekbang.org/account/avatar/00/11/db/cb/58f4b5d2.jpg","nickname":"萌面赵先生","note":"","ucode":"CC51AB1C925E13","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":171936,"discussion_content":"CALL get_sum_score(@sum_max_hp,&#39;战士&#39;);","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1581760285,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1330305,"avatar":"https://static001.geekbang.org/account/avatar/00/14/4c/81/34398512.jpg","nickname":"PCC","note":"","ucode":"BA27B7737E232B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1170379,"avatar":"https://static001.geekbang.org/account/avatar/00/11/db/cb/58f4b5d2.jpg","nickname":"萌面赵先生","note":"","ucode":"CC51AB1C925E13","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":561148,"discussion_content":"第一句CALL的最后也需要加; 号，我就说我调试了半天，为什么一直报语法错误！多谢指出！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649561672,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":171936,"ip_address":""},"score":561148,"extra":""}]},{"author":{"id":1172090,"avatar":"https://static001.geekbang.org/account/avatar/00/11/e2/7a/38a27e47.jpg","nickname":"蓦然回首","note":"","ucode":"B17658DCFE6402","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348361,"discussion_content":"只测试过MYSQL8.0","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612525198,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1172090,"avatar":"https://static001.geekbang.org/account/avatar/00/11/e2/7a/38a27e47.jpg","nickname":"蓦然回首","note":"","ucode":"B17658DCFE6402","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348360,"discussion_content":"不加也可以，直接写名称，也能创建成功","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612525181,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":155824,"user_name":"番茄","can_delete":false,"product_type":"c1","uid":1583667,"ip_address":"","ucode":"7354EEB2D8A43D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTICAILuSqtnAfl1zcgRWIULia2nbjzlybTEQJUMT68KPj80BicwQyibAK3Icxp4qwC03LqrtvfX0fbZg/132","comment_is_top":false,"comment_ctime":1574761589,"is_pvip":false,"replies":[{"id":"62616","content":"CALL get_hero_scores(@max_max_hp, @min_max_mp, @avg_max_attack, &#39;战士&#39;); 这里是把结果放到max_max_hp, min_max_mp, avg_max_attack 这三个变量中进行返回，如果要显示出来结果，可以使用：SELECT @max_max_hp, @min_max_mp, @avg_max_attack;","user_name":"作者回复","comment_id":155824,"uid":"1306094","ip_address":"","utype":1,"ctime":1577077884,"user_name_real":"cy"}],"discussion_count":1,"race_medal":0,"score":"48819401845","product_id":100029501,"comment_content":"请教下老师或者各位小伙伴，调用程序这里，直接call就出结果了，下面那句select为什么要加上呢<br><br>CALL get_hero_scores(@max_max_hp, @min_max_mp, @avg_max_attack, &#39;战士&#39;);<br>SELECT @max_max_hp, @min_max_mp, @avg_max_attack;","like_count":11,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475888,"discussion_content":"CALL get_hero_scores(@max_max_hp, @min_max_mp, @avg_max_attack, &amp;#39;战士&amp;#39;); 这里是把结果放到max_max_hp, min_max_mp, avg_max_attack 这三个变量中进行返回，如果要显示出来结果，可以使用：SELECT @max_max_hp, @min_max_mp, @avg_max_attack;","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577077884,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":146568,"user_name":"高志强","can_delete":false,"product_type":"c1","uid":1276563,"ip_address":"","ucode":"68737002043752","user_header":"https://static001.geekbang.org/account/avatar/00/13/7a/93/c9302518.jpg","comment_is_top":false,"comment_ctime":1572574850,"is_pvip":false,"replies":[{"id":"59754","content":"加油志强","user_name":"作者回复","comment_id":146568,"uid":"1306094","ip_address":"","utype":1,"ctime":1574739760,"user_name_real":"cy"}],"discussion_count":1,"race_medal":0,"score":"27342378626","product_id":100029501,"comment_content":"终于明白了啥是存储过程，谢谢老师~","like_count":6,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472919,"discussion_content":"加油志强","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574739760,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":121688,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1565183063,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18745052247","product_id":100029501,"comment_content":"关于关于存储过程的版本控制请教以下两个问题，望老师回复，谢谢！<br>1、版本控制指的是存储过程修改存储过程的定义，即修改存储过程的创建语句？<br>2、请举例说明表索引发生了变化，会导致存储过程失效？","like_count":4},{"had_liked":false,"id":121684,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1565182272,"is_pvip":false,"replies":[{"id":"63567","content":"感谢 我放到GitHub上了，可以看下","user_name":"作者回复","comment_id":121684,"uid":"1306094","ip_address":"","utype":1,"ctime":1577518390,"user_name_real":"cy"}],"discussion_count":3,"race_medal":0,"score":"18745051456","product_id":100029501,"comment_content":"老师的脑图总结得很到位，求共享啊。谢谢","like_count":4,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461903,"discussion_content":"感谢 我放到GitHub上了，可以看下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577518390,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1661704,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","nickname":"丁丁历险记","note":"","ucode":"A43829E454C067","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375062,"discussion_content":"图片可以点开的，保存到相册就可以了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621472618,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1088040,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9a/28/03613c22.jpg","nickname":"track6688","note":"","ucode":"0A9E893F8FD379","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":213573,"discussion_content":"老师的脑图是一大特色","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585106748,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112381,"user_name":"我行我素","can_delete":false,"product_type":"c1","uid":1224678,"ip_address":"","ucode":"4C69542FAB0671","user_header":"https://static001.geekbang.org/account/avatar/00/12/af/e6/9c77acff.jpg","comment_is_top":false,"comment_ctime":1562725795,"is_pvip":false,"replies":[{"id":"63727","content":"Good Job","user_name":"作者回复","comment_id":112381,"uid":"1306094","ip_address":"","utype":1,"ctime":1577530659,"user_name_real":"cy"}],"discussion_count":1,"race_medal":0,"score":"14447627683","product_id":100029501,"comment_content":"CREATE PROCEDURE `get_sum_score`(<br>\t\t\t\tOUT sum_hp_max FLOAT,<br>\t\t\t\ts VARCHAR(255)<br>\t\t\t\t)<br>BEGIN<br>\t\tSELECT sum(hp_max) FROM heros WHERE role_main = s INTO sum_hp_max;<br>END<br><br>CALL get_sum_score(@sum_hp_max, &#39;法师&#39;);<br>SELECT @sum_hp_max;","like_count":2,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457708,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577530659,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":203876,"user_name":"刘智恒ohhhhh","can_delete":false,"product_type":"c1","uid":1879555,"ip_address":"","ucode":"A762D9BE157010","user_header":"https://static001.geekbang.org/account/avatar/00/1c/ae/03/4736ba9d.jpg","comment_is_top":false,"comment_ctime":1586280263,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10176214855","product_id":100029501,"comment_content":"老师，请问我按照您的代码进行编译的，问什么结果都是null","like_count":2,"discussions":[{"author":{"id":1586887,"avatar":"http://thirdwx.qlogo.cn/mmopen/uqaRIfRCAhJ6t1z92XYEzYru4PksRhFQhND9PSIFI7zOrx5xK8Kibc4Aeich2XMCDia2fYDic5JfZoGTibicVEQOlJsrNsPQBibsbHT/132","nickname":"M1keLee","note":"","ucode":"1A4E0D516B1595","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":274143,"discussion_content":"遇到了一样的情况，请问你解决了么","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590545680,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115676,"user_name":"Elliot","can_delete":false,"product_type":"c1","uid":1030070,"ip_address":"","ucode":"CC58A6FD2F338C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b7/b6/17103195.jpg","comment_is_top":false,"comment_ctime":1563694002,"is_pvip":false,"replies":[{"id":"63654","content":"多谢反馈","user_name":"作者回复","comment_id":115676,"uid":"1306094","ip_address":"","utype":1,"ctime":1577526710,"user_name_real":"cy"}],"discussion_count":2,"race_medal":0,"score":"10153628594","product_id":100029501,"comment_content":"极课时间页面的交互要是能像Medium那样就更完美了，比如可以自己mark一些书签标记","like_count":2,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459223,"discussion_content":"多谢反馈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577526710,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1030070,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b7/b6/17103195.jpg","nickname":"Elliot","note":"","ucode":"CC58A6FD2F338C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":142579,"discussion_content":"太酷了，现在支持了，是不是应该给点鼓励啥的😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579480142,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113562,"user_name":"柔软的胖","can_delete":false,"product_type":"c1","uid":1573853,"ip_address":"","ucode":"32B0CDA0E03BC5","user_header":"https://static001.geekbang.org/account/avatar/00/18/03/dd/e9f4c243.jpg","comment_is_top":false,"comment_ctime":1563078523,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10153013115","product_id":100029501,"comment_content":"存储过程用到了BEGIN关键字，是不是表示存储过程就是一个事务？","like_count":2,"discussions":[{"author":{"id":1012325,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/72/65/68bd8177.jpg","nickname":"雪飞鸿","note":"","ucode":"65D7B030828809","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2491,"discussion_content":"BEGIN...END用于表示一组语句，和事务没关系\nhttps://docs.microsoft.com/en-us/sql/t-sql/language-elements/begin-end-transact-sql?view=sql-server-2017","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1563712955,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112530,"user_name":"夜路破晓","can_delete":false,"product_type":"c1","uid":1353577,"ip_address":"","ucode":"9B875F94B759B9","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/3hZfficKPGCq2kjFBu9SgaMjibJTEl7iaW1ta6pZNyiaWP8XEsNpunlnsiaOtBpWTXfT5BvRP3qNByml6p9rtBvqewg/132","comment_is_top":false,"comment_ctime":1562752628,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"10152687220","product_id":100029501,"comment_content":"发现但凡字段一多,尤其是还带下划线的,比较容易出现创建表后,再from新建表会报错.比如第二例,即便是复写,因为未察觉的失误导致某个字段名写错,那么运行&quot;战士&quot;实例时会报错.但是我复制老师的代码运行无误.两相对照发现就是某个字段的某个字母或者下划线导致的.<br>问题一:<br>s varchar(255)  前面没有IN ,我能理解为参数类型默认是IN吗?<br>问题二:<br>运行CALL实例中,字段前加@是固定用法吗? ","like_count":2,"discussions":[{"author":{"id":1463474,"avatar":"https://static001.geekbang.org/account/avatar/00/16/54/b2/5ea0b709.jpg","nickname":"Danpier","note":"","ucode":"11E208FDE34961","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2601,"discussion_content":"单个@加变量名在 MySQL 代表自定义变量，这里相当于自定义个变量，然后接收函数返回的结果，所以这里的变量名和函数里定义的变量名不一样也没影响。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1563783803,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1048028,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/fd/dc/245fee32.jpg","nickname":"张驰皓","note":"","ucode":"448CAA944097E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":96074,"discussion_content":"同样发现了里面缺个 in","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577029540,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":293630,"user_name":"丁丁历险记","can_delete":false,"product_type":"c1","uid":1661704,"ip_address":"","ucode":"A43829E454C067","user_header":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","comment_is_top":false,"comment_ctime":1621472539,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5916439835","product_id":100029501,"comment_content":"二刷了，还是那个观点，存储过程就是坨翔，管好数据就可以了，不要没事找事去折腾业务。","like_count":1},{"had_liked":false,"id":151553,"user_name":"丁丁历险记","can_delete":false,"product_type":"c1","uid":1661704,"ip_address":"","ucode":"A43829E454C067","user_header":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","comment_is_top":false,"comment_ctime":1573739197,"is_pvip":false,"replies":[{"id":"59804","content":"对 根据业务情况选择把，有些公司不用，也有一些公司在使用","user_name":"作者回复","comment_id":151553,"uid":"1306094","ip_address":"","utype":1,"ctime":1574756065,"user_name_real":"cy"}],"discussion_count":5,"race_medal":0,"score":"5868706493","product_id":100029501,"comment_content":"就是个毒瘤，慎用","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474529,"discussion_content":"对 根据业务情况选择把，有些公司不用，也有一些公司在使用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574756065,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1661704,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","nickname":"丁丁历险记","note":"","ucode":"A43829E454C067","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":61135,"discussion_content":"简单的查询没必要存储过程，复杂的过程一用存储过程就意味着这个地方不怎么好改了。俗称这块写死。\n直接违背ocp  ，再加上事实上优质架构稀缺，坑货程序员乱写。\n那点压缩传输的优势还是算了吧，说到简化开发更谈不上。至少我们公司，我绝不允许出现。\n我就好奇，还有大厂敢在关键有变化的业务上用存储过程？？？？？？\n具体是基于什么考虑，出现的真实场景是啥，拿实例出来讨论，别搞虚的，大家都是一线开发逐步转架构的。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1574773942,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1339724,"avatar":"https://static001.geekbang.org/account/avatar/00/14/71/4c/2cefec07.jpg","nickname":"静水流深","note":"","ucode":"644F05EFBD2E7B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1661704,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","nickname":"丁丁历险记","note":"","ucode":"A43829E454C067","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":223829,"discussion_content":"我一看到存储过程就想砸电脑","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586257673,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":61135,"ip_address":""},"score":223829,"extra":""}]},{"author":{"id":1302228,"avatar":"https://static001.geekbang.org/account/avatar/00/13/de/d4/b83c4185.jpg","nickname":"David.cui","note":"","ucode":"AB46F310403612","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":171836,"discussion_content":"同意你的观点。凡是大量使用存储过程的厂家，基本上就是没有遇到数据库性能瓶颈的，或是偷工减料做开发的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581752212,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1661704,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","nickname":"丁丁历险记","note":"","ucode":"A43829E454C067","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":61138,"discussion_content":"仔细想想，一旦对存储过程产生更细粒度的需求，那严重把solid 原则违背了个遍。\n这还不是毒瘤？？？？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574774054,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113473,"user_name":"林彦","can_delete":false,"product_type":"c1","uid":1032615,"ip_address":"","ucode":"5094CC6ED7B40C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c1/a7/5e66d331.jpg","comment_is_top":false,"comment_ctime":1563025147,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5857992443","product_id":100029501,"comment_content":"1. 课程里提到“IN 参数必须在调用存储过程时指定，而在存储过程中修改该参数的值不能被返回。”这里的IN 参数必须在调用存储过程时指定的含义是什么？我查询了MySQL的存储过程定义时可以不包含 IN 参数。这句话有表示当存储过程的定义语句里有 IN 参数时，存储过程的语句中必须用到这个 IN 参数吗?<br><br>2. 提到存储过程的缺点时讲到高并发的场景下，数据库会采用分库分表的方式，对可扩展性要求高，这种情况下存储过程会增加数据库的压力。能简单对比讲解这种情况下存储过程是和普通的SQL语句比更增加数据库的压力吗？为什么？<br><br>3. 一个课外话题。TeraData里的BTEQ感觉和存储过程一样能包含SQL语句(至少一部分，如DDL，DML)，和流控制语句。另外还多了一些功能。作用上有点像存储过程的加强或延伸。另外能以文件方式(批处理)执行。不知道后面的课程会不会有更多类似这样的应用，或者通过存储过程实现自动化执行的内容。","like_count":1},{"had_liked":false,"id":357834,"user_name":"张兴","can_delete":false,"product_type":"c1","uid":3175551,"ip_address":"上海","ucode":"6BE80A3C026E36","user_header":"","comment_is_top":false,"comment_ctime":1663669241,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1663669241","product_id":100029501,"comment_content":"<br>DELIMITER &#47;&#47;<br>CREATE PROCEDURE `get_sum_score`(<br>\t\tIN roleMain VARCHAR(255),<br>\t\tOUT total FLOAT<br>)<br>BEGIN<br>\t\tSELECT SUM(hp_max) FROM heros <br>\t\tWHERE role_main = roleMain<br>\t\tINTO total;<br>END&#47;&#47;<br>DELIMITER ;<br><br>CALL get_sum_score(&#39;战士&#39;,@ZS_Total);<br>SELECT @ZS_Total;","like_count":0},{"had_liked":false,"id":356795,"user_name":"年少挽滑稽世无双","can_delete":false,"product_type":"c1","uid":2962599,"ip_address":"四川","ucode":"793DCBDE25A07B","user_header":"https://static001.geekbang.org/account/avatar/00/2d/34/a7/52c4ea60.jpg","comment_is_top":false,"comment_ctime":1662600491,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1662600491","product_id":100029501,"comment_content":"# 针对王者荣耀的英雄数据表 heros 表，请编写存储过程 get_sum_score，用来得到某一类型英雄（主要定位为某一类型即可）的最大生命值的总和。<br>CREATE PROCEDURE `get_sum_score`(<br>\t\tOUT sum_max_hp INT,<br>\t\tIN s VARCHAR(255)<br>)<br>BEGIN<br>\t\tSELECT SUM(hp_max) <br>\t\tFROM heros<br>\t\tWHERE role_main = s INTO sum_max_hp;<br>END<br><br>CALL get_sum_score(@sum_max_hp, &#39;战士&#39;);<br>SELECT @sum_max_hp;","like_count":0},{"had_liked":false,"id":337431,"user_name":"woJA1wCgAA3aj6p1ELWENTCq8KX2zC2w","can_delete":false,"product_type":"c1","uid":2911626,"ip_address":"","ucode":"558FF6A6A2714B","user_header":"","comment_is_top":false,"comment_ctime":1646818617,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646818617","product_id":100029501,"comment_content":"oracle中的存储过程如下：<br>CREATE OR REPLACE PROCEDURE SP_DDM_PBC_CHRTC_PIB1(P_I_DATE IN VARCHAR2,<br>                                                  P_O_CODE OUT NUMBER) IS<br><br><br><br>我用call SP_DDM_PBC_CHRTC_PIB1(&#39;20121231&#39;,@P_O_CODE ); <br>执行提示缺失表达式，请教老师哪里错了<br>","like_count":0},{"had_liked":false,"id":336530,"user_name":"songhyunmin","can_delete":false,"product_type":"c1","uid":1317847,"ip_address":"","ucode":"D5A98668CD8532","user_header":"https://static001.geekbang.org/account/avatar/00/14/1b/d7/868d26ce.jpg","comment_is_top":false,"comment_ctime":1646204071,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646204071","product_id":100029501,"comment_content":"#DROP PROCEDURE get_sum_hp;<br>#定义存储过程名字用``而不是单引号；<br>CREATE PROCEDURE `get_sum_hp`(<br>       OUT sum_max_hp INT,<br>\t\t\t s VARCHAR(255)<br>\t\t\t )<br>BEGIN<br>       SELECT SUM(hp_max) FROM heros WHERE role_main = s INTO sum_max_hp;<br>END<br><br>CALL get_sum_hp(@sum_max_hp, &#39;射手&#39;);<br>SELECT @sum_max_hp;","like_count":0},{"had_liked":false,"id":325799,"user_name":"到道可道","can_delete":false,"product_type":"c1","uid":1031181,"ip_address":"","ucode":"12B94B6C26BE0D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bc/0d/00424e81.jpg","comment_is_top":false,"comment_ctime":1639135835,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1639135835","product_id":100029501,"comment_content":"CREATE PROCEDURE `get_sum_score`(<br>    OUT sum_max_hp FLOAT,<br>    IN s VARCHAR(255)<br>)<br>BEGIN<br>    SELECT SUM(hp_max) FROM heros WHERE role_main = s INTO sum_max_hp;<br>END;<br><br>CALL get_sum_score(@sum_max_hp, &#39;战士&#39;);<br>SELECT @sum_max_hp;","like_count":0},{"had_liked":false,"id":317675,"user_name":"Geek_28670d","can_delete":false,"product_type":"c1","uid":2814926,"ip_address":"","ucode":"7BA10C23E56F1E","user_header":"","comment_is_top":false,"comment_ctime":1634887624,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634887624","product_id":100029501,"comment_content":"储存过程是对sql语句和流程控制语句的封装函数，优点是可复用，可以用来解决复杂查询需求，缺点是维护调试困难，可移植性差。","like_count":0},{"had_liked":false,"id":317670,"user_name":"Geek_28670d","can_delete":false,"product_type":"c1","uid":2814926,"ip_address":"","ucode":"7BA10C23E56F1E","user_header":"","comment_is_top":false,"comment_ctime":1634886916,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634886916","product_id":100029501,"comment_content":"DROP PROCEDURE IF EXISTS hero_hp_sum_by_type;<br>DELIMITER &#47;&#47;<br>CREATE PROCEDURE hero_hp_sum_by_type(IN role_name VARCHAR(100),OUT res INT )<br>BEGIN<br>\tSELECT SUM(hp_max)AS res FROM `heros` WHERE role_main = role_name INTO res;<br>END &#47;&#47;<br>DELIMITER ;<br>CALL hero_hp_sum_by_type(&quot;坦克&quot;,@res)<br>SELECT @res","like_count":0},{"had_liked":false,"id":312807,"user_name":"Soul of the Dragon","can_delete":false,"product_type":"c1","uid":2438011,"ip_address":"","ucode":"21603099E51B8A","user_header":"https://static001.geekbang.org/account/avatar/00/25/33/7b/9e012181.jpg","comment_is_top":false,"comment_ctime":1632034239,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632034239","product_id":100029501,"comment_content":"课后练习：<br>CREATE PROCEDURE `get_sum_score`(<br>      OUT sum_max_hp FLOAT,<br>      s VARCHAR(255)<br>     )<br>BEGIN<br>      SELECT SUM(hp_max) FROM heros WHERE role_main=s INTO sum_max_hp;<br>END<br><br>调用：<br>CALL get_sum_score(@sum_max_hp, &#39;战士&#39;);<br>SELECT @sum_max_hp;","like_count":0},{"had_liked":false,"id":277717,"user_name":"蓦然回首","can_delete":false,"product_type":"c1","uid":1172090,"ip_address":"","ucode":"B17658DCFE6402","user_header":"https://static001.geekbang.org/account/avatar/00/11/e2/7a/38a27e47.jpg","comment_is_top":false,"comment_ctime":1612525449,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1612525449","product_id":100029501,"comment_content":"好像看了一下MYSQL教程《MYSQL必知必会》上面也没有加``这个，标准是怎么样的？","like_count":0},{"had_liked":false,"id":277715,"user_name":"蓦然回首","can_delete":false,"product_type":"c1","uid":1172090,"ip_address":"","ucode":"B17658DCFE6402","user_header":"https://static001.geekbang.org/account/avatar/00/11/e2/7a/38a27e47.jpg","comment_is_top":false,"comment_ctime":1612525146,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1612525146","product_id":100029501,"comment_content":"存储过程名称两边不用加引号，好像也不是单引号，不知道怎么叫这个符号，哈哈，不加，试试也可以","like_count":0,"discussions":[{"author":{"id":1471657,"avatar":"https://static001.geekbang.org/account/avatar/00/16/74/a9/5eb3ebc6.jpg","nickname":"唐龙","note":"","ucode":"87A10AE04F2037","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384119,"discussion_content":"反引号，键盘上在1的左边，和~在同一按键","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626393530,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":274699,"user_name":"Flychen","can_delete":false,"product_type":"c1","uid":1880782,"ip_address":"","ucode":"4029A8F1D3C361","user_header":"https://static001.geekbang.org/account/avatar/00/1c/b2/ce/5638be2b.jpg","comment_is_top":false,"comment_ctime":1611130208,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1611130208","product_id":100029501,"comment_content":"navicat创建存储过程，似乎必须界面对话框定义 输入输出变量；不能直接写代码里 执行","like_count":0,"discussions":[{"author":{"id":1172090,"avatar":"https://static001.geekbang.org/account/avatar/00/11/e2/7a/38a27e47.jpg","nickname":"蓦然回首","note":"","ucode":"B17658DCFE6402","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348362,"discussion_content":"还是在对应的命令行，或者navicat的命令行上面测试，这样更接近实际使用，你那样用界面操作，只是为了快速验证存储过程是否正确而已，实际上，开发中一般不会这样使用吧！","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1612525541,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":266509,"user_name":"闫城哲","can_delete":false,"product_type":"c1","uid":1624846,"ip_address":"","ucode":"1903E022DF6A6F","user_header":"https://static001.geekbang.org/account/avatar/00/18/cb/0e/a9fee0b6.jpg","comment_is_top":false,"comment_ctime":1607360088,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607360088","product_id":100029501,"comment_content":"-- get_sum_score，用来得到某一类型英雄（主要定位为某一类型即可）的最大生命值的总和。<br>create PROCEDURE `get_sum_score`(<br>\tOUT  hp_sum_max int,<br>\ts VARCHAR(255)<br>\t<br>)<br>begin<br>\tselect SUM(hp_max) from heros order by s INTO hp_sum_max;<br>end<br><br>call get_sum_score(@result,&quot;attack_range&quot;);<br>select @result;","like_count":0},{"had_liked":false,"id":260643,"user_name":"Wang","can_delete":false,"product_type":"c1","uid":1052957,"ip_address":"","ucode":"9BEFA46433F86B","user_header":"https://static001.geekbang.org/account/avatar/00/10/11/1d/6ad7eb3c.jpg","comment_is_top":false,"comment_ctime":1605076839,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1605076839","product_id":100029501,"comment_content":"这篇文章有帮助。还有没有一些资料可以更细致的学习存储过程，工作中在使用存储过程。","like_count":0},{"had_liked":false,"id":244491,"user_name":"xiaopi3","can_delete":false,"product_type":"c1","uid":1837697,"ip_address":"","ucode":"1C92D0CDC0B39E","user_header":"https://static001.geekbang.org/account/avatar/00/1c/0a/81/69fecff9.jpg","comment_is_top":false,"comment_ctime":1598536453,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598536453","product_id":100029501,"comment_content":"简单点：<br>DELIMITER &#47;&#47;<br>CREATE PROCEDURE get_sum_score(IN X VARCHAR(255))<br>BEGIN<br>\tSELECT SUM(hp_max) FROM heros WHERE role_main = X;<br>END &#47;&#47;<br>DELIMITER ;<br><br>CALL get_sum_score(&#39;战士&#39;);<br><br>话说@xxx是啥意思啊？我看这个意思好像是定义一个变量吗？","like_count":0},{"had_liked":false,"id":242245,"user_name":"0000000","can_delete":false,"product_type":"c1","uid":2076755,"ip_address":"","ucode":"AF9AFCC5A893D1","user_header":"https://static001.geekbang.org/account/avatar/00/1f/b0/53/198fdc84.jpg","comment_is_top":false,"comment_ctime":1597646558,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597646558","product_id":100029501,"comment_content":"老师请问@ 符号的作用，为什么有的有，有的没有呢？","like_count":0},{"had_liked":false,"id":239670,"user_name":"LIKE","can_delete":false,"product_type":"c1","uid":1254252,"ip_address":"","ucode":"9DAB7F9051648A","user_header":"https://static001.geekbang.org/account/avatar/00/13/23/6c/82ba5e1f.jpg","comment_is_top":false,"comment_ctime":1596611163,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1596611163","product_id":100029501,"comment_content":"1.“in role_name varchar(255)“，mysql version 5.7.25 不指定长度会报错。<br>2.工作中应用存储过程比较多的，是批量插入数据，模拟定量数据。<br><br>","like_count":0,"discussions":[{"author":{"id":2565173,"avatar":"https://static001.geekbang.org/account/avatar/00/27/24/35/03603e95.jpg","nickname":"牛哥","note":"","ucode":"27D8619DC2B946","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384808,"discussion_content":"8.0版本也报错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626761729,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":239405,"user_name":"Geek_gong1zu","can_delete":false,"product_type":"c1","uid":2086659,"ip_address":"","ucode":"D629A6652AB8E2","user_header":"https://static001.geekbang.org/account/avatar/00/1f/d7/03/db060811.jpg","comment_is_top":false,"comment_ctime":1596525157,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1596525157","product_id":100029501,"comment_content":"DELIMETER&#47;&#47;<br>CREATE PROCEDURE get_sum_score(<br>          OUT sum_max_hp FLOAT,<br>        IN s VARCHAR(20)<br>    )<br>BEGIN<br>    SELECT sum(hp_max)  FROM heros WHERE role_main = S INTO sum_max_hp;<br>END<br><br># 调用存储过程<br>CALL get_sum_score(@sum_max_hp,&#39;战士&#39;)<br>SELECT @sum_max_hp;","like_count":0},{"had_liked":false,"id":238692,"user_name":"Everlaa","can_delete":false,"product_type":"c1","uid":1708271,"ip_address":"","ucode":"9B4FFFABD62B07","user_header":"https://static001.geekbang.org/account/avatar/00/1a/10/ef/4c9b2383.jpg","comment_is_top":false,"comment_ctime":1596263146,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596263146","product_id":100029501,"comment_content":"看了很多文章都没有把这个概念讲清楚，今天终于明朗了，谢谢老师","like_count":0},{"had_liked":false,"id":230112,"user_name":"宁悦","can_delete":false,"product_type":"c1","uid":1901403,"ip_address":"","ucode":"68844C314FEEF8","user_header":"https://static001.geekbang.org/account/avatar/00/1d/03/5b/3cdbc9fa.jpg","comment_is_top":false,"comment_ctime":1593266424,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593266424","product_id":100029501,"comment_content":"CREATE PROCEDURE `get_sum_score`(<br>      OUT sum_max_hp FLOAT,<br>      s VARCHAR(255)<br>       )<br> BEGIN<br>       SELECT SUM(hp_max) FROM heros WHERE role_main = s INTO sum_max_hp;<br>END<br><br>","like_count":0},{"had_liked":false,"id":221600,"user_name":"M1keLee","can_delete":false,"product_type":"c1","uid":1586887,"ip_address":"","ucode":"1A4E0D516B1595","user_header":"http://thirdwx.qlogo.cn/mmopen/uqaRIfRCAhJ6t1z92XYEzYru4PksRhFQhND9PSIFI7zOrx5xK8Kibc4Aeich2XMCDia2fYDic5JfZoGTibicVEQOlJsrNsPQBibsbHT/132","comment_is_top":false,"comment_ctime":1590547469,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"1590547469","product_id":100029501,"comment_content":"用DataGrip运行“CALL get_hero_scores(@max_max_hp, @min_max_mp, @avg_max_attack,&#39;战士&#39;);”时报错“[HY000][1366] Incorrect string value: &#39;\\xE6\\x88\\x98\\xE5\\xA3\\xAB&#39; for column &#39;s&#39; at row 1”，将“战士”替换成英文字符串无error。检查table已经是CHARSET=utf8，请问应该如何解决？","like_count":0,"discussions":[{"author":{"id":1120348,"avatar":"https://static001.geekbang.org/account/avatar/00/11/18/5c/1a58e8f6.jpg","nickname":"草原上的奔跑","note":"","ucode":"D69C617F767736","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583690,"discussion_content":"IN s VARCHAR(255) CHARACTER SET utf8， 字符型字段后面指定编码类型就可以了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660294874,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"江苏"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1583391,"avatar":"https://static001.geekbang.org/account/avatar/00/18/29/1f/81fce62e.jpg","nickname":"哈大沙","note":"","ucode":"864868E0AAEFA0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":304592,"discussion_content":"用Navicat Premium遇到同样的问题，哥们解决没？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599621395,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1120348,"avatar":"https://static001.geekbang.org/account/avatar/00/11/18/5c/1a58e8f6.jpg","nickname":"草原上的奔跑","note":"","ucode":"D69C617F767736","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1583391,"avatar":"https://static001.geekbang.org/account/avatar/00/18/29/1f/81fce62e.jpg","nickname":"哈大沙","note":"","ucode":"864868E0AAEFA0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583691,"discussion_content":"IN s VARCHAR(255) CHARACTER SET utf8， 字符型字段后面指定编码类型就可以了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660294894,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":304592,"ip_address":"江苏"},"score":583691,"extra":""}]}]},{"had_liked":false,"id":220929,"user_name":"Edward","can_delete":false,"product_type":"c1","uid":1008343,"ip_address":"","ucode":"4ABF119D75C46F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/62/d7/48a7fb45.jpg","comment_is_top":false,"comment_ctime":1590344562,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590344562","product_id":100029501,"comment_content":"只有之前nba的数据，就求了一个根据球员ID获取身高级别以及同身高级别球员的身高之和。<br>————————————————————<br>DELIMITER &#47;&#47;<br>CREATE PROCEDURE `get_max_height`<br>(<br>IN pid INT, <br>OUT genre varchar(255), <br>OUT max_height FLOAT<br>)<br>BEGIN <br>  DECLARE lowest FLOAT;<br>  DECLARE highest FLOAT;<br>  SELECT height_level, height_lowest, height_highest  <br>  FROM height_grades <br>  WHERE <br>    (SELECT height FROM player WHERE player_id = pid) BETWEEN height_lowest AND height_highest   <br>  INTO genre, lowest, highest;<br><br>  SELECT SUM(height) FROM player WHERE height BETWEEN lowest AND highest INTO max_height; <br>END &#47;&#47;<br>DELIMITER ;","like_count":0},{"had_liked":false,"id":202013,"user_name":"彭纪程","can_delete":false,"product_type":"c1","uid":1682468,"ip_address":"","ucode":"F9222D72E791C8","user_header":"https://static001.geekbang.org/account/avatar/00/19/ac/24/0684a141.jpg","comment_is_top":false,"comment_ctime":1585887662,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585887662","product_id":100029501,"comment_content":"DELIMITER &#47;&#47;<br><br>CREATE PROCEDURE get_sum_score(IN s VARCHAR(255), OUT sum_maxhp FLOAT)<br>BEGIN <br>\tSELECT  SUM(hp_max) FROM heros WHERE role_main = s INTO  sum_maxhp;<br>END &#47;&#47;<br>DELIMITER ;<br>CALL get_sum_score(&#39;法师&#39;,@sum_hp_max);<br>SELECT &#39;法师&#39;, @sum_hp_max;","like_count":0},{"had_liked":false,"id":194795,"user_name":"track6688","can_delete":false,"product_type":"c1","uid":1088040,"ip_address":"","ucode":"0A9E893F8FD379","user_header":"https://static001.geekbang.org/account/avatar/00/10/9a/28/03613c22.jpg","comment_is_top":false,"comment_ctime":1585106653,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585106653","product_id":100029501,"comment_content":"之前了解过存储过程，但是一直没有写过。<br>CREATE PROCEDURE get_sum_score(IN hero_type VARCHAR(255), <br>\tOUT max_hp_sum FLOAT<br>)<br>BEGIN<br>\tSELECT SUM(h.hp_max) FROM heros h WHERE h.role_main = hero_type INTO max_hp_sum;<br>END<br><br>CALL get_sum_score(&#39;战士&#39;, @max_hp_sum);<br>SELECT @max_hp_sum;","like_count":0},{"had_liked":false,"id":189465,"user_name":"索旭东","can_delete":false,"product_type":"c1","uid":1139039,"ip_address":"","ucode":"BFD07BCD8C8CAE","user_header":"https://static001.geekbang.org/account/avatar/00/11/61/5f/b279daaf.jpg","comment_is_top":false,"comment_ctime":1584519556,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584519556","product_id":100029501,"comment_content":"DELIMITER &#47;&#47;<br>create procedure `get_sum_score`(IN roleMain VARCHAR(255))<br>BEGIN<br>select sum(hp_max) as sum_hp_max from heros where role_main=roleMain;<br>END&#47;&#47;<br>DELIMITER ;<br><br>call get_sum_score(&#39;坦克&#39;);<br>select @total","like_count":0},{"had_liked":false,"id":188174,"user_name":"Amy","can_delete":false,"product_type":"c1","uid":1151869,"ip_address":"","ucode":"22ABF84ACD1F77","user_header":"https://static001.geekbang.org/account/avatar/00/11/93/7d/177bf48a.jpg","comment_is_top":false,"comment_ctime":1584326398,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1584326398","product_id":100029501,"comment_content":"CREATE PROCEDURE `get_sum_score`(<br>       OUT sum_max_hp FLOAT,     <br>       r VARCHAR(255)<br>       )<br>BEGIN<br>   SELECT sum(hp_max) FROM `heros` WHERE role_main=r INTO sum_max_hp;<br>END","like_count":0},{"had_liked":false,"id":182442,"user_name":"欧阳啊","can_delete":false,"product_type":"c1","uid":1868570,"ip_address":"","ucode":"CF1D0F0802713B","user_header":"https://static001.geekbang.org/account/avatar/00/1c/83/1a/f9d9225f.jpg","comment_is_top":false,"comment_ctime":1582788448,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582788448","product_id":100029501,"comment_content":"-- 作业<br>CREATE PROCEDURE `get_sum_score`(s VARCHAR(255))<br>BEGIN<br>    DECLARE sum_hp_max FLOAT;<br>    SELECT SUM(DISTINCT h.hp_max) from heros h where h.role_main = s OR h.role_assist = s into sum_hp_max;<br>    SELECT sum_hp_max;<br>END<br>CALL get_sum_score(&#39;战士&#39;);","like_count":0},{"had_liked":false,"id":178585,"user_name":"David.cui","can_delete":false,"product_type":"c1","uid":1302228,"ip_address":"","ucode":"AB46F310403612","user_header":"https://static001.geekbang.org/account/avatar/00/13/de/d4/b83c4185.jpg","comment_is_top":false,"comment_ctime":1581752092,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581752092","product_id":100029501,"comment_content":"我并不赞成大量的或复杂的使用存储过程，就和老师总结的一样。一个是迁移起来代价极大，另外一个是很多计算的压力都集中在了数据库上。","like_count":0},{"had_liked":false,"id":171427,"user_name":"张驰皓","can_delete":false,"product_type":"c1","uid":1048028,"ip_address":"","ucode":"448CAA944097E6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fd/dc/245fee32.jpg","comment_is_top":false,"comment_ctime":1578922021,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578922021","product_id":100029501,"comment_content":"课程里貌似没有讲到存储过程怎样批量调用？比如创建了一个存储过程后，想传入多次输入来获取对应输出，这样应该怎么写语句呢？","like_count":0},{"had_liked":false,"id":162787,"user_name":"taoist","can_delete":false,"product_type":"c1","uid":1195004,"ip_address":"","ucode":"D70AFE25CD8F10","user_header":"https://static001.geekbang.org/account/avatar/00/12/3b/fc/04a75cd0.jpg","comment_is_top":false,"comment_ctime":1576589928,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1576589928","product_id":100029501,"comment_content":"--MariaDB<br>CREATE PROCEDURE `get_sum_score`(<br>OUT sum_hp_max FLOAT,<br>s VARCHAR(255)<br>)<br>BEGIN<br>SELECT sum(hp_max) FROM heros WHERE role_main = s INTO sum_hp_max;<br>END<br>CALL get_sum_score(@sum_hp_max, &#39;法师&#39;);<br>SELECT @sum_hp_max;","like_count":0},{"had_liked":false,"id":152432,"user_name":"梁","can_delete":false,"product_type":"c1","uid":1267198,"ip_address":"","ucode":"29A10759821D96","user_header":"https://static001.geekbang.org/account/avatar/00/13/55/fe/e8fb06fb.jpg","comment_is_top":false,"comment_ctime":1574000217,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574000217","product_id":100029501,"comment_content":"为啥存储过程对高并发支持不好呢？有一些同学也说不适合在oltp中跑，它不就也是发起一个简单的语句执行，具体执行的效率要看执行计划呀 ？","like_count":0},{"had_liked":false,"id":145210,"user_name":"扶幽","can_delete":false,"product_type":"c1","uid":1322612,"ip_address":"","ucode":"1400EDFF8970D3","user_header":"https://static001.geekbang.org/account/avatar/00/14/2e/74/88c613e0.jpg","comment_is_top":false,"comment_ctime":1572230355,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572230355","product_id":100029501,"comment_content":"小练习：<br>DELIMITER &#47;&#47;<br>CREATE PROCEDURE get_sum_score(IN main_role1 VARCHAR(255), OUT sums INT)<br>BEGIN<br>        SELECT SUM(hp_max) FROM heros WHERE main_role=main_role1;<br>END &#47;&#47;<br>DELIMITER ;","like_count":0},{"had_liked":false,"id":143453,"user_name":"Coool","can_delete":false,"product_type":"c1","uid":1701702,"ip_address":"","ucode":"1D1AB3270B02B9","user_header":"https://static001.geekbang.org/account/avatar/00/19/f7/46/209ca424.jpg","comment_is_top":false,"comment_ctime":1571711159,"is_pvip":false,"replies":[{"id":"62776","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577091048,"ip_address":"","comment_id":143453,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1571711159","product_id":100029501,"comment_content":"CREATE  PROCEDURE `get_sum_score`(out sum_max_hp float,in s varchar(255))<br>BEGIN<br>    select sum(hp_max) <br>    from heros<br>    where role_main=s<br>    into sum_max_hp;<br>END<br><br>call get_sum_score(@sum_max_hp,&#39;战士&#39;) ;<br>select @sum_max_hp ;","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471546,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577091048,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":142169,"user_name":"晶","can_delete":false,"product_type":"c1","uid":1437376,"ip_address":"","ucode":"645E674503B3D8","user_header":"https://static001.geekbang.org/account/avatar/00/15/ee/c0/b3d1593b.jpg","comment_is_top":false,"comment_ctime":1571303368,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571303368","product_id":100029501,"comment_content":"可以讲一下触发器吗？谢谢","like_count":0},{"had_liked":false,"id":142107,"user_name":"Cola_","can_delete":false,"product_type":"c1","uid":1264718,"ip_address":"","ucode":"99996D04CA4171","user_header":"https://static001.geekbang.org/account/avatar/00/13/4c/4e/91267714.jpg","comment_is_top":false,"comment_ctime":1571294982,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571294982","product_id":100029501,"comment_content":"delimiter &#47;&#47;<br>CREATE PROCEDURE `get_sum_scores`(<br>       OUT sum_max_hp FLOAT, <br>       s VARCHAR(255)<br>       )<br>BEGIN<br>       SELECT SUM(hp_max) FROM heros WHERE role_main = s INTO sum_max_hp;<br>END &#47;&#47;<br>delimiter ;<br><br>call get_sum_scores(@sum_max_hp,’法师’);<br>select @sum_max_hp;","like_count":0},{"had_liked":false,"id":132562,"user_name":"qf年间","can_delete":false,"product_type":"c1","uid":1463023,"ip_address":"","ucode":"AA08AC984637EE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLbchZfeEnshPuUwEsQkn1XbWxjs3rRUpSRUxjW4q7rOcrPvXld0IxEZ1jlpEJdklFeEVERJoOfibg/132","comment_is_top":false,"comment_ctime":1568166074,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568166074","product_id":100029501,"comment_content":"存储过程的调用具体是什么样的呢，如何传入参数呢","like_count":0},{"had_liked":false,"id":121818,"user_name":"未来的胡先森","can_delete":false,"product_type":"c1","uid":1234682,"ip_address":"","ucode":"AFF193AC0E2E6C","user_header":"https://static001.geekbang.org/account/avatar/00/12/d6/fa/1f5bf642.jpg","comment_is_top":false,"comment_ctime":1565227794,"is_pvip":false,"replies":[{"id":"63880","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577603261,"ip_address":"","comment_id":121818,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1565227794","product_id":100029501,"comment_content":"交作业了<br>DELIMITER &#47;&#47;<br>CREATE PROCEDURE get_sum_score(<br>\t\t\tOUT sum_max_hp FLOAT,<br>\t\t\tt VARCHAR(255))<br>BEGIN<br>\tSELECT SUM(hp_max)<br>\tFROM heros<br>\tWHERE role_main=t<br>\tINTO sum_max_hp;<br>END &#47;&#47;<br>DELIMITER ;<br><br>CALL get_sum_score(@sum_max_hp,&#39;战士&#39;);<br>SELECT @sum_max_hp;","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461960,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577603261,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117161,"user_name":"Fargo","can_delete":false,"product_type":"c1","uid":1018174,"ip_address":"","ucode":"434FC4C5D61750","user_header":"https://static001.geekbang.org/account/avatar/00/0f/89/3e/1976b66f.jpg","comment_is_top":false,"comment_ctime":1563978955,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563978955","product_id":100029501,"comment_content":"mysql&gt; CREATE PROCEDURE `get_sum_score`(<br>    -&gt; OUT sum_max_score FLOAT,<br>    -&gt; s VARCHAR(255))<br>    -&gt; BEGIN <br>    -&gt; SELECT SUM(hp_max) FROM heros WHERE role_main = s INTO sum_max_score; END;<br><br>mysql&gt; CALL get_sum_score(@sum_max_score, &#39;射手&#39;)；<br>mysql&gt; SELECT @sum_max_score;<br>+----------------+<br>| @sum_max_score |<br>+----------------+<br>|          57985 |<br>+----------------+","like_count":0},{"had_liked":false,"id":116575,"user_name":"Ronnyz","can_delete":false,"product_type":"c1","uid":1488280,"ip_address":"","ucode":"9F34527B1D343D","user_header":"https://static001.geekbang.org/account/avatar/00/16/b5/98/ffaf2aca.jpg","comment_is_top":false,"comment_ctime":1563873490,"is_pvip":false,"replies":[{"id":"63802","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577542246,"ip_address":"","comment_id":116575,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563873490","product_id":100029501,"comment_content":"作业：<br>CREATE DEFINER=`root`@`localhost` PROCEDURE `get_sum_score`(<br>\tOUT max_hp_sum INT,<br>\ts VARCHAR(255)<br>)<br>BEGIN<br>\tSELECT SUM(hp_max) FROM heros WHERE role_main=s INTO max_hp_sum;<br>END<br><br>CALL get_sum_score(@max_hp_sum,&#39;战士&#39;);<br>SELECT @max_hp_sum;<br>+-------------+<br>| @max_hp_sum |<br>+-------------+<br>|      124873 |<br>+-------------+","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459597,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577542246,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115178,"user_name":"Redevil","can_delete":false,"product_type":"c1","uid":1527609,"ip_address":"","ucode":"21C90472DC6357","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PrKSgib1DcguTZYoOAqNw8tpLKylQU6dQPwI4NLJkd6344EWHaLF5yHe6PpAD6fsxSm0no7qiakiaEHUYw4nzTEyw/132","comment_is_top":false,"comment_ctime":1563503902,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563503902","product_id":100029501,"comment_content":"DROP PROCEDURE IF EXISTS `get_sum_score`;<br>DELIMITER &#47;&#47;<br>CREATE PROCEDURE `get_sum_score`(IN role VARCHAR(255))<br>BEGIN <br>\tSELECT SUM(hp_max) FROM heros where role_main = role;<br>END &#47;&#47;<br>CALL get_sum_score(&#39;战士&#39;);","like_count":0},{"had_liked":false,"id":114913,"user_name":"mickey","can_delete":false,"product_type":"c1","uid":1051663,"ip_address":"","ucode":"8B490C2DDE4010","user_header":"https://static001.geekbang.org/account/avatar/00/10/0c/0f/93d1c8eb.jpg","comment_is_top":false,"comment_ctime":1563432058,"is_pvip":false,"replies":[{"id":"63808","content":"正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577542348,"ip_address":"","comment_id":114913,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563432058","product_id":100029501,"comment_content":"&#47;*<br>编写存储过程get_sum_score，用来得到某一类型英雄（主要定位为某一类型即可）的最大生命值的总和。<br>*&#47;<br>DROP PROCEDURE IF EXISTS `get_sum_score`;<br>CREATE PROCEDURE `get_sum_score`(<br>       OUT o_total_hp_max FLOAT,  <br>       i_role_main VARCHAR(255)<br>       )<br>BEGIN<br>       SELECT SUM(hp_max) FROM heros WHERE role_main = i_role_main INTO o_total_hp_max;<br>END;<br>CALL get_sum_score(@total_hp_max, &#39;战士&#39;);<br>SELECT @total_hp_max as &#39;最大生命值的总和 [战士]&#39;;<br>CALL get_sum_score(@total_hp_max, &#39;法师&#39;);<br>SELECT @total_hp_max as &#39;最大生命值的总和 [法师]&#39;;<br>CALL get_sum_score(@total_hp_max, &#39;坦克&#39;);<br>SELECT @total_hp_max as &#39;最大生命值的总和 [坦克]&#39;;<br><br>最大生命值的总和 [战士]<br>124873<br><br>最大生命值的总和 [法师]<br>111317<br><br>最大生命值的总和 [坦克]<br>83124<br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458882,"discussion_content":"正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577542348,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113900,"user_name":"假装自己不胖","can_delete":false,"product_type":"c1","uid":1412994,"ip_address":"","ucode":"308F1BAA96CDA5","user_header":"https://static001.geekbang.org/account/avatar/00/15/8f/82/374f43a1.jpg","comment_is_top":false,"comment_ctime":1563183037,"is_pvip":false,"replies":[{"id":"63698","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577528496,"ip_address":"","comment_id":113900,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563183037","product_id":100029501,"comment_content":"CREATE PROCEDURE `get_sum_score`(<br>OUT sum_hp_max FLOAT,<br>s VARCHAR(255)<br>)<br>BEGIN<br>SELECT sum(hp_max) FROM heros WHERE role_main = s and hp_max = (select max(hp_max) from heros) INTO sum_hp_max;<br>END<br><br>CALL get_sum_score(@sum_hp_max, &#39;法师&#39;);<br>SELECT @sum_hp_max;<br><br><br>偷了一个同学的改了改","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458429,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577528496,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113560,"user_name":"Regis","can_delete":false,"product_type":"c1","uid":1435632,"ip_address":"","ucode":"3911E4EDE27F4E","user_header":"https://static001.geekbang.org/account/avatar/00/15/e7/f0/d0bf3a5f.jpg","comment_is_top":false,"comment_ctime":1563077475,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563077475","product_id":100029501,"comment_content":"在OLAP系统中，使用ORACLE，SQLServer数据库的，几乎都用存储过程，主要是处理业务逻辑，获取报表的基础数据，在OLTP系统存储过程用的还是比较少吧，尤其是MySQL数据库，实际项目用的很少","like_count":0},{"had_liked":false,"id":113531,"user_name":"supermouse","can_delete":false,"product_type":"c1","uid":1321860,"ip_address":"","ucode":"88072D5F881827","user_header":"https://static001.geekbang.org/account/avatar/00/14/2b/84/07f0c0d6.jpg","comment_is_top":false,"comment_ctime":1563070438,"is_pvip":false,"replies":[{"id":"63815","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577542558,"ip_address":"","comment_id":113531,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563070438","product_id":100029501,"comment_content":"创建存储过程：<br>DELIMITER &#47;&#47;<br>CREATE PROCEDURE `get_sum_scores`(<br>       OUT max_hp_sum INT,<br>       s VARCHAR(255)<br>       )<br>BEGIN<br>       SELECT SUM(hp_max) FROM heros WHERE role_main=s INTO max_hp_sum;<br>END &#47;&#47;<br>DELIMITER ;<br><br>调用存储过程：<br>CALL get_sum_scores(@max_hp_sum, &#39;刺客&#39;);<br>SELECT @max_hp_sum;","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458261,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577542558,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113195,"user_name":"Geek_70747e","can_delete":false,"product_type":"c1","uid":1309814,"ip_address":"","ucode":"A832E20E951A00","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKdzXiawss5gGmlPicx9IiblxOTf4oSW16MWd696fue60zDA9NJTrGWenuLxS0COZZSzekV8QZGicyJOQ/132","comment_is_top":false,"comment_ctime":1562912345,"is_pvip":true,"replies":[{"id":"63974","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577606538,"ip_address":"","comment_id":113195,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562912345","product_id":100029501,"comment_content":"课后作业<br>DROP PROCEDURE IF EXISTS get_sum_score;<br>DELIMITER &#47;&#47;<br>CREATE PROCEDURE get_sum_score (<br>\tIN role VARCHAR (32),<br>\tOUT sum_score_4_role FLOAT<br>)<br>BEGIN<br>\tSELECT<br>\t\tsum(hp_max)<br>\tFROM<br>\t\theros<br>\tWHERE<br>\t\trole_main = role INTO sum_score_4_role;<br>END &#47;&#47;<br><br>CALL get_sum_score (&#39;战士&#39; ,@sum_score);<br>SELECT @sum_score;","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458105,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577606538,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113118,"user_name":"cricket1981","can_delete":false,"product_type":"c1","uid":1001715,"ip_address":"","ucode":"758262F5958DA4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/48/f3/f1034ffd.jpg","comment_is_top":false,"comment_ctime":1562899439,"is_pvip":false,"replies":[{"id":"41356","content":"正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1563070106,"ip_address":"","comment_id":113118,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562899439","product_id":100029501,"comment_content":"DELIMITER &#47;&#47;<br>CREATE PROCEDURE `get_sum_score`(IN s VARCHAR(255), OUT sum_hp_max FLOAT)<br>BEGIN<br>       SELECT SUM(hp_max) FROM heros WHERE role_main = s INTO sum_hp_max;<br>END &#47;&#47;<br>DELIMITER ;<br><br><br>CALL get_sum_score(&#39;战士&#39;, @sum_hp_max);<br><br>SELECT @sum_hp_max;<br><br>+------------+<br>| sum_hp_max |<br>+------------+<br>|     124873 |<br>+------------+<br>1 row in set (0.00 sec)","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458064,"discussion_content":"正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563070106,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113114,"user_name":"鸡儿🐤不放假","can_delete":false,"product_type":"c1","uid":1586579,"ip_address":"","ucode":"6DC348EC279906","user_header":"https://static001.geekbang.org/account/avatar/00/18/35/93/a4fe46e0.jpg","comment_is_top":false,"comment_ctime":1562898597,"is_pvip":false,"replies":[{"id":"41355","content":"我刚运行了下 是OK的","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1563069652,"ip_address":"","comment_id":113114,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1562898597","product_id":100029501,"comment_content":"跪求大神：<br>创建存储过程成功<br>CREATE PROCEDURE sum_hero_hp(IN s VARCHAR(20),OUT sum_hp int )<br>\tBEGIN <br>\t\tSELECT SUM(hp_max) FROM heros WHERE role_main=s INTO sum_hp;<br>\tEND<br>调用时报错了：\tCALL sum_hero_hp(&#39;法师&#39;,@sum_hp2);<br><br>CALL sum_hero_hp(&#39;法师&#39;,@sum_hp)<br>&gt; 1366 - Incorrect string value: &#39;\\xE6\\xB3\\x95\\xE5\\xB8\\x88&#39; for column &#39;s&#39; at row 313<br>&gt; 时间: 0.002s","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458060,"discussion_content":"我刚运行了下 是OK的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563069652,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1120348,"avatar":"https://static001.geekbang.org/account/avatar/00/11/18/5c/1a58e8f6.jpg","nickname":"草原上的奔跑","note":"","ucode":"D69C617F767736","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583692,"discussion_content":"IN s VARCHAR(255) CHARACTER SET utf8， 字符型字段后面指定编码类型就可以了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660294944,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"江苏"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112954,"user_name":"野马","can_delete":false,"product_type":"c1","uid":1065176,"ip_address":"","ucode":"CC58CBF541D34A","user_header":"https://static001.geekbang.org/account/avatar/00/10/40/d8/69722032.jpg","comment_is_top":false,"comment_ctime":1562854188,"is_pvip":false,"replies":[{"id":"63707","content":"就是你使用的DBMS支持的数据类型","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577529669,"ip_address":"","comment_id":112954,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1562854188","product_id":100029501,"comment_content":"老师，您好，在使用存储过程声明变量时，数据类型都支持哪些呢？","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457972,"discussion_content":"就是你使用的DBMS支持的数据类型","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577529669,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"一步","note":"","ucode":"73CEA468CE70C3","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1832,"discussion_content":"Mysql 的数据类型都支持","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562936997,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112836,"user_name":"时间是最真的答案","can_delete":false,"product_type":"c1","uid":1183601,"ip_address":"","ucode":"B90F3EF769F865","user_header":"https://static001.geekbang.org/account/avatar/00/12/0f/71/9273e8a4.jpg","comment_is_top":false,"comment_ctime":1562829429,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562829429","product_id":100029501,"comment_content":"问一个额外的问题：<br>SHOW TABLE STATUS LIKE table_name ; 中 Data_free 这列有什么用，比如在 MyISAM 和 InnoDB 引擎下分别是什么意思？","like_count":0},{"had_liked":false,"id":112623,"user_name":"圆子蛋","can_delete":false,"product_type":"c1","uid":1585794,"ip_address":"","ucode":"9E8FE5D4DAC79E","user_header":"https://static001.geekbang.org/account/avatar/00/18/32/82/273a44cd.jpg","comment_is_top":false,"comment_ctime":1562773591,"is_pvip":false,"replies":[{"id":"63712","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577530169,"ip_address":"","comment_id":112623,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562773591","product_id":100029501,"comment_content":"CREATE PROCEDURE &#39;get_sum_score&#39;(OUT sum_hp_max FLOAT，IN role_name VARCHAR(255))<br>BEGIN<br>SELECT SUM(hp_max) FROM heros WHERE role_main = role_name INTO sum_hp_max;<br>END<br>调用存储过程<br>CALL get_sum_score(@sum_hp_max，&#39;战士&#39;);<br>SELECT @sum_hp_max，","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457824,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577530169,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112606,"user_name":"大斌","can_delete":false,"product_type":"c1","uid":1002183,"ip_address":"","ucode":"1434C2B0A29135","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4a/c7/ec18673b.jpg","comment_is_top":false,"comment_ctime":1562770207,"is_pvip":false,"replies":[{"id":"63713","content":"God Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577530176,"ip_address":"","comment_id":112606,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562770207","product_id":100029501,"comment_content":"MySQL代码（Navicat）：<br>CREATE DEFINER=`root`@`localhost` PROCEDURE `get_sum_score`(role_main_var VARCHAR(20),OUT max_hp_sum int)<br>BEGIN<br>\tSELECT SUM(hp_max) from heros where role_main=role_main_var INTO max_hp_sum;<br>END<br><br>调用：<br>CALL get_sum_score(&#39;法师&#39;,@max_hp_sum);<br>SELECT @max_hp_sum;","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457816,"discussion_content":"God Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577530176,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112538,"user_name":"2525","can_delete":false,"product_type":"c1","uid":1180247,"ip_address":"","ucode":"2426488C258203","user_header":"https://static001.geekbang.org/account/avatar/00/12/02/57/9b235866.jpg","comment_is_top":false,"comment_ctime":1562754498,"is_pvip":false,"replies":[{"id":"63715","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577530244,"ip_address":"","comment_id":112538,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562754498","product_id":100029501,"comment_content":"创建存储过程：<br>CREATE PROCEDURE get_sum_score (<br>\tIN role_main_var VARCHAR (20),<br>\tOUT hp_sum int<br>)<br>BEGIN<br>\tselect sum(hp_max) from heros where role_main=role_main_var INTO hp_sum;<br>END<br>调用存储过程：<br>call get_sum_score(&#39;坦克&#39;,@sum_hp);<br>select @sum_hp","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457787,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577530244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112506,"user_name":"ABC","can_delete":false,"product_type":"c1","uid":1054958,"ip_address":"","ucode":"7501AD9C0C4A70","user_header":"https://static001.geekbang.org/account/avatar/00/10/18/ee/a1ed60d1.jpg","comment_is_top":false,"comment_ctime":1562748342,"is_pvip":false,"replies":[{"id":"63816","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577542578,"ip_address":"","comment_id":112506,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562748342","product_id":100029501,"comment_content":"作业<br><br>定义:<br><br>DELIMITER &#47;&#47;<br>CREATE PROCEDURE `get_sum_score`(<br>       OUT sum_max_hp FLOAT,<br>       s VARCHAR(255)<br>       )<br>BEGIN<br>       SELECT SUM(hp_max) FROM heros WHERE role_main = s INTO sum_max_hp;<br>end &#47;&#47;<br>DELIMITER ;<br><br><br>查询: <br><br>call get_sum_score(@sum_hp_max,&#39;坦克&#39;);<br>select @sum_hp_max;<br><br>查询结果:<br><br>@sum_hp_max|<br>-----------|<br>      83124<br><br><br>查询2:<br><br>call get_sum_score(@sum_hp_max,&#39;战士&#39;);<br>select @sum_hp_max;<br><br>查询结果:<br><br>@sum_hp_max|<br>-----------|<br>     124873","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457769,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577542578,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112497,"user_name":"陈洁","can_delete":false,"product_type":"c1","uid":1570514,"ip_address":"","ucode":"8DBDF7A85DB4BC","user_header":"https://static001.geekbang.org/account/avatar/00/17/f6/d2/dcf628d3.jpg","comment_is_top":false,"comment_ctime":1562747799,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562747799","product_id":100029501,"comment_content":"CREATE PROCEDURE<br>get_sum_score(<br>OUT sum_max_hp FLOAT,s VARCHAR(255)<br>)<br>BEGIN<br>SELECT SUM(hp_max) FROM heros WHERE role_main = s INTO sum_max_hp;<br>END<br><br>CALL get_sum_score(@sum_max_hp,&#39;战士&#39;);<br>SELECT @sum_max_hp ;","like_count":0},{"had_liked":false,"id":112495,"user_name":"时间是最真的答案","can_delete":false,"product_type":"c1","uid":1183601,"ip_address":"","ucode":"B90F3EF769F865","user_header":"https://static001.geekbang.org/account/avatar/00/12/0f/71/9273e8a4.jpg","comment_is_top":false,"comment_ctime":1562747453,"is_pvip":false,"replies":[{"id":"63719","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577530326,"ip_address":"","comment_id":112495,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562747453","product_id":100029501,"comment_content":"CREATE PROCEDURE get_sum_score(IN s VARCHAR(255),OUT sum_max_hp FLOAT)<br>BEGIN<br>\tSELECT SUM(mp_max) FROM heros WHERE role_main = s INTO sum_max_hp ;<br>END;<br><br><br>CALL get_sum_score(&#39;战士&#39;,@sum_max_hp);<br>SELECT @sum_max_hp ;","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457764,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577530326,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112486,"user_name":"leslie","can_delete":false,"product_type":"c1","uid":1324255,"ip_address":"","ucode":"798E7C1CC98CC2","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/df/64e3d533.jpg","comment_is_top":false,"comment_ctime":1562744702,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562744702","product_id":100029501,"comment_content":"       禁用的是触发器-遍历且效率偏低：大多数据库对其支持不好；存储过程最大的好处是调用方便。<br>      其实function同样是：自己写一些自定义函数还是比较方便；开发大多不喜欢，不擅长且最初麻烦；不过清晰明了。存储中加入逻辑，可以使得代码简洁且完成一些逻辑处理。<br>       有禁用的存储过程其实也有禁用视图：禁用大多是能力有限且对其掌握不好。任何一种工具都有优劣：用好了就是利器，用不好就反向伤了自己。<br>      ","like_count":0},{"had_liked":false,"id":112481,"user_name":"华夏","can_delete":false,"product_type":"c1","uid":1449474,"ip_address":"","ucode":"4D627CFA5A4B82","user_header":"https://static001.geekbang.org/account/avatar/00/16/1e/02/2864e0f2.jpg","comment_is_top":false,"comment_ctime":1562743645,"is_pvip":false,"replies":[{"id":"63723","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577530593,"ip_address":"","comment_id":112481,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562743645","product_id":100029501,"comment_content":"mysql&gt; DELIMITER &#47;&#47;<br>mysql&gt; CREATE PROCEDURE `get_sum_score`(<br>    -&gt;        OUT sum_max_hp FLOAT,<br>    -&gt;        s VARCHAR(255)<br>    -&gt;        )<br>    -&gt; BEGIN<br>    -&gt;        SELECT SUM(hp_max) FROM heros WHERE role_main = s INTO sum_max_hp; <br>    -&gt; END &#47;&#47;<br>Query OK, 0 rows affected (0.00 sec)<br><br>mysql&gt; DELIMITER ;<br>mysql&gt; CALL get_sum_score(@sum_max_hp, &#39;法师&#39;);<br>Query OK, 1 row affected (0.00 sec)<br><br>mysql&gt; SELECT @sum_max_hp;<br>+-------------+<br>| @sum_max_hp |<br>+-------------+<br>|      111317 |<br>+-------------+<br>1 row in set (0.00 sec)<br><br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457755,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577530593,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112452,"user_name":"再见湖水","can_delete":false,"product_type":"c1","uid":1580023,"ip_address":"","ucode":"2B384DB0F5DC3D","user_header":"https://static001.geekbang.org/account/avatar/00/18/1b/f7/b839e412.jpg","comment_is_top":false,"comment_ctime":1562738524,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562738524","product_id":100029501,"comment_content":"DROP PROCEDURE IF EXISTS get_sum_score<br>DELIMITER&#47;&#47;<br>CREATE PROCEDURE get_sum_score<br>(s VARCHAR(255),<br>OUT sum_max_hp FLOAT)<br>BEGIN <br>SELECT SUM(`hp_max`) FROM `heros` WHERE `role_main`=s INTO sum_max_hp;<br>END&#47;&#47;<br>DELIMITER;<br><br>CALL get_sum_score(@sum_max_hp,&#39;战士&#39;);<br>SELECT @sum_max_hp<br><br>老师为什么出现OUT or INOUT argument 2 for routine myemployees.get_sum_score is not a variable or NEW pseudo-variable in BEFORE trigger的错误 谢谢啦","like_count":0},{"had_liked":false,"id":112419,"user_name":"hlz-123","can_delete":false,"product_type":"c1","uid":1433586,"ip_address":"","ucode":"B7E5EF0C260BD2","user_header":"","comment_is_top":false,"comment_ctime":1562730030,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562730030","product_id":100029501,"comment_content":"DROP PROCEDURE IF EXISTS get_sum_core;<br>DELIMITER &#47;&#47;<br>CREATE PROCEDURE get_sum_core(<br>                 OUT sum_score FLOAT,<br>                 IN roleMain VARCHAR(255)<br>                 )<br>BEGIN<br>     SELECT SUM(hp_max) AS sum_hp_max FROM heros <br>            WHERE role_main=roleMain INTO sum_score;<br>END &#47;&#47;<br>DELIMITER ;<br>CALL get_sum_core(@sum_score,&#39;战士&#39;);<br>SELECT @sum_score;","like_count":0},{"had_liked":false,"id":112413,"user_name":"TKbook","can_delete":false,"product_type":"c1","uid":1073829,"ip_address":"","ucode":"F6E0E99CC79059","user_header":"https://static001.geekbang.org/account/avatar/00/10/62/a5/43aa0c27.jpg","comment_is_top":false,"comment_ctime":1562729509,"is_pvip":false,"replies":[{"id":"63725","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577530612,"ip_address":"","comment_id":112413,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562729509","product_id":100029501,"comment_content":"CREATE DEFINER=`root`@`localhost` PROCEDURE `get_sum_score`(OUT `hp_sum` float,IN `role` varchar(255))<br>BEGIN<br>\tSELECT sum(hp_max) FROM heros WHERE role_main = role INTO hp_sum;<br>END","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457723,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577530612,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112408,"user_name":"一叶知秋","can_delete":false,"product_type":"c1","uid":1445189,"ip_address":"","ucode":"15A95FA86B7AE4","user_header":"https://static001.geekbang.org/account/avatar/00/16/0d/45/b88a1794.jpg","comment_is_top":false,"comment_ctime":1562729297,"is_pvip":false,"replies":[{"id":"63726","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577530617,"ip_address":"","comment_id":112408,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562729297","product_id":100029501,"comment_content":"mysql&gt; delimiter &#47;&#47;<br>mysql&gt; create procedure get_sum_score(out sum_hp float, in main_type varchar(255))<br>    -&gt; begin<br>    -&gt; select sum(hp_max) from heros where role_main=main_type into sum_hp;<br>    -&gt; end&#47;&#47;<br>Query OK, 0 rows affected (0.00 sec)<br><br>mysql&gt; delimiter ;<br><br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457721,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577530617,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112380,"user_name":"Abyssknight","can_delete":false,"product_type":"c1","uid":1336361,"ip_address":"","ucode":"08E8D68E4B76BB","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/29/da537902.jpg","comment_is_top":false,"comment_ctime":1562725785,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562725785","product_id":100029501,"comment_content":"drop procedure if exists get_sum_score;<br>create procedure get_sum_score(in role varchar(255))<br>begin<br>  select sum(hp_max) as sum_hp_max from heros where role_main = role;<br>end;<br><br>call get_sum_score(&#39;战士&#39;);","like_count":0},{"had_liked":false,"id":112353,"user_name":"Defensor","can_delete":false,"product_type":"c1","uid":1575714,"ip_address":"","ucode":"BA636359596936","user_header":"https://static001.geekbang.org/account/avatar/00/18/0b/22/a26031d6.jpg","comment_is_top":false,"comment_ctime":1562722903,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1562722903","product_id":100029501,"comment_content":"CREATE PROCEDURE `get_hero_scores`(<br>       OUT max_max_hp FLOAT,<br>       OUT min_max_mp FLOAT,<br>       OUT avg_max_attack FLOAT,  <br>       s VARCHAR(255)<br>       )<br>BEGIN<br>       SELECT MAX(hp_max), MIN(mp_max), AVG(attack_max) FROM heros WHERE role_main = s INTO max_max_hp, min_max_mp, avg_max_attack;<br>END<br> 老师这个例子中的s为什么没有标明IN呢","like_count":0,"discussions":[{"author":{"id":1336361,"avatar":"https://static001.geekbang.org/account/avatar/00/14/64/29/da537902.jpg","nickname":"Abyssknight","note":"","ucode":"08E8D68E4B76BB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1599,"discussion_content":"可能是不显式声明 默认为 in","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562725825,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112330,"user_name":"柯察金","can_delete":false,"product_type":"c1","uid":1115149,"ip_address":"","ucode":"F722BF8FCD2C47","user_header":"https://static001.geekbang.org/account/avatar/00/11/04/0d/3dc5683a.jpg","comment_is_top":false,"comment_ctime":1562721365,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562721365","product_id":100029501,"comment_content":"老师，问一个与主题不大相关的问题。现在有一条 SQL 语句，是统计最近一段时间每天进入的客户。由于系统存放的是时间戳，select 中用函数进行将其转换为了 yyyymmdd 格式。大致是这个样子的:  select datefunc(createdtime) as day, count(*)as num from customer where createdtime &gt; 1562000000 group by day order by num;<br><br>这个语句特别慢，初步判断原因是由于最近一段时间加入的客户特别多，估计有上千万，然后 select 语句中的函数转换消耗了很多时间。但是，不进行时间戳转换为时间，就没有办法统计每一天加入客户的数量。<br><br>老师，有什么好的办法或者改进建议吗","like_count":0},{"had_liked":false,"id":112311,"user_name":"ack","can_delete":false,"product_type":"c1","uid":1440912,"ip_address":"","ucode":"69CA1233EEA8E2","user_header":"https://static001.geekbang.org/account/avatar/00/15/fc/90/c9df0459.jpg","comment_is_top":false,"comment_ctime":1562719251,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562719251","product_id":100029501,"comment_content":"DELIMITER &#47;&#47;<br>CREATE PROCEDURE get_sum_score(IN type VARCHAR(255),OUT sum FLOAT)<br>BEGIN<br>  SELECT SUM(hp_max) FROM heros WHERE role_main=type INTO sum;<br>END &#47;&#47;<br>DELEMITER ;","like_count":0}]}