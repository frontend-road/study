{"id":77885,"title":"26 | 案例篇：如何找出狂打日志的“内鬼”？","content":"<p>你好，我是倪朋飞。</p><p>前两节，我们学了文件系统和磁盘的 I/O 原理，我先带你复习一下。</p><p>文件系统，是对存储设备上的文件进行组织管理的一种机制。为了支持各类不同的文件系统，Linux在各种文件系统上，抽象了一层虚拟文件系统VFS。</p><p>它定义了一组所有文件系统都支持的数据结构和标准接口。这样，应用程序和内核中的其他子系统，就只需要跟 VFS 提供的统一接口进行交互。</p><p>在文件系统的下层，为了支持各种不同类型的存储设备，Linux又在各种存储设备的基础上，抽象了一个通用块层。</p><p>通用块层，为文件系统和应用程序提供了访问块设备的标准接口；同时，为各种块设备的驱动程序提供了统一的框架。此外，通用块层还会对文件系统和应用程序发送过来的 I/O 请求进行排队，并通过重新排序、请求合并等方式，提高磁盘读写的效率。</p><p>通用块层的下一层，自然就是设备层了，包括各种块设备的驱动程序以及物理存储设备。</p><p>文件系统、通用块层以及设备层，就构成了 Linux 的存储 I/O 栈。存储系统的 I/O ，通常是整个系统中最慢的一环。所以，Linux 采用多种缓存机制，来优化 I/O 的效率，比方说，</p><ul>\n<li>\n<p>为了优化文件访问的性能，采用页缓存、索引节点缓存、目录项缓存等多种缓存机制，减少对下层块设备的直接调用。</p>\n</li>\n<li>\n<p>同样的，为了优化块设备的访问效率，使用缓冲区来缓存块设备的数据。</p>\n</li>\n</ul><!-- [[[read_end]]] --><p>不过，在碰到文件系统和磁盘的 I/O 问题时，具体应该怎么定位和分析呢？今天，我就以一个最常见的应用程序记录大量日志的案例，带你来分析这种情况。</p><h2>案例准备</h2><p>本次案例还是基于 Ubuntu 18.04，同样适用于其他的 Linux 系统。我使用的案例环境如下所示：</p><ul>\n<li>\n<p>机器配置：2 CPU，8GB 内存</p>\n</li>\n<li>\n<p>预先安装 docker、sysstat 等工具，如 apt install  <a href=\"http://docker.io/\">docker.io</a>  sysstat</p>\n</li>\n</ul><p>这里要感谢唯品会资深运维工程师阳祥义帮忙，分担了今天的案例。这个案例，是一个用 Python 开发的小应用，为了方便运行，我把它打包成了一个 Docker 镜像。这样，你只要运行 Docker 命令，就可以启动它。</p><p>接下来，打开一个终端，SSH 登录到案例所用的机器中，并安装上述工具。跟以前一样，案例中所有命令，都默认以 root 用户运行。如果你是用普通用户身份登陆系统，请运行 sudo su root 命令，切换到 root 用户。</p><p>到这里，准备工作就完成了。接下来，我们正式进入操作环节。</p><blockquote>\n<p>温馨提示：案例中 Python 应用的核心逻辑比较简单，你可能一眼就能看出问题，但实际生产环境中的源码就复杂多了。所以，我依旧建议，操作之前别看源码，避免先入为主，要把它当成一个黑盒来分析。这样，你可以更好把握住，怎么从系统的资源使用问题出发，分析出瓶颈所在的应用，以及瓶颈在应用中大概的位置。</p>\n</blockquote><h2>案例分析</h2><p>首先，我们在终端中执行下面的命令，运行今天的目标应用：</p><pre><code>$ docker run -v /tmp:/tmp --name=app -itd feisky/logapp \n</code></pre><p>然后，在终端中运行 ps 命令，确认案例应用正常启动。如果操作无误，你应该可以在 ps 的输出中，看到一个 app.py 的进程：</p><pre><code>$ ps -ef | grep /app.py \nroot     18940 18921 73 14:41 pts/0    00:00:02 python /app.py \n</code></pre><p>接着，我们来看看系统有没有性能问题。要观察哪些性能指标呢？前面文章中，我们知道 CPU、内存和磁盘 I/O 等系统资源，很容易出现资源瓶颈，这就是我们观察的方向了。我们来观察一下这些资源的使用情况。</p><p>当然，动手之前你应该想清楚，要用哪些工具来做，以及工具的使用顺序又是怎样的。你可以先回忆下前面的案例和思路，自己想一想，然后再继续下面的步骤。</p><p>我的想法是，我们可以先用 top ，来观察 CPU 和内存的使用情况；然后再用 iostat ，来观察磁盘的 I/O 情况。</p><p>所以，接下来，你可以在终端中运行 top 命令，观察 CPU 和内存的使用情况：</p><pre><code># 按1切换到每个CPU的使用情况 \n$ top \ntop - 14:43:43 up 1 day,  1:39,  2 users,  load average: 2.48, 1.09, 0.63 \nTasks: 130 total,   2 running,  74 sleeping,   0 stopped,   0 zombie \n%Cpu0  :  0.7 us,  6.0 sy,  0.0 ni,  0.7 id, 92.7 wa,  0.0 hi,  0.0 si,  0.0 st \n%Cpu1  :  0.0 us,  0.3 sy,  0.0 ni, 92.3 id,  7.3 wa,  0.0 hi,  0.0 si,  0.0 st \nKiB Mem :  8169308 total,   747684 free,   741336 used,  6680288 buff/cache \nKiB Swap:        0 total,        0 free,        0 used.  7113124 avail Mem \n\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND \n18940 root      20   0  656108 355740   5236 R   6.3  4.4   0:12.56 python \n1312 root      20   0  236532  24116   9648 S   0.3  0.3   9:29.80 python3 \n</code></pre><p>观察 top 的输出，你会发现，CPU0 的使用率非常高，它的系统CPU使用率（sys%）为 6%，而 iowait 超过了 90%。这说明 CPU0 上，可能正在运行 I/O 密集型的进程。不过，究竟是什么原因呢？这个疑问先保留着，我们先继续看完。</p><p>接着我们来看，进程部分的 CPU 使用情况。你会发现， python 进程的 CPU 使用率已经达到了 6%，而其余进程的 CPU 使用率都比较低，不超过 0.3%。看起来 python 是个可疑进程。记下 python 进程的 PID 号 18940，我们稍后分析。</p><p>最后再看内存的使用情况，总内存 8G，剩余内存只有 730 MB，而 Buffer/Cache占用内存高达6GB 之多，这说明内存主要被缓存占用。虽然大部分缓存可回收，我们还是得了解下缓存的去处，确认缓存使用都是合理的。</p><p>到这一步，你基本可以判断出，CPU 使用率中的 iowait 是一个潜在瓶颈，而内存部分的缓存占比较大，那磁盘 I/O 又是怎么样的情况呢？</p><p>我们在终端中按 Ctrl+C ，停止 top 命令，再运行 iostat 命令，观察 I/O 的使用情况：</p><pre><code># -d表示显示I/O性能指标，-x表示显示扩展统计（即所有I/O指标） \n$ iostat -x -d 1 \nDevice            r/s     w/s     rkB/s     wkB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util \nloop0            0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00    0.00   0.00     0.00     0.00   0.00   0.00 \nsdb              0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00    0.00   0.00     0.00     0.00   0.00   0.00 \nsda              0.00   64.00      0.00  32768.00     0.00     0.00   0.00   0.00    0.00 7270.44 1102.18     0.00   512.00  15.50  99.20\n</code></pre><p>还记得这些性能指标的含义吗？先自己回忆一下，如果实在想不起来，查看上一节的内容，或者用 man iostat 查询。</p><p>观察 iostat 的最后一列，你会看到，磁盘 sda 的 I/O 使用率已经高达 99%，很可能已经接近 I/O 饱和。</p><p>再看前面的各个指标，每秒写磁盘请求数是 64 ，写大小是 32 MB，写请求的响应时间为 7 秒，而请求队列长度则达到了 1100。</p><p>超慢的响应时间和特长的请求队列长度，进一步验证了 I/O 已经饱和的猜想。此时，sda 磁盘已经遇到了严重的性能瓶颈。</p><p>到这里，也就可以理解，为什么前面看到的 iowait 高达 90% 了，这正是磁盘 sda 的 I/O 瓶颈导致的。接下来的重点就是分析 I/O 性能瓶颈的根源了。那要怎么知道，这些 I/O请求相关的进程呢？</p><p>不知道你还记不记得，上一节我曾提到过，可以用 pidstat 或者 iotop ，观察进程的 I/O 情况。这里，我就用 pidstat 来看一下。</p><p>使用 pidstat 加上 -d 参数，就可以显示每个进程的 I/O 情况。所以，你可以在终端中运行如下命令来观察：</p><pre><code>$ pidstat -d 1 \n\n15:08:35      UID       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command \n15:08:36        0     18940      0.00  45816.00      0.00      96  python \n\n15:08:36      UID       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command \n15:08:37        0       354      0.00      0.00      0.00     350  jbd2/sda1-8 \n15:08:37        0     18940      0.00  46000.00      0.00      96  python \n15:08:37        0     20065      0.00      0.00      0.00    1503  kworker/u4:2 \n</code></pre><p>从 pidstat 的输出，你可以发现，只有 python 进程的写比较大，而且每秒写的数据超过 45 MB，比上面 iostat 发现的 32MB 的结果还要大。很明显，正是 python 进程导致了 I/O 瓶颈。</p><p>再往下看 iodelay 项。虽然只有 python 在大量写数据，但你应该注意到了，有两个进程 （kworker 和 jbd2 ）的延迟，居然比 python 进程还大很多。</p><p>这其中，kworker 是一个内核线程，而 jbd2 是 ext4 文件系统中，用来保证数据完整性的内核线程。他们都是保证文件系统基本功能的内核线程，所以具体细节暂时就不用管了，我们只需要明白，它们延迟的根源还是大量 I/O。</p><p>综合pidstat的输出来看，还是python进程的嫌疑最大。接下来，我们来分析 python 进程到底在写什么。</p><p>首先留意一下 python 进程的 PID 号， 18940。看到 18940 ，你有没有觉得熟悉？其实前面在使用top时，我们记录过的 CPU 使用率最高的进程，也正是它。不过，虽然在top中使用率最高，也不过是 6%，并不算高。所以，以I/O问题为分析方向还是正确的。</p><p>知道了进程的 PID 号，具体要怎么查看写的情况呢？</p><p>其实，我在系统调用的案例中讲过，读写文件必须通过系统调用完成。观察系统调用情况，就可以知道进程正在写的文件。想起 strace 了吗，它正是我们分析系统调用时最常用的工具。</p><p>接下来，我们在终端中运行strace 命令，并通过 -p 18940 指定 python 进程的 PID 号：</p><pre><code>$ strace -p 18940 \nstrace: Process 18940 attached \n...\nmmap(NULL, 314576896, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f0f7aee9000 \nmmap(NULL, 314576896, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f0f682e8000 \nwrite(3, &quot;2018-12-05 15:23:01,709 - __main&quot;..., 314572844 \n) = 314572844 \nmunmap(0x7f0f682e8000, 314576896)       = 0 \nwrite(3, &quot;\\n&quot;, 1)                       = 1 \nmunmap(0x7f0f7aee9000, 314576896)       = 0 \nclose(3)                                = 0 \nstat(&quot;/tmp/logtest.txt.1&quot;, {st_mode=S_IFREG|0644, st_size=943718535, ...}) = 0 \n</code></pre><p>从 write() 系统调用上，我们可以看到，进程向文件描述符编号为 3 的文件中，写入了 300MB 的数据。看来，它应该是我们要找的文件。不过，write() 调用中只能看到文件的描述符编号，文件名和路径还是未知的。</p><p>再观察后面的 stat() 调用，你可以看到，它正在获取 /tmp/logtest.txt.1 的状态。 这种“点+数字格式”的文件，在日志回滚中非常常见。我们可以猜测，这是第一个日志回滚文件，而正在写的日志文件路径，则是/tmp/logtest.txt。</p><p>当然，这只是我们的猜测，自然还需要验证。这里，我再给你介绍一个新的工具 lsof。它专门用来查看进程打开文件列表，不过，这里的“文件”不只有普通文件，还包括了目录、块设备、动态库、网络套接字等。</p><p>接下来，我们在终端中运行下面的 lsof 命令，看看进程 18940 都打开了哪些文件：</p><pre><code>$ lsof -p 18940 \nCOMMAND   PID USER   FD   TYPE DEVICE  SIZE/OFF    NODE NAME \npython  18940 root  cwd    DIR   0,50      4096 1549389 / \npython  18940 root  rtd    DIR   0,50      4096 1549389 / \n… \npython  18940 root    2u   CHR  136,0       0t0       3 /dev/pts/0 \npython  18940 root    3w   REG    8,1 117944320     303 /tmp/logtest.txt \n</code></pre><p>这个输出界面中，有几列我简单介绍一下，FD 表示文件描述符号，TYPE 表示文件类型，NAME 表示文件路径。这也是我们需要关注的重点。</p><p>再看最后一行，这说明，这个进程打开了文件 /tmp/logtest.txt，并且它的文件描述符是 3 号，而3 后面的 w ，表示以写的方式打开。</p><p>这跟刚才 strace 完我们猜测的结果一致，看来这就是问题的根源：进程 18940 以每次 300MB 的速度，在“疯狂”写日志，而日志文件的路径是 /tmp/logtest.txt。</p><p>既然找出了问题根源，接下来按照惯例，就该查看源代码，然后分析为什么这个进程会狂打日志了。</p><p>你可以运行 docker cp 命令，把案例应用的源代码拷贝出来，然后查看它的内容。（你也可以点击<a href=\"https://github.com/feiskyer/linux-perf-examples/tree/master/logging-app\">这里</a>查看案例应用的源码）：</p><pre><code>#拷贝案例应用源代码到当前目录\n$ docker cp app:/app.py . \n\n#查看案例应用的源代码\n$ cat app.py \n\nlogger = logging.getLogger(__name__) \nlogger.setLevel(level=logging.INFO) \nrHandler = RotatingFileHandler(&quot;/tmp/logtest.txt&quot;, maxBytes=1024 * 1024 * 1024, backupCount=1) \nrHandler.setLevel(logging.INFO) \n\ndef write_log(size): \n  '''Write logs to file''' \n  message = get_message(size) \n  while True: \n    logger.info(message) \n    time.sleep(0.1) \n\nif __name__ == '__main__': \n  msg_size = 300 * 1024 * 1024 \n  write_log(msg_size) \n</code></pre><p>分析这个源码，我们发现，它的日志路径是 /tmp/logtest.txt，默认记录 INFO 级别以上的所有日志，而且每次写日志的大小是 300MB。这跟我们上面的分析结果是一致的。</p><p>一般来说，生产系统的应用程序，应该有动态调整日志级别的功能。继续查看源码，你会发现，这个程序也可以调整日志级别。如果你给它发送 SIGUSR1 信号，就可以把日志调整为 INFO 级；发送 SIGUSR2 信号，则会调整为 WARNING 级：</p><pre><code>def set_logging_info(signal_num, frame): \n  '''Set loging level to INFO when receives SIGUSR1''' \n  logger.setLevel(logging.INFO) \n\ndef set_logging_warning(signal_num, frame): \n  '''Set loging level to WARNING when receives SIGUSR2''' \n  logger.setLevel(logging.WARNING) \n\nsignal.signal(signal.SIGUSR1, set_logging_info) \nsignal.signal(signal.SIGUSR2, set_logging_warning) \n</code></pre><p>根据源码中的日志调用 logger. info(message) ，我们知道，它的日志是 INFO 级，这也正是它的默认级别。那么，只要把默认级别调高到 WARNING 级，日志问题应该就解决了。</p><p>接下来，我们就来检查一下，刚刚的分析对不对。在终端中运行下面的 kill 命令，给进程 18940 发送 SIGUSR2 信号：</p><pre><code>$ kill -SIGUSR2 18940 \n</code></pre><p>然后，再执行 top 和 iostat 观察一下：</p><pre><code>$ top \n... \n%Cpu(s):  0.3 us,  0.2 sy,  0.0 ni, 99.5 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st \n</code></pre><pre><code>$ iostat -d -x 1\nDevice            r/s     w/s     rkB/s     wkB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util \nloop0            0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00    0.00   0.00     0.00     0.00   0.00   0.00 \nsdb              0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00    0.00   0.00     0.00     0.00   0.00   0.00 \nsda              0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00    0.00   0.00     0.00     0.00   0.00   0.00\n</code></pre><p>观察top 和 iostat 的输出，你会发现，稍等一段时间后，iowait 会变成 0，而 sda 磁盘的 I/O 使用率也会逐渐减少到 0。</p><p>到这里，我们不仅定位了狂打日志的应用程序，并通过调高日志级别的方法，完美解决了 I/O 的性能瓶颈。</p><p>案例最后，当然不要忘了运行下面的命令，停止案例应用：</p><pre><code>$ docker rm -f app \n</code></pre><h2>小结</h2><p>日志，是了解应用程序内部运行情况，最常用、也最有效的工具。无论是操作系统，还是应用程序，都会记录大量的运行日志，以便事后查看历史记录。这些日志一般按照不同级别来开启，比如，开发环境通常打开调试级别的日志，而线上环境则只记录警告和错误日志。</p><p>在排查应用程序问题时，我们可能需要，在线上环境临时开启应用程序的调试日志。有时候，事后一不小心就忘了调回去。没把线上的日志调高到警告级别，可能会导致 CPU 使用率、磁盘 I/O 等一系列的性能问题，严重时，甚至会影响到同一台服务器上运行的其他应用程序。</p><p>今后，在碰到这种“狂打日志”的场景时，你可以用 iostat、strace、lsof 等工具来定位狂打日志的进程，找出相应的日志文件，再通过应用程序的接口，调整日志级别来解决问题。</p><p>如果应用程序不能动态调整日志级别，你可能还需要修改应用的配置，并重启应用让配置生效。</p><h2>思考</h2><p>最后，给你留一个思考题。</p><p>在今天的案例开始时，我们用 top 和 iostat 查看了系统资源的使用情况。除了 CPU 和磁盘 I/O外，剩余内存也比较少，而内存主要被 Buffer/Cache 占用。</p><p>那么，今天的问题就是，这些内存到底是被 Buffer 还是 Cache 占用了呢？有没有什么方法来确认你的分析结果呢？</p><p>欢迎在留言区和我讨论，也欢迎把这篇文章分享给你的同事、朋友。我们一起在实战中演练，在交流中进步。</p><p></p>","comments":[{"had_liked":false,"id":61894,"user_name":"hua168","can_delete":false,"product_type":"c1","uid":1065255,"ip_address":"","ucode":"CFF9A7E86EBA48","user_header":"https://static001.geekbang.org/account/avatar/00/10/41/27/3ff1a1d6.jpg","comment_is_top":false,"comment_ctime":1547830387,"is_pvip":false,"replies":[{"id":"22573","content":"看前面的经历，技术面还是挺广的，但可能很多地方都不太深入。<br><br>建议还是先找份工作吧，长期待业可能会加重焦虑。然后可以根据实际工作需要，先把工作需要的知识技能加深掌握。等到可以从容应对工作的时候，再考虑在某个领域加强深入。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548575122,"ip_address":"","comment_id":61894,"utype":1}],"discussion_count":13,"race_medal":0,"score":"366620050547","product_id":100020901,"comment_content":"大神，能问一个题外话吗，关于自己人生规划，水平和眼界所限，想不通，<br>都说大神级见识很广也多，能给我这个35岁只维护过四五十台linux服务器的运维指条路吗？<br>现在很迷茫和压力大~~<br>能力如下：<br>一.网络：CCNA水平，自过了CCNP忘记了，当过2年网管<br>二、维护过asp.net电商网站，3年，只有简单的，兼职网管<br>三、linux运维，只在一家电商做了3年多，会<br>1.web：nginx、tomcat配置（少用）+php:nignx的rewirte和反代<br>2.数据库：mysql、mongoDB、redis 配置及主从，不会mycat、Cetus之类<br>3.反代：会nginx、haproxy简单配置<br>4.存储：NFS、fastDFS、hadoop简单看了一下<br>5.版本控制：只会git及搭建gitlab+jenkins（简单的CI&#47;CD）<br>6.监控：简单配置zabbix+shell脚本<br>7.虚拟化：kvm安装及配置、docker(k8s还没学)<br>8.云计算：openstack只会安装做过实验<br>9.测试：只会ab工具<br>10.日志：ELK安装配置，还没结合java（在学中）<br>11.大数据：没使用过（不会flume、storm、spark、flink、kafka）<br>12.脚本：主要是shell为主、会点python<br><br>四、编程能力：自学，没项目经验<br>1.前端：<br>  1）HTML（HTML5不怎看）<br>  2）css（laiui、学了一下vue）<br>  3) js、jquery框架、ES6简单看了一下  <br>2.PHP：语法简单的thinkphp5框架<br>3.java：考虑要维护java web在学<br>\t只看了java、jsp及servet、spring、springMVC、spring Boot（这个为主）<br>4.python：考虑运维用到<br>\tpython：会简单的脚本<br>\tdjango：只会官网简单的<br>\t<br>问题是：现在已35岁了，失业，怎办？年龄摆在那里，能力好像不强，学历大专。<br>能给个建议吗？非常感谢~~","like_count":85,"discussions":[{"author":{"id":2393362,"avatar":"","nickname":"Geek_4c721a","note":"","ucode":"0A81294AB5BB37","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383176,"discussion_content":"要选好方向专攻，既然是运维，那前端的完全放弃，不要浪费时间，前端交给专业的前端去做","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1625969974,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437029,"discussion_content":"看前面的经历，技术面还是挺广的，但可能很多地方都不太深入。\n\n建议还是先找份工作吧，长期待业可能会加重焦虑。然后可以根据实际工作需要，先把工作需要的知识技能加深掌握。等到可以从容应对工作的时候，再考虑在某个领域加强深入。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1548575122,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1308196,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f6/24/5a9277f1.jpg","nickname":"ghostwritten","note":"","ucode":"AE512F2E24A1A0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383566,"discussion_content":"从运维出发，linux，shell熟练，python能完成需求任务，go可以完成功能性任务，k8s熟练。这应该是目前很多工程师的水平吧，也是质变的一个瓶颈，对于其他各个开源项目，nginx,es......,到哪具体到项目相信也不会拉下。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1626161562,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2466127,"avatar":"","nickname":"Geek_d60e46","note":"","ucode":"AB8E529461DCA5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":365292,"discussion_content":"同在运维的坑里挣扎。个人感觉没有平台，真的是步履维艰。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1617763088,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1543040,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/80/8702bd5f.jpg","nickname":"evan","note":"","ucode":"491B073D5AFEDE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":317967,"discussion_content":"太广泛了 选一个方向专供吧~\n大数据(java+hadoop全家桶)\n云计算(openstack(vm)/k8s(容器云))  \n鉴于你的经历, 推荐k8s吧~ ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1603623791,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1916685,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/3f/0d/1e8dbb2c.jpg","nickname":"怀揣梦想的学渣","note":"","ucode":"2349B9F4F6FDE3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":217934,"discussion_content":"云计算这部分，如果不涉及参与开发，只是做业务交付的话，厂商打包好的产品是最省心的。如果只是做业务的运营，也可以赚到一些钱，但是从运维的职业寿命看，我前面提到的两种选择，更像是混日子，很是尴尬。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1585585269,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1504291,"avatar":"https://static001.geekbang.org/account/avatar/00/16/f4/23/993e7f05.jpg","nickname":"几度浮沉","note":"","ucode":"B538711E6826C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":206779,"discussion_content":"不要否定自己，打好基础，多思考，多实战，最好多接触实例案例，是成长的最佳之路。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584443029,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1624538,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/jAsPmqra89uLYer998tsdAmHIxy9iaVfLIkzkTB3ITfUZg21Yiadf73TqmcFZXTEv2wuQicDA2uvqXvicHJ9HckBWg/132","nickname":"Geek_c991f2","note":"","ucode":"0FDE8CE24B8E32","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":35457,"discussion_content":"不深入,有没有说推荐往哪个方向深入?devops?深入python还是java还是web前端?运维在广度还是深度?还是深入运维技术,监控,性能调优?感觉好多东西,不知道哪里先入手比较好","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1571282812,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1085089,"avatar":"https://static001.geekbang.org/account/avatar/00/10/8e/a1/c05ab3b3.jpg","nickname":"咖啡猫","note":"","ucode":"64F4CB55DD11B5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":347504,"discussion_content":"作为一名运维人员，本身行业就是接触面挺广的，随着经验增长，慢慢就成了全能型吧，感觉大哥以前肯定没深入去学习，都是肤浅的学习了一些大概方向上的知识，并没有去坚持下去，后面学的运维开发的相关知识，如果坚持下去，(并且也找到了运维开发的工作)方向还是很明朗的，如果坚持不下去的话，就属于基础运维岗，选择一家公司，能去的就踏实干下去，不轻易跳槽，基本就这样了....... ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612244444,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1705468,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/05/fc/bceb3f2b.jpg","nickname":"开心哥","note":"","ucode":"D44C1F03B23C5A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332791,"discussion_content":"大哥，加油","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607339715,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1504291,"avatar":"https://static001.geekbang.org/account/avatar/00/16/f4/23/993e7f05.jpg","nickname":"几度浮沉","note":"","ucode":"B538711E6826C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":206780,"discussion_content":"服务器数量还是太少了，我这边2000多台机器，每天会接触更多实战场景，多总结多思考，发现你会成长的更快。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584443109,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1000439,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/43/f7/abb7bfe3.jpg","nickname":"刘冲","note":"","ucode":"0C4F66921AE76C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":41460,"discussion_content":"随便选一个感兴趣的，深入搞，就完事了，个人建议，搞大数据，学java这条路","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572431930,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1305633,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ec/21/b0fe1bfd.jpg","nickname":"Adam","note":"","ucode":"338BA720880E4F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7766,"discussion_content":"这位大哥的技术面确实挺广的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567666314,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61866,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1547822905,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"186231416633","product_id":100020901,"comment_content":"[D26打卡]<br>又是老套路了，哈哈。<br>先是top看%iowait到升高，再看pidstat是哪个进程在操作磁盘，再strace看进程的调用栈。<br>看&#47;proc&#47;meminfo就可以看到系统的buffer和cache各占了多少吧。前后一对比就知道是谁了。😄","like_count":43},{"had_liked":false,"id":61700,"user_name":"Christmas","can_delete":false,"product_type":"c1","uid":1219172,"ip_address":"","ucode":"F48F6BE4A7595B","user_header":"https://static001.geekbang.org/account/avatar/00/12/9a/64/ad837224.jpg","comment_is_top":false,"comment_ctime":1547777065,"is_pvip":false,"replies":[{"id":"22325","content":"嗯嗯 是的，并且这个工具需要知道哪个文件","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548250848,"ip_address":"","comment_id":61700,"utype":1}],"discussion_count":1,"race_medal":0,"score":"143281697833","product_id":100020901,"comment_content":"pcstat(page cache stat)这个可以查看目标log文件在cache中的大小","like_count":33,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436961,"discussion_content":"嗯嗯 是的，并且这个工具需要知道哪个文件","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548250848,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62824,"user_name":"无名老卒","can_delete":false,"product_type":"c1","uid":1348261,"ip_address":"","ucode":"48874CE670E122","user_header":"","comment_is_top":false,"comment_ctime":1548166544,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"117512283536","product_id":100020901,"comment_content":"查看buffer&#47;cache占用，建议使用pcstat或者hcache，hcache是基于pcstat的，pcstat可以查看某个文件是否被缓存和根据进程pid来查看都缓存了哪些文件。hcache在其基础上增加了查看整个操作系统Cache和根据使用Cache大小排序的特性。<br><br>[root@linjx ~]# hcache --top 3<br>+--------------------------+----------------+------------+-----------+---------+<br>| Name                     | Size (bytes)   | Pages      | Cached    | Percent |<br>|--------------------------+----------------+------------+-----------+---------|<br>| &#47;usr&#47;bin&#47;containerd      | 44250880       | 10804      | 10804     | 100.000 |<br>| &#47;usr&#47;bin&#47;dockerd-ce      | 81622264       | 19928      | 8319      | 041.745 |<br>| &#47;usr&#47;bin&#47;containerd-shim | 4972896        | 1215       | 1215      | 100.000 |<br>+--------------------------+----------------+------------+-----------+---------+<br>","like_count":27},{"had_liked":false,"id":61699,"user_name":"划时代","can_delete":false,"product_type":"c1","uid":1061454,"ip_address":"","ucode":"9554CE2F83B77F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/2o1Izf2YyJSnnI0ErZ51pYRlnrmibqUTaia3tCU1PjMxuwyXSKOLUYiac2TQ5pd5gNGvS81fVqKWGvDsZLTM8zhWg/132","comment_is_top":false,"comment_ctime":1547777031,"is_pvip":false,"replies":[{"id":"22324","content":"谢谢指出，确实只是文件名称的旋转，内容并没有回滚","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548250769,"ip_address":"","comment_id":61699,"utype":1}],"discussion_count":3,"race_medal":0,"score":"113216926727","product_id":100020901,"comment_content":"指出老师的一个问题，“日志回滚文件”，打印日志的过程中从直觉来看很容易误认为日志是在“回滚”，我也犯过这样的错误；rotating英文直译为“旋转”或“轮流”，实际的日志打印过程中，日志名称是“旋转”的，例如log.1(当前打印的日志文件并且一直会打印这个文件)，log.2(较早日志)，log.3(更早日志)，当触发“旋转”条件时，日志名称会发生变更，假如log.3是上限数，那么log.3发生“旋转”就被remove，log.2被rename为log.3。更形象一点的描述是，日志名称发生了滚动，log.1=&gt;log.2=&gt;log.3不断的更新。","like_count":26,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436960,"discussion_content":"谢谢指出，确实只是文件名称的旋转，内容并没有回滚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548250769,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1308729,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f8/39/4089c9b5.jpg","nickname":"胖子罗","note":"","ucode":"AF45AEED6064B3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577531,"discussion_content":"日志滚动","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656166823,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1292330,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/VX0ib4CV0m7fwxB2xFcIJaYYWXXpfxxYbfBErqBej9395hgZszqS3dz9bThCxOuFfJ8Xibx9HbdNmZJwL5m33wIw/132","nickname":"chaoxifuchen","note":"","ucode":"95DCC5C4994F68","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":392776,"discussion_content":"感觉叫轮转好一些","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631114271,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61705,"user_name":"郭江伟","can_delete":false,"product_type":"c1","uid":1313994,"ip_address":"","ucode":"613D638619B5A2","user_header":"https://static001.geekbang.org/account/avatar/00/14/0c/ca/6173350b.jpg","comment_is_top":false,"comment_ctime":1547778216,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"70267254952","product_id":100020901,"comment_content":"buffers&#47;cached使用情况可以从proc文件系统看：<br>gjw@gjw:~$ cat &#47;proc&#47;meminfo <br>MemTotal:        7588504 kB<br>MemFree:         3621800 kB<br>MemAvailable:    6335912 kB<br>Buffers:          473920 kB<br>Cached:          2491192 kB","like_count":16},{"had_liked":false,"id":61664,"user_name":"ninuxer","can_delete":false,"product_type":"c1","uid":1243135,"ip_address":"","ucode":"5394ADAF2667D6","user_header":"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKQMM4m7NHuicr55aRiblTSEWIYe0QqbpyHweaoAbG7j2v7UUElqqeP3Ihrm3UfDPDRb1Hv8LvPwXqA/132","comment_is_top":false,"comment_ctime":1547770859,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23022607339","product_id":100020901,"comment_content":"打卡day27<br>应该是被cache占用，因为内存篇提到cache主要是负责文件的读写缓存，buffer是负责块设备读写缓存，而案例中写的是文件<br>可以通过cachestat验证","like_count":5},{"had_liked":false,"id":62273,"user_name":"J","can_delete":false,"product_type":"c1","uid":1204008,"ip_address":"","ucode":"7F1BD7F66F4700","user_header":"https://static001.geekbang.org/account/avatar/00/12/5f/28/17ed19bc.jpg","comment_is_top":false,"comment_ctime":1547999144,"is_pvip":false,"replies":[{"id":"22140","content":"可以的，比如调高到警告级别，那么 info() 实际上就不写了","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548116645,"ip_address":"","comment_id":62273,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18727868328","product_id":100020901,"comment_content":"logger.info(message)的情况下，还可以使用logger.setLevel修改日志级别吗？","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437155,"discussion_content":"可以的，比如调高到警告级别，那么 info() 实际上就不写了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548116645,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":225502,"user_name":"hello","can_delete":false,"product_type":"c1","uid":1510495,"ip_address":"","ucode":"C6FC61A90F202B","user_header":"https://static001.geekbang.org/account/avatar/00/17/0c/5f/4cbcbfb9.jpg","comment_is_top":false,"comment_ctime":1591771274,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14476673162","product_id":100020901,"comment_content":"打卡。我的《linux性能优化实践》学习笔记分享给大家(持续更新中)：https:&#47;&#47;github.com&#47;chenhongjun&#47;linux-","like_count":3},{"had_liked":false,"id":61824,"user_name":"Geek_41dcba","can_delete":false,"product_type":"c1","uid":1089626,"ip_address":"","ucode":"22F9180FBD74F5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/wjK0unDiaUMZYGsl43dovmLWZS6WvDzpespydKfOQHDU55QPZQZvfKKYk4ZaITibGc3wwC3vqTTudWficcPhEia0Xw/132","comment_is_top":false,"comment_ctime":1547810728,"is_pvip":true,"replies":[{"id":"22331","content":"嗯 可以实际操作验证一下","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548251481,"ip_address":"","comment_id":61824,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14432712616","product_id":100020901,"comment_content":"在回答今天的思考题前，我想需要明确两个前提，一个是Buffer到底在整个系统结构的哪一层，会不会是不是在IO调度器的下一层，我想应该会，理由是Buffer缓存磁盘内容调度器合并后再去写磁盘效率更好;另一个是之前有看到留言对于文件系统使用带Cache的IO操作底层为了性能Buffer和Cache是合并的，如果是这样那我就从逻辑上认为它们是分开的，这样好回答问题(声明我没看过底层代码都是没有代码依据的)。  我认为增长的地方都在Buffer里面，Cache里面的内容可以经过IO调度器整理后放Buffer，没有理由说磁盘阻塞，Cache就不能移动到Buffer  查看数据的地方在&#47;proc&#47;meminfo。<br><br>上面的都想法今天没有时间验证，要明天了!","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437008,"discussion_content":"嗯 可以实际操作验证一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548251481,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345626,"user_name":"肥low","can_delete":false,"product_type":"c1","uid":1043480,"ip_address":"","ucode":"A158AFAAB8C742","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ec/18/bf7254d3.jpg","comment_is_top":false,"comment_ctime":1652440275,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10242374867","product_id":100020901,"comment_content":"课下作业我是用的 free -w 命令,这样可以显示 Buffer 和 Cache 的分别占用情况了","like_count":2},{"had_liked":false,"id":85342,"user_name":"小肥皂酱","can_delete":false,"product_type":"c1","uid":1167821,"ip_address":"","ucode":"12A039F7166DE0","user_header":"https://static001.geekbang.org/account/avatar/00/11/d1/cd/2747b687.jpg","comment_is_top":false,"comment_ctime":1555040757,"is_pvip":false,"replies":[{"id":"30628","content":"应该是退出了，docker logs app看看是什么错误信息","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1555074378,"ip_address":"","comment_id":85342,"utype":1}],"discussion_count":5,"race_medal":0,"score":"10144975349","product_id":100020901,"comment_content":"老师，我运行docker run -v &#47;tmp:&#47;tmp --name=app -itd feisky&#47;logapp 这个命令几秒后这个进程就不在了。怎么回事呢 ","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446638,"discussion_content":"应该是退出了，docker logs app看看是什么错误信息","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555074378,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2803070,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/gTnAoZ9fJ3K2G9Mib3ecwt1ngfM1EkNm19e6xlpj1ibwruuleMne129icIHRc41td2RXtz7PE4v4NfKczEXhictjgA/132","nickname":"111qqz","note":"","ucode":"16C24D8347912B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":574686,"discussion_content":"内存小的机器可能是OOM了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654245181,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2259219,"avatar":"","nickname":"Geek_fd8a50","note":"","ucode":"839EFBF398CCE3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":331052,"discussion_content":"请问容器镜像是否有下载链接？感谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606753032,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1580782,"avatar":"https://static001.geekbang.org/account/avatar/00/18/1e/ee/48f39616.jpg","nickname":"高高的高","note":"","ucode":"607BD31319B29E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302271,"discussion_content":"关闭selinux","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598863836,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1246017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/03/41/ba59e1ee.jpg","nickname":"Ethan","note":"","ucode":"6856180D7B2525","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":19856,"discussion_content":"在CentOS 7.5下，会出现如下错误：\n\n[root@localhost tmp]# docker run -v /tmp:/tmp --name=app -itd feisky/logapp \n9232e6efd3c0d27b29f5c95e0bb7d12bd3abd6462891d85a5cfd8879d12f7c2c\n[root@localhost tmp]# docker logs app\nTraceback (most recent call last):\n  File &#34;/app.py&#34;, line 15, in <module>\n    &#34;/tmp/logtest.txt&#34;, maxBytes=1024 * 1024 * 1024, backupCount=1)\n  File &#34;/usr/local/lib/python3.7/logging/handlers.py&#34;, line 147, in __init__\n    BaseRotatingHandler.__init__(self, filename, mode, encoding, delay)\n  File &#34;/usr/local/lib/python3.7/logging/handlers.py&#34;, line 54, in __init__\n    logging.FileHandler.__init__(self, filename, mode, encoding, delay)\n  File &#34;/usr/local/lib/python3.7/logging/__init__.py&#34;, line 1092, in __init__\n    StreamHandler.__init__(self, self._open())\n  File &#34;/usr/local/lib/python3.7/logging/__init__.py&#34;, line 1121, in _open\n    return open(self.baseFilename, self.mode, encoding=self.encoding)\nPermissionError: [Errno 13] Permission denied: &#39;/tmp/logtest.txt&#39;\n[root@localhost tmp]# ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569231110,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62152,"user_name":"小老鼠","can_delete":false,"product_type":"c1","uid":1257460,"ip_address":"","ucode":"C663A0C863A515","user_header":"https://static001.geekbang.org/account/avatar/00/13/2f/f4/2dede51a.jpg","comment_is_top":false,"comment_ctime":1547958859,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10137893451","product_id":100020901,"comment_content":"我觉的应该是cache，写日志，日志是文件","like_count":2},{"had_liked":false,"id":61663,"user_name":"wtcctw","can_delete":false,"product_type":"c1","uid":1141208,"ip_address":"","ucode":"EECBBB9AC08CD9","user_header":"https://static001.geekbang.org/account/avatar/00/11/69/d8/112f69f8.jpg","comment_is_top":false,"comment_ctime":1547770445,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10137705037","product_id":100020901,"comment_content":"逻辑清晰，步骤详细，赞","like_count":2},{"had_liked":false,"id":352206,"user_name":"肥low","can_delete":false,"product_type":"c1","uid":1043480,"ip_address":"","ucode":"A158AFAAB8C742","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ec/18/bf7254d3.jpg","comment_is_top":false,"comment_ctime":1658455769,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5953423065","product_id":100020901,"comment_content":"用 vmstat -w 1 就能知道具体是buffer还是cache占得多了","like_count":1},{"had_liked":false,"id":297447,"user_name":"Geek_c38736","can_delete":false,"product_type":"c1","uid":2204497,"ip_address":"","ucode":"6EF2F8FA78C0D2","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLV02BvM8NIcaNibOQeYxSLzfECL2WvmMTGMe2eiccclBLWibyPUL0SMTkelBuibyl8FQB5vG5R5ia6Btg/132","comment_is_top":false,"comment_ctime":1623557560,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5918524856","product_id":100020901,"comment_content":"请问文章中开始显示的iowait cpu都已经92%多了，这个python进程的使用率为什么只有6%. 难道使用率里面不包含iowait cpu的统计吗？","like_count":1,"discussions":[{"author":{"id":1226968,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b8/d8/f81b5604.jpg","nickname":"hcyycb","note":"","ucode":"77FF6CA41F9E66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393235,"discussion_content":"iowait 是CPU空闲时有磁盘io请求。Python 只占6%，数据对得上，合理啊。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631322099,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":142200,"user_name":"张洁","can_delete":false,"product_type":"c1","uid":1433129,"ip_address":"","ucode":"671C066DF85521","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/wEWLExAiboszs7l38p72XshYmQ1WSbMT9VGdlHnmGTuqWyLiaZAppCzLHSrBKaKzjL8YbtxGySsvP225Ct0NViaEQ/132","comment_is_top":false,"comment_ctime":1571308885,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5866276181","product_id":100020901,"comment_content":"老师，你好。测试中遇到的情况跟你说的不太一样。<br>iostat -d -x 1得到的结果<br>%util达到99%，IOPS 90，吞吐量 700KB&#47;S，响应时间 10ms，平均等待队列1.1；<br>top 看到iowait 30%，不到60%；<br>并发数增加，cpu、内存使用率都没有增加，磁盘使用率99%；<br>如何判断出磁盘是否已经达到了饱和？对于这个结果，我不能分析出磁盘是否达到了瓶颈。<br>是否可以指点下？可否利用磁盘最大的IOPS来判断是否磁盘达到了瓶颈？谢谢！","like_count":1,"discussions":[{"author":{"id":1226968,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b8/d8/f81b5604.jpg","nickname":"hcyycb","note":"","ucode":"77FF6CA41F9E66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393236,"discussion_content":"可能你服务器的硬件性能不同。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631322175,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":125250,"user_name":"小苏","can_delete":false,"product_type":"c1","uid":1501618,"ip_address":"","ucode":"1A4776F948C6F5","user_header":"https://static001.geekbang.org/account/avatar/00/16/e9/b2/6a9203b5.jpg","comment_is_top":false,"comment_ctime":1566131403,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"5861098699","product_id":100020901,"comment_content":"strace -p 18923<br>Process 18923 attached<br>futex(0x7fbe2c2e39d0, FUTEX_WAIT, 18924, NULL<br>我好像对每个进程执行该命令都会卡在这地方.这个命令基本上用不上,不知道怎么回事.","like_count":1,"discussions":[{"author":{"id":1160951,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b6/f7/3c3b1385.jpg","nickname":"海胆阶段","note":"","ucode":"7A8C4BB4D0CDB8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":370958,"discussion_content":"reference: https://meenakshi02.wordpress.com/2011/02/02/strace-hanging-at-futex/\n原因可能是你在Strace parent process, 而这个parent 进程没做什么，但在等待它的子线程，所以你要找到子线程再去strace","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1619592770,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1054546,"avatar":"https://static001.geekbang.org/account/avatar/00/10/17/52/8e72876e.jpg","nickname":"iq2wh","note":"","ucode":"B2C894ED48B2EF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1160951,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b6/f7/3c3b1385.jpg","nickname":"海胆阶段","note":"","ucode":"7A8C4BB4D0CDB8","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386826,"discussion_content":"谢谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627822009,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":370958,"ip_address":""},"score":386826,"extra":""},{"author":{"id":1308729,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f8/39/4089c9b5.jpg","nickname":"胖子罗","note":"","ucode":"AF45AEED6064B3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1160951,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b6/f7/3c3b1385.jpg","nickname":"海胆阶段","note":"","ucode":"7A8C4BB4D0CDB8","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577535,"discussion_content":"学习了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656167028,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":370958,"ip_address":""},"score":577535,"extra":""}]},{"author":{"id":1786819,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/43/c3/2c53acd7.jpg","nickname":"雄鹰","note":"","ucode":"67E0C4BDE7F6F2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295841,"discussion_content":"老铁：我也遇到这个问题，请问你找到原因没？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596361341,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115138,"user_name":"Hinimix","can_delete":false,"product_type":"c1","uid":1316937,"ip_address":"","ucode":"7994136C93BD89","user_header":"https://static001.geekbang.org/account/avatar/00/14/18/49/b1d864e5.jpg","comment_is_top":false,"comment_ctime":1563499277,"is_pvip":false,"replies":[{"id":"42494","content":"不同编程语言都有相应的库函数可以调用。案例中Python的使用方法可以参考https:&#47;&#47;github.com&#47;feiskyer&#47;linux-perf-examples&#47;blob&#47;master&#47;logging-app&#47;app.py#L47","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1563806114,"ip_address":"","comment_id":115138,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5858466573","product_id":100020901,"comment_content":"老师，代码里怎么写能接受sigusr这个参数呢，现在每次改级别我都是改配置文件然后重启","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458983,"discussion_content":"不同编程语言都有相应的库函数可以调用。案例中Python的使用方法可以参考https://github.com/feiskyer/linux-perf-examples/blob/master/logging-app/app.py#L47","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563806114,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1112139,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f8/4b/5ae62b10.jpg","nickname":"Geek_b04b12","note":"","ucode":"F8705A21FCDF09","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5624,"discussion_content":"php里面有pcntl 系列函数介绍的是有关SIGxx相关的信号，因为这个php诞生了swoole ","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1566391134,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62524,"user_name":"渡渡鸟_linux","can_delete":false,"product_type":"c1","uid":1227772,"ip_address":"","ucode":"099BB11A3201D3","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ernR4NKI5tejJAV3HMTF3gszBBUAjkjLO2QYic2gx5dMGelFv4LWibib7CUGexmMcMp5HiaaibmOH3dyHg/132","comment_is_top":false,"comment_ctime":1548081131,"is_pvip":false,"replies":[{"id":"22126","content":"sys使用高是正常的，任何IO都要经过系统调用完成，自然要占用sys。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548115805,"ip_address":"","comment_id":62524,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5843048427","product_id":100020901,"comment_content":"我这边使用centos7 2c 8g 实验结果与文章中有些区别：<br>1. 在运行容器后，使用top命令发现sys与iowait各占单个CPU的10-50%<br>2. 针对iowait，使用dstat发现磁盘每秒写入约为300M; vmstat中bo也验证了写请求较大<br>3. 使用pidstat -d 分析发现是Python写入请求大，根据 iostat分析到当前磁盘使用率90%，写队列1000<br>4. 使用strace跟踪，发现写入fd为3，观察ls -l &#47;proc&#47;$pid&#47;fd&#47;，发现fd:3 --&gt; &#47;tmp&#47;logtest.txt<br>5. 再通过 watch -n 1 ls -lh &#47;tmp&#47;logtest.txt 观察日志大小，发现日志在轮转<br>----<br>有个疑惑，针对 sys 较高，无论是上下文切换，还是中断，都非常少，只有一个io写入。难道io密集型应用也能大幅度拉高sys？我也没发现man手册中提到io等待时间包含在sys中啊<br>[root@centos-80 ~]# dstat 2<br>----total-cpu-usage---- -dsk&#47;total- -net&#47;total- ---paging-- ---system--<br>usr sys idl wai hiq siq| read  writ| recv  send|  in   out | int   csw<br>  6  13  68  12   0   0| 146k  312M|   0     0 |   0     0 | 854   333<br> 13  26  27  34   0   1|   0   598M|  60B  626B|   0     0 |1506   312<br> 10  22  42  25   0   0|   0   587M|  60B  354B|   0     0 |1385   270","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437246,"discussion_content":"sys使用高是正常的，任何IO都要经过系统调用完成，自然要占用sys。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548115805,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61748,"user_name":"仲鬼","can_delete":false,"product_type":"c1","uid":1314692,"ip_address":"","ucode":"DB1CD7052D5BA6","user_header":"https://static001.geekbang.org/account/avatar/00/14/0f/84/d8e63885.jpg","comment_is_top":false,"comment_ctime":1547789772,"is_pvip":false,"replies":[{"id":"22329","content":"这儿是要说 IO 的来源，肯定是 I&#47;O 大的进程","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548251132,"ip_address":"","comment_id":61748,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5842757068","product_id":100020901,"comment_content":"“每秒写的数据超过 45 MB，比上面 iostat 发现的 32MB 的结果还要大”<br>老师好，没明白这里的比较要说明什么问题？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436976,"discussion_content":"这儿是要说 IO 的来源，肯定是 I/O 大的进程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548251132,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61725,"user_name":"安小依","can_delete":false,"product_type":"c1","uid":1101660,"ip_address":"","ucode":"A5C414C7B994FF","user_header":"https://static001.geekbang.org/account/avatar/00/10/cf/5c/d4e19eb6.jpg","comment_is_top":false,"comment_ctime":1547782420,"is_pvip":false,"replies":[{"id":"22326","content":"你这个例子是向文件 &#47;tmp&#47;aaa 写，不是标准输出","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548250969,"ip_address":"","comment_id":61725,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5842749716","product_id":100020901,"comment_content":"Ubuntu 16.04, 使用 strace 应该需要先临时修改系统一个配置：echo 0 | sudo tee &#47;proc&#47;sys&#47;kernel&#47;yama&#47;ptrace_scope。另外用 java 模拟写文件，strace 发现还是不行，一直卡在这个地方：<br><br>zk@zk-pc:~&#47;Documents$ strace -p 6526<br>strace: Process 6526 attached<br>futex(0x7f934a93a9d0, FUTEX_WAIT, 6527, NULL<br><br>老师帮忙看一下，Java 源代码如下。注释掉的部分 System.out 是疯狂打日志 （标准输出），线上环境出现过，疯狂 println 结果磁盘打满的问题，想模拟一下，结果发现不行。然后换成了写文件，结果 strace 还是看不出来，卡在那个地方一直不动：<br><br>    public static void main(String...args) throws Exception {<br>        File file = new File(&quot;&#47;tmp&#47;aaa&quot;);<br>        PrintWriter printWriter = new PrintWriter(file);<br><br>        while (true) {<br>            printWriter.write(UUID.randomUUID().toString());<br>            &#47;&#47; System.out.println(&quot;------------------------------NULL-------------------&quot;);<br>            LockSupport.parkNanos(1);<br>        }<br>    }<br><br>另外问一下老师，一直向标准输出打印的话，最终的那个文件是放在哪里呢了？怎么就把磁盘打满了呢？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436969,"discussion_content":"你这个例子是向文件 /tmp/aaa 写，不是标准输出","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548250969,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360551,"user_name":"Geek_f93234","can_delete":false,"product_type":"c1","uid":1769504,"ip_address":"北京","ucode":"1E5DC903A5429E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJGXndj5N66z9BL1ic9GibZzWWgoVeWaWTL2XUnCYic7iba2kAEvN9WfjmlXELD5lqt8IJ1P023N5ZWicg/132","comment_is_top":false,"comment_ctime":1666652012,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1666652012","product_id":100020901,"comment_content":"root@pc:~# cat &#47;proc&#47;meminfo  | grep -E &quot;Cached|SReclaimable&quot;<br>Cached:          1696908 kB<br>SwapCached:            0 kB<br>SReclaimable:      66336 kB","like_count":0},{"had_liked":false,"id":360550,"user_name":"Geek_f93234","can_delete":false,"product_type":"c1","uid":1769504,"ip_address":"北京","ucode":"1E5DC903A5429E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJGXndj5N66z9BL1ic9GibZzWWgoVeWaWTL2XUnCYic7iba2kAEvN9WfjmlXELD5lqt8IJ1P023N5ZWicg/132","comment_is_top":false,"comment_ctime":1666651734,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1666651734","product_id":100020901,"comment_content":"通过vmstat 看到 内存被Cache占用了<br>root@pc:~# vmstat 1<br>procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----<br> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st<br> 1  0      0 4946408  25412 2065436    0    0   191 304456  261  162  1  3 82 14  0<br> 1  0      0 6160016  25412 1452472    0    0     0 344208  327  286  1  9 90  0  0<br> 1  0      0 5541428  25412 2078736    0    0     0 577540  548  224  0  0 89 11  0<br> 1  0      0 5669052  25412 1452588    0    0     0 344064  414  162  1  5 94  0  0<br> 1  0      0 5047392  25412 2078736    0    0     0 688128  368  199  1  5 94  0  0<br> 3  0      0 5864288  25424 1762964    0    0     0 569584  312  301  1  6 93  0  0<br> 2  0      0 4925112  25424 2086076    0    0     0 118784  283  106  2  2 96  0  0<br> 1  0      0 5492056  25424 1763660    0    0     0 782340  500  319  0  7 82 10  0<br> 0  0      0 5233080  25424 2394508    0    0     0 544772  439  265  0  3 96  1  0<br> 1  0      0 5484624  25424 1763668    0    0     0 344064  255  127  1  3 96  0  0<br> 2  0      0 4890676  25436 2394396    0    0     0 516264  247  158  3  6 86  6  0<br> 1  0      0 5006000  25436 2005184    0    0     0 516188  235   82  0  4 95  1  0","like_count":0},{"had_liked":false,"id":357009,"user_name":"*","can_delete":false,"product_type":"c1","uid":2901446,"ip_address":"福建","ucode":"575AECA891950A","user_header":"https://static001.geekbang.org/account/avatar/00/2c/45/c6/28dfdbc9.jpg","comment_is_top":false,"comment_ctime":1662854097,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1662854097","product_id":100020901,"comment_content":"老师，队列多大算长","like_count":0},{"had_liked":false,"id":305381,"user_name":"笃定","can_delete":false,"product_type":"c1","uid":1316173,"ip_address":"","ucode":"92E06FA13CC046","user_header":"https://static001.geekbang.org/account/avatar/00/14/15/4d/bbfda6b7.jpg","comment_is_top":false,"comment_ctime":1627954600,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627954600","product_id":100020901,"comment_content":"示例中写的是文件，会经过文件系统，由文件系统来做具体的io调度、io写入等操作；而之前在内存篇中，老师说过，读写文件系统的文件操作实际是写页缓存，也就是文件系统中的cache，所以写文件操作主要占用的是内存中的cache指标。","like_count":0},{"had_liked":false,"id":297006,"user_name":"阿海","can_delete":false,"product_type":"c1","uid":1281585,"ip_address":"","ucode":"2589431F840C42","user_header":"https://static001.geekbang.org/account/avatar/00/13/8e/31/28972804.jpg","comment_is_top":false,"comment_ctime":1623259255,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1623259255","product_id":100020901,"comment_content":"使用cachestat 或者 &#47;proc&#47;meminfo 都能看到 buffer和cache各自占用了多少；例子是写文件，所以自然是cache用的多","like_count":0},{"had_liked":false,"id":275794,"user_name":"Anthony","can_delete":false,"product_type":"c1","uid":1309908,"ip_address":"","ucode":"9E0C98A9123365","user_header":"https://static001.geekbang.org/account/avatar/00/13/fc/d4/743d3f02.jpg","comment_is_top":false,"comment_ctime":1611668903,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1611668903","product_id":100020901,"comment_content":"vmstat 看到是cache不断上升，又因为页回收机制，降低升高不断反复","like_count":0},{"had_liked":false,"id":255770,"user_name":"砥砺前行","can_delete":false,"product_type":"c1","uid":1333693,"ip_address":"","ucode":"F49A7287147E6A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/49NMDFFQekIc5h06icIyx4blaCwl339PaibzFZhhZ4SAwan6xv6UZicPubkRjTQnNmZbiaSB4VfwA3yCPgPOWDJ4pA/132","comment_is_top":false,"comment_ctime":1603425210,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603425210","product_id":100020901,"comment_content":"除了 CPU 和磁盘 I&#47;O 外，剩余内存也比较少，而内存主要被 Buffer&#47;Cache 占用。<br>如果只是看那个被占用的多可以vmstat<br>","like_count":0},{"had_liked":false,"id":246370,"user_name":"向文超","can_delete":false,"product_type":"c1","uid":1976384,"ip_address":"","ucode":"3DA58D26FF8FCB","user_header":"https://static001.geekbang.org/account/avatar/00/1e/28/40/1c1a34c7.jpg","comment_is_top":false,"comment_ctime":1599299076,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599299076","product_id":100020901,"comment_content":"之前遇到过一个问题，docker中一个java进程不断向stdout打debug日志，当时的现象是宿主机内存缓慢升高，最后导致oom。当时看到oom，一点思路也没有，看了老师的内存问题和io问题的定位，现在回想起来就没觉得那么难了，受益良多！","like_count":0},{"had_liked":false,"id":226812,"user_name":"djfhchdh","can_delete":false,"product_type":"c1","uid":1484184,"ip_address":"","ucode":"E71D75328CE398","user_header":"https://static001.geekbang.org/account/avatar/00/16/a5/98/a65ff31a.jpg","comment_is_top":false,"comment_ctime":1592208532,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592208532","product_id":100020901,"comment_content":"思考题：用cachetop或cachestat工具就可以看到具体的buffer、cache的大小","like_count":0},{"had_liked":false,"id":223434,"user_name":"西出十三归","can_delete":false,"product_type":"c1","uid":1527323,"ip_address":"","ucode":"693417E8D75F74","user_header":"https://static001.geekbang.org/account/avatar/00/17/4e/1b/ba80a35e.jpg","comment_is_top":false,"comment_ctime":1591088688,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1591088688","product_id":100020901,"comment_content":"老师，我的环境里面通过iostat好像并不能判断出io的瓶颈，队列和使用率都很小，但是top的cpu iowait 确实达到了很高，这是不是代表我环境的性能瓶颈反而是在cpu上了。<br>Device            r&#47;s     rkB&#47;s   rrqm&#47;s  %rrqm r_await rareq-sz     w&#47;s     wkB&#47;s   wrqm&#47;s  %wrqm w_await wareq-sz     d&#47;s     dkB&#47;s   drqm&#47;s  %drqm d_await dareq-sz     f&#47;s f_await  aqu-sz  %util<br>dm-0             0.00      0.00     0.00   0.00    0.00     0.00   67.00 229392.50     0.00   0.00   56.03  3423.77    0.00      0.00     0.00   0.00    0.00     0.00    0.00    0.00    3.75  10.90<br>dm-1             0.00      0.00     0.00   0.00    0.00     0.00    0.00      0.00     0.00   0.00    0.00     0.00    0.00      0.00     0.00   0.00    0.00     0.00    0.00    0.00    0.00   0.00<br>sda              0.00      0.00     0.00   0.00    0.00     0.00  235.00 234172.50     1.00   0.42   30.45   996.48    0.00      0.00     0.00   0.00    0.00     0.00    0.00    0.00    7.04  22.20<br>sdb              0.00      0.00     0.00   0.00    0.00     0.00    0.00      0.00     0.00   0.00    0.00     0.00    0.00      0.00     0.00   0.00    0.00     0.00    0.00    0.00    0.00   0.00<br>scd0             0.00      0.00     0.00   0.00    0.00     0.00    0.00      0.00     0.00   0.00    0.00     0.00    0.00      0.00     0.00   0.00    0.00     0.00    0.00    0.00    0.00   0.00<br>","like_count":0,"discussions":[{"author":{"id":1013424,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/b0/14fec62f.jpg","nickname":"不了峰","note":"","ucode":"E23B96D6A3D4EC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551176,"discussion_content":"感觉你的环境性能很好。因为你没有CPU和 iowait 达到多少，不能判断是否存在cpu的瓶颈。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644917428,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":208911,"user_name":"大雄","can_delete":false,"product_type":"c1","uid":1676966,"ip_address":"","ucode":"5FCFDD3A940801","user_header":"https://static001.geekbang.org/account/avatar/00/19/96/a6/32a286e0.jpg","comment_is_top":false,"comment_ctime":1587463776,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587463776","product_id":100020901,"comment_content":"strace -p nginx-id<br>Process 3173 attached<br>rt_sigsuspend([], 8<br><br><br>这个什么情况","like_count":0},{"had_liked":false,"id":183516,"user_name":"凹凸曼","can_delete":false,"product_type":"c1","uid":1178970,"ip_address":"","ucode":"66F78B8D91CDDB","user_header":"https://static001.geekbang.org/account/avatar/00/11/fd/5a/44719f7c.jpg","comment_is_top":false,"comment_ctime":1583056897,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1583056897","product_id":100020901,"comment_content":"老师，请问下为什么iowait大的时候只在单个CPU逻辑核上体现","like_count":0,"discussions":[{"author":{"id":1013424,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/b0/14fec62f.jpg","nickname":"不了峰","note":"","ucode":"E23B96D6A3D4EC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551177,"discussion_content":"因为只有一个进程写","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644917449,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":180143,"user_name":"hostfox²⁰²⁰","can_delete":false,"product_type":"c1","uid":1740281,"ip_address":"","ucode":"0D987C733D7CCB","user_header":"https://static001.geekbang.org/account/avatar/00/1a/8d/f9/ceb39113.jpg","comment_is_top":false,"comment_ctime":1582197769,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582197769","product_id":100020901,"comment_content":"android 虽然没有pidstat，但可以使用 iotop 找出io读写较高的线程，然后根据strace和lsof找出读写的文件。","like_count":0},{"had_liked":false,"id":143583,"user_name":"汤🐠🥣昱","can_delete":false,"product_type":"c1","uid":1332781,"ip_address":"","ucode":"46842C90E59A1A","user_header":"https://static001.geekbang.org/account/avatar/00/14/56/2d/dd3b12b8.jpg","comment_is_top":false,"comment_ctime":1571737043,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571737043","product_id":100020901,"comment_content":"老师，我用linux的一个1核的 内存1G的服务器，没有出现io瓶颈的问题，通过top命令到是发现了cpu使用率飚到93%，64.5 us, 29.2 sy。这是是trace跟踪的情况：怎么反应不了是io的问题尼？<br>mmap(NULL, 393220096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = -1 ENOMEM (Cannot allocate memory)<br>munmap(0x7f2cc8098000, 314576896)       = 0<br>write(2, &quot;--- Logging error ---\\n&quot;, 22) = 22<br>stat(&quot;&#47;usr&#47;local&#47;lib&#47;python3.7&#47;logging&#47;handlers.py&quot;, {st_mode=S_IFREG|0644, st_size=57674, ...}) = 0<br>write(2, &quot;Traceback (most recent call last&quot;..., 35) = 35<br>write(2, &quot;  File \\&quot;&#47;usr&#47;local&#47;lib&#47;python3.7&quot;..., 108) = 108<br>write(2, &quot;  File \\&quot;&#47;usr&#47;local&#47;lib&#47;python3.7&quot;..., 122) = 122<br>write(2, &quot;MemoryError\\n&quot;, 12)           = 12<br>write(2, &quot;Call stack:\\n&quot;, 12)           = 12<br>stat(&quot;&#47;app.py&quot;, {st_mode=S_IFREG|0664, st_size=1289, ...}) = 0<br>write(2, &quot;  File \\&quot;&#47;app.py\\&quot;, line 52, in &lt;m&quot;..., 63) = 63<br>write(2, &quot;  File \\&quot;&#47;app.py\\&quot;, line 43, in wr&quot;..., 65) = 65<br>mmap(NULL, 314576896, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f2cc8098000<br>mmap(NULL, 393220096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = -1 ENOMEM (Cannot allocate memory)<br>munmap(0x7f2cc8098000, 314576896)       = 0<br>write(2, &quot;Unable to print the message and &quot;..., 119) = 119<br>select(0, NULL, NULL, NULL, {0, 100000}) = 0 (Timeout)<br>getpid()                                = 1<br>mmap(NULL, 314576896, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f2cc8098000<br>mmap(NULL, 393220096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = -1 ENOMEM (Cannot allocate memory)<br>munmap(0x7f2cc8098000, 314576896)       = 0<br>write(2, &quot;--- Logging error ---\\n&quot;, 22) = 22<br>stat(&quot;&#47;usr&#47;local&#47;lib&#47;python3.7&#47;logging&#47;handlers.py&quot;, {st_mode=S_IFREG|0644, st_size=57674, ...}) = 0<br>write(2, &quot;Traceback (most recent call last&quot;..., 35) = 35<br>write(2, &quot;  File \\&quot;&#47;usr&#47;local&#47;lib&#47;python3.7&quot;..., 108) = 108<br>write(2, &quot;  File \\&quot;&#47;usr&#47;local&#47;lib&#47;python3.7&quot;..., 122) = 122<br>write(2, &quot;MemoryError\\n&quot;, 12)           = 12<br>write(2, &quot;Call stack:\\n&quot;, 12)           = 12<br><br>","like_count":0},{"had_liked":false,"id":142816,"user_name":"Shane","can_delete":false,"product_type":"c1","uid":1291344,"ip_address":"","ucode":"322D0A883BAF16","user_header":"https://static001.geekbang.org/account/avatar/00/13/b4/50/c5dad2dc.jpg","comment_is_top":false,"comment_ctime":1571542391,"is_pvip":false,"replies":[{"id":"55583","content":"请参考 05 篇，有对这个问题的详细讲解","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1571840506,"ip_address":"","comment_id":142816,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1571542391","product_id":100020901,"comment_content":"老师，我今天才看完这篇文章。想要提几个问题，不知道该专栏过了这么长时间了，还会不会被老师看到。不过还是提着把，万一看到并且回复了呢？<br><br>有一点困惑难以理解？在运行app.py命令之后，使用top查看时，发现cpu的wait使用率在80，90徘徊。<br><br>但是top下面的python进程的cpu使用率只有6%。<br><br>在我的理解中，现在总的cpu使用率是1 - idle。也就是90%左右。其中大量都是wait，sys之占用了6%左右。<br><br>但是，top下面所有进程的使用率总和不是应该是1-idle，90%左右吗？难道所有的进程的cpu使用率的总和和上面的不是相等的吗？<br><br>如果不是相等的，我还想到了一种可能是: 进程显示的是所有cpu的使用率，某一个进程的使用率应该会超过100%(如果有多个逻辑核心)。还是不应该出现总和小于上面的总cpu使用率的情况吧？？<br><br>希望老师答疑解惑。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471282,"discussion_content":"请参考 05 篇，有对这个问题的详细讲解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571840506,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126009,"user_name":"烨","can_delete":false,"product_type":"c1","uid":1564897,"ip_address":"","ucode":"2844E63958EAD1","user_header":"https://static001.geekbang.org/account/avatar/00/17/e0/e1/029768f1.jpg","comment_is_top":false,"comment_ctime":1566292778,"is_pvip":false,"replies":[{"id":"47214","content":"可能mysql还没初始化好，重启一下mysql容器试试","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1566744033,"ip_address":"","comment_id":126009,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1566292778","product_id":100020901,"comment_content":"老师你好，make init后一直报错连不上mysql是为啥呢？<br>curl http:&#47;&#47;127.0.0.1:10000&#47;db&#47;insert&#47;products&#47;10000后报错：<br>pymysql.err.OperationalError: (2003, &amp;quot;Can&#39;t connect to MySQL server on &#39;127.0.0.1&#39; ([Errno 111] Connection refused)&amp;quot;)<br>实际是起来了的","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463785,"discussion_content":"可能mysql还没初始化好，重启一下mysql容器试试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566744033,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":125454,"user_name":"飞鸟","can_delete":false,"product_type":"c1","uid":1255192,"ip_address":"","ucode":"56434301B82BF3","user_header":"https://static001.geekbang.org/account/avatar/00/13/27/18/b70a86b0.jpg","comment_is_top":false,"comment_ctime":1566186633,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1566186633","product_id":100020901,"comment_content":"老师好， 我前段时间我们生产集群 遇到过 jbd2引起IO过高，导致kudu 平均负载超载，严重影响正常的读写，当时我定位到了是 jbd2导致的， 可是我不知改咋办，最后无奈，停掉作业重启了Kudu。 对这个问题我不知改如何解决， 老师指点指点。","like_count":0,"discussions":[{"author":{"id":1318941,"avatar":"https://static001.geekbang.org/account/avatar/00/14/20/1d/0c1a184c.jpg","nickname":"罗辑思维","note":"","ucode":"D257A06EDE928E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":193180,"discussion_content":"今天看了性能测试实战30讲：31丨案例：当磁盘参数导致I/O高的时候，应该怎么办？\n里面的建议是直接关掉 journal 功能。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583134454,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":107409,"user_name":"Rempor","can_delete":false,"product_type":"c1","uid":1226680,"ip_address":"","ucode":"AC34D643C29A38","user_header":"https://static001.geekbang.org/account/avatar/00/12/b7/b8/37f5dadf.jpg","comment_is_top":false,"comment_ctime":1561531188,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561531188","product_id":100020901,"comment_content":"cachetop","like_count":0},{"had_liked":false,"id":75682,"user_name":"刘韦菠","can_delete":false,"product_type":"c1","uid":1423328,"ip_address":"","ucode":"7DEE07AEB11973","user_header":"https://static001.geekbang.org/account/avatar/00/15/b7/e0/5fdb9fc2.jpg","comment_is_top":false,"comment_ctime":1552448708,"is_pvip":false,"replies":[{"id":"28042","content":"docker kill","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1552748825,"ip_address":"","comment_id":75682,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1552448708","product_id":100020901,"comment_content":"容器里面起来的进程 容器外面用root 权限都没有权限kill, 显示permission denied, 偏偏容器里面没有kill 这个命令. 这种情况该怎么做? 网上没找到有用的信息...","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442982,"discussion_content":"docker kill","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552748825,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":74734,"user_name":"如果","can_delete":false,"product_type":"c1","uid":1320638,"ip_address":"","ucode":"138A3EEEE50850","user_header":"","comment_is_top":false,"comment_ctime":1552288699,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552288699","product_id":100020901,"comment_content":"DAY26，打卡","like_count":0},{"had_liked":false,"id":71600,"user_name":"肘子哥","can_delete":false,"product_type":"c1","uid":1333601,"ip_address":"","ucode":"F152F3DF514117","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ccpIPibkaTQfYbO5DGiaWpL86YSHAZfVO55WtJhjV0hb7AuyIMzLyRdLnQZ6tjB0Wars4ib7YX3fhmPh9R81MVKtA/132","comment_is_top":false,"comment_ctime":1551399818,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551399818","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":67525,"user_name":"VIC","can_delete":false,"product_type":"c1","uid":1343938,"ip_address":"","ucode":"805246B9ABE16C","user_header":"https://static001.geekbang.org/account/avatar/00/14/81/c2/314460b8.jpg","comment_is_top":false,"comment_ctime":1550192599,"is_pvip":false,"replies":[{"id":"24036","content":"直接 docker pull 就可以下载，源代码在 github 上面：https:&#47;&#47;github.com&#47;feiskyer&#47;linux-perf-examples","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550325447,"ip_address":"","comment_id":67525,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550192599","product_id":100020901,"comment_content":"老师，这些docker镜像什么地方下载","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439230,"discussion_content":"直接 docker pull 就可以下载，源代码在 github 上面：https://github.com/feiskyer/linux-perf-examples","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550325447,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62528,"user_name":"xfan","can_delete":false,"product_type":"c1","uid":1315147,"ip_address":"","ucode":"48ED8D498D7F56","user_header":"https://static001.geekbang.org/account/avatar/00/14/11/4b/fa64f061.jpg","comment_is_top":false,"comment_ctime":1548081779,"is_pvip":false,"replies":[{"id":"22125","content":"检查下swapiness的设置","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548115718,"ip_address":"","comment_id":62528,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548081779","product_id":100020901,"comment_content":"我开启了交换swap，和实验不同的是我的Buffer&#47;cache占用不高，反倒是swap很高。还有一个是基本没有写，读很高。奇怪","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437248,"discussion_content":"检查下swapiness的设置","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548115718,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61703,"user_name":"唯美","can_delete":false,"product_type":"c1","uid":1263430,"ip_address":"","ucode":"9186A5B99DFBCA","user_header":"https://static001.geekbang.org/account/avatar/00/13/47/46/61f16147.jpg","comment_is_top":false,"comment_ctime":1547777962,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1547777962","product_id":100020901,"comment_content":"打卡Day26 <br>day day up!","like_count":0}]}