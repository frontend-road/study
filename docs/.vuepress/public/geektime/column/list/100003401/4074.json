{"id":4074,"title":"37 | 云计算时代，我们所说的弹性伸缩，弹的到底是什么？","content":"<p>现在，我们经常听到的一些高大上的词汇，比如弹性伸缩、水平扩展和自动化扩缩容等等，你能否说一说，这些技术手段的主体是谁，也就是谁的水平扩展？弹性伸缩的是什么？同时，这些名词之间又有什么关系呢？</p>\n<p>下面我们就从弹性伸缩入手一起来分析讨论。</p>\n<h2>弹性伸缩的主体是谁？</h2>\n<p>弹性伸缩，一说到这个词，我们可能很自然地会联想到资源的弹性伸缩，服务器的弹性伸缩，容量的弹性伸缩，应用的弹性伸缩以及业务的弹性伸缩等等。我想这些理解都没有错误，但是可以发现，当弹性伸缩这个动词前面增加了这么多不同的主语之后，我们一下子就不知道到底该做什么了。</p>\n<p>其实有这样的困惑很正常。我们在讲标准化的时候就提到，<strong>做运维和做架构的思路是相通的，我们碰到问题后，一定要找到问题的主体是什么，通过问题找主体，通过主体的特性制定问题的解决方案</strong>。</p>\n<p><strong><span class=\"orange\">对于运维，一定要准确识别出日常运维过程中不同的运维对象，然后再进一步去分析这个对象所对应的运维场景是什么，进而才是针对运维场景的分解和开发。</span></strong></p>\n<p>这里可以看到，弹性伸缩其实是一个运维场景，但是我们并没有定义这个场景的主体是谁，所以就会出现上面这些不同的主体。我们来假设以下几种主体。</p>\n<!-- [[[read_end]]] -->\n<ul>\n<li><strong>服务器的弹性伸缩</strong>。针对这个场景，假设业务是运行在私有云或公有云上，那我们只要能够通过云平台的API申请和释放资源，申请时初始化我们的操作系统，释放时销毁资源就可以。不过，在私有云环境下，为了能够保障弹性，我们必须自己提前采购、上架、装机、配置然后交付资源，需要大量的准备工作，公有云上就可以省去这些步骤，可以即拿即用。</li>\n<li><strong>应用的弹性伸缩</strong>。这个场景下其实是默认包含第一步的，就是我们首先必须要拿到应用运行的服务器资源才可以，这一步做到了，下面就是应用的部署、启动以及服务上线接入流量。</li>\n<li><strong>业务的弹性伸缩</strong>。我们可以再进一步思考，通常一个业务可能会包括多个应用，所以为了保障整个业务容量充足，这个时候扩容单个的应用是没有意义的，所以这时要做的就是扩容多个应用，但是这里面就会有一个顺序问题，先扩哪个，后扩哪个，哪些又是可以同时扩容而不会影响业务正常运行的，再进一步，业务承载的服务能力提升了，那网络带宽、缓存、DB等等这些基础设施需不需要也同时扩容呢？</li>\n</ul>\n<p>到这里，这个问题就已经变得非常复杂了，而且已经不仅仅是弹性伸缩这个词的表面含义所能覆盖的了，因为这个问题确实很复杂，所以这里暂时不做详述。</p>\n<p>好了，分析到这里，我们就可以看到针对不同的运维对象，弹性伸缩这个概念背后的含义是不一样的，所执行的动作以及制定的方案也是不一样的。通过上面的分析过程，我们在日常思考和工作开展中应该注意以下两点。</p>\n<p><strong>第一，一定是从实际问题出发，找到问题的主体，然后才是针对问题的解决方案</strong>。要反复问自己和团队，我们解决的问题是什么？解决的是谁的问题？切记，一定不要拿着解决方案来找问题，甚至是制造问题。</p>\n<p>比如弹性伸缩这个概念，它就是解决方案，而不是问题本身，问题应该是：业务服务能力不足时，如何快速扩容？业务服务能力冗余时，如何释放资源，节省成本？按照这个思路来，我们自然就提炼出业务服务能力这个主体，面对的场景是快速的扩缩容，然后针对场景进一步细化和分解。</p>\n<p><strong>第二，如果问题处于初期，且是发散状态时，主体可能表现出很多个，这时我们一定要找到最本质的那一个，往往这个主体所涉及的运维场景就包括了其它主体的场景</strong>。</p>\n<p>比如上面我们看到的业务的弹性伸缩，就包含了应用和服务器的弹性伸缩场景，它们只不过是子场景而已。从这个角度出发，我们的思路才能打开，方案才会全面。不然如果只是聚焦在服务器、应用、DB、网络等等这些非本质的主体上，提供出来的解决方案肯定也是片面的，而且经常会出现这样的情况，每个人都只从自己的角度出发说问题，始终无法达成一致。问题的根本还是我们没有一个共同讨论的基础，结果就是工作没少做，却始终没有解决问题。</p>\n<h2>弹性伸缩、水平扩展和自动化扩缩容，它们之间的关系是什么？</h2>\n<p>这个问题，我想已经不言自明了，找到它们的主体和要解决的问题，我们就会发现，其实它们之间的含义是一样的。</p>\n<h2>总结</h2>\n<p>今天我们以弹性伸缩为例，讨论了如何思考问题和分析问题。我们的讨论和分析归结到一点就是：<strong>独立思考和分析的能力很重要，意识也很重要，切忌不可人云亦云随大流，反而迷失了工作的方向</strong>。</p>\n<p>现在业界各种技术上的Buzzword（时髦词）层出不穷，让人目不暇接，但是仔细观察和思考，你会发现它们背后常常隐藏着很多共性的特点，一定要抓住它们背后所要解决的问题和本质，这样也就不会乱花渐欲迷人眼了。</p>\n<p>而且通过这样的分析，我们会更容易发现工作中还需完善的地方，从而引导我们聚焦到实际问题中来，而不是浮于表面，把一些高大上的词汇挂在嘴边，却不见效果。</p>\n<p>关于今天我们讨论的主题，你还有哪些想法和心得，欢迎你留言与我讨论。</p>\n<p>如果今天的内容对你有帮助，也欢迎你分享给身边的朋友，我们下期见！</p>\n<p></p>\n","comments":[{"had_liked":false,"id":3627,"user_name":"谦寻","can_delete":false,"product_type":"c1","uid":1033639,"ip_address":"","ucode":"07160FAFAD08F7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c5/a7/e32dcfe7.jpg","comment_is_top":false,"comment_ctime":1520133973,"is_pvip":false,"replies":[{"id":"710","content":"应用层面，服务要先下线，比如从lvs或nginx负载均衡器上下线，如果是服务化应用，则要从配置中心下线。下线完成，然后再做容器缩容","user_name":"作者回复","user_name_real":"赵成","uid":"1001380","ctime":1520151670,"ip_address":"","comment_id":3627,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10110068565","product_id":100003401,"comment_content":"您好，用容器做缩容，如果要减少的容器刚好在处理业务请求，这种情况如何处理？","like_count":3,"discussions":[{"author":{"id":1001380,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/a4/6076bd5f.jpg","nickname":"赵成","note":"","ucode":"934FC7D12479AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":415972,"discussion_content":"应用层面，服务要先下线，比如从lvs或nginx负载均衡器上下线，如果是服务化应用，则要从配置中心下线。下线完成，然后再做容器缩容","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1520151670,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27812,"user_name":"人生海海","can_delete":false,"product_type":"c1","uid":1218186,"ip_address":"","ucode":"539CA2B273AD14","user_header":"https://static001.geekbang.org/account/avatar/00/12/96/8a/c0c764e9.jpg","comment_is_top":false,"comment_ctime":1537947725,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1537947725","product_id":100003401,"comment_content":"目前尴尬点是扩容速度，自动扩容感知突发事件，但扩容需要10多分钟。当扩容完成后，突发热点事件流量已经回落、有种没用到刀刃上的感觉。","like_count":1,"discussions":[{"author":{"id":1636895,"avatar":"https://static001.geekbang.org/account/avatar/00/18/fa/1f/fa164066.jpg","nickname":"as-范","note":"","ucode":"0421A7319F1AB7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571138,"discussion_content":"优化可能会 有2个方向：1. 扩容速度有提升空间：还是尽量使用容器化减少安装流程，如果裸机-&gt;环境-&gt;打包-&gt;上线-&gt;预热-&gt;加入流量肯定就会慢，优化后还是分钟级但会好于10分钟；2. 其次是触发自动扩容的阈值是可优化的，除了常规的cpu利用率，load，连接数等一级指标，可以拟合服务指标和业务指标，比如服务池内最慢的接口rt，业务上是否下发了全量站内信等，提前触发扩容动作。除了这两个方向，还有业务高峰期定时扩容的方案，尽量使用公有云收费规则上的优惠，在不增加成本的前提下，可以积极的进行提前扩容。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1652084838,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1172362,"avatar":"https://static001.geekbang.org/account/avatar/00/11/e3/8a/ed8d1b63.jpg","nickname":"梧桐秋雨","note":"","ucode":"9D6AC6BA1E4259","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573200,"discussion_content":"其实可以考虑一定量的冗余","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653266918,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":4686,"user_name":"james","can_delete":false,"product_type":"c1","uid":1049208,"ip_address":"","ucode":"5701899403917C","user_header":"https://static001.geekbang.org/account/avatar/00/10/02/78/23c56bce.jpg","comment_is_top":false,"comment_ctime":1522335337,"is_pvip":false,"replies":[{"id":"1198","content":"先下服务，从负载均衡上或者配置中心摘掉，没有流量进来了，且默认静默一段时间，再停服务，再做后面的操作。","user_name":"作者回复","user_name_real":"赵成","uid":"1001380","ctime":1522369217,"ip_address":"","comment_id":4686,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1522335337","product_id":100003401,"comment_content":"那另一个问题来了，下线的时候有业务咋办，客户请求了就没有响应了啊，不过得刷新和重试","like_count":1,"discussions":[{"author":{"id":1001380,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/a4/6076bd5f.jpg","nickname":"赵成","note":"","ucode":"934FC7D12479AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":416478,"discussion_content":"先下服务，从负载均衡上或者配置中心摘掉，没有流量进来了，且默认静默一段时间，再停服务，再做后面的操作。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1522369217,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2057406,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/64/be/546665e3.jpg","nickname":"心随缘","note":"","ucode":"F7F5C49EA80E03","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575537,"discussion_content":"静默观察是对业务的负责","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654926895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}