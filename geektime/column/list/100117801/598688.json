{"id":598688,"title":"39ï½œæºç è§£è¯»ï¼šV8 æ‰§è¡Œ JS ä»£ç çš„å…¨è¿‡ç¨‹","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯LMOSã€‚</p><p>å‰é¢æˆ‘ä»¬å­¦ä¹ äº†ç°ä»£æµè§ˆå™¨æ¶æ„ï¼Œä¹Ÿå¤§è‡´äº†è§£äº†æµè§ˆå™¨å†…æ ¸çš„å·¥ä½œåŸç†ã€‚åœ¨æµè§ˆå™¨çš„å†…æ ¸ä¸­ï¼ŒV8 æ˜¯ä¸€ä¸ªç»•ä¸å¼€çš„è¯é¢˜ã€‚åœ¨æµè§ˆå™¨ä¸­ï¼ŒChrome çš„é‡è¦åœ°ä½ä¸ç”¨èµ˜è¿°ï¼Œè€ŒV8ä¸ä»…æ˜¯ Chrome çš„æ ¸å¿ƒç»„ä»¶ï¼Œè¿˜æ˜¯ node.js ç­‰ä¼—å¤šè½¯ä»¶çš„æ ¸å¿ƒç»„ä»¶ï¼Œæ‰€ä»¥ï¼ŒV8çš„é‡è¦ç¨‹åº¦äº¦ä¸ç”¨å¤šè¨€ã€‚</p><p>ä¸è¿‡ï¼ŒV8æ¶‰åŠåˆ°çš„æŠ€æœ¯ååˆ†å¹¿æ³›ï¼ŒåŒ…æ‹¬æ“ä½œç³»ç»Ÿã€ç¼–è¯‘æŠ€æœ¯ã€è®¡ç®—æœºä½“ç³»ç»“æ„ç­‰å¤šæ–¹é¢çŸ¥è¯†ï¼Œä¸ºäº†å¸¦ä½ å…ˆä»å®è§‚è§’åº¦ç³»ç»Ÿå­¦ä¹ å’Œäº†è§£V8é¡¹ç›®ï¼Œè¿™èŠ‚è¯¾æˆ‘ä¼šä»æºç ç†è§£è®²èµ·ï¼Œå¸¦ä½ äº†è§£äº†V8 æ‰§è¡Œ JS ä»£ç çš„å…¨è¿‡ç¨‹ã€‚</p><h2>å¦‚ä½•é˜…è¯» V8 æºç å’Œæ­å»º V8 å¼€å‘ç¯å¢ƒ</h2><p>å‰é¢ä¸¤èŠ‚è¯¾ï¼Œæˆ‘å¸¦ä½ ç®€å•äº†è§£äº† Chromium å’Œ Webkit é¡¹ç›®çš„ç›®å½•ç»“æ„ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ç»§ç»­çœ‹ä¸€ä¸‹å¦‚ä½•å­¦ä¹  V8 æºç ã€‚</p><p>Chromium é¡¹ç›®ä¸­åŒ…å«äº†å¯è¿è¡Œçš„ V8 æºç ï¼Œä½†æ˜¯ä»è°ƒè¯•çš„è§’åº¦çœ‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ <strong>depot_tools</strong>æ¥ç¼–è¯‘è°ƒè¯• V8 æºç ï¼Œå®ƒæ˜¯V8çš„ç¼–è¯‘å·¥å…·é“¾ï¼Œä¸‹è½½å’Œç¼–è¯‘ä»£ç éƒ½éœ€è¦ç”¨åˆ°å®ƒï¼Œä½ å¯ä»¥ç›´æ¥ç‚¹å‡» <a href=\"https://storage.googleapis.com/chrome-infra/depot_tools.zip\">depot_tools bundle</a> ä¸‹è½½ã€‚</p><p>è§£å‹åï¼Œæˆ‘ä»¬éœ€è¦å°† depot_tools å·¥å…·æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ï¼Œæ³¨æ„è¿™äº›æ“ä½œéœ€è¦ä½ ä¿è¯æœ¬æœºå¯ä»¥è®¿é—® Google æµè§ˆå™¨ã€‚</p><p>æˆ‘ä»¬ä»¥ Mac ç³»ç»Ÿä¸ºä¾‹ï¼Œæ·»åŠ åˆ°ç¯å¢ƒå˜é‡çš„ä»£ç å‘½ä»¤å¦‚ä¸‹ï¼š</p><!-- [[[read_end]]] --><pre><code class=\"language-plain\">export PATH=`pwd`/depot_tools:\"$PATH\"\n</code></pre><p>ç„¶åï¼Œä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­æµ‹è¯• depot_tools æ˜¯å¦å¯ä»¥ä½¿ç”¨ï¼š</p><pre><code class=\"language-plain\">gclient sync \n</code></pre><p>ä¸‹è½½å®Œ depot_tools åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸‹è½½ V8 ä»£ç è¿›è¡Œç¼–è¯‘è°ƒè¯•äº†â€œ</p><pre><code class=\"language-plain\">mkdir v8\ncd v8\nfetch v8\ncd v8/src\n</code></pre><p>ä¸‹è½½å¥½ V8 æºç åï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ GN æ¥é…ç½®å·¥ç¨‹æ–‡ä»¶ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬ç”¨åˆ°çš„å‡ ä¸ªç¼–è¯‘çš„å‚æ•°ï¼š</p><pre><code class=\"language-plain\">  is_component_build = true  // ç¼–è¯‘æˆåŠ¨æ€é“¾æ¥åº“ä»¥å‡å°‘ä½“ç§¯\n  is_debug = true  // å¼€å¯è°ƒè¯•\n  v8_optimized_debug = true // å…³é—­ä¸€äº›ä»£ç ä¼˜åŒ–\n  symbol_level = 0 å°†æ‰€æœ‰çš„debugç¬¦å·æ”¾åœ¨ä¸€èµ·ï¼ŒåŠ é€ŸäºŒæ¬¡ç¼–è¯‘å’Œé“¾æ¥è¿‡ç¨‹;\n  ide=vs2022 / &nbsp;ide=xcode // é€‰æ‹©ç¼–è¯‘ IDE\n</code></pre><p>æˆ‘ä»¬è¿™èŠ‚è¯¾å°±ä¸å±•å¼€è®²è§£ gn å‘½ä»¤äº†ï¼Œå¦‚æœä½ æœ‰å…´è¶£äº†è§£æ›´å¤šå†…å®¹ï¼Œå¯ä»¥è‡ªè¡ŒæŸ¥é˜…èµ„æ–™ã€‚è¯´å›æ­£é¢˜ï¼Œæˆ‘ä»¬ç»§ç»­èŠé…ç½®å·¥ä½œã€‚</p><p>Windows çš„é…ç½®æƒ…å†µå¦‚ä¸‹ ï¼š</p><pre><code class=\"language-plain\">gn gen out.gn/x64.release --args='is_debug=true target_cpu=\"x64\" v8_target_cpu=\"arm64\" use_goma=true is_component_build=true v8_optimized_debug = true symbol_level = 0'\n</code></pre><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹ Mac ä¸‹çš„æƒ…å†µï¼ŒMac ä¸‹æˆ‘ä»¬éœ€è¦æ›´æ–° xcode ä¾èµ–ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">sudo xcode-select -s /Applications/Xcode.app/Contents/Developer\ngn gen out/gn --ide=xcode\n</code></pre><p>æ‰§è¡Œå®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ IDE è¿›å…¥ç›¸åº”çš„å·¥ç¨‹æ–‡ä»¶ä¸‹ï¼Œåé¢æ˜¯æˆ‘çš„æ“ä½œæˆªå›¾ï¼Œä¾›ä½ å‚è€ƒï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/cd/da/cde28ae834f88de746657a5860b07cda.jpg?wh=1920x1204\" alt=\"å›¾ç‰‡\"></p><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œåœ¨å·¥ç¨‹æ–‡ä»¶ä¸‹æœ‰ä¸€ä¸ªåä¸º samples çš„ç›®å½•ï¼Œä¸Šå›¾ä¸­æ‰“å¼€çš„æ–‡ä»¶ hello-world.cc ä¹Ÿæ˜¯è¿™ä¸ªç›®å½•ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒæ˜¯ V8 é¡¹ç›®ä¸­çš„ä¸€ä¸ªå®ä¾‹æ–‡ä»¶ï¼Œæˆ‘ä»¬åé¢çš„å­¦ä¹ ä¹Ÿä¼šä»hello-world.ccæ–‡ä»¶å…¥æ‰‹ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶çš„å…·ä½“ä»£ç ï¼š</p><pre><code class=\"language-plain\">int main(int argc, char* argv[]) {\n  // Initialize V8.\n  v8::V8::InitializeICUDefaultLocation(argv[0]);\n  v8::V8::InitializeExternalStartupData(argv[0]);\n  std::unique_ptr&lt;v8::Platform&gt; platform = v8::platform::NewDefaultPlatform();\n  v8::V8::InitializePlatform(platform.get());\n  v8::V8::Initialize();\n  // Create a new Isolate and make it the current one.\n  v8::Isolate::CreateParams create_params;\n  create_params.array_buffer_allocator =\n      v8::ArrayBuffer::Allocator::NewDefaultAllocator();\n  v8::Isolate* isolate = v8::Isolate::New(create_params);\n  {\n    v8::Isolate::Scope isolate_scope(isolate);\n    // Create a stack-allocated handle scope.\n    v8::HandleScope handle_scope(isolate);\n    // Create a new context.\n    v8::Local&lt;v8::Context&gt; context = v8::Context::New(isolate);\n    // Enter the context for compiling and running the hello world script.\n    v8::Context::Scope context_scope(context);\n    {\n      // Create a string containing the JavaScript source code.\n      v8::Local&lt;v8::String&gt; source =\n          v8::String::NewFromUtf8Literal(isolate, \"'Hello' + ', World!'\");\n      // Compile the source code.\n      v8::Local&lt;v8::Script&gt; script =\n          v8::Script::Compile(context, source).ToLocalChecked();\n      // Run the script to get the result.\n      v8::Local&lt;v8::Value&gt; result = script-&gt;Run(context).ToLocalChecked();\n      // Convert the result to an UTF8 string and print it.\n      v8::String::Utf8Value utf8(isolate, result);\n      printf(\"%s\\n\", *utf8);\n</code></pre><p>æˆ‘ä»¬ç®€å•çœ‹çœ‹ hello-world.cc è¿™ä¸ªæ–‡ä»¶ï¼Œå®ƒæ˜¯ç”¨ C++ ç¨‹åºç¼–å†™çš„ï¼Œä¸»è¦åšäº†ä¸‹é¢å‡ ä»¶äº‹ï¼š</p><p>1.åˆå§‹åŒ–äº† V8 ç¨‹åºï¼›<br>\n2.è¿è¡Œäº†ä¸€æ®µåŸºäº JavaScript è¯­è¨€ç¨‹åºçš„ â€œhello worldâ€ å¹¶è¾“å‡ºï¼›<br>\n3.è¿è¡Œäº†ä¸€æ®µåŸºäº JavaScript è¯­è¨€ç¨‹åºçš„åŠ æ³•è¿ç®—å¹¶è¾“å‡ºï¼›<br>\n4.æ‰§è¡Œå®Œæˆåå¸è½½äº† V8ã€‚</p><p>ä¸ŠèŠ‚è¯¾æˆ‘ä»¬æœ‰æåˆ°ï¼ŒV8 æ˜¯ä¸€ä¸ª JS çš„æ‰§è¡Œå¼•æ“ï¼Œåœ¨è¿™ä¸ª helloworld çš„ä»£ç ä¸­ï¼Œé™¤å»è¿è¡ŒJS ä»£ç çš„ä¸¤éƒ¨åˆ†ï¼Œå…¶å®ƒçš„ä»£ç éƒ½æ˜¯ä¸º JS ä»£ç è¿è¡Œæä¾›çš„å‡†å¤‡å·¥ä½œã€‚</p><p>æˆ‘ä»¬ç°åœ¨å°±çœ‹ä¸€ä¸‹è¿è¡Œæ—¶éƒ½åšäº†å“ªäº›åŸºæœ¬çš„å‡†å¤‡å·¥ä½œã€‚</p><h2>V8 åœ¨è¿è¡Œæ—¶çš„è¡¨ç°</h2><p>ä¸Šé¢ä»£ç æ˜¯ hello-world ä»£ç çš„ä¸»å‡½æ•°ï¼Œä¹Ÿæ˜¯æ ¸å¿ƒçš„éƒ¨åˆ†ã€‚æˆ‘ä»¬æ¢³ç†ä¸€ä¸‹å…³é”®è¿‡ç¨‹æœ‰å“ªäº›ï¼šé¦–å…ˆhello- worldä»£ç çš„ä¸»å‡½æ•°è°ƒç”¨äº† v8::V8::Initialize() æ–¹æ³•å¯¹ V8 è¿›è¡Œåˆå§‹åŒ–ï¼›ç„¶åï¼Œè°ƒç”¨äº† v8::Isolate::New æ¥åˆ›å»º Isolateï¼›æ¥ç€ï¼Œåˆ›å»ºå®Œæˆåè°ƒç”¨äº† v8::Script::Compile æ¥è¿›è¡Œç¼–è¯‘ï¼›æœ€åï¼Œè°ƒç”¨ script-&gt;Run ç”¨æ¥æ‰§è¡Œ JS ä»£ç ã€‚</p><p>æˆ‘ä»¬åé¢ä¼šå›´ç»•ä¸Šè¿°å…³é”®è¿‡ç¨‹åšåˆ†æã€‚ä½ å¯ä»¥ç»“åˆä¸‹é¢è¿™å¼ å›¾ï¼Œçœ‹çœ‹ hello-world.cc çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œè¿˜æœ‰è¿™ä¸ªè¿‡ç¨‹é‡Œæ¶‰åŠåˆ°çš„æ ¸å¿ƒæ–¹æ³•å’Œé‡è¦æ•°æ®ç»“æ„ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/7d/09/7dae168f208c3fab69a6891a76c92109.jpg?wh=1920x1310\" alt=\"å›¾ç‰‡\"></p><p>å¥½ï¼Œè®©æˆ‘ä»¬è¿›å…¥å…·ä½“åˆ†æç¯èŠ‚ï¼Œå…ˆä»å†…å­˜ç”³è¯·å¼€å§‹è¯´èµ·ã€‚</p><h3>V8å¯åŠ¨æ—¶çš„å†…å­˜ç”³è¯·</h3><p>ç”³è¯·å†…å­˜ä» InitReservation æ–¹æ³•å¼€å§‹ï¼Œå®ƒä¸»è¦å¤„ç†çš„æ“ä½œå°±æ˜¯ä¸º V8 å¼•æ“å‘ OS ç”³è¯·å†…å­˜ï¼Œä»£ç åœ¨ src/utils/allocation.cc è¿™ä¸ªç›®å½•ä¸­ï¼š</p><pre><code class=\"language-c++\">      // Reserve a region of twice the size so that there is an aligned address\n      // within it that's usable as the cage base.\n      VirtualMemory padded_reservation(params.page_allocator,\n                                       params.reservation_size * 2,\n                                       reinterpret_cast&lt;void*&gt;(hint));\n      if (!padded_reservation.IsReserved()) return false;\n\n      // Find properly aligned sub-region inside the reservation.\n      Address address =\n          VirtualMemoryCageStart(padded_reservation.address(), params);\n      CHECK(padded_reservation.InVM(address, params.reservation_size));\n\n</code></pre><p>ç”³è¯·å†…å­˜çš„æ—¶å€™ï¼ŒInitReservation&nbsp;ä¼šå…ˆç”³è¯·ä¸¤å€çš„å†…å­˜ï¼Œä¿è¯å†…å­˜å¯¹é½ï¼Œå†ä»ä¸¤å€å†…å­˜ä¸­æ‰¾åˆ°ä¸€ä¸ªé€‚åˆå¯¹é½åœ°å€ï¼Œè¿™æ˜¯ V8 çœŸæ­£ä½¿ç”¨çš„å†…å­˜åœ°å€ã€‚è¿™å—ç”³è¯·å‡ºæ¥çš„å†…å­˜åé¢çš„å·¥ä½œé‡Œç”¨å¾—ä¸Šã€‚å®Œæˆç”³è¯·åï¼Œè¿˜ä¼šå†è°ƒç”¨ padded_reservation.Free() æ–¹æ³•ï¼Œå°†åˆšå¼€å§‹ç”³è¯·çš„å†…å­˜é‡Šæ”¾æ‰ã€‚</p><p>ä¸‹é¢æˆ‘å¸¦ä½ çœ‹çœ‹ VirtualMemoryCage æ•°æ®ç»“æ„ï¼Œå®ƒæ˜¯ V8 å†…å­˜ç®¡ç†çš„ä¸»è¦æ•°æ®ç»“æ„ã€‚V8çš„å†…å­˜æ–¹å¼é‡‡ç”¨çš„æ®µé¡µå¼ï¼Œå’Œ OS çš„å†…å­˜æ•°æ®ç»“æ„æ¯”è¾ƒç±»ä¼¼ï¼Œä½†åŒºåˆ«æ˜¯ V8 åªæœ‰ä¸€ä¸ªæ®µï¼ŒOS ä¼šæœ‰å¤šæ®µï¼Œä½†æ˜¯ V8 ä¼šæœ‰å¾ˆå¤šé¡µã€‚</p><p>VirtualMemeoryCage çš„æ•°æ®ç»“æ„ä½äºallocation.h æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-plain\">// +------------+-----------+-----------  ~~~  -+\n// |     ...    |    ...    |   ...             |\n// +------------+-----------+------------ ~~~  -+\n// ^            ^           ^\n// start        cage base   allocatable base\n//\n// &lt;------------&gt;           &lt;-------------------&gt;\n// base bias size              allocatable size\n// &lt;--------------------------------------------&gt;\n//             reservation size\n</code></pre><p>reservation size æ˜¯ V8 å®é™…ç”³è¯·çš„å†…å­˜ï¼Œstart æ˜¯å†…å­˜åŸºå€ï¼Œcage base æ˜¯é¡µè¡¨çš„ä½ç½®ï¼Œallocatable æ˜¯ V8 å¯åˆ†é…å†…å­˜çš„å¼€å§‹ï¼Œç”¨æ¥åˆ›å»º Isolateã€‚</p><h3>Isolate</h3><p>Isolateæ˜¯ä¸€ä¸ªå®Œæ•´çš„V8å®ä¾‹ï¼Œæœ‰ç€å®Œæ•´çš„å †å’Œæ ˆã€‚V8æ˜¯è™šæ‹Ÿæœºï¼ŒIsolateæ‰æ˜¯è¿è¡ŒJavaScriptçš„å®¿ä¸»ã€‚ä¸€ä¸ªIsolateæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿è¡Œç¯å¢ƒï¼ŒåŒ…æ‹¬ä½†ä¸é™äºå †ç®¡ç†å™¨ï¼ˆheapï¼‰ã€åƒåœ¾å›æ”¶å™¨ï¼ˆGCï¼‰ç­‰ã€‚</p><p>åœ¨åŒä¸€ä¸ªæ—¶é—´ï¼Œæœ‰ä¸”åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½åœ¨Isolateä¸­è¿è¡Œä»£ç ï¼Œä¹Ÿå°±æ˜¯è¯´åŒä¸€æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è¿›å…¥Iisolateï¼Œè€Œå¤šä¸ªçº¿ç¨‹å¯ä»¥é€šè¿‡åˆ‡æ¢æ¥å…±äº«åŒä¸€ä¸ªIsolateã€‚</p><p>Isolate å¯¹å¤–çš„æ¥å£æ˜¯ V8_EXPORT ï¼Œå®šä¹‰åœ¨ include/v8.h æ–‡ä»¶ä¸­ï¼Œå…¶ä»–ç¨‹åºå¯ä»¥è°ƒç”¨å®ƒã€‚è¿™ä¸ªæ¥å£ä¹Ÿå¯ä»¥ç†è§£ä¸ºJavaScriptçš„è¿è¡Œå•å…ƒï¼Œå¤šä¸ªçº¿ç¨‹ä¹Ÿå°±æ˜¯å¤šä¸ªä»»åŠ¡ï¼Œå®ƒä»¬å¯ä»¥å…±äº«ä¸€ä¸ªè¿è¡Œå•å…ƒï¼Œä¸»è¦æ¶‰åŠåˆ°å‡ ä¸ª V8 çš„æ¦‚å¿µï¼š</p><ul>\n<li>Contextï¼šä¸Šä¸‹æ–‡ï¼Œæ‰€æœ‰çš„JSä»£ç éƒ½æ˜¯åœ¨æŸä¸ªV8 Contextä¸­è¿è¡Œçš„ã€‚</li>\n<li>Handleï¼šä¸€ä¸ªæŒ‡å®šJSå¯¹è±¡çš„ç´¢å¼•ï¼Œå®ƒæŒ‡å‘æ­¤JSå¯¹è±¡åœ¨V8å †ä¸­çš„ä½ç½®ã€‚</li>\n<li>Handle Scopeï¼šåŒ…å«å¾ˆå¤šhandleçš„é›†åˆï¼Œç”¨æ¥ç»Ÿä¸€ç®¡ç†å¤šä¸ªhandleï¼Œå½“Scopeè¢«ç§»å‡ºå †æ—¶ï¼Œå®ƒæ‰€ç®¡ç†çš„handleé›†åˆä¹Ÿä¼šè¢«ç§»é™¤ã€‚</li>\n</ul><p>Isolate è¿˜æœ‰ä¸€ä¸ªå¯¹å†…çš„æ•°æ®ç»“æ„ <strong>V8_EXPORT_PRIVATE</strong>ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ ¸å¿ƒçš„æ•°æ®ç»“æ„ï¼Œå†…éƒ¨çš„å¾ˆå¤šé‡è¦çš„ç»“æ„éƒ½ä¼šç”¨åˆ°å®ƒï¼Œåé¢ç¼–è¯‘æµç¨‹æˆ‘è¿˜ä¼šè®²åˆ°ã€‚</p><h3>ç¼–è¯‘</h3><p>V8 çš„ç¼–è¯‘æµç¨‹ä¹Ÿæ˜¯ V8 çš„æ ¸å¿ƒæµç¨‹ï¼Œæˆ‘ä»¬å…ˆç®€å•çœ‹ä¸‹ç¼–è¯‘çš„å¤§æ¦‚æµç¨‹ï¼š</p><ul>\n<li>tokenize ï¼ˆåˆ†è¯ï¼‰ï¼šå°† JS ä»£ç è§£æä¸º Token æµï¼ŒToken æ˜¯è¯­æ³•ä¸Šçš„ä¸å¯æ‹†åˆ†çš„æœ€å°å•ä½ï¼›</li>\n<li>parse ï¼ˆè§£æï¼‰ï¼šè¯­æ³•åˆ†æï¼Œå°†ä¸Šä¸€æ­¥ç”Ÿæˆçš„ token æµè½¬åŒ–ä¸º AST ç»“æ„ï¼ŒAST è¢«ç§°ä¸ºæŠ½è±¡è¯­æ³•æ ‘ï¼›</li>\n<li>ignite ï¼ˆè§£é‡Šï¼‰ï¼šé€šè¿‡è§£é‡Šå™¨ï¼Œç”Ÿæˆå­—èŠ‚ç ã€‚</li>\n</ul><p>æ¥ç€ï¼Œæˆ‘ä»¬å†çœ‹çœ‹è¿™ä¸ªè¿‡ç¨‹çš„å…³é”®æ•°æ®ç»“æ„ V8_EXPORT_PRIVATE ParseInfoï¼Œä»£ç åœ¨ src/parsing/parse-info.cc ç›®å½•ä¸‹ï¼š</p><pre><code class=\"language-c++\">ParseInfo è¿™ä¸ªæ•°æ®ç»“æ„å°±æ˜¯JS ä»£ç ç”Ÿæˆtokenï¼Œå†ç”Ÿæˆ AST çš„è¿‡ç¨‹ï¼ŒAST çš„æ•°æ®ç»“æ„ä½ç½®åœ¨ src/ast/ast.hã€‚\n</code></pre><p>ç”Ÿæˆ ASTåï¼Œè§£é‡Šå™¨ä¼šæ ¹æ® ASTç”Ÿæˆå­—èŠ‚ç ï¼Œå¹¶è§£é‡Šæ‰§è¡Œå­—èŠ‚ç ã€‚å­—èŠ‚ç æ˜¯ä»‹å…¥ ASTå’Œæœºå™¨ç ä¹‹é—´çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œä½ å…ˆç•™ä¸ªå°è±¡ï¼Œæˆ‘ä»¬åé¢å†è¯¦ç»†è¯´ã€‚</p><h3>ä»£ç æ‰§è¡Œ</h3><p>ç»è¿‡ç¼–è¯‘ï¼Œæœ€ç»ˆç”Ÿæˆäº†å­—èŠ‚ç ã€‚æˆ‘ä»¬ç»§ç»­æ¥çœ‹ Exectuion è¿™ä¸ªæ•°æ®ç»“æ„ï¼Œè¿™ä¸ªç»“æ„æ‰¿è½½ç€ JS ä»£ç è¿è¡Œè¿‡ç¨‹å‰åçš„ç›¸å…³ä¿¡æ¯ï¼š</p><pre><code class=\"language-c++\">  class Execution final : public AllStatic {\n public:\n  // Whether to report pending messages, or keep them pending on the isolate.\n  enum class MessageHandling { kReport, kKeepPending };\n  enum class Target { kCallable, kRunMicrotasks };\n\n  // Call a function, the caller supplies a receiver and an array\n  // of arguments.\n  //\n  // When the function called is not in strict mode, receiver is\n  // converted to an object.\n  //\n  V8_EXPORT_PRIVATE V8_WARN_UNUSED_RESULT static MaybeHandle&lt;Object&gt; Call(\n      Isolate* isolate, Handle&lt;Object&gt; callable, Handle&lt;Object&gt; receiver,\n      int argc, Handle&lt;Object&gt; argv[]);\n</code></pre><p>é€šè¿‡å‰é¢å…³é”®è¿‡ç¨‹å’Œæ•°æ®ç»“æ„çš„è®²è§£ï¼Œç›¸ä¿¡ä½ å·²ç»åŸºæœ¬äº†è§£äº† V8 è¿è¡Œæ—¶çš„æ ¸å¿ƒæµç¨‹ï¼Œä¸‹é¢æˆ‘ä»¬ä»å®è§‚å±‚é¢çœ‹ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ã€‚</p><h2>V8 ç¼–è¯‘ â€”â€” V8 æ‰§è¡Œ JS çš„è¿‡ç¨‹</h2><p>JSä»£ç æ˜¯ç»™äººçœ‹çš„ï¼Œå¹¶ä¸èƒ½ç”±æœºå™¨ç›´æ¥è¿è¡Œï¼Œéœ€è¦å¾ˆå¤šä¸­é—´æ­¥éª¤çš„è½¬æ¢ï¼Œæ‰§è¡Œè¿™äº›æ­¥éª¤çš„å°±æ˜¯JSè§£æå™¨ã€‚</p><p>ä¸»è¦è¿‡ç¨‹æ˜¯è¿™æ ·ï¼šé¦–å…ˆå¯¹JSæºä»£ç è¿›è¡Œè¯æ³•åˆ†æï¼Œå°†æºä»£ç æ‹†åˆ†æˆä¸€ä¸ªä¸ªç®€å•çš„è¯è¯­ï¼ˆå³Tokenï¼‰ï¼›ç„¶åï¼Œä»¥è¿™äº›Tokenä¸ºè¾“å…¥æµè¿›è¡Œè¯­æ³•åˆ†æï¼Œå½¢æˆä¸€æ£µæŠ½è±¡è¯­æ³•æ ‘ï¼ˆå³ASTï¼‰ï¼Œå¹¶æ£€æŸ¥å…¶è¯­æ³•ä¸Šçš„é”™è¯¯ï¼›æœ€åï¼Œç”±è¯­æ³•æ ‘ç”Ÿæˆå­—èŠ‚ç ï¼Œç”±JSè§£æå™¨è¿è¡Œã€‚ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«è®¨è®ºè¿™å‡ ä¸ªæ­¥éª¤ã€‚</p><h3>è¯æ³•åˆ†æ</h3><p>è¯æ³•åˆ†ææ˜¯å°† JS ä»£ç æ‹†åˆ†æˆå¯¹åº”çš„ Tokenï¼ŒToken æ˜¯èƒ½æ‹†åˆ†çš„æœ€å°å•ä½ï¼Œå›ºå®š type è¡¨è¿°ç±»å‹/å±æ€§ï¼Œvalue è¡¨ç¤ºå¯¹åº”çš„å€¼ï¼Œå¦‚ä¸‹å›¾ Tokenã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b2/e3/b21df133eda30afd83629af31e9c54e3.jpg?wh=1920x670\" alt=\"å›¾ç‰‡\"></p><pre><code class=\"language-plain\">[{\n&nbsp; \"type\": \"Keyword\",\n&nbsp; \"value\": \"let\"\n}, {\n&nbsp; \"type\": \"Identifier\",\n&nbsp; \"value\": \"name\"\n}, {\n&nbsp; \"type\": \"Punctuator\",\n&nbsp; \"value\": \"=\"\n}, {\n&nbsp; \"type\": \"string\",\n&nbsp; \"value\": \"LMOS\"\n}]\n</code></pre><h3>è¯­æ³•åˆ†æ</h3><p>åœ¨è¿›è¡Œè¯æ³•åˆ†æè½¬ä¸º Token ä¹‹åï¼Œè§£æå™¨ä¼šç»§ç»­æ ¹æ®ç”Ÿæˆçš„ Token ç”Ÿæˆå¯¹åº”çš„ ASTã€‚è¯´èµ·ASTï¼Œç›¸ä¿¡å‰ç«¯åŒå­¦å¹¶ä¸é™Œç”Ÿï¼Œä¹Ÿæ˜¯çƒ­è¯ä¹‹ä¸€ï¼Œæ— è®ºæ˜¯åœ¨ Vueã€React ä¸­è¡¨ç¤ºè™šæ‹Ÿ DOM ï¼Œæˆ–è€…è¡¨ç¤º Babel å¯¹ JS çš„è½¬è¯‘ï¼Œéƒ½éœ€è¦å…ˆå°†å…¶è½¬åŒ–ä¸ºå¯¹åº”çš„ ASTã€‚</p><h3>å­—èŠ‚ç </h3><p>åœ¨è§£æå™¨ï¼ˆParserï¼‰å°† JS ä»£ç è§£ææˆ AST ä¹‹åï¼Œ<strong>è§£é‡Šå™¨</strong>ï¼ˆIgnitionï¼‰æ ¹æ® AST æ¥ç”Ÿæˆå­—èŠ‚ç ï¼ˆä¹Ÿç§°ä¸­é—´ç ï¼‰ã€‚å‰æ–‡æåˆ° CPU åªèƒ½è¯†åˆ«æœºå™¨ç ï¼Œå¯¹å­—èŠ‚ç æ˜¯è¯†åˆ«ä¸äº†çš„ï¼Œè¿™é‡Œå°±è¡ç”Ÿå‡ºä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœ CPU è¯†åˆ«ä¸äº†å­—èŠ‚ç ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦åœ¨ä¸­é—´æ’ä¸€æ­¥æ¥è€—è´¹èµ„æºè½¬æˆå­—èŠ‚ç å‘¢ï¼Ÿæ•ˆç‡ä¸æ˜¯å¾ˆä½å—ï¼Ÿ</p><p>åœ¨è®¡ç®—æœºå­¦ç§‘é‡ŒèŠæ•ˆç‡ï¼Œéƒ½é€ƒé¿ä¸äº†æ—¶é—´å’Œç©ºé—´è¿™ä¸¤ä¸ªæ¦‚å¿µï¼Œç»å¤§éƒ¨åˆ†çš„ä¼˜åŒ–éƒ½æ˜¯ç©ºé—´æ¢æ—¶é—´æˆ–æ—¶é—´æ¢ç©ºé—´ï¼Œä¸¤è€…çš„å¹³è¡¡ï¼Œæ•ˆç‡å¦‚ä½•è¾¾åˆ°æœ€é«˜ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå€¼å¾—æ·±å…¥ç ”ç©¶çš„é—®é¢˜ã€‚</p><p>æ‹¿ä¹‹å‰ç‰ˆæœ¬çš„ V8 å¼•æ“æ‰§è¡Œ JS æ¥è¯´ï¼Œæ˜¯æ²¡æœ‰è½¬å­—èŠ‚ç è¿™ä¸€æ­¥éª¤çš„ï¼Œè€Œæ˜¯ç›´æ¥ä» AST è½¬æˆæœºå™¨ç ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºç¼–è¯‘è¿‡ç¨‹ï¼Œæ‰€ä»¥æ¯æ¬¡æ‹¿åˆ° JS æ–‡ä»¶çš„æ—¶å€™ï¼Œé¦–å…ˆéƒ½ä¼šç¼–è¯‘ï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒæµªè´¹æ—¶é—´çš„ï¼Œè¿™æ˜¯ä¸€ä»¶æ¯”è¾ƒå¤´ç–¼çš„äº‹æƒ…ï¼Œéœ€è¦ä¸€ä¸ªè§£å†³åŠæ³•ã€‚</p><h2>V8 ä¸­çš„ä¼˜åŒ–ç»†èŠ‚</h2><p>V8 æ‰§è¡Œ JS çš„ä¸»è¦è¿‡ç¨‹æˆ‘ä»¬è¯´å®Œäº†ï¼Œå…¶å®åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒV8 åˆ©ç”¨ JIT çš„èƒ½åŠ›åšäº†å¾ˆå¤šæ–¹é¢çš„ä¼˜åŒ–ï¼Œç°åœ¨æˆ‘ä»¬çœ‹ä¸€ä¸‹å…·ä½“æœ‰å“ªäº›ã€‚</p><h3>ç¼“å­˜æœºå™¨ç </h3><p>ä¸€ä¸ªç½‘é¡µåªè¦ç¬¬ä¸€æ¬¡æ‰“å¼€è¿‡ï¼Œå…³é—­å†æ¬¡å»æ‰“å¼€ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯å’ŒåŸæ¥ JS æ–‡ä»¶ä¸€è‡´çš„ï¼Œé™¤éå¼€å‘è€…ä¿®æ”¹äº†ä»£ç ï¼Œä½†è¿™ä¸ªå¯ä»¥æš‚æ—¶ä¸è€ƒè™‘ã€‚æ¯•ç«Ÿå“ªä¸ªç½‘ç«™ä¹Ÿä¸ä¼šä¸€å¤©é—²å¾—æ— èŠï¼Œä¸åœåœ°ä¿®æ”¹ï¼Œä¸Šä¼ æ›¿æ¢ã€‚</p><p>æŒ‰ç…§è¿™ä¸ªæ€è·¯ï¼Œæ—¢ç„¶ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ–‡ä»¶ä¸ä¼šä¿®æ”¹ï¼Œé‚£ç¼–è¯‘åçš„æœºå™¨ç å¯ä»¥è€ƒè™‘ç¼“å­˜ä¸‹æ¥ï¼Œè¿™æ ·ä¸€æ¥ï¼Œä¸‹æ¬¡å†æ‰“å¼€æˆ–è€…åˆ·æ–°é¡µé¢çš„æ—¶å€™å°±çœå»ç¼–è¯‘çš„è¿‡ç¨‹äº†ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œäº†ã€‚</p><p>å­˜å‚¨æœºå™¨ç å¯ä»¥åˆ†æˆä¸¤ç§æƒ…å†µï¼šä¸€ä¸ªæ˜¯æµè§ˆå™¨æœªå…³é—­æ—¶å€™ï¼Œç›´æ¥å­˜å‚¨åˆ°æµè§ˆå™¨æœ¬åœ°çš„å†…å­˜ä¸­ï¼›ä¸€ä¸ªæ˜¯æµè§ˆå™¨å…³é—­äº†ï¼Œç›´æ¥å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œè€Œæ—©æœŸçš„ V8 ä¹Ÿç¡®å®æ˜¯è¿™ä¹ˆåšçš„ï¼Œå…¸å‹çš„ç‰ºç‰²ç©ºé—´æ¢æ—¶é—´ã€‚</p><h3>çƒ­ä»£ç </h3><p>åœ¨ä»£ç ä¸­ï¼Œå¸¸å¸¸ä¼šæœ‰åŒä¸€éƒ¨åˆ†ä»£ç ï¼Œè¢«å¤šæ¬¡è°ƒç”¨ï¼ŒåŒä¸€éƒ¨åˆ†ä»£ç å¦‚æœæ¯æ¬¡éƒ½éœ€è¦è§£é‡Šå™¨è½¬äºŒè¿›åˆ¶ä»£ç å†å»æ‰§è¡Œï¼Œæ•ˆç‡ä¸Šæ¥è¯´ï¼Œä¼šæœ‰äº›æµªè´¹ï¼Œæ‰€ä»¥åœ¨ V8 æ¨¡å—ä¸­ä¼šæœ‰ä¸“é—¨çš„ç›‘æ§æ¨¡å—ï¼Œæ¥ç›‘æ§åŒä¸€ä»£ç æ˜¯å¦å¤šæ¬¡è¢«è°ƒç”¨ï¼Œå¦‚æœè¢«å¤šæ¬¡è°ƒç”¨ï¼Œé‚£ä¹ˆå°±ä¼šè¢«æ ‡è®°ä¸º<strong>çƒ­ä»£ç </strong>ï¼Œè¿™æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿæˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ã€‚</p><h3>ä¼˜åŒ–ç¼–è¯‘å™¨</h3><p><strong>TurboFan</strong> (ä¼˜åŒ–ç¼–è¯‘å™¨) è¿™ä¸ªè¯ï¼Œç›¸ä¿¡å…³æ³¨æ‰‹æœºç•Œçš„åŒå­¦å¹¶ä¸é™Œç”Ÿï¼Œåä¸ºã€å°ç±³ç­‰è¿™äº›å“ç‰Œï¼Œåœ¨è¿‘å‡ å¹´äº§å“å‘å¸ƒä¼šä¸Šéƒ½ä¼šå‡ºç°è¿™ä¸ªè¯ï¼Œä¸»è¦çš„èƒ½åŠ›æ˜¯é€šè¿‡è½¯ä»¶è®¡ç®—èƒ½åŠ›æ¥ä¼˜åŒ–ä¸€ç³»åˆ—çš„åŠŸèƒ½ï¼Œä½¿å¾—æ•ˆç‡æ›´ä¼˜ã€‚</p><p>æ¥ç€çƒ­ä»£ç ç»§ç»­è¯´ï¼Œå½“å­˜åœ¨çƒ­ä»£ç çš„æ—¶å€™ï¼ŒV8 ä¼šå€ŸåŠ© TurboFan å°†ä¸ºçƒ­ä»£ç çš„å­—èŠ‚ç è½¬ä¸ºæœºå™¨ç å¹¶ç¼“å­˜ä¸‹æ¥ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå½“å†æ¬¡è°ƒç”¨çƒ­ä»£ç æ—¶ï¼Œå°±ä¸å†éœ€è¦å°†å­—èŠ‚ç è½¬ä¸ºæœºå™¨ç ã€‚å½“ç„¶ï¼Œçƒ­ä»£ç ç›¸å¯¹æ¥è¯´è¿˜æ˜¯å°‘éƒ¨åˆ†çš„ï¼Œæ‰€ä»¥ç¼“å­˜ä¹Ÿå¹¶ä¸ä¼šå ç”¨å¤ªå¤§å†…å­˜ï¼Œå¹¶ä¸”æå‡äº†æ‰§è¡Œæ•ˆç‡ï¼ŒåŒæ ·æ­¤å¤„ä¹Ÿæ˜¯ç‰ºç‰²ç©ºé—´æ¢æ—¶é—´ã€‚</p><h3>åä¼˜åŒ–</h3><p>JS è¯­è¨€æ˜¯åŠ¨æ€è¯­è¨€ï¼Œéå¸¸ä¹‹çµæ´»ï¼Œå¯¹è±¡çš„ç»“æ„å’Œå±æ€§åœ¨è¿è¡Œæ—¶æ˜¯å¯ä»¥å‘ç”Ÿæ”¹å˜çš„ï¼Œæˆ‘ä»¬è®¾æƒ³ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœçƒ­ä»£ç åœ¨æŸæ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œçªç„¶å…¶ä¸­çš„æŸä¸ªå±æ€§è¢«ä¿®æ”¹äº†ï¼Œé‚£ä¹ˆç¼–è¯‘æˆæœºå™¨ç çš„çƒ­ä»£ç è¿˜èƒ½ç»§ç»­æ‰§è¡Œå—ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯è‚¯å®šä¸èƒ½ã€‚è¿™ä¸ªæ—¶å€™å°±è¦ä½¿ç”¨åˆ°ä¼˜åŒ–ç¼–è¯‘å™¨çš„<strong>åä¼˜åŒ–</strong>äº†ï¼Œå®ƒä¼šå°†çƒ­ä»£ç é€€å›åˆ° AST è¿™ä¸€æ­¥ï¼Œè¿™ä¸ªæ—¶å€™è§£é‡Šå™¨ä¼šé‡æ–°è§£é‡Šæ‰§è¡Œè¢«ä¿®æ”¹çš„ä»£ç ï¼›å¦‚æœä»£ç å†æ¬¡è¢«æ ‡è®°ä¸ºçƒ­ä»£ç ï¼Œé‚£ä¹ˆä¼šé‡å¤æ‰§è¡Œä¼˜åŒ–ç¼–è¯‘å™¨çš„è¿™ä¸ªæ­¥éª¤ã€‚</p><h2>æ€»ç»“</h2><p>è¿™èŠ‚è¯¾æˆ‘ä»¬å…ˆé€šè¿‡ç¼–è¯‘æºç çš„æ–¹å¼æ­å»ºäº† V8 çš„ç¯å¢ƒï¼Œåˆé€šè¿‡ V8 é¡¹ç›®ä¸­çš„ hello_world é¡¹ç›®ä¸€æ­¥æ­¥å­¦ä¹ äº† V8 æ‰§è¡Œ JSä»£ç çš„è¿‡ç¨‹ï¼Œæœ€åï¼Œæˆ‘ä»¬åˆä»å®è§‚è§’åº¦äº†è§£äº† V8 æ‰§è¡Œ JS ä»£ç çš„å…¨è¿‡ç¨‹ã€‚</p><p>è¿™èŠ‚è¯¾çš„è¦ç‚¹ï¼Œä½ å¯ä»¥ç»“åˆåé¢çš„å¯¼å›¾çœ‹ä¸€ä¸‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/bf/f4/bf60238a8ce64035215bd60ca5aba5f4.jpg?wh=1920x2196\" alt=\"å›¾ç‰‡\"></p><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ V8 é¡¹ç›®çš„å…³é”®ä»£ç å’Œæ•°æ®ç»“æ„æ·±å…¥çš„äº†è§£äº† V8 è¿™ä¸ªé¡¹ç›®ã€‚åœ¨å­¦ä¹ ä¸€ä¸ªå¼€æºå·¨çŸ³é¡¹ç›®çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¦æŒæ¡ä¸€å®šçš„å­¦ä¹ æ–¹å¼ï¼Œåˆ‡ä¸å¯ä»¥åœ¨åˆå­¦ä¹ çš„é˜¶æ®µå°±è¿‡åº¦è‡ªåº•è€Œä¸Šåœ°çº ç»“äºå„ç§ä»£ç ç»†èŠ‚ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™æ ·çš„æ–¹å¼è¿›è¡Œå­¦ä¹ ï¼š</p><ul>\n<li>åˆæ­¥å»ºç«‹å°è±¡ï¼šè‡ªé¡¶è€Œä¸Šçš„äº†è§£é¡¹ç›®çš„ç»“æ„å’Œæ¶æ„ï¼Œå½¢æˆä¸€ä¸ªåˆæ­¥çš„å®è§‚è§†è§‰ï¼›</li>\n<li>æ¢³ç†ä¸»çº¿ï¼šè¿›å…¥ç¨‹åºæºç çš„è§’åº¦ï¼Œç†è§£ä»£ç çš„ä¸»è¦è„‰ç»œï¼Œå»ºè®®ä»ä¸€ä¸ªç®€å•çš„ä¾‹å­å…¥æ‰‹ï¼›</li>\n<li>å…³æ³¨é‡è¦è¿‡ç¨‹ï¼šå…³æ³¨è¿‡ç¨‹ä¸­çš„å…³é”®ä»£ç è¾“å…¥è¾“å‡ºï¼Œè¿è¡Œè¿‡ç¨‹ä¸­çš„å‡ ä¸ªé‡è¦ä¸­é—´é˜¶æ®µã€é‡è¦ä¸­é—´ç»“æœå’Œæ•°æ®ç»“æ„ï¼›</li>\n<li>æŸ¥æ¼è¡¥ç¼ºï¼šè¡¥å……ç»†èŠ‚çŸ¥è¯†ç‚¹çš„æŸ¥æ¼è¡¥ç¼ºï¼Œç»“åˆè‡ªå·±æƒ…å†µæ·±å…¥å­¦ä¹ ã€‚</li>\n</ul><p>V8 åœ¨æ‰§è¡Œ JS çš„è¿‡ç¨‹ä¸­åˆå¯ä»¥è¿›è¡Œå¾ˆå¤šä¼˜åŒ–ï¼Œå…·ä½“æ–¹å¼å°±æ˜¯åœ¨è¿è¡Œ JS è¿‡ç¨‹ä¸­æŒç»­è®°å½•ä»£ç è¯­å¥æ‰§è¡Œæƒ…å†µï¼Œä»¥åŠå˜é‡ç±»å‹çš„å˜åŒ–æƒ…å†µã€‚è‹¥æ¨æµ‹ä»£ç æ‰§è¡Œæ¬¡æ•°è¾ƒå¤šï¼ˆçƒ­ç‚¹ä»£ç ï¼‰ä¸”å˜é‡ç±»å‹è¾ƒå›ºå®šæ—¶ï¼Œå°±ä¼šè°ƒç”¨ä¼˜åŒ–å™¨ä¼˜åŒ–è¿™éƒ¨åˆ†ä»£ç ï¼Œç¼“å­˜è¿™éƒ¨åˆ†æœºå™¨ç  + è·³è¿‡è¿™éƒ¨åˆ†ç±»å‹åˆ¤æ–­é€»è¾‘ï¼Œä»è€Œå®ç°æ€§èƒ½ä¼˜åŒ–ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>V8 åœ¨æ‰§è¡Œ JS çš„è¿‡ç¨‹ä¸­å¯ä»¥åšå“ªäº›æ€§èƒ½ä¼˜åŒ–ï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºä¸æˆ‘äº¤æµè®¨è®ºï¼Œä¹Ÿæ¨èä½ æŠŠè¯¾ç¨‹åˆ†äº«ç»™æ›´å¤šæœ‹å‹ã€‚</p>","comments":[{"had_liked":false,"id":362456,"user_name":"åŠŸå¤«ç†ŠçŒ«","can_delete":false,"product_type":"c1","uid":2732243,"ip_address":"æ¹–åŒ—","ucode":"D124F4FA4E816F","user_header":"https://static001.geekbang.org/account/avatar/00/29/b0/d3/200e82ff.jpg","comment_is_top":false,"comment_ctime":1668528915,"is_pvip":false,"replies":[{"id":131941,"content":"ä½ çš„è¦æ±‚æœ‰ç‚¹ç‚¹é«˜å“¦","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1345199,"ctime":1668992482,"ip_address":"æ¹–åŒ—","comment_id":362456,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100117801,"comment_content":"è€å¸ˆå¯ä»¥å¼€ä¸€é—¨ä¸“é—¨çš„ç¼–è¯‘å™¨çš„è¯¾ç¨‹å—ï¼Ÿæˆ–è€…å¸¦æˆ‘ä»¬å†™ä¸€é—¨ç¼–è¯‘å™¨ä¹Ÿå¯ä»¥ğŸ˜Š","like_count":2,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":594324,"discussion_content":"ä½ çš„è¦æ±‚æœ‰ç‚¹ç‚¹é«˜å“¦","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1668992482,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¹–åŒ—","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":2,"child_discussions":[{"author":{"id":2732243,"avatar":"https://static001.geekbang.org/account/avatar/00/29/b0/d3/200e82ff.jpg","nickname":"åŠŸå¤«ç†ŠçŒ«","note":"","ucode":"D124F4FA4E816F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":594529,"discussion_content":"å˜¿å˜¿ğŸ˜ï¼Œè€å¸ˆéƒ½å¸¦æˆ‘ä»¬å†™äº†ä¸€ä¸ªæ“ä½œç³»ç»Ÿäº†ï¼Œå°å°çš„ç¼–è¯‘å™¨è€å¸ˆåº”è¯¥ä¸åœ¨è¯ä¸‹å§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1669129446,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":594324,"ip_address":"æ±Ÿè‹","group_id":0},"score":594529,"extra":""},{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"å¬æ°´çš„æ¹–","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":2732243,"avatar":"https://static001.geekbang.org/account/avatar/00/29/b0/d3/200e82ff.jpg","nickname":"åŠŸå¤«ç†ŠçŒ«","note":"","ucode":"D124F4FA4E816F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":594533,"discussion_content":"å¯ä»¥çœ‹ä¸‹éš”å£å®«æ–‡å­¦è€å¸ˆçš„è¯¾ï½","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1669137908,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":594529,"ip_address":"åŒ—äº¬","group_id":0},"score":594533,"extra":""}]}]},{"had_liked":false,"id":361106,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"æ¹–åŒ—","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1667224648,"is_pvip":false,"replies":[{"id":131764,"content":"ä¸åŒ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1345199,"ctime":1668311853,"ip_address":"æ¹–åŒ—","comment_id":361106,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100117801,"comment_content":"è¯·é—®ï¼šV8çš„å­—èŠ‚ç å’ŒJavaçš„å­—èŠ‚ç æ˜¯ç›¸åŒçš„å—ï¼Ÿæˆ–è€…è¯´ï¼Œæ˜¯åŒä¸€ä¸ªæ ‡å‡†å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593539,"discussion_content":"ä¸åŒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1668311853,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¹–åŒ—","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361066,"user_name":"è‹æµéƒå®“","can_delete":false,"product_type":"c1","uid":2729645,"ip_address":"æ¹–åŒ—","ucode":"AD07BD9CE03047","user_header":"https://static001.geekbang.org/account/avatar/00/29/a6/ad/e65aec4c.jpg","comment_is_top":false,"comment_ctime":1667179996,"is_pvip":false,"replies":[{"id":131768,"content":"å¯ä»¥ç›´æ¥ä¸‹è½½å•Š æœ‰winå’Œlinuxç‰ˆæœ¬çš„ ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1345199,"ctime":1668312028,"ip_address":"æ¹–åŒ—","comment_id":361066,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100117801,"comment_content":"éœ€è¦ winç³»ç»Ÿæˆ–è€…ubuntuç­‰linuxç³»ç»Ÿæ€ä¹ˆè¿è¡Œæµ‹è¯•v8ï¼Œå¸Œæœ›å“ªä½å¤§ç¥åˆ†äº«ä¸‹å“¦","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593543,"discussion_content":"å¯ä»¥ç›´æ¥ä¸‹è½½å•Š æœ‰winå’Œlinuxç‰ˆæœ¬çš„ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1668312028,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¹–åŒ—","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":381566,"user_name":"WJYGRIT","can_delete":false,"product_type":"c1","uid":3722506,"ip_address":"æ¹–åŒ—","ucode":"C55514D6DA8056","user_header":"https://static001.geekbang.org/account/avatar/00/38/cd/0a/8898e1df.jpg","comment_is_top":false,"comment_ctime":1695405594,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100117801,"comment_content":"è€å¸ˆï¼Œä½ å¥½ï¼Œæˆ‘æƒ³é—®ä¸‹ï¼Œèƒ½åœ¨xcodeä¸­æ–­ç‚¹è°ƒè¯•v8æºç å—ï¼Ÿ hello_world æˆ‘è‡ªå·±è¿è¡Œäº†å¥½å‡ éï¼Œ å°±æ˜¯ä¸èƒ½æ–­ç‚¹è°ƒè¯•ã€‚\nä¹Ÿæ”¹äº†å¾ˆå¤šé…ç½®éƒ½ä¸è¡Œï¼Œçœ‹ç½‘ä¸Šè¯´å¯ä»¥ç”¨ symbolï¼Œ ä½†è¿™ä¸ªè°ƒè¯•å‡ºæ¥æ˜¯æ±‡ç¼–ç ã€‚ \nåœ¨ç½‘ä¸Šæ‰¾äº†ä¸€å¤§åœˆï¼Œ éƒ½æ²¡æœ‰ç›¸å…³çš„è¯´æ˜","like_count":0,"discussions":[{"author":{"id":1453431,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2d/77/bbd3cdec.jpg","nickname":"é»„é¸¿æ˜Œ","note":"","ucode":"155485BF5FFAF5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":641079,"discussion_content":"å¥½åƒè¦d8","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1712142611,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}