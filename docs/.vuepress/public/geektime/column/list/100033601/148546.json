{"id":148546,"title":"30｜HTTP/2：如何提升网络速度？","content":"<p><a href=\"https://time.geekbang.org/column/article/147501\">上一篇文章</a>我们聊了HTTP/1.1的发展史，虽然HTTP/1.1已经做了大量的优化，但是依然存在很多性能瓶颈，依然不能满足我们日益变化的新需求，所以就有了我们今天要聊的HTTP/2。</p><p>本文我们依然从需求的层面来谈，先分析HTTP/1.1存在哪些问题，然后再来分析HTTP/2是如何解决这些问题的。</p><p>我们知道HTTP/1.1为网络效率做了大量的优化，最核心的有如下三种方式：</p><ol>\n<li>增加了持久连接；</li>\n<li>浏览器为每个域名最多同时维护6个TCP持久连接；</li>\n<li>使用CDN的实现域名分片机制。</li>\n</ol><p>通过这些方式就大大提高了页面的下载速度，你可以通过下图来直观感受下：</p><p><img src=\"https://static001.geekbang.org/resource/image/91/c5/91c3e0a8f13ebc4d81f08d8604f770c5.png?wh=1142*849\" alt=\"\"></p><center><span class=\"reference\">HTTP/1.1的资源下载方式</span></center><p>在该图中，引入了CDN，并同时为每个域名维护6个连接，这样就大大减轻了整个资源的下载时间。这里我们可以简单计算下：如果使用单个TCP的持久连接，下载100个资源所花费的时间为100 * n * RTT；若通过上面的技术，就可以把整个时间缩短为100 * n * RTT/(6 * CDN个数)。从这个计算结果来看，我们的页面加载速度变快了不少。</p><h2>HTTP/1.1的主要问题</h2><p>虽然HTTP/1.1采取了很多优化资源加载速度的策略，也取得了一定的效果，但是HTTP/1.1<strong>对带宽的利用率却并不理想</strong>，这也是HTTP/1.1的一个核心问题。</p><!-- [[[read_end]]] --><p><strong>带宽是指每秒最大能发送或者接收的字节数</strong>。我们把每秒能发送的最大字节数称为<strong>上行带宽</strong>，每秒能够接收的最大字节数称为<strong>下行带宽</strong>。</p><p>之所以说HTTP/1.1对带宽的利用率不理想，是因为HTTP/1.1很难将带宽用满。比如我们常说的100M带宽，实际的下载速度能达到12.5M/S，而采用HTTP/1.1时，也许在加载页面资源时最大只能使用到2.5M/S，很难将12.5M全部用满。</p><p>之所以会出现这个问题，主要是由以下三个原因导致的。</p><p><strong>第一个原因，TCP的慢启动。</strong></p><p>一旦一个TCP连接建立之后，就进入了发送数据状态，刚开始TCP协议会采用一个非常慢的速度去发送数据，然后慢慢加快发送数据的速度，直到发送数据的速度达到一个理想状态，我们把这个过程称为慢启动。</p><p>你可以把每个TCP发送数据的过程看成是一辆车的启动过程，当刚进入公路时，会有从0到一个稳定速度的提速过程，TCP的慢启动就类似于该过程。</p><p>慢启动是TCP为了减少网络拥塞的一种策略，我们是没有办法改变的。</p><p>而之所以说慢启动会带来性能问题，是因为页面中常用的一些关键资源文件本来就不大，如HTML文件、CSS文件和JavaScript文件，通常这些文件在TCP连接建立好之后就要发起请求的，但这个过程是慢启动，所以耗费的时间比正常的时间要多很多，这样就推迟了宝贵的首次渲染页面的时长了。</p><p><strong>第二个原因，同时开启了多条TCP连接，那么这些连接会竞争固定的带宽。</strong></p><p>你可以想象一下，系统同时建立了多条TCP连接，当带宽充足时，每条连接发送或者接收速度会慢慢向上增加；而一旦带宽不足时，这些TCP连接又会减慢发送或者接收的速度。比如一个页面有200个文件，使用了3个CDN，那么加载该网页的时候就需要建立6 * 3，也就是18个TCP连接来下载资源；在下载过程中，当发现带宽不足的时候，各个TCP连接就需要动态减慢接收数据的速度。</p><p>这样就会出现一个问题，因为有的TCP连接下载的是一些关键资源，如CSS文件、JavaScript文件等，而有的TCP连接下载的是图片、视频等普通的资源文件，但是多条TCP连接之间又不能协商让哪些关键资源优先下载，这样就有可能影响那些关键资源的下载速度了。</p><p><strong>第三个原因，HTTP/1.1队头阻塞的问题。</strong></p><p>通过<a href=\"https://time.geekbang.org/column/article/147501\">上一篇文章</a>，我们知道在HTTP/1.1中使用持久连接时，虽然能公用一个TCP管道，但是在一个管道中同一时刻只能处理一个请求，在当前的请求没有结束之前，其他的请求只能处于阻塞状态。这意味着我们不能随意在一个管道中发送请求和接收内容。</p><p>这是一个很严重的问题，因为阻塞请求的因素有很多，并且都是一些不确定性的因素，假如有的请求被阻塞了5秒，那么后续排队的请求都要延迟等待5秒，在这个等待的过程中，带宽、CPU都被白白浪费了。</p><p>在浏览器处理生成页面的过程中，是非常希望能提前接收到数据的，这样就可以对这些数据做预处理操作，比如提前接收到了图片，那么就可以提前进行编解码操作，等到需要使用该图片的时候，就可以直接给出处理后的数据了，这样能让用户感受到整体速度的提升。</p><p>但队头阻塞使得这些数据不能并行请求，所以队头阻塞是很不利于浏览器优化的。</p><h2>HTTP/2的多路复用</h2><p>前面我们分析了HTTP/1.1所存在的一些主要问题：慢启动和TCP连接之间相互竞争带宽是由于TCP本身的机制导致的，而队头阻塞是由于HTTP/1.1的机制导致的。</p><p>那么该如何去解决这些问题呢？</p><p>虽然TCP有问题，但是我们依然没有换掉TCP的能力，所以我们就要想办法去规避TCP的慢启动和TCP连接之间的竞争问题。</p><p>基于此，HTTP/2的思路就是一个域名只使用一个TCP长连接来传输数据，这样整个页面资源的下载过程只需要一次慢启动，同时也避免了多个TCP连接竞争带宽所带来的问题。</p><p>另外，就是队头阻塞的问题，等待请求完成后才能去请求下一个资源，这种方式无疑是最慢的，所以HTTP/2需要实现资源的并行请求，也就是任何时候都可以将请求发送给服务器，而并不需要等待其他请求的完成，然后服务器也可以随时返回处理好的请求资源给浏览器。</p><p>所以，HTTP/2的解决方案可以总结为：<strong>一个域名只使用一个TCP长连接和消除队头阻塞问题</strong>。可以参考下图：</p><p><img src=\"https://static001.geekbang.org/resource/image/0a/00/0a990f86ad9c19fd7d7620b2ef7ee900.jpg?wh=4526*1786\" alt=\"\"></p><center><span class=\"reference\">HTTP/2的多路复用</span></center><p>该图就是HTTP/2最核心、最重要且最具颠覆性的<strong>多路复用机制</strong>。从图中你会发现每个请求都有一个对应的ID，如stream1表示index.html的请求，stream2表示foo.css的请求。这样在浏览器端，就可以随时将请求发送给服务器了。</p><p>服务器端接收到这些请求后，会根据自己的喜好来决定优先返回哪些内容，比如服务器可能早就缓存好了index.html和bar.js的响应头信息，那么当接收到请求的时候就可以立即把index.html和bar.js的响应头信息返回给浏览器，然后再将index.html和bar.js的响应体数据返回给浏览器。之所以可以随意发送，是因为每份数据都有对应的ID，浏览器接收到之后，会筛选出相同ID的内容，将其拼接为完整的HTTP响应数据。</p><p>HTTP/2使用了多路复用技术，可以将请求分成一帧一帧的数据去传输，这样带来了一个额外的好处，就是当收到一个优先级高的请求时，比如接收到JavaScript或者CSS关键资源的请求，服务器可以暂停之前的请求来优先处理关键资源的请求。</p><h2>多路复用的实现</h2><p>现在我们知道为了解决HTTP/1.1存在的问题，HTTP/2采用了多路复用机制，那HTTP/2是怎么实现多路复用的呢？你可以先看下面这张图：</p><p><img src=\"https://static001.geekbang.org/resource/image/86/6a/86cdf01a3af7f4f755d28917e58aae6a.png?wh=1142*1156\" alt=\"\"></p><center><span class=\"reference\">HTTP/2协议栈</span></center><p>从图中可以看出，HTTP/2添加了一个<strong>二进制分帧层</strong>，那我们就结合图来分析下HTTP/2的请求和接收过程。</p><ul>\n<li>首先，浏览器准备好请求数据，包括了请求行、请求头等信息，如果是POST方法，那么还要有请求体。</li>\n<li>这些数据经过二进制分帧层处理之后，会被转换为一个个带有请求ID编号的帧，通过协议栈将这些帧发送给服务器。</li>\n<li>服务器接收到所有帧之后，会将所有相同ID的帧合并为一条完整的请求信息。</li>\n<li>然后服务器处理该条请求，并将处理的响应行、响应头和响应体分别发送至二进制分帧层。</li>\n<li>同样，二进制分帧层会将这些响应数据转换为一个个带有请求ID编号的帧，经过协议栈发送给浏览器。</li>\n<li>浏览器接收到响应帧之后，会根据ID编号将帧的数据提交给对应的请求。</li>\n</ul><p>从上面的流程可以看出，<strong>通过引入二进制分帧层，就实现了HTTP的多路复用技术</strong>。</p><p><a href=\"https://time.geekbang.org/column/article/147501\">上一篇文章</a>我们介绍过，HTTP是浏览器和服务器通信的语言，在这里虽然HTTP/2引入了二进制分帧层，不过HTTP/2的语义和HTTP/1.1依然是一样的，也就是说它们通信的语言并没有改变，比如开发者依然可以通过Accept请求头告诉服务器希望接收到什么类型的文件，依然可以使用Cookie来保持登录状态，依然可以使用Cache来缓存本地文件，这些都没有变，发生改变的只是传输方式。这一点对开发者来说尤为重要，这意味着我们不需要为HTTP/2去重建生态，并且HTTP/2推广起来会也相对更轻松了。</p><h2>HTTP/2其他特性</h2><p>通过上面的分析，我们知道了多路复用是HTTP/2的最核心功能，它能实现资源的并行传输。多路复用技术是建立在二进制分帧层的基础之上。其实基于二进制分帧层，HTTP/2还附带实现了很多其他功能，下面我们就来简要了解下。</p><h3>1. 可以设置请求的优先级</h3><p>我们知道浏览器中有些数据是非常重要的，但是在发送请求时，重要的请求可能会晚于那些不怎么重要的请求，如果服务器按照请求的顺序来回复数据，那么这个重要的数据就有可能推迟很久才能送达浏览器，这对于用户体验来说是非常不友好的。</p><p>为了解决这个问题，HTTP/2提供了请求优先级，可以在发送请求时，标上该请求的优先级，这样服务器接收到请求之后，会优先处理优先级高的请求。</p><h3>2. 服务器推送</h3><p>除了设置请求的优先级外，HTTP/2还可以直接将数据提前推送到浏览器。你可以想象这样一个场景，当用户请求一个HTML页面之后，服务器知道该HTML页面会引用几个重要的JavaScript文件和CSS文件，那么在接收到HTML请求之后，附带将要使用的CSS文件和JavaScript文件一并发送给浏览器，这样当浏览器解析完HTML文件之后，就能直接拿到需要的CSS文件和JavaScript文件，这对首次打开页面的速度起到了至关重要的作用。</p><h3>3. 头部压缩</h3><p>无论是HTTP/1.1还是HTTP/2，它们都有请求头和响应头，这是浏览器和服务器的通信语言。HTTP/2对请求头和响应头进行了压缩，你可能觉得一个HTTP的头文件没有多大，压不压缩可能关系不大，但你这样想一下，在浏览器发送请求的时候，基本上都是发送HTTP请求头，很少有请求体的发送，通常情况下页面也有100个左右的资源，如果将这100个请求头的数据压缩为原来的20%，那么传输效率肯定能得到大幅提升。</p><h2>总结</h2><p>好了，今天就介绍这里，下面我来总结下本文的主要内容。</p><p>我们首先分析了影响HTTP/1.1效率的三个主要因素：TCP的慢启动、多条TCP连接竞争带宽和队头阻塞。</p><p>接下来我们分析了HTTP/2是如何采用多路复用机制来解决这些问题的。多路复用是通过在协议栈中添加二进制分帧层来实现的，有了二进制分帧层还能够实现请求的优先级、服务器推送、头部压缩等特性，从而大大提升了文件传输效率。</p><p>HTTP/2协议规范于2015年5月正式发布，在那之后，该协议已在互联网和万维网上得到了广泛的实现和部署。从目前的情况来看，国内外一些排名靠前的站点基本都实现了HTTP/2的部署。使用HTTP/2能带来20%～60%的效率提升，至于20%还是60%要看优化的程度。总之，我们也应该与时俱进，放弃HTTP/1.1和其性能优化方法，去“拥抱”HTTP/2。</p><h2>思考时间</h2><p>虽然HTTP/2解决了HTTP/1.1中的队头阻塞问题，但是HTTP/2依然是基于TCP协议的，而TCP协议依然存在数据包级别的队头阻塞问题，那么你觉得TCP的队头阻塞是如何影响到HTTP/2性能的呢？</p><p>欢迎在留言区与我分享你的想法，也欢迎你在留言区记录你的思考过程。感谢阅读，如果你觉得这篇文章对你有帮助的话，也欢迎把它分享给更多的朋友。</p>","neighbors":{"left":{"article_title":"29 | HTTP/1：HTTP性能优化","id":147501},"right":{"article_title":"31｜HTTP/3：甩掉TCP、TLS 的包袱，构建高效网络","id":150159}},"comments":[{"had_liked":false,"id":140167,"user_name":"滇西之王","can_delete":false,"product_type":"c1","uid":1148142,"ip_address":"","ucode":"B1EBFFAE3AECEF","user_header":"https://static001.geekbang.org/account/avatar/00/11/84/ee/3a364ccd.jpg","comment_is_top":false,"comment_ctime":1570843647,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"259268881407","product_id":100033601,"comment_content":"在tcp层 Tls层以上的数据都是tcp层的数据，tcp层对每个数据包都有编号，分为1，2，3 .... tcp保证双向稳定可靠的传输，如果2包数据丢失，1号包和3号包来了，那么在超时重传时间还没有收到2编号数据包，服务端会发送2号数据包，客服端收到之后，发出确认，服务端才会继续发送其他数据，客服端数据才会呈现给上层应用层，这样tcp层的阻塞就发生了","like_count":61,"discussions":[{"author":{"id":2144931,"avatar":"https://static001.geekbang.org/account/avatar/00/20/ba/a3/0885ef2b.jpg","nickname":"wave","note":"","ucode":"04CA9E7E9B20DB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":371895,"discussion_content":"高速重发控制了解一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620045887,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":240002,"user_name":"Geek_1e6198","can_delete":false,"product_type":"c1","uid":1996106,"ip_address":"","ucode":"785EBE404903DD","user_header":"","comment_is_top":false,"comment_ctime":1596709653,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"126150761237","product_id":100033601,"comment_content":"刚出去面试就被问到了,而且很多都是老师这个专栏下的问题 让我怀疑是不是面试官刚看过这个","like_count":28,"discussions":[{"author":{"id":1160050,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b3/72/8c6366aa.jpg","nickname":"烈鸟","note":"","ucode":"F568728E862D50","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540766,"discussion_content":"不要怀疑，我也这么干的","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1640156384,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1820312,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/c6/98/bdfca744.jpg","nickname":"罗思雨","note":"","ucode":"40C9B63E932B82","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579862,"discussion_content":"不要怀疑，在初面我就是这么干的。。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657723572,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1100751,"avatar":"https://static001.geekbang.org/account/avatar/00/10/cb/cf/417a5ec2.jpg","nickname":"黑豹","note":"","ucode":"B9F94D0AFA89DC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":392695,"discussion_content":"不要怀疑，我就是这么干的。。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631096104,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":142171,"user_name":"moss","can_delete":false,"product_type":"c1","uid":1485532,"ip_address":"","ucode":"8CAFA44546CCCF","user_header":"","comment_is_top":false,"comment_ctime":1571303504,"is_pvip":false,"replies":[{"id":"54883","content":"http&#47;2是没必要用雪碧图了","user_name":"作者回复","user_name_real":"李兵","uid":"1141464","ctime":1571358162,"ip_address":"","comment_id":142171,"utype":1}],"discussion_count":6,"race_medal":0,"score":"61700845648","product_id":100033601,"comment_content":"老师好，采用了HTTP&#47;2之后，雪碧图是不是彻底不需要了呢？而且多张图片变成雪碧图后，多张图片大小加和都没有一张雪碧图大，那是不是雪碧图反而让传输更慢了呢？","like_count":15,"discussions":[{"author":{"id":1141464,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6a/d8/228449c9.jpg","nickname":"李兵","note":"","ucode":"3F3D3F6E20209E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471017,"discussion_content":"http/2是没必要用雪碧图了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571358162,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2668150,"avatar":"https://static001.geekbang.org/account/avatar/00/28/b6/76/4f1dc23a.jpg","nickname":"﻿哆","note":"","ucode":"622C7D62E500D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393577,"discussion_content":"有的，图片拼在一起和分开体积差很多的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631501603,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1040310,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEJsAzWfG8S3R53U8b2MJtLm5RxVnOjaUoLplicXp2KK7OicOf0GMV8MqPW7AfcqWzicZgficZ14Elcumw/132","nickname":"fakefish","note":"","ucode":"C82B549F1837DB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385535,"discussion_content":"雪碧图弊端太多了在http1非必要也浪费","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627115901,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1485532,"avatar":"","nickname":"moss","note":"","ucode":"8CAFA44546CCCF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":36342,"discussion_content":"那是不是也不需要将小图片转化为base64了呢？只要在同一服务器，就是并行请求请求，而base64反而增加了解析过程。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571365263,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1374181,"avatar":"https://static001.geekbang.org/account/avatar/00/14/f7/e5/ec543f3b.jpg","nickname":"张宗伟","note":"","ucode":"1447A20C7A8982","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1485532,"avatar":"","nickname":"moss","note":"","ucode":"8CAFA44546CCCF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377794,"discussion_content":"base64的资源更小吧。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622861608,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":36342,"ip_address":""},"score":377794,"extra":""},{"author":{"id":2644996,"avatar":"","nickname":"Geek_2a1e86","note":"","ucode":"8573861C0EF092","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1374181,"avatar":"https://static001.geekbang.org/account/avatar/00/14/f7/e5/ec543f3b.jpg","nickname":"张宗伟","note":"","ucode":"1447A20C7A8982","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377817,"discussion_content":"base64体积更大，差不多大1/3","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1622885343,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":377794,"ip_address":""},"score":377817,"extra":""}]}]},{"had_liked":false,"id":140170,"user_name":"成楠Peter","can_delete":false,"product_type":"c1","uid":1252977,"ip_address":"","ucode":"4D13E7368D8CF2","user_header":"https://static001.geekbang.org/account/avatar/00/13/1e/71/9dcbe6c4.jpg","comment_is_top":false,"comment_ctime":1570844127,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"44520517087","product_id":100033601,"comment_content":"TCP的队头阻塞，TCP传输过程中也是把一份数据分为多个数据包的。当其中一个数据包没有按照顺序返回，接收端会一直保持连接等待数据包返回，这时候就会阻塞后续请求。","like_count":11,"discussions":[{"author":{"id":1067697,"avatar":"https://static001.geekbang.org/account/avatar/00/10/4a/b1/e2b9e94f.jpg","nickname":"六个周","note":"","ucode":"7FFED12CC3346F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":562076,"discussion_content":"没毛病","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649771228,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":223345,"user_name":"焦糖大瓜子","can_delete":false,"product_type":"c1","uid":1378319,"ip_address":"","ucode":"03E6DA621DFD5F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJxhkqxtWKQeYrYlVYphlicHXW5KmHAvibx6hmice4NTvmn60ZEfTpLp3480umVEquqPdMfwOnecj6Aw/132","comment_is_top":false,"comment_ctime":1591067687,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"40245773351","product_id":100033601,"comment_content":"HTTP&#47;2请求是如何设置请求的优先级？","like_count":10,"discussions":[{"author":{"id":1094885,"avatar":"https://static001.geekbang.org/account/avatar/00/10/b4/e5/3a09ab5f.jpg","nickname":"Quintus Peng","note":"","ucode":"541983C95D27F8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572786,"discussion_content":"https://juejin.cn/post/6844903745218674695","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652953949,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1067697,"avatar":"https://static001.geekbang.org/account/avatar/00/10/4a/b1/e2b9e94f.jpg","nickname":"六个周","note":"","ucode":"7FFED12CC3346F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":562074,"discussion_content":"这个是浏览器做的吧，开发层面应该不需要关注吧？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649771171,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1167767,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d1/97/3abdd9cd.jpg","nickname":"stanny","note":"","ucode":"DD2BB91548A881","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":370600,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619483476,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1266698,"avatar":"https://static001.geekbang.org/account/avatar/00/13/54/0a/9a002ad5.jpg","nickname":"Adam Lau","note":"","ucode":"7E542D6E789500","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":359180,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616129505,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":144426,"user_name":"小智","can_delete":false,"product_type":"c1","uid":1046777,"ip_address":"","ucode":"C7940D9880CD06","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eo3yW0arVaSoQiccftUPYo0LZqRHicMEbqjoBVkEVNw405S7OL5dlFDqVibdyudpPaVQkbxwcywJ1bNg/132","comment_is_top":false,"comment_ctime":1571919818,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"31636690890","product_id":100033601,"comment_content":"浏览器是如何判断选择http1，http1.1，http2的。对应的部署是不是也要有回退机制，比如检测到浏览器不支持http2，就返回http1的模式？","like_count":7,"discussions":[{"author":{"id":1299829,"avatar":"https://static001.geekbang.org/account/avatar/00/13/d5/75/d93f9648.jpg","nickname":"🍪","note":"","ucode":"2B6D01EA82DE97","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":47596,"discussion_content":"会根据服务器是否支持决定。有个 101 switch protocol 状态码","likes_number":9,"is_delete":false,"is_hidden":false,"ctime":1573375874,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1067697,"avatar":"https://static001.geekbang.org/account/avatar/00/10/4a/b1/e2b9e94f.jpg","nickname":"六个周","note":"","ucode":"7FFED12CC3346F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":562078,"discussion_content":"我看现在百度、小米、京东还是用的http1.1的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649771403,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":140335,"user_name":"安思科","can_delete":false,"product_type":"c1","uid":1446237,"ip_address":"","ucode":"15FBE79CEDA0FD","user_header":"https://static001.geekbang.org/account/avatar/00/16/11/5d/0d955f19.jpg","comment_is_top":false,"comment_ctime":1570881803,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18750750987","product_id":100033601,"comment_content":"前几天，http3已经在chrome和curl试用，使用UDP试图解决对头阻塞问题。","like_count":4},{"had_liked":false,"id":140180,"user_name":"Chao","can_delete":false,"product_type":"c1","uid":1108745,"ip_address":"","ucode":"DD7742F5537521","user_header":"https://static001.geekbang.org/account/avatar/00/10/eb/09/ba5f0135.jpg","comment_is_top":false,"comment_ctime":1570844793,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"18750713977","product_id":100033601,"comment_content":"由于多路复用，反而产生队头阻塞时， 影响比http1.1更为巨大。 <br>在目前TCP下解决这个问题还是很困难的","like_count":4,"discussions":[{"author":{"id":2913864,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/MYShyjtRtib2GIQiaK4hV3ZP9pQ1qiaS74DA4K4YHY4SIiaFDfsCKgiaMWwm9zFsSn3bt5pawp5Kdn5MWgiaw5909nug/132","nickname":"Geek_aa1c31","note":"","ucode":"1AC14C053638AF","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577856,"discussion_content":"TCP的对头阻塞文通并不是多路复用产生的，而是TCP协议特性；http2解决的是http层面的对头阻塞","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656393011,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":171211,"user_name":"CMS","can_delete":false,"product_type":"c1","uid":1588451,"ip_address":"","ucode":"30FAC843F9D153","user_header":"https://static001.geekbang.org/account/avatar/00/18/3c/e3/aee9692f.jpg","comment_is_top":false,"comment_ctime":1578882199,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"14463784087","product_id":100033601,"comment_content":"能不能再详细讲一下：使用 CDN 的实现域名分片机制。","like_count":3,"discussions":[{"author":{"id":2012017,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/WKgD4vjLMhG5Tb0wFrYQ3prJpMSQgb1iabUNyPEk6cHDVWgHJCOicLVx38Ax3xqB2BrzpIpvlrPMCWjgNL6icXicPg/132","nickname":"过客","note":"","ucode":"335CF35D9E5CC6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":415154,"discussion_content":"一个域名只能建立6个tcp链接，那为了多建立tcp链接，就把资源放到n个不同域名CDN上，请求时就可以有 n*6 个tcp链接了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636992581,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1243584,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f9/c0/20b4a205.jpg","nickname":"啊哈哈","note":"","ucode":"A8542946C03707","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336255,"discussion_content":"静态资源部署在多个站点上，每个站点对应一个域名","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608540898,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1296602,"avatar":"https://static001.geekbang.org/account/avatar/00/13/c8/da/f4704fb9.jpg","nickname":"甜甜","note":"","ucode":"D6E8B7D9E35C55","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":289287,"discussion_content":"其实就是一个网站使用了多个域名，如果一个网站是一个域名，里面的静态图片是一个域名，每个域名可以建立它自己的TCP链接","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594046839,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":165919,"user_name":"LEON","can_delete":false,"product_type":"c1","uid":1109922,"ip_address":"","ucode":"58F7AF5302FCAD","user_header":"https://static001.geekbang.org/account/avatar/00/10/ef/a2/6ea5bb9e.jpg","comment_is_top":false,"comment_ctime":1577345204,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"14462247092","product_id":100033601,"comment_content":"老师http2 是不是必须要使用https? 如果不用https可以吗？","like_count":3,"discussions":[{"author":{"id":1910075,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/25/3b/a971fc8e.jpg","nickname":"阿感","note":"","ucode":"7BCB7E44A832D1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":279060,"discussion_content":"看图tls可选","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1591279421,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":327898,"user_name":"hao-kuai","can_delete":false,"product_type":"c1","uid":1272354,"ip_address":"","ucode":"DFDFDDDBA4503C","user_header":"https://static001.geekbang.org/account/avatar/00/13/6a/22/527904b2.jpg","comment_is_top":false,"comment_ctime":1640347447,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"10230282039","product_id":100033601,"comment_content":"1. HTTP 0.9 到 HTTP 1.0 是功能增强<br>2. HTTP 1.0 到 HTTP 1.1 是性能优化<br>3. HTTP 1.1 到 HTTP 2.1 是性能优化及顺带功能增强<br>4. 再次遇到可暂停可恢复增量任务调度，相信以后还会遇到：V8的垃圾回收老生代区域算法、HTTP&#47;2多路复用技术、React的Fiber调度算法","like_count":3},{"had_liked":false,"id":341682,"user_name":"六个周","can_delete":false,"product_type":"c1","uid":1067697,"ip_address":"","ucode":"7FFED12CC3346F","user_header":"https://static001.geekbang.org/account/avatar/00/10/4a/b1/e2b9e94f.jpg","comment_is_top":false,"comment_ctime":1649766821,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5944734117","product_id":100033601,"comment_content":"Chrome有个机制，同一个域名同时最多只能建立6个TCP连接，若此刻同时有10个请求发生。则4个会进入TCP队列进行排队。 <br>然后在HTTP&#47;1.1中增加了持久性连接方法，一个TCP上可以传输多个HTTP请求。<br><br>结合这两句话，有点懵逼了，一个TCP上可以传输多个HTTP请求这句话该怎么理解呢？<br>意思是不是说，在访问一个网站的时候，浏览器提供了6个TCP管道，然后你这个网站同时有十个请求发生，那么六个进入了这个TCP管道，还有四个在排队，当六个中有一个结束之后，然后四个排队中的出来一个，然后又用这个管道，但是这个时候，这个管道就不用在此建立TCP连接了，也就是说一个TCP上可以传输多个HTTP请求，是这个意思吗？求老师，大神们指点啊，在这里的理解上有点出不来了。","like_count":0},{"had_liked":false,"id":181834,"user_name":"追风筝的人","can_delete":false,"product_type":"c1","uid":1488020,"ip_address":"","ucode":"2993D60F94C396","user_header":"https://static001.geekbang.org/account/avatar/00/16/b4/94/2796de72.jpg","comment_is_top":false,"comment_ctime":1582641236,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5877608532","product_id":100033601,"comment_content":"Http2 优点  多路复用  ，二进制流传输数据，  Hpack算法头部字段压缩，服务器主动推送，请求优先级的设置，部分解决了队头阻塞，原因是基于TCP协议传输，Http3 基于QUIC协议下的UDP协议，解决了队头阻塞。","like_count":1},{"had_liked":false,"id":172025,"user_name":"晓东","can_delete":false,"product_type":"c1","uid":1156331,"ip_address":"","ucode":"E86A18B72C6810","user_header":"https://static001.geekbang.org/account/avatar/00/11/a4/eb/c092f833.jpg","comment_is_top":false,"comment_ctime":1579073252,"is_pvip":true,"discussion_count":4,"race_medal":0,"score":"5874040548","product_id":100033601,"comment_content":"同一个域名用一个tcp解决了慢启动的问题，并且tcp带宽的竞争也少了6倍。但是本来可以6个tcp同时下载同一个域名的资源，现在只能用一个tcp了，我这个理解对么？","like_count":1,"discussions":[{"author":{"id":1325589,"avatar":"https://static001.geekbang.org/account/avatar/00/14/3a/15/63f8ca96.jpg","nickname":"林阳","note":"","ucode":"DBE1930EB2B636","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374326,"discussion_content":"我理解是这样的，HTTP2 可以不用排队","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621137713,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1374620,"avatar":"https://static001.geekbang.org/account/avatar/00/14/f9/9c/7c959e68.jpg","nickname":"Albert","note":"","ucode":"AC04CD1BF1F8E5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306195,"discussion_content":"也有同样的疑问，哪位大神解答一下呀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600217898,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1480732,"avatar":"https://static001.geekbang.org/account/avatar/00/16/98/1c/d7a1439e.jpg","nickname":"KaKaKa","note":"","ucode":"07D1980A71F321","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":240049,"discussion_content":"HTTP2 不止6个了，加入了多路复用的机制之后，相当于无限制","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587315913,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1296602,"avatar":"https://static001.geekbang.org/account/avatar/00/13/c8/da/f4704fb9.jpg","nickname":"甜甜","note":"","ucode":"D6E8B7D9E35C55","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1480732,"avatar":"https://static001.geekbang.org/account/avatar/00/16/98/1c/d7a1439e.jpg","nickname":"KaKaKa","note":"","ucode":"07D1980A71F321","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":289289,"discussion_content":"个人理解是，TCP是只有一个，请求的资源可以有无限个，不知道对不对？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1594046914,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":240049,"ip_address":""},"score":289289,"extra":""}]}]},{"had_liked":false,"id":162233,"user_name":"-_-|||","can_delete":false,"product_type":"c1","uid":1328142,"ip_address":"","ucode":"94B21594658BF9","user_header":"https://static001.geekbang.org/account/avatar/00/14/44/0e/ce14b7d3.jpg","comment_is_top":false,"comment_ctime":1576481560,"is_pvip":false,"replies":[{"id":"61748","content":"是的","user_name":"作者回复","user_name_real":"李兵","uid":"1141464","ctime":1576494644,"ip_address":"","comment_id":162233,"utype":1}],"discussion_count":1,"race_medal":1,"score":"5871448856","product_id":100033601,"comment_content":"HTTP&#47;2 下浏览器获取的所有请求数据都会经过 &quot;二进制分帧层&quot; 吗?","like_count":1,"discussions":[{"author":{"id":1141464,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6a/d8/228449c9.jpg","nickname":"李兵","note":"","ucode":"3F3D3F6E20209E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477984,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576494644,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":331444,"user_name":"痴人指路","can_delete":false,"product_type":"c1","uid":2858088,"ip_address":"","ucode":"302C8ACA410F38","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqLlZ7ibJqRocm0EM4YF8iaJJFeicGI9U0gh5ZLeWTjXeicOFlT4tjKtIz8SpGqBPXAspLMbWD5GnrdhQ/132","comment_is_top":false,"comment_ctime":1642587054,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1642587054","product_id":100033601,"comment_content":"http2中，浏览器短时间内发送多个请求是 一起被二进制分帧层处理吗？还是一个个的被处理发送？然后服务器收到诸多请求后再返回？这里我理解的不是很明白。<br>看老师文中内容，感觉是多个请求会一起被分帧层处理然后都发送到服务器，服务器收到了分帧层发过来的全部内容，再组合拆分成不同请求","like_count":0},{"had_liked":false,"id":330820,"user_name":"唯唯喏","can_delete":false,"product_type":"c1","uid":2364198,"ip_address":"","ucode":"F391E128E421AF","user_header":"https://static001.geekbang.org/account/avatar/00/24/13/26/8dfc7011.jpg","comment_is_top":false,"comment_ctime":1642177322,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1642177322","product_id":100033601,"comment_content":"如果只有一个TCP连接，它会占满带宽，滑动窗口最大化，但是包本身有序，tcp层面也会出现队头阻塞，是这样吧。","like_count":0},{"had_liked":false,"id":310203,"user_name":"Du小强🍪","can_delete":false,"product_type":"c1","uid":1379035,"ip_address":"","ucode":"2483051378BC62","user_header":"https://static001.geekbang.org/account/avatar/00/15/0a/db/84f40545.jpg","comment_is_top":false,"comment_ctime":1630547832,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630547832","product_id":100033601,"comment_content":"我不理解这里所说的并行发送是可以同时发送还是可以不用等待发送，但发送时还是以顺序发送","like_count":0},{"had_liked":false,"id":281937,"user_name":"Alan He","can_delete":false,"product_type":"c1","uid":2033513,"ip_address":"","ucode":"A0780F4619D388","user_header":"https://static001.geekbang.org/account/avatar/00/1f/07/69/43cf2251.jpg","comment_is_top":false,"comment_ctime":1614957185,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1614957185","product_id":100033601,"comment_content":"HTTP2的多路复用解决了同一个TCP连接下可以并发请求，浏览器本身单域名的TCP连接数是有限制的，比如6个，那么每一个TCP连接又可以并发多个请求，这个并发的请求数量有限制吗？","like_count":0},{"had_liked":false,"id":273846,"user_name":"lerman","can_delete":false,"product_type":"c1","uid":1582839,"ip_address":"","ucode":"6D7A0A48CDE78C","user_header":"https://static001.geekbang.org/account/avatar/00/18/26/f7/03134808.jpg","comment_is_top":false,"comment_ctime":1610695571,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1610695571","product_id":100033601,"comment_content":"请教一下，如果用了两个web server，前一个web server做负载均衡，支持HTTP&#47;2，后一个web server是实际执行任务的服务器，支持HTTP&#47;1.1，这种情况下，请求在客户端和服务器端是使用什么协议呢？谢谢！","like_count":0},{"had_liked":false,"id":261051,"user_name":"君自兰芳","can_delete":false,"product_type":"c1","uid":2029706,"ip_address":"","ucode":"780F3AFEEB9B73","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f8/8a/f7e7fd54.jpg","comment_is_top":false,"comment_ctime":1605183337,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"1605183337","product_id":100033601,"comment_content":"“HTTP&#47;2 提供了请求优先级，可以在发送请求时，标上该请求的优先级”<br><br>有个疑问，具体是怎么操作的，在请求头里面加上什么字段吗😂","like_count":0,"discussions":[{"author":{"id":2033513,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/07/69/43cf2251.jpg","nickname":"Alan He","note":"","ucode":"A0780F4619D388","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":354371,"discussion_content":"我的理解：优先级是浏览器根据资源类型确定的，对于开发来说相当于透明的。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1615282274,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1167767,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d1/97/3abdd9cd.jpg","nickname":"stanny","note":"","ucode":"DD2BB91548A881","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2033513,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/07/69/43cf2251.jpg","nickname":"Alan He","note":"","ucode":"A0780F4619D388","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":370606,"discussion_content":"没错 我刚也查了下，优先级大致是 HTML > CSS > Blocking Script > Font >= Image >= Async Script","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1619484753,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":354371,"ip_address":""},"score":370606,"extra":""}]},{"author":{"id":2861584,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/ztfX2Sjr6Hk3Rtzxhhoib7rKVoSbl53IicJ0awelZdiaIa1A8t7EMbic9ibVY1W72szgNKdYial6JsE2GKChn0Wzt2zg/132","nickname":"阳宝","note":"","ucode":"740CEA04E6897E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557983,"discussion_content":"解决了我的疑问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648035801,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":250076,"user_name":"小朋友","can_delete":false,"product_type":"c1","uid":2071829,"ip_address":"","ucode":"3961A18B76774D","user_header":"https://static001.geekbang.org/account/avatar/00/1f/9d/15/dd819dd4.jpg","comment_is_top":false,"comment_ctime":1600926497,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1600926497","product_id":100033601,"comment_content":"https:&#47;&#47;developers.google.com&#47;web&#47;fundamentals&#47;performance&#47;http2","like_count":0},{"had_liked":false,"id":245691,"user_name":"kevinInsight","can_delete":false,"product_type":"c1","uid":1077414,"ip_address":"","ucode":"614B78965C5E10","user_header":"https://wx.qlogo.cn/mmopen/vi_32/6bCYR5TvPPNxBic9xBicXuyiaF0waeE71TTLRH0lM8OPnR0ibo40JlMplfmsuPuJevfxgbhDhFUqqp469lM3lGRqmg/0","comment_is_top":false,"comment_ctime":1599027892,"is_pvip":true,"discussion_count":2,"race_medal":0,"score":"1599027892","product_id":100033601,"comment_content":"这些数据经过二进制分帧层处理之后，会被转换为一个个带有请求 ID 编号的帧，通过协议栈将这些帧发送给服务器。服务器接收到所有帧之后，会将所有相同 ID 的帧合并为一条完整的请求信息<br><br>----<br><br>老师，这里不太明白；什么情况下帧的ID会相同？二进制分针层按照什么原则把请求数据分配成同一个帧ID？","like_count":0,"discussions":[{"author":{"id":1097905,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c0/b1/ca4e41c5.jpg","nickname":"PETRVS","note":"","ucode":"8A34119A5DBF6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391519,"discussion_content":"同一个请求信息 = 唯一id = 多帧","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1630494103,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1313840,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0c/30/bb4bfe9d.jpg","nickname":"lyonger","note":"","ucode":"E89A75DADEA2A1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332175,"discussion_content":"是啊，同问。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607084528,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":228822,"user_name":"LIKE","can_delete":false,"product_type":"c1","uid":1254252,"ip_address":"","ucode":"9DAB7F9051648A","user_header":"https://static001.geekbang.org/account/avatar/00/13/23/6c/82ba5e1f.jpg","comment_is_top":false,"comment_ctime":1592817874,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592817874","product_id":100033601,"comment_content":"&quot;除了设置请求的优先级外，HTTP&#47;2 还可以直接将数据提前推送到浏览器&quot;<br>关于服务器推送，相比之前版本是HTTP&#47;2支持接收服务器主动推送数据？","like_count":0},{"had_liked":false,"id":223455,"user_name":"Zkerhcy","can_delete":false,"product_type":"c1","uid":1231133,"ip_address":"","ucode":"43A883F6FB6070","user_header":"https://static001.geekbang.org/account/avatar/00/12/c9/1d/c7586cfc.jpg","comment_is_top":false,"comment_ctime":1591093525,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1591093525","product_id":100033601,"comment_content":"李兵老师，遇到一个问题想请教下，在我们的页面中，有多个并发的 Ajax 请求（&gt;10个），请求都是在HTTP&#47;2下发送的，且 Connection ID 相同，但仍然出现了类似queueing的现象，前10个请求的时间（TTFB）基本是后面请求的一半，请问这是服务端的问题还是浏览器端的问题，让服务端同事排查，说对单个TCP 的并发请求限制是远远超过10的。","like_count":0,"discussions":[{"author":{"id":1296602,"avatar":"https://static001.geekbang.org/account/avatar/00/13/c8/da/f4704fb9.jpg","nickname":"甜甜","note":"","ucode":"D6E8B7D9E35C55","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":289293,"discussion_content":"你们的项目都用http/2了吗，哪些资源用http/2，哪些资源还是用http1.1，方便说下吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594047206,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":213939,"user_name":"蹦哒","can_delete":false,"product_type":"c1","uid":1458931,"ip_address":"","ucode":"56591A657DE7C7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epcs6PibsP9vEXv4EibUw3bhQPUK04zRTOvfrvF08TwM67xPb1LBh2uRENHQwo2VqYfC5GhJmM7icxHA/132","comment_is_top":false,"comment_ctime":1588593887,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1588593887","product_id":100033601,"comment_content":"请教老师：<br>HTTP1.1为啥不能实现请求的优先级呢？虽然HTTP1.1没有二进制分帧层，但是请求不同资源一般也是不同的请求，这样也能通过设置优先级让服务端区别对待不同优先级的任务吧","like_count":0,"discussions":[{"author":{"id":1224983,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b1/17/9d8442e7.jpg","nickname":"Virgo","note":"","ucode":"A8C6F4E869F55C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383731,"discussion_content":"个人理解：\n1.在同一个TCP连接中设置优先级，没有意义，因为是按顺序发收的\n2.在不同TCP连接中设置，优先级顺序势必要加在请求头中，这样影响了性能，得不偿失吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626226326,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":194194,"user_name":"早道","can_delete":false,"product_type":"c1","uid":1476089,"ip_address":"","ucode":"A67B52576E1678","user_header":"https://static001.geekbang.org/account/avatar/00/16/85/f9/db651fa6.jpg","comment_is_top":false,"comment_ctime":1585035889,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585035889","product_id":100033601,"comment_content":"您好，您讲到一个【可以设置请求的优先级】的特性，请求优先级可以客户端自己定义，还是使用大盘浏览器或者服务器某种策略定义请求权重呢","like_count":0},{"had_liked":false,"id":177938,"user_name":"云中歌","can_delete":false,"product_type":"c1","uid":1806446,"ip_address":"","ucode":"F2F0AED74159D2","user_header":"https://static001.geekbang.org/account/avatar/00/1b/90/6e/d729672d.jpg","comment_is_top":false,"comment_ctime":1581555629,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1581555629","product_id":100033601,"comment_content":"老师有个问题想问一下，多路复用是用的一个tcp，那多路复用是用的一个tls吗","like_count":0,"discussions":[{"author":{"id":1296602,"avatar":"https://static001.geekbang.org/account/avatar/00/13/c8/da/f4704fb9.jpg","nickname":"甜甜","note":"","ucode":"D6E8B7D9E35C55","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":289290,"discussion_content":"同学你好，什么是tls，跟tcp有什么区别，你知道吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594047000,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":167358,"user_name":"爱胖胖的懒蛋蛋","can_delete":false,"product_type":"c1","uid":1781880,"ip_address":"","ucode":"1AA7A7A6086698","user_header":"https://static001.geekbang.org/account/avatar/00/1b/30/78/bf216994.jpg","comment_is_top":false,"comment_ctime":1577774859,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1577774859","product_id":100033601,"comment_content":"老师，HTTP&#47;2的服务器推送特性这里，您说“那么在接收到 HTML 请求之后，附带将要使用的 CSS 文件和 JavaScript 文件一并发送给浏览器”，假设这个HTML文件有一个js关键资源和一个css资源，那么这句话是说一个请求有3个响应吗？(1个html+1个js+1个css)，那如果html解析到&lt;script src=&quot;*****&quot;&gt;的时候还会去想浏览器发送这条资源的请求吗？如果不发送的话，那它是怎么告诉浏览器这条请求已经返回过了呢？","like_count":0,"discussions":[{"author":{"id":1296602,"avatar":"https://static001.geekbang.org/account/avatar/00/13/c8/da/f4704fb9.jpg","nickname":"甜甜","note":"","ucode":"D6E8B7D9E35C55","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":289285,"discussion_content":"每请求一个资源，浏览器都会走缓存流程吧，如果发现浏览器本地已经有了（服务器推送过来的），就不需要发送了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594046763,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":167327,"user_name":"爱胖胖的懒蛋蛋","can_delete":false,"product_type":"c1","uid":1781880,"ip_address":"","ucode":"1AA7A7A6086698","user_header":"https://static001.geekbang.org/account/avatar/00/1b/30/78/bf216994.jpg","comment_is_top":false,"comment_ctime":1577765218,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577765218","product_id":100033601,"comment_content":"老师您好，“HTTP&#47;2多路复用“这个图是画错了吧，stream2请求头里请求的是foo.css，返回数据怎么是bar.js呢？应该是foo.css吧～","like_count":0},{"had_liked":false,"id":163169,"user_name":"匡晨辉","can_delete":false,"product_type":"c1","uid":1763707,"ip_address":"","ucode":"BF88FE410C20F4","user_header":"https://static001.geekbang.org/account/avatar/00/1a/e9/7b/b844f3a4.jpg","comment_is_top":false,"comment_ctime":1576665401,"is_pvip":false,"replies":[{"id":"62398","content":"是不管http&#47;1我还是http&#47;2，最后都需要经过tcp包的形式进行传输！<br><br>而tcp包也是按照顺序的，一个阻塞了，会影响到其它数据包的接受！","user_name":"作者回复","user_name_real":"李兵","uid":"1141464","ctime":1576908978,"ip_address":"","comment_id":163169,"utype":1}],"discussion_count":4,"race_medal":0,"score":"1576665401","product_id":100033601,"comment_content":"老师，还是没有理解http2怎么就能解决队头阻塞问题呢？http2 还是基于tcp连接的，经过二进制分帧层了以后不还是需要以数据包的形式通过tcp传输吗？tcp的数据包队头阻塞发生了不还是会影响后面的请求数据包的发送吗？","like_count":0,"discussions":[{"author":{"id":1023016,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/9c/28/87421d8f.jpg","nickname":"Happy-Coming","note":"","ucode":"4F7EA88432EDCD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":90788,"discussion_content":"第一：Http2解决的是Http1.1的队头阻塞问题的（一个request发出后，直到有了response后，才能发出下一个request），HTTP2发完一个request就可以马上发第二个request，而且第二个的response就有可能先回来。\n\n第二：没有解决TCP队头阻塞的问题（也解决不了，因为TCP在下层）。","likes_number":12,"is_delete":false,"is_hidden":false,"ctime":1576780566,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1882651,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epherEfVrWjezuIs2Xd600ibo5wKvtGp3SZKlDAqDOp255VfzmY4iaDBCAtLKqqhZ4GGic06m4MKqNCA/132","nickname":"冷月心","note":"","ucode":"D7FBEABDC65FEA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":287595,"discussion_content":"所以http2只是缓解不是最终解决，http3换了udp,此时是解决了，udp顺序发但是无序收，不管那么多","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1593487858,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1141464,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6a/d8/228449c9.jpg","nickname":"李兵","note":"","ucode":"3F3D3F6E20209E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478277,"discussion_content":"是不管http/1我还是http/2，最后都需要经过tcp包的形式进行传输！\n\n而tcp包也是按照顺序的，一个阻塞了，会影响到其它数据包的接受！","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1576908978,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2304035,"avatar":"https://static001.geekbang.org/account/avatar/00/23/28/23/641fdc04.jpg","nickname":"前端盼哥","note":"","ucode":"09FC1B7042C214","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382988,"discussion_content":"我理解http1.1是一个请求一个请求发跟一条单行道上跑的各种小汽车一样，一个出事故后边都堵车了，而http2多路复用机制他是通过二进制分帧层将多个请求组装类似于把一个个小汽车变成了地铁的不同车厢，这样这条单行道上就只有一个车在跑事故率小，一路直达","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625816536,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":162232,"user_name":"-_-|||","can_delete":false,"product_type":"c1","uid":1328142,"ip_address":"","ucode":"94B21594658BF9","user_header":"https://static001.geekbang.org/account/avatar/00/14/44/0e/ce14b7d3.jpg","comment_is_top":false,"comment_ctime":1576481205,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1576481205","product_id":100033601,"comment_content":"可能是由于数据包是有顺序的，只有多个数据包排满，滑动窗口才会组装下一批数据包，组装好才能发送。这样TCP 协议依然存在队头阻塞问题。","like_count":0},{"had_liked":false,"id":161925,"user_name":"coder","can_delete":false,"product_type":"c1","uid":1059952,"ip_address":"","ucode":"F70511D614B9F4","user_header":"https://static001.geekbang.org/account/avatar/00/10/2c/70/02b627a6.jpg","comment_is_top":false,"comment_ctime":1576405120,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1576405120","product_id":100033601,"comment_content":"“如果使用单个 TCP 的持久连接，下载 100 个资源所花费的时间为 100 * n * RTT”这个没太懂，为什么时间是100 * n * RTT，其中这个n又代表了什么？","like_count":0,"discussions":[{"author":{"id":1782777,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/33/f9/50b76abe.jpg","nickname":"AMIR","note":"","ucode":"65142D9669071B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":110875,"discussion_content":"一个资源需要多少个RTT来传输，比如一个资源要分5个数据包才能传输完，那么这个n就为5","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1577761719,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1435019,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e5/8b/7c1f2b19.jpg","nickname":"卡西","note":"","ucode":"3D48F58D7C8461","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":102760,"discussion_content":"数据包是有一定大小的,  在14KB左右, 超过这个大小会分成多个数据包, 会增加数据传输的往返时延","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1577363419,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":159625,"user_name":"屈悦微","can_delete":false,"product_type":"c1","uid":1466274,"ip_address":"","ucode":"1A21649CA29325","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqVpvvnZ5icr0YdOCdxlhz5xUf1YqNzyjfYJS0ibRibmON4Via0GTV7e2ZBiaEoOxXCDVB0SNTeWCibI6og/132","comment_is_top":false,"comment_ctime":1575708290,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1575708290","product_id":100033601,"comment_content":"这篇文章解决了我的很多疑问，但是文中有一点我还是不太理解，望作者百忙之中来解疑<br>文中说http2中传输有优先级之分<br>那么做为前端开发者能不能控制某个文件(如js)的优先级<br>1.如果能，怎么控制？<br>2.如果不能，优先级是由浏览器自动控制的么？","like_count":0,"discussions":[{"author":{"id":1023016,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/9c/28/87421d8f.jpg","nickname":"Happy-Coming","note":"","ucode":"4F7EA88432EDCD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":90789,"discussion_content":"1.1 解决1.0而引入了connect：keep-alive，而浏览器默认开启keep-alive, 程序员也可以指定。\n\n所以我猜2.0也会采用这个样的方式\n\n可以查一下http2.0的协议","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576780835,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":159190,"user_name":"玉皇大亮","can_delete":false,"product_type":"c1","uid":1019849,"ip_address":"","ucode":"5C4FDF1FDCF8A9","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8f/c9/833d5060.jpg","comment_is_top":false,"comment_ctime":1575556150,"is_pvip":false,"replies":[{"id":"60879","content":"这六个TCP连接的请求过程是并行的，这里所提到的对头阻塞是指发生在每个单独的tcp连接中，因为一个tcp连接可以用来处理多个http请求。<br><br>","user_name":"作者回复","user_name_real":"李兵","uid":"1141464","ctime":1575557783,"ip_address":"","comment_id":159190,"utype":1}],"discussion_count":5,"race_medal":0,"score":"1575556150","product_id":100033601,"comment_content":"有个疑问想请教老师，既然HTTP1.1为了并行下载资源为每个域名提供了6个TCP连接，那这6个TCP连接是并行传输数据的么？如果是为什么还会有队头阻塞的问题呢？这里没搞明白，或者其他同学明白的帮忙回答一下呗，感谢感谢","like_count":0,"discussions":[{"author":{"id":1141464,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6a/d8/228449c9.jpg","nickname":"李兵","note":"","ucode":"3F3D3F6E20209E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476975,"discussion_content":"这六个TCP连接的请求过程是并行的，这里所提到的对头阻塞是指发生在每个单独的tcp连接中，因为一个tcp连接可以用来处理多个http请求。\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575557783,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1782777,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/33/f9/50b76abe.jpg","nickname":"AMIR","note":"","ucode":"65142D9669071B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":110878,"discussion_content":"队头阻塞也分TCP数据包级别好http请求级别 ，当前TCP数据包阻塞了，那么之前返回来的数据也没有用，必须等到阻塞的这个返回了，tcp才能把整体数据按照序号组装起来，比如一个tcp请求了index.html，这个index.html太大了，分了5次传回来 1，2，3，4，5，如果2，3，4，5数据包都传回来了，而1没回来，那么tcp也不会把这个数据交到上层，还得等1回来了，然后2，3，4，5才能和1进行拼接，整整齐齐的传到上层，这是tcp数据包层面的阻塞","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1577762011,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1019849,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8f/c9/833d5060.jpg","nickname":"玉皇大亮","note":"","ucode":"5C4FDF1FDCF8A9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1782777,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/33/f9/50b76abe.jpg","nickname":"AMIR","note":"","ucode":"65142D9669071B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":114499,"discussion_content":"感谢解惑","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577973258,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":110878,"ip_address":""},"score":114499,"extra":""}]},{"author":{"id":1466274,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqVpvvnZ5icr0YdOCdxlhz5xUf1YqNzyjfYJS0ibRibmON4Via0GTV7e2ZBiaEoOxXCDVB0SNTeWCibI6og/132","nickname":"屈悦微","note":"","ucode":"1A21649CA29325","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":74942,"discussion_content":"楼主可能是对TCP协议不是太理解，每个域名提供6个TCP链接，这6个TCP链接是没有直接关系的，所以是并行传输数据的，而每个tcp链接可以连续发起请求和响应请求，因此队头阻塞也之后阻塞的是当前的tcp链接，和其他tcp链接没有关系! ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1575708931,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1019849,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8f/c9/833d5060.jpg","nickname":"玉皇大亮","note":"","ucode":"5C4FDF1FDCF8A9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1466274,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqVpvvnZ5icr0YdOCdxlhz5xUf1YqNzyjfYJS0ibRibmON4Via0GTV7e2ZBiaEoOxXCDVB0SNTeWCibI6og/132","nickname":"屈悦微","note":"","ucode":"1A21649CA29325","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":114501,"discussion_content":"感谢解惑","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577973266,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":74942,"ip_address":""},"score":114501,"extra":""}]}]},{"had_liked":false,"id":159103,"user_name":"vianem","can_delete":false,"product_type":"c1","uid":1748290,"ip_address":"","ucode":"59A2D19426ABC4","user_header":"","comment_is_top":false,"comment_ctime":1575538629,"is_pvip":false,"replies":[{"id":"60874","content":"我除了啊","user_name":"作者回复","user_name_real":"李兵","uid":"1141464","ctime":1575552210,"ip_address":"","comment_id":159103,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1575538629","product_id":100033601,"comment_content":"带宽那有点问题吧？一般我们说的100M带宽，是指100Mbps，转换成MBps得除以8","like_count":0,"discussions":[{"author":{"id":1141464,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6a/d8/228449c9.jpg","nickname":"李兵","note":"","ucode":"3F3D3F6E20209E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476949,"discussion_content":"我除了啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575552210,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":156843,"user_name":"Rocky","can_delete":false,"product_type":"c1","uid":1483150,"ip_address":"","ucode":"5FCF390BECDF9D","user_header":"https://static001.geekbang.org/account/avatar/00/16/a1/8e/03aeb9df.jpg","comment_is_top":false,"comment_ctime":1574987827,"is_pvip":false,"replies":[{"id":"60261","content":"http3中的quic协议也提供了udp的可靠传输","user_name":"作者回复","user_name_real":"李兵","uid":"1141464","ctime":1575019104,"ip_address":"","comment_id":156843,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1574987827","product_id":100033601,"comment_content":"tcp的队头阻塞虽然是缺点，但也从另一个方面保证了数据传输的可靠性，前一个没有完成或者出错，可以重传。改用udp后可能会丢帧，不可靠","like_count":0,"discussions":[{"author":{"id":1141464,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6a/d8/228449c9.jpg","nickname":"李兵","note":"","ucode":"3F3D3F6E20209E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476252,"discussion_content":"http3中的quic协议也提供了udp的可靠传输","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575019104,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":144236,"user_name":"splm","can_delete":false,"product_type":"c1","uid":1338601,"ip_address":"","ucode":"2216332252CEA7","user_header":"https://static001.geekbang.org/account/avatar/00/14/6c/e9/072b33b9.jpg","comment_is_top":false,"comment_ctime":1571881441,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1571881441","product_id":100033601,"comment_content":"关于1.1的不理解地方，1.1不足的是因为同时创建了多个连接，导致抢占资源，但不是说1.1是长连接，管线化的吗？前者延迟，后面的任务也会跟着延迟，是一个串行的策略，但这里的说法，感觉是个并行的策略的啊。希望老师能解答一下。","like_count":0,"discussions":[{"author":{"id":1782777,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/33/f9/50b76abe.jpg","nickname":"AMIR","note":"","ucode":"65142D9669071B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":110885,"discussion_content":"每个tcp上面的http请求是串行，因为http 1.1并不能标识返回的响应对应的是哪个http请求，所以不按照FIFO原则处理的话，就乱套了，为了避免乱套，只能接受到返回数据后再进行下一次的请求，虽然管线化可以同时发送多个http求情，但是服务区返回还是得按照顺序返回，原因还是上面的，不按照顺序返回，客户端不知道返回对应哪个，所以才有了http2 的二进制分层帧,有了标识，随便怎么发，怎么回，都能对的上","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1577762267,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1618071,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b0/97/4fa2657e.jpg","nickname":"流霜","note":"","ucode":"1156247D1EE02B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":52523,"discussion_content":"1.1的意思是同时维护了6个长连接，每个长连接是串行的，但是这六个长连接之间是会存在抢占资源的情况的，个人理解～","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1574061368,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":140731,"user_name":"淡","can_delete":false,"product_type":"c1","uid":1456392,"ip_address":"","ucode":"6856CA319DE2F0","user_header":"https://static001.geekbang.org/account/avatar/00/16/39/08/09055b47.jpg","comment_is_top":false,"comment_ctime":1571039374,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1571039374","product_id":100033601,"comment_content":"服务器推送最大的好处是消息推送在浏览器端高效实现有可能了吧","like_count":0,"discussions":[{"author":{"id":1296602,"avatar":"https://static001.geekbang.org/account/avatar/00/13/c8/da/f4704fb9.jpg","nickname":"甜甜","note":"","ucode":"D6E8B7D9E35C55","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":289277,"discussion_content":"老师说的服务器推送，是html需要用到js\\css，服务器提前推送，不用等到执行到 script\\link了 再下载。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594045416,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1231133,"avatar":"https://static001.geekbang.org/account/avatar/00/12/c9/1d/c7586cfc.jpg","nickname":"Zkerhcy","note":"","ucode":"43A883F6FB6070","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":78132,"discussion_content":"你说的这个推送是 websocket，和老师说的不是一个东西","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575979812,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":140199,"user_name":"蓝配鸡","can_delete":false,"product_type":"c1","uid":1348738,"ip_address":"","ucode":"C79A7CA8885B7C","user_header":"https://static001.geekbang.org/account/avatar/00/14/94/82/d0a417ba.jpg","comment_is_top":false,"comment_ctime":1570847775,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1570847775","product_id":100033601,"comment_content":"思考题我的愚见：<br>一个http请求会被TCP拆成多份传输，接收方需要重新拼接， 如果其中一份由于某些原因没到达， 那么TCP会等待那份数据包从而形成了阻塞。<br><br>对HTTP2的影响：<br>由于http2把一个http请求拆成了很多小份进行传输， 自然在TCP层拆分，组装排序的成本就低了，进而绕过了或者说降低了TCP队头阻塞这个问题。","like_count":0,"discussions":[{"author":{"id":1626734,"avatar":"","nickname":"Geek_f74777","note":"","ucode":"8B512972A145A7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":30918,"discussion_content":"有人做过测试，当持续丢包率2%时，HTTP/2的性能不如HTTP/1.1。还有接收的数据包乱序也会导致阻塞","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1570869774,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":140128,"user_name":"許敲敲","can_delete":false,"product_type":"c1","uid":1046681,"ip_address":"","ucode":"6486466820E7BF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/99/8e760987.jpg","comment_is_top":false,"comment_ctime":1570838173,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"1570838173","product_id":100033601,"comment_content":"老师你好，想问一下。HTTP2传输数据是一帧一帧的，然后再合并。那么这一帧一帧也会有顺序嘛？ 客户端合并的话，是怎么合并的呢？会不会乱序？ ","like_count":0,"discussions":[{"author":{"id":1483150,"avatar":"https://static001.geekbang.org/account/avatar/00/16/a1/8e/03aeb9df.jpg","nickname":"Rocky","note":"","ucode":"5FCF390BECDF9D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":65170,"discussion_content":"有对应的帧id","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574987714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1148142,"avatar":"https://static001.geekbang.org/account/avatar/00/11/84/ee/3a364ccd.jpg","nickname":"滇西之王","note":"","ucode":"B1EBFFAE3AECEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":30567,"discussion_content":"按照流编号来区分，每个帧有隶属于一个流的编号，在响应的时候，会知道流的大小，然后把隶属于相同流的编号合并","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570843155,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1046681,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f8/99/8e760987.jpg","nickname":"許敲敲","note":"","ucode":"6486466820E7BF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1148142,"avatar":"https://static001.geekbang.org/account/avatar/00/11/84/ee/3a364ccd.jpg","nickname":"滇西之王","note":"","ucode":"B1EBFFAE3AECEF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":30633,"discussion_content":"就是合并的时候，一个id 流会有不同的帧组成吧？ 那么这些帧有顺序的概念嘛？ 这些帧也有id嘛？还是说按照顺序接受帧 就可以。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1570847839,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":30567,"ip_address":""},"score":30633,"extra":""},{"author":{"id":1003156,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/4e/94/0b22b6a2.jpg","nickname":"Luke","note":"","ucode":"4060B4E2EF1D13","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1046681,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f8/99/8e760987.jpg","nickname":"許敲敲","note":"","ucode":"6486466820E7BF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":33170,"discussion_content":"这个应该是由TCP层协议来保证的，TCP会对http的报文进行分包和排序编号。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571105194,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":30633,"ip_address":""},"score":33170,"extra":""}]}]}]}