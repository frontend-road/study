{"id":80531,"title":"39 | è‡ªå¢ä¸»é”®ä¸ºä»€ä¹ˆä¸æ˜¯è¿ç»­çš„ï¼Ÿ","content":"<p>åœ¨<a href=\"https://time.geekbang.org/column/article/69236\">ç¬¬4ç¯‡æ–‡ç« </a>ä¸­ï¼Œæˆ‘ä»¬æåˆ°è¿‡è‡ªå¢ä¸»é”®ï¼Œç”±äºè‡ªå¢ä¸»é”®å¯ä»¥è®©ä¸»é”®ç´¢å¼•å°½é‡åœ°ä¿æŒé€’å¢é¡ºåºæ’å…¥ï¼Œé¿å…äº†é¡µåˆ†è£‚ï¼Œå› æ­¤ç´¢å¼•æ›´ç´§å‡‘ã€‚</p><p>ä¹‹å‰æˆ‘è§è¿‡æœ‰çš„ä¸šåŠ¡è®¾è®¡ä¾èµ–äºè‡ªå¢ä¸»é”®çš„è¿ç»­æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªè®¾è®¡å‡è®¾è‡ªå¢ä¸»é”®æ˜¯è¿ç»­çš„ã€‚ä½†å®é™…ä¸Šï¼Œè¿™æ ·çš„å‡è®¾æ˜¯é”™çš„ï¼Œå› ä¸ºè‡ªå¢ä¸»é”®ä¸èƒ½ä¿è¯è¿ç»­é€’å¢ã€‚</p><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°±æ¥è¯´è¯´è¿™ä¸ªé—®é¢˜ï¼Œçœ‹çœ‹ä»€ä¹ˆæƒ…å†µä¸‹è‡ªå¢ä¸»é”®ä¼šå‡ºç° â€œç©ºæ´â€ï¼Ÿ</p><p>ä¸ºäº†ä¾¿äºè¯´æ˜ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè¡¨tï¼Œå…¶ä¸­idæ˜¯è‡ªå¢ä¸»é”®å­—æ®µã€cæ˜¯å”¯ä¸€ç´¢å¼•ã€‚</p><pre><code>CREATE TABLE `t` (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `c` int(11) DEFAULT NULL,\n  `d` int(11) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `c` (`c`)\n) ENGINE=InnoDB;\n</code></pre><h1>è‡ªå¢å€¼ä¿å­˜åœ¨å“ªå„¿ï¼Ÿ</h1><p>åœ¨è¿™ä¸ªç©ºè¡¨té‡Œé¢æ‰§è¡Œinsert into t values(null, 1, 1);æ’å…¥ä¸€è¡Œæ•°æ®ï¼Œå†æ‰§è¡Œshow create tableå‘½ä»¤ï¼Œå°±å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºçš„ç»“æœï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/cb/ff/cb2637cada0201b18650f56875e94fff.png?wh=1430*542\" alt=\"\"></p><center><span class=\"reference\">å›¾1 è‡ªåŠ¨ç”Ÿæˆçš„AUTO_INCREMENTå€¼</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œè¡¨å®šä¹‰é‡Œé¢å‡ºç°äº†ä¸€ä¸ªAUTO_INCREMENT=2ï¼Œè¡¨ç¤ºä¸‹ä¸€æ¬¡æ’å…¥æ•°æ®æ—¶ï¼Œå¦‚æœéœ€è¦è‡ªåŠ¨ç”Ÿæˆè‡ªå¢å€¼ï¼Œä¼šç”Ÿæˆid=2ã€‚</p><p>å…¶å®ï¼Œè¿™ä¸ªè¾“å‡ºç»“æœå®¹æ˜“å¼•èµ·è¿™æ ·çš„è¯¯è§£ï¼šè‡ªå¢å€¼æ˜¯ä¿å­˜åœ¨è¡¨ç»“æ„å®šä¹‰é‡Œçš„ã€‚å®é™…ä¸Šï¼Œ<strong>è¡¨çš„ç»“æ„å®šä¹‰å­˜æ”¾åœ¨åç¼€åä¸º.frmçš„æ–‡ä»¶ä¸­ï¼Œä½†æ˜¯å¹¶ä¸ä¼šä¿å­˜è‡ªå¢å€¼ã€‚</strong></p><p>ä¸åŒçš„å¼•æ“å¯¹äºè‡ªå¢å€¼çš„ä¿å­˜ç­–ç•¥ä¸åŒã€‚</p><ul>\n<li>MyISAMå¼•æ“çš„è‡ªå¢å€¼ä¿å­˜åœ¨æ•°æ®æ–‡ä»¶ä¸­ã€‚</li>\n<li>InnoDBå¼•æ“çš„è‡ªå¢å€¼ï¼Œå…¶å®æ˜¯ä¿å­˜åœ¨äº†å†…å­˜é‡Œï¼Œå¹¶ä¸”åˆ°äº†MySQL 8.0ç‰ˆæœ¬åï¼Œæ‰æœ‰äº†â€œè‡ªå¢å€¼æŒä¹…åŒ–â€çš„èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯æ‰å®ç°äº†â€œå¦‚æœå‘ç”Ÿé‡å¯ï¼Œè¡¨çš„è‡ªå¢å€¼å¯ä»¥æ¢å¤ä¸ºMySQLé‡å¯å‰çš„å€¼â€ï¼Œå…·ä½“æƒ…å†µæ˜¯ï¼š\n<ul>\n<li>åœ¨MySQL 5.7åŠä¹‹å‰çš„ç‰ˆæœ¬ï¼Œè‡ªå¢å€¼ä¿å­˜åœ¨å†…å­˜é‡Œï¼Œå¹¶æ²¡æœ‰æŒä¹…åŒ–ã€‚æ¯æ¬¡é‡å¯åï¼Œç¬¬ä¸€æ¬¡æ‰“å¼€è¡¨çš„æ—¶å€™ï¼Œéƒ½ä¼šå»æ‰¾è‡ªå¢å€¼çš„æœ€å¤§å€¼max(id)ï¼Œç„¶åå°†max(id)+1ä½œä¸ºè¿™ä¸ªè¡¨å½“å‰çš„è‡ªå¢å€¼ã€‚ï»¿<br>\nä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªè¡¨å½“å‰æ•°æ®è¡Œé‡Œæœ€å¤§çš„idæ˜¯10ï¼ŒAUTO_INCREMENT=11ã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬åˆ é™¤id=10çš„è¡Œï¼ŒAUTO_INCREMENTè¿˜æ˜¯11ã€‚ä½†å¦‚æœé©¬ä¸Šé‡å¯å®ä¾‹ï¼Œé‡å¯åè¿™ä¸ªè¡¨çš„AUTO_INCREMENTå°±ä¼šå˜æˆ10ã€‚ï»¿<br>\nä¹Ÿå°±æ˜¯è¯´ï¼ŒMySQLé‡å¯å¯èƒ½ä¼šä¿®æ”¹ä¸€ä¸ªè¡¨çš„AUTO_INCREMENTçš„å€¼ã€‚</li>\n<li>åœ¨MySQL 8.0ç‰ˆæœ¬ï¼Œå°†è‡ªå¢å€¼çš„å˜æ›´è®°å½•åœ¨äº†redo logä¸­ï¼Œé‡å¯çš„æ—¶å€™ä¾é redo logæ¢å¤é‡å¯ä¹‹å‰çš„å€¼ã€‚</li>\n</ul>\n</li>\n</ul><!-- [[[read_end]]] --><p>ç†è§£äº†MySQLå¯¹è‡ªå¢å€¼çš„ä¿å­˜ç­–ç•¥ä»¥åï¼Œæˆ‘ä»¬å†çœ‹çœ‹è‡ªå¢å€¼ä¿®æ”¹æœºåˆ¶ã€‚</p><h1>è‡ªå¢å€¼ä¿®æ”¹æœºåˆ¶</h1><p>åœ¨MySQLé‡Œé¢ï¼Œå¦‚æœå­—æ®µidè¢«å®šä¹‰ä¸ºAUTO_INCREMENTï¼Œåœ¨æ’å…¥ä¸€è¡Œæ•°æ®çš„æ—¶å€™ï¼Œè‡ªå¢å€¼çš„è¡Œä¸ºå¦‚ä¸‹ï¼š</p><ol>\n<li>\n<p>å¦‚æœæ’å…¥æ•°æ®æ—¶idå­—æ®µæŒ‡å®šä¸º0ã€null æˆ–æœªæŒ‡å®šå€¼ï¼Œé‚£ä¹ˆå°±æŠŠè¿™ä¸ªè¡¨å½“å‰çš„ AUTO_INCREMENTå€¼å¡«åˆ°è‡ªå¢å­—æ®µï¼›</p>\n</li>\n<li>\n<p>å¦‚æœæ’å…¥æ•°æ®æ—¶idå­—æ®µæŒ‡å®šäº†å…·ä½“çš„å€¼ï¼Œå°±ç›´æ¥ä½¿ç”¨è¯­å¥é‡ŒæŒ‡å®šçš„å€¼ã€‚</p>\n</li>\n</ol><p>æ ¹æ®è¦æ’å…¥çš„å€¼å’Œå½“å‰è‡ªå¢å€¼çš„å¤§å°å…³ç³»ï¼Œè‡ªå¢å€¼çš„å˜æ›´ç»“æœä¹Ÿä¼šæœ‰æ‰€ä¸åŒã€‚å‡è®¾ï¼ŒæŸæ¬¡è¦æ’å…¥çš„å€¼æ˜¯Xï¼Œå½“å‰çš„è‡ªå¢å€¼æ˜¯Yã€‚</p><ol>\n<li>\n<p>å¦‚æœX&lt;Yï¼Œé‚£ä¹ˆè¿™ä¸ªè¡¨çš„è‡ªå¢å€¼ä¸å˜ï¼›</p>\n</li>\n<li>\n<p>å¦‚æœXâ‰¥Yï¼Œå°±éœ€è¦æŠŠå½“å‰è‡ªå¢å€¼ä¿®æ”¹ä¸ºæ–°çš„è‡ªå¢å€¼ã€‚</p>\n</li>\n</ol><p><strong>æ–°çš„è‡ªå¢å€¼ç”Ÿæˆç®—æ³•æ˜¯</strong>ï¼šä»auto_increment_offsetå¼€å§‹ï¼Œä»¥auto_increment_incrementä¸ºæ­¥é•¿ï¼ŒæŒç»­å åŠ ï¼Œç›´åˆ°æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äºXçš„å€¼ï¼Œä½œä¸ºæ–°çš„è‡ªå¢å€¼ã€‚</p><p>å…¶ä¸­ï¼Œauto_increment_offset å’Œ auto_increment_incrementæ˜¯ä¸¤ä¸ªç³»ç»Ÿå‚æ•°ï¼Œåˆ†åˆ«ç”¨æ¥è¡¨ç¤ºè‡ªå¢çš„åˆå§‹å€¼å’Œæ­¥é•¿ï¼Œé»˜è®¤å€¼éƒ½æ˜¯1ã€‚</p><blockquote>\n<p>å¤‡æ³¨ï¼šåœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œä½¿ç”¨çš„å°±ä¸å…¨æ˜¯é»˜è®¤å€¼ã€‚æ¯”å¦‚ï¼ŒåŒMçš„ä¸»å¤‡ç»“æ„é‡Œè¦æ±‚åŒå†™çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯èƒ½ä¼šè®¾ç½®æˆauto_increment_increment=2ï¼Œè®©ä¸€ä¸ªåº“çš„è‡ªå¢idéƒ½æ˜¯å¥‡æ•°ï¼Œå¦ä¸€ä¸ªåº“çš„è‡ªå¢idéƒ½æ˜¯å¶æ•°ï¼Œé¿å…ä¸¤ä¸ªåº“ç”Ÿæˆçš„ä¸»é”®å‘ç”Ÿå†²çªã€‚</p>\n</blockquote><p>å½“auto_increment_offsetå’Œauto_increment_incrementéƒ½æ˜¯1çš„æ—¶å€™ï¼Œæ–°çš„è‡ªå¢å€¼ç”Ÿæˆé€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯ï¼š</p><ol>\n<li>\n<p>å¦‚æœå‡†å¤‡æ’å…¥çš„å€¼&gt;=å½“å‰è‡ªå¢å€¼ï¼Œæ–°çš„è‡ªå¢å€¼å°±æ˜¯â€œå‡†å¤‡æ’å…¥çš„å€¼+1â€ï¼›</p>\n</li>\n<li>\n<p>å¦åˆ™ï¼Œè‡ªå¢å€¼ä¸å˜ã€‚</p>\n</li>\n</ol><p>è¿™å°±å¼•å…¥äº†æˆ‘ä»¬æ–‡ç« å¼€å¤´æåˆ°çš„é—®é¢˜ï¼Œåœ¨è¿™ä¸¤ä¸ªå‚æ•°éƒ½è®¾ç½®ä¸º1çš„æ—¶å€™ï¼Œè‡ªå¢ä¸»é”®idå´ä¸èƒ½ä¿è¯æ˜¯è¿ç»­çš„ï¼Œè¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ</p><h1>è‡ªå¢å€¼çš„ä¿®æ”¹æ—¶æœº</h1><p>è¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±è¦çœ‹ä¸€ä¸‹è‡ªå¢å€¼çš„ä¿®æ”¹æ—¶æœºã€‚</p><p>å‡è®¾ï¼Œè¡¨té‡Œé¢å·²ç»æœ‰äº†(1,1,1)è¿™æ¡è®°å½•ï¼Œè¿™æ—¶æˆ‘å†æ‰§è¡Œä¸€æ¡æ’å…¥æ•°æ®å‘½ä»¤ï¼š</p><pre><code>insert into t values(null, 1, 1); \n</code></pre><p>è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæµç¨‹å°±æ˜¯ï¼š</p><ol>\n<li>\n<p>æ‰§è¡Œå™¨è°ƒç”¨InnoDBå¼•æ“æ¥å£å†™å…¥ä¸€è¡Œï¼Œä¼ å…¥çš„è¿™ä¸€è¡Œçš„å€¼æ˜¯(0,1,1);</p>\n</li>\n<li>\n<p>InnoDBå‘ç°ç”¨æˆ·æ²¡æœ‰æŒ‡å®šè‡ªå¢idçš„å€¼ï¼Œè·å–è¡¨tå½“å‰çš„è‡ªå¢å€¼2ï¼›</p>\n</li>\n<li>\n<p>å°†ä¼ å…¥çš„è¡Œçš„å€¼æ”¹æˆ(2,1,1);</p>\n</li>\n<li>\n<p>å°†è¡¨çš„è‡ªå¢å€¼æ”¹æˆ3ï¼›</p>\n</li>\n<li>\n<p>ç»§ç»­æ‰§è¡Œæ’å…¥æ•°æ®æ“ä½œï¼Œç”±äºå·²ç»å­˜åœ¨c=1çš„è®°å½•ï¼Œæ‰€ä»¥æŠ¥Duplicate key errorï¼Œè¯­å¥è¿”å›ã€‚</p>\n</li>\n</ol><p>å¯¹åº”çš„æ‰§è¡Œæµç¨‹å›¾å¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/f1/d3/f16d89a6e7ad6e2cde13b32bb2292dd3.jpg?wh=1142*1522\" alt=\"\"></p><center><span class=\"reference\">å›¾2 insert(null, 1,1)å”¯ä¸€é”®å†²çª</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªè¡¨çš„è‡ªå¢å€¼æ”¹æˆ3ï¼Œæ˜¯åœ¨çœŸæ­£æ‰§è¡Œæ’å…¥æ•°æ®çš„æ“ä½œä¹‹å‰ã€‚è¿™ä¸ªè¯­å¥çœŸæ­£æ‰§è¡Œçš„æ—¶å€™ï¼Œå› ä¸ºç¢°åˆ°å”¯ä¸€é”®cå†²çªï¼Œæ‰€ä»¥id=2è¿™ä¸€è¡Œå¹¶æ²¡æœ‰æ’å…¥æˆåŠŸï¼Œä½†ä¹Ÿæ²¡æœ‰å°†è‡ªå¢å€¼å†æ”¹å›å»ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨è¿™ä¹‹åï¼Œå†æ’å…¥æ–°çš„æ•°æ®è¡Œæ—¶ï¼Œæ‹¿åˆ°çš„è‡ªå¢idå°±æ˜¯3ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡ºç°äº†è‡ªå¢ä¸»é”®ä¸è¿ç»­çš„æƒ…å†µã€‚</p><p>å¦‚å›¾3æ‰€ç¤ºå°±æ˜¯å®Œæ•´çš„æ¼”ç¤ºç»“æœã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/77/26/77b87820b649692a555f19b562d5d926.png?wh=659*641\" alt=\"\"></p><center><span class=\"reference\">å›¾3 ä¸€ä¸ªè‡ªå¢ä¸»é”®idä¸è¿ç»­çš„å¤ç°æ­¥éª¤</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ“ä½œåºåˆ—å¤ç°äº†ä¸€ä¸ªè‡ªå¢ä¸»é”®idä¸è¿ç»­çš„ç°åœº(æ²¡æœ‰id=2çš„è¡Œï¼‰ã€‚å¯è§ï¼Œ<strong>å”¯ä¸€é”®å†²çªæ˜¯å¯¼è‡´è‡ªå¢ä¸»é”®idä¸è¿ç»­çš„ç¬¬ä¸€ç§åŸå› ã€‚</strong></p><p>åŒæ ·åœ°ï¼Œäº‹åŠ¡<strong>å›æ»šä¹Ÿä¼šäº§ç”Ÿç±»ä¼¼çš„ç°è±¡ï¼Œè¿™å°±æ˜¯ç¬¬äºŒç§åŸå› ã€‚</strong></p><p>ä¸‹é¢è¿™ä¸ªè¯­å¥åºåˆ—å°±å¯ä»¥æ„é€ ä¸è¿ç»­çš„è‡ªå¢idï¼Œä½ å¯ä»¥è‡ªå·±éªŒè¯ä¸€ä¸‹ã€‚</p><pre><code>insert into t values(null,1,1);\nbegin;\ninsert into t values(null,2,2);\nrollback;\ninsert into t values(null,2,2);\n//æ’å…¥çš„è¡Œæ˜¯(3,2,2)\n</code></pre><p>ä½ å¯èƒ½ä¼šé—®ï¼Œä¸ºä»€ä¹ˆåœ¨å‡ºç°å”¯ä¸€é”®å†²çªæˆ–è€…å›æ»šçš„æ—¶å€™ï¼ŒMySQLæ²¡æœ‰æŠŠè¡¨tçš„è‡ªå¢å€¼æ”¹å›å»å‘¢ï¼Ÿå¦‚æœæŠŠè¡¨tçš„å½“å‰è‡ªå¢å€¼ä»3æ”¹å›2ï¼Œå†æ’å…¥æ–°æ•°æ®çš„æ—¶å€™ï¼Œä¸å°±å¯ä»¥ç”Ÿæˆid=2çš„ä¸€è¡Œæ•°æ®äº†å—ï¼Ÿ</p><p>å…¶å®ï¼ŒMySQLè¿™ä¹ˆè®¾è®¡æ˜¯ä¸ºäº†æå‡æ€§èƒ½ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å°±è·Ÿä½ åˆ†æä¸€ä¸‹è¿™ä¸ªè®¾è®¡æ€è·¯ï¼Œçœ‹çœ‹<strong>è‡ªå¢å€¼ä¸ºä»€ä¹ˆä¸èƒ½å›é€€ã€‚</strong></p><p>å‡è®¾æœ‰ä¸¤ä¸ªå¹¶è¡Œæ‰§è¡Œçš„äº‹åŠ¡ï¼Œåœ¨ç”³è¯·è‡ªå¢å€¼çš„æ—¶å€™ï¼Œä¸ºäº†é¿å…ä¸¤ä¸ªäº‹åŠ¡ç”³è¯·åˆ°ç›¸åŒçš„è‡ªå¢idï¼Œè‚¯å®šè¦åŠ é”ï¼Œç„¶åé¡ºåºç”³è¯·ã€‚</p><ol>\n<li>\n<p>å‡è®¾äº‹åŠ¡Aç”³è¯·åˆ°äº†id=2ï¼Œ äº‹åŠ¡Bç”³è¯·åˆ°id=3ï¼Œé‚£ä¹ˆè¿™æ—¶å€™è¡¨tçš„è‡ªå¢å€¼æ˜¯4ï¼Œä¹‹åç»§ç»­æ‰§è¡Œã€‚</p>\n</li>\n<li>\n<p>äº‹åŠ¡Bæ­£ç¡®æäº¤äº†ï¼Œä½†äº‹åŠ¡Aå‡ºç°äº†å”¯ä¸€é”®å†²çªã€‚</p>\n</li>\n<li>\n<p>å¦‚æœå…è®¸äº‹åŠ¡AæŠŠè‡ªå¢idå›é€€ï¼Œä¹Ÿå°±æ˜¯æŠŠè¡¨tçš„å½“å‰è‡ªå¢å€¼æ”¹å›2ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µï¼šè¡¨é‡Œé¢å·²ç»æœ‰id=3çš„è¡Œï¼Œè€Œå½“å‰çš„è‡ªå¢idå€¼æ˜¯2ã€‚</p>\n</li>\n<li>\n<p>æ¥ä¸‹æ¥ï¼Œç»§ç»­æ‰§è¡Œçš„å…¶ä»–äº‹åŠ¡å°±ä¼šç”³è¯·åˆ°id=2ï¼Œç„¶åå†ç”³è¯·åˆ°id=3ã€‚è¿™æ—¶ï¼Œå°±ä¼šå‡ºç°æ’å…¥è¯­å¥æŠ¥é”™â€œä¸»é”®å†²çªâ€ã€‚</p>\n</li>\n</ol><p>è€Œä¸ºäº†è§£å†³è¿™ä¸ªä¸»é”®å†²çªï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><ol>\n<li>\n<p>æ¯æ¬¡ç”³è¯·idä¹‹å‰ï¼Œå…ˆåˆ¤æ–­è¡¨é‡Œé¢æ˜¯å¦å·²ç»å­˜åœ¨è¿™ä¸ªidã€‚å¦‚æœå­˜åœ¨ï¼Œå°±è·³è¿‡è¿™ä¸ªidã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•çš„æˆæœ¬å¾ˆé«˜ã€‚å› ä¸ºï¼Œæœ¬æ¥ç”³è¯·idæ˜¯ä¸€ä¸ªå¾ˆå¿«çš„æ“ä½œï¼Œç°åœ¨è¿˜è¦å†å»ä¸»é”®ç´¢å¼•æ ‘ä¸Šåˆ¤æ–­idæ˜¯å¦å­˜åœ¨ã€‚</p>\n</li>\n<li>\n<p>æŠŠè‡ªå¢idçš„é”èŒƒå›´æ‰©å¤§ï¼Œå¿…é¡»ç­‰åˆ°ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæˆå¹¶æäº¤ï¼Œä¸‹ä¸€ä¸ªäº‹åŠ¡æ‰èƒ½å†ç”³è¯·è‡ªå¢idã€‚è¿™ä¸ªæ–¹æ³•çš„é—®é¢˜ï¼Œå°±æ˜¯é”çš„ç²’åº¦å¤ªå¤§ï¼Œç³»ç»Ÿå¹¶å‘èƒ½åŠ›å¤§å¤§ä¸‹é™ã€‚</p>\n</li>\n</ol><p>å¯è§ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚é€ æˆè¿™äº›éº»çƒ¦çš„ç½ªé­ç¥¸é¦–ï¼Œå°±æ˜¯æˆ‘ä»¬å‡è®¾çš„è¿™ä¸ªâ€œå…è®¸è‡ªå¢idå›é€€â€çš„å‰æå¯¼è‡´çš„ã€‚</p><p>å› æ­¤ï¼ŒInnoDBæ”¾å¼ƒäº†è¿™ä¸ªè®¾è®¡ï¼Œè¯­å¥æ‰§è¡Œå¤±è´¥ä¹Ÿä¸å›é€€è‡ªå¢idã€‚ä¹Ÿæ­£æ˜¯å› ä¸ºè¿™æ ·ï¼Œæ‰€ä»¥æ‰åªä¿è¯äº†è‡ªå¢idæ˜¯é€’å¢çš„ï¼Œä½†ä¸ä¿è¯æ˜¯è¿ç»­çš„ã€‚</p><h1>è‡ªå¢é”çš„ä¼˜åŒ–</h1><p>å¯ä»¥çœ‹åˆ°ï¼Œè‡ªå¢idé”å¹¶ä¸æ˜¯ä¸€ä¸ªäº‹åŠ¡é”ï¼Œè€Œæ˜¯æ¯æ¬¡ç”³è¯·å®Œå°±é©¬ä¸Šé‡Šæ”¾ï¼Œä»¥ä¾¿å…è®¸åˆ«çš„äº‹åŠ¡å†ç”³è¯·ã€‚å…¶å®ï¼Œåœ¨MySQL 5.1ç‰ˆæœ¬ä¹‹å‰ï¼Œå¹¶ä¸æ˜¯è¿™æ ·çš„ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä¼šå…ˆç»™ä½ ä»‹ç»ä¸‹è‡ªå¢é”è®¾è®¡çš„å†å²ï¼Œè¿™æ ·æœ‰åŠ©äºä½ åˆ†ææ¥ä¸‹æ¥çš„ä¸€ä¸ªé—®é¢˜ã€‚</p><p>åœ¨MySQL 5.0ç‰ˆæœ¬çš„æ—¶å€™ï¼Œè‡ªå¢é”çš„èŒƒå›´æ˜¯è¯­å¥çº§åˆ«ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªè¯­å¥ç”³è¯·äº†ä¸€ä¸ªè¡¨è‡ªå¢é”ï¼Œè¿™ä¸ªé”ä¼šç­‰è¯­å¥æ‰§è¡Œç»“æŸä»¥åæ‰é‡Šæ”¾ã€‚æ˜¾ç„¶ï¼Œè¿™æ ·è®¾è®¡ä¼šå½±å“å¹¶å‘åº¦ã€‚</p><p>MySQL 5.1.22ç‰ˆæœ¬å¼•å…¥äº†ä¸€ä¸ªæ–°ç­–ç•¥ï¼Œæ–°å¢å‚æ•°innodb_autoinc_lock_modeï¼Œé»˜è®¤å€¼æ˜¯1ã€‚</p><ol>\n<li>\n<p>è¿™ä¸ªå‚æ•°çš„å€¼è¢«è®¾ç½®ä¸º0æ—¶ï¼Œè¡¨ç¤ºé‡‡ç”¨ä¹‹å‰MySQL 5.0ç‰ˆæœ¬çš„ç­–ç•¥ï¼Œå³è¯­å¥æ‰§è¡Œç»“æŸåæ‰é‡Šæ”¾é”ï¼›</p>\n</li>\n<li>\n<p>è¿™ä¸ªå‚æ•°çš„å€¼è¢«è®¾ç½®ä¸º1æ—¶ï¼š</p>\n<ul>\n<li>æ™®é€šinsertè¯­å¥ï¼Œè‡ªå¢é”åœ¨ç”³è¯·ä¹‹åå°±é©¬ä¸Šé‡Šæ”¾ï¼›</li>\n<li>ç±»ä¼¼insert â€¦ selectè¿™æ ·çš„æ‰¹é‡æ’å…¥æ•°æ®çš„è¯­å¥ï¼Œè‡ªå¢é”è¿˜æ˜¯è¦ç­‰è¯­å¥ç»“æŸåæ‰è¢«é‡Šæ”¾ï¼›</li>\n</ul>\n</li>\n<li>\n<p>è¿™ä¸ªå‚æ•°çš„å€¼è¢«è®¾ç½®ä¸º2æ—¶ï¼Œæ‰€æœ‰çš„ç”³è¯·è‡ªå¢ä¸»é”®çš„åŠ¨ä½œéƒ½æ˜¯ç”³è¯·åå°±é‡Šæ”¾é”ã€‚</p>\n</li>\n</ol><p>ä½ ä¸€å®šæœ‰ä¸¤ä¸ªç–‘é—®ï¼š<strong>ä¸ºä»€ä¹ˆé»˜è®¤è®¾ç½®ä¸‹ï¼Œinsert â€¦ select è¦ä½¿ç”¨è¯­å¥çº§çš„é”ï¼Ÿä¸ºä»€ä¹ˆè¿™ä¸ªå‚æ•°çš„é»˜è®¤å€¼ä¸æ˜¯2ï¼Ÿ</strong></p><p>ç­”æ¡ˆæ˜¯ï¼Œè¿™ä¹ˆè®¾è®¡è¿˜æ˜¯ä¸ºäº†æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p><p>æˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/e0/df/e0a69e151277de54a8262657e4ec89df.png?wh=933*278\" alt=\"\"></p><center><span class=\"reference\">å›¾4 æ‰¹é‡æ’å…¥æ•°æ®çš„è‡ªå¢é”</span></center><p>åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘å¾€è¡¨t1ä¸­æ’å…¥äº†4è¡Œæ•°æ®ï¼Œç„¶ååˆ›å»ºäº†ä¸€ä¸ªç›¸åŒç»“æ„çš„è¡¨t2ï¼Œç„¶åä¸¤ä¸ªsessionåŒæ—¶æ‰§è¡Œå‘è¡¨t2ä¸­æ’å…¥æ•°æ®çš„æ“ä½œã€‚</p><p>ä½ å¯ä»¥è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœsession Bæ˜¯ç”³è¯·äº†è‡ªå¢å€¼ä»¥åé©¬ä¸Šå°±é‡Šæ”¾è‡ªå¢é”ï¼Œé‚£ä¹ˆå°±å¯èƒ½å‡ºç°è¿™æ ·çš„æƒ…å†µï¼š</p><ul>\n<li>session Bå…ˆæ’å…¥äº†ä¸¤ä¸ªè®°å½•ï¼Œ(1,1,1)ã€(2,2,2)ï¼›</li>\n<li>ç„¶åï¼Œsession Aæ¥ç”³è¯·è‡ªå¢idå¾—åˆ°id=3ï¼Œæ’å…¥äº†ï¼ˆ3,5,5)ï¼›</li>\n<li>ä¹‹åï¼Œsession Bç»§ç»­æ‰§è¡Œï¼Œæ’å…¥ä¸¤æ¡è®°å½•(4,3,3)ã€ (5,4,4)ã€‚</li>\n</ul><p>ä½ å¯èƒ½ä¼šè¯´ï¼Œè¿™ä¹Ÿæ²¡å…³ç³»å§ï¼Œæ¯•ç«Ÿsession Bçš„è¯­ä¹‰æœ¬èº«å°±æ²¡æœ‰è¦æ±‚è¡¨t2çš„æ‰€æœ‰è¡Œçš„æ•°æ®éƒ½è·Ÿsession Aç›¸åŒã€‚</p><p>æ˜¯çš„ï¼Œä»æ•°æ®é€»è¾‘ä¸Šçœ‹æ˜¯å¯¹çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ç°åœ¨çš„binlog_format=statementï¼Œä½ å¯ä»¥è®¾æƒ³ä¸‹ï¼Œbinlogä¼šæ€ä¹ˆè®°å½•å‘¢ï¼Ÿ</p><p>ç”±äºä¸¤ä¸ªsessionæ˜¯åŒæ—¶æ‰§è¡Œæ’å…¥æ•°æ®å‘½ä»¤çš„ï¼Œæ‰€ä»¥binlogé‡Œé¢å¯¹è¡¨t2çš„æ›´æ–°æ—¥å¿—åªæœ‰ä¸¤ç§æƒ…å†µï¼šè¦ä¹ˆå…ˆè®°session Açš„ï¼Œè¦ä¹ˆå…ˆè®°session Bçš„ã€‚</p><p>ä½†ä¸è®ºæ˜¯å“ªä¸€ç§ï¼Œè¿™ä¸ªbinlogæ‹¿å»ä»åº“æ‰§è¡Œï¼Œæˆ–è€…ç”¨æ¥æ¢å¤ä¸´æ—¶å®ä¾‹ï¼Œå¤‡åº“å’Œä¸´æ—¶å®ä¾‹é‡Œé¢ï¼Œsession Bè¿™ä¸ªè¯­å¥æ‰§è¡Œå‡ºæ¥ï¼Œç”Ÿæˆçš„ç»“æœé‡Œé¢ï¼Œidéƒ½æ˜¯è¿ç»­çš„ã€‚è¿™æ—¶ï¼Œè¿™ä¸ªåº“å°±å‘ç”Ÿäº†æ•°æ®ä¸ä¸€è‡´ã€‚</p><p>ä½ å¯ä»¥åˆ†æä¸€ä¸‹ï¼Œå‡ºç°è¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>å…¶å®ï¼Œè¿™æ˜¯å› ä¸ºåŸåº“session Bçš„insertè¯­å¥ï¼Œç”Ÿæˆçš„idä¸è¿ç»­ã€‚è¿™ä¸ªä¸è¿ç»­çš„idï¼Œç”¨statementæ ¼å¼çš„binlogæ¥ä¸²è¡Œæ‰§è¡Œï¼Œæ˜¯æ‰§è¡Œä¸å‡ºæ¥çš„ã€‚</p><p>è€Œè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ä¸¤ç§æ€è·¯ï¼š</p><ol>\n<li>\n<p>ä¸€ç§æ€è·¯æ˜¯ï¼Œè®©åŸåº“çš„æ‰¹é‡æ’å…¥æ•°æ®è¯­å¥ï¼Œå›ºå®šç”Ÿæˆè¿ç»­çš„idå€¼ã€‚æ‰€ä»¥ï¼Œè‡ªå¢é”ç›´åˆ°è¯­å¥æ‰§è¡Œç»“æŸæ‰é‡Šæ”¾ï¼Œå°±æ˜¯ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚</p>\n</li>\n<li>\n<p>å¦ä¸€ç§æ€è·¯æ˜¯ï¼Œåœ¨binlogé‡Œé¢æŠŠæ’å…¥æ•°æ®çš„æ“ä½œéƒ½å¦‚å®è®°å½•è¿›æ¥ï¼Œåˆ°å¤‡åº“æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸å†ä¾èµ–äºè‡ªå¢ä¸»é”®å»ç”Ÿæˆã€‚è¿™ç§æƒ…å†µï¼Œå…¶å®å°±æ˜¯innodb_autoinc_lock_modeè®¾ç½®ä¸º2ï¼ŒåŒæ—¶binlog_formatè®¾ç½®ä¸ºrowã€‚</p>\n</li>\n</ol><p>å› æ­¤ï¼Œ<strong>åœ¨ç”Ÿäº§ä¸Šï¼Œå°¤å…¶æ˜¯æœ‰insert â€¦ selectè¿™ç§æ‰¹é‡æ’å…¥æ•°æ®çš„åœºæ™¯æ—¶ï¼Œä»å¹¶å‘æ’å…¥æ•°æ®æ€§èƒ½çš„è§’åº¦è€ƒè™‘ï¼Œæˆ‘å»ºè®®ä½ è¿™æ ·è®¾ç½®ï¼šinnodb_autoinc_lock_mode=2 ï¼Œå¹¶ä¸” binlog_format=row</strong>.è¿™æ ·åšï¼Œæ—¢èƒ½æå‡å¹¶å‘æ€§ï¼Œåˆä¸ä¼šå‡ºç°æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘è¿™é‡Œè¯´çš„<strong>æ‰¹é‡æ’å…¥æ•°æ®ï¼ŒåŒ…å«çš„è¯­å¥ç±»å‹æ˜¯insert â€¦ selectã€replace â€¦ selectå’Œload dataè¯­å¥ã€‚</strong></p><p>ä½†æ˜¯ï¼Œåœ¨æ™®é€šçš„insertè¯­å¥é‡Œé¢åŒ…å«å¤šä¸ªvalueå€¼çš„æƒ…å†µä¸‹ï¼Œå³ä½¿innodb_autoinc_lock_modeè®¾ç½®ä¸º1ï¼Œä¹Ÿä¸ä¼šç­‰è¯­å¥æ‰§è¡Œå®Œæˆæ‰é‡Šæ”¾é”ã€‚å› ä¸ºè¿™ç±»è¯­å¥åœ¨ç”³è¯·è‡ªå¢idçš„æ—¶å€™ï¼Œæ˜¯å¯ä»¥ç²¾ç¡®è®¡ç®—å‡ºéœ€è¦å¤šå°‘ä¸ªidçš„ï¼Œç„¶åä¸€æ¬¡æ€§ç”³è¯·ï¼Œç”³è¯·å®Œæˆåé”å°±å¯ä»¥é‡Šæ”¾äº†ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰¹é‡æ’å…¥æ•°æ®çš„è¯­å¥ï¼Œä¹‹æ‰€ä»¥éœ€è¦è¿™ä¹ˆè®¾ç½®ï¼Œæ˜¯å› ä¸ºâ€œä¸çŸ¥é“è¦é¢„å…ˆç”³è¯·å¤šå°‘ä¸ªidâ€ã€‚</p><p>æ—¢ç„¶é¢„å…ˆä¸çŸ¥é“è¦ç”³è¯·å¤šå°‘ä¸ªè‡ªå¢idï¼Œé‚£ä¹ˆä¸€ç§ç›´æ¥çš„æƒ³æ³•å°±æ˜¯éœ€è¦ä¸€ä¸ªæ—¶ç”³è¯·ä¸€ä¸ªã€‚ä½†å¦‚æœä¸€ä¸ªselect â€¦ insertè¯­å¥è¦æ’å…¥10ä¸‡è¡Œæ•°æ®ï¼ŒæŒ‰ç…§è¿™ä¸ªé€»è¾‘çš„è¯å°±è¦ç”³è¯·10ä¸‡æ¬¡ã€‚æ˜¾ç„¶ï¼Œè¿™ç§ç”³è¯·è‡ªå¢idçš„ç­–ç•¥ï¼Œåœ¨å¤§æ‰¹é‡æ’å…¥æ•°æ®çš„æƒ…å†µä¸‹ï¼Œä¸ä½†é€Ÿåº¦æ…¢ï¼Œè¿˜ä¼šå½±å“å¹¶å‘æ’å…¥çš„æ€§èƒ½ã€‚</p><p>å› æ­¤ï¼Œå¯¹äºæ‰¹é‡æ’å…¥æ•°æ®çš„è¯­å¥ï¼ŒMySQLæœ‰ä¸€ä¸ªæ‰¹é‡ç”³è¯·è‡ªå¢idçš„ç­–ç•¥ï¼š</p><ol>\n<li>\n<p>è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç¬¬ä¸€æ¬¡ç”³è¯·è‡ªå¢idï¼Œä¼šåˆ†é…1ä¸ªï¼›</p>\n</li>\n<li>\n<p>1ä¸ªç”¨å®Œä»¥åï¼Œè¿™ä¸ªè¯­å¥ç¬¬äºŒæ¬¡ç”³è¯·è‡ªå¢idï¼Œä¼šåˆ†é…2ä¸ªï¼›</p>\n</li>\n<li>\n<p>2ä¸ªç”¨å®Œä»¥åï¼Œè¿˜æ˜¯è¿™ä¸ªè¯­å¥ï¼Œç¬¬ä¸‰æ¬¡ç”³è¯·è‡ªå¢idï¼Œä¼šåˆ†é…4ä¸ªï¼›</p>\n</li>\n<li>\n<p>ä¾æ­¤ç±»æ¨ï¼ŒåŒä¸€ä¸ªè¯­å¥å»ç”³è¯·è‡ªå¢idï¼Œæ¯æ¬¡ç”³è¯·åˆ°çš„è‡ªå¢idä¸ªæ•°éƒ½æ˜¯ä¸Šä¸€æ¬¡çš„ä¸¤å€ã€‚</p>\n</li>\n</ol><p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬ä¸€èµ·çœ‹çœ‹ä¸‹é¢çš„è¿™ä¸ªè¯­å¥åºåˆ—ï¼š</p><pre><code>insert into t values(null, 1,1);\ninsert into t values(null, 2,2);\ninsert into t values(null, 3,3);\ninsert into t values(null, 4,4);\ncreate table t2 like t;\ninsert into t2(c,d) select c,d from t;\ninsert into t2 values(null, 5,5);\n</code></pre><p>insertâ€¦selectï¼Œå®é™…ä¸Šå¾€è¡¨t2ä¸­æ’å…¥äº†4è¡Œæ•°æ®ã€‚ä½†æ˜¯ï¼Œè¿™å››è¡Œæ•°æ®æ˜¯åˆ†ä¸‰æ¬¡ç”³è¯·çš„è‡ªå¢idï¼Œç¬¬ä¸€æ¬¡ç”³è¯·åˆ°äº†id=1ï¼Œç¬¬äºŒæ¬¡è¢«åˆ†é…äº†id=2å’Œid=3ï¼Œ ç¬¬ä¸‰æ¬¡è¢«åˆ†é…åˆ°id=4åˆ°id=7ã€‚</p><p>ç”±äºè¿™æ¡è¯­å¥å®é™…åªç”¨ä¸Šäº†4ä¸ªidï¼Œæ‰€ä»¥id=5åˆ°id=7å°±è¢«æµªè´¹æ‰äº†ã€‚ä¹‹åï¼Œå†æ‰§è¡Œinsert into t2 values(null, 5,5)ï¼Œå®é™…ä¸Šæ’å…¥çš„æ•°æ®å°±æ˜¯ï¼ˆ8,5,5)ã€‚</p><p><strong>è¿™æ˜¯ä¸»é”®idå‡ºç°è‡ªå¢idä¸è¿ç»­çš„ç¬¬ä¸‰ç§åŸå› ã€‚</strong></p><h1>å°ç»“</h1><p>ä»Šå¤©ï¼Œæˆ‘ä»¬ä»â€œè‡ªå¢ä¸»é”®ä¸ºä»€ä¹ˆä¼šå‡ºç°ä¸è¿ç»­çš„å€¼â€è¿™ä¸ªé—®é¢˜å¼€å§‹ï¼Œé¦–å…ˆè®¨è®ºäº†è‡ªå¢å€¼çš„å­˜å‚¨ã€‚</p><p>åœ¨MyISAMå¼•æ“é‡Œé¢ï¼Œè‡ªå¢å€¼æ˜¯è¢«å†™åœ¨æ•°æ®æ–‡ä»¶ä¸Šçš„ã€‚è€Œåœ¨InnoDBä¸­ï¼Œè‡ªå¢å€¼æ˜¯è¢«è®°å½•åœ¨å†…å­˜çš„ã€‚MySQLç›´åˆ°8.0ç‰ˆæœ¬ï¼Œæ‰ç»™InnoDBè¡¨çš„è‡ªå¢å€¼åŠ ä¸Šäº†æŒä¹…åŒ–çš„èƒ½åŠ›ï¼Œç¡®ä¿é‡å¯å‰åä¸€ä¸ªè¡¨çš„è‡ªå¢å€¼ä¸å˜ã€‚</p><p>ç„¶åï¼Œæˆ‘å’Œä½ åˆ†äº«äº†åœ¨ä¸€ä¸ªè¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè‡ªå¢å€¼æ”¹å˜çš„æ—¶æœºï¼Œåˆ†æäº†ä¸ºä»€ä¹ˆMySQLåœ¨äº‹åŠ¡å›æ»šçš„æ—¶å€™ä¸èƒ½å›æ”¶è‡ªå¢idã€‚</p><p>MySQL 5.1.22ç‰ˆæœ¬å¼€å§‹å¼•å…¥çš„å‚æ•°innodb_autoinc_lock_modeï¼Œæ§åˆ¶äº†è‡ªå¢å€¼ç”³è¯·æ—¶çš„é”èŒƒå›´ã€‚ä»å¹¶å‘æ€§èƒ½çš„è§’åº¦è€ƒè™‘ï¼Œæˆ‘å»ºè®®ä½ å°†å…¶è®¾ç½®ä¸º2ï¼ŒåŒæ—¶å°†binlog_formatè®¾ç½®ä¸ºrowã€‚æˆ‘åœ¨å‰é¢çš„æ–‡ç« ä¸­å…¶å®å¤šæ¬¡æåˆ°ï¼Œbinlog_formatè®¾ç½®ä¸ºrowï¼Œæ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚ä»Šå¤©çš„ä¾‹å­ç»™è¿™ä¸ªç»“è®ºå¤šäº†ä¸€ä¸ªç†ç”±ã€‚</p><p>æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸€ä¸ªæ€è€ƒé¢˜å§ã€‚</p><p>åœ¨æœ€åä¸€ä¸ªä¾‹å­ä¸­ï¼Œæ‰§è¡Œinsert into t2(c,d) select c,d from t;è¿™ä¸ªè¯­å¥çš„æ—¶å€™ï¼Œå¦‚æœéš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰ï¼Œbinlog_format=statementã€‚è¿™ä¸ªè¯­å¥ä¼šå¯¹è¡¨tçš„æ‰€æœ‰è®°å½•å’Œé—´éš™åŠ é”ã€‚</p><p>ä½ è§‰å¾—ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¹ˆåšå‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„æ€è€ƒå’Œåˆ†æå†™åœ¨è¯„è®ºåŒºï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h1>ä¸ŠæœŸé—®é¢˜æ—¶é—´</h1><p>ä¸ŠæœŸçš„é—®é¢˜æ˜¯ï¼Œå¦‚æœä½ ç»´æŠ¤çš„MySQLç³»ç»Ÿé‡Œæœ‰å†…å­˜è¡¨ï¼Œæ€ä¹ˆé¿å…å†…å­˜è¡¨çªç„¶ä¸¢æ•°æ®ï¼Œç„¶åå¯¼è‡´ä¸»å¤‡åŒæ­¥åœæ­¢çš„æƒ…å†µã€‚</p><p>æˆ‘ä»¬å‡è®¾çš„æ˜¯ä¸»åº“æš‚æ—¶ä¸èƒ½ä¿®æ”¹å¼•æ“ï¼Œé‚£ä¹ˆå°±æŠŠå¤‡åº“çš„å†…å­˜è¡¨å¼•æ“å…ˆéƒ½æ”¹æˆInnoDBã€‚å¯¹äºæ¯ä¸ªå†…å­˜è¡¨ï¼Œæ‰§è¡Œ</p><pre><code>set sql_log_bin=off;\nalter table tbl_name engine=innodb;\n</code></pre><p>è¿™æ ·å°±èƒ½é¿å…å¤‡åº“é‡å¯çš„æ—¶å€™ï¼Œæ•°æ®ä¸¢å¤±çš„é—®é¢˜ã€‚</p><p>ç”±äºä¸»åº“é‡å¯åï¼Œä¼šå¾€binlogé‡Œé¢å†™â€œdelete from tbl_nameâ€ï¼Œè¿™ä¸ªå‘½ä»¤ä¼ åˆ°å¤‡åº“ï¼Œå¤‡åº“çš„åŒåçš„è¡¨æ•°æ®ä¹Ÿä¼šè¢«æ¸…ç©ºã€‚</p><p>å› æ­¤ï¼Œå°±ä¸ä¼šå‡ºç°ä¸»å¤‡åŒæ­¥åœæ­¢çš„é—®é¢˜ã€‚</p><p>å¦‚æœç”±äºä¸»åº“å¼‚å¸¸é‡å¯ï¼Œè§¦å‘äº†HAï¼Œè¿™æ—¶å€™æˆ‘ä»¬ä¹‹å‰ä¿®æ”¹è¿‡å¼•æ“çš„å¤‡åº“å˜æˆäº†ä¸»åº“ã€‚è€ŒåŸæ¥çš„ä¸»åº“å˜æˆäº†æ–°å¤‡åº“ï¼Œåœ¨æ–°å¤‡åº“ä¸ŠæŠŠæ‰€æœ‰çš„å†…å­˜è¡¨ï¼ˆè¿™æ—¶å€™è¡¨é‡Œæ²¡æ•°æ®ï¼‰éƒ½æ”¹æˆInnoDBè¡¨ã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬ä¸èƒ½ç›´æ¥ä¿®æ”¹ä¸»åº“ä¸Šçš„è¡¨å¼•æ“ï¼Œå¯ä»¥é…ç½®ä¸€ä¸ªè‡ªåŠ¨å·¡æ£€çš„å·¥å…·ï¼Œåœ¨å¤‡åº“ä¸Šå‘ç°å†…å­˜è¡¨å°±æŠŠå¼•æ“æ”¹äº†ã€‚</p><p>åŒæ—¶ï¼Œè·Ÿä¸šåŠ¡å¼€å‘åŒå­¦çº¦å®šå¥½å»ºè¡¨è§„åˆ™ï¼Œé¿å…åˆ›å»ºæ–°çš„å†…å­˜è¡¨ã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote>\n<p>å¤§å®¶åœ¨æ˜¥èŠ‚æœŸé—´è¿˜åšæŒçœ‹ä¸“æ ï¼Œå¹¶ä¸”æ·±å…¥åœ°æ€è€ƒå’Œå›å¤ï¼Œç»™å¤§å®¶ç‚¹èµã€‚<br>\n@é•¿æ° åŒå­¦æåˆ°çš„å°†æ•°æ®ä¿å­˜åˆ°InnoDBè¡¨ç”¨æ¥æŒä¹…åŒ–ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ–¹æ³•ã€‚ä¸è¿‡ï¼Œæˆ‘è¿˜æ˜¯å»ºè®®é‡œåº•æŠ½è–ªï¼Œç›´æ¥ä¿®æ”¹å¤‡åº“çš„å†…å­˜è¡¨çš„å¼•æ“ã€‚<br>\n@è€æ¨åŒå¿— æåˆ°çš„æ˜¯ä¸»åº“å¼‚å¸¸é‡å¯çš„åœºæ™¯ï¼Œè¿™æ—¶å€™æ˜¯ä¸ä¼šæŠ¥ä¸»å¤‡ä¸ä¸€è‡´çš„ï¼Œå› ä¸ºä¸»åº“é‡å¯çš„æ—¶å€™å†™äº†delete from tbl_nameï¼Œä¸»å¤‡çš„å†…å­˜è¡¨éƒ½æ¸…ç©ºäº†ã€‚</p>\n</blockquote><p></p>","comments":[{"had_liked":false,"id":66078,"user_name":"é•¿æ°","can_delete":false,"product_type":"c1","uid":1312212,"ip_address":"","ucode":"DD52C9494005F7","user_header":"https://static001.geekbang.org/account/avatar/00/14/05/d4/e06bf86d.jpg","comment_is_top":false,"comment_ctime":1549871877,"is_pvip":false,"replies":[{"id":"23413","content":"ğŸ‘ è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„åœºæ™¯","user_name":"ä½œè€…å›å¤","comment_id":66078,"uid":"1264162","ip_address":"","utype":1,"ctime":1549879446,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":4,"race_medal":0,"score":"426751634181","product_id":100020801,"comment_content":"åœ¨æœ€åä¸€ä¸ªä¾‹å­ä¸­ï¼Œæ‰§è¡Œ insert into t2(c,d) select c,d from t; è¿™ä¸ªè¯­å¥çš„æ—¶å€™ï¼Œå¦‚æœéš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰ï¼Œbinlog_format=statementã€‚è¿™ä¸ªè¯­å¥ä¼šå¯¹è¡¨ t çš„æ‰€æœ‰è®°å½•å’Œé—´éš™åŠ é”ã€‚<br>ä½ è§‰å¾—ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¹ˆåšå‘¢ï¼Ÿ<br>å‡å¦‚åŸåº“ä¸å¯¹tè¡¨æ‰€æœ‰è®°å½•å’Œé—´éš™åŠ é”ï¼Œå¦‚æœæœ‰å…¶ä»–äº‹ç‰©æ–°å¢æ•°æ®å¹¶å…ˆä¸è¿™ä¸ªæ‰¹é‡æ“ä½œæäº¤ï¼Œç”±äºäº‹ç‰©çš„éš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯»ï¼Œt2æ˜¯çœ‹ä¸åˆ°æ–°å¢çš„æ•°æ®çš„ã€‚ä½†æ˜¯è®°å½•çš„binlogæ˜¯statementæ ¼å¼ï¼Œå¤‡åº“æˆ–åŸºäºbinlogæ¢å¤çš„ä¸´æ—¶åº“ï¼Œt2ä¼šçœ‹åˆ°æ–°å¢çš„æ•°æ®ï¼Œå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚","like_count":100,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438694,"discussion_content":"ğŸ‘ è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„åœºæ™¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549879446,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2448277,"avatar":"https://static001.geekbang.org/account/avatar/00/25/5b/95/462890c6.jpg","nickname":"å¶æ¶›","note":"","ucode":"B45348979BE159","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372820,"discussion_content":"æœ‰æ²¡æœ‰è¿™ç§æƒ…å†µå‘¢ï¼š\n1. tè¡¨çš„å…ˆæ–°å¢ä¸€æ¡æ•°æ®, ç„¶åæ‰§è¡Œ insert into t2(c,d) select c,d from tï¼Œtè¡¨æ­£å¸¸åŠ é”, \n2. ä½†å¦‚æœbinlogè®°å½•çš„æ˜¯ insert into t2...select... t å’Œ insert t...\n3. åœ¨ä»åº“æ‰§è¡Œçš„æ—¶å€™å…ˆæ‰§è¡Œäº†insert into t2 select....ï¼Œæ­¤æ—¶tæ–°å¢çš„æ•°æ®çš„sqlè¿˜æ²¡æœ‰æ‰§è¡Œï¼Œè¿™æ ·æ˜¯ä¸æ˜¯ä¹Ÿæ˜¯ä¸»å¤‡æ•°æ®ä¸ä¸€è‡´äº† ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620470144,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1575571,"avatar":"https://static001.geekbang.org/account/avatar/00/18/0a/93/a189ec16.jpg","nickname":"Eric","note":"","ucode":"7EB511C384BD7B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2448277,"avatar":"https://static001.geekbang.org/account/avatar/00/25/5b/95/462890c6.jpg","nickname":"å¶æ¶›","note":"","ucode":"B45348979BE159","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":405252,"discussion_content":"binlogæŒ‰é¡ºåºæ‰§è¡Œçš„ã€‚ã€‚å¦‚æœè¿é¡ºåºæ‰§è¡Œéƒ½ä¿è¯ä¸äº†ï¼Œé‚£å°±å…¨ä¹±å¥—äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634540947,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":372820,"ip_address":""},"score":405252,"extra":""},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2448277,"avatar":"https://static001.geekbang.org/account/avatar/00/25/5b/95/462890c6.jpg","nickname":"å¶æ¶›","note":"","ucode":"B45348979BE159","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588441,"discussion_content":"ä½ è¯´çš„è¿™ç§æƒ…å†µrräº‹åŠ¡çº§åˆ«ä¼šé€šè¿‡é—´éš™é”ä¿è¯å‡ºç°å†²çªçš„äº‹åŠ¡æ‰§è¡Œé¡ºåºå’Œäº‹åŠ¡æäº¤é¡ºåºä¸€è‡´ï¼›","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1663761586,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":372820,"ip_address":"å¹¿ä¸œ"},"score":588441,"extra":""}]}]},{"had_liked":false,"id":121399,"user_name":"é’±","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1565134327,"is_pvip":false,"replies":[{"id":"44650","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":121399,"uid":"1264162","ip_address":"","utype":1,"ctime":1565157626,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"229198401015","product_id":100020801,"comment_content":"æœ€å–œæ¬¢è¿™æ ·çš„æ–‡ç« ï¼Œä»¥ä¸ºæ¯”è¾ƒç®€å•å’Œç†Ÿæ‚‰ï¼Œä¹Ÿèƒ½æ‰“å¼€ä¸€æ‰‡çª—ï¼Œè®©äººçœ‹åˆ°ä¸€ä¸ªä¸åŒçš„ä¸–ç•Œï¼Œå¹¶ä¸”æ— æ¯”ä¸°å¯Œå¤šå½©ã€‚<br>åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹è‡ªå¢ä¸»é”®å¯èƒ½ä¸è¿ç»­ï¼Ÿ<br>1ï¼šå”¯ä¸€é”®å†²çª<br>2ï¼šäº‹åŠ¡å›æ»š<br>3ï¼šè‡ªå¢ä¸»é”®çš„æ‰¹é‡ç”³è¯·<br>æ·±å±‚æ¬¡åŸå› æ˜¯ï¼Œä¸åˆ¤æ–­è‡ªå¢ä¸»é”®æ˜¯å¦å·²å­˜åœ¨å’Œå‡å°‘åŠ é”çš„æ—¶é—´èŒƒå›´å’Œç²’åº¦-&gt;ä¸ºäº†æ›´é«˜çš„æ€§èƒ½-&gt;è‡ªå¢ä¸»é”®ä¸èƒ½å›é€€-&gt;è‡ªå¢ä¸»é”®ä¸è¿ç»­<br>è‡ªå¢ä¸»é”®æ˜¯æ€ä¹ˆåšçš„å”¯ä¸€æ€§çš„ï¼Ÿ<br>è‡ªå¢å€¼åŠ 1ï¼Œè‡ªå¢é”æ§åˆ¶å¹¶å‘<br>è‡ªå¢ä¸»é”®çš„ç”Ÿæˆæ€§èƒ½å¦‚ä½•ï¼Ÿ<br>è¿™ä¸ªéœ€è¦æµ‹è¯•ä¸€ä¸‹ï¼Œæ•°æ®åº“çš„è‡ªå¢ä¸»é”®ä¹Ÿç”¨åšç”Ÿæˆå”¯ä¸€æ•°å­—ï¼Œä½œä¸ºå…¶ä»–å•å·ï¼Œæ¯”å¦‚ï¼šå¹¶å‘é‡å°çš„è®¢å•å·ï¼Œæ€§èƒ½å¯èƒ½ä¸€èˆ¬ã€‚<br>è‡ªå¢ä¸»é”®æœ‰æœ€å¤§å€¼å˜›ï¼Ÿå¦‚æœæœ‰ï¼Œåˆ°äº†å’‹å¼„ï¼Ÿ<br>æœ€å¤§å€¼åº”è¯¥æœ‰ï¼Œå› ä¸ºæ•°å­—æ€»æœ‰ä¸ªèŒƒå›´ï¼Œåˆ°äº†å½“åšå­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ï¼Œç„¶åå†è‡ªå¢æ‹¼æ¥ä¸Šå¦ä¸€éƒ¨åˆ†ï¼Œè²Œä¼¼ä¹Ÿå¯ä»¥ã€‚<br>è‡ªå¢ä¸»é”®çš„ä½œç”¨ï¼Ÿä¿å­˜æœºåˆ¶ï¼Ÿä¿®æ”¹æœºåˆ¶ï¼Ÿ<br>ä½œç”¨ï¼šè®©ä¸»é”®ç´¢å¼•å°½é‡åœ°ä¿æŒé€’å¢é¡ºåºæ’å…¥ï¼Œé¿å…é¡µåˆ†è£‚ï¼Œä½¿ç´¢å¼•æ›´ç´§å‡‘ã€‚<br>ä¿å­˜æœºåˆ¶ï¼šä¸åŒçš„å­˜å‚¨å¼•æ“ä¸ä¸€æ ·ã€‚<br>MyISAM å¼•æ“çš„è‡ªå¢å€¼ä¿å­˜åœ¨æ•°æ®æ–‡ä»¶ä¸­ã€‚<br>InnoDB å¼•æ“çš„è‡ªå¢å€¼ï¼Œå…ˆæ˜¯ä¿å­˜åœ¨äº†å†…å­˜é‡Œï¼Œåˆ°äº† MySQL 8.0 ç‰ˆæœ¬åï¼Œæ‰æœ‰äº†â€œè‡ªå¢å€¼æŒä¹…åŒ–â€çš„èƒ½åŠ›ï¼Œæ”¾åœ¨äº†redologé‡Œã€‚<br>ä¿®æ”¹æœºåˆ¶ï¼š<br>åœ¨ MySQL é‡Œé¢ï¼Œå¦‚æœå­—æ®µ id è¢«å®šä¹‰ä¸º AUTO_INCREMENTï¼Œåœ¨æ’å…¥ä¸€è¡Œæ•°æ®çš„æ—¶å€™ï¼Œè‡ªå¢å€¼çš„è¡Œä¸ºå¦‚ä¸‹ï¼š<br>1ï¼šå¦‚æœæ’å…¥æ•°æ®æ—¶ id å­—æ®µæŒ‡å®šä¸º 0ã€null æˆ–æœªæŒ‡å®šå€¼ï¼Œé‚£ä¹ˆå°±æŠŠè¿™ä¸ªè¡¨å½“å‰çš„ AUTO_INCREMENT å€¼å¡«åˆ°è‡ªå¢å­—æ®µï¼›<br>2ï¼šå¦‚æœæ’å…¥æ•°æ®æ—¶ id å­—æ®µæŒ‡å®šäº†å…·ä½“çš„å€¼ï¼Œå°±ç›´æ¥ä½¿ç”¨è¯­å¥é‡ŒæŒ‡å®šçš„å€¼ã€‚<br><br>æ ¹æ®è¦æ’å…¥çš„å€¼å’Œå½“å‰è‡ªå¢å€¼çš„å¤§å°å…³ç³»ï¼Œè‡ªå¢å€¼çš„å˜æ›´ç»“æœä¹Ÿä¼šæœ‰æ‰€ä¸åŒã€‚å‡è®¾ï¼ŒæŸæ¬¡è¦æ’å…¥çš„å€¼æ˜¯ Xï¼Œå½“å‰çš„è‡ªå¢å€¼æ˜¯ Yã€‚<br>1ï¼šå¦‚æœ X&lt;Yï¼Œé‚£ä¹ˆè¿™ä¸ªè¡¨çš„è‡ªå¢å€¼ä¸å˜ï¼›<br>2ï¼šå¦‚æœ Xâ‰¥Yï¼Œå°±éœ€è¦æŠŠå½“å‰è‡ªå¢å€¼ä¿®æ”¹ä¸ºæ–°çš„è‡ªå¢å€¼ã€‚","like_count":54,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461775,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565157626,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":101090,"user_name":"Nomius","can_delete":false,"product_type":"c1","uid":1239274,"ip_address":"","ucode":"68FBF07180BCA9","user_header":"https://static001.geekbang.org/account/avatar/00/12/e8/ea/a4568138.jpg","comment_is_top":false,"comment_ctime":1559714814,"is_pvip":false,"replies":[{"id":"36730","content":"1. æ˜¯çš„<br>2. æˆ‘è§‰å¾—æœ€åˆçš„ä¸€ä¸ªåŸå› æ˜¯ï¼Œç”±äºä»¥å‰ï¼ˆ8.0ç‰ˆæœ¬å‰ï¼‰è‡ªå¢ä¸»é”®å€¼æ˜¯ä¸æŒä¹…åŒ–çš„ï¼Œåªæ”¾åœ¨å†…å­˜é‡Œé¢ã€‚æ¯æ¬¡é‡å¯åï¼Œé‡æ–°æ‰“å¼€è¡¨æ—¶ï¼Œéœ€è¦è®¡ç®—â€œè‡ªå¢å­—æ®µé‡Œé¢çš„æœ€å¤§å€¼â€ï¼Œç„¶ååŠ 1ï¼Œä½œä¸ºå½“å‰çš„autoincrementçš„å€¼ã€‚<br>å¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œç®—è¿™ä¸ªå€¼å°±è¦åšå…¨è¡¨æ‰«æï¼Œæ€§èƒ½å¯èƒ½å¾ˆå·®ï¼Œå½±å“è®¿é—®è¡¨çš„é€Ÿåº¦ã€‚<br>å¥½é—®é¢˜ã€‚ä¸è¿‡è¿™ä¸ªåªæ˜¯æˆ‘ä¸ªäººçŒœæµ‹ï¼Œä¹Ÿå¯èƒ½è¿˜æœ‰åˆ«çš„åŸå› ã€‚ğŸ˜†","user_name":"ä½œè€…å›å¤","comment_id":101090,"uid":"1264162","ip_address":"","utype":1,"ctime":1560041332,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":2,"race_medal":0,"score":"212013112318","product_id":100020801,"comment_content":"ä¸çŸ¥é“è€å¸ˆè¿˜å…³ä¸å…³æ³¨. <br>(1)é—®ä¸€ä¸‹ä¸ºä»€ä¹ˆä¸€å¼ è¡¨ä¸Šé¢åªèƒ½æœ‰ä¸€ä¸ªè‡ªå¢çš„å­—æ®µ?  (è¿™ä¸ªå¤§æ¦‚èƒ½ä»æ–‡ç« ä¸­åˆ†æå‡ºæ¥,å› ä¸ºautoincrementæ˜¯å®šä¹‰åœ¨è¡¨ç»“æ„ä¸­,å¦‚æœæœ‰å¤šä¸ªçš„è¯å®ç°è‡ªå¢çš„æ—¶å€™é€»è¾‘å¤ªå¤æ‚äº†)<br>(2)ä¸ºä»€ä¹ˆè‡ªå¢çš„å­—æ®µä¸Šé¢å¿…é¡»è¦æœ‰ç´¢å¼•?  ","like_count":50,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452800,"discussion_content":"1. æ˜¯çš„\n2. æˆ‘è§‰å¾—æœ€åˆçš„ä¸€ä¸ªåŸå› æ˜¯ï¼Œç”±äºä»¥å‰ï¼ˆ8.0ç‰ˆæœ¬å‰ï¼‰è‡ªå¢ä¸»é”®å€¼æ˜¯ä¸æŒä¹…åŒ–çš„ï¼Œåªæ”¾åœ¨å†…å­˜é‡Œé¢ã€‚æ¯æ¬¡é‡å¯åï¼Œé‡æ–°æ‰“å¼€è¡¨æ—¶ï¼Œéœ€è¦è®¡ç®—â€œè‡ªå¢å­—æ®µé‡Œé¢çš„æœ€å¤§å€¼â€ï¼Œç„¶ååŠ 1ï¼Œä½œä¸ºå½“å‰çš„autoincrementçš„å€¼ã€‚\nå¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œç®—è¿™ä¸ªå€¼å°±è¦åšå…¨è¡¨æ‰«æï¼Œæ€§èƒ½å¯èƒ½å¾ˆå·®ï¼Œå½±å“è®¿é—®è¡¨çš„é€Ÿåº¦ã€‚\nå¥½é—®é¢˜ã€‚ä¸è¿‡è¿™ä¸ªåªæ˜¯æˆ‘ä¸ªäººçŒœæµ‹ï¼Œä¹Ÿå¯èƒ½è¿˜æœ‰åˆ«çš„åŸå› ã€‚ğŸ˜†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560041332,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1188023,"avatar":"https://static001.geekbang.org/account/avatar/00/12/20/b7/bdb3bcf0.jpg","nickname":"Eternal","note":"","ucode":"EA6FE7CC98F740","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":399048,"discussion_content":"ä¸€ä¸ªè¡¨ä¸ºä»€ä¹ˆä¸èƒ½æœ‰è¿ä¸ªè‡ªå¢é•¿å­—æ®µ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632895119,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":67050,"user_name":"å¸½å­æ‰äº†","can_delete":false,"product_type":"c1","uid":1174781,"ip_address":"","ucode":"344892D6136346","user_header":"https://static001.geekbang.org/account/avatar/00/11/ec/fd/bad2abf5.jpg","comment_is_top":false,"comment_ctime":1550062158,"is_pvip":false,"replies":[{"id":"23800","content":"å¥½é—®é¢˜ï¼Œä¸ä¼š<br>å› ä¸ºbinlogåœ¨è®°å½•è¿™ç§å¸¦è‡ªå¢å€¼çš„è¯­å¥ä¹‹å‰ï¼Œä¼šåœ¨å‰é¢å¤šä¸€å¥ï¼Œç”¨äºæŒ‡å®šâ€œæ¥ä¸‹æ¥è¿™ä¸ªè¯­å¥è¦éœ€è¦çš„ è‡ªå¢IDå€¼æ˜¯å¤šå°‘â€ï¼Œè€Œè¿™ä¸ªå€¼ï¼Œæ˜¯åœ¨ä¸»åº“ä¸Šè¿™ä¸€è¡Œæ’å…¥æˆåŠŸåå¯¹åº”çš„è‡ªå¢å€¼ï¼Œæ‰€ä»¥æ˜¯ä¸€è‡´çš„","user_name":"ä½œè€…å›å¤","comment_id":67050,"uid":"1264162","ip_address":"","utype":1,"ctime":1550127517,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":8,"race_medal":0,"score":"169053786702","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæˆ‘æœ‰ä¸€ä¸ªæ—¶åºé—®é¢˜ï¼Œæƒ³è¯·æ•™ä¸€ä¸‹ã€‚<br>ä»è¿™ç¯‡æ–‡ç« çš„ä»‹ç»æ¥çœ‹ï¼Œè·å–è‡ªå¢idå’Œå†™binlogæ˜¯æœ‰å…ˆåé¡ºåºçš„ã€‚<br>é‚£ä¹ˆåœ¨binlogä¸ºstatementçš„æƒ…å†µä¸‹ã€‚<br>è¯­å¥Aå…ˆè·å–id=1ï¼Œç„¶åBè·å–id=2ï¼Œæ¥ç€Bæäº¤ï¼Œå†™binlogï¼Œå†Aå†™binlogã€‚<br>è¿™ä¸ªæ—¶å€™å¦‚æœbinlogé‡æ”¾ï¼Œæ˜¯ä¸æ˜¯ä¼šå‘ç”ŸBçš„idä¸º1ï¼Œè€ŒAçš„idä¸º2çš„ä¸ä¸€è‡´çš„æƒ…å†µï¼Ÿ","like_count":40,"discussions":[{"author":{"id":1514623,"avatar":"https://static001.geekbang.org/account/avatar/00/17/1c/7f/8b421ebb.jpg","nickname":"å‘å‰","note":"","ucode":"4DD08BF0CD6B78","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":60874,"discussion_content":"åœ¨binlog_format=STATEMENT æ—¶ï¼Œå¯¹äº&#34;simple insert&#34; è¯­å¥binlogä¸­ä¼šè®°å½•è¯¥è¯­å¥æ’å…¥çš„è‡ªå¢iå€¼ã€‚å¦‚ä¸‹ï¼šSET INSERT_ID=4/*!*/;ã€‚å¯¹äº&#34;Bulk insert&#34;binlogä¸­ä¼šè®°å½•è¯¥è¯­å¥ç”¨åˆ°çš„ç¬¬ä¸€ä¸ªè‡ªå¢å€¼","likes_number":11,"is_delete":false,"is_hidden":false,"ctime":1574761570,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1189225,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIlRVTQ1mpTLY34BAje4xRY0PFSJk6J1su2jicrtEQASP3DakQ7lQkWZNADoh8mLibwATLJB9EMrIVQ/132","nickname":"Z","note":"","ucode":"C199B14177A951","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1514623,"avatar":"https://static001.geekbang.org/account/avatar/00/17/1c/7f/8b421ebb.jpg","nickname":"å‘å‰","note":"","ucode":"4DD08BF0CD6B78","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":304659,"discussion_content":"è¿™æ ·çš„è¯ï¼Œå›¾4åœºæ™¯ï¼Œä»åº“æ¶ˆè´¹çš„æ—¶å€™ä¼šä¸ä¼šäº§ç”Ÿä¸»é”®å†²çªï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599636704,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":60874,"ip_address":""},"score":304659,"extra":""},{"author":{"id":1526355,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","nickname":"moonfox","note":"","ucode":"902BFF40EFA9FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1189225,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIlRVTQ1mpTLY34BAje4xRY0PFSJk6J1su2jicrtEQASP3DakQ7lQkWZNADoh8mLibwATLJB9EMrIVQ/132","nickname":"Z","note":"","ucode":"C199B14177A951","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":335293,"discussion_content":"é‚£ä¸ªæ˜¯å‡è®¾ï¼Œå‡è®¾æ‰¹é‡æ’å…¥æ—¶ï¼Œidè¢«æ‰“æ’’ï¼Œäº§ç”Ÿäº†ä¸è¿ç»­çš„æƒ…å†µã€‚çœŸå®æƒ…å†µæ˜¯æ‰¹é‡æ’å…¥æ—¶ï¼Œidéƒ½æ˜¯è¿ç»­çš„ï¼ŒåˆåŒæ—¶è®°å½•äº†insertçš„åˆå§‹å€¼ï¼Œæ‰€ä»¥æ— è®ºæ˜¯å…ˆæ‰§è¡Œè°ï¼Œéƒ½å¯ä»¥ä¿è¯ä¸»å¤‡ä¸€è‡´çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608142509,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":304659,"ip_address":""},"score":335293,"extra":""}]},{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439029,"discussion_content":"å¥½é—®é¢˜ï¼Œä¸ä¼š\nå› ä¸ºbinlogåœ¨è®°å½•è¿™ç§å¸¦è‡ªå¢å€¼çš„è¯­å¥ä¹‹å‰ï¼Œä¼šåœ¨å‰é¢å¤šä¸€å¥ï¼Œç”¨äºæŒ‡å®šâ€œæ¥ä¸‹æ¥è¿™ä¸ªè¯­å¥è¦éœ€è¦çš„ è‡ªå¢IDå€¼æ˜¯å¤šå°‘â€ï¼Œè€Œè¿™ä¸ªå€¼ï¼Œæ˜¯åœ¨ä¸»åº“ä¸Šè¿™ä¸€è¡Œæ’å…¥æˆåŠŸåå¯¹åº”çš„è‡ªå¢å€¼ï¼Œæ‰€ä»¥æ˜¯ä¸€è‡´çš„","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1550127517,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1476588,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJayib1ZcRfOaoLsdsWZokiaO5tLAdC4uNAicQJRIVXrz9fIchib7QwXibnRrsJaoh5TUlia7faUf36g8Bw/132","nickname":"æ˜æœˆ","note":"","ucode":"D3C649B954A519","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":46012,"discussion_content":"æˆ‘ä¹Ÿä¸ç†è§£ å‰é¢ä¸æ˜¯è¯´ä¼šä¸ä¸€è‡´ æ‰€ä»¥é‡‡ç”¨è®°å½•æ“ä½œè®°å½•å’Œè®¾ç½®binlogçš„æ ¼å¼ä¸ºrowidæ¥é¿å…å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573110992,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1210699,"avatar":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","nickname":"-W.LI-","note":"","ucode":"3556786538664F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":20067,"discussion_content":" æ²¡æ˜ç™½å•Šï¼Œè¿™ä¸ªæ²¡é—®é¢˜çš„è¯ï¼Œinsert select ï¼Œ+statementä¸ºå•¥å°±ä¼šå‡ºç°ä¸»é”®ä¸»å¤‡ä¸ä¸€è‡´å‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569253531,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1306086,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/e6/320eb55f.jpg","nickname":"Lomy","note":"","ucode":"2D1B9EC8565034","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1210699,"avatar":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","nickname":"-W.LI-","note":"","ucode":"3556786538664F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368725,"discussion_content":"å› ä¸ºstatementè®°å½•çš„æ˜¯åŸå§‹è¯­å¥ï¼Œå¹¶ä¸ä¼šè®°å½•ä¸»åº“åˆ†é…çš„è‡ªå¢å€¼ï¼Œå¤‡åº“åœ¨åº”ç”¨æ—¶ä¼šè‡ªè¡Œé‡æ–°åˆ†é…è‡ªå¢å€¼å§ï¼Œæ‰€ä»¥æ‰è¯´è¦åŠ é”æ‰¹é‡è·å–è¿ç»­çš„è‡ªå¢IDï¼Œå¦‚æœæ˜¯ROWæ¨¡å¼å°±ä¼šè®°å½•ä¸»åº“åˆ†é…çš„è‡ªå¢å€¼","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1618818892,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":20067,"ip_address":""},"score":368725,"extra":""},{"author":{"id":1657304,"avatar":"https://static001.geekbang.org/account/avatar/00/19/49/d8/533b1968.jpg","nickname":"ç‹æ³½","note":"","ucode":"726A5F21BE7390","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1210699,"avatar":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","nickname":"-W.LI-","note":"","ucode":"3556786538664F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540041,"discussion_content":"è¯„è®ºè¿™é‡Œè¯´çš„æ˜¯æ€•é‡æ”¾ binlog æ—¶çš„é¡ºåºä¸ä¸€è‡´å¯¼è‡´ id ä¸ä¸€è‡´ï¼Œæ–‡ç« é‡Œè¯´çš„æ˜¯ä¸»åº“çš„äº‹åŠ¡è¿ç»­æ‹¿åˆ°çš„è‡ªå¢ id è·Ÿå¤‡åº“åŒä¸€ä¸ªäº‹åŠ¡é‡æ”¾ binlog æ—¶è¿ç»­æ‹¿åˆ°çš„è‡ªå¢ id ä¸ä¸€è‡´","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639925495,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":20067,"ip_address":""},"score":540041,"extra":""}]}]},{"had_liked":false,"id":66571,"user_name":"aliang","can_delete":false,"product_type":"c1","uid":1149502,"ip_address":"","ucode":"B36B94B362477F","user_header":"https://static001.geekbang.org/account/avatar/00/11/8a/3e/30c05bce.jpg","comment_is_top":false,"comment_ctime":1549960480,"is_pvip":true,"replies":[{"id":"23582","content":"â€œï¼ˆæ—¶é—´+ä¸šåŠ¡+æœºå™¨+åºåˆ—ï¼Œbigintç±»å‹ï¼Œå®é™…é•¿åº¦æœ‰17ä½ï¼Œå…¶ä¸­åºåˆ—ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæ¯æ¬¡é€’å¢ï¼Œä¸»é”®å€¼ä¸è¿ç»­ï¼‰ã€‚â€ ----bigintå°±æ˜¯8ä½ï¼Œè¿™ä¸ªä½ éœ€è¦ç¡®å®šä¸€ä¸‹ã€‚å¦‚æœæ˜¯8ä½çš„è¿˜å¥½ï¼Œå¦‚æœæ˜¯17ä½çš„å­—ç¬¦ä¸²ï¼Œå°±æ¯”è¾ƒè€—è´¹ç©ºé—´ï¼›<br><br>ï¼ˆ1ï¼‰å¦‚æœâ€œåºåˆ—â€æ˜¯é€’å¢çš„ï¼Œè¿˜æ˜¯ä¸èƒ½ç›´æ¥ç”¨æ¥ä½“ç°ä¸šåŠ¡é€»è¾‘å§ï¼Ÿ åˆ›å»ºæœ‰ä¸šåŠ¡æ„ä¹‰çš„å­—æ®µç´¢å¼•ä¼°è®¡è¿˜æ˜¯çœä¸äº†çš„ ï¼Ÿ<br>ï¼ˆ2ï¼‰mysqlç¡®å®åšä¸åˆ°â€œæ’å…¥ä¹‹å‰å°±å…ˆç®—å¥½æ¥ä¸‹æ¥çš„idæ˜¯å¤šå°‘â€ï¼Œä¸€èˆ¬éƒ½æ˜¯insertæ‰§è¡Œå®Œæˆåï¼Œå†æ‰§è¡Œselect last_insert_id<br> (3) å…ˆinsert aå†update bå†update aï¼Œç¡®å®çœ‹ä¸Šå»æ¯”è¾ƒå¥‡æ€ªï¼Œä¸è¿‡æ„Ÿè§‰è¿™ä¸ªé€»è¾‘åº”è¯¥æ˜¯å¯ä»¥ä¼˜åŒ–çš„ï¼Œä¸åº”è¯¥ä½œä¸ºâ€œä¸»é”®é€‰æ‹©â€çš„ä¸€ä¸ªä¾æ®ã€‚ä½ å¯å¦è„±æ•ä¸€ä¸‹ï¼ŒæŠŠæ¨¡æ‹Ÿçš„è¡¨ç»“æ„å’Œä¸šåŠ¡é€»è¾‘è¯´ä¸‹ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯å¯ä»¥ä¼˜åŒ–çš„ã€‚<br><br>æ€»ä¹‹ï¼ŒæŒ‰ç…§ä½ è¯´çš„â€œæ—¶é—´+ä¸šåŠ¡+æœºå™¨+åºåˆ—â€è¿™ç§æ¨¡å¼ï¼Œæœ‰ç‚¹åƒç”¨uuidï¼Œä¸»è¦çš„é—®é¢˜è¿˜æ˜¯ï¼Œå¦‚æœè¿™ä¸ªè¡¨çš„ç´¢å¼•å¤šï¼Œå ç”¨çš„ç©ºé—´æ¯”è¾ƒå¤§","user_name":"ä½œè€…å›å¤","comment_id":66571,"uid":"1264162","ip_address":"","utype":1,"ctime":1549979118,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":4,"race_medal":0,"score":"74564404512","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæˆ‘ä»¬è¿™è¾¹æœ‰çš„å¼€å‘ä¸å–œæ¬¢ç”¨mysqlè‡ªå¸¦çš„ä¸»é”®è‡ªå¢åŠŸèƒ½ï¼Œè€Œæ˜¯åœ¨ç¨‹åºä¸­æ§åˆ¶ä¸»é”®ï¼ˆæ—¶é—´+ä¸šåŠ¡+æœºå™¨+åºåˆ—ï¼Œbigintç±»å‹ï¼Œå®é™…é•¿åº¦æœ‰17ä½ï¼Œå…¶ä¸­åºåˆ—ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæ¯æ¬¡é€’å¢ï¼Œä¸»é”®å€¼ä¸è¿ç»­ï¼‰ã€‚ç†ç”±æ˜¯<br>ï¼ˆ1ï¼‰é€šè¿‡è¿™æ ·çš„ä¸»é”®å¯ä»¥ç›´æ¥å®šä½æ•°æ®ï¼Œå‡å°‘ç´¢å¼•ï¼ˆ2ï¼‰å¦‚æœè‡ªå¢ï¼Œå¿…é¡»å…ˆå­˜æ•°æ®å¾—åˆ°ä¸»é”®æ‰å¯ç»§ç»­ä¸‹é¢çš„ç¨‹åºï¼Œå¦‚æœè‡ªå·±è®¡ç®—ä¸»é”®ï¼Œå¯ä»¥åœ¨å…¥åº“å‰è¿›è¡Œå¼‚æ­¥å¤„ç†<br>ï¼ˆ3ï¼‰aè¡¨è¦insertå¾—åˆ°ä¸»é”®ï¼Œç„¶åå¤„ç†bè¡¨ï¼Œç„¶åæ ¹æ®æ¡ä»¶è¿˜è¦update aè¡¨ã€‚å¦‚æœç¨‹åºè‡ªå·±æ§åˆ¶ï¼Œå°±ä¸ç”¨å…ˆinsert aè¡¨ï¼Œæ•°æ®å¯ä»¥åœ¨å†…å­˜ä¸­ï¼Œç›´åˆ°æœ€åä¸€æ¬¡æäº¤ã€‚ï¼ˆå¯¹äºaè¡¨ï¼Œæœ¬æ¥æ˜¯insert+updateï¼Œæœ€ååªæ˜¯ä¸€æ¡insertï¼Œå°‘ä¸€æ¬¡æ•°æ®åº“æ“ä½œï¼‰<br>æˆ‘æƒ³è¯·é—®çš„æ˜¯ï¼š<br>ï¼ˆ1ï¼‰é’ˆå¯¹ç†ç”±1ï¼Œæ˜¯å¦å¯ä»¥ç”¨ç»„åˆç´¢å¼•æ›¿ä»£ï¼Ÿ<br>ï¼ˆ2ï¼‰é’ˆå¯¹ç†ç”±2ï¼Œæ˜¯å¦mysqlè‡ªèº«çš„ä¸»é”®è‡ªå¢åˆ†é…é€»è¾‘å°±å·²ç»èƒ½å®ç°äº†ï¼Ÿ<br>ï¼ˆ3ï¼‰é’ˆå¯¹ç†ç”±3ï¼Œä¸»é”®æ›´é•¿æ„å‘³ç€æ›´å¤§çš„ç´¢å¼•ï¼ˆä¸»é”®ç´¢å¼•å’Œæ™®é€šç´¢å¼•ï¼‰ï¼Œä½ è§‰å¾—æ€æ ·åšä¼šæ›´å¥½å‘¢","like_count":18,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438840,"discussion_content":"â€œï¼ˆæ—¶é—´+ä¸šåŠ¡+æœºå™¨+åºåˆ—ï¼Œbigintç±»å‹ï¼Œå®é™…é•¿åº¦æœ‰17ä½ï¼Œå…¶ä¸­åºåˆ—ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæ¯æ¬¡é€’å¢ï¼Œä¸»é”®å€¼ä¸è¿ç»­ï¼‰ã€‚â€ ----bigintå°±æ˜¯8ä½ï¼Œè¿™ä¸ªä½ éœ€è¦ç¡®å®šä¸€ä¸‹ã€‚å¦‚æœæ˜¯8ä½çš„è¿˜å¥½ï¼Œå¦‚æœæ˜¯17ä½çš„å­—ç¬¦ä¸²ï¼Œå°±æ¯”è¾ƒè€—è´¹ç©ºé—´ï¼›\n\nï¼ˆ1ï¼‰å¦‚æœâ€œåºåˆ—â€æ˜¯é€’å¢çš„ï¼Œè¿˜æ˜¯ä¸èƒ½ç›´æ¥ç”¨æ¥ä½“ç°ä¸šåŠ¡é€»è¾‘å§ï¼Ÿ åˆ›å»ºæœ‰ä¸šåŠ¡æ„ä¹‰çš„å­—æ®µç´¢å¼•ä¼°è®¡è¿˜æ˜¯çœä¸äº†çš„ ï¼Ÿ\nï¼ˆ2ï¼‰mysqlç¡®å®åšä¸åˆ°â€œæ’å…¥ä¹‹å‰å°±å…ˆç®—å¥½æ¥ä¸‹æ¥çš„idæ˜¯å¤šå°‘â€ï¼Œä¸€èˆ¬éƒ½æ˜¯insertæ‰§è¡Œå®Œæˆåï¼Œå†æ‰§è¡Œselect last_insert_id\n (3) å…ˆinsert aå†update bå†update aï¼Œç¡®å®çœ‹ä¸Šå»æ¯”è¾ƒå¥‡æ€ªï¼Œä¸è¿‡æ„Ÿè§‰è¿™ä¸ªé€»è¾‘åº”è¯¥æ˜¯å¯ä»¥ä¼˜åŒ–çš„ï¼Œä¸åº”è¯¥ä½œä¸ºâ€œä¸»é”®é€‰æ‹©â€çš„ä¸€ä¸ªä¾æ®ã€‚ä½ å¯å¦è„±æ•ä¸€ä¸‹ï¼ŒæŠŠæ¨¡æ‹Ÿçš„è¡¨ç»“æ„å’Œä¸šåŠ¡é€»è¾‘è¯´ä¸‹ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯å¯ä»¥ä¼˜åŒ–çš„ã€‚\n\næ€»ä¹‹ï¼ŒæŒ‰ç…§ä½ è¯´çš„â€œæ—¶é—´+ä¸šåŠ¡+æœºå™¨+åºåˆ—â€è¿™ç§æ¨¡å¼ï¼Œæœ‰ç‚¹åƒç”¨uuidï¼Œä¸»è¦çš„é—®é¢˜è¿˜æ˜¯ï¼Œå¦‚æœè¿™ä¸ªè¡¨çš„ç´¢å¼•å¤šï¼Œå ç”¨çš„ç©ºé—´æ¯”è¾ƒå¤§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549979118,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1325297,"avatar":"https://static001.geekbang.org/account/avatar/00/14/38/f1/996a070d.jpg","nickname":"LW","note":"","ucode":"89820332658E98","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":205851,"discussion_content":"æœ€çƒ¦ç”¨uuidåšä¸»é”®çš„","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1584350413,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1320727,"avatar":"https://static001.geekbang.org/account/avatar/00/14/27/17/be14b93e.jpg","nickname":"Mike","note":"","ucode":"7172D06E3BA75B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2943,"discussion_content":"æˆ‘ä»¬ä¸šåŠ¡ç›´æ¥ç”¨uuid char(32)çš„ï¼Œæˆ‘è¡¨ç¤ºæƒ³æ­»äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564051725,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1320727,"avatar":"https://static001.geekbang.org/account/avatar/00/14/27/17/be14b93e.jpg","nickname":"Mike","note":"","ucode":"7172D06E3BA75B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588461,"discussion_content":"ç”¨uuidè¿˜ä¸å¦‚ç›´æ¥ç”¨é›ªèŠ±ã€‚å•è°ƒè‡ªå¢è¿˜ä¿è¯ç©ºé—´å”¯ä¸€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663770630,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":2943,"ip_address":"å¹¿ä¸œ"},"score":588461,"extra":""}]}]},{"had_liked":false,"id":67469,"user_name":"Ryoma","can_delete":false,"product_type":"c1","uid":1130590,"ip_address":"","ucode":"7F692369239692","user_header":"https://static001.geekbang.org/account/avatar/00/11/40/5e/b8fada94.jpg","comment_is_top":false,"comment_ctime":1550154083,"is_pvip":true,"replies":[{"id":"24001","content":"ğŸ‘ å¤§åŠ¿æ‰€è¶‹ğŸ˜†","user_name":"ä½œè€…å›å¤","comment_id":67469,"uid":"1264162","ip_address":"","utype":1,"ctime":1550298513,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":2,"score":"70269630819","product_id":100020801,"comment_content":"åœ¨8.0.3ç‰ˆæœ¬åï¼Œinnodb_autoinc_lock_modeé»˜è®¤å€¼å·²æ˜¯2ï¼Œåœ¨binlog_formaté»˜è®¤å€¼ä¸ºrowçš„å‰æä¸‹ï¼Œæƒ³æ¥ä¹Ÿæ˜¯ä¸ºäº†å¢åŠ å¹¶å‘ã€‚ <br><br>https:&#47;&#47;dev.mysql.com&#47;doc&#47;refman&#47;8.0&#47;en&#47;innodb-parameters.html#sysvar_innodb_autoinc_lock_mode","like_count":17,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439213,"discussion_content":"ğŸ‘ å¤§åŠ¿æ‰€è¶‹ğŸ˜†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550298513,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":75149,"user_name":"è¿›é˜¶çš„ç å†œ","can_delete":false,"product_type":"c1","uid":1017821,"ip_address":"","ucode":"D8991282640334","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/dd/4f53f95d.jpg","comment_is_top":false,"comment_ctime":1552358619,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"23027195099","product_id":100020801,"comment_content":"è¯¾åé¢˜<br>åœ¨æœ€åä¸€ä¸ªä¾‹å­ä¸­ï¼Œæ‰§è¡Œ insert into t2(c,d) select c,d from t; è¿™ä¸ªè¯­å¥çš„æ—¶å€™ï¼Œå¦‚æœéš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰ï¼Œbinlog_format=statementä¼šåŠ è®°å½•é”å’Œé—´éš™é”ã€‚å•¥æˆ‘çš„binlog_format=rowä¹ŸåŠ é”äº†","like_count":5,"discussions":[{"author":{"id":1332557,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erbY9UsqHZhhVoI69yXNibBBg0TRdUVsKLMg2UZ1R3NJxXdMicqceI5yhdKZ5Ad6CJYO0XpFHlJzIYQ/132","nickname":"é¥­å›¢","note":"","ucode":"E24F240CC91BE8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":126819,"discussion_content":"æˆ‘è¯•äº†ä¸€ä¸‹ æˆ‘æ²¡æœ‰é” æˆ‘æ˜¯mysql5.7","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578540659,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":88135,"user_name":"Aaron_æ¶›","can_delete":false,"product_type":"c1","uid":1180617,"ip_address":"","ucode":"067F3CBB1F036C","user_header":"https://static001.geekbang.org/account/avatar/00/12/03/c9/9a9d82ab.jpg","comment_is_top":false,"comment_ctime":1555857093,"is_pvip":false,"replies":[{"id":"34324","content":"æ˜¯è¯´è‡ªå¢ä¸»é”®æ²¡æŒ‡å®šï¼Ÿ<br><br>ä¸¤ä¸ªè¯­å¥åˆ†åˆ«å»ç”³è¯·è‡ªå¢ä¸»é”®ï¼Œç”³è¯·åˆ°çš„å€¼æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥å¹¶ä¸å†²çª","user_name":"ä½œè€…å›å¤","comment_id":88135,"uid":"1264162","ip_address":"","utype":1,"ctime":1558261747,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"18735726277","product_id":100020801,"comment_content":"è€å¸ˆï¼Œèƒ½å¦‚æœä¸¤ä¸ªäº‹åŠ¡åŒæ—¶å¹¶å‘æ’å…¥ï¼Œä¸»é”®æ²¡æœ‰æŒ‡æ˜çš„è¯ï¼ŒåŠ é”çš„æƒ…å†µèƒ½è¯´æ˜ä¸‹å—","like_count":4,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447743,"discussion_content":"æ˜¯è¯´è‡ªå¢ä¸»é”®æ²¡æŒ‡å®šï¼Ÿ\n\nä¸¤ä¸ªè¯­å¥åˆ†åˆ«å»ç”³è¯·è‡ªå¢ä¸»é”®ï¼Œç”³è¯·åˆ°çš„å€¼æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥å¹¶ä¸å†²çª","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558261747,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":72897,"user_name":"hetiu","can_delete":false,"product_type":"c1","uid":1056127,"ip_address":"","ucode":"35D9338C3ABD20","user_header":"https://static001.geekbang.org/account/avatar/00/10/1d/7f/aabc1b66.jpg","comment_is_top":false,"comment_ctime":1551752323,"is_pvip":false,"replies":[{"id":"26695","content":"å…¨å±€çš„","user_name":"ä½œè€…å›å¤","comment_id":72897,"uid":"1264162","ip_address":"","utype":1,"ctime":1551876523,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"18731621507","product_id":100020801,"comment_content":"è€å¸ˆï¼Œè¯·é—®ä¸‹innodb_autoinc_lock_modeé…ç½®æ˜¯åº“çº§åˆ«çš„è¿˜æ˜¯å®ä¾‹çº§åˆ«çš„ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441814,"discussion_content":"å…¨å±€çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551876523,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":160598,"user_name":"å®ä»”","can_delete":false,"product_type":"c1","uid":1013493,"ip_address":"","ucode":"A0F17DFF99DB21","user_header":"https://static001.geekbang.org/account/avatar/00/0f/76/f5/e3f5bd8d.jpg","comment_is_top":false,"comment_ctime":1575982619,"is_pvip":true,"discussion_count":4,"race_medal":0,"score":"14460884507","product_id":100020801,"comment_content":"è€å¸ˆè¿™ç§æƒ…å†µ<br>insert into t (id,c,d) values (1,1,1),(2,2,2),(3,3,3),(null,4,4);<br>æˆ–è€…<br>insert into t (id,c,d) values (1,1,1),(null,2,2),(3,3,3),(null,4,4);<br>èƒ½è§£é‡Šä¸‹å—ï¼Ÿ<br>ç¬¬ä¸€ç§æƒ…å†µè‡ªå¢idå˜æˆ8äº†<br>ç¬¬äºŒç§æƒ…å†µè‡ªå¢idå˜æˆ6äº†","like_count":3,"discussions":[{"author":{"id":1026078,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/1e/0b124c05.jpg","nickname":"å†¥ç‹æ˜Ÿ","note":"","ucode":"995A56EF84E5F6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580259,"discussion_content":"ä¸æ˜¯çš„ è¿™ä¸ªå¯ä»¥å‚è€ƒå®˜æ–¹çš„æ–‡æ¡£ ä½ è¿™æ ·çš„insertå±äºmix mode insertï¼Œé»˜è®¤çš„ innodb_autoinc_lock_mode ä¸º1ï¼Œå½“æ‰§è¡Œçš„æ—¶å€™ä¼šä¸€æ¬¡ç”³è¯·4ä¸ªidï¼Œè™½ç„¶ç”¨ä¸æ‰ã€‚è¿˜æ˜¯ä¼šç”³è¯·å®Œï¼Œè¿™æ ·ä½ å°±çœ‹åˆ°ä¸€ä¸ª8,8=3+4+1.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658045808,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1609043,"avatar":"https://static001.geekbang.org/account/avatar/00/18/8d/53/0c5ec2bb.jpg","nickname":"è´¤å­ç£Š","note":"","ucode":"59B558C85045E4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373306,"discussion_content":"åŒé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620695182,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1327313,"avatar":"https://static001.geekbang.org/account/avatar/00/14/40/d1/fb6f402a.jpg","nickname":"melon","note":"","ucode":"AFBE9426C10AFA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":205070,"discussion_content":"ä½ è¿™ä¸ªé—®é¢˜ææ˜ç™½äº†å— ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584259703,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1367043,"avatar":"https://static001.geekbang.org/account/avatar/00/14/dc/03/ad9574b3.jpg","nickname":"ä¹ å…®ä¹ å…®","note":"","ucode":"E616E924188CBA","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1327313,"avatar":"https://static001.geekbang.org/account/avatar/00/14/40/d1/fb6f402a.jpg","nickname":"melon","note":"","ucode":"AFBE9426C10AFA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293500,"discussion_content":"for ${batch_insert} {\n\tif (tmp_ids.allUsed()) {\n\t\ttmp_ids = [cur_id, ..., 2*cur_id];\n\t}\n\tif (data.id == null || data.id == 0) {\n\t\tdata.id = tmp_ids.getNextId();\n\t} else {\n\t\tcur_id = data.id;\n\t\ttmp_ids.setEmpty();\n\t}\n\tinsert(data);\n}","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1595559821,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":205070,"ip_address":""},"score":293500,"extra":""}]}]},{"had_liked":false,"id":66364,"user_name":"ç‰›åœ¨å¤©ä¸Šé£","can_delete":false,"product_type":"c1","uid":1137660,"ip_address":"","ucode":"972DAF20F085ED","user_header":"https://static001.geekbang.org/account/avatar/00/11/5b/fc/5c24080b.jpg","comment_is_top":false,"comment_ctime":1549933208,"is_pvip":false,"replies":[{"id":"23580","content":"ä¹Ÿæ²¡å•¥ï¼Œä¸»è¦å°±æ˜¯ä¸å¥½ç®¡ç†ã€‚ã€‚<br>æ¯•ç«Ÿeventæ˜¯å†™åœ¨MySQLé‡Œçš„ï¼Œå†™ç¨‹åºçš„åŒå­¦ä¸ä¸€å®šä¼šè®°å¾—ã€‚<br>æ¯”è¾ƒå»ºè®®å°†è¿™ç±»é€»è¾‘å†™åœ¨åº”ç”¨ç¨‹åºé‡Œé¢","user_name":"ä½œè€…å›å¤","comment_id":66364,"uid":"1264162","ip_address":"","utype":1,"ctime":1549978302,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"14434835096","product_id":100020801,"comment_content":"è€å¸ˆï¼Œè¯·é—®äº§ç”Ÿå¤§é‡çš„eventäº‹ä»¶ä¼šå¯¹mysqlæœåŠ¡å™¨æœ‰ä»€ä¹ˆå½±å“ï¼Ÿä¸»è¦æ˜¯å“ªå‡ ä¸ªæ–¹é¢çš„å½±å“ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438789,"discussion_content":"ä¹Ÿæ²¡å•¥ï¼Œä¸»è¦å°±æ˜¯ä¸å¥½ç®¡ç†ã€‚ã€‚\næ¯•ç«Ÿeventæ˜¯å†™åœ¨MySQLé‡Œçš„ï¼Œå†™ç¨‹åºçš„åŒå­¦ä¸ä¸€å®šä¼šè®°å¾—ã€‚\næ¯”è¾ƒå»ºè®®å°†è¿™ç±»é€»è¾‘å†™åœ¨åº”ç”¨ç¨‹åºé‡Œé¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549978302,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":188168,"user_name":"mickey","can_delete":false,"product_type":"c1","uid":1051663,"ip_address":"","ucode":"8B490C2DDE4010","user_header":"https://static001.geekbang.org/account/avatar/00/10/0c/0f/93d1c8eb.jpg","comment_is_top":false,"comment_ctime":1584326093,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10174260685","product_id":100020801,"comment_content":"åœ¨è®² insert â€¦ select è¦ä½¿ç”¨è¯­å¥çº§çš„é” çš„ä¾‹å­æ—¶ï¼ŒSession Aå’ŒB æ˜¯ä¸æ˜¯è®²åäº†ï¼Ÿï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1887586,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLhicDSmL4vicPADhxxzOzukMar8nV5Tc3ic2dz4FQIxMX3WmX5a2V3sdD121eWpvfQI8NXIkkDZoDFw/132","nickname":"Geek_536b54","note":"","ucode":"F62BC7781D9212","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337170,"discussion_content":"ä»”ç»†é˜…è¯» æ²¡æœ‰å\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608812528,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":176871,"user_name":"yihang","can_delete":false,"product_type":"c1","uid":1012361,"ip_address":"","ucode":"A5506F085D1793","user_header":"https://static001.geekbang.org/account/avatar/00/0f/72/89/1a83120a.jpg","comment_is_top":false,"comment_ctime":1581209618,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10171144210","product_id":100020801,"comment_content":"ä¸»é”® id å‡ºç°è‡ªå¢ id ä¸è¿ç»­çš„ç¬¬ä¸‰ç§åŸå›  æ²¡æœ‰å®éªŒå‡ºæ¥å•Šinnodb_autoinc_lock_mode=0ï¼Œ1ï¼Œ2 éƒ½è¯•äº†ï¼Œmysql ç‰ˆæœ¬æ˜¯8.0, æœ€åè‡ªå¢åˆ—è¿˜æ˜¯è¿ç»­çš„","like_count":2},{"had_liked":false,"id":75189,"user_name":"è¿›é˜¶çš„ç å†œ","can_delete":false,"product_type":"c1","uid":1017821,"ip_address":"","ucode":"D8991282640334","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/dd/4f53f95d.jpg","comment_is_top":false,"comment_ctime":1552361597,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10142296189","product_id":100020801,"comment_content":"ä¸ŠæœŸé—®é¢˜è§£ç­”ï¼Œæœ‰ç‚¹ç–‘é—®<br>set sql_log_bin=off;<br>alter table tbl_name engine=innodb;<br><br>ä¸ºä»€ä¹ˆå¤‡åº“éœ€è¦æ‰§è¡Œset sql_log_bin=offè¿™ä¸€å¥<br>æŠŠè¡¨çš„å¼•æ“æ”¹æˆinnodbä¸å°±èƒ½è§£å†³é‡å¯åå†…å­˜è¡¨è¢«åˆ é™¤çš„é—®é¢˜å—ï¼Ÿ<br>","like_count":2},{"had_liked":false,"id":315684,"user_name":"ç›˜èƒ§","can_delete":false,"product_type":"c1","uid":1650748,"ip_address":"","ucode":"5386CC4C92ECC2","user_header":"https://static001.geekbang.org/account/avatar/00/19/30/3c/0668d6ae.jpg","comment_is_top":false,"comment_ctime":1633944772,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5928912068","product_id":100020801,"comment_content":"https:&#47;&#47;dev.mysql.com&#47;doc&#47;refman&#47;8.0&#47;en&#47;innodb-auto-increment-handling.html<br>è¿™é‡Œé¢æœ‰è¯´è§„åˆ™ï¼Œè‡ªå¢idä¸è¿ç»­çš„æƒ…å†µï¼Œä¹Ÿç»™äº†demoã€‚å¥½å®¶ä¼™ï¼Œè€å¸ˆè¿™è¿™è¿™","like_count":2},{"had_liked":false,"id":70354,"user_name":"å”åä¹‹","can_delete":false,"product_type":"c1","uid":1004394,"ip_address":"","ucode":"F472C71E043E03","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/JKKWS6TzhncvAA0p0NDiaATPIvMicSM76vNAg9IG1ibibcJYPAiaicYjZfq4gAV8GRtcTpOibfRD8vzqHBtL0ibmhwQsbg/132","comment_is_top":false,"comment_ctime":1551083257,"is_pvip":false,"replies":[{"id":"25106","content":"è¿™æ ·æ€è·¯ä¸Šæ˜¯okçš„ï¼Œ<br><br>ä¸è¿‡è¡¨bæ€ä¹ˆæœ‰ä¸¤ä¸ªè‡ªå¢åˆ—ï¼Ÿä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªè‡ªå¢åˆ—ã€‚<br>","user_name":"ä½œè€…å›å¤","comment_id":70354,"uid":"1264162","ip_address":"","utype":1,"ctime":1551092709,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"5846050553","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå¦‚æœæˆ‘ä¸šåŠ¡åœºæ™¯å¿…é¡»éœ€è¦ä¸€ä¸ªå¸¦æœ‰åºè‡ªå¢å€¼ï¼Œè®¾ä¸šåŠ¡ä¸ºè¡¨Aï¼Œå¦å¤–æ·»åŠ ä¸€å¼ è¡¨è®°å½•è‡ªå¢ä¸ºè¡¨Bï¼Œè¡¨BåŒ…å«3ä¸ªå­—æ®µï¼ˆè‡ªå¢ä¸»é”®ï¼Œè¡¨Aå”¯ä¸€é”®ï¼Œè‡ªå¢åˆ—ï¼‰ï¼›ä¼ªä»£ç å¦‚ä¸‹ï¼›è¿™æ ·èƒ½å®ç°å—ï¼Ÿæˆ–è€…æœ‰å…¶ä»–ä»€ä¹ˆå¥½çš„æ–¹æ¡ˆï¼Ÿ<br>beginï¼›<br>insert into A valuesï¼ˆå­—æ®µ1, å”¯ä¸€é”®ï¼‰ï¼›<br>insert into B value (è¡¨Aå”¯ä¸€é”®ï¼Œè‡ªå¢åˆ—)ï¼›<br>commitï¼›","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440581,"discussion_content":"è¿™æ ·æ€è·¯ä¸Šæ˜¯okçš„ï¼Œ\n\nä¸è¿‡è¡¨bæ€ä¹ˆæœ‰ä¸¤ä¸ªè‡ªå¢åˆ—ï¼Ÿä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªè‡ªå¢åˆ—ã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551092709,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69396,"user_name":"AstonPutting","can_delete":false,"product_type":"c1","uid":1303239,"ip_address":"","ucode":"1DB579A7922964","user_header":"https://static001.geekbang.org/account/avatar/00/13/e2/c7/d6a0927a.jpg","comment_is_top":false,"comment_ctime":1550734137,"is_pvip":false,"replies":[{"id":"24660","content":"innodb_autoinc_lock_mode = 2çš„æ—¶å€™å°±è¦binlog_format = rowæ‰å¥½","user_name":"ä½œè€…å›å¤","comment_id":69396,"uid":"1264162","ip_address":"","utype":1,"ctime":1550738680,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"5845701433","product_id":100020801,"comment_content":"è€å¸ˆï¼Œinnodb_autoinc_lock_mode = 2ï¼Œbinlog_format = statement ä¸ä¹Ÿä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜å—ï¼Ÿä¸æ˜¯å¾ˆç†è§£ binlog_format = statement çš„æƒ…å†µä¸‹ï¼Œ1 ä¸ 2 çš„åŒºåˆ«ã€‚","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440097,"discussion_content":"innodb_autoinc_lock_mode = 2çš„æ—¶å€™å°±è¦binlog_format = rowæ‰å¥½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550738680,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":66471,"user_name":"Goal","can_delete":false,"product_type":"c1","uid":1307012,"ip_address":"","ucode":"C337CD4C7E07B0","user_header":"https://static001.geekbang.org/account/avatar/00/13/f1/84/7d21bd9e.jpg","comment_is_top":false,"comment_ctime":1549943355,"is_pvip":false,"replies":[{"id":"23575","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":66471,"uid":"1264162","ip_address":"","utype":1,"ctime":1549978004,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"5844910651","product_id":100020801,"comment_content":"èµ¶ä¸Šäº†è¿›åº¦ï¼ŒæŠŠæ˜¥èŠ‚æœŸé—´çš„è¡¥å›æ¥äº†","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438811,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549978004,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":66425,"user_name":"Frank","can_delete":false,"product_type":"c1","uid":1111985,"ip_address":"","ucode":"9DADD72C193296","user_header":"https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg","comment_is_top":false,"comment_ctime":1549937356,"is_pvip":true,"replies":[{"id":"23581","content":"æ˜¯çš„ï¼Œæˆ‘æ‰‹æ®‹äº†ã€‚ã€‚<br><br>å¤šè°¢æŒ‡å‡ºï¼Œå‘èµ·å‹˜è¯¯äº†å“ˆ<br>","user_name":"ä½œè€…å›å¤","comment_id":66425,"uid":"1264162","ip_address":"","utype":1,"ctime":1549978431,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"5844904652","product_id":100020801,"comment_content":"insert into t values(null,1,1);<br>begin;<br>insert into t values(null,2,2);<br>rolllack;<br>insert into t values(null,2,2);<br>&#47;&#47; æ’å…¥çš„è¡Œæ˜¯ (3,2,2)<br><br>è€å¸ˆ é‡Œé¢æ˜¯ rollback å§","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438799,"discussion_content":"æ˜¯çš„ï¼Œæˆ‘æ‰‹æ®‹äº†ã€‚ã€‚\n\nå¤šè°¢æŒ‡å‡ºï¼Œå‘èµ·å‹˜è¯¯äº†å“ˆ\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549978431,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":349052,"user_name":"prader26","can_delete":false,"product_type":"c1","uid":1433707,"ip_address":"","ucode":"5EFFFC374ADECE","user_header":"https://static001.geekbang.org/account/avatar/00/15/e0/6b/f61d7466.jpg","comment_is_top":false,"comment_ctime":1655694691,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1655694691","product_id":100020801,"comment_content":"ä¸»é”®ä¸è¿ç»­åœºæ™¯ï¼š<br>1ï¼šå”¯ä¸€é”®å†²çª<br>2ï¼šäº‹åŠ¡å›æ»š<br>3ï¼šè‡ªå¢ä¸»é”®çš„æ‰¹é‡ç”³è¯·","like_count":0},{"had_liked":false,"id":349049,"user_name":"äºšæ—","can_delete":false,"product_type":"c1","uid":1018972,"ip_address":"","ucode":"4A5A6D24314B79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8c/5c/3f164f66.jpg","comment_is_top":false,"comment_ctime":1655692442,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1655692442","product_id":100020801,"comment_content":"æ‰€ä»¥ï¼Œè¿™äº›ç¨å¾®å¸¦ç‚¹ä¸šåŠ¡çš„äº‹æƒ…ï¼Œè¿˜æ˜¯åˆ«è®©æ•°æ®åº“æ¥å¹²","like_count":0},{"had_liked":false,"id":347986,"user_name":"joker","can_delete":false,"product_type":"c1","uid":1101750,"ip_address":"","ucode":"09C3F66C262AB8","user_header":"https://static001.geekbang.org/account/avatar/00/10/cf/b6/3fcfa7e5.jpg","comment_is_top":false,"comment_ctime":1654651427,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1654651427","product_id":100020801,"comment_content":"å¦‚æœæˆ‘è¦ä¸€ä¸ªå­—æ®µä¸¥æ ¼é€’å¢å‘¢ï¼Ÿç±»ä¼¼æ’åï¼Œè¦å¦‚ä½•å®ç°å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":343180,"user_name":"å†è§ç†æƒ³","can_delete":false,"product_type":"c1","uid":1245999,"ip_address":"","ucode":"FAC88B3F6F6DFD","user_header":"https://static001.geekbang.org/account/avatar/00/13/03/2f/0a5e0751.jpg","comment_is_top":false,"comment_ctime":1650693919,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1650693919","product_id":100020801,"comment_content":"innodbçš„è‡ªå¢Idåœ¨5.7åŠä¹‹å‰çš„ç‰ˆæœ¬æ˜¯ä¿å­˜åœ¨å†…å­˜å½“ä¸­çš„ï¼Œåé¢å¢åŠ äº†è‡ªå¢IdæŒä¹…åŒ–çš„æœºåˆ¶ã€‚<br>å¯¼è‡´è‡ªå¢Idä¸è¿ç»­çš„åŸå› ï¼š<br>1.è¯­å¥å”¯ä¸€é”®å†²çªï¼Œå¯¼è‡´ç”³è¯·åˆ°è‡ªå¢Idåï¼Œè¯­å¥æ‰§è¡Œå¤±è´¥ï¼Œä½†æ˜¯è‡ªå¢Id+1ã€‚<br>2.äº‹åŠ¡å›æ»šï¼Œå¯¼è‡´è¯­å¥æ²¡æœ‰æ‰§è¡ŒæˆåŠŸï¼Œä½†æ˜¯è‡ªå¢Idå·²ç»å˜åŒ–ã€‚<br>3.innodbçš„æ‰¹é‡ç”³è¯·è‡ªå¢Idç­–ç•¥ï¼Œä¸ºäº†æé«˜ç”³è¯·è‡ªå¢Idçš„æ€§èƒ½ï¼Œä¼šæŒ‰ç…§1&#47;2&#47;4&#47;8çš„å¢é•¿é€Ÿåº¦è·å–è‡ªå¢Idï¼Œä½†æ˜¯å…¶ä¸­å¯èƒ½å­˜åœ¨è‡ªå¢idæµªè´¹çš„æƒ…å†µã€‚<br>è‡ªå¢Idé”æœ‰ä¸€ä¸ªé…ç½® ï¼Œinnodb_autoinc_lock_mode,é»˜è®¤ä¸º1ï¼š<br>1ï¼Œä¸º0æ—¶ï¼Œè¯­å¥æ‰§è¡Œç»“æŸä¹‹åï¼Œæ‰ä¼šé‡Šæ”¾è‡ªå¢Idé”ã€‚<br>2ï¼Œä¸º1æ—¶ï¼Œæ™®é€šæƒ…å†µç”³è¯·åˆ°è‡ªå¢Idåï¼Œå³å¯é‡Šæ”¾é”ï¼Œä½†æ˜¯insert..selectè¯­å¥éœ€è¦è¯­å¥æ‰§è¡Œå®Œæˆä¹‹åæ‰èƒ½é‡Šæ”¾è‡ªå¢Idé”ã€‚(é˜²æ­¢binlog statementæ ¼å¼ä¸»ä»æ•°æ®ä¸ä¸€è‡´é—®é¢˜)ã€‚<br>3ï¼Œæ‰€æœ‰æƒ…å†µéƒ½ä¼šåœ¨ç”³è¯·åˆ°è‡ªå¢Idåï¼Œé‡Šæ”¾è‡ªå¢Idé”ã€‚","like_count":0},{"had_liked":false,"id":341057,"user_name":"ç‹æ–Œ","can_delete":false,"product_type":"c1","uid":1442064,"ip_address":"","ucode":"244631718BCD0C","user_header":"https://static001.geekbang.org/account/avatar/00/16/01/10/669f7b79.jpg","comment_is_top":false,"comment_ctime":1649317491,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1649317491","product_id":100020801,"comment_content":"1ã€binlog_format=statement æ˜¯æ‹¿åŸæ¥çš„sqlæ‰§è¡Œçš„ï¼Œå¦‚æœåœ¨ä¸»åº“æ‰§è¡Œçš„æ—¶å€™tè¡¨æ˜¯10æ¡æ•°æ®(é”tè¡¨)ï¼Œä½†æ˜¯åœ¨ä»åº“æ‰§è¡Œï¼Œä¼šæœ‰æ—¶é—´é—´éš”ï¼Œè¿™ä¸ªæ—¶å€™åœ¨æ‰§è¡Œè¿™ä¸ªè¯­å¥(åŒæ ·æ˜¯é”äº†tè¡¨ï¼Œä½†æ˜¯è¿™ä¼šå„¿tè¡¨å·²ç»æœ‰12æ¡äº†)ï¼Œä»åº“æ’å…¥äº†12æ¡æ•°æ®ï¼Œå’Œä¸»åº“ä¹Ÿå°±ä¸ä¸€æ ·äº†ï¼Œæ•°æ®ä¸ä¸€è‡´äº†<br>2ã€binlog_format=row ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜","like_count":0},{"had_liked":false,"id":338388,"user_name":"bestgopher","can_delete":false,"product_type":"c1","uid":2254917,"ip_address":"","ucode":"D89735C8CA9C6E","user_header":"https://static001.geekbang.org/account/avatar/00/22/68/45/ddf89612.jpg","comment_is_top":false,"comment_ctime":1647480380,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1647480380","product_id":100020801,"comment_content":"ä¸è¿ç»­åŸå› ï¼š1.å”¯ä¸€é”®å†²çªï¼›2.å›æ»šï¼›3.è‡ªå¢é”®çš„ç”³è¯·ç­–ç•¥","like_count":0},{"had_liked":false,"id":335993,"user_name":"Geek_35fe0b","can_delete":false,"product_type":"c1","uid":2721741,"ip_address":"","ucode":"D45F716676BBD0","user_header":"","comment_is_top":false,"comment_ctime":1645832983,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1645832983","product_id":100020801,"comment_content":"è·ç¦»è€å¸ˆå†™è¿™ç¯‡æ–‡ç« è¿‡äº†è¿™ä¹ˆä¹…ï¼Œä¸çŸ¥é“è€å¸ˆè¿˜èƒ½ä¸èƒ½çœ‹åˆ°æˆ‘çš„è¯„è®ºï¼Œæœ‰ä¸ªé—®é¢˜æƒ³è¯·æ•™ä¸€ä¸‹ï¼š<br>RRéš”ç¦»çº§åˆ«ä¸‹ï¼Œinsert ... select è¿™ç±»è¯­å¥ä¸­çš„selectæ˜¯å¦éµå¾ªå¯é‡å¤è¯»çš„é™åˆ¶ï¼Ÿ<br>å¦‚æœéµå¾ªé‚£selectæŸ¥è¯¢çš„ç»“æœæ˜¯èƒ½ç¡®å®šè¡Œæ•°çš„ï¼Œæ—¢ç„¶èƒ½ç¡®å®šè¡Œæ•°ï¼Œé‚£mysqlä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨1+2+4+8è¿™ç§ç”³è¯·æ–¹å¼ï¼Ÿç›´æ¥æŒ‰æŸ¥è¯¢ç»“æœç”³è¯·è¡Œæ•°ä¸çœäº‹å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":320007,"user_name":"å…ˆå¬","can_delete":false,"product_type":"c1","uid":1151409,"ip_address":"","ucode":"82D8DA7A2FEB4B","user_header":"https://static001.geekbang.org/account/avatar/00/11/91/b1/fb117c21.jpg","comment_is_top":false,"comment_ctime":1636037315,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636037315","product_id":100020801,"comment_content":"5.7.29ä¹‹å‰ï¼Œåœ¨è‡ªå¢æ¨¡å¼ä¸º1ä»¥ä¸Šæ—¶ï¼Œå‡å¦‚Aè¿›ç¨‹ä½¿ç”¨insert..select..on duplicate update... æ—¶ï¼Œå¦‚æœæœ‰å¦ä¸€ä¸ªè¿›ç¨‹Bä¹Ÿåœ¨å¤„ç†åŒä¸€ä¸ªè¡¨ï¼ŒAå¯èƒ½ä¼šåœ¨æ™•ä¹ä¹åœ°æŠŠäººå®¶Bçš„æ•°æ®ç»™æ›´æ–°äº†ã€‚è¯·é—®æœ‰æ²¡æœ‰åœ¨ä¸æ‰“è¡¥ä¸æƒ…å†µä¸‹çš„è§£å†³å»ºè®®å‘¢ï¼Ÿ","like_count":1},{"had_liked":false,"id":316014,"user_name":"å¼ è¯š","can_delete":false,"product_type":"c1","uid":1115702,"ip_address":"","ucode":"F623703194769B","user_header":"https://static001.geekbang.org/account/avatar/00/11/06/36/d288bcc7.jpg","comment_is_top":false,"comment_ctime":1634107873,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1634107873","product_id":100020801,"comment_content":"æœ‰ä¸ªç–‘é—®ï¼Œå½“åˆä¸çŸ¥é“åœ¨å“ªé‡Œçœ‹åˆ°è¿‡ï¼Œå¯¹äºç°åœ¨çš„ç³»ç»Ÿå•è¡¨è¡Œæ•°ä¸€èˆ¬åˆ°åƒä¸‡çº§å°±åˆ°æé™äº†ï¼Œå†å¤šäº†æŸ¥è¯¢æ€§èƒ½å°±å¯èƒ½æˆæŒ‡æ•°çº§ä¸‹é™ï¼Œä¸ºä»€ä¹ˆä¸»é”®ç±»å‹ä¸é€‰æ‹©INT è€Œé€‰æ‹©BIGINTå‘¢ï¼Ÿä¸æ˜¯è¯´å°½é‡å‡å°‘ä¸»é”®çš„æ•°æ®ç±»å‹å¤§å°å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":315680,"user_name":"ç›˜èƒ§","can_delete":false,"product_type":"c1","uid":1650748,"ip_address":"","ucode":"5386CC4C92ECC2","user_header":"https://static001.geekbang.org/account/avatar/00/19/30/3c/0668d6ae.jpg","comment_is_top":false,"comment_ctime":1633944175,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1633944175","product_id":100020801,"comment_content":"https:&#47;&#47;dev.mysql.com&#47;doc&#47;refman&#47;8.0&#47;en&#47;innodb-auto-increment-handling.html  è‡ªå¢idçš„æ–‡æ¡£","like_count":0},{"had_liked":false,"id":306035,"user_name":"Leo","can_delete":false,"product_type":"c1","uid":2649276,"ip_address":"","ucode":"CEBAD9CDCFC2A3","user_header":"https://static001.geekbang.org/account/avatar/00/28/6c/bc/f751786b.jpg","comment_is_top":false,"comment_ctime":1628310117,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1628310117","product_id":100020801,"comment_content":"ç•™ä½œè®°å½•ï¼Œå˜¿å˜¿ï¼š<br>åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹è‡ªå¢ä¸»é”®å¯èƒ½ä¸è¿ç»­ï¼Ÿ<br>1ï¼šå”¯ä¸€é”®å†²çª<br>2ï¼šäº‹åŠ¡å›æ»š<br>3ï¼šè‡ªå¢ä¸»é”®çš„æ‰¹é‡ç”³è¯·","like_count":0},{"had_liked":false,"id":301421,"user_name":"Jamey","can_delete":false,"product_type":"c1","uid":2344373,"ip_address":"","ucode":"449E4F65339CDE","user_header":"https://static001.geekbang.org/account/avatar/00/23/c5/b5/25179772.jpg","comment_is_top":false,"comment_ctime":1625670839,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625670839","product_id":100020801,"comment_content":"å¤§å®¶æœ‰æ²¡æœ‰æƒ³è¿‡ä¸ºä»€ä¹ˆè‡ªå¢IDé”ä¸ç”¨åŸå­æ“ä½œï¼Ÿ","like_count":0},{"had_liked":false,"id":291768,"user_name":"å¶æ¶›","can_delete":false,"product_type":"c1","uid":2448277,"ip_address":"","ucode":"B45348979BE159","user_header":"https://static001.geekbang.org/account/avatar/00/25/5b/95/462890c6.jpg","comment_is_top":false,"comment_ctime":1620470174,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1620470174","product_id":100020801,"comment_content":"æœ‰æ²¡æœ‰è¿™ç§æƒ…å†µå‘¢ï¼š<br>1. tè¡¨çš„å…ˆæ–°å¢ä¸€æ¡æ•°æ®, ç„¶åæ‰§è¡Œ insert into t2(c,d) select c,d from tï¼Œtè¡¨æ­£å¸¸åŠ é”,<br>2. ä½†å¦‚æœbinlogè®°å½•çš„æ˜¯ insert into t2...select... t å’Œ insert t...<br>3. åœ¨ä»åº“æ‰§è¡Œçš„æ—¶å€™å…ˆæ‰§è¡Œäº†insert into t2 select....ï¼Œæ­¤æ—¶tæ–°å¢çš„æ•°æ®çš„sqlè¿˜æ²¡æœ‰æ‰§è¡Œï¼Œè¿™æ ·æ˜¯ä¸æ˜¯ä¹Ÿæ˜¯ä¸»å¤‡æ•°æ®ä¸ä¸€è‡´äº†","like_count":0},{"had_liked":false,"id":287423,"user_name":"ç‰¹å…°å…‹æ–¯","can_delete":false,"product_type":"c1","uid":2449886,"ip_address":"","ucode":"97917B24C1136E","user_header":"https://static001.geekbang.org/account/avatar/00/25/61/de/94ee070a.jpg","comment_is_top":false,"comment_ctime":1617939720,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617939720","product_id":100020801,"comment_content":"è€å¸ˆ, mybatis  åŠ äº†   useGeneratedKeys=&quot;true&quot;   keyProperty=&quot;id&quot;  ä¿å­˜çš„æ—¶å€™è¿”å›id, ä½†æ˜¯æœ‰æ—¶å€™ç¼ºæ²¡è¿”å›, ä½†æ˜¯æ•°æ®åº“ç¡®å®æ˜¯ä¿å­˜äº†,æ˜¯ä»€ä¹ˆæƒ…å†µå‘€","like_count":0},{"had_liked":false,"id":282661,"user_name":"å¸æ±Ÿ","can_delete":false,"product_type":"c1","uid":1590610,"ip_address":"","ucode":"93CBA4E4D05DA5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/B9vSOjMc2a86kYA8R5yDkVdFiaj2JeBZ1PuI9oUKhbnvuZwuibdUam6FTcGzDaiaFdk2GWJveUGhfCVpv4KaOdicoQ/132","comment_is_top":false,"comment_ctime":1615355619,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1615355619","product_id":100020801,"comment_content":"æ–‡ç« æåˆ°è¿‡.ç‰¹æ„æå‡ºæ¥.åˆ é™¤ä¹Ÿä¼šå¯¼è‡´è‡ªå¢ä¸»é”®ä¸è¿ç»­","like_count":0},{"had_liked":false,"id":271423,"user_name":"é‚¬ç£Š","can_delete":false,"product_type":"c1","uid":1068178,"ip_address":"","ucode":"D938FD4ED5E67E","user_header":"https://static001.geekbang.org/account/avatar/00/10/4c/92/a9cf4fb6.jpg","comment_is_top":false,"comment_ctime":1609604175,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609604175","product_id":100020801,"comment_content":"å½“ innodb_autoinc_lock_mode!=0çš„æ—¶å€™ï¼Œon duplicate key updateè¯­å¥  ä¹Ÿä¼šå¯¼è‡´è‡ªå¢ä¸»é”®ä¸è¿ç»­ã€‚","like_count":0},{"had_liked":false,"id":268068,"user_name":"moonfox","can_delete":false,"product_type":"c1","uid":1526355,"ip_address":"","ucode":"902BFF40EFA9FA","user_header":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","comment_is_top":false,"comment_ctime":1608043366,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1608043366","product_id":100020801,"comment_content":"è¯·é—®è€å¸ˆï¼Œåœ¨æ‰¹é‡æ’å…¥æ•°æ®ï¼Œä½¿ç”¨æ‰¹é‡ç”³è¯·idç­–ç•¥æ—¶ï¼Œå½“å¤šæ¬¡ç”³è¯·idæœŸé—´ï¼Œé”æ˜¯è¢«ä¸€ç›´æŒæœ‰ä¹ˆï¼Œä¸‹ä¸€æ¬¡çš„ç”³è¯·å’Œä¸Šä¸€æ¬¡ç”³è¯·ä¹‹é—´ï¼Œè‡ªå¢é”ä¼šè¢«é‡Šæ”¾ä¹ˆï¼Ÿè¿˜æ˜¯è¿™æœŸé—´ä¸€ç›´æŒæœ‰ï¼Œç›´åˆ°åˆ†é…å®Œæˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1526355,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","nickname":"moonfox","note":"","ucode":"902BFF40EFA9FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335718,"discussion_content":"è‡ªå·±å›ç­”ä¸‹ï¼Œé”æ˜¯è¢«ä¸€ç›´æŒæœ‰ï¼Œä¸ä¼šé‡Šæ”¾ï¼Œç›´åˆ°ç”³è¯·åˆ°æ‰€æœ‰IDã€‚è¿™æ ·æ‰èƒ½ä¿è¯ç”³è¯·åˆ°çš„IDéƒ½æ˜¯è¿ç»­çš„ï¼ŒåŒæ­¥åˆ°å¤‡åº“åï¼Œä¸»å¤‡æ•°æ®æ‰èƒ½æ˜¯ä¸€è‡´çš„ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1608283118,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":258772,"user_name":"Johnson","can_delete":false,"product_type":"c1","uid":1326108,"ip_address":"","ucode":"C6B6FF9EA4CC60","user_header":"https://static001.geekbang.org/account/avatar/00/14/3c/1c/47e5b7aa.jpg","comment_is_top":false,"comment_ctime":1604552364,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604552364","product_id":100020801,"comment_content":"æ—è€å¸ˆï¼Œåœ¨ä¸€äº›ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå®¢æˆ·ç»å¸¸ä¼šè¦æ±‚æŒ‰å¤©æä¾›è¿ç»­çš„ç¼–å·ï¼Œæ¯”å¦‚20191201001ï¼Œ20191201002ï¼Œ...ï¼Œå¹¶è¦æ±‚ä¸èƒ½æ–­å·ï¼Œåœ¨æ•°æ®åº“è®¾è®¡æ–¹é¢ï¼Œå¸Œæœ›è€å¸ˆèƒ½æä¾›ä¸€äº›å»ºè®®ã€‚","like_count":0},{"had_liked":false,"id":253994,"user_name":"CharAt","can_delete":false,"product_type":"c1","uid":1813207,"ip_address":"","ucode":"D7D44B48FC4E79","user_header":"https://static001.geekbang.org/account/avatar/00/1b/aa/d7/a417ad5b.jpg","comment_is_top":false,"comment_ctime":1603008579,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603008579","product_id":100020801,"comment_content":"åœ¨åˆ†å¸ƒå¼å¤§é‡é«˜å¹¶å‘çš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œå¯ä¸å¯ä»¥ä½¿ç”¨disruptorå¹¶å‘æ¡†æ¶ä½¿ç”¨å·æ®µæ¨¡å‹æ‰¹é‡äº§ç”Ÿè‡ªå¢idï¼ŒæŒ‡å®šidï¼Œè¿™æ ·ä¼šä¸ä¼šå‡å°‘mysqlè‡ªå¢idçš„å‹åŠ›ã€‚","like_count":0},{"had_liked":false,"id":244631,"user_name":"ç‘å“²","can_delete":false,"product_type":"c1","uid":1502093,"ip_address":"","ucode":"9F170728A055AD","user_header":"https://static001.geekbang.org/account/avatar/00/16/eb/8d/8ee78d3d.jpg","comment_is_top":false,"comment_ctime":1598600242,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598600242","product_id":100020801,"comment_content":"å¦‚æœä¸åŠ è®°å½•å’Œé—´éš™é”ï¼Œè€Œbinlog_formatåˆæ˜¯statementã€‚é‚£ä¹ˆæ­¤æ—¶å¦‚æœæœ‰å¦ä¸€ä¸ªäº‹åŠ¡å¯¹tæœ‰å†™æ“ä½œï¼Œæ¯”å¦‚insert into t values(x, x, x)ï¼Œè¿™æ—¶ç”±äºäº‹åŠ¡çš„éš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯»ï¼Œt2æ˜¯çœ‹ä¸åˆ°æ–°å¢çš„æ•°æ®é€‡ã€‚è€Œæˆ‘ä»¬çš„binlogè®°å½•æ—¶å¦‚æœå°†insert into t2(c, d) select c,d from tï¼›è®°åœ¨äº†åˆšæ‰é‚£ä¸ªè¯­å¥çš„åé¢ã€‚é‚£ä¹ˆåœ¨å¤‡åº“ä½¿ç”¨binlogåŒæ­¥çš„æ—¶å€™ï¼Œå¤‡åº“ä¼šåŸºäºbinlogæ¢å¤ä¸´æ—¶åº“ï¼Œt2ä¼šçœ‹åˆ°æ–°å¢çš„æ•°æ®ï¼Œå°±ä¼šé€ æˆä¸»å¤‡æ•°æ®çš„ä¸ä¸€è‡´ã€‚","like_count":0},{"had_liked":false,"id":222754,"user_name":"æŒ‡å°–ä»¥ä¸œ","can_delete":false,"product_type":"c1","uid":1092218,"ip_address":"","ucode":"1DEE134FE92FD0","user_header":"https://static001.geekbang.org/account/avatar/00/10/aa/7a/ae8c247d.jpg","comment_is_top":false,"comment_ctime":1590905989,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590905989","product_id":100020801,"comment_content":"è‡ªå¢ä¸»é”®ä¸è¿ç»­è™½ç„¶è‡ªå·±è·‘ä¹Ÿå¾ˆå¸¸è§ï¼Œä½†æ˜¯ä»æ¥æ²¡æœ‰ç•™æ„è¿‡ä¸ºä»€ä¹ˆã€‚ä»Šå¤©å­¦ä¹ äº†ä¸‰ç§æƒ…å†µ<br>ä¸€ï¼Œæ’å…¥äº‹åŠ¡å›æ»šäº†<br>äºŒï¼Œæ’å…¥çš„æ—¶å€™å”¯ä¸€é”®å†²çªäº†<br>ä¸‰ï¼Œæ‰¹é‡æ’å…¥ç¬¬ä¸€æ¡å–ä¸€ä¸ªä¸»é”®ï¼Œç¬¬äºŒæ¡ä¼šè·å–ä¸¤ä¸ªä¸»é”®ï¼Œç¬¬å››æ¡ä¼šè·å–å››ä¸ªä¸»é”®ï¼Œå› ä¸ºè·å–ä¸¤å€é€’å¢éƒ¨åˆ†å¯èƒ½ç”¨ä¸åˆ°å°±å½¢æˆäº†ä¸è¿ç»­<br><br>æ¸©æ•…äº†binlogä½¿ç”¨ç”¨rowçš„å¥½å¤„ï¼Œçº¿ä¸Šæ•°æ®åŒæ­¥ç”¨çš„otterä¹Ÿå¿…é¡»ç”¨è¿™ä¸ªé…ç½®<br>","like_count":0},{"had_liked":false,"id":179136,"user_name":"ç‹è‰ºéœ–","can_delete":false,"product_type":"c1","uid":1113992,"ip_address":"","ucode":"351C456CAEAD25","user_header":"https://static001.geekbang.org/account/avatar/00/10/ff/88/1da2546f.jpg","comment_is_top":false,"comment_ctime":1581925371,"is_pvip":false,"replies":[{"id":"69527","content":"è¿™ä¹ˆç¥å¥‡ï¼Œè¿™ä¸ªè¡¨æœ‰ä¸»é”®çš„æ˜¯å§ï¼Ÿ<br>é‚£å¦‚æœä½ è¿™æ—¶å€™æ‰§è¡Œinsertè¯­å¥ï¼Œä¼šä¸»é”®å†²çªå—","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1581932602,"ip_address":"","comment_id":179136,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1581925371","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæˆ‘ä»¬çš„mysql8è£…ä¸Šä»¥åï¼Œé‡å¯æœåŠ¡çš„æ—¶å€™ï¼Œéƒ¨åˆ†è¡¨çš„auto_incrementè¢«é‡ç½®ä¸º1ï¼Œå¤§æ¦‚äº”åå¼ è¡¨ä¼šæœ‰20å¼ å‡ºç°ã€‚ã€‚è¿™æ˜¯bugå—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484106,"discussion_content":"è¿™ä¹ˆç¥å¥‡ï¼Œè¿™ä¸ªè¡¨æœ‰ä¸»é”®çš„æ˜¯å§ï¼Ÿ\né‚£å¦‚æœä½ è¿™æ—¶å€™æ‰§è¡Œinsertè¯­å¥ï¼Œä¼šä¸»é”®å†²çªå—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581932602,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1113992,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/88/1da2546f.jpg","nickname":"ç‹è‰ºéœ–","note":"","ucode":"351C456CAEAD25","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":175068,"discussion_content":"æ˜¯çš„ï¼Œå°±æ˜¯åœ¨insertçš„æ—¶å€™æŠ¥é”™è¯´æœ‰é‡å¤idå‘ç°çš„ã€‚ã€‚è¿˜åœ¨å®šä½ä¸­ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581949673,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":174739,"user_name":"Zhaoyang","can_delete":false,"product_type":"c1","uid":1037190,"ip_address":"","ucode":"131D83AC2566D2","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d3/86/b5d72c87.jpg","comment_is_top":false,"comment_ctime":1580367200,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1580367200","product_id":100020801,"comment_content":"è¯»äº†ç¬¬ä¸€éï¼Œå¤§è‡´äº†è§£äº†innodbçš„ä¸»é”®è‡ªå¢ï¼Œæ˜¯å­˜å‚¨åœ¨å†…å­˜é‡Œé¢çš„ï¼Œå¤§è‡´ç†è§£äº†ä¸»é”®idiä¸è¿ç»­çš„åŸå› ï¼Œ<br>1. å”¯ä¸€å¥å€¼å†²çª<br>2. æ‰¹é‡æ•°æ®å¯¼å…¥æ—¶ï¼Œç”³è¯·idæ˜¯æˆå€ç”³è¯·çš„ï¼Œä¼šå¯¼è‡´æµªè´¹ä¸€äº›idã€‚<br><br>è¿˜å¾—éœ€è¦å¤šè¯»å‡ éï¼Œå› ä¸ºè‡ªå·±å¹³å¸¸æ ¹æœ¬æ²¡æœ‰æ³¨æ„è¿‡è¿™äº›ã€‚","like_count":0},{"had_liked":false,"id":174252,"user_name":"Geek_eb2e49","can_delete":false,"product_type":"c1","uid":1637789,"ip_address":"","ucode":"21671F0C4E7872","user_header":"https://wx.qlogo.cn/mmopen/vi_32/4PvDe2mRia2vdMGyickA40y2libhpf8ibmIEQquLUZFMXUMqqDjfVb96Y69p7bS6USgxicOKCCHxQHczHBnNb5L9nfA/132","comment_is_top":false,"comment_ctime":1580110020,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1580110020","product_id":100020801,"comment_content":"è€å¸ˆï¼Œéå¸¸æ„Ÿè°¢æ‚¨çš„ä¸“æ ï¼Œè®©æˆ‘èƒ½æ¥è§¦åˆ°æ›´å¤šçš„åŸç†ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯ä¸ªå°ç™½ï¼Œæœ‰äº›ç†è§£çš„å¯èƒ½ä¸æ˜¯é‚£ä¹ˆé€å½»ï¼Œæƒ³è¯·æ•™ä¸‹<br>ç”±äºä¸»åº“é‡å¯åï¼Œä¼šå¾€ binlog é‡Œé¢å†™â€œdelete from tbl_nameâ€ï¼Œè¿™ä¸ªå‘½ä»¤ä¼ åˆ°å¤‡åº“ï¼Œå¤‡åº“çš„åŒåçš„è¡¨æ•°æ®ä¹Ÿä¼šè¢«æ¸…ç©ºã€‚å› æ­¤ï¼Œå°±ä¸ä¼šå‡ºç°ä¸»å¤‡åŒæ­¥åœæ­¢çš„é—®é¢˜ã€‚å¦‚æœç”±äºä¸»åº“å¼‚å¸¸é‡å¯ï¼Œè§¦å‘äº† HAï¼Œè¿™æ—¶å€™æˆ‘ä»¬ä¹‹å‰ä¿®æ”¹è¿‡å¼•æ“çš„å¤‡åº“å˜æˆäº†ä¸»åº“ã€‚è€ŒåŸæ¥çš„ä¸»åº“å˜æˆäº†æ–°å¤‡åº“ï¼Œåœ¨æ–°å¤‡åº“ä¸ŠæŠŠæ‰€æœ‰çš„å†…å­˜è¡¨ï¼ˆè¿™æ—¶å€™è¡¨é‡Œæ²¡æ•°æ®ï¼‰éƒ½æ”¹æˆ InnoDB è¡¨ã€‚<br>è¿™æ ·çš„è¯ä¸»åº“å’Œä»åº“åŸæ¥å†…å­˜è¡¨é‡Œé¢çš„æ•°æ®ä¸ä¼šéƒ½ä¸¢å¤±äº†å—ï¼Ÿ è¿˜æ˜¯è¯´å› ä¸ºä»åº“çš„å†…å­˜è¡¨æ”¹äº†å¼•æ“ä»¥åï¼Œæ•°æ®å¯ä»¥ä¿å­˜åˆ°ç£ç›˜ä¸­ï¼Œä½†æ˜¯è¿™æ ·ä¸ä¼šå‡ºç°åŸä¸»åº“çš„æ•°æ®ä¸è§äº†ï¼Œè€Œæ–°ä¸»åº“çš„æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸Šï¼Œä»è€Œä¸»ä»æ•°æ®ä¸ä¸€è‡´å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":161087,"user_name":"Jacin","can_delete":false,"product_type":"c1","uid":1323763,"ip_address":"","ucode":"F7AA8CCB1C678C","user_header":"https://static001.geekbang.org/account/avatar/00/14/32/f3/698734e2.jpg","comment_is_top":false,"comment_ctime":1576116618,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576116618","product_id":100020801,"comment_content":"è‡ªå¢idï¼Œèƒ½ä¿è¯æ—¶é—´é¡ºåºä¸Šå…ˆinsertçš„idæ›´å°å—ï¼Ÿ<br>æˆ‘é‡åˆ°Oracleæ•°æ®åº“åºåˆ—çš„é—®é¢˜ï¼Œåºåˆ—æœ‰ä¸ªorderé€‰é¡¹æ¥ä¿è¯é¡ºåºã€‚åº”è¯¥æ˜¯å‡ºäºå¹¶å‘æ€§èƒ½è€ƒè™‘ã€‚ä¸çŸ¥é“MySQLæ˜¯å¦æœ‰ç±»ä¼¼æœºåˆ¶ï¼Œä¿è¯è‡ªå¢idæ—¶é—´ä¸Šä¸¥æ ¼é¡ºåºï¼Ÿ","like_count":0},{"had_liked":false,"id":117630,"user_name":"alioo","can_delete":false,"product_type":"c1","uid":1022507,"ip_address":"","ucode":"F36A38C1F5FFAB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqOpANMwDibLmj5IGJh6dTw300sZ1BHM5sG3sZv1A1rvCHOiblPD3jgFOiaMVVujtctWnQbVFoNPpRgw/132","comment_is_top":false,"comment_ctime":1564103577,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564103577","product_id":100020801,"comment_content":"mysql8.0è‡ªå¢idè®°å½•åˆ°redologé‡Œï¼Œredologæ˜¯æ»šåŠ¨çš„ä¼šä¸ä¼šä¸¢å¤±å•Šï¼Ÿ","like_count":0},{"had_liked":false,"id":117628,"user_name":"alioo","can_delete":false,"product_type":"c1","uid":1022507,"ip_address":"","ucode":"F36A38C1F5FFAB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqOpANMwDibLmj5IGJh6dTw300sZ1BHM5sG3sZv1A1rvCHOiblPD3jgFOiaMVVujtctWnQbVFoNPpRgw/132","comment_is_top":false,"comment_ctime":1564103405,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564103405","product_id":100020801,"comment_content":"binglogæ˜¯statementçš„è¯ï¼Œè®°å½•é”æ˜¯ä¸ºäº†é˜²æ­¢t è¡¨åœ¨ä¸Šè¿°sqlæ‰§è¡ŒæœŸé—´äº§ç”Ÿæ›´æ–°ï¼Œé—´éš™é”æ˜¯ä¸ºäº†é˜²æ­¢tè¡¨åœ¨ä¸Šè¿°sqlæ‰§è¡ŒæœŸé—´äº§ç”Ÿæ’å…¥æ“ä½œ","like_count":0},{"had_liked":false,"id":114954,"user_name":"é†‰çº¢å°˜","can_delete":false,"product_type":"c1","uid":1434669,"ip_address":"","ucode":"C084FEFF5DC1B9","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIGsON5PiclibWicubWbskkVIxJUuxdbrLOp84AZFSNQNibkR0ky1FybqdWEr00gH4g8eOiao0ZvwgFrvg/132","comment_is_top":false,"comment_ctime":1563438051,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563438051","product_id":100020801,"comment_content":"ğŸ˜‚æˆ‘é”™äº†<br>è€å¸ˆæˆ‘æƒ³é—®çš„æ˜¯  åœ¨rowæ¨¡å¼ä¸‹ï¼Œä½¿ç”¨ replace into è¿˜æ˜¯ä¼šå¯¼è‡´ä¸»ä»çš„è‡ªå¢IDä¸ä¸€è‡´é—®é¢˜ï¼Œè¿™ä¸ªæœ‰è§£å†³æ–¹æ³•å—ï¼Ÿ<br>","like_count":0},{"had_liked":false,"id":114943,"user_name":"é†‰çº¢å°˜","can_delete":false,"product_type":"c1","uid":1434669,"ip_address":"","ucode":"C084FEFF5DC1B9","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIGsON5PiclibWicubWbskkVIxJUuxdbrLOp84AZFSNQNibkR0ky1FybqdWEr00gH4g8eOiao0ZvwgFrvg/132","comment_is_top":false,"comment_ctime":1563436917,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563436917","product_id":100020801,"comment_content":"è€å¸ˆï¼Œè¯·é—®ä¸€ä¸‹ï¼Œæœ‰ä»€ä¹ˆåŠæ³•è§£å†³å­˜åœ¨å”¯ä¸€ç´¢å¼•çš„è¡¨çš„ä¸»ä»è‡ªå¢ä¸»é”®ä¸ä¸€è‡´é—®é¢˜å—ï¼Ÿ<br>ç¤ºä¾‹å¦‚ä¸‹ï¼š<br>1ã€æ–°å»ºä¸€å¼ å¸¦æœ‰å”¯ä¸€ç´¢å¼•çš„è¡¨å¹¶å†™å…¥æµ‹è¯•æ•°æ®<br>CREATE TABLE  TTT(ID INT AUTO_INCREMENT PRIMARY KEY,USER_NAME VARCHAR(50),USER_AGE VARCHAR(50),UNIQUE key IDX_NAME(USER_NAME))<br><br>INSERT INTO TTT(USER_NAME,USER_AGE) VALUES(&#39;A1&#39;,&#39;1&#39;),(&#39;A2&#39;,&#39;2&#39;),(&#39;A3&#39;,&#39;3&#39;),(&#39;A4&#39;,&#39;4&#39;),(&#39;A5&#39;,&#39;5&#39;),(&#39;A6&#39;,&#39;6&#39;);<br><br>2ã€å”¯ä¸€é”®å†²çªåœºæ™¯<br>INSERT INTO TTT(USER_NAME,USER_AGE) VALUES(&#39;A1&#39;,&#39;1&#39;),(&#39;A2&#39;,&#39;2&#39;),(&#39;A3&#39;,&#39;3&#39;),(&#39;A4&#39;,&#39;4&#39;),(&#39;A5&#39;,&#39;5&#39;),(&#39;A6&#39;,&#39;6&#39;);","like_count":0},{"had_liked":false,"id":105227,"user_name":"æåˆš","can_delete":false,"product_type":"c1","uid":1424487,"ip_address":"","ucode":"BFA253F932F01B","user_header":"https://static001.geekbang.org/account/avatar/00/15/bc/67/2e19e8ef.jpg","comment_is_top":false,"comment_ctime":1560942197,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560942197","product_id":100020801,"comment_content":"1ã€å¦‚æœæ’å…¥çš„æ—¶å€™ï¼Œæ˜¯ä¸»é”®å†²çªäº†ï¼ŒAUTO_INCREMENTå€¼ä¸ä¼šæ”¹å˜ã€‚<br>2ã€å¦‚æœæ’å…¥çš„fieldï¼Œç±»å‹ä¸åŒ¹é…ï¼Œæ¯”å¦‚å®šä¹‰çš„æ˜¯intï¼Œç»“æœæ’å…¥è‹±æ–‡å­—ç¬¦ä¸²ï¼ŒAUTO_INCREMENTå€¼ä¹Ÿä¸ä¼šæ”¹å˜ã€‚<br>å¸®å¿™è§£é‡Šä¸‹ï¼Œè¿™2ç§ç°è±¡ã€‚","like_count":0},{"had_liked":false,"id":100383,"user_name":"çº¢é²¤é±¼ä¸ç»¿é²¤é±¼ä¸é©´baci","can_delete":false,"product_type":"c1","uid":1199902,"ip_address":"","ucode":"CB7D8A522D665E","user_header":"https://static001.geekbang.org/account/avatar/00/12/4f/1e/cb8ddbe9.jpg","comment_is_top":false,"comment_ctime":1559543458,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559543458","product_id":100020801,"comment_content":"è€å¸ˆ è¿™ä¸ªç¬¬ä¸‰ç§id ä¸è¿ç»­çš„æƒ…å†µ ï¼Œå®ƒæ˜¯ä¸€ä¸ªä»€ä¹ˆè§„å¾‹å‘€ï¼Ÿ  æˆ‘è‡ªå·±å®éªŒäº†ä¸€ä¸‹ï¼Œtè¡¨  æ’å…¥äº† 1-8 æ¡æ•°æ®ï¼Œç„¶åå®‰è£… ä½ ä¸Šè¾¹ä»£ç çš„é¡ºåº  creat table t2  ..ï¼Œ insert into t2ï¼ˆc,dï¼‰ select c,d from t. æ’å…¥å®Œä¹‹å t2 è¡¨çš„ AUTO_INCREMENT =16äº†","like_count":0},{"had_liked":false,"id":89221,"user_name":"zhima_hu","can_delete":false,"product_type":"c1","uid":1311188,"ip_address":"","ucode":"33A4496556D9B1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/rBCoNmJbagIGlkrDDfdQv9YjrtoHfvExqSSiavHwgUaukTxnO2jTBGrrHUF49VZqaS1FBolLc4Bibk883sabroyQ/132","comment_is_top":false,"comment_ctime":1556111053,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556111053","product_id":100020801,"comment_content":"ä½ å¥½ï¼Œä¸‹é¢è¿™ç§insert selectè¯­å¥ä¼šåŠ å‡ ä¸ªé”ï¼Œå› ä¸ºç°åœ¨çº¿ä¸Šè¿™ä¸ªè¯­å¥å‡ºç°æ­»é”ï¼Œæ•´ä¸æ˜ç™½<br>INSERT INTO rule_prom_activity<br>        (<br>        `act_id`,<br>        `act_name`,<br>        `create_time`,<br>        `modified_time`)<br>        SELECT<br>        #{activityId},<br>        #{name},\t\t    <br>        now(),<br>        now()<br>\t\tFROM<br>\t\t\tdual<br>\t\tWHERE NOT EXISTS(SELECT 1 FROM rule_prom_activity WHERE act_id = #{activityId})","like_count":0},{"had_liked":false,"id":81844,"user_name":"å½’å¿ƒ","can_delete":false,"product_type":"c1","uid":1036567,"ip_address":"","ucode":"985E3188A9F6FE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d1/17/356cc426.jpg","comment_is_top":false,"comment_ctime":1554049712,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1554049712","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼Œè¿™è¾¹æœ‰ä¸ªé—®é¢˜ï¼šç»æµ‹è¯•ï¼Œä¸è®ºæ˜¯mysqlç‰ˆæœ¬æ˜¯5.7 è¿˜æ˜¯8.0ï¼Œå½“mysqlé‡å¯åè‡ªå¢å€¼éƒ½æ˜¯max(id) + 1ï¼Œä½†æ˜¯å½“ä¸æŒ‡å®šidå€¼æ’å…¥æ—¶ï¼Œä¾‹å¦‚ insert into table values()ï¼Œidå€¼æ˜¯ç¬¬ä¸€ä¸ªå¤§äº max(id) çš„æ–°ç”Ÿæˆçš„è‡ªå¢å€¼ã€‚è¿™ä¸ªå¥½åƒå’Œè€å¸ˆå°†çš„ä¸ä¸€æ ·ï¼Œæœ›è€å¸ˆè§£ç­”è°¢è°¢ï¼","like_count":0,"discussions":[{"author":{"id":1318528,"avatar":"https://static001.geekbang.org/account/avatar/00/14/1e/80/e409fff6.jpg","nickname":"Sochooligan","note":"","ucode":"B66F78B6B86476","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":133388,"discussion_content":"ä½ å®è¯çš„æ–¹å¼å¾ˆå¥½ï¼Œè‡ªå·±æ‰¾æ‰¾ç­”æ¡ˆæˆ–è€…çœ‹æºç ä¸å¥½ä¹ˆï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578963737,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":72830,"user_name":"äºŒåå››æ¡¥ä»åœ¨","can_delete":false,"product_type":"c1","uid":1232468,"ip_address":"","ucode":"5498FE5949190F","user_header":"https://static001.geekbang.org/account/avatar/00/12/ce/54/c13b1d63.jpg","comment_is_top":false,"comment_ctime":1551746015,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1551746015","product_id":100020801,"comment_content":"UUIDç”Ÿæˆä¸»é”®","like_count":0},{"had_liked":false,"id":66540,"user_name":"éƒ­çƒŠåƒçº","can_delete":false,"product_type":"c1","uid":1302416,"ip_address":"","ucode":"15736D91964DA3","user_header":"https://static001.geekbang.org/account/avatar/00/13/df/90/68408c1b.jpg","comment_is_top":false,"comment_ctime":1549955876,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1549955876","product_id":100020801,"comment_content":"è¯·æ•™è€å¸ˆä¸ªé¢å¤–è¯é¢˜ select concat(truncate(sum(data_length)&#47;1024&#47;1024,2),&#39;MB&#39;) as data_size,<br>concat(truncate(sum(max_data_length)&#47;1024&#47;1024,2),&#39;MB&#39;) as max_data_size,<br>concat(truncate(sum(data_free)&#47;1024&#47;1024,2),&#39;MB&#39;) as data_free,<br>concat(truncate(sum(index_length)&#47;1024&#47;1024,2),&#39;MB&#39;) as index_size<br>from information_schema.tables where TABLE_SCHEMA = &#39;databasename&#39;;  ç½‘ä¸Šå¹¿ä¸ºæµä¼ çš„è¿™ä¸ªç»Ÿè®¡çš„è¡¨å¤§å°çš„æ–¹æ³•å‡†ç¡®å— mysqlå†…éƒ¨æ˜¯æ€ä¹ˆç»Ÿè®¡çš„ï¼Ÿå¹¶ä¸”data_freeè¿™ä¸ªmydqlå†…éƒ¨åˆæ˜¯æ€ä¹ˆç»Ÿè®¡çš„ æ˜¯é‡‡æ ·8ä¸ªé¡µæ¥è¯„ä¼°æ•´è¡¨å— å¹¶ä¸”å®éªŒæ€»æ„Ÿè§‰è¿™æ ·ç»Ÿè®¡ä¸å‡†å•Š åˆ°åº•é è°±å— æ±‚èµæ•™æ±‚èµæ•™å•Š å›°æƒ‘å¥½ä¹…äº† ","like_count":0},{"had_liked":false,"id":66082,"user_name":"aliang","can_delete":false,"product_type":"c1","uid":1149502,"ip_address":"","ucode":"B36B94B362477F","user_header":"https://static001.geekbang.org/account/avatar/00/11/8a/3e/30c05bce.jpg","comment_is_top":false,"comment_ctime":1549873818,"is_pvip":true,"replies":[{"id":"23414","content":"å°±è¡¨ç¤ºè¿˜åœ¨â€œkilledâ€çŠ¶æ€ï¼Œçœ‹ä¸€ä¸‹32ç¯‡å“ˆ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1549879662,"ip_address":"","comment_id":66082,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1549873818","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‰§è¡ŒSELECT `ID`, `USER`, `HOST`, `DB`, `COMMAND`, `TIME`, `STATE`, LEFT(`INFO`, 51200) AS `Info` FROM `information_schema`.`PROCESSLIST`;åä¸æ—¶æœ‰COMMANDä¸ºkilledä½†infoä¸ºnullçš„è¿›ç¨‹ï¼Œè¯·é—®æ˜¯æ€ä¹ˆå›äº‹å‘¢","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438695,"discussion_content":"å°±è¡¨ç¤ºè¿˜åœ¨â€œkilledâ€çŠ¶æ€ï¼Œçœ‹ä¸€ä¸‹32ç¯‡å“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549879662,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":66038,"user_name":"å—å±±","can_delete":false,"product_type":"c1","uid":1119593,"ip_address":"","ucode":"94656FE4A6C378","user_header":"https://static001.geekbang.org/account/avatar/00/11/15/69/187b9968.jpg","comment_is_top":false,"comment_ctime":1549855799,"is_pvip":true,"replies":[{"id":"23397","content":"ç¡®å®æ˜¯è€ƒè™‘å¹¶å‘ , ä¸è¿‡å¹¶ä¸ä¼šæœ‰è¿™ä¸ªç°è±¡å“¦ï¼Œå› ä¸ºä¸€ä¸ªè¯­å¥æ‰§è¡ŒæœŸé—´è¿˜æ˜¯æœ‰ä¸€è‡´æ€§è§†å›¾çš„ã€‚<br><br>æŠŠbinlogåŠ è¿›å»è€ƒè™‘ä¸‹å“ˆ<br>","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1549873324,"ip_address":"","comment_id":66038,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1549855799","product_id":100020801,"comment_content":"é˜²æ­¢insertè¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒåŸè¡¨æœ‰æ–°å¢æ•°æ®ï¼Œè¿›è€Œå¯¼è‡´çš„æ’å…¥æ–°è¡¨çš„æ•°æ®æ¯”åŸè¡¨å°‘","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438684,"discussion_content":"ç¡®å®æ˜¯è€ƒè™‘å¹¶å‘ , ä¸è¿‡å¹¶ä¸ä¼šæœ‰è¿™ä¸ªç°è±¡å“¦ï¼Œå› ä¸ºä¸€ä¸ªè¯­å¥æ‰§è¡ŒæœŸé—´è¿˜æ˜¯æœ‰ä¸€è‡´æ€§è§†å›¾çš„ã€‚\n\næŠŠbinlogåŠ è¿›å»è€ƒè™‘ä¸‹å“ˆ\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549873324,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}