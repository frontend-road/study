{"id":120171,"title":"64 | 容器镜像构建Dockerfile解析","content":"<ul>\n<li>\n<p>代码：<a href=\"https://gitee.com/geektime-geekbang/staffjoy\">https://gitee.com/geektime-geekbang/staffjoy</a></p>\n</li>\n<li>\n<p>课件：<a href=\"https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ\">https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ</a> 提取码: 1aeh</p>\n</li>\n</ul>","comments":[{"had_liked":false,"id":193635,"user_name":"天心","can_delete":false,"product_type":"c3","uid":1378423,"ip_address":"","ucode":"6D0755641D22BB","user_header":"https://static001.geekbang.org/account/avatar/00/15/08/77/50e83495.jpg","comment_is_top":false,"comment_ctime":1584938337,"is_pvip":false,"replies":[{"id":74053,"content":"只是改了时间戳属性，实际并无必要。参考：\nhttps:&#47;&#47;stackoverflow.com&#47;questions&#47;52291579&#47;what-does-touch-in-dockerfile-do","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1585058763,"ip_address":"","comment_id":193635,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"请问老师文件里面的 RUN sh -c &quot;touch xxx.jar&quot;的作用是什么？是为了改变时间戳属性吗？","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488603,"discussion_content":"只是改了时间戳属性，实际并无必要。参考：\nhttps://stackoverflow.com/questions/52291579/what-does-touch-in-dockerfile-do","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585058763,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":193034,"user_name":"arch","can_delete":false,"product_type":"c3","uid":1078931,"ip_address":"","ucode":"A69EBFE0520B85","user_header":"https://static001.geekbang.org/account/avatar/00/10/76/93/2e9bf8ab.jpg","comment_is_top":false,"comment_ctime":1584882760,"is_pvip":true,"replies":[{"id":74033,"content":"是的","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1585057710,"ip_address":"","comment_id":193034,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"多个run最好用&amp;&amp; \\ 连接起来减少中间层，当然也有瘦身工具","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488502,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585057710,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":129919,"user_name":"海水","can_delete":false,"product_type":"c3","uid":1191244,"ip_address":"","ucode":"68D7E454CC0819","user_header":"https://static001.geekbang.org/account/avatar/00/12/2d/4c/983ce1b9.jpg","comment_is_top":false,"comment_ctime":1567326275,"is_pvip":true,"replies":[{"id":48640,"content":"也可以，这样的话，你执行docker build之前必须保证单页html&#47;js文件已经在构建好了在规定目录中，这个依赖必须满足。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1567428011,"ip_address":"","comment_id":129919,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"单页 纯前端的构建放在docker外面构建好了在copy到镜像里面是不是更好，只需要base from nginx","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465717,"discussion_content":"也可以，这样的话，你执行docker build之前必须保证单页html/js文件已经在构建好了在规定目录中，这个依赖必须满足。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567428011,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128040,"user_name":"sdsdkdsj","can_delete":false,"product_type":"c3","uid":1068632,"ip_address":"","ucode":"11905CFCBE7252","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/58/791d0f5e.jpg","comment_is_top":false,"comment_ctime":1566823945,"is_pvip":false,"replies":[{"id":47689,"content":"具体要看你的java程序的打包和运行方式，如果支持环境变量设置jvm内存，就可以在dockerfile中设置环境变量，比如，tomcat支持通过环境变量JAVA_OPTS设置jvm内存，那么可以在dockerfile中设：ENV JAVA_OPTS=&quot;-XX:PermSize=1024m -XX:MaxPermSize=512m&quot;\n\nspring boot jar方式启动，也支持JAVA_OPTS环境变量传参。\n\n参考：\nhttps:&#47;&#47;stackoverflow.com&#47;questions&#47;29923531&#47;how-to-set-java-heap-size-xms-xmx-inside-docker-container","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1566910452,"ip_address":"","comment_id":128040,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"波波老师，请教个问题，dockerfile怎么用环境变量的方式控制java程序的内存呢","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464765,"discussion_content":"具体要看你的java程序的打包和运行方式，如果支持环境变量设置jvm内存，就可以在dockerfile中设置环境变量，比如，tomcat支持通过环境变量JAVA_OPTS设置jvm内存，那么可以在dockerfile中设：ENV JAVA_OPTS=&amp;quot;-XX:PermSize=1024m -XX:MaxPermSize=512m&amp;quot;\n\nspring boot jar方式启动，也支持JAVA_OPTS环境变量传参。\n\n参考：\nhttps://stackoverflow.com/questions/29923531/how-to-set-java-heap-size-xms-xmx-inside-docker-container","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566910452,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":210850,"user_name":"光","can_delete":false,"product_type":"c3","uid":1284618,"ip_address":"","ucode":"BDA7F41566E4FE","user_header":"https://static001.geekbang.org/account/avatar/00/13/9a/0a/6c74e932.jpg","comment_is_top":false,"comment_ctime":1587837846,"is_pvip":false,"replies":[{"id":78524,"content":"多阶段构建，中间的镜像容器，只是用于临时构建生成一些中间的artifacts，生成完这个中间容器就可以丢弃了。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1587906744,"ip_address":"","comment_id":210850,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"多阶段构建是不是只会保留最后一个from 镜像层？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493128,"discussion_content":"多阶段构建，中间的镜像容器，只是用于临时构建生成一些中间的artifacts，生成完这个中间容器就可以丢弃了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587906744,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":320360,"user_name":"w3n9","can_delete":false,"product_type":"c3","uid":1397201,"ip_address":"","ucode":"BC65D8522FAAA4","user_header":"https://static001.geekbang.org/account/avatar/00/15/51/d1/791d0f5e.jpg","comment_is_top":false,"comment_ctime":1636276962,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"为什么前端项目的Dockerfile用了一个node中间容器来构建，而Java项目的Dockerfile却不启动一个maven容器来构建，这里为什么不搞成一致的呢","like_count":1},{"had_liked":false,"id":169868,"user_name":"男朋友","can_delete":false,"product_type":"c3","uid":1601147,"ip_address":"","ucode":"878E436AA2F917","user_header":"","comment_is_top":false,"comment_ctime":1578465228,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"老师RUN命令也会新建一层，最好使用\\&amp;&amp;来拼接吧。","like_count":0}]}