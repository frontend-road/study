{"id":136884,"title":"42 | å®æˆ˜ï¼ˆäºŒï¼‰ï¼šâ€œç”»å›¾â€ç¨‹åºåç«¯å®æˆ˜","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ä¸ƒç‰›äº‘è®¸å¼ä¼Ÿã€‚</p><p>åœ¨ä¸Šä¸€ç« ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ª mock ç‰ˆæœ¬çš„æœåŠ¡ç«¯ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><ul>\n<li><a href=\"https://github.com/qiniu/qpaint/tree/v31/paintdom\">https://github.com/qiniu/qpaint/tree/v31/paintdom</a></li>\n</ul><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†ä¸€æ­¥æ­¥è¿­ä»£ï¼ŒæŠŠå®ƒå˜æˆä¸€ä¸ªäº§å“çº§çš„æœåŠ¡ç«¯ç¨‹åºã€‚</p><p>æˆ‘ä»¬ä¹‹å‰å·²ç»æåˆ°ï¼ŒæœåŠ¡ç«¯ç¨‹åºçš„ä¸šåŠ¡é€»è¾‘è¢«åˆ†ä¸ºä¸¤å±‚ï¼šåº•å±‚æ˜¯ä¸šåŠ¡é€»è¾‘çš„å®ç°å±‚ï¼Œé€šå¸¸æˆ‘ä»¬æœ‰æ„è¯†åœ°æŠŠå®ƒç»„ç»‡ä¸ºä¸€é¢— DOM æ ‘ã€‚ä¸Šå±‚åˆ™æ˜¯ RESTful API å±‚ï¼Œå®ƒè´Ÿè´£æ¥æ”¶ç”¨æˆ·çš„ç½‘ç»œè¯·æ±‚ï¼Œå¹¶è½¬ä¸ºå¯¹åº•å±‚ DOM æ ‘çš„æ–¹æ³•è°ƒç”¨ã€‚</p><p>ä¸Šä¸€è®²æˆ‘ä»¬å…³æ³¨çš„æ˜¯ RESTful API å±‚ã€‚æˆ‘ä»¬ä¸ºäº†å®ç°å®ƒï¼Œå¼•å…¥äº† RPC æ¡†æ¶<a href=\"https://github.com/qiniu/http\"> restrpc</a> å’Œå•å…ƒæµ‹è¯•æ¡†æ¶ <a href=\"https://github.com/qiniu/qiniutest\">qiniutest</a>ã€‚</p><p>è¿™ä¸€è®²æˆ‘ä»¬å…³æ³¨çš„æ˜¯åº•å±‚çš„ä¸šåŠ¡é€»è¾‘å®ç°å±‚ã€‚</p><h2>ä½¿ç”¨ç•Œé¢ï¼ˆæ¥å£ï¼‰</h2><p>æˆ‘ä»¬å…ˆçœ‹ä¸‹è¿™ä¸€å±‚çš„ä½¿ç”¨ç•Œé¢ï¼ˆæ¥å£ï¼‰ã€‚ä» DOM æ ‘çš„è§’åº¦æ¥è¯´ï¼Œåœ¨è¿™ä¸€è®²ä¹‹å‰ï¼Œå®ƒçš„é€»è¾‘ç»“æ„å¦‚ä¸‹ï¼š</p><pre><code>&lt;Drawing1&gt;\n  &lt;Shape11&gt;\n  ...\n  &lt;Shape1M&gt;\n...\n&lt;DrawingN&gt;\n</code></pre><p>ä»å¤§çš„å±‚æ¬¡ç»“æ„æ¥è¯´åªæœ‰ä¸‰å±‚ï¼š</p><ul>\n<li>Document =&gt; Drawing =&gt; Shape</li>\n</ul><p>é‚£ä¹ˆï¼Œåœ¨å¼•å…¥å¤šç§Ÿæˆ·ï¼ˆå³å¤šç”¨æˆ·ï¼Œæ¯ä¸ªç”¨æˆ·æœ‰è‡ªå·±çš„ uidï¼‰ä¹‹åçš„ DOM æ ‘ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæ ·çš„å˜åŒ–ï¼Ÿ</p><p>æ¯”å¦‚æˆ‘ä»¬æ˜¯å¦åº”è¯¥æŠŠå®ƒå˜æˆå››å±‚ï¼š</p><ul>\n<li>Document =&gt; User =&gt; Drawing =&gt; Shape</li>\n</ul><pre><code>&lt;User1&gt;\n  &lt;Drawing11&gt;\n    &lt;Shape111&gt;\n    ...\n    &lt;Shape11M&gt;\n  ...\n  &lt;Drawing1N&gt;\n...\n&lt;UserK&gt;\n</code></pre><!-- [[[read_end]]] --><p>æˆ‘çš„ç­”æ¡ˆæ˜¯ï¼šå¤šç§Ÿæˆ·ä¸åº”è¯¥å½±å“ DOM æ ‘çš„ç»“æ„ã€‚æ‰€ä»¥æ­£ç¡®çš„è®¾è®¡åº”è¯¥æ˜¯ï¼š</p><pre><code>&lt;Drawing1&gt;, éš¶å±äºæŸä¸ª&lt;uid&gt;\n  &lt;Shape11&gt;\n  ...\n  &lt;Shape1M&gt;\n  ...\n&lt;DrawingN&gt;, éš¶å±äºæŸä¸ª&lt;uid&gt;\n</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¤šç§Ÿæˆ·åªä¼šå¯¼è‡´ DOM æ ‘å¤šäº†ä¸€äº›é¢å¤–çš„çº¦å®šï¼Œé€šå¸¸æˆ‘ä»¬åº”è¯¥æŠŠå®ƒçœ‹ä½œæŸç§ç¨‹åº¦çš„å®‰å…¨çº¦å®šï¼Œé¿å…è®¿é—®åˆ°æ²¡æœ‰æƒé™è®¿é—®åˆ°çš„èµ„æºã€‚</p><p>æ‰€ä»¥å¤šç§Ÿæˆ·ä¸ä¼šå¯¼è‡´ DOM å±‚çº§å˜åŒ–ï¼Œä½†æ˜¯å®ƒä¼šå¯¼è‡´æ¥å£æ–¹æ³•çš„å˜åŒ–ã€‚æ¯”å¦‚æˆ‘ä»¬çœ‹ Document ç±»çš„æ–¹æ³•ã€‚ä¹‹å‰ï¼ŒDocument ç±»æ¥å£çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p><pre><code>func (p *Document) Add() (drawing *Drawing, err error)\nfunc (p *Document) Get(dgid string) (drawing *Drawing, err error)\nfunc (p *Document) Delete(dgid string) (err error)\n</code></pre><p>ç°åœ¨å®ƒå˜æˆäº†ï¼š</p><pre><code>// Add åˆ›å»ºæ–°drawingã€‚\nfunc (p *Document) Add(uid UserID) (drawing *Drawing, err error)\n\n// Get è·å–drawingã€‚\n// æˆ‘ä»¬ä¼šæ£€æŸ¥è¦è·å–çš„drawingæ˜¯å¦ä¸ºè¯¥uidæ‰€æ‹¥æœ‰ï¼Œå¦‚æœä¸å±äºåˆ™è·å–ä¼šå¤±è´¥ã€‚\nfunc (p *Document) Get(uid UserID, dgid string) (drawing *Drawing, err error)\n\n// Delete åˆ é™¤drawingã€‚\n// æˆ‘ä»¬ä¼šæ£€æŸ¥è¦åˆ é™¤çš„drawingæ˜¯å¦ä¸ºè¯¥uidæ‰€æ‹¥æœ‰ï¼Œå¦‚æœä¸å±äºåˆ é™¤ä¼šå¤±è´¥ã€‚\nfunc (p *Document) Delete(uid UserID, dgid string) (err error)\n</code></pre><p>æ­£å¦‚æ³¨é‡Šä¸­è¯´çš„é‚£æ ·ï¼Œä¼ å…¥ uid æ˜¯ä¸€ç§çº¦æŸï¼Œæˆ‘ä»¬æ— è®ºæ˜¯è·å–è¿˜æ˜¯åˆ é™¤ drawing ï¼Œéƒ½ä¼šçœ‹è¿™ä¸ª drawing æ˜¯ä¸æ˜¯éš¶å±äºè¯¥ç”¨æˆ·ã€‚</p><p>å¯¹äº QPaint ç¨‹åºæ¥è¯´ï¼ŒDocument ç±»ä¹‹å¤–å…¶ä»–ç±»çš„æ¥å£å€’æ˜¯æ²¡æœ‰å‘ç”Ÿå˜åŒ–ã€‚æ¯”å¦‚ Drawing ç±»çš„æ¥å£å¦‚ä¸‹ï¼š</p><pre><code>func (p *Drawing) GetID() string\nfunc (p *Drawing) Add(shape Shape) (err error)\nfunc (p *Drawing) List() (shapes []Shape, err error)\nfunc (p *Drawing) Get(id ShapeID) (shape Shape, err error)\nfunc (p *Drawing) Set(id ShapeID, shape Shape) (err error)\nfunc (p *Drawing) SetZorder(id ShapeID, zorder string) (err error)\nfunc (p *Drawing) Delete(id ShapeID) (err error)\nfunc (p *Drawing) Sync(shapes []ShapeID, changes []Shape) (err error)\n</code></pre><p>ä½†æ˜¯è¿™åªæ˜¯å› ä¸º QPaint ç¨‹åºçš„ä¸šåŠ¡é€»è¾‘æ¯”è¾ƒç®€å•ã€‚è™½ç„¶æˆ‘ä»¬éœ€è¦æåŠ›é¿å…æ¥å£å› ä¸ºå¤šç§Ÿæˆ·è€Œäº§ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯è¿™ç§å½±å“æœ‰æ—¶å€™å´æ˜¯ä¸å¯é¿å…çš„ã€‚</p><p>å¦å¤–ï¼Œåœ¨æè¿°ç±»çš„ä½¿ç”¨ç•Œé¢æ—¶ï¼Œæˆ‘ä»¬ä¸èƒ½åªæè¿°è¯­è¨€å±‚é¢çš„çº¦å®šã€‚æ¯”å¦‚ä¸Šé¢çš„ Drawing ç±»ï¼Œæˆ‘ä»¬å¼•ç”¨å›¾å½¢ï¼ˆShapeï¼‰å¯¹è±¡æ—¶ï¼Œç”¨çš„æ˜¯ Go è¯­è¨€çš„ interfaceã€‚å¦‚ä¸‹ï¼š</p><pre><code>type ShapeID = string\n\ntype Shape interface {\n    GetID() ShapeID\n}\n</code></pre><p>ä½†æ˜¯ï¼Œæ˜¯ä¸æ˜¯è¿™ä¸€æ¥å£å°±æ˜¯å›¾å½¢ï¼ˆShapeï¼‰çš„å…¨éƒ¨çº¦æŸï¼Ÿ</p><p>ç­”æ¡ˆæ˜¾ç„¶ä¸æ˜¯ã€‚</p><p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªæœ€åŸºæœ¬çš„çº¦æŸï¼šè€ƒè™‘åˆ° Drawing ç±»çš„ List å’Œ Get è¿”å›çš„ Shape å®ä¾‹ï¼Œä¼šè¢«ç›´æ¥ä½œä¸º RESTful API çš„ç»“æœè¿”å›ã€‚æ‰€ä»¥ï¼ŒShape å·²çŸ¥çš„ä¸€å¤§çº¦æŸæ˜¯ï¼Œå…¶ json.Marshal ç»“æœå¿…é¡»ç¬¦åˆ API å±‚çš„é¢„æœŸã€‚</p><p>è‡³äºåœ¨â€œå®æˆ˜äºŒâ€çš„ä»£ç å®ç°ä¸‹ï¼Œæˆ‘ä»¬å¯¹ Shape å®Œæ•´çš„çº¦æŸæ˜¯ä»€ä¹ˆæ ·çš„ï¼Œæ¬¢è¿ä½ ç•™è¨€è®¨è®ºã€‚</p><h2>æ•°æ®ç»“æ„</h2><p>æ˜ç¡®äº†ä½¿ç”¨ç•Œé¢ï¼Œä¸‹ä¸€æ­¥å°±è¦è€ƒè™‘å®ç°ç›¸å…³çš„å†…å®¹ã€‚å¯èƒ½å¤§å®¶éƒ½å¬è¿‡è¿™æ ·ä¸€ä¸ªè¯´æ³•ï¼š</p><blockquote>\n<p>ç¨‹åº = æ•°æ®ç»“æ„ + ç®—æ³•</p>\n</blockquote><p>å®ƒæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æŒ‡å¯¼æ€æƒ³ã€‚æ‰€ä»¥å½“æˆ‘ä»¬è°ˆç¨‹åºçš„å®ç°æ—¶ï¼Œæˆ‘ä»¬æ€»æ˜¯ä»æ•°æ®ç»“æ„å’Œç®—æ³•ä¸¤ä¸ªç»´åº¦å»æè¿°å®ƒã€‚</p><p>æˆ‘ä»¬å…ˆçœ‹æ•°æ®ç»“æ„ã€‚</p><p>å¯¹äºæœåŠ¡ç«¯ç¨‹åºï¼Œæ•°æ®ç»“æ„ä¸å®Œå…¨æ˜¯æˆ‘ä»¬è‡ªå·±èƒ½å¤Ÿåšä¸»çš„ã€‚åœ¨ â€œ<a href=\"https://time.geekbang.org/column/article/127490\">36 | ä¸šåŠ¡çŠ¶æ€ä¸å­˜å‚¨ä¸­é—´ä»¶</a>â€è¿™ä¸€è®²ä¸­æˆ‘ä»¬è¯´è¿‡ï¼Œå­˜å‚¨å³æ•°æ®ç»“æ„ã€‚æ‰€ä»¥ï¼ŒæœåŠ¡ç«¯ç¨‹åºåœ¨æ•°æ®ç»“æ„è¿™ä¸€ç‚¹ä¸Šï¼Œæœ€ä¸ºé‡è¦çš„ä¸€ä»¶äº‹æ˜¯é€‰æ‹©åˆé€‚çš„å­˜å‚¨ä¸­é—´ä»¶ã€‚ç„¶åæˆ‘ä»¬å†åœ¨è¯¥å­˜å‚¨ä¸­é—´ä»¶ä¹‹ä¸Šç»„ç»‡æˆ‘ä»¬çš„æ•°æ®ã€‚</p><p>å¯¹äº QPaint çš„æœåŠ¡ç«¯ç¨‹åºæ¥è¯´ï¼Œæˆ‘ä»¬é€‰æ‹©äº† mongodbã€‚</p><p>ä¸ºä½•æ˜¯ mongodbï¼Œè€Œä¸æ˜¯æŸç§å…³ç³»å‹æ•°æ®åº“ï¼Ÿ</p><p>æœ€é‡è¦çš„ç†ç”±ï¼Œæ˜¯å› ä¸ºå›¾å½¢ï¼ˆShapeï¼‰å¯¹è±¡çš„å¼€æ”¾æ€§ã€‚å› ä¸ºå›¾å½¢çš„ç§ç±»å¾ˆå¤šï¼Œå®ƒçš„ Schema ä¸æ˜¯æˆ‘ä»¬ä»Šå¤©æ‰€èƒ½å¤Ÿæå‰é¢„æœŸçš„ã€‚æ•…æ­¤ï¼Œæ–‡æ¡£å‹æ•°æ®åº“æ›´ä¸ºåˆé€‚ã€‚</p><p>ç¡®å®šäº†åŸºäº mongodb è¿™ä¸ªå­˜å‚¨ä¸­é—´ä»¶ï¼Œæˆ‘ä»¬ä¸‹ä¸€æ­¥å°±æ˜¯å®šä¹‰è¡¨ç»“æ„ã€‚å½“ç„¶è¡¨ï¼ˆTableï¼‰æ˜¯åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­çš„è¯´æ³•ï¼Œåœ¨ mongodb ä¸­æˆ‘ä»¬å«é›†åˆï¼ˆCollectionï¼‰ã€‚ä½†æ˜¯å‡ºäºæƒ¯ä¾‹ï¼Œæˆ‘ä»¬å¾ˆå¤šæ—¶å€™è¿˜æ˜¯ä»¥ â€œå®šä¹‰è¡¨ç»“æ„â€ ä¸€è¯æ¥è¡¨è¾¾æˆ‘ä»¬æƒ³å¹²ä»€ä¹ˆã€‚</p><p>æˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªè¡¨ï¼ˆCollectionï¼‰ï¼šdrawing å’Œ shapeã€‚å…¶ä¸­ï¼Œdrawing è¡¨è®°å½•æ‰€æœ‰çš„ drawingï¼Œè€Œ shape è¡¨è®°å½•æ‰€æœ‰çš„ shapeã€‚å…·ä½“å¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/9f/5b/9ffb0216c8f979633347484bc920d35b.png?wh=495*421\" alt=\"\"></p><p>æˆ‘ä»¬é‡ç‚¹å…³æ³¨ç´¢å¼•çš„è®¾è®¡ã€‚</p><p>åœ¨ drawing è¡¨ä¸­ï¼Œæˆ‘ä»¬ä¸º uid å»ºç«‹äº†ç´¢å¼•ã€‚è¿™ä¸ªæ¯”è¾ƒå®¹æ˜“ç†è§£ï¼šè™½ç„¶ç›®å‰æˆ‘ä»¬æ²¡æœ‰æä¾› List æŸä¸ªç”¨æˆ·æ‰€æœ‰ drawing çš„æ–¹æ³•ï¼Œä½†è¿™æ˜¯è¿Ÿæ—©çš„äº‹æƒ…ã€‚</p><p>åœ¨ shape è¡¨ä¸­ï¼Œæˆ‘ä»¬ä¸º (dgid, spid) å»ºç«‹äº†è”åˆå”¯ä¸€ç´¢å¼•ã€‚è¿™æ˜¯å› ä¸º spid ä½œä¸º ShapeID ï¼Œæ˜¯ drawing å†…éƒ¨å”¯ä¸€çš„ï¼Œè€Œä¸æ˜¯å…¨å±€å”¯ä¸€çš„ã€‚æ‰€ä»¥ï¼Œå®ƒéœ€è¦è”åˆ dgid ä½œä¸ºå”¯ä¸€ç´¢å¼•ã€‚</p><h2>ç®—æ³•</h2><p>è°ˆæ¸…æ¥šäº†æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬æ¥ç€èŠç®—æ³•ã€‚</p><p>åœ¨ â€œç¨‹åº = æ•°æ®ç»“æ„ + ç®—æ³•â€ è¿™ä¸ªè¯´æ³•ä¸­ï¼Œâ€œç®—æ³•â€ æŒ‡çš„æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>åœ¨æ¶æ„è¿‡ç¨‹ä¸­ï¼Œéœ€æ±‚åˆ†æé˜¶æ®µï¼Œæˆ‘ä»¬å…³æ³¨ç”¨æˆ·éœ€æ±‚çš„ç²¾ç¡®è¡¨è¿°ï¼Œæˆ‘ä»¬ä¼šå¼•å…¥è§’è‰²ï¼Œä¹Ÿå°±æ˜¯ç³»ç»Ÿçš„å„ç±»å‚ä¸æ–¹ï¼Œä»¥åŠè§’è‰²é—´çš„äº¤äº’æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·æ•…äº‹ã€‚</p><p>åˆ°äº†è¯¦ç»†è®¾è®¡é˜¶æ®µï¼Œè§’è‰²å’Œç”¨æˆ·æ•…äº‹å°±å˜æˆäº†å­ç³»ç»Ÿã€æ¨¡å—ã€ç±»æˆ–è€…å‡½æ•°çš„ä½¿ç”¨ç•Œé¢ï¼ˆæ¥å£ï¼‰ã€‚æˆ‘ä»¬å‰é¢ä¸€ç›´åœ¨å¼ºè°ƒï¼Œä½¿ç”¨ç•Œé¢ï¼ˆæ¥å£ï¼‰åº”è¯¥è‡ªç„¶ä½“ç°ä¸šåŠ¡éœ€æ±‚ï¼Œå°±æ˜¯å¼ºè°ƒç¨‹åºæ˜¯ä¸ºç”¨æˆ·éœ€æ±‚æœåŠ¡çš„ã€‚è€Œæˆ‘ä»¬çš„æ¶æ„è®¾è®¡ï¼Œåœ¨éœ€æ±‚åˆ†æä¸åç»­çš„æ¦‚è¦è®¾è®¡ã€è¯¦ç»†è®¾è®¡ç­‰è¿‡ç¨‹ä¹‹é—´ä¹Ÿæœ‰è‡ªç„¶çš„å»¶ç»­æ€§ã€‚</p><p>æ‰€ä»¥ç®—æ³•ï¼Œæœ€ç›´ç™½çš„å«ä¹‰ï¼ŒæŒ‡çš„æ˜¯ç”¨æˆ·æ•…äº‹èƒŒåçš„å®ç°æœºåˆ¶ã€‚</p><p>æ•°æ®ç»“æ„ + ç®—æ³•ï¼Œæ˜¯ä¸ºäº†æ»¡è¶³æœ€åˆçš„è§’è‰²ä¸ç”¨æˆ·æ•…äº‹å®šä¹‰ï¼Œè¿™æ˜¯æ¶æ„çš„è¯¦ç»†è®¾è®¡é˜¶æ®µæ ¸å¿ƒå…³æ³¨ç‚¹ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…¸å‹çš„ç”¨æˆ·æ•…äº‹ï¼š</p><p><strong>åˆ›å»ºæ–°drawing (uid):</strong></p><pre><code>dgid = newObjectId()\ndb.drawing.insert({_id: dgid, uid: uid, shapes:[]})\nreturn dgid\n</code></pre><p><strong>å–å¾—drawingçš„å†…å®¹ (uid, dgid):</strong></p><pre><code>doc = db.drawing.findOne({_id: dgid, uid: uid})\nshapes = []\nforeach spid in doc.shapes {\n    o = db.shape.findOne({dgid: dgid, spid: spid})\n    shapes.push(o.shape)\n}\nreturn shapes\n</code></pre><p><strong>åˆ é™¤drawing (uid, dgid):</strong></p><pre><code>if db.drawing.remove({_id: dgid, uid: uid}) { // ç¡®ä¿ç”¨æˆ·å¯åˆ é™¤è¯¥drawing\n    db.shape.remove({dgid: dgid})\n}\n</code></pre><p><strong>åˆ›å»ºæ–°shape (uid, dgid, shape):</strong></p><pre><code>if db.drawing.find({_id: dgid, uid: uid}) { // ç¡®ä¿ç”¨æˆ·å¯ä»¥æ“ä½œè¯¥drawing\n    db.shape.insert({dgid: dgid, spid: shape.id, shape: shape})\n    db.drawing.update({$push: {shapes: shape.id}})\n}\n</code></pre><p><strong>åˆ é™¤shape (uid, dgid, spid):</strong></p><pre><code>if db.drawing.find({_id: dgid, uid: uid}) { // ç¡®ä¿ç”¨æˆ·å¯ä»¥æ“ä½œè¯¥drawing\n    if db.drawing.update({$pull: {shapes: spid}}) {\n        db.shape.remove({dgid: dgid, spid: spid})\n    }\n}\n</code></pre><p>è¿™äº›ç®—æ³•çš„è¡¨è¾¾æ•´ä½“æ˜¯ä¸€ç§ä¼ªä»£ç ã€‚ä½†å®ƒä¹Ÿä¸å®Œå…¨æ˜¯ä¼ªä»£ç ã€‚å¦‚æœå¤§å®¶ç”¨è¿‡ mongo çš„ shell çš„è¯ï¼Œå…¶å®èƒ½å¤ŸçŸ¥é“è¿™é‡Œé¢çš„æ¯ä¸€æ¡ mongo æ•°æ®åº“æ“ä½œçš„ä»£ç éƒ½æ˜¯çœŸå®æœ‰æ•ˆçš„ã€‚</p><p>å¦å¤–ï¼Œä»ä¸¥è°¨çš„è§’åº¦æ¥è¯´ï¼Œä»¥ä¸Šç®—æ³•ä¸­å‡¡æ˜¯æ¶‰åŠåˆ°å¤šæ¬¡ä¿®æ”¹æ“ä½œçš„ï¼Œéƒ½åº”è¯¥ä»¥äº‹åŠ¡å½¢å¼æ¥åšã€‚æ¯”å¦‚åˆ é™¤ drawing çš„ä»£ç ï¼š</p><pre><code>if db.drawing.remove({_id: dgid, uid: uid}) { // ç¡®ä¿ç”¨æˆ·å¯åˆ é™¤è¯¥drawing\n    db.shape.remove({dgid: dgid})\n}\n</code></pre><p>å‡å¦‚ç¬¬ä¸€å¥ drawing è¡¨çš„ remove æ“ä½œæ‰§è¡ŒæˆåŠŸï¼Œä½†æ˜¯åœ¨æ­¤æ—¶å‘ç”Ÿäº†æ•…éšœåœæœºäº‹ä»¶å¯¼è‡´ shape è¡¨çš„ remove æ²¡æœ‰å®Œæˆï¼Œé‚£ä¹ˆä»ç”¨æˆ·çš„ä¸šåŠ¡é€»è¾‘è§’åº¦æ¥è¯´ä¸€åˆ‡éƒ½æ­£å¸¸ï¼Œä½†æ˜¯ä»ç³»ç»Ÿç»´æŠ¤çš„è§’åº¦æ¥è¯´ï¼Œç³»ç»Ÿæ®‹ç•™äº†ä¸€äº›å­¤ç«‹çš„ shape å¯¹è±¡ï¼Œæ°¸è¿œéƒ½æ²¡æœ‰æœºä¼šè¢«æ¸…é™¤ã€‚</p><h2>ç½‘ç»œåè®®</h2><p>è€ƒè™‘åˆ°åº•å±‚çš„ä¸šåŠ¡é€»è¾‘å®ç°å±‚å·²ç»æ”¯æŒå¤šç§Ÿæˆ·ï¼Œæˆ‘ä»¬ç½‘ç»œåè®®ä¹Ÿéœ€è¦åšå‡ºç›¸åº”çš„ä¿®æ”¹ã€‚è¿™ä¸€è®²æˆ‘ä»¬åªåšæœ€ç®€å•çš„è°ƒæ•´ï¼Œå¼•å…¥ä¸€ä¸ª mock çš„æˆæƒæœºåˆ¶ã€‚å¦‚ä¸‹ï¼š</p><pre><code>Authorization QPaintStub &lt;uid&gt;\n</code></pre><p>æ—¢ç„¶æœ‰äº† Authorizationï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸èƒ½ç»§ç»­ç”¨ restrpc.Env ä½œä¸º RPC è¯·æ±‚çš„ç¯å¢ƒäº†ã€‚æˆ‘ä»¬è‡ªå·±å®ç°ä¸€ä¸ª Envï¼Œå¦‚ä¸‹ï¼š</p><pre><code>type Env struct {\n    restrpc.Env\n    UID UserID\n}\n\nfunc (p *Env) OpenEnv(rcvr interface{}, w *http.ResponseWriter, req *http.Request) error {\n    auth := req.Header.Get(&quot;Authorization&quot;)\n    pos := strings.Index(auth, &quot; &quot;)\n    if pos &lt; 0 || auth[:pos] != &quot;QPaintStub&quot; {\n        return errBadToken\n    }\n    uid, err := strconv.Atoi(auth[pos+1:])\n    if err != nil {\n        return errBadToken\n    }\n    p.UID = UserID(uid)\n    return p.Env.OpenEnv(rcvr, w, req)\n}\n</code></pre><p>æŠŠæ‰€æœ‰çš„ restrpc.Env æ›¿æ¢ä¸ºæˆ‘ä»¬è‡ªå·±çš„ Envï¼Œå†å¯¹ä»£ç è¿›è¡Œä¸€äº›å¾®è°ƒï¼ˆDocument ç±»çš„è°ƒç”¨å¢åŠ  env.UID å‚æ•°ï¼‰ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†åŸºæœ¬çš„å¤šç§Ÿæˆ·æ”¹é€ ã€‚</p><p>æ”¹é€ åå®Œæ•´çš„ RESTful API å±‚ä»£ç å¦‚ä¸‹ï¼š</p><ul>\n<li><a href=\"https://github.com/qiniu/qpaint/blob/v42/paintdom/service.go\">https://github.com/qiniu/qpaint/blob/v42/paintdom/service.go</a></li>\n</ul><h2>ç»“è¯­</h2><p>æ€»ç»“ä¸€ä¸‹ä»Šå¤©çš„å†…å®¹ã€‚</p><p>ä»Šå¤©æˆ‘ä»¬ä¸»è¦æ”¹é€ çš„æ˜¯åº•å±‚çš„ä¸šåŠ¡é€»è¾‘å®ç°å±‚ã€‚</p><p>ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å¯¹ä½¿ç”¨ç•Œé¢ï¼ˆæ¥å£ï¼‰ä½œäº†å¤šç§Ÿæˆ·çš„æ”¹é€ ã€‚å¤šç§Ÿæˆ·æ”¹é€ ä»ç½‘ç»œåè®®è§’åº¦æ¥è¯´ï¼Œä¸»è¦æ˜¯å¢åŠ æˆæƒï¼ˆAuthorizationï¼‰ã€‚ä»åº•å±‚çš„ DOM æ¥å£è§’åº¦æ¥è¯´ï¼Œä¸»è¦æ˜¯ Document ç±»å¢åŠ  uid å‚æ•°ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬åŸºäº mongodb å®Œæˆäº†æ–°çš„å®ç°ã€‚æˆ‘ä»¬å¯¹æ•°æ®ç»“æ„å’Œç®—æ³•ä½œäº†è¯¦ç»†çš„æè¿°ã€‚è¦æ›´å®Œæ•´äº†è§£å®ç°ç»†èŠ‚ï¼Œè¯·é‡ç‚¹é˜…è¯»ä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶ï¼š</p><ul>\n<li><a href=\"https://github.com/qiniu/qpaint/blob/v42/paintdom/README_IMPL.md\">https://github.com/qiniu/qpaint/blob/v42/paintdom/README_IMPL.md</a></li>\n<li><a href=\"https://github.com/qiniu/qpaint/blob/v42/paintdom/drawing.go\">https://github.com/qiniu/qpaint/blob/v42/paintdom/drawing.go</a></li>\n</ul><p>å¦‚æœä½ å¯¹ä»Šå¤©çš„å†…å®¹æœ‰ä»€ä¹ˆæ€è€ƒä¸è§£è¯»ï¼Œæ¬¢è¿ç»™æˆ‘ç•™è¨€ï¼Œæˆ‘ä»¬ä¸€èµ·è®¨è®ºã€‚ä¸‹ä¸€è®²å¼€å§‹æˆ‘ä»¬ç»§ç»­å®æˆ˜ã€‚</p><p>å¦‚æœä½ è§‰å¾—æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿæ¬¢è¿æŠŠæ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæˆ‘ä»¬ä¸‹æœŸå†è§ã€‚</p>","comments":[{"had_liked":false,"id":133990,"user_name":"spark","can_delete":false,"product_type":"c1","uid":1116667,"ip_address":"","ucode":"2F128E884F400F","user_header":"https://static001.geekbang.org/account/avatar/00/11/09/fb/52a662b2.jpg","comment_is_top":false,"comment_ctime":1568712140,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"78878123468","product_id":100025201,"comment_content":"è¿™ä¸ªä¸“æ çœ‹åˆ°ç°åœ¨çš„ä½“ä¼š:<br>1.ä½œè€…æ˜¯å¤§ç¥ã€‚ç¥ä¸€æ ·çš„æ€è€ƒå’Œè¡Œä¸ºã€‚<br>2.ä½“ä¼šäº†çœ‹æ‡‚åçš„å¿«ä¹ï¼Œæ— ä»·ä¹‹å®ã€‚<br>3.å¿…é¡»ç£•å¤´æ‰èƒ½è¡¨è¾¾æ•¬æ„ã€‚","like_count":19,"discussions":[{"author":{"id":1112490,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f9/aa/3e80212e.jpg","nickname":"é¾™çŒ«","note":"","ucode":"FD726CC969EF9C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383118,"discussion_content":"ç£•å¤´å¤§å¯ä¸å¿… ğŸ˜‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625908983,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":187797,"user_name":"zhj","can_delete":false,"product_type":"c1","uid":1311772,"ip_address":"","ucode":"65B9E222D6E075","user_header":"https://static001.geekbang.org/account/avatar/00/14/04/1c/b0c6c009.jpg","comment_is_top":false,"comment_ctime":1584244439,"is_pvip":false,"replies":[{"id":"72491","content":"shapeç›´æ¥åœ¨drawingé‡Œé¢å°±æ˜¯ä¸€ä¸ªç”»å›¾docunentä½œä¸ºä¸€ä¸ªæ•´ä½“æ”¾åˆ°æ•°æ®åº“ï¼Œè¿™å›ºç„¶æœ‰ä¼˜ç‚¹ï¼Œä½†æ˜¯å½“documentæ˜¯ä¸€ä¸ªå¤æ‚æ–‡æ¡£æ—¶å°±ä¼šæœ‰å¾ˆä½çš„ç¼–è¾‘æ€§èƒ½ï¼Œæ•°æ®åº“çš„ioæ€§èƒ½ä¹Ÿä¼šå—åˆ°å½±å“ï¼ˆåŸå› æ˜¯å°ä¿®æ”¹å˜æˆäº†å¤§ioï¼‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"è®¸å¼ä¼Ÿ-ä¸ƒç‰›äº‘(å·²æ»¡)","uid":"1228022","ctime":1584262300,"ip_address":"","comment_id":187797,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14469146327","product_id":100025201,"comment_content":"shapeä¸ºä»€ä¹ˆä¸ç›´æ¥è®¾è®¡åœ¨drawingçš„å±‚çº§ç»“æ„ä¸­ï¼Œç°åœ¨ç”¨æ³•è¿˜æ˜¯åå…³ç³»å‹ï¼Œæœ¬èº«monggoä½¿ç”¨ä¹Ÿæ˜¯æ¨å´‡è¿™ç§æ•´ä½“åµŒå¥—ï¼Œè€Œä¸”å¯ä»¥åˆ©ç”¨è¡Œçš„åŸå­æ€§æ¥è§„é¿mongoä¸æ”¯æŒäº‹åŠ¡çš„è½¯è‚‹ï¼Œç›®å‰è¿™æ ·è®¾è®¡åˆè¡·åªæ˜¯ä¸ºäº†äº«æœ‰mongoçš„schema freeï¼Œ","like_count":4,"discussions":[{"author":{"id":1228022,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bc/f6/e61d4b8f.jpg","nickname":"è®¸å¼ä¼Ÿ-ä¸ƒç‰›äº‘(å·²æ»¡)","note":"","ucode":"1A2F8AA6F6DB54","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487245,"discussion_content":"shapeç›´æ¥åœ¨drawingé‡Œé¢å°±æ˜¯ä¸€ä¸ªç”»å›¾docunentä½œä¸ºä¸€ä¸ªæ•´ä½“æ”¾åˆ°æ•°æ®åº“ï¼Œè¿™å›ºç„¶æœ‰ä¼˜ç‚¹ï¼Œä½†æ˜¯å½“documentæ˜¯ä¸€ä¸ªå¤æ‚æ–‡æ¡£æ—¶å°±ä¼šæœ‰å¾ˆä½çš„ç¼–è¾‘æ€§èƒ½ï¼Œæ•°æ®åº“çš„ioæ€§èƒ½ä¹Ÿä¼šå—åˆ°å½±å“ï¼ˆåŸå› æ˜¯å°ä¿®æ”¹å˜æˆäº†å¤§ioï¼‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584262300,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1021825,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/97/81/e1eaf621.jpg","nickname":"David","note":"","ucode":"22CBBC13FC97A9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390136,"discussion_content":"åˆ†å¼€ä¸¤å¼ è¡¨å¯ä»¥å¤ç”¨ ç±»ä¼¼äº«å…ƒæ¨¡å¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629685426,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":144029,"user_name":"Bachue Zhou","can_delete":false,"product_type":"c1","uid":1494491,"ip_address":"","ucode":"3175754775CA32","user_header":"https://static001.geekbang.org/account/avatar/00/16/cd/db/7467ad23.jpg","comment_is_top":false,"comment_ctime":1571828010,"is_pvip":false,"replies":[{"id":"55574","content":"è¿™ç§ç®€å†™ä¸€èˆ¬åœ¨å›¢é˜Ÿå†…æœ‰ç»Ÿä¸€çš„ç¼©å†™è¡¨ï¼Œå¦åˆ™å»ºè®®å…¨ç§°","user_name":"ä½œè€…å›å¤","user_name_real":"è®¸å¼ä¼Ÿ-ä¸ƒç‰›äº‘(å·²æ»¡)","uid":"1228022","ctime":1571839429,"ip_address":"","comment_id":144029,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5866795306","product_id":100025201,"comment_content":"ä»å·¥ç¨‹çš„è§’åº¦çœ‹ï¼Œä¸æ¨èç”¨è¿™ç§éš¾ä»¥ç†è§£çš„ç¼©å†™ï¼Œdgid ä¹çœ‹ä¹‹ä¸‹éå¸¸éš¾ä»¥è®©äººè”æƒ³åˆ° drawingId","like_count":2,"discussions":[{"author":{"id":1228022,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bc/f6/e61d4b8f.jpg","nickname":"è®¸å¼ä¼Ÿ-ä¸ƒç‰›äº‘(å·²æ»¡)","note":"","ucode":"1A2F8AA6F6DB54","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471783,"discussion_content":"è¿™ç§ç®€å†™ä¸€èˆ¬åœ¨å›¢é˜Ÿå†…æœ‰ç»Ÿä¸€çš„ç¼©å†™è¡¨ï¼Œå¦åˆ™å»ºè®®å…¨ç§°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571839429,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":135330,"user_name":"Geek_88604f","can_delete":false,"product_type":"c1","uid":1501234,"ip_address":"","ucode":"33DD1318E53814","user_header":"","comment_is_top":false,"comment_ctime":1569129149,"is_pvip":false,"replies":[{"id":"51916","content":"ä¸æ˜¯å…±äº«domæ ‘ï¼Œè¿™é‡Œå’Œå…±äº«æ²¡ä»€ä¹ˆå…³ç³»ã€‚ä½ å¯ä»¥è®¤ä¸ºuidå’Œä»»ä½•æ™®é€šçš„å˜é‡ä¸€æ ·ï¼Œåªæ˜¯ä¸€ä¸ªæ™®é€šæ•°æ®è€Œå·²ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"è®¸å¼ä¼Ÿ-ä¸ƒç‰›äº‘(å·²æ»¡)","uid":"1228022","ctime":1569151855,"ip_address":"","comment_id":135330,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5864096445","product_id":100025201,"comment_content":"å¤šç§Ÿæˆ·å…±ç”¨ä¸€é¢— DOM æ ‘ï¼Œä¼šä¸ä¼šå­˜åœ¨æ€§èƒ½ç“¶é¢ˆï¼Ÿåœ¨åç»­ç”¨æˆ·æ•°å¢å¤šï¼Œé«˜å¹¶å‘çš„æƒ…å†µä¸‹æ— æ³•æ»¡è¶³è¦æ±‚ï¼Œå­˜åœ¨æ‹†åˆ†çš„è¯‰æ±‚ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1228022,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bc/f6/e61d4b8f.jpg","nickname":"è®¸å¼ä¼Ÿ-ä¸ƒç‰›äº‘(å·²æ»¡)","note":"","ucode":"1A2F8AA6F6DB54","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468144,"discussion_content":"ä¸æ˜¯å…±äº«domæ ‘ï¼Œè¿™é‡Œå’Œå…±äº«æ²¡ä»€ä¹ˆå…³ç³»ã€‚ä½ å¯ä»¥è®¤ä¸ºuidå’Œä»»ä½•æ™®é€šçš„å˜é‡ä¸€æ ·ï¼Œåªæ˜¯ä¸€ä¸ªæ™®é€šæ•°æ®è€Œå·²ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569151855,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":134065,"user_name":"Aaron Cheung","can_delete":false,"product_type":"c1","uid":1079816,"ip_address":"","ucode":"03972759C53667","user_header":"https://static001.geekbang.org/account/avatar/00/10/7a/08/4d3e47dd.jpg","comment_is_top":false,"comment_ctime":1568731227,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5863698523","product_id":100025201,"comment_content":"è¯»äº†å¥½å‡ éæ–‡ç«  å¾ˆæœ‰æ”¶è· æ‰“å¡","like_count":2},{"had_liked":false,"id":290422,"user_name":"ä¸æ¸©æš–å•Šä¸çº¯è‰¯","can_delete":false,"product_type":"c1","uid":2079117,"ip_address":"","ucode":"204474A214E00C","user_header":"https://static001.geekbang.org/account/avatar/00/1f/b9/8d/00bded19.jpg","comment_is_top":false,"comment_ctime":1619535559,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1619535559","product_id":100025201,"comment_content":"ä½¿ç”¨ç•Œé¢é‚£é‡Œï¼Œå•ç§Ÿæˆ·å’Œå¤šç§Ÿæˆ·çš„åŒºåˆ«æ˜¯ï¼Œå½“å˜æˆå¤šç§Ÿæˆ·çš„æ—¶å€™ï¼Œå›¾å½¢ç•Œé¢ä¾¿åŠ å…¥äº†ç”¨æˆ·æ¦‚å¿µï¼Œè®©æ¯ä¸ªç”¨æˆ·ä¸‹é¢éƒ½æ‹¥æœ‰ä¸€ä¸ªç”»å›¾å¯¹è±¡å’Œå›¾å½¢å¯¹è±¡ã€‚é‚£å¦‚æœä¸åŠ å…¥ç”¨æˆ·çš„æ¦‚å¿µå‘¢ï¼Ÿé‚£å½“æˆ‘ä»¬å¯¹å¤–æä¾›æœåŠ¡çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„ç”¨æˆ·éƒ½åœ¨ä½¿ç”¨åŒä¸€ä¸ªç”»å›¾å¯¹è±¡å’Œå›¾å½¢å¯¹è±¡ï¼Œæ¯”å¦‚ç”¨æˆ·aåˆ›å»ºäº†ä¸€ä¸ªåœ†å‹ï¼Œç”¨æˆ·Bçš„ç”µè„‘å±å¹•ä¸ŠåŒæ—¶ä¹Ÿä¼šå‡ºç°ä¸€ä¸ªåœ†å‹ï¼Œè¿™å°±åƒæ˜¯ä¸€ä¸ªé©¬æ¡¶ä¸€æ ·ï¼Œè¦æƒ³è®©100ä¸ªäººåŒæ—¶è§£å†³é—®é¢˜ï¼Œé‚£ä½ å°±å¿…é¡»æä¾›100ä¸ªé©¬æ¡¶ï¼Œè€Œåœ¨ä½¿ç”¨ç•Œé¢ä¸­åŠ å…¥ç”¨æˆ·æ¦‚å¿µå°±æ˜¯è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œä¹Ÿå°±æ˜¯å¤šç§Ÿæˆ·ï¼Œæ¯ä¸ªäººéƒ½æœ‰è‡ªå·±çš„ç‹¬ç«‹ç©ºé—´ã€‚<br><br>å…³äºç”¨æˆ·å’Œè§’è‰²çš„æ—¶å€™ã€‚ä¸€ä¸ªç”¨æˆ·å¯ä»¥æ˜¯å¤šä¸ªè§’è‰²ã€‚é‚£ä¸€ä¸ªè§’è‰²ä¹Ÿå¯ä»¥æœ‰å¤šä¸ªç”¨æˆ·ã€‚ä¸€ä¸ªäººå¯ä»¥æ˜¯é“¶è¡Œç»ç†ï¼Œä¹Ÿå¯ä»¥æ˜¯å­©å­çš„çˆ¶æ¯ï¼Œä¹Ÿå¯ä»¥æ˜¯çˆ¶æ¯çš„å­©å­ã€‚è€Œé“¶è¡Œç»ç†ï¼Œçˆ¶æ¯è¿™ä¸¤ä¸ªè§’è‰²çš„èŒèƒ½å¯ä»¥èµ‹ç»™å¾ˆå¤šäººã€‚<br><br>ç”¨æˆ·æ•…äº‹ã€‚å—¯ï¼Œæˆ‘ç†è§£çš„æ˜¯ç”¨æˆ·å’Œç³»ç»Ÿäº¤äº’çš„è¡Œä¸ºï¼Œæˆ‘æŠŠå®ƒå«åšç”¨æˆ·è¡Œä¸ºï¼Œä¸šåŠ¡ç³»ç»Ÿå°†ä¸€ä¸ªä¸ªç”¨æˆ·çš„è¡Œä¸ºæŠ½è±¡æˆæ¥å£ï¼Œç”¨ç®—æ³•æ¥å®ç°æˆ–æ¨¡æ‹Ÿç”¨æˆ·è¡Œä¸ºã€‚","like_count":1},{"had_liked":false,"id":162226,"user_name":"ä½ ä¸ºå•¥é‚£ä¹ˆç‰›","can_delete":false,"product_type":"c1","uid":1503506,"ip_address":"","ucode":"1ABC604A54A8F6","user_header":"https://static001.geekbang.org/account/avatar/00/16/f1/12/7dac30d6.jpg","comment_is_top":false,"comment_ctime":1576480115,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576480115","product_id":100025201,"comment_content":"çœ‹åˆ°ç°åœ¨ï¼Œå¾ˆå¤šæ¦‚å¿µçš„ç†è§£è¿›ä¸€æ­¥å‡åã€‚","like_count":0},{"had_liked":false,"id":153462,"user_name":"ç¨‹åºå‘˜å°è·ƒ","can_delete":false,"product_type":"c1","uid":1015483,"ip_address":"","ucode":"25BB96E0791A60","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7e/bb/947c329a.jpg","comment_is_top":false,"comment_ctime":1574238998,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1574238998","product_id":100025201,"comment_content":"çœ‹åç«¯å®æˆ˜ï¼Œæ²¡æœ‰åŠ¨GOè¯­è¨€ï¼Œè¿˜å¾—å›å»ç¨å¾®äº†è§£ä¸‹GO","like_count":0},{"had_liked":false,"id":135334,"user_name":"Geek_88604f","can_delete":false,"product_type":"c1","uid":1501234,"ip_address":"","ucode":"33DD1318E53814","user_header":"","comment_is_top":false,"comment_ctime":1569131383,"is_pvip":false,"replies":[{"id":"51917","content":"Shapeå¯¹è±¡çš„çº¦æŸå’Œç½‘ç»œå¹¶æ²¡æœ‰å…³ç³»","user_name":"ä½œè€…å›å¤","user_name_real":"è®¸å¼ä¼Ÿ-ä¸ƒç‰›äº‘(å·²æ»¡)","uid":"1228022","ctime":1569151914,"ip_address":"","comment_id":135334,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1569131383","product_id":100025201,"comment_content":"        å…³äºSharpçš„çº¦æŸæˆ‘è¯•ç€ç†è§£ä¸€ä¸‹ï¼Œè¯­è¨€æ–¹é¢çš„çº¦æŸè€å¸ˆå·²ç»è¯´äº†ä¸¤ç‚¹:ä¸€æ˜¯Drawingç±»é€šè¿‡æ¥å£æ¥å¼•ç”¨Sharpç±»ä»¥å¢åŠ é€šç”¨æ€§ï¼›äºŒæ˜¯è€ƒè™‘åˆ° Drawing ç±»çš„ List å’Œ Get è¿”å›çš„ Shape å®ä¾‹ï¼Œä¼šè¢«ç›´æ¥ä½œä¸º RESTful API çš„ç»“æœè¿”å›ã€‚æ‰€ä»¥ï¼ŒShape çš„ json.Marshal ç»“æœå¿…é¡»ç¬¦åˆ API å±‚çš„é¢„æœŸã€‚<br>        é™¤äº†è¯­è¨€æ–¹é¢çš„çº¦æŸå¤–è¿˜å­˜åœ¨è¯­æ„æ–¹é¢çš„çº¦æŸï¼Œä¸€æ–¹é¢RESTfulè¦æ±‚å¯¹èµ„æºçš„æ“ä½œåªèƒ½æ˜¯POSTã€GETã€PUTã€DELETEï¼›å¦ä¸€æ–¹é¢è€ƒè™‘åˆ°ç½‘ç»œå¯èƒ½å‡ºç°çš„æ•…éšœï¼Œæ¥å£å®ç°è¦å¹‚ç­‰ï¼Œæ”¯æŒé”™è¯¯æˆ–è¶…æ—¶çš„é‡è¯•ã€‚","like_count":0,"discussions":[{"author":{"id":1228022,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bc/f6/e61d4b8f.jpg","nickname":"è®¸å¼ä¼Ÿ-ä¸ƒç‰›äº‘(å·²æ»¡)","note":"","ucode":"1A2F8AA6F6DB54","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468146,"discussion_content":"Shapeå¯¹è±¡çš„çº¦æŸå’Œç½‘ç»œå¹¶æ²¡æœ‰å…³ç³»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569151914,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":134073,"user_name":"å´","can_delete":false,"product_type":"c1","uid":1495840,"ip_address":"","ucode":"4807FB811B2EDC","user_header":"https://static001.geekbang.org/account/avatar/00/16/d3/20/95e71191.jpg","comment_is_top":false,"comment_ctime":1568732901,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568732901","product_id":100025201,"comment_content":"æœ‰æ·±åº¦","like_count":0}]}