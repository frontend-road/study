{"id":73946,"title":"164 | Zuul网关集中令牌校验(Code Review)","content":"","comments":[{"had_liked":false,"id":224409,"user_name":"对与错","can_delete":false,"product_type":"c3","uid":1682027,"ip_address":"","ucode":"EF55733E3BD78B","user_header":"https://static001.geekbang.org/account/avatar/00/19/aa/6b/ab9a072a.jpg","comment_is_top":false,"comment_ctime":1591370860,"is_pvip":false,"replies":[{"id":82678,"content":"已回复","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1591456909,"ip_address":"","comment_id":224409,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"在spring cloud体系中，不同业务线是否需要不同的网关（每个业务线实现自己的网关），因为像认证和权限在不同业务线中都不同，都有着自己的用户和权限，这些应该放在网关上面来实现吧，所以不同业务线是否共用同一个网关","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":497465,"discussion_content":"已回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591456909,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":186180,"user_name":"zhaoni","can_delete":false,"product_type":"c3","uid":1052158,"ip_address":"","ucode":"F317ECD6380984","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqT1ykjFve5LCsFvegqLb8MKrf6ASApsOgm8nRb5icDE7MgzKbia0zUQkxe44tKvpCwQ65QuHo4NVoQ/132","comment_is_top":false,"comment_ctime":1583771828,"is_pvip":false,"replies":[{"id":72007,"content":"上面的集中去IntrospectEndpoint校验，性能上的确是需要考虑的，一般AuthServer需要做集群+缓存，而且要做好HA。有些涉及交易的敏感的场景(比如金融业务)，还是需要集中校验的。\n\n如果你场景不是特别敏感，可以考虑无状态的JWT令牌，在网关上简单校验即可。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1583845645,"ip_address":"","comment_id":186180,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"波波老师，此处网关统一校验令牌，用户可能每个请求都需要发起HTTP请求去IntrospectEndpoint校验，性能上是否有问题？\n如果此处使用的是JWT令牌，直接在zuul网关处验证，是否性能会好很多？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486661,"discussion_content":"上面的集中去IntrospectEndpoint校验，性能上的确是需要考虑的，一般AuthServer需要做集群+缓存，而且要做好HA。有些涉及交易的敏感的场景(比如金融业务)，还是需要集中校验的。\n\n如果你场景不是特别敏感，可以考虑无状态的JWT令牌，在网关上简单校验即可。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583845645,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128555,"user_name":"任鹏斌","can_delete":false,"product_type":"c3","uid":1104086,"ip_address":"","ucode":"34319B05EA6E74","user_header":"https://static001.geekbang.org/account/avatar/00/10/d8/d6/47da34bf.jpg","comment_is_top":false,"comment_ctime":1566900779,"is_pvip":false,"replies":[{"id":47692,"content":"很多企业对于内部的服务，通过网关集中令牌校验之后，一般就可以直接访问内部服务了，就像一个公司的门卫校验工牌后就可以放行了，当然有些后台服务对安全要求比较严格(例如交易支付等)，后台服务可以进一步校验。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1566911078,"ip_address":"","comment_id":128555,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"老师好，这种网关集中校验模式，是不是就不需要再指定资源服务器了？相当于网关校验完，直接访问接口了？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464995,"discussion_content":"很多企业对于内部的服务，通过网关集中令牌校验之后，一般就可以直接访问内部服务了，就像一个公司的门卫校验工牌后就可以放行了，当然有些后台服务对安全要求比较严格(例如交易支付等)，后台服务可以进一步校验。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566911078,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":100842,"user_name":"马里奥的马里奥","can_delete":false,"product_type":"c3","uid":1048423,"ip_address":"","ucode":"6848D9E82B58E3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ff/67/6ffe3a52.jpg","comment_is_top":false,"comment_ctime":1559651419,"is_pvip":false,"replies":[{"id":36631,"content":"你好，Spring Cloud Zuul会自动扫描并加载有Component标注和继承自ZuulFilter的Filter。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1559912417,"ip_address":"","comment_id":100842,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"波波老师你好，定义的ZuulFilter怎么没在代码中看到有使用呢，如果不使用的话，Filter不是不会生效吗。","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452703,"discussion_content":"你好，Spring Cloud Zuul会自动扫描并加载有Component标注和继承自ZuulFilter的Filter。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559912417,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}