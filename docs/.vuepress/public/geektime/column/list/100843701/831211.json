{"id":831211,"title":"02ï½œå·¥å…·ä½¿ç”¨ï¼šä¸‰å¤§åˆ©å™¨å¸®ä½ è¿…é€Ÿä¼˜åŒ–æ€§èƒ½ç“¶é¢ˆ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å¾é€¸ã€‚</p><p>åœ¨ä¸ŠèŠ‚è¯¾ä¸­ï¼Œæˆ‘æåˆ°äº†åˆšå¼€å§‹åšæ€§èƒ½ä¼˜åŒ–å·¥ä½œå¸¸è§çš„3ä¸ªç—›ç‚¹ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å¯¹äºæ€§èƒ½ä¼˜åŒ–çš„æµç¨‹å·²ç»å¿ƒä¸­æœ‰æ•°äº†ã€‚ä»Šå¤©æˆ‘å°±æ¥å¸¦ä½ æ¶ˆé™¤å¦ä¸€ä¸ªç—›ç‚¹ï¼ŒæŒæ¡å¸¸è§çš„Golangæ€§èƒ½ä¼˜åŒ–å·¥å…·ã€‚å®ƒä¹Ÿæ˜¯æœåŠ¡æ€§èƒ½ä¼˜åŒ–æµç¨‹ç¬¬ä¸‰æ­¥â€”â€”åˆ†æç“¶é¢ˆåŸå› çš„åŸºç¡€ã€‚åªè¦èƒ½å¤Ÿçµæ´»è¿ç”¨è¿™äº›å·¥å…·ï¼Œæˆ‘ä»¬å°±èƒ½æ›´å¿«åœ°å®šä½åˆ°ä»£ç ä¼˜åŒ–ç‚¹è¿›è¡Œä¼˜åŒ–ã€‚</p><p>åœ¨ä»‹ç»å·¥å…·ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæƒ³ä¸€æƒ³ï¼Œå½“å‘ç°CPUå’Œå†…å­˜å ç”¨è¿‡é«˜æ—¶ï¼Œä½ ä¼šæ€ä¹ˆæ’æŸ¥èµ„æºå ç”¨é«˜çš„é—®é¢˜å‘¢ï¼Ÿ</p><h2>pprofå·¥å…·ï¼šæ˜¯ä»€ä¹ˆå¯¼è‡´äº†é«˜CPUå’Œå†…å­˜å ç”¨?</h2><p>ä¸ºäº†åˆ†æCPUå’Œå†…å­˜èµ„æºå ç”¨é«˜çš„åŸå› ï¼Œæˆ‘ä»¬çš„é¦–è¦ä»»åŠ¡ä¾¿æ˜¯ç²¾å‡†æ‰¾å‡ºé‚£äº›<strong>æ¶ˆè€—å¤§é‡ CPU èµ„æºä»¥åŠé¢‘ç¹è¿›è¡Œå†…å­˜åˆ†é…çš„çƒ­ç‚¹ä»£ç </strong>ã€‚åœ¨é”å®šè¿™äº›çƒ­ç‚¹ä»£ç ä¹‹åï¼Œæˆ‘ä»¬æ‰èƒ½ç´§å¯†ç»“åˆä»£ç çš„ä¸Šä¸‹æ–‡ï¼Œæ‰¾åˆ°æ¶ˆè€—èµ„æºçš„åŸå› ã€‚å€¼å¾—åº†å¹¸çš„æ˜¯ï¼ŒGolang çš„ç”Ÿæ€ä½“ç³»ä¸ºæˆ‘ä»¬æä¾›äº†å¿«é€Ÿå®šä½çƒ­ç‚¹ä»£ç çš„å·¥å…·â€”â€”pprofã€‚</p><p>pprof å…·æœ‰å¼ºå¤§çš„åŠŸèƒ½ï¼Œå®ƒèƒ½å¤Ÿå®šæ—¶é’ˆå¯¹æ­£åœ¨è¿è¡Œçš„ Go ç¨‹åºå±•å¼€é‡‡æ ·æ“ä½œã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå®ƒä¼šå…¨é¢æœé›†ç¨‹åºè¿è¡Œæ—¶çš„å„ç±»å †æ ˆä¿¡æ¯ï¼Œåƒæ˜¯é‚£äº›æ¶ˆè€—å¤§é‡ CPU èµ„æºçš„ä»£ç ç‰‡æ®µæ‰€åœ¨ä½ç½®ï¼Œä»¥åŠå†…å­˜åˆ†é…çš„å…·ä½“æƒ…å†µç­‰ã€‚éšåï¼Œpprof ä¼šä¾æ®æ‰€æœé›†åˆ°çš„è¿™äº›ä¸°å¯Œä¿¡æ¯ï¼Œç»è¿‡ä¸€ç³»åˆ—ç»†è‡´çš„ç»Ÿè®¡åˆ†æï¼Œç”Ÿæˆå¯è§†åŒ–çš„æ€§èƒ½æŠ¥å‘Šä¾›æˆ‘ä»¬æŸ¥çœ‹ã€‚</p><!-- [[[read_end]]] --><p>å¦‚æ­¤å¼ºå¤§çš„ pprofï¼Œæˆ‘ä»¬åˆè¯¥å¦‚ä½•å»ä½¿ç”¨å®ƒå‘¢ï¼Ÿ</p><p>é¦–å…ˆä½ éœ€è¦è§¦å‘pprofé‡‡é›†æ€§èƒ½æ•°æ®å¹¶ç”Ÿæˆæ€§èƒ½æŠ¥å‘Šã€‚pprofæ”¯æŒå¤šç§é‡‡é›†è§¦å‘æ–¹å¼ã€‚åœ¨å®è·µä¸­çš„å¤§å¤šæ•°åœºæ™¯ï¼Œæˆ‘ä»¬ä¼šå¼•å…¥net/http/pprofåŒ…ï¼Œå¹¶åœ¨mainå‡½æ•°ä¸­å¼€æ”¾httpç«¯å£ã€‚ä½ å¯ä»¥å‚è€ƒåé¢çš„ä»£ç ã€‚</p><pre><code class=\"language-go\">import (\n    \"net/http\"\n    _ \"net/http/pprof\"\n)\n\nfunc main() {\n    err := http.ListenAndServe(\":8888\", nil)\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre><p>ç¨‹åºè·‘èµ·æ¥åï¼Œè®¿é—®ä¸‹é¢çš„urlï¼Œæˆ‘ä»¬å°±èƒ½å¾—åˆ°ä¸€ä¸ªè§¦å‘é‡‡é›†çš„é¡µé¢ã€‚ç„¶ååœ¨é‡‡é›†é¡µé¢ç‚¹å‡»å…·ä½“çš„é‡‡æ ·ç±»å‹ï¼Œå°±èƒ½è§¦å‘é‡‡æ ·å¹¶ç”Ÿæˆæ€§èƒ½æŠ¥å‘Šã€‚</p><pre><code class=\"language-shell\">http://127.0.0.1:8888/debug/pprof/\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/a1/12/a1d2947031d1de31e0cd102b45246112.jpg?wh=6200x3184\" alt=\"\" title=\"å›¾1 pprof è§¦å‘é‡‡é›†é¡µé¢\"></p><p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸é€šè¿‡ä¸Šé¢çš„é¡µé¢è§¦å‘æ€§èƒ½æ•°æ®é‡‡é›†ï¼Œè€Œæ˜¯ç›´æ¥è®¿é—®urlå¹¶æ·»åŠ å‚æ•°æ¥æ§åˆ¶é‡‡é›†çš„æ—¶é•¿ï¼Œå°±åƒä¸‹é¢è¿™æ ·ã€‚</p><pre><code class=\"language-plain\"> curl \"http://127.0.0.1:8888/debug/pprof/profile?seconds=30\" &gt; profile.pprof\n</code></pre><p>åœ¨è¿™äº›é‡‡æ ·ç±»å‹é‡Œï¼Œå¸¸ç”¨çš„æœ‰ä¸‹é¢ä¸¤ç±»ï¼š</p><ul>\n<li>\n<p>profileé‡‡æ ·ï¼Œä¹Ÿå°±æ˜¯cpué‡‡æ ·ï¼Œç”¨äºç¡®å®šç¨‹åºä¸­å“ªäº›å‡½æ•°æˆ–ä»£ç ç‰‡æ®µåœ¨è¿è¡Œæ—¶æ¶ˆè€—äº†å¤§é‡çš„ CPU æ—¶é—´ï¼Œå¸®åŠ©å®šä½ CPU æ€§èƒ½ç“¶é¢ˆã€‚</p>\n</li>\n<li>\n<p>å†…å­˜åˆ†é…é‡‡æ ·ï¼Œå…·ä½“åŒ…æ‹¬allocsé‡‡æ ·å’Œheapé‡‡æ ·ã€‚å…¶ä¸­ï¼Œallocs é‡‡æ ·ä¾§é‡äºå®šä½é‚£äº›é¢‘ç¹è¿›è¡Œå†…å­˜åˆ†é…çš„å‡½æ•°ï¼Œè€Œ heap é‡‡æ ·ç”¨äºæŸ¥çœ‹å­˜æ´»å¯¹è±¡çš„å†…å­˜åˆ†é…æƒ…å†µï¼Œä¾§é‡äºå®šä½å†…å­˜æ³„æ¼é—®é¢˜ã€‚</p>\n</li>\n</ul><p>å¯¹äºä¸èƒ½é‡‡ç”¨å¼€æ”¾httpç«¯å£è§¦å‘æ€§èƒ½æ•°æ®é‡‡é›†çš„åœºæ™¯ï¼Œæ¯”å¦‚åœ¨ç¨‹åºå¯åŠ¨åˆå§‹åŒ–æ—¶ï¼Œhttpç«¯å£è¿˜æœªå¼€æ”¾ï¼Œæ— æ³•é€šè¿‡urlè§¦å‘é‡‡é›†æ€§èƒ½æ•°æ®ã€‚Golangæä¾›äº†runtime/pprofåŒ…ï¼Œåƒä¸‹é¢çš„ä»£ç ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥æ˜¾å¼åœ°è§¦å‘å’Œç»“æŸæ€§èƒ½æ•°æ®é‡‡é›†ã€‚</p><pre><code class=\"language-go\">import (\n    \"runtime/pprof\"\n)\n\nfunc main() {\n    // cpué‡‡æ ·\n    f, err := os.Create(\"profile.pprof\")\n    if err != nil {\n        panic(err)\n    }\n    defer f.Close()\n\n    if err := pprof.StartCPUProfile(f); err != nil {\n        panic(err)\n    }\n    defer pprof.StopCPUProfile()\n    // è¿è¡Œä¸šåŠ¡é€»è¾‘\n    expensiveCPU()\n}\n\nfunc main() {\n    // å †å†…å­˜åˆ†é…é‡‡æ ·\n    f, err := os.Create(\"heap.pprof\")\n    if err != nil {\n        panic(err)\n    }\n    defer f.Close()\n\n    runtime.GC()\n    // ä¸šåŠ¡é€»è¾‘\n    expensiveMem()\n\n    if err := pprof.WriteHeapProfile(f); err != nil {\n        panic(err)\n    }\n}\n</code></pre><p>æ¥ä¸‹æ¥å°±æ˜¯å°†æ€§èƒ½æŠ¥å‘Šå¯è§†åŒ–çš„ç¯èŠ‚ã€‚Golangæä¾›äº†å¯è§†åŒ–å±•ç¤ºå·¥å…·pprofï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼Œå¯åŠ¨ä¸€ä¸ªWebç•Œé¢æŸ¥çœ‹ï¼ˆ<strong>å¯è§†åŒ–ç•Œé¢éœ€è¦æå‰å®‰è£…graphviz</strong>ï¼‰ã€‚</p><pre><code class=\"language-plain\">go tool pprof -http :8889 profile.pprof\n</code></pre><p>æˆ‘ä»¬è¿›å…¥åˆ°å¯è§†åŒ–é¡µé¢åï¼Œä¼šå‘ç°å­˜åœ¨å¤šä¸ªå±•ç¤ºå½¢å¼å„å¼‚çš„è§†å›¾ã€‚åœ¨å®é™…åº”ç”¨å½“ä¸­ï¼Œç«ç„°å›¾ï¼ˆFlame Graphï¼‰å› ä¸ºæ¯”è¾ƒç›´è§‚ï¼Œæ‰€ä»¥ç”¨å¾—æœ€å¹¿æ³›ã€‚ç«ç„°å›¾æ˜¯æŒ‰ç…§è‡ªé¡¶å‘ä¸‹çš„æ–¹å¼æ¥å‘ˆç°çš„ï¼Œè¿™ç§æ’åˆ—æ–¹å¼èƒ½å¤Ÿæ¸…æ™°åœ°å±•ç¤ºå‡ºå‡½æ•°ä¹‹é—´çš„è°ƒç”¨å…³ç³»ã€‚æ­¤å¤–ï¼Œåœ¨ç«ç„°å›¾ä¸­ï¼Œæ¯ä¸€ä¸ªæ¨ªæ¡çš„é•¿åº¦ä¹Ÿæœ‰æ„ä¹‰ï¼Œæ¨ªæ¡è¶Šé•¿ï¼Œå°±æ„å‘³ç€å…¶æ‰€å¯¹åº”çš„èµ„æºæ¶ˆè€—æˆ–è€…å ç”¨çš„æƒ…å†µè¶Šä¸¥é‡ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/92/d2/92c04a0300284f95cd99d6b1cfbcd0d2.jpg?wh=2898x942\" alt=\"\" title=\"å›¾2 å¯è§†åŒ–è§†å›¾\"></p><p>ä¸è¿‡è¿™é‡Œéœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œå°½ç®¡ä½ å¯èƒ½ä¼šçœ‹åˆ°æŸä¸ªå‡½æ•°å¯¹åº”çš„æ¨ªæ¡å¾ˆé•¿ï¼Œä½†å®é™…ä¸Šè¿™æœ‰å¯èƒ½æ˜¯<strong>ç”±å…¶ä¸‹å±‚çš„ â€œå­è°ƒç”¨â€ æ‰€è€—è´¹çš„èµ„æºç´¯åŠ å¯¼è‡´çš„</strong>ã€‚æ‰€ä»¥ï¼Œåœ¨åˆ†æçš„æ—¶å€™ï¼ŒåŠ¡å¿…è¦ç€é‡å…³æ³¨ â€œä¸‹ä¸€å±‚å­è°ƒç”¨â€ å„è‡ªçš„èµ„æºæ¶ˆè€—åˆ†å¸ƒæƒ…å†µã€‚</p><p>æ¯”å¦‚ä¸‹é¢çš„CPUç«ç„°å›¾ï¼Œè™½ç„¶æˆ‘ä»¬ç›´æ¥çœ‹åˆ°çš„æ˜¯expensiveCPUå‡½æ•°æ¶ˆè€—æ¯”è¾ƒé«˜ï¼Œä½†è¿™ä¸»è¦æ˜¯ä¸‹å±‚å‡½æ•°rand.Float32å¯¼è‡´çš„ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/3c/b1/3c982b5dc68f983f9def9a0a8f562cb1.jpg?wh=2898x828\" alt=\"\" title=\"å›¾3 CPU ç«ç„°å›¾\"></p><p>åˆæ¯”å¦‚ä¸‹é¢çš„å†…å­˜ç«ç„°å›¾ï¼Œè™½ç„¶è¡¨é¢æ˜¯main.mainå‡½æ•°çš„å†…å­˜åˆ†é…æ¯”è¾ƒé«˜ï¼Œä½†ä¸»è¦ä¹Ÿæ˜¯ä¸‹å±‚å‡½æ•°expensiveMemå¯¼è‡´çš„ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b8/79/b8eb6efefb2a1218f6a0yy80cdfe0c79.jpg?wh=2898x770\" alt=\"\" title=\"å›¾4 å†…å­˜ç«ç„°å›¾\"></p><p>åˆ©ç”¨ç«ç„°å›¾å®šä½åˆ°æ¶ˆè€—CPUå’Œå†…å­˜èµ„æºçš„çƒ­ç‚¹å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å³é”®ç‚¹å‡»ï¼Œå®šä½åˆ°å…·ä½“çš„ä»£ç ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/bf/8b/bf305eb004e53ed229dc3884bd67478b.jpg?wh=2888x768\" alt=\"\"><br>\n<img src=\"https://static001.geekbang.org/resource/image/bd/10/bd8bef435b64962faab3fe3d14d35510.jpg?wh=1544x1072\" alt=\"\" title=\"å›¾5 å†…å­˜åˆ†é…çƒ­ç‚¹ä»£ç \"></p><p>è¿ç”¨ pprof å·¥å…·ï¼Œæˆ‘ä»¬èƒ½å¤Ÿç²¾å‡†å®šä½åˆ°é‚£äº›æ¶ˆè€— CPU ä»¥åŠå†…å­˜èµ„æºçš„çƒ­ç‚¹ä»£ç åŒºåŸŸã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œè¿˜å¯ä»¥ç»“åˆç›¸å…³ä»£ç çš„ä¸Šä¸‹æ–‡ç¯å¢ƒæ¥æ·±å…¥åˆ†æå‡ºç°è¿™ç§æƒ…å†µçš„å…·ä½“åŸå› ã€‚</p><h2>benchmarkåŠŸèƒ½ï¼šå¦‚ä½•åˆ¤æ–­ä½ çš„æ–¹æ¡ˆæ˜¯å¯è¡Œçš„?</h2><p>ç„¶è€Œï¼Œå½“æˆ‘ä»¬å·²ç»æˆåŠŸæ‰¾å‡ºé—®é¢˜äº§ç”Ÿçš„åŸå› ï¼Œå¹¶ä¸”ç€æ‰‹å»è°ƒç ”å„ç§ä¼˜åŒ–æ–¹æ¡ˆçš„æ—¶å€™ï¼Œåˆè¯¥å¦‚ä½•åˆ¤æ–­æˆ‘ä»¬æ‰€åˆ¶å®šçš„ä¼˜åŒ–æ–¹æ¡ˆæ˜¯å¦å¯è¡Œï¼Œå°¤å…¶æ˜¯å®ƒæ¯”èµ·åŸæ¥çš„æ–¹æ¡ˆç©¶ç«Ÿèƒ½å¤Ÿå¸¦æ¥å¤šå¤§ç¨‹åº¦çš„æ€§èƒ½æå‡å‘¢ï¼Ÿ</p><p>åœ¨è¿›è¡Œæ–¹æ¡ˆè°ƒç ”çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦é’ˆå¯¹å„ä¸ªä¼˜åŒ–ç‚¹å¼€å±•ä¼˜åŒ–å‰åçš„æ€§èƒ½å¯¹æ¯”æµ‹è¯•å·¥ä½œã€‚è€Œ Golang çš„æµ‹è¯•æ¡†æ¶ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€é¡¹ååˆ†æœ‰ç”¨çš„åŸºå‡†æµ‹è¯•åŠŸèƒ½ï¼Œå®ƒå°±æ˜¯ benchmarkã€‚</p><p><strong>benchmark èƒ½å¤ŸååŠ©æˆ‘ä»¬å¯¹ä»£ç çš„æ€§èƒ½çŠ¶å†µè¿›è¡Œè¯„ä¼°ï¼Œå®ƒä¸»è¦çš„æ“ä½œæ–¹å¼æ˜¯åœ¨è§„å®šçš„ä¸€æ®µæ—¶é—´å†…ï¼Œä¸æ–­åœ°é‡å¤è¿è¡Œå¾…æµ‹è¯•çš„ä»£ç ï¼Œéšåè¾“å‡ºä»£ç çš„æ‰§è¡Œæ¬¡æ•°ã€å•æ¬¡è¿è¡Œçš„æ—¶é—´å’Œå†…å­˜åˆ†é…çš„ç›¸å…³ç»“æœã€‚</strong></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ©ç”¨ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹æ¥å¯¹æ­¤è¿›è¡ŒéªŒè¯ï¼Œçœ‹çœ‹å°†å­—èŠ‚åˆ‡ç‰‡è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„ä¸¤ç§ä¸åŒå®ç°æ–¹å¼ï¼Œç©¶ç«Ÿå“ªä¸€ç§é€Ÿåº¦ä¼šæ›´å¿«ä¸€äº›ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€æ®µç”¨äºåŸºå‡†æµ‹è¯•çš„ä»£ç ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p><pre><code class=\"language-go\">func BenchmarkBytes2StrRaw(b *testing.B) {\n    aa := []byte(\"abcdefg\")\n    for n := 0; n &lt; b.N; n++ {\n        Bytes2StrRaw(aa)\n    }\n}\nfunc BenchmarkBytes2StrUnsafe(b *testing.B) {\n    aa := []byte(\"abcdefg\")\n    for n := 0; n &lt; b.N; n++ {\n        Bytes2StrUnsafe(aa)\n    }\n}\n\nfunc Bytes2StrRaw(b []byte) string {\n    return string(b)\n}\n\nfunc Bytes2StrUnsafe(b []byte) string {\n    return *(*string)(unsafe.Pointer(&amp;b))\n}\n</code></pre><p>è¿è¡Œä¸‹é¢çš„go testå‘½ä»¤ï¼Œå³å¯è§¦å‘benchmarkè¿è¡Œã€‚</p><pre><code class=\"language-shell\"># -bench è¡¨ç¤ºéœ€è¦benchmarkè¿è¡Œçš„æ–¹æ³•,.è¡¨ç¤ºè¿è¡Œæœ¬ç›®å½•æ‰€æœ‰Benchmarkå¼€å¤´çš„æ–¹æ³•\n# -benchmem æ˜¾ç¤ºä¸å†…å­˜åˆ†é…ç›¸å…³çš„è¯¦ç»†ä¿¡æ¯\n# -benchtime è®¾å®šæ¯ä¸ªåŸºå‡†æµ‹è¯•ç”¨ä¾‹çš„è¿è¡Œæ—¶é—´\n# -cpuprofile ç”Ÿæˆ CPU æ€§èƒ½åˆ†ææ–‡ä»¶\n# -memprofile ç”Ÿæˆå†…å­˜æ€§èƒ½åˆ†ææ–‡ä»¶\ngo test -bench='.' -benchmem -benchtime=10s -cpuprofile='cpu.prof' -memprofile='mem.prof'\n</code></pre><p>ä¸‹é¢æ˜¯benchmarkè¾“å‡ºçš„ç»“æœï¼Œé€šè¿‡å•æ¬¡è¿è¡Œæ¶ˆè€—çš„æ—¶é—´ï¼Œæˆ‘ä»¬å‘ç°ï¼Œä¸‹é¢è¿™ç§å­—èŠ‚åˆ‡ç‰‡è½¬å­—ç¬¦ä¸²çš„æ–¹å¼æ¯”ä¸Šé¢é‚£ç§æ›´å¿«ã€‚</p><pre><code class=\"language-shell\">#ä»å·¦åˆ°å³åˆ†åˆ«è¡¨ç¤ºbenchmarkå‡½æ•°ã€è¿è¡Œæ¬¡æ•°ã€å•æ¬¡è¿è¡Œæ¶ˆè€—çš„æ—¶é—´ã€å•æ¬¡è¿è¡Œå†…å­˜åˆ†é…çš„å­—èŠ‚æ•°å’Œæ¬¡æ•°\nBenchmarkBytes2StrRaw-4         442384430               26.62 ns/op            8 B/op          1 allocs/op\nBenchmarkBytes2StrUnsafe-4      1000000000               1.524 ns/op           0 B/op          0 allocs/op\n</code></pre><h2>traceå·¥å…·ï¼šæ˜¯ä»€ä¹ˆå¯¼è‡´äº†æ¥å£å“åº”å»¶æ—¶é«˜?</h2><p>å°½ç®¡æˆ‘ä»¬æ‹¥æœ‰ pprof è¿™æ ·å ªç§°ç¥å™¨çš„å·¥å…·ï¼Œç„¶è€Œå®ƒæ‰€å‘ˆç°çš„ä»…ä»…æ˜¯<strong>åŸºäºé‡‡æ ·åå¾—åˆ°çš„èšåˆä¿¡æ¯ï¼Œå¹¶ä¸åŒ…å«åç¨‹è¿è¡Œçš„è¯¦ç»†æƒ…å†µ</strong>ã€‚å› æ­¤é¢å¯¹åé¢è¿™ç±»éœ€æ±‚æ—¶ï¼Œå®ƒå°±çˆ±è«èƒ½åŠ©äº†ï¼Œæ¯”å¦‚è¯´ï¼Œå½“æˆ‘ä»¬é‡åˆ°æ¥å£å»¶æ—¶æ˜æ˜¾åé«˜çš„æƒ…å†µï¼Œæ­¤æ—¶è‹¥æƒ³è¦æ·±å…¥äº†è§£åç¨‹å…·ä½“æ˜¯å¦‚ä½•è¿è¡Œçš„è¯¦ç»†ä¿¡æ¯ï¼Œåƒæ˜¯ç©¶ç«Ÿå“ªä¸ªåç¨‹çš„è¿è¡Œæ—¶é•¿æ¯”è¾ƒé•¿ï¼Œåˆæˆ–è€…æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´äº†åç¨‹çš„è¿è¡Œå—åˆ°é˜»å¡ç­‰ç­‰ã€‚</p><p>ä¸è¿‡å¥½åœ¨ Golang è¿˜ä¸ºæˆ‘ä»¬æä¾›äº†å¦å¤–ä¸€æ¬¾ååˆ†æœ‰ç”¨çš„å·¥å…·â€”â€”traceã€‚</p><p>å½“æˆ‘ä»¬å¼€å¯ trace åŠŸèƒ½ä¹‹åï¼Œç¨‹åºä¾¿ä¼š<strong>å¯¹ä¸‹é¢çš„ä¸€ç³»åˆ—äº‹ä»¶è¿›è¡Œè¯¦ç»†è®°å½•ï¼Œå¹¶ä¸”ä¼šä¾æ®æ‰€æœé›†åˆ°çš„è¿™äº›ä¿¡æ¯ï¼Œç”Ÿæˆèƒ½å¤Ÿä»¥å¯è§†åŒ–æ–¹å¼æŸ¥çœ‹çš„ trace è§†å›¾</strong>ã€‚å…·ä½“è®°å½•çš„äº‹ä»¶å¦‚ä¸‹ï¼š</p><ol>\n<li><strong>åç¨‹çš„åˆ›å»ºè¿‡ç¨‹ã€å¼€å§‹è¿è¡Œçš„æ—¶åˆ»ä»¥åŠç»“æŸè¿è¡Œçš„æ—¶é—´ç‚¹ã€‚</strong></li>\n<li><strong>åç¨‹ç”±äºç³»ç»Ÿè°ƒç”¨ã€é€šé“æ“ä½œã€é”çš„ä½¿ç”¨ç­‰æƒ…å†µè€Œå‡ºç°è¢«é˜»å¡çš„ç°è±¡ã€‚</strong></li>\n<li><strong>ç½‘ç»œ IO ç›¸å…³çš„æ“ä½œæƒ…å†µã€‚</strong></li>\n<li><strong>åƒåœ¾æ”¶é›†çš„ç›¸å…³æ´»åŠ¨æƒ…å†µã€‚</strong></li>\n</ol><p>é‚£ä¹ˆtraceè¯¥å¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œå’Œpprofä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦è§¦å‘é‡‡é›†traceæ•°æ®å¹¶ç”ŸæˆtraceæŠ¥å‘Šã€‚traceä¹Ÿæ”¯æŒå¤šç§é‡‡é›†è§¦å‘æ–¹å¼ã€‚</p><p>é€šå¸¸å¯¹äºçº¿ä¸Šåº”ç”¨ï¼Œæˆ‘ä»¬ä¼šå¼•å…¥net/http/pprofåŒ…ï¼Œå¹¶åœ¨mainå‡½æ•°ä¸­å¼€æ”¾httpç«¯å£ã€‚åé¢æ˜¯ç¤ºä¾‹ä»£ç ã€‚</p><pre><code class=\"language-go\">import (\n    \"net/http\"\n    _ \"net/http/pprof\"\n)\n\nfunc main() {\n    err := http.ListenAndServe(\":8888\", nil)\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre><p>ç¨‹åºè·‘èµ·æ¥åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç›´æ¥è®¿é—®urlå¹¶åŠ å‚æ•°æ§åˆ¶è§¦å‘é‡‡é›†ï¼Œå°±åƒä¸‹é¢è¿™æ ·ã€‚</p><pre><code class=\"language-shell\">curl \"http://localhost:8888/debug/pprof/trace?seconds=30\" &gt; trace.out\n</code></pre><p>å¯¹äºä¸èƒ½é‡‡ç”¨å¼€æ”¾httpç«¯å£é‡‡é›†traceæ•°æ®çš„åœºæ™¯ï¼ŒGolangæä¾›äº†runtime/traceåŒ…ï¼Œåƒä¸‹é¢çš„ä»£ç ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ä»£ç ä¸­æ˜¾å¼çš„è§¦å‘å’Œç»“æŸtraceï¼Œæ¥ç”ŸæˆtraceæŠ¥å‘Šã€‚</p><pre><code class=\"language-go\">import (\n    \"runtime/trace\"\n)\n\n// åŸ‹ç‚¹è§¦å‘çš„æ–¹å¼\nfunc main() {\n    // åˆ›å»ºtraceæ€§èƒ½åˆ†ææ–‡ä»¶\n    f, err := os.Create(\"trace.out\")\n    if err != nil {\n        panic(err)\n    }\n    defer f.Close()\n\n    if err := trace.Start(f); err != nil {\n        log.Fatalf(\"failed to start trace: %v\", err)\n    }\n    defer trace.Stop()\n\n    // your program here\n    RunMyProgram()\n}\n</code></pre><p>ç”Ÿæˆäº†æŠ¥å‘Šä»¥åï¼Œæˆ‘ä»¬ç”¨traceå·¥å…·æ‰“å¼€æ–‡ä»¶ï¼Œé¦–é¡µåŒ…å«äº†å¤šä¸ªé“¾æ¥ã€‚æˆ‘ä»¬ä¸€èˆ¬é‡ç‚¹å…³æ³¨ä¸‹é¢ä¸¤ä¸ªå†…å®¹ï¼Œå®ƒä»¬ä¼šåˆ†åˆ«ä»å¤„ç†å™¨è§†è§’å’Œåç¨‹è§†è§’åˆ†æç¨‹åºçš„è¿è¡Œæƒ…å†µã€‚</p><pre><code class=\"language-plain\">go tool trace trace.out\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/d2/30/d269d7350fe89b171e55d70210ce9230.jpg?wh=3713x2863\" alt=\"\" title=\"å›¾6 trace æŠ¥å‘Šé¦–é¡µ\"></p><p>æœ‰äº†traceæŠ¥å‘Šï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ†æåç¨‹é˜»å¡æƒ…å†µå’Œå¤„ç†å™¨æ˜¯å¦å¾—åˆ°å……åˆ†ä½¿ç”¨ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬æƒ³<strong>æ’æŸ¥åç¨‹é˜»å¡æƒ…å†µ</strong>ï¼Œå°±å¯ä»¥çœ‹åç¨‹åˆ†æï¼ˆGoroutine analysisï¼‰è§†å›¾ã€‚å°±åƒä¸‹é¢çš„å›¾å±•ç¤ºçš„ä¸€æ ·ï¼Œåç¨‹åˆ†æè§†å›¾ä¼šå°†traceæœŸé—´çš„æ‰€æœ‰åç¨‹ï¼ŒæŒ‰è¿è¡Œæ—¶é—´é™åºæ’åºã€‚<br>\n<img src=\"https://static001.geekbang.org/resource/image/00/c7/00e830d8637340d94df2aa9b806e8ec7.jpg?wh=1746x832\" alt=\"\" title=\"å›¾7 åç¨‹åˆ†æè§†å›¾\"></p><p>ç‚¹å‡»å•ä¸ªåç¨‹ï¼Œä¼šè¿›å…¥ä¸‹å›¾å•ä¸ªåç¨‹çš„ç»Ÿè®¡é¡µé¢ã€‚åœ¨è¿™ä¸ªé¡µé¢é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åç¨‹è¿è¡Œæ—¶é—´ã€åŒæ­¥é˜»å¡æ—¶é—´ã€ç³»ç»Ÿè°ƒç”¨é˜»å¡æ—¶é—´ã€è°ƒåº¦å»¶è¿Ÿæ—¶é—´ç­‰ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/2a/c7/2a904d580174621542f320c81d950ec7.jpg?wh=2280x1418\" alt=\"\" title=\"å›¾8 å•ä¸ªåç¨‹è¿è¡Œæƒ…å†µç»Ÿè®¡\"></p><p>å½“æˆ‘ä»¬å‘ç°åç¨‹é˜»å¡æ—¶é—´æ¯”è¾ƒé•¿æ—¶ï¼Œå¯ä»¥é€šè¿‡ç‚¹å‡»SummaryåŒºçš„é“¾æ¥ï¼Œå°±å¯ä»¥å®šä½åˆ°å…·ä½“çš„é˜»å¡ä»£ç äº†ã€‚æ¯”å¦‚ä¸Šå›¾ä¸­çš„åŒæ­¥é˜»å¡ï¼Œæˆ‘ä»¬ç‚¹å‡»Sync block profileå¯ä»¥å®šä½åˆ°é€ æˆé˜»å¡çš„ä»£ç ï¼Œä¼šå‘ç°å­˜åœ¨é€šé“è¯»ç­‰å¾…ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/9c/9f/9cae43fc0a003cd448582aae6369959f.jpg?wh=1910x1166\" alt=\"\" title=\"å›¾9 åŒæ­¥é˜»å¡\"></p><p>å†æ¯”å¦‚ï¼Œå½“æˆ‘ä»¬æƒ³è¦<strong>æŸ¥çœ‹å¤„ç†å™¨çš„ä½¿ç”¨çŠ¶å†µ</strong>æ—¶ï¼Œä¾¿å¯ä»¥ä½¿ç”¨å¤„ç†å™¨åˆ†æè§†å›¾ï¼ˆView trace by Procï¼‰ã€‚åé¢å°±æ˜¯è¿™ä¸ªè§†å›¾çš„æ ·å­ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b6/c9/b6818ed151ceff4973db606aaa4d8ac9.jpg?wh=2882x1320\" alt=\"\" title=\"å›¾10 å¤„ç†å™¨è§†å›¾-åç¨‹çŠ¶æ€ç»Ÿè®¡\"></p><p>å€ŸåŠ©å¤„ç†å™¨è§†å›¾ï¼Œæˆ‘ä»¬æ—¢èƒ½äº†è§£åˆ°å¤šæ ¸æ˜¯å¦å¤„äºè¢«å……åˆ†ä½¿ç”¨çš„çŠ¶æ€ï¼Œä¹Ÿèƒ½å¤ŸçŸ¥æ™“åœ¨æŸä¸€ç‰¹å®šæ—¶åˆ»ï¼Œå¤„äºä¸åŒçŠ¶æ€çš„åç¨‹æ•°é‡åˆ†åˆ«æ˜¯å¤šå°‘ã€‚å‡å¦‚å¤„äºå¯è°ƒåº¦ï¼ˆRunnableï¼‰çŠ¶æ€çš„åç¨‹æ•°é‡è¾ƒå¤šï¼Œè¿™å¯èƒ½æ„å‘³ç€åˆ›å»ºçš„åç¨‹æ•°é‡è¿‡å¤šï¼Œå¯¼è‡´æ— æ³•å¾—åˆ° CPU çš„æœ‰æ•ˆè°ƒåº¦ã€‚</p><p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜èƒ½å¤ŸæŸ¥çœ‹åœ¨é‚£äº›å ç”¨å¤„ç†å™¨æ—¶é—´çš„å„ç±»äº‹ä»¶å½“ä¸­ï¼Œç©¶ç«Ÿå“ªäº›æ˜¯ç”±åƒåœ¾å›æ”¶ï¼ˆGCï¼‰æ‰€å ç”¨çš„ã€‚å€˜è‹¥åƒåœ¾å›æ”¶å ç”¨ CPU çš„æ—¶é—´è¿‡å¤šï¼Œè¿™åŒæ ·ä¹Ÿæ„å‘³ç€ç¨‹åºå¤„äºä¸€ç§ä¸å¥åº·çš„è¿è¡ŒçŠ¶æ€ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/d2/b1/d2f6d88e2a1c9eabf42e1c1d6f95cdb1.jpg?wh=2266x1482\" alt=\"\" title=\"å›¾11 å¤„ç†å™¨è§†å›¾-äº‹ä»¶è¯¦æƒ…\"></p><h2>å°ç»“</h2><p>è¿™èŠ‚è¯¾çš„å†…å®¹å°±åˆ°è¿™é‡Œäº†ï¼Œä»Šå¤©æˆ‘ä»¬ä¸€å…±å­¦ä¹ äº†ä¸‰æ¬¾ Golang æ€§èƒ½ä¼˜åŒ–å·¥å…·ï¼Œå¹¶ä¸”äº†è§£äº†æ¯ä¸ªå·¥å…·åœ¨åˆ†æå„ç±»é—®é¢˜æ—¶çš„å…·ä½“ç”¨æ³•ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å†æ¥ä¸€èµ·å›é¡¾ä¸€ä¸‹è¿™å‡ æ¬¾å·¥å…·çš„åº”ç”¨åœºæ™¯ã€‚</p><ul>\n<li>\n<p>é¦–å…ˆæ˜¯ pprof å·¥å…·ã€‚å½“æˆ‘ä»¬å‘ç°CPU æˆ–è€…å†…å­˜èµ„æºçš„å ç”¨ç‡è¿‡é«˜æ—¶ï¼Œå€ŸåŠ© pprof å·¥å…·èƒ½å¤Ÿç²¾å‡†å¿«é€Ÿå®šä½åˆ°æ¶ˆè€—èµ„æºçš„çƒ­ç‚¹ä»£ç ã€‚</p>\n</li>\n<li>\n<p>æ¥ç€æ˜¯ benchmark å·¥å…·ã€‚å½“æˆ‘ä»¬æœ‰å¯¹ä¸åŒæ–¹æ¡ˆè¿›è¡Œæ€§èƒ½å¯¹æ¯”çš„éœ€æ±‚æ—¶ï¼Œé€šè¿‡ä½¿ç”¨ benchmark å·¥å…·ï¼Œå¯ä»¥è·å–åˆ°ä¸åŒæ–¹æ¡ˆåœ¨è€—æ—¶å’Œå†…å­˜æ¶ˆè€—æ–¹é¢çš„å¯¹æ¯”è¯¦ç»†æƒ…å†µã€‚</p>\n</li>\n<li>\n<p>æœ€åæ˜¯ trace å·¥å…·ã€‚å½“æˆ‘ä»¬å‘ç°æ¥å£çš„å»¶æ—¶æ¯”è¾ƒé«˜ï¼Œæƒ³è¦æ·±å…¥äº†è§£ç¨‹åºå†…éƒ¨å…·ä½“çš„è¿è¡ŒçŠ¶å†µçš„æ—¶å€™ï¼Œæ¯”å¦‚è¯´æƒ³çŸ¥é“åç¨‹æ˜¯å¦å­˜åœ¨é˜»å¡ã€å¤„ç†å™¨æœ‰æ²¡æœ‰è¢«å……åˆ†åœ°åˆ©ç”¨èµ·æ¥ç­‰ç­‰ï¼Œè¿™æ—¶å€™å°±å¯ä»¥è¿ç”¨ trace å·¥å…·æ¥ç²¾å‡†å®šä½åˆ°é‚£äº›å¯¼è‡´åç¨‹è¿è¡Œå—é˜»çš„ç›¸å…³ä»£ç ã€‚</p>\n</li>\n</ul><p>å¸Œæœ›ä½ èƒ½å¤Ÿå¥½å¥½ä½“ä¼šåœ¨é¢å¯¹ä¸åŒçš„æ€§èƒ½åœºæ™¯æ—¶ï¼Œåº”è¯¥å¦‚ä½•å»åº”ç”¨è¿™å‡ æ¬¾æ€§èƒ½å·¥å…·ã€‚è¿™æ ·ä¸‹æ¬¡å†ç¢°åˆ°ç±»ä¼¼è¿™äº›åœºæ™¯çš„æ—¶å€™ï¼Œä½ å°±èƒ½å¾ˆå¿«æ‰¾åˆ°è¶æ‰‹å·¥å…·ï¼Œæ›´å¿«æ‰¾åˆ°å‡ºç°ç“¶é¢ˆçš„åŸå› ï¼Œè¿›è€Œåˆ¶å®šå‡ºæœ‰æ•ˆçš„ä¼˜åŒ–æ–¹æ¡ˆã€‚</p><h2>æ€è€ƒé¢˜</h2><p>ä¸ºä»€ä¹ˆæœ‰äº›å…¬å¸ä¼šé€‰æ‹©åœ¨ QPS é«˜å³°æœŸå¯¹çº¿ä¸Šè¿›è¡Œ pprof å®šæ—¶é‡‡æ ·ï¼Œè€Œè¾ƒå°‘åœ¨æ­¤æ—¶è¿›è¡Œ trace æ“ä½œå‘¢ï¼Ÿ</p><p>æ¬¢è¿ä½ æŠŠä½ çš„ç­”æ¡ˆåˆ†äº«åœ¨è¯„è®ºåŒºï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾çš„å†…å®¹åˆ†äº«ç»™éœ€è¦çš„æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","neighbors":{"left":{"article_title":"01ï½œæ€§èƒ½ä¼˜åŒ–æµç¨‹ï¼šåˆšå¼€å§‹åšæ€§èƒ½ä¼˜åŒ–ä»ä½•å…¥æ‰‹ï¼Ÿ","id":830657},"right":{"article_title":"03ï½œå•æœºååä¼˜åŒ–ï¼ˆä¸€ï¼‰ï¼šæ— éœ€ç¡¬ä»¶å‡çº§ä¹Ÿèƒ½æå‡åå","id":832423}},"comments":[{"had_liked":false,"id":396396,"user_name":"å¿«å«æˆ‘å°ç™½","can_delete":false,"product_type":"c1","uid":3571201,"ip_address":"ä¸Šæµ·","ucode":"7CAD65E36601A2","user_header":"https://static001.geekbang.org/account/avatar/00/36/7e/01/1660e1e8.jpg","comment_is_top":false,"comment_ctime":1734276878,"is_pvip":false,"replies":[{"id":143913,"content":"runtimeåŒ…å‡½æ•°ï¼Œå±äºGolangåº•å±‚å‡½æ•°äº†ï¼Œé™¤äº†gcç›¸å…³çš„å‡½æ•°æ˜¯ç»å¤§å¤šæ•°ä»¥gcå¼€å¤´ï¼Œå…¶å®ƒæ²¡ä»€ä¹ˆç‰¹åˆ«è§„åˆ™ã€‚æˆ‘ä»¬å¯ä»¥ç†Ÿæ‚‰ä¸‹Golangåº•å±‚å¸¸è§çš„runtimeå‡½æ•°å¤§æ¦‚æ˜¯åœ¨åšä»€ä¹ˆï¼Œåˆ†æç«ç„°å›¾æ—¶ï¼Œé‡åˆ°ä¸è®¤è¯†çš„å†å»æŸ¥ã€‚\n\nåç¨‹è°ƒåº¦ç›¸å…³å‡½æ•°ï¼š\nruntime.mcallï¼šç”¨äºä»ç”¨æˆ·æ€ä»£ç åˆ‡æ¢åˆ°è°ƒåº¦å™¨ã€‚å®ƒé€šå¸¸è¢«runtime.goschedè°ƒç”¨ï¼Œåè€…è®©å‡ºCPUï¼Œå…è®¸å…¶ä»–goroutineè¿è¡Œ\nruntime.scheduleï¼šè¿™æ˜¯è°ƒåº¦å™¨çš„æ ¸å¿ƒå‡½æ•°ï¼Œè´Ÿè´£é€‰æ‹©ä¸‹ä¸€ä¸ªè¦è¿è¡Œçš„goroutine\nruntime.findrunnableï¼šå¯»æ‰¾å¯è¿è¡Œçš„goroutine\nruntime.runqgetï¼šä»è¿è¡Œé˜Ÿåˆ—ä¸­è·å–goroutine\n\nå†…å­˜åˆ†é…å‡½æ•°ï¼š\nruntime.mallocgcï¼šå†…å­˜åˆ†é…å‡½æ•°\n\n\nå†…å­˜å›æ”¶å‡½æ•°(GC)ï¼š\nruntime.gcDrainï¼šæ‰§è¡ŒGCçš„æ ‡è®°å·¥ä½œã€‚è¿™ä¸ªå‡½æ•°å°è¯•ä»ç¼“å†²æ± è·å–å¯è¿½è¸ªçš„æŒ‡é’ˆï¼Œå¹¶è°ƒç”¨runtime.scanobjectå‡½æ•°ç»§ç»­æ‰§è¡Œæ‰«æä»»åŠ¡ã€‚\nruntime.gcAssistAlloc(*g)ï¼šè¾…åŠ©GCåˆ†é…ã€‚è¿™ä¸ªå‡½æ•°åœ¨é«˜è´Ÿè½½æƒ…å†µä¸‹ï¼Œå¸®åŠ©GCè¿›è¡Œæ ‡è®°å·¥ä½œï¼Œä»¥å¹³è¡¡å†…å­˜åˆ†é…çš„é€Ÿåº¦å’ŒGCæ ‡è®°çš„é€Ÿåº¦ã€‚\nruntime.gcMarkDoneï¼šå®Œæˆæ ‡è®°é˜¶æ®µçš„GCå·¥ä½œ\nruntime.gcSweepï¼šæ‰§è¡ŒGCçš„æ¸…ç†é˜¶æ®µ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1313417,"ctime":1734359908,"ip_address":"å¹¿ä¸œ","comment_id":396396,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100843701,"comment_content":"åœ¨å…¬å¸çš„æŠ¥è­¦ç³»ç»Ÿä¸­æˆ‘ä¹Ÿå¸¸çœ‹åˆ°ç±»ä¼¼å›¾9è¿™æ ·çš„è°ƒç”¨å›¾ï¼Œä½†æ˜¯å›¾ä¸­æ¯ä¸ªæ–¹å—çš„å‡½æ•°åéƒ½éå¸¸é™Œç”Ÿï¼Œç”šè‡³ä»æœªè§è¿‡ï¼Œè¯·æ•™ä¸€ä¸‹è€å¸ˆè¿™äº›å‡½æ•°åæœ‰ä»€ä¹ˆè§£è¯»è§„åˆ™å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1313417,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0a/89/eb8c28a4.jpg","nickname":"å¾é€¸","note":"","ucode":"DCFDEE08FD263A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":655196,"discussion_content":"runtimeåŒ…å‡½æ•°ï¼Œå±äºGolangåº•å±‚å‡½æ•°äº†ï¼Œé™¤äº†gcç›¸å…³çš„å‡½æ•°æ˜¯ç»å¤§å¤šæ•°ä»¥gcå¼€å¤´ï¼Œå…¶å®ƒæ²¡ä»€ä¹ˆç‰¹åˆ«è§„åˆ™ã€‚æˆ‘ä»¬å¯ä»¥ç†Ÿæ‚‰ä¸‹Golangåº•å±‚å¸¸è§çš„runtimeå‡½æ•°å¤§æ¦‚æ˜¯åœ¨åšä»€ä¹ˆï¼Œåˆ†æç«ç„°å›¾æ—¶ï¼Œé‡åˆ°ä¸è®¤è¯†çš„å†å»æŸ¥ã€‚\n\nåç¨‹è°ƒåº¦ç›¸å…³å‡½æ•°ï¼š\nruntime.mcallï¼šç”¨äºä»ç”¨æˆ·æ€ä»£ç åˆ‡æ¢åˆ°è°ƒåº¦å™¨ã€‚å®ƒé€šå¸¸è¢«runtime.goschedè°ƒç”¨ï¼Œåè€…è®©å‡ºCPUï¼Œå…è®¸å…¶ä»–goroutineè¿è¡Œ\nruntime.scheduleï¼šè¿™æ˜¯è°ƒåº¦å™¨çš„æ ¸å¿ƒå‡½æ•°ï¼Œè´Ÿè´£é€‰æ‹©ä¸‹ä¸€ä¸ªè¦è¿è¡Œçš„goroutine\nruntime.findrunnableï¼šå¯»æ‰¾å¯è¿è¡Œçš„goroutine\nruntime.runqgetï¼šä»è¿è¡Œé˜Ÿåˆ—ä¸­è·å–goroutine\n\nå†…å­˜åˆ†é…å‡½æ•°ï¼š\nruntime.mallocgcï¼šå†…å­˜åˆ†é…å‡½æ•°\n\n\nå†…å­˜å›æ”¶å‡½æ•°(GC)ï¼š\nruntime.gcDrainï¼šæ‰§è¡ŒGCçš„æ ‡è®°å·¥ä½œã€‚è¿™ä¸ªå‡½æ•°å°è¯•ä»ç¼“å†²æ± è·å–å¯è¿½è¸ªçš„æŒ‡é’ˆï¼Œå¹¶è°ƒç”¨runtime.scanobjectå‡½æ•°ç»§ç»­æ‰§è¡Œæ‰«æä»»åŠ¡ã€‚\nruntime.gcAssistAlloc(*g)ï¼šè¾…åŠ©GCåˆ†é…ã€‚è¿™ä¸ªå‡½æ•°åœ¨é«˜è´Ÿè½½æƒ…å†µä¸‹ï¼Œå¸®åŠ©GCè¿›è¡Œæ ‡è®°å·¥ä½œï¼Œä»¥å¹³è¡¡å†…å­˜åˆ†é…çš„é€Ÿåº¦å’ŒGCæ ‡è®°çš„é€Ÿåº¦ã€‚\nruntime.gcMarkDoneï¼šå®Œæˆæ ‡è®°é˜¶æ®µçš„GCå·¥ä½œ\nruntime.gcSweepï¼šæ‰§è¡ŒGCçš„æ¸…ç†é˜¶æ®µ","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1734359909,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":396536,"user_name":"æˆ‘å¥½åƒä¸€ç‚¹éƒ½ä¸åƒç¨‹åºå‘˜","can_delete":false,"product_type":"c1","uid":1435733,"ip_address":"å¹¿ä¸œ","ucode":"F479190923355C","user_header":"https://static001.geekbang.org/account/avatar/00/15/e8/55/63189817.jpg","comment_is_top":false,"comment_ctime":1734860935,"is_pvip":false,"replies":[{"id":143948,"content":"è¿™ä¸ªæç¤ºè¿˜å¥½ï¼Œä¸å½±å“traceè§†å›¾æ­£å¸¸åŠŸèƒ½ï¼Œå¯ä»¥å¿½ç•¥çš„~","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1313417,"ctime":1734878454,"ip_address":"å¹¿ä¸œ","comment_id":396536,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100843701,"comment_content":"Trace Viewer is running with WebComponentsV0 polyfill, and some features may be broken. As a workaround, you may try running chrome with &quot;--enable-blink-features=ShadowDOMV0,CustomElementsV0,HTMLImports&quot; flag. See crbug.com&#47;1036492.\nhow to do?","like_count":0,"discussions":[{"author":{"id":1313417,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0a/89/eb8c28a4.jpg","nickname":"å¾é€¸","note":"","ucode":"DCFDEE08FD263A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":655413,"discussion_content":"è¿™ä¸ªæç¤ºè¿˜å¥½ï¼Œä¸å½±å“traceè§†å›¾æ­£å¸¸åŠŸèƒ½ï¼Œå¯ä»¥å¿½ç•¥çš„~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1734878454,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":396535,"user_name":"æˆ‘å¥½åƒä¸€ç‚¹éƒ½ä¸åƒç¨‹åºå‘˜","can_delete":false,"product_type":"c1","uid":1435733,"ip_address":"å¹¿ä¸œ","ucode":"F479190923355C","user_header":"https://static001.geekbang.org/account/avatar/00/15/e8/55/63189817.jpg","comment_is_top":false,"comment_ctime":1734859900,"is_pvip":false,"replies":[{"id":143947,"content":"æ˜¯ç”¨çš„è¿™é‡Œçš„ä»£ç è·‘çš„ä¹ˆï¼Ÿhttps:&#47;&#47;github.com&#47;xuyi19921216&#47;server-go&#47;blob&#47;master&#47;2&#47;trace&#47;runtime&#47;main.goï¼Œæˆ‘é‡æ–°è·‘å‡ºæ¥äº†ä¸‹ï¼Œgoroutinesåˆ†æè§†å›¾è¿˜æ˜¯è¿™æ ·çš„ã€‚\nStart location\tCount\tTotal execution time\nmain.main\t1\t81.217Âµs\nruntime.traceStartReadCPU.func1\t1\t44.545Âµs\nruntime.(*traceAdvancerState).start.func1\t1\t25.665Âµs\nmain.RunMyProgram1.func1\t1\t960ns\nruntime&#47;trace.Start.func1\t1\t0s\n(Inactive, no stack trace sampled)\t4\t0s","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1313417,"ctime":1734878243,"ip_address":"å¹¿ä¸œ","comment_id":396535,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100843701,"comment_content":"æ˜¯ç‰ˆæœ¬é—®é¢˜å—ï¼Œtrace æˆ‘æå‡ºæ¥çš„ã€‚å’Œè€å¸ˆçš„å›¾ä¸ä¸€æ ·ã€‚é•¿è¿™ä¸ªæ ·å­ï¼š\nGoroutines:\nruntime.main N=1\nruntime&#47;trace.Start.func1 N=1\nN=4","like_count":0,"discussions":[{"author":{"id":1313417,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0a/89/eb8c28a4.jpg","nickname":"å¾é€¸","note":"","ucode":"DCFDEE08FD263A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":655412,"discussion_content":"æ˜¯ç”¨çš„è¿™é‡Œçš„ä»£ç è·‘çš„ä¹ˆï¼Ÿhttps://github.com/xuyi19921216/server-go/blob/master/2/trace/runtime/main.goï¼Œæˆ‘é‡æ–°è·‘å‡ºæ¥äº†ä¸‹ï¼Œgoroutinesåˆ†æè§†å›¾è¿˜æ˜¯è¿™æ ·çš„ã€‚\nStart location\tCount\tTotal execution time\nmain.main\t1\t81.217Âµs\nruntime.traceStartReadCPU.func1\t1\t44.545Âµs\nruntime.(*traceAdvancerState).start.func1\t1\t25.665Âµs\nmain.RunMyProgram1.func1\t1\t960ns\nruntime/trace.Start.func1\t1\t0s\n(Inactive, no stack trace sampled)\t4\t0s","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1734878244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":396374,"user_name":"å·…","can_delete":false,"product_type":"c1","uid":1363244,"ip_address":"ä¸­å›½é¦™æ¸¯","ucode":"18239CFA501049","user_header":"https://static001.geekbang.org/account/avatar/00/14/cd/2c/a02a8372.jpg","comment_is_top":false,"comment_ctime":1734159215,"is_pvip":false,"replies":[{"id":143911,"content":"è¿™ä¸ªå…¶å®éœ€è¦å¯¹Golangçš„åº•å±‚runtimeåŒ…æœ‰ä¸€å®šçš„äº†è§£ã€‚\n\nruntimeæ˜¯Golangåº•å±‚å†…éƒ¨çš„ä¸€äº›å‡½æ•°ï¼ŒCPUç«ç„°å›¾ä¸€èˆ¬èƒ½çœ‹åˆ°çš„æ˜¯ä¸‹é¢å‡ ç±»ï¼š\n\n1. åç¨‹è°ƒåº¦ç›¸å…³å‡½æ•°ï¼š\n   runtime.mcallï¼šç”¨äºè¿›è¡Œgoroutineçš„è°ƒåº¦ã€‚\n   runtime.scheduleï¼šè°ƒåº¦å™¨çš„ä¸»è¦è°ƒåº¦å‡½æ•°ï¼Œè´Ÿè´£é€‰æ‹©å’Œæ‰§è¡Œä¸‹ä¸€ä¸ªgoroutineã€‚\n   runtime.findrunnableï¼šå¯»æ‰¾å¯è¿è¡Œçš„goroutineã€‚\n\n2. å†…å­˜ç®¡ç†åˆ†é…ï¼š\n   runtime.mallocgcï¼šæ ˆä¸Šåšå†…å­˜åˆ†é…ã€‚\n\n3.å†…å­˜å›æ”¶(GC)ç›¸å…³ï¼š\n   runtime.gcDrainï¼šæ‰§è¡ŒGCçš„æ ‡è®°å·¥ä½œã€‚è¿™ä¸ªå‡½æ•°å°è¯•ä»ç¼“å†²æ± è·å–å¯è¿½è¸ªçš„æŒ‡é’ˆï¼Œå¹¶è°ƒç”¨runtime.scanobjectå‡½æ•°ç»§ç»­æ‰§è¡Œæ‰«æä»»åŠ¡ã€‚\n   runtime.gcMarkDoneï¼šå®ŒæˆGCçš„æ ‡è®°ã€‚è¿™ä¸ªå‡½æ•°åœ¨æ‰€æœ‰å¯è¾¾çš„ç°è‰²å¯¹è±¡éƒ½è¢«æŸ“é»‘åè¢«è°ƒç”¨ï¼Œè´Ÿè´£å®Œæˆæ ‡è®°é˜¶æ®µçš„æ”¶å°¾å·¥ä½œã€‚\n   runtime.gcBgMarkStartWorkersï¼šå¯åŠ¨GCæ ‡è®°å·¥ä½œã€‚\n   runtime.gcAssistAllocï¼šè¾…åŠ©GCåˆ†é…ã€‚è¿™ä¸ªå‡½æ•°åœ¨é«˜è´Ÿè½½æƒ…å†µä¸‹ï¼Œå¸®åŠ©GCè¿›è¡Œæ ‡è®°å·¥ä½œï¼Œä»¥å¹³è¡¡å†…å­˜åˆ†é…çš„é€Ÿåº¦å’ŒGCæ ‡è®°çš„é€Ÿåº¦ã€‚\n\næˆ‘ä»¬å¯ä»¥çœ‹ä¸‹æ˜¯å“ªç±»å‡½æ•°ï¼Œç„¶åé’ˆå¯¹æ€§åšåˆ†æã€‚\n1.å¦‚æœæ˜¯åç¨‹è°ƒåº¦ç›¸å…³çš„å‡½æ•°ï¼Œéœ€è¦è€ƒè™‘ä¸‹æ˜¯ä¸æ˜¯åç¨‹åˆ›å»ºå¤šäº†ï¼Œå¯¼è‡´é¢‘ç¹çš„åšåç¨‹è°ƒåº¦ã€‚\n2.å¦‚æœæ˜¯å†…å­˜åˆ†é…ç›¸å…³çš„å‡½æ•°ï¼Œå°±éœ€è¦è€ƒè™‘ä¸‹ä»£ç é‡Œæ˜¯ä¸æ˜¯åœ¨é¢‘ç¹çš„åˆ›å»ºå¯¹è±¡ã€‚\n3.å¦‚æœæ˜¯GCç›¸å…³çš„å‡½æ•°ï¼Œéœ€è¦è€ƒè™‘æ˜¯ä¸æ˜¯å­˜åœ¨å¤§é‡çš„å°å¯¹è±¡ï¼Œæ¯”å¦‚è¯´æœ¬åœ°ç¼“å­˜äº†å¤§é‡å¯¹è±¡ï¼ŒGCåœ¨åšæ‰«ææ ‡è®°ã€‚\n   \né’ˆå¯¹ä½ è¯´çš„â€œå®šæ—¶ä»»åŠ¡ä»¥åŠæºç¨‹ï¼Œæœ€ç»ˆpprofçš„ç»“æœæ‰“å¤´éƒ½æ˜¯runtimeåŒ…çš„å‡½æ•°\nçœ‹ä¸åˆ°è°ƒç”¨é“¾ï¼Œå †æ ˆç¬¬ä¸€ä¸ªéƒ½æ˜¯runtime.mcallä¹‹ç±»â€ï¼Œå¯ä»¥è€ƒè™‘ä¸‹ä»£ç é‡Œæ˜¯ä¸æ˜¯åœ¨é¢‘ç¹åˆ›å»ºåç¨‹ï¼Œèƒ½ä¸èƒ½ç”¨åç¨‹æ± ä¹‹ç±»çš„åšä¼˜åŒ–ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1313417,"ctime":1734358918,"ip_address":"å¹¿ä¸œ","comment_id":396374,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100843701,"comment_content":"ç¨‹åºé‡Œå¤šä¸ªå®šæ—¶ä»»åŠ¡ä»¥åŠæºç¨‹ï¼Œæœ€ç»ˆpprofçš„ç»“æœæ‰“å¤´éƒ½æ˜¯runtimeåŒ…çš„å‡½æ•°\nçœ‹ä¸åˆ°è°ƒç”¨é“¾ï¼Œå †æ ˆç¬¬ä¸€ä¸ªéƒ½æ˜¯runtime.mcallä¹‹ç±»ï¼Œè¿™ç§åˆ™æ€ä¹ˆåˆ†æå‘¢","like_count":0,"discussions":[{"author":{"id":1313417,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0a/89/eb8c28a4.jpg","nickname":"å¾é€¸","note":"","ucode":"DCFDEE08FD263A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":655194,"discussion_content":"è¿™ä¸ªå…¶å®éœ€è¦å¯¹Golangçš„åº•å±‚runtimeåŒ…æœ‰ä¸€å®šçš„äº†è§£ã€‚\n\nruntimeæ˜¯Golangåº•å±‚å†…éƒ¨çš„ä¸€äº›å‡½æ•°ï¼ŒCPUç«ç„°å›¾ä¸€èˆ¬èƒ½çœ‹åˆ°çš„æ˜¯ä¸‹é¢å‡ ç±»ï¼š\n\n1. åç¨‹è°ƒåº¦ç›¸å…³å‡½æ•°ï¼š\n   runtime.mcallï¼šç”¨äºè¿›è¡Œgoroutineçš„è°ƒåº¦ã€‚\n   runtime.scheduleï¼šè°ƒåº¦å™¨çš„ä¸»è¦è°ƒåº¦å‡½æ•°ï¼Œè´Ÿè´£é€‰æ‹©å’Œæ‰§è¡Œä¸‹ä¸€ä¸ªgoroutineã€‚\n   runtime.findrunnableï¼šå¯»æ‰¾å¯è¿è¡Œçš„goroutineã€‚\n\n2. å†…å­˜ç®¡ç†åˆ†é…ï¼š\n   runtime.mallocgcï¼šæ ˆä¸Šåšå†…å­˜åˆ†é…ã€‚\n\n3.å†…å­˜å›æ”¶(GC)ç›¸å…³ï¼š\n   runtime.gcDrainï¼šæ‰§è¡ŒGCçš„æ ‡è®°å·¥ä½œã€‚è¿™ä¸ªå‡½æ•°å°è¯•ä»ç¼“å†²æ± è·å–å¯è¿½è¸ªçš„æŒ‡é’ˆï¼Œå¹¶è°ƒç”¨runtime.scanobjectå‡½æ•°ç»§ç»­æ‰§è¡Œæ‰«æä»»åŠ¡ã€‚\n   runtime.gcMarkDoneï¼šå®ŒæˆGCçš„æ ‡è®°ã€‚è¿™ä¸ªå‡½æ•°åœ¨æ‰€æœ‰å¯è¾¾çš„ç°è‰²å¯¹è±¡éƒ½è¢«æŸ“é»‘åè¢«è°ƒç”¨ï¼Œè´Ÿè´£å®Œæˆæ ‡è®°é˜¶æ®µçš„æ”¶å°¾å·¥ä½œã€‚\n   runtime.gcBgMarkStartWorkersï¼šå¯åŠ¨GCæ ‡è®°å·¥ä½œã€‚\n   runtime.gcAssistAllocï¼šè¾…åŠ©GCåˆ†é…ã€‚è¿™ä¸ªå‡½æ•°åœ¨é«˜è´Ÿè½½æƒ…å†µä¸‹ï¼Œå¸®åŠ©GCè¿›è¡Œæ ‡è®°å·¥ä½œï¼Œä»¥å¹³è¡¡å†…å­˜åˆ†é…çš„é€Ÿåº¦å’ŒGCæ ‡è®°çš„é€Ÿåº¦ã€‚\n\næˆ‘ä»¬å¯ä»¥çœ‹ä¸‹æ˜¯å“ªç±»å‡½æ•°ï¼Œç„¶åé’ˆå¯¹æ€§åšåˆ†æã€‚\n1.å¦‚æœæ˜¯åç¨‹è°ƒåº¦ç›¸å…³çš„å‡½æ•°ï¼Œéœ€è¦è€ƒè™‘ä¸‹æ˜¯ä¸æ˜¯åç¨‹åˆ›å»ºå¤šäº†ï¼Œå¯¼è‡´é¢‘ç¹çš„åšåç¨‹è°ƒåº¦ã€‚\n2.å¦‚æœæ˜¯å†…å­˜åˆ†é…ç›¸å…³çš„å‡½æ•°ï¼Œå°±éœ€è¦è€ƒè™‘ä¸‹ä»£ç é‡Œæ˜¯ä¸æ˜¯åœ¨é¢‘ç¹çš„åˆ›å»ºå¯¹è±¡ã€‚\n3.å¦‚æœæ˜¯GCç›¸å…³çš„å‡½æ•°ï¼Œéœ€è¦è€ƒè™‘æ˜¯ä¸æ˜¯å­˜åœ¨å¤§é‡çš„å°å¯¹è±¡ï¼Œæ¯”å¦‚è¯´æœ¬åœ°ç¼“å­˜äº†å¤§é‡å¯¹è±¡ï¼ŒGCåœ¨åšæ‰«ææ ‡è®°ã€‚\n   \né’ˆå¯¹ä½ è¯´çš„â€œå®šæ—¶ä»»åŠ¡ä»¥åŠæºç¨‹ï¼Œæœ€ç»ˆpprofçš„ç»“æœæ‰“å¤´éƒ½æ˜¯runtimeåŒ…çš„å‡½æ•°\nçœ‹ä¸åˆ°è°ƒç”¨é“¾ï¼Œå †æ ˆç¬¬ä¸€ä¸ªéƒ½æ˜¯runtime.mcallä¹‹ç±»â€ï¼Œå¯ä»¥è€ƒè™‘ä¸‹ä»£ç é‡Œæ˜¯ä¸æ˜¯åœ¨é¢‘ç¹åˆ›å»ºåç¨‹ï¼Œèƒ½ä¸èƒ½ç”¨åç¨‹æ± ä¹‹ç±»çš„åšä¼˜åŒ–ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1734358918,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1363244,"avatar":"https://static001.geekbang.org/account/avatar/00/14/cd/2c/a02a8372.jpg","nickname":"å·…","note":"","ucode":"18239CFA501049","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":655355,"discussion_content":"å¤šè°¢è€å¸ˆ\nå¦å¤–å…³äºruntimeåŒ…çš„ï¼Œæƒ³ç³»ç»Ÿæ€§å­¦ä¹ ä¸‹ï¼Œæœ‰æ²¡æœ‰æ¨èçš„ä¹¦ç±æˆ–è€…åšå®¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1734677769,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸­å›½é¦™æ¸¯","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":396360,"user_name":"ly","can_delete":false,"product_type":"c1","uid":1478117,"ip_address":"æ²³å—","ucode":"6DD7DEECF39AF8","user_header":"https://static001.geekbang.org/account/avatar/00/16/8d/e5/f3df7b02.jpg","comment_is_top":false,"comment_ctime":1734077150,"is_pvip":false,"replies":[{"id":143891,"content":"æ˜¯ç”¨githubä¸Šçš„trace.outæ–‡ä»¶ä¹ˆï¼Ÿä½ å¯ä»¥ç”¨é‡Œé¢çš„ä»£ç æœ¬åœ°é‡æ–°ç”Ÿæˆä¸€ä¸ªï¼Œè·ŸGoçš„ç‰ˆæœ¬æœ‰å…³ç³»ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1313417,"ctime":1734326285,"ip_address":"å¹¿ä¸œ","comment_id":396360,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100843701,"comment_content":" go tool trace trace.out\n2024&#47;12&#47;13 16:03:34 Preparing trace for viewer...\nfailed to create trace reader: bad file format: not a Go execution trace?æ˜¯ç‰ˆæœ¬çš„é—®é¢˜å—ï¼Œæˆ‘çš„ç‰ˆæœ¬go version go1.23.2 windows&#47;amd64","like_count":0,"discussions":[{"author":{"id":1313417,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0a/89/eb8c28a4.jpg","nickname":"å¾é€¸","note":"","ucode":"DCFDEE08FD263A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":655144,"discussion_content":"æ˜¯ç”¨githubä¸Šçš„trace.outæ–‡ä»¶ä¹ˆï¼Ÿä½ å¯ä»¥ç”¨é‡Œé¢çš„ä»£ç æœ¬åœ°é‡æ–°ç”Ÿæˆä¸€ä¸ªï¼Œè·ŸGoçš„ç‰ˆæœ¬æœ‰å…³ç³»ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1734326285,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":396285,"user_name":"onemao","can_delete":false,"product_type":"c1","uid":1969439,"ip_address":"ä¸Šæµ·","ucode":"1CB4101525C2D1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/rURvBicplInVqwb9rX21a4IkcKkITIGIo7GE1Tcp3WWU49QtwV53qY8qCKAIpS6x68UmH4STfEcFDJddffGC7lw/132","comment_is_top":false,"comment_ctime":1733878552,"is_pvip":false,"replies":[{"id":143863,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1313417,"ctime":1733933358,"ip_address":"å¹¿ä¸œ","comment_id":396285,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100843701,"comment_content":"é«˜å³°æœŸpprofé‡‡æ ·å®¹æ˜“è·å¾—&quot;æé™å€¼&quot;,è¾ƒå°‘æ—¶traceæ˜¯å› ä¸ºæ ·æœ¬å°‘å®¹æ˜“è·å–ï¼Œåˆ†ætraceä¹Ÿæ›´æ–¹ä¾¿","like_count":0,"discussions":[{"author":{"id":1313417,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0a/89/eb8c28a4.jpg","nickname":"å¾é€¸","note":"","ucode":"DCFDEE08FD263A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":654991,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1733933358,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]}]}