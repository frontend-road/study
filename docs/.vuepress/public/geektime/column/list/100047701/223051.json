{"id":223051,"title":"14 | æ–‡ä»¶IOï¼šå®ç°é«˜æ•ˆæ­£ç¡®çš„æ–‡ä»¶è¯»å†™å¹¶éæ˜“äº‹","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æœ±æ™”ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬æ¥èŠèŠå¦‚ä½•å®ç°é«˜æ•ˆã€æ­£ç¡®çš„æ–‡ä»¶æ“ä½œã€‚</p><p>éšç€æ•°æ®åº“ç³»ç»Ÿçš„æˆç†Ÿå’Œæ™®åŠï¼Œéœ€è¦ç›´æ¥åšæ–‡ä»¶IOæ“ä½œçš„éœ€æ±‚è¶Šæ¥è¶Šå°‘ï¼Œè¿™å°±å¯¼è‡´æˆ‘ä»¬å¯¹ç›¸å…³APIä¸å¤Ÿç†Ÿæ‚‰ï¼Œä»¥è‡³äºé‡åˆ°ç±»ä¼¼æ–‡ä»¶å¯¼å‡ºã€ä¸‰æ–¹æ–‡ä»¶å¯¹è´¦ç­‰éœ€æ±‚æ—¶ï¼Œåªèƒ½ä¸´æ—¶æŠ±ä½›è„šï¼Œéšæ„æœç´¢ä¸€äº›ä»£ç å®Œæˆéœ€æ±‚ï¼Œå‡ºç°æ€§èƒ½é—®é¢˜æˆ–è€…Bugåä¸çŸ¥ä»ä½•å¤„å…¥æ‰‹ã€‚</p><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å°±ä¼šä»å­—ç¬¦ç¼–ç ã€ç¼“å†²åŒºå’Œæ–‡ä»¶å¥æŸ„é‡Šæ”¾è¿™3ä¸ªå¸¸è§é—®é¢˜å‡ºå‘ï¼Œå’Œä½ åˆ†äº«å¦‚ä½•è§£å†³ä¸æ–‡ä»¶æ“ä½œç›¸å…³çš„æ€§èƒ½é—®é¢˜æˆ–è€…Bugã€‚å¦‚æœä½ å¯¹æ–‡ä»¶æ“ä½œç›¸å…³çš„APIä¸å¤Ÿç†Ÿæ‚‰ï¼Œå¯ä»¥æŸ¥çœ‹<a href=\"https://docs.oracle.com/javase/tutorial/essential/io/\">Oracleå®˜ç½‘çš„ä»‹ç»</a>ã€‚</p><h2>æ–‡ä»¶è¯»å†™éœ€è¦ç¡®ä¿å­—ç¬¦ç¼–ç ä¸€è‡´</h2><p>æœ‰ä¸€ä¸ªé¡¹ç›®éœ€è¦è¯»å–ä¸‰æ–¹çš„å¯¹è´¦æ–‡ä»¶å®šæ—¶å¯¹è´¦ï¼ŒåŸå…ˆä¸€ç›´æ˜¯å•æœºå¤„ç†çš„ï¼Œæ²¡ä»€ä¹ˆé—®é¢˜ã€‚åæ¥ä¸ºäº†æå‡æ€§èƒ½ï¼Œä½¿ç”¨åŒèŠ‚ç‚¹åŒæ—¶å¤„ç†å¯¹è´¦ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹å¤„ç†éƒ¨åˆ†å¯¹è´¦æ•°æ®ï¼Œä½†æ–°å¢çš„èŠ‚ç‚¹åœ¨å¤„ç†æ–‡ä»¶ä¸­ä¸­æ–‡çš„æ—¶å€™æ€»æ˜¯è¯»å–åˆ°ä¹±ç ã€‚</p><p>ç¨‹åºä»£ç éƒ½æ˜¯ä¸€è‡´çš„ï¼Œä¸ºä»€ä¹ˆè€èŠ‚ç‚¹å°±ä¸ä¼šæœ‰é—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼Œè¿™å¾ˆå¯èƒ½æ˜¯å†™ä»£ç æ—¶æ²¡æœ‰æ³¨æ„ç¼–ç é—®é¢˜å¯¼è‡´çš„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±åˆ†æä¸‹è¿™ä¸ªé—®é¢˜å§ã€‚</p><p>ä¸ºæ¨¡æ‹Ÿè¿™ä¸ªåœºæ™¯ï¼Œæˆ‘ä»¬ä½¿ç”¨GBKç¼–ç æŠŠâ€œä½ å¥½hiâ€å†™å…¥ä¸€ä¸ªåä¸ºhello.txtçš„æ–‡æœ¬æ–‡ä»¶ï¼Œç„¶åç›´æ¥ä»¥å­—èŠ‚æ•°ç»„å½¢å¼è¯»å–æ–‡ä»¶å†…å®¹ï¼Œè½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²è¾“å‡ºåˆ°æ—¥å¿—ä¸­ï¼š</p><!-- [[[read_end]]] --><pre><code>Files.deleteIfExists(Paths.get(&quot;hello.txt&quot;));\nFiles.write(Paths.get(&quot;hello.txt&quot;), &quot;ä½ å¥½hi&quot;.getBytes(Charset.forName(&quot;GBK&quot;)));\nlog.info(&quot;bytes:{}&quot;, Hex.encodeHexString(Files.readAllBytes(Paths.get(&quot;hello.txt&quot;))).toUpperCase());\n</code></pre><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><pre><code>13:06:28.955 [main] INFO org.geekbang.time.commonmistakes.io.demo3.FileBadEncodingIssueApplication - bytes:C4E3BAC36869\n</code></pre><p>è™½ç„¶æˆ‘ä»¬æ‰“å¼€æ–‡æœ¬æ–‡ä»¶æ—¶çœ‹åˆ°çš„æ˜¯â€œä½ å¥½hiâ€ï¼Œä½†ä¸ç®¡æ˜¯ä»€ä¹ˆæ–‡å­—ï¼Œè®¡ç®—æœºä¸­éƒ½æ˜¯æŒ‰ç…§ä¸€å®šçš„è§„åˆ™å°†å…¶ä»¥äºŒè¿›åˆ¶ä¿å­˜çš„ã€‚è¿™ä¸ªè§„åˆ™å°±æ˜¯å­—ç¬¦é›†ï¼Œå­—ç¬¦é›†æšä¸¾äº†æ‰€æœ‰æ”¯æŒçš„å­—ç¬¦æ˜ å°„æˆäºŒè¿›åˆ¶çš„æ˜ å°„è¡¨ã€‚åœ¨å¤„ç†æ–‡ä»¶è¯»å†™çš„æ—¶å€™ï¼Œå¦‚æœæ˜¯åœ¨å­—èŠ‚å±‚é¢è¿›è¡Œæ“ä½œï¼Œé‚£ä¹ˆä¸ä¼šæ¶‰åŠå­—ç¬¦ç¼–ç é—®é¢˜ï¼›è€Œå¦‚æœéœ€è¦åœ¨å­—ç¬¦å±‚é¢è¿›è¡Œè¯»å†™çš„è¯ï¼Œå°±éœ€è¦æ˜ç¡®å­—ç¬¦çš„ç¼–ç æ–¹å¼ä¹Ÿå°±æ˜¯å­—ç¬¦é›†äº†ã€‚</p><p>å½“æ—¶å‡ºç°é—®é¢˜çš„æ–‡ä»¶è¯»å–ä»£ç æ˜¯è¿™æ ·çš„ï¼š</p><pre><code>char[] chars = new char[10];\nString content = &quot;&quot;;\ntry (FileReader fileReader = new FileReader(&quot;hello.txt&quot;)) {\n    int count;\n    while ((count = fileReader.read(chars)) != -1) {\n        content += new String(chars, 0, count);\n    }\n}\nlog.info(&quot;result:{}&quot;, content);\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œæ˜¯ä½¿ç”¨äº†FileReaderç±»ä»¥å­—ç¬¦æ–¹å¼è¿›è¡Œæ–‡ä»¶è¯»å–ï¼Œæ—¥å¿—ä¸­è¯»å–å‡ºæ¥çš„â€œä½ å¥½â€å˜ä¸ºäº†ä¹±ç ï¼š</p><pre><code>13:06:28.961 [main] INFO org.geekbang.time.commonmistakes.io.demo3.FileBadEncodingIssueApplication - result:ï¿½ï¿½ï¿½hi\n</code></pre><p>æ˜¾ç„¶ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰æŒ‡å®šä»¥ä»€ä¹ˆå­—ç¬¦é›†æ¥è¯»å–æ–‡ä»¶ä¸­çš„å­—ç¬¦ã€‚æŸ¥çœ‹<a href=\"https://docs.oracle.com/javase/8/docs/api/java/io/FileReader.html\">JDKæ–‡æ¡£</a>å¯ä»¥å‘ç°ï¼Œ<strong>FileReaderæ˜¯ä»¥å½“å‰æœºå™¨çš„é»˜è®¤å­—ç¬¦é›†æ¥è¯»å–æ–‡ä»¶çš„</strong>ï¼Œå¦‚æœå¸Œæœ›æŒ‡å®šå­—ç¬¦é›†çš„è¯ï¼Œéœ€è¦ç›´æ¥ä½¿ç”¨InputStreamReaderå’ŒFileInputStreamã€‚</p><p>åˆ°è¿™é‡Œæˆ‘ä»¬å°±æ˜ç™½äº†ï¼ŒFileReaderè™½ç„¶æ–¹ä¾¿ä½†å› ä¸ºä½¿ç”¨äº†é»˜è®¤å­—ç¬¦é›†å¯¹ç¯å¢ƒäº§ç”Ÿäº†ä¾èµ–ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè€çš„æœºå™¨ä¸Šç¨‹åºå¯ä»¥æ­£å¸¸è¿ä½œï¼Œåœ¨æ–°èŠ‚ç‚¹ä¸Šè¯»å–ä¸­æ–‡æ—¶å´äº§ç”Ÿäº†ä¹±ç ã€‚</p><p>é‚£ï¼Œæ€ä¹ˆç¡®å®šå½“å‰æœºå™¨çš„é»˜è®¤å­—ç¬¦é›†å‘¢ï¼Ÿå†™ä¸€æ®µä»£ç è¾“å‡ºå½“å‰æœºå™¨çš„é»˜è®¤å­—ç¬¦é›†ï¼Œä»¥åŠUTF-8æ–¹å¼ç¼–ç çš„â€œä½ å¥½hiâ€çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼š</p><pre><code>log.info(&quot;charset: {}&quot;, Charset.defaultCharset());\nFiles.write(Paths.get(&quot;hello2.txt&quot;), &quot;ä½ å¥½hi&quot;.getBytes(Charsets.UTF_8));\nlog.info(&quot;bytes:{}&quot;, Hex.encodeHexString(Files.readAllBytes(Paths.get(&quot;hello2.txt&quot;))).toUpperCase());\n</code></pre><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><pre><code>13:06:28.961 [main] INFO org.geekbang.time.commonmistakes.io.demo3.FileBadEncodingIssueApplication - charset: UTF-8\n13:06:28.962 [main] INFO org.geekbang.time.commonmistakes.io.demo3.FileBadEncodingIssueApplication - bytes:E4BDA0E5A5BD6869\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œå½“å‰æœºå™¨é»˜è®¤å­—ç¬¦é›†æ˜¯UTF-8ï¼Œå½“ç„¶æ— æ³•è¯»å–GBKç¼–ç çš„æ±‰å­—ã€‚UTF-8ç¼–ç çš„â€œä½ å¥½â€çš„åå…­è¿›åˆ¶æ˜¯E4BDA0E5A5BDï¼Œæ¯ä¸€ä¸ªæ±‰å­—éœ€è¦ä¸‰ä¸ªå­—èŠ‚ï¼›è€ŒGBKç¼–ç çš„æ±‰å­—ï¼Œæ¯ä¸€ä¸ªæ±‰å­—ä¸¤ä¸ªå­—èŠ‚ã€‚å­—èŠ‚é•¿åº¦éƒ½ä¸ä¸€æ ·ï¼Œä»¥GBKç¼–ç åä¿å­˜çš„æ±‰å­—ï¼Œä»¥UTF8è¿›è¡Œè§£ç è¯»å–ï¼Œå¿…ç„¶ä¸ä¼šæˆåŠŸã€‚</p><p>å®šä½åˆ°é—®é¢˜åï¼Œä¿®å¤å°±å¾ˆç®€å•äº†ã€‚æŒ‰ç…§æ–‡æ¡£æ‰€è¯´ï¼Œç›´æ¥ä½¿ç”¨FileInputStreamæ‹¿æ–‡ä»¶æµï¼Œç„¶åä½¿ç”¨InputStreamReaderè¯»å–å­—ç¬¦æµï¼Œå¹¶æŒ‡å®šå­—ç¬¦é›†ä¸ºGBKï¼š</p><pre><code>private static void right1() throws IOException {\n    char[] chars = new char[10];\n    String content = &quot;&quot;;\n    try (FileInputStream fileInputStream = new FileInputStream(&quot;hello.txt&quot;);\n        InputStreamReader inputStreamReader = new InputStreamReader(fileInputStream, Charset.forName(&quot;GBK&quot;))) {\n        int count;\n        while ((count = inputStreamReader.read(chars)) != -1) {\n            content += new String(chars, 0, count);\n        }\n    }\n    log.info(&quot;result: {}&quot;, content);\n}\n</code></pre><p>ä»æ—¥å¿—ä¸­çœ‹åˆ°ï¼Œä¿®å¤åçš„ä»£ç æ­£ç¡®è¯»å–åˆ°äº†â€œä½ å¥½Hiâ€ã€‚</p><pre><code>13:06:28.963 [main] INFO org.geekbang.time.commonmistakes.io.demo3.FileBadEncodingIssueApplication - result: ä½ å¥½hi\n</code></pre><p>å¦‚æœä½ è§‰å¾—è¿™ç§æ–¹å¼æ¯”è¾ƒéº»çƒ¦çš„è¯ï¼Œä½¿ç”¨JDK1.7æ¨å‡ºçš„Filesç±»çš„readAllLinesæ–¹æ³•ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç”¨ä¸€è¡Œä»£ç å®Œæˆæ–‡ä»¶å†…å®¹è¯»å–ï¼š</p><pre><code>log.info(&quot;result: {}&quot;, Files.readAllLines(Paths.get(&quot;hello.txt&quot;), Charset.forName(&quot;GBK&quot;)).stream().findFirst().orElse(&quot;&quot;));\n</code></pre><p><strong>ä½†è¿™ç§æ–¹å¼æœ‰ä¸ªé—®é¢˜æ˜¯ï¼Œè¯»å–è¶…å‡ºå†…å­˜å¤§å°çš„å¤§æ–‡ä»¶æ—¶ä¼šå‡ºç°OOM</strong>ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>æ‰“å¼€readAllLinesæ–¹æ³•çš„æºç å¯ä»¥çœ‹åˆ°ï¼ŒreadAllLinesè¯»å–æ–‡ä»¶æ‰€æœ‰å†…å®¹åï¼Œæ”¾åˆ°ä¸€ä¸ªList&lt;String&gt;ä¸­è¿”å›ï¼Œå¦‚æœå†…å­˜æ— æ³•å®¹çº³è¿™ä¸ªListï¼Œå°±ä¼šOOMï¼š</p><pre><code>public static List&lt;String&gt; readAllLines(Path path, Charset cs) throws IOException {\n    try (BufferedReader reader = newBufferedReader(path, cs)) {\n        List&lt;String&gt; result = new ArrayList&lt;&gt;();\n        for (;;) {\n            String line = reader.readLine();\n            if (line == null)\n                break;\n            result.add(line);\n        }\n        return result;\n    }\n}\n</code></pre><p>é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰åŠæ³•å®ç°æŒ‰éœ€çš„æµå¼è¯»å–å‘¢ï¼Ÿæ¯”å¦‚ï¼Œéœ€è¦æ¶ˆè´¹æŸè¡Œæ•°æ®æ—¶å†è¯»å–ï¼Œè€Œä¸æ˜¯æŠŠæ•´ä¸ªæ–‡ä»¶ä¸€æ¬¡æ€§è¯»å–åˆ°å†…å­˜ï¼Ÿ</p><p>å½“ç„¶æœ‰ï¼Œè§£å†³æ–¹æ¡ˆå°±æ˜¯Fileç±»çš„linesæ–¹æ³•ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å°±ä¸ä½ è¯´è¯´ä½¿ç”¨linesæ–¹æ³•æ—¶éœ€è¦æ³¨æ„çš„ä¸€äº›é—®é¢˜ã€‚</p><h2>ä½¿ç”¨Filesç±»é™æ€æ–¹æ³•è¿›è¡Œæ–‡ä»¶æ“ä½œæ³¨æ„é‡Šæ”¾æ–‡ä»¶å¥æŸ„</h2><p>ä¸readAllLinesæ–¹æ³•è¿”å›List&lt;String&gt;ä¸åŒï¼Œlinesæ–¹æ³•è¿”å›çš„æ˜¯Stream&lt;String&gt;ã€‚è¿™ï¼Œä½¿å¾—æˆ‘ä»¬åœ¨éœ€è¦æ—¶å¯ä»¥ä¸æ–­è¯»å–ã€ä½¿ç”¨æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§åœ°æŠŠæ‰€æœ‰å†…å®¹éƒ½è¯»å–åˆ°å†…å­˜ä¸­ï¼Œå› æ­¤é¿å…äº†OOMã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘é€šè¿‡ä¸€æ®µä»£ç æµ‹è¯•ä¸€ä¸‹ã€‚æˆ‘ä»¬å°è¯•è¯»å–ä¸€ä¸ª1äº¿1ä¸‡è¡Œçš„æ–‡ä»¶ï¼Œæ–‡ä»¶å ç”¨ç£ç›˜ç©ºé—´è¶…è¿‡4GBã€‚å¦‚æœä½¿ç”¨-Xmx512m -Xms512må¯åŠ¨JVMæ§åˆ¶æœ€å¤§å †å†…å­˜ä¸º512Mçš„è¯ï¼Œè‚¯å®šæ— æ³•ä¸€æ¬¡æ€§è¯»å–è¿™æ ·çš„å¤§æ–‡ä»¶ï¼Œä½†é€šè¿‡Files.linesæ–¹æ³•å°±æ²¡é—®é¢˜ã€‚</p><p>åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œé¦–å…ˆè¾“å‡ºè¿™ä¸ªæ–‡ä»¶çš„å¤§å°ï¼Œç„¶åè®¡ç®—è¯»å–20ä¸‡è¡Œæ•°æ®å’Œ200ä¸‡è¡Œæ•°æ®çš„è€—æ—¶å·®å¼‚ï¼Œæœ€åé€è¡Œè¯»å–æ–‡ä»¶ï¼Œç»Ÿè®¡æ–‡ä»¶çš„æ€»è¡Œæ•°ï¼š</p><pre><code>//è¾“å‡ºæ–‡ä»¶å¤§å°\nlog.info(&quot;file size:{}&quot;, Files.size(Paths.get(&quot;test.txt&quot;)));\nStopWatch stopWatch = new StopWatch();\nstopWatch.start(&quot;read 200000 lines&quot;);\n//ä½¿ç”¨Files.linesæ–¹æ³•è¯»å–20ä¸‡è¡Œæ•°æ®\nlog.info(&quot;lines {}&quot;, Files.lines(Paths.get(&quot;test.txt&quot;)).limit(200000).collect(Collectors.toList()).size());\nstopWatch.stop();\nstopWatch.start(&quot;read 2000000 lines&quot;);\n//ä½¿ç”¨Files.linesæ–¹æ³•è¯»å–200ä¸‡è¡Œæ•°æ®\nlog.info(&quot;lines {}&quot;, Files.lines(Paths.get(&quot;test.txt&quot;)).limit(2000000).collect(Collectors.toList()).size());\nstopWatch.stop();\nlog.info(stopWatch.prettyPrint());\nAtomicLong atomicLong = new AtomicLong();\n//ä½¿ç”¨Files.linesæ–¹æ³•ç»Ÿè®¡æ–‡ä»¶æ€»è¡Œæ•°\nFiles.lines(Paths.get(&quot;test.txt&quot;)).forEach(line-&gt;atomicLong.incrementAndGet());\nlog.info(&quot;total lines {}&quot;, atomicLong.get());\n</code></pre><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/29/77/29ee0fd687642ed87badaa96f9bdfd77.png?wh=3092*532\" alt=\"\"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå®ç°äº†å…¨æ–‡ä»¶çš„è¯»å–ã€ç»Ÿè®¡äº†æ•´ä¸ªæ–‡ä»¶çš„è¡Œæ•°ï¼Œå¹¶æ²¡æœ‰å‡ºç°OOMï¼›è¯»å–200ä¸‡è¡Œæ•°æ®è€—æ—¶760msï¼Œè¯»å–20ä¸‡è¡Œæ•°æ®ä»…éœ€267msã€‚è¿™äº›éƒ½å¯ä»¥è¯´æ˜ï¼ŒFile.linesæ–¹æ³•å¹¶ä¸æ˜¯ä¸€æ¬¡æ€§è¯»å–æ•´ä¸ªæ–‡ä»¶çš„ï¼Œè€Œæ˜¯æŒ‰éœ€è¯»å–ã€‚</p><p>åˆ°è¿™é‡Œï¼Œä½ è§‰å¾—è¿™æ®µä»£ç æœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ</p><p>é—®é¢˜åœ¨äºè¯»å–å®Œæ–‡ä»¶åæ²¡æœ‰å…³é—­ã€‚æˆ‘ä»¬é€šå¸¸ä¼šè®¤ä¸ºé™æ€æ–¹æ³•çš„è°ƒç”¨ä¸æ¶‰åŠèµ„æºé‡Šæ”¾ï¼Œå› ä¸ºæ–¹æ³•è°ƒç”¨ç»“æŸè‡ªç„¶ä»£è¡¨èµ„æºä½¿ç”¨å®Œæˆï¼Œç”±APIé‡Šæ”¾èµ„æºï¼Œä½†å¯¹äºFilesç±»çš„ä¸€äº›è¿”å›Streamçš„æ–¹æ³•å¹¶ä¸æ˜¯è¿™æ ·ã€‚è¿™ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå®¹æ˜“è¢«å¿½ç•¥çš„ä¸¥é‡é—®é¢˜ã€‚</p><p>æˆ‘å°±æ›¾é‡åˆ°è¿‡ä¸€ä¸ªæ¡ˆä¾‹ï¼šç¨‹åºåœ¨ç”Ÿäº§ä¸Šè¿è¡Œä¸€æ®µæ—¶é—´åå°±ä¼šå‡ºç°too many filesçš„é”™è¯¯ï¼Œæˆ‘ä»¬æƒ³å½“ç„¶åœ°è®¤ä¸ºæ˜¯OSè®¾ç½®çš„æœ€å¤§æ–‡ä»¶å¥æŸ„å¤ªå°äº†ï¼Œå°±è®©è¿ç»´æ”¾å¼€è¿™ä¸ªé™åˆ¶ï¼Œä½†æ”¾å¼€åè¿˜æ˜¯ä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜ã€‚ç»æ’æŸ¥å‘ç°ï¼Œå…¶å®æ˜¯æ–‡ä»¶å¥æŸ„æ²¡æœ‰é‡Šæ”¾å¯¼è‡´çš„ï¼Œé—®é¢˜å°±å‡ºåœ¨Files.linesæ–¹æ³•ä¸Šã€‚</p><p>æˆ‘ä»¬æ¥é‡ç°ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼Œéšä¾¿å†™å…¥10è¡Œæ•°æ®åˆ°ä¸€ä¸ªdemo.txtæ–‡ä»¶ä¸­ï¼š</p><pre><code>Files.write(Paths.get(&quot;demo.txt&quot;),\nIntStream.rangeClosed(1, 10).mapToObj(i -&gt; UUID.randomUUID().toString()).collect(Collectors.toList())\n, UTF_8, CREATE, TRUNCATE_EXISTING);\n</code></pre><p>ç„¶åä½¿ç”¨Files.linesæ–¹æ³•è¯»å–è¿™ä¸ªæ–‡ä»¶100ä¸‡æ¬¡ï¼Œæ¯è¯»å–ä¸€è¡Œè®¡æ•°å™¨+1ï¼š</p><pre><code>LongAdder longAdder = new LongAdder();\nIntStream.rangeClosed(1, 1000000).forEach(i -&gt; {\n    try {\n        Files.lines(Paths.get(&quot;demo.txt&quot;)).forEach(line -&gt; longAdder.increment());\n    } catch (IOException e) {\n        e.printStackTrace();\n    }\n});\nlog.info(&quot;total : {}&quot;, longAdder.longValue());\t\n</code></pre><p>è¿è¡Œåé©¬ä¸Šå¯ä»¥åœ¨æ—¥å¿—ä¸­çœ‹åˆ°å¦‚ä¸‹é”™è¯¯ï¼š</p><pre><code>java.nio.file.FileSystemException: demo.txt: Too many open files\nat sun.nio.fs.UnixException.translateToIOException(UnixException.java:91)\nat sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)\nat sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107)\n</code></pre><p>ä½¿ç”¨lsofå‘½ä»¤æŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°æ‰“å¼€äº†1ä¸‡å¤šä¸ªdemo.txtï¼š</p><pre><code>lsof -p 63937\n...\njava    63902 zhuye *238r   REG                1,4      370         12934160647 /Users/zhuye/Documents/common-mistakes/demo.txt\njava    63902 zhuye *239r   REG                1,4      370         12934160647 /Users/zhuye/Documents/common-mistakes/demo.txt\n...\n\nlsof -p 63937 | grep demo.txt | wc -l\n   10007\n</code></pre><p><strong>å…¶å®ï¼Œåœ¨<a href=\"https://docs.oracle.com/javase/8/docs/api/java/nio/file/Files.html\">JDKæ–‡æ¡£</a>ä¸­æœ‰æåˆ°ï¼Œæ³¨æ„ä½¿ç”¨try-with-resourcesæ–¹å¼æ¥é…åˆï¼Œç¡®ä¿æµçš„closeæ–¹æ³•å¯ä»¥è°ƒç”¨é‡Šæ”¾èµ„æºã€‚</strong></p><p>è¿™ä¹Ÿå¾ˆå®¹æ˜“ç†è§£ï¼Œä½¿ç”¨æµå¼å¤„ç†ï¼Œå¦‚æœä¸æ˜¾å¼åœ°å‘Šè¯‰ç¨‹åºä»€ä¹ˆæ—¶å€™ç”¨å®Œäº†æµï¼Œç¨‹åºåˆå¦‚ä½•çŸ¥é“å‘¢ï¼Œå®ƒä¹Ÿä¸èƒ½å¸®æˆ‘ä»¬åšä¸»ä½•æ—¶å…³é—­æ–‡ä»¶ã€‚</p><p>ä¿®å¤æ–¹å¼å¾ˆç®€å•ï¼Œä½¿ç”¨tryæ¥åŒ…è£¹Streamå³å¯ï¼š</p><pre><code>LongAdder longAdder = new LongAdder();\nIntStream.rangeClosed(1, 1000000).forEach(i -&gt; {\n    try (Stream&lt;String&gt; lines = Files.lines(Paths.get(&quot;demo.txt&quot;))) {\n        lines.forEach(line -&gt; longAdder.increment());\n    } catch (IOException e) {\n        e.printStackTrace();\n    }\n});\nlog.info(&quot;total : {}&quot;, longAdder.longValue());\n</code></pre><p>ä¿®æ”¹åçš„ä»£ç ä¸å†å‡ºç°é”™è¯¯æ—¥å¿—ï¼Œå› ä¸ºè¯»å–äº†100ä¸‡æ¬¡åŒ…å«10è¡Œæ•°æ®çš„æ–‡ä»¶ï¼Œæ‰€ä»¥æœ€ç»ˆæ­£ç¡®è¾“å‡ºäº†1000ä¸‡ï¼š</p><pre><code>14:19:29.410 [main] INFO org.geekbang.time.commonmistakes.io.demo2.FilesStreamOperationNeedCloseApplication - total : 10000000\n</code></pre><p>æŸ¥çœ‹linesæ–¹æ³•æºç å¯ä»¥å‘ç°ï¼ŒStreamçš„closeæ³¨å†Œäº†ä¸€ä¸ªå›è°ƒï¼Œæ¥å…³é—­BufferedReaderè¿›è¡Œèµ„æºé‡Šæ”¾ï¼š</p><pre><code>public static Stream&lt;String&gt; lines(Path path, Charset cs) throws IOException {\n    BufferedReader br = Files.newBufferedReader(path, cs);\n    try {\n        return br.lines().onClose(asUncheckedRunnable(br));\n    } catch (Error|RuntimeException e) {\n        try {\n            br.close();\n        } catch (IOException ex) {\n            try {\n                e.addSuppressed(ex);\n            } catch (Throwable ignore) {}\n        }\n        throw e;\n    }\n}\n\nprivate static Runnable asUncheckedRunnable(Closeable c) {\n    return () -&gt; {\n        try {\n            c.close();\n        } catch (IOException e) {\n            throw new UncheckedIOException(e);\n        }\n    };\n}\n</code></pre><p>ä»å‘½åä¸Šå¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨BufferedReaderè¿›è¡Œå­—ç¬¦æµè¯»å–æ—¶ï¼Œç”¨åˆ°äº†ç¼“å†²ã€‚è¿™é‡Œç¼“å†²Bufferçš„æ„æ€æ˜¯ï¼Œä½¿ç”¨ä¸€å—å†…å­˜åŒºåŸŸä½œä¸ºç›´æ¥æ“ä½œçš„ä¸­è½¬ã€‚</p><p>æ¯”å¦‚ï¼Œè¯»å–æ–‡ä»¶æ“ä½œå°±æ˜¯ä¸€æ¬¡æ€§è¯»å–ä¸€å¤§å—æ•°æ®ï¼ˆæ¯”å¦‚8KBï¼‰åˆ°ç¼“å†²åŒºï¼Œåç»­çš„è¯»å–å¯ä»¥ç›´æ¥ä»ç¼“å†²åŒºè¿”å›æ•°æ®ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½ç›´æ¥å¯¹åº”æ–‡ä»¶IOã€‚å†™æ“ä½œä¹Ÿæ˜¯ç±»ä¼¼ã€‚å¦‚æœæ¯æ¬¡å†™å‡ åå­—èŠ‚åˆ°æ–‡ä»¶éƒ½å¯¹åº”ä¸€æ¬¡IOæ“ä½œï¼Œé‚£ä¹ˆå†™ä¸€ä¸ªå‡ ç™¾å…†çš„å¤§æ–‡ä»¶å¯èƒ½å°±éœ€è¦åƒä¸‡æ¬¡çš„IOæ“ä½œï¼Œè€—æ—¶ä¼šéå¸¸ä¹…ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°±é€šè¿‡å‡ ä¸ªå®éªŒï¼Œå’Œä½ è¯´æ˜ä½¿ç”¨ç¼“å†²Bufferçš„é‡è¦æ€§ï¼Œå¹¶å¯¹æ¯”ä¸‹ä¸åŒä½¿ç”¨æ–¹å¼çš„æ–‡ä»¶è¯»å†™æ€§èƒ½ï¼Œæ¥å¸®åŠ©ä½ ç”¨å¯¹ã€ç”¨å¥½Bufferã€‚</p><h2>æ³¨æ„è¯»å†™æ–‡ä»¶è¦è€ƒè™‘è®¾ç½®ç¼“å†²åŒº</h2><p>æˆ‘æ›¾é‡åˆ°è¿‡è¿™ä¹ˆä¸€ä¸ªæ¡ˆä¾‹ï¼Œä¸€æ®µå…ˆè¿›è¡Œæ–‡ä»¶è¯»å…¥å†ç®€å•å¤„ç†åå†™å…¥å¦ä¸€ä¸ªæ–‡ä»¶çš„ä¸šåŠ¡ä»£ç ï¼Œç”±äºå¼€å‘äººå‘˜ä½¿ç”¨äº†å•å­—èŠ‚çš„è¯»å–å†™å…¥æ–¹å¼ï¼Œå¯¼è‡´æ‰§è¡Œå¾—å·¨æ…¢ï¼Œä¸šåŠ¡é‡ä¸Šæ¥åéœ€è¦æ•°å°æ—¶æ‰èƒ½å®Œæˆã€‚</p><p>æˆ‘ä»¬æ¥æ¨¡æ‹Ÿä¸€ä¸‹ç›¸å…³å®ç°ã€‚åˆ›å»ºä¸€ä¸ªæ–‡ä»¶éšæœºå†™å…¥100ä¸‡è¡Œæ•°æ®ï¼Œæ–‡ä»¶å¤§å°åœ¨35MBå·¦å³ï¼š</p><pre><code>Files.write(Paths.get(&quot;src.txt&quot;),\nIntStream.rangeClosed(1, 1000000).mapToObj(i -&gt; UUID.randomUUID().toString()).collect(Collectors.toList())\n, UTF_8, CREATE, TRUNCATE_EXISTING);\n</code></pre><p>å½“æ—¶å¼€å‘äººå‘˜å†™çš„æ–‡ä»¶å¤„ç†ä»£ç å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼šä½¿ç”¨FileInputStreamè·å¾—ä¸€ä¸ªæ–‡ä»¶è¾“å…¥æµï¼Œç„¶åè°ƒç”¨å…¶readæ–¹æ³•æ¯æ¬¡è¯»å–ä¸€ä¸ªå­—èŠ‚ï¼Œæœ€åé€šè¿‡ä¸€ä¸ªFileOutputStreamæ–‡ä»¶è¾“å‡ºæµæŠŠå¤„ç†åçš„ç»“æœå†™å…¥å¦ä¸€ä¸ªæ–‡ä»¶ã€‚</p><p>ä¸ºäº†ç®€åŒ–é€»è¾‘ä¾¿äºç†è§£ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸å¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œç›´æ¥æŠŠåŸæ–‡ä»¶æ•°æ®å†™å…¥ç›®æ ‡æ–‡ä»¶ï¼Œç›¸å½“äºæ–‡ä»¶å¤åˆ¶ï¼š</p><pre><code>private static void perByteOperation() throws IOException {\n    try (FileInputStream fileInputStream = new FileInputStream(&quot;src.txt&quot;);\n         FileOutputStream fileOutputStream = new FileOutputStream(&quot;dest.txt&quot;)) {\n        int i;\n        while ((i = fileInputStream.read()) != -1) {\n            fileOutputStream.write(i);\n        }\n    }\n}\n</code></pre><p>è¿™æ ·çš„å®ç°ï¼Œå¤åˆ¶ä¸€ä¸ª35MBçš„æ–‡ä»¶å±…ç„¶è€—æ—¶190ç§’ã€‚</p><p><strong>æ˜¾ç„¶ï¼Œæ¯è¯»å–ä¸€ä¸ªå­—èŠ‚ã€æ¯å†™å…¥ä¸€ä¸ªå­—èŠ‚éƒ½è¿›è¡Œä¸€æ¬¡IOæ“ä½œï¼Œä»£ä»·å¤ªå¤§äº†</strong>ã€‚è§£å†³æ–¹æ¡ˆå°±æ˜¯ï¼Œè€ƒè™‘ä½¿ç”¨ç¼“å†²åŒºä½œä¸ºè¿‡æ¸¡ï¼Œä¸€æ¬¡æ€§ä»åŸæ–‡ä»¶è¯»å–ä¸€å®šæ•°é‡çš„æ•°æ®åˆ°ç¼“å†²åŒºï¼Œä¸€æ¬¡æ€§å†™å…¥ä¸€å®šæ•°é‡çš„æ•°æ®åˆ°ç›®æ ‡æ–‡ä»¶ã€‚</p><p>æ”¹è‰¯åï¼Œä½¿ç”¨100å­—èŠ‚ä½œä¸ºç¼“å†²åŒºï¼Œä½¿ç”¨FileInputStreamçš„byte[]çš„é‡è½½æ¥ä¸€æ¬¡æ€§è¯»å–ä¸€å®šå­—èŠ‚çš„æ•°æ®ï¼ŒåŒæ—¶ä½¿ç”¨FileOutputStreamçš„byte[]çš„é‡è½½å®ç°ä¸€æ¬¡æ€§ä»ç¼“å†²åŒºå†™å…¥ä¸€å®šå­—èŠ‚çš„æ•°æ®åˆ°æ–‡ä»¶ï¼š</p><pre><code>private static void bufferOperationWith100Buffer() throws IOException {\n    try (FileInputStream fileInputStream = new FileInputStream(&quot;src.txt&quot;);\n         FileOutputStream fileOutputStream = new FileOutputStream(&quot;dest.txt&quot;)) {\n        byte[] buffer = new byte[100];\n        int len = 0;\n        while ((len = fileInputStream.read(buffer)) != -1) {\n            fileOutputStream.write(buffer, 0, len);\n        }\n    }\n}\n</code></pre><p>ä»…ä»…ä½¿ç”¨äº†100ä¸ªå­—èŠ‚çš„ç¼“å†²åŒºä½œä¸ºè¿‡æ¸¡ï¼Œå®Œæˆ35Mæ–‡ä»¶çš„å¤åˆ¶è€—æ—¶ç¼©çŸ­åˆ°äº†26ç§’ï¼Œæ˜¯æ— ç¼“å†²æ—¶æ€§èƒ½çš„7å€ï¼›å¦‚æœæŠŠç¼“å†²åŒºæ”¾å¤§åˆ°1000å­—èŠ‚ï¼Œè€—æ—¶å¯ä»¥è¿›ä¸€æ­¥ç¼©çŸ­åˆ°342æ¯«ç§’ã€‚å¯ä»¥çœ‹åˆ°ï¼Œ<strong>åœ¨è¿›è¡Œæ–‡ä»¶IOå¤„ç†çš„æ—¶å€™ï¼Œä½¿ç”¨åˆé€‚çš„ç¼“å†²åŒºå¯ä»¥æ˜æ˜¾æé«˜æ€§èƒ½</strong>ã€‚</p><p>ä½ å¯èƒ½ä¼šè¯´ï¼Œå®ç°æ–‡ä»¶è¯»å†™è¿˜è¦è‡ªå·±newä¸€ä¸ªç¼“å†²åŒºå‡ºæ¥ï¼Œå¤ªéº»çƒ¦äº†ï¼Œä¸æ˜¯æœ‰ä¸€ä¸ªBufferedInputStreamå’ŒBufferedOutputStreamå¯ä»¥å®ç°è¾“å…¥è¾“å‡ºæµçš„ç¼“å†²å¤„ç†å—ï¼Ÿ</p><p>æ˜¯çš„ï¼Œå®ƒä»¬åœ¨å†…éƒ¨å®ç°äº†ä¸€ä¸ªé»˜è®¤8KBå¤§å°çš„ç¼“å†²åŒºã€‚ä½†æ˜¯ï¼Œåœ¨ä½¿ç”¨BufferedInputStreamå’ŒBufferedOutputStreamæ—¶ï¼Œæˆ‘è¿˜æ˜¯å»ºè®®ä½ å†ä½¿ç”¨ä¸€ä¸ªç¼“å†²è¿›è¡Œè¯»å†™ï¼Œä¸è¦å› ä¸ºå®ƒä»¬å®ç°äº†å†…éƒ¨ç¼“å†²å°±è¿›è¡Œé€å­—èŠ‚çš„æ“ä½œã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å†™ä¸€æ®µä»£ç æ¯”è¾ƒä¸‹ä½¿ç”¨ä¸‹é¢ä¸‰ç§æ–¹å¼è¯»å†™ä¸€ä¸ªå­—èŠ‚çš„æ€§èƒ½ï¼š</p><ul>\n<li>ç›´æ¥ä½¿ç”¨BufferedInputStreamå’ŒBufferedOutputStreamï¼›</li>\n<li>é¢å¤–ä½¿ç”¨ä¸€ä¸ª8KBç¼“å†²ï¼Œä½¿ç”¨BufferedInputStreamå’ŒBufferedOutputStreamï¼›</li>\n<li>ç›´æ¥ä½¿ç”¨FileInputStreamå’ŒFileOutputStreamï¼Œå†ä½¿ç”¨ä¸€ä¸ª8KBçš„ç¼“å†²ã€‚</li>\n</ul><pre><code>//ä½¿ç”¨BufferedInputStreamå’ŒBufferedOutputStream\nprivate static void bufferedStreamByteOperation() throws IOException {\n   try (BufferedInputStream bufferedInputStream = new BufferedInputStream(new FileInputStream(&quot;src.txt&quot;));\n        BufferedOutputStream bufferedOutputStream = new BufferedOutputStream(new FileOutputStream(&quot;dest.txt&quot;))) {\n        int i;\n        while ((i = bufferedInputStream.read()) != -1) {\n            bufferedOutputStream.write(i);\n        }\n    }\n}\n//é¢å¤–ä½¿ç”¨ä¸€ä¸ª8KBç¼“å†²ï¼Œå†ä½¿ç”¨BufferedInputStreamå’ŒBufferedOutputStream\nprivate static void bufferedStreamBufferOperation() throws IOException {\n    try (BufferedInputStream bufferedInputStream = new BufferedInputStream(new FileInputStream(&quot;src.txt&quot;));\n         BufferedOutputStream bufferedOutputStream = new BufferedOutputStream(new FileOutputStream(&quot;dest.txt&quot;))) {\n        byte[] buffer = new byte[8192];\n        int len = 0;\n        while ((len = bufferedInputStream.read(buffer)) != -1) {\n            bufferedOutputStream.write(buffer, 0, len);\n        }\n    }\n}\n//ç›´æ¥ä½¿ç”¨FileInputStreamå’ŒFileOutputStreamï¼Œå†ä½¿ç”¨ä¸€ä¸ª8KBçš„ç¼“å†²\nprivate static void largerBufferOperation() throws IOException {\n    try (FileInputStream fileInputStream = new FileInputStream(&quot;src.txt&quot;);\n        FileOutputStream fileOutputStream = new FileOutputStream(&quot;dest.txt&quot;)) {\n        byte[] buffer = new byte[8192];\n        int len = 0;\n        while ((len = fileInputStream.read(buffer)) != -1) {\n            fileOutputStream.write(buffer, 0, len);\n        }\n    }\n}\n</code></pre><p>ç»“æœå¦‚ä¸‹ï¼š</p><pre><code>---------------------------------------------\nns         %     Task name\n---------------------------------------------\n1424649223  086%  bufferedStreamByteOperation\n117807808  007%  bufferedStreamBufferOperation\n112153174  007%  largerBufferOperation\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸€ç§æ–¹å¼è™½ç„¶ä½¿ç”¨äº†ç¼“å†²æµï¼Œä½†é€å­—èŠ‚çš„æ“ä½œå› ä¸ºæ–¹æ³•è°ƒç”¨æ¬¡æ•°å®åœ¨å¤ªå¤šè¿˜æ˜¯æ…¢ï¼Œè€—æ—¶1.4ç§’ï¼›åé¢ä¸¤ç§æ–¹å¼çš„æ€§èƒ½å·®ä¸å¤šï¼Œè€—æ—¶110æ¯«ç§’å·¦å³ã€‚è™½ç„¶ç¬¬ä¸‰ç§æ–¹å¼æ²¡æœ‰ä½¿ç”¨ç¼“å†²æµï¼Œä½†ä½¿ç”¨äº†8KBå¤§å°çš„ç¼“å†²åŒºï¼Œå’Œç¼“å†²æµé»˜è®¤çš„ç¼“å†²åŒºå¤§å°ç›¸åŒã€‚</p><p>çœ‹åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½ä¼šç–‘æƒ‘äº†ï¼Œæ—¢ç„¶è¿™æ ·ä½¿ç”¨BufferedInputStreamå’ŒBufferedOutputStreamæœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿ</p><p>å…¶å®ï¼Œè¿™é‡Œæˆ‘æ˜¯ä¸ºäº†æ¼”ç¤ºæ‰€ä»¥ç¤ºä¾‹ä¸‰ä½¿ç”¨äº†å›ºå®šå¤§å°çš„ç¼“å†²åŒºï¼Œä½†åœ¨å®é™…ä»£ç ä¸­æ¯æ¬¡éœ€è¦è¯»å–çš„å­—èŠ‚æ•°å¾ˆå¯èƒ½ä¸æ˜¯å›ºå®šçš„ï¼Œæœ‰çš„æ—¶å€™è¯»å–å‡ ä¸ªå­—èŠ‚ï¼Œæœ‰çš„æ—¶å€™è¯»å–å‡ ç™¾å­—èŠ‚ï¼Œè¿™ä¸ªæ—¶å€™æœ‰ä¸€ä¸ªå›ºå®šå¤§å°è¾ƒå¤§çš„ç¼“å†²ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨BufferedInputStreamå’ŒBufferedOutputStreamåšä¸ºåå¤‡çš„ç¨³å®šçš„äºŒæ¬¡ç¼“å†²ï¼Œå°±éå¸¸æœ‰æ„ä¹‰äº†ã€‚</p><p>æœ€åæˆ‘è¦è¡¥å……è¯´æ˜çš„æ˜¯ï¼Œå¯¹äºç±»ä¼¼çš„æ–‡ä»¶å¤åˆ¶æ“ä½œï¼Œå¦‚æœå¸Œæœ›æœ‰æ›´é«˜æ€§èƒ½ï¼Œå¯ä»¥ä½¿ç”¨FileChannelçš„transfreToæ–¹æ³•è¿›è¡Œæµçš„å¤åˆ¶ã€‚åœ¨ä¸€äº›æ“ä½œç³»ç»Ÿï¼ˆæ¯”å¦‚é«˜ç‰ˆæœ¬çš„Linuxå’ŒUNIXï¼‰ä¸Šå¯ä»¥å®ç°DMAï¼ˆç›´æ¥å†…å­˜è®¿é—®ï¼‰ï¼Œä¹Ÿå°±æ˜¯æ•°æ®ä»ç£ç›˜ç»è¿‡æ€»çº¿ç›´æ¥å‘é€åˆ°ç›®æ ‡æ–‡ä»¶ï¼Œæ— éœ€ç»è¿‡å†…å­˜å’ŒCPUè¿›è¡Œæ•°æ®ä¸­è½¬ï¼š</p><pre><code>private static void fileChannelOperation() throws IOException {\n    FileChannel in = FileChannel.open(Paths.get(&quot;src.txt&quot;), StandardOpenOption.READ);\n    FileChannel out = FileChannel.open(Paths.get(&quot;dest.txt&quot;), CREATE, WRITE);\n    in.transferTo(0, in.size(), out);\n}\n</code></pre><p>ä½ å¯ä»¥é€šè¿‡<a href=\"https://developer.ibm.com/articles/j-zerocopy/\">è¿™ç¯‡æ–‡ç« </a>ï¼Œäº†è§£transferToæ–¹æ³•çš„æ›´å¤šç»†èŠ‚ã€‚</p><p>åœ¨æµ‹è¯•FileChannelæ€§èƒ½çš„åŒæ—¶ï¼Œæˆ‘å†è¿è¡Œä¸€ä¸‹è¿™ä¸€å°èŠ‚ä¸­çš„æ‰€æœ‰å®ç°ï¼Œæ¯”è¾ƒä¸€ä¸‹è¯»å†™35MBæ–‡ä»¶çš„è€—æ—¶ã€‚</p><pre><code>---------------------------------------------\nns         %     Task name\n---------------------------------------------\n183673362265  098%  perByteOperation\n2034504694  001%  bufferOperationWith100Buffer\n749967898  000%  bufferedStreamByteOperation\n110602155  000%  bufferedStreamBufferOperation\n114542834  000%  largerBufferOperation\n050068602  000%  fileChannelOperation\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œæœ€æ…¢çš„æ˜¯å•å­—èŠ‚è¯»å†™æ–‡ä»¶æµçš„æ–¹å¼ï¼Œè€—æ—¶183ç§’ï¼Œæœ€å¿«çš„æ˜¯FileChannel.transferToæ–¹å¼è¿›è¡Œæµè½¬å‘çš„æ–¹å¼ï¼Œè€—æ—¶50æ¯«ç§’ã€‚ä¸¤è€…è€—æ—¶ç›¸å·®è¾¾åˆ°3600å€ï¼</p><h2>é‡ç‚¹å›é¡¾</h2><p>ä»Šå¤©ï¼Œæˆ‘é€šè¿‡ä¸‰ä¸ªæ¡ˆä¾‹å’Œä½ åˆ†äº«äº†æ–‡ä»¶è¯»å†™æ“ä½œä¸­æœ€é‡è¦çš„å‡ ä¸ªæ–¹é¢ã€‚</p><p>ç¬¬ä¸€ï¼Œå¦‚æœéœ€è¦è¯»å†™å­—ç¬¦æµï¼Œé‚£ä¹ˆéœ€è¦ç¡®ä¿æ–‡ä»¶ä¸­å­—ç¬¦çš„å­—ç¬¦é›†å’Œå­—ç¬¦æµçš„å­—ç¬¦é›†æ˜¯ä¸€è‡´çš„ï¼Œå¦åˆ™å¯èƒ½äº§ç”Ÿä¹±ç ã€‚</p><p>ç¬¬äºŒï¼Œä½¿ç”¨Filesç±»çš„ä¸€äº›æµå¼å¤„ç†æ“ä½œï¼Œæ³¨æ„ä½¿ç”¨try-with-resourcesåŒ…è£…Streamï¼Œç¡®ä¿åº•å±‚æ–‡ä»¶èµ„æºå¯ä»¥é‡Šæ”¾ï¼Œé¿å…äº§ç”Ÿtoo many open filesçš„é—®é¢˜ã€‚</p><p>ç¬¬ä¸‰ï¼Œè¿›è¡Œæ–‡ä»¶å­—èŠ‚æµæ“ä½œçš„æ—¶å€™ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸è€ƒè™‘è¿›è¡Œé€å­—èŠ‚æ“ä½œï¼Œä½¿ç”¨ç¼“å†²åŒºè¿›è¡Œæ‰¹é‡è¯»å†™å‡å°‘IOæ¬¡æ•°ï¼Œæ€§èƒ½ä¼šå¥½å¾ˆå¤šã€‚ä¸€èˆ¬å¯ä»¥è€ƒè™‘ç›´æ¥ä½¿ç”¨ç¼“å†²è¾“å…¥è¾“å‡ºæµBufferedXXXStreamï¼Œè¿½æ±‚æé™æ€§èƒ½çš„è¯å¯ä»¥è€ƒè™‘ä½¿ç”¨FileChannelè¿›è¡Œæµè½¬å‘ã€‚</p><p>æœ€åæˆ‘è¦å¼ºè°ƒçš„æ˜¯ï¼Œæ–‡ä»¶æ“ä½œå› ä¸ºæ¶‰åŠæ“ä½œç³»ç»Ÿå’Œæ–‡ä»¶ç³»ç»Ÿçš„å®ç°ï¼ŒJDKå¹¶ä¸èƒ½ç¡®ä¿æ‰€æœ‰IO APIåœ¨æ‰€æœ‰å¹³å°çš„é€»è¾‘ä¸€è‡´æ€§ï¼Œä»£ç è¿ç§»åˆ°æ–°çš„æ“ä½œç³»ç»Ÿæˆ–æ–‡ä»¶ç³»ç»Ÿæ—¶ï¼Œè¦é‡æ–°è¿›è¡ŒåŠŸèƒ½æµ‹è¯•å’Œæ€§èƒ½æµ‹è¯•ã€‚</p><p>ä»Šå¤©ç”¨åˆ°çš„ä»£ç ï¼Œæˆ‘éƒ½æ”¾åœ¨äº†GitHubä¸Šï¼Œä½ å¯ä»¥ç‚¹å‡»<a href=\"https://github.com/JosephZhu1983/java-common-mistakes\">è¿™ä¸ªé“¾æ¥</a>æŸ¥çœ‹ã€‚</p><h2>æ€è€ƒä¸è®¨è®º</h2><ol>\n<li>Files.linesæ–¹æ³•è¿›è¡Œæµå¼å¤„ç†ï¼Œéœ€è¦ä½¿ç”¨try-with-resourcesè¿›è¡Œèµ„æºé‡Šæ”¾ã€‚é‚£ä¹ˆï¼Œä½¿ç”¨Filesç±»ä¸­å…¶ä»–è¿”å›StreamåŒ…è£…å¯¹è±¡çš„æ–¹æ³•è¿›è¡Œæµå¼å¤„ç†ï¼Œæ¯”å¦‚newDirectoryStreamæ–¹æ³•è¿”å›DirectoryStream&lt;Path&gt;ï¼Œlistã€walkå’Œfindæ–¹æ³•è¿”å›Stream&lt;Path&gt;ï¼Œä¹ŸåŒæ ·æœ‰èµ„æºé‡Šæ”¾é—®é¢˜å—ï¼Ÿ</li>\n<li>Javaçš„Fileç±»å’ŒFilesç±»æä¾›çš„æ–‡ä»¶å¤åˆ¶ã€é‡å‘½åã€åˆ é™¤ç­‰æ“ä½œï¼Œæ˜¯åŸå­æ€§çš„å—ï¼Ÿ</li>\n</ol><p>å¯¹äºæ–‡ä»¶æ“ä½œï¼Œä½ è¿˜é‡åˆ°è¿‡ä»€ä¹ˆå‘å—ï¼Ÿæˆ‘æ˜¯æœ±æ™”ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºä¸æˆ‘ç•™è¨€åˆ†äº«ä½ çš„æƒ³æ³•ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–åŒäº‹ï¼Œä¸€èµ·äº¤æµã€‚</p>","neighbors":{"left":{"article_title":"13 | æ—¥å¿—ï¼šæ—¥å¿—è®°å½•çœŸæ²¡ä½ æƒ³è±¡çš„é‚£ä¹ˆç®€å•","id":220307},"right":{"article_title":"15 | åºåˆ—åŒ–ï¼šä¸€æ¥ä¸€å›ä½ è¿˜æ˜¯åŸæ¥çš„ä½ å—ï¼Ÿ","id":223111}},"comments":[{"had_liked":false,"id":205837,"user_name":"Darren","can_delete":false,"product_type":"c1","uid":1254968,"ip_address":"","ucode":"CCD2B2C492BE9A","user_header":"https://static001.geekbang.org/account/avatar/00/13/26/38/ef063dc2.jpg","comment_is_top":false,"comment_ctime":1586745646,"is_pvip":true,"replies":[{"id":"76922","content":"ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»","user_name":"ä½œè€…å›å¤","comment_id":205837,"uid":"1001470","ip_address":"","utype":1,"ctime":1586751474,"user_name_real":"æœ±æ™”"}],"discussion_count":7,"race_medal":0,"score":"302234456366","product_id":100047701,"comment_content":"ä»Šå¤©ç®—æ˜¯æ‰“å¼€äº†ä¸€ç‰‡æ–°çš„å¤©åœ°ï¼Œå› ä¸ºæ—¥å¸¸çš„å¼€å‘è®¾è®¡æ–‡ä»¶çš„ä¸å¤ªå¤šï¼Œç«Ÿç„¶ä¸çŸ¥é“æœ‰Filesè¿™æ ·çš„ç‰›é€¼æ“ä½œï¼Œä¹‹å‰å¯¹äºJDKç›¸å…³çš„NIOå…³æ³¨çš„ä¹Ÿä¸å¤šï¼ŒçœŸçš„æ˜¯æ‰“å¼€äº†ä¸€é—ªçª—ã€‚<br>å…ˆè¯´ä¸‹FileChannel çš„ transfreTo æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å‡ºç°åœ¨çœ¼å‰å¾ˆå¤šæ¬¡ï¼Œå› ä¸ºä¹‹å‰çœ‹Kafkaä¸ºä»€ä¹ˆååé‡è¾¾çš„åŸå› çš„æ—¶å€™ï¼Œæåˆ°äº†2ç‚¹ï¼šæ‰¹å¤„ç†æ€æƒ³å’Œé›¶æ‹·è´ï¼›<br>æ‰¹å¤„ç†æ€æƒ³ï¼šå°±æ˜¯å¯¹äºKafkaå†…éƒ¨å¾ˆå¤šåœ°æ–¹æ¥è¯´ï¼Œä¸æ˜¯æ¶ˆæ¯æ¥äº†å°±å‘é€ï¼Œè€Œæ˜¯æœ‰æ”’ä¸€æ³¢å‘é€ä¸€æ¬¡ï¼Œè¿™æ ·å¯¹äºååé‡æœ‰æå¤§çš„æå‡ï¼Œå¯¹äºéœ€è¦å®æ—¶å¤„ç†çš„æƒ…å†µï¼ŒKafkaå°±ä¸æ˜¯å¾ˆé€‚åˆçš„åŸå› ï¼›<br>é›¶æ‹·è´ï¼šKafkaå¿«çš„å¦å¤–ä¸€ä¸ªåŸå› æ˜¯é›¶æ‹·è´ï¼Œé¿å…äº†å†…å­˜æ€åˆ°å†…æ ¸æ€ä»¥åŠç½‘ç»œçš„æ‹·è´ï¼Œç›´æ¥è¯»å–æ–‡ä»¶ï¼Œå‘é€åˆ°ç½‘ç»œå‡ºå»ï¼Œé›¶æ‹·è´çš„å«ä¹‰ä¸æ˜¯æ²¡æœ‰æ‹·è´ï¼Œè€Œæ˜¯æ²¡æœ‰ç”¨æˆ·æ€åˆ°æ ¸å¿ƒæ€çš„æ‹·è´ã€‚<br>è€Œåœ¨æåˆ°é›¶æ‹·è´çš„å®ç°æ—¶ï¼ŒJavaä¸­è¯´çš„å°±æ˜¯FileChannel çš„ transfreTo æ–¹æ³•ã€‚<br><br><br>ç„¶åå›ç­”ä¸‹é—®é¢˜ï¼š<br>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼š<br>Filesçš„ç›¸å…³æ–¹æ³•æ–‡æ¡£æè¿°ï¼š<br>When not using the try-with-resources construct, then directory stream&#39;s close method should be invoked after iteration is completed so as to free any resources held for the open directory.<br>æ‰€ä»¥æ˜¯éœ€è¦æ‰‹åŠ¨å…³é—­çš„ã€‚<br><br>ç¬¬äºŒä¸ªé—®é¢˜ï¼š<br>æ²¡æœ‰åŸå­æ“ä½œï¼Œå› æ­¤æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚ä¸ªäººç†è§£ï¼Œå…¶å®å³ä½¿åŠ ä¸Šäº†åŸå­æ“ä½œï¼Œä¹Ÿæ˜¯é¸¡è‚‹ï¼Œä¸å®ç”¨çš„å¾ˆï¼ŒåŸå› æ˜¯ï¼šFile ç±»å’Œ Filesçš„ç›¸å…³æ“ä½œï¼Œå…¶å®éƒ½æ˜¯è°ƒç”¨æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼Œè¿™ä¸ªæ–‡ä»¶é™¤äº†JVMæ“ä½œå¤–ï¼Œå¯èƒ½åˆ«çš„ä¹Ÿåœ¨æ“ä½œï¼Œå› æ­¤è¿˜ä¸å¦‚ä¸ä¿è¯ï¼Œå®Œå…¨åŸºäºæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿå»ä¿è¯ç›¸å…³æ“ä½œçš„æ­£ç¡®æ€§ã€‚","like_count":71,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491596,"discussion_content":"ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586751474,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":2,"child_discussions":[{"author":{"id":2881872,"avatar":"","nickname":"Geek_e0f8e6","note":"","ucode":"BC30B1694677FD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":552783,"discussion_content":"å€Ÿæ¥¼åé¦ˆä¸ªå‘, åœ¨å¼€å‘ä¸­è¯•å›¾ç”¨Files.linesæ–¹æ³•ç›´æ¥è¯»å–resourcesä¸‹jsonæ–‡ä»¶å†…å®¹, æœ¬åœ°æ²¡æ¯›ç—…, éƒ¨ç½²ä¸Šçº¿è¯»ä¸åˆ°æ–‡ä»¶, è§£å†³æ–¹æ³•: æ”¹ç”¨IOUtils.toStringè¯»InputStream \nè¿™å‘å¾ˆå‘..","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645596157,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":491596,"ip_address":""},"score":552783,"extra":""},{"author":{"id":2881872,"avatar":"","nickname":"Geek_e0f8e6","note":"","ucode":"BC30B1694677FD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":552784,"discussion_content":"https://www.renfei.net/posts/1003293 ç›¸å…³å¸–å­","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645596261,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":491596,"ip_address":""},"score":552784,"extra":""}]},{"author":{"id":1937062,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/8e/a6/c3286b61.jpg","nickname":"Javaå’å¢™å·¥ç¨‹å¸ˆ","note":"","ucode":"E76AE44A9C76AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308423,"discussion_content":"â€œæ”’ä¸€æ³¢å‘é€ä¸€æ¬¡â€å¬ç€å¥½è€³ç†Ÿï¼Œå“ˆå“ˆ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1600949104,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1027789,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ae/cd/3bffed26.jpg","nickname":"kitten","note":"","ucode":"E451DE087CB7CE","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377863,"discussion_content":"æ„Ÿè§‰å¤§ä½¬ä¹Ÿå¾ˆç‰›é€¼å“ˆã€‚æ‹œè†œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622916112,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1114878,"avatar":"https://static001.geekbang.org/account/avatar/00/11/02/fe/d539b96b.jpg","nickname":"æ›¹ç¿”","note":"","ucode":"B4D8B42DFB535C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375384,"discussion_content":"å¦™å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621600477,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1391748,"avatar":"https://static001.geekbang.org/account/avatar/00/15/3c/84/608f679b.jpg","nickname":"è¿è¾¹","note":"","ucode":"54B5DA38449728","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333541,"discussion_content":"å¦™å‘€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607560636,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":206045,"user_name":"ğŸ‘½","can_delete":false,"product_type":"c1","uid":1274117,"ip_address":"","ucode":"D313AF941B412D","user_header":"https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg","comment_is_top":false,"comment_ctime":1586779549,"is_pvip":false,"replies":[{"id":"76958","content":"ä¸é”™","user_name":"ä½œè€…å›å¤","comment_id":206045,"uid":"1001470","ip_address":"","utype":1,"ctime":1586784224,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"61716321693","product_id":100047701,"comment_content":"è¿™ç¯‡ä¸“æ å†…å®¹ä¸ç®—å¤šï¼Œä½†æ˜¯æ„Ÿè§‰å¯æ‰©å±•çš„åœ°æ–¹å¾ˆå¤šã€‚<br><br>æˆ‘è®¤ä¸ºï¼šè¯»å†™å­—ç¬¦æµä¹±ç ï¼Œå…¶å®æœ¬è´¨ä¸Šåœ¨äºç¯å¢ƒä¸ä¸€è‡´çš„é—®é¢˜ã€‚å…¶å®è·Ÿæ—¥å¿—è·¯å¾„ä¹‹ç±»çš„é—®é¢˜æ€è·¯ä¸€è‡´ã€‚æœåŠ¡å™¨ä¿å­˜æ—¥å¿—ï¼Œå¦‚æœé…ç½®ç»å¯¹è·¯å¾„ï¼ŒCç›˜ä¸‹çš„logæ–‡ä»¶å¤¹ã€‚ç­‰éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šå°±ä¼šå‡ºé”™ã€‚é™¤äº†é’ˆå¯¹ä¸åŒçš„ç¯å¢ƒä½¿ç”¨ä¸åŒçš„é…ç½®ï¼Œè¿˜å¯ä»¥å°è¯•ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œäº¦æˆ–è€…å°†è·¯å¾„ä»¥å­˜æ•°æ®åº“çš„æ–¹å¼æŒä¹…åŒ–ã€‚å…¶å®æœ¬è´¨ä¸Šï¼Œè·Ÿç¼–ç æ ¼å¼çš„å¤„ç†æ–¹å¼ä¸€æ ·ï¼Œå°½é‡å±è”½ä¸åŒç¯å¢ƒä¹‹é—´çš„å·®å¼‚ã€‚<br><br>ä¿è¯æ–‡ä»¶æµé‡Šæ”¾ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥å»¶ä¼¸ã€‚ä¸ä»…ä»…æ˜¯æ–‡ä»¶æµï¼Œä»»ä½•æ¶‰åŠèµ„æºå ç”¨é—®é¢˜çš„æ—¶å€™ï¼Œéƒ½éœ€è¦è€ƒè™‘èµ„æºæ˜¯å¦å¯ä»¥ä¿è¯è¢«é‡Šæ”¾ã€‚try-whit-resourcesæ¥è§£å†³IOæµï¼Œå…¶å®åŒæ ·ä¹Ÿåº”ç”¨äºå„ç§éœ€è¦é‡Šæ”¾èµ„æºçš„åœºæ™¯ã€‚<br><br>å…³äºç¼“å†²åŒºï¼Œä¸ªäººç†è§£ï¼Œä¸€ä¸ªå…¸å‹çš„åº”ç”¨å°±æ˜¯æ•°æ®åº“çš„åˆ†é¡µæŸ¥è¯¢ã€‚å¦‚æœå°†æ‰€æœ‰æ•°æ®ä¸€æ¬¡æŸ¥å‡ºï¼Œä¸ä½†æ¶ˆè€—èµ„æºï¼Œç”šè‡³æœ‰å¯èƒ½å†…å­˜ä¸å¤Ÿã€‚å¦‚æœä¸€æ¬¡åªæŸ¥ä¸€ä¸ªï¼Œå¦‚æœéœ€è¦æŸ¥è¯¢çš„æ˜¯å‡ åæ¡æ•°æ®ï¼Œé¢‘ç¹è¿›è¡Œæ•°æ®åº“è®¿é—®ï¼Œæ€§èƒ½ä¹Ÿè¾ƒå·®ã€‚æ‰€ä»¥ï¼Œé‡‡å–äº†æŠ˜ä¸­çš„æ–¹æ¡ˆï¼Œåˆ†é¡µæŸ¥è¯¢ï¼Œä¸€æ¬¡ä»…æŸ¥å‡ºä¸€éƒ¨åˆ†æ•°æ®ã€‚æ—¢ä¸ä¼šå†…å­˜æº¢å‡ºï¼Œä¹Ÿä¿è¯äº†å“åº”é€Ÿåº¦ã€‚","like_count":14,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491650,"discussion_content":"ä¸é”™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586784224,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":205490,"user_name":"æ¢¦å€šæ æ†","can_delete":false,"product_type":"c1","uid":1095857,"ip_address":"","ucode":"BDEB97F2822445","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/bvj76PmeUvW8kokyu91IZWuRATKmabibDWbzAj2TajeEic7WvKCJOLaOh6jibEmdQ36EO3sBUZ0HibAiapsrZo64U8w/132","comment_is_top":false,"comment_ctime":1586649499,"is_pvip":false,"replies":[{"id":"76742","content":"ä¸é”™","user_name":"ä½œè€…å›å¤","comment_id":205490,"uid":"1001470","ip_address":"","utype":1,"ctime":1586656850,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"53126257051","product_id":100047701,"comment_content":"ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šéƒ½é—´æ¥å®ç°äº†autoCloseableæ¥å£ï¼Œæ‰€ä»¥éƒ½å¯ä»¥ä½¿ç”¨try-with-resourcesè¿›è¡Œé‡Šæ”¾ã€‚<br>ç¬¬äºŒä¸ªéåŸå­æ€§ï¼Œæ²¡æœ‰é”ï¼Œä¹Ÿæ²¡æœ‰å¼‚å¸¸åçš„å›æ»šã€‚éœ€è¦è°ƒç”¨æ–¹è¿›è¡Œäº‹åŠ¡æ§åˆ¶","like_count":12,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491491,"discussion_content":"ä¸é”™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586656850,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":206731,"user_name":"Geek_3b1096","can_delete":false,"product_type":"c1","uid":1549364,"ip_address":"","ucode":"A6BD92B79B3632","user_header":"","comment_is_top":false,"comment_ctime":1586922976,"is_pvip":false,"replies":[{"id":"77212","content":"ä¸å®¢æ°”ï¼Œè§‰å¾—å¥½å¯ä»¥ç‚¹èµè½¬å‘","user_name":"ä½œè€…å›å¤","comment_id":206731,"uid":"1001470","ip_address":"","utype":1,"ctime":1586925211,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"23061759456","product_id":100047701,"comment_content":"è°¢è°¢è€å¸ˆè¯¦ç»†è§£è¯´æ–‡ä»¶æ“ä½œ","like_count":5,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491883,"discussion_content":"ä¸å®¢æ°”ï¼Œè§‰å¾—å¥½å¯ä»¥ç‚¹èµè½¬å‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586925211,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":205935,"user_name":"æ±æ—å¤–å²","can_delete":false,"product_type":"c1","uid":1188906,"ip_address":"","ucode":"3C66C0F0537A99","user_header":"https://static001.geekbang.org/account/avatar/00/12/24/2a/33441e2b.jpg","comment_is_top":false,"comment_ctime":1586760062,"is_pvip":false,"replies":[{"id":"76939","content":"ä½ å¯èƒ½ä¼šç–‘æƒ‘äº†ï¼Œæ—¢ç„¶è¿™æ ·ä½¿ç”¨ BufferedInputStream å’Œ BufferedOutputStream æœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿå…¶å®ï¼Œè¿™é‡Œæˆ‘æ˜¯ä¸ºäº†æ¼”ç¤ºæ‰€ä»¥ç¤ºä¾‹ä¸‰ä½¿ç”¨äº†å›ºå®šå¤§å°çš„ç¼“å†²åŒºï¼Œä½†åœ¨å®é™…ä»£ç ä¸­æ¯æ¬¡éœ€è¦è¯»å–çš„å­—èŠ‚æ•°å¾ˆå¯èƒ½ä¸æ˜¯å›ºå®šçš„ï¼Œæœ‰çš„æ—¶å€™è¯»å–å‡ ä¸ªå­—èŠ‚ï¼Œæœ‰çš„æ—¶å€™è¯»å–å‡ ç™¾å­—èŠ‚ï¼Œè¿™ä¸ªæ—¶å€™æœ‰ä¸€ä¸ªå›ºå®šå¤§å°è¾ƒå¤§çš„ç¼“å†²ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ BufferedInputStream å’Œ BufferedOutputStream åšä¸ºåå¤‡çš„ç¨³å®šçš„äºŒæ¬¡ç¼“å†²ï¼Œå°±éå¸¸æœ‰æ„ä¹‰äº†","user_name":"ä½œè€…å›å¤","comment_id":205935,"uid":"1001470","ip_address":"","utype":1,"ctime":1586765041,"user_name_real":"æœ±æ™”"}],"discussion_count":9,"race_medal":0,"score":"23061596542","product_id":100047701,"comment_content":"BufferedInputStreamçš„äºŒçº§ç¼“å†²ä»€ä¹ˆæ—¶å€™èƒ½ç”¨åˆ°å‘¢ï¼Ÿæ—¢ç„¶éœ€è¦è‡ªå·±å®šä¹‰ä¸€ä¸ªç¼“å†²ï¼Œæ¯”å¦‚2Kï¼Œé‚£ä¹ˆè‚¯å®šä¹Ÿæ˜¯æ§åˆ¶ä¸€æ¬¡è¯»å–2Kï¼Œåº”è¯¥ä¸ä¼šæœ‰è¯»å–è¶…è¿‡2Kçš„æ—¶å€™å§ï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491619,"discussion_content":"ä½ å¯èƒ½ä¼šç–‘æƒ‘äº†ï¼Œæ—¢ç„¶è¿™æ ·ä½¿ç”¨ BufferedInputStream å’Œ BufferedOutputStream æœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿå…¶å®ï¼Œè¿™é‡Œæˆ‘æ˜¯ä¸ºäº†æ¼”ç¤ºæ‰€ä»¥ç¤ºä¾‹ä¸‰ä½¿ç”¨äº†å›ºå®šå¤§å°çš„ç¼“å†²åŒºï¼Œä½†åœ¨å®é™…ä»£ç ä¸­æ¯æ¬¡éœ€è¦è¯»å–çš„å­—èŠ‚æ•°å¾ˆå¯èƒ½ä¸æ˜¯å›ºå®šçš„ï¼Œæœ‰çš„æ—¶å€™è¯»å–å‡ ä¸ªå­—èŠ‚ï¼Œæœ‰çš„æ—¶å€™è¯»å–å‡ ç™¾å­—èŠ‚ï¼Œè¿™ä¸ªæ—¶å€™æœ‰ä¸€ä¸ªå›ºå®šå¤§å°è¾ƒå¤§çš„ç¼“å†²ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ BufferedInputStream å’Œ BufferedOutputStream åšä¸ºåå¤‡çš„ç¨³å®šçš„äºŒæ¬¡ç¼“å†²ï¼Œå°±éå¸¸æœ‰æ„ä¹‰äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586765041,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1177931,"avatar":"https://static001.geekbang.org/account/avatar/00/11/f9/4b/5532c234.jpg","nickname":"Messi","note":"","ucode":"04302B9E7F1D75","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":300747,"discussion_content":"åå¤‡çš„ç¨³å®šçš„äºŒæ¬¡ç¼“å†²ï¼Œè¿™ç‚¹ä¸å¤ªç†è§£ï¼Œèƒ½ä¸¾ä¾‹è¯´æ˜å—ï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1598254287,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1235940,"avatar":"https://static001.geekbang.org/account/avatar/00/12/db/e4/a1b45d79.jpg","nickname":"æŸ³å¿—ç„•","note":"","ucode":"42375930DC2AA0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1177931,"avatar":"https://static001.geekbang.org/account/avatar/00/11/f9/4b/5532c234.jpg","nickname":"Messi","note":"","ucode":"04302B9E7F1D75","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368224,"discussion_content":"äºŒæ¬¡ç¼“å†²åº”è¯¥æ˜¯æŒ‡å…ˆæ”¾åˆ° BufferedOutputStream ä¸­ï¼Œç„¶åå†æ”¾åˆ°æˆ‘ä»¬è®¾ç½®çš„æ•°ç»„ä¸­ï¼Œè¯»å–å­—èŠ‚å¾ˆå¤§çš„è¯èƒ½æé«˜æ•ˆç‡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618625309,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":300747,"ip_address":""},"score":368224,"extra":""}]},{"author":{"id":1075267,"avatar":"https://static001.geekbang.org/account/avatar/00/10/68/43/1fe64086.jpg","nickname":"zero_","note":"","ucode":"14D3AD3D997112","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583688,"discussion_content":"éš¾é“æ˜¯åœ¨è¿™é‡Œï¼šbufferedInputStream.read() çš„æ“ä½œä¼šå‡ºç°è¿™ç§æƒ…å†µï¼ˆæœ‰çš„æ—¶å€™è¯»å–å‡ ä¸ªå­—èŠ‚ï¼Œæœ‰çš„æ—¶å€™è¯»å–å‡ ç™¾å­—èŠ‚ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660294593,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1075267,"avatar":"https://static001.geekbang.org/account/avatar/00/10/68/43/1fe64086.jpg","nickname":"zero_","note":"","ucode":"14D3AD3D997112","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583685,"discussion_content":"é—®é¢˜ï¼šæœ‰çš„æ—¶å€™è¯»å–å‡ ä¸ªå­—èŠ‚ï¼Œæœ‰çš„æ—¶å€™è¯»å–å‡ ç™¾å­—èŠ‚ï¼Ÿ\né‚£ä¸æ˜¯åœ¨ç¬¬ä¸€çº§ç¼“å­˜é‡ŒæŠŠè¿™ä¸ªé—®é¢˜è§„é¿äº†å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660293896,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2845535,"avatar":"","nickname":"Geek4570","note":"","ucode":"5B682A02535F6C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556393,"discussion_content":"æ˜¯ä¸æ˜¯å…ˆç¼“å­˜åˆ°å¤§ç¼“å­˜ï¼Œå°ç¼“å­˜å†ä»å¤§ç¼“å­˜è¯»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647337482,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2358947,"avatar":"https://static001.geekbang.org/account/avatar/00/23/fe/a3/414c47cc.jpg","nickname":"æ—ºä»”å°é¦’å¤´","note":"","ucode":"45BE8E943C794C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":532005,"discussion_content":"è¿™è¿˜ä¸å¦‚ç›´æ¥å†™è¿›BuffereadXXXStreamä¸­ï¼Œåœ¨ä¸­é—´è‡ªå·±æä¸€ä¸ªç¼“å†²å¤šæ­¤ä¸€ä¸¾äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637499322,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2794250,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/a3/0a/ff42fbdd.jpg","nickname":"ä¸œ","note":"","ucode":"F468CEFC0DD296","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":404332,"discussion_content":"è¿™æˆ‘ä¹Ÿæ²¡çœ‹æ‡‚ï¼ŒBufferedOutputStreamæ˜¯æœ‰ä¸¤æ¬¡ç¼“å­˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634289109,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1937062,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/8e/a6/c3286b61.jpg","nickname":"Javaå’å¢™å·¥ç¨‹å¸ˆ","note":"","ucode":"E76AE44A9C76AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308426,"discussion_content":"è¿˜æ˜¯æ²¡è§£é‡Šå•Šï¼Œæ„æ€æ˜¯å…ˆç¼“å­˜åˆ°å°ç¼“å­˜ï¼Œå°ç¼“å­˜æ”¾è¿›å¤§ç¼“å­˜ï¼Œå†è¿›è¡Œå†™å…¥æ–‡ä»¶ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600949530,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":208067,"user_name":"Michael","can_delete":false,"product_type":"c1","uid":1274787,"ip_address":"","ucode":"C233DF1D224EC1","user_header":"https://static001.geekbang.org/account/avatar/00/13/73/a3/2b077607.jpg","comment_is_top":false,"comment_ctime":1587268043,"is_pvip":true,"replies":[{"id":"77652","content":"æ„Ÿè°¢è®¤å¯","user_name":"ä½œè€…å›å¤","comment_id":208067,"uid":"1001470","ip_address":"","utype":1,"ctime":1587268964,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"14472169931","product_id":100047701,"comment_content":"ç‰¹åˆ«å–œæ¬¢è€å¸ˆçš„è¿™ç§å·¥åŒ ç²¾ç¥ï¼Œå¯¹è¯»è€…çš„æ¯ä¸€ä¸ªé—®é¢˜éƒ½ç²¾å¿ƒå›å¤","like_count":3,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492329,"discussion_content":"æ„Ÿè°¢è®¤å¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587268964,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":208007,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1587254066,"is_pvip":false,"replies":[{"id":"77640","content":"é’ˆå¯¹ä½ çš„é—®é¢˜å¯ä»¥çœ‹ä¸€ä¸‹http:&#47;&#47;www.ruanyifeng.com&#47;blog&#47;2007&#47;10&#47;ascii_unicode_and_utf-8.html å…¶ä¸­ã€UTF-8 çš„ç¼–ç è§„åˆ™å¾ˆç®€å•ï¼Œåªæœ‰äºŒæ¡ã€ä¸€èŠ‚å°±æ˜ç™½äº†<br>","user_name":"ä½œè€…å›å¤","comment_id":208007,"uid":"1001470","ip_address":"","utype":1,"ctime":1587257172,"user_name_real":"æœ±æ™”"}],"discussion_count":3,"race_medal":0,"score":"14472155954","product_id":100047701,"comment_content":"gbkä¸utf8åŒºåˆ«ï¼ˆæœ¬æ–‡æ€»ç»“æ‰€å¾—ï¼‰ï¼š<br>1ã€gbkåªé€‚åˆä¸­æ–‡ç¼–ç æ–¹å¼ï¼Œutf8å…¨ä¸–ç•Œçš„ç¼–ç æ–¹å¼<br>2ã€å¯¹äºä¸­æ–‡æ±‰å­—ï¼Œgbkä½¿ç”¨2ä¸ªå­—èŠ‚ï¼Œutf8ä½¿ç”¨3ä¸ªå­—èŠ‚ï¼›å¯¹äºè‹±æ–‡å­—æ¯éƒ½æ˜¯1ä¸ªå­—èŠ‚ã€‚è¿™ç§å˜é•¿ç¼–ç æ–¹å¼ï¼Œæ€ä¹ˆåŒºåˆ†æ±‰å­—å’Œè‹±æ–‡å‘¢ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492314,"discussion_content":"é’ˆå¯¹ä½ çš„é—®é¢˜å¯ä»¥çœ‹ä¸€ä¸‹http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html å…¶ä¸­ã€UTF-8 çš„ç¼–ç è§„åˆ™å¾ˆç®€å•ï¼Œåªæœ‰äºŒæ¡ã€ä¸€èŠ‚å°±æ˜ç™½äº†\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587257172,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1250907,"avatar":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","nickname":"Monday","note":"","ucode":"77B9BACC783598","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":239341,"discussion_content":"æ„Ÿè°¢è€å¸ˆæ¨èçš„æ·±åº¦å¥½æ–‡","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1587295017,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1542987,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/4b/fa52d222.jpg","nickname":"è¡Œåˆ™å°†è‡³","note":"","ucode":"DB972F2DF059C4","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394993,"discussion_content":"è¿™ç¯‡æ–‡ç« ï¼ŒçœŸå¿ƒä¸é”™ã€‚ä¹‹å‰å¯¹äºUTF-8å’ŒUnicodeæ²¡æœ‰æ¦‚å¿µï¼Œè¿™æ¬¡æ„Ÿè§‰å…¥é—¨äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632156299,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":205473,"user_name":"eazonshaw","can_delete":false,"product_type":"c1","uid":1493784,"ip_address":"","ucode":"423952F7CEF475","user_header":"https://static001.geekbang.org/account/avatar/00/16/cb/18/4877c08b.jpg","comment_is_top":false,"comment_ctime":1586624917,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14471526805","product_id":100047701,"comment_content":"é—®é¢˜ä¸€ï¼š<br>newDirectoryStream æ–¹æ³•è¿”å› DirectoryStreamæ–¹æ³•ï¼ŒæŸ¥çœ‹æºç ä¸­çš„æè¿°ï¼Œè¯¥æ–¹æ³•è¿”å›äº†æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰å†…å®¹çš„è¿­ä»£ï¼Œå½“åœ¨æ²¡æœ‰ä½¿ç”¨try-with-resourcesæ„é€ ä½“æ—¶ï¼Œéœ€è¦è¦åœ¨ä½¿ç”¨å®Œæ–‡ä»¶æµè¿­ä»£åè¿›è¡Œé‡Šæ”¾ã€‚<br>è€Œlistã€walk å’Œ find æ–¹æ³•ä¸­ï¼Œéƒ½æœ‰å¯¹èµ„æºè¿›è¡Œå…³é—­çš„æ“ä½œã€‚","like_count":3},{"had_liked":false,"id":205193,"user_name":"pedro","can_delete":false,"product_type":"c1","uid":1200704,"ip_address":"","ucode":"F40C839DDFD599","user_header":"https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg","comment_is_top":false,"comment_ctime":1586569041,"is_pvip":false,"replies":[{"id":"76681","content":"æ˜¯ï¼Œå…¶å®æˆ‘åœ¨æ€è€ƒé¢˜ä¸­ä¹Ÿä¼šè¡¥å……æ›´å¤šæ­£æ–‡æ— æ³•è¯¦ç»†é˜è¿°çš„å‘","user_name":"ä½œè€…å›å¤","comment_id":205193,"uid":"1001470","ip_address":"","utype":1,"ctime":1586571710,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"14471470929","product_id":100047701,"comment_content":"ç¬¬äºŒä¸ªé—®é¢˜ï¼Œä¸æ˜¯åŸå­çš„ï¼Œæ‰€ä»¥éœ€è¦æ³¨æ„ï¼Œå¦‚æœ io å¼‚å¸¸ï¼Œå¯èƒ½ä¼šå‡ºç°å¤åˆ¶åçš„æ–‡ä»¶ä¸å®Œæ•´ï¼Œæ–‡ä»¶æœªåˆ é™¤æˆåŠŸç­‰é—®é¢˜","like_count":3,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491417,"discussion_content":"æ˜¯ï¼Œå…¶å®æˆ‘åœ¨æ€è€ƒé¢˜ä¸­ä¹Ÿä¼šè¡¥å……æ›´å¤šæ­£æ–‡æ— æ³•è¯¦ç»†é˜è¿°çš„å‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586571710,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":240742,"user_name":"LiuHu","can_delete":false,"product_type":"c1","uid":1039768,"ip_address":"","ucode":"284E2025C554BB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/dd/98/883c42b4.jpg","comment_is_top":false,"comment_ctime":1597050059,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10186984651","product_id":100047701,"comment_content":"try-with-resources å®é™…ä¸Šæ˜¯ Java çš„è¯­æ³•ç³–ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™åªè¦è¿”å›å¯¹è±¡å®ç°äº† AutoCloseable æ¥å£ï¼Œå­—èŠ‚ç ä¼šè‡ªåŠ¨åŠ ä¸Šè°ƒç”¨ close æ–¹æ³•å®ç°èµ„æºè‡ªåŠ¨å…³é—­ã€‚<br>DirectoryStream&lt;Path&gt; ç»§æ‰¿äº† Closeable æ¥å£ï¼Œæ‰€ä»¥å…¶å­ç±»éœ€è¦å®ç° close æ–¹æ³•ï¼Œçœ‹äº†ä¸‹ UnixDirectoryStream.close çš„å®ç°ç¡®å®å…³é—­äº†èµ„æºï¼Œ æ‰€ä»¥æ²¡æœ‰èµ„æºé‡Šæ”¾é—®é¢˜ã€‚<br>listã€walk å’Œ find æ–¹æ³•è¿”å›çš„ Stream&lt;Path&gt; éƒ½ä¼šé€šè¿‡è°ƒç”¨çˆ¶ç±»çš„ onClose æ–¹æ³•ï¼Œæ³¨å†Œ close å®ç°åˆ° BaseStreamä¸­å®ç°èµ„æºå…³é—­ï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰èµ„æºé‡Šæ”¾é—®é¢˜ã€‚","like_count":2},{"had_liked":false,"id":237399,"user_name":"ç…ç…å›","can_delete":false,"product_type":"c1","uid":1069646,"ip_address":"","ucode":"3700048634C565","user_header":"https://static001.geekbang.org/account/avatar/00/10/52/4e/5150a2ee.jpg","comment_is_top":false,"comment_ctime":1595819722,"is_pvip":false,"replies":[{"id":"87691","content":"å…ˆAåBï¼ˆå¯èƒ½å¤šæ¬¡ï¼‰","user_name":"ä½œè€…å›å¤","comment_id":237399,"uid":"1001470","ip_address":"","utype":1,"ctime":1595826195,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"10185754314","product_id":100047701,"comment_content":"ä½ å¥½ï¼Œå…³äºBufferedInputStreamæœ‰ä¸€ç‚¹ç–‘é—®ï¼Œå¦‚æœæˆ‘æ„é€ BufferedInputStreamçš„æ—¶å€™è®¾ç½®ç¼“å†²æµçš„å¤§å°æ˜¯1kbï¼Œè¿™é‡Œç¼“å†²åŒºå«Aï¼Œä½†æ˜¯è°ƒç”¨read(byte[])çš„æ—¶å€™é¢å¤–ç”¨çš„æ˜¯8kbç¼“å†²ï¼Œè¿™é‡Œç¼“å†²åŒºå«Bï¼Œé‚£ä¹ˆè¯»å–æ–‡ä»¶çš„æ—¶å€™ï¼Œè¿™ä¸¤ç§ç¼“å†²çš„å¤§å°çš„å·¥ä½œæµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ã€‚å…ˆBåAè¿˜æ˜¯ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":502404,"discussion_content":"å…ˆAåBï¼ˆå¯èƒ½å¤šæ¬¡ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595826195,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":205187,"user_name":"pedro","can_delete":false,"product_type":"c1","uid":1200704,"ip_address":"","ucode":"F40C839DDFD599","user_header":"https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg","comment_is_top":false,"comment_ctime":1586568585,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10176503177","product_id":100047701,"comment_content":"ç¬¬ä¸€ä¸ªé—®é¢˜ï¼ŒDirectoryStream æ¥å£ç»§æ‰¿äº† Closeable æ¥å£ï¼Œè€Œ Closeable æ¥å£ç»§æ‰¿äº† AutoCloseable æ¥å£ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ try-with-resources è¿›è¡Œèµ„æºé‡Šæ”¾ã€‚è€Œ listï¼Œwalkï¼Œfind éƒ½æ˜¯è¿”å› Streamï¼Œä¹Ÿéƒ½ç»§æ‰¿äº† AutoCloseable æ¥å£ï¼Œå¹¶ä¸”å¯ä»¥ä¸»åŠ¨è°ƒç”¨ close æ–¹æ³•è¿›è¡Œèµ„æºé‡Šæ”¾ã€‚","like_count":2},{"had_liked":false,"id":237406,"user_name":"James","can_delete":false,"product_type":"c1","uid":1134861,"ip_address":"","ucode":"48B0F2A334D1C1","user_header":"https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg","comment_is_top":false,"comment_ctime":1595820826,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5890788122","product_id":100047701,"comment_content":"åŒç¼“å†²çš„é‚£ä¸ªè¿˜ä¸æ˜¯å¾ˆç†è§£ã€‚<br>æ˜¯ä¸æ˜¯å°±æ˜¯æœ‰ä¸ªæ›´å¤§çš„ç¼“å†²åŒº 16kæ˜¯å§ã€‚","like_count":1},{"had_liked":false,"id":223652,"user_name":"Carisy","can_delete":false,"product_type":"c1","uid":1657429,"ip_address":"","ucode":"67E887967347BA","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLwTZdUafC5YM7bCASt8icUnoyYfV4hUHulexibDI7B4eaokTxYXHFtoic97DBlCAU9j5Jw4QUuGhyZQ/132","comment_is_top":false,"comment_ctime":1591148786,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5886116082","product_id":100047701,"comment_content":"ä¹‹å‰è¯»tomcatä¸æ˜¯å¾ˆç†è§£ä¸ºå•¥ç”¨äº†ä¸¤ä¸ªchunkbufferï¼Œç°åœ¨è±ç„¶å¼€æœ—ï¼","like_count":1,"discussions":[{"author":{"id":2052476,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Qq6oLfOTgKzjiculoUDicdv7WoY1iabPfOTumibWeInVP2Mnod9XVPrNSClvIiaLbvtDlIjRnWUNaXcYwREGzlcaDog/132","nickname":"Geek_åœ¨ä¸‹èŸ‘è‚ç‹","note":"","ucode":"E1F5BBB5BC5962","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":324859,"discussion_content":"å‘œå‘œå‘œã€‚ã€‚ã€‚æˆ‘è¿˜æ˜¯ä¸æ‡‚ã€‚jdkçš„bufferä¸æ˜¯å·²ç»é™å®šæ­»äº†å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605182077,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":205319,"user_name":"Demon.Lee","can_delete":false,"product_type":"c1","uid":1052859,"ip_address":"","ucode":"7F0E5493A8E345","user_header":"https://static001.geekbang.org/account/avatar/00/10/10/bb/f1061601.jpg","comment_is_top":false,"comment_ctime":1586591888,"is_pvip":false,"replies":[{"id":"76715","content":"ç›´æ¥æ”¾åˆ°catché‡Œæ˜¯å¯ä»¥çš„ï¼Œè¿™é‡Œæˆ‘å› ä¸ºä¿®æ”¹äº†wrongæ‰€ä»¥å†™æˆè¿™æ ·äº†ã€‚å¯¹äºé‡Šæ”¾èµ„æºäº§ç”Ÿçš„å¼‚å¸¸ï¼ŒåŒæ ·å¯ä»¥åœ¨catchä¸­æ•è·ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹try-with-resourcesè¯­æ³•ç³–ä¼šç¿»è¯‘æˆæ€ä¹ˆæ ·çš„ä»£ç å°±ç†è§£äº†ã€‚","user_name":"ä½œè€…å›å¤","comment_id":205319,"uid":"1001470","ip_address":"","utype":1,"ctime":1586604613,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":1,"score":"5881559184","product_id":100047701,"comment_content":"<br>LongAdder longAdder = new LongAdder();<br>IntStream.rangeClosed(1, 1000000).forEach(i -&gt; {<br>    try {<br>        try (Stream&lt;String&gt; lines = Files.lines(Paths.get(&quot;demo.txt&quot;))) {<br>            lines.forEach(line -&gt; longAdder.increment());<br>        }<br>    } catch (IOException e) {<br>        e.printStackTrace();<br>    }<br>});<br>log.info(&quot;total : {}&quot;, longAdder.longValue());<br><br>------------------------------------------------------<br>æˆ‘ä¸€å¼€å§‹è¿˜å¥‡æ€ªä¸ºå•¥è¦ä¸¤ä¸ªtryï¼Œcatchæ”¾é‡Œé¢ä¸å°±è¡Œäº†ä¹ˆï¼Œæƒ³äº†ä¸€ä¸‹æ‰æ˜ç™½ï¼Œæ˜¯ä¸ºäº†æ•è·é‡Œé¢é‡Šæ”¾èµ„æºçš„å¼‚å¸¸ï¼Œç›¸å½“äºæ•è·finallyä¸­çš„å¼‚å¸¸ã€‚<br><br>ä¸¤é“é¢˜éƒ½å»ç¿»äº†æºç ï¼Œç¬¬ä¸€é¢˜æˆ‘è§‰å¾—ä¹Ÿæ˜¯éœ€è¦ä¸»åŠ¨é‡Šæ”¾ï¼ŒPathä¹Ÿç®—ä¸€ç§fdå§ï¼Œä¸å¤ªç¡®å®šï¼›ç¬¬äºŒé¢˜æ²¡æœ‰çœ‹åˆ°é”ä»€ä¹ˆçš„ï¼Œä¸æ˜¯åŸå­æ€§çš„ï¼Œä¸è¿‡åˆ›å»ºæˆ–åˆ é™¤æ–‡ä»¶ï¼Œé‡å¤å¤„ç†ï¼Œæ“ä½œç³»ç»Ÿå±‚ä¼šæŠ¥é”™ï¼Œä½†å†™å†…å®¹åˆ°æ–‡ä»¶ä¸­å°±éœ€è¦æ³¨æ„äº†ã€‚","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491447,"discussion_content":"ç›´æ¥æ”¾åˆ°catché‡Œæ˜¯å¯ä»¥çš„ï¼Œè¿™é‡Œæˆ‘å› ä¸ºä¿®æ”¹äº†wrongæ‰€ä»¥å†™æˆè¿™æ ·äº†ã€‚å¯¹äºé‡Šæ”¾èµ„æºäº§ç”Ÿçš„å¼‚å¸¸ï¼ŒåŒæ ·å¯ä»¥åœ¨catchä¸­æ•è·ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹try-with-resourcesè¯­æ³•ç³–ä¼šç¿»è¯‘æˆæ€ä¹ˆæ ·çš„ä»£ç å°±ç†è§£äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586604613,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":205185,"user_name":"å°æ°˜","can_delete":false,"product_type":"c1","uid":1622109,"ip_address":"","ucode":"DA55B9A02D9EE0","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erPMtAfnQdpx1yOZQ2ic7icqUs3tvibEjUXQMUXKiaakyuIho6k6vmdl46nrdWjXIjPIRg9Pmco00tR5w/132","comment_is_top":false,"comment_ctime":1586568536,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5881535832","product_id":100047701,"comment_content":"è€å¸ˆä½ å¥½ï¼Œè¯·é—®javaä¸­å“ªäº›èµ„æºæ˜¯éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨é‡Šæ”¾çš„ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1274117,"avatar":"https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg","nickname":"ğŸ‘½","note":"","ucode":"D313AF941B412D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":230900,"discussion_content":"å ç”¨æœ‰é™èµ„æºçš„åœºæ™¯ã€‚\n1ï¼Œæµï¼Œ2ï¼Œæ–‡ä»¶å†™å…¥å ç”¨ï¼Œ3ï¼Œé“¾æ¥ ç­‰ã€‚\nå…³äºèµ„æºå ç”¨ï¼ŒåŸç†å¯ä»¥å‚è€ƒæ“ä½œç³»ç»ŸåŸç†ã€‚\n\nä¸€ä¸ªå¾ˆç®€å•çš„ä¾‹å­å°±æ˜¯æ‰“å°æœºï¼Œæœºå™¨Aå æœ‰äº†æ‰“å°æœºå¹¶å¼€å§‹æ‰“å°ï¼Œä½†æ˜¯æ‰“å°è¿‡ç¨‹ä¸­Aç”µè„‘æ­»æœºäº†ï¼Œè€Œæ‰“å°æœºåˆæ˜¯ä¸€ç›´è¢«å ç”¨çŠ¶æ€ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586779764,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1622109,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erPMtAfnQdpx1yOZQ2ic7icqUs3tvibEjUXQMUXKiaakyuIho6k6vmdl46nrdWjXIjPIRg9Pmco00tR5w/132","nickname":"å°æ°˜","note":"","ucode":"DA55B9A02D9EE0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1274117,"avatar":"https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg","nickname":"ğŸ‘½","note":"","ucode":"D313AF941B412D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":231899,"discussion_content":"è°¢è°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586836966,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":230900,"ip_address":""},"score":231899,"extra":""}]}]},{"had_liked":false,"id":205172,"user_name":"kyl","can_delete":false,"product_type":"c1","uid":1406090,"ip_address":"","ucode":"DBDFD0FEB5A135","user_header":"https://static001.geekbang.org/account/avatar/00/15/74/8a/d5b0cf30.jpg","comment_is_top":false,"comment_ctime":1586564275,"is_pvip":false,"replies":[{"id":"76673","content":"æ–‡ä»¶è§£ææ˜¯æŒ‡ï¼Ÿ","user_name":"ä½œè€…å›å¤","comment_id":205172,"uid":"1001470","ip_address":"","utype":1,"ctime":1586565147,"user_name_real":"æœ±æ™”"}],"discussion_count":8,"race_medal":0,"score":"5881531571","product_id":100047701,"comment_content":"åˆå­¦åˆ°äº†ï¼Œå¾ˆæ£’ï¼Œæœ±è€å¸ˆèƒ½ä¸èƒ½è®²è®²æ–‡ä»¶è§£æçš„å‘å‘¢","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491412,"discussion_content":"æ–‡ä»¶è§£ææ˜¯æŒ‡ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586565147,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":229536,"discussion_content":"å¯¼å…¥æ˜¯æŒ‡ç”¨load dataä¹‹ç±»å¯¼å…¥ï¼Œé¿å…åå¤çš„å®¢æˆ·ç«¯æœåŠ¡ç«¯äº¤äº’","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586662800,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":229535,"discussion_content":"çœ‹ä½ éœ€è¦æ”¹å–„å“ªå—äº†ï¼Œæ”¹å–„å…¥åº“æ…¢è¿˜æ˜¯ä»€ä¹ˆï¼Œè¿™ä¸ªæ“ä½œå¯ä»¥å¼‚æ­¥åŒ–æ…¢æ…¢åœ¨åå°å¤„ç†å®Œæˆåå†å‘é€šçŸ¥ã€‚å¦‚æœè¦æ”¹å–„æ…¢çš„é—®é¢˜é‚£ä¹ˆåˆ†æä¸€ä¸‹æ˜¯å“ªé‡Œæ…¢ï¼Œè§£ææ…¢å¯ä»¥å¤šçº¿ç¨‹ç”šè‡³åˆ†å¸ƒåˆ°å¤šæœºå™¨è§£æï¼Œå…¥åº“æ…¢å—é™äºæ•°æ®åº“ç“¶é¢ˆé™¤éåˆ†åº“å¦åˆ™ä¹Ÿä¸å¤ªå¥½è§£å†³ï¼Œä¸è¿‡è¿˜æ˜¯å¯ä»¥ä¼˜åŒ–çš„ï¼Œæ¯”å¦‚é‡‡ç”¨æ‰¹é‡çš„insertæˆ–è€…ç›´æ¥æŠŠæ–‡ä»¶ä¼ åˆ°æœåŠ¡å™¨ä¸Šè®©mysqlå¯¼å…¥","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586662708,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1406090,"avatar":"https://static001.geekbang.org/account/avatar/00/15/74/8a/d5b0cf30.jpg","nickname":"kyl","note":"","ucode":"DBDFD0FEB5A135","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":230033,"discussion_content":"æ˜¯å…¥åº“æ…¢ï¼Œè°¢è°¢è€å¸ˆï¼","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586703898,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":229535,"ip_address":""},"score":230033,"extra":""},{"author":{"id":1254968,"avatar":"https://static001.geekbang.org/account/avatar/00/13/26/38/ef063dc2.jpg","nickname":"Darren","note":"","ucode":"CCD2B2C492BE9A","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1406090,"avatar":"https://static001.geekbang.org/account/avatar/00/15/74/8a/d5b0cf30.jpg","nickname":"kyl","note":"","ucode":"DBDFD0FEB5A135","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":230614,"discussion_content":"ä¹‹å‰åšè¿‡ç±»ä¼¼çš„äº‹æƒ…ï¼Œåœ¨æ•°æ®åº“IOèµ„æºæœªæ»¡çš„æƒ…å†µä¸‹ï¼Œå°½å¯èƒ½çš„å¤šçº¿ç¨‹ç”šè‡³å¤šæœåŠ¡å…¥åº“ï¼Œå¹¶ä¸”ä¸€å®šè¦æ‰¹é‡å…¥åº“ï¼›åŒæ—¶è‹¥æ˜¯æœªåˆ†åº“ï¼Œä¸”è¯¥è¡¨æ˜¯çƒ­ç‚¹è¡¨çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨åˆ†è¡¨æˆ–è€…è¡¨åˆ†åŒºé¿å…é”ç«äº‰ï¼Œæé«˜å…¥åº“é€Ÿåº¦ã€‚\nä¹‹å‰æˆ‘çš„åœºæ™¯æ˜¯åˆ†åº“ï¼Œæ ¹æ®idè·å–å¯¹åº”çš„åº“ï¼Œç„¶åè¿›å…¥å¯¹åº”çš„å†…å­˜é˜Ÿåˆ—ï¼ˆé˜Ÿåˆ—å·²æ»¡ï¼Œå†™æ–‡ä»¶ç³»ç»Ÿï¼Œä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼‰ï¼Œç„¶åæ¯ä¸ªå†…å­˜é˜Ÿåˆ—ä¸‹é¢æŒ‚ä¸€ä¸ªçº¿ç¨‹æ± å»å¤šçº¿ç¨‹å…¥åº“ï¼Œä¸ºä»€ä¹ˆè¦æ¯ä¸ªåº“å¯¹åº”ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œæ˜¯å› ä¸ºæœ‰å¯èƒ½æŸä¸€ä¸ªåº“å‡ºäº†é—®é¢˜ï¼Œå¯¼è‡´å…¥åº“å¾ˆæ…¢ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œåªä¼šå½±å“è¯¥åº“ï¼Œä¸ä¼šå½±å“æ•´ä½“ã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1586756874,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":230033,"ip_address":""},"score":230614,"extra":""}]},{"author":{"id":1406090,"avatar":"https://static001.geekbang.org/account/avatar/00/15/74/8a/d5b0cf30.jpg","nickname":"kyl","note":"","ucode":"DBDFD0FEB5A135","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":229340,"discussion_content":"æ„Ÿè°¢æœ±è€å¸ˆå›å¤ï¼Œè¯´ä¸ªå®é™…çš„é—®é¢˜å“ˆï¼Œæˆ‘ä»¬ç”Ÿäº§æœ‰500w+æ•°æ®é‡çš„excelæ–‡ä»¶è¦å¯¼å…¥åˆ°æ•°æ®åº“ï¼Œä½†æ˜¯è§£æå…¥åº“å®Œæˆéœ€è¦äºŒä¸‰ååˆ†é’Ÿç”šè‡³æ›´ä¹…ï¼Œè¯·é—®ç±»ä¼¼é—®é¢˜å¦‚ä½•è§£å†³å‘¢ï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586620289,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1139413,"avatar":"https://static001.geekbang.org/account/avatar/00/11/62/d5/1f5c5ab6.jpg","nickname":"å¤§å¤§å¤§ç†Šmyeh","note":"","ucode":"4832C2E7CEB151","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1406090,"avatar":"https://static001.geekbang.org/account/avatar/00/15/74/8a/d5b0cf30.jpg","nickname":"kyl","note":"","ucode":"DBDFD0FEB5A135","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":229347,"discussion_content":"æ˜¯è¯´è§£ææ–‡ä»¶æ—¶é—´ä¹…ï¼Ÿå¯ä»¥è§£æå®Œæˆåå‘æ¶ˆæ¯é€šçŸ¥ç”¨æˆ·ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586620493,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":229340,"ip_address":""},"score":229347,"extra":""},{"author":{"id":1406090,"avatar":"https://static001.geekbang.org/account/avatar/00/15/74/8a/d5b0cf30.jpg","nickname":"kyl","note":"","ucode":"DBDFD0FEB5A135","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1139413,"avatar":"https://static001.geekbang.org/account/avatar/00/11/62/d5/1f5c5ab6.jpg","nickname":"å¤§å¤§å¤§ç†Šmyeh","note":"","ucode":"4832C2E7CEB151","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":230039,"discussion_content":"æ˜¯çš„ï¼Œå…¥åº“ioé¢‘ç¹ï¼Œç°åœ¨æ˜¯å¼‚æ­¥å¤„ç†çš„ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586704024,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":229347,"ip_address":""},"score":230039,"extra":""}]}]},{"had_liked":false,"id":357741,"user_name":"èŠ’æœå°‘ä¾ ","can_delete":false,"product_type":"c1","uid":1350159,"ip_address":"å¹¿ä¸œ","ucode":"98D0BBB52BB80F","user_header":"https://static001.geekbang.org/account/avatar/00/14/9a/0f/da7ed75a.jpg","comment_is_top":false,"comment_ctime":1663592777,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1663592777","product_id":100047701,"comment_content":"æ‰“å¡å­¦ä¹ è®°å½•ï¼Œä»Šå¤©æåˆ°çš„ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œç»å¸¸æœ‰åŒäº‹è¸©åˆ°ã€‚","like_count":0},{"had_liked":false,"id":336504,"user_name":"ç§ƒå¦‚å…¶æ¥","can_delete":false,"product_type":"c1","uid":2357964,"ip_address":"","ucode":"9130CE773F31B3","user_header":"https://static001.geekbang.org/account/avatar/00/23/fa/cc/d4b3ce87.jpg","comment_is_top":false,"comment_ctime":1646191850,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646191850","product_id":100047701,"comment_content":"AtomicLong atomicLong = new AtomicLong()ï¼›<br>Files.lines(Paths.get(&quot;test.txt&quot;)).forEach(line-&gt;atomicLong.incrementAndGet());<br>long count = atomicLong.get()<br>å¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç æ›¿ä»£ä¹ˆï¼Ÿ<br>long count = Files.lines(Paths.get(&quot;test.txt&quot;)).count();","like_count":0},{"had_liked":false,"id":295268,"user_name":"æ™¨æ›¦","can_delete":false,"product_type":"c1","uid":2444694,"ip_address":"","ucode":"94993724767BB8","user_header":"https://static001.geekbang.org/account/avatar/00/25/4d/96/c1835e16.jpg","comment_is_top":false,"comment_ctime":1622339991,"is_pvip":false,"replies":[{"id":"107234","content":"ä¼š ä½†æœ‰å»¶è¿Ÿ","user_name":"ä½œè€…å›å¤","comment_id":295268,"uid":"1001470","ip_address":"","utype":1,"ctime":1622437451,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":1,"score":"1622339991","product_id":100047701,"comment_content":"æ²¡æœ‰é‡Šæ”¾è¿æ¥å¥ç‚³çš„å¯¹è±¡ï¼Œä¸æ˜¯åº”è¯¥ä¼šè¢«åƒåœ¾å›æ”¶å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521017,"discussion_content":"ä¼š ä½†æœ‰å»¶è¿Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622437451,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":278129,"user_name":"ä¸œè°·å¤§è è","can_delete":false,"product_type":"c1","uid":2007690,"ip_address":"","ucode":"057FF5437438D8","user_header":"https://static001.geekbang.org/account/avatar/00/1e/a2/8a/31fcaf13.jpg","comment_is_top":false,"comment_ctime":1612772371,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612772371","product_id":100047701,"comment_content":"è€å¸ˆï¼Œå…³äºtry-with-resourcesï¼Œæˆ‘ä¸€ç›´è§‰å¾—å¾ˆé¸¡è‚‹...æœ‰ä¸€ç§æƒ…å†µä¸€ç›´ä¸çŸ¥é“æ€ä¹ˆå¤„ç†ï¼š<br>    public static &lt;T&gt; List&lt;T&gt; deepCopy(List&lt;T&gt; src) throws IOException, ClassNotFoundException {<br><br>        ByteArrayOutputStream byteOut = new ByteArrayOutputStream();<br>        ObjectOutputStream out = new ObjectOutputStream(byteOut);<br>        out.writeObject(src);<br><br>        ByteArrayInputStream byteIn = new ByteArrayInputStream(byteOut.toByteArray());<br>        ObjectInputStream in = new ObjectInputStream(byteIn);<br>        @SuppressWarnings(&quot;unchecked&quot;)<br>        List&lt;T&gt; dest = (List&lt;T&gt;) in.readObject();<br>        return dest;<br>    }<br><br>å¯¹äºè¿™æ®µä»£ç ï¼Œæˆ‘ä¼¼ä¹æ— æ³•æŠŠstreamçš„å£°æ˜æåˆ°try()é‡Œï¼Œå› ä¸ºä¸­é—´æœ‰æ“ä½œï¼Œè€Œåé¢çš„streamä¾èµ–ä¸­é—´é‚£æ­¥æ“ä½œã€‚","like_count":0},{"had_liked":false,"id":212528,"user_name":"will","can_delete":false,"product_type":"c1","uid":1785448,"ip_address":"","ucode":"6843B14B09192F","user_header":"https://static001.geekbang.org/account/avatar/00/1b/3e/68/c2b2a285.jpg","comment_is_top":false,"comment_ctime":1588142033,"is_pvip":false,"replies":[{"id":"78951","content":"è¿™ä¸ªé—®é¢˜å¤ªå®½æ³›äº†ã€‚ã€‚ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1588145444,"ip_address":"","comment_id":212528,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1588142033","product_id":100047701,"comment_content":"è€å¸ˆï¼Œå’¨è¯¢ä¸‹ï¼Œä¸€èˆ¬è¯»å–è¿œç¨‹æ–‡ä»¶ï¼Œéœ€è¦æ³¨æ„ä»€ä¹ˆï½ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493538,"discussion_content":"è¿™ä¸ªé—®é¢˜å¤ªå®½æ³›äº†ã€‚ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588145444,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1624872,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJBAeQHMGZXiccGuNllib5TpeMTv2xHia6MlvltJ5BQSBc1u6NpvricUo9dGYtrCLe3pZfSFIZky4mkFg/132","nickname":"lnuwhy","note":"","ucode":"A901D0917DE445","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":547322,"discussion_content":"å¦‚æœä½¿ç”¨sftpè¯»ä¸€ä¸ªè¿œç¨‹æ–‡ä»¶ï¼Œè¦ä¸‹è½½ä¸‹æ¥æ‰èƒ½ç”¨Files.linesè¿™ç§æ–¹æ³•å—  ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642610457,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":493538,"ip_address":""},"score":547322,"extra":""}]}]}]}