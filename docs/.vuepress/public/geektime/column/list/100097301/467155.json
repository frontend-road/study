{"id":467155,"title":"13 | å¤–éƒ¨å‡½æ•°æ¥å£ï¼Œèƒ½ä¸èƒ½å–ä»£Javaæœ¬åœ°æ¥å£ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯èŒƒå­¦é›·ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥è®¨è®ºJavaçš„å¤–éƒ¨å‡½æ•°æ¥å£ã€‚</p><p>Javaçš„å¤–éƒ¨å‡½æ•°æ¥å£è¿™ä¸ªæ–°ç‰¹æ€§ï¼Œæˆ‘å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œè¿˜åœ¨å­µåŒ–æœŸï¼Œè¿˜æ²¡æœ‰å‘å¸ƒé¢„è§ˆç‰ˆã€‚ç”±äºå­µåŒ–æœŸçš„ç‰¹æ€§è¿˜ä¸æˆç†Ÿï¼Œä¸åŒçš„ç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚å¯èƒ½ä¼šå¾ˆå¤§ã€‚æˆ‘å»ºè®®ä½ ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ï¼Œç°åœ¨æ¥è¯´å°±æ˜¯JDK 17æ¥ä½“éªŒå­µåŒ–æœŸçš„ç‰¹æ€§ã€‚</p><p>Javaçš„å¤–éƒ¨å‡½æ•°æ¥å£è¿™ä¸ªç‰¹æ€§ï¼Œæœ‰å¯èƒ½ä¼šæ˜¯Javaè‡ªè¯ç”Ÿä»¥æ¥æœ€é‡è¦çš„ä¸¤ä¸ªç‰¹æ€§ä¹‹ä¸€ï¼Œå®ƒå’Œå¤–éƒ¨å†…å­˜æ¥å£ä¸€èµ·ï¼Œä¼šæå¤§åœ°ä¸°å¯ŒJavaè¯­è¨€çš„ç”Ÿæ€ç¯å¢ƒã€‚æå‰äº†è§£ä¸€ä¸‹è¿™æ ·çš„æ–°ç‰¹æ€§ï¼Œæœ‰åŠ©äºæˆ‘ä»¬æ€è€ƒç°åœ¨çš„æŠ€æœ¯æ‰‹æ®µå’Œæœªæ¥çš„æŠ€æœ¯è§„åˆ’ã€‚</p><p>æˆ‘ä»¬ä»é˜…è¯»æ¡ˆä¾‹å¼€å§‹ï¼Œæ¥çœ‹ä¸€çœ‹Javaçš„å¤–éƒ¨å‡½æ•°æ¥å£ä¸ºä»€ä¹ˆå¯èƒ½ä¼šå¸¦æ¥è¿™ä¹ˆå¤§çš„å½±å“ï¼Œä»¥åŠå®ƒèƒ½å¤Ÿç»™æˆ‘ä»¬çš„ä»£ç å¸¦æ¥ä»€ä¹ˆæ ·çš„å˜åŒ–å§ã€‚</p><h2>é˜…è¯»æ¡ˆä¾‹</h2><p>æˆ‘ä»¬çŸ¥é“ï¼ŒåƒJavaæˆ–è€…Goè¿™æ ·çš„é€šç”¨ç¼–ç¨‹è¯­è¨€ï¼Œéƒ½éœ€è¦å’Œå…¶ä»–çš„ç¼–ç¨‹è¯­è¨€æˆ–è€…ç¯å¢ƒæ‰“äº¤é“ï¼Œæ¯”å¦‚æ“ä½œç³»ç»Ÿæˆ–è€…Cè¯­è¨€ã€‚Javaæ˜¯é€šè¿‡Javaæœ¬åœ°æ¥å£ï¼ˆJava Native Interface, JNIï¼‰æ¥æ”¯æŒè¿™æ ·çš„åšæ³•çš„ã€‚ æœ¬åœ°æ¥å£ï¼Œæ‹“å±•äº†ä¸€é—¨ç¼–ç¨‹è¯­è¨€çš„ç”Ÿå­˜ç©ºé—´å’Œé€‚ç”¨èŒƒå›´ã€‚æœ‰äº†æœ¬åœ°æ¥å£ï¼Œå°±ä¸ç”¨æ‰€æœ‰çš„äº‹æƒ…éƒ½åœ¨è¿™é—¨ç¼–ç¨‹è¯­è¨€å†…éƒ¨å®ç°äº†ã€‚</p><p>æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼Œå°±æ˜¯ä¸€ä¸ªä½¿ç”¨Javaæœ¬åœ°æ¥å£å®ç°çš„â€œHello, world!\"çš„å°ä¾‹å­ã€‚å…¶ä¸­çš„sayHelloè¿™ä¸ªæ–¹æ³•ï¼Œä½¿ç”¨äº†ä¿®é¥°ç¬¦nativeï¼Œè¿™è¡¨æ˜å®ƒæ˜¯ä¸€ä¸ªæœ¬åœ°çš„æ–¹æ³•ã€‚</p><!-- [[[read_end]]] --><pre><code class=\"language-java\">public class HelloWorld {\n    static {\n        System.loadLibrary(\"helloWorld\");\n    }\n\n    public static void main(String[] args) {\n        new HelloWorld().sayHello();\n    }\n\n    private native void sayHello();\n}\n</code></pre><p>è¿™ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨Cè¯­è¨€æ¥å®ç°ã€‚ç„¶åå‘¢ï¼Œæˆ‘ä»¬éœ€è¦ç”Ÿæˆè¿™ä¸ªæœ¬åœ°æ–¹æ³•å¯¹åº”çš„Cè¯­è¨€çš„å¤´æ–‡ä»¶ã€‚</p><pre><code class=\"language-bash\">$ javac -h . HelloWorld.java\n</code></pre><p>æœ‰äº†è¿™ä¸ªè‡ªåŠ¨ç”Ÿæˆçš„å¤´æ–‡ä»¶ï¼Œæˆ‘ä»¬å°±çŸ¥é“äº†Cè¯­è¨€é‡Œè¿™ä¸ªæ–¹æ³•çš„å®šä¹‰ã€‚ç„¶åï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿä½¿ç”¨Cè¯­è¨€æ¥å®ç°è¿™ä¸ªæ–¹æ³•äº†ã€‚</p><pre><code class=\"language-c++\">#include \"jni.h\"\n#include \"HelloWorld.h\"\n#include &lt;stdio.h&gt;\n\nJNIEXPORT void JNICALL Java_HelloWorld_sayHello(JNIEnv *env, jobject jObj) {\n&nbsp; &nbsp; printf(\"Hello World!\\n\");\n}\n</code></pre><p>ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬è¦æŠŠCè¯­è¨€çš„å®ç°ç¼–è¯‘ã€é“¾æ¥æ”¾åˆ°å®ƒçš„åŠ¨æ€åº“é‡Œã€‚è¿™æ—¶å€™ï¼Œå°±è¦ä½¿ç”¨Cè¯­è¨€çš„ç¼–è¯‘å™¨äº†ã€‚</p><pre><code class=\"language-bash\">$ gcc -I$(JAVA_HOME)/include -I$(JAVA_HOME)/include/darwin \\\n      -dynamiclib HelloWorld.c -o libhelloWorld.dylib\n</code></pre><p>å®Œæˆäº†è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿è¡Œè¿™ä¸ªHello Worldçš„æœ¬åœ°å®ç°äº†ã€‚</p><pre><code class=\"language-bash\">java -cp . -Djava.library.path=. HelloWorld\n</code></pre><p>ä½ çœ‹ï¼Œä¸€ä¸ªç®€å•çš„â€œHello, world!\"çš„æœ¬åœ°æ¥å£å®ç°ï¼Œéœ€è¦ç»å†ä¸‹é¢è¿™äº›æ­¥éª¤ï¼š</p><ol>\n<li>ç¼–å†™Javaè¯­è¨€çš„ä»£ç ï¼ˆHelloWorld.javaï¼‰ï¼›</li>\n<li>ç¼–è¯‘Javaè¯­è¨€çš„ä»£ç ï¼ˆHelloWorld.classï¼‰ï¼›</li>\n<li>ç”ŸæˆCè¯­è¨€çš„å¤´æ–‡ä»¶ï¼ˆHelloWorld.hï¼‰ï¼›</li>\n<li>ç¼–å†™Cè¯­è¨€çš„ä»£ç ï¼ˆHelloWorld.cï¼‰;</li>\n<li>ç¼–è¯‘ã€é“¾æ¥Cè¯­è¨€çš„å®ç°ï¼ˆlibhelloWorld.dylibï¼‰ï¼›</li>\n<li>è¿è¡ŒJavaå‘½ä»¤ï¼Œè·å¾—ç»“æœã€‚</li>\n</ol><p>å…¶å®ï¼Œåœ¨Javaæœ¬åœ°æ¥å£çš„è¯¸å¤šé—®é¢˜ä¸­ï¼Œåƒä»£ç å®ç°çš„è¿‡ç¨‹ä¸ç®€æ´è¿™æ ·çš„é—®é¢˜ï¼Œè¿˜å±äºå¯ä»¥å…‹æœçš„å°é—®é¢˜ã€‚</p><p>Javaæœ¬åœ°æ¥å£é¢ä¸´çš„æ¯”è¾ƒå¤§çš„é—®é¢˜æœ‰ä¸¤ä¸ªã€‚</p><p>ä¸€ä¸ªæ˜¯Cè¯­è¨€ç¼–è¯‘ã€é“¾æ¥å¸¦æ¥çš„é—®é¢˜ï¼Œå› ä¸ºJavaæœ¬åœ°æ¥å£å®ç°çš„åŠ¨æ€åº“æ˜¯å¹³å°ç›¸å…³çš„ï¼Œæ‰€ä»¥å°±æ²¡æœ‰äº†Javaè¯­è¨€â€œä¸€æ¬¡ç¼–è¯‘ï¼Œåˆ°å¤„è¿è¡Œâ€çš„è·¨å¹³å°ä¼˜åŠ¿ï¼›å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå› ä¸ºé€ƒè„±äº†JVMçš„è¯­è¨€å®‰å…¨æœºåˆ¶ï¼ŒJNIæœ¬è´¨ä¸Šæ˜¯ä¸å®‰å…¨çš„ã€‚</p><p>Javaçš„å¤–éƒ¨å‡½æ•°æ¥å£ï¼Œæ˜¯Javaè¯­è¨€çš„è®¾è®¡è€…è¯•å›¾è§£å†³è¿™äº›é—®é¢˜çš„ä¸€ä¸ªæ¢ç´¢ã€‚</p><h2>å¤–éƒ¨å‡½æ•°æ¥å£</h2><p>Javaçš„å¤–éƒ¨å‡½æ•°æ¥å£æ˜¯ä»€ä¹ˆæ ·å­çš„å‘¢ï¼Ÿä¸‹é¢çš„ä»£ç ï¼Œå°±æ˜¯ä¸€ä¸ªä½¿ç”¨Javaçš„å¤–éƒ¨å‡½æ•°æ¥å£å®ç°çš„â€œHello, world!\"çš„å°ä¾‹å­ã€‚æˆ‘ä»¬æ¥ä¸€èµ·çœ‹çœ‹ï¼ŒJavaçš„å¤–éƒ¨å‡½æ•°æ¥å£æ˜¯æ€ä¹ˆå·¥ä½œçš„ã€‚</p><pre><code class=\"language-bash\">\nimport java.lang.invoke.MethodType;\nimport jdk.incubator.foreign.*;\n\npublic class HelloWorld {\n    public static void main(String[] args) throws Throwable {\n        try (ResourceScope scope = ResourceScope.newConfinedScope()) {\n            CLinker cLinker = CLinker.getInstance();\n            MemorySegment helloWorld =\n                    CLinker.toCString(\"Hello, world!\\n\", scope);\n            MethodHandle cPrintf = cLinker.downcallHandle(\n                    CLinker.systemLookup().lookup(\"printf\").get(),\n                    MethodType.methodType(int.class, MemoryAddress.class),\n                    FunctionDescriptor.of(CLinker.C_INT, CLinker.C_POINTER));\n            cPrintf.invoke(helloWorld.address());\n        }\n    }\n}\n</code></pre><p>åœ¨è¿™æ®µä»£ç é‡Œï¼Œtry-with-resourceè¯­å¥é‡Œä½¿ç”¨çš„ResourceScopeè¿™ä¸ªç±»ï¼Œå®šä¹‰äº†å†…å­˜èµ„æºçš„ç”Ÿå‘½å‘¨æœŸç®¡ç†æœºåˆ¶ã€‚</p><p>ç¬¬8è¡Œä»£ç é‡Œçš„CLinkerï¼Œå®ç°äº†Cè¯­è¨€çš„åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£ï¼ˆApplication Binary Interfaceï¼ŒABIï¼‰çš„è°ƒç”¨è§„åˆ™ã€‚è¿™ä¸ªæ¥å£çš„å¯¹è±¡ï¼Œå¯ä»¥ç”¨æ¥é“¾æ¥Cè¯­è¨€å®ç°çš„å¤–éƒ¨å‡½æ•°ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œä¹Ÿå°±æ˜¯ç¬¬12è¡Œä»£ç ï¼Œæˆ‘ä»¬ä½¿ç”¨CLinkerçš„å‡½æ•°æ ‡å¿—ç¬¦ï¼ˆSymbolï¼‰æŸ¥è¯¢åŠŸèƒ½ï¼ŒæŸ¥æ‰¾Cè¯­è¨€å®šä¹‰çš„å‡½æ•°printfã€‚åœ¨Cè¯­è¨€é‡Œï¼Œprintfè¿™ä¸ªå‡½æ•°çš„å®šä¹‰å°±åƒä¸‹é¢çš„ä»£ç æè¿°çš„æ ·å­ã€‚</p><pre><code class=\"language-c++\">int printf(const char *restrict format, ...);\n</code></pre><p>Cè¯­è¨€é‡Œï¼Œprintfå‡½æ•°çš„è¿”å›å€¼æ˜¯æ•´å‹æ•°æ®ï¼Œæ¥æ”¶çš„è¾“å…¥å‚æ•°æ˜¯ä¸€ä¸ªå¯å˜é•¿å‚æ•°ã€‚å¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨Cè¯­è¨€æ‰“å°â€œHello, world!â€ï¼Œè¿™ä¸ªå‡½æ•°è°ƒç”¨çš„å½¢å¼å°±åƒä¸‹é¢çš„ä»£ç ã€‚</p><pre><code class=\"language-c++\">printf(\"Hello World!\\n\");\n</code></pre><p>æ¥ä¸‹æ¥çš„ä¸¤è¡Œä»£ç ï¼ˆç¬¬13è¡Œå’Œç¬¬14è¡Œä»£ç ï¼‰ï¼Œå°±æ˜¯è¦æŠŠè¿™ä¸ªè°ƒç”¨å½¢å¼ï¼Œè¡¨è¾¾æˆJavaè¯­è¨€å¤–éƒ¨å‡½æ•°æ¥å£çš„å½¢å¼ã€‚è¿™é‡Œä½¿ç”¨äº†JDK 7å¼•å…¥çš„MethodTypeï¼Œä»¥åŠå°šå¤„äºå­µåŒ–æœŸçš„FunctionDescriptorã€‚MethodTypeå®šä¹‰äº†åé¢çš„Javaä»£ç å¿…é¡»éµå®ˆçš„è°ƒç”¨è§„åˆ™ã€‚è€ŒFunctionDescriptoråˆ™æè¿°äº†å¤–éƒ¨å‡½æ•°å¿…é¡»ç¬¦åˆçš„è§„èŒƒã€‚</p><p>å¥½äº†ï¼Œåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†Cè¯­è¨€å®šä¹‰çš„å‡½æ•°printfï¼Œè§„å®šäº†Javaè°ƒç”¨ä»£ç è¦éµå®ˆçš„è§„åˆ™ï¼Œä¹Ÿæœ‰äº†å¤–éƒ¨å‡½æ•°çš„è§„èŒƒã€‚è°ƒç”¨ä¸€ä¸ªå¤–éƒ¨å‡½æ•°éœ€è¦çš„ä¿¡æ¯å°±éƒ½é½å…¨äº†ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªJavaè¯­è¨€çš„æ–¹æ³•å¥æŸ„ï¼ˆMethodHandleï¼‰ï¼ˆç¬¬11è¡Œï¼‰ï¼Œå¹¶ä¸”æŒ‰ç…§å‰é¢å®šä¹‰çš„Javaè°ƒç”¨è§„åˆ™ï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•å¥æŸ„ï¼ˆç¬¬15è¡Œï¼‰ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½å¤Ÿè®¿é—®Cè¯­è¨€çš„printfå‡½æ•°äº†ã€‚</p><p>å¯¹æ¯”é˜…è¯»æ¡ˆä¾‹é‡Œä½¿ç”¨JNIå®ç°çš„ä»£ç ï¼Œä½¿ç”¨å¤–éƒ¨å‡½æ•°æ¥å£çš„ä»£ç ï¼Œä¸å†éœ€è¦ç¼–å†™Cä»£ç ã€‚å½“ç„¶ï¼Œä¹Ÿä¸å†éœ€è¦ç¼–è¯‘ã€é“¾æ¥ç”ŸæˆCçš„åŠ¨æ€åº“äº†ã€‚æ‰€ä»¥ï¼Œç”±åŠ¨æ€åº“å¸¦æ¥çš„å¹³å°ç›¸å…³çš„é—®é¢˜ï¼Œä¹Ÿå°±ä¸å­˜åœ¨äº†ã€‚</p><h2>æå‡çš„å®‰å…¨æ€§</h2><p>æ›´å¤§çš„æƒŠå–œï¼Œæ¥è‡ªäºå¤–éƒ¨å‡½æ•°æ¥å£åœ¨å®‰å…¨æ€§æ–¹é¢çš„æå‡ã€‚</p><p>ä»æ ¹æœ¬ä¸Šè¯´ï¼Œä»»ä½•Javaä»£ç å’Œæœ¬åœ°ä»£ç ä¹‹é—´çš„äº¤äº’ï¼Œéƒ½ä¼šæŸå®³Javaå¹³å°çš„å®Œæ•´æ€§ã€‚é“¾æ¥åˆ°é¢„ç¼–è¯‘çš„Cå‡½æ•°ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸å¯é çš„ã€‚Javaè¿è¡Œæ—¶ï¼Œæ— æ³•ä¿è¯Cå‡½æ•°çš„ç­¾åå’ŒJavaä»£ç çš„æœŸæœ›æ˜¯åŒ¹é…çš„ã€‚å…¶ä¸­ä¸€äº›å¯èƒ½ä¼šå¯¼è‡´JVMå´©æºƒçš„é”™è¯¯ï¼Œè¿™åœ¨Javaè¿è¡Œæ—¶æ— æ³•é˜»æ­¢ï¼ŒJavaä»£ç ä¹Ÿæ²¡æœ‰åŠæ³•æ•è·ã€‚</p><p>è€Œä½¿ç”¨JNIä»£ç çš„æœ¬åœ°ä»£ç åˆ™å°¤å…¶å±é™©ã€‚è¿™æ ·çš„ä»£ç ï¼Œç”šè‡³å¯ä»¥è®¿é—®JDKçš„å†…éƒ¨ï¼Œæ›´æ”¹ä¸å¯å˜æ•°æ®çš„æ•°å€¼ã€‚å…è®¸æœ¬åœ°ä»£ç ç»•è¿‡Javaä»£ç çš„å®‰å…¨æœºåˆ¶ï¼Œç ´åäº†Javaçš„å®‰å…¨æ€§èµ–ä»¥å­˜åœ¨çš„è¾¹ç•Œå’Œå‡è®¾ã€‚æ‰€ä»¥è¯´ï¼ŒJNIæœ¬è´¨ä¸Šæ˜¯ä¸å®‰å…¨çš„ã€‚</p><p>é—æ†¾çš„æ˜¯ï¼Œè¿™ç§ç ´åJavaä¸ºå°å®Œæ•´ç³»çš„é£é™©ï¼Œå¯¹äºåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜å’Œæœ€ç»ˆç”¨æˆ·æ¥è¯´ï¼Œå‡ ä¹æ˜¯æ— æ³•å¯Ÿè§‰çš„ã€‚å› ä¸ºï¼Œéšç€ç³»ç»Ÿçš„ä¸æ–­ä¸°å¯Œï¼Œ99%çš„ä»£ç æ¥è‡ªäºå¤¹åœ¨JDKå’Œåº”ç”¨ç¨‹åºä¹‹é—´çš„ç¬¬ä¸‰æ–¹ã€ç¬¬å››æ–¹ã€ç”šè‡³ç¬¬äº”æ–¹çš„ç±»åº“é‡Œã€‚</p><p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œå¤§éƒ¨åˆ†å¤–éƒ¨å‡½æ•°æ¥å£çš„è®¾è®¡åˆ™æ˜¯å®‰å…¨çš„ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨å¤–éƒ¨å‡½æ•°æ¥å£çš„ä»£ç ï¼Œä¸ä¼šå¯¼è‡´JVMçš„å´©æºƒã€‚ä¹Ÿæœ‰ä¸€éƒ¨åˆ†å¤–éƒ¨å‡½æ•°æ¥å£æ˜¯ä¸å®‰å…¨çš„ï¼Œä½†æ˜¯è¿™ç§ä¸å®‰å…¨æ€§å¹¶æ²¡æœ‰åˆ°è¾¾JNIé‚£æ ·çš„ä¸¥é‡æ€§ã€‚å¯ä»¥è¯´ï¼Œä½¿ç”¨å¤–éƒ¨å‡½æ•°æ¥å£çš„ä»£ç ï¼Œæ˜¯Javaä»£ç ï¼Œå› æ­¤ä¹Ÿå—åˆ°Javaå®‰å…¨æœºåˆ¶çš„çº¦æŸã€‚</p><h2>JNIé€€å‡ºçš„ä¿¡å·</h2><p>å½“å‡ºç°äº†ä¸€ä¸ªæ›´ç®€å•ã€æ›´å®‰å…¨çš„æ–¹æ¡ˆåï¼ŒåŸæœ‰çš„æ–¹æ¡ˆå¾ˆéš¾å†æœ‰ç«äº‰åŠ›ã€‚å¤–éƒ¨å‡½æ•°æ¥å£æ­£å¼å‘å¸ƒåï¼ŒJNIçš„é€€å‡ºå¯èƒ½ä¹Ÿå°±è¦æä¸Šè®®ç¨‹äº†ã€‚</p><p>åœ¨å¤–éƒ¨å‡½æ•°æ¥å£çš„ææ¡ˆé‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™æ ·çš„æè¿°ï¼š</p><blockquote>\n<p>JNI æœºåˆ¶æ˜¯å¦‚æ­¤å±é™©ï¼Œä»¥è‡³äºæˆ‘ä»¬å¸Œæœ›åº“åœ¨å®‰å…¨å’Œä¸å®‰å…¨æ“ä½œä¸­éƒ½æ›´å–œæ¬¢çº¯Javaçš„å¤–éƒ¨å‡½æ•°æ¥å£ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥åœ¨é»˜è®¤æƒ…å†µä¸‹åŠæ—¶å…¨é¢ç¦ç”¨JNIã€‚è¿™ä¸ä½¿Javaå¹³å°å¼€ç®±å³ç”¨ã€ç¼ºçœå®‰å…¨çš„æ›´å¹¿æ³›çš„Javaè·¯çº¿å›¾æ˜¯ä¸€è‡´çš„ã€‚</p>\n</blockquote><p>å®‰å…¨é—®é¢˜å¾€å¾€å…·æœ‰ä¸€ç¥¨å¦å†³æƒï¼Œæ‰€ä»¥ï¼ŒJNIçš„é€€å‡ºå¾ˆå¯èƒ½æ¯”æˆ‘ä»¬é¢„æœŸçš„è¿˜è¦å¿«ï¼</p><h2>æ€»ç»“</h2><p>å¥½ï¼Œåˆ°è¿™é‡Œï¼Œæˆ‘æ¥åšä¸ªå°ç»“ã€‚å‰é¢ï¼Œæˆ‘ä»¬è®¨è®ºäº†Javaçš„å¤–éƒ¨å‡½æ•°æ¥å£è¿™ä¸ªå°šå¤„äºå­µåŒ–é˜¶æ®µçš„æ–°ç‰¹æ€§ï¼Œå¯¹å¤–éƒ¨å‡½æ•°æ¥å£è¿™ä¸ªæ–°ç‰¹æ€§æœ‰äº†ä¸€ä¸ªåˆå§‹çš„å°è±¡ã€‚å¤–éƒ¨å†…å­˜æ¥å£å’Œå¤–éƒ¨å‡½æ•°æ¥å£è”ç³»åœ¨ä¸€èµ·ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå´­æ–°çš„ä¸åŒè¯­è¨€ä¹‹é—´çš„åä½œæ–¹æ¡ˆã€‚</p><p>å¦‚æœå¤–éƒ¨å‡½æ•°æ¥å£æ­£å¼å‘å¸ƒå‡ºæ¥ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦è€ƒè™‘åˆ‡æ¢åˆ°å¤–éƒ¨å‡½æ•°æ¥å£ï¼Œé€æ­¥é€€å‡ºä¼ ç»Ÿçš„ã€åŸºäºJNIçš„è§£å†³æ–¹æ¡ˆã€‚</p><p>è¿™ä¸€æ¬¡å­¦ä¹ çš„ä¸»è¦ç›®çš„ï¼Œå°±æ˜¯è®©ä½ å¯¹å¤–éƒ¨å‡½æ•°æ¥å£æœ‰ä¸€ä¸ªåŸºæœ¬çš„å°è±¡ã€‚ç”±äºå¤–éƒ¨å‡½æ•°æ¥å£å°šå¤„äºå­µåŒ–é˜¶æ®µï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦å­¦ä¹ å®ƒçš„APIã€‚åªè¦çŸ¥é“Javaæœ‰è¿™ä¸ªå‘å±•æ–¹å‘ï¼Œç›®å‰æ¥è¯´å°±è¶³å¤Ÿäº†ã€‚</p><p>å¦‚æœé¢è¯•ä¸­èŠåˆ°äº†Javaçš„æœªæ¥ï¼Œä½ ä¸å¦¨èŠä¸€èŠå¤–éƒ¨å†…å­˜æ¥å£å’Œå¤–éƒ¨å‡½æ•°æ¥å£ï¼Œå®ƒä»¬è¦è§£å†³çš„é—®é¢˜ï¼Œä»¥åŠèƒ½å¸¦æ¥çš„å˜åŒ–ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>å…¶å®ï¼Œä»Šå¤©çš„è¿™ä¸ªæ–°ç‰¹æ€§ï¼Œä¹Ÿæ˜¯ç»ƒä¹ ä½¿ç”¨JShellå¿«é€Ÿå­¦ä¹ æ–°æŠ€æœ¯çš„ä¸€ä¸ªå¥½æœºä¼šã€‚æˆ‘ä»¬åœ¨å‰é¢çš„è®¨è®ºé‡Œï¼Œåˆ†æäº†ä¸‹é¢è¿™æ®µä»£ç ã€‚ä¸ºäº†æ–¹ä¾¿ä½ é˜…è¯»ï¼Œæˆ‘æŠŠè¿™æ®µä»£ç é‡æ–°æ‹·è´åˆ°ä¸‹é¢äº†ã€‚</p><pre><code class=\"language-java\">try (ResourceScope scope = ResourceScope.newConfinedScope()) {\n    CLinker cLinker = CLinker.getInstance();\n    MemorySegment helloWorld =\n            CLinker.toCString(\"Hello, world!\\n\", scope);\n    MethodHandle cPrintf = cLinker.downcallHandle(\n            CLinker.systemLookup().lookup(\"printf\").get(),\n            MethodType.methodType(int.class, MemoryAddress.class),\n            FunctionDescriptor.of(CLinker.C_INT, CLinker.C_POINTER));\n    cPrintf.invoke(helloWorld.address());\n}\n</code></pre><p>ä½ èƒ½ä¸èƒ½æ‰¾ä¸€ä¸ªä½ ç†Ÿæ‚‰çš„Cè¯­è¨€æ ‡å‡†å‡½æ•°ï¼Œè¯•ç€ä¿®æ”¹ä¸Šé¢çš„ä»£ç ï¼Œå¿«é€Ÿåœ°éªŒè¯ä¸€ä¸‹å¤–éƒ¨å‡½æ•°æ¥å£èƒ½ä¸èƒ½æŒ‰ç…§ä½ çš„é¢„æœŸå·¥ä½œï¼Ÿ</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¦æƒ³ä½¿ç”¨å­µåŒ–æœŸçš„JDKæŠ€æœ¯ï¼Œéœ€è¦åœ¨JShellé‡Œå¯¼å…¥å­µåŒ–æœŸçš„JDKæ¨¡å—ã€‚å°±åƒä¸‹é¢çš„ä¾‹å­è¿™æ ·ã€‚</p><pre><code class=\"language-java\">$ jshell --add-modules jdk.incubator.foreign -v\n|&nbsp; Welcome to JShell -- Version 17\n|&nbsp; For an introduction type: /help intro\n\njshell&gt; import jdk.incubator.foreign.*;\n</code></pre><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºç•™è¨€ã€è®¨è®ºï¼Œåˆ†äº«ä½ çš„é˜…è¯»ä½“éªŒä»¥åŠä½ çš„è®¾è®¡å’Œä»£ç ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ï¼</p><p>æ³¨ï¼šæœ¬æ–‡ä½¿ç”¨çš„å®Œæ•´çš„ä»£ç å¯ä»¥ä»<a href=\"https://github.com/XueleiFan/java-up/tree/main/src/main/java/co/ivi/jus/foreign\">GitHub</a>ä¸‹è½½ï¼Œä½ å¯ä»¥é€šè¿‡ä¿®æ”¹<a href=\"https://github.com/XueleiFan/java-up/tree/main/src/main/java/co/ivi/jus/foreign\">GitHub</a>ä¸Š<a href=\"https://github.com/XueleiFan/java-up/blob/main/src/main/java/co/ivi/jus/foreign/review/xuelei/foreignMemory.jsh\">review template</a>ä»£ç ï¼Œå®Œæˆè¿™æ¬¡çš„æ€è€ƒé¢˜ã€‚å¦‚æœä½ æƒ³è¦åˆ†äº«ä½ çš„ä¿®æ”¹æˆ–è€…æƒ³å¬å¬è¯„å®¡çš„æ„è§ï¼Œè¯·æäº¤ä¸€ä¸ª GitHubçš„æ‹‰å–è¯·æ±‚ï¼ˆPull Requestï¼‰ï¼Œå¹¶æŠŠæ‹‰å–è¯·æ±‚çš„åœ°å€è´´åˆ°ç•™è¨€é‡Œã€‚è¿™ä¸€å°èŠ‚çš„æ‹‰å–è¯·æ±‚ä»£ç ï¼Œè¯·åœ¨<a href=\"https://github.com/XueleiFan/java-up/tree/main/src/main/java/co/ivi/jus/foreign/review\">å¤–éƒ¨å‡½æ•°æ¥å£ä¸“ç”¨çš„ä»£ç è¯„å®¡ç›®å½•</a>ä¸‹ï¼Œå»ºä¸€ä¸ªä»¥ä½ çš„åå­—å‘½åçš„å­ç›®å½•ï¼Œä»£ç æ”¾åˆ°ä½ ä¸“æœ‰çš„å­ç›®å½•é‡Œã€‚æ¯”å¦‚ï¼Œæˆ‘çš„ä»£ç ï¼Œå°±æ”¾åœ¨memory/review/xueleiçš„ç›®å½•ä¸‹é¢ã€‚</p>","neighbors":{"left":{"article_title":"12 | å¤–éƒ¨å†…å­˜æ¥å£ï¼šé›¶æ‹·è´çš„éšœç¢è¿˜æœ‰å¤šå°‘ï¼Ÿ","id":465899},"right":{"article_title":"14 | ç¦æ­¢ç©ºæŒ‡é’ˆï¼Œè¯¥æ€ä¹ˆé¿å…å´©æºƒçš„ç©ºæŒ‡é’ˆï¼Ÿ","id":469114}},"comments":[{"had_liked":false,"id":326134,"user_name":"å­¦ä¹ ","can_delete":false,"product_type":"c1","uid":1437425,"ip_address":"","ucode":"CDFB71E0D1508B","user_header":"https://static001.geekbang.org/account/avatar/00/15/ee/f1/16545faf.jpg","comment_is_top":false,"comment_ctime":1639389827,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10229324419","product_id":100097301,"comment_content":"æ„ŸçŸ¥ä¸å¼ºï¼Œå¯èƒ½è¿˜éœ€è¦æ—¶é—´æ¥æ²‰æ·€å§","like_count":2},{"had_liked":false,"id":327446,"user_name":"JavaGuide","can_delete":false,"product_type":"c1","uid":1184210,"ip_address":"","ucode":"246D2EAEA0ACEC","user_header":"https://static001.geekbang.org/account/avatar/00/12/11/d2/fb38b86f.jpg","comment_is_top":false,"comment_ctime":1640137647,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5935104943","product_id":100097301,"comment_content":"JNA è¿™ä¸ªåº“è²Œä¼¼æ˜¯ç›®å‰çš„å¤‡ç”¨é€‰æ‹©ï¼ŒJDK å®˜æ–¹ä¹Ÿæåˆ°è¿‡è¿™ä¸ªåº“ã€‚<br><br>åœ°å€ï¼šhttps:&#47;&#47;github.com&#47;java-native-access&#47;jna","like_count":1},{"had_liked":false,"id":326603,"user_name":"ABC","can_delete":false,"product_type":"c1","uid":1054958,"ip_address":"","ucode":"7501AD9C0C4A70","user_header":"https://static001.geekbang.org/account/avatar/00/10/18/ee/a1ed60d1.jpg","comment_is_top":false,"comment_ctime":1639579434,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5934546730","product_id":100097301,"comment_content":"JShellè¿è¡Œ:<br><br>jshell --add-modules jdk.incubator.foreign -R--enable-native-access=ALL-UNNAMED<br><br>import java.lang.invoke.MethodType;<br>import java.lang.invoke.MethodHandle;<br>import jdk.incubator.foreign.*;<br><br>try (ResourceScope scope = ResourceScope.newConfinedScope()) {<br>                CLinker cLinker = CLinker.getInstance();<br>                MemorySegment helloWorld =<br>                        CLinker.toCString(&quot;Hello, world!\\n&quot;, scope);<br>                MethodHandle cPrintf = cLinker.downcallHandle(<br>                        CLinker.systemLookup().lookup(&quot;printf&quot;).get(),<br>                        MethodType.methodType(int.class, MemoryAddress.class),<br>                        FunctionDescriptor.of(CLinker.C_INT, CLinker.C_POINTER));<br>                cPrintf.invoke(helloWorld.address());<br>}<br>","like_count":1,"discussions":[{"author":{"id":1232599,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ce/d7/8168e1bf.jpg","nickname":"å“¦å¼æ‰äº†","note":"","ucode":"1F89B1BA1EEF52","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539423,"discussion_content":"jshellé‡Œé¢æœ‰å•¥è¾“å‡ºä¹ˆï¼Ÿjshell 17.0.1å¹¶æ²¡æœ‰é¢„æœŸè¾“å‡ºçš„Hello,World","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639711847,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":359476,"user_name":"if...else...","can_delete":false,"product_type":"c1","uid":2550743,"ip_address":"æµ™æ±Ÿ","ucode":"D0565908C99695","user_header":"https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg","comment_is_top":false,"comment_ctime":1665564991,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1665564991","product_id":100097301,"comment_content":"å­¦ä¹ æ‰“å¡","like_count":0},{"had_liked":false,"id":327447,"user_name":"JavaGuide","can_delete":false,"product_type":"c1","uid":1184210,"ip_address":"","ucode":"246D2EAEA0ACEC","user_header":"https://static001.geekbang.org/account/avatar/00/12/11/d2/fb38b86f.jpg","comment_is_top":false,"comment_ctime":1640138043,"is_pvip":false,"replies":[{"id":"119237","content":"JEP 191è¢«æ›´å¥½çš„æ–¹æ¡ˆå–ä»£äº†ï¼šhttps:&#47;&#47;openjdk.java.net&#47;jeps&#47;412","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1111315","ctime":1640201570,"ip_address":"","comment_id":327447,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1640138043","product_id":100097301,"comment_content":"å¦å¤–ï¼Œè¯·é—®ä¸€ä¸‹è€å¸ˆï¼Œè¿™ä¸ªææ¡ˆhttps:&#47;&#47;openjdk.java.net&#47;jeps&#47;191ä¸­ä¸æ˜¯å·²ç»å°†Java çš„å¤–éƒ¨å‡½æ•°æ¥å£è¿™ä¸ªç‰¹æ€§çš„å¼€å‘æš‚æ—¶åœæ­¢äº†ä¹ˆ? ","like_count":0,"discussions":[{"author":{"id":1111315,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f5/13/78741b7b.jpg","nickname":"èŒƒå­¦é›·","note":"","ucode":"D7CBE4A33427BD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540919,"discussion_content":"JEP 191è¢«æ›´å¥½çš„æ–¹æ¡ˆå–ä»£äº†ï¼šhttps://openjdk.java.net/jeps/412","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640201570,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1184210,"avatar":"https://static001.geekbang.org/account/avatar/00/12/11/d2/fb38b86f.jpg","nickname":"JavaGuide","note":"","ucode":"246D2EAEA0ACEC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541042,"discussion_content":"å¥½çš„  æ„Ÿè°¢è€å¸ˆğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640241339,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326397,"user_name":"ABC","can_delete":false,"product_type":"c1","uid":1054958,"ip_address":"","ucode":"7501AD9C0C4A70","user_header":"https://static001.geekbang.org/account/avatar/00/10/18/ee/a1ed60d1.jpg","comment_is_top":false,"comment_ctime":1639494633,"is_pvip":false,"replies":[{"id":"118529","content":"JDK 18å·²ç»ä¿®å¤äº†ï¼Œå¯èƒ½è¦ç­‰åˆ°ä¸‹ä¸€ä¸ªbuildæ‰èƒ½è§æ•ˆã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1111315","ctime":1639523516,"ip_address":"","comment_id":326397,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1639494633","product_id":100097301,"comment_content":"åœ¨JDK18çš„JShellé‡Œé¢ä¹Ÿè¯•äº†ä¸€ä¸‹,åŒæ ·æŠ¥é”™.","like_count":0,"discussions":[{"author":{"id":1111315,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f5/13/78741b7b.jpg","nickname":"èŒƒå­¦é›·","note":"","ucode":"D7CBE4A33427BD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538788,"discussion_content":"JDK 18å·²ç»ä¿®å¤äº†ï¼Œå¯èƒ½è¦ç­‰åˆ°ä¸‹ä¸€ä¸ªbuildæ‰èƒ½è§æ•ˆã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639523516,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326396,"user_name":"ABC","can_delete":false,"product_type":"c1","uid":1054958,"ip_address":"","ucode":"7501AD9C0C4A70","user_header":"https://static001.geekbang.org/account/avatar/00/10/18/ee/a1ed60d1.jpg","comment_is_top":false,"comment_ctime":1639494378,"is_pvip":false,"replies":[{"id":"118530","content":"ä½¿ç”¨â€œ-R--enable-native-access=ALL-UNNAMEDâ€çš„jshellå‘½ä»¤è¡Œé€‰é¡¹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1111315","ctime":1639523549,"ip_address":"","comment_id":326396,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1639494378","product_id":100097301,"comment_content":"åœ¨JShellé‡Œé¢è¿è¡Œ,å‘ç°æŠ¥é”™: java.lang.IllegalCallerExceptionï¼šIllegal native access from: unnamed module @f2a0b8e<br><br>åœ¨OpenJDKçš„æè¿°é‡Œé¢æç¤ºäº†ï¼Œéœ€è¦è®¾ç½®: java --enable-native-access=M æ‰èƒ½æ­£ç¡®è¿è¡Œ,ä½†æ˜¯JShellé‡Œé¢æ— æ³•è®¾ç½®.è€å¸ˆ,è¯·é—®è¦æ€ä¹ˆæ‰èƒ½æ­£å¸¸è¿è¡Œ?è°¢è°¢.","like_count":0,"discussions":[{"author":{"id":1111315,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f5/13/78741b7b.jpg","nickname":"èŒƒå­¦é›·","note":"","ucode":"D7CBE4A33427BD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538789,"discussion_content":"ä½¿ç”¨â€œ-R--enable-native-access=ALL-UNNAMEDâ€çš„jshellå‘½ä»¤è¡Œé€‰é¡¹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639523550,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1054958,"avatar":"https://static001.geekbang.org/account/avatar/00/10/18/ee/a1ed60d1.jpg","nickname":"ABC","note":"","ucode":"7501AD9C0C4A70","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539029,"discussion_content":"å¥½çš„,è°¢è°¢è€å¸ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639579110,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326318,"user_name":"Jxin","can_delete":false,"product_type":"c1","uid":1251111,"ip_address":"","ucode":"4C03928388C413","user_header":"https://static001.geekbang.org/account/avatar/00/13/17/27/ec30d30a.jpg","comment_is_top":false,"comment_ctime":1639469776,"is_pvip":false,"replies":[{"id":"118533","content":"è¿˜åœ¨å­µåŒ–å™¨ï¼Œè®ºè¯å’Œæ„é€ åŸå‹ä¸ºä¸»ã€‚ç°åœ¨çš„è®¾è®¡ï¼Œå·²ç»æœ‰ç‚¹æ³›åŒ–çš„æ„æ€äº†ã€‚è¯•å›¾ç»Ÿä¸€è§„åˆ™å’Œåè®®çš„æƒ³æ³•ï¼Œæœ€æ€•çš„å°±æ˜¯ä¸€å¢æƒ…æ„¿ï¼Œå¾ˆéš¾åšæˆã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1111315","ctime":1639524304,"ip_address":"","comment_id":326318,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1639469776","product_id":100097301,"comment_content":"æˆ‘çš„æƒ³æ³•æ˜¯ï¼Œå¤–éƒ¨å‡½æ•°æ¥å£åº”è¯¥æ˜¯ç°æœ‰RPCäº¤äº’çš„ä¸€ç§æš´éœ²æ¥å£çš„æ–°æ¨¡å¼ã€‚å°±åƒæš´éœ²httpæ¥å£ï¼Œä¸åŒè¯­è¨€éƒ½æš´éœ²ç›¸åŒæ¨¡å¼çš„â€œå¤–éƒ¨å‡½æ•°â€æ¥å£ï¼Œæœ‰ä¸€å¥—è·¨è¯­è¨€çš„ç»Ÿä¸€è§„åˆ™&#47;åè®®ã€‚è°ƒç”¨æ–¹ä¸æœåŠ¡æ–¹çš†éµå¾ªç»Ÿä¸€è§„åˆ™&#47;åè®®äº¤äº’ã€‚åƒç°åœ¨è¿™æ ·ï¼Œå¿…é¡»è°ƒç”¨ç‰¹å®šè¯­è¨€çš„è°ƒç”¨è§„åˆ™ï¼Œåœ¨æ³›åŒ–ä¸Šèµ°ä¸é€šï¼ˆè¦æ„ŸçŸ¥å¼‚æ„ç³»ç»Ÿçš„è¯­è¨€ï¼‰ï¼Œé€‚ç”¨èŒƒå›´å°±ä¼šå¾ˆå±€é™ã€‚","like_count":0,"discussions":[{"author":{"id":1111315,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f5/13/78741b7b.jpg","nickname":"èŒƒå­¦é›·","note":"","ucode":"D7CBE4A33427BD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538793,"discussion_content":"è¿˜åœ¨å­µåŒ–å™¨ï¼Œè®ºè¯å’Œæ„é€ åŸå‹ä¸ºä¸»ã€‚ç°åœ¨çš„è®¾è®¡ï¼Œå·²ç»æœ‰ç‚¹æ³›åŒ–çš„æ„æ€äº†ã€‚è¯•å›¾ç»Ÿä¸€è§„åˆ™å’Œåè®®çš„æƒ³æ³•ï¼Œæœ€æ€•çš„å°±æ˜¯ä¸€å¢æƒ…æ„¿ï¼Œå¾ˆéš¾åšæˆã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639524304,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326257,"user_name":"å“¦å¼æ‰äº†","can_delete":false,"product_type":"c1","uid":1232599,"ip_address":"","ucode":"1F89B1BA1EEF52","user_header":"https://static001.geekbang.org/account/avatar/00/12/ce/d7/8168e1bf.jpg","comment_is_top":false,"comment_ctime":1639451036,"is_pvip":true,"replies":[{"id":"118534","content":"ä¼°è®¡Githubä¸Šçš„ä»£ç æ²¡æœ‰å¤„ç†å¥½ç¼–è¯‘&#47;è¿è¡Œé€‰é¡¹ï¼Œåº”è¯¥è®¾ç½®â€œ--enable-native-access=ALL-UNNAMEDâ€å‚æ•°ã€‚<br><br>workspace.xml:      &lt;option name=&quot;VM_PARAMETERS&quot; value=&quot;--enable-preview --enable-native-access=ALL-UNNAMED --add-modules=jdk.incubator.vector,jdk.incubator.foreign&quot; &#47;&gt;","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1111315","ctime":1639524463,"ip_address":"","comment_id":326257,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1639451036","product_id":100097301,"comment_content":"ideaé‡Œé¢çš„â€“add-exportsé¡µé¢ä¸Šä¸€ç›´æ²¡åŠ ä¸Šå»ï¼Œæ”¾å¼ƒäº†ã€‚jshell17.0.1æ‰§è¡Œç»“æœï¼Œæœ‰é‡åˆ°çš„å°ä¼™ä¼´ä¹ˆï¼Ÿæ€ä¹ˆè§£å†³çš„,java.lang.IllegalCallerExceptionï¼šIllegal native access from: unnamed module @6aa8ceb6<br>|        at Reflection.ensureNativeAccess (Reflection.java:112)<br>|        at CLinker.getInstance (CLinker.java:131)","like_count":0,"discussions":[{"author":{"id":1111315,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f5/13/78741b7b.jpg","nickname":"èŒƒå­¦é›·","note":"","ucode":"D7CBE4A33427BD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538794,"discussion_content":"ä¼°è®¡Githubä¸Šçš„ä»£ç æ²¡æœ‰å¤„ç†å¥½ç¼–è¯‘/è¿è¡Œé€‰é¡¹ï¼Œåº”è¯¥è®¾ç½®â€œ--enable-native-access=ALL-UNNAMEDâ€å‚æ•°ã€‚\n\nworkspace.xml:      &lt;option name=&#34;VM_PARAMETERS&#34; value=&#34;--enable-preview --enable-native-access=ALL-UNNAMED --add-modules=jdk.incubator.vector,jdk.incubator.foreign&#34; /&gt;","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1639524463,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1232599,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ce/d7/8168e1bf.jpg","nickname":"å“¦å¼æ‰äº†","note":"","ucode":"1F89B1BA1EEF52","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1111315,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f5/13/78741b7b.jpg","nickname":"èŒƒå­¦é›·","note":"","ucode":"D7CBE4A33427BD","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":539424,"discussion_content":"jshellé‡Œé¢æœ‰å•¥è¾“å‡ºä¹ˆï¼Ÿjshell 17.0.1è¿˜æ˜¯æ²¡æœ‰é¢„æœŸè¾“å‡ºçš„Hello,World","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639711876,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":538794,"ip_address":""},"score":539424,"extra":""}]},{"author":{"id":1054958,"avatar":"https://static001.geekbang.org/account/avatar/00/10/18/ee/a1ed60d1.jpg","nickname":"ABC","note":"","ucode":"7501AD9C0C4A70","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538730,"discussion_content":"JShellé‡Œé¢é‡åˆ°äº†åŒæ ·çš„é—®é¢˜.ç­‰è€å¸ˆè§£ç­”ä¸­.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639494415,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326167,"user_name":"å“¦å¼æ‰äº†","can_delete":false,"product_type":"c1","uid":1232599,"ip_address":"","ucode":"1F89B1BA1EEF52","user_header":"https://static001.geekbang.org/account/avatar/00/12/ce/d7/8168e1bf.jpg","comment_is_top":false,"comment_ctime":1639402742,"is_pvip":true,"replies":[{"id":"118434","content":"è°¢è°¢ï¼Œæ¼æ‰äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1111315","ctime":1639417446,"ip_address":"","comment_id":326167,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1639402742","product_id":100097301,"comment_content":"helloworld.cæ–‡ä»¶ä¸­æ²¡æœ‰å†™å½¢å‚ï¼Œgccç¼–è¯‘ä¼šæŠ¥é”™ã€‚","like_count":0,"discussions":[{"author":{"id":1111315,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f5/13/78741b7b.jpg","nickname":"èŒƒå­¦é›·","note":"","ucode":"D7CBE4A33427BD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538508,"discussion_content":"è°¢è°¢ï¼Œæ¼æ‰äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639417446,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326067,"user_name":"kimoti","can_delete":false,"product_type":"c1","uid":1897671,"ip_address":"","ucode":"0A78077408C2B1","user_header":"https://static001.geekbang.org/account/avatar/00/1c/f4/c7/037235c9.jpg","comment_is_top":false,"comment_ctime":1639360939,"is_pvip":false,"replies":[{"id":"118435","content":"åº”è¯¥æ˜¯é“¾æ¥åˆ°Cçš„åŠ¨æ€åº“å°±è¡Œã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1111315","ctime":1639417670,"ip_address":"","comment_id":326067,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1639360939","product_id":100097301,"comment_content":"å¤–éƒ¨å‡½æ•°å€Ÿå£æ˜¯ä¸æ˜¯åœ¨å†…éƒ¨ç¼–è¯‘,é“¾æ¥Cè¯­è¨€ç¨‹åº,åªä¸è¿‡è¿™ä¸ªè¿‡ç¨‹å¯¹Javaç¨‹åºå‘˜é€æ˜è€Œå·²ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1111315,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f5/13/78741b7b.jpg","nickname":"èŒƒå­¦é›·","note":"","ucode":"D7CBE4A33427BD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538509,"discussion_content":"åº”è¯¥æ˜¯é“¾æ¥åˆ°Cçš„åŠ¨æ€åº“å°±è¡Œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639417670,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}