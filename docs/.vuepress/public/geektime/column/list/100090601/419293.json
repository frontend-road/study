{"id":419293,"title":"03ï½œè·¯ç”±ï¼šå¦‚ä½•è®©è¯·æ±‚æ›´å¿«å¯»æ‰¾åˆ°ç›®æ ‡å‡½æ•°ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯è½©è„‰åˆƒã€‚</p><p>ä¸Šä¸€è®²ï¼Œæˆ‘ä»¬å°è£…äº†æ¡†æ¶çš„Contextï¼Œ å°†è¯·æ±‚ç»“æ„ request å’Œè¿”å›ç»“æ„ responseWriter éƒ½å°è£…åœ¨ Context ä¸­ã€‚åˆ©ç”¨è¿™ä¸ª Contextï¼Œ æˆ‘ä»¬å°†æ§åˆ¶å™¨ç®€åŒ–ä¸ºå¸¦æœ‰ä¸€ä¸ªå‚æ•°çš„å‡½æ•°FooControllerHandlerï¼Œè¿™ä¸ªæ§åˆ¶å™¨å‡½æ•°çš„è¾“å…¥å’Œè¾“å‡ºéƒ½æ˜¯å›ºå®šçš„ã€‚åœ¨æ¡†æ¶å±‚é¢ï¼Œæˆ‘ä»¬ä¹Ÿå®šä¹‰äº†å¯¹åº”å…³äºæ§åˆ¶å™¨çš„æ–¹æ³•ç»“æ„ControllerHandleræ¥ä»£è¡¨è¿™ç±»æ§åˆ¶å™¨çš„å‡½æ•°ã€‚</p><p>æ¯ä¸€ä¸ªè¯·æ±‚é€»è¾‘ï¼Œéƒ½æœ‰ä¸€ä¸ªæ§åˆ¶å™¨ControllerHandlerä¸ä¹‹å¯¹åº”ã€‚é‚£ä¹ˆä¸€ä¸ªè¯·æ±‚ï¼Œå¦‚ä½•æŸ¥æ‰¾åˆ°æŒ‡å®šçš„æ§åˆ¶å™¨å‘¢ï¼Ÿè¿™å°±æ˜¯ä»Šå¤©è¦ç ”ç©¶çš„å†…å®¹ï¼šè·¯ç”±ï¼Œæˆ‘å°†å¸¦ä½ ç†è§£è·¯ç”±ï¼Œå¹¶ä¸”å®ç°ä¸€ä¸ªé«˜æ•ˆã€æ˜“ç”¨çš„è·¯ç”±æ¨¡å—ã€‚</p><h2>è·¯ç”±è®¾è®¡æ€è·¯</h2><p>ç›¸ä¿¡ä½ å¯¹è·¯ç”±æ˜¯å¹²å•¥çš„å·²ç»æœ‰å¤§è‡´äº†è§£ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯è®© Web æœåŠ¡å™¨æ ¹æ®è§„åˆ™ï¼Œç†è§£ HTTP è¯·æ±‚ä¸­çš„ä¿¡æ¯ï¼ŒåŒ¹é…æŸ¥æ‰¾å‡ºå¯¹åº”çš„æ§åˆ¶å™¨ï¼Œå†å°†è¯·æ±‚ä¼ é€’ç»™æ§åˆ¶å™¨æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œ<strong>ç®€å•æ¥è¯´å°±æ˜¯åˆ¶å®šåŒ¹é…è§„åˆ™</strong>ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/11/7b/11dee96201a6f32358d8cceced0f137b.jpg?wh=1920x1080\" alt=\"\"></p><p>ä½†æ˜¯å°±æ˜¯è¿™ä¹ˆç®€å•çš„åŠŸèƒ½ï¼Œ<strong>è·¯ç”±çš„è®¾è®¡æ„Ÿä¸åŒï¼Œå¯ç”¨æ€§æœ‰å¤©å£¤ä¹‹åˆ«</strong>ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Œæˆ‘ä»¬å¸¦ç€è¿™ä¸ªé—®é¢˜ï¼Œå…ˆæ¥æ¢³ç†ä¸€ä¸‹åˆ¶å®šè·¯ç”±è§„åˆ™éœ€è¦çš„ä¿¡æ¯ã€‚</p><p>è·¯ç”±å¯ä»¥ä½¿ç”¨HTTPè¯·æ±‚ä½“ä¸­çš„å“ªäº›ä¿¡æ¯ï¼Œå¾—å›é¡¾æˆ‘ä»¬ç¬¬ä¸€èŠ‚è¯¾è®² HTTP çš„å†…å®¹ã€‚</p><p>ä¸€ä¸ª HTTP è¯·æ±‚åŒ…å«è¯·æ±‚å¤´å’Œè¯·æ±‚ä½“ã€‚è¯·æ±‚ä½“å†…ä¸€èˆ¬å­˜æ”¾çš„æ˜¯è¯·æ±‚çš„ä¸šåŠ¡æ•°æ®ï¼Œæ˜¯åŸºäºå…·ä½“æ§åˆ¶ä¸šåŠ¡éœ€è¦çš„ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸ä¼šç”¨æ¥åšè·¯ç”±ã€‚</p><!-- [[[read_end]]] --><p>è€Œè¯·æ±‚å¤´ä¸­å­˜æ”¾çš„æ˜¯å’Œè¯·æ±‚çŠ¶æ€æœ‰å…³çš„ä¿¡æ¯ï¼Œæ¯”å¦‚User-Agent ä»£è¡¨çš„æ˜¯è¯·æ±‚çš„æµè§ˆå™¨ä¿¡æ¯ï¼ŒAcceptä»£è¡¨çš„æ˜¯æ”¯æŒè¿”å›çš„æ–‡æœ¬ç±»å‹ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ ‡å‡†è¯·æ±‚å¤´çš„ç¤ºä¾‹ï¼š</p><pre><code class=\"language-xml\">GET /home.html HTTP/1.1\nHost: developer.mozilla.org\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.9; rv:50.0) Gecko/20100101 Firefox/50.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 \nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate, br\nReferer: https://developer.mozilla.org/testpage.html\n</code></pre><p>æ¯ä¸€è¡Œçš„ä¿¡æ¯å’Œå«ä¹‰éƒ½æ˜¯éå¸¸å¤§çš„è¯¾é¢˜ï¼Œä¹Ÿä¸ä»Šå¤©è¦è®²çš„å†…å®¹æ— å…³ï¼Œæˆ‘ä»¬è¿™é‡Œè¦å…³æ³¨çš„æ˜¯ HTTP è¯·æ±‚çš„ç¬¬ä¸€è¡Œï¼Œå«åš Request Lineï¼Œç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š<strong>Methodã€Request-URI å’Œ HTTP-Version</strong>ï¼ˆ<a href=\"https://datatracker.ietf.org/doc/html/rfc2616\">RFC2616</a>ï¼‰ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/7b/d7/7bd9061513922ff9e748f4ed90422dd7.jpg?wh=1920x1080\" alt=\"\"></p><p>Method æ˜¯HTTPçš„æ–¹æ³•ï¼Œæ ‡è¯†å¯¹æœåŠ¡ç«¯èµ„æºçš„æ“ä½œå±æ€§ã€‚å®ƒåŒ…å«å¤šä¸ªæ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½ä»£è¡¨ä¸åŒçš„æ“ä½œå±æ€§ã€‚</p><pre><code class=\"language-xml\">       Method         = \"OPTIONS\"                ; Section 9.2\n                      | \"GET\"                    ; Section 9.3\n                      | \"HEAD\"                   ; Section 9.4\n                      | \"POST\"                   ; Section 9.5\n                      | \"PUT\"                    ; Section 9.6\n                      | \"DELETE\"                 ; Section 9.7\n                      | \"TRACE\"                  ; Section 9.8\n                      | \"CONNECT\"                ; Section 9.9\n                      | extension-method\n       extension-method = token\n</code></pre><p>Request-URIæ˜¯è¯·æ±‚è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯æµè§ˆå™¨è¯·æ±‚åœ°å€ä¸­åŸŸåå¤–çš„å‰©ä½™éƒ¨åˆ†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a8/ac/a8ca2560e0096b2e364f569079496eac.jpg?wh=1920x1080\" alt=\"\"></p><p>HTTP-Version æ˜¯ HTTP çš„åè®®ç‰ˆæœ¬ï¼Œç›®å‰å¸¸è§çš„æœ‰1.0ã€1.1ã€2.0ã€‚</p><p>Web Service åœ¨è·¯ç”±ä¸­ä½¿ç”¨çš„å°±æ˜¯Methodå’ŒRequest-URIè¿™ä¸¤ä¸ªéƒ¨åˆ†ã€‚äº†è§£åˆ¶å®šè·¯ç”±è§„åˆ™æ—¶ï¼Œè¯·æ±‚ä½“ä¸­å¯ä»¥ä½¿ç”¨çš„å…ƒç´ ä¹‹åï¼Œæˆ‘ä»¬å†å›ç­”åˆšæ‰çš„é—®é¢˜ï¼Œä»€ä¹ˆæ˜¯è·¯ç”±çš„è®¾è®¡æ„Ÿã€‚</p><p>è¿™é‡Œè¯´çš„è®¾è®¡æ„ŸæŒ‡çš„æ˜¯ï¼š<strong>æ¡†æ¶è®¾è®¡è€…å¸Œæœ›ä½¿ç”¨è€…å¦‚ä½•ç”¨è·¯ç”±æ¨¡å—</strong>ã€‚</p><p>å¦‚æœæ¡†æ¶æ”¯æŒRESTé£æ ¼çš„è·¯ç”±è®¾è®¡ï¼Œé‚£ä¹ˆä½¿ç”¨è€…åœ¨å†™ä¸šåŠ¡ä»£ç çš„æ—¶å€™ï¼Œå°±å€¾å‘äºè®¾è®¡RESTé£æ ¼çš„æ¥å£ï¼›å¦‚æœæ¡†æ¶æ”¯æŒå‰ç¼€åŒ¹é…ï¼Œé‚£ä¹ˆä½¿ç”¨è€…åœ¨å®šåˆ¶URIçš„æ—¶å€™ï¼Œä¹Ÿä¼šå€¾å‘äºæŠŠåŒç±»å‹çš„URIå½’ä¸ºä¸€ç±»ã€‚</p><p>è¿™äº›è®¾è®¡æƒ³æ³•é€šé€šä¼š<strong>ä½“ç°åœ¨æ¡†æ¶çš„è·¯ç”±è§„åˆ™ä¸Šï¼Œæœ€ç»ˆå½±å“æ¡†æ¶ä½¿ç”¨è€…çš„ç ”å‘ä¹ æƒ¯</strong>ï¼Œè¿™ä¸ªå°±æ˜¯è®¾è®¡æ„Ÿã€‚æ‰€ä»¥å…¶å®ï¼Œè®¾è®¡æ„Ÿå’Œæ¡†æ¶è®¾è®¡è€…åå¥½çš„ç ”å‘é£æ ¼ç›´æ¥ç›¸å…³ï¼Œä¹Ÿæ²¡æœ‰ç»å¯¹çš„ä¼˜åŠ£ã€‚</p><p>è¿™é‡Œä½ å¾ˆå®¹æ˜“èµ°å…¥è¯¯åŒºï¼Œæˆ‘è¦è¯´æ˜ä¸€ä¸‹ã€‚å¾ˆå¤šåŒå­¦è®¤ä¸ºè®¾è®¡æ„Ÿçš„å¥½åä½“ç°åœ¨è·¯ç”±è§„åˆ™çš„å¤šå°‘ä¸Šï¼Œå…¶å®ä¸æ˜¯ã€‚</p><p>è·¯ç”±è§„åˆ™ï¼Œæ˜¯æ ¹æ®è·¯ç”±æ¥æŸ¥æ‰¾æ§åˆ¶å™¨çš„é€»è¾‘ï¼Œå®ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ªæ¡†æ¶éœ€æ±‚ã€‚æˆ‘ä»¬å¯ä»¥å¤©é©¬è¡Œç©ºè®¾æƒ³100æ¡è·¯ç”±è§„åˆ™ï¼Œå¹¶ä¸”å…¨éƒ¨å®ç°å®ƒï¼Œä¹Ÿå¯ä»¥åªè®¾è®¡1ã€2ä¸ªæœ€ç®€å•çš„è·¯ç”±è§„åˆ™ã€‚å¾ˆå¤šæˆ–è€…å¾ˆå°‘çš„è·¯ç”±è§„åˆ™ï¼Œéƒ½ä¸ä¼šæ ¹æœ¬æ€§å½±å“ä½¿ç”¨è€…ï¼Œæ‰€ä»¥ï¼Œå¹¶ä¸æ˜¯è¡¡é‡ä¸€ä¸ªæ¡†æ¶å¥½åçš„æ ‡å‡†ã€‚</p><h2>è·¯ç”±è§„åˆ™çš„éœ€æ±‚</h2><p>å›åˆ°æˆ‘ä»¬çš„æ¡†æ¶ï¼Œå¼€å¤´æˆ‘ä»¬è¯´è¿‡å¸Œæœ›ä½¿ç”¨è€…é«˜æ•ˆã€æ˜“ç”¨åœ°ä½¿ç”¨è·¯ç”±æ¨¡å—ï¼Œé‚£å‡ºäºè¿™ä¸€ç‚¹è€ƒè™‘ï¼ŒåŸºæœ¬éœ€æ±‚å¯ä»¥æœ‰å“ªäº›å‘¢ï¼Ÿ</p><p>æŒ‰ç…§ä»ç®€å•åˆ°å¤æ‚æ’åºï¼Œè·¯ç”±éœ€æ±‚æˆ‘æ•´ç†æˆä¸‹é¢å››ç‚¹ï¼š</p><ul>\n<li><strong>éœ€æ±‚1ï¼šHTTPæ–¹æ³•åŒ¹é…</strong></li>\n</ul><p>æ—©æœŸçš„ WebService æ¯”è¾ƒç®€å•ï¼ŒHTTP è¯·æ±‚ä½“ä¸­çš„ Request Line æˆ–è®¸åªä¼šä½¿ç”¨åˆ° Request-URI éƒ¨åˆ†ï¼Œä½†æ˜¯éšç€ REST é£æ ¼ WebService çš„æµè¡Œï¼Œä¸ºäº†è®© URI æ›´å…·å¯è¯»æ€§ï¼Œåœ¨ç°åœ¨çš„è·¯ç”±è¾“å…¥ä¸­ï¼ŒHTTP Method ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ä¸€éƒ¨åˆ†äº†ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬æ¡†æ¶ä¹Ÿéœ€è¦æ”¯æŒå¤šç§ HTTP Methodï¼Œæ¯”å¦‚GETã€POSTã€PUTã€DELETEã€‚</p><ul>\n<li><strong>éœ€æ±‚2ï¼šé™æ€è·¯ç”±åŒ¹é…</strong></li>\n</ul><p>é™æ€è·¯ç”±åŒ¹é…æ˜¯ä¸€ä¸ªè·¯ç”±çš„åŸºæœ¬åŠŸèƒ½ï¼ŒæŒ‡çš„æ˜¯è·¯ç”±è§„åˆ™ä¸­æ²¡æœ‰å¯å˜å‚æ•°ï¼Œå³è·¯ç”±è§„åˆ™åœ°å€æ˜¯å›ºå®šçš„ï¼Œä¸Request-URI å®Œå…¨åŒ¹é…ã€‚</p><p>æˆ‘ä»¬åœ¨ç¬¬ä¸€è®²ä¸­æåˆ°çš„DefaultServerMuxè¿™ä¸ªè·¯ç”±å™¨ï¼Œä»å†…éƒ¨çš„ map ä¸­ç›´æ¥æ ¹æ® key å¯»æ‰¾ value ï¼Œè¿™ç§æŸ¥æ‰¾è·¯ç”±çš„æ–¹å¼å°±æ˜¯é™æ€è·¯ç”±åŒ¹é…ã€‚</p><ul>\n<li><strong>éœ€æ±‚3ï¼šæ‰¹é‡é€šç”¨å‰ç¼€</strong></li>\n</ul><p>å› ä¸ºä¸šåŠ¡æ¨¡å—çš„åˆ’åˆ†ï¼Œæˆ‘ä»¬ä¼šåŒæ—¶ä¸ºæŸä¸ªä¸šåŠ¡æ¨¡å—æ³¨å†Œä¸€æ‰¹è·¯ç”±ï¼Œæ‰€ä»¥åœ¨è·¯ç”±æ³¨å†Œè¿‡ç¨‹ä¸­ï¼Œä¸ºäº†è·¯ç”±çš„å¯è¯»æ€§ï¼Œä¸€èˆ¬ä¹ æƒ¯ç»Ÿä¸€å®šä¹‰è¿™æ‰¹è·¯ç”±çš„é€šç”¨å‰ç¼€ã€‚æ¯”å¦‚ /user/infoã€/user/login éƒ½æ˜¯ä»¥ /user å¼€å¤´ï¼Œå¾ˆæ–¹ä¾¿ä½¿ç”¨è€…äº†è§£é¡µé¢æ‰€å±æ¨¡å—ã€‚</p><p>æ‰€ä»¥å¦‚æœè·¯ç”±æœ‰èƒ½åŠ›ç»Ÿä¸€å®šä¹‰æ‰¹é‡çš„é€šç”¨å‰ç¼€ï¼Œé‚£ä¹ˆåœ¨æ³¨å†Œè·¯ç”±çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå¸¦æ¥å¾ˆå¤§çš„ä¾¿åˆ©ã€‚</p><ul>\n<li><strong>éœ€æ±‚4ï¼šåŠ¨æ€è·¯ç”±åŒ¹é…</strong></li>\n</ul><p>è¿™ä¸ªéœ€æ±‚æ˜¯é’ˆå¯¹éœ€æ±‚2æ”¹è¿›çš„ï¼Œå› ä¸º URL ä¸­æŸä¸ªå­—æ®µæˆ–è€…æŸäº›å­—æ®µå¹¶ä¸æ˜¯å›ºå®šçš„ï¼Œæ˜¯æŒ‰ç…§ä¸€å®šè§„åˆ™ï¼ˆæ¯”å¦‚æ˜¯æ•°å­—ï¼‰å˜åŒ–çš„ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¸Œæœ›è·¯ç”±ä¹Ÿèƒ½å¤Ÿæ”¯æŒè¿™ä¸ªè§„åˆ™ï¼Œå°†è¿™ä¸ªåŠ¨æ€å˜åŒ–çš„è·¯ç”±URLåŒ¹é…å‡ºæ¥ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ï¼Œä½¿ç”¨è‡ªå·±å®šä¹‰çš„è·¯ç”±æ¥è¡¥å……ï¼Œåªæ”¯æŒé™æ€åŒ¹é…çš„DefaultServerMuxé»˜è®¤è·¯ç”±ã€‚</p><p>ç°åœ¨å››ä¸ªæœ€åŸºæœ¬çš„éœ€æ±‚æˆ‘ä»¬å·²ç»æ•´ç†å‡ºæ¥äº†ï¼Œæ¥ä¸‹æ¥é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è§£é‡Šä¸‹ï¼Œæ¯”å¦‚æˆ‘ä»¬éœ€è¦èƒ½å¤Ÿæ”¯æŒä¸€ä¸ªæ—¥å¿—ç½‘ç«™çš„è¿™äº›åŠŸèƒ½ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/dc/62/dc6e322c49be2334954d85b9883d0862.jpg?wh=1920x1080\" alt=\"\"></p><p>æ¥ä¸‹æ¥å°±æ˜¯ä»Šå¤©çš„é‡å¤´æˆäº†ï¼Œè¦åŒ¹é…è¿™æ ·çš„è·¯ç”±åˆ—è¡¨ï¼Œè·¯ç”±è§„åˆ™å®šä¹‰ä»£ç æ€ä¹ˆå†™å‘¢ï¼Ÿæˆ‘æŠŠæœ€ç»ˆçš„ä½¿ç”¨ä»£ç è´´åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥å…ˆçœ‹çœ‹ï¼Œç„¶åæˆ‘ä»¬ä¸€æ­¥æ­¥å®ç°ï¼Œåˆ†ææ¸…æ¥šæ¯è¡Œä»£ç èƒŒåçš„æ–¹æ³•å¦‚ä½•å®šä¹‰ã€ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå®šä¹‰ã€‚</p><pre><code class=\"language-go\">// æ³¨å†Œè·¯ç”±è§„åˆ™\nfunc registerRouter(core *framework.Core) {\n    // éœ€æ±‚1+2:HTTPæ–¹æ³•+é™æ€è·¯ç”±åŒ¹é…\n\tcore.Post(\"/user/login\", UserLoginController)\n    \n    // éœ€æ±‚3:æ‰¹é‡é€šç”¨å‰ç¼€\n  \tsubjectApi := core.Group(\"/subject\")\n\t{\n\t\tsubjectApi.Post(\"/add\", SubjectAddController)\n        // éœ€æ±‚4:åŠ¨æ€è·¯ç”±\n\t\tsubjectApi.Delete(\"/:id\", SubjectDelController)\n\t\tsubjectApi.Put(\"/:id\", SubjectUpdateController)\n\t\tsubjectApi.Get(\"/:id\", SubjectGetController)\n        subjectApi.Get(\"/list/all\", SubjectListController)\n\t}\t\n}\n</code></pre><p>ï¼ˆè¿™æ®µä»£ç ä¼šåœ¨æœ€åè¡¥å……åˆ°ä¸ŠèŠ‚è¯¾ä¸­åˆ›å»ºçš„ä¸šåŠ¡ç›®å½•ä¸­çš„è·¯ç”±æ–‡ä»¶router.goã€‚ï¼‰</p><h2>å®ç°HTTPæ–¹æ³•å’Œé™æ€è·¯ç”±åŒ¹é…</h2><p>æˆ‘ä»¬é¦–å…ˆçœ‹ç¬¬ä¸€ä¸ªéœ€æ±‚å’Œç¬¬äºŒä¸ªéœ€æ±‚ã€‚ç”±äºæœ‰ä¸¤ä¸ªå¾…åŒ¹é…çš„è§„åˆ™ï¼ŒRequest-URI å’Œ Methodï¼Œæ‰€ä»¥è‡ªç„¶è”æƒ³åˆ°å¯ä»¥ä½¿ç”¨ä¸¤çº§å“ˆå¸Œè¡¨æ¥åˆ›å»ºæ˜ å°„ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/13/dc/13377ea20d08bcf39b3f1b735eca83dc.jpg?wh=1920x1232\" alt=\"\"><br>\nç¬¬ä¸€çº§hashæ˜¯è¯·æ±‚Methodï¼Œç¬¬äºŒçº§hashæ˜¯Request-URIã€‚</p><p>è¿™ä¸ªè·¯ç”±mapæˆ‘ä»¬ä¼šå­˜æ”¾åœ¨ç¬¬ä¸€è®²å®šä¹‰çš„Coreç»“æ„é‡Œï¼ˆå¦‚ä¸‹ï¼‰ï¼Œå¹¶ä¸”åœ¨åˆå§‹åŒ– Core ç»“æ„çš„æ—¶å€™ï¼Œåˆå§‹åŒ–ç¬¬ä¸€å±‚mapã€‚æ‰€ä»¥è¿˜æ˜¯æ‹‰å‡º<a href=\"https://github.com/gohade/coredemo/blob/geekbang/03/framework/core.go\">geekbang/03åˆ†æ”¯</a>ï¼Œæ¥æ›´æ–°æ¡†æ¶æ–‡ä»¶å¤¹ä¸­çš„core.go æ–‡ä»¶ï¼š</p><pre><code class=\"language-go\">// æ¡†æ¶æ ¸å¿ƒç»“æ„\ntype Core struct {\n}\n\n// åˆå§‹åŒ–æ¡†æ¶æ ¸å¿ƒç»“æ„\nfunc NewCore() *Core {\n\treturn &amp;Core{}\n}\n\n// æ¡†æ¶æ ¸å¿ƒç»“æ„å®ç°Handleræ¥å£\nfunc (c *Core) ServeHTTP(response http.ResponseWriter, request *http.Request) {\n\t// TODO\n}\n</code></pre><p>æ¥ä¸‹æ¥æˆ‘ä»¬æŒ‰æ¡†æ¶ä½¿ç”¨è€…ä½¿ç”¨è·¯ç”±çš„é¡ºåºåˆ†æˆå››æ­¥æ¥å®Œå–„è¿™ä¸ªç»“æ„ï¼š<strong>å®šä¹‰è·¯ç”±mapã€æ³¨å†Œè·¯ç”±ã€åŒ¹é…è·¯ç”±ã€å¡«å……ServeHTTP æ–¹æ³•</strong>ã€‚</p><p>é¦–å…ˆï¼Œç¬¬ä¸€å±‚map çš„æ¯ä¸ªkeyå€¼éƒ½ä»£è¡¨Methodï¼Œè€Œä¸”ä¸ºäº†é¿å…ä¹‹ååœ¨åŒ¹é…çš„æ—¶å€™ï¼Œè¦è½¬æ¢ä¸€æ¬¡å¤§å°å†™ï¼Œæˆ‘ä»¬å°†æ¯ä¸ªkeyéƒ½è®¾ç½®ä¸ºå¤§å†™ã€‚ç»§ç»­åœ¨æ¡†æ¶æ–‡ä»¶å¤¹ä¸­çš„core.go æ–‡ä»¶é‡Œå†™ï¼š</p><pre><code class=\"language-go\">// æ¡†æ¶æ ¸å¿ƒç»“æ„\ntype Core struct {\n\trouter map[string]map[string]ControllerHandler // äºŒçº§map\n}\n\n// åˆå§‹åŒ–æ¡†æ¶æ ¸å¿ƒç»“æ„\nfunc NewCore() *Core {\n    // å®šä¹‰äºŒçº§map\n\tgetRouter := map[string]ControllerHandler{}\n\tpostRouter := map[string]ControllerHandler{}\n\tputRouter := map[string]ControllerHandler{}\n\tdeleteRouter := map[string]ControllerHandler{}\n\n    // å°†äºŒçº§mapå†™å…¥ä¸€çº§map\n\trouter := map[string]map[string]ControllerHandler{}\n\trouter[\"GET\"] = getRouter\n\trouter[\"POST\"] = postRouter\n\trouter[\"PUT\"] = putRouter\n\trouter[\"DELETE\"] = deleteRouter\n\n\treturn &amp;Core{router: router}\n}\n</code></pre><p>ä¸‹ä¸€æ­¥å°±æ˜¯è·¯ç”±æ³¨å†Œï¼Œæˆ‘ä»¬å°†è·¯ç”±æ³¨å†Œå‡½æ•°æŒ‰ç…§Methodåæ‹†åˆ†ä¸º4ä¸ªæ–¹æ³•ï¼šGetã€Postã€Putå’ŒDeleteã€‚</p><pre><code class=\"language-go\">// å¯¹åº” Method = Get\nfunc (c *Core) Get(url string, handler ControllerHandler) {\n\tupperUrl := strings.ToUpper(url)\n\tc.router[\"GET\"][upperUrl] = handler\n}\n\n// å¯¹åº” Method = POST\nfunc (c *Core) Post(url string, handler ControllerHandler) {\n\tupperUrl := strings.ToUpper(url)\n\tc.router[\"POST\"][upperUrl] = handler\n}\n\n// å¯¹åº” Method = PUT\nfunc (c *Core) Put(url string, handler ControllerHandler) {\n\tupperUrl := strings.ToUpper(url)\n\tc.router[\"PUT\"][upperUrl] = handler\n}\n\n// å¯¹åº” Method = DELETE\nfunc (c *Core) Delete(url string, handler ControllerHandler) {\n\tupperUrl := strings.ToUpper(url)\n\tc.router[\"DELETE\"][upperUrl] = handler\n}\n</code></pre><p>æˆ‘ä»¬è¿™é‡Œå°†URLå…¨éƒ¨è½¬æ¢ä¸ºå¤§å†™äº†ï¼Œ<strong>åœ¨åç»­åŒ¹é…è·¯ç”±çš„æ—¶å€™ï¼Œä¹Ÿè¦è®°å¾—æŠŠåŒ¹é…çš„URLè¿›è¡Œå¤§å†™è½¬æ¢</strong>ï¼Œè¿™æ ·æˆ‘ä»¬çš„è·¯ç”±å°±ä¼šæ˜¯â€œå¤§å°å†™ä¸æ•æ„Ÿâ€çš„ï¼Œå¯¹ä½¿ç”¨è€…çš„å®¹é”™æ€§å°±å¤§å¤§å¢åŠ äº†ã€‚</p><p>æ³¨å†Œå®Œè·¯ç”±ä¹‹åï¼Œå¦‚ä½•åŒ¹é…è·¯ç”±å°±æ˜¯æˆ‘ä»¬ç¬¬ä¸‰æ­¥éœ€è¦åšçš„äº‹æƒ…äº†ã€‚é¦–å…ˆæˆ‘ä»¬å®ç°åŒ¹é…è·¯ç”±æ–¹æ³•ï¼Œè¿™ä¸ªåŒ¹é…è·¯ç”±çš„é€»è¾‘æˆ‘ç”¨æ³¨é‡Šå†™åœ¨ä»£ç ä¸­äº†ã€‚ç»§ç»­åœ¨æ¡†æ¶æ–‡ä»¶å¤¹ä¸­çš„core.go æ–‡ä»¶é‡Œå†™å…¥ï¼š</p><pre><code class=\"language-go\">// åŒ¹é…è·¯ç”±ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…åˆ°ï¼Œè¿”å›nil\nfunc (c *Core) FindRouteByRequest(request *http.Request) ControllerHandler {\n\t// uri å’Œ method å…¨éƒ¨è½¬æ¢ä¸ºå¤§å†™ï¼Œä¿è¯å¤§å°å†™ä¸æ•æ„Ÿ\n\turi := request.URL.Path\n\tmethod := request.Method\n\tupperMethod := strings.ToUpper(method)\n\tupperUri := strings.ToUpper(uri)\n\n\t// æŸ¥æ‰¾ç¬¬ä¸€å±‚map\n\tif methodHandlers, ok := c.router[upperMethod]; ok {\n\t\t// æŸ¥æ‰¾ç¬¬äºŒå±‚map\n\t\tif handler, ok := methodHandlers[upperUri]; ok {\n\t\t\treturn handler\n\t\t}\n\t}\n\treturn nil\n}\n</code></pre><p>ä»£ç å¾ˆå®¹æ˜“çœ‹æ‡‚ï¼ŒåŒ¹é…é€»è¾‘å°±æ˜¯å»äºŒå±‚å“ˆå¸Œmapä¸­ä¸€å±‚å±‚åŒ¹é…ï¼Œå…ˆæŸ¥æ‰¾ç¬¬ä¸€å±‚åŒ¹é…Methodï¼Œå†æŸ¥ç¬¬äºŒå±‚åŒ¹é…Request-URIã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¡«å……æœªå®ç°çš„ ServeHTTP æ–¹æ³•äº†ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¼šè¿›åˆ°è¿™ä¸ªå‡½æ•°ä¸­å¤„ç†ã€‚ï¼ˆå¦‚æœä½ æœ‰ç‚¹æ¨¡ç³Šäº†ï¼Œå¯ä»¥æ‹¿å‡ºç¬¬ä¸€èŠ‚è¯¾ä¸­çš„æ€ç»´å¯¼å›¾ï¼Œå†å·©å›ºä¸‹ net/http çš„æ ¸å¿ƒé€»è¾‘ã€‚ï¼‰ç»§ç»­åœ¨æ¡†æ¶æ–‡ä»¶å¤¹ä¸­çš„core.go æ–‡ä»¶é‡Œå†™ï¼š</p><pre><code class=\"language-go\">func (c *Core) ServeHTTP(response http.ResponseWriter, request *http.Request) {\n\n\t// å°è£…è‡ªå®šä¹‰context\n\tctx := NewContext(request, response)\n\n\t// å¯»æ‰¾è·¯ç”±\n\trouter := c.FindRouteByRequest(request)\n\tif router == nil {\n\t\t// å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œè¿™é‡Œæ‰“å°æ—¥å¿—\n\t\tctx.Json(404, \"not found\")\n\t\treturn\n\t}\n\n\t// è°ƒç”¨è·¯ç”±å‡½æ•°ï¼Œå¦‚æœè¿”å›err ä»£è¡¨å­˜åœ¨å†…éƒ¨é”™è¯¯ï¼Œè¿”å›500çŠ¶æ€ç \n\tif err := router(ctx); err != nil {\n\t\tctx.Json(500, \"inner error\")\n\t\treturn\n\t}\n}\n</code></pre><p>è¿™ä¸ªå‡½æ•°å°±æŠŠæˆ‘ä»¬å‰é¢ä¸‰è®²çš„å†…å®¹éƒ½ä¸²èµ·æ¥äº†ã€‚å…ˆå°è£…ç¬¬äºŒè®²åˆ›å»ºçš„è‡ªå®šä¹‰Contextï¼Œç„¶åä½¿ç”¨ FindRouteByRequest å‡½æ•°å¯»æ‰¾æˆ‘ä»¬éœ€è¦çš„è·¯ç”±ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°è·¯ç”±ï¼Œè¿”å›404çŠ¶æ€ç ï¼›å¦‚æœæ‰¾åˆ°äº†è·¯ç”±ï¼Œå°±è°ƒç”¨è·¯ç”±æ§åˆ¶å™¨ï¼Œå¦å¤–å¦‚æœè·¯ç”±æ§åˆ¶å™¨å‡ºç°å†…éƒ¨é”™è¯¯ï¼Œè¿”å›500çŠ¶æ€ç ã€‚</p><p>åˆ°è¿™é‡Œï¼Œç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªéœ€æ±‚å°±éƒ½å®Œæˆäº†ã€‚</p><h2>å®ç°æ‰¹é‡é€šç”¨å‰ç¼€</h2><p>å¯¹äºç¬¬ä¸‰ä¸ªéœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ª Group æ–¹æ³•å½’æ‹¢è·¯ç”±å‰ç¼€åœ°å€ã€‚ä¿®æ­£åœ¨ä¸šåŠ¡æ–‡ä»¶å¤¹ä¸‹çš„route.goæ–‡ä»¶ï¼Œä½¿ç”¨æ–¹æ³•æ”¹æˆè¿™æ ·ï¼š</p><pre><code class=\"language-go\">// æ³¨å†Œè·¯ç”±è§„åˆ™\nfunc registerRouter(core *framework.Core) {\n\t// éœ€æ±‚1+2:HTTPæ–¹æ³•+é™æ€è·¯ç”±åŒ¹é…\n\tcore.Get(\"/user/login\", UserLoginController)\n\n\t// éœ€æ±‚3:æ‰¹é‡é€šç”¨å‰ç¼€\n\tsubjectApi := core.Group(\"/subject\")\n\t{\n\t\tsubjectApi.Get(\"/list\", SubjectListController)\n\t}\n}\n</code></pre><p>çœ‹ä¸‹è¿™ä¸ªGroupæ–¹æ³•ï¼Œå®ƒçš„å‚æ•°æ˜¯ä¸€ä¸ªå‰ç¼€å­—ç¬¦ä¸²ï¼Œè¿”å›å€¼åº”è¯¥æ˜¯åŒ…å«Getã€Postã€Putã€Delete æ–¹æ³•çš„ä¸€ä¸ªç»“æ„ï¼Œæˆ‘ä»¬ç»™è¿™ä¸ªç»“æ„å‘½åGroupï¼Œåœ¨å…¶ä¸­å®ç°å„ç§æ–¹æ³•ã€‚</p><p>åœ¨è¿™é‡Œæˆ‘ä»¬æš‚åœä¸€ä¸‹ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰ä¼˜åŒ–ç‚¹ã€‚</p><p>è¿™ä¹ˆè®¾è®¡ç›´æ¥è¿”å› Group ç»“æ„ï¼Œç¡®å®å¯ä»¥å®ç°åŠŸèƒ½ï¼Œä½†è¯•æƒ³ä¸€ä¸‹ï¼Œéšç€æ¡†æ¶å‘å±•ï¼Œå¦‚æœæˆ‘ä»¬å‘ç°Groupç»“æ„çš„å…·ä½“å®ç°å¹¶ä¸ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚äº†ï¼Œéœ€è¦å¼•å…¥å®ç°å¦ä¸€ä¸ªGroup2ç»“æ„ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿç›´æ¥ä¿®æ”¹Groupç»“æ„çš„å…·ä½“å®ç°ä¹ˆï¼Ÿ<img src=\"https://static001.geekbang.org/resource/image/b4/ef/b40828bd1dbc2651dc649ac5ecd29fef.jpg?wh=1920x1080\" alt=\"\"></p><p><strong>å…¶å®æ›´å¥½çš„åŠæ³•æ˜¯ä½¿ç”¨æ¥å£æ¥æ›¿ä»£ç»“æ„å®šä¹‰</strong>ã€‚åœ¨æ¡†æ¶è®¾è®¡ä¹‹åˆï¼Œæˆ‘ä»¬è¦ä¿è¯æ¡†æ¶ä½¿ç”¨è€…ï¼Œåœ¨æœ€å°‘çš„æ”¹åŠ¨ä¸­ï¼Œå°±èƒ½æµç•…è¿ç§»åˆ°Group2ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœè¿”å›æ¥å£ IGroupï¼Œè€Œä¸æ˜¯ç›´æ¥è¿”å› Group ç»“æ„ï¼Œå°±ä¸éœ€è¦ä¿®æ”¹core.Groupçš„å®šä¹‰äº†ï¼Œåªéœ€è¦ä¿®æ”¹core.Groupçš„å…·ä½“å®ç°ï¼Œè¿”å›Group2å°±å¯ä»¥ã€‚<br>\n<img src=\"https://static001.geekbang.org/resource/image/2a/9b/2a969d91845f3fe1f8afd0144273509b.jpg?wh=1920x1080\" alt=\"\"><br>\nå°½é‡ä½¿ç”¨æ¥å£æ¥è§£è€¦åˆï¼Œæ˜¯ä¸€ç§æ¯”è¾ƒå¥½çš„è®¾è®¡æ€è·¯ã€‚</p><p>æ€ä¹ˆå®ç°å‘¢ï¼Œè¿™é‡Œæˆ‘ä»¬å®šä¹‰ IGroup æ¥å£æ¥ä½œä¸ºGroupæ–¹æ³•çš„è¿”å›å€¼ã€‚åœ¨æ¡†æ¶æ–‡ä»¶å¤¹ä¸‹åˆ›å»º<a href=\"https://github.com/gohade/coredemo/blob/geekbang/03/framework/group.go\">group.goæ–‡ä»¶</a>æ¥å­˜æ”¾åˆ†ç»„ç›¸å…³çš„ä¿¡æ¯ï¼š</p><pre><code class=\"language-go\">// IGroup ä»£è¡¨å‰ç¼€åˆ†ç»„\ntype IGroup interface {\n\tGet(string, ControllerHandler)\n\tPost(string, ControllerHandler)\n\tPut(string, ControllerHandler)\n\tDelete(string, ControllerHandler)\n}\n</code></pre><p>å¹¶ä¸”ç»§ç»­æ­å¥½Group ç»“æ„ä»£ç æ¥å®ç°è¿™ä¸ªæ¥å£ï¼š</p><pre><code class=\"language-go\">// Group struct å®ç°äº†IGroup\ntype Group struct {\n\tcore&nbsp; &nbsp;*Core\n\tprefix string\n}\n\n// åˆå§‹åŒ–Group\nfunc NewGroup(core *Core, prefix string) *Group {\n\treturn &amp;Group{\n\t\tcore:&nbsp; &nbsp;core,\n\t\tprefix: prefix,\n\t}\n}\n\n// å®ç°Getæ–¹æ³•\nfunc (g *Group) Get(uri string, handler ControllerHandler) {\n\turi = g.prefix + uri\n\tg.core.Get(uri, handler)\n}\n\n....\n\n// ä»coreä¸­åˆå§‹åŒ–è¿™ä¸ªGroup\nfunc (c *Core) Group(prefix string) IGroup {\n\treturn NewGroup(c, prefix)\n}\n</code></pre><p>è¿™ä¸ª Group ç»“æ„åŒ…å«è‡ªèº«çš„å‰ç¼€åœ°å€å’ŒCoreç»“æ„çš„æŒ‡é’ˆã€‚å®ƒçš„ Getã€Putã€Postã€Delete æ–¹æ³•å°±æ˜¯æŠŠè¿™ä¸ªGroupç»“æ„çš„å‰ç¼€åœ°å€å’Œç›®æ ‡åœ°å€ç»„åˆèµ·æ¥ï¼Œä½œä¸ºCoreçš„Request-URIåœ°å€ã€‚<img src=\"https://static001.geekbang.org/resource/image/b5/f8/b5f6f18b380db972600032dcc97dfff8.jpg?wh=1920x1080\" alt=\"\"></p><p>è®²åˆ°è¿™é‡Œï¼Œæœ‰çš„åŒå­¦å¯èƒ½ä¸ä»¥ä¸ºç„¶ï¼Œè§‰å¾—è¿™ä¸å°±æ˜¯ä¸ªäººä»£ç é£æ ¼çš„é—®é¢˜å—ã€‚å…¶å®å¹¶ä¸æ˜¯ï¼Œå¸Œæœ›ä½ èƒ½å¤Ÿæ„è¯†åˆ°ï¼Œè¿™ä¸ªé€‰æ‹©å¹¶ä¸ä»…ä»…æ˜¯ä»£ç é£æ ¼ï¼Œè€Œæ˜¯å…³äºæ¡†æ¶è®¾è®¡ã€å…³äºä»£ç æ‰©å±•æ€§ã€‚</p><p>æ¥å£æ˜¯ä¸€ç§åè®®ï¼Œå®ƒå¿½ç•¥å…·ä½“çš„å®ç°ï¼Œå®šä¹‰çš„æ˜¯ä¸¤ä¸ªé€»è¾‘ç»“æ„çš„äº¤äº’ï¼Œå› ä¸ºä¸¤ä¸ªå‡½æ•°ä¹‹é—´å®šä¹‰çš„æ˜¯ä¸€ç§çº¦å®šï¼Œä¸ä¾èµ–å…·ä½“çš„å®ç°ã€‚</p><p>ä½ å¯ä»¥è¿™ä¹ˆåˆ¤æ–­ï¼š<strong>å¦‚æœä½ è§‰å¾—è¿™ä¸ªæ¨¡å—æ˜¯å®Œæ•´çš„ï¼Œè€Œä¸”åç»­å¸Œæœ›æœ‰æ‰©å±•çš„å¯èƒ½æ€§ï¼Œé‚£ä¹ˆå°±åº”è¯¥å°½é‡ä½¿ç”¨æ¥å£æ¥æ›¿ä»£å®ç°</strong>ã€‚åœ¨ä»£ç ä¸­ï¼Œå¤šå¤§ç¨‹åº¦ä½¿ç”¨æ¥å£è¿›è¡Œé€»è¾‘ç»“æ„çš„äº¤äº’ï¼Œæ˜¯è¯„ä»·æ¡†æ¶ä»£ç å¯æ‰©å±•æ€§çš„ä¸€ä¸ªå¾ˆå¥½çš„æ ‡å‡†ã€‚è¿™ç§æ€ç»´ä¼šè´¯ç©¿åœ¨æˆ‘ä»¬æ•´ä¸ªæ¡†æ¶çš„è®¾è®¡ä¸­ï¼Œåç»­æˆ‘ä¼šæ—¶ä¸æ—¶å†æèµ·çš„ã€‚</p><p>æ‰€ä»¥å›åˆ°æˆ‘ä»¬çš„è·¯ç”±ï¼Œä½¿ç”¨IGroupæ¥å£åï¼Œcore.Group è¿™ä¸ªæ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªçº¦å®šï¼Œè€Œä¸ä¾èµ–å…·ä½“çš„Groupå®ç°ã€‚</p><h2>å®ç°åŠ¨æ€è·¯ç”±åŒ¹é…</h2><p>ç°åœ¨å·²ç»å®Œæˆäº†å‰ä¸‰ä¸ªéœ€æ±‚ï¼Œä¸‹é¢æˆ‘ä»¬è€ƒè™‘ç¬¬å››ä¸ªéœ€æ±‚ï¼Œå¸Œæœ›åœ¨å†™ä¸šåŠ¡çš„æ—¶å€™èƒ½æ”¯æŒåƒä¸‹åˆ—è¿™ç§åŠ¨æ€è·¯ç”±ï¼š</p><pre><code class=\"language-go\">func registerRouter(core *framework.Core) {\n\t// éœ€æ±‚1+2:HTTPæ–¹æ³•+é™æ€è·¯ç”±åŒ¹é…\n\tcore.Get(\"/user/login\", UserLoginController)\n\n\t// éœ€æ±‚3:æ‰¹é‡é€šç”¨å‰ç¼€\n\tsubjectApi := core.Group(\"/subject\")\n\t{\n\t\t// éœ€æ±‚4:åŠ¨æ€è·¯ç”±\n\t\tsubjectApi.Delete(\"/:id\", SubjectDelController)\n\t\tsubjectApi.Put(\"/:id\", SubjectUpdateController)\n\t\tsubjectApi.Get(\"/:id\", SubjectGetController)\n\t\tsubjectApi.Get(\"/list/all\", SubjectListController)\n\t}\n}\n</code></pre><p>å¦‚ä½•å®ç°ï¼Ÿæˆ‘ä»¬ç»§ç»­çœ‹ã€‚</p><p>é¦–å…ˆï¼Œä½ è¦çŸ¥é“çš„æ˜¯ï¼Œ<strong>ä¸€æ—¦å¼•å…¥äº†åŠ¨æ€è·¯ç”±åŒ¹é…çš„è§„åˆ™ï¼Œä¹‹å‰ä½¿ç”¨çš„å“ˆå¸Œè§„åˆ™å°±æ— æ³•ä½¿ç”¨äº†</strong>ã€‚å› ä¸ºæœ‰é€šé…ç¬¦ï¼Œåœ¨åŒ¹é…Request-URIçš„æ—¶å€™ï¼Œè¯·æ±‚URIçš„æŸä¸ªå­—ç¬¦æˆ–è€…æŸäº›å­—ç¬¦æ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œæ— æ³•ä½¿ç”¨URIåšä¸ºkeyæ¥åŒ¹é…ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±éœ€è¦å…¶ä»–çš„ç®—æ³•æ¥æ”¯æŒè·¯ç”±åŒ¹é…ã€‚</p><p>å¦‚æœä½ å¯¹ç®—æ³•æ¯”è¾ƒç†Ÿæ‚‰ï¼Œä¼šè”æƒ³åˆ°<strong>è¿™ä¸ªé—®é¢˜æœ¬è´¨æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²åŒ¹é…</strong>ï¼Œè€Œå­—ç¬¦ä¸²åŒ¹é…ï¼Œæ¯”è¾ƒé€šç”¨çš„é«˜æ•ˆæ–¹æ³•å°±æ˜¯å­—å…¸æ ‘ï¼Œä¹Ÿå«trieæ ‘ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆç®€å•æ¢³ç†ä¸‹trieæ ‘çš„æ•°æ®ç»“æ„ã€‚trieæ ‘ä¸åŒäºäºŒå‰æ ‘ï¼Œå®ƒæ˜¯å¤šå‰çš„æ ‘å½¢ç»“æ„ï¼Œæ ¹èŠ‚ç‚¹ä¸€èˆ¬æ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œè€Œå¶å­èŠ‚ç‚¹ä¿å­˜çš„é€šå¸¸æ˜¯å­—ç¬¦ä¸²ï¼Œä¸€ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰å­å­™èŠ‚ç‚¹éƒ½æœ‰ç›¸åŒçš„å­—ç¬¦ä¸²å‰ç¼€ã€‚</p><p>æ‰€ä»¥æ ¹æ®trieæ ‘çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬ç»“åˆå‰ä¸‰æ¡è·¯ç”±è§„åˆ™ï¼Œå¯ä»¥æ„å»ºå‡ºè¿™æ ·çš„ç»“æ„ï¼š</p><pre><code class=\"language-go\">1 /user/login\n2 /user/logout\n3 /subject/name\n4 /subject/name/age\n5 /subject/:id/name\n</code></pre><p>ç”»æˆå›¾æ›´æ¸…æ™°ä¸€äº›ï¼š<img src=\"https://static001.geekbang.org/resource/image/68/98/6837822864392bbb5e7345518448b098.jpg?wh=1920x1080\" alt=\"\"></p><p>è¿™ä¸ªtrieæ ‘æ˜¯æŒ‰ç…§è·¯ç”±åœ°å€çš„æ¯ä¸ªæ®µ(segment)æ¥åˆ‡åˆ†çš„ï¼Œæ¯ä¸ªsegmentåœ¨trieæ ‘ä¸­éƒ½èƒ½æ‰¾åˆ°å¯¹åº”èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¿å­˜ä¸€ä¸ªsegmentã€‚æ ‘ä¸­ï¼Œæ¯ä¸ªå¶å­èŠ‚ç‚¹éƒ½ä»£è¡¨ä¸€ä¸ªURIï¼Œå¯¹äºä¸­é—´èŠ‚ç‚¹æ¥è¯´ï¼Œæœ‰çš„ä¸­é—´èŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªURIï¼ˆæ¯”å¦‚ä¸Šå›¾ä¸­çš„ /subject/nameï¼‰ï¼Œè€Œæœ‰çš„ä¸­é—´èŠ‚ç‚¹å¹¶ä¸æ˜¯ä¸€ä¸ªURIï¼ˆå› ä¸ºæ²¡æœ‰è·¯ç”±è§„åˆ™å¯¹åº”è¿™ä¸ªURIï¼‰ã€‚</p><p>ç°åœ¨åˆ†ææ¸…æ¥šäº†ï¼Œæˆ‘ä»¬å¼€å§‹åŠ¨æ‰‹å®ç°trieæ ‘ã€‚è¿˜æ˜¯ç…§æ—§å…ˆæ˜ç¡®ä¸‹å¯ä»¥åˆ†ä¸ºå‡ æ­¥ï¼š</p><ol>\n<li>å®šä¹‰æ ‘å’ŒèŠ‚ç‚¹çš„æ•°æ®ç»“æ„</li>\n<li>ç¼–å†™å‡½æ•°ï¼šâ€œå¢åŠ è·¯ç”±è§„åˆ™â€</li>\n<li>ç¼–å†™å‡½æ•°ï¼šâ€œæŸ¥æ‰¾è·¯ç”±â€</li>\n<li>å°†â€œå¢åŠ è·¯ç”±è§„åˆ™â€å’Œâ€œæŸ¥æ‰¾è·¯ç”±â€æ·»åŠ åˆ°æ¡†æ¶ä¸­</li>\n</ol><p>æ­¥éª¤éå¸¸æ¸…æ™°ï¼Œå¥½ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥ï¼Œé¦–å…ˆå®šä¹‰å¯¹åº”çš„æ•°æ®ç»“æ„ï¼ˆnode å’Œ treeï¼‰ã€‚å…ˆåœ¨æ¡†æ¶æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºtree.goæ–‡ä»¶ï¼Œå­˜å‚¨trieæ ‘ç›¸å…³é€»è¾‘ï¼š</p><pre><code class=\"language-go\">// ä»£è¡¨æ ‘ç»“æ„\ntype Tree struct {\n\troot *node // æ ¹èŠ‚ç‚¹\n}\n\n// ä»£è¡¨èŠ‚ç‚¹\ntype node struct {\n\tisLast&nbsp; bool&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // ä»£è¡¨è¿™ä¸ªèŠ‚ç‚¹æ˜¯å¦å¯ä»¥æˆä¸ºæœ€ç»ˆçš„è·¯ç”±è§„åˆ™ã€‚è¯¥èŠ‚ç‚¹æ˜¯å¦èƒ½æˆä¸ºä¸€ä¸ªç‹¬ç«‹çš„uri, æ˜¯å¦è‡ªèº«å°±æ˜¯ä¸€ä¸ªç»ˆæèŠ‚ç‚¹\n\tsegment string&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // uriä¸­çš„å­—ç¬¦ä¸²ï¼Œä»£è¡¨è¿™ä¸ªèŠ‚ç‚¹è¡¨ç¤ºçš„è·¯ç”±ä¸­æŸä¸ªæ®µçš„å­—ç¬¦ä¸²\n\thandler ControllerHandler // ä»£è¡¨è¿™ä¸ªèŠ‚ç‚¹ä¸­åŒ…å«çš„æ§åˆ¶å™¨ï¼Œç”¨äºæœ€ç»ˆåŠ è½½è°ƒç”¨\n\tchilds&nbsp; []*node&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// ä»£è¡¨è¿™ä¸ªèŠ‚ç‚¹ä¸‹çš„å­èŠ‚ç‚¹\n}\n</code></pre><p>Treeç»“æ„ä¸­åŒ…å«ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œåªæ˜¯è¿™ä¸ªæ ¹èŠ‚ç‚¹æ˜¯ä¸€ä¸ªæ²¡æœ‰segmentçš„ç©ºçš„æ ¹èŠ‚ç‚¹ã€‚</p><p>nodeçš„ç»“æ„å®šä¹‰äº†å››ä¸ªå­—æ®µã€‚childså­—æ®µè®©nodeç»„æˆäº†ä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼Œhandleræ˜¯å…·ä½“çš„ä¸šåŠ¡æ§åˆ¶å™¨é€»è¾‘å­˜æ”¾ä½ç½®ï¼Œsegmentæ˜¯æ ‘ä¸­çš„è¿™ä¸ªèŠ‚ç‚¹å­˜æ”¾çš„å†…å®¹ï¼ŒisLastç”¨äºåŒºåˆ«è¿™ä¸ªæ ‘ä¸­çš„èŠ‚ç‚¹æ˜¯å¦æœ‰å®é™…çš„è·¯ç”±å«ä¹‰ã€‚</p><p>æœ‰äº†æ•°æ®ç»“æ„åï¼Œç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬å°±å¾€Treeè¿™ä¸ªtrieæ ‘ç»“æ„ä¸­å¢åŠ â€œè·¯ç”±è§„åˆ™â€çš„é€»è¾‘ã€‚å†™ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜æ˜¯æš‚åœä¸€ä¸‹æƒ³ä¸€æƒ³ï¼Œä¼šä¸ä¼šå‡ºç°é—®é¢˜ã€‚<strong>ä¹‹å‰æè¿‡ä¼šå­˜åœ¨é€šé…ç¬¦ï¼Œé‚£ç›´æ¥åŠ è§„åˆ™å…¶å®æ˜¯æœ‰å¯èƒ½å†²çªçš„</strong>ã€‚æ¯”å¦‚ï¼š</p><pre><code class=\"language-go\">/user/name\n/user/:id\n</code></pre><p>è¿™ä¸¤ä¸ªè·¯ç”±è§„åˆ™å®é™…ä¸Šå°±å†²çªäº†ï¼Œå¦‚æœè¯·æ±‚åœ°å€æ˜¯/user/nameï¼Œé‚£ä¹ˆä¸¤ä¸ªè§„åˆ™éƒ½åŒ¹é…ï¼Œæ— æ³•ç¡®å®šå“ªä¸ªè§„åˆ™ç”Ÿæ•ˆã€‚æ‰€ä»¥åœ¨å¢åŠ è·¯ç”±ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­è¿™ä¸ªè·¯ç”±è§„åˆ™æ˜¯å¦å·²ç»åœ¨trieæ ‘ä¸­å­˜åœ¨äº†ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ç”¨matchNodeæ–¹æ³•ï¼Œå¯»æ‰¾æŸä¸ªè·¯ç”±åœ¨trieæ ‘ä¸­åŒ¹é…çš„èŠ‚ç‚¹ï¼Œå¦‚æœæœ‰åŒ¹é…èŠ‚ç‚¹ï¼Œè¿”å›èŠ‚ç‚¹æŒ‡é’ˆï¼Œå¦åˆ™è¿”å›nilã€‚<strong>matchNodeæ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªURIï¼Œè¿”å›å€¼æ˜¯æŒ‡å‘nodeçš„æŒ‡é’ˆï¼Œå®ƒçš„å®ç°æ€è·¯æ˜¯ä½¿ç”¨å‡½æ•°é€’å½’</strong>ï¼Œæˆ‘ç®€å•è¯´æ˜ä¸€ä¸‹æ€è·¯ï¼š</p><p>é¦–å…ˆï¼Œå°†éœ€è¦åŒ¹é…çš„URIæ ¹æ®ç¬¬ä¸€ä¸ªåˆ†éš”ç¬¦/è¿›è¡Œåˆ†å‰²ï¼Œåªéœ€è¦æœ€å¤šåˆ†å‰²æˆä¸ºä¸¤ä¸ªæ®µã€‚</p><p>å¦‚æœåªèƒ½åˆ†å‰²æˆä¸€ä¸ªæ®µï¼Œè¯´æ˜URIä¸­æ²¡æœ‰åˆ†éš”ç¬¦äº†ï¼Œè¿™æ—¶å€™å†æ£€æŸ¥ä¸‹ä¸€çº§èŠ‚ç‚¹ä¸­æ˜¯å¦æœ‰åŒ¹é…è¿™ä¸ªæ®µçš„èŠ‚ç‚¹å°±è¡Œã€‚</p><p>å¦‚æœåˆ†å‰²æˆäº†ä¸¤ä¸ªæ®µï¼Œæˆ‘ä»¬ç”¨ç¬¬ä¸€ä¸ªæ®µæ¥æ£€æŸ¥ä¸‹ä¸€ä¸ªçº§èŠ‚ç‚¹ä¸­æ˜¯å¦æœ‰åŒ¹é…è¿™ä¸ªæ®µçš„èŠ‚ç‚¹ã€‚</p><ul>\n<li>å¦‚æœæ²¡æœ‰ï¼Œè¯´æ˜è¿™ä¸ªè·¯ç”±è§„åˆ™åœ¨æ ‘ä¸­åŒ¹é…ä¸åˆ°ã€‚</li>\n<li>å¦‚æœä¸‹ä¸€çº§èŠ‚ç‚¹ä¸­æœ‰ç¬¦åˆç¬¬ä¸€ä¸ªåˆ†å‰²æ®µçš„ï¼ˆè¿™é‡Œéœ€è¦æ³¨æ„å¯èƒ½ä¸æ­¢ä¸€ä¸ªç¬¦åˆï¼‰ï¼Œæˆ‘ä»¬å°±å°†æ‰€æœ‰ç¬¦åˆçš„èŠ‚ç‚¹è¿›è¡Œå‡½æ•°é€’å½’ï¼Œé‡æ–°åº”ç”¨äºmatchNodeå‡½æ•°ä¸­ï¼Œåªä¸è¿‡è¿™æ—¶å€™matchNodeå‡½æ•°ä½œç”¨äºå­èŠ‚ç‚¹ï¼Œå‚æ•°å˜æˆäº†åˆ‡å‰²åçš„ç¬¬äºŒä¸ªæ®µã€‚</li>\n</ul><p>å¥½æ€è·¯å°±è®²å®Œäº†ï¼Œæ•´ä¸ªæµç¨‹é‡Œï¼Œä¼šé¢‘ç¹ä½¿ç”¨åˆ°â€œè¿‡æ»¤ä¸‹ä¸€å±‚æ»¡è¶³segmentè§„åˆ™çš„å­èŠ‚ç‚¹â€ ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿç”¨ä¸€ä¸ªå‡½æ•° filterChildNodes å°†å®ƒå°è£…èµ·æ¥ã€‚è¿™ä¸ªå‡½æ•°çš„é€»è¾‘å°±æ¯”è¾ƒç®€å•äº†ï¼šéå†ä¸‹ä¸€å±‚å­èŠ‚ç‚¹ï¼Œåˆ¤æ–­segmentæ˜¯å¦åŒ¹é…ä¼ å…¥çš„å‚æ•°segmentã€‚</p><p>åœ¨æ¡†æ¶æ–‡ä»¶å¤¹ä¸­çš„tree.goä¸­ï¼Œæˆ‘ä»¬å®ŒæˆmatchNode å’Œ filterChildNodeså®Œæ•´ä»£ç å®ç°ï¼Œæ”¾åœ¨è¿™é‡Œäº†ï¼Œå…·ä½“é€»è¾‘æˆ‘ä¹ŸåŠ äº†è¯¦ç»†çš„æ‰¹æ³¨å¸®ä½ ç†è§£ã€‚</p><pre><code class=\"language-go\">// åˆ¤æ–­ä¸€ä¸ªsegmentæ˜¯å¦æ˜¯é€šç”¨segmentï¼Œå³ä»¥:å¼€å¤´\nfunc isWildSegment(segment string) bool {\n\treturn strings.HasPrefix(segment, \":\")\n}\n\n// è¿‡æ»¤ä¸‹ä¸€å±‚æ»¡è¶³segmentè§„åˆ™çš„å­èŠ‚ç‚¹\nfunc (n *node) filterChildNodes(segment string) []*node {\n\tif len(n.childs) == 0 {\n\t\treturn nil\n\t}\n\n\t// å¦‚æœsegmentæ˜¯é€šé…ç¬¦ï¼Œåˆ™æ‰€æœ‰ä¸‹ä¸€å±‚å­èŠ‚ç‚¹éƒ½æ»¡è¶³éœ€æ±‚\n\tif isWildSegment(segment) {\n\t\treturn n.childs\n\t}\n\n\tnodes := make([]*node, 0, len(n.childs))\n\t// è¿‡æ»¤æ‰€æœ‰çš„ä¸‹ä¸€å±‚å­èŠ‚ç‚¹\n\tfor _, cnode := range n.childs {\n\t\tif isWildSegment(cnode.segment) {\n\t\t\t// å¦‚æœä¸‹ä¸€å±‚å­èŠ‚ç‚¹æœ‰é€šé…ç¬¦ï¼Œåˆ™æ»¡è¶³éœ€æ±‚\n\t\t\tnodes = append(nodes, cnode)\n\t\t} else if cnode.segment == segment {\n\t\t\t// å¦‚æœä¸‹ä¸€å±‚å­èŠ‚ç‚¹æ²¡æœ‰é€šé…ç¬¦ï¼Œä½†æ˜¯æ–‡æœ¬å®Œå…¨åŒ¹é…ï¼Œåˆ™æ»¡è¶³éœ€æ±‚\n\t\t\tnodes = append(nodes, cnode)\n\t\t}\n\t}\n\n\treturn nodes\n}\n\n// åˆ¤æ–­è·¯ç”±æ˜¯å¦å·²ç»åœ¨èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹æ ‘ä¸­å­˜åœ¨äº†\nfunc (n *node) matchNode(uri string) *node {\n\t// ä½¿ç”¨åˆ†éš”ç¬¦å°†uriåˆ‡å‰²ä¸ºä¸¤ä¸ªéƒ¨åˆ†\n\tsegments := strings.SplitN(uri, \"/\", 2)\n\t// ç¬¬ä¸€ä¸ªéƒ¨åˆ†ç”¨äºåŒ¹é…ä¸‹ä¸€å±‚å­èŠ‚ç‚¹\n\tsegment := segments[0]\n\tif !isWildSegment(segment) {\n\t\tsegment = strings.ToUpper(segment)\n\t}\n\t// åŒ¹é…ç¬¦åˆçš„ä¸‹ä¸€å±‚å­èŠ‚ç‚¹\n\tcnodes := n.filterChildNodes(segment)\n\t// å¦‚æœå½“å‰å­èŠ‚ç‚¹æ²¡æœ‰ä¸€ä¸ªç¬¦åˆï¼Œé‚£ä¹ˆè¯´æ˜è¿™ä¸ªuriä¸€å®šæ˜¯ä¹‹å‰ä¸å­˜åœ¨, ç›´æ¥è¿”å›nil\n\tif cnodes == nil || len(cnodes) == 0 {\n\t\treturn nil\n\t}\n\n\t// å¦‚æœåªæœ‰ä¸€ä¸ªsegmentï¼Œåˆ™æ˜¯æœ€åä¸€ä¸ªæ ‡è®°\n\tif len(segments) == 1 {\n\t\t// å¦‚æœsegmentå·²ç»æ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ¤æ–­è¿™äº›cnodeæ˜¯å¦æœ‰isLastæ ‡å¿—\n\t\tfor _, tn := range cnodes {\n\t\t\tif tn.isLast {\n\t\t\t\treturn tn\n\t\t\t}\n\t\t}\n\n\t\t// éƒ½ä¸æ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹\n\t\treturn nil\n\t}\n\n\t// å¦‚æœæœ‰2ä¸ªsegment, é€’å½’æ¯ä¸ªå­èŠ‚ç‚¹ç»§ç»­è¿›è¡ŒæŸ¥æ‰¾\n\tfor _, tn := range cnodes {\n\t\ttnMatch := tn.matchNode(segments[1])\n\t\tif tnMatch != nil {\n\t\t\treturn tnMatch\n\t\t}\n\t}\n\treturn nil\n}\n</code></pre><p>ç°åœ¨æœ‰äº†matchNode å’Œ filterChildNodes å‡½æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹å†™ç¬¬äºŒæ­¥é‡Œæœ€æ ¸å¿ƒçš„å¢åŠ è·¯ç”±çš„å‡½æ•°é€»è¾‘äº†ã€‚</p><p><strong>é¦–å…ˆï¼Œç¡®è®¤è·¯ç”±æ˜¯å¦å†²çª</strong>ã€‚æˆ‘ä»¬å…ˆæ£€æŸ¥è¦å¢åŠ çš„è·¯ç”±è§„åˆ™æ˜¯å¦åœ¨æ ‘ä¸­å·²ç»æœ‰å¯ä»¥åŒ¹é…çš„èŠ‚ç‚¹äº†ã€‚å¦‚æœæœ‰çš„è¯ï¼Œä»£è¡¨å½“å‰å¾…å¢åŠ çš„è·¯ç”±å’Œå·²æœ‰è·¯ç”±å­˜åœ¨å†²çªï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨åˆ°äº†åˆšåˆšå®šä¹‰çš„matchNodeã€‚æ›´æ–°åˆšæ‰æ¡†æ¶æ–‡ä»¶å¤¹ä¸­çš„tree.goæ–‡ä»¶ï¼š</p><pre><code class=\"language-go\">// å¢åŠ è·¯ç”±èŠ‚ç‚¹\nfunc (tree *Tree) AddRouter(uri string, handler ControllerHandler) error {\n\tn := tree.root\n    // ç¡®è®¤è·¯ç”±æ˜¯å¦å†²çª\n\tif n.matchNode(uri) != nil {\n\t\treturn errors.New(\"route exist: \" + uri)\n\t}\n\n\t...\n}\n\n</code></pre><p><strong>ç„¶åç»§ç»­å¢åŠ è·¯ç”±è§„åˆ™</strong>ã€‚æˆ‘ä»¬å¢åŠ è·¯ç”±çš„æ¯ä¸ªæ®µæ—¶ï¼Œå…ˆå»æ ‘çš„æ¯ä¸€å±‚ä¸­åŒ¹é…æŸ¥æ‰¾ï¼Œå¦‚æœå·²ç»æœ‰äº†ç¬¦åˆè¿™ä¸ªæ®µçš„èŠ‚ç‚¹ï¼Œå°±ä¸éœ€è¦åˆ›å»ºèŠ‚ç‚¹ï¼Œç»§ç»­åŒ¹é…å¾…å¢åŠ è·¯ç”±çš„ä¸‹ä¸ªæ®µï¼›å¦åˆ™ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ç”¨æ¥ä»£è¡¨è¿™ä¸ªæ®µã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ç”¨åˆ°äº†å®šä¹‰çš„ filterChildNodesã€‚</p><pre><code class=\"language-go\">// å¢åŠ è·¯ç”±èŠ‚ç‚¹\n/*\n/book/list\n/book/:id (å†²çª)\n/book/:id/name\n/book/:student/age\n/:user/name\n/:user/name/:age(å†²çª)\n*/\nfunc (tree *Tree) AddRouter(uri string, handler ControllerHandler) error {\n\tn := tree.root\n\tif n.matchNode(uri) != nil {\n\t\treturn errors.New(\"route exist: \" + uri)\n\t}\n\n\tsegments := strings.Split(uri, \"/\")\n\t// å¯¹æ¯ä¸ªsegment\n\tfor index, segment := range segments {\n\n\t\t// æœ€ç»ˆè¿›å…¥Node segmentçš„å­—æ®µ\n\t\tif !isWildSegment(segment) {\n\t\t\tsegment = strings.ToUpper(segment)\n\t\t}\n\t\tisLast := index == len(segments)-1\n\n\t\tvar objNode *node // æ ‡è®°æ˜¯å¦æœ‰åˆé€‚çš„å­èŠ‚ç‚¹\n\n\t\tchildNodes := n.filterChildNodes(segment)\n\t\t// å¦‚æœæœ‰åŒ¹é…çš„å­èŠ‚ç‚¹\n\t\tif len(childNodes) &gt; 0 {\n\t\t\t// å¦‚æœæœ‰segmentç›¸åŒçš„å­èŠ‚ç‚¹ï¼Œåˆ™é€‰æ‹©è¿™ä¸ªå­èŠ‚ç‚¹\n\t\t\tfor _, cnode := range childNodes {\n\t\t\t\tif cnode.segment == segment {\n\t\t\t\t\tobjNode = cnode\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif objNode == nil {\n\t\t\t// åˆ›å»ºä¸€ä¸ªå½“å‰nodeçš„èŠ‚ç‚¹\n\t\t\tcnode := newNode()\n\t\t\tcnode.segment = segment\n\t\t\tif isLast {\n\t\t\t\tcnode.isLast = true\n\t\t\t\tcnode.handler = handler\n\t\t\t}\n\t\t\tn.childs = append(n.childs, cnode)\n\t\t\tobjNode = cnode\n\t\t}\n\n\t\tn = objNode\n\t}\n\n\treturn nil\n}\n</code></pre><p>åˆ°è¿™é‡Œï¼Œç¬¬äºŒæ­¥å¢åŠ è·¯ç”±çš„è§„åˆ™é€»è¾‘å·²ç»æœ‰äº†ï¼Œ<strong>æˆ‘ä»¬è¦å¼€å§‹ç¬¬ä¸‰æ­¥ï¼Œç¼–å†™â€œæŸ¥æ‰¾è·¯ç”±â€çš„é€»è¾‘</strong>ã€‚è¿™é‡Œä½ ä¼šå‘ç°ï¼Œç”±äºæˆ‘ä»¬ä¹‹å‰å·²ç»å®šä¹‰è¿‡matchNodeï¼ˆåŒ¹é…è·¯ç”±èŠ‚ç‚¹ï¼‰ï¼Œæ‰€ä»¥è¿™é‡Œåªéœ€è¦å¤ç”¨è¿™ä¸ªå‡½æ•°å°±è¡Œäº†ã€‚</p><pre><code class=\"language-go\">// åŒ¹é…uri\nfunc (tree *Tree) FindHandler(uri string) ControllerHandler {\n    // ç›´æ¥å¤ç”¨matchNodeå‡½æ•°ï¼Œuriæ˜¯ä¸å¸¦é€šé…ç¬¦çš„åœ°å€\n\tmatchNode := tree.root.matchNode(uri)\n\tif matchNode == nil {\n\t\treturn nil\n\t}\n\treturn matchNode.handler\n}\n\n</code></pre><p>å‰ä¸‰æ­¥å·²ç»å®Œæˆäº†ï¼Œ<strong>æœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬æŠŠâ€œå¢åŠ è·¯ç”±è§„åˆ™â€å’Œâ€œæŸ¥æ‰¾è·¯ç”±â€æ·»åŠ åˆ°æ¡†æ¶ä¸­</strong>ã€‚è¿˜è®°å¾—å—ï¼Œåœ¨é™æ€è·¯ç”±åŒ¹é…çš„æ—¶å€™ï¼Œåœ¨Coreä¸­ä½¿ç”¨å“ˆå¸Œå®šä¹‰çš„è·¯ç”±ï¼Œè¿™é‡Œå°†å“ˆå¸Œæ›¿æ¢ä¸ºtrieæ ‘ã€‚è¿˜æ˜¯åœ¨æ¡†æ¶æ–‡ä»¶å¤¹ä¸­çš„core.goæ–‡ä»¶ï¼Œæ‰¾åˆ°å¯¹åº”ä½ç½®ä½œä¿®æ”¹ï¼š</p><pre><code class=\"language-go\">type Core struct {\n\trouter map[string]*Tree // all routers\n}\n</code></pre><p>å¯¹åº”è·¯ç”±å¢åŠ çš„æ–¹æ³•ï¼Œä¹Ÿä»å“ˆå¸Œçš„å¢åŠ é€»è¾‘ï¼Œæ›¿æ¢ä¸ºtrieæ ‘çš„â€œå¢åŠ è·¯ç”±è§„åˆ™â€é€»è¾‘ã€‚åŒæ ·æ›´æ–°core.goæ–‡ä»¶ä¸­çš„ä¸‹åˆ—æ–¹æ³•ï¼š</p><pre><code class=\"language-go\">// åˆå§‹åŒ–Coreç»“æ„\nfunc NewCore() *Core {\n\t// åˆå§‹åŒ–è·¯ç”±\n\trouter := map[string]*Tree{}\n\trouter[\"GET\"] = NewTree()\n\trouter[\"POST\"] = NewTree()\n\trouter[\"PUT\"] = NewTree()\n\trouter[\"DELETE\"] = NewTree()\n\treturn &amp;Core{router: router}\n}\n\n\n\n// åŒ¹é…GET æ–¹æ³•, å¢åŠ è·¯ç”±è§„åˆ™\nfunc (c *Core) Get(url string, handler ControllerHandler) {\n\tif err := c.router[\"GET\"].AddRouter(url, handler); err != nil {\n\t\tlog.Fatal(\"add router error: \", err)\n\t}\n}\n\n// åŒ¹é…POST æ–¹æ³•, å¢åŠ è·¯ç”±è§„åˆ™\nfunc (c *Core) Post(url string, handler ControllerHandler) {\n\tif err := c.router[\"POST\"].AddRouter(url, handler); err != nil {\n\t\tlog.Fatal(\"add router error: \", err)\n\t}\n}\n\n// åŒ¹é…PUT æ–¹æ³•, å¢åŠ è·¯ç”±è§„åˆ™\nfunc (c *Core) Put(url string, handler ControllerHandler) {\n\tif err := c.router[\"PUT\"].AddRouter(url, handler); err != nil {\n\t\tlog.Fatal(\"add router error: \", err)\n\t}\n}\n\n// åŒ¹é…DELETE æ–¹æ³•, å¢åŠ è·¯ç”±è§„åˆ™\nfunc (c *Core) Delete(url string, handler ControllerHandler) {\n\tif err := c.router[\"DELETE\"].AddRouter(url, handler); err != nil {\n\t\tlog.Fatal(\"add router error: \", err)\n\t}\n}\n</code></pre><p>ä¹‹å‰åœ¨Coreä¸­å®šä¹‰çš„åŒ¹é…è·¯ç”±å‡½æ•°çš„å®ç°é€»è¾‘ï¼Œä»å“ˆå¸ŒåŒ¹é…ä¿®æ”¹ä¸ºtrieæ ‘åŒ¹é…å°±å¯ä»¥äº†ã€‚ç»§ç»­æ›´æ–°core.goæ–‡ä»¶ï¼š</p><pre><code class=\"language-go\">// åŒ¹é…è·¯ç”±ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…åˆ°ï¼Œè¿”å›nil\nfunc (c *Core) FindRouteByRequest(request *http.Request) ControllerHandler {\n\t// uri å’Œ method å…¨éƒ¨è½¬æ¢ä¸ºå¤§å†™ï¼Œä¿è¯å¤§å°å†™ä¸æ•æ„Ÿ\n\turi := request.URL.Path\n\tmethod := request.Method\n\tupperMethod := strings.ToUpper(method)\n\n\t// æŸ¥æ‰¾ç¬¬ä¸€å±‚map\n\tif methodHandlers, ok := c.router[upperMethod]; ok {\n\t\treturn methodHandlers.FindHandler(uri)\n\t}\n\treturn nil\n}\n\n</code></pre><p>åŠ¨æ€åŒ¹é…è§„åˆ™å°±æ”¹é€ å®Œæˆäº†ã€‚</p><h2>éªŒè¯</h2><p>ç°åœ¨ï¼Œå››ä¸ªéœ€æ±‚éƒ½å·²ç»å®ç°äº†ã€‚æˆ‘ä»¬éªŒè¯ä¸€ä¸‹ï¼šå®šä¹‰åŒ…å«æœ‰é™æ€è·¯ç”±ã€æ‰¹é‡é€šç”¨å‰ç¼€ã€åŠ¨æ€è·¯ç”±çš„è·¯ç”±è§„åˆ™ï¼Œæ¯ä¸ªæ§åˆ¶å™¨æˆ‘ä»¬å°±ç›´æ¥è¾“å‡ºæ§åˆ¶å™¨çš„åå­—ï¼Œç„¶åå¯åŠ¨æœåŠ¡ã€‚</p><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥å»ä¿®æ”¹ä¸šåŠ¡æ–‡ä»¶å¤¹ä¸‹çš„è·¯ç”±æ–‡ä»¶route.goï¼š</p><pre><code class=\"language-go\">// æ³¨å†Œè·¯ç”±è§„åˆ™\nfunc registerRouter(core *framework.Core) {\n\t// éœ€æ±‚1+2:HTTPæ–¹æ³•+é™æ€è·¯ç”±åŒ¹é…\n\tcore.Get(\"/user/login\", UserLoginController)\n\n\t// éœ€æ±‚3:æ‰¹é‡é€šç”¨å‰ç¼€\n\tsubjectApi := core.Group(\"/subject\")\n\t{\n\t\t// éœ€æ±‚4:åŠ¨æ€è·¯ç”±\n\t\tsubjectApi.Delete(\"/:id\", SubjectDelController)\n\t\tsubjectApi.Put(\"/:id\", SubjectUpdateController)\n\t\tsubjectApi.Get(\"/:id\", SubjectGetController)\n\t\tsubjectApi.Get(\"/list/all\", SubjectListController)\n\t}\n}\n</code></pre><p>åŒæ—¶åœ¨ä¸šåŠ¡æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºå¯¹åº”çš„ä¸šåŠ¡æ§åˆ¶å™¨user_controller.goå’Œsubject_controller.goã€‚å…·ä½“é‡Œé¢çš„é€»è¾‘ä»£ç å°±æ˜¯æ‰“å°å‡ºå¯¹åº”çš„æ§åˆ¶å™¨åå­—ï¼Œæ¯”å¦‚</p><pre><code class=\"language-go\">func UserLoginController(c *framework.Context) error {\n   // æ‰“å°æ§åˆ¶å™¨åå­—\n   c.Json(200, \"ok, UserLoginController\")\n   return nil\n}\n</code></pre><p>æ¥çœ‹æœåŠ¡å¯åŠ¨æƒ…å†µï¼šè®¿é—®åœ°å€/user/login åŒ¹é…è·¯ç”±UserLoginContorllerã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/df/52/df2cf7aaf2be03c6da8bb8e72a10fd52.png?wh=684x191\" alt=\"å›¾ç‰‡\"></p><p>è®¿é—®åœ°å€/subject/list/all åŒ¹é…è·¯ç”±SubjectListControllerã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b5/0a/b5f4248d9ee478eed83b121c886c640a.png?wh=663x267\" alt=\"å›¾ç‰‡\"></p><p>è®¿é—®åœ°å€ /subject/100 åŒ¹é…åŠ¨æ€è·¯ç”± SubjectGetControllerã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a6/f0/a6f095eb721b20dbeeb6952aa24df7f0.png?wh=655x227\" alt=\"å›¾ç‰‡\"></p><p>è·¯ç”±è§„åˆ™ç¬¦åˆè¦æ±‚ï¼</p><p>ä»Šå¤©çš„æ–‡ä»¶åŠä»£ç ç»“æ„å¦‚ä¸‹ï¼Œæ–°å»ºçš„æ–‡ä»¶å¤¹å¤šä¸€ç‚¹ä½ å¯ä»¥å¯¹ç…§ç€GitHubå†çœ‹çœ‹ï¼Œä»£ç åœ°å€åœ¨<a href=\"https://github.com/gohade/coredemo/tree/geekbang/03\">geekbang/03</a>åˆ†æ”¯ä¸Šï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/c2/3c/c2518fc8d20034aacb93b5e509375b3c.png?wh=726x942\" alt=\"\"></p><h2>å°ç»“</h2><p>åœ¨è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä¸€æ­¥æ­¥å®ç°äº†æ»¡è¶³å››ä¸ªéœ€æ±‚çš„è·¯ç”±ï¼šHTTPæ–¹æ³•åŒ¹é…ã€æ‰¹é‡é€šç”¨å‰ç¼€ã€é™æ€è·¯ç”±åŒ¹é…å’ŒåŠ¨æ€è·¯ç”±åŒ¹é…ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨IGroupç»“æ„å’Œåœ¨Coreä¸­å®šä¹‰keyä¸ºæ–¹æ³•çš„è·¯ç”±ï¼Œå®ç°äº†HTTPæ–¹æ³•åŒ¹é…ã€æ‰¹é‡é€šç”¨å‰ç¼€è¿™ä¸¤ä¸ªéœ€æ±‚ï¼Œå¹¶ä¸”ç”¨å“ˆå¸Œæ¥å®ç°é™æ€è·¯ç”±åŒ¹é…ï¼Œä¹‹åæˆ‘ä»¬ä½¿ç”¨trieæ ‘ç®—æ³•æ›¿ä»£å“ˆå¸Œç®—æ³•ï¼Œå®ç°äº†åŠ¨æ€è·¯ç”±åŒ¹é…çš„éœ€æ±‚ã€‚</p><p>æ‰€ä»¥ï¼Œä½ æœ‰æ²¡æœ‰å‘ç°ï¼Œ<strong>å…¶å®æ‰€è°“çš„å®ç°åŠŸèƒ½ï¼Œå†™ä»£ç åªæ˜¯å…¶ä¸­ä¸€å°éƒ¨åˆ†ï¼Œå¦‚ä½•æ€è€ƒã€å¦‚ä½•è€ƒè™‘å®¹é”™æ€§ã€æ‰©å±•æ€§å’Œå¤ç”¨æ€§ï¼Œè¿™ä¸ªåè€Œæ˜¯æ›´å¤§çš„éƒ¨åˆ†</strong>ã€‚</p><p>ä»¥ä»Šå¤©å®ç°çš„è·¯ç”±è¿™ä¸ªåŠŸèƒ½ä¸ºä¾‹ï¼Œä½ æ˜¯å¦è€ƒè™‘åˆ°äº†URIçš„å®¹é”™æ€§ï¼Œåœ¨Groupè¿”å›æ—¶å€™æ˜¯å¦ä½¿ç”¨æ¥å£å¢åŠ æ‰©å±•æ€§ï¼Œåœ¨å®ç°åŠ¨æ€åŒ¹é…çš„æ—¶å€™æ˜¯å¦è€ƒè™‘å‡½æ•°å¤ç”¨æ€§ã€‚æˆ‘ä»¬è¦è®°ä½çš„æ˜¯ï¼Œæ€è·¯æ¯”ä»£ç å®ç°æ›´é‡è¦ã€‚</p><h1>æ€è€ƒé¢˜</h1><p>å…‰è¯´ä¸ç»ƒå‡æŠŠå¼ï¼Œæ¯•ç«Ÿæˆ‘ä»¬æ˜¯å®æˆ˜è¯¾ï¼Œé‚£é’ˆå¯¹ç¬¬ä¸‰ä¸ªéœ€æ±‚â€œæ‰¹é‡é€šç”¨å‰ç¼€â€ï¼Œæˆ‘ä»¬æ‰©å±•ä¸€ä¸‹å˜æˆï¼šéœ€è¦èƒ½å¤šå±‚åµŒå¥—é€šç”¨å‰ç¼€ï¼Œè¿™ä¹ˆå®šä¹‰è·¯ç”±ï¼š</p><pre><code class=\"language-go\">// æ³¨å†Œè·¯ç”±è§„åˆ™\nfunc registerRouter(core *framework.Core) {\n\t// é™æ€è·¯ç”±+HTTPæ–¹æ³•åŒ¹é…\n\tcore.Get(\"/user/login\", UserLoginController)\n\n\t// æ‰¹é‡é€šç”¨å‰ç¼€\n\tsubjectApi := core.Group(\"/subject\")\n\t{\n\t\tsubjectInnerApi := subjectApi.Group(\"/info\")\n\t\t{\n\t\t\tsubjectInnerApi.Get(\"/name\", SubjectNameController)\t\n\t\t}\n    }\n}\n</code></pre><p>ç»“åˆåˆšæ‰è¯´çš„è€ƒè™‘ä»£ç çš„è®¾è®¡æ„Ÿï¼Œä½ æƒ³ä¸€æƒ³å¦‚ä½•å®ç°å‘¢ï¼Ÿ</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„æ€è€ƒã€‚å¦‚æœä½ è§‰å¾—ä»Šå¤©çš„å†…å®¹å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠä»Šå¤©çš„å†…å®¹åˆ†äº«ç»™ä½ èº«è¾¹çš„æœ‹å‹ï¼Œé‚€è¯·ä»–ä¸€èµ·å­¦ä¹ ï½</p>","neighbors":{"left":{"article_title":"02ï½œContextï¼šè¯·æ±‚æ§åˆ¶å™¨ï¼Œè®©æ¯ä¸ªè¯·æ±‚éƒ½åœ¨æŒæ§ä¹‹ä¸­","id":418283},"right":{"article_title":"04ï½œä¸­é—´ä»¶ï¼šå¦‚ä½•æé«˜æ¡†æ¶çš„å¯æ‹“å±•æ€§ï¼Ÿ","id":420006}},"comments":[{"had_liked":false,"id":312603,"user_name":"å¥½å®¶åº­","can_delete":false,"product_type":"c1","uid":1727613,"ip_address":"","ucode":"29A192102E0095","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJyibojtJCnzAE7E8sMqgiaiaAHl3FuzcXcicQnjnT5huUFMxGUMzV5NGuqzzHHr8dBzCs3xfuhwcOnPw/132","comment_is_top":false,"comment_ctime":1631887321,"is_pvip":false,"replies":[{"id":"113321","content":"ä½ å¥½ï¼Œæ˜¯çš„ï¼Œè¿™ç§æ–¹å¼æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œä½¿ç”¨èµ·æ¥æ¯”è¾ƒèˆ’æœã€‚","user_name":"ä½œè€…å›å¤","comment_id":312603,"uid":"1069186","ip_address":"","utype":1,"ctime":1632016219,"user_name_real":"å¶å‰‘å³°"}],"discussion_count":1,"race_medal":0,"score":"23106723801","product_id":100090601,"comment_content":"ä¸ºIGroupå®ç°å¦‚ä¸‹æ¥å£ï¼š<br>Group(string) IGroup<br><br>ç±»ä¼¼äºbuilderè®¾è®¡æ¨¡å¼ï¼Œå¯ä»¥é“¾å¼è°ƒç”¨","like_count":5,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527043,"discussion_content":"ä½ å¥½ï¼Œæ˜¯çš„ï¼Œè¿™ç§æ–¹å¼æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œä½¿ç”¨èµ·æ¥æ¯”è¾ƒèˆ’æœã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632016219,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":325138,"user_name":"è·¯æ¼«æ¼«å…¶ä¿®è¿œå…®","can_delete":false,"product_type":"c1","uid":1067340,"ip_address":"","ucode":"7FD7CAC526A0AA","user_header":"https://static001.geekbang.org/account/avatar/00/10/49/4c/a3ea8eb2.jpg","comment_is_top":false,"comment_ctime":1638841050,"is_pvip":true,"replies":[{"id":"118668","content":"æ²¡åŠæ³•çš„ï¼ŒåŠ¨æ€è·¯ç”±ç¡®å®æœ‰ä½¿ç”¨åœºæ™¯ï¼Œç‰¹åˆ«å¯¹restapié£æ ¼æ¯”è¾ƒæ‰§ç€çš„äººä¼šéå¸¸éœ€è¦åŠ¨æ€è·¯ç”±çš„ï¼Œæ‰€ä»¥ç°åœ¨åšæ¡†æ¶åŸºæœ¬éƒ½è¦æ±‚æ”¯æŒåŠ¨æ€è·¯ç”±ã€‚å½“ç„¶ï¼Œå¦‚æœçº¯ä»æ€§èƒ½è€ƒè™‘é‚£æ˜¯å¦å¤–ä¸€ä¸ªäº†","user_name":"ä½œè€…å›å¤","comment_id":325138,"uid":"1069186","ip_address":"","utype":1,"ctime":1639609493,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"10228775642","product_id":100090601,"comment_content":"ä¸¤ç§è·¯ç”±æ–¹å¼æ˜¯ä¸æ˜¯å¯ä»¥çœ‹æˆä¸€ç±»ï¼Œåº•å±‚å­˜å‚¨ä¸åŒï¼ŸåŠ¨æ€æ˜¯æŒ‡åŠ¨æ€æ ¹æ®uriæ·»åŠ å’Œè·å–handlerã€‚å¦å¤–è¿™ç§åŠ¨æ€æ˜¯å¦æœ‰å¿…è¦å»åšï¼Œæ¯•ç«Ÿmapæ˜¯O(1)","like_count":2,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539102,"discussion_content":"æ²¡åŠæ³•çš„ï¼ŒåŠ¨æ€è·¯ç”±ç¡®å®æœ‰ä½¿ç”¨åœºæ™¯ï¼Œç‰¹åˆ«å¯¹restapié£æ ¼æ¯”è¾ƒæ‰§ç€çš„äººä¼šéå¸¸éœ€è¦åŠ¨æ€è·¯ç”±çš„ï¼Œæ‰€ä»¥ç°åœ¨åšæ¡†æ¶åŸºæœ¬éƒ½è¦æ±‚æ”¯æŒåŠ¨æ€è·¯ç”±ã€‚å½“ç„¶ï¼Œå¦‚æœçº¯ä»æ€§èƒ½è€ƒè™‘é‚£æ˜¯å¦å¤–ä¸€ä¸ªäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639609493,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324037,"user_name":"å‹","can_delete":false,"product_type":"c1","uid":2536820,"ip_address":"","ucode":"972A4333A8B101","user_header":"https://static001.geekbang.org/account/avatar/00/26/b5/74/cd80b9f4.jpg","comment_is_top":false,"comment_ctime":1638269050,"is_pvip":false,"replies":[{"id":"119254","content":"æ€è·¯okçš„ï¼Œå¯ä»¥èŠ‚çœä¸€å±‚ã€‚","user_name":"ä½œè€…å›å¤","comment_id":324037,"uid":"1069186","ip_address":"","utype":1,"ctime":1640222876,"user_name_real":"ç¼–è¾‘"}],"discussion_count":2,"race_medal":0,"score":"10228203642","product_id":100090601,"comment_content":"ä»”ç»†æ€è€ƒäº†ä¸‹è¿™ä¸ªtrieğŸŒ²ï¼Œè·¯ç”±å¦‚æœæ˜¯ &#47;user&#47;login åˆ‡å‰²ä¹‹å ä¼šå‡ºç°ä¸€å±‚segment ä¸º ç©ºå­—ç¬¦ä¸² è¿™æ ·ä¼šæµªè´¹ä¸€äº›ç©ºé—´ è¿™ç§ç©ºåº”è¯¥ç”¨ä¸åˆ°å§ æˆ‘è§‰å¾—å¯ä»¥å¤„ç†ä¸‹ ä¸çŸ¥é“è€å¸ˆæ€ä¹ˆçœ‹<br><br>å½“å‰ç¬¬0å±‚ segment=<br>å½“å‰ç¬¬1å±‚ segment=<br>å½“å‰ç¬¬2å±‚ segment= USER<br>è¯•ç€å†™äº†ä¸€ä¸ªå¤šå‰æ ‘çš„æ‰“å°ï¼Œç¬¬0å±‚æ˜¯ tree.root ç¡®å®ä¸ºç©º ä½†æ˜¯ç¬¬ä¸€å±‚ä¹Ÿä¸ºç©º","like_count":2,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540959,"discussion_content":"æ€è·¯okçš„ï¼Œå¯ä»¥èŠ‚çœä¸€å±‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640222877,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1299673,"avatar":"https://static001.geekbang.org/account/avatar/00/13/d4/d9/c3296187.jpg","nickname":"airmyä¸¶","note":"","ucode":"41959C9F5B4B65","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587800,"discussion_content":"ç¬¬1å±‚: ----\nç¬¬2å±‚: ----\nç¬¬3å±‚: USER----:user----BOOK----V1----\nç¬¬4å±‚: LOGIN----NAME----LOGIN----SUBJECT----\nç¬¬5å±‚: :age----:id----\n\nç¡®å®å¤šå‡ºäº†ä¸€å±‚ï¼Œåº”è¯¥æ˜¯æ²¡æœ‰å¿…è¦çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663299282,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314391,"user_name":"å‘¨å¯¿é•¿","can_delete":false,"product_type":"c1","uid":1203776,"ip_address":"","ucode":"022185DDB6B5D1","user_header":"https://static001.geekbang.org/account/avatar/00/12/5e/40/0716592b.jpg","comment_is_top":false,"comment_ctime":1632994621,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10222929213","product_id":100090601,"comment_content":"(tree *Tree) AddRouteræ–¹æ³•ç”¨é€’å½’å®ç°æ›´å®¹æ˜“çœ‹æ‡‚","like_count":2},{"had_liked":false,"id":312566,"user_name":"å°ç„¶","can_delete":false,"product_type":"c1","uid":2359008,"ip_address":"","ucode":"D0D85AAA1246BC","user_header":"https://static001.geekbang.org/account/avatar/00/23/fe/e0/5b0db40e.jpg","comment_is_top":false,"comment_ctime":1631866407,"is_pvip":false,"replies":[{"id":"113607","content":"æ˜¯çš„ï¼Œè¿™é‡Œä¸»è¦æ˜¯ç”±äº segments := strings.Split(uri, &quot;&#47;&quot;) ä¼šäº§ç”Ÿå‡ºç¬¬ä¸€ä¸ªç©ºèŠ‚ç‚¹ã€‚æˆ‘åœ¨æ–‡ç« å›¾ä¸­è¡¥å……äº†ä¸€ä¸‹æè¿°ã€‚<br><br>è°¢è°¢æé†’ã€‚","user_name":"ä½œè€…å›å¤","comment_id":312566,"uid":"1069186","ip_address":"","utype":1,"ctime":1632622183,"user_name_real":"å¶å‰‘å³°"}],"discussion_count":3,"race_medal":0,"score":"5926833703","product_id":100090601,"comment_content":"æ–‡ä¸­çš„æ ‘çš„å›¾ç»“æ„æ˜¯å¦é—®é¢˜å‘¢ï¼ŒæŒ‰ç…§ä»£ç å®é™…ç”Ÿæˆçš„æ¯ä¸€é¢—trieæ ‘rootèŠ‚ç‚¹ä¸‹é¢ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹å®é™…ä¸Šæ˜¯segmentä¸ºç©ºçš„èŠ‚ç‚¹ï¼Œç„¶ååœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸‹æ‰æ˜¯å„ä¸ªä¸€çº§è·¯åŠ²çš„å­èŠ‚ç‚¹ã€‚æ˜¯æˆ‘ç†è§£é”™è¯¯å—ï¼Ÿæˆ‘å¸¦ç€æ–‡ä¸­çš„æ ‘å›¾ç»“æ„å»çœ‹ä»£ç æ·»åŠ è·¯ç”±ç®—æ³•çœ‹èµ·æ¥æœ‰å¾ˆå¤§çš„åå·®ï¼Œè„‘è¢‹é‡Œæƒ³è±¡çº æ­£ï¼Œå…ˆåœ¨rootèŠ‚ç‚¹ä¸‹å…ˆåŠ ä¸€ä¸ªsegmentä¸ºç©ºçš„èŠ‚ç‚¹å°±å¥½ç†è§£äº†ã€‚","like_count":1,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527029,"discussion_content":"æ˜¯çš„ï¼Œè¿™é‡Œä¸»è¦æ˜¯ç”±äº segments := strings.Split(uri, &amp;quot;/&amp;quot;) ä¼šäº§ç”Ÿå‡ºç¬¬ä¸€ä¸ªç©ºèŠ‚ç‚¹ã€‚æˆ‘åœ¨æ–‡ç« å›¾ä¸­è¡¥å……äº†ä¸€ä¸‹æè¿°ã€‚\n\nè°¢è°¢æé†’ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632622183,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2536820,"avatar":"https://static001.geekbang.org/account/avatar/00/26/b5/74/cd80b9f4.jpg","nickname":"å‹","note":"","ucode":"972A4333A8B101","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"discussion":{"id":534742,"discussion_content":"å“¦å“¦ åŸæ¥è€å¸ˆå›å¤è¿‡è¿™ä¸ªé—®é¢˜äº† æˆ‘è§‰å¾—å¯ä»¥åˆ¤æ–­å¦‚æœä¸º ç©ºåˆ™continueé‡æ–°å»add æŸ¥æ‰¾çš„æ—¶å€™å¯ä»¥åœ¨ä»request è·å¾—uriçš„æ—¶å€™ æŠŠ &#34;/&#34; å»æ‰ ç›®å‰è„‘å­é‡Œæƒ³çš„æ˜¯è¿™æ ·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638269135,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":527029,"ip_address":""},"score":534742,"extra":""}]},{"author":{"id":2536820,"avatar":"https://static001.geekbang.org/account/avatar/00/26/b5/74/cd80b9f4.jpg","nickname":"å‹","note":"","ucode":"972A4333A8B101","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534743,"discussion_content":"è¿™ä¸ªæ˜¯å°é—®é¢˜ æŒç»­é‡æ„  æ¥ä¸‹æ¥æŠŠä½œä¸šå†™ä¸€ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638269150,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361089,"user_name":"æ— å°½è”šè“","can_delete":false,"product_type":"c1","uid":2721761,"ip_address":"ä¸Šæµ·","ucode":"A665DF46833A81","user_header":"https://static001.geekbang.org/account/avatar/00/29/87/e1/b85dce85.jpg","comment_is_top":false,"comment_ctime":1667200548,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1667200548","product_id":100090601,"comment_content":"è¿™æ®µä»£ç <br><br>if cnodes == nil || len(cnodes) == 0 { return nil }<br><br>åº”è¯¥æ”¹æˆè¿™æ ·<br><br>if len(cnodes) == 0 { return nil }<br><br>å› ä¸º<br>å‚è€ƒlen()çš„æ³¨é‡Šï¼š<br>Slice, or map: the number of elements in v; if v is nil, len(v) is zero.<br>æ‰€ä»¥ç›´æ¥ç”¨len(cnodes) å°±å¯ä»¥äº†","like_count":1},{"had_liked":false,"id":354949,"user_name":"Geek_25f93f","can_delete":false,"product_type":"c1","uid":2917509,"ip_address":"å¹¿ä¸œ","ucode":"D5932373E8EEA2","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/5JKZO1Ziax3Ky03noshpVNyEvZw0pUwjLcHrHRo1XNPKXdmCE88homb6ltA15CdVRnjzjgGs3Ex42CaDbeYzNuQ/132","comment_is_top":false,"comment_ctime":1660902045,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1660902045","product_id":100090601,"comment_content":"GET &#47;user&#47;login<br>GET &#47;user&#47;:id<br>åœ¨è¿™ä¸ªè·¯ç”±å™¨é‡Œé¢ï¼Œè¿™ä¸¤æ¡è§„åˆ™ä¼šå†²çªã€‚åœ¨giné‡Œé¢å°±ä¸ä¼š","like_count":0,"discussions":[{"author":{"id":1132146,"avatar":"https://static001.geekbang.org/account/avatar/00/11/46/72/cb6ada5c.jpg","nickname":"G55","note":"","ucode":"12B5FD30B9D146","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591641,"discussion_content":"åŒé—® è¿™ä¸ªæ€ä¹ˆè§£å†³å‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666747524,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":346163,"user_name":"Geek_05d654","can_delete":false,"product_type":"c1","uid":2903068,"ip_address":"","ucode":"D10FB87A0A62A1","user_header":"","comment_is_top":false,"comment_ctime":1652862761,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1652862761","product_id":100090601,"comment_content":"IGroup æ–°å¢æ¥å£ï¼š<br>Group(string) IGroup<br><br>type Group struct {<br>\tcore    *Core<br>\tprefixs []string<br>}<br><br>&#47;&#47; åˆå§‹åŒ–Group<br>func NewGroup(core *Core, prefix string) *Group {<br>\tprefixs := []string{prefix}<br>\treturn &amp;Group{<br>\t\tcore:    core,<br>\t\tprefixs: prefixs,<br>\t}<br>}<br><br>&#47;&#47; å®ç°Getæ–¹æ³•<br>func (g *Group) Get(uri string, handler ControllerHandler) {<br>\tprefixs := &quot;&quot;<br>\tfor _, prefix := range g.prefixs {<br>\t\tprefixs = prefixs + prefix<br>\t}<br>\turi = prefixs + uri<br>\tg.core.Get(uri, handler)<br>}<br><br>func (g *Group) Group(prefix string) IGroup {<br>\tg.prefixs = append(g.prefixs, prefix)<br>\treturn g<br>}<br><br>&#47;&#47; ä»coreä¸­åˆå§‹åŒ–è¿™ä¸ªGroup<br>func (c *Core) Group(prefix string) IGroup {<br>\treturn NewGroup(c, prefix)<br>}","like_count":0},{"had_liked":false,"id":325892,"user_name":"å’¸é±¼","can_delete":false,"product_type":"c1","uid":2712078,"ip_address":"","ucode":"32C83B9B063541","user_header":"https://static001.geekbang.org/account/avatar/00/29/62/0e/af82f76f.jpg","comment_is_top":false,"comment_ctime":1639216015,"is_pvip":true,"replies":[{"id":"118648","content":"å¦‚æœæœ‰é€šé…ç¬¦ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½æœ‰å¤šä¸ªï¼Œæ¯”å¦‚è·¯ç”±ï¼š&#47;foo&#47;*&#47;barå’Œ &#47;foo&#47;bar, è¯·æ±‚urlä¸ºfoo&#47;barï¼Œå½“æŸ¥è¯¢ç¬¬äºŒä¸ªbarçš„æ—¶å€™ï¼Œå°±æœ‰å¯èƒ½åŒ¹é…åˆ°2ä¸ªçš„","user_name":"ä½œè€…å›å¤","comment_id":325892,"uid":"1069186","ip_address":"","utype":1,"ctime":1639585812,"user_name_real":"ç¼–è¾‘"}],"discussion_count":2,"race_medal":0,"score":"1639216015","product_id":100090601,"comment_content":"æœ‰ä¸ªå°é—®é¢˜æƒ³å’¨è¯¢ä¸€ä¸‹è€å¸ˆï¼ŒfilterChildNodesè¿™ä¸ªå‡½æ•°æ˜¯å¦å¯ä»¥åªè¿”å›ä¸€ä¸ª*nodeï¼Œåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè¿”å›å¤šä¸ª*nodeï¼Ÿæ„Ÿè§‰æŒ‰ç…§çº¦æŸæ¡ä»¶æ¥çœ‹ï¼ŒfilterChildNodesåªæœ‰å¯èƒ½è¿”å›ä¸€ä¸ª*node","like_count":0,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539077,"discussion_content":"å¦‚æœæœ‰é€šé…ç¬¦ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½æœ‰å¤šä¸ªï¼Œæ¯”å¦‚è·¯ç”±ï¼š/foo/*/barå’Œ /foo/bar, è¯·æ±‚urlä¸ºfoo/barï¼Œå½“æŸ¥è¯¢ç¬¬äºŒä¸ªbarçš„æ—¶å€™ï¼Œå°±æœ‰å¯èƒ½åŒ¹é…åˆ°2ä¸ªçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639585812,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2179383,"avatar":"https://static001.geekbang.org/account/avatar/00/21/41/37/b89f3d67.jpg","nickname":"æˆ‘åœ¨ç¡è§‰","note":"","ucode":"6503B611151D3C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537929,"discussion_content":"å½“æŸ¥æ‰¾çš„å­èŠ‚ç‚¹ä¸­æœ‰é€šé…ç¬¦çš„æƒ…å†µ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639271596,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324040,"user_name":"å‹","can_delete":false,"product_type":"c1","uid":2536820,"ip_address":"","ucode":"972A4333A8B101","user_header":"https://static001.geekbang.org/account/avatar/00/26/b5/74/cd80b9f4.jpg","comment_is_top":false,"comment_ctime":1638269417,"is_pvip":false,"replies":[{"id":"119252","content":"åŒæ„Ÿè°¢","user_name":"ä½œè€…å›å¤","comment_id":324040,"uid":"1069186","ip_address":"","utype":1,"ctime":1640221829,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1638269417","product_id":100090601,"comment_content":"è€å¸ˆçš„å­—å…¸æ ‘æ€è·¯å·¨æ¸…æ™°ï¼Œä¹‹åé‡æ„çš„æ—¶å€™è‡ªå·±é‡æ–°æŠŠå­—å…¸æ ‘å†™äº† éƒ½æœ‰ç‚¹æ¨¡ç³Šäº† æœŸå¾…åç»­æ–‡ä»¶ æ„Ÿè°¢è€å¸ˆåˆ†äº«","like_count":0,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540954,"discussion_content":"åŒæ„Ÿè°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640221829,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324025,"user_name":"å‹","can_delete":false,"product_type":"c1","uid":2536820,"ip_address":"","ucode":"972A4333A8B101","user_header":"https://static001.geekbang.org/account/avatar/00/26/b5/74/cd80b9f4.jpg","comment_is_top":false,"comment_ctime":1638261460,"is_pvip":false,"replies":[{"id":"119256","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","comment_id":324025,"uid":"1069186","ip_address":"","utype":1,"ctime":1640222943,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1638261460","product_id":100090601,"comment_content":"åˆ·äº†ä¸€ä¸ªæœˆçš„leetcode è®©æˆ‘çš„ç¬¬ä¸€ååº”æ˜¯å­—å…¸æ ‘ åº”è¯¥æ²¡è¯´é”™","like_count":0,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540962,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640222943,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":313040,"user_name":"æœ¨å°æŸ’","can_delete":false,"product_type":"c1","uid":1000802,"ip_address":"","ucode":"947439CDD0B5B1","user_header":"https://static001.geekbang.org/account/avatar/00/0f/45/62/3c6041e7.jpg","comment_is_top":false,"comment_ctime":1632225108,"is_pvip":false,"replies":[{"id":"113610","content":"æ˜¯çš„ï¼Œåœ¨ginä¸­ä¹Ÿæœ‰:idï¼Œ ä»£è¡¨æœ‰ä¸€ä¸ªï¼Œè€Œ*ä»£è¡¨åŒ¹é…æ‰€æœ‰ã€‚","user_name":"ä½œè€…å›å¤","comment_id":313040,"uid":"1069186","ip_address":"","utype":1,"ctime":1632622987,"user_name_real":"å¶å‰‘å³°"}],"discussion_count":1,"race_medal":0,"score":"1632225108","product_id":100090601,"comment_content":"&#47;user&#47;name<br>&#47;user&#47;:id<br><br>ä¸€å¼€å§‹çœ‹è¿™ä¸ªï¼Œæƒ³æ‰¾ä¸ªå†²çªæŒºå¥‡æ€ªçš„ï¼Œè¿™ä¸ªæ„Ÿè§‰è¿˜ç®—æ­£å¸¸ï¼Œæ‰å‘è§‰åŸæ¥è¿™é‡Œ :id ç±»ä¼¼ gin é‡Œé¢çš„ *id","like_count":0,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527206,"discussion_content":"æ˜¯çš„ï¼Œåœ¨ginä¸­ä¹Ÿæœ‰:idï¼Œ ä»£è¡¨æœ‰ä¸€ä¸ªï¼Œè€Œ*ä»£è¡¨åŒ¹é…æ‰€æœ‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632622987,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312794,"user_name":"åŠæ ¼å¼Hal","can_delete":false,"product_type":"c1","uid":1997316,"ip_address":"","ucode":"0D62C7A7A5C82F","user_header":"https://static001.geekbang.org/account/avatar/00/1e/7a/04/005ba8e8.jpg","comment_is_top":false,"comment_ctime":1632024043,"is_pvip":false,"replies":[{"id":"113608","content":"ä½ å¥½ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ä¸»è¦è¿™é‡Œå°±æ˜¯è®©Request-URIå’ŒMethodä¸€èµ·ä½œä¸ºé™æ€è·¯ç”±æŸ¥è¯¢çš„keyã€‚ç”šè‡³å¯ä»¥ç›´æ¥æ‰“å¹³ï¼Œå°†å­—ç¬¦ä¸²Method+REQUEST-URI ä½œä¸ºhashçš„keyã€‚<br><br>å¦å¤–è°¢è°¢æé†’ï¼Œå·²ä¿®æ­£","user_name":"ä½œè€…å›å¤","comment_id":312794,"uid":"1069186","ip_address":"","utype":1,"ctime":1632622403,"user_name_real":"å¶å‰‘å³°"}],"discussion_count":2,"race_medal":0,"score":"1632024043","product_id":100090601,"comment_content":"è€å¸ˆå¥½ï¼Œä¸¤çº§æ˜ å°„å“ˆå¸Œï¼Œâ€œç¬¬ä¸€çº§ hash æ˜¯è¯·æ±‚ Methodï¼Œç¬¬äºŒçº§ hash æ˜¯ Requets-URIâ€ã€‚èƒ½ä¸èƒ½ç¬¬ä¸€çº§Request-URIï¼Œç¬¬äºŒçº§Methodçš„å‘¢ï¼Ÿä¼šæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿé¡ºä¾¿è¯´ä¸‹è¿™é‡ŒRequestæ‰“é”™äº†ã€‚","like_count":0,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527115,"discussion_content":"ä½ å¥½ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ä¸»è¦è¿™é‡Œå°±æ˜¯è®©Request-URIå’ŒMethodä¸€èµ·ä½œä¸ºé™æ€è·¯ç”±æŸ¥è¯¢çš„keyã€‚ç”šè‡³å¯ä»¥ç›´æ¥æ‰“å¹³ï¼Œå°†å­—ç¬¦ä¸²Method+REQUEST-URI ä½œä¸ºhashçš„keyã€‚\n\nå¦å¤–è°¢è°¢æé†’ï¼Œå·²ä¿®æ­£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632622403,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2143342,"avatar":"","nickname":"ç”³æ¬£","note":"","ucode":"23DA54FF6F5DB7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"discussion":{"id":537658,"discussion_content":"æˆ‘ä¸€å¼€å§‹çš„å®ç°å°±æ˜¯å¦‚æ­¤ï¼Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639131631,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":527115,"ip_address":""},"score":537658,"extra":""}]}]},{"had_liked":false,"id":312738,"user_name":"qinsi","can_delete":false,"product_type":"c1","uid":1667175,"ip_address":"","ucode":"090D9C4068FF12","user_header":"https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg","comment_is_top":false,"comment_ctime":1631957901,"is_pvip":true,"replies":[{"id":"113605","content":"ä½ å¥½ï¼Œæ„Ÿè°¢æé†’ï¼Œæ˜¯çš„ï¼Œå·²ç»ä¿®æ”¹","user_name":"ä½œè€…å›å¤","comment_id":312738,"uid":"1069186","ip_address":"","utype":1,"ctime":1632621229,"user_name_real":"å¶å‰‘å³°"}],"discussion_count":1,"race_medal":0,"score":"1631957901","product_id":100090601,"comment_content":"&#47;:user&#47;name(å†²çª)<br>&#47;:user&#47;name&#47;:age<br><br>è¿™ä¸¤ä¸ªæ˜¯ä¸æ˜¯å†™åäº†","like_count":0,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527096,"discussion_content":"ä½ å¥½ï¼Œæ„Ÿè°¢æé†’ï¼Œæ˜¯çš„ï¼Œå·²ç»ä¿®æ”¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632621229,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}