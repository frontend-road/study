{"id":224524,"title":"16 | 流量转移：灰度发布是如何实现的？","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-servicemesh\">https://gitee.com/geektime-geekbang/geektime-servicemesh</a></p>","comments":[{"had_liked":false,"id":303945,"user_name":"暮雨","can_delete":false,"product_type":"c3","uid":1176426,"ip_address":"","ucode":"4B7F4932446EF7","user_header":"https://static001.geekbang.org/account/avatar/00/11/f3/6a/6d82e7a3.jpg","comment_is_top":false,"comment_ctime":1627115375,"is_pvip":false,"replies":[{"id":110118,"content":"取决于你是有状态还是无状态蓝绿","user_name":"作者回复","user_name_real":"马若飞","uid":1046394,"ctime":1627353734,"ip_address":"","comment_id":303945,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"蓝绿发布的图画的有问题吧，数据库存储层不应该分开吧","like_count":1,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"马若飞","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523884,"discussion_content":"取决于你是有状态还是无状态蓝绿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627353734,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":298324,"user_name":"又双叒叕是一年啊","can_delete":false,"product_type":"c3","uid":1000015,"ip_address":"","ucode":"E067320E537DEE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/42/4f/ff1ac464.jpg","comment_is_top":false,"comment_ctime":1624016402,"is_pvip":false,"replies":[{"id":108532,"content":"先要想清楚为什么要迁移，如果没有痛点没必要迁移，SpringCloud的服务治理能力比istio强。如果要迁移，一般有2个问题，协议是否只有http、grpc、tcp；是否有遗留服务依赖consul，有需要整合服务注册，否则可以下掉","user_name":"作者回复","user_name_real":"马若飞","uid":1046394,"ctime":1624545252,"ip_address":"","comment_id":298324,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"再请教下: SpringCloud应用 迁移到 istio，原有的部署改造有哪些？ 比如原来的流量入口 Nginx 转发 springcloudgateway 是不是直接替换成 nginx转发到 ingressgateway上，原来的consul注册中心还需要？如何跟istio这套服务注册兼容？还是可以直接下掉。","like_count":1,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"马若飞","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522098,"discussion_content":"先要想清楚为什么要迁移，如果没有痛点没必要迁移，SpringCloud的服务治理能力比istio强。如果要迁移，一般有2个问题，协议是否只有http、grpc、tcp；是否有遗留服务依赖consul，有需要整合服务注册，否则可以下掉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624545252,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":327617,"user_name":"missing","can_delete":false,"product_type":"c3","uid":1316598,"ip_address":"","ucode":"3FC438D387779A","user_header":"https://static001.geekbang.org/account/avatar/00/14/16/f6/b864cf41.jpg","comment_is_top":false,"comment_ctime":1640191388,"is_pvip":false,"replies":[{"id":119987,"content":"格式问题 -route &gt; route，缩进","user_name":"作者回复","user_name_real":"编辑","uid":1046394,"ctime":1641380241,"ip_address":"","comment_id":327617,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"请教下为什么我这里报这个错？\nkubectl apply -f virtual-service-reviews-v2-chrome.yaml           \nerror: error validating &quot;virtual-service-reviews-v2-chrome.yaml&quot;: error validating data: ValidationError(VirtualService.spec.http[0].match): invalid type for io.istio.networking.v1alpha3.VirtualService.spec.http.match: got &quot;map&quot;, expected &quot;array&quot;; if you choose to ignore these errors, turn validation off with --validate=false\n\n-----\napiVersion: networking.istio.io&#47;v1alpha3\nkind: VirtualService\nmetadata:\n  name: reviews-chrome\nspec:\n  hosts:\n    - reviews\n  http:\n  - match:\n      headers:\n        user-agent: \n          regex: &quot;.*Chrome.*&quot;\n  - route:\n    - destination:\n        host: reviews\n        subset: v2 ","like_count":0,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"马若飞","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544019,"discussion_content":"格式问题 -route &gt; route，缩进","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641380242,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1426390,"avatar":"https://static001.geekbang.org/account/avatar/00/15/c3/d6/dfb19166.jpg","nickname":"谭哲","note":"","ucode":"C92D8217C2EEF3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589716,"discussion_content":"match: got &#34;map&#34;, expected &#34;array&#34; headers前边加-","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665281363,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":298323,"user_name":"又双叒叕是一年啊","can_delete":false,"product_type":"c3","uid":1000015,"ip_address":"","ucode":"E067320E537DEE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/42/4f/ff1ac464.jpg","comment_is_top":false,"comment_ctime":1624015934,"is_pvip":false,"replies":[{"id":108520,"content":"看需求，中间件不需要流量管理就可以这样","user_name":"作者回复","user_name_real":"马若飞","uid":1046394,"ctime":1624534790,"ip_address":"","comment_id":298323,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"老师请教下：在istio中部署 微服务的 namespace 和 中间件的 namespace 是否需要拆分隔离开，以便于envoy sidecar只注入到 微服务上， 中间间和 微服务还是通过servicename 直连吧，不需要经过 envoy转发是吗？","like_count":0,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"马若飞","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522097,"discussion_content":"看需求，中间件不需要流量管理就可以这样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624534790,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295206,"user_name":"kylexy_0817","can_delete":false,"product_type":"c3","uid":1068372,"ip_address":"","ucode":"392DD9DD5E4B6E","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/54/9c214885.jpg","comment_is_top":false,"comment_ctime":1622297203,"is_pvip":false,"replies":[{"id":108538,"content":"会覆盖，desc下看看生效没，istioctl ps看看是不是sync了。一般不会有问题，仔细过下vs和dr的配置","user_name":"作者回复","user_name_real":"马若飞","uid":1046394,"ctime":1624545558,"ip_address":"","comment_id":295206,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"老师您好，后apply的虚拟服务会覆盖之前apply的吧？为什么我使用了user-agent的apply的路由策略在灰度发布的策略apply后，就都不生效了呢？我用的istio版本是1.9.4","like_count":0,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"马若飞","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520990,"discussion_content":"会覆盖，desc下看看生效没，istioctl ps看看是不是sync了。一般不会有问题，仔细过下vs和dr的配置","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624545558,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":266152,"user_name":"无聊小刚","can_delete":false,"product_type":"c3","uid":1519595,"ip_address":"","ucode":"F34ED05C0BB0AA","user_header":"https://static001.geekbang.org/account/avatar/00/17/2f/eb/4fa8a18a.jpg","comment_is_top":false,"comment_ctime":1607217944,"is_pvip":false,"replies":[{"id":96905,"content":"蓝绿指的是应用层，不是持久层，应用层的业务逻辑会有版本发布的需求，不同的版本连接的是同一个数据源","user_name":"作者回复","user_name_real":"马若飞","uid":1046394,"ctime":1607520338,"ip_address":"","comment_id":266152,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"老师，蓝绿发布的话，如何同步蓝绿环境中数据库的数据？一般企业都是怎么处理这部分的？","like_count":0,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"马若飞","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511163,"discussion_content":"蓝绿指的是应用层，不是持久层，应用层的业务逻辑会有版本发布的需求，不同的版本连接的是同一个数据源","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607520338,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":249998,"user_name":"拉拉","can_delete":false,"product_type":"c3","uid":2199549,"ip_address":"","ucode":"31F09E59696137","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoaUNGrAJNPO9D7hAXibbKQ5OCdXlk4HXD2bdib2GrJkOou3Cf6vSt6ZmDk0Ly9ibfjicYuTfG9oCtetA/132","comment_is_top":false,"comment_ctime":1600876915,"is_pvip":false,"replies":[{"id":92163,"content":"不需要，istio-system只是用来部署istio自己的组件的，和你的应用没关系","user_name":"作者回复","user_name_real":"马若飞","uid":1046394,"ctime":1602231125,"ip_address":"","comment_id":249998,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"老师，我的所有服务都在同一个k8s的namespace里，现在引入了istio，会新增一个「istio-system」的namespace，那我是要重新把所有服务放到新的namespace里采用使用istio的功能吗？","like_count":0,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"马若飞","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506095,"discussion_content":"不需要，istio-system只是用来部署istio自己的组件的，和你的应用没关系","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602231125,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":220826,"user_name":"梦想","can_delete":false,"product_type":"c3","uid":1046939,"ip_address":"","ucode":"F1E8C08813F2E0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f9/9b/3d056492.jpg","comment_is_top":false,"comment_ctime":1590327680,"is_pvip":false,"replies":[{"id":81670,"content":"https:&#47;&#47;flagger.app&#47;\n4-2 我们会讲这个","user_name":"作者回复","user_name_real":"马若飞","uid":1046394,"ctime":1590507344,"ip_address":"","comment_id":220826,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"老师说的自动化的灰度发布工具 目前有哪些","like_count":0,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"马若飞","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496247,"discussion_content":"https://flagger.app/\n4-2 我们会讲这个","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590507344,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":212363,"user_name":"Lomo Fu","can_delete":false,"product_type":"c3","uid":1610161,"ip_address":"","ucode":"B7B9761F156593","user_header":"https://static001.geekbang.org/account/avatar/00/18/91/b1/e4769e6d.jpg","comment_is_top":false,"comment_ctime":1588089343,"is_pvip":false,"replies":[{"id":79016,"content":"听上去还是缓存的问题。你在应用后台查看一下log，如果按预期指向了不同的服务，说明配置是没问题的。流控的配置对前端肯定没有影响。建议你访问页面时在后面加不同的参数试试，打开chrome的console查看一下样式加载的路径和responsecode","user_name":"作者回复","user_name_real":"马若飞","uid":1046394,"ctime":1588162979,"ip_address":"","comment_id":212363,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"老师 我的应用是有两个版本 是用vue编写的前端spa并用nginx部署 两个版本的样式在进行金丝雀时 会出现样式混乱 就是有时候旧版本的样式部分会在新版本中展示 新版本部分样式出现在旧版本中 尤其是两者流量为95-5这样的小流量时 如果是50-50这种情况就变少了 我已经关闭了浏览器缓存了 不知道是什么问题","like_count":0,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"马若飞","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493484,"discussion_content":"听上去还是缓存的问题。你在应用后台查看一下log，如果按预期指向了不同的服务，说明配置是没问题的。流控的配置对前端肯定没有影响。建议你访问页面时在后面加不同的参数试试，打开chrome的console查看一下样式加载的路径和responsecode","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588162979,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1293957,"avatar":"https://static001.geekbang.org/account/avatar/00/13/be/85/fce1c198.jpg","nickname":"阿祖","note":"","ucode":"1AFB7268B80414","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":317287,"discussion_content":"前端spa 项目的话 访问页面的话一次会发多个请求，应用canary release的话会导致多个请求根据比重访问不同的版本，会导致前端页面样式发生混乱，可以加sticky session 让一次多个请求打到同一个版本","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1603528967,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":211682,"user_name":"🔜","can_delete":false,"product_type":"c3","uid":1224046,"ip_address":"","ucode":"E75A44829D9ED8","user_header":"https://static001.geekbang.org/account/avatar/00/12/ad/6e/f08676bf.jpg","comment_is_top":false,"comment_ctime":1587995456,"is_pvip":false,"replies":[{"id":78779,"content":"你的app读取文件是直接读取挂载点吗？原则上不走请求和sidecar没关系。你kubectl logs 看看app和istio-proxy的日志是什么错","user_name":"作者回复","user_name_real":"马若飞","uid":1046394,"ctime":1588046683,"ip_address":"","comment_id":211682,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"请问下，当我一个app 不注入sidecar的时候，能正常读取挂在pod里的文件，但是只要一注入就报权限不够不能读取文件。这个事什么情况","like_count":0,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"马若飞","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493335,"discussion_content":"你的app读取文件是直接读取挂载点吗？原则上不走请求和sidecar没关系。你kubectl logs 看看app和istio-proxy的日志是什么错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588046683,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":210944,"user_name":"Charles","can_delete":false,"product_type":"c3","uid":1201560,"ip_address":"","ucode":"C8C8A4F2B6C20F","user_header":"https://static001.geekbang.org/account/avatar/00/12/55/98/a49061ab.jpg","comment_is_top":false,"comment_ctime":1587868462,"is_pvip":false,"replies":[{"id":78504,"content":"优秀👌","user_name":"作者回复","user_name_real":"马若飞","uid":1046394,"ctime":1587895032,"ip_address":"","comment_id":210944,"utype":1}],"discussion_count":3,"race_medal":0,"score":3,"product_id":100049401,"comment_content":"apiVersion: networking.istio.io&#47;v1alpha3\nkind: VirtualService\nmetadata:\n  name: reviews-ua\nspec:\n  hosts:\n    - reviews\n  http:\n  - match:\n    - headers:\n        user-agent:\n          regex: &quot;*Chrome*&quot;\n  - route:\n    - destination:\n        host: reviews\n        subset: v1 ","like_count":0,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"马若飞","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493152,"discussion_content":"优秀👌","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587895032,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1809331,"avatar":"","nickname":"Geek_2655db","note":"","ucode":"3BC81783F791BD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":252310,"discussion_content":"这个正则表达式有些问题啊，下面这个可以\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: reviews\nspec:\n  hosts:\n  - reviews\n  http:\n  - match:\n    - headers:\n        user-agent:\n          regex: &#39;.*Chrome.*&#39;\n    route:\n    - destination:\n        host: reviews\n        subset: v2\n  - route:\n    - destination:\n        host: reviews\n        subset: v1","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1588152693,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1203477,"avatar":"https://static001.geekbang.org/account/avatar/00/12/5d/15/7df9df88.jpg","nickname":"3Golds","note":"","ucode":"A27DEF9616432A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":272375,"discussion_content":"确实, 同样的问题。 \n.* 是有效的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590295312,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":334957,"user_name":"Md3zed","can_delete":false,"product_type":"c3","uid":1717785,"ip_address":"","ucode":"83EAD89468ED7B","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/CccT5NgKlZRlTL8f4BsIDqfJ8tRkHPyaR3SXnfgU7acxo2OO7vGzNWjfQBuFnbPPzVYH8Lh49f1jyicuuRSndcA/132","comment_is_top":false,"comment_ctime":1645199897,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100049401,"comment_content":"原理性讲的太少了，感觉就是官方文档的实操","like_count":3},{"had_liked":false,"id":341093,"user_name":"Sam Fu","can_delete":false,"product_type":"c3","uid":1112676,"ip_address":"","ucode":"EA285A4943271F","user_header":"https://static001.geekbang.org/account/avatar/00/10/fa/64/457325e6.jpg","comment_is_top":false,"comment_ctime":1649342285,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100049401,"comment_content":"老师 这个金丝雀发布 是说新服务部署的时候线上会存在两套机器吗？等流量全部切到新版本就把老版本机器下回收掉","like_count":0},{"had_liked":false,"id":335685,"user_name":"静心","can_delete":false,"product_type":"c3","uid":1335457,"ip_address":"","ucode":"EB264FA6519FDA","user_header":"https://static001.geekbang.org/account/avatar/00/14/60/a1/45ffdca3.jpg","comment_is_top":false,"comment_ctime":1645627244,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100049401,"comment_content":"以前一直认为金丝雀发布和A&#47;B测试都属于灰度发布","like_count":0},{"had_liked":false,"id":331647,"user_name":"宸翰Hank.1","can_delete":false,"product_type":"c3","uid":1095060,"ip_address":"","ucode":"8EFB4D50A5CBAB","user_header":"https://static001.geekbang.org/account/avatar/00/10/b5/94/c5ceadf4.jpg","comment_is_top":false,"comment_ctime":1642685086,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100049401,"comment_content":"我用的是istio1.21版本。直接执行k apply -f samples&#47;bookinfo&#47;networking&#47;virtual-service-reviews-80-20.yaml 并没有生效，然后尝试使用k apply -f samples&#47;bookinfo&#47;networking&#47;destination-rule-reviews.yaml 才生效。看了一下这个yaml，是生成了DestinationRule，然后有subsets，virtual-service-reviews-80-20.yaml 的权重才生效。请问为什么老师没执行DestinationRule也可以达到金丝雀","like_count":0,"discussions":[{"author":{"id":1567014,"avatar":"https://static001.geekbang.org/account/avatar/00/17/e9/26/472e16e4.jpg","nickname":"Amosヾ","note":"","ucode":"833F6FCB4042AD","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552912,"discussion_content":"Istio 1.21？？？没有出呢吧？应该是kubernetes 1.21吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645631660,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}