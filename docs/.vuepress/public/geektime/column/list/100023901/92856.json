{"id":92856,"title":"28 | Immutabilityæ¨¡å¼ï¼šå¦‚ä½•åˆ©ç”¨ä¸å˜æ€§è§£å†³å¹¶å‘é—®é¢˜ï¼Ÿ","content":"<p>æˆ‘ä»¬æ›¾ç»è¯´è¿‡ï¼Œâ€œå¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å†™åŒä¸€å…±äº«å˜é‡å­˜åœ¨å¹¶å‘é—®é¢˜â€ï¼Œè¿™é‡Œçš„å¿…è¦æ¡ä»¶ä¹‹ä¸€æ˜¯è¯»å†™ï¼Œå¦‚æœåªæœ‰è¯»ï¼Œè€Œæ²¡æœ‰å†™ï¼Œæ˜¯æ²¡æœ‰å¹¶å‘é—®é¢˜çš„ã€‚</p><p>è§£å†³å¹¶å‘é—®é¢˜ï¼Œå…¶å®æœ€ç®€å•çš„åŠæ³•å°±æ˜¯è®©å…±äº«å˜é‡åªæœ‰è¯»æ“ä½œï¼Œè€Œæ²¡æœ‰å†™æ“ä½œã€‚è¿™ä¸ªåŠæ³•å¦‚æ­¤é‡è¦ï¼Œä»¥è‡³äºè¢«ä¸Šå‡åˆ°äº†ä¸€ç§è§£å†³å¹¶å‘é—®é¢˜çš„è®¾è®¡æ¨¡å¼ï¼š<strong>ä¸å˜æ€§ï¼ˆImmutabilityï¼‰æ¨¡å¼</strong>ã€‚æ‰€è°“<strong>ä¸å˜æ€§ï¼Œç®€å•æ¥è®²ï¼Œå°±æ˜¯å¯¹è±¡ä¸€æ—¦è¢«åˆ›å»ºä¹‹åï¼ŒçŠ¶æ€å°±ä¸å†å‘ç”Ÿå˜åŒ–</strong>ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯å˜é‡ä¸€æ—¦è¢«èµ‹å€¼ï¼Œå°±ä¸å…è®¸ä¿®æ”¹äº†ï¼ˆæ²¡æœ‰å†™æ“ä½œï¼‰ï¼›æ²¡æœ‰ä¿®æ”¹æ“ä½œï¼Œä¹Ÿå°±æ˜¯ä¿æŒäº†ä¸å˜æ€§ã€‚</p><h2>å¿«é€Ÿå®ç°å…·å¤‡ä¸å¯å˜æ€§çš„ç±»</h2><p>å®ç°ä¸€ä¸ªå…·å¤‡ä¸å¯å˜æ€§çš„ç±»ï¼Œè¿˜æ˜¯æŒºç®€å•çš„ã€‚<strong>å°†ä¸€ä¸ªç±»æ‰€æœ‰çš„å±æ€§éƒ½è®¾ç½®æˆfinalçš„ï¼Œå¹¶ä¸”åªå…è®¸å­˜åœ¨åªè¯»æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»åŸºæœ¬ä¸Šå°±å…·å¤‡ä¸å¯å˜æ€§äº†</strong>ã€‚æ›´ä¸¥æ ¼çš„åšæ³•æ˜¯<strong>è¿™ä¸ªç±»æœ¬èº«ä¹Ÿæ˜¯finalçš„</strong>ï¼Œä¹Ÿå°±æ˜¯ä¸å…è®¸ç»§æ‰¿ã€‚å› ä¸ºå­ç±»å¯ä»¥è¦†ç›–çˆ¶ç±»çš„æ–¹æ³•ï¼Œæœ‰å¯èƒ½æ”¹å˜ä¸å¯å˜æ€§ï¼Œæ‰€ä»¥æ¨èä½ åœ¨å®é™…å·¥ä½œä¸­ï¼Œä½¿ç”¨è¿™ç§æ›´ä¸¥æ ¼çš„åšæ³•ã€‚</p><p>Java SDKé‡Œå¾ˆå¤šç±»éƒ½å…·å¤‡ä¸å¯å˜æ€§ï¼Œåªæ˜¯ç”±äºå®ƒä»¬çš„ä½¿ç”¨å¤ªç®€å•ï¼Œæœ€ååè€Œè¢«å¿½ç•¥äº†ã€‚ä¾‹å¦‚ç»å¸¸ç”¨åˆ°çš„Stringå’ŒLongã€Integerã€Doubleç­‰åŸºç¡€ç±»å‹çš„åŒ…è£…ç±»éƒ½å…·å¤‡ä¸å¯å˜æ€§ï¼Œè¿™äº›å¯¹è±¡çš„çº¿ç¨‹å®‰å…¨æ€§éƒ½æ˜¯é ä¸å¯å˜æ€§æ¥ä¿è¯çš„ã€‚å¦‚æœä½ ä»”ç»†ç¿»çœ‹è¿™äº›ç±»çš„å£°æ˜ã€å±æ€§å’Œæ–¹æ³•ï¼Œä½ ä¼šå‘ç°å®ƒä»¬éƒ½ä¸¥æ ¼éµå®ˆä¸å¯å˜ç±»çš„ä¸‰ç‚¹è¦æ±‚ï¼š<strong>ç±»å’Œå±æ€§éƒ½æ˜¯finalçš„ï¼Œæ‰€æœ‰æ–¹æ³•å‡æ˜¯åªè¯»çš„</strong>ã€‚</p><!-- [[[read_end]]] --><p>çœ‹åˆ°è¿™é‡Œä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼ŒJavaçš„Stringæ–¹æ³•ä¹Ÿæœ‰ç±»ä¼¼å­—ç¬¦æ›¿æ¢æ“ä½œï¼Œæ€ä¹ˆèƒ½è¯´æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯åªè¯»çš„å‘¢ï¼Ÿæˆ‘ä»¬ç»“åˆStringçš„æºä»£ç æ¥è§£é‡Šä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼Œä¸‹é¢çš„ç¤ºä¾‹ä»£ç æºè‡ªJava 1.8 SDKï¼Œæˆ‘ç•¥åšäº†ä¿®æ”¹ï¼Œä»…ä¿ç•™äº†å…³é”®å±æ€§value[]å’Œreplace()æ–¹æ³•ï¼Œä½ ä¼šå‘ç°ï¼šStringè¿™ä¸ªç±»ä»¥åŠå®ƒçš„å±æ€§value[]éƒ½æ˜¯finalçš„ï¼›è€Œreplace()æ–¹æ³•çš„å®ç°ï¼Œå°±çš„ç¡®æ²¡æœ‰ä¿®æ”¹value[]ï¼Œè€Œæ˜¯å°†æ›¿æ¢åçš„å­—ç¬¦ä¸²ä½œä¸ºè¿”å›å€¼è¿”å›äº†ã€‚</p><pre><code>public final class String {\n  private final char value[];\n  // å­—ç¬¦æ›¿æ¢\n  String replace(char oldChar, \n      char newChar) {\n    //æ— éœ€æ›¿æ¢ï¼Œç›´æ¥è¿”å›this  \n    if (oldChar == newChar){\n      return this;\n    }\n\n    int len = value.length;\n    int i = -1;\n    /* avoid getfield opcode */\n    char[] val = value; \n    //å®šä½åˆ°éœ€è¦æ›¿æ¢çš„å­—ç¬¦ä½ç½®\n    while (++i &lt; len) {\n      if (val[i] == oldChar) {\n        break;\n      }\n    }\n    //æœªæ‰¾åˆ°oldCharï¼Œæ— éœ€æ›¿æ¢\n    if (i &gt;= len) {\n      return this;\n    } \n    //åˆ›å»ºä¸€ä¸ªbuf[]ï¼Œè¿™æ˜¯å…³é”®\n    //ç”¨æ¥ä¿å­˜æ›¿æ¢åçš„å­—ç¬¦ä¸²\n    char buf[] = new char[len];\n    for (int j = 0; j &lt; i; j++) {\n      buf[j] = val[j];\n    }\n    while (i &lt; len) {\n      char c = val[i];\n      buf[i] = (c == oldChar) ? \n        newChar : c;\n      i++;\n    }\n    //åˆ›å»ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²è¿”å›\n    //åŸå­—ç¬¦ä¸²ä¸ä¼šå‘ç”Ÿä»»ä½•å˜åŒ–\n    return new String(buf, true);\n  }\n}\n</code></pre><p>é€šè¿‡åˆ†æStringçš„å®ç°ï¼Œä½ å¯èƒ½å·²ç»å‘ç°äº†ï¼Œå¦‚æœå…·å¤‡ä¸å¯å˜æ€§çš„ç±»ï¼Œéœ€è¦æä¾›ç±»ä¼¼ä¿®æ”¹çš„åŠŸèƒ½ï¼Œå…·ä½“è¯¥æ€ä¹ˆæ“ä½œå‘¢ï¼Ÿåšæ³•å¾ˆç®€å•ï¼Œé‚£å°±æ˜¯<strong>åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸å¯å˜å¯¹è±¡</strong>ï¼Œè¿™æ˜¯ä¸å¯å˜å¯¹è±¡çš„ä¸€ä¸ªé‡è¦åŒºåˆ«ï¼Œå¯å˜å¯¹è±¡å¾€å¾€æ˜¯ä¿®æ”¹è‡ªå·±çš„å±æ€§ã€‚</p><p>æ‰€æœ‰çš„ä¿®æ”¹æ“ä½œéƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸å¯å˜å¯¹è±¡ï¼Œä½ å¯èƒ½ä¼šæœ‰è¿™ç§æ‹…å¿ƒï¼šæ˜¯ä¸æ˜¯åˆ›å»ºçš„å¯¹è±¡å¤ªå¤šäº†ï¼Œæœ‰ç‚¹å¤ªæµªè´¹å†…å­˜å‘¢ï¼Ÿæ˜¯çš„ï¼Œè¿™æ ·åšçš„ç¡®æœ‰äº›æµªè´¹ï¼Œé‚£å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p><h2>åˆ©ç”¨äº«å…ƒæ¨¡å¼é¿å…åˆ›å»ºé‡å¤å¯¹è±¡</h2><p>å¦‚æœä½ ç†Ÿæ‚‰é¢å‘å¯¹è±¡ç›¸å…³çš„è®¾è®¡æ¨¡å¼ï¼Œç›¸ä¿¡ä½ ä¸€å®šèƒ½æƒ³åˆ°<strong>äº«å…ƒæ¨¡å¼ï¼ˆFlyweight Patternï¼‰ã€‚åˆ©ç”¨äº«å…ƒæ¨¡å¼å¯ä»¥å‡å°‘åˆ›å»ºå¯¹è±¡çš„æ•°é‡ï¼Œä»è€Œå‡å°‘å†…å­˜å ç”¨ã€‚</strong>Javaè¯­è¨€é‡Œé¢Longã€Integerã€Shortã€Byteç­‰è¿™äº›åŸºæœ¬æ•°æ®ç±»å‹çš„åŒ…è£…ç±»éƒ½ç”¨åˆ°äº†äº«å…ƒæ¨¡å¼ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å°±ä»¥Longè¿™ä¸ªç±»ä½œä¸ºä¾‹å­ï¼Œçœ‹çœ‹å®ƒæ˜¯å¦‚ä½•åˆ©ç”¨äº«å…ƒæ¨¡å¼æ¥ä¼˜åŒ–å¯¹è±¡çš„åˆ›å»ºçš„ã€‚</p><p>äº«å…ƒæ¨¡å¼æœ¬è´¨ä¸Šå…¶å®å°±æ˜¯ä¸€ä¸ª<strong>å¯¹è±¡æ± </strong>ï¼Œåˆ©ç”¨äº«å…ƒæ¨¡å¼åˆ›å»ºå¯¹è±¡çš„é€»è¾‘ä¹Ÿå¾ˆç®€å•ï¼šåˆ›å»ºä¹‹å‰ï¼Œé¦–å…ˆå»å¯¹è±¡æ± é‡Œçœ‹çœ‹æ˜¯ä¸æ˜¯å­˜åœ¨ï¼›å¦‚æœå·²ç»å­˜åœ¨ï¼Œå°±åˆ©ç”¨å¯¹è±¡æ± é‡Œçš„å¯¹è±¡ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œå°±ä¼šæ–°åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”æŠŠè¿™ä¸ªæ–°åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡æ”¾è¿›å¯¹è±¡æ± é‡Œã€‚</p><p>Longè¿™ä¸ªç±»å¹¶æ²¡æœ‰ç…§æ¬äº«å…ƒæ¨¡å¼ï¼ŒLongå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªé™æ€çš„å¯¹è±¡æ± ï¼Œä»…ç¼“å­˜äº†[-128,127]ä¹‹é—´çš„æ•°å­—ï¼Œè¿™ä¸ªå¯¹è±¡æ± åœ¨JVMå¯åŠ¨çš„æ—¶å€™å°±åˆ›å»ºå¥½äº†ï¼Œè€Œä¸”è¿™ä¸ªå¯¹è±¡æ± ä¸€ç›´éƒ½ä¸ä¼šå˜åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯é™æ€çš„ã€‚ä¹‹æ‰€ä»¥é‡‡ç”¨è¿™æ ·çš„è®¾è®¡ï¼Œæ˜¯å› ä¸ºLongè¿™ä¸ªå¯¹è±¡çš„çŠ¶æ€å…±æœ‰ 2<sup>64</sup> ç§ï¼Œå®åœ¨å¤ªå¤šï¼Œä¸å®œå…¨éƒ¨ç¼“å­˜ï¼Œè€Œ[-128,127]ä¹‹é—´çš„æ•°å­—åˆ©ç”¨ç‡æœ€é«˜ã€‚ä¸‹é¢çš„ç¤ºä¾‹ä»£ç å‡ºè‡ªJava 1.8ï¼ŒvalueOf()æ–¹æ³•å°±ç”¨åˆ°äº†LongCacheè¿™ä¸ªç¼“å­˜ï¼Œä½ å¯ä»¥ç»“åˆç€æ¥åŠ æ·±ç†è§£ã€‚</p><pre><code>Long valueOf(long l) {\n  final int offset = 128;\n  // [-128,127]ç›´æ¥çš„æ•°å­—åšäº†ç¼“å­˜\n  if (l &gt;= -128 &amp;&amp; l &lt;= 127) { \n    return LongCache\n      .cache[(int)l + offset];\n  }\n  return new Long(l);\n}\n//ç¼“å­˜ï¼Œç­‰ä»·äºå¯¹è±¡æ± \n//ä»…ç¼“å­˜[-128,127]ç›´æ¥çš„æ•°å­—\nstatic class LongCache {\n  static final Long cache[] \n    = new Long[-(-128) + 127 + 1];\n\n  static {\n    for(int i=0; i&lt;cache.length; i++)\n      cache[i] = new Long(i-128);\n  }\n}\n</code></pre><p>å‰é¢æˆ‘ä»¬åœ¨<a href=\"https://time.geekbang.org/column/article/87749\">ã€Š13 | ç†è®ºåŸºç¡€æ¨¡å—çƒ­ç‚¹é—®é¢˜ç­”ç–‘ã€‹</a>ä¸­æåˆ°â€œInteger å’Œ String ç±»å‹çš„å¯¹è±¡ä¸é€‚åˆåšé”â€ï¼Œå…¶å®åŸºæœ¬ä¸Šæ‰€æœ‰çš„åŸºç¡€ç±»å‹çš„åŒ…è£…ç±»éƒ½ä¸é€‚åˆåšé”ï¼Œå› ä¸ºå®ƒä»¬å†…éƒ¨ç”¨åˆ°äº†äº«å…ƒæ¨¡å¼ï¼Œè¿™ä¼šå¯¼è‡´çœ‹ä¸Šå»ç§æœ‰çš„é”ï¼Œå…¶å®æ˜¯å…±æœ‰çš„ã€‚ä¾‹å¦‚åœ¨ä¸‹é¢ä»£ç ä¸­ï¼Œæœ¬æ„æ˜¯Aç”¨é”alï¼ŒBç”¨é”blï¼Œå„è‡ªç®¡ç†å„è‡ªçš„ï¼Œäº’ä¸å½±å“ã€‚ä½†å®é™…ä¸Šalå’Œblæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç»“æœAå’ŒBå…±ç”¨çš„æ˜¯ä¸€æŠŠé”ã€‚</p><pre><code>class A {\n  Long al=Long.valueOf(1);\n  public void setAX(){\n    synchronized (al) {\n      //çœç•¥ä»£ç æ— æ•°\n    }\n  }\n}\nclass B {\n  Long bl=Long.valueOf(1);\n  public void setBY(){\n    synchronized (bl) {\n      //çœç•¥ä»£ç æ— æ•°\n    }\n  }\n}\n</code></pre><h2>ä½¿ç”¨Immutabilityæ¨¡å¼çš„æ³¨æ„äº‹é¡¹</h2><p>åœ¨ä½¿ç”¨Immutabilityæ¨¡å¼çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p><ol>\n<li>å¯¹è±¡çš„æ‰€æœ‰å±æ€§éƒ½æ˜¯finalçš„ï¼Œå¹¶ä¸èƒ½ä¿è¯ä¸å¯å˜æ€§ï¼›</li>\n<li>ä¸å¯å˜å¯¹è±¡ä¹Ÿéœ€è¦æ­£ç¡®å‘å¸ƒã€‚</li>\n</ol><p>åœ¨Javaè¯­è¨€ä¸­ï¼Œfinalä¿®é¥°çš„å±æ€§ä¸€æ—¦è¢«èµ‹å€¼ï¼Œå°±ä¸å¯ä»¥å†ä¿®æ”¹ï¼Œä½†æ˜¯å¦‚æœå±æ€§çš„ç±»å‹æ˜¯æ™®é€šå¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ªæ™®é€šå¯¹è±¡çš„å±æ€§æ˜¯å¯ä»¥è¢«ä¿®æ”¹çš„ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ä¸­ï¼ŒBarçš„å±æ€§fooè™½ç„¶æ˜¯finalçš„ï¼Œä¾ç„¶å¯ä»¥é€šè¿‡setAge()æ–¹æ³•æ¥è®¾ç½®fooçš„å±æ€§ageã€‚æ‰€ä»¥ï¼Œ<strong>åœ¨ä½¿ç”¨Immutabilityæ¨¡å¼çš„æ—¶å€™ä¸€å®šè¦ç¡®è®¤ä¿æŒä¸å˜æ€§çš„è¾¹ç•Œåœ¨å“ªé‡Œï¼Œæ˜¯å¦è¦æ±‚å±æ€§å¯¹è±¡ä¹Ÿå…·å¤‡ä¸å¯å˜æ€§</strong>ã€‚</p><pre><code>class Foo{\n  int age=0;\n  int name=&quot;abc&quot;;\n}\nfinal class Bar {\n  final Foo foo;\n  void setAge(int a){\n    foo.age=a;\n  }\n}\n</code></pre><p>ä¸‹é¢æˆ‘ä»¬å†çœ‹çœ‹å¦‚ä½•æ­£ç¡®åœ°å‘å¸ƒä¸å¯å˜å¯¹è±¡ã€‚ä¸å¯å˜å¯¹è±¡è™½ç„¶æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯å¹¶ä¸æ„å‘³ç€å¼•ç”¨è¿™äº›ä¸å¯å˜å¯¹è±¡çš„å¯¹è±¡å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä¾‹å¦‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼ŒFooå…·å¤‡ä¸å¯å˜æ€§ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯ç±»Barå¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œç±»Barä¸­æŒæœ‰å¯¹Fooçš„å¼•ç”¨fooï¼Œå¯¹fooè¿™ä¸ªå¼•ç”¨çš„ä¿®æ”¹åœ¨å¤šçº¿ç¨‹ä¸­å¹¶ä¸èƒ½ä¿è¯å¯è§æ€§å’ŒåŸå­æ€§ã€‚</p><pre><code>//Fooçº¿ç¨‹å®‰å…¨\nfinal class Foo{\n  final int age=0;\n  final int name=&quot;abc&quot;;\n}\n//Barçº¿ç¨‹ä¸å®‰å…¨\nclass Bar {\n  Foo foo;\n  void setFoo(Foo f){\n    this.foo=f;\n  }\n}\n</code></pre><p>å¦‚æœä½ çš„ç¨‹åºä»…ä»…éœ€è¦fooä¿æŒå¯è§æ€§ï¼Œæ— éœ€ä¿è¯åŸå­æ€§ï¼Œé‚£ä¹ˆå¯ä»¥å°†fooå£°æ˜ä¸ºvolatileå˜é‡ï¼Œè¿™æ ·å°±èƒ½ä¿è¯å¯è§æ€§ã€‚å¦‚æœä½ çš„ç¨‹åºéœ€è¦ä¿è¯åŸå­æ€§ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡åŸå­ç±»æ¥å®ç°ã€‚ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æ˜¯åˆç†åº“å­˜çš„åŸå­åŒ–å®ç°ï¼Œä½ åº”è¯¥å¾ˆç†Ÿæ‚‰äº†ï¼Œå…¶ä¸­å°±æ˜¯ç”¨åŸå­ç±»è§£å†³äº†ä¸å¯å˜å¯¹è±¡å¼•ç”¨çš„åŸå­æ€§é—®é¢˜ã€‚</p><pre><code>public class SafeWM {\n  class WMRange{\n    final int upper;\n    final int lower;\n    WMRange(int upper,int lower){\n    //çœç•¥æ„é€ å‡½æ•°å®ç°\n    }\n  }\n  final AtomicReference&lt;WMRange&gt;\n    rf = new AtomicReference&lt;&gt;(\n      new WMRange(0,0)\n    );\n  // è®¾ç½®åº“å­˜ä¸Šé™\n  void setUpper(int v){\n    while(true){\n      WMRange or = rf.get();\n      // æ£€æŸ¥å‚æ•°åˆæ³•æ€§\n      if(v &lt; or.lower){\n        throw new IllegalArgumentException();\n      }\n      WMRange nr = new\n          WMRange(v, or.lower);\n      if(rf.compareAndSet(or, nr)){\n        return;\n      }\n    }\n  }\n}\n</code></pre><h2>æ€»ç»“</h2><p>åˆ©ç”¨Immutabilityæ¨¡å¼è§£å†³å¹¶å‘é—®é¢˜ï¼Œä¹Ÿè®¸ä½ è§‰å¾—æœ‰ç‚¹é™Œç”Ÿï¼Œå…¶å®ä½ å¤©å¤©éƒ½åœ¨äº«å—å®ƒçš„æˆ˜æœã€‚Javaè¯­è¨€é‡Œé¢çš„Stringå’ŒLongã€Integerã€Doubleç­‰åŸºç¡€ç±»å‹çš„åŒ…è£…ç±»éƒ½å…·å¤‡ä¸å¯å˜æ€§ï¼Œè¿™äº›å¯¹è±¡çš„çº¿ç¨‹å®‰å…¨æ€§éƒ½æ˜¯é ä¸å¯å˜æ€§æ¥ä¿è¯çš„ã€‚Immutabilityæ¨¡å¼æ˜¯æœ€ç®€å•çš„è§£å†³å¹¶å‘é—®é¢˜çš„æ–¹æ³•ï¼Œå»ºè®®å½“ä½ è¯•å›¾è§£å†³ä¸€ä¸ªå¹¶å‘é—®é¢˜æ—¶ï¼Œå¯ä»¥é¦–å…ˆå°è¯•ä¸€ä¸‹Immutabilityæ¨¡å¼ï¼Œçœ‹æ˜¯å¦èƒ½å¤Ÿå¿«é€Ÿè§£å†³ã€‚</p><p>å…·å¤‡ä¸å˜æ€§çš„å¯¹è±¡ï¼Œåªæœ‰ä¸€ç§çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€ç”±å¯¹è±¡å†…éƒ¨æ‰€æœ‰çš„ä¸å˜å±æ€§å…±åŒå†³å®šã€‚å…¶å®è¿˜æœ‰ä¸€ç§æ›´ç®€å•çš„ä¸å˜æ€§å¯¹è±¡ï¼Œé‚£å°±æ˜¯<strong>æ— çŠ¶æ€</strong>ã€‚æ— çŠ¶æ€å¯¹è±¡å†…éƒ¨æ²¡æœ‰å±æ€§ï¼Œåªæœ‰æ–¹æ³•ã€‚é™¤äº†æ— çŠ¶æ€çš„å¯¹è±¡ï¼Œä½ å¯èƒ½è¿˜å¬è¯´è¿‡æ— çŠ¶æ€çš„æœåŠ¡ã€æ— çŠ¶æ€çš„åè®®ç­‰ç­‰ã€‚æ— çŠ¶æ€æœ‰å¾ˆå¤šå¥½å¤„ï¼Œæœ€æ ¸å¿ƒçš„ä¸€ç‚¹å°±æ˜¯æ€§èƒ½ã€‚åœ¨å¤šçº¿ç¨‹é¢†åŸŸï¼Œæ— çŠ¶æ€å¯¹è±¡æ²¡æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œæ— éœ€åŒæ­¥å¤„ç†ï¼Œè‡ªç„¶æ€§èƒ½å¾ˆå¥½ï¼›åœ¨åˆ†å¸ƒå¼é¢†åŸŸï¼Œæ— çŠ¶æ€æ„å‘³ç€å¯ä»¥æ— é™åœ°æ°´å¹³æ‰©å±•ï¼Œæ‰€ä»¥åˆ†å¸ƒå¼é¢†åŸŸé‡Œé¢æ€§èƒ½çš„ç“¶é¢ˆä¸€å®šä¸æ˜¯å‡ºåœ¨æ— çŠ¶æ€çš„æœåŠ¡èŠ‚ç‚¹ä¸Šã€‚</p><h2>è¯¾åæ€è€ƒ</h2><p>ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼ŒAccountçš„å±æ€§æ˜¯finalçš„ï¼Œå¹¶ä¸”åªæœ‰getæ–¹æ³•ï¼Œé‚£è¿™ä¸ªç±»æ˜¯ä¸æ˜¯å…·å¤‡ä¸å¯å˜æ€§å‘¢ï¼Ÿ</p><pre><code>public final class Account{\n  private final \n    StringBuffer user;\n  public Account(String user){\n    this.user = \n      new StringBuffer(user);\n  }\n  \n  public StringBuffer getUser(){\n    return this.user;\n  }\n  public String toString(){\n    return &quot;user&quot;+user;\n  }\n}\n</code></pre><p>æ¬¢è¿åœ¨ç•™è¨€åŒºä¸æˆ‘åˆ†äº«ä½ çš„æƒ³æ³•ï¼Œä¹Ÿæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºè®°å½•ä½ çš„æ€è€ƒè¿‡ç¨‹ã€‚æ„Ÿè°¢é˜…è¯»ï¼Œå¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ã€‚</p><p></p>","neighbors":{"left":{"article_title":"27 | å¹¶å‘å·¥å…·ç±»æ¨¡å—çƒ­ç‚¹é—®é¢˜ç­”ç–‘","id":92849},"right":{"article_title":"29 | Copy-on-Writeæ¨¡å¼ï¼šä¸æ˜¯å»¶æ—¶ç­–ç•¥çš„COW","id":93154}},"comments":[{"had_liked":false,"id":90996,"user_name":"Jialin","can_delete":false,"product_type":"c1","uid":1112955,"ip_address":"","ucode":"12583269732A75","user_header":"https://static001.geekbang.org/account/avatar/00/10/fb/7b/2d4b38fb.jpg","comment_is_top":false,"comment_ctime":1556778641,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"474003181201","product_id":100023901,"comment_content":"æ ¹æ®æ–‡ç« å†…å®¹,ä¸€ä¸ªç±»å…·å¤‡ä¸å¯å˜å±æ€§éœ€è¦æ»¡è¶³&quot;ç±»å’Œå±æ€§éƒ½å¿…é¡»æ˜¯ final çš„,æ‰€æœ‰æ–¹æ³•å‡æ˜¯åªè¯»çš„&quot;,ç±»çš„å±æ€§å¦‚æœæ˜¯å¼•ç”¨å‹,è¯¥å±æ€§å¯¹åº”çš„ç±»ä¹Ÿéœ€è¦æ»¡è¶³ä¸å¯å˜ç±»çš„æ¡ä»¶,ä¸”ä¸èƒ½æä¾›ä¿®æ”¹è¯¥å±æ€§çš„æ–¹æ³•,<br>Accountç±»çš„å”¯ä¸€å±æ€§useræ˜¯finalçš„,æä¾›çš„æ–¹æ³•æ˜¯å¯è¯»çš„,userçš„ç±»å‹æ˜¯StringBuffer,StringBufferä¹Ÿæ˜¯finalçš„,è¿™æ ·çœ‹æ¥,Accountç±»æ˜¯ä¸å¯å˜æ€§çš„,ä½†æ˜¯å»çœ‹StringBufferçš„æºç ,ä½ ä¼šå‘ç°StringBufferç±»çš„å±æ€§valueæ˜¯å¯å˜çš„&lt;Stringç±»ä¸­çš„valueå®šä¹‰:private final char value[];StringBufferç±»ä¸­çš„valueå®šä¹‰:char[] value;&gt;,å¹¶ä¸”æä¾›äº†append(Object object)å’ŒsetCharAt(int index, char ch)ä¿®æ”¹value.<br>æ‰€ä»¥,Accountç±»ä¸å…·å¤‡ä¸å¯å˜æ€§","like_count":111,"discussions":[{"author":{"id":1156592,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a5/f0/8648c464.jpg","nickname":"Joker","note":"","ucode":"126AF848001A1E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":46197,"discussion_content":"è€å“¥ï¼Œç¨³","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1573130053,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2014573,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/bd/6d/7010f98e.jpg","nickname":"SharpBB","note":"","ucode":"D30C5B798B8E8C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576329,"discussion_content":"æ€»ç»“å°±æ˜¯ è™½ç„¶è®¾ç½®äº†final ä½†æ˜¯è¿˜å¾—çœ‹èµ·å†…éƒ¨å±æ€§ çœŸè¦ä¸å¯å˜ å…¨è®¾ç½®ä¸ºfinal","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655436275,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2436755,"avatar":"https://static001.geekbang.org/account/avatar/00/25/2e/93/81e3e4ca.jpg","nickname":"à¸…Slekà¸…","note":"","ucode":"B732C672B3D301","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549695,"discussion_content":"å­¦ä¹ äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644213862,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1812970,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a9/ea/5bfce6c5.jpg","nickname":"mgs2002","note":"","ucode":"F5931108BD509B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311799,"discussion_content":"åŸæ¥å¦‚æ­¤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602491617,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1111870,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK2Az5uTh9ZGVA7yQCj1BXtXuicPRkvJicA97AoN9xX3bnPcUYglTMXJeZeoVbPQeJA7ICvQhR3KQ0w/132","nickname":"æ—¥ä¸è½å¸å›½","note":"","ucode":"6A11ABBD8AC438","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":13612,"discussion_content":"å­¦ä¹ äº†ï¼Œå¼ºğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568690191,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91379,"user_name":"æœ¨å«å…­","can_delete":false,"product_type":"c1","uid":1199495,"ip_address":"","ucode":"D113DF578C5BF5","user_header":"https://static001.geekbang.org/account/avatar/00/12/4d/87/57236a2d.jpg","comment_is_top":false,"comment_ctime":1557019646,"is_pvip":true,"replies":[{"id":"34443","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":91379,"uid":"1269969","ip_address":"","utype":1,"ctime":1558359232,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":3,"race_medal":0,"score":"336564468734","product_id":100023901,"comment_content":"è¿™æ®µä»£ç åº”è¯¥æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†å®ƒä¸æ˜¯ä¸å¯å˜æ¨¡å¼ã€‚StringBufferåªæ˜¯å­—æ®µå¼•ç”¨ä¸å¯å˜ï¼Œå€¼æ˜¯å¯ä»¥è°ƒç”¨StringBufferçš„æ–¹æ³•æ”¹å˜çš„ï¼Œè¿™ä¸ªéœ€è¦æ”¹æˆæŠŠå­—æ®µæ”¹æˆStringè¿™æ ·çš„ä¸å¯å˜å¯¹è±¡æ¥è§£å†³ã€‚<br>","like_count":79,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448899,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558359232,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2827987,"avatar":"","nickname":"Geek_3223a1","note":"","ucode":"02471FF2DAF55A","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":563393,"discussion_content":"ä½¿ç”¨Stringå’Œè¿™ä¸ªä¾‹å­å°±æ— å…³äº†ï¼Œå› ä¸ºStringæ²¡æœ‰æ–¹æ³•ç”¨æ¥æ”¹å˜charæ•°ç»„çš„å€¼çš„æ–¹æ³•ã€‚è€ŒåŸºç¡€ç±»å‹å’ŒåŸºç¡€ç±»å‹å¯¹è±¡æ•°ç»„ï¼Œæˆ‘éƒ½è¯•äº†ï¼Œå¹¶ä¸èƒ½ä¿è¯ä¸å¯å˜æ€§ã€‚å¹¶ä¸”å¦‚æœä½¿ç”¨String çš„å¼•ç”¨ä¿®æ”¹ï¼Œå’Œfinalçš„ä¸å¯å˜æ€§æ— å…³äº†ï¼Œè¿™æ˜¯å› ä¸ºjavaé‡Œé¢çš„å¼•ç”¨çš„ä¸å¯ä¼ é€’æ€§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649988265,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":448899,"ip_address":""},"score":563393,"extra":""}]},{"author":{"id":1111870,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK2Az5uTh9ZGVA7yQCj1BXtXuicPRkvJicA97AoN9xX3bnPcUYglTMXJeZeoVbPQeJA7ICvQhR3KQ0w/132","nickname":"æ—¥ä¸è½å¸å›½","note":"","ucode":"6A11ABBD8AC438","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":13613,"discussion_content":"å­¦ä¹ äº†ï¼Œå¼ºæ‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568690238,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":118299,"user_name":"æ‹¯æ•‘åœ°çƒå¥½ç´¯","can_delete":false,"product_type":"c1","uid":1339022,"ip_address":"","ucode":"7643439601EF4C","user_header":"https://static001.geekbang.org/account/avatar/00/14/6e/8e/5d309a85.jpg","comment_is_top":false,"comment_ctime":1564314201,"is_pvip":false,"replies":[{"id":"43316","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":118299,"uid":"1269969","ip_address":"","utype":1,"ctime":1564318233,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"169068038745","product_id":100023901,"comment_content":"---æ€»ç»“---<br>1. ä¸å¯å˜ç±»çš„ç‰¹ç‚¹ï¼šç±»ã€å±æ€§éƒ½æ˜¯finalçš„ï¼Œæ–¹æ³•æ˜¯åªè¯»çš„<br>2. ä¸ºäº†è§£å†³æœ‰äº›ä¸å¯å˜ç±»æ¯æ¬¡åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡å¯¼è‡´å†…å­˜æµªè´¹çš„é—®é¢˜ï¼šäº«å…ƒæ¨¡å¼&#47;å¯¹è±¡æ± <br>3. æ³¨æ„äº‹é¡¹ï¼šåŒºåˆ«å¼•ç”¨ä¸å¯å˜å’Œå®é™…å†…å®¹ä¸å¯å˜<br>4. æ›´ç®€å•çš„ä¸å¯å˜å¯¹è±¡ï¼šæ— çŠ¶æ€å¯¹è±¡","like_count":40,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460349,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564318233,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91592,"user_name":"å¼ å¤©å±¹","can_delete":false,"product_type":"c1","uid":1477612,"ip_address":"","ucode":"8BD6BD6DCF0F4F","user_header":"https://static001.geekbang.org/account/avatar/00/16/8b/ec/dc03f5ad.jpg","comment_is_top":false,"comment_ctime":1557057913,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"87456403833","product_id":100023901,"comment_content":"å…·ä¸å…·å¤‡ä¸å¯å˜æ€§çœ‹æ€ä¹ˆç•Œå®šè¾¹ç•Œäº†ï¼Œç±»æœ¬èº«æ˜¯å…·å¤‡çš„ï¼ŒStrnigBufferçš„å¼•ç”¨ä¸å¯å˜ã€‚ä½†æ˜¯å› ä¸ºStringBufferæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒæŒæœ‰éfinalçš„charæ•°ç»„ï¼Œæ‰€ä»¥åº•å±‚æ•°ç»„æ˜¯å¯å˜çš„ã€‚ä½†æ˜¯StringBufferæ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œå› ä¸ºæ–¹æ³•åŠ é”synchronized","like_count":21},{"had_liked":false,"id":97573,"user_name":"ç‚ç‚","can_delete":false,"product_type":"c1","uid":1143280,"ip_address":"","ucode":"D7F93624E014FC","user_header":"https://static001.geekbang.org/account/avatar/00/11/71/f0/be872719.jpg","comment_is_top":false,"comment_ctime":1558699298,"is_pvip":false,"replies":[{"id":"34883","content":"æ„Ÿè°¢ä¸€è·¯ç›¸ä¼´ğŸ˜„","user_name":"ä½œè€…å›å¤","comment_id":97573,"uid":"1269969","ip_address":"","utype":1,"ctime":1558701937,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"65983208738","product_id":100023901,"comment_content":"è¿™ä¸ªä¸“æ ä¸€ç›´çœ‹åˆ°è¿™å„¿ï¼ŒçœŸçš„å¾ˆæ£’ï¼Œè¯¾åé—®é¢˜ä¹Ÿå¾ˆå¥½ï¼Œè®©æˆ‘å¯¹å¹¶å‘ç¼–ç¨‹æœ‰äº†ä¸€ä¸ªæ•´ä½“çš„äº†è§£ï¼Œä¹‹å‰çœ‹ä¹¦ä¸€ç›´çœ‹ä¸æ‡‚ï¼Œè€å¸ˆå¸¦ç€æ¢³ç†ä¸€éï¼Œçœ‹ä¹¦ä¹Ÿå®¹æ˜“å¤šäº†ï¼Œéå¸¸æ„Ÿè°¢è€å¸ˆï¼Œå¸Œæœ›è€å¸ˆå†å‡ºä¸“æ ","like_count":16,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451329,"discussion_content":"æ„Ÿè°¢ä¸€è·¯ç›¸ä¼´ğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558701937,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":93963,"user_name":"å¤šè¥„ä¸¸","can_delete":false,"product_type":"c1","uid":1074310,"ip_address":"","ucode":"1AA1497C5A293C","user_header":"https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg","comment_is_top":false,"comment_ctime":1557677890,"is_pvip":false,"replies":[{"id":"33672","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":93963,"uid":"1269969","ip_address":"","utype":1,"ctime":1557757779,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"48802318146","product_id":100023901,"comment_content":"final StringBuffer user;<br><br>StingBuffer æ˜¯ å¼•ç”¨ ç±»å‹ï¼Œ å½“æˆ‘ä»¬è¯´å®ƒfinal StingBuffer user ä¸å¯å˜æ—¶ï¼Œå®é™…ä¸Šè¯´çš„æ˜¯å®ƒuseræŒ‡å‘å †å†…å­˜çš„åœ°å€ä¸å¯å˜ï¼Œ ä½†å †å†…å­˜çš„userå¯¹è±¡ï¼Œé€šè¿‡sub append æ–¹æ³•å®é™…æ˜¯å¯å˜çš„â€¦â€¦","like_count":12,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":449845,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557757779,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":161263,"user_name":"æ°´æ»´s","can_delete":false,"product_type":"c1","uid":1264431,"ip_address":"","ucode":"1C684514B54B6F","user_header":"https://static001.geekbang.org/account/avatar/00/13/4b/2f/2f73fd52.jpg","comment_is_top":false,"comment_ctime":1576158920,"is_pvip":false,"replies":[{"id":"62466","content":"ä¸¥æ ¼è®²ä½ æ˜¯å¯¹çš„ï¼Œä»…ä»…æ˜¯è®¾ç½®å±æ€§è¿™ä¸ªæ“ä½œä¸æ¶‰åŠåŸå­æ€§ã€‚åªæœ‰ç±»ä¼¼foo=new Foo()ï¼Œè¿™ç§ç»„åˆæ“ä½œæ—¶æ‰ä¼šæœ‰åŸå­æ€§é—®é¢˜ï¼Œè¿™æ—¶å€™çš„åŸå­æ€§å‡ºåœ¨fooçš„å±æ€§ä¸Šï¼Œè€Œä¸æ˜¯barçš„å±æ€§fooä¸Šã€‚å¯¹è±¡èµ‹å€¼çš„åŸå­æ€§é—®é¢˜ä¸€èˆ¬éƒ½æ˜¯å› ä¸ºç»„åˆæ“ä½œã€‚","user_name":"ä½œè€…å›å¤","comment_id":161263,"uid":"1269969","ip_address":"","utype":1,"ctime":1577002979,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":2,"race_medal":0,"score":"40230864584","product_id":100023901,"comment_content":"è€å¸ˆï¼Œé—®ä¸‹ Barè¿™ä¸ªç±»çš„fooå±æ€§çš„è®¾å€¼åœ¨å¤šçº¿ç¨‹ä¸‹ä¸ºä»€ä¹ˆä¼šæœ‰åŸå­æ€§é—®é¢˜ï¼Œæˆ‘ç†è§£çš„åªä¼šæœ‰å¯è§æ€§é—®é¢˜ï¼Ÿ","like_count":10,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477668,"discussion_content":"ä¸¥æ ¼è®²ä½ æ˜¯å¯¹çš„ï¼Œä»…ä»…æ˜¯è®¾ç½®å±æ€§è¿™ä¸ªæ“ä½œä¸æ¶‰åŠåŸå­æ€§ã€‚åªæœ‰ç±»ä¼¼foo=new Foo()ï¼Œè¿™ç§ç»„åˆæ“ä½œæ—¶æ‰ä¼šæœ‰åŸå­æ€§é—®é¢˜ï¼Œè¿™æ—¶å€™çš„åŸå­æ€§å‡ºåœ¨fooçš„å±æ€§ä¸Šï¼Œè€Œä¸æ˜¯barçš„å±æ€§fooä¸Šã€‚å¯¹è±¡èµ‹å€¼çš„åŸå­æ€§é—®é¢˜ä¸€èˆ¬éƒ½æ˜¯å› ä¸ºç»„åˆæ“ä½œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577002979,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1570872,"avatar":"https://static001.geekbang.org/account/avatar/00/17/f8/38/41bd3639.jpg","nickname":"å°é©¬çˆ¹","note":"","ucode":"139FCF2C668343","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":571156,"discussion_content":"ä¸å¤ªç†è§£ï¼Œè¿™é‡Œnewæ“ä½œçš„é—®é¢˜ä¸æ˜¯å‡ºåœ¨æœ‰åºæ€§ä¸Šå—ï¼Ÿnewçš„æ—¶å€™cpuçš„æŒ‡ä»¤é›†é¡ºåºå¯èƒ½æœ‰å˜åŒ–ï¼Œå¯¼è‡´å­—æ®µæœªèµ‹å€¼æˆåŠŸï¼Œä½†æ˜¯volatileå¯ä»¥ä¿è¯æœ‰åºæ€§çš„é—®é¢˜ã€‚è¿™ä¸ªåŸå­æ€§è¿˜æ˜¯ä¸å¤ªç†è§£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652090541,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":477668,"ip_address":""},"score":571156,"extra":""}]}]},{"had_liked":false,"id":91421,"user_name":"å¯¹è±¡æ­£åœ¨è¾“å…¥...","can_delete":false,"product_type":"c1","uid":1446254,"ip_address":"","ucode":"BA370176043636","user_header":"https://static001.geekbang.org/account/avatar/00/16/11/6e/897bd526.jpg","comment_is_top":false,"comment_ctime":1557034317,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"31621805389","product_id":100023901,"comment_content":"ä¸å¯å˜ç±»çš„ä¸‰ä¸ªè¦æ±‚ : ç±»å’Œå±æ€§éƒ½æ˜¯ final çš„ï¼Œæ‰€æœ‰æ–¹æ³•å‡æ˜¯åªè¯»çš„<br>è¿™é‡Œçš„StringBufferä¼ è¿›æ¥çš„åªæ˜¯ä¸ªå¼•ç”¨ï¼Œè°ƒç”¨æ–¹å¯ä»¥ä¿®æ”¹ï¼Œæ‰€ä»¥è¿™ä¸ªç±»ä¸å…·å¤‡ä¸å¯å˜æ€§ã€‚<br><br>","like_count":8,"discussions":[{"author":{"id":1018620,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8a/fc/d1dd57dd.jpg","nickname":"ipofss","note":"","ucode":"DE3061C9259F9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":40014,"discussion_content":"ç®€å•æ¸…æ™°çš„å›ç­”ï¼Œç›´å‡»è¦å®³","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572060083,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":227725,"user_name":"æ±¤å°é«˜","can_delete":false,"product_type":"c1","uid":1555565,"ip_address":"","ucode":"D4AB7766273D52","user_header":"https://static001.geekbang.org/account/avatar/00/17/bc/6d/f6f0a442.jpg","comment_is_top":false,"comment_ctime":1592464710,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"23067301190","product_id":100023901,"comment_content":"Immutabilityæ¨¡åŸç†å¼„æ¸…æ¥šäº†ï¼Œä½†æ˜¯å¯¹äºImmutabilityæ¨¡å¼çš„åº”ç”¨åœºæ™¯è¿˜ä¸æ˜¯å¾ˆæ˜ç™½ï¼Œæˆ‘çš„ç–‘æƒ‘æ˜¯æ—¢ç„¶å…±äº«å˜é‡æ˜¯åªè¯»çš„ï¼Œé‚£å°±æ²¡å¿…è¦åŠ é”äº†ï¼Œå„ä¸ªçº¿ç¨‹éƒ½è¯»å°±è¡Œäº†ï¼Œä¸ºå•¥è¿˜è¦ç”¨Immutabilityæ¨¡å¼äº†ï¼Œå› ä¸ºå¦‚æœå…±äº«å˜é‡å­˜åœ¨è¯»å†™æƒ…å†µï¼Œå°±ä¼šåŠ é”äº†ï¼Œä¹Ÿä¸ä¼šç”¨åˆ°Immutabilityæ¨¡å¼ï¼Œå¸Œæœ›è€å¸ˆè§£æƒ‘ï¼Œè°¢è°¢","like_count":6,"discussions":[{"author":{"id":1104818,"avatar":"https://static001.geekbang.org/account/avatar/00/10/db/b2/29b4f22b.jpg","nickname":"JasonZ","note":"","ucode":"992193AE44C39C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384476,"discussion_content":"ä¸å¯å˜ç±»çš„ä½œç”¨æ˜¯å¯ä»¥é‡å¤ä½¿ç”¨ã€èŠ‚çœå­˜å‚¨ç©ºé—´","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626608480,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1881786,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/b6/ba/f76d996b.jpg","nickname":"æœºè½¦","note":"","ucode":"CD32A645AE310A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383682,"discussion_content":"åŒé—®ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626188228,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1446504,"avatar":"https://static001.geekbang.org/account/avatar/00/16/12/68/3ee88032.jpg","nickname":"Libraä¸¶ç©ºç™½","note":"","ucode":"0A0631146D6D15","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295449,"discussion_content":"æˆ‘ä¹Ÿæ˜¯æœ‰åŒæ ·çš„ç–‘é—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596197892,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99896,"user_name":"Hour","can_delete":false,"product_type":"c1","uid":1448748,"ip_address":"","ucode":"AA1045ACABC0BB","user_header":"https://static001.geekbang.org/account/avatar/00/16/1b/2c/6b3c0911.jpg","comment_is_top":false,"comment_ctime":1559354421,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"23034190901","product_id":100023901,"comment_content":"&#47;&#47;Foo çº¿ç¨‹å®‰å…¨<br>final class Foo{<br>  final int age=0;<br>  final int name=&quot;abc&quot;;<br>}<br>&#47;&#47;Bar çº¿ç¨‹ä¸å®‰å…¨<br>class Bar {<br>  Foo foo;<br>  void setFoo(Foo f){<br>    this.foo=f;<br>  }<br>}<br>è€å¸ˆå¥½ï¼Œå¯¹fooçš„å¼•ç”¨å’Œä¿®æ”¹åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å¹¶ä¸èƒ½ä¿è¯åŸå­æ€§å’Œå¯è§æ€§ï¼Œè¿™å¥è¯æ€ä¹ˆç†è§£ï¼Œèƒ½ç”¨å…·ä½“çš„ä¾‹å­è¯´æ˜ä¸€ä¸‹å—ï¼Ÿ","like_count":6,"discussions":[{"author":{"id":1268264,"avatar":"https://static001.geekbang.org/account/avatar/00/13/5a/28/732d3f2f.jpg","nickname":"GEEKBANG_6638780","note":"","ucode":"952194E56FD8C8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530492,"discussion_content":"æˆ‘è¯´æˆ‘çš„ç†è§£ï¼ŒFooå¯¹è±¡çš„åˆ›å»ºæ˜¯newå‡ºæ¥ï¼Œnewæ“ä½œä¸æ˜¯åŸå­çš„ã€‚æ‰€ä»¥ï¼Œvolatileå¯ä»¥ä¿è¯å†…å­˜åœ°å€å¯è§ï¼Œä½†å€¼ä¸ä¸€å®šæ­£ç¡®ã€‚æ‰€ä»¥ï¼Œå¦‚æœæƒ³ä¿è¯åŸå­æ€§ï¼Œé‚£åªèƒ½é€šè¿‡AtomicReferenceæ•´ä¸ªæ›¿æ¢","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1637077294,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":1,"child_discussions":[{"author":{"id":1570872,"avatar":"https://static001.geekbang.org/account/avatar/00/17/f8/38/41bd3639.jpg","nickname":"å°é©¬çˆ¹","note":"","ucode":"139FCF2C668343","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1268264,"avatar":"https://static001.geekbang.org/account/avatar/00/13/5a/28/732d3f2f.jpg","nickname":"GEEKBANG_6638780","note":"","ucode":"952194E56FD8C8","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571155,"discussion_content":"ä¸å¤ªç†è§£ï¼Œè¿™é‡Œnewæ“ä½œçš„é—®é¢˜ä¸æ˜¯å‡ºåœ¨æœ‰åºæ€§ä¸Šå—ï¼Ÿnewçš„æ—¶å€™cpuçš„æŒ‡ä»¤é›†é¡ºåºå¯èƒ½æœ‰å˜åŒ–ï¼Œå¯¼è‡´å­—æ®µæœªèµ‹å€¼æˆåŠŸï¼Œä½†æ˜¯volatileå¯ä»¥ä¿è¯æœ‰åºæ€§çš„é—®é¢˜ã€‚è¿™ä¸ªåŸå­æ€§è¿˜æ˜¯ä¸å¤ªç†è§£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652090525,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":530492,"ip_address":""},"score":571155,"extra":""}]}]},{"had_liked":false,"id":91368,"user_name":"Rayjun","can_delete":false,"product_type":"c1","uid":1002514,"ip_address":"","ucode":"61A3D1A3D03569","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4c/12/f0c145d4.jpg","comment_is_top":false,"comment_ctime":1557017540,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"23031854020","product_id":100023901,"comment_content":"ä¸æ˜¯ä¸å¯å˜çš„ï¼Œuser é€ƒé€¸äº†","like_count":6,"discussions":[{"author":{"id":2683430,"avatar":"https://static001.geekbang.org/account/avatar/00/28/f2/26/a8ac6b42.jpg","nickname":"å¬é£æœ‰ä¿¡","note":"","ucode":"2CCB467114FF5C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389486,"discussion_content":"çœ‹åˆ°è€å“¥è¯´çš„é€ƒé€¸ï¼Œç«‹é©¬æ˜ç™½äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629291440,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":236155,"user_name":"ç¬¬ä¸€è£…ç”²é›†ç¾¤å¸ä»¤å…‹è±æ–¯ç‰¹","can_delete":false,"product_type":"c1","uid":1265707,"ip_address":"","ucode":"4E8FBB23AD860B","user_header":"https://static001.geekbang.org/account/avatar/00/13/50/2b/2344cdaa.jpg","comment_is_top":false,"comment_ctime":1595330830,"is_pvip":false,"replies":[{"id":"87237","content":"åŠ æ²¹å§ï¼","user_name":"ä½œè€…å›å¤","comment_id":236155,"uid":"1269969","ip_address":"","utype":1,"ctime":1595341050,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"14480232718","product_id":100023901,"comment_content":"éšç€è¯¾ç¨‹çš„æ·±å…¥ï¼Œè¶Šæ¥è¶Šçœ‹ä¸æ‡‚äº†ã€‚æˆ‘ä¸å«Œä¸¢äººï¼Œä¸è—æ‹™ï¼Œè¿™ä¸“æ ï¼Œæˆ‘ä¸€å®šä¼šäºŒåˆ·ï¼Œä¸‰åˆ·ï¼Œç›´åˆ°å•ƒä¸‹æ¥è¿™å—ç¡¬éª¨å¤´ï¼","like_count":4,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501964,"discussion_content":"åŠ æ²¹å§ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595341050,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":140513,"user_name":"é“¿ç„¶","can_delete":false,"product_type":"c1","uid":1162461,"ip_address":"","ucode":"D529242EC2E2EA","user_header":"https://static001.geekbang.org/account/avatar/00/11/bc/dd/c9413f59.jpg","comment_is_top":false,"comment_ctime":1570973564,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"10160908156","product_id":100023901,"comment_content":"å…³äºfinalçš„ç†è§£<br>1. åŸŸå¹¶ä¸æ˜¯éƒ½éœ€è¦å®šä¹‰ä¸ºfinalæ‰èƒ½çº¿ç¨‹å®‰å…¨ï¼Œåªè¦æ˜¯ç§æœ‰çš„å¹¶ä¸”åªè¯»ï¼Œä¹Ÿèƒ½ä¿è¯çº¿ç¨‹å®‰å…¨<br>2.ç±»è¢«ç»§æ‰¿ï¼Œé‚£ä¹ˆå®é™…ä¸Šæ˜¯å­ç±»ä¸ä¸€å®šå®‰å…¨ï¼Œå’Œå½“å‰è¿™ä¸ªç±»æ— å…³ï¼Œå¦‚æœå½“å‰ç±»æ˜¯å®‰å…¨çš„ï¼Œç”¨ä¸ç”¨finalä¿®é¥°éƒ½æ˜¯å®‰å…¨çš„<br>3.finalä¿®é¥°å®¹å™¨ç±»ï¼Œå¯¹è±¡æ—¶ï¼Œå¼•ç”¨ä¸å¯å˜ï¼Œå…‘ç°å†…å®¹å¯å˜ï¼Œä¹Ÿä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚<br><br>Java å¹¶å‘ç¼–ç¨‹å®æˆ˜ä¸­å¯¹finalçš„æè¿°ä¸ªäººæ„Ÿè§‰ä¸æ˜¯é‚£ä¹ˆå‡†ç¡®ã€‚","like_count":3},{"had_liked":false,"id":307878,"user_name":"å¬é£æœ‰ä¿¡","can_delete":false,"product_type":"c1","uid":2683430,"ip_address":"","ucode":"2CCB467114FF5C","user_header":"https://static001.geekbang.org/account/avatar/00/28/f2/26/a8ac6b42.jpg","comment_is_top":false,"comment_ctime":1629291461,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5924258757","product_id":100023901,"comment_content":"useré€ƒé€¸äº†ï¼Œåº”è¯¥ç”¨ä¿æŠ¤æ€§æ‹·è´","like_count":2},{"had_liked":false,"id":307861,"user_name":"DoctorDeng","can_delete":false,"product_type":"c1","uid":1122760,"ip_address":"","ucode":"116378F7377768","user_header":"https://static001.geekbang.org/account/avatar/00/11/21/c8/c2343cb6.jpg","comment_is_top":false,"comment_ctime":1629286373,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5924253669","product_id":100023901,"comment_content":"å®ç°ä¸å¯ä»¥å˜ç±»ä¸»è¦æœ‰å¦‚ä¸‹å‡ æ­¥ï¼š<br>1. ç±»å¢åŠ  final ä¿®é¥°ç¬¦ï¼Œè®©ç±»æ— æ³•è¢«ç»§æ‰¿<br>2. ç±»ä¸­çš„æ‰€æœ‰æˆå‘˜å˜é‡å¿…é¡»ç§æœ‰ï¼ˆå¢åŠ  private å…³é”®å­—ï¼‰å¹¶å¢åŠ  final ä¿®é¥°ç¬¦ï¼Œè®©å±æ€§æ— æ³•è¢«ä¿®æ”¹ï¼ˆå±æ€§å†…å®¹ä¾ç„¶å¯ä»¥è¢«ä¿®æ”¹ï¼Œé€šè¿‡ 4 è§£å†³è¯¥é—®é¢˜ï¼‰<br>3. ä¸æä¾›ä¿®æ”¹æˆå‘˜å˜é‡çš„æ–¹æ³•åŒ…æ‹¬ setter<br>4. é€šè¿‡æ„é€ å™¨åˆå§‹åŒ–æ‰€æœ‰æˆå‘˜ï¼Œè¿›è¡Œæ·±æ‹·è´(deep copy)<br>5. åœ¨ getter æ–¹æ³•ä¸­ï¼Œä¸è¦ç›´æ¥è¿”å›å¯¹è±¡æœ¬èº«ï¼Œè€Œæ˜¯å…‹éš†å¯¹è±¡ï¼Œå¹¶è¿”å›å¯¹è±¡çš„æ‹·è´","like_count":2},{"had_liked":false,"id":211739,"user_name":"è§å—å±±","can_delete":false,"product_type":"c1","uid":1118111,"ip_address":"","ucode":"6A8BB82B7573CA","user_header":"https://static001.geekbang.org/account/avatar/00/11/0f/9f/f4b06bd5.jpg","comment_is_top":false,"comment_ctime":1588000082,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5882967378","product_id":100023901,"comment_content":"ä¸å¯å˜å¯¹è±¡éœ€è¦ä¿è¯ç±»ä¸­å±æ€§éƒ½æ˜¯ä¸å¯å˜çš„ï¼Œä¸”åªæœ‰å¯è¯»æ–¹æ³•ã€‚ä¸ªäººç†è§£åªæœ‰å¯è¯»æ–¹æ³•çš„ä½œç”¨å°±æ˜¯é¿å…å¯¹è±¡å­˜åœ¨è¢«ä¿®æ”¹å±æ€§çš„å¯èƒ½æ€§ã€‚æ–‡æœ«çš„é—®é¢˜: Stringbufferå¯¹è±¡çš„å¼•ç”¨æ˜¯ä¸å¯å˜çš„ï¼Œä½†ä»–çš„å€¼å´æ˜¯å¯ä»¥æ”¹å˜çš„ã€‚getæ–¹æ³•å¾—åˆ°å¼•ç”¨åå®ƒçš„å€¼è¿˜å¯ä»¥æ”¹å˜ã€‚","like_count":2},{"had_liked":false,"id":91068,"user_name":"æ¾èŠ±çš®è›‹me","can_delete":false,"product_type":"c1","uid":1000054,"ip_address":"","ucode":"B0846CEEF6B0D1","user_header":"https://static001.geekbang.org/account/avatar/00/0f/42/76/256bbd43.jpg","comment_is_top":false,"comment_ctime":1556846085,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5851813381","product_id":100023901,"comment_content":"Stringbufferè™½ç„¶é€ƒå‡ºæ¥äº†ï¼Œä½†æ˜¯æ²¡æœ‰å¼•ç”¨å…¶ä»–å¯¹è±¡ï¼Œå¦å¤–å®ƒæœ¬èº«ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥å…·æœ‰ä¸å¯å˜æ€§","like_count":2},{"had_liked":false,"id":91060,"user_name":"å¼ ä¸‰","can_delete":false,"product_type":"c1","uid":1004092,"ip_address":"","ucode":"1155528FAE1546","user_header":"https://static001.geekbang.org/account/avatar/00/0f/52/3c/d6fcb93a.jpg","comment_is_top":false,"comment_ctime":1556842237,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5851809533","product_id":100023901,"comment_content":"æ‰“å¡ã€‚","like_count":2},{"had_liked":false,"id":91014,"user_name":"QQæ€ª","can_delete":false,"product_type":"c1","uid":1211223,"ip_address":"","ucode":"1A39B8433D9208","user_header":"https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg","comment_is_top":false,"comment_ctime":1556787944,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5851755240","product_id":100023901,"comment_content":"ä¸å…·å¤‡ä¸å¯å˜æ€§,åŸå› æ˜¯stringbufferç±»å­˜åœ¨æ›´æ”¹userå¯¹è±¡æ–¹æ³•","like_count":2},{"had_liked":false,"id":90979,"user_name":"å‘æ¡æ©™å­ ã€‚","can_delete":false,"product_type":"c1","uid":1259218,"ip_address":"","ucode":"ED076F4534FFED","user_header":"https://static001.geekbang.org/account/avatar/00/13/36/d2/c7357723.jpg","comment_is_top":false,"comment_ctime":1556765478,"is_pvip":false,"replies":[{"id":"34450","content":"æ„Ÿè°¢æ„Ÿè°¢ğŸ˜‚<br>ä½ çš„é—®é¢˜æœ‰ç‚¹ç¬¼ç»Ÿï¼Œjdkä¹Ÿä¸æ˜¯æ²¡æœ‰bug,syncçš„é”æ˜¯è®°åœ¨å¯¹è±¡å¤´é‡Œçš„","user_name":"ä½œè€…å›å¤","comment_id":90979,"uid":"1269969","ip_address":"","utype":1,"ctime":1558361615,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"5851732774","product_id":100023901,"comment_content":"è€å¸ˆäº”ä¸€èŠ‚æ—¥å¿«ä¹ã€‚<br><br>æ€è€ƒé¢˜ ï¼š<br>ä¸å¯å˜ç±»çš„ä¸‰è¦ç´  ï¼šç±»ã€å±æ€§ã€æ–¹æ³•éƒ½æ˜¯ä¸å¯å˜çš„ã€‚ æ€è€ƒé¢˜è¿™ä¸ªç±»è™½ç„¶æ˜¯final ï¼Œå±æ€§ä¹Ÿæ˜¯finalå¹¶ä¸”æ²¡æœ‰ä¿®æ”¹çš„æ–¹æ³• ï¼Œ ä½†æ˜¯ stringbufferè¿™ä¸ªå±æ€§çš„å†…å®¹æ˜¯å¯å˜çš„ ï¼Œ æ‰€ä»¥åº”è¯¥æ²¡æœ‰æ»¡è¶³ä¸‰è¦ç´ ä¸­çš„å±æ€§ä¸å¯å˜ ï¼Œ åº”è¯¥ä¸å±äºä¸å¯å˜ç±» ã€‚<br><br><br>å¦å¤–è€å¸ˆæˆ‘æœ‰ä¸ªé—®é¢˜æƒ³é—®ä¸‹ï¼Œ æˆ‘çœ‹jdkä¸€äº›æºç é‡Œï¼Œä¹Ÿç”¨äº†å¯¹è±¡åšé”ã€‚ ä¾‹å¦‚ æˆ‘æœ‰ä¸ªå˜é‡ final  ConcurrentHashMap cache , æœ‰äº›æ–¹æ³•ä¸­ä¼šå¯¹ cacheå˜é‡ putæ–°çš„å€¼ ï¼Œ ä½†æ˜¯è¿˜æœ‰ç”¨è¿™ä¸ªå¯¹è±¡åš synchronized(cache) å¯¹è±¡é” ï¼Œ è¿™ç§åšæ³•å¯¹ä¹ˆï¼Ÿ å¦‚æœå¯¹çš„è¯ï¼Œæ˜¯å› ä¸ºç®¡ç¨‹åªåˆ¤æ–­å¯¹è±¡çš„é¦–åœ°å€æ²¡æœ‰æ”¹å˜çš„åŸå› ä¹ˆ ï¼Œå¸Œæœ›è€å¸ˆæŒ‡ç‚¹ä¸€ä¸‹ğŸ˜","like_count":2,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448750,"discussion_content":"æ„Ÿè°¢æ„Ÿè°¢ğŸ˜‚\nä½ çš„é—®é¢˜æœ‰ç‚¹ç¬¼ç»Ÿï¼Œjdkä¹Ÿä¸æ˜¯æ²¡æœ‰bug,syncçš„é”æ˜¯è®°åœ¨å¯¹è±¡å¤´é‡Œçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558361615,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345167,"user_name":"å°é©¬çˆ¹","can_delete":false,"product_type":"c1","uid":1570872,"ip_address":"","ucode":"139FCF2C668343","user_header":"https://static001.geekbang.org/account/avatar/00/17/f8/38/41bd3639.jpg","comment_is_top":false,"comment_ctime":1652086818,"is_pvip":false,"replies":[{"id":"126051","content":"æ˜¯çº¿ç¨‹å®‰å…¨çš„","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1269969","ctime":1652180385,"ip_address":"","comment_id":345167,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1652086818","product_id":100023901,"comment_content":"â€œString å’Œ Longã€Integerã€Double ç­‰åŸºç¡€ç±»å‹çš„åŒ…è£…ç±»éƒ½å…·å¤‡ä¸å¯å˜æ€§ï¼Œè¿™äº›å¯¹è±¡çš„çº¿ç¨‹å®‰å…¨æ€§éƒ½æ˜¯é ä¸å¯å˜æ€§æ¥ä¿è¯çš„ã€‚â€<br>è¿™é‡Œæœ‰ç‚¹ä¸å¤ªç†è§£ï¼Œæ—¢ç„¶String å’Œ Longã€Integerã€Doubleå…·å¤‡ä¸å¯å˜ï¼Œä¸å¯å˜æ„å‘³ç€çº¿ç¨‹å®‰å…¨ï¼Œé‚£ä¸å°±å¯ä»¥è¯´String å’Œ Longã€Integerã€Double æ˜¯çº¿ç¨‹å®‰å…¨çš„äº†ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571356,"discussion_content":"æ˜¯çº¿ç¨‹å®‰å…¨çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652180385,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":339426,"user_name":"bluea","can_delete":false,"product_type":"c1","uid":1030311,"ip_address":"","ucode":"638BD2C838813C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b8/a7/ac5a0f9d.jpg","comment_is_top":false,"comment_ctime":1648094241,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1648094241","product_id":100023901,"comment_content":"è€å¸ˆå¥½ï¼Œå¯å¦ç»™ä¸ªä¾‹å­ï¼Œå¦‚ä½•ä½¿ç”¨æ— çŠ¶æ€çš„å¯¹è±¡ã€‚","like_count":1},{"had_liked":false,"id":327094,"user_name":"Jayden Lin","can_delete":false,"product_type":"c1","uid":2849902,"ip_address":"","ucode":"6C86DE76545C64","user_header":"","comment_is_top":false,"comment_ctime":1639912003,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1639912003","product_id":100023901,"comment_content":"è€å¸«å¥½ï¼ŒSafeWM çš„ä¾‹å­å¯ä»¥é€™æ¨£ç†è§£å—ï¼Ÿ<br><br>SafeWM å¼•ç”¨ WMRangeï¼Œåœ¨åŸ·è¡Œ WMRange å»ºæ§‹å­çš„æ™‚å€™ï¼Œè¨­å®šupper è·Ÿ lower æ²’æœ‰åŸå­æ€§ï¼Œå› æ­¤è¦æŠŠ WMRange å…§éƒ¨å€¼ (upper è·Ÿ lower ) çš„è¨­å®šé€é AtomicReference ä¾†åš","like_count":1},{"had_liked":false,"id":327091,"user_name":"Jayden Lin","can_delete":false,"product_type":"c1","uid":2849902,"ip_address":"","ucode":"6C86DE76545C64","user_header":"","comment_is_top":false,"comment_ctime":1639910664,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1639910664","product_id":100023901,"comment_content":"è€å¸«å¥½ï¼Œæƒ³å•ä¸€ä¸‹ Foo è¢« Bar å¼•ç”¨çš„ä¾‹å­ï¼Œæˆ‘å¯ä»¥é€™æ¨£ç†è§£å—?<br><br>- å•é¡Œ 1: å¯è¦‹æ€§å•é¡Œ<br>    - ç·šç¨‹ A ç”¨ `bar.setFoo(new Foo())`ï¼Œå¦ä¸€å€‹ç·šç¨‹ \bB å¯èƒ½ä¸çŸ¥é“ï¼Œå¯ä»¥åŠ ä¸Š violate ä¾†è§£æ±º<br><br>- å•é¡Œ 2: åŸå­æ€§å•é¡Œ<br>    - å¦‚æœ Foo çš„ new è£¡é¢æœ‰çµ„åˆæ“ä½œï¼Œå¯èƒ½æœƒæœ‰åŸå­æ€§å•é¡Œï¼Œé€™æ™‚å€™è¦ç”¨ AtomicReference æ›¿æ›æ‰ï¼Œé€™å€‹åŸå­æ€§å•é¡Œè·Ÿ Foo æœ‰æ²’æœ‰è¢« Bar å¼•ç”¨ç„¡é—œ<br>","like_count":1},{"had_liked":false,"id":295411,"user_name":"å°æ ·","can_delete":false,"product_type":"c1","uid":1047127,"ip_address":"","ucode":"0D670431F19A14","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/bOhve1DBV2oShl2JrXDib4J1T7LciagcB8jogD5c7pvt8Zv7Bq23Zfnl70cf2R81r8ia947Hbib9FZia56sdx9wcEibA/132","comment_is_top":false,"comment_ctime":1622422234,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622422234","product_id":100023901,"comment_content":"&quot;Java è¯­è¨€é‡Œé¢çš„ String å’Œ Longã€Integerã€Double ç­‰åŸºç¡€ç±»å‹çš„åŒ…è£…ç±»éƒ½å…·å¤‡ä¸å¯å˜æ€§&quot;ï¼Œè¿™å‡ ä¸ªç±»å‹è¿™æ ·å¤§å†™ä¸å°±æ˜¯åŒ…è£…ç±»äº†å—","like_count":1},{"had_liked":false,"id":283155,"user_name":"ä¿ºèƒ½å­¦ä¸ªå•¥","can_delete":false,"product_type":"c1","uid":1026742,"ip_address":"","ucode":"30740C5B58774C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/aa/b6/46a5bbf3.jpg","comment_is_top":false,"comment_ctime":1615599808,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1615599808","product_id":100023901,"comment_content":"ç”±äºaccountå¯¹è±¡æŒæœ‰stringbufferå¼•ç”¨ï¼Œå¯¹å¤–æš´éœ²äº†è¯¥å¼•ç”¨æ–¹æ³•ï¼Œå¯ä»¥æ“ä½œä¿®æ”¹å†…å®¹ï¼Œæ‰€ä»¥ä¸å…·å¤‡ä¸å¯å˜æ€§ï¼Œåº”è¯¥åªæ˜¯æ— çŠ¶æ€å¯¹è±¡å§","like_count":1},{"had_liked":false,"id":275583,"user_name":"å–ƒå¯»","can_delete":false,"product_type":"c1","uid":1565085,"ip_address":"","ucode":"E31B3660726671","user_header":"https://static001.geekbang.org/account/avatar/00/17/e1/9d/3ec0adec.jpg","comment_is_top":false,"comment_ctime":1611589966,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1611589966","product_id":100023901,"comment_content":"è¿™æ®µä»£ç æ˜¯å¼•ç”¨çš„æ˜¯finalçš„StringBufferå¯¹è±¡ï¼Œæ–‡ä¸­è¯´äº†ä¸å¯å˜å¯¹è±¡è™½ç„¶æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯å¹¶ä¸æ„å‘³ç€å¼•ç”¨è¿™äº›ä¸å¯å˜å¯¹è±¡çš„å¯¹è±¡å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚æˆ‘ä»¬å‘ç°ä»ç„¶å¯ä»¥é€šè¿‡è°ƒç”¨StringBufferçš„appendæ–¹æ³•æ¥æ”¹å˜å®ƒçš„å€¼ï¼Œæ‰€ä»¥æ•´ä½“æ¥è¯´è¿™ä¸ªç±»æ˜¯ä¸æ˜¯å…·å¤‡ä¸å¯å˜æ€§çš„ï¼Œå»ºè®®å¼•ç”¨ä¸å¯å˜çš„åŸºæœ¬æ•°æ®ç±»å‹Stringä½œä¸ºæ›¿æ¢ï¼Œæ­¤ç±»æ‰èƒ½çœŸæ­£è¾¾åˆ°ä¸å¯å˜æ€§ã€‚","like_count":1},{"had_liked":false,"id":264754,"user_name":"ğŸŒ¾ğŸŒ¾ğŸŒ¾å°éº¦ğŸŒ¾ğŸŒ¾ğŸŒ¾","can_delete":false,"product_type":"c1","uid":2046490,"ip_address":"","ucode":"ECB0CE18D5B49A","user_header":"https://static001.geekbang.org/account/avatar/00/1f/3a/1a/ae3c1492.jpg","comment_is_top":false,"comment_ctime":1606630857,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1606630857","product_id":100023901,"comment_content":"&#47;&#47;Barçº¿ç¨‹ä¸å®‰å…¨<br>class Bar { <br>Foo foo; <br>void setFoo(Foo f){<br> this.foo=f;  &#47;&#47;å¯¹ foo è¿™ä¸ªå¼•ç”¨çš„ä¿®æ”¹åœ¨å¤šçº¿ç¨‹ä¸­å¹¶ä¸èƒ½ä¿è¯å¯è§æ€§å’ŒåŸå­æ€§. å¼•ç”¨èµ‹å€¼ä¸å…·æœ‰åŸå­æ€§å—ï¼Ÿ<br>}<br>}<br>https:&#47;&#47;docs.oracle.com&#47;javase&#47;specs&#47;jls&#47;se7&#47;html&#47;jls-17.html#jls-17.7<br>Writes to and reads of references are always atomic, regardless of whether they are implemented as 32-bit or 64-bit values.","like_count":1,"discussions":[{"author":{"id":1100655,"avatar":"https://static001.geekbang.org/account/avatar/00/10/cb/6f/c78ef1cf.jpg","nickname":"ç‹äºŒåŒ—","note":"","ucode":"D9090E28B3E1F0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387143,"discussion_content":"æˆ‘æ„Ÿè§‰è€å¸ˆåº”è¯¥æ˜¯å†™é”™äº†ï¼Œåº”è¯¥æ˜¯æ— æ³•ä¿è¯å¯è§æ€§ï¼Œè€Œä¸æ˜¯ä¸å…·æœ‰åŸå­æ€§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628003475,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":263305,"user_name":"Geek_89e362","can_delete":false,"product_type":"c1","uid":2308075,"ip_address":"","ucode":"E596C2CFE1CFAF","user_header":"","comment_is_top":false,"comment_ctime":1606096809,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606096809","product_id":100023901,"comment_content":"ä¸å…·å¤‡ä¸å¯å˜æ€§ï¼Œå› ä¸ºé€šè¿‡ getUser()æ–¹æ³•è·å–åˆ°StringBufferåå¯ä»¥é€šè¿‡ append()æ–¹æ³•è¿½åŠ å€¼ã€‚ä»è€Œå¯¼è‡´å€¼çš„ä¿®æ”¹ã€‚","like_count":1},{"had_liked":false,"id":236727,"user_name":"å†°æ²³æ—¶ä»£","can_delete":false,"product_type":"c1","uid":1098504,"ip_address":"","ucode":"F4375FB7CE4FD4","user_header":"https://static001.geekbang.org/account/avatar/00/10/c3/08/28c327d0.jpg","comment_is_top":false,"comment_ctime":1595512048,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595512048","product_id":100023901,"comment_content":"å…¶å®é™¤äº†finalå…³é”®å­—å®šä¹‰çš„ä¸å¯å˜æ€§ï¼Œè¿˜æœ‰Collectionsæˆ–è€…Guavaæä¾›çš„Immutability Set,List,Mapç­‰ï¼Œä¹Ÿåº”è¯¥ç®—æ˜¯æ¯”å¯å˜æ€§çš„ã€‚","like_count":1},{"had_liked":false,"id":187899,"user_name":"Evan","can_delete":false,"product_type":"c1","uid":1344281,"ip_address":"","ucode":"B877ABD0CF4661","user_header":"https://static001.geekbang.org/account/avatar/00/14/83/19/0a3fe8c1.jpg","comment_is_top":false,"comment_ctime":1584271116,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1584271116","product_id":100023901,"comment_content":"æ— çŠ¶æ€å¯¹è±¡ï¼Œæœ‰ç‚¹éš¾ç†è§£ï¼Œèƒ½ä¸¾ä¸€ä¸ªä¾‹å­","like_count":1},{"had_liked":false,"id":172712,"user_name":"qgymje","can_delete":false,"product_type":"c1","uid":1309328,"ip_address":"","ucode":"1DFE4B52E8C36A","user_header":"https://static001.geekbang.org/account/avatar/00/13/fa/90/f937f371.jpg","comment_is_top":false,"comment_ctime":1579258767,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579258767","product_id":100023901,"comment_content":"è¿™æ–‡ç« åº”è¯¥ä¸»è¦è®²è®²ä¸å¯å˜æ•°æ®ç»“æ„","like_count":1},{"had_liked":false,"id":149040,"user_name":"Joker","can_delete":false,"product_type":"c1","uid":1156592,"ip_address":"","ucode":"126AF848001A1E","user_header":"https://static001.geekbang.org/account/avatar/00/11/a5/f0/8648c464.jpg","comment_is_top":false,"comment_ctime":1573130326,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573130326","product_id":100023901,"comment_content":"ä¸å…·å¤‡ä¸å¯å˜æ€§çš„ï¼Œå˜»å˜»ã€‚","like_count":1},{"had_liked":false,"id":145296,"user_name":"Neo","can_delete":false,"product_type":"c1","uid":1004003,"ip_address":"","ucode":"DA1C960B5F23DC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/51/e3/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1572246953,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1572246953","product_id":100023901,"comment_content":"Integer,Long,Doubleç­‰æ•°å€¼ç±»å‹çš„æ•°æ®ä¸é€‚åˆç”¨æ¥åšé”ï¼Œå…¶å®æ˜¯ä¸èƒ½ç”¨xxx.valueOfæ–¹æ³•ç”Ÿæˆçš„å¯¹è±¡ä½œä¸ºé”ï¼Œå› ä¸ºåªæœ‰valueOfæ–¹æ³•æ‰ä¼šè¿”å›ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œç›´æ¥newå‡ºæ¥çš„å¯¹è±¡æ˜¯æ²¡æœ‰è¿™ä¸ªé—®é¢˜çš„ã€‚","like_count":1,"discussions":[{"author":{"id":1438352,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI4akcIyIOXB2OqibTe7FF90hwsBicxkjdicUNTMorGeIictdr3OoMxhc20yznmZWwAvQVThKPFWgOyMw/132","nickname":"Chuan","note":"","ucode":"FACEC5DAC36A7A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164090,"discussion_content":"ä»JDK 9å¼€å§‹newå‡ºæ¥çš„è¿™ç§æ–¹å¼è¿‡æ—¶äº†ï¼Œå®˜æ–¹ä¸æå€¡ï¼ŒåŸå› ä¹Ÿæ˜¯ä¸ºäº†èŠ‚çœç©ºé—´ã€‚\n```\n     * @deprecated\n     * It is rarely appropriate to use this constructor. The static factory\n     * {@link #valueOf(long)} is generally a better choice, as it is\n     * likely to yield significantly better space and time performance.\n     */\n    @Deprecated(since=&#34;9&#34;)\n    public Long(long value) {\n        this.value = value;\n    }\n```","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581148268,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":141774,"user_name":"é»„æµ©ç‰¹","can_delete":false,"product_type":"c1","uid":1018240,"ip_address":"","ucode":"C3A4BBF4FB8519","user_header":"https://static001.geekbang.org/account/avatar/00/0f/89/80/3666ced3.jpg","comment_is_top":false,"comment_ctime":1571223087,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571223087","product_id":100023901,"comment_content":"&quot;ä¸‹é¢æˆ‘ä»¬å†çœ‹çœ‹å¦‚ä½•æ­£ç¡®åœ°å‘å¸ƒä¸å¯å˜å¯¹è±¡ã€‚ä¸å¯å˜å¯¹è±¡è™½ç„¶æ˜¯çº¿ç¨‹...&quot;<br><br>ç–‘é—®: è¿™æ®µåé¢æ€ä¹ˆæ²¡æœ‰ææ­£ç¡®å‘å¸ƒçš„æƒ…å†µå‘¢<br>","like_count":1},{"had_liked":false,"id":136951,"user_name":"Sharry","can_delete":false,"product_type":"c1","uid":1239293,"ip_address":"","ucode":"045DDB864659F6","user_header":"https://static001.geekbang.org/account/avatar/00/12/e8/fd/035f4c94.jpg","comment_is_top":false,"comment_ctime":1569565270,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569565270","product_id":100023901,"comment_content":"å¤ªæ£’äº†, åˆå­¦åˆ°äº†<br><br>ä»¥å‰åªçŸ¥é“ String æ˜¯ final ç±»å‹çš„, ä½†æ€»æ˜¯æ— æ³•å¾ˆå¥½çš„è§£é‡Šè¿™ä¸ªé—®é¢˜, å­¦ä¹ äº†æœ¬ç¯‡çš„è¯¾ç¨‹, è®©æˆ‘äº†è§£åˆ°äº†ä¸å¯å˜æ¨¡å¼çš„å¦™ç”¨, åŸæ¥è¿™æ ·æ˜¯å®ç°çº¿ç¨‹å®‰å…¨çš„æ‰‹æ®µ, å·§å¦™!","like_count":1},{"had_liked":false,"id":117895,"user_name":"Vincent","can_delete":false,"product_type":"c1","uid":1135159,"ip_address":"","ucode":"CD8B84A57A6A0C","user_header":"https://static001.geekbang.org/account/avatar/00/11/52/37/13b4c8aa.jpg","comment_is_top":false,"comment_ctime":1564185512,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564185512","product_id":100023901,"comment_content":"Accountç±»ä¸å…·æœ‰ä¸å¯å˜ç±»çš„ç‰¹æ€§ï¼Œé€šè¿‡getæ–¹æ³•è·å–åˆ° StringBuffer å®ä¾‹å¯ä»¥ä¿®æ”¹Account ç±»çš„å±æ€§ã€‚","like_count":1},{"had_liked":false,"id":113897,"user_name":"é“","can_delete":false,"product_type":"c1","uid":1324160,"ip_address":"","ucode":"851A0AD751D317","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/80/30e9ae41.jpg","comment_is_top":false,"comment_ctime":1563182136,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563182136","product_id":100023901,"comment_content":"ä»€ä¹ˆåœºæ™¯ä¸‹å€¼éœ€è¦ä¿è¯å¼•ç”¨å¯è§æ€§ä¸éœ€è¦åŸå­æ€§ã€‚ç”¨volatileä¿®é¥°å¼•ç”¨å°±æ„å‘³ç€è¿™ä¸ªå¼•ç”¨åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ä¼šå¼•ç”¨å…¶å®ƒå¯¹è±¡ï¼Œä½†æ˜¯å¯¹è¿™ä¸ªå¼•ç”¨çš„èµ‹å€¼æ“ä½œåˆä¸æ˜¯åŸå­æ€§æ“ä½œã€‚è¿™æ„å‘³ç€å¯èƒ½æŸä¸ªçº¿ç¨‹è®¿é—®åˆ°ä¸€ä¸ªé”™è¯¯çš„å¼•ç”¨ï¼Ÿ<br>å•ä¾‹æ¨¡å¼-åŒé‡æ ¡éªŒé”ï¼Œä¸­volatileä¿è¯æŒ‡ä»¤ä¸é‡æ’åºå·å¥½ç†è§£ï¼›å¦‚ä½•çœ‹å¾…volatileåœ¨è¿™é‡Œçš„å¯è§æ€§ä½œç”¨ã€‚å‡å¦‚çº¿ç¨‹1è¿è¡Œåˆ°é”å¤–çš„é‚£ä¸ªåˆ¤ç©ºæ¡ä»¶ï¼Œçº¿ç¨‹2åœ¨synchronizedå—ä¸­ç»™å¼•ç”¨æ›´æ–°ï¼Œï¼Œå› ä¸ºå¼•ç”¨æ›´æ–°éåŸå­æ€§æ“ä½œï¼Œé‚£ä¹ˆçº¿ç¨‹1ä¼šåœ¨é”å¤–çš„åˆ¤ç©ºæ¡ä»¶é‚£é‡Œè¯»å–åˆ°é”™è¯¯çš„å¼•ç”¨å—ï¼Ÿ<br>æ±‚è§£","like_count":1},{"had_liked":false,"id":104033,"user_name":"Jxin","can_delete":false,"product_type":"c1","uid":1251111,"ip_address":"","ucode":"4C03928388C413","user_header":"https://static001.geekbang.org/account/avatar/00/13/17/27/ec30d30a.jpg","comment_is_top":false,"comment_ctime":1560596483,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560596483","product_id":100023901,"comment_content":"æˆ‘ä»¬webå¼€å‘çš„serviceå±‚å°±æ˜¯ä¸€ç§ä¸å¯å˜æ¨¡å¼çš„å†™æ³•ã€‚æ‰€ä»¥æ²¡æœ‰å¹¶å‘é—®é¢˜ã€‚","like_count":0},{"had_liked":false,"id":103135,"user_name":"å—¨å–½","can_delete":false,"product_type":"c1","uid":1162527,"ip_address":"","ucode":"E13573559A50D4","user_header":"https://static001.geekbang.org/account/avatar/00/11/bd/1f/e9fbc712.jpg","comment_is_top":false,"comment_ctime":1560387089,"is_pvip":false,"replies":[{"id":"37426","content":"ç‰ˆæœ¬å·ä¼šä¸€ç›´å¢åŠ ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰abaé—®é¢˜","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1560432889,"ip_address":"","comment_id":103135,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1560387089","product_id":100023901,"comment_content":"ä¸Šé¢å¾—SafeWMç±»ä»£ç ä¼šä¸ä¼šæœ‰ABAé—®é¢˜å‘¢ï¼Œè€å¸ˆ","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453747,"discussion_content":"ç‰ˆæœ¬å·ä¼šä¸€ç›´å¢åŠ ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰abaé—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560432889,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1566274,"avatar":"https://static001.geekbang.org/account/avatar/00/17/e6/42/07f56456.jpg","nickname":"ç‹„å…‹æ¨å¤š","note":"","ucode":"420C27F7734C30","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302235,"discussion_content":"ç‰ˆæœ¬å·ä¼šä¸€ç›´å¢åŠ ? è¿™ä¸ªä½“ç°åœ¨å“ªï¼Ÿ è€å“¥çŸ¥é“å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598857529,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99778,"user_name":"xuery","can_delete":false,"product_type":"c1","uid":1027584,"ip_address":"","ucode":"F461B61BE06131","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ae/00/025f37e7.jpg","comment_is_top":false,"comment_ctime":1559297340,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1559297340","product_id":100023901,"comment_content":"ä¸æ˜¯ï¼Œé€šè¿‡getUseræ‹¿åˆ°StringBufferç±»å‹çš„useråï¼Œè¿˜æ˜¯å¯ä»¥é€šè¿‡appendæ”¹å˜å­—ç¬¦ä¸²","like_count":0},{"had_liked":false,"id":97583,"user_name":"ç‚ç‚","can_delete":false,"product_type":"c1","uid":1143280,"ip_address":"","ucode":"D7F93624E014FC","user_header":"https://static001.geekbang.org/account/avatar/00/11/71/f0/be872719.jpg","comment_is_top":false,"comment_ctime":1558701629,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558701629","product_id":100023901,"comment_content":"æƒ³è¯·æ•™è€å¸ˆä¸€ä¸ªé—®é¢˜ï¼ŒLongé‡Œé¢çš„å†…éƒ¨ç±»ä¸ºä»€ä¹ˆä¸ç”¨finalä¿®é¥°ï¼Œè¿™æ ·è¿™ä¸ªå†…éƒ¨ç±»ä¸å°±æ˜¯å¯ä»¥è¢«ç»§æ‰¿ä¿®æ”¹äº†ä¹ˆï¼Ÿæ€ä¹ˆä¿è¯å®ƒçš„ä¸å¯å˜æ€§å‘¢ï¼Ÿ<br>&#47;&#47; ç¼“å­˜ï¼Œç­‰ä»·äºå¯¹è±¡æ± <br>&#47;&#47; ä»…ç¼“å­˜ [-128,127] ç›´æ¥çš„æ•°å­—<br>static class LongCache {<br>  static final Long cache[] <br>    = new Long[-(-128) + 127 + 1];<br><br>  static {<br>    for(int i=0; i&lt;cache.length; i++)<br>      cache[i] = new Long(i-128);<br>  }<br>}<br>","like_count":0},{"had_liked":false,"id":92333,"user_name":"æ˜“å„¿æ˜“","can_delete":false,"product_type":"c1","uid":1242864,"ip_address":"","ucode":"B15D1031CA841E","user_header":"https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqLcWH3mSPmhjrs1aGL4b3TqI7xDqWWibM4nYFrRlp0z7FNSWaJz0mqovrgIA7ibmrPt8zRScSfRaqQ/132","comment_is_top":false,"comment_ctime":1557235291,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557235291","product_id":100023901,"comment_content":"æ€è€ƒé¢˜ï¼šä¸æ˜¯ä¸å¯å˜ç±»ï¼Œç”¨ä¸‹è¾¹çš„ä»£ç å¯ä»¥è¿›è¡ŒéªŒè¯ï¼ï¼ˆè¿”å›çš„å¯¹è±¡è‡ªèº«æä¾›äº†ä¿®æ”¹æ–¹æ³•ï¼‰<br>public final class Test {<br>    public static void main(String[] args) {<br>        Account a = new Account(&quot;å°A&quot;);<br><br>        System.out.println(a.getUser());<br><br>        a.getUser().append(&quot;å°B&quot;);<br><br>        System.out.println(a.getUser());<br>    }<br>}<br><br>","like_count":0},{"had_liked":false,"id":91402,"user_name":"è§ä¸€ç‹¼","can_delete":false,"product_type":"c1","uid":1266160,"ip_address":"","ucode":"35CC9C8FC8DDD6","user_header":"https://static001.geekbang.org/account/avatar/00/13/51/f0/9b7d40fc.jpg","comment_is_top":false,"comment_ctime":1557025999,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557025999","product_id":100023901,"comment_content":"è™½ç„¶æ²¡æœ‰å¯¹å¤–æä¾›ä¿®æ”¹userçš„æ–¹æ³•ï¼Œä½†æ˜¯æä¾›äº†getæ–¹æ³•è¿”å›userå¯ä»¥ä¿®æ”¹","like_count":0},{"had_liked":false,"id":91067,"user_name":"è€é†‹","can_delete":false,"product_type":"c1","uid":1308401,"ip_address":"","ucode":"D6DF921AAB9E7A","user_header":"https://static001.geekbang.org/account/avatar/00/13/f6/f1/5ccbe3fe.jpg","comment_is_top":false,"comment_ctime":1556845668,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556845668","product_id":100023901,"comment_content":"æˆ‘çš„ç†è§£æ˜¯ï¼š<br>ä¸å…·æœ‰ä¸å¯å˜æ€§ï¼Œå› ä¸ºgetæ–¹æ³•è¿”å›çš„æ˜¯userå¯¹è±¡çš„å¼•ç”¨ï¼Œä¸æ˜¯ä¸€ä¸ªæ‹·è´ï¼Œæ‰€ä»¥å¯ä»¥æ”¹å˜Accountç±»çš„userå¯¹è±¡ã€‚","like_count":0},{"had_liked":false,"id":90957,"user_name":"MiracleWCG","can_delete":false,"product_type":"c1","uid":1152348,"ip_address":"","ucode":"2333D32404C22A","user_header":"https://static001.geekbang.org/account/avatar/00/11/95/5c/3214fd5d.jpg","comment_is_top":false,"comment_ctime":1556759132,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1556759132","product_id":100023901,"comment_content":"æˆ‘è®¤ä¸ºä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ å› ä¸ºå¾—åˆ°çš„stringbuffer æä¾›äº†æ–¹æ³•æ”¹å˜userã€‚è¯·è€å¸ˆæŒ‡ç‚¹ã€‚","like_count":0,"discussions":[{"author":{"id":1812970,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a9/ea/5bfce6c5.jpg","nickname":"mgs2002","note":"","ucode":"F5931108BD509B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311800,"discussion_content":"æ–¹æ³•æœ‰åŠ é”çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602491888,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":90949,"user_name":"ç½—æ´²","can_delete":false,"product_type":"c1","uid":1263417,"ip_address":"","ucode":"68133E38A25C17","user_header":"https://static001.geekbang.org/account/avatar/00/13/47/39/0ce1aa62.jpg","comment_is_top":false,"comment_ctime":1556756688,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556756688","product_id":100023901,"comment_content":"Account çš„å±æ€§æ˜¯ final çš„ï¼Œè€Œä¸”åªæœ‰getæ–¹æ³•ï¼Œä»è¿™é‡Œè€ƒè™‘ï¼Œç¡®å®è§‰å¾—è¿™ä¸ªç±»ä¸å¯å˜ï¼Œä½†æ˜¯è¿™ä¸ªç±»çš„å¼•ç”¨æŒ‡å‘userå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡çš„ç»“æ„æ²¡æœ‰è¯´æ˜ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½è¿™ä¸ªå¯¹è±¡é‡Œé¢çš„å±æ€§å¯å˜ï¼Œæ‰€ä»¥å°±ä¼šå¯¼è‡´è™½ç„¶Account ä¸å¯å˜ï¼Œä½†æ˜¯Userå±æ€§æ˜¯å¯å˜çš„ã€‚æ‰€ä»¥è¿™ä¸ªç±»ä¸å…·æœ‰ä¸å¯å˜æ€§ã€‚","like_count":0},{"had_liked":false,"id":90948,"user_name":"é«˜æº","can_delete":false,"product_type":"c1","uid":1048887,"ip_address":"","ucode":"751B41FD38EF7D","user_header":"https://static001.geekbang.org/account/avatar/00/10/01/37/12e4c9c9.jpg","comment_is_top":false,"comment_ctime":1556755993,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556755993","product_id":100023901,"comment_content":"æˆ‘çš„ç†è§£ä»ç±»åˆ°å±æ€§éƒ½è®¾ç½®äº†finalï¼Œå¹¶ä¸”å†…éƒ¨æ²¡æœ‰å…¶å®ƒçš„æ™®é€šå±æ€§æ¥æ›´æ”¹ã€‚","like_count":0}]}