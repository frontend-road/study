{"id":228411,"title":"41 | 网关与BFF：区分场景与职责","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/NET-Core\">https://gitee.com/geektime-geekbang/NET-Core</a></p>","comments":[{"had_liked":false,"id":210397,"user_name":"SuperSnow","can_delete":false,"product_type":"c3","uid":1065351,"ip_address":"","ucode":"84C89AA8083E6A","user_header":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","comment_is_top":false,"comment_ctime":1587736936,"is_pvip":false,"replies":[{"id":80616,"content":"1.你理解的是对的\n2.聚合服务可以作为一个业务聚合需求的补充，与微服务的api共存\n3.这种情况是没办法避免的，能做的是尽可能清晰地识别业务聚合的部分的归属，划不开的部分才用聚合服务。","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1589686077,"ip_address":"","comment_id":210397,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"肖老师，有几个问题想沟通一下：\n1、在“专用网关模式”中，如果有聚合服务的需求，所创建的聚合服务应该是基于现有的微服务来进行拼装，这里的微服务是否也可以不按照rpc的形式来进行交互，依然按照json格式来处理呢？\n2、另外如果网关面对某一个单独的微服务，一般情况下都是经过dto处理过的json数据。如果要加一个聚合服务，那聚合服务应该有另外一套dto的数据体现要求了，按这个思路的话，微服务所提供的就不能返回dto的数据，而是尽量全面的数据。\n假如没有聚合服务，只有微服务，目前我的做法是将dal,bll,webapi直接做为一个进程内来处理，最终以json格式暴露出api。如果也想让微服务向聚合服务提供资源的话，那只能从业务逻辑层进行rpc封装，对webapi的项目进行解耦，让dto转换在webapi项目中做转换了。这部分不知道你们是按照什么样的方式来设计的，需要老师解惑一下。\n3、第三个问题可能会受第2个问题不明朗的影响，但也提一下，由于聚合服务是将多个微服务进行组装的服务，随着需求变更或项目发展，微服务可能会有一些变化，此时聚合服务也会受到相应影响，在生产中，聚合服务是如何得到更好的把控呢？","like_count":1,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493013,"discussion_content":"1.你理解的是对的\n2.聚合服务可以作为一个业务聚合需求的补充，与微服务的api共存\n3.这种情况是没办法避免的，能做的是尽可能清晰地识别业务聚合的部分的归属，划不开的部分才用聚合服务。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589686077,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":214824,"user_name":"智鑫","can_delete":false,"product_type":"c3","uid":1684436,"ip_address":"","ucode":"D51AF9ABA5CB9B","user_header":"https://static001.geekbang.org/account/avatar/00/19/b3/d4/cbbdfb9a.jpg","comment_is_top":false,"comment_ctime":1588825580,"is_pvip":false,"replies":[{"id":79633,"content":"可以在源码库里进行具体的提问，我会关注的","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1588939056,"ip_address":"","comment_id":214824,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"老师，示例代码能否独立分开，比如用分支、tag之类的方式，现在获取的最新网关代码中还有helthcheck, skywalking的代码，与视频的代码状态并不一致，运行起来行为也不一致。\n对像我这样的小白来说，这些干扰代码带来了不小的困难\n","like_count":0,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494211,"discussion_content":"可以在源码库里进行具体的提问，我会关注的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588939056,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":214673,"user_name":"stg609","can_delete":false,"product_type":"c3","uid":1073025,"ip_address":"","ucode":"FB70A75A891BB8","user_header":"https://static001.geekbang.org/account/avatar/00/10/5f/81/1c614f4a.jpg","comment_is_top":false,"comment_ctime":1588779487,"is_pvip":false,"replies":[{"id":79636,"content":"是的，可以考虑这样的设计","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1588939273,"ip_address":"","comment_id":214673,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"如果是BFF, 那网关和聚合服务是否可以放在一个项目中更合适？","like_count":0,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494166,"discussion_content":"是的，可以考虑这样的设计","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588939273,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":240097,"user_name":"Luke 💨","can_delete":false,"product_type":"c3","uid":1504276,"ip_address":"","ucode":"343C168A06B30A","user_header":"https://static001.geekbang.org/account/avatar/00/16/f4/14/c1c81d88.jpg","comment_is_top":false,"comment_ctime":1596761844,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"感觉把聚合放在网关并不合适，聚合服务主要是对诸多微服务接口的统一请求并整合数据给前端，如果放在网关，首先网关会比较乱，各种业务都有，非常难维护，特别不同团队共享网关时，另外网关主要还是做限流、熔断、日志、认证等相关基础工作不应该和业务挂钩！","like_count":1},{"had_liked":false,"id":318187,"user_name":"奥特曼","can_delete":false,"product_type":"c3","uid":2583011,"ip_address":"","ucode":"8CCA7D1E53DBF2","user_header":"https://static001.geekbang.org/account/avatar/00/27/69/e3/b89cb29e.jpg","comment_is_top":false,"comment_ctime":1635177435,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"精简实用","like_count":0},{"had_liked":false,"id":303390,"user_name":"赵孔磊","can_delete":false,"product_type":"c3","uid":1393960,"ip_address":"","ucode":"63FD48D069A5FD","user_header":"https://static001.geekbang.org/account/avatar/00/15/45/28/16360d2e.jpg","comment_is_top":false,"comment_ctime":1626765473,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"老师 BFF 和网关区别不大，那为什么还要有俩个概念？","like_count":0},{"had_liked":false,"id":274512,"user_name":"上善若水","can_delete":false,"product_type":"c3","uid":1199746,"ip_address":"","ucode":"E95D2C010807AE","user_header":"https://static001.geekbang.org/account/avatar/00/12/4e/82/67ece8b8.jpg","comment_is_top":false,"comment_ctime":1611043562,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"请教老师，本地测试，发现访问网关是会重定向的，比如，5003，输入地址后会重定向到5001的地址，ocelot版本16，教程中并没有发生重定向，这是为什么？多谢","like_count":0},{"had_liked":false,"id":223762,"user_name":"王亚","can_delete":false,"product_type":"c3","uid":1810841,"ip_address":"","ucode":"765CDC2A4DF8CF","user_header":"https://static001.geekbang.org/account/avatar/00/1b/a1/99/137f5ff7.jpg","comment_is_top":false,"comment_ctime":1591175838,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"使用新版本的Ocelot 16.xx  配置文件写法跟14.xx版本有出入  ","like_count":0,"discussions":[{"author":{"id":1531199,"avatar":"https://static001.geekbang.org/account/avatar/00/17/5d/3f/63763dc7.jpg","nickname":"Vincent","note":"","ucode":"610FA31CF0C0BA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":340078,"discussion_content":"是的，之前根节点是 ReRoutes 现在是 Routes","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609899213,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}