{"id":577414,"title":"29ï½œå¼„æ¸…ç°çŠ¶ï¼šæ–°æ¶æ„é¢„è§ˆç‰ˆç©¶ç«Ÿé•¿ä»€ä¹ˆæ ·ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯è’‹å®ä¼Ÿã€‚</p><p>ä¸Šä¸€èŠ‚è¯¾ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸‰æ‹›ï¼Œä¹Ÿå°±æ˜¯â€œæ—¶å…‰æœºâ€ã€â€œæ‰¾çº¿å¤´â€å’Œâ€œé¸Ÿç°å›¾â€ï¼Œåˆæ­¥äº†è§£äº† React Native ç¬¬ä¸€ç‰ˆçš„è€æ¶æ„é•¿ä»€ä¹ˆæ ·ã€‚æˆ‘ä»¬å­¦ä¹ ç¬¬ä¸€ç‰ˆ React Native æ¶æ„çš„ç›®æ ‡ä¸æ˜¯ä¸ºäº†äº†è§£è¿‡å»ï¼Œè€Œæ˜¯ä¸ºäº†ææ¸…æ¥š React Native æ–°æ¶æ„çš„ç°çŠ¶ï¼Œä»¥åŠæ–°æ¶æ„æœªæ¥ä¼šå»å‘ä½•æ–¹ã€‚</p><p>å› æ­¤ï¼Œä»Šå¤©æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯æ‰¿æ¥ä¸Šä¸€èŠ‚è¯¾è®²è¿‡çš„æ–¹æ³•ï¼Œç”»ä¸€å¼ æ–°æ¶æ„çš„â€œé¸Ÿç°å›¾â€ï¼Œçœ‹çœ‹å½“å‰0.70 ç‰ˆæœ¬çš„æ–°æ¶æ„é¢„è§ˆç‰ˆç©¶ç«Ÿæ˜¯æ€ä¹ˆè®¾è®¡çš„ã€‚</p><p>åœ¨è¿™èŠ‚è¯¾çš„å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šæ¶‰åŠéƒ¨åˆ†çš„æºç ï¼Œæ‰€ä»¥æˆ‘å¼ºçƒˆå»ºè®®ä½ æ‰“å¼€ Xcode æˆ–è€… Android Studio å¯¹æºç éƒ¨åˆ†è¿›è¡Œæ–­ç‚¹è°ƒè¯•ï¼Œè¿™æ ·æ‰èƒ½å­¦å¾—æ›´é€å½»ã€‚</p><h2>è¯»æ–‡ç« </h2><p>ä¸è¿‡ï¼Œä¸ºäº†å¸®ä½ ç†æ¸…æ¥š React Native å›¢é˜Ÿçš„æ¶æ„è®¾è®¡æ€è·¯ï¼Œæˆ‘æƒ³å…ˆå¸¦ä½ çœ‹çœ‹å®˜æ–¹æ˜¯æ€ä¹ˆ<a href=\"https://reactnative.dev/docs/next/the-new-architecture/landing-page\">ä»‹ç»æ–°æ¶æ„</a>çš„ã€‚</p><p>åœ¨å®˜æ–¹å¯¹æ–°æ¶æ„ä»‹ç»çš„æ–‡ç« ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°å®˜æ–¹é‡ç‚¹æåˆ°äº†æ–°æ¶æ„çš„ä¸‰å¤§ä»¶ï¼Œåˆ†åˆ«æ˜¯<strong>Turbo Modules æ¨¡å—ç³»ç»Ÿã€Fabric ç»„ä»¶ç³»ç»Ÿ</strong>å’Œ<strong>Codegen ä»£ç ç”Ÿæˆå·¥å…·</strong>ã€‚</p><p>Turbo Modules æ¨¡å—ç³»ç»Ÿæ˜¯å…¨æ–°çš„åŸç”Ÿæ¨¡å—ç³»ç»Ÿï¼Œä»£æ›¿çš„æ˜¯è€æ¶æ„ä¸­çš„ Native Modulesã€‚å®˜æ–¹æ–‡æ¡£ä¸­çš„ APIï¼Œæ¯”å¦‚ Animatedã€Platformã€Keyboardï¼Œåœ¨è€æ¶æ„ä¸­éƒ½æ˜¯é‡‡ç”¨ Native Modules æ¥å®ç°çš„ï¼Œåœ¨æ–°æ¶æ„ä¸­éƒ½æ”¹ç”¨ Turbo Modules è¿›è¡Œå®ç°äº†ã€‚</p><!-- [[[read_end]]] --><p>Fabric ç»„ä»¶ç³»ç»Ÿå‘¢ï¼Œæ˜¯ä¸€å¥—å…¨æ–°çš„åŸç”Ÿç»„ä»¶ç³»ç»Ÿï¼Œä»£æ›¿çš„æ˜¯è€æ¶æ„ä¸­çš„ Native Componentsã€‚åœ¨å®˜æ–¹æ–‡æ¡£ä¸­çš„ Componentï¼Œæ¯”å¦‚ Viewã€Imageã€ScrollViewï¼Œåœ¨è€æ¶æ„éƒ½æ˜¯é‡‡ç”¨ Native Components å®ç°çš„ï¼Œåœ¨æ–°æ¶æ„ä¸­éƒ½æ”¹ç”¨ Fabric Components è¿›è¡Œå®ç°äº†ã€‚</p><p>è‡³äºCodegen ä»£ç ç”Ÿæˆå·¥å…·ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨ç¼–è¯‘æ—¶æŠŠ TypeScript å†™çš„ç±»å‹å£°æ˜ä»£ç ï¼Œè½¬æ¢ä¸ºç”¨ C++ å†™çš„ç±»å‹å£°æ˜ä»£ç ï¼Œä¾›ç»™åŸç”Ÿæ¨¡å—ä½¿ç”¨ã€‚è™½ç„¶Codegen æ˜¯ä¸ªéå¸¸æœ‰æ„æ€çš„å·¥å…·ï¼Œä½†å®ƒæ˜¯åœ¨ç¼–è¯‘æ—¶å·¥ä½œçš„ï¼Œè€Œæˆ‘ä»¬ä»Šå¤©è¦ç”»çš„â€œé¸Ÿç°å›¾â€æ˜¯æ–°æ¶æ„è¿è¡Œæ—¶çš„æ•´ä½“é€»è¾‘ã€‚</p><p>å› æ­¤ï¼Œè¿™èŠ‚è¯¾æˆ‘ä»¬å°±ä¸å†å¯¹ Codegen è¿›è¡Œå±•å¼€è®²è§£äº†ï¼Œæˆ‘ä»¬æŠŠç ”ç©¶çš„é‡ç‚¹æ”¾åœ¨ Turbo Modules å’Œ Fabric Components ä¸Šã€‚</p><h2>æ‰¾çº¿å¤´</h2><p>é‚£ä¹ˆï¼Œæ–°æ¶æ„ä¸­çš„ Turbo Modules å’Œ Fabric Components çš„ä»£ç åœ¨å“ªå‘¢ï¼Ÿæ‰¾åˆ°ä»£ç æ˜¯ç”»â€œé¸Ÿç°å›¾â€çš„å…³é”®æ­¥éª¤ï¼Œè¿™é‡Œæˆ‘ä»¬è¿ç”¨ä¸ŠèŠ‚è¯¾è®²è¿‡çš„â€œæ‰¾çº¿å¤´â€çš„æ–¹æ³•æ¥è¯•è¯•ã€‚</p><p>æ­£å¦‚æˆ‘ä»¬ä¸ŠèŠ‚è¯¾æ‰€è¯´ï¼ŒReact Native  0.70 ç‰ˆæ¯” React Native çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬çš„ä»£ç é‡å¤§ 10 å€ã€‚ç¬¬ä¸€ç‰ˆæ–‡ä»¶æ•°é‡åªæœ‰ 344 ä¸ªï¼Œåˆ°äº† 0.70 ç‰ˆæœ¬å°±å˜æˆäº† 3,840 ä¸ªäº†ã€‚é‚£æ€ä¹ˆåœ¨ 3,840 ä¸ªæ–‡ä»¶ä¸­ï¼Œå¼„æ˜ç™½ Turbo Modules å’Œ Fabric Components æ˜¯å¦‚ä½•åˆå§‹åŒ–çš„ï¼Œåˆæ˜¯å¦‚ä½•è¿ä½œçš„å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å°±å¾—æ‰¾æ‰¾çº¿å¤´äº†ã€‚</p><p>é¦–å…ˆï¼Œä½ å¯èƒ½ä¼šæƒ³ï¼Œåœ¨è€æ¶æ„ä¸­ï¼Œæˆ‘ä»¬æ²¿ç€ main å‡½æ•°æ‰¾åˆ°çš„ AppDelegate.m æ–‡ä»¶ï¼Œæ˜¯å¦è¿˜èƒ½ä½œä¸ºå¼„æ¸…æ–°æ¶æ„çš„å…³é”®çº¿å¤´å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬æ¥çœ‹ä»£ç ï¼ŒAppDelegate.m æ–‡ä»¶çš„ didFinishLaunchingWithOptions å›è°ƒï¼Œè¯¥å›è°ƒä¼šåœ¨ç¨‹åºå¯åŠ¨å®Œæˆæ—¶æ‰§è¡Œ React Native çš„åˆå§‹åŒ–ï¼Œå®ƒä»£ç æ‘˜è¦å¦‚ä¸‹ï¼š</p><pre><code class=\"language-objectivec\">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions\n{\n&nbsp; // åˆå§‹åŒ– bridge\n&nbsp; RCTBridge *bridge = [[RCTBridge alloc] initWithDelegate:self launchOptions:launchOptions];\n\n#if RCT_NEW_ARCH_ENABLED\n&nbsp; // å¦‚æœæ˜¯å¼€å¯äº†æ–°æ¶æ„ï¼Œé‚£ä¹ˆç”Ÿæˆ bridgeAdapter å¯¹ bridge è¿›è¡Œé€‚é…ã€‚\n&nbsp; _bridgeAdapter = [[RCTSurfacePresenterBridgeAdapter alloc] initWithBridge:bridge contextContainer:_contextContainer];\n&nbsp; bridge.surfacePresenter = _bridgeAdapter.surfacePresenter;\n#endif\n\n&nbsp; // åˆ›å»ºæ ¹è§†å›¾\n&nbsp; UIView *rootView = RCTAppSetupDefaultRootView(bridge, @\"RN70\", initProps);\n\n&nbsp; // å°†æ ¹è§†å›¾æŒ‚è½½åˆ° window ä¸Š\n&nbsp; self.window.rootViewController = rootView;\n}\n</code></pre><p>ä»ä¸Šè¿°ä»£ç æ‘˜è¦ä¸­ï¼Œä½ å¯ä»¥çœ‹å‡ºåœ¨ didFinishLaunchingWithOptions å›è°ƒä¸­ï¼Œæ–°æ¶æ„å’Œè€æ¶æ„åšçš„äº‹æƒ…å·®ä¸å¤šã€‚è¿™æ®µä»£ç å…ˆæ˜¯åˆå§‹åŒ–äº† Bridgeï¼Œç„¶ååˆç”Ÿæˆäº†ä¸€ä¸ª bridgeAdapterï¼Œä½ çœ‹è¿™ä¸ªå˜é‡å‘½åï¼Œå°±çŸ¥é“å®ƒæ˜¯æ–°æ¶æ„ä¸ºå…¼å®¹è€æ¶æ„åšçš„é€‚é…å¤„ç†ï¼Œæœ€åå°±æ˜¯åˆ›å»º React Native çš„æ ¹è§†å›¾ï¼Œå¹¶å°†æ ¹è§†å›¾æŒ‚è½½åˆ° window ä¸Šå’Œè¿›è¡Œé¡µé¢å±•ç¤ºçš„è¿‡ç¨‹äº†ã€‚</p><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ didFinishLaunchingWithOptions  å›è°ƒä¸­ï¼Œæ ¹æœ¬æ²¡æœ‰æ–°æ¶æ„çš„ Turbo Modules å’Œ Fabric Components çš„ç›¸å…³ä»£ç ï¼Œåå€’æ˜¯åˆå§‹åŒ–äº†è€æ¶æ„çš„ Bridgeã€‚</p><p>æºç çœ‹åˆ°ç¬¬ä¸€æ­¥ï¼Œå¾ˆå¤šåŒå­¦å¯èƒ½å°±ç³Šæ¶‚äº†ï¼Œæ–°æ¶æ„ä¸­ç«Ÿç„¶æ²¡æœ‰æ–°æ¶æ„ä»£ç ï¼Œåªæœ‰è€æ¶æ„çš„ Bridgeï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ</p><p>æœ‰äº›è®¤çœŸçš„åŒå­¦å¯èƒ½è¿˜ä¼šé€šè¿‡ Xcode æ–­ç‚¹ä¸€å±‚å±‚åœ°è·Ÿä¸‹å»ï¼Œä½†æ–­ç‚¹è·Ÿä¸‹å»å¤§æ¦‚ç‡è¿˜æ˜¯æ‰¾ä¸åˆ° Turbo Modules å’Œ Fabric Components æ˜¯å¦‚ä½•åˆå§‹åŒ–çš„ï¼Œèƒ½æ‰¾åˆ°è¿˜æ˜¯ Bridge åˆå§‹åŒ–çš„ç›¸å…³ä»£ç ã€‚</p><p>é‚£æ€ä¹ˆåŠå‘¢ï¼Ÿæ¡æ¡å¤§è·¯é€šç½—é©¬ï¼Œæ­¤è·¯ä¸é€šæœ‰è·¯é€šå•Šã€‚</p><p><strong>è¿™æ˜¯å› ä¸ºæ–°æ¶æ„é‡‡ç”¨äº†å¤šçº¿ç¨‹çš„æ¶æ„ï¼Œå•çº¯çš„æ–­ç‚¹è·Ÿä¸‹å»ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¼šåå¤åœ°åœ¨ Mian çº¿ç¨‹å’Œ JavaScript çº¿ç¨‹æ¨ªè·³ï¼Œè®©äººæ‘¸ä¸ç€åŒ—ã€‚</strong>æ—¢ç„¶ AppDelegate.m è¿™æ ¹çº¿å¤´è§£ä¸å¼€ï¼Œé‚£ä¹ˆå’±ä»¬å°±æƒ³åŠæ³•æ¢æ ¹å…¶ä»–çº¿å¤´ã€‚</p><h2>è¿æ¥ç‚¹</h2><p>æ–°çš„çº¿å¤´å°±æ˜¯è¿æ¥ç‚¹ã€‚</p><p><strong>æ‰€è°“çš„è¿æ¥ç‚¹å°±æ˜¯ Native å’Œ JavaScript é€šè®¯çš„å…³é”®å¯¹è±¡æˆ–æ–¹æ³•ã€‚</strong></p><p>ä¸Šä¸€è®²ä¸­ï¼Œæˆ‘ä»¬æåˆ°è¿‡ Native ä¹‹æ‰€ä»¥èƒ½æ‰§è¡Œ JavaScript Bundle æ–‡ä»¶ï¼Œå°±æ˜¯å› ä¸ºNative èƒ½è°ƒç”¨ JavaScript Engine çš„èƒ½åŠ›ã€‚æ‰€è°“çš„ Bridge ä¹Ÿå¥½ï¼ŒTurbo Modulesã€Fabric Components ä¹Ÿç½¢ï¼Œæ— éå°±æ˜¯ Native èƒ½å¤Ÿè°ƒç”¨ JavaScriptï¼Œè€Œ JavaScript ä¹Ÿèƒ½è°ƒç”¨ Nativeï¼ŒäºŒè€…é€šè¿‡ä¸€äº›å…³é”®çš„è¿æ¥ç‚¹å®ç°äº†åŒå‘è°ƒç”¨ã€‚</p><p>å› ä¸º Native èƒ½å¤Ÿæ§åˆ¶ JavaScript Engineï¼Œæ‰€ä»¥ Native èƒ½å¤Ÿæ“ä½œæ‰€æœ‰çš„ JavaScript å˜é‡ï¼Œä¹Ÿèƒ½è°ƒç”¨ä»»æ„çš„ JavaScript  å‡½æ•°ã€‚å› æ­¤è¿™é‡Œå…³é”®çš„éš¾ç‚¹æ˜¯ï¼ŒJavaScript æ€ä¹ˆè°ƒç”¨ Native å‡½æ•°å‘¢ï¼Ÿ</p><p>è¿™å°±è¦ä¾èµ– Native å‘ JavaScript ä¸Šä¸‹æ–‡ä¸­æ³¨å…¥çš„ç‰¹æ®Šå˜é‡äº†ã€‚åœ¨ React Native æ–°æ¶æ„ä¸­ï¼ŒNative ä¼šå‘ JavaScript ä¸­æ³¨å…¥ä¸‰ä¸ªå…³é”®å˜é‡ï¼Œè¿™ä¸‰ä¸ªå˜é‡å°±æ˜¯è¿æ¥ç‚¹äº†ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š</p><ul>\n<li><strong>nativeFlushQueueImmediate</strong>ï¼Œå®ƒæ˜¯ Bridge éƒ¨åˆ†ä¸­ JavaScript è°ƒç”¨ Native çš„è¿æ¥ç‚¹ï¼›</li>\n<li><strong>__turboModuleProxy</strong>ï¼Œå®ƒæ˜¯ Turbo Modules  éƒ¨åˆ†ä¸­ JavaScript è°ƒç”¨ Native çš„è¿æ¥ç‚¹ï¼›</li>\n<li><strong>nativeFabricUIManager</strong>ï¼Œå®ƒæ˜¯ Fabric Components éƒ¨åˆ†ä¸­ JavaScript è°ƒç”¨ Native çš„è¿æ¥ç‚¹ã€‚</li>\n</ul><p>æœ‰äº†ä»¥ä¸Šä¸‰ä¸ªè¿æ¥ç‚¹ï¼Œå°±èƒ½å¿«é€Ÿåœˆå®šæˆ‘ä»¬è¯»æºç çš„å†…å®¹ï¼Œå¸®æˆ‘ä»¬å¿«é€Ÿç†è§£æºç çš„å®ç°é€»è¾‘ã€‚ä½ å¯ä»¥ä½¿ç”¨ Xcode æœç´¢ä¸‰ä¸ªè¿æ¥ç‚¹çš„å…³é”®å­—ï¼Œè¿™æ ·ä½ å°±èƒ½åœ¨ 3,840 æ–‡ä»¶ä¸­ï¼Œå¿«é€Ÿå®šä½åˆ° 6 ä¸ªå…³é”®æ–‡ä»¶äº†ï¼ŒåŒ…æ‹¬ 3 ä¸ªè¿æ¥ç‚¹åˆ†åˆ«åœ¨ 3 ä¸ª Native æ–‡ä»¶ä¸­åˆå§‹åŒ–çš„å®ç°ä»£ç ï¼Œä»¥åŠ 3 ä¸ªè¿æ¥ç‚¹åœ¨ 3 ä¸ª JavaScript æ–‡ä»¶ä¸­æ˜¯å¦‚ä½•ä½¿ç”¨çš„ä»£ç ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±åˆ†åˆ«å¯¹è¿™ä¸‰ä¸ªè¿æ¥ç‚¹è¦å®ç°çš„ Bridgeã€Turbo å’Œ Fabric ä¸‰ç§é€šä¿¡æ–¹å¼è¿›è¡Œè¯¦ç»†çš„ä»£ç å‰–æã€‚</p><h3>Bridge</h3><p>å…ˆæ¥çœ‹ Bridge éƒ¨åˆ†çš„ç›¸å…³ä»£ç å’Œè°ƒç”¨æ—¶åºå›¾ï¼š</p><pre><code class=\"language-c++\">// ReactCommon/jsiexecutor/jsireact/JSIExecutor.cpp\n// åœ¨ ios åˆå§‹åŒ– Bridge çš„è¿æ¥ç‚¹\nruntime_-&gt;global().setProperty(\n    *runtime_,\n    \"nativeFlushQueueImmediate\",\n    Function::createFromHostFunction(\n        *runtime_,\n        PropNameID::forAscii(*runtime_, \"nativeFlushQueueImmediate\"),\n        1,\n        [this](\n            jsi::Runtime &amp;,\n            const jsi::Value &amp;,\n            const jsi::Value *args,\n            size_t count) {\n        callNativeModules(args[0], false);\n        return Value::undefined();\n        }));\n\n// åœ¨ js ä¾§ä½¿ç”¨ Bridge\n// queue = '[[15],[0],[[35,500,1664101345473,false]],175]'\nnativeFlushQueueImmediate(queue)\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/b4/40/b41af9f90047991yycd6cf371761bb40.png?wh=1920x1016\" alt=\"å›¾ç‰‡\"></p><p>é¦–å…ˆï¼Œåœ¨ C++ æ–‡ä»¶ JSIExecutor.cpp ä¸­ï¼ŒReact Native å…ˆé€šè¿‡ runtime_-&gt;global() è·å–äº† JavaScript ä¸Šä¸‹æ–‡ä¸­çš„ global å˜é‡ï¼Œç„¶åå†é€šè¿‡ setProperty æ–¹æ³•ï¼Œåœ¨ JavaScript çš„ global çš„ nativeFlushQueueImmediate å±æ€§ä¸Šï¼ŒæŠŠ Native çš„å‡½æ•° callNativeModules() ç»™è¿æ¥èµ·æ¥äº†ï¼ŒcallNativeModules å°±æ˜¯ Native ä¸­ï¼Œè°ƒç”¨åŸç”Ÿæ¨¡å—çš„å®ç°å‡½æ•°ã€‚</p><p>è¿™æ ·ï¼Œå½“æˆ‘ä»¬åœ¨ JavaScript ä¾§è°ƒç”¨ nativeFlushQueueImmediate å‡½æ•°æ—¶ï¼Œä¼šå°†å…¶å‚æ•° queue ä¼ ç»™ callNativeModules å¤„ç†ã€‚æ¯”å¦‚ï¼ŒäºŒç»´æ•°ç»„ queue ä¸­çš„ç¬¬ä¸€é¡¹ [[15]]ï¼Œå°±ä»£è¡¨ç€æ‰¹é‡è°ƒç”¨ 15 å¯¹åº”çš„åŸç”Ÿ Timing æ¨¡å—ã€‚</p><p>å½“æˆ‘ä»¬æåˆ°åœ¨ JavaScript ä½¿ç”¨ Bridge æ—¶ï¼Œç»å¤§å¤šæ•°æƒ…å†µæŒ‡çš„å°±æ˜¯åœ¨ JavaScript ä¸­è°ƒç”¨ nativeFlushQueueImmediate å‡½æ•°ã€‚</p><p>ä½†æ˜¯ï¼ŒnativeFlushQueueImmediate å‡½æ•°å’Œæˆ‘ä»¬å¹³æ—¶è°ƒç”¨çš„æ™®é€šå‡½æ•°ä¸ä¸€æ ·ã€‚æ™®é€šå‡½æ•°æœ‰å…¥å‚ï¼Œæœ‰æ‰§è¡Œè¿‡ç¨‹ï¼Œè¿˜æœ‰ä¼šæ‰§è¡Œè¿”å›å€¼ï¼Œè€Œ nativeFlushQueueImmediate æ˜¯ä¸€ä¸ªæ‰¹å¤„ç†å‡½æ•°ï¼Œå®ƒçš„å…¥å‚æ˜¯ä¸ªäºŒç»´æ•°ç»„ï¼ŒäºŒç»´æ•°ç»„ä¸­çš„å†…å®¹ï¼Œè®°å½•äº†å¤šä¸ªæ™®é€šå‡½æ•°çš„åå­—ã€å…¥å‚ï¼Œç„¶å Native å†æ ¹æ®æ™®é€šå‡½æ•°çš„åå­—ã€å…¥å‚åˆ†åˆ«å¯¹å®ƒä»¬è¿›è¡Œè°ƒç”¨ã€‚</p><p>é‚£è¿™äº›åœ¨ Native ä¸­è°ƒç”¨çš„æ™®é€šå‡½æ•°çš„è¿”å›å€¼å¦‚ä½•è¿”å›ç»™ JavaScript å‘¢ï¼Ÿ</p><p>æ˜¯ç»§ç»­é€šè¿‡ nativeFlushQueueImmediate çš„ return å€¼æŠŠæ‰€æœ‰æ™®é€šå‡½æ•°çš„æ‰§è¡Œç»“æœæ‰¹é‡è¿”å›å—ï¼Ÿæ‰¹é‡è¿”å›è‚¯å®šä¸é è°±çš„ï¼Œè¿™æ ·ä¸€æ¥ï¼Œåªè¦æœ‰ä¸€ä¸ªæ™®é€šå‡½æ•°æ‰§è¡Œæ…¢ï¼Œå°±ä¼šæŠŠæ•´ä¸ªé˜Ÿåˆ—ç»™å¡æ­»ï¼Œå› æ­¤ nativeFlushQueueImmediate return çš„æ˜¯ undefinedã€‚</p><p>æ‰¹é‡è°ƒç”¨çš„æ™®é€šå‡½æ•°çš„è¿”å›å€¼ï¼Œæ˜¯é€šè¿‡å…¶ä»–çš„ Native é€”å¾„ä¸€ä¸ªä¸€ä¸ªè¿”å›ç»™ JavaScript çš„ã€‚Native ä¼šç›´æ¥è°ƒç”¨ JavaScript ä¸­çš„ invokeCallback æ–¹æ³•ï¼Œç”¨æœ€å¿«çš„é€Ÿåº¦å°†æ™®é€šå‡½æ•°çš„æ‰§è¡Œç»“æœç»™åˆ†åˆ«è¿”å›ã€‚</p><p>ä»¥ä¸Šï¼Œå°±æ˜¯ Bridge å®ç° JavaScript ä¸ Native åŒå‘æ“ä½œçš„æ ¸å¿ƒåŸç†ã€‚</p><p>ç›®å‰ï¼Œåœ¨ 0.70 ç‰ˆæœ¬çš„æ–°æ¶æ„é¢„è§ˆç‰ˆä¸­ï¼Œè¿˜ä¿ç•™äº†éƒ¨åˆ†çš„ Bridge è°ƒç”¨ï¼Œä½†æ˜¯ä¸€äº›æ ¸å¿ƒçš„æ“ä½œï¼Œæ¯”å¦‚è·å– Platform ä¿¡æ¯ã€åˆ›å»º React Native èŠ‚ç‚¹ç­‰ï¼Œè¿™äº›æ“ä½œéƒ½å·²ç»é‡‡ç”¨ Turbo Modules å’Œ Fabric Components å®ç°äº†ã€‚</p><h3>Turbo Modules</h3><p>æ¥ç€ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹ Turbo Modules çš„åº•å±‚å®ç°ï¼Œå®ƒæ‰æ˜¯æ–°æ¶æ„çš„æ ¸å¿ƒæ¨¡å—ã€‚Turbo Modules è¿æ¥ç‚¹çš„å®ç°ä»£ç å’Œè°ƒç”¨æ—¶åºå›¾å¦‚ä¸‹ï¼š</p><pre><code class=\"language-c++\">// ReactCommon/react/nativemodule/core/ReactCommon/TurboModuleBinding.cpp\n// åœ¨ ios åˆå§‹åŒ– Turbo Modules çš„è¿æ¥ç‚¹\nruntime.global().setProperty(\n    runtime,\n    \"__turboModuleProxy\",\n    jsi::Function::createFromHostFunction(\n        runtime,\n        jsi::PropNameID::forAscii(runtime, \"__turboModuleProxy\"),\n        1,\n        [binding = TurboModuleBinding(\n            std::move(moduleProvider),\n            bindingMode,\n            std::move(longLivedObjectCollection))](\n            jsi::Runtime &amp;rt,\n            const jsi::Value &amp;thisVal,\n            const jsi::Value *args,\n            size_t count) mutable {\n        return binding.getModule(rt, thisVal, args, count);\n        }));\n\n\n\n// Libraries/TurboModule/TurboModuleRegistry.js\n// åœ¨ js è·å– Turbo Modules\nglobal.__turboModuleProxy(name)\n// name = \"Appearance\"\n// return = {addListener,removeListeners,getColorScheme}\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/01/09/013a7cf77ed973e1466b5c258522d809.png?wh=1908x1161\" alt=\"å›¾ç‰‡\"></p><p>ä»ä¸Šè¿°ä»£ç å’Œæ—¶åºå›¾ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼Œæœ€å¼€å§‹åœ¨ C++ æ–‡ä»¶ TurboModuleBinding.cpp ä¸­ï¼Œå…ˆé€šè¿‡ runtime.global() è·å–äº† JavaScript å…¨å±€å˜é‡ globalï¼Œç„¶åå†é€šè¿‡ setProperty è®¾ç½®äº† global çš„ turboModuleProxy å±æ€§ã€‚</p><p>turboModuleProxy  å±æ€§æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°æ¥å—ä¸€ä¸ªå…¥å‚æ˜¯ Turbo Modules çš„åå­—ï¼Œå‡½æ•°çš„è¿”å›å€¼æ˜¯è¯¥ Turbo Module åœ¨ Native ä¾§çš„åŸç”Ÿå®ç°äº†ã€‚æ¯”å¦‚ï¼ŒturboModuleProxy(â€œAppearanceâ€) çš„è¿”å›å°±æ˜¯ Native çš„æš—é»‘æ¨¡å¼ Module ç”Ÿæˆçš„å®ä¾‹å¯¹è±¡äº†ï¼Œè¯¥å¯¹è±¡åŒ…æ‹¬ addListener,removeListeners,getColorScheme æ–¹æ³•ã€‚</p><p>å¯¹æ¯” Bridge å’Œ Turbo Modules è¿æ¥ç‚¹çš„è®¾è®¡ï¼Œä½ å¯ä»¥çœ‹å‡ºï¼ŒBridge æ˜¯æ‰¹å¤„ç†ï¼Œè€Œ Turbo Modules è°ƒç”¨ä¸€æ¬¡å°±æ˜¯ä¸€æ¬¡ï¼Œè°ƒç”¨ä¸¤æ¬¡å°±æ˜¯ä¸¤æ¬¡ã€‚æ›´å…³é”®çš„æ˜¯ï¼ŒBridge ä»»åŠ¡çš„è°ƒç”¨å’Œä»»åŠ¡çš„è¿”å›å€¼æ˜¯åˆ†ç¦»çš„ï¼Œè€Œ Turbo Modules çš„è°ƒç”¨æ–¹å¼å’Œ JavaScript ç³»ç»Ÿå‡½æ•°çš„è°ƒç”¨æ–¹å¼æ˜¯ä¸€æ ·çš„ã€‚</p><p>è¿™å°±æ„å‘³ç€ï¼Œ<strong>æˆ‘ä»¬åªéœ€åœ¨åˆå§‹åŒ–æ—¶ï¼Œè°ƒç”¨ä¸€æ¬¡ turboModuleProxy(â€œAppearanceâ€) æ‹¿åˆ° Appearance å®ä¾‹å°±è¡Œï¼Œä¸ç”¨åå¤è°ƒç”¨ turboModuleProxy(â€œAppearanceâ€) å†æ¬¡è·å–å®ä¾‹äº†ã€‚</strong>ä¸‹æ¬¡å†ç»§ç»­è°ƒç”¨æ—¶ï¼Œç›´æ¥åœ¨ JavaScript ä¾§æ‹¿ç€ Appearance.getColorScheme è°ƒç”¨ Native å®šä¹‰çš„å‡½æ•°å°±å¯ä»¥äº† ï¼Œè¿™å°±ä¸ºåç»­æ“ä½œå¸¦æ¥äº†æå¤§çš„ä¾¿åˆ©æ€§ã€‚</p><h3>Fabric Components</h3><p>æœ€åä¸€ä¸ªå…³é”®çš„è¿æ¥ç‚¹æ˜¯ Fabric Components çš„è¿æ¥ç‚¹ nativeFabricUIManage äº†ï¼Œå…¶ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-c++\">// ReactCommon/react/renderer/uimanager/UIManagerBinding.cpp \n// å°† Native çš„ uiManager å®ä¾‹å’Œè¿è¡Œæ—¶æ‰§è¡Œå™¨ç»‘å®š\nauto uiManagerBinding =\n    std::make_shared&lt;UIManagerBinding&gt;(uiManager, runtimeExecutor);\n// å°† Native çš„ uiManager ç¤ºä¾‹è½¬æ¢ä¸º JS çš„ Object æ•°æ®ç±»å‹ \nauto object = jsi::Object::createFromHostObject(runtime, uiManagerBinding);\n// å°†è¯¥ object ç»‘å®šåˆ° JS çš„ global.nativeFabricUIManager ä¸Šã€‚\nruntime.global().setProperty(\n    runtime, \"nativeFabricUIManager\", std::move(object));\n}\n\n// Libraries/Renderer/implementations/ReactFabric-dev.js\n// åˆ›å»ºä¸€ä¸ª Native èŠ‚ç‚¹ï¼Œå¹¶è·å–è¯¥èŠ‚ç‚¹çš„å¼•ç”¨\nconst node = global.nativeFabricUIManage.createNode(\n    tag, // reactTag\n    viewConfig.uiViewClassName, // viewName\n    rootContainerInstance, // rootTag\n    updatePayload, // props\n    internalInstanceHandle // internalInstanceHandle\n) \n\n// åœ¨ JavaScript ä¸­æ‰“å°ä¸å‡ºä»»ä½• node çš„ä¿¡æ¯\nconsole.log(node) // {}\nconsole.log(node.__proto__) // undefined\n\n// ä½†åœ¨ JavaScript ä¸­å´å¯ä»¥è°ƒç”¨ Native æ–¹æ³•æ“ä½œ node\n// å‘çˆ¶èŠ‚ç‚¹ node1 ä¸­ï¼Œæ’å…¥å­èŠ‚ç‚¹ node2\nglobal.nativeFabricUIManage.appendChildNode(node1, node2)\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/34/62/3415df54013f2868f23d35c99c58fd62.png?wh=1920x1082\" alt=\"å›¾ç‰‡\"></p><p>JavaScript ä¸­çš„ global.nativeFabricUIManage æ˜¯åœ¨ C++ æ–‡ä»¶ UIManagerBinding.cpp ä¸­åˆ›å»ºçš„ï¼Œä¸å…¶å¯¹åº”çš„æ˜¯ Native çš„ uiManager å®ä¾‹ã€‚</p><p>åœ¨ Native ä¾§ï¼ŒuiManager å®ä¾‹ä¸Šæœ‰æ“ä½œèŠ‚ç‚¹çš„æ–¹æ³•ï¼Œæ¯”å¦‚ç±»ä¼¼ DOM çš„æ“ä½œæ–¹æ³• createNodeã€appendChildNodeã€‚åœ¨ JavaScript ä¾§ï¼ŒnativeFabricUIManage å¯¹è±¡ä¸Šä¹Ÿæœ‰ç›¸å¯¹åº”çš„å±æ€§ createNodeã€appendChildNode ï¼Œé€šè¿‡å®ƒä»¬å°±èƒ½è°ƒç”¨ Native ä¾§çš„å®ç°äº†ã€‚</p><p>å½“ç„¶ï¼ŒReact Native å±äºå£°æ˜å¼ç¼–ç¨‹ï¼Œå¼€å‘è€…ä¸ä¼šæ¶‰åŠå¯¹èŠ‚ç‚¹çš„å…·ä½“æ“ä½œï¼Œä¹Ÿä¸ä¼šç›´æ¥è°ƒç”¨ createNodeã€appendChildNode å»æ“ä½œèŠ‚ç‚¹ã€‚å¼€å‘è€…åªéœ€å€ŸåŠ© React setState æ§åˆ¶çŠ¶æ€å³å¯ï¼Œè‡³äºå…·ä½“çš„èŠ‚ç‚¹æ“ä½œä¼šäº¤ç»™åº•å±‚çš„ ReactFabric.js æ–‡ä»¶è¿›è¡Œå¤„ç†ã€‚</p><p>åœ¨ ReactFabric.js æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ° React Native åº•å±‚ä½¿ç”¨ createNode åˆ›å»ºèŠ‚ç‚¹çš„ä»£ç ã€‚createNode æ–¹æ³•çš„å…¥å‚æ˜¯ reactTagã€viewNameã€rootTagã€propsã€internalInstanceHandleã€‚</p><p>æ¯”å¦‚ï¼Œä½ æƒ³åˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹ï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥å°† viewName çš„ä¼ å‚è®¾ç½®æˆ â€œRCTRawTextâ€ï¼Œä½ æƒ³åˆ›å»ºæ»šåŠ¨å®¹å™¨èŠ‚ç‚¹ï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥å°† viewName çš„ä¼ å‚è®¾ç½®æˆ â€œRCTScrollViewâ€ã€‚</p><p>åˆ›å»ºå®Œæˆåï¼ŒNative ä¾§ä¼šç»™ JavaScript è¿”å›ä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨ï¼Œè™½ç„¶åœ¨ JavaScript ä¾§ä½ æ‰“å°ä¸å‡ºä»»ä½•å±æ€§æ¥ï¼Œè¯¥å¼•ç”¨ç”šè‡³è¿ proto å±æ€§éƒ½æ²¡æœ‰ã€‚ä½†æ˜¯ä½ å´å¯ä»¥ä½¿ç”¨ appendChildNode å»æ“ä½œè¿™äº›èŠ‚ç‚¹ï¼Œæ¯”å¦‚ä½ å¯ä»¥ä½¿ç”¨ appendChildNode  æ–¹æ³•æŠŠä»»æ„çš„ node2 èŠ‚ç‚¹æ’åˆ° node1 èŠ‚ç‚¹ä¸­ã€‚</p><p>è¿™äº›èŠ‚ç‚¹æœ‰ä¸ªä¸“æœ‰çš„åå­—å«åš<strong>å½±å­èŠ‚ç‚¹ ShadowNode</strong>ï¼Œå®ƒåœ¨ JavaScript ä¸­å°±å¦‚åŒå½±å­ä¸€èˆ¬ï¼Œæ‰“å°ä¸å‡ºä»»ä½•å±æ€§ï¼Œä½†æ˜¯åœ¨ Native ä¾§ä½ å¯ä»¥æ–­ç‚¹çœ‹åˆ°å®ƒçš„ propsã€stateã€children ç­‰å±æ€§ï¼Œæˆ‘ç»™ä½ æˆªå›¾ä¸‹æ¥äº†ï¼Œä½ å¯ä»¥çœ‹çœ‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/29/02/29567e7a25b2d61db4e011a4e826d902.png?wh=458x372\" alt=\"å›¾ç‰‡\"></p><h2>é¸Ÿç°å›¾</h2><p>äº†è§£å®Œ Bridgeã€Turboã€Fabric çš„ç›¸å…³å®ç°åï¼Œ<strong>ä½ ä¸€å®šè¦åœ¨è„‘ä¸­è¿‡ä¸€ä¸‹æ•´ä¸ªæ–°æ¶æ„çš„å®ç°æµç¨‹ï¼Œå†äº²è‡ªåŠ¨æ‰‹å»æ‰“æ–­ç‚¹ï¼Œæ‰§è¡Œä¸€ä¸‹ç¨‹åºï¼Œçœ‹çœ‹å®é™…æ‰§è¡Œè¿‡ç¨‹æ˜¯å¦ç¬¦åˆä½ çš„é¢„æœŸ</strong>ã€‚</p><p>åªæœ‰å½“ä½ è‡ªå·±çœŸæ­£ä½¿ç”¨ Xcodeã€Android Studio åˆ°æºç ä¸­æ–­ç‚¹ Bridgeã€Turboã€Fabric ç›¸å…³ä»£ç åï¼Œä½ æ‰èƒ½ä½“ä¼šåˆ°å®é™…çš„æ‰§è¡Œè¿‡ç¨‹å’Œä½ é¢„æœŸçš„ç»“æœæœ‰ä»€ä¹ˆå·®åˆ«ã€‚æˆ‘è‡ªå·±åœ¨åŠ¨æ‰‹æ–­ç‚¹çš„è¿‡ç¨‹ä¸­ï¼Œå°±å¤§åƒä¸€æƒŠï¼ŒåŸæ¥çœ‹å®Œæºç åï¼Œå®é™…çš„æ‰§è¡Œè¿‡ç¨‹è¿˜æ˜¯å’Œè‡ªå·±çš„é¢„æœŸå·®åˆ«å¾ˆå¤§ã€‚</p><p>æœ€å¼€å§‹ï¼Œæˆ‘é¢„æœŸæ–°æ¶æ„ä¸­ Bridge ä»£ç å°±æ˜¯ä¸€ä¸ªæ‘†è®¾ï¼Œå®é™…å·²ç»ä¸ä¼šèµ°åˆ° Bridge çš„ç›¸å…³æ‰§è¡Œæµç¨‹äº†ã€‚å› ä¸ºå®˜æ–¹å¤šæ¬¡å¼ºè°ƒè¿‡ï¼ŒBridge çš„æ€§èƒ½æ˜¯æ¯” Turbo å’Œ Fabric å·®çš„ã€‚æœ‰äº† Turbo å’Œ Fabric åï¼Œæ–°æ¶æ„æ²¡å¿…è¦ç”¨ä¸ªæ€§èƒ½æ›´å·®çš„ Bridge äº†ï¼Œæ˜¯å§ï¼Ÿ</p><p>ä½†å®é™…æ‰§è¡Œæ—¶ï¼Œæˆ‘å´å‘ç°æ–°æ¶æ„ä¸­å±…ç„¶è¿˜åœ¨è°ƒç”¨è€æ¶æ„çš„ Bridge å®ç°é€šä¿¡ã€‚</p><p>æˆ‘åŠ¨æ‰‹è·‘äº†ä¸€ä¸‹å®˜æ–¹æä¾›çš„é»˜è®¤å·¥ç¨‹ï¼Œå‘ç° React Native ç¨‹åºå¯åŠ¨æ—¶ï¼Œæœ€å…ˆå®Œæˆåˆå§‹åŒ–çš„æ˜¯ Bridge éƒ¨åˆ†ï¼Œç„¶åæ˜¯ Turbo éƒ¨åˆ†ï¼Œè€Œ Fabric æ˜¯æŒ‰éœ€åˆå§‹åŒ–çš„ï¼Œåªæœ‰ Bundle ä»£ç è°ƒç”¨äº† Fabric çš„ç›¸å…³é€»è¾‘æ—¶ï¼Œæ‰ä¼šåˆå§‹åŒ–ã€‚</p><p>ç„¶åæˆ‘åˆå†™äº†ä¸€äº›ç®€å•çš„åˆ›å»ºçŠ¶æ€è§†å›¾å’Œè°ƒç”¨APIçš„ä»£ç ï¼Œè¿›è¡Œäº†æµ‹è¯•ï¼Œåˆå‘ç°æ–°æ¶æ„ä¸­ç¡®ç¡®å®å®ç”¨åˆ°äº†è€æ¶æ„çš„ Bridgeã€‚æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°ï¼Œåœ¨ 26 ä¸ª Module ä¸­ï¼Œæœ‰ä¸¤ä¸ª Module ä½¿ç”¨äº† Bridgeï¼Œè¿™ä¸¤ä¸ª Module åˆ†åˆ«æ˜¯ Timing å’Œ NativeAnimatedModuleã€‚</p><p>26 ä¸ªå…¨éƒ¨ Module æˆ‘ä¹Ÿæ”¾åœ¨äº†ä¸‹é¢ï¼Œå°±ä¸ä¸€ä¸€å¿µåå­—äº†ï¼Œä½ å¯ä»¥è‡ªå·±çœ‹çœ‹ï¼Œè¯•è¯•æ˜¯å¦è¿˜æœ‰å…¶ä»– Module åœ¨ä½¿ç”¨ Bridgeã€‚</p><pre><code class=\"language-plain\">// Bridge ä¸­ ModuleID ä¸ ModuleName çš„å¯¹åº”å…³ç³»ï¼š\n[0]  = \"ViewManager\"\n[1]  = \"ActivityIndicatorViewManager\"\n[2]  = \"DatePickerManager\"\n[3]  = \"MaskedViewManager\"\n[4]  = \"ModalHostViewManager\"\n[5]  = \"ModalManager\"\n[6]  = \"ProgressViewManager\"\n[7]  = \"RefreshControlManager\"\n[8]  = \"SafeAreaViewManager\"\n[9]  = \"ScrollContentViewManager\"\n[10] = \"ScrollViewManager\"\n[11] = \"SegmentedControlManager\"\n[12] = \"SliderManager\"\n[13] = \"SwitchManager\"\n[14] = \"UIManager\"\n[15] = \"Timing\"\n[16] = \"NativeAnimatedModule\"\n[17] = \"ImageViewManager\"\n[18] = \"BaseText\"\n[19] = \"BaseTextInputViewManager\"\n[20] = \"InputAccessoryViewManager\"\n[21] = \"MultilineTextInputViewManager\"\n[22] = \"RawText\"\n[23] = \"SinglelineTextInputViewManager\"\n[24] = \"Text\"\n[25] = \"VirtualText\"\n</code></pre><p>æˆ‘ä¹Ÿé€‰äº†å‡ ä¸ª API è¿›è¡Œäº†æµ‹è¯•ï¼ŒåŒ…æ‹¬ Appearanceã€DeviceInfoã€Platformï¼Œè¿™äº› API åˆç¡®ç¡®å®å®éƒ½ä½¿ç”¨çš„æ˜¯ Turbo Module è¿›è¡Œè°ƒç”¨çš„ã€‚</p><p>å’Œ Turbo Module ç›¸å…³çš„æ¨¡å—ä¸€å…±æœ‰ 25 ä¸ªï¼Œæˆ‘ä¹Ÿè´´åœ¨äº†ä¸‹é¢ï¼š</p><pre><code class=\"language-plain\">Networking\nAppearance\nFrameRateLogger\nViewManager\nBugReporting\nRedBox\nEventDispatcher\nNativeAnimatedTurboModule\nStatusBarManager\nDeviceInfo\nHeadlessJsTaskSupport\nLogBox\nAppState\nWebSocketModule\nSourceCode\nSoundManager\nBlobModule\nKeyboardObserver\nImageLoader\nPlatformConstants\nDevMenu\nAccessibilityManager\nDevLoadingView\nDevSettings\n</code></pre><p>åŒæ ·ï¼Œæˆ‘è¿˜æµ‹è¯•äº† Fabric Componentï¼Œä»æµ‹è¯•ç»“æœä¸­ï¼Œå¯ä»¥æ¨å‡º React Native å®˜æ–¹æä¾›çš„ 9 ä¸ª Component éƒ½æ˜¯é€šè¿‡ Fabric è¿›è¡Œåˆ›å»ºå’Œæ“ä½œçš„ï¼Œè¿™ 9 ä¸ª Component å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">SafeAreaView\nScrollView\nView\nParagraph\nRootView\nRawText\nTextInput\nText\nImage\n</code></pre><p>çœ‹å®Œæºç å¹¶äº†è§£ 0.70 æ–°æ¶æ„é¢„è§ˆç‰ˆçš„ç°çŠ¶ä¹‹åï¼Œæˆ‘ä¸ç¦é™·å…¥äº†æ²‰æ€ã€‚</p><p>ä¸ºä»€ä¹ˆæ–°æ¶æ„é¢„è§ˆç‰ˆä¸­æ˜æ˜å·²ç»å¤§è§„æ¨¡ç”¨ä¸Šäº† Turbo  å’Œ Fabric ï¼Œè¿˜è¦åˆå§‹åŒ–å’Œä½¿ç”¨ Bridgeå‘¢ï¼Ÿ</p><p>æ˜¯ Bridge ä»£ç è¿˜æ²¡æ¥å¾—åŠä¼˜åŒ–å®Œæˆï¼Ÿåˆæˆ–è€…å› ä¸ºåœ¨å¤„ç† Timingã€NativeAnimatedModule è¿™äº›ç‰¹æ®Šåœºæ™¯ä¸­ï¼Œ Bridge æ¯” Turbo å’Œ Fabric æ€§èƒ½æ›´å¥½å‘¢ï¼Ÿè¿˜æ˜¯ä¸ºäº†æ–¹ä¾¿ä¸šåŠ¡ä»£ç è¿ç§»ï¼Œå› æ­¤å‘ä¸‹å…¼å®¹äº†è€æ¶æ„å‘¢ï¼Ÿ</p><p><strong>æˆ‘ä¸ªäººæ›´å€¾å‘äºæœ€åä¸€ä¸ªç­”æ¡ˆï¼Œéœ€è¦å‘ä¸‹å…¼å®¹ã€‚</strong></p><p>ä¸€æ–¹é¢æ˜¯å› ä¸ºï¼Œå®˜æ–¹æ–‡æ¡£æåˆ°ç¬¬ä¸‰æ–¹åº“å¼€å‘è€…éœ€è¦å¯¹ Bridgeã€Turbo å’Œ Fabric è¿›è¡Œå…¼å®¹ï¼Œä»¥æ–¹ä¾¿ä¸šåŠ¡ä»£ç çš„è¿ç§»ã€‚</p><p>å¦ä¸€æ–¹é¢æ˜¯ï¼Œç›®å‰åŸºäº Bridge çš„åº“æ˜¯ä¸èƒ½ç›´æ¥è¿è¡Œåœ¨ Turbo å’Œ Fabric ä¸Šçš„ï¼Œå› æ­¤ä»ç†è®ºä¸Šæ¨æµ‹ï¼Œå¦‚æœå®˜æ–¹å¼ºåˆ¶è®©åŸå…ˆæ‰€æœ‰ä¾èµ– Bridge çš„ä¸šåŠ¡ä»£ç ã€åº•å±‚åº“éƒ½æ”¹ç”¨ Turbo å’Œ Fabric è¿›è¡Œé‡å†™ï¼Œç¤¾åŒºè‚¯å®šå‡çº§ä¸åŠ¨ã€‚7 å¹´ç§¯ç´¯çš„å·¨é‡ä»£ç ï¼Œå“ªæ˜¯è¿™ä¹ˆå®¹æ˜“å°±ç”©æ‰çš„åŒ…è¢±å•Šï¼Ÿ</p><p>åŸºäºä»¥ä¸Šäº‹å®å’Œæ¨ç†ï¼Œåœ¨æˆ‘å¿ƒç›®ä¸­ 0.70 æ–°æ¶æ„é¢„è§ˆç‰ˆçš„é¸Ÿç°å›¾ï¼Œå®ƒå¤§æ¦‚é•¿è¿™ä¸ªæ ·å­ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/8d/d1/8d0fe585c29d6df54d30d59c535c53d1.png?wh=1878x842\" alt=\"å›¾ç‰‡\"></p><p>æ–°æ¶æ„ä¸­ï¼ŒNative å’Œ JavaScript é€šè¿‡ä¸‰ç§æ–¹å¼è¿›è¡Œé€šè®¯ï¼Œåˆ†åˆ«æ˜¯ Bridgeã€Turbo å’Œ Fabricï¼Œä¸šåŠ¡ä»£ç ä¸­çš„å†å²ä»£ç ä¾æ—§èµ° Bridge è¿›è¡Œé€šè®¯ï¼Œæ–°ä»£ç æ–°é¡¹ç›®èµ° Turboã€Fabric è¿›è¡Œé€šä¿¡ã€‚</p><p>ä¸Šè¿°æ¨¡å‹è‚¯å®šä¸æ˜¯æœ€ä¼˜è§£ï¼Œè€Œæ˜¯ä¸€ä¸ªè¿‡æ¸¡æ–¹æ¡ˆã€‚</p><p>æˆ–è®¸å®˜æ–¹ä¼šåœ¨æ–°æ¶æ„ç¨³å®šåï¼Œå°†æ˜¯å¦ä½¿ç”¨ Bridge è¿›è¡Œå…¼å®¹çš„å¼€å…³æš´éœ²ç»™å¼€å‘è€…ï¼Œç”±å¼€å‘è€…è¿›è¡Œé€‰æ‹©ï¼Œæ˜¯è¦çº¯æ–°æ¶æ„çš„è¶…é«˜æ€§èƒ½ï¼Œè¿˜æ˜¯è¦æ–°æ—§æ¶æ„æ··åˆçš„æ€§èƒ½æå‡+å…¼å®¹æ€§å¼ºã€‚</p><h2>æ€»ç»“</h2><p>ä»Šå¤©ï¼Œæˆ‘ä»¬é€šè¿‡â€œè¯»æ–‡ç« â€ã€â€œæ‰¾çº¿å¤´â€å’Œâ€œé¸Ÿç°å›¾â€ä¸‰æ­¥ï¼Œå¼„æ¸…æ¥šäº†æ–°æ¶æ„çš„ç°çŠ¶ã€‚</p><p>é¦–å…ˆï¼Œåœ¨å‡ åƒä¸ªæ–‡ä»¶ä¸­ï¼Œå¿«é€Ÿè¯»æ‡‚æºç æ˜¯æœ‰æ–¹æ³•çš„ã€‚æ‰¾åˆ°äº† Native ä¸ JavaScript è¿æ¥ç‚¹ï¼Œå°±æ‰¾åˆ°äº†è¯»æºç çš„çªç ´å£ï¼Œè¿™ä¸‰ä¸ªå…³é”®çš„è¿æ¥ç‚¹åˆ†åˆ«æ˜¯ nativeFlushQueueImmediateã€__turboModuleProxy å’Œ nativeFabricUIManagerã€‚</p><p>é€šè¿‡å¯¹æºç çš„é˜…è¯»ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šï¼Œç›®å‰æ–°æ¶æ„ä¸­ Bridgeã€Turbo å’Œ Fabric ä¸‰ç§é€šè®¯æ–¹å¼æ˜¯åŒæ—¶å­˜åœ¨çš„ã€‚å•ä»æ€§èƒ½è€ƒé‡ï¼Œåˆå§‹åŒ– Bridge è‚¯å®šæ‹–æ…¢äº†ç¨‹åºçš„å¯åŠ¨è€—æ—¶ï¼Œä½†ä»å‡çº§æˆæœ¬è§’åº¦å‡ºå‘ï¼Œä¸ä¸€åˆ€åˆ‡åœ°æ”¾å¼ƒæ‰€æœ‰å†å²ä»£ç ï¼Œæ‰ä¼šè®©ç¤¾åŒºæ›´æœ‰æ„æ„¿å‡çº§æ–°æ¶æ„ã€‚</p><h3>æ€è€ƒé¢˜</h3><p>ä½ æ˜¯å¦æœ‰è·‘åœ¨çº¿ä¸Šçš„ä½¿ç”¨è€æ¶æ„çš„ React Native é¡¹ç›®ï¼Ÿä½ å‡çº§è¿™äº›é¡¹ç›®æ—¶æœ€å…³é”®çš„ 3 ä¸ªè€ƒé‡ç‚¹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>æ¬¢è¿ç»™æˆ‘ç•™è¨€ï¼Œå’±ä»¬ä¸‹ä¸€è®²è§ã€‚</p>","neighbors":{"left":{"article_title":"28ï½œè¿½æœ¬æº¯æºï¼šä»ç¬¬ä¸€ç‰ˆReact Nativeå¼€å§‹å­¦ä¼šè¯»æ‡‚æºç ","id":564357},"right":{"article_title":"30ï½œJavaScriptå¼•æ“ï¼šåŒå‘é€šè®¯åº•å±‚åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ","id":599424}},"comments":[{"had_liked":false,"id":368329,"user_name":"æ‹­å¿ƒ","can_delete":false,"product_type":"c1","uid":1024819,"ip_address":"ä¸Šæµ·","ucode":"66BDB8959A4C59","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a3/33/8680446c.jpg","comment_is_top":false,"comment_ctime":1676206643,"is_pvip":false,"replies":[{"id":134156,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1088541,"ctime":1676264052,"ip_address":"åŒ—äº¬","comment_id":368329,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100110101,"comment_content":"å‡çº§è€æ¶æ„é¡¹ç›®æ—¶æœ€å…³é”®çš„ 3 ä¸ªè€ƒé‡ç‚¹ï¼š\n1. æ˜¯å¦æœ‰è¶³å¤Ÿçš„æ€§èƒ½æå‡\n2. æ˜¯å¦å¤Ÿç¨³å®š\n3. å®¢æˆ·ç«¯å’Œä¸šåŠ¡æ–¹çš„ä¿®æ”¹æˆæœ¬","like_count":1,"discussions":[{"author":{"id":1088541,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9c/1d/f0f10198.jpg","nickname":"è’‹å®ä¼Ÿ","note":"","ucode":"02226CABD5ECE7","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":603655,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1676264052,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":395003,"user_name":"é²¸é±¼","can_delete":false,"product_type":"c1","uid":1052643,"ip_address":"åŒ—äº¬","ucode":"71437C1C601040","user_header":"https://static001.geekbang.org/account/avatar/00/10/0f/e3/c49aa508.jpg","comment_is_top":false,"comment_ctime":1729064328,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100110101,"comment_content":"Fabricçœ‹èµ·æ¥å¯ä»¥ä½œä¸ºturboçš„ä¸€éƒ¨åˆ†ã€‚turboæ˜¯æä¾›äº†ä¸€ä¸ªgetModuleæ–¹æ³•ï¼Œè·å–æŒ‡å®šçš„æ¨¡å—å¯¹è±¡ï¼Œä¹‹åå¯ä»¥ç›´æ¥è°ƒç”¨æ¨¡å—å¯¹è±¡çš„æ–¹æ³•ã€‚Fabricåˆ™æ˜¯ç›´æ¥æ³¨å…¥äº†ä¸€ä¸ªæ¨¡å—å¯¹è±¡ï¼ŒæŒ‰ç†è¯´ä¹Ÿå¯ä»¥é€šè¿‡turboæ¥æä¾›ï¼Œæ˜¯å› ä¸ºUIç»„ä»¶æ¯”è¾ƒç‰¹æ®Šæ‰€ä»¥å•ç‹¬æ³¨å…¥äº†å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":368328,"user_name":"æ‹­å¿ƒ","can_delete":false,"product_type":"c1","uid":1024819,"ip_address":"ä¸Šæµ·","ucode":"66BDB8959A4C59","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a3/33/8680446c.jpg","comment_is_top":false,"comment_ctime":1676206595,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100110101,"comment_content":"å‡çº§è€æ¶æ„ RN é¡¹ç›®æ—¶æœ€å…³é”®çš„ 3 ä¸ªè€ƒé‡ç‚¹ï¼š","like_count":0}]}