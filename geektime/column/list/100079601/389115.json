{"id":389115,"title":"ç‰¹åˆ«æ”¾é€ | ç»™ä½ ä¸€ä»½Goé¡¹ç›®ä¸­æœ€å¸¸ç”¨çš„Makefileæ ¸å¿ƒè¯­æ³•","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å­”ä»¤é£ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬æ›´æ–°ä¸€æœŸç‰¹åˆ«æ”¾é€ä½œä¸ºâ€œåŠ é¤â€ï¼Œå¸Œæœ›æ—¥å¸¸å‚¬æ›´çš„æœ‹å‹ä»¬é£Ÿç”¨æ„‰å¿«ã€‚</p><p>åœ¨ç¬¬ <a href=\"https://time.geekbang.org/column/article/388920\"><strong>14è®²</strong></a>  é‡Œ<strong>ï¼Œ</strong>æˆ‘å¼ºè°ƒäº†ç†Ÿç»ƒæŒæ¡Makefileè¯­æ³•çš„é‡è¦æ€§ï¼Œè¿˜æ¨èä½ å»å­¦ä¹ é™ˆçš“è€å¸ˆç¼–å†™çš„<a href=\"https://github.com/seisman/how-to-write-makefile\">ã€Šè·Ÿæˆ‘ä¸€èµ·å†™ Makefileã€‹ (PDF é‡åˆ¶ç‰ˆ)</a>ã€‚ä¹Ÿè®¸ä½ å·²ç»ç‚¹å¼€äº†é“¾æ¥ï¼Œçœ‹åˆ°é‚£ä¹ˆå¤šMakefileè¯­æ³•ï¼Œæ˜¯ä¸æ˜¯æœ‰ç‚¹è¢«â€œåŠé€€â€çš„æ„Ÿè§‰ï¼Ÿ</p><p>å…¶å®åœ¨æˆ‘çœ‹æ¥ï¼Œè™½ç„¶Makefileæœ‰å¾ˆå¤šè¯­æ³•ï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„è¯­æ³•éƒ½éœ€è¦ä½ ç†Ÿç»ƒæŒæ¡ï¼Œæœ‰äº›è¯­æ³•åœ¨Goé¡¹ç›®ä¸­æ˜¯å¾ˆå°‘ç”¨åˆ°çš„ã€‚è¦ç¼–å†™ä¸€ä¸ªé«˜è´¨é‡çš„Makefileï¼Œé¦–å…ˆåº”è¯¥æŒæ¡ä¸€äº›æ ¸å¿ƒçš„ã€æœ€å¸¸ç”¨çš„è¯­æ³•çŸ¥è¯†ã€‚è¿™ä¸€è®²æˆ‘å°±æ¥å…·ä½“ä»‹ç»ä¸‹Goé¡¹ç›®ä¸­å¸¸ç”¨çš„Makefileè¯­æ³•å’Œè§„åˆ™ï¼Œå¸®åŠ©ä½ å¿«é€Ÿæ‰“å¥½æœ€é‡è¦çš„åŸºç¡€ã€‚</p><p>Makefileæ–‡ä»¶ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯Makefileè§„åˆ™ã€Makefileè¯­æ³•å’ŒMakefileå‘½ä»¤ï¼ˆè¿™äº›å‘½ä»¤å¯ä»¥æ˜¯Linuxå‘½ä»¤ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯æ‰§è¡Œçš„è„šæœ¬æ–‡ä»¶ï¼‰ã€‚åœ¨è¿™ä¸€è®²é‡Œï¼Œæˆ‘ä¼šä»‹ç»ä¸‹Makefileè§„åˆ™å’ŒMakefileè¯­æ³•é‡Œçš„ä¸€äº›æ ¸å¿ƒè¯­æ³•çŸ¥è¯†ã€‚åœ¨ä»‹ç»è¿™äº›è¯­æ³•çŸ¥è¯†ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹å¦‚ä½•ä½¿ç”¨Makefileè„šæœ¬ã€‚</p><h2>Makefileçš„ä½¿ç”¨æ–¹æ³•</h2><p>åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯å…ˆç¼–å†™ä¸€ä¸ªMakefileæ–‡ä»¶ï¼ŒæŒ‡å®šæ•´ä¸ªé¡¹ç›®çš„ç¼–è¯‘è§„åˆ™ï¼Œç„¶åé€šè¿‡Linux makeå‘½ä»¤æ¥è§£æè¯¥Makefileæ–‡ä»¶ï¼Œå®ç°é¡¹ç›®ç¼–è¯‘ã€ç®¡ç†çš„è‡ªåŠ¨åŒ–ã€‚</p><!-- [[[read_end]]] --><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œmakeå‘½ä»¤ä¼šåœ¨å½“å‰ç›®å½•ä¸‹ï¼ŒæŒ‰ç…§GNUmakefileã€makefileã€Makefileæ–‡ä»¶çš„é¡ºåºæŸ¥æ‰¾Makefileæ–‡ä»¶ï¼Œä¸€æ—¦æ‰¾åˆ°ï¼Œå°±å¼€å§‹è¯»å–è¿™ä¸ªæ–‡ä»¶å¹¶æ‰§è¡Œã€‚</p><p>å¤§å¤šæ•°çš„makeéƒ½æ”¯æŒâ€œmakefileâ€å’Œâ€œMakefileâ€è¿™ä¸¤ç§æ–‡ä»¶åï¼Œä½†<strong>æˆ‘å»ºè®®ä½¿ç”¨â€œMakefileâ€</strong>ã€‚å› ä¸ºè¿™ä¸ªæ–‡ä»¶åç¬¬ä¸€ä¸ªå­—ç¬¦å¤§å†™ï¼Œä¼šå¾ˆæ˜æ˜¾ï¼Œå®¹æ˜“è¾¨åˆ«ã€‚makeä¹Ÿæ”¯æŒ <code>-f</code> å’Œ <code>--file</code> å‚æ•°æ¥æŒ‡å®šå…¶ä»–æ–‡ä»¶åï¼Œæ¯”å¦‚ <code>make -f golang.mk</code> æˆ–è€… <code>make --file golang.mk</code> ã€‚</p><h2>Makefileè§„åˆ™ä»‹ç»</h2><p>å­¦ä¹ Makefileï¼Œæœ€æ ¸å¿ƒçš„å°±æ˜¯å­¦ä¹ Makefileçš„è§„åˆ™ã€‚è§„åˆ™æ˜¯Makefileä¸­çš„é‡è¦æ¦‚å¿µï¼Œå®ƒä¸€èˆ¬ç”±ç›®æ ‡ã€ä¾èµ–å’Œå‘½ä»¤ç»„æˆï¼Œç”¨æ¥æŒ‡å®šæºæ–‡ä»¶ç¼–è¯‘çš„å…ˆåé¡ºåºã€‚Makefileä¹‹æ‰€ä»¥å—æ¬¢è¿ï¼Œæ ¸å¿ƒåŸå› å°±æ˜¯Makefileè§„åˆ™ï¼Œå› ä¸ºMakefileè§„åˆ™å¯ä»¥è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦é‡æ–°ç¼–è¯‘æŸä¸ªç›®æ ‡ï¼Œä»è€Œç¡®ä¿ç›®æ ‡ä»…åœ¨éœ€è¦æ—¶ç¼–è¯‘ã€‚</p><p>è¿™ä¸€è®²æˆ‘ä»¬ä¸»è¦æ¥çœ‹Makefileè§„åˆ™é‡Œçš„è§„åˆ™è¯­æ³•ã€ä¼ªç›®æ ‡å’Œorder-onlyä¾èµ–ã€‚</p><h3>è§„åˆ™è¯­æ³•</h3><p>Makefileçš„è§„åˆ™è¯­æ³•ï¼Œä¸»è¦åŒ…æ‹¬targetã€prerequisiteså’Œcommandï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code>target ...: prerequisites ...\n    command\n\t  ...\n\t  ...\n</code></pre><p><strong>targetï¼Œ</strong>å¯ä»¥æ˜¯ä¸€ä¸ªobject fileï¼ˆç›®æ ‡æ–‡ä»¶ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ‰§è¡Œæ–‡ä»¶ï¼Œè¿˜å¯ä»¥æ˜¯ä¸€ä¸ªæ ‡ç­¾ï¼ˆlabelï¼‰ã€‚targetå¯ä½¿ç”¨é€šé…ç¬¦ï¼Œå½“æœ‰å¤šä¸ªç›®æ ‡æ—¶ï¼Œç›®æ ‡ä¹‹é—´ç”¨ç©ºæ ¼åˆ†éš”ã€‚</p><p><strong>prerequisitesï¼Œ</strong>ä»£è¡¨ç”Ÿæˆè¯¥targetæ‰€éœ€è¦çš„ä¾èµ–é¡¹ã€‚å½“æœ‰å¤šä¸ªä¾èµ–é¡¹æ—¶ï¼Œä¾èµ–é¡¹ä¹‹é—´ç”¨ç©ºæ ¼åˆ†éš”ã€‚</p><p><strong>command</strong>ï¼Œä»£è¡¨è¯¥targetè¦æ‰§è¡Œçš„å‘½ä»¤ï¼ˆå¯ä»¥æ˜¯ä»»æ„çš„shellå‘½ä»¤ï¼‰ã€‚</p><ul>\n<li>åœ¨æ‰§è¡Œcommandä¹‹å‰ï¼Œé»˜è®¤ä¼šå…ˆæ‰“å°å‡ºè¯¥å‘½ä»¤ï¼Œç„¶åå†è¾“å‡ºå‘½ä»¤çš„ç»“æœï¼›å¦‚æœä¸æƒ³æ‰“å°å‡ºå‘½ä»¤ï¼Œå¯åœ¨å„ä¸ªcommandå‰åŠ ä¸Š<code>@</code>ã€‚</li>\n<li>commandå¯ä»¥ä¸ºå¤šæ¡ï¼Œä¹Ÿå¯ä»¥åˆ†è¡Œå†™ï¼Œä½†æ¯è¡Œéƒ½è¦ä»¥tabé”®å¼€å§‹ã€‚å¦å¤–ï¼Œå¦‚æœåä¸€æ¡å‘½ä»¤ä¾èµ–å‰ä¸€æ¡å‘½ä»¤ï¼Œåˆ™è¿™ä¸¤æ¡å‘½ä»¤éœ€è¦å†™åœ¨åŒä¸€è¡Œï¼Œå¹¶ç”¨åˆ†å·è¿›è¡Œåˆ†éš”ã€‚</li>\n<li>å¦‚æœè¦å¿½ç•¥å‘½ä»¤çš„å‡ºé”™ï¼Œéœ€è¦åœ¨å„ä¸ªcommandä¹‹å‰åŠ ä¸Šå‡å·<code>-</code>ã€‚</li>\n</ul><p><strong>åªè¦targetsä¸å­˜åœ¨ï¼Œæˆ–prerequisitesä¸­æœ‰ä¸€ä¸ªä»¥ä¸Šçš„æ–‡ä»¶æ¯”targetsæ–‡ä»¶æ–°ï¼Œé‚£ä¹ˆcommandæ‰€å®šä¹‰çš„å‘½ä»¤å°±ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œäº§ç”Ÿæˆ‘ä»¬éœ€è¦çš„æ–‡ä»¶ï¼Œæˆ–æ‰§è¡Œæˆ‘ä»¬æœŸæœ›çš„æ“ä½œã€‚</strong></p><p>æˆ‘ä»¬ç›´æ¥é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥ç†è§£ä¸‹Makefileçš„è§„åˆ™å§ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œå…ˆç¼–å†™ä¸€ä¸ªhello.cæ–‡ä»¶ã€‚</p><pre><code>#include &lt;stdio.h&gt;\nint main()\n{\n  printf(&quot;Hello World!\\n&quot;);\n  return 0;\n}\n</code></pre><p>ç¬¬äºŒæ­¥ï¼Œåœ¨å½“å‰ç›®å½•ä¸‹ï¼Œç¼–å†™Makefileæ–‡ä»¶ã€‚</p><pre><code>hello: hello.o\n\tgcc -o hello hello.o\n\nhello.o: hello.c\n\tgcc -c hello.c\n\nclean:\n\trm hello.o\n</code></pre><p>ç¬¬ä¸‰æ­¥ï¼Œæ‰§è¡Œmakeï¼Œäº§ç”Ÿå¯æ‰§è¡Œæ–‡ä»¶ã€‚</p><pre><code>$ make\ngcc -c hello.c\ngcc -o hello hello.o\n$ ls\nhello  hello.c  hello.o  Makefile\n</code></pre><p>ä¸Šé¢çš„ç¤ºä¾‹Makefileæ–‡ä»¶æœ‰ä¸¤ä¸ªtargetï¼Œåˆ†åˆ«æ˜¯helloå’Œhello.oï¼Œæ¯ä¸ªtargetéƒ½æŒ‡å®šäº†æ„å»ºcommandã€‚å½“æ‰§è¡Œmakeå‘½ä»¤æ—¶ï¼Œå‘ç°helloã€hello.oæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå°±ä¼šæ‰§è¡Œcommandå‘½ä»¤ç”Ÿæˆtargetã€‚</p><p>ç¬¬å››æ­¥ï¼Œä¸æ›´æ–°ä»»ä½•æ–‡ä»¶ï¼Œå†æ¬¡æ‰§è¡Œmakeã€‚</p><pre><code>$ make\nmake: 'hello' is up to date.\n</code></pre><p>å½“targetå­˜åœ¨ï¼Œå¹¶ä¸”prerequisiteséƒ½ä¸æ¯”targetæ–°æ—¶ï¼Œä¸ä¼šæ‰§è¡Œå¯¹åº”çš„commandã€‚</p><p>ç¬¬äº”æ­¥ï¼Œæ›´æ–°hello.cï¼Œå¹¶å†æ¬¡æ‰§è¡Œmakeã€‚</p><pre><code>$ touch hello.c\n$ make\ngcc -c hello.c\ngcc -o hello hello.o\n</code></pre><p>å½“targetå­˜åœ¨ï¼Œä½† prerequisites æ¯” target æ–°æ—¶ï¼Œä¼šé‡æ–°æ‰§è¡Œå¯¹åº”çš„commandã€‚</p><p>ç¬¬å…­æ­¥ï¼Œæ¸…ç†ç¼–è¯‘ä¸­é—´æ–‡ä»¶ã€‚</p><p>Makefileä¸€èˆ¬éƒ½ä¼šæœ‰ä¸€ä¸ªcleanä¼ªç›®æ ‡ï¼Œç”¨æ¥æ¸…ç†ç¼–è¯‘ä¸­é—´äº§ç‰©ï¼Œæˆ–è€…å¯¹æºç ç›®å½•åšä¸€äº›å®šåˆ¶åŒ–çš„æ¸…ç†ï¼š</p><pre><code>$ make clean\nrm hello.o\n</code></pre><p>æˆ‘ä»¬å¯ä»¥åœ¨è§„åˆ™ä¸­ä½¿ç”¨é€šé…ç¬¦ï¼Œmake æ”¯æŒä¸‰ä¸ªé€šé…ç¬¦ï¼š*ï¼Œ?å’Œ~ï¼Œä¾‹å¦‚ï¼š</p><pre><code>objects = *.o\nprint: *.c\n    rm *.c\n</code></pre><h3>ä¼ªç›®æ ‡</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä»‹ç»ä¸‹Makefileä¸­çš„ä¼ªç›®æ ‡ã€‚Makefileçš„ç®¡ç†èƒ½åŠ›åŸºæœ¬ä¸Šéƒ½æ˜¯é€šè¿‡ä¼ªç›®æ ‡æ¥å®ç°çš„ã€‚</p><p>åœ¨ä¸Šé¢çš„Makefileç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªcleanç›®æ ‡ï¼Œè¿™å…¶å®æ˜¯ä¸€ä¸ªä¼ªç›®æ ‡ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¸ä¼šä¸ºè¯¥ç›®æ ‡ç”Ÿæˆä»»ä½•æ–‡ä»¶ã€‚å› ä¸ºä¼ªç›®æ ‡ä¸æ˜¯æ–‡ä»¶ï¼Œmake æ— æ³•ç”Ÿæˆå®ƒçš„ä¾èµ–å…³ç³»ï¼Œä¹Ÿæ— æ³•å†³å®šæ˜¯å¦è¦æ‰§è¡Œå®ƒã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æ˜¾å¼åœ°æ ‡è¯†è¿™ä¸ªç›®æ ‡ä¸ºä¼ªç›®æ ‡ã€‚åœ¨Makefileä¸­å¯ä»¥ä½¿ç”¨<code>.PHONY</code>æ¥æ ‡è¯†ä¸€ä¸ªç›®æ ‡ä¸ºä¼ªç›®æ ‡ï¼š</p><pre><code>.PHONY: clean\nclean:\n    rm hello.o\n</code></pre><p>ä¼ªç›®æ ‡å¯ä»¥æœ‰ä¾èµ–æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºâ€œé»˜è®¤ç›®æ ‡â€ï¼Œä¾‹å¦‚ï¼š</p><pre><code>.PHONY: all\nall: lint test build\n</code></pre><p>å› ä¸ºä¼ªç›®æ ‡æ€»æ˜¯ä¼šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥å…¶ä¾èµ–æ€»æ˜¯ä¼šè¢«å†³è®®ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥è¾¾åˆ°<strong>åŒæ—¶æ‰§è¡Œæ‰€æœ‰ä¾èµ–é¡¹</strong>çš„ç›®çš„ã€‚</p><h3>order-onlyä¾èµ–</h3><p>åœ¨ä¸Šé¢ä»‹ç»çš„è§„åˆ™ä¸­ï¼Œåªè¦prerequisitesä¸­æœ‰ä»»ä½•æ–‡ä»¶å‘ç”Ÿæ”¹å˜ï¼Œå°±ä¼šé‡æ–°æ„é€ targetã€‚ä½†æ˜¯æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›<strong>åªæœ‰å½“prerequisitesä¸­çš„éƒ¨åˆ†æ–‡ä»¶æ”¹å˜æ—¶ï¼Œæ‰é‡æ–°æ„é€ targetã€‚</strong>è¿™æ—¶ï¼Œä½ å¯ä»¥é€šè¿‡order-only prerequisiteså®ç°ã€‚</p><p>order-only prerequisitesçš„å½¢å¼å¦‚ä¸‹ï¼š</p><pre><code>targets : normal-prerequisites | order-only-prerequisites\n    command\n    ...\n    ...\n</code></pre><p>åœ¨ä¸Šé¢çš„è§„åˆ™ä¸­ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡æ„é€ targetsæ—¶ï¼Œæ‰ä¼šä½¿ç”¨order-only-prerequisitesã€‚åé¢å³ä½¿order-only-prerequisiteså‘ç”Ÿæ”¹å˜ï¼Œä¹Ÿä¸ä¼šé‡æ–°æ„é€ targetsã€‚</p><p>åªæœ‰normal-prerequisitesä¸­çš„æ–‡ä»¶å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰ä¼šé‡æ–°æ„é€ targetsã€‚è¿™é‡Œï¼Œç¬¦å·â€œ | â€åé¢çš„prerequisiteså°±æ˜¯order-only-prerequisitesã€‚</p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±ä»‹ç»äº†Makefileçš„è§„åˆ™ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹Makefileä¸­çš„ä¸€äº›æ ¸å¿ƒè¯­æ³•çŸ¥è¯†ã€‚</p><h2>Makefileè¯­æ³•æ¦‚è§ˆ</h2><p>å› ä¸ºMakefileçš„è¯­æ³•æ¯”è¾ƒå¤šï¼Œè¿™ä¸€è®²åªä»‹ç»Makefileçš„æ ¸å¿ƒè¯­æ³•ï¼Œä»¥åŠ IAMé¡¹ç›®çš„Makefileç”¨åˆ°çš„è¯­æ³•ï¼ŒåŒ…æ‹¬å‘½ä»¤ã€å˜é‡ã€æ¡ä»¶è¯­å¥å’Œå‡½æ•°ã€‚å› ä¸ºMakefileæ²¡æœ‰å¤ªå¤šå¤æ‚çš„è¯­æ³•ï¼Œä½ æŒæ¡äº†è¿™äº›çŸ¥è¯†ç‚¹ä¹‹åï¼Œå†åœ¨å®è·µä¸­å¤šåŠ è¿ç”¨ï¼Œèä¼šè´¯é€šï¼Œå°±å¯ä»¥å†™å‡ºéå¸¸å¤æ‚ã€åŠŸèƒ½å¼ºå¤§çš„Makefileæ–‡ä»¶äº†ã€‚</p><h3>å‘½ä»¤</h3><p>Makefileæ”¯æŒLinuxå‘½ä»¤ï¼Œè°ƒç”¨æ–¹å¼è·Ÿåœ¨Linuxç³»ç»Ÿä¸‹è°ƒç”¨å‘½ä»¤çš„æ–¹å¼åŸºæœ¬ä¸€è‡´ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œmakeä¼šæŠŠæ­£åœ¨æ‰§è¡Œçš„å‘½ä»¤è¾“å‡ºåˆ°å½“å‰å±å¹•ä¸Šã€‚ä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨å‘½ä»¤å‰åŠ <code>@</code>ç¬¦å·çš„æ–¹å¼ï¼Œç¦æ­¢makeè¾“å‡ºå½“å‰æ­£åœ¨æ‰§è¡Œçš„å‘½ä»¤ã€‚</p><p>æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ã€‚ç°åœ¨æœ‰è¿™ä¹ˆä¸€ä¸ªMakefileï¼š</p><pre><code>.PHONY: test\ntest:\n    echo &quot;hello world&quot;\n</code></pre><p>æ‰§è¡Œmakeå‘½ä»¤ï¼š</p><pre><code>$ make test\necho &quot;hello world&quot;\nhello world\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œmakeè¾“å‡ºäº†æ‰§è¡Œçš„å‘½ä»¤ã€‚å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ä¸éœ€è¦è¿™æ ·çš„æç¤ºï¼Œå› ä¸ºæˆ‘ä»¬æ›´æƒ³çœ‹çš„æ˜¯å‘½ä»¤äº§ç”Ÿçš„æ—¥å¿—ï¼Œè€Œä¸æ˜¯æ‰§è¡Œçš„å‘½ä»¤ã€‚è¿™æ—¶å°±å¯ä»¥åœ¨å‘½ä»¤è¡Œå‰åŠ <code>@</code>ï¼Œç¦æ­¢makeè¾“å‡ºæ‰€æ‰§è¡Œçš„å‘½ä»¤ï¼š</p><pre><code>.PHONY: test\ntest:\n    @echo &quot;hello world&quot;\n</code></pre><p>å†æ¬¡æ‰§è¡Œmakeå‘½ä»¤ï¼š</p><pre><code>$ make test\nhello world\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œmakeåªæ˜¯æ‰§è¡Œäº†å‘½ä»¤ï¼Œè€Œæ²¡æœ‰æ‰“å°å‘½ä»¤æœ¬èº«ã€‚è¿™æ ·makeè¾“å‡ºå°±æ¸…æ™°äº†å¾ˆå¤šã€‚</p><p>è¿™é‡Œï¼Œ<strong>æˆ‘å»ºè®®åœ¨å‘½ä»¤å‰éƒ½åŠ </strong><code>@</code>ç¬¦å·ï¼Œç¦æ­¢æ‰“å°å‘½ä»¤æœ¬èº«ï¼Œä»¥ä¿è¯ä½ çš„Makefileè¾“å‡ºæ˜“äºé˜…è¯»çš„ã€æœ‰ç”¨çš„ä¿¡æ¯ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯æ¡å‘½ä»¤æ‰§è¡Œå®Œmakeå°±ä¼šæ£€æŸ¥å…¶è¿”å›ç ã€‚å¦‚æœè¿”å›æˆåŠŸï¼ˆè¿”å›ç ä¸º0ï¼‰ï¼Œmakeå°±æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ï¼›å¦‚æœè¿”å›å¤±è´¥ï¼ˆè¿”å›ç é0ï¼‰ï¼Œmakeå°±ä¼šç»ˆæ­¢å½“å‰å‘½ä»¤ã€‚å¾ˆå¤šæ—¶å€™ï¼Œå‘½ä»¤å‡ºé”™ï¼ˆæ¯”å¦‚åˆ é™¤äº†ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶ï¼‰æ—¶ï¼Œæˆ‘ä»¬å¹¶ä¸æƒ³ç»ˆæ­¢ï¼Œè¿™æ—¶å°±å¯ä»¥åœ¨å‘½ä»¤è¡Œå‰åŠ  <code>-</code> ç¬¦å·ï¼Œæ¥è®©makeå¿½ç•¥å‘½ä»¤çš„å‡ºé”™ï¼Œä»¥ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡å‘½ä»¤ï¼Œæ¯”å¦‚ï¼š</p><pre><code>clean:\n    -rm hello.o\n</code></pre><h3>å˜é‡</h3><p>å˜é‡ï¼Œå¯èƒ½æ˜¯Makefileä¸­ä½¿ç”¨æœ€é¢‘ç¹çš„è¯­æ³•äº†ï¼ŒMakefileæ”¯æŒå˜é‡èµ‹å€¼ã€å¤šè¡Œå˜é‡å’Œç¯å¢ƒå˜é‡ã€‚å¦å¤–ï¼ŒMakefileè¿˜å†…ç½®äº†ä¸€äº›ç‰¹æ®Šå˜é‡å’Œè‡ªåŠ¨åŒ–å˜é‡ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹æœ€åŸºæœ¬çš„<strong>å˜é‡èµ‹å€¼</strong>åŠŸèƒ½ã€‚</p><p>Makefileä¹Ÿå¯ä»¥åƒå…¶ä»–è¯­è¨€ä¸€æ ·æ”¯æŒå˜é‡ã€‚åœ¨ä½¿ç”¨å˜é‡æ—¶ï¼Œä¼šåƒshellå˜é‡ä¸€æ ·åŸåœ°å±•å¼€ï¼Œç„¶åå†æ‰§è¡Œæ›¿æ¢åçš„å†…å®¹ã€‚</p><p>Makefileå¯ä»¥é€šè¿‡å˜é‡å£°æ˜æ¥å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œå˜é‡åœ¨å£°æ˜æ—¶éœ€è¦èµ‹äºˆä¸€ä¸ªåˆå€¼ï¼Œæ¯”å¦‚<code>ROOT_PACKAGE=github.com/marmotedu/iam</code>ã€‚</p><p>å¼•ç”¨å˜é‡æ—¶å¯ä»¥é€šè¿‡<code>$()</code>æˆ–è€…<code>${}</code>æ–¹å¼å¼•ç”¨ã€‚æˆ‘çš„å»ºè®®æ˜¯ï¼Œç”¨<code>$()</code>æ–¹å¼å¼•ç”¨å˜é‡ï¼Œä¾‹å¦‚<code>$(ROOT_PACKAGE)</code>ï¼Œä¹Ÿå»ºè®®æ•´ä¸ªmakefileçš„å˜é‡å¼•ç”¨æ–¹å¼ä¿æŒä¸€è‡´ã€‚</p><p>å˜é‡ä¼šåƒbashå˜é‡ä¸€æ ·ï¼Œåœ¨ä½¿ç”¨å®ƒçš„åœ°æ–¹å±•å¼€ã€‚æ¯”å¦‚ï¼š</p><pre><code>GO=go\nbuild:\n    $(GO) build -v .\n</code></pre><p>å±•å¼€åä¸ºï¼š</p><pre><code>GO=go\nbuild:\n    go build -v .\n</code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ç»™ä½ ä»‹ç»ä¸‹Makefileä¸­çš„4ç§å˜é‡èµ‹å€¼æ–¹æ³•ã€‚</p><ol>\n<li><code>=</code> æœ€åŸºæœ¬çš„èµ‹å€¼æ–¹æ³•ã€‚</li>\n</ol><p>ä¾‹å¦‚ï¼š</p><pre><code>BASE_IMAGE = alpine:3.10\n</code></pre><p>ä½¿ç”¨ <code>=</code> è¿›è¡Œèµ‹å€¼æ—¶ï¼Œè¦æ³¨æ„ä¸‹é¢è¿™æ ·çš„æƒ…å†µï¼š</p><pre><code>A = a\nB = $(A) b\nA = c\n</code></pre><p>Bæœ€åçš„å€¼ä¸º c bï¼Œè€Œä¸æ˜¯a bã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ç”¨å˜é‡ç»™å˜é‡èµ‹å€¼æ—¶ï¼Œå³è¾¹å˜é‡çš„å–å€¼ï¼Œå–çš„æ˜¯æœ€ç»ˆçš„å˜é‡å€¼ã€‚</p><ol start=\"2\">\n<li><code>:=</code>ç›´æ¥èµ‹å€¼ï¼Œèµ‹äºˆå½“å‰ä½ç½®çš„å€¼ã€‚</li>\n</ol><p>ä¾‹å¦‚ï¼š</p><pre><code>A = a\nB := $(A) b\nA = c\n</code></pre><p>Bæœ€åçš„å€¼ä¸º a bã€‚é€šè¿‡ <code>:=</code> çš„èµ‹å€¼æ–¹å¼ï¼Œå¯ä»¥é¿å… <code>=</code> èµ‹å€¼å¸¦æ¥çš„æ½œåœ¨çš„ä¸ä¸€è‡´ã€‚</p><ol start=\"3\">\n<li><code>?=</code> è¡¨ç¤ºå¦‚æœè¯¥å˜é‡æ²¡æœ‰è¢«èµ‹å€¼ï¼Œåˆ™èµ‹äºˆç­‰å·åçš„å€¼ã€‚</li>\n</ol><p>ä¾‹å¦‚ï¼š</p><pre><code>PLATFORMS ?= linux_amd64 linux_arm64\n</code></pre><ol start=\"4\">\n<li><code>+=</code>è¡¨ç¤ºå°†ç­‰å·åé¢çš„å€¼æ·»åŠ åˆ°å‰é¢çš„å˜é‡ä¸Šã€‚</li>\n</ol><p>ä¾‹å¦‚ï¼š</p><pre><code>MAKEFLAGS += --no-print-directory\n</code></pre><p>Makefileè¿˜æ”¯æŒ<strong>å¤šè¡Œå˜é‡</strong>ã€‚å¯ä»¥é€šè¿‡defineå…³é”®å­—è®¾ç½®å¤šè¡Œå˜é‡ï¼Œå˜é‡ä¸­å…è®¸æ¢è¡Œã€‚å®šä¹‰æ–¹å¼ä¸ºï¼š</p><pre><code>define å˜é‡å\nå˜é‡å†…å®¹\n...\nendef\n</code></pre><p>å˜é‡çš„å†…å®¹å¯ä»¥åŒ…å«å‡½æ•°ã€å‘½ä»¤ã€æ–‡å­—æˆ–æ˜¯å…¶ä»–å˜é‡ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªUSAGE_OPTIONSå˜é‡ï¼š</p><pre><code>define USAGE_OPTIONS\n\nOptions:\n  DEBUG        Whether to generate debug symbols. Default is 0.\n  BINS         The binaries to build. Default is all of cmd.\n  ...\n  V            Set to 1 enable verbose build. Default is 0.\nendef\n</code></pre><p>Makefileè¿˜æ”¯æŒ<strong>ç¯å¢ƒå˜é‡</strong>ã€‚åœ¨Makefileä¸­ï¼Œæœ‰ä¸¤ç§ç¯å¢ƒå˜é‡ï¼Œåˆ†åˆ«æ˜¯Makefileé¢„å®šä¹‰çš„ç¯å¢ƒå˜é‡å’Œè‡ªå®šä¹‰çš„ç¯å¢ƒå˜é‡ã€‚</p><p>å…¶ä¸­ï¼Œè‡ªå®šä¹‰çš„ç¯å¢ƒå˜é‡å¯ä»¥è¦†ç›–Makefileé¢„å®šä¹‰çš„ç¯å¢ƒå˜é‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒMakefileä¸­å®šä¹‰çš„ç¯å¢ƒå˜é‡åªåœ¨å½“å‰Makefileæœ‰æ•ˆï¼Œå¦‚æœæƒ³å‘ä¸‹å±‚ä¼ é€’ï¼ˆMakefileä¸­è°ƒç”¨å¦ä¸€ä¸ªMakefileï¼‰ï¼Œéœ€è¦ä½¿ç”¨exportå…³é”®å­—æ¥å£°æ˜ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­å£°æ˜äº†ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œå¹¶å¯ä»¥åœ¨ä¸‹å±‚Makefileä¸­ä½¿ç”¨ï¼š</p><pre><code>...\nexport USAGE_OPTIONS\n...\n</code></pre><p>æ­¤å¤–ï¼ŒMakefileè¿˜æ”¯æŒä¸¤ç§å†…ç½®çš„å˜é‡ï¼šç‰¹æ®Šå˜é‡å’Œè‡ªåŠ¨åŒ–å˜é‡ã€‚</p><p><strong>ç‰¹æ®Šå˜é‡</strong>æ˜¯makeæå‰å®šä¹‰å¥½çš„ï¼Œå¯ä»¥åœ¨makefileä¸­ç›´æ¥å¼•ç”¨ã€‚ç‰¹æ®Šå˜é‡åˆ—è¡¨å¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/c1/1d/c1cba21aaed2eb0117yyb0470byy641d.png?wh=1052x978\" alt=\"\"></p><p>Makefileè¿˜æ”¯æŒ<strong>è‡ªåŠ¨åŒ–å˜é‡</strong>ã€‚è‡ªåŠ¨åŒ–å˜é‡å¯ä»¥æé«˜æˆ‘ä»¬ç¼–å†™Makefileçš„æ•ˆç‡å’Œè´¨é‡ã€‚</p><p>åœ¨Makefileçš„æ¨¡å¼è§„åˆ™ä¸­ï¼Œç›®æ ‡å’Œä¾èµ–æ–‡ä»¶éƒ½æ˜¯ä¸€ç³»åˆ—çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•ä¹¦å†™ä¸€ä¸ªå‘½ä»¤ï¼Œæ¥å®Œæˆä»ä¸åŒçš„ä¾èµ–æ–‡ä»¶ç”Ÿæˆç›¸å¯¹åº”çš„ç›®æ ‡å‘¢ï¼Ÿ</p><p>è¿™æ—¶å°±å¯ä»¥ç”¨åˆ°è‡ªåŠ¨åŒ–å˜é‡ã€‚æ‰€è°“è‡ªåŠ¨åŒ–å˜é‡ï¼Œå°±æ˜¯è¿™ç§å˜é‡ä¼šæŠŠæ¨¡å¼ä¸­æ‰€å®šä¹‰çš„ä¸€ç³»åˆ—çš„æ–‡ä»¶è‡ªåŠ¨åœ°æŒ¨ä¸ªå–å‡ºï¼Œä¸€ç›´åˆ°æ‰€æœ‰ç¬¦åˆæ¨¡å¼çš„æ–‡ä»¶éƒ½å–å®Œä¸ºæ­¢ã€‚è¿™ç§è‡ªåŠ¨åŒ–å˜é‡åªåº”å‡ºç°åœ¨è§„åˆ™çš„å‘½ä»¤ä¸­ã€‚Makefileä¸­æ”¯æŒçš„è‡ªåŠ¨åŒ–å˜é‡è§ä¸‹è¡¨ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/13/12/13ec33008eaff973c0dd854a795ff712.png?wh=1263x1303\" alt=\"\"></p><p>ä¸Šé¢è¿™äº›è‡ªåŠ¨åŒ–å˜é‡ä¸­ï¼Œ<code>$*</code>æ˜¯ç”¨å¾—æœ€å¤šçš„ã€‚<code>$*</code> å¯¹äºæ„é€ æœ‰å…³è”çš„æ–‡ä»¶åæ˜¯æ¯”è¾ƒæœ‰æ•ˆçš„ã€‚å¦‚æœç›®æ ‡ä¸­æ²¡æœ‰æ¨¡å¼çš„å®šä¹‰ï¼Œé‚£ä¹ˆ <code>$*</code> ä¹Ÿå°±ä¸èƒ½è¢«æ¨å¯¼å‡ºã€‚ä½†æ˜¯ï¼Œå¦‚æœç›®æ ‡æ–‡ä»¶çš„åç¼€æ˜¯makeæ‰€è¯†åˆ«çš„ï¼Œé‚£ä¹ˆ <code>$*</code> å°±æ˜¯é™¤äº†åç¼€çš„é‚£ä¸€éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼šå¦‚æœç›®æ ‡æ˜¯foo.c ï¼Œå› ä¸º.cæ˜¯makeæ‰€èƒ½è¯†åˆ«çš„åç¼€åï¼Œæ‰€ä»¥ <code>$*</code> çš„å€¼å°±æ˜¯fooã€‚</p><h3>æ¡ä»¶è¯­å¥</h3><p>Makefileä¹Ÿæ”¯æŒæ¡ä»¶è¯­å¥ã€‚è¿™é‡Œå…ˆçœ‹ä¸€ä¸ªç¤ºä¾‹ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­åˆ¤æ–­å˜é‡<code>ROOT_PACKAGE</code>æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™è¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼Œä¸ä¸ºç©ºåˆ™æ‰“å°å˜é‡å€¼ï¼š</p><pre><code>ifeq ($(ROOT_PACKAGE),)\n$(error the variable ROOT_PACKAGE must be set prior to including golang.mk)\nelse\n$(info the value of ROOT_PACKAGE is $(ROOT_PACKAGE))\nendif\n</code></pre><p>æ¡ä»¶è¯­å¥çš„è¯­æ³•ä¸ºï¼š</p><pre><code># if ...\n&lt;conditional-directive&gt;\n&lt;text-if-true&gt;\nendif\n# if ... else ...\n&lt;conditional-directive&gt;\n&lt;text-if-true&gt;\nelse\n&lt;text-if-false&gt;\nendif\n</code></pre><p>ä¾‹å¦‚ï¼Œåˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼š</p><pre><code>ifeq æ¡ä»¶è¡¨è¾¾å¼\n...\nelse\n...\nendif\n</code></pre><ul>\n<li>ifeqè¡¨ç¤ºæ¡ä»¶è¯­å¥çš„å¼€å§‹ï¼Œå¹¶æŒ‡å®šä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼ã€‚è¡¨è¾¾å¼åŒ…å«ä¸¤ä¸ªå‚æ•°ï¼Œå‚æ•°ä¹‹é—´ç”¨é€—å·åˆ†éš”ï¼Œå¹¶ä¸”è¡¨è¾¾å¼ç”¨åœ†æ‹¬å·æ‹¬èµ·æ¥ã€‚</li>\n<li>elseè¡¨ç¤ºæ¡ä»¶è¡¨è¾¾å¼ä¸ºå‡çš„æƒ…å†µã€‚</li>\n<li>endifè¡¨ç¤ºä¸€ä¸ªæ¡ä»¶è¯­å¥çš„ç»“æŸï¼Œä»»ä½•ä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼éƒ½åº”è¯¥ä»¥endifç»“æŸã€‚</li>\n<li><conditional-directive>è¡¨ç¤ºæ¡ä»¶å…³é”®å­—ï¼Œæœ‰4ä¸ªå…³é”®å­—ï¼šifeqã€ifneqã€ifdefã€ifndefã€‚</conditional-directive></li>\n</ul><p>ä¸ºäº†åŠ æ·±ä½ çš„ç†è§£ï¼Œæˆ‘ä»¬åˆ†åˆ«æ¥çœ‹ä¸‹è¿™4ä¸ªå…³é”®å­—çš„ä¾‹å­ã€‚</p><ol>\n<li>ifeqï¼šæ¡ä»¶åˆ¤æ–­ï¼Œåˆ¤æ–­æ˜¯å¦ç›¸ç­‰ã€‚</li>\n</ol><p>ä¾‹å¦‚ï¼š</p><pre><code>ifeq (&lt;arg1&gt;, &lt;arg2&gt;)\nifeq '&lt;arg1&gt;' '&lt;arg2&gt;'\nifeq &quot;&lt;arg1&gt;&quot; &quot;&lt;arg2&gt;&quot;\nifeq &quot;&lt;arg1&gt;&quot; '&lt;arg2&gt;'\nifeq '&lt;arg1&gt;' &quot;&lt;arg2&gt;&quot;\n</code></pre><p>æ¯”è¾ƒarg1å’Œarg2çš„å€¼æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒåˆ™ä¸ºçœŸã€‚ä¹Ÿå¯ä»¥ç”¨makeå‡½æ•°/å˜é‡æ›¿ä»£arg1æˆ–arg2ï¼Œä¾‹å¦‚ <code>ifeq ($(origin ROOT_DIR),undefined)</code> æˆ– <code>ifeq ($(ROOT_PACKAGE),)</code> ã€‚originå‡½æ•°ä¼šåœ¨ä¹‹åä¸“é—¨è®²å‡½æ•°çš„ä¸€è®²ä¸­ä»‹ç»åˆ°ã€‚</p><ol start=\"2\">\n<li>ifneqï¼šæ¡ä»¶åˆ¤æ–­ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ç›¸ç­‰ã€‚</li>\n</ol><pre><code>ifneq (&lt;arg1&gt;, &lt;arg2&gt;)\nifneq '&lt;arg1&gt;' '&lt;arg2&gt;'\nifneq &quot;&lt;arg1&gt;&quot; &quot;&lt;arg2&gt;&quot;\nifneq &quot;&lt;arg1&gt;&quot; '&lt;arg2&gt;'\nifneq '&lt;arg1&gt;' &quot;&lt;arg2&gt;&quot;\n</code></pre><p>æ¯”è¾ƒarg1å’Œarg2çš„å€¼æ˜¯å¦ä¸åŒï¼Œå¦‚æœä¸åŒåˆ™ä¸ºçœŸã€‚</p><ol start=\"3\">\n<li>ifdefï¼šæ¡ä»¶åˆ¤æ–­ï¼Œåˆ¤æ–­å˜é‡æ˜¯å¦å·²å®šä¹‰ã€‚</li>\n</ol><pre><code>ifdef &lt;variable-name&gt;\n</code></pre><p>å¦‚æœ<variable-name>å€¼éç©ºï¼Œåˆ™è¡¨è¾¾å¼ä¸ºçœŸï¼Œå¦åˆ™ä¸ºå‡ã€‚<variable-name>ä¹Ÿå¯ä»¥æ˜¯å‡½æ•°çš„è¿”å›å€¼ã€‚</variable-name></variable-name></p><ol start=\"4\">\n<li>ifndefï¼šæ¡ä»¶åˆ¤æ–­ï¼Œåˆ¤æ–­å˜é‡æ˜¯å¦æœªå®šä¹‰ã€‚</li>\n</ol><pre><code>ifndef &lt;variable-name&gt;\n</code></pre><p>å¦‚æœ<variable-name>å€¼ä¸ºç©ºï¼Œåˆ™è¡¨è¾¾å¼ä¸ºçœŸï¼Œå¦åˆ™ä¸ºå‡ã€‚<variable-name>ä¹Ÿå¯ä»¥æ˜¯å‡½æ•°çš„è¿”å›å€¼ã€‚</variable-name></variable-name></p><h3>å‡½æ•°</h3><p>MakefileåŒæ ·ä¹Ÿæ”¯æŒå‡½æ•°ï¼Œå‡½æ•°è¯­æ³•åŒ…æ‹¬å®šä¹‰è¯­æ³•å’Œè°ƒç”¨è¯­æ³•ã€‚</p><p><strong>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹è‡ªå®šä¹‰å‡½æ•°ã€‚</strong> makeè§£é‡Šå™¨æä¾›äº†ä¸€ç³»åˆ—çš„å‡½æ•°ä¾›Makefileè°ƒç”¨ï¼Œè¿™äº›å‡½æ•°æ˜¯Makefileçš„é¢„å®šä¹‰å‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡defineå…³é”®å­—æ¥è‡ªå®šä¹‰ä¸€ä¸ªå‡½æ•°ã€‚è‡ªå®šä¹‰å‡½æ•°çš„è¯­æ³•ä¸ºï¼š</p><pre><code>define å‡½æ•°å\nå‡½æ•°ä½“\nendef\n</code></pre><p>ä¾‹å¦‚ï¼Œä¸‹é¢è¿™ä¸ªè‡ªå®šä¹‰å‡½æ•°ï¼š</p><pre><code>define Foo\n    @echo &quot;my name is $(0)&quot;\n    @echo &quot;param is $(1)&quot;\nendef\n</code></pre><p>defineæœ¬è´¨ä¸Šæ˜¯å®šä¹‰ä¸€ä¸ªå¤šè¡Œå˜é‡ï¼Œå¯ä»¥åœ¨callçš„ä½œç”¨ä¸‹å½“ä½œå‡½æ•°æ¥ä½¿ç”¨ï¼Œåœ¨å…¶ä»–ä½ç½®ä½¿ç”¨åªèƒ½ä½œä¸ºå¤šè¡Œå˜é‡æ¥ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š</p><pre><code>var := $(call Foo)\nnew := $(Foo)\n</code></pre><p>è‡ªå®šä¹‰å‡½æ•°æ˜¯ä¸€ç§è¿‡ç¨‹è°ƒç”¨ï¼Œæ²¡æœ‰ä»»ä½•çš„è¿”å›å€¼ã€‚å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°æ¥å®šä¹‰å‘½ä»¤çš„é›†åˆï¼Œå¹¶åº”ç”¨åœ¨è§„åˆ™ä¸­ã€‚</p><p><strong>å†æ¥çœ‹ä¸‹é¢„å®šä¹‰å‡½æ•°ã€‚</strong> åˆšæ‰æåˆ°ï¼Œmakeç¼–è¯‘å™¨ä¹Ÿå®šä¹‰äº†å¾ˆå¤šå‡½æ•°ï¼Œè¿™äº›å‡½æ•°å«ä½œé¢„å®šä¹‰å‡½æ•°ï¼Œè°ƒç”¨è¯­æ³•å’Œå˜é‡ç±»ä¼¼ï¼Œè¯­æ³•ä¸ºï¼š</p><pre><code>$(&lt;function&gt; &lt;arguments&gt;)\n</code></pre><p>æˆ–è€…</p><pre><code>${&lt;function&gt; &lt;arguments&gt;}\n</code></pre><p><code>&lt;function&gt;</code>æ˜¯å‡½æ•°åï¼Œ<code>&lt;arguments&gt;</code>æ˜¯å‡½æ•°å‚æ•°ï¼Œå‚æ•°é—´ç”¨é€—å·åˆ†å‰²ã€‚å‡½æ•°çš„å‚æ•°ä¹Ÿå¯ä»¥æ˜¯å˜é‡ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><pre><code>PLATFORM = linux_amd64\nGOOS := $(word 1, $(subst _, ,$(PLATFORM)))\n</code></pre><p>ä¸Šé¢çš„ä¾‹å­ç”¨åˆ°äº†ä¸¤ä¸ªå‡½æ•°ï¼šwordå’Œsubstã€‚wordå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œ1å’Œsubstå‡½æ•°çš„è¾“å‡ºã€‚substå‡½æ•°å°†PLATFORMå˜é‡å€¼ä¸­çš„_æ›¿æ¢æˆç©ºæ ¼ï¼ˆæ›¿æ¢åçš„PLATFORMå€¼ä¸ºlinux amd64ï¼‰ã€‚wordå‡½æ•°å–linux amd64å­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€ä¸ªå•è¯ã€‚æ‰€ä»¥æœ€åGOOSçš„å€¼ä¸ºlinuxã€‚</p><p>Makefileé¢„å®šä¹‰å‡½æ•°èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å®ç°å¾ˆå¤šå¼ºå¤§çš„åŠŸèƒ½ï¼Œåœ¨ç¼–å†™Makefileçš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰åŠŸèƒ½éœ€æ±‚ï¼Œå¯ä»¥ä¼˜å…ˆä½¿ç”¨è¿™äº›å‡½æ•°ã€‚å¦‚æœä½ æƒ³ä½¿ç”¨è¿™äº›å‡½æ•°ï¼Œé‚£å°±éœ€è¦çŸ¥é“æœ‰å“ªäº›å‡½æ•°ï¼Œä»¥åŠå®ƒä»¬å®ç°çš„åŠŸèƒ½ã€‚</p><p>å¸¸ç”¨çš„å‡½æ•°åŒ…æ‹¬ä¸‹é¢è¿™äº›ï¼Œä½ éœ€è¦å…ˆæœ‰ä¸ªå°è±¡ï¼Œä»¥åç”¨åˆ°æ—¶å†æ¥æŸ¥çœ‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/96/5f/96da0853e8225a656d2c0489e544865f.jpg?wh=2248x3692\" alt=\"\"></p><h2>å¼•å…¥å…¶ä»–Makefile</h2><p>é™¤äº†Makefileè§„åˆ™ã€Makefileè¯­æ³•ä¹‹å¤–ï¼ŒMakefileè¿˜æœ‰å¾ˆå¤šç‰¹æ€§ï¼Œæ¯”å¦‚å¯ä»¥å¼•å…¥å…¶ä»–Makefileã€è‡ªåŠ¨ç”Ÿæˆä¾èµ–å…³ç³»ã€æ–‡ä»¶æœç´¢ç­‰ç­‰ã€‚è¿™é‡Œæˆ‘å†ä»‹ç»ä¸€ä¸ªIAMé¡¹ç›®çš„Makefileç”¨åˆ°çš„é‡ç‚¹ç‰¹æ€§ï¼šå¼•å…¥å…¶ä»–Makefileã€‚</p><p>åœ¨ <a href=\"https://time.geekbang.org/column/article/388920\"><strong>14è®²</strong></a> ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»è¿‡Makefileè¦ç»“æ„åŒ–ã€å±‚æ¬¡åŒ–ï¼Œè¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡<strong>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„Makefileä¸­å¼•å…¥å…¶ä»–Makefile</strong>æ¥å®ç°ã€‚</p><p>åœ¨Makefileä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å…³é”®å­—includeï¼ŒæŠŠåˆ«çš„makefileåŒ…å«è¿›æ¥ï¼Œç±»ä¼¼äºCè¯­è¨€çš„<code>#include</code>ï¼Œè¢«åŒ…å«çš„æ–‡ä»¶ä¼šæ’å…¥åœ¨å½“å‰çš„ä½ç½®ã€‚includeç”¨æ³•ä¸º<code>include &lt;filename&gt;</code>ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code>include scripts/make-rules/common.mk\ninclude scripts/make-rules/golang.mk\n</code></pre><p>includeä¹Ÿå¯ä»¥åŒ…å«é€šé…ç¬¦<code>include scripts/make-rules/*</code>ã€‚makeå‘½ä»¤ä¼šæŒ‰ä¸‹é¢çš„é¡ºåºæŸ¥æ‰¾makefileæ–‡ä»¶ï¼š</p><ol>\n<li>å¦‚æœæ˜¯ç»å¯¹æˆ–ç›¸å¯¹è·¯å¾„ï¼Œå°±ç›´æ¥æ ¹æ®è·¯å¾„includeè¿›æ¥ã€‚</li>\n<li>å¦‚æœmakeæ‰§è¡Œæ—¶ï¼Œæœ‰<code>-I</code>æˆ–<code>--include-dir</code>å‚æ•°ï¼Œé‚£ä¹ˆmakeå°±ä¼šåœ¨è¿™ä¸ªå‚æ•°æ‰€æŒ‡å®šçš„ç›®å½•ä¸‹å»æ‰¾ã€‚</li>\n<li>å¦‚æœç›®å½•<code>&lt;prefix&gt;/include</code>ï¼ˆä¸€èˆ¬æ˜¯<code>/usr/local/bin</code>æˆ–<code>/usr/include</code>ï¼‰å­˜åœ¨çš„è¯ï¼Œmakeä¹Ÿä¼šå»æ‰¾ã€‚</li>\n</ol><p>å¦‚æœæœ‰æ–‡ä»¶æ²¡æœ‰æ‰¾åˆ°ï¼Œmakeä¼šç”Ÿæˆä¸€æ¡è­¦å‘Šä¿¡æ¯ï¼Œä½†ä¸ä¼šé©¬ä¸Šå‡ºç°è‡´å‘½é”™è¯¯ï¼Œè€Œæ˜¯ç»§ç»­è½½å…¥å…¶ä»–çš„æ–‡ä»¶ã€‚ä¸€æ—¦å®Œæˆmakefileçš„è¯»å–ï¼Œmakeä¼šå†é‡è¯•è¿™äº›æ²¡æœ‰æ‰¾åˆ°æˆ–æ˜¯ä¸èƒ½è¯»å–çš„æ–‡ä»¶ã€‚å¦‚æœè¿˜æ˜¯ä¸è¡Œï¼Œmakeæ‰ä¼šå‡ºç°ä¸€æ¡è‡´å‘½é”™è¯¯ä¿¡æ¯ã€‚å¦‚æœä½ æƒ³è®©makeå¿½ç•¥é‚£äº›æ— æ³•è¯»å–çš„æ–‡ä»¶ç»§ç»­æ‰§è¡Œï¼Œå¯ä»¥åœ¨includeå‰åŠ ä¸€ä¸ªå‡å·<code>-</code>ï¼Œå¦‚<code>-include &lt;filename&gt;</code>ã€‚</p><h2>æ€»ç»“</h2><p>åœ¨è¿™ä¸€è®²é‡Œï¼Œä¸ºäº†å¸®åŠ©ä½ ç¼–å†™ä¸€ä¸ªé«˜è´¨é‡çš„Makefileï¼Œæˆ‘é‡ç‚¹ä»‹ç»äº†Makefileè§„åˆ™å’ŒMakefileè¯­æ³•é‡Œçš„ä¸€äº›æ ¸å¿ƒè¯­æ³•çŸ¥è¯†ã€‚</p><p>åœ¨è®²Makefileè§„åˆ™æ—¶ï¼Œæˆ‘ä»¬ä¸»è¦å­¦ä¹ äº†è§„åˆ™è¯­æ³•ã€ä¼ªç›®æ ‡å’Œorder-onlyä¾èµ–ã€‚æŒæ¡äº†è¿™äº›Makefileè§„åˆ™ï¼Œä½ å°±æŒæ¡äº†Makefileä¸­æœ€æ ¸å¿ƒçš„å†…å®¹ã€‚</p><p>åœ¨ä»‹ç»Makefileçš„è¯­æ³•æ—¶ï¼Œæˆ‘åªä»‹ç»äº†Makefileçš„æ ¸å¿ƒè¯­æ³•ï¼Œä»¥åŠ IAMé¡¹ç›®çš„Makefileç”¨åˆ°çš„è¯­æ³•ï¼ŒåŒ…æ‹¬å‘½ä»¤ã€å˜é‡ã€æ¡ä»¶è¯­å¥å’Œå‡½æ•°ã€‚ä½ å¯èƒ½ä¼šè§‰å¾—è¿™äº›è¯­æ³•å­¦ä¹ èµ·æ¥æ¯”è¾ƒæ¯ç‡¥ï¼Œä½†è¿˜æ˜¯é‚£å¥è¯ï¼Œå·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€‚å¸Œæœ›ä½ èƒ½ç†Ÿç»ƒæŒæ¡Makefileçš„æ ¸å¿ƒè¯­æ³•ï¼Œä¸ºç¼–å†™é«˜è´¨é‡çš„Makefileæ‰“å¥½åŸºç¡€ã€‚</p><p>ä»Šå¤©çš„å†…å®¹å°±åˆ°è¿™é‡Œå•¦ï¼Œæ¬¢è¿ä½ åœ¨ä¸‹é¢çš„ç•™è¨€åŒºè°ˆè°ˆè‡ªå·±çš„çœ‹æ³•ï¼Œæˆ‘ä»¬ä¸‹ä¸€è®²è§ã€‚</p>","comments":[{"had_liked":false,"id":299715,"user_name":"helloworld","can_delete":false,"product_type":"c1","uid":1105161,"ip_address":"","ucode":"1EECCA0F43E278","user_header":"https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg","comment_is_top":false,"comment_ctime":1624812302,"is_pvip":false,"replies":[{"id":"108715","content":"å¬èµ·æ¥æ²¡æ¯›ç—…ï¼Œä¿æŒä¸€è‡´å³å¯","user_name":"ä½œè€…å›å¤","comment_id":299715,"uid":"1167883","ip_address":"","utype":1,"ctime":1624847210,"user_name_real":"CK1.0"}],"discussion_count":1,"race_medal":0,"score":"61754354446","product_id":100079601,"comment_content":"æˆ‘è§‰å¾—å˜é‡ç”¨${}, å‡½æ•°ç”¨$(),è¿™æ ·èƒ½å¾ˆå¥½åŒºåˆ†ï¼Œå¯¹ç†Ÿæ‚‰shellçš„äººä¹Ÿæ›´å‹å¥½","like_count":14,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522515,"discussion_content":"å¬èµ·æ¥æ²¡æ¯›ç—…ï¼Œä¿æŒä¸€è‡´å³å¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624847210,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":299731,"user_name":"pedro","can_delete":false,"product_type":"c1","uid":1200704,"ip_address":"","ucode":"F40C839DDFD599","user_header":"https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg","comment_is_top":false,"comment_ctime":1624838905,"is_pvip":false,"replies":[{"id":"108685","content":"è¿™ç¯‡æ˜¯é¢å¤–çš„åŠ é¤ï¼Œä¸å æ’æœŸå“¦","user_name":"ç¼–è¾‘å›å¤","comment_id":299731,"uid":"1059377","ip_address":"","utype":2,"ctime":1624839448,"user_name_real":"è´¾é™"}],"discussion_count":1,"race_medal":0,"score":"31689609977","product_id":100079601,"comment_content":"å‘¨ä¸€å°±æ›´æ–°ï¼Œå€¼ğŸ˜‚","like_count":7,"discussions":[{"author":{"id":1059377,"avatar":"https://static001.geekbang.org/account/avatar/00/10/2a/31/9edbf8a6.jpg","nickname":"è´¾é™","note":"","ucode":"081E70CC01F6B8","race_medal":0,"user_type":8,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522523,"discussion_content":"è¿™ç¯‡æ˜¯é¢å¤–çš„åŠ é¤ï¼Œä¸å æ’æœŸå“¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624839448,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":302895,"user_name":"æˆæ¥¼","can_delete":false,"product_type":"c1","uid":1076112,"ip_address":"","ucode":"31E91E3A328773","user_header":"https://static001.geekbang.org/account/avatar/00/10/6b/90/ca3bf377.jpg","comment_is_top":false,"comment_ctime":1626425280,"is_pvip":false,"replies":[{"id":"109709","content":"å¯ä»¥çœ‹ä¸‹iamä»“åº“æ ¹ç›®å½•ä¸‹çš„READMEæ–‡æ¡£ï¼Œæœ€åæœ‰å¾®ä¿¡å·","user_name":"ä½œè€…å›å¤","comment_id":302895,"uid":"1167883","ip_address":"","utype":1,"ctime":1626621926,"user_name_real":"CK1.0"}],"discussion_count":1,"race_medal":0,"score":"10216359872","product_id":100079601,"comment_content":"æœ‰å­¦å‘˜ç¾¤å—ï¼Ÿå¯ä»¥åŠ å…¥ä¸‹å—ï¼Ÿæ–¹ä¾¿äº¤æµå’Œæå‡ï¼Œè°¢è°¢ã€‚","like_count":2,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523469,"discussion_content":"å¯ä»¥çœ‹ä¸‹iamä»“åº“æ ¹ç›®å½•ä¸‹çš„READMEæ–‡æ¡£ï¼Œæœ€åæœ‰å¾®ä¿¡å·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626621926,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":306681,"user_name":"Fan","can_delete":false,"product_type":"c1","uid":1115232,"ip_address":"","ucode":"3BF28670FD9407","user_header":"https://static001.geekbang.org/account/avatar/00/11/04/60/64d166b6.jpg","comment_is_top":false,"comment_ctime":1628669243,"is_pvip":false,"replies":[{"id":"111431","content":"USAGE_OPTIONSçš„å€¼å¯ä»¥æ˜¯å¤šè¡Œå­—ç¬¦ä¸²","user_name":"ä½œè€…å›å¤","comment_id":306681,"uid":"1167883","ip_address":"","utype":1,"ctime":1629251528,"user_name_real":"CK1.0"}],"discussion_count":1,"race_medal":0,"score":"5923636539","product_id":100079601,"comment_content":"å¤šè¡Œå˜é‡ çš„ä¾‹å­æ²¡æ˜ç™½<br><br><br>define USAGE_OPTIONS<br><br>Options:<br>  DEBUG        Whether to generate debug symbols. Default is 0.<br>  BINS         The binaries to build. Default is all of cmd.<br>  ...<br>  V            Set to 1 enable verbose build. Default is 0.<br>endef","like_count":1,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524869,"discussion_content":"USAGE_OPTIONSçš„å€¼å¯ä»¥æ˜¯å¤šè¡Œå­—ç¬¦ä¸²","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629251528,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":350188,"user_name":"Jone_ä¹”æ³“æº","can_delete":false,"product_type":"c1","uid":1407941,"ip_address":"","ucode":"158154301D5E40","user_header":"https://static001.geekbang.org/account/avatar/00/15/7b/c5/35f92dad.jpg","comment_is_top":false,"comment_ctime":1656643579,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1656643579","product_id":100079601,"comment_content":"è€å¸ˆï¼Œæœ‰é—®æ ¼å¼é—®é¢˜æƒ³é—®ä¸‹ï¼šifeq è¯­å¥ä¸­çš„å†…å®¹å»ºè®®è¦ç”¨ tabï¼Œè¿˜æ˜¯é¡¶æ ¼å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":350116,"user_name":"Jone_ä¹”æ³“æº","can_delete":false,"product_type":"c1","uid":1407941,"ip_address":"","ucode":"158154301D5E40","user_header":"https://static001.geekbang.org/account/avatar/00/15/7b/c5/35f92dad.jpg","comment_is_top":false,"comment_ctime":1656579563,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1656579563","product_id":100079601,"comment_content":"ifeq ($(origin ROOT_DIR),undefined)<br>ROOT_DIR := $(abspath $(shell cd $(COMMON_SELF_DIR)&#47;..&#47;.. &amp;&amp; pwd -P))<br>endif<br>å’Œ <br>ROOT_DIR ?= $(abspath $(shell cd $(COMMON_SELF_DIR)&#47;..&#47;.. &amp;&amp; pwd -P))<br><br>è¯·é—®ï¼šè¿™ä¸¤ç§æ–¹å¼çš„æ•ˆæœæ˜¯å¦ç›¸åŒï¼Ÿ<br>","like_count":0},{"had_liked":false,"id":314225,"user_name":"lesserror","can_delete":false,"product_type":"c1","uid":1351076,"ip_address":"","ucode":"25A54D1165FCF6","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","comment_is_top":false,"comment_ctime":1632907040,"is_pvip":false,"replies":[{"id":"114095","content":"é™ˆçš“è€å¸ˆç¼–å†™çš„è¿™ä»½MakefileæŒ‡å—å¾ˆè¯¦å°½","user_name":"ä½œè€…å›å¤","comment_id":314225,"uid":"1167883","ip_address":"","utype":1,"ctime":1633665629,"user_name_real":"CK1.0"}],"discussion_count":1,"race_medal":0,"score":"1632907040","product_id":100079601,"comment_content":"å¤§å®¶æœ‰ä»€ä¹ˆä¸æ‡‚çš„ï¼Œå¯ä»¥ç»“åˆï¼šé™ˆçš“è€å¸ˆç¼–å†™çš„ã€Šè·Ÿæˆ‘ä¸€èµ·å†™ Makefileã€‹ (PDF é‡åˆ¶ç‰ˆ) æ¥çœ‹ï¼Œæœ¬æ–‡å—é™äºç¯‡å¹…ï¼Œæœ‰äº›æ¦‚å¿µå¯èƒ½ä¸èƒ½èŠ±å¾ˆå¤§çš„ç¯‡å¹…å»è®²è§£ã€‚","like_count":0,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527616,"discussion_content":"é™ˆçš“è€å¸ˆç¼–å†™çš„è¿™ä»½MakefileæŒ‡å—å¾ˆè¯¦å°½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633665629,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":302897,"user_name":"æˆæ¥¼","can_delete":false,"product_type":"c1","uid":1076112,"ip_address":"","ucode":"31E91E3A328773","user_header":"https://static001.geekbang.org/account/avatar/00/10/6b/90/ca3bf377.jpg","comment_is_top":false,"comment_ctime":1626425647,"is_pvip":false,"replies":[{"id":"109710","content":"å¯ä»¥çœ‹ä¸‹IAMé¡¹ç›®æ ¹ç›®å½•ä¸‹çš„READMEæ–‡æ¡£ï¼Œæœ‰å¾®ä¿¡å·","user_name":"ä½œè€…å›å¤","comment_id":302897,"uid":"1167883","ip_address":"","utype":1,"ctime":1626621965,"user_name_real":"CK1.0"}],"discussion_count":1,"race_medal":0,"score":"1626425647","product_id":100079601,"comment_content":"ç”±äºç¼ºå°‘äº‘ä¸Šå¼€å‘èµ„æºï¼Œæœ¬åœ°è™šæ‹Ÿæœºçš„ç¯å¢ƒé…ç½®èƒ½å¦ç»™äº›å»ºè®®ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªç¾¤æ–¹ä¾¿äº¤æµå—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523471,"discussion_content":"å¯ä»¥çœ‹ä¸‹IAMé¡¹ç›®æ ¹ç›®å½•ä¸‹çš„READMEæ–‡æ¡£ï¼Œæœ‰å¾®ä¿¡å·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626621965,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":301774,"user_name":"Realm","can_delete":false,"product_type":"c1","uid":1081299,"ip_address":"","ucode":"30CBEBE619D1A2","user_header":"https://static001.geekbang.org/account/avatar/00/10/7f/d3/b5896293.jpg","comment_is_top":false,"comment_ctime":1625877704,"is_pvip":true,"replies":[{"id":"109504","content":"æ²¡æ‰¾åˆ°ä½ è¯´çš„å“ªä¸ªä½ç½®ï¼Œå¯ä»¥å†æ˜ç¡®ä¸‹ä½ç½®å—ï¼Œthanks","user_name":"ä½œè€…å›å¤","comment_id":301774,"uid":"1167883","ip_address":"","utype":1,"ctime":1626281240,"user_name_real":"CK1.0"}],"discussion_count":3,"race_medal":0,"score":"1625877704","product_id":100079601,"comment_content":"è€å¸ˆï¼Œå‡½æ•°dir ï¼Œnodiræ³¨é‡Šå¥½åƒæœ‰ç¬”è¯¯.","like_count":0,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523086,"discussion_content":"æ²¡æ‰¾åˆ°ä½ è¯´çš„å“ªä¸ªä½ç½®ï¼Œå¯ä»¥å†æ˜ç¡®ä¸‹ä½ç½®å—ï¼Œthanks","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626281240,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1922171,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/54/7b/780c04ff.jpg","nickname":"å²åŠªæ¯”","note":"","ucode":"20D1EC05778BC6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391052,"discussion_content":"å…¶å®è¯´çš„é‚£å¼ å›¾é‡Œçš„å†…å®¹ï¼Œå…¶å®è¿˜é”™äº†ä¸€ä¸ªprefixçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630247754,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1049879,"avatar":"https://static001.geekbang.org/account/avatar/00/10/05/17/63887353.jpg","nickname":"ç‹éª¥","note":"","ucode":"CE53ADEA51235A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386786,"discussion_content":"å…³äº dir å‡½æ•°çš„æè¿°ï¼Œåº”è¯¥æ˜¯åˆ—å‡ºç›®å½•åå§ï¼Ÿç°åœ¨å†™æˆéç›®å½•åäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627800877,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":299747,"user_name":"Tiandh","can_delete":false,"product_type":"c1","uid":1114508,"ip_address":"","ucode":"581C14BAE84AE7","user_header":"https://static001.geekbang.org/account/avatar/00/11/01/8c/41adb537.jpg","comment_is_top":false,"comment_ctime":1624843858,"is_pvip":false,"replies":[{"id":"108716","content":"å°±æ˜¯ä¼ªç›®æ ‡æ€»æ˜¯ä¼šè¢«æ‰§è¡Œ","user_name":"ä½œè€…å›å¤","comment_id":299747,"uid":"1167883","ip_address":"","utype":1,"ctime":1624847260,"user_name_real":"CK1.0"}],"discussion_count":4,"race_medal":0,"score":"1624843858","product_id":100079601,"comment_content":"è€å¸ˆï¼Œè¿™ä¸¤å¥è¯ä¸ç†è§£<br>å› ä¸ºä¼ªç›®æ ‡ä¸æ˜¯æ–‡ä»¶ï¼Œmake æ— æ³•ç”Ÿæˆå®ƒçš„ä¾èµ–å…³ç³»ï¼Œä¹Ÿæ— æ³•å†³å®šæ˜¯å¦è¦æ‰§è¡Œå®ƒã€‚<br>å› ä¸ºä¼ªç›®æ ‡æ€»æ˜¯ä¼šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥å…¶ä¾èµ–æ€»æ˜¯ä¼šè¢«å†³è®®ã€‚","like_count":0,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522530,"discussion_content":"å°±æ˜¯ä¼ªç›®æ ‡æ€»æ˜¯ä¼šè¢«æ‰§è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624847260,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1771834,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/09/3a/fe0ac50e.jpg","nickname":"åå¹´ä¹‹å","note":"","ucode":"78464178F72676","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388605,"discussion_content":"æˆ‘ç†è§£å°±æ˜¯makefileçš„targetè¡¨ç¤ºä¸€ä¸ªæ–‡ä»¶ï¼Œæ­£å¸¸æ¥è¯´åˆ†ä¸¤ç§æƒ…å†µï¼šå¦‚æœå½“å‰ç›®å½•æœ‰è¿™ä¸ªtargetæ–‡ä»¶ï¼Œé‚£å°±ä¸æ‰§è¡Œï¼Œå¦‚æœå½“å‰ç›®å½•æ²¡æœ‰è¿™ä¸ªtargetæ–‡ä»¶ï¼Œé‚£å°±æ‰§è¡Œtargetï¼›ä½†æ˜¯å¦‚æœç”¨PHONYæ˜¾å¼å£°æ˜targetä¸ºä¼ªç›®æ ‡ï¼Œé‚£å°±åªå‰©ä¸‹ä¸€ç§æƒ…å†µï¼šæ€»æ˜¯è¢«æ‰§è¡Œï¼Œå› ä¸ºä¼ªç›®æ ‡åœ¨makefileçœ‹æ¥å·²ç»ä¸è¡¨ç¤ºä¸€ä¸ªæ–‡ä»¶äº†ï¼Œå°±ä¸ä¼šåˆ¤æ–­å½“å‰ç›®å½•æ˜¯å¦å­˜åœ¨targetæ–‡ä»¶äº†ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1628846231,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1049879,"avatar":"https://static001.geekbang.org/account/avatar/00/10/05/17/63887353.jpg","nickname":"ç‹éª¥","note":"","ucode":"CE53ADEA51235A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386787,"discussion_content":"æ¡ˆä¾‹ä¸­ä¼ªç›®æ ‡cleanè¢«æ‰§è¡Œï¼Œä¸ºä»€ä¹ˆhello.oè¿˜åœ¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627800982,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1351076,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","nickname":"lesserror","note":"","ucode":"25A54D1165FCF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1049879,"avatar":"https://static001.geekbang.org/account/avatar/00/10/05/17/63887353.jpg","nickname":"ç‹éª¥","note":"","ucode":"CE53ADEA51235A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":399091,"discussion_content":"ä¸ä¼šå§ï¼Œå·²ç»æ‰§è¡Œï¼šrm hello.o  å‘½ä»¤åˆ é™¤æ‰äº†å‘€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632905701,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":386787,"ip_address":""},"score":399091,"extra":""}]}]}]}