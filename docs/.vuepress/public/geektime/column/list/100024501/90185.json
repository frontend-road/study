{"id":90185,"title":"15 | æ—¥å¿—ç›‘æ§ï¼šæ€æ ·è·å– App ä¸­çš„å…¨é‡æ—¥å¿—ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æˆ´é“­ã€‚</p><p>æˆ‘åœ¨å‰é¢çš„ç¬¬12ã€13å’Œ14ä¸‰ç¯‡æ–‡ç« ä¸­ï¼Œå’Œä½ åˆ†äº«äº†å´©æºƒã€å¡é¡¿ã€å†…å­˜é—®é¢˜çš„ç›‘æ§ã€‚ä¸€æ—¦ç›‘æ§åˆ°é—®é¢˜ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®°å½•ä¸‹é—®é¢˜çš„è¯¦ç»†ä¿¡æ¯ï¼Œå½¢æˆæ—¥å¿—å‘ŠçŸ¥å¼€å‘è€…ï¼Œè¿™æ ·å¼€å‘è€…æ‰èƒ½å¤Ÿä»è¿™äº›æ—¥å¿—ä¸­å®šä½é—®é¢˜ã€‚</p><p>ä½†æ˜¯ï¼Œå¾ˆå¤šé—®é¢˜çš„å®šä½ä»…é é—®é¢˜å‘ç”Ÿçš„é‚£ä¸€åˆ¹é‚£è®°å½•çš„ä¿¡æ¯æ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¾èµ–æ›´å¤šçš„æ—¥å¿—ä¿¡æ¯ã€‚</p><p>åœ¨ä»¥å‰å…¬å¸è¿˜æ²¡æœ‰å…¨é‡æ—¥å¿—çš„æ—¶å€™ï¼Œæˆ‘å‘ç°çº¿ä¸Šæœ‰ä¸€ä¸ªä¸ŠæŠ¥åˆ°æœåŠ¡å™¨çš„ç”±æ•°æ®è§£æå‡ºé”™è€Œå¼•èµ·å´©æºƒçš„é—®é¢˜ã€‚ç”±äºæ•°æ®è§£ææ˜¯åœ¨ç”Ÿæˆæ•°æ®ååœ¨å¦ä¸€ä¸ªçº¿ç¨‹å»¶è¿Ÿæ‰§è¡Œçš„ï¼Œæ‰€ä»¥å¾ˆéš¾å®šä½åˆ°æ˜¯è°ç”Ÿæˆçš„æ•°æ®é€ æˆäº†å´©æºƒã€‚</p><p>å¦‚æœè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘èƒ½å¤ŸæŸ¥çœ‹åˆ°å´©æºƒå‰çš„æ‰€æœ‰æ—¥å¿—ï¼ŒåŒ…æ‹¬æ‰‹åŠ¨æ‰“çš„æ—¥å¿—å’Œæ— ä¾µå…¥è‡ªåŠ¨åŸ‹ç‚¹çš„æ—¥å¿—ï¼Œå°±èƒ½å¤Ÿå¿«é€Ÿå®šä½åˆ°æ˜¯ç”±è°ç”Ÿæˆçš„æ•°æ®é€ æˆäº†å´©æºƒã€‚è¿™äº›åœ¨ App é‡Œè®°å½•çš„æ‰€æœ‰æ—¥å¿—ï¼Œæ¯”å¦‚ç”¨äºè®°å½•ç”¨æˆ·è¡Œä¸ºå’Œå…³é”®æ“ä½œçš„æ—¥å¿—ï¼Œå°±æ˜¯å…¨é‡æ—¥å¿—äº†ã€‚</p><p>æœ‰äº†æ›´å¤šçš„ä¿¡æ¯ï¼Œæ‰æ›´åˆ©äºå¼€å‘è€…å»å¿«é€Ÿã€ç²¾å‡†åœ°å®šä½å„ç§å¤æ‚é—®é¢˜ï¼Œå¹¶æé«˜è§£å†³é—®é¢˜çš„æ•ˆç‡ã€‚é‚£ä¹ˆï¼Œ<strong>æ€æ ·æ‰èƒ½å¤Ÿè·å–åˆ° App é‡Œæ›´å¤šçš„æ—¥å¿—å‘¢</strong>ï¼Ÿ</p><p>ä½ å¯èƒ½ä¼šè§‰å¾—è·å–åˆ°å…¨é‡çš„æ—¥å¿—å¾ˆå®¹æ˜“å•Šï¼Œåªè¦æ‰€æœ‰æ•°æ®éƒ½é€šè¿‡ç›¸åŒçš„æ‰“æ—¥å¿—åº“ï¼Œä¸å°±å¯ä»¥æ”¶é›†åˆ°æ‰€æœ‰æ—¥å¿—äº†å—ï¼Ÿä½†ï¼Œç°å®æƒ…å†µå¹¶æ²¡æœ‰è¿™ä¹ˆç®€å•ã€‚</p><p>ä¸€ä¸ª App å¾ˆæœ‰å¯èƒ½æ˜¯ç”±å¤šä¸ªå›¢é˜Ÿå…±åŒå¼€å‘ç»´æŠ¤çš„ï¼Œä¸åŒå›¢é˜Ÿä½¿ç”¨çš„æ—¥å¿—åº“ç”±äºå†å²åŸå› å¯èƒ½éƒ½ä¸ä¸€æ ·ï¼Œè¦ä¹ˆæ˜¯è‡ªå·±å¼€å‘çš„ï¼Œè¦ä¹ˆå°±æ˜¯ä½¿ç”¨äº†ä¸åŒç¬¬ä¸‰æ–¹æ—¥å¿—åº“ã€‚å¦‚æœæˆ‘ä»¬åªæ˜¯ä¸ºäº†ç»Ÿä¸€è·å–æ—¥å¿—ï¼Œè€Œå»æ¨åŠ¨å…¶ä»–å›¢é˜Ÿå°†ä»¥å‰çš„æ—¥å¿—åº“ä»£ç å…¨éƒ¨æ›¿æ¢æ‰ï¼Œæ˜æ˜¾æ˜¯ä¸ç°å®çš„ã€‚å› ä¸ºï¼Œæˆ‘ä»¬è°ä¹Ÿæ— æ³•ç¡®å®šï¼Œè¿™ç§æ›¿æ¢æ—¥å¿—åº“çš„å·¥ä½œï¼Œä»¥åæ˜¯ä¸æ˜¯è¿˜ä¼šå†æ¥ä¸€æ¬¡ã€‚</p><!-- [[[read_end]]] --><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬è¿˜æœ‰ä»€ä¹ˆå¥½åŠæ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜å—ï¼Ÿåœ¨æˆ‘çœ‹æ¥ï¼Œè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±éœ€è¦å…ˆé€ä¸ªåœ°åˆ†æå„å›¢é˜Ÿä½¿ç”¨çš„æ—¥å¿—åº“ï¼Œä½¿ç”¨ä¸ä¾µå…¥çš„æ–¹å¼å»è·å–æ‰€æœ‰æ—¥å¿—ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°±å…ˆå’Œä½ è¯´è¯´æ€æ ·è·å–ç³»ç»Ÿè‡ªå¸¦NSLogçš„æ—¥å¿—ã€‚</p><h2>è·å– NSLog çš„æ—¥å¿—</h2><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒNSLogå…¶å®å°±æ˜¯ä¸€ä¸ªCå‡½æ•°ï¼Œå‡½æ•°å£°æ˜æ˜¯ï¼š</p><pre><code>void NSLog(NSString *format, ...);\n</code></pre><p>å®ƒçš„ä½œç”¨æ˜¯ï¼Œè¾“å‡ºä¿¡æ¯åˆ°æ ‡å‡†çš„Erroræ§åˆ¶å°å’Œç³»ç»Ÿæ—¥å¿—ï¼ˆsyslogï¼‰ä¸­ã€‚åœ¨å†…éƒ¨å®ç°ä¸Šï¼Œå®ƒå…¶å®ä½¿ç”¨çš„æ˜¯ASLï¼ˆApple System Loggerï¼Œæ˜¯è‹¹æœå…¬å¸è‡ªå·±å®ç°çš„ä¸€å¥—è¾“å‡ºæ—¥å¿—çš„æ¥å£ï¼‰çš„APIï¼Œå°†æ—¥å¿—æ¶ˆæ¯ç›´æ¥å­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚</p><p>é‚£ä¹ˆï¼Œ<strong>æˆ‘ä»¬å¦‚ä½•æ‰èƒ½è·å–åˆ°é€šè¿‡ASLå­˜æ”¾åœ¨ç³»ç»Ÿæ—¥å¿—ä¸­çš„æ—¥å¿—å‘¢ï¼Ÿ</strong></p><p>ASL ä¼šæä¾›æ¥å£å»æŸ¥æ‰¾æ‰€æœ‰çš„æ—¥å¿—ï¼Œé€šè¿‡ <a href=\"https://github.com/CocoaLumberjack/CocoaLumberjack\">CocoaLumberjack</a> è¿™ä¸ªç¬¬ä¸‰æ–¹æ—¥å¿—åº“é‡Œçš„ DDASLLogCapture è¿™ä¸ªç±»ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å®æ—¶æ•è· NSLog çš„æ–¹æ³•ã€‚DDASLLogCaptureä¼šåœ¨ start æ–¹æ³•é‡Œå¼€å¯ä¸€ä¸ªå¼‚æ­¥å…¨å±€é˜Ÿåˆ—å»æ•è· ASL å­˜å‚¨çš„æ—¥å¿—ã€‚start æ–¹æ³•çš„ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>+ (void)start {\n    ...\n    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void) {\n        [self captureAslLogs];\n    });\n}\n</code></pre><p>å¯ä»¥çœ‹å‡ºï¼Œæ•è·ASLå­˜å‚¨æ—¥å¿—çš„ä¸»è¦å¤„ç†éƒ½åœ¨ captureAslLogs æ–¹æ³•é‡Œã€‚åœ¨æ—¥å¿—è¢«ä¿å­˜åˆ° ASL çš„æ•°æ®åº“æ—¶ï¼Œsyslogdï¼ˆç³»ç»Ÿé‡Œç”¨äºæ¥æ”¶åˆ†å‘æ—¥å¿—æ¶ˆæ¯çš„æ—¥å¿—å®ˆæŠ¤è¿›ç¨‹ï¼‰ ä¼šå‘å‡ºä¸€æ¡é€šçŸ¥ã€‚å› ä¸ºå‘è¿‡æ¥çš„è¿™ä¸€æ¡é€šçŸ¥å¯èƒ½ä¼šæœ‰å¤šæ¡æ—¥å¿—ï¼Œæ‰€ä»¥è¿˜éœ€è¦å…ˆåšäº›åˆå¹¶çš„å·¥ä½œï¼Œå°†å¤šæ¡æ—¥å¿—è¿›è¡Œåˆå¹¶ã€‚å…·ä½“çš„å®ç°ï¼Œä½ å¯ä»¥æŸ¥çœ‹ captureAslLogs æ–¹æ³•çš„å®ç°ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>+ (void)captureAslLogs {\n    @autoreleasepool {\n        ...\n        notify_register_dispatch(kNotifyASLDBUpdate, &amp;notifyToken, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, 0),^(int token) {\n            @autoreleasepool {\n                ...\n                // åˆ©ç”¨è¿›ç¨‹æ ‡è¯†å…¼å®¹åœ¨æ¨¡æ‹Ÿå™¨æƒ…å†µæ—¶å…¶ä»–è¿›ç¨‹æ—¥å¿—æ— æ•ˆé€šçŸ¥\n                [self configureAslQuery:query];\n\n                // è¿­ä»£å¤„ç†æ‰€æœ‰æ–°æ—¥å¿—\n                aslmsg msg;\n                aslresponse response = asl_search(NULL, query);\n\n                while ((msg = asl_next(response))) {\n                    // è®°å½•æ—¥å¿—\n                    [self aslMessageReceived:msg];\n\n                    lastSeenID = (unsigned long long)atoll(asl_get(msg, ASL_KEY_MSG_ID));\n                }\n                asl_release(response);\n                asl_free(query);\n\n                if (_cancel) {\n                    notify_cancel(token);\n                    return;\n                }\n            }\n        });\n</code></pre><p>åœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œnotify_register_dispatchçš„ä½œç”¨æ˜¯ç”¨æ¥æ³¨å†Œè¿›ç¨‹é—´çš„ç³»ç»Ÿé€šçŸ¥ã€‚å…¶ä¸­ï¼ŒkNotifyASLDBUpdate å®è¡¨ç¤ºçš„å°±æ˜¯ï¼Œæ—¥å¿—è¢«ä¿å­˜åˆ° ASL æ•°æ®åº“æ—¶å‘å‡ºçš„è·¨è¿›ç¨‹é€šçŸ¥ï¼Œå…¶é”®å€¼æ˜¯ com.apple.system.logger.messageã€‚</p><p>æ—¢ç„¶æ˜¯è·¨è¿›ç¨‹é€šçŸ¥ï¼Œé‚£ä¹ˆå¤šä¸ª App ä¹‹é—´ä¹Ÿæ˜¯å¯ä»¥è¿›è¡Œé€šçŸ¥çš„ã€‚ä¸è¿‡å¯¹äº iPhone æ¥è¯´ï¼Œå¤šä¸ª App åŒæ—¶ä¿æ´»çš„æœºä¼šå¤ªå°‘ï¼Œæ‰€ä»¥ä¸€èˆ¬éƒ½æ˜¯æ¥æ”¶ç³»ç»ŸåŠŸèƒ½å‘å‡ºçš„é€šçŸ¥ã€‚</p><p>åœ¨iOSç³»ç»Ÿä¸­ï¼Œç±»ä¼¼åœ°æŠŠæ—¥å¿—ä¿å­˜åˆ° ASL æ•°æ®åº“æ—¶å‘å‡ºçš„é€šçŸ¥è¿˜æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚é”®å€¼æ˜¯ com.apple.system.lowdiskspace çš„ kNotifyVFSLowDiskSpace å®ï¼Œè¯¥é€šçŸ¥æ˜¯åœ¨ç³»ç»Ÿç£ç›˜ç©ºé—´ä¸è¶³æ—¶å‘å‡ºçš„ã€‚å½“æ•è·åˆ°è¿™ä¸ªé€šçŸ¥æ—¶ï¼Œä½ å¯ä»¥å»æ¸…ç†ç¼“å­˜ç©ºé—´ï¼Œé¿å…å‘ç”Ÿç¼“å­˜å†™å…¥ç£ç›˜å¤±è´¥çš„æƒ…å†µã€‚</p><p>æ›´å¤šçš„è·¨è¿›ç¨‹é€šçŸ¥å®ï¼Œä½ å¯ä»¥åœ¨ notify_keys.h é‡Œçœ‹åˆ°ï¼Œç»ˆç«¯æŸ¥çœ‹å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code>cat /usr/include/notify_keys.h\n</code></pre><p>æ¥ä¸‹æ¥ï¼Œ<strong>æˆ‘ç»§ç»­å’Œä½ è¯´è¯´ captureAslLogsæ–¹æ³•ï¼Œçœ‹çœ‹ captureAslLogs æ˜¯æ€ä¹ˆå¤„ç† ASL æ—¥å¿—çš„ã€‚</strong></p><p>åœ¨captureAslLogsæ–¹æ³•é‡Œï¼Œå¤„ç†æ—¥å¿—çš„æ–¹æ³•æ˜¯ aslMessageReceivedï¼Œå…¥å‚æ˜¯ aslmsg ç±»å‹ï¼Œç”±äº aslmsg ç±»å‹ä¸æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ— æ³•ç›´æ¥æŸ¥çœ‹ã€‚æ‰€ä»¥åœ¨ aslMessageReceivedæ–¹æ³•çš„å¼€å§‹é˜¶æ®µï¼Œä¼šä½¿ç”¨ asl_get æ–¹æ³•å°†å…¶è½¬æ¢ä¸º char å­—ç¬¦ä¸²ç±»å‹ã€‚ç±»å‹è½¬æ¢ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>const char* messageCString = asl_get( msg, ASL_KEY_MSG );\n</code></pre><p>æ¥ä¸‹æ¥ï¼Œchar å­—ç¬¦ä¸²ä¼šè¢«è½¬æ¢æˆ NSStringç±»å‹ï¼ŒNSString æ˜¯ Objective-C é‡Œå­—ç¬¦ä¸²ç±»å‹ï¼Œè½¬æˆ NSString æ›´å®¹æ˜“åœ¨ Objective-C é‡Œä½¿ç”¨ã€‚</p><pre><code>NSString *message = @(messageCString);\n</code></pre><p>å› ä¸ºCocoaLumberjack çš„æ—¥å¿—æœ€åéƒ½æ˜¯é€šè¿‡ DDLog:log:message: æ–¹æ³•è¿›è¡Œè®°å½•çš„ï¼Œå…¶ä¸­ message å‚æ•°çš„ç±»å‹æ˜¯ DDLogMessageï¼Œæ‰€ä»¥ NSStringç±»å‹è¿˜éœ€è¦è½¬æ¢æˆ DDLogMessage ç±»å‹ã€‚</p><p>å› ä¸º DDLogMessage ç±»å‹åŒ…å«äº†æ—¥å¿—çº§åˆ«ï¼Œæ‰€ä»¥è½¬æ¢ç±»å‹åè¿˜éœ€è¦è®¾ç½®æ—¥å¿—çš„çº§åˆ«ã€‚CocoaLumberjack è¿™ä¸ªç¬¬ä¸‰æ–¹æ—¥å¿—åº“ï¼Œå°†æ•è·åˆ°çš„ NSLog æ—¥å¿—çš„çº§åˆ«è®¾ç½®ä¸ºäº† Verboseã€‚é‚£ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾ç½®å‘¢ï¼Ÿ</p><p>CocoaLumberjack çš„æ—¥å¿—çº§åˆ«ï¼ŒåŒ…æ‹¬ä¸¤ç±»ï¼š</p><ul>\n<li>ç¬¬ä¸€ç±»æ˜¯Verbose å’Œ Debug ï¼Œå±äºè°ƒè¯•çº§ï¼›</li>\n<li>ç¬¬äºŒç±»æ˜¯Infoã€Warnã€Error ï¼Œå±äºæ­£å¼çº§ï¼Œé€‚ç”¨äºè®°å½•æ›´é‡è¦çš„ä¿¡æ¯ï¼Œæ˜¯éœ€è¦æŒä¹…åŒ–å­˜å‚¨çš„ã€‚ç‰¹åˆ«æ˜¯ï¼ŒErrorå¯ä»¥ç†è§£ä¸ºä¸¥é‡çº§åˆ«æœ€é«˜ã€‚</li>\n</ul><p>å°†æ—¥å¿—çº§åˆ«å®šä¹‰ä¸º Verboseï¼Œä¹Ÿåªæ˜¯åŸºäºCocoaLumberjack å¯¹ NSLogæ—¥å¿—çš„ç†è§£ã€‚å…¶å®ï¼ŒNSLogæ˜¯è¢«è‹¹æœå…¬å¸ä¸“é—¨å®šä¹‰ä¸ºè®°å½•é”™è¯¯ä¿¡æ¯çš„ï¼š</p><blockquote>\n<p>Logs an error message to the Apple System Log facility.</p>\n</blockquote><p>æ®æˆ‘è§‚å¯Ÿï¼Œç°åœ¨æœ‰å¾ˆå¤šå¼€å‘è€…éƒ½ç”¨ NSLog æ¥è°ƒè¯•ã€‚<strong>ä½†æ˜¯æˆ‘è§‰å¾—ï¼Œä¸€èˆ¬çš„ç¨‹åºè°ƒè¯•ï¼Œç”¨æ–­ç‚¹å°±å¥½äº†ï¼Œæˆ‘ä¸æ¨èä½ æŠŠ NSLog ä½œä¸ºä¸€ç§è°ƒè¯•æ‰‹æ®µã€‚</strong>å› ä¸ºï¼Œä½¿ç”¨NSLogè°ƒè¯•ï¼Œä¼šå‘ç”Ÿ IO ç£ç›˜æ“ä½œï¼Œå½“é¢‘ç¹ä½¿ç”¨ NSLog æ—¶ï¼Œæ€§èƒ½å°±ä¼šå˜å¾—ä¸å¥½ã€‚å¦å¤–ï¼Œå„å›¢é˜Ÿéƒ½ä½¿ç”¨ NSLog æ¥è°ƒè¯•çš„è¯å¾ˆå®¹æ˜“å°±ä¼šåˆ·å±ï¼Œè¿™æ ·ä½ ä¹Ÿæ²¡æœ‰åŠæ³•åœ¨æ§åˆ¶å°ä¸Šå¿«é€Ÿã€å‡†ç¡®åœ°æ‰¾åˆ°ä½ è‡ªå·±çš„è°ƒè¯•ä¿¡æ¯ã€‚</p><p>è€Œå¦‚æœä½ éœ€è¦æ±‡æ€»ä¸€æ®µæ—¶é—´çš„è°ƒè¯•æ—¥å¿—çš„è¯ï¼Œè‡ªå·±æŠŠè¿™äº›æ—¥å¿—å†™åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œå°±å¥½äº†ã€‚è¿™æ ·çš„è¯ï¼Œä½ éšä¾¿æƒ³è¦æ€ä¹ˆçœ‹éƒ½è¡Œï¼Œä¹Ÿä¸ä¼šå‚æ‚å…¶ä»–äººæ‰“çš„æ—¥å¿—ã€‚</p><p>æ‰€ä»¥è¯´ ï¼ŒCocoaLumberjack å°† NSLog è®¾ç½®ä¸º Verbose ï¼Œåœ¨æˆ‘çœ‹æ¥ CocoaLumberjack å¯¹ NSLog çš„ç†è§£ä¹Ÿä¸å¤Ÿå‡†ç¡®ã€‚è¯´å®Œå¦‚ä½•åˆ›å»ºä¸€ä¸ª DDLogMessageï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†çœ‹çœ‹<strong>å¦‚ä½•é€šè¿‡ DDLog ä½¿ç”¨ DDLogMessage ä½œä¸ºå‚æ•°æ·»åŠ ä¸€æ¡ ASL æ—¥å¿—</strong>ã€‚ä¸‹é¢æ˜¯ DDLog è®°å½• ASL æ—¥å¿—ç›¸å…³çš„ä»£ç ï¼š</p><pre><code>DDLogMessage *logMessage = [[DDLogMessage alloc] initWithMessage:message level:_captureLevel flag:flag context:0 file:@&quot;DDASLLogCapture&quot; function:nil line:0 tag:nil option:0 timestamp:timeStamp];\n\n[DDLog log:async message:logMessage]\n</code></pre><p>åˆ°è¿™é‡Œï¼Œé€šè¿‡ASLè·å– NSLog æ—¥å¿—çš„è¿‡ç¨‹ä½ å°±åº”è¯¥å¾ˆæ¸…æ¥šäº†ã€‚ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ CocoaLumberjack è¿™ä¸ªåº“é€šè¿‡ [DDASLLogCapture start] æ•è·æ‰€æœ‰ NSLog çš„æ—¥å¿—ã€‚</p><p>ä½ ç°åœ¨å·²ç»æ¸…æ¥šäº†CocoaLumberjack çš„æ•è·åŸç†å’Œæ–¹æ³•ï¼Œå¦‚æœä¸æƒ³å¼•å…¥è¿™ä¸ªç¬¬ä¸‰æ–¹åº“çš„è¯ï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§å®ƒçš„æ€è·¯å†™ä¸ªç®€åŒ–ç‰ˆçš„å·¥å…·å‡ºæ¥ï¼Œåªè¦è¿™ä¸ªå·¥å…·èƒ½å¤ŸæŠŠæ—¥å¿—è®°å½•ä¸‹æ¥ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨å‡ºç°é—®é¢˜çš„æ—¶å€™ï¼ŒæŠŠæ—¥å¿—ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œæ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œé—®é¢˜çš„è¿½è¸ªå’Œå®šä½å³å¯ã€‚</p><p>ä¸ºäº†ä½¿æ—¥å¿—æ›´é«˜æ•ˆï¼Œæ›´æœ‰ç»„ç»‡ï¼Œåœ¨ iOS 10 ä¹‹åï¼Œä½¿ç”¨äº†æ–°çš„ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿï¼ˆUnified Logging Systemï¼‰æ¥è®°å½•æ—¥å¿—ï¼Œå…¨é¢å–ä»£ ASLçš„æ–¹å¼ã€‚ä»¥ä¸‹æ˜¯å®˜æ–¹åŸè¯ï¼š</p><blockquote>\n<p>Unified logging is available in iOS 10.0 and later, macOS 10.12 and later, tvOS 10.0 and later, and watchOS 3.0 and later, and supersedes ASL (Apple System Logger) and the Syslog APIs. Historically, log messages were written to specific locations on disk, such as /etc/system.log. The unified logging system stores messages in memory and in a data store, rather than writing to text-based log files.</p>\n</blockquote><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±çœ‹çœ‹iOS 10ä¹‹åï¼Œå¦‚ä½•æ¥è·å–NSLogæ—¥å¿—ã€‚</p><p>ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿçš„æ–¹å¼ï¼Œæ˜¯æŠŠæ—¥å¿—é›†ä¸­å­˜æ”¾åœ¨å†…å­˜å’Œæ•°æ®åº“é‡Œï¼Œå¹¶æä¾›å•ä¸€ã€é«˜æ•ˆå’Œé«˜æ€§èƒ½çš„æ¥å£å»è·å–ç³»ç»Ÿæ‰€æœ‰çº§åˆ«çš„æ¶ˆæ¯ä¼ é€’ã€‚</p><p>macOS 10.12 å¼€å§‹ä½¿ç”¨äº†ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿï¼Œæˆ‘ä»¬é€šè¿‡æ§åˆ¶å°åº”ç”¨ç¨‹åºæˆ–æ—¥å¿—å‘½ä»¤è¡Œå·¥å…·ï¼Œå°±å¯ä»¥æŸ¥çœ‹åˆ°æ—¥å¿—æ¶ˆæ¯ã€‚</p><p>ä½†æ˜¯ï¼Œæ–°çš„ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿæ²¡æœ‰ ASL é‚£æ ·çš„æ¥å£å¯ä»¥è®©æˆ‘ä»¬å–å‡ºå…¨éƒ¨æ—¥å¿—ï¼Œæ‰€ä»¥<strong>ä¸ºäº†å…¼å®¹æ–°çš„ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿï¼Œä½ å°±éœ€è¦å¯¹ NSLog æ—¥å¿—çš„è¾“å‡ºè¿›è¡Œé‡å®šå‘ã€‚</strong></p><p>å¯¹NSLogè¿›è¡Œé‡å®šå‘ï¼Œæˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯é‡‡ç”¨ Hook çš„æ–¹å¼ã€‚å› ä¸ºNSLogæœ¬èº«å°±æ˜¯ä¸€ä¸ªCå‡½æ•°ï¼Œè€Œä¸æ˜¯ Objective-Cæ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ fishhook æ¥å®Œæˆé‡å®šå‘çš„å·¥ä½œã€‚å…·ä½“çš„å®ç°ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>static void (&amp;orig_nslog)(NSString *format, ...);\n\nvoid redirect_nslog(NSString *format, ...) {\n    // å¯ä»¥åœ¨è¿™é‡Œå…ˆè¿›è¡Œè‡ªå·±çš„å¤„ç†\n    \n    // ç»§ç»­æ‰§è¡ŒåŸ NSLog\n    va_list va;\n    va_start(va, format);\n    NSLogv(format, va);\n    va_end(va);\n}\n\nint main(int argc, const char * argv[]) {\n    @autoreleasepool {\n        struct rebinding nslog_rebinding = {&quot;NSLog&quot;,redirect_nslog,(void*)&amp;orig_nslog};\n\n        NSLog(@&quot;try redirect nslog %@,%d&quot;,@&quot;is that ok?&quot;);\n    }\n    return\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘åœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œåˆ©ç”¨äº† fishhook å¯¹æ–¹æ³•çš„ç¬¦å·åœ°å€è¿›è¡Œäº†é‡æ–°ç»‘å®šï¼Œä»è€Œåªè¦æ˜¯ NSLog çš„è°ƒç”¨å°±éƒ½ä¼šè½¬å‘ redirect_nslog æ–¹æ³•è°ƒç”¨ã€‚</p><p>åœ¨ redirect_nslog æ–¹æ³•ä¸­ï¼Œä½ å¯ä»¥å…ˆè¿›è¡Œè‡ªå·±çš„å¤„ç†ï¼Œæ¯”å¦‚å°†æ—¥å¿—çš„è¾“å‡ºé‡æ–°è¾“å‡ºåˆ°è‡ªå·±çš„æŒä¹…åŒ–å­˜å‚¨ç³»ç»Ÿé‡Œï¼Œæ¥ç€è°ƒç”¨ NSLog ä¹Ÿä¼šè°ƒç”¨çš„ NSLogv æ–¹æ³•è¿›è¡ŒåŸ NSLog æ–¹æ³•çš„è°ƒç”¨ã€‚å½“ç„¶äº†ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ fishhook æä¾›çš„åŸæ–¹æ³•è°ƒç”¨æ–¹å¼ orig_nslogï¼Œè¿›è¡ŒåŸ NSLog æ–¹æ³•çš„è°ƒç”¨ã€‚ä¸Šé¢ä»£ç é‡Œä¹Ÿå·²ç»å£°æ˜äº†ç±» orig_nslogï¼Œç›´æ¥è°ƒç”¨å³å¯ã€‚</p><p>NSLog æœ€åå†™æ–‡ä»¶æ—¶çš„å¥æŸ„æ˜¯ STDERRï¼Œæˆ‘å…ˆå‰è·Ÿä½ è¯´äº†è‹¹æœå¯¹äº NSLog çš„å®šä¹‰æ˜¯è®°å½•é”™è¯¯çš„ä¿¡æ¯ï¼ŒSTDERR çš„å…¨ç§°æ˜¯ standard errorï¼Œç³»ç»Ÿé”™è¯¯æ—¥å¿—éƒ½ä¼šé€šè¿‡ STDERR å¥æŸ„æ¥è®°å½•ï¼Œæ‰€ä»¥ NSLog æœ€ç»ˆå°†é”™è¯¯æ—¥å¿—è¿›è¡Œå†™æ“ä½œçš„æ—¶å€™ä¹Ÿä¼šä½¿ç”¨ STDERR å¥æŸ„ï¼Œè€Œ dup2 å‡½æ•°æ˜¯ä¸“é—¨è¿›è¡Œæ–‡ä»¶é‡å®šå‘çš„ï¼Œé‚£ä¹ˆä¹Ÿå°±æœ‰äº†å¦ä¸€ä¸ªä¸ä½¿ç”¨ fishhook è¿˜å¯ä»¥æ•è· NSLog æ—¥å¿—çš„æ–¹æ³•ã€‚ä½ å¯ä»¥ä½¿ç”¨ dup2 é‡å®šå‘ STDERR å¥æŸ„ï¼Œä½¿å¾—é‡å®šå‘çš„ä½ç½®å¯ä»¥ç”±ä½ æ¥æ§åˆ¶ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>int fd = open(path, (O_RDWR | O_CREAT), 0644);\ndup2(fd, STDERR_FILENO);\n</code></pre><p>å…¶ä¸­ï¼Œpath å°±æ˜¯ä½ è‡ªå®šä¹‰çš„é‡å®šå‘è¾“å‡ºçš„æ–‡ä»¶åœ°å€ã€‚</p><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿè·å–åˆ°å„ä¸ªç³»ç»Ÿç‰ˆæœ¬çš„ NSLogäº†ã€‚é‚£ä¹ˆï¼Œé€šè¿‡å…¶ä»–æ–¹å¼æ‰“çš„æ—¥å¿—ï¼Œæˆ‘ä»¬æ€ä¹ˆæ‰èƒ½è·å–åˆ°å‘¢ï¼Ÿ</p><p>ç°åœ¨ä¸æ—¥å¿—ç›¸å…³çš„ç¬¬ä¸‰æ–¹åº“é‡Œé¢ï¼Œä½¿ç”¨æœ€å¤šçš„å°±æ˜¯ CocoaLumberjackã€‚è€Œä¸”ï¼Œå…¶ä»–çš„å¾ˆå¤šç¬¬ä¸‰åº“çš„æ€è·¯ä¹Ÿå’ŒCocoaLumberjackç±»ä¼¼ï¼Œéƒ½æ˜¯ç›´æ¥åœ¨ CocoaLumberjack çš„åŸºç¡€ä¸ŠåŒ…è£…äº†ä¸€å±‚ï¼Œå¢åŠ äº†ç»Ÿä¸€ç®¡æ§åŠ›å’Œæ˜“ç”¨æ€§è€Œå·²ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å…ˆçœ‹çœ‹ CocoaLumberjack çš„æ•´ä½“æ¶æ„æ˜¯æ€æ ·çš„ï¼Œè¿›è€Œæ‰¾åˆ°è·å– CocoaLumberjack æ‰€æœ‰æ—¥å¿—çš„æ–¹æ³•ã€‚</p><h2>è·å– CocoaLumberjack æ—¥å¿—</h2><p>CocoaLumberjackä¸»è¦ç”±DDLogã€DDLogerã€DDLogFormatterå’ŒDDLogMessageå››éƒ¨åˆ†ç»„æˆï¼Œå…¶æ•´ä½“æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/ff/fb/ff12f684d74be1b901e2dede5b5ab5fb.png?wh=1435*679\" alt=\"\"></p><p>åœ¨è¿™å…¶ä¸­ï¼ŒDDLog æ˜¯ä¸ªå…¨å±€çš„å•ä¾‹ç±»ï¼Œä¼šä¿å­˜ DDLogger åè®®çš„ loggerï¼›DDLogFormatter ç”¨æ¥æ ¼å¼åŒ–æ—¥å¿—çš„æ ¼å¼ï¼›DDLogMessage æ˜¯å¯¹æ—¥å¿—æ¶ˆæ¯çš„ä¸€ä¸ªå°è£…ï¼›DDLogger åè®®æ˜¯ç”± DDAbstractLogger å®ç°çš„ã€‚logger éƒ½æ˜¯ç»§æ‰¿äº DDAbstractLoggerï¼š</p><ul>\n<li>æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°æ˜¯é€šè¿‡ DDTTYLoggerå®ç°çš„ï¼›</li>\n<li>DDASLLogger å°±æ˜¯ç”¨æ¥æ•è· NSLog è®°å½•åˆ° ASL æ•°æ®åº“çš„æ—¥å¿—ï¼›</li>\n<li>DDAbstractDatabaseLoggeræ˜¯æ•°æ®åº“æ“ä½œçš„æŠ½è±¡æ¥å£ï¼›</li>\n<li>DDFileLogger æ˜¯ç”¨æ¥ä¿å­˜æ—¥å¿—åˆ°æ–‡ä»¶çš„ï¼Œè¿˜æä¾›äº†è¿”å› CocoaLumberjack æ—¥å¿—ä¿å­˜æ–‡ä»¶è·¯å¾„çš„æ–¹æ³•ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</li>\n</ul><pre><code>DDFileLogger *fileLogger = [[DDFileLogger alloc] init];\nNSString *logDirectory = [fileLogger.logFileManager logsDirectory];\n</code></pre><p>å…¶ä¸­ï¼ŒlogDirectory æ–¹æ³•å¯ä»¥è·å–æ—¥å¿—æ–‡ä»¶çš„ç›®å½•è·¯å¾„ã€‚æœ‰äº†ç›®å½•ä»¥åï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å–åˆ°ç›®å½•ä¸‹æ‰€æœ‰çš„ CocoaLumberjack çš„æ—¥å¿—äº†ï¼Œä¹Ÿå°±è¾¾åˆ°äº†æˆ‘ä»¬è¦è·å–CocoaLumberjack æ‰€æœ‰æ—¥å¿—çš„ç›®çš„ã€‚</p><h2>å°ç»“</h2><p>åœ¨ä»Šå¤©è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å’Œä½ ä»‹ç»äº† NSLog å’Œ CocoaLumberjack æ—¥å¿—çš„è·å–æ–¹æ³•ã€‚è¿™ä¸¤ç§æ‰“æ—¥å¿—çš„æ–¹å¼åŸºæœ¬è¦†ç›–äº†å¤§éƒ¨åˆ†åœºæ™¯ï¼Œä½ åœ¨ä½¿ç”¨å…¶ä»–æ—¥å¿—åº“æ—¶ï¼Œåªè¦æ‰¾åˆ°æ—¥å¿—å­˜å‚¨çš„ç›®å½•ï¼Œå°±å¯ä»¥è¿›è¡Œæ—¥å¿—çš„æ”¶é›†åˆå¹¶å·¥ä½œäº†ã€‚</p><p>æ”¶é›†å…¨é‡æ—¥å¿—ï¼Œå¯ä»¥æé«˜åˆ†æå’Œè§£å†³é—®é¢˜çš„æ•ˆç‡ï¼ŒèŠ‚çœä¸‹æ¥çš„æ—¶é—´æˆ‘ä»¬å¯ä»¥å»åšæ›´æœ‰æ„ä¹‰çš„äº‹æƒ…ã€‚</p><p>åœ¨ä»Šå¤©è®²è·å– NSLog æ—¥å¿—çš„è¿‡ç¨‹ä¸­ï¼Œä½ ä¼šå‘ç°ä¸ºäº†è¾¾åˆ°è·å– NSLog æ—¥å¿—çš„ç›®çš„ï¼Œæ–¹æ³•æœ‰ä¸‰ä¸ªï¼š</p><ul>\n<li>ç¬¬ä¸€ä¸ªæ˜¯ä½¿ç”¨å®˜æ–¹æä¾›çš„æ¥å£ ASL æ¥è·å–ï¼›</li>\n<li>ç¬¬äºŒä¸ªæ˜¯é€šè¿‡ä¸€æ‹›åƒéå¤©ä¸‹çš„ fishhook æ¥ hook çš„æ–¹æ³•ï¼›</li>\n<li>ç¬¬ä¸‰ä¸ªæ–¹æ³•ï¼Œéœ€è¦ç”¨åˆ° dup2 å‡½æ•°å’Œ STDERR å¥æŸ„ã€‚æˆ‘ä»¬åªæœ‰äº†è§£äº†è¿™äº›çŸ¥è¯†ç‚¹åï¼Œæ‰ä¼šæƒ³åˆ°è¿™ä¸ªæ–¹æ³•ã€‚</li>\n</ul><p>åœ¨ç¬¬2ç¯‡æ–‡ç« â€œ<a href=\"https://time.geekbang.org/column/article/85331\">App å¯åŠ¨é€Ÿåº¦æ€ä¹ˆåšä¼˜åŒ–ä¸ç›‘æ§ï¼Ÿ</a>â€é‡Œï¼Œæˆ‘ä¹Ÿæåˆ°è¿‡ä¸¤ä¸ªæ–¹æ¡ˆæ¥å®ç°å¯åŠ¨ç›‘æ§ã€‚å…¶ä¸­ï¼Œç¬¬äºŒä¸ªä½¿ç”¨ hook objc_msgSend æ–¹æ³•çš„æ–¹æ¡ˆï¼Œçœ‹èµ·æ¥è¿æ±‡ç¼–è¯­è¨€éƒ½ç”¨åˆ°äº†ï¼Œåº”è¯¥æ²¡æœ‰æ›´å¥½çš„æ–¹æ¡ˆäº†å§ï¼Œå…¶å®ä¸ç„¶ï¼Œæˆ‘è¿™é‡Œå–ä¸ªå…³å­ï¼Œåé¢æœ‰æœºä¼šæˆ‘è¿˜ä¼šå’Œä½ ä»‹ç»å¦ä¸€ä¸ªæ–¹æ¡ˆã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬æ¥è§¦çš„çŸ¥è¯†é¢è¶Šå¤šï¼Œé‡åˆ°é—®é¢˜æ—¶èƒ½æƒ³åˆ°çš„åŠæ³•ä¹Ÿå°±ä¼šè¶Šå¤šã€‚å½“å‡ºç°æ„å¤–æ—¶ï¼Œå°±åƒæ˜¯ ASL åœ¨ iOS 10.0 ä¹‹åä¸èƒ½ç”¨äº†è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¾ç„¶è¿˜èƒ½å¤Ÿæœ‰å…¶ä»–æ–¹æ³•æ¥è§£å†³é—®é¢˜ã€‚</p><h2>è¯¾åä½œä¸š</h2><p>ä»Šå¤©è¯¾ç¨‹ä¸­æåˆ°äº†è·¨è¿›ç¨‹é€šçŸ¥ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±è¯·ä½ å†™ä¸€ä¸ªç›‘å¬ç”¨æˆ·è®¾å¤‡ç£ç›˜ç©ºé—´ä¸å¤Ÿæ—¶ï¼Œæ¸…ç†App ç¼“å­˜æ–‡ä»¶çš„åŠŸèƒ½å§ã€‚</p><p>æˆ‘ä»Šå¤©è¿˜ä¼šå†å¤šå¸ƒç½®ä¸€ä¸ªä½œä¸šã€‚æˆ‘åœ¨å’Œä½ åˆ†ææ•è· NSLog æ—¥å¿—æ—¶ï¼Œæåˆ°äº†ä¸€ä¸ªç”¨dup2æ›¿æ¢æ‰é»˜è®¤å¥æŸ„çš„æ–¹æ³•ã€‚æ‰€ä»¥ï¼Œæˆ‘å¸Œæœ›ä½ å¯ä»¥åŠ¨æ‰‹å®è·µä¸€ä¸‹ï¼ŒæŒ‰ç…§è¿™ä¸ªæ€è·¯å°†å…¶å®Œæ•´å®ç°å‡ºæ¥å§ã€‚</p><p>æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæ¬¢è¿ä½ åœ¨è¯„è®ºåŒºç»™æˆ‘ç•™è¨€åˆ†äº«ä½ çš„è§‚ç‚¹ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><p></p>","neighbors":{"left":{"article_title":"14 | ä¸´è¿‘ OOMï¼Œå¦‚ä½•è·å–è¯¦ç»†å†…å­˜åˆ†é…ä¿¡æ¯ï¼Œåˆ†æå†…å­˜é—®é¢˜ï¼Ÿ","id":89845},"right":{"article_title":"16 | æ€§èƒ½ç›‘æ§ï¼šè¡¡é‡ App è´¨é‡çš„é‚£æŠŠå°º","id":90546}},"comments":[{"had_liked":false,"id":85600,"user_name":"Geek_97bcf5","can_delete":false,"product_type":"c1","uid":1452522,"ip_address":"","ucode":"76033700AF11AD","user_header":"","comment_is_top":false,"comment_ctime":1555138298,"is_pvip":false,"replies":[{"id":"30738","content":"å¯¹ï¼Œå¤§å‚éƒ½æœ‰è‡ªå·±çš„æ—¥å¿—æ¡†æ¶ã€‚å¯èƒ½æ˜¯ä¸€å¥—æˆ–è€…å¤šå¥—ã€‚ä¹Ÿæœ‰å¾ˆå¤šç›´æ¥åŒ…è£…äº†CocoaLumberjackã€‚åŠ è§£å¯†ä¸€èˆ¬éƒ½æ˜¯å®‰å…¨å›¢é˜Ÿç»Ÿä¸€å¤„ç†çš„ï¼Œä¸å…‰ç”¨åœ¨æ—¥å¿—ä¸Šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æˆ´é“­","uid":"1140280","ctime":1555146007,"ip_address":"","comment_id":85600,"utype":1}],"discussion_count":2,"race_medal":0,"score":"70274615034","product_id":100024501,"comment_content":"ä¸€èˆ¬å¤§å‚çš„appéƒ½ä¸ä¼šç”¨NSLogæ¥æ‰“å°æ—¥å¿—çš„ï¼Œæˆ‘ä¸çŸ¥é“æ»´æ»´æ‰“è½¦æ˜¯å¦ç”¨NSLogæ¥æ‰“å°æ—¥å¿—ï¼Œæ‰€ä»¥ï¼Œæœ¬æ–‡çš„æ–¹æ¡ˆå¹¶ä¸ç¬¦åˆç”Ÿäº§ç¯å¢ƒã€‚æ—¥å¿—æ˜¯éœ€è¦åˆ†ç±»çš„ï¼Œéœ€è¦å‹ç¼©ï¼Œéœ€è¦åŠ å¯†ï¼Œå®æ—¶æŸ“è‰²ç­‰ã€‚NSLogæ ¹æœ¬ä¸å¯èƒ½å®Œæˆè¿™äº›åŠŸèƒ½ï¼Œæ‰€ä»¥ï¼Œå¤§å‚çš„appéƒ½æœ‰ä¸“é—¨çš„æ—¥å¿—æ¡†æ¶ã€‚å„ä¸ªæ¨¡å—ä¸­ä¹Ÿä¸ä¼šç”¨NSLogæ¥è¾“å‡ºæ—¥å¿—ã€‚","like_count":17,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"æˆ´é“­","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446729,"discussion_content":"å¯¹ï¼Œå¤§å‚éƒ½æœ‰è‡ªå·±çš„æ—¥å¿—æ¡†æ¶ã€‚å¯èƒ½æ˜¯ä¸€å¥—æˆ–è€…å¤šå¥—ã€‚ä¹Ÿæœ‰å¾ˆå¤šç›´æ¥åŒ…è£…äº†CocoaLumberjackã€‚åŠ è§£å¯†ä¸€èˆ¬éƒ½æ˜¯å®‰å…¨å›¢é˜Ÿç»Ÿä¸€å¤„ç†çš„ï¼Œä¸å…‰ç”¨åœ¨æ—¥å¿—ä¸Šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555146007,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1472362,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKzr9iaXeQVuuQ8Johft4aPkpzHSNBCCt7ibSENZvVjrRo93icXlFBic56aTJmteLuyfDLBOhVBuIjLDQ/132","nickname":"é˜¿ä¸œ","note":"","ucode":"2C8E5BEEE25E7D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1992,"discussion_content":"è…¾è®¯å¾®ä¿¡é‡Œä½¿ç”¨çš„marsçš„Xlogï¼Œæ—¥å¿—è¿›è¡ŒåŠ å¯†äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563171615,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99818,"user_name":"daniel","can_delete":false,"product_type":"c1","uid":1370456,"ip_address":"","ucode":"3516AF7F9A4DEA","user_header":"https://static001.geekbang.org/account/avatar/00/14/e9/58/397a4ab2.jpg","comment_is_top":false,"comment_ctime":1559309464,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"31624080536","product_id":100024501,"comment_content":"static void(*orig_nslog) (NSString *format,...); è¿™é‡Œå£°æ˜çš„æ—¶å€™æ˜¯*å·ä¸æ˜¯&amp;å·ï¼Œå£°æ˜æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¼°è®¡è€å¸ˆé‚£è¾¹æ‰“é”™äº†<br>è¿˜æœ‰ä¸‹é¢è¿™æ®µä»£ç <br>va_list va;<br>    va_start(va,format);<br>    NSLogv(format, va);<br>    va_end(va);<br>å¯ä»¥æ¢æˆorig_nslog(format) ï¼Œè¿™æ—¶å€™æˆ‘ä»¬çš„orig_nslogå°±æ˜¯åŸæ¥NSLogåœ¨Mach-oä¸­çš„åœ°å€äº†ï¼Œè¿™æ—¶å€™å¯ä»¥ç›´æ¥æ‹¦æˆªä½¿ç”¨äº†ï¼Œè€å¸ˆå¸Œæœ›è¯¾é‡Œé¢ä»£ç å¯ä»¥æ£€æŸ¥ä»”ç»†ç‚¹å†å‘å‡ºæ¥ï¼Œå¥½å¤šæ¬¡ç›´æ¥æŠ¥é”™ï¼Œç„¶ååˆæ‰¾ä¸åˆ°åŸå› ï¼Œè¿™æ ·æŒºæ‰“å‡»äººçš„ã€‚ã€‚ã€‚è¿˜æœ‰æ³¨é‡Šå¯ä»¥å†æ¸…æ¥šç‚¹","like_count":8},{"had_liked":false,"id":86954,"user_name":"Ant","can_delete":false,"product_type":"c1","uid":1079563,"ip_address":"","ucode":"07E6374F91F61E","user_header":"https://static001.geekbang.org/account/avatar/00/10/79/0b/4346a253.jpg","comment_is_top":false,"comment_ctime":1555486801,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27325290577","product_id":100024501,"comment_content":"æ¸©æ•…è€ŒçŸ¥æ–°ï¼Œ å¯¹æˆ‘æ¥è¯´æ˜¯åè¿‡æ¥è¯´çš„ï¼Œ çŸ¥æ–°è€Œæ¸©æ•…ã€‚<br>mainå‡½æ•°æ‰§è¡Œä¹‹å‰  <br>åŠ è½½å¯æ‰§è¡Œæ–‡ä»¶ã€<br>åŠ è½½åŠ¨æ€é“¾æ¥åº“rebaseæŒ‡é’ˆè°ƒæ•´å’Œbindç¬¦å·ç»‘å®šã€<br>è¿è¡Œæ—¶å¼€å§‹å¤„ç†ï¼Œ<br>objcç±»æ³¨å†Œï¼Œcategoryæ³¨å†Œï¼Œselectorå”¯ä¸€æ€§æ£€æŸ¥ï¼Œ<br>loadæ–¹æ³•ï¼Œattributeä¿®é¥°å‡½æ•°è°ƒç”¨ï¼Œ<br>åˆ›å»ºc++é™æ€å…¨å±€å˜é‡","like_count":6},{"had_liked":false,"id":86603,"user_name":"jimbo","can_delete":false,"product_type":"c1","uid":1454555,"ip_address":"","ucode":"779DC4A912C55B","user_header":"https://static001.geekbang.org/account/avatar/00/16/31/db/77251f31.jpg","comment_is_top":false,"comment_ctime":1555408123,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10145342715","product_id":100024501,"comment_content":"static void (&amp;orig_nslog)(NSString *format, ...); è¿™é‡Œæ˜¯ä¸æ˜¯åº”è¯¥å˜æˆ static void (*orig_nslog)(NSString *format, ...);  ä¸ç„¶æŠ¥é”™","like_count":3},{"had_liked":false,"id":264446,"user_name":"jiang","can_delete":false,"product_type":"c1","uid":2132812,"ip_address":"","ucode":"952B16B7A41DBD","user_header":"https://static001.geekbang.org/account/avatar/00/20/8b/4c/ff8c53dc.jpg","comment_is_top":false,"comment_ctime":1606468970,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5901436266","product_id":100024501,"comment_content":"å®Œæˆç¬¬ä¸€æ¬¡ä½œä¸šï¼Œè¿™æ ·ä¾¿å¯ä»¥æ— ä¾µå…¥çš„å®ç°æ—¥å¿—ä¸ŠæŠ¥æƒ¹<br>- (void)viewDidLoad {<br>    [super viewDidLoad];<br>    [self outLog];<br>    [self writeMsg];<br><br>}<br><br>- (void)outLog{<br>    self.filePath = [NSString stringWithFormat:@&quot;%@&#47;Documents&#47;LOG&quot;, NSHomeDirectory()];<br>    [[NSFileManager defaultManager] createDirectoryAtPath:self.filePath  withIntermediateDirectories:YES attributes:nil error:nil];<br>    self.filePath = [self.filePath stringByAppendingString:@&quot;&#47;log.txt&quot;];<br>    [[NSFileManager defaultManager] createFileAtPath:self.filePath contents:nil attributes:nil];<br>    self.fileHandle =  [NSFileHandle fileHandleForWritingAtPath:self.filePath];<br>    int fileDesc = self.fileHandle.fileDescriptor;<br>    dup2(fileDesc, STDERR_FILENO);<br>}<br><br>int count = 0;<br><br>- (void)writeMsg{<br>    count ++;<br>    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{<br>        NSString *str = [NSString stringWithFormat:@&quot;+%d&quot;,count];<br>        [self writeMsg];<br>        NSLog(@&quot;%@&quot;,str);<br>    });<br>    <br>}<br>","like_count":1},{"had_liked":false,"id":208708,"user_name":"å°èµ¢ä¸€åœº","can_delete":false,"product_type":"c1","uid":1887743,"ip_address":"","ucode":"24A620542C0A45","user_header":"https://static001.geekbang.org/account/avatar/00/1c/cd/ff/b001b578.jpg","comment_is_top":false,"comment_ctime":1587426016,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5882393312","product_id":100024501,"comment_content":"ä¸å¤ªæ˜ç™½ï¼Œè·å–æ—¥å¿—ï¼Œæ€ä¹ˆä¸Šä¼ ï¼Œä»€ä¹ˆæ—¶å€™ä¸Šä¼ æ—¥å¿—åˆ°åå°","like_count":1},{"had_liked":false,"id":102104,"user_name":"dingdongfm","can_delete":false,"product_type":"c1","uid":1564213,"ip_address":"","ucode":"7D17D2BC392A66","user_header":"","comment_is_top":false,"comment_ctime":1560137046,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5855104342","product_id":100024501,"comment_content":"å¦‚æœéœ€è¦è·å–æœ€ç»ˆç”¨æˆ·æ‰‹æœºä¸Šçš„æ—¥å¿—æ¥å®šä½é—®é¢˜çš„è¯ï¼Œä¸€èˆ¬æ€ä¹ˆè·å–æ—¥å¿—ï¼Ÿ","like_count":1},{"had_liked":false,"id":89401,"user_name":"äºŒæœ¨åˆåœŸ","can_delete":false,"product_type":"c1","uid":1296963,"ip_address":"","ucode":"7D939045990B4D","user_header":"https://static001.geekbang.org/account/avatar/00/13/ca/43/63bdc516.jpg","comment_is_top":false,"comment_ctime":1556164402,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5851131698","product_id":100024501,"comment_content":"å¯¹Appæ¥è¯´ï¼Œç½‘ç»œè¯·æ±‚ä½¿ç”¨AFNetworkingï¼Œæ€ä¹ˆæŠŠç½‘ç»œè¯·æ±‚çš„logä¼˜é›…ç‚¹çš„è¿‡æ»¤æ‰“å°å‡ºæ¥ï¼Ÿå¦å¤–logï¼Œåœ¨æ§åˆ¶å°è¿˜ä¼šé‡åˆ°å­—ç¬¦ä¸²å¤ªé•¿æ˜¾ç¤ºè¢«æˆªæ–­çš„é—®é¢˜","like_count":1},{"had_liked":false,"id":85717,"user_name":"lhjzzu","can_delete":false,"product_type":"c1","uid":1463699,"ip_address":"","ucode":"460E35EDF61D62","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/b4oNLTaYfCBibPibneZVz8GqiciavzhbloQicwoIMz8E9cJibjLpOmibOrWYiamKXXwqDWicWwgCZOawlOte6icJkn3iby8GQ/132","comment_is_top":false,"comment_ctime":1555211678,"is_pvip":false,"replies":[{"id":"30817","content":"èµ","user_name":"ä½œè€…å›å¤","user_name_real":"æˆ´é“­","uid":"1140280","ctime":1555213925,"ip_address":"","comment_id":85717,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5850178974","product_id":100024501,"comment_content":"ä¸Šå‘¨æ‰ç¬¬ä¸€æ¬¡ç”¨CocoaLumberjackåšäº†æ—¥å¿—ç³»ç»Ÿï¼Œå¹¶ä¸”çœ‹äº†fishhookçš„åŸç†ï¼Œè¿™æ¬¡çœ‹è¿™ç¯‡æ–‡ç« å°±å…¨ç”¨ä¸Šäº†ï¼Œå¤ªniceäº†ï¼Œå¯¹ä¸¤è€…çš„ä½¿ç”¨å’Œç†è§£æ›´æ·±äº†ã€‚å“ˆå“ˆğŸ˜„","like_count":1,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"æˆ´é“­","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446778,"discussion_content":"èµ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555213925,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":85607,"user_name":"drunkenMouse","can_delete":false,"product_type":"c1","uid":1454037,"ip_address":"","ucode":"AA8CEA703ECBE8","user_header":"","comment_is_top":false,"comment_ctime":1555139095,"is_pvip":false,"replies":[{"id":"30736","content":"CocoaLumberJack å…¶ä»–æ—¥å¿—ä¸å—å½±å“","user_name":"ä½œè€…å›å¤","user_name_real":"æˆ´é“­","uid":"1140280","ctime":1555145772,"ip_address":"","comment_id":85607,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5850106391","product_id":100024501,"comment_content":"ASLåœ¨iOS10.0ä¹‹åæ²¡æ³•ç”¨äº†ã€‚æ‰€ä»¥CocoaLumberJackæ— æ³•è·å–åˆ°æ‰€æœ‰çš„æ—¥å¿—ï¼Œä½†é™¤äº†NSLogæ—¥å¿—å¤–ï¼Œåˆ«çš„æ—¥å¿—éƒ½èƒ½è·å–åˆ°å—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"æˆ´é“­","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446733,"discussion_content":"CocoaLumberJack å…¶ä»–æ—¥å¿—ä¸å—å½±å“","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555145772,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":85606,"user_name":"drunkenMouse","can_delete":false,"product_type":"c1","uid":1454037,"ip_address":"","ucode":"AA8CEA703ECBE8","user_header":"","comment_is_top":false,"comment_ctime":1555138996,"is_pvip":false,"replies":[{"id":"30737","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","user_name_real":"æˆ´é“­","uid":"1140280","ctime":1555145819,"ip_address":"","comment_id":85606,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5850106292","product_id":100024501,"comment_content":"æ‰€ä»¥ï¼Œå‡ ä¸ªäººçš„å°å›¢é˜Ÿç›´æ¥ä½¿ç”¨ç»Ÿä¸€çš„æ—¥å¿—åº“å°±å¯ä»¥äº†ï¼Ÿ<br><br>syslogdæ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œä¿æŠ¤ç³»ç»Ÿæ¥æ”¶åˆ†å‘æ—¥å¿—æ¶ˆæ¯çš„è¿›ç¨‹ï¼Ÿ<br><br>CocoaLumberJackè¿™æ®µæœ‰ç‚¹ä¹±ï¼Œæ•´ç†äº†ä¸€ä¸‹ï¼š<br><br>captureAslLogsæ–¹æ³•å¯¹ASLæ—¥å¿—çš„å¤„ç†æªæ–½æ˜¯ï¼šå°†æ—¥å¿—æ¶ˆæ¯è½¬æ¢æˆchar * å­—ç¬¦ä¸²ç±»å‹ï¼Œç„¶åå†è½¬æˆNSStringç±»å‹ï¼Œéšåå°†å…¶è®°å½•ã€‚ <br>è®°å½•ä½¿ç”¨DDLogï¼šlogï¼šmessageï¼šæ–¹æ³•ã€‚<br>è®°å½•æ—¶éœ€è¦å°†NSStringè½¬æˆDDLogMessageç±»å‹ï¼Œè€ŒDDLogMessageè®¾ç½®äº†æ—¥å¿—çº§åˆ«ï¼Œæ‰€ä»¥è½¬æ¢ç±»å‹åä¹Ÿè¦è®¾ç½®æ—¥å¿—çº§åˆ«ã€‚<br><br>NSLogçš„æ—¥å¿—çº§åˆ«æ˜¯Verboseã€‚<br><br>æœ€åï¼ŒiOS10ä¹‹åï¼Œä¸ºäº†å…¼å®¹æ–°çš„ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿï¼Œéœ€è¦å¯¹NSLogæ—¥å¿—çš„è¾“å‡ºè¿›è¡Œé‡å®šå‘ã€‚iOS10ä¹‹åCocoaLumberJackè·å–ä¸åˆ°NSLogçš„æ—¥å¿—äº†ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"æˆ´é“­","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446732,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555145819,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":334546,"user_name":"Geek_ecfaae","can_delete":false,"product_type":"c1","uid":2865888,"ip_address":"","ucode":"5A2CB38ABAB138","user_header":"","comment_is_top":false,"comment_ctime":1644996244,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1644996244","product_id":100024501,"comment_content":"iOS10ä¹‹åï¼ŒASLå·²ç»è¢«å–ä»£äº†ã€‚é‚£ç£ç›˜ç›‘æ§å°±ä¸èƒ½ç”¨kNotifyVFSLowDiskSpaceäº†å§ï¼Ÿ","like_count":0},{"had_liked":false,"id":238790,"user_name":"zhonglaoban","can_delete":false,"product_type":"c1","uid":1160792,"ip_address":"","ucode":"F570E9D65EC004","user_header":"https://static001.geekbang.org/account/avatar/00/11/b6/58/f0cb60be.jpg","comment_is_top":false,"comment_ctime":1596298314,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596298314","product_id":100024501,"comment_content":"æ‰€ä»¥nslogèƒ½è¾“å‡ºæ—¥å¿—åˆ°console.appé‡Œé¢æ˜¯å› ä¸ºç”¨äº†aslï¼Ÿ","like_count":1},{"had_liked":false,"id":164302,"user_name":"å¤§å¹´åˆä¸€","can_delete":false,"product_type":"c1","uid":1093005,"ip_address":"","ucode":"AE2AE59763BFCA","user_header":"https://static001.geekbang.org/account/avatar/00/10/ad/8d/3b2ac759.jpg","comment_is_top":false,"comment_ctime":1576929416,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576929416","product_id":100024501,"comment_content":"å¾®ä¿¡çš„ xlog ä¹Ÿä¸é”™","like_count":0},{"had_liked":false,"id":100234,"user_name":"mersa","can_delete":false,"product_type":"c1","uid":1330156,"ip_address":"","ucode":"A9F0B2FF9457C9","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epzwbJGbUmgEC77J6QY6A5pLPdPbw7sqk4DcsHK8qPw7OiaiaMD7pjzb8uHlkY5uLZRibWVvPDDAgM5A/132","comment_is_top":false,"comment_ctime":1559489430,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559489430","product_id":100024501,"comment_content":"å†™æ–‡ä»¶ä¸æ˜¯è€—ç”µï¼Œè¿˜æœ‰å½±å“appè¿è¡Œæ€§èƒ½ä¹ˆã€‚è¿™ä¸ªäº§çº¿æƒ…å†µæ€ä¹ˆèƒ½å¤Ÿä¿å­˜å…¨é‡æ—¥å¿—åŒæ—¶æ€§èƒ½å’Œè€—ç”µéƒ½èƒ½æœ€ä½","like_count":1},{"had_liked":false,"id":87592,"user_name":"lianleven","can_delete":false,"product_type":"c1","uid":1144924,"ip_address":"","ucode":"B1869F318F6188","user_header":"https://static001.geekbang.org/account/avatar/00/11/78/5c/ab80250d.jpg","comment_is_top":false,"comment_ctime":1555638777,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555638777","product_id":100024501,"comment_content":"è€å¸ˆé—®ä¸ªé—®é¢˜:å¦‚æœæœåŠ¡ç«¯å‡ ä¹åŒæ—¶åˆ°è¾¾å®¢æˆ·ç«¯1000æ¡æ¶ˆæ¯ï¼Œè¿™ä¸ªæ—¶å€™è¯¥å¦‚ä½•ç”¨å¤šçº¿ç¨‹å¤„ç†","like_count":0},{"had_liked":false,"id":87264,"user_name":"James","can_delete":false,"product_type":"c1","uid":1456416,"ip_address":"","ucode":"8FBA4F0CB59837","user_header":"","comment_is_top":false,"comment_ctime":1555555307,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1555555307","product_id":100024501,"comment_content":"å› ä¸ºå›¢é˜Ÿä¸å¤§,é¡¹ç›®æ—¥å¿—é‡‡ç”¨çš„æ–¹å¼ä¸ºfreopené‡å®šå‘stderrç±»å‹çš„æ—¥å¿—åˆ°æœ¬åœ°æ–‡ä»¶çš„æ–¹å¼,å¹¶æ²¡æœ‰å¼•å…¥ä¸‰æ–¹åº“,è¯·é—®è¿™ç§æ–¹å¼æœ‰ä»€ä¹ˆç¼ºç‚¹?<br>å¦å¤–å¤§å‚çš„æ‰€è°“æ—¥å¿—æ¡†æ¶å…·ä½“æ˜¯æ€ä¹ˆè®°å½•æ—¥å¿—çš„?éš¾é“åº•å±‚å®ç°å®Œå…¨ä¸ç”¨NSLogæˆ–printå—?","like_count":0,"discussions":[{"author":{"id":2727584,"avatar":"https://static001.geekbang.org/account/avatar/00/29/9e/a0/24ee6760.jpg","nickname":"æ— çŠ¶æ€","note":"","ucode":"C7828A81542121","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578570,"discussion_content":"å»å¤§å‚ä¸Šä¸ªç­å°±çŸ¥é“å¤§å‚çš„å„ç§æ¡†æ¶äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656904760,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}