{"id":179661,"title":"11 | 性能测试的工具：七大测试场景如何选择高质量的测试工具？","content":"<p>你好，我是庄振运。</p><p>我们在前面两讲讨论了如何进行性能测试的规划和设计。性能测试离不开合适的工具，那么这一讲，我们来讨论一下测试工具的分类和构成，并根据七个不同的测试场景，分别学习几个常用的高质量测试工具，尤其是开源的。</p><p>这七个测试场景分别是：Web测试、系统测试、数据库测试、文件IO测试、存储测试、网络测试以及移动App测试。</p><p>我们应该尽量借助这些好用的工具，而不要自己去重新开发。</p><p>自己开发的话，费时费力不说，开发出来的工具也不见得会比这些工具好用。更重要的是，性能测试工具的开发和使用过程中，有很多需要注意的地方和容易陷入的坑，一不小心就会掉坑。我们下一讲就会讨论常见的坑。</p><p>而这些常用的工具已经经过很多人的努力和长时间的改进，在很多方面避免了容易出现的各种问题，所以尽量使用它们吧。</p><h2>测试工具的分类</h2><p>首先你必须认识到，性能测试工具是繁多的。之所以繁多，是因为每种工具适合的场合不同，所以它们各有特点。比如如下几个方面：</p><ul>\n<li>测试场景：是针对Web环境、移动App、系统、数据库，还是模块测试？</li>\n<li>测试类型：是基准测试还是峰值测试？</li>\n<li>免费还是收费：开源工具一般都是免费的；但是很多收费工具也的确物有所值。</li>\n<li>支持的协议：比如是否支持HTTP协议、FTP协议等等。</li>\n<li>支持的功能：比如并发性支持度，能否分析测试结果，能否录制性能测试脚本等。</li>\n</ul><!-- [[[read_end]]] --><h2>测试工具的模块</h2><p>要评价一个测试工具的优劣好坏，我们就需要知道测试工具的模块和测试的一般过程。</p><p>大规模性能测试的一般过程是：通过录制、回放定制的脚本，模拟多用户同时访问被测试系统（SUT）来产生负载压力，同时监控并记录各种性能指标，最后生成性能分析结果和报告，从而完成性能测试的基本任务。</p><p>比照这个过程，一个稍微健全的测试工具都会包括以下的模块：</p><ul>\n<li>负载生成模块：负责产生足够的流量负载。多少流量算足够？这得根据测试类型和具体需求来定。如果测试类型是压力测试，那么产生的流量一定要大到SUT不能处理的程度。</li>\n<li>测试数据收集模块：负责获取测试的数据，包括具体的各种性能数据。这个收集可以是实时的，就是在测试进行之中收集；也可以是后期，等测试完成之后收集的。</li>\n<li>结果分析和展示：有了大量的测试数据，就需要进行分析并展示。同样的，这个过程可以是实时的，也可以是等全部测试完成后进行。</li>\n<li>资源监控模块：测试过程中离不开对SUT和流量生成模块的实时资源监控，目的是确保这两个模块运行正常。具体来说，流量生成模块必须不能负载过量，否则很可能产生的流量不够大。SUT也要确保运行还是正常的，否则整个测试就失去意义了。</li>\n<li>控制中心模块：测试者需要用这个模块和整个测试系统来交互，比如开始或停止测试，改变测试的各种参数等等。</li>\n</ul><p>这几个模块的关系我用下面这张图表示。</p><p><img src=\"https://static001.geekbang.org/resource/image/1c/4f/1c4e724cff73f9595bb63b49a5cd3a4f.png?wh=2622*1474\" alt=\"\"></p><h2>Web测试场景</h2><p>我们先看第一个测试场景：Web测试。这一场景的测试工具很多，我们介绍几个。</p><p><strong>JMeter</strong>是一款优秀而小巧精致的开源测试工具，是用Java写的。JMeter安装简单，使用方便，所以很流行，建议每个性能测试者都掌握它。熟练使用它，在绝大多数场合都能大大提高测试效率。JMeter的测试是基于HTTP协议的，所以最好对HTTP协议熟悉一些才能快速上手和理解里面的概念。</p><p><strong>LoadRunner</strong>是HP公司的一款测试工具，功能和资料都比较全，也好用，但不是开源的。它的组成模块都很强大，比如分析模块中的AutoCorrelation向导。这个向导会自动整理所有的监控和诊断数据，并找出导致性能降低的最主要的几个原因。这样就将性能测试结果转化为可处理的精确数据，从而使开发团队大大减少了解决问题的时间。</p><p><strong>Locust</strong>是基于Python的开源测试工具，支持HTTP、HTTPS等协议。它的一个突出优点是可扩展性很好。</p><h2>系统测试场景</h2><p>这种场景下的测试工具很多，我主要介绍两个。</p><p><strong>UnixBench</strong>是一个Unix系统（比如Unix、BSD、Linux）下的性能测试工具，是开源的，而且被普遍用于测试Linux系统主机的性能。这个工具可以测试很多模块和场景，比如系统调用、读写、进程、图形化测试、2D、3D、管道、运算、C库等，它的测试结果可以作为基准性能测试数据。</p><p>比如，你可以用它测试从一个文件向另外一个文件传输数据的速率，要求每次测试使用不同大小的缓冲区。再比如测试两个进程通过一个管道（Pipe）交换一个不断增大的整数的速度；类似现实编程中的一些应用，这个测试会首先创建一个子进程，再和这个子进程进行双向的管道传输。它也可以测试进入和离开操作系统内核的开销，即一次系统调用（System Call）的开销代价。</p><p>这是通过反复地调用 getpid 函数的小程序来进行的。</p><p><strong>Perf</strong>是Linux下最普遍使用的性能分析工具，功能强大全面，俗称性能测试的“瑞士军刀”。比如，Perf 可以对程序进行函数级别的采样，从而了解程序的性能瓶颈究竟在哪里。或者计算每个时钟周期内的指令数等等。</p><p>Perf的原理是使用特殊的计数器来进行性能统计。它既可以分析指定应用程序的性能问题，也可以用来分析内核的性能问题，所以可以全面理解应用程序中的性能瓶颈。</p><p>我个人建议每个关心性能的人都了解和学习一下Perf的使用。</p><h2>数据库测试场景</h2><p>数据库的测试工具也是汗牛充栋。</p><p><strong>SysBench</strong>是一个容易使用的的开源多线程测试工具，主要用于测试数据库性能，比如MySQL， Oracle和PostgreSQL，但也可以测试CPU，内存，文件系统等性能。它的强项包括数据分析和展示模块，多线程并发性比较好，而且开销低。另外我们可以很容易地定制脚本，来创建新的测试。</p><p><strong>mysqlslap</strong>是MySQL自带的压力测试工具，它可以轻松模拟出大量客户端同时操作数据库的情况。</p><h2>文件IO和存储测试场景</h2><p>对文件系统和存储系统的性能测试工具也有很多，比如<strong>ioZone</strong>，可以测试不同操作系统中的文件系统的读写性能。比如可以测试不同IO读写方式下硬盘的性能。</p><p>Bonnie++是一个用来测试UNIX文件系统和磁盘性能的测试工具，它可以通过一系列的简单测试来生成硬盘和文件系统的性能参数。这个工具很容易使用，输出结果显示方面很不错。</p><p>如果你希望在Linux中很快地测试硬盘读写性能，<strong>dd</strong>这个很有用的命令经常就够用了。这个工具就是用指定大小的块拷贝一个文件，并在拷贝的同时进行指定的转换。</p><h2>网络测试场景</h2><p>网络测试也有各种各样的工具。</p><p><strong>Netperf</strong>是很不错的一个网络性能的测量工具，主要针对基于TCP或UDP的传输。它有两种基本模式，即批量数据传输（bulk data transfer）模式和请求/应答（request/reponse）模式，我们可以根据应用的不同来选择不同模式。</p><p>测试结果所反映的，是两个系统之间发送和接受数据的速度和效率，即一个系统能够以多快的速度向另一个系统发送数据，以及后者能够以多快的速度接收数据。</p><p><strong>Iperf</strong>可以测试最大TCP和UDP带宽性能，具有多种参数和UDP特性，可以根据需要调整，可以报告带宽、延迟抖动和数据包丢失。这个工具使用起来很简单，一条命令行就可以。比如如下的测试：“采用UDP协议，以100Mbps的数据发送速率，从本机到服务器192.168.1.1作上传带宽测试；测试时间为120秒”，或者“以50Mbps的发送速率，同时向服务器端发起100个连接线程”。</p><h2>移动App测试场景</h2><p>移动App测试的性能指标主要是内存、CPU、电量使用、启动时长、显示帧率、网络流量等。 针对App的性能测试工具和平台可以按照两种方式分类。</p><p>第一种分类是根据<strong>线下还是线上</strong>。线下App性能测试主要依靠传统测试手段和方法，比如不同的版本，框架等等都需要进行App性能测试。 线上测试算是场景化测试，主要针对大规模或者动态环境，让App在特定场合和特别条件下，更精准地衡量App的核心性能。</p><p>另外一种分类方式是<strong>平台生态系统</strong>，现在主要有安卓Android和iOS。有的测试工具可以兼容多个平台，比如<strong>Appium</strong>，就是一个可以同时支持安卓和iOS的测试框架的工具，功能强大。</p><p>对Android的测试工具常用的有<strong>adb</strong>（Android Debug Bridge）和<strong>Monkey</strong>。Monkey是Android SDK自带的测试工具。Monkey的意思是猴子， 顾名思义，就是在电脑面前乱敲键盘在测试。 在测试过程中会向系统发送伪随机的用户事件流，如按键输入、触摸屏输入、手势输入等，对App进行压力测试，也有日志输出。</p><p>对iOS App的测试工具也很多，比如XCTest、Frank、KIF等等，这里就不展开了。</p><h2>总结</h2><p>古人说：“工欲善其事，必先利其器”。业界已经有很多好用的工具，一般都能满足大多数场合的测试要求，会让我们的测试工作如虎添翼。</p><p><img src=\"https://static001.geekbang.org/resource/image/fd/47/fdc924cbf4fe1122ff2da78e4cccdd47.png?wh=2275*2911\" alt=\"\"></p><p>虽然有些环境下我们经常倾向于自己开发某些工具，但是往往会花费很多时间，而且很容易陷入各种各样的坑中，因此尽量避免自己开发。</p><p>这一讲介绍的几款工具适用于不同的场合，如果你能合理运用它们，应该会取得事半功倍的效果。</p><h2>思考题</h2><ul>\n<li>你曾经用过什么样的性能测试工具？</li>\n<li>为什么会选择这些工具，而不是其他的工具？</li>\n<li>你使用的测试工具有什么优点和缺点？</li>\n<li>你是怎么克服它的缺点的？</li>\n</ul><p>欢迎你在留言区分享自己的思考，与我和其他同学一起讨论，也欢迎你把文章分享给自己的朋友。</p>","neighbors":{"left":{"article_title":"10 | 性能测试的规划和步骤：为什么性能测试不容易一蹴而就呢？","id":178907},"right":{"article_title":"12 | 九条性能测试的经验和教训：如何保证测试结果可靠且可重复？","id":179682}},"comments":[{"had_liked":false,"id":167880,"user_name":"北冥有人","can_delete":false,"product_type":"c1","uid":1077985,"ip_address":"","ucode":"708F6213BA905E","user_header":"https://static001.geekbang.org/account/avatar/00/10/72/e1/8670abf3.jpg","comment_is_top":false,"comment_ctime":1577957175,"is_pvip":false,"replies":[{"id":"65280","content":"试试Jmeter, Gatling?","user_name":"作者回复","user_name_real":"zhenyun2010","uid":"1272838","ctime":1578017685,"ip_address":"","comment_id":167880,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10167891767","product_id":100041101,"comment_content":"请问，websocket 性能一般用什么做测试？","like_count":2,"discussions":[{"author":{"id":1272838,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/nicib8gqImzrCGJYyJW3QEmsvtDcfuLe02wm55HBdC2mAHt1mqc6wT7I9GHyByS19zQRBiaZx2EeXKnyvslCZd4tQ/132","nickname":"zhenyun2010","note":"","ucode":"567187932468D8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480039,"discussion_content":"试试Jmeter, Gatling?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578017685,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":189238,"user_name":"夜空中最亮的星","can_delete":false,"product_type":"c1","uid":1267566,"ip_address":"","ucode":"ADC3E7B6789955","user_header":"https://static001.geekbang.org/account/avatar/00/13/57/6e/b6795c44.jpg","comment_is_top":false,"comment_ctime":1584492314,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5879459610","product_id":100041101,"comment_content":"perf很好","like_count":2},{"had_liked":false,"id":166581,"user_name":"arsterc","can_delete":false,"product_type":"c1","uid":1023913,"ip_address":"","ucode":"A44501F87FC536","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9f/a9/378f8034.jpg","comment_is_top":false,"comment_ctime":1577507882,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5872475178","product_id":100041101,"comment_content":"io 测试可以试试 fio， tcp 测试可以试试 tcpkali","like_count":2},{"had_liked":false,"id":276562,"user_name":"在路上","can_delete":false,"product_type":"c1","uid":1402511,"ip_address":"","ucode":"6E31908EFE1107","user_header":"https://static001.geekbang.org/account/avatar/00/15/66/8f/02be926d.jpg","comment_is_top":false,"comment_ctime":1612005492,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612005492","product_id":100041101,"comment_content":"庄老师好，我是做游戏服务端开发的，我在测试登录、战斗、新手、玩法时，都是自己来写脚本，写一个java客户端，里面有不少业务逻辑，收到什么协议然后怎么处理，不知道能使用什么工具","like_count":0},{"had_liked":false,"id":261666,"user_name":"雄鹰","can_delete":false,"product_type":"c1","uid":1786819,"ip_address":"","ucode":"67E0C4BDE7F6F2","user_header":"https://static001.geekbang.org/account/avatar/00/1b/43/c3/2c53acd7.jpg","comment_is_top":false,"comment_ctime":1605487097,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1605487097","product_id":100041101,"comment_content":"老师你好，请教一下iozone工具测试磁盘的基准的问题，比如我的服务器有两个盘（系统盘和数据盘），安装iozone后，如何指定测试指定的盘（比如数据盘），谢谢！","like_count":0},{"had_liked":false,"id":225015,"user_name":"PatHoo","can_delete":false,"product_type":"c1","uid":1097801,"ip_address":"","ucode":"7519F3ABCB7AC6","user_header":"https://static001.geekbang.org/account/avatar/00/10/c0/49/e2a18264.jpg","comment_is_top":false,"comment_ctime":1591617338,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591617338","product_id":100041101,"comment_content":"netperf测试云主机的吞吐量，要放通哪些端口呢?  好像是随机的端口，有没有方法固定端口。云主机放通所有端口太不安全了。","like_count":0},{"had_liked":false,"id":214418,"user_name":"zwm","can_delete":false,"product_type":"c1","uid":1787187,"ip_address":"","ucode":"BDF98B3A1CD406","user_header":"https://static001.geekbang.org/account/avatar/00/1b/45/33/cdea4bca.jpg","comment_is_top":false,"comment_ctime":1588744504,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588744504","product_id":100041101,"comment_content":"众口难调。作为一个性能刚入门的测试小白<br>看到这一章节感觉看到一点有用的东西了。就是数据库、文件io测试工具<br>发现了这个专栏比较高屋建瓴。实际场景和案例太少。","like_count":1},{"had_liked":false,"id":210968,"user_name":"Danny _Jiang","can_delete":false,"product_type":"c1","uid":1240649,"ip_address":"","ucode":"ED5A2DFCCE73BD","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ4g4UuxOeCMoXu1uc6QKmdOcm5icoicOyAEUyH8QEp8Y0lmibGWbD27ZppYwT5BQOHibDOsf4B6Eze8Q/132","comment_is_top":false,"comment_ctime":1587871158,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587871158","product_id":100041101,"comment_content":"东西太浅了  adb也算得上性能测试工具？","like_count":1},{"had_liked":false,"id":184334,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1583291988,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583291988","product_id":100041101,"comment_content":"测试工具集，具体选择时，可以再瞄一眼","like_count":0},{"had_liked":false,"id":171875,"user_name":"丁丁历险记","can_delete":false,"product_type":"c1","uid":1661704,"ip_address":"","ucode":"A43829E454C067","user_header":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","comment_is_top":false,"comment_ctime":1579048588,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579048588","product_id":100041101,"comment_content":"只会 time  xxx<br>和  apache&#47;bin&#47;ab  的路过","like_count":0},{"had_liked":false,"id":164269,"user_name":"志鑫","can_delete":false,"product_type":"c1","uid":1095392,"ip_address":"","ucode":"408869664EEA13","user_header":"https://static001.geekbang.org/account/avatar/00/10/b6/e0/52a07898.jpg","comment_is_top":false,"comment_ctime":1576920259,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1576920259","product_id":100041101,"comment_content":"常用wrk，支持lua脚本","like_count":0,"discussions":[{"author":{"id":1048909,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/6icqg5GGFVo2CkFnjSGleOuDBvTTpXywFbBKicKSNXUH1PibHEq2IgWWGJZsn4ErV6J9mlcBiczV7T5QnpiajLsOibOw/132","nickname":"NonStatic","note":"","ucode":"9F8BAD86389890","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":107780,"discussion_content":"推荐结合wrk2一起使用，也支持lua脚本，两者各有侧重。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577606619,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}