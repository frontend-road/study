{"id":406284,"title":"07 | ä¸ºä»€ä¹ˆStreamä½¿ç”¨äº†Radix Treeï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯è’‹å¾·é’§ã€‚è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬ç»§ç»­ä»åº•å±‚æ•°æ®ç»“æ„çš„è§†è§’å‡ºå‘ï¼Œæ¥èŠèŠRedisä¸­çš„Streamæ•°æ®ç±»å‹æ˜¯å¦‚ä½•ä¿å­˜æ¶ˆæ¯çš„ã€‚</p><p>Redisä»5.0ç‰ˆæœ¬å¼€å§‹æ”¯æŒæä¾›Streamæ•°æ®ç±»å‹ï¼Œå®ƒå¯ä»¥ç”¨æ¥ä¿å­˜æ¶ˆæ¯æ•°æ®ï¼Œè¿›è€Œèƒ½å¸®åŠ©æˆ‘ä»¬å®ç°ä¸€ä¸ªå¸¦æœ‰æ¶ˆæ¯è¯»å†™åŸºæœ¬åŠŸèƒ½çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¹¶ç”¨äºæ—¥å¸¸çš„åˆ†å¸ƒå¼ç¨‹åºé€šä¿¡å½“ä¸­ã€‚æˆ‘åœ¨è®²<a href=\"https://time.geekbang.org/column/article/284291\">å¦‚ä½•ä½¿ç”¨Rediså®ç°æ¶ˆæ¯é˜Ÿåˆ—</a>çš„æ—¶å€™ï¼Œæ›¾ä»‹ç»è¿‡Streamã€‚å½“æ—¶ï¼Œæœ‰ä¸å°‘åŒå­¦å°±è¯´æƒ³å­¦ä¹ äº†è§£ä¸‹Streamçš„å®ç°ï¼Œä»¥ä¾¿æŒæ¡Streamå†…éƒ¨ç»“æ„çš„æ“ä½œç‰¹ç‚¹ï¼Œä½†è‡ªå·±å¯¹Streamç±»å‹ä¸å¤ªç†Ÿæ‚‰ï¼Œä¸çŸ¥é“Streamåº•å±‚æ˜¯é‡‡ç”¨æ€æ ·çš„æ•°æ®ç»“æ„æ¥ä¿å­˜æ¶ˆæ¯æ•°æ®çš„ã€‚</p><p>å…¶å®ï¼Œä¸ºäº†èŠ‚çœå†…å­˜ç©ºé—´ï¼Œåœ¨Streamæ•°æ®ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ä¸­ï¼Œé‡‡ç”¨äº†<strong>Radix Treeå’Œlistpack</strong>ä¸¤ç§æ•°æ®ç»“æ„æ¥ä¿å­˜æ¶ˆæ¯ã€‚æˆ‘åœ¨<a href=\"https://time.geekbang.org/column/article/405387\">ç¬¬6è®²</a>å·²ç»ç»™ä½ ä»‹ç»è¿‡äº†listpackï¼Œå®ƒæ˜¯ä¸€ä¸ªç´§å‡‘å‹åˆ—è¡¨ï¼Œåœ¨ä¿å­˜æ•°æ®æ—¶ä¼šéå¸¸èŠ‚çœå†…å­˜ã€‚</p><p>æ‰€ä»¥ä»Šå¤©è¿™èŠ‚è¯¾ï¼Œæˆ‘å°±æ¥ç»™ä½ ä»‹ç»ä¸‹Streamç”¨åˆ°çš„å¦ä¸€ä¸ªæ•°æ®ç»“æ„Radix Treeã€‚è¿™ä¸ªæ•°æ®ç»“æ„çš„<strong>æœ€å¤§ç‰¹ç‚¹æ˜¯é€‚åˆä¿å­˜å…·æœ‰ç›¸åŒå‰ç¼€çš„æ•°æ®</strong>ï¼Œä»è€Œå®ç°èŠ‚çœå†…å­˜ç©ºé—´çš„ç›®æ ‡ï¼Œä»¥åŠæ”¯æŒèŒƒå›´æŸ¥è¯¢ã€‚</p><p>åŒæ—¶ï¼Œå’Œå¸¸è§çš„Bæ ‘æˆ–B+æ ‘ç±»ä¼¼ï¼ŒRadix Treeä¹Ÿæ˜¯ä¸€ç§é‡è¦çš„æ ‘å‹ç»“æ„ï¼Œåœ¨æ“ä½œç³»ç»Ÿå†…æ ¸å’Œæ•°æ®åº“ä¸­ä¹Ÿæœ‰åº”ç”¨ã€‚æ‰€ä»¥ï¼Œäº†è§£Radix Treeçš„è®¾è®¡ä¸å®ç°ï¼Œæ—¢å¯ä»¥å¸®åŠ©æˆ‘ä»¬æŒæ¡Streamçš„å®ç°æ€è·¯ï¼Œè¿˜å¯ä»¥è®©æˆ‘ä»¬æŠŠRadix Treeåº”ç”¨åˆ°éœ€è¦èŠ‚çœå†…å­˜çš„æœ‰åºæ ‘å‹ç´¢å¼•åœºæ™¯ä¸­ï¼Œè¿›ä¸€æ­¥è§£å†³å…·æœ‰å…¬å…±å‰ç¼€çš„å¤§é‡æ•°æ®ä¿å­˜æ—¶çš„å†…å­˜å¼€é”€é—®é¢˜ã€‚</p><!-- [[[read_end]]] --><p>å¥½ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹Streamä¿å­˜çš„æ¶ˆæ¯æ•°æ®çš„ç‰¹å¾ï¼Œè¿™ä¹Ÿæ˜¯Redisä½¿ç”¨Radix Treeå’Œlistpackä½œä¸ºåº•å±‚ç»“æ„ä¿å­˜æ¶ˆæ¯çš„é‡è¦è€ƒè™‘å› ç´ ã€‚</p><h2>Streamæ¶ˆæ¯æ•°æ®çš„ç‰¹å¾</h2><p>é¦–å…ˆï¼ŒStreamä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ƒä¿å­˜çš„æ¶ˆæ¯é€šå¸¸å…·æœ‰ä»¥ä¸‹ä¸¤ä¸ªç‰¹å¾ï¼š</p><ul>\n<li>ä¸€æ¡æ¶ˆæ¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªé”®å€¼å¯¹ç»„æˆï¼›</li>\n<li>æ¯æ’å…¥ä¸€æ¡æ¶ˆæ¯ï¼Œè¿™æ¡æ¶ˆæ¯éƒ½ä¼šå¯¹åº”ä¸€ä¸ªæ¶ˆæ¯IDã€‚</li>\n</ul><blockquote>\n<p>æˆ‘ä»¬ä¸€èˆ¬ä¼šè®©RedisæœåŠ¡å™¨è‡ªåŠ¨ç”Ÿæˆé€’å¢çš„æ¶ˆæ¯IDã€‚æ­¤æ—¶ï¼Œæ¶ˆæ¯IDç”±æ—¶é—´æˆ³å’Œåºå·ç»„æˆã€‚å…¶ä¸­ï¼Œæ—¶é—´æˆ³æ˜¯æ¶ˆæ¯æ’å…¥æ—¶ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½çš„æœåŠ¡å™¨å½“æ—¶æ—¶é—´ï¼Œåºå·æ˜¯æ’å…¥æ¶ˆæ¯åœ¨å½“å‰æ¯«ç§’å†…çš„åºå·ã€‚</p>\n</blockquote><p>æ¯”å¦‚ï¼Œæˆ‘åœ¨Rediså®ä¾‹ä¸­æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼Œå¯ä»¥å‘åä¸ºdevmsgçš„æ¶ˆæ¯æµä¸­ï¼Œè¿ç»­æ’å…¥5æ¡æ¶ˆæ¯ã€‚å…¶ä¸­ï¼Œæ¯æ¡æ¶ˆæ¯è®°å½•çš„æ˜¯æŸä¸ªè®¾å¤‡IDå¯¹åº”çš„è®¾å¤‡æ¸©åº¦ä¿¡æ¯ã€‚</p><pre><code>127.0.0.1:6379&gt; XADD devmsg * dev 3 temp 26\n&quot;1628172536845-0&quot;\n127.0.0.1:6379&gt; XADD devmsg * dev 5 temp 28\n&quot;1628172545411-0&quot;\n127.0.0.1:6379&gt; XADD devmsg * dev 8 temp 24\n&quot;1628172553528-0&quot;\n127.0.0.1:6379&gt; XADD devmsg * dev 1 temp 25\n&quot;1628172560442-0&quot;\n127.0.0.1:6379&gt; XADD devmsg * dev 5 temp 26\n&quot;1628172565683-0&quot;\n</code></pre><p>ä»ä¸Šé¢çš„æ’å…¥æ•°æ®å’Œè¿”å›ç»“æœä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¯¹åº”Streamç±»å‹æ¥è¯´ï¼Œå®ƒéœ€è¦ä¿å­˜çš„æ•°æ®ä¹Ÿå…·æœ‰ä¸¤ä¸ªç‰¹å¾ï¼š</p><ul>\n<li>è¿ç»­æ’å…¥çš„æ¶ˆæ¯IDï¼Œå…¶å‰ç¼€æœ‰è¾ƒå¤šéƒ¨åˆ†æ˜¯ç›¸åŒçš„ã€‚æ¯”å¦‚ï¼Œåˆšæ‰æ’å…¥çš„5æ¡æ¶ˆæ¯ï¼Œå®ƒä»¬æ¶ˆæ¯IDçš„å‰8ä½éƒ½æ˜¯16281725ã€‚</li>\n<li>è¿ç»­æ’å…¥çš„æ¶ˆæ¯ï¼Œå®ƒä»¬å¯¹åº”é”®å€¼å¯¹ä¸­çš„é”®é€šå¸¸æ˜¯ç›¸åŒçš„ã€‚æ¯”å¦‚ï¼Œåˆšæ‰æ’å…¥çš„5æ¡æ¶ˆæ¯ï¼Œå®ƒä»¬æ¶ˆæ¯ä¸­çš„é”®éƒ½æ˜¯devå’Œtempã€‚</li>\n</ul><p>é‚£ä¹ˆï¼Œé’ˆå¯¹Streamçš„è¿™ä¸¤ä¸ªæ•°æ®ç‰¹å¾ï¼Œæˆ‘ä»¬è¯¥è®¾è®¡ä½¿ç”¨ä»€ä¹ˆæ ·çš„æ•°æ®ç»“æ„æ¥ä¿å­˜è¿™äº›æ¶ˆæ¯æ•°æ®å‘¢ï¼Ÿ</p><p>ä½ å¯èƒ½ä¼šæƒ³åˆ°ä½¿ç”¨å“ˆå¸Œè¡¨ï¼Œä¸€ä¸ªæ¶ˆæ¯IDå¯¹åº”å“ˆå¸Œè¡¨ä¸­çš„ä¸€ä¸ªkeyï¼Œæ¶ˆæ¯å†…å®¹å¯¹åº”è¿™ä¸ªkeyçš„valueã€‚ä½†æ˜¯ï¼Œå°±åƒåˆšæ‰ä»‹ç»çš„æ•°æ®ç‰¹å¾ä¸€æ ·ï¼Œæ¶ˆæ¯IDå’Œæ¶ˆæ¯ä¸­çš„é”®ç»å¸¸ä¼šæœ‰é‡å¤çš„éƒ¨åˆ†ã€‚å¦‚æœä½¿ç”¨å“ˆå¸Œè¡¨ï¼Œå°±ä¼šå¯¼è‡´æœ‰ä¸å°‘å†—ä½™æ•°æ®ï¼Œè¿™ä¼šæµªè´¹Rediså®è´µçš„å†…å­˜ç©ºé—´ã€‚</p><p>å› æ­¤ï¼Œä¸ºäº†å……åˆ†èŠ‚çœå†…å­˜ç©ºé—´ï¼ŒStreamä½¿ç”¨äº†ä¸¤ç§å†…å­˜å‹å¥½çš„æ•°æ®ç»“æ„ï¼šlistpackå’ŒRadix Treeã€‚å…¶ä¸­ï¼Œ<strong>æ¶ˆæ¯IDæ˜¯ä½œä¸ºRadix Treeä¸­çš„keyï¼Œæ¶ˆæ¯å…·ä½“æ•°æ®æ˜¯ä½¿ç”¨listpackä¿å­˜ï¼Œå¹¶ä½œä¸ºvalueå’Œæ¶ˆæ¯IDä¸€èµ·ä¿å­˜åˆ°Radix Treeä¸­ã€‚</strong></p><p>ä½ å¯ä»¥çœ‹çœ‹ä¸‹é¢çš„Streamç»“æ„ä½“å®šä¹‰ï¼Œå…¶ä¸­ï¼Œæ¶ˆæ¯å°±æ˜¯ä½¿ç”¨Radix Treeç±»å‹çš„ç»“æ„<code>*rax</code>æ¥ä¿å­˜çš„ã€‚</p><pre><code>typedef struct stream {\n    rax *rax;               //ä¿å­˜æ¶ˆæ¯çš„Radix Tree\n    uint64_t length;        //æ¶ˆæ¯æµä¸­çš„æ¶ˆæ¯ä¸ªæ•°\n    streamID last_id;       //å½“å‰æ¶ˆæ¯æµä¸­æœ€åæ’å…¥çš„æ¶ˆæ¯çš„ID\n    rax *cgroups;           //å½“å‰æ¶ˆæ¯æµçš„æ¶ˆè´¹ç»„ä¿¡æ¯ï¼Œä¹Ÿæ˜¯ç”¨Radix Treeä¿å­˜\n} stream;\n</code></pre><p>å¥½äº†ï¼Œé‚£ä¹ˆRadix Treeçš„ç»“æ„åˆ°åº•æ˜¯æ€æ ·çš„å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬å°±æ¥å­¦ä¹ ä¸‹Radix Treeçš„åŸºæœ¬ç»“æ„ã€‚</p><h2>Radix Treeçš„åŸºæœ¬ç»“æ„</h2><p>Radix Treeæ˜¯å±äºå‰ç¼€æ ‘çš„ä¸€ç§ç±»å‹ã€‚å‰ç¼€æ ‘ä¹Ÿç§°ä¸ºTrie Treeï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯ï¼Œä¿å­˜åœ¨æ ‘ä¸Šçš„æ¯ä¸ªkeyä¼šè¢«æ‹†åˆ†æˆå•å­—ç¬¦ï¼Œç„¶åé€ä¸€ä¿å­˜åœ¨æ ‘ä¸Šçš„èŠ‚ç‚¹ä¸­ã€‚å‰ç¼€æ ‘çš„æ ¹èŠ‚ç‚¹ä¸ä¿å­˜ä»»ä½•å­—ç¬¦ï¼Œè€Œé™¤äº†æ ¹èŠ‚ç‚¹ä»¥å¤–çš„å…¶ä»–èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹åªä¿å­˜ä¸€ä¸ªå­—ç¬¦ã€‚å½“æˆ‘ä»¬æŠŠä»æ ¹èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹çš„è·¯å¾„ä¸Šçš„å­—ç¬¦æ‹¼æ¥åœ¨ä¸€èµ·æ—¶ï¼Œå°±å¯ä»¥å¾—åˆ°ç›¸åº”keyçš„å€¼äº†ã€‚</p><p>ä¸‹é¢è¿™å¼ å›¾å±•ç¤ºäº†ä¸€ä¸ªç®€å•çš„å‰ç¼€æ ‘ï¼Œä½ å¯ä»¥çœ‹ä¸‹ã€‚å›¾ä¸­çš„å‰ç¼€æ ‘æœ‰ä¸¤ä¸ªå¶å­èŠ‚ç‚¹ï¼Œå°†æ ¹èŠ‚ç‚¹åˆ°è¿™ä¸¤ä¸ªå¶å­èŠ‚ç‚¹çš„è·¯å¾„ä¸Šï¼Œå¯¹åº”çš„å­—ç¬¦æ‹¼æ¥èµ·æ¥åï¼Œå°±å¾—åˆ°äº†ä¸¤ä¸ªkeyï¼šreadå’Œrealã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/04/56/04f86e94817aca643a8d2c05c580c856.jpg?wh=2000x1125\" alt=\"\"></p><p>å¦å¤–ä»å›¾ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ï¼Œå‰ç¼€æ ‘æ˜¯æŠŠä¿å­˜çš„keyçš„å…¬å…±å‰ç¼€ï¼ˆå³rã€eã€aï¼‰ç‹¬ç«‹å‡ºæ¥å…±äº«ä½¿ç”¨çš„ã€‚è¿™æ ·ä¸€æ¥ï¼Œå°±å¯ä»¥é¿å…åœ¨æ ‘ä¸­å¯¹ç›¸åŒçš„å­—ç¬¦åšé‡å¤å­˜å‚¨ã€‚</p><p>è€Œå¦‚æœä¸é‡‡ç”¨è¿™ç§æ–¹æ³•ï¼Œåªæ˜¯æŠŠè¿™ä¸¤ä¸ªkeyä¿å­˜åœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œé‚£ä¹ˆkeyçš„ç›¸åŒå‰ç¼€å°±ä¼šè¢«å•ç‹¬å­˜å‚¨ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´å†…å­˜ç©ºé—´çš„æµªè´¹ã€‚æ‰€ä»¥ï¼Œ<strong>ç›¸æ¯”å“ˆå¸Œè¡¨çš„ä¿å­˜æ–¹å¼ï¼Œå‰ç¼€æ ‘èƒ½å¤Ÿå¾ˆå¥½åœ°èŠ‚çœå†…å­˜ç©ºé—´ï¼Œè¿™å¯¹äºRedisæ¥è¯´æ˜¯éå¸¸é‡è¦çš„ã€‚</strong></p><h3>å‰ç¼€æ ‘çš„ä¸è¶³å’ŒRadix Treeçš„æ”¹è¿›</h3><p>å½“ç„¶ï¼Œå‰ç¼€æ ‘åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­åªä¿å­˜ä¸€ä¸ªå­—ç¬¦ï¼Œè¿™æ ·åšçš„å¥½å¤„å°±æ˜¯å¯ä»¥å°½å¯èƒ½åœ°å…±äº«ä¸åŒkeyçš„å…¬å…±å‰ç¼€ã€‚ä½†æ˜¯ï¼Œè¿™ä¹Ÿä¼šå¯¼è‡´keyä¸­çš„æŸäº›å­—ç¬¦ä¸²ï¼Œè™½ç„¶ä¸å†è¢«å…±äº«ï¼Œå¯ä»ç„¶ä¼šæŒ‰ç…§æ¯ä¸ªèŠ‚ç‚¹ä¸€ä¸ªå­—ç¬¦çš„å½¢å¼æ¥ä¿å­˜ï¼Œè¿™æ ·åè€Œä¼šé€ æˆç©ºé—´çš„æµªè´¹å’ŒæŸ¥è¯¢æ€§èƒ½çš„é™ä½ã€‚</p><p>æˆ‘æ¥ç»™ä½ ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æœ‰5ä¸ªkeyï¼Œåˆ†åˆ«æ˜¯radixã€raceã€readã€realå’Œredisï¼Œå®ƒä»¬åœ¨å‰ç¼€æ ‘ä¸Šçš„å¸ƒå±€å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f4/50/f44c4bc26d2d4b09a1701d09697c5550.jpg?wh=2000x1125\" alt=\"\"></p><p>å¯¹äºâ€œredisâ€æ¥è¯´ï¼Œå› ä¸ºå®ƒå’Œâ€œreadâ€â€œrealâ€å…±äº«â€œrâ€å’Œâ€œeâ€ï¼Œå’Œâ€œradixâ€â€œraceâ€å…±äº«â€œrâ€ï¼Œä¹Ÿå°±æ˜¯è¯´â€œrâ€å’Œâ€œeâ€èŠ‚ç‚¹éƒ½åˆ†åˆ«æŒ‡å‘å¤šä¸ªå­èŠ‚ç‚¹ã€‚ç±»ä¼¼çš„ï¼Œâ€œrealâ€å’Œâ€œreadâ€å…±äº«äº†â€œrâ€â€œeâ€å’Œâ€œaâ€å‰ç¼€ï¼Œâ€œaâ€èŠ‚ç‚¹ä¹ŸæŒ‡å‘äº†å¤šä¸ªå­èŠ‚ç‚¹ã€‚æ‰€ä»¥ï¼Œåœ¨å‰ç¼€æ ‘çš„èŠ‚ç‚¹ä¸­å•ç‹¬ä¿å­˜â€œrâ€â€œeâ€â€œaâ€æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚</p><p>ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜æ˜¯çœ‹â€œredisâ€è¿™ä¸ªkeyï¼Œé™¤äº†â€œrâ€â€œeâ€å­—ç¬¦å’Œå…¶ä»–keyæœ‰å…±äº«å¤–ï¼Œâ€œreâ€åé¢çš„â€œdisâ€æ²¡æœ‰å†è¢«å…¶ä»–keyå…±äº«äº†ã€‚æ‰€ä»¥æ­¤æ—¶ï¼Œå…¶å®å¹¶æ²¡æœ‰å¿…è¦å†å¯¹â€œdisâ€è¿›è¡Œæ‹†åˆ†ï¼Œå°†å…¶åˆ†æˆå•ä¸ªå­—ç¬¦â€œdâ€â€œiâ€å’Œâ€œsâ€æ¥ä¿å­˜ï¼Œè€Œæ˜¯å¯ä»¥æŠŠå®ƒä»¬åˆå¹¶åœ¨ä¸€èµ·ä¿å­˜ã€‚</p><p>é‚£ä¹ˆåˆ°è¿™é‡Œï¼Œä½ å°±å¯ä»¥å‘ç°ï¼Œåœ¨å‰ç¼€æ ‘ä¸Šï¼Œç¡®å®æœ‰çš„å­—ç¬¦éœ€è¦å•ç‹¬ä¿å­˜ï¼Œç”¨æ¥ä½œä¸ºä¸åŒkeyçš„å…¬å…±å‰ç¼€è¿›è¡Œå…±äº«ï¼Œä½†å…¶å®æœ‰çš„å•å­—ç¬¦èŠ‚ç‚¹å¯ä»¥å’Œå…¶ä»–å•å­—ç¬¦èŠ‚ç‚¹è¿›è¡Œåˆå¹¶ï¼Œè¿™æ ·èƒ½è¿›ä¸€æ­¥èŠ‚çœç©ºé—´ã€‚</p><p>è€Œä»ä¸€ä¸ªæ›´åŠ é€šç”¨çš„è§’åº¦æ¥è¯´ï¼Œåœ¨å‰ç¼€æ ‘çš„æŸä¸ªèŠ‚ç‚¹å¼€å§‹ï¼Œå¦‚æœä»è¯¥èŠ‚ç‚¹åˆ°å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹ä¹‹é—´ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½åªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œé‚£å°±è¡¨æ˜è¿™äº›èŠ‚ç‚¹å¯¹åº”çš„å­—ç¬¦ï¼Œå¹¶æ²¡æœ‰å’Œå…¶ä»–èŠ‚ç‚¹å…±äº«äº†ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬è¿˜æ˜¯æŒ‰ç…§å‰ç¼€æ ‘çš„æ–¹å¼ï¼Œä¸ºæ¯ä¸€ä¸ªå­—ç¬¦åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œä¿å­˜çš„è¯ï¼Œä¸€æ˜¯ä¼š<strong>æµªè´¹å†…å­˜ç©ºé—´</strong>ï¼ŒäºŒæ˜¯åœ¨è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œè¿˜éœ€è¦é€ä¸€åŒ¹é…æ¯ä¸ªèŠ‚ç‚¹è¡¨ç¤ºçš„å­—ç¬¦ï¼Œ<strong>å¯¹æŸ¥è¯¢æ€§èƒ½ä¹Ÿä¼šé€ æˆå½±å“</strong>ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨å‰ç¼€æ ‘ä¸­ï¼Œå¦‚æœä¸€ç³»åˆ—å•å­—ç¬¦èŠ‚ç‚¹ä¹‹é—´çš„åˆ†æ”¯è¿æ¥æ˜¯å”¯ä¸€çš„ï¼Œé‚£ä¹ˆè¿™äº›å•å­—ç¬¦èŠ‚ç‚¹å°±å¯ä»¥åˆå¹¶æˆä¸€ä¸ªèŠ‚ç‚¹ï¼Œè€Œè¿™ç§ç»“æ„çš„æ ‘ï¼Œå°±æ­£æ˜¯<strong>Radix Treeï¼Œä¹Ÿè¢«ç§°ä¸ºåŸºæ•°æ ‘</strong>ã€‚ç›¸æ¯”å‰ç¼€æ ‘æ¥è¯´ï¼ŒRadix Treeæ—¢å¯ä»¥èŠ‚çº¦å†…å­˜çš„ä½¿ç”¨ï¼ŒåŒæ—¶è¿˜å¯ä»¥æé«˜æŸ¥è¯¢è®¿é—®çš„æ•ˆç‡ã€‚</p><p>æˆ‘ç”»äº†ä¸‹é¢è¿™å¼ å›¾ï¼Œå±•ç¤ºäº†åˆšæ‰ä»‹ç»çš„å‰ç¼€æ ‘ä¸Šçš„5ä¸ªkeyï¼ˆradixã€raceã€readã€realå’Œredisï¼‰ï¼Œåœ¨Radix Treeä¸Šçš„å¸ƒå±€ï¼Œä½ å¯ä»¥å¯¹ç…§ç€çœ‹ä¸‹å®ƒä»¬åœ¨å‰ç¼€æ ‘å¸ƒå±€ä¸Šçš„ä¸åŒä¹‹å¤„ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/52/84/5235453fd27d1f97fcc42abd22d04084.jpg?wh=2000x950\" alt=\"\"></p><h3>Radix Treeæ•°æ®ç»“æ„</h3><p>å¥½äº†ï¼Œä»åˆšæ‰ä»‹ç»çš„Radix Treeçš„ç»“æ„ä¸­ï¼Œæˆ‘ä»¬å…¶å®å¯ä»¥å‘ç°ï¼Œåœ¨Radix Treeä¸­å­˜åœ¨ä¸¤ç±»èŠ‚ç‚¹ã€‚</p><p><strong>ç¬¬ä¸€ç±»èŠ‚ç‚¹æ˜¯éå‹ç¼©èŠ‚ç‚¹</strong>ï¼Œè¿™ç±»èŠ‚ç‚¹ä¼šåŒ…å«å¤šä¸ªæŒ‡å‘ä¸åŒå­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œä»¥åŠå¤šä¸ªå­èŠ‚ç‚¹æ‰€å¯¹åº”çš„å­—ç¬¦ï¼Œæ¯”å¦‚å‰é¢Radix Treeä¾‹å­ä¸­çš„èŠ‚ç‚¹â€œrâ€ï¼Œè¿™ä¸ªèŠ‚ç‚¹å°±åŒ…å«äº†æŒ‡å‘å­èŠ‚ç‚¹â€œaâ€å’Œâ€œeâ€çš„æŒ‡é’ˆã€‚åŒæ—¶ï¼Œå¦‚æœä»æ ¹èŠ‚ç‚¹åˆ°ä¸€ä¸ªéå‹ç¼©èŠ‚ç‚¹çš„è·¯å¾„ä¸Šçš„å­—ç¬¦ä¸²ï¼Œå·²ç»å¯¹åº”äº†Radix Treeä¸­ä¿å­˜çš„ä¸€ä¸ªkeyï¼Œé‚£ä¹ˆè¿™ä¸ªéå‹ç¼©èŠ‚ç‚¹ä¸­è¿˜åŒ…å«äº†æŒ‡å‘è¿™ä¸ªkeyå¯¹åº”çš„valueçš„æŒ‡é’ˆã€‚</p><p>æ¯”å¦‚ï¼Œä¸‹é¢è¿™å¼ å›¾å°±æ˜¾ç¤ºäº†åˆšæ‰ä¾‹å­ä¸­çš„èŠ‚ç‚¹rï¼Œå®ƒæ˜¯ä¸€ä¸ªéå‹ç¼©èŠ‚ç‚¹ï¼ŒæŒ‡å‘äº†ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œè¿™ä¸¤ä¸ªå­èŠ‚ç‚¹å¯¹åº”çš„å­—ç¬¦åˆ†åˆ«æ˜¯â€œaâ€å’Œâ€œeâ€ï¼Œè¿™ä¸ªéå‹ç¼©èŠ‚ç‚¹åŒ…å«äº†æŒ‡å‘å­èŠ‚ç‚¹aå’Œeçš„æŒ‡é’ˆã€‚æ­¤å¤–ï¼Œéå‹ç¼©èŠ‚ç‚¹å¤´éƒ¨ä¿å­˜çš„HDRï¼Œæ˜¯Radix TreeèŠ‚ç‚¹æ•°æ®ç»“æ„ä¸­çš„å…ƒæ•°æ®ï¼Œæˆ‘ä¸€ä¼šå„¿ä¼šç»™ä½ å…·ä½“ä»‹ç»å®ƒã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/61/62/61016426c97acb2b9465b2df5befb662.jpg?wh=2000x813\" alt=\"\"></p><p><strong>ç¬¬äºŒç±»èŠ‚ç‚¹æ˜¯å‹ç¼©èŠ‚ç‚¹</strong>ï¼Œè¿™ç±»èŠ‚ç‚¹ä¼šåŒ…å«ä¸€ä¸ªæŒ‡å‘å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œä»¥åŠå­èŠ‚ç‚¹æ‰€ä»£è¡¨çš„åˆå¹¶çš„å­—ç¬¦ä¸²ã€‚æ¯”å¦‚å‰é¢Radix Treeä¾‹å­ä¸­çš„èŠ‚ç‚¹eï¼Œè¿™ä¸ªèŠ‚ç‚¹æŒ‡å‘çš„å­èŠ‚ç‚¹åŒ…å«çš„å­—ç¬¦ä¸²å°±æ˜¯åˆå¹¶çš„å­—ç¬¦ä¸²â€œdisâ€ã€‚å’Œéå‹ç¼©èŠ‚ç‚¹ç±»ä¼¼ï¼Œå¦‚æœä»æ ¹èŠ‚ç‚¹åˆ°ä¸€ä¸ªå‹ç¼©èŠ‚ç‚¹çš„è·¯å¾„ä¸Šçš„å­—ç¬¦ä¸²ï¼Œå·²ç»å¯¹åº”äº†Radix Treeä¸­ä¿å­˜çš„ä¸€ä¸ªkeyï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªå‹ç¼©èŠ‚ç‚¹ä¸­è¿˜åŒ…å«æŒ‡å‘è¿™ä¸ªkeyå¯¹åº”çš„valueçš„æŒ‡é’ˆã€‚</p><p>ä¸‹å›¾å±•ç¤ºçš„å°±æ˜¯ä¸€ä¸ªå‹ç¼©èŠ‚ç‚¹ï¼Œå®ƒåŒ…å«ä¸€ä¸ªæŒ‡å‘å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œè¿™ä¸ªå­èŠ‚ç‚¹è¡¨ç¤ºçš„åˆå¹¶å­—ç¬¦ä¸²æ˜¯â€œisâ€ï¼Œæ‰€ä»¥åœ¨å½“å‰è¿™ä¸ªå‹ç¼©èŠ‚ç‚¹ä¸­ï¼Œä¿å­˜äº†åˆå¹¶å­—ç¬¦â€œisâ€ã€‚è€Œå’Œéå‹ç¼©èŠ‚ç‚¹ç±»ä¼¼ï¼Œå‹ç¼©èŠ‚ç‚¹çš„å¤´éƒ¨HDRï¼Œä¿å­˜çš„ä¹Ÿæ˜¯Radix TreeèŠ‚ç‚¹ç»“æ„ä¸­çš„å…ƒæ•°æ®ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/82/d0/822ebedaf35cb59c8be7ecd2c90b3dd0.jpg?wh=2000x735\" alt=\"\"></p><p>æ—¢ç„¶ï¼Œè¿™ä¸¤ç±»èŠ‚ç‚¹çš„å¤´éƒ¨HDRä¸­éƒ½ä¿å­˜äº†å…ƒæ•°æ®ï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹ï¼Œè¿™äº›å…ƒæ•°æ®éƒ½åŒ…æ‹¬äº†ä»€ä¹ˆå†…å®¹ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸‹Radix Treeçš„èŠ‚ç‚¹æ•°æ®ç»“æ„ã€‚Radix TreeèŠ‚ç‚¹çš„æ•°æ®ç»“æ„æ˜¯ç”±<a href=\"https://github.com/redis/redis/tree/5.0/src/rax.h\">rax.h</a>æ–‡ä»¶ä¸­çš„raxNodeå®šä¹‰çš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>typedef struct raxNode {\n    uint32_t iskey:1;     //èŠ‚ç‚¹æ˜¯å¦åŒ…å«key\n    uint32_t isnull:1;    //èŠ‚ç‚¹çš„å€¼æ˜¯å¦ä¸ºNULL\n    uint32_t iscompr:1;   //èŠ‚ç‚¹æ˜¯å¦è¢«å‹ç¼©\n    uint32_t size:29;     //èŠ‚ç‚¹å¤§å°\n    unsigned char data[]; //èŠ‚ç‚¹çš„å®é™…å­˜å‚¨æ•°æ®\n} raxNode;\n</code></pre><p>è¯¥ç»“æ„ä¸­çš„æˆå‘˜å˜é‡åŒ…æ‹¬4ä¸ªå…ƒæ•°æ®ï¼Œè¿™å››ä¸ªå…ƒæ•°æ®çš„å«ä¹‰åˆ†åˆ«å¦‚ä¸‹ã€‚</p><ul>\n<li><strong>iskey</strong>ï¼šè¡¨ç¤ºä»Radix Treeçš„æ ¹èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹è·¯å¾„ä¸Šçš„å­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œæ˜¯å¦è¡¨ç¤ºäº†ä¸€ä¸ªå®Œæ•´çš„keyã€‚å¦‚æœæ˜¯çš„è¯ï¼Œé‚£ä¹ˆiskeyçš„å€¼ä¸º1ã€‚å¦åˆ™ï¼Œiskeyçš„å€¼ä¸º0ã€‚ä¸è¿‡ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“å‰èŠ‚ç‚¹æ‰€è¡¨ç¤ºçš„keyï¼Œå¹¶ä¸åŒ…å«è¯¥èŠ‚ç‚¹è‡ªèº«çš„å†…å®¹ã€‚</li>\n<li><strong>isnull</strong>ï¼šè¡¨ç¤ºå½“å‰èŠ‚ç‚¹æ˜¯å¦ä¸ºç©ºèŠ‚ç‚¹ã€‚å¦‚æœå½“å‰èŠ‚ç‚¹æ˜¯ç©ºèŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹å°±ä¸éœ€è¦ä¸ºæŒ‡å‘valueçš„æŒ‡é’ˆåˆ†é…å†…å­˜ç©ºé—´äº†ã€‚</li>\n<li><strong>iscompr</strong>ï¼šè¡¨ç¤ºå½“å‰èŠ‚ç‚¹æ˜¯éå‹ç¼©èŠ‚ç‚¹ï¼Œè¿˜æ˜¯å‹ç¼©èŠ‚ç‚¹ã€‚</li>\n<li><strong>size</strong>ï¼šè¡¨ç¤ºå½“å‰èŠ‚ç‚¹çš„å¤§å°ï¼Œå…·ä½“å€¼ä¼šæ ¹æ®èŠ‚ç‚¹æ˜¯å‹ç¼©èŠ‚ç‚¹è¿˜æ˜¯éå‹ç¼©èŠ‚ç‚¹è€Œä¸åŒã€‚å¦‚æœå½“å‰èŠ‚ç‚¹æ˜¯å‹ç¼©èŠ‚ç‚¹ï¼Œè¯¥å€¼è¡¨ç¤ºå‹ç¼©æ•°æ®çš„é•¿åº¦ï¼›å¦‚æœæ˜¯éå‹ç¼©èŠ‚ç‚¹ï¼Œè¯¥å€¼è¡¨ç¤ºè¯¥èŠ‚ç‚¹æŒ‡å‘çš„å­èŠ‚ç‚¹ä¸ªæ•°ã€‚</li>\n</ul><p>è¿™4ä¸ªå…ƒæ•°æ®å°±å¯¹åº”äº†åˆšæ‰ä»‹ç»çš„å‹ç¼©èŠ‚ç‚¹å’Œéå‹ç¼©èŠ‚ç‚¹å¤´éƒ¨çš„HDRï¼Œå…¶ä¸­ï¼Œiskeyã€isnullå’Œiscompråˆ†åˆ«ç”¨1 bitè¡¨ç¤ºï¼Œè€Œsizeå ç”¨29 bitã€‚</p><p>å¦å¤–ï¼Œä»raxNodeç»“æ„ä½“ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†å…ƒæ•°æ®ï¼Œè¯¥ç»“æ„ä½“ä¸­è¿˜æœ‰charç±»å‹æ•°ç»„dataã€‚æˆ‘ä»¬çŸ¥é“ï¼Œdataæ˜¯ç”¨æ¥ä¿å­˜å®é™…æ•°æ®çš„ã€‚ä¸è¿‡ï¼Œè¿™é‡Œä¿å­˜çš„æ•°æ®ä¼šæ ¹æ®å½“å‰èŠ‚ç‚¹çš„ç±»å‹è€Œæœ‰æ‰€ä¸åŒï¼š</p><ul>\n<li><strong>å¯¹äºéå‹ç¼©èŠ‚ç‚¹æ¥è¯´</strong>ï¼Œdataæ•°ç»„åŒ…æ‹¬å­èŠ‚ç‚¹å¯¹åº”çš„å­—ç¬¦ã€æŒ‡å‘å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œä»¥åŠèŠ‚ç‚¹è¡¨ç¤ºkeyæ—¶å¯¹åº”çš„valueæŒ‡é’ˆï¼›</li>\n<li><strong>å¯¹äºå‹ç¼©èŠ‚ç‚¹æ¥è¯´</strong>ï¼Œdataæ•°ç»„åŒ…æ‹¬å­èŠ‚ç‚¹å¯¹åº”çš„åˆå¹¶å­—ç¬¦ä¸²ã€æŒ‡å‘å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œä»¥åŠèŠ‚ç‚¹ä¸ºkeyæ—¶çš„valueæŒ‡é’ˆã€‚</li>\n</ul><p>å¥½äº†ï¼Œåˆ°è¿™é‡Œï¼Œä½ å¯èƒ½å·²ç»å‘ç°ï¼Œåœ¨raxNodeçš„å®ç°ä¸­ï¼Œæ— è®ºæ˜¯éå‹ç¼©èŠ‚ç‚¹è¿˜æ˜¯å‹ç¼©èŠ‚ç‚¹ï¼Œå…¶å®å…·æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š</p><ul>\n<li>å®ƒä»¬æ‰€ä»£è¡¨çš„keyï¼Œæ˜¯ä»æ ¹èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹è·¯å¾„ä¸Šçš„å­—ç¬¦ä¸²ï¼Œä½†å¹¶ä¸åŒ…å«å½“å‰èŠ‚ç‚¹ï¼›</li>\n<li>å®ƒä»¬æœ¬èº«å°±å·²ç»åŒ…å«äº†å­èŠ‚ç‚¹ä»£è¡¨çš„å­—ç¬¦æˆ–åˆå¹¶å­—ç¬¦ä¸²ã€‚è€Œå¯¹äºå®ƒä»¬çš„å­èŠ‚ç‚¹æ¥è¯´ï¼Œä¹Ÿéƒ½å±äºéå‹ç¼©æˆ–å‹ç¼©èŠ‚ç‚¹ï¼Œæ‰€ä»¥ï¼Œ<strong>å­èŠ‚ç‚¹æœ¬èº«åˆä¼šä¿å­˜ï¼Œå­èŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ‰€ä»£è¡¨çš„å­—ç¬¦æˆ–åˆå¹¶å­—ç¬¦ä¸²</strong>ã€‚</li>\n</ul><p>è€Œè¿™ä¸¤ä¸ªç‰¹ç‚¹å°±ç»™Radix Treeå®é™…ä¿å­˜æ•°æ®æ—¶çš„ç»“æ„ï¼Œå¸¦æ¥äº†ä¸¤ä¸ªæ–¹é¢çš„å˜åŒ–ã€‚</p><p>ä¸€æ–¹é¢ï¼ŒRadix Treeéå¶å­èŠ‚ç‚¹ï¼Œè¦ä¸ç„¶æ˜¯å‹ç¼©èŠ‚ç‚¹ï¼ŒåªæŒ‡å‘å•ä¸ªå­èŠ‚ç‚¹ï¼Œè¦ä¸ç„¶æ˜¯éå‹ç¼©èŠ‚ç‚¹ï¼ŒæŒ‡å‘å¤šä¸ªå­èŠ‚ç‚¹ï¼Œä½†æ¯ä¸ªå­èŠ‚ç‚¹åªè¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ã€‚æ‰€ä»¥ï¼Œ<strong>éå¶å­èŠ‚ç‚¹æ— æ³•åŒæ—¶æŒ‡å‘è¡¨ç¤ºå•ä¸ªå­—ç¬¦çš„å­èŠ‚ç‚¹å’Œè¡¨ç¤ºåˆå¹¶å­—ç¬¦ä¸²çš„å­èŠ‚ç‚¹</strong>ã€‚</p><p>æˆ‘ç»™ä½ ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨ä¸‹å›¾çš„å·¦åŠéƒ¨åˆ†ï¼ŒèŠ‚ç‚¹rçš„å­èŠ‚ç‚¹aï¼Œå®ƒçš„ä¸¤ä¸ªå­èŠ‚ç‚¹è¡¨ç¤ºçš„éƒ½æ˜¯åˆå¹¶å­—ç¬¦ä¸²â€œdixâ€å’Œâ€œceâ€ã€‚å› æ­¤ï¼ŒèŠ‚ç‚¹açš„raxNodeç»“æ„ï¼Œæ— æ³•åŒæ—¶æŒ‡å‘dixå­èŠ‚ç‚¹å’Œceå­èŠ‚ç‚¹ã€‚ç±»ä¼¼çš„ï¼ŒrèŠ‚ç‚¹çš„å­èŠ‚ç‚¹eï¼Œå®ƒçš„ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œä¸€ä¸ªè¡¨ç¤ºçš„æ˜¯å•å­—ç¬¦â€œaâ€ï¼Œå¦ä¸€ä¸ªè¡¨ç¤ºçš„æ˜¯åˆå¹¶å­—ç¬¦ä¸²â€œdisâ€ï¼ŒèŠ‚ç‚¹eçš„raxNodeç»“æ„ä¹Ÿæ— æ³•åŒæ—¶æŒ‡å‘è¿™ä¸¤ä¸ªå­èŠ‚ç‚¹ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨å®é™…ä½¿ç”¨raxNodeç»“æ„ä¿å­˜æ•°æ®æ—¶ï¼ŒèŠ‚ç‚¹dixä¼šè¢«æ‹†ä¸ºèŠ‚ç‚¹då’Œixï¼ŒèŠ‚ç‚¹ceä¼šè¢«æ‹†ä¸ºèŠ‚ç‚¹cå’Œeï¼ŒèŠ‚ç‚¹disä¼šè¢«æ‹†ä¸ºèŠ‚ç‚¹då’Œisï¼Œå¦‚ä¸‹å›¾çš„å³åŠéƒ¨åˆ†æ‰€ç¤ºã€‚è¿™æ ·ä¸€æ¥ï¼ŒèŠ‚ç‚¹rçš„å­èŠ‚ç‚¹aå’Œeï¼Œå°±å¯ä»¥ç”¨éå‹ç¼©èŠ‚ç‚¹çš„ç»“æ„æ¥ä¿å­˜äº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/09/dd/09bd522df6dbaa3216acd20b0248a2dd.jpg?wh=2000x1003\" alt=\"\"></p><p>æˆ‘ä»¬å†æ¥çœ‹å¦ä¸€æ–¹é¢ï¼Œå¯¹äºRadix Treeçš„å¶å­èŠ‚ç‚¹æ¥è¯´ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å­èŠ‚ç‚¹äº†ï¼Œæ‰€ä»¥ï¼Œ<strong>Redisä¼šç”¨ä¸€ä¸ªä¸åŒ…å«å­èŠ‚ç‚¹æŒ‡é’ˆçš„raxNodeèŠ‚ç‚¹æ¥è¡¨ç¤ºå¶å­èŠ‚ç‚¹</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¶å­èŠ‚ç‚¹çš„raxNodeå…ƒæ•°æ®sizeä¸º0ï¼Œæ²¡æœ‰å­èŠ‚ç‚¹æŒ‡é’ˆã€‚å¦‚æœå¶å­èŠ‚ç‚¹ä»£è¡¨äº†ä¸€ä¸ªkeyï¼Œé‚£ä¹ˆå®ƒçš„raxNodeä¸­æ˜¯ä¼šä¿å­˜è¿™ä¸ªkeyçš„valueæŒ‡é’ˆçš„ã€‚</p><p>ä¸ºäº†ä¾¿äºä½ ç†è§£éå‹ç¼©èŠ‚ç‚¹ã€å‹ç¼©èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹çš„raxNodeç»“æ„å†…å®¹ï¼Œæˆ‘ç”»äº†ä¸‹é¢è¿™å¼ å›¾ï¼Œä½ å¯ä»¥çœ‹ä¸‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/7c/cd/7c6b7d2a809178c80405bb5e667b21cd.jpg?wh=2000x1104\" alt=\"\"></p><p>è¿™å¼ å›¾ä¸Šæ˜¾ç¤ºäº†Radix Treeæœ€å³ä¾§åˆ†æ”¯çš„4ä¸ªèŠ‚ç‚¹rã€eã€dã€iså’Œå®ƒä»¬å„è‡ªçš„raxNodeå†…å®¹ã€‚å…¶ä¸­ï¼ŒèŠ‚ç‚¹rã€eå’Œdéƒ½ä¸ä»£è¡¨keyï¼Œæ‰€ä»¥å®ƒä»¬çš„iskeyå€¼ä¸º0ï¼Œisnullå€¼ä¸º1ï¼Œæ²¡æœ‰ä¸ºvalueæŒ‡é’ˆåˆ†é…ç©ºé—´ã€‚</p><p>èŠ‚ç‚¹rå’ŒeæŒ‡å‘çš„å­èŠ‚ç‚¹éƒ½æ˜¯å•å­—ç¬¦èŠ‚ç‚¹ï¼Œæ‰€ä»¥å®ƒä»¬ä¸æ˜¯å‹ç¼©èŠ‚ç‚¹ï¼Œiscomprå€¼ä¸º0ã€‚è€ŒèŠ‚ç‚¹dçš„å­èŠ‚ç‚¹åŒ…å«äº†åˆå¹¶å­—ç¬¦ä¸²â€œisâ€ï¼Œæ‰€ä»¥è¯¥èŠ‚ç‚¹æ˜¯å‹ç¼©èŠ‚ç‚¹ï¼Œiscomprå€¼ä¸º1ã€‚æœ€åçš„å¶å­èŠ‚ç‚¹isï¼Œå®ƒçš„raxNodeçš„sizeä¸º0ï¼Œæ²¡æœ‰å­èŠ‚ç‚¹æŒ‡é’ˆã€‚ä¸è¿‡ï¼Œå› ä¸ºä»æ ¹èŠ‚ç‚¹åˆ°èŠ‚ç‚¹isè·¯å¾„ä¸Šçš„å­—ç¬¦ä¸²ä»£è¡¨äº†keyâ€œredisâ€ï¼Œæ‰€ä»¥ï¼ŒèŠ‚ç‚¹isçš„valueæŒ‡é’ˆæŒ‡å‘äº†â€œredisâ€å¯¹åº”çš„valueæ•°æ®ã€‚</p><p>è¿™é‡Œï¼Œä½ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>ä¸ºäº†æ»¡è¶³å†…å­˜å¯¹é½çš„éœ€è¦ï¼ŒraxNodeä¼šæ ¹æ®ä¿å­˜çš„å­—ç¬¦ä¸²é•¿åº¦ï¼Œåœ¨å­—ç¬¦ä¸²åé¢å¡«å……ä¸€äº›å­—èŠ‚</strong>ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„paddingéƒ¨åˆ†ã€‚</p><p>å¥½äº†ï¼Œåˆ°è¿™é‡Œï¼Œä½ åº”è¯¥å°±ç†è§£äº†Radix Treeä¸­ä¸åŒèŠ‚ç‚¹çš„raxNodeç»“æ„å†…å®¹ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥äº†è§£ä¸‹Radix Treeçš„åŸºæœ¬æ“ä½œå‡½æ•°ã€‚</p><h2>Radix Treeçš„æ“ä½œå‡½æ•°</h2><p>Radix Treeçš„åŸºæœ¬æ“ä½œå‡½æ•°éƒ½æ˜¯åœ¨<a href=\"https://github.com/redis/redis/tree/5.0/src/rax.c\">rax.c</a>æ–‡ä»¶ä¸­å®ç°çš„ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ã€‚</p><ul>\n<li><strong>raxNewå‡½æ•°</strong></li>\n</ul><p>è¯¥å‡½æ•°çš„åŸå‹å¦‚ä¸‹ï¼Œå®ƒä¼šè°ƒç”¨rax_mallocå‡½æ•°åˆ†é…ä¸€ä¸ªæ–°çš„raxç»“æ„ä½“ç©ºé—´ã€‚</p><pre><code>rax *raxNew(void) \n</code></pre><p>raxç»“æ„ä½“çš„å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼Œå…¶ä¸­åŒ…å«äº†Radix Treeä¸­çš„keyä¸ªæ•°ã€èŠ‚ç‚¹ä¸ªæ•°ï¼Œä»¥åŠæŒ‡å‘å¤´èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œè€ŒraxNewå‡½æ•°ä¼šè°ƒç”¨raxNewNodeå‡½æ•°æ¥åˆ›å»ºå¤´èŠ‚ç‚¹ã€‚</p><pre><code>typedef struct rax {\n    raxNode *head;  //Radix Treeçš„å¤´æŒ‡é’ˆ\n    uint64_t numele;  //Radix Treeä¸­keyçš„ä¸ªæ•°\n    uint64_t numnodes; //Radix Treeä¸­raxNodeçš„ä¸ªæ•°\n} rax;\n</code></pre><ul>\n<li><strong>raxNewNodeå‡½æ•°</strong></li>\n</ul><p>è¯¥å‡½æ•°çš„åŸå‹å¦‚ä¸‹ï¼Œç”¨æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„éå‹ç¼©èŠ‚ç‚¹ã€‚å®ƒçš„å‚æ•°childrenè¡¨ç¤ºè¯¥éå‹ç¼©èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸ªæ•°ï¼Œå‚æ•°datafieldè¡¨ç¤ºæ˜¯å¦è¦ä¸ºvalueæŒ‡é’ˆåˆ†é…ç©ºé—´ã€‚</p><pre><code>raxNode *raxNewNode(size_t children, int datafield) \n</code></pre><p>è¿™é‡Œï¼Œä½ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå‹ç¼©èŠ‚ç‚¹çš„åˆ›å»ºå¹¶ä¸æ˜¯é€šè¿‡raxNewNodeå‡½æ•°æ¥å®Œæˆçš„ï¼Œè€Œæ˜¯é€šè¿‡raxCompressNodeå‡½æ•°æ¥å®ç°çš„ã€‚</p><ul>\n<li><strong>raxGenericInsertå‡½æ•°</strong></li>\n</ul><p>è¯¥å‡½æ•°åŸå‹å¦‚ä¸‹ï¼Œç”¨æ¥å‘Radix Treeä¸­æ’å…¥ä¸€ä¸ªé•¿åº¦ä¸ºlençš„å­—ç¬¦ä¸²sã€‚</p><pre><code>int raxGenericInsert(rax *rax, unsigned char *s, size_t len, void *data, void **old, int overwrite) \n</code></pre><ul>\n<li><strong>raxLowWalkå‡½æ•°</strong></li>\n</ul><p>è¯¥å‡½æ•°åŸå‹å¦‚ä¸‹ï¼Œå½“éœ€è¦åœ¨Radix Treeä¸­æŸ¥æ‰¾ã€æ’å…¥æˆ–æ˜¯åˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨è¯¥å‡½æ•°ã€‚</p><pre><code>static inline size_t raxLowWalk(rax *rax, unsigned char *s, size_t len, raxNode **stopnode, raxNode ***plink, int *splitpos, raxStack *ts)\n</code></pre><ul>\n<li><strong>raxGetData/raxSetDataå‡½æ•°</strong></li>\n</ul><p>è¿™ä¸¤ä¸ªå‡½æ•°çš„åŸå‹å¦‚ä¸‹æ‰€ç¤ºï¼Œå®ƒä»¬åˆ†åˆ«ç”¨æ¥è·å¾—raxNodeä¸­ä¿å­˜çš„valueæŒ‡é’ˆï¼Œä»¥åŠè®¾ç½®raxNodeä¸­ä¿å­˜çš„valueæŒ‡é’ˆã€‚</p><pre><code>void *raxGetData(raxNode *n) \nvoid raxSetData(raxNode *n, void *data)\n</code></pre><p>å¥½äº†ï¼Œäº†è§£äº†Radix Treeçš„åŸºæœ¬æ“ä½œå‡½æ•°åï¼Œæˆ‘ä»¬æœ€åå†æ¥çœ‹ä¸‹ï¼ŒStreamæ˜¯å¦‚ä½•æŠŠRadix Treeå’Œlistpackç»„åˆèµ·æ¥ä½¿ç”¨çš„ã€‚</p><h2>Streamå¦‚ä½•ç»„åˆä½¿ç”¨Radix Treeå’Œlistpackï¼Ÿ</h2><p>æˆ‘ä»¬çŸ¥é“ï¼ŒStreamä¿å­˜çš„æ¶ˆæ¯æ•°æ®ï¼ŒæŒ‰ç…§key-valueå½¢å¼æ¥çœ‹çš„è¯ï¼Œæ¶ˆæ¯IDå°±ç›¸å½“äºkeyï¼Œè€Œæ¶ˆæ¯å†…å®¹ç›¸å½“äºæ˜¯valueã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒStreamä¼šä½¿ç”¨Radix Treeæ¥ä¿å­˜æ¶ˆæ¯IDï¼Œç„¶åå°†æ¶ˆæ¯å†…å®¹ä¿å­˜åœ¨listpackä¸­ï¼Œå¹¶ä½œä¸ºæ¶ˆæ¯IDçš„valueï¼Œç”¨raxNodeçš„valueæŒ‡é’ˆæŒ‡å‘å¯¹åº”çš„listpackã€‚</p><p>è¿™é‡Œæˆ‘æ”¾äº†ä¸€å¼ å›¾ï¼Œå±•ç¤ºäº†Streamç»“æ„ã€raxã€raxNodeä»¥åŠlistpackç›¸äº’ä¹‹é—´çš„å…³ç³»ã€‚æ³¨æ„ï¼Œåœ¨è¿™å¼ å›¾ä¸­ï¼Œæˆ‘ä»¬å‡è®¾å°±åªæœ‰ä¸€ä¸ªstreamIDä½œä¸ºkeyã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/1e/0d/1e5aa7509b25bb94d53c183130d3460d.jpg?wh=2000x1125\" alt=\"\"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œstreamç»“æ„ä½“ä¸­çš„raxæŒ‡é’ˆï¼ŒæŒ‡å‘äº†Radix Treeçš„å¤´èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯raxç»“æ„ä½“ã€‚raxç»“æ„ä½“ä¸­çš„å¤´æŒ‡é’ˆè¿›ä¸€æ­¥æŒ‡å‘äº†ç¬¬ä¸€ä¸ªraxNodeã€‚å› ä¸ºæˆ‘ä»¬å‡è®¾å°±åªæœ‰ä¸€ä¸ªstreamIDï¼Œæš‚æ—¶æ²¡æœ‰å…¶ä»–streamIDå’Œè¯¥streamIDå…±äº«å‰ç¼€ï¼Œæ‰€ä»¥ï¼Œå½“å‰è¿™ä¸ªstreamIDå°±å¯ä»¥ç”¨å‹ç¼©èŠ‚ç‚¹ä¿å­˜ã€‚</p><p>ç„¶åï¼Œç¬¬ä¸€ä¸ªraxNodeæŒ‡å‘äº†ä¸‹ä¸€ä¸ªraxNodeï¼Œä¹Ÿæ˜¯Radix Treeçš„å¶å­èŠ‚ç‚¹ã€‚è¿™ä¸ªèŠ‚ç‚¹çš„sizeä¸º0ï¼Œå®ƒçš„valueæŒ‡é’ˆæŒ‡å‘äº†å®é™…çš„æ¶ˆæ¯å†…å®¹ã€‚</p><p>è€Œåœ¨æ¶ˆæ¯å†…å®¹è¿™é‡Œï¼Œæ˜¯ä½¿ç”¨äº†listpackè¿›è¡Œä¿å­˜çš„ã€‚ä½ å¯ä»¥çœ‹åˆ°ï¼Œlistpackä¸­æ˜¯ä½¿ç”¨äº†master entryæ¥ä¿å­˜é”®å€¼å¯¹ç±»å‹æ¶ˆæ¯ä¸­çš„é”®ï¼Œè€Œå€¼ä¼šåœ¨master entryåé¢ä¿å­˜ã€‚è¿™ç§ä¿å­˜æ–¹å¼å…¶å®ä¹Ÿæ˜¯ä¸ºäº†<strong>èŠ‚çœå†…å­˜ç©ºé—´</strong>ï¼Œè¿™æ˜¯å› ä¸ºå¾ˆå¤šæ¶ˆæ¯çš„é”®æ˜¯ç›¸åŒçš„ï¼Œä¿å­˜ä¸€ä»½å°±è¡Œã€‚å…³äºåœ¨Streamä¸­ï¼Œå°†æ¶ˆæ¯çš„é”®å’Œå€¼åˆ†å¼€ä¿å­˜åˆ°listpackä¸­çš„è¿™ç§è®¾è®¡æ–¹æ³•ï¼Œæˆ‘ä¼šåœ¨åé¢çš„è¯¾ç¨‹ä¸­ç»§ç»­ç»™ä½ è¯¦ç»†ä»‹ç»ã€‚</p><h2>å°ç»“</h2><p>ä»Šå¤©è¿™èŠ‚è¯¾ä¸Šï¼Œæˆ‘å¸¦ä½ å­¦ä¹ äº†Redis Streamæ•°æ®ç±»å‹çš„åº•å±‚å®ç°ç»“æ„ã€‚ç°åœ¨ä½ å·²ç»çŸ¥é“ï¼ŒStreamæœ€ä¸»è¦çš„ä½œç”¨å°±æ˜¯å¯ä»¥<strong>ç”¨æ¥ä¿å­˜æ¶ˆæ¯æ•°æ®</strong>ã€‚</p><p>æ¯æ¡æ¶ˆæ¯éƒ½ä¼šæœ‰ä¸€ä¸ªæ—¶é—´æˆ³å’Œåºå·ç»„æˆçš„æ¶ˆæ¯IDï¼Œä»¥åŠé”®å€¼å¯¹ç»„æˆçš„æ¶ˆæ¯å†…å®¹ã€‚è€Œå› ä¸ºä¸åŒæ¶ˆæ¯IDä¸­çš„æ—¶é—´æˆ³ï¼Œé€šå¸¸ä¼šå…±äº«éƒ¨åˆ†ç›¸åŒçš„å‰ç¼€ï¼Œå¦‚æœé‡‡ç”¨è¯¸å¦‚å“ˆå¸Œè¡¨çš„ç»“æ„æ¥ä¿å­˜æ¶ˆæ¯ï¼Œæ¯ä¸ªæ¶ˆæ¯IDéƒ½å•ç‹¬ä¿å­˜ï¼Œå®¹æ˜“é€ æˆç©ºé—´æµªè´¹ã€‚å› æ­¤ï¼ŒStreamä¸ºäº†èŠ‚çœå†…å­˜ç©ºé—´ï¼Œé‡‡ç”¨äº†Radix Treeæ¥ä¿å­˜æ¶ˆæ¯IDï¼ŒåŒæ—¶ä½¿ç”¨listpackæ¥ä¿å­˜æ¶ˆæ¯æœ¬èº«çš„å†…å®¹ã€‚</p><p>åœ¨Radix Treeçš„è®¾è®¡å®ç°ä¸­ï¼Œå®ƒçš„æ•´ä½“ç»“æ„å’ŒèŠ‚ç‚¹æ•°æ®ç»“æ„æ˜¯ç†è§£Radix Treeçš„é‡è¦åŸºç¡€ï¼Œæ‰€ä»¥ï¼Œä½ è¦é‡ç‚¹å…³æ³¨Radix Treeçš„éå‹ç¼©èŠ‚ç‚¹å’Œå‹ç¼©èŠ‚ç‚¹ç±»å‹ï¼Œä»¥åŠæºç ä¸­çš„å®é™…æ•°æ®ç»“æ„raxNodeã€‚</p><p>å¦å¤–ï¼Œä¸ºäº†æ–¹ä¾¿ä½ æ›´å¥½åœ°æŒæ¡éå‹ç¼©èŠ‚ç‚¹å’Œå‹ç¼©èŠ‚ç‚¹ï¼Œæˆ‘å†ç»™ä½ æ€»ç»“ä¸‹å®ƒä»¬çš„ç›¸åŒä¹‹å¤„å’ŒåŒºåˆ«ï¼Œä½ ä¹Ÿå¯ä»¥æ¥æ•´ä½“å›é¡¾ä¸‹ã€‚</p><p>å®ƒä»¬çš„<strong>ç›¸åŒä¹‹å¤„</strong>åœ¨äºï¼š</p><ul>\n<li>éƒ½æœ‰ä¿å­˜å…ƒæ•°æ®çš„èŠ‚ç‚¹å¤´HDRï¼›</li>\n<li>éƒ½ä¼šåŒ…å«æŒ‡å‘å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œä»¥åŠå­èŠ‚ç‚¹æ‰€ä»£è¡¨çš„å­—ç¬¦ä¸²ã€‚</li>\n<li>ä»æ ¹èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹è·¯å¾„ä¸Šçš„å­—ç¬¦ä¸²å¦‚æœæ˜¯Radix Treeçš„ä¸€ä¸ªkeyï¼Œå®ƒä»¬éƒ½ä¼šåŒ…å«æŒ‡å‘keyå¯¹åº”valueçš„æŒ‡é’ˆã€‚</li>\n</ul><p><strong>ä¸åŒä¹‹å¤„</strong>åœ¨äºï¼š</p><ul>\n<li>éå‹ç¼©èŠ‚ç‚¹æŒ‡å‘çš„å­èŠ‚ç‚¹ï¼Œæ¯ä¸ªå­èŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªå­—ç¬¦ï¼Œéå‹ç¼©èŠ‚ç‚¹å¯ä»¥æŒ‡å‘å¤šä¸ªå­èŠ‚ç‚¹ï¼›</li>\n<li>å‹ç¼©èŠ‚ç‚¹æŒ‡å‘çš„å­èŠ‚ç‚¹ï¼Œä»£è¡¨çš„æ˜¯ä¸€ä¸ªåˆå¹¶å­—ç¬¦ä¸²ï¼Œå‹ç¼©èŠ‚ç‚¹åªèƒ½æŒ‡å‘ä¸€ä¸ªå­èŠ‚ç‚¹ã€‚</li>\n</ul><p>è€Œé™¤äº†å­¦ä¹ raxNodeï¼Œæˆ‘è¿˜ç»™ä½ ä»‹ç»äº†ä¸‹Radix Treeä¸­å‡ ä¸ªåŸºæœ¬æ“ä½œå‡½æ•°çš„ä½œç”¨ï¼Œå¹¶å±•ç¤ºäº†Streamç±»å‹æ˜¯å¦‚ä½•æŠŠæ¶ˆæ¯IDå’Œæ¶ˆæ¯å†…å®¹ï¼Œåˆ†åˆ«ä¿å­˜åœ¨Radix Treeå’Œlistpackä¸­çš„ã€‚</p><p>è¿™é‡Œ<strong>ä½ è¦æ³¨æ„</strong>çš„æ˜¯ï¼Œå› ä¸ºRadix Treeåœ¨ä¿å­˜å…·æœ‰å…¬å…±å‰ç¼€çš„æ•°æ®æ—¶ï¼Œèƒ½æœ‰æ•ˆèŠ‚çœå†…å­˜å¼€é”€ã€‚åŒæ—¶ï¼ŒRadix Treeæœ¬èº«ä¹Ÿæ˜¯æœ‰åºçš„æ ‘å‹ç´¢å¼•ï¼Œå¯ä»¥æ”¯æŒå•ç‚¹å’ŒèŒƒå›´æŸ¥è¯¢ã€‚æ‰€ä»¥ï¼ŒRedisæŠŠæ¶ˆæ¯IDä¿å­˜åœ¨Radix Treeä¸­ï¼Œæ—¢å¯ä»¥èŠ‚çœå†…å­˜ç©ºé—´ï¼Œä¹Ÿèƒ½é«˜æ•ˆæ”¯æŒæ¶ˆæ¯IDçš„æŸ¥è¯¢ã€‚è€Œlistpackæœ¬èº«æ˜¯ç´§å‡‘åˆ—è¡¨ï¼Œåœ¨ä¿å­˜å¤§é‡æ¶ˆæ¯å†…å®¹çš„åŒæ—¶ï¼Œä¹Ÿèƒ½æœ‰æ•ˆèŠ‚çœå†…å­˜ã€‚</p><p>æ‰€ä»¥æˆ‘å¸Œæœ›ï¼Œä½ èƒ½é€šè¿‡Streamå¯¹Radix Treeå’Œlistpackçš„ä½¿ç”¨ï¼Œä¸¾ä¸€åä¸‰ï¼ŒæŠŠå®ƒä»¬ç”¨åœ¨ç›¸åº”çš„æ¶ˆæ¯å­˜å–æˆ–æ˜¯å¤§é‡å­—ç¬¦ä¸²å­˜å–çš„åœºæ™¯ä¸­ã€‚</p><h2>æ¯è¯¾ä¸€é—®</h2><p>ä½œä¸ºæœ‰åºç´¢å¼•ï¼ŒRadix Treeä¹Ÿèƒ½æä¾›èŒƒå›´æŸ¥è¯¢ï¼Œé‚£ä¹ˆä¸æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„B+æ ‘ï¼Œä»¥åŠ<a href=\"https://time.geekbang.org/column/article/404391\">ç¬¬5è®²</a>ä¸­ä»‹ç»çš„è·³è¡¨ç›¸æ¯”ï¼Œä½ è§‰å¾—Radix Treeæœ‰ä»€ä¹ˆä¼˜åŠ¿å’Œä¸è¶³å—ï¼Ÿ</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„ç­”æ¡ˆå’Œæ€è€ƒè¿‡ç¨‹ï¼Œå¦‚æœè§‰å¾—æœ‰æ”¶è·ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠä»Šå¤©çš„å†…å®¹åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ã€‚</p>","neighbors":{"left":{"article_title":"06 | ä»zipliståˆ°quicklistï¼Œå†åˆ°listpackçš„å¯å‘","id":405387},"right":{"article_title":"08 | Redis serverå¯åŠ¨åä¼šåšå“ªäº›æ“ä½œï¼Ÿ","id":406556}},"comments":[{"had_liked":false,"id":306404,"user_name":"Kaito","can_delete":false,"product_type":"c1","uid":1020042,"ip_address":"","ucode":"79775FA35A95F2","user_header":"https://static001.geekbang.org/account/avatar/00/0f/90/8a/288f9f94.jpg","comment_is_top":false,"comment_ctime":1628528823,"is_pvip":true,"discussion_count":3,"race_medal":0,"score":"78937940151","product_id":100084301,"comment_content":"ä½œä¸ºæœ‰åºç´¢å¼•ï¼ŒRadix Tree ä¹Ÿèƒ½æä¾›èŒƒå›´æŸ¥è¯¢ï¼Œå’Œæˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„ B+ æ ‘ï¼Œä»¥åŠç¬¬5è®²ä¸­ä»‹ç»çš„è·³è¡¨ç›¸æ¯”ï¼Œä½ è§‰å¾— Radix Tree æœ‰ä»€ä¹ˆä¼˜åŠ¿å’Œä¸è¶³ä¹ˆï¼Ÿ<br><br>1ã€Radix Tree ä¼˜åŠ¿<br><br>- æœ¬è´¨ä¸Šæ˜¯å‰ç¼€æ ‘ï¼Œæ‰€ä»¥å­˜å‚¨æœ‰ã€Œå…¬å…±å‰ç¼€ã€çš„æ•°æ®æ—¶ï¼Œæ¯” B+ æ ‘ã€è·³è¡¨èŠ‚çœå†…å­˜<br>- æ²¡æœ‰å…¬å…±å‰ç¼€çš„æ•°æ®é¡¹ï¼Œå‹ç¼©å­˜å‚¨ï¼Œvalue ç”¨ listpack å­˜å‚¨ï¼Œä¹Ÿå¯ä»¥èŠ‚çœå†…å­˜<br>- æŸ¥è¯¢å¤æ‚åº¦æ˜¯ O(K)ï¼Œåªä¸ã€Œç›®æ ‡é•¿åº¦ã€æœ‰å…³ï¼Œä¸æ€»æ•°æ®é‡æ— å…³<br>- è¿™ç§æ•°æ®ç»“æ„ä¹Ÿç»å¸¸ç”¨åœ¨æœç´¢å¼•æ“æç¤ºã€æ–‡å­—è‡ªåŠ¨è¡¥å…¨ç­‰åœºæ™¯<br><br>Stream åœ¨å­˜æ¶ˆæ¯æ—¶ï¼Œæ¨èä½¿ç”¨é»˜è®¤è‡ªåŠ¨ç”Ÿæˆçš„ã€Œæ—¶é—´æˆ³+åºå·ã€ä½œä¸ºæ¶ˆæ¯ IDï¼Œä¸å»ºè®®è‡ªå·±æŒ‡å®šæ¶ˆæ¯ IDï¼Œè¿™æ ·æ‰èƒ½å‘æŒ¥ Radix Tree å…¬å…±å‰ç¼€çš„ä¼˜åŠ¿ã€‚<br><br>2ã€Radix Tree ä¸è¶³<br><br>- å¦‚æœæ•°æ®é›†å…¬å…±å‰ç¼€è¾ƒå°‘ï¼Œä¼šå¯¼è‡´å†…å­˜å ç”¨å¤š<br>- å¢åˆ èŠ‚ç‚¹éœ€è¦å¤„ç†å…¶å®ƒèŠ‚ç‚¹çš„ã€Œåˆ†è£‚ã€åˆå¹¶ã€ï¼Œè·³è¡¨åªéœ€è°ƒæ•´å‰åæŒ‡é’ˆå³å¯<br>- B+ æ ‘ã€è·³è¡¨èŒƒå›´æŸ¥è¯¢å‹å¥½ï¼Œç›´æ¥éå†é“¾è¡¨å³å¯ï¼ŒRadix Tree éœ€éå†æ ‘ç»“æ„<br>- å®ç°éš¾åº¦é«˜æ¯” B+ æ ‘ã€è·³è¡¨å¤æ‚<br><br>æ¯ç§æ•°æ®ç»“æ„éƒ½æ˜¯åœ¨é¢å¯¹ä¸åŒé—®é¢˜åœºæ™¯ä¸‹ï¼Œæ‰è¢«è®¾è®¡å‡ºæ¥çš„ï¼Œç»“åˆå„è‡ªåœºæ™¯ä¸­çš„æ•°æ®ç‰¹ç‚¹ï¼Œä½¿ç”¨ä¼˜åŠ¿æœ€å¤§çš„æ•°æ®ç»“æ„æ‰æ˜¯æ­£è§£ã€‚","like_count":19,"discussions":[{"author":{"id":1365206,"avatar":"https://static001.geekbang.org/account/avatar/00/14/d4/d6/1d4543ac.jpg","nickname":"äº‘æµ·","note":"","ucode":"0C6CA0BE58EA21","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388846,"discussion_content":"è¯¾ä»£è¡¨å¥½ï¼Œæ–‡ç« æœ‰ä¸ªåœ°æ–¹æ²¡çœ‹æ‡‚ï¼Œèƒ½å¦è§£æƒ‘ã€‚\nâ€œæ‰€ä»¥ï¼Œåœ¨å®é™…ä½¿ç”¨ raxNode ç»“æ„ä¿å­˜æ•°æ®æ—¶ï¼ŒèŠ‚ç‚¹ dix ä¼šè¢«æ‹†ä¸ºèŠ‚ç‚¹ d å’Œ ixï¼ŒèŠ‚ç‚¹ ce ä¼šè¢«æ‹†ä¸ºèŠ‚ç‚¹ c å’Œ eâ€ï¼Œå¯¹äºè¿™ä¸ªè¯´æ˜ï¼Œå‰é¢æåˆ°äº†raxnodeçš„ä¸¤ä¸ªç‰¹ç‚¹ï¼Œç„¶åå¯¼è‡´è¿™æ ·çš„æ“ä½œã€‚\næœ‰ç‚¹æ²¡å¤ªæ˜ç™½ï¼Œè¿™ä¸¤ä¸ªç‰¹ç‚¹çš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆå‘¢ï¼Œæ„Ÿè§‰dixã€ce ä¸æ‹†åˆ†ä¸æ˜¯æ›´èŠ‚çœå†…å­˜å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629012468,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1665152,"avatar":"https://static001.geekbang.org/account/avatar/00/19/68/80/9dc18fb9.jpg","nickname":"åœŸåœŸåœŸ","note":"","ucode":"F4E47ADA8E380F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1365206,"avatar":"https://static001.geekbang.org/account/avatar/00/14/d4/d6/1d4543ac.jpg","nickname":"äº‘æµ·","note":"","ucode":"0C6CA0BE58EA21","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":392741,"discussion_content":"è¿™ä¸ªæˆ‘ä¹Ÿçœ‹äº†å¾ˆä¹…æ‰æ˜ç™½ï¼Œè¿™ä¸ªæ˜¯å› ä¸ºraxNodeç»“æ„ä¸­çš„dataå­—æ®µï¼Œä»–æ˜¯ä¸€ä¸ªunsigned charç±»å‹çš„æ•°ç»„ï¼Œå¦‚æœdixå’Œceä¸æ‹†çš„è¯ï¼Œåœ¨dataä¸­å°±æ˜¯{d, i, x, c, e, padding, dix_ptr, ce_ptr}ï¼Œè¿™æ ·å­˜æ ¹æœ¬ä¸çŸ¥é“dataåˆ°åº•å­˜çš„æ˜¯dixã€ceè¿˜æ˜¯diã€xceæˆ–æ˜¯å…¶ä»–çš„å½¢å¼ã€‚æ‰€ä»¥ä¸€å®šè¦æ‹†å¼€ï¼Œè¿™æ ·è¿™ä¸€å±‚çš„dataç»“æ„å°±æ˜¯{d, c, padding, d_ptr, c_ptr}ï¼Œæˆ‘å¯ä»¥æ¸…æ¥šçš„åŒºåˆ†å‡ºæ¥åé¢ä¸¤ä¸ªæŒ‡é’ˆæ˜¯ä»€ä¹ˆï¼Œç„¶åå†æ·»åŠ ä¸€å±‚ï¼Œdä¸‹é¢çš„dataå°±åªæœ‰ixäº†ï¼Œå®ƒçš„dataç»“æ„å°±æ˜¯{i, x, padding, ix_ptr}ï¼Œè¿™æ ·ä¹Ÿèƒ½æ¸…æ¥šçš„çŸ¥é“æœ€åçš„ptråˆ°åº•æŒ‡å‘çš„æ˜¯ä»€ä¹ˆã€‚","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1631108586,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":388846,"ip_address":""},"score":392741,"extra":""},{"author":{"id":1365917,"avatar":"https://static001.geekbang.org/account/avatar/00/14/d7/9d/3008ed30.jpg","nickname":"å°æ€ªå…½æ‰“å¥¥ç‰¹æ›¼","note":"","ucode":"364189B7BCB47C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1365206,"avatar":"https://static001.geekbang.org/account/avatar/00/14/d4/d6/1d4543ac.jpg","nickname":"äº‘æµ·","note":"","ucode":"0C6CA0BE58EA21","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556315,"discussion_content":"ä¸»è¦ä»raxNodeç»“æ„ä¸­çš„sizeç†è§£ï¼Œå‡å¦‚å‹ç¼©èŠ‚ç‚¹ï¼Œä¸”å¯ä»¥ä¿å­˜dixã€ceä¸¤ä¸ªèŠ‚ç‚¹å†…å®¹,sizeä¸º5ï¼Œå†…å®¹æ˜¯dixce,ä½†æ˜¯æ— æ³•å°†å†…å®¹è¿˜åŸï¼ˆsizeï¼šå¦‚æœå½“å‰èŠ‚ç‚¹æ˜¯å‹ç¼©èŠ‚ç‚¹ï¼Œè¯¥å€¼è¡¨ç¤ºå‹ç¼©æ•°æ®çš„é•¿åº¦ï¼‰ã€‚å¦‚æœ‰ä¸å¯¹ï¼Œè¯·æŒ‡æ­£\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647310137,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":388846,"ip_address":""},"score":556315,"extra":""}]}]},{"had_liked":false,"id":306581,"user_name":"æ›¾è½¼éºŸ","can_delete":false,"product_type":"c1","uid":1451391,"ip_address":"","ucode":"D418371AC11270","user_header":"https://static001.geekbang.org/account/avatar/00/16/25/7f/473d5a77.jpg","comment_is_top":false,"comment_ctime":1628613299,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"31693384371","product_id":100084301,"comment_content":"åœ¨é˜…è¯»çš„æ—¶å€™å…¶å®å·²ç»æœ‰æƒ³åˆ°Radix Treeï¼ŒB+æ ‘ å’Œè·³è¡¨ä¹‹é—´çš„åŒºåˆ«ï¼Œæ²¡æƒ³åˆ°è€å¸ˆæ–‡ç« æœ€ååˆšå¥½æåˆ°è¿™ä¸ªé—®é¢˜ï¼Œé‚£æˆ‘å°±ç«™åœ¨æˆ‘ä¸ªäººç†è§£çš„è§’åº¦å›åˆ°ä¸€ä¸‹æˆ‘çš„æƒ³æ³•ï¼Œé—®é¢˜æ˜¯ï¼šã€Radix Treeï¼ŒB+ å’Œè·³è·ƒè¡¨ä¹‹é—´çš„åŒºåˆ«ã€‘<br><br>ã€æˆ‘åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªé—®é¢˜è‡ªé—®è‡ªç­”å¸¦å‡ºæˆ‘çš„æƒ³æ³•å’Œæ€è€ƒçš„è§’åº¦ã€‘<br><br>é—®é¢˜ä¸€ï¼šB+æ ‘å’Œè·³è·ƒè¡¨æœ‰ä»€ä¹ˆå…³è”ï¼Ÿ<br>\tç­”ï¼š <br>\t\t1ã€B+æ ‘å’Œè·³è·ƒè¡¨è¿™ä¸¤ç§æ•°æ®ç»“æ„åœ¨æœ¬èº«è®¾è®¡ä¸Šæ˜¯æœ‰äº²ç¼˜å…³ç³»çš„ï¼Œå…¶å®å¦‚æœæŠŠB+æ ‘æ‹‰ç›´æ¥çœ‹ä¸éš¾å‘ç°å…¶ç»“æ„å’Œè·³è·ƒè¡¨å¾ˆç›¸ä¼¼ï¼Œç”šè‡³B+æ ‘çš„çˆ¶äº²ç»“ç‚¹å…¶å®ç±»ä¼¼è·³è·ƒè¡¨çš„levelå±‚çº§ã€‚<br>\t\t2ã€åœ¨å½“å‰è®¡ç®—æœºç¡¬ä»¶å­˜å‚¨è®¾è®¡ä¸Šï¼ŒB+æ ‘èƒ½æ¯”è·³è¡¨å­˜å‚¨æ›´å¤§é‡çº§çš„æ•°æ®ï¼Œå› ä¸ºè·³è¡¨éœ€è¦é€šè¿‡å¢åŠ å±‚é«˜æ¥æé«˜ç´¢å¼•æ•ˆç‡ï¼Œè€ŒB+æ ‘åªéœ€è¦å¢åŠ æ ‘çš„æ·±åº¦ã€‚æ­¤å¤–B+æ ‘åŒä¸€å¶å­çš„è¿ç»­æ€§æ›´åŠ ç¬¦åˆå½“ä»£è®¡ç®—æœºçš„å­˜å‚¨ç»“æ„ã€‚ç„¶è€Œè·³è¡¨çš„å±‚é«˜å…·æœ‰éšæœºæ€§ï¼Œå½“å±‚é«˜è¾ƒå¤§çš„æ—¶å€™ç£ç›˜æ’å…¥ä¼šå¸¦æ¥ä¸€å®šçš„å¼€é”€ï¼Œä¸”ä¸åˆ©äºåˆ†å—ã€‚<br><br>é—®é¢˜äºŒï¼šé‚£ä¹ˆä¸ºä»€ä¹ˆRedisä¸ä½¿ç”¨B+æ ‘å‘¢è€Œé€‰æ‹©è·³è¡¨å‘¢ï¼Ÿ<br>\tç­”ï¼šå› ä¸ºæ•°æ®æœ‰åºæ€§çš„å®ç°B+æ ‘ä¸å¦‚è·³è¡¨ï¼Œè·³è¡¨çš„æ—¶é—´æ€§èƒ½æ˜¯ä¼˜äºB+æ ‘çš„ï¼ˆB+æ ‘ä¸æ˜¯äºŒå‰æ ‘ï¼ŒäºŒåˆ†çš„æ•ˆç‡æ˜¯æ¯”è¾ƒé«˜çš„ï¼‰ã€‚æ­¤å¤–è·³è¡¨æœ€ä½å±‚å°±æ˜¯ä¸€æ¡é“¾è¡¨ï¼Œå¯¹äºéœ€è¦å®ç°èŒƒå›´æŸ¥è¯¢çš„åŠŸèƒ½æ˜¯æ¯”è¾ƒæœ‰åˆ©çš„ï¼Œè€Œä¸”Redisæ˜¯åŸºäºå†…å­˜è®¾è®¡çš„ï¼Œæ— éœ€è€ƒè™‘æµ·é‡æ•°æ®çš„åœºæ™¯ã€‚<br><br>é—®é¢˜ä¸‰ï¼šRadix Treeä¼˜åŠ¿åœ¨å“ªï¼Ÿ<br>\tç­”ï¼š<br>\t\t1ã€å½“å­˜å‚¨å¤§é‡keyå­—ç¬¦ä¸²å¾ˆé•¿çš„æ—¶å€™è·³è¡¨ä¸å¦‚å‰ç¼€æ ‘ï¼Œç”šè‡³ä¸åˆ©äºå®ç°è¿™ç§åœºæ™¯ï¼Œå› ä¸ºè·³è¡¨å±‚é«˜æœ‰æœ€å¤§é™åˆ¶ï¼Œæ­¤å¤–è·³è¡¨ä¸èƒ½å¾ˆå¥½çš„æ ‡è¯†keyçš„å­—ç¬¦ä¸²é¡ºåºï¼Œä¸åƒå‰ç¼€æ ‘å¯ä»¥ä»æ ¹ç›®å½•ä¸‹è·¯å°±æ˜¯å­—ç¬¦é¡ºåºã€‚<br>\t\t2ã€åœ¨å†…å­˜ç¯å¢ƒä¸‹ï¼Œå‰ç¼€æ ‘æ˜¯äºŒå‰æ ‘ï¼Œè€ŒB+æ ‘ä¸æ˜¯ï¼Œè¿™æ ·ä¸€æ¥å½“å¯¹äºkeyçš„ç´¢å¼•æ•ˆæœæ¥è¯´ï¼Œå‰ç¼€æ ‘ä¼šæ¯”B+æ ‘ç´¢å¼•æ•ˆæœæ›´å¥½ï¼ˆç±»æ¯”ï¼šæ–°åå­—å…¸ç›®å½•è¶Šä¸°å¯Œï¼Œé€šè¿‡ç›®å½•å¿«é€Ÿå®šä½åˆ°ç›®æ ‡å­—çš„æ¦‚ç‡æ›´é«˜ï¼‰ã€‚<br><br>é—®é¢˜å››ï¼šRadix TreeåŠ£åŠ¿åœ¨å“ªï¼Ÿ<br>\tç­”ï¼š<br>\t\t1ã€Radix Treeèƒ½ä¿è¯åœ¨ç´¢å¼•keyçš„å‰ç¼€é¡ºåºï¼Œä½†æ˜¯åœ¨ä¿è¯æ•°æ®é¡ºåºä¸”è¿ç»­æ€§ä¸Šä¸å¦‚è·³è¡¨ã€‚<br>\t\t2ã€æŸ¥è¯¢æ€§èƒ½ä¸Šå­˜åœ¨æ¬ ç¼ºï¼Œè™½ç„¶æ˜¯äºŒå‰æ ‘ä½†æ˜¯å½“è®¿é—®ä¸€ä¸ªkeyçš„æ—¶å€™æ¯æ¬¡éƒ½éœ€è¦ä¾æ¬¡è®¿é—®å‰ç¼€å­—ç¬¦ï¼Œä¸å¦‚hashè¡¨å¯¹æ•´ä¸ªkeyçš„ç›´æ¥ç´¢å¼•ã€‚<br>\t\t3ã€ä¸é€‚åˆå­˜å‚¨åƒUUIDç­‰ï¼Œéå¯¹ç§°ç»“æ„çš„keyï¼ˆè€Œä¸”ä½¿ç”¨æ—¶å€™å»ºè®®è®©Redisè‡ªåŠ¨ç”Ÿæˆï¼‰ã€‚","like_count":7,"discussions":[{"author":{"id":1365206,"avatar":"https://static001.geekbang.org/account/avatar/00/14/d4/d6/1d4543ac.jpg","nickname":"äº‘æµ·","note":"","ucode":"0C6CA0BE58EA21","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388844,"discussion_content":"ä¸ºä»€ä¹ˆè¯´å‰ç¼€æ ‘æ˜¯äºŒå‰æ ‘å‘¢ï¼Œå¦‚æœredisã€rubyã€rarï¼Œè¿™æ ·ç¬¬ä¸€ä¸ªrä¸‹å°±æ˜¯å¤šå‰æ ‘å§","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1629012171,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1451391,"avatar":"https://static001.geekbang.org/account/avatar/00/16/25/7f/473d5a77.jpg","nickname":"æ›¾è½¼éºŸ","note":"","ucode":"D418371AC11270","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1365206,"avatar":"https://static001.geekbang.org/account/avatar/00/14/d4/d6/1d4543ac.jpg","nickname":"äº‘æµ·","note":"","ucode":"0C6CA0BE58EA21","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":396714,"discussion_content":"æ„Ÿè°¢æŒ‡å‡ºï¼Œè¿™é‡Œç¡®å®æ˜¯æˆ‘çš„é”™ï¼ŒåŸºæ•°æ ‘ç¡®å®æ˜¯å¤šå‰æ ‘ã€‚è¿™æ ·äºŒå‰æ ‘çš„ä¼˜åŠ¿ç‚¹ä¹Ÿå°±ä¸æˆç«‹äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632482162,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":388844,"ip_address":""},"score":396714,"extra":""},{"author":{"id":1451391,"avatar":"https://static001.geekbang.org/account/avatar/00/16/25/7f/473d5a77.jpg","nickname":"æ›¾è½¼éºŸ","note":"","ucode":"D418371AC11270","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1365206,"avatar":"https://static001.geekbang.org/account/avatar/00/14/d4/d6/1d4543ac.jpg","nickname":"äº‘æµ·","note":"","ucode":"0C6CA0BE58EA21","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":396716,"discussion_content":"æŠ±æ­‰ä¹‹å‰æœ‰ç‚¹å¿™å¿½ç•¥äº†è¿™æ¡ç•™è¨€ï¼Œä»Šå¤©æ‰çœ‹åˆ°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632482483,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":388844,"ip_address":""},"score":396716,"extra":""}]}]},{"had_liked":false,"id":306511,"user_name":"å¯æ€œå¤§ç°ç‹¼","can_delete":false,"product_type":"c1","uid":1928373,"ip_address":"","ucode":"6CA9D6D460B967","user_header":"https://static001.geekbang.org/account/avatar/00/1d/6c/b5/32374f93.jpg","comment_is_top":false,"comment_ctime":1628589448,"is_pvip":true,"discussion_count":4,"race_medal":0,"score":"10218524040","product_id":100084301,"comment_content":"æœ€åä¸€ä¸ªå›¾æœ‰ç‚¹æ‡µã€‚listpacké‚£é‡Œä¸åº”è¯¥ç”»listpackå†…å­˜ç»“æ„ä¹ˆï¼Ÿç„¶ålistpackçš„master entryæ”¾keyï¼Œåé¢çš„entryæ”¾valueã€‚æˆ‘æ€ä¹ˆæ„Ÿè§‰åˆæ˜¯ä¸€ä¸ªraxNodeã€‚","like_count":2,"discussions":[{"author":{"id":2719230,"avatar":"https://static001.geekbang.org/account/avatar/00/29/7d/fe/2220c6cf.jpg","nickname":"åœŸè±†ç§å—åŸ","note":"","ucode":"0CE8E5EDEB452B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389132,"discussion_content":"åŒæ„Ÿï¼Œæ„Ÿè§‰é‚£é‡Œæ˜¯ç”»é”™äº†ï¼Œæˆ‘è¿˜ä¸“é—¨å›å»çœ‹äº†ä¸‹listpackçš„ç»“æ„ï¼Œæ²¡çœ‹æ‡‚ï¼Œå¸Œæœ›è€å¸ˆè¡¥å……","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1629127482,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1024994,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a3/e2/5cb4f43f.jpg","nickname":"laolinshi","note":"","ucode":"269B879389D7D5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559789,"discussion_content":"master entry æ˜¯ä»€ä¹ˆæ„æ€ï¼Œä¸ç†è§£ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648968928,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1107305,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e5/69/719ec5d0.jpg","nickname":"Jian","note":"","ucode":"17ED4919F22DEC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555919,"discussion_content":"+1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647101002,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2350230,"avatar":"https://static001.geekbang.org/account/avatar/00/23/dc/96/9501cd87.jpg","nickname":"æ— ç—•ä¹‹æ„","note":"","ucode":"8AF05C8C813352","race_medal":3,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551004,"discussion_content":"åŒæ„Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644844234,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":307097,"user_name":"Miroticwillbeforever","can_delete":false,"product_type":"c1","uid":2488913,"ip_address":"","ucode":"1DDD8AECD93EA8","user_header":"https://static001.geekbang.org/account/avatar/00/25/fa/51/5da91010.jpg","comment_is_top":false,"comment_ctime":1628858877,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5923826173","product_id":100084301,"comment_content":"è¿™ä¸€ç¯‡æ–‡ç« è®²çš„å¾ˆé€å½»ï¼ï¼ï¼<br>ç¬¬ä¸€æ¬¡çœ‹å°±è¢«æƒŠè‰³åˆ°äº†ã€‚ã€‚å¥½ä¸œè¥¿ï¼","like_count":1,"discussions":[{"author":{"id":1657561,"avatar":"https://static001.geekbang.org/account/avatar/00/19/4a/d9/b8046b4b.jpg","nickname":"zhangm365","note":"","ucode":"60E7DEFB3F5840","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":533991,"discussion_content":"å±…ç„¶æ²¡çœ‹æ‡‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638065619,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":352390,"user_name":"ğŸ¤","can_delete":false,"product_type":"c1","uid":1804626,"ip_address":"","ucode":"17D997E499E651","user_header":"https://static001.geekbang.org/account/avatar/00/1b/89/52/b96c272d.jpg","comment_is_top":false,"comment_ctime":1658635721,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1658635721","product_id":100084301,"comment_content":"å¯ä»¥ç»´æŒæ’å…¥æœ‰åº å› ä¸ºæˆ‘æœ€è¿‘åœ¨æå†…å­˜æ•°æ®åº“ å†ç”¨ä¸¤ä¸ªæŒ‡é’ˆç»´æŠ¤æ‰€æœ‰çš„key è¿™æ ·å°±æ˜¯æ’å…¥æœ‰åºäº†","like_count":0},{"had_liked":false,"id":352389,"user_name":"ğŸ¤","can_delete":false,"product_type":"c1","uid":1804626,"ip_address":"","ucode":"17D997E499E651","user_header":"https://static001.geekbang.org/account/avatar/00/1b/89/52/b96c272d.jpg","comment_is_top":false,"comment_ctime":1658635597,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1658635597","product_id":100084301,"comment_content":"çœ‹åˆ°æœ€åå‘ç°ä¸èƒ½æ’åº æœ‰ç‚¹å¤±æœ› ","like_count":0},{"had_liked":false,"id":329763,"user_name":"æƒ˜ é—»","can_delete":false,"product_type":"c1","uid":1181650,"ip_address":"","ucode":"C5909F034BF072","user_header":"https://static001.geekbang.org/account/avatar/00/12/07/d2/0d7ee298.jpg","comment_is_top":false,"comment_ctime":1641528225,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1641528225","product_id":100084301,"comment_content":"ä¸€æ–¹é¢ï¼ŒRadix Tree éå¶å­èŠ‚ç‚¹ï¼Œè¦ä¸ç„¶æ˜¯å‹ç¼©èŠ‚ç‚¹ï¼ŒåªæŒ‡å‘å•ä¸ªå­èŠ‚ç‚¹ï¼Œè¦ä¸ç„¶æ˜¯éå‹ç¼©èŠ‚ç‚¹ï¼ŒæŒ‡å‘å¤šä¸ªå­èŠ‚ç‚¹ï¼Œä½†æ¯ä¸ªå­èŠ‚ç‚¹åªè¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ã€‚æ‰€ä»¥ï¼Œéå¶å­èŠ‚ç‚¹æ— æ³•åŒæ—¶æŒ‡å‘è¡¨ç¤ºå•ä¸ªå­—ç¬¦çš„å­èŠ‚ç‚¹å’Œè¡¨ç¤ºåˆå¹¶å­—ç¬¦ä¸²çš„å­èŠ‚ç‚¹ã€‚<br>è¿™å¥è¯å¦‚ä½•å¾—åˆ°çš„ç»“è®ºï¼Œçœ‹äº†å‡ éæ²¡çœ‹æ˜ç™½å› æœå…³ç³»ã€‚","like_count":0},{"had_liked":false,"id":307662,"user_name":"æ— é£","can_delete":false,"product_type":"c1","uid":1721922,"ip_address":"","ucode":"E131BEB496DCED","user_header":"https://static001.geekbang.org/account/avatar/00/1a/46/42/eaa0cc92.jpg","comment_is_top":false,"comment_ctime":1629193290,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"1629193290","product_id":100084301,"comment_content":"ä¸ºä»€ä¹ˆæ¯ä¸ªraxNodeè¦å­˜å­èŠ‚ç‚¹çš„å­—ç¬¦å‘¢ï¼Ÿä¸ºä»€ä¹ˆä¸èƒ½è‡ªå·±å­˜è‡ªå·±ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1665152,"avatar":"https://static001.geekbang.org/account/avatar/00/19/68/80/9dc18fb9.jpg","nickname":"åœŸåœŸåœŸ","note":"","ucode":"F4E47ADA8E380F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":392742,"discussion_content":"å¯ä»¥ç†è§£ä¸€ä¸‹å‰ç¼€æ ‘çš„å®ç°ï¼ŒraxNodeå­˜å­èŠ‚ç‚¹çš„é€»è¾‘å’Œå‰ç¼€æ ‘æ˜¯ä¸€æ ·çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631108641,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1133945,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4d/79/803537db.jpg","nickname":"æ…¢åŠ¨ä½œ","note":"","ucode":"62C944F4A4D8AC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390932,"discussion_content":"î˜\nç›¸æ¯”å­˜åœ¨å­èŠ‚ç‚¹ï¼Œå ç©ºé—´ä¸€è‡´ï¼Œä½†æ˜¯æŸ¥æ‰¾æ—¶å­èŠ‚ç‚¹å†…å®¹å¯èƒ½åœ¨cpuç¼“å­˜è¡Œï¼Œæ•ˆç‡æ›´é«˜ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630153065,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2420294,"avatar":"https://static001.geekbang.org/account/avatar/00/24/ee/46/7d65ae37.jpg","nickname":"æœ¨å‡ ä¸¶","note":"","ucode":"FFDB958DA64F8C","race_medal":5,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389858,"discussion_content":"ä¸å­˜æ€ä¹ˆçŸ¥é“ä¸‹ä¸€å±‚èµ°å“ªä¸ªå­èŠ‚ç‚¹å‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629452041,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2028956,"avatar":"","nickname":"å‹¿æ›´æ”¹ä»»ä½•ä¿¡æ¯","note":"","ucode":"575185C69C05A3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2420294,"avatar":"https://static001.geekbang.org/account/avatar/00/24/ee/46/7d65ae37.jpg","nickname":"æœ¨å‡ ä¸¶","note":"","ucode":"FFDB958DA64F8C","race_medal":5,"user_type":1,"is_pvip":true},"discussion":{"id":393894,"discussion_content":"å³å­˜äº†æŒ‡å‘å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œåˆå­˜äº†å­èŠ‚ç‚¹çš„å­—ç¬¦ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631629391,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":389858,"ip_address":""},"score":393894,"extra":""}]}]},{"had_liked":false,"id":306483,"user_name":"Ethan New","can_delete":false,"product_type":"c1","uid":2063962,"ip_address":"","ucode":"9CA2EF39E58030","user_header":"https://static001.geekbang.org/account/avatar/00/1f/7e/5a/da39f489.jpg","comment_is_top":false,"comment_ctime":1628580684,"is_pvip":true,"discussion_count":2,"race_medal":4,"score":"1628580684","product_id":100084301,"comment_content":"è¿™ä¸ªè¯¾çš„å†…å®¹ä¹‹å‰ä¸å¤ªäº†è§£ï¼Œå¾—å¤šçœ‹å‡ éæ‰èƒ½ç†è§£ï¼Œæˆ‘å¤ªèœäº†ã€‚ã€‚ã€‚","like_count":0,"discussions":[{"author":{"id":2350230,"avatar":"https://static001.geekbang.org/account/avatar/00/23/dc/96/9501cd87.jpg","nickname":"æ— ç—•ä¹‹æ„","note":"","ucode":"8AF05C8C813352","race_medal":3,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551005,"discussion_content":"Me Too","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644844263,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1111974,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/a6/c863c65b.jpg","nickname":"è¥¿ç“œåˆ€","note":"","ucode":"3978348547499D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389377,"discussion_content":" è¦æŠŠæ•°æ®ç»“æ„åŸºæœ¬çŸ¥è¯†å›é¡¾ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629256557,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}