{"id":269150,"title":"37 | SaaS项目healthchecks.io的背景和架构（下）","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-distributed\">https://gitee.com/geektime-geekbang/geektime-distributed</a></p>","comments":[{"had_liked":false,"id":247596,"user_name":"永昌","can_delete":false,"product_type":"c3","uid":1025006,"ip_address":"","ucode":"A572DDE33DFAD9","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a3/ee/636415d8.jpg","comment_is_top":false,"comment_ctime":1599751682,"is_pvip":false,"replies":[{"id":91017,"content":"有两个措施防止你说的问题：\n1. healthchecks.io对ping的频率有限制，我记得最小粒度是1分钟间隔。\n2. check可以设置grace period，也就是允许ping迟到的时间范围。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1599918366,"ip_address":"","comment_id":247596,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100053601,"comment_content":"关于ping请求的入库，是异步延时，那么如果ping频率高的请求，在check的时候，可能还没入库，不就触发了警告了么？","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505445,"discussion_content":"有两个措施防止你说的问题：\n1. healthchecks.io对ping的频率有限制，我记得最小粒度是1分钟间隔。\n2. check可以设置grace period，也就是允许ping迟到的时间范围。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599918366,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":300904,"user_name":"Geek2808","can_delete":false,"product_type":"c3","uid":2028948,"ip_address":"","ucode":"835C9691723163","user_header":"","comment_is_top":false,"comment_ctime":1625448599,"is_pvip":false,"replies":[{"id":110362,"content":"ping一般只能检测简单的存活，开发定制的健康检查端点可以获取更细粒度的健康信息，如SpringBoot支持用户开发定制的健康检查逻辑，可以定制磁盘利用率，数据库连接，缓存连接等更细粒度的健康检查信息。\n","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1627832138,"ip_address":"","comment_id":300904,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100053601,"comment_content":"能否解释一下开放健康检查接口和 ping 检查中心两种方式的优缺点","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522848,"discussion_content":"ping一般只能检测简单的存活，开发定制的健康检查端点可以获取更细粒度的健康信息，如SpringBoot支持用户开发定制的健康检查逻辑，可以定制磁盘利用率，数据库连接，缓存连接等更细粒度的健康检查信息。\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627832138,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":269331,"user_name":"邸昆","can_delete":false,"product_type":"c3","uid":1054596,"ip_address":"","ucode":"5A6D1275D7A79A","user_header":"https://static001.geekbang.org/account/avatar/00/10/17/84/b4bc1395.jpg","comment_is_top":false,"comment_ctime":1608615183,"is_pvip":false,"replies":[{"id":97884,"content":"SaaS公司开始起步，一般都是一套DB逻辑隔离，简单成本低。到了一定的规模，有钱有人了，可以考虑私有部署物理隔离，这时候成本复杂性也上去了。通常做法是对用户分层，免费和低端用户使用共享的逻辑隔离，中高端付费用户进行私有部署物理隔离。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1608904628,"ip_address":"","comment_id":269331,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100053601,"comment_content":"SaaS的核心点在于多租户，从架构介绍上看没有看到租户隔离的相关设计，从商业的视角付费用户和免费用户使用肯定要隔离开，否则付费的爸爸们不开心。从现在架构介绍上看，基于消息队列可以基于partition打散，减缓一些互相影响的情况，但是不可能无限多partition，还是无法完全避免相互影响。请问老师，针对租户间隔离，租户间影响这块，您有什么好的建议么？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":512239,"discussion_content":"SaaS公司开始起步，一般都是一套DB逻辑隔离，简单成本低。到了一定的规模，有钱有人了，可以考虑私有部署物理隔离，这时候成本复杂性也上去了。通常做法是对用户分层，免费和低端用户使用共享的逻辑隔离，中高端付费用户进行私有部署物理隔离。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608904628,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":250542,"user_name":"姑射仙人","can_delete":false,"product_type":"c3","uid":1008517,"ip_address":"","ucode":"3EFC1F3E592165","user_header":"https://static001.geekbang.org/account/avatar/00/0f/63/85/1dc41622.jpg","comment_is_top":false,"comment_ctime":1601125111,"is_pvip":false,"replies":[{"id":91756,"content":"SaaS = Software as a Service，把传统的软件产品，做成多租户通用版，部署在云端提供共享服务的形式，就可以称为SaaS。\n\nhealthchecks.io是一个轻量级的SaaS服务，它把对周期性任务(scheduled job)的健康检查，做成了一种云服务，大家可以共用，不需要每个企业再去部署一套。\n\nhealthchecks.io属于监控类SaaS产品。同样，sentry.io也是监控类SaaS产品，它把异常日志监控做成了一种云服务。还有auth0.com把企业身份认证做成了云服务，launchdarkly.com把功能开关做成了一种云服务，等等。\n\n\n\n","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1601215425,"ip_address":"","comment_id":250542,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100053601,"comment_content":"老师，我认为healthchecks不是一个SaaS应用，更像是一个传统的多用户服务端系统。如何理解、定义一个SaaS系统呢？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506231,"discussion_content":"SaaS = Software as a Service，把传统的软件产品，做成多租户通用版，部署在云端提供共享服务的形式，就可以称为SaaS。\n\nhealthchecks.io是一个轻量级的SaaS服务，它把对周期性任务(scheduled job)的健康检查，做成了一种云服务，大家可以共用，不需要每个企业再去部署一套。\n\nhealthchecks.io属于监控类SaaS产品。同样，sentry.io也是监控类SaaS产品，它把异常日志监控做成了一种云服务。还有auth0.com把企业身份认证做成了云服务，launchdarkly.com把功能开关做成了一种云服务，等等。\n\n\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601215425,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":240855,"user_name":"tt","can_delete":false,"product_type":"c3","uid":1489957,"ip_address":"","ucode":"7753B79AD5A9AC","user_header":"https://static001.geekbang.org/account/avatar/00/16/bc/25/1c92a90c.jpg","comment_is_top":false,"comment_ctime":1597105185,"is_pvip":false,"replies":[{"id":89081,"content":"如果checks数量非常多，DB会成为瓶颈，这个时候有两个办法：\n\n1. 采用类似killbill common queue的sticky polling技术，每个机器只处理本机写入的checks，这样相当于把 checks做了逻辑分组和负载分摊。\n\n2. 对DB进行分片sharding，然后不同的告警检查任务(alert checker)分别处理不同的DB shard，分摊负载。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1597159396,"ip_address":"","comment_id":240855,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100053601,"comment_content":"老师，数据库是不是会成为瓶颈？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503578,"discussion_content":"如果checks数量非常多，DB会成为瓶颈，这个时候有两个办法：\n\n1. 采用类似killbill common queue的sticky polling技术，每个机器只处理本机写入的checks，这样相当于把 checks做了逻辑分组和负载分摊。\n\n2. 对DB进行分片sharding，然后不同的告警检查任务(alert checker)分别处理不同的DB shard，分摊负载。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597159396,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}