{"id":42076,"title":"25 | æ·±å…¥è§£æå£°æ˜å¼APIï¼ˆäºŒï¼‰ï¼šç¼–å†™è‡ªå®šä¹‰æ§åˆ¶å™¨","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å¼ ç£Šã€‚ä»Šå¤©æˆ‘å’Œä½ åˆ†äº«çš„ä¸»é¢˜æ˜¯ï¼šæ·±å…¥è§£æå£°æ˜å¼APIä¹‹ç¼–å†™è‡ªå®šä¹‰æ§åˆ¶å™¨ã€‚</p><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å’Œä½ è¯¦ç»†åˆ†äº«äº†Kubernetesä¸­å£°æ˜å¼APIçš„å®ç°åŸç†ï¼Œå¹¶ä¸”é€šè¿‡ä¸€ä¸ªæ·»åŠ Networkå¯¹è±¡çš„å®ä¾‹ï¼Œä¸ºä½ è®²è¿°äº†åœ¨Kubernetesé‡Œæ·»åŠ APIèµ„æºçš„è¿‡ç¨‹ã€‚</p><p>åœ¨ä»Šå¤©çš„è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°±ç»§ç»­å’Œä½ ä¸€èµ·å®Œæˆå‰©ä¸‹ä¸€åŠçš„å·¥ä½œï¼Œå³ï¼šä¸ºNetworkè¿™ä¸ªè‡ªå®šä¹‰APIå¯¹è±¡ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰æ§åˆ¶å™¨ï¼ˆCustom Controllerï¼‰ã€‚</p><p>æ­£å¦‚æˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ç»“å°¾å¤„æåˆ°çš„ï¼Œâ€œå£°æ˜å¼APIâ€å¹¶ä¸åƒâ€œå‘½ä»¤å¼APIâ€é‚£æ ·æœ‰ç€æ˜æ˜¾çš„æ‰§è¡Œé€»è¾‘ã€‚è¿™å°±ä½¿å¾—<strong>åŸºäºå£°æ˜å¼APIçš„ä¸šåŠ¡åŠŸèƒ½å®ç°ï¼Œå¾€å¾€éœ€è¦é€šè¿‡æ§åˆ¶å™¨æ¨¡å¼æ¥â€œç›‘è§†â€APIå¯¹è±¡çš„å˜åŒ–ï¼ˆæ¯”å¦‚ï¼Œåˆ›å»ºæˆ–è€…åˆ é™¤Networkï¼‰ï¼Œç„¶åä»¥æ­¤æ¥å†³å®šå®é™…è¦æ‰§è¡Œçš„å…·ä½“å·¥ä½œã€‚</strong></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°±å’Œä½ ä¸€èµ·é€šè¿‡ç¼–å†™ä»£ç æ¥å®ç°è¿™ä¸ªè¿‡ç¨‹ã€‚è¿™ä¸ªé¡¹ç›®å’Œä¸Šä¸€ç¯‡æ–‡ç« é‡Œçš„ä»£ç æ˜¯åŒä¸€ä¸ªé¡¹ç›®ï¼Œä½ å¯ä»¥ä»<a href=\"https://github.com/resouer/k8s-controller-custom-resource\">è¿™ä¸ªGitHubåº“</a>é‡Œæ‰¾åˆ°å®ƒä»¬ã€‚æˆ‘åœ¨ä»£ç é‡Œè¿˜åŠ ä¸Šäº†ä¸°å¯Œçš„æ³¨é‡Šï¼Œä½ å¯ä»¥éšæ—¶å‚è€ƒã€‚</p><p>æ€»å¾—æ¥è¯´ï¼Œç¼–å†™è‡ªå®šä¹‰æ§åˆ¶å™¨ä»£ç çš„è¿‡ç¨‹åŒ…æ‹¬ï¼šç¼–å†™mainå‡½æ•°ã€ç¼–å†™è‡ªå®šä¹‰æ§åˆ¶å™¨çš„å®šä¹‰ï¼Œä»¥åŠç¼–å†™æ§åˆ¶å™¨é‡Œçš„ä¸šåŠ¡é€»è¾‘ä¸‰ä¸ªéƒ¨åˆ†ã€‚</p><p><span class=\"orange\">é¦–å…ˆï¼Œæˆ‘ä»¬æ¥ç¼–å†™è¿™ä¸ªè‡ªå®šä¹‰æ§åˆ¶å™¨çš„mainå‡½æ•°ã€‚</span></p><!-- [[[read_end]]] --><p>mainå‡½æ•°çš„ä¸»è¦å·¥ä½œå°±æ˜¯ï¼Œå®šä¹‰å¹¶åˆå§‹åŒ–ä¸€ä¸ªè‡ªå®šä¹‰æ§åˆ¶å™¨ï¼ˆCustom Controllerï¼‰ï¼Œç„¶åå¯åŠ¨å®ƒã€‚è¿™éƒ¨åˆ†ä»£ç çš„ä¸»è¦å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>func main() {\n  ...\n  \n  cfg, err := clientcmd.BuildConfigFromFlags(masterURL, kubeconfig)\n  ...\n  kubeClient, err := kubernetes.NewForConfig(cfg)\n  ...\n  networkClient, err := clientset.NewForConfig(cfg)\n  ...\n  \n  networkInformerFactory := informers.NewSharedInformerFactory(networkClient, ...)\n  \n  controller := NewController(kubeClient, networkClient,\n  networkInformerFactory.Samplecrd().V1().Networks())\n  \n  go networkInformerFactory.Start(stopCh)\n \n  if err = controller.Run(2, stopCh); err != nil {\n    glog.Fatalf(&quot;Error running controller: %s&quot;, err.Error())\n  }\n}\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªmainå‡½æ•°ä¸»è¦é€šè¿‡ä¸‰æ­¥å®Œæˆäº†åˆå§‹åŒ–å¹¶å¯åŠ¨ä¸€ä¸ªè‡ªå®šä¹‰æ§åˆ¶å™¨çš„å·¥ä½œã€‚</p><p><strong>ç¬¬ä¸€æ­¥</strong>ï¼šmainå‡½æ•°æ ¹æ®æˆ‘æä¾›çš„Masteré…ç½®ï¼ˆAPIServerçš„åœ°å€ç«¯å£å’Œkubeconfigçš„è·¯å¾„ï¼‰ï¼Œåˆ›å»ºä¸€ä¸ªKubernetesçš„clientï¼ˆkubeClientï¼‰å’ŒNetworkå¯¹è±¡çš„clientï¼ˆnetworkClientï¼‰ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘æ²¡æœ‰æä¾›Masteré…ç½®å‘¢ï¼Ÿ</p><p>è¿™æ—¶ï¼Œmainå‡½æ•°ä¼šç›´æ¥ä½¿ç”¨ä¸€ç§åå«<strong>InClusterConfig</strong>çš„æ–¹å¼æ¥åˆ›å»ºè¿™ä¸ªclientã€‚è¿™ä¸ªæ–¹å¼ï¼Œä¼šå‡è®¾ä½ çš„è‡ªå®šä¹‰æ§åˆ¶å™¨æ˜¯ä»¥Podçš„æ–¹å¼è¿è¡Œåœ¨Kubernetesé›†ç¾¤é‡Œçš„ã€‚</p><p>è€Œæˆ‘åœ¨ç¬¬15ç¯‡æ–‡ç« <a href=\"https://time.geekbang.org/column/article/40466\">ã€Šæ·±å…¥è§£æPodå¯¹è±¡ï¼ˆäºŒï¼‰ï¼šä½¿ç”¨è¿›é˜¶ã€‹</a>ä¸­æ›¾ç»æåˆ°è¿‡ï¼ŒKubernetes é‡Œæ‰€æœ‰çš„Podéƒ½ä¼šä»¥Volumeçš„æ–¹å¼è‡ªåŠ¨æŒ‚è½½Kubernetesçš„é»˜è®¤ServiceAccountã€‚æ‰€ä»¥ï¼Œè¿™ä¸ªæ§åˆ¶å™¨å°±ä¼šç›´æ¥ä½¿ç”¨é»˜è®¤ServiceAccountæ•°æ®å·é‡Œçš„æˆæƒä¿¡æ¯ï¼Œæ¥è®¿é—®APIServerã€‚</p><p><strong>ç¬¬äºŒæ­¥</strong>ï¼šmainå‡½æ•°ä¸ºNetworkå¯¹è±¡åˆ›å»ºä¸€ä¸ªå«ä½œInformerFactoryï¼ˆå³ï¼šnetworkInformerFactoryï¼‰çš„å·¥å‚ï¼Œå¹¶ä½¿ç”¨å®ƒç”Ÿæˆä¸€ä¸ªNetworkå¯¹è±¡çš„Informerï¼Œä¼ é€’ç»™æ§åˆ¶å™¨ã€‚</p><p><strong>ç¬¬ä¸‰æ­¥</strong>ï¼šmainå‡½æ•°å¯åŠ¨ä¸Šè¿°çš„Informerï¼Œç„¶åæ‰§è¡Œcontroller.Runï¼Œå¯åŠ¨è‡ªå®šä¹‰æ§åˆ¶å™¨ã€‚</p><p>è‡³æ­¤ï¼Œmainå‡½æ•°å°±ç»“æŸäº†ã€‚</p><p>çœ‹åˆ°è¿™ï¼Œä½ å¯èƒ½ä¼šæ„Ÿåˆ°éå¸¸å›°æƒ‘ï¼šç¼–å†™è‡ªå®šä¹‰æ§åˆ¶å™¨çš„è¿‡ç¨‹éš¾é“å°±è¿™ä¹ˆç®€å•å—ï¼Ÿè¿™ä¸ªInformeråˆæ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿ</p><p>åˆ«ç€æ€¥ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°±ä¸ºä½ <strong>è¯¦ç»†è§£é‡Šä¸€ä¸‹è¿™ä¸ªè‡ªå®šä¹‰æ§åˆ¶å™¨çš„å·¥ä½œåŸç†ã€‚</strong></p><p>åœ¨Kubernetesé¡¹ç›®ä¸­ï¼Œä¸€ä¸ªè‡ªå®šä¹‰æ§åˆ¶å™¨çš„å·¥ä½œåŸç†ï¼Œå¯ä»¥ç”¨ä¸‹é¢è¿™æ ·ä¸€å¹…æµç¨‹å›¾æ¥è¡¨ç¤ºï¼ˆåœ¨åé¢çš„å™è¿°ä¸­ï¼Œæˆ‘ä¼šç”¨â€œç¤ºæ„å›¾â€æ¥æŒ‡ä»£å®ƒï¼‰ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/32/c3/32e545dcd4664a3f36e95af83b571ec3.png?wh=1846*822\" alt=\"\"></p><center><span class=\"reference\">å›¾1 è‡ªå®šä¹‰æ§åˆ¶å™¨çš„å·¥ä½œæµç¨‹ç¤ºæ„å›¾</span></center><p>æˆ‘ä»¬å…ˆä»è¿™å¹…ç¤ºæ„å›¾çš„æœ€å·¦è¾¹çœ‹èµ·ã€‚</p><p><strong>è¿™ä¸ªæ§åˆ¶å™¨è¦åšçš„ç¬¬ä¸€ä»¶äº‹ï¼Œæ˜¯ä»Kubernetesçš„APIServeré‡Œè·å–å®ƒæ‰€å…³å¿ƒçš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æˆ‘å®šä¹‰çš„Networkå¯¹è±¡</strong>ã€‚</p><p>è¿™ä¸ªæ“ä½œï¼Œä¾é çš„æ˜¯ä¸€ä¸ªå«ä½œInformerï¼ˆå¯ä»¥ç¿»è¯‘ä¸ºï¼šé€šçŸ¥å™¨ï¼‰çš„ä»£ç åº“å®Œæˆçš„ã€‚Informerä¸APIå¯¹è±¡æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œæ‰€ä»¥æˆ‘ä¼ é€’ç»™è‡ªå®šä¹‰æ§åˆ¶å™¨çš„ï¼Œæ­£æ˜¯ä¸€ä¸ªNetworkå¯¹è±¡çš„Informerï¼ˆNetwork Informerï¼‰ã€‚</p><p>ä¸çŸ¥ä½ æ˜¯å¦å·²ç»æ³¨æ„åˆ°ï¼Œæˆ‘åœ¨åˆ›å»ºè¿™ä¸ªInformerå·¥å‚çš„æ—¶å€™ï¼Œéœ€è¦ç»™å®ƒä¼ é€’ä¸€ä¸ªnetworkClientã€‚</p><p>äº‹å®ä¸Šï¼ŒNetwork Informeræ­£æ˜¯ä½¿ç”¨è¿™ä¸ªnetworkClientï¼Œè·ŸAPIServerå»ºç«‹äº†è¿æ¥ã€‚ä¸è¿‡ï¼ŒçœŸæ­£è´Ÿè´£ç»´æŠ¤è¿™ä¸ªè¿æ¥çš„ï¼Œåˆ™æ˜¯Informeræ‰€ä½¿ç”¨çš„ReflectoråŒ…ã€‚</p><p>æ›´å…·ä½“åœ°è¯´ï¼ŒReflectorä½¿ç”¨çš„æ˜¯ä¸€ç§å«ä½œ<strong>ListAndWatch</strong>çš„æ–¹æ³•ï¼Œæ¥â€œè·å–â€å¹¶â€œç›‘å¬â€è¿™äº›Networkå¯¹è±¡å®ä¾‹çš„å˜åŒ–ã€‚</p><p>åœ¨ListAndWatchæœºåˆ¶ä¸‹ï¼Œä¸€æ—¦APIServerç«¯æœ‰æ–°çš„Networkå®ä¾‹è¢«åˆ›å»ºã€åˆ é™¤æˆ–è€…æ›´æ–°ï¼ŒReflectoréƒ½ä¼šæ”¶åˆ°â€œäº‹ä»¶é€šçŸ¥â€ã€‚è¿™æ—¶ï¼Œè¯¥äº‹ä»¶åŠå®ƒå¯¹åº”çš„APIå¯¹è±¡è¿™ä¸ªç»„åˆï¼Œå°±è¢«ç§°ä¸ºå¢é‡ï¼ˆDeltaï¼‰ï¼Œå®ƒä¼šè¢«æ”¾è¿›ä¸€ä¸ªDelta FIFO Queueï¼ˆå³ï¼šå¢é‡å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼‰ä¸­ã€‚</p><p>è€Œå¦ä¸€æ–¹é¢ï¼ŒInformeä¼šä¸æ–­åœ°ä»è¿™ä¸ªDelta FIFO Queueé‡Œè¯»å–ï¼ˆPopï¼‰å¢é‡ã€‚æ¯æ‹¿åˆ°ä¸€ä¸ªå¢é‡ï¼ŒInformerå°±ä¼šåˆ¤æ–­è¿™ä¸ªå¢é‡é‡Œçš„äº‹ä»¶ç±»å‹ï¼Œç„¶ååˆ›å»ºæˆ–è€…æ›´æ–°æœ¬åœ°å¯¹è±¡çš„ç¼“å­˜ã€‚è¿™ä¸ªç¼“å­˜ï¼Œåœ¨Kubernetesé‡Œä¸€èˆ¬è¢«å«ä½œStoreã€‚</p><p>æ¯”å¦‚ï¼Œå¦‚æœäº‹ä»¶ç±»å‹æ˜¯Addedï¼ˆæ·»åŠ å¯¹è±¡ï¼‰ï¼Œé‚£ä¹ˆInformerå°±ä¼šé€šè¿‡ä¸€ä¸ªå«ä½œIndexerçš„åº“æŠŠè¿™ä¸ªå¢é‡é‡Œçš„APIå¯¹è±¡ä¿å­˜åœ¨æœ¬åœ°ç¼“å­˜ä¸­ï¼Œå¹¶ä¸ºå®ƒåˆ›å»ºç´¢å¼•ã€‚ç›¸åï¼Œå¦‚æœå¢é‡çš„äº‹ä»¶ç±»å‹æ˜¯Deletedï¼ˆåˆ é™¤å¯¹è±¡ï¼‰ï¼Œé‚£ä¹ˆInformerå°±ä¼šä»æœ¬åœ°ç¼“å­˜ä¸­åˆ é™¤è¿™ä¸ªå¯¹è±¡ã€‚</p><p>è¿™ä¸ª<strong>åŒæ­¥æœ¬åœ°ç¼“å­˜çš„å·¥ä½œï¼Œæ˜¯Informerçš„ç¬¬ä¸€ä¸ªèŒè´£ï¼Œä¹Ÿæ˜¯å®ƒæœ€é‡è¦çš„èŒè´£ã€‚</strong></p><p>è€Œ<strong>Informerçš„ç¬¬äºŒä¸ªèŒè´£ï¼Œåˆ™æ˜¯æ ¹æ®è¿™äº›äº‹ä»¶çš„ç±»å‹ï¼Œè§¦å‘äº‹å…ˆæ³¨å†Œå¥½çš„ResourceEventHandler</strong>ã€‚è¿™äº›Handlerï¼Œéœ€è¦åœ¨åˆ›å»ºæ§åˆ¶å™¨çš„æ—¶å€™æ³¨å†Œç»™å®ƒå¯¹åº”çš„Informerã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥<span class=\"orange\">ç¼–å†™è¿™ä¸ªæ§åˆ¶å™¨çš„å®šä¹‰</span>ï¼Œå®ƒçš„ä¸»è¦å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>func NewController(\n  kubeclientset kubernetes.Interface,\n  networkclientset clientset.Interface,\n  networkInformer informers.NetworkInformer) *Controller {\n  ...\n  controller := &amp;Controller{\n    kubeclientset:    kubeclientset,\n    networkclientset: networkclientset,\n    networksLister:   networkInformer.Lister(),\n    networksSynced:   networkInformer.Informer().HasSynced,\n    workqueue:        workqueue.NewNamedRateLimitingQueue(...,  &quot;Networks&quot;),\n    ...\n  }\n    networkInformer.Informer().AddEventHandler(cache.ResourceEventHandlerFuncs{\n    AddFunc: controller.enqueueNetwork,\n    UpdateFunc: func(old, new interface{}) {\n      oldNetwork := old.(*samplecrdv1.Network)\n      newNetwork := new.(*samplecrdv1.Network)\n      if oldNetwork.ResourceVersion == newNetwork.ResourceVersion {\n        return\n      }\n      controller.enqueueNetwork(new)\n    },\n    DeleteFunc: controller.enqueueNetworkForDelete,\n return controller\n}\n</code></pre><p><strong>æˆ‘å‰é¢åœ¨mainå‡½æ•°é‡Œåˆ›å»ºäº†ä¸¤ä¸ªclientï¼ˆkubeclientsetå’Œnetworkclientsetï¼‰ï¼Œç„¶ååœ¨è¿™æ®µä»£ç é‡Œï¼Œä½¿ç”¨è¿™ä¸¤ä¸ªclientå’Œå‰é¢åˆ›å»ºçš„Informerï¼Œåˆå§‹åŒ–äº†è‡ªå®šä¹‰æ§åˆ¶å™¨ã€‚</strong></p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿™ä¸ªè‡ªå®šä¹‰æ§åˆ¶å™¨é‡Œï¼Œæˆ‘è¿˜è®¾ç½®äº†ä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—ï¼ˆwork queueï¼‰ï¼Œå®ƒæ­£æ˜¯å¤„äºç¤ºæ„å›¾ä¸­é—´ä½ç½®çš„WorkQueueã€‚è¿™ä¸ªå·¥ä½œé˜Ÿåˆ—çš„ä½œç”¨æ˜¯ï¼Œè´Ÿè´£åŒæ­¥Informerå’Œæ§åˆ¶å¾ªç¯ä¹‹é—´çš„æ•°æ®ã€‚</p><blockquote>\n<p>å®é™…ä¸Šï¼ŒKubernetesé¡¹ç›®ä¸ºæˆ‘ä»¬æä¾›äº†å¾ˆå¤šä¸ªå·¥ä½œé˜Ÿåˆ—çš„å®ç°ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©åˆé€‚çš„åº“ç›´æ¥ä½¿ç”¨ã€‚</p>\n</blockquote><p><strong>ç„¶åï¼Œæˆ‘ä¸ºnetworkInformeræ³¨å†Œäº†ä¸‰ä¸ªHandlerï¼ˆAddFuncã€UpdateFuncå’ŒDeleteFuncï¼‰ï¼Œåˆ†åˆ«å¯¹åº”APIå¯¹è±¡çš„â€œæ·»åŠ â€â€œæ›´æ–°â€å’Œâ€œåˆ é™¤â€äº‹ä»¶ã€‚è€Œå…·ä½“çš„å¤„ç†æ“ä½œï¼Œéƒ½æ˜¯å°†è¯¥äº‹ä»¶å¯¹åº”çš„APIå¯¹è±¡åŠ å…¥åˆ°å·¥ä½œé˜Ÿåˆ—ä¸­ã€‚</strong></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®é™…å…¥é˜Ÿçš„å¹¶ä¸æ˜¯APIå¯¹è±¡æœ¬èº«ï¼Œè€Œæ˜¯å®ƒä»¬çš„Keyï¼Œå³ï¼šè¯¥APIå¯¹è±¡çš„<code>&lt;namespace&gt;/&lt;name&gt;</code>ã€‚</p><p>è€Œæˆ‘ä»¬åé¢å³å°†ç¼–å†™çš„æ§åˆ¶å¾ªç¯ï¼Œåˆ™ä¼šä¸æ–­åœ°ä»è¿™ä¸ªå·¥ä½œé˜Ÿåˆ—é‡Œæ‹¿åˆ°è¿™äº›Keyï¼Œç„¶åå¼€å§‹æ‰§è¡ŒçœŸæ­£çš„æ§åˆ¶é€»è¾‘ã€‚</p><p>ç»¼åˆä¸Šé¢çš„è®²è¿°ï¼Œä½ ç°åœ¨åº”è¯¥å°±èƒ½æ˜ç™½ï¼Œ<strong>æ‰€è°“Informerï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå¸¦æœ‰æœ¬åœ°ç¼“å­˜å’Œç´¢å¼•æœºåˆ¶çš„ã€å¯ä»¥æ³¨å†ŒEventHandlerçš„client</strong>ã€‚å®ƒæ˜¯è‡ªå®šä¹‰æ§åˆ¶å™¨è·ŸAPIServerè¿›è¡Œæ•°æ®åŒæ­¥çš„é‡è¦ç»„ä»¶ã€‚</p><p>æ›´å…·ä½“åœ°è¯´ï¼ŒInformeré€šè¿‡ä¸€ç§å«ä½œListAndWatchçš„æ–¹æ³•ï¼ŒæŠŠAPIServerä¸­çš„APIå¯¹è±¡ç¼“å­˜åœ¨äº†æœ¬åœ°ï¼Œå¹¶è´Ÿè´£æ›´æ–°å’Œç»´æŠ¤è¿™ä¸ªç¼“å­˜ã€‚</p><p>å…¶ä¸­ï¼ŒListAndWatchæ–¹æ³•çš„å«ä¹‰æ˜¯ï¼šé¦–å…ˆï¼Œé€šè¿‡APIServerçš„LIST APIâ€œè·å–â€æ‰€æœ‰æœ€æ–°ç‰ˆæœ¬çš„APIå¯¹è±¡ï¼›ç„¶åï¼Œå†é€šè¿‡WATCH APIæ¥â€œç›‘å¬â€æ‰€æœ‰è¿™äº›APIå¯¹è±¡çš„å˜åŒ–ã€‚</p><p>è€Œé€šè¿‡ç›‘å¬åˆ°çš„äº‹ä»¶å˜åŒ–ï¼ŒInformerå°±å¯ä»¥å®æ—¶åœ°æ›´æ–°æœ¬åœ°ç¼“å­˜ï¼Œå¹¶ä¸”è°ƒç”¨è¿™äº›äº‹ä»¶å¯¹åº”çš„EventHandleräº†ã€‚</p><p>æ­¤å¤–ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ¯ç»è¿‡resyncPeriodæŒ‡å®šçš„æ—¶é—´ï¼ŒInformerç»´æŠ¤çš„æœ¬åœ°ç¼“å­˜ï¼Œéƒ½ä¼šä½¿ç”¨æœ€è¿‘ä¸€æ¬¡LISTè¿”å›çš„ç»“æœå¼ºåˆ¶æ›´æ–°ä¸€æ¬¡ï¼Œä»è€Œä¿è¯ç¼“å­˜çš„æœ‰æ•ˆæ€§ã€‚åœ¨Kubernetesä¸­ï¼Œè¿™ä¸ªç¼“å­˜å¼ºåˆ¶æ›´æ–°çš„æ“ä½œå°±å«ä½œï¼šresyncã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªå®šæ—¶resyncæ“ä½œï¼Œä¹Ÿä¼šè§¦å‘Informeræ³¨å†Œçš„â€œæ›´æ–°â€äº‹ä»¶ã€‚ä½†æ­¤æ—¶ï¼Œè¿™ä¸ªâ€œæ›´æ–°â€äº‹ä»¶å¯¹åº”çš„Networkå¯¹è±¡å®é™…ä¸Šå¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå³ï¼šæ–°ã€æ—§ä¸¤ä¸ªNetworkå¯¹è±¡çš„ResourceVersionæ˜¯ä¸€æ ·çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒInformerå°±ä¸éœ€è¦å¯¹è¿™ä¸ªæ›´æ–°äº‹ä»¶å†åšè¿›ä¸€æ­¥çš„å¤„ç†äº†ã€‚</p><p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘åœ¨ä¸Šé¢çš„UpdateFuncæ–¹æ³•é‡Œï¼Œå…ˆåˆ¤æ–­äº†ä¸€ä¸‹æ–°ã€æ—§ä¸¤ä¸ªNetworkå¯¹è±¡çš„ç‰ˆæœ¬ï¼ˆResourceVersionï¼‰æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ï¼Œç„¶åæ‰å¼€å§‹è¿›è¡Œçš„å…¥é˜Ÿæ“ä½œã€‚</p><p>ä»¥ä¸Šï¼Œå°±æ˜¯Kubernetesä¸­çš„Informeråº“çš„å·¥ä½œåŸç†äº†ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥åˆ°äº†ç¤ºæ„å›¾ä¸­æœ€åé¢çš„æ§åˆ¶å¾ªç¯ï¼ˆControl Loopï¼‰éƒ¨åˆ†ï¼Œä¹Ÿæ­£æ˜¯æˆ‘åœ¨mainå‡½æ•°æœ€åè°ƒç”¨controller.Run()å¯åŠ¨çš„â€œæ§åˆ¶å¾ªç¯â€ã€‚å®ƒçš„ä¸»è¦å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>func (c *Controller) Run(threadiness int, stopCh &lt;-chan struct{}) error {\n ...\n  if ok := cache.WaitForCacheSync(stopCh, c.networksSynced); !ok {\n    return fmt.Errorf(&quot;failed to wait for caches to sync&quot;)\n  }\n  \n  ...\n  for i := 0; i &lt; threadiness; i++ {\n    go wait.Until(c.runWorker, time.Second, stopCh)\n  }\n  \n  ...\n  return nil\n}\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œå¯åŠ¨æ§åˆ¶å¾ªç¯çš„é€»è¾‘éå¸¸ç®€å•ï¼š</p><ul>\n<li>é¦–å…ˆï¼Œç­‰å¾…Informerå®Œæˆä¸€æ¬¡æœ¬åœ°ç¼“å­˜çš„æ•°æ®åŒæ­¥æ“ä½œï¼›</li>\n<li>ç„¶åï¼Œç›´æ¥é€šè¿‡goroutineå¯åŠ¨ä¸€ä¸ªï¼ˆæˆ–è€…å¹¶å‘å¯åŠ¨å¤šä¸ªï¼‰â€œæ— é™å¾ªç¯â€çš„ä»»åŠ¡ã€‚</li>\n</ul><p>è€Œè¿™ä¸ªâ€œæ— é™å¾ªç¯â€ä»»åŠ¡çš„æ¯ä¸€ä¸ªå¾ªç¯å‘¨æœŸï¼Œæ‰§è¡Œçš„æ­£æ˜¯æˆ‘ä»¬çœŸæ­£å…³å¿ƒçš„ä¸šåŠ¡é€»è¾‘ã€‚</p><p>æ‰€ä»¥æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥<span class=\"orange\">ç¼–å†™è¿™ä¸ªè‡ªå®šä¹‰æ§åˆ¶å™¨çš„ä¸šåŠ¡é€»è¾‘</span>ï¼Œå®ƒçš„ä¸»è¦å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>func (c *Controller) runWorker() {\n  for c.processNextWorkItem() {\n  }\n}\n\nfunc (c *Controller) processNextWorkItem() bool {\n  obj, shutdown := c.workqueue.Get()\n  \n  ...\n  \n  err := func(obj interface{}) error {\n    ...\n    if err := c.syncHandler(key); err != nil {\n     return fmt.Errorf(&quot;error syncing '%s': %s&quot;, key, err.Error())\n    }\n    \n    c.workqueue.Forget(obj)\n    ...\n    return nil\n  }(obj)\n  \n  ...\n  \n  return true\n}\n\nfunc (c *Controller) syncHandler(key string) error {\n\n  namespace, name, err := cache.SplitMetaNamespaceKey(key)\n  ...\n  \n  network, err := c.networksLister.Networks(namespace).Get(name)\n  if err != nil {\n    if errors.IsNotFound(err) {\n      glog.Warningf(&quot;Network does not exist in local cache: %s/%s, will delete it from Neutron ...&quot;,\n      namespace, name)\n      \n      glog.Warningf(&quot;Network: %s/%s does not exist in local cache, will delete it from Neutron ...&quot;,\n    namespace, name)\n    \n     // FIX ME: call Neutron API to delete this network by name.\n     //\n     // neutron.Delete(namespace, name)\n     \n     return nil\n  }\n    ...\n    \n    return err\n  }\n  \n  glog.Infof(&quot;[Neutron] Try to process network: %#v ...&quot;, network)\n  \n  // FIX ME: Do diff().\n  //\n  // actualNetwork, exists := neutron.Get(namespace, name)\n  //\n  // if !exists {\n  //   neutron.Create(namespace, name)\n  // } else if !reflect.DeepEqual(actualNetwork, network) {\n  //   neutron.Update(namespace, name)\n  // }\n  \n  return nil\n}\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªæ‰§è¡Œå‘¨æœŸé‡Œï¼ˆprocessNextWorkItemï¼‰ï¼Œæˆ‘ä»¬<strong>é¦–å…ˆ</strong>ä»å·¥ä½œé˜Ÿåˆ—é‡Œå‡ºé˜Ÿï¼ˆworkqueue.Getï¼‰äº†ä¸€ä¸ªæˆå‘˜ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªKeyï¼ˆNetworkå¯¹è±¡çš„ï¼šnamespace/nameï¼‰ã€‚</p><p><strong>ç„¶å</strong>ï¼Œåœ¨syncHandleræ–¹æ³•ä¸­ï¼Œæˆ‘ä½¿ç”¨è¿™ä¸ªKeyï¼Œå°è¯•ä»Informerç»´æŠ¤çš„ç¼“å­˜ä¸­æ‹¿åˆ°äº†å®ƒæ‰€å¯¹åº”çš„Networkå¯¹è±¡ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä½¿ç”¨äº†networksListeræ¥å°è¯•è·å–è¿™ä¸ªKeyå¯¹åº”çš„Networkå¯¹è±¡ã€‚è¿™ä¸ªæ“ä½œï¼Œå…¶å®å°±æ˜¯åœ¨è®¿é—®æœ¬åœ°ç¼“å­˜çš„ç´¢å¼•ã€‚å®é™…ä¸Šï¼Œåœ¨Kubernetesçš„æºç ä¸­ï¼Œä½ ä¼šç»å¸¸çœ‹åˆ°æ§åˆ¶å™¨ä»å„ç§Listeré‡Œè·å–å¯¹è±¡ï¼Œæ¯”å¦‚ï¼špodListerã€nodeListerç­‰ç­‰ï¼Œå®ƒä»¬ä½¿ç”¨çš„éƒ½æ˜¯Informerå’Œç¼“å­˜æœºåˆ¶ã€‚</p><p>è€Œå¦‚æœæ§åˆ¶å¾ªç¯ä»ç¼“å­˜ä¸­æ‹¿ä¸åˆ°è¿™ä¸ªå¯¹è±¡ï¼ˆå³ï¼šnetworkListerè¿”å›äº†IsNotFoundé”™è¯¯ï¼‰ï¼Œé‚£å°±æ„å‘³ç€è¿™ä¸ªNetworkå¯¹è±¡çš„Keyæ˜¯é€šè¿‡å‰é¢çš„â€œåˆ é™¤â€äº‹ä»¶æ·»åŠ è¿›å·¥ä½œé˜Ÿåˆ—çš„ã€‚æ‰€ä»¥ï¼Œå°½ç®¡é˜Ÿåˆ—é‡Œæœ‰è¿™ä¸ªKeyï¼Œä½†æ˜¯å¯¹åº”çš„Networkå¯¹è±¡å·²ç»è¢«åˆ é™¤äº†ã€‚</p><p>è¿™æ—¶å€™ï¼Œæˆ‘å°±éœ€è¦è°ƒç”¨Neutronçš„APIï¼ŒæŠŠè¿™ä¸ªKeyå¯¹åº”çš„Neutronç½‘ç»œä»çœŸå®çš„é›†ç¾¤é‡Œåˆ é™¤æ‰ã€‚</p><p><strong>è€Œå¦‚æœèƒ½å¤Ÿè·å–åˆ°å¯¹åº”çš„Networkå¯¹è±¡ï¼Œæˆ‘å°±å¯ä»¥æ‰§è¡Œæ§åˆ¶å™¨æ¨¡å¼é‡Œçš„å¯¹æ¯”â€œæœŸæœ›çŠ¶æ€â€å’Œâ€œå®é™…çŠ¶æ€â€çš„é€»è¾‘äº†ã€‚</strong></p><p>å…¶ä¸­ï¼Œè‡ªå®šä¹‰æ§åˆ¶å™¨â€œåƒè¾›ä¸‡è‹¦â€æ‹¿åˆ°çš„è¿™ä¸ªNetworkå¯¹è±¡ï¼Œ<strong>æ­£æ˜¯APIServeré‡Œä¿å­˜çš„â€œæœŸæœ›çŠ¶æ€â€</strong>ï¼Œå³ï¼šç”¨æˆ·é€šè¿‡YAMLæ–‡ä»¶æäº¤åˆ°APIServeré‡Œçš„ä¿¡æ¯ã€‚å½“ç„¶ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­é‡Œï¼Œå®ƒå·²ç»è¢«Informerç¼“å­˜åœ¨äº†æœ¬åœ°ã€‚</p><p><strong>é‚£ä¹ˆï¼Œâ€œå®é™…çŠ¶æ€â€åˆä»å“ªé‡Œæ¥å‘¢ï¼Ÿ</strong></p><p>å½“ç„¶æ˜¯æ¥è‡ªäºå®é™…çš„é›†ç¾¤äº†ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬çš„æ§åˆ¶å¾ªç¯éœ€è¦é€šè¿‡Neutron APIæ¥æŸ¥è¯¢å®é™…çš„ç½‘ç»œæƒ…å†µã€‚</p><p>æ¯”å¦‚ï¼Œæˆ‘å¯ä»¥å…ˆé€šè¿‡Neutronæ¥æŸ¥è¯¢è¿™ä¸ªNetworkå¯¹è±¡å¯¹åº”çš„çœŸå®ç½‘ç»œæ˜¯å¦å­˜åœ¨ã€‚</p><ul>\n<li>å¦‚æœä¸å­˜åœ¨ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„â€œæœŸæœ›çŠ¶æ€â€ä¸â€œå®é™…çŠ¶æ€â€ä¸ä¸€è‡´çš„æƒ…å½¢ã€‚è¿™æ—¶ï¼Œæˆ‘å°±éœ€è¦ä½¿ç”¨è¿™ä¸ªNetworkå¯¹è±¡é‡Œçš„ä¿¡æ¯ï¼ˆæ¯”å¦‚ï¼šCIDRå’ŒGatewayï¼‰ï¼Œè°ƒç”¨Neutron APIæ¥åˆ›å»ºçœŸå®çš„ç½‘ç»œã€‚</li>\n<li>å¦‚æœå­˜åœ¨ï¼Œé‚£ä¹ˆï¼Œæˆ‘å°±è¦è¯»å–è¿™ä¸ªçœŸå®ç½‘ç»œçš„ä¿¡æ¯ï¼Œåˆ¤æ–­å®ƒæ˜¯å¦è·ŸNetworkå¯¹è±¡é‡Œçš„ä¿¡æ¯ä¸€è‡´ï¼Œä»è€Œå†³å®šæˆ‘æ˜¯å¦è¦é€šè¿‡Neutronæ¥æ›´æ–°è¿™ä¸ªå·²ç»å­˜åœ¨çš„çœŸå®ç½‘ç»œã€‚</li>\n</ul><p>è¿™æ ·ï¼Œæˆ‘å°±é€šè¿‡å¯¹æ¯”â€œæœŸæœ›çŠ¶æ€â€å’Œâ€œå®é™…çŠ¶æ€â€çš„å·®å¼‚ï¼Œå®Œæˆäº†ä¸€æ¬¡è°ƒåï¼ˆReconcileï¼‰çš„è¿‡ç¨‹ã€‚</p><p>è‡³æ­¤ï¼Œä¸€ä¸ªå®Œæ•´çš„è‡ªå®šä¹‰APIå¯¹è±¡å’Œå®ƒæ‰€å¯¹åº”çš„è‡ªå®šä¹‰æ§åˆ¶å™¨ï¼Œå°±ç¼–å†™å®Œæ¯•äº†ã€‚</p><blockquote>\n<p>å¤‡æ³¨ï¼šä¸Neutronç›¸å…³çš„ä¸šåŠ¡ä»£ç å¹¶ä¸æ˜¯æœ¬ç¯‡æ–‡ç« çš„é‡ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»…ä»…é€šè¿‡æ³¨é‡Šé‡Œçš„ä¼ªä»£ç ä¸ºä½ è¡¨è¿°äº†è¿™éƒ¨åˆ†å†…å®¹ã€‚å¦‚æœä½ å¯¹è¿™äº›ä»£ç æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥è‡ªè¡Œå®Œæˆã€‚æœ€ç®€å•çš„æƒ…å†µï¼Œä½ å¯ä»¥è‡ªå·±ç¼–å†™ä¸€ä¸ªNeutron Mockï¼Œç„¶åè¾“å‡ºå¯¹åº”çš„æ“ä½œæ—¥å¿—ã€‚</p>\n</blockquote><p>æ¥ä¸‹æ¥ï¼Œ<span class=\"orange\">æˆ‘ä»¬å°±ä¸€èµ·æ¥æŠŠè¿™ä¸ªé¡¹ç›®è¿è¡Œèµ·æ¥ï¼ŒæŸ¥çœ‹ä¸€ä¸‹å®ƒçš„å·¥ä½œæƒ…å†µã€‚</span></p><p>ä½ å¯ä»¥è‡ªå·±ç¼–è¯‘è¿™ä¸ªé¡¹ç›®ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨æˆ‘ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆsamplecrd-controllerï¼‰ã€‚ç¼–è¯‘å¹¶å¯åŠ¨è¿™ä¸ªé¡¹ç›®çš„å…·ä½“æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code># Clone repo\n$ git clone https://github.com/resouer/k8s-controller-custom-resource$ cd k8s-controller-custom-resource\n\n### Skip this part if you don't want to build\n# Install dependency\n$ go get github.com/tools/godep\n$ godep restore\n# Build\n$ go build -o samplecrd-controller .\n\n$ ./samplecrd-controller -kubeconfig=$HOME/.kube/config -alsologtostderr=true\nI0915 12:50:29.051349   27159 controller.go:84] Setting up event handlers\nI0915 12:50:29.051615   27159 controller.go:113] Starting Network control loop\nI0915 12:50:29.051630   27159 controller.go:116] Waiting for informer caches to sync\nE0915 12:50:29.066745   27159 reflector.go:134] github.com/resouer/k8s-controller-custom-resource/pkg/client/informers/externalversions/factory.go:117: Failed to list *v1.Network: the server could not find the requested resource (get networks.samplecrd.k8s.io)\n...\n</code></pre><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œè‡ªå®šä¹‰æ§åˆ¶å™¨è¢«å¯åŠ¨åï¼Œä¸€å¼€å§‹ä¼šæŠ¥é”™ã€‚</p><p>è¿™æ˜¯å› ä¸ºï¼Œæ­¤æ—¶Networkå¯¹è±¡çš„CRDè¿˜æ²¡æœ‰è¢«åˆ›å»ºå‡ºæ¥ï¼Œæ‰€ä»¥Informerå»APIServeré‡Œâ€œè·å–â€ï¼ˆListï¼‰Networkå¯¹è±¡æ—¶ï¼Œå¹¶ä¸èƒ½æ‰¾åˆ°Networkè¿™ä¸ªAPIèµ„æºç±»å‹çš„å®šä¹‰ï¼Œå³ï¼š</p><pre><code>Failed to list *v1.Network: the server could not find the requested resource (get networks.samplecrd.k8s.io)\n</code></pre><p>æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥æˆ‘å°±éœ€è¦åˆ›å»ºNetworkå¯¹è±¡çš„CRDï¼Œè¿™ä¸ªæ“ä½œåœ¨ä¸Šä¸€ç¯‡æ–‡ç« é‡Œå·²ç»ä»‹ç»è¿‡äº†ã€‚</p><p>åœ¨å¦ä¸€ä¸ªshellçª—å£é‡Œæ‰§è¡Œï¼š</p><pre><code>$ kubectl apply -f crd/network.yaml\n</code></pre><p>è¿™æ—¶å€™ï¼Œä½ å°±ä¼šçœ‹åˆ°æ§åˆ¶å™¨çš„æ—¥å¿—æ¢å¤äº†æ­£å¸¸ï¼Œæ§åˆ¶å¾ªç¯å¯åŠ¨æˆåŠŸï¼š</p><pre><code>...\nI0915 12:50:29.051630   27159 controller.go:116] Waiting for informer caches to sync\n...\nI0915 12:52:54.346854   25245 controller.go:121] Starting workers\nI0915 12:52:54.346914   25245 controller.go:127] Started workers\n</code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°±å¯ä»¥è¿›è¡ŒNetworkå¯¹è±¡çš„å¢åˆ æ”¹æŸ¥æ“ä½œäº†ã€‚</p><p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªNetworkå¯¹è±¡ï¼š</p><pre><code>$ cat example/example-network.yaml \napiVersion: samplecrd.k8s.io/v1\nkind: Network\nmetadata:\n  name: example-network\nspec:\n  cidr: &quot;192.168.0.0/16&quot;\n  gateway: &quot;192.168.0.1&quot;\n  \n$ kubectl apply -f example/example-network.yaml \nnetwork.samplecrd.k8s.io/example-network created\n</code></pre><p>è¿™æ—¶å€™ï¼ŒæŸ¥çœ‹ä¸€ä¸‹æ§åˆ¶å™¨çš„è¾“å‡ºï¼š</p><pre><code>...\nI0915 12:50:29.051349   27159 controller.go:84] Setting up event handlers\nI0915 12:50:29.051615   27159 controller.go:113] Starting Network control loop\nI0915 12:50:29.051630   27159 controller.go:116] Waiting for informer caches to sync\n...\nI0915 12:52:54.346854   25245 controller.go:121] Starting workers\nI0915 12:52:54.346914   25245 controller.go:127] Started workers\nI0915 12:53:18.064409   25245 controller.go:229] [Neutron] Try to process network: &amp;v1.Network{TypeMeta:v1.TypeMeta{Kind:&quot;&quot;, APIVersion:&quot;&quot;}, ObjectMeta:v1.ObjectMeta{Name:&quot;example-network&quot;, GenerateName:&quot;&quot;, Namespace:&quot;default&quot;, ... ResourceVersion:&quot;479015&quot;, ... Spec:v1.NetworkSpec{Cidr:&quot;192.168.0.0/16&quot;, Gateway:&quot;192.168.0.1&quot;}} ...\nI0915 12:53:18.064650   25245 controller.go:183] Successfully synced 'default/example-network'\n...\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä¸Šé¢åˆ›å»ºexample-networkçš„æ“ä½œï¼Œè§¦å‘äº†EventHandlerçš„â€œæ·»åŠ â€äº‹ä»¶ï¼Œä»è€Œè¢«æ”¾è¿›äº†å·¥ä½œé˜Ÿåˆ—ã€‚</p><p>ç´§æ¥ç€ï¼Œæ§åˆ¶å¾ªç¯å°±ä»é˜Ÿåˆ—é‡Œæ‹¿åˆ°äº†è¿™ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”æ‰“å°å‡ºäº†æ­£åœ¨â€œå¤„ç†â€è¿™ä¸ªNetworkå¯¹è±¡çš„æ—¥å¿—ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªNetworkçš„ResourceVersionï¼Œä¹Ÿå°±æ˜¯APIå¯¹è±¡çš„ç‰ˆæœ¬å·ï¼Œæ˜¯479015ï¼Œè€Œå®ƒçš„Specå­—æ®µçš„å†…å®¹ï¼Œè·Ÿæˆ‘æäº¤çš„YAMLæ–‡ä»¶ä¸€æ‘¸ä¸€æ ·ï¼Œæ¯”å¦‚ï¼Œå®ƒçš„CIDRç½‘æ®µæ˜¯ï¼š192.168.0.0/16ã€‚</p><p>è¿™æ—¶å€™ï¼Œæˆ‘æ¥ä¿®æ”¹ä¸€ä¸‹è¿™ä¸ªYAMLæ–‡ä»¶çš„å†…å®¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>$ cat example/example-network.yaml \napiVersion: samplecrd.k8s.io/v1\nkind: Network\nmetadata:\n  name: example-network\nspec:\n  cidr: &quot;192.168.1.0/16&quot;\n  gateway: &quot;192.168.1.1&quot;\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘æŠŠè¿™ä¸ªYAMLæ–‡ä»¶é‡Œçš„CIDRå’ŒGatewayå­—æ®µä¿®æ”¹æˆäº†192.168.1.0/16ç½‘æ®µã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬æ‰§è¡Œäº†kubectl applyå‘½ä»¤æ¥æäº¤è¿™æ¬¡æ›´æ–°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>$ kubectl apply -f example/example-network.yaml \nnetwork.samplecrd.k8s.io/example-network configured\n</code></pre><p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥è§‚å¯Ÿä¸€ä¸‹æ§åˆ¶å™¨çš„è¾“å‡ºï¼š</p><pre><code>...\nI0915 12:53:51.126029   25245 controller.go:229] [Neutron] Try to process network: &amp;v1.Network{TypeMeta:v1.TypeMeta{Kind:&quot;&quot;, APIVersion:&quot;&quot;}, ObjectMeta:v1.ObjectMeta{Name:&quot;example-network&quot;, GenerateName:&quot;&quot;, Namespace:&quot;default&quot;, ...  ResourceVersion:&quot;479062&quot;, ... Spec:v1.NetworkSpec{Cidr:&quot;192.168.1.0/16&quot;, Gateway:&quot;192.168.1.1&quot;}} ...\nI0915 12:53:51.126348   25245 controller.go:183] Successfully synced 'default/example-network'\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸€æ¬¡ï¼ŒInformeræ³¨å†Œçš„â€œæ›´æ–°â€äº‹ä»¶è¢«è§¦å‘ï¼Œæ›´æ–°åçš„Networkå¯¹è±¡çš„Keyè¢«æ·»åŠ åˆ°äº†å·¥ä½œé˜Ÿåˆ—ä¹‹ä¸­ã€‚</p><p>æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥æ§åˆ¶å¾ªç¯ä»å·¥ä½œé˜Ÿåˆ—é‡Œæ‹¿åˆ°çš„Networkå¯¹è±¡ï¼Œä¸å‰ä¸€ä¸ªå¯¹è±¡æ˜¯ä¸åŒçš„ï¼šå®ƒçš„ResourceVersionçš„å€¼å˜æˆäº†479062ï¼›è€ŒSpecé‡Œçš„å­—æ®µï¼Œåˆ™å˜æˆäº†192.168.1.0/16ç½‘æ®µã€‚</p><p>æœ€åï¼Œæˆ‘å†æŠŠè¿™ä¸ªå¯¹è±¡åˆ é™¤æ‰ï¼š</p><pre><code>$ kubectl delete -f example/example-network.yaml\n</code></pre><p>è¿™ä¸€æ¬¡ï¼Œåœ¨æ§åˆ¶å™¨çš„è¾“å‡ºé‡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ï¼ŒInformeræ³¨å†Œçš„â€œåˆ é™¤â€äº‹ä»¶è¢«è§¦å‘ï¼Œå¹¶ä¸”æ§åˆ¶å¾ªç¯â€œè°ƒç”¨â€Neutron APIâ€œåˆ é™¤â€äº†çœŸå®ç¯å¢ƒé‡Œçš„ç½‘ç»œã€‚è¿™ä¸ªè¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>W0915 12:54:09.738464   25245 controller.go:212] Network: default/example-network does not exist in local cache, will delete it from Neutron ...\nI0915 12:54:09.738832   25245 controller.go:215] [Neutron] Deleting network: default/example-network ...\nI0915 12:54:09.738854   25245 controller.go:183] Successfully synced 'default/example-network'\n</code></pre><p>ä»¥ä¸Šï¼Œå°±æ˜¯ç¼–å†™å’Œä½¿ç”¨è‡ªå®šä¹‰æ§åˆ¶å™¨çš„å…¨éƒ¨æµç¨‹äº†ã€‚</p><p>å®é™…ä¸Šï¼Œ<span class=\"orange\">è¿™å¥—æµç¨‹ä¸ä»…å¯ä»¥ç”¨åœ¨è‡ªå®šä¹‰APIèµ„æºä¸Šï¼Œä¹Ÿå®Œå…¨å¯ä»¥ç”¨åœ¨KubernetesåŸç”Ÿçš„é»˜è®¤APIå¯¹è±¡ä¸Šã€‚</span></p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬åœ¨mainå‡½æ•°é‡Œï¼Œé™¤äº†åˆ›å»ºä¸€ä¸ªNetwork Informerå¤–ï¼Œè¿˜å¯ä»¥åˆå§‹åŒ–ä¸€ä¸ªKubernetesé»˜è®¤APIå¯¹è±¡çš„Informerå·¥å‚ï¼Œæ¯”å¦‚Deploymentå¯¹è±¡çš„Informerã€‚è¿™ä¸ªå…·ä½“åšæ³•å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>func main() {\n  ...\n  \n  kubeInformerFactory := kubeinformers.NewSharedInformerFactory(kubeClient, time.Second*30)\n  \n  controller := NewController(kubeClient, exampleClient,\n  kubeInformerFactory.Apps().V1().Deployments(),\n  networkInformerFactory.Samplecrd().V1().Networks())\n  \n  go kubeInformerFactory.Start(stopCh)\n  ...\n}\n</code></pre><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬<strong>é¦–å…ˆ</strong>ä½¿ç”¨Kubernetesçš„clientï¼ˆkubeClientï¼‰åˆ›å»ºäº†ä¸€ä¸ªå·¥å‚ï¼›</p><p><strong>ç„¶å</strong>ï¼Œæˆ‘ç”¨è·ŸNetworkç±»ä¼¼çš„å¤„ç†æ–¹æ³•ï¼Œç”Ÿæˆäº†ä¸€ä¸ªDeployment Informerï¼›</p><p><strong>æ¥ç€</strong>ï¼Œæˆ‘æŠŠDeployment Informerä¼ é€’ç»™äº†è‡ªå®šä¹‰æ§åˆ¶å™¨ï¼›å½“ç„¶ï¼Œæˆ‘ä¹Ÿè¦è°ƒç”¨Startæ–¹æ³•æ¥å¯åŠ¨è¿™ä¸ªDeployment Informerã€‚</p><p>è€Œæœ‰äº†è¿™ä¸ªDeployment Informeråï¼Œè¿™ä¸ªæ§åˆ¶å™¨ä¹Ÿå°±æŒæœ‰äº†æ‰€æœ‰Deploymentå¯¹è±¡çš„ä¿¡æ¯ã€‚æ¥ä¸‹æ¥ï¼Œå®ƒæ—¢å¯ä»¥é€šè¿‡deploymentInformer.Lister()æ¥è·å–Etcdé‡Œçš„æ‰€æœ‰Deploymentå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥ä¸ºè¿™ä¸ªDeployment Informeræ³¨å†Œå…·ä½“çš„Handleræ¥ã€‚</p><p>æ›´é‡è¦çš„æ˜¯ï¼Œ<strong>è¿™å°±ä½¿å¾—åœ¨è¿™ä¸ªè‡ªå®šä¹‰æ§åˆ¶å™¨é‡Œé¢ï¼Œæˆ‘å¯ä»¥é€šè¿‡å¯¹è‡ªå®šä¹‰APIå¯¹è±¡å’Œé»˜è®¤APIå¯¹è±¡è¿›è¡ŒååŒï¼Œä»è€Œå®ç°æ›´åŠ å¤æ‚çš„ç¼–æ’åŠŸèƒ½</strong>ã€‚</p><p>æ¯”å¦‚ï¼šç”¨æˆ·æ¯åˆ›å»ºä¸€ä¸ªæ–°çš„Deploymentï¼Œè¿™ä¸ªè‡ªå®šä¹‰æ§åˆ¶å™¨ï¼Œå°±å¯ä»¥ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªå¯¹åº”çš„Networkä¾›å®ƒä½¿ç”¨ã€‚</p><p>è¿™äº›å¯¹Kubernetes APIç¼–ç¨‹èŒƒå¼çš„æ›´é«˜çº§åº”ç”¨ï¼Œæˆ‘å°±ç•™ç»™ä½ åœ¨å®é™…çš„åœºæ™¯ä¸­å»æ¢ç´¢å’Œå®è·µäº†ã€‚</p><h2>æ€»ç»“</h2><p>åœ¨ä»Šå¤©è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä¸ºä½ å‰–æäº†Kubernetes APIç¼–ç¨‹èŒƒå¼çš„å…·ä½“åŸç†ï¼Œå¹¶ç¼–å†™äº†ä¸€ä¸ªè‡ªå®šä¹‰æ§åˆ¶å™¨ã€‚</p><p>è¿™å…¶ä¸­ï¼Œæœ‰å¦‚ä¸‹å‡ ä¸ªæ¦‚å¿µå’Œæœºåˆ¶ï¼Œæ˜¯ä½ ä¸€å®šè¦ç†è§£æ¸…æ¥šçš„ï¼š</p><p>æ‰€è°“çš„Informerï¼Œå°±æ˜¯ä¸€ä¸ªè‡ªå¸¦ç¼“å­˜å’Œç´¢å¼•æœºåˆ¶ï¼Œå¯ä»¥è§¦å‘Handlerçš„å®¢æˆ·ç«¯åº“ã€‚è¿™ä¸ªæœ¬åœ°ç¼“å­˜åœ¨Kubernetesä¸­ä¸€èˆ¬è¢«ç§°ä¸ºStoreï¼Œç´¢å¼•ä¸€èˆ¬è¢«ç§°ä¸ºIndexã€‚</p><p>Informerä½¿ç”¨äº†ReflectoråŒ…ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯ä»¥é€šè¿‡ListAndWatchæœºåˆ¶è·å–å¹¶ç›‘è§†APIå¯¹è±¡å˜åŒ–çš„å®¢æˆ·ç«¯å°è£…ã€‚</p><p>Reflectorå’ŒInformerä¹‹é—´ï¼Œç”¨åˆ°äº†ä¸€ä¸ªâ€œå¢é‡å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—â€è¿›è¡ŒååŒã€‚è€ŒInformerä¸ä½ è¦ç¼–å†™çš„æ§åˆ¶å¾ªç¯ä¹‹é—´ï¼Œåˆ™ä½¿ç”¨äº†ä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—æ¥è¿›è¡ŒååŒã€‚</p><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œé™¤äº†æ§åˆ¶å¾ªç¯ä¹‹å¤–çš„æ‰€æœ‰ä»£ç ï¼Œå®é™…ä¸Šéƒ½æ˜¯Kubernetesä¸ºä½ è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œå³ï¼špkg/client/{informers, listers, clientset}é‡Œçš„å†…å®¹ã€‚</p><p>è€Œè¿™äº›è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç ï¼Œå°±ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå¯é è€Œé«˜æ•ˆåœ°è·å–APIå¯¹è±¡â€œæœŸæœ›çŠ¶æ€â€çš„ç¼–ç¨‹åº“ã€‚</p><p>æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥ï¼Œä½œä¸ºå¼€å‘è€…ï¼Œä½ å°±åªéœ€è¦å…³æ³¨å¦‚ä½•æ‹¿åˆ°â€œå®é™…çŠ¶æ€â€ï¼Œç„¶åå¦‚ä½•æ‹¿å®ƒå»è·Ÿâ€œæœŸæœ›çŠ¶æ€â€åšå¯¹æ¯”ï¼Œä»è€Œå†³å®šæ¥ä¸‹æ¥è¦åšçš„ä¸šåŠ¡é€»è¾‘å³å¯ã€‚</p><p>ä»¥ä¸Šå†…å®¹ï¼Œå°±æ˜¯Kubernetes APIç¼–ç¨‹èŒƒå¼çš„æ ¸å¿ƒæ€æƒ³ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>è¯·æ€è€ƒä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆInformerå’Œä½ ç¼–å†™çš„æ§åˆ¶å¾ªç¯ä¹‹é—´ï¼Œä¸€å®šè¦ä½¿ç”¨ä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—æ¥è¿›è¡Œåä½œå‘¢ï¼Ÿ</p><p>æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæ¬¢è¿ä½ ç»™æˆ‘ç•™è¨€ï¼Œä¹Ÿæ¬¢è¿åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p>","neighbors":{"left":{"article_title":"24 | æ·±å…¥è§£æå£°æ˜å¼APIï¼ˆä¸€ï¼‰ï¼šAPIå¯¹è±¡çš„å¥¥ç§˜","id":41876},"right":{"article_title":"26 | åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ï¼šRBAC","id":42154}},"comments":[{"had_liked":false,"id":33876,"user_name":"mgxian","can_delete":false,"product_type":"c1","uid":1014806,"ip_address":"","ucode":"7B7E77E6A83B87","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7c/16/4d1e5cc1.jpg","comment_is_top":false,"comment_ctime":1539913835,"is_pvip":false,"replies":[{"id":"12139","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","comment_id":33876,"uid":"1218095","ip_address":"","utype":1,"ctime":1539924124,"user_name_real":"Geek_6ef93d"}],"discussion_count":3,"race_medal":0,"score":"388086970475","product_id":100015201,"comment_content":"Informer å’Œæ§åˆ¶å¾ªç¯åˆ†å¼€æ˜¯ä¸ºäº†è§£è€¦ï¼Œé˜²æ­¢æ§åˆ¶å¾ªç¯æ‰§è¡Œè¿‡æ…¢æŠŠInformer æ‹–æ­»","like_count":91,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427066,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539924124,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1740409,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/8e/79/f9d5dd3a.jpg","nickname":"å•è¶…","note":"","ucode":"B36883984BE16B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":354363,"discussion_content":"åªè¦æ˜¯é˜Ÿåˆ—ï¼Œé‚£å°±æ˜¯è§£è€¦+å‰Šå³°","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1615280157,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1793475,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/5d/c3/69019d24.jpg","nickname":"æ±Ÿä¸œ","note":"","ucode":"391A62BC7039B3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560567,"discussion_content":"æ§åˆ¶å™¨ä½¿ç”¨æ­»å¾ªç¯å®ç°çš„ï¼Œé˜Ÿåˆ—è¿™é‡Œæ˜¯ä¸æ˜¯åœ¨æ•°æ®ä¸ºç©ºçš„æƒ…å†µä¸‹ä¼šé˜»å¡æ§åˆ¶å™¨è¿›ç¨‹ï¼Œä»è€Œé¿å…cpu100%","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649392990,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":36219,"user_name":"142","can_delete":false,"product_type":"c1","uid":1149480,"ip_address":"","ucode":"A5D7C484E3503C","user_header":"https://static001.geekbang.org/account/avatar/00/11/8a/28/45cf7f34.jpg","comment_is_top":false,"comment_ctime":1540983710,"is_pvip":false,"discussion_count":9,"race_medal":0,"score":"323663530910","product_id":100015201,"comment_content":"è¿ç»´äººå‘˜çœ‹èµ·æ¥è¶Šæ¥è¶Šè´¹åŠ›äº†ğŸ˜¢","like_count":75,"discussions":[{"author":{"id":1444321,"avatar":"https://static001.geekbang.org/account/avatar/00/16/09/e1/100a0526.jpg","nickname":"kakj","note":"","ucode":"9F052B64B9A4FE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1614,"discussion_content":"javaå¼€å‘äººå‘˜ä¹Ÿè¶Šæ¥è¶Šè´¹åŠ›äº†","likes_number":10,"is_delete":false,"is_hidden":false,"ctime":1562732529,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1799687,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/76/07/db4ef4a8.jpg","nickname":"æ›¹å¨Ÿå„¿","note":"","ucode":"9969F9DB46E5E2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":292980,"discussion_content":"æ‡µåœˆing","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1595402454,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1000884,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/45/b4/afa76165.jpg","nickname":"åå­91","note":"","ucode":"68E792FB90CDDA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":16485,"discussion_content":"å®Œå…¨æ‡µé€¼äº†","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1568896309,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1048441,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ff/79/f400c4d1.jpg","nickname":"douge","note":"","ucode":"A6EB1AA3D53516","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":369395,"discussion_content":"å…¶å®æ€æƒ³ä¸éš¾ï¼Œå°±æ˜¯å¯¹ API å¯¹è±¡çš„å¢åˆ æŸ¥æ”¹ CRUD çš„å¤„ç†ï¼Œæ¥äº†ä¸€ä¸ªè¯·æ±‚ merge å¾—åˆ°æœ€æ–°çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€æ˜¯ç”¨æˆ·æœŸæœ›çš„ï¼Œå†å’Œå®é™…çŠ¶æ€å¯¹æ¯”ï¼Œä¸ä¸€è‡´å°±ä½œç›¸åº”å¤„ç†ã€‚å¯¹ç”¨æˆ·æ¥è¯´æ— éæ˜¯å£°æ˜æˆ‘è¦è¾¾åˆ°ä»€ä¹ˆçŠ¶æ€ï¼Œæ§åˆ¶å™¨æ¥å®ç°ï¼›è€Œä»¥å‰å‘½ä»¤å¼æ“ä½œçš„è¯ï¼Œæ— éæ˜¯æŠŠæ§åˆ¶å™¨å®ç°é€»è¾‘ä¸€æ­¥æ­¥æ•²æˆå‘½ä»¤æ‰§è¡Œè€Œå·²ã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1619017126,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1275407,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/0f/c7c8021d.jpg","nickname":"è±†è±†","note":"","ucode":"97788B134C3212","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552378,"discussion_content":"ä¹‹å‰æ­»ç£•è¿™ä¸€å—ï¼Œå•ƒä¸ä¸‹å»ã€‚è·³æ§½åï¼ŒåŒäº‹è·Ÿæˆ‘è¯´ï¼Œç›´æ¥ä¸Škubebuilderï¼Œæˆ‘ä¸æƒ³ï¼Œæˆ‘å°±æƒ³ææ‡‚ï¼Œå›è¿‡å¤´æ¥ï¼Œä¸€è¡Œä¸€è¡Œçš„çœ‹è¿™å‡ èŠ‚å…³äºoperatorçš„å¼€å‘ç« èŠ‚ï¼Œå°±æƒ³ææ¸…æ¥šå†…éƒ¨åŸç†ï¼Œç»ˆäºçœ‹æ‡‚äº†ï¼Œç»ˆäºææ˜ç™½äº†ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1645438507,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2663721,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er8sYHCPqtn0TRP72qup5YicYAvTDNP7b8cuykCR0o5Yb6ViaQJFKShJbMsWahVk4sQdwDU2UQf6NiaA/132","nickname":"akai","note":"","ucode":"8D4AA48A86B71C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1275407,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/0f/c7c8021d.jpg","nickname":"è±†è±†","note":"","ucode":"97788B134C3212","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577045,"discussion_content":"ç¾¡æ…•è€å“¥ï¼Œåªæœ‰å¤§å‚æ‰éœ€è¦è‡ªå·±å¼€å‘CRDå’ŒOperatorå§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655899673,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":552378,"ip_address":""},"score":577045,"extra":""}]},{"author":{"id":1648999,"avatar":"https://static001.geekbang.org/account/avatar/00/19/29/67/fc61a741.jpg","nickname":"ç”°å°éº¦","note":"","ucode":"4C10997F6173ED","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589685,"discussion_content":"éš¾å˜›ï¼Œå¯ä»¥ç†è§£ä¸ºè§‚å¯Ÿè€…æ¨¡å¼çš„å®ç°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665237067,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2068141,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eq5tIy8LaGwcm0gSibjaEvKIgkk5AoOfBGwgZMfZpm9Scyia3b1sEoQhOsWTynCt6Vt2YC5tXe7hFMA/132","nickname":"Hiram","note":"","ucode":"197F4B7F45E8EA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":408823,"discussion_content":"ä¸€è„¸æ‡µåœˆâ€¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635327532,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1259323,"avatar":"https://static001.geekbang.org/account/avatar/00/13/37/3b/495e2ce6.jpg","nickname":"é™ˆæ–¯ä½³","note":"","ucode":"C236F874FC767A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":403821,"discussion_content":"ä¸€è„¸æ‡µåœˆâ€¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634170104,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":219746,"user_name":"Tarjintor","can_delete":false,"product_type":"c1","uid":1519558,"ip_address":"","ucode":"AC5DD78B2EB962","user_header":"https://static001.geekbang.org/account/avatar/00/17/2f/c6/b7448158.jpg","comment_is_top":false,"comment_ctime":1590073527,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"254993143991","product_id":100015201,"comment_content":"ä¸çŸ¥é“ç°åœ¨è¿˜æœ‰äººçœ‹å›å¤æ²¡ï¼Œæˆ‘ç”¨äº†ä¸å°‘operatorï¼Œé‡åº¦ä½¿ç”¨rook&#47;ceph<br>æ„Ÿè§‰å£°æ˜å¼apiè¿˜æ˜¯æœ‰ä¸€äº›æœ¬è´¨ä¸è¶³çš„åœ°æ–¹ï¼Œä¸»è¦æ˜¯<br>1.é€šå¸¸operatoréƒ½æ˜¯ç”¨æ¥æè¿°å¤æ‚æœ‰çŠ¶æ€é›†ç¾¤çš„ï¼Œè¿™ä¸ªé›†ç¾¤æœ¬èº«å°±å·²ç»å¾ˆå¤æ‚äº†<br>2.å£°æ˜å¼apié€šè¿‡diffçš„æ–¹å¼æ¥å¾—å‡ºé›†ç¾¤è¦åšæ€ä¹ˆæ ·çš„çŠ¶æ€å˜è¿ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¸¸å¸¸ä¼šæœ‰å¾ˆå¤šçŠ¶å†µä¸èƒ½è¦†ç›–åˆ°ï¼Œè€Œå¦‚æœä½¿ç”¨è€…å¯¹æ­¤æ²¡æœ‰æ·±åˆ»çš„è®¤è¯†ï¼Œå°±ä¼šè¶Šç”¨è¶Šç³Šæ¶‚<br>å¤§è‡´æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªé›†ç¾¤æœ¬èº«çš„çŠ¶æ€æœ‰nç§ï¼Œé‚£ä¹ˆoperatorç†è®ºä¸Šå°±è¦è¦†ç›–n*(n-1)ç§å˜è¿çš„å¯èƒ½æ€§ï¼Œè€Œè¿™ä¸ªä½“åŠ›æ´»å‡ ä¹æ˜¯ä¸å¯èƒ½å®Œæˆçš„ï¼Œæ‰€æœ‰å¾ˆå¤šoperatorç»å¸¸æ€§çš„ä¸æ”¯æŒæŸäº›æ“ä½œï¼Œè€Œä¸æ˜¯åƒä½¿ç”¨è€…æƒ³è±¡çš„é‚£æ ·ï¼Œæˆ‘æ”¹æ”¹yamlï¼Œapplyä¸€ä¸‹å°±å®Œäº‹äº†<br>æ›´é‡è¦çš„æ˜¯ï¼Œç”±äºæƒ…å†µå¤ªå¤šå¤ªå¤æ‚ï¼Œç”šè‡³æ— æ³•é€šè¿‡æ–‡æ¡£çš„æ–¹å¼ï¼Œå‘Šè¯‰ä½¿ç”¨è€…ï¼ŒçŠ¶æ€1çš„é›†ç¾¤ï¼ŒæŒ‰æŸç§æ–¹å¼ä¿®æ”¹äº†yamlä¹‹åï¼Œæ˜¯ä¸èƒ½å˜æˆä½¿ç”¨è€…æœŸå¾…çš„çŠ¶æ€2çš„<br><br>å¦‚æœæ˜¯ä¼ ç»Ÿçš„å‘½ä»¤å¼æ–¹å¼ï¼Œé‚£ä¹ˆå°±æ˜¯æ‰€æœ‰å¯èƒ½æœ‰çš„åŠŸèƒ½ï¼Œéƒ½ä¼šç½—åˆ—å‡ºæ¥ï¼Œå¯èƒ½nä¸ªçŠ¶æ€ï¼Œåªæœ‰2n+3ä¸ªæ“ä½œæ˜¯åˆæ³•çš„ï¼Œå‰©ä¸‹éƒ½æ˜¯åšä¸åˆ°çš„ï¼Œè¿™æ ·ä½¿ç”¨è€…å›ºç„¶å—åˆ°äº†é™åˆ¶ï¼Œä½†è¿™ç§é™åˆ¶ä¹Ÿè®©å¾ˆå¤šæ—¶å€™çš„æ“ä½œå˜å¾—æ›´åŠ æ¸…æ™°æ˜äº†,è€Œä¸æ˜¯æ¯æ¬¡æ”¹yamlè¿˜è¦æ€è€ƒä¸€ä¸‹ï¼Œè¿™ä¹ˆæ”¹ï¼Œoperatoræ”¯æŒå—ï¼Ÿ<br><br>å½“ç„¶ï¼Œå£°æ˜å¼apiçš„å¥½å¤„ä¹Ÿæ˜¯æ˜æ˜¾çš„ï¼Œå¦‚æœè¿™ä¸ªdiffæ˜¯operatorè¦†ç›–åˆ°çš„ï¼Œé‚£ä¹ˆå°±èƒ½æå¤§çš„å‡è½»ä½¿ç”¨è€…çš„è´Ÿæ‹…ï¼Œapplyä¸‹å°±è§£è„±äº†<br><br>è€Œè¿™ä¸ªé›†ç¾¤çŠ¶æ€å˜è¿çš„é—®é¢˜æ˜¯æœ¬è´¨å¤æ‚çš„ï¼Œå¿…ç„¶æ²¡æœ‰å¯ä»¥æ¶ˆé™¤å¤æ‚åº¦çš„è§£æ³•ï¼Œæ— éå°±æ˜¯è¿™ä¸ªå¤æ‚åº¦åœ¨operatorçš„å®ç°è€…é‚£é‡Œï¼Œè¿˜æ˜¯åœ¨è¿ç»´è€…é‚£é‡Œï¼Œåœ¨operatorçš„å®ç°è€…é‚£é‡Œï¼Œå¥½å¤„å°±æ˜¯å›ºåŒ–çš„å¸¸ç”¨çš„å˜è¿è·¯å¾„ï¼Œä½¿ç”¨èµ·æ¥å¾ˆæ–¹ä¾¿ï¼Œä½†å¦‚æœoperatorçš„å¼€å‘è€…æ²¡æœ‰å®ç°æŸä¸ªçŠ¶æ€çš„å˜è¿è·¯å¾„ï¼Œè€Œè¿™ä¸ªæœ¬èº«æ˜¯å¯ä»¥åšåˆ°çš„ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå°±æ¯”ä¸ä¸Šå‘½ä»¤å¼çµæ´»ï¼Œä¸ªäººæ„Ÿè§‰å°±æ˜¯å–èˆäº†","like_count":60,"discussions":[{"author":{"id":1048441,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ff/79/f400c4d1.jpg","nickname":"douge","note":"","ucode":"A6EB1AA3D53516","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293565,"discussion_content":"ä¸€ä¸ªå¤æ‚çš„é—®é¢˜å’Œç”¨å‘½ä»¤å¼è¯­è¨€è¿˜æ˜¯å‡½æ•°å¼è¯­è¨€å®ç°æ— å…³ï¼Œä½†æ˜¯ä¸åŒçš„è¯­è¨€è¡¨è¾¾èƒ½åŠ›å’ŒæŠ½è±¡ç¨‹åº¦æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¸ªäººè§‰å¾—å£°æ˜å¼ api ç”¨ç»Ÿä¸€çš„æ¡†æ¶æè¿°äº†çŠ¶æ€å˜æ›´ï¼ŒæŠ½è±¡ç¨‹åº¦æ›´é«˜ï¼Œå¯¹ä½¿ç”¨è€…æ›´åŠ å‹å¥½ã€‚ä½ è¯´çš„çŠ¶æ€çˆ†ç‚¸é—®é¢˜ï¼Œæˆ‘è§‰å¾—æ›´å¤šçš„æ˜¯æ€ä¹ˆè®¾è®¡ operator çš„é—®é¢˜ï¼Œæ¯”å¦‚æ˜¯å¦å¯ä»¥å°† n ä¸ªçŠ¶æ€æ‹†åˆ†ï¼ŒæŠŠæ— ä¾èµ–å…³ç³»çš„çŠ¶æ€ç‹¬ç«‹å‡ºæ¥ï¼Œè¿™æ ·ç¼–å†™å’Œç»´æŠ¤æ›´åŠ æ–¹ä¾¿ï¼Œç”¨æˆ·ç†è§£çŠ¶æ€è¯¥å¦‚ä½•å˜æ›´ä¹Ÿæ›´åŠ æ¸…æ™°ã€‚è‡³äºä½ è¯´çš„æ–‡æ¡£é—®é¢˜ï¼Œåªè¦ä¿è¯çŠ¶æ€å˜è¿åŸºæœ¬ç¬¦åˆå¤§å®¶çº¦å®šçš„åŸºæœ¬è§„åˆ™å³å¯ï¼Œç‰¹æ®Šæƒ…å†µç‰¹æ®Šæ³¨æ˜ã€‚","likes_number":8,"is_delete":false,"is_hidden":false,"ctime":1595582644,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1380758,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJrOl63enWXCRxN0SoucliclBme0qrRb19ATrWIOIvibKIz8UAuVgicBMibIVUznerHnjotI4dm6ibODA/132","nickname":"Helios","note":"","ucode":"BE6B98EE8F0D09","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":292899,"discussion_content":"æœ‰çŠ¶æ€åº”ç”¨çš„å¤æ‚åº¦æ— è®ºé€šè¿‡ä»€ä¹ˆæ ·çš„æ–¹å¼éƒ¨ç½²çš„éƒ½æ˜¯ä¸€æ ·çš„ï¼Œoperatorçš„ç›®æ ‡æ˜¯é€šè¿‡ä¸€ä¸ªyamlæ–‡ä»¶è®©è¿™ä¸ªæœ‰çŠ¶æ€åº”ç”¨éƒ¨ç½²åœ¨é›†ç¾¤ä¸­ã€‚\nâ€œ.å£°æ˜å¼apié€šè¿‡diffçš„æ–¹å¼æ¥å¾—å‡ºé›†ç¾¤è¦åšæ€ä¹ˆæ ·çš„çŠ¶æ€å˜è¿â€å¯¹äºè¿™ä¸€ç‚¹ï¼Œk8såªæ˜¯å…³å¿ƒç›®æ ‡çŠ¶æ€ï¼Œapplyçš„æ—¶å€™æ˜¯ç±»ä¼¼äºgit diffçš„æ—¶å€™å»patchã€‚\n\n\nâ€œå¤§è‡´æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªé›†ç¾¤æœ¬èº«çš„çŠ¶æ€æœ‰nç§ï¼Œé‚£ä¹ˆoperatorç†è®ºä¸Šå°±è¦è¦†ç›–n*(n-1)ç§å˜è¿çš„å¯èƒ½æ€§ï¼Œè€Œè¿™ä¸ªä½“åŠ›æ´»å‡ ä¹æ˜¯ä¸å¯èƒ½å®Œæˆçš„ï¼Œæ‰€æœ‰å¾ˆå¤šoperatorç»å¸¸æ€§çš„ä¸æ”¯æŒæŸäº›æ“ä½œï¼Œè€Œä¸æ˜¯åƒä½¿ç”¨è€…æƒ³è±¡çš„é‚£æ ·ï¼Œæˆ‘æ”¹æ”¹yamlï¼Œapplyä¸€ä¸‹å°±å®Œäº‹äº†\næ›´é‡è¦çš„æ˜¯ï¼Œç”±äºæƒ…å†µå¤ªå¤šå¤ªå¤æ‚ï¼Œç”šè‡³æ— æ³•é€šè¿‡æ–‡æ¡£çš„æ–¹å¼ï¼Œå‘Šè¯‰ä½¿ç”¨è€…ï¼ŒçŠ¶æ€1çš„é›†ç¾¤ï¼ŒæŒ‰æŸç§æ–¹å¼ä¿®æ”¹äº†yamlä¹‹åï¼Œæ˜¯ä¸èƒ½å˜æˆä½¿ç”¨è€…æœŸå¾…çš„çŠ¶æ€2çš„\n\nå¦‚æœæ˜¯ä¼ ç»Ÿçš„å‘½ä»¤å¼æ–¹å¼ï¼Œé‚£ä¹ˆå°±æ˜¯æ‰€æœ‰å¯èƒ½æœ‰çš„åŠŸèƒ½ï¼Œéƒ½ä¼šç½—åˆ—å‡ºæ¥ï¼Œå¯èƒ½nä¸ªçŠ¶æ€ï¼Œåªæœ‰2n+3ä¸ªæ“ä½œæ˜¯åˆæ³•çš„ï¼Œå‰©ä¸‹éƒ½æ˜¯åšä¸åˆ°çš„ï¼Œè¿™æ ·ä½¿ç”¨è€…å›ºç„¶å—åˆ°äº†é™åˆ¶ï¼Œä½†è¿™ç§é™åˆ¶ä¹Ÿè®©å¾ˆå¤šæ—¶å€™çš„æ“ä½œå˜å¾—æ›´åŠ æ¸…æ™°æ˜äº†,è€Œä¸æ˜¯æ¯æ¬¡æ”¹yamlè¿˜è¦æ€è€ƒä¸€ä¸‹ï¼Œè¿™ä¹ˆæ”¹ï¼Œoperatoræ”¯æŒå—ï¼Ÿâ€\næ‚¨è¿™ä¸ªè¯´çš„æ¯”è¾ƒæŠ½è±¡ï¼Œèƒ½ä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ä¹ˆã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1595381170,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2057451,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/64/eb/732e9707.jpg","nickname":"é’è‹¹æœ","note":"","ucode":"D85EE1743F9CC5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381509,"discussion_content":"è¯´å‡ºäº†æˆ‘çš„å¿ƒå£°â€¦â€¦","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1625106948,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1073261,"avatar":"https://static001.geekbang.org/account/avatar/00/10/60/6d/3c2a5143.jpg","nickname":"äºŒè¿›åˆ¶å‚»ç“œ","note":"","ucode":"FA8E76339CF512","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580583,"discussion_content":"å‰ç«¯å¼€å‘ä¹Ÿæ˜¯ä»å‘½ä»¤å¼æ…¢æ…¢è½¬åˆ°å£°æ˜å¼ï¼Œå£°æ˜å¼ä½¿ç”¨é—¨æ§›æ¯”è¾ƒä½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658279603,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1121758,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","nickname":"aoe","note":"","ucode":"1C6201EDB4E954","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308473,"discussion_content":"å¯¹å°ç™½æ¥è¯´å£°æ˜å¼APIè¿˜æ˜¯å¾ˆå‹å¥½çš„ï¼Œæ¯”å¦‚æˆ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600959163,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":33946,"user_name":"Joe Black","can_delete":false,"product_type":"c1","uid":1052528,"ip_address":"","ucode":"21FE222A286445","user_header":"https://static001.geekbang.org/account/avatar/00/10/0f/70/c8680841.jpg","comment_is_top":false,"comment_ctime":1539924878,"is_pvip":false,"replies":[{"id":"12148","content":"è¯´å¯¹äº†ã€‚æ‰€ä»¥è¯´æŠŠkubernetesè·Ÿswarm mesoså„ç§paasç­‰æ¨ªå‘æ¯”è¾ƒæ²¡å•¥å®é™…æ„ä¹‰","user_name":"ä½œè€…å›å¤","comment_id":33946,"uid":"1218095","ip_address":"","utype":1,"ctime":1539935005,"user_name_real":"Geek_6ef93d"}],"discussion_count":2,"race_medal":0,"score":"181928551310","product_id":100015201,"comment_content":"çœ‹äº†è¿™ä¸¤å¤©çš„æ–‡ç« ï¼Œæ„Ÿè§‰k8sçš„æœºåˆ¶å®åœ¨æ˜¯å¤ªå…·æœ‰æ™®é€‚æ€§äº†ï¼Œå¯ä»¥åŸºäºå®ƒæ„å»ºå„ç§åˆ†å¸ƒå¼ä¸šåŠ¡å¹³å°ã€‚æœ¬è´¨ä¸Šå®ƒå°±æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼å¯¹è±¡ç®¡ç†å¹³å°ã€‚","like_count":42,"discussions":[{"author":{"id":1837179,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/08/7b/7f086546.jpg","nickname":"Alex","note":"","ucode":"70806CEA9AB15E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584366,"discussion_content":"è¯´çš„å¤ªå¯¹äº†æˆ‘ä¹Ÿæœ‰è¿™ç§èµ¶è„šï¼Œk8sç»™äººçš„æ„Ÿè§‰å°±æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼å¯¹è±¡ç®¡ç†å¹³å°ï¼Œå®¹å™¨åŒ–éƒ¨ç½²","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1660789813,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427080,"discussion_content":"è¯´å¯¹äº†ã€‚æ‰€ä»¥è¯´æŠŠkubernetesè·Ÿswarm mesoså„ç§paasç­‰æ¨ªå‘æ¯”è¾ƒæ²¡å•¥å®é™…æ„ä¹‰","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1539935005,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":37565,"user_name":"è¶…","can_delete":false,"product_type":"c1","uid":1019528,"ip_address":"","ucode":"84165555837698","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8e/88/8cbf2527.jpg","comment_is_top":false,"comment_ctime":1541641651,"is_pvip":false,"replies":[{"id":"13576","content":"æ‰€ä»¥è¯´kubernetes å½“å‰è§„æ¨¡æ˜¯5000","user_name":"ä½œè€…å›å¤","comment_id":37565,"uid":"1218095","ip_address":"","utype":1,"ctime":1541719375,"user_name_real":"Geek_6ef93d"}],"discussion_count":3,"race_medal":0,"score":"117505758643","product_id":100015201,"comment_content":"å¦‚æœä¸€ä¸ªmaster ç®¡ç†çš„nodeéå¸¸å¤š é€šè¿‡ListAndWatch ä¼šå¯¹masterçš„æ€§èƒ½æœ‰å½±å“å§","like_count":27,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428403,"discussion_content":"æ‰€ä»¥è¯´kubernetes å½“å‰è§„æ¨¡æ˜¯5000","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1541719375,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1121758,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","nickname":"aoe","note":"","ucode":"1C6201EDB4E954","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308474,"discussion_content":"åŸæ¥masteræœ‰è¿™ä¹ˆå¤šå·¥ä½œè¦åšï¼Œæˆ‘è¿˜ä»¥ä¸ºå®ƒå°±æ˜¯åƒNginxä¸€æ ·ï¼Œè½¬å‘ä¸€ä¸‹è¯·æ±‚ï¼Œçœ‹çœ‹å“ªä¸ªæŒ‚äº†ï¼Œé‡å¯ä¸€ä¸‹","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1600959255,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"å›¢","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534533,"discussion_content":"Mark.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638203197,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50143,"user_name":"å‹¤åŠ³çš„å°èƒ–å­-libo","can_delete":false,"product_type":"c1","uid":1158344,"ip_address":"","ucode":"5BB20CD5A56568","user_header":"https://static001.geekbang.org/account/avatar/00/11/ac/c8/4b1c0d40.jpg","comment_is_top":false,"comment_ctime":1544878285,"is_pvip":false,"replies":[{"id":"18030","content":"å¯¹çš„","user_name":"ä½œè€…å›å¤","comment_id":50143,"uid":"1218095","ip_address":"","utype":1,"ctime":1544904175,"user_name_real":"Geek_6ef93d"}],"discussion_count":1,"race_medal":0,"score":"74559322317","product_id":100015201,"comment_content":"ä¸€èˆ¬è¿™ç§å·¥ä½œé˜Ÿåˆ—ç»“æ„ä¸»è¦æ˜¯ä¸ºäº†åŒ¹é…åŒæ–¹é€Ÿåº¦ä¸ä¸€è‡´ï¼Œä¹Ÿä¸ºäº†decoupleåŒæ–¹ã€‚æ¯”å¦‚å…¸å‹ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜","like_count":17,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432889,"discussion_content":"å¯¹çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544904175,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":72432,"user_name":"å“ˆå“¼","can_delete":false,"product_type":"c1","uid":1417824,"ip_address":"","ucode":"C1108406573D49","user_header":"https://static001.geekbang.org/account/avatar/00/15/a2/60/f3939ab4.jpg","comment_is_top":false,"comment_ctime":1551623854,"is_pvip":false,"discussion_count":6,"race_medal":0,"score":"44501296814","product_id":100015201,"comment_content":"è‡ªå®šä¹‰çš„controlerè¿™ä¹ˆæ‰‹åŠ¨è·‘ç€ï¼ŒæŒ‚äº†å’‹åŠï¼Ÿï¼Œæ˜¯ä¸æ˜¯åº”è¯¥å‡†å¤‡å¥½é•œåƒï¼Œç”¨Deploymentè·‘èµ·æ¥ï¼Ÿ","like_count":11,"discussions":[{"author":{"id":1198816,"avatar":"https://static001.geekbang.org/account/avatar/00/12/4a/e0/eff34583.jpg","nickname":"é©¬è¶…","note":"","ucode":"FAFF55DC5DD15C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":200056,"discussion_content":"å¯¹çš„ï¼Œå’Œdeploymentä¸€æ ·äº¤ç»™k8sç®¡ç†ç”Ÿå‘½å‘¨æœŸ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1583653266,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1513000,"avatar":"https://static001.geekbang.org/account/avatar/00/17/16/28/41aed84a.jpg","nickname":"Zwj","note":"","ucode":"6F1A01F27BEC1A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587826,"discussion_content":"æ— çº¿å¥—å¨ƒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663310484,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1076347,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM5suA7q5mM40ULTY5OlQpoerPRMQD8NcMbKxDHhNmjQNUCngkSJEzRvMVDibAHw2whGZxAFlibzribOA/132","nickname":"jxlwqq","note":"","ucode":"94AEEEEB55C6AA","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":395419,"discussion_content":"operator-sdk å’Œ olm çš„ä½œç”¨å°±ä½“ç°å‡ºæ¥äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632303042,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1702153,"avatar":"https://static001.geekbang.org/account/avatar/00/19/f9/09/57877ee6.jpg","nickname":"Lã€t t t","note":"","ucode":"68D62F4BA6088B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380316,"discussion_content":"å¯¹è±¡ç®¡ç†å¯¹è±¡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624435491,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1218501,"avatar":"https://static001.geekbang.org/account/avatar/00/12/97/c5/84491beb.jpg","nickname":"ç½—å³°","note":"","ucode":"5F3D6AF8F28322","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374629,"discussion_content":"æ‰€ä»¥ä¸€ç§èµ„æºç±»å‹å¤„ç†å¯¹åº”çš„äº‹ä»¶ï¼Œå¯ä»¥åµŒå¥—ä½¿ç”¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621296375,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1354151,"avatar":"https://static001.geekbang.org/account/avatar/00/14/a9/a7/de3ee890.jpg","nickname":"æ‹‰æˆ‘åƒ","note":"","ucode":"8BC9C44FE00097","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1218501,"avatar":"https://static001.geekbang.org/account/avatar/00/12/97/c5/84491beb.jpg","nickname":"ç½—å³°","note":"","ucode":"5F3D6AF8F28322","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378532,"discussion_content":"è¿™ä¸ªè§£é‡Šæ²¡æœ‰çœ‹æ‡‚ï¼Œèƒ½éº»çƒ¦è¯¦ç»†è¯´è¯´å—ï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1623279037,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":374629,"ip_address":""},"score":378532,"extra":""}]}]},{"had_liked":false,"id":33959,"user_name":"gogo","can_delete":false,"product_type":"c1","uid":1003104,"ip_address":"","ucode":"E8F0F3B000020A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4e/60/0d5aa340.jpg","comment_is_top":false,"comment_ctime":1539930112,"is_pvip":false,"replies":[{"id":"12147","content":"è¦ç”¨æ»šåŠ¨æ›´æ–°å°±ä¸è¦ç”¨latest tagï¼Œå¦åˆ™ä½ å‡†å¤‡æ€ä¹ˆçŸ¥é“å½“å‰åœ¨ç”¨çš„æ˜¯å“ªä¸ªç‰ˆæœ¬çš„é•œåƒï¼Ÿ","user_name":"ä½œè€…å›å¤","comment_id":33959,"uid":"1218095","ip_address":"","utype":1,"ctime":1539934921,"user_name_real":"Geek_6ef93d"}],"discussion_count":2,"race_medal":0,"score":"44489603072","product_id":100015201,"comment_content":"è¯·é—®è€å¸ˆï¼Œå¦‚æœç”¨deploymentéƒ¨ç½²ä¸€ä¸ªtagæ˜¯latestçš„é•œåƒï¼Œæ€æ ·è¿›è¡Œæ»šåŠ¨æ›´æ–°å‘¢ï¼Ÿset imageçš„è¯tagä¸å˜ï¼Œä¸èƒ½å‡ºå‘æ›´æ–°å‘¢","like_count":10,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427087,"discussion_content":"è¦ç”¨æ»šåŠ¨æ›´æ–°å°±ä¸è¦ç”¨latest tagï¼Œå¦åˆ™ä½ å‡†å¤‡æ€ä¹ˆçŸ¥é“å½“å‰åœ¨ç”¨çš„æ˜¯å“ªä¸ªç‰ˆæœ¬çš„é•œåƒï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1539934921,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2086973,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/d8/3d/8a44993f.jpg","nickname":"OldFox","note":"","ucode":"6195262F3A9AA9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380390,"discussion_content":"éè¦æçš„è¯ï¼Œä¸ç”¨set imageï¼Œpatchç‚¹åˆ«çš„ä¿¡æ¯ï¼Œé•œåƒæ‹‰å–ç­–ç•¥ä¸ºalwaysã€‚ä½†æ˜¯è¿˜æ˜¯æ¨èåˆ«ç”¨tag latestã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1624463638,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":252042,"user_name":"ch_ort","can_delete":false,"product_type":"c1","uid":1580926,"ip_address":"","ucode":"B79746E687F29E","user_header":"","comment_is_top":false,"comment_ctime":1602075553,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"40256781217","product_id":100015201,"comment_content":"Kuberentesçš„APIå¯¹è±¡ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œé€šå¸¸å¯ä»¥å½’ç»“ä¸ºï¼š &#47;apis&#47;group&#47;version&#47;resourceï¼Œä¾‹å¦‚<br><br>    apiVersion: Group&#47;Version<br>    kind: Resource<br><br>APIServeråœ¨æ¥æ”¶ä¸€ä¸ªè¯·æ±‚ä¹‹åï¼Œä¼šæŒ‰ç…§ &#47;apis&#47;group&#47;version&#47;resourceçš„è·¯å¾„æ‰¾åˆ°å¯¹åº”çš„Resourceç±»å‹å®šä¹‰ï¼Œæ ¹æ®è¿™ä¸ªç±»å‹å®šä¹‰å’Œç”¨æˆ·æäº¤çš„yamlé‡Œçš„å­—æ®µåˆ›å»ºå‡ºä¸€ä¸ªå¯¹åº”çš„Resourceå¯¹è±¡<br><br>CRDæœºåˆ¶ï¼š<br>ï¼ˆ1ï¼‰å£°æ˜ä¸€ä¸ªCRDï¼Œè®©k8sèƒ½å¤Ÿè®¤è¯†å’Œå¤„ç†æ‰€æœ‰å£°æ˜äº†APIæ˜¯&quot;&#47;apis&#47;group&#47;version&#47;resource&quot;çš„YAMLæ–‡ä»¶äº†ã€‚åŒ…æ‹¬ï¼šç»„ï¼ˆGroupï¼‰ã€ç‰ˆæœ¬ï¼ˆVersionï¼‰ã€èµ„æºç±»å‹ï¼ˆResourceï¼‰ç­‰ã€‚<br>ï¼ˆ2ï¼‰ç¼–å†™goä»£ç ï¼Œè®©k8sèƒ½å¤Ÿè¯†åˆ«yamlå¯¹è±¡çš„æè¿°ã€‚åŒ…æ‹¬ï¼šSpecã€Statusç­‰<br>ï¼ˆ3ï¼‰ä½¿ç”¨k8sä»£ç ç”Ÿæˆå·¥å…·è‡ªåŠ¨ç”Ÿæˆclientsetã€informerå’Œlister<br>ï¼ˆ4ï¼‰ ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰æ§åˆ¶å™¨ï¼Œæ¥å¯¹æ‰€å…³å¿ƒå¯¹è±¡è¿›è¡Œç›¸å…³æ“ä½œ<br><br><br><br>ï¼ˆ1ï¼‰ï¼ˆ2ï¼‰æ­¥éª¤ä¹‹åï¼Œå°±å¯ä»¥é¡ºåˆ©é€šè¿‡kubectl apply xxx.yaml æ¥åˆ›å»ºå‡ºå¯¹åº”çš„CRDå’ŒCRäº†ã€‚ ä½†å®é™…ä¸Šï¼Œk8sçš„etcdä¸­æœ‰äº†è¿™æ ·çš„å¯¹è±¡ï¼Œå´ä¸ä¼šè¿›è¡Œå®é™…çš„ä¸€äº›åç»­æ“ä½œï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰ç¼–å†™å¯¹åº”CRDçš„æ§åˆ¶å™¨ã€‚æ§åˆ¶å™¨éœ€è¦ï¼šæ„ŸçŸ¥æ‰€å…³å¿ƒå¯¹è±¡è¿‡çš„å˜åŒ–ï¼Œè¿™æ˜¯é€šè¿‡ä¸€ä¸ªInformeræ¥å®Œæˆçš„ã€‚è€ŒInformeræ‰€éœ€è¦çš„ä»£ç ï¼Œæ­£æ˜¯ä¸Šè¿°ï¼ˆ3ï¼‰æ­¥éª¤ç”Ÿæˆã€‚<br>","like_count":9,"discussions":[{"author":{"id":1254691,"avatar":"https://static001.geekbang.org/account/avatar/00/13/25/23/06a37753.jpg","nickname":"jesse","note":"","ucode":"8A72075A22D973","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368123,"discussion_content":"ï¼ˆ1ï¼‰ä¹‹åk8så°±å¯ä»¥è¯†åˆ«ä½ å®šä¹‰çš„èµ„æºäº†ï¼Œç¼–å†™goä»£ç æ˜¯ä¸ºäº†å®ç°æ§åˆ¶å™¨ï¼Œèµ„æºå¢åˆ æ”¹å˜åŒ–è§¦å‘æ§åˆ¶å™¨å¯¹åº”å›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°é€šè¿‡èµ„æºçš„å…·ä½“å¯¹è±¡æè¿°(specå®šä¹‰çš„å­—æ®µ)æ‰§è¡Œå…·ä½“çš„äº‹ä»¶æ“ä½œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618574457,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":266700,"user_name":"Rain","can_delete":false,"product_type":"c1","uid":1175329,"ip_address":"","ucode":"603DFFAC6A3755","user_header":"https://static001.geekbang.org/account/avatar/00/11/ef/21/69c181b8.jpg","comment_is_top":false,"comment_ctime":1607442858,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"27377246634","product_id":100015201,"comment_content":"```æ­¤å¤–ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ¯ç»è¿‡ resyncPeriod æŒ‡å®šçš„æ—¶é—´ï¼ŒInformer ç»´æŠ¤çš„æœ¬åœ°ç¼“å­˜ï¼Œéƒ½ä¼šä½¿ç”¨æœ€è¿‘ä¸€æ¬¡ LIST è¿”å›çš„ç»“æœå¼ºåˆ¶æ›´æ–°ä¸€æ¬¡ï¼Œä»è€Œä¿è¯ç¼“å­˜çš„æœ‰æ•ˆæ€§ã€‚åœ¨ Kubernetes ä¸­ï¼Œè¿™ä¸ªç¼“å­˜å¼ºåˆ¶æ›´æ–°çš„æ“ä½œå°±å«ä½œï¼šresyncã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªå®šæ—¶ resync æ“ä½œï¼Œä¹Ÿä¼šè§¦å‘ Informer æ³¨å†Œçš„â€œæ›´æ–°â€äº‹ä»¶ã€‚```<br>è€å¸ˆï¼Œè¿™ä¸ªåœ°æ–¹è²Œä¼¼è¯´çš„æœ‰ç‚¹é—®é¢˜ï¼Œçœ‹ä»£ç é€»è¾‘ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼ŒListAndWatchåªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œå³å…ˆæ‰§è¡ŒListæŠŠæ•°æ®æ‹‰è¿‡æ¥ï¼Œç„¶åæ›´æ–°ä¸€æ¬¡æœ¬åœ°ç¼“å­˜ï¼Œåç»­å°±è¿›å…¥Watché˜¶æ®µï¼Œé€šè¿‡ç›‘å¬äº‹ä»¶æ¥å®æ—¶æ›´æ–°æœ¬åœ°ç¼“å­˜ï¼Œè€Œåªæœ‰åœ¨ListAndWatchè¿‡ç¨‹ä¸­ï¼Œå› å¼‚å¸¸é€€å‡ºæ—¶ï¼Œæ¯”å¦‚apiserveræœ‰é—®é¢˜ï¼Œæ²¡æ³•æ­£å¸¸ListAndWatchæ—¶ï¼Œæ‰ä¼šå‘¨æœŸæ€§çš„å°è¯•è¿›è¡ŒListAndWatchï¼Œè€Œè¿™ä¸ªå‘¨æœŸä¹Ÿä¸æ˜¯resyncPeriodæ¥æ§åˆ¶çš„ï¼Œè€Œæ˜¯ä¸€ä¸ªå˜åŠ¨çš„backoffæ—¶é—´ï¼Œä»¥é˜²æ­¢ç»™apiserveré€ æˆå‹åŠ›ï¼Œè€ŒçœŸæ­£çš„resyncï¼Œå…¶å®è¯´çš„ä¸æ˜¯å‘¨æœŸæ€§æ›´æ–°ç¼“å­˜ï¼Œè€Œæ˜¯æ ¹æ®ç°æœ‰çš„ç¼“å­˜ï¼Œå‘¨æœŸæ€§çš„è§¦å‘UpdateFuncï¼Œå³åŒæ­¥å½“å‰çŠ¶æ€å’Œç›®çš„çŠ¶æ€ï¼Œç¡®ä¿å¹‚ç­‰æ€§ï¼Œè¿™ä¸ªå‘¨æœŸåˆ™æ˜¯ç”±resyncPeriodæ§åˆ¶çš„ã€‚æ‰€ä»¥â€œæ¯ç»è¿‡resyncPeriodæ—¶é—´ï¼Œå¼ºåˆ¶æ›´æ–°ç¼“å­˜â€ï¼Œåº”è¯¥æ˜¯æ²¡è¿™ä¸ªé€»è¾‘çš„å§ï¼Œè¿˜è¯·è€å¸ˆç¡®è®¤ä¸‹:)<br><br>","like_count":6,"discussions":[{"author":{"id":1207457,"avatar":"https://static001.geekbang.org/account/avatar/00/12/6c/a1/80d83f0a.jpg","nickname":"Ellison","note":"","ucode":"A2FB94D4F6A332","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335168,"discussion_content":"è²Œä¼¼ç°åœ¨ç¡®å®æ˜¯ï¼Œ åªæ˜¯å…¨é‡æ›´æ–°ä¸€æ¬¡ï¼Œ åé¢å°±æ˜¯watch and list","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608109640,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326471,"user_name":"Casper","can_delete":false,"product_type":"c1","uid":1022129,"ip_address":"","ucode":"69282EB175B48E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/98/b1/f89a84d0.jpg","comment_is_top":false,"comment_ctime":1639536798,"is_pvip":true,"discussion_count":2,"race_medal":5,"score":"23114373278","product_id":100015201,"comment_content":"å®é™…æ“ä½œç¯å¢ƒ: k8s v1.22.4, go1.17.4<br>å°†åŸå§‹ä»£ç cloneä¸‹æ¥å, æ‰§è¡Œ go mod init -&gt; go mod tidy -&gt; go build -o samplecrd-controller .<br><br>è¿è¡Œ:<br>.&#47;samplecrd-controller -kubeconfig=$HOME&#47;.kube&#47;config -alsologtostderr=true<br><br>crd çš„yamlæ ¼å¼éœ€è¦ä¿®æ”¹ä¸º:<br>apiVersion: apiextensions.k8s.io&#47;v1<br>kind: CustomResourceDefinition<br>metadata:<br>  name: networks.samplecrd.k8s.io<br>  annotations:<br>    &quot;api-approved.kubernetes.io&quot;: &quot;https:&#47;&#47;github.com&#47;kubernetes&#47;kubernetes&#47;pull&#47;78458&quot;<br>spec:<br>  group: samplecrd.k8s.io<br>  names:<br>    kind: Network<br>    plural: networks<br>    singular: network<br>    shortNames:<br>    - nw<br>  scope: Namespaced<br>  versions:<br>  - served: true<br>    storage: true<br>    name: v1<br>    schema:<br>      openAPIV3Schema:<br>        type: object<br>        properties:<br>          spec:<br>            type: object<br>            properties:<br>              cidr:<br>                type: string<br>              gateway:<br>                type: string<br><br>ä¹‹åæŒ‰ç…§æ–‡ç« ä¸­çš„æ“ä½œå³å¯","like_count":5,"discussions":[{"author":{"id":2291160,"avatar":"https://static001.geekbang.org/account/avatar/00/22/f5/d8/121e4b68.jpg","nickname":"Woa ğŸ¤","note":"","ucode":"6033F496082F3B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546361,"discussion_content":"çƒ­ä¹çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642305237,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1043785,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep1KzIk3KeeFFCDdHDr7vO41FzmY78m4YvbicmGhgiboIOWOt58yJDy5m6Nib1dL12Dicn3NnqynmZpnw/132","nickname":"sweetweapen","note":"","ucode":"B64A55429DEABF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538904,"discussion_content":"å¦ˆå‘€ï¼Œåˆšè°ƒè¯•é€šï¼Œå‡ åˆ†é’Ÿåå°±çœ‹è§äº†è·Ÿæˆ‘ä¸€æ¨¡ä¸€æ ·çš„ç¯å¢ƒå’Œyamlæ–‡ä»¶\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639554120,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":125174,"user_name":"Monokai","can_delete":false,"product_type":"c1","uid":1625051,"ip_address":"","ucode":"367B7F2EFB6BA5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLtwSXKialWYQgo1OXWYIsyj4zxK8AbQb1tp6iceZ5cGPYFcoczlubd7VicJPuvWqHrFXJXtUTP4kd9A/132","comment_is_top":false,"comment_ctime":1566111468,"is_pvip":false,"replies":[{"id":"46505","content":"éœ€è¦ï¼Œæ‰€æœ‰å¯¹etcdçš„æ“ä½œéƒ½è¦èµ°apiserver","user_name":"ä½œè€…å›å¤","comment_id":125174,"uid":"1218095","ip_address":"","utype":1,"ctime":1566350923,"user_name_real":"Geek_6ef93d"}],"discussion_count":1,"race_medal":0,"score":"18745980652","product_id":100015201,"comment_content":"å¤„ç†å®Œapiå¯¹è±¡çš„äº‹ä»¶åå°±ç›´æ¥å­˜å‚¨åœ¨etcdé‡Œäº†ä¹ˆï¼Ÿéœ€ä¸éœ€è¦å†å’Œapiserveræ‰“äº¤é“ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463463,"discussion_content":"éœ€è¦ï¼Œæ‰€æœ‰å¯¹etcdçš„æ“ä½œéƒ½è¦èµ°apiserver","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566350923,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":37907,"user_name":"LinYongRui","can_delete":false,"product_type":"c1","uid":1222977,"ip_address":"","ucode":"56FE9D9B277F0F","user_header":"https://static001.geekbang.org/account/avatar/00/12/a9/41/9170f607.jpg","comment_is_top":false,"comment_ctime":1541798629,"is_pvip":false,"replies":[{"id":"13661","content":"è¿™ä¸ªé€»è¾‘å¯ä»¥è‡ªå·±åœ¨handleré‡Œå¤„ç†ä¸€ä¸‹ï¼Œæˆ‘æ²¡coverè¿™ç§æƒ…å†µè€Œå·²","user_name":"ä½œè€…å›å¤","comment_id":37907,"uid":"1218095","ip_address":"","utype":1,"ctime":1541841712,"user_name_real":"Geek_6ef93d"}],"discussion_count":1,"race_medal":0,"score":"18721667813","product_id":100015201,"comment_content":"å¼ è€å¸ˆæ‚¨å¥½ï¼Œè¯·é—®å¦‚æœåœ¨è¿™ä¸ªæ¡†æ¶ä¸‹ï¼Œæœ‰äººæ‰‹åŠ¨åˆ é™¤äº†ä¸€ä¸ªå®é™…çš„neutron networkï¼Œä½†æ˜¯æœ¬åœ°ç¼“å­˜å’Œapiserverçš„çŠ¶æ€æ˜¯ä¸€è‡´çš„ï¼Œé‚£ä¹ˆåœ¨period syncçš„æ—¶å€™ï¼Œæ˜¯ä¸æ˜¯å°±ä¸ä¼šå»çœŸæ­£æ£€æŸ¥å®é™…çŠ¶æ€å’Œæœ¬åœ°ç¼“å­˜çš„å·®åˆ«äº†å‘¢ï¼Ÿå› ä¸ºæˆ‘çœ‹åˆ°eventhandlerçš„updateé‚£è¾¹ä¼šç›´æ¥returnäº†ï¼Ÿ è°¢è°¢","like_count":4,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428522,"discussion_content":"è¿™ä¸ªé€»è¾‘å¯ä»¥è‡ªå·±åœ¨handleré‡Œå¤„ç†ä¸€ä¸‹ï¼Œæˆ‘æ²¡coverè¿™ç§æƒ…å†µè€Œå·²","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541841712,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":190036,"user_name":"Geek_c22199","can_delete":false,"product_type":"c1","uid":1441876,"ip_address":"","ucode":"1CE5B65513E360","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI2vn8hyjICTCletGs0omz28lhriaZKX2XX9icYzAEon2IEoRnlXqyOia2bEPP0j7T6xexTnr77JJic8w/132","comment_is_top":false,"comment_ctime":1584596824,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14469498712","product_id":100015201,"comment_content":"è‡ªå®šä¹‰ï¼Ÿæ‰“æ‰°æ‰“æ‰°ï¼Œç­‰æˆ‘è¿‡åŠä¸ªæœˆå†æ¥","like_count":3},{"had_liked":false,"id":78442,"user_name":"å•æœ‹è£","can_delete":false,"product_type":"c1","uid":1272662,"ip_address":"","ucode":"8AD121BEDD9675","user_header":"https://static001.geekbang.org/account/avatar/00/13/6b/56/37a4cea7.jpg","comment_is_top":false,"comment_ctime":1553148598,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14438050486","product_id":100015201,"comment_content":"å¼ è€å¸ˆå¥½ï¼Œå¾ˆæ„Ÿè°¢æ‚¨çš„è¯¾ç¨‹åˆ†äº«ã€‚å¦å¤–ï¼Œæˆ‘æƒ³æ·±å…¥åšäº›è‡ªå®šä¹‰ç»„ä»¶çš„å¼€å‘ï¼Œæ‚¨ä¸€è·¯å·²ç»èµ°è¿‡æ¥äº†ï¼Œæƒ³å¬ä¸‹æ‚¨çš„å»ºè®®ï¼Œé¡ºä¾¿æ¨èä¹¦ï¼Œä¸‡åˆ†æ„Ÿè°¢ï¼","like_count":3,"discussions":[{"author":{"id":2543101,"avatar":"https://static001.geekbang.org/account/avatar/00/26/cd/fd/9122de17.jpg","nickname":"warning","note":"","ucode":"89B7933979F813","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388403,"discussion_content":"åŒæ±‚ï¼Œè¯·é—®æ‚¨ç°åœ¨æ‰¾åˆ°åˆé€‚çš„ç”¨ä¹¦äº†å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628752858,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43034,"user_name":"jssfy","can_delete":false,"product_type":"c1","uid":1137238,"ip_address":"","ucode":"F16353CFE607B7","user_header":"https://static001.geekbang.org/account/avatar/00/11/5a/56/115c6433.jpg","comment_is_top":false,"comment_ctime":1543145660,"is_pvip":false,"replies":[{"id":"15413","content":"æ— æ‰€è°“ï¼Œå“ªéƒ½è¡Œ","user_name":"ä½œè€…å›å¤","comment_id":43034,"uid":"1218095","ip_address":"","utype":1,"ctime":1543192167,"user_name_real":"Geek_6ef93d"}],"discussion_count":1,"race_medal":0,"score":"14428047548","product_id":100015201,"comment_content":"è¯·é—®è¿™ä¸ªæ§åˆ¶å™¨æ˜¯è·‘åœ¨nodeèŠ‚ç‚¹ä¸Šçš„ï¼Ÿä¸€èˆ¬å“ªäº›æ§åˆ¶å™¨æ˜¯è·‘åœ¨nodeä¸Šå“ªäº›æ˜¯è·‘åœ¨masterä¸Šå‘¢","like_count":3,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430281,"discussion_content":"æ— æ‰€è°“ï¼Œå“ªéƒ½è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543192167,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":34191,"user_name":"hugeo","can_delete":false,"product_type":"c1","uid":1042824,"ip_address":"","ucode":"438F289EDD21CD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e9/88/941e488a.jpg","comment_is_top":false,"comment_ctime":1540037896,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14424939784","product_id":100015201,"comment_content":"å‰å®³äº†ï¼ŒåŸæ¥è¿™æ‰æ˜¯k8sçš„ç²¾é«“","like_count":3},{"had_liked":false,"id":34015,"user_name":"runner","can_delete":false,"product_type":"c1","uid":1200107,"ip_address":"","ucode":"6037BEDDF7AA48","user_header":"https://static001.geekbang.org/account/avatar/00/12/4f/eb/b5bb4227.jpg","comment_is_top":false,"comment_ctime":1539948768,"is_pvip":false,"replies":[{"id":"12184","content":"ç»™å®ƒä»¬å†™yamlæè¿°èµ·æ¥å§ã€‚","user_name":"ä½œè€…å›å¤","comment_id":34015,"uid":"1218095","ip_address":"","utype":1,"ctime":1540026641,"user_name_real":"Geek_6ef93d"}],"discussion_count":1,"race_medal":0,"score":"14424850656","product_id":100015201,"comment_content":"å¼ è€å¸ˆï¼Œé—®ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å…¬å¸çš„dockerä¸šåŠ¡ï¼Œå®¹å™¨æ€»æ•°ä¸Šä¸‡ä¸ªï¼Œéƒ¨åˆ†å®¹å™¨ä¾èµ–å®¿ä¸»æœºé…ç½®æ–‡ä»¶ã€‚ç°åœ¨æˆ‘ä»¬æƒ³è¿k8s çš„è¯ï¼Œèƒ½ä¸æ”¹åŠ¨è¿™äº›å®¹å™¨ï¼ŒæŠŠä»–ä»¬åŠ å…¥podç®¡ç†èµ·æ¥ä¹ˆï¼Ÿå¦‚æœä¸Šä¸‡å®¹å™¨éƒ½é‡æ–°è°ƒåº¦ç”Ÿæˆçš„è¯ï¼Œè¿™ä¸ªæ”¹åŠ¨å¤ªå¤§äº†ã€‚","like_count":3,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427104,"discussion_content":"ç»™å®ƒä»¬å†™yamlæè¿°èµ·æ¥å§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540026641,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":307458,"user_name":"å…«å°ä¸Š","can_delete":false,"product_type":"c1","uid":1391143,"ip_address":"","ucode":"FB3D74B522C720","user_header":"https://static001.geekbang.org/account/avatar/00/15/3a/27/5d218272.jpg","comment_is_top":false,"comment_ctime":1629109784,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"10219044376","product_id":100015201,"comment_content":"æƒ³é—®ä¸€ä¸‹ å·¥ä½œé˜Ÿåˆ—æˆ–è€…deltaé˜Ÿåˆ—  ä¼šæŒä¹…åŒ–å—ï¼Œ ä¸ç„¶controllerå¼‚å¸¸é‡å¯çš„è¯ï¼Œé˜Ÿåˆ—ä¿¡æ¯ä¸æ˜¯ä¸¢äº†å—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":2058258,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/68/12/031a05c3.jpg","nickname":"Aå…å¸…å«å“¥","note":"","ucode":"76D2522E602AEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551093,"discussion_content":"controlleré‡å¯ï¼Œç¬¬ä¸€æ­¥åšçš„å°±æ˜¯listæ“ä½œï¼ŒæŠŠå¯¹è±¡ä»api-serverå“ªé‡Œä»æ–°è·å–ä¸€ä¸‹ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1644895910,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2589474,"avatar":"https://static001.geekbang.org/account/avatar/00/27/83/22/a44b65f5.jpg","nickname":"JamonJou","note":"","ucode":"C77E647E2FA7A7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545266,"discussion_content":"æˆ‘è§‰å¾—åº”è¯¥æ˜¯è‡ªå·±å®ç°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641890483,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":222002,"user_name":"waterjiao","can_delete":false,"product_type":"c1","uid":1283989,"ip_address":"","ucode":"74F2F75BF0CA6F","user_header":"https://static001.geekbang.org/account/avatar/00/13/97/95/aad51e9b.jpg","comment_is_top":false,"comment_ctime":1590654287,"is_pvip":true,"discussion_count":2,"race_medal":1,"score":"10180588879","product_id":100015201,"comment_content":"ç£Šå“¥ï¼Œå¦‚æœæ§åˆ¶å™¨ä¸€æ®µæ—¶é—´ä¸å¯ç”¨ï¼Œåˆ é™¤çš„äº‹ä»¶åˆ°äº†ï¼Œè¿™ä¸ªèµ„æºåœ¨etcdä¸­è¢«åˆ æ‰äº†ï¼Œæ§åˆ¶å™¨é‡å¯åï¼ŒæœŸæœ›çŠ¶æ€å’Œå®é™…çŠ¶æ€å¯¹ä¸é½äº†ï¼Œè¿™ä¸ªæ—¶å€™æ˜¯ä¸æ˜¯è¿˜è¦ç”¨ç¼“å­˜çš„æ•°æ®å’Œå®é™…æ•°æ®åšå¯¹æ¯”ï¼Ÿå¦‚æœæ•°æ®è¾ƒå¤šæ—¶ï¼Œåˆè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1283989,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/95/aad51e9b.jpg","nickname":"waterjiao","note":"","ucode":"74F2F75BF0CA6F","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":278122,"discussion_content":"æŸ¥äº†ä¸‹å¯ä»¥ç”¨Finalizerå¯ä»¥è§£å†³æ­¤é—®é¢˜ï¼Œè¿˜æœ‰ä¸¤ä¸ªé—®é¢˜æƒ³é—®ä¸‹\n1ï¼‰çŠ¶æ€è¿™ä¸ªå­—æ®µæ€ä¹ˆè¿”å›åˆ°api-serverä¸­å‘¢ï¼Ÿ\n2ï¼‰å¦‚æœä¸€ä¸ªæ§åˆ¶å™¨è¦ç®¡ç†å¤šç§èµ„æºçš„è¯ï¼Œéœ€è¦æŠŠå„ä¸ªèµ„æºç”Ÿæˆçš„informeræ•´åˆèµ·æ¥å—ï¼Ÿè¿˜æ˜¯æ¯ä¸€ç§èµ„æºéƒ½å•ç‹¬ä½¿ç”¨ä¸€ä¸ªæ§åˆ¶å™¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591152917,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1207457,"avatar":"https://static001.geekbang.org/account/avatar/00/12/6c/a1/80d83f0a.jpg","nickname":"Ellison","note":"","ucode":"A2FB94D4F6A332","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1283989,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/95/aad51e9b.jpg","nickname":"waterjiao","note":"","ucode":"74F2F75BF0CA6F","race_medal":1,"user_type":1,"is_pvip":true},"discussion":{"id":335164,"discussion_content":"å¤šåˆ›å»ºå‡ ä¸ªinfomerå°±å¥½äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608109181,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":278122,"ip_address":""},"score":335164,"extra":""}]}]},{"had_liked":false,"id":96346,"user_name":"sonald","can_delete":false,"product_type":"c1","uid":1028090,"ip_address":"","ucode":"BBE5F144978952","user_header":"https://static001.geekbang.org/account/avatar/00/0f/af/fa/5714677b.jpg","comment_is_top":false,"comment_ctime":1558401718,"is_pvip":true,"replies":[{"id":"36297","content":"é‚£ä¸ªå°±å˜æˆaggregator api severäº†ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1559619112,"ip_address":"","comment_id":96346,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10148336310","product_id":100015201,"comment_content":"çœ‹èµ·æ¥è‡ªå®šä¹‰çš„æ§åˆ¶å™¨æ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œè€Œä¸èƒ½åƒä¸€ä¸ªAPIå¯¹è±¡ä¸€æ ·æ³¨å†Œåˆ°masterï¼Œå¹¶ä¸”éƒ¨ç½²åˆ°masterä¸Šä¹‹ç±»çš„ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450840,"discussion_content":"é‚£ä¸ªå°±å˜æˆaggregator api severäº†ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559619112,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61417,"user_name":"xfan","can_delete":false,"product_type":"c1","uid":1315147,"ip_address":"","ucode":"48ED8D498D7F56","user_header":"https://static001.geekbang.org/account/avatar/00/14/11/4b/fa64f061.jpg","comment_is_top":false,"comment_ctime":1547694270,"is_pvip":false,"replies":[{"id":"22067","content":"ä¸€ä¸ªä¸œè¥¿","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1548053800,"ip_address":"","comment_id":61417,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10137628862","product_id":100015201,"comment_content":"æˆ‘åœ¨è¯»å®Œåï¼Œå’Œå­¦ä¹ çš„æœŸé—´ï¼Œå‘ç°ä¸ä»…ä»…CRDæœ‰Informer,workqueueæ„æˆçš„è‡ªå®šä¹‰æ§åˆ¶å™¨ï¼Œè€Œä¸”client-goä¸­ä¹Ÿæœ‰ä¸ªç±»ä¼¼çš„ï¼Œè¿™ä¸¤è€…ä¹‹é—´æœ‰ä»€ä¹ˆè”ç³»å—ï¼Œè¿˜æ˜¯å°±æ˜¯ä¸€ä¸ªä¸œè¥¿","like_count":2,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436868,"discussion_content":"ä¸€ä¸ªä¸œè¥¿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548053800,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57405,"user_name":"xfan","can_delete":false,"product_type":"c1","uid":1315147,"ip_address":"","ucode":"48ED8D498D7F56","user_header":"https://static001.geekbang.org/account/avatar/00/14/11/4b/fa64f061.jpg","comment_is_top":false,"comment_ctime":1546782496,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10136717088","product_id":100015201,"comment_content":"E0107 05:44:18.230692   35973 reflector.go:134] github.com&#47;resouer&#47;k8s-controller-custom-resource&#47;pkg&#47;client&#47;informers&#47;externalversions&#47;factory.go:117: Failed to list *v1.Network: networks.samplecrd.k8s.io is forbidden: User &quot;system:node:node01&quot; cannot list resource &quot;networks&quot; in API group &quot;samplecrd.k8s.io&quot; at the cluster scope<br>æˆ‘åœ¨node1ä¸Šé¢è¿è¡Œæ‰“åŒ…åçš„ç¨‹åºæŠ¥è¿™ä¸ªé”™ï¼Œä½¿ç”¨çš„kubeconfig ä¸æ˜¯ ~&#47;.kube&#47;config è€Œæ˜¯è¯·é—®&#47;etc&#47;kubernetes&#47;kubelet.conf ï¼Œå› ä¸ºæˆ‘æ²¡æœ‰é‚£ä¸ªconfigæ–‡ä»¶ï¼Œè¯·é—®æŠ¥è¿™ä¸ªé”™è¯¯çš„åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ<br>","like_count":2},{"had_liked":false,"id":34283,"user_name":"silver","can_delete":false,"product_type":"c1","uid":1186740,"ip_address":"","ucode":"908E3C8560D6E1","user_header":"https://static001.geekbang.org/account/avatar/00/12/1b/b4/a6db1c1e.jpg","comment_is_top":false,"comment_ctime":1540086410,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10130021002","product_id":100015201,"comment_content":"æ€è€ƒé¢˜ï¼šä¸€ä¸ªFIFOå¯èƒ½ä¼šsupportå¤šä¸ªcontrollerï¼Œæ‰€ä»¥controllerå±‚é¢çš„ä¸šåŠ¡é€»è¾‘retryä¸èƒ½æ”¾åœ¨FIFOè€Œæ˜¯å¾—æœ‰ç‹¬ç«‹çš„retry queueã€‚åŒæ—¶work queueå¯ä»¥ç”¨æ¥å®ç°backoff on errorç­‰ä¸šåŠ¡é€»è¾‘ï¼Œè€Œè¿™äº›é€»è¾‘ä¸é€‚åˆæ”¾åœ¨FIFOä¸­","like_count":2},{"had_liked":false,"id":329227,"user_name":"cosz3","can_delete":false,"product_type":"c1","uid":1218665,"ip_address":"","ucode":"B9023D4A088CF2","user_header":"https://static001.geekbang.org/account/avatar/00/12/98/69/5a1c6620.jpg","comment_is_top":false,"comment_ctime":1641222959,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5936190255","product_id":100015201,"comment_content":"æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š<br>1. APIServer è§¦å‘ event çš„æ—¶å€™ï¼Œæ˜¯æ€ä¹ˆçŸ¥é“ç»™å“ªä¸ª informer å‘é€ event å‘¢ï¼Ÿé€šè¿‡æ–‡ç« æ²¡æœ‰çœ‹å‡º APIServer åŠ è½½ informerï¼Œä¹Ÿæ²¡çœ‹å‡ºæŸä¸ª informer ä¸»åŠ¨å» APIServer ä¸Šæ³¨å†Œè‡ªå·±ã€‚<br><br>2. informer ListandWatch æœ€å¤šå¯ä»¥ä¸€æ¬¡æ€§ ListAndWatch å¤šå°‘ä¸ª pod å‘¢ï¼Ÿ ","like_count":1},{"had_liked":false,"id":287617,"user_name":"Podman","can_delete":false,"product_type":"c1","uid":1801003,"ip_address":"","ucode":"1C9C7EA8C28ED7","user_header":"https://static001.geekbang.org/account/avatar/00/1b/7b/2b/97e4d599.jpg","comment_is_top":false,"comment_ctime":1618050913,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5913018209","product_id":100015201,"comment_content":"æœ‰ä¸ªå°ç™½é—®é¢˜è¯·æ•™ä¸‹~<br>æ‰€ä»¥ä¸Šä¸€ç¯‡æ–‡ç« ä»£ç éƒ¨åˆ†æœ€åç”Ÿæˆçš„pkg&#47;client&#47;{informers, listers, clientset}å®¢æˆ·ç«¯ä»£ç <br>è¿™ä¸ªâ€œå®¢æˆ·ç«¯â€æŒ‡çš„å°±æ˜¯æœ¬ç¯‡çš„è‡ªå®šä¹‰controller<br>è€Œä¸”è¿™äº›informers, listers, clientsetä»£ç å°±æ˜¯ç”¨äºå®ç°informerã€list&#47;watchæœºåˆ¶ç­‰é€»è¾‘çš„<br><br>ä¸çŸ¥é“æˆ‘è¿™æ ·ç†è§£å¯¹ä¹ˆ","like_count":1},{"had_liked":false,"id":139341,"user_name":"LQ","can_delete":false,"product_type":"c1","uid":1005635,"ip_address":"","ucode":"0E33CBE474F877","user_header":"https://static001.geekbang.org/account/avatar/00/0f/58/43/15be800e.jpg","comment_is_top":false,"comment_ctime":1570615757,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5865583053","product_id":100015201,"comment_content":"æ—¥å¿—è·‘åˆ° Waiting for informer caches to sync å°± hang ä½äº†ï¼Œç´§è·Ÿç€çš„ Starting workers ä¸€ç›´æ²¡å¼€å§‹è·‘ï¼Œè¿™ä¸ªæ˜¯ä»€ä¹ˆåŸå› ï¼Ÿ","like_count":1},{"had_liked":false,"id":138463,"user_name":"tuyu","can_delete":false,"product_type":"c1","uid":1448863,"ip_address":"","ucode":"B235325B541408","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/BIRpwViaN51yynIeFonD7QRlwDCVtKibrG956NTxzEqibOZZVjhMMgibOPmd3VicfYxpknZsic1oJq8KicZvXkmmiajuQg/132","comment_is_top":false,"comment_ctime":1570260504,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5865227800","product_id":100015201,"comment_content":"godep restoreè·å–ä¾èµ–è·å–ä¸åˆ°k8s.ioçš„ç›¸å…³åŒ…æœ‰ä¼™ä¼´è§£å†³äº†å—","like_count":1,"discussions":[{"author":{"id":1269156,"avatar":"https://static001.geekbang.org/account/avatar/00/13/5d/a4/2e4b6d33.jpg","nickname":"ç´ è¿˜çœŸ","note":"","ucode":"9ABA456355F7E3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344094,"discussion_content":"æ”¹ç”¨go modå§","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1611288138,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":90726,"user_name":"solaris.lin","can_delete":false,"product_type":"c1","uid":1516139,"ip_address":"","ucode":"A72313100825F3","user_header":"https://static001.geekbang.org/account/avatar/00/17/22/6b/7779a4c5.jpg","comment_is_top":false,"comment_ctime":1556617549,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5851584845","product_id":100015201,"comment_content":"è¯·é—®ï¼Œè‡ªå®šä¹‰æ§åˆ¶å™¨éƒ¨ç½²æ–¹æ¡ˆåœ¨ç”Ÿäº§åœºæ™¯ä¸­æ˜¯æ€ä¹ˆæ ·çš„å‘¢<br>1 è€¦åˆåœ¨controller-managerä¸­ï¼Œé€šè¿‡manageræ¥ç»Ÿä¸€éƒ¨ç½²å’Œé«˜å¯ç”¨ï¼Œä½†åŸç”Ÿå’Œè‡ªå®šä¹‰æ§åˆ¶å™¨ä»£ç è€¦åˆã€‚<br>2 ç‹¬ç«‹éƒ¨ç½²ï¼Œä»£ç è§£è€¦äº†ï¼Œä½†æ˜¯åæœŸç»´æŠ¤æˆæœ¬å˜é«˜äº†ã€‚","like_count":1},{"had_liked":false,"id":73636,"user_name":"arlose","can_delete":false,"product_type":"c1","uid":1154358,"ip_address":"","ucode":"C58C16EC025AE6","user_header":"https://static001.geekbang.org/account/avatar/00/11/9d/36/2f36e1a8.jpg","comment_is_top":false,"comment_ctime":1551946175,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5846913471","product_id":100015201,"comment_content":"è¯·é—®å¼ è€å¸ˆmainå‡½æ•°é‡Œé¢çš„networkInformerFactory := informers.NewSharedInformerFactory(networkClient, time.Second*30)ä¸­second*30æ„æ€æ˜¯æ¯ä¸ª30ç§’ç›‘å¬ä¸€æ¬¡ä¹ˆï¼Ÿè¯·é—®æœ‰æ²¡æœ‰è¯¦ç»†çš„æ–‡æ¡£æˆ–è€…ä»€ä¹ˆç½‘å€è§£é‡Šè¿™äº›apiå‡½æ•°çš„åŠŸèƒ½å‚æ•°çš„å‘¢ï¼Ÿ","like_count":1},{"had_liked":false,"id":63117,"user_name":"Jacking","can_delete":false,"product_type":"c1","uid":1324134,"ip_address":"","ucode":"B5341C55EB84CB","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/66/cdcc7f97.jpg","comment_is_top":false,"comment_ctime":1548262083,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5843229379","product_id":100015201,"comment_content":"ä¹‹å‰åšè¿‡ä¸€ä¸ªk8sèµ„æºçŠ¶æ€ç›‘æ§çš„ç¨‹åºï¼Œå°±ç”¨åˆ°äº† informerï¼Œæ‰€ä»¥è¿™ç« å†…å®¹çœ‹èµ·æ¥è¿˜å¥½ã€‚æ²¡æ¥è§¦è¿‡informerå¯èƒ½è¦å¤šåŠ¨æ‰‹å†™å†™ä»£ç ï¼Œå¤šçœ‹å‡ éæ‰å¥½ç†è§£","like_count":1},{"had_liked":false,"id":38301,"user_name":"å¯’é’","can_delete":false,"product_type":"c1","uid":1271316,"ip_address":"","ucode":"568B08BFA91E91","user_header":"https://static001.geekbang.org/account/avatar/00/13/66/14/060890da.jpg","comment_is_top":false,"comment_ctime":1542018473,"is_pvip":false,"replies":[{"id":"13792","content":"ä¼šæä¸€ä¸‹ã€‚è¿™ä¸ªæ¯”è¾ƒå¤æ‚ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1542070670,"ip_address":"","comment_id":38301,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5836985769","product_id":100015201,"comment_content":"é€šè¿‡aggregation layeræ‰©å±•k8s api çš„æ–¹å¼ä¼šè®²å—ï¼Ÿè°¢è°¢","like_count":1,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428669,"discussion_content":"ä¼šæä¸€ä¸‹ã€‚è¿™ä¸ªæ¯”è¾ƒå¤æ‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542070670,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":34091,"user_name":"Vincen","can_delete":false,"product_type":"c1","uid":1218185,"ip_address":"","ucode":"1029A901EC7BA0","user_header":"https://static001.geekbang.org/account/avatar/00/12/96/89/9312b3a2.jpg","comment_is_top":false,"comment_ctime":1539999217,"is_pvip":false,"replies":[{"id":"12181","content":"ä¸éœ€è¦ã€‚è¿™ä¸ªdemoæœ€ååªä¼šæ‰“å‡ºlogæ¥ï¼Œä¸ä¼šçœŸçš„å»call neutron","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1540026334,"ip_address":"","comment_id":34091,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5834966513","product_id":100015201,"comment_content":"æŒ‰ç…§æ–‡ç« ä¸­çš„æ­¥éª¤ï¼Œè¿˜éœ€è¦å®‰è£…neutronç½‘ç»œå—","like_count":1,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427114,"discussion_content":"ä¸éœ€è¦ã€‚è¿™ä¸ªdemoæœ€ååªä¼šæ‰“å‡ºlogæ¥ï¼Œä¸ä¼šçœŸçš„å»call neutron","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540026334,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":359076,"user_name":"é™ˆéº’æ–‡","can_delete":false,"product_type":"c1","uid":2187256,"ip_address":"ç¦å»º","ucode":"41475885FA5AD5","user_header":"https://static001.geekbang.org/account/avatar/00/21/5f/f8/1d16434b.jpg","comment_is_top":false,"comment_ctime":1665221721,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1665221721","product_id":100015201,"comment_content":"çœ‹åˆ°è¿™é‡Œè¿˜æ˜¯å¾ˆè’™åœˆï¼Œæˆ‘è¿˜æœ‰æ•‘ä¹ˆğŸ˜‚","like_count":0},{"had_liked":false,"id":355399,"user_name":"Geek_3635b2","can_delete":false,"product_type":"c1","uid":2850687,"ip_address":"æ²³å—","ucode":"46674380343EEF","user_header":"","comment_is_top":false,"comment_ctime":1661333436,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1661333436","product_id":100015201,"comment_content":"å­¦å®Œgoå†æ¥çœ‹è¿™ä¸¤ç¯‡","like_count":0},{"had_liked":false,"id":354288,"user_name":"Geek_1cc6d1","can_delete":false,"product_type":"c1","uid":1850248,"ip_address":"åŒ—äº¬","ucode":"3E083616DD0742","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erZCyXaP2gbxwFHxvtnyaaF2Pyy5KkSMsk9kh7SJl8icp1CD6wicb6VJibiblGibbpDo6IuHrdST6AnWQg/132","comment_is_top":false,"comment_ctime":1660265155,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1660265155","product_id":100015201,"comment_content":"æœ‰ç‚¹è·Ÿä¸ä¸Šäº†","like_count":0},{"had_liked":false,"id":353332,"user_name":"Sanping","can_delete":false,"product_type":"c1","uid":2160620,"ip_address":"åŒ—äº¬","ucode":"3E82B6F0F54639","user_header":"https://static001.geekbang.org/account/avatar/00/20/f7/ec/b0e9ecd2.jpg","comment_is_top":false,"comment_ctime":1659361103,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1659361103","product_id":100015201,"comment_content":"ä¸€è„¸æ‡µé€¼åŠ ä¸€","like_count":0},{"had_liked":false,"id":349046,"user_name":"Geek_db7579","can_delete":false,"product_type":"c1","uid":3017841,"ip_address":"","ucode":"6C95FF72F1B73F","user_header":"","comment_is_top":false,"comment_ctime":1655690796,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1655690796","product_id":100015201,"comment_content":"å¦‚æœå¯¹è±¡æ›´æ–°ï¼ˆupdateï¼‰äº†ï¼Œç¼“å­˜é‡Œæ˜¯æœ‰ä¸¤ä¸ªresource versionçš„crdå¯¹è±¡å—ï¼Œè€Œä¸”å¼ºåˆ¶æ›´æ–°ç¼“å­˜çš„æ—¶å€™ï¼Œaddã€deleteã€updateçš„äº‹ä»¶ä¸ä¼šä¸¢å¤±å—","like_count":0},{"had_liked":false,"id":346277,"user_name":"ä¾§è€³å€¾å¬","can_delete":false,"product_type":"c1","uid":1512642,"ip_address":"","ucode":"5BF2A2440B54F0","user_header":"https://static001.geekbang.org/account/avatar/00/17/14/c2/46ebe3a0.jpg","comment_is_top":false,"comment_ctime":1652971198,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1652971198","product_id":100015201,"comment_content":"é¢å‘k8sç¼–ç¨‹ã€‚ã€‚ã€‚","like_count":0},{"had_liked":false,"id":341151,"user_name":"æ±Ÿä¸œ","can_delete":false,"product_type":"c1","uid":1793475,"ip_address":"","ucode":"391A62BC7039B3","user_header":"https://static001.geekbang.org/account/avatar/00/1b/5d/c3/69019d24.jpg","comment_is_top":false,"comment_ctime":1649390808,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1649390808","product_id":100015201,"comment_content":"k8sæ˜¯å¦‚ä½•é¿å…æ§åˆ¶å™¨æ­»å¾ªç¯è¿è¡Œä¸­cpu100%","like_count":0},{"had_liked":false,"id":335280,"user_name":"è±†è±†","can_delete":false,"product_type":"c1","uid":1275407,"ip_address":"","ucode":"97788B134C3212","user_header":"https://static001.geekbang.org/account/avatar/00/13/76/0f/c7c8021d.jpg","comment_is_top":false,"comment_ctime":1645438535,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1645438535","product_id":100015201,"comment_content":"ä¹‹å‰æ­»ç£•è¿™ä¸€å—ï¼Œå•ƒä¸ä¸‹å»ã€‚è·³æ§½åï¼ŒåŒäº‹è·Ÿæˆ‘è¯´ï¼Œç›´æ¥ä¸Škubebuilderï¼Œæˆ‘ä¸æƒ³ï¼Œæˆ‘å°±æƒ³ææ‡‚ï¼Œå›è¿‡å¤´æ¥ï¼Œä¸€è¡Œä¸€è¡Œçš„çœ‹è¿™å‡ èŠ‚å…³äºoperatorçš„å¼€å‘ç« èŠ‚ï¼Œå°±æƒ³ææ¸…æ¥šå†…éƒ¨åŸç†ï¼Œç»ˆäºçœ‹æ‡‚äº†ï¼Œç»ˆäºææ˜ç™½äº†ã€‚","like_count":0},{"had_liked":false,"id":334725,"user_name":"Run","can_delete":false,"product_type":"c1","uid":1371941,"ip_address":"","ucode":"6738D2F36ACFF6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLMDBq7lqg9ZasC4f21R0axKJRVCBImPKlQF8yOicLLXIsNgsZxsVyN1mbvFOL6eVPluTNgJofwZeA/132","comment_is_top":false,"comment_ctime":1645091405,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1645091405","product_id":100015201,"comment_content":"é†é†çŒé¡¶","like_count":0},{"had_liked":false,"id":324984,"user_name":"è¿½é£ç­çš„äºº","can_delete":false,"product_type":"c1","uid":1488020,"ip_address":"","ucode":"2993D60F94C396","user_header":"https://static001.geekbang.org/account/avatar/00/16/b4/94/2796de72.jpg","comment_is_top":false,"comment_ctime":1638771121,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638771121","product_id":100015201,"comment_content":"è¶Šæ¥è¶Šè´¹åŠ²äº†  å¤´ç–¼","like_count":0},{"had_liked":false,"id":287977,"user_name":"Ether","can_delete":false,"product_type":"c1","uid":1680140,"ip_address":"","ucode":"A2E94A92242015","user_header":"https://static001.geekbang.org/account/avatar/00/19/a3/0c/962ab5d7.jpg","comment_is_top":false,"comment_ctime":1618237753,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618237753","product_id":100015201,"comment_content":"syncHandler å‡½æ•°çš„keyæ˜¯ä¼ çš„ä»€ä¹ˆï¼Ÿæœ‰å¤§ä½¬èƒ½è·‘è€å¸ˆä»£ç è·‘èµ·æ¥å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":277286,"user_name":"ç±³å”","can_delete":false,"product_type":"c1","uid":2058106,"ip_address":"","ucode":"B56506718181CE","user_header":"https://static001.geekbang.org/account/avatar/00/1f/67/7a/94f6c178.jpg","comment_is_top":false,"comment_ctime":1612345050,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612345050","product_id":100015201,"comment_content":"å“ªä½å¤§ä½¬å¯ä»¥è®²è§£ä¸€ä¸‹ï¼Œè¿™ä¸ªNetworkå¯¹è±¡å»ºç«‹çš„æ•´ä¸ªè¿‡ç¨‹","like_count":0},{"had_liked":false,"id":268235,"user_name":"Ellison","can_delete":false,"product_type":"c1","uid":1207457,"ip_address":"","ucode":"A2FB94D4F6A332","user_header":"https://static001.geekbang.org/account/avatar/00/12/6c/a1/80d83f0a.jpg","comment_is_top":false,"comment_ctime":1608108718,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608108718","product_id":100015201,"comment_content":"æˆ‘ç†è§£éœ€è¦é˜Ÿåˆ—åº”è¯¥æ˜¯ï¼Œ æ¯”å¦‚æ§åˆ¶å™¨å¤„ç†ä¸è¿‡æ¥æ•°æ®æ—¶ï¼Œ è¿™æ—¶å€™æŸä¸ªå¯¹è±¡åœ¨æŒç»­æ›´æ–°ï¼Œ è¿™æ—¶å€™resource versionå°±ä¼šé¢‘ç¹æ”¹å˜ï¼Œ è¿™æ—¶å€™informeå°±ä¼šæŠŠæœ¬åœ°é¢‘ç¹æ”¹å˜çš„ç‰ˆæœ¬æ”¹æˆä¸€ä¸ªæœ€æ–°çš„ã€‚","like_count":0},{"had_liked":false,"id":248641,"user_name":"Heaven","can_delete":false,"product_type":"c1","uid":1694207,"ip_address":"","ucode":"FA33FBCC66C911","user_header":"https://static001.geekbang.org/account/avatar/00/19/d9/ff/b23018a6.jpg","comment_is_top":false,"comment_ctime":1600249951,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1600249951","product_id":100015201,"comment_content":"ç»å…¸çš„æ¶ˆè´¹è€…ç”Ÿäº§è€…æ¨¡å‹,ä¸»è¦æ˜¯ä¸ºäº†åè°ƒä¸¤è€…çš„é€Ÿåº¦ä¸ä¸€è‡´æ¥ä½¿ç”¨,åˆ©ç”¨ä¸€ä¸ªé˜Ÿåˆ—è¿›è¡Œå­˜å‚¨,é¿å…æ¶ˆè´¹è€…çš„æ¶ˆè´¹é€Ÿåº¦è¿‡æ…¢<br>è¿™ä¸€ç« çš„æ€è·¯æˆ‘è¯»æ‡‚äº†,ä½†æ˜¯ç”±äºæ²¡ä»äº‹è¿‡GOè¯­è¨€çš„å­¦ä¹ è¿‡,æ‰€ä»¥ä»£ç å¹¶ä¸æ˜¯å¾ˆäº†è§£,çœ‹æ¥æœ‰å¿…è¦å­¦ä¹ ä¸‹Goè¯­è¨€çš„ç¼–å†™","like_count":0},{"had_liked":false,"id":228370,"user_name":"Mr.Brooks","can_delete":false,"product_type":"c1","uid":1118650,"ip_address":"","ucode":"D47A6B0236A79F","user_header":"https://static001.geekbang.org/account/avatar/00/11/11/ba/2175bc50.jpg","comment_is_top":false,"comment_ctime":1592649805,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1592649805","product_id":100015201,"comment_content":"informer å’Œ æ§åˆ¶å¾ªç¯ï¼Œä¹Ÿç®—ä¸€ç§reactoræ¨¡å¼å§","like_count":0,"discussions":[{"author":{"id":2415037,"avatar":"https://static001.geekbang.org/account/avatar/00/24/d9/bd/d65fa667.jpg","nickname":"å®‡æ™ºæ³¢é¼¬","note":"","ucode":"893886790C7D86","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":570351,"discussion_content":"å¯èƒ½ä¸æ˜¯ä¸€ä¸ªå±‚é¢çš„ä¸œè¥¿å§ï¼Œkubernetes æ•´ä½“å¯¹å¤–è¡¨ç°æ˜¯ å£°æ˜å¼ APIï¼Œä½†æ˜¯å†…éƒ¨ç¼–æ’æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œå¯èƒ½ä¼šç”¨åˆ°äº‹ä»¶é©±åŠ¨ã€‚ä¸ªäººç†è§£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651740703,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":135544,"user_name":"å¤","can_delete":false,"product_type":"c1","uid":1010922,"ip_address":"","ucode":"74E6838226A405","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6c/ea/ce9854a5.jpg","comment_is_top":false,"comment_ctime":1569207882,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1569207882","product_id":100015201,"comment_content":"å¼ è€å¸ˆï¼Œæ‚¨å¥½ï¼Œè¯·é—®å¯ä»¥è¡¥å……ä¸€ä¸‹code-generatorçš„ä½¿ç”¨å—ï¼Ÿ æˆ‘è‡ªå·±æ ¹æ®æœåˆ°çš„ä¸€äº›èµ„æ–™https:&#47;&#47;itnext.io&#47;how-to-generate-client-codes-for-kubernetes-custom-resource-definitions-crd-b4b9907769baï¼Œ ç›®å‰è¿˜æ˜¯æ— æ³•å¾—åˆ°ç”Ÿæˆçš„listers informerç­‰å®¢æˆ·ç«¯ä»£ç ã€‚","like_count":0,"discussions":[{"author":{"id":1283989,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/95/aad51e9b.jpg","nickname":"waterjiao","note":"","ucode":"74F2F75BF0CA6F","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":274329,"discussion_content":"å¯ä»¥è´´ä¸‹æŠ¥é”™çš„ä¿¡æ¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590568907,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":36682,"user_name":"hhhhhh","can_delete":false,"product_type":"c1","uid":1017443,"ip_address":"","ucode":"0826CE1D2C9F1A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/86/63/0112cc96.jpg","comment_is_top":false,"comment_ctime":1541233615,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1541233615","product_id":100015201,"comment_content":"æ€è€ƒé¢˜ï¼š <br>ä¸ºäº†åœ¨ä¸é˜»å¡informerçš„åŒæ—¶æ§åˆ¶å¹¶å‘æ•°é‡ã€‚  <br><br>å¦‚æœç›´æ¥åœ¨handleré‡Œæ‰§è¡Œå…·ä½“ä¸šåŠ¡é€»è¾‘ï¼Œå¯èƒ½ä¼šå¾ˆæ…¢ï¼Œå‡ºé”™é‡è¯•ä¹Ÿä¸å¥½å¤„ç†ï¼›è€Œå¦‚æœåœ¨handleré‡Œå¼€ä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥å¤„ç†ï¼Œè™½ç„¶æ˜¯ä¸é˜»å¡äº†ï¼Œä½†å´ä¸å¥½æ§åˆ¶å¹¶å‘æ•°é‡ã€‚","like_count":0},{"had_liked":false,"id":34940,"user_name":"Pixar","can_delete":false,"product_type":"c1","uid":1197659,"ip_address":"","ucode":"E653387BA8EA16","user_header":"https://static001.geekbang.org/account/avatar/00/12/46/5b/07858c33.jpg","comment_is_top":false,"comment_ctime":1540363159,"is_pvip":false,"replies":[{"id":"12536","content":"å°±æ˜¯è¾“å‡ºeventså•Šï¼Œè·Ÿæ‰“æ—¥å¿—ä¸€æ ·ã€‚æ€ä¹ˆä¼šæ¥å—eventsâ€¦â€¦","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1540439949,"ip_address":"","comment_id":34940,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1540363159","product_id":100015201,"comment_content":"å¼ è€å¸ˆ, ä¾‹å­ä¸­å…³äºeventæœ‰ä¸€ä¸ªç–‘é—®<br>`utilruntime.Must(networkscheme.AddToScheme(scheme.Scheme))<br>glog.V(4).Info(&quot;Creating event broadcaster&quot;)<br>eventBroadcaster := record.NewBroadcaster()<br>eventBroadcaster.StartLogging(glog.Infof)<br>eventBroadcaster.StartRecordingToSink(&amp;typedcorev1.EventSinkImpl{Interface: kubeclientset.CoreV1().Events(&quot;&quot;)})<br>recorder := eventBroadcaster.NewRecorder(scheme.Scheme, corev1.EventSource{Component: controllerAgentName})<br><br>è¿™æ®µä»£ç çš„ç›®çš„æ˜¯ä»€ä¹ˆå¯ä»¥è¯¦ç»†åœ¨è¯¦ç»†è§£é‡Šä¸‹å—? ä»æ³¨é‡Šèƒ½çœ‹å‡ºæ˜¯ä¸ºäº† custom controllerå¯ä»¥æ­£å¸¸æ¥æ”¶event, ä½†å…¶ä¸­çš„åŸå› å¯ä»¥è¯´ä¸‹å—?","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427393,"discussion_content":"å°±æ˜¯è¾“å‡ºeventså•Šï¼Œè·Ÿæ‰“æ—¥å¿—ä¸€æ ·ã€‚æ€ä¹ˆä¼šæ¥å—eventsâ€¦â€¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540439949,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":33936,"user_name":"fiisio","can_delete":false,"product_type":"c1","uid":1148088,"ip_address":"","ucode":"87CB8F5EAA033B","user_header":"https://static001.geekbang.org/account/avatar/00/11/84/b8/0b73ecdc.jpg","comment_is_top":false,"comment_ctime":1539921235,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1539921235","product_id":100015201,"comment_content":"å¤§æ¦‚æ˜¯å› ä¸ºæ·±å…¥è´¯å½»çš„å£°æ˜å¼ï¼Œå¼‚æ­¥åŒæ—¶é˜²ä¸¢å¤±æ•°æ®","like_count":0}]}