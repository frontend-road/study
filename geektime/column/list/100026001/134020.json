{"id":134020,"title":"55 | ç†è§£Disruptorï¼ˆä¸‹ï¼‰ï¼šä¸éœ€è¦æ¢æŒ¡å’Œè¸©åˆ¹è½¦çš„CPUï¼Œæœ‰å¤šå¿«ï¼Ÿ","content":"<p>ä¸Šä¸€è®²ï¼Œæˆ‘ä»¬å­¦ä¹ äº†ä¸€ä¸ªç²¾å¦™çš„æƒ³æ³•ï¼ŒDisruptoré€šè¿‡ç¼“å­˜è¡Œå¡«å……ï¼Œæ¥åˆ©ç”¨å¥½CPUçš„é«˜é€Ÿç¼“å­˜ã€‚ä¸çŸ¥é“ä½ åšå®Œè¯¾åæ€è€ƒé¢˜ä¹‹åï¼Œæœ‰æ²¡æœ‰ä½“ä¼šåˆ°é«˜é€Ÿç¼“å­˜åœ¨å®è·µä¸­å¸¦æ¥çš„é€Ÿåº¦æå‡å‘¢ï¼Ÿ</p><p>ä¸è¿‡ï¼Œåˆ©ç”¨CPUé«˜é€Ÿç¼“å­˜ï¼Œåªæ˜¯Disruptorâ€œå¿«â€çš„ä¸€ä¸ªå› ç´ ï¼Œé‚£ä»Šå¤©æˆ‘ä»¬å°±æ¥çœ‹ä¸€çœ‹Disruptorå¿«çš„å¦ä¸€ä¸ªå› ç´ ï¼Œä¹Ÿå°±æ˜¯â€œæ— é”â€ï¼Œè€Œå°½å¯èƒ½å‘æŒ¥CPUæœ¬èº«çš„é«˜é€Ÿå¤„ç†æ€§èƒ½ã€‚</p><h2>ç¼“æ…¢çš„é”</h2><p>Disruptorä½œä¸ºä¸€ä¸ªé«˜æ€§èƒ½çš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…é˜Ÿåˆ—ç³»ç»Ÿï¼Œä¸€ä¸ªæ ¸å¿ƒçš„è®¾è®¡å°±æ˜¯é€šè¿‡RingBufferå®ç°ä¸€ä¸ªæ— é”é˜Ÿåˆ—ã€‚</p><p>ä¸Šä¸€è®²é‡Œæˆ‘ä»¬è®²è¿‡ï¼ŒJavaé‡Œé¢çš„åŸºç¡€åº“é‡Œï¼Œå°±æœ‰åƒLinkedBlockingQueueè¿™æ ·çš„é˜Ÿåˆ—åº“ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªé˜Ÿåˆ—åº“æ¯”èµ·Disruptoré‡Œç”¨çš„RingBufferè¦æ…¢ä¸Šå¾ˆå¤šã€‚æ…¢çš„ç¬¬ä¸€ä¸ªåŸå› æˆ‘ä»¬è¯´è¿‡ï¼Œå› ä¸ºé“¾è¡¨çš„æ•°æ®åœ¨å†…å­˜é‡Œé¢çš„å¸ƒå±€å¯¹äºé«˜é€Ÿç¼“å­˜å¹¶ä¸å‹å¥½ï¼Œè€ŒRingBufferæ‰€ä½¿ç”¨çš„æ•°ç»„åˆ™ä¸ç„¶ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/9c/69/9ce732cb22c49a8a26e870dddde66b69.jpeg?wh=2566*2059\" alt=\"\"></p><p>LinkedBlockingQueueæ…¢ï¼Œæœ‰å¦å¤–ä¸€ä¸ªé‡è¦çš„å› ç´ ï¼Œé‚£å°±æ˜¯å®ƒå¯¹äºé”çš„ä¾èµ–ã€‚åœ¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼é‡Œï¼Œæˆ‘ä»¬å¯èƒ½æœ‰å¤šä¸ªæ¶ˆè´¹è€…ï¼ŒåŒæ ·ä¹Ÿå¯èƒ½æœ‰å¤šä¸ªç”Ÿäº§è€…ã€‚å¤šä¸ªç”Ÿäº§è€…éƒ½è¦å¾€é˜Ÿåˆ—çš„å°¾æŒ‡é’ˆé‡Œé¢æ·»åŠ æ–°çš„ä»»åŠ¡ï¼Œå°±ä¼šäº§ç”Ÿå¤šä¸ªçº¿ç¨‹çš„ç«äº‰ã€‚äºæ˜¯ï¼Œåœ¨åšè¿™ä¸ªäº‹æƒ…çš„æ—¶å€™ï¼Œç”Ÿäº§è€…å°±éœ€è¦æ‹¿åˆ°å¯¹äºé˜Ÿåˆ—å°¾éƒ¨çš„é”ã€‚åŒæ ·åœ°ï¼Œåœ¨å¤šä¸ªæ¶ˆè´¹è€…å»æ¶ˆè´¹é˜Ÿåˆ—å¤´çš„æ—¶å€™ï¼Œä¹Ÿå°±äº§ç”Ÿç«äº‰ã€‚åŒæ ·æ¶ˆè´¹è€…ä¹Ÿè¦æ‹¿åˆ°é”ã€‚</p><!-- [[[read_end]]] --><p>é‚£åªæœ‰ä¸€ä¸ªç”Ÿäº§è€…ï¼Œæˆ–è€…ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å°±æ²¡æœ‰è¿™ä¸ªé”ç«äº‰çš„é—®é¢˜äº†å‘¢ï¼Ÿå¾ˆé—æ†¾ï¼Œç­”æ¡ˆè¿˜æ˜¯å¦å®šçš„ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ä¸‹ï¼Œæ¶ˆè´¹è€…è¦æ¯”ç”Ÿäº§è€…å¿«ã€‚ä¸ç„¶çš„è¯ï¼Œé˜Ÿåˆ—ä¼šäº§ç”Ÿç§¯å‹ï¼Œé˜Ÿåˆ—é‡Œé¢çš„ä»»åŠ¡ä¼šè¶Šå †è¶Šå¤šã€‚</p><p>ä¸€æ–¹é¢ï¼Œä½ ä¼šå‘ç°è¶Šæ¥è¶Šå¤šçš„ä»»åŠ¡æ²¡æœ‰èƒ½å¤ŸåŠæ—¶å®Œæˆï¼›å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬çš„å†…å­˜ä¹Ÿä¼šæ”¾ä¸ä¸‹ã€‚è™½ç„¶ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ä¸‹ï¼Œæˆ‘ä»¬éƒ½æœ‰ä¸€ä¸ªé˜Ÿåˆ—æ¥ä½œä¸ºç¼“å†²åŒºï¼Œä½†æ˜¯å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œè¿™ä¸ªç¼“å†²åŒºé‡Œé¢æ˜¯ç©ºçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿åªæœ‰ä¸€ä¸ªç”Ÿäº§è€…å’Œä¸€ä¸ªæ¶ˆè´¹è€…è€…ï¼Œè¿™ä¸ªç”Ÿäº§è€…æŒ‡å‘çš„é˜Ÿåˆ—å°¾å’Œæ¶ˆè´¹è€…æŒ‡å‘çš„é˜Ÿåˆ—å¤´æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ã€‚äºæ˜¯ï¼Œè¿™ä¸¤ä¸ªç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´ä¸€æ ·ä¼šäº§ç”Ÿé”ç«äº‰ã€‚</p><p>åœ¨LinkedBlockingQueueä¸Šï¼Œè¿™ä¸ªé”æœºåˆ¶æ˜¯é€šè¿‡ReentrantLockè¿™ä¸ªJava åŸºç¡€åº“æ¥å®ç°çš„ã€‚è¿™ä¸ªé”æ˜¯ä¸€ä¸ªç”¨Javaåœ¨JVMä¸Šç›´æ¥å®ç°çš„åŠ é”æœºåˆ¶ï¼Œè¿™ä¸ªé”æœºåˆ¶éœ€è¦ç”±JVMæ¥è¿›è¡Œè£å†³ã€‚è¿™ä¸ªé”çš„äº‰å¤ºï¼Œä¼šæŠŠæ²¡æœ‰æ‹¿åˆ°é”çš„çº¿ç¨‹æŒ‚èµ·ç­‰å¾…ï¼Œä¹Ÿå°±éœ€è¦ç»è¿‡ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆContext Switchï¼‰ã€‚</p><p>ä¸çŸ¥é“ä½ è¿˜è®°ä¸è®°å¾—ï¼Œæˆ‘ä»¬åœ¨<a href=\"https://time.geekbang.org/column/article/103717\">ç¬¬28è®²</a>è®²è¿‡çš„å¼‚å¸¸å’Œä¸­æ–­ï¼Œè¿™é‡Œçš„ä¸Šä¸‹æ–‡åˆ‡æ¢è¦åšçš„å’Œå¼‚å¸¸å’Œä¸­æ–­é‡Œçš„æ˜¯ä¸€æ ·çš„ã€‚ä¸Šä¸‹æ–‡åˆ‡æ¢çš„è¿‡ç¨‹ï¼Œéœ€è¦æŠŠå½“å‰æ‰§è¡Œçº¿ç¨‹çš„å¯„å­˜å™¨ç­‰ç­‰çš„ä¿¡æ¯ï¼Œä¿å­˜åˆ°çº¿ç¨‹æ ˆé‡Œé¢ã€‚è€Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿå¿…ç„¶æ„å‘³ç€ï¼Œå·²ç»åŠ è½½åˆ°é«˜é€Ÿç¼“å­˜é‡Œé¢çš„æŒ‡ä»¤æˆ–è€…æ•°æ®ï¼Œåˆå›åˆ°äº†ä¸»å†…å­˜é‡Œé¢ï¼Œä¼šè¿›ä¸€æ­¥æ‹–æ…¢æˆ‘ä»¬çš„æ€§èƒ½ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æŒ‰ç…§Disruptorä»‹ç»èµ„æ–™é‡Œæåˆ°çš„Benchmarkï¼Œå†™ä¸€æ®µä»£ç æ¥çœ‹çœ‹ï¼Œæ˜¯ä¸æ˜¯çœŸæ˜¯è¿™æ ·çš„ã€‚è¿™é‡Œæˆ‘æ”¾äº†ä¸€æ®µJavaä»£ç ï¼Œä»£ç çš„é€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠä¸€ä¸ªlongç±»å‹çš„counterï¼Œä»0è‡ªå¢åˆ°5äº¿ã€‚ä¸€ç§æ–¹å¼æ˜¯æ²¡æœ‰ä»»ä½•é”ï¼Œå¦å¤–ä¸€ä¸ªæ–¹å¼æ˜¯æ¯æ¬¡è‡ªå¢çš„æ—¶å€™éƒ½è¦å»å–ä¸€ä¸ªé”ã€‚</p><p>ä½ å¯ä»¥åœ¨è‡ªå·±çš„ç”µè„‘ä¸Šè¯•è¯•è·‘ä¸€ä¸‹è¿™ä¸ªç¨‹åºã€‚åœ¨æˆ‘è¿™é‡Œï¼Œä¸¤ä¸ªæ–¹å¼æ‰§è¡Œæ‰€éœ€è¦çš„æ—¶é—´åˆ†åˆ«æ˜¯207æ¯«ç§’å’Œ9603æ¯«ç§’ï¼Œæ€§èƒ½å·®å‡ºäº†å°†è¿‘50å€ã€‚</p><pre><code>package com.xuwenhao.perf.jmm;\n\n\nimport java.util.concurrent.atomic.AtomicLong;\nimport java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\n\n\npublic class LockBenchmark{\n\n\n    public static void runIncrement()\n    {\n        long counter = 0;\n        long max = 500000000L;\n        long start = System.currentTimeMillis();\n        while (counter &lt; max) {\n            counter++;\n        }\n        long end = System.currentTimeMillis();\n        System.out.println(&quot;Time spent is &quot; + (end-start) + &quot;ms without lock&quot;);\n    }\n\n\n    public static void runIncrementWithLock()\n    {\n        Lock lock = new ReentrantLock();\n        long counter = 0;\n        long max = 500000000L;\n        long start = System.currentTimeMillis();\n        while (counter &lt; max) {\n            if (lock.tryLock()){\n                counter++;\n                lock.unlock();\n            }\n        }\n        long end = System.currentTimeMillis();\n        System.out.println(&quot;Time spent is &quot; + (end-start) + &quot;ms with lock&quot;);\n    }\n\n\n    public static void main(String[] args) {\n        runIncrement();\n        runIncrementWithLock();\n</code></pre><center><span class=\"reference\">åŠ é”å’Œä¸åŠ é”è‡ªå¢counter</span></center><pre><code>Time spent is 207ms without lock\nTime spent is 9603ms with lock\n</code></pre><center><span class=\"reference\">æ€§èƒ½å·®å‡ºå°†è¿‘10å€</span></center><h2>æ— é”çš„RingBuffer</h2><p>åŠ é”å¾ˆæ…¢ï¼Œæ‰€ä»¥Disruptorçš„è§£å†³æ–¹æ¡ˆå°±æ˜¯â€œæ— é”â€ã€‚è¿™ä¸ªâ€œæ— é”â€æŒ‡çš„æ˜¯æ²¡æœ‰æ“ä½œç³»ç»Ÿå±‚é¢çš„é”ã€‚å®é™…ä¸Šï¼ŒDisruptorè¿˜æ˜¯åˆ©ç”¨äº†ä¸€ä¸ªCPUç¡¬ä»¶æ”¯æŒçš„æŒ‡ä»¤ï¼Œç§°ä¹‹ä¸ºCASï¼ˆCompare And Swapï¼Œæ¯”è¾ƒå’Œäº¤æ¢ï¼‰ã€‚åœ¨Intel CPUé‡Œé¢ï¼Œè¿™ä¸ªå¯¹åº”çš„æŒ‡ä»¤å°±æ˜¯ cmpxchgã€‚é‚£ä¹ˆä¸‹é¢ï¼Œæˆ‘ä»¬å°±ä¸€èµ·ä»Disruptorçš„æºç ï¼Œåˆ°å…·ä½“çš„ç¡¬ä»¶æŒ‡ä»¤æ¥çœ‹çœ‹è¿™æ˜¯æ€ä¹ˆä¸€å›äº‹å„¿ã€‚</p><p>Disruptorçš„RingBufferæ˜¯è¿™ä¹ˆè®¾è®¡çš„ï¼Œå®ƒå’Œç›´æ¥åœ¨é“¾è¡¨çš„å¤´å’Œå°¾åŠ é”ä¸åŒã€‚Disruptorçš„RingBufferåˆ›å»ºäº†ä¸€ä¸ªSequenceå¯¹è±¡ï¼Œç”¨æ¥æŒ‡å‘å½“å‰çš„RingBufferçš„å¤´å’Œå°¾ã€‚è¿™ä¸ªå¤´å’Œå°¾çš„æ ‡è¯†å‘¢ï¼Œä¸æ˜¯é€šè¿‡ä¸€ä¸ªæŒ‡é’ˆæ¥å®ç°çš„ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ª<strong>åºå·</strong>ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¯¹åº”æºç é‡Œé¢çš„ç±»åå«Sequenceã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b6/ec/b64487a7b6b45393fdfa7e2d63e176ec.jpeg?wh=2566*3601\" alt=\"\"></p><p>åœ¨è¿™ä¸ªRingBufferå½“ä¸­ï¼Œè¿›è¡Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´çš„èµ„æºåè°ƒï¼Œé‡‡ç”¨çš„æ˜¯å¯¹æ¯”åºå·çš„æ–¹å¼ã€‚å½“ç”Ÿäº§è€…æƒ³è¦å¾€é˜Ÿåˆ—é‡ŒåŠ å…¥æ–°æ•°æ®çš„æ—¶å€™ï¼Œå®ƒä¼šæŠŠå½“å‰çš„ç”Ÿäº§è€…çš„Sequenceçš„åºå·ï¼ŒåŠ ä¸Šéœ€è¦åŠ å…¥çš„æ–°æ•°æ®çš„æ•°é‡ï¼Œç„¶åå’Œå®é™…çš„æ¶ˆè´¹è€…æ‰€åœ¨çš„ä½ç½®è¿›è¡Œå¯¹æ¯”ï¼Œçœ‹çœ‹é˜Ÿåˆ—é‡Œæ˜¯ä¸æ˜¯æœ‰è¶³å¤Ÿçš„ç©ºé—´åŠ å…¥è¿™äº›æ•°æ®ï¼Œè€Œä¸ä¼šè¦†ç›–æ‰æ¶ˆè´¹è€…è¿˜æ²¡æœ‰å¤„ç†å®Œçš„æ•°æ®ã€‚</p><p>åœ¨Sequenceçš„ä»£ç é‡Œé¢ï¼Œå°±æ˜¯é€šè¿‡compareAndSetè¿™ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”æœ€ç»ˆè°ƒç”¨åˆ°äº†UNSAFE.compareAndSwapLongï¼Œä¹Ÿå°±æ˜¯ç›´æ¥ä½¿ç”¨äº†CASæŒ‡ä»¤ã€‚</p><pre><code> public boolean compareAndSet(final long expectedValue, final long newValue)\n\t    {\n\t        return UNSAFE.compareAndSwapLong(this, VALUE_OFFSET, expectedValue, newValue);\n\t    }\n\n\npublic long addAndGet(final long increment)\n    {\n        long currentValue;\n        long newValue;\n\n\n        do\n        {\n            currentValue = get();\n            newValue = currentValue + increment;\n        }\n        while (!compareAndSet(currentValue, newValue));\n\n\n        return newValue;\n</code></pre><center><span class=\"reference\">Sequenceæºç ä¸­çš„addAndGetï¼Œå¦‚æœCASçš„æ“ä½œæ²¡æœ‰æˆåŠŸï¼Œå®ƒä¼šä¸æ–­å¿™ç­‰å¾…åœ°é‡è¯•</span></center><p>è¿™ä¸ªCASæŒ‡ä»¤ï¼Œä¹Ÿå°±æ˜¯æ¯”è¾ƒå’Œäº¤æ¢çš„æ“ä½œï¼Œå¹¶ä¸æ˜¯åŸºç¡€åº“é‡Œçš„ä¸€ä¸ªå‡½æ•°ã€‚å®ƒä¹Ÿä¸æ˜¯æ“ä½œç³»ç»Ÿé‡Œé¢å®ç°çš„ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œè€Œæ˜¯<strong>ä¸€ä¸ªCPUç¡¬ä»¶æ”¯æŒçš„æœºå™¨æŒ‡ä»¤</strong>ã€‚åœ¨æˆ‘ä»¬æœåŠ¡å™¨æ‰€ä½¿ç”¨çš„Intel CPUä¸Šï¼Œå°±æ˜¯cmpxchgè¿™ä¸ªæŒ‡ä»¤ã€‚</p><pre><code>compxchg [ax] (éšå¼å‚æ•°ï¼ŒEAXç´¯åŠ å™¨), [bx] (æºæ“ä½œæ•°åœ°å€), [cx] (ç›®æ ‡æ“ä½œæ•°åœ°å€)\n</code></pre><p>cmpxchgæŒ‡ä»¤ï¼Œä¸€å…±æœ‰ä¸‰ä¸ªæ“ä½œæ•°ï¼Œç¬¬ä¸€ä¸ªæ“ä½œæ•°ä¸åœ¨æŒ‡ä»¤é‡Œé¢å‡ºç°ï¼Œæ˜¯ä¸€ä¸ªéšå¼çš„æ“ä½œæ•°ï¼Œä¹Ÿå°±æ˜¯EAXç´¯åŠ å¯„å­˜å™¨é‡Œé¢çš„å€¼ã€‚ç¬¬äºŒä¸ªæ“ä½œæ•°å°±æ˜¯æºæ“ä½œæ•°ï¼Œå¹¶ä¸”æŒ‡ä»¤ä¼šå¯¹æ¯”è¿™ä¸ªæ“ä½œæ•°å’Œä¸Šé¢çš„ç´¯åŠ å¯„å­˜å™¨é‡Œé¢çš„å€¼ã€‚</p><p>å¦‚æœå€¼æ˜¯ç›¸åŒçš„ï¼Œé‚£ä¸€æ–¹é¢ï¼ŒCPUä¼šæŠŠZFï¼ˆä¹Ÿå°±æ˜¯æ¡ä»¶ç å¯„å­˜å™¨é‡Œé¢é›¶æ ‡å¿—ä½çš„å€¼ï¼‰è®¾ç½®ä¸º1ï¼Œç„¶åå†æŠŠç¬¬ä¸‰ä¸ªæ“ä½œæ•°ï¼ˆä¹Ÿå°±æ˜¯ç›®æ ‡æ“ä½œæ•°ï¼‰ï¼Œè®¾ç½®åˆ°æºæ“ä½œæ•°çš„åœ°å€ä¸Šã€‚å¦‚æœä¸ç›¸ç­‰çš„è¯ï¼Œå°±ä¼šæŠŠæºæ“ä½œæ•°é‡Œé¢çš„å€¼ï¼Œè®¾ç½®åˆ°ç´¯åŠ å™¨å¯„å­˜å™¨é‡Œé¢ã€‚</p><p>æˆ‘åœ¨è¿™é‡Œæ”¾äº†è¿™ä¸ªé€»è¾‘å¯¹åº”çš„ä¼ªä»£ç ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹ã€‚å¦‚æœä½ å¯¹æ±‡ç¼–æŒ‡ä»¤ã€æ¡ä»¶ç å¯„å­˜å™¨è¿™äº›çŸ¥è¯†ç‚¹æœ‰ç‚¹å„¿æ¨¡ç³Šäº†ï¼Œå¯ä»¥å›å¤´å»çœ‹çœ‹<a href=\"https://time.geekbang.org/column/article/93359\">ç¬¬5</a><a href=\"https://time.geekbang.org/column/article/93359\">è®²</a>ã€<a href=\"https://time.geekbang.org/column/article/94075\">ç¬¬6è®²</a>å…³äºæ±‡ç¼–æŒ‡ä»¤çš„éƒ¨åˆ†ã€‚</p><pre><code>IF [ax]&lt; == [bx] THEN [ZF] = 1, [bx] = [cx]\n                 ELSE [ZF] = 0, [ax] = [bx] \n</code></pre><p>å•ä¸ªæŒ‡ä»¤æ˜¯åŸå­çš„ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€åœ¨ä½¿ç”¨CASæ“ä½œçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦å•ç‹¬è¿›è¡ŒåŠ é”ï¼Œç›´æ¥è°ƒç”¨å°±å¯ä»¥äº†ã€‚</p><p>æ²¡æœ‰äº†é”ï¼ŒCPUè¿™éƒ¨é«˜é€Ÿè·‘è½¦å°±åƒåœ¨èµ›é“ä¸Šè¡Œé©¶ï¼Œä¸ä¼šé‡åˆ°éœ€è¦ä¸Šä¸‹æ–‡åˆ‡æ¢è¿™æ ·çš„çº¢ç¯è€Œåœä¸‹æ¥ã€‚è™½ç„¶ä¼šé‡åˆ°åƒCASè¿™æ ·å¤æ‚çš„æœºå™¨æŒ‡ä»¤ï¼Œå°±å¥½åƒèµ›é“ä¸Šä¼šæœ‰Uå‹å¼¯ä¸€æ ·ï¼Œä¸è¿‡ä¸ç”¨å®Œå…¨åœä¸‹æ¥ç­‰å¾…ï¼Œæˆ‘ä»¬CPUè¿è¡Œèµ·æ¥ä»ç„¶ä¼šå¿«å¾ˆå¤šã€‚</p><p>é‚£ä¹ˆï¼ŒCASæ“ä½œåˆ°åº•ä¼šæœ‰å¤šå¿«å‘¢ï¼Ÿæˆ‘ä»¬è¿˜æ˜¯ç”¨ä¸€æ®µJavaä»£ç æ¥çœ‹ä¸€ä¸‹ã€‚</p><pre><code>package com.xuwenhao.perf.jmm;\n\n\nimport java.util.concurrent.atomic.AtomicLong;\nimport java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\n\n\npublic class LockBenchmark {\n\n\n    public static void runIncrementAtomic()\n    {\n        AtomicLong counter = new AtomicLong(0);\n        long max = 500000000L;\n        long start = System.currentTimeMillis();\n        while (counter.incrementAndGet() &lt; max) {\n        }\n        long end = System.currentTimeMillis();\n        System.out.println(&quot;Time spent is &quot; + (end-start) + &quot;ms with cas&quot;);\n    }\n\n\n    public static void main(String[] args) {\n        runIncrementAtomic();\n    }\n</code></pre><pre><code>Time spent is 3867ms with cas\n</code></pre><p>å’Œä¸Šé¢çš„counterè‡ªå¢ä¸€æ ·ï¼Œåªä¸è¿‡è¿™ä¸€æ¬¡ï¼Œè‡ªå¢æˆ‘ä»¬é‡‡ç”¨äº†AtomicLongè¿™ä¸ªJavaç±»ã€‚é‡Œé¢çš„incrementAndGetæœ€ç»ˆåˆ°äº†CPUæŒ‡ä»¤å±‚é¢ï¼Œåœ¨å®ç°çš„æ—¶å€™ç”¨çš„å°±æ˜¯CASæ“ä½œã€‚å¯ä»¥çœ‹åˆ°ï¼Œå®ƒæ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œè™½ç„¶è¦æ¯”æ²¡æœ‰ä»»ä½•é”çš„æ“ä½œæ…¢ä¸Šä¸€ä¸ªæ•°é‡çº§ï¼Œä½†æ˜¯æ¯”èµ·ä½¿ç”¨ReentrantLockè¿™æ ·çš„æ“ä½œç³»ç»Ÿé”çš„æœºåˆ¶ï¼Œè¿˜æ˜¯å‡å°‘äº†ä¸€åŠä»¥ä¸Šçš„æ—¶é—´ã€‚</p><h2>æ€»ç»“å»¶ä¼¸</h2><p>å¥½äº†ï¼Œå’±ä»¬ä¸“æ çš„æ­£æ–‡å†…å®¹åˆ°ä»Šå¤©å°±è¦ç»“æŸäº†ã€‚ä»Šå¤©æœ€åä¸€è®²ï¼Œæˆ‘å¸¦ç€ä½ ä¸€èµ·çœ‹äº†Disruptorä»£ç çš„ä¸€ä¸ªæ ¸å¿ƒè®¾è®¡ï¼Œä¹Ÿå°±æ˜¯å®ƒçš„RingBufferæ˜¯æ€ä¹ˆåšåˆ°æ— é”çš„ã€‚</p><p>JavaåŸºç¡€åº“é‡Œé¢çš„BlockingQueueï¼Œéƒ½éœ€è¦é€šè¿‡æ˜¾ç¤ºåœ°åŠ é”æ¥ä¿éšœç”Ÿäº§è€…ä¹‹é—´ã€æ¶ˆè´¹è€…ä¹‹é—´ï¼Œä¹ƒè‡³ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´ï¼Œä¸ä¼šå‘ç”Ÿé”å†²çªçš„é—®é¢˜ã€‚</p><p>ä½†æ˜¯ï¼ŒåŠ é”ä¼šå¤§å¤§æ‹–æ…¢æˆ‘ä»¬çš„æ€§èƒ½ã€‚åœ¨è·å–é”è¿‡ç¨‹ä¸­ï¼ŒCPUæ²¡æœ‰å»æ‰§è¡Œè®¡ç®—çš„ç›¸å…³æŒ‡ä»¤ï¼Œè€Œè¦ç­‰å¾…æ“ä½œç³»ç»Ÿæˆ–è€…JVMæ¥è¿›è¡Œé”ç«äº‰çš„è£å†³ã€‚è€Œé‚£äº›æ²¡æœ‰æ‹¿åˆ°é”è€Œè¢«æŒ‚èµ·ç­‰å¾…çš„çº¿ç¨‹ï¼Œåˆ™éœ€è¦è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚è¿™ä¸ªä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¼šæŠŠæŒ‚èµ·çº¿ç¨‹çš„å¯„å­˜å™¨é‡Œçš„æ•°æ®æ”¾åˆ°çº¿ç¨‹çš„ç¨‹åºæ ˆé‡Œé¢å»ã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼ŒåŠ è½½åˆ°é«˜é€Ÿç¼“å­˜é‡Œé¢çš„æ•°æ®ä¹Ÿå¤±æ•ˆäº†ï¼Œç¨‹åºå°±å˜å¾—æ›´æ…¢äº†ã€‚</p><p>Disruptoré‡Œçš„RingBufferé‡‡ç”¨äº†ä¸€ä¸ªæ— é”çš„è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡CASè¿™æ ·çš„æ“ä½œï¼Œå»è¿›è¡Œåºå·çš„è‡ªå¢å’Œå¯¹æ¯”ï¼Œä½¿å¾—CPUä¸éœ€è¦è·å–æ“ä½œç³»ç»Ÿçš„é”ã€‚è€Œæ˜¯èƒ½å¤Ÿç»§ç»­é¡ºåºåœ°æ‰§è¡ŒCPUæŒ‡ä»¤ã€‚æ²¡æœ‰ä¸Šä¸‹æ–‡åˆ‡æ¢ã€æ²¡æœ‰æ“ä½œç³»ç»Ÿé”ï¼Œè‡ªç„¶ç¨‹åºå°±è·‘å¾—å¿«äº†ã€‚ä¸è¿‡å› ä¸ºé‡‡ç”¨äº†CASè¿™æ ·çš„å¿™ç­‰å¾…ï¼ˆBusy-Waitï¼‰çš„æ–¹å¼ï¼Œä¼šä½¿å¾—æˆ‘ä»¬çš„CPUå§‹ç»ˆæ»¡è´Ÿè·è¿è½¬ï¼Œæ¶ˆè€—æ›´å¤šçš„ç”µï¼Œç®—æ˜¯ä¸€ä¸ªå°å°çš„ç¼ºç‚¹ã€‚</p><p>ç¨‹åºé‡Œé¢çš„CASè°ƒç”¨ï¼Œæ˜ å°„åˆ°æˆ‘ä»¬çš„CPUç¡¬ä»¶å±‚é¢ï¼Œå°±æ˜¯ä¸€ä¸ªæœºå™¨æŒ‡ä»¤ï¼Œè¿™ä¸ªæŒ‡ä»¤å°±æ˜¯cmpxchgã€‚å¯ä»¥çœ‹åˆ°ï¼Œå½“æƒ³è¦è¿½æ±‚æœ€æè‡´çš„æ€§èƒ½çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šä»åº”ç”¨å±‚ã€è´¯ç©¿åˆ°æ“ä½œç³»ç»Ÿï¼Œä¹ƒè‡³æœ€åçš„CPUç¡¬ä»¶ï¼Œææ¸…æ¥šä»é«˜çº§è¯­è¨€åˆ°ç³»ç»Ÿè°ƒç”¨ï¼Œä¹ƒè‡³æœ€åçš„æ±‡ç¼–æŒ‡ä»¤ï¼Œè¿™æ•´ä¸ªè¿‡ç¨‹æ˜¯æ€ä¹ˆæ‰§è¡Œä»£ç çš„ã€‚è€Œè¿™ä¸ªï¼Œä¹Ÿæ˜¯å­¦ä¹ ç»„æˆåŸç†è¿™é—¨ä¸“æ çš„æ„ä¹‰æ‰€åœ¨ã€‚</p><h2>æ¨èé˜…è¯»</h2><p>ä¸çŸ¥é“ä¸Šä¸€è®²è¯´çš„Disruptorç›¸å…³ææ–™ï¼Œä½ æœ‰æ²¡æœ‰è¯»å®Œå‘¢ï¼Ÿå¦‚æœæ²¡æœ‰è¯»å®Œçš„è¯ï¼Œæˆ‘å»ºè®®ä½ è¿˜æ˜¯å…ˆå»ç ”è¯»ä¸€ä¸‹ã€‚</p><p>å¦‚æœä½ å·²ç»è¯»å®Œäº†ï¼Œè¿™é‡Œå†ç»™ä½ æ¨èä¸€äº›é¢å¤–çš„é˜…è¯»ææ–™ï¼Œé‚£å°±æ˜¯è‘—åçš„<a href=\"http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.53.8674&amp;rep=rep1&amp;type=pdf\">Implement Lock-Free Queues</a>è¿™ç¯‡è®ºæ–‡ã€‚ä½ å¯ä»¥æ›´æ·±å…¥åœ°å­¦ä¹ ä¸€ä¸‹ï¼Œæ€ä¹ˆå®ç°ä¸€ä¸ªæ— é”é˜Ÿåˆ—ã€‚</p><h2>è¯¾åæ€è€ƒ</h2><p>æœ€åï¼Œç»™ä½ ç•™ä¸€é“æ€è€ƒé¢˜ã€‚è¿™é“é¢˜ç›®æœ‰ç‚¹å„¿éš¾ï¼Œä¸è¿‡ä¹Ÿå¾ˆæœ‰æ„æ€ã€‚</p><p>è¯·ä½ é˜…è¯»ä¸€ä¸‹Disruptorå¼€æºåº“é‡Œé¢çš„Sequenceè¿™ä¸ªç±»çš„ä»£ç ï¼Œçœ‹çœ‹å®ƒå’Œä¸€ä¸ªæ™®é€šçš„AtomicLongåˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä»¥åŠä¸ºä»€ä¹ˆå®ƒè¦è¿™æ ·å®ç°ã€‚</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºå†™ä¸‹ä½ çš„æ€è€ƒå’Œç­”æ¡ˆï¼Œå’Œå¤§å®¶ä¸€èµ·æ¢è®¨åº”ç”¨å±‚å’Œç¡¬ä»¶å±‚ä¹‹é—´çš„å…³è”æ€§ã€‚å¦‚æœæœ‰æ”¶è·ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚</p><p></p>","comments":[{"had_liked":false,"id":132118,"user_name":"å§œæˆˆ","can_delete":false,"product_type":"c1","uid":1058972,"ip_address":"","ucode":"45C4BE93C8E4CC","user_header":"https://static001.geekbang.org/account/avatar/00/10/28/9c/73e76b19.jpg","comment_is_top":false,"comment_ctime":1568025370,"is_pvip":false,"replies":[{"id":"51058","content":"æŠ±æ­‰ï¼Œä¸è¿‡ä½ çš„ AtomicLong éƒ¨åˆ†çš„ä»£ç æ—¶ä»å“ªé‡Œçœ‹åˆ°çš„ï¼Ÿä¼¼ä¹å’Œopen jdké‡Œé¢çš„æºç å®Œå…¨ä¸ä¸€æ ·ã€‚<br><br>Sequenceä¸»è¦æ˜¯åšäº†Cache Line Paddingï¼Œæ¥è§£å†³False Sharingçš„é—®é¢˜ï¼Œå’ŒAtomicLongæ¯”è¾ƒï¼Œé¿å…Cacheé‡Œé¢çš„æ•°æ®è¢«åå¤äº¤æ¢åˆ°å†…å­˜é‡Œé¢å»ã€‚<br><br>â€œ In fact the only real difference between the 2 is that the Sequence contains additional functionality to prevent false sharing between Sequences and other values.â€<br>","user_name":"ä½œè€…å›å¤","user_name_real":"å¾æ–‡æµ©","uid":"1053568","ctime":1568450943,"ip_address":"","comment_id":132118,"utype":1}],"discussion_count":3,"race_medal":0,"score":"78877436698","product_id":100026001,"comment_content":"è¯¾åé—®é¢˜ï¼š<br>å¯¹æ¯”äº†Sequenceä¸AtomicLongæºç ï¼Œåœ¨äºCASä¹‹å‰ï¼ŒDisruptorç›´æ¥å–åŸæœ‰å€¼ï¼ŒåšCASæ“ä½œï¼›è€ŒAtomicLongä½¿ç”¨äº†getLongVolatileè·å€¼ã€‚<br>ä¸¤è€…valueéƒ½ç”¨äº†Volatileæ¥ä¿®é¥°ï¼Œè¿™ç‚¹æ˜¯å…±åŒçš„ï¼›ä½†åœ¨äºè·å€¼æ—¶ï¼ŒAtomicLongåˆå†æ¬¡ä½¿ç”¨volatile(getLongVolatile), ç”±äºVolatileä¼šåœ¨å†…å­˜ä¸­å¼ºè¡Œåˆ·æ–°æ­¤å€¼ï¼Œç›¸æ¯”è¿™æ ·å°±ä¼šå¢åŠ ä¸€æ¬¡æ€§èƒ½çš„æ¶ˆè€—ï¼Œå¦å¤–è¿˜æœ‰Spinlockï¼ˆè‡ªæ—‹é”ï¼‰ï¼Œè¿™ä¸¤ç‚¹éƒ½ä¼šå¸¦æ¥æ€§èƒ½æ¶ˆè€—ã€‚<br>ä¸ºä»€ä¹ˆDisruptorå¯ä»¥è¿™æ ·åšï¼Œå…æ‰getLongVolatileæ“ä½œï¼Œæˆ‘çŒœæƒ³åº”è¯¥æ˜¯ç¼“å­˜è¡Œçš„å¡«å……ï¼Œé¿å…äº†ä¼ªå…±äº«ï¼ˆFalse Sharingï¼‰çš„é—®é¢˜ï¼Œçº¿ç¨‹å¯¹valueå€¼çš„ä¿®æ”¹ï¼Œä¸ä¼šå‡ºç°ä¸åŒçº¿ç¨‹åŒæ—¶ä¿®æ”¹åŒä¸€ç¼“å­˜è¡Œä¸åŒå˜é‡çš„é—®é¢˜ï¼Œæ‰€ä»¥ä¸éœ€è¦å†æ¬¡å¼ºè¡Œåˆ·å†…å­˜çš„æ­¥éª¤ã€‚<br><br>è¯·è€å¸ˆæŒ‡æ­£ï¼ï¼ï¼<br><br> &#47;**    Sequenceå…³äºå–å€¼æ˜¯ç›´æ¥Get(), æŸ¥çœ‹å†…éƒ¨æ–¹æ³•ç›´æ¥è¿”å›value<br>     *<br>     * Atomically add the supplied value.<br>     *<br>     * @param increment The value to add to the sequence.<br>     * @return The value after the increment.<br>     *&#47;<br>    public long addAndGet(final long increment)<br>    {<br>        long currentValue;<br>        long newValue;<br><br>        do<br>        {<br>            currentValue = get();<br>            newValue = currentValue + increment;<br>        }<br>        while (!compareAndSet(currentValue, newValue));<br><br>        return newValue;<br>    }<br><br>&#47;**    AtomicLongå…³äºå–å€¼æ—¶ä½¿ç”¨getLongVolatileï¼ŒæŸ¥çœ‹å…¶æºç ï¼Œå¢åŠ äº†Volatileå’Œè‡ªæ—‹é”<br>     *<br>     * getAndAddLong<br>     *<br>*&#47;<br>public final long getAndAddLong(Object var1, long var2, long var4) {<br>        long var6;<br>        do {<br>            var6 = this.getLongVolatile(var1, var2);<br>        } while(!this.compareAndSwapLong(var1, var2, var6, var6 + var4));<br><br>        return var6;<br>    }<br><br>&#47;**    getLongVolatileæºç ï¼ˆC++ï¼‰<br>   *<br>   *   1. volatile, åˆ·æ–°å†…å­˜<br>   *   2.Spinlock, è‡ªæ—‹é”<br>   *&#47;<br>jlong<br>sun::misc::Unsafe::getLongVolatile (jobject obj, jlong offset)<br>{<br>  volatile jlong *addr = (jlong *) ((char *) obj + offset);<br>  spinlock lock;<br>  return *addr;<br>}","like_count":18,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466775,"discussion_content":"æŠ±æ­‰ï¼Œä¸è¿‡ä½ çš„ AtomicLong éƒ¨åˆ†çš„ä»£ç æ—¶ä»å“ªé‡Œçœ‹åˆ°çš„ï¼Ÿä¼¼ä¹å’Œopen jdké‡Œé¢çš„æºç å®Œå…¨ä¸ä¸€æ ·ã€‚\n\nSequenceä¸»è¦æ˜¯åšäº†Cache Line Paddingï¼Œæ¥è§£å†³False Sharingçš„é—®é¢˜ï¼Œå’ŒAtomicLongæ¯”è¾ƒï¼Œé¿å…Cacheé‡Œé¢çš„æ•°æ®è¢«åå¤äº¤æ¢åˆ°å†…å­˜é‡Œé¢å»ã€‚\n\nâ€œ In fact the only real difference between the 2 is that the Sequence contains additional functionality to prevent false sharing between Sequences and other values.â€\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1568450943,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2617389,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eprL264RW09w4XQ9nicuYWhiamKjI4ru3QZcxKCgvtmCrDohJTVNJZP02WW4rTbuBezhSCwaicPmWn9g/132","nickname":"Geek_c668bc","note":"","ucode":"3C60B078D1742F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":571190,"discussion_content":"è€å¸ˆæ‚¨å¥½ï¼æœ‰ä¸ªé—®é¢˜æ˜¯volatileä¼¼ä¹æ˜¯ç¦ç”¨cpuç¼“å­˜çš„æ„æ€ï¼Œé‚£ä¹ˆSquenceé‡Œçš„ç¼“å­˜å¡«å……è¿˜æœ‰ç”¨å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652106332,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":466775,"ip_address":""},"score":571190,"extra":""}]},{"author":{"id":1058972,"avatar":"https://static001.geekbang.org/account/avatar/00/10/28/9c/73e76b19.jpg","nickname":"å§œæˆˆ","note":"","ucode":"45C4BE93C8E4CC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":12436,"discussion_content":"æˆ‘æ˜¯æ‘˜å½•JDK8çš„ä»£ç ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568529835,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132113,"user_name":"å”æœå†œæ°‘","can_delete":false,"product_type":"c1","uid":1133947,"ip_address":"","ucode":"6F8F43C6652225","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIaOAxRlZjFkGfRBn420LuAcyWkMrpq5iafGdqthX5icJPjql0ibZOAdafaqbfvw4ZpVzDmsaYglVXDw/132","comment_is_top":false,"comment_ctime":1568024292,"is_pvip":false,"replies":[{"id":"51027","content":"å¹¶ä¸æ˜¯ï¼ŒReentrantLockå†…éƒ¨åªæ˜¯æœ‰CASæ–¹æ³•çš„è°ƒç”¨è€Œå·²ï¼Œè€Œè¿™ä¸ªè°ƒç”¨æ˜¯ä¸ºäº†åšçŠ¶æ€æ£€æŸ¥å’Œè·å–é”ã€‚<br><br>ReetrantLockæœ€ç»ˆä¼šè°ƒç”¨AbstractQueuedSynchronizerï¼Œå¹¶ä¸”ä¼šåœ¨æ‹¿ä¸åˆ°é”çš„æ—¶å€™ä¼šæœ‰è®©å½“å‰èŠ‚ç‚¹sleepçš„è¿‡ç¨‹ã€‚<br><br>è¿™ä¸ªå¯ä»¥æ·±å…¥è¯»ä¸€ä¸‹ReetrantLockçš„æºç ã€‚ <br><br>æœ¬è´¨ä¸Šï¼ŒReentrantLockç­‰äºæ˜¯åœ¨Javaå±‚é¢å®ç°äº†ä¸€ä¸ªè·¨å¹³å°çš„é”æœºåˆ¶ï¼Œå®ƒçš„åº•å±‚è°ƒç”¨ç”¨åˆ°äº†CASæ–¹æ³•è€Œå·²ã€‚è€Œä¸æ˜¯ç›´æ¥åŸºäºCASæ¥è®¾è®¡é˜Ÿåˆ—ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å¾æ–‡æµ©","uid":"1053568","ctime":1568440951,"ip_address":"","comment_id":132113,"utype":1}],"discussion_count":1,"race_medal":0,"score":"78877435620","product_id":100026001,"comment_content":"ReentrantLockå†…éƒ¨ä¸ä¹Ÿæ˜¯CASå®ç°çš„å—","like_count":19,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466773,"discussion_content":"å¹¶ä¸æ˜¯ï¼ŒReentrantLockå†…éƒ¨åªæ˜¯æœ‰CASæ–¹æ³•çš„è°ƒç”¨è€Œå·²ï¼Œè€Œè¿™ä¸ªè°ƒç”¨æ˜¯ä¸ºäº†åšçŠ¶æ€æ£€æŸ¥å’Œè·å–é”ã€‚\n\nReetrantLockæœ€ç»ˆä¼šè°ƒç”¨AbstractQueuedSynchronizerï¼Œå¹¶ä¸”ä¼šåœ¨æ‹¿ä¸åˆ°é”çš„æ—¶å€™ä¼šæœ‰è®©å½“å‰èŠ‚ç‚¹sleepçš„è¿‡ç¨‹ã€‚\n\nè¿™ä¸ªå¯ä»¥æ·±å…¥è¯»ä¸€ä¸‹ReetrantLockçš„æºç ã€‚ \n\næœ¬è´¨ä¸Šï¼ŒReentrantLockç­‰äºæ˜¯åœ¨Javaå±‚é¢å®ç°äº†ä¸€ä¸ªè·¨å¹³å°çš„é”æœºåˆ¶ï¼Œå®ƒçš„åº•å±‚è°ƒç”¨ç”¨åˆ°äº†CASæ–¹æ³•è€Œå·²ã€‚è€Œä¸æ˜¯ç›´æ¥åŸºäºCASæ¥è®¾è®¡é˜Ÿåˆ—ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1568440951,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":133415,"user_name":"æ´»çš„æ½‡æ´’","can_delete":false,"product_type":"c1","uid":1238830,"ip_address":"","ucode":"666C30CA894754","user_header":"https://static001.geekbang.org/account/avatar/00/12/e7/2e/1522a7d6.jpg","comment_is_top":false,"comment_ctime":1568556989,"is_pvip":false,"replies":[{"id":"52624","content":"ğŸ‘ä¸å®¹æ˜“","user_name":"ä½œè€…å›å¤","user_name_real":"å¾æ–‡æµ©","uid":"1053568","ctime":1569656651,"ip_address":"","comment_id":133415,"utype":1}],"discussion_count":7,"race_medal":0,"score":"53108164541","product_id":100026001,"comment_content":"æå®¢æ—¶é—´ä¹°äº†13ä¸ªä¸“æ ï¼Œç»ˆäºå®Œæˆäº†ä¸€ä¸ªä¸“æ çš„æ‰€æœ‰ç¬”è®°<br>ä¸“æ æ‰€æœ‰ç¬”è®°å¦‚ä¸‹ï¼šhttps:&#47;&#47;www.cnblogs.com&#47;luoahong&#47;p&#47;10496701.html","like_count":12,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467383,"discussion_content":"ğŸ‘ä¸å®¹æ˜“","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569656651,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1655940,"avatar":"https://static001.geekbang.org/account/avatar/00/19/44/84/4da14994.jpg","nickname":"å‘†ç“œ","note":"","ucode":"C98C7B224D0640","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294595,"discussion_content":"ç›´æ¥æ‹¿äººå®¶å†™ä½œæˆæœæ¬åˆ°è‡ªå·±åšå®¢,è™½ç„¶æ ‡é¢˜å†™çš„æ˜¯&#39;ç¬”è®°&#39;,ä½†æ€»çš„æ¥è¯´å¾ˆä¸åšé“!","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1595937694,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1252977,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1e/71/9dcbe6c4.jpg","nickname":"æˆæ¥ Peter","note":"","ucode":"4D13E7368D8CF2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":298663,"discussion_content":"æœ‰ç‚¹ä¾µçŠ¯ä½œè€…çš„æƒç›Šï¼Œæ¯•ç«Ÿä½œè€…å†™ä¸“æ ä¸å®¹æ˜“ï¼Œè¿™ç§åŸå°ä¸åŠ¨çš„â€œæ¬è¿â€ï¼Œæˆ‘æ›¿ä½œè€…æŠµåˆ¶ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1597373646,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2119325,"avatar":"https://static001.geekbang.org/account/avatar/00/20/56/9d/4b2a7d29.jpg","nickname":"ryanxw","note":"","ucode":"0B91EAC8D06EED","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537599,"discussion_content":"å“ˆå“ˆå“ˆå“ˆï¼Œçœ‹åˆ°è¿™ä¹ˆå¤šäººéª‚ä½ å°±ç¨³å¦¥äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639112226,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1687754,"avatar":"https://static001.geekbang.org/account/avatar/00/19/c0/ca/180c1345.jpg","nickname":"skeletao","note":"","ucode":"F970D9F7E9DC0E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377868,"discussion_content":"å¼ºçƒˆæŠµåˆ¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622936947,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1080706,"avatar":"https://static001.geekbang.org/account/avatar/00/10/7d/82/5ed8a955.jpg","nickname":"æ™’å¤ªé˜³","note":"","ucode":"99CFF3D5A4FE72","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":319123,"discussion_content":"å®Œæ•´çš„æ¬è¿ï¼Œå¯¹ä½œè€…çš„ä»˜å‡ºå®Œå…¨ä¸å…¬å¹³ï¼Œä½ è¿™ç§è¡Œä¸ºè‡³å°‘è¦å¾—åˆ°ä½œè€…æˆ–å¹³å°çš„è®¸å¯ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603948986,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1147453,"avatar":"https://static001.geekbang.org/account/avatar/00/11/82/3d/356fc3d6.jpg","nickname":"å¿†æ°´å¯’","note":"","ucode":"E3F86BD8AA8903","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312476,"discussion_content":"ç›´æ¥æ¬è¿è¿‡å»ï¼Œæˆ‘éƒ½æ›¿ä½œè€…æ„Ÿåˆ°æ¶å¿ƒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602714478,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":131998,"user_name":"å—å±±","can_delete":false,"product_type":"c1","uid":1119593,"ip_address":"","ucode":"94656FE4A6C378","user_header":"https://static001.geekbang.org/account/avatar/00/11/15/69/187b9968.jpg","comment_is_top":false,"comment_ctime":1568002010,"is_pvip":true,"replies":[{"id":"51117","content":"ğŸ‘ Disruptorçš„ä»£ç çŸ­å°ç²¾å¹²ï¼Œå¾ˆé€‚åˆæ·±å…¥è¯»ä¸€è¯»","user_name":"ä½œè€…å›å¤","user_name_real":"å¾æ–‡æµ©","uid":"1053568","ctime":1568536486,"ip_address":"","comment_id":131998,"utype":1}],"discussion_count":1,"race_medal":0,"score":"31632773082","product_id":100026001,"comment_content":"    ä¸“æ æœ€å¼€å§‹å°±è®¢é˜…äº†ï¼Œçœ‹åˆ°äº†è¿™ç¯‡ä¸“æ ç›®å½•ä¸­çš„è¿™ç¯‡æ–‡æ¡£æ ‡é¢˜ï¼Œå½“æ—¶å°±æƒ³ç€è¦ä»åº•å±‚äº†è§£disruptorçš„åŸç†ï¼Œä¹Ÿä¸€ç¯‡ä¸€ç¯‡è®¤çœŸçš„è·Ÿäº†ä¸‹æ¥ï¼Œä¸çŸ¥ä¸è§‰å°±åˆ°äº†ä»Šå¤©ï¼Œè™½ç„¶æœ‰å¾ˆå¤šåç»­è¿˜æ˜¯è¦å›å»æ—¶å¸¸ç¿»é˜…çš„çŸ¥è¯†ç‚¹ï¼Œä½†æ˜¯ä¹Ÿåº†å¹¸è‡ªå·±èƒ½ä¸€è·¯è·Ÿç€è€å¸ˆåˆ°ç°åœ¨ã€‚<br>     è¯¾åæ€è€ƒé¢˜ä¼šå»ç¿»æºç å†å›æ¥è¡¥å……","like_count":7,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466719,"discussion_content":"ğŸ‘ Disruptorçš„ä»£ç çŸ­å°ç²¾å¹²ï¼Œå¾ˆé€‚åˆæ·±å…¥è¯»ä¸€è¯»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568536486,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132009,"user_name":"å§œæˆˆ","can_delete":false,"product_type":"c1","uid":1058972,"ip_address":"","ucode":"45C4BE93C8E4CC","user_header":"https://static001.geekbang.org/account/avatar/00/10/28/9c/73e76b19.jpg","comment_is_top":false,"comment_ctime":1568004553,"is_pvip":false,"replies":[{"id":"51019","content":"æ˜¯æˆ‘ç¬”è¯¯äº†ï¼Œæ˜¯ReetrantLockï¼Œä¸‹é¢æˆ‘ç»™çš„å¯¹æ¯”ç¤ºä¾‹ä¹Ÿæ˜¯ReentrantLockçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å¾æ–‡æµ©","uid":"1053568","ctime":1568439535,"ip_address":"","comment_id":132009,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18747873737","product_id":100026001,"comment_content":"LinkedBlockingQueueæºç ï¼ˆJDK1.8ï¼‰çœ‹äº†ä¸€ä¸‹, ä½¿ç”¨çš„æ˜¯ReentrantLockå’ŒConditionæ¥æ§åˆ¶çš„ï¼Œæ²¡å‘ç°è€å¸ˆè¯´çš„synchronizedå…³é”®å­—, æ˜¯ä¸æ˜¯å“ªé‡Œæˆ‘å¿½ç•¥æ‰äº†ï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466720,"discussion_content":"æ˜¯æˆ‘ç¬”è¯¯äº†ï¼Œæ˜¯ReetrantLockï¼Œä¸‹é¢æˆ‘ç»™çš„å¯¹æ¯”ç¤ºä¾‹ä¹Ÿæ˜¯ReentrantLockçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568439535,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":200645,"user_name":"å¤§å¤´çˆ¸çˆ¸","can_delete":false,"product_type":"c1","uid":1276613,"ip_address":"","ucode":"131E25DB04D222","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/gmP4Yh00MZPwNvr4UQdLeXaX3TVyZEEp195S3vD3Sfl1xz5jBr1474Mt6w5OPr0KsrnQObfLRy5PkKNFjSBiasA/132","comment_is_top":false,"comment_ctime":1585628565,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14470530453","product_id":100026001,"comment_content":"runIncrementWithLock()é‡Œé¢å¯¹æ¯ä¸ªcounter++æ‰§è¡Œlockå’Œunlockæ“ä½œï¼Œå¯æ˜¯å°±åªæœ‰ä¸€ä¸ªçº¿ç¨‹ç”¨åˆ°è¿™ä¸ªreentrantlockï¼Œé‚£ä¹ˆè¿™ä¸ªlock()å’Œunlock()åº”è¯¥èŠ±ä¸äº†å¤šå°‘æ—¶é—´å•Šï¼Œä¹Ÿä¸ä¼šæœ‰å¤šå°‘context switchæ“ä½œå•Š?","like_count":3},{"had_liked":false,"id":131970,"user_name":"leslie","can_delete":false,"product_type":"c1","uid":1324255,"ip_address":"","ucode":"798E7C1CC98CC2","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/df/64e3d533.jpg","comment_is_top":false,"comment_ctime":1567996400,"is_pvip":false,"replies":[{"id":"51120","content":"ä»è¿ç»´çš„è§’åº¦ï¼Œå…¶å®è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ä¸»é¢˜æ˜¯ç½‘ç»œï¼Œä¹Ÿå€¼å¾—ä»”ç»†å…³æ³¨ä¸€ä¸‹ã€‚<br><br>åœ¨ä¸“æ çš„æ¯ç¯‡æ–‡ç« åé¢åˆ—äº†æ¨èé˜…è¯»ï¼Œä¹Ÿåœ¨ä¸€å¼€å§‹çš„å­¦ä¹ æ–¹æ³•çš„é‚£ä¸€è®²é‡Œé¢åˆ—äº†ä¸€äº›å‚è€ƒèµ„æ–™ã€‚å¯ä»¥å…ˆä»è¿™äº›çœ‹èµ·ã€‚<br><br>å¦å¤–ä¸€ä¸ªå»å¤„æ˜¯å»çœ‹Wikipediaå¯¹åº”çš„æ¡ç›®ä»¥åŠç›¸å…³å¼•ç”¨ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å¾æ–‡æµ©","uid":"1053568","ctime":1568536701,"ip_address":"","comment_id":131970,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14452898288","product_id":100026001,"comment_content":"       å­¦ä¹ ä¸­ä¸€æ­¥æ­¥è·Ÿè¿›ï¼šè¶Šæ¥è¶Šæ˜ç™½å…¶å®çœŸæ­£å¼„æ˜ç™½ä¸ºä½•å­¦ä¹ çš„ä¸­é—´å±‚å…¶å®æ˜¯æ“ä½œç³»ç»Ÿå’Œè®¡ç®—æœºåŸç†ï¼›å°±åƒè€å¸ˆçš„è¯¾ç¨‹ä¸­ä¸å°‘å°±å’Œæ“ä½œç³»ç»Ÿç›¸å…³ï¼Œè€Œåœ¨æ­¤åŸºç¡€ä¸Šå¯ä»¥è¡ç”Ÿå‡ºä¸€ç³»åˆ—ç›¸å…³çš„çŸ¥è¯†ã€‚<br>       å°±åƒè€å¸ˆçš„2ä¸ªTOPï¼šå­˜å‚¨ä¸IOç³»ç»Ÿï¼Œåº”ç”¨ç¯‡åˆ†åˆ«å°±æ˜¯ä¸€ä¸ªå‘ä¸‹ä¸€ä¸ªå‘ä¸Šï¼›ä»£ç é¢˜å¯¹äºä¸åšçº¯ä»£ç è¶…è¿‡5å¹´çš„æ¥è¯´æœ‰ç‚¹éš¾ï¼Œè·Ÿè¯¾å†å»å­¦Javaæœ‰ç‚¹éš¾ä¸”æ—¶é—´å®åœ¨ä¸å¤Ÿ-æ¯•ç«Ÿè¿ç»´çš„codingèƒ½åŠ›éƒ½åå·®ï¼Œä¸è¿‡å¤§è‡´èƒ½æ˜ç™½åŸç†ï¼Œä»åŸç†å±‚å»è§£é‡Šä¸€äº›é—®é¢˜çš„æ ¹æºåŸå› ï¼Œä»¥åŠæŸäº›åœºåˆä¸‹é‚£äº›å¯èƒ½æ›´åŠ é€‚ç”¨ã€‚<br>      å…¶å®é€šè¿‡æ“ä½œç³»ç»Ÿå’Œç»„æˆåŸç†ä¼šè¡ç”Ÿå‡ºå¾ˆå¤šçŸ¥è¯†ï¼šé€‰æ‹©åˆé€‚çš„æ–¹å‘ä¸“æ”»ç¡®å®ä¸é”™ã€‚å‘è€å¸ˆæä¸ªå°çš„è¦æ±‚ï¼šå¸Œæœ›åœ¨æœ€åä¸€å ‚è¯¾å¯ä»¥åˆ†äº«è€å¸ˆåœ¨åšè¿™ä¸ªä¸“æ æ‰€æŸ¥é˜…çš„ä¸»è¦ä¹¦ç±ï¼Œæ¯•ç«Ÿæ²¡äººå¯ä»¥å­¦å®Œä¸€éå°±åŸºæœ¬æŒæ¡çš„ï¼›è€å¸ˆæ‰€çœ‹çš„æ ¸å¿ƒèµ„æ–™æ˜¯æˆ‘ä»¬åç»­å†çœ‹è¯¾ç¨‹æå‡è‡ªå·±çš„ä¸€ä¸ªè¾…åŠ©æ‰‹æ®µå§ã€‚","like_count":3,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466702,"discussion_content":"ä»è¿ç»´çš„è§’åº¦ï¼Œå…¶å®è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ä¸»é¢˜æ˜¯ç½‘ç»œï¼Œä¹Ÿå€¼å¾—ä»”ç»†å…³æ³¨ä¸€ä¸‹ã€‚\n\nåœ¨ä¸“æ çš„æ¯ç¯‡æ–‡ç« åé¢åˆ—äº†æ¨èé˜…è¯»ï¼Œä¹Ÿåœ¨ä¸€å¼€å§‹çš„å­¦ä¹ æ–¹æ³•çš„é‚£ä¸€è®²é‡Œé¢åˆ—äº†ä¸€äº›å‚è€ƒèµ„æ–™ã€‚å¯ä»¥å…ˆä»è¿™äº›çœ‹èµ·ã€‚\n\nå¦å¤–ä¸€ä¸ªå»å¤„æ˜¯å»çœ‹Wikipediaå¯¹åº”çš„æ¡ç›®ä»¥åŠç›¸å…³å¼•ç”¨ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568536701,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1509540,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/KHkscLzp6uFgLWCZDy9JAdl7xic7mUib924CsXrdiacgSkctaXvS3Pibx78BQGRCKI1LbGV3MO01lxfMvrmN1Kl05Q/132","nickname":"cmp","note":"","ucode":"217986D72F8F15","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":8468,"discussion_content":"å‰é¢çš„çŸ¥è¯†åœ°å›¾ä¸€è®²é‡Œï¼Œè€å¸ˆå·²æœ‰è¿‡ä¸€äº›æ¨èï¼Œå¯ä»¥å…ˆå‚è€ƒä¸€ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568007985,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296579,"user_name":"åˆ†æ¸…äº‘æ·¡","can_delete":false,"product_type":"c1","uid":1269873,"ip_address":"","ucode":"7045AE6BF72D31","user_header":"https://static001.geekbang.org/account/avatar/00/13/60/71/895ee6cf.jpg","comment_is_top":false,"comment_ctime":1623052237,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10212986829","product_id":100026001,"comment_content":"æ–‡ç« ä¸­åŠ é”å’Œä¸åŠ é”æ€§èƒ½æ¯”è¾ƒçš„caseè€å¸ˆçš„æ•°æ®æ˜¯å·®äº†50å€ï¼Œæˆ‘åœ¨intel E5 v4å’Œé²²é¹920ä¸‹è·‘å‡ºæ¥éƒ½æ˜¯æŸ¥äº†80å€ã€‚<br>ä¸è¿‡å…¶ä¸­çš„åŸå› ä¸æ˜¯å› ä¸ºåŠ é”ï¼Œè€Œæ˜¯lock.lock() å‡½æ•°è‡ªèº«åŒ…å«äº†å‡ åæ¡æŒ‡ä»¤ï¼Œè€Œ++åªæœ‰ç®€å•çš„å‡ ä¸ªæŒ‡ä»¤ï¼Œä¹Ÿå°±æ˜¯ä¸¤è€…æŒ‡ä»¤æ•°å°±å·®äº†1ä¸ªæ•°é‡çº§ã€‚<br>ä¾‹å­ä¸­ä¸åŠ é”æ€§èƒ½å¥½çš„å¦å¤–ä¸€ä¸ªåŸå› æ˜¯ ++æŒ‡ä»¤ å¯¹æµæ°´çº¿ååˆ†å‹å¥½ï¼ŒåŸºæœ¬èƒ½è·‘æ»¡æµæ°´çº¿ï¼ˆIPC è·‘åˆ°4)ï¼›è€Œlock()é‚£å †æŒ‡ä»¤åªèƒ½æŠŠIPCè·‘åˆ°0.5-0.8ä¹‹é—´ã€‚<br><br>åœ¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„æƒ…å†µä¸‹åŠ é”ä¸­çš„&quot;é”&quot;å¯¹æ€§èƒ½æ˜¯æ²¡æœ‰ä»»ä½•å½±å“çš„ï¼Œæ¯”å¦‚å‡è®¾ä½ çš„ä¸šåŠ¡é€»è¾‘å‡ ä¸‡ä¸ªæŒ‡ä»¤ï¼ŒåŠ ä¸Šlock()å¤šå‡ºæ¥çš„å‡ åä¸ªæŒ‡ä»¤åŸºæœ¬ï¼ŒåŸºæœ¬æ˜¯æ²¡æœ‰å•¥å½±å“çš„ã€‚åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä¸ä¼šçœŸæ­£å‘ç”Ÿåˆ‡æ¢ã€ç­‰é”çš„ç³Ÿå¿ƒæ“ä½œã€‚åªéœ€è¦è€ƒè™‘å®é™…æŒ‡ä»¤é‡å’Œå¯¹pipelineçš„å‹å¥½ç¨‹åº¦","like_count":3,"discussions":[{"author":{"id":1731543,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/6b/d7/8872624a.jpg","nickname":"xmeng","note":"","ucode":"C0CA2182BA3B4B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385651,"discussion_content":"æ£’æ£’æ£’ï¼ä½¿ç”¨çš„æ˜¯åå‘é”ï¼Œä¸å­˜åœ¨é”ç«äº‰ã€‚ä¸»è¦è¿˜æ˜¯éšè—åœ¨æ–¹æ³•ä¸‹é¢çš„æŒ‡ä»¤æ•°åŠæŒ‡ä»¤å¯¹äºæµæ°´çº¿çš„å‹å¥½ç¨‹åº¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627196569,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132499,"user_name":"å…è´¹çš„äºº","can_delete":false,"product_type":"c1","uid":1032106,"ip_address":"","ucode":"2B12D8ED63C564","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bf/aa/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1568152787,"is_pvip":false,"replies":[{"id":"50993","content":"æ˜¯çš„ï¼ŒCASä»ç„¶ä¼šæ¶‰åŠåˆ°å†…å­˜è¯»å–ã€‚<br><br>æˆ‘ä¹‹å‰æ²¡æœ‰ä»”ç»†äº†è§£è¿‡RCUï¼Œä»Šå¤©ç®€å•çœ‹äº†ä¸€ä¸‹èµ„æ–™ï¼Œå¦‚æœæˆ‘çš„ç†è§£æ²¡æœ‰é”™çš„è¯ã€‚ä½œä¸ºè¯»å†™é”æ›¿ä»£çš„è¯ï¼Œæ˜¯OKçš„ã€‚ä¸è¿‡åœ¨Disruptorçš„åœºæ™¯ä¸‹ï¼ŒConsumeréœ€è¦çš„å¹¶ä¸æ˜¯ä¸€ä¸ªè¯»å†™é”ï¼ŒProducerå’ŒConsumerå› ä¸ºéƒ½éœ€è¦æ›´æ–°è‡ªå·±çš„ä½ç½®ï¼Œå…¶å®æ˜¯ä¸¤ä¸ªå†™é”ã€‚æˆ‘ç›´è§‰ä¸Šè§‰å¾—å¹¶æ²¡æœ‰åŠæ³•ä¾é RCUçš„æ–¹å¼æ¥è§£å†³ã€‚<br><br>ä¸è¿‡è¿™ä¸ªå€¼å¾—ä»”ç»†æƒ³ä¸€ä¸‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å¾æ–‡æµ©","uid":"1053568","ctime":1568428501,"ip_address":"","comment_id":132499,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10158087379","product_id":100026001,"comment_content":"Casä»ç„¶ä¼šæ¶‰åŠåˆ°å†…å­˜è¯»å–ï¼Œè€å¸ˆèƒ½å¦ä»‹ç»ä¸‹rcué”ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466973,"discussion_content":"æ˜¯çš„ï¼ŒCASä»ç„¶ä¼šæ¶‰åŠåˆ°å†…å­˜è¯»å–ã€‚\n\næˆ‘ä¹‹å‰æ²¡æœ‰ä»”ç»†äº†è§£è¿‡RCUï¼Œä»Šå¤©ç®€å•çœ‹äº†ä¸€ä¸‹èµ„æ–™ï¼Œå¦‚æœæˆ‘çš„ç†è§£æ²¡æœ‰é”™çš„è¯ã€‚ä½œä¸ºè¯»å†™é”æ›¿ä»£çš„è¯ï¼Œæ˜¯OKçš„ã€‚ä¸è¿‡åœ¨Disruptorçš„åœºæ™¯ä¸‹ï¼ŒConsumeréœ€è¦çš„å¹¶ä¸æ˜¯ä¸€ä¸ªè¯»å†™é”ï¼ŒProducerå’ŒConsumerå› ä¸ºéƒ½éœ€è¦æ›´æ–°è‡ªå·±çš„ä½ç½®ï¼Œå…¶å®æ˜¯ä¸¤ä¸ªå†™é”ã€‚æˆ‘ç›´è§‰ä¸Šè§‰å¾—å¹¶æ²¡æœ‰åŠæ³•ä¾é RCUçš„æ–¹å¼æ¥è§£å†³ã€‚\n\nä¸è¿‡è¿™ä¸ªå€¼å¾—ä»”ç»†æƒ³ä¸€ä¸‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568428501,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132060,"user_name":"D","can_delete":false,"product_type":"c1","uid":1027596,"ip_address":"","ucode":"5BB4D16FE39BFF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ae/0c/f39f847a.jpg","comment_is_top":false,"comment_ctime":1568016936,"is_pvip":false,"replies":[{"id":"51059","content":"ğŸ‘ç†è§£å‡†ç¡®åˆ°ä½","user_name":"ä½œè€…å›å¤","user_name_real":"å¾æ–‡æµ©","uid":"1053568","ctime":1568450957,"ip_address":"","comment_id":132060,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10157951528","product_id":100026001,"comment_content":"çœ‹äº†ä¸‹jdk 1.8çš„ AtomicLong å’Œdisruptorçš„sequenceï¼Œ ä¸ªäººè®¤ä¸ºæœ‰ä¸¤ç‚¹ä¸åŒï¼š<br>1. disruptor åŠ äº†ä¸Šä¸€è®²é‡Œé¢çš„padding, ä»¥è¿›ä¸€æ­¥åˆ©ç”¨ç¼“å­˜ã€‚<br>2. Atomiclong é‡Œé¢æä¾›äº†æ›´å¤šçš„æ–¹æ³•ï¼Œå¹¶ä¸”åˆ¤æ–­cpuæ˜¯å¦æ”¯æŒæ— é”cas<br>ç›¸åŒç‚¹ï¼Œåº•å±‚éƒ½æ˜¯è°ƒç”¨unsafeç±»å®ç°ç¡¬ä»¶å±‚é¢çš„æ“ä½œï¼Œä»¥è·³è¿‡jdkçš„é™åˆ¶ã€‚","like_count":3,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466739,"discussion_content":"ğŸ‘ç†è§£å‡†ç¡®åˆ°ä½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568450957,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":131963,"user_name":"é€é¥æ³•å¤–","can_delete":false,"product_type":"c1","uid":1103533,"ip_address":"","ucode":"75458730192696","user_header":"https://static001.geekbang.org/account/avatar/00/10/d6/ad/52df3832.jpg","comment_is_top":false,"comment_ctime":1567993884,"is_pvip":false,"replies":[{"id":"51118","content":"ğŸ‘ ReetrantLocké‡Œé¢çš„CASæ˜¯ä½œä¸ºè°ƒç”¨æ–¹å¼ï¼Œæœ€ç»ˆæ¥å®ç°ä¸€ä¸ªJVMä¸Šè·¨å¹³å°çš„é”çš„","user_name":"ä½œè€…å›å¤","user_name_real":"å¾æ–‡æµ©","uid":"1053568","ctime":1568536548,"ip_address":"","comment_id":131963,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10157928476","product_id":100026001,"comment_content":"ReentrantLockå†…éƒ¨ä¹Ÿæœ‰CASçš„æ“ä½œï¼Œåªä¸è¿‡ä¹Ÿä¼šæœ‰Lockçš„æ“ä½œã€‚Disruptorç›´æ¥ä½¿ç”¨CASï¼Œæ˜¯ç®€åŒ–äº†æ“ä½œã€‚","like_count":2,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466697,"discussion_content":"ğŸ‘ ReetrantLocké‡Œé¢çš„CASæ˜¯ä½œä¸ºè°ƒç”¨æ–¹å¼ï¼Œæœ€ç»ˆæ¥å®ç°ä¸€ä¸ªJVMä¸Šè·¨å¹³å°çš„é”çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568536548,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":303435,"user_name":"é™ˆå†°æ¸…","can_delete":false,"product_type":"c1","uid":2445350,"ip_address":"","ucode":"69C4D94079E84D","user_header":"https://static001.geekbang.org/account/avatar/00/25/50/26/0e9e87af.jpg","comment_is_top":false,"comment_ctime":1626785693,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5921752989","product_id":100026001,"comment_content":"è€å¸ˆ ä½ æœ‰æ²¡æœ‰å…´è¶£å»é‡åŒ–ç§å‹Ÿè¡Œä¸šåšCTOå‘¢ æˆ–è€…æ¶æ„ç³»ç»Ÿä¼˜åŒ–ä¹‹ç±»çš„å²—ä½å‘¢ï¼Ÿ","like_count":1},{"had_liked":false,"id":228204,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1592612250,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5887579546","product_id":100026001,"comment_content":"how  æ¿€åŠ¨ ï¼Œç¬¬ä¸€éèŠ±äº†å¤§åŠå¹´ï¼Œç»ˆäºæ’¸å®Œäº†","like_count":1,"discussions":[{"author":{"id":1762191,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/e3/8f/77b5a753.jpg","nickname":"å¥½å¥½å­¦ä¹ ","note":"","ucode":"9D44D9530D9A1D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348298,"discussion_content":"æˆ‘ç”¨äº†4å¤©ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1612504542,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1415619,"avatar":"https://static001.geekbang.org/account/avatar/00/15/99/c3/e4f408d4.jpg","nickname":"é™Œå…®","note":"","ucode":"00CE47CAECD5CD","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1762191,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/e3/8f/77b5a753.jpg","nickname":"å¥½å¥½å­¦ä¹ ","note":"","ucode":"9D44D9530D9A1D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":353954,"discussion_content":"æˆ‘ä¹Ÿç”¨äº†4å¤©ã€‚ã€‚ã€‚ç›¸å½“äºä¸€ä¸ªå‘¨æœ«ï¼Œå¯èƒ½æ·±åº¦ä¸åŒå§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615214924,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":348298,"ip_address":""},"score":353954,"extra":""}]}]},{"had_liked":false,"id":195322,"user_name":"ä¿¡é•¿","can_delete":false,"product_type":"c1","uid":1746710,"ip_address":"","ucode":"294D19040C09C0","user_header":"https://static001.geekbang.org/account/avatar/00/1a/a7/16/b2ff3f70.jpg","comment_is_top":false,"comment_ctime":1585179976,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5880147272","product_id":100026001,"comment_content":"ä½ è¯´åˆ°åºå·çš„æ—¶å€™ï¼Œæˆ‘ä»¥ä¸ºå‡å¦‚æœ‰ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œè¿™ä¸¤ä¸ªæ¶ˆè´¹è€…ä¸€ä¸ªæŒ‰ç€å¥‡æ•°çš„åºåˆ—å·æ¶ˆè´¹ï¼Œå¦ä¸€ä¸ªæŒ‰ç€å¶æ•°æ¶ˆè´¹ï¼Œç±»ä¼¼è¿™ç§æ€ç»´ï¼Œæƒ³å¤šäº†å—","like_count":1},{"had_liked":false,"id":143557,"user_name":"æ›™å…‰","can_delete":false,"product_type":"c1","uid":1476450,"ip_address":"","ucode":"04D65BF7F19845","user_header":"https://static001.geekbang.org/account/avatar/00/16/87/62/f99b5b05.jpg","comment_is_top":false,"comment_ctime":1571730707,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5866698003","product_id":100026001,"comment_content":"compxchg [ax] ,[bx], [cx]å’Œ UNSAFE.compareAndSwapLong(this, VALUE_OFFSET, expectedValue, newValue)då¯¹åº”å…³ç³»æ²¡ææ˜ç™½ã€‚jdkæºç åˆ°compareAndSwapLongï¼Œåªæœ‰<br>@HotSpotIntrinsicCandidate<br>public final native boolean compareAndSetLong(Object o, long offset,long expected,long x);<br>ä¸çŸ¥é“compxchgçš„[ax] ,[bx], [cx]å’ŒcompareAndSetLongæ–¹æ³•æœ‰ä»€ä¹ˆå¯¹åº”å…³ç³»","like_count":1},{"had_liked":false,"id":345692,"user_name":"JaredLuo","can_delete":false,"product_type":"c1","uid":1048886,"ip_address":"","ucode":"BA90322BF6779D","user_header":"https://static001.geekbang.org/account/avatar/00/10/01/36/a7adc2dd.jpg","comment_is_top":false,"comment_ctime":1652512422,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1652512422","product_id":100026001,"comment_content":"è€å¸ˆæ¨èé˜…è¯»é‡Œçš„å„ç§è‹±æ–‡è®ºæ–‡èµ„æ–™ï¼Œè¿™äº›è®ºæ–‡èµ„æ–™éƒ½æ˜¯å»å“ªé‡Œæ‰¾çš„ï¼Ÿ","like_count":0},{"had_liked":false,"id":310943,"user_name":"Geek_337e21","can_delete":false,"product_type":"c1","uid":2274627,"ip_address":"","ucode":"D51F99290C30C8","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKyNezT33TyZdPI8DtRe7LzV9geutjMkaNNByOkyMXhNQVia5CJE54lWrBpicftq7jdo8bCcXhokjUQ/132","comment_is_top":false,"comment_ctime":1630996534,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630996534","product_id":100026001,"comment_content":"è€å¸ˆï¼Œæœ‰æ²¡æœ‰C++ä»£ç çš„ä¾‹å­å•Šï¼Ÿ","like_count":0},{"had_liked":false,"id":304055,"user_name":"Ins","can_delete":false,"product_type":"c1","uid":1328500,"ip_address":"","ucode":"A2509BAD9CB72C","user_header":"https://static001.geekbang.org/account/avatar/00/14/45/74/7a82eebb.jpg","comment_is_top":false,"comment_ctime":1627210210,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627210210","product_id":100026001,"comment_content":"Ringbufferæ— é”åŒ–æ²¡æ˜ç™½ï¼ŒcompareAndSetå¯ä»¥çº¿ç¨‹å®‰å…¨æ‰§è¡Œï¼Œä½†æ˜¯å¤–é¢çš„newValue = currentValue + increment;è¯­å¥ï¼ˆæˆ–å®é™…çš„ç”Ÿäº§æ¶ˆè´¹ä»£ç ï¼‰ä¸è¿˜æ˜¯ä¼šå‡ºç°å¤šçº¿ç¨‹ç«äº‰å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":295701,"user_name":"æ–‡è¿›","can_delete":false,"product_type":"c1","uid":2257439,"ip_address":"","ucode":"CD1B6196EBC448","user_header":"https://static001.geekbang.org/account/avatar/00/22/72/1f/9ddfeff7.jpg","comment_is_top":false,"comment_ctime":1622551476,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622551476","product_id":100026001,"comment_content":"è€å¸ˆï¼Œæ­¤å¤„Javaé”çš„ä¾‹å­ä¸å¤ªå‡†ç¡®ï¼Œå› ä¸ºä½ æ˜¯åœ¨å•çº¿ç¨‹ä¸‹è·å–ä»¥åŠé‡Šæ”¾é”ï¼Œå…¶å®å¹¶æ²¡æœ‰äº§ç”Ÿé”ç«äº‰ï¼Œå¹¶ä¸ä¼šæœ‰çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢é—®é¢˜ã€‚æ‰€ä»¥å¯¹å§casçš„ç¨‹åºå·®è·ä¸å¤§ï¼Œå¦‚æœæ”¹æˆå‡ ä¸ªçº¿ç¨‹ä¸€èµ·æ‰§è¡Œï¼ŒæŠ¢å¤ºä¸€ä¸ªé”ï¼Œæ•ˆæœä¼šæ›´æ˜æ˜¾","like_count":0},{"had_liked":false,"id":287092,"user_name":"æ›¾æ³½æµ©","can_delete":false,"product_type":"c1","uid":1104601,"ip_address":"","ucode":"A7E5CF9E1571A2","user_header":"https://static001.geekbang.org/account/avatar/00/10/da/d9/f051962f.jpg","comment_is_top":false,"comment_ctime":1617772517,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617772517","product_id":100026001,"comment_content":"è€å¸ˆï¼Œé”åœ¨ç¡¬ä»¶å±‚é¢çš„å®ç°æœ‰ç›¸å…³èµ„æ–™æ¨èå—ï¼Ÿ","like_count":0},{"had_liked":false,"id":285776,"user_name":"Geek_428412","can_delete":false,"product_type":"c1","uid":2538141,"ip_address":"","ucode":"3E3949B7860EB5","user_header":"","comment_is_top":false,"comment_ctime":1617010054,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617010054","product_id":100026001,"comment_content":"è¿›ä¸€æ­¥ï¼Œä¸ºä»€ä¹ˆcasè¿˜æ˜¯æ¯”åŸå§‹loopæ…¢ä¸€ä¸ªæ•°é‡çº§ï¼Ÿ","like_count":0},{"had_liked":false,"id":285774,"user_name":"Geek_428412","can_delete":false,"product_type":"c1","uid":2538141,"ip_address":"","ucode":"3E3949B7860EB5","user_header":"","comment_is_top":false,"comment_ctime":1617009926,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617009926","product_id":100026001,"comment_content":"ä¸ºä»€ä¹ˆç¬¬ä¸€ç§æƒ…å†µä¸‹ ç¼–è¯‘å™¨ä¸ä¼šåšå¸¸é‡æŠ˜å å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":200700,"user_name":"å¤§å¤´çˆ¸çˆ¸","can_delete":false,"product_type":"c1","uid":1276613,"ip_address":"","ucode":"131E25DB04D222","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/gmP4Yh00MZPwNvr4UQdLeXaX3TVyZEEp195S3vD3Sfl1xz5jBr1474Mt6w5OPr0KsrnQObfLRy5PkKNFjSBiasA/132","comment_is_top":false,"comment_ctime":1585640279,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585640279","product_id":100026001,"comment_content":"åƒè¿™ç§ç”¨ringBufferçš„åŸºäºwrite pointerå’Œread pointerçš„æ¨¡å‹å¥½åƒä¸éœ€è¦å®šä¹‰headå’Œtailå•Šï¼Œproducerå†™å°±æ›´æ–°write pointerï¼Œconsumerè¯»å°±æ›´æ–°read pointerã€‚çœ‹äº†ä¸€ä¸‹â€œImplement Lock-Free Queuesâ€ï¼Œå¥½åƒæå¾—å¾ˆå¤æ‚ã€‚ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¦æè¿™ä¹ˆå¤æ‚ã€‚","like_count":0},{"had_liked":false,"id":200668,"user_name":"å¤§å¤´çˆ¸çˆ¸","can_delete":false,"product_type":"c1","uid":1276613,"ip_address":"","ucode":"131E25DB04D222","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/gmP4Yh00MZPwNvr4UQdLeXaX3TVyZEEp195S3vD3Sfl1xz5jBr1474Mt6w5OPr0KsrnQObfLRy5PkKNFjSBiasA/132","comment_is_top":false,"comment_ctime":1585633308,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585633308","product_id":100026001,"comment_content":"RingBufferéƒ½æ˜¯ç”¨æ•°ç»„å®ç°ï¼Œè€Œ&quot;Implement Lock-Free Queues&quot;æ˜¯åŸºäºé“¾è¡¨ï¼Œä¸¤è€…çš„åŸç†æ˜¯å¦ä¸€æ ·ï¼Ÿ","like_count":0},{"had_liked":false,"id":200657,"user_name":"å¤§å¤´çˆ¸çˆ¸","can_delete":false,"product_type":"c1","uid":1276613,"ip_address":"","ucode":"131E25DB04D222","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/gmP4Yh00MZPwNvr4UQdLeXaX3TVyZEEp195S3vD3Sfl1xz5jBr1474Mt6w5OPr0KsrnQObfLRy5PkKNFjSBiasA/132","comment_is_top":false,"comment_ctime":1585630118,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585630118","product_id":100026001,"comment_content":"è¿™ç§ring bufferæ˜¯åŸºäºwrite pointerå’Œread pointerï¼Œæ˜¯ä¸æ˜¯åªé€‚åˆä¸€ä¸ªç”Ÿäº§è€…å’Œä¸€ä¸ªæ¶ˆè´¹è€…çš„æƒ…å†µï¼Ÿå¦‚æœæœ‰å¤šä¸ªç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é‚£å°±æœ‰å¤šä¸ªwrite pointerå’Œread pointerï¼Œé‚£å²‚ä¸ä¹±äº†å¥—ï¼Ÿ","like_count":0}]}