{"id":724776,"title":"10ï½œå†æ¢traitï¼šå¸¦ç±»å‹å‚æ•°çš„traitåŠtrait object","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯Mikeï¼Œä»Šå¤©æˆ‘ä»¬ç»§ç»­å­¦ä¹ traitç›¸å…³çŸ¥è¯†ã€‚</p><p>å›é¡¾ä¸€ä¸‹æˆ‘ä»¬ä¸Šä¸€èŠ‚è¯¾ä¸­ç±»å‹å‚æ•°å‡ºç°çš„åœ°æ–¹ã€‚</p><ul>\n<li>ç”¨ trait å¯¹ ï¼´ ä½œç±»å‹ç©ºé—´çš„çº¦æŸï¼Œæ¯”å¦‚<code>T: TraitA</code>ã€‚</li>\n<li>blanket implementation æ—¶çš„ Tï¼Œæ¯”å¦‚ <code>impl&lt;T: TraitB&gt; TraitA for T {}</code>ã€‚</li>\n<li>å‡½æ•°é‡Œçš„ T å‚æ•°ï¼Œæ¯”å¦‚ <code>fn doit&lt;T&gt;(a: T) {}</code>ã€‚</li>\n</ul><p>ä½ è¦æ³¨æ„åŒºåˆ†ä¸åŒä½ç½®çš„ Tã€‚å®ƒçš„åŸºç¡€æ„ä¹‰éƒ½æ˜¯ç±»å‹å‚æ•°ï¼Œä½†æ˜¯æ”¾åœ¨ä¸åŒçš„ä½ç½®å…¶ä¾§é‡çš„æ„ä¹‰æœ‰æ‰€ä¸åŒã€‚</p><ul>\n<li><code>T: TraitA</code> é‡Œçš„Tè¡¨ç¤ºç±»å‹å‚æ•°ï¼Œå¼ºè°ƒâ€œå‚æ•°â€ï¼Œä½¿ç”¨TraitAæ¥å‰Šå‡å®ƒçš„ç±»å‹ç©ºé—´ã€‚</li>\n<li><code>impl&lt;T: TraitB&gt; TraitA for T {}</code> æœ«å°¾çš„Tæ›´å¼ºè°ƒç±»å‹å‚æ•°çš„â€œç±»å‹â€éƒ¨åˆ†ï¼Œä¸ºæŸäº›ç±»å‹å®ç° TraitAã€‚</li>\n<li><code>doit&lt;T&gt;(a: T) {}</code> ä¸­ç¬¬äºŒä¸ªTè¡¨ç¤ºæŸç§ç±»å‹ï¼Œæ›´å¼ºè°ƒç±»å‹å‚æ•°çš„â€œç±»å‹â€éƒ¨åˆ†ã€‚</li>\n</ul><p>è¿™èŠ‚è¯¾æˆ‘ä»¬è¦è®²çš„æ˜¯å¦å¤–ä¸€ä¸ªä¸œè¥¿ï¼Œå®ƒé‡Œé¢ä¹Ÿå¸¦Tå‚æ•°ã€‚æˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹ï¼Œå®ƒä¸ä¹‹å‰è¿™å‡ ç§å½¢å¼æœ‰ä»€ä¹ˆä¸åŒã€‚</p><h2>traitä¸Šå¸¦ç±»å‹å‚æ•°</h2><p>traitä¸Šä¹Ÿæ˜¯å¯ä»¥å¸¦ç±»å‹å‚æ•°çš„ï¼Œå½¢å¼åƒä¸‹é¢è¿™æ ·ï¼š</p><pre><code class=\"language-plain\">trait TraitA&lt;T&gt; {}\n</code></pre><p>è¡¨ç¤ºè¿™ä¸ªtraité‡Œé¢çš„å‡½æ•°æˆ–æ–¹æ³•ï¼Œå¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ªç±»å‹å‚æ•°ã€‚åœ¨å®šä¹‰traitçš„æ—¶å€™ï¼Œè¿˜æ²¡ç¡®å®šè¿™ä¸ªç±»å‹å‚æ•°çš„å…·ä½“ç±»å‹ã€‚è¦ç­‰åˆ°implç”šè‡³ä½¿ç”¨ç±»å‹æ–¹æ³•çš„æ—¶å€™ï¼Œæ‰ä¼šå…·ä½“åŒ–è¿™ä¸ªTçš„å…·ä½“ç±»å‹ã€‚</p><!-- [[[read_end]]] --><p>æ³¨æ„ï¼Œè¿™ä¸ªæ—¶å€™ <code>TraitA&lt;T&gt;</code> æ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œè¡¨ç¤ºä¸€ä¸ªtraitã€‚æ¯”å¦‚  <code>TraitA&lt;u8&gt;</code> å’Œ <code>TraitA&lt;u32&gt;</code> å°±æ˜¯ä¸¤ä¸ªä¸åŒçš„traitï¼Œè¿™é‡Œå•ç‹¬æŠŠTraitAæ‹¿å‡ºæ¥è¯´æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚</p><p>å®ç°æ—¶éœ€è¦åœ¨implåé¢å…ˆå®šä¹‰ç±»å‹å‚æ•°ï¼Œæ¯”å¦‚ï¼š</p><pre><code class=\"language-plain\">impl&lt;T&gt; TraitA&lt;T&gt; for Atype {}\n</code></pre><p>å½“ç„¶ä¹Ÿå¯ä»¥åœ¨å¯¹ç±»å‹å®ç°æ—¶ï¼Œå°†Tå‚æ•°å…·ä½“åŒ–ï¼Œæ¯”å¦‚ï¼š</p><pre><code class=\"language-plain\">impl TraitA&lt;u8&gt; for Atype {}\n</code></pre><p>è€Œå¦‚æœè¢«å®ç°çš„ç±»å‹ä¸Šè‡ªèº«ä¹Ÿå¸¦ç±»å‹å‚æ•°ï¼Œé‚£ä¹ˆæƒ…å†µä¼šæ›´å¤æ‚ã€‚</p><pre><code class=\"language-plain\">trait TraitA&lt;T&gt; {}\nstruct Atype&lt;U&gt; {\n&nbsp; &nbsp; a: U,\n}\nimpl&lt;T, U&gt; TraitA&lt;T&gt; for Atype&lt;U&gt; {}\n</code></pre><p>è¿™äº›ç±»å‹å‚æ•°éƒ½æ˜¯å¯ä»¥åœ¨implæ—¶è¢«çº¦æŸçš„ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š</p><pre><code class=\"language-plain\">use std::fmt::Debug;\n\ntrait TraitA&lt;T&gt; {}\nstruct Atype&lt;U&gt; {\n    a: U,\n}\nimpl&lt;T, U&gt; TraitA&lt;T&gt; for Atype&lt;U&gt; \nwhere\n    T: Debug,      // åœ¨ impl æ—¶æ·»åŠ äº†çº¦æŸ\n    U: PartialEq,  // åœ¨ impl æ—¶æ·»åŠ äº†çº¦æŸ\n{}\n</code></pre><p><span class=\"reference\">æ³¨ï¼šä»¥ä¸Šä»£ç éƒ½æ˜¯å¯ä»¥æ”¾åˆ°playgroundä¸­ç¼–è¯‘é€šè¿‡çš„ã€‚</span></p><h3>impl ç¤ºä¾‹</h3><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå…·ä½“çš„å®ä¾‹ä½“ä¼šä¸€ä¸‹å¸¦ç±»å‹å‚æ•°çš„traitçš„å¨åŠ›ã€‚</p><p>æˆ‘ä»¬ç°åœ¨è¦å®ç°ä¸€ä¸ªæ¨¡å‹ã€‚</p><ol>\n<li>å¹³é¢ä¸Šçš„ä¸€ä¸ªç‚¹ä¸å¹³é¢ä¸Šçš„å¦ä¸€ä¸ªç‚¹ç›¸åŠ ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„ç‚¹ã€‚ç®—æ³•æ˜¯ä¸¤ä¸ªç‚¹çš„xåˆ†é‡å’Œyåˆ†é‡åˆ†åˆ«ç›¸åŠ ã€‚</li>\n<li>å¹³é¢ä¸Šçš„ä¸€ä¸ªç‚¹åŠ ä¸€ä¸ªæ•´æ•°i32ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„ç‚¹ã€‚ç®—æ³•æ˜¯åˆ†åˆ«åœ¨xåˆ†é‡å’Œyåˆ†é‡ä¸Šé¢åŠ è¿™ä¸ªi32å‚æ•°ã€‚</li>\n</ol><p><span class=\"reference\">æœ¬ç¤ºä¾‹å€Ÿé‰´äº†ï¼š<a href=\"https://github.com/pretzelhammer/rust-blog/blob/master/posts/tour-of-rusts-standard-library-traits.md#generic-types-vs-associated-types\">https://github.com/pretzelhammer/rust-blog/blob/master/posts/tour-of-rusts-standard-library-traits.md#generic-types-vs-associated-types</a></span></p><p>ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">// å®šä¹‰ä¸€ä¸ªå¸¦ç±»å‹å‚æ•°çš„trait\ntrait Add&lt;T&gt; {\n    type Output;\n    fn add(self, rhs: T) -&gt; Self::Output;\n}\n\nstruct Point {\n    x: i32,\n    y: i32,\n}\n\n// ä¸º Point å®ç° Add&lt;Point&gt; è¿™ä¸ª trait\nimpl Add&lt;Point&gt; for Point {\n    type Output = Self;\n    fn add(self, rhs: Point) -&gt; Self::Output {\n        Point {\n            x: self.x + rhs.x,\n            y: self.y + rhs.y,\n        }\n    }\n}\n\n// ä¸º Point å®ç° Add&lt;i32&gt; è¿™ä¸ª trait\nimpl Add&lt;i32&gt; for Point { \n    type Output = Self;\n    fn add(self, rhs: i32) -&gt; Self::Output {\n        Point {\n            x: self.x + rhs,\n            y: self.y + rhs,\n        }\n    }\n}\n\nfn main() {\n    let p1 = Point { x: 1, y: 1 };\n    let p2 = Point { x: 2, y: 2 };\n    let p3 = p1.add(p2);  // ä¸¤ä¸ªPointå®ä¾‹ç›¸åŠ \n    assert_eq!(p3.x, 3);\n    assert_eq!(p3.y, 3);\n    \n    let p1 = Point { x: 1, y: 1 };\n    let delta = 2;\n    let p3 = p1.add(delta);   // ä¸€ä¸ªPointå®ä¾‹åŠ ä¸€ä¸ªi32\n    assert_eq!(p3.x, 3);\n    assert_eq!(p3.y, 3);\n}\n</code></pre><p>æˆ‘ä»¬è¯¦ç»†è§£é‡Šä¸€ä¸‹è¿™ä¸ªç¤ºä¾‹ã€‚<code>Add&lt;T&gt;</code> è¿™ä¸ªtraitï¼Œå¸¦ä¸€ä¸ªç±»å‹å‚æ•°Tï¼Œè¿˜å¸¦ä¸€ä¸ªå…³è”ç±»å‹ Outputã€‚</p><p>å¯¹Pointç±»å‹ï¼Œæˆ‘ä»¬å®ç°äº†ä¸¤ä¸ªtraitï¼š<code>Add&lt;Point&gt;</code> å’Œ <code>Add&lt;i32&gt;</code>ã€‚æ³¨æ„è¿™å·²ç»æ˜¯ä¸¤ä¸ªä¸åŒçš„traitäº†ï¼Œæ‰€ä»¥èƒ½å¯¹åŒä¸€ä¸ªç±»å‹å®ç°ã€‚å‰é¢æˆ‘ä»¬åå¤å¼ºè°ƒè¿‡ï¼ŒåŒä¸€ä¸ªtraitåªèƒ½å¯¹ä¸€ä¸ªç±»å‹å®ç°ä¸€æ¬¡ã€‚</p><p>æ ¹æ®éœ€æ±‚ï¼Œè¿ç®—åçš„ç±»å‹ä¹Ÿæ˜¯Pointï¼Œæ‰€ä»¥çœ‹åˆ°ä¸¤ä¸ªtraitä¸­çš„å…³è”ç±»å‹éƒ½æ˜¯ Selfã€‚è¯·æ³¨æ„ä¸¤ä¸ªtraitä¸­å®ç°çš„ä¸åŒç®—æ³•ã€‚</p><p>é€šè¿‡è¿™ç§å½¢å¼ï¼Œæˆ‘ä»¬åœ¨åŒä¸€ä¸ªç±»å‹ä¸Šå®ç°äº†åŒåæ–¹æ³•ï¼ˆaddæ–¹æ³•ï¼‰å‚æ•°ç±»å‹çš„å¤šç§å½¢æ€ã€‚åœ¨è¿™é‡Œçœ‹èµ·æ¥å°±æ˜¯ï¼ŒPointå®ä¾‹çš„addæ–¹æ³•æ—¢å¯ä»¥æ¥æ”¶Pointå‚æ•°ï¼Œåˆå¯ä»¥æ¥æ”¶i32å‚æ•°ï¼ŒRustcå°åŠ©æ‰‹å¯ä»¥æ ¹æ®ä¸åŒçš„å‚æ•°ç±»å‹è‡ªåŠ¨æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•è°ƒç”¨ã€‚åœ¨Javaã€C++è¿™äº›è¯­è¨€ä¸­ï¼Œæœ‰è¯­è¨€å±‚é¢çš„å‡½æ•°é‡è½½ç‰¹æ€§æ¥æ”¯æŒè¿™ç§åŠŸèƒ½ï¼ŒRustä¸­è‡ªèº«å¹¶ä¸ç›´æ¥æ”¯æŒå‡½æ•°é‡è½½ç‰¹æ€§ï¼Œä½†æ˜¯å®ƒç”¨traitå°±è½»æ¾å®ç°äº†åŒæ ·çš„æ•ˆæœï¼Œè¿™æ˜¯ä¸€ç§å…¨æ–°çš„æ€è·¯ã€‚</p><h3>trait ç±»å‹å‚æ•°çš„é»˜è®¤å®ç°</h3><p>å®šä¹‰å¸¦ç±»å‹å‚æ•°çš„traitçš„æ—¶å€™ï¼Œå¯ä»¥ä¸ºç±»å‹å‚æ•°æŒ‡å®šä¸€ä¸ªé»˜è®¤ç±»å‹ï¼Œæ¯”å¦‚ <code>trait TraitA&lt;T = u64&gt; {}</code>ã€‚è¿™æ ·ä½¿ç”¨æ—¶ï¼Œ<code>impl TraitA for SomeType {}</code> å°±ç­‰ä»·äº <code>impl TraitA&lt;u64&gt; for SomeType {}</code>ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­ã€‚</p><pre><code class=\"language-plain\">// Selfå¯ä»¥ç”¨åœ¨é»˜è®¤ç±»å‹ä½ç½®ä¸Š\ntrait TraitA&lt;T = Self&gt; {\n&nbsp; &nbsp; fn func(t: T) {}\n}\n\n// è¿™ä¸ªé»˜è®¤ç±»å‹ä¸ºi32\ntrait TraitB&lt;T = i32&gt; {\n&nbsp; &nbsp; fn func2(t: T) {}\n}\n\nstruct SomeType;\n\n// è¿™é‡Œçœç•¥äº†ç±»å‹å‚æ•°ï¼Œæ‰€ä»¥è¿™é‡Œçš„Tä¸ºSelf\n// è¿›è€ŒTå°±æ˜¯SomeTypeæœ¬èº«\nimpl TraitA for SomeType {\n&nbsp; &nbsp; fn func(t: SomeType) {}\n}\n// è¿™é‡Œçœç•¥äº†ç±»å‹å‚æ•°ï¼Œä½¿ç”¨é»˜è®¤ç±»å‹i32\nimpl TraitB for SomeType {\n&nbsp; &nbsp; fn func2(t: i32) {}\n}\n// è¿™é‡Œä¸çœç•¥ç±»å‹å‚æ•°ï¼Œæ˜ç¡®æŒ‡å®šç±»å‹å‚æ•°ä¸ºString\nimpl TraitA&lt;String&gt; for SomeType {\n&nbsp; &nbsp; fn func(t: String) {}\n}\n// è¿™é‡Œä¸çœç•¥ç±»å‹å‚æ•°ï¼Œæ˜ç¡®æŒ‡å®šç±»å‹å‚æ•°ä¸ºString\nimpl TraitB&lt;String&gt; for SomeType {\n&nbsp; &nbsp; fn func2(t: String) {}\n}\n</code></pre><p>é»˜è®¤å‚æ•°ç»™è¡¨è¾¾ä¸Šå¸¦æ¥äº†ä¸€å®šç¨‹åº¦çš„ç®€æ´ï¼Œä½†æ˜¯å¢åŠ äº†åˆå­¦è€…è¯†åˆ«å’Œç†è§£ä¸Šçš„å›°éš¾ã€‚</p><p>ä½ è¿˜è®°å¾—ä¸Šä¸€èŠ‚è¯¾è®²å…³è”ç±»å‹æ—¶æˆ‘ä»¬æåˆ°è¿‡åœ¨ä½¿ç”¨çº¦æŸæ—¶å¯ä»¥å…·åŒ–å…³è”ç±»å‹ã€‚é‚£é‡Œä¹Ÿæ˜¯ç”¨çš„ï¼å·ã€‚æ¯”å¦‚ï¼š</p><pre><code class=\"language-plain\">trait TraitA {\n    type Item;\n}\n// è¿™é‡Œï¼Œå®šä¹‰ç»“æ„ä½“ç±»å‹æ—¶ï¼Œç”¨åˆ°äº†TraitAä½œä¸ºçº¦æŸ\nstruct Foo&lt;T: TraitA&lt;Item=String&gt;&gt; {\n    x: T\n}\n</code></pre><p>åˆçœ‹è¿™é‡Œå®¹æ˜“æ··æ·†ã€‚åŒºåˆ«åœ¨äºï¼Œ<strong>å…³è”ç±»å‹çš„å…·åŒ–æ˜¯åœ¨åº”ç”¨çº¦æŸæ—¶ï¼Œç±»å‹å‚æ•°çš„é»˜è®¤ç±»å‹æŒ‡å®šæ˜¯åœ¨å®šä¹‰traitæ—¶</strong>ï¼Œé€šè¿‡traitå‡ºç°çš„åœºæ™¯å¯ä»¥åŒºåˆ†å®ƒä»¬ã€‚</p><h3>traitä¸­çš„ç±»å‹å‚æ•°ä¸å…³è”ç±»å‹çš„åŒºåˆ«</h3><p>ç°åœ¨ä½ å¯èƒ½ä¼šæœ‰äº›ç–‘æƒ‘ï¼štraitä¸Šçš„ç±»å‹å‚æ•°å’Œå…³è”ç±»å‹éƒ½å…·æœ‰å»¶è¿Ÿå…·åŒ–çš„ç‰¹ç‚¹ï¼Œé‚£ä¹ˆå®ƒä»¬çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸ºä»€ä¹ˆè¦è®¾è®¡ä¸¤ç§ä¸åŒçš„æœºåˆ¶å‘¢ï¼Ÿ</p><p>é¦–å…ˆè¦æ˜ç¡®çš„ä¸€ç‚¹æ˜¯ï¼ŒRustæœ¬èº«ä¹Ÿåœ¨æŒç»­æ¼”åŒ–è¿‡ç¨‹ä¸­ã€‚æœ‰äº›ç‰¹æ€§å…ˆå‡ºç°ï¼Œæœ‰äº›ç‰¹æ€§æ˜¯åå‡ºç°çš„ã€‚æœ€åæ¼”åŒ–å‡ºåŠŸèƒ½ç›¸ä¼¼ä½†æ˜¯ä¸å®Œå…¨ä¸€æ ·çš„ç‰¹æ€§æ˜¯å®Œå…¨æœ‰å¯èƒ½çš„ã€‚</p><p>å…·ä½“åˆ°è¿™ä¸¤è€…æ¥è¯´ï¼Œå®ƒä»¬ä¸»è¦æœ‰ä¸¤ç‚¹ä¸åŒã€‚</p><ol>\n<li>ç±»å‹å‚æ•°å¯ä»¥åœ¨impl ç±»å‹çš„æ—¶å€™å…·åŒ–ï¼Œä¹Ÿå¯ä»¥å»¶è¿Ÿåˆ°ä½¿ç”¨çš„æ—¶å€™å…·åŒ–ã€‚è€Œå…³è”ç±»å‹åœ¨è¢«implæ—¶å°±å¿…é¡»å…·åŒ–ã€‚</li>\n<li>ç”±äºç±»å‹å‚æ•°å’Œtraitåä¸€èµ·ç»„æˆäº†å®Œæ•´çš„traitåå­—ï¼Œä¸åŒçš„å…·åŒ–ç±»å‹ä¼šæ„æˆä¸åŒçš„traitï¼Œæ‰€ä»¥çœ‹èµ·æ¥åŒä¸€ä¸ªå®šä¹‰å¯ä»¥åœ¨ç›®æ ‡ç±»å‹ä¸Šå®ç°â€œå¤šæ¬¡â€ã€‚è€Œå…³è”ç±»å‹æ²¡æœ‰è¿™ä¸ªä½œç”¨ã€‚</li>\n</ol><p>ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«ä¸¾ä¾‹è¯´æ˜ã€‚</p><p>å¯¹äºç¬¬ä¸€ç‚¹ï¼Œè¯·çœ‹ä¸‹é¢çš„ç¤ºä¾‹ï¼š</p><pre><code class=\"language-plain\">use std::fmt::Debug;\n\ntrait TraitA&lt;T&gt; \nwhere\n    T: Debug,  // å®šä¹‰TraitA&lt;T&gt;çš„æ—¶å€™ï¼Œå¯¹Tä½œäº†çº¦æŸ\n{\n    fn play(&amp;self, _t: T) {}\n}\nstruct Atype;\n\nimpl&lt;T&gt; TraitA&lt;T&gt; for Atype\nwhere\n    T: Debug + PartialEq,  // å°†TraitA&lt;T&gt;å®ç°åˆ°ç±»å‹Atypeä¸Šæ—¶ï¼ŒåŠ å¼ºäº†çº¦æŸ\n{}\n\nfn main() {\n    let a = Atype;\n    a.play(10u32);  // åœ¨ä½¿ç”¨æ—¶ï¼Œé€šè¿‡å®ä¾‹æ–¹æ³•ä¼ å…¥çš„å‚æ•°ç±»å‹å…·åŒ–T\n}\n</code></pre><p>è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å‡ ä¸ªè¦ç‚¹ã€‚</p><ol>\n<li>å®šä¹‰å¸¦ç±»å‹å‚æ•°çš„traitæ—¶å¯ä»¥ç”¨whereè¡¨è¾¾ï¼Œå¹¶æä¾›çº¦æŸã€‚</li>\n<li>impl traitæ—¶å¯ä»¥å¯¹ç±»å‹å‚æ•°åŠ å¼ºçº¦æŸï¼Œå¯¹åº”ä¾‹å­ä¸­çš„ Debug + PartialEqã€‚</li>\n<li>impl traitæ—¶å¯ä»¥ä¸å…·åŒ–ç±»å‹å‚æ•°ã€‚</li>\n<li>å¯ä»¥åœ¨ä½¿ç”¨æ–¹æ³•æ—¶å…·åŒ–ç±»å‹å‚æ•°ã€‚ä¾‹å­é‡Œçš„ <code>a.play(10u32)</code>ï¼ŒæŠŠTå…·è±¡åŒ–æˆäº†u32ã€‚</li>\n</ol><p>å½“ç„¶ï¼Œåœ¨implçš„æ—¶å€™ä¹Ÿå¯ä»¥æŒ‡å®šæˆu32ç±»å‹ï¼Œæ‰€ä»¥ä¸‹é¢çš„ä»£ç ä¹Ÿå¯ä»¥ã€‚</p><pre><code class=\"language-plain\">use std::fmt::Debug;\n\ntrait TraitA&lt;T&gt; \nwhere\n    T: Debug,\n{\n    fn play(&amp;self, _t: T) {}\n}\nstruct Atype;\n\nimpl TraitA&lt;u32&gt; for Atype {} // è¿™é‡Œå…·åŒ–æˆäº† TraitA&lt;u32&gt;\n\nfn main() {\n    let a = Atype;\n    a.play(10u32);\n}\n</code></pre><p>ä½†æ˜¯è¿™æ ·å°±æ²¡å‰é¢é‚£ä¹ˆçµæ´»äº†ï¼Œæ¯”å¦‚ <code>a.play(10u64)</code> å°±ä¸è¡Œäº†ã€‚</p><p>å¯¹åº”çš„ï¼Œå¯¹å…³è”ç±»å‹æ¥è¯´ï¼Œå¦‚æœä½ åœ¨implæ—¶ä¸å¯¹å…¶å…·åŒ–ï¼Œå°±æ— æ³•ç¼–è¯‘é€šè¿‡ã€‚æ‰€ä»¥å¯¹äºç¬¬äºŒç‚¹ï¼Œæˆ‘ä¹Ÿç»™å‡ºä¸€ä¸ªä¾‹å­æ¥è§£é‡Šã€‚æˆ‘ä»¬æŠŠå‰é¢å¯¹Pointç±»å‹å®ç°Addçš„æ¨¡å‹å°è¯•ç”¨å…³è”ç±»å‹å®ç°ä¸€éã€‚</p><pre><code class=\"language-plain\">trait Add {\n    type ToAdd;    // å¤šå®šä¹‰ä¸€ä¸ªå…³è”ç±»å‹\n    type Output;\n    fn add(self, rhs: Self::ToAdd) -&gt; Self::Output;\n}\n\nstruct Point {\n    x: i32,\n    y: i32,\n}\n\nimpl Add for Point {\n    type ToAdd = Point;\n    type Output = Point;\n    fn add(self, rhs: Point) -&gt; Point {\n        Point {\n            x: self.x + rhs.x,\n            y: self.y + rhs.y,\n        }\n    }\n}\n\nimpl Add for Point { // è¿™é‡Œé‡å¤impläº†åŒä¸€ä¸ªtraitï¼Œæ— æ³•ç¼–è¯‘é€šè¿‡\n    type ToAdd = i32;\n    type Output = Point;\n    fn add(self, rhs: i32) -&gt; Point {\n        Point {\n            x: self.x + rhs,\n            y: self.y + rhs,\n        }\n    }\n}\n\nfn main() {\n    let p1 = Point { x: 1, y: 1 };\n    let p2 = Point { x: 2, y: 2 };\n    let p3 = p1.add(p2);\n    assert_eq!(p3.x, 3);\n    assert_eq!(p3.y, 3);\n    \n    let p1 = Point { x: 1, y: 1 };\n    let delta = 2;\n    let p3 = p1.add(delta); // è¿™å¥æ˜¯é”™çš„\n    assert_eq!(p3.x, 3);\n    assert_eq!(p3.y, 3);\n</code></pre><p>ç¼–è¯‘å™¨ä¼šæŠ±æ€¨ï¼š</p><pre><code class=\"language-plain\">error[E0119]: conflicting implementations of trait `Add` for type `Point`:\n  --&gt; src/main.rs:23:1\n   |\n12 | impl Add for Point {\n   | ------------------ first implementation here\n...\n23 | impl Add for Point {\n   | ^^^^^^^^^^^^^^^^^^ conflicting implementation for `Point`\n</code></pre><p>æç¤ºè¯´ï¼Œå¯¹Pointç±»å‹å®ç°äº†å¤šæ¬¡Addï¼Œå¯¼è‡´å†²çªã€‚ç¼–è¯‘ä¸é€šè¿‡ã€‚æ‰€ä»¥è¿™ä¸ªæ¨¡å‹ä»…ç”¨å…³è”ç±»å‹æ¥å®ç°ï¼Œæ˜¯å†™ä¸å‡ºæ¥çš„ã€‚</p><p>è¿™ä¹ˆçœ‹èµ·æ¥ï¼Œå¥½åƒå¸¦ç±»å‹å‚æ•°çš„traitåŠŸèƒ½æ›´å¼ºå¤§ï¼Œé‚£ç”¨è¿™ä¸ªä¸å°±å¤Ÿäº†ï¼Ÿä½†å…³è”ç±»å‹ä¹Ÿæœ‰å®ƒçš„ä¼˜ç‚¹ï¼Œæ¯”å¦‚å…³è”ç±»å‹æ²¡æœ‰ç±»å‹å‚æ•°ï¼Œä¸å­˜åœ¨å¤šå¼•å…¥äº†ä¸€ä¸ªå‚æ•°çš„é—®é¢˜ï¼Œè€Œç±»å‹å‚æ•°æ˜¯å…·æœ‰ä¼ æŸ“æ€§çš„ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸€ä¸ªè°ƒç”¨å±‚æ¬¡å¾ˆæ·±çš„ç³»ç»Ÿä¸­ï¼Œå¢åˆ ä¸€ä¸ªç±»å‹å‚æ•°å¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªé¡¹ç›®æ–‡ä»¶åˆ°å¤„éƒ½éœ€è¦æ”¹ï¼Œéå¸¸å¤´ç–¼ã€‚</p><p>è€Œå…³è”ç±»å‹æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚åœ¨ä¸€äº›åœºåˆä¸‹ï¼Œå…³è”ç±»å‹æ­£å¥½æ˜¯å‡å°‘ç±»å‹å‚æ•°æ•°é‡çš„ä¸€ç§æ–¹æ³•ã€‚æ›´ä¸è¦è¯´ï¼Œæœ‰æ—¶æ¨¡å‹æ¯”è¾ƒç®€å•ï¼Œä¸éœ€è¦å¤šæ€ç‰¹æ€§ï¼Œè¿™æ—¶ç”¨å…³è”ç±»å‹å°±æ›´ç®€æ´ï¼Œä»£ç å¯è¯»æ€§æ›´å¥½ã€‚</p><h2>trait object</h2><p>ä¸‹é¢æˆ‘ä»¬å¼€å§‹è®²trait objectã€‚</p><p>æˆ‘ä»¬ä»ä¸€ä¸ªå‡½æ•°è¦è¿”å›ä¸åŒçš„ç±»å‹è¯´èµ·ã€‚æ¯”å¦‚ä¸€ä¸ªå¸¸è§çš„éœ€æ±‚ï¼Œè¦åœ¨ä¸€ä¸ªRustå‡½æ•°ä¸­è¿”å›å¯èƒ½çš„å¤šç§ç±»å‹ï¼Œåº”è¯¥æ€ä¹ˆå†™ï¼Ÿ</p><p>å¦‚æœæˆ‘ä»¬å†™æˆè¿”å›å›ºå®šç±»å‹çš„å‡½æ•°ç­¾åï¼Œé‚£ä¹ˆå®ƒå°±åªèƒ½è¿”å›é‚£ä¸ªç±»å‹ã€‚æ¯”å¦‚ï¼š</p><pre><code class=\"language-plain\">struct Atype;\nstruct Btype;\nstruct Ctype;\nfn doit() -&gt; Atype {\n&nbsp; &nbsp; let a = Atype;\n&nbsp; &nbsp; a\n}\n</code></pre><p>ä½ æƒ³åˆ°çš„ç¬¬ä¸€ä¸ªåŠæ³•å¯èƒ½æ˜¯åˆ©ç”¨enumã€‚</p><pre><code class=\"language-plain\">struct Atype;\nstruct Btype;\nstruct Ctype;\n\nenum TotalType {\n  A(Atype),    // ç”¨å˜ä½“æŠŠç›®æ ‡ç±»å‹åŒ…èµ·æ¥\n  B(Btype),\n  C(Ctype),\n}\n\nfn doit(i: u32) -&gt; TotalType {  // è¿”å›æšä¸¾ç±»å‹\n  if i == 0 {\n    let a = Atype;\n    TotalType::A(a)    // åœ¨è¿™ä¸ªåˆ†æ”¯ä¸­è¿”å›å˜ä½“A\n  } else if i == 1 {\n    let b = Btype;\n    TotalType::B(b)    // åœ¨è¿™ä¸ªåˆ†æ”¯ä¸­è¿”å›å˜ä½“B\n  } else {\n    let c = Ctype;\n    TotalType::C(c)    // åœ¨è¿™ä¸ªåˆ†æ”¯ä¸­è¿”å›å˜ä½“C\n  }\n}\n</code></pre><p><strong>enum å¸¸ç”¨äºèšåˆç±»å‹</strong>ã€‚è¿™äº›ç±»å‹ä¹‹é—´å¯ä»¥æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œç”¨enumå¯ä»¥<strong>æ— è„‘+å¼ºè¡Œ</strong>æŠŠå®ƒä»¬æ‰åœ¨ä¸€èµ·ã€‚enumèšåˆç±»å‹æ˜¯ç¼–ç æ—¶å·²çŸ¥çš„ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨èšåˆå‰ï¼Œéœ€è¦çŸ¥é“å¾…èšåˆç±»å‹çš„è¾¹ç•Œï¼Œä¸€æ—¦å®šä¹‰å®Œæˆï¼Œä¹‹åè¿è¡Œæ—¶å°±ä¸èƒ½æ”¹åŠ¨äº†ï¼Œå®ƒæ˜¯<strong>å°é—­ç±»å‹é›†</strong>ã€‚</p><p>ç¬¬äºŒç§åŠæ³•æ˜¯åˆ©ç”¨ç±»å‹å‚æ•°ï¼Œæˆ‘ä»¬è¯•ç€å¼•å…¥ä¸€ä¸ªç±»å‹å‚æ•°ï¼Œæ”¹å†™ä¸€ä¸‹ã€‚</p><pre><code class=\"language-plain\">struct Atype;\nstruct Btype;\nstruct Ctype;\nfn doit&lt;T&gt;() -&gt; T {\n  let a = Atype;\n  a\n}\n</code></pre><p>å¾ˆæ˜æ˜¾ï¼Œè¿™ç§ä»£ç æ— æ³•é€šè¿‡ç¼–è¯‘ã€‚æç¤ºï¼š</p><pre><code class=\"language-plain\">error[E0308]: mismatched types\n --&gt; src/lib.rs:6:3\n  |\n4 | fn doit&lt;T&gt;() -&gt; T {\n  |         -       - expected `T` because of return type\n  |         |\n  |         this type parameter\n5 |   let a = Atype;\n6 |   a\n  |   ^ expected type parameter `T`, found `Atype`\n  |\n  = note: expected type parameter `T`\n                     found struct `Atype`\n</code></pre><p>å› ä¸ºè¿™é‡Œè¿™ä¸ªç±»å‹å‚æ•°Tæ˜¯åœ¨è¿™ä¸ªå‡½æ•°è°ƒç”¨æ—¶æŒ‡å®šï¼Œè€Œä¸æ˜¯åœ¨è¿™ä¸ªå‡½æ•°å®šä¹‰æ—¶æŒ‡å®šçš„ã€‚æ‰€ä»¥é’ˆå¯¹æˆ‘ä»¬çš„éœ€æ±‚ï¼Œä½ æ²¡æ³•åœ¨è¿™é‡Œç›´æ¥è¿”å›ä¸€ä¸ªå…·ä½“çš„ç±»å‹ä»£å…¥Tã€‚åªèƒ½å°è¯•ç”¨Tæ¥è¿”å›ï¼Œäºæ˜¯æˆ‘ä»¬æ”¹å‡ºç¬¬äºŒä¸ªç‰ˆæœ¬ã€‚</p><pre><code class=\"language-plain\">struct Atype;\nstruct Btype;\nstruct Ctype;\n\nimpl Atype {\n&nbsp; &nbsp; fn new() -&gt; Atype {\n&nbsp; &nbsp; &nbsp; &nbsp; Atype\n&nbsp; &nbsp; }\n}\n\nimpl Btype {\n&nbsp; &nbsp; fn new() -&gt; Btype {\n&nbsp; &nbsp; &nbsp; &nbsp; Btype\n&nbsp; &nbsp; }\n}\n\nimpl Ctype {\n&nbsp; &nbsp; fn new() -&gt; Ctype {\n&nbsp; &nbsp; &nbsp; &nbsp; Ctype\n&nbsp; &nbsp; }\n}\n\nfn doit&lt;T&gt;() -&gt; T {\n&nbsp; T::new()\n}\n</code></pre><p>ç¼–è¯‘è¿˜æ˜¯æŠ¥é”™ã€‚</p><pre><code class=\"language-plain\">error[E0599]: no function or associated item named `new` found for type parameter `T` in the current scope\n  --&gt; src/main.rs:24:6\n   |\n23 | fn doit&lt;T&gt;() -&gt; T {\n   |         - function or associated item `new` not found for this type parameter\n24 |   T::new()\n   |      ^^^ function or associated item not found in `T`\n\n</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒRustcå°åŠ©æ‰‹å¹¶ä¸çŸ¥é“æˆ‘ä»¬å®šä¹‰è¿™ä¸ªç±»å‹å‚æ•°Té‡Œé¢æœ‰newè¿™ä¸ªå…³è”å‡½æ•°ã€‚è”æƒ³åˆ°æˆ‘ä»¬å‰é¢å­¦è¿‡çš„ï¼Œå¯ä»¥ç”¨traitæ¥å®šä¹‰è¿™ä¸ªåè®®ï¼Œè®©Rustè®¤è¯†å®ƒã€‚</p><p>ç¬¬ä¸‰ä¸ªç‰ˆæœ¬ï¼š</p><pre><code class=\"language-plain\">struct Atype;\nstruct Btype;\nstruct Ctype;\n\ntrait TraitA {\n    fn new() -&gt; Self;    // TraitAä¸­å®šä¹‰äº†new()å‡½æ•°\n}\n\nimpl TraitA for Atype {\n    fn new() -&gt; Atype {\n        Atype\n    }\n}\n\nimpl TraitA for Btype {\n    fn new() -&gt; Btype {\n        Btype\n    }\n}\n\nimpl TraitA for Ctype {\n    fn new() -&gt; Ctype {\n        Ctype\n    }\n}\n\nfn doit&lt;T: TraitA&gt;() -&gt; T {\n  T::new()\n}\n\nfn main() {\n    let a: Atype = doit::&lt;Atype&gt;();\n    let b: Btype = doit::&lt;Btype&gt;();\n    let c: Ctype = doit::&lt;Ctype&gt;();\n}\n</code></pre><p>è¿™ä¸ªç‰ˆæœ¬é¡ºåˆ©é€šè¿‡ç¼–è¯‘ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬è®¤è¯†åˆ°äº†å¼•å…¥traitçš„å¿…è¦æ€§ï¼Œå°±æ˜¯è®©Rustcå°åŠ©æ‰‹çŸ¥é“æˆ‘ä»¬åœ¨åè®®å±‚é¢æœ‰ä¸€ä¸ªnew()å‡½æ•°ï¼Œä¸€æ—¦ç±»å‹å‚æ•°è¢«traitçº¦æŸåï¼Œå®ƒå°±å¯ä»¥å»traitä¸­å¯»æ‰¾åè®®å®šä¹‰çš„å‡½æ•°å’Œæ–¹æ³•ã€‚</p><p>ä¸ºäº†è§£å†³ä¸Šé¢é‚£ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬çœŸçš„æ˜¯è´¹äº†ä¸å°‘åŠ›æ°”ã€‚å®é™…ä¸Šï¼ŒRustæä¾›äº†æ›´ä¼˜é›…çš„æ–¹æ¡ˆæ¥è§£å†³è¿™ä¸ªéœ€æ±‚ã€‚Ruståˆ©ç”¨traitæä¾›äº†ä¸€ç§ç‰¹æ®Šè¯­æ³• impl traitï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹ç¤ºä¾‹ã€‚</p><pre><code class=\"language-plain\">struct Atype;\nstruct Btype;\nstruct Ctype;\n\ntrait TraitA {}\n\nimpl TraitA for Atype {}\nimpl TraitA for Btype {}\nimpl TraitA for Ctype {}\n\nfn doit() -&gt; impl TraitA {  // æ³¨æ„è¿™ä¸€è¡Œçš„å‡½æ•°è¿”å›ç±»å‹\n  let a = Atype;\n  a\n  // æˆ–\n  // let b = Btype;\n  // b\n  // æˆ–\n  // let c = Ctype;\n  // c\n}\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ç§è¡¨è¾¾éå¸¸ç®€æ´ï¼ŒåŒä¸€ä¸ªå‡½æ•°ç­¾åå¯ä»¥è¿”å›å¤šç§ä¸åŒçš„ç±»å‹ï¼Œå¹¶ä¸”åœ¨å‡½æ•°å®šä¹‰æ—¶å°±å¯ä»¥è¿”å›å…·ä½“çš„ç±»å‹çš„å®ä¾‹ã€‚æ›´é‡è¦çš„æ˜¯æ¶ˆé™¤äº†ç±»å‹å‚æ•°Tã€‚</p><p>ä¸Šè¿°ä»£ç å·²ç»å¾ˆæœ‰ç”¨äº†ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸å¤Ÿçµæ´»ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦ç”¨ifé€»è¾‘é€‰æ‹©ä¸åŒçš„åˆ†æ”¯è¿”å›ä¸åŒçš„ç±»å‹ï¼Œå°±ä¼šé‡åˆ°é—®é¢˜ã€‚</p><pre><code class=\"language-plain\">struct Atype;\nstruct Btype;\nstruct Ctype;\n\ntrait TraitA {}\n\nimpl TraitA for Atype {}\nimpl TraitA for Btype {}\nimpl TraitA for Ctype {}\n\nfn doit(i: u32) -&gt; impl TraitA {  \n  if i == 0 {\n    let a = Atype;\n    a                    // åœ¨è¿™ä¸ªåˆ†æ”¯ä¸­è¿”å›ç±»å‹a\n  } else if i == 1 {\n    let b = Btype;\n    b                    // åœ¨è¿™ä¸ªåˆ†æ”¯ä¸­è¿”å›ç±»å‹b\n  } else {\n    let c = Ctype;\n    c                    // åœ¨è¿™ä¸ªåˆ†æ”¯ä¸­è¿”å›ç±»å‹c\n  }\n}\n</code></pre><p>æç¤ºï¼š</p><pre><code class=\"language-plain\">error[E0308]: `if` and `else` have incompatible types\n  --&gt; src/lib.rs:22:5\n   |\n17 |     } else if i == 1 {\n   |  __________-\n18 | |     let b = Btype;\n19 | |     b\n   | |     - expected because of this\n20 | |   } else {\n21 | |     let c = Ctype;\n22 | |     c\n   | |     ^ expected `Btype`, found `Ctype`\n23 | |   }\n   | |___- `if` and `else` have incompatible types\n</code></pre><p>if else è¦æ±‚è¿”å›åŒä¸€ç§ç±»å‹ï¼ŒRustæ£€æŸ¥ç¡®å®ä¸¥æ ¼ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥é€šè¿‡åŠ returnè·³è¿‡ if else çš„é™åˆ¶ã€‚</p><pre><code class=\"language-plain\">struct Atype;\nstruct Btype;\nstruct Ctype;\n\ntrait TraitA {}\n\nimpl TraitA for Atype {}\nimpl TraitA for Btype {}\nimpl TraitA for Ctype {}\n\nfn doit(i: u32) -&gt; impl TraitA {\n  if i == 0 {\n    let a = Atype;\n    return a;          // è¿™é‡Œç”¨returnè¯­å¥ç›´æ¥ä»å‡½æ•°è¿”å›\n  } else if i == 1 {\n    let b = Btype;\n    return b;\n  } else {\n    let c = Ctype;\n    return c;\n  }\n}\n</code></pre><p>ä½†æ˜¯è¿˜æ˜¯æŠ¥é”™ã€‚</p><pre><code class=\"language-plain\">error[E0308]: mismatched types\n  --&gt; src/lib.rs:19:12\n   |\n13 | fn doit(i: u32) -&gt; impl TraitA {  // è¿™ä¸€è¡Œ\n   |                    ----------- expected `Atype` because of return type\n...\n19 |     return b\n   |            ^ expected `Atype`, found `Btype`\n\n</code></pre><p>å®ƒè¯´æœŸæœ›Atypeï¼Œå´å¾—åˆ°äº†Btypeã€‚è¿™ä¸ªæŠ¥é”™å…¶å®æœ‰ç‚¹å¥‡æ€ªï¼Œå®ƒä»¬ä¸æ˜¯éƒ½æ»¡è¶³ impl TraitA å—ï¼Ÿ</p><p>åŸæ¥é—®é¢˜åœ¨äºï¼Œimpl TraitA ä½œä¸ºå‡½æ•°è¿”å›å€¼è¿™ç§è¯­æ³•ï¼Œå…¶å®ä¹Ÿåªæ˜¯<strong>æŒ‡ä»£æŸä¸€ç§ç±»å‹</strong>è€Œå·²ï¼Œè€Œè¿™ç§ç±»å‹æ˜¯åœ¨å‡½æ•°ä½“ä¸­ç”±è¿”å›å€¼çš„ç±»å‹æ¥è‡ªåŠ¨æ¨å¯¼å‡ºæ¥çš„ã€‚ä¾‹å­ä¸­ï¼ŒRustcå°åŠ©æ‰‹é‡åˆ°Atypeè¿™ä¸ªåˆ†æ”¯æ—¶ï¼Œå°±å·²ç»ç¡®å®šäº†å‡½æ•°è¿”å›ç±»å‹ä¸ºAtypeï¼Œå› æ­¤å½“å®ƒåˆ†æåˆ°åé¢çš„Btypeåˆ†æ”¯æ—¶ï¼Œå°±å‘ç°ç±»å‹ä¸åŒ¹é…äº†ã€‚é—®é¢˜å°±åœ¨è¿™é‡Œã€‚ä½ å¯ä»¥å°†æ¡ä»¶åˆ†æ”¯é¡ºåºæ¢ä¸€ä¸‹ï¼Œçœ‹ä¸€ä¸‹æŠ¥é”™çš„æç¤ºï¼ŒåŠ æ·±å°è±¡ã€‚</p><p>é‚£æˆ‘ä»¬åº”è¯¥æ€ä¹ˆå¤„ç†è¿™ç§é—®é¢˜å‘¢ï¼Ÿ</p><p>å¥½åœ¨ï¼ŒRustè¿˜ç»™æˆ‘ä»¬æä¾›äº†è¿›ä¸€æ­¥çš„æªæ–½ï¼š<strong>trait object</strong>ã€‚å½¢å¼ä¸Šï¼Œå°±æ˜¯åœ¨traitåå‰åŠ  dyn å…³é”®å­—ä¿®é¥°ï¼Œåœ¨è¿™ä¸ªä¾‹å­é‡Œå°±æ˜¯ dyn TraitAã€‚<strong>dyn TraitName æœ¬èº«å°±æ˜¯ä¸€ç§ç±»å‹</strong>ï¼Œå®ƒå’Œ TraitName è¿™ä¸ª trait ç›¸å…³ï¼Œä½†æ˜¯å®ƒä»¬ä¸åŒï¼Œdyn TraitName æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç±»å‹ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨dyn TraitAæ”¹å†™ä¸Šé¢çš„ä»£ç ã€‚</p><pre><code class=\"language-plain\">struct Atype;\nstruct Btype;\nstruct Ctype;\n\ntrait TraitA {}\n\nimpl TraitA for Atype {}\nimpl TraitA for Btype {}\nimpl TraitA for Ctype {}\n\nfn doit(i: u32) -&gt; dyn TraitA { // æ³¨æ„è¿™é‡Œçš„è¿”å›ç±»å‹æ¢æˆäº† dyn TraitA\n&nbsp; if i == 0 {\n&nbsp; &nbsp; let a = Atype;\n&nbsp; &nbsp; return a\n&nbsp; } else if i == 1 {\n&nbsp; &nbsp; let b = Btype;\n&nbsp; &nbsp; return b\n&nbsp; } else {\n&nbsp; &nbsp; let c = Ctype;\n&nbsp; &nbsp; return c\n&nbsp; }\n}\n</code></pre><p>ä½†æ˜¯ç¼–è¯‘ä¼šæŠ¥é”™ã€‚</p><pre><code class=\"language-plain\">error[E0746]: return type cannot have an unboxed trait object\n  --&gt; src/lib.rs:13:20\n   |\n13 | fn doit(i: u32) -&gt; dyn TraitA {\n   |                    ^^^^^^^^^^ doesn't have a size known at compile-time\n   |\nhelp: return an `impl Trait` instead of a `dyn Trait`, if all returned values are the same type\n   |\n13 | fn doit(i: u32) -&gt; impl TraitA {\n   |                    ~~~~\nhelp: box the return type, and wrap all of the returned values in `Box::new`\n   |\n13 ~ fn doit(i: u32) -&gt; Box&lt;dyn TraitA&gt; {\n14 |   if i == 0 {\n15 |     let a = Atype;\n16 ~     return Box::new(a)\n17 |   } else if i == 1 {\n18 |     let b = Btype;\n19 ~     return Box::new(b)\n20 |   } else {\n21 |     let c = Ctype;\n22 ~     return Box::new(c)\n</code></pre><p>è¿™æ®µæç¤ºå¾ˆç»å…¸ï¼Œæˆ‘ä»¬æ¥ä»”ç»†é˜…è¯»ä¸€ä¸‹ã€‚</p><p>å®ƒè¯´ dyn TraitA ç¼–è¯‘æ—¶å°ºå¯¸æœªçŸ¥ã€‚dyn traitç¡®å®ä¸æ˜¯ä¸€ä¸ªå›ºå®šå°ºå¯¸ç±»å‹ã€‚ç„¶åç»™å‡ºäº†ç¬¬ä¸€ä¸ªå»ºè®®ï¼šä½ å¯ä»¥ç”¨ impl TraitA æ¥è§£å†³ï¼Œå‰ææ˜¯æ‰€æœ‰åˆ†æ”¯è¿”å›åŒä¸€ç±»å‹ã€‚éšåç»™å‡ºäº†ç¬¬äºŒä¸ªå»ºè®®ï¼Œä½ å¯ä»¥ç”¨BoxæŠŠdyn TraitAåŒ…èµ·æ¥ã€‚</p><p><span class=\"reference\">ï¼ˆğŸ‘¨â€ğŸ«ï¼šæœ‰æ²¡æœ‰ChatGPTçš„å³æ—¶æ„Ÿï¼Œèªæ˜å¾—ä¸å¤ªåƒä¸€ä¸ªç¼–è¯‘å™¨ã€‚ï¼‰</span></p><p>ç¬¬ä¸€ä¸ªå»ºè®®æˆ‘ä»¬å·²ç»è¯•è¿‡äº†ï¼ŒPassï¼Œæˆ‘ä»¬æŒ‰ç…§ç¬¬äºŒç§å»ºè®®æ”¹ä¸€ä¸‹è¯•è¯•ã€‚</p><pre><code class=\"language-plain\">struct Atype;\nstruct Btype;\nstruct Ctype;\n\ntrait TraitA {}\n\nimpl TraitA for Atype {}\nimpl TraitA for Btype {}\nimpl TraitA for Ctype {}\n\nfn doit(i: u32) -&gt; Box&lt;dyn TraitA&gt; {\n&nbsp; &nbsp; if i == 0 {\n&nbsp; &nbsp; &nbsp; &nbsp; let a = Atype;\n&nbsp; &nbsp; &nbsp; &nbsp; Box::new(a)\n&nbsp; &nbsp; } else if i == 1 {\n&nbsp; &nbsp; &nbsp; &nbsp; let b = Btype;\n&nbsp; &nbsp; &nbsp; &nbsp; Box::new(b)\n&nbsp; &nbsp; } else {\n&nbsp; &nbsp; &nbsp; &nbsp; let c = Ctype;\n&nbsp; &nbsp; &nbsp; &nbsp; Box::new(c)\n&nbsp; &nbsp; }\n}\n</code></pre><p>è¿™ä¸‹å®Œç¾äº†ï¼Œç¼–è¯‘é€šè¿‡ï¼Œè¾¾æˆç›®æ ‡ï¼Œæˆ‘ä»¬æˆåŠŸåœ°å°†ä¸åŒç±»å‹çš„å®ä¾‹åœ¨åŒä¸€ä¸ªå‡½æ•°ä¸­è¿”å›äº†ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ä¸œè¥¿ <code>Box&lt;T&gt;</code>ã€‚<code>Box&lt;T&gt;</code> çš„ä½œç”¨æ˜¯å¯ä»¥ä¿è¯è·å¾—é‡Œé¢å€¼çš„æ‰€æœ‰æƒï¼Œå¿…è¦çš„æ—¶å€™ä¼šè¿›è¡Œå†…å­˜çš„å¤åˆ¶ï¼Œæ¯”å¦‚æŠŠæ ˆä¸Šçš„å€¼å¤åˆ¶åˆ°å †ä¸­å»ã€‚ä¸€æ—¦å€¼åˆ°äº†å †ä¸­ï¼Œå°±å¾ˆå®¹æ˜“æŒæ¡åˆ°å®ƒçš„æ‰€æœ‰æƒã€‚</p><p>å…·ä½“åˆ°è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå› ä¸ºaã€bã€céƒ½æ˜¯å‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡ï¼Œè¿™é‡Œå¦‚æœè¿”å›å¼•ç”¨ <code>&amp;dyn TraitA</code> çš„è¯æ˜¯ä¸‡ä¸‡ä¸èƒ½çš„ï¼Œå› ä¸ºè¿åäº†æ‰€æœ‰æƒè§„åˆ™ã€‚è€Œ <code>Box&lt;T&gt;</code> å°±èƒ½æ»¡è¶³è¿™é‡Œçš„è¦æ±‚ã€‚åç»­æˆ‘ä»¬åœ¨æ™ºèƒ½æŒ‡é’ˆä¸€è®²ä¸­ä¼šç»§ç»­è®²è§£ <code>Box&lt;T&gt;</code>ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å…ˆæš‚åœï¼Œæˆ‘å¸Œæœ›ä½ å¯ä»¥ç”¨ä¸€ç‚¹æ—¶é—´æ¥å›é¡¾ä¸€ä¸‹æ•´ä¸ªæ¨å¯¼è¿‡ç¨‹ï¼Œè¿™æ¬¡ä»¤äººå°è±¡æ·±åˆ»çš„ç±»å‹â€œä½“æ“â€å€¼å¾—æˆ‘ä»¬å¤šå“å‘³å‡ æ¬¡ã€‚</p><h3>åˆ©ç”¨trait objectä¼ å‚</h3><p>impl trait å’Œ dyn trait ä¹Ÿå¯ä»¥ç”¨äºå‡½æ•°ä¼ å‚ã€‚</p><p>impl traitçš„ç¤ºä¾‹ï¼š</p><pre><code class=\"language-plain\">struct Atype;\nstruct Btype;\nstruct Ctype;\n\ntrait TraitA {}\n\nimpl TraitA for Atype {}\nimpl TraitA for Btype {}\nimpl TraitA for Ctype {}\n\nfn doit(x: impl TraitA) {}\n// ç­‰ä»·äº\n// fn doit&lt;T: TraitA&gt;(x: T) {}\n\nfn main() {\n    let a = Atype;\n    doit(a);\n    let b = Btype;\n    doit(b);\n    let c = Ctype;\n    doit(c);\n}\n</code></pre><p>dyn traitçš„ç¤ºä¾‹ï¼š</p><pre><code class=\"language-plain\">struct Atype;\nstruct Btype;\nstruct Ctype;\n\ntrait TraitA {}\n\nimpl TraitA for Atype {}\nimpl TraitA for Btype {}\nimpl TraitA for Ctype {}\n\nfn doit(x: &amp;dyn TraitA) {}  // æ³¨æ„è¿™é‡Œç”¨äº†å¼•ç”¨å½¢å¼ &amp;dyn TraitA\n\nfn main() {\n    let a = Atype;\n    doit(&amp;a);\n    let b = Btype;\n    doit(&amp;b);\n    let c = Ctype;\n    doit(&amp;c);\n}\n</code></pre><p>ä¸¤ç§éƒ½å¯ä»¥ã€‚é‚£ä¹ˆå®ƒä»¬çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>impl traitç”¨çš„æ˜¯ç¼–è¯‘å™¨é™æ€å±•å¼€ï¼Œä¹Ÿå°±æ˜¯ç¼–è¯‘æ—¶å…·åŒ–ï¼ˆå•æ€åŒ–ï¼‰ã€‚ä¸Šé¢é‚£ä¸ªimpl traitç¤ºä¾‹å±•å¼€åç±»ä¼¼äºä¸‹é¢è¿™ä¸ªæ ·å­ã€‚</p><pre><code class=\"language-plain\">struct Atype;\nstruct Btype;\nstruct Ctype;\n\ntrait TraitA {}\n\nimpl TraitA for Atype {}\nimpl TraitA for Btype {}\nimpl TraitA for Ctype {}\n\nfn doit_a(x: Atype) {}\nfn doit_b(x: Btype) {}\nfn doit_c(x: Ctype) {}\n\nfn main() {\n    let a = Atype;\n    doit_a(a);\n    let b = Btype;\n    doit_b(b);\n    let c = Ctype;\n    doit_c(c);\n}\n</code></pre><p>è€Œ dyn traitçš„ç‰ˆæœ¬ä¸ä¼šåœ¨ç¼–è¯‘æœŸé—´åšä»»ä½•å±•å¼€ï¼Œdyn TraitA è‡ªå·±å°±æ˜¯ä¸€ä¸ªç±»å‹ï¼Œè¿™ä¸ªç±»å‹ç›¸å½“äºä¸€ä¸ªä»£ç†ç±»å‹ï¼Œç”¨äºåœ¨è¿è¡Œæ—¶ä»£ç†ç›¸å…³ç±»å‹åŠè°ƒç”¨å¯¹åº”æ–¹æ³•ã€‚æ—¢ç„¶æ˜¯ä»£ç†ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨æ–¹æ³•çš„æ—¶å€™éœ€è¦å¤šè·³è½¬ä¸€æ¬¡ï¼Œä»æ€§èƒ½ä¸Šæ¥è¯´ï¼Œå½“ç„¶è¦æ¯”åœ¨ç¼–è¯‘æœŸç›´æ¥å±•å¼€ä¸€æ­¥åˆ°ä½è°ƒç”¨å¯¹åº”å‡½æ•°è¦æ…¢ä¸€ç‚¹ã€‚</p><p>é™æ€å±•å¼€ä¹Ÿæœ‰é—®é¢˜ï¼Œå°±æ˜¯ä¼šä½¿ç¼–è¯‘å‡ºæ¥çš„å†…å®¹ä½“ç§¯å¢å¤§ï¼Œè€Œdyn traitå°±ä¸ä¼šã€‚æ‰€ä»¥å®ƒä»¬å„æœ‰åˆ©å¼Šï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚è§†æƒ…å†µé€‰æ‹©ã€‚å¦å¤–ï¼Œ<strong>impl traitå’Œdyn traitéƒ½æ˜¯æ¶ˆé™¤ç±»å‹å‚æ•°çš„åŠæ³•</strong>ã€‚</p><p>é‚£å®ƒä»¬å’Œenumç›¸æ¯”å‘¢ï¼Ÿ</p><p>enumæ˜¯å°é—­ç±»å‹é›†ï¼Œå¯ä»¥æŠŠæ²¡æœ‰ä»»ä½•å…³ç³»çš„ä»»æ„ç±»å‹åŒ…è£¹æˆä¸€ä¸ªç»Ÿä¸€çš„å•ä¸€ç±»å‹ã€‚åç»­çš„ä»»ä½•å˜åŠ¨ï¼Œéƒ½éœ€è¦æ”¹è¿™ä¸ªç»Ÿä¸€ç±»å‹ï¼Œä»¥åŠåŸºäºè¿™ä¸ªenumçš„æ¨¡å¼åŒ¹é…ç­‰ç›¸å…³ä»£ç ã€‚è€Œimpl traitå’Œdyn traitæ˜¯å¼€æ”¾ç±»å‹é›†ã€‚åªè¦å¯¹æ–°çš„ç±»å‹å®ç°traitï¼Œå°±å¯ä»¥ä¼ å…¥ä½¿ç”¨äº†impl traitæˆ–dyn traitçš„å‡½æ•°ï¼Œå…¶å‡½æ•°ç­¾åä¸ç”¨å˜ã€‚</p><p>ä¸Šè¿°åŒºåˆ«å¯¹äºåº“çš„æä¾›è€…éå¸¸é‡è¦ã€‚å¦‚æœä½ æä¾›äº†ä¸€ä¸ªåº“ï¼Œé‡Œé¢çš„å¤šç±»å‹ä½¿ç”¨çš„enumåŒ…è£…ï¼Œé‚£ä¹ˆåº“çš„ä½¿ç”¨è€…æ²¡åŠæ³•å¯¹ä½ çš„enumè¿›è¡Œæ‰©å±•ã€‚å› ä¸ºä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¸é¼“åŠ±å»ä¿®æ”¹åº“é‡Œé¢çš„ä»£ç ã€‚è€Œç”¨ impl trait æˆ– dyn trait å°±å¯ä»¥è®©æ¥å£å…·æœ‰å¯æ‰©å±•æ€§ã€‚ç”¨æˆ·åªéœ€è¦ç»™ä»–ä»¬çš„ç±»å‹å®ç°ä½ çš„åº“æä¾›çš„traitï¼Œå°±å¯ä»¥ä»£å…¥åº“çš„æ¥å£ä½¿ç”¨äº†ã€‚</p><p>è€Œå¯¹äºimpl traitæ¥è¯´ï¼Œå®ƒç›®å‰åªèƒ½ç”¨äºå°‘æ•°å‡ ä¸ªåœ°æ–¹ã€‚ä¸€ä¸ªæ˜¯å‡½æ•°å‚æ•°ï¼Œå¦ä¸€ä¸ªæ˜¯å‡½æ•°è¿”å›å€¼ã€‚å…¶ä»–çš„é™æ€å±•å¼€åœºæ™¯å°±å¾—ç”¨ç±»å‹å‚æ•°å½¢å¼äº†ã€‚</p><p>dyn traitæœ¬èº«æ˜¯ä¸€ç§éå›ºå®šå°ºå¯¸ç±»å‹ï¼Œè¿™å°±æ³¨å®šäº†ç›¸æ¯”äº impl trait å®ƒèƒ½åº”ç”¨äºæ›´å¤šåœºåˆï¼Œæ¯”å¦‚åˆ©ç”¨trait objæŠŠä¸åŒçš„ç±»å‹è£…è¿›é›†åˆé‡Œã€‚</p><h3>åˆ©ç”¨trait objå°†ä¸åŒçš„ç±»å‹è£…è¿›é›†åˆé‡Œ</h3><p>æˆ‘ä»¬çœ‹ä¸‹é¢çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬æƒ³æŠŠä¸‰ç§ç±»å‹è£…è¿›ä¸€ä¸ªVecé‡Œé¢ã€‚</p><pre><code class=\"language-plain\">struct Atype;\nstruct Btype;\nstruct Ctype;\n\ntrait TraitA {}\n\nimpl TraitA for Atype {}\nimpl TraitA for Btype {}\nimpl TraitA for Ctype {}\n\nfn main() {\n    let a = Atype;\n    let b = Btype;\n    let c = Ctype;\n    \n    let v = vec![a, b, c];\n}\n</code></pre><p>æŠ¥é”™ï¼š</p><pre><code class=\"language-plain\">error[E0308]: mismatched types\n  --&gt; src/main.rs:19:21\n   |\n19 |     let v = vec![a, b, c];\n   |                     ^ expected `Atype`, found `Btype`\n</code></pre><p>å› ä¸ºVecä¸­è¦æ±‚æ¯ä¸€ä¸ªå…ƒç´ æ˜¯åŒä¸€ç§ç±»å‹ï¼Œä¸èƒ½å°†ä¸åŒçš„ç±»å‹å®ä¾‹æ”¾å…¥åŒä¸€ä¸ªVecã€‚è€Œåˆ©ç”¨trait objectï¼Œæˆ‘ä»¬å¯ä»¥â€œç»•â€è¿‡è¿™ä¸ªé™åˆ¶ã€‚</p><p>è¯·çœ‹ç¤ºä¾‹ï¼š</p><pre><code class=\"language-plain\">struct Atype;\nstruct Btype;\nstruct Ctype;\n\ntrait TraitA {}\n\nimpl TraitA for Atype {}\nimpl TraitA for Btype {}\nimpl TraitA for Ctype {}\n\nfn main() {\n    let a = Atype;\n    let b = Btype;\n    let c = Ctype;\n    let v: Vec&lt;&amp;dyn TraitA&gt; = vec![&amp;a, &amp;b, &amp;c];\n}\n</code></pre><p>æˆåŠŸäº†ï¼Œä¸åŒç±»å‹çš„å®ä¾‹ï¼ˆå®é™…æ˜¯å®ä¾‹çš„å¼•ç”¨ï¼‰ç«Ÿç„¶è¢«æ”¾è¿›äº†åŒä¸€ä¸ªVecä¸­ï¼Œå¼ºå¤§ï¼ä½ å¯ä»¥è‡ªå·±å°è¯•ä¸€ä¸‹ï¼Œå°†ä¸åŒç±»å‹çš„å®ä¾‹æ”¾å…¥HashMapä¸­ã€‚</p><p>æ—¢ç„¶trait objectè¿™ä¹ˆå¥½ç”¨ï¼Œé‚£æ˜¯ä¸æ˜¯å¯ä»¥éšä¾¿ä½¿ç”¨å‘¢ï¼Ÿä¸æ˜¯çš„ã€‚é™¤äº†å‰é¢æåˆ°çš„æ€§èƒ½æŸå¤±ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¸æ˜¯æ‰€æœ‰çš„traitéƒ½å¯ä»¥åšdynåŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸æ˜¯æ‰€æœ‰çš„traitéƒ½èƒ½è½¬æˆtrait objectä½¿ç”¨ã€‚</p><h3>å“ªäº›traitèƒ½ç”¨ä½œtrait objectï¼Ÿ</h3><p>åªæœ‰æ»¡è¶³å¯¹è±¡å®‰å…¨ï¼ˆobject safetyï¼‰çš„traitæ‰èƒ½è¢«ç”¨ä½œtrait objectã€‚Rustå‚è€ƒæ‰‹å†Œä¸Šæœ‰å…³äº <a href=\"https://doc.rust-lang.org/beta/reference/items/traits.html?highlight=object#object-safety\">object safety</a> çš„è¯¦ç»†è§„åˆ™ï¼Œæ¯”è¾ƒå¤æ‚ã€‚è¿™é‡Œæˆ‘ä»¬äº†è§£å¸¸ç”¨çš„æ¨¡å¼å°±è¡Œã€‚</p><p>å®‰å…¨çš„trait objectï¼š</p><pre><code class=\"language-plain\">trait TraitA {\n    fn foo(&amp;self) {}\n    fn foo_mut(&amp;mut self) {}\n    fn foo_box(self: Box&lt;Self&gt;) {}\n}\n</code></pre><p>ä¸å®‰å…¨çš„trait objectï¼š</p><pre><code class=\"language-plain\">trait NotObjectSafe {\n    const CONST: i32 = 1;  // ä¸èƒ½åŒ…å«å…³è”å¸¸é‡\n\n    fn foo() {}  // ä¸èƒ½åŒ…å«è¿™æ ·çš„å…³è”å‡½æ•°\n    fn selfin(self); // ä¸èƒ½å°†Selfæ‰€æœ‰æƒä¼ å…¥\n    fn returns(&amp;self) -&gt; Self; // ä¸èƒ½è¿”å›Self\n    fn typed&lt;T&gt;(&amp;self, x: T) {} // æ–¹æ³•ä¸­ä¸èƒ½æœ‰ç±»å‹å‚æ•°\n}\n</code></pre><p>è§„åˆ™ç¡®å®æ¯”è¾ƒå¤æ‚ï¼Œä½ å¯ä»¥ç®€å•è®°ä½å‡ ç§åœºæ™¯ã€‚</p><ol>\n<li>ä¸è¦åœ¨traité‡Œé¢å®šä¹‰æ„é€ å‡½æ•°ï¼Œæ¯”å¦‚newè¿™ç§è¿”å›Selfçš„å…³è”å‡½æ•°ã€‚ä½ å¯ä»¥å‘ç°ï¼Œç¡®å®åœ¨æ•´ä¸ªRustç”Ÿæ€ä¸­éƒ½æ²¡æœ‰å°†æ„é€ å‡½æ•°å®šä¹‰åœ¨traitä¸­çš„ä¹ æƒ¯ã€‚</li>\n<li>traité‡Œé¢å°½é‡å®šä¹‰ä¼ å¼•ç”¨ &amp;self æˆ– &amp;mut selfçš„æ–¹æ³•ï¼Œè€Œä¸è¦å®šä¹‰ä¼ å€¼ self çš„æ–¹æ³•ã€‚</li>\n</ol><p>å¹¶ä¸æ˜¯æ‰€æœ‰çš„traitéƒ½èƒ½ä»¥trait objectå½¢å¼ï¼ˆdyn traitï¼‰ä½¿ç”¨ï¼Œå®é™…ä¸Šï¼Œä»¥dyn traitä½¿ç”¨çš„åœºæ™¯å¯èƒ½æ˜¯å°‘æ•°ã€‚æ‰€ä»¥ä½ å¯ä»¥åœ¨é‡åˆ°ç¼–è¯‘å™¨æŠ¥é”™çš„æ—¶å€™å†å›å¤´æ¥å®¡è§†traitå®šä¹‰å¾—æ˜¯å¦åˆç†ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹å¯ä»¥æ”¾å¿ƒä½¿ç”¨ã€‚</p><h2>å°ç»“</h2><p><img src=\"https://static001.geekbang.org/resource/image/49/82/4951a0fdf2c4636f357702ac837c3382.jpg?wh=1390x1048\" alt=\"\"></p><p>åœ¨è¿™èŠ‚è¯¾çš„å‰åŠéƒ¨åˆ†ï¼Œæˆ‘ä»¬è®²è§£äº†traitä¸­å¸¦ç±»å‹å‚æ•°çš„æƒ…å†µã€‚å„ç§ç¬¦å·ç»„åˆèµ·æ¥ï¼Œç¡®å®è¶Šæ¥è¶Šå¤æ‚äº†ã€‚ä¸è¿‡è¿˜æ˜¯é‚£å¥è¯ï¼Œæ¨¡å¼å°±é‚£å‡ ç§ï¼Œåªè¦èŠ±ç‚¹æ—¶é—´ç†Ÿæ‚‰ç†è§£ï¼Œå…¶å®å¹¶ä¸éš¾ã€‚å¼€å§‹çš„æ—¶å€™èƒ½è®¤è¯†å°±è¡Œï¼Œåé¢åœ¨å®è·µä¸­å†æ…¢æ…¢æŒæ¡ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨å¸¦ç±»å‹å‚æ•°çš„traitå®ç°äº†å…¶ä»–è¯­è¨€ä¸­å‡½æ•°é‡è½½çš„åŠŸèƒ½ã€‚çœ‹èµ·æ¥é€”å¾„æœ‰ç‚¹æ›²æŠ˜ï¼Œä½†æ˜¯å¸¦ç»™äº†æˆ‘ä»¬ä¸€æ¡å…¨æ–°çš„æ€è·¯ï¼šä»¥å¾€çš„è¯­è¨€å¿…é¡»ç»™è‡ªèº«æ·»åŠ å„ç§ç‰¹æ€§æ¥æ»¡è¶³ç”¨æˆ·çš„è¦æ±‚ï¼Œåœ¨Rustä¸­ï¼Œç”¨å¥½traitå°±èƒ½æå®šã€‚è¿™è®©æˆ‘ä»¬å¯¹Rustçš„æœªæ¥å……æ»¡æœŸå¾…ï¼Œéšç€æ—¶é—´çš„å‘å±•ï¼Œå®ƒä¸ä¼šåƒC++ã€Javaé‚£æ ·æ°¸ä¸åœæ­‡åœ°æ·»åŠ å¯èƒ½ä¼šå¯¼è‡´ç»„åˆçˆ†ç‚¸çš„æ–°ç‰¹æ€§ï¼Œè€Œè®©è‡ªèº«è¶Šæ¥è¶Šè‡ƒè‚¿ã€‚</p><p>æˆ‘ä»¬è¿˜è®¨è®ºäº†å¸¦ç±»å‹å‚æ•°çš„traitä¸å…³è”ç±»å‹çš„åŒºåˆ«ã€‚å®ƒä»¬ä¹‹é—´å¹¶ä¸å­˜åœ¨ç»å¯¹ä¼˜åŠ¿çš„ä¸€æ–¹ï¼Œåœ¨åˆé€‚çš„åœºæ™¯ä¸‹é€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆæ˜¯æœ€é‡è¦çš„ã€‚</p><p>ç„¶åæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªé—®é¢˜ï¼šå¦‚ä½•è®©ä¸€ä¸ªRustå‡½æ•°è¿”å›å¯èƒ½çš„å¤šç§ç±»å‹ï¼Ÿæ¨å¯¼å‡ºäº†å¼•å…¥trait objectæ–¹æ¡ˆçš„å¿…è¦æ€§ã€‚æ•´ä¸ªæ¨å¯¼è¿‡ç¨‹æ¯”è¾ƒæ›²æŠ˜ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å¯¹Rustç±»å‹ç³»ç»Ÿçš„ä¸€æ¬¡ç²¾å½©æ¢ç´¢ã€‚åœ¨è¿™ä¸ªæ¢ç´¢è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å’ŒRustcå°åŠ©æ‰‹æˆä¸ºäº†å¥½æœ‹å‹ï¼Œåœ¨å®ƒçš„ååŠ©ä¸‹ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†æœ€ä½³æ–¹æ¡ˆã€‚</p><p>æœ€åæˆ‘ä»¬äº†è§£äº†trait objectçš„ä¸€äº›ç”¨é€”ï¼Œå¹¶è®¨è®ºäº†trait objectã€impl traitï¼Œè¿˜æœ‰ä½¿ç”¨æšä¸¾å¯¹ç±»å‹è¿›è¡Œèšåˆè¿™ä¸‰ç§æ–¹å¼ä¹‹é—´çš„åŒºåˆ«ã€‚ç±»å‹ç³»ç»Ÿï¼ˆç±»å‹+ traitï¼‰æ˜¯Rustçš„å¤§è„‘ï¼Œä½ å¯ä»¥å¤šåŠ ç»ƒä¹ ï¼Œç†Ÿæ‚‰å®ƒçš„å½¢å¼ï¼ŒæŒæ¡å®ƒçš„ç”¨æ³•ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>è¯·è°ˆè°ˆåœ¨å‡½æ•°å‚æ•°ä¸­ä¼ å…¥ <code>&amp;dyn TraitA</code> ä¸ <code>Box&lt;dyn TraitA&gt;</code> ä¸¤ç§ç±»å‹çš„åŒºåˆ«ã€‚</p><p>æ¬¢è¿ä½ æŠŠæ€è€ƒåçš„ç»“æœåˆ†äº«åˆ°è¯„è®ºåŒºï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾çš„å†…å®¹åˆ†äº«ç»™å…¶ä»–æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","neighbors":{"left":{"article_title":"09ï½œåˆè¯†traitï¼šåè®®çº¦æŸä¸èƒ½åŠ›é…ç½®","id":723496},"right":{"article_title":"11ï½œå¸¸è§traitè§£æï¼šæ ‡å‡†åº“ä¸­çš„å¸¸è§traitåº”è¯¥æ€ä¹ˆç”¨ï¼Ÿ","id":724942}},"comments":[{"had_liked":false,"id":383755,"user_name":"å“„å“„","can_delete":false,"product_type":"c1","uid":3779530,"ip_address":"åŒ—äº¬","ucode":"F75FB23BEDC60A","user_header":"https://static001.geekbang.org/account/avatar/00/39/ab/ca/32d6c05d.jpg","comment_is_top":false,"comment_ctime":1699578301,"is_pvip":false,"replies":[{"id":139953,"content":"çœŸä¸é”™ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1699591105,"ip_address":"é‡åº†","comment_id":383755,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"rustç”Ÿå‘½å‘¨æœŸçš„ç‹¬ç‰¹è®¾è®¡ï¼Œå¯¼è‡´äº†è¯¥è¯­è¨€éœ€è¦è®¾è®¡ä¸€äº›å¤„ç†æ–¹å¼åº”å¯¹ç‰¹æ®Šæƒ…å†µï¼Œæ¯”å¦‚ç”Ÿå‘½å‘¨æœŸçš„æ ‡æ³¨ï¼ˆä¸»è¦æ˜¯ç»™ç¼–è¯‘å™¨è¿›è¡Œä»£ç å¤„ç†æ—¶çš„æç¤ºï¼‰ã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬åœ¨æ—¥å¸¸å¼€å‘ä¸­åº”è¯¥é¿å…ä¸€äº›é™·å…¥å¤æ‚æƒ…å†µçš„æ–¹å¼ï¼šæ¯”å¦‚ï¼Œä¼ å…¥å‚æ•°éƒ½ç”¨å¼•ç”¨ï¼ˆborrowï¼‰ï¼Œä¼ å‡ºç»“æœéƒ½åº”è¯¥æ˜¯ownerã€‚rustä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†å¤„ç†å„ç§æƒ…å†µçš„å·¥å…·ã€‚æ‰€ä»¥ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ä¼ å…¥å‚æ•°çš„æ—¶å€™ç”¨&amp;dyn Tï¼Œä¼ å‡ºç»“æœç”¨Box&lt;dyn T&gt;ã€‚","like_count":18,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631474,"discussion_content":"çœŸä¸é”™ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1699591105,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1624977,"avatar":"https://static001.geekbang.org/account/avatar/00/18/cb/91/14398631.jpg","nickname":"ç‹è¶…","note":"","ucode":"3CE4B6863C28A5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":636923,"discussion_content":"Boxç›®æµ‹å’Œgoçš„é€ƒé€¸åˆ†ææœ‰ç‚¹ç±»ä¼¼","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1707264693,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸­å›½æ¾³é—¨","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383758,"user_name":"é¸ æ‘©æ™º","can_delete":false,"product_type":"c1","uid":1106201,"ip_address":"æ±Ÿè‹","ucode":"853E584FC4CD64","user_header":"https://static001.geekbang.org/account/avatar/00/10/e1/19/c756aaed.jpg","comment_is_top":false,"comment_ctime":1699581172,"is_pvip":true,"replies":[{"id":139956,"content":"å¯¹çš„","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1699591193,"ip_address":"é‡åº†","comment_id":383758,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"&amp;dyn TraitAæ²¡æœ‰æ‰€æœ‰æƒï¼Œè€ŒBox&lt;dyn TraitA&gt;æœ‰æ‰€æœ‰æƒã€‚","like_count":6,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631477,"discussion_content":"å¯¹çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1699591193,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383753,"user_name":"å“„å“„","can_delete":false,"product_type":"c1","uid":3779530,"ip_address":"åŒ—äº¬","ucode":"F75FB23BEDC60A","user_header":"https://static001.geekbang.org/account/avatar/00/39/ab/ca/32d6c05d.jpg","comment_is_top":false,"comment_ctime":1699573759,"is_pvip":false,"replies":[{"id":139954,"content":"æ€è€ƒæ–¹å¼å¾ˆæ£’ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1699591177,"ip_address":"é‡åº†","comment_id":383753,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"å…³è”ç±»å‹ä¹‹æ‰€ä»¥è¦å•ç‹¬è®¾è®¡ï¼Œå› ä¸ºç¼–è¯‘å™¨å¯ä»¥é€šè¿‡è¾“å…¥åˆ¤æ–­å…·ä½“ç±»å‹ï¼Œè€Œæ— æ³•æ¨æ–­å‡ºè¾“å‡ºç±»å‹ï¼Œæ‰€ä»¥ï¼Œè¾“å‡ºçš„ç±»å‹éœ€è¦æ˜ç¡®æŒ‡å®š","like_count":6,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631475,"discussion_content":"æ€è€ƒæ–¹å¼å¾ˆæ£’ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1699591177,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1445744,"avatar":"https://static001.geekbang.org/account/avatar/00/16/0f/70/f59db672.jpg","nickname":"æ§‘Â·å…ˆç”Ÿ","note":"","ucode":"897F0475592E3A","race_medal":2,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635511,"discussion_content":"åœ¨æ–¹æ³•è°ƒç”¨å¤„æ¥ä½äº†è¿”å›å€¼ä¹Ÿæ˜¯å¯ä»¥åšä¸€äº›æ¨æ–­çš„å§ï¼Œä¸è¿‡ç¡®å®ç›¸æ¯”è¾“å…¥å‚æ•°ï¼Œè¿™é‡Œçš„ä¸Šä¸‹æ–‡è¦æ›´å¤æ‚ä¸€äº›ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1704898291,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383804,"user_name":"é¸ æ‘©æ™º","can_delete":false,"product_type":"c1","uid":1106201,"ip_address":"æ±Ÿè‹","ucode":"853E584FC4CD64","user_header":"https://static001.geekbang.org/account/avatar/00/10/e1/19/c756aaed.jpg","comment_is_top":false,"comment_ctime":1699672121,"is_pvip":true,"replies":[{"id":139962,"content":"éå¸¸èµåŒä½ çš„å­¦ä¹ æ–¹æ³•ï¼Œæ…¢å°±æ˜¯å¿«ï¼æœ€ç²¾é«“çš„åœ°æ–¹å°±é‚£ä¹ˆå‡ ä¸ªï¼ŒèŠ±5å€æ—¶é—´ç†è§£é€ï¼Œæœªæ¥å¯ä»¥èŠ‚çœ500ï¼Œ5000ï¼Œ50000å€çš„æ—¶é—´ï¼Œè¿˜èƒ½ç«™ğŸ‰ï¸æ›´é«˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1699706032,"ip_address":"é‡åº†","comment_id":383804,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"è¿™ç¯‡æ–‡ç« çœŸä¸é”™ï¼Œå€¼å¾—åå¤çœ‹ã€‚æ…¢å°±æ˜¯å¿«ï¼Œå­¦ä¹ ä¸èƒ½æµ®èºï¼Œå¦„æƒ³é€Ÿæˆï¼Œä¸€çŸ¥åŠè§£åè€Œç»™åè¾¹çš„å­¦ä¹ é€ æˆå¾ˆå¤šéšœç¢ã€‚","like_count":4,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631536,"discussion_content":"éå¸¸èµåŒä½ çš„å­¦ä¹ æ–¹æ³•ï¼Œæ…¢å°±æ˜¯å¿«ï¼æœ€ç²¾é«“çš„åœ°æ–¹å°±é‚£ä¹ˆå‡ ä¸ªï¼ŒèŠ±5å€æ—¶é—´ç†è§£é€ï¼Œæœªæ¥å¯ä»¥èŠ‚çœ500ï¼Œ5000ï¼Œ50000å€çš„æ—¶é—´ï¼Œè¿˜èƒ½ç«™ğŸ‰ï¸æ›´é«˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1699706032,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383774,"user_name":"-","can_delete":false,"product_type":"c1","uid":1546505,"ip_address":"åŒ—äº¬","ucode":"7B34258D346793","user_header":"https://static001.geekbang.org/account/avatar/00/17/99/09/29c46a7b.jpg","comment_is_top":false,"comment_ctime":1699604194,"is_pvip":false,"replies":[{"id":139995,"content":"è¿™é‡Œé¢çš„è®¾è®¡åŸç†ç¡®å®æ¯”è¾ƒdirtyäº†ã€‚æˆ‘å…ˆç»™å‡ºä¸‰ç¯‡æ–‡ç« å‚è€ƒï¼Œä½ å¯ä»¥æ·±å…¥ä¸‹å»ç ”ç©¶ï¼šhttps:&#47;&#47;rustcc.cn&#47;article?id=e80a98d7-4adb-4d39-bf0a-4e079bcb1835  https:&#47;&#47;segmentfault.com&#47;a&#47;1190000022104780  https:&#47;&#47;rust-lang.github.io&#47;rfcs&#47;0255-object-safety.html ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1699848288,"ip_address":"é‡åº†","comment_id":383774,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"æœ€åå®‰å…¨çš„trait objectå¬çš„ä¼¼æ‡‚éæ‡‚ï¼Œä¸ºä»€ä¹ˆæ˜¯å®‰å…¨çš„ï¼Œä¸ºä»€ä¹ˆæ˜¯ä¸å®‰å…¨çš„ï¼Ÿå¸Œæœ›å…·ä½“è®²ä¸‹åŸå› ","like_count":2,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631623,"discussion_content":"è¿™é‡Œé¢çš„è®¾è®¡åŸç†ç¡®å®æ¯”è¾ƒdirtyäº†ã€‚æˆ‘å…ˆç»™å‡ºä¸‰ç¯‡æ–‡ç« å‚è€ƒï¼Œä½ å¯ä»¥æ·±å…¥ä¸‹å»ç ”ç©¶ï¼šhttps://rustcc.cn/article?id=e80a98d7-4adb-4d39-bf0a-4e079bcb1835  https://segmentfault.com/a/1190000022104780  https://rust-lang.github.io/rfcs/0255-object-safety.html ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1699848288,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1979955,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/36/33/3411df0d.jpg","nickname":"seven9t","note":"","ucode":"B7CA7D62C56938","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":635158,"discussion_content":"å¯ä»¥ä»ä½¿ç”¨ä¸Šå±‚è§’åº¦è¯´ä¸‹ä¸è¿™ä¹ˆåšçš„è¯ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Œå¦åˆ™æ„æ€å°±æ˜¯å®ƒå°±æ˜¯é€‰æ‹©è¿™æ ·å®ç°çš„äº†ï¼ˆå³å¯èƒ½å­˜åœ¨å…¶ä»–å®ç°æ–¹å¼å¯ä»¥ä¸è®¾è¿™äº›çº¦æŸ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1704449484,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":631623,"ip_address":"å¹¿ä¸œ","group_id":0},"score":635158,"extra":""}]},{"author":{"id":1287406,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a4/ee/b960a322.jpg","nickname":"mihello","note":"","ucode":"4B1E7B7A141606","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635085,"discussion_content":"https://doc.rust-lang.org/reference/items/traits.html è¡¥å……","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1704378733,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1287406,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a4/ee/b960a322.jpg","nickname":"mihello","note":"","ucode":"4B1E7B7A141606","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635068,"discussion_content":"æœ€è¿‘ä¸¤ç« ï¼ŒåŠ ä¸Šè¿™å‡ ç¯‡æ–‡ç« é†é†çŒé¡¶ã€‚æ€ªä¸å¾—rustè¿™ä¹ˆéš¾ï¼Œéš¾å‡ºå¤©é™…...ï¼Œæ”¶è·è‰¯å¤š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1704372369,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385454,"user_name":"superggn","can_delete":false,"product_type":"c1","uid":3623568,"ip_address":"åŒ—äº¬","ucode":"831CCD98B393FE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/7Q403U68Oy4lXG5sFBPVKLrfwaRzBqpBZibpEBXcPf9UOO3qrnh7RELoByTLzBZLkN9Nukfsj7DibynbZjKAKgag/132","comment_is_top":false,"comment_ctime":1702634091,"is_pvip":false,"replies":[{"id":140563,"content":"çœŸæ£’ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1703123324,"ip_address":"é‡åº†","comment_id":385454,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"ç¬”è®°ï¼š\n\n\n\ntrait å¯ä»¥å¸¦æ³›å‹ generics\n\ntrait å…³è”ç±»å‹ associated type è·Ÿæ³›å‹ç±»ä¼¼ï¼Œ ä½†å¿…é¡»åœ¨ impl çš„æ—¶å€™å°±å…·åŒ–\n\næ³›å‹å°±éšä¾¿å•¥æ—¶å€™å…·åŒ–éƒ½è¡Œäº†\n\n\n\n\n\n`fn doit(i: u32) -&gt; impl TraitA` =&gt; æŸä¸€ç§å®ç°äº† TraitA çš„ç±»å‹\n\n`fn doit(i: u32) -&gt; Box&lt;dyn TraitA&gt;` =&gt; å¤šç§å®ç°äº† TraitA çš„ç±»å‹\n\n\n\nå‰ä¸¤æ¬¡åˆ· rbe å’Œ rustbook çš„æ—¶å€™éƒ½æ²¡ååº”è¿‡æ¥ä¸ºå•¥å« trait object, çœ‹è¿™è¯¾ç»ˆäºæ˜ç™½äº†ï¼Œ åŸæ¥ trait obejct æŒ‡çš„æ˜¯ typeOuter çš„ OuterSizedObj, ç„¶åè¿™ä¸ª OuterSizedObj é‡Œé¢å¯ä»¥åŒ…è£¹å„ç§å®ç°äº† traitA çš„ type å¯¹åº” obj\n\nè¿˜æ˜¯å¾—å¤šåˆ·ç‚¹å„¿èµ„æ–™ï¼Œ å¤šçœ‹å¯¹äºåŒä¸€æ¦‚å¿µçš„ä¸åŒè¡¨è¾¾ï¼Œ æ˜ç™½çš„å¿«\n\n\n\n","like_count":1,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634239,"discussion_content":"çœŸæ£’ï¼","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1703123324,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385453,"user_name":"superggn","can_delete":false,"product_type":"c1","uid":3623568,"ip_address":"åŒ—äº¬","ucode":"831CCD98B393FE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/7Q403U68Oy4lXG5sFBPVKLrfwaRzBqpBZibpEBXcPf9UOO3qrnh7RELoByTLzBZLkN9Nukfsj7DibynbZjKAKgag/132","comment_is_top":false,"comment_ctime":1702634061,"is_pvip":false,"replies":[{"id":140474,"content":"å¯¹çš„ã€‚ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1702702168,"ip_address":"é‡åº†","comment_id":385453,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"æ€è€ƒé¢˜ï¼š &amp;dyn traitA å’Œ Box&lt;dyn traitA&gt; ä¸¥æ ¼æ¥è¯´éƒ½æ˜¯æŒ‡å‘ actual object çš„æŒ‡é’ˆï¼Œ åªä¸è¿‡ `&amp;` å«åšå¼•ç”¨ï¼Œ `Box` å«åšæ™ºèƒ½æŒ‡é’ˆ, è¿™ä¿©éƒ½æ˜¯å›ºå®šå¤§å°çš„ï¼Œ æ‰€ä»¥éƒ½èƒ½ç”¨åœ¨ trait object\n\nåŒºåˆ«ï¼š\n&amp;dyn traitA æ˜¯ä¸€ä¸ªä¸æ‹¿æ‰€æœ‰æƒçš„æŒ‡é’ˆ =&gt; æ‰€ä»¥ç»å¸¸ç”¨åœ¨å‚æ•°é‡Œ\nBox&lt;dyn traitA&gt; æ˜¯æ‹¥æœ‰å†…éƒ¨æ•°æ®æ‰€æœ‰æƒçš„æŒ‡é’ˆ =&gt; æ‰€ä»¥ç»å¸¸ç”¨åœ¨è¿”å›å€¼é‡Œï¼Œ å‚æ•°é‡Œåº”è¯¥ä¹Ÿèƒ½ç”¨\n\n\n","like_count":1,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":633877,"discussion_content":"å¯¹çš„ã€‚ğŸ‘","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1702702168,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":387433,"user_name":"æè¯—æ¶›","can_delete":false,"product_type":"c1","uid":2307830,"ip_address":"ä¸Šæµ·","ucode":"F0F8A0CFE815F8","user_header":"https://static001.geekbang.org/account/avatar/00/23/36/f6/7945e06f.jpg","comment_is_top":false,"comment_ctime":1707272144,"is_pvip":false,"replies":[{"id":141262,"content":"ä½ å¯ä»¥å†ä»”ç»†ç†è§£ä¸€ä¸‹impl trait æ”¾åœ¨å…¥å‚ä½ç½®çš„ç¤ºä¾‹å’Œæ”¾åœ¨è¿”å›å€¼ä½ç½®çš„åŒºåˆ«ã€‚å®ƒä»¬å®é™…éƒ½æ˜¯ç¼–è¯‘æœŸå±•å¼€çš„åº”ç”¨ï¼Œä½†æ˜¯é€»è¾‘ä¼šæœ‰åŒºåˆ«ã€‚ç”±äºè¿”å›å€¼çš„ifæ˜¯è¿è¡Œæ—¶æ‰æœ‰å€¼æ¥åˆ¤æ–­ï¼Œå› æ­¤åœ¨æ¯æ¬¡è°ƒç”¨å®ä¾‹æ—¶ï¼Œå®ƒæ— æ³•åœ¨ç¼–è¯‘æœŸæ¨å¯¼å‡ºå‡†ç¡®çš„è¿”å›å€¼ç±»å‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1708823204,"ip_address":"åŠ æ‹¿å¤§","comment_id":387433,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"è€å¸ˆè€å¸ˆï¼Œæˆ‘æœ‰ä¸€ä¸ªé—®é¢˜ã€‚å°±æ˜¯æ‚¨è¯´impl traitç›®å‰æœ‰ä¸¤ä¸ªä½¿ç”¨çš„åœ°æ–¹ï¼Œåˆ†åˆ«æ˜¯å‡½æ•°å…¥å‚å’Œè¿”å›ã€‚ä½†ç»™å‡ºçš„ä¾‹å­é‡Œï¼Œåœ¨å…¥å‚ä½¿ç”¨impl traitæ—¶ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å±•å¼€ã€‚ä½†åœ¨å‡ºè¿”å›å€¼ä½¿ç”¨impl traitæ—¶ï¼Œè‹¥æ˜¯è¿”å›äº†ä¸åŒçš„ç±»å‹å´ä¼šæŠ¥é”™ã€‚è¿™æ˜¯æ€ä¹ˆç†è§£ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":637687,"discussion_content":"ä½ å¯ä»¥å†ä»”ç»†ç†è§£ä¸€ä¸‹impl trait æ”¾åœ¨å…¥å‚ä½ç½®çš„ç¤ºä¾‹å’Œæ”¾åœ¨è¿”å›å€¼ä½ç½®çš„åŒºåˆ«ã€‚å®ƒä»¬å®é™…éƒ½æ˜¯ç¼–è¯‘æœŸå±•å¼€çš„åº”ç”¨ï¼Œä½†æ˜¯é€»è¾‘ä¼šæœ‰åŒºåˆ«ã€‚ç”±äºè¿”å›å€¼çš„ifæ˜¯è¿è¡Œæ—¶æ‰æœ‰å€¼æ¥åˆ¤æ–­ï¼Œå› æ­¤åœ¨æ¯æ¬¡è°ƒç”¨å®ä¾‹æ—¶ï¼Œå®ƒæ— æ³•åœ¨ç¼–è¯‘æœŸæ¨å¯¼å‡ºå‡†ç¡®çš„è¿”å›å€¼ç±»å‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1708823204,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŠ æ‹¿å¤§","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385946,"user_name":"å°å¯çˆ±(`ã¸Â´*)ãƒ","can_delete":false,"product_type":"c1","uid":1016404,"ip_address":"å››å·","ucode":"E75189846F6616","user_header":"https://static001.geekbang.org/account/avatar/00/0f/82/54/b9cd3674.jpg","comment_is_top":false,"comment_ctime":1703725267,"is_pvip":false,"replies":[{"id":140658,"content":"å¥½æ»´, è®°ä¸‹äº†ï¼Œåé¢ä¼šæŒç»­è¾“å‡ºã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1703770679,"ip_address":"é‡åº†","comment_id":385946,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"åŸºç¡€éƒ¨åˆ†éå¸¸è¯¦ç»†ï¼Œå»ºè®®è€å¸ˆå¯ä»¥æ·±å…¥è®²ä¸€ä¸‹trait objectçš„å†…å­˜ç›¸å…³çŸ¥è¯†ï¼Œä»¥åŠtrait objectä¼šä¸¢å¤±æœ¬èº«ç±»å‹ä¿¡æ¯è¿™äº›æ³¨æ„ç‚¹ã€‚","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634658,"discussion_content":"å¥½æ»´, è®°ä¸‹äº†ï¼Œåé¢ä¼šæŒç»­è¾“å‡ºã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1703770679,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":384240,"user_name":"-HedonğŸ­","can_delete":false,"product_type":"c1","uid":3176234,"ip_address":"æ¹–åŒ—","ucode":"FAE541E7A2B88F","user_header":"https://static001.geekbang.org/account/avatar/00/30/77/2a/0cd4c373.jpg","comment_is_top":false,"comment_ctime":1700569701,"is_pvip":false,"replies":[{"id":140227,"content":"ğŸ‘ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1700707942,"ip_address":"é‡åº†","comment_id":384240,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"æ€è€ƒé¢˜ï¼š&amp;dyn TraitA æ˜¯å€Ÿç”¨ï¼ŒBox&lt;dyn TraitA&gt; ä¼šè½¬ç§»æ‰€æœ‰æƒã€‚\n\né€šè¿‡ä¸‹é¢çš„ç¨‹åºå¯ä»¥æµ‹è¯•å‡ºæ¥ï¼š\n\nfn doit3(t1: &amp;dyn TraitA, t2: Box&lt;dyn TraitA&gt;) {\n    println!(&quot;{:?}&quot;, t1);\n    println!(&quot;{:?}&quot;, t2)\n}\n\nfn main() {\n    let a = AType;\n    let b = BType;\n    doit3(&amp;a, Box::new(b));\n    println!(&quot;{:?}&quot;, a);\n    println!(&quot;{:?}&quot;, b);\n}\n\nè¾“å‡ºï¼š\n\nerror[E0382]: borrow of moved value: `b`\n  --&gt; examples&#47;trait_object.rs:29:22\n   |\n26 |     let b = BType;\n   |         - move occurs because `b` has type `BType`, which does not implement the `Copy` trait\n27 |     doit3(&amp;a, Box::new(b));\n   |                        - value moved here\n28 |     println!(&quot;{:?}&quot;, a);\n29 |     println!(&quot;{:?}&quot;, b);\n   |                      ^ value borrowed here after move\n","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632354,"discussion_content":"ğŸ‘ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1700707942,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":384216,"user_name":"è€å¤§","can_delete":false,"product_type":"c1","uid":1109637,"ip_address":"æ²³å—","ucode":"1134808B441F74","user_header":"https://static001.geekbang.org/account/avatar/00/10/ee/85/c0cf6544.jpg","comment_is_top":false,"comment_ctime":1700547913,"is_pvip":false,"replies":[{"id":140221,"content":"è§‚å¯Ÿå¾—å¾ˆç»†è‡´ï¼Œä¸Šé¢çš„ä¾‹å­ä¸»è¦æ˜¯ä¸ºäº†å±•ç°å¯èƒ½å‡ºç°çš„å†™æ³•ã€‚åé¢çš„è¯´æ˜åŠ å…¥äº†object saftyçš„å› ç´ ï¼Œä»¥åŠç¤¾åŒºçš„çº¦å®šï¼Œæ‰€ä»¥çœ‹èµ·æ¥å¥½åƒä¸ä¸€è‡´ï¼Œå®é™…æ˜¯ä¸€è‡´çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1700707386,"ip_address":"é‡åº†","comment_id":384216,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100626901,"comment_content":"ä¸è¦åœ¨ trait é‡Œé¢å®šä¹‰æ„é€ å‡½æ•°ï¼Œæ¯”å¦‚ new è¿™ç§è¿”å› Self çš„å…³è”å‡½æ•°ã€‚ä½ å¯ä»¥å‘ç°ï¼Œç¡®å®åœ¨æ•´ä¸ª Rust ç”Ÿæ€ä¸­éƒ½æ²¡æœ‰å°†æ„é€ å‡½æ•°å®šä¹‰åœ¨ trait ä¸­çš„ä¹ æƒ¯ã€‚\nè¿™å¥è¯ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ ç¡®å®æœ‰åœ¨traitä¸­å®šä¹‰äº†newå‡½æ•°è¿”å›selfçš„ã€‚æ€ä¹ˆå°±æ„Ÿè§‰æœ‰å†²çªå‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632347,"discussion_content":"è§‚å¯Ÿå¾—å¾ˆç»†è‡´ï¼Œä¸Šé¢çš„ä¾‹å­ä¸»è¦æ˜¯ä¸ºäº†å±•ç°å¯èƒ½å‡ºç°çš„å†™æ³•ã€‚åé¢çš„è¯´æ˜åŠ å…¥äº†object saftyçš„å› ç´ ï¼Œä»¥åŠç¤¾åŒºçš„çº¦å®šï¼Œæ‰€ä»¥çœ‹èµ·æ¥å¥½åƒä¸ä¸€è‡´ï¼Œå®é™…æ˜¯ä¸€è‡´çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1700707386,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":384108,"user_name":"Ransang","can_delete":false,"product_type":"c1","uid":1133041,"ip_address":"ä¸Šæµ·","ucode":"DB67566A627DF2","user_header":"https://static001.geekbang.org/account/avatar/00/11/49/f1/bd61dbb1.jpg","comment_is_top":false,"comment_ctime":1700308493,"is_pvip":false,"replies":[{"id":140164,"content":"ğŸ‘ï¼Œè¿™ç§æ¢ç´¢çš„æ–¹å¼å¾ˆæ£’ã€‚&#39;static ç¡®å®èµ·è¿™ä¸ªä½œç”¨ã€‚åœ¨ Rust ä¸­ï¼Œ&#39;static ç”Ÿå‘½æœŸæ˜¯æ•´ä¸ªç¨‹åºçš„æŒç»­æ—¶é—´ã€‚å½“ä½ åœ¨ç±»å‹å‰é¢åŠ ä¸Š &#39;static æ—¶ï¼Œä½ å‘Šè¯‰ Rust ç¼–è¯‘å™¨è¿™ä¸ªå¼•ç”¨åº”è¯¥åœ¨æ•´ä¸ªç¨‹åºè¿è¡ŒæœŸé—´éƒ½æœ‰æ•ˆã€‚\n\nä½†æ˜¯è¿™å¹¶ä¸æ„å‘³ç€ä½ å¯ä»¥è¿”å›ä¸€ä¸ªæŒ‡å‘å±€éƒ¨å˜é‡çš„ &#39;static å¼•ç”¨ã€‚è¿™æ˜¯å› ä¸ºå±€éƒ¨å˜é‡åœ¨å‡½æ•°è¿”å›æ—¶å°±ä¼šè¢«é”€æ¯ï¼Œæ‰€ä»¥ä»»ä½•æŒ‡å‘å®ƒä»¬çš„å¼•ç”¨åœ¨å‡½æ•°è¿”å›åéƒ½å°†å˜å¾—æ— æ•ˆã€‚è¿™ä¸ª &#39;static å‘Šè¯‰ Rust ç¼–è¯‘å™¨è¿™ä¸ªå¼•ç”¨åº”è¯¥åœ¨æ•´ä¸ªç¨‹åºè¿è¡ŒæœŸé—´éƒ½æœ‰æ•ˆï¼Œäºæ˜¯Rustå°±ä¿¡äº†ï¼Œå³ä½¿å®é™…ä¸Šè¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œæ‰€ä»¥è¿˜æ˜¯è¦ç”¨Boxã€‚ä»è¿™ä¸€ç‚¹ä¹Ÿèƒ½çœ‹å‡ºRustç¼–è¯‘å™¨ä¹Ÿä¸å®Œç¾ã€‚\n\nç„¶åç¬¬20è®²ä¼šè®²ç”Ÿå‘½æœŸçš„æ¦‚å¿µï¼Œä½†æ˜¯ä¹Ÿä¸ä¼šç‰¹åˆ«æ·±å…¥ã€‚åˆå­¦Rustçš„æ—¶å€™ï¼Œå…ˆä¸ç”¨èŠ±å¤§é‡æ—¶é—´åœ¨è¿™ä¸Šé¢ï¼Œå¯ä»¥æŠŠè¿™ä¸ªé—®é¢˜ç•™åˆ°åé¢å»ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1700541856,"ip_address":"é‡åº†","comment_id":384108,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100626901,"comment_content":"struct Atype;\nstruct Btype;\nstruct Ctype;\n\ntrait TraitA {}\n\nimpl TraitA for Atype {}\nimpl TraitA for Btype {}\nimpl TraitA for Ctype {}\n\nfn doit(i: u32) -&gt; &amp;&#39;static dyn TraitA { &#47;&#47; æ³¨æ„è¿™é‡Œçš„è¿”å›ç±»å‹æ¢æˆäº† dyn TraitA\n  if i == 0 {\n    return &amp;Atype\n  } else if i == 1 {\n    return &amp;Btype\n  } else {\n    return &amp;Ctype\n  }\n}\nè€å¸ˆ æˆ‘è¿™ç§ä¹Ÿèƒ½é€šè¿‡ç¼–è¯‘ ï¼Œæˆ‘ä¸€å¼€å§‹å°è¯•ç”¨&amp;dyn TraitAæ²¡é€šè¿‡ç¼–è¯‘ï¼Œå°åŠ©æ‰‹æŠ¥é”™error[E0106]: missing lifetime specifierå¹¶æç¤ºæˆ‘ç”¨&amp;&#39;static dyn TraitAï¼Œåœ¨å­—ç¬¦ä¸²é‚£èŠ‚æ‚¨æè¿‡ &#39;static è¡¨ç¤ºè¿™ä¸ªå¼•ç”¨å¯ä»¥è´¯ç©¿æ•´ä¸ªç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸï¼Œæƒ³é—®ä¸‹æ‚¨è¿™æ®µä»£ç ä¸ºä»€ä¹ˆåŠ äº†&#39;staticå°±å¯ä»¥é€šè¿‡ç¼–è¯‘ï¼Œä»¥åŠè¿™ä¸ªç”Ÿå‘½å‘¨æœŸçš„æ¦‚å¿µåˆæ˜¯æ€ä¹ˆå›äº‹ï¼Œè°¢è°¢äº†","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632179,"discussion_content":"ğŸ‘ï¼Œè¿™ç§æ¢ç´¢çš„æ–¹å¼å¾ˆæ£’ã€‚&#39;static ç¡®å®èµ·è¿™ä¸ªä½œç”¨ã€‚åœ¨ Rust ä¸­ï¼Œ&#39;static ç”Ÿå‘½æœŸæ˜¯æ•´ä¸ªç¨‹åºçš„æŒç»­æ—¶é—´ã€‚å½“ä½ åœ¨ç±»å‹å‰é¢åŠ ä¸Š &#39;static æ—¶ï¼Œä½ å‘Šè¯‰ Rust ç¼–è¯‘å™¨è¿™ä¸ªå¼•ç”¨åº”è¯¥åœ¨æ•´ä¸ªç¨‹åºè¿è¡ŒæœŸé—´éƒ½æœ‰æ•ˆã€‚\n\nä½†æ˜¯è¿™å¹¶ä¸æ„å‘³ç€ä½ å¯ä»¥è¿”å›ä¸€ä¸ªæŒ‡å‘å±€éƒ¨å˜é‡çš„ &#39;static å¼•ç”¨ã€‚è¿™æ˜¯å› ä¸ºå±€éƒ¨å˜é‡åœ¨å‡½æ•°è¿”å›æ—¶å°±ä¼šè¢«é”€æ¯ï¼Œæ‰€ä»¥ä»»ä½•æŒ‡å‘å®ƒä»¬çš„å¼•ç”¨åœ¨å‡½æ•°è¿”å›åéƒ½å°†å˜å¾—æ— æ•ˆã€‚è¿™ä¸ª &#39;static å‘Šè¯‰ Rust ç¼–è¯‘å™¨è¿™ä¸ªå¼•ç”¨åº”è¯¥åœ¨æ•´ä¸ªç¨‹åºè¿è¡ŒæœŸé—´éƒ½æœ‰æ•ˆï¼Œäºæ˜¯Rustå°±ä¿¡äº†ï¼Œå³ä½¿å®é™…ä¸Šè¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œæ‰€ä»¥è¿˜æ˜¯è¦ç”¨Boxã€‚ä»è¿™ä¸€ç‚¹ä¹Ÿèƒ½çœ‹å‡ºRustç¼–è¯‘å™¨ä¹Ÿä¸å®Œç¾ã€‚\n\nç„¶åç¬¬20è®²ä¼šè®²ç”Ÿå‘½æœŸçš„æ¦‚å¿µï¼Œä½†æ˜¯ä¹Ÿä¸ä¼šç‰¹åˆ«æ·±å…¥ã€‚åˆå­¦Rustçš„æ—¶å€™ï¼Œå…ˆä¸ç”¨èŠ±å¤§é‡æ—¶é—´åœ¨è¿™ä¸Šé¢ï¼Œå¯ä»¥æŠŠè¿™ä¸ªé—®é¢˜ç•™åˆ°åé¢å»ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1700541856,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383985,"user_name":"å¯çˆ±çš„å°å¥¶ç‹—","can_delete":false,"product_type":"c1","uid":1178236,"ip_address":"å››å·","ucode":"DC810503571DD2","user_header":"https://static001.geekbang.org/account/avatar/00/11/fa/7c/f8f38ad0.jpg","comment_is_top":false,"comment_ctime":1700042365,"is_pvip":false,"replies":[{"id":140098,"content":"æºç åœ°å€å‘æ¥ç§ç§ğŸ‘€","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1700121465,"ip_address":"é‡åº†","comment_id":383985,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100626901,"comment_content":"è€å¸ˆï¼Œactix-web-4.4.0 çš„router.rsä¸­çš„toæ–¹æ³•ï¼š pub fn to&lt;F, Args&gt;(mut self, handler: F) -&gt; Self ï¼Œè¿™ä¸ªhandlerä¸ºä»€ä¹ˆå¯ä»¥æ¥æ”¶ä¸€ä¸ªasyncå‡½æ•°ä½œä¸ºå‚æ•°(asyncå‡½æ•°å¹¶æœªå®ç°F traitçš„æ–¹æ³•)å‘¢ï¼Ÿå®åœ¨æƒ³ä¸æ˜ç™½ã€‚","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631905,"discussion_content":"æºç åœ°å€å‘æ¥ç§ç§ğŸ‘€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1700121466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3737988,"avatar":"https://static001.geekbang.org/account/avatar/00/39/09/84/9e7aafcf.jpg","nickname":"ã€ŠæŠ¡è¯­ã€‹-ä¸­å›½","note":"","ucode":"A22E8C8807E7F6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632426,"discussion_content":"è›™è¶£ï¼Œå¤§å“¥è¿™ä¸ªå¼ºçš„å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1700748198,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383783,"user_name":"PEtFiSh","can_delete":false,"product_type":"c1","uid":1765926,"ip_address":"ä¸Šæµ·","ucode":"C4922398A92E05","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLO6XvxfFPMGcVSSX8uIZY2yib29qlyat178pU4QM3gIic5GXZ8PC0tzRiazP3FiajXbTj19SE4ZhV0gQ/132","comment_is_top":false,"comment_ctime":1699611152,"is_pvip":false,"replies":[{"id":139994,"content":"ğŸ‘ã€‚åˆå­¦è€…å¯ä»¥è¿™æ ·ç†è§£ã€‚æœ€é‡è¦çš„æ˜¯å¯¹æ‰€æœ‰æƒçš„ç†è§£ã€‚åœ¨å…·ä½“å®ç°ä¸Šï¼Œdyn TraitAæœ¬èº«ä¼šæ„å»ºä¸€ä¸ªvitual tableè¿›è¡Œä»£ç†è¿‡æ¸¡ã€‚ä½ å¯ä»¥ä»è¿™é‡Œäº†è§£åˆ°æ›´ç»†èŠ‚çš„ä¿¡æ¯ã€‚https:&#47;&#47;docs.rs&#47;vptr&#47;latest&#47;vptr&#47;","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1699847502,"ip_address":"é‡åº†","comment_id":383783,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100626901,"comment_content":"&amp;dyn TraitA æ˜¯å®ç°äº†TraitAçš„ç±»å‹çš„å¯¹è±¡çš„å¼•ç”¨ï¼ŒBox&lt;dyn Trait&gt;åˆ™æ˜¯è·å–äº†è¯¥å¯¹è±¡çš„æ‰€æœ‰æƒã€‚","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631622,"discussion_content":"ğŸ‘ã€‚åˆå­¦è€…å¯ä»¥è¿™æ ·ç†è§£ã€‚æœ€é‡è¦çš„æ˜¯å¯¹æ‰€æœ‰æƒçš„ç†è§£ã€‚åœ¨å…·ä½“å®ç°ä¸Šï¼Œdyn TraitAæœ¬èº«ä¼šæ„å»ºä¸€ä¸ªvitual tableè¿›è¡Œä»£ç†è¿‡æ¸¡ã€‚ä½ å¯ä»¥ä»è¿™é‡Œäº†è§£åˆ°æ›´ç»†èŠ‚çš„ä¿¡æ¯ã€‚https://docs.rs/vptr/latest/vptr/","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1699847502,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383759,"user_name":"ä¸€ä¸ªäººæ—…è¡Œ","can_delete":false,"product_type":"c1","uid":2555864,"ip_address":"åŒ—äº¬","ucode":"A708238B10B44B","user_header":"https://static001.geekbang.org/account/avatar/00/26/ff/d8/d48d6088.jpg","comment_is_top":false,"comment_ctime":1699582940,"is_pvip":false,"replies":[{"id":139993,"content":"ğŸ‘ã€‚åˆå­¦è€…å¯ä»¥è¿™æ ·ç†è§£ã€‚æœ€é‡è¦çš„æ˜¯å¯¹æ‰€æœ‰æƒçš„ç†è§£ã€‚åœ¨å…·ä½“å®ç°ä¸Šï¼Œdyn TraitAæœ¬èº«ä¼šæ„å»ºä¸€ä¸ªvitual tableè¿›è¡Œä»£ç†è¿‡æ¸¡ã€‚ä½ å¯ä»¥ä»è¿™é‡Œäº†è§£åˆ°æ›´ç»†èŠ‚çš„ä¿¡æ¯ã€‚https:&#47;&#47;docs.rs&#47;vptr&#47;latest&#47;vptr&#47;","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":2186062,"ctime":1699847287,"ip_address":"é‡åº†","comment_id":383759,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100626901,"comment_content":"1. &amp;dyn TraitA æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œå¼•ç”¨æŒ‡å‘å®ç°äº†TraitAç‰¹å¾çš„å…·ä½“ç±»å‹ï¼Œæ²¡æœ‰è¿™ä¸ªå…·ä½“ç±»å‹çš„æ‰€æœ‰æƒï¼Œç›¸å½“äºå€Ÿç”¨ã€‚\n2. Box&lt;dyn TraitA&gt; æ˜¯ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆï¼Œå°†å®ç°äº†TraitAç‰¹å¾çš„å…·ä½“ç±»å‹ä¿å­˜åœ¨å †ä¸Šï¼Œå¹¶ä¸”æ‹¥æœ‰è¿™ä¸ªå…·ä½“ç±»å‹çš„æ‰€æœ‰æƒã€‚","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631621,"discussion_content":"ğŸ‘ã€‚åˆå­¦è€…å¯ä»¥è¿™æ ·ç†è§£ã€‚æœ€é‡è¦çš„æ˜¯å¯¹æ‰€æœ‰æƒçš„ç†è§£ã€‚åœ¨å…·ä½“å®ç°ä¸Šï¼Œdyn TraitAæœ¬èº«ä¼šæ„å»ºä¸€ä¸ªvitual tableè¿›è¡Œä»£ç†è¿‡æ¸¡ã€‚ä½ å¯ä»¥ä»è¿™é‡Œäº†è§£åˆ°æ›´ç»†èŠ‚çš„ä¿¡æ¯ã€‚https://docs.rs/vptr/latest/vptr/","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1699847287,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":396253,"user_name":":-O","can_delete":false,"product_type":"c1","uid":2067731,"ip_address":"æµ™æ±Ÿ","ucode":"20EF422CAB2875","user_header":"https://static001.geekbang.org/account/avatar/00/1f/8d/13/943a4759.jpg","comment_is_top":false,"comment_ctime":1733760878,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100626901,"comment_content":"å¾ˆæ£’çš„æ–‡ç« ï¼Œæˆ‘çœ‹æ‡‚traitäº†","like_count":0}]}