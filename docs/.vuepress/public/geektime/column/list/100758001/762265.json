{"id":762265,"title":"02ï½œä¸»æµIaCå·¥å…·è§£æï¼šä½ çš„æœ€ä½³IaCå·¥å…·é€‰æ‹©æŒ‡å—","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æ½˜é‡ã€‚</p><p>ä¸Šä¸€è®²ï¼Œæˆ‘ä»¬äº†è§£äº†IaCçš„æ¦‚å¿µåŠå…¶å‘å±•è¿‡ç¨‹ï¼Œä»Šå¤©æˆ‘ä»¬ç€é‡åˆ†æä¸€äº›é‡è¦çš„IaCå·¥å…·ã€‚</p><p>è™½ç„¶æˆ‘ä»¬å¾ˆå®¹æ˜“å°±å¯ä»¥æŸ¥é˜…ç›¸å…³å·¥å…·çš„æ–‡æ¡£ï¼Œä½†ä¸å°‘åŒå­¦å¹¶æ²¡æœ‰äº†è§£è¿‡è¿™äº›å·¥å…·ä¸ºä»€ä¹ˆä¼šè¢«è®¾è®¡å‡ºæ¥ï¼ŒèƒŒååˆæ¶‰åŠå“ªäº›åŸç†ã€‚è€ŒæŒæ¡äº†è¿™äº›ï¼Œä½ æ‰èƒ½æŒæ¡é€‰æ‹©å·¥å…·çš„æ€è·¯ä¸æ ‡å‡†ï¼Œä¹‹ååº”ç”¨çš„æ—¶å€™ï¼Œä¹Ÿèƒ½åœ¨ä½¿ç”¨ä¸Šæ›´åŠ å¾—å¿ƒåº”æ‰‹ï¼Œé¿å…è¸©å‘ã€‚</p><h2>IaCå·¥å…·ç›˜ç‚¹</h2><p>åœ¨æ­£å¼ç›˜ç‚¹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ˜ç¡®ä¸€ä¸‹å·¥å…·é€‰æ‹©æ ‡å‡†ã€‚</p><p>ä¸Šä¸€è®²æˆ‘ä»¬äº†è§£äº†åŸºç¡€è®¾æ–½å³ä»£ç çš„æ¦‚å¿µï¼ŒIaCæ˜¯ä¸€ç§è‡ªåŠ¨åŒ–åŸºç¡€è®¾æ–½ç®¡ç†çš„æ–¹æ³•ï¼Œé€šè¿‡ä»£ç æè¿°å’Œé…ç½®åŸºç¡€è®¾æ–½èµ„æºï¼Œå®ç°<strong>å¿«é€Ÿ</strong>ã€<strong>å¯é </strong>å’Œ<strong>å¯é‡å¤</strong>çš„éƒ¨ç½²å’Œç®¡ç†è¿‡ç¨‹ã€‚</p><p>è¿™é‡Œé¢æœ‰ä¸‰ä¸ªå…³é”®è¯â€”â€”å¿«é€Ÿã€å¯é å’Œå¯é‡å¤ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬é€‰æ‹©IaCå·¥å…·çš„ä¸€ä¸ªåŸºå‡†çº¿ã€‚</p><p>å¿«é€Ÿæœ‰ä¸¤å±‚å«ä¹‰ã€‚ç¬¬ä¸€æ˜¯å·¥å…·æ˜“ç”¨ï¼Œå®¹æ˜“ç¼–å†™IaCä»£ç ï¼›ç¬¬äºŒæ˜¯å·¥å…·æ€§èƒ½å¥½ï¼Œè¿è¡Œé€Ÿåº¦å¿«ã€‚</p><p>å¯é æ˜¯æŒ‡åŸºäºåŒæ ·ä¸€ä»½Codeï¼ŒåŒä¸€å¥—å‚æ•°æ„å»ºå‡ºçš„äº§ç‰©ï¼Œå…¶æœ€ç»ˆçš„è¡Œä¸ºåº”è¯¥æ˜¯ä¸€è‡´çš„ã€‚</p><p>å¯é‡å¤åˆ™è¡¨ç¤º<strong>å®šä¹‰åŸºç¡€è®¾æ–½çš„ä»£ç æ˜¯å¯ä»¥è¢«é‡å¤ä½¿ç”¨å’Œå…±äº«ï¼Œç¡®ä¿ä¸åŒç¯å¢ƒé—´çš„ä¸€è‡´æ€§å’Œå¯é æ€§</strong>ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢å› é…ç½®åç§»æˆ–ç¼ºå°‘ä¾èµ–é¡¹è€Œå¯¼è‡´çš„è¿è¡Œæ—¶é—®é¢˜ã€‚ç®€å•æ¥è¯´ï¼Œæˆ‘ä¸Šçº¿Aèµ„æºç”¨è¿™å¥—ä»£ç ï¼Œä¸Šçº¿Bèµ„æºæˆ‘è¿˜å¯ä»¥ç”¨è¿™å¥—ä»£ç ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹IaCæ¯ä¸ªå‘å±•é˜¶æ®µæœ‰å“ªäº›ä¸»æµå·¥å…·ã€‚</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/c0/6d/c0894e9b58a5ace2bfyyb26f342dd36d.jpg?wh=3804x1260\" alt=\"\"></p><p>é¢å‘ä¸»æœºé…ç½®ç®¡ç†çš„å·¥å…·ä¸»è¦æœ‰ä¸¤ç±»ã€‚ä¸€ç±»é‡‡ç”¨Client-Serveræ¶æ„ï¼Œæ¯”å¦‚Puppetã€Saltstackã€‚å¦ä¸€ç±»é‡‡ç”¨æ— Agentæ¶æ„ï¼Œæ¯”å¦‚Ansibleã€‚</p><p>ä¸Šä¸€è®²æˆ‘æ›¾è¯´è¿‡ï¼Œé…ç½®ç®¡ç†çš„IaCå·¥å…·ä¸»è¦çš„çŸ­æ¿æ˜¯ï¼Œå®ƒä»¬åªèƒ½ç®¡ç†ä¸»æœºé‡Œçš„è½¯ä»¶åŒ…å®‰è£…ã€é…ç½®æ–‡ä»¶ï¼Œä½†æ— æ³•ç®¡ç†å…¶ä»–çš„èµ„æºï¼Œå·²ç»è·Ÿä¸ä¸ŠåŸºç¡€è®¾æ–½å‘å±•çš„éœ€æ±‚äº†ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹æ›´ç°ä»£çš„é¢å‘äº‘èµ„æºç®¡ç†ï¼ŒåŒæ ·ä¹Ÿæœ‰ä¸¤ç±»ä»£è¡¨å·¥å…·ã€‚</p><p>ä¸€ç±»æ˜¯å…¬æœ‰äº‘å‚å•†ä¸ºè‡ªå®¶äº§å“æ¨å‡ºçš„IaCç®¡ç†å·¥å…·ï¼Œæ¯”å¦‚AWSçš„Cloudformationã€Google Cloudçš„Deployment Managerã€‚ä¸è¿‡ï¼Œå…¬æœ‰äº‘ä¸Šå„å®¶æä¾›çš„IaCå·¥å…·åªèƒ½ç»™è‡ªå®¶äº‘ç”¨ï¼Œå¦‚æœæˆ‘åŒæ—¶ä½¿ç”¨AWSå’ŒGCPä¸¤ä¸ªå…¬æœ‰äº‘ï¼Œé‚£æ˜¾ç„¶ä»£ç ä¸å…·æœ‰å¯é‡å¤æ€§ã€‚</p><p>ä¸ºäº†èƒ½åšåˆ°å¯é‡å¤æ€§ï¼Œåˆå‚¬ç”Ÿäº†å¦ä¸€ç±»IaCå·¥å…·ï¼Œå°±æ˜¯ä»¥Terraformã€Pulumiä¸ºä»£è¡¨çš„å¼€æºå¤šäº‘ç®¡ç†å·¥å…·ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬æ¥çœ‹é¢å‘åº”ç”¨èµ„æºç®¡ç†çš„å·¥å…·ã€‚Kubernetesæå¤§é™ä½äº†è¿ç»´æˆæœ¬ï¼Œå®ƒæˆä¸ºäº†äº‹å®ä¸Šå„å®¶äº‘å‚å•†çš„é€šç”¨æ¥å£ã€‚äºæ˜¯å°±æœ‰äº†Crossplaneè¿™æ ·çš„å·¥å…·ï¼Œå®ƒåˆ©ç”¨Kubernetesçš„èƒ½åŠ›å’Œæ¥å£æ¥ç¼–æ’äº‘èµ„æºï¼Œè®©äº‘åŸºç¡€è®¾æ–½å’Œåº”ç”¨ç¨‹åºç®¡ç†å˜å¾—æ›´å®¹æ˜“ã€‚ä½†Crossplaneæ˜¯2020å¹´è¯ç”Ÿçš„ï¼Œåœ¨å¯é æ€§æ–¹é¢è¿˜ç•¥æœ‰æ¬ ç¼ºï¼Œè¿˜éœ€è¦æ›´å¤šçš„æ—¶é—´æ¥å®Œå–„ã€‚</p><p>æˆ‘ä»¬å°†ä¸Šè¿°å·¥å…·åšä¸ªæ±‡æ€»ï¼Œå¯¹æ¯”å®ƒä»¬æ˜¯å¦ç¬¦åˆå¿«é€Ÿã€å¯é å’Œå¯é‡å¤è¿™ä¸‰ä¸ªåŸºæœ¬ç‰¹ç‚¹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/bb/98/bb1e3bbd4557bbd2540d62136fe0fb98.jpg?wh=2787x1181\" alt=\"\"></p><p>ç»“åˆè¡¨æ ¼å¯ä»¥çœ‹å‡ºï¼Œæœ€ç¬¦åˆæˆ‘ä»¬è¦æ±‚çš„ä¸¤ä¸ªIaCå·¥å…·åˆ†åˆ«æ˜¯ <strong>Terraformå’ŒPulumiï¼Œå‰è€…æ˜¯å£°æ˜å¼æ–¹æ³•ï¼Œè€Œåè€…é‡‡ç”¨äº†ç¼–ç¨‹å¼æ–¹æ³•ã€‚</strong></p><h2>Terraform</h2><p>é‚£æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹Terraformã€‚</p><p>Terraformæ˜¯2014å¹´ç”±HashiCorpå…¬å¸å‘å¸ƒçš„ï¼Œå®ƒç”¨ä¸€ç§ç®€å•ä¸”æ˜“è¯»çš„é…ç½®è¯­è¨€æ¥æè¿°åŸºç¡€è®¾æ–½çš„æœŸæœ›çŠ¶æ€ï¼ŒåŒ…æ‹¬è™šæ‹Ÿæœºã€ç½‘ç»œã€æ•°æ®åº“ã€è´Ÿè½½å‡è¡¡å™¨ç­‰èµ„æºã€‚è¿™ç§é…ç½®è¯­è¨€å«åšHashiCorpé…ç½®è¯­è¨€ï¼Œç®€ç§°HCLã€‚</p><p>åœ¨ä¼—å¤šIaCçš„å®ç°ä¸­ï¼ŒTerraformå› ä¸ºå®ƒå¼ºå¤§çš„æ‰©å±•èƒ½åŠ›ã€ä¸°å¯Œçš„æ’ä»¶å’Œç®€å•æ˜äº†çš„é…ç½®è¯­è¨€ï¼Œæ·±å—ç”¨æˆ·å–œæ¬¢ï¼Œä¹Ÿè·å¾—äº†ä¼—å¤šäº‘å‚å•†çš„æ”¯æŒã€‚</p><p>åé¢è¿™å¼ å›¾å±•ç¤ºäº†Terraformæ ¸å¿ƒæ¶æ„ã€‚ä»å›¾ä¸Šçœ‹ï¼Œæ ¸å¿ƒå°±æ˜¯ä¸¤ä¸ªç»„æˆéƒ¨åˆ†â€”â€”Terraformæ’ä»¶ä¸Terraformæ ¸å¿ƒç¨‹åºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a8/c1/a8795304a018c430b21be9465fb404c1.jpg?wh=4194x1685\" alt=\"\"></p><h3>æ’ä»¶</h3><p>Terraformçš„æ’ä»¶ä½œç”¨æ˜¯å’Œäº‘å‚å•†æ¥å£å¯¹æ¥ï¼Œè·å–æˆ–è€…æ›´æ–°äº‘ä¸Šçš„èµ„æºé…ç½®ã€‚</p><p>å¯¹ç…§å‰é¢å›¾ç‰‡ä¸­Pluginsçš„éƒ¨åˆ†ï¼Œé‡Œé¢æœ‰ä¸¤ä¸ªå°å—ï¼Œä¸€ä¸ªå«Providerï¼Œå¦ä¸€ä¸ªå«Provisionï¼Œå®ƒä»¬ä¸¤ä¸ªåŠ èµ·æ¥å°±æ„æˆäº†Terraformçš„æ’ä»¶æœºåˆ¶ã€‚Terraformé€šè¿‡Providerå»è°ƒç”¨å„ä¸ªäº‘æä¾›å•†çš„SDKï¼Œæˆ–è€…æ˜¯SaaSæœåŠ¡çš„APIæ¥è·å–èµ„æºã€‚ä½ å¯ä»¥æŒ‰ç…§ <a href=\"https://developer.hashicorp.com/terraform/plugin/sdkv2\">Terraform pluginå®˜æ–¹æ–‡æ¡£</a>æ¥å¼€å‘è‡ªå·±çš„Providerï¼Œç„¶åå‘å¸ƒåˆ°Terraformçš„<a href=\"https://registry.terraform.io/browse/providers\">å®˜æ–¹ç½‘ç«™</a>ä¸Šã€‚</p><p>æœ‰äº›åœºæ™¯ä¸­é‡Œå£°æ˜å¼é…ç½®æ— æ³•è¡¨è¾¾ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼ŒProvisionerå¯ä»¥ä½œä¸ºä¸€ç§è¡¥å……æ‰‹æ®µæ¥å®Œæˆè¿™ç§ç±»å‹çš„æ“ä½œã€‚åé¢å°±æ˜¯ä¸€ä¸ªè·å–æœºå™¨IPçš„ä¾‹å­ï¼Œä½ å¯ä»¥å€ŸåŠ©å®ƒæ¥åŠ æ·±ç†è§£ã€‚</p><pre><code class=\"language-go\">resource \"aws_instance\" \"web\" {\n&nbsp; # ...\n\n&nbsp; provisioner \"local-exec\" {\n&nbsp; &nbsp; command = \"echo The server's IP address is ${self.private_ip}\"\n&nbsp; }\n}\n\n</code></pre><p>ç°åœ¨æˆ‘ä»¬åœ¨Terraformçš„<a href=\"https://registry.terraform.io/browse/providers\">å®˜æ–¹ç½‘ç«™</a>ï¼Œå¯ä»¥æœç´¢åˆ°å‡ ä¹æ‰€æœ‰äº‘æä¾›å•†çš„Providerï¼Œè¿™äº›éƒ½æ˜¯å®˜æ–¹æ¥çº³çš„Providerã€‚ä½ å¯ä»¥ç›´æ¥å¤ç”¨å·²æœ‰çš„Providerï¼Œåªè¦åœ¨æ–‡ä»¶é‡Œå®šä¹‰ä½¿ç”¨å“ªä¸€ä¸ªProviderï¼ŒProviderç›¸å…³å‚æ•°æ˜¯ä»€ä¹ˆå³å¯ã€‚</p><p>åé¢è¿™æ®µä»£ç æ¼”ç¤ºäº†å¦‚ä½•åœ¨Terraformçš„main.cfé‡Œå®šä¹‰è‡ªå·±æ‰€éœ€è¦çš„Providerã€‚</p><pre><code class=\"language-go\"># Configure the AWS provider\nprovider \"aws\" {\n&nbsp; access_key = \"\"\n&nbsp; secret_key = \"\"\n&nbsp; region = \"eu-west-1\"\n}\n</code></pre><p>æˆ‘ä»¬åœ¨provideré‡Œå®šä¹‰ä½¿ç”¨äº†AWS providerï¼Œå‘AWS providerä¼ å…¥access_keyï¼Œsecret_keyï¼Œregionè¿™äº›å‚æ•°ï¼Œè¿™æ ·Terraformæ‰èƒ½é€šè¿‡è¿™ä¸ªproviderçœŸæ­£è¿ä¸ŠAWSçš„APIã€‚</p><h3>ä¸»ç¨‹åº</h3><p>æ’ä»¶çš„ä½œç”¨æ˜¯å¯¹æ¥äº‘å‚å•†æ¥å£ï¼Œè€Œæˆ‘ä»¬è¦ç”Ÿæˆå“ªäº›èµ„æºã€è¿™äº›èµ„æºçš„å…³ç³»é“¾æ˜¯ä»€ä¹ˆæ ·çš„ä»¥åŠå¦‚ä½•ç¼–æ’è¿™äº›èµ„æºï¼Œè¿™äº›é—®é¢˜éƒ½éœ€è¦Terraformä¸»ç¨‹åºæ¥è§£å†³ã€‚</p><p>æˆ‘ä»¬å›çœ‹ä¸€ä¸‹å‰é¢çš„Terraformæ ¸å¿ƒæ¶æ„å›¾ï¼Œå›¾ä¸­ç”¨æˆ·applyäº†Terraformçš„ä»£ç ã€‚è¿™ä¸ªTerraformä»£ç é‡Œå°±å®šä¹‰äº†æ‰€éœ€è¦åˆ›å»ºçš„èµ„æºï¼Œä¾‹å¦‚VPCã€è™šæ‹Ÿæœºæˆ–æ˜¯è´Ÿè½½å‡è¡¡å™¨ç­‰ç­‰ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a8/c1/a8795304a018c430b21be9465fb404c1.jpg?wh=4194x1685\" alt=\"\"></p><p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹åé¢è¿™ä¸ªåˆ›å»ºä¸€ä¸ªEC2çš„å®ä¾‹ã€‚</p><pre><code class=\"language-go\"># Create an EC2 instance\nresource \"aws_instance\" \"example\" {\n&nbsp; ami&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= \"ami-785db401\"\n&nbsp; instance_type = \"t2.micro\"\n\n&nbsp; tags {\n&nbsp; &nbsp; Name = \"terraform-example\"\n&nbsp; }\n}\n</code></pre><p>æ³¨æ„çœ‹ä»£ç ç¬¬äºŒè¡Œï¼Œè¿™é‡Œæœ‰ä¸ªå…³é”®è¯resourceï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºçš„èµ„æºå°±æ˜¯é€šè¿‡å®ƒå®šä¹‰çš„ã€‚åœ¨resourceé‡Œï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å®šä¹‰å¾ˆå¤šå‚æ•°ï¼Œè¿™äº›å‚æ•°ç›®çš„æ˜¯æŠ½è±¡åŒ–æ¥å£ï¼Œä½¿å¾—ä»£ç å…·æœ‰æ›´å¥½çš„å¤ç”¨èƒ½åŠ›ã€‚è¿™é‡Œå°±ç”¨äº†tagè¿™ä¸ªå‚æ•°æ¥ç»™è¿™ä¸ªèµ„æºæ‰“æ ‡ç­¾ã€‚</p><p>ä¸åŒresourceé‡Œå‚æ•°ä¹Ÿä¸å°½ç›¸åŒï¼Œæœ‰å¿…å¡«çš„å‚æ•°ï¼Œä¹Ÿæœ‰å¯é€‰çš„å‚æ•°ã€‚ä½¿ç”¨resourceå‰ï¼Œä½ å¯ä»¥å…ˆæŸ¥é˜…Terraformå®˜æ–¹æ–‡æ¡£ï¼Œäº†è§£å‚æ•°åˆ—è¡¨ä»¥åŠå®ƒä»¬çš„å«ä¹‰ã€èµ‹å€¼çš„çº¦æŸæ¡ä»¶ç­‰ã€‚</p><p>é™¤äº†å®šä¹‰æˆ‘ä»¬éœ€è¦å“ªäº›resourceï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç¡®å®šè¿™äº›resourceå…³ç³»é“¾æ˜¯æ€æ ·çš„ã€‚å¤§éƒ¨åˆ†èµ„æºé—´çš„ä¾èµ–å…³ç³»å¯ä»¥è¢«Terraformè‡ªåŠ¨å¤„ç†ï¼Œä½†æ˜¯åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä»£ç ä¸­æ˜¾å¼å£°æ˜ä¾èµ–å…³ç³»ã€‚ä½ å¯ä»¥å‚è€ƒä¸‹é¢è¿™ä¸ªä¾‹å­ã€‚</p><pre><code class=\"language-go\">resource \"aws_s3_bucket\" \"my_bucket\" {\n  # S3 bucket configuration here\n}\n \nresource \"aws_instance\" \"my_ec2_instance\" {\n  # EC2 instance configuration here\n \n  # Explicit dependency on the S3 bucket resource\n  depends_on = [aws_s3_bucket.my_bucket]\n}\n</code></pre><p>è¿™ä¸¤ä¸ªresourceçš„ä½œç”¨æ˜¯é…ç½® AWS EC2 å®ä¾‹å’Œ S3 å­˜å‚¨æ¡¶ã€‚å› ä¸ºEC2å®ä¾‹ä¸­ç¨‹åºéœ€è¦å‘S3 Bucketé‡Œå†™æ•°æ®ï¼Œæ‰€ä»¥S3 Bucketå°±éœ€è¦åœ¨EC2å®ä¾‹å¯åŠ¨ä¹‹å‰å°±å»ºç«‹èµ·æ¥ã€‚ä¸ºäº†å¼ºåˆ¶æ‰§è¡Œè¿™ä¸ªåˆ›å»ºé¡ºåºï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>depends_on</code> æ¥å¤„ç†èµ„æºçš„ä¾èµ–å…³ç³»ã€‚</p><p>è¿™å°±å¼•å‡ºäº†ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼ŒTerraformåº”è¯¥ç”¨ä»€ä¹ˆé¡ºåºåˆ›å»ºèµ„æºï¼Œæ‰èƒ½ä¿è¯æ¯ä¸ªèµ„æºéƒ½æ˜¯åœ¨å…¶ä¾èµ–é¡¹ä¹‹ååˆ›å»ºçš„ï¼Ÿ</p><p>Terraformç”¨å›¾æ¥è¡¨è¿°åŸºç¡€è®¾æ–½ï¼Œå®˜æ–¹æœ¯è¯­å«åš <a href=\"https://developer.hashicorp.com/terraform/internals/graph\">Resource Graph</a>ï¼Œå…¶ä¸­Resourceä¸ºé¡¶ç‚¹ï¼Œä¾èµ–é¡¹ä¸ºè¾¹ã€‚ä¸Šè¿°é—®é¢˜å°±å¯ä»¥ç”¨æ ‡å‡†å›¾ç®—æ³•æ¥è§£å†³ã€‚</p><p>Terraformé‡Œæœ‰å¤šç§å›¾ç®—æ³•ï¼Œæ¯”å¦‚æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰ã€Tarjanæ¼”ç®—æ³•å’Œæœ‰å‘æ— å›¾çš„ <a href=\"https://en.wikipedia.org/wiki/Transitive_reduction\">Transitive reduction</a> ç®—æ³•ã€‚ä¸€èˆ¬è¿™äº›ç»†èŠ‚ä¸ç”¨å¤ªæ·±å…¥åœ°äº†è§£ï¼Œå½“ç„¶å¦‚æœä½ å¯¹Terrafromçš„å®ç°æœºåˆ¶æœ‰å…´è¶£ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ <a href=\"https://developer.hashicorp.com/terraform/internals/graph\">Resource Graph</a> ç« èŠ‚ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>terraform graph</code> è¿™ä¸ªå‘½ä»¤é…åˆgraphvizï¼Œç”ŸæˆTerraformçš„èµ„æºå…³ç³»å›¾ã€‚</p><pre><code class=\"language-go\">terraform graph | dot -Tsvg &gt; graph.svg\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/8b/8b/8b643da6308717f3bc90355dd3285d8b.jpg?wh=2479x1971\" alt=\"å›¾4\"></p><h3>å¦‚ä½•ä½¿ç”¨</h3><p>è®²å®ŒåŸç†ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹æ€ä¹ˆä½¿ç”¨Terraformã€‚æœ€å¸¸ç”¨çš„åªæœ‰å››ä¸ªå‘½ä»¤ã€‚</p><ul>\n<li><code>terraform init</code> åˆå§‹åŒ–é¡¹ç›®ï¼Œæ‹‰å–providerçš„æ¨¡å—</li>\n<li><code>terraform plan</code> æ¨æµ‹å°†æœ‰å“ªäº›èµ„æºè¢«æ›´æ”¹æˆ–è€…åˆ›å»º</li>\n<li><code>terraform apply</code> æ‰§è¡Œ terraform è®¡åˆ’ä»¥é…ç½®åŸºç¡€è®¾æ–½</li>\n<li><code>terraform destroy</code> é”€æ¯èµ„æº</li>\n</ul><p>è¿™äº›å‘½ä»¤çš„ä½¿ç”¨ï¼Œä½ å‚è€ƒå®˜æ–¹æ–‡æ¡£å¾ˆå®¹æ˜“å°±èƒ½æŒæ¡ï¼Œæˆ‘å°±ä¸è¯¦ç»†å±•å¼€äº†ã€‚</p><p>è¿™é‡Œæˆ‘æƒ³é‡ç‚¹ç»™ä½ è®²è§£ä¸€ä¸‹Terraformçš„çŠ¶æ€ç®¡ç†ï¼Œæˆ‘æ›¾ç»å› ä¸ºæ²¡æœ‰æ­£ç¡®ç®¡ç†å¥½ <strong>TerraformçŠ¶æ€ç®¡ç†æ–‡ä»¶ï¼Œå·®ç‚¹å¯¼è‡´äº†ä¸€ä¸ªä¸¥é‡çš„ç”Ÿäº§äº‹æ•…ã€‚</strong></p><p>Terraformæ¯æ¬¡æ‰§è¡Œ <code>terraform apply</code> æ“ä½œçš„æ—¶å€™ï¼Œä¼šå°†çŠ¶æ€ä¿¡æ¯ä¿å­˜åœ¨ä¸€ä¸ªå« <strong>terraform.tfstate</strong> çŠ¶æ€æ–‡ä»¶é‡Œï¼Œè¿™ä¸ªæ–‡ä»¶æœ€ä¸»è¦çš„ä½œç”¨å°±æ˜¯<strong>è¿½è¸ªèµ„æºçŠ¶æ€</strong>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ–‡ä»¶ä½äºå½“å‰å·¥ä½œç›®å½•ä¸‹ã€‚</p><p>æ¯æ¬¡æ‰§è¡Œ <code>terraform plan</code> æˆ–è€…  <code>terraform apply</code> çš„æ—¶å€™ï¼ŒTerraforméƒ½è¦è¯»å–è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œä¸å®é™…èµ„æºçŠ¶æ€åšæ¯”è¾ƒï¼Œæ‰¾å‡ºå˜åŒ–ç‚¹ï¼Œç”Ÿæˆæ–°çš„æ‰§è¡Œè®¡åˆ’ï¼Œé¿å…å·²ç»åˆ›å»ºçš„èµ„æºä¸ä¼šè¢«é‡å¤åˆ›å»ºã€‚</p><p>æ‰€ä»¥ï¼Œtfstateç›¸å½“äºäº‘èµ„æºçš„æ›´æ”¹å†å²è®°å½•ã€‚å¦‚æœtfstateæ–‡ä»¶æŸåæˆ–è€…ä¸¢å¤±ï¼Œå°±æ„å‘³ç€Terrafromä¸èƒ½å†ç®¡ç†å·²ç»åˆ›å»ºå¥½çš„èµ„æºï¼Œæ­¤æ—¶ä½ æ‰§è¡Œ <code>terraform plan</code> æˆ–è€…  <code>terraform apply</code> ï¼Œä¼šå‘ç°èµ„æºè¢«é‡å¤åˆ›å»ºã€‚æˆ‘å½“æ—¶å°±æ˜¯å› ä¸ºä¸¢å¤±äº†tfstateï¼Œå·®ç‚¹é‡å¤åˆ›å»ºäº†ç”Ÿäº§ç¯å¢ƒçš„èµ„æºã€‚å¥½åœ¨åæ¥åœ¨å¤‡ä»½ä¸­æ‰¾åˆ°äº†tfstateæ–‡ä»¶ï¼Œæ‰é¿å…äº†ä¸€åœºç”Ÿäº§äº‹æ•…ã€‚</p><p>è¿™æ—¶å°±ä¸å¾—ä¸æåˆ°Terraformçš„ä¸€ä¸ªé‡è¦åŠŸèƒ½äº†ï¼Œå®ƒå°±æ˜¯remote backendã€‚è¿™é¡¹åŠŸèƒ½æ”¯æŒå°†tfstateå­˜åœ¨å¯¹è±¡å­˜å‚¨æœåŠ¡æˆ–æ•°æ®åº“ä¸­ï¼Œæ¯”å¦‚S3ã€Consulç­‰ç­‰ã€‚</p><p>è¿™ä¸ªåŠŸèƒ½å¸®æˆ‘ä»¬è§£å†³äº†ä¸¤ä¸ªé‡è¦çš„é—®é¢˜ã€‚é¦–å…ˆï¼Œå½“æ¯æ¬¡æ‰§è¡Œ <code>terraform plan</code> æˆ–è€…  <code>terraform apply</code> çš„æ—¶å€™ï¼ŒTerraformä¼šè‡ªåŠ¨å°†çŠ¶æ€æ–‡ä»¶å†™è¿›è¿œç«¯å­˜å‚¨ä¸­ã€‚åƒS3è¿˜æä¾›äº†ç‰ˆæœ¬ç®¡ç†åŠŸèƒ½ï¼Œè¿™æ ·å°±å¯ä»¥<strong>è®°å½•æ•´ä¸ªäº‘èµ„æºçš„æ›´æ”¹å†å²ï¼Œä¿è¯çŠ¶æ€æ–‡ä»¶çš„å®Œæ•´æ€§ä¸å¯è¿½è¸ªæ€§</strong>ã€‚</p><pre><code class=\"language-go\">terraform {\n  backend \"s3\" {\n    bucket = \"my-terraform-state\"\n    key    = \"terraform.tfstate\"\n    region = \"cn-north-1\"\n  }\n}\n</code></pre><p>å…¶æ¬¡ï¼ŒTerraformçš„çŠ¶æ€æ–‡ä»¶æ˜¯æ˜æ–‡çš„ï¼Œè¿™æ„å‘³ç€ä»£ç ä¸­æ‰€ä½¿ç”¨çš„ä¸€åˆ‡æœºå¯†ä¿¡æ¯éƒ½å°†ä»¥æ˜æ–‡çš„å½¢å¼ä¿å­˜åœ¨çŠ¶æ€æ–‡ä»¶é‡Œã€‚å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæˆ‘ä»¬ä¸åº”è¯¥å°†tfstateæ–‡ä»¶å­˜åœ¨æœ¬åœ°ï¼Œè€Œæ˜¯åº”è¯¥å°†å…¶å­˜åœ¨è¿œç«¯å­˜å‚¨ä¸­ã€‚è¿™æ ·å°±è§£å†³äº†<strong>çŠ¶æ€æ–‡ä»¶åŠ å¯†é—®é¢˜</strong>ã€‚</p><h2>Pulumi</h2><p>äº†è§£äº†Terraformçš„å·¥ä½œåŸç†å’Œç”¨æ³•ï¼Œä½ å¯èƒ½ä¼šå‘ç°Terraformå­˜åœ¨ä¸€ä¸ªé—®é¢˜â€”â€”Terraformå¯¹äºçŠ¶æ€æ–‡ä»¶çš„ç®¡ç†å¹¶ä¸æ˜¯ç‰¹åˆ«ç†æƒ³ã€‚å› ä¸ºå®ƒæ˜¯æ˜æ–‡å­˜å‚¨ä¸”é»˜è®¤æ²¡æœ‰çŠ¶æ€æ–‡ä»¶çš„ç‰ˆæœ¬ç®¡ç†ï¼Œåªèƒ½ä¾èµ–å¤–éƒ¨å­˜å‚¨å¯¹æ–‡ä»¶åšåŠ å¯†ä¸ç‰ˆæœ¬ç®¡ç†ã€‚</p><p>æˆ‘åœ¨æœ€å¼€å§‹çš„æ—¶å€™æåˆ°IaCå·¥å…·éœ€è¦æ»¡è¶³å¿«é€Ÿï¼Œå¯é å’Œå¯é‡å¤è¿™ä¸‰ä¸ªç‰¹ç‚¹ã€‚æˆ‘ä»¬å†™ä¸‹çš„Terraformä»£ç  + çŠ¶æ€æ–‡ä»¶ï¼Œæ‰èƒ½ç»„æˆå®Œæ•´çš„Terraformå½¢æ€ï¼Œæ»¡è¶³å¯é è¿™æ¡åŸºå‡†çº¿ã€‚</p><p>å¦å¤–ï¼ŒTerraformçš„HCLè¯­æ³•è™½ç„¶å¾ˆç®€å•ï¼Œå¾ˆå®¹æ˜“ä¸Šæ‰‹ï¼Œä½†æ˜¯HCLè¯­æ³•é‡Œæ²¡æœ‰for/if-elseè¿™äº›æµç¨‹æ§åˆ¶ã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬é‡åˆ°çš„åœºæ™¯éœ€è¦ç”¨éå¸¸å¤æ‚çš„é€»è¾‘å®ç°ï¼ŒåŸºäºHCLè¯­æ³•çš„å£°æ˜å¼é…ç½®å°±ä¼šæ˜¾å¾—æ‰è¥Ÿè§è‚˜ï¼Œæˆ‘ä»¬å¾€å¾€è¦å¤åˆ¶ç²˜è´´å¤§æ®µçš„Terraformä»£ç ï¼Œæ‰èƒ½å®ç°æƒ³è¦çš„é…ç½®ã€‚</p><p>åé¢è¿™ä¸ªä¾‹å­èƒ½å¸®ä½ ç†è§£åˆšåˆšå‰é¢è®²çš„å†…å®¹ã€‚æˆ‘ä»¬æœ‰ä¸¤ä¸ªç¯å¢ƒï¼Œä¸€ä¸ªæ˜¯devå¼€å‘ç¯å¢ƒï¼Œä¸€ä¸ªæ˜¯stgæµ‹è¯•ç¯å¢ƒã€‚å¯ä»¥çœ‹åˆ°ï¼Œä¸åŒçš„ç¯å¢ƒæ‰€å¯¹åº”çš„MySQLå’ŒRedisçš„åœ°å€æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><pre><code class=\"language-json\">[\n    {\n        \"env_name\": \"dev\",\n        \"mysql\": \"mysql-dev.awsamazon.com:3306\",\n        \"redis\": \"redis-dev.awsamazon.com:6379\",\n    },\n    {\n        \"env_name\": \"stg\",\n        \"mysql\": \"mysql-stg.awsamazon.com:3306\",\n        \"redis\": \"redis-stg.awsamazon.com:6379\",\n    }\n]\n</code></pre><p>é‚£ç°åœ¨æˆ‘è¦é’ˆå¯¹ä¸åŒçš„ç¯å¢ƒå»è®¾ç½®ä¸åŒçš„å®‰å…¨ç­–ç•¥ï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ä¸ºæ¯ä¸ªç¯å¢ƒéƒ½å†™ä¸€æ®µterraformä»£ç ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬å¯èƒ½å°±ä¼šå°†ç›®å½•æ–‡ä»¶ç»„ç»‡æˆ  <code>dev/main.cf</code>  <code>stg/main.cf</code> ï¼Œä¸¤ä¸ªmain.cfé‡Œå¤§éƒ¨åˆ†çš„ä»£ç æ˜¯ä¸€æ ·çš„ï¼Œç„¶ååˆ†å¼€æ‰§è¡Œã€‚</p><p>ä¸ºäº†è§£å†³è¿™äº›ç—›ç‚¹ï¼Œå¾®è½¯å’Œäºšé©¬é€Šäº‘æœåŠ¡çš„è€å…µJoe Duffyå’ŒLuke Hobanåœ¨2017å¹´åˆ›å»ºäº†ä¸€æ¬¾å¯¹æ ‡Terraformçš„IaCè½¯ä»¶ï¼Œåå­—å«Pulumiã€‚</p><p>é¦–å…ˆï¼Œ<strong>é’ˆå¯¹Terraformçš„è¯­æ³•å¼±ç‚¹</strong>ï¼ŒPulumiå¼•å…¥äº†ä¸»æµç¼–ç¨‹è¯­è¨€æ¥ç¼–å†™åŸºç¡€è®¾æ–½ã€‚Pulumiæ”¯æŒTypeScriptã€JavaScriptã€Pythonã€Goã€C#è¿™å‡ ç§è¯­è¨€ã€‚ä½ å¯ä»¥çœ‹çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ç”¨Goè¯­è¨€æè¿°äº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªs3 bucketã€‚ä½ åº”è¯¥å‘ç°äº†ï¼Œè¿™å¯¹å¼€å‘äººå‘˜æ¥è¯´éå¸¸å‹å¥½ã€‚</p><pre><code class=\"language-go\">package main\nimport (\n    \"github.com/pulumi/pulumi-aws/sdk/v4/go/aws/s3\"\n    \"github.com/pulumi/pulumi/sdk/v3/go/pulumi\"\n)\nfunc main() {\n    pulumi.Run(func(ctx *pulumi.Context) error {\n        // Create an AWS resource (S3 Bucket)\n        bucket, err := s3.NewBucket(ctx, \"my-bucket\", nil)\n        if err != nil {\n            return err\n        }\n        // Export the name of the bucket\n        ctx.Export(\"bucketName\", bucket.ID())\n        return nil\n    })\n}\n</code></pre><p>Pulumiä¹Ÿå¸æ”¶äº†Terraformçš„ç»éªŒï¼Œæ”¯æŒäº†äºšé©¬é€Šäº‘ç§‘æŠ€ã€å¾®è½¯Azureã€è°·æ­Œäº‘ä¸é˜¿é‡Œäº‘ç­‰ä¸»æµå…¬æœ‰äº‘å‚å•†ã€‚ä»ä¸‹å›¾å¯ä»¥çœ‹å‡ºï¼ŒPulumiä¸ºä¸»æµäº‘å‚å•†æä¾›äº†å¤šç§ç¼–ç¨‹è¯­è¨€çš„SDKã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/7a/0d/7a9d3311707c6860e9cc89e225689f0d.jpg?wh=1099x1053\" alt=\"\"></p><p>å…¶æ¬¡ï¼Œåœ¨<strong>çŠ¶æ€ç®¡ç†</strong>æ–¹é¢ï¼ŒPulumié»˜è®¤æä¾›äº†çŠ¶æ€ç®¡ç†çš„äº‘æœåŠ¡ï¼Œå¸®åŠ©ç”¨æˆ·ä¿å­˜çŠ¶æ€ï¼Œä¹Ÿæ”¯æŒå°†çŠ¶æ€å­˜åœ¨è‡ªå·±ç®¡ç†çš„å¯¹è±¡å­˜å‚¨ä¸­ã€‚</p><p>åœ¨çŠ¶æ€å­˜å‚¨ä¸­ï¼Œç›¸æ¯”Terraformçš„Remote backendï¼ŒPulumiæœ‰ä¸¤ä¸ªéå¸¸é‡è¦çš„ç‰¹æ€§ã€‚</p><p>ç¬¬ä¸€ï¼ŒPulumiå¯¹çŠ¶æ€æ–‡ä»¶åšäº†åŠ å¯†ï¼Œå¹¶ä¸”é€šè¿‡TLSçš„æ–¹å¼ä¼ è¾“åˆ°Pulumi Cloudä¸Šã€‚è¿™ç‚¹åˆšå¥½å¼¥è¡¥äº†Terraformæ˜æ–‡çŠ¶æ€æ–‡ä»¶çš„å®‰å…¨é—®é¢˜ã€‚</p><p>ç¬¬äºŒï¼ŒTerraforméœ€è¦ä½¿ç”¨S3çš„ç‰ˆæœ¬ç®¡ç†åŠŸèƒ½æ‰èƒ½è®°å½•æ•´ä¸ªäº‘èµ„æºçš„æ›´æ”¹å†å²ï¼Œè€ŒPulumiå¤©ç„¶è‡ªå¸¦äº†CheckpointsåŠŸèƒ½ã€‚Pulumiæ¯æ¬¡æ›´æ–°éƒ½æ˜¯ä¸€ä¸ªCheckpointï¼Œè¿™æ ·å¦‚æœæˆ‘è¦å›æ»šåˆ°ä¸Šæ¬¡é…ç½®ï¼Œå¯ä»¥ç›´æ¥å°†é…ç½®å›æ»šåˆ°ä¸Šä¸€ä¸ªCheckpointçš„çŠ¶æ€ã€‚</p><p>é™¤äº†è¯­æ³•ã€çŠ¶æ€ç®¡ç†çš„ä¼˜åŠ¿ï¼ŒPulumè¿˜å†…ç½®äº†å¯¹æ•æ„Ÿä¿¡æ¯é…ç½®å’ŒåŠ å¯†å­˜å‚¨åŒ…å«æ•æ„Ÿä¿¡æ¯çš„èµ„æºï¼Œè¿™åœ¨åŸç”Ÿçš„ Terraform é‡Œæ˜¯ä¸æ”¯æŒçš„ã€‚å¦å¤–ï¼ŒPulumiæ”¯æŒç›´æ¥å°† Terraform é…ç½®æ–‡ä»¶è½¬æ¢æˆä»£ç ï¼Œå¸®ä½ å®Œæˆæ— ç¼åˆ‡æ¢ã€‚</p><p>å½“ç„¶ï¼ŒPulumiä¹Ÿæœ‰ä¸€äº›ä¸è¶³ã€‚é‡‡ç”¨ç¼–ç¨‹è¯­è¨€ä½œä¸ºIaCçš„é…ç½®çš„æè¿°æ–¹å¼ï¼Œå¯¹éå¼€å‘äººå‘˜æ¥è¯´æœ‰ä¸€äº›é—¨æ§›ã€‚Pulumiçš„è¯ç”Ÿæ—¶é—´æ™šäºTerraformï¼Œåœ¨ç”Ÿæ€ä¸Šæ¯”Terraformæ¥è¯´è¿˜æ˜¯å·®ä¸€äº›ã€‚</p><h2>æ€»ç»“</h2><p>è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å…ˆè¿ç”¨å¿«é€Ÿã€å¯é ã€å¯é‡å¤è¿™ä¸‰ä¸ªæ ‡å‡†ä½œä¸ºåŸºå‡†çº¿ï¼Œæ¢³ç†äº†IaCä¸»æµå·¥å…·ã€‚</p><p>å…¶ä¸­æœ€ç¬¦åˆæˆ‘ä»¬è¦æ±‚çš„å°±æ˜¯Terraformå’ŒPulumiã€‚å¯¹äºTerraformï¼Œä½ è¦é‡ç‚¹æŒæ¡å®ƒçš„åŸºæœ¬åŸç†å’Œæ’ä»¶æœºåˆ¶ã€‚</p><p>ä¹‹åï¼Œæˆ‘ä»¬æåˆ°äº†Terraformçš„ä¸è¶³ä¹‹å¤„ï¼Œæ²¡æœ‰å¾ˆå¥½çš„åŸç”ŸçŠ¶æ€æ–‡ä»¶çš„ç®¡ç†æœºåˆ¶ï¼Œä»¥åŠTerraformæ˜æ–‡çŠ¶æ€æ–‡ä»¶çš„å®‰å…¨é—®é¢˜ã€‚ç”±æ­¤å¼•å‡ºäº†æ›´æœ‰ä¼˜åŠ¿çš„Pulumiã€‚å¯¹äºPulumiï¼Œä½ éœ€è¦é‡ç‚¹æŒæ¡Pulumiçš„å·¥ä½œåŸç†ï¼Œäº†è§£Pulumiå¦‚ä½•å°†ä½ çš„ä»£ç è½¬åŒ–ä¸ºåŸºç¡€è®¾æ–½ä»¥åŠå¦‚ä½•å¤„ç†åŸºç¡€è®¾æ–½çš„çŠ¶æ€å’Œå˜æ›´ã€‚</p><p>è¿™ç§ä¸¤ç§é¢å‘èµ„æºç®¡ç†çš„IaCå·¥å…·å„æœ‰åƒç§‹ï¼Œå¦‚æœä½ çš„å…¬å¸é‡Œç°å­˜é¡¹ç›®ä¸­ä½¿ç”¨çš„æ˜¯Terraformï¼Œé‚£ä¹ˆå»ºè®®ä½ ä¾ç„¶ä½¿ç”¨Terraformï¼Œä¸è¦ä¸ºäº†å·¥å…·è€Œç»™è‡ªå·±å¢åŠ ä¸å¿…è¦çš„å·¥ä½œé‡ã€‚å¦‚æœä½ çš„å…¬å¸é‡Œæœ‰æ–°å¯åŠ¨çš„é¡¹ç›®ï¼Œå¯ä»¥è€ƒè™‘å°è¯•ä½¿ç”¨Pulumiä½œä¸ºä½ çš„IaCçš„å·¥å…·ã€‚</p><p>æ­¤æ—¶ä½ æ˜¯å¦éšéšæ„Ÿè§‰åˆ°ï¼Œä¼¼ä¹å¯ä»¥ç”¨Terraformæˆ–è€…PulumiåŒæ—¶ç®¡ç†ä¸æ­¢ä¸€ä¸ªäº‘å¹³å°ï¼Ÿä¸‹ä¸€è®²ï¼Œæˆ‘ä¼šå›´ç»•å¤šäº‘ç®¡ç†è¿™ä¸ªä¸»é¢˜ï¼Œç»§ç»­ä¸ºä½ è®²è§£å¦‚ä½•æ‰©å±•IaCçš„ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>è¯·ä½ å°è¯•å‚è€ƒTerraformçš„å®˜æ–¹æ–‡æ¡£ï¼Œå†™ä¸€æ®µTerraformçš„ä»£ç ï¼Œåœ¨AWSä¸Šå¯åŠ¨ä¸€ä¸ªEC2çš„å®ä¾‹ï¼Œç„¶ååœ¨è¿™ä¸ªå®ä¾‹ä¸­å¯åŠ¨httpæœåŠ¡å¹¶å¯¹å¤–æä¾›æœåŠ¡ã€‚</p><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„æ€è€ƒæˆ–ç–‘æƒ‘ã€‚å¦‚æœè¿™ä¸€è®²å¯¹ä½ æœ‰å¯å‘ï¼Œåˆ«å¿˜äº†åˆ†äº«ç»™èº«è¾¹æ›´å¤šæœ‹å‹ã€‚</p>","neighbors":{"left":{"article_title":"01ï½œå‘å±•å†ç¨‹ï¼šIaCè¿‡å»ã€ç°åœ¨ä¸æœªæ¥å±•æœ›","id":761828},"right":{"article_title":"03ï½œBottlerocketï¼šä¸ºäº‘åŸç”Ÿè€Œç”Ÿçš„å¼ºå¤§æ“ä½œç³»ç»Ÿ","id":762942}},"comments":[{"had_liked":false,"id":389600,"user_name":"alex run","can_delete":false,"product_type":"c1","uid":2864617,"ip_address":"ä¸Šæµ·","ucode":"1C6D7DC439316D","user_header":"https://static001.geekbang.org/account/avatar/00/2b/b5/e9/f1aa07d6.jpg","comment_is_top":false,"comment_ctime":1713000605,"is_pvip":false,"replies":[{"id":141758,"content":"Hi Alexï¼Œ\n\nAnsibleå’ŒPuppetçš„é—®é¢˜æ˜¯ä¸€æ ·çš„ï¼Œä»–ä»¬ä¸»è¦è¿˜æ˜¯é’ˆå¯¹ä¸»æœºé…ç½®ï¼Œå¯¹äº‘APIçš„æ”¯æŒèƒ½åŠ›è¾ƒå¼±ï¼Œåœ¨äº‘åŸç”Ÿé¢†åŸŸï¼Œä¸»æœºé…ç½®åŸºæœ¬ä¸Šè¢«Kubernetes+å®¹å™¨åŒ…åŠäº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1043450,"ctime":1713077240,"ip_address":"ä¸Šæµ·","comment_id":389600,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100758001,"comment_content":"è€å¸ˆï¼Œä¸ºä»€ä¹ˆè¯´ansibleæ˜¯ä¸å¯é‡å¤çš„å‘¢ï¼Ÿ ansibleæ“ä½œåŒä¸€èµ„æºï¼Œå¦‚æœé…ç½®æœ‰å˜åŒ–æ‰ä¼šchangeï¼Œæ²¡å˜åŒ–æ˜¯ä¸ä¼šæ‰§è¡Œçš„","like_count":0,"discussions":[{"author":{"id":1043450,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/eb/fa/5dc2bcae.jpg","nickname":"æ½˜é‡","note":"","ucode":"5B60CCA6C00359","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":641857,"discussion_content":"Hi Alexï¼Œ\n\nAnsibleå’ŒPuppetçš„é—®é¢˜æ˜¯ä¸€æ ·çš„ï¼Œä»–ä»¬ä¸»è¦è¿˜æ˜¯é’ˆå¯¹ä¸»æœºé…ç½®ï¼Œå¯¹äº‘APIçš„æ”¯æŒèƒ½åŠ›è¾ƒå¼±ï¼Œåœ¨äº‘åŸç”Ÿé¢†åŸŸï¼Œä¸»æœºé…ç½®åŸºæœ¬ä¸Šè¢«Kubernetes+å®¹å™¨åŒ…åŠäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1713077240,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1111985,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg","nickname":"ç¾å¦™çš„ä»£ç ","note":"","ucode":"9DADD72C193296","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":654954,"discussion_content":"ä¸»æœºé…ç½®ç”¨ansible æ˜¯å¯ä»¥çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1733878439,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å››å·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":389083,"user_name":"ğŸ­ ğŸ¹ ğŸ­ ğŸ¹ ğŸ­","can_delete":false,"product_type":"c1","uid":2772251,"ip_address":"æ²³å—","ucode":"44B3C088B96C12","user_header":"https://static001.geekbang.org/account/avatar/00/2a/4d/1b/062941b4.jpg","comment_is_top":false,"comment_ctime":1711531548,"is_pvip":false,"replies":[{"id":141580,"content":"è¿™é—¨è¯¾ä¸»è¦å…³æ³¨äº‘åŸç”ŸåŸºç¡€æ¶æ„è‡ªåŠ¨åŒ–æ–¹é¢å“¦","user_name":"ç¼–è¾‘å›å¤","user_name_real":"ç¼–è¾‘","uid":1501385,"ctime":1711538970,"ip_address":"åŒ—äº¬","comment_id":389083,"utype":2}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100758001,"comment_content":"è€å¸ˆä¹‹åä¼šæœ‰k8sç½‘ç»œé—®é¢˜çš„æ’æŸ¥è®²è§£å—","like_count":0,"discussions":[{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"å¬æ°´çš„æ¹–","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":640491,"discussion_content":"è¿™é—¨è¯¾ä¸»è¦å…³æ³¨äº‘åŸç”ŸåŸºç¡€æ¶æ„è‡ªåŠ¨åŒ–æ–¹é¢å“¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1711538970,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":8,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":389077,"user_name":"yayiyaya","can_delete":false,"product_type":"c1","uid":1615156,"ip_address":"æµ™æ±Ÿ","ucode":"38532C740FA186","user_header":"https://static001.geekbang.org/account/avatar/00/18/a5/34/6e3e962f.jpg","comment_is_top":false,"comment_ctime":1711508627,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100758001,"comment_content":"æ€è€ƒé¢˜ï¼š\nprovider &quot;aws&quot; {\n  region = &quot;us-east-1&quot;  \n}\n\nresource &quot;aws_instance&quot; &quot;example&quot; {\n  ami           = &quot;ami-0c55b159cbfafe1f0&quot;  \n  instance_type = &quot;t2.micro&quot;\n  tags = {\n    Name = &quot;example-instance&quot;\n  }\n\n  provisioner &quot;remote-exec&quot; {\n    inline = [\n      &quot;sudo yum install -y  httpd&quot;,\n      &quot;sudo systemctl start httpd&quot;,\n      &quot;sudo systemctl enable httpd&quot;\n    ]\n  }\n\n  connection {\n    type        = &quot;ssh&quot;\n    user        = &quot;ec2-user&quot;\n    private_key = file(&quot;~&#47;.ssh&#47;your_private_key.pem&quot;)  \n    host        = self.public_ip\n  }\n}\n\nresource &quot;aws_security_group&quot; &quot;http_sg&quot; {\n  name        = &quot;http_sg&quot;\n  description = &quot;Allow HTTP inbound traffic&quot;\n\n  ingress {\n    from_port   = 80\n    to_port     = 80\n    protocol    = &quot;tcp&quot;\n    cidr_blocks = [&quot;0.0.0.0&#47;0&quot;]\n  }\n\n  egress {\n    from_port   = 0\n    to_port     = 0\n    protocol    = &quot;-1&quot;\n    cidr_blocks = [&quot;0.0.0.0&#47;0&quot;]\n  }\n}\n","like_count":3},{"had_liked":false,"id":389824,"user_name":"äºŒåä¸‰","can_delete":false,"product_type":"c1","uid":3799894,"ip_address":"ä¸Šæµ·","ucode":"2CB7C5FF48AF3B","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Wo6BMoLTHHWTTg2y3jKIaA3TVuyxsd1a3f118GSiaymop7KHxxTkJwlxGb3qQMyBoD7t8y4lFbKVhHqhmf7Ngibw/132","comment_is_top":false,"comment_ctime":1713539145,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100758001,"comment_content":"æ€ä¹ˆæ„Ÿè§‰ä½¿ç”¨terraform å„ç§é…ç½®è¿˜è¦å­¦ä¹ è¯­æ³•ã€è¿˜ä¸å¦‚è‡ªå·±å†™ä»£ç å°è£…äº‘apiæ¥å£å•Šï¼Ÿ ","like_count":0,"discussions":[{"author":{"id":2026036,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/ea/34/178bd46b.jpg","nickname":"chongggggg","note":"","ucode":"5DD6A7F810F424","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":654911,"discussion_content":"é‚£ä¸å°±æ˜¯Pulumiçš„æ–¹å¼å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1733759880,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":389597,"user_name":"Joe Black","can_delete":false,"product_type":"c1","uid":1052528,"ip_address":"å±±ä¸œ","ucode":"21FE222A286445","user_header":"https://static001.geekbang.org/account/avatar/00/10/0f/70/cdef7a3d.jpg","comment_is_top":false,"comment_ctime":1712992993,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100758001,"comment_content":"Terraformå¥½åƒä¸è®©åœ¨ä¸­å›½ç”¨â€¦â€¦","like_count":0}]}