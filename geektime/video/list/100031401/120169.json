{"id":120169,"title":"62 | SkyWalking调用链监控实验","content":"<ul>\n<li>\n<p>代码：<a href=\"https://gitee.com/geektime-geekbang/staffjoy\">https://gitee.com/geektime-geekbang/staffjoy</a></p>\n</li>\n<li>\n<p>课件：<a href=\"https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ\">https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ</a> 提取码: 1aeh</p>\n</li>\n</ul>","comments":[{"had_liked":false,"id":135643,"user_name":"杨波","can_delete":false,"product_type":"c3","uid":1030344,"ip_address":"","ucode":"FA3418BB703BCA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","comment_is_top":true,"comment_ctime":1569233495,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"补充说明第五步：结束清理\n1. IDE里头的SpringBoot微服务，直接通过IDE上面的Stop结束按钮统一关闭即可。\n2. 在终端窗口中启动的两个单页应用，可以通过键盘ctrl + c结束进程。\n3. 在终端窗口启动的Skywalking服务器(进程名OAPServerStartUp)和Web Dashboard(进程名skywalking-webapp.jar)进程，先运行jps命令找到两者的进程号，然后kill 进程号即可，例如kill 4103和kill 4098。","like_count":3},{"had_liked":false,"id":129779,"user_name":"彩瓷菜","can_delete":false,"product_type":"c3","uid":1241843,"ip_address":"","ucode":"93A826B6D96618","user_header":"https://static001.geekbang.org/account/avatar/00/12/f2/f3/8fe906da.jpg","comment_is_top":false,"comment_ctime":1567247213,"is_pvip":false,"replies":[{"id":48635,"content":"加油！⛽️","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1567427472,"ip_address":"","comment_id":129779,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"这系列课真值啊！","like_count":5,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465645,"discussion_content":"加油！⛽️","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567427472,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":192978,"user_name":"arch","can_delete":false,"product_type":"c3","uid":1078931,"ip_address":"","ucode":"A69EBFE0520B85","user_header":"https://static001.geekbang.org/account/avatar/00/10/76/93/2e9bf8ab.jpg","comment_is_top":false,"comment_ctime":1584881246,"is_pvip":true,"replies":[{"id":74032,"content":"嗯，可以尝试下CAT，报表丰富粒度细致是CAT一大亮点。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1585057685,"ip_address":"","comment_id":192978,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":" skywalking 对于 JVM相关的报表还是不够细化，绝大时候还是要线上查看其他信息做调优","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488488,"discussion_content":"嗯，可以尝试下CAT，报表丰富粒度细致是CAT一大亮点。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585057685,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":169528,"user_name":"一念之间","can_delete":false,"product_type":"c3","uid":1562957,"ip_address":"","ucode":"25C6317C111F93","user_header":"https://static001.geekbang.org/account/avatar/00/17/d9/4d/4b95a228.jpg","comment_is_top":false,"comment_ctime":1578371890,"is_pvip":false,"replies":[{"id":65814,"content":"首先，确保你的镜像里头有skywalking agent jar(可以登到容器里头看具体在哪个目录)，然后dockerfile启动项ENTRYPOINT: \n\njava -javaagent:&#47;path&#47;to&#47;skywalking-agent&#47;skywalking-agent.jar -jar yourApp.jar\n\n参考：\nhttps:&#47;&#47;github.com&#47;apache&#47;skywalking&#47;blob&#47;master&#47;docs&#47;en&#47;setup&#47;service-agent&#47;java-agent&#47;README.md\n\n","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1578397678,"ip_address":"","comment_id":169528,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"波波老师您好：根据您的建议我基于openjdk和skyworkingAgent构建了自己的镜像，并且基于新的openjdk构建了微服务，怎么在docker中启动的同时让自动监控我的服务，启动命令是什么？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480598,"discussion_content":"首先，确保你的镜像里头有skywalking agent jar(可以登到容器里头看具体在哪个目录)，然后dockerfile启动项ENTRYPOINT: \n\njava -javaagent:/path/to/skywalking-agent/skywalking-agent.jar -jar yourApp.jar\n\n参考：\nhttps://github.com/apache/skywalking/blob/master/docs/en/setup/service-agent/java-agent/README.md\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578397678,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":165890,"user_name":"一念之间","can_delete":false,"product_type":"c3","uid":1562957,"ip_address":"","ucode":"25C6317C111F93","user_header":"https://static001.geekbang.org/account/avatar/00/17/d9/4d/4b95a228.jpg","comment_is_top":false,"comment_ctime":1577341283,"is_pvip":false,"replies":[{"id":63277,"content":"可以用skywalking官方提供的docker base镜像：\nhttps:&#47;&#47;hub.docker.com&#47;r&#47;apache&#47;skywalking-base\nhttps:&#47;&#47;github.com&#47;apache&#47;skywalking-docker\n\n不到200m，大小还可以。如果你还嫌大，可以再定制，只需把agent目录下面的jar和一下需要的插件，打到openjdk:8-jre-alpine基础镜像中即可。\n","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1577359394,"ip_address":"","comment_id":165890,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"波波老师您好：我们的微服务是通过docker容器启动的，怎么使用skyWalking呢，每个微服务都加载agent构建镜像，镜像文件会很大，有没有更好的方法\n","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":479308,"discussion_content":"可以用skywalking官方提供的docker base镜像：\nhttps://hub.docker.com/r/apache/skywalking-base\nhttps://github.com/apache/skywalking-docker\n\n不到200m，大小还可以。如果你还嫌大，可以再定制，只需把agent目录下面的jar和一下需要的插件，打到openjdk:8-jre-alpine基础镜像中即可。\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577359394,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":134288,"user_name":"0xABC","can_delete":false,"product_type":"c3","uid":1019555,"ip_address":"","ucode":"E64CD8BED96D8D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8e/a3/d7e5fe8a.jpg","comment_is_top":false,"comment_ctime":1568795980,"is_pvip":false,"replies":[{"id":51513,"content":"这个是事务transaction问题，因为这里是对company-db一个数据库的操作，可以把这些操作都包在一个transaction里头(可以参考spring transaction支持)，任何一步抛异常可以回滚rollback已经执行的所有操作，只有所有步骤都正确执行才一起批量提交commit。也可以简单什么也不做，记录异常日志，后续人工干预纠正即可。\n\n如果是跨库分布式事务，就会比较复杂，已经超出这门课的scope。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1568813386,"ip_address":"","comment_id":134288,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"老师您好，在代码里 new_company 接口在 www-service 中调用了company-svc，调用的方式是挨个调用company-svc的 createCompany, createDirectory, createAdmin, createTeam, 在每个调用时处理异常，一旦有error就抛出异常；我的问题是如果说在createAdmin的时候出错了，抛出异常，admin就没有执行成功，后面的createTeam也没有执行，但是前边的createCompany和createDirectory已经执行成功，这样数据是不完整的，这种情况一般要怎么处理呢？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467692,"discussion_content":"这个是事务transaction问题，因为这里是对company-db一个数据库的操作，可以把这些操作都包在一个transaction里头(可以参考spring transaction支持)，任何一步抛异常可以回滚rollback已经执行的所有操作，只有所有步骤都正确执行才一起批量提交commit。也可以简单什么也不做，记录异常日志，后续人工干预纠正即可。\n\n如果是跨库分布式事务，就会比较复杂，已经超出这门课的scope。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568813386,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1481811,"avatar":"https://static001.geekbang.org/account/avatar/00/16/9c/53/ade0afb0.jpg","nickname":"ub8","note":"","ucode":"0D937C3EAEB781","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382667,"discussion_content":"如果不是单体微服务，如何用agent","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625664910,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":191334,"user_name":"钱","can_delete":false,"product_type":"c3","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1584764330,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"这个如果放在最前面先展示一下效果估计能吸引到更多的同学一起学习，skywalking这个工具很强大呀!\n课程很棒，给老师点赞!","like_count":2},{"had_liked":false,"id":387034,"user_name":"向显","can_delete":false,"product_type":"c3","uid":2102748,"ip_address":"湖北","ucode":"DD6B3D61D39000","user_header":"https://static001.geekbang.org/account/avatar/00/20/15/dc/45f68b76.jpg","comment_is_top":false,"comment_ctime":1706192546,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"老师你好, 实际生产环境中,调用的日志和信息是很多的, skywalking 是如何存储和淘汰这些信息的呢? 日志过多后期是否有性能问题?","like_count":0},{"had_liked":false,"id":272620,"user_name":"草裡菌","can_delete":false,"product_type":"c3","uid":1241514,"ip_address":"","ucode":"E11C630ABA4370","user_header":"https://static001.geekbang.org/account/avatar/00/12/f1/aa/c29def94.jpg","comment_is_top":false,"comment_ctime":1610177839,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"人是视觉动物！","like_count":0}]}