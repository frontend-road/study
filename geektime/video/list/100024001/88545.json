{"id":88545,"title":"44 | easyjson","content":"<h1>课件及源代码地址</h1><p><a href=\"https://gitee.com/geektime-geekbang/go_learning\">https://gitee.com/geektime-geekbang/go_learning</a></p><h2>书目推荐</h2><p><a href=\"time://mall?url=https%3A%2F%2Fh5.youzan.com%2Fv2%2Fgoods%2F1ycmk3uob0ryw\">《计算机程序的构造和解释》</a></p>","comments":[{"had_liked":false,"id":113232,"user_name":"率毛毛虫","can_delete":false,"product_type":"c3","uid":1581729,"ip_address":"","ucode":"7102087B53E239","user_header":"https://static001.geekbang.org/account/avatar/00/18/22/a1/791d0f5e.jpg","comment_is_top":false,"comment_ctime":1562921300,"is_pvip":false,"replies":[{"id":41246,"content":"type BasicInfo struct {\n\tName string `json:&quot;name&quot;`\n\tAge  int    `json:&quot;age&quot;`\n}\n\n&#47;&#47;easyjson:json\ntype BasicInfoList []BasicInfo\n\n注意：&#47;&#47;easyjson:json 这个注释是必须要的，否则easyJson会忽略这个非struct类型\n\nfunc TestEasyJson(t *testing.T) {\n\te1 := BasicInfo{&quot;Mike&quot;, 10}\n\te2 := BasicInfo{&quot;Rose&quot;, 11}\n\teList := BasicInfoList{e1, e2}\n\tv, _ := eList.MarshalJSON()\n\tfmt.Println(string(v))\n}\n\n&#47;&#47;output:\n[{&quot;name&quot;:&quot;Mike&quot;,&quot;age&quot;:10},{&quot;name&quot;:&quot;Rose&quot;,&quot;age&quot;:11}]","user_name":"作者回复","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1562942982,"ip_address":"","comment_id":113232,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"老师，我有一个疑问，struct如下:\ntype Person struct {\nAge int\nName string\n}\n使用easyjson如何将var p []Person 的数据转换json\n","like_count":4,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"蔡超","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458119,"discussion_content":"type BasicInfo struct {\n\tName string `json:&amp;quot;name&amp;quot;`\n\tAge  int    `json:&amp;quot;age&amp;quot;`\n}\n\n//easyjson:json\ntype BasicInfoList []BasicInfo\n\n注意：//easyjson:json 这个注释是必须要的，否则easyJson会忽略这个非struct类型\n\nfunc TestEasyJson(t *testing.T) {\n\te1 := BasicInfo{&amp;quot;Mike&amp;quot;, 10}\n\te2 := BasicInfo{&amp;quot;Rose&amp;quot;, 11}\n\teList := BasicInfoList{e1, e2}\n\tv, _ := eList.MarshalJSON()\n\tfmt.Println(string(v))\n}\n\n//output:\n[{&amp;quot;name&amp;quot;:&amp;quot;Mike&amp;quot;,&amp;quot;age&amp;quot;:10},{&amp;quot;name&amp;quot;:&amp;quot;Rose&amp;quot;,&amp;quot;age&amp;quot;:11}]","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562942982,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1020525,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","nickname":"escray","note":"","ucode":"1F4204930E47C4","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366959,"discussion_content":"为什么把 JSON 的结构定义和 go 程序写到了一起？这样就没有办法生成 easyJSON 文件，或者即使生成了 JSON 但是也没法自动调用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618225017,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1581729,"avatar":"https://static001.geekbang.org/account/avatar/00/18/22/a1/791d0f5e.jpg","nickname":"率毛毛虫","note":"","ucode":"7102087B53E239","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1852,"discussion_content":"package main\n\ntype Basicinfo struct {\n\tName string `json:&#34;name&#34;`\n\tAge int `json:&#34;age&#34;`\n}\n\ntype BasicInfoList []Basicinfo\n\n\nfunc main() {\n\te1 := Basicinfo{&#34;zyb&#34;,30}\n\te2 := Basicinfo{&#34;gxj&#34;,29}\n\n\tvar elist BasicInfoList\n\telist=append(elist, e1)\n\telist=append(elist,e2)\n\n\tv,_:=elist.MarshalJSON() //无法调取\n\tfmt.Println(string(v))\n}\n提示错误信息\neasyjson/main.go:6:8: undefined: Basicinfo\neasyjson/main.go:7:8: undefined: Basicinfo\neasyjson/main.go:8:12: undefined: BasicInfoList","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563000175,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":144286,"user_name":"碧雪天虹","can_delete":false,"product_type":"c3","uid":1258359,"ip_address":"","ucode":"313CC048C7E341","user_header":"https://static001.geekbang.org/account/avatar/00/13/33/77/0c593044.jpg","comment_is_top":false,"comment_ctime":1571888071,"is_pvip":false,"replies":[{"id":55915,"content":"源码要位于GOPATH&#47;src路径下。\n可以按如下步骤解决：\n1. cp -r ~&#47;go_learning&#47;code&#47;ch43&#47;easyjson ~&#47;go_learning&#47;code&#47;ch43&#47;easyjson&#47;src\n\n2. export GOPATH=~&#47;go_learning&#47;code&#47;ch43&#47;easyjson:$GOPATH\n\n这样就可以了","user_name":"作者回复","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1572178150,"ip_address":"","comment_id":144286,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"~&#47;go\n~&#47;go_learning\n~&#47;go_learning&#47;code&#47;ch43&#47;easyjson\n\n都配置到GOPATH环境变量了, 但是在~&#47;go_learning&#47;code&#47;ch43&#47;easyjson目录下执行\n~&#47;go&#47;bin&#47;easyjson -all struct_def.go 还是提示\nError parsing struct_def.go: file &#39;~&#47;go_learning&#47;code&#47;ch43&#47;easyjson&#47;struct_def.go&#39; is not in GOPATH\n\nwindows 和 centos 下都是这样","like_count":2,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"蔡超","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471875,"discussion_content":"源码要位于GOPATH/src路径下。\n可以按如下步骤解决：\n1. cp -r ~/go_learning/code/ch43/easyjson ~/go_learning/code/ch43/easyjson/src\n\n2. export GOPATH=~/go_learning/code/ch43/easyjson:$GOPATH\n\n这样就可以了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572178150,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1396924,"avatar":"https://static001.geekbang.org/account/avatar/00/15/50/bc/ce5c5834.jpg","nickname":"小黄本黄","note":"","ucode":"C77E7634AD36DA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":154903,"discussion_content":"感谢，遇到同样的问题，已解决","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580196991,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":98015,"user_name":"Jee","can_delete":false,"product_type":"c3","uid":1198458,"ip_address":"","ucode":"B80BBF2D2EB116","user_header":"https://static001.geekbang.org/account/avatar/00/12/49/7a/b567de82.jpg","comment_is_top":false,"comment_ctime":1558873400,"is_pvip":false,"replies":[{"id":35068,"content":"如果没有你自己用$GOPATH&#47;src里的源码build一下生产即可","user_name":"作者回复","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1558882789,"ip_address":"","comment_id":98015,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"老师 打扰下 我mac里 go bin 里没有 easyjson可执行文件 是为什么呢","like_count":2,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"蔡超","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451517,"discussion_content":"如果没有你自己用$GOPATH/src里的源码build一下生产即可","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558882789,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2091390,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/e9/7e/5d02769c.jpg","nickname":"卜凌峰","note":"","ucode":"849C3C3ED367E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":298067,"discussion_content":"我的环境bin这个目录都没有","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1597160512,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":95489,"user_name":"Geek_3c1bf0","can_delete":false,"product_type":"c3","uid":1144562,"ip_address":"","ucode":"015DD8F52FD1DA","user_header":"http://thirdwx.qlogo.cn/mmopen/h0KAdRFKjCOSLRjzictvlaBy8iaEwiaY7t90KQhVV2zWdOE4eGAlcDLL1iaI0ONBaQHMf8lSTticPkNqLTIHQFbB1Al7HKFlEicBbx/132","comment_is_top":false,"comment_ctime":1558063428,"is_pvip":false,"replies":[{"id":34491,"content":"可以利用interface｛｝来完成。参见 http:&#47;&#47;songran.net&#47;2017&#47;03&#47;08&#47;golang_parse_json&#47;","user_name":"作者回复","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1558402823,"ip_address":"","comment_id":95489,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"老师，对于不定格式的Json，Python语言直接Json.loads就可以了，在Go中该如何处理呢？","like_count":2,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"蔡超","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450478,"discussion_content":"可以利用interface｛｝来完成。参见 http://songran.net/2017/03/08/golang_parse_json/","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558402823,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":238473,"user_name":"松小鼠","can_delete":false,"product_type":"c3","uid":1239277,"ip_address":"","ucode":"2AAA36A7C3AD75","user_header":"https://static001.geekbang.org/account/avatar/00/12/e8/ed/f9347e5e.jpg","comment_is_top":false,"comment_ctime":1596177403,"is_pvip":false,"replies":[{"id":88418,"content":"简而言之，如果程序对性能要求很高，jsonparser不能很好的满足要求，就使用easyJson","user_name":"作者回复","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1596520848,"ip_address":"","comment_id":238473,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"老师，esayjson 和 jsonparser哪个更好点？各使用在什么场景？\n","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"蔡超","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":502762,"discussion_content":"简而言之，如果程序对性能要求很高，jsonparser不能很好的满足要求，就使用easyJson","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596520848,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":316375,"user_name":"芒果少侠","can_delete":false,"product_type":"c3","uid":1350159,"ip_address":"","ucode":"98D0BBB52BB80F","user_header":"https://static001.geekbang.org/account/avatar/00/14/9a/0f/da7ed75a.jpg","comment_is_top":false,"comment_ctime":1634290556,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"go内置的json利用反射实现，性能较差，仅适用于配置文件解析，对于高并发或qps要求较高的场景谨慎使用。","like_count":3},{"had_liked":false,"id":368980,"user_name":"Kurtz","can_delete":false,"product_type":"c3","uid":1316702,"ip_address":"上海","ucode":"104CBD264B774B","user_header":"https://static001.geekbang.org/account/avatar/00/14/17/5e/59c7ef53.jpg","comment_is_top":false,"comment_ctime":1676966839,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"为啥录播一只有回声，实大实小的，老师的声音听上去发闷，每次必须把声音开比较大， 才能听清","like_count":2},{"had_liked":false,"id":381351,"user_name":"Geek_6c683d","can_delete":false,"product_type":"c3","uid":3710585,"ip_address":"上海","ucode":"02460FDD1E508E","user_header":"","comment_is_top":false,"comment_ctime":1695091020,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"哎呀呀，我在~&#47;go&#47;bin下找不到easyjson，后来搜了下，可能这个视频录制的比较早，在1.16版本之后，go get命令的编译和安装功能被弃用，只保留了获取源代码和更新依赖项的功能。\n\n所以只能只用 go install 来替换go get","like_count":0},{"had_liked":false,"id":287938,"user_name":"escray","can_delete":false,"product_type":"c3","uid":1020525,"ip_address":"","ucode":"1F4204930E47C4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","comment_is_top":false,"comment_ctime":1618225411,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"看了一眼 easyjson 生成的 go 文件，非常晦涩难懂，不过我猜，大概的意思是把原本需要反射才能做到事情，拆开了，平铺直叙，相当于是把一些工作提前准备好，以此来提高效率。","like_count":0},{"had_liked":false,"id":174611,"user_name":"小黄本黄","can_delete":false,"product_type":"c3","uid":1396924,"ip_address":"","ucode":"C77E7634AD36DA","user_header":"https://static001.geekbang.org/account/avatar/00/15/50/bc/ce5c5834.jpg","comment_is_top":false,"comment_ctime":1580294371,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"老师，有个问题，在生成的 ejStruct_easyjson.go 文件中，\nimport (\n\tsrc &quot;_&#47;Users&#47;apple&#47;GoProjects&#47;BasicLearning&#47;src&quot;\n这个路径报错，提示 can&#39;t find package in any of ... (from $GOPATH) ...(from $GOROOT)，使用 go env GOPATH 查看了 \b$GOPATH: &#47;Users&#47;apple&#47;GoProjects&#47;BasicLearning:&#47;Users&#47;apple&#47;go，是哪里不对呢\n","like_count":0},{"had_liked":false,"id":173579,"user_name":"Tank_秋","can_delete":false,"product_type":"c3","uid":1021861,"ip_address":"","ucode":"47634473082E0A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/97/a5/791d0f5e.jpg","comment_is_top":false,"comment_ctime":1579600247,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"func easyjson6a975c40EncodeCh47(out *jwriter.Writer, in Response) {\n\tout.RawByte(&#39;{&#39;)\n\tfirst := true\n\t_ = first  &#47;&#47; 这是为什么呢\n        &#47;&#47; 下面这两段的括号又是什么作用?\n\t{\n\t\tconst prefix string = &quot;,\\&quot;transaction_id\\&quot;:&quot;\n\t\tif first {\n\t\t\tfirst = false\n\t\t\tout.RawString(prefix[1:])\n\t\t} else {\n\t\t\tout.RawString(prefix)\n\t\t}\n\t\tout.String(string(in.TransactionID))\n\t}\n\t{\n\t\tconst prefix string = &quot;,\\&quot;exp\\&quot;:&quot;\n\t\tif first {\n\t\t\tfirst = false\n\t\t\tout.RawString(prefix[1:])\n\t\t} else {\n\t\t\tout.RawString(prefix)\n\t\t}\n\t\tout.String(string(in.Expression))\n\t}\n\tout.RawByte(&#39;}&#39;)\n}","like_count":0},{"had_liked":false,"id":98491,"user_name":"Geek_3c1bf0","can_delete":false,"product_type":"c3","uid":1144562,"ip_address":"","ucode":"015DD8F52FD1DA","user_header":"http://thirdwx.qlogo.cn/mmopen/h0KAdRFKjCOSLRjzictvlaBy8iaEwiaY7t90KQhVV2zWdOE4eGAlcDLL1iaI0ONBaQHMf8lSTticPkNqLTIHQFbB1Al7HKFlEicBbx/132","comment_is_top":false,"comment_ctime":1559010938,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"老师您好，对于多态的数据结构。该如何转换成bson和json。如果获得到bson、json数据该如何映射成多态的结构啊？\n自己在网上搜索了好多，都没有发现一个完整的解决方案。有没有相关的示例啊。","like_count":0}]}