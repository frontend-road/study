{"id":100861,"title":"11 | ç­”ç–‘è¯¾å ‚ï¼šæ·±å…¥äº†è§£NIOçš„ä¼˜åŒ–å®ç°åŸç†","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯åˆ˜è¶…ã€‚ä¸“æ ä¸Šçº¿å·²ç»æœ‰20å¤šå¤©çš„æ—¶é—´äº†ï¼Œé¦–å…ˆè¦æ„Ÿè°¢å„ä½åŒå­¦çš„ç§¯æç•™è¨€ï¼Œäº¤æµçš„è¿‡ç¨‹ä½¿æˆ‘ä¹Ÿæ”¶è·è‰¯å¥½ã€‚</p><p>ç»¼åˆæŸ¥çœ‹å®Œè¿‘æœŸçš„ç•™è¨€ä»¥åï¼Œæˆ‘çš„ç¬¬ä¸€ç¯‡ç­”ç–‘è¯¾å ‚å°±é¡ºåŠ¿è¯ç”Ÿäº†ã€‚æˆ‘å°†ç»§ç»­è®²è§£I/Oä¼˜åŒ–ï¼Œå¯¹å¤§å®¶åœ¨08è®²ä¸­æåˆ°çš„å†…å®¹åšé‡ç‚¹è¡¥å……ï¼Œå¹¶å»¶ä¼¸ä¸€äº›æœ‰å…³I/Oçš„çŸ¥è¯†ç‚¹ï¼Œæ›´å¤šç»“åˆå®é™…åœºæ™¯è¿›è¡Œåˆ†äº«ã€‚è¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬é©¬ä¸Šåˆ‡å…¥æ­£é¢˜ã€‚</p><p>Tomcatä¸­ç»å¸¸è¢«æåˆ°çš„ä¸€ä¸ªè°ƒä¼˜å°±æ˜¯ä¿®æ”¹çº¿ç¨‹çš„I/Oæ¨¡å‹ã€‚<span class=\"orange\">Tomcat 8.5ç‰ˆæœ¬ä¹‹å‰ï¼Œé»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨çš„æ˜¯BIOçº¿ç¨‹æ¨¡å‹ï¼Œå¦‚æœåœ¨é«˜è´Ÿè½½ã€é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®NIOçº¿ç¨‹æ¨¡å‹ï¼Œæ¥æé«˜ç³»ç»Ÿçš„ç½‘ç»œé€šä¿¡æ€§èƒ½ã€‚</span></p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªæ€§èƒ½å¯¹æ¯”æµ‹è¯•æ¥çœ‹çœ‹åœ¨é«˜è´Ÿè½½æˆ–é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼ŒBIOå’ŒNIOé€šä¿¡æ€§èƒ½ï¼ˆè¿™é‡Œç”¨é¡µé¢è¯·æ±‚æ¨¡æ‹Ÿå¤šI/Oè¯»å†™æ“ä½œçš„è¯·æ±‚ï¼‰ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/3e/4a/3e66a63ce9f0d9722005f78fa960244a.png?wh=934*518\" alt=\"\"></p><p><img src=\"https://static001.geekbang.org/resource/image/3e/74/3e1d942b7e5e09ad6e4757b8d5cbe274.png?wh=935*521\" alt=\"\"></p><p><strong>æµ‹è¯•ç»“æœï¼šTomcatåœ¨I/Oè¯»å†™æ“ä½œæ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨NIOçº¿ç¨‹æ¨¡å‹æœ‰æ˜æ˜¾çš„ä¼˜åŠ¿ã€‚</strong></p><p>Tomcatä¸­çœ‹ä¼¼ä¸€ä¸ªç®€å•çš„é…ç½®ï¼Œå…¶ä¸­å´åŒ…å«äº†å¤§é‡çš„ä¼˜åŒ–å‡çº§çŸ¥è¯†ç‚¹ã€‚ä¸‹é¢æˆ‘ä»¬å°±ä»åº•å±‚çš„ç½‘ç»œI/Oæ¨¡å‹ä¼˜åŒ–å‡ºå‘ï¼Œå†åˆ°å†…å­˜æ‹·è´ä¼˜åŒ–å’Œçº¿ç¨‹æ¨¡å‹ä¼˜åŒ–ï¼Œæ·±å…¥åˆ†æä¸‹Tomcatã€Nettyç­‰é€šä¿¡æ¡†æ¶æ˜¯å¦‚ä½•é€šè¿‡ä¼˜åŒ–I/Oæ¥æé«˜ç³»ç»Ÿæ€§èƒ½çš„ã€‚</p><h2>ç½‘ç»œI/Oæ¨¡å‹ä¼˜åŒ–</h2><p>ç½‘ç»œé€šä¿¡ä¸­ï¼Œæœ€åº•å±‚çš„å°±æ˜¯å†…æ ¸ä¸­çš„ç½‘ç»œI/Oæ¨¡å‹äº†ã€‚éšç€æŠ€æœ¯çš„å‘å±•ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸çš„ç½‘ç»œæ¨¡å‹è¡ç”Ÿå‡ºäº†äº”ç§I/Oæ¨¡å‹ï¼Œã€ŠUNIXç½‘ç»œç¼–ç¨‹ã€‹ä¸€ä¹¦å°†è¿™äº”ç§I/Oæ¨¡å‹åˆ†ä¸ºé˜»å¡å¼I/Oã€éé˜»å¡å¼I/Oã€I/Oå¤ç”¨ã€ä¿¡å·é©±åŠ¨å¼I/Oå’Œå¼‚æ­¥I/Oã€‚æ¯ä¸€ç§I/Oæ¨¡å‹çš„å‡ºç°ï¼Œéƒ½æ˜¯åŸºäºå‰ä¸€ç§I/Oæ¨¡å‹çš„ä¼˜åŒ–å‡çº§ã€‚</p><!-- [[[read_end]]] --><p>æœ€å¼€å§‹çš„é˜»å¡å¼I/Oï¼Œå®ƒåœ¨æ¯ä¸€ä¸ªè¿æ¥åˆ›å»ºæ—¶ï¼Œéƒ½éœ€è¦ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹æ¥å¤„ç†ï¼Œå¹¶ä¸”åœ¨I/Oæ“ä½œæ²¡æœ‰å°±ç»ªæˆ–ç»“æŸæ—¶ï¼Œçº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œè¿›å…¥é˜»å¡ç­‰å¾…çŠ¶æ€ï¼Œé˜»å¡å¼I/Oå°±æˆä¸ºäº†å¯¼è‡´æ€§èƒ½ç“¶é¢ˆçš„æ ¹æœ¬åŸå› ã€‚</p><p><strong>é‚£é˜»å¡åˆ°åº•å‘ç”Ÿåœ¨å¥—æ¥å­—ï¼ˆsocketï¼‰é€šä¿¡çš„å“ªäº›ç¯èŠ‚å‘¢ï¼Ÿ</strong></p><p>åœ¨ã€ŠUnixç½‘ç»œç¼–ç¨‹ã€‹ä¸­ï¼Œå¥—æ¥å­—é€šä¿¡å¯ä»¥åˆ†ä¸ºæµå¼å¥—æ¥å­—ï¼ˆTCPï¼‰å’Œæ•°æ®æŠ¥å¥—æ¥å­—ï¼ˆUDPï¼‰ã€‚å…¶ä¸­TCPè¿æ¥æ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„ï¼Œä¸€èµ·æ¥äº†è§£ä¸‹TCPæœåŠ¡ç«¯çš„å·¥ä½œæµç¨‹ï¼ˆç”±äºTCPçš„æ•°æ®ä¼ è¾“æ¯”è¾ƒå¤æ‚ï¼Œå­˜åœ¨æ‹†åŒ…å’Œè£…åŒ…çš„å¯èƒ½ï¼Œè¿™é‡Œæˆ‘åªå‡è®¾ä¸€æ¬¡æœ€ç®€å•çš„TCPæ•°æ®ä¼ è¾“ï¼‰ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/33/41/3310cc063aaf19f2aeb9ea5bc3188e41.jpg?wh=1042*1292\" alt=\"\"></p><ul>\n<li>é¦–å…ˆï¼Œåº”ç”¨ç¨‹åºé€šè¿‡ç³»ç»Ÿè°ƒç”¨socketåˆ›å»ºä¸€ä¸ªå¥—æ¥å­—ï¼Œå®ƒæ˜¯ç³»ç»Ÿåˆ†é…ç»™åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼›</li>\n<li>å…¶æ¬¡ï¼Œåº”ç”¨ç¨‹åºä¼šé€šè¿‡ç³»ç»Ÿè°ƒç”¨bindï¼Œç»‘å®šåœ°å€å’Œç«¯å£å·ï¼Œç»™å¥—æ¥å­—å‘½åä¸€ä¸ªåç§°ï¼›</li>\n<li>ç„¶åï¼Œç³»ç»Ÿä¼šè°ƒç”¨listenåˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ç”¨äºå­˜æ”¾å®¢æˆ·ç«¯è¿›æ¥çš„è¿æ¥ï¼›</li>\n<li>æœ€åï¼Œåº”ç”¨æœåŠ¡ä¼šé€šè¿‡ç³»ç»Ÿè°ƒç”¨acceptæ¥ç›‘å¬å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚</li>\n</ul><p>å½“æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡ç«¯ä¹‹åï¼ŒæœåŠ¡ç«¯å°±ä¼šè°ƒç”¨forkåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œé€šè¿‡ç³»ç»Ÿè°ƒç”¨readç›‘å¬å®¢æˆ·ç«¯å‘æ¥çš„æ¶ˆæ¯ï¼Œå†é€šè¿‡writeå‘å®¢æˆ·ç«¯è¿”å›ä¿¡æ¯ã€‚</p><h3>1.é˜»å¡å¼I/O</h3><p>åœ¨æ•´ä¸ªsocketé€šä¿¡å·¥ä½œæµç¨‹ä¸­ï¼Œsocketçš„é»˜è®¤çŠ¶æ€æ˜¯é˜»å¡çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å‘å‡ºä¸€ä¸ªä¸èƒ½ç«‹å³å®Œæˆçš„å¥—æ¥å­—è°ƒç”¨æ—¶ï¼Œå…¶è¿›ç¨‹å°†è¢«é˜»å¡ï¼Œè¢«ç³»ç»ŸæŒ‚èµ·ï¼Œè¿›å…¥ç¡çœ çŠ¶æ€ï¼Œä¸€ç›´ç­‰å¾…ç›¸åº”çš„æ“ä½œå“åº”ã€‚ä»ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå¯èƒ½å­˜åœ¨çš„é˜»å¡ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸‰ç§ã€‚</p><p><strong>connecté˜»å¡</strong>ï¼šå½“å®¢æˆ·ç«¯å‘èµ·TCPè¿æ¥è¯·æ±‚ï¼Œé€šè¿‡ç³»ç»Ÿè°ƒç”¨connectå‡½æ•°ï¼ŒTCPè¿æ¥çš„å»ºç«‹éœ€è¦å®Œæˆä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ï¼Œå®¢æˆ·ç«¯éœ€è¦ç­‰å¾…æœåŠ¡ç«¯å‘é€å›æ¥çš„ACKä»¥åŠSYNä¿¡å·ï¼ŒåŒæ ·æœåŠ¡ç«¯ä¹Ÿéœ€è¦é˜»å¡ç­‰å¾…å®¢æˆ·ç«¯ç¡®è®¤è¿æ¥çš„ACKä¿¡å·ï¼Œè¿™å°±æ„å‘³ç€TCPçš„æ¯ä¸ªconnectéƒ½ä¼šé˜»å¡ç­‰å¾…ï¼Œç›´åˆ°ç¡®è®¤è¿æ¥ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/2a/c9/2a208cf7dddf18d2fe813b75ef2f4ac9.png?wh=1143*640\" alt=\"\"></p><p><strong>accepté˜»å¡</strong>ï¼šä¸€ä¸ªé˜»å¡çš„socketé€šä¿¡çš„æœåŠ¡ç«¯æ¥æ”¶å¤–æ¥è¿æ¥ï¼Œä¼šè°ƒç”¨acceptå‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰æ–°çš„è¿æ¥åˆ°è¾¾ï¼Œè°ƒç”¨è¿›ç¨‹å°†è¢«æŒ‚èµ·ï¼Œè¿›å…¥é˜»å¡çŠ¶æ€ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/3f/96/3fc5ef2eb6e594fd7d5cbc358cd5dd96.png?wh=1142*640\" alt=\"\"></p><p><strong>readã€writeé˜»å¡</strong>ï¼šå½“ä¸€ä¸ªsocketè¿æ¥åˆ›å»ºæˆåŠŸä¹‹åï¼ŒæœåŠ¡ç«¯ç”¨forkå‡½æ•°åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œ è°ƒç”¨readå‡½æ•°ç­‰å¾…å®¢æˆ·ç«¯çš„æ•°æ®å†™å…¥ï¼Œå¦‚æœæ²¡æœ‰æ•°æ®å†™å…¥ï¼Œè°ƒç”¨å­è¿›ç¨‹å°†è¢«æŒ‚èµ·ï¼Œè¿›å…¥é˜»å¡çŠ¶æ€ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/e1/cf/e14386a357185acc39fdc708fb3692cf.png?wh=1142*640\" alt=\"\"></p><h3>2.éé˜»å¡å¼I/O</h3><p><span class=\"orange\">ä½¿ç”¨fcntlå¯ä»¥æŠŠä»¥ä¸Šä¸‰ç§æ“ä½œéƒ½è®¾ç½®ä¸ºéé˜»å¡æ“ä½œã€‚</span>å¦‚æœæ²¡æœ‰æ•°æ®è¿”å›ï¼Œå°±ä¼šç›´æ¥è¿”å›ä¸€ä¸ªEWOULDBLOCKæˆ–EAGAINé”™è¯¯ï¼Œæ­¤æ—¶è¿›ç¨‹å°±ä¸ä¼šä¸€ç›´è¢«é˜»å¡ã€‚</p><p>å½“æˆ‘ä»¬æŠŠä»¥ä¸Šæ“ä½œè®¾ç½®ä¸ºäº†éé˜»å¡çŠ¶æ€ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸ªçº¿ç¨‹å¯¹è¯¥æ“ä½œè¿›è¡Œè½®è¯¢æ£€æŸ¥ï¼Œè¿™ä¹Ÿæ˜¯æœ€ä¼ ç»Ÿçš„éé˜»å¡I/Oæ¨¡å‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/ec/62/ec2ec7914b3b86a1965dc98a830a3a62.png?wh=1142*640\" alt=\"\"></p><h3>3. I/Oå¤ç”¨</h3><p>å¦‚æœä½¿ç”¨ç”¨æˆ·çº¿ç¨‹è½®è¯¢æŸ¥çœ‹ä¸€ä¸ªI/Oæ“ä½œçš„çŠ¶æ€ï¼Œåœ¨å¤§é‡è¯·æ±‚çš„æƒ…å†µä¸‹ï¼Œè¿™å¯¹äºCPUçš„ä½¿ç”¨ç‡æ— ç–‘æ˜¯ç§ç¾éš¾ã€‚ é‚£ä¹ˆé™¤äº†è¿™ç§æ–¹å¼ï¼Œè¿˜æœ‰å…¶å®ƒæ–¹å¼å¯ä»¥å®ç°éé˜»å¡I/Oå¥—æ¥å­—å—ï¼Ÿ</p><p>Linuxæä¾›äº†I/Oå¤ç”¨å‡½æ•°select/poll/epollï¼Œè¿›ç¨‹å°†ä¸€ä¸ªæˆ–å¤šä¸ªè¯»æ“ä½œé€šè¿‡ç³»ç»Ÿè°ƒç”¨å‡½æ•°ï¼Œé˜»å¡åœ¨å‡½æ•°æ“ä½œä¸Šã€‚è¿™æ ·ï¼Œç³»ç»Ÿå†…æ ¸å°±å¯ä»¥å¸®æˆ‘ä»¬ä¾¦æµ‹å¤šä¸ªè¯»æ“ä½œæ˜¯å¦å¤„äºå°±ç»ªçŠ¶æ€ã€‚</p><p><strong>select()å‡½æ•°</strong>ï¼šå®ƒçš„ç”¨é€”æ˜¯ï¼Œåœ¨è¶…æ—¶æ—¶é—´å†…ï¼Œç›‘å¬ç”¨æˆ·æ„Ÿå…´è¶£çš„æ–‡ä»¶æè¿°ç¬¦ä¸Šçš„å¯è¯»å¯å†™å’Œå¼‚å¸¸äº‹ä»¶çš„å‘ç”Ÿã€‚Linux æ“ä½œç³»ç»Ÿçš„å†…æ ¸å°†æ‰€æœ‰å¤–éƒ¨è®¾å¤‡éƒ½çœ‹åšä¸€ä¸ªæ–‡ä»¶æ¥æ“ä½œï¼Œå¯¹ä¸€ä¸ªæ–‡ä»¶çš„è¯»å†™æ“ä½œä¼šè°ƒç”¨å†…æ ¸æä¾›çš„ç³»ç»Ÿå‘½ä»¤ï¼Œè¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆfdï¼‰ã€‚</p><pre><code> int select(int maxfdp1,fd_set *readset,fd_set *writeset,fd_set *exceptset,const struct timeval *timeout)\n</code></pre><p>æŸ¥çœ‹ä»¥ä¸Šä»£ç ï¼Œselect() å‡½æ•°ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦åˆ†3ç±»ï¼Œåˆ†åˆ«æ˜¯writefdsï¼ˆå†™æ–‡ä»¶æè¿°ç¬¦ï¼‰ã€readfdsï¼ˆè¯»æ–‡ä»¶æè¿°ç¬¦ï¼‰ä»¥åŠexceptfdsï¼ˆå¼‚å¸¸äº‹ä»¶æ–‡ä»¶æè¿°ç¬¦ï¼‰ã€‚</p><p>è°ƒç”¨åselect() å‡½æ•°ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰æè¿°ç¬¦å°±ç»ªæˆ–è€…è¶…æ—¶ï¼Œå‡½æ•°è¿”å›ã€‚å½“selectå‡½æ•°è¿”å›åï¼Œå¯ä»¥é€šè¿‡å‡½æ•°FD_ISSETéå†fdsetï¼Œæ¥æ‰¾åˆ°å°±ç»ªçš„æè¿°ç¬¦ã€‚fd_setå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªé›†åˆï¼Œè¿™ä¸ªé›†åˆä¸­å­˜æ”¾çš„æ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯é€šè¿‡ä»¥ä¸‹å››ä¸ªå®è¿›è¡Œè®¾ç½®ï¼š</p><pre><code>\n          void FD_ZERO(fd_set *fdset);           //æ¸…ç©ºé›†åˆ\n          void FD_SET(int fd, fd_set *fdset);   //å°†ä¸€ä¸ªç»™å®šçš„æ–‡ä»¶æè¿°ç¬¦åŠ å…¥é›†åˆä¹‹ä¸­\n          void FD_CLR(int fd, fd_set *fdset);   //å°†ä¸€ä¸ªç»™å®šçš„æ–‡ä»¶æè¿°ç¬¦ä»é›†åˆä¸­åˆ é™¤\n          int FD_ISSET(int fd, fd_set *fdset);   // æ£€æŸ¥é›†åˆä¸­æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦æ˜¯å¦å¯ä»¥è¯»å†™ \n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/d8/dd/d8f4a9cfb8d37d08487a68fc10e31fdd.png?wh=1142*640\" alt=\"\"></p><p><strong>poll()å‡½æ•°</strong>ï¼šåœ¨æ¯æ¬¡è°ƒç”¨select()å‡½æ•°ä¹‹å‰ï¼Œç³»ç»Ÿéœ€è¦æŠŠä¸€ä¸ªfdä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€ï¼Œè¿™æ ·å°±ç»™ç³»ç»Ÿå¸¦æ¥äº†ä¸€å®šçš„æ€§èƒ½å¼€é”€ã€‚å†æœ‰å•ä¸ªè¿›ç¨‹ç›‘è§†çš„fdæ•°é‡é»˜è®¤æ˜¯1024ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹å®å®šä¹‰ç”šè‡³é‡æ–°ç¼–è¯‘å†…æ ¸çš„æ–¹å¼æ‰“ç ´è¿™ä¸€é™åˆ¶ã€‚ä½†ç”±äºfd_setæ˜¯åŸºäºæ•°ç»„å®ç°çš„ï¼Œåœ¨æ–°å¢å’Œåˆ é™¤fdæ—¶ï¼Œæ•°é‡è¿‡å¤§ä¼šå¯¼è‡´æ•ˆç‡é™ä½ã€‚</p><p>poll() çš„æœºåˆ¶ä¸ select() ç±»ä¼¼ï¼ŒäºŒè€…åœ¨æœ¬è´¨ä¸Šå·®åˆ«ä¸å¤§ã€‚poll() ç®¡ç†å¤šä¸ªæè¿°ç¬¦ä¹Ÿæ˜¯é€šè¿‡è½®è¯¢ï¼Œæ ¹æ®æè¿°ç¬¦çš„çŠ¶æ€è¿›è¡Œå¤„ç†ï¼Œä½† poll() æ²¡æœ‰æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°é‡çš„é™åˆ¶ã€‚</p><p>poll() å’Œ select() å­˜åœ¨ä¸€ä¸ªç›¸åŒçš„ç¼ºç‚¹ï¼Œé‚£å°±æ˜¯åŒ…å«å¤§é‡æ–‡ä»¶æè¿°ç¬¦çš„æ•°ç»„è¢«æ•´ä½“å¤åˆ¶åˆ°ç”¨æˆ·æ€å’Œå†…æ ¸çš„åœ°å€ç©ºé—´ä¹‹é—´ï¼Œè€Œæ— è®ºè¿™äº›æ–‡ä»¶æè¿°ç¬¦æ˜¯å¦å°±ç»ªï¼Œä»–ä»¬çš„å¼€é”€éƒ½ä¼šéšç€æ–‡ä»¶æè¿°ç¬¦æ•°é‡çš„å¢åŠ è€Œçº¿æ€§å¢å¤§ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/54/db/54d775cf7df756672b23a1853441d3db.png?wh=1142*640\" alt=\"\"></p><p><strong>epoll()å‡½æ•°</strong>ï¼šselect/pollæ˜¯é¡ºåºæ‰«æfdæ˜¯å¦å°±ç»ªï¼Œè€Œä¸”æ”¯æŒçš„fdæ•°é‡ä¸å®œè¿‡å¤§ï¼Œå› æ­¤å®ƒçš„ä½¿ç”¨å—åˆ°äº†ä¸€äº›åˆ¶çº¦ã€‚</p><p>Linuxåœ¨2.6å†…æ ¸ç‰ˆæœ¬ä¸­æä¾›äº†ä¸€ä¸ªepollè°ƒç”¨ï¼Œepollä½¿ç”¨äº‹ä»¶é©±åŠ¨çš„æ–¹å¼ä»£æ›¿è½®è¯¢æ‰«æfdã€‚epolläº‹å…ˆé€šè¿‡epoll_ctl()æ¥æ³¨å†Œä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå°†æ–‡ä»¶æè¿°ç¬¦å­˜æ”¾åˆ°å†…æ ¸çš„ä¸€ä¸ªäº‹ä»¶è¡¨ä¸­ï¼Œè¿™ä¸ªäº‹ä»¶è¡¨æ˜¯åŸºäºçº¢é»‘æ ‘å®ç°çš„ï¼Œæ‰€ä»¥åœ¨å¤§é‡I/Oè¯·æ±‚çš„åœºæ™¯ä¸‹ï¼Œæ’å…¥å’Œåˆ é™¤çš„æ€§èƒ½æ¯”select/pollçš„æ•°ç»„fd_setè¦å¥½ï¼Œå› æ­¤epollçš„æ€§èƒ½æ›´èƒœä¸€ç­¹ï¼Œè€Œä¸”ä¸ä¼šå—åˆ°fdæ•°é‡çš„é™åˆ¶ã€‚</p><pre><code>int epoll_ctl(int epfd, int op, int fd, struct epoll_event event)\n\n</code></pre><p><strong>é€šè¿‡ä»¥ä¸Šä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</strong>epoll_ctl()å‡½æ•°ä¸­çš„epfdæ˜¯ç”± epoll_create()å‡½æ•°ç”Ÿæˆçš„ä¸€ä¸ªepollä¸“ç”¨æ–‡ä»¶æè¿°ç¬¦ã€‚opä»£è¡¨æ“ä½œäº‹ä»¶ç±»å‹ï¼Œfdè¡¨ç¤ºå…³è”æ–‡ä»¶æè¿°ç¬¦ï¼Œeventè¡¨ç¤ºæŒ‡å®šç›‘å¬çš„äº‹ä»¶ç±»å‹ã€‚</p><p>ä¸€æ—¦æŸä¸ªæ–‡ä»¶æè¿°ç¬¦å°±ç»ªæ—¶ï¼Œå†…æ ¸ä¼šé‡‡ç”¨ç±»ä¼¼callbackçš„å›è°ƒæœºåˆ¶ï¼Œè¿…é€Ÿæ¿€æ´»è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå½“è¿›ç¨‹è°ƒç”¨epoll_wait()æ—¶ä¾¿å¾—åˆ°é€šçŸ¥ï¼Œä¹‹åè¿›ç¨‹å°†å®Œæˆç›¸å…³I/Oæ“ä½œã€‚</p><pre><code>int epoll_wait(int epfd, struct epoll_event events,int maxevents,int timeout)\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/36/7a/36ee4e180cb6bb4f1452c0bafbe6f37a.png?wh=1142*640\" alt=\"\"></p><h3>4.ä¿¡å·é©±åŠ¨å¼I/O</h3><p>ä¿¡å·é©±åŠ¨å¼I/Oç±»ä¼¼è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå†…æ ¸å°±æ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œä¿¡å·å›è°ƒåˆ™æ˜¯é€šçŸ¥ã€‚ç”¨æˆ·è¿›ç¨‹å‘èµ·ä¸€ä¸ªI/Oè¯·æ±‚æ“ä½œï¼Œä¼šé€šè¿‡ç³»ç»Ÿè°ƒç”¨sigactionå‡½æ•°ï¼Œç»™å¯¹åº”çš„å¥—æ¥å­—æ³¨å†Œä¸€ä¸ªä¿¡å·å›è°ƒï¼Œæ­¤æ—¶ä¸é˜»å¡ç”¨æˆ·è¿›ç¨‹ï¼Œè¿›ç¨‹ä¼šç»§ç»­å·¥ä½œã€‚å½“å†…æ ¸æ•°æ®å°±ç»ªæ—¶ï¼Œå†…æ ¸å°±ä¸ºè¯¥è¿›ç¨‹ç”Ÿæˆä¸€ä¸ªSIGIOä¿¡å·ï¼Œé€šè¿‡ä¿¡å·å›è°ƒé€šçŸ¥è¿›ç¨‹è¿›è¡Œç›¸å…³I/Oæ“ä½œã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/4c/1f/4c897ce649d3deb609a4f0a9ba7aee1f.png?wh=749*411\" alt=\"\"></p><p><span class=\"orange\">ä¿¡å·é©±åŠ¨å¼I/Oç›¸æ¯”äºå‰ä¸‰ç§I/Oæ¨¡å¼ï¼Œå®ç°äº†åœ¨ç­‰å¾…æ•°æ®å°±ç»ªæ—¶ï¼Œè¿›ç¨‹ä¸è¢«é˜»å¡ï¼Œä¸»å¾ªç¯å¯ä»¥ç»§ç»­å·¥ä½œï¼Œæ‰€ä»¥æ€§èƒ½æ›´ä½³ã€‚</span></p><p>è€Œç”±äºTCPæ¥è¯´ï¼Œä¿¡å·é©±åŠ¨å¼I/Oå‡ ä¹æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œè¿™æ˜¯å› ä¸ºSIGIOä¿¡å·æ˜¯ä¸€ç§Unixä¿¡å·ï¼Œä¿¡å·æ²¡æœ‰é™„åŠ ä¿¡æ¯ï¼Œå¦‚æœä¸€ä¸ªä¿¡å·æºæœ‰å¤šç§äº§ç”Ÿä¿¡å·çš„åŸå› ï¼Œä¿¡å·æ¥æ”¶è€…å°±æ— æ³•ç¡®å®šç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆã€‚è€Œ TCP socketç”Ÿäº§çš„ä¿¡å·äº‹ä»¶æœ‰ä¸ƒç§ä¹‹å¤šï¼Œè¿™æ ·åº”ç”¨ç¨‹åºæ”¶åˆ° SIGIOï¼Œæ ¹æœ¬æ— ä»åŒºåˆ†å¤„ç†ã€‚</p><p>ä½†ä¿¡å·é©±åŠ¨å¼I/Oç°åœ¨è¢«ç”¨åœ¨äº†UDPé€šä¿¡ä¸Šï¼Œæˆ‘ä»¬ä»10è®²ä¸­çš„UDPé€šä¿¡æµç¨‹å›¾ä¸­å¯ä»¥å‘ç°ï¼ŒUDPåªæœ‰ä¸€ä¸ªæ•°æ®è¯·æ±‚äº‹ä»¶ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€åœ¨æ­£å¸¸æƒ…å†µä¸‹UDPè¿›ç¨‹åªè¦æ•è·SIGIOä¿¡å·ï¼Œå°±è°ƒç”¨recvfromè¯»å–åˆ°è¾¾çš„æ•°æ®æŠ¥ã€‚å¦‚æœå‡ºç°å¼‚å¸¸ï¼Œå°±è¿”å›ä¸€ä¸ªå¼‚å¸¸é”™è¯¯ã€‚æ¯”å¦‚ï¼ŒNTPæœåŠ¡å™¨å°±åº”ç”¨äº†è¿™ç§æ¨¡å‹ã€‚</p><h3>5.å¼‚æ­¥I/O</h3><p>ä¿¡å·é©±åŠ¨å¼I/Oè™½ç„¶åœ¨ç­‰å¾…æ•°æ®å°±ç»ªæ—¶ï¼Œæ²¡æœ‰é˜»å¡è¿›ç¨‹ï¼Œä½†åœ¨è¢«é€šçŸ¥åè¿›è¡Œçš„I/Oæ“ä½œè¿˜æ˜¯é˜»å¡çš„ï¼Œè¿›ç¨‹ä¼šç­‰å¾…æ•°æ®ä»å†…æ ¸ç©ºé—´å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ä¸­ã€‚è€Œå¼‚æ­¥I/Oåˆ™æ˜¯å®ç°äº†çœŸæ­£çš„éé˜»å¡I/Oã€‚</p><p>å½“ç”¨æˆ·è¿›ç¨‹å‘èµ·ä¸€ä¸ªI/Oè¯·æ±‚æ“ä½œï¼Œç³»ç»Ÿä¼šå‘ŠçŸ¥å†…æ ¸å¯åŠ¨æŸä¸ªæ“ä½œï¼Œå¹¶è®©å†…æ ¸åœ¨æ•´ä¸ªæ“ä½œå®Œæˆåé€šçŸ¥è¿›ç¨‹ã€‚è¿™ä¸ªæ“ä½œåŒ…æ‹¬ç­‰å¾…æ•°æ®å°±ç»ªå’Œæ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ã€‚ç”±äºç¨‹åºçš„ä»£ç å¤æ‚åº¦é«˜ï¼Œè°ƒè¯•éš¾åº¦å¤§ï¼Œä¸”æ”¯æŒå¼‚æ­¥I/Oçš„æ“ä½œç³»ç»Ÿæ¯”è¾ƒå°‘è§ï¼ˆç›®å‰Linuxæš‚ä¸æ”¯æŒï¼Œè€ŒWindowså·²ç»å®ç°äº†å¼‚æ­¥I/Oï¼‰ï¼Œæ‰€ä»¥åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­å¾ˆå°‘ç”¨åˆ°å¼‚æ­¥I/Oæ¨¡å‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/dd/c0/dd4b03afb56a3b7660794ce11fc421c0.png?wh=1142*640\" alt=\"\"></p><p>åœ¨08è®²ä¸­ï¼Œæˆ‘è®²åˆ°äº†NIOä½¿ç”¨I/Oå¤ç”¨å™¨Selectorå®ç°éé˜»å¡I/Oï¼Œ<span class=\"orange\">Selectorå°±æ˜¯ä½¿ç”¨äº†è¿™äº”ç§ç±»å‹ä¸­çš„I/Oå¤ç”¨æ¨¡å‹ã€‚</span>Javaä¸­çš„Selectorå…¶å®å°±æ˜¯select/poll/epollçš„å¤–åŒ…ç±»ã€‚</p><p>æˆ‘ä»¬åœ¨ä¸Šé¢çš„TCPé€šä¿¡æµç¨‹ä¸­è®²åˆ°ï¼ŒSocketé€šä¿¡ä¸­çš„conectã€acceptã€readä»¥åŠwriteä¸ºé˜»å¡æ“ä½œï¼Œåœ¨Selectorä¸­åˆ†åˆ«å¯¹åº”SelectionKeyçš„å››ä¸ªç›‘å¬äº‹ä»¶OP_ACCEPTã€OP_CONNECTã€OP_READä»¥åŠOP_WRITEã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/85/96/85bcacec92e74c5cb6d6a39669e0d896.png?wh=648*253\" alt=\"\"></p><p>åœ¨NIOæœåŠ¡ç«¯é€šä¿¡ç¼–ç¨‹ä¸­ï¼Œé¦–å…ˆä¼šåˆ›å»ºä¸€ä¸ªChannelï¼Œç”¨äºç›‘å¬å®¢æˆ·ç«¯è¿æ¥ï¼›æ¥ç€ï¼Œåˆ›å»ºå¤šè·¯å¤ç”¨å™¨Selectorï¼Œå¹¶å°†Channelæ³¨å†Œåˆ°Selectorï¼Œç¨‹åºä¼šé€šè¿‡Selectoræ¥è½®è¯¢æ³¨å†Œåœ¨å…¶ä¸Šçš„Channelï¼Œå½“å‘ç°ä¸€ä¸ªæˆ–å¤šä¸ªChannelå¤„äºå°±ç»ªçŠ¶æ€æ—¶ï¼Œè¿”å›å°±ç»ªçš„ç›‘å¬äº‹ä»¶ï¼Œæœ€åç¨‹åºåŒ¹é…åˆ°ç›‘å¬äº‹ä»¶ï¼Œè¿›è¡Œç›¸å…³çš„I/Oæ“ä½œã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/e2/15/e27534c5a157d0908d51b806919b1515.jpg?wh=1095*676\" alt=\"\"></p><p>åœ¨åˆ›å»ºSelectoræ—¶ï¼Œç¨‹åºä¼šæ ¹æ®æ“ä½œç³»ç»Ÿç‰ˆæœ¬é€‰æ‹©ä½¿ç”¨å“ªç§I/Oå¤ç”¨å‡½æ•°ã€‚åœ¨JDK1.5ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœç¨‹åºè¿è¡Œåœ¨Linuxæ“ä½œç³»ç»Ÿï¼Œä¸”å†…æ ¸ç‰ˆæœ¬åœ¨2.6ä»¥ä¸Šï¼ŒNIOä¸­ä¼šé€‰æ‹©epollæ¥æ›¿ä»£ä¼ ç»Ÿçš„select/pollï¼Œè¿™ä¹Ÿæå¤§åœ°æå‡äº†NIOé€šä¿¡çš„æ€§èƒ½ã€‚</p><p><span class=\"orange\">ç”±äºä¿¡å·é©±åŠ¨å¼I/Oå¯¹TCPé€šä¿¡çš„ä¸æ”¯æŒï¼Œä»¥åŠå¼‚æ­¥I/Oåœ¨Linuxæ“ä½œç³»ç»Ÿå†…æ ¸ä¸­çš„åº”ç”¨è¿˜ä¸å¤§æˆç†Ÿï¼Œå¤§éƒ¨åˆ†æ¡†æ¶éƒ½è¿˜æ˜¯åŸºäºI/Oå¤ç”¨æ¨¡å‹å®ç°çš„ç½‘ç»œé€šä¿¡ã€‚</span></p><h2>é›¶æ‹·è´</h2><p>åœ¨I/Oå¤ç”¨æ¨¡å‹ä¸­ï¼Œæ‰§è¡Œè¯»å†™I/Oæ“ä½œä¾ç„¶æ˜¯é˜»å¡çš„ï¼Œåœ¨æ‰§è¡Œè¯»å†™I/Oæ“ä½œæ—¶ï¼Œå­˜åœ¨ç€å¤šæ¬¡å†…å­˜æ‹·è´å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œç»™ç³»ç»Ÿå¢åŠ äº†æ€§èƒ½å¼€é”€ã€‚</p><p>é›¶æ‹·è´æ˜¯ä¸€ç§é¿å…å¤šæ¬¡å†…å­˜å¤åˆ¶çš„æŠ€æœ¯ï¼Œç”¨æ¥ä¼˜åŒ–è¯»å†™I/Oæ“ä½œã€‚</p><p>åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œé€šå¸¸ç”±readã€writeæ¥å®Œæˆä¸€æ¬¡I/Oè¯»å†™æ“ä½œã€‚æ¯ä¸€æ¬¡I/Oè¯»å†™æ“ä½œéƒ½éœ€è¦å®Œæˆå››æ¬¡å†…å­˜æ‹·è´ï¼Œè·¯å¾„æ˜¯I/Oè®¾å¤‡-&gt;å†…æ ¸ç©ºé—´-&gt;ç”¨æˆ·ç©ºé—´-&gt;å†…æ ¸ç©ºé—´-&gt;å…¶å®ƒI/Oè®¾å¤‡ã€‚</p><p><span class=\"orange\">Linuxå†…æ ¸ä¸­çš„mmapå‡½æ•°å¯ä»¥ä»£æ›¿readã€writeçš„I/Oè¯»å†™æ“ä½œï¼Œå®ç°ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´å…±äº«ä¸€ä¸ªç¼“å­˜æ•°æ®ã€‚</span>mmapå°†ç”¨æˆ·ç©ºé—´çš„ä¸€å—åœ°å€å’Œå†…æ ¸ç©ºé—´çš„ä¸€å—åœ°å€åŒæ—¶æ˜ å°„åˆ°ç›¸åŒçš„ä¸€å—ç‰©ç†å†…å­˜åœ°å€ï¼Œä¸ç®¡æ˜¯ç”¨æˆ·ç©ºé—´è¿˜æ˜¯å†…æ ¸ç©ºé—´éƒ½æ˜¯è™šæ‹Ÿåœ°å€ï¼Œæœ€ç»ˆè¦é€šè¿‡åœ°å€æ˜ å°„æ˜ å°„åˆ°ç‰©ç†å†…å­˜åœ°å€ã€‚è¿™ç§æ–¹å¼é¿å…äº†å†…æ ¸ç©ºé—´ä¸ç”¨æˆ·ç©ºé—´çš„æ•°æ®äº¤æ¢ã€‚I/Oå¤ç”¨ä¸­çš„epollå‡½æ•°ä¸­å°±æ˜¯ä½¿ç”¨äº†mmapå‡å°‘äº†å†…å­˜æ‹·è´ã€‚</p><p>åœ¨Javaçš„NIOç¼–ç¨‹ä¸­ï¼Œåˆ™æ˜¯ä½¿ç”¨åˆ°äº†Direct Bufferæ¥å®ç°å†…å­˜çš„é›¶æ‹·è´ã€‚Javaç›´æ¥åœ¨JVMå†…å­˜ç©ºé—´ä¹‹å¤–å¼€è¾Ÿäº†ä¸€ä¸ªç‰©ç†å†…å­˜ç©ºé—´ï¼Œè¿™æ ·å†…æ ¸å’Œç”¨æˆ·è¿›ç¨‹éƒ½èƒ½å…±äº«ä¸€ä»½ç¼“å­˜æ•°æ®ã€‚è¿™æ˜¯åœ¨08è®²ä¸­å·²ç»è¯¦ç»†è®²è§£è¿‡çš„å†…å®¹ï¼Œä½ å¯ä»¥å†å»å›é¡¾ä¸‹ã€‚</p><h2>çº¿ç¨‹æ¨¡å‹ä¼˜åŒ–</h2><p>é™¤äº†å†…æ ¸å¯¹ç½‘ç»œI/Oæ¨¡å‹çš„ä¼˜åŒ–ï¼ŒNIOåœ¨ç”¨æˆ·å±‚ä¹Ÿåšäº†ä¼˜åŒ–å‡çº§ã€‚NIOæ˜¯åŸºäºäº‹ä»¶é©±åŠ¨æ¨¡å‹æ¥å®ç°çš„I/Oæ“ä½œã€‚Reactoræ¨¡å‹æ˜¯åŒæ­¥I/Oäº‹ä»¶å¤„ç†çš„ä¸€ç§å¸¸è§æ¨¡å‹ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯å°†I/Oäº‹ä»¶æ³¨å†Œåˆ°å¤šè·¯å¤ç”¨å™¨ä¸Šï¼Œä¸€æ—¦æœ‰I/Oäº‹ä»¶è§¦å‘ï¼Œå¤šè·¯å¤ç”¨å™¨å°±ä¼šå°†äº‹ä»¶åˆ†å‘åˆ°äº‹ä»¶å¤„ç†å™¨ä¸­ï¼Œæ‰§è¡Œå°±ç»ªçš„I/Oäº‹ä»¶æ“ä½œã€‚<strong>è¯¥æ¨¡å‹æœ‰ä»¥ä¸‹ä¸‰ä¸ªä¸»è¦ç»„ä»¶ï¼š</strong></p><ul>\n<li>äº‹ä»¶æ¥æ”¶å™¨Acceptorï¼šä¸»è¦è´Ÿè´£æ¥æ”¶è¯·æ±‚è¿æ¥ï¼›</li>\n<li>äº‹ä»¶åˆ†ç¦»å™¨Reactorï¼šæ¥æ”¶è¯·æ±‚åï¼Œä¼šå°†å»ºç«‹çš„è¿æ¥æ³¨å†Œåˆ°åˆ†ç¦»å™¨ä¸­ï¼Œä¾èµ–äºå¾ªç¯ç›‘å¬å¤šè·¯å¤ç”¨å™¨Selectorï¼Œä¸€æ—¦ç›‘å¬åˆ°äº‹ä»¶ï¼Œå°±ä¼šå°†äº‹ä»¶dispatchåˆ°äº‹ä»¶å¤„ç†å™¨ï¼›</li>\n<li>äº‹ä»¶å¤„ç†å™¨Handlersï¼šäº‹ä»¶å¤„ç†å™¨ä¸»è¦æ˜¯å®Œæˆç›¸å…³çš„äº‹ä»¶å¤„ç†ï¼Œæ¯”å¦‚è¯»å†™I/Oæ“ä½œã€‚</li>\n</ul><h3>1.å•çº¿ç¨‹Reactorçº¿ç¨‹æ¨¡å‹</h3><p>æœ€å¼€å§‹NIOæ˜¯åŸºäºå•çº¿ç¨‹å®ç°çš„ï¼Œæ‰€æœ‰çš„I/Oæ“ä½œéƒ½æ˜¯åœ¨ä¸€ä¸ªNIOçº¿ç¨‹ä¸Šå®Œæˆã€‚ç”±äºNIOæ˜¯éé˜»å¡I/Oï¼Œç†è®ºä¸Šä¸€ä¸ªçº¿ç¨‹å¯ä»¥å®Œæˆæ‰€æœ‰çš„I/Oæ“ä½œã€‚</p><p>ä½†NIOå…¶å®è¿˜ä¸ç®—çœŸæ­£åœ°å®ç°äº†éé˜»å¡I/Oæ“ä½œï¼Œå› ä¸ºè¯»å†™I/Oæ“ä½œæ—¶ç”¨æˆ·è¿›ç¨‹è¿˜æ˜¯å¤„äºé˜»å¡çŠ¶æ€ï¼Œè¿™ç§æ–¹å¼åœ¨é«˜è´Ÿè½½ã€é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ä¼šå­˜åœ¨æ€§èƒ½ç“¶é¢ˆï¼Œä¸€ä¸ªNIOçº¿ç¨‹å¦‚æœåŒæ—¶å¤„ç†ä¸Šä¸‡è¿æ¥çš„I/Oæ“ä½œï¼Œç³»ç»Ÿæ˜¯æ— æ³•æ”¯æ’‘è¿™ç§é‡çº§çš„è¯·æ±‚çš„ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/29/f8/29b117cb60bcc8edd6d1fa21981fb9f8.png?wh=1800*640\" alt=\"\"></p><h3>2.å¤šçº¿ç¨‹Reactorçº¿ç¨‹æ¨¡å‹</h3><p>ä¸ºäº†è§£å†³è¿™ç§å•çº¿ç¨‹çš„NIOåœ¨é«˜è´Ÿè½½ã€é«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ€§èƒ½ç“¶é¢ˆï¼Œåæ¥ä½¿ç”¨äº†çº¿ç¨‹æ± ã€‚</p><p>åœ¨Tomcatå’ŒNettyä¸­éƒ½ä½¿ç”¨äº†ä¸€ä¸ªAcceptorçº¿ç¨‹æ¥ç›‘å¬è¿æ¥è¯·æ±‚äº‹ä»¶ï¼Œå½“è¿æ¥æˆåŠŸä¹‹åï¼Œä¼šå°†å»ºç«‹çš„è¿æ¥æ³¨å†Œåˆ°å¤šè·¯å¤ç”¨å™¨ä¸­ï¼Œä¸€æ—¦ç›‘å¬åˆ°äº‹ä»¶ï¼Œå°†äº¤ç»™Workerçº¿ç¨‹æ± æ¥è´Ÿè´£å¤„ç†ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™ç§çº¿ç¨‹æ¨¡å‹å¯ä»¥æ»¡è¶³æ€§èƒ½è¦æ±‚ï¼Œä½†å¦‚æœè¿æ¥çš„å®¢æˆ·ç«¯å†ä¸Šä¸€ä¸ªé‡çº§ï¼Œä¸€ä¸ªAcceptorçº¿ç¨‹å¯èƒ½ä¼šå­˜åœ¨æ€§èƒ½ç“¶é¢ˆã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/0d/82/0de0c467036f2973143a620448068a82.png?wh=1767*640\" alt=\"\"></p><h3>3.ä¸»ä»Reactorçº¿ç¨‹æ¨¡å‹</h3><p>ç°åœ¨ä¸»æµé€šä¿¡æ¡†æ¶ä¸­çš„NIOé€šä¿¡æ¡†æ¶éƒ½æ˜¯åŸºäºä¸»ä»Reactorçº¿ç¨‹æ¨¡å‹æ¥å®ç°çš„ã€‚åœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼ŒAcceptorä¸å†æ˜¯ä¸€ä¸ªå•ç‹¬çš„NIOçº¿ç¨‹ï¼Œè€Œæ˜¯ä¸€ä¸ªçº¿ç¨‹æ± ã€‚Acceptoræ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„TCPè¿æ¥è¯·æ±‚ï¼Œå»ºç«‹è¿æ¥ä¹‹åï¼Œåç»­çš„I/Oæ“ä½œå°†äº¤ç»™Worker I/Oçº¿ç¨‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f9/0a/f9d03620ae5c7c82c83f522710a62a0a.png?wh=1800*640\" alt=\"\"></p><h3>åŸºäºçº¿ç¨‹æ¨¡å‹çš„Tomcatå‚æ•°è°ƒä¼˜</h3><p>Tomcatä¸­ï¼ŒBIOã€NIOæ˜¯åŸºäºä¸»ä»Reactorçº¿ç¨‹æ¨¡å‹å®ç°çš„ã€‚</p><p><strong>åœ¨BIOä¸­ï¼Œ</strong>Tomcatä¸­çš„Acceptoråªè´Ÿè´£ç›‘å¬æ–°çš„è¿æ¥ï¼Œä¸€æ—¦è¿æ¥å»ºç«‹ç›‘å¬åˆ°I/Oæ“ä½œï¼Œå°†ä¼šäº¤ç»™Workerçº¿ç¨‹ä¸­ï¼ŒWorkerçº¿ç¨‹ä¸“é—¨è´Ÿè´£I/Oè¯»å†™æ“ä½œã€‚</p><p><strong>åœ¨NIOä¸­ï¼Œ</strong>Tomcatæ–°å¢äº†ä¸€ä¸ªPollerçº¿ç¨‹æ± ï¼ŒAcceptorç›‘å¬åˆ°è¿æ¥åï¼Œä¸æ˜¯ç›´æ¥ä½¿ç”¨Workerä¸­çš„çº¿ç¨‹å¤„ç†è¯·æ±‚ï¼Œè€Œæ˜¯å…ˆå°†è¯·æ±‚å‘é€ç»™äº†Pollerç¼“å†²é˜Ÿåˆ—ã€‚åœ¨Pollerä¸­ï¼Œç»´æŠ¤äº†ä¸€ä¸ªSelectorå¯¹è±¡ï¼Œå½“Pollerä»é˜Ÿåˆ—ä¸­å–å‡ºè¿æ¥åï¼Œæ³¨å†Œåˆ°è¯¥Selectorä¸­ï¼›ç„¶åé€šè¿‡éå†Selectorï¼Œæ‰¾å‡ºå…¶ä¸­å°±ç»ªçš„I/Oæ“ä½œï¼Œå¹¶ä½¿ç”¨Workerä¸­çš„çº¿ç¨‹å¤„ç†ç›¸åº”çš„è¯·æ±‚ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/13/ba/136315be52782bd88056fb28f3ec60ba.png?wh=1028*229\" alt=\"\"></p><p><span class=\"orange\">ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ä¸ªå‚æ•°æ¥è®¾ç½®Acceptorçº¿ç¨‹æ± å’ŒWorkerçº¿ç¨‹æ± çš„é…ç½®é¡¹ã€‚</span></p><p><strong>acceptorThreadCountï¼š</strong>è¯¥å‚æ•°ä»£è¡¨Acceptorçš„çº¿ç¨‹æ•°é‡ï¼Œåœ¨è¯·æ±‚å®¢æˆ·ç«¯çš„æ•°æ®é‡éå¸¸å·¨å¤§çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€‚å½“åœ°è°ƒå¤§è¯¥çº¿ç¨‹æ•°é‡æ¥æé«˜å¤„ç†è¯·æ±‚è¿æ¥çš„èƒ½åŠ›ï¼Œé»˜è®¤å€¼ä¸º1ã€‚</p><p><strong>maxThreadsï¼š</strong>ä¸“é—¨å¤„ç†I/Oæ“ä½œçš„Workerçº¿ç¨‹æ•°é‡ï¼Œé»˜è®¤æ˜¯200ï¼Œå¯ä»¥æ ¹æ®å®é™…çš„ç¯å¢ƒæ¥è°ƒæ•´è¯¥å‚æ•°ï¼Œä½†ä¸ä¸€å®šè¶Šå¤§è¶Šå¥½ã€‚</p><p><strong>acceptCountï¼š</strong>Tomcatçš„Acceptorçº¿ç¨‹æ˜¯è´Ÿè´£ä»accepté˜Ÿåˆ—ä¸­å–å‡ºè¯¥connectionï¼Œç„¶åäº¤ç»™å·¥ä½œçº¿ç¨‹å»æ‰§è¡Œç›¸å…³æ“ä½œï¼Œè¿™é‡Œçš„acceptCountæŒ‡çš„æ˜¯accepté˜Ÿåˆ—çš„å¤§å°ã€‚</p><p>å½“Httpå…³é—­keep aliveï¼Œåœ¨å¹¶å‘é‡æ¯”è¾ƒå¤§æ—¶ï¼Œå¯ä»¥é€‚å½“åœ°è°ƒå¤§è¿™ä¸ªå€¼ã€‚è€Œåœ¨Httpå¼€å¯keep aliveæ—¶ï¼Œå› ä¸ºWorkerçº¿ç¨‹æ•°é‡æœ‰é™ï¼ŒWorkerçº¿ç¨‹å°±å¯èƒ½å› é•¿æ—¶é—´è¢«å ç”¨ï¼Œè€Œè¿æ¥åœ¨accepté˜Ÿåˆ—ä¸­ç­‰å¾…è¶…æ—¶ã€‚å¦‚æœaccepté˜Ÿåˆ—è¿‡å¤§ï¼Œå°±å®¹æ˜“æµªè´¹è¿æ¥ã€‚</p><p><strong>maxConnectionsï¼š</strong>è¡¨ç¤ºæœ‰å¤šå°‘ä¸ªsocketè¿æ¥åˆ°Tomcatä¸Šã€‚åœ¨BIOæ¨¡å¼ä¸­ï¼Œä¸€ä¸ªçº¿ç¨‹åªèƒ½å¤„ç†ä¸€ä¸ªè¿æ¥ï¼Œä¸€èˆ¬maxConnectionsä¸maxThreadsçš„å€¼å¤§å°ç›¸åŒï¼›åœ¨NIOæ¨¡å¼ä¸­ï¼Œä¸€ä¸ªçº¿ç¨‹åŒæ—¶å¤„ç†å¤šä¸ªè¿æ¥ï¼ŒmaxConnectionsåº”è¯¥è®¾ç½®å¾—æ¯”maxThreadsè¦å¤§çš„å¤šï¼Œé»˜è®¤æ˜¯10000ã€‚</p><p><span class=\"orange\">ä»Šå¤©çš„å†…å®¹æ¯”è¾ƒå¤šï¼Œçœ‹åˆ°è¿™é‡Œä¸çŸ¥é“ä½ æ¶ˆåŒ–å¾—å¦‚ä½•ï¼Ÿå¦‚æœè¿˜æœ‰ç–‘é—®ï¼Œè¯·åœ¨ç•™è¨€åŒºä¸­æå‡ºï¼Œæˆ‘ä»¬å…±åŒæ¢è®¨ã€‚</span>æœ€åæ¬¢è¿ä½ ç‚¹å‡»â€œè¯·æœ‹å‹è¯»â€ï¼ŒæŠŠä»Šå¤©çš„å†…å®¹åˆ†äº«ç»™èº«è¾¹çš„æœ‹å‹ï¼Œé‚€è¯·ä»–åŠ å…¥è®¨è®ºã€‚</p><p></p>","comments":[{"had_liked":false,"id":103250,"user_name":"-W.LI-","can_delete":false,"product_type":"c1","uid":1210699,"ip_address":"","ucode":"3556786538664F","user_header":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","comment_is_top":false,"comment_ctime":1560403707,"is_pvip":false,"replies":[{"id":"37493","content":"ç†è§£æ­£ç¡®ï¼Œèµä¸€ä¸ª","user_name":"ä½œè€…å›å¤","comment_id":103250,"uid":"1228576","ip_address":"","utype":1,"ctime":1560479210,"user_name_real":"åˆ˜è¶…"}],"discussion_count":1,"race_medal":0,"score":"100344651515","product_id":100028001,"comment_content":"è€å¸ˆå¥½!ä¸‡åˆ†æ„Ÿè§‰ï¼Œå†™çš„éå¸¸éå¸¸å¥½è°¢è°¢ã€‚ä¸è¿‡å¼€å¿ƒçš„åŒæ—¶ï¼Œå¥½å¤šæ²¡çœ‹æ‡‚:-(å…ˆè®²ä¸‹æˆ‘çš„ç†è§£å§ã€‚<br>é˜»å¡IO:è°ƒç”¨read()çº¿ç¨‹é˜»å¡äº†<br>éé˜»å¡IO:è°ƒç”¨read()é©¬ä¸Šæ‹¿åˆ°ä¸€ä¸ªæ•°æ®æœªå°±ç»ªï¼Œæˆ–è€…å°±ç»ªã€‚<br>I&#47;Oå¤šè·¯å¤ç”¨:selectorçº¿ç¨‹é˜»å¡ï¼Œchanneléé˜»å¡ï¼Œç”¨é˜»å¡ä¸€ä¸ªselectorçº¿ç¨‹æ¢äº†å¤šä¸ªchanneläº†éé˜»å¡ã€‚select()å‡½æ•°åŸºäºæ•°ç»„ï¼Œfdä¸ªæ•°é™åˆ¶1024ï¼Œpoll()å‡½æ•°ä¹Ÿæ˜¯åŸºäºæ•°ç»„ä½†æ˜¯fdæ•°ç›®æ— é™åˆ¶ã€‚éƒ½ä¼šè´Ÿè´£æ‰€æœ‰çš„fd(æœªå°±ç»ªçš„å¼€é”€æµªäº†)ï¼Œ<br>epll()åŸºäºçº¢é»‘æ•°å®ç°ï¼Œfdæ— å¤§å°é™åˆ¶ï¼Œå¹³è¡¡äºŒå‰æ•°æ’å…¥åˆ é™¤æ•ˆç‡é«˜ã€‚<br>ä¿¡å·é©±åŠ¨æ¨¡å¼IO:å¯¹IOå¤šè·¯å¤ç”¨è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œselectorä¹Ÿéé˜»å¡äº†ã€‚ä½†æ˜¯signä¿¡å·æ— æ³•åŒºåˆ†å¤šä¿¡å·æºã€‚æ‰€ä»¥socketæœªä½¿ç”¨è¿™ç§ï¼Œåªæœ‰åœ¨å•ä¸€ä¿¡å·æ¨¡å‹ä¸Šæ‰èƒ½åº”ç”¨ã€‚<br>å¼‚æ­¥IOæ¨¡å‹:çœŸæ­£çš„éé˜»å¡IOï¼Œå…¶å®å‰é¢çš„å››ç§IOéƒ½ä¸æ˜¯çœŸæ­£çš„éé˜»å¡IOï¼Œä»–ä»¬çš„éé˜»å¡åªæ˜¯ï¼Œä»ç½‘ç»œæˆ–è€…å†…å­˜ç£ç›˜åˆ°å†…æ ¸ç©ºé—´çš„éé˜»å¡ï¼Œè°ƒç”¨read()åè¿˜éœ€è¦ä»å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ã€‚å¼‚æ­¥IOåŸºäºå›è°ƒï¼Œè¿™ä¸€æ­¥ä¹Ÿéé˜»å¡äº†ï¼Œä»å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´åæ‰é€šçŸ¥ç”¨æˆ·è¿›ç¨‹ã€‚<br>èƒ½æˆ‘æ˜¯è¿™ä¹ˆç†è§£çš„å‰åŠæ–­ï¼Œæœ‰ç†è§£é”™çš„è¯·è€å¸ˆæŒ‡æ­£è°¢è°¢ã€‚ååŠæ–­æ²¡çœ‹å®Œã€‚","like_count":23,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453806,"discussion_content":"ç†è§£æ­£ç¡®ï¼Œèµä¸€ä¸ª","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560479210,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":103112,"user_name":"QQæ€ª","can_delete":false,"product_type":"c1","uid":1211223,"ip_address":"","ucode":"1A39B8433D9208","user_header":"https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg","comment_is_top":false,"comment_ctime":1560385845,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"91754699061","product_id":100028001,"comment_content":"è€å¸ˆè¿™ç¯‡å¯ä»¥é…åˆéš”å£ä¸“æ tomcatçš„13ï¼Œ14ç« ä¸€èµ·çœ‹ï¼Œä¼šæ›´åŠ æœ‰å‘³é“ã€‚ğŸ˜ƒ","like_count":21,"discussions":[{"author":{"id":1225224,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b2/08/92f42622.jpg","nickname":"å°”å†¬æ©™","note":"","ucode":"0B013A49BC18DA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":12123,"discussion_content":"tomcaté‚£é—¨è¯¾ä¹Ÿå¾ˆå¼º","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1568470360,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":103567,"user_name":"-W.LI-","can_delete":false,"product_type":"c1","uid":1210699,"ip_address":"","ucode":"3556786538664F","user_header":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","comment_is_top":false,"comment_ctime":1560473837,"is_pvip":false,"replies":[{"id":"37661","content":"ä¸»ä»æ¨¡å¼åˆ™æ˜¯ï¼ŒReactorä¸»çº¿ç¨‹ä¸»è¦å¤„ç†ç›‘å¬è¿æ¥äº‹ä»¶ï¼Œè€ŒReactorä»çº¿ç¨‹ä¸»è¦ç›‘å¬I&#47;Oäº‹ä»¶ã€‚è¿™é‡Œæ˜¯å¤šçº¿ç¨‹å¤„ç†acceptäº‹ä»¶ï¼Œè€Œä¸æ˜¯åˆ›å»ºå¤šä¸ªServerSocketChannelã€‚","user_name":"ä½œè€…å›å¤","comment_id":103567,"uid":"1228576","ip_address":"","utype":1,"ctime":1560650842,"user_name_real":"åˆ˜è¶…"}],"discussion_count":3,"race_medal":0,"score":"65984983277","product_id":100028001,"comment_content":"è€å¸ˆå¥½å¯¹Reacktorçš„ä¸‰ç§æ¨¡å¼è¿˜æ˜¯ç†è§£ä¸å¤ªå¥½ã€‚å¸®å¿™çœ‹çœ‹å“ªé‡Œæœ‰é—®é¢˜<br>å•çº¿ç¨‹æ¨¡å‹:ä¸€ä¸ªselectoråŒæ—¶ç›‘å¬accept,äº‹ä»¶å’Œreadäº‹ä»¶ã€‚æ£€æµ‹åˆ°å°±åœ¨ä¸€ä¸ªçº¿ç¨‹å¤„ç†ã€‚<br>å¤šçº¿ç¨‹æ¨¡å‹:ä¸€ä¸ªçº¿ç¨‹ç›‘å¬acceptäº‹ä»¶ï¼Œåˆ›å»ºchannelæ³¨å†Œåˆ°selectorä¸Šï¼Œæ£€å¬åˆ°Readç­‰äº‹ä»¶ä»çº¿ç¨‹æ± ä¸­è·å–çº¿ç¨‹å¤„ç†ã€‚<br>ä¸»ä»æ¨¡å¼:æ²¡çœ‹æ‡‚:-(ï¼Œä¸€ä¸ªç«¯å£åªèƒ½è¢«ä¸€ä¸ªserverSocketChannelç›‘å¬ï¼Œç¬¬äºŒä¸ªå¥½åƒä¼šæŠ¥é”™?è¿™è¾¹çš„ä¸»ä»æ€ä¹ˆç†è§£å•Š","like_count":15,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453924,"discussion_content":"ä¸»ä»æ¨¡å¼åˆ™æ˜¯ï¼ŒReactorä¸»çº¿ç¨‹ä¸»è¦å¤„ç†ç›‘å¬è¿æ¥äº‹ä»¶ï¼Œè€ŒReactorä»çº¿ç¨‹ä¸»è¦ç›‘å¬I/Oäº‹ä»¶ã€‚è¿™é‡Œæ˜¯å¤šçº¿ç¨‹å¤„ç†acceptäº‹ä»¶ï¼Œè€Œä¸æ˜¯åˆ›å»ºå¤šä¸ªServerSocketChannelã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560650842,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2421369,"avatar":"https://static001.geekbang.org/account/avatar/00/24/f2/79/b2012f53.jpg","nickname":"ä½™ç”Ÿ","note":"","ucode":"AEF6C96738F03B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383215,"discussion_content":"æ„Ÿè§‰ä¸»ä»æ¨¡å¼åº”è¯¥æ˜¯è¿™æ ·: ä¸€ä¸ªçº¿ç¨‹ç›‘å¬è¿æ¥ï¼Œä¸€ä¸ªç½‘ç»œçº¿ç¨‹æ± readï¼Œä¸€ä¸ªworkçº¿ç¨‹æ± å¤„ç†æ¶ˆæ¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625993910,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1343671,"avatar":"","nickname":"Geek_bd613f","note":"","ucode":"69740C1D0FC15B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":40240,"discussion_content":"çŸ¥è¯†é‡å¥½å¤§ï¼Œè€å¸ˆè®²å¾—å¥½å¥½ï¼Œèƒ½å¦è¡¥å……ä¸‹BIOå’ŒNIOçš„ä»£ç å®ç°ï¼Œä¸ç†è§£ä¸ºä»€ä¹ˆBIOå°±æ˜¯é˜»å¡çš„ï¼ŒNIOå°±æ˜¯éé˜»å¡çš„ï¼ŸBIOå®¢æˆ·ç«¯çš„ä¸€ä¸ªè¯·æ±‚ï¼Œå°±ä¼šå¯ç”¨ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹ï¼Œå¹¶è¢«é˜»å¡åœ¨workerçº¿ç¨‹æ± çš„å¤„ç†ä¸Šï¼›é‚£NIOæ€ä¹ˆé¿å…ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥å°±å¯ç”¨ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹çš„å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572135721,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104038,"user_name":"æ¯å¤©æ™’ç™½ç‰™","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1560597965,"is_pvip":false,"replies":[{"id":"37653","content":"ä½ å¥½ï¼ŒReactoræ˜¯ä¸€ä¸ªæ¨¡å‹ï¼Œæ¯ä¸ªæ¡†æ¶æˆ–è€…æ¯ä¸ªå¼€å‘äººå‘˜åœ¨å¤„ç†I&#47;Oäº‹ä»¶å¯èƒ½ä¸ä¸€æ ·ï¼Œæ ¹æ®è‡ªå·±ä¸šåŠ¡åœºæ™¯æ¥å¤„ç†ã€‚<br><br>Nettyæ˜¯åŸºäºReactorä¸»çº¿ç¨‹å»ç›‘å¬è¿æ¥ï¼Œ Reactorä»çº¿ç¨‹æ± ç›‘å¬è¯»å†™äº‹ä»¶ï¼ŒåŒæ—¶å¦‚æœç›‘å¬åˆ°äº‹ä»¶åç›´æ¥åœ¨è¯¥ä»çº¿ç¨‹ä¸­æ“ä½œè¯»å†™I&#47;Oï¼Œå°†ä¸šåŠ¡äº¤ç»™å•ç‹¬çš„ä¸šåŠ¡çº¿ç¨‹æ± ï¼Œä¹Ÿå¯ä»¥ä¸äº¤ç»™å•ç‹¬çš„çº¿ç¨‹æ± å¤„ç†ï¼Œç›´æ¥åœ¨ä»çº¿ç¨‹æ± å¤„ç†ã€‚ä¸äº¤ç»™ä¸šåŠ¡çº¿ç¨‹æ± çš„å¥½å¤„æ˜¯ï¼Œå‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œåå¤„æ˜¯ä¼šé€ æˆçº¿ç¨‹é˜»å¡ã€‚<br><br>æ‰€ä»¥æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡çš„ç‰¹æ€§ï¼Œå¦‚æœä½ çš„æ•°æ®ç‰¹åˆ«å¤§ï¼ŒI&#47;Oè¯»å†™æ“ä½œæ”¾åˆ°handlerçº¿ç¨‹æ± ï¼Œï¼ŒReactorä»çº¿ç¨‹æ•°é‡æœ‰é™ï¼Œå¦‚æœå¼€å¤§äº†ï¼Œç”±äºå¼€å¤šä¸ªå¤šè·¯å¤ç”¨å™¨ä¹Ÿä¼šå¸¦æ¥æ€§èƒ½æ¶ˆè€—ã€‚æ‰€ä»¥è¿™ç§å¤„ç†ä¹Ÿæ˜¯ä¸€ç§æé«˜ç³»ç»Ÿååé‡çš„ä¼˜åŒ–ã€‚<br>","user_name":"ä½œè€…å›å¤","comment_id":104038,"uid":"1228576","ip_address":"","utype":1,"ctime":1560649450,"user_name_real":"åˆ˜è¶…"}],"discussion_count":1,"race_medal":1,"score":"61690140109","product_id":100028001,"comment_content":"è€å¸ˆæ‚¨åœ¨ä»‹ç»Reactorçº¿ç¨‹æ¨¡å‹çš„æ—¶å€™ï¼Œå…³äºå¤šçº¿ç¨‹Reactorçº¿ç¨‹æ¨¡å‹å’Œä¸»ä»Reactorçº¿ç¨‹æ¨¡å‹ï¼Œæˆ‘æœ‰ä¸åŒçš„ç†è§£ã€‚æ‚¨ç”»çš„å¤šçº¿ç¨‹æ¨¡å‹ï¼Œå…¶ä¸­è¯»å†™äº¤ç»™äº†çº¿ç¨‹æ± ï¼Œæˆ‘åœ¨çœ‹Doug Leaçš„ ã€ŠScalable in javaã€‹ä¸­ç”»çš„å›¾å’Œä»£ç ç¤ºä¾‹ï¼Œè¯»å†™äº‹ä»¶è¿˜æ˜¯ç”±Reactorçº¿ç¨‹å¤„ç†ï¼ŒåªæŠŠä¸šåŠ¡å¤„ç†äº¤ç»™äº†çº¿ç¨‹æ± ã€‚ä¸»ä»æ¨¡å‹ä¹Ÿæ˜¯åŒæ ·çš„ï¼ŒReactorä¸»çº¿ç¨‹å¤„ç†è¿æ¥ï¼ŒReactorä»çº¿ç¨‹æ± å¤„ç†è¯»å†™äº‹ä»¶ï¼Œä¸šåŠ¡äº¤ç»™å•ç‹¬çš„çº¿ç¨‹æ± å¤„ç†ã€‚<br>è¿˜æœ›è€å¸ˆæŒ‡ç‚¹","like_count":14,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454098,"discussion_content":"ä½ å¥½ï¼ŒReactoræ˜¯ä¸€ä¸ªæ¨¡å‹ï¼Œæ¯ä¸ªæ¡†æ¶æˆ–è€…æ¯ä¸ªå¼€å‘äººå‘˜åœ¨å¤„ç†I/Oäº‹ä»¶å¯èƒ½ä¸ä¸€æ ·ï¼Œæ ¹æ®è‡ªå·±ä¸šåŠ¡åœºæ™¯æ¥å¤„ç†ã€‚\n\nNettyæ˜¯åŸºäºReactorä¸»çº¿ç¨‹å»ç›‘å¬è¿æ¥ï¼Œ Reactorä»çº¿ç¨‹æ± ç›‘å¬è¯»å†™äº‹ä»¶ï¼ŒåŒæ—¶å¦‚æœç›‘å¬åˆ°äº‹ä»¶åç›´æ¥åœ¨è¯¥ä»çº¿ç¨‹ä¸­æ“ä½œè¯»å†™I/Oï¼Œå°†ä¸šåŠ¡äº¤ç»™å•ç‹¬çš„ä¸šåŠ¡çº¿ç¨‹æ± ï¼Œä¹Ÿå¯ä»¥ä¸äº¤ç»™å•ç‹¬çš„çº¿ç¨‹æ± å¤„ç†ï¼Œç›´æ¥åœ¨ä»çº¿ç¨‹æ± å¤„ç†ã€‚ä¸äº¤ç»™ä¸šåŠ¡çº¿ç¨‹æ± çš„å¥½å¤„æ˜¯ï¼Œå‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œåå¤„æ˜¯ä¼šé€ æˆçº¿ç¨‹é˜»å¡ã€‚\n\næ‰€ä»¥æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡çš„ç‰¹æ€§ï¼Œå¦‚æœä½ çš„æ•°æ®ç‰¹åˆ«å¤§ï¼ŒI/Oè¯»å†™æ“ä½œæ”¾åˆ°handlerçº¿ç¨‹æ± ï¼Œï¼ŒReactorä»çº¿ç¨‹æ•°é‡æœ‰é™ï¼Œå¦‚æœå¼€å¤§äº†ï¼Œç”±äºå¼€å¤šä¸ªå¤šè·¯å¤ç”¨å™¨ä¹Ÿä¼šå¸¦æ¥æ€§èƒ½æ¶ˆè€—ã€‚æ‰€ä»¥è¿™ç§å¤„ç†ä¹Ÿæ˜¯ä¸€ç§æé«˜ç³»ç»Ÿååé‡çš„ä¼˜åŒ–ã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560649450,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104353,"user_name":"ä½ å¥½æ—…è¡Œè€…","can_delete":false,"product_type":"c1","uid":1154101,"ip_address":"","ucode":"5C72A428DC28F3","user_header":"https://static001.geekbang.org/account/avatar/00/11/9c/35/9dc79371.jpg","comment_is_top":false,"comment_ctime":1560735480,"is_pvip":false,"replies":[{"id":"37870","content":"ç†è§£æ­£ç¡®ã€‚selectç›‘å¬åˆ°äº‹ä»¶ä¹‹åå°±ç”¨å½“å‰çº¿ç¨‹æŠŠæ•°æ®ä»å†…æ ¸æ€æ‹·è´åˆ°ç”¨æˆ·æ€ã€‚","user_name":"ä½œè€…å›å¤","comment_id":104353,"uid":"1228576","ip_address":"","utype":1,"ctime":1560822664,"user_name_real":"åˆ˜è¶…"}],"discussion_count":2,"race_medal":0,"score":"35920473848","product_id":100028001,"comment_content":"I&#47;Oå¤šè·¯å¤ç”¨å…¶å®å°±ç›¸å½“äºç”¨äº†ä¸€ä¸ªä¸“é—¨çš„çº¿ç¨‹æ¥ç›‘å¬å¤šä¸ªæ³¨å†Œçš„äº‹ä»¶ï¼Œè€Œä¹‹å‰çš„IOæ¨¡å‹ä¸­ï¼Œæ¯ä¸€ä¸ªäº‹ä»¶éƒ½éœ€è¦ä¸€ä¸ªçº¿ç¨‹æ¥ç›‘å¬ï¼Œä¸çŸ¥é“æˆ‘è¿™æ ·ç†è§£çš„æ˜¯å¦æ­£ç¡®ï¼Ÿè€å¸ˆæˆ‘è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å½“selectç›‘å¬åˆ°ä¸€ä¸ªäº‹ä»¶åˆ°æ¥æ—¶ï¼Œå®ƒæ˜¯å¦èµ·ä¸€ä¸ªçº¿ç¨‹æŠŠæ•°æ®ä»å†…æ ¸æ€æ‹·è´åˆ°ç”¨æˆ·æ€ï¼Œè¿˜æ˜¯è‡ªå·±å°±æŠŠè¿™ä¸ªäº‹å„¿ç»™å¹²äº†ï¼Ÿ","like_count":8,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454238,"discussion_content":"ç†è§£æ­£ç¡®ã€‚selectç›‘å¬åˆ°äº‹ä»¶ä¹‹åå°±ç”¨å½“å‰çº¿ç¨‹æŠŠæ•°æ®ä»å†…æ ¸æ€æ‹·è´åˆ°ç”¨æˆ·æ€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560822664,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1445744,"avatar":"https://static001.geekbang.org/account/avatar/00/16/0f/70/f59db672.jpg","nickname":"æ§‘Â·å…ˆç”Ÿ","note":"","ucode":"897F0475592E3A","race_medal":2,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":359034,"discussion_content":"é‚£å¦‚æœåŒæ—¶æœ‰å¤šä¸ªé€šé“çš„æ•°æ®éƒ½å‡†å¤‡å¥½äº†ï¼Œselectçº¿ç¨‹è‡ªå·±æ‹·å¤šä¸ªé€šé“çš„æ•°æ®æ˜¯ä¸æ˜¯æœ‰äº›åƒåŠ›å•Šã€‚\n\nä¼šä¸ä¼šå­˜åœ¨å¤šä¸ªé€šé“åŒæ—¶å‡†å¤‡å¥½çš„æƒ…å†µå•Šã€‚æ„Ÿè§‰è¿™é‡Œè¿˜æœ‰ç‚¹æ¨¡ç³Šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616085559,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113565,"user_name":"è¡Œè€…","can_delete":false,"product_type":"c1","uid":1063734,"ip_address":"","ucode":"EA31201A7C5AE1","user_header":"https://static001.geekbang.org/account/avatar/00/10/3b/36/2d61e080.jpg","comment_is_top":false,"comment_ctime":1563080424,"is_pvip":false,"replies":[{"id":"41370","content":"å¯¹çš„ï¼Œredisæœ¬èº«æ˜¯æ“ä½œå†…å­˜ï¼Œæ‰€ä»¥è¯»å–æ•°æ®çš„æ•ˆç‡ä¼šé«˜å¾ˆå¤šã€‚","user_name":"ä½œè€…å›å¤","comment_id":113565,"uid":"1228576","ip_address":"","utype":1,"ctime":1563090117,"user_name_real":"åˆ˜è¶…"}],"discussion_count":1,"race_medal":0,"score":"27332884200","product_id":100028001,"comment_content":"æ„Ÿè°¢è€å¸ˆåˆ†äº«ï¼Œè”æƒ³åˆ°Redisçš„å•çº¿ç¨‹æ¨¡å¼ï¼ŒRedisä½¿ç”¨åŒä¸€ä¸ªçº¿ç¨‹æ¥åšselectorï¼Œä»¥åŠå¤„ç†handlerï¼Œè¿™æ ·çš„ä¼˜ç‚¹æ˜¯å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¸éœ€è¦è€ƒè™‘å¹¶å‘é—®é¢˜ï¼›ä½†æ˜¯ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œåœ¨IOæ•°æ®é‡å¤§çš„æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´QPSä¸‹é™ï¼›è¿™æ˜¯ç”±Redisé€‰æ‹©IOæ¨¡å‹å†³å®šçš„ã€‚","like_count":6,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458281,"discussion_content":"å¯¹çš„ï¼Œredisæœ¬èº«æ˜¯æ“ä½œå†…å­˜ï¼Œæ‰€ä»¥è¯»å–æ•°æ®çš„æ•ˆç‡ä¼šé«˜å¾ˆå¤šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563090117,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104237,"user_name":"z.l","can_delete":false,"product_type":"c1","uid":1181055,"ip_address":"","ucode":"805CC5784D3F76","user_header":"https://static001.geekbang.org/account/avatar/00/12/05/7f/d35ab9a1.jpg","comment_is_top":false,"comment_ctime":1560695159,"is_pvip":false,"replies":[{"id":"37785","content":"è¿™é‡Œçš„æœ¬åœ°å†…å­˜åº”è¯¥æŒ‡çš„æ˜¯ç‰©ç†å†…å­˜ï¼Œé¿å…å †å†…å­˜å’Œç‰©ç†å†…å­˜çš„æ‹·è´ï¼Œå…¶å®å°±æ˜¯é¿å…å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´çš„æ‹·è´ã€‚","user_name":"ä½œè€…å›å¤","comment_id":104237,"uid":"1228576","ip_address":"","utype":1,"ctime":1560736913,"user_name_real":"åˆ˜è¶…"}],"discussion_count":5,"race_medal":0,"score":"27330498935","product_id":100028001,"comment_content":"è€å¸ˆï¼Œéš”å£æå·åŒè€å¸ˆçš„ã€Šæ·±å…¥æ‹†è§£Tomcat &amp; Jettyã€‹ä¸­å…³äºDirectByteBufferçš„è§£é‡Šå’Œæ‚¨ä¸ä¸€æ ·ï¼Œä»–çš„æ–‡ç« ä¸­DirectByteBufferçš„ä½œç”¨æ˜¯ï¼šDirectByteBuffer é¿å…äº† JVM å †ä¸æœ¬åœ°å†…å­˜ç›´æ¥çš„æ‹·è´ï¼Œè€Œå¹¶æ²¡æœ‰é¿å…å†…å­˜ä»å†…æ ¸ç©ºé—´åˆ°ç”¨æˆ·ç©ºé—´çš„æ‹·è´ã€‚è€Œsendfile ç‰¹æ€§æ‰æ˜¯é¿å…äº†å†…æ ¸ä¸åº”ç”¨ä¹‹é—´çš„å†…å­˜æ‹·è´ã€‚è¯·é—®å“ªç§æ‰æ˜¯å¯¹çš„ï¼Ÿ","like_count":6,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454184,"discussion_content":"è¿™é‡Œçš„æœ¬åœ°å†…å­˜åº”è¯¥æŒ‡çš„æ˜¯ç‰©ç†å†…å­˜ï¼Œé¿å…å †å†…å­˜å’Œç‰©ç†å†…å­˜çš„æ‹·è´ï¼Œå…¶å®å°±æ˜¯é¿å…å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´çš„æ‹·è´ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560736913,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1326409,"avatar":"https://static001.geekbang.org/account/avatar/00/14/3d/49/adf90844.jpg","nickname":"æ—ä¼Ÿçƒ½","note":"","ucode":"97CE4039FAC8B7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1670,"discussion_content":"æå·åŒè€å¸ˆè¯´å¾—å¯¹","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1562806693,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1759325,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/d8/5d/07dfb3b5.jpg","nickname":"æ¯è«åœ","note":"","ucode":"4FA1D5CBBEF702","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578219,"discussion_content":"æ²¡è®¤çœŸçœ‹å§ è®²çš„å°±æ˜¯DirectBuffer é¿å…äº†å †å†…å­˜æ‹·è´åˆ°ç›´æ¥å†…å­˜ï¼Œè€Œæ˜¯ç›´æ¥æ‹·è´åˆ°ç‰©ç†å†…å­˜ã€‚æ²¡è¯´é¿å…äº†ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´çš„æ‹·è´ã€‚mmapæ‰æ˜¯é¿å…äº†æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´çš„æ‹·è´ã€‚ç”¨æˆ·æ€åœ°å€ç©ºé—´å’Œå†…æ ¸æ€åœ°å€ç©ºé—´æ˜ å°„åˆ°åŒä¸€å—ç‰©ç†å†…å­˜çš„ã€‚è¿™æ ·å°±æ²¡å¿…è¦èµ°ç”¨æˆ·æ€äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656584753,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2426501,"avatar":"","nickname":"Geek_b0c3f5","note":"","ucode":"0C834A0E64015E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":346790,"discussion_content":"åˆ˜è¶…è€å¸ˆè¯´å¾—å¯¹ï¼Œmmapæ˜¯æŠŠç”¨æˆ·åœ°å€ç©ºé—´å’Œå†…æ ¸åœ°å€ç©ºé—´æ˜ å°„åˆ°åŒä¸€å—ç‰©ç†å†…å­˜ï¼Œçœå»äº†æ•°æ®åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„copyã€‚ä¹Ÿæ˜¯é›¶copyçš„ä¸€ç§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612063783,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1006789,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5c/c5/1231d633.jpg","nickname":"æ¢ä¸­å","note":"","ucode":"52FE40242CBAD0","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":330,"discussion_content":"åœ°å†…å­˜ä¹Ÿæ˜¯åº”ç”¨çš„å†…å­˜ï¼Œå±äºç”¨æˆ·ç©ºé—´çš„è™šæ‹Ÿå†…å­˜å§?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561452613,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104899,"user_name":"ä½™å†²","can_delete":false,"product_type":"c1","uid":1175598,"ip_address":"","ucode":"162AF434FA753B","user_header":"https://static001.geekbang.org/account/avatar/00/11/f0/2e/b3c880b8.jpg","comment_is_top":false,"comment_ctime":1560866375,"is_pvip":false,"replies":[{"id":"38049","content":"å¥½çš„ï¼Œåé¢è¡¥ä¸Š","user_name":"ä½œè€…å›å¤","comment_id":104899,"uid":"1228576","ip_address":"","utype":1,"ctime":1560907294,"user_name_real":"åˆ˜è¶…"}],"discussion_count":2,"race_medal":0,"score":"18740735559","product_id":100028001,"comment_content":"è€å¸ˆèƒ½å¯¹reactorçš„å‡ ç§æ¨¡å‹ï¼Œç»™ä¸€ä¸ªç®€å•ç‰ˆçš„ä»£ç ä¾‹å­çœ‹çœ‹å—ã€‚æ„Ÿè§‰é€šè¿‡ä»£ç åº”è¯¥èƒ½æ›´å¥½çš„ç†è§£ç†è®ºã€‚","like_count":4,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454475,"discussion_content":"å¥½çš„ï¼Œåé¢è¡¥ä¸Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560907294,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1649057,"avatar":"https://static001.geekbang.org/account/avatar/00/19/29/a1/41607383.jpg","nickname":"hello","note":"","ucode":"4F42DAA5DB5C38","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394728,"discussion_content":"è€å“¥ï¼Œè€å¸ˆåé¢æœ‰ä¸Šä»£ç å—ï¼Ÿæˆ‘æ‰çœ‹åˆ°è¿™å„¿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632019987,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":181689,"user_name":"é˜¿å§","can_delete":false,"product_type":"c1","uid":1229566,"ip_address":"","ucode":"68C0CC25E57707","user_header":"https://static001.geekbang.org/account/avatar/00/12/c2/fe/038a076e.jpg","comment_is_top":false,"comment_ctime":1582616643,"is_pvip":false,"replies":[{"id":"70514","content":"å¯¹çš„ï¼Œredisåœ¨å¤„ç†æ–‡ä»¶äº‹ä»¶ï¼ˆä¾‹å¦‚GET SETå‘½ä»¤ï¼‰æ—¶æ˜¯é€šè¿‡äº‹ä»¶å¤„ç†å™¨å¾ªç¯é¡ºåºå¤„ç†å„ä¸ªäº‹ä»¶ã€‚","user_name":"ä½œè€…å›å¤","comment_id":181689,"uid":"1228576","ip_address":"","utype":1,"ctime":1582720546,"user_name_real":"åˆ˜è¶…"}],"discussion_count":1,"race_medal":0,"score":"14467518531","product_id":100028001,"comment_content":"è€å¸ˆï¼Œredisçš„ioå¤šè·¯å¤ç”¨æ¨¡å‹ï¼Œç”¨çš„æ˜¯å•çº¿ç¨‹reactorçº¿ç¨‹æ¨¡å‹å˜›ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485079,"discussion_content":"å¯¹çš„ï¼Œredisåœ¨å¤„ç†æ–‡ä»¶äº‹ä»¶ï¼ˆä¾‹å¦‚GET SETå‘½ä»¤ï¼‰æ—¶æ˜¯é€šè¿‡äº‹ä»¶å¤„ç†å™¨å¾ªç¯é¡ºåºå¤„ç†å„ä¸ªäº‹ä»¶ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582720546,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":208768,"user_name":"chp","can_delete":false,"product_type":"c1","uid":1112415,"ip_address":"","ucode":"F0A2442230CD45","user_header":"https://static001.geekbang.org/account/avatar/00/10/f9/5f/b0a125a9.jpg","comment_is_top":false,"comment_ctime":1587435137,"is_pvip":false,"replies":[{"id":"78617","content":"è¿™é‡Œè¯´çš„éé˜»å¡ï¼Œæ˜¯ä¼ªéé˜»å¡ï¼Œæ“ä½œç³»ç»Ÿå±‚é¢çš„epollè¿˜æ˜¯é˜»å¡çš„ï¼Œæ­£åœ¨å®ç°æ“ä½œç³»ç»Ÿå±‚é¢çš„éé˜»å¡æ˜¯AIO","user_name":"ä½œè€…å›å¤","comment_id":208768,"uid":"1228576","ip_address":"","utype":1,"ctime":1587990009,"user_name_real":"åˆ˜è¶…"}],"discussion_count":1,"race_medal":0,"score":"10177369729","product_id":100028001,"comment_content":"è€å¸ˆï¼Œä¸ºä»€ä¹ˆè¯´NIOæ˜¯åŒæ­¥éé˜»å¡å‘€ï¼ŸåŒæ­¥æˆ‘çŸ¥é“åŸå› ï¼Œé‚£ä¸ªéé˜»å¡æä¸æ‡‚ï¼Œselectå‡½æ•°ä¸æ˜¯å·²ç»é˜»å¡äº†å—ï¼Œè¿™å—è¦æ€ä¹ˆç†è§£å‘¢","like_count":2,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492612,"discussion_content":"è¿™é‡Œè¯´çš„éé˜»å¡ï¼Œæ˜¯ä¼ªéé˜»å¡ï¼Œæ“ä½œç³»ç»Ÿå±‚é¢çš„epollè¿˜æ˜¯é˜»å¡çš„ï¼Œæ­£åœ¨å®ç°æ“ä½œç³»ç»Ÿå±‚é¢çš„éé˜»å¡æ˜¯AIO","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587990009,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":168650,"user_name":"insist","can_delete":false,"product_type":"c1","uid":1054536,"ip_address":"","ucode":"1EE2800A900BA7","user_header":"https://static001.geekbang.org/account/avatar/00/10/17/48/3ab39c86.jpg","comment_is_top":false,"comment_ctime":1578131759,"is_pvip":false,"replies":[{"id":"65924","content":"å¤§å®¶éƒ½ä¸€æ ·ï¼Œæœ‰æ—¶é—´å¶å°”æ¡èµ·æ¥å†çœ‹çœ‹ï¼Œæ¸©æ•…è€ŒçŸ¥æ–°ï¼Œå¯ä»¥ä¸ºå¸ˆçŸ£","user_name":"ä½œè€…å›å¤","comment_id":168650,"uid":"1228576","ip_address":"","utype":1,"ctime":1578483564,"user_name_real":"åˆ˜è¶…"}],"discussion_count":1,"race_medal":0,"score":"10168066351","product_id":100028001,"comment_content":"æ„Ÿè°¢è€å¸ˆçš„è®²è§£ï¼Œå¾ˆç»†è‡´ï¼Œä»åº•å±‚åŸç†è§£é‡Šäº†5ä¸­IOæ¨¡å‹ã€‚åœ¨nettyï¼Œæˆ–è€…å…¶ä»–è¯¾ç¨‹ä¸­ï¼Œéƒ½æœ‰æ¥è§¦åˆ°è¿™ç±»çŸ¥è¯†ï¼Œä½†æ˜¯ä¸€ç›´æ²¡æœ‰æ€»ç»“ï¼Œæ€»æ˜¯çœ‹äº†æ„Ÿè§‰è‡ªå·±çŸ¥é“äº†ï¼Œä½†æ˜¯è¿‡æ®µæ—¶é—´é‡åˆ°è¿™ç±»é—®é¢˜ï¼Œåˆä¸çŸ¥é“æ˜¯ä¸ºä»€ä¹ˆã€‚","like_count":2,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480283,"discussion_content":"å¤§å®¶éƒ½ä¸€æ ·ï¼Œæœ‰æ—¶é—´å¶å°”æ¡èµ·æ¥å†çœ‹çœ‹ï¼Œæ¸©æ•…è€ŒçŸ¥æ–°ï¼Œå¯ä»¥ä¸ºå¸ˆçŸ£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578483564,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":103071,"user_name":"é™†ç¦»","can_delete":false,"product_type":"c1","uid":1483932,"ip_address":"","ucode":"2C8C206CE36A81","user_header":"https://static001.geekbang.org/account/avatar/00/16/a4/9c/b32ed9e9.jpg","comment_is_top":false,"comment_ctime":1560378793,"is_pvip":false,"replies":[{"id":"37491","content":"æ˜¯çš„ï¼Œåœ¨Tomcat9ç‰ˆæœ¬æ”¹æˆäº†é»˜è®¤NIOã€‚ <br><br>åœ¨Linuxç³»ç»Ÿä¸Šï¼ŒAIOçš„åº•å±‚å®ç°ä»ä½¿ç”¨EPOLLï¼Œæ²¡æœ‰å¾ˆå¥½å®ç°AIOï¼Œå› æ­¤åœ¨æ€§èƒ½ä¸Šæ²¡æœ‰æ˜æ˜¾çš„ä¼˜åŠ¿ï¼›<br><br>è¿™ä¸ªè·Ÿå †å†…å­˜æº¢å‡ºæ˜¯ç±»ä¼¼çš„é“ç†ï¼Œå¦‚æœç‰©ç†å†…å­˜è¢«åˆ†é…å®Œäº†å°±ä¼šå‡ºç°æº¢å‡ºé”™è¯¯ã€‚NIOä¸­çš„directbufferæ˜¯ç”¨æ¥åˆ†é…å†…å­˜è¯»å–æˆ–å†™å…¥æ•°æ®æ“ä½œï¼Œå¦‚æœæ•°æ®æ¯”è¾ƒå¤§ï¼Œè€Œdirectbufferåˆ†é…æ¯”è¾ƒä¸‹ï¼Œåˆ™ä¼šåˆ†å¤šæ¬¡å»è¯»å†™ï¼Œå¦‚æœæ•°æ®æ¯”è¾ƒå¤§çš„æƒ…å†µä¸‹å¯ä»¥é€‚å½“è°ƒå¤§æé«˜æ•ˆç‡ã€‚","user_name":"ä½œè€…å›å¤","comment_id":103071,"uid":"1228576","ip_address":"","utype":1,"ctime":1560479017,"user_name_real":"åˆ˜è¶…"}],"discussion_count":1,"race_medal":0,"score":"10150313385","product_id":100028001,"comment_content":"æˆ‘æ‰€ä½¿ç”¨çš„Tomcatç‰ˆæœ¬æ˜¯9ï¼Œé»˜è®¤çš„å°±æ˜¯NIOï¼Œæ˜¯ä¸æ˜¯ç‰ˆæœ¬ä¸åŒé»˜è®¤æ¨¡å‹ä¹Ÿä¸åŒï¼Ÿ<br>directbufferå¦‚æœæ»¡äº†ä¼šé˜»å¡è¿˜æ˜¯ä¼šæŠ¥é”™ï¼Ÿè¿™ä¸€å—çš„å¤§å°è®¾ç½®æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥ä¼˜åŒ–ï¼Ÿ<br>å› ä¸ºLinuxçš„aioè¿™ä¸€å—ä¸æˆç†Ÿæ‰€ä»¥nioç°åœ¨æ˜¯ä¸»æµï¼Ÿè¿˜æ˜¯æœ‰å…¶ä»–åŸå› ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453716,"discussion_content":"æ˜¯çš„ï¼Œåœ¨Tomcat9ç‰ˆæœ¬æ”¹æˆäº†é»˜è®¤NIOã€‚ \n\nåœ¨Linuxç³»ç»Ÿä¸Šï¼ŒAIOçš„åº•å±‚å®ç°ä»ä½¿ç”¨EPOLLï¼Œæ²¡æœ‰å¾ˆå¥½å®ç°AIOï¼Œå› æ­¤åœ¨æ€§èƒ½ä¸Šæ²¡æœ‰æ˜æ˜¾çš„ä¼˜åŠ¿ï¼›\n\nè¿™ä¸ªè·Ÿå †å†…å­˜æº¢å‡ºæ˜¯ç±»ä¼¼çš„é“ç†ï¼Œå¦‚æœç‰©ç†å†…å­˜è¢«åˆ†é…å®Œäº†å°±ä¼šå‡ºç°æº¢å‡ºé”™è¯¯ã€‚NIOä¸­çš„directbufferæ˜¯ç”¨æ¥åˆ†é…å†…å­˜è¯»å–æˆ–å†™å…¥æ•°æ®æ“ä½œï¼Œå¦‚æœæ•°æ®æ¯”è¾ƒå¤§ï¼Œè€Œdirectbufferåˆ†é…æ¯”è¾ƒä¸‹ï¼Œåˆ™ä¼šåˆ†å¤šæ¬¡å»è¯»å†™ï¼Œå¦‚æœæ•°æ®æ¯”è¾ƒå¤§çš„æƒ…å†µä¸‹å¯ä»¥é€‚å½“è°ƒå¤§æé«˜æ•ˆç‡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560479017,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":289242,"user_name":"null","can_delete":false,"product_type":"c1","uid":1024294,"ip_address":"","ucode":"F9039EFED6B55D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","comment_is_top":false,"comment_ctime":1618930293,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5913897589","product_id":100028001,"comment_content":"ç¬¬ 8 è¯¾åŸæ–‡ï¼š<br>DirectBuffer åªä¼˜åŒ–äº†ç”¨æˆ·ç©ºé—´å†…éƒ¨çš„æ‹·è´ï¼Œè€Œä¹‹å‰æˆ‘ä»¬æ˜¯è¯´ä¼˜åŒ–ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„æ‹·è´ï¼Œé‚£ Java çš„ NIO ä¸­æ˜¯å¦èƒ½åšåˆ°å‡å°‘ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„æ‹·è´ä¼˜åŒ–å‘¢ï¼Ÿ<br><br>ç¬¬ 11 è¯¾åŸæ–‡ï¼š<br>åœ¨ Java çš„ NIO ç¼–ç¨‹ä¸­ï¼Œåˆ™æ˜¯ä½¿ç”¨åˆ°äº† Direct Buffer æ¥å®ç°å†…å­˜çš„é›¶æ‹·è´ã€‚Java ç›´æ¥åœ¨ JVM å†…å­˜ç©ºé—´ä¹‹å¤–å¼€è¾Ÿäº†ä¸€ä¸ªç‰©ç†å†…å­˜ç©ºé—´ï¼Œè¿™æ ·å†…æ ¸å’Œç”¨æˆ·è¿›ç¨‹éƒ½èƒ½å…±äº«ä¸€ä»½ç¼“å­˜æ•°æ®ã€‚<br><br>è€å¸ˆï¼Œæ‚¨å¥½ï¼<br>ç¬¬ 8 è¯¾è¯´ï¼šDirectBuffer åªä¼˜åŒ–äº†ç”¨æˆ·ç©ºé—´å†…éƒ¨çš„æ‹·è´ï¼Œå¹¶éä¼˜åŒ–ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„ã€‚ç¬¬ 8 è¯¾æåˆ°çš„æ˜¯ MappedByteBuffer è°ƒç”¨ mmap æ–‡ä»¶å†…å­˜æ˜ å°„ï¼Œç›´æ¥ä»ç¡¬ç›˜è¯»å–æ•°æ®åˆ°ç”¨æˆ·ç©ºé—´ï¼Œæ²¡æœ‰ç»è¿‡å†…æ ¸ç©ºé—´ã€‚<br><br>ç¬¬ 11 è¯¾å¯¹ DirectBuffer æè¿°ä¸ºï¼šå†…æ ¸å’Œç”¨æˆ·è¿›ç¨‹éƒ½èƒ½å…±äº«ä¸€ä»½ç¼“å­˜æ•°æ®ã€‚<br><br>é—®é¢˜ï¼š<br>ç¬¬ 8 è¯¾è®²åªèƒ½ä¼˜åŒ–ç”¨æˆ·ç©ºé—´ã€‚ç¬¬ 11 è¯¾è®²ä¼˜åŒ–å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´ã€‚è¿™ 2 èŠ‚è¯¾çš„æè¿°æ˜¯å¦æœ‰å‡ºå…¥å–ï¼Ÿ<br><br>è°¢è°¢è€å¸ˆï¼","like_count":1},{"had_liked":false,"id":170071,"user_name":"AA","can_delete":false,"product_type":"c1","uid":1103583,"ip_address":"","ucode":"CADCB958D6DA1B","user_header":"https://static001.geekbang.org/account/avatar/00/10/d6/df/1e4ecd94.jpg","comment_is_top":false,"comment_ctime":1578501721,"is_pvip":false,"replies":[{"id":"67224","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","comment_id":170071,"uid":"1228576","ip_address":"","utype":1,"ctime":1579524470,"user_name_real":"åˆ˜è¶…"}],"discussion_count":1,"race_medal":0,"score":"5873469017","product_id":100028001,"comment_content":"acceptCountæ˜¯Acceptorä¸»çº¿ç¨‹æ•°ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480828,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579524470,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112776,"user_name":"kaixiao7","can_delete":false,"product_type":"c1","uid":1242577,"ip_address":"","ucode":"505EC4AFB5E656","user_header":"https://static001.geekbang.org/account/avatar/00/12/f5/d1/cc6f82eb.jpg","comment_is_top":false,"comment_ctime":1562824797,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5857792093","product_id":100028001,"comment_content":"è€å¸ˆï¼Œæœ‰ä¸¤ä¸ªç–‘æƒ‘è¿˜æœ›æ‚¨è§£ç­”ï¼Œè°¢è°¢<br>1. ulimit -n æ˜¾ç¤ºå•ä¸ªè¿›ç¨‹çš„æ–‡ä»¶å¥æŸ„æ•°ä¸º1024ï¼Œä½†æ˜¯å¯åŠ¨ä¸€ä¸ªsocketæœåŠ¡(bioå®ç°)å, cat &#47;proc&#47;&lt;pid&gt;&#47;limits ä¸­æ˜¾ç¤ºçš„open filesä¸º4096, å®é™…æµ‹è¯•å½“socketè¿æ¥æ•°è¾¾åˆ°4000å·¦å³æ—¶å°±æ— æ³•å†è¿æ¥äº†.   è¿˜è¯·è€å¸ˆè§£ç­”ä¸€ä¸‹4096æ€ä¹ˆæ¥çš„, ä¸ºä»€ä¹ˆ1024ä¸ç”Ÿæ•ˆå‘¢?<br>2. æ‚¨åœ¨æ–‡ä¸­æåˆ°epollä¸å—fdçš„é™åˆ¶. ä½†æ˜¯æˆ‘ç”¨NIOå®ç°çš„æœåŠ¡ç«¯ä¹Ÿæ˜¯åœ¨è¿æ¥åˆ°4000å·¦å³æ—¶æ— æ³•å†æ¥æ”¶æ–°çš„è¿æ¥, ç¯å¢ƒä¸ºCentos7(è™šæ‹Ÿæœº, å†…æ ¸3.10, é™¤äº†ç³»ç»Ÿä¹‹å¤–, æ²¡æœ‰è·‘å…¶ä»–ç¨‹åº), jdk1.8, ulimit -n ç»“æœä¸º1024, cat &#47;proc&#47;sys&#47;fs&#47;file-max ç»“æœä¸º382293. æŒ‰ç†è¯´socketè¿æ¥æ•°æœ€å¤§å¯ä»¥è¾¾åˆ°38000å·¦å³, ä»£ç å¦‚ä¸‹ï¼š<br>public static void main(String[] args) throws IOException {<br>        ServerSocketChannel channel = ServerSocketChannel.open();<br>        Selector selector = Selector.open();<br>        <br>        channel.configureBlocking(false);<br>        channel.socket().bind(new InetSocketAddress(10301));<br>        channel.register(selector, SelectionKey.OP_ACCEPT);<br><br>        int size = 0;<br>        <br>        while (true) {<br>            if (selector.select() == 0) {<br>                continue;<br>            }<br><br>            Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();<br>            while (iterator.hasNext()) {<br>                SelectionKey key = iterator.next();<br>                iterator.remove();<br>                <br>                if (key.isAcceptable()) {<br>                    size++;<br>                    ServerSocketChannel server = (ServerSocketChannel) key.channel();<br>                    SocketChannel client = server.accept();<br><br>                    System.out.println(&quot;å½“å‰å®¢æˆ·ç«¯è¿æ¥æ•°: &quot; + size + &quot;, &quot; + client.getRemoteAddress());<br>                }<br>            }<br>        }<br>        <br>    }","like_count":1,"discussions":[{"author":{"id":1142335,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6e/3f/49e5079f.jpg","nickname":"æ¥ä¼½å±±äºº","note":"","ucode":"5859C06DAC790D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541847,"discussion_content":"æˆ‘å¯¹è¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯ä¸è§£çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640583076,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1014665,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7b/89/34f2cbcc.jpg","nickname":"æ¨å®‡","note":"","ucode":"EB74DF6E269F03","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":13215,"discussion_content":"ulimit åˆ†ä¸ºSnå’ŒHnï¼Œé»˜è®¤ä¸€ä¸ª1024ä¸€ä¸ª4096","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568646315,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354944,"user_name":"accpan","can_delete":false,"product_type":"c1","uid":1654083,"ip_address":"ä¸Šæµ·","ucode":"2857ACB7106E02","user_header":"https://static001.geekbang.org/account/avatar/00/19/3d/43/72ace06e.jpg","comment_is_top":false,"comment_ctime":1660899182,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1660899182","product_id":100028001,"comment_content":"æ€»ç»“çš„å¾ˆåˆ°ä½","like_count":0},{"had_liked":false,"id":300750,"user_name":"å¹³æ°‘äººä¹‹åŠ©","can_delete":false,"product_type":"c1","uid":2658705,"ip_address":"","ucode":"5CCEC0BAC08AEC","user_header":"https://static001.geekbang.org/account/avatar/00/28/91/91/428a27a3.jpg","comment_is_top":false,"comment_ctime":1625371352,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625371352","product_id":100028001,"comment_content":"å…¶å®å¤§éƒ¨åˆ†çš„å…¬å¸éƒ½ç”¨undertowäº†ï¼Œè¿™ä¸ªæ˜¯é»˜è®¤å¼€å¯nioå—","like_count":0},{"had_liked":false,"id":300661,"user_name":"Mars","can_delete":false,"product_type":"c1","uid":1185131,"ip_address":"","ucode":"5CAA44E6076C27","user_header":"https://static001.geekbang.org/account/avatar/00/12/15/6b/4e472ff9.jpg","comment_is_top":false,"comment_ctime":1625297225,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625297225","product_id":100028001,"comment_content":"Tomcat ä¸­ï¼ŒBIOã€NIO æ˜¯åŸºäºä¸»ä» Reactor çº¿ç¨‹æ¨¡å‹å®ç°çš„ã€‚è¿™å¥è¯ä¸æ˜¯å¾ˆæ¸…æ¥šï¼ŒReactor çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°† I&#47;O äº‹ä»¶æ³¨å†Œåˆ°å¤šè·¯å¤ç”¨å™¨ä¸Šï¼Œä¸€æ—¦æœ‰ I&#47;O äº‹ä»¶è§¦å‘ï¼Œå¤šè·¯å¤ç”¨å™¨å°±ä¼šå°†äº‹ä»¶åˆ†å‘åˆ°äº‹ä»¶å¤„ç†å™¨ä¸­ï¼Œæ‰§è¡Œå°±ç»ªçš„ I&#47;O äº‹ä»¶æ“ä½œã€‚é‚£BIOæ²¡æœ‰æ‰€æœ‰çš„I&#47;Oäº‹ä»¶æ³¨å†Œï¼Œé‚£æ€ä¹ˆå¥—ç”¨Reatoræ¨¡å‹å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":289752,"user_name":"Geek_f67f40","can_delete":false,"product_type":"c1","uid":2583447,"ip_address":"","ucode":"E819443C553523","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/pM3u1b8RtXpsjH8wHzwKnmnsDiba2SfeRbj8ltNnbBNN59FD3ZOOvYDx42kFdBLvu3FuWDQnDba2sop1iaGqBq8A/132","comment_is_top":false,"comment_ctime":1619166003,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1619166003","product_id":100028001,"comment_content":"ä¸çŸ¥é“è€å¸ˆç”¨çš„æ˜¯å“ªä¸ªç‰ˆæœ¬ï¼Œä¼¼ä¹æ²¡æœ‰mmapçš„æºç æ˜¾ç¤ºï¼Œæˆ–è€…è¯´ï¼Œepollåº•å±‚æ ¹æœ¬æ²¡ä½¿ç”¨mmapï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2421369,"avatar":"https://static001.geekbang.org/account/avatar/00/24/f2/79/b2012f53.jpg","nickname":"ä½™ç”Ÿ","note":"","ucode":"AEF6C96738F03B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383216,"discussion_content":"epollæ ¹æœ¬æ²¡mmap","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625994348,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":282205,"user_name":"warriorSL","can_delete":false,"product_type":"c1","uid":1597200,"ip_address":"","ucode":"902DA345FD2623","user_header":"https://static001.geekbang.org/account/avatar/00/18/5f/10/ed332d5a.jpg","comment_is_top":false,"comment_ctime":1615131373,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1615131373","product_id":100028001,"comment_content":"è¿™ç¯‡æ–‡ç« å¯¹äºç†è§£æœåŠ¡å™¨å¤„ç†ç½‘ç»œè¯·æ±‚çº¿ç¨‹æ¨¡å‹çœŸæ˜¯å¤ªä¼˜ç§€äº†","like_count":0},{"had_liked":false,"id":282077,"user_name":"æ˜ŸæœŸä¸€","can_delete":false,"product_type":"c1","uid":1125327,"ip_address":"","ucode":"2957D71C555E43","user_header":"https://static001.geekbang.org/account/avatar/00/11/2b/cf/bfb4d21f.jpg","comment_is_top":false,"comment_ctime":1615045796,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1615045796","product_id":100028001,"comment_content":"sun.nio.ch.ServerSocketChannelImpl#accept()<br>public SocketChannel accept() throws IOException {<br>        Object var1 = this.lock;<br>        synchronized(this.lock) {<br>            ......<br>        }<br>}  å’Œæ–‡ä¸­Acceptor çº¿ç¨‹æ± æœ‰å†²çªå—ï¼Ÿ","like_count":0},{"had_liked":false,"id":270523,"user_name":"æƒ˜ é—»","can_delete":false,"product_type":"c1","uid":1181650,"ip_address":"","ucode":"C5909F034BF072","user_header":"https://static001.geekbang.org/account/avatar/00/12/07/d2/0d7ee298.jpg","comment_is_top":false,"comment_ctime":1609150064,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609150064","product_id":100028001,"comment_content":"BIOé€šè¿‡forkä¸€ä¸ªå­è¿›ç¨‹å¤„ç†ä¸€ä¸ªå¯¹åº”è¿æ¥,NIOä¸€ä¸ªè¿›ç¨‹å¯¹åº”å¤šä¸ªè¿æ¥,å†é€šè¿‡å¤šä¸ªçº¿ç¨‹å¤„ç†å¯¹åº”çš„è¿æ¥ä¸Šçš„io.","like_count":0},{"had_liked":false,"id":270514,"user_name":"æƒ˜ é—»","can_delete":false,"product_type":"c1","uid":1181650,"ip_address":"","ucode":"C5909F034BF072","user_header":"https://static001.geekbang.org/account/avatar/00/12/07/d2/0d7ee298.jpg","comment_is_top":false,"comment_ctime":1609148877,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609148877","product_id":100028001,"comment_content":"ç¨‹åºä¼šé€šè¿‡ Selector æ¥è½®è¯¢æ³¨å†Œåœ¨å…¶ä¸Šçš„ Channelï¼Œå½“å‘ç°ä¸€ä¸ªæˆ–å¤šä¸ª Channel å¤„äºå°±ç»ªçŠ¶æ€æ—¶.<br>è€å¸ˆçš„è¿™å¥è¯ä¸å¤ªæ˜ç™½,epollå®ç°äº†é˜»å¡æ—¶çš„ç›‘å¬å›è°ƒ,ä¸ºä»€ä¹ˆselectorè¿˜æ˜¯ä½¿ç”¨è½®å¾ªå‘¢?è½®å¾ªä¸æ˜¯éå¸¸æ¶ˆè€—æ€§èƒ½å˜›?","like_count":0},{"had_liked":false,"id":270510,"user_name":"æƒ˜ é—»","can_delete":false,"product_type":"c1","uid":1181650,"ip_address":"","ucode":"C5909F034BF072","user_header":"https://static001.geekbang.org/account/avatar/00/12/07/d2/0d7ee298.jpg","comment_is_top":false,"comment_ctime":1609148166,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609148166","product_id":100028001,"comment_content":"select é€šè¿‡é˜»å¡åè¢«å”¤é†’çš„éå†è¯»å–fdæ•°ç»„æ¥æ“ä½œio,pollåœ¨selectä¹‹ä¸Šå»é™¤äº†å¯¹ç®¡ç†çš„fdæ•°ç»„ä¸­fdå…ƒç´ æ•°é‡çš„é™åˆ¶,epollé‡‡ç”¨çº¢é»‘æ ‘å­˜æ”¾fdæé«˜äº†åˆ å†™æŸ¥æ€§èƒ½,é‡‡ç”¨äº‹ä»¶ç›‘å¬å›è°ƒæ¥æ“ä½œio.","like_count":0},{"had_liked":false,"id":269649,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1608726550,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608726550","product_id":100028001,"comment_content":"&quot;è¿æ¥åœ¨ accept é˜Ÿåˆ—ä¸­ç­‰å¾…è¶…æ—¶ã€‚å¦‚æœ accept é˜Ÿåˆ—è¿‡å¤§ï¼Œå°±å®¹æ˜“æµªè´¹è¿æ¥ã€‚&quot;<br>-----------------------<br>è¿™é‡Œæ„Ÿè§‰æ²¡å¾ˆçœ‹å¾—å¾ˆæ¸…æ¥šï¼Œè¯´ä¸‹æˆ‘çš„ç†è§£ï¼š<br>æµªè´¹è¿æ¥æ˜¯å› ä¸ºä»acceptä¸­å–å‡ºæ¥ä¹‹åæ”¾å…¥workerçº¿ç¨‹æ± ï¼Œä½†workerçº¿ç¨‹æ± ç”±äºå¹¶å‘é‡å¤ªå¤§å·²ç»è¾¾åˆ°æœ€å¤§çš„çº¿ç¨‹æ•°ï¼Œæ‰€ä»¥åªèƒ½åœ¨é˜Ÿåˆ—æ’é˜Ÿï¼Œè€Œå¦‚æœçº¿ç¨‹æ± çš„é˜Ÿåˆ—ä¹Ÿå æ»¡ï¼Œé‚£å°±åªèƒ½æ‹’ç»äº†ã€‚æ‰€ä»¥accepté˜Ÿåˆ—å°±ç®—è®¾ç½®çš„å¾ˆå¤§ï¼Œworkerçº¿ç¨‹æ± å¤„ç†ä¸è¿‡æ¥å¯¼è‡´çº¿ç¨‹æ— æ³•é‡Šæ”¾ï¼Œé‚£è¿˜æ˜¯æ— æµäºäº‹ã€‚è€å¸ˆï¼Œæˆ‘ç†è§£çš„å¯¹å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":248929,"user_name":"Geek_89bbab","can_delete":false,"product_type":"c1","uid":1156607,"ip_address":"","ucode":"B3110D5B3C9500","user_header":"https://static001.geekbang.org/account/avatar/00/11/a5/ff/6201122c.jpg","comment_is_top":false,"comment_ctime":1600362534,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1600362534","product_id":100028001,"comment_content":"è€å¸ˆï¼Œé—®ä¸€ä¸‹epollä¸­å“ªé‡Œä½¿ç”¨äº†mmap,æˆ‘çœ‹äº†linuxæºç æ²¡æœ‰çœ‹åˆ°epollä¸­ä½¿ç”¨mmapã€‚<br>â€œI&#47;O å¤ç”¨ä¸­çš„ epoll å‡½æ•°ä¸­å°±æ˜¯ä½¿ç”¨äº† mmap å‡å°‘äº†å†…å­˜æ‹·è´ã€‚â€è¿™ä¸ªç»“è®ºçš„å‡ºå¤„æ˜¯å“ªé‡Œï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2421369,"avatar":"https://static001.geekbang.org/account/avatar/00/24/f2/79/b2012f53.jpg","nickname":"ä½™ç”Ÿ","note":"","ucode":"AEF6C96738F03B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383127,"discussion_content":"epollåº”è¯¥æ˜¯æ²¡æœ‰ç”¨mmapçš„ï¼Œæœ‰å¾ˆå¤§ä¸€æ‹¨æ–‡ç« éƒ½è¯´ç”¨äº†mmapéƒ½æ˜¯ä»¥è®¹ä¼ è®¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625914409,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":244721,"user_name":"æ—…é€”","can_delete":false,"product_type":"c1","uid":1212902,"ip_address":"","ucode":"5022477E8E9441","user_header":"https://static001.geekbang.org/account/avatar/00/12/81/e6/6cafed37.jpg","comment_is_top":false,"comment_ctime":1598631618,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598631618","product_id":100028001,"comment_content":"è€å¸ˆ directbufferçš„ä½œç”¨æ˜¯å †èƒ½ç›´æ¥æ‹·è´åˆ°å†…æ ¸ç©ºé—´æ˜¯å—","like_count":0},{"had_liked":false,"id":199318,"user_name":"10å¹´ä»¥å","can_delete":false,"product_type":"c1","uid":1297421,"ip_address":"","ucode":"FE58CA7E5C2AF9","user_header":"https://static001.geekbang.org/account/avatar/00/13/cc/0d/89435926.jpg","comment_is_top":false,"comment_ctime":1585486671,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585486671","product_id":100028001,"comment_content":"nio","like_count":0},{"had_liked":false,"id":165965,"user_name":"é˜¿æœ","can_delete":false,"product_type":"c1","uid":1066705,"ip_address":"","ucode":"349D3572F5ABE7","user_header":"https://static001.geekbang.org/account/avatar/00/10/46/d1/a1ddf49f.jpg","comment_is_top":false,"comment_ctime":1577352475,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577352475","product_id":100028001,"comment_content":"é›¶æ‹·è´ï¼Œæ¯æ¬¡ioéƒ½è¦ç»å†å››æ¬¡æ•°æ®æ‹·è´ï¼Œé›¶æ‹·è´æ˜¯Direct Bufferå®ç°ï¼Œjavaç›´æ¥ç”³è¯·äº†ä¸€å—ç‰©ç†å†…å­˜ï¼Œæ•°æ®ç›´æ¥ä»å†…æ ¸ç»™ç”¨æˆ·è¿›ç¨‹ã€‚","like_count":0},{"had_liked":false,"id":165665,"user_name":"å¼ æ‚¦","can_delete":false,"product_type":"c1","uid":1182317,"ip_address":"","ucode":"1E403BEEFFBF2B","user_header":"https://static001.geekbang.org/account/avatar/00/12/0a/6d/61ace552.jpg","comment_is_top":false,"comment_ctime":1577280558,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577280558","product_id":100028001,"comment_content":"äºŒåˆ·ï¼Œè¿˜æ˜¯åˆ˜è€å¸ˆå†™çš„å¥½ï¼Œçœ‹çš„èˆ’æœ","like_count":0},{"had_liked":false,"id":165300,"user_name":"æ‘å¤«","can_delete":false,"product_type":"c1","uid":1434041,"ip_address":"","ucode":"B70D4E421A281B","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erdesQy0moaicYTicoHRQXzbmJm15wohb77qD1OdbuSqPCSUerbcZHzxJJunfmEhTx4kBLxbGaxQ9iag/132","comment_is_top":false,"comment_ctime":1577195975,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577195975","product_id":100028001,"comment_content":"å­¦åˆ°å¾ˆå¤š","like_count":0},{"had_liked":false,"id":162490,"user_name":"é˜¿æœ","can_delete":false,"product_type":"c1","uid":1066705,"ip_address":"","ucode":"349D3572F5ABE7","user_header":"https://static001.geekbang.org/account/avatar/00/10/46/d1/a1ddf49f.jpg","comment_is_top":false,"comment_ctime":1576545505,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576545505","product_id":100028001,"comment_content":"åœ¨ NIO æœåŠ¡ç«¯é€šä¿¡ç¼–ç¨‹ä¸­ï¼Œé¦–å…ˆä¼šåˆ›å»ºä¸€ä¸ª Channelï¼Œç”¨äºç›‘å¬å®¢æˆ·ç«¯è¿æ¥ï¼›æ¥ç€ï¼Œåˆ›å»ºå¤šè·¯å¤ç”¨å™¨ Selectorï¼Œå¹¶å°† Channel æ³¨å†Œåˆ° Selectorï¼Œç¨‹åºä¼šé€šè¿‡ Selector æ¥è½®è¯¢æ³¨å†Œåœ¨å…¶ä¸Šçš„ Channelï¼Œå½“å‘ç°ä¸€ä¸ªæˆ–å¤šä¸ª Channel å¤„äºå°±ç»ªçŠ¶æ€æ—¶ï¼Œè¿”å›å°±ç»ªçš„ç›‘å¬äº‹ä»¶ï¼Œæœ€åç¨‹åºåŒ¹é…åˆ°ç›‘å¬äº‹ä»¶ï¼Œè¿›è¡Œç›¸å…³çš„ I&#47;O æ“ä½œã€‚<br>è¿™æ®µæ€»ç»“çš„å¾ˆå¥½ã€‚<br>è¿˜æœ‰äº†è§£åˆ°çº¿ç¨‹æ± çš„é€»è¾‘è¿˜æ˜¯æœ‰å¾ˆå¤šåœ°æ–¹å®ç°çš„ï¼Œåƒè¿™é‡Œçš„reactorä¹Ÿæ˜¯ï¼Œè€Œä¸”å‚æ•°åŸºæœ¬å’Œjavaçº¿ç¨‹æ± å‚æ•°ä¸€è‡´çš„ã€‚çœ‹æ¥å¾ˆå¤šä¼˜ç§€çš„å®ç°é€»è¾‘åœ¨ä¸åŒçš„åº”ç”¨ä¸­æ˜¯å¯ä»¥å¤åˆ¶çš„ã€‚","like_count":0},{"had_liked":false,"id":158397,"user_name":"é‚±æŸæ£®","can_delete":false,"product_type":"c1","uid":1113827,"ip_address":"","ucode":"ED91FEEC083F3D","user_header":"https://static001.geekbang.org/account/avatar/00/10/fe/e3/7da333ae.jpg","comment_is_top":false,"comment_ctime":1575363984,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575363984","product_id":100028001,"comment_content":"&gt; poll() å‡½æ•°ï¼šåœ¨æ¯æ¬¡è°ƒç”¨ select() å‡½æ•°ä¹‹å‰ï¼Œç³»ç»Ÿéœ€è¦æŠŠä¸€ä¸ª fd ä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€ï¼Œè¿™æ ·å°±ç»™ç³»ç»Ÿå¸¦æ¥äº†ä¸€å®šçš„æ€§èƒ½å¼€é”€<br>è¿™é‡Œåº”è¯¥æ˜¯æ‹·è´ä¸‰ç»„fd_set","like_count":0},{"had_liked":false,"id":141284,"user_name":"Sdylan","can_delete":false,"product_type":"c1","uid":1008503,"ip_address":"","ucode":"4589D0D0FA9275","user_header":"https://static001.geekbang.org/account/avatar/00/0f/63/77/423345ab.jpg","comment_is_top":false,"comment_ctime":1571135732,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571135732","product_id":100028001,"comment_content":"2019.10.15 éœ€è¦ç»†çœ‹  ","like_count":0},{"had_liked":false,"id":134674,"user_name":"çƒˆå†¬å†°å¤","can_delete":false,"product_type":"c1","uid":1060113,"ip_address":"","ucode":"F2875FC596D4FA","user_header":"https://static001.geekbang.org/account/avatar/00/10/2d/11/0ecbe9ea.jpg","comment_is_top":false,"comment_ctime":1568890928,"is_pvip":false,"replies":[{"id":"51871","content":"ä¸¤è€…åŒºåˆ«åœ¨äºBIOæ˜¯é˜»å¡IOï¼Œè€ŒNIOä¸ºéé˜»å¡IO","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1569054669,"ip_address":"","comment_id":134674,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1568890928","product_id":100028001,"comment_content":"Tomcat ä¸­ï¼ŒBIOã€NIO æ˜¯åŸºäºä¸»ä» Reactorä¸»ä»ï¼Œé‚£2åˆ™çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢","like_count":0,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467858,"discussion_content":"ä¸¤è€…åŒºåˆ«åœ¨äºBIOæ˜¯é˜»å¡IOï¼Œè€ŒNIOä¸ºéé˜»å¡IO","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569054669,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":131927,"user_name":"é’±","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1567983920,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567983920","product_id":100028001,"comment_content":"å¯èƒ½åŠŸåŠ›æœªåˆ°ï¼Œè¿™æ¬¡å…³äºå„ç§IOçš„é€šä¿¡æ¨¡å‹æ²¡å®Œå…¨GETåˆ°ç‚¹ï¼Œè¿™ä¸€éƒ¨åˆ†åˆæ˜¯å¿…é¡»è¦å¼„æ˜ç™½çš„ï¼Œä»Šå¹´åŒåä¸€åˆè¦å¼€å§‹ä¸€æ³¢å›¤ä¹¦ï¼Œã€ŠUNIX ç½‘ç»œç¼–ç¨‹ã€‹å·²åŠ å…¥è´­ç‰©è½¦ã€‚","like_count":0},{"had_liked":false,"id":106882,"user_name":"Geek_ebda96","can_delete":false,"product_type":"c1","uid":1134862,"ip_address":"","ucode":"02912E6D95A5A6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoRiaKX0ulEibbbwM4xhjyMeza0Pyp7KO1mqvfJceiaM6ZNtGpXJibI6P2qHGwBP9GKwOt9LgHicHflBXw/132","comment_is_top":false,"comment_ctime":1561421718,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561421718","product_id":100028001,"comment_content":"è€å¸ˆï¼Œè¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼Œmaxthreadsè¿™ä¸ªå‚æ•°åœ¨tomcatä¸­æ˜¯æŒ‡åªæ˜¯å•ç‹¬å¤„ç†I&#47;oçš„è¯»å†™çº¿ç¨‹æ•°ï¼Œè¿˜æ˜¯è¯»å–å®Œæ•°æ®åï¼Œæœ¬èº«çš„ä¸šåŠ¡å±‚å¤„ç†ä¹Ÿæ˜¯åœ¨è¿™ä¸ªçº¿ç¨‹æ± é‡Œå¤„ç†","like_count":0},{"had_liked":false,"id":104861,"user_name":"å¾çˆ±æœ‰ä¸‰","can_delete":false,"product_type":"c1","uid":1138007,"ip_address":"","ucode":"FC5B32E36CE249","user_header":"https://static001.geekbang.org/account/avatar/00/11/5d/57/82f1a3d4.jpg","comment_is_top":false,"comment_ctime":1560858563,"is_pvip":false,"replies":[{"id":"38052","content":"è¿™é‡Œçš„æŒ‚èµ·æ˜¯ä¸€ä¸ªåŠ¨ä½œï¼Œé˜»å¡æ˜¯ä¸€ç§çŠ¶æ€ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1560907819,"ip_address":"","comment_id":104861,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560858563","product_id":100028001,"comment_content":"æ–‡ç« å¤šæ¬¡æåˆ°æŒ‚èµ·ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç„¶åˆ°æŒ‚èµ·ç­‰ä»·é˜»å¡ï¼Ÿä¸æ˜¯å§","like_count":0,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454459,"discussion_content":"è¿™é‡Œçš„æŒ‚èµ·æ˜¯ä¸€ä¸ªåŠ¨ä½œï¼Œé˜»å¡æ˜¯ä¸€ç§çŠ¶æ€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560907819,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":103860,"user_name":"-W.LI-","can_delete":false,"product_type":"c1","uid":1210699,"ip_address":"","ucode":"3556786538664F","user_header":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","comment_is_top":false,"comment_ctime":1560553218,"is_pvip":false,"replies":[{"id":"37658","content":"epollæ˜¯ä½¿ç”¨äº†waitæ–¹æ³•é˜»å¡ç­‰å¾…äº‹ä»¶ï¼Œæ‰€ä»¥æ˜¯é˜»å¡çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1560650485,"ip_address":"","comment_id":103860,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560553218","product_id":100028001,"comment_content":"è€å¸ˆå¥½!åˆçœ‹äº†ä¸€éæ€»ç»“äº†ä¸‹<br>epoll()æ–¹å¼çš„ä¼˜ç‚¹å¦‚ä¸‹<br>1.æ— éœ€ç”¨æˆ·ç©ºé—´åˆ°å†…æ ¸ç©ºé—´çš„fdæ‹·è´è¿‡ç¨‹ã€‚<br>2.é€šè¿‡äº‹ä»¶è¡¨ï¼Œåªè¿”å›å°±ç»ªäº‹ä»¶æ— éœ€è½®è®­éå†<br>3.åŸºäºçº¢é»‘æ ‘å¢åˆ å¿«ã€‚<br>4.äº‹ä»¶å‘ç”Ÿåå†…æ ¸ä¸»åŠ¨å›è°ƒï¼Œç”¨æˆ·è¿›ç¨‹waitçŠ¶æ€(æ­¤æ—¶ç®—é˜»å¡è¿˜æ˜¯éé˜»å¡å•Š?)<br>å†…æ ¸ä¹Ÿåƒè§‚å¯Ÿè€…ï¼Œ(äº‹ä»¶é©±åŠ¨çš„éƒ½åƒè§‚å¯Ÿè€…)<br>è¿˜æœ‰åˆ«çš„ä¼˜ç‚¹ä¹ˆ?","like_count":0,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454027,"discussion_content":"epollæ˜¯ä½¿ç”¨äº†waitæ–¹æ³•é˜»å¡ç­‰å¾…äº‹ä»¶ï¼Œæ‰€ä»¥æ˜¯é˜»å¡çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560650485,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":103735,"user_name":"ç‹ç››æ­¦","can_delete":false,"product_type":"c1","uid":1182516,"ip_address":"","ucode":"DE7EF246D3DCE8","user_header":"https://static001.geekbang.org/account/avatar/00/12/0b/34/f41d73a4.jpg","comment_is_top":false,"comment_ctime":1560499918,"is_pvip":false,"replies":[{"id":"37660","content":"ä¸æ˜¯çš„ï¼Œè¿™ä¸ªacceptCountæ˜¯Acceptorçš„çº¿ç¨‹æ•°é‡ï¼Œä¹Ÿå°±æ˜¯Reactorä¸»çº¿ç¨‹æ•°é‡ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1560650571,"ip_address":"","comment_id":103735,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1560499918","product_id":100028001,"comment_content":"åˆ˜è€å¸ˆï¼Œè¯·é—®pollerçº¿ç¨‹æ±  polleré˜Ÿåˆ—å’Œæ–‡æœ«æçš„acceptCounté˜Ÿåˆ—æ˜¯ä¸æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Ÿ<br>","like_count":0,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453985,"discussion_content":"ä¸æ˜¯çš„ï¼Œè¿™ä¸ªacceptCountæ˜¯Acceptorçš„çº¿ç¨‹æ•°é‡ï¼Œä¹Ÿå°±æ˜¯Reactorä¸»çº¿ç¨‹æ•°é‡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560650571,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1397434,"avatar":"https://static001.geekbang.org/account/avatar/00/15/52/ba/412b05c1.jpg","nickname":"æ”¾ä¸‹","note":"","ucode":"1AD911B1E23BDB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":271330,"discussion_content":"è€å¸ˆè¿™ä¸ªåœ°æ–¹æ˜¯ä¸æ˜¯è¯´é”™äº†ï¼ŒacceptThreadCountæ‰æ˜¯Acceptorçš„çº¿ç¨‹æ•°é‡ï¼ŒaccpetCountæ˜¯èƒ½accepté˜Ÿåˆ—å¤§å°ï¼Œå°±æ˜¯èƒ½æ¥æ”¶å¤šå¤§çš„è¿æ¥è¯·æ±‚ï¼Œè¯·è€å¸ˆæŒ‡æ­£","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1590118334,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":103449,"user_name":"Demon.Lee","can_delete":false,"product_type":"c1","uid":1052859,"ip_address":"","ucode":"7F0E5493A8E345","user_header":"https://static001.geekbang.org/account/avatar/00/10/10/bb/f1061601.jpg","comment_is_top":false,"comment_ctime":1560437504,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1560437504","product_id":100028001,"comment_content":"æ™•äº†ï¼Œå¦‚æœèƒ½ç»“åˆç‚¹ç”Ÿæ´»ä¸­çš„ä¾‹å­å°±æ›´å¥½äº†ï¼Œæˆ‘å…ˆå»çœ‹çœ‹å…¶ä»–èµ„æ–™ï¼Œå†å›æ¥æé—®é¢˜ã€‚","like_count":0},{"had_liked":false,"id":103382,"user_name":"kim118000","can_delete":false,"product_type":"c1","uid":1487926,"ip_address":"","ucode":"6CE3E673C81EBE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/jDG4trQm3t6licZym9TayWRib15Z3auNv4ictblMvkHxzYqOwuD3HibGs8ktGBrPefDic5ZYH85lg9CroynSMlJxcpw/132","comment_is_top":false,"comment_ctime":1560425717,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560425717","product_id":100028001,"comment_content":"acceptorThreadCountï¼šè¯¥å‚æ•°ä»£è¡¨ Acceptor çš„çº¿ç¨‹æ•°é‡ï¼Œåœ¨è¯·æ±‚å®¢æˆ·ç«¯çš„æ•°æ®é‡éå¸¸å·¨å¤§çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€‚å½“åœ°è°ƒå¤§è¯¥çº¿ç¨‹æ•°é‡æ¥æé«˜å¤„ç†è¯·æ±‚è¿æ¥çš„èƒ½åŠ›ï¼Œé»˜è®¤å€¼ä¸º 1ã€‚<br><br>è€å¸ˆï¼Œæˆ‘ä»Šå¤©çœ‹äº†æºç æ³¨é‡Š<br>doesn&#39;t seem to work that well with mutiple acceptor threads<br><br>æˆ‘ä¹‹å‰çš„ç†è§£æ˜¯Javaè¿˜åšä¸åˆ°å¤šä¸ªæ¥å—è¿æ¥æ¥æé«˜è¯·æ±‚è¿æ¥çš„å¤„ç†èƒ½åŠ›ï¼Œç›®å‰æ™®éçš„åšæ³•æ˜¯é€šè¿‡forkå¤šä¸ªå­è¿›ç¨‹æ¥è¾¾åˆ°åŒæ—¶ç›‘å¬åŒä¸€ä¸ªsocket fdï¼Œä½†è¿™æ ·æœ‰æƒŠç¾¤ï¼Œæ‰€ä»¥åˆ©ç”¨mutexå¤šä¸ªç›‘å¬è€…åªæœ‰ä¸€ä¸ªèƒ½å¤„ç†æœ¬æ¬¡è¿æ¥æ“ä½œ<br><br>ç›®å‰è¿˜æ˜¯ä¸€ä¸»å¤šä»æ–¹æ¡ˆï¼Œä½†è¿™å·²ç»å¤Ÿç”¨ï¼Œå¯ä»¥é€šè¿‡å¤šå°æœºå™¨æé«˜å¹¶å‘ã€‚","like_count":0}]}