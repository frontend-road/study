{"id":610750,"title":"48｜再回首：“输入输出与文件操作”单元小结","content":"<p>你好，我是尹会生。</p><p>如果要用四个字来总结本章我为你讲解的主要内容的话，那肯定是“输入输出”。别看只有简单的四个字，里面包含的知识点可不少。</p><p>比如，在编写输入输出相关程序时，你要根据操作的对象，分为从终端输入输出和从文件输入输出；假如操作对象是文件的话，你还得考虑保存文件的文件夹是否存在；即使文件夹存在，你还要考虑是否有权限创建和写入文件；甚至在更底层的开发过程中，你要考虑写入文件时要使用缓存还是直接写入磁盘。</p><p>你看要编写一个支持输入和输出的程序，要考虑的东西真不少。在本章视频里，为了给你讲清楚每一个细节，我将它们都拆分开并为你讲解了涉及到的全部知识点，但是实际操作中，我们需要将它们都串联起来。在本讲中，我将为你展示一下，如何实现更完善的基于文件的输入和输出操作。</p><h2>输入</h2><p>首先，我先带你来看一下，一个程序如果使用文件作为输入系统要考虑的三件事：<strong>文件是否存在，文件是否有可读权限，使用正确的文件编码。</strong></p><p>1.文件是否存在</p><p>打开文件之前，判断文件是否存在，是成熟的软件工程师要养成的好习惯。虽然Python解释器在打开的文件不存在时，会自动报告FileNotFoundError异常，但是也会有报告不准确的时候，比如下面的代码，就是Python读取一个文件夹时的报错信息。</p>","comments":[{"had_liked":false,"id":367252,"user_name":"yanyu-xin","can_delete":false,"product_type":"c3","uid":1899757,"ip_address":"广东","ucode":"3AA389F9E4C236","user_header":"","comment_is_top":false,"comment_ctime":1675071200,"is_pvip":false,"replies":[{"id":133877,"content":"赞！","user_name":"作者回复","user_name_real":"编辑","uid":1056235,"ctime":1675400305,"ip_address":"广东","comment_id":367252,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"1.检查准备创建文件的目录是否存在：没有则建立有全部权限的临时文件夹\n2.检查目录是否需要管理员权限：提供管理员权限，否则另外创建有全部权限的临时文件夹\n3.检查目录的属性是否可读写操作：不能读写操作，就另外创建有全部权限的临时文件夹\n4.检查准备创建的文件是否存在：没有就生成临时文件\n5.创建的文件是否有读取权限：临时文件要有读写权限\n6.测试文件编码是否与操作系统一致：创建的临时文件编码与系统一致\n7.创建完临时文件\n8.使用临时文件后，删除临时文件\n9.删除临时创立的文件夹","like_count":4,"discussions":[{"author":{"id":1056235,"avatar":"https://static001.geekbang.org/account/avatar/00/10/1d/eb/b2123759.jpg","nickname":"尹会生","note":"","ucode":"D1093DBD093617","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":601747,"discussion_content":"赞！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1675400305,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":364261,"user_name":"Matthew","can_delete":false,"product_type":"c3","uid":2843865,"ip_address":"江苏","ucode":"96093089773740","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKSVuNarJuDhBSvHY0giaq6yriceEBKiaKuc04wCYWOuso50noqDexaPJJibJN7PHwvcQppnzsDia1icZkw/132","comment_is_top":false,"comment_ctime":1670739193,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"当你编写的程序创建一个临时文件时出现了权限不足的问题，你会采用什么样的措施，保证程序的健壮性，你又将如何提示用户为程序正常运行提供正确的修改建议？\n——在创建临时文件之前，要判断当前程序用户是否具有创建文件的权限，如果没有的话，则提示用户权限不足，需要先申请赋权。","like_count":1},{"had_liked":false,"id":389823,"user_name":"Dexter","can_delete":false,"product_type":"c3","uid":2608728,"ip_address":"芬兰","ucode":"909CABC4AC4AC9","user_header":"https://static001.geekbang.org/account/avatar/00/27/ce/58/71ed845f.jpg","comment_is_top":false,"comment_ctime":1713537010,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"os库创建文件夹有两个函数，分别为 mkdir() 和 makedirs() ，前者可以创建一级文件夹，后者可以创建多级文件夹","like_count":0},{"had_liked":false,"id":384576,"user_name":"760418","can_delete":false,"product_type":"c3","uid":3768167,"ip_address":"上海","ucode":"C160176FE97575","user_header":"","comment_is_top":false,"comment_ctime":1701177907,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"文件编码问题，长期困扰着 Python 开发的初学者，很多同学甚至为了研究透编码的定义和转换，下了一番苦功。其实编码问题对于日常开发来说，比你想的要简单，当你遇到编码和当前系统不一致的问题时，不需要通过各种复杂代码进行编码的转换，你只要“按照文件保存时指定的编码打开”即可。\n\n即你使用的是 Windows 默认采用“GBK”编码，如果你要打开 macOS 系统编写的“UTF-8”编码的文件，你只需要将 open() 函数的 encoding 参数指定为“encoding=UTF8”，文件就能按照正确的编码识别文件了。切记不要再进行复杂的编码转换了，不然容易导致更多字符集不兼容问题。","like_count":0},{"had_liked":false,"id":381528,"user_name":"小昭","can_delete":false,"product_type":"c3","uid":1326905,"ip_address":"上海","ucode":"149540DCFDF43E","user_header":"https://static001.geekbang.org/account/avatar/00/14/3f/39/a4c2154b.jpg","comment_is_top":false,"comment_ctime":1695346564,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"本章学完～\n\n最近工作事情繁琐，python学习又耽搁了不少，哎～～\n不过，过去的就让他过去，后面的时间我再努力💪","like_count":0},{"had_liked":false,"id":380483,"user_name":"好困啊","can_delete":false,"product_type":"c3","uid":2094450,"ip_address":"上海","ucode":"D49429660F2DC8","user_header":"https://static001.geekbang.org/account/avatar/00/1f/f5/72/8cbc5cb3.jpg","comment_is_top":false,"comment_ctime":1693665761,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"当程序在创建临时文件时遇到权限问题，我们可以采取以下措施来增强程序的健壮性和用户友好性：\n\n1. **异常捕获**：使用 `try...except` 结构来捕获可能出现的文件相关的异常，如 `PermissionError`。\n2. **日志记录**：在捕获到异常时，记录详细的错误日志，这样可以帮助开发人员诊断和修复问题。\n3. **用户友好的错误提示**：为用户提供明确的、友好的错误消息，并给出建议的解决方法。\n4. **提供备选方案**：例如，如果默认的临时文件目录不可写，程序可以尝试在其他位置创建临时文件，或者允许用户指定一个可写的目录。\n5. **文档说明**：在程序或应用的文档中，明确说明程序需要哪些权限，以及为什么需要这些权限。\n\n以下是一个示例，演示如何捕获权限错误并为用户提供友好的提示：\n\n```python\ntry:\n    # 尝试创建临时文件\n    with open(&quot;temp_file.txt&quot;, &quot;w&quot;) as f:\n        f.write(&quot;Temporary data.&quot;)\nexcept PermissionError:\n    print(&quot;错误：无法在当前目录创建临时文件，可能是因为权限不足。&quot;)\n    print(&quot;建议：请确保您具有在当前目录写入文件的权限，或尝试以管理员身份运行此程序。&quot;)\nexcept Exception as e:\n    print(f&quot;发生了一个未知错误：{e}&quot;)\n```","like_count":0},{"had_liked":false,"id":366775,"user_name":"Seven","can_delete":false,"product_type":"c3","uid":2403766,"ip_address":"四川","ucode":"37D99CF8535CDE","user_header":"https://static001.geekbang.org/account/avatar/00/24/ad/b6/a8caa2c7.jpg","comment_is_top":false,"comment_ctime":1674196962,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"1. 更改文件路径,选择当前用户有操作权限的路径. 提示用户更换可用的文件路径\n2. 向管理员申请操作权限","like_count":0},{"had_liked":false,"id":364260,"user_name":"Matthew","can_delete":false,"product_type":"c3","uid":2843865,"ip_address":"江苏","ucode":"96093089773740","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKSVuNarJuDhBSvHY0giaq6yriceEBKiaKuc04wCYWOuso50noqDexaPJJibJN7PHwvcQppnzsDia1icZkw/132","comment_is_top":false,"comment_ctime":1670739089,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"当你编写的程序创建一个临时文件时出现了权限不足的问题，你会采用什么样的措施，保证程序的健壮性，你又将如何提示用户为程序正常运行提供正确的修改建议？","like_count":0},{"had_liked":false,"id":364047,"user_name":"On","can_delete":false,"product_type":"c3","uid":1526359,"ip_address":"陕西","ucode":"E260187B398E15","user_header":"https://static001.geekbang.org/account/avatar/00/17/4a/57/3f68946c.jpg","comment_is_top":false,"comment_ctime":1670475410,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"契约式编程结构中的前置条件检测：\n输入：文件是否存在；文件是否有可读取可写权限；判断编码格式、使用正确的编码打开。\n输出：文件要保存的文件夹是否存在；如果文件夹不存在，如何创建文件夹。\n当你编写的程序创建一个临时文件时出现了权限不足的问题，你会采用什么样的措施，保证程序的健壮性，你又将如何提示用户为程序正常运行提供正确的修改建议？\n---请使用拥有足够权限的角色例如管理员权限（root&#47;administrator）保证有足够的权限进行读、、创建、更新文件等的操作。","like_count":0}]}