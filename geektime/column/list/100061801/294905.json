{"id":294905,"title":"01 | Mutexï¼šå¦‚ä½•è§£å†³èµ„æºå¹¶å‘è®¿é—®é—®é¢˜ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯é¸Ÿçªã€‚</p><p>ä»Šå¤©æ˜¯æˆ‘ä»¬Goå¹¶å‘ç¼–ç¨‹å®æˆ˜è¯¾çš„ç¬¬ä¸€è®²ï¼Œæˆ‘ä»¬å°±ç›´æ¥ä»è§£å†³å¹¶å‘è®¿é—®è¿™ä¸ªæ£˜æ‰‹é—®é¢˜å…¥æ‰‹ã€‚</p><p>è¯´èµ·å¹¶å‘è®¿é—®é—®é¢˜ï¼ŒçœŸæ˜¯å¤ªå¸¸è§äº†ï¼Œæ¯”å¦‚å¤šä¸ªgoroutineå¹¶å‘æ›´æ–°åŒä¸€ä¸ªèµ„æºï¼Œåƒè®¡æ•°å™¨ï¼›åŒæ—¶æ›´æ–°ç”¨æˆ·çš„è´¦æˆ·ä¿¡æ¯ï¼›ç§’æ€ç³»ç»Ÿï¼›å¾€åŒä¸€ä¸ªbufferä¸­å¹¶å‘å†™å…¥æ•°æ®ç­‰ç­‰ã€‚å¦‚æœæ²¡æœ‰äº’æ–¥æ§åˆ¶ï¼Œå°±ä¼šå‡ºç°ä¸€äº›å¼‚å¸¸æƒ…å†µï¼Œæ¯”å¦‚è®¡æ•°å™¨çš„è®¡æ•°ä¸å‡†ç¡®ã€ç”¨æˆ·çš„è´¦æˆ·å¯èƒ½å‡ºç°é€æ”¯ã€ç§’æ€ç³»ç»Ÿå‡ºç°è¶…å–ã€bufferä¸­çš„æ•°æ®æ··ä¹±ï¼Œç­‰ç­‰ï¼Œåæœéƒ½å¾ˆä¸¥é‡ã€‚</p><p>è¿™äº›é—®é¢˜æ€ä¹ˆè§£å†³å‘¢ï¼Ÿå¯¹ï¼Œç”¨äº’æ–¥é”ï¼Œé‚£åœ¨Goè¯­è¨€é‡Œï¼Œå°±æ˜¯<strong>Mutexã€‚</strong></p><p>è¿™èŠ‚è¯¾ï¼Œæˆ‘ä¼šå¸¦ä½ è¯¦ç»†äº†è§£äº’æ–¥é”çš„å®ç°æœºåˆ¶ï¼Œä»¥åŠGoæ ‡å‡†åº“çš„äº’æ–¥é”Mutexçš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ã€‚åœ¨åé¢çš„3èŠ‚è¯¾é‡Œï¼Œæˆ‘è¿˜ä¼šè®²è§£Mutexçš„å…·ä½“å®ç°åŸç†ã€æ˜“é”™åœºæ™¯å’Œä¸€äº›æ‹“å±•ç”¨æ³•ã€‚</p><p>å¥½äº†ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹äº’æ–¥é”çš„å®ç°æœºåˆ¶ã€‚</p><h2>äº’æ–¥é”çš„å®ç°æœºåˆ¶</h2><p>äº’æ–¥é”æ˜¯å¹¶å‘æ§åˆ¶çš„ä¸€ä¸ªåŸºæœ¬æ‰‹æ®µï¼Œæ˜¯ä¸ºäº†é¿å…ç«äº‰è€Œå»ºç«‹çš„ä¸€ç§å¹¶å‘æ§åˆ¶æœºåˆ¶ã€‚åœ¨å­¦ä¹ å®ƒçš„å…·ä½“å®ç°åŸç†å‰ï¼Œæˆ‘ä»¬è¦å…ˆææ‡‚ä¸€ä¸ªæ¦‚å¿µï¼Œå°±æ˜¯<strong>ä¸´ç•ŒåŒº</strong>ã€‚</p><p>åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œå¦‚æœç¨‹åºä¸­çš„ä¸€éƒ¨åˆ†ä¼šè¢«å¹¶å‘è®¿é—®æˆ–ä¿®æ”¹ï¼Œé‚£ä¹ˆï¼Œä¸ºäº†é¿å…å¹¶å‘è®¿é—®å¯¼è‡´çš„æ„æƒ³ä¸åˆ°çš„ç»“æœï¼Œè¿™éƒ¨åˆ†ç¨‹åºéœ€è¦è¢«ä¿æŠ¤èµ·æ¥ï¼Œè¿™éƒ¨åˆ†è¢«ä¿æŠ¤èµ·æ¥çš„ç¨‹åºï¼Œå°±å«åšä¸´ç•ŒåŒºã€‚</p><p>å¯ä»¥è¯´ï¼Œä¸´ç•ŒåŒºå°±æ˜¯ä¸€ä¸ªè¢«å…±äº«çš„èµ„æºï¼Œæˆ–è€…è¯´æ˜¯ä¸€ä¸ªæ•´ä½“çš„ä¸€ç»„å…±äº«èµ„æºï¼Œæ¯”å¦‚å¯¹æ•°æ®åº“çš„è®¿é—®ã€å¯¹æŸä¸€ä¸ªå…±äº«æ•°æ®ç»“æ„çš„æ“ä½œã€å¯¹ä¸€ä¸ª I/O è®¾å¤‡çš„ä½¿ç”¨ã€å¯¹ä¸€ä¸ªè¿æ¥æ± ä¸­çš„è¿æ¥çš„è°ƒç”¨ï¼Œç­‰ç­‰ã€‚</p><!-- [[[read_end]]] --><p>å¦‚æœå¾ˆå¤šçº¿ç¨‹åŒæ­¥è®¿é—®ä¸´ç•ŒåŒºï¼Œå°±ä¼šé€ æˆè®¿é—®æˆ–æ“ä½œé”™è¯¯ï¼Œè¿™å½“ç„¶ä¸æ˜¯æˆ‘ä»¬å¸Œæœ›çœ‹åˆ°çš„ç»“æœã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥<strong>ä½¿ç”¨äº’æ–¥é”ï¼Œé™å®šä¸´ç•ŒåŒºåªèƒ½åŒæ—¶ç”±ä¸€ä¸ªçº¿ç¨‹æŒæœ‰</strong>ã€‚</p><p>å½“ä¸´ç•ŒåŒºç”±ä¸€ä¸ªçº¿ç¨‹æŒæœ‰çš„æ—¶å€™ï¼Œå…¶å®ƒçº¿ç¨‹å¦‚æœæƒ³è¿›å…¥è¿™ä¸ªä¸´ç•ŒåŒºï¼Œå°±ä¼šè¿”å›å¤±è´¥ï¼Œæˆ–è€…æ˜¯ç­‰å¾…ã€‚ç›´åˆ°æŒæœ‰çš„çº¿ç¨‹é€€å‡ºä¸´ç•ŒåŒºï¼Œè¿™äº›ç­‰å¾…çº¿ç¨‹ä¸­çš„æŸä¸€ä¸ªæ‰æœ‰æœºä¼šæ¥ç€æŒæœ‰è¿™ä¸ªä¸´ç•ŒåŒºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/44/b8/44c08abdd0aff633ca932fc89386ebb8.jpg?wh=3747*1972\" alt=\"\"></p><p>ä½ çœ‹ï¼Œäº’æ–¥é”å°±å¾ˆå¥½åœ°è§£å†³äº†èµ„æºç«äº‰é—®é¢˜ï¼Œæœ‰äººä¹ŸæŠŠäº’æ–¥é”å«åšæ’å®ƒé”ã€‚é‚£åœ¨Go æ ‡å‡†åº“ä¸­ï¼Œå®ƒæä¾›äº† Mutex æ¥å®ç°äº’æ–¥é”è¿™ä¸ªåŠŸèƒ½ã€‚</p><p>æ ¹æ®2019å¹´ç¬¬ä¸€ç¯‡å…¨é¢åˆ†æGoå¹¶å‘Bugçš„è®ºæ–‡<a href=\"https://songlh.github.io/paper/go-study.pdf\">Understanding Real-World Concurrency Bugs in Go</a>ï¼Œ<strong>Mutexæ˜¯ä½¿ç”¨æœ€å¹¿æ³›çš„åŒæ­¥åŸè¯­</strong>ï¼ˆSynchronization primitivesï¼Œæœ‰äººä¹Ÿå«åš<strong>å¹¶å‘åŸè¯­</strong>ã€‚æˆ‘ä»¬åœ¨è¿™ä¸ªè¯¾ç¨‹ä¸­æ ¹æ®è‹±æ–‡ç›´è¯‘ä¼˜å…ˆç”¨åŒæ­¥åŸè¯­ï¼Œä½†æ˜¯å¹¶å‘åŸè¯­çš„æŒ‡ä»£èŒƒå›´æ›´å¤§ï¼Œè¿˜å¯ä»¥åŒ…æ‹¬ä»»åŠ¡ç¼–æ’çš„ç±»å‹ï¼Œæ‰€ä»¥åé¢æˆ‘ä»¬è®²Channelæˆ–è€…æ‰©å±•ç±»å‹æ—¶ä¹Ÿä¼šç”¨å¹¶å‘åŸè¯­ï¼‰ã€‚å…³äºåŒæ­¥åŸè¯­ï¼Œå¹¶æ²¡æœ‰ä¸€ä¸ªä¸¥æ ¼çš„å®šä¹‰ï¼Œä½ å¯ä»¥æŠŠå®ƒçœ‹ä½œè§£å†³å¹¶å‘é—®é¢˜çš„ä¸€ä¸ªåŸºç¡€çš„æ•°æ®ç»“æ„ã€‚</p><p>åœ¨è¿™é—¨è¯¾çš„å‰ä¸¤ä¸ªæ¨¡å—ï¼Œæˆ‘ä¼šå’Œä½ è®²äº’æ–¥é”Mutexã€è¯»å†™é”RWMutexã€å¹¶å‘ç¼–æ’WaitGroupã€æ¡ä»¶å˜é‡Condã€Channelç­‰åŒæ­¥åŸè¯­ã€‚æ‰€ä»¥ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘å…ˆå’Œä½ è¯´ä¸€ä¸‹åŒæ­¥åŸè¯­çš„é€‚ç”¨åœºæ™¯ã€‚</p><ul>\n<li>å…±äº«èµ„æºã€‚å¹¶å‘åœ°è¯»å†™å…±äº«èµ„æºï¼Œä¼šå‡ºç°æ•°æ®ç«äº‰ï¼ˆdata raceï¼‰çš„é—®é¢˜ï¼Œæ‰€ä»¥éœ€è¦Mutexã€RWMutexè¿™æ ·çš„å¹¶å‘åŸè¯­æ¥ä¿æŠ¤ã€‚</li>\n<li>ä»»åŠ¡ç¼–æ’ã€‚éœ€è¦goroutineæŒ‰ç…§ä¸€å®šçš„è§„å¾‹æ‰§è¡Œï¼Œè€Œgoroutineä¹‹é—´æœ‰ç›¸äº’ç­‰å¾…æˆ–è€…ä¾èµ–çš„é¡ºåºå…³ç³»ï¼Œæˆ‘ä»¬å¸¸å¸¸ä½¿ç”¨WaitGroupæˆ–è€…Channelæ¥å®ç°ã€‚</li>\n<li>æ¶ˆæ¯ä¼ é€’ã€‚ä¿¡æ¯äº¤æµä»¥åŠä¸åŒçš„goroutineä¹‹é—´çš„çº¿ç¨‹å®‰å…¨çš„æ•°æ®äº¤æµï¼Œå¸¸å¸¸ä½¿ç”¨Channelæ¥å®ç°ã€‚</li>\n</ul><p>ä»Šå¤©è¿™ä¸€è®²ï¼Œå’±ä»¬å°±ä»å…¬è®¤çš„ä½¿ç”¨æœ€å¹¿æ³›çš„Mutexå¼€å§‹å­¦ä¹ å§ã€‚æ˜¯éª¡å­æ˜¯é©¬å’±å¾—æ‹‰å‡ºæ¥é›é›ï¼Œçœ‹çœ‹æˆ‘ä»¬åˆ°åº•å¯ä»¥æ€ä¹ˆä½¿ç”¨Mutexã€‚</p><h2>Mutexçš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•</h2><p>åœ¨æ­£å¼çœ‹Mutexç”¨æ³•ä¹‹å‰å‘¢ï¼Œæˆ‘æƒ³å…ˆç»™ä½ äº¤ä»£ä¸€ä»¶äº‹ï¼šLockeræ¥å£ã€‚</p><p>åœ¨Goçš„æ ‡å‡†åº“ä¸­ï¼Œpackage syncæä¾›äº†é”ç›¸å…³çš„ä¸€ç³»åˆ—åŒæ­¥åŸè¯­ï¼Œè¿™ä¸ªpackageè¿˜å®šä¹‰äº†ä¸€ä¸ªLockerçš„æ¥å£ï¼ŒMutexå°±å®ç°äº†è¿™ä¸ªæ¥å£ã€‚</p><p>Lockerçš„æ¥å£å®šä¹‰äº†é”åŒæ­¥åŸè¯­çš„æ–¹æ³•é›†ï¼š</p><pre><code>\ntype Locker interface {\n    Lock()\n    Unlock()\n}\n\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼ŒGoå®šä¹‰çš„é”æ¥å£çš„æ–¹æ³•é›†å¾ˆç®€å•ï¼Œå°±æ˜¯è¯·æ±‚é”ï¼ˆLockï¼‰å’Œé‡Šæ”¾é”ï¼ˆUnlockï¼‰è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œç§‰æ‰¿äº†Goè¯­è¨€ä¸€è´¯çš„ç®€æ´é£æ ¼ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™ä¸ªæ¥å£åœ¨å®é™…é¡¹ç›®åº”ç”¨å¾—ä¸å¤šï¼Œå› ä¸ºæˆ‘ä»¬ä¸€èˆ¬ä¼šç›´æ¥ä½¿ç”¨å…·ä½“çš„åŒæ­¥åŸè¯­ï¼Œè€Œä¸æ˜¯é€šè¿‡æ¥å£ã€‚</p><p>æˆ‘ä»¬è¿™ä¸€è®²ä»‹ç»çš„Mutexä»¥åŠåé¢ä¼šä»‹ç»çš„è¯»å†™é”RWMutexéƒ½å®ç°äº†Lockeræ¥å£ï¼Œæ‰€ä»¥é¦–å…ˆæˆ‘æŠŠè¿™ä¸ªæ¥å£ä»‹ç»äº†ï¼Œè®©ä½ åšåˆ°å¿ƒä¸­æœ‰æ•°ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬ç›´æ¥çœ‹Mutexã€‚</p><p>ç®€å•æ¥è¯´ï¼Œ<strong>äº’æ–¥é”Mutexå°±æä¾›ä¸¤ä¸ªæ–¹æ³•Lockå’ŒUnlockï¼šè¿›å…¥ä¸´ç•ŒåŒºä¹‹å‰è°ƒç”¨Lockæ–¹æ³•ï¼Œé€€å‡ºä¸´ç•ŒåŒºçš„æ—¶å€™è°ƒç”¨Unlockæ–¹æ³•</strong>ï¼š</p><pre><code>  func(m *Mutex)Lock()\n  func(m *Mutex)Unlock()\n</code></pre><p><strong>å½“ä¸€ä¸ªgoroutineé€šè¿‡è°ƒç”¨Lockæ–¹æ³•è·å¾—äº†è¿™ä¸ªé”çš„æ‹¥æœ‰æƒåï¼Œ å…¶å®ƒè¯·æ±‚é”çš„goroutineå°±ä¼šé˜»å¡åœ¨Lockæ–¹æ³•çš„è°ƒç”¨ä¸Šï¼Œç›´åˆ°é”è¢«é‡Šæ”¾å¹¶ä¸”è‡ªå·±è·å–åˆ°äº†è¿™ä¸ªé”çš„æ‹¥æœ‰æƒã€‚</strong></p><p>çœ‹åˆ°è¿™å„¿ï¼Œä½ å¯èƒ½ä¼šé—®ï¼Œä¸ºå•¥ä¸€å®šè¦åŠ é”å‘¢ï¼Ÿåˆ«æ€¥ï¼Œæˆ‘å¸¦ä½ æ¥çœ‹ä¸€ä¸ªå¹¶å‘è®¿é—®åœºæ™¯ä¸­ä¸ä½¿ç”¨é”çš„ä¾‹å­ï¼Œçœ‹çœ‹å®ç°èµ·æ¥ä¼šå‡ºç°ä»€ä¹ˆçŠ¶å†µã€‚</p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†10ä¸ªgoroutineï¼ŒåŒæ—¶ä¸æ–­åœ°å¯¹ä¸€ä¸ªå˜é‡ï¼ˆcountï¼‰è¿›è¡ŒåŠ 1æ“ä½œï¼Œæ¯ä¸ªgoroutineè´Ÿè´£æ‰§è¡Œ10ä¸‡æ¬¡çš„åŠ 1æ“ä½œï¼Œæˆ‘ä»¬æœŸæœ›çš„æœ€åè®¡æ•°çš„ç»“æœæ˜¯10 * 100000 = 1000000 (ä¸€ç™¾ä¸‡)ã€‚</p><pre><code> import (\n        &quot;fmt&quot;\n        &quot;sync&quot;\n    )\n    \n    func main() {\n        var count = 0\n        // ä½¿ç”¨WaitGroupç­‰å¾…10ä¸ªgoroutineå®Œæˆ\n        var wg sync.WaitGroup\n        wg.Add(10)\n        for i := 0; i &lt; 10; i++ {\n            go func() {\n                defer wg.Done()\n                // å¯¹å˜é‡countæ‰§è¡Œ10æ¬¡åŠ 1\n                for j := 0; j &lt; 100000; j++ {\n                    count++\n                }\n            }()\n        }\n        // ç­‰å¾…10ä¸ªgoroutineå®Œæˆ\n        wg.Wait()\n        fmt.Println(count)\n    }\n\n</code></pre><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨sync.WaitGroupæ¥ç­‰å¾…æ‰€æœ‰çš„goroutineæ‰§è¡Œå®Œæ¯•åï¼Œå†è¾“å‡ºæœ€ç»ˆçš„ç»“æœã€‚sync.WaitGroupè¿™ä¸ªåŒæ­¥åŸè¯­æˆ‘ä¼šåœ¨åé¢çš„è¯¾ç¨‹ä¸­å…·ä½“ä»‹ç»ï¼Œç°åœ¨ä½ åªéœ€è¦çŸ¥é“ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒæ¥æ§åˆ¶ç­‰å¾…ä¸€ç»„goroutineå…¨éƒ¨åšå®Œä»»åŠ¡ã€‚</p><p>ä½†æ˜¯ï¼Œæ¯æ¬¡è¿è¡Œï¼Œä½ éƒ½å¯èƒ½å¾—åˆ°ä¸åŒçš„ç»“æœï¼ŒåŸºæœ¬ä¸Šä¸ä¼šå¾—åˆ°ç†æƒ³ä¸­çš„ä¸€ç™¾ä¸‡çš„ç»“æœã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/60/e2/6080fdf493e047917aa099ea33279de2.png?wh=427*137\" alt=\"\"></p><p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å…¶å®ï¼Œè¿™æ˜¯å› ä¸ºï¼Œ<strong>count++</strong> ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œå®ƒè‡³å°‘åŒ…å«å‡ ä¸ªæ­¥éª¤ï¼Œæ¯”å¦‚è¯»å–å˜é‡countçš„å½“å‰å€¼ï¼Œå¯¹è¿™ä¸ªå€¼åŠ 1ï¼ŒæŠŠç»“æœå†ä¿å­˜åˆ°countä¸­ã€‚å› ä¸ºä¸æ˜¯åŸå­æ“ä½œï¼Œå°±å¯èƒ½æœ‰å¹¶å‘çš„é—®é¢˜ã€‚</p><p>æ¯”å¦‚ï¼Œ10ä¸ªgoroutineåŒæ—¶è¯»å–åˆ°countçš„å€¼ä¸º9527ï¼Œæ¥ç€å„è‡ªæŒ‰ç…§è‡ªå·±çš„é€»è¾‘åŠ 1ï¼Œå€¼å˜æˆäº†9528ï¼Œç„¶åæŠŠè¿™ä¸ªç»“æœå†å†™å›åˆ°countå˜é‡ã€‚ä½†æ˜¯ï¼Œå®é™…ä¸Šï¼Œæ­¤æ—¶æˆ‘ä»¬å¢åŠ çš„æ€»æ•°åº”è¯¥æ˜¯10æ‰å¯¹ï¼Œè¿™é‡Œå´åªå¢åŠ äº†1ï¼Œå¥½å¤šè®¡æ•°éƒ½è¢«â€œåâ€æ‰äº†ã€‚è¿™æ˜¯å¹¶å‘è®¿é—®å…±äº«æ•°æ®çš„å¸¸è§é”™è¯¯ã€‚</p><pre><code> // count++æ“ä½œçš„æ±‡ç¼–ä»£ç \n    MOVQ    &quot;&quot;.count(SB), AX\n    LEAQ    1(AX), CX\n    MOVQ    CX, &quot;&quot;.count(SB)\n</code></pre><p>è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ç»éªŒçš„å¼€å‘äººå‘˜è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“å‘ç°çš„ï¼Œä½†æ˜¯ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œå¹¶å‘é—®é¢˜éšè—å¾—éå¸¸æ·±ï¼Œå³ä½¿æ˜¯æœ‰ç»éªŒçš„äººï¼Œä¹Ÿä¸å¤ªå®¹æ˜“å‘ç°æˆ–è€…Debugå‡ºæ¥ã€‚</p><p>é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼ŒGoæä¾›äº†ä¸€ä¸ªæ£€æµ‹å¹¶å‘è®¿é—®å…±äº«èµ„æºæ˜¯å¦æœ‰é—®é¢˜çš„å·¥å…·ï¼š <a href=\"https://blog.golang.org/race-detector\">race detector</a>ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨å‘ç°ç¨‹åºæœ‰æ²¡æœ‰data raceçš„é—®é¢˜ã€‚</p><p><strong>Go race detector</strong>æ˜¯åŸºäºGoogleçš„ C/C++ <a href=\"https://github.com/google/sanitizers\">sanitizers</a> æŠ€æœ¯å®ç°çš„ï¼Œç¼–è¯‘å™¨é€šè¿‡æ¢æµ‹æ‰€æœ‰çš„å†…å­˜è®¿é—®ï¼ŒåŠ å…¥ä»£ç èƒ½ç›‘è§†å¯¹è¿™äº›å†…å­˜åœ°å€çš„è®¿é—®ï¼ˆè¯»è¿˜æ˜¯å†™ï¼‰ã€‚åœ¨ä»£ç è¿è¡Œçš„æ—¶å€™ï¼Œrace detectorå°±èƒ½ç›‘æ§åˆ°å¯¹å…±äº«å˜é‡çš„éåŒæ­¥è®¿é—®ï¼Œå‡ºç°raceçš„æ—¶å€™ï¼Œå°±ä¼šæ‰“å°å‡ºè­¦å‘Šä¿¡æ¯ã€‚</p><p>è¿™ä¸ªæŠ€æœ¯åœ¨Googleå†…éƒ¨å¸®äº†å¤§å¿™ï¼Œæ¢æµ‹å‡ºäº†Chromiumç­‰ä»£ç çš„å¤§é‡å¹¶å‘é—®é¢˜ã€‚Go 1.1ä¸­å°±å¼•å…¥äº†è¿™ç§æŠ€æœ¯ï¼Œå¹¶ä¸”ä¸€ä¸‹å­å°±å‘ç°äº†æ ‡å‡†åº“ä¸­çš„42ä¸ªå¹¶å‘é—®é¢˜ã€‚ç°åœ¨ï¼Œrace detectorå·²ç»æˆäº†GoæŒç»­é›†æˆè¿‡ç¨‹ä¸­çš„ä¸€éƒ¨åˆ†ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªå·¥å…·æ€ä¹ˆç”¨ã€‚</p><p>åœ¨ç¼–è¯‘ï¼ˆcompileï¼‰ã€æµ‹è¯•ï¼ˆtestï¼‰æˆ–è€…è¿è¡Œï¼ˆrunï¼‰Goä»£ç çš„æ—¶å€™ï¼ŒåŠ ä¸Š<strong>race</strong>å‚æ•°ï¼Œå°±æœ‰å¯èƒ½å‘ç°å¹¶å‘é—®é¢˜ã€‚æ¯”å¦‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åŠ ä¸Šraceå‚æ•°è¿è¡Œï¼Œæ£€æµ‹ä¸€ä¸‹æ˜¯ä¸æ˜¯æœ‰å¹¶å‘é—®é¢˜ã€‚å¦‚æœä½ go run -race counter.goï¼Œå°±ä¼šè¾“å‡ºè­¦å‘Šä¿¡æ¯ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f5/ff/f5eec2d6458e4bddc882ebb213f05aff.png?wh=792*359\" alt=\"\"></p><p>è¿™ä¸ªè­¦å‘Šä¸ä½†ä¼šå‘Šè¯‰ä½ æœ‰å¹¶å‘é—®é¢˜ï¼Œè€Œä¸”è¿˜ä¼šå‘Šè¯‰ä½ å“ªä¸ªgoroutineåœ¨å“ªä¸€è¡Œå¯¹å“ªä¸ªå˜é‡æœ‰å†™æ“ä½œï¼ŒåŒæ—¶ï¼Œå“ªä¸ªgoroutineåœ¨å“ªä¸€è¡Œå¯¹å“ªä¸ªå˜é‡æœ‰è¯»æ“ä½œï¼Œå°±æ˜¯è¿™äº›å¹¶å‘çš„è¯»å†™è®¿é—®ï¼Œå¼•èµ·äº†data raceã€‚</p><p>ä¾‹å­ä¸­çš„goroutine 10å¯¹å†…å­˜åœ°å€0x00c000126010æœ‰è¯»çš„æ“ä½œï¼ˆcounter.goæ–‡ä»¶ç¬¬16è¡Œï¼‰ï¼ŒåŒæ—¶ï¼Œgoroutine 7å¯¹å†…å­˜åœ°å€0x00c000126010æœ‰å†™çš„æ“ä½œï¼ˆcounter.goæ–‡ä»¶ç¬¬16è¡Œï¼‰ã€‚è€Œä¸”è¿˜å¯èƒ½æœ‰å¤šä¸ªgoroutineåœ¨åŒæ—¶è¿›è¡Œè¯»å†™ï¼Œæ‰€ä»¥ï¼Œè­¦å‘Šä¿¡æ¯å¯èƒ½ä¼šå¾ˆé•¿ã€‚</p><p>è™½ç„¶è¿™ä¸ªå·¥å…·ä½¿ç”¨èµ·æ¥å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯ï¼Œå› ä¸ºå®ƒçš„å®ç°æ–¹å¼ï¼Œåªèƒ½é€šè¿‡çœŸæ­£å¯¹å®é™…åœ°å€è¿›è¡Œè¯»å†™è®¿é—®çš„æ—¶å€™æ‰èƒ½æ¢æµ‹ï¼Œæ‰€ä»¥å®ƒå¹¶ä¸èƒ½åœ¨ç¼–è¯‘çš„æ—¶å€™å‘ç°data raceçš„é—®é¢˜ã€‚è€Œä¸”ï¼Œåœ¨è¿è¡Œçš„æ—¶å€™ï¼Œåªæœ‰åœ¨è§¦å‘äº†data raceä¹‹åï¼Œæ‰èƒ½æ£€æµ‹åˆ°ï¼Œå¦‚æœç¢°å·§æ²¡æœ‰è§¦å‘ï¼ˆæ¯”å¦‚ä¸€ä¸ªdata raceé—®é¢˜åªèƒ½åœ¨2æœˆ14å·é›¶ç‚¹æˆ–è€…11æœˆ11å·é›¶ç‚¹æ‰å‡ºç°ï¼‰ï¼Œæ˜¯æ£€æµ‹ä¸å‡ºæ¥çš„ã€‚</p><p>è€Œä¸”ï¼ŒæŠŠå¼€å¯äº†raceçš„ç¨‹åºéƒ¨ç½²åœ¨çº¿ä¸Šï¼Œè¿˜æ˜¯æ¯”è¾ƒå½±å“æ€§èƒ½çš„ã€‚è¿è¡Œ go tool compile -race -S counter.goï¼Œå¯ä»¥æŸ¥çœ‹è®¡æ•°å™¨ä¾‹å­çš„ä»£ç ï¼Œé‡ç‚¹å…³æ³¨ä¸€ä¸‹count++å‰åçš„ç¼–è¯‘åçš„ä»£ç ï¼š</p><pre><code>0x002a 00042 (counter.go:13)    CALL    runtime.racefuncenter(SB)\n       ......\n        0x0061 00097 (counter.go:14)    JMP     173\n        0x0063 00099 (counter.go:15)    MOVQ    AX, &quot;&quot;.j+8(SP)\n        0x0068 00104 (counter.go:16)    PCDATA  $0, $1\n        0x0068 00104 (counter.go:16)    MOVQ    &quot;&quot;.&amp;count+128(SP), AX\n        0x0070 00112 (counter.go:16)    PCDATA  $0, $0\n        0x0070 00112 (counter.go:16)    MOVQ    AX, (SP)\n        0x0074 00116 (counter.go:16)    CALL    runtime.raceread(SB)\n        0x0079 00121 (counter.go:16)    PCDATA  $0, $1\n        0x0079 00121 (counter.go:16)    MOVQ    &quot;&quot;.&amp;count+128(SP), AX\n        0x0081 00129 (counter.go:16)    MOVQ    (AX), CX\n        0x0084 00132 (counter.go:16)    MOVQ    CX, &quot;&quot;..autotmp_8+16(SP)\n        0x0089 00137 (counter.go:16)    PCDATA  $0, $0\n        0x0089 00137 (counter.go:16)    MOVQ    AX, (SP)\n        0x008d 00141 (counter.go:16)    CALL    runtime.racewrite(SB)\n        0x0092 00146 (counter.go:16)    MOVQ    &quot;&quot;..autotmp_8+16(SP), AX\n       ......\n        0x00b6 00182 (counter.go:18)    CALL    runtime.deferreturn(SB)\n        0x00bb 00187 (counter.go:18)    CALL    runtime.racefuncexit(SB)\n        0x00c0 00192 (counter.go:18)    MOVQ    104(SP), BP\n        0x00c5 00197 (counter.go:18)    ADDQ    $112, SP\n</code></pre><p>åœ¨ç¼–è¯‘çš„ä»£ç ä¸­ï¼Œå¢åŠ äº†runtime.racefuncenterã€runtime.racereadã€runtime.racewriteã€runtime.racefuncexitç­‰æ£€æµ‹data raceçš„æ–¹æ³•ã€‚é€šè¿‡è¿™äº›æ’å…¥çš„æŒ‡ä»¤ï¼ŒGo race detectorå·¥å…·å°±èƒ½å¤ŸæˆåŠŸåœ°æ£€æµ‹å‡ºdata raceé—®é¢˜äº†ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œé€šè¿‡åœ¨ç¼–è¯‘çš„æ—¶å€™æ’å…¥ä¸€äº›æŒ‡ä»¤ï¼Œåœ¨è¿è¡Œæ—¶é€šè¿‡è¿™äº›æ’å…¥çš„æŒ‡ä»¤æ£€æµ‹å¹¶å‘è¯»å†™ä»è€Œå‘ç°data raceé—®é¢˜ï¼Œå°±æ˜¯è¿™ä¸ªå·¥å…·çš„å®ç°æœºåˆ¶ã€‚</p><p>æ—¢ç„¶è¿™ä¸ªä¾‹å­å­˜åœ¨data raceé—®é¢˜ï¼Œæˆ‘ä»¬å°±è¦æƒ³åŠæ³•æ¥è§£å†³å®ƒã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬è¿™èŠ‚è¯¾çš„ä¸»è§’Mutexå°±è¦ç™»åœºäº†ï¼Œå®ƒå¯ä»¥è½»æ¾åœ°æ¶ˆé™¤æ‰data raceã€‚</p><p>å…·ä½“æ€ä¹ˆåšå‘¢ï¼Ÿä¸‹é¢ï¼Œæˆ‘å°±ç»“åˆè¿™ä¸ªä¾‹å­ï¼Œæ¥å…·ä½“ç»™ä½ è®²ä¸€è®²Mutexçš„åŸºæœ¬ç”¨æ³•ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œè¿™é‡Œçš„å…±äº«èµ„æºæ˜¯countå˜é‡ï¼Œä¸´ç•ŒåŒºæ˜¯count++ï¼Œåªè¦åœ¨ä¸´ç•ŒåŒºå‰é¢è·å–é”ï¼Œåœ¨ç¦»å¼€ä¸´ç•ŒåŒºçš„æ—¶å€™é‡Šæ”¾é”ï¼Œå°±èƒ½å®Œç¾åœ°è§£å†³data raceçš„é—®é¢˜äº†ã€‚</p><pre><code>package main\n\n\n    import (\n        &quot;fmt&quot;\n        &quot;sync&quot;\n    )\n\n\n    func main() {\n        // äº’æ–¥é”ä¿æŠ¤è®¡æ•°å™¨\n        var mu sync.Mutex\n        // è®¡æ•°å™¨çš„å€¼\n        var count = 0\n        \n        // è¾…åŠ©å˜é‡ï¼Œç”¨æ¥ç¡®è®¤æ‰€æœ‰çš„goroutineéƒ½å®Œæˆ\n        var wg sync.WaitGroup\n        wg.Add(10)\n\n        // å¯åŠ¨10ä¸ªgourontine\n        for i := 0; i &lt; 10; i++ {\n            go func() {\n                defer wg.Done()\n                // ç´¯åŠ 10ä¸‡æ¬¡\n                for j := 0; j &lt; 100000; j++ {\n                    mu.Lock()\n                    count++\n                    mu.Unlock()\n                }\n            }()\n        }\n        wg.Wait()\n        fmt.Println(count)\n    }\n</code></pre><p>å¦‚æœä½ å†è¿è¡Œä¸€ä¸‹ç¨‹åºï¼Œå°±ä¼šå‘ç°ï¼Œdata raceè­¦å‘Šæ²¡æœ‰äº†ï¼Œç³»ç»Ÿå¹²è„†åœ°è¾“å‡ºäº†1000000ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/d3/8e/d3c577aec0322488e349acf17789a08e.png?wh=457*73\" alt=\"\"></p><p>æ€ä¹ˆæ ·ï¼Œä½¿ç”¨Mutexæ˜¯ä¸æ˜¯éå¸¸é«˜æ•ˆï¼Ÿæ•ˆæœå¾ˆæƒŠå–œã€‚</p><p>è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼šMutexçš„é›¶å€¼æ˜¯è¿˜æ²¡æœ‰goroutineç­‰å¾…çš„æœªåŠ é”çš„çŠ¶æ€ï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦é¢å¤–çš„åˆå§‹åŒ–ï¼Œç›´æ¥å£°æ˜å˜é‡ï¼ˆå¦‚ var mu sync.Mutexï¼‰å³å¯ã€‚</p><p>é‚£Mutexè¿˜æœ‰å“ªäº›ç”¨æ³•å‘¢ï¼Ÿ</p><p>å¾ˆå¤šæƒ…å†µä¸‹ï¼Œ<strong>Mutexä¼šåµŒå…¥åˆ°å…¶å®ƒstructä¸­ä½¿ç”¨</strong>ï¼Œæ¯”å¦‚ä¸‹é¢çš„æ–¹å¼ï¼š</p><pre><code>type Counter struct {\n    mu    sync.Mutex\n    Count uint64\n}\n</code></pre><p>åœ¨åˆå§‹åŒ–åµŒå…¥çš„structæ—¶ï¼Œä¹Ÿä¸å¿…åˆå§‹åŒ–è¿™ä¸ªMutexå­—æ®µï¼Œä¸ä¼šå› ä¸ºæ²¡æœ‰åˆå§‹åŒ–å‡ºç°ç©ºæŒ‡é’ˆæˆ–è€…æ˜¯æ— æ³•è·å–åˆ°é”çš„æƒ…å†µã€‚</p><p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥<strong>é‡‡ç”¨åµŒå…¥å­—æ®µçš„æ–¹å¼</strong>ã€‚é€šè¿‡åµŒå…¥å­—æ®µï¼Œä½ å¯ä»¥åœ¨è¿™ä¸ªstructä¸Šç›´æ¥è°ƒç”¨Lock/Unlockæ–¹æ³•ã€‚</p><pre><code>func main() {\n    var counter Counter\n    var wg sync.WaitGroup\n    wg.Add(10)\n    for i := 0; i &lt; 10; i++ {\n        go func() {\n            defer wg.Done()\n            for j := 0; j &lt; 100000; j++ {\n                counter.Lock()\n                counter.Count++\n                counter.Unlock()\n            }\n        }()\n    }\n    wg.Wait()\n    fmt.Println(counter.Count)\n}\n\n\ntype Counter struct {\n    sync.Mutex\n    Count uint64\n}\n</code></pre><p><strong>å¦‚æœåµŒå…¥çš„structæœ‰å¤šä¸ªå­—æ®µï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šæŠŠMutexæ”¾åœ¨è¦æ§åˆ¶çš„å­—æ®µä¸Šé¢ï¼Œç„¶åä½¿ç”¨ç©ºæ ¼æŠŠå­—æ®µåˆ†éš”å¼€æ¥ã€‚</strong>å³ä½¿ä½ ä¸è¿™æ ·åšï¼Œä»£ç ä¹Ÿå¯ä»¥æ­£å¸¸ç¼–è¯‘ï¼Œåªä¸è¿‡ï¼Œç”¨è¿™ç§é£æ ¼å»å†™çš„è¯ï¼Œé€»è¾‘ä¼šæ›´æ¸…æ™°ï¼Œä¹Ÿæ›´æ˜“äºç»´æŠ¤ã€‚</p><p>ç”šè‡³ï¼Œä½ è¿˜å¯ä»¥<strong>æŠŠè·å–é”ã€é‡Šæ”¾é”ã€è®¡æ•°åŠ ä¸€çš„é€»è¾‘å°è£…æˆä¸€ä¸ªæ–¹æ³•</strong>ï¼Œå¯¹å¤–ä¸éœ€è¦æš´éœ²é”ç­‰é€»è¾‘ï¼š</p><pre><code>func main() {\n    // å°è£…å¥½çš„è®¡æ•°å™¨\n    var counter Counter\n\n    var wg sync.WaitGroup\n    wg.Add(10)\n\n    // å¯åŠ¨10ä¸ªgoroutine\n    for i := 0; i &lt; 10; i++ {\n        go func() {\n            defer wg.Done()\n            // æ‰§è¡Œ10ä¸‡æ¬¡ç´¯åŠ \n            for j := 0; j &lt; 100000; j++ {\n                counter.Incr() // å—åˆ°é”ä¿æŠ¤çš„æ–¹æ³•\n            }\n        }()\n    }\n    wg.Wait()\n    fmt.Println(counter.Count())\n}\n\n// çº¿ç¨‹å®‰å…¨çš„è®¡æ•°å™¨ç±»å‹\ntype Counter struct {\n    CounterType int\n    Name        string\n\n    mu    sync.Mutex\n    count uint64\n}\n\n// åŠ 1çš„æ–¹æ³•ï¼Œå†…éƒ¨ä½¿ç”¨äº’æ–¥é”ä¿æŠ¤\nfunc (c *Counter) Incr() {\n    c.mu.Lock()\n    c.count++\n    c.mu.Unlock()\n}\n\n// å¾—åˆ°è®¡æ•°å™¨çš„å€¼ï¼Œä¹Ÿéœ€è¦é”ä¿æŠ¤\nfunc (c *Counter) Count() uint64 {\n    c.mu.Lock()\n    defer c.mu.Unlock()\n    return c.count\n}\n</code></pre><h2>æ€»ç»“</h2><p>è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»‹ç»äº†å¹¶å‘é—®é¢˜çš„èƒŒæ™¯çŸ¥è¯†ã€æ ‡å‡†åº“ä¸­Mutexçš„ä½¿ç”¨å’Œæœ€ä½³å®è·µã€é€šè¿‡race detectorå·¥å…·å‘ç°è®¡æ•°å™¨ç¨‹åºçš„é—®é¢˜ä»¥åŠä¿®å¤æ–¹æ³•ã€‚ç›¸ä¿¡ä½ å·²ç»å¤§è‡´äº†è§£äº†Mutexè¿™ä¸ªåŒæ­¥åŸè¯­ã€‚</p><p>åœ¨é¡¹ç›®å¼€å‘çš„åˆå§‹é˜¶æ®µï¼Œæˆ‘ä»¬å¯èƒ½å¹¶æ²¡æœ‰ä»”ç»†åœ°è€ƒè™‘èµ„æºçš„å¹¶å‘é—®é¢˜ï¼Œå› ä¸ºåœ¨åˆå§‹é˜¶æ®µï¼Œæˆ‘ä»¬è¿˜ä¸ç¡®å®šè¿™ä¸ªèµ„æºæ˜¯å¦è¢«å…±äº«ã€‚ç»è¿‡æ›´åŠ æ·±å…¥çš„è®¾è®¡ï¼Œæˆ–è€…æ–°åŠŸèƒ½çš„å¢åŠ ã€ä»£ç çš„å®Œå–„ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦è€ƒè™‘å…±äº«èµ„æºçš„å¹¶å‘é—®é¢˜äº†ã€‚å½“ç„¶ï¼Œå¦‚æœä½ èƒ½åœ¨åˆå§‹é˜¶æ®µé¢„è§åˆ°èµ„æºä¼šè¢«å…±äº«å¹¶å‘è®¿é—®å°±æ›´å¥½äº†ã€‚</p><p>æ„è¯†åˆ°å…±äº«èµ„æºçš„å¹¶å‘è®¿é—®çš„æ—©æ™šä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯ï¼Œä¸€æ—¦ä½ æ„è¯†åˆ°è¿™ä¸ªé—®é¢˜ï¼Œä½ å°±è¦åŠæ—¶é€šè¿‡äº’æ–¥é”ç­‰æ‰‹æ®µå»è§£å†³ã€‚</p><p>æ¯”å¦‚Docker issue <a href=\"https://github.com/moby/moby/pull/37583\">37583</a>ã€<a href=\"https://github.com/moby/moby/pull/35517\">35517</a>ã€<a href=\"https://github.com/moby/moby/pull/32826\">32826</a>ã€<a href=\"https://github.com/moby/moby/pull/30696\">30696</a>ç­‰ã€kubernetes issue <a href=\"https://github.com/kubernetes/kubernetes/pull/72361\">72361</a>ã€<a href=\"https://github.com/kubernetes/kubernetes/pull/71617\">71617</a>ç­‰ï¼Œéƒ½æ˜¯åæ¥å‘ç°çš„data raceè€Œé‡‡ç”¨äº’æ–¥é”Mutexè¿›è¡Œä¿®å¤çš„ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>ä½ å·²ç»çŸ¥é“ï¼Œå¦‚æœMutexå·²ç»è¢«ä¸€ä¸ªgoroutineè·å–äº†é”ï¼Œå…¶å®ƒç­‰å¾…ä¸­çš„goroutineä»¬åªèƒ½ä¸€ç›´ç­‰å¾…ã€‚é‚£ä¹ˆï¼Œç­‰è¿™ä¸ªé”é‡Šæ”¾åï¼Œç­‰å¾…ä¸­çš„goroutineä¸­å“ªä¸€ä¸ªä¼šä¼˜å…ˆè·å–Mutexå‘¢ï¼Ÿ</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºå†™ä¸‹ä½ çš„æ€è€ƒå’Œç­”æ¡ˆï¼Œæˆ‘ä»¬ä¸€èµ·äº¤æµè®¨è®ºã€‚å¦‚æœä½ è§‰å¾—æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠä»Šå¤©çš„å†…å®¹åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–åŒäº‹ã€‚</p>","comments":[{"had_liked":false,"id":252834,"user_name":"Gojustforfun","can_delete":false,"product_type":"c1","uid":1187021,"ip_address":"","ucode":"7513A40F27344F","user_header":"https://static001.geekbang.org/account/avatar/00/12/1c/cd/8d552516.jpg","comment_is_top":false,"comment_ctime":1602497252,"is_pvip":true,"discussion_count":4,"race_medal":0,"score":"671617395428","product_id":100061801,"comment_content":"ç­‰å¾…çš„goroutineä»¬æ˜¯ä»¥FIFOæ’é˜Ÿçš„<br>1ï¼‰å½“Mutexå¤„äºæ­£å¸¸æ¨¡å¼æ—¶ï¼Œè‹¥æ­¤æ—¶æ²¡æœ‰æ–°goroutineä¸é˜Ÿå¤´goroutineç«äº‰ï¼Œåˆ™é˜Ÿå¤´goroutineè·å¾—ã€‚è‹¥æœ‰æ–°goroutineç«äº‰å¤§æ¦‚ç‡æ–°goroutineè·å¾—ã€‚<br>2ï¼‰å½“é˜Ÿå¤´goroutineç«äº‰é”å¤±è´¥1msåï¼Œå®ƒä¼šå°†Mutexè°ƒæ•´ä¸ºé¥¥é¥¿æ¨¡å¼ã€‚è¿›å…¥é¥¥é¥¿æ¨¡å¼åï¼Œé”çš„æ‰€æœ‰æƒä¼šç›´æ¥ä»è§£é”goroutineç§»äº¤ç»™é˜Ÿå¤´goroutineï¼Œæ­¤æ—¶æ–°æ¥çš„goroutineç›´æ¥æ”¾å…¥é˜Ÿå°¾ã€‚<br><br>3ï¼‰å½“ä¸€ä¸ªgoroutineè·å–é”åï¼Œå¦‚æœå‘ç°è‡ªå·±æ»¡è¶³ä¸‹åˆ—æ¡ä»¶ä¸­çš„ä»»ä½•ä¸€ä¸ª#1å®ƒæ˜¯é˜Ÿåˆ—ä¸­æœ€åä¸€ä¸ª#2å®ƒç­‰å¾…é”çš„æ—¶é—´å°‘äº1msï¼Œåˆ™å°†é”åˆ‡æ¢å›æ­£å¸¸æ¨¡å¼<br><br>ä»¥ä¸Šç®€ç•¥ç¿»è¯‘è‡ªhttps:&#47;&#47;golang.org&#47;src&#47;sync&#47;mutex.go ä¸­æ³¨é‡ŠMutex fairness.","like_count":157,"discussions":[{"author":{"id":1065272,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/38/4f89095b.jpg","nickname":"å†™ç‚¹å•¥å‘¢","note":"","ucode":"C19032CF1C41BA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":314407,"discussion_content":"è¯·é—®ä¸€ä¸‹ï¼Œå¦‚æœé˜Ÿå¤´goroutineä¸æ–°goroutineç«äº‰å¤±è´¥ï¼Œé‚£ä¹ˆå®ƒä¼šåœ¨ä»€ä¹ˆæ—¶æœºå°†mutexæ”¹ä¸ºé¥¥é¥¿æ¨¡å¼ï¼Ÿæ„Ÿè§‰å¦‚æœæ˜¯ç­‰åˆ°é˜Ÿå¤´goroutineå¾—åˆ°mutexåæ‰ä¿®æ”¹ä¼šå¯¼è‡´è¾ƒé•¿çš„å»¶è¿Ÿå°±æ— æ³•ä¿è¯FIFOäº†ï¼ˆæ¯”å¦‚ä¸æ–­äº§ç”Ÿæ–°goroutineçš„æç«¯æƒ…å†µï¼‰è°¢è°¢","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1603155584,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1181650,"avatar":"https://static001.geekbang.org/account/avatar/00/12/07/d2/0d7ee298.jpg","nickname":"æƒ˜ é—»","note":"","ucode":"C5909F034BF072","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1065272,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/38/4f89095b.jpg","nickname":"å†™ç‚¹å•¥å‘¢","note":"","ucode":"C19032CF1C41BA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385081,"discussion_content":"ä¸æ˜¯è¯´äº†å—é˜Ÿå¤´ç«äº‰å¤±è´¥å°±ä¼šè®¾ç½®ä¸ºé¥¥é¥¿æ¨¡å¼ï¼Œåº”è¯¥æ˜¯åœ¨ç«äº‰å¤±è´¥åè¿›å…¥é˜»å¡å‰åšçš„å§ã€‚åˆ‡æ¢æ¨¡å¼åº”è¯¥å°±æ˜¯æ”¹ä¸ªæ ‡è¯†ä½ï¼Œæ¶ˆè€—ä¹Ÿä¸å¤§é¡ºä¾¿å°±åšäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626874528,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":314407,"ip_address":""},"score":385081,"extra":""}]},{"author":{"id":2147220,"avatar":"https://static001.geekbang.org/account/avatar/00/20/c3/94/e89ebc50.jpg","nickname":"ç¥æ¯“é€é¥","note":"","ucode":"83351CB18B190E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":370603,"discussion_content":"ä¸ºå•¥æœ‰æ–°çš„goroutineæ—¶å¯ä»¥ç›´æ¥è·Ÿé˜Ÿé¦–çš„ç«äº‰ï¼Œä¸è¯¥æ”¾åˆ°é˜Ÿå°¾å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619484201,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1167430,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d0/46/7f9af8de.jpg","nickname":"å¯»","note":"","ucode":"473B2CC14158A7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2147220,"avatar":"https://static001.geekbang.org/account/avatar/00/20/c3/94/e89ebc50.jpg","nickname":"ç¥æ¯“é€é¥","note":"","ucode":"83351CB18B190E","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":375121,"discussion_content":"è¿™æ ·æ›´å¿«","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1621490197,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":370603,"ip_address":""},"score":375121,"extra":""}]}]},{"had_liked":false,"id":252915,"user_name":"ğŸ’A","can_delete":false,"product_type":"c1","uid":1075412,"ip_address":"","ucode":"914FFA92CA2713","user_header":"https://static001.geekbang.org/account/avatar/00/10/68/d4/c9b5d3f9.jpg","comment_is_top":false,"comment_ctime":1602513620,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"435394210516","product_id":100061801,"comment_content":"çœ‹äº†ä¸‹ä½œè€…çš„å‘é‡ï¼Œæœæ–­å…¥æ‰‹","like_count":102,"discussions":[{"author":{"id":1047278,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/fa/ee/748f13b5.jpg","nickname":"äºŒåå¹´å‰","note":"","ucode":"C98331689EECCF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546983,"discussion_content":"æ€äººè¯›å¿ƒå•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642487987,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2063832,"avatar":"","nickname":"é©¬å®å›¾","note":"","ucode":"81721525304984","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382973,"discussion_content":"ä½ æ˜¯é­”é¬¼å— å“ˆå“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625813849,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":252914,"user_name":"æˆ‘æ¥ä¹Ÿ","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1602513583,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"126156565167","product_id":100061801,"comment_content":"è¯¾åæ€è€ƒé¢˜ï¼š<br>åˆ†äº«ä¸¤ç¯‡æ–‡ç« å§ï¼ˆæˆ‘è¿˜æ²¡çœ‹å®ŒğŸ˜‚ï¼‰<br><br>é¸Ÿå”çš„ï¼šsync.mutex æºä»£ç åˆ†æ<br>https:&#47;&#47;colobu.com&#47;2018&#47;12&#47;18&#47;dive-into-sync-mutex&#47;<br><br>golangæºç é˜…è¯»-sync.Mutex<br>https:&#47;&#47;studygolang.com&#47;articles&#47;17017<br>","like_count":29,"discussions":[{"author":{"id":1033096,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c3/88/d16816a8.jpg","nickname":"å¦‚æ¥ç¥æŒ","note":"","ucode":"45E20FF935BD2F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":317286,"discussion_content":"ç¬¬ä¸€ç¯‡ä¹Ÿæ˜¯é¸Ÿçªçš„ğŸ˜„","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1603528891,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1008348,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/dc/8876c73b.jpg","nickname":"moooofly","note":"","ucode":"4A20795C281B6F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":314560,"discussion_content":"ç¬¬ä¸€ç¯‡å¥½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603172022,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1205253,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","nickname":"æˆ‘æ¥ä¹Ÿ","note":"","ucode":"773D6104F56767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1008348,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/dc/8876c73b.jpg","nickname":"moooofly","note":"","ucode":"4A20795C281B6F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":314602,"discussion_content":"ä¸“æ ä½œè€…çš„æ–‡ç« ï¼Œèƒ½ä¸å¥½ä¹ˆã€‚ğŸ˜„","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1603176685,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":314560,"ip_address":""},"score":314602,"extra":""}]}]},{"had_liked":false,"id":252972,"user_name":"pedro","can_delete":false,"product_type":"c1","uid":1200704,"ip_address":"","ucode":"F40C839DDFD599","user_header":"https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg","comment_is_top":false,"comment_ctime":1602551478,"is_pvip":false,"replies":[{"id":"92422","content":"ä½ å±…ç„¶â€œå‰§é€â€ç¬¬äº”è®²çš„å†…å®¹ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½","user_name":"ä½œè€…å›å¤","user_name_real":"é¸Ÿçª","uid":"1066613","ctime":1602551940,"ip_address":"","comment_id":252972,"utype":1}],"discussion_count":4,"race_medal":0,"score":"83206930102","product_id":100061801,"comment_content":"å¤§å®¶éƒ½å·²ç»è§£ç­”äº†ï¼Œå°±ä¸é‡å¤äº†ã€‚è¿™é‡Œç»™ä¸€äº›ä¸ç†Ÿæ‚‰ go éœ€è¦çš„åŒå­¦è¡¥å……ä¸€ä¸‹ï¼Œgo è¯­è¨€æŸ¥çœ‹æ±‡ç¼–ä»£ç å‘½ä»¤:<br>go tool compile -S file.go<br>å¯¹äºæ–‡ä¸­ counter çš„ä¾‹å­å¯ä»¥è¿‡åº¦ä¼˜åŒ–ä¸€ä¸‹ï¼Œé‚£å°±æ˜¯è·å–è®¡æ•°çš„ Count å‡½æ•°å…¶å®å¯ä»¥é€šè¿‡è¯»å†™é”ï¼Œä¹Ÿå°±æ˜¯ RWMutex æ¥ä¼˜åŒ–ä¸€ä¸‹ã€‚","like_count":19,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506932,"discussion_content":"ä½ å±…ç„¶â€œå‰§é€â€ç¬¬äº”è®²çš„å†…å®¹ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602551940,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2009243,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/TUBrScQ5H00BUwjQkpyCyvhcGXyicHZqkAPy4rI4GyXMvmKfwZ4V00xDib0FFZRdAz8T89ANxx1sJ7KNNyFqCz6w/132","nickname":"gopher","note":"","ucode":"9FB521B55AE6CE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312742,"discussion_content":"å†è¡¥å……ä¸€ç‚¹å“ˆï¼Œè¿™æ ·åŠ é”å¯¹æ€§èƒ½å½±å“å¾ˆä¸¥é‡ï¼Œå¯ä»¥é€šè¿‡ syncåŒ…ä¸‹çš„Adduintï¼ˆ&amp;,valï¼‰æ–¹æ³•å®ç°ç´¯åŠ ï¼Œæ€§èƒ½æ›´å¥½","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1602808022,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1618828,"avatar":"","nickname":"é¢å‘å·¥èµ„ç¼–ç¨‹","note":"","ucode":"07F797F021BDD0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391689,"discussion_content":"å¤§ç¥ï¼Œèƒ½è§£é‡Šä¸‹ä¸ºå•¥ã€è·å–è®¡æ•°çš„ Count å‡½æ•°ä¹Ÿè¦åŠ é”å‘€ã€‘ï¼Œä¸» goroutine é‡Œé¢ä¸æ˜¯éƒ½é€šè¿‡ wait() ç­‰å¾…å­ goroutine é‡Œé¢çš„ count++ æ“ä½œå®Œæˆäº†ä¹ˆï¼Œä¸ºå•¥ä¸» goroutine é‡Œé¢åœ¨å®Œæˆä¹‹åè¯»å– count çš„å€¼è¿˜è¦åŠ é”å‘€ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630576842,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1193874,"avatar":"https://static001.geekbang.org/account/avatar/00/12/37/92/961ba560.jpg","nickname":"æˆäººä»¥ğŸŸï¼Œä¸å¦‚æˆäººä»¥æ¸”","note":"","ucode":"BD53829E924B66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1618828,"avatar":"","nickname":"é¢å‘å·¥èµ„ç¼–ç¨‹","note":"","ucode":"07F797F021BDD0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":410961,"discussion_content":"æˆ‘æœ€åˆä¹Ÿæœ‰è¿™ä¸ªé—®é¢˜ã€‚åœ¨è°ƒç”¨ counter.Count() çš„åœ°æ–¹ï¼Œè‚¯å®šæ˜¯ä¸å­˜åœ¨ goroutine å¹¶å‘æƒ…å†µçš„ï¼Œå› æ­¤ä¸åŠ é”ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ä½†æ˜¯å¦‚æœä½ åœ¨ counter.Incr() å‰åä½ç½®æ·»åŠ  counter.Count() è°ƒç”¨ï¼Œè‚¯å®šä¼šå‡ºç° data raceã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635818225,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":391689,"ip_address":""},"score":410961,"extra":""}]}]},{"had_liked":false,"id":254007,"user_name":"Panmax","can_delete":false,"product_type":"c1","uid":1004871,"ip_address":"","ucode":"9D65E3B84C5519","user_header":"https://static001.geekbang.org/account/avatar/00/0f/55/47/d217c45f.jpg","comment_is_top":false,"comment_ctime":1603013799,"is_pvip":false,"replies":[{"id":"92766","content":"é‚£å€Ÿè¿™ä¸ªé—®é¢˜è§£ç­”ä¸€ä¸‹å§ã€‚ç¼–è¯‘çš„æ—¶å€™ä¸èƒ½å‘ç°data race,ä½†æ˜¯ç¼–è¯‘çš„æ—¶å€™å¯ä»¥å¼€å¯raceå‚æ•°ï¼Œè¿™æ ·ç¼–è¯‘åçš„ç¨‹åºåœ¨è¿è¡Œæ—¶å°±å¯ä»¥data raceé—®é¢˜äº†ã€‚ä½ çœ‹åˆ°å¾ˆä»”ç»†ï¼Œå¸Œæœ›è¿™ä¸ªè§£ç­”èƒ½æŠŠè¿™æ®µè§£é‡Šæ¸…æ¥šã€‚<br>å¦å¤–ï¼Œç»å¯¹ä¸è¦æŠŠå¸¦raceå‚æ•°ç¼–è¯‘çš„ç¨‹åºéƒ¨ç½²åˆ°çº¿ä¸Šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é¸Ÿçª","uid":"1066613","ctime":1603028174,"ip_address":"","comment_id":254007,"utype":1}],"discussion_count":4,"race_medal":0,"score":"78912425127","product_id":100061801,"comment_content":"åŸæ–‡ä¸­å…³äº race detector çš„ä»‹ç»æœ‰ä¸¤å¥è¯å‰åçŸ›ç›¾ï¼Œè€å¸ˆå¯å¦è§£é‡Šä¸€ä¸‹ï¼š<br><br>å‰è¾¹è¯´ï¼šåœ¨ç¼–è¯‘ï¼ˆcompileï¼‰ã€æµ‹è¯•ï¼ˆtestï¼‰æˆ–è€…è¿è¡Œï¼ˆrunï¼‰Go ä»£ç çš„æ—¶å€™ï¼ŒåŠ ä¸Š race å‚æ•°ï¼Œå°±æœ‰å¯èƒ½å‘ç°å¹¶å‘é—®é¢˜ã€‚<br><br>åè¾¹å´åˆè¯´ï¼šå› ä¸ºå®ƒçš„å®ç°æ–¹å¼ï¼Œåªèƒ½é€šè¿‡çœŸæ­£å¯¹å®é™…åœ°å€è¿›è¡Œè¯»å†™è®¿é—®çš„æ—¶å€™æ‰èƒ½æ¢æµ‹ï¼Œæ‰€ä»¥å®ƒå¹¶ä¸èƒ½åœ¨ç¼–è¯‘çš„æ—¶å€™å‘ç° data race çš„é—®é¢˜ã€‚<br><br>æ‰€ä»¥ç»“è®ºæ˜¯ race detector å¹¶ä¸èƒ½åœ¨ç¼–è¯‘é˜¶æ®µå‘ç°å¹¶å‘é—®é¢˜ï¼Ÿé‚£ä¹ˆå‰è¾¹é‚£å¥æ˜¯ä¸æ˜¯å°±æ²¡å¿…è¦æäº†ï¼Œä¸ç„¶å®¹æ˜“è®©å¤§å®¶è¯¯ä¼šã€‚","like_count":19,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":507248,"discussion_content":"é‚£å€Ÿè¿™ä¸ªé—®é¢˜è§£ç­”ä¸€ä¸‹å§ã€‚ç¼–è¯‘çš„æ—¶å€™ä¸èƒ½å‘ç°data race,ä½†æ˜¯ç¼–è¯‘çš„æ—¶å€™å¯ä»¥å¼€å¯raceå‚æ•°ï¼Œè¿™æ ·ç¼–è¯‘åçš„ç¨‹åºåœ¨è¿è¡Œæ—¶å°±å¯ä»¥data raceé—®é¢˜äº†ã€‚ä½ çœ‹åˆ°å¾ˆä»”ç»†ï¼Œå¸Œæœ›è¿™ä¸ªè§£ç­”èƒ½æŠŠè¿™æ®µè§£é‡Šæ¸…æ¥šã€‚\nå¦å¤–ï¼Œç»å¯¹ä¸è¦æŠŠå¸¦raceå‚æ•°ç¼–è¯‘çš„ç¨‹åºéƒ¨ç½²åˆ°çº¿ä¸Šã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1603028174,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1269633,"avatar":"https://static001.geekbang.org/account/avatar/00/13/5f/81/07505cdf.jpg","nickname":"å¼ é‡‘å¯Œ","note":"","ucode":"2F571C73DB868F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385163,"discussion_content":"å¼€å§‹çš„compileæ˜¯æŒ‡åŠ å…¥æ£€æµ‹ä»£ç  ç„¶åå¿…é¡»è¿è¡Œæ—¶æ‰èƒ½æ£€æµ‹åˆ°","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1626925896,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2331842,"avatar":"","nickname":"Geek_4f06ca","note":"","ucode":"69B37349DE3EC5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":411357,"discussion_content":"QAæ€§èƒ½æµ‹è¯•çš„æ—¶å€™å¯ä»¥å¼€å¯ï¼Œè·‘ä¸€ä¼šï¼Œå‘ç°é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635906090,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1310798,"avatar":"https://static001.geekbang.org/account/avatar/00/14/00/4e/be2b206b.jpg","nickname":"å´å°æ™º","note":"","ucode":"C7C9F58B5C9F7B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383950,"discussion_content":"é‚£åœ¨ CI æµç¨‹ä¸­ï¼Œåªèƒ½åœ¨æµ‹è¯•é˜¶æ®µå‘ç° data race é—®é¢˜ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626316297,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":252931,"user_name":"Rememberä¹ç¦»","can_delete":false,"product_type":"c1","uid":1237327,"ip_address":"","ucode":"97EE6E6344689F","user_header":"https://static001.geekbang.org/account/avatar/00/12/e1/4f/00476b4c.jpg","comment_is_top":false,"comment_ctime":1602518251,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"66027027691","product_id":100061801,"comment_content":"è¿™ä¸ªè¯¾ç¨‹æˆ‘æƒ³ä¸€ç›´è·Ÿç€èµ°ï¼Œä¸å•å•åªæ˜¯çœ‹ï¼Œæˆ‘æƒ³åœ¨å¸æ”¶è¯¾ç¨‹ç²¾åçš„åŒæ—¶ï¼Œä¹Ÿè¿›è¡Œç‹¬ç«‹çš„æ€è€ƒï¼Œç„¶åè¾“å‡ºï¼Œæ€»ç»“ï¼ŒåŠ æ·±ç†è§£ã€‚å› æ­¤åˆ›å»ºäº†ä¸€ä¸ªä»“åº“ï¼Œæ¬¢è¿å¤§å®¶åœ¨å­¦ä¹ çš„åŒæ—¶ä¸€èµ·åšåˆ°æ‰‹ä¸­æœ‰ç ï¼Œé¡¹ç›®åœ°å€:https:&#47;&#47;github.com&#47;wuqinqiang&#47;Go_Concurrency","like_count":16,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311937,"discussion_content":"ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¼Œæ¬¢è¿åˆ†äº«å¿ƒå¾—å’Œè‡ªå·±çš„æ€è€ƒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602547258,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":252833,"user_name":"Daiver","can_delete":false,"product_type":"c1","uid":1466447,"ip_address":"","ucode":"9B1A03AFBC79BC","user_header":"https://static001.geekbang.org/account/avatar/00/16/60/4f/db0e62b3.jpg","comment_is_top":false,"comment_ctime":1602497145,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"57437071993","product_id":100061801,"comment_content":"goçš„goroutine è°ƒåº¦ä¸­ï¼Œå†…éƒ¨ç»´æŠ¤äº†é˜Ÿåˆ—ï¼Œgoroutineåœ¨æŠ¢å é”çš„æ—¶å€™ï¼Œä¼šè‡ªæ—‹ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœæŠ¢å å¤±è´¥ï¼Œè¿™ä¸ªgoroutineä¼šè¢«æ”¾åˆ°ä¸€ä¸ªFIFOé˜Ÿåˆ—ä¸­ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œé”é‡Šæ”¾æ—¶ï¼Œä¼šä¼˜å…ˆå”¤é†’é˜Ÿå¤´çš„goroutineï¼Œå³é˜Ÿå¤´çš„goroutineä¼˜å…ˆè·å¾—Mutexã€‚","like_count":13},{"had_liked":false,"id":297480,"user_name":"éªå‹‡å–„æˆ˜","can_delete":false,"product_type":"c1","uid":1076063,"ip_address":"","ucode":"D57DC14EADC889","user_header":"https://static001.geekbang.org/account/avatar/00/10/6b/5f/8d10c47a.jpg","comment_is_top":false,"comment_ctime":1623573080,"is_pvip":false,"replies":[{"id":"108114","content":"è¯´æ¥è¯é•¿ã€‚<br>1.mutexä¿æŠ¤çš„ä¸´ç•ŒåŒºã€‚å¦‚æœè¯»çš„æ—¶å€™ä¸åŠ é”ï¼Œå¯èƒ½ä¼šé€ æˆä¸ä¸€è‡´çš„åæœï¼Œæ¯”å¦‚éƒ¨åˆ†å˜é‡è¢«ä¿®æ”¹äº†ã€‚<br>2.å¦‚æœä¸´ç•ŒåŒºæ¯”è¾ƒç®€å•ï¼Œæ¯”å¦‚ä¸€ä¸ªint64è¯»å†™ï¼Œä¹Ÿå¯èƒ½åœ¨ä¸€äº›cpuæ¶æ„ä¸‹æœ‰å¯è§æ€§é—®é¢˜ï¼Œå¯¼è‡´åˆ«çš„goroutineå¯¹å˜é‡çš„å†™è¯»goroutineçœ‹ä¸åˆ°<br>","user_name":"ä½œè€…å›å¤","user_name_real":"é¸Ÿçª","uid":"1066613","ctime":1623770242,"ip_address":"","comment_id":297480,"utype":1}],"discussion_count":2,"race_medal":0,"score":"44573246040","product_id":100061801,"comment_content":"è€å¸ˆï¼Œä¸ºä»€ä¹ˆè¯»ä¹Ÿè¦åŠ é”å‘¢ï¼Ÿ","like_count":10,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521836,"discussion_content":"è¯´æ¥è¯é•¿ã€‚\n1.mutexä¿æŠ¤çš„ä¸´ç•ŒåŒºã€‚å¦‚æœè¯»çš„æ—¶å€™ä¸åŠ é”ï¼Œå¯èƒ½ä¼šé€ æˆä¸ä¸€è‡´çš„åæœï¼Œæ¯”å¦‚éƒ¨åˆ†å˜é‡è¢«ä¿®æ”¹äº†ã€‚\n2.å¦‚æœä¸´ç•ŒåŒºæ¯”è¾ƒç®€å•ï¼Œæ¯”å¦‚ä¸€ä¸ªint64è¯»å†™ï¼Œä¹Ÿå¯èƒ½åœ¨ä¸€äº›cpuæ¶æ„ä¸‹æœ‰å¯è§æ€§é—®é¢˜ï¼Œå¯¼è‡´åˆ«çš„goroutineå¯¹å˜é‡çš„å†™è¯»goroutineçœ‹ä¸åˆ°\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1623770242,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1603004,"avatar":"https://static001.geekbang.org/account/avatar/00/18/75/bc/e24e181e.jpg","nickname":"Calvin","note":"","ucode":"0EEF5B207623B5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":544786,"discussion_content":"è€å¸ˆï¼Œjavaå¯ä»¥ç”¨volatileå…³é”®å­—è§£å†³å¯è§æ€§çš„é—®é¢˜ï¼Œgoä¸­æ˜¯å¦æœ‰ç±»ä¼¼çš„åŒæ­¥åŸè¯­ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641713156,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":521836,"ip_address":""},"score":544786,"extra":""}]}]},{"had_liked":false,"id":254727,"user_name":"Panda","can_delete":false,"product_type":"c1","uid":1095740,"ip_address":"","ucode":"911A200C7B18BE","user_header":"https://static001.geekbang.org/account/avatar/00/10/b8/3c/1a294619.jpg","comment_is_top":false,"comment_ctime":1603175812,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"44552848772","product_id":100061801,"comment_content":"æ¨èä¸€ä¸ªå·¥å…· Chronos - A static race detector for the go language    <br> https:&#47;&#47;github.com&#47;amit-davidson&#47;Chronos ","like_count":11},{"had_liked":false,"id":253855,"user_name":"ZY","can_delete":false,"product_type":"c1","uid":1284436,"ip_address":"","ucode":"BE2541F50DE864","user_header":"https://static001.geekbang.org/account/avatar/00/13/99/54/55554fa1.jpg","comment_is_top":false,"comment_ctime":1602920476,"is_pvip":false,"replies":[{"id":"92736","content":"è¿›å…¥è‡ªæ—‹ä¸ä¸€å®šä¼šè·å–åˆ°é”ã€‚<br>é¥¥é¥¿æ¨¡å¼ä¸ä¸€å®šæ”¹å˜ï¼Œçœ‹æ–‡ç« ã€‚åªæœ‰ç­‰å¾…æ—¶é—´å°äºé˜ˆå€¼æˆ–è€…æ— ç­‰å¾…è€…æ—¶æ‰ä¼šæ”¹å˜æ¨¡å¼","user_name":"ä½œè€…å›å¤","user_name_real":"é¸Ÿçª","uid":"1066613","ctime":1602932931,"ip_address":"","comment_id":253855,"utype":1}],"discussion_count":1,"race_medal":0,"score":"31667691548","product_id":100061801,"comment_content":"æœ‰ä¸¤ç§æƒ…å†µ<br>1. å¦‚æœå½“å‰æœ‰åç¨‹è¿›å…¥è‡ªæ—‹æ¨¡å¼ï¼Œå½“å‰åç¨‹ä¼šæˆåŠŸè·å–åˆ°é”<br>2. å¦‚æœæ²¡æœ‰åç¨‹è¿›å…¥è‡ªé€‰æ¨¡å¼ï¼Œé‡Šæ”¾é”çš„åç¨‹ä¼šé‡Šæ”¾çš„ä¿¡å·é‡ä¼šæˆåŠŸå”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„åç¨‹ï¼Œè¯¥å¸ç¨‹ä¼šæˆåŠŸè·å–åˆ°é”ï¼Œå¹¶ä¸”æŠŠç­‰å¾…è®¡æ•°å™¨å‡1.<br><br>è€å¸ˆï¼šåœ¨é¥¥é¥¿æ¨¡å¼ä¸‹ï¼Œä¿¡å·é‡å”¤é†’çš„åç¨‹æˆåŠŸè·å–åˆ°é”ä¹‹åï¼Œè¯¥Mutexçš„æ¨¡å¼ä¼šæ”¹å˜å—ï¼Ÿ","like_count":7,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":507206,"discussion_content":"è¿›å…¥è‡ªæ—‹ä¸ä¸€å®šä¼šè·å–åˆ°é”ã€‚\né¥¥é¥¿æ¨¡å¼ä¸ä¸€å®šæ”¹å˜ï¼Œçœ‹æ–‡ç« ã€‚åªæœ‰ç­‰å¾…æ—¶é—´å°äºé˜ˆå€¼æˆ–è€…æ— ç­‰å¾…è€…æ—¶æ‰ä¼šæ”¹å˜æ¨¡å¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602932931,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":273517,"user_name":"ä¸€ä»£å’©ç¥","can_delete":false,"product_type":"c1","uid":1505603,"ip_address":"","ucode":"72916825725038","user_header":"https://static001.geekbang.org/account/avatar/00/16/f9/43/654d107e.jpg","comment_is_top":false,"comment_ctime":1610619663,"is_pvip":false,"replies":[{"id":"99180","content":"å¦åˆ™è·å–çš„æ—¶å€™å¯èƒ½ä¸èƒ½å¾—åˆ°åˆšå¢åŠ çš„å€¼","user_name":"ä½œè€…å›å¤","user_name_real":"é¸Ÿçª","uid":"1066613","ctime":1610723141,"ip_address":"","comment_id":273517,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23085456143","product_id":100061801,"comment_content":"èƒ½å¦è§£ç­”ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆè·å–è®¡æ•°å™¨çš„å€¼ä¹Ÿéœ€è¦åŠ é”ï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513620,"discussion_content":"å¦åˆ™è·å–çš„æ—¶å€™å¯èƒ½ä¸èƒ½å¾—åˆ°åˆšå¢åŠ çš„å€¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610723141,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":253062,"user_name":"chapin","can_delete":false,"product_type":"c1","uid":1070020,"ip_address":"","ucode":"BB1800A771A8E9","user_header":"https://static001.geekbang.org/account/avatar/00/10/53/c4/dea5d7f3.jpg","comment_is_top":false,"comment_ctime":1602582056,"is_pvip":false,"replies":[{"id":"92453","content":"æ˜å¤©ä¸€è®²å‰–æmutex","user_name":"ä½œè€…å›å¤","user_name_real":"é¸Ÿçª","uid":"1066613","ctime":1602590680,"ip_address":"","comment_id":253062,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18782451240","product_id":100061801,"comment_content":"ä¸ªäººå¸Œæœ›ğŸ¤ çªå¤§ä½¬å¯ä»¥å¤šåˆ†æä¸€äº›æºç ã€‚","like_count":4,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506960,"discussion_content":"æ˜å¤©ä¸€è®²å‰–æmutex","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602590680,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":315311,"user_name":"æ— åæ— å§“","can_delete":false,"product_type":"c1","uid":2621412,"ip_address":"","ucode":"487BD5AA2CD305","user_header":"https://static001.geekbang.org/account/avatar/00/27/ff/e4/927547a9.jpg","comment_is_top":false,"comment_ctime":1633826611,"is_pvip":true,"replies":[{"id":"114227","content":"ä¸€ç›´å°è¯•åšè·å–é”ï¼Œè€Œä¸æ˜¯è®©æ¸¡cpuç»™å…¶ä»–goroutine","user_name":"ä½œè€…å›å¤","user_name_real":"é¸Ÿçª","uid":"1066613","ctime":1633929539,"ip_address":"","comment_id":315311,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14518728499","product_id":100061801,"comment_content":"è¯·é—®è€å¸ˆgoroutineé‡Œé¢è‡ªæ—‹æ€ä¹ˆç†è§£","like_count":3,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527930,"discussion_content":"ä¸€ç›´å°è¯•åšè·å–é”ï¼Œè€Œä¸æ˜¯è®©æ¸¡cpuç»™å…¶ä»–goroutine","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633929539,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":298194,"user_name":"geek_arong2048","can_delete":false,"product_type":"c1","uid":1518310,"ip_address":"","ucode":"AB575BE100E4A9","user_header":"https://static001.geekbang.org/account/avatar/00/17/2a/e6/c788257f.jpg","comment_is_top":false,"comment_ctime":1623941313,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14508843201","product_id":100061801,"comment_content":"&#47;&#47; å¾—åˆ°è®¡æ•°å™¨çš„å€¼ï¼Œä¹Ÿéœ€è¦é”ä¿æŠ¤<br>func (c *Counter) Count() uint64 { <br>c.mu.Lock() <br>defer c.mu.Unlock() <br>return c.count<br>}<br>è€å¸ˆï¼Œåœ¨è¿™é‡Œè¯»å–countå€¼æ—¶æœ‰å¿…è¦åŠ é”å—ï¼Ÿæˆ‘ç†è§£çš„æ˜¯è¿™ç±»ç®€å•çš„è¯»å–åº”è¯¥ä¸å¤ªéœ€è¦å¢åŠ é”ï¼Œå½“éœ€è¦è¿›è¡Œè¯»å–å¹¶ä¿®æ”¹æ—¶æ‰éœ€è¦è¿›è¡ŒåŠ é”æ“ä½œï¼Œå› ä¸º&quot;è¯»å–&quot;è¿™ä¸ªåŠ¨ä½œè‡ªèº«æ˜¯åŸå­çš„ï¼Œè€Œ&quot;è¯»å–-ä¿®æ”¹&quot;è¿™ä¸ªåŠ¨ä½œæ˜¯éåŸå­çš„","like_count":3},{"had_liked":false,"id":294800,"user_name":"åˆå­¦è€…","can_delete":false,"product_type":"c1","uid":2052670,"ip_address":"","ucode":"5E404009761B90","user_header":"https://static001.geekbang.org/account/avatar/00/1f/52/3e/f74da7bd.jpg","comment_is_top":false,"comment_ctime":1622095660,"is_pvip":false,"replies":[{"id":"107062","content":"å¯¹","user_name":"ä½œè€…å›å¤","user_name_real":"é¸Ÿçª","uid":"1066613","ctime":1622156097,"ip_address":"","comment_id":294800,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10212030252","product_id":100061801,"comment_content":"è€å¸ˆå¥½ï¼Œâ€œå¤šä¸ªgoroutineå¹¶å‘æ›´æ–°åŒä¸€ä¸ªèµ„æºâ€ï¼Œè¿™é‡Œçš„åŒä¸€ä¸ªèµ„æºçš„æ¡ä»¶æ˜¯ä¸æ˜¯åº”è¯¥æ˜¯å †æ ˆåˆ†æååˆ†é…åˆ°å †ä¸Šçš„å˜é‡ï¼Œå› ä¸ºå †ä¸Šæ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œå¦‚æœæ˜¯æ ˆä¸Šçš„å˜é‡çš„è¯ï¼Œå› ä¸ºæ˜¯çº¿ç¨‹ç‹¬æœ‰çš„å°±ä¸ä¼šå‡ºç°å¹¶å‘æ›´æ–°çš„é—®é¢˜ï¼Œæœ›è€å¸ˆè§£ç­”ä¸‹","like_count":2,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520817,"discussion_content":"å¯¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622156097,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":255591,"user_name":"æ— åæ°","can_delete":false,"product_type":"c1","uid":1001023,"ip_address":"","ucode":"D1F322E386430E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/46/3f/7825378a.jpg","comment_is_top":false,"comment_ctime":1603376995,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"10193311587","product_id":100061801,"comment_content":"æ¯ç¯‡æ–‡ç« å¤šå“å‡ é","like_count":2,"discussions":[{"author":{"id":1072015,"avatar":"https://static001.geekbang.org/account/avatar/00/10/5b/8f/4b0ab5db.jpg","nickname":"Middleware","note":"","ucode":"C0028293ECDD47","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559041,"discussion_content":"ç‰›é€¼ æˆ‘æ‰å¼€å§‹çœ‹è¿™è¯¾äº†ï¼Œä½ ç«Ÿç„¶20å¹´å°±å­¦ä¹ äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648582816,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":310412,"user_name":"é¢å‘å·¥èµ„ç¼–ç¨‹","can_delete":false,"product_type":"c1","uid":1618828,"ip_address":"","ucode":"07F797F021BDD0","user_header":"","comment_is_top":false,"comment_ctime":1630646054,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5925613350","product_id":100061801,"comment_content":"main å‡½æ•°é‡Œé¢è°ƒç”¨çš„ wg.Wait() ä¸æ˜¯å·²ç»èƒ½å¤Ÿç¡®ä¿åé¢çš„è¯»å– fmt.Println(counter.Count()) æ“ä½œå’Œå†™å…¥ counter.Incr() è¿™ä¸¤ä¸ª goroutine çš„å‰åé¡ºåºäº†ä¹ˆï¼ˆç¡®å®šæ˜¯å…ˆ Incr å®Œæˆä¹‹åå†è¯»å–ï¼‰ï¼Ÿä¸ºå•¥è¯»å–è¿˜è¦åŠ é”ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1080563,"avatar":"https://static001.geekbang.org/account/avatar/00/10/7c/f3/d5cc779e.jpg","nickname":"å‘¨é¸£","note":"","ucode":"0796B633876E92","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":562085,"discussion_content":"å› ä¸ºç°åœ¨çš„cpuéƒ½æœ‰ç¼“å­˜çš„è®¾è®¡ã€‚å¯èƒ½å­˜åœ¨ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å˜é‡çš„å€¼ï¼Œä½†æ˜¯è¿˜æ²¡æ¥å¾—åŠåˆ·è¿›å†…å­˜ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°±æ¥è¯»å–è¿™ä¸ªå€¼ã€‚å¯¼è‡´è¯»å–çš„å€¼ä¸æ˜¯æœ€ç»ˆçš„ä¿®æ”¹å€¼ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649772234,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2028277,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/f2/f5/b82f410d.jpg","nickname":"Unknown element","note":"","ucode":"34A129800D0238","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1080563,"avatar":"https://static001.geekbang.org/account/avatar/00/10/7c/f3/d5cc779e.jpg","nickname":"å‘¨é¸£","note":"","ucode":"0796B633876E92","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591632,"discussion_content":"åŠ é”å¯ä»¥ä¿è¯ç¼“å­˜åˆ·è¿›å†…å­˜å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666717350,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":562085,"ip_address":"æ±Ÿè‹"},"score":591632,"extra":""}]}]},{"had_liked":false,"id":274119,"user_name":"Albert","can_delete":false,"product_type":"c1","uid":2227374,"ip_address":"","ucode":"4A38B6BA2DD0ED","user_header":"https://static001.geekbang.org/account/avatar/00/21/fc/ae/0bfbb04a.jpg","comment_is_top":false,"comment_ctime":1610862547,"is_pvip":false,"replies":[{"id":"99563","content":"ä¸æ¸…æ¥šä½ è¯´çš„é‚£ä¸ªä»£ç ï¼Ÿä¸æ˜¯æœ€ç»ˆçš„å€¼è‚¯å®šæ˜¯å¯¹è®¡æ•°å€¼çš„æ›´æ–°æœ‰å¹¶å‘é—®é¢˜","user_name":"ä½œè€…å›å¤","user_name_real":"é¸Ÿçª","uid":"1066613","ctime":1610947149,"ip_address":"","comment_id":274119,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5905829843","product_id":100061801,"comment_content":"è€å¸ˆï¼Œï¼Œè·å–è®¡æ•°å™¨çš„å€¼ ä¹ŸåŠ é”ï¼Œè§£é‡Šä¸ºå¯èƒ½ä¸èƒ½å¾—åˆ°åˆšå¢åŠ çš„å€¼ã€‚&#47;&#47; ä½¿ç”¨WaitGroupç­‰å¾…10ä¸ªgoroutineå®Œæˆ æ—¢ç„¶å·²ç»å®Œäº†è®¡æ•°çš„åç¨‹ã€‚ä¸ºå•¥æœ€åæ‰“å°è®¡æ•°å™¨ è¿˜å¯èƒ½ä¸æ˜¯æœ€ç»ˆçš„å€¼å•Šï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513913,"discussion_content":"ä¸æ¸…æ¥šä½ è¯´çš„é‚£ä¸ªä»£ç ï¼Ÿä¸æ˜¯æœ€ç»ˆçš„å€¼è‚¯å®šæ˜¯å¯¹è®¡æ•°å€¼çš„æ›´æ–°æœ‰å¹¶å‘é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610947149,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":262420,"user_name":"æ„¤æ€’çš„æ˜¾å¡","can_delete":false,"product_type":"c1","uid":1640898,"ip_address":"","ucode":"5027D73E1CCDD4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKhZZ4YhWluhayDIDDicJXJkDe86hm2mYEpPZzYdyopt8hPbt2EMcwgZ4jzPBqFyVUEQzb3sEYXWuA/132","comment_is_top":false,"comment_ctime":1605712591,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5900679887","product_id":100061801,"comment_content":"é¸Ÿçªå¤§å¤§ä½ å¥½ï¼Œè¯·æ•™ä¸‹ä¸ºä»€ä¹ˆåœ¨åç¨‹å†…éƒ¨fmt.Printlnåæœ€åçš„ç»“æœä¼šæ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºfmtæ˜¯å®‰å…¨çš„ä¹ˆ<br>func main() {<br>\tvar count = 0<br><br>\tvar wg sync.WaitGroup<br><br>\twg.Add(10)<br><br>\tfor i := 0; i &lt; 10; i++ {<br>\t\tgo func() {<br>\t\t\tdefer wg.Done()<br>\t\t\tfor j := 0; j &lt; 10000; j++ {<br>\t\t\tcount++<br>\t\t\t\tfmt.Println(count)<br>\t\t\t}<br>\t\t}()<br>\t}<br><br>\twg.Wait()<br><br>\tfmt.Println(count)<br>}<br>","like_count":1,"discussions":[{"author":{"id":1115232,"avatar":"https://static001.geekbang.org/account/avatar/00/11/04/60/64d166b6.jpg","nickname":"Fan","note":"","ucode":"3BF28670FD9407","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336685,"discussion_content":"è¿™ä¸ªä¹Ÿæ˜¯ä¸å¯¹ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1608654273,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":258998,"user_name":"ä¸€ä»‹å†œå¤«","can_delete":false,"product_type":"c1","uid":1231587,"ip_address":"","ucode":"FBDEE48436A542","user_header":"https://static001.geekbang.org/account/avatar/00/12/ca/e3/7e860739.jpg","comment_is_top":false,"comment_ctime":1604592635,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5899559931","product_id":100061801,"comment_content":"çœ‹å®Œè¿™ç« ï¼Œæ‰å‘ç°åŸæ¥æœ‰æ£€æµ‹è¿™ä¸ªå…±äº«èµ„æºç«äº‰é—®é¢˜çš„å‘½ä»¤å•ŠğŸ˜‚","like_count":1},{"had_liked":false,"id":256907,"user_name":"jeffery","can_delete":false,"product_type":"c1","uid":1219972,"ip_address":"","ucode":"35E2DAA386FB86","user_header":"https://static001.geekbang.org/account/avatar/00/12/9d/84/171b2221.jpg","comment_is_top":false,"comment_ctime":1603781060,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5898748356","product_id":100061801,"comment_content":"å¯¹äºgoå°ç™½æ¥è¯´æ€ä¹ˆå¿«é€Ÿçš„è¿›é˜¶ï¼çœ‹é¸Ÿå”.å‘å‹.å¿…å®šè¯¾ç¨‹å¹²è´§æ»¡æ»¡","like_count":1},{"had_liked":false,"id":256709,"user_name":"Kcaco","can_delete":false,"product_type":"c1","uid":1247099,"ip_address":"","ucode":"E292C8B89B2BE5","user_header":"https://static001.geekbang.org/account/avatar/00/13/07/7b/0b42148f.jpg","comment_is_top":false,"comment_ctime":1603713285,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5898680581","product_id":100061801,"comment_content":"æ€è·¯æ¸…æ™°ï¼Œå­¦åˆ°å¾ˆå¤šï¼ï¼ï¼","like_count":1},{"had_liked":false,"id":254334,"user_name":"ä¸æ±‚é—»è¾¾","can_delete":false,"product_type":"c1","uid":1629565,"ip_address":"","ucode":"B265859B9566D5","user_header":"https://static001.geekbang.org/account/avatar/00/18/dd/7d/5d3ab033.jpg","comment_is_top":false,"comment_ctime":1603101664,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5898068960","product_id":100061801,"comment_content":"grouting æ˜¯ä»¥FIFOé˜Ÿåˆ—é¡ºåºæ¥è¿›å…¥ä¸´ç•ŒåŒºã€‚è¿™åªæ˜¯æ­£å¸¸æ¨¡å¼ã€‚å¦‚æœæ˜¯é¥¥é¥¿æ¨¡å¼å°±ä¸ä¸€æ ·äº†ã€‚","like_count":1},{"had_liked":false,"id":253735,"user_name":"é£ä¸­èŠ±","can_delete":false,"product_type":"c1","uid":1085237,"ip_address":"","ucode":"067E0A1E116844","user_header":"https://static001.geekbang.org/account/avatar/00/10/8f/35/f1839bb2.jpg","comment_is_top":false,"comment_ctime":1602846760,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5897814056","product_id":100061801,"comment_content":"æ‰“å¡ å¹³å°çš„goç›¸å…³éƒ½å­¦äº† è¿™ä¸ªä¹Ÿä¸èƒ½é”™è¿‡ å­¦ä¹ æ¶ˆåŒ–ä¸­ ","like_count":1},{"had_liked":false,"id":253026,"user_name":"æ–°å‘³é“","can_delete":false,"product_type":"c1","uid":2227527,"ip_address":"","ucode":"979E3574082CE7","user_header":"https://static001.geekbang.org/account/avatar/00/21/fd/47/499339d1.jpg","comment_is_top":false,"comment_ctime":1602570481,"is_pvip":false,"replies":[{"id":"92445","content":"ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½çœ‹çš„ä»”ç»†ã€‚ä¹Ÿå¯ä»¥ã€‚deferçš„è€—æ—¶å·²ç»éå¸¸å°äº†ï¼Œæˆ‘ä¸“æ ä¸­æœ‰è®²åˆ°ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é¸Ÿçª","uid":"1066613","ctime":1602580502,"ip_address":"","comment_id":253026,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5897537777","product_id":100061801,"comment_content":"func (c *Counter) Incr() { c.mu.Lock() c.count++ c.mu.Unlock()}&#47;&#47; å¾—åˆ°è®¡æ•°å™¨çš„å€¼ï¼Œä¹Ÿéœ€è¦é”ä¿æŠ¤func (c *Counter) Count() uint64 { c.mu.Lock() defer c.mu.Unlock() return c.count}<br><br>é—®é¢˜ï¼šIncr()é‡Œä¸ºä»€ä¹ˆä¸ç”¨defer c.mu.Unlock() ?","like_count":1,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506948,"discussion_content":"ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½çœ‹çš„ä»”ç»†ã€‚ä¹Ÿå¯ä»¥ã€‚deferçš„è€—æ—¶å·²ç»éå¸¸å°äº†ï¼Œæˆ‘ä¸“æ ä¸­æœ‰è®²åˆ°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602580502,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1115232,"avatar":"https://static001.geekbang.org/account/avatar/00/11/04/60/64d166b6.jpg","nickname":"Fan","note":"","ucode":"3BF28670FD9407","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336687,"discussion_content":"è¡¨æƒ…éƒ½å˜æˆä¹±ç äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608654392,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2227527,"avatar":"https://static001.geekbang.org/account/avatar/00/21/fd/47/499339d1.jpg","nickname":"æ–°å‘³é“","note":"","ucode":"979E3574082CE7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312084,"discussion_content":"ä½ çš„å›å¤å¼€å¤´æ˜¯ä¹±ç ï¼Œå¯ä»¥è·Ÿæå®¢æ—¶é—´ååº”ä¸‹ã€‚å¾ˆå¤šåœ°æ–¹æœ‰ä¹±ç ï¼Œæ˜¯ä¸æ˜¯è¡¨æƒ…ç¬¦ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602580620,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":252890,"user_name":"ç½—æ°","can_delete":false,"product_type":"c1","uid":1320487,"ip_address":"","ucode":"96BAFAA147341F","user_header":"https://static001.geekbang.org/account/avatar/00/14/26/27/eba94899.jpg","comment_is_top":false,"comment_ctime":1602507196,"is_pvip":false,"discussion_count":1,"race_medal":2,"score":"5897474492","product_id":100061801,"comment_content":"ç›´è§‰æ˜¯éšæœºçš„ï¼Œè®©æˆ‘åˆ°å®¶ç”¨ä»£ç ç¡®è®¤ä¸€ä¸‹","like_count":1,"discussions":[{"author":{"id":1320487,"avatar":"https://static001.geekbang.org/account/avatar/00/14/26/27/eba94899.jpg","nickname":"ç½—æ°","note":"","ucode":"96BAFAA147341F","race_medal":2,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311890,"discussion_content":"å“ˆ å¹¶ä¸æ˜¯ è¯„è®ºåŒºæœ‰å¤§ä½¬ç»™å‡ºäº†æ­£ç¡®ç­”æ¡ˆ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1602513707,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":252837,"user_name":"Gojustforfun","can_delete":false,"product_type":"c1","uid":1187021,"ip_address":"","ucode":"7513A40F27344F","user_header":"https://static001.geekbang.org/account/avatar/00/12/1c/cd/8d552516.jpg","comment_is_top":false,"comment_ctime":1602498132,"is_pvip":true,"replies":[{"id":"92400","content":"è¿™ä¸ªä»£ç ç›´æ¥å¤åˆ¶åˆ°æœ¬åœ°åŠ åˆ°package mainå’Œimport packageså°±èƒ½è·‘ï¼Œå¦‚æœæœ‰é—®é¢˜è®°å¾—ç•™è¨€ã€‚<br>ä½ ç†è§£çš„æ˜¯å¯¹çš„ï¼Œä½†æ˜¯è¿™ç§é£æ ¼ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œåªæ˜¯ä½œä¸ºæ¨èå‘½åæ–¹å¼ï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½è¯´åˆ«äººä¸å¯¹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é¸Ÿçª","uid":"1066613","ctime":1602503497,"ip_address":"","comment_id":252837,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5897465428","product_id":100061801,"comment_content":"å¦‚æœå¯ä»¥ï¼Œå¸Œæœ›è€å¸ˆå°†å®Œæ•´ä»£ç å‘ä¸€ä¸‹ã€‚<br><br>å¦å¤–ï¼Œæœ‰ä¸ªé•¿ä¹…çš„ç–‘é—®ï¼ˆå¾ˆå¤šJavaèƒŒæ™¯çš„åŒäº‹éƒ½è¿™æ ·ï¼‰â€”â€”æ˜æ˜Counterç±»å‹æœ¬èº«å·²ç»å…·æœ‰è¯­ä¹‰&#47;ä¸Šä¸‹æ–‡ï¼Œå…¶ä¸­çš„å­—æ®µåªè¦ç”¨Type&#47;Nameå‘½åå°±å¥½ï¼Œè°ƒç”¨:counter.Type&#47;counter.Nameã€‚<br><br>ä½†å¸¸å¸¸çœ‹åˆ°çš„æ˜¯counter.CounterType&#47;counter.CounterNameï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506888,"discussion_content":"è¿™ä¸ªä»£ç ç›´æ¥å¤åˆ¶åˆ°æœ¬åœ°åŠ åˆ°package mainå’Œimport packageså°±èƒ½è·‘ï¼Œå¦‚æœæœ‰é—®é¢˜è®°å¾—ç•™è¨€ã€‚\nä½ ç†è§£çš„æ˜¯å¯¹çš„ï¼Œä½†æ˜¯è¿™ç§é£æ ¼ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œåªæ˜¯ä½œä¸ºæ¨èå‘½åæ–¹å¼ï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½è¯´åˆ«äººä¸å¯¹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602503497,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1044027,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ee/3b/0ecd751d.jpg","nickname":"ryon","note":"","ucode":"B1BD25FB739D6E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312841,"discussion_content":"æˆ‘è§‰å¾—æ˜¯ä¸ºäº†æ›´åŠ ç®€æ´å§: counter.Type","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602830369,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354345,"user_name":"è èå¹é›ªâ€”Code","can_delete":false,"product_type":"c1","uid":1650378,"ip_address":"æ²³å—","ucode":"A5B2FC661EE17D","user_header":"https://static001.geekbang.org/account/avatar/00/19/2e/ca/469f7266.jpg","comment_is_top":false,"comment_ctime":1660292984,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1660292984","product_id":100061801,"comment_content":"æ€è€ƒé¢˜ï¼š<br>æ‰§è¡Œæ­¥éª¤ï¼š<br>ï¼ˆ1ï¼‰å…ˆä¸Šæ¥ä¸€ä¸ªCASæ“ä½œï¼Œå¦‚æœè¿™æŠŠé”æ­£ç©ºé—²ï¼Œå¹¶ä¸”æ²¡äººæŠ¢ï¼Œé‚£ä¹ˆå°±ç›´æ¥æˆåŠŸ<br>ï¼ˆ2ï¼‰å¦åˆ™ï¼Œè‡ªæ—‹å‡ æ¬¡ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™æˆåŠŸäº†ï¼Œä¹Ÿä¸ç”¨åŠ å…¥é˜Ÿåˆ—<br>ï¼ˆ3ï¼‰å¦åˆ™ï¼ŒåŠ å…¥é˜Ÿåˆ—<br>ï¼ˆ4ï¼‰ä»é˜Ÿåˆ—ä¸­è¢«å”¤é†’ï¼š#1ã€æ­£å¸¸æ¨¡å¼ï¼šå’Œæ–°æ¥çš„ä¸€èµ·æŠ¢é”ï¼Œä½†æ˜¯å¤§æ¦‚ç‡å¤±è´¥ã€‚ #2ã€é¥¥é¥¿æ¨¡å¼ï¼šè‚¯å®šæ‹¿åˆ°é”ï¼Œä¹Ÿå°±æ˜¯åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œé”ä¼šä¼˜å…ˆé€‰æ‹©é˜Ÿåˆ—ä¸­çš„goroutineï¼Œå¯¹åº”çš„é€€å‡ºé¥¥é¥¿æ¨¡å¼ï¼Œè¦ä¹ˆé˜Ÿåˆ—ä¸­åªå‰©ä¸‹ä¸€ä¸ªgoroutineï¼Œè¦ä¹ˆ G2 çš„ç­‰å¾…æ—¶é—´å°äº 1ms<br>","like_count":0},{"had_liked":false,"id":351185,"user_name":"æ–¹å¯¸","can_delete":false,"product_type":"c1","uid":1686496,"ip_address":"","ucode":"FABF9235F9DF3C","user_header":"https://static001.geekbang.org/account/avatar/00/19/bb/e0/72d9448e.jpg","comment_is_top":false,"comment_ctime":1657596906,"is_pvip":false,"replies":[{"id":"127841","content":"Mutexå¯ä»¥ç›´æ¥ä½¿ç”¨é›¶å€¼","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1066613","ctime":1657861362,"ip_address":"","comment_id":351185,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1657596906","product_id":100061801,"comment_content":"é¢˜å¤–è¯ï¼Œ åé¢ä¸¤ä¸ªä¾‹å­ä¸åˆ›å»ºå®ä¾‹ï¼Œ æ˜¯å¯ä»¥å®šä¹‰çš„æ—¶å€™ï¼Œ ä¼šé»˜è®¤å®ä¾‹å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580074,"discussion_content":"Mutexå¯ä»¥ç›´æ¥ä½¿ç”¨é›¶å€¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657861363,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":333713,"user_name":"å´åŒå­¦","can_delete":false,"product_type":"c1","uid":2279884,"ip_address":"","ucode":"59861F2ECC6243","user_header":"https://static001.geekbang.org/account/avatar/00/22/c9/cc/6df7887e.jpg","comment_is_top":false,"comment_ctime":1644482455,"is_pvip":false,"replies":[{"id":"121904","content":"å› ä¸ºä½ æ²¡æœ‰åˆ›é€ å‡ºæ–°goroutineå’Œwaiterç«äº‰ã€‚<br>æ–°åˆ›å»ºçš„goroutineæŠ¢é”çš„æ—¶å€™ï¼Œé”å¹¶æ²¡æœ‰é‡Šæ”¾ï¼Œæ‰€ä»¥æ–°åˆ›å»ºçš„goroutineåŠ åˆ°waiterä¸­äº†","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1066613","ctime":1644500472,"ip_address":"","comment_id":333713,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1644482455","product_id":100061801,"comment_content":"è€å¸ˆï¼Œä¸æ˜¯è¯´â€œè‹¥æœ‰æ–°goroutineç«äº‰å¤§æ¦‚ç‡æ–°goroutineè·å¾—â€ï¼Œä¸ºä»€ä¹ˆä¸‹è¾¹çš„ä»£ç ï¼Œæ¯æ¬¡éƒ½æ˜¯50ä¸ªæ—§çš„goç¨‹æŠ¢åˆ°é”ä¹‹åï¼Œæ–°çš„goç¨‹æ‰ä¼šæŠ¢åˆ°ã€‚è€Œä¸æ˜¯åœ¨50ä¸ªæ—§çš„goç¨‹æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œè¢«æ¯éš”äº”ç§’åˆ›å»ºçš„100ä¸ªæ–°çš„goç¨‹ç»™æŠ¢æ–­äº†ã€‚å¸Œæœ›è€å¸ˆå¸®å¿™è§£é‡Šä¸€ä¸‹ï¼Œä¸‡åˆ†æ„Ÿè°¢ã€‚<br><br>func main() {<br><br>\tvar mux sync.Mutex<br>\tfor i := 1; i &lt;= 50; i++ {<br>\t\tgo func(i int) {<br>\t\t\tmux.Lock()<br>\t\t\tfmt.Printf(&quot;ç¬¬%dä¸ªgoç¨‹è·å–åˆ°é”ï¼\\n&quot;, i)<br>\t\t\ttime.Sleep(time.Second)<br>\t\t\tmux.Unlock()<br>\t\t}(i)<br>\t\ttime.Sleep(time.Millisecond)<br>\t\tfmt.Printf(&quot;ç¬¬%dä¸ªgoç¨‹å‡†å¤‡å°±ä½\\n&quot;, i)<br>\t}<br><br>\t&#47;&#47; ç¡ä¸¤ç§’ç¡®ä¿ä¸Šè¿°50ä¸ªgoç¨‹å‡å¤„äºé˜»å¡çŠ¶æ€<br>\ttime.Sleep(time.Second * 2)<br><br>\t&#47;&#47; ç›‘å¬goç¨‹æ•°é‡<br>\tgo func() {<br>\t\tfor i := 0; i &lt; 1000; i++ {<br>\t\t\tfmt.Println(&quot;æ­¤æ—¶goç¨‹çš„æ•°é‡æ˜¯:&quot;, runtime.NumGoroutine())<br>\t\t\ttime.Sleep(time.Second)<br>\t\t}<br>\t}()<br><br>\t&#47;&#47; æ¯éš”äº”ç§’åˆ›å»º100ä¸ªæ–°çš„goç¨‹ï¼ŒåŒæ ·æ— æ³•æ¨¡æ‹Ÿæ–°çš„goç¨‹ä¼šæ¯”ä¹‹å‰50ä¸ªgoç¨‹ä¼˜å…ˆæŠ¢åˆ°é”<br>\tfor {<br>\t\tfor i := 0; i &lt; 100; i++ {<br>\t\t\tgo func() {<br>\t\t\t\tmux.Lock()<br>\t\t\t\tfmt.Println(&quot;æ–°goç¨‹è·å–åˆ°é”ï¼&quot;)<br>\t\t\t\tmux.Unlock()<br>\t\t\t}()<br>\t\t}<br>\t\ttime.Sleep(time.Second * 5)<br>\t}<br>}<br>","like_count":0,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550378,"discussion_content":"å› ä¸ºä½ æ²¡æœ‰åˆ›é€ å‡ºæ–°goroutineå’Œwaiterç«äº‰ã€‚\næ–°åˆ›å»ºçš„goroutineæŠ¢é”çš„æ—¶å€™ï¼Œé”å¹¶æ²¡æœ‰é‡Šæ”¾ï¼Œæ‰€ä»¥æ–°åˆ›å»ºçš„goroutineåŠ åˆ°waiterä¸­äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644500472,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2279884,"avatar":"https://static001.geekbang.org/account/avatar/00/22/c9/cc/6df7887e.jpg","nickname":"å´åŒå­¦","note":"","ucode":"59861F2ECC6243","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":550380,"discussion_content":"æ„Ÿè°¢è€å¸ˆçš„å›å¤ï¼Œæˆ‘å†ç†è§£ç†è§£ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644500751,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":550378,"ip_address":""},"score":550380,"extra":""}]}]},{"had_liked":false,"id":325424,"user_name":"åœ†åœ†åœ†","can_delete":false,"product_type":"c1","uid":1628994,"ip_address":"","ucode":"05A87DB5CC777F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/ajNVdqHZLLAQBkjIMjPDc3f7AibTeCd8ibJUhRnCdAo2ETicK21HWGDxXgD6rw76cMkmGsObIHt5rpFrS69GicwwRA/132","comment_is_top":false,"comment_ctime":1638954331,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638954331","product_id":100061801,"comment_content":"å¯¹â€œå¾—åˆ°è®¡æ•°å™¨çš„å€¼ï¼Œä¹Ÿéœ€è¦é”ä¿æŠ¤â€ä¹Ÿæ˜¯éšè”½çš„å‘ã€‚è¿™æ ·åšæœ‰ä¸¤ä¸ªåŸå› ï¼š<br>1. é˜²æ­¢æ­¤æ“ä½œæ”¾åœ¨å…¶ä»–ä¸´ç•ŒåŒºæ“ä½œä¸­ã€‚å› ä¸ºMutexæ˜¯ä¸å¯é‡å…¥çš„ï¼ˆåŠä¸èƒ½è¢«ä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è·å–ï¼‰ï¼Œæ‰€ä»¥åœ¨å…¶ä»–ä¸´ç•ŒåŒºä¸­ä½¿ç”¨ä¼šç›´æ¥æŠ¥é”™ã€‚<br>2. è·å¾—æ­£ç¡®çš„å€¼ã€‚å› ä¸ºç°ä»£è®¡ç®—æœºCPUå­˜åœ¨è‡ªå·±çš„ç¼“å­˜åªæœ‰åœ¨å¿…è¦æ—¶æ‰ä¼šåˆ·å›è‡³å†…å­˜ï¼Œæ‰€ä»¥å†…å­˜ä¸­çš„å€¼å¯èƒ½æ˜¯é”™è¯¯çš„ã€‚è°ƒç”¨Mutexæ—¶CPUçš„å†™æ“ä½œç¼“å­˜ä¼šåˆ·å›è‡³å†…å­˜ï¼Œè¿™æ ·è·å–çš„å€¼æ‰æ˜¯äº‰å–çš„å€¼ã€‚","like_count":0},{"had_liked":false,"id":319351,"user_name":"å…š","can_delete":false,"product_type":"c1","uid":1071974,"ip_address":"","ucode":"EE531DB3EA124D","user_header":"https://static001.geekbang.org/account/avatar/00/10/5b/66/ad35bc68.jpg","comment_is_top":false,"comment_ctime":1635755466,"is_pvip":false,"replies":[{"id":"118828","content":"-race -d=checkptr=0","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1066613","ctime":1639807536,"ip_address":"","comment_id":319351,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1635755466","product_id":100061801,"comment_content":"å†ç”¨boltDbæ•°æ®åº“æ—¶å€™ åŠ ä¸Š-raceå°±ä¼šæŠ¥é”™ fatal error: checkptr: converted pointer straddles multiple allocations å»æ‰å°±ä¸æŠ¥é”™äº†ï¼Œä»£ç é‡Œåªæœ‰ä¸€å¥åˆ›å»ºè¡¨ï¼ŒæŠ¥çš„è¿™ä¸ªé”™ä¹Ÿä¸æ˜¯ data raceé”™ æ˜¯æŒ‡é’ˆè½¬æ¢é—®é¢˜ å’‹å¼„å•Š","like_count":0,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539704,"discussion_content":"-race -d=checkptr=0","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639807536,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":311656,"user_name":"BROOKS","can_delete":false,"product_type":"c1","uid":1219678,"ip_address":"","ucode":"3CFC431DDABA3B","user_header":"https://static001.geekbang.org/account/avatar/00/12/9c/5e/80bbb02c.jpg","comment_is_top":false,"comment_ctime":1631368635,"is_pvip":true,"replies":[{"id":"112935","content":"åœ¨ä¸€ä¸ªcpuä¸Šçš„å†™ä¸ä¸€å®šåŠæ—¶çš„åŒæ­¥åˆ°å¦ä¸€ä¸ªcpuæ ¸.amd64çš„å¯èƒ½æ²¡é—®é¢˜ï¼Œarmå°±ä¸ä¸€å®šäº†ã€‚çœ‹goå†…å­˜æ¨¡å‹","user_name":"ä½œè€…å›å¤","user_name_real":"é¸Ÿçª","uid":"1066613","ctime":1631434936,"ip_address":"","comment_id":311656,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1631368635","product_id":100061801,"comment_content":"&gt; å¾—åˆ°è®¡æ•°å™¨çš„å€¼ï¼Œä¹Ÿéœ€è¦é”ä¿æŠ¤<br><br>ä¸ªäººè®¤ä¸º Count() æ–¹æ³•ä¸éœ€è¦åŠ é”ï¼Œè¯·é—® Count() æ–¹æ³•åŠ é”çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526692,"discussion_content":"åœ¨ä¸€ä¸ªcpuä¸Šçš„å†™ä¸ä¸€å®šåŠæ—¶çš„åŒæ­¥åˆ°å¦ä¸€ä¸ªcpuæ ¸.amd64çš„å¯èƒ½æ²¡é—®é¢˜ï¼Œarmå°±ä¸ä¸€å®šäº†ã€‚çœ‹goå†…å­˜æ¨¡å‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631434936,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1219678,"avatar":"https://static001.geekbang.org/account/avatar/00/12/9c/5e/80bbb02c.jpg","nickname":"BROOKS","note":"","ucode":"3CFC431DDABA3B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393443,"discussion_content":"åŸæ¥å¦‚æ­¤ï¼Œæ„Ÿè°¢è§£æƒ‘ï¼Œæˆ‘å»æŸ¥æŸ¥å†…å­˜æ¨¡å‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631435173,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":310213,"user_name":"å…š","can_delete":false,"product_type":"c1","uid":1071974,"ip_address":"","ucode":"EE531DB3EA124D","user_header":"https://static001.geekbang.org/account/avatar/00/10/5b/66/ad35bc68.jpg","comment_is_top":false,"comment_ctime":1630550101,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630550101","product_id":100061801,"comment_content":"åœ¨ç”¨-raceçš„æ—¶å€™ å¦‚ä½•è®©æŸä¸ªåŒ…æˆ–è€….goæ–‡ä»¶ç¦æ­¢raceæ£€æŸ¥ å¼•ç”¨å¤–æ¥çš„åŒ…ä½¿ç”¨raceå°±panic ç°åœ¨åªèƒ½ç¦æ­¢æ£€æŸ¥äº†","like_count":0},{"had_liked":false,"id":310209,"user_name":"å…š","can_delete":false,"product_type":"c1","uid":1071974,"ip_address":"","ucode":"EE531DB3EA124D","user_header":"https://static001.geekbang.org/account/avatar/00/10/5b/66/ad35bc68.jpg","comment_is_top":false,"comment_ctime":1630549251,"is_pvip":false,"replies":[{"id":"112416","content":"çœ‹çœ‹æ˜¯ä¸æ˜¯ä½ æ•°æ®æœ‰å¹¶å‘çš„é—®é¢˜ï¼Ÿå¦‚æœç¡®å®šä¸æ˜¯ï¼Œé‚£å°±æ˜¯boltçš„bugäº†ï¼Œä¸è¿‡å¯èƒ½æ€§æ¯”è¾ƒå°","user_name":"ä½œè€…å›å¤","user_name_real":"é¸Ÿçª","uid":"1066613","ctime":1630589560,"ip_address":"","comment_id":310209,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1630549251","product_id":100061801,"comment_content":"ç”¨äº†ä¸€ä¸ªå†…å­˜åº“ github.com&#47;boltdb&#47;boltï¼Œåœ¨ç”¨-race è¿è¡Œçš„æ—¶å€™ï¼Œé‡Œè¾¹ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™æŠ¥é”™ panicç±»å‹çš„ï¼Œfatal error: checkptr: converted pointer straddles multiple allocations å…³é”®çš„ä¸¤è¡ŒæŠ¥é”™  <br>D:&#47;GO&#47;src&#47;runtime&#47;checkptr.go:20 +0xc9 fp=0xc00029f9e8 sp=0xc00029f9b8 p<br>c=0x554b89<br>github.com&#47;boltdb&#47;bolt.(*freelist).write(0xc0004e5290, 0xc000508000, 0xc00050800<br>0, 0x0)<br>ç™¾åº¦ä¸å‡ºæ¥æ‰€ä»¥ç„¶ è€å¸ˆè¿™ä¸œè¥¿ä¸ºå•¥æŠ¥é”™å•Š ä¸å¸¦raceè¿è¡Œå¥½å¥½çš„","like_count":0,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526160,"discussion_content":"çœ‹çœ‹æ˜¯ä¸æ˜¯ä½ æ•°æ®æœ‰å¹¶å‘çš„é—®é¢˜ï¼Ÿå¦‚æœç¡®å®šä¸æ˜¯ï¼Œé‚£å°±æ˜¯boltçš„bugäº†ï¼Œä¸è¿‡å¯èƒ½æ€§æ¯”è¾ƒå°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630589560,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":307812,"user_name":"thomas","can_delete":false,"product_type":"c1","uid":1016777,"ip_address":"","ucode":"9AB945308F1B50","user_header":"https://static001.geekbang.org/account/avatar/00/0f/83/c9/5d03981a.jpg","comment_is_top":false,"comment_ctime":1629267087,"is_pvip":true,"replies":[{"id":"112417","content":"ä¸åŒçš„æ¶æ„ä¸åŒçš„goç‰ˆæœ¬å¯èƒ½ä¼šä¸ä¸€æ ·","user_name":"ä½œè€…å›å¤","user_name_real":"é¸Ÿçª","uid":"1066613","ctime":1630589725,"ip_address":"","comment_id":307812,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1629267087","product_id":100061801,"comment_content":"<br> &#47;&#47; count++æ“ä½œçš„æ±‡ç¼–ä»£ç <br>    MOVQ    &quot;&quot;.count(SB), AX<br>    LEAQ    1(AX), CX<br>    MOVQ    CX, &quot;&quot;.count(SB)<br>============================<br>count++çš„æ±‡ç¼–ç ä¸ºä»€ä¹ˆå’Œæˆ‘go tool compileæŸ¥çœ‹çš„ä¸åŒå‘€ï¼Ÿ<br><br>MOVQ    &quot;&quot;.&amp;count+8(SP), AX<br>INCQ    (AX)","like_count":0,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525299,"discussion_content":"ä¸åŒçš„æ¶æ„ä¸åŒçš„goç‰ˆæœ¬å¯èƒ½ä¼šä¸ä¸€æ ·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630589725,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":302615,"user_name":"Stony.ä¿®è¡Œåƒ§","can_delete":false,"product_type":"c1","uid":1061277,"ip_address":"","ucode":"0F2368F7D93E4A","user_header":"https://static001.geekbang.org/account/avatar/00/10/31/9d/daad92d2.jpg","comment_is_top":false,"comment_ctime":1626294128,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1626294128","product_id":100061801,"comment_content":"æœ‰æ—¶è§‰å¾—var çœŸçš„æœ‰ç‚¹å¤šä½™ï¼å—python å½±å“","like_count":0},{"had_liked":false,"id":302614,"user_name":"Stony.ä¿®è¡Œåƒ§","can_delete":false,"product_type":"c1","uid":1061277,"ip_address":"","ucode":"0F2368F7D93E4A","user_header":"https://static001.geekbang.org/account/avatar/00/10/31/9d/daad92d2.jpg","comment_is_top":false,"comment_ctime":1626293318,"is_pvip":false,"replies":[{"id":"109604","content":"ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»","user_name":"ä½œè€…å›å¤","user_name_real":"é¸Ÿçª","uid":"1066613","ctime":1626437357,"ip_address":"","comment_id":302614,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1626293318","product_id":100061801,"comment_content":"äºŒæ¶® èµ°å»ï¼Œçªç„¶å‘ç°å¯¹goè¶Šå‘ç€è¿·","like_count":0,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523364,"discussion_content":"ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626437357,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":292976,"user_name":"ç ´ä»‘","can_delete":false,"product_type":"c1","uid":1032931,"ip_address":"","ucode":"3ED8194870FAED","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c2/e3/ce404215.jpg","comment_is_top":false,"comment_ctime":1621136481,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1621136481","product_id":100061801,"comment_content":"æœ€åè´´çš„å…³äº Docker çš„ issue ä¸é”™ã€‚","like_count":0},{"had_liked":false,"id":281864,"user_name":"Only Once","can_delete":false,"product_type":"c1","uid":1333577,"ip_address":"","ucode":"5E98DDCB2FEAF7","user_header":"https://static001.geekbang.org/account/avatar/00/14/59/49/3299e908.jpg","comment_is_top":false,"comment_ctime":1614929338,"is_pvip":false,"replies":[{"id":"102326","content":"è¿™åªæ˜¯ä¸ºäº†è®²è§£nytexä»£ç é£æ ¼çš„é—®é¢˜","user_name":"ä½œè€…å›å¤","user_name_real":"é¸Ÿçª","uid":"1066613","ctime":1614946911,"ip_address":"","comment_id":281864,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1614929338","product_id":100061801,"comment_content":"type Counter struct å½“ä¸­çš„â€œCounterType int å’ŒName stringâ€è²Œä¼¼å¹¶æ²¡æœ‰è¢«å¼•ç”¨å•Šï¼Œå»æ‰ä¹Ÿèƒ½è¿è¡Œï¼›å°ç™½ä¸€ä¸ªï¼Œè¯·è€å¸ˆèµæ•™","like_count":0,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":516537,"discussion_content":"è¿™åªæ˜¯ä¸ºäº†è®²è§£nytexä»£ç é£æ ¼çš„é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614946911,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":279449,"user_name":"14","can_delete":false,"product_type":"c1","uid":2057516,"ip_address":"","ucode":"67EB974A0842C3","user_header":"","comment_is_top":false,"comment_ctime":1613789637,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1613789637","product_id":100061801,"comment_content":"èƒ½ä¸èƒ½æ¨æ¨èå‡ ä¸ªä¼˜ç§€çš„å¼€æºé¡¹ç›®å·¥ç¨‹ï¼Œçœ‹ç€ä»£ç å­¦ä¹ æ•ˆæœä¼šæ›´å¥½ã€‚","like_count":0,"discussions":[{"author":{"id":1751496,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/b9/c8/4c0cc367.jpg","nickname":"è¨€å·±","note":"","ucode":"FDD2A90EFA3B5A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578567,"discussion_content":"å¯ä»¥å…ˆçœ‹è¿™ä¸ª https://github.com/panjf2000/ants ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656902759,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":276309,"user_name":"åšé›…å¤§å…¬","can_delete":false,"product_type":"c1","uid":2231434,"ip_address":"","ucode":"B29962B01736E4","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep82iaEB1iaiaNrFr1SWXkmmlPMoOprgwhMDt9yILo7raCGDmuv3Gl7vgB5a1Euices12Loj8ko4U3nJQ/132","comment_is_top":false,"comment_ctime":1611883340,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1611883340","product_id":100061801,"comment_content":"å•Šï¼è¿™ä¸ªå£°éŸ³çˆ±äº†","like_count":0,"discussions":[{"author":{"id":1751496,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/b9/c8/4c0cc367.jpg","nickname":"è¨€å·±","note":"","ucode":"FDD2A90EFA3B5A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573092,"discussion_content":"https://github.com/panjf2000/ants","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653203237,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":273169,"user_name":"å¤§æ¯›","can_delete":false,"product_type":"c1","uid":1899599,"ip_address":"","ucode":"93B18287F06706","user_header":"https://static001.geekbang.org/account/avatar/00/1c/fc/4f/0a452c94.jpg","comment_is_top":false,"comment_ctime":1610462940,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1610462940","product_id":100061801,"comment_content":"1ã€å¹¶å‘æºäºæ˜¯ä¸ºäº†å¤„ç†å¹¶å‘é—®é¢˜ï¼Œå¯¹äºå¹¶å‘æ¥è¯´ï¼Œæœ€é‡è¦çš„äº‹æƒ…å°±æ˜¯å¦‚ä½•å¤„ç†å¹¶å‘å¸¦æ¥çš„å‰¯ä½œç”¨ï¼šèµ„æºäº‰æŠ¢ã€å¹¶å‘é¡ºåºæµç¨‹çš„è°ƒåº¦ã€å¹¶å‘ä¹‹é—´çš„æ¶ˆæ¯ä¼ é€’ã€‚<br>2ã€è¿è¡Œä»£ç æ˜¯åŠ ä¸Š -race å‚æ•°å¯ä»¥ä½¿ç”¨ç›¸å…³å·¥å…·æ£€æµ‹èµ„æºäº‰æŠ¢çš„é—®é¢˜ã€‚<br>3ã€Mutexæ˜¯æœ€å¸¸è§çš„è§£å†³å¹¶å‘é—®é¢˜çš„å·¥å…·ï¼Œå³åŠ é”","like_count":0},{"had_liked":false,"id":270751,"user_name":"æä½³å’Œ","can_delete":false,"product_type":"c1","uid":2338857,"ip_address":"","ucode":"ADEF96C565BA12","user_header":"https://static001.geekbang.org/account/avatar/00/23/b0/29/0f21e388.jpg","comment_is_top":false,"comment_ctime":1609237007,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609237007","product_id":100061801,"comment_content":"go run -race xx.go  è¿è¡Œæ—¶æ£€æµ‹æ˜¯å¦æœ‰æ•°æ®ç«äº‰é—®é¢˜","like_count":0},{"had_liked":false,"id":269135,"user_name":"DukeAnn","can_delete":false,"product_type":"c1","uid":1298323,"ip_address":"","ucode":"F018FF60F29844","user_header":"https://static001.geekbang.org/account/avatar/00/13/cf/93/d31d1938.jpg","comment_is_top":false,"comment_ctime":1608535802,"is_pvip":false,"replies":[{"id":"97621","content":"å¦‚æœæ²¡æœ‰scopeçš„è€ƒè™‘ï¼Œæ˜¯","user_name":"ä½œè€…å›å¤","user_name_real":"é¸Ÿçª","uid":"1066613","ctime":1608549136,"ip_address":"","comment_id":269135,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1608535802","product_id":100061801,"comment_content":"é€€å‡ºé”æ˜¯ä¸æ˜¯ç”¨ defer æ›´å¥½äº›","like_count":0,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":512162,"discussion_content":"å¦‚æœæ²¡æœ‰scopeçš„è€ƒè™‘ï¼Œæ˜¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608549136,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2621412,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ff/e4/927547a9.jpg","nickname":"æ— åæ— å§“","note":"","ucode":"487BD5AA2CD305","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":402186,"discussion_content":"scopeæŒ‡çš„æ˜¯ä»€ä¹ˆï¼Ÿ\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633827722,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":266575,"user_name":"æ¨åš","can_delete":false,"product_type":"c1","uid":1862696,"ip_address":"","ucode":"B517B7FD3B6844","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/envP83iagHrA26valEtorcbw2tTIKAeepUmp1JbW4oaz69gaDgqXNjxwqVGJkbQ1YwkT88Uicnia9NYYuVVMg7n0Q/132","comment_is_top":false,"comment_ctime":1607397997,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607397997","product_id":100061801,"comment_content":"æˆ‘è§‰å¾—æœ€åçš„é—®é¢˜ä¼šä¸ä¼šæ˜¯åƒjavaä¸­çš„aqsè·å–èµ„æºçš„åç¨‹ç»„æˆfifoé˜Ÿåˆ—","like_count":0},{"had_liked":false,"id":265818,"user_name":"å…š","can_delete":false,"product_type":"c1","uid":1071974,"ip_address":"","ucode":"EE531DB3EA124D","user_header":"https://static001.geekbang.org/account/avatar/00/10/5b/66/ad35bc68.jpg","comment_is_top":false,"comment_ctime":1607043281,"is_pvip":false,"replies":[{"id":"96621","content":"No,å¹¶å‘è¯»å†™è¿™ä¸ªmapæœ‰raceé—®é¢˜","user_name":"ä½œè€…å›å¤","user_name_real":"é¸Ÿçª","uid":"1066613","ctime":1607069310,"ip_address":"","comment_id":265818,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1607043281","product_id":100061801,"comment_content":"æˆ‘æƒ³åšä¸€ä¸ªæ•°æ®ä»“åº“ï¼Œç”¨mapç»“æ„ï¼Œæ¯ä¸ªkeyå€¼æ˜¯å”¯ä¸€é”®ï¼Œæ¯ä¸ªvalueæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œä¿å­˜å…·ä½“æ•°æ®ï¼Œç»“æ„ä½“é‡ŒåŠ ä¸Šé”ä¿è¯æ•°æ®å¹¶å‘å®‰å…¨ï¼Œé‚£è¿™ä¸ªæ•´ä½“çš„mapç»“æ„å¯ä»¥ä¸åŠ é”å§ï¼Œå°±ç®—å¹¶å‘çš„å¢åˆ æŸ¥ï¼Œå¯¹äºåŒä¸€ä¸ªkeyå¯¹åº”çš„ç»“æ„ä½“éƒ½å¯ä»¥ä¿è¯å®Œå…¨æ‰§è¡Œå§ã€‚","like_count":0,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511058,"discussion_content":"No,å¹¶å‘è¯»å†™è¿™ä¸ªmapæœ‰raceé—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607069310,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":261306,"user_name":"æœªå®šä¹‰ä¸¶","can_delete":false,"product_type":"c1","uid":2079901,"ip_address":"","ucode":"66426D32DE20E4","user_header":"https://static001.geekbang.org/account/avatar/00/1f/bc/9d/eaba20ca.jpg","comment_is_top":false,"comment_ctime":1605263954,"is_pvip":false,"replies":[{"id":"94852","content":"ä¸ä¼šï¼Œé™¤éæ²¡äººæä¾›æ­£ç¡®çš„ç­”æ¡ˆï¼Œå®é™…ä¸Šå¾ˆå¤šè¯»è€…éƒ½ç»™å‡ºæ¥å¾ˆå¥½çš„ç­”æ¡ˆã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é¸Ÿçª","uid":"1066613","ctime":1605319266,"ip_address":"","comment_id":261306,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1605263954","product_id":100061801,"comment_content":"ä½œè€…å¤§å¤§ä¼šè§£ç­”æœ€åçš„é¢˜ç›®å—?","like_count":0,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":509445,"discussion_content":"ä¸ä¼šï¼Œé™¤éæ²¡äººæä¾›æ­£ç¡®çš„ç­”æ¡ˆï¼Œå®é™…ä¸Šå¾ˆå¤šè¯»è€…éƒ½ç»™å‡ºæ¥å¾ˆå¥½çš„ç­”æ¡ˆã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605319266,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":255057,"user_name":"Bug Killer","can_delete":false,"product_type":"c1","uid":1186089,"ip_address":"","ucode":"2741A206F504E1","user_header":"https://static001.geekbang.org/account/avatar/00/12/19/29/4a8214b7.jpg","comment_is_top":false,"comment_ctime":1603260805,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1603260805","product_id":100061801,"comment_content":"Counter  ä¸­çš„ CounterType å’ŒName å±æ€§ä¸ºå•¥é¦–å­—æ¯è¦å¤§å†™ï¼Œæ˜¯æœ‰å•¥ç‰¹æ®Šæ„ä¹‰å—","like_count":0,"discussions":[{"author":{"id":2255111,"avatar":"","nickname":"Geek_b9ee84","note":"","ucode":"C49A0A7228B5C3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":315416,"discussion_content":"Goä¸­é¦–å­—æ¯å¤§å†™æ‰æ˜¯åŒ…å¤–å¯è§çš„","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1603272135,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1862696,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/envP83iagHrA26valEtorcbw2tTIKAeepUmp1JbW4oaz69gaDgqXNjxwqVGJkbQ1YwkT88Uicnia9NYYuVVMg7n0Q/132","nickname":"æ¨åš","note":"","ucode":"B517B7FD3B6844","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2255111,"avatar":"","nickname":"Geek_b9ee84","note":"","ucode":"C49A0A7228B5C3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332936,"discussion_content":"bingo","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607398221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":315416,"ip_address":""},"score":332936,"extra":""}]}]},{"had_liked":false,"id":255028,"user_name":"æ‚¦æ‚¦","can_delete":false,"product_type":"c1","uid":1032388,"ip_address":"","ucode":"7D20EFCFC0546C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c0/c4/3f7b5eed.jpg","comment_is_top":false,"comment_ctime":1603253205,"is_pvip":false,"replies":[{"id":"92982","content":"ç›¸å…³çš„ä»£ç åªæœ‰è¢«è§¦å‘ï¼Œå¹¶ä¸”ç¢°å·§æœ‰data raceæ‰èƒ½è¢«æ£€æµ‹å‡ºæ¥","user_name":"ä½œè€…å›å¤","user_name_real":"é¸Ÿçª","uid":"1066613","ctime":1603272764,"ip_address":"","comment_id":255028,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1603253205","product_id":100061801,"comment_content":"åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œåªæœ‰åœ¨è§¦å‘äº† data race ä¹‹åï¼Œæ‰èƒ½æ£€æµ‹åˆ°ï¼Œå¦‚æœç¢°å·§æ²¡æœ‰è§¦å‘ï¼ˆæ¯”å¦‚ä¸€ä¸ª data race é—®é¢˜åªèƒ½åœ¨ 2 æœˆ 14 å·é›¶ç‚¹æˆ–è€… 11 æœˆ 11 å·é›¶ç‚¹æ‰å‡ºç°ï¼‰ï¼Œæ˜¯æ£€æµ‹ä¸å‡ºæ¥çš„ã€‚æˆ‘è¿è¡Œæ—¶ï¼Œå¼€å¯data race     ä¸å¤ªç†è§£ï¼Œ2æœˆ14å·æ˜¯æ£€æŸ¥ä¸å‡ºæ¥ï¼","like_count":0,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":507590,"discussion_content":"ç›¸å…³çš„ä»£ç åªæœ‰è¢«è§¦å‘ï¼Œå¹¶ä¸”ç¢°å·§æœ‰data raceæ‰èƒ½è¢«æ£€æµ‹å‡ºæ¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603272764,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2051563,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/4d/eb/2ee44294.jpg","nickname":"DarkPrince","note":"","ucode":"B1138082EDA3E4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318922,"discussion_content":"æˆ‘ä½¿ç”¨æœ¬åœ°ä»£ç æµ‹è¯•ï¼Œå¥½åƒåªè¦runèµ·æ¥çš„å¸¦æœ‰raceæ¡ä»¶çš„ä»£ç éƒ½èƒ½æ£€æµ‹åˆ°ï¼Œè€å¸ˆèƒ½å¦ç»™æ£€æµ‹ä¸åˆ°ä¸€ä¸ªä¾‹å­å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603882827,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":254765,"user_name":"houseme","can_delete":false,"product_type":"c1","uid":1018209,"ip_address":"","ucode":"888294955B1731","user_header":"https://static001.geekbang.org/account/avatar/00/0f/89/61/e989ee5c.jpg","comment_is_top":false,"comment_ctime":1603183342,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603183342","product_id":100061801,"comment_content":"æ‰“å¡","like_count":0},{"had_liked":false,"id":254326,"user_name":"Panda","can_delete":false,"product_type":"c1","uid":1095740,"ip_address":"","ucode":"911A200C7B18BE","user_header":"https://static001.geekbang.org/account/avatar/00/10/b8/3c/1a294619.jpg","comment_is_top":false,"comment_ctime":1603100853,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603100853","product_id":100061801,"comment_content":"åŒæ—¶æ›´æ–°ç”¨æˆ·çš„è´¦æˆ·ä¿¡æ¯ è¿™ç§åœºæ™¯ å®é™…ç”Ÿäº§ç¯å¢ƒç”¨åˆ†å¸ƒå¼é”æ˜¯ä¸æ˜¯æ›´åˆé€‚ ä¾‹å¦‚ Redis åˆ†å¸ƒå¼é” ZK åˆ†å¸ƒå¼é”","like_count":0},{"had_liked":false,"id":254038,"user_name":"oCupJS","can_delete":false,"product_type":"c1","uid":2244547,"ip_address":"","ucode":"D37DAD8B0FEB50","user_header":"https://static001.geekbang.org/account/avatar/00/22/3f/c3/7431e82e.jpg","comment_is_top":false,"comment_ctime":1603025639,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603025639","product_id":100061801,"comment_content":"æ‰“å¡","like_count":0},{"had_liked":false,"id":253695,"user_name":"æ–°å‘³é“","can_delete":false,"product_type":"c1","uid":2227527,"ip_address":"","ucode":"979E3574082CE7","user_header":"https://static001.geekbang.org/account/avatar/00/21/fd/47/499339d1.jpg","comment_is_top":false,"comment_ctime":1602834356,"is_pvip":false,"replies":[{"id":"92655","content":"åé¢ä¸“é—¨æœ‰ä¸€è®²è®²ä¿¡å·é‡ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é¸Ÿçª","uid":"1066613","ctime":1602840284,"ip_address":"","comment_id":253695,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1602834356","product_id":100061801,"comment_content":"æ²¡æåˆ°åé¢æ–‡ç« è¦ç”¨åˆ°çš„ä¿¡å·é‡ï¼Ÿ  èƒ½å¦ç®€è¦çš„è¯´ä¸‹goé‡Œçš„ä¿¡å·é‡ä½œç”¨ã€‚ ","like_count":0,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":507148,"discussion_content":"åé¢ä¸“é—¨æœ‰ä¸€è®²è®²ä¿¡å·é‡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602840284,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":253357,"user_name":"å¤§åŠ›æ°´æ‰‹","can_delete":false,"product_type":"c1","uid":1367822,"ip_address":"","ucode":"D44F1ABFE4C5C8","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erkCRjibSLNBsK2umhGU2dFy4KUKbZjf7WdibiaL2a0icqvLwC4QskLCCehSnQYLuJsrvT5uVjYSETtMQ/132","comment_is_top":false,"comment_ctime":1602709631,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602709631","product_id":100061801,"comment_content":"æ‰“å¡2","like_count":0},{"had_liked":false,"id":253226,"user_name":"é£æ²‰è¡€","can_delete":false,"product_type":"c1","uid":2025780,"ip_address":"","ucode":"C3122210A5D79D","user_header":"https://static001.geekbang.org/account/avatar/00/1e/e9/34/2eb0c21a.jpg","comment_is_top":false,"comment_ctime":1602656777,"is_pvip":false,"replies":[{"id":"92530","content":"åŠ æ²¹ï¼Œå¸Œæœ›æ¯ä¸€è®²éƒ½çœ‹åˆ°ä½ çš„æ‰“å¡","user_name":"ä½œè€…å›å¤","user_name_real":"é¸Ÿçª","uid":"1066613","ctime":1602667392,"ip_address":"","comment_id":253226,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1602656777","product_id":100061801,"comment_content":"æ‰“å¡ï¼Œå¸Œæœ›è‡ªå·±åšæŒå­¦å®Œ22è®²ï¼ŒåŠ æ²¹ï¼ï¼ï¼","like_count":0,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":507010,"discussion_content":"åŠ æ²¹ï¼Œå¸Œæœ›æ¯ä¸€è®²éƒ½çœ‹åˆ°ä½ çš„æ‰“å¡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602667392,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":253127,"user_name":"æ©™å­888","can_delete":false,"product_type":"c1","uid":1447790,"ip_address":"","ucode":"8FB8A9AAE526E3","user_header":"https://static001.geekbang.org/account/avatar/00/16/17/6e/76b4aa3d.jpg","comment_is_top":false,"comment_ctime":1602605529,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602605529","product_id":100061801,"comment_content":"æ€è€ƒé¢˜ç¬¬ä¸€æ„Ÿè§‰åº”è¯¥æ˜¯è¦ä¿è¯æ¯ä¸ªgoroutineéƒ½å…¬å¹³åœ°å¾—åˆ°æ‰§è¡Œï¼Œä¸èƒ½è®©ä¸ªåˆ«goroutineç­‰å¤ªä¹…ï¼Œçœ‹åˆ°å¤§ä½¬ä»¬çš„ç•™è¨€åï¼Œä»”ç»†ç¢ç£¨äº†è¿™ä¸ªå…·ä½“è¿‡ç¨‹å‘ç°æœçœŸå¦‚æ­¤ã€‚æ–‡ç« ä¸­ä¸€ä¼šå„¿â€œå¹¶å‘åŸè¯­â€ï¼Œä¸€ä¼šå„¿â€œåŒæ­¥åŸè¯­â€çœ‹ç€æœ‰ç‚¹æ™•ã€‚çº¿ä¸Šç¯å¢ƒä¸ºäº†ä¿è¯æ•ˆç‡ä¸åŠ -raceçš„è¯ï¼Œä¹Ÿå°±åªèƒ½ç­‰åˆ°å‘ç°æ•°æ®å¼‚å¸¸äº†é€šè¿‡reviewç›¸å…³ä»£ç æ¥è§£å†³äº†â€¦â€¦","like_count":0},{"had_liked":false,"id":253124,"user_name":"å²æœˆé•¿","can_delete":false,"product_type":"c1","uid":1297213,"ip_address":"","ucode":"CDD7BEC084AC51","user_header":"https://static001.geekbang.org/account/avatar/00/13/cb/3d/b290414d.jpg","comment_is_top":false,"comment_ctime":1602605156,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1602605156","product_id":100061801,"comment_content":"å†…å®¹ä¸é”™ï¼Œè®²è§£ä¹Ÿå¾ˆè¯¦ç»†ï¼Œå¸Œæœ›èƒ½å¤šè®²ä¸€äº›effective goæ²¡æœ‰çš„å†…å®¹","like_count":0},{"had_liked":false,"id":253061,"user_name":"AğŸ˜‡èŠ³î„›","can_delete":false,"product_type":"c1","uid":1931579,"ip_address":"","ucode":"668DBC579E08A5","user_header":"https://static001.geekbang.org/account/avatar/00/1d/79/3b/93e6fc6d.jpg","comment_is_top":false,"comment_ctime":1602581606,"is_pvip":false,"replies":[{"id":"92454","content":"ç¼–è¾‘åŠ æ²¹ï¼Œå¤šæ”¾äº›ã€‚åé¢ä¼šè¶Šæ¥è¶Šç²¾å½©","user_name":"ä½œè€…å›å¤","user_name_real":"é¸Ÿçª","uid":"1066613","ctime":1602590722,"ip_address":"","comment_id":253061,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1602581606","product_id":100061801,"comment_content":"æ›´æ–°å¿«ç‚¹ï¼Œè¯¾ç¨‹éå¸¸å®ç”¨","like_count":0,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506959,"discussion_content":"ç¼–è¾‘åŠ æ²¹ï¼Œå¤šæ”¾äº›ã€‚åé¢ä¼šè¶Šæ¥è¶Šç²¾å½©","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602590722,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1807836,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/95/dc/07195a63.jpg","nickname":"é”‹","note":"","ucode":"F26BC1F14AB0D7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312304,"discussion_content":"ç¾¤å‹ å“ˆå“ˆå“ˆå“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602658875,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":253038,"user_name":"Ethan Liu","can_delete":false,"product_type":"c1","uid":1070043,"ip_address":"","ucode":"231F944F7CD56A","user_header":"https://static001.geekbang.org/account/avatar/00/10/53/db/858337e3.jpg","comment_is_top":false,"comment_ctime":1602574357,"is_pvip":true,"replies":[{"id":"92446","content":"è¯¾ç¨‹ä¸­æœ‰è®²åˆ°ï¼Œrace detectorä¾èµ–è¿è¡Œæ—¶çš„æ£€æµ‹ï¼Œä¸æ˜¯ç¼–è¯‘æœŸæ¢æµ‹çš„","user_name":"ä½œè€…å›å¤","user_name_real":"é¸Ÿçª","uid":"1066613","ctime":1602580600,"ip_address":"","comment_id":253038,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1602574357","product_id":100061801,"comment_content":"å¯ä»¥åœ¨ç¼–è¯‘æœŸæ¢æµ‹data raceå—","like_count":0,"discussions":[{"author":{"id":1066613,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/75/d35c7623.jpg","nickname":"é¸Ÿçª","note":"","ucode":"E49D44F9613F17","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506952,"discussion_content":"è¯¾ç¨‹ä¸­æœ‰è®²åˆ°ï¼Œrace detectorä¾èµ–è¿è¡Œæ—¶çš„æ£€æµ‹ï¼Œä¸æ˜¯ç¼–è¯‘æœŸæ¢æµ‹çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602580600,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"ä¸€æ­¥","note":"","ucode":"73CEA468CE70C3","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312145,"discussion_content":"åªæ˜¯åœ¨ç¼–è¯‘æœŸé—´åŠ äº†ä¸€äº›æŒ‡ä»¤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602595265,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":253036,"user_name":"HACK_QC","can_delete":false,"product_type":"c1","uid":1033363,"ip_address":"","ucode":"623FA185569F9A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c4/93/9dd4b277.jpg","comment_is_top":false,"comment_ctime":1602573843,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602573843","product_id":100061801,"comment_content":"æˆ‘è§‰å¾—ä¸»è¦æ˜¯ä¸¤ç‚¹ï¼š1.æ˜¯å¦æœ‰è‡ªæ—‹çš„goroutineï¼ˆè‡ªæ—‹æƒ…å†µä¸‹æ˜¯å¯ä»¥å‘Šè¯‰mutexä¸ç”¨ç§æ”¾é”çš„ï¼Œç›´æ¥åŠ é”äº†ï¼Œå¯èƒ½ä¼šå¯¼è‡´æŸäº›goroutineç»§ç»­é˜»å¡ç­‰åˆ°ï¼Œå‡ºç°é¥¥é¥¿çŠ¶æ€çš„æƒ…å†µï¼‰ 2.å½“å‰mutexç­‰å¾…é˜Ÿåˆ—çš„çŠ¶æ€çš„æ˜¯å¦ä¸ºé¥¥é¥¿çŠ¶æ€ä¸‹ï¼Œå¦‚æœæ˜¯é‚£å¿…ç„¶æ˜¯ç­‰å¾…æ—¶é—´ç›¸å¯¹æ—¶é—´ä¹…çš„é‚£ä¸€ä¸ªã€‚","like_count":0},{"had_liked":false,"id":252943,"user_name":"RRR","can_delete":false,"product_type":"c1","uid":1014991,"ip_address":"","ucode":"F32A579D201EC5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7c/cf/d5382404.jpg","comment_is_top":false,"comment_ctime":1602525994,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602525994","product_id":100061801,"comment_content":"Java è½¬åˆ° Goï¼Œå¸Œæœ›åé¢èƒ½çœ‹åˆ°æ›´å¤šå…³äºé”çš„çŸ¥è¯†ï¼Œå¦‚æœå¯ä»¥ï¼Œè¿˜å¸Œæœ›å¯¹æ¯”ä¸€ä¸‹ Java å¤šçº¿ç¨‹æ¨¡å¼å’Œ Go å¹¶å‘çš„æ€æƒ³åŒºåˆ«ã€‚","like_count":0}]}