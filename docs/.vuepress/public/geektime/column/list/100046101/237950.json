{"id":237950,"title":"åŠ é¤ | ZABåè®®ï¼ˆä¸‰ï¼‰ï¼šå¦‚ä½•å¤„ç†è¯»å†™è¯·æ±‚ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯éŸ©å¥ï¼</p><p>ä½ åº”è¯¥æœ‰è¿™æ ·çš„ä½“ä¼šï¼Œå¦‚æœä½ æƒ³äº†è§£ä¸€ä¸ªç½‘ç»œæœåŠ¡ï¼Œæ‰§è¡Œçš„ç¬¬ä¸€ä¸ªåŠŸèƒ½è‚¯å®šæ˜¯å†™æ“ä½œï¼Œç„¶åæ‰æ‰§è¡Œè¯»æ“ä½œã€‚æ¯”å¦‚ï¼Œä½ è¦äº†è§£ZooKeeperï¼Œé‚£ä¹ˆè‚¯å®šä¼šåœ¨zkCli.shå‘½ä»¤è¡Œä¸­æ‰§è¡Œå†™æ“ä½œï¼ˆæ¯”å¦‚â€œcreate /geekbang 123â€ï¼‰å†™å…¥æ•°æ®ï¼Œç„¶åå†æ˜¯è¯»æ“ä½œï¼ˆæ¯”å¦‚â€œget /geekbangâ€ï¼‰æŸ¥è¯¢æ•°æ®ã€‚è¿™æ ·ä¸€æ¥ï¼Œä½ æ‰ä¼šç›´è§‚åœ°ç†è§£ZooKeeperæ˜¯å¦‚ä½•ä½¿ç”¨çš„äº†ã€‚</p><p>åœ¨æˆ‘çœ‹æ¥ï¼Œä»»ä½•ç½‘ç»œæœåŠ¡æœ€é‡è¦çš„åŠŸèƒ½å°±æ˜¯å¤„ç†è¯»å†™è¯·æ±‚ï¼Œå› ä¸ºæˆ‘ä»¬è®¿é—®ç½‘ç»œæœåŠ¡æœ¬è´¨ä¸Šéƒ½æ˜¯åœ¨æ‰§è¡Œè¯»å†™æ“ä½œï¼ŒZooKeeperä¹Ÿä¸ä¾‹å¤–ã€‚<strong>è€Œä¸”å¯¹ZooKeeperè€Œè¨€ï¼Œè¿™äº›åŠŸèƒ½æ›´ä¸ºé‡è¦ï¼Œå› ä¸ºåœ¨ZooKeeperä¸­ï¼Œå¦‚ä½•å¤„ç†å†™è¯·æ±‚ï¼Œå…³ä¹ç€æ“ä½œçš„é¡ºåºæ€§ï¼Œè€Œæ“ä½œçš„é¡ºåºæ€§ä¼šå½±å“èŠ‚ç‚¹çš„åˆ›å»ºï¼›å¦‚ä½•å¤„ç†è¯»è¯·æ±‚ï¼Œå…³ä¹ç€ä¸€è‡´æ€§ï¼Œå®ƒä»¬åˆå½±å“ç€å®¢æˆ·ç«¯æ˜¯å¦ä¼šè¯»åˆ°æ—§æ•°æ®ã€‚</strong></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä¼šä»ZooKeeperç³»ç»Ÿçš„è§’åº¦ï¼Œå…¨é¢åœ°åˆ†ææ•´ä¸ªè¯»å†™è¯·æ±‚çš„æµç¨‹ï¼Œå¸®åŠ©ä½ æ›´åŠ å…¨é¢ã€é€å½»åœ°ç†è§£è¯»å†™è¯·æ±‚èƒŒåçš„åŸç†ã€‚</p><p>ä½ è‚¯å®šçŸ¥é“ï¼Œåœ¨ZooKeeperä¸­ï¼Œå†™è¯·æ±‚æ˜¯å¿…é¡»åœ¨é¢†å¯¼è€…ä¸Šå¤„ç†ï¼Œå¦‚æœè·Ÿéšè€…æ¥æ”¶åˆ°äº†å†™è¯·æ±‚ï¼Œå®ƒéœ€è¦å°†å†™è¯·æ±‚è½¬å‘ç»™é¢†å¯¼è€…ï¼Œå½“å†™è¯·æ±‚å¯¹åº”çš„ææ¡ˆè¢«å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šæ—¶ï¼Œé¢†å¯¼è€…ä¼šæäº¤ææ¡ˆï¼Œå¹¶é€šçŸ¥è·Ÿéšè€…æäº¤ææ¡ˆã€‚è€Œè¯»è¯·æ±‚å¯ä»¥åœ¨ä»»ä½•èŠ‚ç‚¹ä¸Šå¤„ç†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒZooKeeperå®ç°çš„æ˜¯æœ€ç»ˆä¸€è‡´æ€§ã€‚</p><!-- [[[read_end]]] --><p>å¯¹ä½ æ¥è¯´ï¼Œç†è§£äº†å¦‚ä½•å¤„ç†è¯»å†™è¯·æ±‚ï¼Œä¸ä»…èƒ½ç†è§£è¯»å†™è¿™ä¸ªæœ€é‡è¦åŠŸèƒ½çš„æ ¸å¿ƒåŸç†ï¼Œè¿˜èƒ½æ›´å¥½åœ°ç†è§£ZooKeeperçš„æ€§èƒ½å’Œä¸€è‡´æ€§ã€‚è¿™æ ·ä¸€æ¥ï¼Œå½“ä½ åœ¨å®é™…åœºæ™¯ä¸­å®‰è£…éƒ¨ç½²ZooKeeperçš„æ—¶å€™ï¼Œå°±èƒ½æ¸¸åˆƒæœ‰ä½™åœ°åšèµ„æºè§„åˆ’äº†ã€‚æ¯”å¦‚ï¼Œå¦‚æœè¯»è¯·æ±‚æ¯”è¾ƒå¤šï¼Œä½ å¯ä»¥å¢åŠ èŠ‚ç‚¹ï¼Œé…ç½®5èŠ‚ç‚¹é›†ç¾¤ï¼Œè€Œä¸æ˜¯å¸¸è§çš„3èŠ‚ç‚¹é›†ç¾¤ã€‚</p><p>è¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬è¿›å…¥ä»Šå¤©çš„å†…å®¹ï¼Œä¸€èµ·æ¢ç©¶ZooKeeperå¤„ç†è¯»å†™è¯·æ±‚çš„èƒŒååŸç†å’Œä»£ç å®ç°ã€‚</p><h2>ZooKeeperå¤„ç†è¯»å†™è¯·æ±‚çš„åŸç†</h2><p>å…¶å®ï¼Œæˆ‘åœ¨<a href=\"https://time.geekbang.org/column/article/229975\">15è®²</a>æ¼”ç¤ºâ€œå¦‚ä½•å®ç°æ“ä½œé¡ºåºæ€§â€æ—¶ï¼Œå°±å·²ç»ä»‹ç»äº†ZooKeeperæ˜¯å¦‚ä½•å¤„ç†è¯»å†™è¯·æ±‚çš„äº†ã€‚æ‰€ä»¥åœ¨è¿™é‡Œæˆ‘å°±ä¸å•°å—¦äº†ï¼Œåªæ˜¯åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå†è¡¥å……å‡ ç‚¹ã€‚</p><p>é¦–å…ˆï¼Œåœ¨ZooKeeperä¸­ï¼Œä¸é¢†å¯¼è€…â€œå¤±è”â€çš„èŠ‚ç‚¹ï¼Œæ˜¯ä¸èƒ½å¤„ç†è¯»å†™è¯·æ±‚çš„ã€‚æ¯”å¦‚ï¼Œå¦‚æœä¸€ä¸ªè·Ÿéšè€…ä¸é¢†å¯¼è€…çš„è¿æ¥å‘ç”Ÿäº†è¯»è¶…æ—¶ï¼Œè®¾ç½®äº†è‡ªå·±çš„çŠ¶æ€ä¸ºLOOKINGï¼Œé‚£ä¹ˆæ­¤æ—¶å®ƒæ—¢ä¸èƒ½è½¬å‘å†™è¯·æ±‚ç»™é¢†å¯¼è€…å¤„ç†ï¼Œä¹Ÿä¸èƒ½å¤„ç†è¯»è¯·æ±‚ï¼Œåªæœ‰å½“å®ƒâ€œæ‰¾åˆ°â€é¢†å¯¼è€…åï¼Œæ‰èƒ½å¤„ç†è¯»å†™è¯·æ±‚ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼šå½“å‘ç”Ÿåˆ†åŒºæ•…éšœäº†ï¼ŒCä¸Aï¼ˆé¢†å¯¼è€…ï¼‰ã€Bç½‘ç»œä¸é€šäº†ï¼Œé‚£ä¹ˆCå°†è®¾ç½®è‡ªå·±çš„çŠ¶æ€ä¸ºLOOKINGï¼Œæ­¤æ—¶åœ¨CèŠ‚ç‚¹ä¸Šæ—¢ä¸èƒ½æ‰§è¡Œè¯»æ“ä½œï¼Œä¹Ÿä¸èƒ½æ‰§è¡Œå†™æ“ä½œã€‚<br>\n<img src=\"https://static001.geekbang.org/resource/image/22/ad/22dfaa624590885c4b8406deb445afad.jpg?wh=1142*456\" alt=\"\"></p><p>å…¶æ¬¡ï¼Œå½“å¤§å¤šæ•°èŠ‚ç‚¹è¿›å…¥åˆ°å¹¿æ’­é˜¶æ®µçš„æ—¶å€™ï¼Œé¢†å¯¼è€…æ‰èƒ½æäº¤ææ¡ˆï¼Œå› ä¸ºææ¡ˆæäº¤ï¼Œéœ€è¦æ¥è‡ªå¤§å¤šæ•°èŠ‚ç‚¹çš„ç¡®è®¤ã€‚</p><p>æœ€åï¼Œå†™è¯·æ±‚åªèƒ½åœ¨é¢†å¯¼è€…èŠ‚ç‚¹ä¸Šå¤„ç†ï¼Œæ‰€ä»¥ZooKeeperé›†ç¾¤å†™æ€§èƒ½çº¦ç­‰äºå•æœºã€‚è€Œè¯»è¯·æ±‚æ˜¯å¯ä»¥åœ¨æ‰€æœ‰çš„èŠ‚ç‚¹ä¸Šå¤„ç†çš„ï¼Œæ‰€ä»¥ï¼Œè¯»æ€§èƒ½æ˜¯èƒ½æ°´å¹³æ‰©å±•çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¯ä»¥é€šè¿‡åˆ†é›†ç¾¤çš„æ–¹å¼æ¥çªç ´å†™æ€§èƒ½çš„é™åˆ¶ï¼Œå¹¶é€šè¿‡å¢åŠ æ›´å¤šèŠ‚ç‚¹ï¼Œæ¥æ‰©å±•é›†ç¾¤çš„è¯»æ€§èƒ½ã€‚</p><p>ç†Ÿæ‚‰äº†ZooKeeperå¤„ç†è¯»å†™è¯·æ±‚çš„è¿‡ç¨‹å’ŒåŸç†åï¼Œç›¸ä¿¡ä½ åº”è¯¥å¥½å¥‡è¿™äº›åŠŸèƒ½åœ¨ZooKeeperä»£ç ä¸­æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p><h2>ZooKeeperä»£ç æ˜¯å¦‚ä½•å®ç°è¯»å†™æ“ä½œçš„å‘¢ï¼Ÿ</h2><h3>å¦‚ä½•å®ç°å†™æ“ä½œï¼Ÿ</h3><p>æˆ‘å…ˆæ¥è¯´ä¸€è¯´å†™æ“ä½œï¼Œåœ¨ZooKeeperä»£ç ä¸­ï¼Œå¤„ç†å†™è¯·æ±‚çš„æ ¸å¿ƒæµç¨‹å°±åƒä¸‹å›¾ä¸€æ ·ï¼ˆä¸ºäº†å¸®ä½ æ›´å¥½çš„ç†è§£è¿™éƒ¨åˆ†å†…å®¹ï¼Œæˆ‘æ¥æ¼”ç¤ºä¸€ä¸‹å¤æ‚çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯è·Ÿéšè€…æ¥æ”¶åˆ°å†™è¯·æ±‚çš„æƒ…å†µï¼‰ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/c7/8a/c77c241713b154673e15083fd063428a.jpg?wh=1142*948\" alt=\"\"></p><p>æ¥ä¸‹æ¥ï¼Œå’±ä»¬ä¸€èµ·èµ°ä¸€éæ ¸å¿ƒä»£ç çš„æµç¨‹ï¼ŒåŠ æ·±ä¸€ä¸‹å°è±¡ã€‚</p><p>1.è·Ÿéšè€…åœ¨FollowerRequestProcessor.processRequest()ä¸­æ¥æ”¶åˆ°å†™è¯·æ±‚ã€‚å…·ä½“æ¥è¯´ï¼Œå†™è¯·æ±‚æ˜¯ç³»ç»Ÿåœ¨ZooKeeperServer.submitRequestNow()ä¸­å‘ç»™è·Ÿéšè€…çš„ã€‚</p><pre><code>firstProcessor.processRequest(si);\n</code></pre><p>è€ŒfirstProcessorï¼Œæ˜¯åœ¨FollowerZooKeeperServer.setupRequestProcessors()ä¸­åˆ›å»ºçš„ã€‚</p><pre><code>protected void setupRequestProcessors() {\n  // åˆ›å»ºfinalProcessorï¼Œæäº¤ææ¡ˆæˆ–å“åº”æŸ¥è¯¢     \n  RequestProcessor finalProcessor = new FinalRequestProcessor(this);\n  // åˆ›å»ºcommitProcessorï¼Œå¤„ç†ææ¡ˆæäº¤æˆ–è¯»è¯·æ±‚\n  commitProcessor = new CommitProcessor(finalProcessor,   Long.toString(getServerId()), true, getZooKeeperServerListener());\n  commitProcessor.start();\n  // åˆ›å»ºfirstProcessorï¼Œæ¥æ”¶å‘ç»™è·Ÿéšè€…çš„è¯·æ±‚\n  firstProcessor = new FollowerRequestProcessor(this, commitProcessor);\n  ((FollowerRequestProcessor) firstProcessor).start();\n  // åˆ›å»ºsyncProcessorï¼Œå°†ææ¡ˆæŒä¹…åŒ–å­˜å‚¨ï¼Œå¹¶è¿”å›ç¡®è®¤å“åº”ç»™é¢†å¯¼è€…\n  syncProcessor = new SyncRequestProcessor(this, new SendAckRequestProcessor(getFollower()));\n  syncProcessor.start();\n}\n</code></pre><p>éœ€è¦ä½ æ³¨æ„çš„æ˜¯ï¼Œè·Ÿéšè€…èŠ‚ç‚¹å’Œé¢†å¯¼è€…èŠ‚ç‚¹çš„firstProcessoræ˜¯ä¸åŒçš„ï¼Œè¿™æ ·å½“firstProcessoråœ¨ZooKeeperServer.submitRequestNow()ä¸­è¢«è°ƒç”¨æ—¶ï¼Œå°±åˆ†åˆ«è¿›å…¥äº†è·Ÿéšè€…å’Œé¢†å¯¼è€…çš„ä»£ç æµç¨‹ã€‚å¦å¤–ï¼ŒsetupRequestProcessors()åˆ›å»ºäº†2æ¡å¤„ç†é“¾ï¼Œå°±åƒä¸‹å›¾çš„æ ·å­ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/d5/e7/d5dfec8e64a2d3cb6f905421d5e918e7.jpg?wh=1142*593\" alt=\"\"></p><p>å…¶ä¸­ï¼Œå¤„ç†é“¾1æ˜¯æ ¸å¿ƒå¤„ç†é“¾ï¼Œæœ€ç»ˆå®ç°äº†ææ¡ˆæäº¤å’Œè¯»è¯·æ±‚å¯¹åº”çš„æ•°æ®å“åº”ã€‚å¤„ç†é“¾2å®ç°äº†ææ¡ˆæŒä¹…åŒ–å­˜å‚¨ï¼Œå¹¶è¿”å›ç¡®è®¤å“åº”ç»™é¢†å¯¼è€…ã€‚</p><p>2.è·Ÿéšè€…åœ¨FollowerRequestProcessor.run()ä¸­å°†å†™è¯·æ±‚è½¬å‘ç»™é¢†å¯¼è€…ã€‚</p><pre><code>// è°ƒç”¨learner.request()å°†è¯·æ±‚å‘é€ç»™é¢†å¯¼è€…\nzks.getFollower().request(request);\n</code></pre><p>3.é¢†å¯¼è€…åœ¨LeaderRequestProcessor.processRequest()ä¸­æ¥æ”¶å†™è¯·æ±‚ï¼Œå¹¶æœ€ç»ˆè°ƒç”¨pRequest()åˆ›å»ºäº‹åŠ¡ï¼ˆä¹Ÿå°±æ˜¯ææ¡ˆï¼‰ï¼Œå¹¶æŒä¹…åŒ–å­˜å‚¨ã€‚</p><pre><code>// åˆ›å»ºäº‹åŠ¡\npRequest2Txn(request.type, zks.getNextZxid(), request, create2Request, true);\n......\n// åˆ†é…äº‹åŠ¡æ ‡è¯†ç¬¦\nrequest.zxid = zks.getZxid();\n// è°ƒç”¨ProposalRequestProcessor.processRequest()å¤„ç†å†™è¯·æ±‚ï¼Œå¹¶å°†äº‹åŠ¡æŒä¹…åŒ–å­˜å‚¨\nnextProcessor.processRequest(request);\n</code></pre><p>åœ¨è¿™é‡Œï¼Œéœ€è¦ä½ æ³¨æ„çš„æ˜¯ï¼Œå†™è¯·æ±‚ä¹Ÿæ˜¯åœ¨ZooKeeperServer.submitRequestNow()ä¸­å‘ç»™é¢†å¯¼è€…çš„ã€‚</p><pre><code>firstProcessor.processRequest(si);\n</code></pre><p>è€ŒfirstProcessorï¼Œæ˜¯åœ¨LeaderZooKeeperServer.setupRequestProcessors()ä¸­åˆ›å»ºçš„ã€‚</p><pre><code>protected void setupRequestProcessors() {\n  // åˆ›å»ºfinalProcessorï¼Œæœ€ç»ˆæäº¤ææ¡ˆå’Œå“åº”æŸ¥è¯¢\n  RequestProcessor finalProcessor = new FinalRequestProcessor(this);\n  // åˆ›å»ºtoBeAppliedProcessorï¼Œå­˜å‚¨å¯æäº¤çš„ææ¡ˆï¼Œå¹¶åœ¨æäº¤ææ¡ˆåï¼Œä»toBeAppliedé˜Ÿåˆ—ç§»é™¤å·²æäº¤çš„\n  RequestProcessor toBeAppliedProcessor = new Leader.ToBeAppliedRequestProcessor(finalProcessor, getLeader());\n  // åˆ›å»ºcommitProcessorï¼Œå¤„ç†ææ¡ˆæäº¤æˆ–è¯»è¯·æ±‚      \n  commitProcessor = new CommitProcessor(toBeAppliedProcessor, Long.toString(getServerId()), false, getZooKeeperServerListener());\n  commitProcessor.start();\n  // åˆ›å»ºproposalProcessorï¼ŒæŒ‰ç…§é¡ºåºå¹¿æ’­ææ¡ˆç»™è·Ÿéšè€…\n  ProposalRequestProcessor proposalProcessor = new ProposalRequestProcessor(this, commitProcessor);\n        proposalProcessor.initialize();\n  // åˆ›å»ºprepRequestProcessorï¼Œæ ¹æ®è¯·æ±‚åˆ›å»ºææ¡ˆ      \n  prepRequestProcessor = new PrepRequestProcessor(this, proposalProcessor);\n  prepRequestProcessor.start();\n  // åˆ›å»ºfirstProcessorï¼Œæ¥æ”¶å‘ç»™é¢†å¯¼è€…çš„è¯·æ±‚\n  firstProcessor = new LeaderRequestProcessor(this, prepRequestProcessor);\n  ......\n}\n</code></pre><p>éœ€è¦ä½ æ³¨æ„çš„æ˜¯ï¼Œä¸è·Ÿéšè€…ç±»ä¼¼ï¼ŒsetupRequestProcessors()ç»™é¢†å¯¼è€…ä¹Ÿåˆ›å»ºäº†2æ¡å¤„ç†é“¾ï¼ˆå…¶ä¸­å¤„ç†é“¾2æ˜¯åœ¨åˆ›å»ºproposalRequestProcessoræ—¶åˆ›å»ºçš„ï¼‰ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f7/83/f780e2d141a766579ba20c3b3d0a2283.jpg?wh=1142*901\" alt=\"\"></p><p>å…¶ä¸­ï¼Œå¤„ç†é“¾1æ˜¯æ ¸å¿ƒå¤„ç†é“¾ï¼Œæœ€ç»ˆå®ç°äº†å†™è¯·æ±‚å¤„ç†ï¼ˆåˆ›å»ºææ¡ˆã€å¹¿æ’­ææ¡ˆã€æäº¤ææ¡ˆï¼‰å’Œè¯»è¯·æ±‚å¯¹åº”çš„æ•°æ®å“åº”ã€‚å¤„ç†é“¾2å®ç°äº†ææ¡ˆæŒä¹…åŒ–å­˜å‚¨ï¼Œå¹¶è¿”å›ç¡®è®¤å“åº”ç»™é¢†å¯¼è€…è‡ªå·±ã€‚</p><p>4.é¢†å¯¼è€…åœ¨ProposalRequestProcessor.processRequest()ä¸­ï¼Œè°ƒç”¨propose()å°†ææ¡ˆå¹¿æ’­ç»™é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹ã€‚</p><pre><code>zks.getLeader().propose(request);\n</code></pre><p>5.è·Ÿéšè€…åœ¨Follower.processPacket()ä¸­æ¥æ”¶åˆ°ææ¡ˆï¼ŒæŒä¹…åŒ–å­˜å‚¨ï¼Œå¹¶è¿”å›ç¡®è®¤å“åº”ç»™é¢†å¯¼è€…ã€‚</p><pre><code>// æ¥æ”¶ã€æŒä¹…åŒ–ã€è¿”å›ç¡®è®¤å“åº”ç»™é¢†å¯¼è€…\nfzk.logRequest(hdr, txn, digest);\n</code></pre><p>6.å½“é¢†å¯¼è€…æ¥æ”¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹çš„ç¡®è®¤å“åº”ï¼ˆLeader.processAck()ï¼‰åï¼Œæœ€ç»ˆåœ¨CommitProcessor.tryToCommit()æäº¤ææ¡ˆï¼Œå¹¶å¹¿æ’­COMMITæ¶ˆæ¯ç»™è·Ÿéšè€…ã€‚</p><pre><code>// é€šçŸ¥è·Ÿéšè€…æäº¤\ncommit(zxid);\n// è‡ªå·±æäº¤\nzk.commitProcessor.commit(p.request);\n</code></pre><p>7.å½“è·Ÿéšè€…æ¥æ”¶åˆ°COMMITæ¶ˆæ¯åï¼Œåœ¨FollowerZooKeeperServer.commit()ä¸­æäº¤ææ¡ˆï¼Œå¦‚æœæœ€åˆçš„å†™è¯·æ±‚æ˜¯è‡ªå·±æ¥æ”¶åˆ°çš„ï¼Œè¿”å›æˆåŠŸå“åº”ç»™å®¢æˆ·ç«¯ã€‚</p><pre><code>// å¿…é¡»é¡ºåºæäº¤\nlong firstElementZxid = pendingTxns.element().zxid;\nif (firstElementZxid != zxid) {\n  LOG.error(&quot;Committing zxid 0x&quot; + Long.toHexString(zxid)\n            + &quot; but next pending txn 0x&quot; + \n            Long.toHexString(firstElementZxid));\n  ServiceUtils.requestSystemExit(ExitCode.UNMATCHED_TXN_COMMIT.getValue());\n}\n// å°†å‡†å¤‡æäº¤çš„ææ¡ˆä»pendingTxnsé˜Ÿåˆ—ç§»é™¤\nRequest request = pendingTxns.remove();\nrequest.logLatency(ServerMetrics.getMetrics().COMMIT_PROPAGATION_LATENCY);\n// æœ€ç»ˆè°ƒç”¨FinalRequestProcessor.processRequest()æäº¤ææ¡ˆï¼Œå¹¶å¦‚æœæœ€åˆçš„å†™è¯·æ±‚æ˜¯è‡ªå·±æ¥æ”¶åˆ°çš„ï¼Œè¿”å›æˆåŠŸå“åº”ç»™å®¢æˆ·ç«¯\ncommitProcessor.commit(request);\n</code></pre><p>è¿™æ ·ï¼ŒZooKeeperå°±å®Œæˆäº†å†™è¯·æ±‚çš„å¤„ç†ã€‚ä½ è¦ç‰¹åˆ«æ³¨æ„ä¸€ä¸‹ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ¶ˆæ¯æˆ–è€…æ ¸å¿ƒä¿¡æ¯çš„æŒä¹…åŒ–å­˜å‚¨å¾ˆå…³é”®ï¼Œä¹Ÿå¾ˆé‡è¦ï¼Œå› ä¸ºè¿™æ˜¯ä¿è¯é›†ç¾¤èƒ½ç¨³å®šè¿è¡Œçš„å…³é”®ã€‚</p><p>å½“ç„¶äº†ï¼Œå†™å…¥æ•°æ®ï¼Œæœ€ç»ˆè¿˜æ˜¯ä¸ºäº†åç»­çš„æ•°æ®è¯»å–ï¼Œé‚£ä¹ˆåœ¨ZooKeeperä¸­ï¼Œæ˜¯å¦‚ä½•å®ç°è¯»æ“ä½œçš„å‘¢ï¼Ÿ</p><h3>å¦‚ä½•å®ç°è¯»æ“ä½œï¼Ÿ</h3><p>ç›¸æ¯”å†™æ“ä½œï¼Œè¯»æ“ä½œçš„å¤„ç†è¦ç®€å•å¾ˆå¤šï¼Œå› ä¸ºæ¥æ”¶åˆ°è¯»è¯·æ±‚çš„èŠ‚ç‚¹ï¼Œåªéœ€è¦æŸ¥è¯¢æœ¬åœ°æ•°æ®ï¼Œç„¶åå“åº”æ•°æ®ç»™å®¢æˆ·ç«¯å°±å¯ä»¥äº†ã€‚è¯»æ“ä½œçš„æ ¸å¿ƒä»£ç æµç¨‹ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f4/6d/f405d2a81f374e6e63b49c469506f26d.jpg?wh=1142*652\" alt=\"\"></p><p>å’±ä»¬ä¸€èµ·èµ°ä¸€éæ ¸å¿ƒä»£ç çš„æµç¨‹ï¼ŒåŠ æ·±ä¸€ä¸‹å°è±¡ã€‚</p><p>1.è·Ÿéšè€…åœ¨FollowerRequestProcessor.processRequest()ä¸­æ¥æ”¶åˆ°è¯»è¯·æ±‚ã€‚</p><p>2.è·Ÿéšè€…åœ¨FinalRequestProcessor.processRequest()ä¸­æŸ¥è¯¢æœ¬åœ°æ•°æ®ï¼Œä¹Ÿå°±æ˜¯dataTreeä¸­çš„æ•°æ®ã€‚</p><pre><code>// å¤„ç†è¯»è¯·æ±‚\ncase OpCode.getData: {\n  ......\n  // æŸ¥è¯¢æœ¬åœ°dataTreeä¸­çš„æ•°æ®\n  rsp = handleGetDataRequest(getDataRequest, cnxn, request.authInfo);\n  ......\n  break;\n}\n</code></pre><p>3.ç„¶åè·Ÿéšè€…å“åº”æŸ¥è¯¢åˆ°æ•°æ®ç»™å®¢æˆ·ç«¯ã€‚</p><pre><code>case OpCode.getData : {\n  ......\n  // å“åº”æŸ¥è¯¢åˆ°çš„æ•°æ®ç»™å®¢æˆ·ç«¯\n  cnxn.sendResponse(hdr, rsp, &quot;response&quot;, path, stat, opCode);\n  break;\n}\n</code></pre><p>ä½ çœ‹ï¼Œè¿™æ ·ZooKeeperå°±å®Œæˆè¯»æ“ä½œçš„å¤„ç†ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘æƒ³è¡¥å……ä¸€ç‚¹ï¼Œä½ å¯ä»¥dataTreeç†è§£ä¸ºRaftçš„çŠ¶æ€æœºï¼Œæäº¤çš„æ•°æ®ï¼Œæœ€ç»ˆå­˜æ”¾åœ¨dataTreeä¸­ã€‚</p><h2>å†…å®¹å°ç»“</h2><p>æœ¬èŠ‚è¯¾æˆ‘ä¸»è¦å¸¦ä½ äº†è§£äº†ZooKeeperå¤„ç†è¯»å†™è¯·æ±‚çš„è¿‡ç¨‹ï¼Œä»¥åŠZooKeeperçš„ä»£ç å®ç°å’Œæ ¸å¿ƒæµç¨‹ã€‚æˆ‘å¸Œæœ›ä½ æ˜ç¡®è¿™æ ·å‡ ä¸ªé‡ç‚¹ã€‚</p><p>1.ä¸é¢†å¯¼è€…â€œå¤±è”â€çš„è·Ÿéšè€…ï¼ˆæ¯”å¦‚å‘ç”Ÿåˆ†åŒºæ•…éšœæ—¶ï¼‰ï¼Œæ˜¯æ—¢ä¸èƒ½å¤„ç†å†™è¯·æ±‚ï¼Œä¹Ÿä¸èƒ½å¤„ç†è¯»è¯·æ±‚çš„ã€‚</p><p>2.åœ¨ZooKeeperä¸­ï¼Œå†™è¯·æ±‚åªèƒ½åœ¨é¢†å¯¼è€…èŠ‚ç‚¹ä¸Šå¤„ç†ï¼Œè¯»è¯·æ±‚å¯ä»¥åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šå¤„ç†ï¼Œå®ç°çš„æ˜¯æœ€ç»ˆä¸€è‡´æ€§ã€‚</p><p>å› ä¸ºæœ¬è®²æ˜¯ZABåè®®çš„æœ€åä¸€è®²ï¼Œä¸ºäº†å¸®ä½ åç»­å­¦ä¹ æœ¬è¯¾ç¨‹æ²¡æœ‰æåˆ°çš„å†…å®¹ï¼Œæˆ‘æƒ³è¡¥å……å‡ ç‚¹ã€‚</p><p>é¦–å…ˆï¼ŒZABçš„æœ¯è¯­ä¼—å¤šï¼Œè€Œä¸”æœ‰äº›æœ¯è¯­è¡¨è¾¾çš„æ˜¯åŒä¸€ä¸ªå«ä¹‰ï¼Œè¿™äº›æœ¯è¯­æœ‰äº›åœ¨æ–‡æ¡£ä¸­å‡ºç°ï¼Œæœ‰äº›åœ¨ä»£ç ä¸­å‡ºç°ã€‚è€Œä½ åªæœ‰å‡†ç¡®ç†è§£æœ¯è¯­ï¼Œæ‰èƒ½æ›´å¥½åœ°ç†è§£ZABåè®®çš„åŸç†ï¼Œæ‰€ä»¥ï¼Œæˆ‘è¡¥å……ä¸€äº›å†…å®¹ã€‚</p><ul>\n<li>ææ¡ˆï¼ˆProposalï¼‰ï¼šè¿›è¡Œå…±è¯†åå•†çš„åŸºæœ¬å•å…ƒï¼Œä½ å¯ä»¥ç†è§£ä¸ºæ“ä½œï¼ˆOperationï¼‰æˆ–æŒ‡ä»¤ï¼ˆCommandï¼‰ï¼Œå¸¸å‡ºç°åœ¨æ–‡æ¡£ä¸­ã€‚</li>\n<li>äº‹åŠ¡ï¼ˆTransactionï¼‰ï¼šä¹Ÿæ˜¯æŒ‡ææ¡ˆï¼Œå¸¸å‡ºç°åœ¨ä»£ç ä¸­ã€‚æ¯”å¦‚ï¼ŒpRequest2Txn()å°†æ¥æ”¶åˆ°çš„è¯·æ±‚è½¬æ¢ä¸ºäº‹åŠ¡ï¼›å†æ¯”å¦‚ï¼Œæœªæäº¤ææ¡ˆä¼šæŒä¹…åŒ–å­˜å‚¨åœ¨äº‹åŠ¡æ—¥å¿—ä¸­ã€‚åœ¨è¿™é‡Œéœ€è¦ä½ æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªæœ¯è¯­å¾ˆå®¹æ˜“å¼•èµ·è¯¯è§£ï¼Œå› ä¸ºå®ƒä¸æ˜¯æŒ‡æ›´å¹¿æ³›è¢«æ¥å—çš„å«ä¹‰ï¼Œå…·æœ‰ACIDç‰¹æ€§çš„æ“ä½œåºåˆ—ã€‚</li>\n</ul><p>å…¶æ¬¡ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼ŒRaftç®—æ³•å’ŒZABåè®®å¾ˆç±»ä¼¼ï¼Œæ¯”å¦‚ä¸»å¤‡æ¨¡å¼ï¼ˆä¹Ÿå°±æ˜¯é¢†å¯¼è€…ã€è·Ÿéšè€…æ¨¡å‹ï¼‰ã€æ—¥å¿—å¿…é¡»æ˜¯è¿ç»­çš„ã€ä»¥é¢†å¯¼è€…çš„æ—¥å¿—ä¸ºå‡†æ¥å®ç°æ—¥å¿—ä¸€è‡´ç­‰ç­‰ã€‚é‚£ä¸ºä»€ä¹ˆå®ƒä»¬ä¼šæ¯”è¾ƒç±»ä¼¼å‘¢ï¼Ÿ</p><p><strong>æˆ‘çš„çœ‹æ³•æ˜¯ï¼Œâ€œè‹±é›„æ‰€è§ç•¥åŒâ€ã€‚</strong>æ¯”å¦‚ZABåè®®è¦å®ç°æ“ä½œçš„é¡ºåºæ€§ï¼Œè€ŒRaftçš„è®¾è®¡ç›®æ ‡ï¼Œä¸ä»…ä»…æ˜¯æ“ä½œçš„é¡ºåºæ€§ï¼Œè€Œæ˜¯çº¿æ€§ä¸€è‡´æ€§ï¼Œè¿™ä¸¤ä¸ªç›®æ ‡ï¼Œéƒ½å†³å®šäº†å®ƒä»¬ä¸èƒ½å…è®¸æ—¥å¿—ä¸è¿ç»­ï¼Œè¦æŒ‰ç…§é¡ºåºæäº¤æ—¥å¿—ï¼Œé‚£ä¹ˆï¼Œå®ƒä»¬å°±è¦é€šè¿‡ä¸Šé¢çš„æ–¹æ³•å®ç°æ—¥å¿—çš„é¡ºåºæ€§ï¼Œå¹¶ä¿è¯è¾¾æˆå…±è¯†ï¼ˆä¹Ÿå°±æ˜¯æäº¤ï¼‰åçš„æ—¥å¿—ä¸ä¼šå†æ”¹å˜ã€‚</p><p>æœ€åï¼Œæˆ‘æƒ³å°±ZABå’ŒRaftåšä¸ªå¯¹æ¯”ï¼Œæ¥å…·ä½“è¯´è¯´ZABå’ŒRaftçš„å¼‚åŒã€‚æ—¢ç„¶æˆ‘ä»¬è¦åšå¯¹æ¯”ï¼Œé‚£ä¹ˆé¦–å…ˆè¦å®šä¹‰å¯¹æ¯”æ ‡å‡†ï¼Œæˆ‘æ˜¯è¿™ä¹ˆè€ƒè™‘çš„ï¼šä½ åº”è¯¥æœ‰è¿™æ ·çš„ä½“ä¼šï¼ŒåŒä¸€ä¸ªåŠŸèƒ½ï¼Œä¸åŒçš„åŒå­¦å®ç°çš„ä»£ç éƒ½ä¼šä¸ä¸€æ ·ï¼ˆæ¯”å¦‚æ•°æ®ç»“æ„ã€ä»£ç é€»è¾‘ï¼‰ï¼Œæ‰€ä»¥è¿‡äºç»†èŠ‚çš„æ¯”è¾ƒï¼Œå°¤å…¶æ˜¯åç³»ç»Ÿå®ç°æ–¹é¢çš„ï¼Œæ„ä¹‰ä¸å¤§ï¼ˆæ¯”å¦‚è·Ÿéšè€…æ˜¯å¦è½¬å‘å†™è¯·æ±‚åˆ°é¢†å¯¼è€…ï¼Œä¸ä»…æ„ä¹‰ä¸å¤§ï¼Œè€Œä¸”è¿™æ˜¯ZABå’ŒRaftéƒ½æ²¡æœ‰çº¦å®šçš„ï¼Œæ˜¯é›†ç¾¤ç³»ç»Ÿéœ€è¦è€ƒè™‘çš„ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ä»æ ¸å¿ƒåŸç†ä¸Šåšå¯¹æ¯”ã€‚</p><ul>\n<li>\n<p>é¢†å¯¼è€…é€‰ä¸¾ï¼šZABé‡‡ç”¨çš„â€œè§è´¤æ€é½ã€ç›¸äº’æ¨èâ€çš„å¿«é€Ÿé¢†å¯¼è€…é€‰ä¸¾ï¼ˆFast Leader Electionï¼‰ï¼ŒRafté‡‡ç”¨çš„æ˜¯â€œä¸€å¼ é€‰ç¥¨ã€å…ˆåˆ°å…ˆå¾—â€çš„è‡ªå®šä¹‰ç®—æ³•ã€‚åœ¨æˆ‘çœ‹æ¥ï¼ŒRaftçš„é¢†å¯¼è€…é€‰ä¸¾ï¼Œéœ€è¦é€šè®¯çš„æ¶ˆæ¯æ•°æ›´å°‘ï¼Œé€‰ä¸¾ä¹Ÿæ›´å¿«ã€‚</p>\n</li>\n<li>\n<p>æ—¥å¿—å¤åˆ¶ï¼šRaftå’ŒZABç›¸åŒï¼Œéƒ½æ˜¯ä»¥é¢†å¯¼è€…çš„æ—¥å¿—ä¸ºå‡†æ¥å®ç°æ—¥å¿—ä¸€è‡´ï¼Œè€Œä¸”æ—¥å¿—å¿…é¡»æ˜¯è¿ç»­çš„ï¼Œä¹Ÿå¿…é¡»æŒ‰ç…§é¡ºåºæäº¤ã€‚</p>\n</li>\n<li>\n<p>è¯»æ“ä½œå’Œä¸€è‡´æ€§ï¼šZABçš„è®¾è®¡ç›®æ ‡æ˜¯æ“ä½œçš„é¡ºåºæ€§ï¼Œåœ¨ZooKeeperä¸­é»˜è®¤å®ç°çš„æ˜¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œè¯»æ“ä½œå¯ä»¥åœ¨ä»»ä½•èŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼›è€ŒRaftçš„è®¾è®¡ç›®æ ‡æ˜¯å¼ºä¸€è‡´æ€§ï¼ˆä¹Ÿå°±æ˜¯çº¿æ€§ä¸€è‡´æ€§ï¼‰ï¼Œæ‰€ä»¥Raftæ›´çµæ´»ï¼ŒRaftç³»ç»Ÿæ—¢å¯ä»¥æä¾›å¼ºä¸€è‡´æ€§ï¼Œä¹Ÿå¯ä»¥æä¾›æœ€ç»ˆä¸€è‡´æ€§ã€‚</p>\n</li>\n<li>\n<p>å†™æ“ä½œï¼šRaftå’ŒZABç›¸åŒï¼Œå†™æ“ä½œéƒ½å¿…é¡»åœ¨é¢†å¯¼è€…èŠ‚ç‚¹ä¸Šå¤„ç†ã€‚</p>\n</li>\n<li>\n<p>æˆå‘˜å˜æ›´ï¼šRaftå’ŒZABéƒ½æ”¯æŒæˆå‘˜å˜æ›´ï¼Œå…¶ä¸­ZABä»¥åŠ¨æ€é…ç½®ï¼ˆdynamic configurationï¼‰çš„æ–¹å¼å®ç°çš„ã€‚é‚£ä¹ˆå½“ä½ åœ¨èŠ‚ç‚¹å˜æ›´æ—¶ï¼Œä¸éœ€è¦é‡å¯æœºå™¨ï¼Œé›†ç¾¤æ˜¯ä¸€ç›´è¿è¡Œçš„ï¼ŒæœåŠ¡ä¹Ÿä¸ä¼šä¸­æ–­ã€‚</p>\n</li>\n<li>\n<p>å…¶ä»–ï¼šç›¸æ¯”ZABï¼ŒRaftçš„è®¾è®¡æ›´ä¸ºç®€æ´ï¼Œæ¯”å¦‚Raftæ²¡æœ‰å¼•å…¥ç±»ä¼¼ZABçš„æˆå‘˜å‘ç°å’Œæ•°æ®åŒæ­¥é˜¶æ®µï¼Œè€Œæ˜¯å½“èŠ‚ç‚¹å‘èµ·é€‰ä¸¾æ—¶ï¼Œé€’å¢ä»»æœŸç¼–å·ï¼Œåœ¨é€‰ä¸¾ç»“æŸåï¼Œå¹¿æ’­å¿ƒè·³ï¼Œç›´æ¥å»ºç«‹é¢†å¯¼è€…å…³ç³»ï¼Œç„¶åå‘å„èŠ‚ç‚¹åŒæ­¥æ—¥å¿—ï¼Œæ¥å®ç°æ•°æ®å‰¯æœ¬çš„ä¸€è‡´æ€§ã€‚<strong>åœ¨æˆ‘çœ‹æ¥ï¼ŒZABçš„æˆå‘˜å‘ç°ï¼Œå¯ä»¥å’Œé¢†å¯¼è€…é€‰ä¸¾åˆåˆ°ä¸€èµ·ï¼Œç±»ä¼¼Raftï¼Œåœ¨é¢†å¯¼è€…é€‰ä¸¾ç»“æŸåï¼Œç›´æ¥å»ºç«‹é¢†å¯¼è€…å…³ç³»ï¼Œè€Œä¸æ˜¯å†å¼•å…¥ä¸€ä¸ªæ–°çš„é˜¶æ®µï¼›æ•°æ®åŒæ­¥é˜¶æ®µï¼Œæ˜¯ä¸€ä¸ªå†—ä½™çš„è®¾è®¡ï¼Œå¯ä»¥å»é™¤çš„ï¼Œå› ä¸ºZABä¸æ˜¯å¿…é¡»è¦å…ˆå®ç°æ•°æ®å‰¯æœ¬çš„ä¸€è‡´æ€§ï¼Œæ‰å¯ä»¥å¤„ç†å†™è¯·æ±‚ï¼Œè€Œä¸”è¿™ä¸ªè®¾è®¡æ˜¯æ²¡æœ‰é¢å¤–çš„æ„ä¹‰å’Œä»·å€¼çš„ã€‚</strong></p>\n</li>\n</ul><p>å¦å¤–ï¼ŒZABå’ŒZooKeeperå¼ºè€¦åˆï¼Œä½ æ— æ³•åœ¨å®é™…ç³»ç»Ÿä¸­ç‹¬ç«‹ä½¿ç”¨ï¼›è€ŒRaftçš„å®ç°ï¼ˆæ¯”å¦‚Hashicorp Raftï¼‰æ˜¯å¯ä»¥ç‹¬ç«‹ä½¿ç”¨çš„ï¼Œç¼–ç¨‹å‹å¥½ã€‚</p><h2>è¯¾å ‚æ€è€ƒ</h2><p>æˆ‘æåˆ°ZooKeeperæä¾›çš„æ˜¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œè¯»æ“ä½œå¯ä»¥åœ¨ä»»ä½•èŠ‚ç‚¹ä¸Šæ‰§è¡Œã€‚é‚£ä¹ˆå¦‚æœè¯»æ“ä½œè®¿é—®çš„æ˜¯å¤‡ä»½èŠ‚ç‚¹ï¼Œä¸ºä»€ä¹ˆæ— æ³•ä¿è¯æ¯æ¬¡éƒ½èƒ½è¯»åˆ°æœ€æ–°çš„æ•°æ®å‘¢ï¼Ÿæ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„çœ‹æ³•ï¼Œä¸æˆ‘ä¸€åŒè®¨è®ºã€‚</p><p>æœ€åï¼Œæ„Ÿè°¢ä½ çš„é˜…è¯»ï¼Œå¦‚æœè¿™èŠ‚è¯¾è®©ä½ æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿæ¬¢è¿ä½ å°†å®ƒåˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ã€‚</p>","comments":[{"had_liked":false,"id":219398,"user_name":"zyz","can_delete":false,"product_type":"c1","uid":1019339,"ip_address":"","ucode":"0092F8C0FFA375","user_header":"","comment_is_top":false,"comment_ctime":1590022354,"is_pvip":false,"replies":[{"id":"81681","content":"åŠ ä¸€é¢—æ˜Ÿ:)","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1590534807,"ip_address":"","comment_id":219398,"utype":1}],"discussion_count":5,"race_medal":0,"score":"31654793426","product_id":100046101,"comment_content":"Zookeeperé€šè¿‡Leaderæ¥ä¸»å¯¼å†™æ“ä½œï¼Œä¿è¯äº†é¡ºåºä¸€è‡´æ€§ã€‚å½“ä¸€åŠä»¥ä¸Šçš„èŠ‚ç‚¹è¿”å›å·²å†™å…¥ï¼Œå°±è¿”å›å®¢æˆ·ç«¯å·²å†™å…¥ï¼Œä½†æ˜¯è¿™æ—¶å€™åªæ˜¯éƒ¨åˆ†èŠ‚ç‚¹å†™å…¥ï¼Œæœ‰çš„èŠ‚ç‚¹å¯èƒ½è¿˜æ²¡æœ‰åŒæ­¥ä¸Šæ•°æ®ï¼Œæ‰€ä»¥è¯»å–å¤‡ä»½èŠ‚ç‚¹å¯èƒ½ä¸æ˜¯æœ€æ–°çš„ã€‚åŒæ—¶Zookeeperçš„å•ä¸€è§†å›¾ç‰¹å¾ï¼Œä¿è¯å®¢æˆ·ç«¯çœ‹åˆ°çš„æ•°æ®ä¸ä¼šæ¯”åœ¨ä¹‹å‰æœåŠ¡å™¨ä¸Šæ‰€çœ‹åˆ°çš„æ›´è€ã€‚","like_count":7,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495797,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590534807,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1123163,"avatar":"https://static001.geekbang.org/account/avatar/00/11/23/5b/983408b9.jpg","nickname":"æ‚Ÿç©ºèŠæ¶æ„","note":"","ucode":"C2F482A0CF8AF1","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557769,"discussion_content":"è¿™é‡Œæœ‰ç‚¹é—®é¢˜å§ï¼Ÿè¿”å›å®¢æˆ·ç«¯ï¼Œè¿™ä¸ªæ—¶å€™å…¶å® æ‰€æœ‰å¤‡ä»½èŠ‚ç‚¹éƒ½æ˜¯æ—§çš„æ•°æ®ï¼Œåªæœ‰ä¸»èŠ‚ç‚¹å‘é€ commit æ¶ˆæ¯åï¼Œå¤‡ä»½èŠ‚ç‚¹æ‰ä¼šè¿›è¡Œ commitï¼Œå°†æ•°æ®å­˜åˆ° znode æ•°æ®ç»“æ„ä¸­ã€‚ä¸æ˜¯è¯´è¿‡åŠåï¼Œé‚£äº›è¿”å› ack çš„å¤‡ä»½èŠ‚ç‚¹å°±å·²ç» commit äº†ï¼Œè€Œæ˜¯éœ€è¦ç­‰åˆ°ä¸»èŠ‚ç‚¹å‘æ‰€æœ‰å¤‡ä»½èŠ‚ç‚¹å‘é€ commit åæ‰ä¼šå°†äº‹åŠ¡æ—¥å¿—ä¸­çš„æ•°æ®å­˜åˆ°å†…å­˜é‡Œé¢ï¼Œè¿™æ ·å®¢æˆ·ç«¯å°±å¯ä»¥è¯»åˆ°æœ€æ–°æ•°æ®äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647958816,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1076487,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIKoEicqUZTJly55qoUXRmK4wia7YbnibsMncJaO6tKgKAQNJRfpMsibvfeiaukIibsCsuaic8QjQ3gOoTGA/132","nickname":"å¼ å¯å¤«æ–¯åŸº","note":"","ucode":"3B8DF6D98583F2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554418,"discussion_content":"åªä»ä¸»èŠ‚ç‚¹è¯»å¯ä»¥è¯»åˆ°æœ€æ–°æ•°æ®å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646370677,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1211429,"avatar":"https://static001.geekbang.org/account/avatar/00/12/7c/25/7d9a2538.jpg","nickname":"èš‚èš","note":"","ucode":"B3FEFB399536DF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":309310,"discussion_content":"è¯·æ•™ä¸€ä¸‹ï¼Œå•ä¸€è§†å›¾æ˜¯ä»€ä¹ˆæ„æ€å•Šï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601256320,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1019339,"avatar":"","nickname":"zyz","note":"","ucode":"0092F8C0FFA375","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1211429,"avatar":"https://static001.geekbang.org/account/avatar/00/12/7c/25/7d9a2538.jpg","nickname":"èš‚èš","note":"","ucode":"B3FEFB399536DF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":309725,"discussion_content":"å½“é›†ç¾¤èŠ‚ç‚¹æ•°æ®æ²¡æœ‰å®Œå…¨åŒæ­¥ï¼Œæœ‰çš„æ˜¯æ–°çš„ï¼Œæœ‰çš„æ˜¯æ—§çš„ã€‚èƒ½è¯»åˆ°æœ€æ–°çš„è‚¯å®šæ²¡æœ‰é—®é¢˜ï¼Œè€Œæ—§èŠ‚ç‚¹æœåŠ¡ä¼šæ‹’ç»å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œé€šè¿‡æ¯”è¾ƒzxidçš„å€¼æ¥åˆ¤æ–­ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601426992,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":309310,"ip_address":""},"score":309725,"extra":""}]}]},{"had_liked":false,"id":219196,"user_name":"zyz","can_delete":false,"product_type":"c1","uid":1019339,"ip_address":"","ucode":"0092F8C0FFA375","user_header":"","comment_is_top":false,"comment_ctime":1589964940,"is_pvip":false,"replies":[{"id":"81007","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œæ„Ÿè°¢åé¦ˆï¼Œé‡‡ç”¨dynamic configurationè¿›è¡Œæˆå‘˜å˜æ›´ï¼Œä¸éœ€è¦é‡å¯çš„ï¼Œå·²ä¿®æ­£ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1590001682,"ip_address":"","comment_id":219196,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18769834124","product_id":100046101,"comment_content":"è€å¸ˆï¼Zookeeperç‰ˆæœ¬3.5.0å¼€å§‹æ”¯æŒdynamic configurationï¼Œæˆå‘˜å˜æ›´çš„æ—¶å€™ï¼Œä¸éœ€è¦é‡å¯äº†å§","like_count":4,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495711,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œæ„Ÿè°¢åé¦ˆï¼Œé‡‡ç”¨dynamic configurationè¿›è¡Œæˆå‘˜å˜æ›´ï¼Œä¸éœ€è¦é‡å¯çš„ï¼Œå·²ä¿®æ­£ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590001682,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":270271,"user_name":"ç‹ä¼Ÿå»º","can_delete":false,"product_type":"c1","uid":1019576,"ip_address":"","ucode":"320CC5B6CE063F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8e/b8/31671fba.jpg","comment_is_top":false,"comment_ctime":1609042881,"is_pvip":true,"discussion_count":3,"race_medal":0,"score":"14493944769","product_id":100046101,"comment_content":"è€å¸ˆæœ‰å‡ ä¸ªé—®é¢˜ä¸å¤ªç†è§£ï¼š<br>1.zkçš„å†™è¯·æ±‚æ˜¯é¢†å¯¼è€…èŠ‚ç‚¹çš„ä¸¤é˜¶æ®µæäº¤ï¼Œè¯´å†™è¯·æ±‚æ˜¯å¼ºä¸€è‡´æ€§ï¼Œæ˜¯è¯´è¿™ä¸ªä¸¤é˜¶æ®µè¿‡ç¨‹æœªå®Œæˆä¹‹å‰ä¸å…è®¸å…¶ä»–æ“ä½œï¼Œæ‰€ä»¥è¯´ä»–æ˜¯å¼ºä¸€è‡´æ€§å—ï¼Ÿ<br>2.zkçš„è¯»åªèƒ½æä¾›é¡ºåºä¸€è‡´æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ä»–å¯èƒ½è¯»åˆ°æ—§çš„ç‰ˆæœ¬çš„æ•°æ®ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦æŠŠzkå½’ä¸ºCPç±»å‹çš„ç³»ç»Ÿå‘¢ï¼ŸCAPé‡Œçš„C ä¸åº”è¯¥æ˜¯å¼ºä¸€è‡´æ€§å—ï¼Œè¯´åˆ°åº•æ„Ÿè§‰è¿˜æ˜¯å¯¹è¿™ä¸ªä¸€è‡´æ€§æ²¡ç†è§£é€ï¼Œå°±ä¹‹å‰çš„ç†è§£æ¥è¯´ï¼Œæˆ‘è®¤ä¸ºCæ˜¯æŒ‡æ¯æ¬¡è¯»å–çš„æ•°æ®éƒ½æ˜¯æœ€è¿‘ä¸€æ¬¡å†™å…¥çš„æ•°æ®ï¼Œè€Œä¸æ˜¯è¿‡æœŸçš„æ•°æ®ã€‚å¸Œæœ›è€å¸ˆèƒ½è®²è§£ä¸€ä¸‹è¿™å—å„¿ã€‚<br>3.åˆ©ç”¨zkæ¥å®ç°åˆ†å¸ƒå¼é”ï¼Œå¤šä¸ªæœåŠ¡åŒæ—¶å»æ‹¿é”æ—¶ï¼Œå¦‚æœzkæä¾›çš„è¯»ä¸æ˜¯å¼ºä¸€è‡´æ€§ï¼Œé‚£ä¹ˆä¼šä¸ä¼šè¯»åˆ°æ—§çš„é”ä¿¡æ¯ï¼Ÿè¿™å—å„¿æ˜¯æ€ä¹ˆä¿è¯æ¯ä¸ªæœåŠ¡æ‹¿åˆ°çš„éƒ½æ˜¯æœ€æ–°çš„æ•°æ®ï¼Œå®ç°ä¸Šæ¥è¯´æ˜¯é syncè¯»å—ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1046714,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg","nickname":"çº¦ä¹¦äºš","note":"","ucode":"81EA27ADD9EC1A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349808,"discussion_content":"1. å¼ºä¸€è‡´æ€§æ˜¯æŒ‡çº¿æ€§ä¸€è‡´æ€§ï¼Œçº¿æ€§ä¸€è‡´æ€§çš„ç‰¹æ€§ä¹‹ä¸€æ˜¯å¯¹äºè§‚å¯Ÿè€…æ¥è¯´ï¼Œæ‰€æœ‰çš„è¯»å’Œå†™éƒ½çœ‹èµ·æ¥åƒæ˜¯åœ¨ä¸€ä¸ªå•è°ƒé€’å¢çš„æ—¶é—´ä¸Šä¸²è¡Œæ¨è¿›ï¼Œæ‰€ä»¥ç¡®å®æ»¡è¶³ä½ è¯´çš„è¦æ±‚ã€‚ä½†è¿™é‡Œè®¨è®ºçš„ä¸»è¦æ˜¯å¦ä¸€ä¸ªç‰¹æ€§ï¼šæ‰€æœ‰çš„è¯»æ€»èƒ½è¿”å›æœ€è¿‘çš„å†™æ“ä½œçš„å€¼ï¼Œå°±æ˜¯ä½ åœ¨ç¬¬2é—®é‡Œæåˆ°çš„ã€‚\n2. CAPæœ¬æ¥ç°åœ¨ä¹Ÿä¸å¸¸ä½œä¸ºåˆ¤æ–­ä¾æ®äº†ï¼Œæ›´å¤šæ˜¯åŸ¹è®­æœºæ„å’Œå…¬ä¼—å·è¿˜æä¸€æï¼Œå¯ä»¥æœæœMartin Kleppmannçš„æ–‡ç« ã€‚å¦å¤–ç¡¬è¯´zookeeperå’Œraftåœ¨è¯»çš„ä¸€è‡´æ€§ä¸Šä¸ä¸€æ ·å…¶å®æœ‰ç‚¹å°¬ã€‚\n3. æ˜¯æœ‰è¿™ç§æƒ…å†µï¼Œä½†ä¸ä¼šå‡ºç°ä¸¤ä¸ªsessionåŒæ—¶è·å–é”çš„æƒ…å†µå°±ç®—é—®é¢˜ä¸å¤§ã€‚è€Œä¸”åªè¦è¯»éƒ½åœ¨åŒä¸€ä¸ªfollowerå°±æ˜¯é¡ºåºä¸€è‡´æ€§ã€‚è¿™æ—¶å¦‚æœç”¨syncç¡®å®ä¼šæ›´å¥½ä¸€äº›ã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1613560998,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1204168,"avatar":"https://static001.geekbang.org/account/avatar/00/12/5f/c8/13aa8aa9.jpg","nickname":"night","note":"","ucode":"03B3C955092C03","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349103,"discussion_content":"1. å¼ºä¸€è‡´æ˜¯æŒ‡æ•´ä¸ª zk æœåŠ¡é›†ç¾¤çš„ leader å’Œå¤šæ•°èŠ‚ç‚¹ï¼Œå¯¹æ•°æ®çš„å†™è¡¨ç°å‡ºä¸€è‡´çš„ã€‚è€Œéä¸²è¡Œæ‰§è¡Œã€‚\n2. zk æä¾›çš„æ˜¯æœ€ç»ˆä¸€è‡´ï¼Œéå¼ºä¸€è‡´ã€‚\n3. ç”¨ zk åšåˆ†å¸ƒå¼é”çš„å®ç°ï¼Œé€šå¸¸æ˜¯ create nodeï¼Œè€Œé get nodeã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1612885258,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1513825,"avatar":"https://static001.geekbang.org/account/avatar/00/17/19/61/119cbde2.jpg","nickname":"Dolly","note":"","ucode":"CC74978F393055","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":343024,"discussion_content":"åŒé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610928890,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":245842,"user_name":"è·¯äºº","can_delete":false,"product_type":"c1","uid":1084291,"ip_address":"","ucode":"55FF703DE772D7","user_header":"https://static001.geekbang.org/account/avatar/00/10/8b/83/d2afc837.jpg","comment_is_top":false,"comment_ctime":1599092601,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10189027193","product_id":100046101,"comment_content":"å†™æˆ‘çœ‹ç”¨çš„æ˜¯2pcï¼Œ2pcä¸­æœ‰äº›å¦‚æœåªæœ‰éƒ¨åˆ†commitæˆåŠŸï¼Œzookeeperä¼šæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿæ˜¯æœ‰ä»€ä¹ˆè¡¥å¿æœºåˆ¶ä¹ˆï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1123163,"avatar":"https://static001.geekbang.org/account/avatar/00/11/23/5b/983408b9.jpg","nickname":"æ‚Ÿç©ºèŠæ¶æ„","note":"","ucode":"C2F482A0CF8AF1","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557772,"discussion_content":"å¥½é—®é¢˜ï¼Œå¦‚æœéƒ¨åˆ†èŠ‚ç‚¹ commit æˆåŠŸï¼Œå…¶ä»–èŠ‚ç‚¹æ²¡æœ‰æˆåŠŸï¼Œæ˜¯è¿›è¡Œ retry å‘¢ï¼Œè¿˜æ˜¯ç›´æ¥å¿½ç•¥å‘¢ï¼Ÿå¦‚æœ retry éœ€è¦ retry å¤šå°‘æ¬¡å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647958889,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":339178,"user_name":"æ‚Ÿç©ºèŠæ¶æ„","can_delete":false,"product_type":"c1","uid":1123163,"ip_address":"","ucode":"C2F482A0CF8AF1","user_header":"https://static001.geekbang.org/account/avatar/00/11/23/5b/983408b9.jpg","comment_is_top":false,"comment_ctime":1647958647,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1647958647","product_id":100046101,"comment_content":"è¯¾åé¢˜ï¼šæˆ‘æåˆ° ZooKeeper æä¾›çš„æ˜¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œè¯»æ“ä½œå¯ä»¥åœ¨ä»»ä½•èŠ‚ç‚¹ä¸Šæ‰§è¡Œã€‚é‚£ä¹ˆå¦‚æœè¯»æ“ä½œè®¿é—®çš„æ˜¯å¤‡ä»½èŠ‚ç‚¹ï¼Œä¸ºä»€ä¹ˆæ— æ³•ä¿è¯æ¯æ¬¡éƒ½èƒ½è¯»åˆ°æœ€æ–°çš„æ•°æ®å‘¢ï¼Ÿ<br><br>å›ç­”ï¼šå› ä¸ºä¸»èŠ‚ç‚¹å‘é€ commit æ¶ˆæ¯ç»™æ‰€æœ‰å¤‡ä»½èŠ‚ç‚¹æ—¶ï¼Œå¤‡ä»½èŠ‚ç‚¹æ‰§è¡Œ commit çš„æ—¶æœºä¸ä¸€å®šéƒ½æ˜¯åŒæ­¥å®Œæˆçš„ï¼Œåªæœ‰å½“ commit ä¹‹åï¼Œå®¢æˆ·ç«¯è¯»å–çš„æ•°æ®æ‰æ˜¯æœ€æ–°çš„ï¼Œæ¯”å¦‚å¤‡ä»½èŠ‚ç‚¹ B å…ˆcommitï¼Œå®¢æˆ·ç«¯ 1 è¿æ¥çš„æ˜¯ å¤‡ä»½èŠ‚ç‚¹ Bï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯ 1 è‚¯å®šè¯»åˆ°çš„æ˜¯æœ€æ–°çš„ï¼Œä½†æ˜¯å¦‚æœå®¢æˆ·ç«¯è¿æ¥çš„æ˜¯å¤‡ä»½èŠ‚ç‚¹ Cï¼Œä½†æ˜¯èŠ‚ç‚¹ C     è¿˜æ²¡æœ‰æ”¶åˆ° commit æ¶ˆæ¯æˆ–è€…æ”¶åˆ°äº†ï¼Œè¿˜æ²¡æ¥å¾—åŠ commitï¼Œå®¢æˆ·ç«¯å°±å‘èµ·è¯·æ±‚äº†ï¼Œè¿™ä¸ªæ—¶å€™è¯»åˆ°çš„å°±æ˜¯æ—§æ•°æ®ã€‚ä½†æ˜¯è¿‡äº†çŸ­æš‚æ—¶é—´åï¼Œæ‰€æœ‰å¤‡ä»½èŠ‚ç‚¹éƒ½ commit äº†ï¼Œè¿™ä¸ªæ—¶å€™ä»»ä½•å®¢æˆ·ç«¯éƒ½å¯ä»¥è¯»åˆ°æœ€æ–°çš„ä¸€è‡´æ€§æ•°æ®äº†ï¼Œè¿™ä¸ªå°±æ˜¯æœ€ç»ˆä¸€è‡´æ€§ã€‚<br>è¡¥å……ï¼šè¿™é‡Œ commit æ“ä½œå°±æ˜¯å°†æ•°æ® æ”¾åˆ° znode å†…å­˜æ•°æ®ç»“æ„ä¸Šï¼Œè¿™æ ·å®¢æˆ·ç«¯å°±å¯ä»¥è¯»åˆ°æœ€æ–°çš„æ•°æ®äº†ã€‚","like_count":0},{"had_liked":false,"id":330570,"user_name":"é˜¿kai(aeo","can_delete":false,"product_type":"c1","uid":1147682,"ip_address":"","ucode":"6B1D650D9BFA4C","user_header":"https://static001.geekbang.org/account/avatar/00/11/83/22/c3dae274.jpg","comment_is_top":false,"comment_ctime":1642048139,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1642048139","product_id":100046101,"comment_content":"ä¸ºä»€ä¹ˆè§‰å¾—ä»£ç é¡ºåºæ˜¯åçš„å‘¢ï¼Ÿæ¯”å¦‚ä¸‹é¢è¿™æ®µFinalRequestProcessoræ€ä¹ˆæ˜¯é¦–å…ˆåˆ›å»ºçš„å‘¢?<br><br>RequestProcessor finalProcessor = new FinalRequestProcessor(this);            &#47;&#47; åˆ›å»ºfinalProcessorï¼Œæœ€ç»ˆæäº¤ææ¡ˆå’Œå“åº”æŸ¥è¯¢<br>  &#47;&#47; åˆ›å»ºtoBeAppliedProcessorï¼Œå­˜å‚¨å¯æäº¤çš„ææ¡ˆï¼Œå¹¶åœ¨æäº¤ææ¡ˆåï¼Œä»toBeAppliedé˜Ÿåˆ—ç§»é™¤å·²æäº¤çš„<br>  RequestProcessor toBeAppliedProcessor = new Leader.ToBeAppliedRequestProcessor(finalProcessor, getLeader());<br>  &#47;&#47; åˆ›å»ºcommitProcessorï¼Œå¤„ç†ææ¡ˆæäº¤æˆ–è¯»è¯·æ±‚      <br>  commitProcessor = new CommitProcessor(toBeAppliedProcessor, Long.toString(getServerId()), false, getZooKeeperServerListener());<br>  commitProcessor.start();<br>  &#47;&#47; åˆ›å»ºproposalProcessorï¼ŒæŒ‰ç…§é¡ºåºå¹¿æ’­ææ¡ˆç»™è·Ÿéšè€…<br>  ProposalRequestProcessor proposalProcessor = new ProposalRequestProcessor(this, commitProcessor);<br>  proposalProcessor.initialize();<br>  &#47;&#47; åˆ›å»ºprepRequestProcessorï¼Œæ ¹æ®è¯·æ±‚åˆ›å»ºææ¡ˆ      <br>  prepRequestProcessor = new PrepRequestProcessor(this, proposalProcessor);<br>  prepRequestProcessor.start();<br>  &#47;&#47; åˆ›å»ºfirstProcessorï¼Œæ¥æ”¶å‘ç»™é¢†å¯¼è€…çš„è¯·æ±‚<br>  firstProcessor = new LeaderRequestProcessor(this, prepRequestProcessor);<br>","like_count":0},{"had_liked":false,"id":282681,"user_name":"å§‘å°„ä»™äºº","can_delete":false,"product_type":"c1","uid":1008517,"ip_address":"","ucode":"3EFC1F3E592165","user_header":"https://static001.geekbang.org/account/avatar/00/0f/63/85/1dc41622.jpg","comment_is_top":false,"comment_ctime":1615363562,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"1615363562","product_id":100046101,"comment_content":"è€å¸ˆï¼Œé‚£ä¹ˆZookeeperæ˜¯CPå‘¢ï¼Œè¿˜æ˜¯APå‘¢ï¼Ÿè¯»æ˜¯æœ€ç»ˆä¸€è‡´ï¼Œé‚£ä¹ˆæˆ‘ç†è§£æ˜¯APã€‚ä½†ä¹‹å‰è¯»çš„ä¸€ç¯‡æ–‡ç« ï¼Œè¯´Zookeeperä¸é€‚åˆä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Œè¯´Zookeeperæ˜¯CPï¼ŒAPæ›´é€‚åˆä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Œå› ä¸ºæ˜¯è¯»å¤šå†™å°‘ï¼Œä¸è¦æ±‚é©¬ä¸Šèƒ½çœ‹åˆ°æ–°çš„å®ä¾‹æ›´æ–°ã€‚ è‡³äºåŒæ­¥æœºåˆ¶ï¼ŒZookeeperä¹Ÿæ˜¯æ”¯æŒå¢é‡æ›´æ–°ï¼Œè¿™æ ·çœ‹æ¥å®Œå…¨æ²¡æœ‰é—®é¢˜ã€‚éº»çƒ¦è€å¸ˆæŒ‡ç‚¹ä¸‹ã€‚","like_count":0,"discussions":[{"author":{"id":2580056,"avatar":"","nickname":"Geek_e0e75f","note":"","ucode":"EAD2C6178DAB45","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393722,"discussion_content":"ä½ åˆ«è¯¯å¯¼äººå®¶äº†ï¼Œzkæ˜¯æœ€ç»ˆä¸€è‡´æ€§å¥½å§ï¼Œäººå®¶å®˜ç½‘éƒ½å†™äº†ï¼Œzkä¸ä¼šä¿è¯å¼ºä¸€è‡´æ€§ï¼Œä½ å¦‚æœéè¦å¼ºä¸€è‡´æ€§çš„è¯ï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨è¯»æ•°æ®ä¹‹å‰å«ä½ çš„èŠ‚ç‚¹åŒæ­¥ä¸€ä¸‹æ•°æ®å†è¯»ï¼Œè¿™ä¸ªæ˜¯åœ¨å®˜ç½‘ä¸­å†™æ˜äº†çš„ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1631580339,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1123163,"avatar":"https://static001.geekbang.org/account/avatar/00/11/23/5b/983408b9.jpg","nickname":"æ‚Ÿç©ºèŠæ¶æ„","note":"","ucode":"C2F482A0CF8AF1","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557778,"discussion_content":"Zookeeper æ˜¯é¡ºåºä¸€è‡´æ€§ï¼Œä¸æ˜¯è¯´çš„ CP å’Œ APï¼Œå¦‚æœè¦ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œéœ€è¦æ‰‹åŠ¨æ‰§è¡Œ sync æ–¹æ³•ã€‚å¯ä»¥ä½œä¸ºæ³¨å†Œä¸­å¿ƒçš„ï¼Œä¸»èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªï¼Œè´Ÿè´£å†™å’Œè¯»ï¼ŒåŸºäºå†…å­˜çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥æ»¡è¶³æ¯ç§’ä¸Šä¸‡ QPSã€‚å¤šä¸ªå¤‡ä»½èŠ‚ç‚¹è´Ÿè´£è¯»ï¼Œå¯ä»¥æ»¡è¶³å‡ ä¸‡çš„ QPS è¯»ï¼Œè¿˜å¯ä»¥é€šè¿‡ Observer èŠ‚ç‚¹çº¿æ€§æ‰©å±• è¯» QPSã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647959118,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1083395,"avatar":"https://static001.geekbang.org/account/avatar/00/10/88/03/805c8e0e.jpg","nickname":"è¿½å¿†ä¼¼æ°´å¹´å","note":"","ucode":"FB6C3EDC6988B6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":359828,"discussion_content":"zookeeperæ˜¯CPæ¨¡å‹ï¼Œå½“å‡ºç°ç½‘ç»œåˆ†åŒºï¼Œæ˜¯ä¸èƒ½æä¾›æœåŠ¡çš„ï¼Œä¸å¯è¯»å†™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616297712,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":278942,"user_name":"æ¸”å¤«","can_delete":false,"product_type":"c1","uid":1246157,"ip_address":"","ucode":"43C267E01220F7","user_header":"https://static001.geekbang.org/account/avatar/00/13/03/cd/264f6a1c.jpg","comment_is_top":false,"comment_ctime":1613475694,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1613475694","product_id":100046101,"comment_content":"éŸ©è€å¸ˆï¼Œæƒ³é—®ä¸‹åˆ†å¸ƒå¼é›†ç¾¤æ¨¡å¼ä¸‹ï¼ŒFollowerZooKeeperServer.setupRequestProcessorsæ–¹æ³•æ˜¯å¦‚ä½•è¢«è°ƒç”¨çš„å‘¢ï¼Œæ‰¾äº†å¥½ä¹…æ‰¾ä¸åˆ°ã€‚ä¸åƒstandoloneæ¨¡å¼é‚£ä¹ˆå¥½æ‰¾","like_count":0},{"had_liked":false,"id":271613,"user_name":"Tesla","can_delete":false,"product_type":"c1","uid":1500742,"ip_address":"","ucode":"98629AFD9861EE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKUcSLVV6ia3dibe7qvTu8Vic1PVs2EibxoUdx930MC7j2Q9A6s4eibMDZlcicMFY0D0icd3RrDorMChu0zw/132","comment_is_top":false,"comment_ctime":1609732841,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1609732841","product_id":100046101,"comment_content":"è€å¸ˆï¼Œè¯·é—®zkçš„æœ€ç»ˆä¸€è‡´æ€§æ˜¯ä»¥æå‡è¯»çš„æ•ˆç‡ä¸ºç›®æ ‡çš„å˜›ï¼Œå†™çš„é€Ÿç‡å’Œå¼ºä¸€è‡´æ€§çš„ç®—æ³•å·®ä¸å¤šå§ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1123163,"avatar":"https://static001.geekbang.org/account/avatar/00/11/23/5b/983408b9.jpg","nickname":"æ‚Ÿç©ºèŠæ¶æ„","note":"","ucode":"C2F482A0CF8AF1","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557782,"discussion_content":"å†™çš„é€Ÿç‡ä¸ä¸€æ ·ï¼Œå¼ºä¸€è‡´æ€§é€Ÿåº¦æ›´æ…¢ï¼Œéœ€è¦ç­‰å¾…æ‰€æœ‰ follower çš„ commit éƒ½æˆåŠŸæ‰èƒ½è¿›è¡Œä¸‹ä¸€æ¬¡çš„ commitã€‚ä½†æ˜¯ Zookeeper åªéœ€è¦å‘é€ commit æ¶ˆæ¯å°±å¯ä»¥äº†ï¼Œä¸ç”¨ä¿è¯æ‰€æœ‰ follower éƒ½æˆåŠŸæ‰èƒ½è¿›è¡Œä¸‹ä¸€æ¬¡ commitã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647959281,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":243003,"user_name":"Heaven","can_delete":false,"product_type":"c1","uid":1694207,"ip_address":"","ucode":"FA33FBCC66C911","user_header":"https://static001.geekbang.org/account/avatar/00/19/d9/ff/b23018a6.jpg","comment_is_top":false,"comment_ctime":1597915769,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597915769","product_id":100046101,"comment_content":"è™½ç„¶é¢†å¯¼è€…å‘ç€å¤§éƒ¨åˆ†çš„è·Ÿéšè€…èŠ‚ç‚¹å‘é€äº†commitè¯·æ±‚,ä½†æ˜¯å¹¶ä¸ä¼šç­‰å¾…è·Ÿéšè€…å“åº”å®Œæˆå†™å…¥å†è¿”å›å®¢æˆ·ç«¯,è€Œæ˜¯ç›´æ¥å‘é€äº†ä¸€ä¸ªå®Œæˆæ¶ˆæ¯ç»™æ¥æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚çš„èŠ‚ç‚¹,è¿™å°±å¯¼è‡´,å®¢æˆ·ç«¯å»è¯»å–çš„æ—¶å€™,å¯èƒ½è¯»å–åˆ°çš„èŠ‚ç‚¹æ˜¯æ²¡æœ‰æ•°æ®ç”Ÿæ•ˆçš„èŠ‚ç‚¹,æ‰€ä»¥æ²¡æ³•ä¿è¯æ¯æ¬¡éƒ½è¯»åˆ°æœ€æ–°çš„æ•°æ®","like_count":0},{"had_liked":false,"id":241882,"user_name":"Kvicii.Y","can_delete":false,"product_type":"c1","uid":1442588,"ip_address":"","ucode":"446BFA633569EA","user_header":"https://static001.geekbang.org/account/avatar/00/16/03/1c/c9fe6738.jpg","comment_is_top":false,"comment_ctime":1597486117,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597486117","product_id":100046101,"comment_content":"Raftçš„å¼ºä¸€è‡´æ€§æ˜¯ä½“ç°åœ¨è¯»å†™éƒ½ç”±é¢†å¯¼è€…å®Œæˆï¼›ZABçš„æœ€ç»ˆä¸€è‡´æ€§æ˜¯è¯»å†™å¯ä»¥ç”±é¢†å¯¼è€…ä¹Ÿå¯ç”±Followeræˆ–Observerè½¬å‘å®Œæˆï¼Œå¦‚æœZABæƒ³è¦å®ç°å¼ºä¸€è‡´æ€§ï¼Œä¼¼ä¹ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡sync APIå®Œæˆçš„å§","like_count":0},{"had_liked":false,"id":232796,"user_name":"çˆ±å¾·å","can_delete":false,"product_type":"c1","uid":1853638,"ip_address":"","ucode":"800E6A9490D90F","user_header":"https://static001.geekbang.org/account/avatar/00/1c/48/c6/3c8d9a0c.jpg","comment_is_top":false,"comment_ctime":1594120501,"is_pvip":false,"replies":[{"id":"88053","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œç¬¬äºŒä¸ªè¯´æ³•ï¼Œåœ¨æ–‡ä¸­æˆ‘æ²¡æœ‰æœåˆ°ï¼Œå¦‚æœæ–¹ä¾¿ï¼Œå¸®å¿™è¡¥å……ä¸‹å“ˆã€‚å¦‚æœç¬¬äºŒä¸ªè¯´æ³•å»æ‰â€œç¬¬ä¸€é˜¶æ®µâ€å’Œâ€œå°±â€ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªè¯´æ³•ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œéƒ½æ˜¯æ­£ç¡®çš„ï¼Œä¸€ä¸ªä¾§é‡ä»£ç å®ç°ï¼Œä¸€ä¸ªä¾§é‡ç®—æ³•åŸç†ï¼Œå°±åƒåŒæ ·æ˜¯ä¸€æ£µæ ‘ï¼Œç”Ÿç‰©å­¦å®¶å’Œæ–‡å­¦å®¶çš„æè¿°æ˜¯ä¸åŒçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1596138453,"ip_address":"","comment_id":232796,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1594120501","product_id":100046101,"comment_content":"è€å¸ˆï¼Œåœ¨è¯´å¤„ç†å†™è¯·æ±‚çš„æ—¶å€™å¥½åƒæœ‰ç‚¹é—®é¢˜ã€‚æœ¬æ–‡ä¸­æ‰€è¯´çš„æ˜¯leaderè¦åœ¨ç¬¬äºŒé˜¶æ®µï¼ˆcommitï¼‰åæ‰ä¼šè¿”å›ç»™å®¢æˆ·ç«¯æˆåŠŸã€‚ä½†æ˜¯åœ¨å‰å‡ è®²ä¸­ï¼Œå¥½åƒæ˜¯è¯´zabåœ¨ç¬¬ä¸€é˜¶æ®µï¼Œæ”¶åˆ°å¤§å¤šæ•°å“åº”åå°±è¿”å›ç»™å®¢æˆ·ç«¯æˆåŠŸã€‚é‚£ä¹ˆè¿™ä¸¤ä¸ªè¯´æ³•å“ªä¸ªæ­£ç¡®å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500770,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œç¬¬äºŒä¸ªè¯´æ³•ï¼Œåœ¨æ–‡ä¸­æˆ‘æ²¡æœ‰æœåˆ°ï¼Œå¦‚æœæ–¹ä¾¿ï¼Œå¸®å¿™è¡¥å……ä¸‹å“ˆã€‚å¦‚æœç¬¬äºŒä¸ªè¯´æ³•å»æ‰â€œç¬¬ä¸€é˜¶æ®µâ€å’Œâ€œå°±â€ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªè¯´æ³•ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œéƒ½æ˜¯æ­£ç¡®çš„ï¼Œä¸€ä¸ªä¾§é‡ä»£ç å®ç°ï¼Œä¸€ä¸ªä¾§é‡ç®—æ³•åŸç†ï¼Œå°±åƒåŒæ ·æ˜¯ä¸€æ£µæ ‘ï¼Œç”Ÿç‰©å­¦å®¶å’Œæ–‡å­¦å®¶çš„æè¿°æ˜¯ä¸åŒçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596138453,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1853638,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/48/c6/3c8d9a0c.jpg","nickname":"çˆ±å¾·å","note":"","ucode":"800E6A9490D90F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":289774,"discussion_content":"æˆ‘é ï¼Œæˆ‘è®°é”™äº†ï¼Œç¬¬ä¸€é˜¶æ®µè·å¾—å¤šæ•°ç¥¨ç•™ç»™å®¢æˆ·ç«¯è¿”å›æˆåŠŸçš„æ˜¯raftğŸ˜¢ğŸ˜¢","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1594210091,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":231285,"user_name":"Kvicii.Y","can_delete":false,"product_type":"c1","uid":1442588,"ip_address":"","ucode":"446BFA633569EA","user_header":"https://static001.geekbang.org/account/avatar/00/16/03/1c/c9fe6738.jpg","comment_is_top":false,"comment_ctime":1593630394,"is_pvip":false,"replies":[{"id":"87649","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œæ˜¯çš„","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1595756328,"ip_address":"","comment_id":231285,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1593630394","product_id":100046101,"comment_content":"é¢†å¯¼è€…CommitProcessor.tryToCommit() æäº¤ææ¡ˆçš„æ–¹æ³•ä¼¼ä¹åœ¨3.6.0åœ¨Leaderç±»ä¸­","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500238,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œæ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595756328,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":228614,"user_name":"Dovelol","can_delete":false,"product_type":"c1","uid":1253384,"ip_address":"","ucode":"9B5DDF7720F307","user_header":"https://static001.geekbang.org/account/avatar/00/13/20/08/bc06bc69.jpg","comment_is_top":false,"comment_ctime":1592752504,"is_pvip":false,"replies":[{"id":"88045","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œæ€§èƒ½æ˜¯ç›¸å¯¹ï¼Œç›¸æ¯”åŸå­æäº¤åè®®ï¼ˆæ¯”å¦‚2PCï¼‰ï¼Œå…±è¯†ç®—æ³•çš„æ€§èƒ½è¦é«˜äº›ã€‚é˜»å¡å±äºå¼‚å¸¸æƒ…å†µï¼Œåœ¨å®é™…åœºæ™¯ä¸­ï¼Œå¦‚æœä»£ç æœ¬èº«æ²¡æœ‰ç¼ºé™·ï¼Œåœ¨ç»å¤§å¤šæ•°æ—¶å€™ï¼Œç³»ç»Ÿéƒ½æ˜¯æ­£å¸¸è¿è¡Œçš„ï¼Œä¸å­˜åœ¨é˜»å¡çš„ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°å†™çš„æ€§èƒ½ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1596134520,"ip_address":"","comment_id":228614,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1592752504","product_id":100046101,"comment_content":"è€å¸ˆå¥½ï¼Œæƒ³é—®ä¸‹zabåè®®å¤„ç†å†™è¯·æ±‚è¦è¿™ä¹ˆå¤šæ­¥éª¤ï¼Œé‚£è¿˜èƒ½ä¿è¯æ€§èƒ½å—ï¼Ÿå¦‚æœå…¶ä¸­æŸä¸€å°æ­¥éª¤å»¶è¿Ÿæˆ–é˜»å¡éƒ½ä¼šå½±å“å†™çš„æ€§èƒ½æŠŠã€‚","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499104,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œæ€§èƒ½æ˜¯ç›¸å¯¹ï¼Œç›¸æ¯”åŸå­æäº¤åè®®ï¼ˆæ¯”å¦‚2PCï¼‰ï¼Œå…±è¯†ç®—æ³•çš„æ€§èƒ½è¦é«˜äº›ã€‚é˜»å¡å±äºå¼‚å¸¸æƒ…å†µï¼Œåœ¨å®é™…åœºæ™¯ä¸­ï¼Œå¦‚æœä»£ç æœ¬èº«æ²¡æœ‰ç¼ºé™·ï¼Œåœ¨ç»å¤§å¤šæ•°æ—¶å€™ï¼Œç³»ç»Ÿéƒ½æ˜¯æ­£å¸¸è¿è¡Œçš„ï¼Œä¸å­˜åœ¨é˜»å¡çš„ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°å†™çš„æ€§èƒ½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596134520,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":221353,"user_name":"xzy","can_delete":false,"product_type":"c1","uid":1082132,"ip_address":"","ucode":"483350A630625E","user_header":"https://static001.geekbang.org/account/avatar/00/10/83/14/099742ae.jpg","comment_is_top":false,"comment_ctime":1590480550,"is_pvip":false,"replies":[{"id":"88037","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œç»å¤§å¤šæ•°æ—¶å€™ï¼Œä¸šåŠ¡å¯¹æ•°æ®çš„æ–°æ—§æ˜¯æ²¡é‚£ä¹ˆæ•æ„Ÿçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1596129254,"ip_address":"","comment_id":221353,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1590480550","product_id":100046101,"comment_content":"ä½ å¥½ï¼Œæ—¢ç„¶ zk åªèƒ½ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œé‚£ä¹ˆåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¦‚ kafkaã€hbase ç­‰ï¼Œç”¨ zk åšå…ƒæ•°æ®ç®¡ç†å²‚ä¸æ˜¯æœ‰é—®é¢˜","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496435,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œç»å¤§å¤šæ•°æ—¶å€™ï¼Œä¸šåŠ¡å¯¹æ•°æ®çš„æ–°æ—§æ˜¯æ²¡é‚£ä¹ˆæ•æ„Ÿçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596129254,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1123163,"avatar":"https://static001.geekbang.org/account/avatar/00/11/23/5b/983408b9.jpg","nickname":"æ‚Ÿç©ºèŠæ¶æ„","note":"","ucode":"C2F482A0CF8AF1","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557783,"discussion_content":"è¿™æ˜¯ä¸€ä¸ªè®¾è®¡å–èˆçš„é—®é¢˜ï¼Œè¦æ±‚å¼ºä¸€è‡´æ€§ï¼Œå°±éœ€è¦ç‰ºç‰²æ€§èƒ½ï¼Œé‚£è¿™äº›å…ƒæ•°æ®ç®¡ç†æ˜¯å¦çœŸçš„éœ€è¦å¼ºä¸€è‡´æ€§ï¼Ÿå¦‚æœå¯ä»¥å®¹å¿çŸ­æš‚æ—¶é—´çš„ä¸ä¸€è‡´ï¼Œæ˜¯å¦å¯ä»¥æ¥å—ï¼Ÿå¯ä»¥ä»è¿™äº›æ–¹é¢æ¥è€ƒè™‘ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647959447,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":219242,"user_name":"DY-æ¨","can_delete":false,"product_type":"c1","uid":1105546,"ip_address":"","ucode":"C84C0250F1A053","user_header":"https://static001.geekbang.org/account/avatar/00/10/de/8a/8b4d7dbd.jpg","comment_is_top":false,"comment_ctime":1589974089,"is_pvip":false,"replies":[{"id":"81004","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œç®—æ³•å’Œå·¥ç¨‹å®ç°ä¹‹é—´å­˜åœ¨å·®å¼‚ï¼Œå¯¹äºPaxosè€Œè¨€ï¼Œå·®å¼‚å°±æ›´å¤§äº†ï¼Œç¼ºå°‘å·¥ç¨‹å®ç°çš„å¿…é¡»ç»†èŠ‚ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¤§å®¶ç°åœ¨ä¸»è¦é€‰æ‹©äº†raftçš„åŸå› ã€‚æ•…éšœæ¢å¤ï¼Œæ˜¯ZABå®šä¹‰çš„ï¼ŒRaftæ²¡æœ‰å®šä¹‰è¿™ä¸ªé˜¶æ®µã€‚é—®é¢˜1ï¼šè‹¥ä½¿ç”¨paxosï¼Œéœ€è¦è‡ªå·±æƒè¡¡ï¼Œå¯ä»¥ä½¿ç”¨å®ƒçš„æåˆ°çš„æ–¹æ³•ï¼Œæ–°é¢†å¯¼è€…é€šè¿‡prepareé˜¶æ®µæ¥å‘ç°ä¹‹å‰é€‰å®šçš„å€¼ï¼Œä¹Ÿå¯ä»¥è‡ªå·±è®¾è®¡ï¼Œéœ€è¦æ•´ä½“è€ƒè™‘ã€‚é—®é¢˜2ï¼šè”åˆå…±è¯†ï¼Œæ˜¯Raftä¸­å¤„ç†æˆå‘˜å˜æ›´çš„ä¸€ç§æ–¹æ³•ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1589989732,"ip_address":"","comment_id":219242,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1589974089","product_id":100046101,"comment_content":"è€å¸ˆï¼Œå’¨è¯¢ä¸‹ã€‚paxosç®—æ³•ä»æ‚¨è®²è§£ä¸‹æ¥å¥½åƒä»…æ˜¯å¯¹æŸä¸ªææ¡ˆè¾¾æˆå…±è¯†ã€‚æ²¡æœ‰çœ‹åˆ°æ•…éšœæ¢å¤æˆ–æ—¥å¿—æ¢å¤çš„è¿‡ç¨‹å•Šã€‚åå€’zabå’Œraftæœ‰ã€‚é‚£æ‚¨çŸ¥é“ç”¨è¿™ç§å…±è¯†ç®—æ³•çš„è½¯ä»¶æ˜¯è‡ªç ”çš„æ—¥å¿—æ¢å¤å—?å¦å¤–è”åˆå…±è¯†ç®—æ³•æ˜¯ä»€ä¹ˆå‘¢ã€‚","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495732,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œç®—æ³•å’Œå·¥ç¨‹å®ç°ä¹‹é—´å­˜åœ¨å·®å¼‚ï¼Œå¯¹äºPaxosè€Œè¨€ï¼Œå·®å¼‚å°±æ›´å¤§äº†ï¼Œç¼ºå°‘å·¥ç¨‹å®ç°çš„å¿…é¡»ç»†èŠ‚ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¤§å®¶ç°åœ¨ä¸»è¦é€‰æ‹©äº†raftçš„åŸå› ã€‚æ•…éšœæ¢å¤ï¼Œæ˜¯ZABå®šä¹‰çš„ï¼ŒRaftæ²¡æœ‰å®šä¹‰è¿™ä¸ªé˜¶æ®µã€‚é—®é¢˜1ï¼šè‹¥ä½¿ç”¨paxosï¼Œéœ€è¦è‡ªå·±æƒè¡¡ï¼Œå¯ä»¥ä½¿ç”¨å®ƒçš„æåˆ°çš„æ–¹æ³•ï¼Œæ–°é¢†å¯¼è€…é€šè¿‡prepareé˜¶æ®µæ¥å‘ç°ä¹‹å‰é€‰å®šçš„å€¼ï¼Œä¹Ÿå¯ä»¥è‡ªå·±è®¾è®¡ï¼Œéœ€è¦æ•´ä½“è€ƒè™‘ã€‚é—®é¢˜2ï¼šè”åˆå…±è¯†ï¼Œæ˜¯Raftä¸­å¤„ç†æˆå‘˜å˜æ›´çš„ä¸€ç§æ–¹æ³•ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589989732,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}