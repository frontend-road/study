{"id":88542,"title":"41 | 实现pipe-filter framework","content":"<h1>课件及源代码地址</h1><p><a href=\"https://gitee.com/geektime-geekbang/go_learning\">https://gitee.com/geektime-geekbang/go_learning</a></p><h2>书目推荐</h2><p><a href=\"time://mall?url=https%3A%2F%2Fh5.youzan.com%2Fv2%2Fgoods%2F1ycmk3uob0ryw\">《计算机程序的构造和解释》</a></p>","comments":[{"had_liked":false,"id":84733,"user_name":"Coder4","can_delete":false,"product_type":"c3","uid":1048453,"ip_address":"","ucode":"71DAC6B3D112DB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJcvQzf86HsxOkPcRpibBdCxDW0IK9wel9TmkEhicHPUHPRhzKna8wecDcJcVbNHNSrUMt4GHLxY3iaA/132","comment_is_top":false,"comment_ctime":1554900115,"is_pvip":false,"replies":[{"id":30503,"content":"可以看看“面向模式的软件架构”","user_name":"作者回复","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1554970873,"ip_address":"","comment_id":84733,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"老师，有关于加厚模式的书推荐么？\n或者介绍各种架构模式的资料。","like_count":2,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"蔡超","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446432,"discussion_content":"可以看看“面向模式的软件架构”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554970873,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":238085,"user_name":"包子","can_delete":false,"product_type":"c3","uid":1089345,"ip_address":"","ucode":"6CC4EBB8CD3924","user_header":"https://static001.geekbang.org/account/avatar/00/10/9f/41/82306dfe.jpg","comment_is_top":false,"comment_ctime":1596069145,"is_pvip":false,"replies":[{"id":88425,"content":"那这个采用多线程需要考虑\n1. 线程安全，可以考虑使用csp&#47;channel\n2. fliter分别获去数据，如pipe实现为channel，则filter接收channel中的数据","user_name":"作者回复","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1596523998,"ip_address":"","comment_id":238085,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"怎么让这个程序中的filter多线程执行","like_count":1,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"蔡超","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":502638,"discussion_content":"那这个采用多线程需要考虑\n1. 线程安全，可以考虑使用csp/channel\n2. fliter分别获去数据，如pipe实现为channel，则filter接收channel中的数据","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596523998,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":306398,"user_name":"yan","can_delete":false,"product_type":"c3","uid":1667264,"ip_address":"","ucode":"BA33B672798AEE","user_header":"https://static001.geekbang.org/account/avatar/00/19/70/c0/b365a317.jpg","comment_is_top":false,"comment_ctime":1628524589,"is_pvip":false,"replies":[{"id":110976,"content":"这是由于被依赖的go文件没有被加入编译，可以采用\n\ngo test -v .&#47;*","user_name":"作者回复","user_name_real":"蔡超","uid":1008262,"ctime":1628602969,"ip_address":"","comment_id":306398,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"我使用go test -v，依旧显示.&#47;split_filter_test.go:9:8: undefined: NewSplitFilter，这是什么原因啊","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"蔡超","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524746,"discussion_content":"这是由于被依赖的go文件没有被加入编译，可以采用\n\ngo test -v ./*","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1628602969,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":306397,"user_name":"yan","can_delete":false,"product_type":"c3","uid":1667264,"ip_address":"","ucode":"BA33B672798AEE","user_header":"https://static001.geekbang.org/account/avatar/00/19/70/c0/b365a317.jpg","comment_is_top":false,"comment_ctime":1628524279,"is_pvip":false,"replies":[{"id":110977,"content":"用以下命令行 运行\n\ngo test -v .&#47;*","user_name":"作者回复","user_name_real":"蔡超","uid":1008262,"ctime":1628603021,"ip_address":"","comment_id":306397,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"老师，我想问一下split_filter.go 和 split_filter_test.go 再同一个package下，为什么split_filter_test.go无法引入NewSplitFilter啊？搞了好久没搞明白，代码无法运行。","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"蔡超","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524745,"discussion_content":"用以下命令行 运行\n\ngo test -v ./*","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628603021,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":85851,"user_name":"NEVER SETTLE","can_delete":false,"product_type":"c3","uid":1101894,"ip_address":"","ucode":"9C86BDAFDBF768","user_header":"https://static001.geekbang.org/account/avatar/00/10/d0/46/1a9229b3.jpg","comment_is_top":false,"comment_ctime":1555257247,"is_pvip":false,"replies":[{"id":30906,"content":"不是，这里我期望返回错误，所以如果err为空就不符合预期了","user_name":"作者回复","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1555302353,"ip_address":"","comment_id":85851,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"func TestWrongInput(t *testing.T) {\n\tsf := NewSplitFilter(&quot;,&quot;)\n\t_, err := sf.Process(123)\n\tif err == nil {\n\t\tt.Fatal(&quot;An error is expected.&quot;)\n\t}\n}\n\n是不是 \nif err != nil {\n        t.Fatal(&quot;An error is expected.&quot;)\n}","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"蔡超","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446838,"discussion_content":"不是，这里我期望返回错误，所以如果err为空就不符合预期了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555302353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":237966,"user_name":"松小鼠","can_delete":false,"product_type":"c3","uid":1239277,"ip_address":"","ucode":"2AAA36A7C3AD75","user_header":"https://static001.geekbang.org/account/avatar/00/12/e8/ed/f9347e5e.jpg","comment_is_top":false,"comment_ctime":1596015450,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"这就是责任链+装饰器模式啊","like_count":5},{"had_liked":false,"id":228818,"user_name":"www","can_delete":false,"product_type":"c3","uid":1898338,"ip_address":"","ucode":"ADC9BC655EA16C","user_header":"https://static001.geekbang.org/account/avatar/00/1c/f7/62/947004d0.jpg","comment_is_top":false,"comment_ctime":1592817066,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"例子代码写得真好，细节中看到很多差距，学习了","like_count":3},{"had_liked":false,"id":287812,"user_name":"escray","can_delete":false,"product_type":"c3","uid":1020525,"ip_address":"","ucode":"1F4204930E47C4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","comment_is_top":false,"comment_ctime":1618155974,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"Filter 封装了数据处理功能，包括处理参数、填充、根据 Filter 内容召回广告或者排序\n\nFilter 就是给它数据，然后等待数据处理的结果，只和数据格式或者数据类型耦合，只要传递给他的数据格式或者类型可以处理\n\n在处理过程中可以加入新的 Filter 进行扩展\n\n分布式系统中的 Pipe 可能需要一个网络连接或者在异步环境中的 buffer，在进程内部，就是方法调用\n\npipe-filter framework 类似于 Unix 或者 Linux 的管道指令\n\n课程里面说可以形成组合模式，留言里面也有同学说类似于 责任链+装饰器模式","like_count":2},{"had_liked":false,"id":311527,"user_name":"o9","can_delete":false,"product_type":"c3","uid":1101332,"ip_address":"","ucode":"E373E82A39BBFE","user_header":"https://static001.geekbang.org/account/avatar/00/10/ce/14/b488f241.jpg","comment_is_top":false,"comment_ctime":1631267257,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"大佬好，不太理解 StraightPipeline 中的 `Filters *[]Filter` 为什么要声明成 切片指针类型呢","like_count":0},{"had_liked":false,"id":208186,"user_name":"Alvin-L","can_delete":false,"product_type":"c3","uid":1603052,"ip_address":"","ucode":"5AC96AAB75B720","user_header":"https://static001.geekbang.org/account/avatar/00/18/75/ec/c60b29f5.jpg","comment_is_top":false,"comment_ctime":1587295359,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"责任链模式。如果配合JAVA来对比说明可能效果会好一些。","like_count":0}]}