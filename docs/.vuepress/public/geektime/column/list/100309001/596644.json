{"id":596644,"title":"02ï½œç¼“å­˜ä¸€è‡´ï¼šè¯»å¤šå†™å°‘æ—¶ï¼Œå¦‚ä½•è§£å†³æ•°æ®æ›´æ–°ç¼“å­˜ä¸åŒæ­¥ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å¾é•¿é¾™ï¼Œæˆ‘ä»¬ç»§ç»­æ¥çœ‹ç”¨æˆ·ä¸­å¿ƒæ€§èƒ½æ”¹é€ çš„ç¼“å­˜æŠ€å·§ã€‚</p><p>ä¸ŠèŠ‚è¯¾æˆ‘ä»¬å¯¹æ•°æ®åšäº†å½’ç±»æ•´ç†ï¼Œè®©ç³»ç»Ÿçš„æ•°æ®æ›´å®¹æ˜“åšç¼“å­˜ã€‚ä¸ºäº†é™ä½æ•°æ®åº“çš„å‹åŠ›ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦é€æ­¥ç»™ç³»ç»Ÿå¢åŠ ç¼“å­˜ã€‚æ‰€ä»¥è¿™èŠ‚è¯¾ï¼Œæˆ‘ä¼šç»“åˆç”¨æˆ·ä¸­å¿ƒçš„ä¸€äº›ä¸šåŠ¡åœºæ™¯ï¼Œå¸¦ä½ çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ä¸´æ—¶ç¼“å­˜æˆ–é•¿æœŸç¼“å­˜åº”å¯¹é«˜å¹¶å‘æŸ¥è¯¢ï¼Œå¸®ä½ æŒæ¡é«˜å¹¶å‘æµé‡ä¸‹ç¼“å­˜æ•°æ®ä¸€è‡´æ€§çš„ç›¸å…³æŠ€å·§ã€‚</p><p>æˆ‘ä»¬ä¹‹å‰æåˆ°è¿‡ï¼Œäº’è”ç½‘å¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯çš„æ•°æ®éƒ½å±äºè¯»å¤šå†™å°‘ï¼Œåœ¨è¯·æ±‚çš„è¯»å†™æ¯”ä¾‹ä¸­ï¼Œå†™çš„æ¯”ä¾‹ä¼šè¾¾åˆ°ç™¾åˆ†ä¹‹ä¸€ï¼Œç”šè‡³åƒåˆ†ä¹‹ä¸€ã€‚</p><p>è€Œå¯¹äºç”¨æˆ·ä¸­å¿ƒçš„ä¸šåŠ¡æ¥è¯´ï¼Œè¿™ä¸ªæ¯”ä¾‹ä¼šæ›´å¤§ä¸€äº›ï¼Œæ¯•ç«Ÿç”¨æˆ·ä¸ä¼šé¢‘ç¹åœ°æ›´æ–°è‡ªå·±çš„ä¿¡æ¯å’Œå¯†ç ï¼Œæ‰€ä»¥è¿™ç§è¯»å¤šå†™å°‘çš„åœºæ™¯ç‰¹åˆ«é€‚åˆåšè¯»å–ç¼“å­˜ã€‚é€šè¿‡ç¼“å­˜å¯ä»¥å¤§å¤§é™ä½ç³»ç»Ÿæ•°æ®å±‚çš„æŸ¥è¯¢å‹åŠ›ï¼Œæ‹¥æœ‰æ›´å¥½çš„å¹¶å‘æŸ¥è¯¢æ€§èƒ½ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨ç¼“å­˜åå¾€å¾€ä¼šç¢°åˆ°æ›´æ–°ä¸åŒæ­¥çš„é—®é¢˜ï¼Œä¸‹é¢æˆ‘ä»¬å…·ä½“çœ‹ä¸€çœ‹ã€‚</p><h2>ç¼“å­˜æ€§ä»·æ¯”</h2><p>ç¼“å­˜å¯ä»¥æ»¥ç”¨å—ï¼Ÿåœ¨å¯¹ç”¨æˆ·ä¸­å¿ƒä¼˜åŒ–æ—¶ï¼Œä¸€å¼€å§‹å°±ç¢°åˆ°äº†è¿™ä¸ªæœ‰è¶£çš„é—®é¢˜ã€‚</p><p>å°±åƒåˆšæ‰æ‰€è¯´ï¼Œæˆ‘ä»¬è®¤ä¸ºç”¨æˆ·ä¿¡æ¯æ”¾è¿›ç¼“å­˜å¯ä»¥å¿«é€Ÿæé«˜æ€§èƒ½ï¼Œæ‰€ä»¥åœ¨ä¼˜åŒ–ä¹‹åˆï¼Œæˆ‘ä»¬ç¬¬ä¸€ä¸ªæƒ³åˆ°çš„å°±æ˜¯å°†ç”¨æˆ·ä¸­å¿ƒè´¦å·ä¿¡æ¯æ”¾åˆ°ç¼“å­˜ã€‚è¿™ä¸ªè¡¨æœ‰2000ä¸‡æ¡æ•°æ®ï¼Œä¸»è¦ç”¨é€”æ˜¯åœ¨ç”¨æˆ·ç™»å½•æ—¶ï¼Œé€šè¿‡ç”¨æˆ·æäº¤çš„è´¦å·å’Œå¯†ç å¯¹æ•°æ®åº“è¿›è¡Œæ£€ç´¢ï¼Œç¡®è®¤ç”¨æˆ·è´¦å·å’Œå¯†ç æ˜¯å¦æ­£ç¡®ï¼ŒåŒæ—¶æŸ¥çœ‹è´¦æˆ·æ˜¯å¦è¢«å°ç¦ï¼Œä»¥æ­¤æ¥åˆ¤å®šç”¨æˆ·æ˜¯å¦å¯ä»¥ç™»å½•ï¼š</p><!-- [[[read_end]]] --><pre><code class=\"language-sql\"># è¡¨ç»“æ„\nCREATE TABLE `accounts` (\n  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,\n  `account` varchar(15) NOT NULL DEFAULT '',\n  `password` char(32) NOT NULL,\n  `salt` char(16) NOT NULL,\n  `status` tinyint(3) NOT NULL DEFAULT '0'\n  `update_time` int(10) NOT NULL DEFAULT '0',\n  `create_time` int(10) NOT NULL DEFAULT '0',\n  PRIMARY KEY (`id`),\n) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n\n# ç™»å½•æŸ¥è¯¢\nselect id, account, update_time from accounts \nwhere account = 'user1'\nand password = '6b9260b1e02041a665d4e4a5117cfe16'\nand status = 1\n</code></pre><p>è¿™æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„æŸ¥è¯¢ï¼Œä½ å¯èƒ½ä¼šæƒ³ï¼šå¦‚æœæˆ‘ä»¬å°†2000ä¸‡çš„ç”¨æˆ·æ•°æ®æ”¾åˆ°ç¼“å­˜ï¼Œè‚¯å®šèƒ½æä¾›æ€§èƒ½å¾ˆå¥½çš„æœåŠ¡ã€‚</p><p>è¿™ä¸ªæƒ³æ³•æ˜¯å¯¹çš„ï¼Œä½†ä¸å…¨å¯¹ï¼Œå› ä¸ºå®ƒçš„æ€§ä»·æ¯”å¹¶ä¸é«˜ï¼šè¿™ä¸ªè¡¨æŸ¥è¯¢çš„åœºæ™¯ä¸»è¦ç”¨äºè´¦å·ç™»å½•ï¼Œç”¨æˆ·å³ä½¿é¢‘ç¹ç™»å½•ï¼Œä¹Ÿä¸ä¼šé€ æˆå¤ªå¤§çš„æµé‡å†²å‡»ã€‚å› æ­¤ï¼Œç¼“å­˜åœ¨å¤§éƒ¨åˆ†æ—¶é—´æ˜¯é—²ç½®çŠ¶æ€ï¼Œæˆ‘ä»¬æ²¡å¿…è¦å°†å¹¶å‘ä¸é«˜çš„æ•°æ®æ”¾åˆ°ç¼“å­˜å½“ä¸­ï¼Œæµªè´¹æˆ‘ä»¬çš„é¢„ç®—ã€‚</p><p>è¿™å°±ç‰µæ‰¯åˆ°äº†ä¸€ä¸ªå¾ˆæ ¸å¿ƒçš„é—®é¢˜ï¼Œ<strong>æˆ‘ä»¬åšç¼“å­˜æ˜¯è¦è€ƒè™‘æ€§ä»·æ¯”çš„</strong>ã€‚å¦‚æœæˆ‘ä»¬è´¹æ—¶è´¹åŠ›åœ°æŠŠä¸€äº›æ•°æ®æ”¾åˆ°ç¼“å­˜å½“ä¸­ï¼Œä½†å¹¶ä¸èƒ½æé«˜ç³»ç»Ÿçš„æ€§èƒ½ï¼Œåå€’è®©æˆ‘ä»¬æµªè´¹äº†å¤§é‡çš„æ—¶é—´å’Œé‡‘é’±ï¼Œé‚£å°±æ˜¯ä¸åˆé€‚çš„ã€‚æˆ‘ä»¬éœ€è¦è¯„ä¼°ç¼“å­˜æ˜¯å¦æœ‰æ•ˆï¼Œä¸€èˆ¬æ¥è¯´ï¼Œåªæœ‰çƒ­ç‚¹æ•°æ®æ”¾åˆ°ç¼“å­˜æ‰æ›´æœ‰ä»·å€¼ã€‚</p><h2>ä¸´æ—¶çƒ­ç¼“å­˜</h2><p>æ¨ç¿»å°†æ‰€æœ‰è´¦å·ä¿¡æ¯æ”¾åˆ°ç¼“å­˜è¿™ä¸ªæƒ³æ³•åï¼Œæˆ‘ä»¬æŠŠç›®æ ‡æ”¾åˆ°ä¼šè¢«é«˜é¢‘æŸ¥è¯¢çš„ä¿¡æ¯ä¸Šï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·ä¿¡æ¯ã€‚</p><p>ç”¨æˆ·ä¿¡æ¯çš„ä½¿ç”¨é¢‘ç‡å¾ˆé«˜ï¼Œåœ¨å¾ˆå¤šåœºæ™¯ä¸‹ä¼šè¢«é¢‘ç¹æŸ¥è¯¢å±•ç¤ºï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨è®ºå›ä¸Šçœ‹åˆ°çš„å‘å¸–äººå¤´åƒã€æ˜µç§°ã€æ€§åˆ«ç­‰ï¼Œè¿™äº›éƒ½æ˜¯éœ€è¦é¢‘ç¹å±•ç¤ºçš„æ•°æ®ï¼Œä¸è¿‡è¿™äº›æ•°æ®çš„æ€»é‡å¾ˆå¤§ï¼Œå…¨éƒ¨æ”¾å…¥ç¼“å­˜å¾ˆæµªè´¹ç©ºé—´ã€‚</p><p>å¯¹äºè¿™ç§æ•°æ®ï¼Œæˆ‘å»ºè®®ä½¿ç”¨ä¸´æ—¶ç¼“å­˜æ–¹å¼ï¼Œå°±æ˜¯åœ¨ç”¨æˆ·ä¿¡æ¯ç¬¬ä¸€æ¬¡è¢«ä½¿ç”¨çš„æ—¶å€™ï¼ŒåŒæ—¶å°†æ•°æ®æ”¾åˆ°ç¼“å­˜å½“ä¸­ï¼ŒçŸ­æœŸå†…å¦‚æœå†æ¬¡æœ‰ç±»ä¼¼çš„æŸ¥è¯¢å°±å¯ä»¥å¿«é€Ÿä»ç¼“å­˜ä¸­è·å–ã€‚è¿™ä¸ªæ–¹å¼èƒ½æœ‰æ•ˆé™ä½æ•°æ®åº“çš„æŸ¥è¯¢å‹åŠ›ã€‚å¸¸è§æ–¹å¼å®ç°çš„<strong>ä¸´æ—¶ç¼“å­˜</strong>çš„ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-go\">// å°è¯•ä»ç¼“å­˜ä¸­ç›´æ¥è·å–ç”¨æˆ·ä¿¡æ¯\nuserinfo, err := Redis.Get(\"user_info_9527\")\nif err != nil {\n  return nil, err\n}\n\n//ç¼“å­˜å‘½ä¸­æ‰¾åˆ°ï¼Œç›´æ¥è¿”å›ç”¨æˆ·ä¿¡æ¯\nif userinfo != nil {\n  return userinfo, nil\n}\n\n//æ²¡æœ‰å‘½ä¸­ç¼“å­˜ï¼Œä»æ•°æ®åº“ä¸­è·å–\nuserinfo, err := userInfoModel.GetUserInfoById(9527)\nif err != nil {\n  return nil, err\n}\n\n//æŸ¥æ‰¾åˆ°ç”¨æˆ·ä¿¡æ¯\nif userinfo != nil {\n  //å°†ç”¨æˆ·ä¿¡æ¯ç¼“å­˜ï¼Œå¹¶è®¾ç½®TTLè¶…æ—¶æ—¶é—´è®©å…¶60ç§’åå¤±æ•ˆ\n  Redis.Set(\"user_info_9527\", userinfo, 60)\n  return userinfo, nil\n}\n\n// æ²¡æœ‰æ‰¾åˆ°ï¼Œæ”¾ä¸€ä¸ªç©ºæ•°æ®è¿›å»ï¼ŒçŸ­æœŸå†…ä¸å†é—®æ•°æ®åº“\n// å¯é€‰ï¼Œè¿™ä¸ªæ˜¯ç”¨æ¥é¢„é˜²ç¼“å­˜ç©¿é€æŸ¥è¯¢æ”»å‡»çš„\nRedis.Set(\"user_info_9527\", \"\", 30)\nreturn nil, nil\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„æ•°æ®åªæ˜¯ä¸´æ—¶æ”¾åˆ°ç¼“å­˜ï¼Œç­‰å¾…60ç§’è¿‡æœŸåæ•°æ®å°±ä¼šè¢«æ·˜æ±°ï¼Œå¦‚æœæœ‰åŒæ ·çš„æ•°æ®æŸ¥è¯¢éœ€è¦ï¼Œæˆ‘ä»¬çš„ä»£ç ä¼šå°†æ•°æ®é‡æ–°å¡«å…¥ç¼“å­˜ç»§ç»­ä½¿ç”¨ã€‚è¿™ç§ä¸´æ—¶ç¼“å­˜é€‚åˆè¡¨ä¸­æ•°æ®é‡å¤§ï¼Œä½†çƒ­æ•°æ®å°‘çš„æƒ…å†µï¼Œå¯ä»¥é™ä½çƒ­ç‚¹æ•°æ®çš„å‹åŠ›ã€‚</p><p>è€Œä¹‹æ‰€ä»¥ç»™ç¼“å­˜è®¾ç½®æ•°æ®TTLï¼Œæ˜¯ä¸ºäº†èŠ‚çœæˆ‘ä»¬çš„å†…å­˜ç©ºé—´ã€‚å½“æ•°æ®åœ¨ä¸€æ®µæ—¶é—´å†…ä¸è¢«ä½¿ç”¨åå°±ä¼šè¢«æ·˜æ±°ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨è´­ä¹°å¤ªå¤§çš„å†…å­˜äº†ã€‚è¿™ç§æ–¹å¼ç›¸å¯¹æ¥è¯´æœ‰æé«˜çš„æ€§ä»·æ¯”ï¼Œå¹¶ä¸”ç»´æŠ¤ç®€å•ï¼Œå¾ˆå¸¸ç”¨ã€‚</p><h2>ç¼“å­˜æ›´æ–°ä¸åŠæ—¶é—®é¢˜</h2><p>ä¸´æ—¶ç¼“å­˜æ˜¯æœ‰TTLçš„ï¼Œå¦‚æœ60ç§’å†…ä¿®æ”¹äº†ç”¨æˆ·çš„æ˜µç§°ï¼Œç¼“å­˜æ˜¯ä¸ä¼šé©¬ä¸Šæ›´æ–°çš„ã€‚æœ€ç³Ÿç³•çš„æƒ…å†µæ˜¯åœ¨60ç§’åæ‰ä¼šåˆ·æ–°è¿™ä¸ªç”¨æˆ·çš„æ˜µç§°ç¼“å­˜ï¼Œæ˜¾ç„¶è¿™ä¼šç»™ç³»ç»Ÿå¸¦æ¥ä¸€äº›ä¸å¿…è¦çš„éº»çƒ¦ã€‚å…¶å®å¯¹äºè¿™ç§ç¼“å­˜æ•°æ®åˆ·æ–°ï¼Œå¯ä»¥åˆ†æˆå‡ ç§æƒ…å†µï¼Œä¸åŒæƒ…å†µçš„åˆ·æ–°æ–¹å¼æœ‰æ‰€ä¸åŒï¼Œæ¥ä¸‹æ¥æˆ‘ç»™ä½ åˆ†åˆ«è®²è®²ã€‚</p><h3>1.å•æ¡å®ä½“æ•°æ®ç¼“å­˜åˆ·æ–°</h3><p>å•æ¡å®ä½“æ•°æ®ç¼“å­˜æ›´æ–°æ˜¯æœ€ç®€å•çš„ä¸€ä¸ªæ–¹å¼ï¼Œæ¯”å¦‚æˆ‘ä»¬ç¼“å­˜äº†9527è¿™ä¸ªç”¨æˆ·çš„infoä¿¡æ¯ï¼Œå½“æˆ‘ä»¬å¯¹è¿™æ¡æ•°æ®åšäº†ä¿®æ”¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æ•°æ®æ›´æ–°æ—¶åŒæ­¥æ›´æ–°å¯¹åº”çš„æ•°æ®ç¼“å­˜ï¼š</p><pre><code class=\"language-go\">Type UserInfo struct {\n\tId         int    `gorm:\"column:id;type:int(11);primary_key;AUTO_INCREMENT\" json:\"id\"`\n\tUid        int    `gorm:\"column:uid;type:int(4);NOT NULL\" json:\"uid\"`\n\tNickName   string `gorm:\"column:nickname;type:varchar(32) unsigned;NOT NULL\" json:\"nickname\"`\n\tStatus     int16  `gorm:\"column:status;type:tinyint(4);default:1;NOT NULL\" json:\"status\"`\n\tCreateTime int64  `gorm:\"column:create_time;type:bigint(11);NOT NULL\" json:\"create_time\"`\n\tUpdateTime int64  `gorm:\"column:update_time;type:bigint(11);NOT NULL\" json:\"update_time\"`\n}\n\n//æ›´æ–°ç”¨æˆ·æ˜µç§°\nfunc (m *UserInfo)UpdateUserNickname(ctx context.Context, name string, uid int) (bool, int64, error) {\n\t//å…ˆæ›´æ–°æ•°æ®åº“\n  ret, err := m.db.UpdateUserNickNameById(ctx, uid, name)\n\tif ret {\n        //ç„¶åæ¸…ç†ç¼“å­˜ï¼Œè®©ä¸‹æ¬¡è¯»å–æ—¶åˆ·æ–°ç¼“å­˜ï¼Œé˜²æ­¢å¹¶å‘ä¿®æ”¹å¯¼è‡´ä¸´æ—¶æ•°æ®è¿›å…¥ç¼“å­˜\n        //è¿™ä¸ªæ–¹å¼åˆ·æ–°è¾ƒå¿«ï¼Œä½¿ç”¨å¾ˆæ–¹ä¾¿ï¼Œç»´æŠ¤æˆæœ¬ä½\n\t\tRedis.Del(\"user_info_\" + strconv.Itoa(uid))\n\t}\n\treturn ret, count, err\n}\n\n</code></pre><p>æ•´ä½“æ¥è®²å°±æ˜¯å…ˆè¯†åˆ«å‡ºè¢«ä¿®æ”¹æ•°æ®çš„IDï¼Œç„¶åæ ¹æ®IDåˆ é™¤è¢«ä¿®æ”¹çš„æ•°æ®ç¼“å­˜ï¼Œç­‰ä¸‹æ¬¡è¯·æ±‚åˆ°æ¥æ—¶ï¼Œå†æŠŠæœ€æ–°çš„æ•°æ®æ›´æ–°åˆ°ç¼“å­˜ä¸­ï¼Œè¿™æ ·å°±ä¼šæœ‰æ•ˆå‡å°‘å¹¶å‘æ“ä½œæŠŠè„æ•°æ®å¸¦å…¥ç¼“å­˜çš„å¯èƒ½æ€§ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç»™é˜Ÿåˆ—å‘æ›´æ–°æ¶ˆæ¯è®©å­ç³»ç»Ÿæ›´æ–°ï¼Œè¿˜å¯ä»¥å¼€å‘ä¸­é—´ä»¶æŠŠæ•°æ®æ“ä½œå‘ç»™å­ç³»ç»Ÿï¼Œè‡ªè¡Œå†³å®šæ›´æ–°çš„æ•°æ®èŒƒå›´ã€‚</p><p>ä¸è¿‡ï¼Œé€šè¿‡é˜Ÿåˆ—æ›´æ–°æ¶ˆæ¯è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬è¿˜ä¼šç¢°åˆ°ä¸€ä¸ªé—®é¢˜â€”â€”æ¡ä»¶æ‰¹é‡æ›´æ–°çš„æ“ä½œæ— æ³•çŸ¥é“å…·ä½“æœ‰å¤šå°‘ä¸ªIDå¯èƒ½æœ‰ä¿®æ”¹ï¼Œå¸¸è§çš„åšæ³•æ˜¯ï¼šå…ˆç”¨åŒæ ·çš„æ¡ä»¶æŠŠæ‰€æœ‰æ¶‰åŠçš„IDéƒ½å–å‡ºæ¥ï¼Œç„¶åupdateï¼Œè¿™æ—¶ç”¨æ‰€æœ‰ç›¸å…³IDæ›´æ–°å…·ä½“ç¼“å­˜å³å¯ã€‚</p><h3>2. å…³ç³»å‹å’Œç»Ÿè®¡å‹æ•°æ®ç¼“å­˜åˆ·æ–°</h3><p>å…³ç³»å‹æˆ–ç»Ÿè®¡å‹ç¼“å­˜åˆ·æ–°æœ‰å¾ˆå¤šç§æ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ç»™ä½ è®²ä¸€äº›æœ€å¸¸ç”¨çš„ã€‚</p><p>é¦–å…ˆæ˜¯<strong>äººå·¥ç»´æŠ¤ç¼“å­˜æ–¹å¼</strong>ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå…³ç³»å‹æ•°æ®æˆ–ç»Ÿè®¡ç»“æœç¼“å­˜åˆ·æ–°å­˜åœ¨ä¸€å®šéš¾åº¦ï¼Œæ ¸å¿ƒåœ¨äºè¿™äº›ç»Ÿè®¡æ˜¯ç”±å¤šæ¡æ•°æ®è®¡ç®—è€Œæˆçš„ã€‚å½“æˆ‘ä»¬å¯¹è¿™ç±»æ•°æ®æ›´æ–°ç¼“å­˜æ—¶ï¼Œå¾ˆéš¾è¯†åˆ«å‡ºéœ€è¦åˆ·æ–°å“ªäº›<strong>å…³è”</strong>ç¼“å­˜ã€‚å¯¹æ­¤ï¼Œæˆ‘ä»¬éœ€è¦äººå·¥åœ¨ä¸€ä¸ªåœ°æ–¹è®°å½•æˆ–è€…å®šä¹‰ç‰¹æ®Šåˆ·æ–°é€»è¾‘æ¥å®ç°ç›¸å…³ç¼“å­˜çš„æ›´æ–°ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/0a/cc/0a1ea9f053fa3c3cb8byy041d2070ecc.jpg?wh=1920x1234\" alt=\"å›¾ç‰‡\" title=\"äººå·¥ç»´æŠ¤ç¼“å­˜\"></p><p>ä¸è¿‡è¿™ç§æ–¹å¼æ¯”è¾ƒç²¾ç»†ï¼Œ<strong>å¦‚æœåˆ·æ–°ç¼“å­˜å¾ˆå¤šï¼Œé‚£ä¹ˆç¼“å­˜æ›´æ–°ä¼šæ¯”è¾ƒæ…¢ï¼Œå¹¶ä¸”å­˜åœ¨å»¶è¿Ÿ</strong>ã€‚è€Œä¸”äººå·¥ä¹¦å†™è¿˜éœ€è¦è€ƒè™‘å¦‚ä½•æŸ¥æ‰¾åˆ°æ–°å¢æ•°æ®å…³è”çš„æ‰€æœ‰IDï¼Œå› ä¸ºæ–°å¢æ•°æ®æ²¡æœ‰ç™»è®°åœ¨IDå†…ï¼Œäººå·¥ç¼–ç ç»´æŠ¤ä¼šå¾ˆéº»çƒ¦ã€‚</p><p>é™¤äº†äººå·¥ç»´æŠ¤ç¼“å­˜å¤–ï¼Œè¿˜æœ‰ä¸€ç§æ–¹å¼å°±æ˜¯é€šè¿‡<strong>è®¢é˜…æ•°æ®åº“æ¥æ‰¾åˆ°IDæ•°æ®å˜åŒ–ã€‚</strong>å¦‚ä¸‹å›¾ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Maxwellæˆ–Canalï¼Œå¯¹MySQLçš„æ›´æ–°è¿›è¡Œç›‘æ§ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/48/7f/4833ec768edc882d4f081338e00aee7f.jpg?wh=1920x775\" alt=\"å›¾ç‰‡\" title=\"é€šè¿‡è®°å½•IDå…³ç³»åˆ·æ–°ç¼“å­˜\"></p><p>è¿™æ ·å˜æ›´ä¿¡æ¯ä¼šæ¨é€åˆ°Kafkaå†…ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å¯¹åº”çš„è¡¨å’Œå…·ä½“çš„SQLç¡®è®¤æ›´æ–°æ¶‰åŠçš„æ•°æ®IDï¼Œç„¶åæ ¹æ®è„šæœ¬å†…è®¾å®šå¥½çš„é€»è¾‘å¯¹ç›¸ å…³keyè¿›è¡Œæ›´æ–°ã€‚ä¾‹å¦‚ç”¨æˆ·æ›´æ–°äº†æ˜µç§°ï¼Œé‚£ä¹ˆç¼“å­˜æ›´æ–°æœåŠ¡å°±èƒ½çŸ¥é“éœ€è¦æ›´æ–°user_info_9527è¿™ä¸ªç¼“å­˜ï¼ŒåŒæ—¶æ ¹æ®é…ç½®æ‰¾åˆ°å¹¶ä¸”åˆ é™¤å…¶ä»–æ‰€æœ‰ç›¸å…³çš„ç¼“å­˜ã€‚</p><p>å¾ˆæ˜¾ç„¶ï¼Œè¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯èƒ½åŠæ—¶æ›´æ–°ç®€å•çš„ç¼“å­˜ï¼ŒåŒæ—¶æ ¸å¿ƒç³»ç»Ÿä¼šç»™å­ç³»ç»Ÿå¹¿æ’­åŒæ­¥æ•°æ®æ›´æ”¹ï¼Œä»£ç ä¹Ÿä¸å¤æ‚ï¼›ç¼ºç‚¹æ˜¯å¤æ‚çš„å…³è”å…³ç³»åˆ·æ–°ï¼Œä»æ—§éœ€è¦é€šè¿‡äººå·¥å†™é€»è¾‘æ¥å®ç°ã€‚</p><p>å¦‚æœæˆ‘ä»¬è¡¨å†…çš„æ•°æ®æ›´æ–°å¾ˆå°‘ï¼Œé‚£ä¹ˆå¯ä»¥é‡‡ç”¨<strong>ç‰ˆæœ¬å·ç¼“å­˜è®¾è®¡</strong>ã€‚</p><p>è¿™ä¸ªæ–¹å¼æ¯”è¾ƒç‹‚æ”¾ï¼šä¸€æ—¦æœ‰ä»»ä½•æ›´æ–°ï¼Œæ•´ä¸ªè¡¨å†…æ‰€æœ‰æ•°æ®ç¼“å­˜ä¸€èµ·è¿‡æœŸã€‚æ¯”å¦‚å¯¹user_infoè¡¨è®¾ç½®ä¸€ä¸ªkeyï¼Œå‡è®¾æ˜¯user_info_versionï¼Œå½“æˆ‘ä»¬æ›´æ–°è¿™ä¸ªè¡¨æ•°æ®æ—¶ï¼Œç›´æ¥å¯¹ user_info_version è¿›è¡Œincr +1ã€‚è€Œåœ¨å†™å…¥ç¼“å­˜æ—¶ï¼ŒåŒæ—¶ä¼šåœ¨ç¼“å­˜æ•°æ®ä¸­è®°å½•user_info_versionçš„å½“å‰å€¼ã€‚</p><p>å½“ä¸šåŠ¡è¦è¯»å–user_infoæŸä¸ªç”¨æˆ·çš„ä¿¡æ¯çš„æ—¶å€™ï¼Œä¸šåŠ¡ä¼šåŒæ—¶è·å–å½“å‰è¡¨çš„versionã€‚å¦‚æœå‘ç°ç¼“å­˜æ•°æ®å†…çš„ç‰ˆæœ¬å’Œå½“å‰è¡¨çš„ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆå°±ä¼šæ›´æ–°è¿™æ¡æ•°æ®ã€‚ä½†å¦‚æœversionæ›´æ–°å¾ˆé¢‘ç¹ï¼Œå°±ä¼šä¸¥é‡é™ä½ç¼“å­˜å‘½ä¸­ç‡ï¼Œæ‰€ä»¥è¿™ç§æ–¹æ¡ˆé€‚åˆæ›´æ–°å¾ˆå°‘çš„è¡¨ã€‚</p><p>å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¹è¿™ä¸ªè¡¨åšä¸€ä¸ªèŒƒå›´æ‹†åˆ†ï¼Œæ¯”å¦‚æŒ‰IDèŒƒå›´åˆ†å—æ‹†åˆ†å‡ºå¤šä¸ªversionï¼Œé€šè¿‡è¿™æ ·çš„æ–¹å¼æ¥å‡å°‘ç¼“å­˜åˆ·æ–°çš„èŒƒå›´å’Œé¢‘ç‡ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b9/11/b97a93c01cc98e68a01d73b920115311.jpg?wh=1920x1234\" alt=\"å›¾ç‰‡\" title=\"ç‰ˆæœ¬å·æ–¹å¼åˆ·æ–°ç¼“å­˜\"></p><p>æ­¤å¤–ï¼Œå…³è”å‹æ•°æ®æ›´æ–°è¿˜å¯ä»¥é€šè¿‡è¯†åˆ«<strong>ä¸»è¦å®ä½“ID</strong>æ¥åˆ·æ–°ç¼“å­˜ã€‚è¿™è¦ä¿è¯å…¶ä»–ç¼“å­˜ä¿å­˜çš„keyä¹Ÿæ˜¯ä¸»è¦å®ä½“IDï¼Œè¿™æ ·å½“æŸä¸€æ¡å…³è”æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°±å¯ä»¥æ ¹æ®ä¸»è¦å®ä½“IDå¯¹æ‰€æœ‰ç¼“å­˜è¿›è¡Œåˆ·æ–°ã€‚è¿™ä¸ªæ–¹å¼çš„ç¼ºç‚¹æ˜¯ï¼Œæˆ‘ä»¬çš„ç¼“å­˜è¦èƒ½å¤Ÿæ ¹æ®ä¿®æ”¹çš„æ•°æ®åå‘æ‰¾åˆ°å®ƒå…³è”çš„ä¸»ä½“IDæ‰è¡Œã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/3d/c1/3dfccf998db897ea07705621a06323c1.jpg?wh=1920x854\" alt=\"å›¾ç‰‡\" title=\"é€šè¿‡ä¸»è¦å®ä½“IDåˆ·æ–°ç¼“å­˜\"></p><p>æœ€åï¼Œæˆ‘å†ç»™ä½ ä»‹ç»ä¸€ç§æ–¹å¼ï¼š<strong>å¼‚æ­¥è„šæœ¬éå†æ•°æ®åº“åˆ·æ–°æ‰€æœ‰ç›¸å…³ç¼“å­˜</strong>ã€‚è¿™ä¸ªæ–¹å¼é€‚ç”¨äºä¸¤ä¸ªç³»ç»Ÿä¹‹é—´åŒæ­¥æ•°æ®ï¼Œèƒ½å¤Ÿå‡å°‘ç³»ç»Ÿé—´çš„æ¥å£äº¤äº’ï¼›ç¼ºç‚¹æ˜¯åˆ é™¤æ•°æ®åï¼Œè¿˜éœ€è¦äººå·¥åˆ é™¤å¯¹åº”çš„ç¼“å­˜ï¼Œæ‰€ä»¥æ›´æ–°ä¼šæœ‰å»¶è¿Ÿã€‚ä½†å¦‚æœèƒ½é…åˆè®¢é˜…æ›´æ–°æ¶ˆæ¯å¹¿æ’­çš„è¯ï¼Œå¯ä»¥åšåˆ°å‡†åŒæ­¥ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/2c/c8/2cd645766ac43cf90aa5ddd5258898c8.jpg?wh=1920x811\" alt=\"å›¾ç‰‡\" title=\"éå†æ•°æ®åº“åˆ·æ–°ç¼“å­˜\"></p><h2>é•¿æœŸçƒ­æ•°æ®ç¼“å­˜</h2><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å†å›è¿‡å¤´çœ‹çœ‹ä¹‹å‰çš„ä¸´æ—¶ç¼“å­˜ä¼ªä»£ç ï¼Œå®ƒè™½ç„¶èƒ½è§£å†³å¤§éƒ¨åˆ†é—®é¢˜ï¼Œä½†æ˜¯è¯·ä½ æƒ³ä¸€æƒ³ï¼Œå½“TTLåˆ°æœŸæ—¶ï¼Œ<strong>å¦‚æœå¤§é‡ç¼“å­˜è¯·æ±‚æ²¡æœ‰å‘½ä¸­ï¼Œé€ä¼ çš„æµé‡ä¼šä¸ä¼šæ‰“æ²‰æˆ‘ä»¬çš„æ•°æ®åº“ï¼Ÿ</strong>è¿™å…¶å®å°±æ˜¯è¡Œä¸šé‡Œå¸¸æåˆ°çš„ç¼“å­˜ç©¿é€é—®é¢˜ï¼Œå¦‚æœç¼“å­˜å‡ºç°å¤§è§„æ¨¡å¹¶å‘ç©¿é€ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½å¯¼è‡´æˆ‘ä»¬æœåŠ¡å®•æœºã€‚</p><p>æ‰€ä»¥ï¼Œæ•°æ®åº“è¦æ˜¯æ‰›ä¸ä½å¹³æ—¶çš„æµé‡ï¼Œæˆ‘ä»¬å°±ä¸èƒ½ä½¿ç”¨<strong>ä¸´æ—¶ç¼“å­˜</strong>çš„æ–¹å¼å»è®¾è®¡ç¼“å­˜ç³»ç»Ÿï¼Œåªèƒ½ç”¨<strong>é•¿æœŸç¼“å­˜</strong>è¿™ç§æ–¹å¼æ¥å®ç°<strong>çƒ­ç‚¹ç¼“å­˜</strong>ï¼Œä»¥æ­¤é¿å…ç¼“å­˜ç©¿é€æ‰“æ²‰æ•°æ®åº“çš„é—®é¢˜ã€‚ä¸è¿‡ï¼Œè¦æƒ³å®ç°é•¿æœŸç¼“å­˜ï¼Œå°±éœ€è¦æˆ‘ä»¬äººå·¥åšæ›´å¤šçš„äº‹æƒ…æ¥ä¿æŒç¼“å­˜å’Œæ•°æ®è¡¨æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p><p>è¦çŸ¥é“ï¼Œé•¿æœŸç¼“å­˜è¿™ä¸ªæ–¹å¼è‡ªNoSQLå…´èµ·åæ‰å¾—ä»¥æ™®åŠä½¿ç”¨ï¼Œä¸»è¦åŸå› åœ¨äºé•¿æœŸç¼“å­˜çš„å®ç°å’Œä¸´æ—¶ç¼“å­˜æœ‰æ‰€ä¸åŒï¼Œå®ƒè¦æ±‚æˆ‘ä»¬çš„ä¸šåŠ¡<strong>å‡ ä¹å®Œå…¨ä¸èµ°æ•°æ®åº“</strong>ï¼Œå¹¶ä¸”æœåŠ¡è¿è½¬æœŸé—´æ‰€éœ€çš„æ•°æ®éƒ½è¦èƒ½åœ¨ç¼“å­˜ä¸­æ‰¾åˆ°ï¼ŒåŒæ—¶è¿˜è¦ä¿è¯ä½¿ç”¨æœŸé—´ç¼“å­˜ä¸ä¼šä¸¢å¤±ã€‚</p><p>ç”±æ­¤å¸¦æ¥çš„é—®é¢˜å°±æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ç¼“å­˜ä¸­å…·ä½“æœ‰å“ªäº›æ•°æ®ï¼Œç„¶åæå‰å¯¹è¿™äº›æ•°æ®è¿›è¡Œé¢„çƒ­ã€‚å½“ç„¶ï¼Œå¦‚æœæ•°æ®è§„æ¨¡è¾ƒå°ï¼Œé‚£æˆ‘ä»¬å¯ä»¥è€ƒè™‘æŠŠå…¨é‡æ•°æ®éƒ½ç¼“å­˜èµ·æ¥ï¼Œè¿™æ ·ä¼šç›¸å¯¹ç®€å•ä¸€äº›ã€‚</p><p>ä¸ºäº†åŠ æ·±ç†è§£ï¼ŒåŒæ—¶å±•ç¤ºç‰¹æ®ŠæŠ€å·§ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ç§â€œä¸´æ—¶ç¼“å­˜+é•¿æœŸçƒ­ç¼“å­˜â€çš„ä¸€ä¸ªæœ‰è¶£çš„å®ç°ï¼Œè¿™ç§æ–¹å¼ä¼šæœ‰å°è§„æ¨¡ç¼“å­˜ç©¿é€ï¼Œå¹¶ä¸”ä»£ç ç›¸å¯¹å¤æ‚ï¼Œä¸è¿‡æ€»ä½“æ¥è¯´æˆæœ¬æ˜¯æ¯”è¾ƒä½çš„ï¼š</p><pre><code class=\"language-go\">// å°è¯•ä»ç¼“å­˜ä¸­ç›´æ¥è·å–ç”¨æˆ·ä¿¡æ¯\nuserinfo, err := Redis.Get(\"user_info_9527\")\nif err != nil {\n  return nil, err\n}\n\n//ç¼“å­˜å‘½ä¸­æ‰¾åˆ°ï¼Œç›´æ¥è¿”å›ç”¨æˆ·ä¿¡æ¯\nif userinfo != nil {\n  return userinfo, nil\n}\n\n//set æ£€æµ‹å½“å‰æ˜¯å¦æ˜¯çƒ­æ•°æ®\n//ä¹‹æ‰€ä»¥æ²¡æœ‰ä½¿ç”¨Bloom Filteræ˜¯å› ä¸ºæœ‰æ¦‚ç‡ç¢°æ’ä¸å‡†\n//å¦‚æœkeyæ•°é‡è¶…è¿‡åƒä¸ªï¼Œå»ºè®®è¿˜æ˜¯ç”¨Bloom Filter\n//è¿™ä¸ªåˆ¤æ–­ä¹Ÿå¯ä»¥æ”¾åœ¨ä¸šåŠ¡é€»è¾‘ä»£ç ä¸­ï¼Œç”¨é…ç½®åŒæ­¥åš\nisHotKey, err := Redis.SISMEMBER(\"hot_key\", \"user_info_9527\")\nif err != nil {\n  return nil, err\n}\n\n//å¦‚æœæ˜¯çƒ­key\nif isHotKey {\n  //æ²¡æœ‰æ‰¾åˆ°å°±è®¤ä¸ºæ•°æ®ä¸å­˜åœ¨\n  //å¯èƒ½æ˜¯è¢«åˆ é™¤äº†\n  return \"\", nil\n}\n\n//æ²¡æœ‰å‘½ä¸­ç¼“å­˜ï¼Œå¹¶ä¸”æ²¡è¢«æ ‡æ³¨æ˜¯çƒ­ç‚¹ï¼Œè¢«è®¤ä¸ºæ˜¯ä¸´æ—¶ç¼“å­˜ï¼Œé‚£ä¹ˆä»æ•°æ®åº“ä¸­è·å–\n//è®¾ç½®æ›´æ–°é”set user_info_9527_lock nx ex 5\n//é˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶å¹¶å‘æŸ¥è¯¢æ•°æ®åº“å¯¼è‡´æ•°æ®åº“å‹åŠ›è¿‡å¤§\nlock, err := Redis.Set(\"user_info_9527_lock\", \"1\", \"nx\", 5)\nif !lock {\n  //æ²¡æŠ¢åˆ°é”çš„ç›´æ¥ç­‰å¾…1ç§’ ç„¶åå†æ‹¿ä¸€æ¬¡ç»“æœï¼Œç±»ä¼¼singleflightå®ç°\n  //è¡Œä¸šå¸¸è§ç¼“å­˜æœåŠ¡ï¼Œè¯»å¹¶å‘èƒ½åŠ›å¾ˆå¼ºï¼Œä½†å†™å¹¶å‘èƒ½åŠ›å¹¶ä¸å¥½\n  //è¿‡é«˜çš„å¹¶è¡Œåˆ·æ–°ä¼šåˆ·æ²‰ç¼“å­˜\n  time.sleep( time.second)\n  //ç­‰1ç§’åæ‹¿æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®æ˜¯æŠ¢åˆ°é”çš„è¯·æ±‚å¡«å…¥çš„\n  //é€šè¿‡è¿™ä¸ªæ–¹å¼é™ä½æ•°æ®åº“å‹åŠ›\n  userinfo, err := Redis.Get(\"user_info_9527\")\n  if err != nil {\n    return nil, err\n  }\n  return userinfo,nil\n}\n\n//æ‹¿åˆ°é”çš„æŸ¥æ•°æ®åº“ï¼Œç„¶åå¡«å…¥ç¼“å­˜\nuserinfo, err := userInfoModel.GetUserInfoById(9527)\nif err != nil {\n  return nil, err\n}\n\n//æŸ¥æ‰¾åˆ°ç”¨æˆ·ä¿¡æ¯\nif userinfo != nil {\n  //å°†ç”¨æˆ·ä¿¡æ¯ç¼“å­˜ï¼Œå¹¶è®¾ç½®TTLè¶…æ—¶æ—¶é—´è®©å…¶60ç§’åå¤±æ•ˆ\n  Redis.Set(\"user_info_9527\", userinfo, 60)\n  return userinfo, nil\n}\n\n// æ²¡æœ‰æ‰¾åˆ°ï¼Œæ”¾ä¸€ä¸ªç©ºæ•°æ®è¿›å»ï¼ŒçŸ­æœŸå†…ä¸å†é—®æ•°æ®åº“\nRedis.Set(\"user_info_9527\", \"\", 30)\nreturn nil, nil\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ç§æ–¹å¼æ˜¯é•¿æœŸç¼“å­˜å’Œä¸´æ—¶ç¼“å­˜çš„æ··ç”¨ã€‚å½“æˆ‘ä»¬è¦æŸ¥è¯¢æŸä¸ªç”¨æˆ·ä¿¡æ¯æ—¶ï¼Œå¦‚æœç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®ï¼Œé•¿æœŸç¼“å­˜ä¼šç›´æ¥è¿”å›æ²¡æœ‰æ‰¾åˆ°ï¼Œä¸´æ—¶ç¼“å­˜åˆ™ç›´æ¥èµ°æ›´æ–°æµç¨‹ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬çš„ç”¨æˆ·ä¿¡æ¯å¦‚æœå±äºçƒ­ç‚¹keyï¼Œå¹¶ä¸”åœ¨ç¼“å­˜ä¸­æ‰¾ä¸åˆ°çš„è¯ï¼Œå°±ç›´æ¥è¿”å›æ•°æ®ä¸å­˜åœ¨ã€‚</p><p>åœ¨æ›´æ–°æœŸé—´ï¼Œä¸ºäº†é˜²æ­¢é«˜å¹¶å‘æŸ¥è¯¢æ‰“æ²‰æ•°æ®åº“ï¼Œæˆ‘ä»¬å°†æ›´æ–°æµç¨‹åšäº†ç®€å•çš„singleflightï¼ˆè¯·æ±‚åˆå¹¶ï¼‰ä¼˜åŒ–ï¼Œåªæœ‰å…ˆæŠ¢åˆ°ç¼“å­˜æ›´æ–°é”çš„çº¿ç¨‹ï¼Œæ‰èƒ½è¿›å…¥åç«¯è¯»å–æ•°æ®åº“å¹¶å°†ç»“æœå¡«å†™åˆ°ç¼“å­˜ä¸­ã€‚è€Œæ²¡æœ‰æŠ¢åˆ°æ›´æ–°é”çš„çº¿ç¨‹å…ˆ sleep 1ç§’ï¼Œç„¶åç›´æ¥è¯»å–ç¼“å­˜è¿”å›ç»“æœã€‚è¿™æ ·å¯ä»¥ä¿è¯åç«¯ä¸ä¼šæœ‰å¤šä¸ªçº¿ç¨‹è¯»å–åŒä¸€æ¡æ•°æ®ï¼Œä»è€Œå†²å®ç¼“å­˜å’Œæ•°æ®åº“æœåŠ¡ï¼ˆç¼“å­˜çš„å†™å¹¶å‘æ²¡æœ‰è¯»æ€§èƒ½é‚£ä¹ˆå¥½ï¼‰ã€‚</p><p>å¦å¤–ï¼Œhot_keyåˆ—è¡¨ï¼ˆä¹Ÿå°±æ˜¯é•¿æœŸç¼“å­˜çš„çƒ­ç‚¹keyåˆ—è¡¨ï¼‰ä¼šåœ¨å¤šä¸ªRedisä¸­å¤åˆ¶ä¿å­˜ï¼Œå¦‚æœè¦è¯»å–å®ƒï¼Œéšæœºæ‰¾ä¸€ä¸ªåˆ†ç‰‡å°±å¯ä»¥æ‹¿åˆ°å…¨é‡é…ç½®ã€‚</p><p>è¿™äº›çƒ­ç¼“å­˜keyï¼Œæ¥è‡ªäºç»Ÿè®¡ä¸€æ®µæ—¶é—´å†…æ•°æ®è®¿é—®æµé‡ï¼Œè®¡ç®—å¾—å‡ºçš„çƒ­ç‚¹æ•°æ®ã€‚é‚£é•¿æœŸç¼“å­˜çš„æ›´æ–°ä¼šå¼‚æ­¥è„šæœ¬å»å®šæœŸæ‰«æçƒ­ç¼“å­˜åˆ—è¡¨ï¼Œé€šè¿‡è¿™ä¸ªæ–¹å¼æ¥ä¸»åŠ¨æ¨é€ç¼“å­˜ï¼ŒåŒæ—¶æŠŠTTLè®¾ç½®æˆæ›´é•¿çš„æ—¶é—´ï¼Œæ¥ä¿è¯æ–°çš„çƒ­æ•°æ®ç¼“å­˜ä¸ä¼šè¿‡æœŸã€‚å½“è¿™ä¸ªkeyçš„çƒ­åº¦è¿‡å»åï¼Œçƒ­ç¼“å­˜keyå°±ä¼šä»å½“å‰setä¸­ç§»é™¤ï¼Œè…¾å‡ºç©ºé—´ç»™å…¶ä»–åœ°æ–¹ä½¿ç”¨ã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬æ‹¥æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ç¼“å­˜é›†ç¾¤ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„æ•°æ®éƒ½å±äºçƒ­æ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¤§å¯ä»¥è„±ç¦»æ•°æ®åº“ï¼Œå°†æ•°æ®éƒ½æ”¾åˆ°ç¼“å­˜å½“ä¸­ç›´æ¥å¯¹å¤–æœåŠ¡ï¼Œè¿™æ ·æˆ‘ä»¬å°†è·å¾—æ›´å¥½çš„ååå’Œå¹¶å‘ã€‚</p><p>æœ€åï¼Œè¿˜æœ‰ä¸€ç§æ–¹å¼æ¥ç¼“è§£çƒ­ç‚¹é«˜å¹¶å‘æŸ¥è¯¢ï¼Œåœ¨æ¯ä¸ªä¸šåŠ¡æœåŠ¡å™¨ä¸Šéƒ¨ç½²ä¸€ä¸ªå°å®¹é‡çš„Redisæ¥ä¿å­˜çƒ­ç‚¹ç¼“å­˜æ•°æ®ï¼Œé€šè¿‡è„šæœ¬å°†çƒ­ç‚¹æ•°æ®åŒæ­¥åˆ°æ¯ä¸ªæœåŠ¡å™¨çš„å°Redisä¸Šï¼Œæ¯æ¬¡æŸ¥è¯¢æ•°æ®ä¹‹å‰éƒ½ä¼šåœ¨æœ¬åœ°å°RedisæŸ¥æ‰¾ä¸€ä¸‹ï¼Œå¦‚æœæ‰¾ä¸åˆ°å†å»å¤§ç¼“å­˜å†…æŸ¥è¯¢ï¼Œé€šè¿‡è¿™ä¸ªæ–¹å¼ç¼“è§£ç¼“å­˜çš„è¯»å–æ€§èƒ½ã€‚</p><h2>æ€»ç»“</h2><p>é€šè¿‡è¿™èŠ‚è¯¾ï¼Œæˆ‘å¸Œæœ›ä½ èƒ½æ˜ç™½ï¼šä¸æ˜¯æ‰€æœ‰çš„æ•°æ®æ”¾åœ¨ç¼“å­˜å°±èƒ½æœ‰å¾ˆå¥½çš„æ”¶ç›Šï¼Œæˆ‘ä»¬è¦ä»<strong>æ•°æ®é‡</strong>ã€<strong>ä½¿ç”¨é¢‘ç‡</strong>ã€<strong>ç¼“å­˜å‘½ä¸­ç‡</strong>ä¸‰ä¸ªè§’åº¦å»åˆ†æã€‚è¯»å¤šå†™å°‘çš„æ•°æ®åšç¼“å­˜è™½ç„¶èƒ½é™ä½æ•°æ®å±‚çš„å‹åŠ›ï¼Œä½†è¦æ ¹æ®ä¸€è‡´æ€§éœ€æ±‚å¯¹å…¶ç¼“å­˜çš„æ•°æ®åšæ›´æ–°ã€‚å…¶ä¸­ï¼Œå•æ¡å®ä½“æ•°æ®æœ€å®¹æ˜“å®ç°ç¼“å­˜æ›´æ–°ï¼Œä½†æ˜¯æœ‰æ¡ä»¶æŸ¥è¯¢çš„ç»Ÿè®¡ç»“æœå¹¶ä¸å®¹æ˜“åšåˆ°å®æ—¶æ›´æ–°ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœæ•°æ®åº“æ‰¿å—ä¸äº†é€ä¼ æµé‡å‹åŠ›ï¼Œæˆ‘ä»¬éœ€è¦å°†ä¸€äº›çƒ­ç‚¹æ•°æ®åšæˆ<strong>é•¿æœŸç¼“å­˜</strong>ï¼Œæ¥é˜²æ­¢å¤§é‡è¯·æ±‚ç©¿é€ç¼“å­˜ï¼Œè¿™æ ·ä¼šå½±å“æˆ‘ä»¬çš„æœåŠ¡ç¨³å®šã€‚åŒæ—¶é€šè¿‡singleflightæ–¹å¼é¢„é˜²ä¸´æ—¶ç¼“å­˜è¢«å¤§é‡è¯·æ±‚ç©¿é€ï¼Œä»¥é˜²çƒ­ç‚¹æ•°æ®åœ¨ä»ä¸´æ—¶ç¼“å­˜åˆ‡æ¢æˆçƒ­ç‚¹ä¹‹å‰ï¼Œå‡»ç©¿ç¼“å­˜ï¼Œå¯¼è‡´æ•°æ®åº“å´©æºƒã€‚</p><p>è¯»å¤šå†™å°‘çš„ç¼“å­˜æŠ€å·§æˆ‘è¿˜ç”»äº†ä¸€å¼ å¯¼å›¾ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/1f/cc/1f6bfb4a04342fbedc254a817e577dcc.jpg?wh=3330x2141\" alt=\"\"></p><h2>æ€è€ƒé¢˜</h2><p>1.ä½¿ç”¨Bloom Filterè¯†åˆ«çƒ­ç‚¹keyæ—¶ï¼Œæœ‰æ—¶ä¼šè¯†åˆ«å¤±è¯¯ï¼Œè¿›è€Œå¯¼è‡´æ•°æ®æ²¡æœ‰æ‰¾åˆ°ï¼Œé‚£ä¹ˆå¦‚ä½•é¿å…è¿™ç§æƒ…å†µå‘¢ï¼Ÿ</p><p>2.ä½¿ç”¨Bloom Filteråªèƒ½æ·»åŠ æ–°keyï¼Œä¸èƒ½åˆ é™¤æŸä¸€ä¸ªkeyï¼Œå¦‚æœæƒ³æ›´å¥½åœ°æ›´æ–°ç»´æŠ¤ï¼Œæœ‰ä»€ä¹ˆå…¶ä»–æ–¹å¼å—ï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºä¸æˆ‘äº¤æµè®¨è®ºï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ï¼</p>","neighbors":{"left":{"article_title":"01ï½œç»“æ„æ¢³ç†ï¼šå¤§å¹¶å‘ä¸‹ï¼Œä½ çš„æ•°æ®åº“è¡¨å¯èƒ½æˆä¸ºæ€§èƒ½éšæ‚£","id":595679},"right":{"article_title":"03ï½œTokenï¼šå¦‚ä½•é™ä½ç”¨æˆ·èº«ä»½é‰´æƒçš„æµé‡å‹åŠ›ï¼Ÿ","id":597664}},"comments":[{"had_liked":false,"id":360693,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"åŒ—äº¬","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":true,"comment_ctime":1666764447,"is_pvip":true,"replies":[{"id":"131231","content":"ä½ å¥½ï¼Œpeterï¼Œåˆè§é¢äº†ï¼Œæ„Ÿè°¢ä½ çš„ç•™è¨€ï½<br>Q1:ç”±äºæˆ‘ä»¬çš„å¤§å¤šæ•°æ•°æ®éƒ½æ˜¯æœ‰æ—¶æ•ˆæ€§çš„ï¼Œæˆ‘ä»¬å¾ˆå°‘å»åšæ°¸ä¹…çš„å†…å­˜ç¼“å­˜ï¼Œæ¯•ç«Ÿå†…å­˜è¿˜æ˜¯å¾ˆè´µçš„ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘æ€§ä»·æ¯”ã€‚é•¿æœŸç¼“å­˜å¯ä»¥æ˜¯ä¸€å¤©ï¼Œä¸´æ—¶TTLæ˜¯30ç§’ã€‚åŒæ—¶é•¿æœŸçš„æ›´æ–°æ˜¯å®šæœŸè„šæœ¬åˆ·æ–°ï¼Œä¸´æ—¶æ˜¯ç”¨åˆ°æ‰ä¼šæ”¾è¿›å»ä¸€ä¼šå„¿ã€‚å†æ¥çœ‹ï¼Œé•¿æœŸçš„è®¿é—®å¾ˆé¢‘ç¹ï¼Œå¦‚æœæ”¾å¼€ä¼šå¯¼è‡´æ•°æ®åº“å‹åŠ›å¾ˆå¤§ï¼Œä½†æ˜¯ä¸´æ—¶çš„ç”±äºè®¿é—®é‡å°æ‰€ä»¥ä¸ç”¨ç‰¹æ„é˜²å‡»ç©¿ã€‚<br>Q2:å¦‚æœç¼“å­˜å‹åŠ›ä¸å¤§å¯ä»¥ç”¨ä¸€ä¸ªï¼Œå¦‚æœå¾ˆå¤§ä¼šå†åšä¸ªL1ç¼“å­˜ï¼Œåœ¨æ¯å°ä¸šåŠ¡æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·èƒ½ç¼“è§£æ ¸å¿ƒç¼“å­˜å‹åŠ›ã€‚<br>Q3ï¼šè¿™ä¸ªå±äºäººå·¥å†™ä»£ç ï¼Œå¦‚æˆ‘æ›´æ–°äº†ç”¨æˆ·çš„æ˜µç§°ï¼Œé‚£ä¹ˆæˆ‘ä¼šåˆ·æ–°è¿™ä¸ªç”¨æˆ·çš„æ‰€æœ‰å¸–å­çš„ç¼“å­˜ï¼Œä»¥åŠè¿™ä¸ªç”¨æˆ·çš„æ‰€æœ‰æœ€è¿‘ç•™è¨€ç¼“å­˜ï¼Œä»¥åŠè¿™ä¸ªç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ç¼“å­˜ã€‚è¿™æ˜¯ä¸€ç§ï¼Œè¿˜æœ‰ä¸€ç§å°±æ˜¯ä½ è¯´çš„ç•Œé¢é…ç½®è§„åˆ™ï¼Œä½†æ˜¯è¿™äº›éƒ½æ˜¯è¦èƒ½å¿«é€Ÿå®šä½çš„æ‰å¯ä»¥ã€‚ä½ å¯èƒ½ä¼šç¢°åˆ°ï¼Œç”¨æˆ·æ˜µç§°ä»¥rickå¼€å¤´çš„è´¦å·æœ‰å¤šå°‘ä¸ªï¼Œå½“æˆ‘ä»¬æ”¹æ˜µç§°ä¸ºè¿™ä¸ªçš„æ—¶å€™ï¼Œå¯¹äºè¿™ç§æ¡ä»¶å¤šæ ·çš„ï¼Œåˆ·æ–°å“ªä¸ªç¼“å­˜ä¸å¥½ç¡®å®šï¼Œåªèƒ½ä¸´æ—¶ç¼“å­˜30ç§’ç­‰ä»–è¿‡æœŸååˆ·æ–°","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":"1004527","ctime":1666781242,"ip_address":"åŒ—äº¬","comment_id":360693,"utype":1}],"discussion_count":1,"race_medal":0,"score":"9.2233720514063995e+18","product_id":100309001,"comment_content":"è¯·æ•™è€å¸ˆå‡ ä¸ªé—®é¢˜ï¼š<br>Q1ï¼šç¼“å­˜éƒ½æ˜¯æœ‰è¶…æ—¶æ—¶é—´çš„ï¼Œä»è¿™ä¸ªæ„ä¹‰ä¸Šè¯´ï¼Œéƒ½æ˜¯â€œä¸´æ—¶â€çš„ï¼Œä¸ºä»€ä¹ˆæœ¬æ–‡è¿˜è¦åˆ†ä¸ºâ€œä¸´æ—¶â€ç¼“å­˜å’Œâ€œé•¿æœŸâ€ç¼“å­˜ï¼Ÿ<br>Q2ï¼šâ€œä¸´æ—¶â€ç¼“å­˜å’Œâ€œé•¿æœŸâ€ç¼“å­˜åœ¨å®ç°ä¸Šå¯ä»¥ç”¨åŒä¸€ä¸ªè½¯ä»¶å—ï¼Ÿ<br>æ¯”å¦‚ï¼Œä¸¤è€…éƒ½å¯ä»¥ç”¨Rediså®ç°ï¼Ÿæˆ–è€…ï¼Œâ€œä¸´æ—¶ç¼“å­˜â€æ˜¯ç”¨ä¸€ä¸ªç»„ä»¶å®ç°ï¼ˆéRedisï¼‰è€Œâ€œé•¿æœŸç¼“å­˜â€ç”¨Rediså®ç°ï¼Ÿ æˆ–è€…ï¼Œâ€œä¸´æ—¶ç¼“å­˜â€åœ¨ä»£ç ä¸­å®ç°è€Œâ€œé•¿æœŸç¼“å­˜â€ç”¨Redisï¼Ÿ<br>Q3ï¼šäººå·¥ç»´æŠ¤ç¼“å­˜ï¼Œæ€ä¹ˆæ“ä½œï¼Ÿ<br>ç¼“å­˜æ•°æ®ä¸€èˆ¬éƒ½æ¯”è¾ƒå¤šï¼Œäººå·¥æ€ä¹ˆèƒ½å¤Ÿç»´æŠ¤ä¸€å †æ•°æ®ï¼Ÿå…·ä½“æ˜¯æ€ä¹ˆæ“ä½œçš„ï¼Ÿ æœ‰ä¸€ä¸ªç•Œé¢ï¼Œé€šè¿‡æ­¤ç•Œé¢æ¥æ“ä½œå—ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591730,"discussion_content":"ä½ å¥½ï¼Œpeterï¼Œåˆè§é¢äº†ï¼Œæ„Ÿè°¢ä½ çš„ç•™è¨€ï½\nQ1:ç”±äºæˆ‘ä»¬çš„å¤§å¤šæ•°æ•°æ®éƒ½æ˜¯æœ‰æ—¶æ•ˆæ€§çš„ï¼Œæˆ‘ä»¬å¾ˆå°‘å»åšæ°¸ä¹…çš„å†…å­˜ç¼“å­˜ï¼Œæ¯•ç«Ÿå†…å­˜è¿˜æ˜¯å¾ˆè´µçš„ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘æ€§ä»·æ¯”ã€‚é•¿æœŸç¼“å­˜å¯ä»¥æ˜¯ä¸€å¤©ï¼Œä¸´æ—¶TTLæ˜¯30ç§’ã€‚åŒæ—¶é•¿æœŸçš„æ›´æ–°æ˜¯å®šæœŸè„šæœ¬åˆ·æ–°ï¼Œä¸´æ—¶æ˜¯ç”¨åˆ°æ‰ä¼šæ”¾è¿›å»ä¸€ä¼šå„¿ã€‚å†æ¥çœ‹ï¼Œé•¿æœŸçš„è®¿é—®å¾ˆé¢‘ç¹ï¼Œå¦‚æœæ”¾å¼€ä¼šå¯¼è‡´æ•°æ®åº“å‹åŠ›å¾ˆå¤§ï¼Œä½†æ˜¯ä¸´æ—¶çš„ç”±äºè®¿é—®é‡å°æ‰€ä»¥ä¸ç”¨ç‰¹æ„é˜²å‡»ç©¿ã€‚\nQ2:å¦‚æœç¼“å­˜å‹åŠ›ä¸å¤§å¯ä»¥ç”¨ä¸€ä¸ªï¼Œå¦‚æœå¾ˆå¤§ä¼šå†åšä¸ªL1ç¼“å­˜ï¼Œåœ¨æ¯å°ä¸šåŠ¡æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·èƒ½ç¼“è§£æ ¸å¿ƒç¼“å­˜å‹åŠ›ã€‚\nQ3ï¼šè¿™ä¸ªå±äºäººå·¥å†™ä»£ç ï¼Œå¦‚æˆ‘æ›´æ–°äº†ç”¨æˆ·çš„æ˜µç§°ï¼Œé‚£ä¹ˆæˆ‘ä¼šåˆ·æ–°è¿™ä¸ªç”¨æˆ·çš„æ‰€æœ‰å¸–å­çš„ç¼“å­˜ï¼Œä»¥åŠè¿™ä¸ªç”¨æˆ·çš„æ‰€æœ‰æœ€è¿‘ç•™è¨€ç¼“å­˜ï¼Œä»¥åŠè¿™ä¸ªç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ç¼“å­˜ã€‚è¿™æ˜¯ä¸€ç§ï¼Œè¿˜æœ‰ä¸€ç§å°±æ˜¯ä½ è¯´çš„ç•Œé¢é…ç½®è§„åˆ™ï¼Œä½†æ˜¯è¿™äº›éƒ½æ˜¯è¦èƒ½å¿«é€Ÿå®šä½çš„æ‰å¯ä»¥ã€‚ä½ å¯èƒ½ä¼šç¢°åˆ°ï¼Œç”¨æˆ·æ˜µç§°ä»¥rickå¼€å¤´çš„è´¦å·æœ‰å¤šå°‘ä¸ªï¼Œå½“æˆ‘ä»¬æ”¹æ˜µç§°ä¸ºè¿™ä¸ªçš„æ—¶å€™ï¼Œå¯¹äºè¿™ç§æ¡ä»¶å¤šæ ·çš„ï¼Œåˆ·æ–°å“ªä¸ªç¼“å­˜ä¸å¥½ç¡®å®šï¼Œåªèƒ½ä¸´æ—¶ç¼“å­˜30ç§’ç­‰ä»–è¿‡æœŸååˆ·æ–°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666781242,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360820,"user_name":"Daniel","can_delete":false,"product_type":"c1","uid":1020529,"ip_address":"åŒ—äº¬","ucode":"282E09B3146501","user_header":"https://static001.geekbang.org/account/avatar/00/0f/92/71/9fd7cd7a.jpg","comment_is_top":true,"comment_ctime":1666875528,"is_pvip":true,"replies":[{"id":"131283","content":"ä½ å¥½ï¼ŒDanielï¼Œå¾ˆé«˜å…´æ”¶åˆ°ä½ çš„ç•™è¨€<br><br>ç¬¬ä¸€ç§æ–¹æ³•ï¼Œå¦‚æœä½¿ç”¨é›†åˆæ£€æµ‹ä¹Ÿå¯ä»¥è¾¾åˆ°åŒæ ·æ•ˆæœï¼Œä½ æåˆ°çš„æ–¹æ³•ç¼ºé™·åœ¨äºnot_hotkeyä¼šå¾ˆå¤§ï¼Œè¿™é‡Œéœ€è¦è®°å½•æ‰€æœ‰ä¸æ˜¯hot keyçš„æ‰€æœ‰keyã€‚ç›®å‰bloomfilteråªæ˜¯ä¸ªæ¨¡ç³Šç­›é€‰ï¼Œç”¨å°é‡æ•°æ®æ¢æ›´å¥½çš„æ€§èƒ½ï¼Œä½†æ˜¯ä»–ç¡®å®è¯¯åˆ¤æ¦‚ç‡å¤šä¸€äº›ã€‚<br><br>ç¬¬äºŒä¸ªé—®é¢˜ä¹Ÿæ˜¯ä¸€ä¸ªåŠæ³•ï¼Œä½†æ˜¯éœ€è¦æˆ‘ä»¬èƒ½å¤Ÿç²¾å‡†æ§åˆ¶è¿™ä¸€æ‰¹æ•°æ®è¿‡æœŸæ—¶é—´ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨è¿™èŠ‚è¯¾ç”¨å®ƒä¸»è¦æ˜¯ä¸ºäº†åˆ¤æ–­æœ¬åœ°ç¼“å­˜ä¸­æ˜¯å¦æœ‰è¿™ä¸ªç¼“å­˜ï¼Œç”±äºæ— æ³•åˆ¤æ–­æ‰€ä»¥éœ€è¦æ¯æ¬¡è¯¢é—®ï¼Œä¼šå¯¼è‡´ç³»ç»Ÿæ›´åŠ å¤æ‚ã€‚<br><br>ç¬¬ä¸‰ä¸ªé—®é¢˜ ä¸»è¦æ˜¯è®¿é—®é‡ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸€äº›key åšä¸€äº›countç»Ÿè®¡ï¼Œæ•°æ®åŸ‹ç‚¹å°±è¶³å¤Ÿäº†ï¼Œæœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ çš„QPSæœ‰äº›ä½ï¼Œæˆ‘å°è±¡é‡Œï¼Œä¸€ä¸ª1wå…ƒçš„æ˜¾å¡åšå‘éŸ³è¯„åˆ†ï¼Œä¸€ç§’é’Ÿåªèƒ½å¤„ç†4ä¸ªè¯·æ±‚ï¼Œåœºæ™¯ä¸å¤ªé€‚åˆï¼Œæœ‰ç‚¹å°æ‰å¤§ç”¨äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1004527","ctime":1666941201,"ip_address":"åŒ—äº¬","comment_id":360820,"utype":1}],"discussion_count":3,"race_medal":0,"score":"9.2233720428166001e+18","product_id":100309001,"comment_content":"1. ä½¿ç”¨ Bloom Filter è¯†åˆ«çƒ­ç‚¹ key æ—¶ï¼Œæœ‰æ—¶ä¼šè¯†åˆ«å¤±è¯¯ï¼Œè¿›è€Œå¯¼è‡´æ•°æ®æ²¡æœ‰æ‰¾åˆ°ï¼Œé‚£ä¹ˆå¦‚ä½•é¿å…è¿™ç§æƒ…å†µå‘¢ï¼Ÿ<br><br>é€šè¿‡æˆ‘çš„ â€œæœºå™¨å­¦ä¹ çš„ç»éªŒâ€ï¼Œæˆ‘è§‰å¾—æ˜¯è¿™ä¸ªå¸ƒéš†è¿‡æ»¤å™¨çš„å“ˆå¸Œç®—æ³•æœ‰ç‚¹è¿‡æ‹Ÿåˆäº†ï¼Œä¹Ÿå°±æ˜¯è¯´å®¹é”™ç‡é«˜äº†ï¼Œåœ¨èµ„é‡‘å……è¶³çš„æƒ…å†µä¸‹å…ˆè¯•ç€è°ƒä½â€œå®¹é”™ç‡â€œ(è¶…å‚æ•°)æå‡å®¹é‡è¯•è¯•ï¼ˆä¸çŸ¥é“å·¥ä¸šç•Œä¸Šå¸ƒéš†è¿‡æ»¤å™¨çš„å®¹é”™ç‡èƒ½è®¾ç½®æˆ 0%å—ï¼Ÿä½†åæœŸå¯èƒ½éšç€æ•°æ®é‡çš„å¢é•¿ä¹Ÿæ˜¯ä¸€ä¸ªæ— é™æ‰©å®¹çš„â€åé‡‘å…½â€œå‘€ï¼‰ï¼Œä½†æˆ‘æ„Ÿè§‰æˆ‘è¿™ä¸ªæƒ³æ³•åœ¨å·¥ä¸šç•Œåº”è¯¥ä¸æˆç«‹ã€‚<br><br>ç¬¬äºŒç§æ–¹æ³•ï¼Œæˆ‘æƒ³åˆ°çš„æ˜¯ï¼Œå¦‚æœè¿™ä¸ª key è¢«è¯¯è¯†åˆ«ä¸ºâ€hotkeyâ€çš„è¯ï¼Œå°±åœ¨å†…å­˜ä¸­è®°å…¥â€œnot_hotkeyâ€åˆ—è¡¨ï¼Œæ¯æ¬¡æ•°æ®è¿›æ¥çš„æ—¶å€™ï¼Œå…ˆç”¨ ç¼“å­˜é‡Œçš„ not_hotkeyé‡Œçš„åˆ—è¡¨æ¥ç­›ï¼Œè¦æ˜¯ä¸æ˜¯hotkeyå°±åšæˆä¸´æ—¶ç¼“å­˜ï¼Œè¦æ˜¯è¿™ä¸ªkeyæ˜¯hotkeyçš„è¯ï¼Œå°±è¿›è¡Œé•¿æœŸç¼“å­˜æ¥å¤„ç†ã€‚<br><br><br>2. ä½¿ç”¨ Bloom Filter åªèƒ½æ·»åŠ æ–° keyï¼Œä¸èƒ½åˆ é™¤æŸä¸€ä¸ª keyï¼Œå¦‚æœæƒ³æ›´å¥½åœ°æ›´æ–°ç»´æŠ¤ï¼Œæœ‰ä»€ä¹ˆå…¶ä»–æ–¹å¼å—ï¼Ÿ<br><br>å¯¹äºé•¿æ—¶é—´ä¸ç”¨çš„ key ï¼Œæˆ‘è®¤ä¸ºå¯ä»¥è®¾ç½®ä¸€ä¸ªâ€œå¤±æ•ˆæ—¶é—´â€ï¼Œæ¯”å¦‚ ä¸€å‘¨å†…ä¸ç”¨ï¼Œå°±è‡ªåŠ¨æ¸…é™¤æ‰è¿™ä¸ªkeyã€‚<br>ä¹‹ååœ¨æ–°çš„ä¸€å‘¨ï¼ŒæŠŠå¤±æ•ˆçš„keyæ¸…ç†å‡ºå»ï¼Œå†é‡æ–°æ•´ç†å¥½ä¸€ä¸ªåˆ—è¡¨ï¼Œé‡æ–°æ›´æ–°ä¸€éè¿™ä¸ªå¸ƒéš†è¿‡æ»¤å™¨çš„æ–°çš„å“ˆå¸Œç®—æ³•è¡¨ã€‚<br>ï¼ˆä½†æ„Ÿè§‰è¿™ä¸ªæ–¹æ³•è²Œä¼¼ä¸æ˜¯æœ€ä¼˜çš„ï¼Œä¹Ÿè¦åœ¨åŠå¤œç”¨æˆ·é‡è®¿é—®å°‘çš„æ—¶é—´ç‚¹å»åšå˜æ›´å¤„ç†ï¼‰<br><br><br>è€å¸ˆæƒ³è¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼Œå¯¹äº hotkey ï¼ˆçƒ­ç‚¹æ•°æ®ï¼‰è¿™ä¸ªå·¥ä¸šç•Œçš„è¯„ä»·æ ‡å‡†æ˜¯ä¸æ˜¯ä¸åŒè¡Œä¸šä¼šä¸ä¸€æ ·å‘€ï¼Ÿ<br>æ¯”è¾ƒæƒ³çŸ¥é“å·¥ä¸šç•Œä¸Šæ˜¯ç”¨ä»€ä¹ˆæ–¹æ³•ï¼ˆä¸€èˆ¬ç»Ÿè®¡æ–¹æ³•ï¼Ÿæœºå™¨å­¦ä¹ èšç±»ï¼Ÿæ·±åº¦å­¦ä¹ ç½‘ç»œï¼Ÿï¼‰å’Œå·¥å…·ï¼ˆæ•°æ®åŸ‹ç‚¹ï¼Ÿç”¨æˆ·æ“ä½œè¡Œä¸ºåˆ†æï¼Ÿï¼‰ï¼Œæ¥åš â€œçƒ­ç‚¹æ•°æ®â€çš„ åˆ¤åˆ«çš„ï¼Ÿ ","like_count":1,"discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591934,"discussion_content":"ä½ å¥½ï¼ŒDanielï¼Œå¾ˆé«˜å…´æ”¶åˆ°ä½ çš„ç•™è¨€\n\nç¬¬ä¸€ç§æ–¹æ³•ï¼Œå¦‚æœä½¿ç”¨é›†åˆæ£€æµ‹ä¹Ÿå¯ä»¥è¾¾åˆ°åŒæ ·æ•ˆæœï¼Œä½ æåˆ°çš„æ–¹æ³•ç¼ºé™·åœ¨äºnot_hotkeyä¼šå¾ˆå¤§ï¼Œè¿™é‡Œéœ€è¦è®°å½•æ‰€æœ‰ä¸æ˜¯hot keyçš„æ‰€æœ‰keyã€‚ç›®å‰bloomfilteråªæ˜¯ä¸ªæ¨¡ç³Šç­›é€‰ï¼Œç”¨å°é‡æ•°æ®æ¢æ›´å¥½çš„æ€§èƒ½ï¼Œä½†æ˜¯ä»–ç¡®å®è¯¯åˆ¤æ¦‚ç‡å¤šä¸€äº›ã€‚\n\nç¬¬äºŒä¸ªé—®é¢˜ä¹Ÿæ˜¯ä¸€ä¸ªåŠæ³•ï¼Œä½†æ˜¯éœ€è¦æˆ‘ä»¬èƒ½å¤Ÿç²¾å‡†æ§åˆ¶è¿™ä¸€æ‰¹æ•°æ®è¿‡æœŸæ—¶é—´ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨è¿™èŠ‚è¯¾ç”¨å®ƒä¸»è¦æ˜¯ä¸ºäº†åˆ¤æ–­æœ¬åœ°ç¼“å­˜ä¸­æ˜¯å¦æœ‰è¿™ä¸ªç¼“å­˜ï¼Œç”±äºæ— æ³•åˆ¤æ–­æ‰€ä»¥éœ€è¦æ¯æ¬¡è¯¢é—®ï¼Œä¼šå¯¼è‡´ç³»ç»Ÿæ›´åŠ å¤æ‚ã€‚\n\nç¬¬ä¸‰ä¸ªé—®é¢˜ ä¸»è¦æ˜¯è®¿é—®é‡ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸€äº›key åšä¸€äº›countç»Ÿè®¡ï¼Œæ•°æ®åŸ‹ç‚¹å°±è¶³å¤Ÿäº†ï¼Œæœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ çš„QPSæœ‰äº›ä½ï¼Œæˆ‘å°è±¡é‡Œï¼Œä¸€ä¸ª1wå…ƒçš„æ˜¾å¡åšå‘éŸ³è¯„åˆ†ï¼Œä¸€ç§’é’Ÿåªèƒ½å¤„ç†4ä¸ªè¯·æ±‚ï¼Œåœºæ™¯ä¸å¤ªé€‚åˆï¼Œæœ‰ç‚¹å°æ‰å¤§ç”¨äº†ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1666941202,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":2,"child_discussions":[{"author":{"id":1020529,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/92/71/9fd7cd7a.jpg","nickname":"Daniel","note":"","ucode":"282E09B3146501","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":591970,"discussion_content":"çœ‹äº†è€å¸ˆçš„è¯„è®ºï¼Œæ„Ÿè§‰è€å¸ˆçš„å®æˆ˜ç»éªŒæ˜¯çœŸä¸°å¯Œå‘€ï¼ŒğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666960019,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":591934,"ip_address":"æµ·å—"},"score":591970,"extra":""},{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":1020529,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/92/71/9fd7cd7a.jpg","nickname":"Daniel","note":"","ucode":"282E09B3146501","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":592262,"discussion_content":"å¤šå¤šäº¤æµï¼Œæ‹±æ‰‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667266849,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":591970,"ip_address":"åŒ—äº¬"},"score":592262,"extra":""}]}]},{"had_liked":false,"id":360716,"user_name":"Elvis Lee","can_delete":false,"product_type":"c1","uid":2098270,"ip_address":"åŒ—äº¬","ucode":"A4B26AFFE817FA","user_header":"https://static001.geekbang.org/account/avatar/00/20/04/5e/5d2e6254.jpg","comment_is_top":false,"comment_ctime":1666777540,"is_pvip":true,"replies":[{"id":"131229","content":"ä½ å¥½ï¼ŒElvis Leeï¼Œå¾ˆé«˜å…´æ”¶åˆ°ä½ çš„ç•™è¨€ï¼Œä¸å»ºè®®è¿™æ ·ä½¿ç”¨bloomfilterï¼Œä¸»è¦åŸå› åœ¨äºï¼Œä»–çš„è¯†åˆ«å’Œmd5è®¡ç®—ç»“æœä¸€æ ·ï¼Œæœ‰çš„æ—¶å€™ä¸åŒçš„keyè¿”å›çš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥è¿™æ ·æ˜¯æ‹¿ä¸åˆ°å‡†ç¡®ç»“æœçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1004527","ctime":1666780674,"ip_address":"åŒ—äº¬","comment_id":360716,"utype":1}],"discussion_count":4,"race_medal":0,"score":"10256712132","product_id":100309001,"comment_content":"1. ä½¿ç”¨ Bloom Filter è¯†åˆ«çƒ­ç‚¹ key æ—¶ï¼Œæœ‰æ—¶ä¼šè¯†åˆ«å¤±è¯¯ï¼Œè¿›è€Œå¯¼è‡´æ•°æ®æ²¡æœ‰æ‰¾åˆ°ï¼Œé‚£ä¹ˆå¦‚ä½•é¿å…è¿™ç§æƒ…å†µå‘¢ï¼Ÿ<br>å¸ƒéš†å¯ä»¥åˆ¤æ–­ä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ï¼Œé‚£ä¹ˆæ˜¯å¦å¯ä»¥è®¤ä¸ºï¼Œåªè¦æ’å…¥ä¸æˆåŠŸï¼Œå³ä¸ºçƒ­æ•°æ®ï¼Œä½†åœ¨è®¾è®¡å¸ƒéš†çš„æ—¶å€™éœ€è¦æ ¹æ®ä¸šåŠ¡æ¥è®¾ç½®å¥½å®¹é‡å’Œå®¹é”™ç‡ã€‚åŒæ—¶å¸ƒéš†åˆ é™¤æ“ä½œåœ¨ç”Ÿäº§ä¸Šä¸å»ºè®®ï¼Œæœ€å¥½æ˜¯æŒä¹…åŒ–åç”¨ç‰ˆæœ¬å·å»åŒºåˆ†ã€‚å¦‚æœæ˜¯ç¦»çº¿é“¾è·¯ï¼Œæ›´æ¨èç”Ÿæˆå¸ƒéš†æ–‡ä»¶ï¼Œæ¨é€å»å®¢æˆ·ç«¯ã€‚å®æ—¶çš„,ç›®å‰æ¥è§¦æ˜¯ä¿å­˜åœ¨Redis,Redis7çš„ç‰ˆæœ¬å¥½åƒå·²ç»ä¸éœ€è¦æ’ä»¶","like_count":2,"discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591726,"discussion_content":"ä½ å¥½ï¼ŒElvis Leeï¼Œå¾ˆé«˜å…´æ”¶åˆ°ä½ çš„ç•™è¨€ï¼Œä¸å»ºè®®è¿™æ ·ä½¿ç”¨bloomfilterï¼Œä¸»è¦åŸå› åœ¨äºï¼Œä»–çš„è¯†åˆ«å’Œmd5è®¡ç®—ç»“æœä¸€æ ·ï¼Œæœ‰çš„æ—¶å€™ä¸åŒçš„keyè¿”å›çš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥è¿™æ ·æ˜¯æ‹¿ä¸åˆ°å‡†ç¡®ç»“æœçš„ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1666780674,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2098270,"avatar":"https://static001.geekbang.org/account/avatar/00/20/04/5e/5d2e6254.jpg","nickname":"Elvis Lee","note":"","ucode":"A4B26AFFE817FA","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591835,"discussion_content":"ä¸ªäººè§‰å¾—å› ä¸ºå¸ƒéš†æ˜¯æœ‰ä¸€å®šå®¹é”™æ€§ï¼Œæ‰€ä»¥å¸ƒéš†åªèƒ½åšåˆ°éƒ¨åˆ†æ‹¦æˆªã€‚\næ•°æ®é‡ä»å°åˆ°å¤§çš„è§£å†³ï¼šæ•°æ®åº“&lt;æœ¬åœ°ç¼“å­˜&lt;Redis&lt;å¸ƒéš†\næš‚æ—¶æ²¡æœ‰æƒ³åˆ°å…¶ä»–æ–¹å¼ï¼Œè¯·è€å¸ˆæŒ‡ç‚¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666853986,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·"},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":2098270,"avatar":"https://static001.geekbang.org/account/avatar/00/20/04/5e/5d2e6254.jpg","nickname":"Elvis Lee","note":"","ucode":"A4B26AFFE817FA","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":591944,"discussion_content":"cuckoo filter","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1666946377,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":591835,"ip_address":"åŒ—äº¬"},"score":591944,"extra":""},{"author":{"id":2098270,"avatar":"https://static001.geekbang.org/account/avatar/00/20/04/5e/5d2e6254.jpg","nickname":"Elvis Lee","note":"","ucode":"A4B26AFFE817FA","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":592440,"discussion_content":"è°¢è°¢è€å¸ˆè§£ç­”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667404651,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":591944,"ip_address":"ä¸Šæµ·"},"score":592440,"extra":""}]}]},{"had_liked":false,"id":360692,"user_name":"ä¼ è¾“åŠ©æ‰‹","can_delete":false,"product_type":"c1","uid":1128987,"ip_address":"åŒ—äº¬","ucode":"E81A629D2E565E","user_header":"https://static001.geekbang.org/account/avatar/00/11/3a/1b/ca87cde9.jpg","comment_is_top":false,"comment_ctime":1666764059,"is_pvip":false,"replies":[{"id":"131221","content":"ä½ å¥½ï¼Œä¼ è¾“åŠ©æ‰‹ï¼Œå¾ˆé«˜å…´æ”¶åˆ°ä½ çš„ç•™è¨€ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå‰æï¼Œå°±æ˜¯æˆ‘ä»¬åŠ ç¼“å­˜çš„æœåŠ¡åŸºæœ¬éƒ½æ˜¯è¯»å¹¶å‘é«˜çš„æœåŠ¡ï¼Œå¯¹äºMySQLä¸»åº“æ¥è¯´ï¼Œé—®é¢˜å°±æ˜¯å…¨å±€åªæœ‰ä¸€ä¸ªä¸»åº“ï¼Œæ‰€ä»¥ä»–æ˜¯å•ç‚¹ï¼ŒåŒæ—¶æ›´è„†å¼±ï¼Œç†è®ºä¸Šè¿™ç§è¯»å‹åŠ›å°½é‡ä¸è¦å‹åˆ°ä¸»åº“ä¸Šï½","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1004527","ctime":1666771965,"ip_address":"åŒ—äº¬","comment_id":360692,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10256698651","product_id":100309001,"comment_content":"è¯»å–æ•°æ®åº“è®¾ç½®ç¼“å­˜çš„æ—¶å€™ï¼Œä¸ºäº†ä¸å—æ•°æ®åº“ä¸»ä»å»¶è¿Ÿçš„å½±å“ï¼Œæ˜¯ä¸æ˜¯éœ€è¦å¼ºåˆ¶è¯»ä¸»åº“ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591706,"discussion_content":"ä½ å¥½ï¼Œä¼ è¾“åŠ©æ‰‹ï¼Œå¾ˆé«˜å…´æ”¶åˆ°ä½ çš„ç•™è¨€ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå‰æï¼Œå°±æ˜¯æˆ‘ä»¬åŠ ç¼“å­˜çš„æœåŠ¡åŸºæœ¬éƒ½æ˜¯è¯»å¹¶å‘é«˜çš„æœåŠ¡ï¼Œå¯¹äºMySQLä¸»åº“æ¥è¯´ï¼Œé—®é¢˜å°±æ˜¯å…¨å±€åªæœ‰ä¸€ä¸ªä¸»åº“ï¼Œæ‰€ä»¥ä»–æ˜¯å•ç‚¹ï¼ŒåŒæ—¶æ›´è„†å¼±ï¼Œç†è®ºä¸Šè¿™ç§è¯»å‹åŠ›å°½é‡ä¸è¦å‹åˆ°ä¸»åº“ä¸Šï½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666771965,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361342,"user_name":"ä¸€æ­¥","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"åŒ—äº¬","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1667441053,"is_pvip":true,"replies":[{"id":"131428","content":"ä½ å¥½ï¼Œå¾ˆé«˜å…´æ”¶åˆ°ä½ çš„å›å¤ï¼Œæ²¡é”™ï¼ç¡®å®Cuckoo Filterèƒ½å¤Ÿè§£å†³æ‰€æœ‰é—®é¢˜ï¼åŒæ—¶è¡¥å……æé†’ï¼šä»–ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ä½¿ç”¨çš„æ—¶å€™è¦æ³¨æ„ï¼Œæ€§èƒ½æ²¡æœ‰bfé«˜ï¼ŒåŒæ—¶åˆ é™¤å­˜åœ¨è¯¯åˆ æƒ…å†µï½","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1004527","ctime":1667447071,"ip_address":"åŒ—äº¬","comment_id":361342,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1667441053","product_id":100309001,"comment_content":"1. Bloom Filter å­˜åœ¨è¯¯æŠ¥ï¼Œä¼šæŠŠä¸æ˜¯çƒ­ç‚¹çš„ key è¯†åˆ«æˆçƒ­ç‚¹key, æ‰€ä»¥éœ€è¦ä¸€ä¸ª 0è¯¯æŠ¥çš„ç®—æ³•ï¼Œæ•°æ®ç»“æ„ æ‰€ä»¥ Cuckoo Filter å¸ƒè°·é¸Ÿè¿‡æ»¤å™¨æ¥äº†<br>2. å¯ä»¥å®šæœŸæˆ–è€…å…¶ä»–ç­–ç•¥ é‡æ–°æ„é€  Bloom Filter<br><br>&gt; å…¶å®ä¸Šé¢çš„2ä¸ªé—®é¢˜ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ Cuckoo Filter æ¥è§£å†³","like_count":0,"discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592494,"discussion_content":"ä½ å¥½ï¼Œå¾ˆé«˜å…´æ”¶åˆ°ä½ çš„å›å¤ï¼Œæ²¡é”™ï¼ç¡®å®Cuckoo Filterèƒ½å¤Ÿè§£å†³æ‰€æœ‰é—®é¢˜ï¼åŒæ—¶è¡¥å……æé†’ï¼šä»–ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ä½¿ç”¨çš„æ—¶å€™è¦æ³¨æ„ï¼Œæ€§èƒ½æ²¡æœ‰bfé«˜ï¼ŒåŒæ—¶åˆ é™¤å­˜åœ¨è¯¯åˆ æƒ…å†µï½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667447071,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361182,"user_name":"SunshineBoy","can_delete":false,"product_type":"c1","uid":1160644,"ip_address":"åŒ—äº¬","ucode":"FC54CD1815CCBA","user_header":"https://static001.geekbang.org/account/avatar/00/11/b5/c4/9148b40d.jpg","comment_is_top":false,"comment_ctime":1667296369,"is_pvip":false,"replies":[{"id":"131364","content":"ä½ å¥½ï¼Œå»ºè®®å¯¹è±¡å­˜å‚¨é…åˆcdnç¼“å­˜å®ç°","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1004527","ctime":1667304656,"ip_address":"åŒ—äº¬","comment_id":361182,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1667296369","product_id":100309001,"comment_content":"å“ˆå–½ å¤§ä½¬ redisé€‚åˆåšappä¸­ä¸€çº§ã€äºŒçº§é¡µé¢é™çº§æ–¹æ¡ˆçš„å­˜å‚¨å—ï¼Ÿå¦‚æœå­˜å‚¨çš„valueæ¯”è¾ƒå¤§ï¼Œæœ‰æ²¡æœ‰æ¨èçš„é™çº§æ–¹æ¡ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592320,"discussion_content":"ä½ å¥½ï¼Œå»ºè®®å¯¹è±¡å­˜å‚¨é…åˆcdnç¼“å­˜å®ç°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667304656,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":2,"child_discussions":[{"author":{"id":1160644,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b5/c4/9148b40d.jpg","nickname":"SunshineBoy","note":"","ucode":"FC54CD1815CCBA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":592370,"discussion_content":"è€å¸ˆï¼Œappæ¯ä¸ªé¡µé¢èšåˆäº†å¾ˆå¤šåŸºç¡€æœåŠ¡æ¥å£ï¼Œè¿™äº›æ¥å£æ€§èƒ½æ¯”è¾ƒå·®ï¼Œç»å¸¸æŒ‚ï¼Œæ‰€ä»¥æŠŠåŸºç¡€æœåŠ¡æ•°æ®ç¼“å­˜ä¸‹æ¥ã€‚è¿™äº›æ•°æ®æœ‰åˆ†å‘ç­–ç•¥ï¼Œä¸åŒçš„ç”¨æˆ·çœ‹åˆ°çš„ç”¨æˆ·æ•°æ®æ˜¯ä¸ä¸€æ ·çš„æ•°æ®ï¼Œæƒ³åšåˆ°serveråŸºç¡€æœåŠ¡æŒ‚äº†ç”¨æˆ·æ— æ„ŸçŸ¥ï¼Œæƒ³åœ¨serverèšåˆå±‚åšé™çº§æ–¹æ¡ˆï¼Œæ—¢æƒ³è¦æœåŠ¡å¯ç”¨æ€§ï¼Œä¹Ÿæƒ³è¦æ•°æ®ä¸€è‡´æ€§ã€‚ç°åœ¨æ˜¯æŠŠæ•´ä¸ªé¡µé¢çš„åŠ¨æ€æ•°æ®åšäº†ä¸€ä¸ªå¤§valueï¼Œå­˜å‚¨åˆ°redisï¼Œç“¶é¢ˆæ˜¯ä¸€åˆ°é«˜å³°æœŸä¼šå‡ºç°codisé“¾æ¥æ± æ‰“æ»¡ï¼Œå³ä½¿æ‰©å®¹ï¼Œåç»­qpså¢é•¿è¿˜æ˜¯ä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚çœ‹äº†è€å¸ˆçš„æ–‡ç« ï¼Œä¹Ÿè§‰å¾—æ–¹æ¡ˆä¸åˆç†ã€‚å¯¹äºè¿™å—ï¼Œè€å¸ˆæœ‰ä»€ä¹ˆå¥½çš„æƒ³æ³•ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667359300,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":592320,"ip_address":"åŒ—äº¬"},"score":592370,"extra":""},{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":1160644,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b5/c4/9148b40d.jpg","nickname":"SunshineBoy","note":"","ucode":"FC54CD1815CCBA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592539,"discussion_content":"æ•°æ®æ‹¼åˆå¯ä»¥ä¸åœ¨ä¸šåŠ¡æ¥å£ä¸Šåšï¼Œå¯ä»¥å‚è€ƒä¸‹goçš„BFFè®¾è®¡ï¼Œé€šè¿‡è¿™ä¸ªæ–¹å¼å°†å¤šä¸ªæ¥å£æ•°æ®å¹¶è¡Œèšåˆèµ·æ¥ï¼Œç„¶åå±•ç¤ºç»™ç”¨æˆ·","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1667470506,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":592370,"ip_address":"åŒ—äº¬"},"score":592539,"extra":""}]}]},{"had_liked":false,"id":360947,"user_name":"Sky","can_delete":false,"product_type":"c1","uid":1392585,"ip_address":"åŒ—äº¬","ucode":"4C5A5AB73E8B90","user_header":"https://static001.geekbang.org/account/avatar/00/15/3f/c9/1ccefb9a.jpg","comment_is_top":false,"comment_ctime":1667022972,"is_pvip":false,"replies":[{"id":"131313","content":"ä½ å¥½ï¼Œskyï¼Œå¾ˆé«˜å…´æ”¶åˆ°ä½ çš„ç•™è¨€ï¼Œè¿™æ ·æ•°æ®åº“å‹åŠ›ä¼šæ›´å¤§ï¼Œè¿™æ—¶éœ€è¦ç‰¹æ®Šåšï¼Œåç»­ä¼šè®²åˆ°å¼ºä¸€è‡´æ€ä¹ˆåš","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1004527","ctime":1667043768,"ip_address":"åŒ—äº¬","comment_id":360947,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1667022972","product_id":100309001,"comment_content":"åœ¨æ›´æ–°æœŸé—´ï¼Œä¸ºäº†é˜²æ­¢é«˜å¹¶å‘æŸ¥è¯¢æ‰“æ²‰æ•°æ®åº“ï¼Œæˆ‘ä»¬å°†æ›´æ–°æµç¨‹åšäº†ç®€å•çš„ singleflightï¼ˆè¯·æ±‚åˆå¹¶ï¼‰ä¼˜åŒ–ï¼Œåªæœ‰å…ˆæŠ¢åˆ°ç¼“å­˜æ›´æ–°é”çš„çº¿ç¨‹ï¼Œæ‰èƒ½è¿›å…¥åç«¯è¯»å–æ•°æ®åº“å¹¶å°†ç»“æœå¡«å†™åˆ°ç¼“å­˜ä¸­ã€‚è€Œæ²¡æœ‰æŠ¢åˆ°æ›´æ–°é”çš„çº¿ç¨‹å…ˆ sleep 1 ç§’ï¼Œç„¶åç›´æ¥è¯»å–ç¼“å­˜è¿”å›ç»“æœã€‚è¿™æ ·å¯ä»¥ä¿è¯åç«¯ä¸ä¼šæœ‰å¤šä¸ªçº¿ç¨‹è¯»å–åŒä¸€æ¡æ•°æ®ï¼Œä»è€Œå†²å®ç¼“å­˜å’Œæ•°æ®åº“æœåŠ¡ï¼ˆç¼“å­˜çš„å†™å¹¶å‘æ²¡æœ‰è¯»æ€§èƒ½é‚£ä¹ˆå¥½ï¼‰ã€‚<br><br>å¹¶å‘æ›´æ–°çš„æ—¶å€™ï¼Œä¸ºäº†é˜²æ­¢è¶…å–ç­‰é—®é¢˜ï¼Œæ˜¯ä¸æ˜¯æœ€å¥½è¿˜è¦åœ¨sqlä¸­åŠ ä¸Šä¹è§‚é”CASï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592043,"discussion_content":"ä½ å¥½ï¼Œskyï¼Œå¾ˆé«˜å…´æ”¶åˆ°ä½ çš„ç•™è¨€ï¼Œè¿™æ ·æ•°æ®åº“å‹åŠ›ä¼šæ›´å¤§ï¼Œè¿™æ—¶éœ€è¦ç‰¹æ®Šåšï¼Œåç»­ä¼šè®²åˆ°å¼ºä¸€è‡´æ€ä¹ˆåš","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667043769,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360908,"user_name":"ä¸åƒåŒ…å­","can_delete":false,"product_type":"c1","uid":2269341,"ip_address":"åŒ—äº¬","ucode":"5E0661EC355ED9","user_header":"","comment_is_top":false,"comment_ctime":1666964023,"is_pvip":false,"replies":[{"id":"131315","content":"ä½ å¥½ï¼Œä¸åƒåŒ…å­ï¼Œå¾ˆé«˜å…´æ”¶åˆ°ä½ çš„ç•™è¨€ï¼Œå¸ƒè°·é¸Ÿè¿‡æ»¤å™¨æ˜¯ä¸€ä¸ªä¸é”™çš„è§£å†³æ–¹æ¡ˆï¼Œå¦å¤–æŸ¥æ‰¾ä¸åˆ°ç¼“å­˜ç©ºä¹Ÿä¸é”™ï½","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1004527","ctime":1667044793,"ip_address":"åŒ—äº¬","comment_id":360908,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1666964023","product_id":100309001,"comment_content":"é’ˆå¯¹1.2çš„é—®é¢˜ï¼Œ<br>æœç´¢åˆ°äº†å¦‚ä¸‹è§£å†³æ–¹æ¡ˆï¼š è°ƒæ•´å¸ƒéš†è¿‡æ»¤å™¨å‚æ•°æˆ–è€…ç”¨å¸ƒè°·é¸Ÿè¿‡æ»¤å™¨ã€‚<br>æˆ‘æƒ³è¯´è¯´æˆ‘è‡ªå·±çš„çœ‹æ³•ï¼Œé’ˆå¯¹è¯¯åˆ¤çš„æƒ…å†µï¼Œèƒ½ä¸èƒ½å†åŠ ä¸€å±‚ç¼“å­˜ï¼Ÿæ¯”å¦‚è¯´ä¸€ä¸ªæ•°æ®è¢«è¯¯åˆ¤ä¸ºæœ‰ï¼Œåˆ™å»æŸ¥è¯¢æ•°æ®åº“äº†ï¼Œè¿™ä¸ªæ—¶å€™ä¸ºç©ºï¼Œè®°åˆ°ç¼“å­˜é‡Œé¢ï¼Œå¦‚æœä¸‹æ¬¡å†è®¿é—®è¯¥æ•°æ®çš„æ—¶å€™ï¼Œç›´æ¥ä»ç¼“å­˜è¿”å›ã€‚é’ˆå¯¹é—®é¢˜2 åŒæ ·ä¹Ÿç»´æŠ¤ä¸€ä¸ªåˆ é™¤çš„ç¼“å­˜ã€‚","like_count":0,"discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592047,"discussion_content":"ä½ å¥½ï¼Œä¸åƒåŒ…å­ï¼Œå¾ˆé«˜å…´æ”¶åˆ°ä½ çš„ç•™è¨€ï¼Œå¸ƒè°·é¸Ÿè¿‡æ»¤å™¨æ˜¯ä¸€ä¸ªä¸é”™çš„è§£å†³æ–¹æ¡ˆï¼Œå¦å¤–æŸ¥æ‰¾ä¸åˆ°ç¼“å­˜ç©ºä¹Ÿä¸é”™ï½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667044793,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3214843,"avatar":"https://static001.geekbang.org/account/avatar/00/31/0d/fb/a5fef3f7.jpg","nickname":"ç§»æ¨ªä¸ºå›º","note":"","ucode":"ECA3065E8485B0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592527,"discussion_content":"æ¶æ„é¢†åŸŸé‡Œæœ‰ä¸€å¥å‡ ä¹æ˜¯æœ€è‘—åçš„è¯ï¼šæ²¡æœ‰ä»€ä¹ˆæ¶æ„é—®é¢˜æ˜¯åŠ ä¸€å±‚è§£å†³ä¸äº†çš„ï¼Œå¦‚æœä¸è¡Œå°±å†åŠ ä¸€å±‚ã€‚å†åŠ 2å±‚å¸ƒéš†è¿‡æ»¤å™¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667464794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æµ™æ±Ÿ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360903,"user_name":"é—¨çª—å°äºŒ","can_delete":false,"product_type":"c1","uid":1006424,"ip_address":"åŒ—äº¬","ucode":"0BF3780C247F22","user_header":"","comment_is_top":false,"comment_ctime":1666958282,"is_pvip":true,"replies":[{"id":"131292","content":"å»ºè®®å…ˆè‡ªå·±å°è¯•å›ç­”ï¼Œè¯¾åé¢˜ç­”æ¡ˆåç»­çœ‹å›ç­”æƒ…å†µå†å…¬å¸ƒã€‚","user_name":"ç¼–è¾‘å›å¤","user_name_real":"ç¼–è¾‘","uid":"1501385","ctime":1667011334,"ip_address":"åŒ—äº¬","comment_id":360903,"utype":2}],"discussion_count":1,"race_medal":0,"score":"1666958282","product_id":100309001,"comment_content":"è€å¸ˆï¼ä½†æ˜¯è¯¾åé¢˜æœ‰ç­”ç–‘ç¯‡å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"å¬æ°´çš„æ¹–","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591992,"discussion_content":"å»ºè®®å…ˆè‡ªå·±å°è¯•å›ç­”ï¼Œè¯¾åé¢˜ç­”æ¡ˆåç»­çœ‹å›ç­”æƒ…å†µå†å…¬å¸ƒã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667011335,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":8}","child_discussion_number":0,"child_discussions":[]}]}]}