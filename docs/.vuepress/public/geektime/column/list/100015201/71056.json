{"id":71056,"title":"45 | å¹•åè‹±é›„ï¼šSIG-Nodeä¸CRI","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å¼ ç£Šã€‚ä»Šå¤©æˆ‘å’Œä½ åˆ†äº«çš„ä¸»é¢˜æ˜¯ï¼šå¹•åè‹±é›„ä¹‹SIG-Nodeä¸CRIã€‚</p><p>åœ¨å‰é¢çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä¸ºä½ è¯¦ç»†è®²è§£äº†å…³äº Kubernetes è°ƒåº¦å’Œèµ„æºç®¡ç†ç›¸å…³çš„å†…å®¹ã€‚å®é™…ä¸Šï¼Œåœ¨è°ƒåº¦è¿™ä¸€æ­¥å®Œæˆåï¼ŒKubernetes å°±éœ€è¦è´Ÿè´£å°†è¿™ä¸ªè°ƒåº¦æˆåŠŸçš„ Podï¼Œåœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºå‡ºæ¥ï¼Œå¹¶æŠŠå®ƒæ‰€å®šä¹‰çš„å„ä¸ªå®¹å™¨å¯åŠ¨èµ·æ¥ã€‚è¿™äº›ï¼Œéƒ½æ˜¯ kubelet è¿™ä¸ªæ ¸å¿ƒç»„ä»¶çš„ä¸»è¦åŠŸèƒ½ã€‚</p><p>åœ¨æ¥ä¸‹æ¥ä¸‰ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°±æ·±å…¥åˆ° kubelet é‡Œé¢ï¼Œä¸ºä½ è¯¦ç»†å‰–æä¸€ä¸‹ Kubernetes å¯¹å®¹å™¨è¿è¡Œæ—¶çš„ç®¡ç†èƒ½åŠ›ã€‚</p><p>åœ¨ Kubernetes ç¤¾åŒºé‡Œï¼Œä¸ kubelet ä»¥åŠå®¹å™¨è¿è¡Œæ—¶ç®¡ç†ç›¸å…³çš„å†…å®¹ï¼Œéƒ½å±äº SIG-Node çš„èŒƒç•´ã€‚å¦‚æœä½ ç»å¸¸å‚ä¸ç¤¾åŒºçš„è¯ï¼Œä½ å¯èƒ½ä¼šè§‰å¾—ï¼Œç›¸æ¯”äºå…¶ä»–æ¯å¤©éƒ½çƒ­é—¹éå‡¡çš„ SIGå°ç»„ï¼ŒSIG-Node æ˜¯ Kubernetes é‡Œç›¸å¯¹æ²‰å¯‚ä¹Ÿä¸å¤ªå‘å£°çš„ä¸€ä¸ªå°ç»„ï¼Œå°ç»„é‡Œçš„æˆå‘˜ä¹Ÿå¾ˆå°‘åœ¨å¤–é¢å…¬å¼€å®£è®²ã€‚</p><p>ä¸è¿‡ï¼Œæ­£å¦‚æˆ‘å‰é¢æ‰€ä»‹ç»çš„ï¼ŒSIG-Nodeä»¥åŠ kubeletï¼Œå…¶å®æ˜¯ Kubernetesæ•´å¥—ä½“ç³»é‡Œéå¸¸æ ¸å¿ƒçš„ä¸€ä¸ªéƒ¨åˆ†ã€‚ æ¯•ç«Ÿï¼Œå®ƒä»¬æ‰æ˜¯ Kubernetes è¿™æ ·ä¸€ä¸ªå®¹å™¨ç¼–æ’ä¸ç®¡ç†ç³»ç»Ÿï¼Œè·Ÿå®¹å™¨æ‰“äº¤é“çš„ä¸»è¦â€œåœºæ‰€â€ã€‚</p><p>è€Œ kubelet è¿™ä¸ªç»„ä»¶æœ¬èº«ï¼Œä¹Ÿæ˜¯ Kubernetes é‡Œé¢ç¬¬äºŒä¸ªä¸å¯è¢«æ›¿ä»£çš„ç»„ä»¶ï¼ˆç¬¬ä¸€ä¸ªä¸å¯è¢«æ›¿ä»£çš„ç»„ä»¶å½“ç„¶æ˜¯ kube-apiserverï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>æ— è®ºå¦‚ä½•ï¼Œæˆ‘éƒ½ä¸å¤ªå»ºè®®ä½ å¯¹ kubelet çš„ä»£ç è¿›è¡Œå¤§é‡çš„æ”¹åŠ¨ã€‚ä¿æŒ kubelet è·Ÿä¸Šæ¸¸åŸºæœ¬ä¸€è‡´çš„é‡è¦æ€§ï¼Œå°±è·Ÿä¿æŒ kube-apiserver è·Ÿä¸Šæ¸¸ä¸€è‡´æ˜¯ä¸€ä¸ªé“ç†ã€‚</strong></p><!-- [[[read_end]]] --><p>å½“ç„¶ï¼Œ kubelet æœ¬èº«ï¼Œä¹Ÿæ˜¯æŒ‰ç…§â€œæ§åˆ¶å™¨â€æ¨¡å¼æ¥å·¥ä½œçš„ã€‚å®ƒå®é™…çš„å·¥ä½œåŸç†ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹æ‰€ç¤ºçš„ä¸€å¹…ç¤ºæ„å›¾æ¥è¡¨ç¤ºæ¸…æ¥šã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/91/03/914e097aed10b9ff39b509759f8b1d03.png?wh=1333*954\" alt=\"\"><br>\nå¯ä»¥çœ‹åˆ°ï¼Œkubelet çš„å·¥ä½œæ ¸å¿ƒï¼Œå°±æ˜¯ä¸€ä¸ªæ§åˆ¶å¾ªç¯ï¼Œå³ï¼šSyncLoopï¼ˆå›¾ä¸­çš„å¤§åœ†åœˆï¼‰ã€‚è€Œé©±åŠ¨è¿™ä¸ªæ§åˆ¶å¾ªç¯è¿è¡Œçš„äº‹ä»¶ï¼ŒåŒ…æ‹¬å››ç§ï¼š</p><ol>\n<li>\n<p>Pod æ›´æ–°äº‹ä»¶ï¼›</p>\n</li>\n<li>\n<p>Pod ç”Ÿå‘½å‘¨æœŸå˜åŒ–ï¼›</p>\n</li>\n<li>\n<p>kubelet æœ¬èº«è®¾ç½®çš„æ‰§è¡Œå‘¨æœŸï¼›</p>\n</li>\n<li>\n<p>å®šæ—¶çš„æ¸…ç†äº‹ä»¶ã€‚</p>\n</li>\n</ol><p>æ‰€ä»¥ï¼Œè·Ÿå…¶ä»–æ§åˆ¶å™¨ç±»ä¼¼ï¼Œkubelet å¯åŠ¨çš„æ—¶å€™ï¼Œè¦åšçš„ç¬¬ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯è®¾ç½® Listersï¼Œä¹Ÿå°±æ˜¯æ³¨å†Œå®ƒæ‰€å…³å¿ƒçš„å„ç§äº‹ä»¶çš„ Informerã€‚è¿™äº› Informerï¼Œå°±æ˜¯ SyncLoop éœ€è¦å¤„ç†çš„æ•°æ®çš„æ¥æºã€‚</p><p>æ­¤å¤–ï¼Œkubelet è¿˜è´Ÿè´£ç»´æŠ¤ç€å¾ˆå¤šå¾ˆå¤šå…¶ä»–çš„å­æ§åˆ¶å¾ªç¯ï¼ˆä¹Ÿå°±æ˜¯å›¾ä¸­çš„å°åœ†åœˆï¼‰ã€‚è¿™äº›æ§åˆ¶å¾ªç¯çš„åå­—ï¼Œä¸€èˆ¬è¢«ç§°ä½œæŸæŸ Managerï¼Œæ¯”å¦‚ Volume Managerã€Image Managerã€Node Status Managerç­‰ç­‰ã€‚</p><p>ä¸éš¾æƒ³åˆ°ï¼Œè¿™äº›æ§åˆ¶å¾ªç¯çš„è´£ä»»ï¼Œå°±æ˜¯é€šè¿‡æ§åˆ¶å™¨æ¨¡å¼ï¼Œå®Œæˆ kubelet çš„æŸé¡¹å…·ä½“èŒè´£ã€‚æ¯”å¦‚ Node Status Managerï¼Œå°±è´Ÿè´£å“åº” Node çš„çŠ¶æ€å˜åŒ–ï¼Œç„¶åå°† Node çš„çŠ¶æ€æ”¶é›†èµ·æ¥ï¼Œå¹¶é€šè¿‡ Heartbeat çš„æ–¹å¼ä¸ŠæŠ¥ç»™ APIServerã€‚å†æ¯”å¦‚ CPU Managerï¼Œå°±è´Ÿè´£ç»´æŠ¤è¯¥ Node çš„ CPU æ ¸çš„ä¿¡æ¯ï¼Œä»¥ä¾¿åœ¨ Pod é€šè¿‡ cpuset çš„æ–¹å¼è¯·æ±‚ CPU æ ¸çš„æ—¶å€™ï¼Œèƒ½å¤Ÿæ­£ç¡®åœ°ç®¡ç† CPU æ ¸çš„ä½¿ç”¨é‡å’Œå¯ç”¨é‡ã€‚</p><p>é‚£ä¹ˆè¿™ä¸ª <strong>SyncLoopï¼Œåˆæ˜¯å¦‚ä½•æ ¹æ® Pod å¯¹è±¡çš„å˜åŒ–ï¼Œæ¥è¿›è¡Œå®¹å™¨æ“ä½œçš„å‘¢ï¼Ÿ</strong></p><p>å®é™…ä¸Šï¼Œkubelet ä¹Ÿæ˜¯é€šè¿‡ Watchæœºåˆ¶ï¼Œç›‘å¬äº†ä¸è‡ªå·±ç›¸å…³çš„ Pod å¯¹è±¡çš„å˜åŒ–ã€‚å½“ç„¶ï¼Œè¿™ä¸ª Watch çš„è¿‡æ»¤æ¡ä»¶æ˜¯è¯¥ Pod çš„ nodeName å­—æ®µä¸è‡ªå·±ç›¸åŒã€‚kubelet ä¼šæŠŠè¿™äº› Pod çš„ä¿¡æ¯ç¼“å­˜åœ¨è‡ªå·±çš„å†…å­˜é‡Œã€‚</p><p>è€Œå½“ä¸€ä¸ª Pod å®Œæˆè°ƒåº¦ã€ä¸ä¸€ä¸ª Node ç»‘å®šèµ·æ¥ä¹‹åï¼Œ è¿™ä¸ª Pod çš„å˜åŒ–å°±ä¼šè§¦å‘ kubelet åœ¨æ§åˆ¶å¾ªç¯é‡Œæ³¨å†Œçš„ Handlerï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­çš„ HandlePods éƒ¨åˆ†ã€‚æ­¤æ—¶ï¼Œé€šè¿‡æ£€æŸ¥è¯¥ Pod åœ¨ kubelet å†…å­˜é‡Œçš„çŠ¶æ€ï¼Œkubelet å°±èƒ½å¤Ÿåˆ¤æ–­å‡ºè¿™æ˜¯ä¸€ä¸ªæ–°è°ƒåº¦è¿‡æ¥çš„ Podï¼Œä»è€Œè§¦å‘ Handler é‡Œ ADD äº‹ä»¶å¯¹åº”çš„å¤„ç†é€»è¾‘ã€‚</p><p>åœ¨å…·ä½“çš„å¤„ç†è¿‡ç¨‹å½“ä¸­ï¼Œkubelet ä¼šå¯åŠ¨ä¸€ä¸ªåå« Pod Update Workerçš„ã€å•ç‹¬çš„ Goroutine æ¥å®Œæˆå¯¹ Pod çš„å¤„ç†å·¥ä½œã€‚</p><p>æ¯”å¦‚ï¼Œå¦‚æœæ˜¯ ADD äº‹ä»¶çš„è¯ï¼Œkubelet å°±ä¼šä¸ºè¿™ä¸ªæ–°çš„ Pod ç”Ÿæˆå¯¹åº”çš„ Pod Statusï¼Œæ£€æŸ¥ Pod æ‰€å£°æ˜ä½¿ç”¨çš„ Volume æ˜¯ä¸æ˜¯å·²ç»å‡†å¤‡å¥½ã€‚ç„¶åï¼Œè°ƒç”¨ä¸‹å±‚çš„å®¹å™¨è¿è¡Œæ—¶ï¼ˆæ¯”å¦‚ Dockerï¼‰ï¼Œå¼€å§‹åˆ›å»ºè¿™ä¸ª Pod æ‰€å®šä¹‰çš„å®¹å™¨ã€‚</p><p>è€Œå¦‚æœæ˜¯ UPDATE äº‹ä»¶çš„è¯ï¼Œkubelet å°±ä¼šæ ¹æ® Pod å¯¹è±¡å…·ä½“çš„å˜æ›´æƒ…å†µï¼Œè°ƒç”¨ä¸‹å±‚å®¹å™¨è¿è¡Œæ—¶è¿›è¡Œå®¹å™¨çš„é‡å»ºå·¥ä½œã€‚</p><p>åœ¨è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>kubelet è°ƒç”¨ä¸‹å±‚å®¹å™¨è¿è¡Œæ—¶çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå¹¶ä¸ä¼šç›´æ¥è°ƒç”¨ Docker çš„ APIï¼Œè€Œæ˜¯é€šè¿‡ä¸€ç»„å«ä½œ CRIï¼ˆContainer Runtime Interfaceï¼Œå®¹å™¨è¿è¡Œæ—¶æ¥å£ï¼‰çš„ gRPC æ¥å£æ¥é—´æ¥æ‰§è¡Œçš„ã€‚</strong></p><p>Kubernetes é¡¹ç›®ä¹‹æ‰€ä»¥è¦åœ¨ kubelet ä¸­å¼•å…¥è¿™æ ·ä¸€å±‚å•ç‹¬çš„æŠ½è±¡ï¼Œå½“ç„¶æ˜¯ä¸ºäº†å¯¹ Kubernetes å±è”½ä¸‹å±‚å®¹å™¨è¿è¡Œæ—¶çš„å·®å¼‚ã€‚å®é™…ä¸Šï¼Œå¯¹äº 1.6ç‰ˆæœ¬ä¹‹å‰çš„ Kubernetes æ¥è¯´ï¼Œå®ƒå°±æ˜¯ç›´æ¥è°ƒç”¨Docker çš„ API æ¥åˆ›å»ºå’Œç®¡ç†å®¹å™¨çš„ã€‚</p><p>ä½†æ˜¯ï¼Œæ­£å¦‚æˆ‘åœ¨æœ¬ä¸“æ å¼€å§‹ä»‹ç»å®¹å™¨èƒŒæ™¯çš„æ—¶å€™æåˆ°è¿‡çš„ï¼ŒDocker é¡¹ç›®é£é¡å…¨çƒåä¸ä¹…ï¼ŒCoreOS å…¬å¸å°±æ¨å‡ºäº† rkt é¡¹ç›®æ¥ä¸ Docker æ­£é¢ç«äº‰ã€‚åœ¨è¿™ç§èƒŒæ™¯ä¸‹ï¼ŒKubernetes é¡¹ç›®çš„é»˜è®¤å®¹å™¨è¿è¡Œæ—¶ï¼Œè‡ªç„¶ä¹Ÿå°±æˆäº†ä¸¤å®¶å…¬å¸è§’é€çš„é‡è¦æˆ˜åœºã€‚</p><p>æ¯‹åº¸ç½®ç–‘ï¼ŒDocker é¡¹ç›®å¿…ç„¶æ˜¯ Kubernetes é¡¹ç›®æœ€ä¾èµ–çš„å®¹å™¨è¿è¡Œæ—¶ã€‚ä½†å‡­å€Ÿä¸ Google å…¬å¸éåŒä¸€èˆ¬çš„å…³ç³»ï¼ŒCoreOS å…¬å¸è¿˜æ˜¯åœ¨2016å¹´æˆåŠŸåœ°å°†å¯¹ rkt å®¹å™¨çš„æ”¯æŒï¼Œç›´æ¥æ·»åŠ è¿›äº† kubelet çš„ä¸»å¹²ä»£ç é‡Œã€‚</p><p>ä¸è¿‡ï¼Œè¿™ä¸ªâ€œèµ¶é¸­å­ä¸Šæ¶â€çš„ä¸¾åŠ¨ï¼Œå¹¶æ²¡æœ‰ä¸º rkt é¡¹ç›®å¸¦æ¥æ›´å¤šçš„ç”¨æˆ·ï¼Œåè€Œç»™ kubelet çš„ç»´æŠ¤äººå‘˜ï¼Œå¸¦æ¥äº†å·¨å¤§çš„è´Ÿæ‹…ã€‚</p><p>ä¸éš¾æƒ³è±¡ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ <strong>kubelet ä»»ä½•ä¸€æ¬¡é‡è¦åŠŸèƒ½çš„æ›´æ–°ï¼Œéƒ½ä¸å¾—ä¸è€ƒè™‘Docker å’Œ rkt è¿™ä¸¤ç§å®¹å™¨è¿è¡Œæ—¶çš„å¤„ç†åœºæ™¯ï¼Œç„¶ååˆ†åˆ«æ›´æ–° Docker å’Œ rkt ä¸¤éƒ¨åˆ†ä»£ç ã€‚</strong></p><p>æ›´è®©äººä¸ºéš¾çš„æ˜¯ï¼Œç”±äº rkt é¡¹ç›®å®åœ¨å¤ªå°ä¼—ï¼Œkubelet å›¢é˜Ÿæ‰€æœ‰ä¸ rkt ç›¸å…³çš„ä»£ç ä¿®æ”¹ï¼Œéƒ½å¿…é¡»ä¾èµ–äº CoreOS çš„å‘˜å·¥æ‰èƒ½åšåˆ°ã€‚è¿™ä¸ä»…æ‹–æ…¢äº† kubelet çš„å¼€å‘å‘¨æœŸï¼Œä¹Ÿç»™é¡¹ç›®çš„ç¨³å®šæ€§å¸¦æ¥äº†å·¨å¤§çš„éšæ‚£ã€‚</p><p>ä¸æ­¤åŒæ—¶ï¼Œåœ¨2016å¹´ï¼ŒKata Containers é¡¹ç›®çš„å‰èº«runVé¡¹ç›®ä¹Ÿå¼€å§‹é€æ¸æˆç†Ÿï¼Œè¿™ç§åŸºäºè™šæ‹ŸåŒ–æŠ€æœ¯çš„å¼ºéš”ç¦»å®¹å™¨ï¼Œä¸ Kubernetes å’Œ Linux å®¹å™¨é¡¹ç›®ä¹‹é—´å…·æœ‰è‰¯å¥½çš„äº’è¡¥å…³ç³»ã€‚æ‰€ä»¥ï¼Œ<strong>åœ¨ Kubernetes ä¸Šæ¸¸ï¼Œå¯¹è™šæ‹ŸåŒ–å®¹å™¨çš„æ”¯æŒå¾ˆå¿«å°±è¢«æä¸Šäº†æ—¥ç¨‹ã€‚</strong></p><p>ä¸è¿‡ï¼Œè™½ç„¶è™šæ‹ŸåŒ–å®¹å™¨è¿è¡Œæ—¶æœ‰å„ç§ä¼˜ç‚¹ï¼Œä½†å®ƒä¸ Linux å®¹å™¨æˆªç„¶ä¸åŒçš„å®ç°æ–¹å¼ï¼Œä½¿å¾—å®ƒè·Ÿ Kubernetes çš„é›†æˆå·¥ä½œï¼Œæ¯” rkt è¦å¤æ‚å¾—å¤šã€‚å¦‚æœæ­¤æ—¶ï¼Œå†æŠŠå¯¹runVæ”¯æŒçš„ä»£ç ä¹Ÿä¸€èµ·æ·»åŠ åˆ° kubelet å½“ä¸­ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥kubelet çš„ç»´æŠ¤å·¥ä½œå°±å¯ä»¥è¯´å®Œå…¨æ²¡åŠæ³•æ­£å¸¸è¿›è¡Œäº†ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨2016å¹´ï¼ŒSIG-Node å†³å®šå¼€å§‹åŠ¨æ‰‹è§£å†³ä¸Šè¿°é—®é¢˜ã€‚è€Œè§£å†³åŠæ³•ä¹Ÿå¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œé‚£å°±æ˜¯æŠŠ kubelet å¯¹å®¹å™¨çš„æ“ä½œï¼Œç»Ÿä¸€åœ°æŠ½è±¡æˆä¸€ä¸ªæ¥å£ã€‚è¿™æ ·ï¼Œkubelet å°±åªéœ€è¦è·Ÿè¿™ä¸ªæ¥å£æ‰“äº¤é“äº†ã€‚è€Œä½œä¸ºå…·ä½“çš„å®¹å™¨é¡¹ç›®ï¼Œæ¯”å¦‚ Dockerã€ rktã€runVï¼Œå®ƒä»¬å°±åªéœ€è¦è‡ªå·±æä¾›ä¸€ä¸ªè¯¥æ¥å£çš„å®ç°ï¼Œç„¶åå¯¹ kubelet æš´éœ²å‡º gRPC æœåŠ¡å³å¯ã€‚</p><p>è¿™ä¸€å±‚ç»Ÿä¸€çš„å®¹å™¨æ“ä½œæ¥å£ï¼Œå°±æ˜¯ CRIäº†ã€‚æˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œä¸ºä½ è¯¦ç»†è®²è§£ CRI çš„è®¾è®¡ä¸å…·ä½“çš„å®ç°åŸç†ã€‚</p><p>è€Œåœ¨æœ‰äº† CRI ä¹‹åï¼ŒKubernetes ä»¥åŠ kubelet æœ¬èº«çš„æ¶æ„ï¼Œå°±å¯ä»¥ç”¨å¦‚ä¸‹æ‰€ç¤ºçš„ä¸€å¹…ç¤ºæ„å›¾æ¥æè¿°ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/51/fe/5161bd6201942f7a1ed6d70d7d55acfe.png?wh=1940*1005\" alt=\"\"><br>\nå¯ä»¥çœ‹åˆ°ï¼Œå½“ Kubernetes é€šè¿‡ç¼–æ’èƒ½åŠ›åˆ›å»ºäº†ä¸€ä¸ª Pod ä¹‹åï¼Œè°ƒåº¦å™¨ä¼šä¸ºè¿™ä¸ª Pod é€‰æ‹©ä¸€ä¸ªå…·ä½“çš„èŠ‚ç‚¹æ¥è¿è¡Œã€‚è¿™æ—¶å€™ï¼Œkubelet å½“ç„¶å°±ä¼šé€šè¿‡å‰é¢è®²è§£è¿‡çš„ SyncLoop æ¥åˆ¤æ–­éœ€è¦æ‰§è¡Œçš„å…·ä½“æ“ä½œï¼Œæ¯”å¦‚åˆ›å»ºä¸€ä¸ªPodã€‚é‚£ä¹ˆæ­¤æ—¶ï¼Œkubelet å®é™…ä¸Šå°±ä¼šè°ƒç”¨ä¸€ä¸ªå«ä½œ GenericRuntime çš„é€šç”¨ç»„ä»¶æ¥å‘èµ·åˆ›å»º Pod çš„ CRI è¯·æ±‚ã€‚</p><p>é‚£ä¹ˆï¼Œ<strong>è¿™ä¸ª CRI è¯·æ±‚ï¼Œåˆè¯¥ç”±è°æ¥å“åº”å‘¢ï¼Ÿ</strong></p><p>å¦‚æœä½ ä½¿ç”¨çš„å®¹å™¨é¡¹ç›®æ˜¯ Docker çš„è¯ï¼Œé‚£ä¹ˆè´Ÿè´£å“åº”è¿™ä¸ªè¯·æ±‚çš„å°±æ˜¯ä¸€ä¸ªå«ä½œ dockershim çš„ç»„ä»¶ã€‚å®ƒä¼šæŠŠ CRI è¯·æ±‚é‡Œçš„å†…å®¹æ‹¿å‡ºæ¥ï¼Œç„¶åç»„è£…æˆ Docker API è¯·æ±‚å‘ç»™ Docker Daemonã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ Kubernetes ç›®å‰çš„å®ç°é‡Œï¼Œdockershim ä¾ç„¶æ˜¯ kubelet ä»£ç çš„ä¸€éƒ¨åˆ†ã€‚å½“ç„¶ï¼Œåœ¨å°†æ¥ï¼Œdockershim è‚¯å®šä¼šè¢«ä» kubelet é‡Œç§»å‡ºæ¥ï¼Œç”šè‡³ç›´æ¥è¢«åºŸå¼ƒæ‰ã€‚</p><p>è€Œæ›´æ™®éçš„åœºæ™¯ï¼Œå°±æ˜¯ä½ éœ€è¦åœ¨æ¯å°å®¿ä¸»æœºä¸Šå•ç‹¬å®‰è£…ä¸€ä¸ªè´Ÿè´£å“åº” CRI çš„ç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶ï¼Œä¸€èˆ¬è¢«ç§°ä½œCRI shimã€‚é¡¾åæ€ä¹‰ï¼ŒCRI shim çš„å·¥ä½œï¼Œå°±æ˜¯æ‰®æ¼” kubelet ä¸å®¹å™¨é¡¹ç›®ä¹‹é—´çš„â€œå«ç‰‡â€ï¼ˆshimï¼‰ã€‚æ‰€ä»¥å®ƒçš„ä½œç”¨éå¸¸å•ä¸€ï¼Œé‚£å°±æ˜¯å®ç° CRI è§„å®šçš„æ¯ä¸ªæ¥å£ï¼Œç„¶åæŠŠå…·ä½“çš„ CRI è¯·æ±‚â€œç¿»è¯‘â€æˆå¯¹åç«¯å®¹å™¨é¡¹ç›®çš„è¯·æ±‚æˆ–è€…æ“ä½œã€‚</p><h2>æ€»ç»“</h2><p>åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘é¦–å…ˆä¸ºä½ ä»‹ç»äº† SIG-Node çš„èŒè´£ï¼Œä»¥åŠ kubelet è¿™ä¸ªç»„ä»¶çš„å·¥ä½œåŸç†ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä¸ºä½ é‡ç‚¹è®²è§£äº† kubelet ç©¶ç«Ÿæ˜¯å¦‚ä½•å°† Kubernetes å¯¹åº”ç”¨çš„å®šä¹‰ï¼Œä¸€æ­¥æ­¥è½¬æ¢æˆæœ€ç»ˆå¯¹ Docker æˆ–è€…å…¶ä»–å®¹å™¨é¡¹ç›®çš„API è¯·æ±‚çš„ã€‚</p><p>ä¸éš¾çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œkubelet çš„ SyncLoop å’Œ CRI çš„è®¾è®¡ï¼Œæ˜¯å…¶ä¸­æœ€é‡è¦çš„ä¸¤ä¸ªå…³é”®ç‚¹ã€‚ä¹Ÿæ­£æ˜¯åŸºäºä»¥ä¸Šè®¾è®¡ï¼ŒSyncLoop æœ¬èº«å°±è¦æ±‚è¿™ä¸ªæ§åˆ¶å¾ªç¯æ˜¯ç»å¯¹ä¸å¯ä»¥è¢«é˜»å¡çš„ã€‚æ‰€ä»¥ï¼Œå‡¡æ˜¯åœ¨ kubelet é‡Œæœ‰å¯èƒ½ä¼šè€—è´¹å¤§é‡æ—¶é—´çš„æ“ä½œï¼Œæ¯”å¦‚å‡†å¤‡ Pod çš„ Volumeã€æ‹‰å–é•œåƒç­‰ï¼ŒSyncLoop éƒ½ä¼šå¼€å¯å•ç‹¬çš„ Goroutine æ¥è¿›è¡Œæ“ä½œã€‚</p><h2>æ€è€ƒé¢˜</h2><p>è¯·é—®ï¼Œåœ¨ä½ çš„é¡¹ç›®ä¸­ï¼Œä½ æ˜¯å¦‚ä½•éƒ¨ç½² kubelet è¿™ä¸ªç»„ä»¶çš„ï¼Ÿä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿ</p><p>æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæ¬¢è¿ä½ ç»™æˆ‘ç•™è¨€ï¼Œä¹Ÿæ¬¢è¿åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><p></p>","comments":[{"had_liked":false,"id":266089,"user_name":"çº¦ä¹¦äºš","can_delete":false,"product_type":"c1","uid":1046714,"ip_address":"","ucode":"81EA27ADD9EC1A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg","comment_is_top":false,"comment_ctime":1607161863,"is_pvip":false,"discussion_count":11,"race_medal":0,"score":"345204545543","product_id":100015201,"comment_content":"æ•´æ•´2å¹´å‰çš„å†…å®¹äº†ï¼Œè¿™ä¸¤å¤©æœ€å¤§çš„æ–°é—»å°±æ˜¯k8så°†å¼ƒç”¨dockerï¼Œç§»é™¤dockershimï¼Œæ‰€ä»¥ç‰¹æ„è·‘æ¥ç•™è¨€","like_count":81,"discussions":[{"author":{"id":1348090,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIwWPicOxyL0sIVicLOcFI5IIEkffn56gOzRWfFY6exEmUUbxPicHyWC579SM6jga3oxcLzRibGHoA9Qw/132","nickname":"èƒ–è¾¾","note":"","ucode":"84E23DB84F258A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":340576,"discussion_content":"å¼ å¤§çš„æ–‡ç« å†™çš„çœŸæ˜¯å¥½ï¼Œæ²¡æœ‰æ·±åšçš„åŠŸåŠ›æ˜¯æ— æ³•å†™å‡ºè¿™æ ·çš„ä¸“æ çš„","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1610067101,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1614908,"avatar":"https://static001.geekbang.org/account/avatar/00/18/a4/3c/e7e1c0f0.jpg","nickname":"å†²å†²å†²","note":"","ucode":"82F7D8829E3797","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332619,"discussion_content":"æ—¶é—´è¿‡å¾—å¥½å¿«å•Š","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1607269371,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1046714,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg","nickname":"çº¦ä¹¦äºš","note":"","ucode":"81EA27ADD9EC1A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1614908,"avatar":"https://static001.geekbang.org/account/avatar/00/18/a4/3c/e7e1c0f0.jpg","nickname":"å†²å†²å†²","note":"","ucode":"82F7D8829E3797","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334874,"discussion_content":"æˆ‘ä»¬è¿˜æ˜¯é‚£ä¸ªæ¬ç –çš„å°‘å¹´","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1608015741,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":332619,"ip_address":""},"score":334874,"extra":""},{"author":{"id":1751859,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/bb/33/5545b42e.jpg","nickname":"Bobo","note":"","ucode":"23102FBE943515","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1046714,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg","nickname":"çº¦ä¹¦äºš","note":"","ucode":"81EA27ADD9EC1A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":356175,"discussion_content":"å¤§ç¥ä½ è¿˜éœ€è¦æ¬ç –ä¹ˆ  æ˜¯ä¸æ˜¯å·²ç»æˆé•¿ä¸ºk8så¤§ç¥äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615545337,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":334874,"ip_address":""},"score":356175,"extra":""}]},{"author":{"id":1202174,"avatar":"https://static001.geekbang.org/account/avatar/00/12/57/fe/beab006d.jpg","nickname":"Jasper","note":"","ucode":"A07ABF45D39089","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":410680,"discussion_content":"ä¸‰å¹´å‰äº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1635756783,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1105387,"avatar":"https://static001.geekbang.org/account/avatar/00/10/dd/eb/80f9d212.jpg","nickname":"lttzzlll","note":"","ucode":"FA160F7C02ABAA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393614,"discussion_content":"æ˜¯ â€œå¼ƒç”¨â€ å—ï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1631518062,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1269156,"avatar":"https://static001.geekbang.org/account/avatar/00/13/5d/a4/2e4b6d33.jpg","nickname":"ç´ è¿˜çœŸ","note":"","ucode":"9ABA456355F7E3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":347453,"discussion_content":"åºŸé™¤ä»¥åå’‹åŠ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612234059,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1025679,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a6/8f/12cfdaf8.jpg","nickname":"å¢™å£ä¸Šçš„å£è™","note":"","ucode":"05B8AF3F5B9B9B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1269156,"avatar":"https://static001.geekbang.org/account/avatar/00/13/5d/a4/2e4b6d33.jpg","nickname":"ç´ è¿˜çœŸ","note":"","ucode":"9ABA456355F7E3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":379619,"discussion_content":"ä½¿ç”¨containerd","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624016092,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":347453,"ip_address":""},"score":379619,"extra":""},{"author":{"id":1237199,"avatar":"https://static001.geekbang.org/account/avatar/00/12/e0/cf/43f201f2.jpg","nickname":"å¹¼å„¿ç¼–ç¨‹æ•™å­¦","note":"","ucode":"F13F3150E6CAE9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1025679,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a6/8f/12cfdaf8.jpg","nickname":"å¢™å£ä¸Šçš„å£è™","note":"","ucode":"05B8AF3F5B9B9B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":397622,"discussion_content":"å¤§å®¶ç°åœ¨ä½¿ç”¨containerdäº†å—ï¼Ÿåº”è¯¥è¿˜éƒ½æ˜¯dockerå§","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1632654650,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":379619,"ip_address":""},"score":397622,"extra":""}]},{"author":{"id":1807117,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM6GcSnUMzR0H9haiaAxssjibGLQMLAsPKonh50g9W2Iz38LcZNGH39HPaANLtovXTp1YvsINIZoH6F0iaSGuxJMXZS/132","nickname":"Geek_10d981","note":"","ucode":"AF4E774D17F7B9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":346078,"discussion_content":"æ¥¼ä¸Šçš„å„ä½ï¼Œè®¤è¯†ä¸€ä¸‹ï¼Œæˆ‘åœ¨åŠ æ‹¿å¤§ï¼Œ30ä¸ªç¾¤å‹å­¦ä¹ K8Sï¼Œè”ç³»ä¸€ä¸‹ï¼Œå¾®ä¿¡   14169399856","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611851049,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2156207,"avatar":"https://static001.geekbang.org/account/avatar/00/20/e6/af/acf4a949.jpg","nickname":"å±±å¤–é’å±±æ¥¼å¤–æ¥¼å¤–æ¥¼","note":"","ucode":"19FDB1FA5D394F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":345536,"discussion_content":"oh my god\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611738078,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47147,"user_name":"hjydxy","can_delete":false,"product_type":"c1","uid":1258714,"ip_address":"","ucode":"A1340360926734","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ibYCL2nbctJDpBLwZXlKIX7Z4XUicBm1ibIbLd0dWMYibxtshnEzOWAl5LC7JgMcjSet5B30s2HUpiabhYyyFWiaWd1Q/132","comment_is_top":false,"comment_ctime":1544063580,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"61673605724","product_id":100015201,"comment_content":"è¯·æ•™è€å¸ˆä¸€ä¸ªé—®é¢˜ï¼Œç°åœ¨æœ‰ä¸€ä¸ªlinuxçš„k8sé›†ç¾¤ï¼Œä¸€ä¸ªwindowsçš„k8sé›†ç¾¤ï¼Œå¯ä¸å¯ä»¥æŠŠè¿™ä¸¤ä¸ªé›†ç¾¤ç»Ÿä¸€ç»„å»ºæˆä¸€ä¸ªæ–°çš„è”é‚¦é›†ç¾¤ï¼Œç»Ÿä¸€è°ƒåº¦ï¼Ÿ","like_count":14,"discussions":[{"author":{"id":1206545,"avatar":"https://static001.geekbang.org/account/avatar/00/12/69/11/831cec7d.jpg","nickname":"å°å¯å­ã€‚(â‰¥3â‰¤)","note":"","ucode":"6D978BDCBB2862","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348850,"discussion_content":"ä¸å­˜åœ¨windows k8s é›†ç¾¤ã€‚ã€‚ è‚¯å®šæ˜¯windowsä¸‹è™šæ‹Ÿçš„linux boxé‡Œé¢çš„é›†ç¾¤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612753310,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46766,"user_name":"å‹¤åŠ³çš„å°èƒ–å­-libo","can_delete":false,"product_type":"c1","uid":1158344,"ip_address":"","ucode":"5BB20CD5A56568","user_header":"https://static001.geekbang.org/account/avatar/00/11/ac/c8/4b1c0d40.jpg","comment_is_top":false,"comment_ctime":1543978609,"is_pvip":false,"replies":[{"id":"17510","content":"åœ¨nodeä¸Šã€‚ä¸¤å¥—ä»£ç ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1544533677,"ip_address":"","comment_id":46766,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27313782385","product_id":100015201,"comment_content":"&quot;å½“ Kubernetes é€šè¿‡ç¼–æ’èƒ½åŠ›åˆ›å»ºäº†ä¸€ä¸ª Pod ä¹‹åï¼Œè°ƒ åº¦å™¨ä¼šä¸ºè¿™ä¸ªPodé€‰æ‹©ä¸€ä¸ªå…·ä½“çš„èŠ‚ç‚¹æ¥è¿è¡Œã€‚è¿™æ—¶å€™ï¼Œkubeletä¼šã€‚ã€‚ã€‚ã€‚åˆ›å»ºä¸€ä¸ªPod&quot;<br>è¯·æ•™ï¼Œè¿™ä¸ªkubeletä»¥åŠéšåçš„CRI grpc-&gt;dockershim&#47;CRIshim æ˜¯åœ¨å…·ä½“çš„nodeä¸Šé¢è¿è¡Œçš„å—ï¼Ÿè¿˜æ˜¯é€šè¿‡masteræ¥è¿œç¨‹è°ƒç”¨çš„ï¼Ÿ<br>å¦å¤–ï¼Œä¸ºä»€ä¹ˆä¸dockershimå¹¶åˆ—çš„å«remote(no-op)ï¼Œéš¾é“éƒ½æ˜¯ä¸åœ¨åŒä¸€ä¸ªnodeçš„è¿œç¨‹åˆ›å»ºï¼Ÿ","like_count":7,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431537,"discussion_content":"åœ¨nodeä¸Šã€‚ä¸¤å¥—ä»£ç ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544533677,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":336808,"user_name":"Slide","can_delete":false,"product_type":"c1","uid":1368465,"ip_address":"","ucode":"9D968BBDBE5656","user_header":"https://static001.geekbang.org/account/avatar/00/14/e1/91/195f6f4c.jpg","comment_is_top":false,"comment_ctime":1646379528,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23121216008","product_id":100015201,"comment_content":"è¿™ä¸“æ ä»19å¹´å¹´åº•å¼€å§‹çœ‹ï¼Œå›å¤´æ¥å›çœ‹å®Œäº†å¥½å‡ éï¼Œæ¯ä¸€æ¬¡éƒ½æœ‰æ–°çš„ç†è§£ã€‚ã€‚","like_count":6},{"had_liked":false,"id":268191,"user_name":"zhenLEE@Saddam","can_delete":false,"product_type":"c1","uid":1398724,"ip_address":"","ucode":"41E541EFF956E9","user_header":"https://static001.geekbang.org/account/avatar/00/15/57/c4/8a799b4e.jpg","comment_is_top":false,"comment_ctime":1608098273,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"23082934753","product_id":100015201,"comment_content":"dockershimç”±dockerå¼€æºç»´æŠ¤äº†ï¼Œç°åœ¨çœ‹æ¥ï¼Œæœ‰å¿…è¦çœ‹çœ‹containedäº† ","like_count":5,"discussions":[{"author":{"id":2677511,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIgsP6UzNiaph34q9AiaPj7WR8moALHkWpKAibLXn4zULibocJzF6ErSb6YJTlUEPlSZtkibwD9QK5BN0A/132","nickname":"Geek_f0e081","note":"","ucode":"B0BB6982B847B6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":404271,"discussion_content":"æ¥è‡ª2021å¹´4å­£åº¦çš„å›å¤, dockerä¾ç„¶ç”¨çš„å¾ˆå¥½, æ„Ÿè§‰è¦çœ‹å°±è¯¥çœ‹ kata containeräº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634275729,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":176091,"user_name":"chenhz","can_delete":false,"product_type":"c1","uid":1078160,"ip_address":"","ucode":"485420EA3282D4","user_header":"https://static001.geekbang.org/account/avatar/00/10/73/90/9118f46d.jpg","comment_is_top":false,"comment_ctime":1580954273,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18760823457","product_id":100015201,"comment_content":"ä½¿ç”¨ ansible-playbook éƒ¨ç½²åˆ° Node ã€‚","like_count":4},{"had_liked":false,"id":52646,"user_name":"æ™®ç½—@åºé“®","can_delete":false,"product_type":"c1","uid":1201651,"ip_address":"","ucode":"B6A9EB4019CD30","user_header":"https://static001.geekbang.org/account/avatar/00/12/55/f3/4e8fecaa.jpg","comment_is_top":false,"comment_ctime":1545465461,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14430367349","product_id":100015201,"comment_content":"åŸç”Ÿéƒ¨ç½²æˆ–è€…å®¹å™¨éƒ¨ç½²ï¼Œä¸è¿‡è¿™é‡Œçš„å®¹å™¨ä¸èƒ½å’Œk8sä½¿ç”¨çš„å®¹å™¨é‡å ã€‚ğŸ˜","like_count":3,"discussions":[{"author":{"id":1261493,"avatar":"https://static001.geekbang.org/account/avatar/00/13/3f/b5/5fe77e16.jpg","nickname":"ä¸ç»æ„é—´","note":"","ucode":"C39D98697ACB8B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384623,"discussion_content":"å¾—åœ¨kubeletçš„å†…å­˜é‡Œç¼“å­˜å®ƒçš„ä¿¡æ¯å•Šï¼Œä½†æ˜¯ç¼“å­˜é‡Œçš„ä¿¡æ¯æ¥æºäºapiserverã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626681929,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47289,"user_name":"Geek_9ca34e","can_delete":false,"product_type":"c1","uid":1222861,"ip_address":"","ucode":"9A9FDBBCCBE19B","user_header":"","comment_is_top":false,"comment_ctime":1544101264,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14429003152","product_id":100015201,"comment_content":"è€å¸ˆï¼Œæˆ‘ç”¨kubeadm æ­å»ºäº†ä¸€ä¸ªk8sé›†ç¾¤ï¼Œåˆæ­å»ºäº†ä¸€ä¸ªCeph rbdï¼Œä¸¤ä¸ªé›†ç¾¤ä¸åœ¨ç›¸åŒçš„æœºå™¨ä¸Šï¼Œæˆ‘ç°åœ¨æ‰‹åŠ¨åˆ›å»ºPVï¼ŒPVCï¼ŒCSï¼Œå¹¶ç»‘å®špodæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯æˆ‘æƒ³å®ç°PVCåŠ¨æ€ç»‘å®šCSå´ä¸è¡Œï¼Œæˆ‘çœ‹ç½‘ä¸Šè¯´éœ€è¦å®‰è£…rbd-priviæ’ä»¶ï¼Œä½†æ˜¯æ’ä»¶é…å¥½åï¼Œè¿˜æ˜¯ä¸èƒ½åŠ¨æ€åˆ›å»ºpvï¼Œtoï¼›é€šè¿‡logæ—¥å¿—æŸ¥çœ‹ï¼Œå¥½åƒæ˜¯è®¿é—®ä¸åˆ°corednsï¼Œè¯·é—®è€å¸ˆæœ‰å¥½çš„è§£å†³æ–¹æ³•éº½ï¼Ÿ","like_count":3},{"had_liked":false,"id":46921,"user_name":"wutz","can_delete":false,"product_type":"c1","uid":1016094,"ip_address":"","ucode":"179CD76183D4F4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/81/1e/d266733a.jpg","comment_is_top":false,"comment_ctime":1544002191,"is_pvip":false,"replies":[{"id":"17508","content":"è¿™å°±æ˜¯æˆ‘ä¹‹å‰è¯´çš„ï¼Œåšä¸å®Œï¼Œä¸å¥½åšå•Š","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1544533611,"ip_address":"","comment_id":46921,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14428904079","product_id":100015201,"comment_content":"kubernetes 1.13 æœ€è¿‘åˆšå‘å¸ƒï¼Œkubeadm ä¹Ÿ GA äº†ï¼Œä¸ºä½•å…¶ HA æ”¯æŒè¢«ç§»é™¤äº†ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431601,"discussion_content":"è¿™å°±æ˜¯æˆ‘ä¹‹å‰è¯´çš„ï¼Œåšä¸å®Œï¼Œä¸å¥½åšå•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544533611,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46784,"user_name":"Goteswille","can_delete":false,"product_type":"c1","uid":1273814,"ip_address":"","ucode":"7FE7EA19E865F5","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLyfjHfjulibFGPTewSZZHm2M8yfI7BZmO9vLUFoagveCw3DWYDss7y1CecKia7lT5yb9KoAmsya2zg/132","comment_is_top":false,"comment_ctime":1543980984,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14428882872","product_id":100015201,"comment_content":"æ‰“å¡","like_count":3},{"had_liked":false,"id":344806,"user_name":"æ€€æ£æ¢¦æƒ³çš„å­¦æ¸£","can_delete":false,"product_type":"c1","uid":1916685,"ip_address":"","ucode":"2349B9F4F6FDE3","user_header":"https://static001.geekbang.org/account/avatar/00/1d/3f/0d/1e8dbb2c.jpg","comment_is_top":false,"comment_ctime":1651800997,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"10241735589","product_id":100015201,"comment_content":"æ­£å¦‚ä½œè€…è®²çš„ï¼ŒDockershimç¡®å®è¦åˆ é™¤ã€‚ä»Šå¤©åœ¨å®˜æ–¹æ–‡æ¡£çœ‹åˆ°â€œDockershim removed from Kubernetes<br>As of Kubernetes 1.24, Dockershim is no longer included in Kubernetes. â€","like_count":3},{"had_liked":false,"id":47254,"user_name":"Vinsec","can_delete":false,"product_type":"c1","uid":1227766,"ip_address":"","ucode":"BFD541E05D3AD7","user_header":"https://static001.geekbang.org/account/avatar/00/12/bb/f6/af833125.jpg","comment_is_top":false,"comment_ctime":1544089618,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5839056914","product_id":100015201,"comment_content":"è·Ÿä¸ä¸Šäº†ï¼Œæˆ‘è¦å¿«ç‚¹çœ‹ï¼ï¼ï¼","like_count":1},{"had_liked":false,"id":346700,"user_name":"Geek_842c94","can_delete":false,"product_type":"c1","uid":2151517,"ip_address":"","ucode":"0BB38D1AE0407D","user_header":"http://thirdwx.qlogo.cn/mmopen/uqaRIfRCAhJ6t1z92XYEzTHlzk8IVNVXIS13zP2m2qlPZSAauSz81Ru1H0jUnnspAwfVjvlUtMXd9XA7LnKic3PDcIFH8xEQp/132","comment_is_top":false,"comment_ctime":1653367992,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1653367992","product_id":100015201,"comment_content":"å®é™…ä¸Šï¼Œkubelet ä¹Ÿæ˜¯é€šè¿‡ Watch æœºåˆ¶ï¼Œç›‘å¬äº†ä¸è‡ªå·±ç›¸å…³çš„ Pod å¯¹è±¡çš„å˜åŒ–ã€‚å½“ç„¶ï¼Œè¿™ä¸ª Watch çš„è¿‡æ»¤æ¡ä»¶æ˜¯è¯¥ Pod çš„ nodeName å­—æ®µä¸è‡ªå·±ç›¸åŒã€‚kubelet ä¼šæŠŠè¿™äº› Pod çš„ä¿¡æ¯ç¼“å­˜åœ¨è‡ªå·±çš„å†…å­˜é‡Œã€‚<br><br>kubeletä¸æ˜¯è¿è¡Œåœ¨Nodeä¸Šçš„å—ï¼Œä»–ç›‘å¬çš„æ˜¯æ‰€æœ‰çš„Podï¼Ÿè¿˜æ˜¯è¯´åªç›‘å¬æœ¬èŠ‚ç‚¹çš„Podä¿¡æ¯","like_count":0},{"had_liked":false,"id":340505,"user_name":"Don Wang","can_delete":false,"product_type":"c1","uid":1319529,"ip_address":"","ucode":"1853365FA279F2","user_header":"https://static001.geekbang.org/account/avatar/00/14/22/69/09f7a8a2.jpg","comment_is_top":false,"comment_ctime":1648868031,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1648868031","product_id":100015201,"comment_content":"ç¬¬ä¸‰éï¼Œç¬¬å››ééƒ½æ˜¯å“ªé‡Œæœ‰éœ€æ±‚ï¼Œçœ‹å“ªé‡Œäº†...","like_count":0},{"had_liked":false,"id":319843,"user_name":"é™ˆæ–¯ä½³","can_delete":false,"product_type":"c1","uid":1259323,"ip_address":"","ucode":"C236F874FC767A","user_header":"https://static001.geekbang.org/account/avatar/00/13/37/3b/495e2ce6.jpg","comment_is_top":false,"comment_ctime":1635986914,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1635986914","product_id":100015201,"comment_content":"ç¬¬å››åä¸‰è¯¾:å¹•åè‹±é›„:SIG-Nodeå’ŒCRI<br>kube-apiserverå’Œkubeletæ˜¯k8sä¸­æœ€æ ¸å¿ƒçš„ä¸¤ä¸ªç»„å»ºã€‚å…¶ä¸­kubeletæ˜¯å±äºSIG-Nodeçš„èŒƒç•´ã€‚<br><br>kubeletçš„å·¥ä½œæ ¸å¿ƒæ˜¯ä¸€ä¸ªå«åšSyncLoopçš„æ§åˆ¶å¾ªç¯ã€‚é©±åŠ¨è¿™ä¸ªæ§åˆ¶å¾ªç¯è¿è¡Œçš„äº‹ä»¶åŒ…æ‹¬å››ç§:<br>1. Podæ›´æ–°äº‹ä»¶<br>2. Podç”Ÿå‘½å‘¨æœŸå˜åŒ–<br>3. kubeletæœ¬èº«è®¾ç½®çš„æ‰§è¡Œå‘¨æœŸ<br>4. å®šæ—¶çš„æ¸…ç†äº‹ä»¶<br><br>kubeletå¯åŠ¨æ—¶è¦åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯è®¾ç½®Listersï¼Œæ³¨å†Œå®ƒæ‰€å…³å¿ƒçš„çš„Informer.è¿™äº›Informerå°±æ˜¯SyncLoopéœ€è¦å¤„ç†çš„æ•°æ®çš„æ¥æºã€‚kubeletè¿˜è´Ÿè´£å¾ˆå¤šå­æ§åˆ¶å¾ªç¯ï¼Œæ¯”å¦‚Volume Manager, Image Manager, Node status Manager.kubeletè¿˜ä¼šé€šè¿‡Watchæœºåˆ¶æ¥ç›‘å¬å…³å¿ƒçš„Podå¯¹è±¡çš„å˜åŒ–ã€‚<br><br>CRIæ˜¯è´Ÿè´£kubebletå’Œåº•å±‚å®¹å™¨æ‰“äº¤é“çš„ç»Ÿä¸€æ¥å£<br>","like_count":0},{"had_liked":false,"id":311891,"user_name":"lttzzlll","can_delete":false,"product_type":"c1","uid":1105387,"ip_address":"","ucode":"FA160F7C02ABAA","user_header":"https://static001.geekbang.org/account/avatar/00/10/dd/eb/80f9d212.jpg","comment_is_top":false,"comment_ctime":1631523279,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631523279","product_id":100015201,"comment_content":"æœ¬æ–‡æ”¶è·ï¼šæ‰€æœ‰çš„å¼‚æ­¥ä»»åŠ¡ï¼Œéƒ½éœ€è¦é˜Ÿåˆ—è¿™ç§é€»è¾‘ç»“æ„ã€‚","like_count":0},{"had_liked":false,"id":305368,"user_name":"æ‚Ÿç©º","can_delete":false,"product_type":"c1","uid":1019739,"ip_address":"","ucode":"69C990105DEF47","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8f/5b/2f16ca95.jpg","comment_is_top":false,"comment_ctime":1627940969,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627940969","product_id":100015201,"comment_content":"å„ä½æœ‹å‹çœ‹åˆ°è¿™é‡Œ ç›¸ä¿¡å¤§å®¶éƒ½å¯¹k8sæœ‰æ‰€æ”¶è·ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ç¬¬äºŒéå­¦ä¹ ï¼Œæ¯ä¸€ééƒ½æœ‰ä¸åŒçš„æ”¶è·ï¼Œæˆ‘å»ºäº†ä¸€ä¸ªk8sçš„å­¦ä¹ ç¾¤ï¼Œæ—¥å¸¸åˆ†äº«å­¦ä¹ å¿ƒå¾—å’Œç­”ç–‘è§£æƒ‘ å¸®åŠ©å¤§å®¶ä¸€èµ·æˆé•¿ï¼Œæ¬¢è¿å¤§å®¶åŠ å…¥è¿›æ¥ä¸€èµ·è¿›æ­¥ï¼Œä¸ªäººå¾®ä¿¡ coder_wukong æ¬¢è¿åŠ å¥½å‹","like_count":0},{"had_liked":false,"id":302386,"user_name":"æäºŒæœ¨","can_delete":false,"product_type":"c1","uid":1103091,"ip_address":"","ucode":"30E03BB84ADB27","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/f3/129d6dfe.jpg","comment_is_top":false,"comment_ctime":1626185916,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1626185916","product_id":100015201,"comment_content":"SyncLoop æ„Ÿè§‰è·Ÿnettyçš„eventloop æœ‰ç‚¹åƒã€‚","like_count":0},{"had_liked":false,"id":288112,"user_name":"å•Šç¼à¸„à¸´à¸”à¸–à¸¶à¸‡","can_delete":false,"product_type":"c1","uid":1248706,"ip_address":"","ucode":"C6F7522BF0F3B5","user_header":"https://static001.geekbang.org/account/avatar/00/13/0d/c2/37662333.jpg","comment_is_top":false,"comment_ctime":1618305201,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618305201","product_id":100015201,"comment_content":"æ‰“å¡ï¼Œè€å¸ˆè®²çš„çœŸå¥½ï¼","like_count":0},{"had_liked":false,"id":280085,"user_name":"à¬˜ç³ÌŒç³ÌŒà¬“","can_delete":false,"product_type":"c1","uid":2162260,"ip_address":"","ucode":"2F2640F6AC012B","user_header":"https://static001.geekbang.org/account/avatar/00/20/fe/54/51976e52.jpg","comment_is_top":false,"comment_ctime":1614073339,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1614073339","product_id":100015201,"comment_content":"å¼ è€å¸ˆï¼Œæˆ‘ä»¬è¿™è¾¹é‡åˆ°ä¸€ä¸ªé—®é¢˜ã€‚å°±æ˜¯åœ¨å®é™…åº”ç”¨æ—¶ï¼Œé¢‘ç¹åœ¨æœåŠ¡å™¨ä¸Šå¯åŠ¨å’Œé”€æ¯PODï¼Œä¼šå‡ºç°PODåˆ›å»ºå’Œé”€æ¯çš„é€Ÿåº¦å˜æ…¢ï¼Œç”šè‡³å‡ºç°PODä¸€ç›´ä¸ºContainerCreatingçŠ¶æ€ã€‚é€šè¿‡æŸ¥çœ‹æ˜¯ç”±äºsystemctl list-units --all | wc -lè¿‡å¤šå¯¼è‡´çš„é—®é¢˜ï¼Œå…¶ä¸­ï¼Œä¸€ä¸ªæœˆç§¯ç´¯çš„dhcp-interface@veth00665a8.service                                                                             loaded    failed   failed  DHCP interface veth00665a8  ä¸ªæ•°è¶…è¿‡10ä¸‡ä¸ªï¼Œè¯·é—®æœ‰æ²¡æœ‰ä»€ä¹ˆè§£å†³æ–¹æ³•ã€‚è°¢è°¢","like_count":0},{"had_liked":false,"id":253732,"user_name":"Heaven","can_delete":false,"product_type":"c1","uid":1694207,"ip_address":"","ucode":"FA33FBCC66C911","user_header":"https://static001.geekbang.org/account/avatar/00/19/d9/ff/b23018a6.jpg","comment_is_top":false,"comment_ctime":1602846103,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602846103","product_id":100015201,"comment_content":"ä½¿ç”¨åŸç”Ÿéƒ¨ç½²æˆ–è€…å®¹å™¨éƒ¨ç½²å§","like_count":0},{"had_liked":false,"id":47292,"user_name":"Geek_9ca34e","can_delete":false,"product_type":"c1","uid":1222861,"ip_address":"","ucode":"9A9FDBBCCBE19B","user_header":"","comment_is_top":false,"comment_ctime":1544101822,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544101822","product_id":100015201,"comment_content":"è€å¸ˆåˆšåˆšæ’ä»¶åå­—æ‰“é”™äº†ï¼Œæ˜¯rbd-provisioneræ’ä»¶","like_count":0},{"had_liked":false,"id":46790,"user_name":"Johnson","can_delete":false,"product_type":"c1","uid":1225037,"ip_address":"","ucode":"55B582953E49F3","user_header":"https://static001.geekbang.org/account/avatar/00/12/b1/4d/10c75b34.jpg","comment_is_top":false,"comment_ctime":1543983055,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543983055","product_id":100015201,"comment_content":"å•ç‹¬éƒ¨ç½²å¹¶ç»´æŠ¤kubelet","like_count":0},{"had_liked":false,"id":46664,"user_name":"é»„æ»¡","can_delete":false,"product_type":"c1","uid":1227500,"ip_address":"","ucode":"D184471591F50B","user_header":"https://static001.geekbang.org/account/avatar/00/12/ba/ec/9ee8b869.jpg","comment_is_top":false,"comment_ctime":1543970160,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543970160","product_id":100015201,"comment_content":"æ‰“å¡","like_count":0}]}