{"id":719462,"title":"23ï½œæ˜“é€Ÿé²œèŠ±èŠå¤©å®¢æœæœºå™¨äººçš„å¼€å‘ï¼ˆä¸‹ï¼‰","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯é»„ä½³ï¼Œæ¬¢è¿æ¥åˆ°LangChainå®æˆ˜è¯¾ï¼</p><p>ä¸ŠèŠ‚è¯¾ï¼Œå’±ä»¬çš„èŠå¤©æœºå™¨äººå·²ç»åŸºæœ¬å®Œæˆï¼Œè¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬è¦çœ‹ä¸€çœ‹å¦‚ä½•æŠŠå®ƒéƒ¨ç½²åˆ°ç½‘ç»œä¸Šã€‚</p><h2>â€œèŠå¤©æœºå™¨äººâ€é¡¹ç›®è¯´æ˜</h2><p>ç®€å•å›é¡¾ä¸€ä¸‹è¿™ä¸ªé¡¹ç›®çš„è®¾è®¡ã€‚</p><p><strong>ç¬¬ä¸€æ­¥ï¼š</strong>é€šè¿‡LangChainçš„ConversationChainï¼Œå®ç°ä¸€ä¸ªæœ€åŸºæœ¬çš„èŠå¤©å¯¹è¯å·¥å…·ã€‚</p><p><strong>ç¬¬äºŒæ­¥ï¼š</strong>é€šè¿‡LangChainä¸­çš„è®°å¿†åŠŸèƒ½ï¼Œè®©è¿™ä¸ªèŠå¤©æœºå™¨äººèƒ½å¤Ÿè®°ä½ç”¨æˆ·ä¹‹å‰æ‰€è¯´çš„è¯ã€‚</p><p><strong>ç¬¬ä¸‰æ­¥ï¼š</strong>é€šè¿‡LangChainä¸­çš„æ£€ç´¢åŠŸèƒ½ï¼Œæ•´åˆæ˜“é€Ÿé²œèŠ±çš„å†…éƒ¨æ–‡æ¡£èµ„æ–™ï¼Œè®©èŠå¤©æœºå™¨äººä¸ä»…èƒ½å¤ŸåŸºäºè‡ªå·±çš„çŸ¥è¯†ï¼Œè¿˜å¯ä»¥åŸºäºæ˜“é€Ÿé²œèŠ±çš„ä¸šåŠ¡æµç¨‹ï¼Œç»™å‡ºä¸“ä¸šçš„å›ç­”ã€‚</p><p><strong>ç¬¬å››æ­¥ï¼ˆå¯é€‰ï¼‰ï¼š</strong>é€šè¿‡LangChainä¸­çš„æ•°æ®åº“æŸ¥è¯¢åŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥è¾“å…¥è®¢å•å·æ¥æŸ¥è¯¢è®¢å•çŠ¶æ€ï¼Œæˆ–è€…çœ‹çœ‹æœ‰æ²¡æœ‰å­˜è´§ç­‰ç­‰ã€‚</p><p><strong>ç¬¬äº”æ­¥ï¼š</strong>åœ¨ç½‘ç»œä¸Šéƒ¨ç½²åŠå‘å¸ƒè¿™ä¸ªèŠå¤©æœºå™¨äººï¼Œä¾›ä¼ä¸šå†…éƒ¨å‘˜å·¥å’Œæ˜“é€Ÿé²œèŠ±ç”¨æˆ·ä½¿ç”¨ã€‚</p><p>åœ¨ä¸Šä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡ Flask éƒ¨ç½²çš„äººè„‰å·¥å…·ã€‚Flaskæ˜¯ä¸€ä¸ªé€šç”¨çš„ã€å¾®å‹çš„Webåº”ç”¨æ¡†æ¶ï¼Œéå¸¸é€‚åˆåˆ›å»ºå„ç§Webåº”ç”¨ç¨‹åºï¼Œä¸ä»…ä»…å±€é™äºæœºå™¨å­¦ä¹ æˆ–æ•°æ®ç§‘å­¦é¡¹ç›®ã€‚Flaskä¸ºå¼€å‘è€…æä¾›äº†å¾ˆé«˜çš„çµæ´»æ€§ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰è·¯ç”±ã€æ¨¡æ¿ã€å‰ç«¯å’Œåç«¯çš„äº¤äº’ç­‰ç­‰ã€‚å¯¹äºåˆå­¦è€…ï¼ŒFlaskå¯èƒ½éœ€è¦æ›´é•¿æ—¶é—´æ¥å­¦ä¹ ï¼Œå°¤å…¶æ˜¯éœ€è¦ç»“åˆå…¶ä»–å‰ç«¯æŠ€æœ¯æˆ–æ•°æ®åº“æŠ€æœ¯æ—¶ã€‚</p><!-- [[[read_end]]] --><p>ä¸è¿‡ï¼Œå¯¹äºæœºå™¨å­¦ä¹ é¡¹ç›®æ¥è¯´ï¼Œæˆ‘ä»¬è¿˜æœ‰å…¶ä»–éƒ¨ç½²æ–¹æ¡ˆã€‚æ¯”å¦‚ Streamlit å’Œ Gradioï¼Œå°±ä¸ºæœºå™¨å­¦ä¹ å’Œæ•°æ®ç§‘å­¦åº”ç”¨æä¾›äº†å¿«é€Ÿã€ä¸“é—¨åŒ–çš„è§£å†³æ–¹æ¡ˆã€‚å¦‚æœä½ çš„é¡¹ç›®ç›®æ ‡æ˜¯å¿«é€Ÿå±•ç¤ºå’ŒéªŒè¯æ¨¡å‹æ•ˆæœï¼Œé‚£ä¹ˆ Streamlit å’Œ Gradio æ˜¯ä¼˜ç§€çš„é€‰æ‹©ã€‚è¿™äº›æ¡†æ¶æä¾›äº†ç®€å•æ˜“ç”¨çš„ API å’Œä¸°å¯Œçš„å¯è§†åŒ–ç»„ä»¶ï¼Œè®©ä½ å¯ä»¥ç”¨å°‘é‡ä»£ç å¿«é€Ÿæ„å»ºäº¤äº’å¼åº”ç”¨ç¨‹åºï¼Œæé«˜ä½ çš„å¼€å‘æ•ˆç‡ï¼Œä¹Ÿå¯ä»¥æ›´å¥½åœ°å±•ç¤ºå·¥ä½œæˆæœã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘å°±å¸¦ç€ä½ ç”¨è¿™ä¸¤ç§æœºå™¨å­¦ä¹ éƒ¨ç½²æ¡†æ¶æ¥å±•ç¤ºæˆ‘ä»¬çš„èŠå¤©æœºå™¨äººã€‚</p><h2>æ–¹æ¡ˆ 1 ï¼šé€šè¿‡ Streamlit éƒ¨ç½²èŠå¤©æœºå™¨äºº</h2><p>é¦–å…ˆæ¥çœ‹çœ‹Streamlitã€‚è¿™æ˜¯ä¸€ä¸ªæŒºæœ‰åçš„ä¸“é—¨ä¸ºæ•°æ®ç§‘å­¦å®¶å’Œæœºå™¨å­¦ä¹ å·¥ç¨‹å¸ˆè®¾è®¡çš„å¼€æºPythonåº“ï¼Œå®ƒå¯ä»¥è¿…é€Ÿåœ°å°†Pythonè„šæœ¬è½¬åŒ–ä¸ºäº¤äº’å¼Webåº”ç”¨ã€‚</p><p><strong>Streamlit</strong> <strong>çš„ä¸€äº›ä¸»è¦ç‰¹ç‚¹å’Œäº®ç‚¹åŒ…æ‹¬ï¼š</strong></p><ul>\n<li>ç®€æ˜“æ€§ï¼šStreamlit çš„çœŸæ­£é­…åŠ›åœ¨äºå®ƒçš„ç®€å•æ€§ï¼Œåªéœ€å‡ è¡Œä»£ç ï¼Œä½ å°±å¯ä»¥ä¸ºå…¶æ•°æ®æˆ–æ¨¡å‹åˆ›å»ºäº¤äº’å¼åº”ç”¨ã€‚</li>\n<li>æ— éœ€å‰ç«¯ç»éªŒï¼šä¸ä¼ ç»Ÿçš„Webå¼€å‘æ¡†æ¶ç›¸æ¯”ï¼Œä½¿ç”¨ Streamlitï¼Œä½ ä¸éœ€è¦æ·±å…¥äº†è§£HTMLã€CSSæˆ–JavaScriptï¼Œæ‰€æœ‰äº¤äº’éƒ½æ˜¯é€šè¿‡Pythonä»£ç æ¥ç®¡ç†çš„ã€‚</li>\n<li>å®æ—¶äº¤äº’ï¼šå½“ä½ æ›´æ”¹ä»£ç æˆ–æ•°æ®æ—¶ï¼ŒStreamlit åº”ç”¨ä¼šå®æ—¶æ›´æ–°ï¼Œè¿™ä¸ºè¿­ä»£å’Œå®éªŒæä¾›äº†æå¤§çš„ä¾¿åˆ©ã€‚</li>\n<li>å†…ç½®ç»„ä»¶ï¼šStreamlit é™„å¸¦äº†è®¸å¤šå†…ç½®çš„å¯è§†åŒ–å’Œäº¤äº’ç»„ä»¶ï¼Œå¦‚æ»‘å—ã€æŒ‰é’®ã€è¡¨æ ¼ç­‰ï¼Œå¯ä»¥æ— ç¼é›†æˆåˆ°ä½ çš„åº”ç”¨ä¸­ã€‚</li>\n<li>æ•°æ®é›†å¯è§†åŒ–ï¼šé™¤äº†åŸºæœ¬çš„å›¾å½¢å’Œå›¾è¡¨ï¼ŒStreamlit è¿˜æ”¯æŒå…¶ä»–æ•°æ®å¯è§†åŒ–åº“ï¼Œå¦‚ Plotlyã€Matplotlib å’Œ Altairï¼Œä½¿ä½ èƒ½å¤Ÿè½»æ¾åœ°å±•ç¤ºæ•°æ®ã€‚</li>\n<li>è®¾è®¡ç®€æ´ï¼šStreamlit çš„ç•Œé¢è®¾è®¡ç®€æ´è€Œä¼˜é›…ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºçœ‹èµ·æ¥æ—¢ä¸“ä¸šåˆæ—¶å°šã€‚</li>\n<li>éƒ¨ç½²å’Œå…±äº«ï¼šå°½ç®¡ Streamlit ä¸“æ³¨äºåˆ›å»ºåº”ç”¨ï¼Œä½†å®ƒä¹Ÿæœ‰ä¸éƒ¨ç½²å’Œåˆ†äº«ç›¸å…³çš„å·¥å…·å’Œæ•´åˆï¼Œå¦‚ Streamlit Sharingï¼Œå…è®¸ä½ å…è´¹æ‰˜ç®¡å…¶åº”ç”¨ã€‚</li>\n<li>ç¤¾åŒºä¸ç”Ÿæ€ç³»ç»Ÿï¼šStreamlit æ‹¥æœ‰ä¸€ä¸ªç§¯æçš„å¼€æºç¤¾åŒºï¼Œå®šæœŸæä¾›æ–°çš„åŠŸèƒ½æ›´æ–°ã€ç»„ä»¶å’Œæ‰©å±•ã€‚</li>\n</ul><p><img src=\"https://static001.geekbang.org/resource/image/71/6a/718fbd049acdf8681185805384028f6a.jpg?wh=1448x679\" alt=\"\"></p><p>æˆ‘ä»¬ç”¨ä¸‹é¢çš„è¯­å¥ï¼Œå®‰è£…Streamlitã€‚</p><pre><code class=\"language-plain\">pip install streamlit\n</code></pre><p>ç„¶åï¼Œç®€å•çš„å‡ è¡Œä»£ç ï¼Œå°±å¯ä»¥åšå‡ºä¸€ä¸ªç½‘é¡µç‰ˆçš„å°ç¨‹åºã€‚</p><pre><code class=\"language-plain\">import streamlit as st\n\n# è®¾ç½®æ ‡é¢˜\nst.title('å¹³æ–¹è®¡ç®—å™¨')\n\n# åˆ›å»ºä¸€ä¸ªæ»‘å—\nnumber = st.slider(\"Select a number:\", min_value=0, max_value=100)\n\n# æ˜¾ç¤ºé€‰ä¸­æ•°å­—çš„å¹³æ–¹\nst.write(f\"Square of {number} is {number ** 2}\")\n</code></pre><p>ç”¨ <code>streamlit run &lt;your_script_name&gt;.py</code>ï¼ˆæ³¨æ„ï¼Œå¿…é¡»æ˜¯streamlit runå‘½ä»¤ï¼Œè€Œä¸æ˜¯é€šè¿‡pythonå‘½ä»¤æ¥è·‘ç¨‹åºï¼‰æ¥è¿è¡Œç¨‹åºï¼Œå°±å¯ä»¥åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°å®ƒã€‚</p><pre><code class=\"language-plain\">streamlit run 01_SimpleStreamlit.py\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/22/ee/22e0fcf90978160e1f50d75fe9a33dee.jpg?wh=661x458\" alt=\"\"></p><p>æ­¤æ—¶ï¼Œåœ¨ localhost çš„ 8501 ç«¯å£ï¼Œç¨‹åºå¼€å§‹å¯åŠ¨ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/ef/87/ef4e3a09a3df9776330b343e721fbe87.jpg?wh=1364x1189\" alt=\"\"></p><p>ä¸‹é¢å°±é€šè¿‡ Streamlit æ¥é‡æ„èŠå¤©æœºå™¨äººã€‚</p><pre><code class=\"language-plain\"># å¯¼å…¥æ‰€éœ€çš„åº“\nimport os\nimport streamlit as st\nfrom langchain.text_splitter import RecursiveCharacterTextSplitter\nfrom langchain.embeddings import OpenAIEmbeddings\nfrom langchain.vectorstores import Qdrant\nfrom langchain.memory import ConversationSummaryMemory\nfrom langchain.chat_models import ChatOpenAI\nfrom langchain.chains import ConversationalRetrievalChain\nfrom langchain.document_loaders import PyPDFLoader\nfrom langchain.document_loaders import Docx2txtLoader\nfrom langchain.document_loaders import TextLoader\n\n# è®¾ç½®OpenAI APIå¯†é’¥\nos.environ[\"OPENAI_API_KEY\"] = 'Your OpenAI Key' &nbsp;\n\n# ChatBotç±»çš„å®ç°\nclass ChatbotWithRetrieval:\n\n&nbsp; &nbsp; def __init__(self, dir):\n\n&nbsp; &nbsp; &nbsp; &nbsp; # åŠ è½½Documents\n&nbsp; &nbsp; &nbsp; &nbsp; base_dir = dir # æ–‡æ¡£çš„å­˜æ”¾ç›®å½•\n&nbsp; &nbsp; &nbsp; &nbsp; documents = []\n&nbsp; &nbsp; &nbsp; &nbsp; for file in os.listdir(base_dir): \n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; file_path = os.path.join(base_dir, file)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if file.endswith('.pdf'):\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; loader = PyPDFLoader(file_path)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; documents.extend(loader.load())\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elif file.endswith('.docx') or file.endswith('.doc'):\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; loader = Docx2txtLoader(file_path)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; documents.extend(loader.load())\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elif file.endswith('.txt'):\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; loader = TextLoader(file_path)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; documents.extend(loader.load())\n&nbsp; &nbsp; &nbsp; &nbsp; \n&nbsp; &nbsp; &nbsp; &nbsp; # æ–‡æœ¬çš„åˆ†å‰²\n&nbsp; &nbsp; &nbsp; &nbsp; text_splitter = RecursiveCharacterTextSplitter(chunk_size=200, chunk_overlap=0)\n&nbsp; &nbsp; &nbsp; &nbsp; all_splits = text_splitter.split_documents(documents)\n&nbsp; &nbsp; &nbsp; &nbsp; \n&nbsp; &nbsp; &nbsp; &nbsp; # å‘é‡æ•°æ®åº“\n&nbsp; &nbsp; &nbsp; &nbsp; self.vectorstore = Qdrant.from_documents(\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; documents=all_splits, # ä»¥åˆ†å—çš„æ–‡æ¡£\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; embedding=OpenAIEmbeddings(), # ç”¨OpenAIçš„Embedding ModelåšåµŒå…¥\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; location=\":memory:\", &nbsp;# in-memory å­˜å‚¨\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collection_name=\"my_documents\",) # æŒ‡å®šcollection_name\n&nbsp; &nbsp; &nbsp; &nbsp; \n&nbsp; &nbsp; &nbsp; &nbsp; # åˆå§‹åŒ–LLM\n&nbsp; &nbsp; &nbsp; &nbsp; self.llm = ChatOpenAI()\n&nbsp; &nbsp; &nbsp; &nbsp; \n&nbsp; &nbsp; &nbsp; &nbsp; # åˆå§‹åŒ–Memory\n&nbsp; &nbsp; &nbsp; &nbsp; self.memory = ConversationSummaryMemory(\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; llm=self.llm, \n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; memory_key=\"chat_history\", \n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return_messages=True\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )\n&nbsp; &nbsp; &nbsp; &nbsp; \n&nbsp; &nbsp; &nbsp; &nbsp; # è®¾ç½®Retrieval Chain\n&nbsp; &nbsp; &nbsp; &nbsp; retriever = self.vectorstore.as_retriever()\n&nbsp; &nbsp; &nbsp; &nbsp; self.qa = ConversationalRetrievalChain.from_llm(\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.llm, \n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; retriever=retriever, \n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; memory=self.memory\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )\n\n&nbsp; &nbsp; def chat_loop(self):\n&nbsp; &nbsp; &nbsp; &nbsp; print(\"Chatbot å·²å¯åŠ¨! è¾“å…¥'exit'æ¥é€€å‡ºç¨‹åºã€‚\")\n&nbsp; &nbsp; &nbsp; &nbsp; while True:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; user_input = input(\"ä½ : \")\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if user_input.lower() == 'exit':\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(\"å†è§!\")\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # è°ƒç”¨ Retrieval Chain &nbsp;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; response = self.qa(user_input)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(f\"Chatbot: {response['answer']}\")\n\n# Streamlitç•Œé¢çš„åˆ›å»º\ndef main():\n&nbsp; &nbsp; st.title(\"æ˜“é€Ÿé²œèŠ±èŠå¤©å®¢æœ\")\n\n&nbsp; &nbsp; # Check if the 'bot' attribute exists in the session state\n&nbsp; &nbsp; if \"bot\" not in st.session_state:\n&nbsp; &nbsp; &nbsp; &nbsp; st.session_state.bot = ChatbotWithRetrieval(\"OneFlower\")\n\n&nbsp; &nbsp; user_input = st.text_input(\"è¯·è¾“å…¥ä½ çš„é—®é¢˜ï¼š\")\n&nbsp; &nbsp; \n&nbsp; &nbsp; if user_input:\n&nbsp; &nbsp; &nbsp; &nbsp; response = st.session_state.bot.qa(user_input)\n&nbsp; &nbsp; &nbsp; &nbsp; st.write(f\"Chatbot: {response['answer']}\")\n\nif __name__ == \"__main__\":\n&nbsp; &nbsp; main()\n</code></pre><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ Streamlit è¿›è¡Œçš„æ›´æ”¹å’Œæ·»åŠ åŠŸèƒ½çš„ç®€è¦è¯´æ˜ã€‚</p><ol>\n<li>\n<p>ç•Œé¢åˆ›å»ºï¼š<br>\na.  <code>st.title(\"æ˜“é€Ÿé²œèŠ±èŠå¤©å®¢æœ\")</code>ï¼šè®¾ç½® Web åº”ç”¨ç¨‹åºçš„æ ‡é¢˜ä¸ºâ€œæ˜“é€Ÿé²œèŠ±èŠå¤©å®¢æœâ€ã€‚<br>\n&nbsp;</p>\n</li>\n<li>\n<p>ä¼šè¯çŠ¶æ€ï¼š<br>\na. ä½¿ç”¨ <code>st.session_state</code> æ¥å­˜å‚¨ç”¨æˆ·ä¼šè¯çŠ¶æ€ã€‚è¿™æ˜¯ Streamlit çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå…è®¸ä½ åœ¨ç”¨æˆ·ä¸åº”ç”¨ç¨‹åºäº¤äº’æ—¶ä¿å­˜å˜é‡ã€‚<br>\nb. <code>if \"bot\" not in st.session_state</code>ï¼šæ£€æŸ¥æ˜¯å¦å·²ç»æœ‰ä¸€ä¸ª bot å®ä¾‹å­˜åœ¨äº session state ä¸­ã€‚å¦‚æœæ²¡æœ‰ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°çš„ ChatbotWithRetrieval å®ä¾‹ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ° session stateã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥é¿å…åœ¨æ¯æ¬¡ç”¨æˆ·ä¸åº”ç”¨ç¨‹åºäº¤äº’æ—¶é‡æ–°åˆå§‹åŒ–æœºå™¨äººã€‚<br>\n&nbsp;</p>\n</li>\n<li>\n<p>ç”¨æˆ·äº¤äº’ï¼š<br>\na. <code>user_input = st.text_input(\"è¯·è¾“å…¥ä½ çš„é—®é¢˜ï¼š\")</code>ï¼šåˆ›å»ºä¸€ä¸ªæ–‡æœ¬è¾“å…¥æ¡†ä¾›ç”¨æˆ·è¾“å…¥é—®é¢˜ã€‚å½“ç”¨æˆ·è¾“å…¥å†…å®¹å¹¶æäº¤åï¼Œä»£ç ä¼šè·å–ç”¨æˆ·çš„è¾“å…¥ï¼Œå¹¶ä½¿ç”¨èŠå¤©æœºå™¨äººçš„ qa æ–¹æ³•æ¥è·å–å“åº”ã€‚<br>\nb. <code>st.write(f\"Chatbot: {response['answer']}\")</code>ï¼šåœ¨åº”ç”¨ç¨‹åºç•Œé¢ä¸Šæ˜¾ç¤ºæœºå™¨äººçš„å“åº”ã€‚<br>\n&nbsp;</p>\n</li>\n<li>\n<p>ä¸»å‡½æ•°ä¸­ï¼Œå½“è„šæœ¬è¢«æ‰§è¡Œæ—¶ï¼Œå®ƒå°†å¯åŠ¨ Streamlit æœåŠ¡å™¨ï¼Œå¹¶æ˜¾ç¤ºåˆ›å»ºçš„ Web åº”ç”¨ç¨‹åºã€‚</p>\n</li>\n</ol><p>ç”¨ <code>streamlit run</code> è¿è¡Œç¨‹åºï¼Œå°±å¯ä»¥å¼€å§‹èŠå¤©äº†ï¼</p><p><img src=\"https://static001.geekbang.org/resource/image/1f/49/1f380b60c8cdec362c9c8070c919d849.jpg?wh=3840x2076\" alt=\"\"></p><h2>æ–¹æ¡ˆ2 ï¼šé€šè¿‡ Gradio éƒ¨ç½²èŠå¤©æœºå™¨äºº</h2><p>ä¸ Streamlit ä¸åŒï¼ŒGradio ç•Œé¢æ›´ä¾§é‡äºæ¨¡å‹çš„äº¤äº’ï¼Œæ®è¯´ä¸Šæ‰‹ä¹Ÿæ›´ç®€å•ã€‚è¿™ä½¿å¾— Gradio éå¸¸é€‚åˆå±•ç¤ºå’Œæµ‹è¯•æœºå™¨å­¦ä¹ æ¨¡å‹ã€‚æˆ‘åœ¨GitHubä¸Šçœ‹åˆ°å¾ˆå¤šæ–°çš„å¼€æºLLMéƒ½æ˜¯æä¾›ä¸€ä¸ªGradio UIç•Œé¢æ¥è¿›è¡Œæµ‹è¯•çš„ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œ Streamlit åˆ™æä¾›äº†æ›´ä¸°å¯Œçš„ Web åº”ç”¨å¼€å‘åŠŸèƒ½ã€‚</p><p>åˆ°åº•æœ‰å¤šç®€å•ï¼Œç­‰ä¼šä½ çœ‹åˆ° Gradio UIçš„ç•Œé¢ï¼Œä½ å°±æ˜ç™½æˆ‘çš„æ„æ€äº†ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å…ˆå®‰è£…è¿™ä¸ªåŒ…ã€‚</p><pre><code class=\"language-plain\">pip install gradio\n</code></pre><p>é€šè¿‡ Gradio æ¡†æ¶é‡æ„èŠå¤©æœºå™¨äººçš„ç¨‹åºä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\"># å¯¼å…¥æ‰€éœ€çš„åº“\nimport os\nimport gradio as gr\nfrom langchain.text_splitter import RecursiveCharacterTextSplitter\nfrom langchain.embeddings import OpenAIEmbeddings\nfrom langchain.vectorstores import Qdrant\nfrom langchain.memory import ConversationSummaryMemory\nfrom langchain.chat_models import ChatOpenAI\nfrom langchain.chains import ConversationalRetrievalChain\nfrom langchain.document_loaders import PyPDFLoader\nfrom langchain.document_loaders import Docx2txtLoader\nfrom langchain.document_loaders import TextLoader\n\n# è®¾ç½®OpenAI APIå¯†é’¥\nos.environ[\"OPENAI_API_KEY\"] = 'Your OpenAI Key' &nbsp;\n\nclass ChatbotWithRetrieval:\n&nbsp; &nbsp; def __init__(self, dir):\n\n&nbsp; &nbsp; &nbsp; &nbsp; # åŠ è½½Documents\n&nbsp; &nbsp; &nbsp; &nbsp; base_dir = dir # æ–‡æ¡£çš„å­˜æ”¾ç›®å½•\n&nbsp; &nbsp; &nbsp; &nbsp; documents = []\n&nbsp; &nbsp; &nbsp; &nbsp; for file in os.listdir(base_dir): \n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; file_path = os.path.join(base_dir, file)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if file.endswith('.pdf'):\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; loader = PyPDFLoader(file_path)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; documents.extend(loader.load())\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elif file.endswith('.docx') or file.endswith('.doc'):\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; loader = Docx2txtLoader(file_path)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; documents.extend(loader.load())\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elif file.endswith('.txt'):\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; loader = TextLoader(file_path)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; documents.extend(loader.load())\n&nbsp; &nbsp; &nbsp; &nbsp; \n&nbsp; &nbsp; &nbsp; &nbsp; # æ–‡æœ¬çš„åˆ†å‰²\n&nbsp; &nbsp; &nbsp; &nbsp; text_splitter = RecursiveCharacterTextSplitter(chunk_size=200, chunk_overlap=0)\n&nbsp; &nbsp; &nbsp; &nbsp; all_splits = text_splitter.split_documents(documents)\n&nbsp; &nbsp; &nbsp; &nbsp; \n&nbsp; &nbsp; &nbsp; &nbsp; # å‘é‡æ•°æ®åº“\n&nbsp; &nbsp; &nbsp; &nbsp; self.vectorstore = Qdrant.from_documents(\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; documents=all_splits, # ä»¥åˆ†å—çš„æ–‡æ¡£\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; embedding=OpenAIEmbeddings(), # ç”¨OpenAIçš„Embedding ModelåšåµŒå…¥\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; location=\":memory:\", &nbsp;# in-memory å­˜å‚¨\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collection_name=\"my_documents\",) # æŒ‡å®šcollection_name\n&nbsp; &nbsp; &nbsp; &nbsp; \n&nbsp; &nbsp; &nbsp; &nbsp; # åˆå§‹åŒ–LLM\n&nbsp; &nbsp; &nbsp; &nbsp; self.llm = ChatOpenAI()\n&nbsp; &nbsp; &nbsp; &nbsp; \n&nbsp; &nbsp; &nbsp; &nbsp; # åˆå§‹åŒ–Memory\n&nbsp; &nbsp; &nbsp; &nbsp; self.memory = ConversationSummaryMemory(\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; llm=self.llm, \n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; memory_key=\"chat_history\", \n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return_messages=True\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )\n&nbsp; &nbsp; &nbsp; &nbsp; # åˆå§‹åŒ–å¯¹è¯å†å²\n&nbsp; &nbsp; &nbsp; &nbsp; self.conversation_history = \"\"\n\n&nbsp; &nbsp; &nbsp; &nbsp; # è®¾ç½®Retrieval Chain\n&nbsp; &nbsp; &nbsp; &nbsp; retriever = self.vectorstore.as_retriever()\n&nbsp; &nbsp; &nbsp; &nbsp; self.qa = ConversationalRetrievalChain.from_llm(\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.llm, \n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; retriever=retriever, \n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; memory=self.memory\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )\n\n&nbsp; &nbsp; def get_response(self, user_input): &nbsp;# è¿™æ˜¯ä¸º Gradio åˆ›å»ºçš„æ–°å‡½æ•°\n&nbsp; &nbsp; &nbsp; &nbsp; response = self.qa(user_input)\n&nbsp; &nbsp; &nbsp; &nbsp; # æ›´æ–°å¯¹è¯å†å²\n&nbsp; &nbsp; &nbsp; &nbsp; self.conversation_history += f\"ä½ : {user_input}\\nChatbot: {response['answer']}\\n\"\n&nbsp; &nbsp; &nbsp; &nbsp; return self.conversation_history\n\nif __name__ == \"__main__\":\n&nbsp; &nbsp; folder = \"OneFlower\"\n&nbsp; &nbsp; bot = ChatbotWithRetrieval(folder)\n\n&nbsp; &nbsp; # å®šä¹‰ Gradio ç•Œé¢\n&nbsp; &nbsp; interface = gr.Interface(\n&nbsp; &nbsp; &nbsp; &nbsp; fn=bot.get_response, &nbsp;# ä½¿ç”¨æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„å‡½æ•°\n&nbsp; &nbsp; &nbsp; &nbsp; inputs=\"text\", &nbsp;# è¾“å…¥æ˜¯æ–‡æœ¬\n&nbsp; &nbsp; &nbsp; &nbsp; outputs=\"text\", &nbsp;# è¾“å‡ºä¹Ÿæ˜¯æ–‡æœ¬\n&nbsp; &nbsp; &nbsp; &nbsp; live=False, &nbsp;# å®æ—¶æ›´æ–°ï¼Œè¿™æ ·ç”¨æˆ·å¯ä»¥è¿ç»­ä¸æ¨¡å‹äº¤äº’\n&nbsp; &nbsp; &nbsp; &nbsp; title=\"æ˜“é€Ÿé²œèŠ±æ™ºèƒ½å®¢æœ\", &nbsp;# ç•Œé¢æ ‡é¢˜\n&nbsp; &nbsp; &nbsp; &nbsp; description=\"è¯·è¾“å…¥é—®é¢˜ï¼Œç„¶åç‚¹å‡»æäº¤ã€‚\" &nbsp;# æè¿°\n&nbsp; &nbsp; )\n&nbsp; &nbsp; interface.launch() &nbsp;# å¯åŠ¨ Gradio ç•Œé¢\n</code></pre><p>ä»¥ä¸‹æ˜¯ Gradio éƒ¨åˆ†ä»£ç çš„è¯¦ç»†è§£é‡Šã€‚</p><ol>\n<li><code>get_response(self, user_input)</code>ï¼šè¿™ä¸ªæ–°å‡½æ•°æ˜¯ä¸º Gradio åˆ›å»ºçš„ï¼Œå®ƒæ¥æ”¶ç”¨æˆ·è¾“å…¥ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›æœºå™¨äººçš„å“åº”ã€‚ä¸ºäº†ä¿æŒèŠå¤©å†å²è¿ç»­æ€§ï¼Œæ­¤å‡½æ•°å°†æ¯æ¬¡çš„ç”¨æˆ·è¾“å…¥å’Œæœºå™¨äººçš„å“åº”æ·»åŠ åˆ° conversation_historyï¼Œå¹¶è¿”å›æ•´ä¸ªèŠå¤©å†å²ã€‚<br>\n&nbsp;</li>\n<li>ä½¿ç”¨ <code>gr.Interface()</code> æ¥å®šä¹‰ Gradio ç•Œé¢ã€‚<code>fn=bot.get_response</code>ï¼šè®¾ç½®ç•Œé¢çš„ä¸»å‡½æ•°ä¸ºåˆšåˆšåˆ›å»ºçš„ get_response å‡½æ•°ã€‚<code>live=False</code>ï¼šç¡®ä¿å®æ—¶æ›´æ–°æ˜¯å…³é—­çš„ï¼Œè¿™æ„å‘³ç€ç”¨æˆ·éœ€è¦ç‚¹å‡»æäº¤æŒ‰é’®æ¥å‘é€ä»–ä»¬çš„é—®é¢˜ï¼Œè€Œä¸æ˜¯ä¸€è¾¹æ‰“å­—ï¼Œä¸€è¾¹ç”Ÿæˆå›ç­”çš„æµæ¨¡å¼ï¼ˆæ¯”è¾ƒé€‚åˆå±•ç¤ºç”Ÿæˆå¼æ¨¡å‹ï¼‰ã€‚<br>\n&nbsp;</li>\n<li>å¯åŠ¨ Gradio ç•Œé¢ã€‚<code>interface.launch()</code>ï¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ä¼šå¯åŠ¨ Gradio çš„ Web æœåŠ¡å™¨ï¼Œå¹¶åœ¨é»˜è®¤çš„ Web æµè§ˆå™¨ä¸­æ‰“å¼€ä¸€ä¸ªæ–°çª—å£ï¼Œæ˜¾ç¤ºåˆšåˆšå®šä¹‰çš„ç•Œé¢ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è¿™ä¸ªç•Œé¢ä¸æœºå™¨äººäº¤äº’ã€‚</li>\n</ol><p>è¿è¡Œç¨‹åºï¼ŒèŠå¤©æœºå™¨äººåœ¨æœ¬åœ°ç«¯å£ 7860 ä¸Šå¯åŠ¨ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/28/26/28d3c772116bf4733ed55e937e476d26.jpg?wh=408x53\" alt=\"\"></p><p><img src=\"https://static001.geekbang.org/resource/image/46/d8/460fa6854ffa68ef4bfa54056cb034d8.jpg?wh=2140x1499\" alt=\"\"></p><p>è¿™é‡Œï¼Œè¾“å…¥è¾“å‡ºçª—å£çš„é…ç½®æ›´åŠ æ¸…æ™°ï¼Œè€Œä¸”ç›¸å¯¹äºåŸæ¥çš„åªè®°å½•ä¸€è½®å¯¹è¯çš„æœºå™¨äººï¼Œè¿™é‡Œæˆ‘ä»¬å¢åŠ äº†å†å²å¯¹è¯ä¿¡æ¯è®°å½•åŠŸèƒ½ã€‚</p><h2>æ€»ç»“æ—¶åˆ»</h2><p>Streamlit å’Œ Gradio éƒ½æ˜¯è®©æ•°æ®ç§‘å­¦å®¶å’Œå¼€å‘è€…èƒ½å¤Ÿå¿«é€Ÿä¸ºæœºå™¨å­¦ä¹ æ¨¡å‹åˆ›å»º Web UI çš„æ¡†æ¶ã€‚</p><ul>\n<li>Streamlit æ˜¯ä¸ºæ•°æ®åº”ç”¨ã€ä»ªè¡¨æ¿å’Œå¯è§†åŒ–è®¾è®¡çš„ã€‚å®ƒæä¾›äº†å¤šç§å°éƒ¨ä»¶ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥ä¸æ•°æ®å’Œæ¨¡å‹è¿›è¡Œäº¤äº’ã€‚å®ƒéå¸¸ Pythonicï¼Œæ„å‘³ç€å®ƒçš„ä½¿ç”¨æ–¹å¼éå¸¸è‡ªç„¶ï¼Œå¯¹äºç†Ÿæ‚‰Pythonçš„äººæ¥è¯´éå¸¸ç›´è§‚ã€‚</li>\n<li>Gradio æ›´å¤šæ˜¯ä¸ºäº†å±•ç¤ºå’Œæ¼”ç¤ºæœºå™¨å­¦ä¹ æ¨¡å‹ã€‚å®ƒæä¾›äº†ä¸€ç§å¿«é€Ÿçš„æ–¹æ³•ï¼Œä½¿éæŠ€æœ¯ç”¨æˆ·ä¹Ÿèƒ½ä¸æœºå™¨å­¦ä¹ æ¨¡å‹è¿›è¡Œäº¤äº’ï¼Œæ— éœ€ç¼–å†™å¤æ‚çš„ä»£ç ã€‚</li>\n</ul><p>ä»¥ä¸‹æ˜¯å¯¹å®ƒä»¬ç‰¹ç‚¹è¿›è¡Œçš„å¯¹æ¯”æ€»ç»“ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/65/87/654d95bdb96e627c2464b4cedd964e87.jpg?wh=1110x752\" alt=\"\"></p><p>æ— è®ºé€‰æ‹©å“ªä¸ªæ¡†æ¶ï¼Œä½ éƒ½å¯ä»¥åœ¨éå¸¸çŸ­çš„æ—¶é—´å†…ä¸ºä½ çš„åº”ç”¨åˆ›å»ºä¸€ä¸ªWeb UIã€‚è‡³äºé€‰æ‹©å“ªä¸ªï¼Œæ›´å¤šå–å†³äºä½ çš„å…·ä½“éœ€æ±‚å’Œä¸ªäººå–œå¥½ã€‚</p><p>å¦‚æœä½ ç”¨è¿™äº›æ¡†æ¶ï¼Œåœ¨ä½ ç†Ÿæ‚‰çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œåˆ©ç”¨LangChainå’ŒLLMçš„èƒ½åŠ›å¼€å‘å‡ºäº†æ›´ä¸ºé…·ç‚«çš„LangChainåº”ç”¨ï¼Œä¸è¦å¿˜è®°åœ¨ç•™è¨€åŒºä¸­å’Œå¤§å®¶åˆ†äº«ï¼è¯´è¯´æ€è·¯å°±è¡Œï¼Œæœ‰å…·ä½“ä»£ç å®ç°æ›´å¥½ã€‚</p><h2>æ€è€ƒé¢˜</h2><ol>\n<li>æˆ‘çš„æ˜“é€Ÿé²œèŠ±Chatbotæœ‰å¾ˆå¤šä¸å®Œç¾çš„åœ°æ–¹ï¼Œæ¯”å¦‚ï¼Œæ£€ç´¢åŠŸèƒ½çš„è®¾è®¡ä¸å¤Ÿç»†è‡´ï¼ŒUIä¸å¤Ÿç¾è§‚ï¼Œç­‰ç­‰ã€‚è¯·ä½ åœ¨è¿™ä¸ªRepoçš„åŸºç¡€ä¸Šï¼Œå¤§åˆ€é˜”æ–§åœ°è¿›è¡Œæ”¹è¿›ã€‚</li>\n<li>è¯·ä½ ç”¨Flaskæ¡†æ¶è®¾è®¡è‡ªå·±çš„Chatbot UIï¼Œé‡æ„èŠå¤©æœºå™¨äººï¼Œå®ç°æ›´å¤šã€æ›´å®Œå–„çš„åŠŸèƒ½ã€‚</li>\n<li>è¯·ä½ å›è¿‡å¤´å»çœ‹çœ‹<a href=\"https://time.geekbang.org/column/article/699400\">ç¬¬01è®²</a>æˆ‘ç»™ä½ ç•™çš„3é“æ€è€ƒé¢˜ã€‚é‚£æ—¶å€™ï¼Œä½ ä¸äº†è§£LangChainï¼Œç°åœ¨ä½ å·²ç»åŸºæœ¬æŒæ¡äº†å®ƒçš„ç²¾é«“ï¼Œèƒ½å¦æŠŠç¬¬01è®²çš„æ€è€ƒé¢˜é‡æ–°å›ç­”ä¸€éå‘¢ï¼Ÿåº”è¯¥å¾ˆæœ‰è¶£å§ï¼</li>\n</ol><p>æœŸå¾…åœ¨ç•™è¨€åŒºçœ‹åˆ°ä½ çš„æˆæœåˆ†äº«ï¼Œå¦‚æœè§‰å¾—å†…å®¹å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä¹Ÿæ¬¢è¿åˆ†äº«ç»™æœ‰éœ€è¦çš„æœ‹å‹ï¼</p>","comments":[{"had_liked":false,"id":383236,"user_name":"Yimmy","can_delete":false,"product_type":"c1","uid":1177248,"ip_address":"åŒ—äº¬","ucode":"E66EAF7050C74A","user_header":"https://static001.geekbang.org/account/avatar/00/11/f6/a0/8ea0bfba.jpg","comment_is_top":false,"comment_ctime":1698732671,"is_pvip":false,"replies":[{"id":139601,"content":"å·²ç»æ›´æ–°å•¦","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1809833,"ctime":1698770633,"ip_address":"ç‘å£«","comment_id":383236,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100617601,"comment_content":"è€å¸ˆå¥½ï¼Œå®è·µç¯èŠ‚çš„ä»£ç ï¼Œåœ¨githubä¸Šæ²¡æœ‰çœ‹åˆ°ï¼ˆç¬¬20-23èŠ‚è¯¾ç¨‹çš„ï¼‰","like_count":3,"discussions":[{"author":{"id":1809833,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/a9/4602808f.jpg","nickname":"é»„ä½³","note":"","ucode":"8EC41D2EAB0E3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":630672,"discussion_content":"å·²ç»æ›´æ–°å•¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1698770634,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ç‘å£«","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383217,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"åŒ—äº¬","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1698713323,"is_pvip":false,"replies":[{"id":139598,"content":"Streamlit å’Œ Gradio ä¸»è¦è®¾è®¡ç”¨äºåˆ›å»ºæ•°æ®åº”ç”¨å’Œæœºå™¨å­¦ä¹ æ¨¡å‹çš„äº¤äº’å¼å‰ç«¯ç•Œé¢ã€‚å®ƒä»¬ä¸ºæ•°æ®ç§‘å­¦å®¶å’Œæœºå™¨å­¦ä¹ å·¥ç¨‹å¸ˆæä¾›äº†ä¸€ä¸ªç®€å•å¿«é€Ÿçš„æ–¹å¼æ¥æ„å»ºå’Œå…±äº«ä»–ä»¬çš„æ¨¡å‹å’Œæ•°æ®åˆ†æçš„äº¤äº’å¼ç•Œé¢ã€‚ä½¿ç”¨ Streamlit å’Œ Gradio å¼€å‘æ™®é€šç½‘ç«™ï¼Œç†è®ºä¸Šå¯ä»¥ï¼Œä½†æ˜¯ä¸å ä¼˜åŠ¿ã€‚çœ‹æ³•æ™®é€šç½‘ç«™åº”é€‰æ‹©ç±»ä¼¼äºWordPressä¹‹ç±»çš„å»ºç«™å·¥å…·å¯¹å§ã€‚\n","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1809833,"ctime":1698767897,"ip_address":"ç‘å£«","comment_id":383217,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100617601,"comment_content":"è¯·é—®ï¼šStreamlitå’ŒGradioå¯ä»¥ç”¨æ¥å¼€å‘æ™®é€šç½‘ç«™å—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1809833,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/a9/4602808f.jpg","nickname":"é»„ä½³","note":"","ucode":"8EC41D2EAB0E3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":630665,"discussion_content":"Streamlit å’Œ Gradio ä¸»è¦è®¾è®¡ç”¨äºåˆ›å»ºæ•°æ®åº”ç”¨å’Œæœºå™¨å­¦ä¹ æ¨¡å‹çš„äº¤äº’å¼å‰ç«¯ç•Œé¢ã€‚å®ƒä»¬ä¸ºæ•°æ®ç§‘å­¦å®¶å’Œæœºå™¨å­¦ä¹ å·¥ç¨‹å¸ˆæä¾›äº†ä¸€ä¸ªç®€å•å¿«é€Ÿçš„æ–¹å¼æ¥æ„å»ºå’Œå…±äº«ä»–ä»¬çš„æ¨¡å‹å’Œæ•°æ®åˆ†æçš„äº¤äº’å¼ç•Œé¢ã€‚ä½¿ç”¨ Streamlit å’Œ Gradio å¼€å‘æ™®é€šç½‘ç«™ï¼Œç†è®ºä¸Šå¯ä»¥ï¼Œä½†æ˜¯ä¸å ä¼˜åŠ¿ã€‚çœ‹æ³•æ™®é€šç½‘ç«™åº”é€‰æ‹©ç±»ä¼¼äºWordPressä¹‹ç±»çš„å»ºç«™å·¥å…·å¯¹å§ã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1698767897,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ç‘å£«","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383842,"user_name":"æ‚Ÿå°˜","can_delete":false,"product_type":"c1","uid":2189310,"ip_address":"åŒ—äº¬","ucode":"4E7E854340D3A4","user_header":"https://static001.geekbang.org/account/avatar/00/21/67/fe/5d17661a.jpg","comment_is_top":false,"comment_ctime":1699788640,"is_pvip":false,"replies":[{"id":140182,"content":"è¦ä½¿LangChainå¯¹å¤–éƒ¨æä¾›APIæ¥å£ï¼Œéœ€è¦è®¾ç½®ä¸€ä¸ªä¸­é—´å±‚æœåŠ¡æ˜¯å§ï¼Œè¿™ä¸€å—å†…å®¹æˆ‘ä¸æ˜¯å¤ªæ‡‚ã€‚æœ‰ç»éªŒçš„åŒå­¦å¸Œæœ›ç»™åˆ†äº«åˆ†äº«ã€‚\nä¸‹é¢æ˜¯ChatGPTç»™æˆ‘çš„ä¸œè¥¿ï¼Œæˆ‘åŒå­¦éšä¾¿çœ‹çœ‹ï¼š\nå‡è®¾æ‚¨çš„ä¸­é—´å±‚æœåŠ¡æä¾›äº†ä¸€ä¸ª&#47;langchainçš„APIç«¯ç‚¹ï¼ŒJavaåº”ç”¨å¯ä»¥è¿™æ ·è°ƒç”¨ï¼š\nString url = &quot;http:&#47;&#47;your-middle-layer-service.com&#47;langchain&quot;;\n&#47;&#47; æ„å»ºè¯·æ±‚ä½“ï¼ŒåŒ…å«éœ€è¦LangChainå¤„ç†çš„æ•°æ®\nHttpEntity&lt;MyRequestData&gt; request = new HttpEntity&lt;&gt;(new MyRequestData(...));\nRestTemplate restTemplate = new RestTemplate();\n&#47;&#47; å‘é€è¯·æ±‚å¹¶æ¥æ”¶å“åº”\nResponseEntity&lt;MyResponseData&gt; response = restTemplate.postForEntity(url, request, MyResponseData.class);\né€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‚¨å¯ä»¥ä½¿Javaåº”ç”¨é€šè¿‡ä¸­é—´å±‚æœåŠ¡ä¸LangChainè¿›è¡Œäº¤äº’ï¼Œåˆ©ç”¨LangChainæä¾›çš„é«˜çº§è¯­è¨€æ¨¡å‹åŠŸèƒ½ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1809833,"ctime":1700581633,"ip_address":"ç‘å£«","comment_id":383842,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100617601,"comment_content":"è€å¸ˆï¼ŒUIæœ‰äº†ï¼Œé‚£LangChainå¦‚ä½•å¯¹å¤–éƒ¨æä¾›apiæ¥å£å‘¢ï¼Ÿå¦‚javaé¡¹ç›®ï¼ˆspringbootæ¡†æ¶å®ç°çš„ï¼‰ï¼Œjavaè¯­è¨€çš„é¡¹ç›®åˆå¯ä»¥é€šè¿‡ä»€ä¹ˆæ–¹å¼è°ƒç”¨LangChainæä¾›çš„apiæ¥å£ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1809833,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/a9/4602808f.jpg","nickname":"é»„ä½³","note":"","ucode":"8EC41D2EAB0E3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632230,"discussion_content":"è¦ä½¿LangChainå¯¹å¤–éƒ¨æä¾›APIæ¥å£ï¼Œéœ€è¦è®¾ç½®ä¸€ä¸ªä¸­é—´å±‚æœåŠ¡æ˜¯å§ï¼Œè¿™ä¸€å—å†…å®¹æˆ‘ä¸æ˜¯å¤ªæ‡‚ã€‚æœ‰ç»éªŒçš„åŒå­¦å¸Œæœ›ç»™åˆ†äº«åˆ†äº«ã€‚\nä¸‹é¢æ˜¯ChatGPTç»™æˆ‘çš„ä¸œè¥¿ï¼Œæˆ‘åŒå­¦éšä¾¿çœ‹çœ‹ï¼š\nå‡è®¾æ‚¨çš„ä¸­é—´å±‚æœåŠ¡æä¾›äº†ä¸€ä¸ª/langchainçš„APIç«¯ç‚¹ï¼ŒJavaåº”ç”¨å¯ä»¥è¿™æ ·è°ƒç”¨ï¼š\nString url = &#34;http://your-middle-layer-service.com/langchain&#34;;\n// æ„å»ºè¯·æ±‚ä½“ï¼ŒåŒ…å«éœ€è¦LangChainå¤„ç†çš„æ•°æ®\nHttpEntity&lt;MyRequestData&gt; request = new HttpEntity&lt;&gt;(new MyRequestData(...));\nRestTemplate restTemplate = new RestTemplate();\n// å‘é€è¯·æ±‚å¹¶æ¥æ”¶å“åº”\nResponseEntity&lt;MyResponseData&gt; response = restTemplate.postForEntity(url, request, MyResponseData.class);\né€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‚¨å¯ä»¥ä½¿Javaåº”ç”¨é€šè¿‡ä¸­é—´å±‚æœåŠ¡ä¸LangChainè¿›è¡Œäº¤äº’ï¼Œåˆ©ç”¨LangChainæä¾›çš„é«˜çº§è¯­è¨€æ¨¡å‹åŠŸèƒ½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1700581633,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ç‘å£«","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1129543,"avatar":"https://static001.geekbang.org/account/avatar/00/11/3c/47/3809bf42.jpg","nickname":"DrolğŸµ","note":"","ucode":"9BAD3E5F9580DB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":637500,"discussion_content":"langChainå®˜æ–¹æä¾›äº†ä¸€ä¸ªRestful APIæ¡†æ¶langServerï¼Œå®ƒæä¾›äº†å¿«é€Ÿæ­å»ºRestful APIé¡¹ç›®çš„è„šæ‰‹æ¶ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„å°†langChainå†™çš„æ–¹æ³•æš´éœ²æˆRestful APIï¼ŒåŒæ—¶è‡ªåŠ¨ç”ŸæˆAPIçš„Swaggeræ–‡æ¡£ã€‚è¿˜ä¼šæä¾›ä¸€ä¸ªç®€å•çš„playgroundé¡µé¢å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨è¿›è¡Œé—®ç­”ã€‚langServerçš„æœåŠ¡ç«¯éƒ¨åˆ†åªæ˜¯é›†æˆäº†FastAPIå’ŒPydanticæ‰€ä»¥ä¸ä¼šå¢åŠ å­¦ä¹ è´Ÿæ‹…ã€‚FastAPIæ˜¯æµè¡Œçš„Python WEBæ¡†æ¶ä¹‹ä¸€ï¼›Pydanticæ˜¯Pythonçš„ç±»å‹æ ‡æ³¨å’Œæ ¡éªŒæ¡†æ¶ï¼Œç›¸å½“äºTypeScriptä¹‹äºJavaScriptã€‚\n\nlangServerå®˜æ–¹æ–‡æ¡£ï¼šhttps://python.langchain.com/docs/langserve","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1708570859,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383625,"user_name":"Monin","can_delete":false,"product_type":"c1","uid":3144503,"ip_address":"ä¸Šæµ·","ucode":"AA6C4C4F19FA14","user_header":"https://static001.geekbang.org/account/avatar/00/2f/fb/37/791d0f5e.jpg","comment_is_top":false,"comment_ctime":1699362462,"is_pvip":false,"replies":[{"id":140084,"content":"https:&#47;&#47;help.openai.com&#47;en&#47;articles&#47;8550641-assistants-api\nhttps:&#47;&#47;platform.openai.com&#47;docs&#47;assistants&#47;overview\næˆ‘å¿«é€Ÿçœ‹äº†ä¸€ä¸‹ï¼ŒåŠŸèƒ½å¾ˆç›¸ä¼¼ã€‚OpenAIçš„APIä¹Ÿè¶Šæ¥è¶Šå¼ºå¤§äº†ã€‚\nå¯ä»¥è¯´ï¼Œ1. å¼€å‘è€…å¤šäº†ä¸€ä¸ªé€‰æ‹© 2. LangChainç”Ÿæ€ä½ä»åœ¨ï¼Œå› ä¸ºæ¯•ç«Ÿè¿˜æœ‰å…¶å®ƒå¤§æ¨¡å‹å’Œæ¥å£ä»¥åŠå„ç§å„æ ·çš„å·¥å…·ã€‚\nä¸€ä¸ªåŠŸèƒ½çš„å®ç°ï¼Œæ€»æœ‰å¤šç§é€‰æ‹©ï¼Œå°±åƒPyTorchå’ŒTensorFlowã€‚æœ€ç»ˆçš„ä¼˜åŠ£å¦‚ä½•ï¼Œæˆ‘ä»¬æ‹­ç›®ä»¥å¾…ã€‚\næˆ‘ä½œä¸ºç¨‹åºå‘˜ï¼Œå¦‚æœæˆ‘åªä½¿ç”¨GPT, OpenAI APIèƒ½ç›´æ¥åšï¼Œæˆ‘å°±ä¸å¥—å£³ã€‚å¦‚æœåšç€åšç€è§‰å¾—éº»çƒ¦ï¼Œè¿˜æ˜¯LangChainæ–¹ä¾¿ï¼Œæˆ‘å†æ¢ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1809833,"ctime":1699977955,"ip_address":"ç‘å£«","comment_id":383625,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100617601,"comment_content":"è€å¸ˆ  å’¨è¯¢ä¸‹  openAiæœ€è¿‘å‘å¸ƒçš„Assistant API   æ˜¯ä¸æ˜¯æ„å‘³ç€langchainçš„ä»·å€¼è¢«æ›¿ä»£äº†  Assistant APIçš„agentï¼Œretrievaléƒ½ä¸é”™\n","like_count":0,"discussions":[{"author":{"id":1809833,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/a9/4602808f.jpg","nickname":"é»„ä½³","note":"","ucode":"8EC41D2EAB0E3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631800,"discussion_content":"https://help.openai.com/en/articles/8550641-assistants-api\nhttps://platform.openai.com/docs/assistants/overview\næˆ‘å¿«é€Ÿçœ‹äº†ä¸€ä¸‹ï¼ŒåŠŸèƒ½å¾ˆç›¸ä¼¼ã€‚OpenAIçš„APIä¹Ÿè¶Šæ¥è¶Šå¼ºå¤§äº†ã€‚\nå¯ä»¥è¯´ï¼Œ1. å¼€å‘è€…å¤šäº†ä¸€ä¸ªé€‰æ‹© 2. LangChainç”Ÿæ€ä½ä»åœ¨ï¼Œå› ä¸ºæ¯•ç«Ÿè¿˜æœ‰å…¶å®ƒå¤§æ¨¡å‹å’Œæ¥å£ä»¥åŠå„ç§å„æ ·çš„å·¥å…·ã€‚\nä¸€ä¸ªåŠŸèƒ½çš„å®ç°ï¼Œæ€»æœ‰å¤šç§é€‰æ‹©ï¼Œå°±åƒPyTorchå’ŒTensorFlowã€‚æœ€ç»ˆçš„ä¼˜åŠ£å¦‚ä½•ï¼Œæˆ‘ä»¬æ‹­ç›®ä»¥å¾…ã€‚\næˆ‘ä½œä¸ºç¨‹åºå‘˜ï¼Œå¦‚æœæˆ‘åªä½¿ç”¨GPT, OpenAI APIèƒ½ç›´æ¥åšï¼Œæˆ‘å°±ä¸å¥—å£³ã€‚å¦‚æœåšç€åšç€è§‰å¾—éº»çƒ¦ï¼Œè¿˜æ˜¯LangChainæ–¹ä¾¿ï¼Œæˆ‘å†æ¢ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1699977955,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ç‘å£«","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3737073,"avatar":"https://static001.geekbang.org/account/avatar/00/39/05/f1/a00779a1.jpg","nickname":"xxyc","note":"","ucode":"66C9411D73AFE9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631503,"discussion_content":"è¿™ä¸ªé—®é¢˜æˆ‘ä¹Ÿæƒ³åˆ°äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1699625410,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ—¥æœ¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":392798,"user_name":"2xshu","can_delete":false,"product_type":"c1","uid":1188473,"ip_address":"åŒ—äº¬","ucode":"71584CB9676EDF","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKsz8j0bAayjSne9iakvjzUmvUdxWEbsM9iasQ74spGFayIgbSE232sH2LOWmaKtx1WqAFDiaYgVPwIQ/132","comment_is_top":false,"comment_ctime":1721806067,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100617601,"comment_content":"# å‘é‡æ•°æ®åº“ \nself.vectorstore = Qdrant.from_documents(\n documents=all_splits, # ä»¥åˆ†å—çš„æ–‡æ¡£ \n embedding=OpenAIEmbeddings(), # ç”¨OpenAIçš„Embedding ModelåšåµŒå…¥\n location=&quot;:memory:&quot;, # in-memory å­˜å‚¨ \ncollection_name=&quot;my_documents&quot;,) # æŒ‡å®šcollection_name\n\nè¿™ä¸ªåœ°æ–¹æ˜¯ç”¨OpenAIEmbeddingsæ¥åšçš„å‘é‡åµŒå…¥ï¼Œè¿™æ ·ä¼šæ¶ˆè€—openaiçš„è°ƒç”¨æ¬¡æ•°å§ï¼Ÿæœ‰å¹³æ›¿çš„æ–¹æ³•å—ï¼Ÿ\n","like_count":0}]}