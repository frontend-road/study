{"id":393688,"title":"20 | React çš„æœªæ¥ï¼šä»€ä¹ˆæ˜¯æœåŠ¡å™¨ç«¯ç»„ä»¶ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç‹æ²›ã€‚ä»Šå¤©æˆ‘ä»¬æ¥èŠèŠReactè¿˜æœ‰å“ªäº›å€¼å¾—æœŸå¾…çš„æ–°ç‰¹æ€§ã€‚</p><p>React è‡ªè¯ç”Ÿåˆ°ç°åœ¨ï¼Œå·²ç»æœ‰ä¸ƒå…«å¹´çš„æ—¶é—´äº†ï¼Œä¸çŸ¥é“ä½ æ˜¯ä¸æ˜¯å’Œæˆ‘æœ‰ä¸€æ ·çš„ç–‘æƒ‘ã€‚React å¥½åƒè¿™ä¹ˆå¤šå¹´æ¥å°±å‘å¸ƒäº†ä¸€ä¸ª React Hooksï¼Œé™¤æ­¤ä¹‹å¤–å°±æ²¡æœ‰ä»€ä¹ˆå…¶ä»–æ–°åŠŸèƒ½äº†ã€‚é‚£ä¹ˆï¼ŒReact å›¢é˜Ÿåˆ°åº•åœ¨åšå“ªäº›äº‹æƒ…å‘¢ï¼Ÿå…¶å®æˆ‘ä»¬åªè¦ä»”ç»†æƒ³ä¸€æƒ³ï¼Œè¿™ä¸ªç–‘æƒ‘ä¹ŸæŒºå®¹æ˜“è§£å¼€ã€‚</p><p>ä¸€æ–¹é¢ï¼ŒReact çš„ API è¶³å¤Ÿç¨³å®šï¼Œè¿™å°±è®©æˆ‘ä»¬å¼€å‘äººå‘˜ä¸å¤ªèƒ½æ„ŸçŸ¥åˆ°ä¸€äº›å†…éƒ¨çš„ä¼˜åŒ–ã€‚æ¯”å¦‚åœ¨2017å¹´ï¼ŒReact å°±åŸºäº Fiber çš„æ¶æ„é‡å†™äº†æ•´ä¸ª Reactï¼Œä¼˜åŒ–äº†æ¸²æŸ“çš„æœºåˆ¶ï¼Œä¸ºä¹‹åçš„ Suspense ç­‰ç‰¹æ€§æä¾›äº†åŸºç¡€ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼ŒReact å›¢é˜Ÿå…¶å®ä¸€ç›´åœ¨æ¢ç´¢ä¸€äº›æ–°çš„å‰ç«¯å¼€å‘æ–¹å¼ï¼Œåªæ˜¯ä¸åˆ°è¶³å¤Ÿæˆç†Ÿå°±ä¸ä¼šæ­£å¼å‘å¸ƒã€‚æ¯”å¦‚ Suspenseï¼Œä½œä¸ºä¸€ä¸ªè¯•éªŒç‰¹æ€§ï¼Œå®ƒå·²ç»æ¨å‡ºæœ‰ä¸‰å¹´å¤šäº†ï¼Œä½†å®˜æ–¹ä¸€ç›´æ²¡æœ‰å®£å¸ƒæ­£å¼å¯ç”¨ã€‚è€Œæœ€è¿‘æå‡ºçš„ä¸€ä¸ªæ–°çš„æœåŠ¡å™¨ç«¯ç»„ä»¶çš„æ¦‚å¿µï¼Œè™½ç„¶è®©äººçœ¼å‰ä¸€äº®ï¼Œä½†åŒæ ·ä¹Ÿè¿˜å¤„äºæ¢ç´¢å’Œå¼€å‘é˜¶æ®µã€‚</p><p>ä¸è¿‡ï¼Œäº†è§£React 17.0ç‰ˆæœ¬ï¼Œè¿˜æ˜¯ååˆ†æœ‰å¿…è¦çš„ï¼Œèƒ½è®©æˆ‘ä»¬å¯¹ React çš„æœªæ¥ä¼šæœ‰å“ªäº›æ–°ç‰¹æ€§ï¼Œåšåˆ°å¿ƒä¸­æœ‰æ•°ã€‚</p><p>æ‰€ä»¥ä»Šå¤©è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°±æ¥çœ‹ä¸‹ React 17.0 è¿™ä¸ªæ²¡æœ‰æ–°ç‰¹æ€§çš„ç‰ˆæœ¬å¸¦æ¥äº†ä»€ä¹ˆæ–°å˜åŒ–ã€‚ç„¶åå†é€šè¿‡ä¾‹å­ï¼Œå»å­¦ä¹  Suspense å’ŒæœåŠ¡å™¨ç«¯ç»„ä»¶ï¼Œçœ‹çœ‹å®ƒä»¬ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Œè¯•å›¾å»è§£å†³å“ªäº›é—®é¢˜ã€‚</p><!-- [[[read_end]]] --><h2>React 17.0ï¼šæ²¡æœ‰æ–°ç‰¹æ€§çš„æ–°ç‰ˆæœ¬</h2><p>React 17.0 æ˜¯ä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„ç‰ˆæœ¬ï¼Œè™½ç„¶å¤§ç‰ˆæœ¬ä»16å‡åˆ°äº†17ï¼Œä½†æ˜¯ä»å¼€å‘çš„è§’åº¦æ¥çœ‹ï¼Œå´æ²¡æœ‰æ–°ç‰¹æ€§ã€‚ç”¨ Facebook å®˜æ–¹çš„è¯æ¥è¯´ï¼Œå¤§ç‰ˆæœ¬å‡çº§ä¸»è¦æ˜¯ä¸ºä»¥åçš„æ–°åŠŸèƒ½ä½œé“ºå«ï¼Œæ ¸å¿ƒçš„æ”¹å˜å°±åœ¨äºæä¾›äº† React é€æ­¥å‡çº§çš„å¯èƒ½æ€§ï¼ŒåŒæ—¶ï¼Œè¿˜æä¾›äº†æ–°çš„ JSX ç¼–è¯‘çš„æœºåˆ¶ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥çœ‹çœ‹è¿™äº›æ–°çš„å˜åŒ–ã€‚</p><h3>æ¸è¿›å‡çº§</h3><p>æ¡†æ¶çš„å‡çº§ä¸€ç›´æ˜¯è½¯ä»¶å¼€å‘çš„ä¸€å¤§ç—›ç‚¹ã€‚ä»ä¸šåŠ¡è§’åº¦æ¥çœ‹ï¼ŒæŠ€æœ¯ä¸Šçš„å‡çº§ä¸ä»…ä¼šè€—è´¹å·¨å¤§çš„å·¥ä½œé‡ï¼Œè€Œä¸”å¯¹ä¸šåŠ¡åŠŸèƒ½ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¸®åŠ©ï¼Œç”šè‡³è¿˜ä¼šå¸¦æ¥ Bugã€‚è€Œä»æŠ€æœ¯è§’åº¦æ¥çœ‹ï¼Œè¶Šæ™šå‡çº§ï¼Œæ¬ ä¸‹çš„æŠ€æœ¯å€ºåŠ¡åˆ™è¶Šå¤šã€‚æ‰€ä»¥ React 17 è¿™æ¬¡å¸¦æ¥çš„æ¸è¿›å‡çº§ï¼Œå°±æä¾›äº†ä¸€ç§æ–°çš„æ–¹æ¡ˆã€‚</p><p>æ‰€è°“æ¸è¿›å‡çº§çš„æ”¯æŒï¼Œå°±æ˜¯ä¸€ä¸ªåº”ç”¨å¯ä»¥åŒæ—¶æœ‰å¤šä¸ª React çš„ç‰ˆæœ¬ã€‚è¿™æ ·çš„è¯ï¼Œå‡çº§ React çš„è¿‡ç¨‹å¯ä»¥æ›´ä¸ºå¹³æ»‘ï¼Œä¸ç”¨ä¸€æ¬¡æ€§å‡çº§æ•´ä¸ªåº”ç”¨ï¼Œè€Œæ˜¯æŸäº›æ–°åŠŸèƒ½å¯ä»¥ç”¨æ–°ç‰ˆæœ¬çš„ Reactï¼Œè€Œæ—§çš„åŠŸèƒ½å‘¢ï¼Œåˆ™å¯ä»¥ç»§ç»­ä½¿ç”¨è€ç‰ˆæœ¬ã€‚</p><h3>æ–°çš„äº‹ä»¶æ¨¡å‹</h3><p>åœ¨ç¬¬11è®²ï¼Œæˆ‘ä»¬æ›¾ç»çœ‹åˆ°ï¼ŒReact ä¸­æ‰€æœ‰çš„äº‹ä»¶éƒ½æ˜¯åˆæˆäº‹ä»¶ï¼Œå®ç°çš„æœºåˆ¶æ˜¯åœ¨æ ¹èŠ‚ç‚¹ä¸Šç›‘å¬æ‰€æœ‰äº‹ä»¶ï¼Œç„¶å React ç»Ÿä¸€å¤„ç†åï¼Œå†å°†äº‹ä»¶å‘é€åˆ°è™šæ‹Ÿ DOM èŠ‚ç‚¹ã€‚</p><p>åœ¨ React 17ä¸­ï¼Œä¸ºäº†æ”¯æŒå¤šç‰ˆæœ¬ React çš„å…±å­˜ï¼ŒReact çš„äº‹ä»¶æ¨¡å‹åšäº†ä¸€ä¸ªä¿®æ”¹ã€‚è®©æˆ‘ä»¬ä¸éœ€è¦å†é€šè¿‡ Document å»ç›‘å¬äº‹ä»¶ï¼Œè€Œæ˜¯åœ¨ React ç»„ä»¶æ ‘çš„æ ¹èŠ‚ç‚¹ä¸Šå»ç›‘å¬ã€‚è¿™æ ·çš„è¯ï¼Œå¤šä¸ªç‰ˆæœ¬çš„ React å°±ä¸ä¼šæœ‰äº‹ä»¶çš„å†²çªäº†ã€‚</p><p>ä¸‹é¢è¿™å¼ æ¥è‡ªå®˜ç½‘çš„å›¾ï¼Œå°±æè¿°äº†è¿™ä¸ªå˜åŒ–ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/24/4a/2489110bff22e21c45b8f7ab9b07084a.png?wh=1680x1299\" alt=\"\"></p><p>ä»æŠ€æœ¯ä¸Šæ¥è¯´ï¼Œè¿‡å»æ˜¯ document.addEventListener() æ¥ç›‘å¬äº‹ä»¶ï¼Œè€Œç°åœ¨åˆ™æ˜¯ rootNode.addEventListener()ã€‚è¿™ä¸€æ”¹å˜ï¼Œä¸ä»…è§£å†³äº†å¤šç‰ˆæœ¬ React çš„é—®é¢˜ï¼Œè€Œä¸”è¿˜è®© React åœ¨å’Œå…¶å®ƒä¸€äº›æŠ€æœ¯æ ˆï¼ˆæ¯”å¦‚ JQueryï¼‰ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œé™ä½äº‹ä»¶å†²çªçš„å¯èƒ½æ€§ã€‚</p><h3>æ–°çš„ JSX ç¼–è¯‘æœºåˆ¶</h3><p>åœ¨è¿‡å»ï¼Œå¦‚æœæˆ‘ä»¬è¦åœ¨ React ç»„ä»¶ä¸­ä½¿ç”¨ JSXï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨ import è¯­å¥å¼•å…¥ Reactã€‚è¿™ä¹ˆåšçš„åŸå› å°±åœ¨äºï¼Œåœ¨ç¼–è¯‘æ—¶ JSX ä¼šè¢«ç¿»è¯‘æˆ React.createElement è¿™æ ·çš„ APIï¼Œæ‰€ä»¥å°±éœ€è¦å¼•å…¥ Reactã€‚</p><p>æ¯”å¦‚ä¸‹é¢çš„æºä»£ç ï¼š</p><pre><code>import React from 'react';\nfunction App() {\n  return &lt;h1&gt;Hello World&lt;/h1&gt;;\n}\n</code></pre><p>åœ¨è¿‡å»ï¼Œä¼šè¢«ç¿»è¯‘æˆå¦‚ä¸‹æ‰€ç¤ºçš„ç»“æœï¼š</p><pre><code>import React from 'react';\nfunction App() {\n  return React.createElement('h1', null, 'Hello world');\n}\n</code></pre><p>è€Œç°åœ¨ï¼ŒJSX é‡‡ç”¨äº†æ–°çš„ç¼–è¯‘æœºåˆ¶ï¼Œå› æ­¤æˆ‘ä»¬çš„ä»£ç ä¸éœ€è¦å†å¼•å…¥ Reactäº†ã€‚æ¯”å¦‚ï¼š</p><pre><code>function App() {\n  return &lt;h1&gt;Hello World&lt;/h1&gt;;\n}\n</code></pre><p>ç¼–è¯‘åçš„ç»“æœåˆ™æ˜¯ï¼š</p><pre><code>// ç”±ç¼–è¯‘å™¨è‡ªåŠ¨å¼•å…¥\nimport {jsx as _jsx} from 'react/jsx-runtime';\nfunction App() {\n  return _jsx('h1', { children: 'Hello world' });\n}\n</code></pre><p>è™½ç„¶ç¼–è¯‘åçš„ç»“æœéå¸¸ç±»ä¼¼ï¼Œä½†æ˜¯ _jsx è¿™ä¸ªå‡½æ•°çš„å¼•å…¥æ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨å®Œæˆçš„ã€‚æ‰€ä»¥ä»å¼€å‘è§’åº¦çœ‹ï¼Œå¸¦æ¥çš„æœ€æ˜æ˜¾çš„å¥½å¤„å°±æ˜¯<strong>ä»£ç æ›´ç›´è§‚äº†ã€‚</strong>åœ¨è¿™é‡Œï¼ŒJSX è¢«çœ‹ä½œä¸€ç§çœŸæ­£çš„è¯­æ³•ï¼Œå› è€Œåœ¨ç»„ä»¶ä¸­å°±ä¸éœ€è¦å†å¼•å…¥ Reactäº†ã€‚</p><h2>Suspense: æ‚¬åœæ¸²æŸ“</h2><p>Suspenseï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯<strong>æŒ‚èµ·å½“å‰ç»„ä»¶çš„æ¸²æŸ“ï¼Œç›´åˆ°å¼‚æ­¥æ“ä½œå®Œæˆ</strong>ã€‚è™½ç„¶è¿™æ˜¯ä¸€ä¸ªâ€œæ—§ç‰¹æ€§â€ï¼Œæ¯•ç«Ÿæ—©åœ¨ 2018å¹´10æœˆå‘å¸ƒçš„ React 16.6 ç‰ˆæœ¬ä¸­å°±å·²ç»å¼•å…¥äº†ï¼Œä½†æ˜¯å› ä¸ºä¸€ç›´å¤„äºè¯•éªŒçŠ¶æ€ï¼Œ<strong>æ²¡æœ‰æ­£å¼å®£å¸ƒå¯ç”¨</strong>ï¼Œæ‰€ä»¥å¾ˆå¤šåŒå­¦å…¶å®ä¸€ç›´éƒ½ä¸å¤ªç†è§£å®ƒç©¶ç«Ÿæ˜¯åšä»€ä¹ˆçš„ã€‚é‚£æ¥ä¸‹æ¥æˆ‘å°±åšä¸€ä¸ªç®€å•çš„ä»‹ç»ã€‚</p><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œ<strong>React ç»„ä»¶éƒ½æ˜¯çŠ¶æ€é©±åŠ¨çš„</strong>ï¼Œå½“çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ•´ä¸ªç»„ä»¶æ ‘å°±ä¼šè¿›è¡Œä¸€æ¬¡æ•´ä½“çš„åˆ·æ–°ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯å®Œå…¨åŒæ­¥çš„ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒReact ä¼šå°†æ‰€æœ‰çš„ DOM å˜åŒ–ä¸€æ¬¡æ€§æ¸²æŸ“åˆ°æµè§ˆå™¨ä¸­ã€‚è¿™<strong>åœ¨åº”ç”¨éå¸¸å¤æ‚çš„åœºæ™¯ä¸‹ï¼Œä¼šæˆä¸ºä¸€ä¸ªæ½œåœ¨çš„æ€§èƒ½ç“¶é¢ˆ</strong>ã€‚æ‰€ä»¥React å°±æå‡ºäº† Suspense è¿™æ ·ä¸€ä¸ªæ¦‚å¿µï¼Œå®ƒå…è®¸ç»„ä»¶æš‚æ—¶æŒ‚èµ·åˆ·æ–°æ“ä½œï¼Œè®©æ•´ä¸ªæ¸²æŸ“è¿‡ç¨‹å¯ä»¥è¢«åˆ‡åˆ†æˆä¸€ä¸ªä¸ªç‹¬ç«‹çš„éƒ¨åˆ†ï¼Œä»è€Œä¸ºä¼˜åŒ–æ€§èƒ½æä¾›äº†ç©ºé—´ã€‚</p><p>å…¶å®è¿™æ˜¯ React Fiber å¸¦æ¥çš„ä¸€ä¸ªéå¸¸åº•å±‚çš„æŠ€æœ¯åŸºç¡€ï¼Œä¸è¿‡çš„ç¡®èƒ½å¸¦æ¥å¾ˆå¤šç”¨å¤„ï¼Œä¸ä»…ä»…æ˜¯åœ¨æ€§èƒ½æ–¹é¢ã€‚</p><p>å°±åƒç°åœ¨æˆ‘ä»¬çœ‹åˆ°çš„æ–‡æ¡£ï¼Œå…¶å®å¤§å¤šæ˜¯ç”¨æ¥è§£å†³å¼‚æ­¥è¯·æ±‚è·å–æ•°æ®çš„é—®é¢˜ã€‚è¦çŸ¥é“ï¼Œåœ¨è¿‡å»ï¼Œå¼‚æ­¥è¯·æ±‚éƒ½æ˜¯åœ¨å‰¯ä½œç”¨ä¸­å®Œæˆï¼Œç„¶åå‰¯ä½œç”¨å»ä¿®æ”¹çŠ¶æ€ï¼Œå†ç”±çŠ¶æ€é©±åŠ¨ç»„ä»¶çš„åˆ·æ–°ã€‚</p><p>è€Œç°åœ¨æœ‰äº† Suspenseï¼Œå¼‚æ­¥çš„è¯·æ±‚å°±ä¸å†éœ€è¦ç”±ç»„ä»¶å»è§¦å‘ã€‚ç»„ä»¶ä¸ä»…å¯ä»¥ä½œä¸ºçŠ¶æ€çš„å±•ç°å±‚ï¼ŒåŒæ—¶ä¹Ÿèƒ½å˜æˆå¼‚æ­¥è¯·æ±‚çš„å±•ç°å±‚ã€‚</p><p>ä¸‹é¢è¿™å¼ å›¾æ˜¾ç¤ºäº†è¿™æ ·ä¸€ä¸ªè½¬æ¢çš„è¿‡ç¨‹ï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/11/40/11f088yy105ffd52c7306bc310c9f440.png?wh=1326x438\" alt=\"\"><br>\næ‰€ä»¥ï¼Œä»è§£å†³ä»€ä¹ˆé—®é¢˜çš„è§’åº¦å‡ºå‘ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒReact å¸Œæœ›æŠŠå¼‚æ­¥å¤„ç†é€»è¾‘ç‹¬ç«‹å‡ºæ¥ï¼Œè®©å®ƒæˆä¸ºä¸€ä¸ªå•ç‹¬çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ—¢ä¸ä¾èµ–äºç»„ä»¶ï¼Œä¹Ÿä¸ä¾èµ–äº Stateã€‚éšåï¼Œç»„ä»¶åœ¨æ¸²æŸ“çš„æ—¶å€™ï¼Œé€šè¿‡åˆ¤æ–­å¼‚æ­¥è¿‡ç¨‹çš„ä¸åŒé˜¶æ®µï¼Œä»è€Œè¿›è¡Œä¸åŒçš„æ¸²æŸ“ã€‚</p><p>éœ€è¦ç‰¹åˆ«è¯´æ˜çš„æ˜¯ï¼Œè¿™ä¸ªå¼‚æ­¥é€»è¾‘ï¼Œä¸ä»…ä»…å±€é™äºå¼‚æ­¥è¯·æ±‚ï¼Œè¿˜æœ‰å¯èƒ½æ˜¯<strong>æŒ‰éœ€åŠ è½½çš„æ¨¡å—</strong>ç­‰ç­‰ã€‚</p><p>é‚£ Suspense åˆ°åº•è¯¥æ€ä¹ˆä½¿ç”¨å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬ä»¥å¼‚æ­¥æ•°æ®è¯·æ±‚ä¸ºä¾‹æ¥è®²è§£ä¸€ä¸‹ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦<strong>æŒ‰ç…§ Suspense çš„è§„èŒƒæä¾›ä¸€ä¸ªå¼‚æ­¥è¯·æ±‚çš„å®ç°</strong>ã€‚æ¯”å¦‚ï¼š</p><pre><code>function fetchData() {\n  let status = &quot;pending&quot;;\n  let result;\n  // å‘èµ·è¯·æ±‚è·å–æ•°æ®ï¼Œè¿”å› suspender è¿™ä¸ª promise\n  let suspender = apiClicent.fetch('/topic/1').then(\n    (r) =&gt; {\n      status = &quot;success&quot;;\n      result = r;\n    },\n    (e) =&gt; {\n      status = &quot;error&quot;;\n      result = e;\n    }\n  );\n  // æ— è®ºä½•æ—¶è°ƒç”¨ fetchTopicï¼Œéƒ½ç›´æ¥è¿”å›ä¸€ä¸ªç»“æœ\n  return {\n    readTopic() {\n      if (status === &quot;pending&quot;) {\n        // å¦‚æœè¿˜åœ¨è¯·æ±‚ä¸­ç›´æ¥æŠ›å‡ºä¸€ä¸ª promise\n        throw suspender;\n      } else if (status === &quot;error&quot;) {\n        // å¦‚æœè¯·æ±‚å‡ºé”™ï¼ŒæŠ›å‡º error\n        throw result;\n      } else if (status === &quot;success&quot;) {\n        // å¦‚æœè¯·æ±‚æˆåŠŸï¼Œè¿”å›æ•°æ®\n        return result;\n      }\n    }\n  }\n  \n}\n</code></pre><p>å°±è¿™æ ·ï¼Œæˆ‘ä»¬å®ç°äº†fetchData è¿™æ ·ä¸€ä¸ªå¯ä¾› Suspense ä½¿ç”¨çš„ APIã€‚æ¥ç€ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¯¥å¦‚ä½•åœ¨Suspenseä¸­ä½¿ç”¨è¿™ä¸ªAPIã€‚</p><pre><code>import React, { Suspense } from &quot;react&quot;;\nimport fetchTopic from './fetchTopic';\n\n\nconst data = fetchData();\n\n\nfunction TopicDetail() {\n  // è°ƒç”¨äº† data.readTopic() æ¥è·å–æ•°æ®\n  const topic = data.readTopic();\n  // ç›´æ¥åŒæ­¥çš„è¿”å›äº† JSX\n  return (\n    &lt;div&gt;\n      &lt;h1&gt;{topic.title}&lt;/h1&gt;\n      &lt;p&gt;{topic.content}&lt;/p&gt;\n    &lt;/div&gt;\n  )\n}\n\n\nfunction TopicPage() {\n  return (\n    &lt;Suspense\n      fallback={&lt;h1&gt;Loading...&lt;/h1&gt;}\n    &gt;\n      &lt;TopicDetail /&gt;\n    &lt;/Suspense&gt;\n  );\n</code></pre><p>æˆ‘ä»¬å…ˆæ¥çœ‹ TopicDetail è¿™ä¸ªç»„ä»¶çš„å®ç°ã€‚è¿™é‡Œæœ‰ä¸€ç‚¹éå¸¸å…³é”®ï¼Œé‚£å°±æ˜¯æˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨åŒæ­¥çš„å†™æ³•å»è·å–å¼‚æ­¥è¯·æ±‚çš„æ•°æ®ã€‚</p><p>å¯¹äºè¿™ç§ç»„ä»¶ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œéœ€è¦æ”¾åœ¨æŸä¸ª Suspense æ ‡è®°ä¸‹é¢ã€‚é€šè¿‡ç»™ Suspense æä¾›ä¸€ä¸ª fallback çš„å±æ€§ï¼Œç”¨äºæ¸²æŸ“åŠ è½½çŠ¶æ€çš„ç•Œé¢ã€‚</p><p>ç»“åˆ fetchData è¿™ä¸ª API çš„å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¯·æ±‚åœ¨ç»„ä»¶æ¸²æŸ“ä¹‹å‰å°±å·²ç»å‘ç”Ÿäº†ï¼Œè€Œä¸å†æ˜¯ç”±ç»„ä»¶çš„æ¸²æŸ“è§¦å‘çš„ã€‚è¿™æ­£æ˜¯ Suspense æƒ³è¦å¸¦æ¥çš„æ•ˆæœï¼Œéš”ç¦»äº†å‰¯ä½œç”¨å’Œ UI æ¸²æŸ“çš„è¿‡ç¨‹ï¼Œè®©ä½ èƒ½å¤Ÿç”¨åŒæ­¥çš„å†™æ³•å»å®ç°å¼‚æ­¥é€»è¾‘ã€‚</p><p>æ€»ä½“æ¥è¯´ï¼ŒSuspense æä¾›äº†ä¸€ç§å®ç°å¼‚æ­¥é€»è¾‘ç®¡ç†çš„æ–°çš„æœºåˆ¶ï¼Œå¯ä»¥æ›¿ä»£å¾ˆå¤šæ¡†æ¶æä¾›çš„ä¸åŒçš„å‰¯ä½œç”¨å¤„ç†é€»è¾‘ï¼Œæ¯”å¦‚ Reduxã€Saga ç­‰ã€‚</p><p>é—æ†¾çš„æ˜¯ï¼ŒSuspenseç›®å‰å¹¶æ²¡æœ‰å¾—ä»¥æ™®åŠã€‚ä¸€æ–¹é¢ï¼Œæ˜¯å› ä¸ºå®ƒè¿˜å¤„äºè¯•éªŒæ¢ç´¢é˜¶æ®µï¼Œå¹¶æ²¡æœ‰æ­£å¼å‘å¸ƒã€‚å¦ä¸€æ–¹é¢ï¼Œå®ƒä¹Ÿéœ€è¦ä¸€äº›ç¬¬ä¸‰æ–¹æ¡†æ¶çš„æ”¯æŒï¼Œä»è€Œæä¾›èƒ½å…¼å®¹ Suspense çš„å¼‚æ­¥ APIï¼Œæ–¹ä¾¿ Suspense çš„ä½¿ç”¨ã€‚</p><p>ç›®å‰æ¥è¯´ï¼Œåªæœ‰ React çš„ GraphQL çš„ Relay å®¢æˆ·ç«¯å®ç°äº†å®Œæ•´çš„ Suspense æ”¯æŒã€‚æ‰€ä»¥ï¼Œé™¤éä½ æŠŠ Relay ä½œä¸ºå®¢æˆ·ç«¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬æš‚æ—¶åªè¦å¯¹Suspense ä½œä¸ªäº†è§£å³å¯ï¼Œè€Œä¸è¦å°†å…¶ç”¨åœ¨æ­£å¼é¡¹ç›®ä¸­ã€‚ç­‰æœªæ¥ç¨³å®šåï¼Œå¯ä»¥å†æŠŠå®ƒç”¨åœ¨æ­£å¼é¡¹ç›®ä¸­ã€‚</p><h2>Server Componentsï¼šæœåŠ¡å™¨ç«¯ React ç»„ä»¶</h2><p>è‡ªä» Hooks ä¹‹åï¼ŒReact åœ¨2020å¹´12æœˆæå‡ºçš„ Server Components è¿™ä¸ªææ¡ˆï¼Œå¤§æ¦‚Reactæ˜¯æœ€ä¸ºæœ‰è¶£çš„ä¸€ä¸ªæ–°ç‰¹æ€§äº†ã€‚è™½ç„¶ç›®å‰æ¥è¯´ï¼ŒServer Componentsè¿˜å¤„äºæ¢ç´¢å’Œå¼€å‘å®ç°çš„é˜¶æ®µï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡å®˜æ–¹çš„<a href=\"https://www.youtube.com/watch?v=TQQPAU21ZUw\">ä»‹ç»è§†é¢‘</a>å’Œä¸€ä¸ª<a href=\"https://github.com/reactjs/server-components-demo\">ç¤ºä¾‹é¡¹ç›®</a>å»äº†è§£å®ƒçš„åŠŸèƒ½å’Œä½¿ç”¨æ–¹å¼ï¼Œä»è€Œæœ‰ä¸€ä¸ªç›´è§‚äº†è§£ã€‚</p><p>Server Components æœ€æ˜æ˜¾çš„åŠŸèƒ½ï¼Œå°±æ˜¯èƒ½å¤Ÿåœ¨ç»„ä»¶çº§åˆ«å®ç°æœåŠ¡å™¨ç«¯çš„æ¸²æŸ“ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªå‰ç«¯é¡µé¢ä¸­ï¼Œæœ‰äº›ç»„ä»¶æ˜¯å®¢æˆ·ç«¯æ¸²æŸ“çš„ï¼Œè€Œæœ‰çš„ç»„ä»¶åˆ™å¯ä»¥æ˜¯æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„ã€‚ä¸ºäº†å¸®åŠ©ä½ åŠ æ·±ç†è§£ï¼Œæˆ‘ä»¬ç›´æ¥æ¥çœ‹ä¸€æ®µç¤ºæ„çš„ä»£ç ã€‚</p><p>æ¯”å¦‚è¯´æœ‰è¿™ä¹ˆä¸‰ä¸ªç»„ä»¶ï¼Œåˆ†åˆ«æ˜¯App.server.jsã€Article.server.jsã€Comments.client.jsã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åç¼€æ¥åŒºåˆ†å“ªä¸ªæ˜¯ server ç«¯çš„ç»„ä»¶ï¼Œå“ªä¸ªæ˜¯client ç«¯çš„ç»„ä»¶ã€‚é‚£ä¹ˆ App.server.js çš„ç¤ºæ„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>import { Suspense } from 'react';\nimport Article from 'Article.server.js';\nimport Comments from 'Comments.client.js';\nfunction App() {\n  // ä» URL è·å– articleId\n  const articleId = useSearchParams('articleId')\n  return (\n    &lt;div&gt;\n      &lt;Suspense fallback={&lt;&gt;Loading...&lt;/&gt;}&gt;\n        &lt;Article id={}\n      &lt;/Suspense&gt;\n      &lt;Comments articleId={articleId} /&gt;\n    &lt;/div&gt;\n  );\n}\n</code></pre><p>åœ¨è¿™æ®µä»£ç é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨çš„ App å’Œ Article è¿™ä¸¤ä¸ªç»„ä»¶æ˜¯æœåŠ¡å™¨ç«¯ç»„ä»¶ã€‚åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶ï¼Œç”±æœåŠ¡å™¨ç«¯è¿”å›åˆ°å‰ç«¯ã€‚è€Œåœ¨éšåçš„æ¸²æŸ“ä¸­ï¼Œæ¯”å¦‚ articleId å‘ç”Ÿäº†å˜åŒ–ï¼Œé‚£ä¹ˆArticle è¿™ä¸ªç»„ä»¶ä¼šé€šè¿‡æœåŠ¡å™¨ç«¯å»é‡æ–°æ¸²æŸ“ã€‚ç„¶åæ¸²æŸ“çš„ç»“æœï¼Œå†å‘é€åˆ°æµè§ˆå™¨ç«¯æ¥å±•ç¤ºã€‚å› ä¸º Article æ˜¯ä¸€ä¸ªéœ€è¦å¼‚æ­¥æ¸²æŸ“çš„ç»„ä»¶ï¼Œæ‰€ä»¥ä¹Ÿä¼šåŒ…å«åœ¨ä¸Šé¢æåˆ°çš„ Suspense æ ‡è®°ä¸­ã€‚</p><p>é‚£ä¹ˆServer ç«¯ç»„ä»¶èƒ½å¤Ÿå¸¦æ¥ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿå…¶å®é€šè¿‡ Article è¿™ä¸ªç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆç›´æ¥çš„çœ‹åˆ°è¿™æ ·ä¸¤ä¸ªå¥½å¤„ã€‚</p><p>ç¬¬ä¸€ï¼ŒArticle ç»„ä»¶åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œï¼Œæ‰€ä»¥åœ¨ä»£ç ä¸­å¯ä»¥ç›´æ¥å»è¯»å–æ–‡ä»¶ç³»ç»Ÿã€æŸ¥è¯¢æ•°æ®åº“ç­‰ï¼Œæ•°æ®é€»è¾‘ä¼šéå¸¸ç®€å•ã€‚</p><p>æ¯”å¦‚è¯´ï¼ŒArticle çš„ç»„ä»¶ä»£ç å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼Œå…¶ä¸­å°±ç›´æ¥æŸ¥è¯¢äº†æ•°æ®åº“ï¼š</p><pre><code>export default function Article({ articleId}) {\n  // æœåŠ¡å™¨ç«¯ç»„ä»¶å¯ä»¥ç›´æ¥æŸ¥è¯¢æ•°æ®åº“\n  const article = db.query(\n    `select * from articles where id=${articleId}`\n  ).rows[0];\n  \n  return (\n    &lt;div&gt;\n      &lt;h1&gt;{article.title}&lt;/h1&gt;\n      &lt;p&gt;{article.content}&lt;/p&gt;\n    &lt;/div&gt;\n  );\n}\n</code></pre><p>ç¬¬äºŒï¼ŒArticle æ‰€éœ€è¦çš„ä»»ä½•ä¾èµ–åªéœ€è¦å­˜åœ¨äºæœåŠ¡å™¨ç«¯ã€‚æ¯”å¦‚è¯´ï¼Œå®ƒä¾èµ–äº† moment è¿™ä¸ª library å»åšæ—¥æœŸçš„æ ¼å¼åŒ–ï¼Œé‚£ä¹ˆ moment å°±ä¸éœ€è¦æ‰“åŒ…åˆ°å‰ç«¯ï¼Œåªéœ€è¦åœ¨æœåŠ¡å™¨ç«¯å­˜åœ¨å°±å¯ä»¥äº†ï¼Œæˆ‘ä»¬ä¹Ÿå°±ä¸å†éœ€è¦æ‹…å¿ƒåŒ…çš„å¤§å°äº†ã€‚</p><p>æ‰€ä»¥ï¼Œé€šè¿‡è¿™ä¸¤ç‚¹å…¶å®å¯ä»¥çœ‹åˆ°ï¼ŒServer Components ä¸ºæˆ‘ä»¬å¼€å‘å…·æœ‰æè‡´æ€§èƒ½çš„å‰ç«¯åº”ç”¨ï¼Œæä¾›äº†ä¸€ä¸ªè‰¯å¥½çš„åŸºç¡€ã€‚ä¸€æ–¹é¢ï¼Œå®ƒèƒ½å¤Ÿè®©æˆ‘ä»¬é€šè¿‡ç”¨æœåŠ¡å™¨ç«¯æ¸²æŸ“æ›´å¤šçš„ç»„ä»¶ï¼ŒæŠŠå‰ç«¯åŒ…çš„å¤§å°æ§åˆ¶å¾—å¾ˆå°ï¼Œä»è€Œæå‡åŠ è½½æ€§èƒ½ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œ<strong>å®ƒèƒ½è®©é¡µé¢ä¸­çš„ä¸€éƒ¨åˆ†èƒ½å¤Ÿåœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ã€‚</strong>ä¸ä½†èƒ½å¤Ÿç®€åŒ–å‰ç«¯å¼‚æ­¥è¯·æ±‚çš„é€»è¾‘ï¼Œè€Œä¸”åœ¨ç»„ä»¶å†…éœ€è¦å¤šä¸ªæ•°æ®è¯·æ±‚æ—¶ï¼Œä¹Ÿä¼šæå‡æ¸²æŸ“é€Ÿåº¦ã€‚</p><p>ä¸è¿‡çœ‹åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½åˆä¼šé—®äº†ï¼Œè¿™ä¸ªå’Œä»¥å‰çš„æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿå…¶å®æˆ‘ä»¬å¯ä»¥æŠŠ Server Components çœ‹ä½œ SSR çš„è¿›é˜¶ç‰ˆæœ¬ã€‚ä¼ ç»Ÿçš„SSRï¼Œæ¯æ¬¡åªèƒ½ render æ•´ä¸ªé¡µé¢ï¼Œè€Œç°åœ¨åˆ™å¯ä»¥åœ¨ç»„ä»¶çº§åˆ« render äº†ï¼Œå¤§å¤§æå‡äº†çµæ´»æ€§ã€‚</p><p>å› è€Œæˆ‘ä»¬åº”è¯¥è¯´ï¼ŒServer Components æ˜¯ä¸€ä¸ªéå¸¸ä»¤äººæœŸå¾…çš„ç‰¹æ€§ï¼Œå°¤å…¶æ˜¯<strong>å¯¹äºç”µå•†é¡µé¢è¿™ç§å¯¹æ€§èƒ½æœ‰æè‡´éœ€æ±‚çš„æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„åº”ç”¨</strong>ï¼Œä¼šå¸¦æ¥æå¤§çš„å¸®åŠ©ã€‚é‚£ä¹ˆç­‰åˆ° Server Components æ­£å¼å‘å¸ƒä¹‹åï¼Œç¤¾åŒºä¸­è¿˜ä¼šæœ‰å“ªäº›ä»¤äººå…´å¥‹çš„æ¡†æ¶çº§åˆ«æ”¯æŒå‘¢ï¼Ÿå°±è®©æˆ‘ä»¬æ‹­ç›®ä»¥å¾…å§ã€‚</p><h2>å°ç»“</h2><p>è¿™èŠ‚è¯¾æˆ‘ä»¬ä¸»è¦å­¦ä¹ äº†ä¸‰éƒ¨åˆ†å†…å®¹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹åˆ°äº†æœ€è¿‘åˆšåˆšå‘å¸ƒçš„ React 17 çš„å˜åŒ–ã€‚è™½ç„¶åœ¨APIä¸Šæ²¡æœ‰æ˜æ˜¾çš„å˜åŒ–ï¼Œä½†æ˜¯å®ƒä¸ºä»¥åçš„æ¸è¿›å¼ç‰ˆæœ¬æ›´æ–°æä¾›äº†åŸºç¡€ï¼Œå¹¶ä¸”åŸºäºæ–°çš„ JSX çš„å¤„ç†æœºåˆ¶ï¼Œè®©ä½ ä¸å†éœ€è¦åœ¨ä»£ç ä¸­ import Reactã€‚</p><p>æ¥ç€ï¼Œæˆ‘ä»¬äº†è§£äº†Reactä¸­ä¸€ä¸ªâ€œå¤è€â€çš„æ–°ç‰¹æ€§â€”â€”Suspenseã€‚è¿™ä¸ªç‰¹æ€§è™½ç„¶ä»ç„¶å¤„äºå®éªŒé˜¶æ®µï¼Œä½†å…¶å®å·²ç»éå¸¸ç¨³å®šäº†ã€‚è€Œæˆ‘ä»¬è¦åšçš„ï¼Œå°±æ˜¯ç­‰å¾…å®ƒæ­£å¼å‘å¸ƒï¼Œç„¶åå»çœ‹çœ‹ç¤¾åŒºä¸­è¿˜ä¼šæä¾›å“ªäº›æ›´å¥½ç”¨çš„å¼€å‘æ–¹å¼ã€‚</p><p>æœ€åï¼Œæˆ‘ä»‹ç»äº†ä¸€ä¸ªéå¸¸ä»¤äººå…´å¥‹çš„æœåŠ¡å™¨ç«¯ç»„ä»¶çš„ææ¡ˆã€‚å¯ä»¥è¯´ï¼Œå®ƒä¸ºæˆ‘ä»¬å»å¼€å‘æè‡´æ€§èƒ½çš„ React åº”ç”¨æä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„åŸºç¡€ã€‚è™½ç„¶åŠŸèƒ½è¿˜åœ¨å¼€å‘ä¸­ï¼Œä½†æ˜¯éå¸¸å€¼å¾—æœŸå¾…ã€‚</p><p>å¥½äº†ï¼Œåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬æ•´ä¸ªè¯¾ç¨‹çš„ä¸»ä½“éƒ¨åˆ†å°±æ­£å¼ç»“æŸäº†ã€‚å¸Œæœ›é€šè¿‡åŸºç¡€ç¯‡ã€å®æˆ˜ç¯‡å’Œæ‰©å±•ç¯‡çš„å­¦ä¹ ï¼Œä½ èƒ½å¯¹ Reactå’ŒReact Hooks æœ‰ä¸€ä¸ªæ›´æœ¬è´¨çš„è®¤è¯†ã€‚å½“ç„¶ï¼Œæˆ‘æ›´å¸Œæœ›çš„ï¼Œæ˜¯ä½ èƒ½é€šè¿‡ä¸æ–­æ€è€ƒå’Œç¢ç£¨ï¼Œæ‰¾åˆ°è‡ªå·±å­¦ä¹ æ–¹æ³•ï¼Œå¤šæ€è€ƒæ¯ä¸€ä¸ªæŠ€æœ¯çš„æœ¬è´¨ï¼Œä»¥åŠè¦è§£å†³çš„é—®é¢˜ï¼Œä»è€Œèƒ½å¤Ÿä¸¾ä¸€åä¸‰ï¼Œä¸æ–­æå‡ React çš„å¼€å‘æ•ˆç‡ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>å‰é¢æåˆ°ï¼ŒReact 17ä¸­æ–°çš„äº‹ä»¶æ¨¡å‹å¯ä»¥åœ¨å’Œå…¶å®ƒæ¡†æ¶æˆ–è€…ä¸åŒç‰ˆæœ¬ React ä½¿ç”¨æ—¶ï¼Œé¿å…ä¸€äº›æ½œåœ¨çš„äº‹ä»¶å†²çªã€‚ä½ èƒ½æƒ³åˆ°å¦‚æœäº‹ä»¶ç»‘å®šåœ¨ document ä¸Šï¼Œä»€ä¹ˆåœºæ™¯ä¸‹ä¼šäº§ç”Ÿäº‹ä»¶å†²çªå‘¢ï¼Ÿ</p><p>è¿™æ˜¯æˆ‘ä»¬è¿™é—¨è¯¾çš„æœ€åä¸€é“æ€è€ƒé¢˜äº†ï¼Œæ¬¢è¿æŠŠä½ çš„æ€è€ƒå’Œæƒ³æ³•åˆ†äº«åœ¨ç•™è¨€åŒºï¼Œæˆ‘ä¼šå’Œä½ äº¤æµè®¨è®ºã€‚ä¹Ÿæ¬¢è¿æŠŠè¯¾ç¨‹åˆ†äº«ç»™ä½ çš„åŒäº‹ã€æœ‹å‹ï¼Œä¸€èµ·å…±åŒè¿›æ­¥ã€‚</p>","comments":[{"had_liked":false,"id":302448,"user_name":"ç«¹æ–","can_delete":false,"product_type":"c1","uid":1036154,"ip_address":"","ucode":"F9BF97BDC1252A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/cf/7a/3c37260a.jpg","comment_is_top":false,"comment_ctime":1626227120,"is_pvip":false,"replies":[{"id":"110078","content":"å¦‚ä½•åœ¨åˆé€‚çš„åœºæ™¯ä½¿ç”¨ APIï¼Œä»¥åŠæ¯ä¸ª API è§£å†³çš„é—®é¢˜æ˜¯ä»€ä¹ˆï¼Œæ˜¯æˆ‘ä»¬è¿™ä¹ˆè¯¾çš„é‡ç‚¹ï¼Œä¹Ÿæ˜¯ä½¿ç”¨å¥½ Hooks çš„å…³é”®ã€‚è€Œæ·±å…¥è§£æ Hooks åœ¨æºç å±‚é¢æ˜¯å¦‚ä½•å®ç°çš„ï¼Œåˆ™æœ‰åŠ©äºçš„æ˜¯åœ¨ä½ è¦è‡ªå·±å®ç° Hooks è¿™æ ·çš„æ¡†æ¶æ—¶ï¼Œåº”è¯¥å¦‚ä½•å»è®¾è®¡å®ç°ã€‚ç†è§£æºç å¹¶ä¸èƒ½è®©ä½ æ›´å¥½çš„ä½¿ç”¨ APIï¼Œä¸¤ä¸ªå±‚é¢çš„é—®é¢˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Nate","uid":"1018676","ctime":1627306369,"ip_address":"","comment_id":302448,"utype":1}],"discussion_count":3,"race_medal":0,"score":"78935638448","product_id":100079901,"comment_content":"çœ‹å®Œä¸“æ æ„Ÿè§‰ç¨å¾®æœ‰ç‚¹å¤±è½ï¼Œè¿™å°±ç»“æŸäº†ï¼Ÿæœ¬æƒ³ç€æœ‰äº›Hookçš„å†…éƒ¨æ·±å…¥è§£æä¹‹ç±»çš„ï¼Œæ„Ÿè§‰è¿˜æ˜¯åœç•™åœ¨apiä½¿ç”¨çš„å±‚é¢ä¸Šï¼Œå…¥é—¨å§","like_count":19,"discussions":[{"author":{"id":1018676,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8b/34/61035278.jpg","nickname":"Nate","note":"","ucode":"844B4C20BB3D6E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523311,"discussion_content":"å¦‚ä½•åœ¨åˆé€‚çš„åœºæ™¯ä½¿ç”¨ APIï¼Œä»¥åŠæ¯ä¸ª API è§£å†³çš„é—®é¢˜æ˜¯ä»€ä¹ˆï¼Œæ˜¯æˆ‘ä»¬è¿™ä¹ˆè¯¾çš„é‡ç‚¹ï¼Œä¹Ÿæ˜¯ä½¿ç”¨å¥½ Hooks çš„å…³é”®ã€‚è€Œæ·±å…¥è§£æ Hooks åœ¨æºç å±‚é¢æ˜¯å¦‚ä½•å®ç°çš„ï¼Œåˆ™æœ‰åŠ©äºçš„æ˜¯åœ¨ä½ è¦è‡ªå·±å®ç° Hooks è¿™æ ·çš„æ¡†æ¶æ—¶ï¼Œåº”è¯¥å¦‚ä½•å»è®¾è®¡å®ç°ã€‚ç†è§£æºç å¹¶ä¸èƒ½è®©ä½ æ›´å¥½çš„ä½¿ç”¨ APIï¼Œä¸¤ä¸ªå±‚é¢çš„é—®é¢˜ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1627306369,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1194643,"avatar":"https://static001.geekbang.org/account/avatar/00/12/3a/93/d7be8a1a.jpg","nickname":"æ™“å°ä¸œ","note":"","ucode":"93F9462EAAA63C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542068,"discussion_content":"æœ€å¥½ä¸¤è€…ç»“åˆï¼Œæœ€è¿‘æŠŠæºç è¯»äº†ï¼Œä½†å¬è€å¸ˆè®²ï¼Œå¦‚ä½•è®¾è®¡ä½¿ç”¨æ—¶ï¼Œè¿˜æ˜¯å¾ˆå—ç›Šçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640657204,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1053875,"avatar":"https://static001.geekbang.org/account/avatar/00/10/14/b3/b6e1817a.jpg","nickname":"è¶ä½ è¿˜å¹´è½»233","note":"","ucode":"B7CC120EF42980","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385086,"discussion_content":"å‰é¢è¿˜ä¸é”™ï¼Œåé¢è´¨é‡æœ‰äº›ä¸‹é™äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626876218,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":302056,"user_name":"Geek_413aa8","can_delete":false,"product_type":"c1","uid":2637833,"ip_address":"","ucode":"5A3E3CE2AA419B","user_header":"","comment_is_top":false,"comment_ctime":1626057621,"is_pvip":false,"replies":[{"id":"110409","content":"å…¶å®è¿™ä¸€è¯¾å·²ç»åŒ…å«äº†æœåŠ¡å™¨ç«¯ç»„ä»¶çš„ç®€å•ä»‹ç»ï¼Œæ­£æ˜¯React 18 alpha çš„å†…å®¹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Nate","uid":"1018676","ctime":1627890832,"ip_address":"","comment_id":302056,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14510959509","product_id":100079901,"comment_content":"react 18 Alpha ç‰ˆæœ¬ä¸æ˜¯å·²ç»å‘å¸ƒäº†ï¼›å¸Œæœ›è€å¸ˆç»™è®²è§£ä¸€ä¸‹","like_count":3,"discussions":[{"author":{"id":1018676,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8b/34/61035278.jpg","nickname":"Nate","note":"","ucode":"844B4C20BB3D6E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523162,"discussion_content":"å…¶å®è¿™ä¸€è¯¾å·²ç»åŒ…å«äº†æœåŠ¡å™¨ç«¯ç»„ä»¶çš„ç®€å•ä»‹ç»ï¼Œæ­£æ˜¯React 18 alpha çš„å†…å®¹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627890832,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":301808,"user_name":"lunar","can_delete":false,"product_type":"c1","uid":1197007,"ip_address":"","ucode":"4FC1E388AD98C6","user_header":"https://static001.geekbang.org/account/avatar/00/12/43/cf/118c4ef5.jpg","comment_is_top":false,"comment_ctime":1625891908,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14510793796","product_id":100079901,"comment_content":"ä»è§†é¢‘è¿½åˆ°ä¸“æ ï¼Œè¿™åˆåŒå’å•è¦ç»“æŸäº†ï¼Ÿæˆ‘ä¸€ä¸ªåšåç«¯çš„ä¹Ÿä¸çŸ¥é“ä¸ºå•¥å¯¹è¿™é—¨è¯¾è¿™ä¹ˆæ„Ÿå…´è¶£ï¼Œ è«éæ˜¯è€å¸ˆè®²å¾—å¤ªå¥½äº†ï¼ğŸ˜‚","like_count":4},{"had_liked":false,"id":301915,"user_name":"é—²é—²","can_delete":false,"product_type":"c1","uid":1637571,"ip_address":"","ucode":"B2099BDCFF6191","user_header":"https://static001.geekbang.org/account/avatar/00/18/fc/c3/0991edfc.jpg","comment_is_top":false,"comment_ctime":1625972898,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10215907490","product_id":100079901,"comment_content":"è€å¸ˆæˆ‘æœ‰å‡ ä¸ªé—®é¢˜å’¨è¯¢ä¸‹<br>1ã€å¯¹äºäº‹ä»¶å†²çªï¼Œå…¶å®æˆ‘æ²¡æœ‰å¤ªç†è§£ï¼Œæˆ‘è®°å¾—ç”¨addeventLicenseç›‘å¬çš„äº‹ä»¶ï¼Œå³ä¾¿æ˜¯åŒä¸€ä¸ªdomç»‘å®šä¹Ÿæ˜¯ä¸ä¼šå†²çªçš„ï¼Œé‚£æ€ä¹ˆæ¥è¯´ï¼Œäº‹ä»¶åº”è¯¥ä¸ä¼šå†²çªå§ï¼Œæ˜¯æœ‰å…¶ä»–åœºæ™¯æˆ–è€…åº”è¯¥æ˜¯æˆ‘å¯¹äº‹ä»¶ç†è§£ä¸æ·±ï¼Œè¿˜è¯·è€å¸ˆè§£ç­”<br>2ã€å¯¹äºæœåŠ¡å™¨ç«¯æ¸²æŸ“çš„é—®é¢˜ï¼Œreactæ˜¯çŠ¶æ€é©±åŠ¨çš„ï¼ŒæœåŠ¡å™¨ç«¯æ¸²æŸ“çš„è¯ï¼Œè¿™ä¸ªçŠ¶æ€é©±åŠ¨æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿå¦å¤–å¯¹äºä¸€äº›å¤æ‚ç•Œé¢ï¼ŒçŠ¶æ€å¯èƒ½å¾ˆå¤æ‚ä¹Ÿå¾ˆå®¹æ˜“å˜åŒ–ï¼Œé‚£æœåŠ¡å™¨ç«¯æ¸²æŸ“ä¼šä¸ä¼šç»™æœåŠ¡å™¨é€ æˆå‹åŠ›å‘¢ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1073230,"avatar":"https://static001.geekbang.org/account/avatar/00/10/60/4e/22ee02a8.jpg","nickname":"Zion","note":"","ucode":"12E0DA629B243B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388731,"discussion_content":"é—®é¢˜2: æœåŠ¡å™¨ç«¯ç»„ä»¶åªæ˜¯ SSR çš„è¿›é˜¶ç‰ˆã€‚åœ¨è¿™ä¸ªå‰æä¸‹ï¼Œç¬¬ä¸€æ¬¡è·å–é¡µé¢ï¼ŒæœåŠ¡å™¨ç«¯æ¸²æŸ“ä¸€æ¬¡ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯çš„ HTML åº”è¯¥ä¸å®¢æˆ·ç«¯æ¸²æŸ“çš„ HTML æ˜¯åŒæ„çš„ï¼ˆisomorphicï¼‰ï¼Œåç»­é¡µé¢æ¸²æŸ“å°±æ˜¯å®¢æˆ·ç«¯çš„å·¥ä½œäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628929130,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":347281,"user_name":"Geek_4e92cc","can_delete":false,"product_type":"c1","uid":2995810,"ip_address":"","ucode":"1DD2764FD8C4E8","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eotuhVFN9phZsthxdS2bBAV9Cjb1NqIFbSQhiclmtsUDCn1cOKrzU8Ie1ickxlWC4kIlI3S69XrST7w/132","comment_is_top":false,"comment_ctime":1653899039,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5948866335","product_id":100079901,"comment_content":"é—®ä¸ªé—®é¢˜ï¼šclassç»„ä»¶ä¸­ this.foreUpdate(), æ˜¯å½“å‰ç»„ä»¶é‡æ–°render è¿˜æ˜¯ æ•´ä¸ªç»„ä»¶æ ‘é‡æ–°renderï¼Ÿ","like_count":1},{"had_liked":false,"id":301807,"user_name":"lunar","can_delete":false,"product_type":"c1","uid":1197007,"ip_address":"","ucode":"4FC1E388AD98C6","user_header":"https://static001.geekbang.org/account/avatar/00/12/43/cf/118c4ef5.jpg","comment_is_top":false,"comment_ctime":1625891448,"is_pvip":false,"replies":[{"id":"109241","content":"æ˜¯ä¸æ˜¯æœ‰ç‚¹èˆä¸å¾—","user_name":"ç¼–è¾‘å›å¤","user_name_real":"æè¾°æ´‹","uid":"2189689","ctime":1625908328,"ip_address":"","comment_id":301807,"utype":2}],"discussion_count":2,"race_medal":0,"score":"5920858744","product_id":100079901,"comment_content":"ä»è§†é¢‘è¿½åˆ°ä¸“æ ï¼Œ è¿™åˆåŒåŒåŒç»“æŸäº†ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":2189689,"avatar":"https://static001.geekbang.org/account/avatar/00/21/69/79/b4132042.jpg","nickname":"ğŸ‘","note":"","ucode":"DE34B3B14287D1","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523094,"discussion_content":"æ˜¯ä¸æ˜¯æœ‰ç‚¹èˆä¸å¾—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625908328,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2177627,"avatar":"https://static001.geekbang.org/account/avatar/00/21/3a/5b/e59f76a6.jpg","nickname":"å©§å­é…±.","note":"","ucode":"B47F87EFA8F8F5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383737,"discussion_content":"æˆ‘æ˜¯ä»ä¸“æ è¿½åˆ°è§†é¢‘~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626227943,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":301790,"user_name":"æµ©æ˜å•¦","can_delete":false,"product_type":"c1","uid":1377422,"ip_address":"","ucode":"120ED8FC45B992","user_header":"https://static001.geekbang.org/account/avatar/00/15/04/8e/e75ecc5e.jpg","comment_is_top":false,"comment_ctime":1625883276,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5920850572","product_id":100079901,"comment_content":"åœ¨å¾®å‰ç«¯é‡Œï¼Œå¤šä¸ª react 16 çš„å¾®åº”ç”¨å¯èƒ½ä¼šå‡ºç°é—®é¢˜","like_count":1},{"had_liked":false,"id":334732,"user_name":"å¤§ç¥åšå£«","can_delete":false,"product_type":"c1","uid":1195144,"ip_address":"","ucode":"8C4318095949F0","user_header":"https://static001.geekbang.org/account/avatar/00/12/3c/88/6bef27d6.jpg","comment_is_top":false,"comment_ctime":1645093873,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1645093873","product_id":100079901,"comment_content":" Suspense å¾ˆå¥‡æ€ªå“ï¼Œæ˜¯ä¸æ˜¯ä¼šé€ æˆ ui é¡µé¢çš„é—ªçƒï¼Œçªç„¶ä¸€ä¸ª fallback çš„ loading","like_count":0},{"had_liked":false,"id":318399,"user_name":"ä¸ƒç§’","can_delete":false,"product_type":"c1","uid":1696138,"ip_address":"","ucode":"0BCBBC874868B4","user_header":"https://static001.geekbang.org/account/avatar/00/19/e1/8a/df410c85.jpg","comment_is_top":false,"comment_ctime":1635292336,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1635292336","product_id":100079901,"comment_content":"è¿™å°±ç»“æŸäº† æ„çŠ¹æœªå°½ï¼Œè€å¸ˆè®²å¾—å¾ˆå¥½ï¼","like_count":0},{"had_liked":false,"id":302082,"user_name":"Dark I","can_delete":false,"product_type":"c1","uid":1398772,"ip_address":"","ucode":"B19417BA2ED7A1","user_header":"https://static001.geekbang.org/account/avatar/00/15/57/f4/63c3c5ae.jpg","comment_is_top":false,"comment_ctime":1626073704,"is_pvip":true,"replies":[{"id":"110080","content":"æ˜¯çš„ï¼ŒReact Hooks æœ¬èº«å°±è¿™äº›æ–¹é¢ã€‚æ›´å¤šçš„ç”Ÿæ€éœ€è¦è‡ªå·±å»æ…¢æ…¢å‘ç°ï¼š-ï¼‰","user_name":"ä½œè€…å›å¤","user_name_real":"Nate","uid":"1018676","ctime":1627306627,"ip_address":"","comment_id":302082,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1626073704","product_id":100079901,"comment_content":"è¿™å°±ç»“æŸäº† å¥½å¿«å•Š","like_count":0,"discussions":[{"author":{"id":1018676,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8b/34/61035278.jpg","nickname":"Nate","note":"","ucode":"844B4C20BB3D6E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523173,"discussion_content":"æ˜¯çš„ï¼ŒReact Hooks æœ¬èº«å°±è¿™äº›æ–¹é¢ã€‚æ›´å¤šçš„ç”Ÿæ€éœ€è¦è‡ªå·±å»æ…¢æ…¢å‘ç°ï¼š-ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627306627,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":301920,"user_name":"é—²é—²","can_delete":false,"product_type":"c1","uid":1637571,"ip_address":"","ucode":"B2099BDCFF6191","user_header":"https://static001.geekbang.org/account/avatar/00/18/fc/c3/0991edfc.jpg","comment_is_top":false,"comment_ctime":1625976168,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625976168","product_id":100079901,"comment_content":"æˆ‘è¿˜æœ‰ä¸ªç–‘é—®éº»çƒ¦è€å¸ˆè§£ç­”ï¼š<br>1ã€suspense æ€ä¹ˆåŒºåˆ†é‚£ä¸ªå¼‚æ­¥é€»è¾‘å¯¹äºé‚£ä¸ªç»„ä»¶å‘¢ï¼ŸæŒ‰ç…§ä¾‹å­è§‰å¾— ï¼Œå°†TopicDetailè¿™ä¸ªç»„ä»¶åŒ…è£¹åœ¨äº†suspenté‡Œé¢ï¼Œé‚£å¦‚æœæœ‰å¤šä¸ªè¯·æ±‚å‘¢ï¼Œæ¯ä¸ªç»„ä»¶éƒ½åŒ…è£¹åœ¨suspenseé‡Œé¢å—ï¼Ÿè¿˜æ˜¯æ€ä¹ˆæ“ä½œçš„ï¼Ÿ","like_count":0}]}