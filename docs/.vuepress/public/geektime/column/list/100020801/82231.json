{"id":82231,"title":"42 | grant之后要跟着flush privileges吗？","content":"<p>在MySQL里面，grant语句是用来给用户赋权的。不知道你有没有见过一些操作文档里面提到，grant之后要马上跟着执行一个flush privileges命令，才能使赋权语句生效。我最开始使用MySQL的时候，就是照着一个操作文档的说明按照这个顺序操作的。</p><p>那么，grant之后真的需要执行flush privileges吗？如果没有执行这个flush命令的话，赋权语句真的不能生效吗？</p><p>接下来，我就先和你介绍一下grant语句和flush privileges语句分别做了什么事情，然后再一起来分析这个问题。</p><p>为了便于说明，我先创建一个用户：</p><pre><code>create user 'ua'@'%' identified by 'pa';\n</code></pre><p>这条语句的逻辑是创建一个用户’ua’@’%’，密码是pa。注意，在MySQL里面，用户名(user)+地址(host)才表示一个用户，因此 ua@ip1 和 ua@ip2代表的是两个不同的用户。</p><p>这条命令做了两个动作：</p><ol>\n<li>\n<p>磁盘上，往mysql.user表里插入一行，由于没有指定权限，所以这行数据上所有表示权限的字段的值都是N；</p>\n</li>\n<li>\n<p>内存里，往数组acl_users里插入一个acl_user对象，这个对象的access字段值为0。</p>\n</li>\n</ol><p>图1就是这个时刻用户ua在user表中的状态。</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/7e/35/7e75bbfbca0cb932e1256941c99d5f35.png?wh=1378*1542\" alt=\"\"></p><center><span class=\"reference\">图1 mysql.user 数据行</span></center><p>在MySQL中，用户权限是有不同的范围的。接下来，我就按照用户权限范围从大到小的顺序依次和你说明。</p><h1>全局权限</h1><p>全局权限，作用于整个MySQL实例，这些权限信息保存在mysql库的user表里。如果我要给用户ua赋一个最高权限的话，语句是这么写的：</p><pre><code>grant all privileges on *.* to 'ua'@'%' with grant option;\n</code></pre><p>这个grant命令做了两个动作：</p><ol>\n<li>\n<p>磁盘上，将mysql.user表里，用户’ua’@’%'这一行的所有表示权限的字段的值都修改为‘Y’；</p>\n</li>\n<li>\n<p>内存里，从数组acl_users中找到这个用户对应的对象，将access值（权限位）修改为二进制的“全1”。</p>\n</li>\n</ol><p>在这个grant命令执行完成后，如果有新的客户端使用用户名ua登录成功，MySQL会为新连接维护一个线程对象，然后从acl_users数组里查到这个用户的权限，并将权限值拷贝到这个线程对象中。之后在这个连接中执行的语句，所有关于全局权限的判断，都直接使用线程对象内部保存的权限位。</p><p>基于上面的分析我们可以知道：</p><ol>\n<li>\n<p>grant 命令对于全局权限，同时更新了磁盘和内存。命令完成后即时生效，接下来新创建的连接会使用新的权限。</p>\n</li>\n<li>\n<p>对于一个已经存在的连接，它的全局权限不受grant命令的影响。</p>\n</li>\n</ol><p>需要说明的是，<strong>一般在生产环境上要合理控制用户权限的范围</strong>。我们上面用到的这个grant语句就是一个典型的错误示范。如果一个用户有所有权限，一般就不应该设置为所有IP地址都可以访问。</p><p>如果要回收上面的grant语句赋予的权限，你可以使用下面这条命令：</p><pre><code>revoke all privileges on *.* from 'ua'@'%';\n</code></pre><p>这条revoke命令的用法与grant类似，做了如下两个动作：</p><ol>\n<li>\n<p>磁盘上，将mysql.user表里，用户’ua’@’%'这一行的所有表示权限的字段的值都修改为“N”；</p>\n</li>\n<li>\n<p>内存里，从数组acl_users中找到这个用户对应的对象，将access的值修改为0。</p>\n</li>\n</ol><h1>db权限</h1><p>除了全局权限，MySQL也支持库级别的权限定义。如果要让用户ua拥有库db1的所有权限，可以执行下面这条命令：</p><pre><code>grant all privileges on db1.* to 'ua'@'%' with grant option;\n</code></pre><p>基于库的权限记录保存在mysql.db表中，在内存里则保存在数组acl_dbs中。这条grant命令做了如下两个动作：</p><ol>\n<li>\n<p>磁盘上，往mysql.db表中插入了一行记录，所有权限位字段设置为“Y”；</p>\n</li>\n<li>\n<p>内存里，增加一个对象到数组acl_dbs中，这个对象的权限位为“全1”。</p>\n</li>\n</ol><p>图2就是这个时刻用户ua在db表中的状态。</p><p><img src=\"https://static001.geekbang.org/resource/image/32/2e/32cd61ee14ad2f370e1de0fb4e39bb2e.png?wh=1400*1180\" alt=\"\"></p><center><span class=\"reference\">图2 mysql.db 数据行</span></center><p>每次需要判断一个用户对一个数据库读写权限的时候，都需要遍历一次acl_dbs数组，根据user、host和db找到匹配的对象，然后根据对象的权限位来判断。</p><p>也就是说，grant修改db权限的时候，是同时对磁盘和内存生效的。</p><p>grant操作对于已经存在的连接的影响，在全局权限和基于db的权限效果是不同的。接下来，我们做一个对照试验来分别看一下。</p><p><img src=\"https://static001.geekbang.org/resource/image/ae/c7/aea26807c8895961b666a5d96b081ac7.png?wh=1246*1320\" alt=\"\"></p><center><span class=\"reference\">图3 权限操作效果</span></center><p>需要说明的是，图中set global sync_binlog这个操作是需要super权限的。</p><p>可以看到，虽然用户ua的super权限在T3时刻已经通过revoke语句回收了，但是在T4时刻执行set global的时候，权限验证还是通过了。这是因为super是全局权限，这个权限信息在线程对象中，而revoke操作影响不到这个线程对象。</p><p>而在T5时刻去掉ua对db1库的所有权限后，在T6时刻session B再操作db1库的表，就会报错“权限不足”。这是因为acl_dbs是一个全局数组，所有线程判断db权限都用这个数组，这样revoke操作马上就会影响到session B。</p><p>这里在代码实现上有一个特别的逻辑，如果当前会话已经处于某一个db里面，之前use这个库的时候拿到的库权限会保存在会话变量中。</p><p>你可以看到在T6时刻，session C和session B对表t的操作逻辑是一样的。但是session B报错，而session C可以执行成功。这是因为session C在T2 时刻执行的use db1，拿到了这个库的权限，在切换出db1库之前，session C对这个库就一直有权限。</p><h1>表权限和列权限</h1><p>除了db级别的权限外，MySQL支持更细粒度的表权限和列权限。其中，表权限定义存放在表mysql.tables_priv中，列权限定义存放在表mysql.columns_priv中。这两类权限，组合起来存放在内存的hash结构column_priv_hash中。</p><p>这两类权限的赋权命令如下：</p><pre><code>create table db1.t1(id int, a int);\n\ngrant all privileges on db1.t1 to 'ua'@'%' with grant option;\nGRANT SELECT(id), INSERT (id,a) ON mydb.mytbl TO 'ua'@'%' with grant option;\n</code></pre><p>跟db权限类似，这两个权限每次grant的时候都会修改数据表，也会同步修改内存中的hash结构。因此，对这两类权限的操作，也会马上影响到已经存在的连接。</p><p>看到这里，你一定会问，看来grant语句都是即时生效的，那这么看应该就不需要执行flush privileges语句了呀。</p><p>答案也确实是这样的。</p><p>flush privileges命令会清空acl_users数组，然后从mysql.user表中读取数据重新加载，重新构造一个acl_users数组。也就是说，以数据表中的数据为准，会将全局权限内存数组重新加载一遍。</p><p>同样地，对于db权限、表权限和列权限，MySQL也做了这样的处理。</p><p>也就是说，如果内存的权限数据和磁盘数据表相同的话，不需要执行flush privileges。而如果我们都是用grant/revoke语句来执行的话，内存和数据表本来就是保持同步更新的。</p><p><strong>因此，正常情况下，grant命令之后，没有必要跟着执行flush privileges命令。</strong></p><h1>flush privileges使用场景</h1><p>那么，flush privileges是在什么时候使用呢？显然，当数据表中的权限数据跟内存中的权限数据不一致的时候，flush privileges语句可以用来重建内存数据，达到一致状态。</p><p>这种不一致往往是由不规范的操作导致的，比如直接用DML语句操作系统权限表。我们来看一下下面这个场景：</p><p><img src=\"https://static001.geekbang.org/resource/image/90/ec/9031814361be42b7bc084ad2ab2aa3ec.png?wh=1250*690\" alt=\"\"></p><center><span class=\"reference\">图4 使用flush privileges</span></center><p>可以看到，T3时刻虽然已经用delete语句删除了用户ua，但是在T4时刻，仍然可以用ua连接成功。原因就是，这时候内存中acl_users数组中还有这个用户，因此系统判断时认为用户还正常存在。</p><p>在T5时刻执行过flush命令后，内存更新，T6时刻再要用ua来登录的话，就会报错“无法访问”了。</p><p>直接操作系统表是不规范的操作，这个不一致状态也会导致一些更“诡异”的现象发生。比如，前面这个通过delete语句删除用户的例子，就会出现下面的情况：</p><p><img src=\"https://static001.geekbang.org/resource/image/dd/f1/dd625b6b4eb2dcbdaac73648a1af50f1.png?wh=1140*502\" alt=\"\"></p><center><span class=\"reference\">图5 不规范权限操作导致的异常</span></center><p>可以看到，由于在T3时刻直接删除了数据表的记录，而内存的数据还存在。这就导致了：</p><ol>\n<li>\n<p>T4时刻给用户ua赋权限失败，因为mysql.user表中找不到这行记录；</p>\n</li>\n<li>\n<p>而T5时刻要重新创建这个用户也不行，因为在做内存判断的时候，会认为这个用户还存在。</p>\n</li>\n</ol><h1>小结</h1><p>今天这篇文章，我和你介绍了MySQL用户权限在数据表和内存中的存在形式，以及grant和revoke命令的执行逻辑。</p><p>grant语句会同时修改数据表和内存，判断权限的时候使用的是内存数据。因此，规范地使用grant和revoke语句，是不需要随后加上flush privileges语句的。</p><p>flush privileges语句本身会用数据表的数据重建一份内存权限数据，所以在权限数据可能存在不一致的情况下再使用。而这种不一致往往是由于直接用DML语句操作系统权限表导致的，所以我们尽量不要使用这类语句。</p><p>另外，在使用grant语句赋权时，你可能还会看到这样的写法：</p><pre><code>grant super on *.* to 'ua'@'%' identified by 'pa';\n</code></pre><p>这条命令加了identified by ‘密码’， 语句的逻辑里面除了赋权外，还包含了：</p><ol>\n<li>\n<p>如果用户’ua’@’%'不存在，就创建这个用户，密码是pa；</p>\n</li>\n<li>\n<p>如果用户ua已经存在，就将密码修改成pa。</p>\n</li>\n</ol><p>这也是一种不建议的写法，因为这种写法很容易就会不慎把密码给改了。</p><p>“grant之后随手加flush privileges”，我自己是这么使用了两三年之后，在看代码的时候才发现其实并不需要这样做，那已经是2011年的事情了。</p><p>去年我看到一位小伙伴这么操作的时候，指出这个问题时，他也觉得很神奇。因为，他和我一样看的第一份文档就是这么写的，自己也一直是这么用的。</p><p>所以，今天的课后问题是，请你也来说一说，在使用数据库或者写代码的过程中，有没有遇到过类似的场景：误用了很长时间以后，由于一个契机发现“啊，原来我错了这么久”？</p><p>你可以把你的经历写在留言区，我会在下一篇文章的末尾选取有趣的评论和你分享。感谢你的收听，也欢迎你把这篇文章分享给更多的朋友一起阅读。</p><h1>上期问题时间</h1><p>上期的问题是，MySQL解析statement格式的binlog的时候，对于load data命令，解析出来为什么用的是load data local。</p><p>这样做的一个原因是，为了确保备库应用binlog正常。因为备库可能配置了secure_file_priv=null，所以如果不用local的话，可能会导入失败，造成主备同步延迟。</p><p>另一种应用场景是使用mysqlbinlog工具解析binlog文件，并应用到目标库的情况。你可以使用下面这条命令 ：</p><pre><code>mysqlbinlog $binlog_file | mysql -h$host -P$port -u$user -p$pwd\n</code></pre><p>把日志直接解析出来发给目标库执行。增加local，就能让这个方法支持非本地的$host。</p><p>评论区留言点赞板：</p><blockquote>\n<p>@poppy 、@库淘淘 两位同学提到了第一个场景；<br>\n@王显伟 @lionetes 两位同学帮忙回答了 @undifined 同学的疑问，拷贝出来的文件要确保MySQL进程可以读。</p>\n</blockquote><p></p>","neighbors":{"left":{"article_title":"41 | 怎么最快地复制一张表？","id":81925},"right":{"article_title":"43 | 要不要使用分区表？","id":82560}},"comments":[{"had_liked":false,"id":68964,"user_name":"way","can_delete":false,"product_type":"c1","uid":1302713,"ip_address":"","ucode":"AD1CBEBA5FDBA9","user_header":"https://static001.geekbang.org/account/avatar/00/13/e0/b9/bca7ff9a.jpg","comment_is_top":false,"comment_ctime":1550634955,"is_pvip":false,"replies":[{"id":"24470","content":"👍<br><br>我最开始使用MySQL的时候，就是不自然的在\\G后面加分号<br>而且还看到报错，好紧张😆","user_name":"作者回复","comment_id":68964,"uid":"1264162","ip_address":"","utype":1,"ctime":1550640741,"user_name_real":"林晓斌"}],"discussion_count":6,"race_medal":0,"score":"272133574603","product_id":100020801,"comment_content":"写个比较小的点：在命令行查询数据需要行转列的时候习惯加个\\G ; 比如slave slave stauts \\G ; 后来发现 ; 是多余的。列几个常用的<br>\\G 行转列并发送给 mysql server<br>\\g 等同于 ;<br>\\! 执行系统命令<br>\\q exit<br>\\c 清除当前SQL（不执行）<br>\\s mysql status 信息<br>其他参考 \\h","like_count":64,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439893,"discussion_content":"👍\n\n我最开始使用MySQL的时候，就是不自然的在\\G后面加分号\n而且还看到报错，好紧张😆","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550640741,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1341276,"avatar":"https://static001.geekbang.org/account/avatar/00/14/77/5c/8d53165e.jpg","nickname":"bingo","note":"","ucode":"DD96820EC8871D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":405882,"discussion_content":"\\h 和 \\? 可以查看这些命令的手册。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634655752,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2001997,"avatar":"","nickname":"杨婷","note":"","ucode":"3AE642802D375C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337294,"discussion_content":"今天看了文章才知道分号是多余的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608864817,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1028343,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b0/f7/228a6c37.jpg","nickname":"江湖上","note":"","ucode":"E10516C681EF23","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291534,"discussion_content":"\\G，用错了3年...","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594864350,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1155646,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKotsBr2icbYNYlRSlicGUD1H7lulSTQUAiclsEz9gnG5kCW9qeDwdYtlRMXic3V6sj9UrfKLPJnQojag/132","nickname":"ppd0705","note":"","ucode":"EB63D4E3FD1E9A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291078,"discussion_content":"slave slave stauts \\G后面不需要加`;`  学到了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594701733,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1056807,"avatar":"https://static001.geekbang.org/account/avatar/00/10/20/27/a6932fbe.jpg","nickname":"虢國技醬","note":"","ucode":"5A192262AA037E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2284,"discussion_content":"今天才发现这个分号是多余的，我还去验证了下🤣","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563437286,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68166,"user_name":"undifined","can_delete":false,"product_type":"c1","uid":1068920,"ip_address":"","ucode":"449CB4CD2DC089","user_header":"https://static001.geekbang.org/account/avatar/00/10/4f/78/c3d8ecb0.jpg","comment_is_top":false,"comment_ctime":1550452309,"is_pvip":false,"replies":[{"id":"24141","content":"👍，优秀","user_name":"作者回复","comment_id":68166,"uid":"1264162","ip_address":"","utype":1,"ctime":1550462297,"user_name_real":"林晓斌"}],"discussion_count":7,"race_medal":0,"score":"173349144149","product_id":100020801,"comment_content":"权限的作用范围和修改策略总结：<br>http:&#47;&#47;ww1.sinaimg.cn&#47;large&#47;d1885ed1ly1g0ab2twmjaj21gs0js78u.jpg","like_count":41,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439544,"discussion_content":"👍，优秀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550462297,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1108080,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e8/70/95f17940.jpg","nickname":"箭飞天","note":"","ucode":"B3735758CBC533","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":279862,"discussion_content":"use database 后，对db的就不是立即生效？是因为直接使用了线程内部的db缓存权限？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1591437082,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2172435,"avatar":"https://static001.geekbang.org/account/avatar/00/21/26/13/0319db8a.jpg","nickname":"Allen","note":"","ucode":"AFDFD3036A8779","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1108080,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e8/70/95f17940.jpg","nickname":"箭飞天","note":"","ucode":"B3735758CBC533","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380614,"discussion_content":"表里没这个，但老师提到了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624605058,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":279862,"ip_address":""},"score":380614,"extra":""}]},{"author":{"id":1124075,"avatar":"https://static001.geekbang.org/account/avatar/00/11/26/eb/24e0ac9c.jpg","nickname":"嬴梦川","note":"","ucode":"104CDFD26A1711","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375980,"discussion_content":"这么一总结就清晰多了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621912711,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1786819,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/43/c3/2c53acd7.jpg","nickname":"雄鹰","note":"","ucode":"67E0C4BDE7F6F2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302900,"discussion_content":"内存存储列中的表权限和列权限的内存存储写反了？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599058844,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1336475,"avatar":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","nickname":"J.Smile","note":"","ucode":"C4D98DFDBF7584","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":281512,"discussion_content":"优秀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591754989,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1013992,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/78/e8/29569aaf.jpg","nickname":"杰克","note":"","ucode":"0E5C00A91309BB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1107,"discussion_content":"优秀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562318296,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68278,"user_name":"发芽的紫菜","can_delete":false,"product_type":"c1","uid":1055836,"ip_address":"","ucode":"49450F3287DF28","user_header":"https://static001.geekbang.org/account/avatar/00/10/1c/5c/f5f24221.jpg","comment_is_top":false,"comment_ctime":1550475727,"is_pvip":false,"replies":[{"id":"24238","content":"联合索引就是两个字段拼起来作索引<br><br>比如一个索引如果定义为(f1,f2),<br>在数据上，就是f1的值之后跟着f2的值。<br>查找的时候，比如执行 where f1=M and f2=N, 也是把M,N拼起来，去索引树查找","user_name":"作者回复","comment_id":68278,"uid":"1264162","ip_address":"","utype":1,"ctime":1550502196,"user_name_real":"林晓斌"}],"discussion_count":6,"race_medal":0,"score":"126104527311","product_id":100020801,"comment_content":"老师，联合索引的数据结构是怎么样的？到底是怎么存的？看了前面索引两章，还是不太懂，留言里老师说会在后面章节会讲到，但我也没看到，所以来此问一下？老师能否画图讲解一下","like_count":30,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439604,"discussion_content":"联合索引就是两个字段拼起来作索引\n\n比如一个索引如果定义为(f1,f2),\n在数据上，就是f1的值之后跟着f2的值。\n查找的时候，比如执行 where f1=M and f2=N, 也是把M,N拼起来，去索引树查找","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550502196,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1909732,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLY0FFoux40Negib6LrE7EwT3T2BUbpYzOzUeiaiaXBmNGDGVgIZr5NeWBTEeCuALOg3ODtWa21bHMgg/132","nickname":"Geek_99ae14","note":"","ucode":"268852986A6B69","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":409316,"discussion_content":"看下这个解释 https://zhuanlan.zhihu.com/p/109623980","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635417940,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1152599,"avatar":"https://static001.geekbang.org/account/avatar/00/11/96/57/397ead08.jpg","nickname":"一个米屌","note":"","ucode":"8470D3FB4456F3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":212359,"discussion_content":"不是只建第一个数据的索引吗，后面的数据存储在索引叶子中","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584964556,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1464006,"avatar":"https://static001.geekbang.org/account/avatar/00/16/56/c6/0b449bc6.jpg","nickname":"斐波那契","note":"","ucode":"85E2EBC01392B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":203346,"discussion_content":"以前碰到一个面试题 面试官问 当我创建了一个联合索引实际上mysql创建了几个索引？比如创建了联合索引(a,b,c,d) 那实际上创建了几个？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584024130,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1997293,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/79/ed/4737a49b.jpg","nickname":"雪の雫·雨の音","note":"","ucode":"0693DA3939A321","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1464006,"avatar":"https://static001.geekbang.org/account/avatar/00/16/56/c6/0b449bc6.jpg","nickname":"斐波那契","note":"","ucode":"85E2EBC01392B1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":274691,"discussion_content":"只有一棵索引树，索引树的叶子节点是按照a,b,c,d的顺序排序的","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1590604059,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":203346,"ip_address":""},"score":274691,"extra":""}]},{"author":{"id":1541014,"avatar":"https://static001.geekbang.org/account/avatar/00/17/83/96/73ff13a0.jpg","nickname":"天亮前说晚安","note":"","ucode":"1D82EE562A7C71","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":202887,"discussion_content":"不是两个字段都索引有序嘛，只是前面的字段为一段有序","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583973415,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68178,"user_name":"Leon📷","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1550454378,"is_pvip":false,"replies":[{"id":"24237","content":"对，drop是同时操作磁盘和内存，<br>delete就是我们说的不规范操作","user_name":"作者回复","comment_id":68178,"uid":"1264162","ip_address":"","utype":1,"ctime":1550502024,"user_name_real":"林晓斌"}],"discussion_count":2,"race_medal":0,"score":"126104505962","product_id":100020801,"comment_content":"老师我使用delte删除用户，再创建用户都是失败，但是使用drop就可以了<br>mysql&gt; create user &#39;ua&#39;@&#39;%&#39; identified by &#39;L1234567890c-&#39;;<br>ERROR 1396 (HY000): Operation CREATE USER failed for &#39;ua&#39;@&#39;%&#39;<br>mysql&gt; drop user &#39;ua&#39;@&#39;%&#39;;<br>Query OK, 0 rows affected (0.00 sec)<br><br>mysql&gt; create user &#39;ua&#39;@&#39;%&#39; identified by &#39;L1234567890c-&#39;;<br>Query OK, 0 rows affected (0.01 sec)<br>是不是drop才会同时从内存和磁盘删除用户信息，但是delete只是从磁盘删除","like_count":30,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439550,"discussion_content":"对，drop是同时操作磁盘和内存，\ndelete就是我们说的不规范操作","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550502024,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1476490,"avatar":"https://static001.geekbang.org/account/avatar/00/16/87/8a/07ab933c.jpg","nickname":"璀璨星空","note":"","ucode":"CE6324C4261A52","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333281,"discussion_content":"DDL DML的区别","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1607495403,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114945,"user_name":"虢國技醬","can_delete":false,"product_type":"c1","uid":1056807,"ip_address":"","ucode":"5A192262AA037E","user_header":"https://static001.geekbang.org/account/avatar/00/10/20/27/a6932fbe.jpg","comment_is_top":false,"comment_ctime":1563437135,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"74577881167","product_id":100020801,"comment_content":"老师的文章信息量(密度)很大，一般情况下得读好几遍，甚至读到头大；本篇是少有的几篇一口气读完能理解的，不容易啊 😂","like_count":18},{"had_liked":false,"id":68460,"user_name":"旭东(Frank)","can_delete":false,"product_type":"c1","uid":1024486,"ip_address":"","ucode":"176FA629800062","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a1/e6/50da1b2d.jpg","comment_is_top":false,"comment_ctime":1550502970,"is_pvip":false,"replies":[{"id":"24273","content":"没有影响<br><br>建议就是每次如果要加列都加到最后一列😆","user_name":"作者回复","comment_id":68460,"uid":"1264162","ip_address":"","utype":1,"ctime":1550539354,"user_name_real":"林晓斌"}],"discussion_count":3,"race_medal":0,"score":"53090110522","product_id":100020801,"comment_content":"老师请教一个问题：MySQL 表设计时列表顺序对MySQL性能的影响大吗？对表的列顺序有什么建议吗？","like_count":13,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439685,"discussion_content":"没有影响\n\n建议就是每次如果要加列都加到最后一列😆","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550539354,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1194853,"avatar":"https://static001.geekbang.org/account/avatar/00/12/3b/65/3a4fc8cf.jpg","nickname":"prepared","note":"","ucode":"00E54A5C7CDCBE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339557,"discussion_content":"“建议就是每次如果要加列都加到最后一列”，为什么呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609731216,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1887586,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLhicDSmL4vicPADhxxzOzukMar8nV5Tc3ic2dz4FQIxMX3WmX5a2V3sdD121eWpvfQI8NXIkkDZoDFw/132","nickname":"Geek_536b54","note":"","ucode":"F62BC7781D9212","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1194853,"avatar":"https://static001.geekbang.org/account/avatar/00/12/3b/65/3a4fc8cf.jpg","nickname":"prepared","note":"","ucode":"00E54A5C7CDCBE","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344792,"discussion_content":"因为主从同步的时候 最后一列没有值也没关系 ，如果插入中间 会sql报错","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1611572390,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":339557,"ip_address":""},"score":344792,"extra":""}]}]},{"had_liked":false,"id":68297,"user_name":"夜空中最亮的星","can_delete":false,"product_type":"c1","uid":1267566,"ip_address":"","ucode":"ADC3E7B6789955","user_header":"https://static001.geekbang.org/account/avatar/00/13/57/6e/b6795c44.jpg","comment_is_top":false,"comment_ctime":1550480102,"is_pvip":false,"replies":[{"id":"24269","content":"👍","user_name":"作者回复","comment_id":68297,"uid":"1264162","ip_address":"","utype":1,"ctime":1550539042,"user_name_real":"林晓斌"}],"discussion_count":2,"race_medal":0,"score":"44500153062","product_id":100020801,"comment_content":"通过老师的讲解 flush privileges 这回彻底懂了，高兴😃","like_count":10,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439616,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550539042,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1624590,"avatar":"https://static001.geekbang.org/account/avatar/00/18/ca/0e/5009c5ff.jpg","nickname":"遇见","note":"","ucode":"FAF53CD4C28494","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":83985,"discussion_content":"也确实是 flush ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576478246,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":84436,"user_name":"冰点18","can_delete":false,"product_type":"c1","uid":1112370,"ip_address":"","ucode":"0BD9DBE5D3242E","user_header":"https://static001.geekbang.org/account/avatar/00/10/f9/32/8ced1824.jpg","comment_is_top":false,"comment_ctime":1554862137,"is_pvip":false,"replies":[{"id":"30750","content":"ipad 上的pencil ，是编辑小姐姐画的哈，我画的是矩形的图😅","user_name":"作者回复","comment_id":84436,"uid":"1264162","ip_address":"","utype":1,"ctime":1555147376,"user_name_real":"林晓斌"}],"discussion_count":1,"race_medal":0,"score":"35914600505","product_id":100020801,"comment_content":"两三个月的时间，终于在上班地铁上读完了整部专栏，老师辛苦了！接下来就是搭建环境，二刷和验证了！一直有个问题，想问下老师，您用的画图工具是哪个？风格我特别喜欢，但是没找到","like_count":9,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446359,"discussion_content":"ipad 上的pencil ，是编辑小姐姐画的哈，我画的是矩形的图😅","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555147376,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68464,"user_name":"XD","can_delete":false,"product_type":"c1","uid":1079293,"ip_address":"","ucode":"DC9DCFB3841A4E","user_header":"https://static001.geekbang.org/account/avatar/00/10/77/fd/c6619535.jpg","comment_is_top":false,"comment_ctime":1550503721,"is_pvip":false,"replies":[{"id":"24404","content":"你说的对，我刚翻代码确认了下，确实是特别对“当前db”有一个放过的逻辑。<br><br>多谢指正。我勘误下。","user_name":"作者回复","comment_id":68464,"uid":"1264162","ip_address":"","utype":1,"ctime":1550582089,"user_name_real":"林晓斌"}],"discussion_count":1,"race_medal":0,"score":"35910242089","product_id":100020801,"comment_content":"老师，我刚说的是acl_db，是在db切换的时候，从acl_dbs拷贝到线程内部的？类似acl_user。<br><br>session a<br>drop user &#39;test&#39;@&#39;%&#39;;<br>create user &#39;test&#39;@&#39;%&#39; identified by &#39;123456&#39;;<br>grant SELECT,UPDATE on gt.* to &#39;test&#39;@&#39;%&#39;;<br><br>session b   使用test登录<br>use gt;<br><br>session a<br>revoke SELECT,UPDATE on gt.* from &#39;test&#39;@&#39;%&#39;;<br><br>session b<br>show databases;  &#47;&#47;只能看到information_schema库<br>use gt;   &#47;&#47; Access denied for user &#39;test&#39;@&#39;%&#39; to database &#39;gt&#39;<br>show tables;   &#47;&#47;可以看到gt库中所有的表<br>select&#47;update  &#47;&#47;操作都正常","like_count":9,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439688,"discussion_content":"你说的对，我刚翻代码确认了下，确实是特别对“当前db”有一个放过的逻辑。\n\n多谢指正。我勘误下。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550582089,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68306,"user_name":"夹心面包","can_delete":false,"product_type":"c1","uid":1301957,"ip_address":"","ucode":"002BBA49D83D17","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJCscgdVibmoPyRLRaicvk6rjTJxePZ6VFHvGjUQvtfhCS6kO4OZ1AVibbhNGKlWZmpEFf2yA6ptsqHw/132","comment_is_top":false,"comment_ctime":1550480991,"is_pvip":false,"replies":[{"id":"24306","content":"是的，MySQL还支持 % 赋权，%表示匹配任意字符串，<br>比如<br>grant all privileges on `db%`.* to ... 表示所有以db为前缀的库。<br><br>不过。。。我比较不建议这么用😅","user_name":"作者回复","comment_id":68306,"uid":"1264162","ip_address":"","utype":1,"ctime":1550543584,"user_name_real":"林晓斌"}],"discussion_count":2,"race_medal":0,"score":"31615252063","product_id":100020801,"comment_content":"我在此分享一个授权库的小技巧, 如果需要授权多个库,库名还有规律,比如 db_201701 db_201702<br>可以采用正则匹配写一条 grant  on db______,每一个_代表一个字符.这样避免了多次授权,简化了过程。我们线上已经采用","like_count":7,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439620,"discussion_content":"是的，MySQL还支持 % 赋权，%表示匹配任意字符串，\n比如\ngrant all privileges on `db%`.* to ... 表示所有以db为前缀的库。\n\n不过。。。我比较不建议这么用😅","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550543584,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1285652,"avatar":"","nickname":"mycat","note":"","ucode":"6878BD32D042F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":327424,"discussion_content":"db%前后的反引号不可以省略，省略后不生效。\n这种授权方式适用于多租户的场景。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605835664,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":107808,"user_name":"业余草","can_delete":false,"product_type":"c1","uid":1126538,"ip_address":"","ucode":"99BDC1E629049D","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/8a/b5ca7286.jpg","comment_is_top":false,"comment_ctime":1561614552,"is_pvip":false,"replies":[{"id":"39546","content":"认真看了这篇文章，我有点疑惑哦<br><br>“这招够狠。重启在程序员届的杀招被他接上了。但是，重启失灵了，重启后，已有的连接还是没权限。具体的表现是，备库上的复制连接还是未权限。”<br>主库重启的话，备库的连接也是重新创建的<br><br>如果“重启无效”而“kill连接有效”，那不太合理哦<br><br>","user_name":"作者回复","comment_id":107808,"uid":"1264162","ip_address":"","utype":1,"ctime":1561983791,"user_name_real":"林晓斌"}],"discussion_count":2,"race_medal":0,"score":"18741483736","product_id":100020801,"comment_content":"从学习中来，到实战中去！做了一个总结，可能写的不对，希望老师指点。https:&#47;&#47;mp.weixin.qq.com&#47;s&#47;7KGQGpm0IGaVjco6UjLeAQ","like_count":4,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455682,"discussion_content":"认真看了这篇文章，我有点疑惑哦\n\n“这招够狠。重启在程序员届的杀招被他接上了。但是，重启失灵了，重启后，已有的连接还是没权限。具体的表现是，备库上的复制连接还是未权限。”\n主库重启的话，备库的连接也是重新创建的\n\n如果“重启无效”而“kill连接有效”，那不太合理哦\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561983791,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2419120,"avatar":"https://static001.geekbang.org/account/avatar/00/24/e9/b0/43c00943.jpg","nickname":"人人有功练","note":"","ucode":"5B4DC86867B14D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351259,"discussion_content":"哈哈哈  好玩","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614218343,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":202739,"user_name":"一步","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1586061017,"is_pvip":true,"discussion_count":4,"race_medal":1,"score":"14470962905","product_id":100020801,"comment_content":"为什么执行 grant 赋权的命令时，后面还要加上 with grant option 呢？ 试了一下不加也是可以的","like_count":4,"discussions":[{"author":{"id":1285652,"avatar":"","nickname":"mycat","note":"","ucode":"6878BD32D042F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":327428,"discussion_content":"这个with grant option的意思是允许这个被授权的用户，把他所具有的权限再授予其他用户。没有这个关键词，则这个被授权的用户只能自己有用当前赋予他的权限。他不能把他的权限再复制给其他用户。","likes_number":12,"is_delete":false,"is_hidden":false,"ctime":1605836236,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2166073,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","nickname":"戒酒的李白","note":"","ucode":"744E1A22761647","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1285652,"avatar":"","nickname":"mycat","note":"","ucode":"6878BD32D042F2","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372988,"discussion_content":"学到了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620557077,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":327428,"ip_address":""},"score":372988,"extra":""}]},{"author":{"id":1786819,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/43/c3/2c53acd7.jpg","nickname":"雄鹰","note":"","ucode":"67E0C4BDE7F6F2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302634,"discussion_content":"其实我一直也有这个疑问，前面的all 不是已经包括了grant权限了吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598974532,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1167324,"avatar":"https://static001.geekbang.org/account/avatar/00/11/cf/dc/f119f657.jpg","nickname":"0ck0","note":"","ucode":"6DCD6ECE7B9BF0","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1786819,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/43/c3/2c53acd7.jpg","nickname":"雄鹰","note":"","ucode":"67E0C4BDE7F6F2","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":555720,"discussion_content":"all 不包括","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647047779,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":302634,"ip_address":""},"score":555720,"extra":""}]}]},{"had_liked":false,"id":184650,"user_name":"不负青春不负己🤘","can_delete":false,"product_type":"c1","uid":1363671,"ip_address":"","ucode":"A6DD8E8B20EA6E","user_header":"https://static001.geekbang.org/account/avatar/00/14/ce/d7/5315f6ce.jpg","comment_is_top":false,"comment_ctime":1583377558,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"14468279446","product_id":100020801,"comment_content":"我以前一直以为新增加的授权，只针对新的连接生效，对于已存在的权限，不生效，现在是对于某个用户授予全局的权限，对于已存在的连接不生效，对于 db,table 相关的权限是对于已存在的连接和新的连接都是立即生效","like_count":4},{"had_liked":false,"id":122109,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1565305787,"is_pvip":false,"replies":[{"id":"44881","content":"👍","user_name":"作者回复","comment_id":122109,"uid":"1264162","ip_address":"","utype":1,"ctime":1565319757,"user_name_real":"林晓斌"}],"discussion_count":1,"race_medal":0,"score":"14450207675","product_id":100020801,"comment_content":"这篇容易消化，老师辛苦，你不讲这个，我想我很难发现这个细节，业务开发增删改查用的多，其他命令平时不咋用。<br>多玩才能发现更多好玩的，如果能有几个老师这样的朋友一起玩，那该有多好玩。","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462103,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565319757,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68195,"user_name":"Sinyo","can_delete":false,"product_type":"c1","uid":1307297,"ip_address":"","ucode":"57B243E7AB86A5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJAibnPX9jW8kqLcIfibjic8GbkQkEUYyFKJkc39hZhibVlNrqwTjdLozkqibI2IwACd5YzofYickNxFnZg/132","comment_is_top":false,"comment_ctime":1550455630,"is_pvip":false,"replies":[{"id":"24140","content":"👍<br><br><br>这第二个写法跟：<br>select order_key ,createtime FROM aaa force index(createtime) group by order_key<br> 的逻辑语义相同吗？<br>","user_name":"作者回复","comment_id":68195,"uid":"1264162","ip_address":"","utype":1,"ctime":1550462244,"user_name_real":"林晓斌"}],"discussion_count":2,"race_medal":0,"score":"14435357518","product_id":100020801,"comment_content":"查一张大表，order_key字段值对应的最小createtime；<br>以前一直用方法一查数，后来同事说可以优化成方法二，查询效率比方法一高了几倍；<br>mysql特有的group by功能，没有group by的字段默认取查到的第一条记录；<br><br>方法一：<br>select distinct order_key<br>      ,createtime<br>  from (select order_key<br>              ,min(createtime) createtime<br>          from aaa<br>         group by order_key) a<br>  join aaa b<br>    on a.order_key = b.order_key<br>   and a.createtime = b.createtime<br><br>方法二：<br>select order_key<br>      ,createtime<br>  from (select order_key<br>              ,createtime<br>          FROM aaa<br>         order by createtime<br>       ) a<br> group by order_key","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439558,"discussion_content":"👍\n\n\n这第二个写法跟：\nselect order_key ,createtime FROM aaa force index(createtime) group by order_key\n 的逻辑语义相同吗？\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550462244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1526355,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","nickname":"moonfox","note":"","ucode":"902BFF40EFA9FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335922,"discussion_content":"作者的方案感觉把方法2，给优化了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608386063,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296550,"user_name":"张诚","can_delete":false,"product_type":"c1","uid":1115702,"ip_address":"","ucode":"F623703194769B","user_header":"https://static001.geekbang.org/account/avatar/00/11/06/36/d288bcc7.jpg","comment_is_top":false,"comment_ctime":1623038928,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5918006224","product_id":100020801,"comment_content":"老师，我有一个问题。在我们的程序中，往往会用到数据库连接池。在修改mysql一些全局配置时，往往只会对后续新建立的连接才生效。但是数据库连接池中那种老的连接就会一直是原来的配置。<br>这种情况我们是必须重启应用才行吗？<br>还有能大概说一下修改配置，只对后续新增的连接生效的配置的例子吗？<br>类似修改全局的事务隔离级别，sql_mode的参数好像也是","like_count":2},{"had_liked":false,"id":69055,"user_name":"萤火虫","can_delete":false,"product_type":"c1","uid":1333142,"ip_address":"","ucode":"FA4AB9636C53C4","user_header":"https://static001.geekbang.org/account/avatar/00/14/57/96/b65bdf43.jpg","comment_is_top":false,"comment_ctime":1550652760,"is_pvip":false,"replies":[{"id":"24492","content":"👍<br>是真爱","user_name":"作者回复","comment_id":69055,"uid":"1264162","ip_address":"","utype":1,"ctime":1550659480,"user_name_real":"林晓斌"}],"discussion_count":1,"race_medal":0,"score":"5845620056","product_id":100020801,"comment_content":"坚持到最后 为老师打call","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439934,"discussion_content":"👍\n是真爱","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550659480,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68591,"user_name":"舜","can_delete":false,"product_type":"c1","uid":1221029,"ip_address":"","ucode":"F5778B1F9290FD","user_header":"https://static001.geekbang.org/account/avatar/00/12/a1/a5/2100367c.jpg","comment_is_top":false,"comment_ctime":1550552308,"is_pvip":false,"replies":[{"id":"24357","content":"37篇讲了group by的，你看下<br><br>还有问再提出来😆","user_name":"作者回复","comment_id":68591,"uid":"1264162","ip_address":"","utype":1,"ctime":1550561961,"user_name_real":"林晓斌"}],"discussion_count":1,"race_medal":0,"score":"5845519604","product_id":100020801,"comment_content":"老师，介绍完了order by后能不能继续介绍下group by的原理？等了好久了，一直想继续在order by基础上理解下group by，在使用过程中两者在索引利用上很相近，性能考虑也类似","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439742,"discussion_content":"37篇讲了group by的，你看下\n\n还有问再提出来😆","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550561961,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68147,"user_name":"爸爸回来了","can_delete":false,"product_type":"c1","uid":1305016,"ip_address":"","ucode":"30B8C927C04D66","user_header":"","comment_is_top":false,"comment_ctime":1550448721,"is_pvip":false,"replies":[{"id":"24131","content":"😆你说的是参数的名字，还是参数的值？<br>","user_name":"作者回复","comment_id":68147,"uid":"1264162","ip_address":"","utype":1,"ctime":1550452608,"user_name_real":"林晓斌"}],"discussion_count":1,"race_medal":0,"score":"5845416017","product_id":100020801,"comment_content":"众所周知，sql是不区分大小写的。然而，涉及插件的变量却不是这样；上次在配置一个插件的参数的时候，苦思良久……最后发现了这个问题。难受😭","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439536,"discussion_content":"😆你说的是参数的名字，还是参数的值？\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550452608,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332015,"user_name":"PRETEXT","can_delete":false,"product_type":"c1","uid":2438545,"ip_address":"","ucode":"BBA18231EE4EDA","user_header":"https://static001.geekbang.org/account/avatar/00/25/35/91/d523a803.jpg","comment_is_top":false,"comment_ctime":1642985079,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1642985079","product_id":100020801,"comment_content":"貌似修改用户密码需要flushprivilege,新链接才可以用新密码链接","like_count":0},{"had_liked":false,"id":289274,"user_name":"giteebravo","can_delete":false,"product_type":"c1","uid":1005290,"ip_address":"","ucode":"C087E8D6B5A98B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/56/ea/32608c44.jpg","comment_is_top":false,"comment_ctime":1618965655,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1618965655","product_id":100020801,"comment_content":"<br>面对一个数据库，怎么发现有这类不规范的权限操作存在呢？<br>","like_count":0},{"had_liked":false,"id":275547,"user_name":"老K","can_delete":false,"product_type":"c1","uid":1144458,"ip_address":"","ucode":"B9ED8A82942D1D","user_header":"https://static001.geekbang.org/account/avatar/00/11/76/8a/74cf038a.jpg","comment_is_top":false,"comment_ctime":1611580329,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1611580329","product_id":100020801,"comment_content":"实测了一把：<br>连接A：<br>CREATE USER &#39;tester&#39; @&#39;%&#39; IDENTIFIED BY &#39;pa&#39;;<br><br>连接B：<br>使用 tester 登录正常连接<br><br>随后在连接A里面执行：<br>REVOKE ALL PRIVILEGES ON *.* <br>FROM<br>\t&#39;tester&#39; @&#39;%&#39;;<br><br>flush PRIVILEGES;<br><br>无论怎么着都可以使用 tester连接上来，这是怎么了？让人凌乱<br>只有 service mysql restart 方可生效.<br>MySQL 版本：5.5.6<br>使用的 Navicat 客户端","like_count":1,"discussions":[{"author":{"id":2723576,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epxppZUun6eqepI5hGHjU3fP8yVIicUq7gYRZfR3PoDCMQqd2ia8CmCSa1mIIf6OYGFjbW28RCXmrJQ/132","nickname":"Geek_aef4be","note":"","ucode":"F1C3F2AE3CCA0F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585189,"discussion_content":"你是不是还有一个tester@ip的用户，tester@%是两个不同的用户咯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661391918,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"江苏"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":186924,"user_name":"天亮前说晚安","can_delete":false,"product_type":"c1","uid":1541014,"ip_address":"","ucode":"1D82EE562A7C71","user_header":"https://static001.geekbang.org/account/avatar/00/17/83/96/73ff13a0.jpg","comment_is_top":false,"comment_ctime":1583974027,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583974027","product_id":100020801,"comment_content":"线程内的权限是不是没法刷新的啊？因为flush只是同步内存中全局权限数组的值。","like_count":0},{"had_liked":false,"id":148470,"user_name":"AlphaLiu","can_delete":false,"product_type":"c1","uid":1127786,"ip_address":"","ucode":"B75A4C82E7DC03","user_header":"https://static001.geekbang.org/account/avatar/00/11/35/6a/8ab55564.jpg","comment_is_top":false,"comment_ctime":1573013038,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573013038","product_id":100020801,"comment_content":"在生产库进行全量备份：<br>mysqldump -uroot -p654321 --all-databases &gt; alldatabases.sql<br>在本地库恢复：<br>mysql -uroot -p123456 &lt; alldatabases.sql<br>恢复后，还是能使用mysql -uroot -p123456登录，<br>而mysql -uroot -p654321，不能登录。<br>必须flush privileges或者systemctl restart mysqld.service后，<br>恢复后的root密码才能生效。<br>请教下老师，这是什么原因？","like_count":0},{"had_liked":false,"id":112484,"user_name":"朝伟","can_delete":false,"product_type":"c1","uid":1154580,"ip_address":"","ucode":"C804ACEB176D5E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/8Zs7gEMVq90uejXZMvA409gcln7d9TJgvOW5GQPSfSN0eOTgibhmyKvWltOrtRxdODXGl9zg1eUbAAfliaTicUKqQ/132","comment_is_top":false,"comment_ctime":1562744224,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562744224","product_id":100020801,"comment_content":"全局权限、对于一个已经存在的连接，它的全局权限不受 grant 命令的影响。那如果我要更新已建立连接的权限、怎么办、难道必须重新建立连接才能生效吗？","like_count":0},{"had_liked":false,"id":112409,"user_name":"William","can_delete":false,"product_type":"c1","uid":1346215,"ip_address":"","ucode":"55F5D9DEE485B1","user_header":"https://static001.geekbang.org/account/avatar/00/14/8a/a7/674c1864.jpg","comment_is_top":false,"comment_ctime":1562729359,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1562729359","product_id":100020801,"comment_content":"从文中了解到, flush privileges 实际上就是保证磁盘与内存的数据一致性.<br>如果一致,那么无需执行(执行了也没关系, 但是属于画蛇添足), <br>但是不一致, 就需要执行..<br><br><br>全局的权限修改, 不影响当前已有线程, 新线程建立采用新的权限.<br>而对于db 表 列 的 权限 操作, 实时生效. ","like_count":0},{"had_liked":false,"id":68748,"user_name":"wljs","can_delete":false,"product_type":"c1","uid":1306543,"ip_address":"","ucode":"6B88A664972AD2","user_header":"https://static001.geekbang.org/account/avatar/00/13/ef/af/ba786593.jpg","comment_is_top":false,"comment_ctime":1550591494,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1550591494","product_id":100020801,"comment_content":"老师我想问个问题 我们公司一个订单表有110个字段 想拆分成两个表 第一个表放经常查的字段 第二个表放不常查的 现在程序端不想改sql，数据库端来实现 当查询字段中 第一个表不存在 就去关联第二个表查出数据  db能实现不？","like_count":0},{"had_liked":false,"id":68435,"user_name":"XD","can_delete":false,"product_type":"c1","uid":1079293,"ip_address":"","ucode":"DC9DCFB3841A4E","user_header":"https://static001.geekbang.org/account/avatar/00/10/77/fd/c6619535.jpg","comment_is_top":false,"comment_ctime":1550499933,"is_pvip":false,"replies":[{"id":"24234","content":"acl_dbs是全局数组<br><br>把你使用sql语句，和语句序列发一下哦<br><br>类似按照时间顺序<br>session a：<br>  xxx<br>  xxx<br>session b:<br>   xxxx<br>session a:<br>   xxxx<br>这样","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1550501963,"ip_address":"","comment_id":68435,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550499933","product_id":100020801,"comment_content":"老师，实际测试了下。<br>两个会话ab，登陆账号都为user。a中给user授予db1的select、update权限，b切换到db1，可以正常增改。然后a中回收该用户的db权限，b会话中的用户还是可以进行增改操作的。<br>我发现用户的db权限好像是在切换数据库的时候刷新的，只要不切换，grant操作并不会产生作用，所以acl_db是否也是维护在线程内部的呢？<br><br>以及，权限检验应该是在优化器的语义分析里进行的吧？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439672,"discussion_content":"acl_dbs是全局数组\n\n把你使用sql语句，和语句序列发一下哦\n\n类似按照时间顺序\nsession a：\n  xxx\n  xxx\nsession b:\n   xxxx\nsession a:\n   xxxx\n这样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550501963,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68203,"user_name":"晨思暮语","can_delete":false,"product_type":"c1","uid":1304974,"ip_address":"","ucode":"F21D2FDCDD6B43","user_header":"https://static001.geekbang.org/account/avatar/00/13/e9/8e/6dc15a91.jpg","comment_is_top":false,"comment_ctime":1550456883,"is_pvip":false,"replies":[{"id":"25256","content":"这个跟binlog_format有关。<br><br>如果binlog_format=row,  那么最后session A的select查到的是2；<br>如果binlog_format=statement,  那么最后session A的select查到的是3；<br><br>我们在文章里面有做了说明了，这个逻辑是依赖于“MySQL在执行update语句的时候，有没有把字段c也读进来”，<br>","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1551182661,"ip_address":"","comment_id":68203,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1550456883","product_id":100020801,"comment_content":"丁老师,您好：<br>关于上一章我留言的疑问,我重新整理了下。就是第十五章中老师留的思考题。<br>我模拟了老师的实验,结果有点出入,请老师帮忙看看，谢谢！<br>基础环境:<br>mysql&gt; select version();<br>+------------+<br>| version()  |<br>+------------+<br>| 5.7.22-log |<br>+------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; show variables like &#39;%tx%&#39;;<br>+---------------+-----------------+<br>| Variable_name | Value           |<br>+---------------+-----------------+<br>| tx_isolation  | REPEATABLE-READ |<br>| tx_read_only  | OFF             |<br>+---------------+-----------------+<br>2 rows in set (0.00 sec)<br>模拟实验:<br>session A:\t                                         <br>mysql&gt; begin;\t<br>mysql&gt; select * from t;\t<br>+----+------+\t<br>| id | a    |\t<br>+----+------+\t<br>|  1 |    2 |\t<br>+----+------+\t<br>1 row in set (0.00 sec)\t<br><br>session B:                                          <br>mysql&gt; update t set a=3 where id=1;      <br>Query OK, 1 row affected (0.00 sec)      <br>Rows matched: 1  Changed: 1  Warnings: 0 \t                                                  <br><br>SESSION A:                                                 <br>mysql&gt;  update t set a=3 where id=1;\t<br>Query OK, 0 rows affected (0.00 sec)\t<br>Rows matched: 1  Changed: 0  Warnings: 0\t<br>&#47;*老师的实验显示为：1 rows affected*&#47;\t<br>mysql&gt; select * from t where id=1;\t<br>+----+------+\t<br>| id | a    |\t<br>+----+------+\t<br>|  1 |    2 |\t<br>+----+------+\t<br>1 row in set (0.00 sec)\t<br>&#47;*老师实验的查询结果为：1,3\t*&#47;","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439564,"discussion_content":"这个跟binlog_format有关。\n\n如果binlog_format=row,  那么最后session A的select查到的是2；\n如果binlog_format=statement,  那么最后session A的select查到的是3；\n\n我们在文章里面有做了说明了，这个逻辑是依赖于“MySQL在执行update语句的时候，有没有把字段c也读进来”，\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551182661,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1148537,"avatar":"https://static001.geekbang.org/account/avatar/00/11/86/79/28fcafa6.jpg","nickname":"胡红伟","note":"","ucode":"33F12A97311F63","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":281719,"discussion_content":"我做了实验发现，无论rr还是rc，row还是statement，都不会真正去修改内存数据页，但会持有行锁。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591797673,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}