{"id":92245,"title":"25 | CompletionServiceï¼šå¦‚ä½•æ‰¹é‡æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Ÿ","content":"<p>åœ¨<a href=\"https://time.geekbang.org/column/article/91292\">ã€Š23 | Futureï¼šå¦‚ä½•ç”¨å¤šçº¿ç¨‹å®ç°æœ€ä¼˜çš„â€œçƒ§æ°´æ³¡èŒ¶â€ç¨‹åºï¼Ÿã€‹</a>çš„æœ€åï¼Œæˆ‘ç»™ä½ ç•™äº†é“æ€è€ƒé¢˜ï¼Œå¦‚ä½•ä¼˜åŒ–ä¸€ä¸ªè¯¢ä»·åº”ç”¨çš„æ ¸å¿ƒä»£ç ï¼Ÿå¦‚æœé‡‡ç”¨â€œThreadPoolExecutor+Futureâ€çš„æ–¹æ¡ˆï¼Œä½ çš„ä¼˜åŒ–ç»“æœå¾ˆå¯èƒ½æ˜¯ä¸‹é¢ç¤ºä¾‹ä»£ç è¿™æ ·ï¼šç”¨ä¸‰ä¸ªçº¿ç¨‹å¼‚æ­¥æ‰§è¡Œè¯¢ä»·ï¼Œé€šè¿‡ä¸‰æ¬¡è°ƒç”¨Futureçš„get()æ–¹æ³•è·å–è¯¢ä»·ç»“æœï¼Œä¹‹åå°†è¯¢ä»·ç»“æœä¿å­˜åœ¨æ•°æ®åº“ä¸­ã€‚</p><pre><code>// åˆ›å»ºçº¿ç¨‹æ± \nExecutorService executor =\n  Executors.newFixedThreadPool(3);\n// å¼‚æ­¥å‘ç”µå•†S1è¯¢ä»·\nFuture&lt;Integer&gt; f1 = \n  executor.submit(\n    ()-&gt;getPriceByS1());\n// å¼‚æ­¥å‘ç”µå•†S2è¯¢ä»·\nFuture&lt;Integer&gt; f2 = \n  executor.submit(\n    ()-&gt;getPriceByS2());\n// å¼‚æ­¥å‘ç”µå•†S3è¯¢ä»·\nFuture&lt;Integer&gt; f3 = \n  executor.submit(\n    ()-&gt;getPriceByS3());\n    \n// è·å–ç”µå•†S1æŠ¥ä»·å¹¶ä¿å­˜\nr=f1.get();\nexecutor.execute(()-&gt;save(r));\n  \n// è·å–ç”µå•†S2æŠ¥ä»·å¹¶ä¿å­˜\nr=f2.get();\nexecutor.execute(()-&gt;save(r));\n  \n// è·å–ç”µå•†S3æŠ¥ä»·å¹¶ä¿å­˜  \nr=f3.get();\nexecutor.execute(()-&gt;save(r));\n\n</code></pre><p>ä¸Šé¢çš„è¿™ä¸ªæ–¹æ¡ˆæœ¬èº«æ²¡æœ‰å¤ªå¤§é—®é¢˜ï¼Œä½†æ˜¯æœ‰ä¸ªåœ°æ–¹çš„å¤„ç†éœ€è¦ä½ æ³¨æ„ï¼Œé‚£å°±æ˜¯å¦‚æœè·å–ç”µå•†S1æŠ¥ä»·çš„è€—æ—¶å¾ˆé•¿ï¼Œé‚£ä¹ˆå³ä¾¿è·å–ç”µå•†S2æŠ¥ä»·çš„è€—æ—¶å¾ˆçŸ­ï¼Œä¹Ÿæ— æ³•è®©ä¿å­˜S2æŠ¥ä»·çš„æ“ä½œå…ˆæ‰§è¡Œï¼Œå› ä¸ºè¿™ä¸ªä¸»çº¿ç¨‹éƒ½é˜»å¡åœ¨äº† <code>f1.get()</code> æ“ä½œä¸Šã€‚è¿™ç‚¹å°ç‘•ç–µä½ è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p><p>ä¼°è®¡ä½ å·²ç»æƒ³åˆ°äº†ï¼Œå¢åŠ ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ï¼Œè·å–åˆ°S1ã€S2ã€S3çš„æŠ¥ä»·éƒ½è¿›å…¥é˜»å¡é˜Ÿåˆ—ï¼Œç„¶ååœ¨ä¸»çº¿ç¨‹ä¸­æ¶ˆè´¹é˜»å¡é˜Ÿåˆ—ï¼Œè¿™æ ·å°±èƒ½ä¿è¯å…ˆè·å–åˆ°çš„æŠ¥ä»·å…ˆä¿å­˜åˆ°æ•°æ®åº“äº†ã€‚ä¸‹é¢çš„ç¤ºä¾‹ä»£ç å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨é˜»å¡é˜Ÿåˆ—å®ç°å…ˆè·å–åˆ°çš„æŠ¥ä»·å…ˆä¿å­˜åˆ°æ•°æ®åº“ã€‚</p><pre><code>// åˆ›å»ºé˜»å¡é˜Ÿåˆ—\nBlockingQueue&lt;Integer&gt; bq =\n  new LinkedBlockingQueue&lt;&gt;();\n//ç”µå•†S1æŠ¥ä»·å¼‚æ­¥è¿›å…¥é˜»å¡é˜Ÿåˆ—  \nexecutor.execute(()-&gt;\n  bq.put(f1.get()));\n//ç”µå•†S2æŠ¥ä»·å¼‚æ­¥è¿›å…¥é˜»å¡é˜Ÿåˆ—  \nexecutor.execute(()-&gt;\n  bq.put(f2.get()));\n//ç”µå•†S3æŠ¥ä»·å¼‚æ­¥è¿›å…¥é˜»å¡é˜Ÿåˆ—  \nexecutor.execute(()-&gt;\n  bq.put(f3.get()));\n//å¼‚æ­¥ä¿å­˜æ‰€æœ‰æŠ¥ä»·  \nfor (int i=0; i&lt;3; i++) {\n  Integer r = bq.take();\n  executor.execute(()-&gt;save(r));\n}  \n</code></pre><h2>åˆ©ç”¨CompletionServiceå®ç°è¯¢ä»·ç³»ç»Ÿ</h2><p>ä¸è¿‡åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¹¶ä¸å»ºè®®ä½ è¿™æ ·åšï¼Œå› ä¸ºJava SDKå¹¶å‘åŒ…é‡Œå·²ç»æä¾›äº†è®¾è®¡ç²¾è‰¯çš„CompletionServiceã€‚åˆ©ç”¨CompletionServiceä¸ä½†èƒ½å¸®ä½ è§£å†³å…ˆè·å–åˆ°çš„æŠ¥ä»·å…ˆä¿å­˜åˆ°æ•°æ®åº“çš„é—®é¢˜ï¼Œè€Œä¸”è¿˜èƒ½è®©ä»£ç æ›´ç®€ç»ƒã€‚</p><!-- [[[read_end]]] --><p>CompletionServiceçš„å®ç°åŸç†ä¹Ÿæ˜¯å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ï¼Œå½“ä»»åŠ¡æ‰§è¡Œç»“æŸå°±æŠŠä»»åŠ¡çš„æ‰§è¡Œç»“æœåŠ å…¥åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œä¸åŒçš„æ˜¯CompletionServiceæ˜¯æŠŠä»»åŠ¡æ‰§è¡Œç»“æœçš„Futureå¯¹è±¡åŠ å…¥åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œè€Œä¸Šé¢çš„ç¤ºä¾‹ä»£ç æ˜¯æŠŠä»»åŠ¡æœ€ç»ˆçš„æ‰§è¡Œç»“æœæ”¾å…¥äº†é˜»å¡é˜Ÿåˆ—ä¸­ã€‚</p><p><strong>é‚£åˆ°åº•è¯¥å¦‚ä½•åˆ›å»ºCompletionServiceå‘¢ï¼Ÿ</strong></p><p>CompletionServiceæ¥å£çš„å®ç°ç±»æ˜¯ExecutorCompletionServiceï¼Œè¿™ä¸ªå®ç°ç±»çš„æ„é€ æ–¹æ³•æœ‰ä¸¤ä¸ªï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ol>\n<li><code>ExecutorCompletionService(Executor executor)</code>ï¼›</li>\n<li><code>ExecutorCompletionService(Executor executor, BlockingQueue&lt;Future&lt;V&gt;&gt; completionQueue)</code>ã€‚</li>\n</ol><p>è¿™ä¸¤ä¸ªæ„é€ æ–¹æ³•éƒ½éœ€è¦ä¼ å…¥ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå¦‚æœä¸æŒ‡å®šcompletionQueueï¼Œé‚£ä¹ˆé»˜è®¤ä¼šä½¿ç”¨æ— ç•Œçš„LinkedBlockingQueueã€‚ä»»åŠ¡æ‰§è¡Œç»“æœçš„Futureå¯¹è±¡å°±æ˜¯åŠ å…¥åˆ°completionQueueä¸­ã€‚</p><p>ä¸‹é¢çš„ç¤ºä¾‹ä»£ç å®Œæ•´åœ°å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨CompletionServiceæ¥å®ç°é«˜æ€§èƒ½çš„è¯¢ä»·ç³»ç»Ÿã€‚å…¶ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰æŒ‡å®šcompletionQueueï¼Œå› æ­¤é»˜è®¤ä½¿ç”¨æ— ç•Œçš„LinkedBlockingQueueã€‚ä¹‹åé€šè¿‡CompletionServiceæ¥å£æä¾›çš„submit()æ–¹æ³•æäº¤äº†ä¸‰ä¸ªè¯¢ä»·æ“ä½œï¼Œè¿™ä¸‰ä¸ªè¯¢ä»·æ“ä½œå°†ä¼šè¢«CompletionServiceå¼‚æ­¥æ‰§è¡Œã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡CompletionServiceæ¥å£æä¾›çš„take()æ–¹æ³•è·å–ä¸€ä¸ªFutureå¯¹è±¡ï¼ˆå‰é¢æˆ‘ä»¬æåˆ°è¿‡ï¼ŒåŠ å…¥åˆ°é˜»å¡é˜Ÿåˆ—ä¸­çš„æ˜¯ä»»åŠ¡æ‰§è¡Œç»“æœçš„Futureå¯¹è±¡ï¼‰ï¼Œè°ƒç”¨Futureå¯¹è±¡çš„get()æ–¹æ³•å°±èƒ½è¿”å›è¯¢ä»·æ“ä½œçš„æ‰§è¡Œç»“æœäº†ã€‚</p><pre><code>// åˆ›å»ºçº¿ç¨‹æ± \nExecutorService executor = \n  Executors.newFixedThreadPool(3);\n// åˆ›å»ºCompletionService\nCompletionService&lt;Integer&gt; cs = new \n  ExecutorCompletionService&lt;&gt;(executor);\n// å¼‚æ­¥å‘ç”µå•†S1è¯¢ä»·\ncs.submit(()-&gt;getPriceByS1());\n// å¼‚æ­¥å‘ç”µå•†S2è¯¢ä»·\ncs.submit(()-&gt;getPriceByS2());\n// å¼‚æ­¥å‘ç”µå•†S3è¯¢ä»·\ncs.submit(()-&gt;getPriceByS3());\n// å°†è¯¢ä»·ç»“æœå¼‚æ­¥ä¿å­˜åˆ°æ•°æ®åº“\nfor (int i=0; i&lt;3; i++) {\n  Integer r = cs.take().get();\n  executor.execute(()-&gt;save(r));\n}\n</code></pre><h2>CompletionServiceæ¥å£è¯´æ˜</h2><p>ä¸‹é¢æˆ‘ä»¬è¯¦ç»†åœ°ä»‹ç»ä¸€ä¸‹CompletionServiceæ¥å£æä¾›çš„æ–¹æ³•ï¼ŒCompletionServiceæ¥å£æä¾›çš„æ–¹æ³•æœ‰5ä¸ªï¼Œè¿™5ä¸ªæ–¹æ³•çš„æ–¹æ³•ç­¾åå¦‚ä¸‹æ‰€ç¤ºã€‚</p><p>å…¶ä¸­ï¼Œsubmit()ç›¸å…³çš„æ–¹æ³•æœ‰ä¸¤ä¸ªã€‚ä¸€ä¸ªæ–¹æ³•å‚æ•°æ˜¯<code>Callable&lt;V&gt; task</code>ï¼Œå‰é¢åˆ©ç”¨CompletionServiceå®ç°è¯¢ä»·ç³»ç»Ÿçš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬æäº¤ä»»åŠ¡å°±æ˜¯ç”¨çš„å®ƒã€‚å¦å¤–ä¸€ä¸ªæ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯<code>Runnable task</code>å’Œ<code>V result</code>ï¼Œè¿™ä¸ªæ–¹æ³•ç±»ä¼¼äºThreadPoolExecutorçš„ <code>&lt;T&gt; Future&lt;T&gt; submit(Runnable task, T result)</code> ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨<a href=\"https://time.geekbang.org/column/article/91292\">ã€Š23 | Futureï¼šå¦‚ä½•ç”¨å¤šçº¿ç¨‹å®ç°æœ€ä¼˜çš„â€œçƒ§æ°´æ³¡èŒ¶â€ç¨‹åºï¼Ÿã€‹</a>ä¸­æˆ‘ä»¬å·²è¯¦ç»†ä»‹ç»è¿‡ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p><p>CompletionServiceæ¥å£å…¶ä½™çš„3ä¸ªæ–¹æ³•ï¼Œéƒ½æ˜¯å’Œé˜»å¡é˜Ÿåˆ—ç›¸å…³çš„ï¼Œtake()ã€poll()éƒ½æ˜¯ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–å¹¶ç§»é™¤ä¸€ä¸ªå…ƒç´ ï¼›å®ƒä»¬çš„åŒºåˆ«åœ¨äºå¦‚æœé˜»å¡é˜Ÿåˆ—æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆè°ƒç”¨ take() æ–¹æ³•çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œè€Œ poll() æ–¹æ³•ä¼šè¿”å› null å€¼ã€‚ <code>poll(long timeout, TimeUnit unit)</code> æ–¹æ³•æ”¯æŒä»¥è¶…æ—¶çš„æ–¹å¼è·å–å¹¶ç§»é™¤é˜»å¡é˜Ÿåˆ—å¤´éƒ¨çš„ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœç­‰å¾…äº† timeout unitæ—¶é—´ï¼Œé˜»å¡é˜Ÿåˆ—è¿˜æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•ä¼šè¿”å› null å€¼ã€‚</p><pre><code>Future&lt;V&gt; submit(Callable&lt;V&gt; task);\nFuture&lt;V&gt; submit(Runnable task, V result);\nFuture&lt;V&gt; take() \n  throws InterruptedException;\nFuture&lt;V&gt; poll();\nFuture&lt;V&gt; poll(long timeout, TimeUnit unit) \n  throws InterruptedException;\n</code></pre><h2>åˆ©ç”¨CompletionServiceå®ç°Dubboä¸­çš„Forking Cluster</h2><p>Dubboä¸­æœ‰ä¸€ç§å«åš<strong>Forkingçš„é›†ç¾¤æ¨¡å¼</strong>ï¼Œè¿™ç§é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œæ”¯æŒ<strong>å¹¶è¡Œåœ°è°ƒç”¨å¤šä¸ªæŸ¥è¯¢æœåŠ¡ï¼Œåªè¦æœ‰ä¸€ä¸ªæˆåŠŸè¿”å›ç»“æœï¼Œæ•´ä¸ªæœåŠ¡å°±å¯ä»¥è¿”å›äº†</strong>ã€‚ä¾‹å¦‚ä½ éœ€è¦æä¾›ä¸€ä¸ªåœ°å€è½¬åæ ‡çš„æœåŠ¡ï¼Œä¸ºäº†ä¿è¯è¯¥æœåŠ¡çš„é«˜å¯ç”¨å’Œæ€§èƒ½ï¼Œä½ å¯ä»¥å¹¶è¡Œåœ°è°ƒç”¨3ä¸ªåœ°å›¾æœåŠ¡å•†çš„APIï¼Œç„¶ååªè¦æœ‰1ä¸ªæ­£ç¡®è¿”å›äº†ç»“æœrï¼Œé‚£ä¹ˆåœ°å€è½¬åæ ‡è¿™ä¸ªæœåŠ¡å°±å¯ä»¥ç›´æ¥è¿”å›räº†ã€‚è¿™ç§é›†ç¾¤æ¨¡å¼å¯ä»¥å®¹å¿2ä¸ªåœ°å›¾æœåŠ¡å•†æœåŠ¡å¼‚å¸¸ï¼Œä½†ç¼ºç‚¹æ˜¯æ¶ˆè€—çš„èµ„æºåå¤šã€‚</p><pre><code>geocoder(addr) {\n  //å¹¶è¡Œæ‰§è¡Œä»¥ä¸‹3ä¸ªæŸ¥è¯¢æœåŠ¡ï¼Œ \n  r1=geocoderByS1(addr);\n  r2=geocoderByS2(addr);\n  r3=geocoderByS3(addr);\n  //åªè¦r1,r2,r3æœ‰ä¸€ä¸ªè¿”å›\n  //åˆ™è¿”å›\n  return r1|r2|r3;\n}\n</code></pre><p>åˆ©ç”¨CompletionServiceå¯ä»¥å¿«é€Ÿå®ç° Forking è¿™ç§é›†ç¾¤æ¨¡å¼ï¼Œæ¯”å¦‚ä¸‹é¢çš„ç¤ºä¾‹ä»£ç å°±å±•ç¤ºäº†å…·ä½“æ˜¯å¦‚ä½•å®ç°çš„ã€‚é¦–å…ˆæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹æ± executor ã€ä¸€ä¸ªCompletionServiceå¯¹è±¡cså’Œä¸€ä¸ª<code>Future&lt;Integer&gt;</code>ç±»å‹çš„åˆ—è¡¨ futuresï¼Œæ¯æ¬¡é€šè¿‡è°ƒç”¨CompletionServiceçš„submit()æ–¹æ³•æäº¤ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œä¼šè¿”å›ä¸€ä¸ªFutureå¯¹è±¡ï¼Œæˆ‘ä»¬æŠŠè¿™äº›Futureå¯¹è±¡ä¿å­˜åœ¨åˆ—è¡¨futuresä¸­ã€‚é€šè¿‡è°ƒç”¨ <code>cs.take().get()</code>ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ‹¿åˆ°æœ€å¿«è¿”å›çš„ä»»åŠ¡æ‰§è¡Œç»“æœï¼Œåªè¦æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ªæ­£ç¡®è¿”å›çš„ç»“æœï¼Œå°±å¯ä»¥å–æ¶ˆæ‰€æœ‰ä»»åŠ¡å¹¶ä¸”è¿”å›æœ€ç»ˆç»“æœäº†ã€‚</p><pre><code>// åˆ›å»ºçº¿ç¨‹æ± \nExecutorService executor =\n  Executors.newFixedThreadPool(3);\n// åˆ›å»ºCompletionService\nCompletionService&lt;Integer&gt; cs =\n  new ExecutorCompletionService&lt;&gt;(executor);\n// ç”¨äºä¿å­˜Futureå¯¹è±¡\nList&lt;Future&lt;Integer&gt;&gt; futures =\n  new ArrayList&lt;&gt;(3);\n//æäº¤å¼‚æ­¥ä»»åŠ¡ï¼Œå¹¶ä¿å­˜futureåˆ°futures \nfutures.add(\n  cs.submit(()-&gt;geocoderByS1()));\nfutures.add(\n  cs.submit(()-&gt;geocoderByS2()));\nfutures.add(\n  cs.submit(()-&gt;geocoderByS3()));\n// è·å–æœ€å¿«è¿”å›çš„ä»»åŠ¡æ‰§è¡Œç»“æœ\nInteger r = 0;\ntry {\n  // åªè¦æœ‰ä¸€ä¸ªæˆåŠŸè¿”å›ï¼Œåˆ™break\n  for (int i = 0; i &lt; 3; ++i) {\n    r = cs.take().get();\n    //ç®€å•åœ°é€šè¿‡åˆ¤ç©ºæ¥æ£€æŸ¥æ˜¯å¦æˆåŠŸè¿”å›\n    if (r != null) {\n      break;\n    }\n  }\n} finally {\n  //å–æ¶ˆæ‰€æœ‰ä»»åŠ¡\n  for(Future&lt;Integer&gt; f : futures)\n    f.cancel(true);\n}\n// è¿”å›ç»“æœ\nreturn r;\n</code></pre><h2>æ€»ç»“</h2><p>å½“éœ€è¦æ‰¹é‡æäº¤å¼‚æ­¥ä»»åŠ¡çš„æ—¶å€™å»ºè®®ä½ ä½¿ç”¨CompletionServiceã€‚CompletionServiceå°†çº¿ç¨‹æ± Executorå’Œé˜»å¡é˜Ÿåˆ—BlockingQueueçš„åŠŸèƒ½èåˆåœ¨äº†ä¸€èµ·ï¼Œèƒ½å¤Ÿè®©æ‰¹é‡å¼‚æ­¥ä»»åŠ¡çš„ç®¡ç†æ›´ç®€å•ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒCompletionServiceèƒ½å¤Ÿè®©å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œç»“æœæœ‰åºåŒ–ï¼Œå…ˆæ‰§è¡Œå®Œçš„å…ˆè¿›å…¥é˜»å¡é˜Ÿåˆ—ï¼Œåˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œä½ å¯ä»¥è½»æ¾å®ç°åç»­å¤„ç†çš„æœ‰åºæ€§ï¼Œé¿å…æ— è°“çš„ç­‰å¾…ï¼ŒåŒæ—¶è¿˜å¯ä»¥å¿«é€Ÿå®ç°è¯¸å¦‚Forking Clusterè¿™æ ·çš„éœ€æ±‚ã€‚</p><p>CompletionServiceçš„å®ç°ç±»ExecutorCompletionServiceï¼Œéœ€è¦ä½ è‡ªå·±åˆ›å»ºçº¿ç¨‹æ± ï¼Œè™½çœ‹ä¸Šå»æœ‰äº›å•°å—¦ï¼Œä½†å¥½å¤„æ˜¯ä½ å¯ä»¥è®©å¤šä¸ªExecutorCompletionServiceçš„çº¿ç¨‹æ± éš”ç¦»ï¼Œè¿™ç§éš”ç¦»æ€§èƒ½é¿å…å‡ ä¸ªç‰¹åˆ«è€—æ—¶çš„ä»»åŠ¡æ‹–å®æ•´ä¸ªåº”ç”¨çš„é£é™©ã€‚</p><h2>è¯¾åæ€è€ƒ</h2><p>æœ¬ç« ä½¿ç”¨CompletionServiceå®ç°äº†ä¸€ä¸ªè¯¢ä»·åº”ç”¨çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œåæ¥åˆæœ‰äº†æ–°çš„éœ€æ±‚ï¼Œéœ€è¦è®¡ç®—å‡ºæœ€ä½æŠ¥ä»·å¹¶è¿”å›ï¼Œä¸‹é¢çš„ç¤ºä¾‹ä»£ç å°è¯•å®ç°è¿™ä¸ªéœ€æ±‚ï¼Œä½ çœ‹çœ‹æ˜¯å¦å­˜åœ¨é—®é¢˜å‘¢ï¼Ÿ</p><pre><code>// åˆ›å»ºçº¿ç¨‹æ± \nExecutorService executor = \n  Executors.newFixedThreadPool(3);\n// åˆ›å»ºCompletionService\nCompletionService&lt;Integer&gt; cs = new \n  ExecutorCompletionService&lt;&gt;(executor);\n// å¼‚æ­¥å‘ç”µå•†S1è¯¢ä»·\ncs.submit(()-&gt;getPriceByS1());\n// å¼‚æ­¥å‘ç”µå•†S2è¯¢ä»·\ncs.submit(()-&gt;getPriceByS2());\n// å¼‚æ­¥å‘ç”µå•†S3è¯¢ä»·\ncs.submit(()-&gt;getPriceByS3());\n// å°†è¯¢ä»·ç»“æœå¼‚æ­¥ä¿å­˜åˆ°æ•°æ®åº“\n// å¹¶è®¡ç®—æœ€ä½æŠ¥ä»·\nAtomicReference&lt;Integer&gt; m =\n  new AtomicReference&lt;&gt;(Integer.MAX_VALUE);\nfor (int i=0; i&lt;3; i++) {\n  executor.execute(()-&gt;{\n    Integer r = null;\n    try {\n      r = cs.take().get();\n    } catch (Exception e) {}\n    save(r);\n    m.set(Integer.min(m.get(), r));\n  });\n}\nreturn m;\n</code></pre><p>æ¬¢è¿åœ¨ç•™è¨€åŒºä¸æˆ‘åˆ†äº«ä½ çš„æƒ³æ³•ï¼Œä¹Ÿæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºè®°å½•ä½ çš„æ€è€ƒè¿‡ç¨‹ã€‚æ„Ÿè°¢é˜…è¯»ï¼Œå¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ã€‚</p><p></p>","comments":[{"had_liked":false,"id":89333,"user_name":"å¼ å¤©å±¹","can_delete":false,"product_type":"c1","uid":1477612,"ip_address":"","ucode":"8BD6BD6DCF0F4F","user_header":"https://static001.geekbang.org/account/avatar/00/16/8b/ec/dc03f5ad.jpg","comment_is_top":false,"comment_ctime":1556155671,"is_pvip":false,"replies":[{"id":"32185","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1556281494,"ip_address":"","comment_id":89333,"utype":1}],"discussion_count":10,"race_medal":0,"score":"534132100375","product_id":100023901,"comment_content":"æˆ‘è§‰å¾—é—®é¢˜å‡ºåœ¨return mè¿™é‡Œéœ€è¦ç­‰å¾…ä¸‰ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæˆï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ã€‚<br>...<br>AtomicReference&lt;Integer&gt; m = new AtomicReference&lt;&gt;(Integer.MAX_VALUE);<br>CountDownLatch latch = new CountDownLatch(3);<br>for(int i=0; i&lt;3; i++) {<br>\texecutor.execute(()-&gt;{<br>\t\tInteger r = null;<br>\t\ttry {<br>\t\t\tr = cs.take().get();<br>\t\t} catch(Exception e) {}<br>\t\tsave(r);<br>\t\tm.set(Integer.min(m.get(), r));<br>\t\tlatch.countDown();<br>\t});<br>\tlatch.await();<br>\treturn m;<br>}","like_count":125,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448093,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556281494,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1361746,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c7/52/c5adf218.jpg","nickname":"å–œæ¬¢åœ°çƒçš„é˜¿åŸ¹åŒå­¦","note":"","ucode":"5F97037585F857","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":119440,"discussion_content":"è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œm.set(Integer.min(m.get(), r))  å¹¶ä¸æ˜¯åŸå­æ“ä½œï¼","likes_number":18,"is_delete":false,"is_hidden":false,"ctime":1578230692,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":2963434,"avatar":"","nickname":"Geek_94fa0e","note":"","ucode":"15BC7D4E130E80","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1361746,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c7/52/c5adf218.jpg","nickname":"å–œæ¬¢åœ°çƒçš„é˜¿åŸ¹åŒå­¦","note":"","ucode":"5F97037585F857","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":561694,"discussion_content":"ä½†æ˜¯è¿™ä¸ªæœ‰å•¥é—®é¢˜å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649693597,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":119440,"ip_address":""},"score":561694,"extra":""},{"author":{"id":1204947,"avatar":"https://static001.geekbang.org/account/avatar/00/12/62/d3/663de972.jpg","nickname":"æ‡µé€¼çŒ´","note":"","ucode":"BDC748A96AC316","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2963434,"avatar":"","nickname":"Geek_94fa0e","note":"","ucode":"15BC7D4E130E80","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575365,"discussion_content":"å¤šçº¿ç¨‹å¹¶å‘ä¸å®‰å…¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654773867,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":561694,"ip_address":""},"score":575365,"extra":""}]},{"author":{"id":1151788,"avatar":"https://static001.geekbang.org/account/avatar/00/11/93/2c/67a5d65c.jpg","nickname":"caleb","note":"","ucode":"63C7399E882EBA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":34117,"discussion_content":"æœ€åä¸€ä¸ªï½ç¬¦å·æ˜¯ä¸æ˜¯åº”è¯¥æåˆ°latch.awaitï¼ˆï¼‰å‰é¢","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1571159081,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1123043,"avatar":"https://static001.geekbang.org/account/avatar/00/11/22/e3/510b69f9.jpg","nickname":"benny","note":"","ucode":"E2F30AF0C808D9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1151788,"avatar":"https://static001.geekbang.org/account/avatar/00/11/93/2c/67a5d65c.jpg","nickname":"caleb","note":"","ucode":"63C7399E882EBA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":106391,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577535045,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":34117,"ip_address":""},"score":106391,"extra":""}]},{"author":{"id":1128953,"avatar":"https://static001.geekbang.org/account/avatar/00/11/39/f9/acfb9a48.jpg","nickname":"æ— è¨€çš„çº¦å®š","note":"","ucode":"5E8046EB6B7956","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":99993,"discussion_content":"return måº”åœ¨å¾ªç¯ä»¥å¤–","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1577232856,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1547667,"avatar":"https://static001.geekbang.org/account/avatar/00/17/9d/93/4159edaa.jpg","nickname":"æœ´ç´ æŸ æª¬c","note":"","ucode":"2D4CBB70D801B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":324806,"discussion_content":"ä¸»çº¿ç¨‹å¯ä¸ç®¡ä½  çº¿ç¨‹æ± çš„æƒ…å†µ å¯èƒ½ä¹‹é—´è¿”å›ä¸ª0","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605173188,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1041534,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoEb4oys1R20cc9FfpZsVEt04Dias86A30LUNWM8lPyBahKaMRISNB854hhXRjoohCIIwX1sO86zfA/132","nickname":"0909","note":"","ucode":"56BAF3C6FBF200","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":109172,"discussion_content":"å‰å®³","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577671615,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1156592,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a5/f0/8648c464.jpg","nickname":"Joker","note":"","ucode":"126AF848001A1E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":45610,"discussion_content":"è€å“¥ï¼Œç¨³","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573051677,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89429,"user_name":"å°å","can_delete":false,"product_type":"c1","uid":1402795,"ip_address":"","ucode":"902E7ED95D73BA","user_header":"https://static001.geekbang.org/account/avatar/00/15/67/ab/facff632.jpg","comment_is_top":false,"comment_ctime":1556172851,"is_pvip":false,"replies":[{"id":"32009","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1556191498,"ip_address":"","comment_id":89429,"utype":1}],"discussion_count":1,"race_medal":0,"score":"121815257139","product_id":100023901,"comment_content":"çœ‹è€å¸ˆçš„æ„å›¾æ˜¯è¦ç­‰ä¸‰ä¸ªæ¯”è¾ƒæŠ¥å‡çš„çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ‰èƒ½æ‰§è¡Œä¸»çº¿ç¨‹çš„çš„return  mï¼Œä½†æ˜¯ä»£ç æ— æ³•ä¿è¯ä¸‰ä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œå®Œï¼Œå’Œä¸»çº¿ç¨‹æ‰§è¡Œreturnçš„é¡ºåºï¼Œå› æ­¤ï¼Œmçš„å€¼ä¸æ˜¯å‡†ç¡®çš„ï¼Œå¯ä»¥åŠ ä¸ªçº¿ç¨‹æ ˆæ ï¼Œçº¿ç¨‹æ‰§è¡Œå®Œè®¡æ•°å™¨ï¼Œæ¥è¾¾åˆ°è¿™æ•ˆæœ","like_count":29,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448129,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556191498,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89365,"user_name":"è¥¿è¡Œå¯ºå’•å“’å­","can_delete":false,"product_type":"c1","uid":1441988,"ip_address":"","ucode":"CAE570245BA299","user_header":"https://static001.geekbang.org/account/avatar/00/16/00/c4/634c1e10.jpg","comment_is_top":false,"comment_ctime":1556159056,"is_pvip":false,"replies":[{"id":"32188","content":"ğŸ‘<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1556284375,"ip_address":"","comment_id":89365,"utype":1}],"discussion_count":7,"race_medal":0,"score":"117520276048","product_id":100023901,"comment_content":"è¯•è¿‡è¿”å›å€¼æ˜¯2147483647ï¼Œä¹Ÿå°±æ˜¯intçš„æœ€å¤§å€¼ã€‚æ²¡æœ‰ç­‰å¾…æ“ä½œå®Œæˆå°±çŒ´æ€¥çš„è¿”å›äº†ã€‚ m.set(Integer.min(m.get(), r)... è¿™ä¸ªæ“ä½œä¹Ÿä¸æ˜¯åŸå­æ“ä½œã€‚<br>è¯•ç€è‡ªå·±å¼„äº†ä¸€ä¸‹ï¼š<br>public Integer run(){<br>        &#47;&#47; åˆ›å»ºçº¿ç¨‹æ± <br>        ExecutorService executor = Executors.newFixedThreadPool(3);<br>        &#47;&#47; åˆ›å»º CompletionService<br>        CompletionService&lt;Integer&gt; cs = new ExecutorCompletionService&lt;&gt;(executor);<br>        AtomicReference&lt;Integer&gt; m = new AtomicReference&lt;&gt;(Integer.MAX_VALUE);<br>        &#47;&#47; å¼‚æ­¥å‘ç”µå•† S1 è¯¢ä»·<br>        cs.submit(()-&gt;getPriceByS1());<br>        &#47;&#47; å¼‚æ­¥å‘ç”µå•† S2 è¯¢ä»·<br>        cs.submit(()-&gt;getPriceByS2());<br>        &#47;&#47; å¼‚æ­¥å‘ç”µå•† S3 è¯¢ä»·<br>        cs.submit(()-&gt;getPriceByS3());<br>        &#47;&#47; å°†è¯¢ä»·ç»“æœå¼‚æ­¥ä¿å­˜åˆ°æ•°æ®åº“<br>        &#47;&#47; å¹¶è®¡ç®—æœ€ä½æŠ¥ä»·<br>        for (int i=0; i&lt;3; i++) {<br>            Integer r = logIfError(()-&gt;cs.take().get());<br>            executor.execute(()-&gt; save(r));<br>            m.getAndUpdate(v-&gt;Integer.min(v, r));<br>        }<br>        return m.get();<br>    }<br>ä¸çŸ¥é“å¯ä¸å¯è¡Œ","like_count":28,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448106,"discussion_content":"ğŸ‘\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556284375,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1350140,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Kj8GRjh4iaZaGibKXrmGnR7PxENFlFMibr1jLHxEc9R38D3kICvV7NdaiaMHpomZmkZMicPOqT3eQnNxct0uIabTkZQ/132","nickname":"yinzh","note":"","ucode":"87CD1CE5F68121","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":287677,"discussion_content":"å·²ç»æŠŠæ¯”è¾ƒå¤§å°çš„æ“ä½œç§»åˆ°å¼‚æ­¥çº¿ç¨‹ä»¥å¤–äº†ï¼Œmæ˜¯ä¸æ˜¯å¯ä»¥ä¸ç”¨AtomicReferenceäº†å‘¢","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1593508643,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1168504,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d4/78/66b3f2a2.jpg","nickname":"æ–¯ç›–ä¸¸","note":"","ucode":"B881D14B028F14","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348377,"discussion_content":"ä¸ºä»€ä¹ˆè¿™æ ·å°±ä¸ä¼šçŒ´æ€¥åœ°è¿”å›å‘¢ï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1612530079,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1361746,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c7/52/c5adf218.jpg","nickname":"å–œæ¬¢åœ°çƒçš„é˜¿åŸ¹åŒå­¦","note":"","ucode":"5F97037585F857","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":119408,"discussion_content":" m.get(); ä¸ä¼šé˜»å¡å§ï¼Œè¿˜æ˜¯ä¼šç›´æ¥è¿”å›çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578229714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1004484,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/c4/df86decb.jpg","nickname":"æ±ŸåŸå­","note":"","ucode":"28A2D7DEAE3337","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1361746,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c7/52/c5adf218.jpg","nickname":"å–œæ¬¢åœ°çƒçš„é˜¿åŸ¹åŒå­¦","note":"","ucode":"5F97037585F857","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":188964,"discussion_content":"cs.take()ä¼šé˜»å¡","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1582829891,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":119408,"ip_address":""},"score":188964,"extra":""},{"author":{"id":1101760,"avatar":"https://static001.geekbang.org/account/avatar/00/10/cf/c0/8e4c1135.jpg","nickname":"ddup","note":"","ucode":"D8EC573DA46A10","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1004484,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/c4/df86decb.jpg","nickname":"æ±ŸåŸå­","note":"","ucode":"28A2D7DEAE3337","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":299317,"discussion_content":" save(r)åˆå˜æˆä¸²è¡Œçš„äº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1597656975,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":188964,"ip_address":""},"score":299317,"extra":""},{"author":{"id":2029333,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erLujLByemCGmjp9rIicdoC59XUh99WiargBmxOMtsLlmntyEklh3LyiahtzAz3fnUu0tWwvibTqOFt5A/132","nickname":"hammer","note":"","ucode":"D98A31ACE2158F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1101760,"avatar":"https://static001.geekbang.org/account/avatar/00/10/cf/c0/8e4c1135.jpg","nickname":"ddup","note":"","ucode":"D8EC573DA46A10","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301696,"discussion_content":"å¹¶æ²¡æœ‰ä¸²è¡Œ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1598609479,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":299317,"ip_address":""},"score":301696,"extra":""}]}]},{"had_liked":false,"id":89349,"user_name":"ä¸€é“é˜³å…‰","can_delete":false,"product_type":"c1","uid":1239557,"ip_address":"","ucode":"F35207CCCEC6E2","user_header":"https://static001.geekbang.org/account/avatar/00/12/ea/05/c0d8014d.jpg","comment_is_top":false,"comment_ctime":1556157495,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"96045438007","product_id":100023901,"comment_content":"m.get()å’Œm.set()ä¸æ˜¯åŸå­æ€§æ“ä½œï¼Œæ­£ç¡®ä»£ç æ˜¯:do{int expect = m.get();int min= Integer.min(expect,r);}while(!m.compareAndSet(expect,min))ã€‚è€å¸ˆï¼Œæ˜¯è¿™æ ·å—ï¼Ÿ","like_count":22,"discussions":[{"author":{"id":1519545,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eohTCTF7EIAR5ic7eiaIbU9zF81JpxibTvFokTZu1hLhwwaDl0k2eaOrsibLrqibrfaV3rpJd08bzoGDMQ/132","nickname":"Echo","note":"","ucode":"2A99E37C89660E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":284238,"discussion_content":"å¯ä»¥ç›´æ¥è°ƒç”¨m.getAndUpdate","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592481383,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":143854,"user_name":"ipofss","can_delete":false,"product_type":"c1","uid":1018620,"ip_address":"","ucode":"DE3061C9259F9E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8a/fc/d1dd57dd.jpg","comment_is_top":false,"comment_ctime":1571799736,"is_pvip":false,"replies":[{"id":"55523","content":"ç”¨çš„æ—¶å€™æŸ¥æ–‡æ¡£å°±è¡Œï¼Œå·¥å…·ç±»ä¸»è¦æ˜¯ä¼šç”¨ï¼ŒçŸ¥é“ä»€ä¹ˆåœºæ™¯ç”¨ä»€ä¹ˆ","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1571802825,"ip_address":"","comment_id":143854,"utype":1}],"discussion_count":1,"race_medal":0,"score":"70291276472","product_id":100023901,"comment_content":"è€å¸ˆï¼Œå¹¶å‘å·¥å…·ç±»ï¼Œè¿™æ•´ä¸ªä¸€ç« ï¼Œæ„Ÿè§‰å¬å®Œä¼¼æ‡‚éæ‡‚çš„ï¼Œå› ä¸ºå®è·µä¸­æ²¡ç”¨è¿‡ï¼Œæˆ‘è¦å¦‚ä½•å¼¥è¡¥è¿™éƒ¨åˆ†ï¼Œè¿˜æ˜¯è¯´åªè¦å¬è¯´è¿‡ï¼Œç„¶åç”¨çš„æ—¶å€™å†å»æŸ¥çœ‹demoå—","like_count":16,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471726,"discussion_content":"ç”¨çš„æ—¶å€™æŸ¥æ–‡æ¡£å°±è¡Œï¼Œå·¥å…·ç±»ä¸»è¦æ˜¯ä¼šç”¨ï¼ŒçŸ¥é“ä»€ä¹ˆåœºæ™¯ç”¨ä»€ä¹ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571802825,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89531,"user_name":"linqw","can_delete":false,"product_type":"c1","uid":1134138,"ip_address":"","ucode":"09DCFE98C54DD8","user_header":"https://static001.geekbang.org/account/avatar/00/11/4e/3a/86196508.jpg","comment_is_top":false,"comment_ctime":1556197045,"is_pvip":false,"replies":[{"id":"32184","content":"è¿™å¯éš¾å€’æˆ‘äº†ï¼Œå¹¶å‘åº“çš„æºç æˆ‘åªæ˜¯é›¶æ•£å¾—çœ‹çš„ï¼Œçœ‹å®ŒåŸºæœ¬ä¹Ÿå¿˜å¾—å·®ä¸å¤šäº†ï¼Œæ„Ÿè§‰è‡ªå·±ä¹Ÿä¸æ˜¯æç®—æ³•çš„æ–™ï¼Œæ”¾å¼ƒäº†ğŸ˜‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1556281381,"ip_address":"","comment_id":89531,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27326000821","product_id":100023901,"comment_content":"è€å¸ˆstampedLockçš„è·å–é”æºç ï¼Œè€å¸ˆèƒ½å¸®å¿™è§£æƒ‘ä¸‹ä¹ˆï¼Ÿé˜»å¡çš„è¯»çº¿ç¨‹cowaitæ˜¯æŒ‚åœ¨å†™èŠ‚ç‚¹çš„ä¸‹æ–¹ä¹ˆï¼Ÿè€å¸ˆèƒ½è§£æƒ‘ä¸‹åŸºäºçš„ç†è®ºæ¨¡å‹<br>private long acquireWrite(boolean interruptible, long deadline) {<br>        WNode node = null, p;<br>        for (int spins = -1;;) { &#47;&#47; spin while enqueuing<br>            long m, s, ns;<br>            &#47;&#47;å¦‚æœå½“å‰çš„stateæ˜¯æ— é”çŠ¶æ€å³100000000<br>            if ((m = (s = state) &amp; ABITS) == 0L) {<br>            \t&#47;&#47;è®¾ç½®æˆå†™é”<br>                if (U.compareAndSwapLong(this, STATE, s, ns = s + WBIT))<br>                    return ns;<br>            }<br>            else if (spins &lt; 0)<br>            \t&#47;&#47;å½“å‰é”çŠ¶æ€ä¸ºå†™é”çŠ¶æ€ï¼Œå¹¶ä¸”é˜Ÿåˆ—ä¸ºç©ºï¼Œè®¾ç½®è‡ªæ—‹å€¼<br>                spins = (m == WBIT &amp;&amp; wtail == whead) ? SPINS : 0;<br>            else if (spins &gt; 0) {<br>            \t&#47;&#47;è‡ªæ—‹æ“ä½œï¼Œå°±æ˜¯è®©çº¿ç¨‹åœ¨æ­¤è‡ªæ—‹<br>                if (LockSupport.nextSecondarySeed() &gt;= 0)<br>                    --spins;<br>            }<br>            &#47;&#47;å¦‚æœé˜Ÿåˆ—å°¾å…ƒç´ ä¸ºç©ºï¼Œåˆå§‹åŒ–é˜Ÿåˆ—<br>            else if ((p = wtail) == null) { &#47;&#47; initialize queue<br>                WNode hd = new WNode(WMODE, null);<br>                if (U.compareAndSwapObject(this, WHEAD, null, hd))<br>                    wtail = hd;<br>            }<br>            &#47;&#47;å½“å‰è¦åŠ å…¥çš„å…ƒç´ ä¸ºç©ºï¼Œåˆå§‹åŒ–å½“å‰å…ƒç´ ï¼Œå‰ç½®èŠ‚ç‚¹ä¸ºå°¾èŠ‚ç‚¹<br>            else if (node == null)<br>                node = new WNode(WMODE, p);<br>            &#47;&#47;é˜Ÿåˆ—çš„ç¨³å®šæ€§åˆ¤æ–­ï¼Œå½“å‰çš„å‰ç½®èŠ‚ç‚¹æ˜¯å¦æ”¹å˜ï¼Œé‡æ–°è®¾ç½®    <br>            else if (node.prev != p)<br>                node.prev = p;<br>            &#47;&#47;å°†å½“å‰èŠ‚ç‚¹åŠ å…¥å°¾èŠ‚ç‚¹ä¸­    <br>            else if (U.compareAndSwapObject(this, WTAIL, p, node)) {<br>                p.next = node;<br>                break;<br>            }<br>        }<br><br>        ","like_count":7,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448164,"discussion_content":"è¿™å¯éš¾å€’æˆ‘äº†ï¼Œå¹¶å‘åº“çš„æºç æˆ‘åªæ˜¯é›¶æ•£å¾—çœ‹çš„ï¼Œçœ‹å®ŒåŸºæœ¬ä¹Ÿå¿˜å¾—å·®ä¸å¤šäº†ï¼Œæ„Ÿè§‰è‡ªå·±ä¹Ÿä¸æ˜¯æç®—æ³•çš„æ–™ï¼Œæ”¾å¼ƒäº†ğŸ˜‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556281381,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89320,"user_name":"å¤©æ¶¯ç…®é…’","can_delete":false,"product_type":"c1","uid":1241127,"ip_address":"","ucode":"EF9516EC878E4C","user_header":"https://static001.geekbang.org/account/avatar/00/12/f0/27/8b72141c.jpg","comment_is_top":false,"comment_ctime":1556154302,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"27325958078","product_id":100023901,"comment_content":"å…ˆè°ƒç”¨m.get()å¹¶è·Ÿræ¯”è¾ƒï¼Œå†è°ƒç”¨m.set()ï¼Œè¿™é‡Œå­˜åœ¨ç«æ€æ¡ä»¶ï¼Œçº¿ç¨‹å¹¶ä¸å®‰å…¨","like_count":6,"discussions":[{"author":{"id":1486895,"avatar":"https://static001.geekbang.org/account/avatar/00/16/b0/2f/e2096905.jpg","nickname":"é©¬æˆ","note":"","ucode":"664F2BAA2E0F0B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":47070,"discussion_content":"è¿™é‡Œè™½ç„¶ä¸æ»¡è¶³åŸå­æ€§ï¼Œä½†æ˜¯ä¸å½±å“ç»“æœï¼Œé—®é¢˜ä¸åœ¨è¿™é‡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573268169,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":156589,"user_name":"ç‹æ˜Šå“²","can_delete":false,"product_type":"c1","uid":1698557,"ip_address":"","ucode":"AA2F4499BF6865","user_header":"https://static001.geekbang.org/account/avatar/00/19/ea/fd/89d3d0b5.jpg","comment_is_top":false,"comment_ctime":1574918411,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"18754787595","product_id":100023901,"comment_content":"æœ‰ä¸ªç–‘é—®ï¼šè€å¸ˆä¹Ÿæåˆ°é‚£ç§çº¿ç¨‹æ± +é˜»å¡é˜Ÿåˆ—å®ç°æ–¹å¼ï¼Œé˜Ÿåˆ—é‡Œä¿å­˜çš„æ˜¯ä»»åŠ¡çš„ç»“æœï¼Œè€ŒcompletionServiceä¿å­˜çš„futureï¼Œé‚£completionServiceçš„futureæ‹¿å‡ºæ¥getçš„æ—¶å€™ï¼Œä¹Ÿé˜»å¡åœ¨geté‚£é‡Œäº†å•Šï¼Œé‚£ä¸è·Ÿè·Ÿçº¿ç¨‹æ± +futureçš„å®ç°ä¸€æ ·çš„å¼Šç«¯äº†å•Šï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1052191,"avatar":"https://static001.geekbang.org/account/avatar/00/10/0e/1f/d0472177.jpg","nickname":"å‰å®³äº†æˆ‘çš„å›½","note":"","ucode":"CD0A54A1B998AA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":214488,"discussion_content":"ç¿»äº†æºç ï¼š\n    private static class QueueingFuture<V> extends FutureTask<Void> {\n        QueueingFuture(RunnableFuture<V> task,\n                       BlockingQueue<Future<V>> completionQueue) {\n            super(task, null);\n            this.task = task;\n            this.completionQueue = completionQueue;\n        }\n        private final Future<V> task;\n        private final BlockingQueue<Future<V>> completionQueue;\n        protected void done() { completionQueue.add(task); }\n    }\nè¿™é‡Œä¼šåœ¨taskæ‰§è¡Œå®Œä¹‹åï¼Œæ‰æŠŠFutureå…¥é˜Ÿï¼Œæ‰€ä»¥ä¸ä¼šé˜»å¡","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1585198048,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1554995,"avatar":"https://static001.geekbang.org/account/avatar/00/17/ba/33/2d83d174.jpg","nickname":"æ—¶å…‰å®ˆæŠ¤è€…-åŸºå…°","note":"","ucode":"F0B0887B1979D2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368827,"discussion_content":"æŠŠç»“æœæ”¾åœ¨é˜»å¡é˜Ÿåˆ—å¯ä»¥ä¿è¯æŒ‰ç…§ç»“æœäº§ç”Ÿçš„é¡ºåºæ¶ˆè´¹ï¼Œè€Œä¸æ”¾åˆ°é˜»å¡é˜Ÿåˆ—æœ‰å¯èƒ½ä¸€ç›´åœ¨ç­‰å¾…æ—¶é—´è¾ƒé•¿çš„ä»»åŠ¡è€Œè¾ƒçŸ­çš„ä»»åŠ¡å·²ç»ç»“æŸäº†ï¼Œæ€»çš„æ‰§è¡Œæ—¶é—´ä¸Šæœ‰å·®åˆ«","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618840714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1052191,"avatar":"https://static001.geekbang.org/account/avatar/00/10/0e/1f/d0472177.jpg","nickname":"å‰å®³äº†æˆ‘çš„å›½","note":"","ucode":"CD0A54A1B998AA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":214466,"discussion_content":"æˆ‘ä¹Ÿæœ‰ç›¸åŒç–‘é—®ï¼Œå¸Œæœ›è€å¸ˆè§£ç­”ä¸€ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585195276,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":90106,"user_name":"ä¸€çœ¼ä¸‡å¹´","can_delete":false,"product_type":"c1","uid":1018200,"ip_address":"","ucode":"7B0823E39AE809","user_header":"","comment_is_top":false,"comment_ctime":1556416122,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"18736285306","product_id":100023901,"comment_content":"è¯¾åæ€è€ƒå¦‚æœéœ€è¦ç­‰å¾…æœ€å°ç»“æœï¼Œæœ¬æ¥å°±æœ‰é˜»å¡é˜Ÿåˆ—äº†ï¼ŒåŠ äº†ä¸ªçº¿ç¨‹æ± ï¼Œè¯„è®ºè¿˜è¦åŠ ä¸Šæ æ …ï¼Œé‚£é™¤äº†ç‚«æŠ€æ²¡å•¥ä½œç”¨","like_count":5,"discussions":[{"author":{"id":1686903,"avatar":"https://static001.geekbang.org/account/avatar/00/19/bd/77/72676290.jpg","nickname":"cd","note":"","ucode":"AE95F4288A7978","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":273235,"discussion_content":"èµ·äº†ä¸‰ä¸ªçº¿ç¨‹æ¯”è¾ƒå¤§å°ï¼Œæ˜¯å¼‚æ­¥ï¼Œå¯èƒ½è¿˜æ²¡æ¯”è¾ƒå®Œä¸»çº¿ç¨‹å°±return mï¼Œmè¿˜æ˜¯intçš„æœ€å¤§å€¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590420670,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2593255,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/2msSWvJs8A6icPvUzyRs9DEqltYh0edy699wJz9BmCRoJj1bZHhBHhp4yY9Nic9oc2q8OdsVGwtmBRhKtw00Jj6Q/132","nickname":"Geek_c139e0","note":"","ucode":"87C7E07E98354B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1686903,"avatar":"https://static001.geekbang.org/account/avatar/00/19/bd/77/72676290.jpg","nickname":"cd","note":"","ucode":"AE95F4288A7978","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557215,"discussion_content":"å¯æ˜¯completionServiceçš„takeæ˜¯é˜»å¡çš„ï¼Œå¦‚æœæœ€åæ¯”ä»·ä¸å¯ç”¨æ–°çº¿ç¨‹å»åšï¼Œå®Œå…¨èƒ½ä¿è¯æœ€é•¿é˜»å¡æ—¶é—´å°±æ˜¯æœ€é•¿å¼‚æ­¥æ—¶é—´ï¼Œè€Œä¸”è¿˜ä¸ä¼šå› ä¸ºå¼‚æ­¥å¯åŠ¨å¯¼è‡´å–ä»·è¿˜æ²¡è¿”å›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647699481,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":273235,"ip_address":""},"score":557215,"extra":""}]},{"author":{"id":1123043,"avatar":"https://static001.geekbang.org/account/avatar/00/11/22/e3/510b69f9.jpg","nickname":"benny","note":"","ucode":"E2F30AF0C808D9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":106397,"discussion_content":"ğŸ˜ƒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577535269,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89832,"user_name":"æµ·é¸¿","can_delete":false,"product_type":"c1","uid":1104275,"ip_address":"","ucode":"7074EF94EA70AD","user_header":"https://static001.geekbang.org/account/avatar/00/10/d9/93/098e5ef5.jpg","comment_is_top":false,"comment_ctime":1556276708,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18736145892","product_id":100023901,"comment_content":"é‡æ–°å‘è¿‡ï¼Œåˆšåˆšçš„ä»£ç æœ‰è¯¯ï¼<br>1.forå¾ªç¯çº¿ç¨‹æ± æ‰§è¡Œå±äºå¼‚æ­¥å¯¼è‡´æœªç­‰æ¯”ä»·ç»“æœå°± returnäº†ï¼Œéœ€è¦ç­‰å¾…ä¸‰æ¬¡æ¯”ä»·ç»“æœæ‰èƒ½ returnï¼Œå¯ä»¥ç”¨ CountDownLatch<br>2. m. set( Integer. min( m. get(), r))å­˜åœ¨ç«æ€æ¡ä»¶ï¼Œå¯ä»¥æ›´æ”¹ä¸º <br>Integer o; <br>do{ <br>o= m. get(); <br>if(o&lt;=r){ break;}<br>} <br>while(! m. compareAndSet( o, r));<br>3.è¿˜æœ‰ä¸€ä¸ªå°é—®é¢˜å°±æ˜¯ try- catchæ•è·å¼‚å¸¸åçš„å¤„ç†ï¼Œæé«˜ç¨‹åºé²æ£’æ€§","like_count":4},{"had_liked":false,"id":90806,"user_name":"Sunqc","can_delete":false,"product_type":"c1","uid":1473717,"ip_address":"","ucode":"2C54659635403F","user_header":"https://static001.geekbang.org/account/avatar/00/16/7c/b5/4a7a2bd4.jpg","comment_is_top":false,"comment_ctime":1556670643,"is_pvip":false,"replies":[{"id":"32573","content":"æ˜¯çš„<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1556700177,"ip_address":"","comment_id":90806,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14441572531","product_id":100023901,"comment_content":"&#47;&#47; è·å–ç”µå•† S1 æŠ¥ä»·å¹¶ä¿å­˜<br>r=f1.get();<br>executor.execute(()-&gt;save(r));<br><br>å¦‚æœæŠŠr=f1.getï¼ˆï¼‰æ”¾è¿›executeé‡Œåº”è¯¥æ˜¯ä¹Ÿèƒ½ä¿è¯å…ˆæ‰§è¡Œå®Œçš„å…ˆä¿å­˜","like_count":3,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448665,"discussion_content":"æ˜¯çš„\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556700177,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89356,"user_name":"é»„æµ·å³°","can_delete":false,"product_type":"c1","uid":1275357,"ip_address":"","ucode":"E9340719BC96B2","user_header":"https://static001.geekbang.org/account/avatar/00/13/75/dd/9ead6e69.jpg","comment_is_top":false,"comment_ctime":1556158088,"is_pvip":false,"replies":[{"id":"32007","content":"ğŸ‘<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1556190855,"ip_address":"","comment_id":89356,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14441059976","product_id":100023901,"comment_content":"æˆ‘å®é™…æµ‹è¯•äº†ç¬¬ä¸€æ®µä»£ç ï¼Œç¡®å®æ˜¯å¼‚æ­¥çš„ï¼Œf1.getä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚ã€‚ã€‚<br><br>public static void main(String[] args) {<br>        ExecutorService executor = Executors.newFixedThreadPool(3);<br>        Future&lt;Integer&gt; f1 = executor.submit(()-&gt;getPriceByS1());<br>        Future&lt;Integer&gt; f2 = executor.submit(()-&gt;getPriceByS2());<br>        Future&lt;Integer&gt; f3 = executor.submit(()-&gt;getPriceByS3());<br><br>        executor.execute(()-&gt; {<br>            try {<br>                save(f1.get());<br>            } catch (InterruptedException e) {<br>                e.printStackTrace();<br>            } catch (ExecutionException e) {<br>                e.printStackTrace();<br>            }<br>        });<br>        executor.execute(()-&gt; {<br>            try {<br>                save(f2.get());<br>            } catch (InterruptedException e) {<br>                e.printStackTrace();<br>            } catch (ExecutionException e) {<br>                e.printStackTrace();<br>            }<br>        });<br>        executor.execute(()-&gt; {<br>            try {<br>                save(f3.get());<br>            } catch (InterruptedException e) {<br>                e.printStackTrace();<br>            } catch (ExecutionException e) {<br>                e.printStackTrace();<br>            }<br>        });<br>    }<br><br>    private static Integer getPriceByS1() {<br>        try {<br>            Thread.sleep(10000);<br>        } catch (InterruptedException e) {<br>            e.printStackTrace();<br>        }<br>        return 1;<br>    }<br>    private static Integer getPriceByS2() {<br>        try {<br>            Thread.sleep(1000);<br>        } catch (InterruptedException e) {<br>            e.printStackTrace();<br>        }<br>        return 2;<br>    }<br>    private static Integer getPriceByS3() {<br>        try {<br>            Thread.sleep(1000);<br>        } catch (InterruptedException e) {<br>            e.printStackTrace();<br>        }<br>        return 3;<br>    }<br>    private static void save(Integer i) {<br>        System.out.println(&quot;save &quot; + i);<br>    }","like_count":3,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448102,"discussion_content":"ğŸ‘\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556190855,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89325,"user_name":"Corner","can_delete":false,"product_type":"c1","uid":1446316,"ip_address":"","ucode":"7862D593172536","user_header":"https://static001.geekbang.org/account/avatar/00/16/11/ac/9cc5e692.jpg","comment_is_top":false,"comment_ctime":1556154751,"is_pvip":false,"replies":[{"id":"32017","content":"ğŸ‘ï¼Œç¤ºä¾‹ä»£ç æœ‰é—®é¢˜ï¼Œå·²ç»æ”¹äº†<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1556194194,"ip_address":"","comment_id":89325,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14441056639","product_id":100023901,"comment_content":"1.AtomicReference&lt;Integer&gt;çš„getæ–¹æ³•åº”è¯¥æ”¹æˆä½¿ç”¨casæ–¹æ³•<br>2.æœ€åç­›é€‰æœ€å°ç»“æœçš„ä»»åŠ¡æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œåº”è¯¥åœ¨returnä¹‹å‰åšåŒæ­¥ï¼Œæ‰€ä»¥æœ€å¥½ä½¿ç”¨sumitæäº¤è¯¥ä»»åŠ¡ä¾¿äºåˆ¤æ–­ä»»åŠ¡çš„å®Œæˆ<br>æœ€åè¯·æ•™è€å¸ˆä¸€ä¸‹ï¼Œç¬¬ä¸€ä¸ªä¾‹å­ä¸­ä¸ºä»€ä¹ˆä¸»çº¿ç¨‹ä¼šé˜»å¡åœ¨f1.get()æ–¹æ³•å‘¢ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448091,"discussion_content":"ğŸ‘ï¼Œç¤ºä¾‹ä»£ç æœ‰é—®é¢˜ï¼Œå·²ç»æ”¹äº†\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556194194,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89275,"user_name":"éƒ‘æ™¨Cc","can_delete":false,"product_type":"c1","uid":1324942,"ip_address":"","ucode":"57146E444D6329","user_header":"https://static001.geekbang.org/account/avatar/00/14/37/8e/cf0b4575.jpg","comment_is_top":false,"comment_ctime":1556131613,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14441033501","product_id":100023901,"comment_content":"executor.executeï¼ˆCallableï¼‰æäº¤ä»»åŠ¡æ˜¯éé˜»å¡çš„ return mï¼›å¾ˆå¤§æ¦‚ç‡è¿”å› Integer.Maxvalueï¼Œè€Œä¸”è€å¸ˆä¸ºäº†ç¡®ä¿è¿”å›è¿™ä¸ªmaxè¿˜ç‰¹æ„åŠ å…¥äº†saveè¿™ä¸ªé˜»å¡çš„æ–¹æ³•","like_count":3},{"had_liked":false,"id":89321,"user_name":"undifined","can_delete":false,"product_type":"c1","uid":1068920,"ip_address":"","ucode":"449CB4CD2DC089","user_header":"https://static001.geekbang.org/account/avatar/00/10/4f/78/c3d8ecb0.jpg","comment_is_top":false,"comment_ctime":1556154302,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10146088894","product_id":100023901,"comment_content":"è€å¸ˆ ç”¨ CompletionService å’Œç”¨ CompletionFuture æŸ¥è¯¢ï¼Œç„¶åç”¨ whenComplete æˆ–è€… thenAcceptEither è¿™äº›æ–¹æ³•çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Œæˆ‘è§‰å¾—ç”¨ CompletionFuture æ›´ç›´è§‚äº›ï¼›<br>è€å¸ˆå¯ä»¥åœ¨ä¸‹ä¸€è®²çš„æ—¶å€™è¯´ä¸€ä¸‹ä¸Šä¸€è®²çš„æ€è€ƒé¢˜æ­£ç¡®ç­”æ¡ˆå—ï¼Œè°¢è°¢è€å¸ˆ","like_count":2},{"had_liked":false,"id":190895,"user_name":"é¸¡è›‹ğŸ± è¾¾èŠ¬å¥‡","can_delete":false,"product_type":"c1","uid":1104819,"ip_address":"","ucode":"8493ACD4D14E0C","user_header":"https://static001.geekbang.org/account/avatar/00/10/db/b3/040eb673.jpg","comment_is_top":false,"comment_ctime":1584706712,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5879674008","product_id":100023901,"comment_content":"æ‰©å®½è§†é‡ï¼Œæä¾›æ€è·¯","like_count":1},{"had_liked":false,"id":145098,"user_name":"æ¢…å°è¥¿","can_delete":false,"product_type":"c1","uid":1101347,"ip_address":"","ucode":"AF47185323E6A2","user_header":"https://static001.geekbang.org/account/avatar/00/10/ce/23/d722d6ec.jpg","comment_is_top":false,"comment_ctime":1572188700,"is_pvip":false,"replies":[{"id":"56145","content":"æ¯ç§å¼‚æ­¥ä»»åŠ¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ï¼Œä¸å¯èƒ½æ‰€æœ‰çš„å¼‚æ­¥ä»»åŠ¡éƒ½ç”¨ä¸€ä¸ªã€‚å¦‚æœæŸäº›éœ€è¦å…±ç”¨ï¼Œå¯ä»¥åŒ…è£…ä¸€ä¸ªç±»å°±å¯ä»¥äº†","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1572309734,"ip_address":"","comment_id":145098,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5867155996","product_id":100023901,"comment_content":"è€å¸ˆè®²çš„æŒºä¸é”™çš„ï¼Œçœ‹äº†è¿™ä¸ªä¾‹å­ï¼Œæœ‰å‡ ç‚¹ç–‘é—®ï¼Œè¿˜å¸Œæœ›è€å¸ˆè¯´æ˜ä¸‹ï¼š<br>&#47;&#47; è¿™ä¸ªæ˜¯è€å¸ˆä¾‹å­ï¼š<br><br>&#47;&#47; åˆ›å»ºçº¿ç¨‹æ± <br>ExecutorService executor = <br>  Executors.newFixedThreadPool(3);<br>&#47;&#47; åˆ›å»ºCompletionService<br>CompletionService&lt;Integer&gt; cs = new <br>  ExecutorCompletionService&lt;&gt;(executor);<br>&#47;&#47; å¼‚æ­¥å‘ç”µå•†S1è¯¢ä»·<br>cs.submit(()-&gt;getPriceByS1());<br>&#47;&#47; å¼‚æ­¥å‘ç”µå•†S2è¯¢ä»·<br>cs.submit(()-&gt;getPriceByS2());<br>&#47;&#47; å¼‚æ­¥å‘ç”µå•†S3è¯¢ä»·<br>cs.submit(()-&gt;getPriceByS3());<br>&#47;&#47; å°†è¯¢ä»·ç»“æœå¼‚æ­¥ä¿å­˜åˆ°æ•°æ®åº“<br>for (int i=0; i&lt;3; i++) {<br>  Integer r = cs.take().get();<br>  executor.execute(()-&gt;save(r));<br>}<br><br>é¦–å…ˆï¼ŒCompletionServiceåº”è¯¥æ˜¯è¦ç»‘å®šæ³›å‹ï¼Œä»£è¡¨å¼‚æ­¥ä»»åŠ¡çš„è¿”å›ç»“æœï¼Œå®é™…åº”ç”¨ä¸­ï¼Œå‡ ä¹ä¸å¤ªå¯èƒ½æ‰€æœ‰çš„å¼‚æ­¥ä»»åŠ¡çš„è¿”å›ç±»å‹æ˜¯ä¸€æ ·çš„ï¼Œé™¤éè®¾ç½®æˆObjectè¿™ç§é€šç”¨å‹ï¼Œé‚£åˆä¼šå¯¼è‡´æ‹¿åˆ°ç»“æœåéœ€è¦å¼ºè½¬ï¼Œä»£ç çœ‹èµ·æ¥æ›´éš¾å—ï¼›<br>å…¶æ¬¡ï¼Œå¯¹äºè¿”å›çš„ç»“æœçš„å¤„ç†æ–¹å¼ï¼Œå®é™…åº”ç”¨ä¸­å‡ ä¹ä¹Ÿæ˜¯ä¸åŒçš„ï¼Œé‚£å°±è¦é’ˆå¯¹æ¯ä¸€ä¸ªtakeå‡ºæ¥çš„ç»“æœåšåˆ¤æ–­ï¼Œè¿™å®é™…ä¸Šä¹Ÿæ˜¯ä¼šå¯¼è‡´ä»£ç å¾ˆéš¾ç»´æŠ¤ï¼›<br><br>ç»¼ä¸Šï¼ŒCompletionService çœ‹æ¥èƒ½å¤Ÿåšæ‰¹é‡å¤„ç†å¼‚æ­¥ä»»åŠ¡çš„äº‹æƒ…ï¼Œå®é™…åº”ç”¨ä¸­ï¼Œæˆ‘æ„Ÿè§‰ä¸å¤ªå®ç”¨ï¼<br><br>ä»¥ä¸Šä¸¤ç‚¹æ˜¯ä¸ªäººè§è§£ï¼Œæœ‰ä¸å¯¹ä¹‹å¤„è¯·è€å¸ˆæŒ‡æ•™ï¼","like_count":1,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472246,"discussion_content":"æ¯ç§å¼‚æ­¥ä»»åŠ¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ï¼Œä¸å¯èƒ½æ‰€æœ‰çš„å¼‚æ­¥ä»»åŠ¡éƒ½ç”¨ä¸€ä¸ªã€‚å¦‚æœæŸäº›éœ€è¦å…±ç”¨ï¼Œå¯ä»¥åŒ…è£…ä¸€ä¸ªç±»å°±å¯ä»¥äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572309734,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132686,"user_name":"ideal sail","can_delete":false,"product_type":"c1","uid":1098870,"ip_address":"","ucode":"38E1C7DE8964DF","user_header":"https://static001.geekbang.org/account/avatar/00/10/c4/76/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1568191892,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5863159188","product_id":100023901,"comment_content":"è¯¾åæ€è€ƒä¸­åªè¦æŠŠæœ€å°å€¼çš„æ¯”è¾ƒæ”¾åœ¨ä¸»çº¿ç¨‹å°±å¥½äº†ï¼Œtakeä¸€æ¬¡æ¯”è¾ƒä¸€æ¬¡ï¼Œæ²¡å¿…è¦åœ¨å¤šä¸ªçº¿ç¨‹é‡Œè®¡ç®—æœ€å°å€¼ã€‚","like_count":1},{"had_liked":false,"id":129472,"user_name":"helloworld","can_delete":false,"product_type":"c1","uid":1015754,"ip_address":"","ucode":"00DF2FEC58D2E6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","comment_is_top":false,"comment_ctime":1567134409,"is_pvip":false,"replies":[{"id":"48636","content":"é—®é¢˜å‡ºåœ¨f1.get()ä¸æ˜¯å¼‚æ­¥çš„ï¼Œå®ƒä¼šé˜»å¡çº¿ç¨‹","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1567427618,"ip_address":"","comment_id":129472,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5862101705","product_id":100023901,"comment_content":"è€å¸ˆï¼Œå†’æ˜§çš„é—®ä¸‹ï¼šåœ¨æ–‡ç« åˆšå¼€å§‹çš„ä¾‹å­ï¼Œæ— è®ºæ˜¯ä¸‰ä¸ªè¯¢ä»·ä»»åŠ¡ï¼ˆé€šè¿‡submitæ–¹æ³•æäº¤ï¼‰ï¼Œè¿˜æ˜¯ä¿å­˜è¯¢ä»·ä»»åŠ¡ï¼ˆé€šè¿‡executeæ–¹æ³•æäº¤ï¼‰éƒ½æ˜¯å¼‚æ­¥çš„æ‰§è¡Œæ‰§è¡Œçš„å•Šï¼å¦‚æœs1è¯¢ä»·çš„æ—¶é—´è¿‡é•¿çš„è¯ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°s2ä¿å­˜ä¿ä»·çš„å…ˆæ‰§è¡Œå•Šï¼ä»–åªå½±å“åˆ°s1ä¿å­˜è¯¢ä»·çš„åŠ¨ä½œã€‚è€å¸ˆä¸çŸ¥é“æˆ‘è¯´çš„æœ‰ä¹ˆæœ‰é“ç†ï¼Œæœ‰é—®é¢˜è¯·è€å¸ˆå¸®å¿™æŒ‡æ­£","like_count":1,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465489,"discussion_content":"é—®é¢˜å‡ºåœ¨f1.get()ä¸æ˜¯å¼‚æ­¥çš„ï¼Œå®ƒä¼šé˜»å¡çº¿ç¨‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567427618,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89476,"user_name":"äº‘é‡Œé›¾èŠ±","can_delete":false,"product_type":"c1","uid":1232383,"ip_address":"","ucode":"98D8E75D1B2B39","user_header":"https://static001.geekbang.org/account/avatar/00/12/cd/ff/b7690816.jpg","comment_is_top":false,"comment_ctime":1556182220,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5851149516","product_id":100023901,"comment_content":"è¦è§£å†³ç­‰å¾…ä¸‰ä¸ªçº¿ç¨‹éƒ½è¿è¡Œç»“æŸçš„æ‰çŸ¥é“è°æ˜¯æœ€å°å€¼ã€‚CountDownLatchæˆ–è€…ä¸€ä¸ªåŸå­ç±»æ¥åšè®¡æ•°å™¨ç­‰éƒ½å¯ä»¥ã€‚","like_count":1},{"had_liked":false,"id":89436,"user_name":"hj","can_delete":false,"product_type":"c1","uid":1264287,"ip_address":"","ucode":"6ED34286AC30FA","user_header":"https://static001.geekbang.org/account/avatar/00/13/4a/9f/b92a9139.jpg","comment_is_top":false,"comment_ctime":1556174147,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5851141443","product_id":100023901,"comment_content":"ç¡®å®ï¼Œç¬¬ä¸€ä¸ªä¾‹å­è€å¸ˆä¸ºäº†æŠ›å‡ºé—®é¢˜å¼•å‡ºCompletionServiceï¼Œä½†æ˜¯é€»è¾‘ä¸Šçš„ç¡®ä¸æˆç«‹ã€‚ä¸æ˜¯f1.getï¼ˆï¼‰é˜»å¡ä¸»çº¿ç¨‹","like_count":1},{"had_liked":false,"id":89315,"user_name":"è‹å¿—è¾‰","can_delete":false,"product_type":"c1","uid":1068927,"ip_address":"","ucode":"39B25CE21C04EE","user_header":"https://static001.geekbang.org/account/avatar/00/10/4f/7f/5dc11380.jpg","comment_is_top":false,"comment_ctime":1556153823,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5851121119","product_id":100023901,"comment_content":"m.setå’Œgetå­˜åœ¨é™æ€æ¡ä»¶ä¸æ˜¯åŸå­çš„ï¼Œå¯èƒ½å­˜åœ¨è®¾ç½®å’Œä¸æ˜¯æœ€å°å€¼","like_count":1},{"had_liked":false,"id":89314,"user_name":"ç©ºç©ºç©ºç©º","can_delete":false,"product_type":"c1","uid":1082938,"ip_address":"","ucode":"A1A50E16E02803","user_header":"https://static001.geekbang.org/account/avatar/00/10/86/3a/76dbbd0e.jpg","comment_is_top":false,"comment_ctime":1556153750,"is_pvip":false,"replies":[{"id":"32339","content":"å¯¹çš„ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1556464822,"ip_address":"","comment_id":89314,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5851121046","product_id":100023901,"comment_content":"ç®—ä½ä»·çš„æ—¶å€™æ˜¯ç”¨ä¸‰ä¸ªä¸åŒçš„çº¿ç¨‹å»è®¡ç®—ï¼Œæ˜¯å¼‚æ­¥çš„ï¼Œå› æ­¤å¯èƒ½ç®—å‡ºæ¥å¹¶ä¸æ˜¯é¢„æœŸçš„ç»“æœ<br>è€å¸ˆï¼Œè¿™æ ·ç†è§£å¯¹å—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448089,"discussion_content":"å¯¹çš„ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556464822,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":351236,"user_name":"å¼€å¿ƒ","can_delete":false,"product_type":"c1","uid":1517457,"ip_address":"","ucode":"C8E08E8724C7CE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKkzrezV2dOBAgickt9DLzabz3dNFYyDEVXENMQ5ibrWhFbFqXIOia3ZaR21pozvB7UfoxJx4Ar688sA/132","comment_is_top":false,"comment_ctime":1657634240,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1657634240","product_id":100023901,"comment_content":"æœ‰ä¸ªç–‘é—®ï¼Œ æ–‡ç« çš„ä¾‹å­ä¸­ä¸‰ä¸ªçº¿ç¨‹å¤Ÿä¹ˆã€‚ å‰é¢æäº¤ä»»åŠ¡çš„æ—¶å€™å ç”¨äº†ä¸‰ä¸ªçº¿ç¨‹ã€‚ åé¢åˆæäº¤ä»»åŠ¡future.get()ã€‚ æ­¤æ—¶çº¿ç¨‹æ•°ä¸å¤Ÿäº†ï¼Œå¯èƒ½å¯¼è‡´ Aä»»åŠ¡æ‰§è¡Œå®Œé‡Šæ”¾å‡ºæ¥çš„çº¿ç¨‹æ‰§è¡Œ Bä»»åŠ¡å¾—åˆ°çš„future.get().","like_count":0},{"had_liked":false,"id":345955,"user_name":"å­¦ä¹ å­¦ä¸ªå±","can_delete":false,"product_type":"c1","uid":1049017,"ip_address":"","ucode":"DF2D61E6FB2FCE","user_header":"https://static001.geekbang.org/account/avatar/00/10/01/b9/73435279.jpg","comment_is_top":false,"comment_ctime":1652713061,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1652713061","product_id":100023901,"comment_content":"1 ç”±äºæ˜¯ execute æäº¤æäº¤å®Œä¼šç«‹é©¬ç»“æŸï¼Œå¯èƒ½å¼‚æ­¥å¤„ç†çš„ä»»åŠ¡è¿˜æ²¡æ‰§è¡Œå°±ç»“æŸäº†ï¼Œmæ˜¯æœ€å¤§å€¼<br>2 save r maybe is null ,npe å¼‚å¸¸<br>","like_count":0},{"had_liked":false,"id":341631,"user_name":"Carla","can_delete":false,"product_type":"c1","uid":1181454,"ip_address":"","ucode":"29608BF359A567","user_header":"","comment_is_top":false,"comment_ctime":1649741857,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1649741857","product_id":100023901,"comment_content":"è€å¸ˆï¼ŒExecutorCompletionServiceå’Œç›´æ¥æäº¤åˆ°çº¿ç¨‹æ± ï¼Œè¿”å›futureï¼Œå†æŠŠfutureæ”¾å…¥ä¸€ä¸ªlistï¼Œæœ€åéå†listè¿›è¡Œgetè¿™ç§æ–¹å¼ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜åŠ¿ä¹ˆã€‚è€Œä¸”æ ·ä¾‹ä»£ç ä¸­éœ€è¦çŸ¥é“ä»»åŠ¡çš„å…·ä½“ä¸ªæ•°ï¼Œæ‰èƒ½éå†ä»ExecutorCompletionServiceä¸­è·å–ï¼Œè¿™æ˜¯ä¸æ˜¯æœ‰å±€é™æ€§","like_count":0,"discussions":[{"author":{"id":2697700,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/LFJZ4x47rvShGhsePLIxc8EzdlBxAmVAIjJ2FQZ4NEpo8E4JCZQEOb2NIfOuiaQLL6Otkt7W3Rmu6Tv3AkgYdRA/132","nickname":"é”®ç›˜ä¸Šçš„é­”æœ¯","note":"","ucode":"A731D721FB8D3A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576625,"discussion_content":"åŒºåˆ«åœ¨äºcompletionServiceæ”¾å…¥queueé‡Œé¢çš„taskï¼Œæ˜¯ä»»åŠ¡å·²ç»æ‰§è¡Œå®Œæ¯•çš„ã€‚ ä»é‡Œé¢take()å‡ºæ¥çš„é¡ºåºï¼Œ å’Œä»»åŠ¡æ‰§è¡Œå¿«æ…¢é¡ºåºä¸€è‡´","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655708977,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":331401,"user_name":"never leave","can_delete":false,"product_type":"c1","uid":1241638,"ip_address":"","ucode":"62888A1446A1E8","user_header":"https://static001.geekbang.org/account/avatar/00/12/f2/26/8d42ea6f.jpg","comment_is_top":false,"comment_ctime":1642574637,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1642574637","product_id":100023901,"comment_content":"æˆ‘æƒ³é—®ä¸€ä¸‹   ä½¿ç”¨é˜»å¡é˜Ÿåˆ—çš„ä¾‹å­ä¸­   forå¾ªç¯å¦‚æœç”¨dq.size()æ§åˆ¶   ç¨‹åºä¸€ç›´æ²¡æœ‰è¾“å‡ºæ˜¯ä»€ä¹ˆåŸå› ï¼Ÿ","like_count":0},{"had_liked":false,"id":324493,"user_name":"zhongmin","can_delete":false,"product_type":"c1","uid":1265621,"ip_address":"","ucode":"C7AB10205A4F04","user_header":"https://static001.geekbang.org/account/avatar/00/13/4f/d5/1666b7d0.jpg","comment_is_top":false,"comment_ctime":1638456180,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1638456180","product_id":100023901,"comment_content":"ä¸æ¸…æ¥šè‡ªå·±å“ªé‡Œæ²¡æœ‰è€ƒè™‘åˆ°ğŸ˜‚è¿™é‡Œæˆ‘æ²¡æœ‰æ„Ÿè§‰å’Œå‰é¢è·å–æœ€å¿«çš„åœ°ç†æŸ¥è¯¢æœåŠ¡æœ‰å•¥åŒºåˆ«ï¼Ÿæˆ‘æ„Ÿè§‰æŠŠæ€è€ƒé¢˜ä¸­çš„çº¿ç¨‹æ± æäº¤éƒ¨åˆ†ï¼Œç›´æ¥æ”¹æˆä¹‹å‰çš„ cs.take().get() æ˜¯ä¸æ˜¯å¯ä»¥å¾—åˆ°æ­£ç¡®çš„ç»“æœã€‚<br><br>å› ä¸º CS ä¸­å·²ç»æŠŠå„ä¸ªçº¿ç¨‹çš„ Future ç»™å¡«å……åˆ°äº†å†…ç½®çš„é˜»å¡é˜Ÿåˆ—ï¼Œè€Œ get åˆä¼šåŒæ­¥è·å–ç­‰å¾…é˜»å¡çš„ç»“æœï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œè‚¯å®šæ˜¯ç­‰å¾…éƒ½åŒæ­¥è·å¾—ä¸‰ä¸ªçº¿ç¨‹çš„ç»“æœï¼Œæ‰§è¡Œã€‚æ‰€ä»¥æˆ‘æ„Ÿè§‰æ”¹æˆä¸‹é¢è¿™æ ·ï¼Œä¹Ÿèƒ½è·å¾—æ­£ç¡®çš„ç»“æœ<br><br>        &#47;&#47; å¹¶è®¡ç®—æœ€ä½æŠ¥ä»·<br>        AtomicReference&lt;Integer&gt; m = new AtomicReference&lt;&gt;(Integer.MAX_VALUE);<br>        for (int i = 0; i &lt; 3; i++) {<br>            Integer r = null;<br>            try {<br>                r = cs.take().get();<br>            } catch (Exception e) {<br>            }<br>            save(r);<br>            m.set(Integer.min(m.get(), r)); &#47;&#47; ä¸æ˜¯åŸå­æ“ä½œ<br>        }<br>        return m;","like_count":0,"discussions":[{"author":{"id":2697700,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/LFJZ4x47rvShGhsePLIxc8EzdlBxAmVAIjJ2FQZ4NEpo8E4JCZQEOb2NIfOuiaQLL6Otkt7W3Rmu6Tv3AkgYdRA/132","nickname":"é”®ç›˜ä¸Šçš„é­”æœ¯","note":"","ucode":"A731D721FB8D3A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576626,"discussion_content":"å…‰è°ˆæœ€å°å€¼çš„äº‹æƒ…ï¼Œç¡®å®ä½ è¯´çš„å¯ä»¥ã€‚ ä½†æ˜¯è¿™ä¸ªsave(r)æ²¡æœ‰å¼‚æ­¥ï¼Œè€å¸ˆæƒ³save(r)ä¹Ÿä¸€èµ·å¼‚æ­¥å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655709109,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":318889,"user_name":"Jussi Lee","can_delete":false,"product_type":"c1","uid":1211190,"ip_address":"","ucode":"F2F5948CCD52A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/7b/36/fd46331c.jpg","comment_is_top":false,"comment_ctime":1635474365,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1635474365","product_id":100023901,"comment_content":"è€å¸ˆï¼Œæœ‰è¿™ç§éœ€æ±‚ï¼š<br>1.æˆ‘é€šè¿‡CompletionServiceæ‰¹é‡æäº¤äº†å¤šä¸ªä»»åŠ¡ï¼Œå¯èƒ½æœ‰æŸä¸ªä»»åŠ¡å¤„ç†å¤±è´¥äº†ã€‚æˆ‘éœ€è¦æŠŠè¿™ç§å¤±è´¥çš„ä»»åŠ¡è®°å½•ä¸‹æ¥å¦‚ä½•å¤„ç†ï¼Ÿ<br>2.çœ‹åˆ°æ–‡ä¸­æœ‰æåˆ°ä½¿ç”¨pollæ˜¯å¯ä»¥è¶…æ—¶è·å–ä¸€ä¸ªç©ºå€¼çš„ï¼Œè¶…æ—¶æ‰§è¡Œçš„ä»»åŠ¡æˆ‘ä»¬å¦‚ä½•è®°å½•ä¸‹æ¥ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2434363,"avatar":"https://static001.geekbang.org/account/avatar/00/25/25/3b/864c5115.jpg","nickname":"saiuna","note":"","ucode":"8DB9C47C965195","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":411851,"discussion_content":"è¶…æ—¶æ—¶ï¼Œtake() è¿”å›çš„æ˜¯nullå€¼ï¼Œåˆ¤ç©ºåšè®°å½•å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636018314,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2434363,"avatar":"https://static001.geekbang.org/account/avatar/00/25/25/3b/864c5115.jpg","nickname":"saiuna","note":"","ucode":"8DB9C47C965195","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":411850,"discussion_content":"å¸­å“¥ï¼Ÿå¦ˆè€¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636018204,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":306450,"user_name":"åˆ˜è‚²é£","can_delete":false,"product_type":"c1","uid":1363642,"ip_address":"","ucode":"06600614E898CC","user_header":"https://static001.geekbang.org/account/avatar/00/14/ce/ba/f73555c7.jpg","comment_is_top":false,"comment_ctime":1628566360,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1628566360","product_id":100023901,"comment_content":"è¯·é—® å…³äºåªè¦è·å–ä¸€ä¸ªå€¼å°±å¯ä»¥ è¿”å›å¾—é‚£é‡Œï¼Œåº”è¯¥å¯ä»¥ä¸éœ€è¦Futureé›†åˆå»è£…, Futureé›†åˆ åªæ˜¯ä¸ºäº† å–æ¶ˆæ‰§è¡Œä¸­å¾—çº¿ç¨‹ï¼Œå‡å°‘èµ„æºå¾—æ¶ˆè€—å—","like_count":0},{"had_liked":false,"id":297171,"user_name":"SonKi","can_delete":false,"product_type":"c1","uid":2055727,"ip_address":"","ucode":"E619DE2930266A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqoMJKawfU2Tia213fSM16GgFJiagjDrSDg9lBuYeuO4iatxXI61E43iczuqd191FG40vZY75zrFLtzow/132","comment_is_top":false,"comment_ctime":1623339534,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1623339534","product_id":100023901,"comment_content":"&#47;&#47; åˆ›å»ºçº¿ç¨‹æ± <br>        ExecutorService executor =<br>                Executors.newFixedThreadPool(3);<br>        &#47;&#47; åˆ›å»ºCompletionService<br>        CompletionService&lt;Integer&gt; cs = new<br>                ExecutorCompletionService&lt;&gt;(executor);<br>        List&lt;Future&lt;Integer&gt;&gt; futures = new ArrayList&lt;&gt;();<br>        futures.add(cs.submit(() -&gt; {<br>            int i = BigDecimal.valueOf(Math.random()).multiply(BigDecimal.valueOf(1000)).intValue();<br>            System.out.println(i);<br>            return i;<br>        }));<br>        futures.add(cs.submit(() -&gt; {<br>            int i = BigDecimal.valueOf(Math.random()).multiply(BigDecimal.valueOf(1000)).intValue();<br>            System.out.println(i);<br>            return i;<br>        }));<br>        futures.add(cs.submit(() -&gt; {<br>            int i = BigDecimal.valueOf(Math.random()).multiply(BigDecimal.valueOf(1000)).intValue();<br>            System.out.println(i);<br>            return i;<br>        }));<br>        &#47;&#47; å°†è¯¢ä»·ç»“æœå¼‚æ­¥ä¿å­˜åˆ°æ•°æ®åº“<br>        &#47;&#47; å¹¶è®¡ç®—æœ€ä½æŠ¥ä»·<br>        AtomicReference&lt;Integer&gt; m = new AtomicReference&lt;&gt;(Integer.MAX_VALUE);<br>        for (int i = 0; i &lt; 3; i++) {<br>            Integer r = cs.take().get();<br>            synchronized (m) {<br>                Integer integer = m.get();<br>                m.set(Integer.min(r, integer));<br>            }<br>        }<br>        System.out.println(&quot;æœ€å°å€¼ï¼š&quot; + m);","like_count":0},{"had_liked":false,"id":296394,"user_name":"éœéœ","can_delete":false,"product_type":"c1","uid":1542586,"ip_address":"","ucode":"A483D42AD7F72D","user_header":"https://static001.geekbang.org/account/avatar/00/17/89/ba/009ee13c.jpg","comment_is_top":false,"comment_ctime":1622951241,"is_pvip":true,"discussion_count":0,"race_medal":2,"score":"1622951241","product_id":100023901,"comment_content":"è€å¸ˆï¼Œæƒ³é—®ä¸€ä¸‹complemetion serviceçš„å¼‚å¸¸å¤„ç†ï¼Œè®°å¾—ä»–å¥½åƒæœ‰ä¸€ä¸ªè¿è¡ŒæœŸå¼‚å¸¸æ˜¯ExecutionExceptionï¼Œåº”è¯¥å¦‚ä½•ä¼˜é›…å¤„ç†","like_count":0},{"had_liked":false,"id":288543,"user_name":"å¨å…ˆæ£®","can_delete":false,"product_type":"c1","uid":1687656,"ip_address":"","ucode":"5F445C6832274B","user_header":"https://static001.geekbang.org/account/avatar/00/19/c0/68/314e8306.jpg","comment_is_top":false,"comment_ctime":1618534851,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618534851","product_id":100023901,"comment_content":"è€å¸ˆï¼Œä¸‹é¢è¿™ä¸ªä¾‹å­çš„forå¾ªç¯æœ‰æ„ä¹‰å—ï¼Ÿ<br>&#47;&#47; åˆ›å»ºçº¿ç¨‹æ± <br>ExecutorService executor =<br>  Executors.newFixedThreadPool(3);<br>&#47;&#47; åˆ›å»ºCompletionService<br>CompletionService&lt;Integer&gt; cs =<br>  new ExecutorCompletionService&lt;&gt;(executor);<br>&#47;&#47; ç”¨äºä¿å­˜Futureå¯¹è±¡<br>List&lt;Future&lt;Integer&gt;&gt; futures =<br>  new ArrayList&lt;&gt;(3);<br>&#47;&#47;æäº¤å¼‚æ­¥ä»»åŠ¡ï¼Œå¹¶ä¿å­˜futureåˆ°futures <br>futures.add(<br>  cs.submit(()-&gt;geocoderByS1()));<br>futures.add(<br>  cs.submit(()-&gt;geocoderByS2()));<br>futures.add(<br>  cs.submit(()-&gt;geocoderByS3()));<br>&#47;&#47; è·å–æœ€å¿«è¿”å›çš„ä»»åŠ¡æ‰§è¡Œç»“æœ<br>Integer r = 0;<br>try {<br>  &#47;&#47; åªè¦æœ‰ä¸€ä¸ªæˆåŠŸè¿”å›ï¼Œåˆ™break<br>  for (int i = 0; i &lt; 3; ++i) {<br>    r = cs.take().get();<br>    &#47;&#47;ç®€å•åœ°é€šè¿‡åˆ¤ç©ºæ¥æ£€æŸ¥æ˜¯å¦æˆåŠŸè¿”å›<br>    if (r != null) {<br>      break;<br>    }<br>  }<br>} finally {<br>  &#47;&#47;å–æ¶ˆæ‰€æœ‰ä»»åŠ¡<br>  for(Future&lt;Integer&gt; f : futures)<br>    f.cancel(true);<br>}<br>&#47;&#47; è¿”å›ç»“æœ<br>return r;","like_count":0},{"had_liked":false,"id":285888,"user_name":"ç››æƒ_vinc","can_delete":false,"product_type":"c1","uid":1459845,"ip_address":"","ucode":"4688DD06587CE2","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/LPnuO9GleKEwso2rSbibmbEwn49hnGl9qTQDBv2xLOOWOflQsc9oVEEuZgNBt7TrqRKvk8CX7Tc8iakhEicBCCfFg/132","comment_is_top":false,"comment_ctime":1617065841,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617065841","product_id":100023901,"comment_content":"è€å¸ˆï¼ŒæŠŠæ–‡ç« ä¸­çš„ç¬¬ä¸€æ®µä»£ç å—å’Œç¬¬äºŒæ®µä»£ç å—æ”¾åœ¨ä¸€èµ·è¿˜æ˜¯ä¸èƒ½è°è¯¢ä»·ç»“æŸå°±å¡è°è¿›é˜Ÿåˆ—ğŸ˜‚çº¿ç¨‹æ± å¤§å°åªæœ‰3","like_count":0},{"had_liked":false,"id":282551,"user_name":"ä¿ºèƒ½å­¦ä¸ªå•¥","can_delete":false,"product_type":"c1","uid":1026742,"ip_address":"","ucode":"30740C5B58774C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/aa/b6/46a5bbf3.jpg","comment_is_top":false,"comment_ctime":1615298924,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1615298924","product_id":100023901,"comment_content":"å¾ªç¯ä½“é‡Œæäº¤ä¸‰ä¸ªä»»åŠ¡åï¼Œç›´æ¥returnäº†ï¼Œæœ‰å¯èƒ½è¿˜æ²¡æ‰§è¡Œå®Œæ¯•ã€‚å¯ä»¥æŠŠçº¿ç¨‹æ± æäº¤å»æ‰ï¼Œç›´æ¥æ”¹ä¸ºä¸²è¡Œgeté˜»å¡å³å¯ã€‚å–æœ€å°å€¼è‚¯å®šéœ€è¦æ‰€æœ‰ç»“æœè¿”å›ï¼Œè¿™é‡Œä¹Ÿæ²¡æœ‰å…¶ä»–è€—æ—¶æ“ä½œï¼Œå®Œå…¨å¯ä»¥ä¸²è¡Œgeté˜»å¡å–ç»“æœç„¶åæ¯”è¾ƒ","like_count":0},{"had_liked":false,"id":275737,"user_name":"Bruce","can_delete":false,"product_type":"c1","uid":1106929,"ip_address":"","ucode":"B2F562F717BD3C","user_header":"https://static001.geekbang.org/account/avatar/00/10/e3/f1/346bd356.jpg","comment_is_top":false,"comment_ctime":1611654870,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1611654870","product_id":100023901,"comment_content":"è€å¸ˆï¼Œç›´æ¥ç”¨executor.shutdownNow()ï¼Œæ˜¯ä¸æ˜¯è·Ÿéå†Futureï¼ŒæŒ¨ä¸ªcancel(true)ä¸€ä¸ªæ•ˆæœï¼Ÿ","like_count":0},{"had_liked":false,"id":275645,"user_name":"å•Šè‰¯æ¢“æ˜¯æˆ‘","can_delete":false,"product_type":"c1","uid":1655117,"ip_address":"","ucode":"E42FC1A60D331C","user_header":"https://static001.geekbang.org/account/avatar/00/19/41/4d/f6d6d13a.jpg","comment_is_top":false,"comment_ctime":1611630637,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1611630637","product_id":100023901,"comment_content":"åˆ›å»ºä¸€ä¸ªlist é›†åˆ  ç„¶å æŠŠ Future f1 f2 f3 å­˜è¿›é›†åˆä¸­ï¼Œ <br>ä¹‹åéå†é›†åˆ future.get()æ–¹æ³• ï¼Œå®ç° é˜»å¡é˜Ÿåˆ—çš„ä½œç”¨ã€‚","like_count":0},{"had_liked":false,"id":275232,"user_name":"å–ƒå¯»","can_delete":false,"product_type":"c1","uid":1565085,"ip_address":"","ucode":"E31B3660726671","user_header":"https://static001.geekbang.org/account/avatar/00/17/e1/9d/3ec0adec.jpg","comment_is_top":false,"comment_ctime":1611399862,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1611399862","product_id":100023901,"comment_content":"mçš„å€¼éœ€è¦ç­‰å¾…ä¸‰ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œåè·å–æ‰è¡Œ,å¯ä»¥ç”¨CountDownLatch å®ç°","like_count":0},{"had_liked":false,"id":269359,"user_name":"å¼ æ´‹","can_delete":false,"product_type":"c1","uid":1182914,"ip_address":"","ucode":"549BE5DEEF8417","user_header":"https://static001.geekbang.org/account/avatar/00/12/0c/c2/bad34a50.jpg","comment_is_top":false,"comment_ctime":1608623207,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1608623207","product_id":100023901,"comment_content":"è€å¸ˆ r = cs.take().get(); æ„Ÿè§‰è¿™ç‚¹å®Œå…¨æ²¡æœ‰å¿…è¦ å¼€å¯å¼‚æ­¥å»æ“ä½œå‘€ï¼Œçœ‹äº†è¯„è®ºçš„ åŠ ä¸€ä¸ªCountDownLanch è¿›è¡Œç­‰å¾…ä¸‰ä¸ªçº¿ç¨‹ï¼Œæ„Ÿè§‰è¿™æ ·æœ‰ç‚¹ç±»ä¼¼ä¸åŒæ­¥-&gt;å¼‚æ­¥-&gt;åŒæ­¥çš„æ„Ÿè§‰ï¼Œç›´æ¥åŒæ­¥æ‰§è¡Œ r = cs.take().get();å°±è¡Œäº†å§","like_count":0},{"had_liked":false,"id":266706,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1607444587,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607444587","product_id":100023901,"comment_content":"æœ€åä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼ˆéæ€è€ƒé¢˜ï¼‰ï¼Œæˆ‘æ„Ÿè§‰æœ€åè®¡ç®—çš„æ—¶å€™ä¸éœ€è¦ç”¨ä¸€ä¸ªforå¾ªç¯å§ï¼Œç›´æ¥    r = cs.take().get()  ä¸å°±è¡Œäº†å—","like_count":0},{"had_liked":false,"id":266704,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1607444290,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607444290","product_id":100023901,"comment_content":"å†æ¬¡æ‹œè¯»æœ¬ç¯‡ï¼Œé€šä¿—æ˜“æ‡‚ã€‚<br>ä»¥å‰æ˜¯å¬çš„ï¼Œæ²¡getåˆ°","like_count":0},{"had_liked":false,"id":252326,"user_name":"maybe","can_delete":false,"product_type":"c1","uid":1475528,"ip_address":"","ucode":"93D160F617E750","user_header":"https://static001.geekbang.org/account/avatar/00/16/83/c8/5ce842f6.jpg","comment_is_top":false,"comment_ctime":1602236999,"is_pvip":false,"discussion_count":0,"race_medal":4,"score":"1602236999","product_id":100023901,"comment_content":"return mçš„æ—¶å€™ä¸‰ä¸ªçº¿ç¨‹è¿˜æœªæ‰§è¡Œå®Œï¼Œmå€¼ä¸å¯¹","like_count":0},{"had_liked":false,"id":247205,"user_name":"é™ˆåº·åº·","can_delete":false,"product_type":"c1","uid":1192741,"ip_address":"","ucode":"A34A0DC88D6E77","user_header":"https://static001.geekbang.org/account/avatar/00/12/33/25/eac79a47.jpg","comment_is_top":false,"comment_ctime":1599633829,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599633829","product_id":100023901,"comment_content":"æŸ¥è¯¢æŠ¥ä»·å’Œè®¡ç®—æœ€ä½ä»·ä½¿ç”¨çš„åŒä¸€ä¸ªå›ºå®šå¤§å°æ˜¯3çš„çº¿ç¨‹æ± ï¼Œå¯èƒ½ä¼šå› ä¸ºè®¡ç®—æœ€ä½ä»·çš„ä»»åŠ¡å…ˆæ‰§è¡Œï¼Œè¿™æ ·å­ï¼Œä¸‰ä¸ªè®¡ç®—æœ€ä½ä»·çš„ä»»åŠ¡ä¼šæŠŠçº¿ç¨‹æ± çš„ä¸‰ä¸ªçº¿ç¨‹éƒ½å ç”¨ï¼Œå¹¶ä¸”ä¸€ç›´é˜»å¡ï¼Œå¯¼è‡´ç¨‹åºä¸€ç›´é˜»å¡æŠŠ","like_count":0},{"had_liked":false,"id":232766,"user_name":"M","can_delete":false,"product_type":"c1","uid":1810576,"ip_address":"","ucode":"06F26E1D62E9C9","user_header":"https://wx.qlogo.cn/mmopen/vi_32/eLNeJNaEkwGSK7xvtamMibVLMy2MpbIqX3iaEhT7JtSnTRMRTwZ2j4HX7WAapiashbiaBDVriaXKSP0Oeic6ZAEVEXag/132","comment_is_top":false,"comment_ctime":1594113078,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594113078","product_id":100023901,"comment_content":"è€å¸ˆæ€è€ƒé¢˜æœ‰ä¸ªç–‘é—®<br>é‚£ä¸ªå¾ªç¯ï¼Œä¸æ˜¯è¦å¾ªç¯ä¸‰æ¬¡åï¼Œè·å¾—æœ€ä½ä»·è¿”å›ï¼Œä¸ºä»€ä¹ˆè¯´ä¸‰ä¸ªçº¿ç¨‹ä¸èƒ½æ‰§è¡Œå®Œå‘¢ï¼Ÿ é‚£ä¸ªtakeæ–¹æ³•å’Œfutureçš„getæ–¹æ³•ä¸éƒ½æ˜¯é˜»å¡æ–¹æ³•ä¹ˆï¼Ÿ <br>","like_count":0},{"had_liked":false,"id":228170,"user_name":"å¤©åœ°é—²","can_delete":false,"product_type":"c1","uid":1241176,"ip_address":"","ucode":"1D5F8F8BFBE12A","user_header":"https://static001.geekbang.org/account/avatar/00/12/f0/58/59aa43b4.jpg","comment_is_top":false,"comment_ctime":1592575838,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592575838","product_id":100023901,"comment_content":"3ä¸ªåªè¦æœ‰ä¸€ä¸ªè¿”å›çš„ä¾‹å­ä¸­ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥æœç”¨forå¾ªç¯3æ¬¡ï¼Œç›´æ¥è°ƒç”¨cs.take().get","like_count":0},{"had_liked":false,"id":203335,"user_name":"å¥³å·«åœ¨å¯’æ±Ÿ","can_delete":false,"product_type":"c1","uid":1013180,"ip_address":"","ucode":"B3707072224C1C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/75/bc/664bbdf7.jpg","comment_is_top":false,"comment_ctime":1586175783,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1586175783","product_id":100023901,"comment_content":"é¦–å…ˆï¼Œr = cs.take().get();åº”è¯¥æ”¾åˆ°executeå¤–é¢ï¼ŒåŒæ­¥é˜»å¡çš„ç­‰å¾…ï¼Œåªè¦å¾—å‡ºä¸€ä¸ªç»“æœå°±å¼€å§‹æ‰§è¡Œä¿å­˜å’Œæ¯”ä»·ï¼Œè€Œä¸æ˜¯å„è‡ªèµ·ä¸‰ä¸ªçº¿ç¨‹å»ç­‰å¾…ç»“æœï¼›<br>å…¶æ¬¡saveï¼ˆrï¼‰ä¸åº”è¯¥æ”¾åˆ°exceptioné‚£ä¸ªå¤„ç†é‡Œé¢ï¼Œä»–åº”è¯¥æ˜¯ä¸€ä¸ªæ­£å¸¸é€»è¾‘ï¼›","like_count":0},{"had_liked":false,"id":197508,"user_name":"hellojd","can_delete":false,"product_type":"c1","uid":1341697,"ip_address":"","ucode":"4E51807AE7E472","user_header":"https://static001.geekbang.org/account/avatar/00/14/79/01/e71510dc.jpg","comment_is_top":false,"comment_ctime":1585382459,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585382459","product_id":100023901,"comment_content":"å–œæ¬¢è¿™ä¸ªæ¨¡å—ï¼Œå¹¶å‘è®¾è®¡æ¨¡å¼ï¼Œå¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨","like_count":0},{"had_liked":false,"id":195505,"user_name":"å‰å®³äº†æˆ‘çš„å›½","can_delete":false,"product_type":"c1","uid":1052191,"ip_address":"","ucode":"CD0A54A1B998AA","user_header":"https://static001.geekbang.org/account/avatar/00/10/0e/1f/d0472177.jpg","comment_is_top":false,"comment_ctime":1585191930,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585191930","product_id":100023901,"comment_content":"csé‡Œçš„é˜»å¡é˜Ÿåˆ—å­˜çš„æ˜¯futureï¼Œé‚£åç»­æ‰§è¡Œcs.take().get()è¿˜æ˜¯ä¼šé˜»å¡å•Šã€‚ã€‚ï¼Œæ˜¯æˆ‘ç†è§£çš„æœ‰é—®é¢˜å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":177568,"user_name":"è–¯ç‰‡","can_delete":false,"product_type":"c1","uid":1072044,"ip_address":"","ucode":"FE757E1248EFF5","user_header":"https://static001.geekbang.org/account/avatar/00/10/5b/ac/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1581425719,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581425719","product_id":100023901,"comment_content":"é—®ä¸€ä¸ªæ›´å°ç™½çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆç¬¬ä¸€ä¸ªä¾‹å­ä¸­ï¼Œè¦ç”¨é˜»å¡é˜Ÿåˆ—ï¼Œç”¨æ™®é€šé˜Ÿåˆ—ä¼šæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":176906,"user_name":"supermouse","can_delete":false,"product_type":"c1","uid":1321860,"ip_address":"","ucode":"88072D5F881827","user_header":"https://static001.geekbang.org/account/avatar/00/14/2b/84/07f0c0d6.jpg","comment_is_top":false,"comment_ctime":1581220099,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1581220099","product_id":100023901,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œä¸ºä»€ä¹ˆæˆ‘å†™çš„è¿™ä¸ªç”¨CompletionServiceåˆ›å»ºå››ä¸ªçº¿ç¨‹è®¡ç®—ä»1åŠ åˆ°nçš„ç¨‹åºåœ¨æ‰“å°å‡ºæœ€åçš„ç»“æœåæ²¡æœ‰é€€å‡ºå‘¢ï¼Ÿ<br>public class TestCompletionService {<br>    private static long addRange(long start, long end){<br>        long sum = 0;<br>        for (long i = start; i &lt;= end; i++) {<br>            sum += i;<br>        }<br>        return sum;<br>    }<br>    public static void main(String[] args) throws InterruptedException, ExecutionException {<br>        long n = 3000000000L;<br>        Long res = 0L;<br><br>        ExecutorService executor = Executors.newFixedThreadPool(4); &#47;&#47;åˆ›å»ºçº¿ç¨‹æ± <br>        CompletionService&lt;Long&gt; cs = new ExecutorCompletionService&lt;&gt;(executor);<br><br>        cs.submit(() -&gt; addRange(1L, n &gt;&gt; 2));<br>        cs.submit(() -&gt; addRange((n &gt;&gt; 2) + 1, n &gt;&gt; 1));<br>        cs.submit(() -&gt; addRange((n &gt;&gt; 1) + 1, (n &gt;&gt; 2) * 3));<br>        cs.submit(() -&gt; addRange((n &gt;&gt; 2) * 3 + 1, n));<br><br>        for (int i = 0; i &lt; 4; i++) {<br>            res += cs.take().get();<br>        }<br>        System.out.println(res);<br>    }<br>}","like_count":0,"discussions":[{"author":{"id":1052191,"avatar":"https://static001.geekbang.org/account/avatar/00/10/0e/1f/d0472177.jpg","nickname":"å‰å®³äº†æˆ‘çš„å›½","note":"","ucode":"CD0A54A1B998AA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":214463,"discussion_content":"çº¿ç¨‹æ± éœ€è¦å…³é—­ï¼Œexecutor.shutdown()","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585195071,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":176057,"user_name":"æ—…é€”","can_delete":false,"product_type":"c1","uid":1212902,"ip_address":"","ucode":"5022477E8E9441","user_header":"https://static001.geekbang.org/account/avatar/00/12/81/e6/6cafed37.jpg","comment_is_top":false,"comment_ctime":1580925293,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1580925293","product_id":100023901,"comment_content":"è€å¸ˆ é—®ä¸€ä¸‹ ç”¨ CompletionService å®ç° Dubbo ä¸­çš„ Forking Cluster è¿™ä¸ªä¾‹å­ ä¸ºä»€ä¹ˆä½¿ç”¨äº†ä¸€ä¸ªfutureé›†åˆ  åƒä¹‹å‰çš„ä¾‹å­ä¸€æ · ç›´æ¥ç”¨CompletionServiceå¯¹è±¡çš„takeä¸è¡Œå— ","like_count":0},{"had_liked":false,"id":167542,"user_name":"silentyears","can_delete":false,"product_type":"c1","uid":1061748,"ip_address":"","ucode":"6E137BFEB874CA","user_header":"https://static001.geekbang.org/account/avatar/00/10/33/74/d9d143fa.jpg","comment_is_top":false,"comment_ctime":1577852125,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1577852125","product_id":100023901,"comment_content":"è€å¸ˆï¼Œè¯·é—®ï¼Œè·å–åˆ°ä¸€ä¸ªå°±è¿”å›çš„ç¤ºä¾‹ä¸­ï¼Œå¦‚æœcancelæ—¶ï¼Œcancelçš„æ–¹æ³•æ‰§è¡Œçš„RPCä¹‹ç±»çš„è°ƒç”¨ï¼Œä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µï¼Ÿ","like_count":0},{"had_liked":false,"id":163446,"user_name":"ç‰¹é›·è¥¿çš®çš®","can_delete":false,"product_type":"c1","uid":1564539,"ip_address":"","ucode":"0BE139A55157F0","user_header":"https://static001.geekbang.org/account/avatar/00/17/df/7b/4ad93869.jpg","comment_is_top":false,"comment_ctime":1576722934,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576722934","product_id":100023901,"comment_content":"f1.get()å ç”¨äº†çº¿ç¨‹æ± çš„ä¸€ä¸ªçº¿ç¨‹ã€‚ä¸æ˜¯è®©ä¼˜å…ˆæ‰§è¡Œå®Œçš„æ¥å ç”¨ï¼Œæ‰€ä»¥ç›¸å½“äºä¸€å®šç¨‹åº¦ä¸Šé˜»å¡äº†ã€‚","like_count":0},{"had_liked":false,"id":148707,"user_name":"Joker","can_delete":false,"product_type":"c1","uid":1156592,"ip_address":"","ucode":"126AF848001A1E","user_header":"https://static001.geekbang.org/account/avatar/00/11/a5/f0/8648c464.jpg","comment_is_top":false,"comment_ctime":1573051799,"is_pvip":false,"replies":[{"id":"57281","content":"ä½ è¯´çš„ä¹Ÿä¸é”™ï¼Œä¸ºäº†ä»£ç è¡Œæ•°å°‘ä¸€ç‚¹","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1573085287,"ip_address":"","comment_id":148707,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1573051799","product_id":100023901,"comment_content":"è€å¸ˆï¼Œé‚£ä¸ªfuturesä¿å­˜futureå°±æ˜¯ä¸ºäº†åé¢å–æ¶ˆ(`cancel()`)ï¼Œå¯¹å§","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473578,"discussion_content":"ä½ è¯´çš„ä¹Ÿä¸é”™ï¼Œä¸ºäº†ä»£ç è¡Œæ•°å°‘ä¸€ç‚¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573085287,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":146527,"user_name":"ä½•å¦¨","can_delete":false,"product_type":"c1","uid":1385377,"ip_address":"","ucode":"EC3983BFF7992A","user_header":"https://static001.geekbang.org/account/avatar/00/15/23/a1/b08f3ee7.jpg","comment_is_top":false,"comment_ctime":1572568789,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572568789","product_id":100023901,"comment_content":"å…³äºè¯¾åé—®é¢˜ï¼Œæˆ‘ç†è§£çš„æ˜¯å¾ªç¯å†…ä¸å¼€å¯æ–°çš„çº¿ç¨‹æ¥åšå°±å¯ä»¥äº†ï¼Œæœ¬èº«æƒ³è·å–æœ€å°å€¼å°±å¿…é¡»çŸ¥é“æ‰€æœ‰çš„å€¼ï¼Œè¿™éœ€è¦ä¸²è¡Œé˜»å¡çš„ã€‚<br><br>&#47;&#47; åˆ›å»ºçº¿ç¨‹æ± <br>ExecutorService executor = <br>  Executors.newFixedThreadPool(3);<br>&#47;&#47; åˆ›å»º CompletionService<br>CompletionService&lt;Integer&gt; cs = new <br>  ExecutorCompletionService&lt;&gt;(executor);<br>&#47;&#47; å¼‚æ­¥å‘ç”µå•† S1 è¯¢ä»·<br>cs.submit(()-&gt;getPriceByS1());<br>&#47;&#47; å¼‚æ­¥å‘ç”µå•† S2 è¯¢ä»·<br>cs.submit(()-&gt;getPriceByS2());<br>&#47;&#47; å¼‚æ­¥å‘ç”µå•† S3 è¯¢ä»·<br>cs.submit(()-&gt;getPriceByS3());<br>&#47;&#47; å°†è¯¢ä»·ç»“æœå¼‚æ­¥ä¿å­˜åˆ°æ•°æ®åº“<br>&#47;&#47; å¹¶è®¡ç®—æœ€ä½æŠ¥ä»·<br>AtomicReference&lt;Integer&gt; m =<br>  new AtomicReference&lt;&gt;(Integer.MAX_VALUE);<br>for (int i=0; i&lt;3; i++) {<br>  <br>    Integer r = null;<br>    try {<br>      r = cs.take().get();<br>    } catch (Exception e) {}<br>    save(r);<br>    m.set(Integer.min(m.get(), r));<br>  <br>}<br>return m;","like_count":0},{"had_liked":false,"id":146245,"user_name":"ä½•å¦¨","can_delete":false,"product_type":"c1","uid":1385377,"ip_address":"","ucode":"EC3983BFF7992A","user_header":"https://static001.geekbang.org/account/avatar/00/15/23/a1/b08f3ee7.jpg","comment_is_top":false,"comment_ctime":1572482938,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1572482938","product_id":100023901,"comment_content":"try {<br>  &#47;&#47; åªè¦æœ‰ä¸€ä¸ªæˆåŠŸè¿”å›ï¼Œåˆ™ break<br>  for (int i = 0; i &lt; 3; ++i) {<br>    r = cs.take().get();<br>    &#47;&#47; ç®€å•åœ°é€šè¿‡åˆ¤ç©ºæ¥æ£€æŸ¥æ˜¯å¦æˆåŠŸè¿”å›<br>    if (r != null) {<br>      break;<br>    }<br>  }<br>} finally {<br>  &#47;&#47; å–æ¶ˆæ‰€æœ‰ä»»åŠ¡<br>  for(Future&lt;Integer&gt; f : futures)<br>    f.cancel(true);<br>}<br>æˆ‘æœ‰ä¸ªç–‘é—®ï¼Œè¿™ä¸ªè·å–çš„å¾ªç¯ä¸åº”è¯¥ç”¨æ­»å¾ªç¯ä¹ˆï¼Ÿå¾ªç¯3æ¬¡æ˜¯æ€ä¹ˆä¿è¯ä¸€å®šèƒ½æ‹¿åˆ°æ•°æ®çš„å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1385377,"avatar":"https://static001.geekbang.org/account/avatar/00/15/23/a1/b08f3ee7.jpg","nickname":"ä½•å¦¨","note":"","ucode":"EC3983BFF7992A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":41903,"discussion_content":"æˆ‘æ‡‚äº†ã€‚csçš„takeæ–¹æ³•æ˜¯é˜»å¡çš„ã€‚\né‚£ä¸ºä»€ä¹ˆè¦å¾ªç¯3æ¬¡å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572530147,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1123043,"avatar":"https://static001.geekbang.org/account/avatar/00/11/22/e3/510b69f9.jpg","nickname":"benny","note":"","ucode":"E2F30AF0C808D9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1385377,"avatar":"https://static001.geekbang.org/account/avatar/00/15/23/a1/b08f3ee7.jpg","nickname":"ä½•å¦¨","note":"","ucode":"EC3983BFF7992A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":106402,"discussion_content":"3ä¸ªä»»åŠ¡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577535388,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":41903,"ip_address":""},"score":106402,"extra":""}]}]},{"had_liked":false,"id":135232,"user_name":"nsn_huang","can_delete":false,"product_type":"c1","uid":1041796,"ip_address":"","ucode":"D8C6DA6530F3B6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e5/84/4a01e18d.jpg","comment_is_top":false,"comment_ctime":1569073487,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569073487","product_id":100023901,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œè®²è¯¾åæ€è€ƒé¢˜éƒ¨åˆ†ä»£ç è¿™æ ·æ”¹è¡Œä¹ˆï¼Ÿ<br>for (int i=0; i&lt;3; i++) {<br>    Integer r = null;<br>    try {<br>      r = cs.take().get();<br>    } catch (Exception e) {}<br>    save(r);<br>    m.set(Integer.min(m.get(), r));<br>}<br>æˆ‘è§‰å¾—cs.take().get();æ˜¯é˜»å¡çš„ï¼Œæ‰€ä»¥åŒæ­¥æ‰§è¡Œå°±å¥½äº†ï¼Œå¾ªç¯ä¸‰æ¬¡ï¼Œè¯¢ä»·ä¸‰æ¬¡ä¹‹åå°±èƒ½ç¡®å®šç»“æœäº†ã€‚ä¸çŸ¥é“è¿™æ ·å¯¹ä¸å¯¹ï¼Œå¸Œæœ›è€å¸ˆæŒ‡æ•™ã€‚","like_count":0},{"had_liked":false,"id":135208,"user_name":"FantasyZsp","can_delete":false,"product_type":"c1","uid":1190037,"ip_address":"","ucode":"522878C4AEB690","user_header":"https://static001.geekbang.org/account/avatar/00/12/28/95/c57f5955.jpg","comment_is_top":false,"comment_ctime":1569060927,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569060927","product_id":100023901,"comment_content":"æ¨¡æ‹ŸForking Clusterè·å–ç¬¬ä¸€ä¸ªè¿”å›ç»“æœè¿™é‡Œæˆ‘æœ‰ä¸ªç–‘é—®ã€‚æ—¢ç„¶cs.take().get()å·²ç»ä¼šé˜»å¡ä¸»çº¿ç¨‹äº†ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œåé¢æ—¶è¯´æ˜å·²ç»æ‹¿åˆ°äº†ä¸€ä¸ªç»“æœäº†ï¼Œä¸ºä»€ä¹ˆå–ç»“æœæ—¶ä»ç„¶éœ€è¦ç”¨å¾ªç¯å–å‘¢ï¼Ÿ<br><br>try {<br>  &#47;&#47; åªè¦æœ‰ä¸€ä¸ªæˆåŠŸè¿”å›ï¼Œåˆ™ breakï¼ˆä¸ºä»€ä¹ˆè¦ç”¨å¾ªç¯è€Œä¸æ˜¯ç›´æ¥cs.take().get()å‘¢ï¼‰<br>  for (int i = 0; i &lt; 3; ++i) {<br>    r = cs.take().get();<br>    &#47;&#47; ç®€å•åœ°é€šè¿‡åˆ¤ç©ºæ¥æ£€æŸ¥æ˜¯å¦æˆåŠŸè¿”å›<br>    if (r != null) {<br>      break;<br>    }<br>  }<br>} finally {<br>  &#47;&#47; å–æ¶ˆæ‰€æœ‰ä»»åŠ¡<br>  for(Future&lt;Integer&gt; f : futures)<br>    f.cancel(true);<br>}<br><br>æ”¹å†™æˆè¿™æ ·ä¼šæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ<br>try {<br>      String r = cs.take().get();<br>      min.set(Long.min(min.get(), r.length()));<br>      executor.execute(() -&gt; save(r));<br>    } finally {<br>      futures.forEach(future -&gt; future.cancel(true));<br>    }<br>","like_count":0},{"had_liked":false,"id":126667,"user_name":"ç¨‹æ–‡","can_delete":false,"product_type":"c1","uid":1353782,"ip_address":"","ucode":"5BB1CA6F63C75C","user_header":"","comment_is_top":false,"comment_ctime":1566443981,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1566443981","product_id":100023901,"comment_content":"è¯·æ•™ä¸‹è€å¸ˆï¼Œæˆ‘åœ¨é¡¹ç›®ä¸­èµ·äº†ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œç”¨ComletionServiceæäº¤äº†5ä¸ªå¼‚æ­¥ä»»åŠ¡ã€‚ç„¶åforå¾ªç¯ç­‰å¾…ä»»åŠ¡è·‘å®Œï¼Œæœ€åå…³é—­çº¿ç¨‹æ± ã€‚é¡¹ç›®éƒ¨ç½²åç¬¬ä¸€æ¬¡è¿è¡Œèƒ½æˆåŠŸï¼Œç¬¬äºŒæ¬¡å°±æŠ›å‡ºconcurrent. RejectExecutionEaxceptionå¼‚å¸¸<br>Terminated,pool size=0,active threads=0,queued tasks =0,completed task =5<br><br>","like_count":0,"discussions":[{"author":{"id":1013160,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/75/a8/dfe4cade.jpg","nickname":"ç”µå…‰ç«çŸ³","note":"","ucode":"3AD33BB4AA940F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":165054,"discussion_content":"å› ä¸ºçº¿ç¨‹æ± è¢«å…³é—­äº†å§ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581251995,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":123171,"user_name":"mi","can_delete":false,"product_type":"c1","uid":1291302,"ip_address":"","ucode":"981D61BADCF58E","user_header":"https://static001.geekbang.org/account/avatar/00/13/b4/26/131d4631.jpg","comment_is_top":false,"comment_ctime":1565619460,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565619460","product_id":100023901,"comment_content":"&#47;&#47; åˆ›å»ºçº¿ç¨‹æ± <br>ExecutorService executor = <br>  Executors.newFixedThreadPool(3);<br>&#47;&#47; åˆ›å»º CompletionService<br>CompletionService&lt;Integer&gt; cs = new <br>  ExecutorCompletionService&lt;&gt;(executor);<br>&#47;&#47; å¼‚æ­¥å‘ç”µå•† S1 è¯¢ä»·<br>cs.submit(()-&gt;getPriceByS1());<br>&#47;&#47; å¼‚æ­¥å‘ç”µå•† S2 è¯¢ä»·<br>cs.submit(()-&gt;getPriceByS2());<br>&#47;&#47; å¼‚æ­¥å‘ç”µå•† S3 è¯¢ä»·<br>cs.submit(()-&gt;getPriceByS3());<br>&#47;&#47; å°†è¯¢ä»·ç»“æœå¼‚æ­¥ä¿å­˜åˆ°æ•°æ®åº“<br>for (int i=0; i&lt;3; i++) {<br>  Integer r = cs.take().get();<br>  executor.execute(()-&gt;save(r));<br>}<br>è¿™ä¸ªè¿˜ä¸æ˜¯ä¼šé˜»å¡åˆ°getä¹ˆï¼Ÿå³ä½¿ä»é˜Ÿåˆ—é‡Œæ‹¿åˆ°æœ€å¿«è¿”å›çš„futureå¯¹è±¡ï¼Œåªæ˜¯ç©ºå£³ï¼Œä¸ä»£è¡¨ä»–çš„getä¼šç¬¬ä¸€ä¸ªè¿”å›ã€‚æ‰€ä»¥å¹¶ä¸å¦‚ç¬¬äºŒç§æ–¹æ³•æ•ˆç‡é«˜","like_count":0},{"had_liked":false,"id":118132,"user_name":"å€šæ¢¦æµ","can_delete":false,"product_type":"c1","uid":1435045,"ip_address":"","ucode":"7CB442D629534B","user_header":"https://static001.geekbang.org/account/avatar/00/15/e5/a5/fae40ac3.jpg","comment_is_top":false,"comment_ctime":1564277237,"is_pvip":false,"replies":[{"id":"43341","content":"å¼‚æ­¥è¦è€ƒè™‘çš„é—®é¢˜æœ¬èº«å°±å¾ˆå¤šï¼Œæ®è¯´linuså¯¹å¼‚æ­¥å°±å¾ˆåæ„Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1564358689,"ip_address":"","comment_id":118132,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1564277237","product_id":100023901,"comment_content":"è¯·é—®è€å¸ˆï¼Œä»»åŠ¡æ“ä½œä¸­åŒ…å«ioæ“ä½œï¼Œæ¯”å¦‚æ­£åœ¨å¢åˆ è¯»å†™æ–‡ä»¶ï¼Œè¿™æ—¶å€™çªç„¶cancelï¼Œä¼šæœ‰ä»€ä¹ˆä¸è‰¯å½±å“å—ï¼Ÿæˆ–è€…ä»»åŠ¡é‡Œé¢åŒ…å«æ•°æ®åº“æ“ä½œï¼Œå¦‚æœçªç„¶cancelï¼Œå²‚ä¸æ˜¯éœ€è¦åœ¨å¼‚æ­¥ä»»åŠ¡ä¸­ï¼Œè¿›è¡Œäº‹åŠ¡å›æ»šï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460277,"discussion_content":"å¼‚æ­¥è¦è€ƒè™‘çš„é—®é¢˜æœ¬èº«å°±å¾ˆå¤šï¼Œæ®è¯´linuså¯¹å¼‚æ­¥å°±å¾ˆåæ„Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564358689,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114782,"user_name":"æ—­ä¸œ(Frank)","can_delete":false,"product_type":"c1","uid":1024486,"ip_address":"","ucode":"176FA629800062","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a1/e6/50da1b2d.jpg","comment_is_top":false,"comment_ctime":1563407222,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563407222","product_id":100023901,"comment_content":"æœ‰åºæ€§ï¼Œå’Œé¡ºåºæ€§è¿˜æ˜¯åŒºåˆ«è›®å¤§çš„ã€‚","like_count":0},{"had_liked":false,"id":112080,"user_name":"èƒ¡å°ç¦¾","can_delete":false,"product_type":"c1","uid":1132315,"ip_address":"","ucode":"1C23B7492C0C9E","user_header":"https://static001.geekbang.org/account/avatar/00/11/47/1b/64262861.jpg","comment_is_top":false,"comment_ctime":1562665219,"is_pvip":false,"replies":[{"id":"40817","content":"ç”¨foræ˜¯å› ä¸ºrå¯èƒ½ä¸ºç©º","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1562712427,"ip_address":"","comment_id":112080,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562665219","product_id":100023901,"comment_content":"&#47;&#47; åˆ›å»ºçº¿ç¨‹æ± <br>ExecutorService executor =<br>  Executors.newFixedThreadPool(3);<br>&#47;&#47; åˆ›å»º CompletionService<br>CompletionService&lt;Integer&gt; cs =<br>  new ExecutorCompletionService&lt;&gt;(executor);<br>&#47;&#47; ç”¨äºä¿å­˜ Future å¯¹è±¡<br>List&lt;Future&lt;Integer&gt;&gt; futures =<br>  new ArrayList&lt;&gt;(3);<br>&#47;&#47; æäº¤å¼‚æ­¥ä»»åŠ¡ï¼Œå¹¶ä¿å­˜ future åˆ° futures <br>futures.add(<br>  cs.submit(()-&gt;geocoderByS1()));<br>futures.add(<br>  cs.submit(()-&gt;geocoderByS2()));<br>futures.add(<br>  cs.submit(()-&gt;geocoderByS3()));<br>&#47;&#47; è·å–æœ€å¿«è¿”å›çš„ä»»åŠ¡æ‰§è¡Œç»“æœ<br>Integer r = 0;<br>try {<br>  &#47;&#47; åªè¦æœ‰ä¸€ä¸ªæˆåŠŸè¿”å›ï¼Œåˆ™ break<br>  for (int i = 0; i &lt; 3; ++i) {<br>    r = cs.take().get();<br>    &#47;&#47; ç®€å•åœ°é€šè¿‡åˆ¤ç©ºæ¥æ£€æŸ¥æ˜¯å¦æˆåŠŸè¿”å›<br>    if (r != null) {<br>      break;<br>    }<br>  }<br>  &#47;&#47; **********************************<br>  &#47;&#47; for å¾ªç¯å…¶å®æ²¡æœ‰å¿…è¦å§ï¼Ÿ<br>  &#47;&#47; take() æ˜¯é˜»å¡çš„æ‹¿åˆ°ç»“æœï¼Œget()ä¹Ÿæ˜¯é˜»å¡çš„<br>  &#47;&#47; åªè¦æœ‰ä¸ªä»»åŠ¡å®Œæˆï¼Œè¿™ä¸ªforå¾ªç¯å°±ç»“æŸäº†<br>} finally {<br>  &#47;&#47; å–æ¶ˆæ‰€æœ‰ä»»åŠ¡<br>  for(Future&lt;Integer&gt; f : futures)<br>    f.cancel(true);<br>}<br>&#47;&#47; è¿”å›ç»“æœ<br>return r;<br>","like_count":1,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457565,"discussion_content":"ç”¨foræ˜¯å› ä¸ºrå¯èƒ½ä¸ºç©º","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562712427,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112037,"user_name":"èƒ¡å°ç¦¾","can_delete":false,"product_type":"c1","uid":1132315,"ip_address":"","ucode":"1C23B7492C0C9E","user_header":"https://static001.geekbang.org/account/avatar/00/11/47/1b/64262861.jpg","comment_is_top":false,"comment_ctime":1562657965,"is_pvip":false,"replies":[{"id":"40761","content":"åé¢æœ‰ä¸€ç« ä»‹ç»ä¼˜é›…åœæœºï¼Œä¸è¿‡ä¹Ÿè°ˆä¸ä¸Šé€šç”¨","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1562676431,"ip_address":"","comment_id":112037,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562657965","product_id":100023901,"comment_content":"è¯·æ•™ä¸‹è€å¸ˆï¼Œå®é™…ç”Ÿäº§ä¸­ï¼Œä½¿ç”¨BlockingQueue æ—¶ï¼Œ<br>è‹¥é‡å¯å®ä¾‹ï¼ŒBQ çš„ä»»åŠ¡å¯èƒ½ä¼šä¸¢ï¼Œå¯¹æ­¤æœ‰ä½•é€šç”¨æ–¹æ¡ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457547,"discussion_content":"åé¢æœ‰ä¸€ç« ä»‹ç»ä¼˜é›…åœæœºï¼Œä¸è¿‡ä¹Ÿè°ˆä¸ä¸Šé€šç”¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562676431,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110174,"user_name":"rong","can_delete":false,"product_type":"c1","uid":1128740,"ip_address":"","ucode":"637A27C532D817","user_header":"https://static001.geekbang.org/account/avatar/00/11/39/24/ab14f6cf.jpg","comment_is_top":false,"comment_ctime":1562204059,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562204059","product_id":100023901,"comment_content":"æœ€åä¸€ä¸ªä¾‹å­ï¼ŒArrayliståˆå§‹åŒ–çš„æ—¶å€™ï¼Œè®¾ç½®å®¹é‡ä¸º3ï¼Œè¿™æ ·ï¼Œåœ¨æ”¾ç¬¬ä¸‰ä¸ªçš„æ—¶å€™ï¼Œæ ¹æ®æ‰©å®¹å› å­ï¼Œå°±åº”è¯¥æ‰©å®¹äº†å§ï¼Ÿ","like_count":0},{"had_liked":false,"id":101108,"user_name":"ç½—æ°","can_delete":false,"product_type":"c1","uid":1316843,"ip_address":"","ucode":"7D440AFAA78678","user_header":"https://static001.geekbang.org/account/avatar/00/14/17/eb/8bfd69b0.jpg","comment_is_top":false,"comment_ctime":1559719257,"is_pvip":false,"replies":[{"id":"36461","content":"ä¸ºäº†ç”¨forå¾ªç¯å‡å°‘ä»£ç é‡","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1559741216,"ip_address":"","comment_id":101108,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1559719257","product_id":100023901,"comment_content":"æƒ³é—®ä¸‹ï¼Œè€å¸ˆç¬¬äºŒä¸ªä¾‹å­é‡Œ cs.submit è¿”å›çš„future å’Œ cs.take è·å–çš„æ˜¯åŒæ ·çš„futureå— ä¸ºä»€ä¹ˆè¿˜è¦åŠ ä¸€ä¸ªæ•°ç»„è¿™ä¸ªå¤šä½™çš„ä¸œè¥¿å•Š","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452808,"discussion_content":"ä¸ºäº†ç”¨forå¾ªç¯å‡å°‘ä»£ç é‡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559741216,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99831,"user_name":"å¥‡å¥‡","can_delete":false,"product_type":"c1","uid":1399097,"ip_address":"","ucode":"BC86B0CB55E35A","user_header":"","comment_is_top":false,"comment_ctime":1559316331,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1559316331","product_id":100023901,"comment_content":"æœ€åçš„é—®é¢˜ Math.minä¸æ˜¯åŸå­æ“ä½œ ä¼šå‡ºç°ç«æ€æ¡ä»¶","like_count":0},{"had_liked":false,"id":95573,"user_name":"tdytaylor","can_delete":false,"product_type":"c1","uid":1181214,"ip_address":"","ucode":"5B4919FDFE91A6","user_header":"https://static001.geekbang.org/account/avatar/00/12/06/1e/51ad425f.jpg","comment_is_top":false,"comment_ctime":1558085259,"is_pvip":false,"replies":[{"id":"34218","content":"åé¢ã€Š35 | ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ï¼šå¦‚ä½•ä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹ï¼Ÿã€‹ä¼šè®²","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1558143536,"ip_address":"","comment_id":95573,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1558085259","product_id":100023901,"comment_content":"è€å¸ˆï¼Œæˆ‘çœ‹åˆ°å‡ èŠ‚ä¸­çš„demoéƒ½æœ‰åœ¨çº¿ç¨‹æ± é‡Œé¢å–æ¶ˆä»»åŠ¡æ‰§è¡Œï¼Œæˆ‘ä¹‹å‰çœ‹æºç äº†è§£åˆ°ï¼Œè°ƒç”¨cancelæ—¶ï¼Œå¦‚æœçº¿ç¨‹å·²ç»åœ¨æ‰§è¡Œä»»åŠ¡äº†ï¼Œæ˜¯æ²¡å¾—åŠæ³•ç»ˆæ­¢è¿™ä¸ªä»»åŠ¡çš„è¿è¡Œçš„ï¼Œè¿™ç§æƒ…å†µæœ‰æ²¡åŠæ³•å¤„ç†å‘¢","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450521,"discussion_content":"åé¢ã€Š35 | ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ï¼šå¦‚ä½•ä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹ï¼Ÿã€‹ä¼šè®²","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558143536,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91636,"user_name":"å˜‰å˜‰â˜•","can_delete":false,"product_type":"c1","uid":1059771,"ip_address":"","ucode":"632A5CC4B53BB1","user_header":"https://static001.geekbang.org/account/avatar/00/10/2b/bb/5cf70df8.jpg","comment_is_top":false,"comment_ctime":1557064869,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557064869","product_id":100023901,"comment_content":"ç½®é¡¶çš„ç•™è¨€ï¼Œreturnæ˜¯ä¸æ˜¯åº”è¯¥åœ¨forå¤–é¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":90605,"user_name":"æ‚Ÿç©º","can_delete":false,"product_type":"c1","uid":1451125,"ip_address":"","ucode":"F9DFBA74B35B40","user_header":"https://static001.geekbang.org/account/avatar/00/16/24/75/808ac160.jpg","comment_is_top":false,"comment_ctime":1556587307,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556587307","product_id":100023901,"comment_content":"ä½¿ç”¨ç›¸åŒçš„çº¿ç¨‹æ± ï¼Œä¼šå¯¼è‡´å‰é¢æŸ¥è¯¢æŠ¥ä»·çº¿ç¨‹æ± ä¸å¤Ÿä½¿ç”¨ã€‚åº”è¯¥ä½¿ç”¨ä¸¤ä¸ªçº¿ç¨‹","like_count":0},{"had_liked":false,"id":89563,"user_name":"punchline","can_delete":false,"product_type":"c1","uid":1314136,"ip_address":"","ucode":"32391B470CCD18","user_header":"https://static001.geekbang.org/account/avatar/00/14/0d/58/008173ad.jpg","comment_is_top":false,"comment_ctime":1556206375,"is_pvip":false,"replies":[{"id":"32119","content":"ä¿®æ”¹è¿‡ï¼Œä¹‹å‰æ˜¯æœ‰é—®é¢˜","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1556239251,"ip_address":"","comment_id":89563,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1556206375","product_id":100023901,"comment_content":"è¿™ä¸€æœŸçš„è¯„è®ºæŠŠæˆ‘çœ‹æ‡µäº†ï¼Œfuture.get()å°±æ˜¯é˜»å¡å½“å‰çº¿ç¨‹å•Š","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448175,"discussion_content":"ä¿®æ”¹è¿‡ï¼Œä¹‹å‰æ˜¯æœ‰é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556239251,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89452,"user_name":"LW","can_delete":false,"product_type":"c1","uid":1325297,"ip_address":"","ucode":"89820332658E98","user_header":"https://static001.geekbang.org/account/avatar/00/14/38/f1/996a070d.jpg","comment_is_top":false,"comment_ctime":1556177095,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556177095","product_id":100023901,"comment_content":"å¥½å¤šè¯´ç¬¬ä¸€ä¸ªä¾‹å­ä¸é˜»å¡çš„ï¼Œéƒ½æ˜¯æ²¡æœ‰å®é™…è¿è¡Œè¿‡çš„ï¼Œå‡­æ„Ÿè§‰è‡†æµ‹","like_count":0},{"had_liked":false,"id":89447,"user_name":"é’è²","can_delete":false,"product_type":"c1","uid":1181787,"ip_address":"","ucode":"6BA5D5D47DE38E","user_header":"https://static001.geekbang.org/account/avatar/00/12/08/5b/2a342424.jpg","comment_is_top":false,"comment_ctime":1556176722,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1556176722","product_id":100023901,"comment_content":"f1.get()çœŸæ­£é˜»å¡çš„æ˜¯çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹ï¼Œç”±äºå·¥ä½œçº¿ç¨‹æ•°åˆšå¥½å’Œæ‰§è¡Œä»»åŠ¡æ•°ä¸€æ ·ï¼Œä»»åŠ¡1è€—æ—¶é•¿è‚¯å®šä¸ä¼šé‡Šæ”¾å·¥ä½œçº¿ç¨‹ï¼Œf2.get()æäº¤ä»»åŠ¡çš„æ—¶å€™ï¼Œè¿˜æ˜¯è¦ç­‰æœ‰ç©ºé—²çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œå®ƒ","like_count":0},{"had_liked":false,"id":89416,"user_name":"nightmare","can_delete":false,"product_type":"c1","uid":1056314,"ip_address":"","ucode":"EF2E51C2122A86","user_header":"https://static001.geekbang.org/account/avatar/00/10/1e/3a/5b21c01c.jpg","comment_is_top":false,"comment_ctime":1556169789,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556169789","product_id":100023901,"comment_content":"ç›´æ¥ç”¨ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„Skipseté›†åˆputè¿›å…¥ï¼Œç„¶åget(0)ä¸å°±è¡Œäº†","like_count":0},{"had_liked":false,"id":89393,"user_name":"å¼ å¤©å±¹","can_delete":false,"product_type":"c1","uid":1477612,"ip_address":"","ucode":"8BD6BD6DCF0F4F","user_header":"https://static001.geekbang.org/account/avatar/00/16/8b/ec/dc03f5ad.jpg","comment_is_top":false,"comment_ctime":1556163200,"is_pvip":false,"replies":[{"id":"32004","content":"ğŸ‘ğŸ‘ï¼Œç¤ºä¾‹ä»£ç æœ‰é—®é¢˜ï¼Œå·²ç»æ”¹äº†","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1556190742,"ip_address":"","comment_id":89393,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1556163200","product_id":100023901,"comment_content":"è€å¸ˆæˆ‘å¯¹ç¬¬ä¸€ä¸ªä¾‹å­è¿˜æ˜¯æœ‰ç–‘é—®ï¼Œf.get()å·²ç»æäº¤ç»™äº†çº¿ç¨‹æ± æ‰§è¡Œäº†ï¼Œä¸ºä»€ä¹ˆä¼šè¯´é˜»å¡ä¸»çº¿ç¨‹å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448115,"discussion_content":"ğŸ‘ğŸ‘ï¼Œç¤ºä¾‹ä»£ç æœ‰é—®é¢˜ï¼Œå·²ç»æ”¹äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556190742,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89389,"user_name":"ç©ºçŸ¥","can_delete":false,"product_type":"c1","uid":1013283,"ip_address":"","ucode":"C448E98238DD36","user_header":"https://static001.geekbang.org/account/avatar/00/0f/76/23/31e5e984.jpg","comment_is_top":false,"comment_ctime":1556162605,"is_pvip":false,"replies":[{"id":"32005","content":"ğŸ‘ğŸ‘ï¼Œç¤ºä¾‹ä»£ç å·²ç»æ”¹äº†<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1556190791,"ip_address":"","comment_id":89389,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1556162605","product_id":100023901,"comment_content":"è€å¸ˆ,æ„Ÿè§‰å¼€ç¯‡çš„é˜»å¡é˜Ÿåˆ—è§£å†³future.geté˜»å¡ å­˜åœ¨é—®é¢˜,é˜»å¡é˜Ÿåˆ—ä¹Ÿæ˜¯æŠŠæ‰§è¡Œgetç»“æœåŠ åˆ°é˜Ÿåˆ—,ç„¶åtakeå‡ºæ¥,å¦‚æœçº¿ç¨‹æ± ä¸å¤Ÿå¤§, f1çš„submit å’Œ getå æ»¡äº†çº¿ç¨‹,å…¶ä»–çº¿ç¨‹çš„æ‰§è¡Œéƒ½éœ€è¦ç­‰å¾…...è¿˜æ˜¯ä¼šé˜»å¡<br>å¦‚æœçº¿ç¨‹æ± è¶³å¤Ÿå¤§,åŸå§‹æ–¹æ¡ˆå°±å¯ä»¥ç›´æ¥ç”³è¯·æ–°çš„çº¿ç¨‹æ‰§è¡Œ","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448113,"discussion_content":"ğŸ‘ğŸ‘ï¼Œç¤ºä¾‹ä»£ç å·²ç»æ”¹äº†\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556190791,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89378,"user_name":"å›å“¥èŠæŠ€æœ¯","can_delete":false,"product_type":"c1","uid":1325816,"ip_address":"","ucode":"2C9A22BCE4C79E","user_header":"https://static001.geekbang.org/account/avatar/00/14/3a/f8/c1a939e7.jpg","comment_is_top":false,"comment_ctime":1556160837,"is_pvip":false,"replies":[{"id":"32363","content":"ğŸ‘ğŸ‘ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1556499973,"ip_address":"","comment_id":89378,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1556160837","product_id":100023901,"comment_content":"1.m.set(Integer.min(m.get(), r))ä¸æ˜¯åŸå­æ“ä½œ<br>2.catchä½exceptionåï¼Œæ˜¯å¦éœ€è¦ç»™rä¸€ä¸ªé»˜è®¤å€¼å‘¢<br>3.return ç­‰ä¸åˆ°å¼‚æ­¥ç»“æœ<br><br>å¦å¤–æˆ‘æœ‰1ä¸ªé—®é¢˜<br>æˆ‘è§‰å¾—ç¬¬ä¸€ä¸ªä¾‹å­åé¢3ä¸ªçº¿ç¨‹å¼‚æ­¥ä¿å­˜ï¼Œä¸åº”è¯¥é˜»å¡åœ¨f1.getï¼Œgetæ–¹æ³•ä¼šé˜»å¡ï¼Œä½†æ˜¯åªé˜»å¡å½“å‰çº¿ç¨‹å•Š<br><br>","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448109,"discussion_content":"ğŸ‘ğŸ‘ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556499973,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89364,"user_name":"ç¾ç¾","can_delete":false,"product_type":"c1","uid":1148422,"ip_address":"","ucode":"44CC95C45AF345","user_header":"https://static001.geekbang.org/account/avatar/00/11/86/06/72b01bb7.jpg","comment_is_top":false,"comment_ctime":1556158918,"is_pvip":false,"replies":[{"id":"32006","content":"ğŸ‘éƒ½æ˜¯ç«çœ¼é‡‘ç›","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1556190816,"ip_address":"","comment_id":89364,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1556158918","product_id":100023901,"comment_content":"ç¬¬ä¸€ä¸ªä¾‹å­ æˆ‘æ„Ÿè§‰f1.get()æ²¡æœ‰é˜»å¡ä¸»çº¿ç¨‹å•Š  f1.get()æ˜¯åœ¨çº¿ç¨‹æ± é‡Œå¼‚æ­¥æ‰§è¡Œçš„å•Š","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448105,"discussion_content":"ğŸ‘éƒ½æ˜¯ç«çœ¼é‡‘ç›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556190816,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89355,"user_name":"ç¾ç¾","can_delete":false,"product_type":"c1","uid":1148422,"ip_address":"","ucode":"44CC95C45AF345","user_header":"https://static001.geekbang.org/account/avatar/00/11/86/06/72b01bb7.jpg","comment_is_top":false,"comment_ctime":1556157978,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556157978","product_id":100023901,"comment_content":"ç¬¬ä¸€ä¸ªä¾‹å­ f1.get()æ˜¯çº¿ç¨‹æ± é‡Œå¼‚æ­¥æ‰§è¡Œçš„ ä¸ºå•¥ä¼šé˜»å¡ä¸»çº¿ç¨‹","like_count":0},{"had_liked":false,"id":89348,"user_name":"å¤šè¥„ä¸¸","can_delete":false,"product_type":"c1","uid":1074310,"ip_address":"","ucode":"1AA1497C5A293C","user_header":"https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg","comment_is_top":false,"comment_ctime":1556157264,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556157264","product_id":100023901,"comment_content":"1.æ€è€ƒé¢˜: è¿™æ˜¯ä¸ªå…ˆåˆ¤æ–­åæ‰§è¡Œçš„å¤åˆæ“ä½œï¼Œå¤šçº¿ç¨‹ä¸‹ä¾èµ–ä¸Šä¸€ä¸ªçº¿ç¨‹å†™å…¥çš„ç»“æœã€‚è¿™é‡Œçš„m.set()æ–¹æ³•åº”è¯¥ä¸æ˜¯åŸå­æ“ä½œï¼Œåº”è¯¥ä¿è¯setçš„åŸå­æ€§å§<br><br>2.é—®é¢˜: è€å¸ˆï¼Œè¿™é‡Œçš„cs.take().get()æ–¹æ³•æˆ‘æœ‰ä¸ªç–‘é—®:<br><br>a.å½“æ‰§è¡ŒæŸä¸ªè¯¢ä»·ä»»åŠ¡çš„è¿‡ç¨‹ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™ä¸ªå¼‚å¸¸æ˜¯ä¸æ˜¯åœ¨Future&lt;T&gt;é‡Œé¢å•Šï¼Ÿ <br>æ˜¯é€šè¿‡cs.take().get()é‡Œçš„get()æ–¹æ³•å–åˆ°å¼‚å¸¸äº†å—ï¼Ÿ <br>è¿˜æ˜¯ç›´æ¥åœ¨é˜»å¡get()çš„è¿‡ç¨‹ä¸­æŠ›å‡ºæ¥äº†å•Šï¼Ÿ <br><br>b.å¦‚æœæ˜¯é˜»å¡åœ¨get()è¿™é‡Œï¼Œæ­¤æ—¶ä»»åŠ¡çº¿ç¨‹è¢«interrupt()äº†ï¼Œé‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯å°±è·å–ä¸åˆ°è¯¢ä»·ç»“æœè€Œæ˜¯åœ¨get()è¿‡ç¨‹ä¸­æ•è·äº†ä¸€ä¸ªå¼‚å¸¸å•Š?<br><br>æˆ–è€…è¯„è®ºåŒºçš„ç«¥é‹å›ç­”ä¸€ä¸‹æˆ‘ä¹Ÿå¾ˆæ„Ÿè°¢å•Šï¼","like_count":0},{"had_liked":false,"id":89341,"user_name":"å¼ ä¸‰","can_delete":false,"product_type":"c1","uid":1004092,"ip_address":"","ucode":"1155528FAE1546","user_header":"https://static001.geekbang.org/account/avatar/00/0f/52/3c/d6fcb93a.jpg","comment_is_top":false,"comment_ctime":1556156702,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556156702","product_id":100023901,"comment_content":"æ‰“å¡ã€‚","like_count":0},{"had_liked":false,"id":89337,"user_name":"é»„æµ·å³°","can_delete":false,"product_type":"c1","uid":1275357,"ip_address":"","ucode":"E9340719BC96B2","user_header":"https://static001.geekbang.org/account/avatar/00/13/75/dd/9ead6e69.jpg","comment_is_top":false,"comment_ctime":1556156260,"is_pvip":false,"replies":[{"id":"32008","content":"ğŸ‘ç¤ºä¾‹ä»£ç æœ‰é—®é¢˜<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1556190922,"ip_address":"","comment_id":89337,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1556156260","product_id":100023901,"comment_content":"è€å¸ˆï¼Œæœ‰ä¸ªåœ°æ–¹ä¸ç†è§£ã€‚ã€‚ç¬¬ä¸€æ®µä»£ç ä¸­è¿™ä¸ªf1.getä¸æ˜¯åœ¨çº¿ç¨‹æ± é‡Œæ‰§è¡Œçš„å—ï¼Ÿä¸ºä½•ä¼šé˜»å¡äº†ä¸»çº¿ç¨‹ï¼Ÿ<br><br>&#47;&#47;è·å–ç”µå•† S1 æŠ¥ä»·å¹¶å¼‚æ­¥ä¿å­˜<br>executor.execute(<br>  ()-&gt;save(f1.get()));","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448095,"discussion_content":"ğŸ‘ç¤ºä¾‹ä»£ç æœ‰é—®é¢˜\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556190922,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89334,"user_name":"æ¸”å¤«","can_delete":false,"product_type":"c1","uid":1019289,"ip_address":"","ucode":"6BF08FD8923E45","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/99/f886543d.jpg","comment_is_top":false,"comment_ctime":1556155709,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556155709","product_id":100023901,"comment_content":"m.set(Integer.min(m.get(), r));<br><br>è¿™ä¸ªé€»è¾‘æ‰§è¡Œåº”è¯¥äº’æ–¥ï¼Œä½†æ˜¯ set&#47;get ä¹‹é—´æ— æ³•å½¢æˆåŸå­æ“ä½œï¼Œåº”è¯¥ä½¿ç”¨ getAndUpdate æ¥å®Œæˆè¯¥é€»è¾‘","like_count":0},{"had_liked":false,"id":89326,"user_name":"å‘¨æ²»æ…§","can_delete":false,"product_type":"c1","uid":1335293,"ip_address":"","ucode":"7D56C4E66BEE17","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKR3ibELhjgVicCNShZCBwvaDxibnzibggG4wUzVkS2mkDxUBZyIs87nDEdJ7PiahJBVoZcuhQ84RxAziag/132","comment_is_top":false,"comment_ctime":1556154967,"is_pvip":false,"replies":[{"id":"32189","content":"ğŸ‘<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1556284403,"ip_address":"","comment_id":89326,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1556154967","product_id":100023901,"comment_content":"å­˜åœ¨é—®é¢˜ï¼Œåœ¨æ‰§è¡Œexecutor.executeçš„æ—¶å€™å¤šä¸ªçº¿ç¨‹æ˜¯éé˜»å¡çš„å¼‚æ­¥æ‰§è¡Œï¼Œå¯èƒ½è¿˜æ²¡ç­‰åˆ°çº¿ç¨‹æ‰§è¡Œå®Œçš„æ—¶å€™å°±ç›´æ¥è¿”å›ç»“æœäº†ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¼šå‡ºç°æ˜¯integerçš„æœ€å¤§å€¼ã€‚æ”¹è¿›çš„åŠæ³•æ˜¯åœ¨éå†æ—¶å»å–é˜»å¡é˜Ÿåˆ—ä¸­çš„å€¼åå†æ‰§è¡Œsetæ“ä½œï¼Œå› ä¸ºåœ¨getå–é˜»å¡é˜Ÿåˆ—ä¸­çš„å€¼çš„è¿‡ç¨‹æ˜¯ä¸€ä¸ªé˜»å¡ï¼Œæœ€ååœ¨åˆ©ç”¨çº¿ç¨‹æ± çš„éé˜»å¡å¼‚æ­¥æ“ä½œå»ä¿å­˜ç»“æœã€‚","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448092,"discussion_content":"ğŸ‘\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556284403,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}