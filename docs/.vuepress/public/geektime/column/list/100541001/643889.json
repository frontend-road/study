{"id":643889,"title":"05ï½œå–„ç”¨Embeddingï¼Œæˆ‘ä»¬æ¥ç»™æ–‡æœ¬åˆ†åˆ†ç±»","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å¾æ–‡æµ©ã€‚</p><p>ä¸Šä¸€è®²é‡Œæˆ‘ä»¬çœ‹åˆ°å¤§æ¨¡å‹çš„ç¡®æœ‰æ•ˆã€‚åœ¨è¿›è¡Œæƒ…æ„Ÿåˆ†æçš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šè¿‡OpenAIçš„APIæ‹¿åˆ°çš„Embeddingï¼Œæ¯”T5-baseè¿™æ ·å•æœºå¯ä»¥è¿è¡Œçš„å°æ¨¡å‹ï¼Œæ•ˆæœè¿˜æ˜¯å¥½å¾ˆå¤šçš„ã€‚</p><p>ä¸è¿‡ï¼Œæˆ‘ä»¬ä¹‹å‰é€‰ç”¨çš„é—®é¢˜çš„ç¡®æœ‰ç‚¹å¤ªç®€å•äº†ã€‚æˆ‘ä»¬æŠŠ5ä¸ªä¸åŒçš„åˆ†æ•°åˆ†æˆäº†æ­£é¢ã€è´Ÿé¢å’Œä¸­æ€§ï¼Œè¿˜å»æ‰äº†ç›¸å¯¹éš¾ä»¥åˆ¤æ–­çš„â€œä¸­æ€§â€è¯„ä»·ï¼Œè¿™æ ·æˆ‘ä»¬åˆ¤æ–­çš„å‡†ç¡®ç‡é«˜çš„ç¡®æ˜¯æ¯”è¾ƒå¥½å®ç°çš„ã€‚ä½†å¦‚æœæˆ‘ä»¬æƒ³è¦å‡†ç¡®åœ°é¢„æµ‹å‡ºå…·ä½“çš„åˆ†æ•°å‘¢ï¼Ÿ</p><h2>åˆ©ç”¨Embeddingï¼Œè®­ç»ƒæœºå™¨å­¦ä¹ æ¨¡å‹</h2><p>æœ€ç®€å•çš„åŠæ³•å°±æ˜¯åˆ©ç”¨æˆ‘ä»¬æ‹¿åˆ°çš„æ–‡æœ¬Embeddingçš„å‘é‡ã€‚è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬ä¸ç›´æ¥ç”¨å‘é‡ä¹‹é—´çš„è·ç¦»ï¼Œè€Œæ˜¯ä½¿ç”¨ä¼ ç»Ÿçš„æœºå™¨å­¦ä¹ çš„æ–¹æ³•æ¥è¿›è¡Œåˆ†ç±»ã€‚æ¯•ç«Ÿï¼Œå¦‚æœåªæ˜¯ç”¨å‘é‡ä¹‹é—´çš„è·ç¦»ä½œä¸ºè¡¡é‡æ ‡å‡†ï¼Œå°±æ²¡åŠæ³•æœ€å¤§åŒ–åœ°åˆ©ç”¨å·²ç»æ ‡æ³¨å¥½çš„åˆ†æ•°ä¿¡æ¯äº†ã€‚</p><p>äº‹å®ä¸Šï¼ŒOpenAIåœ¨è‡ªå·±çš„å®˜æ–¹æ•™ç¨‹é‡Œä¹Ÿç›´æ¥ç»™å‡ºäº†è¿™æ ·ä¸€ä¸ªä¾‹å­ã€‚æˆ‘åœ¨è¿™é‡Œä¹Ÿæ”¾ä¸Šäº†ç›¸åº”çš„GitHubçš„ä»£ç <a href=\"https://github.com/openai/openai-cookbook/blob/main/examples/Classification_using_embeddings.ipynb\">é“¾æ¥</a>ï¼Œä½ å¯ä»¥å»çœ‹ä¸€ä¸‹ã€‚ä¸è¿‡ï¼Œä¸ºäº†é¿å…OpenAIç‹å©†å–ç“œè‡ªå–è‡ªå¤¸ï¼Œæˆ‘ä»¬ä¹Ÿå¸Œæœ›èƒ½å’Œå…¶ä»–äººç”¨ä¼ ç»Ÿçš„æœºå™¨å­¦ä¹ æ–¹å¼å¾—åˆ°çš„ç»“æœåšä¸ªæ¯”è¾ƒã€‚</p><p>å› æ­¤æˆ‘é‡æ–°æ‰¾äº†ä¸€ä¸ªä¸­æ–‡çš„æ•°æ®é›†æ¥è¯•ä¸€è¯•ã€‚è¿™ä¸ªæ•°æ®é›†æ˜¯åœ¨ä¸­æ–‡äº’è”ç½‘ä¸Šæ¯”è¾ƒå®¹æ˜“æ‰¾åˆ°çš„ä¸€ä»½ä»Šæ—¥å¤´æ¡çš„æ–°é—»æ ‡é¢˜å’Œæ–°é—»å…³é”®è¯ï¼Œåœ¨GitHubä¸Šå¯ä»¥ç›´æ¥æ‰¾åˆ°æ•°æ®ï¼Œæˆ‘æŠŠ<a href=\"https://github.com/aceimnorstuvwxz/toutiao-text-classfication-dataset\">é“¾æ¥</a>ä¹Ÿæ”¾åœ¨è¿™é‡Œã€‚ç”¨è¿™ä¸ªæ•°æ®é›†çš„å¥½å¤„æ˜¯ï¼Œæœ‰äººåŒæ­¥æ”¾å‡ºäº†é¢„æµ‹çš„å®éªŒæ•ˆæœã€‚æˆ‘ä»¬å¯ä»¥æ‹¿è‡ªå·±è®­ç»ƒçš„ç»“æœå’Œä»–åšä¸ªå¯¹æ¯”ã€‚</p><!-- [[[read_end]]] --><h2>æ•°æ®å¤„ç†ï¼Œå°å‘ä¹Ÿä¸å°‘</h2><p>åœ¨è®­ç»ƒæ¨¡å‹ä¹‹å‰ï¼Œæˆ‘ä»¬è¦å…ˆè·å–æ¯ä¸€ä¸ªæ–°é—»æ ‡é¢˜çš„Embeddingã€‚æˆ‘ä»¬é€šè¿‡Pandasè¿™ä¸ªPythonæ•°æ®å¤„ç†åº“ï¼ŒæŠŠå¯¹åº”çš„æ–‡æœ¬åŠ è½½åˆ°å†…å­˜é‡Œã€‚æ¥ç€å»è°ƒç”¨ä¹‹å‰æˆ‘ä»¬ä½¿ç”¨è¿‡çš„OpenAIçš„Embeddingæ¥å£ï¼Œç„¶åæŠŠè¿”å›ç»“æœä¸€å¹¶å­˜ä¸‹æ¥å°±å¥½äº†ã€‚è¿™ä¸ªå¬èµ·æ¥éå¸¸ç®€å•ç›´æ¥ï¼Œæˆ‘ä¹ŸæŠŠå¯¹åº”çš„ä»£ç å…ˆæ”¾åœ¨ä¸‹é¢ï¼Œä¸è¿‡ä½ å…ˆåˆ«ç€æ€¥è¿è¡Œã€‚</p><p><span class=\"reference\">æ³¨ï¼šå› ä¸ºåé¢çš„ä»£ç å¯èƒ½ä¼šè€—è´¹æ¯”è¾ƒå¤šçš„Tokenæ•°é‡ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯å…è´¹çš„5ç¾å…ƒé¢åº¦çš„è¯ï¼Œå¯ä»¥ç›´æ¥å»æ‹¿æˆ‘æ”¾åœ¨Githubé‡Œçš„<a href=\"https://github.com/xuwenhao/geektime-ai-course\">æ•°æ®æ–‡ä»¶</a>ï¼Œç”¨æˆ‘å·²ç»å¤„ç†å¥½çš„æ•°æ®ã€‚</span></p><pre><code class=\"language-python\">import pandas as pd\nimport tiktoken\nimport openai\nimport os\n\nfrom openai.embeddings_utils import get_embedding, get_embeddings\n\nopenai.api_key = os.environ.get(\"OPENAI_API_KEY\")\n\n# embedding model parameters\nembedding_model = \"text-embedding-ada-002\"\nembedding_encoding = \"cl100k_base\"  # this the encoding for text-embedding-ada-002\nmax_tokens = 8000  # the maximum for text-embedding-ada-002 is 8191\n\n# import data/toutiao_cat_data.txt as a pandas dataframe\ndf = pd.read_csv('data/toutiao_cat_data.txt', sep='_!_', names=['id', 'code', 'category', 'title', 'keywords'])\ndf = df.fillna(\"\")\ndf[\"combined\"] = (\n    \"æ ‡é¢˜: \" + df.title.str.strip() + \"; å…³é”®å­—: \" + df.keywords.str.strip()\n)\n\nprint(\"Lines of text before filtering: \", len(df))\n\nencoding = tiktoken.get_encoding(embedding_encoding)\n# omit reviews that are too long to embed\ndf[\"n_tokens\"] = df.combined.apply(lambda x: len(encoding.encode(x)))\ndf = df[df.n_tokens &lt;= max_tokens]\n\nprint(\"Lines of text after filtering: \", len(df))\n</code></pre><p><span class=\"reference\">æ³¨ï¼šè¿™ä¸ªæ˜¯åŠ è½½æ•°æ®å¹¶åšä¸€äº›ç®€å•é¢„å¤„ç†çš„ä»£ç ï¼Œä½ å¯ä»¥ç›´æ¥è¿è¡Œã€‚</span></p><p>æ­¤å¤–ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å’Œå‰å‡ è®²çš„ä»£ç ä¸€æ ·ï¼Œå®šä¹‰ä¸€ä¸ª get_embedding çš„å‡½æ•°ï¼Œæ–¹ä¾¿åé¢è°ƒç”¨ã€‚è¿™ä¸ªå‡½æ•°åŸæœ¬åœ¨æ—©æœŸçš„openaiåº“é‡Œæ˜¯ç›´æ¥æä¾›çš„ï¼Œä½†æ˜¯éšç€APIçš„ä¸æ–­æ›´æ–°ï¼Œè¿™ä¸ªåº“å·²ç»è¢«ç§»é™¤äº†ï¼Œä¸è¿‡ä»£ç éå¸¸ç®€å•ï¼Œæˆ‘ä»¬è‡ªå·±æ¥å®šä¹‰ä¸€ä¸‹å°±å¥½ã€‚</p><pre><code>from openai import OpenAI\nimport os\n\nclient = OpenAI(api_key=os.environ['OPENAI_API_KEY'])\n\nEMBEDDING_MODEL = &quot;text-embedding-ada-002&quot;\n\ndef get_embedding(text, model=EMBEDDING_MODEL):\n   text = text.replace(&quot;\\n&quot;, &quot; &quot;)\n   return client.embeddings.create(input = [text], model=model).data[0].embedding\n</code></pre><pre><code class=\"language-python\"># randomly sample 1k rows\ndf_1k = df.sample(1000, random_state=42)\n\ndf_1k[\"embedding\"] = df_1k.combined.apply(lambda x : get_embedding(x, engine=embedding_model))\ndf_1k.to_csv(\"data/toutiao_cat_data_10k_with_embeddings.csv\", index=False)\n</code></pre><p><span class=\"reference\">æ³¨ï¼šè¿™ä¸ªæ˜¯ä¸€æ¡æ¡æ•°æ®è¯·æ±‚OpenAIçš„APIè·å–Embeddingçš„ä»£ç ï¼Œä½†æ˜¯ä½ åœ¨è¿è¡Œä¸­ä¼šé‡åˆ°æŠ¥é”™ã€‚</span></p><p>ç›´æ¥è¿è¡Œè¿™ä¸ªä»£ç ï¼Œä½ å¤šåŠä¼šé‡åˆ°ä¸€ä¸ªæŠ¥é”™ï¼Œå› ä¸ºåœ¨è¿™ä¸ªæ•°æ®å¤„ç†è¿‡ç¨‹ä¸­ä¹Ÿæ˜¯æœ‰å‡ ä¸ªå‘çš„ã€‚</p><p>ç¬¬ä¸€ä¸ªå‘æ˜¯<strong> OpenAIæä¾›çš„æ¥å£é™åˆ¶äº†æ¯æ¡æ•°æ®çš„é•¿åº¦</strong>ã€‚æˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„ text-embedding-ada-002 çš„æ¨¡å‹ï¼Œæ”¯æŒçš„é•¿åº¦æ˜¯æ¯æ¡è®°å½•8191ä¸ªTokenã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨å®é™…å‘é€è¯·æ±‚å‰ï¼Œéœ€è¦è®¡ç®—ä¸€ä¸‹æ¯æ¡è®°å½•æœ‰å¤šå°‘Tokenï¼Œè¶…è¿‡8000ä¸ªçš„éœ€è¦è¿‡æ»¤æ‰ã€‚ä¸è¿‡ï¼Œåœ¨æˆ‘ä»¬è¿™ä¸ªæ•°æ®é›†é‡Œï¼Œåªæœ‰æ–°é—»çš„æ ‡é¢˜ï¼Œæ‰€ä»¥ä¸ä¼šè¶…è¿‡è¿™ä¸ªé•¿åº¦ã€‚ä½†æ˜¯ä½ åœ¨ä½¿ç”¨å…¶ä»–æ•°æ®é›†çš„æ—¶å€™ï¼Œå¯èƒ½å°±éœ€è¦è¿‡æ»¤ä¸‹æ•°æ®ï¼Œæˆ–è€…é‡‡ç”¨æˆªæ–­çš„æ–¹æ³•ï¼Œåªç”¨æ–‡æœ¬æœ€å8000ä¸ªTokenã€‚</p><p>æˆ‘ä»¬åœ¨è¿™é‡Œï¼Œè°ƒç”¨äº†Tiktokenè¿™ä¸ªåº“ï¼Œä½¿ç”¨äº† cl100k_base è¿™ç§ç¼–ç æ–¹å¼ï¼Œè¿™ç§ç¼–ç æ–¹å¼å’Œ text-embedding-ada-002 æ¨¡å‹æ˜¯ä¸€è‡´çš„ã€‚å¦‚æœé€‰é”™äº†ç¼–ç æ–¹å¼ï¼Œä½ è®¡ç®—å‡ºæ¥çš„Tokenæ•°é‡å¯èƒ½å’ŒOpenAIçš„ä¸ä¸€æ ·ã€‚</p><p>ç¬¬äºŒä¸ªå‘æ˜¯ï¼Œå¦‚æœä½ ç›´æ¥ä¸€æ¡æ¡è°ƒç”¨OpenAIçš„APIï¼Œå¾ˆå¿«å°±ä¼šé‡åˆ°æŠ¥é”™ã€‚è¿™æ˜¯å› ä¸º<strong> OpenAIå¯¹APIçš„è°ƒç”¨è¿›è¡Œäº†é™é€Ÿ</strong>ï¼ˆRate Limitï¼‰ã€‚å¦‚æœä½ è¿‡äºé¢‘ç¹åœ°è°ƒç”¨ï¼Œå°±ä¼šé‡åˆ°é™é€Ÿçš„æŠ¥é”™ã€‚è€Œå¦‚æœä½ åœ¨æŠ¥é”™ä¹‹åç»§ç»­æŒç»­è°ƒç”¨ï¼Œé™é€Ÿçš„æ—¶é—´è¿˜ä¼šè¢«å»¶é•¿ã€‚é‚£æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæˆ‘ä¹ æƒ¯é€‰ç”¨ backoff è¿™ä¸ªPythonåº“ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™å¦‚æœé‡åˆ°æŠ¥é”™äº†ï¼Œå°±ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœè¿ç»­æŠ¥é”™ï¼Œå°±æ‹‰é•¿ç­‰å¾…æ—¶é—´ã€‚é€šè¿‡backoffæ”¹é€ çš„ä»£ç æˆ‘æ”¾åœ¨äº†ä¸‹é¢ï¼Œä¸è¿‡è¿™è¿˜æ²¡æœ‰å½»åº•è§£å†³é—®é¢˜ã€‚</p><pre><code class=\"language-python\">conda install backoff\n</code></pre><p>ä½ éœ€è¦å…ˆå®‰è£…ä¸€ä¸‹backoffåº“ã€‚</p><pre><code class=\"language-python\">import backoff\n\n@backoff.on_exception(backoff.expo, openai.error.RateLimitError)\ndef get_embedding_with_backoff(**kwargs):\n    return get_embedding(**kwargs)\n\n# randomly sample 10k rows\ndf_10k = df.sample(10000, random_state=42)\n\ndf_10k[\"embedding\"] = df_10k.combined.apply(lambda x : get_embedding_with_backoff(text=x, engine=embedding_model))\ndf_10k.to_csv(\"data/toutiao_cat_data_10k_with_embeddings.csv\", index=False)\n</code></pre><p>é€šè¿‡backoffåº“ï¼Œæˆ‘ä»¬æŒ‡å®šäº†åœ¨é‡åˆ°RateLimitErrorçš„æ—¶å€™ï¼ŒæŒ‰ç…§æŒ‡æ•°çº§åˆ«å¢åŠ ç­‰å¾…æ—¶é—´ã€‚</p><p>å¦‚æœä½ ç›´æ¥è¿è¡Œä¸Šé¢é‚£ä¸ªä»£ç ï¼Œå¤§çº¦éœ€è¦2ä¸ªå°æ—¶æ‰èƒ½å¤„ç†å®Œ1ä¸‡æ¡æ•°æ®ã€‚æˆ‘ä»¬çš„æ•°æ®é›†é‡Œæœ‰38ä¸‡æ¡æ•°æ®ï¼ŒçœŸè¦è¿™ä¹ˆå¹²ï¼Œéœ€è¦3å¤©3å¤œæ‰èƒ½æŠŠè®­ç»ƒæ•°æ®å¤„ç†å®Œï¼Œè¿™æ ·æ˜¾ç„¶ä¸æ€ä¹ˆå®ç”¨ã€‚è¿™ä¹ˆæ…¢çš„åŸå› æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯é™é€Ÿï¼Œbackoffåªæ˜¯è®©æˆ‘ä»¬çš„è°ƒç”¨ä¸ä¼šå› ä¸ºå¤±è´¥è€Œç»ˆæ­¢ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯å—åˆ°äº†æ¯åˆ†é’ŸAPIè°ƒç”¨æ¬¡æ•°çš„é™åˆ¶ã€‚ç¬¬äºŒä¸ªæ˜¯å»¶æ—¶ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯æŒ‰ç…§é¡ºåºä¸€ä¸ªä¸ªè°ƒç”¨Embeddingæ¥å£ï¼Œæ¯ä¸€æ¬¡è°ƒç”¨éƒ½è¦ç­‰å‰ä¸€æ¬¡è°ƒç”¨ç»“æŸåæ‰ä¼šå‘èµ·è¯·æ±‚ï¼Œè€Œä¸æ˜¯å¤šæ¡æ•°æ®å¹¶è¡Œè¯·æ±‚ï¼Œè¿™æ›´è¿›ä¸€æ­¥<strong>æ‹–é•¿äº†å¤„ç†æ•°æ®æ‰€éœ€è¦çš„æ—¶é—´</strong>ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/07/a5/07e5bf0bdfce40a3f1b5a89cb43010a5.png?wh=1589x666\" alt=\"å›¾ç‰‡\"></p><p><span class=\"reference\">æ³¨ï¼šä½ å¯ä»¥ç‚¹å¼€è¿™ä¸ª<a href=\"https://platform.openai.com/docs/guides/rate-limits/overview\">é“¾æ¥</a>ï¼Œçœ‹çœ‹ç›®å‰OpenAIå¯¹ä¸åŒæ¨¡å‹çš„é™é€Ÿã€‚</span></p><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ä¹Ÿä¸å›°éš¾ï¼ŒOpenAIæ˜¯æ”¯æŒbatchè°ƒç”¨æ¥å£çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¯ä»¥åœ¨ä¸€ä¸ªè¯·æ±‚é‡Œä¸€æ¬¡æ‰¹é‡å¤„ç†å¾ˆå¤šä¸ªè¯·æ±‚ã€‚æˆ‘ä»¬æŠŠ1000æ¡è®°å½•æ‰“åŒ…åœ¨ä¸€èµ·å¤„ç†ï¼Œé€Ÿåº¦å°±ä¼šå¿«å¾ˆå¤šã€‚æˆ‘æŠŠå¯¹åº”çš„ä»£ç æ”¾åœ¨ä¸‹é¢ï¼Œä½ å¯ä»¥è¯•ç€æ‰§è¡Œä¸€ä¸‹ï¼Œå¤„ç†è¿™38ä¸‡å¤šæ¡çš„æ•°æ®ï¼Œä¹Ÿå°±ä¸ªæŠŠå°æ—¶ã€‚ä¸è¿‡ï¼Œä½ ä¹Ÿä¸èƒ½ä¸€æ¬¡æ€§æ‰“åŒ…å¤ªå¤šæ¡è®°å½•ï¼Œå› ä¸ºOpenAIçš„é™é€Ÿä¸ä»…ä»…æ˜¯é’ˆå¯¹è¯·æ±‚æ•°çš„ï¼Œä¹Ÿ<strong>é™åˆ¶ä½ æ¯åˆ†é’Ÿå¯ä»¥å¤„ç†çš„ Token æ•°é‡</strong>ï¼Œå…·ä½“ä¸€æ¬¡æ‰“åŒ…å‡ æ¡ï¼Œä½ å¯ä»¥æ ¹æ®æ¯æ¡æ•°æ®åŒ…å«çš„Tokenæ•°è‡ªå·±æµ‹ç®—ä¸€ä¸‹ã€‚</p><pre><code class=\"language-python\">import backoff\nfrom openai.embeddings_utils import get_embeddings\n\nbatch_size = 1000\n\n@backoff.on_exception(backoff.expo, openai.error.RateLimitError)\ndef get_embeddings_with_backoff(prompts, engine):\n    embeddings = []\n    for i in range(0, len(prompts), batch_size):\n        batch = prompts[i:i+batch_size]\n        embeddings += get_embeddings(list_of_text=batch, engine=engine)\n    return embeddings\n\n# randomly sample 10k rows\ndf_all = df\n# group prompts into batches of 100\nprompts = df_all.combined.tolist()\nprompt_batches = [prompts[i:i+batch_size] for i in range(0, len(prompts), batch_size)]\n\nembeddings = []\nfor batch in prompt_batches:\n    batch_embeddings = get_embeddings_with_backoff(prompts=batch, engine=embedding_model)\n    embeddings += batch_embeddings\n\ndf_all[\"embedding\"] = embeddings\ndf_all.to_parquet(\"data/toutiao_cat_data_all_with_embeddings.parquet\", index=True)\n</code></pre><p>æœ€åä¸€ä¸ªä½ éœ€è¦æ³¨æ„çš„ç‚¹æ˜¯ï¼Œå¯¹äºè¿™æ ·çš„å¤§æ•°æ®é›†ï¼Œ<strong>ä¸è¦å­˜å‚¨æˆCSVæ ¼å¼</strong>ã€‚ç‰¹åˆ«æ˜¯æˆ‘ä»¬è·å–åˆ°çš„Embeddingæ•°æ®ï¼Œæ˜¯å¾ˆå¤šæµ®ç‚¹æ•°ï¼Œå­˜å‚¨æˆCSVæ ¼å¼ä¼šæŠŠæœ¬æ¥åªéœ€è¦4ä¸ªå­—èŠ‚çš„æµ®ç‚¹æ•°ï¼Œéƒ½ç”¨å­—ç¬¦ä¸²çš„å½¢å¼å­˜å‚¨ä¸‹æ¥ï¼Œä¼šæµªè´¹å¥½å‡ å€çš„ç©ºé—´ï¼Œå†™å…¥çš„é€Ÿåº¦ä¹Ÿå¾ˆæ…¢ã€‚æˆ‘åœ¨è¿™é‡Œ<strong>é‡‡ç”¨äº†parquetè¿™ä¸ªåºåˆ—åŒ–çš„æ ¼å¼</strong>ï¼Œæ•´ä¸ªå­˜å‚¨çš„è¿‡ç¨‹åªéœ€è¦1åˆ†é’Ÿã€‚</p><h2>è®­ç»ƒæ¨¡å‹ï¼Œçœ‹çœ‹æ•ˆæœæ€ä¹ˆæ ·</h2><p>æ•°æ®å¤„ç†å®Œäº†ï¼Œæˆ‘ä»¬å°±ä¸å¦¨è¯•ä¸€è¯•æ¨¡å‹è®­ç»ƒã€‚å¦‚æœä½ æ‹…å¿ƒæµªè´¹å¤ªå¤šçš„APIè°ƒç”¨ï¼Œæˆ‘æŠŠæˆ‘å¤„ç†å¥½çš„æ•°æ®é›†ï¼Œæ”¾åœ¨äº†æˆ‘çš„ <a href=\"https://github.com/xuwenhao/geektime-ai-course\">GitHub</a> ä¸Šï¼Œæˆ‘æŠŠé“¾æ¥ä¹Ÿæ”¾åœ¨äº†è¿™é‡Œï¼Œä½ å¯ä»¥ç›´æ¥ä¸‹è½½ã€ä½¿ç”¨è¿™ä¸ªæ•°æ®é›†ã€‚</p><pre><code class=\"language-python\">from sklearn.ensemble import RandomForestClassifier\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import classification_report, accuracy_score\n\ntraining_data = pd.read_parquet(\"data/toutiao_cat_data_all_with_embeddings.parquet\")\ntraining_data.head()\n\ndf =  training_data.sample(50000, random_state=42)\n\nX_train, X_test, y_train, y_test = train_test_split(\n    list(df.embedding.values), df.category, test_size=0.2, random_state=42\n)\n\nclf = RandomForestClassifier(n_estimators=300)\nclf.fit(X_train, y_train)\npreds = clf.predict(X_test)\nprobas = clf.predict_proba(X_test)\n\nreport = classification_report(y_test, preds)\nprint(report)\n</code></pre><p>æ¨¡å‹è®­ç»ƒçš„ä»£ç ä¹Ÿéå¸¸ç®€å•ï¼Œè€ƒè™‘åˆ°è¿è¡Œæ—¶é—´çš„å› ç´ ï¼Œæˆ‘è¿™é‡Œç›´æ¥éšæœºé€‰å–äº†é‡Œé¢çš„5ä¸‡æ¡æ•°æ®ï¼Œ4ä¸‡æ¡ä½œä¸ºè®­ç»ƒé›†ï¼Œ1ä¸‡æ¡ä½œä¸ºæµ‹è¯•é›†ã€‚ç„¶åé€šè¿‡æœ€å¸¸ç”¨çš„scikit-learnè¿™ä¸ªæœºå™¨å­¦ä¹ å·¥å…·åŒ…é‡Œé¢çš„éšæœºæ£®æ—ï¼ˆRandomForestï¼‰ç®—æ³•ï¼Œåšäº†ä¸€æ¬¡è®­ç»ƒå’Œæµ‹è¯•ã€‚åœ¨æˆ‘çš„ç”µè„‘ä¸Šï¼Œå¤§æ¦‚10åˆ†é’Ÿå¯ä»¥è·‘å®Œï¼Œæ•´ä½“çš„å‡†ç¡®ç‡å¯ä»¥è¾¾åˆ°84%ã€‚</p><pre><code class=\"language-python\">                    precision    recall  f1-score   support\n  news_agriculture       0.83      0.85      0.84       495\n          news_car       0.88      0.94      0.91       895\n      news_culture       0.86      0.76      0.81       741\n          news_edu       0.86      0.89      0.87       708\nnews_entertainment       0.71      0.92      0.80      1051\n      news_finance       0.81      0.76      0.78       735\n         news_game       0.91      0.82      0.86       742\n        news_house       0.91      0.86      0.89       450\n     news_military       0.89      0.82      0.85       688\n       news_sports       0.90      0.92      0.91       968\n        news_story       0.95      0.46      0.62       197\n         news_tech       0.82      0.86      0.84      1052\n       news_travel       0.80      0.77      0.78       599\n        news_world       0.83      0.73      0.78       671\n             stock       0.00      0.00      0.00         8\n          accuracy                           0.84     10000\n         macro avg       0.80      0.76      0.77     10000\n      weighted avg       0.84      0.84      0.84     10000\n</code></pre><p>éšæœºæ£®æ—è¿™ä¸ªç®—æ³•ï¼Œè™½ç„¶æ•ˆæœä¸é”™ï¼Œä½†æ˜¯è·‘èµ·æ¥æœ‰äº›æ…¢ã€‚æˆ‘ä»¬æ¥ä¸‹æ¥ç”¨ä¸ªæ›´ç®€å•çš„é€»è¾‘å›å½’ï¼ˆLogisticRegressionï¼‰ç®—æ³•ï¼Œä½†æˆ‘ä»¬è¿™æ¬¡è¦è·‘åœ¨æ•´ä¸ªæ•°æ®é›†ä¸Šã€‚ä¸€æ ·çš„ï¼Œæˆ‘ä»¬æ‹¿80%ä½œä¸ºè®­ç»ƒï¼Œ20%ä½œä¸ºæµ‹è¯•ã€‚è¿™ä¸€æ¬¡ï¼Œè™½ç„¶æ•°æ®é‡æ˜¯åˆšæ‰4ä¸‡æ¡æ•°æ®çš„å¥½å‡ å€ï¼Œä½†æ˜¯æ—¶é—´ä¸Šå´åªè¦3ï½4åˆ†é’Ÿï¼Œè€Œæœ€ç»ˆçš„å‡†ç¡®ç‡ä¹Ÿèƒ½è¾¾åˆ°86%ã€‚</p><pre><code class=\"language-python\">from sklearn.linear_model import LogisticRegression\n\ndf =  training_data\n\nX_train, X_test, y_train, y_test = train_test_split(\n    list(df.embedding.values), df.category, test_size=0.2, random_state=42\n)\n\nclf = LogisticRegression()\nclf.fit(X_train, y_train)\npreds = clf.predict(X_test)\nprobas = clf.predict_proba(X_test)\n\nreport = classification_report(y_test, preds)\nprint(report)\n</code></pre><p>è¾“å‡ºç»“æœï¼š</p><pre><code class=\"language-python\">                    precision    recall  f1-score   support\n  news_agriculture       0.86      0.88      0.87      3908\n          news_car       0.92      0.92      0.92      7101\n      news_culture       0.83      0.85      0.84      5719\n          news_edu       0.89      0.89      0.89      5376\nnews_entertainment       0.86      0.88      0.87      7908\n      news_finance       0.81      0.79      0.80      5409\n         news_game       0.91      0.88      0.89      5899\n        news_house       0.91      0.91      0.91      3463\n     news_military       0.86      0.82      0.84      4976\n       news_sports       0.93      0.93      0.93      7611\n        news_story       0.83      0.82      0.83      1308\n         news_tech       0.84      0.86      0.85      8168\n       news_travel       0.80      0.80      0.80      4252\n        news_world       0.79      0.81      0.80      5370\n             stock       0.00      0.00      0.00        70\n          accuracy                           0.86     76538\n         macro avg       0.80      0.80      0.80     76538\n      weighted avg       0.86      0.86      0.86     76538\n</code></pre><p><span class=\"reference\">æ³¨ï¼šä¸‹è½½çš„æ•°æ®é›†æ‰€åœ¨çš„æµ‹è¯•ç»“æœå¯ä»¥çœ‹<a href=\"https://github.com/aceimnorstuvwxz/toutiao-text-classfication-dataset\">è¿™é‡Œ</a>ã€‚</span></p><p>è¿™ä¸ªç»“æœå·²ç»æ¯”æˆ‘ä»¬ä¸‹è½½æ•°æ®é›†çš„GitHubé¡µé¢é‡Œçœ‹åˆ°çš„æ•ˆæœå¥½äº†ï¼Œé‚£ä¸ªçš„å‡†ç¡®ç‡åªæœ‰85%ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡OpenAIçš„APIè·å–åˆ°Embeddingï¼Œç„¶åé€šè¿‡ä¸€äº›ç®€å•çš„çº¿æ€§æ¨¡å‹ï¼Œæˆ‘ä»¬å°±èƒ½è·å¾—å¾ˆå¥½çš„åˆ†ç±»æ•ˆæœã€‚æˆ‘ä»¬æ—¢ä¸éœ€è¦æå‰å‚¨å¤‡å¾ˆå¤šè‡ªç„¶è¯­è¨€å¤„ç†çš„çŸ¥è¯†ï¼Œå¯¹æ•°æ®è¿›è¡Œå¤§é‡çš„åˆ†æå’Œæ¸…ç†ï¼›ä¹Ÿä¸éœ€è¦æä¸€å—æ˜‚è´µçš„æ˜¾å¡ï¼Œå»ä½¿ç”¨ä»€ä¹ˆæ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚åªè¦1ï½2ä¸ªå°æ—¶ï¼Œæˆ‘ä»¬å°±èƒ½åœ¨ä¸€ä¸ªå‡ åä¸‡æ¡æ–‡æœ¬çš„æ•°æ®é›†ä¸Šè®­ç»ƒå‡ºä¸€ä¸ªéå¸¸ä¸é”™çš„åˆ†ç±»æ¨¡å‹ã€‚</p><h2>ç†è§£æŒ‡æ ‡ï¼Œå­¦ä¸€ç‚¹æœºå™¨å­¦ä¹ å°çŸ¥è¯†</h2><p>åˆšåˆšæˆ‘è¯´äº†ï¼Œå°±ç®—ä½ æ²¡æœ‰æœºå™¨å­¦ä¹ çš„ç›¸å…³çŸ¥è¯†ï¼Œä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œè¿™é‡Œæˆ‘æ¥ç»™ä½ è¡¥è¡¥è¯¾ã€‚ç†è§£ä¸€ä¸‹ä¸Šé¢æ¨¡å‹è¾“å‡ºçš„æŠ¥å‘Šæ˜¯ä»€ä¹ˆæ„æ€ã€‚æŠ¥å‘Šçš„æ¯ä¸€è¡Œéƒ½æœ‰å››ä¸ªæŒ‡æ ‡ï¼Œåˆ†åˆ«æ˜¯å‡†ç¡®ç‡ï¼ˆPrecisionï¼‰ã€å¬å›ç‡ï¼ˆRecallï¼‰ã€F1åˆ†æ•°ï¼Œä»¥åŠæ”¯æŒæ ·æœ¬é‡ï¼ˆSupportï¼‰ã€‚æˆ‘è¿˜æ˜¯ç”¨ä»Šæ—¥å¤´æ¡çš„æ–°é—»æ ‡é¢˜è¿™ä¸ªæ•°æ®é›†æ¥è§£é‡Šè¿™äº›æ¦‚å¿µã€‚</p><ol>\n<li><strong>å‡†ç¡®ç‡</strong>ï¼Œä»£è¡¨æ¨¡å‹åˆ¤å®šå±äºè¿™ä¸ªåˆ†ç±»çš„æ ‡é¢˜é‡Œé¢åˆ¤æ–­æ­£ç¡®çš„æœ‰å¤šå°‘ï¼Œæœ‰å¤šå°‘çœŸçš„æ˜¯å±äºè¿™ä¸ªåˆ†ç±»çš„ã€‚æ¯”å¦‚ï¼Œæ¨¡å‹åˆ¤æ–­é‡Œé¢æœ‰ 100ä¸ªéƒ½æ˜¯å†œä¸šæ–°é—»ï¼Œä½†æ˜¯è¿™100ä¸ªé‡Œé¢å…¶å®åªæœ‰83ä¸ªæ˜¯å†œä¸šæ–°é—»ï¼Œé‚£ä¹ˆå‡†ç¡®ç‡å°±æ˜¯0.83ã€‚å‡†ç¡®ç‡è‡ªç„¶æ˜¯è¶Šé«˜è¶Šå¥½ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯å‡†ç¡®ç‡è¾¾åˆ°100%å°±ä»£è¡¨æ¨¡å‹å…¨å¯¹äº†ã€‚å› ä¸ºæ¨¡å‹å¯èƒ½ä¼šæ¼ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜è¦è€ƒè™‘å¬å›ç‡ã€‚</li>\n<li><strong>å¬å›ç‡</strong>ï¼Œä»£è¡¨æ¨¡å‹åˆ¤å®šå±äºè¿™ä¸ªåˆ†ç±»çš„æ ‡é¢˜å å®é™…è¿™ä¸ªåˆ†ç±»ä¸‹æ‰€æœ‰æ ‡é¢˜çš„æ¯”ä¾‹ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰æ¼æ‰çš„æ¯”ä¾‹ã€‚æ¯”å¦‚ï¼Œæ¨¡å‹åˆ¤æ–­100ä¸ªéƒ½æ˜¯å†œä¸šæ–°é—»ï¼Œè¿™100ä¸ªçš„ç¡®éƒ½æ˜¯å†œä¸šæ–°é—»ã€‚å‡†ç¡®ç‡å·²ç»100%äº†ã€‚ä½†æ˜¯ï¼Œå®é™…æˆ‘ä»¬ä¸€å…±æœ‰200æ¡å†œä¸šæ–°é—»ã€‚é‚£ä¹ˆæœ‰100æ¡å…¶å®è¢«æ”¾åˆ°åˆ«çš„ç±»ç›®é‡Œé¢å»äº†ã€‚é‚£ä¹ˆåœ¨å†œä¸šæ–°é—»è¿™ä¸ªç±»ç›®ï¼Œæˆ‘ä»¬çš„å¬å›ç‡ï¼Œå°±åªæœ‰ 100/200 = 50%ã€‚</li>\n<li>æ‰€ä»¥æ¨¡å‹æ•ˆæœçš„å¥½åï¼Œæ—¢è¦è€ƒè™‘å‡†ç¡®ç‡ï¼Œåˆè¦è€ƒè™‘å¬å›ç‡ï¼Œç»¼åˆè€ƒè™‘è¿™ä¸¤é¡¹å¾—å‡ºçš„ç»“æœï¼Œå°±æ˜¯ <strong>F1</strong> <strong>åˆ†æ•°</strong>ï¼ˆF1 Scoreï¼‰ã€‚F1åˆ†æ•°ï¼Œæ˜¯å‡†ç¡®ç‡å’Œå¬å›ç‡çš„è°ƒå’Œå¹³å‡æ•°ï¼Œä¹Ÿå°±æ˜¯ F1 Score = 2/ (1/Precision + 1/Recall)ã€‚å½“å‡†ç¡®ç‡å’Œå¬å›ç‡éƒ½æ˜¯100%çš„æ—¶å€™ï¼ŒF1åˆ†æ•°ä¹Ÿæ˜¯1ã€‚å¦‚æœå‡†ç¡®ç‡æ˜¯100%ï¼Œå¬å›ç‡æ˜¯80%ï¼Œé‚£ä¹ˆç®—ä¸‹æ¥F1åˆ†æ•°å°±æ˜¯0.88ã€‚F1åˆ†æ•°ä¹Ÿæ˜¯è¶Šé«˜è¶Šå¥½ã€‚</li>\n<li><strong>æ”¯æŒçš„æ ·æœ¬é‡</strong>ï¼Œæ˜¯æŒ‡æ•°æ®é‡Œé¢ï¼Œå®é™…æ˜¯è¿™ä¸ªåˆ†ç±»çš„æ•°æ®æ¡æ•°æœ‰å¤šå°‘ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ•°æ®æ¡æ•°è¶Šå¤šï¼Œè¿™ä¸ªåˆ†ç±»çš„è®­ç»ƒå°±ä¼šè¶Šå‡†ç¡®ã€‚</li>\n</ol><p>åˆ†ç±»æŠ¥å‘Šé‡Œä¸€ä¸ªç±»ç›®å ä¸€è¡Œï¼Œæ¯ä¸€è¡Œéƒ½åŒ…å«å¯¹åº”çš„è¿™å››ä¸ªæŒ‡æ ‡ï¼Œè€Œæœ€ä¸‹é¢è¿˜æœ‰ä¸‰è¡Œæ•°æ®ã€‚è¿™ä¸‰è¡Œæ•°æ®ï¼Œæ˜¯æ•´ä¸ªæ‹¿æ¥æµ‹è¯•çš„æ•°æ®é›†ï¼Œæ‰€ä»¥å¯¹åº”çš„æ”¯æŒæ ·æœ¬é‡éƒ½æ˜¯1ä¸‡ä¸ªã€‚</p><p>ç¬¬ä¸€è¡Œçš„accuracyï¼Œåªæœ‰ä¸€ä¸ªæŒ‡æ ‡ï¼Œè™½ç„¶å®ƒåœ¨F1 Scoreè¿™ä¸ªåˆ—é‡Œï¼Œä½†æ˜¯å¹¶ä¸æ˜¯F1åˆ†æ•°çš„æ„æ€ã€‚è€Œæ˜¯è¯´ï¼Œæ¨¡å‹æ€»å…±åˆ¤æ–­å¯¹çš„åˆ†ç±»/æ¨¡å‹æµ‹è¯•çš„æ ·æœ¬æ•°ï¼Œä¹Ÿå°±æ˜¯æ¨¡å‹çš„æ•´ä½“å‡†ç¡®ç‡ã€‚</p><p>ç¬¬äºŒè¡Œçš„macro averageï¼Œä¸­æ–‡åå«åšå®å¹³å‡ï¼Œå®å¹³å‡çš„ä¸‰ä¸ªæŒ‡æ ‡ï¼Œå°±æ˜¯æŠŠä¸Šé¢æ¯ä¸€ä¸ªåˆ†ç±»ç®—å‡ºæ¥çš„æŒ‡æ ‡åŠ åœ¨ä¸€èµ·å¹³å‡ä¸€ä¸‹ã€‚å®ƒä¸»è¦æ˜¯åœ¨æ•°æ®åˆ†ç±»ä¸å¤ªå¹³è¡¡çš„æ—¶å€™ï¼Œå¸®åŠ©æˆ‘ä»¬è¡¡é‡æ¨¡å‹æ•ˆæœæ€ä¹ˆæ ·ã€‚</p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬åšæƒ…æ„Ÿåˆ†æï¼Œå¯èƒ½90%éƒ½æ˜¯æ­£é¢æƒ…æ„Ÿï¼Œ10%æ˜¯è´Ÿé¢æƒ…æ„Ÿã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬é¢„æµ‹æ­£é¢æƒ…æ„Ÿæ•ˆæœå¾ˆå¥½ï¼Œæ¯”å¦‚æœ‰90%çš„å‡†ç¡®ç‡ï¼Œä½†æ˜¯è´Ÿé¢æƒ…æ„Ÿé¢„æµ‹å¾ˆå·®ï¼Œåªæœ‰50%çš„å‡†ç¡®ç‡ã€‚å¦‚æœçœ‹æ•´ä½“æ•°æ®ï¼Œå…¶å®å‡†ç¡®ç‡è¿˜æ˜¯éå¸¸é«˜çš„ï¼Œæ¯•ç«Ÿè´Ÿé¢æƒ…æ„Ÿçš„ä¾‹å­å¾ˆå°‘ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬çš„ç›®æ ‡å¯èƒ½å°±æ˜¯æ‰¾åˆ°æœ‰è´Ÿé¢æƒ…ç»ªçš„å®¢æˆ·å’Œä»–ä»¬æ²Ÿé€šã€èµ”å¿ã€‚é‚£ä¹ˆæ•´ä½“å‡†ç¡®ç‡å¯¹æˆ‘ä»¬å°±æ²¡æœ‰ä»€ä¹ˆç”¨äº†ã€‚è€Œå®å¹³å‡ï¼Œä¼šæŠŠæ•´ä½“çš„å‡†ç¡®ç‡å˜æˆ (90%+50%)/2 = 70%ã€‚è¿™å°±ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é¢„æµ‹ç»“æœäº†ï¼Œæˆ‘ä»¬éœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚å®å¹³å‡å¯¹äºæ•°æ®æ ·æœ¬ä¸å¤ªå¹³è¡¡ï¼Œæœ‰äº›ç±»ç›®æ ·æœ¬ç‰¹åˆ«å°‘ï¼Œæœ‰äº›ç‰¹åˆ«å¤šçš„åœºæ™¯ç‰¹åˆ«æœ‰ç”¨ã€‚</p><p>ç¬¬ä¸‰è¡Œçš„weighted averageï¼Œå°±æ˜¯åŠ æƒå¹³å‡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æŠŠæ¯ä¸€ä¸ªæŒ‡æ ‡ï¼ŒæŒ‰ç…§åˆ†ç±»é‡Œé¢æ”¯æŒçš„æ ·æœ¬é‡åŠ æƒï¼Œç®—å‡ºæ¥çš„ä¸€ä¸ªå€¼ã€‚æ— è®ºæ˜¯ Precisionã€Recall è¿˜æ˜¯ F1 Scoreéƒ½è¦è¿™ä¹ˆæŒ‰ç…§å„ä¸ªåˆ†ç±»åŠ æƒå¹³å‡ä¸€ä¸‹ã€‚</p><h2>å°ç»“</h2><p><img src=\"https://static001.geekbang.org/resource/image/94/c3/947d63ba603abfc137b904b7db1cf3c3.jpg?wh=2872x1940\" alt=\"\"></p><p>å¥½äº†ï¼Œä»Šå¤©çš„è¿™ä¸€è®²åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œæœ€åæˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹ã€‚è¿™ä¸€è®²æˆ‘ä»¬å­¦ä¼šäº†ä¸¤ä»¶äº‹æƒ…ã€‚</p><p>ç¬¬ä¸€ä»¶ï¼Œæ˜¯æ€ä¹ˆåˆ©ç”¨OpenAIçš„APIæ¥è·å–æ–‡æœ¬çš„Embeddingã€‚è™½ç„¶æ¥å£ä¸å¤æ‚ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿè¦è€ƒè™‘æ¨¡å‹èƒ½å¤Ÿæ¥å—çš„æœ€å¤§æ–‡æœ¬é•¿åº¦ï¼ŒAPIæœ¬èº«çš„é™é€Ÿï¼Œä»¥åŠç½‘ç»œå»¶æ—¶å¸¦æ¥çš„é—®é¢˜ã€‚</p><p>æˆ‘ä»¬åˆ†åˆ«ç»™å‡ºäº†è§£å†³æ–¹æ¡ˆï¼Œä½¿ç”¨Tiktokenè®¡ç®—æ ·æœ¬çš„Tokenæ•°é‡ï¼Œå¹¶è¿›è¡Œè¿‡æ»¤ï¼›åœ¨é‡åˆ°é™é€Ÿé—®é¢˜æ—¶é€šè¿‡backoffè¿›è¡ŒæŒ‡æ•°çº§åˆ«çš„æ—¶é—´ç­‰å¾…ï¼›é€šè¿‡ä¸€æ¬¡æ€§æ‰¹é‡è¯·æ±‚ä¸€æ‰¹æ•°æ®ï¼Œæœ€å¤§åŒ–æˆ‘ä»¬çš„ååé‡æ¥è§£å†³é—®é¢˜ï¼›å¯¹äºè¿”å›çš„ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡parquetè¿™æ ·åºåˆ—åŒ–çš„æ–¹å¼ä¿å­˜æ•°æ®ï¼Œæ¥å‡å°‘æ•°æ®å°ºå¯¸ã€‚</p><p>ç¬¬äºŒä»¶ï¼Œæ˜¯å¦‚ä½•ç›´æ¥åˆ©ç”¨æ‹¿åˆ°çš„Embeddingï¼Œç®€å•è°ƒç”¨ä¸€ä¸‹scikit-learnï¼Œé€šè¿‡æœºå™¨å­¦ä¹ çš„æ–¹æ³•ï¼Œè¿›è¡Œæ›´å‡†ç¡®çš„åˆ†ç±»ã€‚æˆ‘ä»¬æœ€ç»ˆæŠŠEmbeddingæ”¾åˆ°ä¸€ä¸ªç®€å•çš„é€»è¾‘å›å½’æ¨¡å‹é‡Œï¼Œå°±å–å¾—äº†å¾ˆä¸é”™çš„åˆ†ç±»æ•ˆæœã€‚ä½ å­¦ä¼šäº†å—ï¼Ÿ</p><h2>è¯¾åç»ƒä¹ </h2><p>è¿™ä¸€è®²é‡Œæˆ‘ä»¬å­¦ä¼šäº†åˆ©ç”¨OpenAIæ¥è·å–æ–‡æœ¬çš„Embeddingï¼Œç„¶åé€šè¿‡ä¼ ç»Ÿçš„æœºå™¨å­¦ä¹ æ–¹å¼æ¥è¿›è¡Œè®­ç»ƒï¼Œå¹¶è¯„ä¼°è®­ç»ƒçš„ç»“æœã€‚</p><p>æˆ‘ä»¬ä¹‹å‰ç”¨è¿‡Amazon1000æ¡é£Ÿç‰©è¯„è®ºçš„æƒ…æ„Ÿåˆ†ææ•°æ®ï¼Œåœ¨é‚£ä¸ªæ•°æ®é›†é‡Œï¼Œæˆ‘ä»¬å…¶å®å·²ç»ä½¿ç”¨è¿‡è·å–åˆ°å¹¶ä¿å­˜ä¸‹æ¥çš„Embeddingæ•°æ®äº†ã€‚é‚£ä¹ˆï¼Œä½ èƒ½ä¸èƒ½è¯•ç€åœ¨å®Œæ•´çš„æ•°æ®é›†ä¸Šï¼Œè®­ç»ƒä¸€ä¸ªèƒ½æŠŠä»1åˆ†åˆ°5åˆ†çš„æ¯ä¸€ä¸ªçº§åˆ«éƒ½åŒºåˆ†å‡ºæ¥çš„æœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œçœ‹çœ‹æ•ˆæœæ€ä¹ˆæ ·ï¼Ÿ</p><p>æ•´ä¸ªåŸå§‹æ•°æ®é›†çš„ä¸‹è½½é“¾æ¥æˆ‘æ”¾åœ¨<a href=\"https://www.kaggle.com/snap/amazon-fine-food-reviews\">è¿™é‡Œ</a>äº†ï¼Œæ¬¢è¿ä½ æŠŠä½ æµ‹è¯•å‡ºæ¥çš„ç»“æœåˆ†äº«å‡ºæ¥ï¼Œçœ‹çœ‹å’Œå…¶ä»–äººæ¯”èµ·æ¥æ€ä¹ˆæ ·ã€‚å¦å¤–å¦‚æœä½ è§‰å¾—æœ‰æ”¶è·çš„è¯ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾åˆ†äº«å‡ºå»ï¼Œè®©æ›´å¤šçš„äººäº†è§£ç”¨Embeddingç»™æ–‡æœ¬åˆ†ç±»çš„æ–¹æ³•ã€‚</p>","neighbors":{"left":{"article_title":"04ï½œæ–°æ—¶ä»£æ¨¡å‹æ€§èƒ½å¤§æ¯”æ‹¼ï¼ŒGPT-3åˆ°åº•èƒœåœ¨å“ªé‡Œï¼Ÿ","id":642224},"right":{"article_title":"06ï½œChatGPTæ¥äº†ï¼Œè®©æˆ‘ä»¬å¿«é€Ÿåšä¸ªAIåº”ç”¨","id":643915}},"comments":[{"had_liked":false,"id":373871,"user_name":"éº¦è€€é”‹","can_delete":false,"product_type":"c1","uid":1401327,"ip_address":"å¹¿ä¸œ","ucode":"077DA831185C01","user_header":"https://static001.geekbang.org/account/avatar/00/15/61/ef/ac5e914d.jpg","comment_is_top":false,"comment_ctime":1683276840,"is_pvip":false,"replies":[{"id":136870,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1684753131,"ip_address":"ä¸Šæµ·","comment_id":373871,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"åº”è¯¥è¿™ä¹ˆå»ç†è§£embeddingçš„ä½¿ç”¨ã€‚ä»¥å‰æˆ‘ä»¬åšæœºå™¨å­¦ä¹ çš„æ—¶å€™ï¼ˆæˆ–è€…ç›¸å¯¹äºæ·±åº¦å­¦ä¹ ä¹‹å‰çš„â€œæµ…å±‚å­¦ä¹ â€ï¼‰ï¼Œä¸ç®¡æ˜¯æœ‰ç›‘ç£è¿˜æ˜¯æ— ç›‘ç£ï¼Œä¸€èˆ¬æˆ‘ä»¬éœ€è¦åšfeature engineeringï¼Œä¹Ÿå°±æ˜¯éœ€è¦data scientistï¼Œæ ¹æ®ä¸šåŠ¡ã€ä¸“å®¶é¢†åŸŸï¼Œå¯¹æ•°æ®æå–æœ‰ç”¨çš„featureï¼›è€Œåœ¨NLPé¢†åŸŸï¼Œé‚£ä¹ˆå°±æ˜¯é€šè¿‡word2vecç­‰å„ç§æ–¹å¼æ¥æå–featureã€‚é€šè¿‡openaiçš„embeddingæ¥å£ï¼Œå®é™…ä¸Šå°±æ˜¯openaiå¸®æˆ‘ä»¬åšäº†feature engineeringè¿™ä¸€æ­¥ï¼Œå°†æ–‡æœ¬æ˜ å°„åˆ°ä¸€ä¸ªåˆé€‚çš„vector spaceï¼Œå¾—åˆ°çš„embeddingå…¶å®å°±æ˜¯æ–‡æœ¬çš„featureï¼Œæ‰€ä»¥å¯ä»¥åŸºäºè¿™ä¸ªembeddingå³feature Xæ¥åšä¼ ç»Ÿçš„æœºå™¨å­¦ä¹ ","like_count":31,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":619059,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1684753131,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3565051,"avatar":"","nickname":"Geek_44df74","note":"","ucode":"CD6D47CE1A0BBB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":617174,"discussion_content":"å‡ä½¿ä¸Šé¢ä¾‹å­çš„å‡†å¤‡å’Œå¬å›ç¬¦åˆä¸šåŠ¡ç›®æ ‡äº†ï¼Œå…·ä½“è¦å’‹åº”ç”¨å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1683362142,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371454,"user_name":"æµ©ä»”æ˜¯ç¨‹åºå‘˜","can_delete":false,"product_type":"c1","uid":1104601,"ip_address":"å¹¿ä¸œ","ucode":"A7E5CF9E1571A2","user_header":"https://static001.geekbang.org/account/avatar/00/10/da/d9/f051962f.jpg","comment_is_top":false,"comment_ctime":1679966594,"is_pvip":false,"replies":[{"id":135720,"content":"å¯ä»¥çš„å•Šï¼Œä½†æ˜¯è¦è€ƒè™‘\n1. æˆæœ¬\n2. æ•ˆæœ\n\nåœ¨æœ‰æ ‡æ³¨æ•°æ®çš„æƒ…å†µä¸‹ï¼Œæœºå™¨å­¦ä¹ çš„æ•ˆæœé€šå¸¸æ¯”è®©ChatGPTåªç”¨å…ˆéªŒçŸ¥è¯†æ•ˆæœè¿˜æ˜¯è¦å¥½ä¸å°‘çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1680581747,"ip_address":"ä¸Šæµ·","comment_id":371454,"utype":1}],"discussion_count":9,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"è€å¸ˆï¼Œä½ å¥½ï¼æ—¢ç„¶éƒ½è°ƒç”¨open aiçš„æ¥å£ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥è®©chatgptç›´æ¥è¿”å›åˆ†ç±»ç»“æœå‘¢","like_count":17,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612219,"discussion_content":"å¯ä»¥çš„å•Šï¼Œä½†æ˜¯è¦è€ƒè™‘\n1. æˆæœ¬\n2. æ•ˆæœ\n\nåœ¨æœ‰æ ‡æ³¨æ•°æ®çš„æƒ…å†µä¸‹ï¼Œæœºå™¨å­¦ä¹ çš„æ•ˆæœé€šå¸¸æ¯”è®©ChatGPTåªç”¨å…ˆéªŒçŸ¥è¯†æ•ˆæœè¿˜æ˜¯è¦å¥½ä¸å°‘çš„ã€‚","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1680581747,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3582440,"avatar":"https://static001.geekbang.org/account/avatar/00/36/a9/e8/beca7b42.jpg","nickname":"ç‹ç‹¸çš„å¸½å­","note":"","ucode":"0BBD5868274536","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612008,"discussion_content":"è¿™æ˜¯å¤§æ¨¡å‹å¦ä¸€ç§ä½¿ç”¨æ–¹å¼ï¼Œç”¨æ¥é¢„è®­ç»ƒï¼Œå‚¨å¤‡å…ˆéªŒçŸ¥è¯†ï¼Œç„¶åå†ç”¨å¸¸ç”¨çš„æœºå™¨å­¦ä¹ æ¨¡å‹åšäºŒæ¬¡è®­ç»ƒå’Œå¾®è°ƒï¼Œå¯èƒ½ä¼šå–å¾—æ›´ä½³çš„æ•ˆæœã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1680486916,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ç¾å›½","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2161554,"avatar":"https://static001.geekbang.org/account/avatar/00/20/fb/92/0537ea08.jpg","nickname":"æ¼«æ¸¸è€…","note":"","ucode":"23DD0146F43C7D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":637517,"discussion_content":"æˆ‘å€’æ„Ÿè§‰4ä¸‡æ¡çš„è®­ç»ƒï¼Œå‡†ç¡®åº¦æ˜¯å¦ä¼šè¶…è¿‡è®©chatgptç›´æ¥è¿›è¡Œåˆ†ç±»~è€å¸ˆæ˜¾ç„¶è®¤ä¸ºæœ‰äº†å‡†ç¡®æ ‡ç­¾çš„åç»­è®­ç»ƒä¼šæ¯”è®©gptè‡ªå·±åˆ†ç±»æ•ˆæœå¥½ï¼Œè¿™ç‚¹æˆ‘ä¿ç•™æ„è§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1708585286,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1786915,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/44/23/ebe7bd0f.jpg","nickname":"å•Šå•Šå•Šå•Š","note":"","ucode":"090E3983DD41A6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":619493,"discussion_content":"ä½†è¿™ä¸ªè¿‡ç¨‹ä¹Ÿå¼•å…¥äº†openAI çš„æ¥å£ï¼Œå³ä½¿è¿™ä¸ªæ¨¡å‹è®­ç»ƒå¥½äº†ï¼Œä»¥åæ¯ç»™ç”¨æˆ·çš„æ•°æ®åšåˆ†ç±»ï¼Œä¸ä¹Ÿè¦è°ƒç”¨ openAIçš„æ¥å£è®¡ç®—embeddingä¹ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1685178660,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3568860,"avatar":"","nickname":"Geek_0b2332","note":"","ucode":"B64FA0D7BA6BA6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":611780,"discussion_content":"å“¥ä»¬ï¼Œçœ‹çœ‹æœ¬è®²çš„æ ‡é¢˜å“ˆã€‚ç›´æ¥ç»™å‡ºåˆ†ç±»ç»“æœå½“ç„¶å¯ä»¥ï¼Œä¸è¿‡è€å¸ˆæ˜¯ç»™å‡ºäº†å¦ä¸€ç§æŠ€æœ¯è·¯å¾„ï¼ˆä½¿ç”¨embedding+åç«¯classifierï¼‰æ¥åšåˆ†ç±»ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680315414,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ±Ÿè‹","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1899996,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/fd/dc/8c394a51.jpg","nickname":"åˆ˜è•¾","note":"","ucode":"984D2C7E286DA1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":611557,"discussion_content":"ä½¿ç”¨çš„è¯­è¨€æ¨¡å‹æœ‰å·®åˆ«ï¼Œchatgptæ˜¯gpt-3.5-turboï¼Œåˆ†ç±»æ˜¯text-embedding-ada-002","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680168223,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ–¯æ´›ä¼å…‹","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1186273,"avatar":"https://static001.geekbang.org/account/avatar/00/12/19/e1/a7fbc963.jpg","nickname":"Warren","note":"","ucode":"7518ED2E07AAF7","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":611533,"discussion_content":"è¯„ä»·çš„è¯„åˆ†(1åˆ†åˆ°5åˆ†)çš„åˆ†ç±»chatGPTç›´æ¥ç»™ä¸å‡ºæ¥å§ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680158467,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2081124,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/c1/64/3b994bd5.jpg","nickname":"å–çƒ§çƒ¤å¤«æ–¯åŸº","note":"","ucode":"EC9DB8C4A3C21A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":611362,"discussion_content":"åŒé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680056879,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1922378,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/55/4a/8a841200.jpg","nickname":"ACK","note":"","ucode":"C5D09B18DEF151","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":611342,"discussion_content":"è¿™ä¹Ÿæ˜¯æˆ‘çš„ç–‘é—®ï¼Œä½†æƒ³ä¸€ä¸‹ä¹Ÿæœ‰åˆç†çš„åœ°æ–¹ï¼Œå°±æ˜¯ open ai å¯ä»¥é€šè¿‡ç¼–ç¨‹æä¾›çš„è¾“å…¥è°ƒç”¨ï¼Œå½¢æˆè‡ªåŠ¨åŒ–èƒ½åŠ›ã€‚\nchatGPT ä¸»è¦æ˜¯ä¸äººçš„è‡ªç„¶è¯­è¨€å¯¹è¯ï¼Œåœ¨å¯¹è¯çª—å£æ¥è¾“å…¥ï¼Œäººå·¥æ‰‹åŠ¨æ“ä½œï¼Œå±€é™æ€§å¾ˆå¤§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680051138,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸­å›½é¦™æ¸¯","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":372211,"user_name":"è‰¯è¾°ç¾æ™¯","can_delete":false,"product_type":"c1","uid":1074803,"ip_address":"ä¸Šæµ·","ucode":"B36E6955A2872D","user_header":"https://static001.geekbang.org/account/avatar/00/10/66/73/fd1e37a2.jpg","comment_is_top":false,"comment_ctime":1680850347,"is_pvip":false,"replies":[{"id":135874,"content":"è¯»ä¸€éAPIæ–‡æ¡£ï¼Œè¯»ä¸€éOpenAI Cookbookã€‚è¿™æ˜¯çœ‹èµ·æ¥æœ€ç¬¨ï¼Œå…¶å®æœ€èŠ‚çº¦æ—¶é—´çš„åŠæ³•ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1680973554,"ip_address":"æ—¥æœ¬","comment_id":372211,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"â€œè°ƒç”¨äº† Tiktoken è¿™ä¸ªåº“ï¼Œä½¿ç”¨äº† cl100k_base è¿™ç§ç¼–ç æ–¹å¼ï¼Œè¿™ç§ç¼–ç æ–¹å¼å’Œ text-embedding-ada-002 æ¨¡å‹æ˜¯ä¸€è‡´çš„ã€‚å¦‚æœé€‰é”™äº†ç¼–ç æ–¹å¼ï¼Œä½ è®¡ç®—å‡ºæ¥çš„ Token æ•°é‡å¯èƒ½å’Œ OpenAI çš„ä¸ä¸€æ ·ã€‚â€ è€å¸ˆï¼Œ é—®ä½ ä¸€ä¸ªå­¦ä¹ ä¸Šçš„é—®é¢˜ï¼Œ åƒè¿™ç§API æ–‡æ¡£é‡Œè¿™ä¹ˆç»†èŠ‚çš„ä¸œè¥¿ï¼Œä½ æ˜¯å¦‚ä½•è·å–è¿™äº›ä¿¡æ¯çš„","like_count":10,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612869,"discussion_content":"è¯»ä¸€éAPIæ–‡æ¡£ï¼Œè¯»ä¸€éOpenAI Cookbookã€‚è¿™æ˜¯çœ‹èµ·æ¥æœ€ç¬¨ï¼Œå…¶å®æœ€èŠ‚çº¦æ—¶é—´çš„åŠæ³•ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1680973554,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ—¥æœ¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371683,"user_name":"Toni","can_delete":false,"product_type":"c1","uid":3206957,"ip_address":"ç‘å£«","ucode":"E6B2FACCC1E000","user_header":"https://static001.geekbang.org/account/avatar/00/30/ef/2d/757bb0d3.jpg","comment_is_top":false,"comment_ctime":1680178508,"is_pvip":false,"replies":[{"id":135729,"content":"ğŸ‘ æˆ‘æœ¬æœºæ˜¯é»˜è®¤ä¼šé€€å›åˆ°ç”¨pythonå¼•æ“æ¥åˆ†å‰²ï¼Œæ„Ÿè°¢ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1680582401,"ip_address":"ä¸Šæµ·","comment_id":371683,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"åœ¨æ‰§è¡Œè¿™æ®µä»£ç æ—¶ä¼šæŠ¥ParserWarning\ndf = pd.read_csv(&#39;data&#47;toutiao_cat&#47;toutiao_cat_data.txt&#39;, sep=&#39;_!_&#39;, names=[&#39;id&#39;, &#39;code&#39;, &#39;category&#39;, &#39;title&#39;, &#39;keywords&#39;])\n\nParserWarning: Falling back to the &#39;python&#39; engine because the &#39;c&#39; engine does not support regex separators (separators &gt; 1 char and different from &#39;\\s+&#39; are interpreted as regex); you can avoid this warning by specifying engine=&#39;python&#39;.\n\nåŸå› æ˜¯ &#39;c&#39; å¼•æ“ä¸æ”¯æŒåˆ†éš”ç¬¦sep=&#39;_!_&#39;è¡¨è¾¾å¼ï¼Œå¯æŒ‡å®š engine=&#39;python&#39; æ¥é¿å…æ­¤è­¦å‘Šã€‚\nä»£ç å¦‚ä¸‹\ndf = pd.read_csv(&#39;data&#47;toutiao_cat&#47;toutiao_cat_data.txt&#39;, engine= &#39;python&#39;ï¼Œ sep=&#39;_!_&#39;, names=[&#39;id&#39;, &#39;code&#39;, &#39;category&#39;, &#39;title&#39;, &#39;keywords&#39;])","like_count":5,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612228,"discussion_content":"ğŸ‘ æˆ‘æœ¬æœºæ˜¯é»˜è®¤ä¼šé€€å›åˆ°ç”¨pythonå¼•æ“æ¥åˆ†å‰²ï¼Œæ„Ÿè°¢ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680582401,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371478,"user_name":"æ€¡ä»”","can_delete":false,"product_type":"c1","uid":2201689,"ip_address":"ä¸Šæµ·","ucode":"FD17CA43292456","user_header":"https://static001.geekbang.org/account/avatar/00/21/98/59/c2ce609d.jpg","comment_is_top":false,"comment_ctime":1679981704,"is_pvip":false,"replies":[{"id":135766,"content":"çœ‹ä¸€ä¸‹githubçš„READMEé‡Œç»™äº†ä¸€ä¸ªç™¾åº¦ç½‘ç›˜çš„ä¸‹è½½æ–¹å¼\nå¯¹åº”çš„æ•°æ®æ–‡ä»¶æ¯”è¾ƒå¤§ï¼ŒGitHubé‡Œç›´æ¥æ”¾ä¹Ÿä¸å¤ªæ–¹ä¾¿ä¸‹è½½","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1680587423,"ip_address":"ä¸Šæµ·","comment_id":371478,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"githubä¸­çš„æ‰¾ä¸åˆ°é€”ä¸­åˆ—ä¸¾çš„æ•°æ®æ–‡ä»¶","like_count":5,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612273,"discussion_content":"çœ‹ä¸€ä¸‹githubçš„READMEé‡Œç»™äº†ä¸€ä¸ªç™¾åº¦ç½‘ç›˜çš„ä¸‹è½½æ–¹å¼\nå¯¹åº”çš„æ•°æ®æ–‡ä»¶æ¯”è¾ƒå¤§ï¼ŒGitHubé‡Œç›´æ¥æ”¾ä¹Ÿä¸å¤ªæ–¹ä¾¿ä¸‹è½½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680587423,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1085809,"avatar":"https://static001.geekbang.org/account/avatar/00/10/91/71/d7471004.jpg","nickname":"luiså°éº¦","note":"","ucode":"6AE70B61C713A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":611448,"discussion_content":"404ï¼Œæ‰“ä¸å¼€","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1680090848,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1452167,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJcwXucibksEYRSYg6icjibzGa7efcMrCsGec2UwibjTd57icqDz0zzkEEOM2pXVju60dibzcnQKPfRkN9g/132","nickname":"Geek_93970d","note":"","ucode":"52AC308BEC7737","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":618788,"discussion_content":"å¥½å˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1684556569,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1795369,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/65/29/a76c69d9.jpg","nickname":"å¼ å‘ Fain","note":"","ucode":"A3745E544066F9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612117,"discussion_content":"åœ¨dataæ–‡ä»¶å¤¹é‡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680517849,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371877,"user_name":"lala","can_delete":false,"product_type":"c1","uid":3582410,"ip_address":"åŒ—äº¬","ucode":"D6B9DD7A6E899F","user_header":"https://static001.geekbang.org/account/avatar/00/36/a9/ca/f216bece.jpg","comment_is_top":false,"comment_ctime":1680483828,"is_pvip":false,"replies":[{"id":135752,"content":"çœ‹æœ€æ–°ä¸Šçº¿çš„10ï¼Œ11è®²ï¼Œä»¥åŠåé¢ä¼šä¸Šçº¿çš„14-17è®²","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1680586366,"ip_address":"ä¸Šæµ·","comment_id":371877,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"ç°åœ¨chatGPTæ˜¯é€šç”¨çš„é—®ç­”åº”ç”¨ã€‚è¯·é—®å¦‚ä½•æ ¹æ®ChatGPTç»“åˆå…¬å¸ä¸šåŠ¡çš„çŸ¥è¯†åº“å’Œå•†å“ä¿¡æ¯ï¼Œå¦‚ä½•æ‰“é€ æœåŠ¡å®¢æˆ·å’Œå†…éƒ¨é¡¾é—®çš„æœºå™¨äººï¼Ÿæ¯”å¦‚æ ¹æ®ç”¨æˆ·é—®é¢˜ï¼Œæ¨èå¯¹åº”äº§å“ç»™ç”¨æˆ·ã€‚æ ¹æ®å†…éƒ¨çŸ¥è¯†åº“ï¼Œå›ç­”å†…éƒ¨åŒäº‹å…³äºäº§å“ä½¿ç”¨ï¼Œè¿è¥ä¿¡æ¯ç›¸å…³çš„é—®é¢˜å‘¢ã€‚è°¢è°¢","like_count":4,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612258,"discussion_content":"çœ‹æœ€æ–°ä¸Šçº¿çš„10ï¼Œ11è®²ï¼Œä»¥åŠåé¢ä¼šä¸Šçº¿çš„14-17è®²","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680586366,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371746,"user_name":"Toni","can_delete":false,"product_type":"c1","uid":3206957,"ip_address":"ç‘å£«","ucode":"E6B2FACCC1E000","user_header":"https://static001.geekbang.org/account/avatar/00/30/ef/2d/757bb0d3.jpg","comment_is_top":false,"comment_ctime":1680254620,"is_pvip":false,"replies":[{"id":135726,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1680582186,"ip_address":"ä¸Šæµ·","comment_id":371746,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"è®­ç»ƒä¸€ä¸ªèƒ½æŠŠä» 1 åˆ†åˆ° 5 åˆ†çš„æ¯ä¸€ä¸ªçº§åˆ«éƒ½åŒºåˆ†å‡ºæ¥çš„æœºå™¨å­¦ä¹ æ¨¡å‹.\nä½¿ç”¨ä¸‹è½½çš„æ•°æ® fine_food_reviews_with_embeddings_1k.csv\n\néšæœºæ£®æ—æ¨¡å‹ï¼Œè¶…å‚æ•° n_estimators=100 ä¸‹è·‘çš„ç»“æœ\n\n              precision    recall  f1-score   support\n\n           1       0.86      0.30      0.44        20\n           2       1.00      0.38      0.55         8\n           3       1.00      0.18      0.31        11\n           4       1.00      0.26      0.41        27\n           5       0.74      1.00      0.85       134\n\n       accuracy                               0.76       200\n    macro avg       0.92      0.42      0.51       200\nweighted avg       0.81      0.76      0.71       200\n\næç«¯éšæœºæ£®æ—æ¨¡å‹ ExtraTreesClassifier() ä¸‹è·‘çš„ç»“æœ\n\n              precision    recall  f1-score   support\n\n           1       1.00      0.20      0.33        20\n           2       1.00      0.38      0.55         8\n           3       1.00      0.18      0.31        11\n           4       1.00      0.26      0.41        27\n           5       0.73      1.00      0.84       134\n\n      accuracy                                0.75       200\n    macro avg       0.95      0.40      0.49       200\nweighted avg       0.82      0.75      0.69       200\n","like_count":4,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612225,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680582186,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1081299,"avatar":"https://static001.geekbang.org/account/avatar/00/10/7f/d3/b5896293.jpg","nickname":"Realm","note":"","ucode":"30CBEBE619D1A2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":614036,"discussion_content":"æˆ‘åœ¨çº¿æ€§å›å½’ä¸‹è·‘çš„ç»“æœï¼Œæ¯”éšæœºæ£®æ—è¦å·®å¾ˆå¤šï¼Œä¼šæ˜¯ä»€ä¹ˆåŸå› ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1681641971,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ—¥æœ¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371528,"user_name":"Geek_513b7c","can_delete":false,"product_type":"c1","uid":3579076,"ip_address":"å‰æ—","ucode":"8F252A56BFA03F","user_header":"","comment_is_top":false,"comment_ctime":1680017129,"is_pvip":false,"replies":[{"id":135782,"content":"å¯ä»¥è®¤ä¸ºï¼Œå°±æ˜¯æŠŠæ–‡æœ¬ï¼Œç”¨ä¸€ç»„æ•°å­—æ¥è¡¨ç¤ºï¼Œè¿™ç»„æ•°å­—è¡¨ç¤ºäº†è¿™æ®µæ–‡æœ¬åœ¨é«˜ç»´ç©ºé—´é‡Œé¢çš„åæ ‡ã€‚ä¸¤æ®µæ–‡æœ¬ç›¸ä¼¼ï¼Œå°±æ˜¯ä»–ä»¬åæ ‡ä¹‹é—´æ¯”è¾ƒè¿‘ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1680590051,"ip_address":"ä¸Šæµ·","comment_id":371528,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"è€å¸ˆï¼Œä½ èƒ½è§£é‡Šä¸€ä¸‹åœ¨aiä¸­å‘é‡æ˜¯ä»€ä¹ˆæ„æ€å—ï¼Ÿè¿™å‡ èŠ‚çœ‹çš„äº‘é‡Œé›¾é‡Œçš„","like_count":4,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612299,"discussion_content":"å¯ä»¥è®¤ä¸ºï¼Œå°±æ˜¯æŠŠæ–‡æœ¬ï¼Œç”¨ä¸€ç»„æ•°å­—æ¥è¡¨ç¤ºï¼Œè¿™ç»„æ•°å­—è¡¨ç¤ºäº†è¿™æ®µæ–‡æœ¬åœ¨é«˜ç»´ç©ºé—´é‡Œé¢çš„åæ ‡ã€‚ä¸¤æ®µæ–‡æœ¬ç›¸ä¼¼ï¼Œå°±æ˜¯ä»–ä»¬åæ ‡ä¹‹é—´æ¯”è¾ƒè¿‘ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680590052,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3579742,"avatar":"https://static001.geekbang.org/account/avatar/00/36/9f/5e/791d0f5e.jpg","nickname":"è‡ªç„¶å·çš„Neil","note":"","ucode":"44ECCBE5B7F6CA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":611423,"discussion_content":"NLPé‡Œçš„åŸºç¡€çŸ¥è¯†ï¼ŒBç«™æœ‰å¥½å¤šï¼Œå¾ˆå¿«å°±å­¦æ‡‚äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680080241,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":372052,"user_name":"å››æœˆ.  ğŸ•Š","can_delete":false,"product_type":"c1","uid":1796939,"ip_address":"åŒ—äº¬","ucode":"C8B8C3605AB67A","user_header":"https://static001.geekbang.org/account/avatar/00/1b/6b/4b/4a622bdf.jpg","comment_is_top":false,"comment_ctime":1680664138,"is_pvip":false,"replies":[{"id":135904,"content":"çœ‹äº†ä¸€ä¸‹çš„ç¡®æ˜¯å¯ä»¥ä¸ç”¨çš„ã€‚åŸæ¥æ˜¯æƒ³åšæˆä¸¤å±‚batch_sizeçš„ï¼Œå°±æ˜¯1000ä¸ªbatchæ‰”ç»™get_embeddings_with_backoffï¼Œç„¶åé‡Œé¢å†100ä¸ªä¸€ä¸ªbatchè¿™æ ·ï¼Œä¸è¿‡åæ¥å‘ç°æ²¡æœ‰å¿…è¦ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1680975719,"ip_address":"æ—¥æœ¬","comment_id":372052,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"è¯·é—®ä¸€ä¸‹è€å¸ˆï¼Œæ—¢ç„¶å·²ç»æŒ‰ç…§batch_sizeåˆ’åˆ†å‡ºæ¥äº†prompt_batchesï¼Œä¸ºä»€ä¹ˆåœ¨get_embeddings_with_backoffå‡½æ•°ä¸­è¿˜è¦åˆ’åˆ†ä¸€æ¬¡batchå‘¢ï¼Ÿæ˜¯ä¸æ˜¯é‡å¤äº†ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612901,"discussion_content":"çœ‹äº†ä¸€ä¸‹çš„ç¡®æ˜¯å¯ä»¥ä¸ç”¨çš„ã€‚åŸæ¥æ˜¯æƒ³åšæˆä¸¤å±‚batch_sizeçš„ï¼Œå°±æ˜¯1000ä¸ªbatchæ‰”ç»™get_embeddings_with_backoffï¼Œç„¶åé‡Œé¢å†100ä¸ªä¸€ä¸ªbatchè¿™æ ·ï¼Œä¸è¿‡åæ¥å‘ç°æ²¡æœ‰å¿…è¦ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680975719,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ—¥æœ¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371881,"user_name":"ç‹å¹³","can_delete":false,"product_type":"c1","uid":1487529,"ip_address":"ä¸Šæµ·","ucode":"CF1ABC5F962EC8","user_header":"https://static001.geekbang.org/account/avatar/00/16/b2/a9/791d0f5e.jpg","comment_is_top":false,"comment_ctime":1680485431,"is_pvip":false,"replies":[{"id":135712,"content":"æˆ‘æ²¡æœ‰è¯•è¿‡ï¼Œä½ å¯ä»¥è¯•ä¸€ä¸‹ï¼Œå¦‚æœæœ‰ç»“æœæ¬¢è¿åˆ†äº«ã€‚æˆ‘çŒœå¦‚æœä¸€èˆ¬äººèƒ½åˆ¤æ–­å‡ºæ¥ï¼Œå®ƒå°±èƒ½åˆ¤æ–­å‡ºæ¥ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1680581376,"ip_address":"ä¸Šæµ·","comment_id":371881,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"è€å¸ˆè¯·é—®å¦‚æœæŠŠæ—¶åºæ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ·è¡Œä¸ºåºåˆ—ä½œä¸ºè¾“å…¥ç»™openAI çš„ embedding, æ ¹æ®è¡Œä¸ºåˆ¤æ–­ç”¨æˆ·æƒ…æ„Ÿçš„æ•ˆæœä¼šå¥½å—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612211,"discussion_content":"æˆ‘æ²¡æœ‰è¯•è¿‡ï¼Œä½ å¯ä»¥è¯•ä¸€ä¸‹ï¼Œå¦‚æœæœ‰ç»“æœæ¬¢è¿åˆ†äº«ã€‚æˆ‘çŒœå¦‚æœä¸€èˆ¬äººèƒ½åˆ¤æ–­å‡ºæ¥ï¼Œå®ƒå°±èƒ½åˆ¤æ–­å‡ºæ¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680581376,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":374341,"user_name":"é«˜æ·","can_delete":false,"product_type":"c1","uid":3618463,"ip_address":"æ—¥æœ¬","ucode":"2FF75E8918E6C2","user_header":"","comment_is_top":false,"comment_ctime":1683951491,"is_pvip":false,"replies":[{"id":136851,"content":"text-ada-embedding-002 è¿™æ ·çš„æ¨¡å‹å¹¶ä¸ä¼šæ›´æ–°ï¼Œæ‰€ä»¥ä¸å­˜åœ¨éœ€è¦â€œåŒæ­¥ä¸€æ¬¡embeddingæ¨¡å‹â€\n\nOpenAIçš„æ¨¡å‹ï¼Œæœ‰ä¸æ›´æ–°çš„ï¼ˆå¸¦æ—¥æœŸå¿«ç…§çš„ gpt-3.5-turbo-0314 è¿™ç§ï¼‰ï¼Œä¹Ÿæœ‰æ›´æ–°çš„ï¼ˆgpt-3.5-turboï¼‰\n\nå¦‚æœè¯´æ¨¡å‹æœ¬èº«OpenAIæ€ä¹ˆæ›´æ–°çš„è¯ï¼Œæˆ‘æ¨æµ‹æ˜¯ä¼´éšç€ç”¨æˆ·åé¦ˆçš„æ•°æ®ä½œä¸ºè¾“å…¥ç»§ç»­å¾®è°ƒæ¨¡å‹æƒé‡çš„ä¸€ä¸ªæµç¨‹ï¼Œå¯ä»¥çœ‹çœ‹18è®²çš„fine-tune","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1684749244,"ip_address":"ä¸Šæµ·","comment_id":374341,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100541001,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæƒ³çŸ¥é“å¤§æ¦‚å¤šä¹…éœ€è¦å»åŒæ­¥ä¸€æ¬¡embeddingæ¨¡å‹ï¼Œå¤§æ¨¡å‹è‡ªå·±æ€ä¹ˆæ›´æ–°è¿­ä»£å‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":619030,"discussion_content":"text-ada-embedding-002 è¿™æ ·çš„æ¨¡å‹å¹¶ä¸ä¼šæ›´æ–°ï¼Œæ‰€ä»¥ä¸å­˜åœ¨éœ€è¦â€œåŒæ­¥ä¸€æ¬¡embeddingæ¨¡å‹â€\n\nOpenAIçš„æ¨¡å‹ï¼Œæœ‰ä¸æ›´æ–°çš„ï¼ˆå¸¦æ—¥æœŸå¿«ç…§çš„ gpt-3.5-turbo-0314 è¿™ç§ï¼‰ï¼Œä¹Ÿæœ‰æ›´æ–°çš„ï¼ˆgpt-3.5-turboï¼‰\n\nå¦‚æœè¯´æ¨¡å‹æœ¬èº«OpenAIæ€ä¹ˆæ›´æ–°çš„è¯ï¼Œæˆ‘æ¨æµ‹æ˜¯ä¼´éšç€ç”¨æˆ·åé¦ˆçš„æ•°æ®ä½œä¸ºè¾“å…¥ç»§ç»­å¾®è°ƒæ¨¡å‹æƒé‡çš„ä¸€ä¸ªæµç¨‹ï¼Œå¯ä»¥çœ‹çœ‹18è®²çš„fine-tune","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1684749244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":374039,"user_name":"æ¥šç¿”style","can_delete":false,"product_type":"c1","uid":1174846,"ip_address":"å†…è’™å¤","ucode":"E715F82C34A9AA","user_header":"https://static001.geekbang.org/account/avatar/00/11/ed/3e/c1725237.jpg","comment_is_top":false,"comment_ctime":1683530765,"is_pvip":false,"replies":[{"id":136832,"content":"è‹±æ–‡å•è¯åŸºæœ¬ä¸Šå¤§çº¦3ä¸ªå•è¯4ä¸ªTokenï¼Œä¸­æ–‡åŸºæœ¬ä¸Š1ä¸ªå­—2-3ä¸ªTokenã€‚\nåé¢çš„è¯¾ç¨‹é‡Œæœ‰å…·ä½“ä»‹ç»å¦‚ä½•è®¡ç®—tokençš„ä¾‹å­ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1684744358,"ip_address":"ä¸Šæµ·","comment_id":374039,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100541001,"comment_content":"èŠ±è´¹å¤šå°‘tokenæ€ä¹ˆç®—å‘¢ \nä¸€ä¸ªé—®é¢˜ä¸€ä¸ªtokenå—","like_count":1,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":619001,"discussion_content":"è‹±æ–‡å•è¯åŸºæœ¬ä¸Šå¤§çº¦3ä¸ªå•è¯4ä¸ªTokenï¼Œä¸­æ–‡åŸºæœ¬ä¸Š1ä¸ªå­—2-3ä¸ªTokenã€‚\nåé¢çš„è¯¾ç¨‹é‡Œæœ‰å…·ä½“ä»‹ç»å¦‚ä½•è®¡ç®—tokençš„ä¾‹å­ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1684744359,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":373683,"user_name":"R9Go","can_delete":false,"product_type":"c1","uid":1070171,"ip_address":"éŸ©å›½","ucode":"D15816C721FB80","user_header":"https://static001.geekbang.org/account/avatar/00/10/54/5b/fe7ebc2e.jpg","comment_is_top":false,"comment_ctime":1683010973,"is_pvip":false,"replies":[{"id":136444,"content":"åº”è¯¥æ˜¯å…¨çš„ï¼Œæˆ–è€…å¯ä»¥å»READMEé‡Œé¢åˆ—å‡ºæ¥çš„ç™¾åº¦ç½‘ç›˜ä¸‹è½½\né“¾æ¥: https:&#47;&#47;pan.baidu.com&#47;s&#47;1Cl0eFNLOkQqquf9ls0trEw æå–ç : jvr4\n","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1683082455,"ip_address":"ä¸Šæµ·","comment_id":373683,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100541001,"comment_content":"https:&#47;&#47;github.com&#47;xuwenhao&#47;geektime-ai-course&#47;blob&#47;main&#47;data&#47;20_newsgroup_with_embedding.parquet\nè¿™ä¸ªæ•°æ®æ˜¯ä¸æ˜¯ä¸å…¨ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":616666,"discussion_content":"åº”è¯¥æ˜¯å…¨çš„ï¼Œæˆ–è€…å¯ä»¥å»READMEé‡Œé¢åˆ—å‡ºæ¥çš„ç™¾åº¦ç½‘ç›˜ä¸‹è½½\né“¾æ¥: https://pan.baidu.com/s/1Cl0eFNLOkQqquf9ls0trEw æå–ç : jvr4\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1683082455,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":372821,"user_name":"Geek_512735","can_delete":false,"product_type":"c1","uid":3588303,"ip_address":"åŒ—äº¬","ucode":"D45BF63D413316","user_header":"","comment_is_top":false,"comment_ctime":1681693744,"is_pvip":false,"replies":[{"id":136255,"content":"æ•ˆæœå¥½ï¼Œè¯­ä¹‰è¡¨è¾¾èƒ½åŠ›å¼ºï¼Œæˆæœ¬ä¹Ÿä¸é«˜ã€‚ä¸»è¦ç¼ºç‚¹æ˜¯éœ€è¦æŠŠæ•°æ®å‘é€ç»™OpenAIã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1681794225,"ip_address":"ä¸Šæµ·","comment_id":372821,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100541001,"comment_content":"è€å¸ˆï¼Œè¯·åˆ©ç”¨ChatGPT embeddingçš„ä¼˜åŠ¿åœ¨ä»€ä¹ˆåœ°æ–¹ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":614457,"discussion_content":"æ•ˆæœå¥½ï¼Œè¯­ä¹‰è¡¨è¾¾èƒ½åŠ›å¼ºï¼Œæˆæœ¬ä¹Ÿä¸é«˜ã€‚ä¸»è¦ç¼ºç‚¹æ˜¯éœ€è¦æŠŠæ•°æ®å‘é€ç»™OpenAIã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1681794225,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":372307,"user_name":"Bank","can_delete":false,"product_type":"c1","uid":3580859,"ip_address":"åŒ—äº¬","ucode":"8EAA7C63DF9297","user_header":"https://static001.geekbang.org/account/avatar/00/36/a3/bb/5cde4385.jpg","comment_is_top":false,"comment_ctime":1680954783,"is_pvip":false,"replies":[{"id":135859,"content":"134217728 æ˜¯128MBå†…å­˜ç©ºé—´ï¼Œçœ‹èµ·æ¥åº”è¯¥ä¼šä¸ä¼šæ˜¯ç¯å¢ƒå“ªé‡Œåšäº†é™åˆ¶ï¼Ÿ\n\nå³ä½¿åœ¨Windowsä¸‹ï¼Œæˆ‘ä¹Ÿæ¨èä½¿ç”¨WSL2çš„Linuxå­ç³»ç»Ÿæ¥è¿è¡Œè¿™äº›ä»£ç ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1680972295,"ip_address":"ä¸­å›½é¦™æ¸¯","comment_id":372307,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100541001,"comment_content":"åœ¨è¯»æ•°æ®çš„æ—¶å€™æŠ¥äº†è¿™ä¸ªé”™ï¼Œè¯·é—®å¦‚ä½•è§£å†³å‘¢ï¼Ÿå†…å­˜åº”è¯¥æ˜¯è¶³å¤Ÿçš„\n---------------------------------------------------------------------------\nArrowMemoryError                          Traceback (most recent call last)\nCell In[6], line 6\n      3 from sklearn.model_selection import train_test_split\n      4 from sklearn.metrics import classification_report, accuracy_score\n----&gt; 6 training_data = pd.read_parquet(&quot;D:&#47;work&#47;data&#47;toutiao_cat_data_all_with_embeddings.parquet&quot;)\n      7 training_data.head()\n      9 df =  training_data.sample(50000, random_state=42)\n\nã€‚ã€‚ã€‚ã€‚ã€‚ã€‚\n-&gt; 2517 table = self._dataset.to_table(\n   2518     columns=columns, filter=self._filter_expression,\n   2519     use_threads=use_threads\n   2520 )\n   2522 # if use_pandas_metadata, restore the pandas metadata (which gets\n   2523 # lost if doing a specific `columns` selection in to_table)\n   2524 if use_pandas_metadata:\n\nFile D:\\anaconda3\\lib\\site-packages\\pyarrow\\_dataset.pyx:332, in pyarrow._dataset.Dataset.to_table()\n\nFile D:\\anaconda3\\lib\\site-packages\\pyarrow\\_dataset.pyx:2661, in pyarrow._dataset.Scanner.to_table()\n\nFile D:\\anaconda3\\lib\\site-packages\\pyarrow\\error.pxi:144, in pyarrow.lib.pyarrow_internal_check_status()\n\nFile D:\\anaconda3\\lib\\site-packages\\pyarrow\\error.pxi:117, in pyarrow.lib.check_status()\n\nArrowMemoryError: malloc of size 134217728 failed","like_count":1,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612854,"discussion_content":"134217728 æ˜¯128MBå†…å­˜ç©ºé—´ï¼Œçœ‹èµ·æ¥åº”è¯¥ä¼šä¸ä¼šæ˜¯ç¯å¢ƒå“ªé‡Œåšäº†é™åˆ¶ï¼Ÿ\n\nå³ä½¿åœ¨Windowsä¸‹ï¼Œæˆ‘ä¹Ÿæ¨èä½¿ç”¨WSL2çš„Linuxå­ç³»ç»Ÿæ¥è¿è¡Œè¿™äº›ä»£ç ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680972295,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸­å›½é¦™æ¸¯","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371527,"user_name":"xbc","can_delete":false,"product_type":"c1","uid":2187437,"ip_address":"æµ·å—","ucode":"03F1FD7B8CA32F","user_header":"https://static001.geekbang.org/account/avatar/00/21/60/ad/03351e6e.jpg","comment_is_top":false,"comment_ctime":1680016017,"is_pvip":false,"replies":[{"id":135722,"content":"é»˜è®¤embeddingæ˜¯ text-similarity-davinci-001\nç¬¬8è®²ï¼Œä¼šåˆ—ä¸¾æ¨¡å‹å·®åˆ«\n\n text-similarity-davinci-001 æ•ˆæœæ¯”  text-embedding-ada-002 åœ¨ç›¸ä¼¼åº¦æ¯”è¾ƒä¸Šå…¶å®æ›´å¥½ï¼Œä½†æ˜¯å¤ªè´µäº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1680581988,"ip_address":"ä¸Šæµ·","comment_id":371527,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100541001,"comment_content":"from openai.embeddings_utils import get_embeddings ç”¨çš„æ˜¯ text-similarity-davinci-001 å§.\n\nopenai.Embedding.create å¯ä»¥é€‰æ‹©ç”¨ text-embedding-ada-002","like_count":1,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612221,"discussion_content":"é»˜è®¤embeddingæ˜¯ text-similarity-davinci-001\nç¬¬8è®²ï¼Œä¼šåˆ—ä¸¾æ¨¡å‹å·®åˆ«\n\n text-similarity-davinci-001 æ•ˆæœæ¯”  text-embedding-ada-002 åœ¨ç›¸ä¼¼åº¦æ¯”è¾ƒä¸Šå…¶å®æ›´å¥½ï¼Œä½†æ˜¯å¤ªè´µäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680581988,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":374920,"user_name":"Geek_378f83","can_delete":false,"product_type":"c1","uid":3196784,"ip_address":"ç¾å›½","ucode":"AD2B400EED436A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/z3nIITkhzRj9WApibhic524lQSJmqUCerpuqpntEe06LE3lRGKr6rGwPpPJtZ5Xj0NBPyvTatKtIk0hfyAnl9Hsg/132","comment_is_top":false,"comment_ctime":1684657728,"is_pvip":false,"replies":[{"id":136800,"content":"å…¶å®ChatGPTå›ç­”ä¸äº†çš„é—®é¢˜ï¼Œè¿˜æ˜¯å¯ä»¥Googleæˆ–è€…Stackoverflowæœç´¢ä¸€ä¸‹ï¼Œå‚çœ‹\n\nhttps:&#47;&#47;stackoverflow.com&#47;questions&#47;67720198&#47;how-to-upgrade-libstdc-so-on-colab-runtime\n\nColabçš„ç¡®ç¯å¢ƒæ­å»ºä¸ç»Ÿä¸€ï¼Œä¼šç»™å¤§å®¶é€ æˆç‚¹å›°æ‰°","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1684723299,"ip_address":"æ–°åŠ å¡","comment_id":374920,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100541001,"comment_content":"è€å¸ˆï¼ŒåŒå­¦ä»¬å¥½ï¼Œè¯·æ•™ä¸€ä¸‹ï¼š\ncolab ä¸­è¿è¡Œæ—¶æŠ¥é”™ï¼š  &#47;lib&#47;x86_64-linux-gnu&#47;libstdc++.so.6: version `GLIBCXX_3.4.29&#39; not found (required by &#47;usr&#47;local&#47;lib&#47;python3.10&#47;site-packages&#47;sentencepiece&#47;_sentencepiece.cpython-310-x86_64-linux-gnu.so)ï¼›éœ€è¦åœ¨colabä¸­æ€ä¹ˆè§£å†³ï¼Ÿ\nè¯¢é—®gptåç›®å‰ä»æœªè§£å†³ï¼Œæ±‚åŠ©","like_count":0,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":618936,"discussion_content":"å…¶å®ChatGPTå›ç­”ä¸äº†çš„é—®é¢˜ï¼Œè¿˜æ˜¯å¯ä»¥Googleæˆ–è€…Stackoverflowæœç´¢ä¸€ä¸‹ï¼Œå‚çœ‹\n\nhttps://stackoverflow.com/questions/67720198/how-to-upgrade-libstdc-so-on-colab-runtime\n\nColabçš„ç¡®ç¯å¢ƒæ­å»ºä¸ç»Ÿä¸€ï¼Œä¼šç»™å¤§å®¶é€ æˆç‚¹å›°æ‰°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1684723299,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ–°åŠ å¡","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":374878,"user_name":"Geek_93970d","can_delete":false,"product_type":"c1","uid":1452167,"ip_address":"åŒ—äº¬","ucode":"52AC308BEC7737","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJcwXucibksEYRSYg6icjibzGa7efcMrCsGec2UwibjTd57icqDz0zzkEEOM2pXVju60dibzcnQKPfRkN9g/132","comment_is_top":false,"comment_ctime":1684556519,"is_pvip":false,"replies":[{"id":136791,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1684720609,"ip_address":"æ–°åŠ å¡","comment_id":374878,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100541001,"comment_content":"import pandas as pd\nimport numpy as np\n\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import classification_report, accuracy_score\n# æ¢æˆæ­£ç¡®çš„è·¯å¾„\ndf_all = pd.read_csv(&quot;..&#47;data&#47;fine_food_reviews_with_embeddings_1k.csv&quot;)\ndf_all[&quot;embedding&quot;] = df_all.embedding.apply(eval).apply(np.array)\n\n# å…¶å®æ²¡å¿…è¦è½¬æ¢æˆ parquet\ndf_all.to_parquet(&quot;fine_food_reviews_with_embeddings.parquet&quot;, index=True)\ntraining_data = pd.read_parquet(&quot;fine_food_reviews_with_embeddings.parquet&quot;)\ntraining_data.head()\n\n#df =  training_data.sample(50000, random_state=42)\n#df = df_all\ndf = training_data\n\nX_train, X_test, y_train, y_test = train_test_split(\n    list(df.embedding.values), df.Score, test_size=0.2, random_state=42\n)\n\nclf = RandomForestClassifier(n_estimators=300)\nclf.fit(X_train, y_train)\npreds = clf.predict(X_test)\nprobas = clf.predict_proba(X_test)\n\nreport = classification_report(y_test, preds)\nprint(report)\n\n------------ç»“æœå¦‚ä¸‹-----------\n              precision    recall  f1-score   support\n\n           1       0.89      0.40      0.55        20\n           2       1.00      0.38      0.55         8\n           3       1.00      0.18      0.31        11\n           4       1.00      0.26      0.41        27\n           5       0.75      1.00      0.86       134\n\n    accuracy                           0.77       200\n   macro avg       0.93      0.44      0.53       200\nweighted avg       0.82      0.77      0.72       200","like_count":0,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":618923,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1684720609,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ–°åŠ å¡","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":374862,"user_name":"Geek_93970d","can_delete":false,"product_type":"c1","uid":1452167,"ip_address":"åŒ—äº¬","ucode":"52AC308BEC7737","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJcwXucibksEYRSYg6icjibzGa7efcMrCsGec2UwibjTd57icqDz0zzkEEOM2pXVju60dibzcnQKPfRkN9g/132","comment_is_top":false,"comment_ctime":1684503041,"is_pvip":false,"replies":[{"id":136787,"content":"https:&#47;&#47;github.com&#47;xuwenhao&#47;geektime-ai-course å»READMEé‡Œé¢æ‰¾ä¸€ä¸‹ç™¾åº¦ç½‘ç›˜ï¼Œä¸‹è½½å¯¹åº”æ•°æ®æ–‡ä»¶\n\né“¾æ¥: https:&#47;&#47;pan.baidu.com&#47;s&#47;1Cl0eFNLOkQqquf9ls0trEw æå–ç : jvr4","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1684720396,"ip_address":"æ–°åŠ å¡","comment_id":374862,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100541001,"comment_content":"data&#47;toutiao_cat_data_all_with_embeddings.parquet\nè¿™ä¸ªæ–‡ä»¶æ‰¾ä¸åˆ°","like_count":0,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":618919,"discussion_content":"https://github.com/xuwenhao/geektime-ai-course å»READMEé‡Œé¢æ‰¾ä¸€ä¸‹ç™¾åº¦ç½‘ç›˜ï¼Œä¸‹è½½å¯¹åº”æ•°æ®æ–‡ä»¶\n\né“¾æ¥: https://pan.baidu.com/s/1Cl0eFNLOkQqquf9ls0trEw æå–ç : jvr4","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1684720396,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ–°åŠ å¡","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":374688,"user_name":"åœ°å¹³çº¿","can_delete":false,"product_type":"c1","uid":1482026,"ip_address":"ä¸Šæµ·","ucode":"F50717D6244867","user_header":"https://static001.geekbang.org/account/avatar/00/16/9d/2a/3e57b54a.jpg","comment_is_top":false,"comment_ctime":1684313272,"is_pvip":false,"replies":[{"id":136802,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1684723807,"ip_address":"æ–°åŠ å¡","comment_id":374688,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100541001,"comment_content":"è®­ç»ƒä¸€ä¸ªèƒ½æŠŠä» 1 åˆ†åˆ° 5 åˆ†çš„æ¯ä¸€ä¸ªçº§åˆ«éƒ½åŒºåˆ†å‡ºæ¥çš„æœºå™¨å­¦ä¹ æ¨¡å‹.\nä½¿ç”¨è€å¸ˆçš„æ•°æ® fine_food_reviews_with_embeddings_1k.csv\n\néšæœºæ£®æ—æ¨¡å‹ï¼Œå‚æ•° n_estimators=300ä¸‹è·‘çš„ç»“æœ\n\n              precision    recall  f1-score   support\n\n           1       1.00      0.30      0.46        20\n           2       1.00      0.38      0.55         8\n           3       1.00      0.18      0.31        11\n           4       1.00      0.26      0.41        27\n           5       0.74      1.00      0.85       134\n\n    accuracy                           0.76       200\n   macro avg       0.95      0.42      0.51       200\nweighted avg       0.82      0.76      0.71       200","like_count":0,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":618942,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1684723808,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ–°åŠ å¡","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":373936,"user_name":"Geek_44df74","can_delete":false,"product_type":"c1","uid":3565051,"ip_address":"ä¸Šæµ·","ucode":"CD6D47CE1A0BBB","user_header":"","comment_is_top":false,"comment_ctime":1683362061,"is_pvip":false,"replies":[{"id":136869,"content":"é€šè¿‡ä»£ç é‡Œé¢çš„predictå‡½æ•°é¢„æµ‹å°±å¥½äº†å‘€ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1684753118,"ip_address":"ä¸Šæµ·","comment_id":373936,"utype":1}],"discussion_count":2,"race_medal":0,"score":4,"product_id":100541001,"comment_content":"è€å¸ˆï¼Œæœ‰ä¸ªé—®é¢˜ï¼Œä¸Šé¢åªæ˜¯ç”¨ä¸€äº›ç®—æ³•æ ¡éªŒäº†å‡†ç¡®å’Œå¬å›ç‡ï¼Œå‡ä½¿ç°åœ¨å‡†ç¡®å’Œå¬å›ç‡ç¬¦åˆä¸šåŠ¡ç›®æ ‡äº†ï¼Œå…·ä½“è¦å¦‚ä½•åº”ç”¨å•Šï¼ŒåŸºäºä¸Šé¢çš„æ–‡ç« åˆ†ç±»çš„ä¾‹å­ï¼Œç»™ä¸€ä¸ªæ ‡é¢˜çš„embeddingå¦‚ä½•è¿”å›å…·ä½“çš„åˆ†ç±»ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":619058,"discussion_content":"é€šè¿‡ä»£ç é‡Œé¢çš„predictå‡½æ•°é¢„æµ‹å°±å¥½äº†å‘€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1684753118,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1222233,"avatar":"https://static001.geekbang.org/account/avatar/00/12/a6/59/1689ea0c.jpg","nickname":"é‡‘hb.Ryan å†·ç©ºæ°£é§•åˆ°","note":"","ucode":"CAD363576696E4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":618671,"discussion_content":"ä¸šåŠ¡åœºæ™¯é©±åŠ¨ï¼Œå¦åˆ™å°±æ˜¯ä¼ªéœ€æ±‚ğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1684418592,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":373682,"user_name":"R9Go","can_delete":false,"product_type":"c1","uid":1070171,"ip_address":"éŸ©å›½","ucode":"D15816C721FB80","user_header":"https://static001.geekbang.org/account/avatar/00/10/54/5b/fe7ebc2e.jpg","comment_is_top":false,"comment_ctime":1683010920,"is_pvip":false,"replies":[{"id":136450,"content":"çœ‹ä¸€ä¸‹æ˜¯å¦æœ‰å“ªè¡Œå‰é¢çš„ä»£ç æ²¡æœ‰æ‰§è¡Œï¼Œæ•´ä¸ªNotebookå¯ä»¥åœ¨\nhttps:&#47;&#47;github.com&#47;xuwenhao&#47;geektime-ai-course\næ‰¾åˆ°","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1683082723,"ip_address":"ä¸Šæµ·","comment_id":373682,"utype":1}],"discussion_count":2,"race_medal":0,"score":4,"product_id":100541001,"comment_content":"&#39;DataFrame&#39; object has no attribute &#39;category&#39;","like_count":0,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":616672,"discussion_content":"çœ‹ä¸€ä¸‹æ˜¯å¦æœ‰å“ªè¡Œå‰é¢çš„ä»£ç æ²¡æœ‰æ‰§è¡Œï¼Œæ•´ä¸ªNotebookå¯ä»¥åœ¨\nhttps://github.com/xuwenhao/geektime-ai-course\næ‰¾åˆ°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1683082723,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1452167,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJcwXucibksEYRSYg6icjibzGa7efcMrCsGec2UwibjTd57icqDz0zzkEEOM2pXVju60dibzcnQKPfRkN9g/132","nickname":"Geek_93970d","note":"","ucode":"52AC308BEC7737","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":618805,"discussion_content":"æŒ‡çš„æ˜¯æ€è€ƒé¢˜å—ï¼Ÿæ”¹æˆ Score è¯•è¯•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1684567402,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":373369,"user_name":"Adoph","can_delete":false,"product_type":"c1","uid":1400489,"ip_address":"å››å·","ucode":"DE85FA2638BAE4","user_header":"https://static001.geekbang.org/account/avatar/00/15/5e/a9/cc943f81.jpg","comment_is_top":false,"comment_ctime":1682430314,"is_pvip":false,"replies":[{"id":136480,"content":"https:&#47;&#47;github.com&#47;aceimnorstuvwxz&#47;toutiao-text-classfication-dataset\n\næˆ–è€…\né“¾æ¥: https:&#47;&#47;pan.baidu.com&#47;s&#47;1Cl0eFNLOkQqquf9ls0trEw æå–ç : jvr4","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1683086311,"ip_address":"ä¸Šæµ·","comment_id":373369,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100541001,"comment_content":"data&#47;toutiao_cat_data.txt è¿™ä¸ªæ–‡ä»¶åœ¨å“ªé‡Œå‘¢","like_count":0,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":616716,"discussion_content":"https://github.com/aceimnorstuvwxz/toutiao-text-classfication-dataset\n\næˆ–è€…\né“¾æ¥: https://pan.baidu.com/s/1Cl0eFNLOkQqquf9ls0trEw æå–ç : jvr4","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1683086311,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371895,"user_name":"Rukit","can_delete":false,"product_type":"c1","uid":2199570,"ip_address":"å¹¿ä¸œ","ucode":"03C30EB7F7415B","user_header":"https://static001.geekbang.org/account/avatar/00/21/90/12/29148117.jpg","comment_is_top":false,"comment_ctime":1680499549,"is_pvip":false,"replies":[{"id":135710,"content":"ä¸é€šè¿‡backoffï¼Œæ˜¯å¦èƒ½å¤Ÿæ‰§è¡ŒæˆåŠŸï¼Ÿçœ‹ä¸Šå»åƒæ˜¯ç½‘ç»œé—®é¢˜å¯¼è‡´çš„è¶…æ—¶ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1680581095,"ip_address":"ä¸Šæµ·","comment_id":371895,"utype":1}],"discussion_count":4,"race_medal":0,"score":4,"product_id":100541001,"comment_content":"è¿è¡Œbatch_embeddings = get_embeddings_with_backoff(prompts=batch, engine=embedding_model)è¿™å¥ä»£ç ä¸€ç›´æ˜¾ç¤ºè¿™ä¸ªé”™è¯¯RetryError[&lt;Future at 0x1e3a1819900 state=finished raised Timeout&gt;]\n","like_count":0,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612209,"discussion_content":"ä¸é€šè¿‡backoffï¼Œæ˜¯å¦èƒ½å¤Ÿæ‰§è¡ŒæˆåŠŸï¼Ÿçœ‹ä¸Šå»åƒæ˜¯ç½‘ç»œé—®é¢˜å¯¼è‡´çš„è¶…æ—¶ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680581095,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2199570,"avatar":"https://static001.geekbang.org/account/avatar/00/21/90/12/29148117.jpg","nickname":"Rukit","note":"","ucode":"03C30EB7F7415B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":614427,"discussion_content":"ä¸è¡Œè¿˜æ˜¯æŠ¥åŒæ ·çš„é”™è¯¯ï¼ŒInvalidRequestError ï¼Œè¯´æ˜¯è¯·æ±‚æ— æ•ˆé€ æˆçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1681788338,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":612209,"ip_address":"å¹¿ä¸œ","group_id":0},"score":614427,"extra":""}]},{"author":{"id":3017168,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/09/d0/8609bddc.jpg","nickname":"æˆ’è´ªå—”ç—´","note":"","ucode":"D53EA3525DBD71","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612122,"discussion_content":"ç½‘ç»œé—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680521859,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2199570,"avatar":"https://static001.geekbang.org/account/avatar/00/21/90/12/29148117.jpg","nickname":"Rukit","note":"","ucode":"03C30EB7F7415B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":3017168,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/09/d0/8609bddc.jpg","nickname":"æˆ’è´ªå—”ç—´","note":"","ucode":"D53EA3525DBD71","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":614428,"discussion_content":"æˆ‘ç”¨äº†æ¢¯å­ï¼Œé€‰æ‹©ç¾å›½èŠ‚ç‚¹ï¼Œè¿˜æ˜¯ä¸è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1681788363,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":612122,"ip_address":"å¹¿ä¸œ","group_id":0},"score":614428,"extra":""}]}]},{"had_liked":false,"id":371875,"user_name":"lala","can_delete":false,"product_type":"c1","uid":3582410,"ip_address":"åŒ—äº¬","ucode":"D6B9DD7A6E899F","user_header":"https://static001.geekbang.org/account/avatar/00/36/a9/ca/f216bece.jpg","comment_is_top":false,"comment_ctime":1680483638,"is_pvip":false,"replies":[{"id":135751,"content":"å¾€åçœ‹åˆ° 11 å’Œ 14-17 è®²","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1680586344,"ip_address":"ä¸Šæµ·","comment_id":371875,"utype":1}],"discussion_count":2,"race_medal":0,"score":4,"product_id":100541001,"comment_content":"è¯·é—®æˆ‘æƒ³åˆ©ç”¨chatGPTæ¥ç»“åˆå…¬å¸çš„è‡ªå·±ä¸šåŠ¡ï¼Œæ‰“é€ å…¬å¸è‡ªå·±çš„æœºå™¨äººï¼Œå›ç­”å¤–éƒ¨å®¢æˆ·é—®é¢˜å’Œå†…éƒ¨åŒäº‹é—®é¢˜ã€‚æ¯”å¦‚æ ¹æ®ç”¨æˆ·é—®é¢˜ï¼Œç›´æ¥æ¨èå¯¹åº”äº§å“ï¼Œ","like_count":0,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612257,"discussion_content":"å¾€åçœ‹åˆ° 11 å’Œ 14-17 è®²","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680586344,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2161554,"avatar":"https://static001.geekbang.org/account/avatar/00/20/fb/92/0537ea08.jpg","nickname":"æ¼«æ¸¸è€…","note":"","ucode":"23DD0146F43C7D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":617157,"discussion_content":"è´¦å·è¢«å°ä¸¤ä¸ªäº†ï¼Œæ‰€ä»¥è¦åšäº§å“çš„è¯ï¼Œè¿˜æ˜¯å¾—ç¡®ä¿è´¦å·å¾—å®‰å…¨æ€§ï¼Œä¸ç„¶ä¸‰å¤©ä¸¤å¤´ç”¨ä¸äº†å°±éº»çƒ¦äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1683355159,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371856,"user_name":"ç–¯ç‹‚çš„å¤§çŸ³æ¦´","can_delete":false,"product_type":"c1","uid":3582370,"ip_address":"ä¸­å›½å°æ¹¾","ucode":"3D6D582CD65C0E","user_header":"https://static001.geekbang.org/account/avatar/00/36/a9/a2/3b44d3ca.jpg","comment_is_top":false,"comment_ctime":1680431395,"is_pvip":false,"replies":[{"id":135713,"content":"è¿™ä¸ªæ–‡ä»¶å¤ªå¤§äº†ï¼Œçœ‹ https:&#47;&#47;github.com&#47;xuwenhao&#47;geektime-ai-course Readmeé‡Œé¢å†™äº†å¦‚ä½•é€šè¿‡ç™¾åº¦ç½‘ç›˜è·å–ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1680581415,"ip_address":"ä¸Šæµ·","comment_id":371856,"utype":1}],"discussion_count":2,"race_medal":0,"score":4,"product_id":100541001,"comment_content":"è¯·é—®å¤„ç†ä¹‹åçš„æ•°æ®githubé“¾æ¥æ˜¯æ­£å¸¸çš„ä¹ˆï¼Œæˆ‘ç‚¹è¿›å»æ˜¾ç¤º404å‘¢ï¼ˆtoutiao_cat_data_all_with_embeddings.parquetè¿™ä¸ªæ–‡ä»¶æ²¡åŠæ³•è·å–ï¼‰","like_count":0,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612212,"discussion_content":"è¿™ä¸ªæ–‡ä»¶å¤ªå¤§äº†ï¼Œçœ‹ https://github.com/xuwenhao/geektime-ai-course Readmeé‡Œé¢å†™äº†å¦‚ä½•é€šè¿‡ç™¾åº¦ç½‘ç›˜è·å–ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680581415,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3579410,"avatar":"https://static001.geekbang.org/account/avatar/00/36/9e/12/969cce3b.jpg","nickname":"æ²¡äº‹æºœè¾¾","note":"","ucode":"367F2C51B40EF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612158,"discussion_content":"è¿™ä¸ªæ˜¯è€å¸ˆå‘çš„ç½‘ç›˜é“¾æ¥: Â https://pan.baidu.com/s/1Cl0eFNLOkQqquf9ls0trEwÂ æå–ç :Â jvr4","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680535639,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371799,"user_name":"yanyu-xin","can_delete":false,"product_type":"c1","uid":1899757,"ip_address":"å¹¿ä¸œ","ucode":"3AA389F9E4C236","user_header":"","comment_is_top":false,"comment_ctime":1680341662,"is_pvip":false,"replies":[{"id":135727,"content":" çœ‹ https:&#47;&#47;github.com&#47;xuwenhao&#47;geektime-ai-course é‡Œçš„READMEé‡Œçš„ç™¾åº¦ç½‘ç›˜è¯´æ˜\n\næˆ‘è¯·ç¼–è¾‘å¸®å¿™ä¿®æ­£ä¸€ä¸‹","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1680582282,"ip_address":"ä¸Šæµ·","comment_id":371799,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100541001,"comment_content":"æ ‡é¢˜â€è®­ç»ƒæ¨¡å‹ï¼Œçœ‹çœ‹æ•ˆæœæ€ä¹ˆæ ·â€œä¸‹çš„ GitHub é“¾æ¥æ˜¯404é”™è¯¯","like_count":0,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612226,"discussion_content":" çœ‹ https://github.com/xuwenhao/geektime-ai-course é‡Œçš„READMEé‡Œçš„ç™¾åº¦ç½‘ç›˜è¯´æ˜\n\næˆ‘è¯·ç¼–è¾‘å¸®å¿™ä¿®æ­£ä¸€ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680582282,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371773,"user_name":"John","can_delete":false,"product_type":"c1","uid":1020861,"ip_address":"åŠ æ‹¿å¤§","ucode":"E4ADF8488953FB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/93/bd/f3977ebb.jpg","comment_is_top":false,"comment_ctime":1680311646,"is_pvip":false,"replies":[{"id":135734,"content":"ä¸è®¾å¸‚æ¨¡å‹å‚æ•°ï¼Œæ¨¡å¼ä½¿ç”¨çš„æ˜¯ text-similarity-davinci-001\nä¸€èˆ¬æ¨èä½¿ç”¨ text-embedding-ada-002\n\nllama-index é»˜è®¤embeddingå’Œqueryä½¿ç”¨çš„modelæ˜¯å¯ä»¥æŒ‡å®šçš„","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1680583186,"ip_address":"ä¸Šæµ·","comment_id":371773,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100541001,"comment_content":"æƒ³é—®ä¸ªé—®é¢˜ OpenAI embeddingçš„æ—¶å€™ æ˜¯ä¸æ˜¯è·ŸChatGPTçš„modelæ²¡æœ‰å…³ç³» é»˜è®¤åªä¼šç”¨embeddingçš„ada002? æœ€è¿‘çœ‹llama indexæœ‰ç‚¹å›°æƒ‘ ä¸çŸ¥é“ä»–çš„APIä¸ºä»€ä¹ˆåœ¨æ„å»ºembeddingçš„service contextä¹‹å‰å…ˆç¡®å®šmodelæ˜¯3æˆ–è€…4","like_count":0,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612234,"discussion_content":"ä¸è®¾å¸‚æ¨¡å‹å‚æ•°ï¼Œæ¨¡å¼ä½¿ç”¨çš„æ˜¯ text-similarity-davinci-001\nä¸€èˆ¬æ¨èä½¿ç”¨ text-embedding-ada-002\n\nllama-index é»˜è®¤embeddingå’Œqueryä½¿ç”¨çš„modelæ˜¯å¯ä»¥æŒ‡å®šçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680583186,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371651,"user_name":"æ— å½¢","can_delete":false,"product_type":"c1","uid":1016889,"ip_address":"åŒ—äº¬","ucode":"B740E2A68A17A5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/84/39/c8772466.jpg","comment_is_top":false,"comment_ctime":1680149682,"is_pvip":true,"replies":[{"id":135757,"content":"å½“ç„¶ä¸æ˜¯ï¼Œå¯ä»¥ç”¨åœ¨ä¸€èµ·éœ€è¦ä½¿ç”¨å‘é‡çš„åœºæ™¯ï¼Œæ¯”å¦‚èšç±»ä¹Ÿå¯ä»¥å•Šï¼Œåé¢åšæ›´å¤æ‚çš„æ·±åº¦å­¦ä¹ ä¹Ÿå¯ä»¥å•Šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1680586643,"ip_address":"ä¸Šæµ·","comment_id":371651,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100541001,"comment_content":"embeddingåªèƒ½è§£å†³åˆ†ç±»é—®é¢˜å—","like_count":0,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612263,"discussion_content":"å½“ç„¶ä¸æ˜¯ï¼Œå¯ä»¥ç”¨åœ¨ä¸€èµ·éœ€è¦ä½¿ç”¨å‘é‡çš„åœºæ™¯ï¼Œæ¯”å¦‚èšç±»ä¹Ÿå¯ä»¥å•Šï¼Œåé¢åšæ›´å¤æ‚çš„æ·±åº¦å­¦ä¹ ä¹Ÿå¯ä»¥å•Šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680586643,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371711,"user_name":"Oliå¼ å¸†","can_delete":false,"product_type":"c1","uid":1338098,"ip_address":"æ–°åŠ å¡","ucode":"6E60A370C3C14A","user_header":"https://static001.geekbang.org/account/avatar/00/14/6a/f2/db90fa96.jpg","comment_is_top":false,"comment_ctime":1680226424,"is_pvip":false,"replies":null,"discussion_count":3,"race_medal":0,"score":4,"product_id":100541001,"comment_content":"æˆ‘å¯¹embeddingçš„ä¸€äº›ç†è§£ï¼Œå°±æ˜¯åœ¨ä¸ç”¨æˆ·äº¤äº’æ—¶ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ åœ¨ä¸æ¶ˆè€—tokençš„æƒ…å†µä¸‹ï¼ŒæŠŠä½ å½“å‰éœ€è¦çš„æœ€ç›¸å…³çš„contextä¿¡æ¯ä»ä½ çš„çŸ¥è¯†åº“æå–å‡ºæ¥ã€‚æˆ‘ä¸ªäººè§‰å¾—è¿™ä¸ªæ˜¯ç›®å‰ï¼ŒæŠŠè‡ªå·±çš„ä¸“æœ‰çŸ¥è¯†åº“å’Œäººå·¥æ™ºèƒ½ç»“åˆèµ·æ¥çš„æœ€é«˜æ•ˆæ€§ä»·æ¯”æœ€é«˜çš„ä¸€ä¸ªåŠæ³•ã€‚ä¸çŸ¥é“æˆ‘è¿™ä¸ªçœ‹æ³•æœ‰æ²¡æœ‰æœ‰ä¸€å®šé“ç†ï¼Œè¯·è€å¸ˆå’Œå¤§å®¶æ¥æŒ‡æ­£ã€‚","like_count":1,"discussions":[{"author":{"id":3023902,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/24/1e/7a10b411.jpg","nickname":"å·§å…‹åŠ›å¼ å¼ åŒ…","note":"","ucode":"AECA996C607648","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":617511,"discussion_content":"ä¹Ÿæ¶ˆè€—tokenå§ï¼Œä½ çš„ç”¨æˆ·é—®é¢˜ä¹Ÿéœ€è¦embeddingæ‰èƒ½å»æœç´¢çŸ¥è¯†åº“é‡Œç›¸å…³context","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1683625503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3588303,"avatar":"","nickname":"Geek_512735","note":"","ucode":"D45BF63D413316","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":614090,"discussion_content":"è¯·é—®ä¸€ä¸‹è¿™ç§æ–¹æ³•æœ‰ä»€ä¹ˆä¼˜åŠ¿å‘¢ï¼Ÿæ¯”å¦‚æ¯”å…¶ä»–æ–¹æ³•embeddingæ•ˆæœæ›´å¥½ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1681693283,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2311670,"avatar":"https://static001.geekbang.org/account/avatar/00/23/45/f6/09aa6e38.jpg","nickname":"Even","note":"","ucode":"A9CDFB3621B603","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612007,"discussion_content":"embeddingä¸»è¦æ˜¯å°†ä½ è¾“å…¥çš„ä¸€äº›å­—ç¬¦ä¸²è½¬æ¢ä¸ºæµ®ç‚¹æ•°å‘é‡ï¼Œç”¨äºå„ç±»æ¨¡å‹è®¡ç®—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680486239,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":394033,"user_name":"Mamba","can_delete":false,"product_type":"c1","uid":1475049,"ip_address":"æ¹–åŒ—","ucode":"8B3EC90736B8EB","user_header":"https://static001.geekbang.org/account/avatar/00/16/81/e9/d131dd81.jpg","comment_is_top":false,"comment_ctime":1725593927,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100541001,"comment_content":"åœ¨ç¾é£Ÿè¯„è®ºçš„å®Œæ•´çš„æ•°æ®é›†ä¸Šï¼Œä¸€å…±299276æ¡ï¼Œä½¿ç”¨text-embedding-3-smallæ¨¡å‹ï¼ŒèŠ±äº†0.66ç¾åˆ€ï¼Œå¾—åˆ°æ‰€æœ‰çš„è¯„è®ºçš„embeddingï¼Œç„¶åäºŒå…«åˆ†æµ‹è¯•è®­ç»ƒé›†ï¼Œè®­ç»ƒä¸€ä¸ªèƒ½æŠŠä» 1 åˆ†åˆ° 5 åˆ†çš„æ¯ä¸€ä¸ªçº§åˆ«éƒ½åŒºåˆ†å‡ºæ¥çš„éšæœºæ£®æ—æ¨¡å‹ï¼Œå‚æ•°n_estimators=500ï¼Œå¾—åˆ°äº”åˆ†ç±»æ•ˆæœï¼š\n              precision    recall  f1-score   support\n\n           1       0.74      0.84      0.79      5577\n           2       0.94      0.35      0.51      3107\n           3       0.81      0.44      0.57      4622\n           4       0.94      0.33      0.49      8633\n           5       0.81      1.00      0.89     37917\n\n    accuracy                           0.81     59856\n   macro avg       0.85      0.59      0.65     59856\nweighted avg       0.83      0.81      0.78     59856","like_count":0},{"had_liked":false,"id":391660,"user_name":"Geek_d54869","can_delete":false,"product_type":"c1","uid":1953765,"ip_address":"åŒ—äº¬","ucode":"CF55462EF65B9E","user_header":"","comment_is_top":false,"comment_ctime":1718770664,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100541001,"comment_content":"æœ‰ä¸€ä¸ªå°å°çš„ç–‘é—®ï¼Œä½¿ç”¨embendingçš„ç»“æœä¹Ÿå¹¶æ²¡æœ‰æ¯”ä¼ ç»ŸMLé«˜å¤šå°‘ï¼Œä»…ä»…1%ï¼Œå®é™…é¡¹ç›®ä¸­æ˜¯ä¸æ˜¯ç›´æ¥ç”¨MLçš„åˆ†ç±»ç®—æ³•äº†ï¼Ÿ","like_count":0},{"had_liked":false,"id":391622,"user_name":"cocozhang","can_delete":false,"product_type":"c1","uid":3582519,"ip_address":"ç¾å›½","ucode":"0157318A652E63","user_header":"https://static001.geekbang.org/account/avatar/00/36/aa/37/7f1b3fbc.jpg","comment_is_top":false,"comment_ctime":1718684049,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100541001,"comment_content":"def get_embeddings_with_backoff(prompts, engine): \n    for i in range(0, len(prompts), batch_size): \n        batch = prompts[i:i+batch_size] \n        embeddings += get_embeddings(list_of_text=batch, engine=engine) \n    return embeddings\n\nprompts = df_all.combined.tolist()\nprompt_batches = [prompts[i:i+batch_size] for i in range(0, len(prompts), batch_size)]\n\nfor batch in prompt_batches: \n    batch_embeddings = get_embeddings_with_backoff(prompts=batch, engine=embedding_model) \n    embeddings += batch_embeddings\n\nè€å¸ˆæ‚¨å¥½ï¼Œæˆ‘å¯¹è¿™æ®µä»£ç æœ‰ç‚¹ç–‘æƒ‘ï¼Œæƒ³è¯·æ•™ä¸€ä¸‹ã€‚æˆ‘çœ‹å‡½æ•°å†…å¤–å‡éå†äº†ä¸€éæ‰€æœ‰çš„batchï¼ŒæŒ‰è¯´å‡½æ•°çš„å…¥å‚å°±å·²ç»æ˜¯å…¶ä¸­ä¹‹ä¸€çš„batchäº†ï¼Œå‡½æ•°åº”è¯¥é’ˆå¯¹è¿™ä¸ªbatchç›´æ¥è·å–embedingå°±å¯ä»¥äº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å†éå†ä¸€éæ¯ä¸ªbatchå‘¢ï¼Ÿæ˜¯ä¸æ˜¯é‡å¤äº†å‘€ï¼Ÿ","like_count":0},{"had_liked":false,"id":391075,"user_name":"xin","can_delete":false,"product_type":"c1","uid":1609258,"ip_address":"å››å·","ucode":"B311A30BFE66E0","user_header":"https://static001.geekbang.org/account/avatar/00/18/8e/2a/448b2177.jpg","comment_is_top":false,"comment_ctime":1717233479,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100541001,"comment_content":"1åˆ°5åˆ†çš„æƒ…æ„Ÿåˆ†ç±»ç»“æœï¼Œä½¿ç”¨éšæœºæ£®æ—\n              precision    recall  f1-score   support\n\n           1       1.00      0.40      0.57        20\n           2       1.00      0.38      0.55         8\n           3       1.00      0.18      0.31        11\n           4       1.00      0.26      0.41        27\n           5       0.74      1.00      0.85       134\n\n    accuracy                           0.77       200\n   macro avg       0.95      0.44      0.54       200\nweighted avg       0.83      0.77      0.72       200","like_count":0},{"had_liked":false,"id":389327,"user_name":"ææ™“ç³_Xiaolin","can_delete":false,"product_type":"c1","uid":1498441,"ip_address":"åŒ—äº¬","ucode":"11D2FA6CF9F07F","user_header":"https://static001.geekbang.org/account/avatar/00/16/dd/49/eda13d48.jpg","comment_is_top":false,"comment_ctime":1712127040,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100541001,"comment_content":"ä¸€å…±å°±äº”å—çš„é¢åº¦ï¼Œåä¸‡æ¡æ•°æ®æ˜¯0.5ï¼Œ ä¸‰åä¸‡æ¡æ•°æ®å°±å¾—15","like_count":0},{"had_liked":false,"id":389267,"user_name":"ææ™“ç³_Xiaolin","can_delete":false,"product_type":"c1","uid":1498441,"ip_address":"åŒ—äº¬","ucode":"11D2FA6CF9F07F","user_header":"https://static001.geekbang.org/account/avatar/00/16/dd/49/eda13d48.jpg","comment_is_top":false,"comment_ctime":1711985747,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100541001,"comment_content":"getembeddings å·²ç»ä¸åœ¨embedding_utils é‡Œé¢äº†","like_count":0},{"had_liked":false,"id":381171,"user_name":"å’–å–±æ£’","can_delete":false,"product_type":"c1","uid":3675984,"ip_address":"æ–°ç–†","ucode":"E20EFBE019D964","user_header":"https://static001.geekbang.org/account/avatar/00/38/17/50/500c8dd4.jpg","comment_is_top":false,"comment_ctime":1694751113,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100541001,"comment_content":"è€å¸ˆï¼Œhttps:&#47;&#47;raw.githubusercontent.com&#47;aceimnorstuvwxz&#47;toutiao-text-classfication-dataset&#47;master&#47;toutiao_cat_data.txt.zipè¿™ä¸ªæ–‡ä»¶è²Œä¼¼å¤±æ•ˆäº†ï¼Œä¸‹è½½ä¸ä¸‹æ¥ï¼Œæç¤ºRead error (No such file or directory) in headers","like_count":0},{"had_liked":false,"id":380470,"user_name":"é£˜é›¨","can_delete":false,"product_type":"c1","uid":1177874,"ip_address":"æ±Ÿè‹","ucode":"30AB52C77B2B7B","user_header":"https://static001.geekbang.org/account/avatar/00/11/f9/12/6dcd08eb.jpg","comment_is_top":false,"comment_ctime":1693642087,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100541001,"comment_content":"from sklearn.ensemble import RandomForestClassifier\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import classification_report, accuracy_score\n\ntraining_data = pd.read_parquet(&quot;data&#47;toutiao_cat_data_all_with_embeddings.parquet&quot;)\ntraining_data.head()\n\ndf =  training_data.sample(50000, random_state=42)\n\nX_train, X_test, y_train, y_test = train_test_split(\n    list(df.embedding.values), df.category, test_size=0.2, random_state=42\n)\n\nclf = RandomForestClassifier(n_estimators=300)\nclf.fit(X_train, y_train)\npreds = clf.predict(X_test)\nprobas = clf.predict_proba(X_test)\n\nreport = classification_report(y_test, preds)\nprint(report)\n\nè€å¸ˆå¸®å¿™çœ‹ä¸‹ï¼Œåœ¨condaç¯å¢ƒä¸‹çš„notebookè¿è¡Œä¸Šè¿°ä»£ç æŠ¥å¦‚ä¸‹é”™è¯¯ï¼š\nImportError: Unable to find a usable engine; tried using: &#39;pyarrow&#39;, &#39;fastparquet&#39;.\nA suitable version of pyarrow or fastparquet is required for parquet support.\nTrying to import the above resulted in these errors:\n - Missing optional dependency &#39;pyarrow&#39;. pyarrow is required for parquet support. Use pip or conda to install pyarrow.\n - Missing optional dependency &#39;fastparquet&#39;. fastparquet is required for parquet support. Use pip or conda to install fastparquet.","like_count":0},{"had_liked":false,"id":379328,"user_name":"jeff","can_delete":false,"product_type":"c1","uid":1026894,"ip_address":"æ²³åŒ—","ucode":"68456DD035BDF4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ab/4e/82e9657c.jpg","comment_is_top":false,"comment_ctime":1691732508,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100541001,"comment_content":"toutiao_cat_data_all_with_embeddings æ•°æ®é›†ä¸å­˜åœ¨äº†ï¼Ÿï¼Ÿï¼Ÿ","like_count":0},{"had_liked":false,"id":375480,"user_name":"Geek_d7a1f9","can_delete":false,"product_type":"c1","uid":3632907,"ip_address":"åŒ—äº¬","ucode":"6F608EA3CADE57","user_header":"","comment_is_top":false,"comment_ctime":1685523960,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":5,"product_id":100541001,"comment_content":"è€å¸ˆï¼Œä¸ºä»€ä¹ˆ chatgpt çš„ embedding éœ€è¦é€šè¿‡ api è°ƒç”¨ï¼Œå¦‚æœæˆ‘ä»¬çŸ¥é“å…·ä½“ç®—æ³•ï¼Œå®ç°ä¸€ä¸ªåº“æœ¬åœ°è®¡ç®—ä¸æ˜¯æ›´å¥½å—","like_count":0,"discussions":[{"author":{"id":2161554,"avatar":"https://static001.geekbang.org/account/avatar/00/20/fb/92/0537ea08.jpg","nickname":"æ¼«æ¸¸è€…","note":"","ucode":"23DD0146F43C7D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":620455,"discussion_content":"æ•ˆæœï¼Œæ•ˆæœï¼Œè¿˜æ˜¯tmdæ•ˆæœ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1686191120,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":375043,"user_name":"çŸ³äº‘å‡","can_delete":false,"product_type":"c1","uid":1024195,"ip_address":"å¹¿ä¸œ","ucode":"78F1DD33EFD000","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a0/c3/c5db35df.jpg","comment_is_top":false,"comment_ctime":1684831329,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":1,"score":6,"product_id":100541001,"comment_content":"ç¢ç£¨äº†ä¸€ä¸‹æ‰ç†è§£å¬å›ç‡çš„æ„æ€ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘é¢„æµ‹äº†200ä¸ªé‚®ä»¶ï¼Œå…¶ä¸­80ä¸ªæˆ‘é¢„æµ‹ä¸ºåƒåœ¾é‚®ä»¶ï¼Œå…¶ä»–120ä¸ªä¸ºæ­£å¸¸é‚®ä»¶ã€‚ä½†å®é™…ä¸Šæˆ‘é¢„æµ‹çš„è¿™80ä¸ªé‡Œï¼Œæœ‰70ä¸ªæ˜¯çœŸçš„åƒåœ¾é‚®ä»¶ã€‚é‚£ä¹ˆé¢„æµ‹åƒåœ¾é‚®ä»¶å‡†ç¡®ç‡å°±æ˜¯70&#47;80ï¼Œå¦å¤–120ä¸ªæ­£å¸¸é‚®ä»¶é‡Œï¼Œè¿˜æœ‰10ä¸ªåƒåœ¾é‚®ä»¶ï¼Œé‚£ä¹ˆåƒåœ¾é‚®ä»¶çš„å¬å›ç‡å°±æ˜¯70&#47;80ï¼ˆæ€»çš„åƒåœ¾é‚®ä»¶æ•°é‡ï¼‰","like_count":0},{"had_liked":false,"id":372371,"user_name":"aoe","can_delete":false,"product_type":"c1","uid":1121758,"ip_address":"æµ™æ±Ÿ","ucode":"1C6201EDB4E954","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","comment_is_top":false,"comment_ctime":1681047496,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":6,"product_id":100541001,"comment_content":"åŸæ¥ API æœ‰è¿™ä¹ˆå¼ºå¤§çš„åŠŸèƒ½ï¼","like_count":0},{"had_liked":false,"id":372072,"user_name":"Viola","can_delete":false,"product_type":"c1","uid":3581980,"ip_address":"æ‘©å°”å¤šç“¦","ucode":"0F43DBBE822AB6","user_header":"https://static001.geekbang.org/account/avatar/00/36/a8/1c/d231cbfb.jpg","comment_is_top":false,"comment_ctime":1680683890,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":6,"product_id":100541001,"comment_content":"äº¤ä½œä¸šï¼Œè€å¸ˆè®²å¾—çœŸå¥½ï¼Œå¤§å¤§å¯å‘äº†æˆ‘\n---------------------------------\néšæœºæ£®æ—300æ£µæ ‘ï¼Œfine_food_reviews_with_embeddings_1k.csv\n      precision    recall  f1-score   support\n\n           1       1.00      0.35      0.52        20\n           2       1.00      0.38      0.55         8\n           3       1.00      0.18      0.31        11\n           4       1.00      0.26      0.41        27\n           5       0.74      1.00      0.85       134\n\n    accuracy                           0.77       200\n   macro avg       0.95      0.43      0.53       200\nweighted avg       0.83      0.77      0.72       200","like_count":0},{"had_liked":false,"id":371467,"user_name":"Ethan New","can_delete":false,"product_type":"c1","uid":2063962,"ip_address":"æµ™æ±Ÿ","ucode":"9CA2EF39E58030","user_header":"https://static001.geekbang.org/account/avatar/00/1f/7e/5a/da39f489.jpg","comment_is_top":false,"comment_ctime":1679975006,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":4,"score":6,"product_id":100541001,"comment_content":"å­¦ä¹ æ‰“å¡","like_count":0}]}