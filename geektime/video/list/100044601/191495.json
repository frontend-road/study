{"id":191495,"title":"14 | 自定义配置数据源：低成本实现定制化配置方案","content":"<p><strong>各位亲爱的学员：</strong><br>\n推荐大家阅读一下配置框架的源码，代码量虽然不多，但这里面有不少可以借鉴的设计方法和代码风格，另外其中有一个ChainedConfigurationProvider，是课程里没有提到的，可以思考一下这个提供程序的使用场景。<br>\n源码下载地址：<a href=\"https://github.com/dotnet/extensions\">https://github.com/dotnet/extensions</a></p><p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/NET-Core\">https://gitee.com/geektime-geekbang/NET-Core</a></p>","comments":[{"had_liked":false,"id":174150,"user_name":"Geek_6a7195","can_delete":false,"product_type":"c3","uid":1814357,"ip_address":"","ucode":"2A59B13632E1D3","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL5oVY5LLYQyUWibVibju7EVtj1X9TEldklAiagI5LPBFlKmBmeibwibGNKXWFYmfRFxFQNRHTAR2shFcg/132","comment_is_top":false,"comment_ctime":1580029671,"is_pvip":false,"replies":[{"id":67825,"content":"动态管理配置的做法不建议直接通过配置框架，而是提供服务来操作配置数据源，例如通过代码修改文件、或者调用远程API，更新分布式配置。\n这样的好处是配置的读取和变更处理行为都是一致，不会因为配置源的变更导致需要额外处理。","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1580268650,"ip_address":"","comment_id":174150,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"配置只能读？没有回写的方法？想通过服务回写配置怎么办","like_count":4,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482310,"discussion_content":"动态管理配置的做法不建议直接通过配置框架，而是提供服务来操作配置数据源，例如通过代码修改文件、或者调用远程API，更新分布式配置。\n这样的好处是配置的读取和变更处理行为都是一致，不会因为配置源的变更导致需要额外处理。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580268650,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1485489,"avatar":"https://static001.geekbang.org/account/avatar/00/16/aa/b1/c834aab5.jpg","nickname":"张小勋","note":"","ucode":"8C5E434EF53BF4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":162116,"discussion_content":"作者刚才回复的意思 应该是 这个设计配置框架的实现  具体的配置源的管理 另外单独处理 比如提供修改更新的api 或者直接修改远程的配置文件等等  如果比如刚才的项目中集成这个操作  如果哪天配置源修改了  可能还要去修改别的代码等。应该是这个意思。 关于你后来问题  如果你的配置源是文件  那就直接修改文件好 了 如果是别的数据源 比如存在数据库中等等 自己提供额外的api 去更新  这边应该只是做读取","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580960518,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1814357,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL5oVY5LLYQyUWibVibju7EVtj1X9TEldklAiagI5LPBFlKmBmeibwibGNKXWFYmfRFxFQNRHTAR2shFcg/132","nickname":"Geek_6a7195","note":"","ucode":"2A59B13632E1D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":155627,"discussion_content":"我说的就是专门提供服务来操作配置数据源，具体怎么做呢？和传统的文件读写一样么？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580270490,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":175900,"user_name":"高海东","can_delete":false,"product_type":"c3","uid":1808442,"ip_address":"","ucode":"60CEB1723FD13C","user_header":"https://static001.geekbang.org/account/avatar/00/1b/98/3a/41a9d4fd.jpg","comment_is_top":false,"comment_ctime":1580882036,"is_pvip":false,"replies":[{"id":68583,"content":"第二三部分会讲到","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1581148236,"ip_address":"","comment_id":175900,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"课程讲的深入些，我看大部分都是讲个基本概念，简单的例子，实际项目不会这么简单，就那配置来说吧，讲的只是键值，实际项目中除了键值还回去其他值 多个项目","like_count":2,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482946,"discussion_content":"第二三部分会讲到","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581148236,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":181898,"user_name":"学习者","can_delete":false,"product_type":"c3","uid":1880838,"ip_address":"","ucode":"7B176FAE22C9E6","user_header":"https://static001.geekbang.org/account/avatar/00/1c/b3/06/ab52e221.jpg","comment_is_top":false,"comment_ctime":1582675444,"is_pvip":false,"replies":[{"id":70459,"content":"表示加载配置，且不触发ReLoad事件，这个方法是框架初次加载时调用的。","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1582691180,"ip_address":"","comment_id":181898,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"你好：请问段代码作用是什么？\npublic override void Load()\n        {\n            &#47;&#47;加载数据\n            Load(false);\n        }","like_count":1,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485160,"discussion_content":"表示加载配置，且不触发ReLoad事件，这个方法是框架初次加载时调用的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582691180,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":199965,"user_name":"智鑫","can_delete":false,"product_type":"c3","uid":1684436,"ip_address":"","ucode":"D51AF9ABA5CB9B","user_header":"https://static001.geekbang.org/account/avatar/00/19/b3/d4/cbbdfb9a.jpg","comment_is_top":false,"comment_ctime":1585524860,"is_pvip":false,"replies":[{"id":77155,"content":"定时器是一个模拟，你可以检测自己的文件、数据库变更等等你的配置源变更的事件","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1586875423,"ip_address":"","comment_id":199965,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"老师，问下如果自定义获取源，配置的变更必须定时器主动监测吗","like_count":0,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489907,"discussion_content":"定时器是一个模拟，你可以检测自己的文件、数据库变更等等你的配置源变更的事件","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586875423,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":185607,"user_name":"zc","can_delete":false,"product_type":"c3","uid":1010778,"ip_address":"","ucode":"E81CDA10FAC79D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6c/5a/6b81f65d.jpg","comment_is_top":false,"comment_ctime":1583644479,"is_pvip":false,"replies":[{"id":72470,"content":"实际上一般组件使用选项框架的方式强类型注入。","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1584243805,"ip_address":"","comment_id":185607,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"自己扩展获取到的配置文件数据，和通过configuraton读取到的配置应该作用，但是感觉扩展方式读配置麻烦许多","like_count":0,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486436,"discussion_content":"实际上一般组件使用选项框架的方式强类型注入。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584243805,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":175937,"user_name":"川杰","can_delete":false,"product_type":"c3","uid":1099750,"ip_address":"","ucode":"815211E1D698E6","user_header":"https://static001.geekbang.org/account/avatar/00/10/c7/e6/11f21cb4.jpg","comment_is_top":false,"comment_ctime":1580888365,"is_pvip":false,"replies":[{"id":68379,"content":"Options组件可以实现这个能力，后面章节有","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1580891513,"ip_address":"","comment_id":175937,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"请问，这里的数据保存是用Data[&quot;time&quot;]的方式，我可不可以在里面建一个 类，把数据绑定到类里，然后再供外界读取？","like_count":0,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482962,"discussion_content":"Options组件可以实现这个能力，后面章节有","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580891513,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":175551,"user_name":"zy","can_delete":false,"product_type":"c3","uid":1817487,"ip_address":"","ucode":"54C318B06B8D3A","user_header":"https://static001.geekbang.org/account/avatar/00/1b/bb/8f/13de6ff8.jpg","comment_is_top":false,"comment_ctime":1580742386,"is_pvip":false,"replies":[{"id":68388,"content":"\n\n下面代码是一个典型的Startup，其Configure方法中可以使用Configuration 属性\npublic class Startup\n{\n        public Startup(IConfiguration configuration)\n        {\n            Configuration = configuration;\n        }\n\n        public IConfiguration Configuration { get; }\n}","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1580893070,"ip_address":"","comment_id":175551,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"怎么样让自己的配置节点使用依赖注入的形式传入 startup 的 Configure方法了。","like_count":0,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482794,"discussion_content":"\n\n下面代码是一个典型的Startup，其Configure方法中可以使用Configuration 属性\npublic class Startup\n{\n        public Startup(IConfiguration configuration)\n        {\n            Configuration = configuration;\n        }\n\n        public IConfiguration Configuration { get; }\n}","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580893070,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":174128,"user_name":"Geek_6a7195","can_delete":false,"product_type":"c3","uid":1814357,"ip_address":"","ucode":"2A59B13632E1D3","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL5oVY5LLYQyUWibVibju7EVtj1X9TEldklAiagI5LPBFlKmBmeibwibGNKXWFYmfRFxFQNRHTAR2shFcg/132","comment_is_top":false,"comment_ctime":1580015368,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"最近在家 不走亲访友 正好学习 能否更新频率快点 不要按计划的星期四才更新 把存货都倒一倒","like_count":12},{"had_liked":false,"id":250766,"user_name":"琨","can_delete":false,"product_type":"c3","uid":2148201,"ip_address":"","ucode":"5A0C4253AD6FA9","user_header":"https://static001.geekbang.org/account/avatar/00/20/c7/69/d852c125.jpg","comment_is_top":false,"comment_ctime":1601213812,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"数据承载的集合，拿来干什么的。怎么用的。。我感觉学的云里雾里的。。","like_count":0},{"had_liked":false,"id":250763,"user_name":"琨","can_delete":false,"product_type":"c3","uid":2148201,"ip_address":"","ucode":"5A0C4253AD6FA9","user_header":"https://static001.geekbang.org/account/avatar/00/20/c7/69/d852c125.jpg","comment_is_top":false,"comment_ctime":1601213715,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"看第一遍总是会看不懂。。","like_count":0}]}