{"id":487752,"title":"29 | æ¶ˆæ¯é©±åŠ¨ï¼šå¦‚ä½•é›†æˆ Stream å®ç°æ¶ˆæ¯é©±åŠ¨ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å§šç§‹è¾°ã€‚</p><p>åœ¨ä¸ŠèŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€äº›å®é™…æ¡ˆä¾‹äº†è§£åˆ°äº†æ¶ˆæ¯é©±åŠ¨æŠ€æœ¯çš„åº”ç”¨åœºæ™¯ï¼Œè¿™èŠ‚è¯¾æˆ‘ä»¬å°±ä½¿ç”¨Spring Cloud StreamæŠ€æœ¯æ¥ä¸€åœºæ¼”ç»ƒï¼ŒåŸºäºRabbitMQæ¶ˆæ¯ä¸­é—´ä»¶æ¥è½åœ°å®è·µåœºæ™¯ã€‚</p><p>ä»¥å¾€æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ä½¿ç”¨Streamæ—¶ï¼Œå¤§éƒ½æ˜¯ä½¿ç”¨ç»å…¸çš„@Inputã€@Outputå’Œ@StreamListenerç­‰æ³¨è§£æ¥æ³¨å†Œæ¶ˆæ¯ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œè€ŒStreamåœ¨3.1ç‰ˆæœ¬ä¹‹ååœ¨è¿™å‡ ä¸ªæ³¨è§£ä¸Šæ‰“äº†ä¸€ä¸ª@Deprecatedæ ‡è®°ï¼Œæ„æ€æ˜¯è¿™ç§å¯¹æ¥æ–¹å¼å·²ç»è¢«æ·˜æ±°äº†ï¼Œä¸æ¨èç»§ç»­ä½¿ç”¨ã€‚å–è€Œä»£ä¹‹çš„æ˜¯æ›´ä¸ºæµè¡Œçš„Functional Programmingé£æ ¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¿—ç§°çš„å‡½æ•°å¼ç¼–ç¨‹ã€‚</p><p>ä»è¿‘å‡ å¹´çš„æŠ€æœ¯å‘å±•è¶‹åŠ¿å°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œå‡½æ•°å¼ç¼–ç¨‹æˆäº†ä¸€ç§æŠ€æœ¯æ¼”è¿›çš„è¶‹åŠ¿ï¼Œå®ƒèƒ½è®©ä½ ä»¥æ›´å°‘çš„ä»£ç å’Œç²¾ç®€åŒ–çš„é…ç½®å®ç°è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ã€‚å‡½æ•°å¼ç¼–ç¨‹å’Œçº¦å®šå¤§äºé…ç½®ç›¸ç»“åˆçš„ç¼–ç¨‹é£æ ¼æ¯”è¾ƒæ”¾é£è‡ªæˆ‘ï¼Œåœ¨æ¥ä¸‹æ¥çš„å®æˆ˜ç¯èŠ‚ä¸­ï¼Œä½ å°±ä¼šä½“ä¼šåˆ°è¿™ç§less code styleçš„å¿«æ„Ÿäº†ã€‚</p><p>å› ä¸ºå‡½æ•°å¼æ¶ˆæ¯é©±åŠ¨åœ¨åŒä¸€ä¸ªåº”ç”¨åŒ…å«å¤šä¸ªEvent Topicçš„æƒ…å†µä¸‹æœ‰ä¸€äº›ç‰¹æ®Šé…ç½®ï¼Œæ‰€ä»¥ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºè¿™ä¸ªåœºæ™¯ï¼Œæˆ‘é€‰æ‹©äº†CustomeræœåŠ¡ä¸­çš„ä¸¤ä¸ªå…·æœ‰å…³è”æ€§çš„ä¸šåŠ¡ï¼Œåˆ†åˆ«æ˜¯ç”¨æˆ·é¢†å–ä¼˜æƒ åˆ¸å’Œåˆ é™¤ä¼˜æƒ åˆ¸ï¼Œè¿™èŠ‚è¯¾æˆ‘ä»¬å°±å°†è¿™ä¸¤ä¸ªæœåŠ¡æ”¹é€ æˆåŸºäºæ¶ˆæ¯é©±åŠ¨çš„å®ç°æ–¹å¼ã€‚</p><!-- [[[read_end]]] --><h2>å®ç°æ¶ˆæ¯é©±åŠ¨</h2><p>æˆ‘æŠŠä¸šåŠ¡åœºæ™¯é‡Œçš„æ¶ˆæ¯ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éƒ½å®šä¹‰åœ¨äº†CustomeræœåŠ¡ä¸­ï¼Œå¯èƒ½ä½ ä¼šä»¥ä¸ºï¼Œåœ¨çœŸå®é¡¹ç›®é‡Œï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…åº”è¯¥åˆ†åˆ«å®šä¹‰åœ¨ä¸åŒçš„åº”ç”¨ä¸­ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ç¡®å®å¦‚æ­¤ã€‚æ¯”å¦‚åœ¨<a href=\"https://time.geekbang.org/column/article/487158\">ä¸ŠèŠ‚è¯¾</a>çš„æ¶ˆæ¯å¹¿æ’­åœºæ™¯é‡Œï¼Œä¸€ä¸ªè®¢å•å®Œæˆä¹‹åï¼Œé€šè¿‡å¹¿æ’­æ¶ˆæ¯è§¦å‘ä¸‹æ¸¸å„ä¸ªæœåŠ¡çš„ä¸šåŠ¡æµç¨‹ï¼Œè¿™é‡Œçš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ˜¯åˆ†åœ¨ä¸åŒåº”ç”¨ä¸­çš„ã€‚</p><p>ä½†æ˜¯å‘¢ï¼Œæˆ‘ä»¬ä¹Ÿæœ‰æŠŠç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å®šä¹‰åœ¨åŒä¸€ä¸ªåº”ç”¨ä¸­çš„åœºæ™¯ï¼Œæˆ‘å«å®ƒè‡ªäº§è‡ªé”€ã€‚æ¯”å¦‚åœ¨ä¸€äº›å‰Šå³°å¡«è°·çš„ä¾‹å­ä¸­ï¼Œä¸ºäº†å¹³æ»‘å¤„ç†ç”¨æˆ·æµé‡å¹¶é™ä½è´Ÿè½½ï¼Œæˆ‘ä»¬å¯ä»¥å°†é«˜QPSä½†æ—¶æ•ˆæ€§è¦æ±‚ä¸é«˜çš„è¯·æ±‚å †ç§¯åˆ°æ¶ˆæ¯ç»„ä»¶é‡Œï¼Œè®©å½“å‰åº”ç”¨çš„æ¶ˆè´¹è€…æ…¢æ…¢å»å¤„ç†ã€‚æ¯”å¦‚æˆ‘æ›¾ç»å®ç°çš„æ‰¹é‡å‘å¸ƒå•†å“å°±æ˜¯è¿™ä¹ˆä¸ªè‡ªäº§è‡ªé”€çš„ä¾‹å­ï¼Œå•†å“æœåŠ¡æ¥æ”¶è¯·æ±‚åä¸¢åˆ°MQï¼Œè®©åŒä¸€ä¸ªåº”ç”¨å†…éƒ¨çš„æ¶ˆè´¹è€…æ…¢æ…¢æ¶ˆåŒ–ã€‚</p><p>æˆ‘ä»¬æ¥ä¸‹æ¥å°±åˆ†ä¸‰æ­¥èµ°ï¼Œç”¨è¿™ä¸ªè‡ªäº§è‡ªé”€çš„è·¯å­æ¥å®ç°æ¶ˆæ¯é©±åŠ¨ä¸šåŠ¡ã€‚å…ˆæ·»åŠ ç”Ÿäº§è€…ä»£ç ï¼Œå†å®šä¹‰æ¶ˆè´¹è€…é€»è¾‘ï¼Œæœ€åæ·»åŠ é…ç½®æ–‡ä»¶ã€‚</p><p>æŒ‰ç…§æƒ¯ä¾‹ï¼Œé›†æˆä¹‹å‰ä½ éœ€è¦å…ˆæŠŠä¸‹é¢è¿™ä¸ªStreamä¾èµ–é¡¹æ·»åŠ åˆ°coupon-customer-implé¡¹ç›®çš„pomæ–‡ä»¶ä¸­ã€‚ç”±äºæˆ‘ä»¬åº•å±‚ä½¿ç”¨çš„ä¸­é—´ä»¶æ˜¯RabbitMQï¼Œæ‰€ä»¥æˆ‘ä»¬å¼•å…¥çš„æ˜¯stream-rabbitç»„ä»¶ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ä¸åŒçš„ä¸­é—´ä»¶ï¼Œé‚£ä¹ˆéœ€è¦å¼•å…¥å¯¹å£çš„ä¾èµ–é¡¹ã€‚</p><pre><code class=\"language-plain\">&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-cloud-starter-stream-rabbit&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre><p>æ·»åŠ å¥½ä¾èµ–é¡¹ä¹‹åï¼Œæˆ‘ä»¬å…ˆæ¥åŠ¨æ‰‹ç¼–å†™ç”Ÿäº§è€…é€»è¾‘ã€‚</p><h3>æ·»åŠ ç”Ÿäº§è€…</h3><p>ç”Ÿäº§è€…åªåšä¸€ä»¶äº‹ï¼Œå°±æ˜¯ç”Ÿäº§ä¸€ä¸ªæ¶ˆæ¯äº‹ä»¶ï¼Œå¹¶å°†è¿™ä¸ªäº‹ä»¶å‘é€åˆ°RabbitMQã€‚æˆ‘åœ¨CustomeræœåŠ¡ä¸‹åˆ›å»ºäº†ä¸€ä¸ªå«åšCouponProducerçš„ç±»ï¼Œæ·»åŠ äº†sendCouponå’ŒdeleteCouponè¿™ä¸¤ä¸ªç”Ÿäº§è€…æ–¹æ³•ï¼Œåˆ†åˆ«å¯¹åº”äº†é¢†å–ä¼˜æƒ åˆ¸å’Œåˆ é™¤ä¼˜æƒ åˆ¸ã€‚åœ¨è¿™ä¸¤ä¸ªæ–¹æ³•å†…ï¼Œæˆ‘ä½¿ç”¨äº†StreamBridgeè¿™ä¸ªStreamçš„åŸç”Ÿç»„ä»¶ï¼Œå°†ä¿¡æ¯å‘é€ç»™RabbitMQã€‚</p><pre><code class=\"language-plain\">@Service\n@Slf4j\npublic class CouponProducer {\n\n    @Autowired\n    private StreamBridge streamBridge;\n\n    public void sendCoupon(RequestCoupon coupon) {\n        log.info(\"sent: {}\", coupon);\n        streamBridge.send(EventConstant.ADD_COUPON_EVENT, coupon);\n    }\n\n    public void deleteCoupon(Long userId, Long couponId) {\n        log.info(\"sent delete coupon event: userId={}, couponId={}\", userId, couponId);\n        streamBridge.send(EventConstant.DELETE_COUPON_EVENT, userId + \",\" + couponId);\n    }\n\n}\n</code></pre><p>åœ¨è¿™æ®µä»£ç é‡Œï¼ŒstreamBridge.sendæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯Binding Nameï¼Œå®ƒæŒ‡å®šäº†è¿™æ¡æ¶ˆæ¯è¦è¢«å‘åˆ°å“ªä¸€ä¸ªä¿¡é“ä¸­ï¼Œå…¶ä¸­ADD_COUPON_EVENT=addCoupon-out-0ï¼Œè€ŒdeleteCoupon=deleteCoupon-out-0ã€‚ä½ å…ˆä¸è¦ç®¡è¿™ä¸¤ä¸ªå¥‡æ€ªçš„å€¼æ˜¯ä»€ä¹ˆï¼Œä½ åªè¦æŠŠBinding Nameç†è§£æˆä¸€æ¡æ¶ˆæ¯ä»Streamåˆ°è¾¾RabbitMQä¹‹é—´çš„â€œé€šé“â€ï¼Œå¾…ä¼šå„¿çœ‹åˆ°é…ç½®æ–‡ä»¶çš„æ—¶å€™ï¼Œä½ å°±ä¼šæ¸…æ¥šè¿™æ¡é€šé“æ˜¯æ€ä¹ˆä¸RabbitMQä¸­å®šä¹‰çš„æ¶ˆæ¯é˜Ÿåˆ—åç§°å…³è”èµ·æ¥çš„äº†ã€‚</p><p>æ¶ˆæ¯çš„ç”Ÿäº§è€…å·²ç»å®šä¹‰å¥½äº†ï¼Œæ¥ä¸‹æ¥æˆ‘åœ¨CouponCustomerControllerä¸­æ–°æ·»åŠ äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œå•ç‹¬ç”¨æ¥æµ‹è¯•æˆ‘ä»¬å®šä¹‰çš„ä¸¤ä¸ªç”Ÿäº§è€…æœåŠ¡ã€‚è¿™ä¸¤ä¸ªControlleræ–¹æ³•æ¥æ”¶çš„å‚æ•°å’Œç°æœ‰çš„é¢†åˆ¸ã€åˆ é™¤åˆ¸çš„æ¥å£æ˜¯ä¸€è‡´çš„ï¼Œå”¯äºŒçš„åŒºåˆ«æ˜¯è¯·æ±‚è·¯å¾„åé¢å¤šäº†ä¸ªEventï¼Œä»¥åŠæ–¹æ³•çš„è¿”å›å€¼å˜æˆäº†voidã€‚</p><pre><code class=\"language-plain\">@PostMapping(\"requestCouponEvent\")\npublic void requestCouponEvent(@Valid @RequestBody RequestCoupon request) {\n    couponProducer.sendCoupon(request);\n}\n\n// ç”¨æˆ·åˆ é™¤ä¼˜æƒ åˆ¸\n@DeleteMapping(\"deleteCouponEvent\")\npublic void deleteCouponEvent(@RequestParam(\"userId\") Long userId,\n                         @RequestParam(\"couponId\") Long couponId) {\n    couponProducer.deleteCoupon(userId, couponId);\n}\n</code></pre><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬ç”Ÿäº§è€…ç«¯çš„é…ç½®å°±å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å»ç¼–å†™æ¶ˆæ¯çš„æ¶ˆè´¹è€…ã€‚</p><h3>æ·»åŠ æ¶ˆæ¯æ¶ˆè´¹è€…</h3><p>æˆ‘åœ¨CouponProducerçš„åŒçº§ç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ªCouponConsumerç±»ï¼Œå®ƒä½œä¸ºæ¶ˆæ¯çš„æ¶ˆè´¹è€…ï¼Œä»RabbitMQå¤„æ¶ˆè´¹ç”±ç”Ÿäº§è€…å‘å¸ƒçš„æ¶ˆæ¯äº‹ä»¶ï¼Œæ–¹æ³•åº•å±‚ä»ç„¶æ˜¯è°ƒç”¨CustomerServiceæœåŠ¡æ¥å®Œæˆä¸šåŠ¡é€»è¾‘ã€‚</p><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæœ‰ä¸€ä¸ªâ€œ<strong>çº¦å®šå¤§äºé…ç½®</strong>â€çš„è§„çŸ©ä½ ä¸€å®šè¦éµå®ˆï¼Œé‚£å°±æ˜¯ä¸è¦ä¹±èµ·æ–¹æ³•åã€‚æˆ‘è¿™é‡Œå®šä¹‰çš„addCouponã€deleteCouponä¸¤ä¸ªæ–¹æ³•åæ˜¯æœ‰æ¥å¤´çš„ï¼Œä½ è¦ç¡®ä¿æ¶ˆè´¹è€…æ–¹æ³•çš„åç§°å’Œé…ç½®æ–‡ä»¶ä¸­æ‰€å®šä¹‰çš„Function Nameä»¥åŠBinding Nameä¿æŒä¸€è‡´ï¼Œè¿™æ˜¯function eventçš„ä¸€æ¡æ½œè§„åˆ™ã€‚å› ä¸ºåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¡†æ¶ä¼šä½¿ç”¨æ¶ˆè´¹è€…æ–¹æ³•çš„method nameä½œä¸ºå½“å‰æ¶ˆè´¹è€…çš„æ ‡è¯†ï¼Œå¦‚æœæ¶ˆè´¹è€…æ ‡è¯†å’Œé…ç½®æ–‡ä»¶ä¸­çš„åç§°ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆSpringåº”ç”¨å°±ä¸çŸ¥é“è¯¥æŠŠå½“å‰çš„æ¶ˆè´¹è€…ç»‘å®šåˆ°å“ªä¸€ä¸ªStreamä¿¡é“ä¸Šå»ã€‚</p><p>å¦å¤–æœ‰ä¸€ç‚¹éœ€è¦æé†’ä½ ï¼Œæˆ‘åœ¨ä»£ç ä¸­é‡‡ç”¨äº†Consumerçš„å®ç°æ–¹å¼ï¼Œå®ƒæ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€ç§æ–¹å¼ï¼Œä½ ä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œé‡‡ç”¨å…¶å®ƒå‡½æ•°å¼ç¼–ç¨‹æ–¹å¼æ¥ç¼–å†™è¿™æ®µé€»è¾‘ã€‚</p><pre><code class=\"language-plain\">@Slf4j\n@Service\npublic class CouponConsumer {\n\n    @Autowired\n    private CouponCustomerService customerService;\n\n    @Bean\n    public Consumer&lt;RequestCoupon&gt; addCoupon() {\n        return request -&gt; {\n            log.info(\"received: {}\", request);\n            customerService.requestCoupon(request);\n        };\n    }\n\n    @Bean\n    public Consumer&lt;String&gt; deleteCoupon() {\n        return request -&gt; {\n            log.info(\"received: {}\", request);\n            List&lt;Long&gt; params = Arrays.stream(request.split(\",\"))\n                    .map(Long::valueOf)\n                    .collect(Collectors.toList());\n            customerService.deleteCoupon(params.get(0), params.get(1));\n        };\n    }\n\n}\n</code></pre><p>åˆ°è¿™é‡Œæ¶ˆè´¹è€…çš„å®šä¹‰ä¹Ÿå®Œæˆäº†ã€‚åœ¨å®šä¹‰ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„è¿‡ç¨‹ä¸­æˆ‘å¤šæ¬¡æåˆ°äº†é…ç½®æ–‡ä»¶ï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹ä¸€ä¸‹Streamçš„é…ç½®é¡¹éƒ½æœ‰å“ªäº›å†…å®¹ã€‚</p><h3>æ·»åŠ é…ç½®æ–‡ä»¶</h3><p>Streamçš„é…ç½®é¡¹æ¯”è¾ƒå¤šï¼Œæˆ‘æ‰“ç®—åˆ†Binderå’ŒBindingä¸¤éƒ¨åˆ†æ¥è®²ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹Binderéƒ¨åˆ†ï¼ŒBinderä¸­é…ç½®äº†å¯¹æ¥å¤–éƒ¨æ¶ˆæ¯ä¸­é—´ä»¶æ‰€éœ€è¦çš„è¿æ¥ä¿¡æ¯ã€‚å¦‚æœä½ çš„ç¨‹åºä¸­åªä½¿ç”¨äº†å•ä¸€çš„ä¸­é—´ä»¶ï¼Œæ¯”å¦‚åªæ¥å…¥äº†RabbitMQï¼Œé‚£ä¹ˆä½ å¯ä»¥ç›´æ¥åœ¨spring.rabbitmqèŠ‚ç‚¹ä¸‹é…ç½®è¿æ¥ä¸²ï¼Œä¸éœ€è¦ç‰¹åˆ«æŒ‡å®šbindersé…ç½®ã€‚</p><p>å¦‚æœä½ åœ¨Streamä¸­éœ€è¦åŒæ—¶å¯¹æ¥å¤šä¸ªä¸åŒç±»å‹ï¼Œæˆ–å¤šä¸ªåŒç±»å‹ä½†åœ°å€ç«¯å£å„ä¸ç›¸åŒçš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œé‚£ä¹ˆä½ å¯ä»¥æŠŠè¿™äº›ä¸­é—´ä»¶çš„ä¿¡æ¯é…ç½®åœ¨spring.cloud.stream.bindersèŠ‚ç‚¹ä¸‹ã€‚å…¶ä¸­typeå±æ€§æŒ‡å®šäº†å½“å‰æ¶ˆæ¯ä¸­é—´ä»¶çš„ç±»å‹ï¼Œè€Œenvironmentåˆ™æŒ‡å®šäº†è¿æ¥ä¿¡æ¯ã€‚</p><pre><code class=\"language-plain\">spring:\n  cloud:\n    stream:\n      # å¦‚æœä½ é¡¹ç›®é‡Œåªå¯¹æ¥ä¸€ä¸ªä¸­é—´ä»¶ï¼Œé‚£ä¹ˆä¸ç”¨å®šä¹‰binders\n      # å½“ç³»ç»Ÿè¦å®šä¹‰å¤šä¸ªä¸åŒæ¶ˆæ¯ä¸­é—´ä»¶çš„æ—¶å€™ï¼Œä½¿ç”¨binderså®šä¹‰\n      binders:\n        my-rabbit:\n          type: rabbit # æ¶ˆæ¯ä¸­é—´ä»¶ç±»å‹\n          environment: # è¿æ¥ä¿¡æ¯\n            spring:\n              rabbitmq:\n                host: localhost\n                port: 5672\n                username: guest\n                password: guest\n      \n</code></pre><p>é…ç½®å®Œäº†bindersï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥çœ‹çœ‹å¦‚ä½•å®šä¹‰spring.cloud.stream.bindingsèŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹ä¿å­˜äº†ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…ã€binderå’ŒRabbitMQå››æ–¹çš„å…³è”å…³ç³»ã€‚</p><pre><code class=\"language-plain\">spring:\n  cloud:\n    stream:\n      bindings:\n        # æ·»åŠ coupon - Producer\n        addCoupon-out-0:\n          destination: request-coupon-topic\n          content-type: application/json\n          binder: my-rabbit\n        # æ·»åŠ coupon - Consumer\n        addCoupon-in-0:\n          destination: request-coupon-topic\n          content-type: application/json\n          # æ¶ˆè´¹ç»„ï¼ŒåŒä¸€ä¸ªç»„å†…åªèƒ½è¢«æ¶ˆè´¹ä¸€æ¬¡\n          group: add-coupon-group\n          binder: my-rabbit\n        # åˆ é™¤coupon - Producer\n        deleteCoupon-out-0:\n          destination: delete-coupon-topic\n          content-type: text/plain\n          binder: my-rabbit\n        # åˆ é™¤coupon - Consumer\n        deleteCoupon-in-0:\n          destination: delete-coupon-topic\n          content-type: text/plain\n          group: delete-coupon-group\n          binder: my-rabbit\n      function:\n        definition: addCoupon;deleteCoupon\n</code></pre><p>æˆ‘ä»¬ä»¥addCouponä¸ºä¾‹ï¼Œä½ ä¼šçœ‹åˆ°æˆ‘å®šä¹‰äº†addCoupon-out-0å’ŒaddCoupon-in-0è¿™ä¸¤ä¸ªèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹åç§°ä¸­çš„outä»£è¡¨å½“å‰é…ç½®çš„æ˜¯ä¸€ä¸ªç”Ÿäº§è€…ï¼Œè€Œinåˆ™ä»£è¡¨è¿™æ˜¯ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œè¿™ä¾¿æ˜¯spring-functionä¸­çº¦å®šçš„å‘½åå…³ç³»ï¼š</p><p>Inputä¿¡é“ï¼ˆæ¶ˆè´¹è€…ï¼‰ï¼š&lt; functionName &gt; - in - &lt; index &gt;ï¼›</p><p>Outputä¿¡é“ï¼ˆç”Ÿäº§è€…ï¼‰ï¼š&lt; functionName &gt; - out - &lt; index &gt;ã€‚</p><p>ä½ å¯èƒ½æ³¨æ„åˆ°äº†ï¼Œåœ¨å‘½åè§„åˆ™çš„æœ€åè¿˜æœ‰ä¸€ä¸ªindexï¼Œå®ƒæ˜¯inputå’Œoutputçš„åºåˆ—ï¼Œå¦‚æœåŒä¸€ä¸ªfunction nameåªæœ‰ä¸€ä¸ªoutputå’Œä¸€ä¸ªinputï¼Œé‚£ä¹ˆè¿™ä¸ªindexæ°¸è¿œéƒ½æ˜¯0ã€‚è€Œå¦‚æœä½ éœ€è¦ä¸ºä¸€ä¸ªfunctionæ·»åŠ å¤šä¸ªinputå’Œoutputï¼Œå°±éœ€è¦ä½¿ç”¨indexå˜é‡æ¥åŒºåˆ†æ¯ä¸ªç”Ÿäº§è€…æ¶ˆè´¹è€…äº†ã€‚å¦‚æœä½ å¯¹indexçš„ä½¿ç”¨åœºæ™¯æ„Ÿå…´è¶£ï¼Œå¯ä»¥å‚è€ƒæ–‡ç¨¿ä¸­çš„<a href=\"https://docs.spring.io/spring-cloud-stream/docs/3.1.0/reference/html/spring-cloud-stream.html#_functions_with_multiple_input_and_output_arguments\">å®˜æ–¹ç¤¾åŒºæ–‡æ¡£</a>ã€‚</p><p>ç°åœ¨ä½ å·²ç»äº†è§£äº†ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„ä¿¡é“æ˜¯å¦‚ä½•å®šä¹‰çš„ï¼Œä½†æ˜¯ï¼Œè‡³äºè¿™ä¸ªä¿¡é“å’ŒRabbitMQé‡Œå®šä¹‰çš„æ¶ˆæ¯é˜Ÿåˆ—ä¹‹é—´çš„å…³ç³»ï¼Œä½ çŸ¥é“æ˜¯æ€ä¹ˆæŒ‡å®šçš„å—ï¼Ÿ</p><p>ä¿¡é“å’ŒRabbitMQçš„ç»‘å®šå…³ç³»æ˜¯é€šè¿‡binderå±æ€§æŒ‡å®šçš„ã€‚å¦‚æœå½“å‰é…ç½®æ–‡ä»¶çš„ä¸Šä¸‹æ–‡ä¸­åªæœ‰ä¸€ä¸ªæ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆæ¯”å¦‚ä½¿ç”¨é»˜è®¤çš„MQï¼‰ï¼Œä½ å¹¶ä¸éœ€è¦å£°æ˜binderå±æ€§ã€‚ä½†å¦‚æœä½ é…ç½®äº†å¤šä¸ªbinderï¼Œé‚£å°±éœ€è¦ä¸ºæ¯ä¸ªä¿¡é“å£°æ˜å¯¹åº”çš„binderæ˜¯è°ã€‚addCoupon-out-0å¯¹åº”çš„binderåç§°æ˜¯my-rabbitï¼Œè¿™ä¸ªbinderå°±æ˜¯æˆ‘åˆšæ‰åœ¨spring.cloud.stream.bindersé‡Œå£°æ˜çš„é…ç½®ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œç”Ÿäº§è€…æ¶ˆè´¹è€…ä¿¡é“åˆ°æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆbinderï¼‰çš„è”ç³»å°±å»ºç«‹èµ·æ¥äº†ã€‚</p><p>ä¿¡é“å’Œæ¶ˆæ¯é˜Ÿåˆ—çš„å…³ç³»æ˜¯é€šè¿‡destinationå±æ€§æŒ‡å®šçš„ã€‚ä»¥addCouponä¸ºä¾‹ï¼Œæˆ‘åœ¨addCoupon-out-0ç”Ÿäº§è€…é…ç½®é¡¹ä¸­æŒ‡å®šäº†destination=request-coupon-topicï¼Œæ„æ€æ˜¯å°†æ¶ˆæ¯å‘é€åˆ°åä¸ºrequest-coupon-topicçš„Topicä¸­ã€‚æˆ‘åˆåœ¨addCoupon-in-0æ¶ˆè´¹è€…é‡Œæ·»åŠ äº†åŒæ ·çš„é…ç½®ï¼Œæ„æ€æ˜¯è®©å½“å‰æ¶ˆè´¹è€…ä»request-coupon-topicæ¶ˆè´¹æ–°çš„æ¶ˆæ¯ã€‚</p><p>RabbitMQæ¶ˆæ¯ç»„ä»¶å†…éƒ¨æ˜¯é€šè¿‡äº¤æ¢æœºï¼ˆExchangeï¼‰å’Œé˜Ÿåˆ—ï¼ˆQueueï¼‰æ¥åšæ¶ˆæ¯æŠ•é€’çš„ï¼Œå¦‚æœä½ ç™»å½•RabbitMQçš„æ§åˆ¶å°ï¼Œå°±å¯ä»¥åœ¨Exchangesä¸‹çœ‹åˆ°æˆ‘å£°æ˜çš„delete-coupon-topicå’Œrequest-coupon-topicã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/74/82/74de92b7156a5eb7b7eebf5291733682.png?wh=661x601\" alt=\"å›¾ç‰‡\"></p><p>åˆ‡æ¢åˆ°Queuesé¢æ¿ï¼Œä½ è¿˜ä¼šçœ‹åˆ°è¿™ä¸¤ä¸ªäº¤æ¢æœºæ‰€ç»‘å®šçš„é˜Ÿåˆ—åç§°ã€‚è¿™é‡Œçš„é˜Ÿåˆ—åç§°åé¢è¿˜è·Ÿäº†ä¸€ä¸ªgroup nameï¼Œè¿™å°±æ˜¯æˆ‘åœ¨æ¶ˆè´¹è€…è¿™ä¸€ä¾§è®¾ç½®çš„æ¶ˆæ¯åˆ†ç»„ï¼Œæˆ‘åœ¨é…ç½®é¡¹ä¸­ä¸ºadd-coupon-inè®¾ç½®äº†group=add-coupon-groupï¼Œå³å½“å‰åˆ†ç»„å†…åªæœ‰ä¸€å°æœºå™¨å¯ä»¥å»æ¶ˆè´¹é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€œæ¶ˆæ¯åˆ†ç»„å•æ’­â€çš„åœºæ™¯ã€‚å¦‚æœä½ ä¸è®¾ç½®groupå±æ€§ï¼Œé‚£ä¹ˆè¿™ä¸ªæ¶ˆæ¯å°±ä¼šæˆä¸ºä¸€æ¡â€œå¹¿æ’­æ¶ˆæ¯â€ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/5f/eb/5fb0dd9635eff788edba15b80962e1eb.png?wh=1030x506\" alt=\"å›¾ç‰‡\"></p><p>æœ€åçš„æœ€åï¼Œæœ‰ä¸€ä¸ªæœ€ä¸ºé‡è¦çš„é…ç½®é¡¹ï¼Œæˆ‘ä¸“é—¨æŠŠå®ƒæ”¾åˆ°æœ€åæ¥è®²ï¼Œé‚£å°±æ˜¯spring.cloud.stream.functionã€‚å¦‚æœä½ çš„é¡¹ç›®ä¸­åªæœ‰ä¸€ç»„æ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆä½ å®Œå…¨ä¸ç”¨æ­ç†è¿™ä¸ªé…ç½®é¡¹ï¼Œåªè¦ç¡®ä¿æ¶ˆè´¹è€…ä»£ç ä¸­çš„method nameå’Œbindingsä¸‹å£°æ˜çš„æ¶ˆè´¹è€…ä¿¡é“åç§°ç›¸å¯¹åº”å°±å¥½äº†ï¼›å¦‚æœä½ çš„é¡¹ç›®ä¸­æœ‰å¤šç»„æ¶ˆè´¹è€…ï¼ˆæ¯”å¦‚æˆ‘å£°æ˜äº†addCouponå’ŒdeleteCouponä¸¤ä¸ªæ¶ˆè´¹è€…ï¼‰ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ éœ€è¦å°†æ¶ˆè´¹è€…æ‰€å¯¹åº”çš„function nameæ·»åŠ åˆ°spring.cloud.stream.functionï¼Œå¦åˆ™æ¶ˆè´¹è€…æ— æ³•è¢«ç»‘å®šåˆ°æ­£ç¡®çš„ä¿¡é“ã€‚</p><pre><code class=\"language-plain\">spring:\n  cloud:\n    stream:\n      function:\n        definition: addCoupon;deleteCoupon\n</code></pre><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±å®Œæ•´æ­å»ºäº†ä¸€å¥—æ¶ˆæ¯é©±åŠ¨çš„æ–¹æ¡ˆã€‚ä¸‹é¢è®©æˆ‘æ¥å¸¦ä½ å›é¡¾ä¸‹æœ¬èŠ‚é‡ç‚¹å§ã€‚</p><h2>æ€»ç»“</h2><p>åœ¨ä»Šå¤©çš„è¯¾ç¨‹é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº†Streamåœ¨æ–°ç‰ˆæœ¬ä¸­æ¨èçš„functional eventé£æ ¼å®ç°äº†ç”¨æˆ·é¢†åˆ¸å’Œåˆ é™¤åˆ¸ã€‚åœ¨è¿™ä¸ªç¯èŠ‚é‡Œï¼Œä½ éœ€è¦æ³¨æ„çš„æ˜¯éµå¾ªspring functionçš„çº¦å®šï¼Œåœ¨ä¸‹é¢çš„å‡ ä¸ªåœ°æ–¹ä½¿ç”¨ä¸€è‡´çš„å‘½åè§„åˆ™ã€‚</p><ol>\n<li>ç”Ÿäº§è€…ç«¯ä»£ç ä¸­çš„binding nameï¼ˆaddCoupon-out-0ï¼‰å’Œé…ç½®æ–‡ä»¶ä¸­çš„ç”Ÿäº§è€…åç§°ä¸€è‡´ï¼›</li>\n<li>åŒä¸€å¯¹ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­è¦ä½¿ç”¨ä¸€æ ·çš„Topic Nameï¼›</li>\n<li>å¦‚æœé¡¹ç›®ä¸­å­˜åœ¨å¤šä¸ªæ¶ˆè´¹è€…ï¼Œä½¿ç”¨spring.cloud.stream.functionæˆ–è€…spring.cloud.functionæŠŠæ‰€æœ‰æ¶ˆè´¹è€…çš„function nameå†™å‡ºæ¥ã€‚</li>\n</ol><p>çº¦å®šå¤§äºé…ç½®è¿™ç§é£æ ¼ï¼Œå¯¹åˆå­¦è€…æ¥è¯´ï¼Œæ˜¯éœ€è¦ä¸€äº›ä¸Šæ‰‹é—¨æ§›çš„ï¼Œä½†å½“ä½ ç†Ÿæ‚‰äº†è¿™é‡Œé¢çš„é—¨é“ä¹‹åï¼Œä½ å°±èƒ½åˆ©ç”¨è¿™ç§less codeå¼€å‘é£æ ¼å¤§å¹…æé«˜å¼€å‘æ•ˆç‡ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>å¦‚æœConsumeråœ¨æ¶ˆè´¹æ¶ˆæ¯çš„æ—¶å€™å‘ç”Ÿäº†å¼‚å¸¸ï¼Œä½ çŸ¥é“æœ‰å“ªäº›å¼‚å¸¸å¤„ç†çš„æ–¹å¼å—ï¼Ÿ</p><p>å¥½å•¦ï¼Œè¿™èŠ‚è¯¾å°±ç»“æŸå•¦ã€‚æ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™æ›´å¤šå¯¹Spring Cloudæ„Ÿå…´è¶£çš„æœ‹å‹ã€‚æˆ‘æ˜¯å§šç§‹è¾°ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","neighbors":{"left":{"article_title":"28 | æ¶ˆæ¯é©±åŠ¨ï¼šè°è¯´æ¶ˆæ¯é˜Ÿåˆ—åªèƒ½å‰Šå³°å¡«è°·ï¼Ÿ","id":487158},"right":{"article_title":"30 | æ¶ˆæ¯é©±åŠ¨ï¼šå¦‚ä½•é«˜æ•ˆå¤„ç† Stream ä¸­çš„å¼‚å¸¸ï¼Ÿ","id":488500}},"comments":[{"had_liked":false,"id":345499,"user_name":"Carla","can_delete":false,"product_type":"c1","uid":1181454,"ip_address":"","ucode":"29608BF359A567","user_header":"","comment_is_top":false,"comment_ctime":1652336587,"is_pvip":true,"replies":[{"id":"126160","content":"è®²çœŸï¼Œè€Œä¸”å¾ˆå®¹æ˜“å‡ºé”™ï¼Œæ’æŸ¥èµ·æ¥è¿˜ä¸å®¹æ˜“ ï¼šï¼‰","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2819998","ctime":1652583533,"ip_address":"","comment_id":345499,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5947303883","product_id":100101301,"comment_content":"çº¦å®šçš„å¤šäº†ï¼Œæ€ä¹ˆæ„Ÿè§‰åè€Œå˜å¾—éº»çƒ¦äº†ğŸ˜‚","like_count":2,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"å§šåŠä»™","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572043,"discussion_content":"è®²çœŸï¼Œè€Œä¸”å¾ˆå®¹æ˜“å‡ºé”™ï¼Œæ’æŸ¥èµ·æ¥è¿˜ä¸å®¹æ˜“ ï¼šï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652583533,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":335372,"user_name":"wake","can_delete":false,"product_type":"c1","uid":1222812,"ip_address":"","ucode":"08F77A1144D383","user_header":"https://static001.geekbang.org/account/avatar/00/12/a8/9c/643646b9.jpg","comment_is_top":false,"comment_ctime":1645492138,"is_pvip":false,"replies":[{"id":"122647","content":"å…¶å®å’Œè¿”å›å€¼å…³ç³»ä¸å¤§ï¼ŒConsumeråªæ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€ç§å®ç°æ–¹å¼ï¼Œè¿˜æœ‰å…¶ä»–æ–¹å¼æ¯”å¦‚Fluxã€Supplierã€‚å¦‚æœæ–¹æ³•é‡åï¼Œæˆ‘å°è±¡ä¸­æ˜¯éµå¾ªå…ˆæ¥ååˆ°ï¼Œååˆå§‹åŒ–çš„beanå¯¹åº”çš„consumerä¼˜å…ˆç”Ÿæ•ˆã€‚åŒå­¦å¯ä»¥æœ¬åœ°è¯•ä¸€ä¸‹ï¼Œå›å¤´å‘Šè¯‰æˆ‘ä»¬ç­”æ¡ˆå“ˆ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2819998","ctime":1645632341,"ip_address":"","comment_id":335372,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5940459434","product_id":100101301,"comment_content":"è€å¸ˆå¦‚æœæˆ‘å…¶å®ƒæ–¹æ³•åä¹Ÿå«addCouponä¼šè¢«è¯¯è®¤ä¸ºæ¶ˆè´¹è€…å—ï¼Ÿæˆ–è€…è¯´åªæœ‰è¿”å›å€¼ä¸ºConsumeræ‰ä¼šè¢«è®¤å®šä¸ºæ¶ˆè´¹è€…ï¼Œé‚£å¦‚æœæœ‰ä¸¤ä¸ªåŒæ ·çš„è¿”å›Consumerçš„addCouponæ–¹æ³•å‘¢","like_count":1,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"å§šåŠä»™","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552913,"discussion_content":"å…¶å®å’Œè¿”å›å€¼å…³ç³»ä¸å¤§ï¼ŒConsumeråªæ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€ç§å®ç°æ–¹å¼ï¼Œè¿˜æœ‰å…¶ä»–æ–¹å¼æ¯”å¦‚Fluxã€Supplierã€‚å¦‚æœæ–¹æ³•é‡åï¼Œæˆ‘å°è±¡ä¸­æ˜¯éµå¾ªå…ˆæ¥ååˆ°ï¼Œååˆå§‹åŒ–çš„beanå¯¹åº”çš„consumerä¼˜å…ˆç”Ÿæ•ˆã€‚åŒå­¦å¯ä»¥æœ¬åœ°è¯•ä¸€ä¸‹ï¼Œå›å¤´å‘Šè¯‰æˆ‘ä»¬ç­”æ¡ˆå“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645632341,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2573588,"avatar":"","nickname":"Geek_8b92bf","note":"","ucode":"0EED09DA79D171","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558131,"discussion_content":"æµ‹è¯•äº†ä¸€ä¸‹ï¼Œå…¶å®å’Œæ–¹æ³•åæ— å…³ï¼ŒåŒ¹é…çš„æ˜¯beanNameï¼Œåªä¸è¿‡åˆšå¥½@Beanæ³¨è§£é»˜è®¤ç”¨æ–¹æ³•åä½œä¸ºbeanNameè€Œå·²ã€‚functionä»£è¡¨çš„ä¸æ˜¯æ–¹æ³•åï¼Œè€Œæ˜¯beanå¿…é¡»æ˜¯@FunctionalInterfaceå§ï¼Œåªä¸è¿‡Streamé‡Œé¢è¦æ±‚äº†Type must be one of Supplier, Function or Consumerã€‚ä»¥ä¸‹æ–¹æ³•ä¹Ÿæ˜¯å¯ä»¥æ¶ˆè´¹æ¶ˆæ¯\n    @Bean(&#34;addCoupon&#34;)\n    public Function&lt;RequestCoupon,Object&gt; dddef(){\n        return d-&gt;{\n            System.out.println(&#34;å¯ä»¥å“¦ggdd&#34;);\n            System.out.println(d);\n            return null;\n        };\n    }","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648105939,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":352634,"user_name":"zkr","can_delete":false,"product_type":"c1","uid":1792800,"ip_address":"ä¸Šæµ·","ucode":"8BF9D0348BBF87","user_header":"https://static001.geekbang.org/account/avatar/00/1b/5b/20/ae2d4489.jpg","comment_is_top":false,"comment_ctime":1658823577,"is_pvip":false,"replies":[{"id":"128731","content":"routing keyä¹Ÿå¯ä»¥åœ¨é…ç½®ä¸­æŒ‡å®šï¼Œåé¢åšæ¶ˆæ¯åˆ†åŒºçš„æ—¶å€™è¿™éƒ¨åˆ†æœ‰è®²ï¼Œå¦‚æœéœ€è¦å®šåˆ¶çš„è¯å¯ä»¥å‚è€ƒ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2819998","ctime":1659942435,"ip_address":"ä¸Šæµ·","comment_id":352634,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1658823577","product_id":100101301,"comment_content":"ä¸ºå•¥ç”Ÿäº§è€…å‘æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…æ¥å—æ¶ˆæ¯ä¸ç”¨æŒ‡å®šé˜Ÿåˆ—åå’Œrouting keyï¼Ÿé˜Ÿåˆ—è¿™ä¸ªæˆ‘è¿˜èƒ½ç†è§£ï¼Œæˆ‘è¯•äº†ä¸‹æ˜¯æŒ‰topicå+groupåè‡ªåŠ¨ç”Ÿæˆäº†ä¸€ä¸ªï¼Œä½†æ˜¯ä¸ºå•¥topicæ¨¡å¼ä¸ç”¨æŒ‡å®šrouting keyï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"å§šåŠä»™","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583186,"discussion_content":"routing keyä¹Ÿå¯ä»¥åœ¨é…ç½®ä¸­æŒ‡å®šï¼Œåé¢åšæ¶ˆæ¯åˆ†åŒºçš„æ—¶å€™è¿™éƒ¨åˆ†æœ‰è®²ï¼Œå¦‚æœéœ€è¦å®šåˆ¶çš„è¯å¯ä»¥å‚è€ƒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659942435,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":348805,"user_name":"æ›¹äº®","can_delete":false,"product_type":"c1","uid":3006290,"ip_address":"","ucode":"168855E7B18105","user_header":"","comment_is_top":false,"comment_ctime":1655426521,"is_pvip":false,"replies":[{"id":"127578","content":"ç›´æ¥å‘é€mqå¯ä»¥ç†è§£ä¸ºJDBCï¼Œä½¿ç”¨Streamå¯ä»¥ç†è§£ä¸ºåœ¨jdbcä¸Šå·äº†ä¸€å±‚JPAï¼Œåä¸€ä¸ªæ¯”å‰ä¸€ä¸ªå·ï¼Œé€ è½®å­å“ˆå“ˆ<br><br>å›åˆ°MQæ¥çœ‹çš„è¯å°±ç›¸å½“äºStreamåœ¨åº•å±‚ä¸­é—´ä»¶ä¹‹ä¸Šåšäº†ä¸€å±‚spring-integrationçš„æŠ½è±¡ï¼Œå±è”½äº†åº•å±‚ç»†èŠ‚ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2819998","ctime":1657104955,"ip_address":"","comment_id":348805,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1655426521","product_id":100101301,"comment_content":"è€å¸ˆï¼Œè¯·æ•™ä¸€ä¸‹ï¼Œåœ¨å¾®æœåŠ¡é¡¹ç›®ä¸­Streamå’Œmqç»“åˆä½¿ç”¨ï¼Œå’Œç›´æ¥åœ¨æœåŠ¡é‡Œå°†æ¶ˆæ¯å‘é€åˆ°mqï¼Œè¿™ä¸¤ç§æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿç”¨streamçš„ä¼˜åŠ¿ä½“ç°åœ¨å“ªé‡Œï¼Ÿ","like_count":1,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"å§šåŠä»™","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578975,"discussion_content":"ç›´æ¥å‘é€mqå¯ä»¥ç†è§£ä¸ºJDBCï¼Œä½¿ç”¨Streamå¯ä»¥ç†è§£ä¸ºåœ¨jdbcä¸Šå·äº†ä¸€å±‚JPAï¼Œåä¸€ä¸ªæ¯”å‰ä¸€ä¸ªå·ï¼Œé€ è½®å­å“ˆå“ˆ\n\nå›åˆ°MQæ¥çœ‹çš„è¯å°±ç›¸å½“äºStreamåœ¨åº•å±‚ä¸­é—´ä»¶ä¹‹ä¸Šåšäº†ä¸€å±‚spring-integrationçš„æŠ½è±¡ï¼Œå±è”½äº†åº•å±‚ç»†èŠ‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657104955,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":346801,"user_name":"å¯†ç 123456","can_delete":false,"product_type":"c1","uid":1126593,"ip_address":"","ucode":"9889463CC0EA71","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/c1/2dde6700.jpg","comment_is_top":false,"comment_ctime":1653443598,"is_pvip":false,"replies":[{"id":"126728","content":"ä¸–ä¸Šæ— éš¾äº‹ï¼Œåªè¦è‚¯æ”¾å¼ƒã€‚åŒå­¦ç›´æ¥ç”¨æˆ‘çš„æºç å§ï¼šï¼‰","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2819998","ctime":1654237771,"ip_address":"","comment_id":346801,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1653443598","product_id":100101301,"comment_content":"æ„Ÿè§‰ï¼Œè¿™é…ç½®å¥½éš¾ã€‚é…äº†å¥½å‡ å¤©éƒ½æ²¡æœ‰é…å¥½ã€‚","like_count":0,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"å§šåŠä»™","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":574666,"discussion_content":"ä¸–ä¸Šæ— éš¾äº‹ï¼Œåªè¦è‚¯æ”¾å¼ƒã€‚åŒå­¦ç›´æ¥ç”¨æˆ‘çš„æºç å§ï¼šï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654237772,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":344838,"user_name":"kimoti","can_delete":false,"product_type":"c1","uid":1897671,"ip_address":"","ucode":"0A78077408C2B1","user_header":"https://static001.geekbang.org/account/avatar/00/1c/f4/c7/037235c9.jpg","comment_is_top":false,"comment_ctime":1651819574,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1651819574","product_id":100101301,"comment_content":"æ¶ˆè´¹æ¶ˆæ¯å‘ç”Ÿå¼‚å¸¸,æ¶ˆæ¯é‡æ–°è¿›å…¥é˜Ÿåˆ—é‡æ–°æ¶ˆè´¹","like_count":0},{"had_liked":false,"id":335780,"user_name":"å¥”è·‘çš„èš‚èš","can_delete":false,"product_type":"c1","uid":2379253,"ip_address":"","ucode":"7348CA436144CB","user_header":"https://static001.geekbang.org/account/avatar/00/24/4d/f5/2e80aca6.jpg","comment_is_top":false,"comment_ctime":1645686657,"is_pvip":false,"replies":[{"id":"122853","content":"è¿™å‡ è¡Œæ—¥å¿—æ²¡çœ‹åˆ°æŠ¥é”™ä¿¡æ¯ï¼Œåº”è¯¥æ˜¯INFO logï¼Œå¦‚æœæœ‰Errorå¯ä»¥æŠŠå®Œæ•´log traceå‘å‡ºæ¥ä¸€èµ·çœ‹ä¸‹","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2819998","ctime":1645970782,"ip_address":"","comment_id":335780,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1645686657","product_id":100101301,"comment_content":"è¯•äº†ä¸‹spring-cloud-starter-stream-rocketmq çš„ function binding <br>ç¬¬ä¸€æ¬¡å‘é€æ¶ˆæ¯ä¼šæŠ¥æ—¥å¿—<br>DefaultBinderFactory      : Retrieving cached binder: rocketmq<br>DirectWithAttributesChannel    : Channel &#39;unknown.channel.name&#39; has 1 subscriber(s).<br>BeanFactoryAwareFunctionRegistry : Looking up function &#39;streamBridge&#39; with acceptedOutputTypes: [application&#47;json]<br><br>.MessagingMethodInvokerHelper   : Overriding default instance of MessageHandlerMethodFactory with provided one.<br><br><br>è¿™äº›éƒ½æ­£å¸¸å˜›<br>","like_count":0,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"å§šåŠä»™","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553582,"discussion_content":"è¿™å‡ è¡Œæ—¥å¿—æ²¡çœ‹åˆ°æŠ¥é”™ä¿¡æ¯ï¼Œåº”è¯¥æ˜¯INFO logï¼Œå¦‚æœæœ‰Errorå¯ä»¥æŠŠå®Œæ•´log traceå‘å‡ºæ¥ä¸€èµ·çœ‹ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645970782,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2379253,"avatar":"https://static001.geekbang.org/account/avatar/00/24/4d/f5/2e80aca6.jpg","nickname":"å¥”è·‘çš„èš‚èš","note":"","ucode":"7348CA436144CB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"å§šåŠä»™","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":553678,"discussion_content":"æ²¡æœ‰error æ—¥å¿— èƒ½æ­£å¸¸å‘é€æ¶ˆæ¯ï¼Œä½†æ˜¯çœ‹æ—¥å¿—è²Œä¼¼æ˜¯ channelæœªå‘½åï¼Œä¸çŸ¥é“è¿™æ ·ä¼šä¸ä¼šæœ‰é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646026436,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":553582,"ip_address":""},"score":553678,"extra":""}]}]},{"had_liked":false,"id":334872,"user_name":"å¥”è·‘çš„èš‚èš","can_delete":false,"product_type":"c1","uid":2379253,"ip_address":"","ucode":"7348CA436144CB","user_header":"https://static001.geekbang.org/account/avatar/00/24/4d/f5/2e80aca6.jpg","comment_is_top":false,"comment_ctime":1645163943,"is_pvip":false,"replies":[{"id":"122392","content":"é‡è¯•ç­–ç•¥ï¼ˆæ¬¡æ•°+æ¯æ¬¡é‡è¯•é—´éš”ï¼‰ä¼šåœ¨åé¢çš„ä¸€èŠ‚è¯¾ç¨‹é‡Œå•ç‹¬è®²åˆ°ï¼Œåº”è¯¥å¿«ä¸Šçº¿äº†","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2819998","ctime":1645369199,"ip_address":"","comment_id":334872,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1645163943","product_id":100101301,"comment_content":"æˆ‘ä»¬é¡¹ç›®ç”¨äº†spirng.cloud.stream.rocketMq  å‡ºäº†å¼‚å¸¸æ˜¯è‡ªåŠ¨é‡è¯•ï¼Œè€å¸ˆèƒ½è®²è®²åŸç†å˜›  èƒ½è‡ªå®šä¹‰é‡è¯•é—´éš”æ˜¯æ¬¡æ•°å˜›ï¼ˆæ˜¯ä¸æ˜¯mqé‡Œé¢é…ç½®çš„ï¼‰","like_count":0,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"å§šåŠä»™","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552251,"discussion_content":"é‡è¯•ç­–ç•¥ï¼ˆæ¬¡æ•°+æ¯æ¬¡é‡è¯•é—´éš”ï¼‰ä¼šåœ¨åé¢çš„ä¸€èŠ‚è¯¾ç¨‹é‡Œå•ç‹¬è®²åˆ°ï¼Œåº”è¯¥å¿«ä¸Šçº¿äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645369199,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":334804,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1645143414,"is_pvip":true,"replies":[{"id":"122390","content":"Q1ï¼šä¸èµ°å¯»å¸¸è·¯æ˜¯å¯ä»¥ï¼Œä½†æ˜¯å¤±å»äº†çº¦å®šå¤§çº¦é…ç½®çš„æ„ä¹‰<br>Q2ï¼šConsumeræ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€ç§æ–¹å¼<br>Q3ï¼šå‡½æ•°å¼ç¼–ç¨‹è¯­æ³•ï¼Œå»ºè®®å…ˆæ‰¾ä¸€äº›å¼€æºèµ„æ–™ç†Ÿæ‚‰ä¸‹è¯­æ³•<br>Q4: ä»»æ„åå­—<br>Q5ï¼šäº¤æ¢æœºå’Œé˜Ÿåˆ—ä¹‹é—´å¯ä»¥å»ºç«‹ç»‘å®šå…³ç³»ï¼Œå®˜ç½‘çš„å¸®åŠ©æ–‡æ¡£é‡Œæœ‰è¯¦ç»†ä¿¡æ¯https:&#47;&#47;www.rabbitmq.com&#47;documentation.html<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2819998","ctime":1645369091,"ip_address":"","comment_id":334804,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1645143414","product_id":100101301,"comment_content":"è¯·æ•™è€å¸ˆå‡ ä¸ªé—®é¢˜ï¼š<br>Q1ï¼šæ¶ˆè´¹è€…æ ‡è¯†æ˜¯å¦å¯ä»¥ä¸ç”¨æ–¹æ³•åï¼Œå¦å¤–æŒ‡å®šä¸€ä¸ªï¼Ÿ<br>Q2ï¼šâ€œé‡‡ç”¨äº† Consumer çš„å®ç°æ–¹å¼â€ï¼Œâ€œæ·»åŠ æ¶ˆæ¯æ¶ˆè´¹è€…â€éƒ¨åˆ†çš„è¿™å¥è¯ä¸­ï¼Œconsumerçš„å®ç°æ–¹å¼æ˜¯æŒ‡ä»€ä¹ˆï¼Ÿç¬”è¯¯å—ï¼Ÿ<br>Q3 ï¼šâ€œreturn request -&gt; â€ï¼Œrequestä»å“ªé‡Œæ¥ï¼Ÿ<br>CouponConsumerç±»ä¸­ï¼ŒaddCouponæ–¹æ³•ä¸­ç›´æ¥ç”¨äº†requestï¼Œæ­¤requestä»å“ªé‡Œæ¥çš„ï¼Ÿ<br>Q4ï¼šé…ç½®æ–‡ä»¶ä¸­ï¼Œbindersä¸‹é¢çš„my-rabbitï¼Œè¿™ä¸ªåå­—æ˜¯ä»»æ„çš„å—ï¼Ÿ<br>  å¦‚æœæœ‰å¤šä¸ªï¼Œå…¶ä»–çš„ä¹Ÿè¦èµ·ä¸€ä¸ªä¸åŒçš„åå­—å—ï¼Ÿ æ¯”å¦‚my-rabbit2,<br>  my-kafkaç­‰<br>Q5ï¼š äº¤æ¢æœºå’Œé˜Ÿåˆ—æ˜¯æ€ä¹ˆå¯¹åº”çš„ï¼Ÿ<br>A ä¸¤ä¸ªäº¤æ¢æœºï¼Œä¸¤ä¸ªé˜Ÿåˆ—ï¼Œæ¯ä¸ªäº¤æ¢æœºéƒ½å¯ä»¥å°†æ¶ˆæ¯å‘é€åˆ°ä¸¤ä¸ªé˜Ÿåˆ—å—ï¼Ÿ<br>B é˜Ÿåˆ—çš„åå­—ï¼Œç”¨ç‚¹å·åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œæœ‰ä»€ä¹ˆå«ä¹‰å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"å§šåŠä»™","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552248,"discussion_content":"Q1ï¼šä¸èµ°å¯»å¸¸è·¯æ˜¯å¯ä»¥ï¼Œä½†æ˜¯å¤±å»äº†çº¦å®šå¤§çº¦é…ç½®çš„æ„ä¹‰\nQ2ï¼šConsumeræ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€ç§æ–¹å¼\nQ3ï¼šå‡½æ•°å¼ç¼–ç¨‹è¯­æ³•ï¼Œå»ºè®®å…ˆæ‰¾ä¸€äº›å¼€æºèµ„æ–™ç†Ÿæ‚‰ä¸‹è¯­æ³•\nQ4: ä»»æ„åå­—\nQ5ï¼šäº¤æ¢æœºå’Œé˜Ÿåˆ—ä¹‹é—´å¯ä»¥å»ºç«‹ç»‘å®šå…³ç³»ï¼Œå®˜ç½‘çš„å¸®åŠ©æ–‡æ¡£é‡Œæœ‰è¯¦ç»†ä¿¡æ¯https://www.rabbitmq.com/documentation.html\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645369091,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1408553,"avatar":"https://static001.geekbang.org/account/avatar/00/15/7e/29/2fc94ee7.jpg","nickname":"é‡‘ç¶æ²","note":"","ucode":"997DE6CD343179","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555783,"discussion_content":"Q1: å¯ä»¥æŒ‡å®šå…¶ä»–åå­—ï¼Œå› ä¸ºæ­¤æ ‡è¯†æ˜¯ç”¨çš„Beançš„åå­—ï¼Œ å› ä¸º@Beanæ²¡æœ‰æŒ‡å®šåå­—ï¼Œæ‰€ä»¥Beançš„åå­—å°±æ˜¯æ–¹æ³•åï¼Œ  å¦‚æœ@Bean(&#34;testBean&#34;)ï¼Œå°±å¯ä»¥å°†testBeanå½“åšæ ‡è¯†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647073676,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}