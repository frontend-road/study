{"id":553087,"title":"12 | FFmpegåŸºç¡€æ¨¡å—ï¼ˆä¸‰ï¼‰ï¼šAVCodec","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯åˆ˜æ­§ã€‚</p><p>å‰é¢ä¸¤èŠ‚è¯¾æˆ‘ä»¬å­¦ä¹ äº†AVFormatã€AVIOã€dictå’Œoptæ“ä½œæ¥å£ï¼Œåšå®¹å™¨æ ¼å¼å°è£…ä¸è§£å°è£…é—®é¢˜ä¸å¤§ï¼Œä½†æ˜¯å¦‚æœè¦æ¶‰åŠéŸ³è§†é¢‘çš„ç¼–è§£ç çš„è¯ï¼Œå°±éœ€è¦ç”¨åˆ°AVCodecéƒ¨åˆ†çš„æ¥å£äº†ã€‚</p><p>AVCodecæ˜¯å­˜å‚¨ç¼–è§£ç å™¨ä¿¡æ¯çš„ç»“æ„ä½“ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ç¼–è§£ç å™¨çš„æ—¶å€™ä¼šç”¨åˆ°AVCodecï¼Œè€ŒFFmpegé™¤äº†AVCodecç»“æ„ä½“ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªAVCodecContextï¼Œæ˜¯FFmpegå†…éƒ¨æµç¨‹ä¸­å¤„ç†ç¼–è§£ç æ—¶ï¼Œç”¨æ¥è®°å½•å’Œå­˜å‚¨ä¸Šä¸‹æ–‡çš„ç»“æ„ä½“ã€‚å…³äºAVCodecContextè¿™ä¸ªç»“æ„ä½“çš„å‚æ•°ï¼Œå¦‚æœä½ å­¦ä¹ <a href=\"https://time.geekbang.org/column/article/548420\">ç¬¬7èŠ‚è¯¾FFmpegå¸¸ç”¨å‚æ•°</a>çš„æ—¶å€™ï¼Œä»”ç»†é˜…è¯»è¿‡å¸®åŠ©ä¿¡æ¯çš„è¯ï¼Œé‚£AVCodecContextè¿™ä¸ªç»“æ„ä½“å¯¹ä½ æ¥è¯´åº”è¯¥å¾ˆå¥½ç†è§£ã€‚</p><h2>AVCodec æ¥å£</h2><p>åœ¨ä½¿ç”¨FFmpegçš„ç¼–è§£ç å™¨ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦æ‰¾åˆ°ç¼–è§£ç å™¨ã€‚</p><pre><code class=\"language-plain\">const AVCodec *avcodec_find_decoder(enum AVCodecID id);\nconst AVCodec *avcodec_find_decoder_by_name(const char *name);\nconst AVCodec *avcodec_find_encoder(enum AVCodecID id);\nconst AVCodec *avcodec_find_encoder_by_name(const char *name);\n</code></pre><!-- [[[read_end]]] --><p>å¦‚ä»£ç æ‰€ç¤ºï¼Œæ‰¾åˆ°ç¼–ç å™¨å’Œè§£ç å™¨æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯é€šè¿‡AVCodecIDæ¥æŸ¥æ‰¾ï¼Œä¸€ç§æ˜¯é€šè¿‡å­—ç¬¦ä¸²æ¥æŸ¥æ‰¾ï¼Œå­—ç¬¦ä¸²å°±æ˜¯ç¼–ç å™¨æˆ–è§£ç å™¨çš„åç§°ï¼Œä¾‹å¦‚libx264ã€‚</p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœç¼–ç å™¨å’Œè§£ç å™¨çš„findæ¥å£ä½¿ç”¨å¾—æ²¡æœ‰é—®é¢˜ï¼Œç”¨avcodec_find_decoderæŸ¥æ‰¾ç¼–ç å™¨çš„è¯ï¼Œåœ¨è¿™é‡Œå¯èƒ½èƒ½æ‰¾åˆ°AVCodecï¼Œä½†æ˜¯åœ¨åç»­ç”¨æ¥åšç¼–ç çš„æ—¶å€™ä¼šæŠ¥é”™ã€‚</p><p>é€šå¸¸æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨åšç¼–ç æ“ä½œä¹‹å‰ï¼Œè°ƒç”¨æ¥å£av_codec_is_encoderæ¥ç¡®è®¤å½“å‰æ‹¿åˆ°çš„AVCodecæ˜¯ä¸æ˜¯ç¼–ç å™¨ï¼Œæˆ–è€…é€šè¿‡av_codec_is_decoderæ¥ç¡®è®¤æ˜¯ä¸æ˜¯è§£ç å™¨ã€‚</p><p>æ‰¾åˆ°AVCodecä¹‹åï¼Œæœ€å¥½ä¸è¦ç›´æ¥ä½¿ç”¨ï¼Œæ¨èçš„åšæ³•æ˜¯ä¸FFmpegå†…éƒ¨æµç¨‹ä¸­çš„AVCodecContextå»ºç«‹å…³è”ã€‚</p><pre><code class=\"language-plain\">AVCodecContext *avcodec_alloc_context3(const AVCodec *codec);\nvoid avcodec_free_context(AVCodecContext **avctx);\n</code></pre><p>ä»ç¤ºä¾‹ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒAVCodecä¸AVCodecContextå¯ä»¥é€šè¿‡avcodec_alloc_context3æ¥å£æ¥ç”³è¯·å¹¶å»ºç«‹å…³è”ï¼Œå› ä¸ºæ¶‰åŠå†…å­˜ç”³è¯·æ“ä½œï¼Œæ‰€ä»¥ç”¨å®Œä¹‹åéœ€è¦ä½¿ç”¨avcodec_free_contexté‡Šæ”¾èµ„æºã€‚</p><p>ç”³è¯·å®ŒAVCodecContextä¸Šä¸‹æ–‡ä¹‹åï¼Œæ¥ä¸‹æ¥å¯ä»¥æ‰“å¼€ç¼–ç å™¨æˆ–è€…è§£ç å™¨äº†ã€‚</p><pre><code class=\"language-plain\">int avcodec_open2(AVCodecContext *avctx, const AVCodec *codec, AVDictionary **options);\n</code></pre><p>ä½ åº”è¯¥å·²ç»å‘ç°äº†ï¼Œè¿™ä¸ªavcodec_open2æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯AVCodecContextï¼Œå®ƒæ˜¯å¤„ç†ç¼–è§£ç æ—¶ï¼Œç”¨æ¥è®°å½•å’Œå­˜å‚¨ä¸Šä¸‹æ–‡çš„ç»“æ„ä½“ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯AVDictionaryï¼Œè¿™ä¸ªå‚æ•°ç”¨æ¥è®¾ç½®AVCodecç¼–ç å™¨æˆ–è€…è§£ç å™¨å†…éƒ¨çš„å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨ffmpeg -h encoder=libx264æŸ¥çœ‹libx264çš„å†…éƒ¨å¯è®¾ç½®çš„å‚æ•°ï¼ŒAVDictionaryå’ŒAVOptionçš„è®¾ç½®æ–¹å¼ï¼Œæˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚è¯¾å·²ç»è®²è¿‡äº†ï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šä»‹ç»äº†ã€‚</p><p>å¥½äº†ï¼Œæˆ‘ä»¬è¯¥è¯´é“è¯´é“è¿™ç¬¬äºŒä¸ªå‚æ•°äº†ï¼Œå‰é¢æˆ‘ä»¬ä¸æ˜¯å·²ç»åœ¨avcodec_alloc_context3å°†AVCodecä¸AVCodecContextå»ºç«‹è¿‡å…³è”äº†å—ï¼Œè¿™é‡Œæ€ä¹ˆè¿˜éœ€è¦ä¼ é€’ä¸€ä¸ªAVCodecå‘¢ï¼Ÿä½ æƒ³å¾—æ²¡é”™ï¼Œè¿™é‡Œå¯ä»¥ä¸ä¼ é€’äº†ï¼Œè®¾ç½®ä¸ºNULLå°±å¯ä»¥äº†ã€‚å¦‚æœæƒ³è¦å…³é—­ç¼–ç å™¨ï¼Œæ¨èä½ ä½¿ç”¨avcodec_free_contextæ¥åšä¸€æ¬¡é‡Šæ”¾ï¼Œè¿™æ ·æ¯”è¾ƒå¹²å‡€ï¼Œå› ä¸ºavcodec_free_contexté‡Œé¢å·²ç»æœ‰avcodec_closeæ“ä½œäº†ã€‚</p><h3>ç¼–ç å’Œè§£ç çš„æ“ä½œæ¥å£</h3><p>å¥½äº†ï¼Œè¯´å®Œç¼–è§£ç çš„å‰ç½®æ“ä½œï¼Œæ¥ä¸‹æ¥è¿›å…¥æ­£é¢˜ï¼Œæˆ‘ä»¬çœ‹ä¸€çœ‹ç¼–ç å’Œè§£ç çš„æ“ä½œæ¥å£ã€‚</p><pre><code class=\"language-plain\">int avcodec_send_packet(AVCodecContext *avctx, const AVPacket *avpkt);\nint avcodec_receive_frame(AVCodecContext *avctx, AVFrame *frame);\nint avcodec_send_frame(AVCodecContext *avctx, const AVFrame *frame);\nint avcodec_receive_packet(AVCodecContext *avctx, AVPacket *avpkt);\n</code></pre><p>è¿™æ˜¯ä¸¤ç»„æ¥å£ï¼Œavcodec_send_packetä¸avcodec_receive_frameæ˜¯ç”¨æ¥åšè§£ç çš„ç»„åˆï¼Œavcodec_send_frameä¸avcodec_receive_packetæ˜¯ç”¨æ¥åšç¼–ç çš„ç»„åˆã€‚</p><p>å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œå¯ä»¥è°ƒç”¨ä¸€æ¬¡avcodec_send_packetï¼Œå°†AVPacketé€åˆ°è§£ç å™¨é‡Œï¼Œç„¶åavcodec_receive_frameè¯»å–ä¸€æ¬¡AVFrameï¼Œä½†æ˜¯ç¨³å¦¥èµ·è§ï¼Œavcodec_receive_frameæœ‰æ—¶å€™ä¼šè¿”å›EAGAINï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ç¡®è®¤è¯»å…¨äº†AVframeï¼Œå†åšavcodec_receive_frameæ“ä½œã€‚</p><p>FFmpegæ—§ç‰ˆæœ¬å…¶å®æ˜¯ç”¨avcodec_decode_video2å’Œavcodec_decode_audio4æ¥åšçš„éŸ³è§†é¢‘çš„è§£ç ï¼Œä»2016å¹´04æœˆ21æ—¥å¼€å§‹ï¼ŒFFmpegæ–°å¢äº†avcodec_send_packetå’Œavcodec_receive_frameè¿™æ ·çš„ç»„åˆè§£ç ä¸ç»„åˆç¼–ç æ¥å£ï¼Œä¸»è¦æ˜¯ä¸ºäº†è§£å†³ä¸€ä¸ªAVPacketä¸­åŒ…å«å¤šä¸ªè§†é¢‘å¸§æˆ–è€…éŸ³é¢‘åŒ…çš„æƒ…å†µã€‚</p><p>å¦‚æœè§£ç ç»“æŸï¼Œç»™avcodec_send_packetå†™ä¸€ä¸ªNULLçš„AVPacketåŒ…å°±å¯ä»¥äº†ã€‚ç¼–ç çš„è¯ï¼Œç»™avcodec_send_frameè®¾ç½®AVFrameä¸ºNULLå°±è¡¨ç¤ºç¼–ç ç»“æŸäº†ã€‚</p><h2>å…³é”®å‚æ•°AVPacket</h2><p>åœ¨AVFormatå’ŒAVCodecä¹‹é—´æœ‰ä¸€ä¸ªå…³é”®çš„å‚æ•°ï¼Œå°±æ˜¯æˆ‘ä»¬è¿™å‡ èŠ‚è¯¾é¢‘ç¹è§åˆ°çš„AVPacketã€‚AVPacketçš„å†…å®¹æ„å»ºä¹Ÿæœ‰ä¸€ç³»åˆ—çš„æ¥å£éœ€è¦æˆ‘ä»¬äº†è§£ï¼Œæ„é€ AVPacketå†…å®¹çš„æ—¶å€™ç”¨è¿™äº›æ¥å£ä¼šéå¸¸æ–¹ä¾¿ï¼Œä¸‹é¢æˆ‘æ¥ä»‹ç»ä¸€ä¸‹ã€‚</p><p>å¦‚æœä½ æƒ³ä½¿ç”¨AVPacketçš„è¯ï¼Œå¯ä»¥é€šè¿‡av_packet_allocæ¥ç”³è¯·ä¸€ä¸ªAVPacketã€‚</p><pre><code class=\"language-plain\">AVPacket *av_packet_alloc(void);\n</code></pre><p>ä½†è¿™æ¬¡ç”³è¯·çš„åªæ˜¯ä¸€ä¸ªAVPacketçš„å†…å­˜ç©ºé—´ï¼Œé‡Œé¢çš„bufå’Œdataçš„å†…å­˜ç©ºé—´ä¸ä¼šè¢«ç”³è¯·ã€‚å¦‚æœæƒ³è¦ç”³è¯·bufå’Œdataçš„ç©ºé—´çš„è¯ï¼Œå¯ä»¥è€ƒè™‘åœ¨av_packet_allocä¹‹åä½¿ç”¨av_new_packetæ¥è§£å†³ã€‚</p><pre><code class=\"language-plain\">int av_new_packet(AVPacket *pkt, int size)\n</code></pre><p>å½“ä½¿ç”¨av_new_packetç”³è¯·å¸¦bufå’Œdataçš„AVPacketçš„æ—¶å€™ï¼Œéœ€è¦ç»™av_new_packetä¼ é€’ä¸€ä¸ªè¦ç”³è¯·çš„bufç©ºé—´å¤§å°çš„å€¼ã€‚</p><p>é€šè¿‡av_packet_allocç”³è¯·çš„AVPacketéœ€è¦ç”¨av_packet_freeæ¥é‡Šæ”¾ç”³è¯·çš„å†…å­˜ç©ºé—´ã€‚å½“ç„¶ï¼Œav_new_packetç”³è¯·çš„bufåœ¨av_packet_freeé‡Œä¹Ÿä¼šä¸€å¹¶é‡Šæ”¾ã€‚</p><p>è¿™ä¸ªæ—¶å€™ä½ å¯èƒ½ä¼šæœ‰ä¸ªç–‘é—®ã€‚è¯¶ï¼Ÿä¸å¯¹å•Šï¼Œæˆ‘å¦‚æœæŒ‰ç…§AVIOContextçš„æ“ä½œæ–¹å¼ï¼Œè‡ªå·±ä»å†…å­˜ä¸­è¯»åˆ°ä¸€æ®µæ•°æ®ï¼Œæƒ³æŒ‚åˆ°AVPacketåšè§£ç ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœç”¨av_new_packetç”³è¯·å†…å­˜æ˜¯ä¸æ˜¯ä¸å¤ªå¯¹ï¼Ÿä½ æƒ³çš„æ˜¯å¯¹çš„ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ä¸ç”¨av_new_packetæ¥ç”³è¯·bufæˆ–è€…dataçš„å†…å­˜ç©ºé—´ï¼Œä½†æ˜¯å‰é¢av_packet_allocè¿˜æ˜¯éœ€è¦çš„ï¼Œåªæ˜¯è¿™é‡Œçš„bufæˆ–è€…dataå¦‚æœæƒ³è¦æŒ‡å‘ç¬¬ä¸‰æ–¹dataå†…å­˜åŒºåŸŸçš„è¯ï¼Œæœ€å¥½è¿˜æ˜¯ä½¿ç”¨av_packet_from_dataã€‚</p><pre><code class=\"language-plain\">int av_packet_from_data(AVPacket *pkt, uint8_t *data, int size);\n</code></pre><p>ä¸ºä»€ä¹ˆæ¨èä½¿ç”¨av_packet_from_dataåšdataæŒ‚è½½ï¼Œè€Œä¸æ˜¯ç›´æ¥æŠŠAVPacketçš„dataã€bufæŒ‡åˆ°æˆ‘ä»¬è‡ªå·±è¯»åˆ°çš„dataå†…å­˜ç©ºé—´å‘¢ï¼Ÿ</p><p>å…¶å®ä¸»è¦æ˜¯å› ä¸ºä½ åœ¨ä½¿ç”¨FFmpegçš„APIï¼Œæ‰€ä»¥æœ€å¥½è¿˜æ˜¯ç”¨FFmpegæä¾›çš„æ¥å£èµ°FFmpegè‡ªå·±å†…éƒ¨çš„æµç¨‹ã€‚å¹¶ä¸æ˜¯è¯´ä¸èƒ½è‡ªå·±æ‰‹åŠ¨å¤„ç†ï¼Œè€Œæ˜¯ä¸ºäº†é¿å…å¾ˆå¤šä¸å¿…è¦çš„é—®é¢˜ä¸è¿™æ ·åšï¼Œæ¯”å¦‚ä½ æŠŠdataæŒ‡å‘ä½ è‡ªå·±ç”³è¯·çš„å†…å­˜ç©ºé—´ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½ä¼šç¼ºå°‘dataæŒ‡å‘bufï¼Œç„¶åé‚£ä¸ªbufæ˜¯æœ‰PADDINGç©ºé—´é¢„ç•™çš„ã€‚</p><pre><code class=\"language-plain\">    pkt-&gt;buf = av_buffer_create(data, size + AV_INPUT_BUFFER_PADDING_SIZE,\n                                av_buffer_default_free, NULL, 0);\n</code></pre><p>è¿™ä¸ªAV_INPUT_BUFFER_PADDING_SIZEèƒ½è§£å†³å¾ˆé‡è¦çš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨åç»­åšpacketé‡Œé¢çš„dataåˆ†æçš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå‡ºç°crashã€‚å› ä¸ºFFmpegå†…éƒ¨çš„parseråœ¨è§£ædataçš„æ—¶å€™åšäº†ä¸€äº›ä¼˜åŒ–ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€äº›é¢å¤–çš„å¼€é”€ï¼ŒFFmpegçš„codecæ¨¡å—ä¼šé¢„è¯»ä¸€æ®µæ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™å¯èƒ½ä¼šå› ä¸ºå†…å­˜è¶Šç•Œå‡ºç°crashé”™è¯¯ã€‚</p><pre><code class=\"language-plain\">/**\n * @ingroup lavc_decoding\n * Required number of additionally allocated bytes at the end of the input bitstream for decoding.\n * This is mainly needed because some optimized bitstream readers read\n * 32 or 64 bit at once and could read over the end.&lt;br&gt;\n * Note: If the first 23 bits of the additional bytes are not 0, then damaged\n * MPEG bitstreams could cause overread and segfault.\n */\n#define AV_INPUT_BUFFER_PADDING_SIZE 64\n</code></pre><p>è¯´åˆ°å¯¹éŸ³è§†é¢‘æµåšparserï¼Œæˆ‘ä»¬å¯ä»¥å¤§æ¦‚äº†è§£ä¸€ä¸‹ã€‚</p><pre><code class=\"language-plain\">AVCodecParserContext *av_parser_init(int codec_id);\nint av_parser_parse2(AVCodecParserContext *s,\n                     AVCodecContext *avctx,\n                     uint8_t **poutbuf, int *poutbuf_size,\n                     const uint8_t *buf, int buf_size,\n                     int64_t pts, int64_t dts,\n                     int64_t pos);\n\nvoid av_parser_close(AVCodecParserContext *s);\n</code></pre><p>æœ‰äº›éŸ³è§†é¢‘çš„ç¼–ç æ•°æ®ï¼Œæ˜¯ä¼šæŠŠä¸€éƒ¨åˆ†æ•°æ®ç›¸å…³çš„å¤´ä¿¡æ¯å­˜å‚¨åœ¨AVPacketçš„dataä¸­çš„ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨parseræ¥åšè§£æï¼Œè·å¾—ç›¸å…³çš„codecä¿¡æ¯ã€‚å¦‚æœä½ æƒ³è¦çŸ¥é“å“ªäº›codecæœ‰parserçš„è¯ï¼Œå¯ä»¥åœ¨ç¼–è¯‘FFmpegä»£ç é‚£ä¸€æ­¥å°±é€šè¿‡./configure --list-parsersæ¥æŸ¥çœ‹ã€‚</p><p>æ¯”å¦‚è¯´H.264çš„æ•°æ®ï¼Œå¯ä»¥é€šè¿‡parseræ¥å¾—åˆ°ç¼–ç æ•°æ®çš„NALUnitä¿¡æ¯ï¼Œæˆ‘ä»¬åœ¨<a href=\"https://time.geekbang.org/column/article/547562\">ç¬¬6èŠ‚è¯¾</a>çš„æ—¶å€™è®²è¿‡ffprobe -show_frameså¯ä»¥çœ‹åˆ°éŸ³è§†é¢‘æµçš„framesä¿¡æ¯ï¼Œparserè§£æå‡ºæ¥æœ‰ä¸€äº›ä¿¡æ¯æ˜¯åœ¨è¿™ä¸ªframesé‡Œé¢å±•ç¤ºå‡ºæ¥çš„ã€‚è¿™äº›ä¿¡æ¯ä¹Ÿä¸»è¦ç”¨æ¥ä¼ ç»™è§£ç å™¨ä½œä¸ºè§£ç å¤„ç†çš„ä¸€ä¸ªå‚è€ƒã€‚</p><h2>å°ç»“</h2><p>æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹è¿™èŠ‚è¯¾æˆ‘ä»¬éƒ½å­¦åˆ°äº†å“ªäº›å†…å®¹ã€‚</p><ul>\n<li>AVCodecä¸­ç¼–è§£ç ç›¸å…³çš„APIæ¥å£ï¼šavcodec_send_packetä¸avcodec_receive_frameã€avcodec_send_frameä¸avcodec_receive_packetï¼Œä¸¤ç»„ç”¨æ¥åšç¼–è§£ç çš„ç»„åˆæ¥å£ã€‚</li>\n<li>å…³é”®å‚æ•°AVPacketï¼Œè´¯ç©¿Codecä¸Formatæ¨¡å—çš„å§‹ç»ˆï¼Œæ— è®ºæ˜¯å¤„ç†å·²æœ‰çš„å†…å­˜æ•°æ®ï¼Œè¿˜æ˜¯æŒ‰ç…§FFmpegå†…éƒ¨æ¡†æ¶æµç¨‹å»ºç«‹çš„æ•°æ®ï¼Œéƒ½å¯ä»¥åº”å¯¹è‡ªå¦‚ã€‚</li>\n</ul><p>Codecå’ŒFormatä¹‹é—´è¿˜æœ‰æ›´å¤šçš„å¯æ“ä½œç³»ç»Ÿçš„æ–¹æ³•ï¼Œä½ å¯ä»¥å‚è€ƒFFmpegæä¾›çš„ä¾‹å­åŠ æ·±ç†è§£ã€‚è¿˜è®°å¾—<a href=\"https://time.geekbang.org/column/article/551256\">ç¬¬10èŠ‚è¯¾</a>æˆ‘æ¨èä½ ä¸‹è½½FFmpegçš„æºä»£ç å—ï¼Ÿä¸‹è½½æºä»£ç ä»¥åï¼Œä½ å¯ä»¥åœ¨æºä»£ç ç›®å½•çš„doc/examplesç›®å½•ä¸‹çœ‹åˆ°æ›´å…¨é¢çš„FFmpegçš„APIç”¨ä¾‹ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>å¦‚æœè§£ç ä»¥åæˆ‘æƒ³ç»™è§†é¢‘æ·»åŠ ä¸€äº›ç‰¹æ•ˆï¼Œåœ¨AVCodecæ“ä½œä»¥ååº”è¯¥ä½¿ç”¨å“ªä¸ªç»“æ„ä½“é‡Œé¢çš„å†…å®¹å‘¢ï¼Ÿæ¬¢è¿ä½ åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„æƒ³æ³•ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™å¯¹éŸ³è§†é¢‘æ„Ÿå…´è¶£çš„æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","neighbors":{"left":{"article_title":"11 | FFmpeg åŸºç¡€æ¨¡å—ï¼ˆäºŒï¼‰ï¼šAVIOã€AVDictionary ä¸ AVOption","id":551890},"right":{"article_title":"13 | FFmpeg æœ‰å“ªäº›å¸¸è§çš„åº”ç”¨åœºæ™¯ï¼Ÿ","id":554456}},"comments":[{"had_liked":false,"id":354917,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"åŒ—äº¬","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1660879294,"is_pvip":false,"replies":[{"id":129099,"content":"1. æºä»£ç ç¼–è¯‘ä¹‹å‰æŸ¥çœ‹æ¯”è¾ƒç®€å•ã€å¦åˆ™å°±å¾—è‡ªå·±av_parser_iterateä¸€éäº†ï¼Œè¿™æ ·æ€§èƒ½ä¸å¤ªå¥½\n\n2. è¯•è¯•delogoæ»¤é•œ\n\n3. setpts asetpts atempo asetrateéƒ½è¯•è¯•","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1287929,"ctime":1660890256,"ip_address":"åŒ—äº¬","comment_id":354917,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100117501,"comment_content":"è¯·æ•™è€å¸ˆå‡ ä¸ªé—®é¢˜ï¼š\nQ1ï¼šå®‰è£…åä¸èƒ½æŸ¥çœ‹codecçš„parserå—ï¼Ÿ\næ–‡ä¸­æœ‰è¿™æ ·ä¸€å¥è¯â€œå¦‚æœä½ æƒ³è¦çŸ¥é“å“ªäº› codec æœ‰ parser çš„è¯ï¼Œå¯ä»¥åœ¨ç¼–è¯‘ FFmpeg ä»£ç é‚£ä¸€æ­¥å°±é€šè¿‡.&#47;configure --list-parsers æ¥æŸ¥çœ‹â€ã€‚ æˆ‘å®‰è£…çš„æ—¶å€™æ²¡æœ‰åšè¿‡å’Œâ€œconfigure --list-parsersâ€æœ‰å…³çš„æ“ä½œï¼Œé‚£ä¹ˆï¼Œç°åœ¨èƒ½å¤ŸæŸ¥çœ‹codecçš„parserå—ï¼Ÿ\nQ2ï¼šFFmpegèƒ½é™¤å»æ°´å°å—ï¼Ÿ\nFFmpegå¯ä»¥ç»™è§†é¢‘åŠ ä¸Šæ°´å°ï¼Œé‚£å¯ä»¥åšç›¸åçš„æ“ä½œå—ï¼Ÿå³å»é™¤æ°´å°ã€‚\nQ3ï¼šFFmpegæ”¯æŒâ€œå˜é€Ÿâ€ã€â€œå˜è°ƒâ€å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1287929,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a6/f9/79cad962.jpg","nickname":"æ‚Ÿç©º@OnVideo","note":"","ucode":"C320167A9A17B8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584513,"discussion_content":"1. æºä»£ç ç¼–è¯‘ä¹‹å‰æŸ¥çœ‹æ¯”è¾ƒç®€å•ã€å¦åˆ™å°±å¾—è‡ªå·±av_parser_iterateä¸€éäº†ï¼Œè¿™æ ·æ€§èƒ½ä¸å¤ªå¥½\n\n2. è¯•è¯•delogoæ»¤é•œ\n\n3. setpts asetpts atempo asetrateéƒ½è¯•è¯•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660890256,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":386294,"user_name":"é•¿æ±Ÿ","can_delete":false,"product_type":"c1","uid":1436091,"ip_address":"æµ™æ±Ÿ","ucode":"4391EBCF4DE448","user_header":"https://static001.geekbang.org/account/avatar/00/15/e9/bb/58135c8e.jpg","comment_is_top":false,"comment_ctime":1704464932,"is_pvip":false,"replies":[{"id":140934,"content":"çœ‹ä¸Šå»å¾ˆæç«¯ï¼Œæˆ‘æ²¡è¿™ä¹ˆæ“ä½œè¿‡ğŸ˜…","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1287929,"ctime":1705288376,"ip_address":"åŒ—äº¬","comment_id":386294,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100117501,"comment_content":"è§£ç é¢„è¯»å¤§å°ã€‚å¯ä»¥è®¾ç½®æˆ0å—ï¼Ÿè¿™æ ·å¡è¿›å»ä¸€å¸§ï¼Œå°±è§£ç ä¸€å¸§ï¼Œä¸ç”¨ç¼“å­˜","like_count":0,"discussions":[{"author":{"id":1287929,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a6/f9/79cad962.jpg","nickname":"æ‚Ÿç©º@OnVideo","note":"","ucode":"C320167A9A17B8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635837,"discussion_content":"çœ‹ä¸Šå»å¾ˆæç«¯ï¼Œæˆ‘æ²¡è¿™ä¹ˆæ“ä½œè¿‡ğŸ˜…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1705288376,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":359039,"user_name":"Geek_wad2tx","can_delete":false,"product_type":"c1","uid":1004576,"ip_address":"ä¸Šæµ·","ucode":"78CDCEBD183D3A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/20/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1665198044,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100117501,"comment_content":"æŸ¥çœ‹äº† example&#47;filtering_video.c ä¸‹çš„æºç \n\nffmpeg æ»¤é•œé“¾ä¸»è¦ç”¨åˆ°çš„\nç»“æ„ä½“æœ‰ï¼šAVFilterï¼ŒAVFilterInOut\næ¥å£æœ‰ï¼šavfilter_graph_create_filterï¼Œavfilter_graph_configï¼Œav_buffersrc_add_frame_flagsï¼Œav_buffersink_get_frame\n\n\n","like_count":2},{"had_liked":false,"id":386047,"user_name":"ifelse","can_delete":false,"product_type":"c1","uid":2550743,"ip_address":"æµ™æ±Ÿ","ucode":"D0565908C99695","user_header":"https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg","comment_is_top":false,"comment_ctime":1703911702,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":3,"score":2,"product_id":100117501,"comment_content":"å­¦ä¹ æ‰“å¡","like_count":0}]}