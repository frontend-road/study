{"id":91270,"title":"53 | 面向恢复的设计","content":"<h1>课件及源代码地址</h1><p><a href=\"https://gitee.com/geektime-geekbang/go_learning\">https://gitee.com/geektime-geekbang/go_learning</a></p><h2>书目推荐</h2><p><a href=\"time://mall?url=https%3A%2F%2Fh5.youzan.com%2Fv2%2Fgoods%2F1ycmk3uob0ryw\">《计算机程序的构造和解释》</a></p>","comments":[{"had_liked":false,"id":183402,"user_name":"缥缈影子","can_delete":false,"product_type":"c3","uid":1092503,"ip_address":"","ucode":"09A2B843293561","user_header":"https://static001.geekbang.org/account/avatar/00/10/ab/97/c3f5082f.jpg","comment_is_top":false,"comment_ctime":1583033888,"is_pvip":false,"replies":[{"id":76618,"content":"通常可以多输出一些日志，很快就能找到问题。","user_name":"作者回复","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1586514627,"ip_address":"","comment_id":183402,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"做了个小项目，没有用任何框架，主要提供查询数据用，同样的接口和数据，调用一会可用，一会服务就自动停止了，通过日志也看不到那块出错了，这种情况我该从那入手解决。","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"蔡超","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485679,"discussion_content":"通常可以多输出一些日志，很快就能找到问题。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586514627,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1019568,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8e/b0/ef201991.jpg","nickname":"CcczzZ","note":"","ucode":"5F46DA5053D2BB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":194493,"discussion_content":"分别看看go进程、nginx和mysql服务运行情况呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583226268,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":288056,"user_name":"escray","can_delete":false,"product_type":"c3","uid":1020525,"ip_address":"","ucode":"1F4204930E47C4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","comment_is_top":false,"comment_ctime":1618282817,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"通过 http 的 ping 或者是看 进程是否存在，对于僵尸进程可能无法察觉，会得到不准确的健康状态。对于关键路径需要做有效的健康检查，激活一个检查程序。\n\n这个检查程序感觉有点类似于在关键路径上做自动化的冒烟测试。\n\n对于一些不明确的错误，如果只是记录日志而没有真正 Recover，僵尸进程驻留，而没有彻底解决，那么始终会存在隐患。\n\n相对来说，不如直接让它 Crash，还记得当年重启 Wiindows 的经历么？\n\n单体系统，所有的功能都集成在一起，当一部分功能发生错误的时候，没有办法单独重启出错的功能。\n\n微服务，可以通过降级、重启等措施，是可以让出现错误的部分恢复。\n\n有状态的可能需要考虑状态迁移，而无状态的可以用任何一个 instance 来替代，做到 instance flexible\n\n与客户端协商，古老而有效的技术，类似 TCP 协议中的滑动窗口协议\n\n在服务能力成为瓶颈的时候，定义一个返回码，告诉客户端慢一点发，或者告诉客户端隔一段时间再发，主动协调负载，让服务器从繁忙恢复。","like_count":5}]}