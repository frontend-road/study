{"id":131542,"title":"92 | WWW服务","content":"<ul>\n<li>\n<p>代码：<a href=\"https://gitee.com/geektime-geekbang/staffjoy\">https://gitee.com/geektime-geekbang/staffjoy</a></p>\n</li>\n<li>\n<p>课件：<a href=\"https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ\">https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ</a> 提取码: 1aeh</p>\n</li>\n</ul>","comments":[{"had_liked":false,"id":156670,"user_name":"Geek_548191","can_delete":false,"product_type":"c3","uid":1588971,"ip_address":"","ucode":"A3819F21FCC4FA","user_header":"https://static001.geekbang.org/account/avatar/00/18/3e/eb/40278b94.jpg","comment_is_top":false,"comment_ctime":1574933552,"is_pvip":false,"replies":[{"id":60219,"content":"你好，简单回复一下你的问题：\n\n1. 假设请求已经到达faraday-svc，faraday-svc也是住在k8s集群的node中，每个node里头都有kube-dns和kube-proxy，kube-dns实现服务名到clusterIp的映射，kube-proxy则实现clusterIp到具体目标服务podIp的映射，也就是说faraday-svc通过本节点kube-dns找到目标服务的clusterIp，然后通过本节点kube-proxy转发到目标服务Pod上。\n\n2. 一样，FeignClient通过节点上的kube-dns发现目标服务clusterIp，然后通过节点上的kube-proxy转发到目标服务Pod上。\n\n3. 阿里云LB应该不清楚k8s集群内的负载和pod情况，它只是根据路由配置将流量转发到节点的NodePort上，之后由节点上的kube-proxy负责转发到pod。\n\n建议再细看我的k8s网络三部曲文章，里头解释比较清楚，如还有疑问可以加我微信(bulldog2015，说明来自极客时间的用户)。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1575009451,"ip_address":"","comment_id":156670,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"波波老师，看了你写的关于kubernetes的几篇文章，包括pods网络,service网络，还有NodePort，LoadBalance，Ingress，有几点疑惑：\n1.当k8s外部访问www.staffjoy-uat.local或者myacconapp.staffjoy-uat.local服务的时候，首先经过阿里云的LB，然后到达Faraday网关的30001端口，然后faraday-svc进行host-&gt;service-endpoint的路由映射，那么httpclient请求的时候，是如何将service-endpoint和clusterIp联系在一起的呢？kube DNS在这里起作用了吗？知道了clusterIp,最后httpclient再通过faraday-svc的80端口转发到clusterIp的某个pod的80端口，是这样吗？\n2.如果company服务调用account服务，那么通过FeignClient，知道了serviceName和service-endpoint，它们和clusterIp又是怎么联系在一起的呢？这个问题其实和第一个类似。\n2.阿里云的LB做负载均衡，是根据节点负载情况告诉faraday-svc应该要转发到某一个特定的节点的pods上吗？","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476192,"discussion_content":"你好，简单回复一下你的问题：\n\n1. 假设请求已经到达faraday-svc，faraday-svc也是住在k8s集群的node中，每个node里头都有kube-dns和kube-proxy，kube-dns实现服务名到clusterIp的映射，kube-proxy则实现clusterIp到具体目标服务podIp的映射，也就是说faraday-svc通过本节点kube-dns找到目标服务的clusterIp，然后通过本节点kube-proxy转发到目标服务Pod上。\n\n2. 一样，FeignClient通过节点上的kube-dns发现目标服务clusterIp，然后通过节点上的kube-proxy转发到目标服务Pod上。\n\n3. 阿里云LB应该不清楚k8s集群内的负载和pod情况，它只是根据路由配置将流量转发到节点的NodePort上，之后由节点上的kube-proxy负责转发到pod。\n\n建议再细看我的k8s网络三部曲文章，里头解释比较清楚，如还有疑问可以加我微信(bulldog2015，说明来自极客时间的用户)。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575009451,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":148847,"user_name":"黑山老妖","can_delete":false,"product_type":"c3","uid":1115958,"ip_address":"","ucode":"A1659F99C5BE1E","user_header":"https://static001.geekbang.org/account/avatar/00/11/07/36/d677e741.jpg","comment_is_top":false,"comment_ctime":1573094361,"is_pvip":false,"replies":[{"id":57311,"content":"主要两点考虑：\n1.  原版staffjoy的www就是mvc方式；\n2. www站点还是一个营销站点，SEO很重要，如果www采用单页SPA，就要解决SEO的问题，增加复杂性。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1573128629,"ip_address":"","comment_id":148847,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"老师，为何聚合服务www不采用前后分离的模式？是否有什么需要顾忌的地方？","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473635,"discussion_content":"主要两点考虑：\n1.  原版staffjoy的www就是mvc方式；\n2. www站点还是一个营销站点，SEO很重要，如果www采用单页SPA，就要解决SEO的问题，增加复杂性。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573128629,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":155922,"user_name":"水浒山鬼","can_delete":false,"product_type":"c3","uid":1748665,"ip_address":"","ucode":"1FD5C5C8F40050","user_header":"https://static001.geekbang.org/account/avatar/00/1a/ae/b9/05de50a7.jpg","comment_is_top":false,"comment_ctime":1574778792,"is_pvip":false,"replies":[{"id":60039,"content":"你好，你的问题不是很清楚，我尽量回答：\n1. 一般服务A会提供调用地址(具体实现要看企业内部服务发现的做法，常见nginx+域名)，B通过A的服务地址去调用，如果A提供封装好的强类型客户端，那么B就可以直接用强类型客户端调用，如果A只是提供一个http&#47;json服务，那么B可以用http client去调，然后自己解析json。\n2. Feign底层是http调用。\n3. A服务可以躲在网关(企业内部网关，比如nginx)后面，然后B通过网关再调用A，这种方式有不少企业采用。\n","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1574856529,"ip_address":"","comment_id":155922,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"bobo老师您好：\n    请问，由多个开发团队开发的不同的微服务之间有依赖。比如，团队B开发的B服务，依赖于团队A开发的A服务。\n1. 这种情况下，B通常应该采用什么方法调用A服务？\n2. 课程中介绍的Feign强类型调用，本质上是通过HTTP访问服务吧？\n3. B服务在实现时，在代码层面，能不能先通过网关，获取到A服务的访问地址，再按A服务的调用规则去调用？\n谢谢老师～","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475928,"discussion_content":"你好，你的问题不是很清楚，我尽量回答：\n1. 一般服务A会提供调用地址(具体实现要看企业内部服务发现的做法，常见nginx+域名)，B通过A的服务地址去调用，如果A提供封装好的强类型客户端，那么B就可以直接用强类型客户端调用，如果A只是提供一个http/json服务，那么B可以用http client去调，然后自己解析json。\n2. Feign底层是http调用。\n3. A服务可以躲在网关(企业内部网关，比如nginx)后面，然后B通过网关再调用A，这种方式有不少企业采用。\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574856529,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":139262,"user_name":"Dowen Liu","can_delete":false,"product_type":"c3","uid":1440423,"ip_address":"","ucode":"DD072D44AD353D","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLCrJQ4AZe8VrDkR6IO03V4Tda9WexVT4zZiahBjLSYOnZb1Y49JvD2f70uQwYSMibUMQvib9NmGxEiag/132","comment_is_top":false,"comment_ctime":1570594530,"is_pvip":false,"replies":[{"id":53714,"content":"main.css大部分拷贝自谷歌的MDL(Material Design Lite)\nhttps:&#47;&#47;getmdl.io&#47;\n","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1570622817,"ip_address":"","comment_id":139262,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"web-app module 里 staffjoy.css 是 staffjoy.scss 生成的，那么 main.css 是哪里生成的呢？手工写的吗？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469863,"discussion_content":"main.css大部分拷贝自谷歌的MDL(Material Design Lite)\nhttps://getmdl.io/\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570622817,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132203,"user_name":"和光同尘","can_delete":false,"product_type":"c3","uid":1595467,"ip_address":"","ucode":"A3195757E45CD5","user_header":"https://static001.geekbang.org/account/avatar/00/18/58/4b/8b044dd3.jpg","comment_is_top":false,"comment_ctime":1568041972,"is_pvip":false,"replies":[{"id":50644,"content":"我画图一般都是直接ppt画，win的话就用powerpoint，mac用keynote。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1568122076,"ip_address":"","comment_id":132203,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"波波老师，您好，请问您的注册激活流程图是用什么工具画的呀","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466817,"discussion_content":"我画图一般都是直接ppt画，win的话就用powerpoint，mac用keynote。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568122076,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132199,"user_name":"和光同尘","can_delete":false,"product_type":"c3","uid":1595467,"ip_address":"","ucode":"A3195757E45CD5","user_header":"https://static001.geekbang.org/account/avatar/00/18/58/4b/8b044dd3.jpg","comment_is_top":false,"comment_ctime":1568041219,"is_pvip":false,"replies":[{"id":50642,"content":"如果各个租户的客制化需求确实比较多，难以通用化(通用化的成本反而比客制化高)，那还不如每个租户定制独立隔离部署，目前采用k8s+容器方式，自动化部署一套租户应用很快的，架构上也不难做到。当然，原则是尽量通用和重用，最终看成本、可维护性和可规模化能力。libsaas是将sass(一种css扩展语言)编译成普通css的一个库。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1568122020,"ip_address":"","comment_id":132199,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"波波老师，您好，想请问下SAAS多租户架构客户定制化这块的一些实现思路，例如我们有的租户表单字段是6个，另一个租户表单存在不关心其他租户的字段，他的表单字段可能是5个，有的租户校验的规则流程又不一样，我们的代码是部署在租户的私有云环境，像这类定制化需求有什么好的实现思路和资料查阅呢？您pom.xml里面的libsaas是指什么呀，有关于它的讲解吗？非常感谢","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466813,"discussion_content":"如果各个租户的客制化需求确实比较多，难以通用化(通用化的成本反而比客制化高)，那还不如每个租户定制独立隔离部署，目前采用k8s+容器方式，自动化部署一套租户应用很快的，架构上也不难做到。当然，原则是尽量通用和重用，最终看成本、可维护性和可规模化能力。libsaas是将sass(一种css扩展语言)编译成普通css的一个库。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568122020,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1595467,"avatar":"https://static001.geekbang.org/account/avatar/00/18/58/4b/8b044dd3.jpg","nickname":"和光同尘","note":"","ucode":"A3195757E45CD5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":10414,"discussion_content":"谢谢波波老师,目前通用化成本是有的,不同客户的组织架构有差异,需求也伴随着小差异,现在签约一个客户我们就需要开发一套系统,我们是想能够将这些变化最大通用化,做到可扩展,减少开发成本,我们想一份代码可供多个租户部署使用,且支持差异化。租户是隔离部署的,可我们不想签订一个客户就开发一套系统,有什么好的建议呀?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568288874,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}