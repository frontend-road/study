{"id":6945,"title":"07 | Spring Security OAuth2 架构简介","content":"无","comments":[{"had_liked":false,"id":17257,"user_name":"狩魔天使范海辛","can_delete":false,"product_type":"c3","uid":1098910,"ip_address":"","ucode":"E0E8CF701D18BD","user_header":"https://static001.geekbang.org/account/avatar/00/10/c4/9e/d820b03c.jpg","comment_is_top":false,"comment_ctime":1532526486,"is_pvip":false,"replies":[{"id":6112,"content":"我微信号bulldog2015，加微信注明来自己极客时间，欢迎交流","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1532839259,"ip_address":"","comment_id":17257,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"老师可不可以加下微信，想请教一些微服务搭建生产级的问题，评论太散，不太方便。我的邮箱:18217267935@163.com","like_count":4,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":421098,"discussion_content":"我微信号bulldog2015，加微信注明来自己极客时间，欢迎交流","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1532839259,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":24446,"user_name":"天魂无双","can_delete":false,"product_type":"c3","uid":1103870,"ip_address":"","ucode":"044614DB57CF24","user_header":"https://static001.geekbang.org/account/avatar/00/10/d7/fe/1e724d68.jpg","comment_is_top":false,"comment_ctime":1537009705,"is_pvip":false,"replies":[{"id":9642,"content":"恩是的，谢谢指正🌹","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1537680185,"ip_address":"","comment_id":24446,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"terasoluna是日本NTT DATA公司的开源的一个框架，terasoluna是产品名称，不是公司名称","like_count":3,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":423988,"discussion_content":"恩是的，谢谢指正🌹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537680185,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":149329,"user_name":"Geek_862694","can_delete":false,"product_type":"c3","uid":1366022,"ip_address":"","ucode":"977B4195C7CFB1","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/ajNVdqHZLLBP7piae8iaHU7w2a4TyLKPFI7xiaia3Hias2ibMPftnFEic0lqGU315U70peQs7X3Kyd3bDgJjF6nBQg7xA/132","comment_is_top":false,"comment_ctime":1573194673,"is_pvip":false,"replies":[{"id":57903,"content":"本课程是目前最全面的讲解微服务基础架构体系和中间件实践的课程。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1573560214,"ip_address":"","comment_id":149329,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"看到这个作者回复率, 感觉这个课程没有买错🙃","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473818,"discussion_content":"本课程是目前最全面的讲解微服务基础架构体系和中间件实践的课程。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573560214,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":100028,"user_name":"杨杰","can_delete":false,"product_type":"c3","uid":1131823,"ip_address":"","ucode":"74817EA9499843","user_header":"https://static001.geekbang.org/account/avatar/00/11/45/2f/b0b0dd74.jpg","comment_is_top":false,"comment_ctime":1559396346,"is_pvip":false,"replies":[{"id":36223,"content":"这是一整套登录认证体系，完全实现还是比较复杂的，是我计划下次课程要输出的内容。实现这样一套完整体系的关键需要三个组件：包括账户服务，oauth&#47;oidc令牌服务和网关，内容较多不方便直接回复，不过我可以给你两个项目作为参考，一个是fusionauth（https:&#47;&#47;fusionauth.io&#47;），类似auth2&#47;okta的一整套登录认证平台，它里头集成有账户权限服务和oauth&#47;oidc服务，免费但是不开源。另外一个是微软开源的eShopOnContainers(https:&#47;&#47;github.com&#47;dotnet-architecture&#47;eShopOnContainers)微服务演示案例，登录认证体系基于IdentityServer(一个基于.netcore的oauth2&#47;openid connect实现，其中有演示app&#47;web&#47;单页等登录场景。消化吸收这些项目，应该可以给你提供相关设计思路，如需进一步交流，可以加我微信群(bulldog2015，加群说明来自极客时间)。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1559574100,"ip_address":"","comment_id":100028,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"杨波老师，我现在的场景是：\n1、需要提供单点登录（SSO），涉及系统有app，Web应用，传统的Client Sserver应用\n2、需要把系统的一部分服务通过API的形式开放给第三方应用调用，对这些API调用需要进行授权\n请问有什么好建议么？","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452378,"discussion_content":"这是一整套登录认证体系，完全实现还是比较复杂的，是我计划下次课程要输出的内容。实现这样一套完整体系的关键需要三个组件：包括账户服务，oauth/oidc令牌服务和网关，内容较多不方便直接回复，不过我可以给你两个项目作为参考，一个是fusionauth（https://fusionauth.io/），类似auth2/okta的一整套登录认证平台，它里头集成有账户权限服务和oauth/oidc服务，免费但是不开源。另外一个是微软开源的eShopOnContainers(https://github.com/dotnet-architecture/eShopOnContainers)微服务演示案例，登录认证体系基于IdentityServer(一个基于.netcore的oauth2/openid connect实现，其中有演示app/web/单页等登录场景。消化吸收这些项目，应该可以给你提供相关设计思路，如需进一步交流，可以加我微信群(bulldog2015，加群说明来自极客时间)。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559574100,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":286246,"user_name":"朱广明","can_delete":false,"product_type":"c3","uid":2437403,"ip_address":"","ucode":"FC6BF7AB14DB08","user_header":"","comment_is_top":false,"comment_ctime":1617207690,"is_pvip":false,"replies":[{"id":104138,"content":"一般是指吊销用户的令牌。如果监控分析发现令牌所关联的用户反复异常，也可以暂时ban禁用这个用户。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1617546905,"ip_address":"","comment_id":286246,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"关于吊销端点，作用是吊销恶意用户的令牌还是授权信息呢？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517919,"discussion_content":"一般是指吊销用户的令牌。如果监控分析发现令牌所关联的用户反复异常，也可以暂时ban禁用这个用户。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617546905,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":198680,"user_name":"　　　　　　　鸟人","can_delete":false,"product_type":"c3","uid":1035165,"ip_address":"","ucode":"E504B22F336035","user_header":"https://static001.geekbang.org/account/avatar/00/0f/cb/9d/2bc85843.jpg","comment_is_top":false,"comment_ctime":1585463676,"is_pvip":false,"replies":[{"id":75271,"content":"要看用的是哪种token：\n如果是透明令牌(bearer)，那么资源服务器校验的话需要到授权服务器的校验API端点集中校验的(如果资源&#47;授权服务器共享DB的话，也可以做到让资源服务自己到DB获取相关数据进行校验)。\n\n如果是自包含的JWT令牌，那么资源服务器可以自校验。\n\n","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1585750470,"ip_address":"","comment_id":198680,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"关于1.30的视频 校验token到底在资源服务器还是授权服务器呢？是资源服务服务授权的api校验？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489741,"discussion_content":"要看用的是哪种token：\n如果是透明令牌(bearer)，那么资源服务器校验的话需要到授权服务器的校验API端点集中校验的(如果资源/授权服务器共享DB的话，也可以做到让资源服务自己到DB获取相关数据进行校验)。\n\n如果是自包含的JWT令牌，那么资源服务器可以自校验。\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585750470,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1035165,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/cb/9d/2bc85843.jpg","nickname":"　　　　　　　鸟人","note":"","ucode":"E504B22F336035","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":219646,"discussion_content":"谢谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585791653,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":67402,"user_name":"男朋友","can_delete":false,"product_type":"c3","uid":1401707,"ip_address":"","ucode":"9818176E0BBD31","user_header":"https://static001.geekbang.org/account/avatar/00/15/63/6b/34b89fae.jpg","comment_is_top":false,"comment_ctime":1550139732,"is_pvip":false,"replies":[{"id":24021,"content":"你好，通过令牌可以做权限校验。通过OAuth2服务器的令牌校验端点，资源服务器(或网关集中)可以获取该令牌所有者的具体角色和权限信息(如果是JWT令牌的话，角色和权限信息可以是自包含在令牌中的)，资源服务器获取角色和权限信息后就可以做相应的权限判断。每个用户的具体角色和权限一般由企业内部维护，并且和OAuth2服务器可以集成。因为一般令牌需要集中校验(JWT令牌可以自校验)，所以一般无法伪造，也就无法仿造令牌进行攻击。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1550317886,"ip_address":"","comment_id":67402,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"想请问老师，有提到不同用户做判断然后进行不同方式的授权，那这个判断一般是根据什么呢？从不同用户来报中的参数进行判断吗？如果这么做的话不是也可以通过这个接口来仿造令牌进行攻击呢？\n","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439181,"discussion_content":"你好，通过令牌可以做权限校验。通过OAuth2服务器的令牌校验端点，资源服务器(或网关集中)可以获取该令牌所有者的具体角色和权限信息(如果是JWT令牌的话，角色和权限信息可以是自包含在令牌中的)，资源服务器获取角色和权限信息后就可以做相应的权限判断。每个用户的具体角色和权限一般由企业内部维护，并且和OAuth2服务器可以集成。因为一般令牌需要集中校验(JWT令牌可以自校验)，所以一般无法伪造，也就无法仿造令牌进行攻击。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550317886,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}