{"id":195553,"title":"29 | Rangesï¼šæ— è¿­ä»£å™¨çš„è¿­ä»£å’Œæ›´æ–¹ä¾¿çš„ç»„åˆ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å´å’ç‚œã€‚</p><p>ä»Šå¤©ï¼Œæˆ‘ä»¬ç»§ç»­ä¸Šä¸€è®²å¼€å§‹çš„è¯é¢˜ï¼Œè®¨è®º rangesï¼ˆèŒƒå›´ï¼‰ã€‚</p><h2>Ranges ç®€ä»‹</h2><p>åƒä¸‹é¢è¿™æ ·çš„ä»£ç ï¼š</p><pre><code class=\"language-cpp\">#include &lt;algorithm&gt;\n#include &lt;iostream&gt;\n#include &lt;iterator&gt;\n\nint main()\n{\n  using namespace std;\n  int a[] = {1, 7, 3, 6,\n             5, 2, 4, 8};\n  copy(begin(a), end(a),\n       ostream_iterator&lt;int&gt;(\n         std::cout, \" \"));\n  std::cout &lt;&lt; std::endl;\n  sort(begin(a), end(a));\n  copy(begin(a), end(a),\n       ostream_iterator&lt;int&gt;(\n         std::cout, \" \"));\n  std::cout &lt;&lt; std::endl;\n}\n</code></pre><p>ä½ åº”è¯¥å·²ç»è§åˆ°è¿‡å¥½å¤šæ¬¡äº†ã€‚æœ‰æ²¡æœ‰è§‰å¾—è¿™ä¸ªä»£ç æœ‰ç‚¹é‡å¤ã€æœ‰ç‚¹æ— èŠå‘¢ï¼Ÿå°¤å…¶æ˜¯é‡Œé¢çš„ <code>begin</code> å’Œ <code>end</code>ï¼Ÿ</p><p>å¾ˆå¤šäººéƒ½ç•™æ„åˆ°äº†è¿­ä»£å™¨è™½ç„¶çµæ´»ï¼Œä½†ä¸æ˜¯ä¸€ä¸ªè¶³å¤Ÿé«˜çº§çš„æŠ½è±¡â€”â€”å°¤å…¶æ˜¯æˆ‘ä»¬å·²ç»å¯¹ C æ•°ç»„éƒ½å¯ä»¥è¿›è¡ŒåŸºäºâ€œèŒƒå›´â€çš„å¾ªç¯ä¹‹åã€‚å¦‚æœæˆ‘ä»¬æŠŠæ•°ç»„çœ‹ä½œä¸€ä¸ªæŠ½è±¡çš„â€œèŒƒå›´â€ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°ä¸‹é¢çš„ä»£ç ï¼š</p><pre><code class=\"language-cpp\">#include &lt;experimental/ranges/algorithm&gt;\n#include &lt;experimental/ranges/iterator&gt;\n#include &lt;iostream&gt;\n\nint main()\n{\n  using namespace std::\n    experimental::ranges;\n  int a[] = {1, 7, 3, 6,\n             5, 2, 4, 8};\n  copy(a, ostream_iterator&lt;int&gt;(\n            std::cout, \" \"));\n  std::cout &lt;&lt; std::endl;\n  sort(a);\n  copy(a, ostream_iterator&lt;int&gt;(\n            std::cout, \" \"));\n  std::cout &lt;&lt; std::endl;\n}\n</code></pre><!-- [[[read_end]]] --><p>è¿™æ˜¯çœŸæ­£å¯ä»¥ç¼–è¯‘çš„ä»£ç ï¼Œç”¨æˆ‘ä»¬ä¸Šä¸€è®²è®²è¿‡çš„ç¯å¢ƒâ€”â€”æœ€æ–°ç‰ˆçš„ MSVCï¼ˆç¼–è¯‘å‘½ä»¤è¡Œä¸Šéœ€è¦é¢å¤–åŠ  <code>/permissive-</code> é€‰é¡¹ï¼‰æˆ– GCC 7+â€”â€”éƒ½å¯ä»¥ã€‚ä¸è¿‡ï¼Œè¿™ä¸€æ¬¡å³ä½¿æœ€æ–°ç‰ˆçš„ MSVC ä¹Ÿä¸èƒ½é ç¼–è¯‘å™¨æœ¬èº«æ”¯æŒ ranges åº“çš„æ‰€æœ‰ç‰¹æ€§äº†ï¼šåœ¨ä¸¤ç§ç¯å¢ƒä¸‹æˆ‘ä»¬éƒ½å¿…é¡»ä½¿ç”¨ CMCSTL2 <span class=\"orange\">[1]</span>ï¼Œä¹Ÿåªèƒ½ï¼ˆåœ¨ C++20 ä¹‹å‰ä¸´æ—¶ï¼‰ä½¿ç”¨ <code>std::experimental::ranges</code> è€Œä¸æ˜¯ <code>std::ranges</code>ã€‚æ³¨æ„æˆ‘åªå¼•å…¥äº† <code>ranges</code> åç©ºé—´ï¼Œè€Œæ²¡æœ‰å¼•å…¥ <code>std</code> åç©ºé—´ï¼Œè¿™æ˜¯å› ä¸º <code>copy</code>ã€<code>sort</code> ç­‰åç§°åŒæ—¶å‡ºç°åœ¨äº†è¿™ä¸¤ä¸ªåç©ºé—´é‡Œï¼ŒåŒæ—¶å¼•å…¥ä¸¤ä¸ªåç©ºé—´ä¼šåœ¨ä½¿ç”¨ <code>sort</code> ç­‰åå­—æ—¶å¯¼è‡´å†²çªã€‚</p><p>è¿™ä¸ªç¨‹åºçš„è¾“å‡ºï¼Œå½“ç„¶æ˜¯æ¯«ä¸æ„å¤–çš„ï¼š</p><blockquote>\n<p><code>1 7 3 6 5 2 4 8</code><br>\n<code>1 2 3 4 5 6 7 8</code></p>\n</blockquote><p>ä¸‹é¢æˆ‘ä»¬çœ‹â€œè§†å›¾â€ã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†ä¸€ä¸ªåè½¬çš„è§†å›¾ï¼š</p><pre><code class=\"language-cpp\">#include &lt;experimental/ranges/algorithm&gt;\n#include &lt;experimental/ranges/iterator&gt;\n#include &lt;experimental/ranges/ranges&gt;\n#include &lt;iostream&gt;\n\nint main()\n{\n  using namespace std::\n    experimental::ranges;\n  int a[] = {1, 7, 3, 6,\n             5, 2, 4, 8};\n  copy(a, ostream_iterator&lt;int&gt;(\n            std::cout, \" \"));\n  std::cout &lt;&lt; std::endl;\n  auto r = reverse_view(a);\n  copy(r, ostream_iterator&lt;int&gt;(\n            std::cout, \" \"));\n  std::cout &lt;&lt; std::endl;\n}\n</code></pre><p>è¿™ä¸ªç¨‹åºçš„è¾“å‡ºæ˜¯ï¼š</p><blockquote>\n<p><code>1 7 3 6 5 2 4 8</code><br>\n<code>8 4 2 5 6 3 7 1</code></p>\n</blockquote><p>ä¸ºä»€ä¹ˆ <code>r</code> æ˜¯è§†å›¾ï¼Œè€Œä¸æ˜¯åå‘å¤åˆ¶å‡ºçš„å†…å®¹ï¼Ÿæˆ‘ä»¬å¯ä»¥åœ¨è¾“å‡º <code>r</code> ä¹‹å‰ï¼ˆ15è¡Œä¹‹åï¼Œ16è¡Œä¹‹å‰ï¼‰æ’å…¥ä¸‹é¢è¿™è¡Œï¼š</p><pre><code class=\"language-cpp\">  a[0] = 9;\n</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ€åé‚£è¡Œè¾“å‡ºå˜æˆäº†ï¼š</p><blockquote>\n<p><code>8 4 2 5 6 3 7 9</code></p>\n</blockquote><p>è¿™å°±è¯æ˜äº†ï¼Œ<code>r</code> æ²¡æœ‰å¤åˆ¶ <code>a</code> çš„å†…å®¹ã€‚</p><p>è§†å›¾çš„å¤§å°ä¹Ÿä¸ä¸€å®šè·ŸåŸå…ˆçš„â€œèŒƒå›´â€ä¸€æ ·ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬åœ¨<a href=\"https://time.geekbang.org/column/article/185189\">[ç¬¬ 17 è®²]</a> è®¨è®ºè¿‡çš„è¿‡æ»¤è§†å›¾åœ¨ ranges é‡Œçš„å®ç°çš„ç”¨æ³•ï¼š</p><pre><code class=\"language-cpp\">  auto r =\n    filter_view(a, [](int i) {\n      return i % 2 == 0;\n    });\n</code></pre><p>æ‹¿è¿™ä¸ªæ¥æ›¿æ¢ä¸Šé¢ç”¨åˆ° <code>reverse_view</code> çš„é‚£è¡Œï¼Œæˆ‘ä»¬å°±èƒ½å¾—åˆ°ï¼š</p><blockquote>\n<p><code>6 2 4 8</code></p>\n</blockquote><p>è¿™äº›è§†å›¾è¿˜èƒ½è¿›è¡Œç»„åˆï¼šæˆ‘ä»¬å¯ä»¥å†™ <code>reverse_view(filter_view(â€¦))</code>ã€‚ä¸è¿‡ï¼Œåœ¨ç»„åˆçš„æƒ…å†µä¸‹ï¼Œä¸‹é¢è¿™æ ·çš„å†™æ³•ï¼ˆä½¿ç”¨ <code>|</code> å’Œè§†å›¾é€‚é…å™¨ï¼‰å¯èƒ½æ›´æ¸…æ™°äº›ï¼š</p><pre><code class=\"language-cpp\">  auto r = a |\n           views::filter([](int i) {\n             return i % 2 == 0;\n           }) |\n           views::reverse;\n</code></pre><p>è¿™ä¸ªç¨‹åºçš„æ‰§è¡Œç»“æœæ˜¯ï¼š</p><blockquote>\n<p><code>8 4 2 6</code></p>\n</blockquote><p>å¦‚æœä½ ç”¨è¿‡ Unix çš„ç®¡é“ç¬¦ï¼Œä½ ä¸€å®šä¼šè§‰å¾—è¿™ç§å†™æ³•éå¸¸è‡ªç„¶ã€å®¹æ˜“ç»„åˆå§â€¦â€¦</p><h2>èŒƒå›´ç›¸å…³çš„æ¦‚å¿µ</h2><p>æ•´ä¸ª ranges åº“æ˜¯åŸºäºæ¦‚å¿µæ¥å®šä¹‰çš„ã€‚ä¸‹é¢è¿™å¼ å›¾å±•ç¤ºäº† range ç›¸å…³çš„æ¦‚å¿µï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/e5/f9/e5a943a0f87d8c796fe3c78dabf524f9.png?wh=1392*776\" alt=\"\"></p><p>ä»å›¾çš„å³ä¸‹è§’ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸Šä¸€è®²è®¨è®ºè¿‡çš„å‡ ä¸ªæ¦‚å¿µï¼ŒåŒ…æ‹¬ copyable å’Œ semiregularã€‚å†å¾€ä¸Šï¼Œæˆ‘ä»¬çœ‹åˆ°äº† viewâ€”â€”è§†å›¾â€”â€”ä¹Ÿçœ‹åˆ°äº†è§†å›¾æ˜¯ä¸€ä¸ª rangeã€‚ç°åœ¨æˆ‘ä»¬å°±å…ˆæ¥çœ‹ä¸€ä¸‹ range å’Œ view çš„å®šä¹‰ã€‚</p><p>åœ¨ CMCSTL2 é‡Œï¼Œrange æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š</p><pre><code class=\"language-cpp\">template &lt;class T&gt;\nconcept _RangeImpl =\n  requires(T&amp;&amp; t) {\n    begin(static_cast&lt;T&amp;&amp;&gt;(t));\n    end(static_cast&lt;T&amp;&amp;&gt;(t));\n  };\n\ntemplate&lt;class T&gt;\nconcept range = _RangeImpl&lt;T&amp;&gt;;\n</code></pre><p>æ¢å¥è¯è¯´ï¼Œä¸€ä¸ª range å…è®¸æ‰§è¡Œ <code>begin</code> å’Œ <code>end</code> æ“ä½œï¼ˆæ³¨æ„è¿™æ˜¯åœ¨ <code>ranges</code> åç©ºé—´ä¸‹çš„ <code>begin</code> å’Œ <code>end</code>ï¼Œå’Œ <code>std</code> ä¸‹çš„æœ‰äº›å°åŒºåˆ«ï¼‰ã€‚æ‰€ä»¥ï¼Œä¸€ä¸ªæ•°ç»„ï¼Œä¸€ä¸ªå®¹å™¨ï¼Œé€šå¸¸ä¹Ÿèƒ½å½“ä½œä¸€ä¸ª rangeã€‚</p><p>æˆ‘ä»¬å·²ç»æåˆ°äº†è§†å›¾ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°±çœ‹ä¸€ä¸‹ view çš„å®šä¹‰ï¼š</p><pre><code class=\"language-cpp\">template &lt;class T&gt;\nconcept view =\n  range&lt;T&gt; &amp;&amp;\n  semiregular&lt;T&gt; &amp;&amp;\n  enable_view&lt;__uncvref&lt;T&gt;&gt;;\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œview é¦–å…ˆæ˜¯ä¸€ä¸ª rangeï¼Œå…¶æ¬¡å®ƒæ˜¯ semiregularï¼Œä¹Ÿå°±æ˜¯ï¼Œå¯ä»¥è¢«ç§»åŠ¨å’Œå¤åˆ¶ï¼ˆå¯¹ range æ²¡æœ‰è¿™ä¸ªè¦æ±‚ï¼‰ã€‚ç„¶å <code>enable_view</code> æ˜¯ä¸ªå®ç°æä¾›çš„æ¦‚å¿µï¼Œå®ƒçš„å®é™…è¦æ±‚å°±æ˜¯ï¼Œè§†å›¾åº”è¯¥ä¸æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå¯ä»¥åœ¨ O(1) å¤æ‚åº¦å®Œæˆæ‹·è´æˆ–ç§»åŠ¨æ“ä½œã€‚æˆ‘ä»¬å¸¸ç”¨çš„ <code>string</code> æ»¡è¶³ rangeï¼Œä¸æ»¡è¶³ viewï¼›è€Œ <code>string_view</code> åˆ™åŒæ—¶æ»¡è¶³ range å’Œ viewã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬çœ‹ common_rangeï¼Œå®ƒçš„æ„æ€æ˜¯è¿™æ˜¯ä¸ªæ™®é€šçš„ rangeï¼Œå¯¹å…¶åº”ç”¨ <code>begin()</code> å’Œ <code>end()</code>ï¼Œç»“æœæ˜¯åŒä¸€ç±»å‹ï¼š</p><pre><code class=\"language-cpp\">template &lt;class T&gt;\nconcept common_range =\n  range&lt;T&gt; &amp;&amp;\n  same_as&lt;iterator_t&lt;T&gt;,\n          sentinel_t&lt;T&gt;&gt;;\n</code></pre><p>ç„¶åï¼Œsized_range çš„æ„æ€å°±æ˜¯è¿™ä¸ª range æ˜¯æœ‰å¤§å°çš„ï¼Œå¯ä»¥å–å‡ºå…¶å¤§å°ï¼ˆæ³¨æ„æˆ‘ä»¬åˆšæ‰çš„ <code>filter_view</code> å°±æ˜¯æ²¡æœ‰å¤§å°çš„ï¼‰ï¼š</p><pre><code class=\"language-cpp\">template &lt;class T&gt;\nconcept sized_range =\n  range&lt;T&gt; &amp;&amp;\n  requires(T&amp; r) { size(r); };\n</code></pre><p>è‡ªç„¶ï¼Œoutput_range çš„æ„æ€æ˜¯è¿™ä¸ª range çš„è¿­ä»£å™¨æ»¡è¶³è¾“å‡ºè¿­ä»£å™¨çš„æ¡ä»¶ï¼š</p><pre><code class=\"language-cpp\">template &lt;class R, class T&gt;\nconcept output_range =\n  range&lt;R&gt; &amp;&amp;\n  output_iterator&lt;iterator_t&lt;R&gt;, T&gt;;\n</code></pre><p>å½“ç„¶ï¼Œinput_range çš„æ„æ€æ˜¯è¿™ä¸ª range çš„è¿­ä»£å™¨æ»¡è¶³è¾“å…¥è¿­ä»£å™¨çš„æ¡ä»¶ï¼š</p><pre><code class=\"language-cpp\">template &lt;class T&gt;\nconcept input_range =\n  range&lt;T&gt; &amp;&amp;\n  input_iterator&lt;iterator_t&lt;T&gt;&gt;;\n</code></pre><p>å†å¾€ä¸Šçš„è¿™äº›æ¦‚å¿µï¼Œæˆ‘æƒ³æˆ‘å°±ä¸ç”¨å†å•°å—¦äº†â€¦â€¦</p><h3>Sentinel</h3><p>æˆ‘ä¼°è®¡å…¶ä»–æ¦‚å¿µä½ ç†è§£èµ·æ¥åº”è¯¥é—®é¢˜ä¸å¤§ï¼Œä½† common_range ä¹Ÿè®¸ä¼šè®©æœ‰äº›äººè¿·ç³Šï¼šä»€ä¹ˆæ ·çš„ range ä¼š<strong>ä¸</strong>æ˜¯ common_range å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼Œæœ‰äº› range çš„ç»“æŸç‚¹ï¼Œä¸æ˜¯å›ºå®šçš„ä½ç½®ï¼Œè€Œæ˜¯æŸä¸ªæ¡ä»¶ï¼šå¦‚é‡åˆ° 0ï¼Œæˆ–è€…æŸä¸ªè°“è¯æ»¡è¶³äº† 10 æ¬¡ä¹‹åâ€¦â€¦ä» C++17 å¼€å§‹ï¼ŒåŸºäºèŒƒå›´çš„ for å¾ªç¯ä¹Ÿæ¥å— <code>begin</code> å’Œ <code>end</code> çš„ç»“æœä¸æ˜¯åŒä¸€ç±»å‹äº†â€”â€”æˆ‘ä»¬æŠŠå‰è€…è¿”å›çš„ç»“æœç±»å‹å« iteratorï¼ˆè¿­ä»£å™¨ï¼‰ï¼Œè€ŒæŠŠåè€…è¿”å›çš„ç»“æœç±»å‹å« sentinelï¼ˆæ ‡è®°ï¼‰ã€‚</p><p>ä¸‹é¢å±•ç¤ºäº†ä¸€ä¸ªå®é™…çš„ä¾‹å­ï¼š</p><pre><code class=\"language-cpp\">#include &lt;experimental/ranges/algorithm&gt;\n#include &lt;experimental/ranges/iterator&gt;\n#include &lt;iostream&gt;\n\nusing namespace std::experimental::\n  ranges;\n\nstruct null_sentinel {};\n\ntemplate &lt;input_iterator I&gt;\nbool operator==(I i, null_sentinel)\n{\n  return *i == 0;\n}\n\ntemplate &lt;input_iterator I&gt;\nbool operator==(null_sentinel, I i)\n{\n  return *i == 0;\n}\n\ntemplate &lt;input_iterator I&gt;\nbool operator!=(I i, null_sentinel)\n{\n  return *i != 0;\n}\n\ntemplate &lt;input_iterator I&gt;\nbool operator!=(null_sentinel, I i)\n{\n  return *i != 0;\n}\n\nint main(int argc, char* argv[])\n{\n  if (argc != 2) {\n    std::cout &lt;&lt; \"Please provide \"\n                 \"an argument!\"\n              &lt;&lt; std::endl;\n    return 1;\n  }\n  for_each(argv[1], null_sentinel(),\n           [](char ch) {\n             std::cout &lt;&lt; ch;\n           });\n  std::cout &lt;&lt; std::endl;\n}\n</code></pre><p>åœ¨è¿™ä¸ªç¨‹åºé‡Œï¼Œ<code>null_sentinel</code> å°±æ˜¯ä¸€ä¸ªâ€œç©ºå€¼æ ‡è®°â€ã€‚è¿™ä¸ªç±»å‹å­˜åœ¨çš„å”¯ä¸€æ„ä¹‰ï¼Œå°±æ˜¯å…è®¸ <code>==</code> å’Œ <code>!=</code> æ ¹æ®é‡è½½è§„åˆ™åšä¸€äº›ç‰¹æ®Šçš„äº‹æƒ…ï¼šåœ¨è¿™é‡Œï¼Œå°±æ˜¯åˆ¤æ–­å½“å‰è¿­ä»£å™¨æŒ‡å‘çš„ä½ç½®æ˜¯å¦ä¸º 0ã€‚ä¸Šé¢ç¨‹åºçš„æ‰§è¡Œç»“æœæ˜¯æŠŠå‘½ä»¤è¡Œä¸Šä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°è¾“å‡ºåˆ°ç»ˆç«¯ä¸Šã€‚</p><h2>æ¦‚å¿µæµ‹è¯•</h2><p>æˆ‘ä»¬ç°åœ¨å¯¹æ¦‚å¿µæ¥åšä¸€ä¸‹æ£€æŸ¥ï¼Œçœ‹çœ‹å¸¸ç”¨çš„ä¸€äº›å®¹å™¨å’Œè§†å›¾æ»¡è¶³å“ªäº› ranges é‡Œçš„æ¦‚å¿µã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/36/5b/3628cbde0fa893b5d9df888db085c65b.png?wh=1142*934\" alt=\"\"></p><p>è¿™å¼ è¡¨é‡Œæ²¡æœ‰ä»€ä¹ˆæ„å¤–çš„ä¸œè¥¿ã€‚é™¤äº† viewï¼Œ<code>vector&lt;int&gt;</code> æ»¡è¶³æ‰€æœ‰çš„ range æ¦‚å¿µã€‚å¦å¤–ï¼Œ<code>const vector&lt;int&gt;</code> ä¸èƒ½æ»¡è¶³ output_rangeï¼Œä¸èƒ½å¾€é‡Œå†™å†…å®¹ï¼Œä¹Ÿä¸€åˆ‡æ­£å¸¸ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/93/a5/930d8b0e7d11be467eed5e12b98f0aa5.png?wh=1142*934\" alt=\"\"></p><p>è¿™å¼ è¡¨ï¼ŒåŒæ ·è¡¨è¾¾äº†æˆ‘ä»¬å·²çŸ¥çš„äº‹å®ï¼š<code>list</code> ä¸æ»¡è¶³ random_access_range å’Œ contiguous_rangeã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/1a/f4/1a575d6630dcbf2efdb5d41d229577f4.png?wh=1142*934\" alt=\"\"></p><p>è¿™å¼ è¡¨ï¼Œè¯´æ˜äº†ä» range çš„è§’åº¦ï¼ŒC æ•°ç»„å’Œ <code>vector</code> æ˜¯æ²¡å•¥åŒºåˆ«çš„ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/64/e7/64c011b79225c8c4b37353ec374321e7.png?wh=1212*912\" alt=\"\"></p><p>è¿™å¼ å°±æœ‰ç‚¹æ„æ€äº†ï¼Œå±•ç¤ºäº†åè½¬è§†å›¾çš„ç‰¹ç‚¹ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒå‡ ä¹å’ŒåŸå§‹å®¹å™¨å¯æ»¡è¶³çš„æ¦‚å¿µä¸€æ ·ï¼Œå°±å¤šäº† viewï¼Œå°‘äº† contiguous_rangeã€‚åº”è¯¥æ²¡æœ‰è®©ä½ æ„Ÿåˆ°æ„å¤–çš„å†…å®¹å§ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/84/71/8447ab67eefb08e389a8fabfcbeca371.png?wh=1196*915\" alt=\"\"></p><p>ä½†è¿‡æ»¤è§†å›¾å°±ä¸ä¸€æ ·äº†ï¼šæˆ‘ä»¬ä¸èƒ½é¢„çŸ¥å…ƒç´ çš„æ•°é‡ï¼Œæ‰€ä»¥å®ƒä¸èƒ½æ»¡è¶³ sized_rangeã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/0f/94/0f7b3cededc2309d97e146e5cd566294.png?wh=1224*912\" alt=\"\"></p><p>æˆ‘ä»¬å‰é¢è¯´è¿‡ï¼Œistream_line_reader çš„è¿­ä»£å™¨æ˜¯è¾“å…¥è¿­ä»£å™¨ï¼Œæ‰€ä»¥å®ƒä¹Ÿåªèƒ½æ˜¯ä¸ª input_rangeã€‚æˆ‘ä»¬åœ¨è®¾è®¡ä¸Šå¯¹ <code>begin()</code> å’Œ <code>end</code> çš„è¿”å›å€¼é‡‡ç”¨äº†ç›¸åŒçš„ç±»å‹ï¼Œå› æ­¤å®ƒä»æ˜¯ä¸ª common_rangeã€‚ç”¨ take_view å¯ä»¥å–ä¸€ä¸ªèŒƒå›´çš„å‰è‹¥å¹²é¡¹ï¼Œå®ƒå°±ä¸æ˜¯ä¸€ä¸ª commom_range äº†ã€‚å› ä¸ºè¾“å…¥å¯èƒ½åœ¨åˆ°è¾¾é¢„å®šé¡¹æ•°ä¹‹å‰ç»“æŸï¼Œæ‰€ä»¥å®ƒä¹Ÿä¸æ˜¯ sized_rangeã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/9e/08/9e77c25703ecfb51783ebbf604930708.png?wh=1200*912\" alt=\"\"></p><p>æˆ‘ä»¬å†æ¥ä»‹ç»ä¸€ä¸ªæ–°çš„è§†å›¾ï¼Œ<code>iota_view</code>ã€‚å®ƒä»£è¡¨ä¸€ä¸ªä»æŸä¸ªæ•°å¼€å§‹çš„é€’å¢åºåˆ—ã€‚å•å‚æ•°çš„ <code>iota_view</code> æ˜¯æ— ç©·åºåˆ—ï¼ŒåŒå‚æ•°çš„æ˜¯æœ‰é™åºåˆ—ï¼Œä»å®ƒä»¬èƒ½æ»¡è¶³çš„æ¦‚å¿µä¸Šå°±èƒ½çœ‹å‡ºæ¥ã€‚è¿™å„¿æ¯”è¾ƒæœ‰è¶£çš„äº‹å®æ˜¯ï¼Œè™½ç„¶ <code>iota_view(0, 5)</code> å’Œ <code>iota_view(0) | take(5)</code> çš„ç»“æœç›¸åŒï¼Œéƒ½æ˜¯åºåˆ— {0, 1, 2, 3, 4}ï¼Œä½†ç¼–è¯‘å™¨çœ‹èµ·æ¥ï¼Œå‰è€…æ¯”åè€…è¦å¤šæ»¡è¶³ä¸¤ä¸ªæ¦‚å¿µã€‚è¿™åº”è¯¥ä¹Ÿä¸éš¾ç†è§£ã€‚</p><h2>æŠ½è±¡å’Œæ€§èƒ½</h2><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œä½ å¯èƒ½è¿˜æ˜¯æœ‰ç‚¹å¥½å¥‡ï¼Œé‚£ ranges çš„ç”¨é€”æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸ºäº†å°‘å†™ <code>begin()</code> å’Œ <code>end()</code>ï¼Ÿä¸ºäº†æ–¹ä¾¿å‡½æ•°å¼ç¼–ç¨‹ï¼Ÿ</p><p>å½“ç„¶ï¼Œä¸Šé¢çš„è¯´æ³•éƒ½å¯¹ï¼Œä½†æœ€åŸºæœ¬çš„ç›®çš„ï¼Œè¿˜æ˜¯ä¸ºäº†æŠ½è±¡å’Œè¡¨è¾¾èƒ½åŠ›ã€‚æˆ‘ä»¬å¯ä»¥çœ‹ä¸€çœ¼ä¸‹é¢çš„ Python ä»£ç ï¼š</p><pre><code class=\"language-python\">reduce(lambda x, y: x + y,\n       map(lambda x: x * x, range(1, 101)))\n</code></pre><p>ä½ åº”è¯¥ä¸éš¾çœ‹å‡ºï¼Œè¿™ä¸ªè¡¨è¾¾å¼åšçš„æ˜¯ $1^2+2^2+3^2+\\dots+100^2$ã€‚C++ é‡Œæˆ‘ä»¬è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p><p>å½“ç„¶ï¼Œæ‰‹å·¥å¾ªç¯æ˜¯å¯ä»¥çš„ï¼š</p><pre><code class=\"language-cpp\">auto square = [](int x) {\n  return x * x;\n};\n\nint sum = 0;\nfor (int i = 1; i &lt; 101; ++i) {\n  sum += square(i);\n}\n</code></pre><p>æ¯”èµ· Python çš„ä»£ç æ¥ï¼Œä¼¼ä¹ä¸Šé¢è¿™ä¸ªå†™æ³•æœ‰ç‚¹å•°å—¦ï¼Ÿæˆ‘ä»¬è¯•è¯•ä½¿ç”¨ rangesï¼š</p><pre><code class=\"language-cpp\">int sum = nvwa::reduce(\n  std::plus&lt;int&gt;(),\n  views::iota(1, 101) |\n    views::transform(\n      [](int x) { return x * x; }));\n</code></pre><p>æˆ‘ä¸çŸ¥é“ä½ å–œä¸å–œæ¬¢ä¸Šé¢è¿™ä¸ªè¡¨è¾¾æ–¹å¼ï¼Œä½†å®ƒè‡³å°‘èƒ½åœ¨å•ä¸ªè¡¨è¾¾å¼é‡Œå®ŒæˆåŒæ ·çš„åŠŸèƒ½ã€‚å”¯ä¸€é—æ†¾çš„æ˜¯ï¼Œæ ‡å‡†ç®—æ³• <code>accumulate</code> æˆ– <code>reduce</code> åœ¨ä¸Šé¢ä¸å¯ç”¨ï¼ˆæ²¡æœ‰é’ˆå¯¹ ranges çš„æ”¹é€ ï¼‰ï¼Œæˆ‘åªå¥½æ‹¿æˆ‘çš„éæ ‡ <code>reduce</code> <span class=\"orange\">[2]</span> æ¥å‡‘å‡‘æ•°äº†ã€‚</p><p>åŒæ ·é‡è¦çš„æ˜¯ï¼Œä¸Šé¢çš„ä»£ç æ€§èƒ½å¾ˆé«˜â€¦â€¦å¤šé«˜å‘¢ï¼Ÿçœ‹ä¸‹é¢è¿™è¡Œæ±‡ç¼–è¾“å‡ºçš„ä»£ç å°±çŸ¥é“äº†ï¼š</p><pre><code class=\"language-assembly\">movl\t$338350, -4(%rbp)\n</code></pre><h2>ranges åç©ºé—´</h2><p>æˆ‘ä»¬ç°åœ¨å†æ¥çœ‹ä¸€ä¸‹ ranges åç©ºé—´ï¼ˆæˆ‘ä»¬ç›®å‰ä»£ç é‡Œçš„ <code>std::experimental::ranges</code>ï¼ŒC++20 çš„ <code>std::ranges</code>ï¼‰ã€‚è¿™ä¸ªåç©ºé—´æœ‰ ranges ç‰¹æœ‰çš„å†…å®¹ï¼š</p><ul>\n<li>è§†å›¾ï¼ˆå¦‚ <code>reverse_view</code>ï¼‰å’Œè§†å›¾é€‚é…å™¨ï¼ˆå¦‚ <code>views::reverse</code>ï¼‰</li>\n<li>ranges ç›¸å…³çš„æ¦‚å¿µï¼ˆå¦‚ <code>range</code>ã€<code>view</code> ç­‰ï¼‰</li>\n</ul><p>ä½†ä¹Ÿæœ‰äº›åç§°æ˜¯ä» <code>std</code> åç©ºé—´â€œå¤åˆ¶â€è¿‡æ¥çš„ï¼ŒåŒ…æ‹¬ï¼š</p><ul>\n<li>æ ‡å‡†ç®—æ³•ï¼ˆå¦‚ <code>copy</code>ã€<code>transform</code>ã€<code>sort</code>ã€<code>all_of</code>ã€<code>for_each</code> ç­‰ï¼›ä½†æ˜¯ï¼Œå¦‚å‰é¢æ‰€è¯´ï¼Œæ²¡æœ‰ <code>accumulate</code> æˆ– <code>reduce</code>ï¼‰</li>\n<li><code>begin</code> å’Œ <code>end</code></li>\n</ul><p><code>std::copy</code> æ¥å—çš„æ˜¯è¿­ä»£å™¨ï¼Œè€Œ <code>ranges::copy</code> æ¥å—çš„æ˜¯èŒƒå›´ï¼Œä¼¼ä¹è¿˜æœ‰ç‚¹é“ç†ã€‚é‚£ <code>begin</code> å’Œ <code>end</code> å‘¢ï¼Ÿæœ¬æ¥æ¥å—çš„å‚æ•°å°±æ˜¯ä¸€ä¸ªèŒƒå›´å•Šâ€¦â€¦</p><p>Eric Nieblerï¼ˆRanges TS çš„ä½œè€…ï¼‰å¼•å…¥ <code>ranges::begin</code> çš„ç›®çš„æ˜¯è§£å†³ä¸‹é¢çš„ä»£ç å¯èƒ½äº§ç”Ÿçš„é—®é¢˜ï¼ˆä»–çš„ä¾‹å­ <span class=\"orange\">[3]</span>ï¼‰ï¼š</p><pre><code class=\"language-cpp\">extern std::vector&lt;int&gt; get_data();\nauto it = std::begin(get_data());\nint i = *it; // BOOM\n</code></pre><p>æ³¨æ„åœ¨è¯»å– <code>*it</code> çš„æ—¶å€™ï¼Œ<code>get_data()</code> è¿”å›çš„ <code>vector</code> å·²ç»è¢«é”€æ¯äº†â€”â€”æ‰€ä»¥è¿™ä¸ªè¯»å–æ“ä½œæ˜¯æœªå®šä¹‰è¡Œä¸ºï¼ˆundefined behaviorï¼‰ã€‚</p><p>Eric Niebler å’Œ Casey Carterï¼ˆCMCSTL2 çš„ä¸»è¦ä½œè€…ï¼‰ä½¿ç”¨äº†ä¸€ä¸ªç‰¹æ®Šçš„æŠ€å·§ï¼ŒæŠŠ <code>begin</code> å’Œ <code>end</code> å®ç°æˆäº†æœ‰ç‰¹æ®Šçº¦æŸçš„å‡½æ•°å¯¹è±¡ï¼Œä½¿å¾—ä¸‹é¢è¿™æ ·çš„ä»£ç æ— æ³•é€šè¿‡ç¼–è¯‘ï¼š</p><pre><code class=\"language-cpp\">extern std::vector&lt;int&gt; get_data();\nauto it = ranges::begin(get_data());\nint i = *it; // BOOM\n</code></pre><p>å¦‚æœä½ å¯¹æ­¤æœ‰å…´è¶£çš„è¯ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ CMCSTL2 é‡Œçš„ include/stl2/detail/range/access.hppã€‚</p><p>å¯¹ä¸€èˆ¬çš„ç”¨æˆ·è€Œè¨€ï¼Œè®°ä½ <code>ranges::begin</code> å’Œ <code>ranges::end</code> æ˜¯å°†æ¥ <code>std::begin</code> å’Œ <code>std::end</code> çš„æ›´å¥½çš„æ›¿ä»£å“å°±è¡Œäº†ã€‚</p><h2>ä¸€ç‚¹å†å²</h2><p>å¯¹äºæ ‡å‡†ç®—æ³•é‡Œçš„è¿­ä»£å™¨çš„é—®é¢˜æ—©å°±æœ‰äººçœ‹åˆ°äº†ï¼Œå¹¶ä¸”æœ‰ä¸å°‘äººæå‡ºäº†æ”¹è¿›çš„æ–¹æ¡ˆã€‚æœ€æ—©åœ¨ 2003 å¹´ï¼ŒBoost.Range å°±å·²ç»å‡ºç°ï¼ˆä½†å½±å“ä¼¼ä¹ä¸å¤§ï¼‰ã€‚Andrei Alexandresu åœ¨ 2009 å¹´å‘äº†ä¸€ç¯‡å¾ˆæœ‰å½±å“åŠ›çš„æ–‡ç« ï¼Œâ€œIterators must goâ€ <span class=\"orange\">[4]</span>ï¼Œè®¨è®ºè¿­ä»£å™¨çš„é—®é¢˜ï¼ŒåŠä»–åœ¨ D è¯­è¨€é‡Œå®ç° ranges çš„ç»éªŒï¼Œä½†åœ¨ C++ ç•Œæ²¡æœ‰å¼€èŠ±ç»“æœã€‚Eric Niebler åœ¨ 2013 å¹´å¼€å§‹äº† range-v3 <span class=\"orange\">[5]</span> çš„å·¥ä½œï¼Œè¿™æ‰æ˜¯ç›®å‰çš„ ranges çš„åŸºç¡€ã€‚ä»–æŠŠ ranges å†™æˆäº†ä¸€ä¸ªæ ‡å‡†ææ¡ˆ <span class=\"orange\">[6]</span>ï¼Œå¹¶åœ¨ 2017 å¹´è¢« ISO å‡ºç‰ˆæˆä¸ºæ­£å¼çš„ Ranges TSã€‚2018 å¹´æœ«ï¼Œå¥½æ¶ˆæ¯ä¼ æ¥ï¼ŒC++ å§”å‘˜ä¼šé€šè¿‡äº†å†³è®®ï¼ŒRanges æ­£å¼è¢«å¹¶å…¥äº† C++20 çš„è‰æ¡ˆï¼</p><p><img src=\"https://static001.geekbang.org/resource/image/04/b4/04dfc0486f87f25871c5fc873d631eb4.png?wh=1056*560\" alt=\"\" title=\"å›¾ç‰‡èƒŒæ™¯æ¥è‡ªç½‘ç»œ\"></p><p>è°è¯´ç¨‹åºå‘˜éƒ½æ˜¯æ— è¶£çš„ï¼Ÿè¿™ç¯‡å†…å®¹ç”³è¯·æŠŠ Ranges å¹¶å…¥ C++ æ ‡å‡†è‰æ¡ˆçš„çº¯æŠ€æœ¯æ–‡æ¡£ The One Ranges Proposal <span class=\"orange\">[7]</span>ï¼Œå¼€å¤´ç»å¯¹æ˜¯æ¿€æƒ…å››å°„å•Šã€‚</p><h2>æ‰¹è¯„å’Œæœªæ¥</h2><p>å¦‚æœæˆ‘åªè¯´å¥½çš„æ–¹é¢ã€é—®é¢˜ä¸€ç‚¹ä¸è¯´ï¼Œå¯¹äºå­¦ä¹ é“è·¯ä¸Šçš„ä½ ï¼Œä¹Ÿä¸æ˜¯ä»¶å¥½äº‹ã€‚æœ€æœ‰åçš„å¯¹ C++ Ranges çš„æ‰¹è¯„ï¼Œå°±æ˜¯ Unity å¼€å‘è€… Aras PranckeviÄius å‘è¡¨çš„ä¸€ç¯‡æ–‡ç«  <span class=\"orange\">[8]</span>ã€‚æˆ‘ä¸å®Œå…¨è®¤åŒæ–‡ä¸­çš„è§‚ç‚¹ï¼Œä½†æˆ‘è§‰å¾—è¯»ä¸€ä¸‹åé¢çš„æ„è§ä¹Ÿå¾ˆé‡è¦ã€‚</p><p>æ­¤å¤–ï¼ŒC++20 é‡Œçš„ ranges ä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µçš„ç»ˆç‚¹ã€‚å³ä¾¿åœ¨ range-v3 åº“é‡Œï¼Œä¹Ÿæœ‰å¾ˆå¤šä¸œè¥¿ä»ç„¶æ²¡æœ‰è¿›å…¥ C++ æ ‡å‡†ã€‚æ¯”å¦‚ï¼Œçœ‹ä¸€çœ¼ä¸‹é¢çš„ä»£ç ï¼š</p><pre><code class=\"language-cpp\">#include &lt;iostream&gt;\n#include &lt;string&gt;\n#include &lt;vector&gt;\n#include &lt;range/v3/all.hpp&gt;\n\nint main()\n{\n  std::vector&lt;int&gt; vd{1, 7, 3, 6,\n                      5, 2, 4, 8};\n  std::vector&lt;std::string&gt; vs{\n    \"one\",  \"seven\", \"three\",\n    \"six\",  \"five\",  \"two\",\n    \"four\", \"eight\"};\n  auto v =\n    ranges::views::zip(vd, vs);\n  ranges::sort(v);\n  for (auto i : vs) {\n    std::cout &lt;&lt; i &lt;&lt; std::endl;\n  }\n}\n</code></pre><p>ä¸Šé¢çš„ä»£ç å±•ç¤ºäº†æ ‡å‡† ranges ä¸­è¿˜æ²¡æœ‰çš„ zip è§†å›¾ï¼Œå¹¶ä¸”ï¼Œzip è§†å›¾çš„ç»“æœè¿˜å¯ä»¥è¢«æ’åºï¼Œç»“æœå°†ä½¿å¾—åŸå§‹çš„ä¸¤ä¸ª <code>vector</code> éƒ½é‡æ–°æ’åºã€‚ä¸Šè¿°ç¨‹åºçš„è¿è¡Œç»“æœæ˜¯ï¼š</p><blockquote>\n<p><code>one</code><br>\n<code>two</code><br>\n<code>three</code><br>\n<code>four</code><br>\n<code>five</code><br>\n<code>six</code><br>\n<code>seven</code><br>\n<code>eight</code></p>\n</blockquote><p>è¿™ä¸ªéæ ‡çš„ range-v3 åº“çš„å¦å¤–ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œå®ƒä¸ä¾èµ–äºæ¦‚å¿µçš„æ”¯æŒï¼Œå› è€Œå¯ä»¥ç”¨åœ¨æ›´å¤šçš„ç¯å¢ƒä¸­ï¼ŒåŒ…æ‹¬ç›®å‰è¿˜ä¸æ”¯æŒæ¦‚å¿µçš„ Clangã€‚</p><p>å¦‚æœä½ å¸Œæœ›è‡ªå·±å°è¯•ä¸€ä¸‹è¿™ä¸ªä»£ç çš„è¯ï¼Œéœ€è¦åœ¨å‘½ä»¤è¡Œä¸Šä½¿ç”¨ <code>-I</code> é€‰é¡¹æ¥åŒ…å« range-v3 çš„ include ç›®å½•ï¼Œæ­¤å¤– MSVC è¿˜éœ€è¦å‡ ä¸ªç‰¹æ®Šé€‰é¡¹ï¼š</p><blockquote>\n<p><code>cl /EHsc /std:c++latest /permissive- /experimental:preprocessor â€¦</code></p>\n</blockquote><h2>å†…å®¹å°ç»“</h2><p>æœ¬è®²è®¨è®ºäº† C++20 çš„åˆä¸€é‡è¦ç‰¹æ€§ rangesã€‚è™½ç„¶è¿™ä¸€ç‰¹æ€§æ¯”èµ· concepts æ¥äº‰è®®è¦å¤šï¼Œä½†æ— ç–‘å®ƒå±•ç¤ºäº† C++ è¯­è¨€çš„ä¸€äº›æ–°çš„å¯èƒ½æ€§ï¼Œå¹¶å¯ä»¥äº§ç”Ÿéå¸¸ç´§å‡‘çš„é«˜æ€§èƒ½ä»£ç ã€‚</p><h2>è¯¾åæ€è€ƒ</h2><p>ä½ æ€ä¹ˆçœ‹å¾… ranges å’Œå¯¹å®ƒçš„æ‰¹è¯„ï¼Ÿä½ ä¼šæƒ³ç”¨ ranges å—ï¼Ÿæ¬¢è¿ç•™è¨€ä¸æˆ‘äº¤æµã€‚</p><h2><span class=\"reference\">å‚è€ƒèµ„æ–™ </span></h2><p><span class=\"reference\">[1] Casey Carter et al., cmcstl2. <a href=\"https://github.com/CaseyCarter/cmcstl2\">https://github.com/CaseyCarter/cmcstl2</a> </span></p><p><span class=\"reference\">[2] å´å’ç‚œ, nvwa/functional.h. <a href=\"https://github.com/adah1972/nvwa/blob/master/nvwa/functional.h\">https://github.com/adah1972/nvwa/blob/master/nvwa/functional.h</a> </span></p><p><span class=\"reference\">[3] Eric Niebler, â€œStandard rangesâ€. <a href=\"http://ericniebler.com/2018/12/05/standard-ranges/\">http://ericniebler.com/2018/12/05/standard-ranges/</a> </span></p><p><span class=\"reference\">[4] Andrei Alexandrescu, â€œIterators must goâ€, <a href=\"http://accu.org/content/conf2009/AndreiAlexandrescu_iterators-must-go.pdf\">http://accu.org/content/conf2009/AndreiAlexandrescu_iterators-must-go.pdf</a> </span></p><p><span class=\"reference\">[5] Eric Niebler, range-v3. <a href=\"https://github.com/ericniebler/range-v3\">https://github.com/ericniebler/range-v3</a> </span></p><p><span class=\"reference\">[6] Eric Niebler and Casey Carter, â€œWorking draft, C++ extensions for rangesâ€. <a href=\"http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2015/n4560.pdf\">http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2015/n4560.pdf</a> </span></p><p><span class=\"reference\">[7] Eric Niebler, Casey Carter, and Christopher Di Bella, â€œThe one ranges proposalâ€.  <a href=\"http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/p0896r4.pdf\">http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/p0896r4.pdf</a> </span></p><p><span class=\"reference\">[8] Aras PranckeviÄius, â€œâ€Šâ€˜Modernâ€™ C++ lamentationsâ€. <a href=\"https://aras-p.info/blog/2018/12/28/Modern-C-Lamentations/\">https://aras-p.info/blog/2018/12/28/Modern-C-Lamentations/</a> ï¼›CSDN çš„ç¿»è¯‘è§ <a href=\"https://blog.csdn.net/csdnnews/article/details/86386281\">https://blog.csdn.net/csdnnews/article/details/86386281</a> </span></p>","neighbors":{"left":{"article_title":"28 | Conceptsï¼šå¦‚ä½•å¯¹æ¨¡æ¿è¿›è¡Œçº¦æŸ?","id":194005},"right":{"article_title":"30 | Coroutinesï¼šåä½œå¼çš„äº¤å‰è°ƒåº¦æ‰§è¡Œ","id":196785}},"comments":[{"had_liked":false,"id":176347,"user_name":"pedro","can_delete":false,"product_type":"c1","uid":1200704,"ip_address":"","ucode":"F40C839DDFD599","user_header":"https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg","comment_is_top":false,"comment_ctime":1581040057,"is_pvip":false,"replies":[{"id":"68482","content":"è¿™ä¸ªæˆ‘æ²¡æƒ³åˆ°å¾ˆç®€å•çš„è®²æ³•ã€‚<br><br>ä¸è¿‡ï¼ŒçœŸè¦ä»ç®€çš„è¯ï¼Œæœ€åŸºæœ¬çš„è¦æ±‚å°±æ˜¯ï¼Œä¸è¦ç”¨ newï¼Œä¸è¦ç”¨è£¸æŒ‡é’ˆï¼šä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆæ¥ä»£æ›¿ã€‚<br><br>æ­¤å¤–ï¼Œåœ¨ç”¨åˆ°è§†å›¾çš„æ—¶å€™ï¼ŒåŒ…æ‹¬ ranges é‡Œçš„è§†å›¾å’Œæ›´ç®€å•çš„æƒ…å†µå¦‚ string_viewï¼Œè¦ç¡®ä¿ä½¿ç”¨è§†å›¾æ—¶è§†å›¾ä½¿ç”¨çš„å¯¹è±¡ä¸€ç›´å­˜åœ¨ï¼Œæ²¡æœ‰è¢«æ„å¤–é”€æ¯ã€‚è§†å›¾ä¸ç®¡ç†å†…å­˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´å’ç‚œ","uid":"1645639","ctime":1581045328,"ip_address":"","comment_id":176347,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14465941945","product_id":100040501,"comment_content":"è€å¸ˆèƒ½è®²ä¸€è®²å…³äºc++å†…å­˜å®‰å…¨ç›¸å…³çš„ç¼–ç è§„èŒƒå’ŒæŠ€å·§å—ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªæˆ–è®¸æ‰æ˜¯å¾ˆå¤šåŒå­¦çš„åˆšéœ€","like_count":4,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483084,"discussion_content":"è¿™ä¸ªæˆ‘æ²¡æƒ³åˆ°å¾ˆç®€å•çš„è®²æ³•ã€‚\n\nä¸è¿‡ï¼ŒçœŸè¦ä»ç®€çš„è¯ï¼Œæœ€åŸºæœ¬çš„è¦æ±‚å°±æ˜¯ï¼Œä¸è¦ç”¨ newï¼Œä¸è¦ç”¨è£¸æŒ‡é’ˆï¼šä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆæ¥ä»£æ›¿ã€‚\n\næ­¤å¤–ï¼Œåœ¨ç”¨åˆ°è§†å›¾çš„æ—¶å€™ï¼ŒåŒ…æ‹¬ ranges é‡Œçš„è§†å›¾å’Œæ›´ç®€å•çš„æƒ…å†µå¦‚ string_viewï¼Œè¦ç¡®ä¿ä½¿ç”¨è§†å›¾æ—¶è§†å›¾ä½¿ç”¨çš„å¯¹è±¡ä¸€ç›´å­˜åœ¨ï¼Œæ²¡æœ‰è¢«æ„å¤–é”€æ¯ã€‚è§†å›¾ä¸ç®¡ç†å†…å­˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581045328,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":253105,"user_name":"Geek_a16bbc","can_delete":false,"product_type":"c1","uid":2008721,"ip_address":"","ucode":"6F12AFEF638413","user_header":"","comment_is_top":false,"comment_ctime":1602599951,"is_pvip":false,"replies":[{"id":"92482","content":"å¾ªç¯å±•å¼€åï¼Œä¼šæœ‰ç›¸å½“äºä¸‹é¢çš„è¡¨è¾¾å¼ï¼š<br><br>auto it = argv[1];<br>auto end = null_sentinel();<br>while (it != end) {<br>  â€¦<br>  ++it;<br>}<br><br>è¿™æ ·ä¸å°±ç”¨ä¸Šä¸Šé¢çš„ operator!= äº†ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"å´å’ç‚œ","uid":"1645639","ctime":1602635025,"ip_address":"","comment_id":253105,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5897567247","product_id":100040501,"comment_content":"template <br>bool operator!=(I i, null_sentinel)<br>{ return *i != 0;}<br><br>å¯ä»¥è«‹è€å¸«èªªæ˜ä¸€ä¸‹null_sentinelåœ¨é€™é‚Šçš„ä½œç”¨å—ï¼Ÿfunction bodyä¸¦æ²’æœ‰ç”¨åˆ°null_sentinel, null sentinelåªå‡ºç¾åœ¨input parameterä¸Šã€‚","like_count":2,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506975,"discussion_content":"å¾ªç¯å±•å¼€åï¼Œä¼šæœ‰ç›¸å½“äºä¸‹é¢çš„è¡¨è¾¾å¼ï¼š\n\nauto it = argv[1];\nauto end = null_sentinel();\nwhile (it != end) {\n  â€¦\n  ++it;\n}\n\nè¿™æ ·ä¸å°±ç”¨ä¸Šä¸Šé¢çš„ operator!= äº†ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602635025,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":177423,"user_name":"ä¸‰å‘³","can_delete":false,"product_type":"c1","uid":1362403,"ip_address":"","ucode":"A580F715D1CC96","user_header":"https://static001.geekbang.org/account/avatar/00/14/c9/e3/28c16afa.jpg","comment_is_top":false,"comment_ctime":1581390332,"is_pvip":false,"replies":[{"id":"68884","content":"çœ‹è¿™äº›å†…å®¹å¯¹ä½ æ½œåœ¨æ˜¯å¦æœ‰ç”¨å§ã€‚ï¼ˆæˆ‘ä¸æ˜¯åšå£«ï¼Œä¹Ÿä¸å–œæ¬¢å¤ªçƒ§è„‘çš„ä»£ç ã€‚ï¼‰<br><br>ä¸ªäººè®¤ä¸ºæ¦‚å¿µå¾ˆé‡è¦ï¼Œå¯èƒ½ä¼šæ”¹å˜å¤§å®¶å¯¹ C++ çš„å†™æ³•ã€‚åç¨‹å¯¹å¼‚æ­¥å¤„ç†å¾ˆé‡è¦ï¼Œçœ‹ä½ æ˜¯ä¸æ˜¯éœ€è¦äº†ã€‚èŒƒå›´æ˜¯ä¸ªå¥½ç©çš„ä¸œè¥¿ï¼Œä½†å¦‚æœå¯¹å®ƒä¸æ„Ÿå†’ï¼Œæ”¾ä¸€æ”¾å…³ç³»ä¹Ÿä¸å¤§ã€‚<br><br>å¦å¤–ï¼Œé‚£ç¯‡æ–‡ç« çš„ä½œè€…çš„æªè¾æ˜¯â€œåƒæˆ‘ä»¬ä¸€æ ·çš„æ²¡æœ‰C++åšå£«å­¦ä½çš„å‡¡äººâ€ï¼Œå“ˆå“ˆã€‚è€Œä¸”ï¼Œä»–ä¹Ÿè¯´â€œâ€˜coroutinesâ€™æ–¹æ³•æ›´æ¸…æ™°â€ã€‚<br><br>å‡ºäºå¥½å¥‡ï¼Œæˆ‘åˆå»æŸ¥äº†ä¸‹ Eric Niebler çš„ç®€å†ï¼Œç»“æœå‘ç°ä»–ä¹Ÿä¸æ˜¯åšå£«ã€‚ä»–ç”šè‡³ä¸æ˜¯è®¡ç®—æœºç³»æ¯•ä¸šçš„ï¼ˆè€Œæ˜¯æœºæ¢°å·¥ç¨‹ï¼‰ã€‚ä½†ä»–åœ¨ C++ ä¸Šæµ¸æ·«çš„æ—¶é—´å°±é•¿äº†ï¼ˆ96 å¹´æ¯•ä¸šç›´æ¥å»äº†å¾®è½¯ Visual C++ ç»„ï¼‰ï¼Œè€Œä¸”ä»–è¿˜å–œæ¬¢å‡½æ•°å¼ç¼–ç¨‹ã€‚ä»–è®¤ä¸ºå®¹æ˜“çš„ä¸œè¥¿ï¼Œåˆ«äººç†è§£æœ‰å›°éš¾ï¼Œä¹Ÿä¸ç®—å¾ˆä¸æ­£å¸¸äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´å’ç‚œ","uid":"1645639","ctime":1581400477,"ip_address":"","comment_id":177423,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5876357628","product_id":100040501,"comment_content":"emmmmmmm... <br>æœ€åæåˆ°çš„è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä¹‹å‰çœ‹åˆ°è¿‡ï¼Œå°è±¡æœ€æ·±åˆ»çš„ä¸€å¥è¯å°±æ˜¯ï¼Œæ²¡æœ‰C++åšå£«å­¦ä½è¿˜æƒ³å†™C++ï¼Ÿ<br>æœ€è¿‘çš„æœªæ¥ç¯‡ä¸‰ç¯‡æˆ‘åŸºæœ¬ä¸Šéƒ½æ˜¯èµ°é©¬è§‚èŠ±çš„åœ¨çœ‹ã€‚ã€‚å¯¹æˆ‘ä¸ªäººæ¥è¯´ï¼Œæ„Ÿè§‰æ”¶ç›Šå’Œå­¦ä¹ æˆæœ¬æ¯”å€¼æœ‰ç‚¹å°ï¼Œæ ¹æ®ä»¥å¾€ç»éªŒï¼ŒC++20è¦æƒ³å…¨é¢å¼€èŠ±ï¼Œè¿˜æœ‰å¥½å‡ å¹´çš„è·¯è¦èµ°ã€‚ã€‚<br>æ„Ÿè§‰C++11ä¹Ÿæ˜¯åˆ°äº†C++14æ‰ç®—æ˜¯ç¨³å®šç‚¹ã€‚ã€‚è‡³å°‘ç»™æˆ‘çš„æ„Ÿè§‰ï¼Œç›´åˆ°C++17éƒ½æ˜¯åœ¨å¯¹C++11è¿›è¡Œä¿®è¡¥ã€‚<br>æ‰€ä»¥ï¼Œè¿™ä¸‰è®²ä¸€å¹´åæˆ‘å†å›æ¥å¥½å¥½å­¦ä¹ å§ï¼æœ¬æ¥æˆ‘çš„ä¸»ä¸šæ˜¯å›¾å½¢","like_count":2,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483421,"discussion_content":"çœ‹è¿™äº›å†…å®¹å¯¹ä½ æ½œåœ¨æ˜¯å¦æœ‰ç”¨å§ã€‚ï¼ˆæˆ‘ä¸æ˜¯åšå£«ï¼Œä¹Ÿä¸å–œæ¬¢å¤ªçƒ§è„‘çš„ä»£ç ã€‚ï¼‰\n\nä¸ªäººè®¤ä¸ºæ¦‚å¿µå¾ˆé‡è¦ï¼Œå¯èƒ½ä¼šæ”¹å˜å¤§å®¶å¯¹ C++ çš„å†™æ³•ã€‚åç¨‹å¯¹å¼‚æ­¥å¤„ç†å¾ˆé‡è¦ï¼Œçœ‹ä½ æ˜¯ä¸æ˜¯éœ€è¦äº†ã€‚èŒƒå›´æ˜¯ä¸ªå¥½ç©çš„ä¸œè¥¿ï¼Œä½†å¦‚æœå¯¹å®ƒä¸æ„Ÿå†’ï¼Œæ”¾ä¸€æ”¾å…³ç³»ä¹Ÿä¸å¤§ã€‚\n\nå¦å¤–ï¼Œé‚£ç¯‡æ–‡ç« çš„ä½œè€…çš„æªè¾æ˜¯â€œåƒæˆ‘ä»¬ä¸€æ ·çš„æ²¡æœ‰C++åšå£«å­¦ä½çš„å‡¡äººâ€ï¼Œå“ˆå“ˆã€‚è€Œä¸”ï¼Œä»–ä¹Ÿè¯´â€œâ€˜coroutinesâ€™æ–¹æ³•æ›´æ¸…æ™°â€ã€‚\n\nå‡ºäºå¥½å¥‡ï¼Œæˆ‘åˆå»æŸ¥äº†ä¸‹ Eric Niebler çš„ç®€å†ï¼Œç»“æœå‘ç°ä»–ä¹Ÿä¸æ˜¯åšå£«ã€‚ä»–ç”šè‡³ä¸æ˜¯è®¡ç®—æœºç³»æ¯•ä¸šçš„ï¼ˆè€Œæ˜¯æœºæ¢°å·¥ç¨‹ï¼‰ã€‚ä½†ä»–åœ¨ C++ ä¸Šæµ¸æ·«çš„æ—¶é—´å°±é•¿äº†ï¼ˆ96 å¹´æ¯•ä¸šç›´æ¥å»äº†å¾®è½¯ Visual C++ ç»„ï¼‰ï¼Œè€Œä¸”ä»–è¿˜å–œæ¬¢å‡½æ•°å¼ç¼–ç¨‹ã€‚ä»–è®¤ä¸ºå®¹æ˜“çš„ä¸œè¥¿ï¼Œåˆ«äººç†è§£æœ‰å›°éš¾ï¼Œä¹Ÿä¸ç®—å¾ˆä¸æ­£å¸¸äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581400477,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":176605,"user_name":"Sochooligan","can_delete":false,"product_type":"c1","uid":1318528,"ip_address":"","ucode":"B66F78B6B86476","user_header":"https://static001.geekbang.org/account/avatar/00/14/1e/80/e409fff6.jpg","comment_is_top":false,"comment_ctime":1581099325,"is_pvip":false,"replies":[{"id":"68563","content":"å¤šçœ‹ä¸¤éã€‚ranges å’Œ concepts å¯¹äºä¸€èˆ¬çš„å¼€å‘è€…æ¥è¯´åº”å½“æ˜¯å¾ˆæ–°çš„ä¸œè¥¿ï¼Œæˆ‘è‡ªå·±ä¹Ÿå­¦ä¹ äº†å¾ˆå¤šéï¼Œè¸©äº†å¾ˆå¤šå‘ã€‚<br><br>äºŒ(1) åŠ è¡Œå·è¯´æ˜æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œæˆ‘æ”¹ä¸€ä¸‹å§ã€‚äºŒ(2) ä¸¤å¯ä¹‹é—´çš„ï¼Œå°±ä¸åŠ¨äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´å’ç‚œ","uid":"1645639","ctime":1581131398,"ip_address":"","comment_id":176605,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5876066621","product_id":100040501,"comment_content":"ä¸€ã€çœ‹å¾—äº‘é‡Œé›¾é‡Œåœ°ï¼Œå¥½çš„æ–¹é¢æ˜¯æ‰€æœ‰ä¾‹å­éƒ½è¿è¡Œäº†ã€‚<br>äºŒã€å‘ç°ä¸¤å¤„åˆ†å¿ƒçš„åœ°æ–¹ï¼š<br>ï¼ˆ1ï¼‰æˆ‘ä»¬å¯ä»¥åœ¨è¾“å‡º r ä¹‹å‰æ’å…¥ä¸‹é¢è¿™è¡Œï¼š <br>æˆ‘ä»¬å¯ä»¥åœ¨è¾“å‡º r ä¹‹å‰ï¼ˆ15è¡Œä¹‹åï¼Œ16è¡Œä¹‹å‰ï¼‰æ’å…¥ä¸‹é¢è¿™è¡Œï¼š<br>ï¼ˆ2ï¼‰é™¤äº† viewï¼Œvector æ»¡è¶³æ‰€æœ‰çš„ range æ¦‚å¿µã€‚<br>vector æ»¡è¶³é™¤viewå¤–æ‰€æœ‰çš„ range æ¦‚å¿µã€‚<br>ä¸‰ã€æˆ‘çš„ç¯å¢ƒæ˜¯ macOS+vscode+gcc9.2.0_3(Target: x86_64-apple-darwin19) +gdb8.3","like_count":2,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483159,"discussion_content":"å¤šçœ‹ä¸¤éã€‚ranges å’Œ concepts å¯¹äºä¸€èˆ¬çš„å¼€å‘è€…æ¥è¯´åº”å½“æ˜¯å¾ˆæ–°çš„ä¸œè¥¿ï¼Œæˆ‘è‡ªå·±ä¹Ÿå­¦ä¹ äº†å¾ˆå¤šéï¼Œè¸©äº†å¾ˆå¤šå‘ã€‚\n\näºŒ(1) åŠ è¡Œå·è¯´æ˜æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œæˆ‘æ”¹ä¸€ä¸‹å§ã€‚äºŒ(2) ä¸¤å¯ä¹‹é—´çš„ï¼Œå°±ä¸åŠ¨äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581131398,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":183921,"user_name":"çš®çš®ä¾ ","can_delete":false,"product_type":"c1","uid":1258402,"ip_address":"","ucode":"04205990C1DE1F","user_header":"https://static001.geekbang.org/account/avatar/00/13/33/a2/6c0ffc15.jpg","comment_is_top":false,"comment_ctime":1583162449,"is_pvip":false,"replies":[{"id":"71291","content":"å“ˆå“ˆğŸ˜‡","user_name":"ä½œè€…å›å¤","user_name_real":"å´å’ç‚œ","uid":"1645639","ctime":1583280026,"ip_address":"","comment_id":183921,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1583162449","product_id":100040501,"comment_content":"æˆ‘å¤§æ¦‚èƒ½ç†è§£Bjarne Stroustrupæœ€å–œæ¬¢çš„C++ç‰¹æ€§ä¸ºä½•æœ‰concepts:åœ¨é«˜åº¦ç»Ÿä¸€çš„æŠ½è±¡ä¸­å»ç¹å°±ç®€ã€‚ä¹Ÿåœ¨ç½‘ä¸Šçœ‹äº†äº›å¯¹C++20ä¸­Rangesçš„åå¯¹æ„è§ï¼Œä½†æˆ‘çœ‹åˆ°å¾ˆå¤šæ¸¸æˆå¼€å‘è€…å€’å¾ˆå–œæ¬¢è¿™äº›æ–°åŠŸèƒ½ï¼Œæ„Ÿè§‰å¤§å¤šå®¹å™¨éƒ½èƒ½ç”¨rangesï¼›ï¼‰å¬è€å¸ˆè¯»çš„é‚£æ®µï¼ŒçœŸæ˜¯æ¿€æƒ…æ¾æ¹ƒï¼Œé­…åŠ›å››å°„ï¼","like_count":0,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485822,"discussion_content":"å“ˆå“ˆğŸ˜‡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583280026,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}