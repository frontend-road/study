{"id":108205,"title":"20 | 为什么框架层就要考虑分环境配置？","content":"<ul>\n<li>\n<p>代码：<a href=\"https://gitee.com/geektime-geekbang/staffjoy\">https://gitee.com/geektime-geekbang/staffjoy</a></p>\n</li>\n<li>\n<p>课件：<a href=\"https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ\">https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ</a> 提取码: 1aeh</p>\n</li>\n</ul>","comments":[{"had_liked":false,"id":116113,"user_name":"大维","can_delete":false,"product_type":"c3","uid":1129620,"ip_address":"","ucode":"5FEAF1F0B48876","user_header":"https://static001.geekbang.org/account/avatar/00/11/3c/94/932231c2.jpg","comment_is_top":false,"comment_ctime":1563788085,"is_pvip":false,"replies":[{"id":42449,"content":"EnvConfig里头配置是每个环境已经明确下来的配置(一般不变)，比如根域名信息，是否启用https等。application.yaml一般放各个环境的可变配置，比方说jwt secret，DB链接字符串，这些可能会变。当然这个只是一种做法，实际EnvConfig里头的配置也可以都放在application.yaml里头，可以灵活，不必拘泥于形式。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1563800518,"ip_address":"","comment_id":116113,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"波波老师，你这个EnvConfig的多配置设置，和采用springboot的application.yaml(dev&#47;test&#47;uat&#47;prod)的多配置有什么不同呢？","like_count":7,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459389,"discussion_content":"EnvConfig里头配置是每个环境已经明确下来的配置(一般不变)，比如根域名信息，是否启用https等。application.yaml一般放各个环境的可变配置，比方说jwt secret，DB链接字符串，这些可能会变。当然这个只是一种做法，实际EnvConfig里头的配置也可以都放在application.yaml里头，可以灵活，不必拘泥于形式。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563800518,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115753,"user_name":"superFan","can_delete":false,"product_type":"c3","uid":1103116,"ip_address":"","ucode":"AA0FFEF391488D","user_header":"https://static001.geekbang.org/account/avatar/00/10/d5/0c/8dd1791d.jpg","comment_is_top":false,"comment_ctime":1563718818,"is_pvip":false,"replies":[{"id":42456,"content":"1. service层的操作用try-catch包起来，很正常，生产级代码通常有很多做错误处理的代码，错误处理的原则是尽早捕获和处理，实际运行时，不出错的话，这些try-catch没有多少额外开销，出错抛异常有一定开销，但这个是必须的。当然，你也可以不捕获直接往外抛，但是有悖于尽早捕获和处理原则。\n2. 会出现auditLog没有记录情况，所以一般业务操作完成就要记审计日志，另外如果因为提前抛了异常而漏掉审计日志的话，事后可以通过错误日志进行追溯，另外一般还有DB操作日志可以追溯。\n3. 代码是教学参考用，可以作为样板，具体生产使用你仍然需要严格测试+扩展。\n4. 除了staffjoy项目可以参考，另外最近看的这个litemall(https:&#47;&#47;github.com&#47;linlinjava&#47;litemall)也不错，SpringBoot开发的前后分离商城项目，后面我考虑将其改造成类似Staffjoy的微服务云原生项目，欢迎也同时关注。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1563801245,"ip_address":"","comment_id":115753,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"bobo老师:\n    我阅读你在github上的代码上有几个疑问:\n    1.service层的数据库操作基本上都使用了try-catch,实际业务开发也是这样的么,会不会有性能开销;\n    2.service层 业务处理完后再记录auditLog,会不会存在业务处理完了,但auditLog没有记录的情况,如果有,应该怎么处理;\n   3.老师提供的代码在生产环境中可以使用么,还只是教学用的代码;\n   4.现在想做一个springboot的脚手架工程,用于在项目开发中使用,有没有推荐的开源项目list","like_count":5,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459270,"discussion_content":"1. service层的操作用try-catch包起来，很正常，生产级代码通常有很多做错误处理的代码，错误处理的原则是尽早捕获和处理，实际运行时，不出错的话，这些try-catch没有多少额外开销，出错抛异常有一定开销，但这个是必须的。当然，你也可以不捕获直接往外抛，但是有悖于尽早捕获和处理原则。\n2. 会出现auditLog没有记录情况，所以一般业务操作完成就要记审计日志，另外如果因为提前抛了异常而漏掉审计日志的话，事后可以通过错误日志进行追溯，另外一般还有DB操作日志可以追溯。\n3. 代码是教学参考用，可以作为样板，具体生产使用你仍然需要严格测试+扩展。\n4. 除了staffjoy项目可以参考，另外最近看的这个litemall(https://github.com/linlinjava/litemall)也不错，SpringBoot开发的前后分离商城项目，后面我考虑将其改造成类似Staffjoy的微服务云原生项目，欢迎也同时关注。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563801245,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114693,"user_name":"而立斋","can_delete":false,"product_type":"c3","uid":1087258,"ip_address":"","ucode":"5FED6E9E148195","user_header":"https://static001.geekbang.org/account/avatar/00/10/97/1a/389eab84.jpg","comment_is_top":false,"comment_ctime":1563364965,"is_pvip":false,"replies":[{"id":41854,"content":"有能力可以直接阅读课程案例项目源码，然后带着问题再看课程，这样效果更好。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1563367299,"ip_address":"","comment_id":114693,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"我要赶紧把代码拉下来好好读读","like_count":4,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458781,"discussion_content":"有能力可以直接阅读课程案例项目源码，然后带着问题再看课程，这样效果更好。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563367299,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114397,"user_name":"mo","can_delete":false,"product_type":"c3","uid":1046695,"ip_address":"","ucode":"D83F76BDDD1F9F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/a7/480e5366.jpg","comment_is_top":false,"comment_ctime":1563289620,"is_pvip":false,"replies":[{"id":41843,"content":"你好，课程设计重点是微服务和云原生架构，也包括SpringBoot微服务开发和K8s容器云部署，课程案例本身是一个支持多租户的SaaS应用，所以课程稍带也讲解一些多租户和SaaS架构相关内容。anyway，谢谢你的反馈，请看完完整课程后再次给出反馈，谢谢！","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1563364333,"ip_address":"","comment_id":114397,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"额 感觉内容和标题所说的有点差异，看到现在都没有说到saas的架构思想。都是些好浅的知识点 希望多说说有关saas的思想以及落地 谢谢","like_count":4,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458643,"discussion_content":"你好，课程设计重点是微服务和云原生架构，也包括SpringBoot微服务开发和K8s容器云部署，课程案例本身是一个支持多租户的SaaS应用，所以课程稍带也讲解一些多租户和SaaS架构相关内容。anyway，谢谢你的反馈，请看完完整课程后再次给出反馈，谢谢！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563364333,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114829,"user_name":"John","can_delete":false,"product_type":"c3","uid":1020861,"ip_address":"","ucode":"E4ADF8488953FB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/93/bd/f3977ebb.jpg","comment_is_top":false,"comment_ctime":1563413148,"is_pvip":false,"replies":[{"id":41972,"content":"嗯，波波一直在努力输出干货，不能保证每一课都满足你的需要，但是全部听完课程，相信一定会让你有所收获。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1563455634,"ip_address":"","comment_id":114829,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"前面20講鋪墊的都很好啊 這個節奏也剛剛好 到此為止 外圍的事都說的差不多了 期待著波波後面投大乾貨","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458833,"discussion_content":"嗯，波波一直在努力输出干货，不能保证每一课都满足你的需要，但是全部听完课程，相信一定会让你有所收获。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563455634,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":280146,"user_name":"IKKI","can_delete":false,"product_type":"c3","uid":1083475,"ip_address":"","ucode":"AD2A05B08C04BE","user_header":"https://static001.geekbang.org/account/avatar/00/10/88/53/6878d04b.jpg","comment_is_top":false,"comment_ctime":1614093626,"is_pvip":false,"replies":[{"id":101781,"content":"不同环境的配置可以集中到配置中心去，但是本地还是需要一些配置文件(或者环境变量)，来标识当前这个应用的环境信息，这样这个应用才能到配置中心去获取当前环境的配置。\n\n本课程的项目的有些环境信息是编码在代码中的，这个只是课程设计的一种简单做法，实际可以将配置信息尽可能变成配置文件(本地+远程)，这样在实际生产中会更灵活。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1614180151,"ip_address":"","comment_id":280146,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"这种配置为啥不集中到配置中心?","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":515995,"discussion_content":"不同环境的配置可以集中到配置中心去，但是本地还是需要一些配置文件(或者环境变量)，来标识当前这个应用的环境信息，这样这个应用才能到配置中心去获取当前环境的配置。\n\n本课程的项目的有些环境信息是编码在代码中的，这个只是课程设计的一种简单做法，实际可以将配置信息尽可能变成配置文件(本地+远程)，这样在实际生产中会更灵活。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614180151,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":241504,"user_name":"IF-Processing","can_delete":false,"product_type":"c3","uid":1205736,"ip_address":"","ucode":"8298C3C9320D94","user_header":"https://static001.geekbang.org/account/avatar/00/12/65/e8/d1e52dbb.jpg","comment_is_top":false,"comment_ctime":1597313312,"is_pvip":true,"replies":[{"id":89246,"content":"硬编码是最差的，其次是本地文件配置，配置中心统一管理最好。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1597416120,"ip_address":"","comment_id":241504,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"求教，如果使用类似于配置中心的方式进行配置，是不是会比硬编码到代码中更理想些呢，代码是不是与环境无关更好些","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503753,"discussion_content":"硬编码是最差的，其次是本地文件配置，配置中心统一管理最好。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597416120,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":188337,"user_name":"钱","can_delete":false,"product_type":"c3","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1584342306,"is_pvip":false,"replies":[{"id":72894,"content":"课程案例是有些硬编码的，也可以做到不硬编码，通过配置适配不同环境，具体看业务需要。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1584441410,"ip_address":"","comment_id":188337,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"环境隔离确实重要，免得互相影响，不过这种硬编码的隔离方式在什么时候方便调整控制？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487382,"discussion_content":"课程案例是有些硬编码的，也可以做到不硬编码，通过配置适配不同环境，具体看业务需要。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584441410,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":170641,"user_name":"旺","can_delete":false,"product_type":"c3","uid":1222045,"ip_address":"","ucode":"3D372AF2365845","user_header":"https://static001.geekbang.org/account/avatar/00/12/a5/9d/ace14b82.jpg","comment_is_top":false,"comment_ctime":1578649104,"is_pvip":false,"replies":[{"id":66437,"content":"课程项目只是演示，实际生产项目中，需要配合一些配置治理流程，防止敏感配置信息意外泄露。比方说，k8s config&#47;secret需由专门的管理员统一管理和发布，配置的版本控制需要严格权限管理。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1578916620,"ip_address":"","comment_id":170641,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"波波老师好，这样直接在项目中写生产的各种配置，会不会导致敏感信息泄露呢","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481050,"discussion_content":"课程项目只是演示，实际生产项目中，需要配合一些配置治理流程，防止敏感配置信息意外泄露。比方说，k8s config/secret需由专门的管理员统一管理和发布，配置的版本控制需要严格权限管理。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578916620,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":153779,"user_name":"水浒山鬼","can_delete":false,"product_type":"c3","uid":1748665,"ip_address":"","ucode":"1FD5C5C8F40050","user_header":"https://static001.geekbang.org/account/avatar/00/1a/ae/b9/05de50a7.jpg","comment_is_top":false,"comment_ctime":1574305808,"is_pvip":false,"replies":[{"id":59149,"content":"要一分为二看，如果是开源的通用框架，当然不能和环境耦合，但是对于企业的具体应用来说，因为企业的环境一般是固定的，所以对框架进行定制，并且引入一些环境判断逻辑，让应用能更灵活适配环境，有时是难免的。通用性和企业定制(引入一定耦合性)一般很难两全，需要折衷权衡。至于对代码可维护性的影响肯定会有一点，但是抽象通用的成本可能更高。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1574340803,"ip_address":"","comment_id":153779,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"如果在开发时使用逻辑控制不同生产部署环境下的处理分支。这些代码会不会遗留在项目代码中？会不会对代码维护产生影响？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475270,"discussion_content":"要一分为二看，如果是开源的通用框架，当然不能和环境耦合，但是对于企业的具体应用来说，因为企业的环境一般是固定的，所以对框架进行定制，并且引入一些环境判断逻辑，让应用能更灵活适配环境，有时是难免的。通用性和企业定制(引入一定耦合性)一般很难两全，需要折衷权衡。至于对代码可维护性的影响肯定会有一点，但是抽象通用的成本可能更高。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574340803,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115543,"user_name":"海水","can_delete":false,"product_type":"c3","uid":1191244,"ip_address":"","ucode":"68D7E454CC0819","user_header":"https://static001.geekbang.org/account/avatar/00/12/2d/4c/983ce1b9.jpg","comment_is_top":false,"comment_ctime":1563615669,"is_pvip":true,"replies":[{"id":42264,"content":"谢谢支持！继续努力输出干货，提升大家的技术视野和能力！","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1563713372,"ip_address":"","comment_id":115543,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100031401,"comment_content":"今天一口气把前面的课不上了，期待波波老师下面精彩的干货！","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459151,"discussion_content":"谢谢支持！继续努力输出干货，提升大家的技术视野和能力！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563713372,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}