{"id":239176,"title":"11 | å¦‚ä½•ä¿®æ”¹TCPç¼“å†²åŒºæ‰èƒ½å…¼é¡¾å¹¶å‘æ•°é‡ä¸ä¼ è¾“é€Ÿåº¦ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯é™¶è¾‰ã€‚</p><p>æˆ‘ä»¬åœ¨<a href=\"https://time.geekbang.org/column/article/236921\">[ç¬¬8è¯¾]</a> ä¸­è®²äº†å¦‚ä½•ä»C10Kè¿›ä¸€æ­¥åˆ°C10Mï¼Œä¸è¿‡ï¼Œè¿™ä¹Ÿæ„å‘³ç€TCPå ç”¨çš„å†…å­˜ç¿»äº†ä¸€åƒå€ï¼ŒæœåŠ¡å™¨çš„å†…å­˜èµ„æºä¼šéå¸¸ç´§å¼ ã€‚</p><p>å¦‚æœä½ åœ¨Linuxç³»ç»Ÿä¸­ç”¨freeå‘½ä»¤æŸ¥çœ‹å†…å­˜å ç”¨æƒ…å†µï¼Œä¼šå‘ç°ä¸€æ å«åšbuff/cacheï¼Œå®ƒæ˜¯ç³»ç»Ÿå†…å­˜ï¼Œä¼¼ä¹ä¸åº”ç”¨è¿›ç¨‹æ— å…³ã€‚ä½†æ¯å½“è¿›ç¨‹æ–°å»ºä¸€ä¸ªTCPè¿æ¥ï¼Œbuff/cacheä¸­çš„å†…å­˜éƒ½ä¼šä¸Šå‡4Kå·¦å³ã€‚è€Œä¸”ï¼Œå½“è¿æ¥ä¼ è¾“æ•°æ®æ—¶ï¼Œå°±è¿œä¸æ­¢å¢åŠ 4Kå†…å­˜äº†ã€‚è¿™æ ·ï¼Œå‡ åä¸‡å¹¶å‘è¿æ¥ï¼Œå°±åœ¨è¿›ç¨‹å†…å­˜å¤–åˆå¢åŠ äº†GBçº§åˆ«çš„ç³»ç»Ÿå†…å­˜æ¶ˆè€—ã€‚</p><p>è¿™æ˜¯å› ä¸ºTCPè¿æ¥æ˜¯ç”±å†…æ ¸ç»´æŠ¤çš„ï¼Œå†…æ ¸ä¸ºæ¯ä¸ªè¿æ¥å»ºç«‹çš„å†…å­˜ç¼“å†²åŒºï¼Œæ—¢è¦ä¸ºç½‘ç»œä¼ è¾“æœåŠ¡ï¼Œä¹Ÿè¦å……å½“è¿›ç¨‹ä¸ç½‘ç»œé—´çš„ç¼“å†²æ¡¥æ¢ã€‚å¦‚æœè¿æ¥çš„å†…å­˜é…ç½®è¿‡å°ï¼Œå°±æ— æ³•å……åˆ†ä½¿ç”¨ç½‘ç»œå¸¦å®½ï¼ŒTCPä¼ è¾“é€Ÿåº¦å°±ä¼šå¾ˆæ…¢ï¼›å¦‚æœè¿æ¥çš„å†…å­˜é…ç½®è¿‡å¤§ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å†…å­˜ä¼šå¾ˆå¿«ç”¨å°½ï¼Œæ–°è¿æ¥å°±æ— æ³•å»ºç«‹æˆåŠŸã€‚å› æ­¤ï¼Œåªæœ‰æ·±å…¥ç†è§£Linuxä¸‹TCPå†…å­˜çš„ç”¨é€”ï¼Œæ‰èƒ½æ­£ç¡®åœ°é…ç½®å†…å­˜å¤§å°ã€‚</p><p>è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹ï¼ŒLinuxä¸‹çš„TCPç¼“å†²åŒºè¯¥å¦‚ä½•ä¿®æ”¹ï¼Œæ‰èƒ½åœ¨é«˜å¹¶å‘ä¸‹ç»´æŒTCPçš„é«˜é€Ÿä¼ è¾“ã€‚</p><h2>æ»‘åŠ¨çª—å£æ˜¯æ€æ ·å½±å“ä¼ è¾“é€Ÿåº¦çš„ï¼Ÿ</h2><p>æˆ‘ä»¬çŸ¥é“ï¼ŒTCPå¿…é¡»ä¿è¯æ¯ä¸€ä¸ªæŠ¥æ–‡éƒ½èƒ½å¤Ÿåˆ°è¾¾å¯¹æ–¹ï¼Œå®ƒé‡‡ç”¨çš„æœºåˆ¶å°±æ˜¯ï¼šæŠ¥æ–‡å‘å‡ºåï¼Œå¿…é¡»æ”¶åˆ°æ¥æ”¶æ–¹è¿”å›çš„ACKç¡®è®¤æŠ¥æ–‡ï¼ˆAcknowledgeç¡®è®¤çš„æ„æ€ï¼‰ã€‚å¦‚æœåœ¨ä¸€æ®µæ—¶é—´å†…ï¼ˆç§°ä¸ºRTOï¼Œretransmission timeoutï¼‰æ²¡æœ‰æ”¶åˆ°ï¼Œè¿™ä¸ªæŠ¥æ–‡è¿˜å¾—é‡æ–°å‘é€ï¼Œç›´åˆ°æ”¶åˆ°ACKä¸ºæ­¢ã€‚</p><!-- [[[read_end]]] --><p><strong>å¯è§ï¼ŒTCPæŠ¥æ–‡å‘å‡ºå»åï¼Œå¹¶ä¸èƒ½ç«‹åˆ»ä»å†…å­˜ä¸­åˆ é™¤ï¼Œå› ä¸ºé‡å‘æ—¶è¿˜éœ€è¦ç”¨åˆ°å®ƒã€‚</strong>ç”±äºTCPæ˜¯ç”±å†…æ ¸å®ç°çš„ï¼Œæ‰€ä»¥æŠ¥æ–‡å­˜æ”¾åœ¨å†…æ ¸ç¼“å†²åŒºä¸­ï¼Œè¿™ä¹Ÿæ˜¯é«˜å¹¶å‘ä¸‹buff/cacheå†…å­˜å¢åŠ å¾ˆå¤šçš„åŸå› ã€‚</p><p>äº‹å®ä¸Šï¼Œç¡®è®¤æŠ¥æ–‡è¢«æ”¶åˆ°çš„æœºåˆ¶éå¸¸å¤æ‚ï¼Œå®ƒå—åˆ¶äºå¾ˆå¤šå› ç´ ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªå› ç´ ï¼Œ<strong>é€Ÿåº¦</strong>ã€‚</p><p>å¦‚æœæˆ‘ä»¬å‘é€ä¸€ä¸ªæŠ¥æ–‡ï¼Œæ”¶åˆ°ACKç¡®è®¤åï¼Œå†å‘é€ä¸‹ä¸€ä¸ªæŠ¥æ–‡ï¼Œä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿæ˜¾ç„¶ï¼Œå‘é€æ¯ä¸ªæŠ¥æ–‡éƒ½éœ€è¦ç»å†ä¸€ä¸ªRTTæ—¶å»¶ï¼ˆRTTçš„å€¼å¯ä»¥ç”¨pingå‘½ä»¤å¾—åˆ°ï¼‰ã€‚è¦çŸ¥é“ï¼Œå› ä¸ºç½‘ç»œè®¾å¤‡é™åˆ¶äº†æŠ¥æ–‡çš„å­—èŠ‚æ•°ï¼Œæ‰€ä»¥æ¯ä¸ªæŠ¥æ–‡çš„ä½“ç§¯æœ‰é™ã€‚</p><p>æ¯”å¦‚ï¼Œä»¥å¤ªç½‘æŠ¥æ–‡æœ€å¤§åªæœ‰1500å­—èŠ‚ï¼Œè€Œå‘é€ä¸»æœºåˆ°æ¥æ”¶ä¸»æœºé—´ï¼Œè¦ç»å†å¤šä¸ªå¹¿åŸŸç½‘ã€å±€åŸŸç½‘ï¼Œå…¶ä¸­æœ€å°çš„è®¾å¤‡å†³å®šäº†ç½‘ç»œæŠ¥æ–‡çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œåœ¨TCPä¸­ï¼Œè¿™ä¸ªå€¼å«åšMSSï¼ˆMaximum Segment Sizeï¼‰ï¼Œå®ƒé€šå¸¸åœ¨1KBå·¦å³ã€‚å¦‚æœRTTæ—¶å»¶æ˜¯10msï¼Œé‚£ä¹ˆå®ƒä»¬çš„ä¼ é€é€Ÿåº¦æœ€å¤šåªæœ‰1KB/10ms=100KB/sï¼å¯è§ï¼Œè¿™ç§ç¡®è®¤æŠ¥æ–‡æ–¹å¼å¤ªå½±å“ä¼ è¾“é€Ÿåº¦äº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/8c/a8/8c97985f1ed742b458d0c00c3155aba8.png?wh=1081*735\" alt=\"\"></p><p><strong>æé€Ÿçš„æ–¹å¼å¾ˆç®€å•ï¼Œå¹¶è¡Œåœ°æ‰¹é‡å‘é€æŠ¥æ–‡ï¼Œå†æ‰¹é‡ç¡®è®¤æŠ¥æ–‡å³å¯ã€‚</strong>æ¯”å¦‚ï¼Œå‘é€ä¸€ä¸ª100MBçš„æ–‡ä»¶ï¼Œå¦‚æœMSSå€¼ä¸º1KBï¼Œé‚£ä¹ˆéœ€è¦å‘é€çº¦10ä¸‡ä¸ªæŠ¥æ–‡ã€‚å‘é€æ–¹å¤§å¯ä»¥åŒæ—¶å‘é€è¿™10ä¸‡ä¸ªæŠ¥æ–‡ï¼Œå†ç­‰å¾…å®ƒä»¬çš„ACKç¡®è®¤ã€‚è¿™æ ·ï¼Œå‘é€é€Ÿåº¦ç¬é—´å°±è¾¾åˆ°100MB/10ms=10GB/sã€‚</p><p>ç„¶è€Œï¼Œè¿™å¼•å‡ºäº†å¦ä¸€ä¸ªé—®é¢˜ï¼Œæ¥æ”¶æ–¹æœ‰é‚£ä¹ˆå¼ºçš„å¤„ç†èƒ½åŠ›å—ï¼Ÿ<strong>æ¥æ”¶æ–¹çš„å¤„ç†èƒ½åŠ›</strong>ï¼Œè¿™æ˜¯å½±å“ç¡®è®¤æœºåˆ¶çš„ç¬¬äºŒä¸ªå› ç´ ï¼ˆç½‘ç»œä¹Ÿæ²¡æœ‰è¿™ä¹ˆå¼ºçš„å¤„ç†èƒ½åŠ›ï¼Œä¸‹ä¸€è®²ä¼šä»‹ç»åº”å¯¹ç½‘ç»œç“¶é¢ˆçš„æ‹¥å¡æ§åˆ¶æŠ€æœ¯ï¼‰ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f9/85/f9e14ba29407da48bf55a7c24c7af585.png?wh=1075*738\" alt=\"\"></p><p>å½“æ¥æ”¶æ–¹ç¡¬ä»¶ä¸å¦‚å‘é€æ–¹ï¼Œæˆ–è€…ç³»ç»Ÿç¹å¿™ã€èµ„æºç´§å¼ æ—¶ï¼Œæ˜¯æ— æ³•ç¬é—´å¤„ç†è¿™ä¹ˆå¤šæŠ¥æ–‡çš„ã€‚äºæ˜¯ï¼Œè¿™äº›æŠ¥æ–‡åªèƒ½è¢«ä¸¢æ‰ï¼Œç½‘ç»œæ•ˆç‡éå¸¸ä½ã€‚æ€ä¹ˆé™åˆ¶å‘é€æ–¹çš„é€Ÿåº¦å‘¢ï¼Ÿ</p><p><strong>æ¥æ”¶æ–¹æŠŠå®ƒçš„å¤„ç†èƒ½åŠ›å‘Šè¯‰å‘é€æ–¹ï¼Œä½¿å…¶é™åˆ¶å‘é€é€Ÿåº¦å³å¯ï¼Œè¿™å°±æ˜¯æ»‘åŠ¨çª—å£çš„ç”±æ¥ã€‚</strong>æ¥æ”¶æ–¹æ ¹æ®å®ƒçš„ç¼“å†²åŒºï¼Œå¯ä»¥è®¡ç®—å‡ºåç»­èƒ½å¤Ÿæ¥æ”¶å¤šå°‘å­—èŠ‚çš„æŠ¥æ–‡ï¼Œè¿™ä¸ªæ•°å­—å«åšæ¥æ”¶çª—å£ã€‚å½“å†…æ ¸æ¥æ”¶åˆ°æŠ¥æ–‡æ—¶ï¼Œå¿…é¡»ç”¨ç¼“å†²åŒºå­˜æ”¾å®ƒä»¬ï¼Œè¿™æ ·å‰©ä½™ç¼“å†²åŒºç©ºé—´å˜å°ï¼Œæ¥æ”¶çª—å£ä¹Ÿå°±å˜å°äº†ï¼›å½“è¿›ç¨‹è°ƒç”¨readå‡½æ•°åï¼Œæ•°æ®è¢«è¯»å…¥äº†ç”¨æˆ·ç©ºé—´ï¼Œå†…æ ¸ç¼“å†²åŒºå°±è¢«æ¸…ç©ºï¼Œè¿™æ„å‘³ç€ä¸»æœºå¯ä»¥æ¥æ”¶æ›´å¤šçš„æŠ¥æ–‡ï¼Œæ¥æ”¶çª—å£å°±ä¼šå˜å¤§ã€‚</p><p>å› æ­¤ï¼Œæ¥æ”¶çª—å£å¹¶ä¸æ˜¯æ’å®šä¸å˜çš„ï¼Œé‚£ä¹ˆæ€ä¹ˆæŠŠæ—¶åˆ»å˜åŒ–çš„çª—å£é€šçŸ¥ç»™å‘é€æ–¹å‘¢ï¼ŸTCPæŠ¥æ–‡å¤´éƒ¨ä¸­çš„çª—å£å­—æ®µï¼Œå°±å¯ä»¥èµ·åˆ°é€šçŸ¥çš„ä½œç”¨ã€‚</p><p>å½“å‘é€æ–¹ä»æŠ¥æ–‡ä¸­å¾—åˆ°æ¥æ”¶æ–¹çš„çª—å£å¤§å°æ—¶ï¼Œå°±æ˜ç™½äº†æœ€å¤šèƒ½å‘é€å¤šå°‘å­—èŠ‚çš„æŠ¥æ–‡ï¼Œè¿™ä¸ªæ•°å­—è¢«ç§°ä¸ºå‘é€æ–¹çš„å‘é€çª—å£ã€‚å¦‚æœä¸è€ƒè™‘ä¸‹ä¸€è®²å°†è¦ä»‹ç»çš„æ‹¥å¡æ§åˆ¶ï¼Œå‘é€æ–¹çš„å‘é€çª—å£å°±æ˜¯æ¥æ”¶æ–¹çš„æ¥æ”¶çª—å£ï¼ˆç”±äºæŠ¥æ–‡æœ‰ä¼ è¾“æ—¶å»¶ï¼Œt1æ—¶åˆ»çš„æ¥æ”¶çª—å£åœ¨t2æ—¶åˆ»æ‰èƒ½åˆ°è¾¾å‘é€ç«¯ï¼Œå› æ­¤è¿™ä¸¤ä¸ªçª—å£å¹¶ä¸å®Œå…¨ç­‰ä»·ï¼‰ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/9a/f1/9a9385d4e5343285201e0242809c16f1.jpg?wh=2024*590\" alt=\"\"></p><p>ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œçª—å£å­—æ®µåªæœ‰2ä¸ªå­—èŠ‚ï¼Œå› æ­¤å®ƒæœ€å¤šèƒ½è¡¨è¾¾2<sup>16</sup> å³65535å­—èŠ‚å¤§å°çš„çª—å£ï¼ˆä¹‹æ‰€ä»¥ä¸æ˜¯65536ï¼Œæ˜¯å› ä¸ºçª—å£å¯ä»¥ä¸º0ï¼Œæ­¤æ—¶å«åšçª—å£å…³é—­ï¼Œä¸Šä¸€è®²æåˆ°çš„å…³é—­è¿æ¥æ—¶è®©FINæŠ¥æ–‡å‘ä¸å‡ºå»ï¼Œä»¥è‡´äºæœåŠ¡å™¨çš„è¿æ¥éƒ½å¤„äºFIN_WAIT1çŠ¶æ€ï¼Œå°±æ˜¯é€šè¿‡çª—å£å…³é—­æŠ€æœ¯å®ç°çš„ï¼‰ï¼Œè¿™åœ¨RTTä¸º10msçš„ç½‘ç»œä¸­ä¹Ÿåªèƒ½åˆ°è¾¾6MB/sçš„æœ€å¤§é€Ÿåº¦ï¼Œåœ¨å½“ä»Šçš„é«˜é€Ÿç½‘ç»œä¸­æ˜¾ç„¶å¹¶ä¸å¤Ÿç”¨ã€‚</p><p><a href=\"https://tools.ietf.org/html/rfc1323\">RFC1323</a> å®šä¹‰äº†æ‰©å……çª—å£çš„æ–¹æ³•ï¼Œä½†Linuxä¸­æ‰“å¼€è¿™ä¸€åŠŸèƒ½ï¼Œéœ€è¦æŠŠtcp_window_scalingé…ç½®è®¾ä¸º1ï¼Œæ­¤æ—¶çª—å£çš„æœ€å¤§å€¼å¯ä»¥è¾¾åˆ°1GBï¼ˆ2<sup>30</sup>ï¼‰ã€‚</p><pre><code>net.ipv4.tcp_window_scaling = 1\n</code></pre><p>è¿™æ ·çœ‹æ¥ï¼Œåªè¦è¿›ç¨‹èƒ½åŠæ—¶åœ°è°ƒç”¨readå‡½æ•°è¯»å–æ•°æ®ï¼Œå¹¶ä¸”æ¥æ”¶ç¼“å†²åŒºé…ç½®å¾—è¶³å¤Ÿå¤§ï¼Œé‚£ä¹ˆæ¥æ”¶çª—å£å°±å¯ä»¥æ— é™åœ°æ”¾å¤§ï¼Œå‘é€æ–¹ä¹Ÿå°±æ— é™åœ°æå‡å‘é€é€Ÿåº¦ã€‚å¾ˆæ˜¾ç„¶ï¼Œè¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºç½‘ç»œçš„ä¼ è¾“èƒ½åŠ›æ˜¯æœ‰é™çš„ï¼Œå½“å‘é€æ–¹ä¾æ®å‘é€çª—å£ï¼Œå‘é€è¶…è¿‡ç½‘ç»œå¤„ç†èƒ½åŠ›çš„æŠ¥æ–‡æ—¶ï¼Œè·¯ç”±å™¨ä¼šç›´æ¥ä¸¢å¼ƒè¿™äº›æŠ¥æ–‡ã€‚å› æ­¤ï¼Œç¼“å†²åŒºçš„å†…å­˜å¹¶ä¸æ˜¯è¶Šå¤§è¶Šå¥½ã€‚</p><h2>å¸¦å®½æ—¶å»¶ç§¯å¦‚ä½•ç¡®å®šæœ€å¤§ä¼ è¾“é€Ÿåº¦ï¼Ÿ</h2><p>ç¼“å†²åŒºåˆ°åº•è¯¥è®¾ç½®ä¸ºå¤šå¤§å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼ŒTCPçš„ä¼ è¾“é€Ÿåº¦ï¼Œå—åˆ¶äºå‘é€çª—å£ä¸æ¥æ”¶çª—å£ï¼Œä»¥åŠç½‘ç»œä¼ è¾“èƒ½åŠ›ã€‚å…¶ä¸­ï¼Œä¸¤ä¸ªçª—å£ç”±ç¼“å†²åŒºå¤§å°å†³å®šï¼ˆè¿›ç¨‹è°ƒç”¨readå‡½æ•°æ˜¯å¦åŠæ—¶ä¹Ÿä¼šå½±å“å®ƒï¼‰ã€‚å¦‚æœç¼“å†²åŒºå¤§å°ä¸ç½‘ç»œä¼ è¾“èƒ½åŠ›åŒ¹é…ï¼Œé‚£ä¹ˆç¼“å†²åŒºçš„åˆ©ç”¨ç‡å°±è¾¾åˆ°äº†æœ€å¤§å€¼ã€‚</p><p>æ€æ ·è®¡ç®—å‡ºç½‘ç»œä¼ è¾“èƒ½åŠ›å‘¢ï¼Ÿå¸¦å®½æè¿°äº†ç½‘ç»œä¼ è¾“èƒ½åŠ›ï¼Œä½†å®ƒä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä¸çª—å£æˆ–è€…è¯´ç¼“å†²åŒºçš„è®¡é‡å•ä½ä¸åŒã€‚å¸¦å®½æ˜¯å•ä½æ—¶é—´å†…çš„æµé‡ ï¼Œå®ƒè¡¨è¾¾çš„æ˜¯é€Ÿåº¦ï¼Œæ¯”å¦‚ä½ å®¶é‡Œçš„å®½å¸¦100MB/sï¼Œè€Œçª—å£å’Œç¼“å†²åŒºçš„å•ä½æ˜¯å­—èŠ‚ã€‚å½“ç½‘ç»œé€Ÿåº¦ä¹˜ä»¥æ—¶é—´æ‰èƒ½å¾—åˆ°å­—èŠ‚æ•°ï¼Œå·®çš„è¿™ä¸ªæ—¶é—´ï¼Œè¿™å°±æ˜¯ç½‘ç»œæ—¶å»¶ã€‚</p><p>å½“æœ€å¤§å¸¦å®½æ˜¯100MB/sã€ç½‘ç»œæ—¶å»¶æ˜¯10msæ—¶ï¼Œè¿™æ„å‘³ç€å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨é—´çš„ç½‘ç»œä¸€å…±å¯ä»¥å­˜æ”¾100MB/s * 0.01s = 1MBçš„å­—èŠ‚ã€‚è¿™ä¸ª1MBæ˜¯å¸¦å®½ä¸æ—¶å»¶çš„ä¹˜ç§¯ï¼Œæ‰€ä»¥å®ƒå°±å«åšå¸¦å®½æ—¶å»¶ç§¯ï¼ˆç¼©å†™ä¸ºBDPï¼ŒBandwidth Delay Productï¼‰ã€‚è¿™1MBå­—èŠ‚å­˜åœ¨äºé£è¡Œä¸­çš„TCPæŠ¥æ–‡ï¼Œå®ƒä»¬å°±åœ¨ç½‘ç»œçº¿è·¯ã€è·¯ç”±å™¨ç­‰ç½‘ç»œè®¾å¤‡ä¸Šã€‚å¦‚æœé£è¡ŒæŠ¥æ–‡è¶…è¿‡äº†1MBï¼Œå°±ä¸€å®šä¼šè®©ç½‘ç»œè¿‡è½½ï¼Œæœ€ç»ˆå¯¼è‡´ä¸¢åŒ…ã€‚</p><p>ç”±äºå‘é€ç¼“å†²åŒºå†³å®šäº†å‘é€çª—å£çš„ä¸Šé™ï¼Œè€Œå‘é€çª—å£åˆå†³å®šäº†å·²å‘é€ä½†æœªç¡®è®¤çš„é£è¡ŒæŠ¥æ–‡çš„ä¸Šé™ï¼Œå› æ­¤ï¼Œå‘é€ç¼“å†²åŒºä¸èƒ½è¶…è¿‡å¸¦å®½æ—¶å»¶ç§¯ï¼Œå› ä¸ºè¶…å‡ºçš„éƒ¨åˆ†æ²¡æœ‰åŠæ³•ç”¨äºæœ‰æ•ˆçš„ç½‘ç»œä¼ è¾“ï¼Œä¸”é£è¡Œå­—èŠ‚å¤§äºå¸¦å®½æ—¶å»¶ç§¯è¿˜ä¼šå¯¼è‡´ä¸¢åŒ…ï¼›è€Œä¸”ï¼Œç¼“å†²åŒºä¹Ÿä¸èƒ½å°äºå¸¦å®½æ—¶å»¶ç§¯ï¼Œå¦åˆ™æ— æ³•å‘æŒ¥å‡ºé«˜é€Ÿç½‘ç»œçš„ä»·å€¼ã€‚</p><h2>æ€æ ·è°ƒæ•´ç¼“å†²åŒºå»é€‚é…æ»‘åŠ¨çª—å£ï¼Ÿ</h2><p>è¿™ä¹ˆçœ‹æ¥ï¼Œæˆ‘ä»¬åªè¦æŠŠç¼“å†²åŒºè®¾ç½®ä¸ºå¸¦å®½æ—¶å»¶ç§¯ä¸å°±è¡Œäº†å—ï¼Ÿ<strong>æ¯”å¦‚ï¼Œå½“æˆ‘ä»¬åšsocketç½‘ç»œç¼–ç¨‹æ—¶ï¼Œé€šè¿‡è®¾ç½®socketçš„SO_SNDBUFå±æ€§ï¼Œå°±å¯ä»¥è®¾å®šç¼“å†²åŒºçš„å¤§å°ã€‚</strong></p><p>ç„¶è€Œï¼Œè¿™å¹¶ä¸æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºä¸æ˜¯æ¯ä¸€ä¸ªè¯·æ±‚éƒ½èƒ½å¤Ÿè¾¾åˆ°æœ€å¤§ä¼ è¾“é€Ÿåº¦ï¼Œæ¯”å¦‚è¯·æ±‚çš„ä½“ç§¯å¤ªå°æ—¶ï¼Œåœ¨<strong>æ…¢å¯åŠ¨</strong>ï¼ˆä¸‹ä¸€è®²ä¼šè°ˆåˆ°ï¼‰çš„å½±å“ä¸‹ï¼Œæœªè¾¾åˆ°æœ€å¤§é€Ÿåº¦æ—¶è¯·æ±‚å°±å¤„ç†å®Œäº†ã€‚å†æ¯”å¦‚ç½‘ç»œæœ¬èº«ä¹Ÿä¼šæœ‰æ³¢åŠ¨ï¼Œæœªå¿…å¯ä»¥ä¸€ç›´ä¿æŒæœ€å¤§é€Ÿåº¦ã€‚</p><p><strong>å› æ­¤ï¼Œæ—¶åˆ»è®©ç¼“å†²åŒºä¿æŒæœ€å¤§ï¼Œå¤ªè¿‡æµªè´¹å†…å­˜äº†ã€‚</strong></p><p>åˆ°åº•è¯¥å¦‚ä½•è®¾ç½®ç¼“å†²åŒºå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Linuxçš„<strong>ç¼“å†²åŒºåŠ¨æ€è°ƒèŠ‚åŠŸèƒ½</strong>è§£å†³ä¸Šè¿°é—®é¢˜ã€‚å…¶ä¸­ï¼Œç¼“å†²åŒºçš„è°ƒèŠ‚èŒƒå›´æ˜¯å¯ä»¥è®¾ç½®çš„ã€‚å…ˆæ¥çœ‹å‘é€ç¼“å†²åŒºï¼Œå®ƒçš„èŒƒå›´é€šè¿‡tcp_wmemé…ç½®ï¼š</p><pre><code>net.ipv4.tcp_wmem = 4096        16384   4194304\n</code></pre><p>å…¶ä¸­ï¼Œç¬¬1ä¸ªæ•°å€¼æ˜¯åŠ¨æ€èŒƒå›´çš„ä¸‹é™ï¼Œç¬¬3ä¸ªæ•°å€¼æ˜¯åŠ¨æ€èŒƒå›´çš„ä¸Šé™ã€‚è€Œä¸­é—´ç¬¬2ä¸ªæ•°å€¼ï¼Œåˆ™æ˜¯åˆå§‹é»˜è®¤å€¼ã€‚</p><p>å‘é€ç¼“å†²åŒºå®Œå…¨æ ¹æ®éœ€æ±‚è‡ªè¡Œè°ƒæ•´ã€‚æ¯”å¦‚ï¼Œä¸€æ—¦å‘é€å‡ºçš„æ•°æ®è¢«ç¡®è®¤ï¼Œè€Œä¸”æ²¡æœ‰æ–°çš„æ•°æ®è¦å‘é€ï¼Œå°±å¯ä»¥æŠŠå‘é€ç¼“å†²åŒºçš„å†…å­˜é‡Šæ”¾æ‰ã€‚è€Œæ¥æ”¶ç¼“å†²åŒºçš„è°ƒæ•´å°±è¦å¤æ‚ä¸€äº›ï¼Œå…ˆæ¥çœ‹è®¾ç½®æ¥æ”¶ç¼“å†²åŒºèŒƒå›´çš„tcp_rmemï¼š</p><pre><code>net.ipv4.tcp_rmem = 4096        87380   6291456\n</code></pre><p>å®ƒçš„æ•°å€¼ä¸tcp_wmemç±»ä¼¼ï¼Œç¬¬1ã€3ä¸ªå€¼æ˜¯èŒƒå›´çš„ä¸‹é™å’Œä¸Šé™ï¼Œç¬¬2ä¸ªå€¼æ˜¯åˆå§‹é»˜è®¤å€¼ã€‚å‘é€ç¼“å†²åŒºè‡ªåŠ¨è°ƒèŠ‚çš„ä¾æ®æ˜¯å¾…å‘é€çš„æ•°æ®ï¼Œæ¥æ”¶ç¼“å†²åŒºç”±äºåªèƒ½è¢«åŠ¨åœ°ç­‰å¾…æ¥æ”¶æ•°æ®ï¼Œå®ƒè¯¥å¦‚ä½•è‡ªåŠ¨è°ƒæ•´å‘¢ï¼Ÿ</p><p><strong>å¯ä»¥ä¾æ®ç©ºé—²ç³»ç»Ÿå†…å­˜çš„æ•°é‡æ¥è°ƒèŠ‚æ¥æ”¶çª—å£ã€‚</strong>å¦‚æœç³»ç»Ÿçš„ç©ºé—²å†…å­˜å¾ˆå¤šï¼Œå°±å¯ä»¥æŠŠç¼“å†²åŒºå¢å¤§ä¸€äº›ï¼Œè¿™æ ·ä¼ ç»™å¯¹æ–¹çš„æ¥æ”¶çª—å£ä¹Ÿä¼šå˜å¤§ï¼Œå› è€Œå¯¹æ–¹çš„å‘é€é€Ÿåº¦å°±ä¼šé€šè¿‡å¢åŠ é£è¡ŒæŠ¥æ–‡æ¥æå‡ã€‚åä¹‹ï¼Œå†…å­˜ç´§å¼ æ—¶å°±ä¼šç¼©å°ç¼“å†²åŒºï¼Œè¿™è™½ç„¶ä¼šå‡æ…¢é€Ÿåº¦ï¼Œä½†å¯ä»¥ä¿è¯æ›´å¤šçš„å¹¶å‘è¿æ¥æ­£å¸¸å·¥ä½œã€‚</p><p>å‘é€ç¼“å†²åŒºçš„è°ƒèŠ‚åŠŸèƒ½æ˜¯è‡ªåŠ¨å¼€å¯çš„ï¼Œè€Œæ¥æ”¶ç¼“å†²åŒºåˆ™éœ€è¦é…ç½®tcp_moderate_rcvbufä¸º1æ¥å¼€å¯è°ƒèŠ‚åŠŸèƒ½ï¼š</p><pre><code>net.ipv4.tcp_moderate_rcvbuf = 1\n</code></pre><p>æ¥æ”¶ç¼“å†²åŒºè°ƒèŠ‚æ—¶ï¼Œæ€ä¹ˆåˆ¤æ–­ç©ºé—²å†…å­˜çš„å¤šå°‘å‘¢ï¼Ÿè¿™æ˜¯é€šè¿‡tcp_memé…ç½®å®Œæˆçš„ï¼š</p><pre><code>net.ipv4.tcp_mem = 88560        118080  177120\n</code></pre><p>tcp_memçš„3ä¸ªå€¼ï¼Œæ˜¯Linuxåˆ¤æ–­ç³»ç»Ÿå†…å­˜æ˜¯å¦ç´§å¼ çš„ä¾æ®ã€‚å½“TCPå†…å­˜å°äºç¬¬1ä¸ªå€¼æ—¶ï¼Œä¸éœ€è¦è¿›è¡Œè‡ªåŠ¨è°ƒèŠ‚ï¼›åœ¨ç¬¬1å’Œç¬¬2ä¸ªå€¼ä¹‹é—´æ—¶ï¼Œå†…æ ¸å¼€å§‹è°ƒèŠ‚æ¥æ”¶ç¼“å†²åŒºçš„å¤§å°ï¼›å¤§äºç¬¬3ä¸ªå€¼æ—¶ï¼Œå†…æ ¸ä¸å†ä¸ºTCPåˆ†é…æ–°å†…å­˜ï¼Œæ­¤æ—¶æ–°è¿æ¥æ˜¯æ— æ³•å»ºç«‹çš„ã€‚</p><p>åœ¨é«˜å¹¶å‘æœåŠ¡å™¨ä¸­ï¼Œä¸ºäº†å…¼é¡¾ç½‘é€Ÿä¸å¤§é‡çš„å¹¶å‘è¿æ¥ï¼Œ<strong>æˆ‘ä»¬åº”å½“ä¿è¯ç¼“å†²åŒºçš„åŠ¨æ€è°ƒæ•´ä¸Šé™è¾¾åˆ°å¸¦å®½æ—¶å»¶ç§¯ï¼Œè€Œä¸‹é™ä¿æŒé»˜è®¤çš„4Kä¸å˜å³å¯ã€‚è€Œå¯¹äºå†…å­˜ç´§å¼ çš„æœåŠ¡è€Œè¨€ï¼Œè°ƒä½é»˜è®¤å€¼æ˜¯æé«˜å¹¶å‘çš„æœ‰æ•ˆæ‰‹æ®µã€‚</strong></p><p>åŒæ—¶ï¼Œå¦‚æœè¿™æ˜¯ç½‘ç»œIOå‹æœåŠ¡å™¨ï¼Œé‚£ä¹ˆï¼Œ<strong>è°ƒå¤§tcp_memçš„ä¸Šé™å¯ä»¥è®©TCPè¿æ¥ä½¿ç”¨æ›´å¤šçš„ç³»ç»Ÿå†…å­˜ï¼Œè¿™æœ‰åˆ©äºæå‡å¹¶å‘èƒ½åŠ›ã€‚</strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œtcp_wmemå’Œtcp_rmemçš„å•ä½æ˜¯å­—èŠ‚ï¼Œè€Œtcp_memçš„å•ä½æ˜¯é¡µé¢å¤§å°ã€‚è€Œä¸”ï¼Œ<strong>åƒä¸‡ä¸è¦åœ¨socketä¸Šç›´æ¥è®¾ç½®SO_SNDBUFæˆ–è€…SO_RCVBUFï¼Œè¿™æ ·ä¼šå…³é—­ç¼“å†²åŒºçš„åŠ¨æ€è°ƒæ•´åŠŸèƒ½ã€‚</strong></p><h2>å°ç»“</h2><p>æˆ‘ä»¬å¯¹è¿™ä¸€è®²çš„å†…å®¹åšä¸ªå°ç»“ã€‚</p><p>å®ç°é«˜å¹¶å‘æœåŠ¡æ—¶ï¼Œç”±äºå¿…é¡»æŠŠå¤§éƒ¨åˆ†å†…å­˜ç”¨åœ¨ç½‘ç»œä¼ è¾“ä¸Šï¼Œæ‰€ä»¥é™¤äº†å…³æ³¨åº”ç”¨å†…å­˜çš„ä½¿ç”¨ï¼Œè¿˜å¿…é¡»å…³æ³¨TCPå†…æ ¸ç¼“å†²åŒºçš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚</p><p>TCPä½¿ç”¨ACKç¡®è®¤æŠ¥æ–‡å®ç°äº†å¯é æ€§ï¼Œåˆä¾èµ–æ»‘åŠ¨çª—å£æ—¢æå‡äº†å‘é€é€Ÿåº¦ä¹Ÿå…¼é¡¾äº†æ¥æ”¶æ–¹çš„å¤„ç†èƒ½åŠ›ã€‚ç„¶è€Œï¼Œé»˜è®¤çš„æ»‘åŠ¨çª—å£æœ€å¤§åªèƒ½åˆ°65KBï¼Œè¦æƒ³æå‡å‘é€é€Ÿåº¦å¿…é¡»æå‡æ»‘åŠ¨çª—å£çš„ä¸Šé™ï¼Œåœ¨Linuxä¸‹æ˜¯é€šè¿‡è®¾ç½®tcp_window_scalingä¸º1åšåˆ°çš„ã€‚</p><p>æ»‘åŠ¨çª—å£å®šä¹‰äº†é£è¡ŒæŠ¥æ–‡çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œå½“å®ƒè¶…è¿‡å¸¦å®½æ—¶å»¶ç§¯æ—¶ï¼Œå°±ä¼šå‘ç”Ÿä¸¢åŒ…ã€‚è€Œå½“å®ƒå°äºå¸¦å®½æ—¶å»¶ç§¯æ—¶ï¼Œå°±æ— æ³•è®©TCPçš„ä¼ è¾“é€Ÿåº¦è¾¾åˆ°ç½‘ç»œå…è®¸çš„æœ€å¤§å€¼ã€‚å› æ­¤ï¼Œæ»‘åŠ¨çª—å£çš„è®¾è®¡ï¼Œå¿…é¡»å‚è€ƒå¸¦å®½æ—¶å»¶ç§¯ã€‚</p><p>å†…æ ¸ç¼“å†²åŒºå†³å®šäº†æ»‘åŠ¨çª—å£çš„ä¸Šé™ï¼Œä½†æˆ‘ä»¬ä¸èƒ½é€šè¿‡socketçš„SO_SNFBUFç­‰é€‰é¡¹ç›´æ¥æŠŠç¼“å†²åŒºå¤§å°è®¾ç½®ä¸ºå¸¦å®½æ—¶å»¶ç§¯ï¼Œå› ä¸ºTCPä¸ä¼šä¸€ç›´ç»´æŒåœ¨æœ€é«˜é€Ÿä¸Šï¼Œè¿‡å¤§çš„ç¼“å†²åŒºä¼šå‡å°‘å¹¶å‘è¿æ¥æ•°ã€‚Linuxå¸¦æ¥çš„ç¼“å†²åŒºè‡ªåŠ¨è°ƒèŠ‚åŠŸèƒ½éå¸¸æœ‰æ•ˆï¼Œæˆ‘ä»¬åº”å½“æŠŠç¼“å†²åŒºçš„ä¸Šé™è®¾ç½®ä¸ºå¸¦å®½æ—¶å»¶ç§¯ã€‚å…¶ä¸­ï¼Œå‘é€ç¼“å†²åŒºçš„è°ƒèŠ‚åŠŸèƒ½æ˜¯è‡ªåŠ¨æ‰“å¼€çš„ï¼Œè€Œæ¥æ”¶ç¼“å†²åŒºéœ€è¦æŠŠtcp_moderate_rcvbufè®¾ç½®ä¸º1æ¥å¼€å¯ï¼Œå…¶ä¸­è°ƒèŠ‚çš„ä¾æ®æ ¹æ®tcp_memè€Œå®šã€‚</p><p>è¿™æ ·é«˜æ•ˆåœ°é…ç½®å†…å­˜åï¼Œæ—¢èƒ½å¤Ÿæœ€å¤§ç¨‹åº¦åœ°ä¿æŒå¹¶å‘æ€§ï¼Œä¹Ÿèƒ½è®©èµ„æºå……è£•æ—¶è¿æ¥ä¼ è¾“é€Ÿåº¦è¾¾åˆ°æœ€å¤§å€¼ã€‚è¿™ä¸€è®²æˆ‘ä»¬è°ˆäº†å†…æ ¸ç¼“å†²åŒºå¯¹ä¼ è¾“é€Ÿåº¦çš„å½±å“ï¼Œä¸‹ä¸€è®²æˆ‘ä»¬å†æ¥çœ‹å¦‚ä½•è°ƒèŠ‚å‘é€é€Ÿåº¦ä»¥åŒ¹é…ä¸åŒçš„ç½‘ç»œèƒ½åŠ›ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æœ€åï¼Œè¯·ä½ è§‚å¯Ÿä¸‹Linuxç³»ç»Ÿä¸‹ï¼Œè¿æ¥å»ºç«‹æ—¶ã€å‘é€æ¥æ”¶æ•°æ®æ—¶ï¼Œbuff/cacheå†…å­˜çš„å˜åŠ¨æƒ…å†µã€‚ç”¨æˆ‘ä»¬è¿™ä¸€è®²ä»‹ç»çš„åŸç†ï¼Œè§£é‡Šç³»ç»Ÿå†…å­˜çš„å˜åŒ–ç°è±¡ã€‚æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºä¸æˆ‘æ²Ÿé€šäº’åŠ¨ã€‚</p><p>æ„Ÿè°¢é˜…è¯»ï¼Œå¦‚æœä½ è§‰å¾—è¿™èŠ‚è¯¾å¯¹ä½ æœ‰ä¸€äº›å¯å‘ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚</p>","comments":[{"had_liked":false,"id":220013,"user_name":"åˆ†æ¸…äº‘æ·¡","can_delete":false,"product_type":"c1","uid":1269873,"ip_address":"","ucode":"7045AE6BF72D31","user_header":"https://static001.geekbang.org/account/avatar/00/13/60/71/895ee6cf.jpg","comment_is_top":false,"comment_ctime":1590135529,"is_pvip":false,"discussion_count":7,"race_medal":0,"score":"113259285225","product_id":100051201,"comment_content":"TCPæ€§èƒ½å’Œå‘é€æ¥æ”¶çª—å£ã€Bufferçš„å…³ç³», å®šé‡åˆ†æå’Œå›¾å½¢å±•ç¤º, æ­£å¥½çœ‹çœ‹wiresharkåˆ†æè¿™ç±»é—®é¢˜çš„é­…åŠ›ï¼š https:&#47;&#47;plantegg.github.io&#47;2019&#47;09&#47;28&#47;%E5%B0%B1%E6%98%AF%E8%A6%81%E4%BD%A0%E6%87%82TCP--%E6%80%A7%E8%83%BD%E5%92%8C%E5%8F%91%E9%80%81%E6%8E%A5%E6%94%B6Buffer%E7%9A%84%E5%85%B3%E7%B3%BB&#47;","like_count":25,"discussions":[{"author":{"id":1205253,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","nickname":"æˆ‘æ¥ä¹Ÿ","note":"","ucode":"773D6104F56767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303840,"discussion_content":"ä½ è¿™ä¸ªåšæ–‡è·ŸçŸ¥ä¹ä¸Šçš„ä¸€ç¯‡æ–‡ç« å¥½åƒæ˜¯åŒä¸€ä¸ªå†…å®¹.\n[ç›´å‡»æ¡ˆå‘ç°åœºï¼TCP 10å€å»¶è¿Ÿçš„çœŸç›¸æ˜¯ï¼Ÿ](https://zhuanlan.zhihu.com/p/89620832)\n\nä½ çŸ¥ä¸çŸ¥é“è¿™æ–‡ç« ä¸­çš„æœ‰äº›å›¾ç‰‡,å°±æ˜¯å¼•ç”¨çš„æœ¬ä¸“æ ä½œè€… é™¶è¾‰ çš„?\nçŸ¥ä¹ä¸Šæœ‰å†™ `å›¾ç‰‡æ¥æºï¼šé™¶è¾‰`\nè¿™ç¯‡æ–‡ç« æˆ‘æœ€è¿‘æ’æŸ¥é—®é¢˜æ—¶ä¹Ÿçœ‹è¿‡äº†.\n\næˆ‘æœ€è¿‘æŸ¥ä¸€ä¸ªé—®é¢˜,è¿˜æœç´¢åˆ°äº†è€å¸ˆ2014å¹´çš„ä¸€ç¯‡æ–‡ç« .\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599393621,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1269873,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/71/895ee6cf.jpg","nickname":"åˆ†æ¸…äº‘æ·¡","note":"","ucode":"7045AE6BF72D31","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1205253,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","nickname":"æˆ‘æ¥ä¹Ÿ","note":"","ucode":"773D6104F56767","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":320541,"discussion_content":"æœ‰ä¸€å¼ å›¾ç‰‡æ˜¯é™¶è€å¸ˆçš„ï¼Œæœ‰æ³¨æ˜ï¼Œåˆ«çš„éƒ½æ˜¯ä½œè€…å®æˆ˜æˆªå›¾","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604394543,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":303840,"ip_address":""},"score":320541,"extra":""}]},{"author":{"id":2058525,"avatar":"","nickname":"Lion","note":"","ucode":"EBD91CF2F09F8B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295576,"discussion_content":"æ„Ÿè°¢åˆ†äº«","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596253845,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1991518,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/63/5e/799cd6dc.jpg","nickname":"ğŸ§é‡è¿”å½’é€”","note":"","ucode":"33F748AE188B07","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":273492,"discussion_content":"å¾ˆæ£’","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590462790,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1097790,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c0/3e/ff3ed621.jpg","nickname":"äº‘èµ·","note":"","ucode":"1642C543B47B87","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":272263,"discussion_content":"å‘ç°äº†å¥½blog","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590280691,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1269873,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/71/895ee6cf.jpg","nickname":"åˆ†æ¸…äº‘æ·¡","note":"","ucode":"7045AE6BF72D31","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1097790,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c0/3e/ff3ed621.jpg","nickname":"äº‘èµ·","note":"","ucode":"1642C543B47B87","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":272374,"discussion_content":"å¤šè°¢ï¼Œè·Ÿæˆ‘çš„ä¹ æƒ¯ä¸€æ ·ï¼Œä»ä¸€ç¯‡å¥½æ–‡ç« å¼€å§‹æŒ¨ä¸ªéƒ½æŠŠåšå®¢æ–‡ç« ç¿»é˜…ä¸€ä¸‹ï¼Œå¥½çš„åšå®¢ç«‹é©¬è®¢é˜…ä¸‹æ¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590295182,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":272263,"ip_address":""},"score":272374,"extra":""}]},{"author":{"id":1467182,"avatar":"https://static001.geekbang.org/account/avatar/00/16/63/2e/e49116d1.jpg","nickname":"Geek_007","note":"","ucode":"C80107538EAA7F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":271575,"discussion_content":"å¤ªèµäº†ï¼Œæ„Ÿè°¢åˆ†äº«","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590157136,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":234998,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1594866106,"is_pvip":false,"replies":[{"id":"90330","content":"å¾ˆå¥½çš„æ€»ç»“ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1599011830,"ip_address":"","comment_id":234998,"utype":1}],"discussion_count":1,"race_medal":0,"score":"66019375546","product_id":100051201,"comment_content":"æ€»ç»“ï¼š<br>----------ç¼“å†²åŒºåŠ¨æ€è°ƒèŠ‚åŠŸèƒ½-----------<br>â‘ å‘é€ç¼“å†²åŒºè‡ªåŠ¨è°ƒæ•´ï¼ˆè‡ªåŠ¨å¼€å¯ï¼‰ï¼š<br>net.ipv4.tcp_wmem = 4096(åŠ¨æ€èŒƒå›´ä¸‹é™)        16384(åˆå§‹é»˜è®¤å€¼)   4194304(åŠ¨æ€èŒƒå›´ä¸Šé™)<br>ä¸€æ—¦å‘é€å‡ºçš„æ•°æ®è¢«ç¡®è®¤ï¼Œè€Œä¸”æ²¡æœ‰æ–°çš„æ•°æ®è¦å‘é€ï¼Œå°±å¯ä»¥æŠŠå‘é€ç¼“å†²åŒºçš„å†…å­˜é‡Šæ”¾æ‰<br><br><br>â‘¡æ¥æ”¶ç¼“å†²åŒºè‡ªåŠ¨è°ƒæ•´ï¼ˆé€šè¿‡è®¾ç½®net.ipv4.tcp_moderate_rcvbuf = 1å¼€å¯ï¼‰ï¼š<br>net.ipv4.tcp_rmem = 4096(åŠ¨æ€èŒƒå›´ä¸‹é™)          87380(åˆå§‹é»˜è®¤å€¼)    6291456(åŠ¨æ€èŒƒå›´ä¸Šé™)<br>å¯ä»¥ä¾æ®ç©ºé—²ç³»ç»Ÿå†…å­˜çš„æ•°é‡æ¥è°ƒèŠ‚æ¥æ”¶çª—å£ã€‚å¦‚æœç³»ç»Ÿçš„ç©ºé—²å†…å­˜å¾ˆå¤šï¼Œå°±å¯ä»¥æŠŠç¼“å†²åŒºå¢å¤§ä¸€äº›ï¼Œè¿™æ ·ä¼ ç»™å¯¹æ–¹çš„æ¥æ”¶çª—å£ä¹Ÿä¼šå˜å¤§ï¼Œå› è€Œå¯¹æ–¹çš„å‘é€é€Ÿåº¦å°±ä¼šé€šè¿‡å¢åŠ é£è¡ŒæŠ¥æ–‡æ¥æå‡ã€‚åä¹‹ï¼Œå†…å­˜ç´§å¼ æ—¶å°±ä¼šç¼©å°ç¼“å†²åŒºï¼Œè¿™è™½ç„¶ä¼šå‡æ…¢é€Ÿåº¦ï¼Œä½†å¯ä»¥ä¿è¯æ›´å¤šçš„å¹¶å‘è¿æ¥æ­£å¸¸å·¥ä½œã€‚<br><br><br>â‘¢æ¥æ”¶ç¼“å†²åŒºåˆ¤æ–­å†…å­˜ç©ºé—²çš„æ–¹å¼ï¼š<br>net.ipv4.tcp_mem = 88560        118080  177120<br>å½“ TCP å†…å­˜å°äºç¬¬ 1 ä¸ªå€¼æ—¶ï¼Œä¸éœ€è¦è¿›è¡Œè‡ªåŠ¨è°ƒèŠ‚ï¼›<br>åœ¨ç¬¬ 1 å’Œç¬¬ 2 ä¸ªå€¼ä¹‹é—´æ—¶ï¼Œå†…æ ¸å¼€å§‹è°ƒèŠ‚æ¥æ”¶ç¼“å†²åŒºçš„å¤§å°ï¼›<br>å¤§äºç¬¬ 3 ä¸ªå€¼æ—¶ï¼Œå†…æ ¸ä¸å†ä¸º TCP åˆ†é…æ–°å†…å­˜ï¼Œæ­¤æ—¶æ–°è¿æ¥æ˜¯æ— æ³•å»ºç«‹çš„ã€‚<br><br>â‘£å¸¦å®½æ—¶å»¶ç§¯çš„è¡¡é‡æ–¹å¼ï¼šå¯¹ç½‘ç»œæ—¶å»¶å¤šæ¬¡å–æ ·è®¡ç®—å¹³å‡å€¼ï¼Œå†ä¹˜ä»¥å¸¦å®½ã€‚","like_count":16,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501573,"discussion_content":"å¾ˆå¥½çš„æ€»ç»“ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599011830,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":226224,"user_name":"é”‹","can_delete":false,"product_type":"c1","uid":1807836,"ip_address":"","ucode":"F26BC1F14AB0D7","user_header":"https://static001.geekbang.org/account/avatar/00/1b/95/dc/07195a63.jpg","comment_is_top":false,"comment_ctime":1592008384,"is_pvip":false,"replies":[{"id":"83494","content":"äº¤ç”±TCPä¼ è¾“å±‚æ¥å®ç°ï¼Œè¿™ä¸æ˜¯ç½‘ç»œè®¾å¤‡å¤„ç†çš„ï¼Œè€Œæ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸å¤„ç†çš„ã€‚è‡ªå·±å¤„ç†æ²¡å¿…è¦ï¼Œè€Œä¸”æ€§èƒ½ã€ç¨³å®šæ€§ä¹Ÿè¿œä¸å¦‚TCPçš„å®ç°é«˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1592189803,"ip_address":"","comment_id":226224,"utype":1}],"discussion_count":3,"race_medal":0,"score":"31656779456","product_id":100051201,"comment_content":"è€å¸ˆå¥½ï¼Œæˆ‘æœ‰ä¸€ä¸ªç–‘é—®æƒ³è¯·æ•™è€å¸ˆï¼Œåœ¨ä½¿ç”¨tcpæ¥ä¼ è¾“å¤§æ•°æ®åŒ…æ—¶ï¼Œæ¯”å¦‚2Mã€‚è¿™æ ·çš„æ•°æ®åŒ…åœ¨ä¸šåŠ¡ä¸­å¾ˆé¢‘ç¹å‡ºç°ï¼Œè¿™æ ·çš„æ•°æ®åŒ…æˆ‘ä»¬éœ€è¦åœ¨æˆ‘ä»¬çš„ä¸šåŠ¡ä»£ç å±‚é¢æ¥å®ç°æ‹†åŒ…åå‘é€ï¼Œè¿˜æ˜¯å°†æ‹†åŒ…çš„å·¥ä½œäº¤ç»™ç½‘ç»œè®¾å¤‡æ¥å¤„ç†ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿè°¢è°¢","like_count":8,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":498156,"discussion_content":"äº¤ç”±TCPä¼ è¾“å±‚æ¥å®ç°ï¼Œè¿™ä¸æ˜¯ç½‘ç»œè®¾å¤‡å¤„ç†çš„ï¼Œè€Œæ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸å¤„ç†çš„ã€‚è‡ªå·±å¤„ç†æ²¡å¿…è¦ï¼Œè€Œä¸”æ€§èƒ½ã€ç¨³å®šæ€§ä¹Ÿè¿œä¸å¦‚TCPçš„å®ç°é«˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592189803,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1807836,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/95/dc/07195a63.jpg","nickname":"é”‹","note":"","ucode":"F26BC1F14AB0D7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283128,"discussion_content":"å¥½çš„ è°¢è°¢è€å¸ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592191529,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2249227,"avatar":"https://static001.geekbang.org/account/avatar/00/22/52/0b/50bf0f05.jpg","nickname":"æ©™å­æ©™","note":"","ucode":"CD51367A14D955","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1807836,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/95/dc/07195a63.jpg","nickname":"é”‹","note":"","ucode":"F26BC1F14AB0D7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333412,"discussion_content":"1. 2MBåœ¨ä¸€ä¸ªreqä¸­å‘é€ç­‰rspçš„è¿”å›\n2. æŠŠreqæ‹†åˆ†æˆ200KB*10ä¸ªå°reqå¾ªç¯å‘é€,ç­‰rspè¿”å›\nè¿™ä¸¤ç§æƒ…å†µç¬¬äºŒç§åº”è¯¥ç›¸å¯¹å»¶è¿Ÿæ›´å°å§? å› æ­¤è¾¹å‘è¾¹æ”¶, ç±»ä¼¼æµæ°´çº¿çš„å½¢å¼å¤„ç†, ä¸çŸ¥é“è¿™æ ·ç†è§£å¯¹ä¸å¯¹.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607514884,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":283128,"ip_address":""},"score":333412,"extra":""}]}]},{"had_liked":false,"id":219796,"user_name":"å®‰æ’","can_delete":false,"product_type":"c1","uid":1260026,"ip_address":"","ucode":"F78CFA9624CAEF","user_header":"https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg","comment_is_top":false,"comment_ctime":1590102423,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"27359906199","product_id":100051201,"comment_content":"tcpçš„ç¼“å†²åŒºå ç”¨çš„buffer&#47;cacheä¸ç®—åœ¨è¿›ç¨‹çš„å†…å­˜ä¸­å—ï¼Ÿé‚£å¦‚æœç³»ç»Ÿå¼€äº†swapï¼Œè¿™äº›ç¼“å†²åŒºæ˜¯å¦ä¼šåœ¨å†…å­˜ç´§å¼ æ—¶è¢«å›æ”¶å‘¢ï¼Ÿ","like_count":6,"discussions":[{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"ä¸€æ­¥","note":"","ucode":"73CEA468CE70C3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":286686,"discussion_content":"ä¸ç®—ï¼Œ TCP è¿æ¥çš„å†…æ ¸ç¼“å­˜åŒº æ˜¯å†…æ ¸ç›´æ¥æ§åˆ¶çš„ã€‚æ­£å¸¸çš„æ—¶å€™ ï¼šå½“ TCP è¿æ¥æ–­å¼€çš„ï¼Œå†…æ ¸ç¼“å­˜åŒºçš„å†…å­˜ æ‰ä¼šè¢«å›æ”¶ ","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1593261622,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":229230,"user_name":"ä»£åå»º","can_delete":false,"product_type":"c1","uid":1477266,"ip_address":"","ucode":"B164F70AE50BE0","user_header":"https://static001.geekbang.org/account/avatar/00/16/8a/92/73a571ea.jpg","comment_is_top":false,"comment_ctime":1592927064,"is_pvip":false,"replies":[{"id":"84604","content":"ä½ å¥½ä»£åå»ºï¼Œå¦‚æœæ˜¯ä½å‹åŠ›ä¸‹ï¼Œç›´æ¥æ‰“å¼€debugæ—¥å¿—ï¼Œå¾ˆå®¹æ˜“æ‰¾åˆ°åŸå› ã€‚æ€§èƒ½å‹æµ‹ä¸­ï¼Œä¸ºé¿å…æ—¥å¿—è¿‡å¤šï¼Œå¦‚æœæŸä¸ªå®¢æˆ·ç«¯ä¼šå¼•å‘é—®é¢˜ï¼Œå¯ä»¥ç”¨debug_connectionæ¥è§£å†³é—®é¢˜ï¼Œå…·ä½“ç”¨æ³•å‚è§ã€ŠNginxæ ¸å¿ƒçŸ¥è¯†100è®²ã€‹ç¬¬143è¯¾ã€‚<br>å¦‚æœæ˜¯æ€§èƒ½å‹æµ‹ä¸‹ä¸æ¸…æ¥šé—®é¢˜çš„å¤ç°æ¡ä»¶ï¼Œä½ å¯ä»¥é€šè¿‡Nginxå˜é‡ï¼Œåœ¨access.logæˆ–è€…response headerä¸­çœ‹ä¸‹ç›¸åº”çš„æ—¶é—´æ¶ˆè€—ï¼Œæ¯”å¦‚$upstream_connect_timeå¯ä»¥æŸ¥çœ‹ä¸ä¸Šæ¸¸å»ºç«‹TCPè¿æ¥æ¶ˆè€—çš„æ—¶é—´ï¼Œç¡®å®šä¸‹æ˜¯å¦ä¸Šæ¸¸å»ºé“¾å‡ºç°é—®é¢˜","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1592965241,"ip_address":"","comment_id":229230,"utype":1}],"discussion_count":2,"race_medal":0,"score":"23067763544","product_id":100051201,"comment_content":"è€å¸ˆï¼Œä½ å¥½ï¼Œæˆ‘é¡¹ç›®ä¸Šç”¨äº†nginxåšä»£ç†ï¼Œä½†å¶å°”ä¼šå‡ºç°è¯·æ±‚å“åº”ç‰¹åˆ«å¿™æ…¢çš„æƒ…å†µ(20så·¦å³)ï¼Œç›®å‰ç³»ç»Ÿæš‚æœªä¸Šçº¿ï¼Œä¸å­˜åœ¨å¹¶å‘å½±å“æ€§èƒ½çš„é—®é¢˜ã€‚æˆ‘ä¹Ÿç”¨å‘½ä»¤çœ‹äº†è¯·æ±‚å·²åˆ°è¾¾ç½‘å¡ï¼Œå´ä¸çŸ¥é“nginxä¸ºä½•ä¸å“åº”ï¼Œæ—¥å¿—é—®é¢˜çœ‹ä¸åˆ°ä»€ä¹ˆé—®é¢˜ï¼Œè¯·æ•™ä¸‹æ’æŸ¥é—®é¢˜çš„æ€è·¯ï¼Œè°¢è°¢ï¼","like_count":6,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499389,"discussion_content":"ä½ å¥½ä»£åå»ºï¼Œå¦‚æœæ˜¯ä½å‹åŠ›ä¸‹ï¼Œç›´æ¥æ‰“å¼€debugæ—¥å¿—ï¼Œå¾ˆå®¹æ˜“æ‰¾åˆ°åŸå› ã€‚æ€§èƒ½å‹æµ‹ä¸­ï¼Œä¸ºé¿å…æ—¥å¿—è¿‡å¤šï¼Œå¦‚æœæŸä¸ªå®¢æˆ·ç«¯ä¼šå¼•å‘é—®é¢˜ï¼Œå¯ä»¥ç”¨debug_connectionæ¥è§£å†³é—®é¢˜ï¼Œå…·ä½“ç”¨æ³•å‚è§ã€ŠNginxæ ¸å¿ƒçŸ¥è¯†100è®²ã€‹ç¬¬143è¯¾ã€‚\nå¦‚æœæ˜¯æ€§èƒ½å‹æµ‹ä¸‹ä¸æ¸…æ¥šé—®é¢˜çš„å¤ç°æ¡ä»¶ï¼Œä½ å¯ä»¥é€šè¿‡Nginxå˜é‡ï¼Œåœ¨access.logæˆ–è€…response headerä¸­çœ‹ä¸‹ç›¸åº”çš„æ—¶é—´æ¶ˆè€—ï¼Œæ¯”å¦‚$upstream_connect_timeå¯ä»¥æŸ¥çœ‹ä¸ä¸Šæ¸¸å»ºç«‹TCPè¿æ¥æ¶ˆè€—çš„æ—¶é—´ï¼Œç¡®å®šä¸‹æ˜¯å¦ä¸Šæ¸¸å»ºé“¾å‡ºç°é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592965241,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1477266,"avatar":"https://static001.geekbang.org/account/avatar/00/16/8a/92/73a571ea.jpg","nickname":"ä»£åå»º","note":"","ucode":"B164F70AE50BE0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":285976,"discussion_content":"æ„Ÿè°¢è€å¸ˆï¼Œè°¢è°¢ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593002272,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":256847,"user_name":"kimileonis","can_delete":false,"product_type":"c1","uid":1029518,"ip_address":"","ucode":"05ADDFDD31D9C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b5/8e/d91f87a2.jpg","comment_is_top":false,"comment_ctime":1603765305,"is_pvip":false,"replies":[{"id":"93569","content":"ä¸æ˜¯ï¼Œnet.ipv4.tcp_memé™åˆ¶çš„æ˜¯æ‰€æœ‰TCPè¿æ¥çš„å†…å­˜å’Œï¼Œé’ˆå¯¹çš„æ˜¯ç³»ç»Ÿæ•´ä½“ï¼Œå®ƒçš„å•ä½æ˜¯é¡µé¢ï¼Œè€Œnet.ipv4.tcp_rmemåªæ˜¯å•ä¸ªTCPè¿æ¥çš„è¯»ç¼“å†²åŒºï¼Œå®ƒçš„å•ä½æ˜¯å­—èŠ‚","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1603845480,"ip_address":"","comment_id":256847,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14488667193","product_id":100051201,"comment_content":"è€å¸ˆï¼Œå½“ net.ipv4.tcp_rmem çš„å½“å‰å€¼è¶…è¿‡ net.ipv4.tcp_mem çš„ç¬¬ä¸‰ä¸ªå€¼ï¼Œå°±ä¸ä¼šæ¥å—å‘é€ç«¯æ–°çš„TCPè¯·æ±‚ï¼Œç›´åˆ° net.ipv4.tcp_rmem çš„å½“å‰å€¼å°äº net.ipv4.tcp_mem çš„ç¬¬ä¸‰ä¸ªå€¼åï¼Œæ‰ä¼šæ¥æ”¶æ–°çš„è¿æ¥è¯·æ±‚ï¼Œè¯·é—®è¿™ä¹ˆç†è§£å¯¹å—ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":508140,"discussion_content":"ä¸æ˜¯ï¼Œnet.ipv4.tcp_memé™åˆ¶çš„æ˜¯æ‰€æœ‰TCPè¿æ¥çš„å†…å­˜å’Œï¼Œé’ˆå¯¹çš„æ˜¯ç³»ç»Ÿæ•´ä½“ï¼Œå®ƒçš„å•ä½æ˜¯é¡µé¢ï¼Œè€Œnet.ipv4.tcp_rmemåªæ˜¯å•ä¸ªTCPè¿æ¥çš„è¯»ç¼“å†²åŒºï¼Œå®ƒçš„å•ä½æ˜¯å­—èŠ‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603845480,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":247134,"user_name":"Thinking","can_delete":false,"product_type":"c1","uid":1487135,"ip_address":"","ucode":"DAA051F237EF48","user_header":"https://static001.geekbang.org/account/avatar/00/16/b1/1f/c2793540.jpg","comment_is_top":false,"comment_ctime":1599616021,"is_pvip":false,"replies":[{"id":"90782","content":"å¸¦å®½å¤§å°ä¸æ˜¯é’ˆå¯¹TCPè¿æ¥çš„ï¼Œè¿™ä¸ªè¦æŸ¥ä¸‹ä½ çš„ç½‘ç»œè¿è¥å•†ã€äº¤æ¢æœºã€æ ¸å¿ƒè·¯ç”±å™¨æä¾›çš„ä¸Šã€ä¸‹è¡Œå¸¦å®½ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1599641701,"ip_address":"","comment_id":247134,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14484517909","product_id":100051201,"comment_content":"è¯·é—®ä¸€æ¡TCPè¿æ¥çš„å¸¦å®½æ—¶å»¶ç§¯ä¸­çš„å¸¦å®½å¤§å°å†…æ ¸å¦‚ä½•è®¡ç®—å‡ºæ¥çš„ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505320,"discussion_content":"å¸¦å®½å¤§å°ä¸æ˜¯é’ˆå¯¹TCPè¿æ¥çš„ï¼Œè¿™ä¸ªè¦æŸ¥ä¸‹ä½ çš„ç½‘ç»œè¿è¥å•†ã€äº¤æ¢æœºã€æ ¸å¿ƒè·¯ç”±å™¨æä¾›çš„ä¸Šã€ä¸‹è¡Œå¸¦å®½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599641701,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":238385,"user_name":"å¼ åä¸­-Blackc","can_delete":false,"product_type":"c1","uid":1392338,"ip_address":"","ucode":"CFDE6E945466A0","user_header":"https://static001.geekbang.org/account/avatar/00/15/3e/d2/624a3d59.jpg","comment_is_top":false,"comment_ctime":1596157269,"is_pvip":false,"replies":[{"id":"88328","content":"è¿™é‡Œæåˆ°äº†MSSï¼Œè¿™æ˜¯TCPåè®®æ‰æœ‰çš„æ¦‚å¿µï¼ŒTCPåè®®æ˜¯ç”±æ“ä½œç³»ç»Ÿå®ç°çš„ï¼Œå³ä½¿åº”ç”¨å±‚è°ƒç”¨äº†2æ¬¡writeå‡½æ•°ï¼ŒTCPå±‚æœ‰å¯èƒ½å°†å®ƒåˆå¹¶ä¸º1ä¸ªæŠ¥æ–‡ï¼›åŒæ—¶ï¼Œåº”ç”¨å±‚è°ƒç”¨äº†1æ¬¡writeå‡½æ•°ï¼ŒTCPå¯èƒ½å°†å…¶åˆ‡å‰²ä¸º10ä¸ªæŠ¥æ–‡","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1596440694,"ip_address":"","comment_id":238385,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14481059157","product_id":100051201,"comment_content":"æ¯”å¦‚ï¼Œå‘é€ä¸€ä¸ª 100MB çš„æ–‡ä»¶ï¼Œå¦‚æœ MSS å€¼ä¸º 1KBï¼Œé‚£ä¹ˆéœ€è¦å‘é€çº¦ 10 ä¸‡ä¸ªæŠ¥æ–‡ã€‚å‘é€æ–¹å¤§å¯ä»¥åŒæ—¶å‘é€è¿™ 10 ä¸‡ä¸ªæŠ¥æ–‡ï¼Œå†ç­‰å¾…å®ƒä»¬çš„ ACK ç¡®è®¤ã€‚è¿™æ ·ï¼Œå‘é€é€Ÿåº¦ç¬é—´å°±è¾¾åˆ° 100MB&#47;10ms=10GB&#47;sã€‚<br><br>è¿™é‡Œå‘é€æ–¹åŒæ—¶å‘é€10ä¸‡ä¸ªæŠ¥æ–‡æ˜¯éœ€è¦åº”ç”¨å±‚åšï¼Œè¿˜æ˜¯è¯´æ“ä½œç³»ç»Ÿé»˜è®¤å°±æ˜¯è¿™ä¹ˆåšçš„ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":502733,"discussion_content":"è¿™é‡Œæåˆ°äº†MSSï¼Œè¿™æ˜¯TCPåè®®æ‰æœ‰çš„æ¦‚å¿µï¼ŒTCPåè®®æ˜¯ç”±æ“ä½œç³»ç»Ÿå®ç°çš„ï¼Œå³ä½¿åº”ç”¨å±‚è°ƒç”¨äº†2æ¬¡writeå‡½æ•°ï¼ŒTCPå±‚æœ‰å¯èƒ½å°†å®ƒåˆå¹¶ä¸º1ä¸ªæŠ¥æ–‡ï¼›åŒæ—¶ï¼Œåº”ç”¨å±‚è°ƒç”¨äº†1æ¬¡writeå‡½æ•°ï¼ŒTCPå¯èƒ½å°†å…¶åˆ‡å‰²ä¸º10ä¸ªæŠ¥æ–‡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596440694,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":262206,"user_name":"Only now","can_delete":false,"product_type":"c1","uid":1038574,"ip_address":"","ucode":"C617473A03AE27","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d8/ee/6e7c2264.jpg","comment_is_top":false,"comment_ctime":1605664859,"is_pvip":false,"replies":[{"id":"95269","content":"å–æœ€å°çš„ä¸€æ®µï¼Œæ—¶å»¶å–è¿æ¥åŒæ–¹é—´çš„pingå€¼","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1605764413,"ip_address":"","comment_id":262206,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10195599451","product_id":100051201,"comment_content":"è¿™é‡Œè®¾ç½®çš„å¸¦å®½æ—¶å»¶ç§¯æ˜¯ä»å“ªé‡Œæ¥çš„ï¼Ÿ<br>æˆ‘æœ‰ä¸€ç§æœ‰ç½‘ç»œPriNetï¼Œ å…¶å†…éƒ¨å¸¦å®½1G bit&#47;sï¼Œä½†æ˜¯å‡ºå£å¸¦å®½5M&#47;sï¼Œé‚£ä¹ˆç½‘ç»œå†…çš„æœåŠ¡å™¨è°ƒæ•´å‚æ•°æ˜¯ï¼Œå¸¦å®½æ—¶å»¶ç§¯è®¡ç®—ï¼Œè¿™ä¸ªå¸¦å®½å’Œæ—¶å»¶åˆ†åˆ«å–å“ªä¸€æ®µï¼Ÿï¼Ÿï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":509734,"discussion_content":"å–æœ€å°çš„ä¸€æ®µï¼Œæ—¶å»¶å–è¿æ¥åŒæ–¹é—´çš„pingå€¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605764413,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":229138,"user_name":"Bourne","can_delete":false,"product_type":"c1","uid":1311299,"ip_address":"","ucode":"1286279F70B13F","user_header":"https://static001.geekbang.org/account/avatar/00/14/02/43/1c2fb7b3.jpg","comment_is_top":false,"comment_ctime":1592905688,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10182840280","product_id":100051201,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæˆ‘æœ‰ä¸¤ä¸ªç–‘é—®ï¼š<br>1ã€ä¸€ä¸ªTCPè¿æ¥åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ˜¯éƒ½ä¼šæœ‰ä¸¤ä¸ªå†…å­˜ç¼“å†²åŒºå—ï¼Œä¸€ä¸ªæ¥æ”¶ç¼“å†²åŒºï¼Œä¸€ä¸ªå‘é€ç¼“å†²åŒºï¼Ÿè¿˜æ˜¯è¯´å„åªæœ‰ä¸€ä¸ªç¼“å†²åŒºï¼Œæ¥æ”¶å’Œå‘é€å…±ç”¨ï¼Ÿ<br>2ã€æ–‡ç« è¯´çš„å¸¦å®½æ—¶å»¶ç§¯æ˜¯ç”¨å¸¦å®½ä¹˜ä»¥æ—¶å»¶ï¼Œè¿™é‡Œçš„å¸¦å®½æ˜¯æŒ‡å®¢æˆ·ç«¯çš„è¿˜æ˜¯æœåŠ¡ç«¯çš„ï¼Ÿå› ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„å¸¦å®½ä¸å¯èƒ½éƒ½ä¸€æ ·ï¼Œæ‰€ä»¥ç®—å‡ºæ¥çš„æ—¶å»¶ç§¯æ˜¯ä¸åŒçš„ã€‚","like_count":2,"discussions":[{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"ä¸€æ­¥","note":"","ucode":"73CEA468CE70C3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":286688,"discussion_content":"1: å› ä¸º TCP çš„æ•°æ®å¯ä»¥åŒå‘ä¼ è¾“æ•°æ®çš„ï¼Œ æ‰€ä»¥ç¼“å†²åŒºæ˜¯æœ‰2ä¸ªçš„ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªå°±ä¼šæ··ä¹±ï¼Œåœ¨è®¾è®¡ä¸Šä¹Ÿæ˜¯ä¸è¡Œçš„\n2: è¿™é‡Œæ˜¯æœåŠ¡ç«¯çš„å¸¦å®½ï¼Œå®¢æˆ·ç«¯çš„å¸¦å®½ä½ æ˜¯æ²¡åŠæ³•çŸ¥é“çš„ã€‚æˆ‘åªéœ€è¦æ§åˆ¶æœåŠ¡ç«¯çš„æœ€å¤§å¤„ç†èƒ½åŠ›å°±å¯ä»¥äº†","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1593262202,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":226164,"user_name":"stackWarn","can_delete":false,"product_type":"c1","uid":1002005,"ip_address":"","ucode":"89672E452DEBA5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4a/15/106eaaa8.jpg","comment_is_top":false,"comment_ctime":1591969017,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10181903609","product_id":100051201,"comment_content":"ç›¸å…³çš„å†…å­˜é…ç½®åœ¨nginxè°ƒä¼˜ä¸­ä½¿ç”¨è¿‡ï¼Œè¿™æ¬¡ç»ˆäºä»å‰åˆ°åç†è§£äº†æ„ä¹‰","like_count":2},{"had_liked":false,"id":266885,"user_name":"æ©™å­æ©™","can_delete":false,"product_type":"c1","uid":2249227,"ip_address":"","ucode":"CD51367A14D955","user_header":"https://static001.geekbang.org/account/avatar/00/22/52/0b/50bf0f05.jpg","comment_is_top":false,"comment_ctime":1607515104,"is_pvip":false,"replies":[{"id":"97244","content":"æ‰€ä»¥serverçš„å…¥æµé‡æ˜¯æ¯ç§’2GBï¼ˆ2MB*1000ï¼‰ï¼Œå‡ºæµé‡æ˜¯20GBï¼Ÿä»€ä¹ˆç½‘å¡ï¼Ÿ<br>æˆ–è€…è¯´ï¼Œæ¯ä¸ªè¯·æ±‚æ¯æ¬¡å‘é€2KBï¼ŒæœåŠ¡å™¨è¿”å›20KBå—ï¼Ÿå¦‚æœæ˜¯è¿™ç§æµé‡ï¼Œdpdkæ•ˆæœä¸æ˜æ˜¾ï¼Œä½†ä¼šå¢å¤§ç³»ç»Ÿè€¦åˆæ€§ä»¥åŠå¤æ‚åº¦ï¼Œæ­¤æ—¶å®ƒä¸€èˆ¬ä¸æ˜¯ä¸»è¦çš„æ€§èƒ½ç“¶é¢ˆï¼Œdpdkä¸»è¦ä¼˜åŒ–äº†ç½‘ç»œå±‚åè®®æ ˆçš„å¤„ç†é€Ÿåº¦","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1607908989,"ip_address":"","comment_id":266885,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5902482400","product_id":100051201,"comment_content":"è€å¸ˆ ç›®å‰è¯·æ±‚1000qps, clientæ¯æ¬¡å‘é€2MBæ•°æ®, æœåŠ¡å™¨è¿”å›20MBæ•°æ®, è¦æ±‚æ¯ä¸ªè¯·æ±‚clientç«¯rtt 50mså†…, ä¸çŸ¥é“æœ‰æ²¡æœ‰å¯èƒ½?<br>è¿˜æœ‰è€å¸ˆå¯¹dpdkæ˜¯ä»€ä¹ˆçœ‹æ³•, é’ˆå¯¹è¿™ä¸ªåœºæ™¯æœ‰æ²¡æœ‰å¯èƒ½ä½¿ç”¨dpdkä¼˜åŒ–?","like_count":1,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511431,"discussion_content":"æ‰€ä»¥serverçš„å…¥æµé‡æ˜¯æ¯ç§’2GBï¼ˆ2MB*1000ï¼‰ï¼Œå‡ºæµé‡æ˜¯20GBï¼Ÿä»€ä¹ˆç½‘å¡ï¼Ÿ\næˆ–è€…è¯´ï¼Œæ¯ä¸ªè¯·æ±‚æ¯æ¬¡å‘é€2KBï¼ŒæœåŠ¡å™¨è¿”å›20KBå—ï¼Ÿå¦‚æœæ˜¯è¿™ç§æµé‡ï¼Œdpdkæ•ˆæœä¸æ˜æ˜¾ï¼Œä½†ä¼šå¢å¤§ç³»ç»Ÿè€¦åˆæ€§ä»¥åŠå¤æ‚åº¦ï¼Œæ­¤æ—¶å®ƒä¸€èˆ¬ä¸æ˜¯ä¸»è¦çš„æ€§èƒ½ç“¶é¢ˆï¼Œdpdkä¸»è¦ä¼˜åŒ–äº†ç½‘ç»œå±‚åè®®æ ˆçš„å¤„ç†é€Ÿåº¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607908989,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2249227,"avatar":"https://static001.geekbang.org/account/avatar/00/22/52/0b/50bf0f05.jpg","nickname":"æ©™å­æ©™","note":"","ucode":"CD51367A14D955","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333603,"discussion_content":"è¡¥å……ä¸‹ï¼š åƒå…†ç½‘å¡ clientå’Œserverä¸åŒæœºå™¨ ping rtt: 0.25ms\n\næœåŠ¡ç«¯æŠŠ20MBæ•°æ®å‘é€åˆ°å®¢æˆ·ç«¯å°±éœ€è¦510ms  ç½‘å¡20MB/s  \ntcp_send_buffer/tcp_recv_bufferè®¾ç½®çš„1MB\næƒ³è¯·æ•™ä¸‹è€å¸ˆ:è¿™ä¸ªå»¶è¿Ÿæ­£å¸¸å—?\n\nå…‰å‘é€20Mæ•°æ®éƒ½500ms, ä¹‹å‰éœ€æ±‚æ˜¯50ms...ä¸çŸ¥é“æ€ä¹ˆä¼˜åŒ–..\nç”¨wiresharkçœ‹äº†æ—¶åºå›¾ æ˜¾ç¤ºæ¯æ¬¡ä¼ è¾“åæœ‰ä¸€ä¸ª1sçš„å¹³å°æœŸ..\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607572645,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":221541,"user_name":"Trident","can_delete":false,"product_type":"c1","uid":1609530,"ip_address":"","ucode":"53E6788CF33398","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/l4nngwyggBGqeMXC0micwO8bM1hSttgQXa1Y5frJSqWa8NibDhia5icwPcHM5wOpV3hfsf0UicDY0ypFqnQ3iarG0T1w/132","comment_is_top":false,"comment_ctime":1590537604,"is_pvip":false,"replies":[{"id":"81711","content":"æ˜¯çš„ï¼Œéœ€è¦å¤šæ¬¡å–æ ·åšä¼°ç®—ï¼Œå†ä¹˜ä»¥å¸¦å®½","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1590547586,"ip_address":"","comment_id":221541,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5885504900","product_id":100051201,"comment_content":"å¸¦å®½æ—¶å»¶ç§¯å¦‚ä½•è¡¡é‡å‘¢ï¼Œç½‘ç»œæ—¶å»¶ä¸æ˜¯å›ºå®šçš„ï¼Œæ˜¯è¦å¤šæ¬¡å–æ ·è®¡ç®—å¹³å‡ç½‘ç»œæ—¶å»¶ï¼Ÿç„¶åä¼°ç®—å‡ºè¿™ä¸ªæ—¶å»¶ç§¯","like_count":1,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496485,"discussion_content":"æ˜¯çš„ï¼Œéœ€è¦å¤šæ¬¡å–æ ·åšä¼°ç®—ï¼Œå†ä¹˜ä»¥å¸¦å®½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590547586,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":220046,"user_name":"leslie","can_delete":false,"product_type":"c1","uid":1324255,"ip_address":"","ucode":"798E7C1CC98CC2","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/df/64e3d533.jpg","comment_is_top":false,"comment_ctime":1590143189,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5885110485","product_id":100051201,"comment_content":"å»ºç«‹å’Œé‡Šæ”¾ä»¥åŠä¸ºäº†è¿æ¥æ•°è€Œæ»‘åŠ¨åˆé€‚è®¾ç½®å€¼ï¼Œè¿™ä¸ªåªèƒ½é€šè¿‡ä¸æ–­çš„è§‚å¯Ÿå»è°ƒæ•´é€‚åº”ä¸»è¦æ—¶é—´æ®µçš„ä¸šåŠ¡ï¼›å‡è¡¡çš„è®¾è®¡è€ƒè™‘ç¡®å®ä¸æ˜“ã€‚","like_count":1},{"had_liked":false,"id":287203,"user_name":"airmyä¸¶","can_delete":false,"product_type":"c1","uid":1299673,"ip_address":"","ucode":"41959C9F5B4B65","user_header":"https://static001.geekbang.org/account/avatar/00/13/d4/d9/c3296187.jpg","comment_is_top":false,"comment_ctime":1617818350,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1617818350","product_id":100051201,"comment_content":"â€œæé€Ÿçš„æ–¹å¼å¾ˆç®€å•ï¼Œå¹¶è¡Œåœ°æ‰¹é‡å‘é€æŠ¥æ–‡ï¼Œå†æ‰¹é‡ç¡®è®¤æŠ¥æ–‡å³å¯â€œ è¿™ç§å¤„ç†æ–¹å¼ï¼Œå¦‚æœåŠ ä¸Šæ»‘åŠ¨çª—å£ã€‚ACKè¿”å›çš„çª—å£å¤§å°æ˜¯ä¸æ˜¯å‡ºå…¥å¾ˆå¤§(ACKè¿”å›æœŸé—´æœåŠ¡å™¨åˆæ¥å—äº†å…¶ä»–çš„æŠ¥æ–‡)ï¼Ÿ","like_count":0},{"had_liked":false,"id":256845,"user_name":"kimileonis","can_delete":false,"product_type":"c1","uid":1029518,"ip_address":"","ucode":"05ADDFDD31D9C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b5/8e/d91f87a2.jpg","comment_is_top":false,"comment_ctime":1603764955,"is_pvip":false,"replies":[{"id":"93571","content":"å‚è§ä¸Šä¸€ä¸ªå›ç­”^_^","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1603845682,"ip_address":"","comment_id":256845,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1603764955","product_id":100051201,"comment_content":"è€å¸ˆï¼Œå½“ net.ipv4.tcp_rmem çš„å½“å‰å€¼è¶…è¿‡ net.ipv4.tcp_mem çš„ç¬¬ä¸‰ä¸ªå€¼ï¼Œå°±ä¸ä¼šæ¥å—å‘é€ç«¯æ–°çš„TCPè¯·æ±‚ï¼Œç›´åˆ° net.ipv4.tcp_rmem çš„å½“å‰å€¼å°äº net.ipv4.tcp_mem çš„ç¬¬ä¸‰ä¸ªå€¼åï¼Œæ‰ä¼šæ¥æ”¶æ–°çš„è¿æ¥è¯·æ±‚ï¼Œè¯·é—®è¿™ä¹ˆç†è§£å¯¹å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":508138,"discussion_content":"å‚è§ä¸Šä¸€ä¸ªå›ç­”^_^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603845682,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":235484,"user_name":"å¦¥å","can_delete":false,"product_type":"c1","uid":1249656,"ip_address":"","ucode":"7201DFE9C12669","user_header":"https://static001.geekbang.org/account/avatar/00/13/11/78/4f0cd172.jpg","comment_is_top":false,"comment_ctime":1595059364,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595059364","product_id":100051201,"comment_content":"è¯·æ•™è€å¸ˆï¼Œnet.ipv4.tcp_wmemï¼Œnet.ipv4.tcp_rmemè¿™ä¸¤ä¸ªè®¾ç½®æ˜¯é’ˆå¯¹å•ä¸ªTCPè¿æ¥çš„å‘é€ç¼“å†²åŒºå’Œæ¥æ”¶ç¼“å†²åŒºå§ï¼Ÿnet.ipv4.tcp_memæ˜¯æŒ‡æ‰€æœ‰TCPå†…å­˜å§ï¼Ÿ","like_count":0},{"had_liked":false,"id":230725,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1593478821,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593478821","product_id":100051201,"comment_content":"çœ‹äº†ä¸¤éï¼Œæ‰æ€»ä½“æœ‰äº†æ„Ÿè§‰","like_count":0}]}