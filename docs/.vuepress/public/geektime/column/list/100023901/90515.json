{"id":90515,"title":"21 | åŸå­ç±»ï¼šæ— é”å·¥å…·ç±»çš„å…¸èŒƒ","content":"<p>å‰é¢æˆ‘ä»¬å¤šæ¬¡æåˆ°ä¸€ä¸ªç´¯åŠ å™¨çš„ä¾‹å­ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œadd10K()è¿™ä¸ªæ–¹æ³•ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œé—®é¢˜å°±å‡ºåœ¨å˜é‡countçš„å¯è§æ€§å’Œcount+=1çš„åŸå­æ€§ä¸Šã€‚å¯è§æ€§é—®é¢˜å¯ä»¥ç”¨volatileæ¥è§£å†³ï¼Œè€ŒåŸå­æ€§é—®é¢˜æˆ‘ä»¬å‰é¢ä¸€ç›´éƒ½æ˜¯é‡‡ç”¨çš„äº’æ–¥é”æ–¹æ¡ˆã€‚</p><pre><code>public class Test {\n  long count = 0;\n  void add10K() {\n    int idx = 0;\n    while(idx++ &lt; 10000) {\n      count += 1;\n    }\n  }\n}\n</code></pre><p>å…¶å®å¯¹äºç®€å•çš„åŸå­æ€§é—®é¢˜ï¼Œè¿˜æœ‰ä¸€ç§<strong>æ— é”æ–¹æ¡ˆ</strong>ã€‚Java SDKå¹¶å‘åŒ…å°†è¿™ç§æ— é”æ–¹æ¡ˆå°è£…æç‚¼ä¹‹åï¼Œå®ç°äº†ä¸€ç³»åˆ—çš„åŸå­ç±»ã€‚ä¸è¿‡ï¼Œåœ¨æ·±å…¥ä»‹ç»åŸå­ç±»çš„å®ç°ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹å¦‚ä½•åˆ©ç”¨åŸå­ç±»è§£å†³ç´¯åŠ å™¨é—®é¢˜ï¼Œè¿™æ ·ä½ ä¼šå¯¹åŸå­ç±»æœ‰ä¸ªåˆæ­¥çš„è®¤è¯†ã€‚</p><p>åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å°†åŸæ¥çš„longå‹å˜é‡countæ›¿æ¢ä¸ºäº†åŸå­ç±»AtomicLongï¼ŒåŸæ¥çš„ <code>count +=1</code> æ›¿æ¢æˆäº† count.getAndIncrement()ï¼Œä»…éœ€è¦è¿™ä¸¤å¤„ç®€å•çš„æ”¹åŠ¨å°±èƒ½ä½¿add10K()æ–¹æ³•å˜æˆçº¿ç¨‹å®‰å…¨çš„ï¼ŒåŸå­ç±»çš„ä½¿ç”¨è¿˜æ˜¯æŒºç®€å•çš„ã€‚</p><pre><code>public class Test {\n  AtomicLong count = \n    new AtomicLong(0);\n  void add10K() {\n    int idx = 0;\n    while(idx++ &lt; 10000) {\n      count.getAndIncrement();\n    }\n  }\n}\n</code></pre><p>æ— é”æ–¹æ¡ˆç›¸å¯¹äº’æ–¥é”æ–¹æ¡ˆï¼Œæœ€å¤§çš„å¥½å¤„å°±æ˜¯<strong>æ€§èƒ½</strong>ã€‚äº’æ–¥é”æ–¹æ¡ˆä¸ºäº†ä¿è¯äº’æ–¥æ€§ï¼Œéœ€è¦æ‰§è¡ŒåŠ é”ã€è§£é”æ“ä½œï¼Œè€ŒåŠ é”ã€è§£é”æ“ä½œæœ¬èº«å°±æ¶ˆè€—æ€§èƒ½ï¼›åŒæ—¶æ‹¿ä¸åˆ°é”çš„çº¿ç¨‹è¿˜ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè¿›è€Œè§¦å‘çº¿ç¨‹åˆ‡æ¢ï¼Œçº¿ç¨‹åˆ‡æ¢å¯¹æ€§èƒ½çš„æ¶ˆè€—ä¹Ÿå¾ˆå¤§ã€‚ ç›¸æ¯”ä¹‹ä¸‹ï¼Œæ— é”æ–¹æ¡ˆåˆ™å®Œå…¨æ²¡æœ‰åŠ é”ã€è§£é”çš„æ€§èƒ½æ¶ˆè€—ï¼ŒåŒæ—¶è¿˜èƒ½ä¿è¯äº’æ–¥æ€§ï¼Œæ—¢è§£å†³äº†é—®é¢˜ï¼Œåˆæ²¡æœ‰å¸¦æ¥æ–°çš„é—®é¢˜ï¼Œå¯è°“ç»ä½³æ–¹æ¡ˆã€‚é‚£å®ƒæ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿ</p><!-- [[[read_end]]] --><h2>æ— é”æ–¹æ¡ˆçš„å®ç°åŸç†</h2><p>å…¶å®åŸå­ç±»æ€§èƒ½é«˜çš„ç§˜å¯†å¾ˆç®€å•ï¼Œç¡¬ä»¶æ”¯æŒè€Œå·²ã€‚CPUä¸ºäº†è§£å†³å¹¶å‘é—®é¢˜ï¼Œæä¾›äº†CASæŒ‡ä»¤ï¼ˆCASï¼Œå…¨ç§°æ˜¯Compare And Swapï¼Œå³â€œæ¯”è¾ƒå¹¶äº¤æ¢â€ï¼‰ã€‚CASæŒ‡ä»¤åŒ…å«3ä¸ªå‚æ•°ï¼šå…±äº«å˜é‡çš„å†…å­˜åœ°å€Aã€ç”¨äºæ¯”è¾ƒçš„å€¼Bå’Œå…±äº«å˜é‡çš„æ–°å€¼Cï¼›å¹¶ä¸”åªæœ‰å½“å†…å­˜ä¸­åœ°å€Aå¤„çš„å€¼ç­‰äºBæ—¶ï¼Œæ‰èƒ½å°†å†…å­˜ä¸­åœ°å€Aå¤„çš„å€¼æ›´æ–°ä¸ºæ–°å€¼Cã€‚<strong>ä½œä¸ºä¸€æ¡CPUæŒ‡ä»¤ï¼ŒCASæŒ‡ä»¤æœ¬èº«æ˜¯èƒ½å¤Ÿä¿è¯åŸå­æ€§çš„</strong>ã€‚</p><p>ä½ å¯ä»¥é€šè¿‡ä¸‹é¢CASæŒ‡ä»¤çš„æ¨¡æ‹Ÿä»£ç æ¥ç†è§£CASçš„å·¥ä½œåŸç†ã€‚åœ¨ä¸‹é¢çš„æ¨¡æ‹Ÿç¨‹åºä¸­æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯æœŸæœ›å€¼expectï¼Œå¦ä¸€ä¸ªæ˜¯éœ€è¦å†™å…¥çš„æ–°å€¼newValueï¼Œ<strong>åªæœ‰å½“ç›®å‰countçš„å€¼å’ŒæœŸæœ›å€¼expectç›¸ç­‰æ—¶ï¼Œæ‰ä¼šå°†countæ›´æ–°ä¸ºnewValue</strong>ã€‚</p><pre><code>class SimulatedCAS{\n  int countï¼›\n  synchronized int cas(\n    int expect, int newValue){\n    // è¯»ç›®å‰countçš„å€¼\n    int curValue = count;\n    // æ¯”è¾ƒç›®å‰countå€¼æ˜¯å¦==æœŸæœ›å€¼\n    if(curValue == expect){\n      // å¦‚æœæ˜¯ï¼Œåˆ™æ›´æ–°countçš„å€¼\n      count = newValue;\n    }\n    // è¿”å›å†™å…¥å‰çš„å€¼\n    return curValue;\n  }\n}\n</code></pre><p>ä½ ä»”ç»†åœ°å†æ¬¡æ€è€ƒä¸€ä¸‹è¿™å¥è¯ï¼Œâ€œ<strong>åªæœ‰å½“ç›®å‰countçš„å€¼å’ŒæœŸæœ›å€¼expectç›¸ç­‰æ—¶ï¼Œæ‰ä¼šå°†countæ›´æ–°ä¸ºnewValueã€‚</strong>â€è¦æ€ä¹ˆç†è§£è¿™å¥è¯å‘¢ï¼Ÿ</p><p>å¯¹äºå‰é¢æåˆ°çš„ç´¯åŠ å™¨çš„ä¾‹å­ï¼Œ<code>count += 1</code> çš„ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜æ˜¯ï¼šåŸºäºå†…å­˜ä¸­countçš„å½“å‰å€¼Aè®¡ç®—å‡ºæ¥çš„count+=1ä¸ºA+1ï¼Œåœ¨å°†A+1å†™å…¥å†…å­˜çš„æ—¶å€™ï¼Œå¾ˆå¯èƒ½æ­¤æ—¶å†…å­˜ä¸­countå·²ç»è¢«å…¶ä»–çº¿ç¨‹æ›´æ–°è¿‡äº†ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´é”™è¯¯åœ°è¦†ç›–å…¶ä»–çº¿ç¨‹å†™å…¥çš„å€¼ï¼ˆå¦‚æœä½ è§‰å¾—ç†è§£èµ·æ¥è¿˜æœ‰å›°éš¾ï¼Œå»ºè®®ä½ å†é‡æ–°çœ‹çœ‹<a href=\"https://time.geekbang.org/column/article/83682\">ã€Š01 | å¯è§æ€§ã€åŸå­æ€§å’Œæœ‰åºæ€§é—®é¢˜ï¼šå¹¶å‘ç¼–ç¨‹Bugçš„æºå¤´ã€‹</a>ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰å½“å†…å­˜ä¸­countçš„å€¼ç­‰äºæœŸæœ›å€¼Aæ—¶ï¼Œæ‰èƒ½å°†å†…å­˜ä¸­countçš„å€¼æ›´æ–°ä¸ºè®¡ç®—ç»“æœA+1ï¼Œè¿™ä¸å°±æ˜¯CASçš„è¯­ä¹‰å—ï¼</p><p>ä½¿ç”¨CASæ¥è§£å†³å¹¶å‘é—®é¢˜ï¼Œä¸€èˆ¬éƒ½ä¼šä¼´éšç€è‡ªæ—‹ï¼Œè€Œæ‰€è°“è‡ªæ—‹ï¼Œå…¶å®å°±æ˜¯å¾ªç¯å°è¯•ã€‚ä¾‹å¦‚ï¼Œå®ç°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„<code>count += 1</code>æ“ä½œï¼Œâ€œCAS+è‡ªæ—‹â€çš„å®ç°æ–¹æ¡ˆå¦‚ä¸‹æ‰€ç¤ºï¼Œé¦–å…ˆè®¡ç®—newValue = count+1ï¼Œå¦‚æœcas(count,newValue)è¿”å›çš„å€¼ä¸ç­‰äºcountï¼Œåˆ™æ„å‘³ç€çº¿ç¨‹åœ¨æ‰§è¡Œå®Œä»£ç â‘ å¤„ä¹‹åï¼Œæ‰§è¡Œä»£ç â‘¡å¤„ä¹‹å‰ï¼Œcountçš„å€¼è¢«å…¶ä»–çº¿ç¨‹æ›´æ–°è¿‡ã€‚é‚£æ­¤æ—¶è¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿå¯ä»¥é‡‡ç”¨è‡ªæ—‹æ–¹æ¡ˆï¼Œå°±åƒä¸‹é¢ä»£ç ä¸­å±•ç¤ºçš„ï¼Œå¯ä»¥é‡æ–°è¯»countæœ€æ–°çš„å€¼æ¥è®¡ç®—newValueå¹¶å°è¯•å†æ¬¡æ›´æ–°ï¼Œç›´åˆ°æˆåŠŸã€‚</p><pre><code>class SimulatedCAS{\n  volatile int count;\n  // å®ç°count+=1\n  addOne(){\n    do {\n      newValue = count+1; //â‘ \n    }while(count !=\n      cas(count,newValue) //â‘¡\n  }\n  // æ¨¡æ‹Ÿå®ç°CASï¼Œä»…ç”¨æ¥å¸®åŠ©ç†è§£\n  synchronized int cas(\n    int expect, int newValue){\n    // è¯»ç›®å‰countçš„å€¼\n    int curValue = count;\n    // æ¯”è¾ƒç›®å‰countå€¼æ˜¯å¦==æœŸæœ›å€¼\n    if(curValue == expect){\n      // å¦‚æœæ˜¯ï¼Œåˆ™æ›´æ–°countçš„å€¼\n      count= newValue;\n    }\n    // è¿”å›å†™å…¥å‰çš„å€¼\n    return curValue;\n  }\n}\n</code></pre><p>é€šè¿‡ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ï¼Œæƒ³å¿…ä½ å·²ç»å‘ç°äº†ï¼ŒCASè¿™ç§æ— é”æ–¹æ¡ˆï¼Œå®Œå…¨æ²¡æœ‰åŠ é”ã€è§£é”æ“ä½œï¼Œå³ä¾¿ä¸¤ä¸ªçº¿ç¨‹å®Œå…¨åŒæ—¶æ‰§è¡ŒaddOne()æ–¹æ³•ï¼Œä¹Ÿä¸ä¼šæœ‰çº¿ç¨‹è¢«é˜»å¡ï¼Œæ‰€ä»¥ç›¸å¯¹äºäº’æ–¥é”æ–¹æ¡ˆæ¥è¯´ï¼Œæ€§èƒ½å¥½äº†å¾ˆå¤šã€‚</p><p>ä½†æ˜¯åœ¨CASæ–¹æ¡ˆä¸­ï¼Œæœ‰ä¸€ä¸ªé—®é¢˜å¯èƒ½ä¼šå¸¸è¢«ä½ å¿½ç•¥ï¼Œé‚£å°±æ˜¯<strong>ABA</strong>çš„é—®é¢˜ã€‚ä»€ä¹ˆæ˜¯ABAé—®é¢˜å‘¢ï¼Ÿ</p><p>å‰é¢æˆ‘ä»¬æåˆ°â€œå¦‚æœcas(count,newValue)è¿”å›çš„å€¼<strong>ä¸ç­‰äº</strong>countï¼Œæ„å‘³ç€çº¿ç¨‹åœ¨æ‰§è¡Œå®Œä»£ç â‘ å¤„ä¹‹åï¼Œæ‰§è¡Œä»£ç â‘¡å¤„ä¹‹å‰ï¼Œcountçš„å€¼è¢«å…¶ä»–çº¿ç¨‹<strong>æ›´æ–°è¿‡</strong>â€ï¼Œé‚£å¦‚æœcas(count,newValue)è¿”å›çš„å€¼<strong>ç­‰äº</strong>countï¼Œæ˜¯å¦å°±èƒ½å¤Ÿè®¤ä¸ºcountçš„å€¼æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹<strong>æ›´æ–°è¿‡</strong>å‘¢ï¼Ÿæ˜¾ç„¶ä¸æ˜¯çš„ï¼Œå‡è®¾countåŸæœ¬æ˜¯Aï¼Œçº¿ç¨‹T1åœ¨æ‰§è¡Œå®Œä»£ç â‘ å¤„ä¹‹åï¼Œæ‰§è¡Œä»£ç â‘¡å¤„ä¹‹å‰ï¼Œæœ‰å¯èƒ½countè¢«çº¿ç¨‹T2æ›´æ–°æˆäº†Bï¼Œä¹‹ååˆè¢«T3æ›´æ–°å›äº†Aï¼Œè¿™æ ·çº¿ç¨‹T1è™½ç„¶çœ‹åˆ°çš„ä¸€ç›´æ˜¯Aï¼Œä½†æ˜¯å…¶å®å·²ç»è¢«å…¶ä»–çº¿ç¨‹æ›´æ–°è¿‡äº†ï¼Œè¿™å°±æ˜¯ABAé—®é¢˜ã€‚</p><p>å¯èƒ½å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬å¹¶ä¸å…³å¿ƒABAé—®é¢˜ï¼Œä¾‹å¦‚æ•°å€¼çš„åŸå­é€’å¢ï¼Œä½†ä¹Ÿä¸èƒ½æ‰€æœ‰æƒ…å†µä¸‹éƒ½ä¸å…³å¿ƒï¼Œä¾‹å¦‚åŸå­åŒ–çš„æ›´æ–°å¯¹è±¡å¾ˆå¯èƒ½å°±éœ€è¦å…³å¿ƒABAé—®é¢˜ï¼Œå› ä¸ºä¸¤ä¸ªAè™½ç„¶ç›¸ç­‰ï¼Œä½†æ˜¯ç¬¬äºŒä¸ªAçš„å±æ€§å¯èƒ½å·²ç»å‘ç”Ÿå˜åŒ–äº†ã€‚æ‰€ä»¥åœ¨ä½¿ç”¨CASæ–¹æ¡ˆçš„æ—¶å€™ï¼Œä¸€å®šè¦å…ˆcheckä¸€ä¸‹ã€‚</p><h2>çœ‹Javaå¦‚ä½•å®ç°åŸå­åŒ–çš„count += 1</h2><p>åœ¨æœ¬æ–‡å¼€å§‹éƒ¨åˆ†ï¼Œæˆ‘ä»¬ä½¿ç”¨åŸå­ç±»AtomicLongçš„getAndIncrement()æ–¹æ³•æ›¿ä»£äº†<code>count += 1</code>ï¼Œä»è€Œå®ç°äº†çº¿ç¨‹å®‰å…¨ã€‚åŸå­ç±»AtomicLongçš„getAndIncrement()æ–¹æ³•å†…éƒ¨å°±æ˜¯åŸºäºCASå®ç°çš„ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹Javaæ˜¯å¦‚ä½•ä½¿ç”¨CASæ¥å®ç°åŸå­åŒ–çš„<code>count += 1</code>çš„ã€‚</p><p>åœ¨Java 1.8ç‰ˆæœ¬ä¸­ï¼ŒgetAndIncrement()æ–¹æ³•ä¼šè½¬è°ƒunsafe.getAndAddLong()æ–¹æ³•ã€‚è¿™é‡Œthiså’ŒvalueOffsetä¸¤ä¸ªå‚æ•°å¯ä»¥å”¯ä¸€ç¡®å®šå…±äº«å˜é‡çš„å†…å­˜åœ°å€ã€‚</p><pre><code>final long getAndIncrement() {\n  return unsafe.getAndAddLong(\n    this, valueOffset, 1L);\n}\n</code></pre><p>unsafe.getAndAddLong()æ–¹æ³•çš„æºç å¦‚ä¸‹ï¼Œè¯¥æ–¹æ³•é¦–å…ˆä¼šåœ¨å†…å­˜ä¸­è¯»å–å…±äº«å˜é‡çš„å€¼ï¼Œä¹‹åå¾ªç¯è°ƒç”¨compareAndSwapLong()æ–¹æ³•æ¥å°è¯•è®¾ç½®å…±äº«å˜é‡çš„å€¼ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚compareAndSwapLong()æ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼Œåªæœ‰å½“å†…å­˜ä¸­å…±äº«å˜é‡çš„å€¼ç­‰äºexpectedæ—¶ï¼Œæ‰ä¼šå°†å…±äº«å˜é‡çš„å€¼æ›´æ–°ä¸ºxï¼Œå¹¶ä¸”è¿”å›trueï¼›å¦åˆ™è¿”å›fasleã€‚compareAndSwapLongçš„è¯­ä¹‰å’ŒCASæŒ‡ä»¤çš„è¯­ä¹‰çš„å·®åˆ«ä»…ä»…æ˜¯è¿”å›å€¼ä¸åŒè€Œå·²ã€‚</p><pre><code>public final long getAndAddLong(\n  Object o, long offset, long delta){\n  long v;\n  do {\n    // è¯»å–å†…å­˜ä¸­çš„å€¼\n    v = getLongVolatile(o, offset);\n  } while (!compareAndSwapLong(\n      o, offset, v, v + delta));\n  return v;\n}\n//åŸå­æ€§åœ°å°†å˜é‡æ›´æ–°ä¸ºx\n//æ¡ä»¶æ˜¯å†…å­˜ä¸­çš„å€¼ç­‰äºexpected\n//æ›´æ–°æˆåŠŸåˆ™è¿”å›true\nnative boolean compareAndSwapLong(\n  Object o, long offset, \n  long expected,\n  long x);\n</code></pre><p>å¦å¤–ï¼Œéœ€è¦ä½ æ³¨æ„çš„æ˜¯ï¼ŒgetAndAddLong()æ–¹æ³•çš„å®ç°ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯CASä½¿ç”¨çš„ç»å…¸èŒƒä¾‹ã€‚æ‰€ä»¥è¯·ä½ å†æ¬¡ä½“ä¼šä¸‹é¢è¿™æ®µæŠ½è±¡åçš„ä»£ç ç‰‡æ®µï¼Œå®ƒåœ¨å¾ˆå¤šæ— é”ç¨‹åºä¸­ç»å¸¸å‡ºç°ã€‚Javaæä¾›çš„åŸå­ç±»é‡Œé¢CASä¸€èˆ¬è¢«å®ç°ä¸ºcompareAndSet()ï¼ŒcompareAndSet()çš„è¯­ä¹‰å’ŒCASæŒ‡ä»¤çš„è¯­ä¹‰çš„å·®åˆ«ä»…ä»…æ˜¯è¿”å›å€¼ä¸åŒè€Œå·²ï¼ŒcompareAndSet()é‡Œé¢å¦‚æœæ›´æ–°æˆåŠŸï¼Œåˆ™ä¼šè¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚</p><pre><code>do {\n  // è·å–å½“å‰å€¼\n  oldV = xxxxï¼›\n  // æ ¹æ®å½“å‰å€¼è®¡ç®—æ–°å€¼\n  newV = ...oldV...\n}while(!compareAndSet(oldV,newV);\n</code></pre><h2>åŸå­ç±»æ¦‚è§ˆ</h2><p>Java SDKå¹¶å‘åŒ…é‡Œæä¾›çš„åŸå­ç±»å†…å®¹å¾ˆä¸°å¯Œï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬åˆ†ä¸ºäº”ä¸ªç±»åˆ«ï¼š<strong>åŸå­åŒ–çš„åŸºæœ¬æ•°æ®ç±»å‹ã€åŸå­åŒ–çš„å¯¹è±¡å¼•ç”¨ç±»å‹ã€åŸå­åŒ–æ•°ç»„ã€åŸå­åŒ–å¯¹è±¡å±æ€§æ›´æ–°å™¨</strong>å’Œ<strong>åŸå­åŒ–çš„ç´¯åŠ å™¨</strong>ã€‚è¿™äº”ä¸ªç±»åˆ«æä¾›çš„æ–¹æ³•åŸºæœ¬ä¸Šæ˜¯ç›¸ä¼¼çš„ï¼Œå¹¶ä¸”æ¯ä¸ªç±»åˆ«éƒ½æœ‰è‹¥å¹²åŸå­ç±»ï¼Œä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„åŸå­ç±»ç»„æˆæ¦‚è§ˆå›¾æ¥è·å¾—ä¸€ä¸ªå…¨å±€çš„å°è±¡ã€‚ä¸‹é¢æˆ‘ä»¬è¯¦ç»†è§£è¯»è¿™äº”ä¸ªç±»åˆ«ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/00/4a/007a32583fbf519469462fe61805eb4a.png?wh=1142*461\" alt=\"\"></p><center><span class=\"reference\">åŸå­ç±»ç»„æˆæ¦‚è§ˆå›¾</span></center><h3>1. åŸå­åŒ–çš„åŸºæœ¬æ•°æ®ç±»å‹</h3><p>ç›¸å…³å®ç°æœ‰AtomicBooleanã€AtomicIntegerå’ŒAtomicLongï¼Œæä¾›çš„æ–¹æ³•ä¸»è¦æœ‰ä»¥ä¸‹è¿™äº›ï¼Œè¯¦æƒ…ä½ å¯ä»¥å‚è€ƒSDKçš„æºä»£ç ï¼Œéƒ½å¾ˆç®€å•ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†ã€‚</p><pre><code>getAndIncrement() //åŸå­åŒ–i++\ngetAndDecrement() //åŸå­åŒ–çš„i--\nincrementAndGet() //åŸå­åŒ–çš„++i\ndecrementAndGet() //åŸå­åŒ–çš„--i\n//å½“å‰å€¼+=deltaï¼Œè¿”å›+=å‰çš„å€¼\ngetAndAdd(delta) \n//å½“å‰å€¼+=deltaï¼Œè¿”å›+=åçš„å€¼\naddAndGet(delta)\n//CASæ“ä½œï¼Œè¿”å›æ˜¯å¦æˆåŠŸ\ncompareAndSet(expect, update)\n//ä»¥ä¸‹å››ä¸ªæ–¹æ³•\n//æ–°å€¼å¯ä»¥é€šè¿‡ä¼ å…¥funcå‡½æ•°æ¥è®¡ç®—\ngetAndUpdate(func)\nupdateAndGet(func)\ngetAndAccumulate(x,func)\naccumulateAndGet(x,func)\n</code></pre><h3>2. åŸå­åŒ–çš„å¯¹è±¡å¼•ç”¨ç±»å‹</h3><p>ç›¸å…³å®ç°æœ‰AtomicReferenceã€AtomicStampedReferenceå’ŒAtomicMarkableReferenceï¼Œåˆ©ç”¨å®ƒä»¬å¯ä»¥å®ç°å¯¹è±¡å¼•ç”¨çš„åŸå­åŒ–æ›´æ–°ã€‚AtomicReferenceæä¾›çš„æ–¹æ³•å’ŒåŸå­åŒ–çš„åŸºæœ¬æ•°æ®ç±»å‹å·®ä¸å¤šï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹è±¡å¼•ç”¨çš„æ›´æ–°éœ€è¦é‡ç‚¹å…³æ³¨ABAé—®é¢˜ï¼ŒAtomicStampedReferenceå’ŒAtomicMarkableReferenceè¿™ä¸¤ä¸ªåŸå­ç±»å¯ä»¥è§£å†³ABAé—®é¢˜ã€‚</p><p>è§£å†³ABAé—®é¢˜çš„æ€è·¯å…¶å®å¾ˆç®€å•ï¼Œå¢åŠ ä¸€ä¸ªç‰ˆæœ¬å·ç»´åº¦å°±å¯ä»¥äº†ï¼Œè¿™ä¸ªå’Œæˆ‘ä»¬åœ¨<a href=\"https://time.geekbang.org/column/article/89456\">ã€Š18 | StampedLockï¼šæœ‰æ²¡æœ‰æ¯”è¯»å†™é”æ›´å¿«çš„é”ï¼Ÿã€‹</a>ä»‹ç»çš„ä¹è§‚é”æœºåˆ¶å¾ˆç±»ä¼¼ï¼Œæ¯æ¬¡æ‰§è¡ŒCASæ“ä½œï¼Œé™„åŠ å†æ›´æ–°ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œåªè¦ä¿è¯ç‰ˆæœ¬å·æ˜¯é€’å¢çš„ï¼Œé‚£ä¹ˆå³ä¾¿Aå˜æˆBä¹‹åå†å˜å›Aï¼Œç‰ˆæœ¬å·ä¹Ÿä¸ä¼šå˜å›æ¥ï¼ˆç‰ˆæœ¬å·é€’å¢çš„ï¼‰ã€‚AtomicStampedReferenceå®ç°çš„CASæ–¹æ³•å°±å¢åŠ äº†ç‰ˆæœ¬å·å‚æ•°ï¼Œæ–¹æ³•ç­¾åå¦‚ä¸‹ï¼š</p><pre><code>boolean compareAndSet(\n  V expectedReference,\n  V newReference,\n  int expectedStamp,\n  int newStamp) \n</code></pre><p>AtomicMarkableReferenceçš„å®ç°æœºåˆ¶åˆ™æ›´ç®€å•ï¼Œå°†ç‰ˆæœ¬å·ç®€åŒ–æˆäº†ä¸€ä¸ªBooleanå€¼ï¼Œæ–¹æ³•ç­¾åå¦‚ä¸‹ï¼š</p><pre><code>boolean compareAndSet(\n  V expectedReference,\n  V newReference,\n  boolean expectedMark,\n  boolean newMark)\n</code></pre><h3>3. åŸå­åŒ–æ•°ç»„</h3><p>ç›¸å…³å®ç°æœ‰AtomicIntegerArrayã€AtomicLongArrayå’ŒAtomicReferenceArrayï¼Œåˆ©ç”¨è¿™äº›åŸå­ç±»ï¼Œæˆ‘ä»¬å¯ä»¥åŸå­åŒ–åœ°æ›´æ–°æ•°ç»„é‡Œé¢çš„æ¯ä¸€ä¸ªå…ƒç´ ã€‚è¿™äº›ç±»æä¾›çš„æ–¹æ³•å’ŒåŸå­åŒ–çš„åŸºæœ¬æ•°æ®ç±»å‹çš„åŒºåˆ«ä»…ä»…æ˜¯ï¼šæ¯ä¸ªæ–¹æ³•å¤šäº†ä¸€ä¸ªæ•°ç»„çš„ç´¢å¼•å‚æ•°ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿä¸å†èµ˜è¿°äº†ã€‚</p><h3>4. åŸå­åŒ–å¯¹è±¡å±æ€§æ›´æ–°å™¨</h3><p>ç›¸å…³å®ç°æœ‰AtomicIntegerFieldUpdaterã€AtomicLongFieldUpdaterå’ŒAtomicReferenceFieldUpdaterï¼Œåˆ©ç”¨å®ƒä»¬å¯ä»¥åŸå­åŒ–åœ°æ›´æ–°å¯¹è±¡çš„å±æ€§ï¼Œè¿™ä¸‰ä¸ªæ–¹æ³•éƒ½æ˜¯åˆ©ç”¨åå°„æœºåˆ¶å®ç°çš„ï¼Œåˆ›å»ºæ›´æ–°å™¨çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><pre><code>public static &lt;U&gt;\nAtomicXXXFieldUpdater&lt;U&gt; \nnewUpdater(Class&lt;U&gt; tclass, \n  String fieldName)\n</code></pre><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>å¯¹è±¡å±æ€§å¿…é¡»æ˜¯volatileç±»å‹çš„ï¼Œåªæœ‰è¿™æ ·æ‰èƒ½ä¿è¯å¯è§æ€§</strong>ï¼›å¦‚æœå¯¹è±¡å±æ€§ä¸æ˜¯volatileç±»å‹çš„ï¼ŒnewUpdater()æ–¹æ³•ä¼šæŠ›å‡ºIllegalArgumentExceptionè¿™ä¸ªè¿è¡Œæ—¶å¼‚å¸¸ã€‚</p><p>ä½ ä¼šå‘ç°newUpdater()çš„æ–¹æ³•å‚æ•°åªæœ‰ç±»çš„ä¿¡æ¯ï¼Œæ²¡æœ‰å¯¹è±¡çš„å¼•ç”¨ï¼Œè€Œæ›´æ–°<strong>å¯¹è±¡</strong>çš„å±æ€§ï¼Œä¸€å®šéœ€è¦å¯¹è±¡çš„å¼•ç”¨ï¼Œé‚£è¿™ä¸ªå‚æ•°æ˜¯åœ¨å“ªé‡Œä¼ å…¥çš„å‘¢ï¼Ÿæ˜¯åœ¨åŸå­æ“ä½œçš„æ–¹æ³•å‚æ•°ä¸­ä¼ å…¥çš„ã€‚ä¾‹å¦‚compareAndSet()è¿™ä¸ªåŸå­æ“ä½œï¼Œç›¸æ¯”åŸå­åŒ–çš„åŸºæœ¬æ•°æ®ç±»å‹å¤šäº†ä¸€ä¸ªå¯¹è±¡å¼•ç”¨objã€‚åŸå­åŒ–å¯¹è±¡å±æ€§æ›´æ–°å™¨ç›¸å…³çš„æ–¹æ³•ï¼Œç›¸æ¯”åŸå­åŒ–çš„åŸºæœ¬æ•°æ®ç±»å‹ä»…ä»…æ˜¯å¤šäº†å¯¹è±¡å¼•ç”¨å‚æ•°ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿä¸å†èµ˜è¿°äº†ã€‚</p><pre><code>boolean compareAndSet(\n  T obj, \n  int expect, \n  int update)\n</code></pre><h3>5. åŸå­åŒ–çš„ç´¯åŠ å™¨</h3><p>DoubleAccumulatorã€DoubleAdderã€LongAccumulatorå’ŒLongAdderï¼Œè¿™å››ä¸ªç±»ä»…ä»…ç”¨æ¥æ‰§è¡Œç´¯åŠ æ“ä½œï¼Œç›¸æ¯”åŸå­åŒ–çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼Œé€Ÿåº¦æ›´å¿«ï¼Œä½†æ˜¯ä¸æ”¯æŒcompareAndSet()æ–¹æ³•ã€‚å¦‚æœä½ ä»…ä»…éœ€è¦ç´¯åŠ æ“ä½œï¼Œä½¿ç”¨åŸå­åŒ–çš„ç´¯åŠ å™¨æ€§èƒ½ä¼šæ›´å¥½ã€‚</p><h2>æ€»ç»“</h2><p>æ— é”æ–¹æ¡ˆç›¸å¯¹äºäº’æ–¥é”æ–¹æ¡ˆï¼Œä¼˜ç‚¹éå¸¸å¤šï¼Œé¦–å…ˆæ€§èƒ½å¥½ï¼Œå…¶æ¬¡æ˜¯åŸºæœ¬ä¸ä¼šå‡ºç°æ­»é”é—®é¢˜ï¼ˆä½†å¯èƒ½å‡ºç°é¥¥é¥¿å’Œæ´»é”é—®é¢˜ï¼Œå› ä¸ºè‡ªæ—‹ä¼šåå¤é‡è¯•ï¼‰ã€‚Javaæä¾›çš„åŸå­ç±»å¤§éƒ¨åˆ†éƒ½å®ç°äº†compareAndSet()æ–¹æ³•ï¼ŒåŸºäºcompareAndSet()æ–¹æ³•ï¼Œä½ å¯ä»¥æ„å»ºè‡ªå·±çš„æ— é”æ•°æ®ç»“æ„ï¼Œä½†æ˜¯<strong>å»ºè®®ä½ ä¸è¦è¿™æ ·åšï¼Œè¿™ä¸ªå·¥ä½œæœ€å¥½è¿˜æ˜¯è®©å¤§å¸ˆä»¬å»å®Œæˆ</strong>ï¼ŒåŸå› æ˜¯æ— é”ç®—æ³•æ²¡ä½ æƒ³è±¡çš„é‚£ä¹ˆç®€å•ã€‚</p><p>Javaæä¾›çš„åŸå­ç±»èƒ½å¤Ÿè§£å†³ä¸€äº›ç®€å•çš„åŸå­æ€§é—®é¢˜ï¼Œä½†ä½ å¯èƒ½ä¼šå‘ç°ï¼Œä¸Šé¢æˆ‘ä»¬æ‰€æœ‰åŸå­ç±»çš„æ–¹æ³•éƒ½æ˜¯é’ˆå¯¹ä¸€ä¸ªå…±äº«å˜é‡çš„ï¼Œå¦‚æœä½ éœ€è¦è§£å†³å¤šä¸ªå˜é‡çš„åŸå­æ€§é—®é¢˜ï¼Œå»ºè®®è¿˜æ˜¯ä½¿ç”¨äº’æ–¥é”æ–¹æ¡ˆã€‚åŸå­ç±»è™½å¥½ï¼Œä½†ä½¿ç”¨è¦æ…ä¹‹åˆæ…ã€‚</p><h2>è¯¾åæ€è€ƒ</h2><p>ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æ˜¯åˆç†åº“å­˜çš„åŸå­åŒ–å®ç°ï¼Œä»…å®ç°äº†è®¾ç½®åº“å­˜ä¸Šé™setUpper()æ–¹æ³•ï¼Œä½ è§‰å¾—setUpper()æ–¹æ³•çš„å®ç°æ˜¯å¦æ­£ç¡®å‘¢ï¼Ÿ</p><pre><code>public class SafeWM {\n  class WMRange{\n    final int upper;\n    final int lower;\n    WMRange(int upper,int lower){\n    //çœç•¥æ„é€ å‡½æ•°å®ç°\n    }\n  }\n  final AtomicReference&lt;WMRange&gt;\n    rf = new AtomicReference&lt;&gt;(\n      new WMRange(0,0)\n    );\n  // è®¾ç½®åº“å­˜ä¸Šé™\n  void setUpper(int v){\n    WMRange nr;\n    WMRange or = rf.get();\n    do{\n      // æ£€æŸ¥å‚æ•°åˆæ³•æ€§\n      if(v &lt; or.lower){\n        throw new IllegalArgumentException();\n      }\n      nr = new\n        WMRange(v, or.lower);\n    }while(!rf.compareAndSet(or, nr));\n  }\n}\n</code></pre><p>æ¬¢è¿åœ¨ç•™è¨€åŒºä¸æˆ‘åˆ†äº«ä½ çš„æƒ³æ³•ï¼Œä¹Ÿæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºè®°å½•ä½ çš„æ€è€ƒè¿‡ç¨‹ã€‚æ„Ÿè°¢é˜…è¯»ï¼Œå¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ã€‚</p><p></p>","neighbors":{"left":{"article_title":"20 | å¹¶å‘å®¹å™¨ï¼šéƒ½æœ‰å“ªäº›â€œå‘â€éœ€è¦æˆ‘ä»¬å¡«ï¼Ÿ","id":90201},"right":{"article_title":"22 | Executorä¸çº¿ç¨‹æ± ï¼šå¦‚ä½•åˆ›å»ºæ­£ç¡®çš„çº¿ç¨‹æ± ï¼Ÿ","id":90771}},"comments":[{"had_liked":false,"id":86508,"user_name":"å¼ å¤©å±¹","can_delete":false,"product_type":"c1","uid":1477612,"ip_address":"","ucode":"8BD6BD6DCF0F4F","user_header":"https://static001.geekbang.org/account/avatar/00/16/8b/ec/dc03f5ad.jpg","comment_is_top":false,"comment_ctime":1555385784,"is_pvip":false,"replies":[{"id":"31152","content":"ğŸ‘<br>","user_name":"ä½œè€…å›å¤","comment_id":86508,"uid":"1269969","ip_address":"","utype":1,"ctime":1555413863,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":2,"race_medal":0,"score":"409577278904","product_id":100023901,"comment_content":"å¦‚æœçº¿ç¨‹1 è¿è¡Œåˆ°WMRange or = rf.get();åœæ­¢ï¼Œåˆ‡æ¢åˆ°çº¿ç¨‹2 æ›´æ–°äº†å€¼ï¼Œåˆ‡æ¢å›åˆ°çº¿ç¨‹1ï¼Œè¿›å…¥å¾ªç¯å°†æ°¸è¿œæ¯”è¾ƒå¤±è´¥æ­»å¾ªç¯ï¼Œè§£å†³æ–¹æ¡ˆæ˜¯å°†è¯»å–çš„é‚£ä¸€å¥æ”¾å…¥å¾ªç¯é‡Œï¼ŒCASæ¯æ¬¡è‡ªæ—‹å¿…é¡»è¦é‡æ–°æ£€æŸ¥æ–°çš„å€¼æ‰æœ‰æ„ä¹‰","like_count":95,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447044,"discussion_content":"ğŸ‘\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555413863,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2817383,"avatar":"","nickname":"Geek_0e145a","note":"","ucode":"55806C67EE550E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":412450,"discussion_content":"è±ç„¶å¼€æœ—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636171951,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86557,"user_name":"å¤©æ¶¯ç…®é…’","can_delete":false,"product_type":"c1","uid":1241127,"ip_address":"","ucode":"EF9516EC878E4C","user_header":"https://static001.geekbang.org/account/avatar/00/12/f0/27/8b72141c.jpg","comment_is_top":false,"comment_ctime":1555399519,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"263548404575","product_id":100023901,"comment_content":"or = rf.get(); åº”è¯¥æ”¾åˆ°do{}å†…","like_count":61},{"had_liked":false,"id":87315,"user_name":"Geek_ebda96","can_delete":false,"product_type":"c1","uid":1134862,"ip_address":"","ucode":"02912E6D95A5A6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoRiaKX0ulEibbbwM4xhjyMeza0Pyp7KO1mqvfJceiaM6ZNtGpXJibI6P2qHGwBP9GKwOt9LgHicHflBXw/132","comment_is_top":false,"comment_ctime":1555566542,"is_pvip":false,"replies":[{"id":"31553","content":"ä½ çš„è¿™ä¸ªå†™æ³•æ˜¯å¯¹çš„ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":87315,"uid":"1269969","ip_address":"","utype":1,"ctime":1555676769,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":13,"race_medal":0,"score":"164764323790","product_id":100023901,"comment_content":"è€å¸ˆä½ ä¸¾çš„è¿™ä¸ªä¾‹å­ï¼Œè‡ªå·±å®ç°CASæ˜¯ä¸æ˜¯æœ‰ç‚¹ä¸å¯¹<br>class SimulatedCAS{<br>  volatile int count;<br>  &#47;&#47; å®ç° count+=1<br>  addOne(){<br>    do {<br>      newValue = count+1; &#47;&#47;â‘ <br>    }while(count !=<br>      cas(count,newValue) &#47;&#47;â‘¡<br>  }<br>  &#47;&#47; æ¨¡æ‹Ÿå®ç° CASï¼Œä»…ç”¨æ¥å¸®åŠ©ç†è§£<br>  synchronized int cas(<br>    int expect, int newValue){<br>    &#47;&#47; è¯»ç›®å‰ count çš„å€¼<br>    int curValue = count;<br>    &#47;&#47; æ¯”è¾ƒç›®å‰ count å€¼æ˜¯å¦ == æœŸæœ›å€¼<br>    if(curValue == expect){<br>      &#47;&#47; å¦‚æœæ˜¯ï¼Œåˆ™æ›´æ–° count çš„å€¼<br>      count= newValue;<br>    }<br>    &#47;&#47; è¿”å›å†™å…¥å‰çš„å€¼<br>    return curValue;<br>  }<br>}<br><br>2 è¿™é‡Œæ˜¯ä¸æ˜¯åº”è¯¥ç”¨oldValueæ¥æ¯”è¾ƒï¼Œåœ¨doé‡Œé¢çš„æ—¶å€™å…ˆæŠŠcountçš„å€¼ç”¨oldValueä¿å­˜ä¸‹æ¥ï¼Œä¼ å…¥çš„å‚æ•°expectedä¸ºoldValue,newValueä¸ºoldValue+1<br><br>do{<br>    oldValue = count;<br>    newValue = oldValue + 1;<br>}while(oldValue != cas(oldValue, newValue))<br><br>æœ›æŒ‡æ­£","like_count":38,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447394,"discussion_content":"ä½ çš„è¿™ä¸ªå†™æ³•æ˜¯å¯¹çš„ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555676769,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1441876,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI2vn8hyjICTCletGs0omz28lhriaZKX2XX9icYzAEon2IEoRnlXqyOia2bEPP0j7T6xexTnr77JJic8w/132","nickname":"Geek_c22199","note":"","ucode":"1CE5B65513E360","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":221127,"discussion_content":"volatile æ˜¯ä¿è¯å¯è§æ€§çš„ï¼Œçœ‹åˆ°æœ¬ç« èŠ‚é‚£å„¿å°±å¾ˆè´¹è§£ï¼Œå› ä¸ºcountè¯»åˆ°çš„å€¼ä¼šä¸€ç›´æ˜¯æ–°çš„ï¼Œcasè¿”å›çš„å€¼ä¹Ÿä¸€ç›´æ˜¯æ–°çš„â€¦â€¦\néœ€è¦è·å–æ—§å€¼æ‰èƒ½è¯´çš„é€šï¼Œæ¥¼ä¸»é—®äº†æƒ³é—®çš„é—®é¢˜","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1585979302,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1120212,"avatar":"https://static001.geekbang.org/account/avatar/00/11/17/d4/d7a4e6f5.jpg","nickname":"èƒ¡æ¥šåš","note":"","ucode":"225883EDF35BED","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":36169,"discussion_content":"çœ‹åˆ°æ–‡ç« å°±çº³é—·ï¼Œèµ¶ç´§ç¿»æ¥è¯„è®ºï¼Œï¼Œæœç„¶æœ‰é—®é¢˜å“ˆã€‚ï¼ˆcountæ˜¯ç±»å±æ€§ï¼Œéçº¿ç¨‹å®‰å…¨ï¼Œæ¢æˆæ–¹æ³•å˜é‡å°±çº¿ç¨‹å®‰å…¨äº†ï¼‰","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1571326373,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1135912,"avatar":"https://static001.geekbang.org/account/avatar/00/11/55/28/31b0cf2f.jpg","nickname":"é»‘è‰²æ¯›è¡£","note":"","ucode":"FF7E235F91BA5C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1120212,"avatar":"https://static001.geekbang.org/account/avatar/00/11/17/d4/d7a4e6f5.jpg","nickname":"èƒ¡æ¥šåš","note":"","ucode":"225883EDF35BED","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":50195,"discussion_content":"é‚£ä¸ªå˜é‡æ˜¯ volitale çš„â€¦â€¦","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1573691967,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":36169,"ip_address":""},"score":50195,"extra":""},{"author":{"id":1554995,"avatar":"https://static001.geekbang.org/account/avatar/00/17/ba/33/2d83d174.jpg","nickname":"æ—¶å…‰å®ˆæŠ¤è€…-åŸºå…°","note":"","ucode":"F0B0887B1979D2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1135912,"avatar":"https://static001.geekbang.org/account/avatar/00/11/55/28/31b0cf2f.jpg","nickname":"é»‘è‰²æ¯›è¡£","note":"","ucode":"FF7E235F91BA5C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366931,"discussion_content":"æ­£æ˜¯å› ä¸ºæ˜¯volitale æ‰€ä»¥è€å¸ˆé‚£ç§å†™æ³•cas(oldValue, newValue)æ¯æ¬¡éƒ½ä¼šæ˜¯trueã€‚å‡å¦‚åˆå§‹å€¼æ˜¯1ï¼Œå½“å‰çº¿ç¨‹æƒ³æ›´æ–°æˆ2ï¼Œå¦‚æœä¸è®°1ï¼Œåœ¨å½“å‰çº¿ç¨‹casä¹‹å‰æœ‰å¦å¤–ä¸€ä¸ªçº¿ç¨‹æ›´æ–°æˆ2ï¼Œæ­¤æ—¶å½“å‰çº¿ç¨‹cas(oldValue, newValue)ä¼šæ›´æ–°ä¸º2ï¼Œä½†å…¶å®åº”è¯¥æ˜¯3","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618219582,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":50195,"ip_address":""},"score":366931,"extra":""},{"author":{"id":1689144,"avatar":"https://static001.geekbang.org/account/avatar/00/19/c6/38/b41dc894.jpg","nickname":"é©¬åŠä»™","note":"","ucode":"14868A55469A76","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1554995,"avatar":"https://static001.geekbang.org/account/avatar/00/17/ba/33/2d83d174.jpg","nickname":"æ—¶å…‰å®ˆæŠ¤è€…-åŸºå…°","note":"","ucode":"F0B0887B1979D2","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":408716,"discussion_content":"ä¸æ˜¯çš„ï¼Œä½ ä¼ çš„æ˜¯countï¼Œä½†æ˜¯ä½ æ˜¯åœ¨è°ƒç”¨æ–¹æ³•ï¼Œä¼ è¿‡å»çš„åªæ˜¯ä¸ªå€¼ï¼Œè€Œä¸æ˜¯æ–¹æ³•å˜é‡ï¼Œç©¿è¿›å»å°±ä¸æ˜¯volitaleäº†ï¼Œæ˜¯ä¸ä¼šæ›´æ–°å†…å­˜æœ€æ–°å€¼çš„ï¼Œæ‰€ä»¥å±‚ä¸»å’Œè€å¸ˆå®ç°æ–¹æ³•æ˜¯ä¸€æ ·çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635306485,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":366931,"ip_address":""},"score":408716,"extra":""}]},{"author":{"id":1156592,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a5/f0/8648c464.jpg","nickname":"Joker","note":"","ucode":"126AF848001A1E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":45157,"discussion_content":"è€å¸ˆçš„é‚£ä¸ªcoutåº”è¯¥æ˜¯å¯¹çš„ï¼Œæˆ‘è·‘äº†ä¸€ä¸‹ï¼Œæ²¡å•¥é—®é¢˜ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1573007435,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2226367,"avatar":"https://static001.geekbang.org/account/avatar/00/21/f8/bf/59f2e600.jpg","nickname":"æœˆæ˜é£æ¸…","note":"","ucode":"65A97CF2E320FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1156592,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a5/f0/8648c464.jpg","nickname":"Joker","note":"","ucode":"126AF848001A1E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575059,"discussion_content":"è·‘ä¸€ä¸‹å¯¹ï¼Œä¸ä»£è¡¨å†™çš„æ˜¯å¯¹çš„ï¼Œå¹¶å‘é—®é¢˜æœ¬æ¥å°±æœ‰éšæœºæ€§ï¼Œéš¾ä»¥å¤åŸå¹¶å‘é—®é¢˜çš„åœºæ™¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654572977,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":45157,"ip_address":""},"score":575059,"extra":""}]},{"author":{"id":1687656,"avatar":"https://static001.geekbang.org/account/avatar/00/19/c0/68/314e8306.jpg","nickname":"å¨å…ˆæ£®","note":"","ucode":"5F445C6832274B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":365584,"discussion_content":"ä¸Šé¢è¯„è®ºé”™äº†ï¼ŒğŸ˜‚casæ–¹æ³•è¿”å›çš„æ°¸è¿œéƒ½æ˜¯æ—§çš„countå€¼ï¼Œcountæœ‰å¯èƒ½æ˜¯æ—§çš„æˆ–è€…æ–°çš„ï¼Œå½“whileæ¡ä»¶æ»¡è¶³ï¼ˆå°±æ˜¯countå€¼å’Œcasè¿”å›çš„å€¼ä¸ç­‰æ—¶ï¼‰å°±ä¼šè‡ªæ—‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617845575,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2343086,"avatar":"https://static001.geekbang.org/account/avatar/00/23/c0/ae/e5e62510.jpg","nickname":"å¾å¿—è¶…-Klaus","note":"","ucode":"CF26B39965F2A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1687656,"avatar":"https://static001.geekbang.org/account/avatar/00/19/c0/68/314e8306.jpg","nickname":"å¨å…ˆæ£®","note":"","ucode":"5F445C6832274B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389808,"discussion_content":"è¿™é‡Œæˆ‘ä¹Ÿå¾ˆè´¹è§£ï¼Œæ–°å€¼ä¸ç­‰äºæ—§å€¼ä¸å°±ä¿®æ”¹æˆåŠŸäº†å—ï¼Ÿä¿®æ”¹æˆåŠŸäº†ä¸ºä»€ä¹ˆè¦è‡ªæ—‹å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629436700,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":365584,"ip_address":""},"score":389808,"extra":""}]},{"author":{"id":1181650,"avatar":"https://static001.geekbang.org/account/avatar/00/12/07/d2/0d7ee298.jpg","nickname":"æƒ˜ é—»","note":"","ucode":"C5909F034BF072","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":296245,"discussion_content":"ä¸€æ ·çš„ã€‚æ–¹æ³•å˜é‡ä¹Ÿæ˜¯çº¿ç¨‹å¯è§çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596497132,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1118758,"avatar":"https://static001.geekbang.org/account/avatar/00/11/12/26/e7561fda.jpg","nickname":"Volcano","note":"","ucode":"EE659D034636BE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":25560,"discussion_content":"è¿™ä¸æ˜¯ä¸€æ ·å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570538744,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1015754,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","nickname":"helloworld","note":"","ucode":"00DF2FEC58D2E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5482,"discussion_content":"è¿™ä¸æ˜¯ä¸€æ ·å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566294189,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":210749,"user_name":"é•¿è„–å­æ ‘","can_delete":false,"product_type":"c1","uid":1182802,"ip_address":"","ucode":"D9090EF67EEB1B","user_header":"https://static001.geekbang.org/account/avatar/00/12/0c/52/f25c3636.jpg","comment_is_top":false,"comment_ctime":1587819726,"is_pvip":true,"replies":[{"id":"78690","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":210749,"uid":"1269969","ip_address":"","utype":1,"ctime":1588032413,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":4,"race_medal":0,"score":"100372067534","product_id":100023901,"comment_content":"åŸå­ç±»åœ¨ java å±‚é¢è™½ç„¶çœ‹èµ·æ¥æ˜¯æ— é”çš„, ä½†æ˜¯æ·±å…¥åˆ°æ“ä½œç³»ç»Ÿå’Œcpuå±‚é¢ä»ç„¶æœ‰é”<br>æ¯”å¦‚åƒåœ¨å¤šå¤„ç†å™¨è®¡ç®—æœºé‡Œå¸¸å¸¸ä¼šæœ‰ä¸€ç§ TSL æŒ‡ä»¤, (æµ‹è¯•å¹¶åŠ é” test and set lock),  å®ƒæ˜¯ä¸€ç§ç¡¬ä»¶æ”¯æŒçš„äº’æ–¥æ–¹æ¡ˆ, æ‰§è¡Œè¿™ä¸ªæŒ‡ä»¤çš„cpuå°†é”ä½å†…å­˜æ€»çº¿, ä»¥ç¦æ­¢å…¶ä»–CPU åœ¨æœ¬æŒ‡ä»¤ç»“æŸä¹‹å‰è®¿é—®å†…å­˜<br>è¿™ä¸ªæŒ‡ä»¤ç±»ä¼¼äº intel å¤„ç†å™¨ä¸Šçš„ lock cmpxchg , ä½†åœ¨è¿‘å‡ ä»£çš„å®ç°ä¸Š, å¯¹å†…å­˜æ€»çº¿çš„é”å®šåšäº†ç±»ä¼¼äºåˆ†æ®µé”çš„ä¼˜åŒ–, ä»…ä»…é”å®šéƒ¨åˆ†çš„ç¼“å­˜è¡Œ<br>å‚è€ƒ: <br>1. ç°ä»£æ“ä½œç³»ç»Ÿ<br>2. https:&#47;&#47;en.wikipedia.org&#47;wiki&#47;Compare-and-swap<br>3. https:&#47;&#47;stackoverflow.com&#47;questions&#47;11065675&#47;lock-prefix-of-intel-instruction-what-is-the-point<br>4. https:&#47;&#47;cloud.tencent.com&#47;developer&#47;article&#47;1189884","like_count":23,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493100,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588032413,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1926057,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/63/a9/abed781e.jpg","nickname":"æç¶­é“","note":"","ucode":"9A16ECAB2522E3","race_medal":5,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559255,"discussion_content":"ä½ è¯´çš„è¿™äº›å±äºç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿä¸ºäº†è§£å†³å¯è§æ€§é—®é¢˜æ‰€å¼•å…¥çš„é”æœºåˆ¶å’Œç¼“å­˜ä¸€è‡´æ€§åè®®ï¼Œè¿™ä¸ªéƒ¨åˆ†ä¸åŸå­ç±»å’ŒCASæ˜¯è¦è§£å†³åŸå­æ€§é—®é¢˜ä¸å¤§ä¸€æ ·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648657931,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1309236,"avatar":"https://static001.geekbang.org/account/avatar/00/13/fa/34/8091ae3f.jpg","nickname":"èŒ‰è‰æ¸…å¯ä¹å¯¹å¥¶èŒ¶","note":"","ucode":"A7D48223EB473D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":531677,"discussion_content":"ç‰›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637381000,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1624355,"avatar":"https://static001.geekbang.org/account/avatar/00/18/c9/23/76511858.jpg","nickname":"æ´›å¥‡","note":"","ucode":"662B4005721119","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":363558,"discussion_content":"å‰å®³ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617237480,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86651,"user_name":"æœ¨å«å…­","can_delete":false,"product_type":"c1","uid":1199495,"ip_address":"","ucode":"D113DF578C5BF5","user_header":"https://static001.geekbang.org/account/avatar/00/12/4d/87/57236a2d.jpg","comment_is_top":false,"comment_ctime":1555418871,"is_pvip":true,"replies":[{"id":"31159","content":"æˆ‘ä¹Ÿè§‰å¾—æ²¡æœ‰ABAé—®é¢˜","user_name":"ä½œè€…å›å¤","comment_id":86651,"uid":"1269969","ip_address":"","utype":1,"ctime":1555423790,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":2,"race_medal":0,"score":"53095026423","product_id":100023901,"comment_content":"é¦–å…ˆï¼Œor=rf.get()éœ€è¦æ”¾åˆ°do{}ï¼Œæ¯æ¬¡éœ€è¦é‡æ–°è·å–ï¼Œä»¥é˜²å…¶ä»–çº¿ç¨‹æ›´æ–°è¿‡å¯¼è‡´æ­»å¾ªç¯ï¼›<br><br>ç„¶åï¼Œnræ˜¯newçš„ï¼Œæˆ‘è§‰å¾—åº”è¯¥ä¸ä¼šå‘ç”ŸABAçš„é—®é¢˜ï¼ˆreferenceçš„compareAndSetæ¯”è¾ƒçš„æ˜¯å†…å­˜åœ°å€ï¼‰ã€‚å¦å¤–ABAé—®é¢˜åº”è¯¥å®¹æ˜“å‘ç”Ÿåœ¨å€¼ç±»å‹ä¸Šå§ï¼Œå¼•ç”¨ç±»å‹çš„åº”è¯¥å‡ ä¹ä¸ä¼šå‘ç”Ÿï¼Ÿå¯¹äºå¼•ç”¨ç±»å‹ï¼Œå‡ ä¹ä¸ä¼šå‘ç”Ÿç»è¿‡è‡³å°‘ä¸¤æ¬¡newå¯¹è±¡ï¼Œæœ€åå¯¹è±¡æ”¾åœ¨äº†åŒä¸€å—orä¹‹å‰ä½¿ç”¨çš„å†…å­˜åŒºå—ä¸Šå§ï¼Ÿ<br>","like_count":12,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447109,"discussion_content":"æˆ‘ä¹Ÿè§‰å¾—æ²¡æœ‰ABAé—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555423790,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1438585,"avatar":"https://static001.geekbang.org/account/avatar/00/15/f3/79/f9a2c983.jpg","nickname":"ä¸œæ–¹æœªæ›¦","note":"","ucode":"C19EFEFA25318D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332834,"discussion_content":"å¦‚æœæ˜¯äº«å…ƒæ¨¡å¼ï¼Œå¯¹è±¡ä¸ä¸€å®šæ˜¯newå‡ºæ¥çš„ï¼Œè€Œæ˜¯æŒ‡å‘åŒä¸€ä¸ªï¼Œå°±ä¼šæœ‰ABAé—®é¢˜","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1607352509,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86588,"user_name":"andy","can_delete":false,"product_type":"c1","uid":1063321,"ip_address":"","ucode":"F03BE5E20B471C","user_header":"https://static001.geekbang.org/account/avatar/00/10/39/99/42929758.jpg","comment_is_top":false,"comment_ctime":1555404613,"is_pvip":false,"replies":[{"id":"31148","content":"å¯¹ğŸ‘<br><br>","user_name":"ä½œè€…å›å¤","comment_id":86588,"uid":"1269969","ip_address":"","utype":1,"ctime":1555411987,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":4,"race_medal":0,"score":"53095012165","product_id":100023901,"comment_content":"public class SafeWM {<br>  class WMRange{<br>    final int upper;<br>    final int lower;<br>    WMRange(int upper,int lower){<br>    &#47;&#47; çœç•¥æ„é€ å‡½æ•°å®ç°<br>    }<br>  }<br>  final AtomicReference&lt;WMRange&gt;<br>    rf = new AtomicReference&lt;&gt;(<br>      new WMRange(0,0)<br>    );<br>  &#47;&#47; è®¾ç½®åº“å­˜ä¸Šé™<br>  void setUpper(int v){<br>    WMRange nr;<br>    WMRange or;<br>    do{<br>\t  or = rf.get();<br>      &#47;&#47; æ£€æŸ¥å‚æ•°åˆæ³•æ€§<br>      if(v &lt; or.lower){<br>        throw new IllegalArgumentException();<br>      }<br>      nr = new<br>        WMRange(v, or.lower);<br>    }while(!rf.compareAndSet(or, nr));<br>  }<br>}<br><br> è¿™æ ·å­å¯¹å—ï¼Ÿ","like_count":12,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447084,"discussion_content":"å¯¹ğŸ‘\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555411987,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1101615,"avatar":"https://static001.geekbang.org/account/avatar/00/10/cf/2f/4f89f22a.jpg","nickname":"æé‘«ç£Š","note":"","ucode":"D06517CFCEEE00","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7967,"discussion_content":"è¿™å’Œè€å¸ˆå†™çš„æœ‰åŒºåˆ«å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567742881,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1258399,"avatar":"https://static001.geekbang.org/account/avatar/00/13/33/9f/8dbd9558.jpg","nickname":"é€†æµçš„é±¼","note":"","ucode":"AA3DDE44A83C40","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6415,"discussion_content":"ä¸æ˜¯è¯´å±æ€§è¦volatileçš„å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566892129,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1225224,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b2/08/92f42622.jpg","nickname":"å°”å†¬æ©™","note":"","ucode":"0B013A49BC18DA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1258399,"avatar":"https://static001.geekbang.org/account/avatar/00/13/33/9f/8dbd9558.jpg","nickname":"é€†æµçš„é±¼","note":"","ucode":"AA3DDE44A83C40","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":574118,"discussion_content":"final ä¹Ÿå¯ä»¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653835675,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":6415,"ip_address":""},"score":574118,"extra":""}]}]},{"had_liked":false,"id":86329,"user_name":"éƒ‘æ™¨Cc","can_delete":false,"product_type":"c1","uid":1324942,"ip_address":"","ucode":"57146E444D6329","user_header":"https://static001.geekbang.org/account/avatar/00/14/37/8e/cf0b4575.jpg","comment_is_top":false,"comment_ctime":1555355133,"is_pvip":false,"replies":[{"id":"31050","content":"ğŸ‘ï¼Œä¸è¿‡æˆ‘è§‰å¾—æ²¡å¿…è¦ç”¨atomicfieldreference","user_name":"ä½œè€…å›å¤","comment_id":86329,"uid":"1269969","ip_address":"","utype":1,"ctime":1555387779,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":3,"race_medal":0,"score":"48799995389","product_id":100023901,"comment_content":"oræ˜¯åŸå§‹çš„ nræ˜¯newå‡ºæ¥çš„ æŒ‡å‘ä¸åŒçš„å†…å­˜åœ°å€ compareandsetçš„ç»“æœæ°¸è¿œè¿”å›false ç»“æœæ˜¯æ­»å¾ªç¯ï¼Ÿæ˜¯ä¸æ˜¯åº”è¯¥ç”¨atomicfieldreferenceï¼Ÿ","like_count":11,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446972,"discussion_content":"ğŸ‘ï¼Œä¸è¿‡æˆ‘è§‰å¾—æ²¡å¿…è¦ç”¨atomicfieldreference","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555387779,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1624590,"avatar":"https://static001.geekbang.org/account/avatar/00/18/ca/0e/5009c5ff.jpg","nickname":"é‡è§","note":"","ucode":"FAF53CD4C28494","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":214563,"discussion_content":"ä¸æ˜¯æ­»å¾ªç¯ï¼Œæ˜¯ä¸ºäº†ä¿è¯æŠŠorä¿®æ”¹æˆnrçš„æ—¶å€™ï¼Œ å®é™…çš„å€¼ä»ç„¶æ˜¯orï¼Œ æ²¡æœ‰è¢«å¦å¤–çš„çº¿ç¨‹ä¿®æ”¹ã€‚è¿™ä¸ªé—®é¢˜çš„bugåœ¨äºåº”è¯¥æ¯æ¬¡éƒ½æ‹¿å®é™…å€¼èµ‹å€¼ç»™orã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585208500,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1786788,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJINWmZjibZA4eibL31PzMDia2yt1icOc9QnFWwTKuXbWTFCAZaMgCrqO7Oa5sZka81pHoibPgSM8nCjibA/132","nickname":"è¶…èƒ½åŠ›å…ˆç”Ÿ","note":"","ucode":"C042DB628CAA86","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":117508,"discussion_content":"compareAndSetä¸æ˜¯æ¯”è¾ƒorä¸nrå§ï¼Œoræ˜¯ä¸å®é™…å€¼æ¯”è¾ƒï¼Œnræ˜¯ä½ æƒ³è¦çš„æ–°å€¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578123426,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":90760,"user_name":"éšé£è€Œé€","can_delete":false,"product_type":"c1","uid":1447169,"ip_address":"","ucode":"4E4D46905697AB","user_header":"https://static001.geekbang.org/account/avatar/00/16/15/01/927d96e5.jpg","comment_is_top":false,"comment_ctime":1556628711,"is_pvip":false,"replies":[{"id":"32575","content":"æ— æ•ˆ","user_name":"ä½œè€…å›å¤","comment_id":90760,"uid":"1269969","ip_address":"","utype":1,"ctime":1556700332,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":3,"race_medal":0,"score":"31621399783","product_id":100023901,"comment_content":"è€å¸ˆï¼Œè¿™äº›åŸå­æ“ä½œç±»åœ¨åˆ†å¸ƒå¼ç¨‹åºä¸­è¿˜æœ‰æ•ˆå—ï¼Ÿ","like_count":7,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448641,"discussion_content":"æ— æ•ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556700332,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1118952,"avatar":"https://static001.geekbang.org/account/avatar/00/11/12/e8/aa60f7f1.jpg","nickname":"èµµå­˜é‡‘","note":"","ucode":"89D69F8D2DF269","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":319263,"discussion_content":"å“ˆå“ˆå“ˆ ä¸€é’ˆè§è¡€","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1603976039,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1053498,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/3a/b0454322.jpg","nickname":"Eric","note":"","ucode":"59752A51A382A6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":176554,"discussion_content":"ä¸¤ä¸ªå±‚é¢çš„ä¸œè¥¿","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1582037453,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91005,"user_name":"xuery","can_delete":false,"product_type":"c1","uid":1027584,"ip_address":"","ucode":"F461B61BE06131","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ae/00/025f37e7.jpg","comment_is_top":false,"comment_ctime":1556781673,"is_pvip":true,"replies":[{"id":"32624","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":91005,"uid":"1269969","ip_address":"","utype":1,"ctime":1556787233,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"27326585449","product_id":100023901,"comment_content":"ä¾‹å­ä¸­çš„æ¨¡æ‹ŸCASï¼Œcaså‡½æ•°æ˜¯åŠ äº†é”çš„ï¼Œä¿è¯æ•´ä¸ªæ“ä½œçš„åŸå­æ€§ï¼›æˆ‘çš„ç†è§£æ˜¯è¿™ä¸ªåªæ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿï¼Œå®é™…ä¸­è‚¯å®šä¸ä¼šåŠ ä¸Šé”çš„","like_count":6,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448761,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556787233,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86856,"user_name":"åˆ˜å¿—å…µ","can_delete":false,"product_type":"c1","uid":1441734,"ip_address":"","ucode":"A90C2FA49EDC23","user_header":"https://static001.geekbang.org/account/avatar/00/15/ff/c6/8b5cbe97.jpg","comment_is_top":false,"comment_ctime":1555466948,"is_pvip":false,"replies":[{"id":"31304","content":"æœ€ç»ˆä¾èµ–çš„æ˜¯cpuæä¾›çš„åŸå­æŒ‡ä»¤ï¼Œä¸ç”¨æˆ‘ä»¬æ“å¿ƒã€‚","user_name":"ä½œè€…å›å¤","comment_id":86856,"uid":"1269969","ip_address":"","utype":1,"ctime":1555510617,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"27325270724","product_id":100023901,"comment_content":"è€å¸ˆï¼ŒcompareAndSwapLongæ–¹æ³•æ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼Œæ¯”è¾ƒå…±äº«å˜é‡å’Œexpectå€¼æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰æ‰è®¾ç½®æ–°çš„å€¼x, ä¸æ˜ç™½è¿™é‡Œçš„å¯¹æ¯”æ˜¯æ€ä¹ˆä¿è¯åŸå­æ€§çš„ï¼Œå¯¹æ¯”ä¹Ÿæ˜¯è¦å†è¯»ä¸€æ¬¡å…±äº«å˜é‡ï¼Œç„¶åå¯¹æ¯”å§ï¼Œå¦‚æœå…ˆè¯»å‡ºæ¥ä¹‹åå¯¹æ¯”çš„æ—¶å€™è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†ï¼Œé‚£è¿˜æ˜¯ä¼šæœ‰é—®é¢˜","like_count":6,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447213,"discussion_content":"æœ€ç»ˆä¾èµ–çš„æ˜¯cpuæä¾›çš„åŸå­æŒ‡ä»¤ï¼Œä¸ç”¨æˆ‘ä»¬æ“å¿ƒã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555510617,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":142049,"user_name":"åˆ˜è‚²é£","can_delete":false,"product_type":"c1","uid":1363642,"ip_address":"","ucode":"06600614E898CC","user_header":"https://static001.geekbang.org/account/avatar/00/14/ce/ba/f73555c7.jpg","comment_is_top":false,"comment_ctime":1571283926,"is_pvip":true,"replies":[{"id":"54920","content":"caså¤§éƒ¨åˆ†éƒ½æ˜¯CPUæä¾›çš„æŒ‡ä»¤ï¼Œè¿™é‡Œåªæ˜¯æ¨¡æ‹Ÿå®ƒçš„åŸç†","user_name":"ä½œè€…å›å¤","comment_id":142049,"uid":"1269969","ip_address":"","utype":1,"ctime":1571361953,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"23046120406","product_id":100023901,"comment_content":" ä¸æ˜ç™½     synchronized int cas() è¿™ä¸æ˜¯å·²ç»ç”¨äº† åŒæ­¥synchronized å…³é”®å­— å—æ€ä¹ˆä¼š æ— é” æ— å µå¡å‘¢","like_count":5,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470967,"discussion_content":"caså¤§éƒ¨åˆ†éƒ½æ˜¯CPUæä¾›çš„æŒ‡ä»¤ï¼Œè¿™é‡Œåªæ˜¯æ¨¡æ‹Ÿå®ƒçš„åŸç†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571361953,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":107141,"user_name":"Vincent","can_delete":false,"product_type":"c1","uid":1189765,"ip_address":"","ucode":"F0A32C9210FF42","user_header":"https://static001.geekbang.org/account/avatar/00/12/27/85/06fbdeac.jpg","comment_is_top":false,"comment_ctime":1561466962,"is_pvip":true,"replies":[{"id":"38932","content":"å±€éƒ¨å˜é‡ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜","user_name":"ä½œè€…å›å¤","comment_id":107141,"uid":"1269969","ip_address":"","utype":1,"ctime":1561596038,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":1,"score":"23036303442","product_id":100023901,"comment_content":"ç¬¬ä¸€ä¸ªä¾‹å­ä¹Ÿä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„å§ï¼Ÿi++è¿™ä¸ªæ“ä½œä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¼šå¯¼è‡´åˆ¤æ–­é”™è¯¯å§ï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455382,"discussion_content":"å±€éƒ¨å˜é‡ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561596038,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86382,"user_name":"å¯†ç 123456","can_delete":false,"product_type":"c1","uid":1126593,"ip_address":"","ucode":"9889463CC0EA71","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/c1/2dde6700.jpg","comment_is_top":false,"comment_ctime":1555374383,"is_pvip":false,"replies":[{"id":"31046","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":86382,"uid":"1269969","ip_address":"","utype":1,"ctime":1555387328,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":2,"race_medal":0,"score":"18735243567","product_id":100023901,"comment_content":"æˆ‘è§‰å¾—å¯èƒ½ä¼šå‡ºç°æ­»å¾ªç¯ã€‚WMRange or = rf.get(); åº”è¯¥æ”¾åœ¨doé‡Œé¢ã€‚æ¯æ¬¡æ¯”è¾ƒäº¤æ¢å¤±è´¥åï¼Œé‡æ–°è·å–ä¸€æ¬¡ã€‚","like_count":4,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446996,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555387328,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1651848,"avatar":"","nickname":"Geek_039a5c","note":"","ucode":"08F4FA864D4B65","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":547947,"discussion_content":"cas  è‡ªå·±ä¸ä¼šå¾ªç¯è·å–ä¸€æ¬¡ é¢„æœŸå€¼å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642949908,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":131272,"user_name":"éšå¿ƒè€Œè‡³","can_delete":false,"product_type":"c1","uid":1097836,"ip_address":"","ucode":"31866865255101","user_header":"https://static001.geekbang.org/account/avatar/00/10/c0/6c/29be1864.jpg","comment_is_top":false,"comment_ctime":1567688054,"is_pvip":false,"replies":[{"id":"49595","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":131272,"uid":"1269969","ip_address":"","utype":1,"ctime":1567690739,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"14452589942","product_id":100023901,"comment_content":"æ„Ÿè§‰ç†è§£å¥½äº†volatileå’ŒCASï¼Œè¿™äº›åŸå­ç±»å°±éƒ½å¥½ç†è§£äº†","like_count":3,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466362,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567690739,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":95147,"user_name":"è€ƒä¼‘","can_delete":false,"product_type":"c1","uid":1053955,"ip_address":"","ucode":"968DFC00D6D0CF","user_header":"https://static001.geekbang.org/account/avatar/00/10/15/03/c0fe1dbf.jpg","comment_is_top":false,"comment_ctime":1557974592,"is_pvip":false,"replies":[{"id":"33988","content":"æˆ‘è§‰å¾—å¯ä»¥","user_name":"ä½œè€…å›å¤","comment_id":95147,"uid":"1269969","ip_address":"","utype":1,"ctime":1557980483,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"14442876480","product_id":100023901,"comment_content":"casçš„å®ç°åŸç†æ„Ÿè§‰è·Ÿä¹è§‚é”æœ‰ç›¸ä¼¼çš„åœ°æ–¹ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯å¯ä»¥è¿™ä¹ˆç†è§£","like_count":3,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450345,"discussion_content":"æˆ‘è§‰å¾—å¯ä»¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557980483,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":88077,"user_name":"linqw","can_delete":false,"product_type":"c1","uid":1134138,"ip_address":"","ucode":"09DCFE98C54DD8","user_header":"https://static001.geekbang.org/account/avatar/00/11/4e/3a/86196508.jpg","comment_is_top":false,"comment_ctime":1555840107,"is_pvip":false,"replies":[{"id":"31710","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":88077,"uid":"1269969","ip_address":"","utype":1,"ctime":1555894199,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"14440741995","product_id":100023901,"comment_content":"è¯¾åä¹ é¢˜ï¼šå¦‚æœåœ¨do{}while()ç¬¬ä¸€æ¬¡æ²¡è®¾ç½®æˆåŠŸï¼Œå³å¯¹è±¡å·²ç»è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ï¼Œorå·²ç»æ˜¯è¿‡æœŸçš„å¯¹è±¡ï¼Œå¯¼è‡´æ­»å¾ªç¯ï¼Œå¯ä»¥å†™æˆå¦‚ï¼š<br>public class SafeWM {<br>  class WMRange{<br>    final int upper;<br>    final int lower;<br>    WMRange(int upper,int lower){<br>\tif(upper &lt; lower){<br>        \t\tthrow new IllegalArgumentException();<br>      \t}<br>    &#47;&#47; çœç•¥æ„é€ å‡½æ•°å®ç°<br>    }<br>  }<br>  final AtomicReference&lt;WMRange&gt;<br>    rf = new AtomicReference&lt;&gt;(<br>      new WMRange(0,0)<br>    );<br>  &#47;&#47; è®¾ç½®åº“å­˜ä¸Šé™<br>  void setUpper(int v){<br>    WMRange nr;<br>    WMRange or;<br>    do{ <br>      or = = rf.get();<br>      nr = new<br>        WMRange(v, or.lower);<br>    }while(!rf.compareAndSet(or, nr));<br>  }<br>}","like_count":3,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447715,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555894199,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":224050,"user_name":"ä¸æµ·åŒå®½","can_delete":false,"product_type":"c1","uid":1312701,"ip_address":"","ucode":"2F1D3411C96898","user_header":"https://static001.geekbang.org/account/avatar/00/14/07/bd/9e8d1cff.jpg","comment_is_top":false,"comment_ctime":1591262955,"is_pvip":false,"replies":[{"id":"82611","content":"åˆ›å»ºçº¿ç¨‹æ˜¯ä¸ªè´¹æ—¶çš„æ“ä½œï¼Œè€Œçº¿ç¨‹æ‰§è¡ŒæœŸé—´å¤ªçŸ­ï¼Œæ‰€ä»¥å¹¶å‘åº¦ä¸é«˜ã€‚å¯ä»¥åœ¨çº¿ç¨‹æ‰§è¡Œæ–¹æ³•å†…éƒ¨åŠ å¾ªç¯è¯•è¯•","user_name":"ä½œè€…å›å¤","comment_id":224050,"uid":"1269969","ip_address":"","utype":1,"ctime":1591414753,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":4,"race_medal":0,"score":"10181197547","product_id":100023901,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼Œæˆ‘æœ‰ä¸ªå…³äºAtomicXXXæºç çš„é—®é¢˜ï¼Œæˆ‘å°†AtomicXXXæŸä¸€ä¸ªæºç å¤åˆ¶å‡ºæ¥ï¼Œå¹¶è¿›è¡Œç›¸å…³çš„æµ‹è¯•ï¼Œå‘ç°valueè¿™ä¸ªå±æ€§åŠ å’Œä¸åŠ volatileå…³é”®å­—æœ€ç»ˆçš„æµ‹è¯•ç»“æœéƒ½æ˜¯ä¸€è‡´çš„(æ‰€ä»¥å°±å¦„è‡ªçŒœæµ‹è¯¥å…³é”®å­—æ˜¯å¤šä½™çš„ï¼Œä½†æ˜¯æˆ‘çŸ¥é“è¿™è‚¯å®šä¸å¯èƒ½)ï¼Œå¦‚ä¸‹æ˜¯æˆ‘çš„æµ‹è¯•ç±»ï¼ŒAtomicIntegerä¸¤æ¬¡çš„æµ‹è¯•ä¸åŒåœ¨äºåŠ å’Œä¸åŠ volatileå…³é”®å­—ï¼Œå¸Œæœ›è€å¸ˆèƒ½ç­”å¤ï¼Œè¿™ä¸ªé—®é¢˜å¿«æŠŠæˆ‘æ†‹å‡ºå†…ä¼¤æ¥äº†<br>    &#47;&#47; JDK 1.8<br>    private static final AtomicInteger atomicInteger = new AtomicInteger(0);<br>    public static void main(String[] args) throws InterruptedException {<br>        for(int i = 0; i &lt; 10000; i++) {<br>            new Thread(() -&gt; {<br>                atomicInteger.incrementAndGet();<br>            }).start();<br>        }<br>        Thread.sleep(1000);<br>        System.out.println(atomicInteger.get());<br>    }","like_count":2,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":497346,"discussion_content":"åˆ›å»ºçº¿ç¨‹æ˜¯ä¸ªè´¹æ—¶çš„æ“ä½œï¼Œè€Œçº¿ç¨‹æ‰§è¡ŒæœŸé—´å¤ªçŸ­ï¼Œæ‰€ä»¥å¹¶å‘åº¦ä¸é«˜ã€‚å¯ä»¥åœ¨çº¿ç¨‹æ‰§è¡Œæ–¹æ³•å†…éƒ¨åŠ å¾ªç¯è¯•è¯•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591414753,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1255574,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqgVXa8DyW0YsrdYtPNMOdGH6hfdwfjwyBPRyoc9yuS4Ml18l0kApOoOKwYkF6NlDPYpX1bVEWomw/132","nickname":"æœ€æ‘‡æ‘†çš„é±¼","note":"","ucode":"DA19F4C4224719","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":409576,"discussion_content":"æŸ¥äº†ä¸€ä¸‹ï¼Œå¦‚æœä¸æ˜¯ç»å¸¸å˜æ¢automicintegerçš„å¼•ç”¨çš„è¯ä¸éœ€è¦ä½¿ç”¨volatileã€‚automicintegerå·²ç»ä¿è¯äº†å¯è§æ€§ï¼Œè€å¸ˆåé¢çš„è®²è§£ä¹Ÿæåˆ°äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635470454,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1255574,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqgVXa8DyW0YsrdYtPNMOdGH6hfdwfjwyBPRyoc9yuS4Ml18l0kApOoOKwYkF6NlDPYpX1bVEWomw/132","nickname":"æœ€æ‘‡æ‘†çš„é±¼","note":"","ucode":"DA19F4C4224719","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":409570,"discussion_content":"æˆ‘ä¹Ÿæœ‰è¿™ä¸ªé—®é¢˜ï¼ŒAtomicIntegerå‰é¢è¿˜éœ€è¦volatileå…³é”®å­—å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635469967,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1441569,"avatar":"https://static001.geekbang.org/account/avatar/00/15/ff/21/8815d2e5.jpg","nickname":"äº®å­","note":"","ucode":"DF37D5E0714D02","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1255574,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqgVXa8DyW0YsrdYtPNMOdGH6hfdwfjwyBPRyoc9yuS4Ml18l0kApOoOKwYkF6NlDPYpX1bVEWomw/132","nickname":"æœ€æ‘‡æ‘†çš„é±¼","note":"","ucode":"DA19F4C4224719","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":544258,"discussion_content":"æœ¬èº«å°±æ˜¯å®‰å…¨çš„ï¼Œä¸éœ€è¦volatile","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641450265,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":409570,"ip_address":""},"score":544258,"extra":""}]}]},{"had_liked":false,"id":179602,"user_name":"Eric","can_delete":false,"product_type":"c1","uid":1053498,"ip_address":"","ucode":"59752A51A382A6","user_header":"https://static001.geekbang.org/account/avatar/00/10/13/3a/b0454322.jpg","comment_is_top":false,"comment_ctime":1582037731,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10171972323","product_id":100023901,"comment_content":"è¯·é—®  unsafe.getAndAddLong()ä¸­æ˜¯å¦‚ä½•è§£å†³ABAé—®é¢˜çš„ï¼Ÿ","like_count":2},{"had_liked":false,"id":152845,"user_name":"ä¸œé£ç¬¬ä¸€æ","can_delete":false,"product_type":"c1","uid":1402697,"ip_address":"","ucode":"0CD0F62E90DAD8","user_header":"https://static001.geekbang.org/account/avatar/00/15/67/49/864dba17.jpg","comment_is_top":false,"comment_ctime":1574088531,"is_pvip":false,"replies":[{"id":"59688","content":"è¿™æ®µä»£ç æ‰€åœ¨çš„æ–¹æ³•æ˜¯synchronizedğŸ˜‚","user_name":"ä½œè€…å›å¤","comment_id":152845,"uid":"1269969","ip_address":"","utype":1,"ctime":1574729396,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"10164023123","product_id":100023901,"comment_content":"&#47;&#47; æ¯”è¾ƒç›®å‰countå€¼æ˜¯å¦==æœŸæœ›å€¼    <br>if(curValue == expect){      <br>&#47;&#47; å¦‚æœæ˜¯ï¼Œåˆ™æ›´æ–°countçš„å€¼      <br>count= newValue;    <br>}<br>==========<br>è¿™æ®µä»£ç è€å¸ˆè¯´æ˜¯ä»…ç”¨æ¥å¸®åŠ©ç†è§£ï¼Œå®é™…ä¸Šè¿™ä¸ªæ˜¯å­˜åœ¨ç«æ€æ¡ä»¶çš„ï¼Œå¦‚æœåœ¨ifæ‰§è¡Œå®Œä¹‹åï¼Œcountçš„å€¼è¢«åˆ«çš„å˜é‡ä¿®æ”¹ï¼Œé‚£ä¹ˆç»“æœå°±ä¸æ­£ç¡®äº†ã€‚æƒ³æ‰¾è€å¸ˆç¡®è®¤ä¸€ä¸‹æˆ‘ç†è§£çš„å¯¹ä¸å¯¹ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474960,"discussion_content":"è¿™æ®µä»£ç æ‰€åœ¨çš„æ–¹æ³•æ˜¯synchronizedğŸ˜‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574729396,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":97385,"user_name":"Sean","can_delete":false,"product_type":"c1","uid":1242497,"ip_address":"","ucode":"2521FB6292F304","user_header":"https://static001.geekbang.org/account/avatar/00/12/f5/81/92d01e3a.jpg","comment_is_top":false,"comment_ctime":1558663054,"is_pvip":false,"replies":[{"id":"34844","content":"væ˜¯ä¸Šé™ï¼Œä¸‹é™ä¸å˜ï¼Œæ²¡é—®é¢˜","user_name":"ä½œè€…å›å¤","comment_id":97385,"uid":"1269969","ip_address":"","utype":1,"ctime":1558672954,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"10148597646","product_id":100023901,"comment_content":"è®¾ç½®ä¸Šé™ä¸ºä»€ä¹ˆæ˜¯WMRange(v, or.lower);? æ˜¯ç¬”è¯¯è¿˜æ˜¯æˆ‘ç†è§£é”™äº†ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451261,"discussion_content":"væ˜¯ä¸Šé™ï¼Œä¸‹é™ä¸å˜ï¼Œæ²¡é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558672954,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":87316,"user_name":"Mark","can_delete":false,"product_type":"c1","uid":1125474,"ip_address":"","ucode":"01437C4021E82E","user_header":"https://static001.geekbang.org/account/avatar/00/11/2c/62/b5fcbf2b.jpg","comment_is_top":false,"comment_ctime":1555566579,"is_pvip":false,"replies":[{"id":"31549","content":"æœ‰è¿™ç§å¯èƒ½","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1555675635,"ip_address":"","comment_id":87316,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5850533875","product_id":100023901,"comment_content":"è¯·æ•™ä¸€ä¸ªé—®é¢˜<br>compareAndSwapLong æ›´æ–°å®Œåè¿”å›çš„æ˜¯true falseï¼Œå†return vã€‚è¿™æ˜¯ä¸¤æ­¥æ“ä½œï¼Œreturn vä¹‹å‰ï¼Œå†…å­˜å€¼æœ‰å¯èƒ½å·²ç»è¢«è¯¥äº†ï¼Œä¸æ˜¯väº†ã€‚<br>æœ‰è¿™ç§å¯èƒ½å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447395,"discussion_content":"æœ‰è¿™ç§å¯èƒ½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555675635,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86512,"user_name":"å°èåœ","can_delete":false,"product_type":"c1","uid":1033008,"ip_address":"","ucode":"2D51E0D8B4A3F9","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c3/30/6ae57626.jpg","comment_is_top":false,"comment_ctime":1555386989,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5850354285","product_id":100023901,"comment_content":"ç¬¬16è¡Œåº”è¯¥æ”¾åœ¨å¾ªç¯ä½“å†…","like_count":1},{"had_liked":false,"id":86417,"user_name":"å¼ ä¸‰","can_delete":false,"product_type":"c1","uid":1004092,"ip_address":"","ucode":"1155528FAE1546","user_header":"https://static001.geekbang.org/account/avatar/00/0f/52/3c/d6fcb93a.jpg","comment_is_top":false,"comment_ctime":1555376721,"is_pvip":false,"replies":[{"id":"31041","content":"ç­‰ä»·çš„<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1555386140,"ip_address":"","comment_id":86417,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5850344017","product_id":100023901,"comment_content":"å¯¹æ–‡ä¸­ çš„ do{}while()å¾ªç¯æœ‰ç‚¹å›°æƒ‘ï¼Œä¸ºä»€ä¹ˆä¸æ˜¯while(){}?","like_count":1,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447010,"discussion_content":"ç­‰ä»·çš„\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555386140,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":349853,"user_name":"buynow","can_delete":false,"product_type":"c1","uid":1105118,"ip_address":"","ucode":"655871D1E6CB15","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/OkKvEddT1v8sKic6XrJEib3FoMxsyKMpT9znC3qicl9iaFj2B5MZ23kYkhmkUUJrhd2VNrnkpwxMRHbC9rBwibFc5Kg/132","comment_is_top":false,"comment_ctime":1656386909,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1656386909","product_id":100023901,"comment_content":"CASå’ŒåŠ é”æ“ä½œåœ¨å„ç§ä¸åŒåœºæ™¯æ€§èƒ½åŒºåˆ«æ˜¯ä»€ä¹ˆ","like_count":0},{"had_liked":false,"id":347924,"user_name":"æœˆæ˜é£æ¸…","can_delete":false,"product_type":"c1","uid":2226367,"ip_address":"","ucode":"65A97CF2E320FA","user_header":"https://static001.geekbang.org/account/avatar/00/21/f8/bf/59f2e600.jpg","comment_is_top":false,"comment_ctime":1654585724,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1654585724","product_id":100023901,"comment_content":"æˆ‘æƒ³é—®ä¸€ä¸‹ï¼Œä»€ä¹ˆåœºæ™¯ä¸‹éœ€è¦å…³å¿ƒ ABA é—®é¢˜å‘¢ï¼Œå¯ä¸å¯ä»¥ä¸¾ä¸ªå®ä¾‹çš„ä¾‹å­ã€‚","like_count":0},{"had_liked":false,"id":347923,"user_name":"æœˆæ˜é£æ¸…","can_delete":false,"product_type":"c1","uid":2226367,"ip_address":"","ucode":"65A97CF2E320FA","user_header":"https://static001.geekbang.org/account/avatar/00/21/f8/bf/59f2e600.jpg","comment_is_top":false,"comment_ctime":1654585522,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1654585522","product_id":100023901,"comment_content":"æˆ‘æƒ³é—®ä¸€ä¸‹ï¼Œä»€ä¹ˆåœºæ™¯ä¸‹ä¸éœ€è¦å…³æ³¨ ABA é—®é¢˜å‘¢ï¼Ÿèƒ½ä¸èƒ½ä¸¾ä¸ªå®é™…çš„ä¾‹å­ã€‚","like_count":0},{"had_liked":false,"id":335590,"user_name":"å®ˆæŠ¤æˆ‘çš„æ•Œäººç—›å‡»æˆ‘çš„é˜Ÿå‹","can_delete":false,"product_type":"c1","uid":1266754,"ip_address":"","ucode":"670EDBA2ADE37B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKsYRmTSDl6eYB1u3afF26TCbFRQFUocpQajGdlU84icFmvsF6K4hYg30faTcYeH2Jnw7TWNu0Nd1w/132","comment_is_top":false,"comment_ctime":1645597901,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1645597901","product_id":100023901,"comment_content":"è¨è¾¾","like_count":0},{"had_liked":false,"id":327878,"user_name":"å‡¯æ–‡å°çŒª","can_delete":false,"product_type":"c1","uid":1980201,"ip_address":"","ucode":"36D8AD0229547F","user_header":"https://static001.geekbang.org/account/avatar/00/1e/37/29/b3af57a7.jpg","comment_is_top":false,"comment_ctime":1640336264,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1640336264","product_id":100023901,"comment_content":"åŠ é”ã€è§£é”æ“ä½œæœ¬èº«å°±æ¶ˆè€—æ€§èƒ½ï¼›åŒæ—¶æ‹¿ä¸åˆ°é”çš„çº¿ç¨‹è¿˜ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè¿›è€Œè§¦å‘çº¿ç¨‹åˆ‡æ¢ï¼Œçº¿ç¨‹åˆ‡æ¢å¯¹æ€§èƒ½çš„æ¶ˆè€—ä¹Ÿå¾ˆå¤§ã€‚<br><br>è¿™ä¸€ç‚¹ä¸€ç›´æ˜¯è¯¯å¯¼å¾ˆå¤šäººçš„ï¼ŒåŠ è§£é”æœ¬èº«åªæ˜¯è°ƒç”¨ç³»ç»Ÿåº“å‡½æ•° è¿›å…¥ä¿æŠ¤æ¨¡å¼ å¯ç”¨å†…å­˜é¡µä¿æŠ¤åœ°å€ ä¿å­˜å¯„å­˜å™¨è€Œå·²ã€‚<br>è€Œä¼ ç»Ÿçš„ç³»ç»Ÿåº“å‡½æ•°éƒ½æ˜¯åœ¨å‡ ånsçº§åˆ«å¯å®Œæˆã€‚è€ŒåŠ é”å¤±è´¥ä¹Ÿåªæ˜¯æ‰”åˆ°é˜»å¡é“¾è¡¨é‡Œè€Œå·²<br>æ‰€ä»¥é”çš„é—®é¢˜å®é™…ä¸Šæ˜¯ä¸¤ç±»ï¼š<br>1.é¢‘ç¹è°ƒç”¨é”å¼•å‘çš„çº¿ç¨‹åˆ‡æ¢ è¿™ä¸ªæ˜¯ä¸æ•°é‡çº§æˆæ­£ç›¸å…³çš„ æ‰€ä»¥å¦‚æœåªæ˜¯ä¸¤ä¸¤çº¿ç¨‹ä¹‹é—´ æˆ–è€…nä¸ªï¼ˆæ•°é‡æœ‰é™ï¼‰çº¿ç¨‹çš„æƒ…å†µä¸‹ ï¼Œè¯•æƒ³æˆ‘ä»¬ä»£ç ä¸­æ‰€æœ‰çš„è¯»å†™io DMAæ‹·è´éƒ½æ˜¯åº“å‡½æ•°è°ƒç”¨<br>2.å¯¹äºé”çš„æŒæ§ å¦‚æ­»é”ï¼ŒåŠ é”å¤±è´¥å¤„ç†ã€‚ä¸´ç•ŒåŒºæºæ‚å…¶ä»–IOæ“ä½œ å¯¼è‡´é”çŸ­æ—¶é—´å†…æ— æ³•é‡Šæ”¾ ï¼Œæ˜¯å¤§å¤šæ•°äººç•æƒ§é”çš„åŸå› <br>","like_count":0},{"had_liked":false,"id":316668,"user_name":"å°é’¢ç‚®","can_delete":false,"product_type":"c1","uid":2029015,"ip_address":"","ucode":"676C4CCF3CCD0D","user_header":"","comment_is_top":false,"comment_ctime":1634481608,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634481608","product_id":100023901,"comment_content":"CASçš„è‡ªæ—‹æ¯æ¬¡éƒ½åº”è¯¥ä»å†…å­˜ä¸­è¯»å–æœ€æ–°çš„å€¼åˆ¤æ–­","like_count":0},{"had_liked":false,"id":304143,"user_name":"Geek_e6f358","can_delete":false,"product_type":"c1","uid":1855137,"ip_address":"","ucode":"C21E94A90258A2","user_header":"","comment_is_top":false,"comment_ctime":1627271717,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1627271717","product_id":100023901,"comment_content":" WMRange or = rf.get();åº”è¯¥æ”¾åœ¨doé‡Œé¢ï¼Œæ¯æ¬¡å¾ªç¯éƒ½é‡æ–°è·å–æœ€æ–°çš„å€¼ï¼Œå¦åˆ™orä¼šæŒ‡å‘æ—§å¼•ç”¨ï¼Œä»è€Œä¸€ç›´è‡ªæ—‹ä¸‹å»","like_count":0},{"had_liked":false,"id":291914,"user_name":"çº½æ‰£","can_delete":false,"product_type":"c1","uid":1313813,"ip_address":"","ucode":"870A1E731E1C02","user_header":"https://static001.geekbang.org/account/avatar/00/14/0c/15/ad1d202c.jpg","comment_is_top":false,"comment_ctime":1620606365,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1620606365","product_id":100023901,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œè¯·é—®ï¼šCASæœ‰å¯èƒ½å› ä¸ºæ— é™è‡ªæ—‹å¯¼è‡´æ´»é”é—®é¢˜è¿™ä¸ªå¯ä»¥ç†è§£ï¼Œä½†æ˜¯é¥¥é¥¿é—®é¢˜æ˜¯å¦‚ä½•å¯¼è‡´çš„å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2420294,"avatar":"https://static001.geekbang.org/account/avatar/00/24/ee/46/7d65ae37.jpg","nickname":"æœ¨å‡ ä¸¶","note":"","ucode":"FFDB958DA64F8C","race_medal":5,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390840,"discussion_content":"éå…¬å¹³é”ï¼Œå¯¼è‡´ä¸€ç›´æ‹¿ä¸åˆ°é”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630073944,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":286264,"user_name":"æ´›å¥‡","can_delete":false,"product_type":"c1","uid":1624355,"ip_address":"","ucode":"662B4005721119","user_header":"https://static001.geekbang.org/account/avatar/00/18/c9/23/76511858.jpg","comment_is_top":false,"comment_ctime":1617236592,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617236592","product_id":100023901,"comment_content":"ä¸æ˜¯å¤ªæ‡‚ï¼Œä¸ºä»€ä¹ˆå…±äº«å˜é‡çš„å¯¹è±¡å¼•ç”¨çš„æ›´æ–°ä¹Ÿéœ€è¦åŸå­åŒ–ï¼Ÿ","like_count":0},{"had_liked":false,"id":282041,"user_name":"ä¿ºèƒ½å­¦ä¸ªå•¥","can_delete":false,"product_type":"c1","uid":1026742,"ip_address":"","ucode":"30740C5B58774C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/aa/b6/46a5bbf3.jpg","comment_is_top":false,"comment_ctime":1615025839,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1615025839","product_id":100023901,"comment_content":"CASæ“ä½œå°†rfçš„å¼•ç”¨ç”±oræ›¿æ¢ä¸ºnrå¤±è´¥åï¼Œè¯´æ˜å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†åŸå­å¼•ç”¨ï¼Œåˆ™éœ€è¦è·å–æœ€æ–°çš„åŸå­å¼•ç”¨å†æ¬¡é‡è¯•ï¼Œä½†è·å–æ“ä½œåœ¨å¾ªç¯ä½“å¤–ï¼Œæ•…å¦‚æœCASå¤±è´¥ä¼šé™·å…¥æ­»å¾ªç¯ï¼ŒæˆåŠŸçš„è¯å°±ç›´æ¥è·³å‡ºï¼Œå¯ä»¥æŠŠè·å–åŸå­å¼•ç”¨æ“ä½œç½®äºå¾ªç¯ä½“å†…","like_count":0},{"had_liked":false,"id":270462,"user_name":"poordickey","can_delete":false,"product_type":"c1","uid":1810156,"ip_address":"","ucode":"2A436EC813AF97","user_header":"","comment_is_top":false,"comment_ctime":1609137874,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609137874","product_id":100023901,"comment_content":"ä¸å¾—ä¸è¯´  è¿™è¯¾ç¨‹æ¯”çœ‹ä¹¦å¥½å¤ªå¤šäº†  ä¹¦æœ¬æ€»æ˜¯è®²ç©¶å…¨é¢ç³»ç»Ÿ  è€Œä¸æ˜¯è¡Œå¦‚æµæ°´å¸¦ç€è§£å†³é—®é¢˜çš„æ€è·¯å»è®²è§£çŸ¥è¯†ç‚¹  å¾ˆæ£’  è€å¸ˆå†…åŠŸçœŸçš„å¾ˆä¸é”™","like_count":0},{"had_liked":false,"id":263889,"user_name":"ç“¶å­éœ¸å“¥","can_delete":false,"product_type":"c1","uid":1125806,"ip_address":"","ucode":"A7EEB459AB5550","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/nVVI6Fib5LHbhAhv8CJ9MYPau7Lcp840ST6BeqnlibUNmI4UYvGIzxtOHcKIzFa10ERANAZQUaiaKkQg4SowsUR2g/132","comment_is_top":false,"comment_ctime":1606288352,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606288352","product_id":100023901,"comment_content":"æˆ‘çœ‹åˆ° AtomicReference æœ‰ä¸ª updateAndGet() æ–¹æ³•ï¼Œä½†æ˜¯é‡Œé¢æ²¡æœ‰ç”¨ CAS. æ˜¯ä¸ºä»€ä¹ˆå•Šï¼Ÿæˆ‘è´´ä¸€ä¸‹ AtomicReference#updateAndGet çš„å®ç°<br>    &#47;**<br>     * Atomically updates (with memory effects as specified by {@link<br>     * VarHandle#compareAndSet}) the current value with the results of<br>     * applying the given function, returning the updated value. The<br>     * function should be side-effect-free, since it may be re-applied<br>     * when attempted updates fail due to contention among threads.<br>     *<br>     * @param updateFunction a side-effect-free function<br>     * @return the updated value<br>     * @since 1.8<br>     *&#47;<br>    public final V updateAndGet(UnaryOperator&lt;V&gt; updateFunction) {<br>        V prev = get(), next = null;<br>        for (boolean haveNext = false;;) {<br>            if (!haveNext)<br>                next = updateFunction.apply(prev);<br>            if (weakCompareAndSetVolatile(prev, next))<br>                return next;<br>            haveNext = (prev == (prev = get()));<br>        }<br>    }","like_count":0},{"had_liked":false,"id":251234,"user_name":"maybe","can_delete":false,"product_type":"c1","uid":1475528,"ip_address":"","ucode":"93D160F617E750","user_header":"https://static001.geekbang.org/account/avatar/00/16/83/c8/5ce842f6.jpg","comment_is_top":false,"comment_ctime":1601432658,"is_pvip":false,"discussion_count":0,"race_medal":4,"score":"1601432658","product_id":100023901,"comment_content":"CASæ¯æ¬¡è‡ªæ—‹å¿…é¡»è¦é‡æ–°æ£€æŸ¥æ–°çš„å€¼æ‰æœ‰æ„ä¹‰","like_count":0},{"had_liked":false,"id":245417,"user_name":"fightingD","can_delete":false,"product_type":"c1","uid":1443637,"ip_address":"","ucode":"AD2876CED5D5AC","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKwViav94kcF50CxA0Jw7icicxociaVzut97iacy3b2ciacFqXuFWdiakVq304YcI8pt4HT5A1Yvp8EkYCpw/132","comment_is_top":false,"comment_ctime":1598940807,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598940807","product_id":100023901,"comment_content":"åº”è¯¥æœ‰é—®é¢˜ï¼ŒåŸå­åŒ–çš„å¯¹è±¡å¼•ç”¨èƒ½ä¿è¯å¼•ç”¨å¯¹è±¡çš„åŸå­æ›´æ–°ï¼Œä½†æ˜¯å½“æœ‰ç«æ€æ¡ä»¶çš„æ—¶å€™è¿˜æ˜¯éœ€è¦ç”¨äº’æ–¥é”æ¥å¤„ç†ã€‚","like_count":0},{"had_liked":false,"id":239011,"user_name":"æƒ˜ é—»","can_delete":false,"product_type":"c1","uid":1181650,"ip_address":"","ucode":"C5909F034BF072","user_header":"https://static001.geekbang.org/account/avatar/00/12/07/d2/0d7ee298.jpg","comment_is_top":false,"comment_ctime":1596414955,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596414955","product_id":100023901,"comment_content":"æ ¹æ®æ¨¡æ‹Ÿä»£ç æ¥çœ‹ï¼Œcpuä¿è¯çš„åŸå­æ€§çš„æ­¥éª¤ä¸€å…±ä¸‰ä¸ªã€‚1.è¯»å–countçš„å€¼ï¼Œèµ‹å€¼ç»™curcount. 2.æ¯”è¾ƒcountå’Œcurcountå€¼æ˜¯å¦ä¸€è‡´ 3.å°†è®¡ç®—åçš„æ–°å€¼èµ‹å€¼ç»™count  ä¸€å…±ä¸‰ä¸ªæ­¥éª¤ã€‚åŸæœ¬çš„ç–‘æƒ‘æ˜¯æ—¢ç„¶å¯ä»¥ä¿è¯ä¸‰ä¸ªæŒ‡ä»¤çš„åŸå­æ€§ï¼Œé‚£ä¸ºä½•ä¸èƒ½ä¿è¯ä¸¤ä¸ªæ“ä½œçš„åŸå­æ€§å‘¢(1.è¯»å–countå€¼ 2.è®¡ç®—åçš„æ–°å€¼èµ‹å€¼ç»™countå€¼)  åé¢é˜…è¯»åˆ°è‡ªæ—‹çš„æ—¶å€™æ˜ç™½äº†ï¼Œå…¶å®cpuä¹Ÿä¸èƒ½ä¿è¯ä¸‰ä¸ªæŒ‡ä»¤ç»„åˆçš„åŸå­æ€§ï¼Œä¹Ÿåªèƒ½ä¸€æ¡ä¸€æ¡çš„ä¿è¯ã€‚","like_count":0},{"had_liked":false,"id":231409,"user_name":"Geek_41d472","can_delete":false,"product_type":"c1","uid":1247965,"ip_address":"","ucode":"DEC2B6329460CF","user_header":"https://static001.geekbang.org/account/avatar/00/13/0a/dd/88fa7b52.jpg","comment_is_top":false,"comment_ctime":1593670772,"is_pvip":false,"replies":[{"id":"85621","content":"Unsafeçš„å‘½åå’Œå¤šçº¿ç¨‹åº”è¯¥æ²¡æœ‰å…³ç³»ğŸ˜‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1593836288,"ip_address":"","comment_id":231409,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1593670772","product_id":100023901,"comment_content":"ä¸“æ ä¹°äº†å¥½ä¹…äº†ä¸€ç›´æ²¡çœ‹å®Œ,æœ€è¿‘æ‰æœ‰æ—¶é—´çœ‹åˆ°è¿™é‡Œ,ä¸çŸ¥é“è€å¸ˆè¿˜å…³æ³¨è¿™ä¸ªä¸“æ é—®é¢˜å—,æˆ‘è¿˜æ˜¯æŠ±ç€è¯•è¯•å¿ƒæ€,ä¸‡ä¸€è€å¸ˆè¿˜å…³æ³¨å‘¢.<br>æˆ‘ç°åœ¨çš„é—®é¢˜æ˜¯,åŸå­ç±»unsafe.getAndAddLong() ,ä»åå­—æ˜¯çœ‹ unsafeå°±æ˜¯ä¸å®‰å…¨çš„æ„æ€,é‚£ä¹ˆè°ƒç”¨è¿™ä¸ªæ–¹æ³•çº¿ç¨‹åˆ°åº•å®‰ä¸å…¨å‘¢?ä¸ç„¶ä¸ºä½•ä¼šè¿™æ ·å‘½å?","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500291,"discussion_content":"Unsafeçš„å‘½åå’Œå¤šçº¿ç¨‹åº”è¯¥æ²¡æœ‰å…³ç³»ğŸ˜‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593836288,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":227166,"user_name":"è®¾è®¡æ¨¡å¼å¹¶å‘ç¼–ç¨‹","can_delete":false,"product_type":"c1","uid":2020762,"ip_address":"","ucode":"9EB371149F19EF","user_header":"https://static001.geekbang.org/account/avatar/00/1e/d5/9a/515fd6f2.jpg","comment_is_top":false,"comment_ctime":1592303084,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592303084","product_id":100023901,"comment_content":"å¦‚æœ cas(count,newValue) è¿”å›çš„å€¼ä¸ç­‰äº countï¼Œåˆ™æ„å‘³ç€çº¿ç¨‹åœ¨æ‰§è¡Œå®Œä»£ç â‘ å¤„ä¹‹åï¼Œæ‰§è¡Œä»£ç â‘¡å¤„ä¹‹å‰ï¼Œcount çš„å€¼è¢«å…¶ä»–çº¿ç¨‹æ›´æ–°è¿‡ã€‚<br>---------    è¿™å¥è¯æ˜¯ä¸æ˜¯è¯´é”™äº†å•Šï¼Ÿâ€ä¸ç­‰äºâ€œåº”è¯¥æ”¹æˆâ€œç­‰äºâ€ ","like_count":0},{"had_liked":false,"id":226870,"user_name":"å¤å¤œ","can_delete":false,"product_type":"c1","uid":1341612,"ip_address":"","ucode":"0A82D3CFCEDF07","user_header":"https://static001.geekbang.org/account/avatar/00/14/78/ac/e5e6e7f3.jpg","comment_is_top":false,"comment_ctime":1592220302,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592220302","product_id":100023901,"comment_content":"<br>class SimulatedCAS{<br>  int countï¼›<br>  synchronized int cas(<br>    int expect, int newValue){<br>    &#47;&#47; è¯»ç›®å‰countçš„å€¼<br>    int curValue = count;<br>    &#47;&#47; æ¯”è¾ƒç›®å‰countå€¼æ˜¯å¦==æœŸæœ›å€¼<br>    if(curValue == expect){<br>      &#47;&#47; å¦‚æœæ˜¯ï¼Œåˆ™æ›´æ–°countçš„å€¼<br>      count = newValue;<br>    }<br>    &#47;&#47; è¿”å›å†™å…¥å‰çš„å€¼<br>    return curValue;<br>  }<br>}<br><br>ä¸ºä»€ä¹ˆè¦è¿”å›æ—§å€¼å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":212849,"user_name":"better","can_delete":false,"product_type":"c1","uid":1169063,"ip_address":"","ucode":"AF1DB566EBB8A5","user_header":"https://static001.geekbang.org/account/avatar/00/11/d6/a7/ac23f5a6.jpg","comment_is_top":false,"comment_ctime":1588224355,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588224355","product_id":100023901,"comment_content":"è€å¸ˆï¼Œæˆ‘æ„Ÿè§‰ compareAndSwapLong() æ­¤natvieæ–¹æ³•ä¸­ï¼Œåº”è¯¥ä¼šç»§ç»­è·å–æœ€æ–°çš„ value å€¼å§ï¼Œä¸ç„¶ä¼šé€ æˆæ­»å¾ªç¯çš„æ„Ÿè§‰ï¼Œå¯¹æ¯”æ‚¨çš„ç¤ºä¾‹ä»£ç ä¾‹å­ï¼Œä¹Ÿæœ‰é‡æ–°è·å– value å€¼ã€‚","like_count":0},{"had_liked":false,"id":185719,"user_name":"Alex","can_delete":false,"product_type":"c1","uid":1024763,"ip_address":"","ucode":"F6B5C64BC99FB7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a2/fb/94af9cf1.jpg","comment_is_top":false,"comment_ctime":1583670368,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583670368","product_id":100023901,"comment_content":"16è¡Œåº”æ”¾å¾ªç¯å†…ï¼Œå¦‚æœæœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹æˆåŠŸï¼Œé‚£ä¹ˆæ¯æ¬¡éƒ½æ˜¯rfçš„æœ€æ–°å¯¹è±¡è·Ÿæ—§å¯¹è±¡æ¯”è¾ƒè¿›å…¥æ­»å¾ªç¯","like_count":0},{"had_liked":false,"id":170830,"user_name":"ä¹¾å¤ç¬é—´","can_delete":false,"product_type":"c1","uid":1683130,"ip_address":"","ucode":"15BDCF29CBF8EB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLWIUF31dicT1YBTxWNX0uvbMxl15UwdlwFicGhNo0DsQ7CbM6k16EQxK7bwSMcicLGMdYto4jGPTvrg/132","comment_is_top":false,"comment_ctime":1578733639,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578733639","product_id":100023901,"comment_content":"CASç†è§£çš„å…³é”®æ‰€åœ¨Aä¸ºå†…å­˜ä¸­ä¸Šæ¬¡çš„å€¼ï¼Œç”±äºå¯è§æ€§é—®é¢˜ï¼Œçº¿ç¨‹å¤„ç†Açš„æ—¶å€™ï¼Œä¼šåŠ è½½åˆ°å½“å‰çº¿ç¨‹ä¸­çš„å·¥ä½œç©ºé—´ä¸­ï¼Œå› æ­¤ã€‚ä¸‹æ¬¡æ›´æ–°çš„çš„æ—¶å€™ï¼Œåªè¦ä¿è¯å½“å‰çš„Aä¸å·¥ä½œç©ºé—´ä¸­çš„å€¼ä¸€ç›´çš„æ—¶å€™æ‰èƒ½æ‹¥æœ‰è¢«æ›´æ–°çš„æ“ä½œï¼ŒåŒæ—¶è¯»å†…å­˜çš„å€¼ä¸å†™å†…å­˜å€¼çš„æ“ä½œå¿…é¡»è¦äº’æ–¥ï¼Œå¦åˆ™ï¼Œåœ¨æ›´æ–°å€¼çš„åŒæ—¶æœ‰ä¸€ä¸ªçº¿ç¨‹Tè¯»å–äº†å†…å­˜ç›¸å…³çš„å†…å­˜å€¼ï¼Œæ­¤æ—¶ï¼ŒTçº¿ç¨‹ä»ç„¶ä¼šæ›´æ–°ï¼Œè¿™ä¸ªæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ","like_count":0},{"had_liked":false,"id":153770,"user_name":"æœ•çˆ±å¾å¦ƒ","can_delete":false,"product_type":"c1","uid":1733692,"ip_address":"","ucode":"B10EB69934F9E2","user_header":"https://static001.geekbang.org/account/avatar/00/1a/74/3c/da79d2a1.jpg","comment_is_top":false,"comment_ctime":1574304874,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574304874","product_id":100023901,"comment_content":"WMRange or = rf.get();è¿™å¥è¯ä¸æ”¾å…¥do-whileé‡Œè¿™ä¸ªorå€¼ä¸€ç›´ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä¹Ÿå°±æ˜¯å¦‚æœåœ¨è·å–orè¿™ä¸ªä¹‹åï¼Œä¿®æ”¹è¿™ä¸ªå€¼ä¹‹å‰ï¼Œæœ‰å…¶ä»–çº¿ç¨‹è¿›è¡Œå€¼çš„ä¿®æ”¹ï¼Œè¿™æ ·æ¯”è¾ƒçš„æ—¶å€™å°±ä¼šå‡ºç°ä¸æœŸæœ›å€¼ä¸ä¸€æ ·çš„æƒ…å†µï¼Œç„¶åå¾ªç¯ï¼Œè¿™æ—¶å€™orè¿˜æ˜¯æ²¡æœ‰ä¿®æ”¹ï¼Œè¿˜æ˜¯ä¸æœŸæœ›å€¼ä¸ä¸€æ ·ï¼Œç„¶åå†æ¬¡å¾ªç¯... ...ï¼Œè¿™æ ·è¿™ä¸ªçº¿ç¨‹å°±ä¼šè¿›è¡Œæ­»å¾ªç¯ï¼Œå¦‚æœæ˜¯å®é™…é¡¹ç›®ä¸­çš„è¯ï¼Œåº”è¯¥ä¼šè§¦å‘è¶…æ—¶","like_count":0},{"had_liked":false,"id":148506,"user_name":"è€ƒä¼‘","can_delete":false,"product_type":"c1","uid":1053955,"ip_address":"","ucode":"968DFC00D6D0CF","user_header":"https://static001.geekbang.org/account/avatar/00/10/15/03/c0fe1dbf.jpg","comment_is_top":false,"comment_ctime":1573020565,"is_pvip":false,"replies":[{"id":"57246","content":"ä½ æ¯”è¾ƒçš„æ˜¯getandincrementå’Œ++çš„æ€§èƒ½ğŸ˜‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1573047973,"ip_address":"","comment_id":148506,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1573020565","product_id":100023901,"comment_content":"è€å¸ˆï¼Œä¸ºä»€ä¹ˆæˆ‘ç”¨synchronizedå®ç°çš„add10kæ–¹æ³•æ‰§è¡Œè¦æ¯”ä½¿ç”¨AtomicIntegerçš„æ‰§è¡Œæ›´å¿«å‘¢ï¼Œä¸åº”è¯¥é‡‡ç”¨AtomicIntegeræ›´å¿«æ‰å¯¹å—ï¼Ÿ<br><br>synchronizedï¼š<br>public synchronized void add10k() {<br>            int idx = 0;<br>            while (idx &lt; 100000000) {<br>                count++;<br>                idx++;<br>      }<br>}<br><br>AtomicInteger:<br><br>AtomicInteger count = new AtomicInteger(0);<br>    public void add10k() {<br>        int idx = 0;<br>        while (idx &lt; 100000000) {<br>            count.getAndIncrement();<br>            idx++;<br>        }<br>    }","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473515,"discussion_content":"ä½ æ¯”è¾ƒçš„æ˜¯getandincrementå’Œ++çš„æ€§èƒ½ğŸ˜‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573047973,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1895314,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/STqKg1kLgvRuduQfo0R2E2osYBian7XrQAjSWmOwL9nyZVhq7vyLPnlGcgvguFV4aV7ToWLFiauEMKy96KWHKBVg/132","nickname":"ç¦»å¢ƒâ€","note":"","ucode":"7186EF2BEF8956","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377924,"discussion_content":"é¢‘ç¹æ›´æ–°ï¼ŒåŠ é”åº”è¯¥æ›´å¿«ä¸€ç‚¹å§ï¼Œæˆ‘çš„å®éªŒç»“æœä¹Ÿæ˜¯è¿™æ ·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622965016,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1053955,"avatar":"https://static001.geekbang.org/account/avatar/00/10/15/03/c0fe1dbf.jpg","nickname":"è€ƒä¼‘","note":"","ucode":"968DFC00D6D0CF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":45556,"discussion_content":"åº”è¯¥æ˜¯ä¸€ä¸‡ä¸ªçº¿ç¨‹æ¯ä¸ªåŠ ä¸€ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹åŠ ä¸€ä¸‡ï¼Œæˆ‘çœŸæ˜¯å‚»äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573048809,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":136537,"user_name":"DFighting","can_delete":false,"product_type":"c1","uid":1233193,"ip_address":"","ucode":"F3BA2426FF8582","user_header":"https://static001.geekbang.org/account/avatar/00/12/d1/29/1b1234ed.jpg","comment_is_top":false,"comment_ctime":1569466465,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1569466465","product_id":100023901,"comment_content":"ä¸¤ä¸ªé—®é¢˜ï¼š<br>1ã€compareAndSetæ¯æ¬¡å’Œnew å‡ºæ¥çš„objectæ¯”è¾ƒï¼Œæ°¸è¿œä¸ä¼šç›¸ç­‰ï¼Œä¼šå‡ºç°æ­»å¾ªç¯ï¼Œè¿™é‡Œæ¯”è¾ƒçš„åº”è¯¥æ˜¯oldValueå’ŒnewValue,å¹¶ä½¿ç”¨casæ–¹æ³•å¯¹ç¬¦åˆæ¡ä»¶çš„å€¼åšæ›´æ–°ã€‚<br>2ã€casçš„å®Œæ•´è¿‡ç¨‹åº”è¯¥æ˜¯å–å‡ºoldValue-&gt;æ¯”è¾ƒ-&gt;ç¬¦åˆæ¡ä»¶åˆ™ç”¨casæ“ä½œæ›´æ–°ï¼Œä¹Ÿå°±æ˜¯ä»£ç ä¸­çš„rf.getåº”è¯¥æ”¾åœ¨å¾ªç¯é‡Œã€‚ä¹Ÿå°±æ˜¯è¯´ä¸èƒ½å‰²è£‚å¯¹å…±äº«èµ„æºçš„CASæ“ä½œï¼Œä¸ç„¶å¹¶å‘æ—¶ä¼šæœ‰ABAé—®é¢˜","like_count":0},{"had_liked":false,"id":132277,"user_name":".","can_delete":false,"product_type":"c1","uid":1194614,"ip_address":"","ucode":"2FBBAB303A4D5A","user_header":"https://static001.geekbang.org/account/avatar/00/12/3a/76/e9f18792.jpg","comment_is_top":false,"comment_ctime":1568077808,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568077808","product_id":100023901,"comment_content":"æ­¤å¤„åŸæ„åº”è¯¥æ˜¯æƒ³è€ƒå¯Ÿorå˜é‡å†CASåå¦‚æœä¸åŒ¹é…ï¼Œéœ€è¦é‡æ–°å†æ¬¡è·å–æ–°çš„å€¼ï¼Œå³WMRange or = rf.get()è¿™æ¡è¯­å¥åº”è¯¥æ”¾åˆ°do{}while();çš„ç¬¬ä¸€å¥ã€‚ä½†é—®é¢˜çš„å…³é”®å…¶å®è¿™é‡Œç”±äºåé¢çš„nræ˜¯newå‡ºæ¥çš„ï¼Œæ‰€ä»¥rf.compareAndSet(or, nr)æŒ‰åœ°å€è¿›è¡Œæ¯”è¾ƒæ— è®ºå¦‚ä½•éƒ½æ˜¯ä¸ç­‰çš„ï¼Œæ­»å¾ªç¯ã€‚","like_count":0},{"had_liked":false,"id":116754,"user_name":"james","can_delete":false,"product_type":"c1","uid":1260477,"ip_address":"","ucode":"CB62CF7C4EF92D","user_header":"https://static001.geekbang.org/account/avatar/00/13/3b/bd/f9f780a4.jpg","comment_is_top":false,"comment_ctime":1563905582,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563905582","product_id":100023901,"comment_content":"æ— é”æ–¹æ¡ˆçš„åŸç†åçš„ç¬¬äºŒä¸ªSimulatedCASç±»ä¸­ï¼Œå°±ç®—åªæœ‰ä¸€ä¸ªçº¿ç¨‹ç´¯åŠ countï¼Œç¬¬ä¸€æ¬¡å¾ªç¯casçš„è¿”å›å€¼ä¸ç­‰äºcountï¼Œç„¶åå†è¿›è¡Œä¸€æ¬¡å¾ªç¯ï¼Œcountæ‰ä¸casçš„è¿”å›å€¼ç›¸ç­‰ï¼Œæˆ‘è¿™æ ·ç†è§£å¯¹å§ï¼Ÿ","like_count":0},{"had_liked":false,"id":114975,"user_name":"é½","can_delete":false,"product_type":"c1","uid":1486566,"ip_address":"","ucode":"378B273955095D","user_header":"https://static001.geekbang.org/account/avatar/00/16/ae/e6/58f30bb3.jpg","comment_is_top":false,"comment_ctime":1563440735,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1563440735","product_id":100023901,"comment_content":"WMRange or = rf.get();æ”¾åˆ°do whileå¾ªç¯å†…éƒ¨ï¼Œå› ä¸ºcaså¤±è´¥ä¹‹åéœ€è·å–æœ€æ–°çš„å¼•ç”¨å€¼å†é‡æ–°è¿›è¡Œcasï¼Œå³è‡ªæ—‹ã€‚","like_count":0},{"had_liked":false,"id":103876,"user_name":"ä½•å¦¨","can_delete":false,"product_type":"c1","uid":1385377,"ip_address":"","ucode":"EC3983BFF7992A","user_header":"https://static001.geekbang.org/account/avatar/00/15/23/a1/b08f3ee7.jpg","comment_is_top":false,"comment_ctime":1560558345,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560558345","product_id":100023901,"comment_content":"åœ¨count+=1çš„é‚£ä¸ªä¾‹å­ï¼Œä¸ä¼šå­˜åœ¨çº¿ç¨‹aåœ¨éªŒè¯ç­‰äºæœŸæœ›å€¼åèµ‹å€¼ä¹‹å‰ï¼Œçº¿ç¨‹båœ¨è¿™ä¹‹é—´ä¹ŸéªŒè¯æˆåŠŸï¼Œç„¶åä¸¤ä¸ªçº¿ç¨‹æœ¬èº«åº”è¯¥æ€»ä½“+2ç»“æœ+1çš„æƒ…å†µä¹ˆ","like_count":0},{"had_liked":false,"id":103451,"user_name":"é‡‘å­èˆ¬çš„å¿ƒ","can_delete":false,"product_type":"c1","uid":1006897,"ip_address":"","ucode":"8F6F217AF0C0EA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5d/31/2ccc4675.jpg","comment_is_top":false,"comment_ctime":1560438032,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1560438032","product_id":100023901,"comment_content":"æœŸæœ›å€¼æ˜¯æ€ä¹ˆæ¥çš„ï¼Ÿæ€ä¹ˆçŸ¥é“æœŸæœ›å€¼ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1121758,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","nickname":"aoe","note":"","ucode":"1C6201EDB4E954","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":48290,"discussion_content":"å˜é‡åˆå§‹å€¼ä¸º1ï¼Œæ¯æ¬¡åŠ 1ï¼Œç¬¬ä¸€æ¬¡è¿ç®—æ—¶çš„æœŸæœ›å€¼å°±æ˜¯1+1=2","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573471593,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96642,"user_name":"Hour","can_delete":false,"product_type":"c1","uid":1448748,"ip_address":"","ucode":"AA1045ACABC0BB","user_header":"https://static001.geekbang.org/account/avatar/00/16/1b/2c/6b3c0911.jpg","comment_is_top":false,"comment_ctime":1558483770,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558483770","product_id":100023901,"comment_content":"èµ!èµ!èµ!","like_count":0},{"had_liked":false,"id":96187,"user_name":"èš‚èšå†…æ¨+v","can_delete":false,"product_type":"c1","uid":1050508,"ip_address":"","ucode":"24B10AEE54B3FD","user_header":"https://static001.geekbang.org/account/avatar/00/10/07/8c/0d886dcc.jpg","comment_is_top":false,"comment_ctime":1558353296,"is_pvip":false,"replies":[{"id":"34427","content":"è¿™ç§æƒ…å†µå°±ä¸èƒ½ç”¨å®ƒäº†","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1558357755,"ip_address":"","comment_id":96187,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1558353296","product_id":100023901,"comment_content":"AtomicMarkableReference éº»çƒ¦é—®ä¸‹ï¼Œè¿™ä¸ªèƒ½è§£å†³ABAé—®é¢˜å—ï¼Ÿï¼Ÿ<br>ä¾‹å¦‚ï¼šåˆå§‹å€¼   1   falseï¼Œ <br>çº¿ç¨‹Aæ¥æ”¹æœŸæœ›1  falseã€‚  ç»“æœä¸­é€”è¢«çº¿ç¨‹BCæ¥ä¿®æ”¹äº†ã€‚<br>çº¿ç¨‹Bæ”¹åç»“æœ 2 true<br>çº¿ç¨‹Cæ”¹åç»“æœ 1 flaseã€‚<br>æ­¤æ—¶ï¼Œçº¿ç¨‹Aè¿˜ä¿®æ”¹æˆåŠŸã€‚<br>","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450758,"discussion_content":"è¿™ç§æƒ…å†µå°±ä¸èƒ½ç”¨å®ƒäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558357755,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":92271,"user_name":"XYW","can_delete":false,"product_type":"c1","uid":1445285,"ip_address":"","ucode":"D8D455F1A28D94","user_header":"https://static001.geekbang.org/account/avatar/00/16/0d/a5/9aad5cc5.jpg","comment_is_top":false,"comment_ctime":1557218270,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557218270","product_id":100023901,"comment_content":"or=rf.get()åº”è¯¥æ”¾åˆ°do{}while()å†…ï¼Œå¦å¤–æœ‰ä¸ªé—®é¢˜æƒ³è¯·æ•™è€å¸ˆï¼Œå‡è®¾T1å’ŒT2ä¸¤çº¿ç¨‹åŒæ—¶æ‰§è¡ŒsetUpper(),T1è¿›å…¥å¾ªç¯åè¢«é˜»å¡ï¼ŒT2è¿›å…¥å¹¶æ›´æ–°æˆåŠŸï¼Œç„¶åT1ç»§ç»­æ‰§è¡Œéœ€è¦ä¸¤æ¬¡å¾ªç¯æ‰èƒ½æ›´æ–°æˆåŠŸï¼Œé‚£ä¹ˆå½“å‰çŠ¶æ€å˜æˆT1è®¾ç½®çš„å€¼äº†ï¼Œç„¶è€ŒT2æ‰æ˜¯åæ›´æ–°çš„å´æ²¡æœ‰å˜æˆT2è®¾ç½®çš„å€¼ï¼Œè¿™æ ·åˆç†å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":88069,"user_name":"æ¯å¤©æ™’ç™½ç‰™","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1555835471,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1555835471","product_id":100023901,"comment_content":"è·å–æœ€æ–°å€¼æ“ä½œåº”è¯¥æ”¾åˆ°do-whileå¾ªç¯ä¸­ï¼Œä»¥ä¿è¯æ¯æ¬¡å¾ªç¯è·å–æœ€æ–°å€¼<br>or=rf.get()æ”¾åˆ°å¾ªç¯ä¸­","like_count":0},{"had_liked":false,"id":87497,"user_name":"æ¨æ˜¥é¹","can_delete":false,"product_type":"c1","uid":1172056,"ip_address":"","ucode":"518F38232F97B5","user_header":"https://static001.geekbang.org/account/avatar/00/11/e2/58/8c8897c8.jpg","comment_is_top":false,"comment_ctime":1555628443,"is_pvip":false,"replies":[{"id":"31512","content":"è¿™é‡Œåªæ˜¯æ¨¡æ‹Ÿcpuçš„casæŒ‡ä»¤,ç”¨äºè®²æ˜ç™½casæ˜¯æ€ä¹ˆå·¥ä½œçš„","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1555647236,"ip_address":"","comment_id":87497,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555628443","product_id":100023901,"comment_content":"ä½ å¥½ã€‚å¯¹äºaddonne()è™½ç„¶æ²¡æœ‰äº’æ–¥é”ï¼Œä½†æ˜¯è°ƒç”¨çš„cas()æ–¹æ³•ä¸Šè¿˜æ˜¯åŠ ä¸Šäº†synchronizedï¼Œé‚£ä¹ˆä¸æ˜¯è¿˜æ˜¯ç›¸å½“äºçº¿ç¨‹ä¹‹é—´æœ‰ç«äº‰å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447486,"discussion_content":"è¿™é‡Œåªæ˜¯æ¨¡æ‹Ÿcpuçš„casæŒ‡ä»¤,ç”¨äºè®²æ˜ç™½casæ˜¯æ€ä¹ˆå·¥ä½œçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555647236,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86998,"user_name":"æ™“æ°","can_delete":false,"product_type":"c1","uid":1441546,"ip_address":"","ucode":"1174C88EEBF8A6","user_header":"https://static001.geekbang.org/account/avatar/00/15/ff/0a/12faa44e.jpg","comment_is_top":false,"comment_ctime":1555494667,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555494667","product_id":100023901,"comment_content":"è¯·é—®è€å¸ˆatomicRefrenceçš„compareAndSetæ¯”è¾ƒçš„æ—¶å€™æ˜¯æ€ä¹ˆæ¯”è¾ƒçš„","like_count":0},{"had_liked":false,"id":86955,"user_name":"è¥¿è¡Œå¯ºå’•å“’å­","can_delete":false,"product_type":"c1","uid":1441988,"ip_address":"","ucode":"CAE570245BA299","user_header":"https://static001.geekbang.org/account/avatar/00/16/00/c4/634c1e10.jpg","comment_is_top":false,"comment_ctime":1555486914,"is_pvip":false,"replies":[{"id":"31281","content":"ğŸ‘<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1555499521,"ip_address":"","comment_id":86955,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555486914","product_id":100023901,"comment_content":"è¯•äº†ä¸€ä¸‹ ç¡®å®æ˜¯æ­»å¾ªç¯ çŒœæµ‹ï¼šçº¿ç¨‹1 ä¸­ or æ˜¯åœ¨ do å¾ªç¯ä½“å¤–é¢è·å– å¦‚æœçº¿ç¨‹2æ”¹å˜äº† AtomicReference ä¸­çš„å¯¹è±¡ é‚£ä¹ˆçº¿ç¨‹1 ä¸­è°ƒç”¨çš„compareAndSetï¼ˆorï¼Œurï¼‰ or å§‹ç»ˆä¸æ˜¯çº¿ç¨‹2æ›´æ–°åçš„ å¯¼è‡´ä¸€ç›´è¿”å›false ä»è€Œæ­»å¾ªç¯ã€‚å°†rf.get()æ”¾åˆ°doå¾ªç¯ä½“å†…å°±å¥½äº†<br> ","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447262,"discussion_content":"ğŸ‘\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555499521,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86884,"user_name":"Kenny","can_delete":false,"product_type":"c1","uid":1102688,"ip_address":"","ucode":"F17D11D1331F84","user_header":"https://static001.geekbang.org/account/avatar/00/10/d3/60/d0473a16.jpg","comment_is_top":false,"comment_ctime":1555470090,"is_pvip":false,"replies":[{"id":"31280","content":"æˆ‘è§‰å¾—æ˜¯å¯¹çš„ï¼Œä¸è¿‡å¤æ‚åœºæ™¯å¯èƒ½æ²¡æœ‰è¿™ä¹ˆç®€å•<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1555499500,"ip_address":"","comment_id":86884,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555470090","product_id":100023901,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæ‚¨ä¸Šé¢æåˆ°æ— é”æ–¹æ¡ˆä¸ä¼šäº§ç”Ÿæ­»é”é—®é¢˜ï¼Œä½†æ˜¯å¯èƒ½ä¼šäº§ç”Ÿé¥¥é¥¿å’Œæ´»é”ã€‚å¯¹äºCASæ¥è¯´ï¼Œäº§ç”Ÿé¥¥é¥¿æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œé‚£æ˜¯å¦CASä¸ä¼šäº§ç”Ÿæ´»é”ï¼Ÿæˆ‘æ˜¯è¿™æ ·ç†è§£çš„ï¼šå› ä¸ºå¦‚æœnä¸ªçº¿ç¨‹å¯¹ä¸€ä¸ªå˜é‡æ‰§è¡ŒCASï¼Œäº§ç”Ÿè‡ªæ—‹çš„æ¡ä»¶æ˜¯å˜é‡è¢«å…¶ä»–çº¿ç¨‹æ”¹äº†ï¼Œè€Œå˜é‡è¢«å…¶ä»–çº¿ç¨‹æ”¹äº†ä¹‹åï¼Œç­‰å¾…ä¿®æ”¹çš„çº¿ç¨‹å°±å˜ä¸ºN-1ï¼Œè¿™æ ·å¾ªç¯ä¸‹å»ï¼Œæœ€ç»ˆæ‰€æœ‰çš„çº¿ç¨‹éƒ½èƒ½å®Œæˆä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šäº§ç”Ÿæ´»é”ï¼Ÿæ‚¨çœ‹æˆ‘ç†è§£å¾—å¯¹å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447229,"discussion_content":"æˆ‘è§‰å¾—æ˜¯å¯¹çš„ï¼Œä¸è¿‡å¤æ‚åœºæ™¯å¯èƒ½æ²¡æœ‰è¿™ä¹ˆç®€å•\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555499500,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86506,"user_name":"magict4","can_delete":false,"product_type":"c1","uid":1043789,"ip_address":"","ucode":"CB6F063D881AAC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ed/4d/1d1a1a00.jpg","comment_is_top":false,"comment_ctime":1555385675,"is_pvip":false,"replies":[{"id":"31149","content":"æ­£ç¡®ğŸ‘<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1555412305,"ip_address":"","comment_id":86506,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555385675","product_id":100023901,"comment_content":"å¯èƒ½ä¼šé™·å…¥æ­»å¾ªç¯ã€‚<br><br>çº¿ç¨‹1æ‰§è¡Œå®Œ23è¡Œä¹‹åï¼Œè¢«æš‚åœã€‚<br>çº¿ç¨‹2æ‰§è¡Œï¼Œå¹¶æˆåŠŸæ›´æ–°rfçš„å†…å®¹ã€‚<br>çº¿ç¨‹1ç»§ç»­æ‰§è¡Œï¼Œ24è¡Œwhileè¯­å¥è¿”å›ä¸ºfalse(å› ä¸ºrfå†…å®¹å·²ç»è¢«çº¿ç¨‹2æ›´æ–°)ã€‚<br>çº¿ç¨‹1é‡æ–°è¿›å…¥doå¾ªç¯ã€‚æ³¨æ„æ­¤æ—¶orå¹¶æ²¡æœ‰è¢«é‡æ–°è¯»å–ã€‚whileè¯­å¥ç»§ç»­è¿”å›falseï¼Œå¦‚æ­¤å¾€å¤ã€‚<br><br>æ„Ÿè§‰æŠŠ WMRange or = rf.get(); è¿™ä¸€è¡Œæ”¾åˆ° do å†…éƒ¨ï¼Œå°±å¯ä»¥äº†ï¼Œä¸çŸ¥é“æ˜¯å¦æ­£ç¡®ï¼Ÿ<br>","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447042,"discussion_content":"æ­£ç¡®ğŸ‘\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555412305,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86480,"user_name":"å¤šè¥„ä¸¸","can_delete":false,"product_type":"c1","uid":1074310,"ip_address":"","ucode":"1AA1497C5A293C","user_header":"https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg","comment_is_top":false,"comment_ctime":1555380863,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555380863","product_id":100023901,"comment_content":"public class SafeWM {<br>  class WMRange{<br>    final int upper;<br>    final int lower;<br>    WMRange(int upper,int lower){<br>    &#47;&#47; çœç•¥æ„é€ å‡½æ•°å®ç°<br>    }<br>  }<br>  final AtomicReference&lt;WMRange&gt;<br>    rf = new AtomicReference&lt;&gt;(<br>      new WMRange(0,0)<br>    );<br>  &#47;&#47; è®¾ç½®åº“å­˜ä¸Šé™<br>  void setUpper(int v){<br>    WMRange nr;<br>    WMRange or = rf.get();<br>    do{<br>      &#47;&#47; æ£€æŸ¥å‚æ•°åˆæ³•æ€§<br>      if(v &lt; or.lower){<br>        throw new IllegalArgumentException();<br>      }<br>      nr = new<br>        WMRange(v, or.lower);<br>    }while(!rf.compareAndSet(or, nr));<br>  }<br>}<br><br>ä¸æ˜¯å¾ˆæ¸…æ¥šAtomicReference.CASæ¯”è¾ƒçš„æ˜¯å¯¹è±¡å†…å­˜ä¸­çš„åœ°å€ï¼Œè¿˜æ˜¯åŒ…æ‹¬äº†å±æ€§å†…å­˜ä¸­çš„åœ°å€ã€‚ æˆ‘çŒœæƒ³æ€è€ƒé¢˜è¿™é‡Œå†™çš„æ˜¯å¯¹çš„å§?<br><br>å¯æ˜¯å¦‚æœæˆ‘è¯´å®ƒæ˜¯é”™çš„ï¼Œæˆ‘åˆä¸çŸ¥é“å®ƒé”™åœ¨å“ªé‡Œã€‚","like_count":0},{"had_liked":false,"id":86433,"user_name":"å‘¨æ²»æ…§","can_delete":false,"product_type":"c1","uid":1335293,"ip_address":"","ucode":"7D56C4E66BEE17","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKR3ibELhjgVicCNShZCBwvaDxibnzibggG4wUzVkS2mkDxUBZyIs87nDEdJ7PiahJBVoZcuhQ84RxAziag/132","comment_is_top":false,"comment_ctime":1555377575,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555377575","product_id":100023901,"comment_content":"ä¸¤ä¸ªå¯¹è±¡æ¯”è¾ƒçš„æ—¶å€™æ˜¯æ¯”è¾ƒçš„åœ°å€å€¼ï¼Œoldå’Œnewåœ°å€å€¼ä¸€ç›´æ˜¯ä¸ç­‰çš„ï¼Œè®¾ç½®ä¸Šé™åº”è¯¥æ˜¯å»æ›´æ–°å¯¹è±¡çš„å­—æ®µçš„å€¼ä¿è¯å­—æ®µå€¼çš„cas","like_count":0},{"had_liked":false,"id":86430,"user_name":"zhangtnty","can_delete":false,"product_type":"c1","uid":1180553,"ip_address":"","ucode":"3C9A14BD7CF432","user_header":"https://static001.geekbang.org/account/avatar/00/12/03/89/e1621a01.jpg","comment_is_top":false,"comment_ctime":1555377489,"is_pvip":false,"replies":[{"id":"31315","content":"æˆ‘ä¹Ÿè§‰å¾—æ²¡æœ‰abaé—®é¢˜ï¼Œç®€å•çš„åŸå­æ€§é—®é¢˜éƒ½å¯ä»¥ç”¨å®ƒï¼Œä½†æ˜¯ä¸å»ºè®®è‡ªå·±æ„å»ºå¤æ‚çš„æ— é”ç®—æ³•å»è§£å†³å¹¶å‘é—®é¢˜ã€‚<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1555511557,"ip_address":"","comment_id":86430,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555377489","product_id":100023901,"comment_content":"ç‹è€å¸ˆå¥½, æ–‡ä¸­é¢˜ç›®æˆ‘è®¤ä¸ºä¸å­˜åœ¨ ABA çš„é—®é¢˜ã€‚é—®é¢˜æ˜¯O r çš„å€¼åº”è¯¥æ”¾åœ¨ do å¾ªç¯ä½“å†…,å¦‚æœä¸¤ä¸ªçº¿ç¨‹ A , B ã€‚åŒæ—¶æ‰§è¡Œæ–¹æ³•, A æ‰§è¡Œå®Œ B å´å§‹ç»ˆæ‹¿ä¸åˆ° A çš„æ–°å€¼, è‡´ B è¿›å…¥ æ­»å¾ªç¯ã€‚<br>å¦å¤–, ç‹è€å¸ˆèƒ½å¦é’ˆå¯¹æ— é”åŸå­ç±»çš„å®é™…åº”ç”¨åœºæ™¯åˆ—ä¸¾ä¸€äº›ï¼Œè°¢è°¢ï¼<br>","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447016,"discussion_content":"æˆ‘ä¹Ÿè§‰å¾—æ²¡æœ‰abaé—®é¢˜ï¼Œç®€å•çš„åŸå­æ€§é—®é¢˜éƒ½å¯ä»¥ç”¨å®ƒï¼Œä½†æ˜¯ä¸å»ºè®®è‡ªå·±æ„å»ºå¤æ‚çš„æ— é”ç®—æ³•å»è§£å†³å¹¶å‘é—®é¢˜ã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555511557,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86416,"user_name":"å¼ ä¸‰","can_delete":false,"product_type":"c1","uid":1004092,"ip_address":"","ucode":"1155528FAE1546","user_header":"https://static001.geekbang.org/account/avatar/00/0f/52/3c/d6fcb93a.jpg","comment_is_top":false,"comment_ctime":1555376670,"is_pvip":false,"replies":[{"id":"31155","content":"çœ‹ä¸€ä¸‹v+delta<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1555414872,"ip_address":"","comment_id":86416,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555376670","product_id":100023901,"comment_content":"Javaå¦‚ä½•å®ç°åŸå­åŒ–çš„count+=1ä¸­ï¼ŒgetLongVolatileï¼ˆï¼‰ä»…ä»…æ˜¯è·å–å½“å‰å€¼ï¼Œreturnå›å»çš„vå¹¶æ²¡æœ‰å¯¹å½“å‰å€¼+1å•Šï¼Ÿ<br>","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447009,"discussion_content":"çœ‹ä¸€ä¸‹v+delta\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555414872,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86413,"user_name":"è‹å¿—è¾‰","can_delete":false,"product_type":"c1","uid":1068927,"ip_address":"","ucode":"39B25CE21C04EE","user_header":"https://static001.geekbang.org/account/avatar/00/10/4f/7f/5dc11380.jpg","comment_is_top":false,"comment_ctime":1555376321,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555376321","product_id":100023901,"comment_content":"ä¸å®‰å…¨ï¼Œå› ä¸ºcasåªèƒ½ä¿è¯å¼•ç”¨ä¸€æ ·ï¼Œæ²¡æ³•ä¿è¯å±æ€§æ²¡å˜","like_count":0},{"had_liked":false,"id":86401,"user_name":"Felix Envy","can_delete":false,"product_type":"c1","uid":1200085,"ip_address":"","ucode":"24E0F2165AD108","user_header":"https://static001.geekbang.org/account/avatar/00/12/4f/d5/e23dc965.jpg","comment_is_top":false,"comment_ctime":1555375591,"is_pvip":false,"replies":[{"id":"31316","content":"ğŸ‘<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1555511570,"ip_address":"","comment_id":86401,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555375591","product_id":100023901,"comment_content":"WMRange or = rf.get(); è¿™æ®µåº”è¯¥æ”¾åˆ°å¾ªç¯ä½“é‡Œé¢å»ï¼Œä¸ç„¶ä¸€æ—¦å‘ç”Ÿå¹¶å‘å°±ä¼šæœ‰çº¿ç¨‹è¿›å…¥æ­»å¾ªç¯ã€‚","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447001,"discussion_content":"ğŸ‘\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555511570,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86396,"user_name":"å¯†ç 123456","can_delete":false,"product_type":"c1","uid":1126593,"ip_address":"","ucode":"9889463CC0EA71","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/c1/2dde6700.jpg","comment_is_top":false,"comment_ctime":1555375218,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555375218","product_id":100023901,"comment_content":"é¥¥é¥¿çš„æƒ…å†µï¼Œæˆ‘èƒ½å¤Ÿæƒ³è±¡å‡ºæ¥ï¼Œå¯æ˜¯å‡ºç°æ´»é”çš„æƒ…å†µï¼Œæˆ‘æƒ³è±¡ä¸å‡ºæ¥ï¼ŸçŸ¥é“çš„åŒå­¦éº»çƒ¦å‘ŠçŸ¥ä¸‹ã€‚","like_count":0},{"had_liked":false,"id":86394,"user_name":"å¼ å¾·","can_delete":false,"product_type":"c1","uid":1101929,"ip_address":"","ucode":"31FE63E8725EFC","user_header":"https://static001.geekbang.org/account/avatar/00/10/d0/69/5dbdc245.jpg","comment_is_top":false,"comment_ctime":1555375046,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555375046","product_id":100023901,"comment_content":"å…ˆæ‰“å¡  ä¸€èˆ¬è€å¸ˆè®²çš„è¯¾ æˆ‘éƒ½æ˜¯çœ‹3é","like_count":0},{"had_liked":false,"id":86362,"user_name":"KidğŸ˜‹","can_delete":false,"product_type":"c1","uid":1317216,"ip_address":"","ucode":"7150F69AAAB477","user_header":"https://static001.geekbang.org/account/avatar/00/14/19/60/888f1371.jpg","comment_is_top":false,"comment_ctime":1555373434,"is_pvip":false,"replies":[{"id":"31047","content":"æœ‰å¯èƒ½æœ‰ï¼Œè¿™ä¸ªå¾—çœ‹åœºæ™¯<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1555387558,"ip_address":"","comment_id":86362,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1555373434","product_id":100023901,"comment_content":"æ‰“å¡ï¼å¯¹CASç†è§£è¿˜æ˜¯ä¸å¤Ÿï¼Œè¦åå¤å¤šè¯»å‡ æ¬¡æ–‡ç« äº†ã€‚å¦å¤–æœ‰ä¸ªå°ç–‘é—®ï¼ŒCASä¸­çš„è‡ªæ—‹å¾ªç¯æ˜¯å¦ä¼šæœ‰æ€§èƒ½é—®é¢˜ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446988,"discussion_content":"æœ‰å¯èƒ½æœ‰ï¼Œè¿™ä¸ªå¾—çœ‹åœºæ™¯\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555387558,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1121758,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","nickname":"aoe","note":"","ucode":"1C6201EDB4E954","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":48294,"discussion_content":"è™šæ‹Ÿæœºæœ‰å…³é—­è‡ªæ—‹é”çš„å‚æ•°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573471839,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86347,"user_name":"kyle","can_delete":false,"product_type":"c1","uid":1179158,"ip_address":"","ucode":"DB05C0F7D2C472","user_header":"https://static001.geekbang.org/account/avatar/00/11/fe/16/0f096793.jpg","comment_is_top":false,"comment_ctime":1555371278,"is_pvip":false,"replies":[{"id":"31048","content":"åªæ˜¯ä¸ºäº†è®©ä½ ç†è§£åŸç†ï¼Œcasä¸æ˜¯ç”¨syncå®ç°çš„<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1555387604,"ip_address":"","comment_id":86347,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555371278","product_id":100023901,"comment_content":"synchronized å…³é”®å­—ä¸æ˜¯éšå«åŠ é”æ“ä½œå—ï¼Ÿ<br>ä¸ºä»€ä¹ˆè¯´casæ˜¯æ— é”çš„å‘¢ï¼","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446982,"discussion_content":"åªæ˜¯ä¸ºäº†è®©ä½ ç†è§£åŸç†ï¼Œcasä¸æ˜¯ç”¨syncå®ç°çš„\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555387604,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86344,"user_name":"å¼ ä¸‰","can_delete":false,"product_type":"c1","uid":1004092,"ip_address":"","ucode":"1155528FAE1546","user_header":"https://static001.geekbang.org/account/avatar/00/0f/52/3c/d6fcb93a.jpg","comment_is_top":false,"comment_ctime":1555370031,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1555370031","product_id":100023901,"comment_content":"çœ‹äº†ä¸€éï¼Œå…ˆæ‰“å¡ï¼Œå¯¹CAS+è‡ªæ—‹è¿˜ä¸å¤ªæ˜ç™½ã€‚çœ‹åˆ°ä¸Šä¸€ç¯‡æ–‡ç« ç•™è¨€äººæ•°å°‘äº†å¾ˆå¤šã€‚","like_count":0,"discussions":[{"author":{"id":1121758,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","nickname":"aoe","note":"","ucode":"1C6201EDB4E954","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":48299,"discussion_content":"éœ€è¦é˜…è¯»Javaè™šæ‹Ÿæœºé‚£æœ¬ä¹¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573471898,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86321,"user_name":"å”è£è½©","can_delete":false,"product_type":"c1","uid":1268732,"ip_address":"","ucode":"D225DC43E94D23","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ8a5dg6aBRohA4bQ5KcHdDt6nCnrk0PiarfnVZ3zsgrBbjayAG1bhuAEfyZaNpplnXYDytZlWpfkA/132","comment_is_top":false,"comment_ctime":1555349398,"is_pvip":false,"replies":[{"id":"31154","content":"ğŸ‘<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1555414735,"ip_address":"","comment_id":86321,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555349398","product_id":100023901,"comment_content":"æŸäº›æŒ‡æ ‡ç»Ÿè®¡ç¨‹åºã€traceæ¨¡å‹ä¸¤IDæ¨¡å‹ä¸­çš„SpanIDï¼ˆ0.1.2ï¼Œ0.1.5ï¼‰ç”Ÿæˆå™¨å¯ä»¥åŸºäºåŸå­ç±»è¿›è¡Œå®ç°","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446968,"discussion_content":"ğŸ‘\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555414735,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}