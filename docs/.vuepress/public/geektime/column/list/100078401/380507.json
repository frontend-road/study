{"id":380507,"title":"11 | 设置工作模式与环境（中）：建造二级引导器","content":"<p>你好，我是LMOS。</p><p>上节课，我们建造了属于我们的“计算机”，并且在上面安装好了GRUB。这节课我会带你一起实现二级引导器这个关键组件。</p><p>看到这儿你可能会问，GRUB不是已经把我们的操作系统加载到内存中了吗？我们有了GRUB，我们为什么还要实现二级引导器呢？</p><p>这里我要给你说说我的观点，二级引导器作为操作系统的先驱，它需要<strong>收集机器信息</strong>，确定这个计算机能不能运行我们的操作系统，对CPU、内存、显卡进行一些初级的配置，放置好内核相关的文件。</p><p>因为我们二级引导器不是执行具体的加载任务的，而是解析内核文件、收集机器环境信息，它具体收集哪些信息，我会在下节课详细展开。</p><h2>设计机器信息结构</h2><p>二级引导器收集的信息，需要地点存放，我们需要设计一个数据结构。信息放在这个数据结构中，这个结构放在内存1MB的地方，方便以后传给我们的操作系统。</p><p>为了让你抓住重点，我选取了这个数据结构的<strong>关键代码</strong>，这里并没有列出该结构的所有字段（Cosmos/initldr/include/ldrtype.h），这个结构如下所示。</p><pre><code>typedef struct s_MACHBSTART\n{\n    u64_t   mb_krlinitstack;//内核栈地址\n    u64_t   mb_krlitstacksz;//内核栈大小\n    u64_t   mb_imgpadr;//操作系统映像\n    u64_t   mb_imgsz;//操作系统映像大小\n    u64_t   mb_bfontpadr;//操作系统字体地址\n    u64_t   mb_bfontsz;//操作系统字体大小\n    u64_t   mb_fvrmphyadr;//机器显存地址\n    u64_t   mb_fvrmsz;//机器显存大小\n    u64_t   mb_cpumode;//机器CPU工作模式\n    u64_t   mb_memsz;//机器内存大小\n    u64_t   mb_e820padr;//机器e820数组地址\n    u64_t   mb_e820nr;//机器e820数组元素个数\n    u64_t   mb_e820sz;//机器e820数组大小\n    //……\n    u64_t   mb_pml4padr;//机器页表数据地址\n    u64_t   mb_subpageslen;//机器页表个数\n    u64_t   mb_kpmapphymemsz;//操作系统映射空间大小\n    //……\n    graph_t mb_ghparm;//图形信息\n}__attribute__((packed)) machbstart_t;\n</code></pre><h2>规划二级引导器</h2><p>在开始写代码之前，我们先来从整体划分一下二级引导器的功能模块，从全局了解下功能应该怎么划分，这里我特意为你梳理了一个表格。</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/31/1e/3169e9db4549ab036c2de269788a281e.jpg?wh=1636*846\" alt=\"\" title=\"二级引导器功能划分表\"></p><p>前面表格里的这些文件，我都放在了课程配套源码中了，你可以从<a href=\"https://gitee.com/lmos/cosmos/tree/master/lesson10~11\">这里</a>下载。</p><p>上述这些文件都在lesson10～11/Cosmos/initldr/ldrkrl目录中，它们在编译之后会形成三个文件，编译脚本我已经写好了，下面我们用一幅图来展示这个编译过程。</p><p><img src=\"https://static001.geekbang.org/resource/image/bd/40/bd55f67d02edff4415f06c914403bc40.jpg?wh=5005*3110\" alt=\"\" title=\"二级引导器编译过程示意图\"></p><p>这最后三个文件用我们前面说的映像工具打包成映像文件，其指令如下。</p><pre><code>lmoskrlimg -m k -lhf initldrimh.bin -o Cosmos.eki -f initldrkrl.bin initldrsve.bin\n</code></pre><h2>实现GRUB头</h2><p>我们的GRUB头有两个文件组成，<strong>一个imginithead.asm汇编文件</strong>，它有两个功能，既能让GRUB识别，又能设置C语言运行环境，用于调用C函数；<strong>第二就是inithead.c文件</strong>，它的主要功能是查找二级引导器的核心文件——initldrkrl.bin，然后把它放置到特定的内存地址上。</p><p>我们先来实现imginithead.asm，它主要工作是初始化CPU的寄存器，加载GDT，切换到CPU的保护模式，我们一步一步来实现。</p><p>首先是GRUB1和GRUB2需要的两个头结构，代码如下。</p><pre><code>MBT_HDR_FLAGS\tEQU 0x00010003\nMBT_HDR_MAGIC\tEQU 0x1BADB002\nMBT2_MAGIC\tEQU 0xe85250d6\nglobal _start\nextern inithead_entry\n[section .text]\n[bits 32]\n_start:\n\tjmp _entry\nalign 4\nmbt_hdr:\n\tdd MBT_HDR_MAGIC\n\tdd MBT_HDR_FLAGS\n\tdd -(MBT_HDR_MAGIC+MBT_HDR_FLAGS)\n\tdd mbt_hdr\n\tdd _start\n\tdd 0\n\tdd 0\n\tdd _entry\nALIGN 8\nmbhdr:\n\tDD\t0xE85250D6\n\tDD\t0\n\tDD\tmhdrend - mbhdr\n\tDD\t-(0xE85250D6 + 0 + (mhdrend - mbhdr))\n\tDW\t2, 0\n\tDD\t24\n\tDD\tmbhdr\n\tDD\t_start\n\tDD\t0\n\tDD\t0\n\tDW\t3, 0\n\tDD\t12\n\tDD\t_entry \n\tDD  0  \n\tDW\t0, 0\n\tDD\t8\nmhdrend:\n</code></pre><p>然后是关中断并加载GDT，代码如下所示。</p><pre><code>_entry:\n\tcli           ；关中断\n\tin al, 0x70 \n\tor al, 0x80\t\n\tout 0x70,al  ；关掉不可屏蔽中断   \n\tlgdt [GDT_PTR] ；加载GDT地址到GDTR寄存器\n\tjmp dword 0x8 :_32bits_mode ；长跳转刷新CS影子寄存器\n  ;………………\n;GDT全局段描述符表\nGDT_START:\nknull_dsc: dq 0\nkcode_dsc: dq 0x00cf9e000000ffff\nkdata_dsc: dq 0x00cf92000000ffff\nk16cd_dsc: dq 0x00009e000000ffff ；16位代码段描述符\nk16da_dsc: dq 0x000092000000ffff ；16位数据段描述符\nGDT_END:\nGDT_PTR:\nGDTLEN\tdw GDT_END-GDT_START-1\t;GDT界限\nGDTBASE\tdd GDT_START\n</code></pre><p>最后是初始化段寄存器和通用寄存器、栈寄存器，这是为了给调用inithead_entry这个C函数做准备，代码如下所示。</p><pre><code>_32bits_mode：\n\tmov ax, 0x10\n\tmov ds, ax\n\tmov ss, ax\n\tmov es, ax\n\tmov fs, ax\n\tmov gs, ax\n\txor eax,eax\n\txor ebx,ebx\n\txor ecx,ecx\n\txor edx,edx\n\txor edi,edi\n\txor esi,esi\n\txor ebp,ebp\n\txor esp,esp\n\tmov esp,0x7c00 ；设置栈顶为0x7c00\n\tcall inithead_entry ；调用inithead_entry函数在inithead.c中实现\n\tjmp 0x200000  ；跳转到0x200000地址\n</code></pre><p>上述代码的最后调用了inithead_entry函数，这个函数我们需要另外在inithead.c中实现，我们这就来实现它，如下所示。</p><pre><code>#define MDC_ENDGIC 0xaaffaaffaaffaaff\n#define MDC_RVGIC 0xffaaffaaffaaffaa\n#define REALDRV_PHYADR 0x1000\n#define IMGFILE_PHYADR 0x4000000\n#define IMGKRNL_PHYADR 0x2000000\n#define LDRFILEADR IMGFILE_PHYADR\n#define MLOSDSC_OFF (0x1000)\n#define MRDDSC_ADR (mlosrddsc_t*)(LDRFILEADR+0x1000)\n\nvoid inithead_entry()\n{\n    write_realintsvefile();\n    write_ldrkrlfile();\n    return;\n}\n//写initldrsve.bin文件到特定的内存中\nvoid write_realintsvefile()\n{\n    fhdsc_t *fhdscstart = find_file(&quot;initldrsve.bin&quot;);\n    if (fhdscstart == NULL)\n    {\n        error(&quot;not file initldrsve.bin&quot;);\n    }\n    m2mcopy((void *)((u32_t)(fhdscstart-&gt;fhd_intsfsoff) + LDRFILEADR),\n            (void *)REALDRV_PHYADR, (sint_t)fhdscstart-&gt;fhd_frealsz);\n    return;\n}\n//写initldrkrl.bin文件到特定的内存中\nvoid write_ldrkrlfile()\n{\n    fhdsc_t *fhdscstart = find_file(&quot;initldrkrl.bin&quot;);\n    if (fhdscstart == NULL)\n    {\n        error(&quot;not file initldrkrl.bin&quot;);\n    }\n    m2mcopy((void *)((u32_t)(fhdscstart-&gt;fhd_intsfsoff) + LDRFILEADR),\n            (void *)ILDRKRL_PHYADR, (sint_t)fhdscstart-&gt;fhd_frealsz);\n    return;\n}\n//在映像文件中查找对应的文件\nfhdsc_t *find_file(char_t *fname)\n{\n    mlosrddsc_t *mrddadrs = MRDDSC_ADR;\n    if (mrddadrs-&gt;mdc_endgic != MDC_ENDGIC ||\n        mrddadrs-&gt;mdc_rv != MDC_RVGIC ||\n        mrddadrs-&gt;mdc_fhdnr &lt; 2 ||\n        mrddadrs-&gt;mdc_filnr &lt; 2)\n    {\n        error(&quot;no mrddsc&quot;);\n    }\n    s64_t rethn = -1;\n    fhdsc_t *fhdscstart = (fhdsc_t *)((u32_t)(mrddadrs-&gt;mdc_fhdbk_s) + LDRFILEADR);\n    for (u64_t i = 0; i &lt; mrddadrs-&gt;mdc_fhdnr; i++)\n    {\n        if (strcmpl(fname, fhdscstart[i].fhd_name) == 0)\n        {\n            rethn = (s64_t)i;\n            goto ok_l;\n        }\n    }\n    rethn = -1;\nok_l:\n    if (rethn &lt; 0)\n    {\n        error(&quot;not find file&quot;);\n    }\n    return &amp;fhdscstart[rethn];\n}\n</code></pre><p>我们实现了inithead_entry函数，它主要干了两件事，即分别调用write_realintsvefile();、write_ldrkrlfile()函数，把映像文件中的initldrsve.bin文件和initldrkrl.bin文件写入到特定的内存地址空间中，具体地址在上面代码中的宏有详细定义。</p><p>这两个函数分别依赖于find_file和m2mcopy函数。</p><p>正如其名，find_file函数负责扫描映像文件中的文件头描述符，对比其中的文件名，然后返回对应的文件头描述符的地址，这样就可以得到文件在映像文件中的位置和大小了。</p><p>find_file函数的接力队友就是m2mcopy函数，因为查找对比之后，最后就是m2mcopy函数负责把映像文件复制到具体的内存空间里。</p><p>代码中的其它函数我就不展开了，感兴趣的同学请自行研究，或者自己改写。</p><h2>进入二级引导器</h2><p>你应该还有印象，刚才说的实现GRUB头这个部分，在imghead.asm汇编文件代码中，我们的最后一条指令是“<strong>jmp 0x200000</strong>”，即跳转到物理内存的0x200000地址处。</p><p>请你注意，这时地址还是物理地址，这个地址正是在inithead.c中由write_ldrkrlfile()函数放置的initldrkrl.bin文件，这一跳就进入了二级引导器的主模块了。</p><p>由于模块的改变，我们还需要写一小段汇编代码，建立下面这个initldr32.asm（配套代码库中对应ldrkrl32.asm）文件，并写上如下代码。</p><pre><code>_entry:\n\tcli\n\tlgdt [GDT_PTR]；加载GDT地址到GDTR寄存器\n\tlidt [IDT_PTR]；加载IDT地址到IDTR寄存器\n\tjmp dword 0x8 :_32bits_mode；长跳转刷新CS影子寄存器\n_32bits_mode:\n\tmov ax, 0x10\t; 数据段选择子(目的)\n\tmov ds, ax\n\tmov ss, ax\n\tmov es, ax\n\tmov fs, ax\n\tmov gs, ax\n\txor eax,eax\n\txor ebx,ebx\n\txor ecx,ecx\n\txor edx,edx\n\txor edi,edi\n\txor esi,esi\n\txor ebp,ebp\n\txor esp,esp\n\tmov esp,0x90000 ；使得栈底指向了0x90000\n\tcall ldrkrl_entry ；调用ldrkrl_entry函数\n\txor ebx,ebx\n\tjmp 0x2000000 ；跳转到0x2000000的内存地址\n\tjmp $\nGDT_START:\nknull_dsc: dq 0\nkcode_dsc: dq 0x00cf9a000000ffff ;a-e\nkdata_dsc: dq 0x00cf92000000ffff\nk16cd_dsc: dq 0x00009a000000ffff ；16位代码段描述符\nk16da_dsc: dq 0x000092000000ffff ；16位数据段描述符\nGDT_END:\nGDT_PTR:\nGDTLEN\tdw GDT_END-GDT_START-1\t;GDT界限\nGDTBASE\tdd GDT_START\n\nIDT_PTR:\nIDTLEN\tdw 0x3ff\nIDTBAS\tdd 0  ；这是BIOS中断表的地址和长度\n</code></pre><p>我来给你做个解读，代码的1～4行是在加载GDTR和IDTR寄存器，然后初始化CPU相关的寄存器。</p><p>和先前一样，因为代码模块的改变，所以我们要把GDT、IDT，寄存器这些东西重新初始化，最后再去调用二级引导器的主函数ldrkrl_entry。</p><h2>巧妙调用BIOS中断</h2><p>我们不要急着去写ldrkrl_entry函数，因为在后面我们要获得内存布局信息，要设置显卡图形模式，而这些功能依赖于BIOS提供中断服务。</p><p>可是，要在C函数中调用BIOS中断是不可能的，因为C语言代码工作在32位保护模式下，BIOS中断工作在16位的实模式。</p><p>所以，C语言环境下调用BIOS中断，需要处理的问题如下：</p><p>1.保存C语言环境下的CPU上下文 ，即保护模式下的所有通用寄存器、段寄存器、程序指针寄存器，栈寄存器，把它们都保存在内存中。<br>\n2.切换回实模式，调用BIOS中断，把BIOS中断返回的相关结果，保存在内存中。<br>\n3.切换回保护模式，重新加载第1步中保存的寄存器。这样C语言代码才能重新恢复执行。</p><p>要完成上面的功能，必须要写一个汇编函数才能完成，我们就把它写在ldrkrl32.asm文件中，如下所示 。</p><pre><code>realadr_call_entry:\n\tpushad     ;保存通用寄存器\n\tpush    ds\n\tpush    es\n\tpush    fs ;保存4个段寄存器\n\tpush    gs\n\tcall save_eip_jmp ；调用save_eip_jmp \n\tpop\tgs\n\tpop\tfs\n\tpop\tes      ;恢复4个段寄存器\n\tpop\tds\n\tpopad       ;恢复通用寄存器\n\tret\nsave_eip_jmp:\n\tpop esi  ；弹出call save_eip_jmp时保存的eip到esi寄存器中， \n\tmov [PM32_EIP_OFF],esi ；把eip保存到特定的内存空间中\n\tmov [PM32_ESP_OFF],esp ；把esp保存到特定的内存空间中\n\tjmp dword far [cpmty_mode]；长跳转这里表示把cpmty_mode处的第一个4字节装入eip，把其后的2字节装入cs\ncpmty_mode:\n\tdd 0x1000\n\tdw 0x18\n\tjmp $\n</code></pre><p>上面的代码我列了详细注释，你一看就能明白。不过这里唯一不好懂的是<strong>jmp dword far [cpmty_mode]指令</strong>，别担心，听我给你解读一下。</p><p>其实这个指令是一个<strong>长跳转</strong>，表示把[cpmty_mode]处的数据装入CS：EIP，也就是把0x18：0x1000装入到CS：EIP中。</p><p>这个0x18就是段描述索引（这个知识点不熟悉的话，你可以回看我们<a href=\"https://time.geekbang.org/column/article/375278\">第五节课</a>），它正是指向GDT中的16位代码段描述符；0x1000代表段内的偏移地址，所以在这个地址上，我们必须放一段代码指令，不然CPU跳转到这里将没指令可以执行，那样就会发生错误。</p><p>因为这是一个16位代码，所以我们需要新建立一个文件realintsve.asm，如下所示。</p><pre><code>[bits 16]\n_start:\n_16_mode:\n\tmov\tbp,0x20 ;0x20是指向GDT中的16位数据段描述符 \n\tmov\tds, bp\n\tmov\tes, bp\n\tmov\tss, bp\n\tmov\tebp, cr0\n\tand\tebp, 0xfffffffe\n\tmov\tcr0, ebp ；CR0.P=0 关闭保护模式\n\tjmp\t0:real_entry ；刷新CS影子寄存器，真正进入实模式\nreal_entry:\n\tmov bp, cs\n\tmov ds, bp\n\tmov es, bp\n\tmov ss, bp ；重新设置实模式下的段寄存器 都是CS中值，即为0 \n\tmov sp, 08000h ；设置栈\n\tmov bp,func_table\n\tadd bp,ax\n\tcall [bp] ；调用函数表中的汇编函数，ax是C函数中传递进来的\n\tcli\n\tcall disable_nmi\n\tmov\tebp, cr0\n\tor\tebp, 1\n\tmov\tcr0, ebp ；CR0.P=1 开启保护模式\n\tjmp dword 0x8 :_32bits_mode\n[BITS 32]\n_32bits_mode:\n\tmov bp, 0x10\n\tmov ds, bp\n\tmov ss, bp；重新设置保护模式下的段寄存器0x10是32位数据段描述符的索引\n\tmov esi,[PM32_EIP_OFF]；加载先前保存的EIP\n\tmov esp,[PM32_ESP_OFF]；加载先前保存的ESP\n\tjmp esi ；eip=esi 回到了realadr_call_entry函数中\n\nfunc_table:  ;函数表\n\tdw _getmmap ；获取内存布局视图的函数\n\tdw _read ；读取硬盘的函数\n    dw _getvbemode ；获取显卡VBE模式 \n    dw _getvbeonemodeinfo ；获取显卡VBE模式的数据\n    dw _setvbemode ；设置显卡VBE模式\n</code></pre><p>上面的代码我们只要将它编译成16位的二进制的文件，并把它放在0x1000开始的内存空间中就可以了。这样在realadr_call_entry函数的最后，就运行到这段代码中来了。</p><p>上述的代码的流程是这样的：首先从 _16_mode:标号处进入实模式，然后根据传递进来（由ax寄存器传入）的函数号，到函数表中调用对应的函数，里面的函数执行完成后，再次进入保护模式，加载EIP和ESP寄存器从而回到realadr_call_entry函数中。GDT还是imghead.asm汇编代码文件中的GDT，这没有变，因为它是由GDTR寄存器指向的。</p><p>说到这里，相信你会立刻明白，之前write_realintsvefile()函数的功能与意义了。它会把<strong>映像文件中的initldrsve.bin文件写入到特定的内存地址空间中</strong>，而initldrsve.bin正是由上面的realintsve.asm文件编译而成的。</p><h2>二级引导器主函数</h2><p>好，现在我们准备得差不多了，从二级引导器的主函数开始，这个函数我们要用C来写，估计你也感受到了写汇编语言的压力，所以不能老是写汇编。</p><p>我们先建立一个C文件ldrkrlentry.c，在其中写上一个主函数，代码如下。</p><pre><code>void ldrkrl_entry()\n{\n    init_bstartparm();\n    return;\n}\n</code></pre><p>上述代码中的 ldrkrl_entry()函数在initldr32.asm文件（配套代码库中对应ldrkrl32.asm）中被调用，从那条call ldrkrl_entry 指令开始进入了ldrkrl_entry()函数，在其中调用了<strong>init_bstartparm()函数</strong>，这个函数我们还没有实现，但通过名字我们不难推测，它是负责处理开始参数的。</p><p>你还记不记得，我们建造二级引导器的目的，就是要收集机器环境信息。我们要把这些信息形成一个有结构的参数，传递给我们的操作系统内核以备后续使用。</p><p>由此，我们能够确定，<strong>init_bstartparm()函数成了收集机器环境信息的主函数</strong>，下节课我们就会去实现它。</p><h2>重点回顾</h2><p>今天我们开始实现二级引导器了，但是我们还没有完全实现，我们下一节课再接着继续这项工作。</p><p>现在，我们来梳理一下这节课的内容，回顾一下我们今天的成果。</p><p>1.我们设计了机器信息结构，用于存放后面二级引导器收集到的机器信息。<br>\n2.对二级引导器代码模块进行了规划，确定各模块的主要功能。<br>\n3.实现了GRUB规定的GRUB头，以便被GRUB识别，在GRUB头中初始化了CPU寄存器，并且跳转到物理内存的0x200000地址处，真正进入到二级引导器中开始运行。<br>\n4.为了二级引导器能够调用BIOS中断服务程序，我们实现了专门用来完成调用BIOS中断服务程序的realintsve.asm模块。<br>\n5.最后，我们实现了二级引导器的主函数，由它调用完成其它功能的函数。</p><p>这里我还想聊聊，为什么我们要花这么多功夫，去设计二级引导器这个组件呢？</p><p>我们把这些处理操作系统运行环境的工作独立出来，交给二级引导器来做，这会<strong>大大降低后面开发操作系统的难度，也能增加操作系统的通用性。</strong>而且，针对不同的硬件平台，我们只要开发不同的二级引导器就好了。</p><h2>思考题</h2><p>请问GRUB头中为什么需要_entry标号和_start标号的地址？</p><p>欢迎你在留言区跟我交流活动。如果你身边的同事、朋友，对二级引导器的建立有兴趣，也欢迎你把这节课分享给他。</p><p>好，我是LMOS，我们下节课见！</p>","comments":[{"had_liked":false,"id":295830,"user_name":"neohope","can_delete":false,"product_type":"c1","uid":1043475,"ip_address":"","ucode":"C0268F6E7E2B6E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ec/13/49e98289.jpg","comment_is_top":true,"comment_ctime":1622614437,"is_pvip":false,"replies":[{"id":"107605","content":"厉害了，总结 的好","user_name":"作者回复","comment_id":295830,"uid":"1345199","ip_address":"","utype":1,"ctime":1622989598,"user_name_real":"LMOS"}],"discussion_count":14,"race_medal":0,"score":"9.2233723563050004e+18","product_id":100078401,"comment_content":"大体上整理了一下：<br><br>1、grub启动后，选择对应的启动菜单项，grub会通过自带文件系统驱动，定位到对应的eki文件<br><br>2、grub会尝试加载eki文件【eki文件需要满足grub多协议引导头的格式要求】<br>这些是在imginithead.asm中实现的，所以要包括：<br>A、grub文件头，包括魔数、grub1和grub2支持等<br>B、定位的_start符号等<br><br>3、grub校验成功后，会调用_start，然跳转到_entry<br>A、_entry中:关闭中断<br>B、加载GDT<br>C、然后进入_32bits_mode，清理寄存器，设置栈顶<br>D、调用inithead_entry【C】<br><br>4、inithead_entry.c<br>A、从imginithead.asm进入后，首先进入函数调用inithead_entry<br>B、初始化光标，清屏<br>C、从eki文件内部，找到initldrsve.bin文件，并分别拷贝到内存的指定物理地址<br>D、从eki文件内部，找到initldrkrl.bin文件，并分别拷贝到内存的指定物理地址<br>E、返回imginithead.asm<br><br>5、imginithead.asm中继续执行<br>jmp 0x200000<br>而这个位置，就是initldrkrl.bin在内存的位置ILDRKRL_PHYADR<br>所以后面要执行initldrkrl.bin的内容<br><br>6、这样就到了ldrkrl32.asm的_entry<br>A、将GDT加载到GDTR寄存器【内存】<br>B、将IDT加载到IDTR寄存器【中断】<br>C、跳转到_32bits_mode<br>初始寄存器<br>初始化栈<br>调用ldrkrl_entry【C】<br><br>7、ldrkrlentry.c<br>A、初始化光标，清屏<br>B、收集机器参数init_bstartparm【C】<br><br>8、bstartparm.c<br>A、初始化machbstart_t<br>B、各类初始化函数，填充machbstart_t的内容<br>C、返回<br><br>9、ldrkrlentry.c<br>A、返回<br><br>10、ldrkrl32.asm<br>A、跳转到0x2000000地址继续执行","like_count":74,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521230,"discussion_content":"厉害了，总结 的好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622989598,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1474356,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI3F4IdQuDZrhN8ThibP85eCiaSWTYpTrcC6QB9EoAkw3IIj6otMibb1CgrS1uzITAnJmGLXQ2tgIkAQ/132","nickname":"cugphoenix","note":"","ucode":"80101AF04C00D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377442,"discussion_content":"补充一下：grub会把映像文件eki加载到内存0x4000000（64MB）的位置上，映像文件头描述符的位置在0x4000000+0x1000 (64MB + 4KB），从头信息解析到\ninitldrsve.bin和initldrkrl.bin这两个文件在内存中的位置，然后再分别拷贝到0x1000（4KB，调用BIOS中断的代码）和0x200000（2MB，二级引导器的代码）的位置上。","likes_number":13,"is_delete":false,"is_hidden":false,"ctime":1622644354,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2617338,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ef/fa/5e9f3dc9.jpg","nickname":"驰往","note":"","ucode":"859DAB36735F00","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1474356,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI3F4IdQuDZrhN8ThibP85eCiaSWTYpTrcC6QB9EoAkw3IIj6otMibb1CgrS1uzITAnJmGLXQ2tgIkAQ/132","nickname":"cugphoenix","note":"","ucode":"80101AF04C00D3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382335,"discussion_content":"大佬，请问grub是如何加载eki文件到0x4000000的呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625535953,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":377442,"ip_address":""},"score":382335,"extra":""}]},{"author":{"id":2674472,"avatar":"https://static001.geekbang.org/account/avatar/00/28/cf/28/6e45b5b2.jpg","nickname":"傅春啸","note":"","ucode":"144DE575D6321D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381277,"discussion_content":"第十步又跳回0x2000000是要做什么要，从第六步再来一遍吗，还有initldrsve什么时候调用的呢。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1624978207,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":2619032,"avatar":"https://static001.geekbang.org/account/avatar/00/27/f6/98/e9708792.jpg","nickname":"北极","note":"","ucode":"3FDF3F2A8DD2F8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2674472,"avatar":"https://static001.geekbang.org/account/avatar/00/28/cf/28/6e45b5b2.jpg","nickname":"傅春啸","note":"","ucode":"144DE575D6321D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382552,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625631242,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":381277,"ip_address":""},"score":382552,"extra":""},{"author":{"id":2616028,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ea/dc/aa699264.jpg","nickname":"宏典","note":"","ucode":"63953F36596C28","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":2674472,"avatar":"https://static001.geekbang.org/account/avatar/00/28/cf/28/6e45b5b2.jpg","nickname":"傅春啸","note":"","ucode":"144DE575D6321D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386694,"discussion_content":"initldrsve什么时候调用的呢:\n\n1.二级引导器会调用realadr_call_entry，realadr_call_entry最终会跳转到initldrsve中执行。initldrsve（realintsve.asm 模块）中实现了一些函数，函数的通过调用BIOS中断来使用BIOS提供的服务，如_getmmap、_read、_getvbemode、_getvbeonemodeinfo、_setvbemode等。\n执行完对应的函数会返回realadr_call_entry。\n\n2.二级引导器基于realadr_call_entry封装了一系列函数，如mmap、get_vbemode、get_vbemodeinfo、set_vbemodeinfo等。\n\n\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1627731525,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":381277,"ip_address":""},"score":386694,"extra":""}]},{"author":{"id":1182103,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/97/a13db556.jpg","nickname":"徐旭","note":"","ucode":"0B00D3C3070A43","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579257,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657269414,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1623117,"avatar":"https://static001.geekbang.org/account/avatar/00/18/c4/4d/85014aab.jpg","nickname":"一叉树","note":"","ucode":"BFC984403ACD1F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558320,"discussion_content":"非常好的总结，感谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648203922,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1465629,"avatar":"","nickname":"enson","note":"","ucode":"646EEC7F63B5B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537405,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639053579,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2677530,"avatar":"https://static001.geekbang.org/account/avatar/00/28/db/1a/52d1501f.jpg","nickname":"rain","note":"","ucode":"A2E81AB7C4274C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382620,"discussion_content":"大神你好👋","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625647379,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2619032,"avatar":"https://static001.geekbang.org/account/avatar/00/27/f6/98/e9708792.jpg","nickname":"北极","note":"","ucode":"3FDF3F2A8DD2F8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382551,"discussion_content":"太感谢了，大佬","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625631078,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2646145,"avatar":"https://static001.geekbang.org/account/avatar/00/28/60/81/38b00111.jpg","nickname":"Feen","note":"","ucode":"E6CDC442B7213F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381761,"discussion_content":"纠正一下，第4步 文件名是inithead.c，不是initheadentry.c","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625204128,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1501316,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/dXf9e0gmVVV1ozqBIiaWiaxz1qgPZrYHT9x3ytnjfZ6quCH7gNtibXhsg66kH1E4FeTVHMB9J3PibNaMN2GthvceqA/132","nickname":"Geek_032c4a","note":"","ucode":"8CF7A8D681F15D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":379614,"discussion_content":"看了你的总结 有些不明白的地方都清楚了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624012749,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1115232,"avatar":"https://static001.geekbang.org/account/avatar/00/11/04/60/64d166b6.jpg","nickname":"Fan","note":"","ucode":"3BF28670FD9407","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378116,"discussion_content":"总结得好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623058169,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295741,"user_name":"springXu","can_delete":false,"product_type":"c1","uid":2064750,"ip_address":"","ucode":"F5DB0B963C894F","user_header":"","comment_is_top":true,"comment_ctime":1622584992,"is_pvip":true,"replies":[{"id":"107611","content":"正确的 ","user_name":"作者回复","comment_id":295741,"uid":"1345199","ip_address":"","utype":1,"ctime":1622989945,"user_name_real":"LMOS"}],"discussion_count":3,"race_medal":0,"score":"9.223372111491799e+18","product_id":100078401,"comment_content":"真实进入实际写代码的课程了。<br>对于grub的头格式在的第二节写个HelloOS.bin就已经有了，这次头格式还是会有。理由是grub是一级引导器。<br>这节课的内容就是围绕着由一级转到二级引导器的过程展开了。<br>关于二级引导器的加载过程，简单点说就是把我们内核加载到指定内存的位置并执行，这个加载函数核心是m2mcopy函数，东哥留给我们自己分析了，但东哥强调分析了下为什么会有32位下的代码和16位汇编代码共存的现象。 其实是为了让BIOS提供的获取硬件信息的操作函数（也就是实模式下的BIOS中断号来获取的）做成了c语言环境下也可以调用的功能。这就像跨语言互相调用的技术。汇编调用c语言的方法，反过来c语言调用汇编方法。但更为复杂些，原因是保护模式到实模式再回到保护模式的切换过程。内核可以获取硬件信息就可以根据硬件环境参数，配置自身参数开始工作了。如何配置参数，那又是下节继续播讲。周五见。<br>关于思考题，这个是grub也是要把控制权交给我们二级引导器的入口地址。 至于为什么不光有一个_start就可以了，我猜测是为了做验证吧。_start的操作是jmp 地址。这个地址正好是_entry。有错误还请东哥指正。哈哈","like_count":17,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521200,"discussion_content":"正确的 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622989945,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":2,"child_discussions":[{"author":{"id":2722260,"avatar":"https://static001.geekbang.org/account/avatar/00/29/89/d4/c6f47fb9.jpg","nickname":"xiaolver希望自己变强","note":"","ucode":"9771CC097E8273","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":583789,"discussion_content":"“因为我们二级引导器不是执行具体的加载任务的，而是解析内核文件、收集机器环境信息，它具体收集哪些信息，我会在下节课详细展开。”越来越疑惑了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660382950,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":521200,"ip_address":"广东"},"score":583789,"extra":""},{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"听水的湖","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":2722260,"avatar":"https://static001.geekbang.org/account/avatar/00/29/89/d4/c6f47fb9.jpg","nickname":"xiaolver希望自己变强","note":"","ucode":"9771CC097E8273","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585382,"discussion_content":"具体是啥疑惑呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661503622,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":583789,"ip_address":""},"score":585382,"extra":""}]}]},{"had_liked":false,"id":296039,"user_name":"嗣树","can_delete":false,"product_type":"c1","uid":1019334,"ip_address":"","ucode":"C6196E30F867D0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/c6/e648d118.jpg","comment_is_top":true,"comment_ctime":1622713817,"is_pvip":false,"replies":[{"id":"107593","content":"嗯嗯 是的 ","user_name":"作者回复","comment_id":296039,"uid":"1345199","ip_address":"","utype":1,"ctime":1622989034,"user_name_real":"LMOS"}],"discussion_count":2,"race_medal":0,"score":"9.2233720513624003e+18","product_id":100078401,"comment_content":"回答一下问题，GRUB 头中为什么需要 _entry 标号和 _start 标号的地址？<br><br>我们定义的 flags 值为：<br>MBT_HDR_FLAGS EQU 0x00010003<br><br>根据 Multiboot Specification 定义的头结构<br>Offset\tType\tField Name\t\tNote<br>0\t\tu32\t\tmagic\t\t\trequired<br>4\t\tu32\t\tflags\t\t\trequired<br>8\t\tu32\t\tchecksum\t\trequired<br>12\t\tu32\t\theader_addr\t\tif flags[16] is set<br>16\t\tu32\t\tload_addr\t\t        if flags[16] is set<br>20\t\tu32\t\tload_end_addr\t        if flags[16] is set<br>24\t\tu32\t\tbss_end_addr\t        if flags[16] is set<br>28\t\tu32\t\tentry_addr\t\tif flags[16] is set<br>32\t\tu32\t\tmode_type\t\tif flags[2] is set<br>36\t\tu32\t\twidth\t\t\tif flags[2] is set<br>40\t\tu32\t\theight\t\t\tif flags[2] is set<br>44\t\tu32\t\tdepth\t\t\tif flags[2] is set<br><br>flags[16] 解释如下：<br>If bit 16 in the ‘flags’ word is set, then the fields at offsets 12-28 in the Multiboot header are valid, and the boot loader should use them instead of the fields in the actual executable header to calculate where to load the OS image. This information does not need to be provided if the kernel image is in ELF format, but it must be provided if the images is in a.out format or in some other format. Compliant boot loaders must be able to load images that either are in ELF format or contain the load address information embedded in the Multiboot header; they may also directly support other executable formats, such as particular a.out variants, but are not required to.<br><br>也就是如果我们用的是标准的 ELF 文件就不需要提供额外的地址信息，而我们用的是自己定义的格式就需要人家从哪里加载哪里运行，所以需要将 bit 16 使能，填充相应的字段。<br><br>再解释下两个字段的含义：<br>load_addr<br>Contains the physical address of the beginning of the text segment. The offset in the OS image file at which to start loading is defined by the offset at which the header was found, minus (header_addr - load_addr). load_addr must be less than or equal to header_addr.<br><br>entry_addr<br>The physical address to which the boot loader should jump in order to start running the operating system.","like_count":3,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521302,"discussion_content":"嗯嗯 是的 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622989034,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2617112,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ef/18/6a620733.jpg","nickname":"kocgockohgoh王裒","note":"","ucode":"35EFABDE0D713D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535979,"discussion_content":"感觉entry_addr没什么用啊  不设是不是也可以啊  因为反正代码里有jmp  _entry","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638625327,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295747,"user_name":"pedro","can_delete":false,"product_type":"c1","uid":1200704,"ip_address":"","ucode":"F40C839DDFD599","user_header":"https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg","comment_is_top":false,"comment_ctime":1622589932,"is_pvip":false,"replies":[{"id":"107610","content":"对啊 <br>哈哈 铁汁好","user_name":"作者回复","comment_id":295747,"uid":"1345199","ip_address":"","utype":1,"ctime":1622989853,"user_name_real":"LMOS"}],"discussion_count":5,"race_medal":0,"score":"57457164780","product_id":100078401,"comment_content":"早起看专栏！<br>先回答思考题，grub是multiboot规范，因此引导器头部数据必须得满足一定的规则才能被grub所加载，本文中的MBT_HDR_FLAGS为0x001003，第16位被置为1，因此load_addr和entry_addr都是有效的，而它们正好分别对应_start和_entry。<br>其中load_addr是引导器二进制文件text段的起始地址，即_start，grub解析头部数据后，拿到_start地址，并从该地址处开始执行二级引导器代码。<br>而entry_addr对应的是操作系统的入口点，也就是_entry。引导程序最后将跳转到这里，不过本文的实现并没有完全按照这种思路来，_start直接跳到_entry，然后由_entry负责二级引导工作。","like_count":13,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521204,"discussion_content":"对啊 \n哈哈 铁汁好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622989853,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1200704,"avatar":"https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg","nickname":"pedro","note":"","ucode":"F40C839DDFD599","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377347,"discussion_content":"阿西，这个小节可是刷新了我的认知，原来我一直认为 bios 将操作权交给 bootloader 后，bootloader 直接加载操作系统，现在硬生生整出一个二级引导器，不仅 GDTR 加载了两次，还在保护模式下切回实模式，通过 bios 获取硬件信息，知识点直接爆炸啊~我得缓缓","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1622608766,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2617112,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ef/18/6a620733.jpg","nickname":"kocgockohgoh王裒","note":"","ucode":"35EFABDE0D713D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535976,"discussion_content":"请问start  和  entry这两个名字是固定的么 换成别的名字行么  grub会报错么","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638624402,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2677530,"avatar":"https://static001.geekbang.org/account/avatar/00/28/db/1a/52d1501f.jpg","nickname":"rain","note":"","ucode":"A2E81AB7C4274C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382619,"discussion_content":"铁子，你咋知道得那么多，啊哦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625647295,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2624931,"avatar":"https://static001.geekbang.org/account/avatar/00/28/0d/a3/9757c66c.jpg","nickname":"磊","note":"","ucode":"5C047DFEAF7F2E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381566,"discussion_content":"更正下MBT_HDR_FLAGS为0x00010003","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625126926,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312633,"user_name":"Amerny","can_delete":false,"product_type":"c1","uid":1757125,"ip_address":"","ucode":"8877A0B953A85F","user_header":"https://static001.geekbang.org/account/avatar/00/1a/cf/c5/8691f309.jpg","comment_is_top":false,"comment_ctime":1631902495,"is_pvip":false,"replies":[{"id":"113258","content":"需要多看几遍","user_name":"作者回复","comment_id":312633,"uid":"1345199","ip_address":"","utype":1,"ctime":1631926424,"user_name_real":"LMOS"}],"discussion_count":1,"race_medal":0,"score":"31696673567","product_id":100078401,"comment_content":"感觉代码也看不懂，稀里糊涂的，是不是得需要把代码看懂了才能进行下一步呀，脑子不够用了","like_count":7,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527056,"discussion_content":"需要多看几遍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631926424,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":308725,"user_name":"晶","can_delete":false,"product_type":"c1","uid":2687211,"ip_address":"","ucode":"14D1FB23EF16E8","user_header":"https://static001.geekbang.org/account/avatar/00/29/00/eb/5cec6300.jpg","comment_is_top":false,"comment_ctime":1629772366,"is_pvip":false,"replies":[{"id":"111903","content":"是的 ","user_name":"作者回复","comment_id":308725,"uid":"1345199","ip_address":"","utype":1,"ctime":1629940841,"user_name_real":"LMOS"}],"discussion_count":1,"race_medal":0,"score":"18809641550","product_id":100078401,"comment_content":"对应grub2的代码定义结构：<br>struct multiboot_header<br>{<br>  multiboot_uint32_t magic; &#47;&#47; 魔数 0xE85250D6\t  <br>  multiboot_uint32_t architecture; &#47;&#47; 架构 0表示x86<br>  multiboot_uint32_t header_length; &#47;&#47; 表示mb header 长度<br>  multiboot_uint32_t checksum; &#47;&#47; 校验和<br>};<br><br>在 之后是multiboot_header_tag，<br>struct multiboot_header_tag_address<br>{<br>    multiboot_uint16_t type;    &#47;&#47; 2 表示  multiboot_header_tag_address<br>    multiboot_uint16_t flags;   &#47;&#47; 0 <br>    multiboot_uint32_t size;    &#47;&#47; 24<br>    multiboot_uint32_t header_addr;  &#47;&#47; mbhdr<br>    multiboot_uint32_t load_addr;    &#47;&#47; _start<br>    multiboot_uint32_t load_end_addr; &#47;&#47; 0 表示数据段 和 代码段一样 占用整个空间<br>    multiboot_uint32_t bss_end_addr;  &#47;&#47; 0 <br>};<br><br>再之后是 multiboot_header_tag_entry_address<br>struct multiboot_header_tag_entry_address<br>{<br>  multiboot_uint16_t type;  &#47;&#47; type = 3 表示 multiboot_header_tag_entry_address<br>  multiboot_uint16_t flags; <br>  multiboot_uint32_t size;<br>  multiboot_uint32_t entry_addr;<br>};<br><br>mbhdr:<br>    DD  0xE85250D6\t  magic<br>    DD  0  architecture<br>    DD  mhdrend - mbhdr    header_length<br>    DD  -(0xE85250D6 + 0 + (mhdrend - mbhdr))     checksum<br>   <br>  ；multiboot_header_tag<br>    DW  2, 0    ; type = 2 ;flag  = 0;<br>    DD  24      ; size =24<br>    DD  mbhdr<br>    DD  _start<br>    DD  0<br>    DD  0<br><br>  ;multiboot_header_tag_entry_address<br>    DW  3, 0    ;;type = 3 flag = 0<br>    DD  12<br>    DD  _entry  ; entry_addr = _entry  <br>    <br>  ;<br>    DD      0  <br>    DW  0, 0<br>    DD  8","like_count":4,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525603,"discussion_content":"是的 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629940841,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":307348,"user_name":"沈畅","can_delete":false,"product_type":"c1","uid":1077953,"ip_address":"","ucode":"7404E41356B36B","user_header":"https://static001.geekbang.org/account/avatar/00/10/72/c1/59509397.jpg","comment_is_top":false,"comment_ctime":1629038405,"is_pvip":true,"replies":[{"id":"111301","content":"是的 是的 ","user_name":"作者回复","comment_id":307348,"uid":"1345199","ip_address":"","utype":1,"ctime":1629085432,"user_name_real":"LMOS"}],"discussion_count":1,"race_medal":0,"score":"14513940293","product_id":100078401,"comment_content":"如果我们不用grub作为引导程序，自己写一个引导程序，在实模式下，是不是就可以直接调用bois中断收集硬件信息，而不需要后面在保护模式下切换回实模式，再收集？","like_count":3,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525121,"discussion_content":"是的 是的 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629085432,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295944,"user_name":"熊光红","can_delete":false,"product_type":"c1","uid":2617636,"ip_address":"","ucode":"2216C008FAD248","user_header":"https://static001.geekbang.org/account/avatar/00/27/f1/24/07ce02a0.jpg","comment_is_top":false,"comment_ctime":1622679204,"is_pvip":false,"replies":[{"id":"107600","content":"printf 走天下 ","user_name":"作者回复","comment_id":295944,"uid":"1345199","ip_address":"","utype":1,"ctime":1622989349,"user_name_real":"LMOS"}],"discussion_count":3,"race_medal":0,"score":"14507581092","product_id":100078401,"comment_content":"请问老师，如何调试内核？怎么搭建调试环境","like_count":3,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521275,"discussion_content":"printf 走天下 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622989349,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1738119,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/85/87/727142bc.jpg","nickname":"MacBao","note":"","ucode":"8CF51C3688C8F6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377521,"discussion_content":"qemu+gdb\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1622693270,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1531189,"avatar":"https://static001.geekbang.org/account/avatar/00/17/5d/35/b1eb964a.jpg","nickname":"🐟🐙🐬🐆🦌🦍🐑🦃","note":"","ucode":"2F954654BCE13B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575609,"discussion_content":"用 bochs ，qemu","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654950075,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":304334,"user_name":"🎋 🎋 🎋","can_delete":false,"product_type":"c1","uid":2637450,"ip_address":"","ucode":"388A6089DBD7EE","user_header":"https://static001.geekbang.org/account/avatar/00/28/3e/8a/204165cc.jpg","comment_is_top":false,"comment_ctime":1627356671,"is_pvip":false,"replies":[{"id":"110128","content":"没到时候  继续往后看 ","user_name":"作者回复","comment_id":304334,"uid":"1345199","ip_address":"","utype":1,"ctime":1627358813,"user_name_real":"LMOS"}],"discussion_count":1,"race_medal":0,"score":"10217291263","product_id":100078401,"comment_content":"老师 lmoskrlimg：未找到命令   是为什么呀","like_count":2,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524017,"discussion_content":"没到时候  继续往后看 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627358813,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":298095,"user_name":"Geek_032c4a","can_delete":false,"product_type":"c1","uid":1501316,"ip_address":"","ucode":"8CF7A8D681F15D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/dXf9e0gmVVV1ozqBIiaWiaxz1qgPZrYHT9x3ytnjfZ6quCH7gNtibXhsg66kH1E4FeTVHMB9J3PibNaMN2GthvceqA/132","comment_is_top":false,"comment_ctime":1623910737,"is_pvip":false,"replies":[{"id":"108210","content":"代码仓库中有的 pull一下","user_name":"作者回复","comment_id":298095,"uid":"1345199","ip_address":"","utype":1,"ctime":1623981073,"user_name_real":"LMOS"}],"discussion_count":1,"race_medal":0,"score":"10213845329","product_id":100078401,"comment_content":"请问下lmoskrlimg源代码是哪个，我搜了一圈没看到工具的源代码，是只给了个二进制吗？","like_count":2,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522013,"discussion_content":"代码仓库中有的 pull一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623981073,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295766,"user_name":"blentle","can_delete":false,"product_type":"c1","uid":1064679,"ip_address":"","ucode":"AC092609A4942A","user_header":"https://static001.geekbang.org/account/avatar/00/10/3e/e7/261711a5.jpg","comment_is_top":false,"comment_ctime":1622595025,"is_pvip":false,"replies":[{"id":"107609","content":"后面还有呢","user_name":"作者回复","comment_id":295766,"uid":"1345199","ip_address":"","utype":1,"ctime":1622989782,"user_name_real":"LMOS"}],"discussion_count":1,"race_medal":0,"score":"10212529617","product_id":100078401,"comment_content":"越来越有意思了","like_count":2,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521208,"discussion_content":"后面还有呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622989782,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":325289,"user_name":"Geek_e42826","can_delete":false,"product_type":"c1","uid":2855670,"ip_address":"","ucode":"38A1AF645B28FF","user_header":"","comment_is_top":false,"comment_ctime":1638890988,"is_pvip":false,"replies":[{"id":"118095","content":"恭喜","user_name":"作者回复","comment_id":325289,"uid":"1345199","ip_address":"","utype":1,"ctime":1639012983,"user_name_real":"编辑"}],"discussion_count":1,"race_medal":0,"score":"5933858284","product_id":100078401,"comment_content":"make 报错指南<br>1, 需要先安装nasm。sudo apt install nasm <br>```c<br>hello@hello-VirtualBox:~&#47;01OS&#47;01HelloOS&#47;cosmos&#47;lesson10~11&#47;Cosmos$ make all <br>清理全部已构建文件... ^_^<br>*********正在开始编译构建系统*************<br>make[3]: nasm: 没有那个文件或目录<br>make[3]: *** [krnlbuidrule.mh:10：imginithead.o] 错误 127<br>make[2]: *** [Makefile:27：all] 错误 2<br>make[1]: *** [Makefile.x86:22：all] 错误 2<br>make: *** [Makefile:58：all] 错误 2<br>```<br>2，需要安装gcc。sudo apt install gcc<br>```c<br>hello@hello-VirtualBox:~&#47;01OS&#47;01HelloOS&#47;cosmos&#47;lesson10~11&#47;Cosmos$ make all <br>清理全部已构建文件... ^_^<br>*********正在开始编译构建系统*************<br>AS -[M] 正在构建... ..&#47;ldrkrl&#47;imginithead.asm<br>make[3]: gcc: 没有那个文件或目录<br>make[3]: *** [krnlbuidrule.mh:13：inithead.o] 错误 127<br>make[2]: *** [Makefile:27：all] 错误 2<br>make[1]: *** [Makefile.x86:22：all] 错误 2<br>make: *** [Makefile:58：all] 错误 2<br>```<br><br>3、make成功显示如下<br>```c<br>hello@hello-VirtualBox:~&#47;01OS&#47;01HelloOS&#47;cosmos&#47;lesson10~11&#47;Cosmos$ make all <br>清理全部已构建文件... ^_^<br>*********正在开始编译构建系统*************<br>AS -[M] 正在构建... ..&#47;ldrkrl&#47;imginithead.asm<br>CC -[M] 正在构建... ..&#47;ldrkrl&#47;inithead.c<br>CC -[M] 正在构建... ..&#47;ldrkrl&#47;vgastr.c<br>AS -[M] 正在构建... ..&#47;ldrkrl&#47;ldrkrl32.asm<br>CC -[M] 正在构建... ..&#47;ldrkrl&#47;ldrkrlentry.c<br>CC -[M] 正在构建... ..&#47;ldrkrl&#47;fs.c<br>CC -[M] 正在构建... ..&#47;ldrkrl&#47;chkcpmm.c<br>CC -[M] 正在构建... ..&#47;ldrkrl&#47;graph.c<br>CC -[M] 正在构建... ..&#47;ldrkrl&#47;bstartparm.c<br>AS -[M] 正在构建... ..&#47;ldrkrl&#47;realintsve.asm<br>OBJCOPY -[M] 正在构建... initldrimh.bin<br>OBJCOPY -[M] 正在构建... initldrkrl.bin<br>OBJCOPY -[M] 正在构建... initldrsve.bin<br>文件数：2<br>映像文件大小：20480<br>恭喜我，系统编译构建完成！ ^_^<br>恭喜我，系统编译构建完成！ ^_^<br>恭喜我，系统编译构建完成！ ^_^<br>hello@hello-VirtualBox:~&#47;01OS&#47;01HelloOS&#47;cosmos&#47;less<br>```<br>","like_count":1,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537251,"discussion_content":"恭喜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639012983,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":304945,"user_name":"Jayying","can_delete":false,"product_type":"c1","uid":2072250,"ip_address":"","ucode":"997F9E233E24CF","user_header":"https://static001.geekbang.org/account/avatar/00/1f/9e/ba/4b60c587.jpg","comment_is_top":false,"comment_ctime":1627714933,"is_pvip":false,"replies":[{"id":"110314","content":"到十三节课以后主要就是C啦，加油～","user_name":"编辑回复","comment_id":304945,"uid":"1501385","ip_address":"","utype":2,"ctime":1627717163,"user_name_real":"赵宇新"}],"discussion_count":1,"race_medal":0,"score":"5922682229","product_id":100078401,"comment_content":"不大会汇编语言，感觉看汇编还有些难度","like_count":1,"discussions":[{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"听水的湖","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524223,"discussion_content":"到十三节课以后主要就是C啦，加油～","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627717163,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":298295,"user_name":"Geek_032c4a","can_delete":false,"product_type":"c1","uid":1501316,"ip_address":"","ucode":"8CF7A8D681F15D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/dXf9e0gmVVV1ozqBIiaWiaxz1qgPZrYHT9x3ytnjfZ6quCH7gNtibXhsg66kH1E4FeTVHMB9J3PibNaMN2GthvceqA/132","comment_is_top":false,"comment_ctime":1624005069,"is_pvip":false,"replies":[{"id":"108302","content":"GRUB加载时就是保护模式 了 ","user_name":"作者回复","comment_id":298295,"uid":"1345199","ip_address":"","utype":1,"ctime":1624181783,"user_name_real":"LMOS"}],"discussion_count":1,"race_medal":0,"score":"5918972365","product_id":100078401,"comment_content":"imginithead.asm这个文件的程序应该运行在实模式下的。<br>1，为啥在还没有进入保护模式的时候就可以操作esp、eax、ebx这种寄存器？<br>2，实模式下可以直接调用了inithead_entry这种C语言函数？","like_count":1,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522086,"discussion_content":"GRUB加载时就是保护模式 了 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624181783,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295881,"user_name":"二三子也","can_delete":false,"product_type":"c1","uid":1245787,"ip_address":"","ucode":"69C7D86583277D","user_header":"https://static001.geekbang.org/account/avatar/00/13/02/5b/ce326cfc.jpg","comment_is_top":false,"comment_ctime":1622628482,"is_pvip":false,"replies":[{"id":"107602","content":"是我指定的 在引导头中 ","user_name":"作者回复","comment_id":295881,"uid":"1345199","ip_address":"","utype":1,"ctime":1622989447,"user_name_real":"LMOS"}],"discussion_count":1,"race_medal":0,"score":"5917595778","product_id":100078401,"comment_content":"老师有个问题：0x200000。在x86-64平台下，这个值是grub默认将multiboot2定义的文件加载到的位置吗？如果是的话，这个值是手册提供的？还是调试出来的？","like_count":1,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521251,"discussion_content":"是我指定的 在引导头中 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622989447,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295842,"user_name":"飞翔","can_delete":false,"product_type":"c1","uid":1349270,"ip_address":"","ucode":"72252157268A12","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/J3dqALgicfVklewMjVkpyLbTk9YiamnBf5QQZ3NPHGlMeVSdLDB5yHLicEZHKBbUets76KOFwbl9ju0xJw1VeGa1A/132","comment_is_top":false,"comment_ctime":1622617358,"is_pvip":false,"replies":[{"id":"107604","content":"我在代码目录中提供了","user_name":"作者回复","comment_id":295842,"uid":"1345199","ip_address":"","utype":1,"ctime":1622989541,"user_name_real":"LMOS"}],"discussion_count":4,"race_medal":0,"score":"5917584654","product_id":100078401,"comment_content":"lmoskrlimg这个工具从哪里找，在centos上没有找到？","like_count":1,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521234,"discussion_content":"我在代码目录中提供了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622989541,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1115232,"avatar":"https://static001.geekbang.org/account/avatar/00/11/04/60/64d166b6.jpg","nickname":"Fan","note":"","ucode":"3BF28670FD9407","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377407,"discussion_content":"build 目录中\nhttps://gitee.com/lmos/cosmos/tree/master/lesson10~11/Cosmos/initldr/build","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1622630167,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1245787,"avatar":"https://static001.geekbang.org/account/avatar/00/13/02/5b/ce326cfc.jpg","nickname":"二三子也","note":"","ucode":"69C7D86583277D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377395,"discussion_content":"这个应该是老师自己写的。不是Linux的自带工具。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622626974,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2532163,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKc2mia43C3uvJzsgXrsYrh96QichITEWCEu1dvGgNhiaIcaa92UM2nGArV0d8tic3PGGTjiagsvVqTe9w/132","nickname":"Geek_41ac17","note":"","ucode":"C5E4C8A2BC1D1F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1245787,"avatar":"https://static001.geekbang.org/account/avatar/00/13/02/5b/ce326cfc.jpg","nickname":"二三子也","note":"","ucode":"69C7D86583277D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389935,"discussion_content":"这个工具我在源码目录下make了之后如何使用啊？ 大佬","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629524457,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":377395,"ip_address":""},"score":389935,"extra":""}]}]},{"had_liked":false,"id":360239,"user_name":"板栗","can_delete":false,"product_type":"c1","uid":2325384,"ip_address":"湖北","ucode":"DA7A1506D7E7BA","user_header":"https://static001.geekbang.org/account/avatar/00/23/7b/88/7bae8fe0.jpg","comment_is_top":false,"comment_ctime":1666332126,"is_pvip":false,"replies":[{"id":"131037","content":"这是一种安全编程的需要","user_name":"作者回复","comment_id":360239,"uid":"1345199","ip_address":"湖北","utype":1,"ctime":1666420558,"user_name_real":"编辑"}],"discussion_count":1,"race_medal":0,"score":"1666332126","product_id":100078401,"comment_content":"老师，请问下，为什么：在grub头的imginithead.asm的_entry中调用了cli关中断，而随后在二级引导器的ldrkrl32.asm的_entry中又调用cli关中断呢？是不是因为这两段代码可能运行在不同cpu（或核）上，所以要调用cli关本地中断？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591233,"discussion_content":"这是一种安全编程的需要","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666420558,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"湖北"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":352877,"user_name":"X","can_delete":false,"product_type":"c1","uid":1581509,"ip_address":"陕西","ucode":"BE05C1D25CE313","user_header":"https://static001.geekbang.org/account/avatar/00/18/21/c5/024e1ef1.jpg","comment_is_top":false,"comment_ctime":1658992096,"is_pvip":false,"replies":[{"id":"128365","content":"你要编译lmoskrlimg 工具","user_name":"作者回复","comment_id":352877,"uid":"1345199","ip_address":"陕西","utype":1,"ctime":1659091213,"user_name_real":"编辑"}],"discussion_count":1,"race_medal":0,"score":"1658992096","product_id":100078401,"comment_content":"make 老师给的工具的时候各种问题啊。<br><br>第一个问题：<br>&#47;usr&#47;include&#47;features.h:367:25: fatal error: sys&#47;cdefs.h: No such file or directory<br>解决方法：<br>第一步：sudo apt-get –fix-broken install；<br>第二步：sudo apt-get install libc6-dev-i386；<br><br>问题出现原因是老师这个工具依赖的库文件是32位库，自己的虚拟机是64位库。<br><br>第二个问题：<br>&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `lmoskrlimg.o&#39; is incompatible with i386 output<br>&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `imgcore.o&#39; is incompatible with i386 output<br>&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `imgmgrhead.o&#39; is incompatible with i386 output<br>&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `param.o&#39; is incompatible with i386 output<br>&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `file.o&#39; is incompatible with i386 output<br>&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `imgundo.o&#39; is incompatible with i386 output<br>&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `memdisk.o&#39; is incompatible with i386 output<br>&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `mem.o&#39; is incompatible with i386 output<br>&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `limgerror.o&#39; is incompatible with i386 output<br>老师工具编译之后输出的编译文件 *.o 是32位的，可是我自己虚拟机是64位的架构，ld连接器连接不上。<br>有点无语，一通百度是gcc的时候要加上 -m32，可是找不到老师是在哪里gcc的……<br><br><br>","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":581970,"discussion_content":"你要编译lmoskrlimg 工具","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659091213,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"陕西"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":352848,"user_name":"Raina","can_delete":false,"product_type":"c1","uid":2617080,"ip_address":"陕西","ucode":"CDAE2402F64096","user_header":"https://static001.geekbang.org/account/avatar/00/27/ee/f8/6f69be1e.jpg","comment_is_top":false,"comment_ctime":1658979952,"is_pvip":false,"replies":[{"id":"128366","content":"不是喔","user_name":"作者回复","comment_id":352848,"uid":"1345199","ip_address":"陕西","utype":1,"ctime":1659091264,"user_name_real":"编辑"}],"discussion_count":1,"race_medal":0,"score":"1658979952","product_id":100078401,"comment_content":"multiboot2 的 tag end 不是 type = 0，flag = 0， size = 8 吗，那 DD _entry 后面的 DD 0 是不是多余的","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":581971,"discussion_content":"不是喔","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659091264,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"陕西"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":348702,"user_name":"Geek_d26e63","can_delete":false,"product_type":"c1","uid":1809676,"ip_address":"","ucode":"24125CED20B6DF","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/fBOybgVTWXYXxaicaVEysXCjkKT13dX7icAj96KibJ815mia1FvYro9KcbA3xtwnIxmPJ38Vt6rmg6vp0auGKel93A/132","comment_is_top":false,"comment_ctime":1655313049,"is_pvip":false,"replies":[{"id":"128080","content":"检查一下文件","user_name":"作者回复","comment_id":348702,"uid":"1345199","ip_address":"","utype":1,"ctime":1658391245,"user_name_real":"编辑"}],"discussion_count":1,"race_medal":0,"score":"1655313049","product_id":100078401,"comment_content":"运行：lmoskrlimg -m k -lhf initldrimh.bin -o Cosmos.eki -f initldrkrl.bin initldrsve.bin<br>报错：LKRLIMG ERR:write ldrheadfile C file:..&#47;core&#47;imgcore.c C line:35 C function:limg_krnl_mode_run","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580875,"discussion_content":"检查一下文件","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658391245,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345713,"user_name":"│．Sk","can_delete":false,"product_type":"c1","uid":2453415,"ip_address":"","ucode":"A2EEB2E9585A77","user_header":"https://static001.geekbang.org/account/avatar/00/25/6f/a7/565214bc.jpg","comment_is_top":false,"comment_ctime":1652521203,"is_pvip":false,"replies":[{"id":"126506","content":"是的","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1653618131,"ip_address":"","comment_id":345713,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1652521203","product_id":100078401,"comment_content":"老师好，请教一下老师 grub 加载 eki 文件后究竟是从 _entry 开始执行的，还是从 _start 开始执行的？ <br><br>从文档上看感觉 load_addr(_start) 只是为了决定从哪里开始加载；真正的入口应该是 entry_addr(_entry) ，如果是这样的 _start 后面的 jmp _entry 是不是不要也可以？ <br><br>谢谢老师！<br>","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573717,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653618131,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345551,"user_name":"│．Sk","can_delete":false,"product_type":"c1","uid":2453415,"ip_address":"","ucode":"A2EEB2E9585A77","user_header":"https://static001.geekbang.org/account/avatar/00/25/6f/a7/565214bc.jpg","comment_is_top":false,"comment_ctime":1652375850,"is_pvip":false,"replies":[{"id":"126511","content":"GRUB头","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1653618281,"ip_address":"","comment_id":345551,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1652375850","product_id":100078401,"comment_content":"老师好，请教老师 grub 是怎么知道要把映像文件 Cosmos.eki 加载到哪个物理地址的呢？<br><br>貌似编译的时候已经用 objcopy 把 binary 的 elf 信息都去掉了，但是 Cosmos.eki 中的指令都是根据 ld 链接脚本确定的地址，这就要求 Cosmos.eki 加载到正确的物理地址才能正确执行，但是不太了解 grub 是怎么知道要把映像文件 Cosmos.eki 加载到哪个物理地址的。","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573722,"discussion_content":"GRUB头","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653618281,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345076,"user_name":"Qfeng","can_delete":false,"product_type":"c1","uid":1466121,"ip_address":"","ucode":"1248E70012BBA2","user_header":"https://static001.geekbang.org/account/avatar/00/16/5f/09/2ec44412.jpg","comment_is_top":false,"comment_ctime":1652004049,"is_pvip":false,"replies":[{"id":"125956","content":"正确的 ","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1652064659,"ip_address":"","comment_id":345076,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1652004049","product_id":100078401,"comment_content":"这篇文章开始烧脑了，全文汇编，第一次看这篇云里雾里不知所云，汇编基础差决心回头花了3个礼拜啃完了《汇编原理》，这周再次看这篇又理解了些。<br>和《汇编原理》书上介绍的8086不同，这篇里面是32位的x86，不过底层原理差不多。<br><br>对着这篇文章结合源码，画了一份visio流程图，流程上清晰了些，总结如下：<br>1. 实现了被GRUB识别的GRUB Head，GRUB Head里面做了2件事：<br>1）inithead.c，从内存中查找和拷贝2个bin文件（二级引导器和BIOS中断服务程序的bin文件）到指定位置；<br>2）跳转到物理地址0x200000执行二级引导器代码（第一步已经将机器码拷贝到这里）。<br><br>2. 二级引导器 ldrkrl32.asm (0x200000)<br>1）引导主函数ldrkrl_entry()   （暂未实现）；<br>2）准备BIOS中断服务程序调用框架，核心是通过 jmp 0x18:0x1000 跳转到 BIOS中断服务程序（readintsve.asm）所在位置执行。<br><br>3. BIOS终端服务程序 readintsve.asm (0x18:0x1000)<br>1）首先进入16位实模式；<br>2）实模式下，有一个func_table，通过这些函数可以获取内存、硬盘和显卡等硬件信息；<br>3）最后返回32位保护模式，恢复进入前保存的EIS+EIP返回调用前的32位保护模式状态。<br><br>思考题：_start和_entry的用途是GRUB用来识别硬件厂商客制化的GRUB头的，作为厂商二级引导器的入口，详细信息上面已经有很多大佬解释的很详细就不写了。","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571060,"discussion_content":"正确的 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652064659,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":344349,"user_name":"～～","can_delete":false,"product_type":"c1","uid":1463768,"ip_address":"","ucode":"52797D415A538D","user_header":"https://static001.geekbang.org/account/avatar/00/16/55/d8/610fae56.jpg","comment_is_top":false,"comment_ctime":1651484960,"is_pvip":false,"replies":[{"id":"125969","content":"对的，保护模式在GRUB运行时就设置了，我只是重新加载了GDT","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1652065859,"ip_address":"","comment_id":344349,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1651484960","product_id":100078401,"comment_content":"请问在进入realintsve.asm之前是实模式还是保护模式？因为在realintsve.asm一开始设置了实模式，那就意味着之前一直是保护模式？但是我在之前的代码中没有找到realintsve.asm以外没有找到设置保护模式的代码","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571075,"discussion_content":"对的，保护模式在GRUB运行时就设置了，我只是重新加载了GDT","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652065859,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":342743,"user_name":"啦啦啦","can_delete":false,"product_type":"c1","uid":2968553,"ip_address":"","ucode":"D4D57C89F3F8D5","user_header":"https://static001.geekbang.org/account/avatar/00/2d/4b/e9/6d4908fa.jpg","comment_is_top":false,"comment_ctime":1650441965,"is_pvip":false,"replies":[{"id":"125987","content":"是的","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1652067338,"ip_address":"","comment_id":342743,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1650441965","product_id":100078401,"comment_content":"简要说明一下Makefile的执行框架，执行make vboxtest时，过程如下：<br>1、release 依赖于 all；执行all下的命令，转移到Makefile.x86中<br>2、Makefile.x86转移到build目录下的Makefile<br>3、在build目录下的Makefile，分为两个部分，首先是编译，即$(MAKE) $(INITLDRMFLGS)；然后是链接，即$(MAKE) $(INITLDRLINKMFLGS)。<br>4、编译部分由initldr.mk完成，其调用krnlbuidrule.mh文件完成编译过程，生成目标文件。<br>5、链接部分由ldrlink.mk完成，最终生成initldrimh.bin、initldrkrl.bin、initldrsve.bin三个文件。<br><br>三个.lds文件是链接过程的脚本文件<br>","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571095,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652067338,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":341545,"user_name":"MONKEYG","can_delete":false,"product_type":"c1","uid":2519235,"ip_address":"","ucode":"81C780AA899A9E","user_header":"https://static001.geekbang.org/account/avatar/00/26/70/c3/cc46c55a.jpg","comment_is_top":false,"comment_ctime":1649685882,"is_pvip":false,"replies":[{"id":"124810","content":"问过老师了，你这个没有lmoskrlimg软件，请Gitee拉取最新代码，代码仓库里有源代码。这个是东哥自己写的生成cosmos.efi的工具。","user_name":"编辑回复","user_name_real":"编辑","uid":"1501385","ctime":1649728450,"ip_address":"","comment_id":341545,"utype":2}],"discussion_count":2,"race_medal":0,"score":"1649685882","product_id":100078401,"comment_content":"sudo .&#47;lmoskrlimg -m k -lhf initldrimh.bin -o Cosmos.eki -f initldrkrl.bin initldrsve.bin<br>.&#47;lmoskrlimg: 1: .&#47;lmoskrlimg: ELF\u0002\u0001\u0001\u0003\u0002: not found<br>.&#47;lmoskrlimg: 1: .&#47;lmoskrlimg: J�: not found<br>.&#47;lmoskrlimg: 2: .&#47;lmoskrlimg: �J�Q: not found<br>.&#47;lmoskrlimg: 1: .&#47;lmoskrlimg: Syntax error: word unexpected (expecting &quot;)&quot;)<br><br>老师能帮忙看看么，不清楚为什么会报这个文件找不到","like_count":0,"discussions":[{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"听水的湖","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":561824,"discussion_content":"问过老师了，你这个没有lmoskrlimg软件，请Gitee拉取最新代码，代码仓库里有源代码。这个是东哥自己写的生成cosmos.efi的工具。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649728450,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":8}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"听水的湖","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":561837,"discussion_content":"\n和课程代码并列的，你找tools/lmoskrlimg这个","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649729763,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":341255,"user_name":"singularity of space time","can_delete":false,"product_type":"c1","uid":2816371,"ip_address":"","ucode":"14502507C9F2D7","user_header":"https://static001.geekbang.org/account/avatar/00/2a/f9/73/01eafd3c.jpg","comment_is_top":false,"comment_ctime":1649485596,"is_pvip":true,"replies":[{"id":"125081","content":"GRUB头中","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1650249768,"ip_address":"","comment_id":341255,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1649485596","product_id":100078401,"comment_content":"请问GRUB将映像文件加载到指定地址0x4000000 也即#define IMGFILE_PHYADR 0x4000000 这个是在哪里指定GRUB对于映像文件的加载地址的呀 找不到","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":564456,"discussion_content":"GRUB头中","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650249768,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2128971,"avatar":"","nickname":"小牧童","note":"","ucode":"C8C70F7C341CAA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":587430,"discussion_content":"您好，grub头相关文件中并没有找到类似决定放置eki文件到内存中特定位置的代码或配置，可否再明示下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663054275,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":564456,"ip_address":"北京"},"score":587430,"extra":""}]}]},{"had_liked":false,"id":340887,"user_name":"卖薪沽酒","can_delete":false,"product_type":"c1","uid":2465726,"ip_address":"","ucode":"7F04A84EDBA856","user_header":"https://static001.geekbang.org/account/avatar/00/25/9f/be/14b2ad2e.jpg","comment_is_top":false,"comment_ctime":1649216286,"is_pvip":false,"replies":[{"id":"125082","content":"看cpu 那节课","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1650249837,"ip_address":"","comment_id":340887,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1649216286","product_id":100078401,"comment_content":"这个 0x18 就是段描述索引, 这里为啥是 0x18 , 索引的开头和粒度是怎么算的","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":564458,"discussion_content":"看cpu 那节课","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650249837,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":340426,"user_name":"no-one","can_delete":false,"product_type":"c1","uid":1476425,"ip_address":"","ucode":"43D4C5450AAC83","user_header":"https://static001.geekbang.org/account/avatar/00/16/87/49/1796143f.jpg","comment_is_top":false,"comment_ctime":1648807940,"is_pvip":false,"replies":[{"id":"124638","content":"有帮助就好","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1649228593,"ip_address":"","comment_id":340426,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1648807940","product_id":100078401,"comment_content":"老师写的太好了，学习氛围也很好，这钱花的太值了","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560202,"discussion_content":"有帮助就好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649228593,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":339300,"user_name":"BruceLi","can_delete":false,"product_type":"c1","uid":2441083,"ip_address":"","ucode":"ABBE2033DF9790","user_header":"https://static001.geekbang.org/account/avatar/00/25/3f/7b/ba507e92.jpg","comment_is_top":false,"comment_ctime":1648027430,"is_pvip":false,"replies":[{"id":"124072","content":"chkcpmm.c graph.c","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1648089693,"ip_address":"","comment_id":339300,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1648027430","product_id":100078401,"comment_content":"请教一下realadr_call_entry部分的代码是在哪一个模块调用的，正文中没有查到。谢谢！","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558088,"discussion_content":"chkcpmm.c graph.c","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648089693,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":334718,"user_name":"肉丝炒青椒","can_delete":false,"product_type":"c1","uid":1183783,"ip_address":"","ucode":"E67203E5B23D5D","user_header":"https://static001.geekbang.org/account/avatar/00/12/10/27/97afaf66.jpg","comment_is_top":false,"comment_ctime":1645089144,"is_pvip":false,"replies":[{"id":"122314","content":"不会解析elf","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1645158168,"ip_address":"","comment_id":334718,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1645089144","product_id":100078401,"comment_content":"有个疑问，grub读取Cosmos.eki文件时，是会根据elf文件格式解析，把文件加载到0x4000000开始的内存位置吗","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551865,"discussion_content":"不会解析elf","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645158168,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1183783,"avatar":"https://static001.geekbang.org/account/avatar/00/12/10/27/97afaf66.jpg","nickname":"肉丝炒青椒","note":"","ucode":"E67203E5B23D5D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552144,"discussion_content":"再请教下老师，那grub是如何知道应该把这个文件加载到我们定义的0x4000000地址上的","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1645324463,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2726911,"avatar":"https://static001.geekbang.org/account/avatar/00/29/9b/ff/6d735175.jpg","nickname":"笑点","note":"","ucode":"6AF80A979B2386","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1183783,"avatar":"https://static001.geekbang.org/account/avatar/00/12/10/27/97afaf66.jpg","nickname":"肉丝炒青椒","note":"","ucode":"E67203E5B23D5D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":569676,"discussion_content":"兄弟有答案了吗？我也有这个疑问，网上也搜不到答案","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651507967,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":552144,"ip_address":""},"score":569676,"extra":""}]}]},{"had_liked":false,"id":333948,"user_name":"一叉树","can_delete":false,"product_type":"c1","uid":1623117,"ip_address":"","ucode":"BFC984403ACD1F","user_header":"https://static001.geekbang.org/account/avatar/00/18/c4/4d/85014aab.jpg","comment_is_top":false,"comment_ctime":1644633870,"is_pvip":true,"replies":[{"id":"122016","content":"好的  谢谢 我看看","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1644729524,"ip_address":"","comment_id":333948,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1644633870","product_id":100078401,"comment_content":"本文中 initldr32.asm，对应仓库代码中的 ldrkrl32.asm，注意文件名。应该是仓库代码更新了，文案没有更新。麻烦助教看看~","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550766,"discussion_content":"好的  谢谢 我看看","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644729524,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":333665,"user_name":"peuei","can_delete":false,"product_type":"c1","uid":1024661,"ip_address":"","ucode":"044AB69B04F624","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a2/95/16d1f895.jpg","comment_is_top":false,"comment_ctime":1644463899,"is_pvip":true,"replies":[{"id":"121983","content":"自己定义的","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1644639122,"ip_address":"","comment_id":333665,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1644463899","product_id":100078401,"comment_content":"请问老师，MDC_ENDGIC和MDC_RVGIC这两个校验数是怎么来的呢？是eki规范还是自定义的？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550616,"discussion_content":"自己定义的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644639122,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":333318,"user_name":"leven87","can_delete":false,"product_type":"c1","uid":1129272,"ip_address":"","ucode":"1486154E5FA4DE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/I807iciatNXWV1FNp2lkfKn9a0xHCYwVYibZv46GFprxibeg72icMZ5gLicP3XicnVsNv4Eo1hs1SmlDLMnU3XT5xHhQA/132","comment_is_top":false,"comment_ctime":1644286850,"is_pvip":false,"replies":[{"id":"121859","content":"应该是没有lmkfbuild程序","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1644378799,"ip_address":"","comment_id":333318,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1644286850","product_id":100078401,"comment_content":"你好，作者，我在进入代码目录，使用 sudo make all 命令后，出现如下错误。<br>.&#47;lmkfbuild: 1: .&#47;lmkfbuild: ELF: not found<br>.&#47;lmkfbuild: 2: .&#47;lmkfbuild: ot found<br>.&#47;lmkfbuild: 2: .&#47;lmkfbuild: Syntax error: Unterminated quoted string<br><br>系统是windows下的ubuntu18.04虚拟机。","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550086,"discussion_content":"应该是没有lmkfbuild程序","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644378799,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2519235,"avatar":"https://static001.geekbang.org/account/avatar/00/26/70/c3/cc46c55a.jpg","nickname":"MONKEYG","note":"","ucode":"81C780AA899A9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":561033,"discussion_content":"您好，请问你解决了么\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649516881,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":333132,"user_name":"Geek_fad810","can_delete":false,"product_type":"c1","uid":2864155,"ip_address":"","ucode":"6ADA4BEB3E4349","user_header":"","comment_is_top":false,"comment_ctime":1644120749,"is_pvip":false,"replies":[{"id":"121781","content":"是可以的","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1644284513,"ip_address":"","comment_id":333132,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1644120749","product_id":100078401,"comment_content":"老师问个问题，如果使用Multiboot标准提供的Memory Map是不是就不需要进入实模式使用中断获取了？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549863,"discussion_content":"是可以的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644284513,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328106,"user_name":"申龙青","can_delete":false,"product_type":"c1","uid":2615938,"ip_address":"","ucode":"688098EA258849","user_header":"https://static001.geekbang.org/account/avatar/00/27/ea/82/f44cbd20.jpg","comment_is_top":false,"comment_ctime":1640532290,"is_pvip":false,"replies":[{"id":"119661","content":"第一级引导器是GRUB","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1640768520,"ip_address":"","comment_id":328106,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1640532290","product_id":100078401,"comment_content":"请问下引导器这个“二级”是怎么理解的","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542499,"discussion_content":"第一级引导器是GRUB","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640768520,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324851,"user_name":"kocgockohgoh王裒","can_delete":false,"product_type":"c1","uid":2617112,"ip_address":"","ucode":"35EFABDE0D713D","user_header":"https://static001.geekbang.org/account/avatar/00/27/ef/18/6a620733.jpg","comment_is_top":false,"comment_ctime":1638687683,"is_pvip":false,"replies":[{"id":"117875","content":"不是","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1638753269,"ip_address":"","comment_id":324851,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1638687683","product_id":100078401,"comment_content":"define IMGFILE_PHYADR 0x4000000  请问这个是grub默认的加载映像的地址么","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536283,"discussion_content":"不是","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638753269,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1058856,"avatar":"https://static001.geekbang.org/account/avatar/00/10/28/28/5ffdd123.jpg","nickname":"漫游者","note":"","ucode":"7402D9068413D5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543525,"discussion_content":"在链接的时候指定的位置，搜一下代码就知道了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641194414,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324809,"user_name":"kocgockohgoh王裒","can_delete":false,"product_type":"c1","uid":2617112,"ip_address":"","ucode":"35EFABDE0D713D","user_header":"https://static001.geekbang.org/account/avatar/00/27/ef/18/6a620733.jpg","comment_is_top":false,"comment_ctime":1638634265,"is_pvip":false,"replies":[{"id":"117877","content":"不一样的","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1638753338,"ip_address":"","comment_id":324809,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1638634265","product_id":100078401,"comment_content":"请问   函数的gdt应该是ldrkrl.asm里面的 不是imginithead.asm里面的吧 realadr_call_entry这个函数不是在ldrkrl.asm定义的么  另外  为什么要用两个版本的gdt啊","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536285,"discussion_content":"不一样的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638753338,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":322433,"user_name":"任国宁","can_delete":false,"product_type":"c1","uid":1960963,"ip_address":"","ucode":"FE47D8DB5FA4C7","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoXoqDLvF3l8OzIwDBVlbgZ2FtbPFoncicFjQPqMFkKqdG5BnRVIxxrN40zUhTkynsd6yLhqqYiblAQ/132","comment_is_top":false,"comment_ctime":1637383272,"is_pvip":false,"replies":[{"id":"117115","content":"可以指定的","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1637543607,"ip_address":"","comment_id":322433,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1637383272","product_id":100078401,"comment_content":"C语言mmap函数调用了汇编方法realadr_call_entry，并传入了3个参数；<br>realadr_call_entry(RLINTNR(0), 0, 0);<br><br>其中汇编方法real_entry中说ax寄存器是C函数传递过来的，但是c语言函数调用参数传递不是使用di、si、dx三个寄存器吗（本地用gcc验证的参数传递），ax寄存器中的数据是怎么传递的呐？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":532133,"discussion_content":"可以指定的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637543607,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":321367,"user_name":"安之若素","can_delete":false,"product_type":"c1","uid":2805095,"ip_address":"","ucode":"3B407E50680740","user_header":"https://static001.geekbang.org/account/avatar/00/2a/cd/67/8e8e65ce.jpg","comment_is_top":false,"comment_ctime":1636814601,"is_pvip":false,"replies":[{"id":"116765","content":"不同的代码模块自然要换GDT 保证不出问题","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1636940793,"ip_address":"","comment_id":321367,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1636814601","product_id":100078401,"comment_content":"代码模块的改变那一块不是很理解，为什么需要重新读取GDT等信息","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530281,"discussion_content":"不同的代码模块自然要换GDT 保证不出问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636940793,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1556769,"avatar":"https://static001.geekbang.org/account/avatar/00/17/c1/21/f17cfee2.jpg","nickname":"__jiel__","note":"","ucode":"88CB168893A726","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":583371,"discussion_content":"老师，这里还是不能理解为什么要重新加载GDT。\n第一次加载不就把描述符的地址放到GDTR寄存器了吗，后面又没有动过GDTR。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660057895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":530281,"ip_address":"广东"},"score":583371,"extra":""}]}]},{"had_liked":false,"id":320634,"user_name":"不写出操作系统不改名","can_delete":false,"product_type":"c1","uid":2834444,"ip_address":"","ucode":"DD40D98250B688","user_header":"https://static001.geekbang.org/account/avatar/00/2b/40/0c/19b4224a.jpg","comment_is_top":false,"comment_ctime":1636428960,"is_pvip":false,"replies":[{"id":"116317","content":"objcopy","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1636506151,"ip_address":"","comment_id":320634,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1636428960","product_id":100078401,"comment_content":"想问一下，内核镜像文件中的4K大小的GRUB头里面的数据是在哪里产生的？<br>内核镜像文件是一个bin文件。是使用lmoskrlimg这个命令把grub头文件合并到最终的bin里面去的。<br>lmoskrlimg -m k -lhf GRUB头文件 -o 映像文件 -f 输入的文件列表<br>而grub头文件是由imginithead.asm和inithead.c这两个源文件编译后生成的。只在imginithead.asm中看到了有定义grub和grub2的结构体，但是这个结构体是使用伪指令dd定义在内存里的。我的疑问是如何把内存中的grub和grub2结构数据转换为bin的文件内容的呢？或者是说，initldrimh.bin这个文件本身没有直接保存grub和grub2的数据结构，而是保留了在内存中创建grub和grub2的方法?","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530071,"discussion_content":"objcopy","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636506151,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2834444,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/40/0c/19b4224a.jpg","nickname":"不写出操作系统不改名","note":"","ucode":"DD40D98250B688","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":413956,"discussion_content":"后来仔细看了一下。原来定义grub和grub2的那些头结构的时候，使用的是section .text，就是说把grub和grub2的头结构定义在了代码。之前想当然的认为使用db就是定义在了数据段里面了。反汇编initldrimh.bin后可以看到从0x4000004开始就依次是grub和grub2的数据结构了。除了0x4000000的地方外，只看左边的机器码，右边根据机器码识别的汇编语句是不对的。\n  2 initldrimh.elf:     file format elf32-i386\n  3 \n  4 \n  5 Disassembly of section .text:\n  6 \n  7 04000000 <.text>:\n  8  4000000: eb 66                 jmp    0x4000068\n  9  4000002: 90                    nop\n 10  4000003: 90                    nop\n 11  4000004: 02 b0 ad 1b 03 00     add    0x31bad(%eax),%dh\n 12  400000a: 01 00                 add    %eax,(%eax)\n 13  400000c: fb                    sti\n 14  400000d: 4f                    dec    %edi\n 15  400000e: 51                    push   %ecx\n 16  400000f: e4 04                 in     $0x4,%al\n 17  4000011: 00 00                 add    %al,(%eax)\n 18  4000013: 04 00                 add    $0x0,%al\n 19  4000015: 00 00                 add    %al,(%eax)\n 20  4000017: 04 00                 add    $0x0,%al\n 21  4000019: 00 00                 add    %al,(%eax)\n 22  400001b: 00 00                 add    %al,(%eax)\n 23  400001d: 00 00                 add    %al,(%eax)\n 24  400001f: 00 68 00              add    %ch,0x0(%eax)\n 25  4000022: 00 04 90              add    %al,(%eax,%edx,4)\n...\n=========================\n现在比较好奇，grub是怎么从bin文件里面识别出这个头结构的，grub并不知道这个头结构是从多少偏移地址开始，莫非是挨个字节判断的？\nhttps://www.gnu.org/software/grub/manual/multiboot/multiboot.html#Boot-sources从这个grub的官方链接可以看到，他们也是这么用的，先放一个跳转，然后是Multiboot header。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636618981,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":319392,"user_name":"178","can_delete":false,"product_type":"c1","uid":1090075,"ip_address":"","ucode":"3B0266F6BD06AE","user_header":"https://static001.geekbang.org/account/avatar/00/10/a2/1b/7426e629.jpg","comment_is_top":false,"comment_ctime":1635773956,"is_pvip":false,"replies":[{"id":"115781","content":"哈哈 需要硬件体系的知识","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1635813036,"ip_address":"","comment_id":319392,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1635773956","product_id":100078401,"comment_content":"这一节大概意思懂，就是不知道该怎么上手操作。ps：感谢《汇编语言》，要不然中断这一块根本不知道在说什么","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529619,"discussion_content":"哈哈 需要硬件体系的知识","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635813036,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":317742,"user_name":"TheOne","can_delete":false,"product_type":"c1","uid":1067830,"ip_address":"","ucode":"474CD3FFECF7B2","user_header":"https://static001.geekbang.org/account/avatar/00/10/4b/36/7c44be55.jpg","comment_is_top":false,"comment_ctime":1634915676,"is_pvip":false,"replies":[{"id":"115361","content":"是 自定义的","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1635211408,"ip_address":"","comment_id":317742,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1634915676","product_id":100078401,"comment_content":"IMGFILE_PHYADR 0x4000000 这个值是怎么来的？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528953,"discussion_content":"是 自定义的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635211408,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2617112,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ef/18/6a620733.jpg","nickname":"kocgockohgoh王裒","note":"","ucode":"35EFABDE0D713D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536100,"discussion_content":"我猜应该是multiboot header  mbt_hbr 下面指定了load_address是_start, 然后又在initldrimh.lds中指定了编译器将_start地址设为0x4000000, 即     .=0x4000000   _start_ldr.......","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1638689102,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":317172,"user_name":"Dingo","can_delete":false,"product_type":"c1","uid":2585973,"ip_address":"","ucode":"6C6B1571069963","user_header":"https://static001.geekbang.org/account/avatar/00/27/75/75/d08ee5b1.jpg","comment_is_top":false,"comment_ctime":1634699710,"is_pvip":false,"replies":[{"id":"115372","content":"不在这里开中断的 把系统初始化完成了 才会开","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1635212033,"ip_address":"","comment_id":317172,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1634699710","product_id":100078401,"comment_content":"不太懂汇编语言，为啥cli指令屏蔽中断后，加载了GDT，但后面又没有sti指令开启中断呢?","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528698,"discussion_content":"不在这里开中断的 把系统初始化完成了 才会开","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635212033,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":316728,"user_name":"我为什么这么菜","can_delete":false,"product_type":"c1","uid":2379061,"ip_address":"","ucode":"554C3F3300F1D5","user_header":"","comment_is_top":false,"comment_ctime":1634527548,"is_pvip":false,"replies":[{"id":"114793","content":"是的 是的","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1634689279,"ip_address":"","comment_id":316728,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1634527548","product_id":100078401,"comment_content":"关键流程：<br>    1、进入GRUB后从映像文件找到二级引导器的核心文件 - initldrkrl.bin，并把它放到特定的内存地址上<br>    2、跳转到二级引导器核心文件所在的物理内存上，开始执行二级引导器的主函数<br>步骤依赖：<br>    由于在二级引导器的主函数中，是处于32位保护模式。而在此执行一些步骤需要用到 BIOS 中断，而BIOS中断则需要运行在16位实模式。此时就需要一个能将保护模式切换回实模式，并且调用中断处理函数的步骤。这个步骤就放在 ldrkrl32.asm 中的realadr_call_entry 和 realintsve.asm 中去完成","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528477,"discussion_content":"是的 是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634689279,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":313247,"user_name":"SinKitwah","can_delete":false,"product_type":"c1","uid":1478242,"ip_address":"","ucode":"BC39A39E17C95E","user_header":"https://static001.geekbang.org/account/avatar/00/16/8e/62/435148c1.jpg","comment_is_top":false,"comment_ctime":1632324323,"is_pvip":false,"replies":[{"id":"113462","content":"eki加载到了0x200000的地方，这个文件前4kb的空间是引导程序 所以eki文件的管理头的数据就在0x201000的地址上开始 ","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1632357301,"ip_address":"","comment_id":313247,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1632324323","product_id":100078401,"comment_content":"又一个地方比较疑惑的是MRDDSC_ADR=0x201000,为什么会有数据呢？什么时候加载进去的？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527291,"discussion_content":"eki加载到了0x200000的地方，这个文件前4kb的空间是引导程序 所以eki文件的管理头的数据就在0x201000的地址上开始 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632357301,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1024661,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a2/95/16d1f895.jpg","nickname":"peuei","note":"","ucode":"044AB69B04F624","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550282,"discussion_content":"MRDDSC_ADR不是等于0x4001000吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644466048,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2746132,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e7/14/7042884d.jpg","nickname":"雪狼","note":"","ucode":"E266EF62040634","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":400294,"discussion_content":"MRDDSC_ADR不是等于0x4001000吗？哪里决定了eki被加载到了这个地址？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633226678,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":313058,"user_name":"南城忆潇湘","can_delete":false,"product_type":"c1","uid":2738376,"ip_address":"","ucode":"95E0584C71BD7C","user_header":"https://static001.geekbang.org/account/avatar/00/29/c8/c8/d23a126b.jpg","comment_is_top":false,"comment_ctime":1632236773,"is_pvip":false,"replies":[{"id":"113421","content":"不是同一个 链接模块","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1632272231,"ip_address":"","comment_id":313058,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1632236773","product_id":100078401,"comment_content":"老师，有个问题:为什么fs.c文件和inithead.c文件里面都定义了 strcmpl函数，似乎不这样编译会有问题，头文件都包含在了cmctl里面了，为什么还要重复实现呢，一直没搞明白","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527214,"discussion_content":"不是同一个 链接模块","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632272231,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":313048,"user_name":"搬铁少年ai","can_delete":false,"product_type":"c1","uid":1031045,"ip_address":"","ucode":"01D4A830A088D7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bb/85/191eea69.jpg","comment_is_top":false,"comment_ctime":1632228930,"is_pvip":false,"replies":[{"id":"113422","content":"不是 不是 ","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1632272240,"ip_address":"","comment_id":313048,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1632228930","product_id":100078401,"comment_content":"请问为什么initldr32.asm中也要 jmp 0x200000 呢，这不是它本身模块的地址吗","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527210,"discussion_content":"不是 不是 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632272240,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":311894,"user_name":"ACfun","can_delete":false,"product_type":"c1","uid":2730917,"ip_address":"","ucode":"A33A15F3182869","user_header":"https://static001.geekbang.org/account/avatar/00/29/ab/a5/3c09e213.jpg","comment_is_top":false,"comment_ctime":1631524585,"is_pvip":false,"replies":[{"id":"113153","content":"不是已经写代码了吗","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1631753192,"ip_address":"","comment_id":311894,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1631524585","product_id":100078401,"comment_content":"我有个疑惑，理解这些过程就可以了还是要把这些代码保存在什么虚拟器用于自己的操作系统，如果要真的实现自己的二级引导器，具体怎么操作呢？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526783,"discussion_content":"不是已经写代码了吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631753192,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":311156,"user_name":"沈畅","can_delete":false,"product_type":"c1","uid":1077953,"ip_address":"","ucode":"7404E41356B36B","user_header":"https://static001.geekbang.org/account/avatar/00/10/72/c1/59509397.jpg","comment_is_top":false,"comment_ctime":1631089418,"is_pvip":true,"replies":[{"id":"112792","content":"不是","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1631150946,"ip_address":"","comment_id":311156,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1631089418","product_id":100078401,"comment_content":"_16_mode标号的下开始的代码虽然是16位的但是还是运行在保护模式下吧？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526498,"discussion_content":"不是","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631150946,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":310310,"user_name":"ljy","can_delete":false,"product_type":"c1","uid":2750435,"ip_address":"","ucode":"367C19D8F0FE87","user_header":"https://static001.geekbang.org/account/avatar/00/29/f7/e3/322425f4.jpg","comment_is_top":false,"comment_ctime":1630587850,"is_pvip":false,"replies":[{"id":"112428","content":"自己定义的","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1630631610,"ip_address":"","comment_id":310310,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1630587850","product_id":100078401,"comment_content":"请问，MRDDSC_ADR这个宏的值是怎么确定的呢？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526193,"discussion_content":"自己定义的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630631610,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":308285,"user_name":"Geek_41ac17","can_delete":false,"product_type":"c1","uid":2532163,"ip_address":"","ucode":"C5E4C8A2BC1D1F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKc2mia43C3uvJzsgXrsYrh96QichITEWCEu1dvGgNhiaIcaa92UM2nGArV0d8tic3PGGTjiagsvVqTe9w/132","comment_is_top":false,"comment_ctime":1629517019,"is_pvip":false,"replies":[{"id":"111666","content":"编译啊 ","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1629604444,"ip_address":"","comment_id":308285,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1629517019","product_id":100078401,"comment_content":"lmoskrlimg 这个命令使用不了，虽然在留言区看到了这个的源码在课程的配套代码中，但是还是不知道如何安装使用。 目前已经生成了第一步骤的三个文件，不知道如何打包","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525451,"discussion_content":"编译啊 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629604444,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"听水的湖","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390967,"discussion_content":"lmoskrling是老师自己实现的工具，在Giteee文件夹tools找下。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630203586,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":306620,"user_name":"Solitude","can_delete":false,"product_type":"c1","uid":2165463,"ip_address":"","ucode":"32A7244D08F72A","user_header":"https://static001.geekbang.org/account/avatar/00/21/0a/d7/65d5f8a5.jpg","comment_is_top":false,"comment_ctime":1628647947,"is_pvip":false,"replies":[{"id":"111164","content":"回头去看看 CPU 工作模式 ","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1628824579,"ip_address":"","comment_id":306620,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1628647947","product_id":100078401,"comment_content":"jmp dword 0x8 :_32bits_mode ；长跳转刷新CS影子寄存器 这个怎么理解？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524843,"discussion_content":"回头去看看 CPU 工作模式 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628824579,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2064750,"avatar":"","nickname":"springXu","note":"","ucode":"F5DB0B963C894F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388244,"discussion_content":"cs程序可见的的只有16位两个字节的空间的寄存器。 这句是cs的值赋值成8。这个寻址过程是从GDT全局描述符表里加载第8个字节长度为8个字节64位的描述符。 从程序的gdt中可以发现值是00cf000000ffff，这个值被cpu写到了与cs附近的程序不可见的64位8字节的影子寄存器中，这是为了加速对内存的访问，不用每次都从全局描述符表来查询了。  有了这个描述符00cf000000ffff可以得到是从内存0地址开始到ffffffff-1结束的内存段。 _32bits_mode这个值被赋值到eip寄存器上。   这个过程是保护下的，长模式描述符中的段不起作用了，直接是一个大段模式与rip，其他过程相同的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628666049,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":304739,"user_name":"yf","can_delete":false,"product_type":"c1","uid":2636690,"ip_address":"","ucode":"4D81F5FD54C7FC","user_header":"https://static001.geekbang.org/account/avatar/00/28/3b/92/d018ecbb.jpg","comment_is_top":false,"comment_ctime":1627571573,"is_pvip":false,"replies":[{"id":"110241","content":"GDT是一个表，保存在内存中，第一次GDT是GRUB的，你不知道它在哪里 ，操作内存容易覆盖掉 ，第二次是我们自己的GDT，我们知道 它在哪里","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1627607787,"ip_address":"","comment_id":304739,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1627571573","product_id":100078401,"comment_content":"老师，有几个问题想请教一下：<br>1. 在initldr32.asm entry之后，会要重新加载GDT、IDT，因为模块发生了变化，是指程序的段发生了变化吗？还是什么意思？GDT在什么情况下会发生改变呢？，为什么要切两次保护模式呢？<br>2.您在后面的realintsve.asm中说到，GDT 还是 imghead.asm 汇编代码文件中的 GDT，那么这个GDT和initldr32.asm的GDT有什么不一样呢？整个过程最终会重新执行到jmp 0x200000之后继续执行的GDT又是哪个GDT呢？是initldr32.asm的GDT吗？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524140,"discussion_content":"GDT是一个表，保存在内存中，第一次GDT是GRUB的，你不知道它在哪里 ，操作内存容易覆盖掉 ，第二次是我们自己的GDT，我们知道 它在哪里","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627607787,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":304595,"user_name":"TS想成为嵌入式大师","can_delete":false,"product_type":"c1","uid":2679665,"ip_address":"","ucode":"CFB2E30348F573","user_header":"https://static001.geekbang.org/account/avatar/00/28/e3/71/642edc63.jpg","comment_is_top":false,"comment_ctime":1627515498,"is_pvip":false,"replies":[{"id":"110188","content":"你要看看GDT 那个表 0、8、16、 24（0x18）、32  分别指向表中的项<br>","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1627521060,"ip_address":"","comment_id":304595,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1627515498","product_id":100078401,"comment_content":"这个 0x18 就是段描述索引（这个知识点不熟悉的话，你可以回看我们第五节课），它正是指向 GDT 中的 16 位代码段描述符。。。。老师能给我再详细讲讲这个0x18是咋指向后面的16位描述符的。。。我看了好多遍第五课还是晕头转向的","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524093,"discussion_content":"你要看看GDT 那个表 0、8、16、 24（0x18）、32  分别指向表中的项\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627521060,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2679665,"avatar":"https://static001.geekbang.org/account/avatar/00/28/e3/71/642edc63.jpg","nickname":"TS想成为嵌入式大师","note":"","ucode":"CFB2E30348F573","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386458,"discussion_content":"具体是GDT哪个表？我找了好久也没看到有老师描述的这个内容","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627603123,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":304322,"user_name":"Zhendicai","can_delete":false,"product_type":"c1","uid":2536364,"ip_address":"","ucode":"6E1A8AE4C33CBE","user_header":"https://static001.geekbang.org/account/avatar/00/26/b3/ac/2c8baa5e.jpg","comment_is_top":false,"comment_ctime":1627354147,"is_pvip":false,"replies":[{"id":"110137","content":"这是一个叫lmoskrlimg工具写入的","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1627373092,"ip_address":"","comment_id":304322,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1627354147","product_id":100078401,"comment_content":"东哥可以给简单的说一下mlosrddsc_t这个结构体是在哪里写入的么？ 大概负责什么功能？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524014,"discussion_content":"这是一个叫lmoskrlimg工具写入的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627373092,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":303704,"user_name":"LargeOrange","can_delete":false,"product_type":"c1","uid":1226255,"ip_address":"","ucode":"CDDB0E6E4F09C8","user_header":"https://static001.geekbang.org/account/avatar/00/12/b6/0f/e3550f48.jpg","comment_is_top":false,"comment_ctime":1626937746,"is_pvip":true,"replies":[{"id":"109929","content":"加油加油，底层扎实了，理解各种技术都有加成。","user_name":"编辑回复","user_name_real":"赵宇新","uid":"1501385","ctime":1626945190,"ip_address":"","comment_id":303704,"utype":2}],"discussion_count":2,"race_medal":0,"score":"1626937746","product_id":100078401,"comment_content":"不会C也不会汇编，不过跟着东哥从底层开始理解操作系统挺有意思的<br>","like_count":0,"discussions":[{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"听水的湖","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523788,"discussion_content":"加油加油，底层扎实了，理解各种技术都有加成。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626945190,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2750435,"avatar":"https://static001.geekbang.org/account/avatar/00/29/f7/e3/322425f4.jpg","nickname":"ljy","note":"","ucode":"367C19D8F0FE87","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391365,"discussion_content":"偶遇大橙子学长","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630419341,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":302655,"user_name":"feihui","can_delete":false,"product_type":"c1","uid":1007294,"ip_address":"","ucode":"13F1D4A82BC650","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5e/be/9ea55f46.jpg","comment_is_top":false,"comment_ctime":1626318472,"is_pvip":true,"replies":[{"id":"109570","content":"用户代码 的权限 是不能执行 修改模式的指令的","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1626399209,"ip_address":"","comment_id":302655,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1626318472","product_id":100078401,"comment_content":"老师，想请教下，文章提到通过汇编切换工作模式，那如何禁止用户代码对工作模式的修改？有什么保护机制吗？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523375,"discussion_content":"用户代码 的权限 是不能执行 修改模式的指令的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626399209,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":300572,"user_name":"农夫龙泉","can_delete":false,"product_type":"c1","uid":1329912,"ip_address":"","ucode":"705A8E32C985EA","user_header":"https://static001.geekbang.org/account/avatar/00/14/4a/f8/ad6e804b.jpg","comment_is_top":false,"comment_ctime":1625220236,"is_pvip":false,"replies":[{"id":"108906","content":"哈哈 ","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1625221972,"ip_address":"","comment_id":300572,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1625220236","product_id":100078401,"comment_content":"大脑已经宕机。。。","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522766,"discussion_content":"哈哈 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625221972,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":299880,"user_name":"傅春啸","can_delete":false,"product_type":"c1","uid":2674472,"ip_address":"","ucode":"144DE575D6321D","user_header":"https://static001.geekbang.org/account/avatar/00/28/cf/28/6e45b5b2.jpg","comment_is_top":false,"comment_ctime":1624891851,"is_pvip":false,"replies":[{"id":"108759","content":"是的","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1624930188,"ip_address":"","comment_id":299880,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1624891851","product_id":100078401,"comment_content":"initldr32.asm的地址是0x20000吗？这个程序的执行顺序感觉有点看不懂哈哈","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522571,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624930188,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2729645,"avatar":"https://static001.geekbang.org/account/avatar/00/29/a6/ad/e65aec4c.jpg","nickname":"苏流郁宓","note":"","ucode":"AD07BD9CE03047","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":408178,"discussion_content":"0x20000=2x（16的4次方），等于4个4kb。老磁盘是512b分扇区，新磁盘有的好像4kb分扇区。这样内存地址好找磁盘信息的存储位置","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635186523,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":298315,"user_name":"bon","can_delete":false,"product_type":"c1","uid":2631565,"ip_address":"","ucode":"3A65AC6BFA191B","user_header":"https://static001.geekbang.org/account/avatar/00/28/27/8d/3b98880c.jpg","comment_is_top":false,"comment_ctime":1624010590,"is_pvip":false,"replies":[{"id":"108300","content":"安装了nasm吗","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1624181703,"ip_address":"","comment_id":298315,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1624010590","product_id":100078401,"comment_content":"请问老师，在initldr目录下执行make，出现报错：<br><br>Initldr:清理全部已构建文件... ^_^<br>*********正在开始编译构建系统*************<br>make[1]: nasm: No such file or directory<br>make[1]: *** [krnlbuidrule.mh:10: imginithead.o] Error 127<br>make: *** [Makefile:26: all] Error 2<br><br>请问是环境缺什么包吗？一直没有排查出问题","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522093,"discussion_content":"安装了nasm吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624181703,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":298306,"user_name":"Geek_032c4a","can_delete":false,"product_type":"c1","uid":1501316,"ip_address":"","ucode":"8CF7A8D681F15D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/dXf9e0gmVVV1ozqBIiaWiaxz1qgPZrYHT9x3ytnjfZ6quCH7gNtibXhsg66kH1E4FeTVHMB9J3PibNaMN2GthvceqA/132","comment_is_top":false,"comment_ctime":1624008547,"is_pvip":false,"replies":[{"id":"108301","content":"那个要废除的","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1624181736,"ip_address":"","comment_id":298306,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1624008547","product_id":100078401,"comment_content":"老师有个地方不太理解，进二级引导器的主模块那个地方为什么要重新装载下GDT，因为之前在imginithead.asm里面不是已经ldgt过了吗","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522090,"discussion_content":"那个要废除的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624181736,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":297566,"user_name":"熊三","can_delete":false,"product_type":"c1","uid":2048769,"ip_address":"","ucode":"9F35F5FDB70717","user_header":"https://static001.geekbang.org/account/avatar/00/1f/43/01/a8a65eea.jpg","comment_is_top":false,"comment_ctime":1623638785,"is_pvip":false,"replies":[{"id":"108058","content":"#define IMGKRNL_PHYADR 0x2000000  是内核映像的地址 ","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1623722880,"ip_address":"","comment_id":297566,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1623638785","product_id":100078401,"comment_content":"为什么文章inithead.c里的宏定义是#define IMGKRNL_PHYADR 0x2000000，在 imghead.asm 汇编文件代码中，最后一条指令是“jmp 0x200000”。","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521857,"discussion_content":"#define IMGKRNL_PHYADR 0x2000000  是内核映像的地址 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623722880,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296918,"user_name":"simon","can_delete":false,"product_type":"c1","uid":1829980,"ip_address":"","ucode":"81A1A1CD299C7A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eo7020l7kLf1JNSbNMkvpPaIsrkQ5op6qgWQEDdtZu3QyUc5zvC7yicVAJRUeI9fUgVc1ghliaGpRhQ/132","comment_is_top":false,"comment_ctime":1623224604,"is_pvip":false,"replies":[{"id":"107851","content":"不是的，代码是实践过程 ","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1623244969,"ip_address":"","comment_id":296918,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1623224604","product_id":100078401,"comment_content":"从这节开始是不是要把所有代码都看懂才能进行下一节，还是说先领悟过程，即使看不懂汇编也行","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521647,"discussion_content":"不是的，代码是实践过程 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623244969,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1829980,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eo7020l7kLf1JNSbNMkvpPaIsrkQ5op6qgWQEDdtZu3QyUc5zvC7yicVAJRUeI9fUgVc1ghliaGpRhQ/132","nickname":"simon","note":"","ucode":"81A1A1CD299C7A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378486,"discussion_content":"哦哦，就是理解整个引导过程是吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623245270,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296732,"user_name":"Panda","can_delete":false,"product_type":"c1","uid":1095740,"ip_address":"","ucode":"911A200C7B18BE","user_header":"https://static001.geekbang.org/account/avatar/00/10/b8/3c/1a294619.jpg","comment_is_top":false,"comment_ctime":1623136005,"is_pvip":false,"replies":[{"id":"107797","content":"生动形象，哈哈～","user_name":"编辑回复","user_name_real":"赵宇新","uid":"1501385","ctime":1623147108,"ip_address":"","comment_id":296732,"utype":2}],"discussion_count":1,"race_medal":0,"score":"1623136005","product_id":100078401,"comment_content":"像接力赛一样  一棒一棒传下去","like_count":0,"discussions":[{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"听水的湖","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521566,"discussion_content":"生动形象，哈哈～","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623147108,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296145,"user_name":"Freddy","can_delete":false,"product_type":"c1","uid":1708412,"ip_address":"","ucode":"5822B746265DB4","user_header":"https://static001.geekbang.org/account/avatar/00/1a/11/7c/bf5049b3.jpg","comment_is_top":false,"comment_ctime":1622775995,"is_pvip":false,"replies":[{"id":"107589","content":"我自带的有 直接使用就好，不用安装 的 ","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1622988768,"ip_address":"","comment_id":296145,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1622775995","product_id":100078401,"comment_content":"lmoskrlimg 这个命令怎么安装？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521337,"discussion_content":"我自带的有 直接使用就好，不用安装 的 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622988768,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295952,"user_name":"blentle","can_delete":false,"product_type":"c1","uid":1064679,"ip_address":"","ucode":"AC092609A4942A","user_header":"https://static001.geekbang.org/account/avatar/00/10/3e/e7/261711a5.jpg","comment_is_top":false,"comment_ctime":1622682039,"is_pvip":false,"replies":[{"id":"107599","content":"我不是有代码吗 ","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1622989301,"ip_address":"","comment_id":295952,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1622682039","product_id":100078401,"comment_content":"老师，有没有开源的二级引导器参考","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521276,"discussion_content":"我不是有代码吗 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622989301,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295880,"user_name":"尼欧","can_delete":false,"product_type":"c1","uid":1260883,"ip_address":"","ucode":"39D4D1F5F51764","user_header":"https://static001.geekbang.org/account/avatar/00/13/3d/53/9d8a1207.jpg","comment_is_top":false,"comment_ctime":1622628312,"is_pvip":false,"replies":[{"id":"107406","content":"加油，这周就要显示logo了，期待你也可以动手实现。","user_name":"编辑回复","user_name_real":"赵宇新","uid":"1501385","ctime":1622644588,"ip_address":"","comment_id":295880,"utype":2}],"discussion_count":1,"race_medal":0,"score":"1622628312","product_id":100078401,"comment_content":"打卡","like_count":0,"discussions":[{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"听水的湖","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521250,"discussion_content":"加油，这周就要显示logo了，期待你也可以动手实现。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622644588,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295859,"user_name":"二三子也","can_delete":false,"product_type":"c1","uid":1245787,"ip_address":"","ucode":"69C7D86583277D","user_header":"https://static001.geekbang.org/account/avatar/00/13/02/5b/ce326cfc.jpg","comment_is_top":false,"comment_ctime":1622621819,"is_pvip":false,"replies":[{"id":"107603","content":"哈哈<br>","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1622989519,"ip_address":"","comment_id":295859,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1622621819","product_id":100078401,"comment_content":"m2mcopy的代码前后拷贝的方式直接省略掉了边界检查。Good Taste.","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521243,"discussion_content":"哈哈\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622989519,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}