{"id":322365,"title":"42 | 借用检查：深入理解生命周期参数Tvs&T","content":"<p><strong>课件及Demo下载链接</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-Rust\">https://gitee.com/geektime-geekbang/geektime-Rust</a></p>","comments":[{"had_liked":false,"id":380016,"user_name":"沐浴露🧴","can_delete":false,"product_type":"c3","uid":1896587,"ip_address":"浙江","ucode":"CFAFDE6450BC2F","user_header":"https://static001.geekbang.org/account/avatar/00/1c/f0/8b/e307f616.jpg","comment_is_top":false,"comment_ctime":1692845223,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100060601,"comment_content":"hashSet 的 get请求 传入 &amp;copy 时返回为 Some(&amp;copy),调用Option的cloned方法后产生一个全新的copy，后续hashset调用 insert后发生的事 move语义。就不会产生生命周期问题。\n当get请求传入的为&amp;&amp;copy时返回为Some(&amp;&amp;copy),调用 Option的cloned方法后产生一个全新的指向copy的引用，调用insert方法后存在生命周期问题，由于for循环结束后，copy被释放，自然发生生命周期报错。","like_count":0},{"had_liked":false,"id":379983,"user_name":"沐浴露🧴","can_delete":false,"product_type":"c3","uid":1896587,"ip_address":"浙江","ucode":"CFAFDE6450BC2F","user_header":"https://static001.geekbang.org/account/avatar/00/1c/f0/8b/e307f616.jpg","comment_is_top":false,"comment_ctime":1692785156,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100060601,"comment_content":"我觉得完全是clone的问题吧。\n从hashset的get方法和后续的clone方法来看\n1. &amp;Q=&amp;copy 时 get方法返回 &amp;copy，调用 clone 后返回一个新的copy，后续调用insert后发生move不存在生命周期问题\n2. &amp;Q=&amp;&amp;copy 时 get 方法返回 &amp;&amp;copy，调用clone 返回一个&amp;copy，insert插入后，后续发生生命周期过短问题。","like_count":0},{"had_liked":false,"id":332004,"user_name":"foobar","can_delete":false,"product_type":"c3","uid":2631847,"ip_address":"","ucode":"72E984EC80EBC3","user_header":"https://static001.geekbang.org/account/avatar/00/28/28/a7/1f6a6c5f.jpg","comment_is_top":false,"comment_ctime":1642955490,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100060601,"comment_content":"9:58秒讲的不对吧?参考生命周期省略规则, HashSet的get方法中存在&amp;self,所以self的生命周期将自动赋予返回的Option&lt;&amp;T&gt;.\n而value:&amp;Q应该具有自己独立的生命周期.\ncopy生命周期不够长,主要还是因为T:Borrow&lt;Q&gt;导致的","like_count":0},{"had_liked":false,"id":307243,"user_name":"神 一生有你","can_delete":false,"product_type":"c3","uid":1047574,"ip_address":"","ucode":"423AD11359E265","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fc/16/0a3f1c15.jpg","comment_is_top":false,"comment_ctime":1628964659,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100060601,"comment_content":"copy_str的&amp;变量定义是{&#47;&#47;&#39;c\n\nlet copy_str    这个变量范围&#47;&#47;&#39;c\nlet result=get(&amp;copy_str)&#47;&#47;&#39;c\nput(result)\n}&#47;&#47;&#39;c  over\n所以判断垂悬了\n而不加引用，就不走copy_str声明变量作用域，而走的&amp;str的作用域范围","like_count":0},{"had_liked":false,"id":296831,"user_name":"amao","can_delete":false,"product_type":"c3","uid":2286857,"ip_address":"","ucode":"0574E186844631","user_header":"https://static001.geekbang.org/account/avatar/00/22/e5/09/48865344.jpg","comment_is_top":false,"comment_ctime":1623184180,"is_pvip":false,"replies":null,"discussion_count":3,"race_medal":0,"score":2,"product_id":100060601,"comment_content":"有一说一，说实话，老师这里讲的没有原专栏以及专栏评论区讲的明白。关键点就在get函数中返回的Option&lt;&amp;T&gt;中的T绑定了Borrow&lt;Q&gt;，然后get的参数是&amp;Q。多加一个&amp;就变成了Borrow&lt;&amp;Q&gt;。Q和&amp;Q就和老师这里讲的呼应上了。具体细节请看原贴以及评论。谢谢老师领进门，respect","like_count":0,"discussions":[{"author":{"id":2843586,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/63/c2/83d737ff.jpg","nickname":"Amesy","note":"","ucode":"84D0B7D133520A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543374,"discussion_content":"这里的专栏指的是视频中代码示例对应的知乎专栏吧 https://zhuanlan.zhihu.com/p/194156624","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641113123,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1025680,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a6/90/5295fce8.jpg","nickname":"昵称","note":"","ucode":"FD6A58AB271E5D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":411627,"discussion_content":"同求","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635954146,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1229329,"avatar":"https://static001.geekbang.org/account/avatar/00/12/c2/11/323358ed.jpg","nickname":"wzx","note":"","ucode":"EBAD30BEE4E17D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":379868,"discussion_content":"原专栏？哪里？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624197031,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}