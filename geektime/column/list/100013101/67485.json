{"id":67485,"title":"42 | bufioåŒ…ä¸­çš„æ•°æ®ç±»å‹ ï¼ˆä¸Šï¼‰","content":"<p>ä»Šå¤©ï¼Œæˆ‘ä»¬æ¥è®²å¦ä¸€ä¸ªä¸I/Oæ“ä½œå¼ºç›¸å…³çš„ä»£ç åŒ…<code>bufio</code>ã€‚<code>bufio</code>æ˜¯â€œbuffered I/Oâ€çš„ç¼©å†™ã€‚é¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªä»£ç åŒ…ä¸­çš„ç¨‹åºå®ä½“å®ç°çš„I/Oæ“ä½œéƒ½å†…ç½®äº†ç¼“å†²åŒºã€‚</p><p><code>bufio</code>åŒ…ä¸­çš„æ•°æ®ç±»å‹ä¸»è¦æœ‰ï¼š</p><ol>\n<li><code>Reader</code>ï¼›</li>\n<li><code>Scanner</code>ï¼›</li>\n<li><code>Writer</code>å’Œ<code>ReadWriter</code>ã€‚</li>\n</ol><p>ä¸<code>io</code>åŒ…ä¸­çš„æ•°æ®ç±»å‹ç±»ä¼¼ï¼Œè¿™äº›ç±»å‹çš„å€¼ä¹Ÿéƒ½éœ€è¦åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼ŒåŒ…è£…ä¸€ä¸ªæˆ–å¤šä¸ªç®€å•I/Oæ¥å£ç±»å‹çš„å€¼ã€‚ï¼ˆè¿™é‡Œçš„ç®€å•I/Oæ¥å£ç±»å‹æŒ‡çš„å°±æ˜¯<code>io</code>åŒ…ä¸­çš„é‚£äº›ç®€å•æ¥å£ã€‚ï¼‰</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°†é€šè¿‡ä¸€ç³»åˆ—é—®é¢˜å¯¹<code>bufio.Reader</code>ç±»å‹å’Œ<code>bufio.Writer</code>ç±»å‹è¿›è¡Œè®¨è®ºï¼ˆä»¥å‰è€…ä¸ºä¸»ï¼‰ã€‚<strong>ä»Šå¤©æˆ‘çš„é—®é¢˜æ˜¯ï¼š<code>bufio.Reader</code>ç±»å‹å€¼ä¸­çš„ç¼“å†²åŒºèµ·ç€æ€æ ·çš„ä½œç”¨ï¼Ÿ</strong></p><p><strong>è¿™é“é¢˜çš„å…¸å‹å›ç­”æ˜¯è¿™æ ·çš„ã€‚</strong></p><p><code>bufio.Reader</code>ç±»å‹çš„å€¼ï¼ˆä»¥ä¸‹ç®€ç§°<code>Reader</code>å€¼ï¼‰å†…çš„ç¼“å†²åŒºï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªæ•°æ®å­˜å‚¨ä¸­ä»‹ï¼Œå®ƒä»‹äºåº•å±‚è¯»å–å™¨ä¸è¯»å–æ–¹æ³•åŠå…¶è°ƒç”¨æ–¹ä¹‹é—´ã€‚æ‰€è°“çš„åº•å±‚è¯»å–å™¨ï¼Œå°±æ˜¯åœ¨åˆå§‹åŒ–æ­¤ç±»å€¼çš„æ—¶å€™ä¼ å…¥çš„<code>io.Reader</code>ç±»å‹çš„å‚æ•°å€¼ã€‚</p><p><code>Reader</code>å€¼çš„è¯»å–æ–¹æ³•ä¸€èˆ¬éƒ½ä¼šå…ˆä»å…¶æ‰€å±å€¼çš„ç¼“å†²åŒºä¸­è¯»å–æ•°æ®ã€‚åŒæ—¶ï¼Œåœ¨å¿…è¦çš„æ—¶å€™ï¼Œå®ƒä»¬è¿˜ä¼šé¢„å…ˆä»åº•å±‚è¯»å–å™¨é‚£é‡Œè¯»å‡ºä¸€éƒ¨åˆ†æ•°æ®ï¼Œå¹¶æš‚å­˜äºç¼“å†²åŒºä¹‹ä¸­ä»¥å¤‡åç”¨ã€‚</p><!-- [[[read_end]]] --><p>æœ‰è¿™æ ·ä¸€ä¸ªç¼“å†²åŒºçš„å¥½å¤„æ˜¯ï¼Œå¯ä»¥åœ¨å¤§å¤šæ•°çš„æ—¶å€™é™ä½è¯»å–æ–¹æ³•çš„æ‰§è¡Œæ—¶é—´ã€‚è™½ç„¶ï¼Œè¯»å–æ–¹æ³•æœ‰æ—¶è¿˜è¦è´Ÿè´£å¡«å……ç¼“å†²åŒºï¼Œä½†ä»æ€»ä½“æ¥çœ‹ï¼Œè¯»å–æ–¹æ³•çš„å¹³å‡æ‰§è¡Œæ—¶é—´ä¸€èˆ¬éƒ½ä¼šå› æ­¤æœ‰å¤§å¹…åº¦çš„ç¼©çŸ­ã€‚</p><h2>é—®é¢˜è§£æ</h2><p><code>bufio.Reader</code>ç±»å‹å¹¶ä¸æ˜¯å¼€ç®±å³ç”¨çš„ï¼Œå› ä¸ºå®ƒåŒ…å«äº†ä¸€äº›éœ€è¦æ˜¾å¼åˆå§‹åŒ–çš„å­—æ®µã€‚ä¸ºäº†è®©ä½ èƒ½åœ¨åé¢æ›´å¥½åœ°ç†è§£å®ƒçš„è¯»å–æ–¹æ³•çš„å†…éƒ¨æµç¨‹ï¼Œæˆ‘å…ˆåœ¨è¿™é‡Œç®€è¦åœ°è§£é‡Šä¸€ä¸‹è¿™äº›å­—æ®µï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><ol>\n<li><code>buf</code>ï¼š<code>[]byte</code>ç±»å‹çš„å­—æ®µï¼Œå³å­—èŠ‚åˆ‡ç‰‡ï¼Œä»£è¡¨ç¼“å†²åŒºã€‚è™½ç„¶å®ƒæ˜¯åˆ‡ç‰‡ç±»å‹çš„ï¼Œä½†æ˜¯å…¶é•¿åº¦å´ä¼šåœ¨åˆå§‹åŒ–çš„æ—¶å€™æŒ‡å®šï¼Œå¹¶åœ¨ä¹‹åä¿æŒä¸å˜ã€‚</li>\n<li><code>rd</code>ï¼š<code>io.Reader</code>ç±»å‹çš„å­—æ®µï¼Œä»£è¡¨åº•å±‚è¯»å–å™¨ã€‚ç¼“å†²åŒºä¸­çš„æ•°æ®å°±æ˜¯ä»è¿™é‡Œæ‹·è´æ¥çš„ã€‚</li>\n<li><code>r</code>ï¼š<code>int</code>ç±»å‹çš„å­—æ®µï¼Œä»£è¡¨å¯¹ç¼“å†²åŒºè¿›è¡Œä¸‹ä¸€æ¬¡è¯»å–æ—¶çš„å¼€å§‹ç´¢å¼•ã€‚æˆ‘ä»¬å¯ä»¥ç§°å®ƒä¸ºå·²è¯»è®¡æ•°ã€‚</li>\n<li><code>w</code>ï¼š<code>int</code>ç±»å‹çš„å­—æ®µï¼Œä»£è¡¨å¯¹ç¼“å†²åŒºè¿›è¡Œä¸‹ä¸€æ¬¡å†™å…¥æ—¶çš„å¼€å§‹ç´¢å¼•ã€‚æˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸ºå·²å†™è®¡æ•°ã€‚</li>\n<li><code>err</code>ï¼š<code>error</code>ç±»å‹çš„å­—æ®µã€‚å®ƒçš„å€¼ç”¨äºè¡¨ç¤ºåœ¨ä»åº•å±‚è¯»å–å™¨è·å¾—æ•°æ®æ—¶å‘ç”Ÿçš„é”™è¯¯ã€‚è¿™é‡Œçš„å€¼åœ¨è¢«è¯»å–æˆ–å¿½ç•¥ä¹‹åï¼Œè¯¥å­—æ®µä¼šè¢«ç½®ä¸º<code>nil</code>ã€‚</li>\n<li><code>lastByte</code>ï¼š<code>int</code>ç±»å‹çš„å­—æ®µï¼Œç”¨äºè®°å½•ç¼“å†²åŒºä¸­æœ€åä¸€ä¸ªè¢«è¯»å–çš„å­—èŠ‚ã€‚è¯»å›é€€æ—¶ä¼šç”¨åˆ°å®ƒçš„å€¼ã€‚</li>\n<li><code>lastRuneSize</code>ï¼š<code>int</code>ç±»å‹çš„å­—æ®µï¼Œç”¨äºè®°å½•ç¼“å†²åŒºä¸­æœ€åä¸€ä¸ªè¢«è¯»å–çš„Unicodeå­—ç¬¦æ‰€å ç”¨çš„å­—èŠ‚æ•°ã€‚è¯»å›é€€çš„æ—¶å€™ä¼šç”¨åˆ°å®ƒçš„å€¼ã€‚è¿™ä¸ªå­—æ®µåªä¼šåœ¨å…¶æ‰€å±å€¼çš„<code>ReadRune</code>æ–¹æ³•ä¸­æ‰ä¼šè¢«èµ‹äºˆæœ‰æ„ä¹‰çš„å€¼ã€‚åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œå®ƒéƒ½ä¼šè¢«ç½®ä¸º<code>-1</code>ã€‚</li>\n</ol><p><code>bufio</code>åŒ…ä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ä¸ªç”¨äºåˆå§‹åŒ–<code>Reader</code>å€¼çš„å‡½æ•°ï¼Œåˆ†åˆ«å«ï¼š</p><ul>\n<li>\n<p><code>NewReader</code>ï¼›</p>\n</li>\n<li>\n<p><code>NewReaderSize</code>ï¼›</p>\n</li>\n</ul><p>å®ƒä»¬éƒ½ä¼šè¿”å›ä¸€ä¸ª<code>*bufio.Reader</code>ç±»å‹çš„å€¼ã€‚</p><p><code>NewReader</code>å‡½æ•°åˆå§‹åŒ–çš„<code>Reader</code>å€¼ä¼šæ‹¥æœ‰ä¸€ä¸ªé»˜è®¤å°ºå¯¸çš„ç¼“å†²åŒºã€‚è¿™ä¸ªé»˜è®¤å°ºå¯¸æ˜¯4096ä¸ªå­—èŠ‚ï¼Œå³ï¼š4 KBã€‚è€Œ<code>NewReaderSize</code>å‡½æ•°åˆ™å°†ç¼“å†²åŒºå°ºå¯¸çš„å†³å®šæƒæŠ›ç»™äº†ä½¿ç”¨æ–¹ã€‚</p><p>ç”±äºè¿™é‡Œçš„ç¼“å†²åŒºåœ¨ä¸€ä¸ª<code>Reader</code>å€¼çš„ç”Ÿå‘½å‘¨æœŸå†…å…¶å°ºå¯¸ä¸å¯å˜ï¼Œæ‰€ä»¥åœ¨æœ‰äº›æ—¶å€™æ˜¯éœ€è¦åšä¸€äº›æƒè¡¡çš„ã€‚<code>NewReaderSize</code>å‡½æ•°å°±æä¾›äº†è¿™æ ·ä¸€ä¸ªé€”å¾„ã€‚</p><p>åœ¨<code>bufio.Reader</code>ç±»å‹æ‹¥æœ‰çš„è¯»å–æ–¹æ³•ä¸­ï¼Œ<code>Peek</code>æ–¹æ³•å’Œ<code>ReadSlice</code>æ–¹æ³•éƒ½ä¼šè°ƒç”¨è¯¥ç±»å‹ä¸€ä¸ªåä¸º<code>fill</code>çš„åŒ…çº§ç§æœ‰æ–¹æ³•ã€‚<code>fill</code>æ–¹æ³•çš„ä½œç”¨æ˜¯å¡«å……å†…éƒ¨ç¼“å†²åŒºã€‚æˆ‘ä»¬åœ¨è¿™é‡Œå°±å…ˆé‡ç‚¹è¯´è¯´å®ƒã€‚</p><p><code>fill</code>æ–¹æ³•ä¼šå…ˆæ£€æŸ¥å…¶æ‰€å±å€¼çš„å·²è¯»è®¡æ•°ã€‚å¦‚æœè¿™ä¸ªè®¡æ•°ä¸å¤§äº<code>0</code>ï¼Œé‚£ä¹ˆæœ‰ä¸¤ç§å¯èƒ½ã€‚</p><p>ä¸€ç§å¯èƒ½æ˜¯å…¶ç¼“å†²åŒºä¸­çš„å­—èŠ‚éƒ½æ˜¯å…¨æ–°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬éƒ½æ²¡æœ‰è¢«è¯»å–è¿‡ï¼Œå¦ä¸€ç§å¯èƒ½æ˜¯ç¼“å†²åŒºåˆšè¢«å‹ç¼©è¿‡ã€‚</p><p>å¯¹ç¼“å†²åŒºçš„å‹ç¼©åŒ…æ‹¬ä¸¤ä¸ªæ­¥éª¤ã€‚<strong>ç¬¬ä¸€æ­¥ï¼ŒæŠŠç¼“å†²åŒºä¸­åœ¨<code>[å·²è¯»è®¡æ•°, å·²å†™è®¡æ•°)</code>èŒƒå›´ä¹‹å†…çš„æ‰€æœ‰å…ƒç´ å€¼ï¼ˆæˆ–è€…è¯´å­—èŠ‚ï¼‰éƒ½ä¾æ¬¡æ‹·è´åˆ°ç¼“å†²åŒºçš„å¤´éƒ¨ã€‚</strong></p><p>æ¯”å¦‚ï¼ŒæŠŠç¼“å†²åŒºä¸­ä¸å·²è¯»è®¡æ•°ä»£è¡¨çš„ç´¢å¼•å¯¹åº”å­—èŠ‚æ‹·è´åˆ°ç´¢å¼•<code>0</code>çš„ä½ç½®ï¼Œå¹¶æŠŠç´§æŒ¨åœ¨å®ƒåè¾¹çš„å­—èŠ‚æ‹·è´åˆ°ç´¢å¼•<code>1</code>çš„ä½ç½®ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><p>è¿™ä¸€æ­¥ä¹‹æ‰€ä»¥ä¸ä¼šæœ‰ä»»ä½•å‰¯ä½œç”¨ï¼Œæ˜¯å› ä¸ºå®ƒåŸºäºä¸¤ä¸ªäº‹å®ã€‚</p><p><strong>ç¬¬ä¸€äº‹å®ï¼Œ</strong>å·²è¯»è®¡æ•°ä¹‹å‰çš„å­—èŠ‚éƒ½å·²ç»è¢«è¯»å–è¿‡ï¼Œå¹¶ä¸”è‚¯å®šä¸ä¼šå†è¢«è¯»å–äº†ï¼Œå› æ­¤æŠŠå®ƒä»¬è¦†ç›–æ‰æ˜¯å®‰å…¨çš„ã€‚</p><p><strong>ç¬¬äºŒä¸ªäº‹å®ï¼Œ</strong>åœ¨å‹ç¼©ç¼“å†²åŒºä¹‹åï¼Œå·²å†™è®¡æ•°ä¹‹åçš„å­—èŠ‚åªå¯èƒ½æ˜¯å·²è¢«è¯»å–è¿‡çš„å­—èŠ‚ï¼Œæˆ–è€…æ˜¯å·²è¢«æ‹·è´åˆ°ç¼“å†²åŒºå¤´éƒ¨çš„æœªè¯»å­—èŠ‚ï¼Œåˆæˆ–è€…æ˜¯ä»£è¡¨æœªæ›¾è¢«å¡«å…¥æ•°æ®çš„é›¶å€¼<code>0x00</code>ã€‚æ‰€ä»¥ï¼Œåç»­çš„æ–°å­—èŠ‚æ˜¯å¯ä»¥è¢«å†™åˆ°è¿™äº›ä½ç½®ä¸Šçš„ã€‚</p><p><strong>åœ¨å‹ç¼©ç¼“å†²åŒºçš„ç¬¬äºŒæ­¥ä¸­ï¼Œ<code>fill</code>æ–¹æ³•ä¼šæŠŠå·²å†™è®¡æ•°çš„æ–°å€¼è®¾å®šä¸ºåŸå·²å†™è®¡æ•°ä¸åŸå·²è¯»è®¡æ•°çš„å·®ã€‚è¿™ä¸ªå·®æ‰€ä»£è¡¨çš„ç´¢å¼•ï¼Œå°±æ˜¯å‹ç¼©åç¬¬ä¸€æ¬¡å†™å…¥å­—èŠ‚æ—¶çš„å¼€å§‹ç´¢å¼•ã€‚</strong></p><p>å¦å¤–ï¼Œè¯¥æ–¹æ³•è¿˜ä¼šæŠŠå·²è¯»è®¡æ•°çš„å€¼ç½®ä¸º<code>0</code>ã€‚æ˜¾è€Œæ˜“è§ï¼Œåœ¨å‹ç¼©ä¹‹åï¼Œå†è¯»å–å­—èŠ‚å°±è‚¯å®šè¦ä»ç¼“å†²åŒºçš„å¤´éƒ¨å¼€å§‹è¯»äº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/68/84/687b56d4137ea4d01e0b20d259f91284.png?wh=1920*934\" alt=\"\"></p><p>ï¼ˆbufio.Readerä¸­çš„ç¼“å†²åŒºå‹ç¼©ï¼‰</p><p>å®é™…ä¸Šï¼Œ<code>fill</code>æ–¹æ³•åªè¦åœ¨å¼€å§‹æ—¶å‘ç°å…¶æ‰€å±å€¼çš„å·²è¯»è®¡æ•°å¤§äº<code>0</code>ï¼Œå°±ä¼šå¯¹ç¼“å†²åŒºè¿›è¡Œä¸€æ¬¡å‹ç¼©ã€‚ä¹‹åï¼Œå¦‚æœç¼“å†²åŒºä¸­è¿˜æœ‰å¯å†™çš„ä½ç½®ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•å°±ä¼šå¯¹å…¶è¿›è¡Œå¡«å……ã€‚</p><p>åœ¨å¡«å……ç¼“å†²åŒºçš„æ—¶å€™ï¼Œ<code>fill</code>æ–¹æ³•ä¼šè¯•å›¾ä»åº•å±‚è¯»å–å™¨é‚£é‡Œï¼Œè¯»å–è¶³å¤Ÿå¤šçš„å­—èŠ‚ï¼Œå¹¶å°½é‡æŠŠä»å·²å†™è®¡æ•°ä»£è¡¨çš„ç´¢å¼•ä½ç½®åˆ°ç¼“å†²åŒºæœ«å°¾ä¹‹é—´çš„ç©ºé—´éƒ½å¡«æ»¡ã€‚</p><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ<code>fill</code>æ–¹æ³•ä¼šåŠæ—¶åœ°æ›´æ–°å·²å†™è®¡æ•°ï¼Œä»¥ä¿è¯å¡«å……çš„æ­£ç¡®æ€§å’Œé¡ºåºæ€§ã€‚å¦å¤–ï¼Œå®ƒè¿˜ä¼šåˆ¤æ–­ä»åº•å±‚è¯»å–å™¨è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œæ˜¯å¦æœ‰é”™è¯¯å‘ç”Ÿã€‚å¦‚æœæœ‰ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šæŠŠé”™è¯¯å€¼èµ‹ç»™å…¶æ‰€å±å€¼çš„<code>err</code>å­—æ®µï¼Œå¹¶ç»ˆæ­¢å¡«å……æµç¨‹ã€‚</p><p>å¥½äº†ï¼Œåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬æš‚å‘Šä¸€ä¸ªæ®µè½ã€‚åœ¨æœ¬é¢˜ä¸­ï¼Œæˆ‘å¯¹<code>bufio.Reader</code>ç±»å‹çš„åŸºæœ¬ç»“æ„ï¼Œä»¥åŠç›¸å…³çš„ä¸€äº›å‡½æ•°å’Œæ–¹æ³•è¿›è¡Œäº†æ¦‚æ‹¬ä»‹ç»ï¼Œå¹¶ä¸”é‡ç‚¹é˜è¿°äº†è¯¥ç±»å‹çš„<code>fill</code>æ–¹æ³•ã€‚</p><p>åè€…æ˜¯æˆ‘ä»¬åœ¨åé¢è¦è¯´æ˜çš„ä¸€äº›è¯»å–æµç¨‹çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚ä½ èµ·ç è¦è®°ä½çš„æ˜¯ï¼šè¿™ä¸ª<code>fill</code>æ–¹æ³•å¤§è‡´éƒ½åšäº†äº›ä»€ä¹ˆã€‚</p><h2>çŸ¥è¯†æ‰©å±•</h2><p>é—®é¢˜1ï¼š<code>bufio.Writer</code>ç±»å‹å€¼ä¸­ç¼“å†²çš„æ•°æ®ä»€ä¹ˆæ—¶å€™ä¼šè¢«å†™åˆ°å®ƒçš„åº•å±‚å†™å…¥å™¨ï¼Ÿ</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹<code>bufio.Writer</code>ç±»å‹éƒ½æœ‰å“ªäº›å­—æ®µï¼š</p><ol>\n<li><code>err</code>ï¼š<code>error</code>ç±»å‹çš„å­—æ®µã€‚å®ƒçš„å€¼ç”¨äºè¡¨ç¤ºåœ¨å‘åº•å±‚å†™å…¥å™¨å†™æ•°æ®æ—¶å‘ç”Ÿçš„é”™è¯¯ã€‚</li>\n<li><code>buf</code>ï¼š<code>[]byte</code>ç±»å‹çš„å­—æ®µï¼Œä»£è¡¨ç¼“å†²åŒºã€‚åœ¨åˆå§‹åŒ–ä¹‹åï¼Œå®ƒçš„é•¿åº¦ä¼šä¿æŒä¸å˜ã€‚</li>\n<li><code>n</code>ï¼š<code>int</code>ç±»å‹çš„å­—æ®µï¼Œä»£è¡¨å¯¹ç¼“å†²åŒºè¿›è¡Œä¸‹ä¸€æ¬¡å†™å…¥æ—¶çš„å¼€å§‹ç´¢å¼•ã€‚æˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸ºå·²å†™è®¡æ•°ã€‚</li>\n<li><code>wr</code>ï¼š<code>io.Writer</code>ç±»å‹çš„å­—æ®µï¼Œä»£è¡¨åº•å±‚å†™å…¥å™¨ã€‚</li>\n</ol><p><code>bufio.Writer</code>ç±»å‹æœ‰ä¸€ä¸ªåä¸º<code>Flush</code>çš„æ–¹æ³•ï¼Œå®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯æŠŠç›¸åº”ç¼“å†²åŒºä¸­æš‚å­˜çš„æ‰€æœ‰æ•°æ®ï¼Œéƒ½å†™åˆ°åº•å±‚å†™å…¥å™¨ä¸­ã€‚æ•°æ®ä¸€æ—¦è¢«å†™è¿›åº•å±‚å†™å…¥å™¨ï¼Œè¯¥æ–¹æ³•å°±ä¼šæŠŠå®ƒä»¬ä»ç¼“å†²åŒºä¸­åˆ é™¤æ‰ã€‚</p><p>ä¸è¿‡ï¼Œè¿™é‡Œçš„åˆ é™¤æœ‰æ—¶å€™åªæ˜¯é€»è¾‘ä¸Šçš„åˆ é™¤è€Œå·²ã€‚ä¸è®ºæ˜¯å¦æˆåŠŸåœ°å†™å…¥äº†æ‰€æœ‰çš„æš‚å­˜æ•°æ®ï¼Œ<code>Flush</code>æ–¹æ³•éƒ½ä¼šå¦¥å½“å¤„ç½®ï¼Œå¹¶ä¿è¯ä¸ä¼šå‡ºç°é‡å†™å’Œæ¼å†™çš„æƒ…å†µã€‚è¯¥ç±»å‹çš„å­—æ®µ<code>n</code>åœ¨æ­¤ä¼šèµ·åˆ°å¾ˆé‡è¦çš„ä½œç”¨ã€‚</p><p><code>bufio.Writer</code>ç±»å‹å€¼ï¼ˆä»¥ä¸‹ç®€ç§°<code>Writer</code>å€¼ï¼‰æ‹¥æœ‰çš„æ‰€æœ‰æ•°æ®å†™å…¥æ–¹æ³•éƒ½ä¼šåœ¨å¿…è¦çš„æ—¶å€™è°ƒç”¨å®ƒçš„<code>Flush</code>æ–¹æ³•ã€‚</p><p>æ¯”å¦‚ï¼Œ<code>Write</code>æ–¹æ³•æœ‰æ—¶å€™ä¼šåœ¨æŠŠæ•°æ®å†™è¿›ç¼“å†²åŒºä¹‹åï¼Œè°ƒç”¨<code>Flush</code>æ–¹æ³•ï¼Œä»¥ä¾¿ä¸ºåç»­çš„æ–°æ•°æ®è…¾å‡ºç©ºé—´ã€‚<code>WriteString</code>æ–¹æ³•çš„è¡Œä¸ºä¸ä¹‹ç±»ä¼¼ã€‚</p><p>åˆæ¯”å¦‚ï¼Œ<code>WriteByte</code>æ–¹æ³•å’Œ<code>WriteRune</code>æ–¹æ³•ï¼Œéƒ½ä¼šåœ¨å‘ç°ç¼“å†²åŒºä¸­çš„å¯å†™ç©ºé—´ä¸è¶³ä»¥å®¹çº³æ–°çš„å­—èŠ‚ï¼Œæˆ–Unicodeå­—ç¬¦çš„æ—¶å€™ï¼Œè°ƒç”¨<code>Flush</code>æ–¹æ³•ã€‚</p><p>æ­¤å¤–ï¼Œå¦‚æœ<code>Write</code>æ–¹æ³•å‘ç°éœ€è¦å†™å…¥çš„å­—èŠ‚å¤ªå¤šï¼ŒåŒæ—¶ç¼“å†²åŒºå·²ç©ºï¼Œé‚£ä¹ˆå®ƒå°±ä¼šè·¨è¿‡ç¼“å†²åŒºï¼Œå¹¶ç›´æ¥æŠŠè¿™äº›æ•°æ®å†™åˆ°åº•å±‚å†™å…¥å™¨ä¸­ã€‚</p><p>è€Œ<code>ReadFrom</code>æ–¹æ³•ï¼Œåˆ™ä¼šåœ¨å‘ç°åº•å±‚å†™å…¥å™¨çš„ç±»å‹æ˜¯<code>io.ReaderFrom</code>æ¥å£çš„å®ç°ä¹‹åï¼Œç›´æ¥è°ƒç”¨å…¶<code>ReadFrom</code>æ–¹æ³•æŠŠå‚æ•°å€¼æŒæœ‰çš„æ•°æ®å†™è¿›å»ã€‚</p><p>æ€»ä¹‹ï¼Œåœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œåªè¦ç¼“å†²åŒºä¸­çš„å¯å†™ç©ºé—´æ— æ³•å®¹çº³éœ€è¦å†™å…¥çš„æ–°æ•°æ®ï¼Œ<code>Flush</code>æ–¹æ³•å°±ä¸€å®šä¼šè¢«è°ƒç”¨ã€‚å¹¶ä¸”ï¼Œ<code>bufio.Writer</code>ç±»å‹çš„ä¸€äº›æ–¹æ³•æœ‰æ—¶å€™è¿˜ä¼šè¯•å›¾èµ°æ·å¾„ï¼Œè·¨è¿‡ç¼“å†²åŒºè€Œç›´æ¥å¯¹æ¥æ•°æ®ä¾›éœ€çš„åŒæ–¹ã€‚</p><p>ä½ å¯ä»¥åœ¨ç†è§£äº†è¿™äº›å†…éƒ¨æœºåˆ¶ä¹‹åï¼Œæœ‰çš„æ”¾çŸ¢åœ°ç¼–å†™ä½ çš„ä»£ç ã€‚ä¸è¿‡ï¼Œåœ¨ä½ æŠŠæ‰€æœ‰çš„æ•°æ®éƒ½å†™å…¥<code>Writer</code>å€¼ä¹‹åï¼Œå†è°ƒç”¨ä¸€ä¸‹å®ƒçš„<code>Flush</code>æ–¹æ³•ï¼Œæ˜¾ç„¶æ˜¯æœ€ç¨³å¦¥çš„ã€‚</p><h2>æ€»ç»“</h2><p>ä»Šå¤©æˆ‘ä»¬ä»â€œ<code>bufio.Reader</code>ç±»å‹å€¼ä¸­çš„ç¼“å†²åŒºèµ·ç€æ€æ ·çš„ä½œç”¨â€è¿™é“é—®é¢˜å…¥æ‰‹ï¼Œä»‹ç»äº†ä¸€éƒ¨åˆ†bufioåŒ…ä¸­çš„æ•°æ®ç±»å‹ï¼Œåœ¨ä¸‹ä¸€æ¬¡çš„åˆ†äº«ä¸­ï¼Œæˆ‘ä¼šæ²¿ç€è¿™ä¸ªé—®é¢˜ç»§ç»­å±•å¼€ã€‚</p><p>ä½ å¯¹ä»Šå¤©çš„å†…å®¹æœ‰ä»€ä¹ˆæ ·çš„æ€è€ƒï¼Œå¯ä»¥ç»™æˆ‘ç•™è¨€ï¼Œæˆ‘ä»¬ä¸€èµ·è®¨è®ºã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæˆ‘ä»¬ä¸‹æœŸå†è§ã€‚</p><p><a href=\"https://github.com/hyper0x/Golang_Puzzlers\">æˆ³æ­¤æŸ¥çœ‹Goè¯­è¨€ä¸“æ æ–‡ç« é…å¥—è¯¦ç»†ä»£ç ã€‚</a></p><p></p>","comments":[{"had_liked":false,"id":168916,"user_name":"äººç”Ÿå…¥æˆé¡»å°½æ¬¢","can_delete":false,"product_type":"c1","uid":1138759,"ip_address":"","ucode":"E5B7EAAECEFB03","user_header":"https://static001.geekbang.org/account/avatar/00/11/60/47/fa06038b.jpg","comment_is_top":false,"comment_ctime":1578215959,"is_pvip":false,"replies":[{"id":"65646","content":"bufio åŒ…ä¸­çš„ Reader å’Œ Writer çš„ä¸»è¦ä½œç”¨æ˜¯åœ¨å·²æœ‰çš„ IO è¯»å–å™¨æˆ–è€…å†™å…¥å™¨ä¹‹ä¸Šå†åŒ…ä¸€å±‚ç¼“å†²åŒºï¼Œæ˜¯é¢å‘ IO æ“ä½œã€‚è€Œ bytes.Buffer æ˜¯åŸºäºå­—èŠ‚æ•°ç»„çš„ç¼“å†²åŒºï¼Œæ˜¯é¢å‘çº¯å†…å­˜çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1578308157,"ip_address":"","comment_id":168916,"utype":1}],"discussion_count":3,"race_medal":0,"score":"78887627287","product_id":100013101,"comment_content":"bufioå’Œbytes.bufferæœ‰ä»€ä¹ˆåŒºåˆ«å—","like_count":19,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480373,"discussion_content":"bufio åŒ…ä¸­çš„ Reader å’Œ Writer çš„ä¸»è¦ä½œç”¨æ˜¯åœ¨å·²æœ‰çš„ IO è¯»å–å™¨æˆ–è€…å†™å…¥å™¨ä¹‹ä¸Šå†åŒ…ä¸€å±‚ç¼“å†²åŒºï¼Œæ˜¯é¢å‘ IO æ“ä½œã€‚è€Œ bytes.Buffer æ˜¯åŸºäºå­—èŠ‚æ•°ç»„çš„ç¼“å†²åŒºï¼Œæ˜¯é¢å‘çº¯å†…å­˜çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578308157,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2783518,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/79/1e/44a70976.jpg","nickname":"å–µ","note":"","ucode":"ECDF6128250FA9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":552670,"discussion_content":"å’ŒJAVA é‡Œé¢çš„å¾ˆç›¸åŒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645541223,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":480373,"ip_address":""},"score":552670,"extra":""}]},{"author":{"id":1178380,"avatar":"https://static001.geekbang.org/account/avatar/00/11/fb/0c/85d60820.jpg","nickname":"å°åå“¥","note":"","ucode":"546EF8803E101F","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":406780,"discussion_content":"è€å¸ˆï¼Œè¯»ä¸€å—çš„å†…å®¹æ„Ÿè§‰å¾ˆå¹²ï¼Œå¾ˆéš¾è¯»æ‡‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1634829734,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40584,"user_name":"åˆ°ä¸äº†çš„å¡”","can_delete":false,"product_type":"c1","uid":1258362,"ip_address":"","ucode":"0F5BE3CB58DE31","user_header":"https://static001.geekbang.org/account/avatar/00/13/33/7a/ac307bfc.jpg","comment_is_top":false,"comment_ctime":1542633876,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"40197339540","product_id":100013101,"comment_content":"bufioçš„åº”ç”¨åœºæ™¯åº”è¯¥æ˜¯ä¸ºäº†åŠ å¿«ioé€Ÿåº¦ï¼Œå°¤å…¶æ˜¯å¯¹æ¯”è¾ƒé›¶ç¢çš„æ•°æ®ï¼ˆå°æ•°æ®ï¼‰çš„ioåŠ é€Ÿæ›´æ˜æ˜¾ã€‚<br>","like_count":10},{"had_liked":false,"id":40270,"user_name":"Cloud","can_delete":false,"product_type":"c1","uid":1147061,"ip_address":"","ucode":"86B1C459EC9F82","user_header":"https://static001.geekbang.org/account/avatar/00/11/80/b5/f59d92f1.jpg","comment_is_top":false,"comment_ctime":1542588182,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"27312391958","product_id":100013101,"comment_content":"è€å¸ˆï¼Œä»€ä¹ˆåœºæ™¯é€‚åˆä½¿ç”¨bufioï¼Œèƒ½å¦ä¸¾å‡ ä¸ªæ —å­å‘€","like_count":6,"discussions":[{"author":{"id":1198953,"avatar":"https://static001.geekbang.org/account/avatar/00/12/4b/69/c02eac91.jpg","nickname":"å¤§æ¼ èƒ¡èåœ","note":"","ucode":"FBE51E4A13EF4F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290577,"discussion_content":"Goçš„net/httpåŒ…ä¸­clientå‘serverç«¯å‘é€æ•°æ®çš„æ—¶å€™ä½¿ç”¨çš„bufio","likes_number":8,"is_delete":false,"is_hidden":false,"ctime":1594539744,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":171221,"user_name":"ç–¯ç´","can_delete":false,"product_type":"c1","uid":1099379,"ip_address":"","ucode":"82ACAA4A27753D","user_header":"https://static001.geekbang.org/account/avatar/00/10/c6/73/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1578883645,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10168818237","product_id":100013101,"comment_content":"å¯¹ç…§æºç çœ‹ä¸“æ ï¼Œå¥½ç†è§£å¥½è®°å¿†ã€‚ğŸ‘","like_count":2},{"had_liked":false,"id":309427,"user_name":"lesserror","can_delete":false,"product_type":"c1","uid":1351076,"ip_address":"","ucode":"25A54D1165FCF6","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","comment_is_top":false,"comment_ctime":1630123009,"is_pvip":false,"replies":[{"id":"112161","content":"è¿™æ˜¯å› ä¸ºåº•å±‚çš„ reader ä¸­æ€»å…±åªæœ‰ 213 ä¸ªå­—ç¬¦å•Šï¼Œè¿™ä¸ buffer çš„å¤§å°æ²¡æœ‰å…³ç³»ï¼Œè¦çœ‹æœ‰å¤šå°‘ä¸ªå­—ç¬¦æ˜¯çœŸæ­£å­˜åœ¨çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1630307698,"ip_address":"","comment_id":309427,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1630123009","product_id":100013101,"comment_content":"éƒæ—è€å¸ˆä½ å¥½ã€‚<br><br>è¯·é—®ä¸€ä¸‹ï¼Œdemo84.goä¸­ï¼šç¤ºä¾‹4å’Œç¤ºä¾‹5ä¸­ï¼Œä¸ºä»€ä¹ˆè°ƒç”¨Peekæ–¹æ³•æœ€åè¿”å›çš„å­—èŠ‚åˆ‡ç‰‡çš„é•¿åº¦éƒ½ä¸º213å‘€ã€‚æˆ‘æƒ³çš„æ˜¯ç¤ºä¾‹5ä¸­åº”è¯¥è¿”å›300æ‰å¯¹çš„å‘€ã€‚","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525872,"discussion_content":"è¿™æ˜¯å› ä¸ºåº•å±‚çš„ reader ä¸­æ€»å…±åªæœ‰ 213 ä¸ªå­—ç¬¦å•Šï¼Œè¿™ä¸ buffer çš„å¤§å°æ²¡æœ‰å…³ç³»ï¼Œè¦çœ‹æœ‰å¤šå°‘ä¸ªå­—ç¬¦æ˜¯çœŸæ­£å­˜åœ¨çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630307698,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68091,"user_name":"Wiwen","can_delete":false,"product_type":"c1","uid":1156306,"ip_address":"","ucode":"91466C0AE76903","user_header":"https://static001.geekbang.org/account/avatar/00/11/a4/d2/c483b836.jpg","comment_is_top":false,"comment_ctime":1550411317,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1550411317","product_id":100013101,"comment_content":"å¦‚æœWriteæ–¹æ³•å‘ç°éœ€è¦å†™å…¥çš„å­—èŠ‚å¤ªå¤šï¼ŒåŒæ—¶ç¼“å†²åŒºå·²ç©ºï¼Œç›´æ¥å†™åˆ°åº•å±‚å†™å…¥å™¨ã€‚<br>è¿™ä¸ªå†™å…¥å­—èŠ‚åº”è¯¥æ˜¯æ–°è¦å†™å…¥çš„å­—èŠ‚å¤§å°è¶…è¿‡äº†ç¼“å­˜åŒºçš„å¤§å°(é»˜è®¤å€¼æ˜¯4096)æ—¶ï¼Œæ‰ç›´æ¥å†™åˆ°åº•å±‚å†™å…¥å™¨ã€‚","like_count":0}]}