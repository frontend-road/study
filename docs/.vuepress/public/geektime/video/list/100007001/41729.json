{"id":41729,"title":"109 | Spring Cloud Eureka 和 Ribbon 主要配置项","content":"无","comments":[{"had_liked":false,"id":68584,"user_name":"NICK","can_delete":false,"product_type":"c3","uid":1322863,"ip_address":"","ucode":"FE50160CA16DCC","user_header":"https://static001.geekbang.org/account/avatar/00/14/2f/6f/31721039.jpg","comment_is_top":false,"comment_ctime":1550549924,"is_pvip":false,"replies":[{"id":24402,"content":"你好，Ribbon是负责软负载的组件，Hystrix则是服务熔断限流的组件，两者可以独立工作，也可以一起工作，两者整合的例子可以参考Spring Cloud Zuul文档，可以同时启用Ribbon + Hystrix。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1550577851,"ip_address":"","comment_id":68584,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"老师，Ribbon 如何与Hystrix整合实现熔断限流？","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439739,"discussion_content":"你好，Ribbon是负责软负载的组件，Hystrix则是服务熔断限流的组件，两者可以独立工作，也可以一起工作，两者整合的例子可以参考Spring Cloud Zuul文档，可以同时启用Ribbon + Hystrix。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550577851,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":180635,"user_name":"天空大海","can_delete":false,"product_type":"c3","uid":1007748,"ip_address":"","ucode":"CF625DF1D89856","user_header":"https://static001.geekbang.org/account/avatar/00/0f/60/84/354dafcb.jpg","comment_is_top":false,"comment_ctime":1582356455,"is_pvip":false,"replies":[{"id":70184,"content":"这些是Ribbon的路由规则Rule，随机(RoundRobinRule)是默认支持的，带权重有一个根据平均相应时间做路由的规则(WeightedResponseTimeRule)，可以参考文档配置，分流规则应该没有直接提供，需要定制自研开发Rule。\n\n参考文档：\nhttps:&#47;&#47;github.com&#47;Netflix&#47;ribbon&#47;wiki&#47;Working-with-load-balancers\nhttps:&#47;&#47;cloud.spring.io&#47;spring-cloud-netflix&#47;multi&#47;multi_spring-cloud-ribbon.html","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1582434066,"ip_address":"","comment_id":180635,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"老师，随机、带权重、应用层面分流等规则在使用ribbon或者eureka客户端的时候分别如何配置，都支持哪些规则呢","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484740,"discussion_content":"这些是Ribbon的路由规则Rule，随机(RoundRobinRule)是默认支持的，带权重有一个根据平均相应时间做路由的规则(WeightedResponseTimeRule)，可以参考文档配置，分流规则应该没有直接提供，需要定制自研开发Rule。\n\n参考文档：\nhttps://github.com/Netflix/ribbon/wiki/Working-with-load-balancers\nhttps://cloud.spring.io/spring-cloud-netflix/multi/multi_spring-cloud-ribbon.html","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582434066,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":37739,"user_name":"钏","can_delete":false,"product_type":"c3","uid":1103237,"ip_address":"","ucode":"FC819B35E8E0ED","user_header":"https://static001.geekbang.org/account/avatar/00/10/d5/85/2975c2a3.jpg","comment_is_top":false,"comment_ctime":1541722713,"is_pvip":false,"replies":[{"id":13630,"content":"netflix也是AMI镜像部署，如果要布署到不同环境带不同参数，那么最好做在发布系统里，发布系统知道要发哪个zone，在向不同zone发服务实例时，起动镜把zone作为环境变量传入","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1541766776,"ip_address":"","comment_id":37739,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"Eureka的多机房部署还是不是很明白，我看了下eureka有个region和zone配置，但是除了server端需要配置自己所属的region和zone，这个可以接受，但是每个服务都需要配置自己的所属zone，这个应该可以通过部署的时候，打入系统参数，启动脚本加上这个系统参数解决，不知道有没有更方便的做法呢？可以接受eureka server配置文件的人工配置，但是同服务不同实例因为docker化，不是很想这样去做个性化配置","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428471,"discussion_content":"netflix也是AMI镜像部署，如果要布署到不同环境带不同参数，那么最好做在发布系统里，发布系统知道要发哪个zone，在向不同zone发服务实例时，起动镜把zone作为环境变量传入","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541766776,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":36456,"user_name":"钏","can_delete":false,"product_type":"c3","uid":1103237,"ip_address":"","ucode":"FC819B35E8E0ED","user_header":"https://static001.geekbang.org/account/avatar/00/10/d5/85/2975c2a3.jpg","comment_is_top":false,"comment_ctime":1541120399,"is_pvip":false,"replies":[{"id":13172,"content":"svc是服务名，在spring cloud中一般就是应用名，具体可参考spring cloud文档。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1541423217,"ip_address":"","comment_id":36456,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"我看你ppt写的Ribbon的配置前缀是svc，是服务名？还是接口名？一个服务如果要配置全局配置，是什么开头呢","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427871,"discussion_content":"svc是服务名，在spring cloud中一般就是应用名，具体可参考spring cloud文档。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541423217,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":36453,"user_name":"钏","can_delete":false,"product_type":"c3","uid":1103237,"ip_address":"","ucode":"FC819B35E8E0ED","user_header":"https://static001.geekbang.org/account/avatar/00/10/d5/85/2975c2a3.jpg","comment_is_top":false,"comment_ctime":1541120294,"is_pvip":false,"replies":[{"id":13047,"content":"我认为多机房情况下，每个机房都要布一个eureka小集群（至少三个节点），保证每个机房高可用，然后多个机房的eureka再组成一个跨机房大集群，让所有机房服务实例，对每个机房的eureka都可见。eureka跨数据中心，是为了保证当某机房服务不可用时，client（例如通过ribbon）可以去访问其它机房的相同服务。在eureka跨机房配置下，每个机房的eureka有一个域名（躲在负载均衡后面），每个机房的client通过配本机房eureka域名访问eureka。当然通过一些技术，可以统一eureka域名，负载均衡设备会保证本机房的client只访问本机房eureka。跨机房场景下ribbon的配置，耍启用跨机房HA，可参ribbon文档。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1541339640,"ip_address":"","comment_id":36453,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"Eureka server在多机房的情况下，怎么部署，和配置比较好呢？比如同城3个机房，每个机房部署1-2个eureka server，一共3-6个节点，那还是配置efault zone，配3-6个url么，","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427870,"discussion_content":"我认为多机房情况下，每个机房都要布一个eureka小集群（至少三个节点），保证每个机房高可用，然后多个机房的eureka再组成一个跨机房大集群，让所有机房服务实例，对每个机房的eureka都可见。eureka跨数据中心，是为了保证当某机房服务不可用时，client（例如通过ribbon）可以去访问其它机房的相同服务。在eureka跨机房配置下，每个机房的eureka有一个域名（躲在负载均衡后面），每个机房的client通过配本机房eureka域名访问eureka。当然通过一些技术，可以统一eureka域名，负载均衡设备会保证本机房的client只访问本机房eureka。跨机房场景下ribbon的配置，耍启用跨机房HA，可参ribbon文档。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541339640,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}