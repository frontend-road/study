{"id":113361,"title":"43 | 输入输出设备：我们并不是只能用灯泡显示“0”和“1”","content":"<p>我们在前面的章节搭建了最简单的电路，在这里面，计算机的输入设备就是一个一个开关，输出设备呢，是一个一个灯泡。的确，早期发展的时候，计算机的核心是做“计算”。我们从“计算机”这个名字上也能看出这一点。不管是中文名字“计算机”，还是英文名字“Computer”，核心都是在”计算“这两个字上。不过，到了今天，这些“计算”的工作，更多的是一个幕后工作。</p><p>我们无论是使用自己的PC，还是智能手机，大部分时间都是在和计算机进行各种“交互操作”。换句话说，就是在和输入输出设备打交道。这些输入输出设备也不再是一个一个开关，或者一个一个灯泡。你在键盘上直接敲击的都是字符，而不是“0”和“1”，你在显示器上看到的，也是直接的图形或者文字的画面，而不是一个一个闪亮或者关闭的灯泡。想要了解这其中的关窍，那就请你和我一起来看一看，计算机里面的输入输出设备。</p><h2>接口和设备：经典的适配器模式</h2><p>我们在前面讲解计算机的五大组成部分的时候，我看到这样几个留言。</p><p>一个同学问，像蓝牙、WiFi无线网卡这样的设备也是输入输出设备吗？还有一个同学问，我们的输入输出设备的寄存器在哪里？到底是在主板上，还是在硬件设备上？</p><p>这两个问题问得很好。其实你只要理解了这两个问题，也就理解输入输出设备是怎么回事儿了。</p><!-- [[[read_end]]] --><p>实际上，输入输出设备，并不只是一个设备。大部分的输入输出设备，都有两个组成部分。第一个是它的<strong>接口</strong>（Interface），第二个才是<strong>实际的I/O设备</strong>（Actual I/O Device）。我们的硬件设备并不是直接接入到总线上和CPU通信的，而是通过接口，用接口连接到总线上，再通过总线和CPU通信。</p><p><img src=\"https://static001.geekbang.org/resource/image/ce/bf/ce9d22a0dafa20b9574411b810c0aabf.jpg?wh=2048*1371\" alt=\"\"></p><center><a href=\"https://www.flickr.com/photos/30478819@N08/42510913460/in/photolist-e3Uor9-a8hPhk-9geU8f-27LxxvN-7ihCSj-8pMS6t-eHwMd-eHwKr-gbeKdb-eHwLn-eHwMZ-gbexZR-aBK9Bc-5RXawg-aBK9uc-aBK9y4-5A1rvL-225eB2A-eHwNH-7TLGVg-4eNMHD-4eNN98-ckC5vN-4eNNBK-25n38Tv-67FwAd-GJ7fs1-225Mqxb-GJ7fM9-2f71bD4-2e17jxW-2gwg8wm-2gwg8a4-2gwfLgK-RwCq8x-f6REoz-3qw8YH\">图片来源</a></center><center><span class=\"reference\">SATA硬盘，上面的整个绿色电路板和黄色的齿状部分就是接口电路，黄色齿状的就是和主板对接的接口，绿色的电路板就是控制电路</span></center><p>你平时听说的并行接口（Parallel Interface）、串行接口（Serial Interface）、USB接口，都是计算机主板上内置的各个接口。我们的实际硬件设备，比如，使用并口的打印机、使用串口的老式鼠标或者使用USB接口的U盘，都要插入到这些接口上，才能和CPU工作以及通信的。</p><p>接口本身就是一块电路板。CPU其实不是和实际的硬件设备打交道，而是和这个接口电路板打交道。我们平时说的，设备里面有三类寄存器，其实都在这个设备的接口电路上，而不在实际的设备上。</p><p>那这三类寄存器是哪三类寄存器呢？它们分别是状态寄存器（Status Register）、 命令寄存器（Command Register）以及数据寄存器（Data Register），</p><p>除了内置在主板上的接口之外，有些接口可以集成在设备上。你可能都没有见过老一点儿的硬盘，我来简单给你介绍一下。</p><p>上世纪90年代的时候，大家用的硬盘都叫作<strong>IDE硬盘</strong>。这个IDE不是像IntelliJ或者WebStorm这样的软件开发集成环境（Integrated Development Environment）的IDE，而是代表着集成设备电路（Integrated Device Electronics）。也就是说，设备的接口电路直接在设备上，而不在主板上。我们需要通过一个线缆，把集成了接口的设备连接到主板上去。</p><p><img src=\"https://static001.geekbang.org/resource/image/30/47/30c96ac2fd8a0deffcff86e7b66acf47.png?wh=779*573\" alt=\"\"></p><center><span class=\"reference\">我自己使用的PC的设备管理器</span></center><p>把接口和实际设备分离，这个做法实际上来自于计算机走向<a href=\"https://en.wikipedia.org/wiki/Open_architecture\">开放架构</a>（Open Architecture）的时代。</p><p>当我们要对计算机升级，我们不会扔掉旧的计算机，直接买一台全新的计算机，而是可以单独升级硬盘这样的设备。我们把老硬盘从接口上拿下来，换一个新的上去就好了。各种输入输出设备的制造商，也可以根据接口的控制协议，来设计和制造硬盘、鼠标、键盘、打印机乃至其他种种外设。正是这样的分工协作，带来了PC时代的繁荣。</p><p>其实，在软件的设计模式里也有这样的思路。面向对象里的面向接口编程的接口，就是Interface。如果你做iOS的开发，Objective-C里面的Protocol其实也是这个意思。而Adaptor设计模式，更是一个常见的、用来解决不同外部应用和系统“适配”问题的方案。可以看到，计算机的软件和硬件，在逻辑抽象上，其实是相通的。</p><p>如果你用的是Windows操作系统，你可以打开设备管理器，里面有各种各种的Devices（设备）、Controllers（控制器）、Adaptors（适配器）。这些，其实都是对于输入输出设备不同角度的描述。被叫作Devices，看重的是实际的I/O设备本身。被叫作Controllers，看重的是输入输出设备接口里面的控制电路。而被叫作Adaptors，则是看重接口作为一个适配器后面可以插上不同的实际设备。</p><h2>CPU是如何控制I/O设备的？</h2><p>无论是内置在主板上的接口，还是集成在设备上的接口，除了三类寄存器之外，还有对应的控制电路。正是通过这个控制电路，CPU才能通过向这个接口电路板传输信号，来控制实际的硬件。</p><p>我们先来看一看，硬件设备上的这些寄存器有什么用。这里，我拿我们平时用的打印机作为例子。</p><p><img src=\"https://static001.geekbang.org/resource/image/fd/38/fd788de17028e8b1dbce58de5da31e38.jpeg?wh=2419*1609\" alt=\"\"></p><ol>\n<li>首先是数据寄存器（Data Register）。CPU向I/O设备写入需要传输的数据，比如要打印的内容是“GeekTime”，我们就要先发送一个“G”给到对应的I/O设备。</li>\n<li>然后是命令寄存器（Command Register）。CPU发送一个命令，告诉打印机，要进行打印工作。这个时候，打印机里面的控制电路会做两个动作。第一个，是去设置我们的状态寄存器里面的状态，把状态设置成not-ready。第二个，就是实际操作打印机进行打印。</li>\n<li>而状态寄存器（Status Register），就是告诉了我们的CPU，现在设备已经在工作了，所以这个时候，CPU你再发送数据或者命令过来，都是没有用的。直到前面的动作已经完成，状态寄存器重新变成了ready状态，我们的CPU才能发送下一个字符和命令。</li>\n</ol><p>当然，在实际情况中，打印机里通常不只有数据寄存器，还会有数据缓冲区。我们的CPU也不是真的一个字符一个字符这样交给打印机去打印的，而是一次性把整个文档传输到打印机的内存或者数据缓冲区里面一起打印的。不过，通过上面这个例子，相信你对CPU是怎么操作I/O设备的，应该有所了解了。</p><h2>信号和地址：发挥总线的价值</h2><p>搞清楚了实际的I/O设备和接口之间的关系，一个新的问题就来了。那就是，我们的CPU到底要往总线上发送一个什么样的命令，才能和I/O接口上的设备通信呢？</p><p>CPU和I/O设备的通信，一样是通过CPU支持的机器指令来执行的。</p><p>如果你回头去看一看<a href=\"https://time.geekbang.org/column/article/93359\">第5讲</a>，MIPS的机器指令的分类，你会发现，我们并没有一种专门的和I/O设备通信的指令类型。那么，MIPS的CPU到底是通过什么样的指令来和I/O设备来通信呢？</p><p>答案就是，和访问我们的主内存一样，使用“内存地址”。为了让已经足够复杂的CPU尽可能简单，计算机会把I/O设备的各个寄存器，以及I/O设备内部的内存地址，都映射到主内存地址空间里来。主内存的地址空间里，会给不同的I/O设备预留一段一段的内存地址。CPU想要和这些I/O设备通信的时候呢，就往这些地址发送数据。这些地址信息，就是通过上一讲的地址线来发送的，而对应的数据信息呢，自然就是通过数据线来发送的了。</p><p>而我们的I/O设备呢，就会监控地址线，并且在CPU往自己地址发送数据的时候，把对应的数据线里面传输过来的数据，接入到对应的设备里面的寄存器和内存里面来。CPU无论是向I/O设备发送命令、查询状态还是传输数据，都可以通过这样的方式。这种方式呢，叫作<strong>内存映射</strong>IO（Memory-Mapped I/O，简称MMIO）。</p><p><img src=\"https://static001.geekbang.org/resource/image/bb/22/bb8c1c007f7263bee41b7c649304c722.jpeg?wh=1939*1666\" alt=\"\"></p><p>那么，MMIO是不是唯一一种CPU和设备通信的方式呢？答案是否定的。精简指令集MIPS的CPU特别简单，所以这里只有MMIO。而我们有2000多个指令的Intel X86架构的计算机，自然可以设计专门的和I/O设备通信的指令，也就是 in 和 out 指令。</p><p>Intel CPU虽然也支持MMIO，不过它还可以通过特定的指令，来支持端口映射I/O（Port-Mapped I/O，简称PMIO）或者也可以叫独立输入输出（Isolated I/O）。</p><p>其实PMIO的通信方式和MMIO差不多，核心的区别在于，PMIO里面访问的设备地址，不再是在内存地址空间里面，而是一个专门的端口（Port）。这个端口并不是指一个硬件上的插口，而是和CPU通信的一个抽象概念。</p><p>无论是PMIO还是MMIO，CPU都会传送一条二进制的数据，给到I/O设备的对应地址。设备自己本身的接口电路，再去解码这个数据。解码之后的数据呢，就会变成设备支持的一条指令，再去通过控制电路去操作实际的硬件设备。对于CPU来说，它并不需要关心设备本身能够支持哪些操作。它要做的，只是在总线上传输一条条数据就好了。</p><p>这个，其实也有点像我们在设计模式里面的Command模式。我们在总线上传输的，是一个个数据对象，然后各个接受这些对象的设备，再去根据对象内容，进行实际的解码和命令执行。</p><p><img src=\"https://static001.geekbang.org/resource/image/4e/a7/4e66bafd713fed95a4957df71b3bd8a7.png?wh=398*453\" alt=\"\"></p><center><span class=\"reference\">这是我计算机上，设备管理器里显卡设备的资源信息</span></center><p>这是一张我自己的显卡，在设备管理器里面的资源（Resource）信息。你可以看到，里面既有Memory Range，这个就是设备对应映射到的内存地址，也就是我们上面所说的MMIO的访问方式。同样的，里面还有I/O Range，这个就是我们上面所说的PMIO，也就是通过端口来访问I/O设备的地址。最后，里面还有一个IRQ，也就是会来自于这个设备的中断信号了。</p><h2>总结延伸</h2><p>好了，讲到这里，不知道，现在你是不是可以把CPU的指令、总线和I/O设备之间的关系彻底串联起来了呢？我来带你回顾一下。</p><p>CPU并不是发送一个特定的操作指令来操作不同的I/O设备。因为如果是那样的话，随着新的I/O设备的发明，我们就要去扩展CPU的指令集了。</p><p>在计算机系统里面，CPU和I/O设备之间的通信，是这么来解决的。</p><p>首先，在I/O设备这一侧，我们把I/O设备拆分成，能和CPU通信的接口电路，以及实际的I/O设备本身。接口电路里面有对应的状态寄存器、命令寄存器、数据寄存器、数据缓冲区和设备内存等等。接口电路通过总线和CPU通信，接收来自CPU的指令和数据。而接口电路中的控制电路，再解码接收到的指令，实际去操作对应的硬件设备。</p><p>而在CPU这一侧，对CPU来说，它看到的并不是一个个特定的设备，而是一个个内存地址或者端口地址。CPU只是向这些地址传输数据或者读取数据。所需要的指令和操作内存地址的指令其实没有什么本质差别。通过软件层面对于传输的命令数据的定义，而不是提供特殊的新的指令，来实际操作对应的I/O硬件。</p><h2>推荐阅读</h2><p>想要进一步了解CPU和I/O设备交互的技术细节，我推荐你去看一看北京大学在Coursera上的视频课程，《计算机组成》<a href=\"https://www.coursera.org/learn/jisuanji-zucheng/home/week/10\">第10周的</a><a href=\"https://www.coursera.org/learn/jisuanji-zucheng/home/week/10\">内容</a>。这个课程在Coursera上是中文的，而且可以免费观看。相信这一个小时的视频课程，对于你深入理解输入输出设备，会很有帮助。</p><h2>课后思考</h2><p>我们还是回到，这节开始的时候同学留言的问题。如果你买的是一个带无线接收器的蓝牙鼠标，你需要把蓝牙接收器插在电脑的USB接口上，然后你的鼠标会和这个蓝牙接收器进行通信。那么，你能想一下，我们的CPU和蓝牙鼠标这个输入设备之间的通信是怎样的吗？</p><p>你可以好好思考一下，然后在留言区写下你的想法。当然，你也可以把这个问题分享给你的朋友，拉上他一起学习。</p><p></p>","comments":[{"had_liked":false,"id":120718,"user_name":"rookiegan","can_delete":false,"product_type":"c1","uid":1109663,"ip_address":"","ucode":"EE6CB92C788483","user_header":"https://static001.geekbang.org/account/avatar/00/10/ee/9f/495d60b9.jpg","comment_is_top":false,"comment_ctime":1564982095,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"297917725519","product_id":100026001,"comment_content":"以蓝牙鼠标接收器是USB接口为例。<br><br>对于CPU来说，这只是总线上的一个普通的USB设备，与其他的U盘、USB网卡之类的USB接口设备没什么区别，这些设备只是通过USB协议讲自己的数据发送给操作系统，对于这些数据是什么，USB是不管的，USB蓝牙鼠标接收器和普通USB的鼠标在这一层的数据是一样的。<br><br>对于操作系统来说，要使这些USB设备工作，就需要对发来的数据进行处理，处理数据的就是驱动程序，所以不同种类的USB设备需要不同的驱动程序。<br><br>回过头来再看USB蓝牙鼠标接收器，鼠标产生的事件通过 蓝牙发送-&gt;蓝牙接受-&gt; USB发送-&gt; USB接受-&gt;驱动程序 这样的路径最终到达操作系统，这里面的蓝牙和USB仅仅只是传输数据的方式而已，换为其他的什么TCP&#47; IP传输也是一样的，其本质是将特定的数据传输给操作系统处理。","like_count":70,"discussions":[{"author":{"id":1181650,"avatar":"https://static001.geekbang.org/account/avatar/00/12/07/d2/0d7ee298.jpg","nickname":"惘 闻","note":"","ucode":"C5909F034BF072","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389682,"discussion_content":"Usb发送，到usb接收是什么操作","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629377306,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005042,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/55/f2/ba68d931.jpg","nickname":"有米","note":"","ucode":"C9A10B7A67BC12","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":203487,"discussion_content":"还是不太明白驱动程序充当什么样的角色","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584029996,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1528419,"avatar":"https://static001.geekbang.org/account/avatar/00/17/52/63/9dd2c265.jpg","nickname":"passenger","note":"","ucode":"E45D739EA6A8AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1005042,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/55/f2/ba68d931.jpg","nickname":"有米","note":"","ucode":"C9A10B7A67BC12","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":219324,"discussion_content":"个人理解：打开不同的设备，系统调用都是open（相当于上层），不同设备自己的open函数都不一样（底层），打开不同设备，都会调用不同的open。驱动程序就是具体的实现。","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1585751105,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":203487,"ip_address":""},"score":219324,"extra":""},{"author":{"id":1587666,"avatar":"https://static001.geekbang.org/account/avatar/00/18/39/d2/845c0e39.jpg","nickname":"送过快递的码农","note":"","ucode":"66EA81B3BADC73","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1005042,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/55/f2/ba68d931.jpg","nickname":"有米","note":"","ucode":"C9A10B7A67BC12","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288101,"discussion_content":"可以这样理解，操作系统提供了一组类似于Java  interface这样的接口，而驱动程序就是实现了这个接口的实现类。不同的硬件通过自身的驱动程序从而与操作系统交互","likes_number":16,"is_delete":false,"is_hidden":false,"ctime":1593652778,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":203487,"ip_address":""},"score":288101,"extra":""}]},{"author":{"id":1307012,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f1/84/7d21bd9e.jpg","nickname":"Goal","note":"","ucode":"C337CD4C7E07B0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":72519,"discussion_content":"优秀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575500312,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":187167,"user_name":"有米","can_delete":false,"product_type":"c1","uid":1005042,"ip_address":"","ucode":"C9A10B7A67BC12","user_header":"https://static001.geekbang.org/account/avatar/00/0f/55/f2/ba68d931.jpg","comment_is_top":false,"comment_ctime":1584030124,"is_pvip":false,"discussion_count":11,"race_medal":0,"score":"53123637676","product_id":100026001,"comment_content":"看了这一讲终于明白网络传输文件为什么要拷贝四次了！也明白零拷贝的原理了哈哈哈😄","like_count":13,"discussions":[{"author":{"id":1228852,"avatar":"https://static001.geekbang.org/account/avatar/00/12/c0/34/0574bb44.jpg","nickname":"最初的印象","note":"","ucode":"4DD68307FA274E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374841,"discussion_content":"严重怀疑是托！！","likes_number":10,"is_delete":false,"is_hidden":false,"ctime":1621386880,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1263932,"avatar":"https://static001.geekbang.org/account/avatar/00/13/49/3c/5d54c510.jpg","nickname":"静静聆听","note":"","ucode":"0A8600CB928EFE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":326135,"discussion_content":"听了你的话，我又看了一遍，这篇文章跟零拷贝有啥关系，看完我想问下：楼主，家住哪里？","likes_number":10,"is_delete":false,"is_hidden":false,"ctime":1605529762,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":2038353,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/1a/51/ac2d80fc.jpg","nickname":"苏苏","note":"","ucode":"35A4EC6F75D453","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1263932,"avatar":"https://static001.geekbang.org/account/avatar/00/13/49/3c/5d54c510.jpg","nickname":"静静聆听","note":"","ucode":"0A8600CB928EFE","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337464,"discussion_content":"哈哈哈哈哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608911155,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":326135,"ip_address":""},"score":337464,"extra":""},{"author":{"id":1005042,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/55/f2/ba68d931.jpg","nickname":"有米","note":"","ucode":"C9A10B7A67BC12","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1263932,"avatar":"https://static001.geekbang.org/account/avatar/00/13/49/3c/5d54c510.jpg","nickname":"静静聆听","note":"","ucode":"0A8600CB928EFE","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":355855,"discussion_content":"哼哼哈哈急","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615480954,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":326135,"ip_address":""},"score":355855,"extra":""}]},{"author":{"id":1213078,"avatar":"https://static001.geekbang.org/account/avatar/00/12/82/96/aa795685.jpg","nickname":"mghio","note":"","ucode":"74883EDE4FD0DC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":353033,"discussion_content":"这评论，就知道这篇文章是看了个寂寞啊","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1614955960,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1005042,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/55/f2/ba68d931.jpg","nickname":"有米","note":"","ucode":"C9A10B7A67BC12","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1213078,"avatar":"https://static001.geekbang.org/account/avatar/00/12/82/96/aa795685.jpg","nickname":"mghio","note":"","ucode":"74883EDE4FD0DC","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":355856,"discussion_content":"哈哈哈哈哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615480969,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":353033,"ip_address":""},"score":355856,"extra":""}]},{"author":{"id":1476675,"avatar":"https://static001.geekbang.org/account/avatar/00/16/88/43/31641bf0.jpg","nickname":"布朗老熊","note":"","ucode":"A8AF82550AFF9C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":299480,"discussion_content":"这评论跑错地方了，应该在48节，DMA。。。，那里面提到了4次拷贝和零拷贝。","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1597715533,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1236766,"avatar":"https://static001.geekbang.org/account/avatar/00/12/df/1e/cea897e8.jpg","nickname":"传说中的成大大","note":"","ucode":"103543D6E706BF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":296974,"discussion_content":"零拷贝说的不是操作系统的内核，用户核之间的拷贝过程吗？跟这里硬件有啥关系？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1596720312,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1309089,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f9/a1/0396e1fb.jpg","nickname":"镞砺括羽","note":"","ucode":"EC4CD773CA06EA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295959,"discussion_content":"4次？？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1596415100,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1482915,"avatar":"https://static001.geekbang.org/account/avatar/00/16/a0/a3/8da99bb0.jpg","nickname":"业余爱好者","note":"","ucode":"A890935A982988","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":284800,"discussion_content":"哪四次","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1592644399,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1513948,"avatar":"https://static001.geekbang.org/account/avatar/00/17/19/dc/9d3ed421.jpg","nickname":"monchickey","note":"","ucode":"D7B670444F62B3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1482915,"avatar":"https://static001.geekbang.org/account/avatar/00/16/a0/a3/8da99bb0.jpg","nickname":"业余爱好者","note":"","ucode":"A890935A982988","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":365261,"discussion_content":"网卡设备通过IO总线拷贝到内存(内核空间)，操作系统从内核空间拷贝到用户空间，再发出去又是两次。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1617757831,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":284800,"ip_address":""},"score":365261,"extra":""}]}]},{"had_liked":false,"id":165484,"user_name":"王加武","can_delete":false,"product_type":"c1","uid":1665471,"ip_address":"","ucode":"DDCFE578C6C428","user_header":"https://static001.geekbang.org/account/avatar/00/19/69/bf/50a824a4.jpg","comment_is_top":false,"comment_ctime":1577243389,"is_pvip":false,"replies":[{"id":"68130","content":"👍","user_name":"作者回复","user_name_real":"徐文浩","uid":"1053568","ctime":1580650666,"ip_address":"","comment_id":165484,"utype":1}],"discussion_count":1,"race_medal":0,"score":"53116850941","product_id":100026001,"comment_content":"CPU只认插在电脑USB接口上的蓝牙接收器，而蓝牙接收器的和蓝牙鼠标之间是如何传输信息的，这我觉得又是另一个层面的知识！，但是对于我们的CPU来说，当蓝牙接收器接收到鼠标的命令的时候，将这个命令通过I&#47;O接口和总线发送给CPU，CPU最后做出相应的回应，来控制对应的I&#47;O设备，这里涉及到I&#47;O接口的一个功能，那就是数据的转换！这也就是为什么很多不同的设别的发出的指令CPU都能够处理的原因！","like_count":13,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"徐文浩","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":479180,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580650666,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":135701,"user_name":"焰火","can_delete":false,"product_type":"c1","uid":1244606,"ip_address":"","ucode":"D3353B386DE3B5","user_header":"https://static001.geekbang.org/account/avatar/00/12/fd/be/079c78c7.jpg","comment_is_top":false,"comment_ctime":1569243091,"is_pvip":true,"replies":[{"id":"52605","content":"👍","user_name":"作者回复","user_name_real":"徐文浩","uid":"1053568","ctime":1569652030,"ip_address":"","comment_id":135701,"utype":1}],"discussion_count":1,"race_medal":0,"score":"53108850643","product_id":100026001,"comment_content":"上一讲的北桥IO芯片就是用来MMIO的，和ARM架构下的存储空间地址很类似。","like_count":13,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"徐文浩","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468308,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569652030,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":256247,"user_name":"风","can_delete":false,"product_type":"c1","uid":1077538,"ip_address":"","ucode":"104638BF19B048","user_header":"https://static001.geekbang.org/account/avatar/00/10/71/22/b8c596b6.jpg","comment_is_top":false,"comment_ctime":1603585135,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14488487023","product_id":100026001,"comment_content":"CPU 并不是发送一个特定的操作指令来操作不同的 I&#47;O 设备。因为如果是那样的话，随着新的 I&#47;O 设备的发明，我们就要去扩展 CPU 的指令集了。<br>在计算机系统里面，CPU 和 I&#47;O 设备之间的通信，是这么来解决的。<br>首先，在 I&#47;O 设备这一侧，我们把 I&#47;O 设备拆分成，能和 CPU 通信的接口电路，以及实际的 I&#47;O 设备本身。接口电路里面有对应的状态寄存器、命令寄存器、数据寄存器、数据缓冲区和设备内存等等。接口电路通过总线和 CPU 通信，接收来自 CPU 的指令和数据。而接口电路中的控制电路，再解码接收到的指令，实际去操作对应的硬件设备。<br>而在 CPU 这一侧，对 CPU 来说，它看到的并不是一个个特定的设备，而是一个个内存地址或者端口地址。CPU 只是向这些地址传输数据或者读取数据。所需要的指令和操作内存地址的指令其实没有什么本质差别。通过软件层面对于传输的命令数据的定义，而不是提供特殊的新的指令，来实际操作对应的 I&#47;O 硬件。","like_count":3},{"had_liked":false,"id":126442,"user_name":"活的潇洒","can_delete":false,"product_type":"c1","uid":1238830,"ip_address":"","ucode":"666C30CA894754","user_header":"https://static001.geekbang.org/account/avatar/00/12/e7/2e/1522a7d6.jpg","comment_is_top":false,"comment_ctime":1566386912,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"14451288800","product_id":100026001,"comment_content":"深挖计算机四大原理《深入浅出计算机组成原理》践行中<br>day43 笔记：https:&#47;&#47;www.cnblogs.com&#47;luoahong&#47;p&#47;11360788.html","like_count":3,"discussions":[{"author":{"id":1140303,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/4f/39386c3f.jpg","nickname":"zzj8704","note":"","ucode":"ED58C490232B96","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":379559,"discussion_content":"看了笔记，存在多处整段的拷贝（还有原图），而且没有表明出处；这个有抄袭嫌疑.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623980305,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2119325,"avatar":"https://static001.geekbang.org/account/avatar/00/20/56/9d/4b2a7d29.jpg","nickname":"ryanxw","note":"","ucode":"0B91EAC8D06EED","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1140303,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/4f/39386c3f.jpg","nickname":"zzj8704","note":"","ucode":"ED58C490232B96","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535920,"discussion_content":"这货就是农夫山泉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638607312,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":379559,"ip_address":""},"score":535920,"extra":""}]}]},{"had_liked":false,"id":121638,"user_name":"靠人品去赢","can_delete":false,"product_type":"c1","uid":1301286,"ip_address":"","ucode":"7A20F9EBE847E1","user_header":"https://static001.geekbang.org/account/avatar/00/13/db/26/54f2c164.jpg","comment_is_top":false,"comment_ctime":1565172790,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"14450074678","product_id":100026001,"comment_content":"老师用的1070.莫非平常也玩3A大作什么的。","like_count":3,"discussions":[{"author":{"id":1234591,"avatar":"https://static001.geekbang.org/account/avatar/00/12/d6/9f/0213e8a0.jpg","nickname":"🤪HappyJoo","note":"","ucode":"96E1858F06BABA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283808,"discussion_content":"1070跑机器学习的数据应该也是很好的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592371666,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1211223,"avatar":"https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg","nickname":"QQ怪","note":"","ucode":"1A39B8433D9208","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":78111,"discussion_content":"老师暴露了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575977120,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":204463,"user_name":"微秒","can_delete":false,"product_type":"c1","uid":1249195,"ip_address":"","ucode":"65A2E8B565B191","user_header":"https://static001.geekbang.org/account/avatar/00/13/0f/ab/9748f40b.jpg","comment_is_top":false,"comment_ctime":1586403245,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10176337837","product_id":100026001,"comment_content":"老师，I&#47;O内存映射，是指把设备的地址映射到主内存地址空间，这里的主内存地址空间是指虚拟内存吧？？","like_count":2},{"had_liked":false,"id":120648,"user_name":"-W.LI-","can_delete":false,"product_type":"c1","uid":1210699,"ip_address":"","ucode":"3556786538664F","user_header":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","comment_is_top":false,"comment_ctime":1564966581,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10154901173","product_id":100026001,"comment_content":"蓝牙鼠标接收器，就做了适配的功能吧。相当于接口和控制模块。把CPU发过来的数据指令转换成鼠标能接受的，然后发送给鼠标。","like_count":2},{"had_liked":false,"id":120755,"user_name":"许童童","can_delete":false,"product_type":"c1","uid":1003005,"ip_address":"","ucode":"4B799C0C6BC678","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg","comment_is_top":false,"comment_ctime":1564990480,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5859957776","product_id":100026001,"comment_content":"CPU 和 蓝牙鼠标不直接通信，而是通过蓝牙接收器这个USB设备，USB相当于接口，去控制鼠标这个实际设备，而CPU和USB设备之间的通信，就是老师文章上面讲的。","like_count":1},{"had_liked":false,"id":350619,"user_name":"一頭蠻牛","can_delete":false,"product_type":"c1","uid":1209653,"ip_address":"","ucode":"887E596A1DBF2D","user_header":"https://static001.geekbang.org/account/avatar/00/12/75/35/a0c15ca8.jpg","comment_is_top":false,"comment_ctime":1657066114,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1657066114","product_id":100026001,"comment_content":"老师请问，计算是如何把 I&#47;O 设备的各个寄存器，以及 I&#47;O 设备内部的内存地址，映射到主内存地址空间里的？这个操作是由谁做的？","like_count":0},{"had_liked":false,"id":347594,"user_name":"范超","can_delete":false,"product_type":"c1","uid":1035926,"ip_address":"","ucode":"A90F9490111A8B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ce/96/a0132d15.jpg","comment_is_top":false,"comment_ctime":1654182289,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1654182289","product_id":100026001,"comment_content":"老师请问下这里的MMIO中的内存地址空间，是指的物理地址还是虚拟地址呢？","like_count":0},{"had_liked":false,"id":339210,"user_name":"小鳄鱼","can_delete":false,"product_type":"c1","uid":1178888,"ip_address":"","ucode":"9C30CAFB41A263","user_header":"https://static001.geekbang.org/account/avatar/00/11/fd/08/c039f840.jpg","comment_is_top":false,"comment_ctime":1647995220,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1647995220","product_id":100026001,"comment_content":"还有设备的驱动程序","like_count":0},{"had_liked":false,"id":339159,"user_name":"小鳄鱼","can_delete":false,"product_type":"c1","uid":1178888,"ip_address":"","ucode":"9C30CAFB41A263","user_header":"https://static001.geekbang.org/account/avatar/00/11/fd/08/c039f840.jpg","comment_is_top":false,"comment_ctime":1647950577,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1647950577","product_id":100026001,"comment_content":"这里面感觉还应该有个东西，通信协议。例如：USB端口必须采用USB协议进行通信，否则CPU就不知道设备在说什么了","like_count":0},{"had_liked":false,"id":286231,"user_name":"UncleNo2","can_delete":false,"product_type":"c1","uid":1288740,"ip_address":"","ucode":"BA9FD997E988BE","user_header":"https://static001.geekbang.org/account/avatar/00/13/aa/24/01162b6c.jpg","comment_is_top":false,"comment_ctime":1617202576,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617202576","product_id":100026001,"comment_content":"&quot;计算机主板上内置的各个接口&quot;<br>&quot;接口本身就是一块电路板&quot;<br>&quot;SATA 硬盘，上面的整个绿色电路板和黄色的齿状部分就是接口电路&quot;<br><br>从这3段描述是不是就可以推出，SATA硬盘的接口是在设备上的了？那为啥还要举IDE硬盘的例子？","like_count":0},{"had_liked":false,"id":280348,"user_name":"红薯板栗","can_delete":false,"product_type":"c1","uid":2413071,"ip_address":"","ucode":"236BE91291A575","user_header":"https://static001.geekbang.org/account/avatar/00/24/d2/0f/8f14c85b.jpg","comment_is_top":false,"comment_ctime":1614164109,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1614164109","product_id":100026001,"comment_content":"通过内存映射IO，CPU操作设备的指令和操作内存的指令本质没有不同。CPU -- 内存地址---接口寄存器，控制电路--实际的设备","like_count":0},{"had_liked":false,"id":235122,"user_name":"A君","can_delete":false,"product_type":"c1","uid":1940105,"ip_address":"","ucode":"FE96F089C2312C","user_header":"https://static001.geekbang.org/account/avatar/00/1d/9a/89/babe8b52.jpg","comment_is_top":false,"comment_ctime":1594898760,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1594898760","product_id":100026001,"comment_content":"原来设备由接口和设备本身两部分组成，接口是和cpu通信的设备。","like_count":0}]}