{"id":219964,"title":"66 | è¿­ä»£å™¨æ¨¡å¼ï¼ˆä¸­ï¼‰ï¼šéå†é›†åˆçš„åŒæ—¶ï¼Œä¸ºä»€ä¹ˆä¸èƒ½å¢åˆ é›†åˆå…ƒç´ ï¼Ÿ","content":"<p>ä¸Šä¸€èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ç»™ArrayListã€LinkedListå®¹å™¨å®ç°è¿­ä»£å™¨ï¼Œå­¦ä¹ äº†è¿­ä»£å™¨æ¨¡å¼çš„åŸç†ã€å®ç°å’Œè®¾è®¡æ„å›¾ã€‚è¿­ä»£å™¨æ¨¡å¼ä¸»è¦ä½œç”¨æ˜¯è§£è€¦å®¹å™¨ä»£ç å’Œéå†ä»£ç ï¼Œè¿™ä¹Ÿå°è¯äº†æˆ‘ä»¬å‰é¢å¤šæ¬¡è®²è¿‡çš„åº”ç”¨è®¾è®¡æ¨¡å¼çš„ä¸»è¦ç›®çš„æ˜¯è§£è€¦ã€‚</p><p>ä¸Šä¸€èŠ‚è¯¾ä¸­è®²è§£çš„å†…å®¹éƒ½æ¯”è¾ƒåŸºç¡€ï¼Œä»Šå¤©ï¼Œæˆ‘ä»¬æ¥æ·±æŒ–ä¸€ä¸‹ï¼Œå¦‚æœåœ¨ä½¿ç”¨è¿­ä»£å™¨éå†é›†åˆçš„åŒæ—¶å¢åŠ ã€åˆ é™¤é›†åˆä¸­çš„å…ƒç´ ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Ÿåº”è¯¥å¦‚ä½•åº”å¯¹ï¼Ÿå¦‚ä½•åœ¨éå†çš„åŒæ—¶å®‰å…¨åœ°åˆ é™¤é›†åˆå…ƒç´ ï¼Ÿ</p><p>è¯ä¸å¤šè¯´ï¼Œè®©æˆ‘ä»¬æ­£å¼å¼€å§‹ä»Šå¤©çš„å†…å®¹å§ï¼</p><h2>åœ¨éå†çš„åŒæ—¶å¢åˆ é›†åˆå…ƒç´ ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</h2><p>åœ¨é€šè¿‡è¿­ä»£å™¨æ¥éå†é›†åˆå…ƒç´ çš„åŒæ—¶ï¼Œå¢åŠ æˆ–è€…åˆ é™¤é›†åˆä¸­çš„å…ƒç´ ï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´æŸä¸ªå…ƒç´ è¢«é‡å¤éå†æˆ–éå†ä¸åˆ°ã€‚ä¸è¿‡ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰æƒ…å†µä¸‹éƒ½ä¼šéå†å‡ºé”™ï¼Œæœ‰çš„æ—¶å€™ä¹Ÿå¯ä»¥æ­£å¸¸éå†ï¼Œæ‰€ä»¥ï¼Œè¿™ç§è¡Œä¸ºç§°ä¸º<strong>ç»“æœä¸å¯é¢„æœŸè¡Œä¸º</strong>æˆ–è€…<strong>æœªå†³è¡Œä¸º</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿è¡Œç»“æœåˆ°åº•æ˜¯å¯¹è¿˜æ˜¯é”™ï¼Œè¦è§†æƒ…å†µè€Œå®šã€‚</p><p>æ€ä¹ˆç†è§£å‘¢ï¼Ÿæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è§£é‡Šä¸€ä¸‹ã€‚æˆ‘ä»¬è¿˜æ˜¯å»¶ç»­ä¸Šä¸€èŠ‚è¯¾å®ç°çš„ArrayListè¿­ä»£å™¨çš„ä¾‹å­ã€‚ä¸ºäº†æ–¹ä¾¿ä½ æŸ¥çœ‹ï¼Œæˆ‘æŠŠç›¸å…³çš„ä»£ç éƒ½é‡æ–°æ‹·è´åˆ°è¿™é‡Œäº†ã€‚</p><pre><code>public interface Iterator&lt;E&gt; {\n  boolean hasNext();\n  void next();\n  E currentItem();\n}\n\npublic class ArrayIterator&lt;E&gt; implements Iterator&lt;E&gt; {\n  private int cursor;\n  private ArrayList&lt;E&gt; arrayList;\n\n  public ArrayIterator(ArrayList&lt;E&gt; arrayList) {\n    this.cursor = 0;\n    this.arrayList = arrayList;\n  }\n\n  @Override\n  public boolean hasNext() {\n    return cursor &lt; arrayList.size();\n  }\n\n  @Override\n  public void next() {\n    cursor++;\n  }\n\n  @Override\n  public E currentItem() {\n    if (cursor &gt;= arrayList.size()) {\n      throw new NoSuchElementException();\n    }\n    return arrayList.get(cursor);\n  }\n}\n\npublic interface List&lt;E&gt; {\n  Iterator iterator();\n}\n\npublic class ArrayList&lt;E&gt; implements List&lt;E&gt; {\n  //...\n  public Iterator iterator() {\n    return new ArrayIterator(this);\n  }\n  //...\n}\n\npublic class Demo {\n  public static void main(String[] args) {\n    List&lt;String&gt; names = new ArrayList&lt;&gt;();\n    names.add(&quot;a&quot;);\n    names.add(&quot;b&quot;);\n    names.add(&quot;c&quot;);\n    names.add(&quot;d&quot;);\n\n    Iterator&lt;String&gt; iterator = names.iterator();\n    iterator.next();\n    names.remove(&quot;a&quot;);\n  }\n}\n</code></pre><p>æˆ‘ä»¬çŸ¥é“ï¼ŒArrayListåº•å±‚å¯¹åº”çš„æ˜¯æ•°ç»„è¿™ç§æ•°æ®ç»“æ„ï¼Œåœ¨æ‰§è¡Œå®Œç¬¬55è¡Œä»£ç çš„æ—¶å€™ï¼Œæ•°ç»„ä¸­å­˜å‚¨çš„æ˜¯aã€bã€cã€då››ä¸ªå…ƒç´ ï¼Œè¿­ä»£å™¨çš„æ¸¸æ ‡cursoræŒ‡å‘å…ƒç´ aã€‚å½“æ‰§è¡Œå®Œç¬¬56è¡Œä»£ç çš„æ—¶å€™ï¼Œæ¸¸æ ‡æŒ‡å‘å…ƒç´ bï¼Œåˆ°è¿™é‡Œéƒ½æ²¡æœ‰é—®é¢˜ã€‚</p><!-- [[[read_end]]] --><p>ä¸ºäº†ä¿æŒæ•°ç»„å­˜å‚¨æ•°æ®çš„è¿ç»­æ€§ï¼Œæ•°ç»„çš„åˆ é™¤æ“ä½œä¼šæ¶‰åŠå…ƒç´ çš„æ¬ç§»ï¼ˆè¯¦ç»†çš„è®²è§£ä½ å¯ä»¥å»çœ‹æˆ‘çš„å¦ä¸€ä¸ªä¸“æ ã€Šæ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ã€‹ï¼‰ã€‚å½“æ‰§è¡Œåˆ°ç¬¬57è¡Œä»£ç çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä»æ•°ç»„ä¸­å°†å…ƒç´ aåˆ é™¤æ‰ï¼Œbã€cã€dä¸‰ä¸ªå…ƒç´ ä¼šä¾æ¬¡å¾€å‰æ¬ç§»ä¸€ä½ï¼Œè¿™å°±ä¼šå¯¼è‡´æ¸¸æ ‡æœ¬æ¥æŒ‡å‘å…ƒç´ bï¼Œç°åœ¨å˜æˆäº†æŒ‡å‘å…ƒç´ cã€‚åŸæœ¬åœ¨æ‰§è¡Œå®Œç¬¬56è¡Œä»£ç ä¹‹åï¼Œæˆ‘ä»¬è¿˜å¯ä»¥éå†åˆ°bã€cã€dä¸‰ä¸ªå…ƒç´ ï¼Œä½†åœ¨æ‰§è¡Œå®Œç¬¬57è¡Œä»£ç ä¹‹åï¼Œæˆ‘ä»¬åªèƒ½éå†åˆ°cã€dä¸¤ä¸ªå…ƒç´ ï¼Œbéå†ä¸åˆ°äº†ã€‚</p><p>å¯¹äºä¸Šé¢çš„æè¿°ï¼Œæˆ‘ç”»äº†ä¸€å¼ å›¾ï¼Œä½ å¯ä»¥å¯¹ç…§ç€ç†è§£ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/d8/e9/d86223f2b0f996ebb2b21e5abbeceae9.jpg?wh=1409*1382\" alt=\"\"></p><p>ä¸è¿‡ï¼Œå¦‚æœç¬¬57è¡Œä»£ç åˆ é™¤çš„ä¸æ˜¯æ¸¸æ ‡å‰é¢çš„å…ƒç´ ï¼ˆå…ƒç´ aï¼‰ä»¥åŠæ¸¸æ ‡æ‰€åœ¨ä½ç½®çš„å…ƒç´ ï¼ˆå…ƒç´ bï¼‰ï¼Œè€Œæ˜¯æ¸¸æ ‡åé¢çš„å…ƒç´ ï¼ˆå…ƒç´ cå’Œdï¼‰ï¼Œè¿™æ ·å°±ä¸ä¼šå­˜åœ¨ä»»ä½•é—®é¢˜äº†ï¼Œä¸ä¼šå­˜åœ¨æŸä¸ªå…ƒç´ éå†ä¸åˆ°çš„æƒ…å†µäº†ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å‰é¢è¯´ï¼Œåœ¨éå†çš„è¿‡ç¨‹ä¸­åˆ é™¤é›†åˆå…ƒç´ ï¼Œç»“æœæ˜¯ä¸å¯é¢„æœŸçš„ï¼Œæœ‰æ—¶å€™æ²¡é—®é¢˜ï¼ˆåˆ é™¤å…ƒç´ cæˆ–dï¼‰ï¼Œæœ‰æ—¶å€™å°±æœ‰é—®é¢˜ï¼ˆåˆ é™¤å…ƒç´ aæˆ–bï¼‰ï¼Œè¿™ä¸ªè¦è§†æƒ…å†µè€Œå®šï¼ˆåˆ°åº•åˆ é™¤çš„æ˜¯å“ªä¸ªä½ç½®çš„å…ƒç´ ï¼‰ï¼Œå°±æ˜¯è¿™ä¸ªæ„æ€ã€‚</p><p>åœ¨éå†çš„è¿‡ç¨‹ä¸­åˆ é™¤é›†åˆå…ƒç´ ï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´æŸä¸ªå…ƒç´ éå†ä¸åˆ°ï¼Œé‚£åœ¨éå†çš„è¿‡ç¨‹ä¸­æ·»åŠ é›†åˆå…ƒç´ ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿè¿˜æ˜¯ç»“åˆåˆšåˆšé‚£ä¸ªä¾‹å­æ¥è®²è§£ï¼Œæˆ‘ä»¬å°†ä¸Šé¢çš„ä»£ç ç¨å¾®æ”¹é€ ä¸€ä¸‹ï¼ŒæŠŠåˆ é™¤å…ƒç´ æ”¹ä¸ºæ·»åŠ å…ƒç´ ã€‚å…·ä½“çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>public class Demo {\n  public static void main(String[] args) {\n    List&lt;String&gt; names = new ArrayList&lt;&gt;();\n    names.add(&quot;a&quot;);\n    names.add(&quot;b&quot;);\n    names.add(&quot;c&quot;);\n    names.add(&quot;d&quot;);\n\n    Iterator&lt;String&gt; iterator = names.iterator();\n    iterator.next();\n    names.add(0, &quot;x&quot;);\n  }\n}\n</code></pre><p>åœ¨æ‰§è¡Œå®Œç¬¬10è¡Œä»£ç ä¹‹åï¼Œæ•°ç»„ä¸­åŒ…å«aã€bã€cã€då››ä¸ªå…ƒç´ ï¼Œæ¸¸æ ‡æŒ‡å‘bè¿™ä¸ªå…ƒç´ ï¼Œå·²ç»è·³è¿‡äº†å…ƒç´ aã€‚åœ¨æ‰§è¡Œå®Œç¬¬11è¡Œä»£ç ä¹‹åï¼Œæˆ‘ä»¬å°†xæ’å…¥åˆ°ä¸‹æ ‡ä¸º0çš„ä½ç½®ï¼Œaã€bã€cã€då››ä¸ªå…ƒç´ ä¾æ¬¡å¾€åç§»åŠ¨ä¸€ä½ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæ¸¸æ ‡åˆé‡æ–°æŒ‡å‘äº†å…ƒç´ aã€‚å…ƒç´ aè¢«æ¸¸æ ‡é‡å¤æŒ‡å‘ä¸¤æ¬¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå…ƒç´ aå­˜åœ¨è¢«é‡å¤éå†çš„æƒ…å†µã€‚</p><p>è·Ÿåˆ é™¤æƒ…å†µç±»ä¼¼ï¼Œå¦‚æœæˆ‘ä»¬åœ¨æ¸¸æ ‡çš„åé¢æ·»åŠ å…ƒç´ ï¼Œå°±ä¸ä¼šå­˜åœ¨ä»»ä½•é—®é¢˜ã€‚æ‰€ä»¥ï¼Œåœ¨éå†çš„åŒæ—¶æ·»åŠ é›†åˆå…ƒç´ ä¹Ÿæ˜¯ä¸€ç§ä¸å¯é¢„æœŸè¡Œä¸ºã€‚</p><p>åŒæ ·ï¼Œå¯¹äºä¸Šé¢çš„æ·»åŠ å…ƒç´ çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¹Ÿç”»äº†ä¸€å¼ å›¾ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œä½ å¯ä»¥å¯¹ç…§ç€ç†è§£ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/4c/d2/4cd27c2dcdb2be169ef30194899c19d2.jpg?wh=1649*1382\" alt=\"\"></p><h2>å¦‚ä½•åº”å¯¹éå†æ—¶æ”¹å˜é›†åˆå¯¼è‡´çš„æœªå†³è¡Œä¸ºï¼Ÿ</h2><p>å½“é€šè¿‡è¿­ä»£å™¨æ¥éå†é›†åˆçš„æ—¶å€™ï¼Œå¢åŠ ã€åˆ é™¤é›†åˆå…ƒç´ ä¼šå¯¼è‡´ä¸å¯é¢„æœŸçš„éå†ç»“æœã€‚å®é™…ä¸Šï¼Œâ€œä¸å¯é¢„æœŸâ€æ¯”ç›´æ¥å‡ºé”™æ›´åŠ å¯æ€•ï¼Œæœ‰çš„æ—¶å€™è¿è¡Œæ­£ç¡®ï¼Œæœ‰çš„æ—¶å€™è¿è¡Œé”™è¯¯ï¼Œä¸€äº›éšè—å¾ˆæ·±ã€å¾ˆéš¾debugçš„bugå°±æ˜¯è¿™ä¹ˆäº§ç”Ÿçš„ã€‚é‚£æˆ‘ä»¬å¦‚ä½•æ‰èƒ½é¿å…å‡ºç°è¿™ç§ä¸å¯é¢„æœŸçš„è¿è¡Œç»“æœå‘¢ï¼Ÿ</p><p>æœ‰ä¸¤ç§æ¯”è¾ƒå¹²è„†åˆ©ç´¢çš„è§£å†³æ–¹æ¡ˆï¼šä¸€ç§æ˜¯éå†çš„æ—¶å€™ä¸å…è®¸å¢åˆ å…ƒç´ ï¼Œå¦ä¸€ç§æ˜¯å¢åˆ å…ƒç´ ä¹‹åè®©éå†æŠ¥é”™ã€‚</p><p>å®é™…ä¸Šï¼Œç¬¬ä¸€ç§è§£å†³æ–¹æ¡ˆæ¯”è¾ƒéš¾å®ç°ï¼Œæˆ‘ä»¬è¦ç¡®å®šéå†å¼€å§‹å’Œç»“æŸçš„æ—¶é—´ç‚¹ã€‚éå†å¼€å§‹çš„æ—¶é—´èŠ‚ç‚¹æˆ‘ä»¬å¾ˆå®¹æ˜“è·å¾—ã€‚æˆ‘ä»¬å¯ä»¥æŠŠåˆ›å»ºè¿­ä»£å™¨çš„æ—¶é—´ç‚¹ä½œä¸ºéå†å¼€å§‹çš„æ—¶é—´ç‚¹ã€‚ä½†æ˜¯ï¼Œéå†ç»“æŸçš„æ—¶é—´ç‚¹è¯¥å¦‚ä½•æ¥ç¡®å®šå‘¢ï¼Ÿ</p><p>ä½ å¯èƒ½ä¼šè¯´ï¼Œéå†åˆ°æœ€åä¸€ä¸ªå…ƒç´ çš„æ—¶å€™å°±ç®—ç»“æŸå‘—ã€‚ä½†æ˜¯ï¼Œåœ¨å®é™…çš„è½¯ä»¶å¼€å‘ä¸­ï¼Œæ¯æ¬¡ä½¿ç”¨è¿­ä»£å™¨æ¥éå†å…ƒç´ ï¼Œå¹¶ä¸ä¸€å®šéè¦æŠŠæ‰€æœ‰å…ƒç´ éƒ½éå†ä¸€éã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘ä»¬æ‰¾åˆ°ä¸€ä¸ªå€¼ä¸ºbçš„å…ƒç´ å°±æå‰ç»“æŸäº†éå†ã€‚</p><pre><code>public class Demo {\n  public static void main(String[] args) {\n    List&lt;String&gt; names = new ArrayList&lt;&gt;();\n    names.add(&quot;a&quot;);\n    names.add(&quot;b&quot;);\n    names.add(&quot;c&quot;);\n    names.add(&quot;d&quot;);\n\n    Iterator&lt;String&gt; iterator = names.iterator();\n    while (iterator.hasNext()) {\n      String name = iterator.currentItem();\n      if (name.equals(&quot;b&quot;)) {\n        break;\n      }\n    }\n  }\n}\n</code></pre><p>ä½ å¯èƒ½è¿˜ä¼šè¯´ï¼Œé‚£æˆ‘ä»¬å¯ä»¥åœ¨è¿­ä»£å™¨ç±»ä¸­å®šä¹‰ä¸€ä¸ªæ–°çš„æ¥å£finishIteration()ï¼Œä¸»åŠ¨å‘ŠçŸ¥å®¹å™¨è¿­ä»£å™¨ä½¿ç”¨å®Œäº†ï¼Œä½ å¯ä»¥å¢åˆ å…ƒç´ äº†ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚ä½†æ˜¯ï¼Œè¿™å°±è¦æ±‚ç¨‹åºå‘˜åœ¨ä½¿ç”¨å®Œè¿­ä»£å™¨ä¹‹åè¦ä¸»åŠ¨è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œä¹Ÿå¢åŠ äº†å¼€å‘æˆæœ¬ï¼Œè¿˜å¾ˆå®¹æ˜“æ¼æ‰ã€‚</p><pre><code>public class Demo {\n  public static void main(String[] args) {\n    List&lt;String&gt; names = new ArrayList&lt;&gt;();\n    names.add(&quot;a&quot;);\n    names.add(&quot;b&quot;);\n    names.add(&quot;c&quot;);\n    names.add(&quot;d&quot;);\n\n    Iterator&lt;String&gt; iterator = names.iterator();\n    while (iterator.hasNext()) {\n      String name = iterator.currentItem();\n      if (name.equals(&quot;b&quot;)) {\n        iterator.finishIteration();//ä¸»åŠ¨å‘ŠçŸ¥å®¹å™¨è¿™ä¸ªè¿­ä»£å™¨ç”¨å®Œäº†\n        break;\n      }\n    }\n  }\n}\n</code></pre><p>å®é™…ä¸Šï¼Œç¬¬äºŒç§è§£å†³æ–¹æ³•æ›´åŠ åˆç†ã€‚Javaè¯­è¨€å°±æ˜¯é‡‡ç”¨çš„è¿™ç§è§£å†³æ–¹æ¡ˆï¼Œå¢åˆ å…ƒç´ ä¹‹åï¼Œè®©éå†æŠ¥é”™ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…·ä½“æ¥çœ‹ä¸€ä¸‹å¦‚ä½•å®ç°ã€‚</p><p>æ€ä¹ˆç¡®å®šåœ¨éå†æ—¶å€™ï¼Œé›†åˆæœ‰æ²¡æœ‰å¢åˆ å…ƒç´ å‘¢ï¼Ÿæˆ‘ä»¬åœ¨ArrayListä¸­å®šä¹‰ä¸€ä¸ªæˆå‘˜å˜é‡modCountï¼Œè®°å½•é›†åˆè¢«ä¿®æ”¹çš„æ¬¡æ•°ï¼Œé›†åˆæ¯è°ƒç”¨ä¸€æ¬¡å¢åŠ æˆ–åˆ é™¤å…ƒç´ çš„å‡½æ•°ï¼Œå°±ä¼šç»™modCountåŠ 1ã€‚å½“é€šè¿‡è°ƒç”¨é›†åˆä¸Šçš„iterator()å‡½æ•°æ¥åˆ›å»ºè¿­ä»£å™¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬æŠŠmodCountå€¼ä¼ é€’ç»™è¿­ä»£å™¨çš„expectedModCountæˆå‘˜å˜é‡ï¼Œä¹‹åæ¯æ¬¡è°ƒç”¨è¿­ä»£å™¨ä¸Šçš„hasNext()ã€next()ã€currentItem()å‡½æ•°ï¼Œæˆ‘ä»¬éƒ½ä¼šæ£€æŸ¥é›†åˆä¸Šçš„modCountæ˜¯å¦ç­‰äºexpectedModCountï¼Œä¹Ÿå°±æ˜¯çœ‹ï¼Œåœ¨åˆ›å»ºå®Œè¿­ä»£å™¨ä¹‹åï¼ŒmodCountæ˜¯å¦æ”¹å˜è¿‡ã€‚</p><p>å¦‚æœä¸¤ä¸ªå€¼ä¸ç›¸åŒï¼Œé‚£å°±è¯´æ˜é›†åˆå­˜å‚¨çš„å…ƒç´ å·²ç»æ”¹å˜äº†ï¼Œè¦ä¹ˆå¢åŠ äº†å…ƒç´ ï¼Œè¦ä¹ˆåˆ é™¤äº†å…ƒç´ ï¼Œä¹‹å‰åˆ›å»ºçš„è¿­ä»£å™¨å·²ç»ä¸èƒ½æ­£ç¡®è¿è¡Œäº†ï¼Œå†ç»§ç»­ä½¿ç”¨å°±ä¼šäº§ç”Ÿä¸å¯é¢„æœŸçš„ç»“æœï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©fail-fastè§£å†³æ–¹å¼ï¼ŒæŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ï¼Œç»“æŸæ‰ç¨‹åºï¼Œè®©ç¨‹åºå‘˜å°½å¿«ä¿®å¤è¿™ä¸ªå› ä¸ºä¸æ­£ç¡®ä½¿ç”¨è¿­ä»£å™¨è€Œäº§ç”Ÿçš„bugã€‚</p><p>ä¸Šé¢çš„æè¿°ç¿»è¯‘æˆä»£ç å°±æ˜¯ä¸‹é¢è¿™æ ·å­ã€‚ä½ å¯ä»¥ç»“åˆç€ä»£ç ä¸€èµ·ç†è§£æˆ‘åˆšæ‰çš„è®²è§£ã€‚</p><pre><code>public class ArrayIterator implements Iterator {\n  private int cursor;\n  private ArrayList arrayList;\n  private int expectedModCount;\n\n  public ArrayIterator(ArrayList arrayList) {\n    this.cursor = 0;\n    this.arrayList = arrayList;\n    this.expectedModCount = arrayList.modCount;\n  }\n\n  @Override\n  public boolean hasNext() {\n    checkForComodification();\n    return cursor &lt; arrayList.size();\n  }\n\n  @Override\n  public void next() {\n    checkForComodification();\n    cursor++;\n  }\n\n  @Override\n  public Object currentItem() {\n    checkForComodification();\n    return arrayList.get(cursor);\n  }\n  \n  private void checkForComodification() {\n    if (arrayList.modCount != expectedModCount)\n        throw new ConcurrentModificationException();\n  }\n}\n\n//ä»£ç ç¤ºä¾‹\npublic class Demo {\n  public static void main(String[] args) {\n    List&lt;String&gt; names = new ArrayList&lt;&gt;();\n    names.add(&quot;a&quot;);\n    names.add(&quot;b&quot;);\n    names.add(&quot;c&quot;);\n    names.add(&quot;d&quot;);\n\n    Iterator&lt;String&gt; iterator = names.iterator();\n    iterator.next();\n    names.remove(&quot;a&quot;);\n    iterator.next();//æŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸\n  }\n}\n</code></pre><h2>å¦‚ä½•åœ¨éå†çš„åŒæ—¶å®‰å…¨åœ°åˆ é™¤é›†åˆå…ƒç´ ï¼Ÿ</h2><p>åƒJavaè¯­è¨€ï¼Œè¿­ä»£å™¨ç±»ä¸­é™¤äº†å‰é¢æåˆ°çš„å‡ ä¸ªæœ€åŸºæœ¬çš„æ–¹æ³•ä¹‹å¤–ï¼Œè¿˜å®šä¹‰äº†ä¸€ä¸ªremove()æ–¹æ³•ï¼Œèƒ½å¤Ÿåœ¨éå†é›†åˆçš„åŒæ—¶ï¼Œå®‰å…¨åœ°åˆ é™¤é›†åˆä¸­çš„å…ƒç´ ã€‚ä¸è¿‡ï¼Œéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œå®ƒå¹¶æ²¡æœ‰æä¾›æ·»åŠ å…ƒç´ çš„æ–¹æ³•ã€‚æ¯•ç«Ÿè¿­ä»£å™¨çš„ä¸»è¦ä½œç”¨æ˜¯éå†ï¼Œæ·»åŠ å…ƒç´ æ”¾åˆ°è¿­ä»£å™¨é‡Œæœ¬èº«å°±ä¸åˆé€‚ã€‚</p><p>æˆ‘ä¸ªäººè§‰å¾—ï¼ŒJavaè¿­ä»£å™¨ä¸­æä¾›çš„remove()æ–¹æ³•è¿˜æ˜¯æ¯”è¾ƒé¸¡è‚‹çš„ï¼Œä½œç”¨æœ‰é™ã€‚å®ƒåªèƒ½åˆ é™¤æ¸¸æ ‡æŒ‡å‘çš„å‰ä¸€ä¸ªå…ƒç´ ï¼Œè€Œä¸”ä¸€ä¸ªnext()å‡½æ•°ä¹‹åï¼Œåªèƒ½è·Ÿç€æœ€å¤šä¸€ä¸ªremove()æ“ä½œï¼Œå¤šæ¬¡è°ƒç”¨remove()æ“ä½œä¼šæŠ¥é”™ã€‚æˆ‘è¿˜æ˜¯é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è§£é‡Šä¸€ä¸‹ã€‚</p><pre><code>public class Demo {\n  public static void main(String[] args) {\n    List&lt;String&gt; names = new ArrayList&lt;&gt;();\n    names.add(&quot;a&quot;);\n    names.add(&quot;b&quot;);\n    names.add(&quot;c&quot;);\n    names.add(&quot;d&quot;);\n\n    Iterator&lt;String&gt; iterator = names.iterator();\n    iterator.next();\n    iterator.remove();\n    iterator.remove(); //æŠ¥é”™ï¼ŒæŠ›å‡ºIllegalStateExceptionå¼‚å¸¸\n  }\n}\n</code></pre><p>ç°åœ¨ï¼Œæˆ‘ä»¬ä¸€å—æ¥çœ‹ä¸‹ï¼Œä¸ºä»€ä¹ˆé€šè¿‡è¿­ä»£å™¨å°±èƒ½å®‰å…¨çš„åˆ é™¤é›†åˆä¸­çš„å…ƒç´ å‘¢ï¼Ÿæºç ä¹‹ä¸‹æ— ç§˜å¯†ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹remove()å‡½æ•°æ˜¯å¦‚ä½•å®ç°çš„ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚ç¨å¾®æé†’ä¸€ä¸‹ï¼Œåœ¨Javaå®ç°ä¸­ï¼Œè¿­ä»£å™¨ç±»æ˜¯å®¹å™¨ç±»çš„å†…éƒ¨ç±»ï¼Œå¹¶ä¸”next()å‡½æ•°ä¸ä»…å°†æ¸¸æ ‡åç§»ä¸€ä½ï¼Œè¿˜ä¼šè¿”å›å½“å‰çš„å…ƒç´ ã€‚</p><pre><code>public class ArrayList&lt;E&gt; {\n  transient Object[] elementData;\n  private int size;\n\n  public Iterator&lt;E&gt; iterator() {\n    return new Itr();\n  }\n\n  private class Itr implements Iterator&lt;E&gt; {\n    int cursor;       // index of next element to return\n    int lastRet = -1; // index of last element returned; -1 if no such\n    int expectedModCount = modCount;\n\n    Itr() {}\n\n    public boolean hasNext() {\n      return cursor != size;\n    }\n\n    @SuppressWarnings(&quot;unchecked&quot;)\n    public E next() {\n      checkForComodification();\n      int i = cursor;\n      if (i &gt;= size)\n        throw new NoSuchElementException();\n      Object[] elementData = ArrayList.this.elementData;\n      if (i &gt;= elementData.length)\n        throw new ConcurrentModificationException();\n      cursor = i + 1;\n      return (E) elementData[lastRet = i];\n    }\n    \n    public void remove() {\n      if (lastRet &lt; 0)\n        throw new IllegalStateException();\n      checkForComodification();\n\n      try {\n        ArrayList.this.remove(lastRet);\n        cursor = lastRet;\n        lastRet = -1;\n        expectedModCount = modCount;\n      } catch (IndexOutOfBoundsException ex) {\n        throw new ConcurrentModificationException();\n      }\n    }\n  }\n}\n</code></pre><p>åœ¨ä¸Šé¢çš„ä»£ç å®ç°ä¸­ï¼Œè¿­ä»£å™¨ç±»æ–°å¢äº†ä¸€ä¸ªlastRetæˆå‘˜å˜é‡ï¼Œç”¨æ¥è®°å½•æ¸¸æ ‡æŒ‡å‘çš„å‰ä¸€ä¸ªå…ƒç´ ã€‚é€šè¿‡è¿­ä»£å™¨å»åˆ é™¤è¿™ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ–°è¿­ä»£å™¨ä¸­çš„æ¸¸æ ‡å’ŒlastRetå€¼ï¼Œæ¥ä¿è¯ä¸ä¼šå› ä¸ºåˆ é™¤å…ƒç´ è€Œå¯¼è‡´æŸä¸ªå…ƒç´ éå†ä¸åˆ°ã€‚å¦‚æœé€šè¿‡å®¹å™¨æ¥åˆ é™¤å…ƒç´ ï¼Œå¹¶ä¸”å¸Œæœ›æ›´æ–°è¿­ä»£å™¨ä¸­çš„æ¸¸æ ‡å€¼æ¥ä¿è¯éå†ä¸å‡ºé”™ï¼Œæˆ‘ä»¬å°±è¦ç»´æŠ¤è¿™ä¸ªå®¹å™¨éƒ½åˆ›å»ºäº†å“ªäº›è¿­ä»£å™¨ï¼Œæ¯ä¸ªè¿­ä»£å™¨æ˜¯å¦è¿˜åœ¨ä½¿ç”¨ç­‰ä¿¡æ¯ï¼Œä»£ç å®ç°å°±å˜å¾—æ¯”è¾ƒå¤æ‚äº†ã€‚</p><h2>é‡ç‚¹å›é¡¾</h2><p>å¥½äº†ï¼Œä»Šå¤©çš„å†…å®¹åˆ°æ­¤å°±è®²å®Œäº†ã€‚æˆ‘ä»¬ä¸€å—æ¥æ€»ç»“å›é¡¾ä¸€ä¸‹ï¼Œä½ éœ€è¦é‡ç‚¹æŒæ¡çš„å†…å®¹ã€‚</p><p>åœ¨é€šè¿‡è¿­ä»£å™¨æ¥éå†é›†åˆå…ƒç´ çš„åŒæ—¶ï¼Œå¢åŠ æˆ–è€…åˆ é™¤é›†åˆä¸­çš„å…ƒç´ ï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´æŸä¸ªå…ƒç´ è¢«é‡å¤éå†æˆ–éå†ä¸åˆ°ã€‚ä¸è¿‡ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰æƒ…å†µä¸‹éƒ½ä¼šéå†å‡ºé”™ï¼Œæœ‰çš„æ—¶å€™ä¹Ÿå¯ä»¥æ­£å¸¸éå†ï¼Œæ‰€ä»¥ï¼Œè¿™ç§è¡Œä¸ºç§°ä¸ºç»“æœä¸å¯é¢„æœŸè¡Œä¸ºæˆ–è€…æœªå†³è¡Œä¸ºã€‚å®é™…ä¸Šï¼Œâ€œä¸å¯é¢„æœŸâ€æ¯”ç›´æ¥å‡ºé”™æ›´åŠ å¯æ€•ï¼Œæœ‰çš„æ—¶å€™è¿è¡Œæ­£ç¡®ï¼Œæœ‰çš„æ—¶å€™è¿è¡Œé”™è¯¯ï¼Œä¸€äº›éšè—å¾ˆæ·±ã€å¾ˆéš¾debugçš„bugå°±æ˜¯è¿™ä¹ˆäº§ç”Ÿçš„ã€‚</p><p>æœ‰ä¸¤ç§æ¯”è¾ƒå¹²è„†åˆ©ç´¢çš„è§£å†³æ–¹æ¡ˆï¼Œæ¥é¿å…å‡ºç°è¿™ç§ä¸å¯é¢„æœŸçš„è¿è¡Œç»“æœã€‚ä¸€ç§æ˜¯éå†çš„æ—¶å€™ä¸å…è®¸å¢åˆ å…ƒç´ ï¼Œå¦ä¸€ç§æ˜¯å¢åˆ å…ƒç´ ä¹‹åè®©éå†æŠ¥é”™ã€‚ç¬¬ä¸€ç§è§£å†³æ–¹æ¡ˆæ¯”è¾ƒéš¾å®ç°ï¼Œå› ä¸ºå¾ˆéš¾ç¡®å®šè¿­ä»£å™¨ä½¿ç”¨ç»“æŸçš„æ—¶é—´ç‚¹ã€‚ç¬¬äºŒç§è§£å†³æ–¹æ¡ˆæ›´åŠ åˆç†ã€‚Javaè¯­è¨€å°±æ˜¯é‡‡ç”¨çš„è¿™ç§è§£å†³æ–¹æ¡ˆã€‚å¢åˆ å…ƒç´ ä¹‹åï¼Œæˆ‘ä»¬é€‰æ‹©fail-fastè§£å†³æ–¹å¼ï¼Œè®©éå†æ“ä½œç›´æ¥æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ã€‚</p><p>åƒJavaè¯­è¨€ï¼Œè¿­ä»£å™¨ç±»ä¸­é™¤äº†å‰é¢æåˆ°çš„å‡ ä¸ªæœ€åŸºæœ¬çš„æ–¹æ³•ä¹‹å¤–ï¼Œè¿˜å®šä¹‰äº†ä¸€ä¸ªremove()æ–¹æ³•ï¼Œèƒ½å¤Ÿåœ¨éå†é›†åˆçš„åŒæ—¶ï¼Œå®‰å…¨åœ°åˆ é™¤é›†åˆä¸­çš„å…ƒç´ ã€‚</p><h2>è¯¾å ‚è®¨è®º</h2><p>1ã€åŸºäºæ–‡ç« ä¸­ç»™å‡ºçš„Javaè¿­ä»£å™¨çš„å®ç°ä»£ç ï¼Œå¦‚æœä¸€ä¸ªå®¹å™¨å¯¹è±¡åŒæ—¶åˆ›å»ºäº†ä¸¤ä¸ªè¿­ä»£å™¨ï¼Œä¸€ä¸ªè¿­ä»£å™¨è°ƒç”¨äº†remove()æ–¹æ³•åˆ é™¤äº†é›†åˆä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼Œé‚£å¦ä¸€ä¸ªè¿­ä»£å™¨æ˜¯å¦è¿˜å¯ç”¨ï¼Ÿæˆ–è€…ï¼Œæˆ‘æ¢ä¸ªé—®æ³•ï¼Œä¸‹é¢ä»£ç ä¸­çš„ç¬¬13è¡Œçš„è¿è¡Œç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ</p><pre><code>public class Demo {\n  public static void main(String[] args) {\n    List&lt;String&gt; names = new ArrayList&lt;&gt;();\n    names.add(&quot;a&quot;);\n    names.add(&quot;b&quot;);\n    names.add(&quot;c&quot;);\n    names.add(&quot;d&quot;);\n\n    Iterator&lt;String&gt; iterator1 = names.iterator();\n    Iterator&lt;String&gt; iterator2 = names.iterator();\n    iterator1.next();\n    iterator1.remove();\n    iterator2.next(); // è¿è¡Œç»“æœï¼Ÿ\n  }\n}\n</code></pre><p>2ã€LinkedListåº•å±‚åŸºäºé“¾è¡¨ï¼Œå¦‚æœåœ¨éå†çš„åŒæ—¶ï¼Œå¢åŠ åˆ é™¤å…ƒç´ ï¼Œä¼šå‡ºç°å“ªäº›ä¸å¯é¢„æœŸçš„è¡Œä¸ºå‘¢ï¼Ÿ</p><p>æ¬¢è¿ç•™è¨€å’Œæˆ‘åˆ†äº«ä½ çš„æƒ³æ³•ã€‚å¦‚æœæœ‰æ”¶è·ï¼Œæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚</p>","comments":[{"had_liked":false,"id":202219,"user_name":"å°æ™å­","can_delete":false,"product_type":"c1","uid":1132337,"ip_address":"","ucode":"3AAA6FB5ACB6AE","user_header":"https://static001.geekbang.org/account/avatar/00/11/47/31/f35367c8.jpg","comment_is_top":false,"comment_ctime":1585925290,"is_pvip":false,"discussion_count":12,"race_medal":1,"score":"323708472490","product_id":100039001,"comment_content":"æ€è€ƒé¢˜ï¼š<br>1. iterator1 å’Œ iterator2æ˜¯ä¸¤ä¸ªä¸åŒçš„è¿­ä»£å™¨å¯¹è±¡ï¼Œä¿®æ”¹ä¸€ä¸ªä¸ä¼šå½±å“å¦å¤–ä¸€ä¸ªï¼Œæ‰€ä»¥æ‰§è¡Œiterator1.remove()åï¼Œå†æ‰§è¡Œiterator2.nextæ—¶ï¼Œä¼šæ‰§è¡ŒcheckForComodification();æ£€æŸ¥ï¼Œå¯æ˜¯æ£€æŸ¥æ¡ä»¶â€œarrayList.modCount != expectedModCountâ€ä¸­arrayListçš„modCountå·²ç»å˜æˆäº†5ï¼Œè€Œæ­¤æ—¶iterator2çš„expectedModCountè¿˜æ˜¯4ï¼Œæ‰€ä»¥è§¦å‘ConcurrentModificationExceptionå¼‚å¸¸ã€‚<br>2. LinkedListå’ŒArrayListä¸åŒæ˜¯LinkedListåº•å±‚åŸºäºé“¾è¡¨å®ç°ï¼Œå¢åŠ åˆ é™¤å…ƒç´ ä¸éœ€è¦ç§»åŠ¨å…ƒç´ çš„ä½ç½®ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°è·ŸArrayListä¸åŒçš„æƒ…å†µï¼Œæ¯”å¦‚å¢åŠ å…ƒç´ æ—¶ï¼Œä¸è®ºå¢åŠ çš„å…ƒç´ æ—¶åœ¨è¿­ä»£å™¨å‰è¿˜æ˜¯åï¼Œéƒ½èƒ½é€šè¿‡æŒ‡é’ˆå¯»å€åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚","like_count":76,"discussions":[{"author":{"id":1702886,"avatar":"https://static001.geekbang.org/account/avatar/00/19/fb/e6/1b9edb91.jpg","nickname":"ç»ƒä¹ ç”Ÿ","note":"","ucode":"60203A2AA0EA36","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":360799,"discussion_content":"æºç ä¸çœ‹ï¼Œä¹±ä¸‹å®šè®ºï¼Œè¿˜è¿™ä¹ˆå¤šèµï¼Œä½ è¦å¯¹å…¶ä»–é˜…è¯»çš„äººè´Ÿè´£ä»»çš„ï¼","likes_number":9,"is_delete":false,"is_hidden":false,"ctime":1616518108,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1691447,"avatar":"https://static001.geekbang.org/account/avatar/00/19/cf/37/6ed137b9.jpg","nickname":"Dunk","note":"","ucode":"A8F5AB98382719","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378410,"discussion_content":"é”™è¯¯çš„ç­”æ¡ˆå±…ç„¶è¿˜åœ¨ç¬¬ä¸€ä¸ªä½ç½®ï¼Œè¯¯äººå­å¼Ÿå§ï¼","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1623213377,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1020311,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/91/97/3762ca10.jpg","nickname":"å°æƒ…ç»ª","note":"","ucode":"92D8081DB8DB45","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312774,"discussion_content":"LinkedListå’ŒArraryListçš„æƒ…å†µä¸€æ ·ï¼Œéƒ½ä¼šå‡ºç°æœªå†³è¡Œä¸ºçš„ã€‚","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1602814186,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1554995,"avatar":"https://static001.geekbang.org/account/avatar/00/17/ba/33/2d83d174.jpg","nickname":"æ—¶å…‰å®ˆæŠ¤è€…-åŸºå…°","note":"","ucode":"F0B0887B1979D2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336960,"discussion_content":"ç»çœ‹LinkedListæºç ï¼Œæ·»åŠ æˆ–åˆ é™¤å…ƒç´ æ—¶ï¼ŒmodCountéƒ½ä¼šåšmodCount++æ“ä½œï¼Œæ‰€ä»¥å‡å¦‚åœ¨è¿­ä»£å™¨éå†è¿‡ç¨‹ä¸­æ·»åŠ æˆ–åˆ é™¤å…ƒç´ ï¼Œä¸‹ä¸€æ¬¡æ‰§è¡Œnext()è¿‡ç¨‹ä¸­ä¼šæ£€æŸ¥modCount å’ŒexpectedModCountï¼Œæ­¤æ—¶modCount != expectedModCountï¼Œä¼šæŠ›å‡ºConcurrentModificationException","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1608734334,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2690172,"avatar":"","nickname":"Geek_è®¾è®¡æ¨¡å¼ä¹‹ç¾","note":"","ucode":"59263416E65594","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385180,"discussion_content":"èƒ½ç»™å·®è¯„å—?","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1626935235,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1207079,"avatar":"https://static001.geekbang.org/account/avatar/00/12/6b/27/8c964e52.jpg","nickname":"ä¸æƒ‘ing","note":"","ucode":"AF04E417D38027","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":225433,"discussion_content":"æ–°å¢å…ƒç´ åœ¨æ¸¸æ ‡å‰éå†ä¸åˆ°ï¼Œåœ¨æ¸¸æ ‡åéå†çš„åˆ°ï¼Œè¿™ä¹Ÿç®—æ˜¯ä¸€ç§æœªå†³è¡Œä¸ºå§","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1586358626,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1131070,"avatar":"https://static001.geekbang.org/account/avatar/00/11/42/3e/c1f76202.jpg","nickname":"é’å±±","note":"","ucode":"749BAD1834AC0F","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":1207079,"avatar":"https://static001.geekbang.org/account/avatar/00/12/6b/27/8c964e52.jpg","nickname":"ä¸æƒ‘ing","note":"","ucode":"AF04E417D38027","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":292974,"discussion_content":"æ˜¯æœªå†³è¡Œä¸ºï¼Œä¸è¿‡åªè¦æœ‰å¢åˆ éƒ½ä¼šèµ°checkForComodificationï¼Œå°±ç›´æ¥å¼‚å¸¸äº†ã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1595400498,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":225433,"ip_address":""},"score":292974,"extra":""},{"author":{"id":2286788,"avatar":"https://static001.geekbang.org/account/avatar/00/22/e4/c4/065f8c0c.jpg","nickname":"Tom-TTC","note":"","ucode":"36AB0797D6FD3A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1131070,"avatar":"https://static001.geekbang.org/account/avatar/00/11/42/3e/c1f76202.jpg","nickname":"é’å±±","note":"","ucode":"749BAD1834AC0F","race_medal":1,"user_type":1,"is_pvip":false},"discussion":{"id":358879,"discussion_content":"è®¨è®ºé¢˜å¹¶ä¸æ˜¯é—®é›†åˆæ¡†æ¶æ˜¯æ€ä¹ˆè®¾è®¡çš„ï¼Œåªæ˜¯é—®å¦‚æ–‡ä¸­ä¸€æ ·å‡è®¾å¯ä»¥å¢åˆ ä¼šå‡ºç°å“ªäº›å¥‡æ€ªçš„ç»“æœã€‚ä½ è¯´çš„æ˜¯æœ€ç»ˆè®¾è®¡ï¼Œè‚¯å®šæ˜¯æŠ›å¼‚å¸¸ï¼Œå“ˆå“ˆå“ˆ(à²¡Ï‰à²¡)hiahiahia","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616070151,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":292974,"ip_address":""},"score":358879,"extra":""}]},{"author":{"id":1228852,"avatar":"https://static001.geekbang.org/account/avatar/00/12/c0/34/0574bb44.jpg","nickname":"æœ€åˆçš„å°è±¡","note":"","ucode":"4DD68307FA274E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558875,"discussion_content":"å°ç¼–èƒ½ä¸èƒ½æŠŠé”™è¯¯çš„è¯„è®ºåˆ é™¤ï¼Œè¿˜é‚£ä¹ˆå¤šç‚¹èµã€‚è¿™ä¸æ˜¯è¯¯å¯¼äººå®¶å—ï¼Ÿ","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1648517327,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2076251,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/ae/5b/4bd42286.jpg","nickname":"å®‹è®¡æ´‹","note":"","ucode":"9A34E8F71C6CBD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1228852,"avatar":"https://static001.geekbang.org/account/avatar/00/12/c0/34/0574bb44.jpg","nickname":"æœ€åˆçš„å°è±¡","note":"","ucode":"4DD68307FA274E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":561702,"discussion_content":"æˆ‘è§‰å¾—LinkedListæ˜¯å¯ä»¥ä¸æŠ›å¼‚å¸¸çš„ï¼Œä½†æºç åº”è¯¥æ˜¯ä¸ºäº†ä¿æŒä¸€è‡´","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649694996,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":558875,"ip_address":""},"score":561702,"extra":""}]},{"author":{"id":1138645,"avatar":"https://static001.geekbang.org/account/avatar/00/11/5f/d5/2fec2911.jpg","nickname":"yu","note":"","ucode":"56856DCC0C8387","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":252294,"discussion_content":"ä½†ä¸¤ä¸ªè¿­ä»£å™¨å¯¹è±¡å…±ç”¨ä¸€ä¸ªListå®¹å™¨å¯¹è±¡ï¼ŒmodCountæ˜¯å…±äº«çš„","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1588149708,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1887603,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/cd/73/f6889c2f.jpg","nickname":"Wind","note":"","ucode":"AD108636DE44C4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1138645,"avatar":"https://static001.geekbang.org/account/avatar/00/11/5f/d5/2fec2911.jpg","nickname":"yu","note":"","ucode":"56856DCC0C8387","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":298877,"discussion_content":"å¯¹modCountéƒ½æ„ŸçŸ¥äº†ï¼Œä½†æ˜¯expectedModCountä¸€ä¸ªå˜äº†ä¸€ä¸ªæ²¡å˜ï¼Œæ‰€ä»¥æ²¡å˜é‚£ä¸ªä¼šæŠ¥é”™","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1597458276,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":252294,"ip_address":""},"score":298877,"extra":""}]}]},{"had_liked":false,"id":201878,"user_name":"kyle","can_delete":false,"product_type":"c1","uid":1179158,"ip_address":"","ucode":"DB05C0F7D2C472","user_header":"https://static001.geekbang.org/account/avatar/00/11/fe/16/0f096793.jpg","comment_is_top":false,"comment_ctime":1585871891,"is_pvip":false,"discussion_count":6,"race_medal":0,"score":"78895283219","product_id":100039001,"comment_content":"è¿­ä»£å™¨ä¸­åˆ é™¤å…ƒç´ é‚£ä¸€æ®µï¼Œæ‰§è¡Œå®Œç¬¬57è¡Œ(åˆ é™¤aä»¥å)ï¼Œæ¸¸æ ‡åº”è¯¥æŒ‡å‘cï¼Œå›¾ä¸­æŒ‡å‘däº†","like_count":18},{"had_liked":false,"id":202120,"user_name":"Kenå¼ äº‘å¿ ","can_delete":false,"product_type":"c1","uid":1134288,"ip_address":"","ucode":"D0BAC9FC17DE2B","user_header":"https://static001.geekbang.org/account/avatar/00/11/4e/d0/d8a5f720.jpg","comment_is_top":false,"comment_ctime":1585905103,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"57420479951","product_id":100039001,"comment_content":"1.åŸºäºæ–‡ç« ä¸­ç»™å‡ºçš„ Java è¿­ä»£å™¨çš„å®ç°ä»£ç ï¼Œå¦‚æœä¸€ä¸ªå®¹å™¨å¯¹è±¡åŒæ—¶åˆ›å»ºäº†ä¸¤ä¸ªè¿­ä»£å™¨ï¼Œä¸€ä¸ªè¿­ä»£å™¨è°ƒç”¨äº† remove() æ–¹æ³•åˆ é™¤äº†é›†åˆä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼Œé‚£å¦ä¸€ä¸ªè¿­ä»£å™¨æ˜¯å¦è¿˜å¯ç”¨ï¼Ÿæˆ–è€…ï¼Œæˆ‘æ¢ä¸ªé—®æ³•ï¼Œä¸‹é¢ä»£ç ä¸­çš„ç¬¬ 13 è¡Œçš„è¿è¡Œç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ<br>Exception in thread &quot;main&quot; java.util.ConcurrentModificationException<br>å› ä¸ºiterator2.expectedModCountçš„å€¼ä¸names.modCountçš„å€¼ä¸ç›¸ç­‰,expectedModCountæ¯”modCountå°1.<br><br>2.LinkedList åº•å±‚åŸºäºé“¾è¡¨ï¼Œå¦‚æœåœ¨éå†çš„åŒæ—¶ï¼Œå¢åŠ åˆ é™¤å…ƒç´ ï¼Œä¼šå‡ºç°å“ªäº›ä¸å¯é¢„æœŸçš„è¡Œä¸ºå‘¢ï¼Ÿ<br>å½“åœ¨æ¸¸æ ‡åŠæ¸¸æ ‡ä¹‹å‰å¢åˆ å…ƒç´ æ—¶ä¼šä½¿æœ‰çš„å…ƒç´ éå†ä¸åˆ°;å½“åœ¨æ¸¸æ ‡ä¹‹åå¢åˆ å…ƒç´ æ—¶æ— é—®é¢˜.<br>LinkedListä¸ArrayListä¸€æ ·,å› ä¸ºéƒ½æ˜¯é›†æˆæŠ½è±¡ç±»java.util.AbstractList,<br>åœ¨éå†çš„åŒæ—¶è°ƒç”¨ä¸¤æ¬¡remove()éƒ½ä¼šæŠ›å‡ºå¼‚å¸¸,éƒ½ä¼šæŠ›å‡ºçš„æ˜¯java.lang.IllegalStateExceptionå¼‚å¸¸.<br>ä¸¤ä¸ªè¿­ä»£å™¨éå†çš„åŒæ—¶,å…¶ä¸­ä¸€ä¸ªè¿­ä»£å™¨åˆ é™¤å…ƒç´ éƒ½ä¼šä½¿å¦ä¸€ä¸ªè¿­ä»£å™¨æŠ›å‡ºjava.util.ConcurrentModificationExceptionå¼‚å¸¸.<br>éƒ½ä¸æ”¯æŒè¿­ä»£å™¨é‡Œæ·»åŠ å…ƒç´ .","like_count":14},{"had_liked":false,"id":201968,"user_name":"ï¼Œ","can_delete":false,"product_type":"c1","uid":1701867,"ip_address":"","ucode":"A5543C8DFEB198","user_header":"https://static001.geekbang.org/account/avatar/00/19/f7/eb/e7127bb8.jpg","comment_is_top":false,"comment_ctime":1585883048,"is_pvip":true,"discussion_count":13,"race_medal":0,"score":"57420457896","product_id":100039001,"comment_content":"1.ConcurrentModificationExceptionæ˜¯åœ¨è°ƒç”¨è¿­ä»£å™¨çš„nextæ–¹æ³•æ—¶äº§ç”Ÿ,å› ä¸ºè¿­ä»£å™¨2å¹¶æ²¡æœ‰ä½¿ç”¨,æ‰€ä»¥ä¸ä¼šæŠ¥é”™,å¦‚æœåœ¨ç¬¬13è¡Œè°ƒç”¨çš„æ˜¯iterator2.next()åˆ™ä¼šæŠ¥é”™(åŸå› :expectedModCountåœ¨æ–°å»ºè¿­ä»£å™¨çš„æ—¶å€™åˆå§‹åŒ–,è°ƒç”¨iterator1.remove()åªä¿®æ”¹iterator1çš„expectedModCount,ä¸ä¼šä¿®æ”¹iterator2çš„,æ‰€ä»¥åœ¨è°ƒç”¨iterator2.next()æ—¶ä¼šæŠ¥é”™)<br>2.ä½¿ç”¨è¿­ä»£å™¨éå†çš„åŒæ—¶,ä½¿ç”¨å®¹å™¨çš„æ–¹æ³•è¿›è¡Œå¢åˆ æ“ä½œä¹Ÿä¼šè§¦å‘ConcurrentModificationException,è¡Œä¸ºå’ŒArrayListæ˜¯ä¸€æ ·çš„<br><br>       æˆ‘æœ‰ä¸€ä¸ªé—®é¢˜æƒ³é—®è€å¸ˆ,æˆ‘æ˜¯åŸ¹è®­ç­å‡ºèº«,è€Œä¸”å­¦å†ä¸å¥½,è‡ªè§‰åŸºç¡€ä¸è¡Œ,æ‰€ä»¥ä»å·¥ä½œä»¥æ¥,åŸºæœ¬æ¯å¤©éƒ½åšæŒå­¦ä¹ ,å¦‚ä»Šå·²ç»å·¥ä½œä¸€å¹´å¤šäº†.å¯æ˜¯æˆ‘æ¯å¤©å­¦ä¹ ä¸¤ä¸‰ä¸ªé’Ÿå¤´å°±è§‰å¾—å¾ˆç´¯äº†,è„‘å­åƒæµ†ç³Šä¸€æ ·,æ²¡åŠæ³•ç»§ç»­å­¦æ–°ä¸œè¥¿äº†,æœ‰æ—¶å­¦ä¹ ä¸€æ•´å¤©,ä»ä¸Šç­å¼€å§‹å­¦,ä¸€ç›´å­¦åˆ°ä¸‹ç­,ä¸‹ç­çš„æ—¶å€™æ„Ÿè§‰è„‘å­éƒ½è¦æ‰­æ›²äº†,å¥½é•¿æ—¶é—´ç¼“è§£ä¸è¿‡æ¥,å‰å‡ å¤©å¬è¯´å»å“ªç½‘çš„å‰ç«¯æ¶æ„å¸ˆå»ä¸–äº†,å¹´é¾„æ‰30å²å‡ºå¤´,æˆ‘æ„Ÿè§‰æˆ‘ä¿æŒå½“ä¸‹è¿™ä¸ªçŠ¶æ€çš„è¯,åˆ°ä¸äº†ä»–çš„æ°´å¹³å°±å¾—çŒæ­»,æˆ‘æƒ³çŸ¥é“è€å¸ˆæ˜¯æ€ä¹ˆå¹³è¡¡æ—¥å¸¸ç”Ÿæ´»çš„?çœŸçš„æœ‰äººèƒ½åšæŒæ¯å¤©å­¦ä¹ åå‡ ä¸ªå°æ—¶å—?è¿™è®©æˆ‘è§‰å¾—ç‰¹åˆ«ç´¯,å–˜ä¸è¿‡æ°”æ¥","like_count":13,"discussions":[{"author":{"id":1114452,"avatar":"https://static001.geekbang.org/account/avatar/00/11/01/54/46266631.jpg","nickname":"gwen","note":"","ucode":"82A01FD8458671","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":135974,"discussion_content":"åŒé—®ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579103284,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":202670,"user_name":"å¿†æ°´å¯’","can_delete":false,"product_type":"c1","uid":1147453,"ip_address":"","ucode":"E3F86BD8AA8903","user_header":"https://static001.geekbang.org/account/avatar/00/11/82/3d/356fc3d6.jpg","comment_is_top":false,"comment_ctime":1586051023,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23060887503","product_id":100039001,"comment_content":"ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œç”±äºmodcountä¸ä¸€æ ·äº†ï¼Œæ‰€ä»¥ä¼šå‡ºç°å¼‚å¸¸ã€‚<br>ç¬¬äºŒä¸ªé—®é¢˜ï¼ŒLinkedListå’ŒArrayListè¡Œä¸ºä¸€è‡´ã€‚","like_count":6},{"had_liked":false,"id":201921,"user_name":"Jackie","can_delete":false,"product_type":"c1","uid":1179920,"ip_address":"","ucode":"B853ECB3E962C5","user_header":"https://static001.geekbang.org/account/avatar/00/12/01/10/cb36bfed.jpg","comment_is_top":false,"comment_ctime":1585877375,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23060713855","product_id":100039001,"comment_content":"ç»ˆäºæ˜ç™½æŠ¥ConcurrentModificationExceptionçš„çœŸæ­£åŸå› äº†","like_count":5},{"had_liked":false,"id":202014,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1585887684,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18765756868","product_id":100039001,"comment_content":"hpublic class Demo {<br>  public static void main(String[] args) {<br>    List&lt;String&gt; names = new ArrayList&lt;&gt;();<br>    names.add(&quot;a&quot;);<br>    names.add(&quot;b&quot;);<br>    names.add(&quot;c&quot;);<br>    names.add(&quot;d&quot;);<br>    Iterator&lt;String&gt; iterator1 = names.iterator();<br>    Iterator&lt;String&gt; iterator2 = names.iterator();<br>    iterator1.next();<br>    iterator1.remove();<br>    iterator1.next(); &#47;&#47; è¿è¡Œç»“æœï¼Ÿ<br>  }<br>}<br><br>å“ˆå“ˆè€å¸ˆçš„é¢˜ç›®ç¬”è¯¯äº†å§ã€‚<br>è¿è¡Œç»“æœé‚£è¡Œåº”è¯¥æ˜¯iterator2.next()ã€‚<br><br>ç„¶åç»“æœåº”è¯¥æ˜¯ä¼šæŠ›å¼‚å¸¸ï¼Œå› ä¸ºmodifyCountä¸ä¸€è‡´äº†ã€‚","like_count":4},{"had_liked":false,"id":201888,"user_name":"Liam","can_delete":false,"product_type":"c1","uid":1094597,"ip_address":"","ucode":"1D15D3B64F2606","user_header":"https://static001.geekbang.org/account/avatar/00/10/b3/c5/7fc124e2.jpg","comment_is_top":false,"comment_ctime":1585873871,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18765743055","product_id":100039001,"comment_content":"1 ç¬¬äºŒä¸ªè¿­ä»£å™¨ä¼šæŠ¥é”™ï¼ŒmodCountå‘ç”Ÿå˜åŒ–<br>2 é“¾è¡¨å¢åˆ ä¸å½±å“æ¸¸æ ‡ï¼Œä¸ä¼šå‡ºç°æ„å¤–","like_count":4},{"had_liked":false,"id":204608,"user_name":"ä¸œå¾","can_delete":false,"product_type":"c1","uid":1234314,"ip_address":"","ucode":"DC557A1631A493","user_header":"https://static001.geekbang.org/account/avatar/00/12/d5/8a/7050236a.jpg","comment_is_top":false,"comment_ctime":1586428912,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14471330800","product_id":100039001,"comment_content":"é—®é¢˜ä¸€ï¼Œå› ä¸ºæ¯ä¸ªiteratoréƒ½ä¼šä¿ç•™è‡ªå·±çš„expectModCountï¼Œè€ŒmodCountæ˜¯å…¨å±€çš„ï¼Œæ‰€ä»¥ä¼šæŠ›é”™ã€‚<br>é—®é¢˜äºŒï¼Œå› ä¸ºåº•å±‚å®ç°æ˜¯é“¾è¡¨ï¼Œæ‰€ä»¥è‹¥åœ¨æ¸¸æ ‡å‰æ–°å¢åˆ é™¤ï¼Œä¼šå¯¼è‡´æ•´ä½“éå†æ¼å¤„ç†æˆ–å¤šå¤„ç†ã€‚åœ¨æ¸¸æ ‡ä¸Šåˆ é™¤ï¼Œå¯¼è‡´åé¢çš„å†…å®¹æ— æ³•éå†ã€‚åœ¨æ¸¸æ ‡åæ–°å¢åˆ é™¤æ— å½±å“","like_count":3},{"had_liked":false,"id":201927,"user_name":"DexterPoker","can_delete":false,"product_type":"c1","uid":1612721,"ip_address":"","ucode":"F3A2094DA7CEF2","user_header":"https://static001.geekbang.org/account/avatar/00/18/9b/b1/61dd29ad.jpg","comment_is_top":false,"comment_ctime":1585878275,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14470780163","product_id":100039001,"comment_content":"è€å¸ˆçš„é¢˜ç›®æ˜¯ä¸æ˜¯<br>iterator1.next();<br>iterator1.remove();<br>iterator2.next(); &#47;&#47; è¿è¡Œç»“æœï¼Ÿ<br>å¦‚æœæ˜¯iterator1ï¼Œèƒ½æ­£å¸¸è¿è¡Œï¼›<br>å¦‚æœæ˜¯iterator2.next();å°±æŠ¥é”™äº†","like_count":3},{"had_liked":false,"id":213106,"user_name":"xk_","can_delete":false,"product_type":"c1","uid":1514305,"ip_address":"","ucode":"DFE1AC38EA78A7","user_header":"https://static001.geekbang.org/account/avatar/00/17/1b/41/dbb7d785.jpg","comment_is_top":false,"comment_ctime":1588302372,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10178236964","product_id":100039001,"comment_content":"1ã€ç»“è®ºï¼šæŠ¥é”™ã€‚ä¸¤ä¸ªè¿­ä»£å™¨å…±äº«modCountå±æ€§ï¼Œä¸€ä¸ªexpectedModCount--äº†ï¼Œå¦ä¸€ä¸ªæ²¡å˜ï¼Œæ‰€ä»¥æŠ¥é”™äº†ã€‚<br>2ã€å¦‚æœå…‰çœ‹é“¾è¡¨è¿™ä¸ªç»“æ„ï¼Œéå†æ—¶å¢åˆ å…ƒç´ æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚ä½†æ˜¯LinkedListæœ‰ç´¢å¼•è¿™ä¸ªå˜é‡ï¼Œæ‰€ä»¥åœ¨éå†æ—¶åœ¨æŒ‡é’ˆå‰å¢åˆ å…ƒç´ ï¼Œç´¢å¼•æ˜¯ä¼šå‡ºç°é—®é¢˜çš„ã€‚","like_count":2},{"had_liked":false,"id":206360,"user_name":"xzy","can_delete":false,"product_type":"c1","uid":1002095,"ip_address":"","ucode":"1A44368083A19E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4a/6f/e36b3908.jpg","comment_is_top":false,"comment_ctime":1586846955,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10176781547","product_id":100039001,"comment_content":"çœ‹äº†ArrayListå’ŒLinkedListçš„æºç ï¼Œæ¥å›ç­”æ€è€ƒé¢˜ï¼š<br>1ï¼Œä¼šæŠ›å‡º ConcurrentModificationException å¼‚å¸¸<br>2ï¼Œæ·»åŠ å…ƒç´ åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼šæ·»åŠ å…ƒç´ åœ¨æ¸¸æ ‡å‰ã€æ·»åŠ å…ƒç´ åœ¨æ¸¸æ ‡å<br>     æ¸¸æ ‡å‰ï¼šnextIndex = nextå…ƒç´ å®é™…çš„ä¸‹æ ‡ - 1ï¼Œæ‰€ä»¥hasNext()å‡½æ•°åœ¨next()è¿”å›é“¾è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ åä»ç„¶æˆç«‹<br>     æ¸¸æ ‡åï¼šæ— å½±å“<br>   åˆ é™¤å…ƒç´ ä¹Ÿåˆ†ä¸ºä¸‰ç§æƒ…å†µï¼šåˆ é™¤å…ƒç´ åœ¨æ¸¸æ ‡å‰ã€åˆ é™¤å…ƒç´ åœ¨æ¸¸æ ‡åã€åˆ é™¤æ¸¸æ ‡å…ƒç´ <br>     æ¸¸æ ‡å‰ï¼šnextIndex = nextå…ƒç´ çš„å®é™…ä¸‹æ ‡ + 1ï¼Œæ‰€æœ‰hasNext()å‡½æ•°åœ¨next()è¿”å›é“¾è¡¨æœ«å°¾ç¬¬äºŒä¸ªå…ƒç´ åä¾¿ä¸åœ¨æˆç«‹<br>     æ¸¸æ ‡åï¼šæ— å½±å“<br>     åˆ é™¤æ¸¸æ ‡å…ƒç´ ï¼šè®¿é—®å½“å‰æ¸¸æ ‡å…ƒç´ åé¢çš„å…ƒç´ æ—¶ä¼šæŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸<br><br>  &#47;**<br>  * LinkedList è¿­ä»£å™¨çš„éƒ¨åˆ†æºç <br>  * &#47;<br>  private class ListItr implements ListIterator&lt;E&gt; {<br>        private Node&lt;E&gt; lastReturned;<br>        private Node&lt;E&gt; next;<br>        private int nextIndex;<br>        private int expectedModCount = modCount;<br><br>        ListItr(int index) {<br>            &#47;&#47; assert isPositionIndex(index);<br>            next = (index == size) ? null : node(index);<br>            nextIndex = index;<br>        }<br><br>        public boolean hasNext() {<br>            return nextIndex &lt; size;<br>        }<br><br>        public E next() {<br>            checkForComodification();<br>            if (!hasNext())<br>                throw new NoSuchElementException();<br><br>            lastReturned = next;<br>            next = next.next;<br>            nextIndex++;<br>            return lastReturned.item;<br>        }<br><br>    }","like_count":2},{"had_liked":false,"id":202801,"user_name":"ç‰§å","can_delete":false,"product_type":"c1","uid":1020390,"ip_address":"","ucode":"193F0F33E1AB47","user_header":"https://static001.geekbang.org/account/avatar/00/0f/91/e6/03582dee.jpg","comment_is_top":false,"comment_ctime":1586071733,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10176006325","product_id":100039001,"comment_content":"`LinkedList åº•å±‚åŸºäºé“¾è¡¨ï¼Œå¦‚æœåœ¨éå†çš„åŒæ—¶ï¼Œå¢åŠ åˆ é™¤å…ƒç´ ï¼Œä¼šå‡ºç°å“ªäº›ä¸å¯é¢„æœŸçš„è¡Œä¸ºå‘¢`<br>1. å¢åŠ å…ƒç´ ï¼šå¦‚æœåœ¨å½“å‰å…ƒç´ ä¹‹å‰æ·»åŠ æ–°å…ƒç´ ï¼Œé‚£ä¹ˆæ–°å¢çš„å…ƒç´ ä¸ä¼šè¢«éå†åˆ°ï¼›å¦‚æœåœ¨å½“å‰å…ƒç´ ä¹‹åæ·»åŠ å…ƒç´ åˆ™ä¼šè¢«éå†åˆ°ï¼Œå­˜åœ¨æœªå†³è¡Œä¸ºã€‚<br>2. åˆ é™¤å…ƒç´ ï¼šå¦‚æœåˆ é™¤å½“å‰å…ƒç´ ä¹‹å‰çš„å…ƒç´ ï¼Œé‚£ä¹ˆè¿™ä¸ªè¢«åˆ é™¤çš„å…ƒç´ å…¶å®ä¹‹å‰å·²ç»è¢«éå†è¿‡äº†ï¼›å¦‚æœæ˜¯åˆ é™¤å½“å‰å…ƒç´ ä¹‹åçš„å…ƒç´ ï¼Œåˆ™è¢«åˆ é™¤å…ƒç´ å°†ä¸ä¼šè¢«éå†åˆ°ï¼›å¦‚æœæ­£å¥½æ˜¯åˆ é™¤å½“å‰å…ƒç´ ï¼Œé‚£ä¹ˆå½“å‰å…ƒç´ ä¹‹åçš„å…ƒç´ å°†ä¸ä¼šè¢«éå†åˆ°ï¼ŒåŒæ ·å­˜åœ¨æœªå†³è¡Œä¸ºã€‚","like_count":3},{"had_liked":false,"id":201895,"user_name":"test","can_delete":false,"product_type":"c1","uid":1065849,"ip_address":"","ucode":"9A4973E591DD12","user_header":"https://static001.geekbang.org/account/avatar/00/10/43/79/18073134.jpg","comment_is_top":false,"comment_ctime":1585874943,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10175809535","product_id":100039001,"comment_content":"1.ä¼šæŠ¥é”™ï¼ŒmodCountå˜äº†ï¼›<br>2.LinkedListä¹Ÿæ˜¯éœ€è¦ä½¿ç”¨è¿­ä»£å™¨çš„removeæ–¹æ³•ï¼Œä¸ç„¶ä¼šæœ‰ä¸å¯é¢„æœŸè¡Œä¸ºã€‚","like_count":2},{"had_liked":false,"id":201853,"user_name":"é©¬ä»¥","can_delete":false,"product_type":"c1","uid":1344431,"ip_address":"","ucode":"3FEA06CA14DE28","user_header":"https://static001.geekbang.org/account/avatar/00/14/83/af/1cb42cd3.jpg","comment_is_top":false,"comment_ctime":1585845285,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10175779877","product_id":100039001,"comment_content":"ä¸ä¼šæŠ¥é”™","like_count":2,"discussions":[{"author":{"id":1026039,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a7/f7/9e5409d0.jpg","nickname":"wanan","note":"","ucode":"C3957AFAC024F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":220475,"discussion_content":"ç¬¬12è¡Œåº”è¯¥æ˜¯ iterator2.next(); æ‰€ä»¥ä¼šæŠ¥é”™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585881630,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":203040,"user_name":"è‰ä¸Šé£è¶å·ğŸ™ˆ","can_delete":false,"product_type":"c1","uid":1604231,"ip_address":"","ucode":"DF06A06BE61317","user_header":"https://static001.geekbang.org/account/avatar/00/18/7a/87/668a4f38.jpg","comment_is_top":false,"comment_ctime":1586109048,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5881076344","product_id":100039001,"comment_content":"1ã€ä¼šæŠ¥é”™ã€‚è™½ç„¶è¿­ä»£å™¨è‡ªèº«çš„æ²¡æœ‰å˜ï¼Œä½†æ˜¯arraylistçš„å˜äº†ï¼Œå¯¼è‡´ä¸ç›¸ç­‰ï¼Œå› æ­¤ä¼šä»ç„¶æŠ¥é”™ã€‚<br>1ã€ä¼šå­˜åœ¨æœªè§‰è¡Œä¸ºã€‚ä¾‹å¦‚æ–°å¢çš„å…ƒç´ åœ¨cursorä¹‹å‰ä¼šéå†ä¸åˆ°æ–°å¢çš„å…ƒç´ ï¼Œå‡å¦‚æƒ…å†µ2ï¼Œæ–°å¢çš„å…ƒç´ æ°å¥½åœ¨å½“å‰cursorä¹‹åæ‰€æŒ‡çš„å…ƒç´ ï¼Œä¹Ÿéå†ä¸åˆ°æ–°å¢çš„å…ƒç´ ï¼Œå¦‚æœä¸è€ƒè™‘æ–°å¢çš„å…ƒç´ åç»­ä¸å†éå†çš„è¯ï¼Œå¢åŠ å…ƒç´ å°±ä¸å­˜åœ¨æœªè§‰è¡Œä¸ºã€‚åˆ é™¤çš„å…ƒç´ ä¸ºcursoræ‰€æŒ‡çš„å…ƒç´ æ—¶ï¼Œåç»­å…ƒç´ éå†ä¸åˆ°ã€‚ä¸ºäº†ç»Ÿä¸€å¢åŠ å’Œåˆ é™¤ï¼Œåº”è¯¥æ˜¯ä¼šæŠ¥é”™ã€‚å…·ä½“å¾…æŸ¥çœ‹ä»£ç éªŒè¯ã€‚","like_count":1},{"had_liked":false,"id":202802,"user_name":"ç‰§å","can_delete":false,"product_type":"c1","uid":1020390,"ip_address":"","ucode":"193F0F33E1AB47","user_header":"https://static001.geekbang.org/account/avatar/00/0f/91/e6/03582dee.jpg","comment_is_top":false,"comment_ctime":1586071896,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5881039192","product_id":100039001,"comment_content":"`åŸºäºæ–‡ç« ä¸­ç»™å‡ºçš„ Java è¿­ä»£å™¨çš„å®ç°ä»£ç ï¼Œå¦‚æœä¸€ä¸ªå®¹å™¨å¯¹è±¡åŒæ—¶åˆ›å»ºäº†ä¸¤ä¸ªè¿­ä»£å™¨ï¼Œä¸€ä¸ªè¿­ä»£å™¨è°ƒç”¨äº† remove() æ–¹æ³•åˆ é™¤äº†é›†åˆä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼Œé‚£å¦ä¸€ä¸ªè¿­ä»£å™¨æ˜¯å¦è¿˜å¯ç”¨ï¼Ÿæˆ–è€…ï¼Œæˆ‘æ¢ä¸ªé—®æ³•ï¼Œä¸‹é¢ä»£ç ä¸­çš„ç¬¬ 13 è¡Œçš„è¿è¡Œç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ`<br>åè°ƒç”¨removeçš„è¿­ä»£å™¨ä¼šå‡ºé”™ï¼Œå³iterator2.next()ä¼šæŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸","like_count":1},{"had_liked":false,"id":202559,"user_name":"å®ˆæ‹™","can_delete":false,"product_type":"c1","uid":1738326,"ip_address":"","ucode":"F594B2DA3F6D4F","user_header":"https://static001.geekbang.org/account/avatar/00/1a/86/56/509535da.jpg","comment_is_top":false,"comment_ctime":1586007623,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5880974919","product_id":100039001,"comment_content":"    &#47;**è¯¾å ‚è®¨è®º<br>     * 1:<br>     * å½“iterator1è°ƒç”¨è¿‡remove, iterator2#next()æ—¶,<br>     * Iterator#checkForComodification()ä¼šæ£€æŸ¥ Iterator#expectedModCount<br>     * ä¸ArrayList#modCountæ˜¯å¦ä¸€è‡´.<br>     *  ç”±äºIterator1#remove()æ—¶è°ƒç”¨äº†ArrayList#remove(),<br>     *  è€ŒArrayList#remove()è°ƒç”¨äº†updateSizeAndModCount()å¯¼è‡´ArrayList#modCountå‘ç”Ÿæ”¹å˜,<br>     *  æ‰€ä»¥iterator2#next()ä¼šfail-fast.<br>     *<br>     *  2:<br>     *  é¦–å…ˆ, LinkedList#iterator()è¿”å›çš„iteratorå®ä¾‹ä¸ArrayList#iterator()<br>     *  è¿”å›çš„å®ä¾‹å‡ºè‡ªäºåŒä¸€ä¸ªç±»: AbstractList#Iter.<br>     *  æ¢å¥è¯è¯´, LinkedList#iterator()ä¸ArrayList#iterator()çš„è¡Œä¸ºæ˜¯å®Œå…¨ä¸€è‡´çš„,<br>     *  ä¼šé€ æˆåŒæ ·çš„ä¸å¯é¢„æœŸç»“æœ.<br>     *<br>     *   *&#47;","like_count":1},{"had_liked":false,"id":202443,"user_name":"djfhchdh","can_delete":false,"product_type":"c1","uid":1484184,"ip_address":"","ucode":"E71D75328CE398","user_header":"https://static001.geekbang.org/account/avatar/00/16/a5/98/a65ff31a.jpg","comment_is_top":false,"comment_ctime":1585989350,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5880956646","product_id":100039001,"comment_content":"1ã€å› ä¸ºmodCountå’ŒexpectModCountä¸ä¸€è‡´ï¼Œiterator2åœ¨éå†æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ï¼›              2ã€å¦‚æœæ˜¯å•é“¾è¡¨ï¼Œå¦‚æœåœ¨æ¸¸æ ‡å¯¹åº”çš„å…ƒç´ ä¹‹å‰å¢åŠ å…ƒç´ ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ–°å¢åŠ çš„å…ƒç´ éå†ä¸åˆ°ï¼›å¦‚æœåˆ é™¤çš„æ°å¥½æ˜¯æ¸¸æ ‡å¯¹åº”çš„å…ƒç´ ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ— æ•ˆæŒ‡é’ˆé”™è¯¯ã€‚","like_count":1},{"had_liked":false,"id":202121,"user_name":"æ¯å¤©æ™’ç™½ç‰™","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1585905207,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"5880872503","product_id":100039001,"comment_content":"æ€è€ƒé¢˜1ï¼Œä¼šæŠ¥é”™ï¼Œiterator2ä¸­çš„ expectedModCount æ˜¯æœ€å¼€å§‹çš„ 4ï¼Œè€Œ names ä¸­çš„ modCount æ˜¯ 5ï¼Œæ‰€ä»¥æŠ¥é”™","like_count":1},{"had_liked":false,"id":202112,"user_name":"Kenå¼ äº‘å¿ ","can_delete":false,"product_type":"c1","uid":1134288,"ip_address":"","ucode":"D0BAC9FC17DE2B","user_header":"https://static001.geekbang.org/account/avatar/00/11/4e/d0/d8a5f720.jpg","comment_is_top":false,"comment_ctime":1585904022,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5880871318","product_id":100039001,"comment_content":"1.åŸºäºæ–‡ç« ä¸­ç»™å‡ºçš„ Java è¿­ä»£å™¨çš„å®ç°ä»£ç ï¼Œå¦‚æœä¸€ä¸ªå®¹å™¨å¯¹è±¡åŒæ—¶åˆ›å»ºäº†ä¸¤ä¸ªè¿­ä»£å™¨ï¼Œä¸€ä¸ªè¿­ä»£å™¨è°ƒç”¨äº† remove() æ–¹æ³•åˆ é™¤äº†é›†åˆä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼Œé‚£å¦ä¸€ä¸ªè¿­ä»£å™¨æ˜¯å¦è¿˜å¯ç”¨ï¼Ÿæˆ–è€…ï¼Œæˆ‘æ¢ä¸ªé—®æ³•ï¼Œä¸‹é¢ä»£ç ä¸­çš„ç¬¬ 13 è¡Œçš„è¿è¡Œç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ<br>Exception in thread &quot;main&quot; java.util.ConcurrentModificationException<br>å› ä¸ºiterator2.expectedModCountçš„å€¼ä¸names.modCountçš„å€¼ä¸ç›¸ç­‰,expectedModCountæ¯”modCountå°1.<br><br>2.LinkedList åº•å±‚åŸºäºé“¾è¡¨ï¼Œå¦‚æœåœ¨éå†çš„åŒæ—¶ï¼Œå¢åŠ åˆ é™¤å…ƒç´ ï¼Œä¼šå‡ºç°å“ªäº›ä¸å¯é¢„æœŸçš„è¡Œä¸ºå‘¢ï¼Ÿ<br>LinkedListä¸ArrayListä¸€æ ·,å› ä¸ºéƒ½æ˜¯é›†æˆæŠ½è±¡ç±»java.util.AbstractList,<br>åœ¨éå†çš„åŒæ—¶è°ƒç”¨ä¸¤æ¬¡remove()éƒ½ä¼šæŠ›å‡ºå¼‚å¸¸,éƒ½ä¼šæŠ›å‡ºçš„æ˜¯java.lang.IllegalStateExceptionå¼‚å¸¸.<br>ä¸¤ä¸ªè¿­ä»£å™¨éå†çš„åŒæ—¶,å…¶ä¸­ä¸€ä¸ªè¿­ä»£å™¨åˆ é™¤å…ƒç´ éƒ½ä¼šä½¿å¦ä¸€ä¸ªè¿­ä»£å™¨æŠ›å‡ºjava.util.ConcurrentModificationExceptionå¼‚å¸¸.<br>éƒ½ä¸æ”¯æŒè¿­ä»£å™¨é‡Œæ·»åŠ å…ƒç´ .","like_count":1},{"had_liked":false,"id":202058,"user_name":"æå°å››","can_delete":false,"product_type":"c1","uid":1112747,"ip_address":"","ucode":"2A766BE16B276B","user_header":"https://static001.geekbang.org/account/avatar/00/10/fa/ab/0d39e745.jpg","comment_is_top":false,"comment_ctime":1585895255,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5880862551","product_id":100039001,"comment_content":"è®¾è®¡æ¨¡å¼_66: <br># ä½œä¸š<br>1. (ä»£ç æœ‰é”™è¯¯: 13è¡Œåº”è¯¥æ˜¯`iterator2.next()`), åœ¨`checkForComodification`æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ã€‚å› ä¸º`iterator1`removeä¼šå¯¼è‡´`iterator2`çš„`expectedModCount`ä¸é›†åˆçš„`modCount`å°±ä¸ä¸€è‡´ã€‚<br>2. <br>- åˆ é™¤æ¸¸æ ‡ä¹‹å‰å…ƒç´ ï¼Œä¼šå¯¼è‡´éå†äº†å·²åˆ é™¤çš„å…ƒç´ ã€‚<br>- å¢åŠ æ¸¸æ ‡ä¹‹å‰çš„å…ƒç´ ï¼Œä¼šå¯¼è‡´æ–°å¢å…ƒç´ ä¸è¢«éå†ã€‚<br><br># æ„Ÿæƒ³<br>å¯¹äºâ€œä¸å¯é¢„æœŸç›´æ¥å‡ºé”™æ›´åŠ å¯æ€•â€æ„Ÿè§¦æ¯”è¾ƒæ·±ï¼Œå› ä¸ºç›´æ¥å‡ºé”™çš„é—®é¢˜ä¸€èˆ¬ä¼šåœ¨è‡ªæµ‹(æˆ–å•å…ƒæµ‹è¯•)æˆ–ææµ‹åæš´éœ²å‡ºæ¥ï¼Œçº¿ä¸Šäº§å“ä¸ä¼šæœ‰é—®é¢˜ã€‚äºæ˜¯ï¼Œâ€œä¸å¯é¢„æœŸâ€çš„é—®é¢˜æ›´å¤šåœ°ä¼šæš´éœ²åœ¨çº¿ä¸Šï¼Œæœ€ç»ˆç‰ºç‰²äº†ç”¨æˆ·ä½“éªŒã€‚","like_count":1},{"had_liked":false,"id":202052,"user_name":"å›å“¥èŠæŠ€æœ¯","can_delete":false,"product_type":"c1","uid":1325816,"ip_address":"","ucode":"2C9A22BCE4C79E","user_header":"https://static001.geekbang.org/account/avatar/00/14/3a/f8/c1a939e7.jpg","comment_is_top":false,"comment_ctime":1585893901,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5880861197","product_id":100039001,"comment_content":"æ— è®ºæ˜¯ArrayListè¿˜æ˜¯LinkedListï¼Œä½¿ç”¨iteratorçš„removeæ–¹æ³•æ¥removeå…ƒç´ åå†éå†ï¼Œéƒ½æ˜¯ä¸ä¼šæŠ¥é”™çš„ï¼Œä½¿ç”¨listä¸­çš„removeéƒ½ä¼šæŠ¥é”™ã€‚å› ä¸ºexpectedModCount != modCount<br>ä½†æ˜¯LinkedListåˆ é™¤å…ƒç´ ï¼Œå¹¶ä¸ä¼šç§»åŠ¨åé¢çš„å…ƒç´ ï¼Œæ‰€ä»¥ä¸å­˜åœ¨æ–‡ä¸­è¯´çš„éå†ä¸åˆ°çš„é—®é¢˜","like_count":1},{"had_liked":false,"id":202000,"user_name":"Heaven","can_delete":false,"product_type":"c1","uid":1694207,"ip_address":"","ucode":"FA33FBCC66C911","user_header":"https://static001.geekbang.org/account/avatar/00/19/d9/ff/b23018a6.jpg","comment_is_top":false,"comment_ctime":1585885795,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5880853091","product_id":100039001,"comment_content":"1.å®ç°ä¸­,removeæ–¹æ³•ä¸­,ä¼šåœ¨è°ƒç”¨é›†åˆçš„removeæ–¹æ³•å,å°†å½“å‰çš„ä¿®æ”¹é‡èµ‹å€¼åˆ°è¿™ä¸ªè¿­ä»£å™¨çš„å†…éƒ¨çš„ä¿®æ”¹é‡å±æ€§ä¸Š,ä½†æ˜¯å¯¹äºå…¶ä»–è¿­ä»£å™¨è°ƒç”¨çš„removeæ— æ³•æ„ŸçŸ¥,è‡ªç„¶æ— æ³•ä¿®æ”¹æœ¬è¿­ä»£å™¨å†…éƒ¨çš„ä¿®æ”¹é‡å±æ€§,å¯¼è‡´next()ä¼šåœ¨è°ƒç”¨checkForComodification()å‡½æ•°çš„æ—¶å€™å‘ç”ŸæŠ¥é”™<br>2.LinkedList,åœ¨å¢åˆ çš„æ—¶å€™,ç”±äºåŒå‘é“¾è¡¨çš„ç‰¹æ€§,åªèƒ½æ„ŸçŸ¥åˆ°ä¸Šä¸€ä½å’Œä¸‹ä¸€ä½,æ‰€ä»¥å¹¶ä¸ä¼šå¯¼è‡´å¼‚å¸¸æƒ…å†µçš„å‘ç”Ÿ","like_count":1},{"had_liked":false,"id":347893,"user_name":"Geek_7e0e83","can_delete":false,"product_type":"c1","uid":2142423,"ip_address":"","ucode":"554DEE2AAAE33C","user_header":"","comment_is_top":false,"comment_ctime":1654564431,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1654564431","product_id":100039001,"comment_content":"1.ä¼šæŠ›å‡ºConcurrentModificationExceptionçš„å¼‚å¸¸ï¼Œå› ä¸ºç¬¬äºŒä¸ªè¿­ä»£å™¨è°ƒç”¨nextçš„æ—¶å€™æ£€æŸ¥modCountæ—¶å·²ç»ä¸ä¸€è‡´äº†ã€‚<br>2.linkedList çš„è¿­ä»£å™¨å’ŒarrayListçš„å®ç°ç±»ä¼¼ï¼Œä¹Ÿä¼šæŠ›å‡ºConcurrentModificationExceptionã€‚åŸå› ä¹Ÿä¸€è‡´","like_count":0},{"had_liked":false,"id":343953,"user_name":"KK","can_delete":false,"product_type":"c1","uid":1324863,"ip_address":"","ucode":"FFC31A3FE3A285","user_header":"https://static001.geekbang.org/account/avatar/00/14/37/3f/a9127a73.jpg","comment_is_top":false,"comment_ctime":1651141551,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1651141551","product_id":100039001,"comment_content":"è¶Šåˆ°åé¢ï¼Œäººè¶Šå°‘å“¦ã€‚å“¦è±ã€‚","like_count":0},{"had_liked":false,"id":328314,"user_name":"idiot","can_delete":false,"product_type":"c1","uid":2526391,"ip_address":"","ucode":"D7A6E980B530B4","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/fcftgBsticCicEEkuzB0GTkHIocX62YVTSvnhR1c94sccj42lVaYXrmcZyhzUI3l9NcvuN1rXLhXt2eBrZZ0Tw7A/132","comment_is_top":false,"comment_ctime":1640663515,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1640663515","product_id":100039001,"comment_content":"è®¨è®ºé¢˜å±äºç»†èŠ‚äº†ï¼Œä¸å€¼å¾—æ·±ç©¶ã€‚ä½œä¸ºç”¨æˆ·æ¥è¯´ï¼Œç®€å•åœ°ä¸åœ¨éå†æ—¶ä¿®æ”¹å®¹å™¨å°±å¯¹äº†ã€‚è¿™èŠ‚è¯¾é‡è¦çš„æ¦‚å¿µæ˜¯ï¼Œä½œä¸ºæ¡†æ¶å¼€å‘è€…æ¥è¯´ï¼Œæ€ä¹ˆä¸»åŠ¨æ£€æµ‹ç”¨æˆ·çš„é”™è¯¯ä½¿ç”¨æ–¹å¼ï¼ˆå¦‚æœæ— æ³•é¿å…ï¼‰å¹¶æŠ¥é”™ã€‚","like_count":0},{"had_liked":false,"id":326852,"user_name":"HomeyLiu","can_delete":false,"product_type":"c1","uid":1330141,"ip_address":"","ucode":"EF4CCB92C369B4","user_header":"https://static001.geekbang.org/account/avatar/00/14/4b/dd/41614582.jpg","comment_is_top":false,"comment_ctime":1639721461,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1639721461","product_id":100039001,"comment_content":"LinkedListå’ŒArrayListè¡Œä¸ºä¸€è‡´ã€‚<br>æˆ‘çœ‹äº†LinkedListçš„æºç .æ·»åŠ å…ƒç´ å’Œå¢åŠ å…ƒç´ ,ä¸€æ ·ä¼šå¯¼è‡´æœªå†³è¡Œä¸ºç»“æœ.<br><br>æ²¡çœ‹æºç çš„ä¸è¦çé€¼é€¼!","like_count":0},{"had_liked":false,"id":275643,"user_name":"å­æˆ¿","can_delete":false,"product_type":"c1","uid":1438860,"ip_address":"","ucode":"CB05938C248BB3","user_header":"https://static001.geekbang.org/account/avatar/00/15/f4/8c/0866b228.jpg","comment_is_top":false,"comment_ctime":1611630368,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1611630368","product_id":100039001,"comment_content":"å­¦ä¹ äº†ï¼Œå¾ˆå—ç”¨","like_count":0},{"had_liked":false,"id":260001,"user_name":"ç“¶å­éœ¸å“¥","can_delete":false,"product_type":"c1","uid":1125806,"ip_address":"","ucode":"A7EEB459AB5550","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/nVVI6Fib5LHbhAhv8CJ9MYPau7Lcp840ST6BeqnlibUNmI4UYvGIzxtOHcKIzFa10ERANAZQUaiaKkQg4SowsUR2g/132","comment_is_top":false,"comment_ctime":1604905099,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1604905099","product_id":100039001,"comment_content":"ä¸ºä»€ä¹ˆæœ‰ lastRet å•Šï¼Œremove çš„æ—¶å€™ç›´æ¥è®© cursor -= 1 ä¸è¡Œå—","like_count":0,"discussions":[{"author":{"id":1363822,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/uktgj5R0p78c67oLib8EuRMRCgP8yjxnZ1ibVOuibhRZvjJpKSJNaTl0UlEfGyiaaiaGyPmqpGYpibTt0QopX1qtWfQQ/132","nickname":"æ¨å¤§å°æœ€å—¨çš®","note":"","ucode":"7DFACF1414AE16","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374968,"discussion_content":"ä¸ºäº†æ”¯æŒä»åå¾€å‰éå†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621423608,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":239724,"user_name":"Leon Wong","can_delete":false,"product_type":"c1","uid":1073650,"ip_address":"","ucode":"B49B327367CF9E","user_header":"https://static001.geekbang.org/account/avatar/00/10/61/f2/ca989d6f.jpg","comment_is_top":false,"comment_ctime":1596623415,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596623415","product_id":100039001,"comment_content":"æ€è€ƒé¢˜1ï¼š<br><br>å…³é”®ç‚¹åœ¨äº expectedModCount å˜é‡æ˜¯ Iterator ç»´æŠ¤çš„æœ¬åœ°å˜é‡ï¼Œå½“ä½¿ç”¨removeæ–¹æ³•çš„æ—¶å€™ä¼šä½¿å¾— modCountå‘ç”Ÿæ”¹å˜ï¼Œè€Œiterator2çš„æœ¬åœ°expectedModCountå˜é‡å¹¶æœªåŠæ—¶æ”¹å˜ï¼Œå› æ­¤ä¼šå‡ºç°æœªå†³è¡Œä¸º","like_count":0},{"had_liked":false,"id":204448,"user_name":"ä¸èƒ½å¿çš„åœ°ç²¾","can_delete":false,"product_type":"c1","uid":1754913,"ip_address":"","ucode":"66A921C0BC8102","user_header":"","comment_is_top":false,"comment_ctime":1586401553,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586401553","product_id":100039001,"comment_content":"æ€è€ƒé¢˜: 1. è¿è¡Œç»“æœæŠ¥é”™,å› ä¸ºç¬¬ä¸€ä¸ªè¿­ä»£å™¨remove()æ”¹å˜äº†modCountçš„å€¼å’ŒexceptModçš„å€¼,ä½†æ˜¯ç¬¬äºŒä¸ªæ²¡æœ‰æ”¹å˜","like_count":0},{"had_liked":false,"id":203287,"user_name":"LğŸš²ğŸ±","can_delete":false,"product_type":"c1","uid":1577856,"ip_address":"","ucode":"08A012739614DE","user_header":"https://static001.geekbang.org/account/avatar/00/18/13/80/2c9da1b1.jpg","comment_is_top":false,"comment_ctime":1586165853,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586165853","product_id":100039001,"comment_content":"æ‰“å¡ï¼Œé•¿çŸ¥è¯†äº†ï¼Œä»¥å‰åœ¨æ™®é€šfoeå¾ªç¯ä¸­ å†™è¿‡åˆ é™¤åå†è®¿é—®å…ƒç´ çš„ä»£ç ğŸ˜‚","like_count":0},{"had_liked":false,"id":203091,"user_name":"Geek_3b1096","can_delete":false,"product_type":"c1","uid":1549364,"ip_address":"","ucode":"A6BD92B79B3632","user_header":"","comment_is_top":false,"comment_ctime":1586138664,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586138664","product_id":100039001,"comment_content":"æ¸…æ¥šäº†è°¢è°¢è€å¸ˆ","like_count":0}]}