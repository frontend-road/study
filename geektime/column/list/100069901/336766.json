{"id":336766,"title":"03 | åŸºç¡€æ¶æ„ï¼šetcdä¸€ä¸ªå†™è¯·æ±‚æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å”èªã€‚</p><p>åœ¨ä¸Šä¸€èŠ‚è¯¾é‡Œï¼Œæˆ‘é€šè¿‡åˆ†æetcdçš„ä¸€ä¸ªè¯»è¯·æ±‚æ‰§è¡Œæµç¨‹ï¼Œç»™ä½ ä»‹ç»äº†etcdçš„åŸºç¡€æ¶æ„ï¼Œè®©ä½ åˆæ­¥äº†è§£äº†åœ¨etcdçš„è¯»è¯·æ±‚æµç¨‹ä¸­ï¼Œå„ä¸ªæ¨¡å—æ˜¯å¦‚ä½•ç´§å¯†åä½œï¼Œæ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œè¿”å›æ•°æ®ç»™clientã€‚</p><p>é‚£ä¹ˆetcdä¸€ä¸ªå†™è¯·æ±‚æ‰§è¡Œæµç¨‹åˆæ˜¯æ€æ ·çš„å‘¢ï¼Ÿåœ¨æ‰§è¡Œå†™è¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œå¦‚æœè¿›ç¨‹crashäº†ï¼Œå¦‚ä½•ä¿è¯æ•°æ®ä¸ä¸¢ã€å‘½ä»¤ä¸é‡å¤æ‰§è¡Œå‘¢ï¼Ÿ</p><p>ä»Šå¤©æˆ‘å°±å’Œä½ èŠèŠetcdå†™è¿‡ç¨‹ä¸­æ˜¯å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜çš„ã€‚å¸Œæœ›é€šè¿‡è¿™èŠ‚è¯¾ï¼Œè®©ä½ äº†è§£ä¸€ä¸ªkey-valueå†™å…¥çš„åŸç†ï¼Œå¯¹etcdçš„åŸºç¡€æ¶æ„ä¸­æ¶‰åŠå†™è¯·æ±‚ç›¸å…³çš„æ¨¡å—æœ‰ä¸€å®šçš„ç†è§£ï¼ŒåŒæ—¶èƒ½è§¦ç±»æ—é€šï¼Œå½“ä½ åœ¨è½¯ä»¶é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°ç±»ä¼¼æ•°æ®å®‰å…¨ã€å¹‚ç­‰æ€§ç­‰é—®é¢˜æ—¶ï¼Œèƒ½è®¾è®¡å‡ºè‰¯å¥½çš„æ–¹æ¡ˆè§£å†³å®ƒã€‚</p><h2>æ•´ä½“æ¶æ„</h2><p><img src=\"https://static001.geekbang.org/resource/image/8b/72/8b6dfa84bf8291369ea1803387906c72.png?wh=1920*1265\" alt=\"\"></p><p>ä¸ºäº†è®©ä½ èƒ½å¤Ÿæ›´ç›´è§‚åœ°ç†è§£etcdçš„å†™è¯·æ±‚æµç¨‹ï¼Œæˆ‘åœ¨å¦‚ä¸Šçš„æ¶æ„å›¾ä¸­ï¼Œç”¨åºå·æ ‡è¯†äº†ä¸‹é¢çš„ä¸€ä¸ªput helloä¸ºworldçš„å†™è¯·æ±‚çš„ç®€è¦æ‰§è¡Œæµç¨‹ï¼Œå¸®åŠ©ä½ ä»æ•´ä½“ä¸Šå¿«é€Ÿäº†è§£ä¸€ä¸ªå†™è¯·æ±‚çš„å…¨è²Œã€‚</p><pre><code>etcdctl put hello world --endpoints http://127.0.0.1:2379\nOK\n\n</code></pre><p>é¦–å…ˆclientç«¯é€šè¿‡è´Ÿè½½å‡è¡¡ç®—æ³•é€‰æ‹©ä¸€ä¸ªetcdèŠ‚ç‚¹ï¼Œå‘èµ·gRPCè°ƒç”¨ã€‚ç„¶åetcdèŠ‚ç‚¹æ”¶åˆ°è¯·æ±‚åç»è¿‡gRPCæ‹¦æˆªå™¨ã€Quotaæ¨¡å—åï¼Œè¿›å…¥KVServeræ¨¡å—ï¼ŒKVServeræ¨¡å—å‘Raftæ¨¡å—æäº¤ä¸€ä¸ªææ¡ˆï¼Œææ¡ˆå†…å®¹ä¸ºâ€œå¤§å®¶å¥½ï¼Œè¯·ä½¿ç”¨putæ–¹æ³•æ‰§è¡Œä¸€ä¸ªkeyä¸ºhelloï¼Œvalueä¸ºworldçš„å‘½ä»¤â€ã€‚</p><!-- [[[read_end]]] --><p>éšåæ­¤ææ¡ˆé€šè¿‡RaftHTTPç½‘ç»œæ¨¡å—è½¬å‘ã€ç»è¿‡é›†ç¾¤å¤šæ•°èŠ‚ç‚¹æŒä¹…åŒ–åï¼ŒçŠ¶æ€ä¼šå˜æˆå·²æäº¤ï¼Œetcdserverä»Raftæ¨¡å—è·å–å·²æäº¤çš„æ—¥å¿—æ¡ç›®ï¼Œä¼ é€’ç»™Applyæ¨¡å—ï¼ŒApplyæ¨¡å—é€šè¿‡MVCCæ¨¡å—æ‰§è¡Œææ¡ˆå†…å®¹ï¼Œæ›´æ–°çŠ¶æ€æœºã€‚</p><p>ä¸è¯»æµç¨‹ä¸ä¸€æ ·çš„æ˜¯å†™æµç¨‹è¿˜æ¶‰åŠQuotaã€WALã€Applyä¸‰ä¸ªæ¨¡å—ã€‚crash-safeåŠå¹‚ç­‰æ€§ä¹Ÿæ­£æ˜¯åŸºäºWALå’ŒApplyæµç¨‹çš„consistent indexç­‰å®ç°çš„ï¼Œå› æ­¤ä»Šå¤©æˆ‘ä¼šé‡ç‚¹å’Œä½ ä»‹ç»è¿™ä¸‰ä¸ªæ¨¡å—ã€‚</p><p>ä¸‹é¢å°±è®©æˆ‘ä»¬æ²¿ç€å†™è¯·æ±‚æ‰§è¡Œæµç¨‹å›¾ï¼Œä»0åˆ°1åˆ†æä¸€ä¸ªkey-valueæ˜¯å¦‚ä½•å®‰å…¨ã€å¹‚ç­‰åœ°æŒä¹…åŒ–åˆ°ç£ç›˜çš„ã€‚</p><h2>Quotaæ¨¡å—</h2><p>é¦–å…ˆæ˜¯æµç¨‹ä¸€clientç«¯å‘èµ·gRPCè°ƒç”¨åˆ°etcdèŠ‚ç‚¹ï¼Œå’Œè¯»è¯·æ±‚ä¸ä¸€æ ·çš„æ˜¯ï¼Œå†™è¯·æ±‚éœ€è¦ç»è¿‡æµç¨‹äºŒdbé…é¢ï¼ˆQuotaï¼‰æ¨¡å—ï¼Œå®ƒæœ‰ä»€ä¹ˆåŠŸèƒ½å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å…ˆä»æ­¤æ¨¡å—çš„ä¸€ä¸ªå¸¸è§é”™è¯¯è¯´èµ·ï¼Œä½ åœ¨ä½¿ç”¨etcdè¿‡ç¨‹ä¸­æ˜¯å¦é‡åˆ°è¿‡\"etcdserver: mvcc: database space exceeded\"é”™è¯¯å‘¢ï¼Ÿ</p><p>æˆ‘ç›¸ä¿¡åªè¦ä½ ä½¿ç”¨è¿‡etcdæˆ–è€…Kubernetesï¼Œå¤§æ¦‚ç‡è§è¿‡è¿™ä¸ªé”™è¯¯ã€‚å®ƒæ˜¯æŒ‡å½“å‰etcd dbæ–‡ä»¶å¤§å°è¶…è¿‡äº†é…é¢ï¼Œå½“å‡ºç°æ­¤é”™è¯¯åï¼Œä½ çš„æ•´ä¸ªé›†ç¾¤å°†ä¸å¯å†™å…¥ï¼Œåªè¯»ï¼Œå¯¹ä¸šåŠ¡çš„å½±å“éå¸¸å¤§ã€‚</p><p>å“ªäº›æƒ…å†µä¼šè§¦å‘è¿™ä¸ªé”™è¯¯å‘¢ï¼Ÿ</p><p>ä¸€æ–¹é¢é»˜è®¤dbé…é¢ä»…ä¸º2Gï¼Œå½“ä½ çš„ä¸šåŠ¡æ•°æ®ã€å†™å…¥QPSã€Kubernetesé›†ç¾¤è§„æ¨¡å¢å¤§åï¼Œä½ çš„etcd dbå¤§å°å°±å¯èƒ½ä¼šè¶…è¿‡2Gã€‚</p><p>å¦ä¸€æ–¹é¢æˆ‘ä»¬çŸ¥é“etcd v3æ˜¯ä¸ªMVCCæ•°æ®åº“ï¼Œä¿å­˜äº†keyçš„å†å²ç‰ˆæœ¬ï¼Œå½“ä½ æœªé…ç½®å‹ç¼©ç­–ç•¥çš„æ—¶å€™ï¼Œéšç€æ•°æ®ä¸æ–­å†™å…¥ï¼Œdbå¤§å°ä¼šä¸æ–­å¢å¤§ï¼Œå¯¼è‡´è¶…é™ã€‚</p><p>æœ€åä½ è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯etcd 3.2.10ä¹‹å‰çš„æ—§ç‰ˆæœ¬ï¼Œè¯·æ³¨æ„å¤‡ä»½å¯èƒ½ä¼šè§¦å‘boltdbçš„ä¸€ä¸ªBugï¼Œå®ƒä¼šå¯¼è‡´dbå¤§å°ä¸æ–­ä¸Šæ¶¨ï¼Œæœ€ç»ˆè¾¾åˆ°é…é¢é™åˆ¶ã€‚</p><p>äº†è§£å®Œè§¦å‘Quotaé™åˆ¶çš„åŸå› åï¼Œæˆ‘ä»¬å†è¯¦ç»†äº†è§£ä¸‹Quotaæ¨¡å—å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><p>å½“etcd serveræ”¶åˆ°put/txnç­‰å†™è¯·æ±‚çš„æ—¶å€™ï¼Œä¼šé¦–å…ˆæ£€æŸ¥ä¸‹å½“å‰etcd dbå¤§å°åŠ ä¸Šä½ è¯·æ±‚çš„key-valueå¤§å°ä¹‹å’Œæ˜¯å¦è¶…è¿‡äº†é…é¢ï¼ˆquota-backend-bytesï¼‰ã€‚</p><p>å¦‚æœè¶…è¿‡äº†é…é¢ï¼Œå®ƒä¼šäº§ç”Ÿä¸€ä¸ªå‘Šè­¦ï¼ˆAlarmï¼‰è¯·æ±‚ï¼Œå‘Šè­¦ç±»å‹æ˜¯NO SPACEï¼Œå¹¶é€šè¿‡Raftæ—¥å¿—åŒæ­¥ç»™å…¶å®ƒèŠ‚ç‚¹ï¼Œå‘ŠçŸ¥dbæ— ç©ºé—´äº†ï¼Œå¹¶å°†å‘Šè­¦æŒä¹…åŒ–å­˜å‚¨åˆ°dbä¸­ã€‚</p><p>æœ€ç»ˆï¼Œæ— è®ºæ˜¯APIå±‚gRPCæ¨¡å—è¿˜æ˜¯è´Ÿè´£å°†Raftä¾§å·²æäº¤çš„æ—¥å¿—æ¡ç›®åº”ç”¨åˆ°çŠ¶æ€æœºçš„Applyæ¨¡å—ï¼Œéƒ½æ‹’ç»å†™å…¥ï¼Œé›†ç¾¤åªè¯»ã€‚</p><p>é‚£é‡åˆ°è¿™ä¸ªé”™è¯¯æ—¶åº”è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p><p>é¦–å…ˆå½“ç„¶æ˜¯è°ƒå¤§é…é¢ã€‚å…·ä½“å¤šå¤§åˆé€‚å‘¢ï¼Ÿetcdç¤¾åŒºå»ºè®®ä¸è¶…è¿‡8Gã€‚é‡åˆ°è¿‡è¿™ä¸ªé”™è¯¯çš„ä½ æ˜¯å¦è¿˜è®°å¾—ï¼Œä¸ºä»€ä¹ˆå½“ä½ æŠŠé…é¢ï¼ˆquota-backend-bytesï¼‰è°ƒå¤§åï¼Œé›†ç¾¤ä¾ç„¶æ‹’ç»å†™å…¥å‘¢?</p><p>åŸå› å°±æ˜¯æˆ‘ä»¬å‰é¢æåˆ°çš„NO SPACEå‘Šè­¦ã€‚Applyæ¨¡å—åœ¨æ‰§è¡Œæ¯ä¸ªå‘½ä»¤çš„æ—¶å€™ï¼Œéƒ½ä¼šå»æ£€æŸ¥å½“å‰æ˜¯å¦å­˜åœ¨NO SPACEå‘Šè­¦ï¼Œå¦‚æœæœ‰åˆ™æ‹’ç»å†™å…¥ã€‚æ‰€ä»¥è¿˜éœ€è¦ä½ é¢å¤–å‘é€ä¸€ä¸ªå–æ¶ˆå‘Šè­¦ï¼ˆetcdctl alarm disarmï¼‰çš„å‘½ä»¤ï¼Œä»¥æ¶ˆé™¤æ‰€æœ‰å‘Šè­¦ã€‚</p><p>å…¶æ¬¡ä½ éœ€è¦æ£€æŸ¥etcdçš„å‹ç¼©ï¼ˆcompactï¼‰é…ç½®æ˜¯å¦å¼€å¯ã€é…ç½®æ˜¯å¦åˆç†ã€‚etcdä¿å­˜äº†ä¸€ä¸ªkeyæ‰€æœ‰å˜æ›´å†å²ç‰ˆæœ¬ï¼Œå¦‚æœæ²¡æœ‰ä¸€ä¸ªæœºåˆ¶å»å›æ”¶æ—§çš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå†…å­˜å’Œdbå¤§å°å°±ä¼šä¸€ç›´è†¨èƒ€ï¼Œåœ¨etcdé‡Œé¢ï¼Œå‹ç¼©æ¨¡å—è´Ÿè´£å›æ”¶æ—§ç‰ˆæœ¬çš„å·¥ä½œã€‚</p><p>å‹ç¼©æ¨¡å—æ”¯æŒæŒ‰å¤šç§æ–¹å¼å›æ”¶æ—§ç‰ˆæœ¬ï¼Œæ¯”å¦‚ä¿ç•™æœ€è¿‘ä¸€æ®µæ—¶é—´å†…çš„å†å²ç‰ˆæœ¬ã€‚ä¸è¿‡ä½ è¦æ³¨æ„ï¼Œå®ƒä»…ä»…æ˜¯å°†æ—§ç‰ˆæœ¬å ç”¨çš„ç©ºé—´æ‰“ä¸ªç©ºé—²ï¼ˆFreeï¼‰æ ‡è®°ï¼Œåç»­æ–°çš„æ•°æ®å†™å…¥çš„æ—¶å€™å¯å¤ç”¨è¿™å—ç©ºé—´ï¼Œè€Œæ— éœ€ç”³è¯·æ–°çš„ç©ºé—´ã€‚</p><p>å¦‚æœä½ éœ€è¦å›æ”¶ç©ºé—´ï¼Œå‡å°‘dbå¤§å°ï¼Œå¾—ä½¿ç”¨ç¢ç‰‡æ•´ç†ï¼ˆdefragï¼‰ï¼Œ å®ƒä¼šéå†æ—§çš„dbæ–‡ä»¶æ•°æ®ï¼Œå†™å…¥åˆ°ä¸€ä¸ªæ–°çš„dbæ–‡ä»¶ã€‚ä½†æ˜¯å®ƒå¯¹æœåŠ¡æ€§èƒ½æœ‰è¾ƒå¤§å½±å“ï¼Œä¸å»ºè®®ä½ åœ¨ç”Ÿäº§é›†ç¾¤é¢‘ç¹ä½¿ç”¨ã€‚</p><p>æœ€åä½ éœ€è¦æ³¨æ„é…é¢ï¼ˆquota-backend-bytesï¼‰çš„è¡Œä¸ºï¼Œé»˜è®¤'0'å°±æ˜¯ä½¿ç”¨etcdé»˜è®¤çš„2GBå¤§å°ï¼Œä½ éœ€è¦æ ¹æ®ä½ çš„ä¸šåŠ¡åœºæ™¯é€‚å½“è°ƒä¼˜ã€‚å¦‚æœä½ å¡«çš„æ˜¯ä¸ªå°äº0çš„æ•°ï¼Œå°±ä¼šç¦ç”¨é…é¢åŠŸèƒ½ï¼Œè¿™å¯èƒ½ä¼šè®©ä½ çš„dbå¤§å°å¤„äºå¤±æ§ï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œä¸å»ºè®®ä½ ç¦ç”¨é…é¢ã€‚</p><h2>KVServeræ¨¡å—</h2><p>é€šè¿‡æµç¨‹äºŒçš„é…é¢æ£€æŸ¥åï¼Œè¯·æ±‚å°±ä»APIå±‚è½¬å‘åˆ°äº†æµç¨‹ä¸‰çš„KVServeræ¨¡å—çš„putæ–¹æ³•ï¼Œæˆ‘ä»¬çŸ¥é“etcdæ˜¯åŸºäºRaftç®—æ³•å®ç°èŠ‚ç‚¹é—´æ•°æ®å¤åˆ¶çš„ï¼Œå› æ­¤å®ƒéœ€è¦å°†putå†™è¯·æ±‚å†…å®¹æ‰“åŒ…æˆä¸€ä¸ªææ¡ˆæ¶ˆæ¯ï¼Œæäº¤ç»™Raftæ¨¡å—ã€‚ä¸è¿‡KVServeræ¨¡å—åœ¨æäº¤ææ¡ˆå‰ï¼Œè¿˜æœ‰å¦‚ä¸‹çš„ä¸€ç³»åˆ—æ£€æŸ¥å’Œé™é€Ÿã€‚</p><h3>Preflight Check</h3><p>ä¸ºäº†ä¿è¯é›†ç¾¤ç¨³å®šæ€§ï¼Œé¿å…é›ªå´©ï¼Œä»»ä½•æäº¤åˆ°Raftæ¨¡å—çš„è¯·æ±‚ï¼Œéƒ½ä¼šåšä¸€äº›ç®€å•çš„é™é€Ÿåˆ¤æ–­ã€‚å¦‚ä¸‹é¢çš„æµç¨‹å›¾æ‰€ç¤ºï¼Œé¦–å…ˆï¼Œå¦‚æœRaftæ¨¡å—å·²æäº¤çš„æ—¥å¿—ç´¢å¼•ï¼ˆcommitted indexï¼‰æ¯”å·²åº”ç”¨åˆ°çŠ¶æ€æœºçš„æ—¥å¿—ç´¢å¼•ï¼ˆapplied indexï¼‰è¶…è¿‡äº†5000ï¼Œé‚£ä¹ˆå®ƒå°±è¿”å›ä¸€ä¸ª\"etcdserver: too many requests\"é”™è¯¯ç»™clientã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/dc/54/dc8e373e06f2ab5f63a7948c4a6c8554.png?wh=1164*1004\" alt=\"\"></p><p>ç„¶åå®ƒä¼šå°è¯•å»è·å–è¯·æ±‚ä¸­çš„é‰´æƒä¿¡æ¯ï¼Œè‹¥ä½¿ç”¨äº†å¯†ç é‰´æƒã€è¯·æ±‚ä¸­æºå¸¦äº†tokenï¼Œå¦‚æœtokenæ— æ•ˆï¼Œåˆ™è¿”å›\"auth: invalid auth token\"é”™è¯¯ç»™clientã€‚</p><p>å…¶æ¬¡å®ƒä¼šæ£€æŸ¥ä½ å†™å…¥çš„åŒ…å¤§å°æ˜¯å¦è¶…è¿‡é»˜è®¤çš„1.5MBï¼Œ å¦‚æœè¶…è¿‡äº†ä¼šè¿”å›\"etcdserver: request is too large\"é”™è¯¯ç»™ç»™clientã€‚</p><h3>Propose</h3><p>æœ€åé€šè¿‡ä¸€ç³»åˆ—æ£€æŸ¥ä¹‹åï¼Œä¼šç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„IDï¼Œå°†æ­¤è¯·æ±‚å…³è”åˆ°ä¸€ä¸ªå¯¹åº”çš„æ¶ˆæ¯é€šçŸ¥channelï¼Œç„¶åå‘Raftæ¨¡å—å‘èµ·ï¼ˆProposeï¼‰ä¸€ä¸ªææ¡ˆï¼ˆProposalï¼‰ï¼Œææ¡ˆå†…å®¹ä¸ºâ€œå¤§å®¶å¥½ï¼Œè¯·ä½¿ç”¨putæ–¹æ³•æ‰§è¡Œä¸€ä¸ªkeyä¸ºhelloï¼Œvalueä¸ºworldçš„å‘½ä»¤â€ï¼Œä¹Ÿå°±æ˜¯æ•´ä½“æ¶æ„å›¾é‡Œçš„æµç¨‹å››ã€‚</p><p>å‘Raftæ¨¡å—å‘èµ·ææ¡ˆåï¼ŒKVServeræ¨¡å—ä¼šç­‰å¾…æ­¤putè¯·æ±‚ï¼Œç­‰å¾…å†™å…¥ç»“æœé€šè¿‡æ¶ˆæ¯é€šçŸ¥channelè¿”å›æˆ–è€…è¶…æ—¶ã€‚etcdé»˜è®¤è¶…æ—¶æ—¶é—´æ˜¯7ç§’ï¼ˆ5ç§’ç£ç›˜IOå»¶æ—¶+2*1ç§’ç«é€‰è¶…æ—¶æ—¶é—´ï¼‰ï¼Œå¦‚æœä¸€ä¸ªè¯·æ±‚è¶…æ—¶æœªè¿”å›ç»“æœï¼Œåˆ™å¯èƒ½ä¼šå‡ºç°ä½ ç†Ÿæ‚‰çš„etcdserver: request timed outé”™è¯¯ã€‚</p><h2>WALæ¨¡å—</h2><p>Raftæ¨¡å—æ”¶åˆ°ææ¡ˆåï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹æ˜¯Followerï¼Œå®ƒä¼šè½¬å‘ç»™Leaderï¼Œåªæœ‰Leaderæ‰èƒ½å¤„ç†å†™è¯·æ±‚ã€‚Leaderæ”¶åˆ°ææ¡ˆåï¼Œé€šè¿‡Raftæ¨¡å—è¾“å‡ºå¾…è½¬å‘ç»™FollowerèŠ‚ç‚¹çš„æ¶ˆæ¯å’Œå¾…æŒä¹…åŒ–çš„æ—¥å¿—æ¡ç›®ï¼Œæ—¥å¿—æ¡ç›®åˆ™å°è£…äº†æˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„put helloææ¡ˆå†…å®¹ã€‚</p><p>etcdserverä»Raftæ¨¡å—è·å–åˆ°ä»¥ä¸Šæ¶ˆæ¯å’Œæ—¥å¿—æ¡ç›®åï¼Œä½œä¸ºLeaderï¼Œå®ƒä¼šå°†putææ¡ˆæ¶ˆæ¯å¹¿æ’­ç»™é›†ç¾¤å„ä¸ªèŠ‚ç‚¹ï¼ŒåŒæ—¶éœ€è¦æŠŠé›†ç¾¤Leaderä»»æœŸå·ã€æŠ•ç¥¨ä¿¡æ¯ã€å·²æäº¤ç´¢å¼•ã€ææ¡ˆå†…å®¹æŒä¹…åŒ–åˆ°ä¸€ä¸ªWALï¼ˆWrite Ahead Logï¼‰æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œç”¨äºä¿è¯é›†ç¾¤çš„ä¸€è‡´æ€§ã€å¯æ¢å¤æ€§ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å›¾ä¸­çš„æµç¨‹äº”æ¨¡å—ã€‚</p><p>WALæ—¥å¿—ç»“æ„æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p><p><img src=\"https://static001.geekbang.org/resource/image/47/8d/479dec62ed1c31918a7c6cab8e6aa18d.png?wh=1920*1335\" alt=\"\"></p><p>ä¸Šå›¾æ˜¯WALç»“æ„ï¼Œå®ƒç”±å¤šç§ç±»å‹çš„WALè®°å½•é¡ºåºè¿½åŠ å†™å…¥ç»„æˆï¼Œæ¯ä¸ªè®°å½•ç”±ç±»å‹ã€æ•°æ®ã€å¾ªç¯å†—ä½™æ ¡éªŒç ç»„æˆã€‚ä¸åŒç±»å‹çš„è®°å½•é€šè¿‡Typeå­—æ®µåŒºåˆ†ï¼ŒDataä¸ºå¯¹åº”è®°å½•å†…å®¹ï¼ŒCRCä¸ºå¾ªç¯æ ¡éªŒç ä¿¡æ¯ã€‚</p><p>WALè®°å½•ç±»å‹ç›®å‰æ”¯æŒ5ç§ï¼Œåˆ†åˆ«æ˜¯æ–‡ä»¶å…ƒæ•°æ®è®°å½•ã€æ—¥å¿—æ¡ç›®è®°å½•ã€çŠ¶æ€ä¿¡æ¯è®°å½•ã€CRCè®°å½•ã€å¿«ç…§è®°å½•ï¼š</p><ul>\n<li>æ–‡ä»¶å…ƒæ•°æ®è®°å½•åŒ…å«èŠ‚ç‚¹IDã€é›†ç¾¤IDä¿¡æ¯ï¼Œå®ƒåœ¨WALæ–‡ä»¶åˆ›å»ºçš„æ—¶å€™å†™å…¥ï¼›</li>\n<li>æ—¥å¿—æ¡ç›®è®°å½•åŒ…å«Raftæ—¥å¿—ä¿¡æ¯ï¼Œå¦‚putææ¡ˆå†…å®¹ï¼›</li>\n<li>çŠ¶æ€ä¿¡æ¯è®°å½•ï¼ŒåŒ…å«é›†ç¾¤çš„ä»»æœŸå·ã€èŠ‚ç‚¹æŠ•ç¥¨ä¿¡æ¯ç­‰ï¼Œä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­ä¼šæœ‰å¤šæ¡ï¼Œä»¥æœ€åçš„è®°å½•ä¸ºå‡†ï¼›</li>\n<li>CRCè®°å½•åŒ…å«ä¸Šä¸€ä¸ªWALæ–‡ä»¶çš„æœ€åçš„CRCï¼ˆå¾ªç¯å†—ä½™æ ¡éªŒç ï¼‰ä¿¡æ¯ï¼Œ åœ¨åˆ›å»ºã€åˆ‡å‰²WALæ–‡ä»¶æ—¶ï¼Œä½œä¸ºç¬¬ä¸€æ¡è®°å½•å†™å…¥åˆ°æ–°çš„WALæ–‡ä»¶ï¼Œ ç”¨äºæ ¡éªŒæ•°æ®æ–‡ä»¶çš„å®Œæ•´æ€§ã€å‡†ç¡®æ€§ç­‰ï¼›</li>\n<li>å¿«ç…§è®°å½•åŒ…å«å¿«ç…§çš„ä»»æœŸå·ã€æ—¥å¿—ç´¢å¼•ä¿¡æ¯ï¼Œç”¨äºæ£€æŸ¥å¿«ç…§æ–‡ä»¶çš„å‡†ç¡®æ€§ã€‚</li>\n</ul><p>WALæ¨¡å—åˆæ˜¯å¦‚ä½•æŒä¹…åŒ–ä¸€ä¸ªputææ¡ˆçš„æ—¥å¿—æ¡ç›®ç±»å‹è®°å½•å‘¢?</p><p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹putå†™è¯·æ±‚å¦‚ä½•å°è£…åœ¨Raftæ—¥å¿—æ¡ç›®é‡Œé¢ã€‚ä¸‹é¢æ˜¯Raftæ—¥å¿—æ¡ç›®çš„æ•°æ®ç»“æ„ä¿¡æ¯ï¼Œå®ƒç”±ä»¥ä¸‹å­—æ®µç»„æˆï¼š</p><ul>\n<li>Termæ˜¯Leaderä»»æœŸå·ï¼Œéšç€Leaderé€‰ä¸¾å¢åŠ ï¼›</li>\n<li>Indexæ˜¯æ—¥å¿—æ¡ç›®çš„ç´¢å¼•ï¼Œå•è°ƒé€’å¢å¢åŠ ï¼›</li>\n<li>Typeæ˜¯æ—¥å¿—ç±»å‹ï¼Œæ¯”å¦‚æ˜¯æ™®é€šçš„å‘½ä»¤æ—¥å¿—ï¼ˆEntryNormalï¼‰è¿˜æ˜¯é›†ç¾¤é…ç½®å˜æ›´æ—¥å¿—ï¼ˆEntryConfChangeï¼‰ï¼›</li>\n<li>Dataä¿å­˜æˆ‘ä»¬ä¸Šé¢æè¿°çš„putææ¡ˆå†…å®¹ã€‚</li>\n</ul><pre><code>type Entry struct {\n   Term             uint64    `protobuf:&quot;varintï¼Œ2ï¼Œoptï¼Œname=Term&quot; json:&quot;Term&quot;`\n   Index            uint64    `protobuf:&quot;varintï¼Œ3ï¼Œoptï¼Œname=Index&quot; json:&quot;Index&quot;`\n   Type             EntryType `protobuf:&quot;varintï¼Œ1ï¼Œoptï¼Œname=Typeï¼Œenum=Raftpb.EntryType&quot; json:&quot;Type&quot;`\n   Data             []byte    `protobuf:&quot;bytesï¼Œ4ï¼Œoptï¼Œname=Data&quot; json:&quot;Dataï¼Œomitempty&quot;`\n}\n</code></pre><p>äº†è§£å®ŒRaftæ—¥å¿—æ¡ç›®æ•°æ®ç»“æ„åï¼Œæˆ‘ä»¬å†çœ‹WALæ¨¡å—å¦‚ä½•æŒä¹…åŒ–Raftæ—¥å¿—æ¡ç›®ã€‚å®ƒé¦–å…ˆå…ˆå°†Raftæ—¥å¿—æ¡ç›®å†…å®¹ï¼ˆå«ä»»æœŸå·ã€ç´¢å¼•ã€ææ¡ˆå†…å®¹ï¼‰åºåˆ—åŒ–åä¿å­˜åˆ°WALè®°å½•çš„Dataå­—æ®µï¼Œ ç„¶åè®¡ç®—Dataçš„CRCå€¼ï¼Œè®¾ç½®Typeä¸ºEntry Typeï¼Œ ä»¥ä¸Šä¿¡æ¯å°±ç»„æˆäº†ä¸€ä¸ªå®Œæ•´çš„WALè®°å½•ã€‚</p><p>æœ€åè®¡ç®—WALè®°å½•çš„é•¿åº¦ï¼Œé¡ºåºå…ˆå†™å…¥WALé•¿åº¦ï¼ˆLen Fieldï¼‰ï¼Œç„¶åå†™å…¥è®°å½•å†…å®¹ï¼Œè°ƒç”¨fsyncæŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå®Œæˆå°†æ—¥å¿—æ¡ç›®ä¿å­˜åˆ°æŒä¹…åŒ–å­˜å‚¨ä¸­ã€‚</p><p>å½“ä¸€åŠä»¥ä¸ŠèŠ‚ç‚¹æŒä¹…åŒ–æ­¤æ—¥å¿—æ¡ç›®åï¼Œ Raftæ¨¡å—å°±ä¼šé€šè¿‡channelå‘ŠçŸ¥etcdserveræ¨¡å—ï¼Œputææ¡ˆå·²ç»è¢«é›†ç¾¤å¤šæ•°èŠ‚ç‚¹ç¡®è®¤ï¼Œææ¡ˆçŠ¶æ€ä¸ºå·²æäº¤ï¼Œä½ å¯ä»¥æ‰§è¡Œæ­¤ææ¡ˆå†…å®¹äº†ã€‚</p><p>äºæ˜¯è¿›å…¥æµç¨‹å…­ï¼Œetcdserveræ¨¡å—ä»channelå–å‡ºææ¡ˆå†…å®¹ï¼Œæ·»åŠ åˆ°å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰è°ƒåº¦é˜Ÿåˆ—ï¼Œéšåé€šè¿‡Applyæ¨¡å—æŒ‰å…¥é˜Ÿé¡ºåºï¼Œå¼‚æ­¥ã€ä¾æ¬¡æ‰§è¡Œææ¡ˆå†…å®¹ã€‚</p><h2>Applyæ¨¡å—</h2><p>æ‰§è¡Œputææ¡ˆå†…å®¹å¯¹åº”æˆ‘ä»¬æ¶æ„å›¾ä¸­çš„æµç¨‹ä¸ƒï¼Œå…¶ç»†èŠ‚å›¾å¦‚ä¸‹ã€‚é‚£ä¹ˆApplyæ¨¡å—æ˜¯å¦‚ä½•æ‰§è¡Œputè¯·æ±‚çš„å‘¢ï¼Ÿè‹¥putè¯·æ±‚ææ¡ˆåœ¨æ‰§è¡Œæµç¨‹ä¸ƒçš„æ—¶å€™etcdçªç„¶crashäº†ï¼Œ é‡å¯æ¢å¤çš„æ—¶å€™ï¼Œetcdæ˜¯å¦‚ä½•æ‰¾å›å¼‚å¸¸ææ¡ˆï¼Œå†æ¬¡æ‰§è¡Œçš„å‘¢ï¼Ÿ</p><p><img src=\"https://static001.geekbang.org/resource/image/7f/5b/7f13edaf28yy7a6698e647104771235b.png?wh=1920*641\" alt=\"\"></p><p>æ ¸å¿ƒå°±æ˜¯æˆ‘ä»¬ä¸Šé¢ä»‹ç»çš„WALæ—¥å¿—ï¼Œå› ä¸ºæäº¤ç»™Applyæ¨¡å—æ‰§è¡Œçš„ææ¡ˆå·²è·å¾—å¤šæ•°èŠ‚ç‚¹ç¡®è®¤ã€æŒä¹…åŒ–ï¼Œetcdé‡å¯æ—¶ï¼Œä¼šä»WALä¸­è§£æå‡ºRaftæ—¥å¿—æ¡ç›®å†…å®¹ï¼Œè¿½åŠ åˆ°Raftæ—¥å¿—çš„å­˜å‚¨ä¸­ï¼Œå¹¶é‡æ”¾å·²æäº¤çš„æ—¥å¿—ææ¡ˆç»™Applyæ¨¡å—æ‰§è¡Œã€‚</p><p>ç„¶è€Œè¿™åˆå¼•å‘äº†å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•ç¡®ä¿å¹‚ç­‰æ€§ï¼Œé˜²æ­¢ææ¡ˆé‡å¤æ‰§è¡Œå¯¼è‡´æ•°æ®æ··ä¹±å‘¢?</p><p>æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚è¯¾é‡Œè®²åˆ°ï¼Œetcdæ˜¯ä¸ªMVCCæ•°æ®åº“ï¼Œæ¯æ¬¡æ›´æ–°éƒ½ä¼šç”Ÿæˆæ–°çš„ç‰ˆæœ¬å·ã€‚å¦‚æœæ²¡æœ‰å¹‚ç­‰æ€§ä¿æŠ¤ï¼ŒåŒæ ·çš„å‘½ä»¤ï¼Œä¸€éƒ¨åˆ†èŠ‚ç‚¹æ‰§è¡Œä¸€æ¬¡ï¼Œä¸€éƒ¨åˆ†èŠ‚ç‚¹é­é‡å¼‚å¸¸æ•…éšœåæ‰§è¡Œå¤šæ¬¡ï¼Œåˆ™ç³»ç»Ÿçš„å„èŠ‚ç‚¹ä¸€è‡´æ€§çŠ¶æ€æ— æ³•å¾—åˆ°ä¿è¯ï¼Œå¯¼è‡´æ•°æ®æ··ä¹±ï¼Œè¿™æ˜¯ä¸¥é‡æ•…éšœã€‚</p><p>å› æ­¤etcdå¿…é¡»è¦ç¡®ä¿å¹‚ç­‰æ€§ã€‚æ€ä¹ˆåšå‘¢ï¼ŸApplyæ¨¡å—ä»Raftæ¨¡å—è·å¾—çš„æ—¥å¿—æ¡ç›®ä¿¡æ¯é‡Œï¼Œæ˜¯å¦æœ‰å”¯ä¸€çš„å­—æ®µèƒ½æ ‡è¯†è¿™ä¸ªææ¡ˆï¼Ÿ</p><p>ç­”æ¡ˆå°±æ˜¯æˆ‘ä»¬ä¸Šé¢ä»‹ç»Raftæ—¥å¿—æ¡ç›®ä¸­çš„ç´¢å¼•ï¼ˆindexï¼‰å­—æ®µã€‚æ—¥å¿—æ¡ç›®ç´¢å¼•æ˜¯å…¨å±€å•è°ƒé€’å¢çš„ï¼Œæ¯ä¸ªæ—¥å¿—æ¡ç›®ç´¢å¼•å¯¹åº”ä¸€ä¸ªææ¡ˆï¼Œ å¦‚æœä¸€ä¸ªå‘½ä»¤æ‰§è¡Œåï¼Œæˆ‘ä»¬åœ¨dbé‡Œé¢ä¹Ÿè®°å½•ä¸‹å½“å‰å·²ç»æ‰§è¡Œè¿‡çš„æ—¥å¿—æ¡ç›®ç´¢å¼•ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥è§£å†³å¹‚ç­‰æ€§é—®é¢˜å‘¢ï¼Ÿ</p><p>æ˜¯çš„ã€‚ä½†æ˜¯è¿™è¿˜ä¸å¤Ÿå®‰å…¨ï¼Œå¦‚æœæ‰§è¡Œå‘½ä»¤çš„è¯·æ±‚æ›´æ–°æˆåŠŸäº†ï¼Œæ›´æ–°indexçš„è¯·æ±‚å´å¤±è´¥äº†ï¼Œæ˜¯ä¸æ˜¯ä¸€æ ·ä¼šå¯¼è‡´å¼‚å¸¸ï¼Ÿ</p><p>å› æ­¤æˆ‘ä»¬åœ¨å®ç°ä¸Šï¼Œè¿˜éœ€è¦å°†ä¸¤ä¸ªæ“ä½œä½œä¸ºåŸå­æ€§äº‹åŠ¡æäº¤ï¼Œæ‰èƒ½å®ç°å¹‚ç­‰ã€‚</p><p>æ­£å¦‚æˆ‘ä»¬ä¸Šé¢çš„è®¨è®ºçš„è¿™æ ·ï¼Œetcdé€šè¿‡å¼•å…¥ä¸€ä¸ªconsistent indexçš„å­—æ®µï¼Œæ¥å­˜å‚¨ç³»ç»Ÿå½“å‰å·²ç»æ‰§è¡Œè¿‡çš„æ—¥å¿—æ¡ç›®ç´¢å¼•ï¼Œå®ç°å¹‚ç­‰æ€§ã€‚</p><p>Applyæ¨¡å—åœ¨æ‰§è¡Œææ¡ˆå†…å®¹å‰ï¼Œé¦–å…ˆä¼šåˆ¤æ–­å½“å‰ææ¡ˆæ˜¯å¦å·²ç»æ‰§è¡Œè¿‡äº†ï¼Œå¦‚æœæ‰§è¡Œäº†åˆ™ç›´æ¥è¿”å›ï¼Œè‹¥æœªæ‰§è¡ŒåŒæ—¶æ— dbé…é¢æ»¡å‘Šè­¦ï¼Œåˆ™è¿›å…¥åˆ°MVCCæ¨¡å—ï¼Œå¼€å§‹ä¸æŒä¹…åŒ–å­˜å‚¨æ¨¡å—æ‰“äº¤é“ã€‚</p><h2>MVCC</h2><p>Applyæ¨¡å—åˆ¤æ–­æ­¤ææ¡ˆæœªæ‰§è¡Œåï¼Œå°±ä¼šè°ƒç”¨MVCCæ¨¡å—æ¥æ‰§è¡Œææ¡ˆå†…å®¹ã€‚MVCCä¸»è¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œä¸€ä¸ªæ˜¯å†…å­˜ç´¢å¼•æ¨¡å—treeIndexï¼Œä¿å­˜keyçš„å†å²ç‰ˆæœ¬å·ä¿¡æ¯ï¼Œå¦ä¸€ä¸ªæ˜¯boltdbæ¨¡å—ï¼Œç”¨æ¥æŒä¹…åŒ–å­˜å‚¨key-valueæ•°æ®ã€‚é‚£ä¹ˆMVCCæ¨¡å—æ‰§è¡Œput helloä¸ºworldå‘½ä»¤æ—¶ï¼Œå®ƒæ˜¯å¦‚ä½•æ„å»ºå†…å­˜ç´¢å¼•å’Œä¿å­˜å“ªäº›æ•°æ®åˆ°dbå‘¢ï¼Ÿ</p><h3>treeIndex</h3><p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹MVCCçš„ç´¢å¼•æ¨¡å—treeIndexï¼Œå½“æ”¶åˆ°æ›´æ–°key helloä¸ºworldçš„æ—¶å€™ï¼Œæ­¤keyçš„ç´¢å¼•ç‰ˆæœ¬å·ä¿¡æ¯æ˜¯æ€ä¹ˆç”Ÿæˆçš„å‘¢ï¼Ÿéœ€è¦ç»´æŠ¤ã€æŒä¹…åŒ–å­˜å‚¨ä¸€ä¸ªå…¨å±€ç‰ˆæœ¬å·å—ï¼Ÿ</p><p>ç‰ˆæœ¬å·ï¼ˆrevisionï¼‰åœ¨etcdé‡Œé¢å‘æŒ¥ç€é‡å¤§ä½œç”¨ï¼Œå®ƒæ˜¯etcdçš„é€»è¾‘æ—¶é’Ÿã€‚etcdå¯åŠ¨çš„æ—¶å€™é»˜è®¤ç‰ˆæœ¬å·æ˜¯1ï¼Œéšç€ä½ å¯¹keyçš„å¢ã€åˆ ã€æ”¹æ“ä½œè€Œå…¨å±€å•è°ƒé€’å¢ã€‚</p><p>å› ä¸ºboltdbä¸­çš„keyå°±åŒ…å«æ­¤ä¿¡æ¯ï¼Œæ‰€ä»¥etcdå¹¶ä¸éœ€è¦å†å»æŒä¹…åŒ–ä¸€ä¸ªå…¨å±€ç‰ˆæœ¬å·ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œä»æœ€å°å€¼1å¼€å§‹æšä¸¾åˆ°æœ€å¤§å€¼ï¼Œæœªè¯»åˆ°æ•°æ®çš„æ—¶å€™åˆ™ç»“æŸï¼Œæœ€åè¯»å‡ºæ¥çš„ç‰ˆæœ¬å·å³æ˜¯å½“å‰etcdçš„æœ€å¤§ç‰ˆæœ¬å·currentRevisionã€‚</p><p>MVCCå†™äº‹åŠ¡åœ¨æ‰§è¡Œput helloä¸ºworldçš„è¯·æ±‚æ—¶ï¼Œä¼šåŸºäºcurrentRevisionè‡ªå¢ç”Ÿæˆæ–°çš„revisionå¦‚{2,0}ï¼Œç„¶åä»treeIndexæ¨¡å—ä¸­æŸ¥è¯¢keyçš„åˆ›å»ºç‰ˆæœ¬å·ã€ä¿®æ”¹æ¬¡æ•°ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å°†å¡«å……åˆ°boltdbçš„valueä¸­ï¼ŒåŒæ—¶å°†ç”¨æˆ·çš„hello keyå’Œrevisionç­‰ä¿¡æ¯å­˜å‚¨åˆ°B-treeï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢ç®€æ˜“å†™äº‹åŠ¡å›¾çš„æµç¨‹ä¸€ï¼Œæ•´ä½“æ¶æ„å›¾ä¸­çš„æµç¨‹å…«ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a1/ff/a19a06d8f4cc5e488a114090d84116ff.png?wh=1920*1035\" alt=\"\"></p><h3>boltdb</h3><p>MVCCå†™äº‹åŠ¡è‡ªå¢å…¨å±€ç‰ˆæœ¬å·åç”Ÿæˆçš„revision{2,0}ï¼Œå®ƒå°±æ˜¯boltdbçš„keyï¼Œé€šè¿‡å®ƒå°±å¯ä»¥å¾€boltdbå†™æ•°æ®äº†ï¼Œè¿›å…¥äº†æ•´ä½“æ¶æ„å›¾ä¸­çš„æµç¨‹ä¹ã€‚</p><p>boltdbä¸Šä¸€ç¯‡æˆ‘ä»¬æè¿‡å®ƒæ˜¯ä¸€ä¸ªåŸºäºB+treeå®ç°çš„key-valueåµŒå…¥å¼dbï¼Œå®ƒé€šè¿‡æä¾›æ¡¶ï¼ˆbucketï¼‰æœºåˆ¶å®ç°ç±»ä¼¼MySQLè¡¨çš„é€»è¾‘éš”ç¦»ã€‚</p><p>åœ¨etcdé‡Œé¢ä½ é€šè¿‡put/txnç­‰KV APIæ“ä½œçš„æ•°æ®ï¼Œå…¨éƒ¨ä¿å­˜åœ¨ä¸€ä¸ªåä¸ºkeyçš„æ¡¶é‡Œé¢ï¼Œè¿™ä¸ªkeyæ¡¶åœ¨å¯åŠ¨etcdçš„æ—¶å€™ä¼šè‡ªåŠ¨åˆ›å»ºã€‚</p><p>é™¤äº†ä¿å­˜ç”¨æˆ·KVæ•°æ®çš„keyæ¡¶ï¼Œetcdæœ¬èº«åŠå…¶å®ƒåŠŸèƒ½éœ€è¦æŒä¹…åŒ–å­˜å‚¨çš„è¯ï¼Œéƒ½ä¼šåˆ›å»ºå¯¹åº”çš„æ¡¶ã€‚æ¯”å¦‚ä¸Šé¢æˆ‘ä»¬æåˆ°çš„etcdä¸ºäº†ä¿è¯æ—¥å¿—çš„å¹‚ç­‰æ€§ï¼Œä¿å­˜äº†ä¸€ä¸ªåä¸ºconsistent indexçš„å˜é‡åœ¨dbé‡Œé¢ï¼Œå®ƒå®é™…ä¸Šå°±å­˜å‚¨åœ¨å…ƒæ•°æ®ï¼ˆmetaï¼‰æ¡¶é‡Œé¢ã€‚</p><p>é‚£ä¹ˆå†™å…¥boltdbçš„valueå«æœ‰å“ªäº›ä¿¡æ¯å‘¢ï¼Ÿ</p><p>å†™å…¥boltdbçš„valueï¼Œ å¹¶ä¸æ˜¯ç®€å•çš„\"world\"ï¼Œå¦‚æœåªå­˜ä¸€ä¸ªç”¨æˆ·valueï¼Œç´¢å¼•åˆæ˜¯ä¿å­˜åœ¨æ˜“å¤±çš„å†…å­˜ä¸Šï¼Œé‚£é‡å¯etcdåï¼Œæˆ‘ä»¬å°±ä¸¢å¤±äº†ç”¨æˆ·çš„keyåï¼Œæ— æ³•æ„å»ºtreeIndexæ¨¡å—äº†ã€‚</p><p>å› æ­¤ä¸ºäº†æ„å»ºç´¢å¼•å’Œæ”¯æŒLeaseç­‰ç‰¹æ€§ï¼Œetcdä¼šæŒä¹…åŒ–ä»¥ä¸‹ä¿¡æ¯:</p><ul>\n<li>keyåç§°ï¼›</li>\n<li>keyåˆ›å»ºæ—¶çš„ç‰ˆæœ¬å·ï¼ˆcreate_revisionï¼‰ã€æœ€åä¸€æ¬¡ä¿®æ”¹æ—¶çš„ç‰ˆæœ¬å·ï¼ˆmod_revisionï¼‰ã€keyè‡ªèº«ä¿®æ”¹çš„æ¬¡æ•°ï¼ˆversionï¼‰ï¼›</li>\n<li>valueå€¼ï¼›</li>\n<li>ç§Ÿçº¦ä¿¡æ¯ï¼ˆåé¢ä»‹ç»ï¼‰ã€‚</li>\n</ul><p>boltdb valueçš„å€¼å°±æ˜¯å°†å«ä»¥ä¸Šä¿¡æ¯çš„ç»“æ„ä½“åºåˆ—åŒ–æˆçš„äºŒè¿›åˆ¶æ•°æ®ï¼Œç„¶åé€šè¿‡boltdbæä¾›çš„putæ¥å£ï¼Œetcdå°±å¿«é€Ÿå®Œæˆäº†å°†ä½ çš„æ•°æ®å†™å…¥boltdbï¼Œå¯¹åº”ä¸Šé¢ç®€æ˜“å†™äº‹åŠ¡å›¾çš„æµç¨‹äºŒã€‚</p><p>ä½†æ˜¯putè°ƒç”¨æˆåŠŸï¼Œå°±èƒ½å¤Ÿä»£è¡¨æ•°æ®å·²ç»æŒä¹…åŒ–åˆ°dbæ–‡ä»¶äº†å—ï¼Ÿ</p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä»¥ä¸Šæµç¨‹ä¸­ï¼Œetcdå¹¶æœªæäº¤äº‹åŠ¡ï¼ˆcommitï¼‰ï¼Œå› æ­¤æ•°æ®åªæ›´æ–°åœ¨boltdbæ‰€ç®¡ç†çš„å†…å­˜æ•°æ®ç»“æ„ä¸­ã€‚</p><p>äº‹åŠ¡æäº¤çš„è¿‡ç¨‹ï¼ŒåŒ…å«B+treeçš„å¹³è¡¡ã€åˆ†è£‚ï¼Œå°†boltdbçš„è„æ•°æ®ï¼ˆdirty pageï¼‰ã€å…ƒæ•°æ®ä¿¡æ¯åˆ·æ–°åˆ°ç£ç›˜ï¼Œå› æ­¤äº‹åŠ¡æäº¤çš„å¼€é”€æ˜¯æ˜‚è´µçš„ã€‚å¦‚æœæˆ‘ä»¬æ¯æ¬¡æ›´æ–°éƒ½æäº¤äº‹åŠ¡ï¼Œetcdå†™æ€§èƒ½å°±ä¼šè¾ƒå·®ã€‚</p><p>é‚£ä¹ˆè§£å†³çš„åŠæ³•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿetcdçš„è§£å†³æ–¹æ¡ˆæ˜¯åˆå¹¶å†åˆå¹¶ã€‚</p><p>é¦–å…ˆboltdb keyæ˜¯ç‰ˆæœ¬å·ï¼Œput/deleteæ“ä½œæ—¶ï¼Œéƒ½ä¼šåŸºäºå½“å‰ç‰ˆæœ¬å·é€’å¢ç”Ÿæˆæ–°çš„ç‰ˆæœ¬å·ï¼Œå› æ­¤å±äºé¡ºåºå†™å…¥ï¼Œå¯ä»¥è°ƒæ•´boltdbçš„bucket.FillPercentå‚æ•°ï¼Œä½¿æ¯ä¸ªpageå¡«å……æ›´å¤šæ•°æ®ï¼Œå‡å°‘pageçš„åˆ†è£‚æ¬¡æ•°å¹¶é™ä½dbç©ºé—´ã€‚</p><p>å…¶æ¬¡etcdé€šè¿‡åˆå¹¶å¤šä¸ªå†™äº‹åŠ¡è¯·æ±‚ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæ˜¯å¼‚æ­¥æœºåˆ¶å®šæ—¶ï¼ˆé»˜è®¤æ¯éš”100msï¼‰å°†æ‰¹é‡äº‹åŠ¡ä¸€æ¬¡æ€§æäº¤ï¼ˆpendingäº‹åŠ¡è¿‡å¤šæ‰ä¼šè§¦å‘åŒæ­¥æäº¤ï¼‰ï¼Œ ä»è€Œå¤§å¤§æé«˜ååé‡ï¼Œå¯¹åº”ä¸Šé¢ç®€æ˜“å†™äº‹åŠ¡å›¾çš„æµç¨‹ä¸‰ã€‚</p><p>ä½†æ˜¯è¿™ä¼˜åŒ–åˆå¼•å‘äº†å¦å¤–çš„ä¸€ä¸ªé—®é¢˜ï¼Œ å› ä¸ºäº‹åŠ¡æœªæäº¤ï¼Œè¯»è¯·æ±‚å¯èƒ½æ— æ³•ä»boltdbè·å–åˆ°æœ€æ–°æ•°æ®ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œetcdå¼•å…¥äº†ä¸€ä¸ªbucket bufferæ¥ä¿å­˜æš‚æœªæäº¤çš„äº‹åŠ¡æ•°æ®ã€‚åœ¨æ›´æ–°boltdbçš„æ—¶å€™ï¼Œetcdä¹Ÿä¼šåŒæ­¥æ•°æ®åˆ°bucket bufferã€‚å› æ­¤etcdå¤„ç†è¯»è¯·æ±‚çš„æ—¶å€™ä¼šä¼˜å…ˆä»bucket bufferé‡Œé¢è¯»å–ï¼Œå…¶æ¬¡å†ä»boltdbè¯»ï¼Œé€šè¿‡bucket bufferå®ç°è¯»å†™æ€§èƒ½æå‡ï¼ŒåŒæ—¶ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚</p><h2>å°ç»“</h2><p>æœ€åæˆ‘ä»¬æ¥å°ç»“ä¸€ä¸‹ï¼Œä»Šå¤©æˆ‘ç»™ä½ ä»‹ç»äº†etcdçš„å†™è¯·æ±‚æµç¨‹ï¼Œé‡ç‚¹ä»‹ç»äº†Quotaã€WALã€Applyæ¨¡å—ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬ä»‹ç»äº†Quotaæ¨¡å—å·¥ä½œåŸç†å’Œæˆ‘ä»¬ç†Ÿæ‚‰çš„database space exceededé”™è¯¯è§¦å‘åŸå› ï¼Œå†™è¯·æ±‚å¯¼è‡´dbå¤§å°å¢åŠ ã€compactç­–ç•¥ä¸åˆç†ã€boltdb Bugç­‰éƒ½ä¼šå¯¼è‡´dbå¤§å°è¶…é™ã€‚</p><p>å…¶æ¬¡ä»‹ç»äº†WALæ¨¡å—çš„å­˜å‚¨ç»“æ„ï¼Œå®ƒç”±ä¸€æ¡æ¡è®°å½•é¡ºåºå†™å…¥ç»„æˆï¼Œæ¯ä¸ªè®°å½•å«æœ‰Typeã€CRCã€Dataï¼Œæ¯ä¸ªææ¡ˆè¢«æäº¤å‰éƒ½ä¼šè¢«æŒä¹…åŒ–åˆ°WALæ–‡ä»¶ä¸­ï¼Œä»¥ä¿è¯é›†ç¾¤çš„ä¸€è‡´æ€§å’Œå¯æ¢å¤æ€§ã€‚</p><p>éšåæˆ‘ä»¬ä»‹ç»äº†Applyæ¨¡å—åŸºäºconsistent indexå’Œäº‹åŠ¡å®ç°äº†å¹‚ç­‰æ€§ï¼Œä¿è¯äº†èŠ‚ç‚¹åœ¨å¼‚å¸¸æƒ…å†µä¸‹ä¸ä¼šé‡å¤æ‰§è¡Œé‡æ”¾çš„ææ¡ˆã€‚</p><p>æœ€åæˆ‘ä»¬ä»‹ç»äº†MVCCæ¨¡å—æ˜¯å¦‚ä½•ç»´æŠ¤ç´¢å¼•ç‰ˆæœ¬å·ã€é‡å¯åå¦‚ä½•ä»boltdbæ¨¡å—ä¸­è·å–å†…å­˜ç´¢å¼•ç»“æ„çš„ã€‚ä»¥åŠetcdé€šè¿‡å¼‚æ­¥ã€æ‰¹é‡æäº¤äº‹åŠ¡æœºåˆ¶ï¼Œä»¥æå‡å†™QPSå’Œååé‡ã€‚</p><p>é€šè¿‡ä»¥ä¸Šä»‹ç»ï¼Œå¸Œæœ›ä½ å¯¹etcdçš„ä¸€ä¸ªå†™è¯­å¥æ‰§è¡Œæµç¨‹æœ‰ä¸ªåˆæ­¥çš„ç†è§£ï¼Œæ˜ç™½WALæ¨¡å—ã€Applyæ¨¡å—ã€MVCCæ¨¡å—ä¸‰è€…æ˜¯å¦‚ä½•ç›¸äº’åä½œçš„ï¼Œä»è€Œå®ç°åœ¨èŠ‚ç‚¹é­é‡crashç­‰å¼‚å¸¸æƒ…å†µä¸‹ï¼Œä¸ä¸¢ä»»ä½•å·²æäº¤çš„æ•°æ®ã€ä¸é‡å¤æ‰§è¡Œä»»ä½•ææ¡ˆã€‚</p><h2>æ€è€ƒé¢˜</h2><p>expensive readè¯·æ±‚ï¼ˆå¦‚Kubernetesåœºæ™¯ä¸­æŸ¥è¯¢å¤§é‡podï¼‰ä¼šå½±å“å†™è¯·æ±‚çš„æ€§èƒ½å—ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„æ€è€ƒå’Œè§‚ç‚¹å†™åœ¨ç•™è¨€åŒºé‡Œï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾ç»™å‡ºæˆ‘çš„ç­”æ¡ˆã€‚</p><p>ä»Šå¤©çš„è¯¾ç¨‹å°±ç»“æŸäº†ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©åˆ°ä½ ï¼Œä¹Ÿå¸Œæœ›ä½ åœ¨ä¸‹æ–¹çš„ç•™è¨€åŒºå’Œæˆ‘å‚ä¸è®¨è®ºï¼ŒåŒæ—¶æ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–è€…åŒäº‹ï¼Œä¸€èµ·äº¤æµä¸€ä¸‹ã€‚</p><h2>02æ€è€ƒé¢˜ç­”æ¡ˆ</h2><p>ä¸ŠèŠ‚è¯¾æˆ‘ç»™å¤§å®¶ç•™äº†ä¸€ä¸ªæ€è€ƒé¢˜ï¼Œè¯„è®ºä¸­æœ‰åŒå­¦è¯´bufferæ²¡è¯»åˆ°ï¼Œä»boltdbè¯»æ—¶ä¼šäº§ç”Ÿç£ç›˜I/Oï¼Œè¿™æ˜¯ä¸€ä¸ªå¸¸è§è¯¯åŒºã€‚</p><p>å®é™…ä¸Šï¼Œetcdåœ¨å¯åŠ¨çš„æ—¶å€™ä¼šé€šè¿‡mmapæœºåˆ¶å°†etcd dbæ–‡ä»¶æ˜ å°„åˆ°etcdè¿›ç¨‹åœ°å€ç©ºé—´ï¼Œå¹¶è®¾ç½®äº†mmapçš„MAP_POPULATE flagï¼Œå®ƒä¼šå‘Šè¯‰Linuxå†…æ ¸é¢„è¯»æ–‡ä»¶ï¼ŒLinuxå†…æ ¸ä¼šå°†æ–‡ä»¶å†…å®¹æ‹·è´åˆ°ç‰©ç†å†…å­˜ä¸­ï¼Œæ­¤æ—¶ä¼šäº§ç”Ÿç£ç›˜I/Oã€‚èŠ‚ç‚¹å†…å­˜è¶³å¤Ÿçš„è¯·æ±‚ä¸‹ï¼Œåç»­å¤„ç†è¯»è¯·æ±‚è¿‡ç¨‹ä¸­å°±ä¸ä¼šäº§ç”Ÿç£ç›˜I/IOäº†ã€‚</p><p>è‹¥etcdèŠ‚ç‚¹å†…å­˜ä¸è¶³ï¼Œå¯èƒ½ä¼šå¯¼è‡´dbæ–‡ä»¶å¯¹åº”çš„å†…å­˜é¡µè¢«æ¢å‡ºï¼Œå½“è¯»è¯·æ±‚å‘½ä¸­çš„é¡µæœªåœ¨å†…å­˜ä¸­æ—¶ï¼Œå°±ä¼šäº§ç”Ÿç¼ºé¡µå¼‚å¸¸ï¼Œå¯¼è‡´è¯»è¿‡ç¨‹ä¸­äº§ç”Ÿç£ç›˜IOï¼Œä½ å¯ä»¥é€šè¿‡è§‚å¯Ÿetcdè¿›ç¨‹çš„majfltå­—æ®µæ¥åˆ¤æ–­etcdæ˜¯å¦äº§ç”Ÿäº†ä¸»ç¼ºé¡µä¸­æ–­ã€‚</p>","comments":[{"had_liked":false,"id":275600,"user_name":"å”èª","can_delete":false,"product_type":"c1","uid":1009582,"ip_address":"","ucode":"99CB061EDF35EA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","comment_is_top":false,"comment_ctime":1611617241,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"216359982041","product_id":100069901,"comment_content":"ä¹‹å‰ä¿®å¤çš„å­˜åœ¨3å¹´å¤šçš„ä¸ä¸€è‡´bugå°±æ˜¯è·Ÿæœ¬èŠ‚ä»‹ç»çš„å†™è¯·æ±‚å¹‚ç­‰æ€§æœ‰å…³ï¼Œåœ¨æ¯è®²ä¸­ï¼Œæˆ‘æåŠçš„bugï¼Œç‰¹æ€§ç¼ºç‚¹ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯æˆ‘ä¹‹å‰è¸©è¿‡çš„å‘ï¼Œè¿™äº›ç»éªŒå¸Œæœ›èƒ½å¸®åŠ©å¤§å®¶æå‰é¿å…ä¸å¿…è¦çš„çº¿ä¸Šé—®é¢˜","like_count":51,"discussions":[{"author":{"id":1295167,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/oiboHpgukqib2ASXeU0H7W15zhRusOohD37CFCxSOnZfeOppkicDpOLVVmQYlbpw6rGib2Ib8smSFHZiaXXa7OJhHTQ/132","nickname":"scott","note":"","ucode":"2C9EC7D56D9848","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":531110,"discussion_content":"è¯·é—®ä¸€ä¸‹æœ‰æ²¡æœ‰etcdæºç å­¦ä¹ äº¤æµç¾¤ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637232210,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":275675,"user_name":"Index","can_delete":false,"product_type":"c1","uid":1078909,"ip_address":"","ucode":"815A1A62F846CF","user_header":"https://static001.geekbang.org/account/avatar/00/10/76/7d/04c95885.jpg","comment_is_top":false,"comment_ctime":1611641176,"is_pvip":false,"replies":[{"id":"100075","content":"å¥½çš„ï¼Œè°¢è°¢ä½ çš„è®¤å¯ï¼Œä¸€èµ·å­¦ä¹ åŠ æ²¹","user_name":"ä½œè€…å›å¤","comment_id":275675,"uid":"1009582","ip_address":"","utype":1,"ctime":1611668565,"user_name_real":"å”èª"}],"discussion_count":1,"race_medal":0,"score":"48856281432","product_id":100069901,"comment_content":"ä¹‹å‰ç ”ç©¶ä¸€æ®µæ—¶é—´çš„etcdçš„æºç ï¼Œçœ‹çš„ä¸ƒä¸ƒå…«å…«ï¼Œç°åœ¨å†çœ‹è¿™ç¯‡æ–‡ç« æŠŠä¹‹å‰çš„å¾ˆå¤šç–‘é—®éƒ½è§£ç­”äº†ï¼Œå¤ªæ£’äº†ï¼Œetcdæ˜¯ä¸ªå¾ˆä¼˜ç§€çš„é¡¹ç›®ï¼Œèƒ½æŠŠè¿™ä¹ˆå¤šçš„æŠ€æœ¯ç‚¹èåˆåœ¨ä¸€èµ·ï¼Œå®åœ¨æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å¼€æºå­¦ä¹ é¡¹ç›®ã€‚è€å¸ˆæœ‰ç©ºå¯ä»¥å¼€ç›´æ’­ï¼Œå¤šèŠèŠetcdä¸­æ¶‰åŠçš„æŠ€æœ¯ç‚¹çš„ä¸€äº›å­¦ä¹ ï¼Œä»æºå¤´ä¸ŠæŠŠçŸ¥è¯†èæ±‡è´¯é€šï¼Œè¿™æ ·çš„å­¦ä¹ çœŸæ˜¯é…£ç•…æ·‹æ¼“","like_count":12,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514433,"discussion_content":"å¥½çš„ï¼Œè°¢è°¢ä½ çš„è®¤å¯ï¼Œä¸€èµ·å­¦ä¹ åŠ æ²¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611668565,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":276178,"user_name":"äºé€”","can_delete":false,"product_type":"c1","uid":1669343,"ip_address":"","ucode":"70300C6CCCEAF1","user_header":"https://static001.geekbang.org/account/avatar/00/19/78/df/424bdc4a.jpg","comment_is_top":false,"comment_ctime":1611822308,"is_pvip":true,"replies":[{"id":"100536","content":"ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œ10 boltdbç¯‡ä¼šå¸®åŠ©ä½ æ·±å…¥è§£ç­”ç¬¬1ä¸ªé—®é¢˜ï¼Œç¨ç­‰<br>ç¬¬äºŒä¸ªé—®é¢˜ï¼Œ{2,0}={major,sub} 2æ˜¯etcd mvccäº‹åŠ¡ç‰ˆæœ¬å·å…¨å±€é€’å¢ï¼Œ0æ˜¯äº‹åŠ¡å†…å­ç‰ˆæœ¬å·éšä¿®æ”¹æ“ä½œé€’å¢ï¼ˆæ¯”å¦‚ä¸€ä¸ªtxnäº‹åŠ¡ä¸­å¤šä¸ªput&#47;deleteæ“ä½œï¼Œå…¶ä¼šä»0é€’å¢)ï¼Œå› æ­¤ç¬¬äºŒæ¬¡æ‰§è¡Œput hello world2çš„æ—¶å€™ç‰ˆæœ¬å·åº”æ˜¯{3,0}, 07 mvccä¼šè¯¦ç»†ä»‹ç»ï¼Œæ˜å¤©æ›´æ–°","user_name":"ä½œè€…å›å¤","comment_id":276178,"uid":"1009582","ip_address":"","utype":1,"ctime":1612248505,"user_name_real":"å”èª"}],"discussion_count":1,"race_medal":0,"score":"31676593380","product_id":100069901,"comment_content":"1ï¼‰é¦–å…ˆ boltdb key æ˜¯ç‰ˆæœ¬å·ï¼Œput&#47;delete æ“ä½œæ—¶ï¼Œéƒ½ä¼šåŸºäºå½“å‰ç‰ˆæœ¬å·é€’å¢ç”Ÿæˆæ–°çš„ç‰ˆæœ¬å·ï¼Œå› æ­¤å±äºé¡ºåºå†™å…¥ï¼Œå¯ä»¥è°ƒæ•´ boltdb çš„ bucket.FillPercent å‚æ•°ï¼Œä½¿æ¯ä¸ª page å¡«å……æ›´å¤šæ•°æ®ï¼Œå‡å°‘ page çš„åˆ†è£‚æ¬¡æ•°å¹¶é™ä½dbç©ºé—´ã€‚   æ­¤å¤„çš„page å’Œ é™ä½dbç©ºé—´ä¸æ˜¯å¾ˆç†è§£ï¼ŒåŠ³çƒ¦è€å¸ˆè§£æƒ‘ï¼<br><br>2ï¼‰å…³äºç‰ˆæœ¬å·(revision)çš„ç†è§£ï¼šå‡å®šå…¨å±€ç‰ˆæœ¬å·currentRevision=2ï¼Œç¬¬ä¸€æ¬¡æ‰§è¡Œ put hello world1ï¼Œé‚£ä¹ˆç‰ˆæœ¬å·ä¸ºï¼šhello:revision{2,0};ç¬¬äºŒæ¬¡æ‰§è¡Œ put hello world2ï¼Œæ­¤æ—¶ç‰ˆæœ¬å·ä¸ºï¼šhello:revision{3,1};ç¬¬3æ¬¡æ‰§è¡Œ put hello world3ï¼Œæ­¤æ—¶ç‰ˆæœ¬å·ä¸ºï¼šhello:revision{4,2}ã€‚  ä¸çŸ¥ç†è§£æ˜¯å¦æœ‰åå·®ï¼Ÿ","like_count":8,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514620,"discussion_content":"ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œ10 boltdbç¯‡ä¼šå¸®åŠ©ä½ æ·±å…¥è§£ç­”ç¬¬1ä¸ªé—®é¢˜ï¼Œç¨ç­‰\nç¬¬äºŒä¸ªé—®é¢˜ï¼Œ{2,0}={major,sub} 2æ˜¯etcd mvccäº‹åŠ¡ç‰ˆæœ¬å·å…¨å±€é€’å¢ï¼Œ0æ˜¯äº‹åŠ¡å†…å­ç‰ˆæœ¬å·éšä¿®æ”¹æ“ä½œé€’å¢ï¼ˆæ¯”å¦‚ä¸€ä¸ªtxnäº‹åŠ¡ä¸­å¤šä¸ªput/deleteæ“ä½œï¼Œå…¶ä¼šä»0é€’å¢)ï¼Œå› æ­¤ç¬¬äºŒæ¬¡æ‰§è¡Œput hello world2çš„æ—¶å€™ç‰ˆæœ¬å·åº”æ˜¯{3,0}, 07 mvccä¼šè¯¦ç»†ä»‹ç»ï¼Œæ˜å¤©æ›´æ–°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612248505,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":275714,"user_name":"TS.ä¹”","can_delete":false,"product_type":"c1","uid":1502649,"ip_address":"","ucode":"1C412940605FF9","user_header":"https://static001.geekbang.org/account/avatar/00/16/ed/b9/510fb3e2.jpg","comment_is_top":false,"comment_ctime":1611651274,"is_pvip":false,"replies":[{"id":"100073","content":"å—¯ï¼Œè°¢è°¢ä½ çš„å»ºè®®ï¼Œç¯‡å¹…æœ¬èº«æ¯”è¾ƒé•¿å°±æ²¡ç»§ç»­æ‰©å±•äº†ï¼Œæ¯”å¦‚è¯»å†™åŸç†ä¸­ï¼Œtreeindexä¸ºä»€ä¹ˆç”¨b-treeè€Œä¸æ˜¯å…¶ä»–æ•°æ®ç»“æ„ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨boltdbè€Œä¸æ˜¯åŸºäºlsmæ ‘çš„leveldbç­‰ï¼Œåé¢ç­”ç–‘å’Œå…¶ä»–è®²æˆ‘å°†é€‚å½“å’Œå¤§å®¶ä¸€èµ·è®¨è®º","user_name":"ä½œè€…å›å¤","comment_id":275714,"uid":"1009582","ip_address":"","utype":1,"ctime":1611668506,"user_name_real":"å”èª"}],"discussion_count":2,"race_medal":0,"score":"31676422346","product_id":100069901,"comment_content":"å¸Œæœ›åœ¨åé¢å¤šåŠ ä¸€ä¸‹å…·ä½“è®¾è®¡æ€è·¯ï¼Œä»¥åŠç‰¹æ€§å–èˆçš„ä¸œè¥¿","like_count":7,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514448,"discussion_content":"å—¯ï¼Œè°¢è°¢ä½ çš„å»ºè®®ï¼Œç¯‡å¹…æœ¬èº«æ¯”è¾ƒé•¿å°±æ²¡ç»§ç»­æ‰©å±•äº†ï¼Œæ¯”å¦‚è¯»å†™åŸç†ä¸­ï¼Œtreeindexä¸ºä»€ä¹ˆç”¨b-treeè€Œä¸æ˜¯å…¶ä»–æ•°æ®ç»“æ„ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨boltdbè€Œä¸æ˜¯åŸºäºlsmæ ‘çš„leveldbç­‰ï¼Œåé¢ç­”ç–‘å’Œå…¶ä»–è®²æˆ‘å°†é€‚å½“å’Œå¤§å®¶ä¸€èµ·è®¨è®º","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1611668506,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":345150,"discussion_content":"ä¸‹ä¸€èŠ‚ä¹Ÿå°†åˆ†æetcdä¸ºä»€ä¹ˆä½¿ç”¨raftè€Œä¸æ˜¯ä¸»å¤‡å¤åˆ¶å’Œå»ä¸­å¿ƒåŒ–å¤åˆ¶ç­‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611670688,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":275661,"user_name":"jeffery","can_delete":false,"product_type":"c1","uid":1219972,"ip_address":"","ucode":"35E2DAA386FB86","user_header":"https://static001.geekbang.org/account/avatar/00/12/9d/84/171b2221.jpg","comment_is_top":false,"comment_ctime":1611637123,"is_pvip":false,"replies":[{"id":"100080","content":"è°¢è°¢ï¼Œè¿™ä¸ªé™é€Ÿä¸æ˜¯raftæ¨¡å—åšçš„ï¼Œraftæ˜¯ä¸ªå•ç‹¬å…±è¯†ç®—æ³•åº“ï¼Œæ˜¯etcd serverä½¿ç”¨raftçš„æ—¶å€™ï¼ŒåŸºäºraftå‘ŠçŸ¥çš„committed indexï¼Œæœ¬èº«applyæ¨¡å—çš„applied indexåšçš„é™é€Ÿï¼Œé»˜è®¤å†™æ­»äº†5000","user_name":"ä½œè€…å›å¤","comment_id":275661,"uid":"1009582","ip_address":"","utype":1,"ctime":1611672443,"user_name_real":"å”èª"}],"discussion_count":1,"race_medal":0,"score":"27381440899","product_id":100069901,"comment_content":"åŸç†è®²çš„é€å½»ã€ä¸ºå•¥applied indexè¶…è¿‡äº† 5000ï¼Œè¿”å›ä¸€ä¸ª&quot;etcdserver: too many requests&quot;é”™è¯¯ç»™ clientã€‚raftæºç å®šä¹‰çš„æœ€å¤§å€¼å—ï¼Ÿè°¢è°¢è€å¸ˆ","like_count":7,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514428,"discussion_content":"è°¢è°¢ï¼Œè¿™ä¸ªé™é€Ÿä¸æ˜¯raftæ¨¡å—åšçš„ï¼Œraftæ˜¯ä¸ªå•ç‹¬å…±è¯†ç®—æ³•åº“ï¼Œæ˜¯etcd serverä½¿ç”¨raftçš„æ—¶å€™ï¼ŒåŸºäºraftå‘ŠçŸ¥çš„committed indexï¼Œæœ¬èº«applyæ¨¡å—çš„applied indexåšçš„é™é€Ÿï¼Œé»˜è®¤å†™æ­»äº†5000","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611672443,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":275715,"user_name":"ä¸ƒé‡Œ","can_delete":false,"product_type":"c1","uid":1042604,"ip_address":"","ucode":"614A35DE72C739","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e8/ac/7324d5ca.jpg","comment_is_top":false,"comment_ctime":1611651576,"is_pvip":false,"replies":[{"id":"100077","content":"å°±æ˜¯key-valueæ•°æ®ä¸consistent indexåœ¨åŒä¸€ä¸ªboltdbäº‹åŠ¡ä¸­æ›´æ–°ï¼Œboltdbåé¢ä¼šå†å•ç‹¬ä»‹ç»","user_name":"ä½œè€…å›å¤","comment_id":275715,"uid":"1009582","ip_address":"","utype":1,"ctime":1611671659,"user_name_real":"å”èª"}],"discussion_count":2,"race_medal":0,"score":"23086488056","product_id":100069901,"comment_content":"å¹‚ç­‰éƒ¨åˆ†çš„â€œåŸå­æ€§äº‹åŠ¡â€å¦‚ä½•å®ç°çš„ï¼Ÿ","like_count":6,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514449,"discussion_content":"å°±æ˜¯key-valueæ•°æ®ä¸consistent indexåœ¨åŒä¸€ä¸ªboltdbäº‹åŠ¡ä¸­æ›´æ–°ï¼Œboltdbåé¢ä¼šå†å•ç‹¬ä»‹ç»","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1611671659,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1145624,"avatar":"https://static001.geekbang.org/account/avatar/00/11/7b/18/6e44e6e0.jpg","nickname":"æºæ’’ä¹‹å‰‘","note":"","ucode":"18F55D253647E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":407265,"discussion_content":"ä¹Ÿæœ‰æ­¤ç–‘é—®ï¼ŒåŸæ¥ç”±boltdbäº‹åŠ¡ä¿è¯åŸå­æ€§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634960381,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":278407,"user_name":"Geek_5a8405","can_delete":false,"product_type":"c1","uid":2421596,"ip_address":"","ucode":"227449D010F147","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/rPaT2MzkXFmlmMTicGCRk5yVKqibPlloh66ibGJfoLQbgb6ficD3TkPmngR8UCEkrKZf5UbzvLlIglyYXBZibUINQ9Q/132","comment_is_top":false,"comment_ctime":1612928327,"is_pvip":false,"replies":[{"id":"101216","content":"èµï¼Œé˜…è¯»è¿‡ç¨‹ä¸­æœ‰æ·±å…¥æ€è€ƒï¼Œä½ å¯ä»¥çœ‹çœ‹04èŠ‚raftï¼Œå…¶ä¸­æ€è€ƒé¢˜ä¸ä½ è¯´çš„ç±»ä¼¼ï¼Œ05æœ‰å‚è€ƒç­”æ¡ˆ","user_name":"ä½œè€…å›å¤","comment_id":278407,"uid":"1009582","ip_address":"","utype":1,"ctime":1613054695,"user_name_real":"å”èª"}],"discussion_count":1,"race_medal":0,"score":"18792797511","product_id":100069901,"comment_content":"ä»èŠ‚ç‚¹æ”¶åˆ°Proposeè¯·æ±‚åä¼šå†™walæ—¥å¿—å—ï¼Ÿé‚£å¦‚æœæœ€ç»ˆå¹¶æ²¡æœ‰ä¸€åŠçš„èŠ‚ç‚¹æˆåŠŸå“åº”ï¼Œé‚£å·²ç»å†™å…¥walçš„ä»èŠ‚ç‚¹æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":515374,"discussion_content":"èµï¼Œé˜…è¯»è¿‡ç¨‹ä¸­æœ‰æ·±å…¥æ€è€ƒï¼Œä½ å¯ä»¥çœ‹çœ‹04èŠ‚raftï¼Œå…¶ä¸­æ€è€ƒé¢˜ä¸ä½ è¯´çš„ç±»ä¼¼ï¼Œ05æœ‰å‚è€ƒç­”æ¡ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613054695,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":277379,"user_name":"æ†¨æ†¨","can_delete":false,"product_type":"c1","uid":1504167,"ip_address":"","ucode":"B0174DE63247ED","user_header":"https://static001.geekbang.org/account/avatar/00/16/f3/a7/15ee1f00.jpg","comment_is_top":false,"comment_ctime":1612400244,"is_pvip":false,"replies":[{"id":"100682","content":"æ„Ÿè°¢è®¤å¯ğŸ˜Š","user_name":"ä½œè€…å›å¤","comment_id":277379,"uid":"1009582","ip_address":"","utype":1,"ctime":1612484071,"user_name_real":"å”èª"}],"discussion_count":1,"race_medal":0,"score":"18792269428","product_id":100069901,"comment_content":"è®²çš„çœŸå¥½ï¼Œå¹²è´§åè¶³","like_count":4,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":515028,"discussion_content":"æ„Ÿè°¢è®¤å¯ğŸ˜Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612484071,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":275434,"user_name":"èŒƒé—²","can_delete":false,"product_type":"c1","uid":1073125,"ip_address":"","ucode":"F21FD7DF6BA53C","user_header":"https://static001.geekbang.org/account/avatar/00/10/5f/e5/54325854.jpg","comment_is_top":false,"comment_ctime":1611538935,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"18791408119","product_id":100069901,"comment_content":"ä¼šæœ‰å½±å“ã€‚<br>1.å¦‚æœè¯»å†™è¯·æ±‚éƒ½è½åˆ°bucket bufferä¸Šï¼Œbucketbufferéœ€è¦åšé”å¤„ç†ã€‚<br>2.å¦‚æœè¯»å†™è¯·æ±‚éƒ½è½åˆ°boltdbä¸Šï¼Œdbä¸Šçš„æ•°æ®æ˜¯ä»ç£ç›˜åŠ è½½ï¼ŒåŒbucket bufferç›¸æ¯”æ€§èƒ½ä¼šä¸‹é™ä¸€ä¸ªæ•°é‡çº§ã€‚<br>3.å¦‚æœæ—¢è½äº†bucket bufferï¼Œåˆè½åˆ°äº†boltdbä¸Šã€‚é‚£ä¹ˆæ€§èƒ½å—åˆ°çš„å½±å“ä»‹äº1-2ä¹‹é—´ã€‚","like_count":4,"discussions":[{"author":{"id":1181055,"avatar":"https://static001.geekbang.org/account/avatar/00/12/05/7f/d35ab9a1.jpg","nickname":"z.l","note":"","ucode":"805CC5784D3F76","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":397033,"discussion_content":"ç¬¬ä¸€ç‚¹ï¼Œç”¨è¯»å†™é”ä¸å°±è¡Œäº†å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632545514,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1233455,"avatar":"https://static001.geekbang.org/account/avatar/00/12/d2/2f/04882ff8.jpg","nickname":"é¾™å¤","note":"","ucode":"D1724E68D6304D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181055,"avatar":"https://static001.geekbang.org/account/avatar/00/12/05/7f/d35ab9a1.jpg","nickname":"z.l","note":"","ucode":"805CC5784D3F76","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":398198,"discussion_content":"mvccæœºåˆ¶æœ‰ä¸€ç‚¹æ˜¯ä¸ºäº†è§£å†³å¹¶å‘è¯»å†™æ€§èƒ½é—®é¢˜ï¼Œä¸éœ€è¦æ‚²è§‚é”ï¼Œå®ƒåº”ç”¨çš„åŸç†æ˜¯ä¹è§‚é”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632750646,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":397033,"ip_address":""},"score":398198,"extra":""}]},{"author":{"id":1733275,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJOBwR7MCVqwZzc3keFAJT12Sic3VYWx4PrZbCGDm4kBZD3oqnR4xsibGGtGy4tFO8y05Ims27SiaavA/132","nickname":"æµ·é˜”å¤©ç©º","note":"","ucode":"8658B1610192E7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344850,"discussion_content":"2è½åœ¨boltdbæ—¶ï¼Œä¸ä¸€å®šä»ç£ç›˜åŠ è½½å§ï¼Œmmap\næ˜ å°„åˆ°å†…å­˜äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611585010,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1073125,"avatar":"https://static001.geekbang.org/account/avatar/00/10/5f/e5/54325854.jpg","nickname":"èŒƒé—²","note":"","ucode":"F21FD7DF6BA53C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1733275,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJOBwR7MCVqwZzc3keFAJT12Sic3VYWx4PrZbCGDm4kBZD3oqnR4xsibGGtGy4tFO8y05Ims27SiaavA/132","nickname":"æµ·é˜”å¤©ç©º","note":"","ucode":"8658B1610192E7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344857,"discussion_content":"ä¸å¤ªäº†è§£boltdbçš„å†…éƒ¨å®ç°ã€‚å¦‚æœæ˜¯leveldbçš„è¯ï¼Œå…ˆå»memtableæŸ¥ï¼Œç„¶åå†ä»ç£ç›˜åŠ è½½ã€‚\nå¯¹äº2çš„æƒ…å†µæ¥è¯´ï¼Œæœ€å¥½çš„æƒ…å†µåœ¨å†…å­˜ï¼Œæœ€å·®çš„æƒ…å†µåœ¨ç£ç›˜ã€‚ä½†æ˜¯ä¸€å®šè¦æœ‰é”å¤„ç†çš„å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611586892,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":344850,"ip_address":""},"score":344857,"extra":""}]}]},{"had_liked":false,"id":319988,"user_name":"åŠ±ç ”å†°","can_delete":false,"product_type":"c1","uid":1106394,"ip_address":"","ucode":"FCBC8266018FA0","user_header":"https://static001.geekbang.org/account/avatar/00/10/e1/da/d7f591a7.jpg","comment_is_top":false,"comment_ctime":1636028450,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14520930338","product_id":100069901,"comment_content":"è¿™ç¯‡ä»”ç»†è¯»äº†å¥½å‡ éæ¯æ¬¡éƒ½æœ‰ä¸ä¸€æ ·çš„æ”¶è·è·Ÿç†è§£ï¼Œè¢«å¾ˆå¤šè®¾è®¡ç»†èŠ‚è·Ÿæ€è·¯æ‰€æŠ˜æœï¼Œæœ€åæ•´ç†äº†ä¸‹å‘ç°etcdçš„å†™æµç¨‹å±…ç„¶è·Ÿmysqlä¸­çš„è®¾è®¡æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼Œæ¯”å¦‚mysqlä¸­çš„redologï¼Œbinlogï¼Œchangebuffï¼Œå†…å­˜ç¼“å­˜ï¼Œäº‹ç‰©åˆå¹¶æäº¤ç­‰â€¦â€¦.ï¼Œæœ€åæœ‰ä¸€ä¸ªä¸æ˜ç™½çš„ç‚¹æ˜¯ä¸ºä»€ä¹ˆåœ¨boltdbæäº¤äº‹ç‰©çš„æ—¶å€™ä¸æ˜¯ç”¨keyçš„mod_revisionè€Œæ˜¯è¦é‡æ–°ç”Ÿæˆæ–°çš„ç‰ˆæœ¬å·","like_count":4,"discussions":[{"author":{"id":1311299,"avatar":"https://static001.geekbang.org/account/avatar/00/14/02/43/1c2fb7b3.jpg","nickname":"Bourne","note":"","ucode":"1286279F70B13F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534496,"discussion_content":"åŒæ„Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638199413,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":275601,"user_name":"äº‘åŸç”Ÿå·¥ç¨‹å¸ˆ","can_delete":false,"product_type":"c1","uid":2243294,"ip_address":"","ucode":"40CB692F21D3BC","user_header":"https://static001.geekbang.org/account/avatar/00/22/3a/de/e5c30589.jpg","comment_is_top":false,"comment_ctime":1611618129,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14496520017","product_id":100069901,"comment_content":"æ–‡ç« æœ‰ç‚¹é•¿ï¼Œä½†è¯»èµ·æ¥å±‚å±‚é€’è¿›ï¼Œæœ‰å¾ˆå¤§æ”¶è·ï¼Œå‘ç°ä¹‹å‰è‡ªå·±æ‰€äº†è§£çš„è¿˜çœŸä¸å…¨é¢ï¼Œå¡«è¡¥äº†ä¹‹å‰çš„ä¸€äº›ç©ºç™½é¢ï¼ŒæœŸå¾…åé¢çš„ç²¾å½©å†…å®¹","like_count":3},{"had_liked":false,"id":275596,"user_name":"kingstone","can_delete":false,"product_type":"c1","uid":1541689,"ip_address":"","ucode":"957342D964115E","user_header":"https://static001.geekbang.org/account/avatar/00/17/86/39/d12aaabf.jpg","comment_is_top":false,"comment_ctime":1611597550,"is_pvip":false,"replies":[{"id":"100042","content":"å¥½é—®é¢˜ï¼Œç›®å‰etcdæ²¡å¤„ç†è¿™ç§æƒ…å†µï¼Œå®ƒçš„ç±»ä¼¼æ˜¯int64,æœ€å¤§å€¼9223372036854775807ï¼Œçœ‹èµ·æ¥æ˜¯å¾ˆéš¾è¾¾åˆ°ä¸Šé™çš„","user_name":"ä½œè€…å›å¤","comment_id":275596,"uid":"1009582","ip_address":"","utype":1,"ctime":1611640915,"user_name_real":"å”èª"}],"discussion_count":1,"race_medal":0,"score":"14496499438","product_id":100069901,"comment_content":"è¯·é—®revisionå¦‚æœè¶…å‡ºäº†ä¸Šé™ï¼Œrevisionä¼šå¦‚ä½•æ¥ç€ç”Ÿæˆï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514412,"discussion_content":"å¥½é—®é¢˜ï¼Œç›®å‰etcdæ²¡å¤„ç†è¿™ç§æƒ…å†µï¼Œå®ƒçš„ç±»ä¼¼æ˜¯int64,æœ€å¤§å€¼9223372036854775807ï¼Œçœ‹èµ·æ¥æ˜¯å¾ˆéš¾è¾¾åˆ°ä¸Šé™çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611640915,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":333835,"user_name":"Geek_604077","can_delete":false,"product_type":"c1","uid":1969081,"ip_address":"","ucode":"3BDCDCA9187514","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/ib3Rzem884S5MOS96THy0gQXcF26PNsnRBpyr3pM5rVibZdYvAibpVvAGfibF1ddpgrteg9fQUsq4vce9EM95Jj97Q/132","comment_is_top":false,"comment_ctime":1644559237,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10234493829","product_id":100069901,"comment_content":"ä¸€ç¯‡éƒ½å€¼å›ç¥¨ä»·ï¼Œé†é†çŒé¡¶ï¼Œä½œè€…å¤§ä½¬å¤ªç‰›äº†","like_count":2},{"had_liked":false,"id":288746,"user_name":"èŠ±æ™¨å°‘å¹´","can_delete":false,"product_type":"c1","uid":1098987,"ip_address":"","ucode":"6AA3537A6BA10E","user_header":"https://static001.geekbang.org/account/avatar/00/10/c4/eb/2285a345.jpg","comment_is_top":false,"comment_ctime":1618652870,"is_pvip":false,"replies":[{"id":"104897","content":"å¯¹ï¼Œæ˜¯ä¸€ä¸ªå…¨å±€å•è°ƒé€’å¢çš„å€¼ï¼Œåœ¨boltdbä¸­æœ‰ä¸€ä¸ªkeyç»´æŠ¤å®ƒï¼Œetcdserveråº”ç”¨å·²æäº¤çš„raftæ—¥å¿—æ¡ç›®åˆ°çŠ¶æ€æœºæ—¶ï¼Œä¼šæŸ¥è¯¢æ­¤æ—¥å¿—æ¡ç›®çš„ç´¢å¼•æ˜¯å¦å¤§äºconsistent indexï¼Œå¦‚æœå¤§äºåˆ™åŒkey-valueç­‰æ•°æ®åœ¨åŒboltdbäº‹åŠ¡ä¸­æ›´æ–°å®ƒï¼Œå¦åˆ™è¯´æ˜æ­¤æ—¥å¿—æ¡ç›®å·²æ‰§è¡Œè¿‡ã€‚","user_name":"ä½œè€…å›å¤","comment_id":288746,"uid":"1009582","ip_address":"","utype":1,"ctime":1618885529,"user_name_real":"å”èª"}],"discussion_count":1,"race_medal":0,"score":"10208587462","product_id":100069901,"comment_content":"etcd é€šè¿‡å¼•å…¥ä¸€ä¸ª consistent index çš„å­—æ®µï¼Œæ¥å­˜å‚¨ç³»ç»Ÿå½“å‰å·²ç»æ‰§è¡Œè¿‡çš„æ—¥å¿—æ¡ç›®ç´¢å¼•ï¼Œå®ç°å¹‚ç­‰æ€§ã€‚<br>-----<br>consistent index æ˜¯ä¸€ä¸ªå…¨å±€çš„å€¼å—ï¼Œå•è°ƒé€’å¢çš„?è¿˜æ˜¯ä¸»è¦æœ‰raftæ—¥å¿—åº”ç”¨åˆ°çŠ¶æ€æœºï¼Œå°±ä¼šå­˜å‚¨å½“å‰consistent indexå€¼å—ï¼Œåˆ¤æ–­æ—¥å¿—ä½¿ç”¨å·²ç»æ‰§è¡Œè¿‡ï¼Œæ˜¯éœ€è¦è¿›è¡ŒkeyæŸ¥æ‰¾æ‰€æœ‰å­˜å‚¨çš„consistent indexå€¼å—","like_count":3,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518724,"discussion_content":"å¯¹ï¼Œæ˜¯ä¸€ä¸ªå…¨å±€å•è°ƒé€’å¢çš„å€¼ï¼Œåœ¨boltdbä¸­æœ‰ä¸€ä¸ªkeyç»´æŠ¤å®ƒï¼Œetcdserveråº”ç”¨å·²æäº¤çš„raftæ—¥å¿—æ¡ç›®åˆ°çŠ¶æ€æœºæ—¶ï¼Œä¼šæŸ¥è¯¢æ­¤æ—¥å¿—æ¡ç›®çš„ç´¢å¼•æ˜¯å¦å¤§äºconsistent indexï¼Œå¦‚æœå¤§äºåˆ™åŒkey-valueç­‰æ•°æ®åœ¨åŒboltdbäº‹åŠ¡ä¸­æ›´æ–°å®ƒï¼Œå¦åˆ™è¯´æ˜æ­¤æ—¥å¿—æ¡ç›®å·²æ‰§è¡Œè¿‡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618885529,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":281253,"user_name":"types","can_delete":false,"product_type":"c1","uid":2449777,"ip_address":"","ucode":"8B50927EF1804F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLDUJyeq54fiaXAgF62tNeocO3lHsKT4mygEcNoZLnibg6ONKicMgCgUHSfgW8hrMUXlwpNSzR8MHZwg/132","comment_is_top":false,"comment_ctime":1614665434,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10204600026","product_id":100069901,"comment_content":"1. consistent indexå…·ä½“æ˜¯å¦‚ä½•ä¿å­˜çš„ï¼Œå¦‚ä½•å®ç°è·Ÿå…·ä½“æ“ä½œå®ç°åŸå­æ€§æäº¤çš„<br>2. readIndexè·Ÿconsistent indexå„’è€…WAL indexä»€ä¹ˆå…³ç³»ï¼Ÿ ReadIndexä¸€å®šè¦å¤„äºcommitedå—ï¼Ÿ","like_count":3},{"had_liked":false,"id":312528,"user_name":"types","can_delete":false,"product_type":"c1","uid":2449777,"ip_address":"","ucode":"8B50927EF1804F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLDUJyeq54fiaXAgF62tNeocO3lHsKT4mygEcNoZLnibg6ONKicMgCgUHSfgW8hrMUXlwpNSzR8MHZwg/132","comment_is_top":false,"comment_ctime":1631849411,"is_pvip":false,"replies":[{"id":"113249","content":"ä¸²è¡Œ","user_name":"ä½œè€…å›å¤","comment_id":312528,"uid":"1009582","ip_address":"","utype":1,"ctime":1631887237,"user_name_real":"å”èª"}],"discussion_count":1,"race_medal":0,"score":"5926816707","product_id":100069901,"comment_content":"Applyæ¨¡å—é’ˆå¯¹å†™è¯·æ±‚ï¼Œæ˜¯ä¸²è¡Œæ‰§è¡Œçš„è¿˜æ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527001,"discussion_content":"ä¸²è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631887237,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":279555,"user_name":"æ°åŒå­¦å°‘å¹´ã€‚","can_delete":false,"product_type":"c1","uid":1928162,"ip_address":"","ucode":"4D4BC29421A245","user_header":"https://static001.geekbang.org/account/avatar/00/1d/6b/e2/f02e45df.jpg","comment_is_top":false,"comment_ctime":1613820177,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5908787473","product_id":100069901,"comment_content":"æ„Ÿè§‰ä¸å¤ªä¼šã€‚<br>1. clientæœ‰è´Ÿè½½å‡è¡¡ä¸ä¼šæœ‰å¾ˆå¤šè¯·æ±‚éƒ½ç›´æ¥åˆ°ä¸»ï¼Ÿ<br>2. v3æ”¯æŒå¤šè·¯å¤ç”¨ï¼ˆè¿™æ ·åˆ°ä¸»é“¾æ¥æ•°åº”è¯¥ä¸ä¼šå¤ªå¤šï¼‰<br>3. çº¿æ€§è¯»è¯·æ±‚åªä¼šå‘ä¸»å‘è·å–ReadIndexçš„è¯·æ±‚ï¼Œè¿˜æŒºè½»é‡çš„ã€‚<br>4. boltdbåªæœ‰å¯åŠ¨æ—¶ä¼šåŠ è½½dbæ–‡ä»¶å¹¶æ˜ å°„åˆ°mmapï¼Œå†…å­˜å¤Ÿå°±ä¸ä¼šæœ‰ç£ç›˜IOï¼Œæ‰€ä»¥å½±å“ä¹Ÿä¸å¤§ã€‚","like_count":2},{"had_liked":false,"id":279472,"user_name":"æµ®ç”Ÿå…­è®°","can_delete":false,"product_type":"c1","uid":1134354,"ip_address":"","ucode":"5BEB409EF2B092","user_header":"https://static001.geekbang.org/account/avatar/00/11/4f/12/e1564440.jpg","comment_is_top":false,"comment_ctime":1613796305,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5908763601","product_id":100069901,"comment_content":"&quot;å…¶æ¬¡ etcd é€šè¿‡åˆå¹¶å¤šä¸ªå†™äº‹åŠ¡è¯·æ±‚ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæ˜¯å¼‚æ­¥æœºåˆ¶å®šæ—¶ï¼ˆé»˜è®¤æ¯éš” 100msï¼‰å°†æ‰¹é‡äº‹åŠ¡ä¸€æ¬¡æ€§æäº¤ï¼ˆpending äº‹åŠ¡è¿‡å¤šæ‰ä¼šè§¦å‘åŒæ­¥æäº¤ï¼‰ï¼Œ ä»è€Œå¤§å¤§æé«˜ååé‡ï¼Œå¯¹åº”ä¸Šé¢ç®€æ˜“å†™äº‹åŠ¡å›¾çš„æµç¨‹ä¸‰ã€‚&quot;<br><br>ä½ å¥½ï¼Œå¼‚æ­¥æäº¤çš„äº‹åŠ¡ï¼Œçªç„¶crashçš„è¯ï¼Œå¦‚æœä¿è¯å®‰å…¨å†™å…¥ç£ç›˜å‘¢ï¼Ÿæ˜¯boltdbæœ‰ä»€ä¹ˆæœºåˆ¶ä¿è¯å—ï¼Ÿæˆ‘åœ¨boltdbé‚£ä¸ªç« èŠ‚æ²¡æœ‰çœ‹åˆ°ç›¸å…³å†…å®¹ï¼Œå°±æ­¤è¯·æ•™ä¸€ä¸‹ã€‚","like_count":1,"discussions":[{"author":{"id":1928162,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/6b/e2/f02e45df.jpg","nickname":"æ°åŒå­¦å°‘å¹´ã€‚","note":"","ucode":"4D4BC29421A245","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350352,"discussion_content":"ä¸ªäººæ„Ÿè§‰æ˜¯é€šè¿‡consistent indexä¿è¯çš„ï¼Œåªæœ‰commitçš„äº‹åŠ¡consistent indexæ‰ä¼šè®°ä¸‹æ¥ã€‚ä¸ç„¶etcdé‡å¯ä¼šæ ¹æ®WALä¸­çš„æ•°æ®è¿›è¡Œé‡æ”¾æ‰§è¡Œçš„ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1613819600,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1134354,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4f/12/e1564440.jpg","nickname":"æµ®ç”Ÿå…­è®°","note":"","ucode":"5BEB409EF2B092","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1928162,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/6b/e2/f02e45df.jpg","nickname":"æ°åŒå­¦å°‘å¹´ã€‚","note":"","ucode":"4D4BC29421A245","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350671,"discussion_content":"å—¯ï¼Œæˆ‘ä¼°è®¡ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæˆ‘çœ‹äº†å‡ ä¸ªç« èŠ‚ï¼Œæ„Ÿè§‰è¿˜æ˜¯ä¸èƒ½å·æ‡’ï¼Œè¿˜æ˜¯å¾—è‡ªå·±å¯¹ç€ä»£ç è¯»ä¸€è¯»ï¼Œæ‰èƒ½æœ‰æ­£åœ¨çš„æ”¶è·ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613975665,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":350352,"ip_address":""},"score":350671,"extra":""}]}]},{"had_liked":false,"id":276153,"user_name":"äºé€”","can_delete":false,"product_type":"c1","uid":1669343,"ip_address":"","ucode":"70300C6CCCEAF1","user_header":"https://static001.geekbang.org/account/avatar/00/19/78/df/424bdc4a.jpg","comment_is_top":false,"comment_ctime":1611815869,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5906783165","product_id":100069901,"comment_content":"etcd é»˜è®¤è¶…æ—¶æ—¶é—´æ˜¯ 7 ç§’ï¼ˆ5 ç§’ç£ç›˜ IO å»¶æ—¶ +2*1 ç§’ç«é€‰è¶…æ—¶æ—¶é—´ï¼‰<br><br>è€å¸ˆï¼Œâ€œç«é€‰è¶…æ—¶æ—¶é—´â€å…·ä½“æŒ‡çš„æ˜¯ä»€ä¹ˆï¼Ÿè¿˜æœ‰ç£ç›˜IOå»¶æ—¶è¦æ€ä¹ˆç†è§£æ¯”è¾ƒè´´åˆ‡ï¼Ÿ","like_count":1},{"had_liked":false,"id":275813,"user_name":"ä¸€æ­¥","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1611674971,"is_pvip":true,"replies":[{"id":"100199","content":"boltdbçš„dbæ–‡ä»¶ï¼Œä½ å¯ä»¥åœ¨etcdçš„æ•°æ®ç›®å½•snapç›®å½•ä¸‹çœ‹åˆ°æœ‰ä¸ªåä¸ºdbçš„æ–‡ä»¶ï¼Œå®è·µç¯‡æˆ‘ä¼šä»‹ç»dbæ–‡ä»¶è¿‡å¤§åˆå“ªäº›é—®é¢˜ï¼Œetcdå®šä½å°±æ˜¯ä¸ªå°å‹çš„å…³é”®å…ƒæ•°æ®å­˜å‚¨","user_name":"ä½œè€…å›å¤","comment_id":275813,"uid":"1009582","ip_address":"","utype":1,"ctime":1611747447,"user_name_real":"å”èª"}],"discussion_count":1,"race_medal":0,"score":"5906642267","product_id":100069901,"comment_content":"è¿™é‡Œ db é…é¢ï¼ˆQuotaï¼‰çš„é™åˆ¶å“ªä¸ªåœ°æ–¹çš„å¤§å°çš„ï¼Ÿ ä¸ºä»€ä¹ˆä¼šæœ‰è¿™æ ·çš„é™åˆ¶å‘¢ï¼Ÿ è¿™ä¸ªé™åˆ¶æ˜¯  boltdb å…¨éƒ¨æ•°æ® æŒä¹…åŒ–åçš„æ–‡ä»¶å¤§å°å—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514484,"discussion_content":"boltdbçš„dbæ–‡ä»¶ï¼Œä½ å¯ä»¥åœ¨etcdçš„æ•°æ®ç›®å½•snapç›®å½•ä¸‹çœ‹åˆ°æœ‰ä¸ªåä¸ºdbçš„æ–‡ä»¶ï¼Œå®è·µç¯‡æˆ‘ä¼šä»‹ç»dbæ–‡ä»¶è¿‡å¤§åˆå“ªäº›é—®é¢˜ï¼Œetcdå®šä½å°±æ˜¯ä¸ªå°å‹çš„å…³é”®å…ƒæ•°æ®å­˜å‚¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611747447,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":275522,"user_name":"mckee","can_delete":false,"product_type":"c1","uid":1066511,"ip_address":"","ucode":"E4DEBB462B93A1","user_header":"https://static001.geekbang.org/account/avatar/00/10/46/0f/f6cfc659.jpg","comment_is_top":false,"comment_ctime":1611570366,"is_pvip":false,"replies":[{"id":"100032","content":"compactæ˜¯éå¸¸å¸¸è§„çš„æ“ä½œï¼Œåªè¦dbæ–‡ä»¶ä¸æ˜¯ç‰¹åˆ«å¤§ï¼Œå¤§å°ä¿æŒç¨³å®šå°±ä¸ç”¨defragå“ˆï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1611638367,"ip_address":"","comment_id":275522,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5906537662","product_id":100069901,"comment_content":"compactåæ²¡æœ‰defragçš„è¯å¯¹æ€§èƒ½æœ‰å½±å“å—","like_count":2,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514381,"discussion_content":"compactæ˜¯éå¸¸å¸¸è§„çš„æ“ä½œï¼Œåªè¦dbæ–‡ä»¶ä¸æ˜¯ç‰¹åˆ«å¤§ï¼Œå¤§å°ä¿æŒç¨³å®šå°±ä¸ç”¨defragå“ˆï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611638367,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":351669,"user_name":"Geek_43032e","can_delete":false,"product_type":"c1","uid":1399477,"ip_address":"","ucode":"7F5108CAE16160","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJnv4h4j5tWyyI5h0hqCa7rgsqW9YJHPVvNPpSaN5wQLAGaheKiaa4ALujaZOX7S3vPcg9ODsyLBiaQ/132","comment_is_top":false,"comment_ctime":1658068756,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1658068756","product_id":100069901,"comment_content":"raftæŒä¹…åŒ–çš„å†…å®¹åŒ…æ‹¬logã€votedFor(ä¿å­˜äº†åœ¨ä¸€ä¸ªtermå†…ä¸ºå“ªä¸ªå€™é€‰äººæŠ•äº†ç¥¨çš„ä¿¡æ¯)ã€currentTermï¼Œä¸ä¼šè®°å½•committed indexã€‚åœ¨rafté›†ç¾¤æ•…éšœæ¢å¤æ—¶ï¼Œä¼šåˆ©ç”¨logæ¢å¤åˆ°ä¸€ä¸ªä¸€è‡´æ€§çš„çŠ¶æ€ï¼Œåœ¨å®é™…ä½¿ç”¨æ—¶é€šå¸¸è¿˜ä¼šå®ç°log compaction and snapshotsåŠŸèƒ½ä»¥ç¼©çŸ­æ•…éšœæ¢å¤æ—¶é—´","like_count":0},{"had_liked":false,"id":347898,"user_name":"é™†Zzz~","can_delete":false,"product_type":"c1","uid":2580648,"ip_address":"","ucode":"EDCCF83403CC65","user_header":"https://static001.geekbang.org/account/avatar/00/27/60/a8/bdc3d42e.jpg","comment_is_top":false,"comment_ctime":1654566660,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1654566660","product_id":100069901,"comment_content":"è€å¸ˆæˆ‘æœ‰ä¸ªç–‘é—®ï¼Œæ–‡ä¸­è¯´åªè¦ä¿è¯åŒä¸€ä¸ªç´¢å¼•çš„æ—¥å¿—æ‰§è¡Œä¸€æ¬¡å°±èƒ½å¹‚ç­‰ï¼Œå‡è®¾æœ‰ä¸€æ¡å‘½ä»¤ï¼Œå®¢æˆ·ç«¯å‘é€ç»™äº†raftå¹¶ä¸”æäº¤ä½†æ˜¯è¿˜æ²¡applyï¼Œç„¶åå®¢æˆ·ç«¯è§‰å¾—å¤±è´¥äº†ï¼Œåˆå‘é€ä¸€æ¬¡ï¼Œè¿™æ—¶ä¼šç”Ÿæˆä¸€æ¡æ–°çš„æ—¥å¿—ï¼Œé‚£ä¹ˆè¿™ä¸¤æ¡æ—¥å¿—å…¶å®åªæ˜¯ä¸Šå±‚çš„ä¸€æ¡æ—¥å¿—ï¼Œè¿™ç§æƒ…å†µæ€ä¹ˆä¿è¯å¹‚ç­‰å‘¢","like_count":0},{"had_liked":false,"id":346528,"user_name":"è“é£","can_delete":false,"product_type":"c1","uid":2979239,"ip_address":"","ucode":"6CC0E755E88247","user_header":"https://static001.geekbang.org/account/avatar/00/2d/75/a7/76ca047c.jpg","comment_is_top":false,"comment_ctime":1653214860,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1653214860","product_id":100069901,"comment_content":"1.etcd quota æŒ‡çš„æ˜¯å†…å­˜ç©ºé—´è¿˜æ˜¯ç£ç›˜ç©ºé—´ï¼Ÿ<br>2.etcd é‡å¯æ—¶ï¼Œä¼šä» WAL ä¸­è§£æå‡º Raft æ—¥å¿—æ¡ç›®å†…å®¹ï¼Œè¿½åŠ åˆ° Raft æ—¥å¿—çš„å­˜å‚¨ä¸­ï¼Œå¹¶é‡æ”¾å·²æäº¤çš„æ—¥å¿—ææ¡ˆç»™ Apply æ¨¡å—æ‰§è¡Œã€‚ä¸­çš„â€œè¿½åŠ åˆ°Raftæ—¥å¿—çš„å­˜å‚¨ä¸­â€ æ˜¯æŒ‡ä»€ä¹ˆï¼Ÿéœ€è¦å•ç‹¬çš„åŒºåŸŸå­˜å‚¨æ—¥å¿—ï¼Ÿæ˜¯ç£ç›˜ç©ºé—´è¿˜æ˜¯å†…å­˜ï¼Ÿæ˜¯ä¸æ˜¯å¯ä»¥ç†è§£ä¸ºå…ˆæŠŠwalé‡Œé¢æ—¥å¿—å…ˆè¯»åˆ°å†…å­˜ï¼Œç„¶åå†æ ¹æ®å†…å­˜çš„æ•°æ®å»è®©Applyæ¨¡å—é‡æ”¾ï¼Ÿ","like_count":0},{"had_liked":false,"id":339453,"user_name":"Geek_013d3d","can_delete":false,"product_type":"c1","uid":2775971,"ip_address":"","ucode":"55B7D002D66938","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqrmEUn2jvPbqqHTgcUzMSfI0Dvv7OZTHXyPgvN78qgoPBrejAlVgmicicicHKAPZiaewaXCKEsYicqL8A/132","comment_is_top":false,"comment_ctime":1648111342,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1648111342","product_id":100069901,"comment_content":"ä½ å¥½ï¼Œè¯·æ•™ä¸ªé—®é¢˜ï¼ŒfollowerèŠ‚ç‚¹æ¥å—åˆ°å†™è¯·æ±‚åï¼Œä¼šè½¬å‘ç»™leaderï¼Œleader applyè¯¥æ¶ˆæ¯åï¼Œfolloweræ˜¯å¦‚ä½•æ‹¿åˆ°è¿™ä¸ªè¯·æ±‚çš„ç»“æœçš„ï¼Ÿ","like_count":0},{"had_liked":false,"id":337851,"user_name":"Geek_87a588","can_delete":false,"product_type":"c1","uid":2885926,"ip_address":"","ucode":"E594E9A4E035FF","user_header":"","comment_is_top":false,"comment_ctime":1647093949,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1647093949","product_id":100069901,"comment_content":"è€å¸ˆï¼ŒetcdserveræŒ‡çš„æ˜¯ä»€ä¹ˆå‘€ï¼Œæ˜¯æŒ‡çš„æ˜¯æ•´ä¸ªetcdé›†ç¾¤å—ï¼Ÿè¿˜æ˜¯ä¸€ä¸ªetcdèŠ‚ç‚¹ï¼Œæˆ–è€…etcdèŠ‚ç‚¹ä¸­ä¸€ä¸ªæ¨¡å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":337237,"user_name":"è¿½é£ç­çš„äºº","can_delete":false,"product_type":"c1","uid":1488020,"ip_address":"","ucode":"2993D60F94C396","user_header":"https://static001.geekbang.org/account/avatar/00/16/b4/94/2796de72.jpg","comment_is_top":false,"comment_ctime":1646710224,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646710224","product_id":100069901,"comment_content":"è€å¸ˆ  æ„Ÿè§‰mysql æ¯”è¾ƒå®¹æ˜“å…¥é—¨ï¼Œ ETCD ä¸å¥½å­¦  è„‘å£³ç–¼  æ˜¯ä¸æ˜¯ä¸é€‚åˆå­¦ETCD ?","like_count":0},{"had_liked":false,"id":328868,"user_name":"æ®‹å¤©å™¬é­‚","can_delete":false,"product_type":"c1","uid":1506609,"ip_address":"","ucode":"A2AD8303A4518D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/q2HwchogzNiavKhIB4GfAxH6B88NhSoC7B7keVEUqiaP6JPokDUNJLYehocOyqYqrhA3iaxywyRXLYkYJjDUQESZw/132","comment_is_top":false,"comment_ctime":1640921325,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1640921325","product_id":100069901,"comment_content":"è€å¸ˆï¼Œè¿™ä¸ªQuota æ¨¡å—æ˜¯å¹²ä»€ä¹ˆç”¨çš„ï¼Ÿ","like_count":0},{"had_liked":false,"id":321919,"user_name":"Adam","can_delete":false,"product_type":"c1","uid":1305633,"ip_address":"","ucode":"338BA720880E4F","user_header":"https://static001.geekbang.org/account/avatar/00/13/ec/21/b0fe1bfd.jpg","comment_is_top":false,"comment_ctime":1637110717,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637110717","product_id":100069901,"comment_content":"è€å¸ˆï¼Œå‡å¦‚æˆ‘çš„etcd é›†ç¾¤éƒ¨ç½²åœ¨k8sä¸­ï¼Œé€šè¿‡lb çš„æ–¹å¼æš´éœ²æœåŠ¡å‡ºæ¥ï¼Œé›†ç¾¤å¤–çš„apisix é€šè¿‡slb åœ°å€å»è®¿é—®etcd æœåŠ¡æ˜¯ä¸æ˜¯ä¹Ÿæ˜¯è´Ÿè½½å‡è¡¡çš„æ–¹å¼ï¼Ÿ","like_count":0},{"had_liked":false,"id":314310,"user_name":"å…«å°ä¸Š","can_delete":false,"product_type":"c1","uid":1391143,"ip_address":"","ucode":"FB3D74B522C720","user_header":"https://static001.geekbang.org/account/avatar/00/15/3a/27/5d218272.jpg","comment_is_top":false,"comment_ctime":1632967722,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632967722","product_id":100069901,"comment_content":"è€æ˜¯æƒ³é—®ä¸€ä¸‹ å®¢æˆ·ç«¯æ”¶åˆ°etcdserver: request timed out è¿™ä¸ªé”™è¯¯æ—¶ï¼Œ ææ¡ˆæäº¤æˆåŠŸäº†å—ï¼Ÿ æ˜¯å¦éœ€è¦é‡æ–°æäº¤ææ¡ˆå‘¢ï¼Ÿ      è¿˜æœ‰å°±æ˜¯å®¢æˆ·ç«¯å†æäº¤ä¸€ä¸ªå†™è¯·æ±‚åä»€ä¹ˆæ—¶å€™è¿”å›ç»™å®¢æˆ·ç«¯å‘¢","like_count":0},{"had_liked":false,"id":313968,"user_name":"types","can_delete":false,"product_type":"c1","uid":2449777,"ip_address":"","ucode":"8B50927EF1804F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLDUJyeq54fiaXAgF62tNeocO3lHsKT4mygEcNoZLnibg6ONKicMgCgUHSfgW8hrMUXlwpNSzR8MHZwg/132","comment_is_top":false,"comment_ctime":1632761176,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632761176","product_id":100069901,"comment_content":"æ–‡ä¸­æåŠï¼š è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä»¥ä¸Šæµç¨‹ä¸­ï¼Œetcd å¹¶æœªæäº¤äº‹åŠ¡ï¼ˆcommitï¼‰ï¼Œå› æ­¤æ•°æ®åªæ›´æ–°åœ¨ boltdb æ‰€ç®¡ç†çš„å†…å­˜æ•°æ®ç»“æ„ä¸­ã€‚<br>boltdbæ‰€ç®¡ç†çš„å†…å­˜æ•°æ®ç»“æ„ï¼Œæ–‡ä¸­æåˆ°äº¤bucket bufferï¼Œè¯·é—®è¿™ä¸ªbucket bufferè·Ÿtreeindexç®€æ˜“å†™äº‹åŠ¡å›¾ï¼ˆæµç¨‹2ï¼‰ä¸­çš„bufferæ˜¯ä¸€ä¸ªbufferå—ï¼Ÿ","like_count":0},{"had_liked":false,"id":312985,"user_name":"Vincent","can_delete":false,"product_type":"c1","uid":1087978,"ip_address":"","ucode":"CE4942FD556842","user_header":"https://static001.geekbang.org/account/avatar/00/10/99/ea/0d7b8cdc.jpg","comment_is_top":false,"comment_ctime":1632188350,"is_pvip":true,"replies":[{"id":"114593","content":"å—¯ï¼Œä¸€èˆ¬æˆ‘ä»¬éƒ½æ˜¯å…ˆå°†é›†ç¾¤dbé…é¢è°ƒå¤§ï¼Œç„¶åè§£é™¤å‘Šè­¦å¿«é€Ÿæ¢å¤é›†ç¾¤ï¼Œä¿è¯é›†ç¾¤å¯ç”¨ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1634312624,"ip_address":"","comment_id":312985,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1632188350","product_id":100069901,"comment_content":"å”è€å¸ˆå¥½ï¼Œæ–‡ä¸­æœ‰æåˆ° compact ä¹‹ååªæ˜¯å°†ç©ºé—´æ ‡è®°ä¸º freeï¼Œè¿˜éœ€è¦ defrag æ‰èƒ½é‡Šæ”¾ç©ºé—´ï¼Œå¦‚æœæˆ‘æ­¤æ—¶ç›´æ¥ disalarm ä¸defrag æ˜¯ä¸æ˜¯å¯ä»¥å…ˆå°†é›†ç¾¤æ¢å¤ï¼Ÿ å…ˆä¿è¯é›†ç¾¤å¯ç”¨ã€‚","like_count":0,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527190,"discussion_content":"å—¯ï¼Œä¸€èˆ¬æˆ‘ä»¬éƒ½æ˜¯å…ˆå°†é›†ç¾¤dbé…é¢è°ƒå¤§ï¼Œç„¶åè§£é™¤å‘Šè­¦å¿«é€Ÿæ¢å¤é›†ç¾¤ï¼Œä¿è¯é›†ç¾¤å¯ç”¨ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634312624,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312296,"user_name":"ç¥æ¯“é€é¥","can_delete":false,"product_type":"c1","uid":2147220,"ip_address":"","ucode":"83351CB18B190E","user_header":"https://static001.geekbang.org/account/avatar/00/20/c3/94/e89ebc50.jpg","comment_is_top":false,"comment_ctime":1631721846,"is_pvip":true,"replies":[{"id":"113193","content":"å—¯","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1631796440,"ip_address":"","comment_id":312296,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1631721846","product_id":100069901,"comment_content":"å¾ˆä¸é”™ï¼Œæœ¬ç« èŠ‚ä¸»è¦æŒæ¡å†™æµç¨‹ï¼Œç„¶åå¯ä»¥è·Ÿè¯»æµç¨‹å¯¹æ¯”åˆ†æä¸å­¦ä¹ ï¼Œä¸»è¦åœ¨äº Quota,WAL,APPLY ä¸‰å—ï¼Œç”±äºæ˜¯åä¸¤è€…ç»†èŠ‚æ¯”è¾ƒå¤š","like_count":0,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526928,"discussion_content":"å—¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631796440,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":304017,"user_name":"Geek_7d539e","can_delete":false,"product_type":"c1","uid":2037654,"ip_address":"","ucode":"0D116E904D616E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIVvyFCLRcfoWfiaJt99K0wiabvicWtQaJdSseVA6QqWyxcvN5nd2TgZqiaUACc94bBvPHZTibnfnZfdtQ/132","comment_is_top":false,"comment_ctime":1627184275,"is_pvip":false,"replies":[{"id":"110131","content":"æ˜¯çš„ï¼Œä¸€ä¸ªboltdbäº‹åŠ¡ä¸­åŒ…å«å¤šä¸ªkey-valueæ“ä½œï¼Œæœ‰ç”¨æˆ·çš„ï¼Œä¹Ÿæœ‰etcdæ‰€ç»´æŠ¤çš„å…ƒæ•°æ®ï¼Œbucket nameä¸ä¸€æ ·è€Œå·²ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1627366394,"ip_address":"","comment_id":304017,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1627184275","product_id":100069901,"comment_content":"è¯´åˆ°å¹‚ç­‰æ€§æ—¶ï¼Œæåˆ°äº†ä¸€ä¸ªåŸå­æ“ä½œã€‚æ‰§è¡Œå‘½ä»¤çš„è¯·æ±‚æ›´æ–°æˆåŠŸäº†ï¼ŒåŒæ—¶æ›´æ–° index ï¼Œä¸¤ä¸ªæ“ä½œä½œä¸ºä¸€ä¸ªåŸå­æ“ä½œã€‚åœ¨ boltdb ç¯èŠ‚é‡Œé¢æåˆ°å¼‚æ­¥æ‰¹é‡æäº¤æ“ä½œï¼Œè¿™ä¸ªåŸå­æ“ä½œæ˜¯åœ¨å¼‚æ­¥æäº¤æ—¶åŒæ—¶å®Œæˆå¯¹åº”æ—¥å¿—æ¡ç›®çš„å…¥åº“åä¸€èµ·å®Œæˆçš„å—ï¼Ÿè¯·æ•™ä¸‹","like_count":1,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523901,"discussion_content":"æ˜¯çš„ï¼Œä¸€ä¸ªboltdbäº‹åŠ¡ä¸­åŒ…å«å¤šä¸ªkey-valueæ“ä½œï¼Œæœ‰ç”¨æˆ·çš„ï¼Œä¹Ÿæœ‰etcdæ‰€ç»´æŠ¤çš„å…ƒæ•°æ®ï¼Œbucket nameä¸ä¸€æ ·è€Œå·²ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627366394,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":302102,"user_name":"æ’¸èµ·è¢–å­åŠ æ²¹å¹²","can_delete":false,"product_type":"c1","uid":1620279,"ip_address":"","ucode":"F35BA2C64BC5AA","user_header":"https://static001.geekbang.org/account/avatar/00/18/b9/37/87755dd8.jpg","comment_is_top":false,"comment_ctime":1626081029,"is_pvip":false,"replies":[{"id":"112705","content":"etcdctlæ˜¯æ— æ³•æŸ¥çœ‹çš„å­&#47;æ¬¡ç‰ˆæœ¬å·, å¦‚æœä½ æƒ³è°ƒè¯•etcdï¼Œä¸€æ–¹é¢ä½ å¯ä»¥åŠ æ—¥å¿—ï¼Œå¦ä¸€æ–¹é¢ä½ å¯ä»¥é€šè¿‡etcd-dump-dbå·¥å…·æŸ¥çœ‹,å®ƒå¯ä»¥æ‰“å°key-valueæ•°æ®ï¼Œä¸è¿‡ä¹Ÿä¸ç›´è§‚","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1631028639,"ip_address":"","comment_id":302102,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1626081029","product_id":100069901,"comment_content":"è¯·é—®è€å¸ˆæ¬¡ç‰ˆæœ¬å·æ€ä¹ˆæŸ¥çœ‹ï¼Ÿæˆ‘ç”¨ etcdctl get key -w=fileds åªèƒ½çœ‹åˆ°ä¸»ç‰ˆæœ¬å·ã€‚","like_count":1,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523181,"discussion_content":"etcdctlæ˜¯æ— æ³•æŸ¥çœ‹çš„å­/æ¬¡ç‰ˆæœ¬å·, å¦‚æœä½ æƒ³è°ƒè¯•etcdï¼Œä¸€æ–¹é¢ä½ å¯ä»¥åŠ æ—¥å¿—ï¼Œå¦ä¸€æ–¹é¢ä½ å¯ä»¥é€šè¿‡etcd-dump-dbå·¥å…·æŸ¥çœ‹,å®ƒå¯ä»¥æ‰“å°key-valueæ•°æ®ï¼Œä¸è¿‡ä¹Ÿä¸ç›´è§‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631028639,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":301788,"user_name":"é‡‘æ—¶","can_delete":false,"product_type":"c1","uid":1120428,"ip_address":"","ucode":"3491B2367A7238","user_header":"https://static001.geekbang.org/account/avatar/00/11/18/ac/4d68ba46.jpg","comment_is_top":false,"comment_ctime":1625882003,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625882003","product_id":100069901,"comment_content":"å¦‚æœleader èŠ‚ç‚¹å®•æœºèµ·ä¸æ¥äº†ï¼Œä¼šé€ æˆä¸¢å¤±æ•°æ®å—","like_count":0},{"had_liked":false,"id":288951,"user_name":"jssfy","can_delete":false,"product_type":"c1","uid":1137238,"ip_address":"","ucode":"F16353CFE607B7","user_header":"https://static001.geekbang.org/account/avatar/00/11/5a/56/115c6433.jpg","comment_is_top":false,"comment_ctime":1618797631,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1618797631","product_id":100069901,"comment_content":"æœ‰walå¯ä»¥é¿å…æ“ä½œäº§ç”Ÿä¸ä¸€è‡´ï¼Œé‚£éç¨³å®šçš„raftæ—¥å¿—å’Œç¨³å®šçš„raftæ—¥å¿—å­˜åœ¨çš„å¿…è¦æ€§æ˜¯ä»€ä¹ˆå‘¢?","like_count":0,"discussions":[{"author":{"id":1535604,"avatar":"https://static001.geekbang.org/account/avatar/00/17/6e/74/1bd3eef0.jpg","nickname":"å¤å•†å‘¨","note":"","ucode":"1EBC83100FE82F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377028,"discussion_content":"unstableå†™äº†å°±è¦å†™walï¼Œæ—¥å¿—å°±ç¨³å®šäº†ã€‚storageï¼Œæ›´åƒä¸€ä¸ªçŠ¶æ€æœºï¼Œç»´æŠ¤raftçš„çŠ¶æ€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622468583,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":288752,"user_name":"èŠ±æ™¨å°‘å¹´","can_delete":false,"product_type":"c1","uid":1098987,"ip_address":"","ucode":"6AA3537A6BA10E","user_header":"https://static001.geekbang.org/account/avatar/00/10/c4/eb/2285a345.jpg","comment_is_top":false,"comment_ctime":1618653340,"is_pvip":false,"replies":[{"id":"104898","content":"ä¸ä»…ä»…æ˜¯è¿™ä¸ªç›®çš„å“ˆï¼Œæœ€é‡è¦æ ¸å¿ƒè¿‡ç¨‹æ˜¯é‡å»ºtreeIndexæ¨¡å—","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1618885617,"ip_address":"","comment_id":288752,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1618653340","product_id":100069901,"comment_content":"å› ä¸º boltdb ä¸­çš„ key å°±åŒ…å«æ­¤ä¿¡æ¯ï¼Œæ‰€ä»¥ etcd å¹¶ä¸éœ€è¦å†å»æŒä¹…åŒ–ä¸€ä¸ªå…¨å±€ç‰ˆæœ¬å·ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œä»æœ€å°å€¼ 1 å¼€å§‹æšä¸¾åˆ°æœ€å¤§å€¼ï¼Œæœªè¯»åˆ°æ•°æ®çš„æ—¶å€™åˆ™ç»“æŸï¼Œæœ€åè¯»å‡ºæ¥çš„ç‰ˆæœ¬å·å³æ˜¯å½“å‰ etcd çš„æœ€å¤§ç‰ˆæœ¬å· currentRevisionã€‚<br>------<br>ä¸ºäº†å–å¾—ä¸€ä¸ªæœ€å¤§çš„ç‰ˆæœ¬å·ï¼Œè¦æ‰«ææ•´ä¸ªdbçš„keyå—ï¼Ÿ è¿™å¼€é”€å¤ªå¤§äº†å§ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518727,"discussion_content":"ä¸ä»…ä»…æ˜¯è¿™ä¸ªç›®çš„å“ˆï¼Œæœ€é‡è¦æ ¸å¿ƒè¿‡ç¨‹æ˜¯é‡å»ºtreeIndexæ¨¡å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618885617,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":288750,"user_name":"èŠ±æ™¨å°‘å¹´","can_delete":false,"product_type":"c1","uid":1098987,"ip_address":"","ucode":"6AA3537A6BA10E","user_header":"https://static001.geekbang.org/account/avatar/00/10/c4/eb/2285a345.jpg","comment_is_top":false,"comment_ctime":1618653269,"is_pvip":false,"replies":[{"id":"104896","content":"å—¯ï¼Œè¿™é‡Œç»“åˆä¸Šä¸‹æ–‡ï¼Œæ˜¯æŒ‡ç¬¬ä¸€æ¬¡å¯åŠ¨","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1618884976,"ip_address":"","comment_id":288750,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1618653269","product_id":100069901,"comment_content":"ç‰ˆæœ¬å·ï¼ˆrevisionï¼‰åœ¨ etcd é‡Œé¢å‘æŒ¥ç€é‡å¤§ä½œç”¨ï¼Œå®ƒæ˜¯ etcd çš„é€»è¾‘æ—¶é’Ÿã€‚etcd å¯åŠ¨çš„æ—¶å€™é»˜è®¤ç‰ˆæœ¬å·æ˜¯ 1ï¼Œéšç€ä½ å¯¹ key çš„å¢ã€åˆ ã€æ”¹æ“ä½œè€Œå…¨å±€å•è°ƒé€’å¢ã€‚<br>----------<br>ç†è§£åº”è¯¥æ˜¯ç¬¬ä¸€æ¬¡å¯åŠ¨çš„æ—¶å€™ï¼Œé»˜è®¤ç‰ˆæœ¬å·æ‰æ˜¯1æŠŠï¼Œåç»­é‡å¯æœåŠ¡ç‰ˆæœ¬å·åº”è¯¥ä¸ä¼šé‡ç½®ä¸º0å§ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518726,"discussion_content":"å—¯ï¼Œè¿™é‡Œç»“åˆä¸Šä¸‹æ–‡ï¼Œæ˜¯æŒ‡ç¬¬ä¸€æ¬¡å¯åŠ¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618884976,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":288748,"user_name":"èŠ±æ™¨å°‘å¹´","can_delete":false,"product_type":"c1","uid":1098987,"ip_address":"","ucode":"6AA3537A6BA10E","user_header":"https://static001.geekbang.org/account/avatar/00/10/c4/eb/2285a345.jpg","comment_is_top":false,"comment_ctime":1618652969,"is_pvip":false,"replies":[{"id":"104899","content":"int64çš„å“ˆï¼Œå¾ˆéš¾è¶…è¿‡ï¼Œç›®å‰ç¤¾åŒºæ˜¯æ²¡è€ƒè™‘è¶…è¿‡int64","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1618885678,"ip_address":"","comment_id":288748,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1618652969","product_id":100069901,"comment_content":"è¿™é‡Œæåˆ°å¾ˆå¤šç§ç±»çš„indexå€¼ï¼Œéƒ½æ˜¯å•è°ƒé€’å¢çš„ï¼Œæ¯”å¦‚è¯´è¿™ä¸ªå€¼å¦‚æœæ˜¯uint32ï¼Œè¶…è¿‡å€¼èŒƒå›´åï¼Œæ˜¯æ€ä¹ˆå¤„ç†ï¼Œä»0å¼€å§‹å—ã€‚","like_count":0,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518725,"discussion_content":"int64çš„å“ˆï¼Œå¾ˆéš¾è¶…è¿‡ï¼Œç›®å‰ç¤¾åŒºæ˜¯æ²¡è€ƒè™‘è¶…è¿‡int64","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618885678,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":286420,"user_name":"Rememberä¹ç¦»","can_delete":false,"product_type":"c1","uid":1237327,"ip_address":"","ucode":"97EE6E6344689F","user_header":"https://static001.geekbang.org/account/avatar/00/12/e1/4f/00476b4c.jpg","comment_is_top":false,"comment_ctime":1617289962,"is_pvip":false,"replies":[{"id":"104092","content":"åœ¨etcd3ä¸­ï¼Œä½ å¯ä»¥ç®€å•ç†è§£ä¸ºï¼ŒçŠ¶æ€æœºçš„è¾“å…¥æ˜¯Raftæ¨¡å—å·²æäº¤çš„æ—¥å¿—æ¡ç›®å‘½ä»¤ï¼ŒçŠ¶æ€æœºåŒ…å«äº†MVCCç­‰æ¨¡å—ï¼Œä½¿ç”¨boltdbç­‰æ¥ä¿å­˜kvæ•°æ®ç­‰ï¼Œè´Ÿè´£ç»´æŠ¤æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€æ•°æ®ç­‰ï¼Œåœ¨04ç¯‡æœ‰ä¸ªçŠ¶æ€æœºç›¸å…³çš„æ¶æ„å›¾","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1617436624,"ip_address":"","comment_id":286420,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1617289962","product_id":100069901,"comment_content":"æœ‰ä¸ªé—®é¢˜ï¼šæ–‡ä¸­çš„çŠ¶æ€æœºåˆ°åº•æ˜¯å•¥ï¼Ÿä»£è¡¨å›¾ä¸­çš„å“ªä¸ªæµç¨‹ï¼Ÿå®ƒæ˜¯å¹²å•¥ç”¨çš„ï¼Ÿæ´»ç€è°åœ¨ç”¨å®ƒï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517980,"discussion_content":"åœ¨etcd3ä¸­ï¼Œä½ å¯ä»¥ç®€å•ç†è§£ä¸ºï¼ŒçŠ¶æ€æœºçš„è¾“å…¥æ˜¯Raftæ¨¡å—å·²æäº¤çš„æ—¥å¿—æ¡ç›®å‘½ä»¤ï¼ŒçŠ¶æ€æœºåŒ…å«äº†MVCCç­‰æ¨¡å—ï¼Œä½¿ç”¨boltdbç­‰æ¥ä¿å­˜kvæ•°æ®ç­‰ï¼Œè´Ÿè´£ç»´æŠ¤æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€æ•°æ®ç­‰ï¼Œåœ¨04ç¯‡æœ‰ä¸ªçŠ¶æ€æœºç›¸å…³çš„æ¶æ„å›¾","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617436624,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2979239,"avatar":"https://static001.geekbang.org/account/avatar/00/2d/75/a7/76ca047c.jpg","nickname":"è“é£","note":"","ucode":"6CC0E755E88247","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583825,"discussion_content":"å°±æ˜¯etcdçš„æ•°æ®åº“","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660408923,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":279668,"user_name":"tianfeiyu","can_delete":false,"product_type":"c1","uid":1157786,"ip_address":"","ucode":"E65E6841AD5D7F","user_header":"https://static001.geekbang.org/account/avatar/00/11/aa/9a/92d2df36.jpg","comment_is_top":false,"comment_ctime":1613897066,"is_pvip":false,"replies":[{"id":"101581","content":"boltdbæ²¡æœ‰ä¸€ä¸ªå•ç‹¬çš„ç›®å½•ï¼Œå®ƒåœ¨snapç›®å½•ä¸‹ï¼Œdbæ–‡ä»¶å°±æ˜¯å®ƒå“ˆ","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1613904896,"ip_address":"","comment_id":279668,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1613897066","product_id":100069901,"comment_content":"è€å¸ˆï¼Œé—®ä¸€ä¸‹ï¼Œboltdb çš„æ•°æ®å­˜å‚¨åœ¨å“ªï¼Œåªçœ‹äº† etcd ä¿å­˜çš„æ•°æ®åœ¨ member ç›®å½•ä¸‹æœ‰ snap å’Œ wal ä¸¤ä¸ªç›®å½•ï¼Œæ²¡æœ‰çœ‹åˆ° boltdb æ•°æ®çš„å­˜å‚¨ç›®å½•","like_count":0,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":515821,"discussion_content":"boltdbæ²¡æœ‰ä¸€ä¸ªå•ç‹¬çš„ç›®å½•ï¼Œå®ƒåœ¨snapç›®å½•ä¸‹ï¼Œdbæ–‡ä»¶å°±æ˜¯å®ƒå“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613904896,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":277521,"user_name":"å·…","can_delete":false,"product_type":"c1","uid":1363244,"ip_address":"","ucode":"18239CFA501049","user_header":"https://static001.geekbang.org/account/avatar/00/14/cd/2c/a02a8372.jpg","comment_is_top":false,"comment_ctime":1612441611,"is_pvip":false,"replies":[{"id":"104095","content":"raftæ¨¡å—ä¼šæ‰¹é‡å°†å¾…æŒä¹…åŒ–æ—¥å¿—æ¡ç›®é€šçŸ¥ç»™etcdserverï¼ŒåŒæ—¶æ˜¯é¡ºåºå†™ï¼Œå› æ­¤æ€§èƒ½æ¶ˆè€—è¿˜å¥½","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1617438943,"ip_address":"","comment_id":277521,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1612441611","product_id":100069901,"comment_content":"ã€ç„¶åå†™å…¥è®°å½•å†…å®¹ï¼Œè°ƒç”¨ fsync æŒä¹…åŒ–åˆ°ç£ç›˜ã€‘ï¼Œwalæœ‰bufferå—ï¼Œä¸ç„¶æ¯ä¸ªæ—¥å¿—éƒ½è¦åŠæ•°èŠ‚ç‚¹å†™ç›˜ï¼Œè¿™ä¸ªæ¶ˆè€—æ˜¯ä¸æ˜¯å¤ªå¤§äº†","like_count":0,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":515079,"discussion_content":"raftæ¨¡å—ä¼šæ‰¹é‡å°†å¾…æŒä¹…åŒ–æ—¥å¿—æ¡ç›®é€šçŸ¥ç»™etcdserverï¼ŒåŒæ—¶æ˜¯é¡ºåºå†™ï¼Œå› æ­¤æ€§èƒ½æ¶ˆè€—è¿˜å¥½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617438943,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":277243,"user_name":"lucasun","can_delete":false,"product_type":"c1","uid":1887574,"ip_address":"","ucode":"5B900BC7C36F43","user_header":"https://static001.geekbang.org/account/avatar/00/1c/cd/56/dca89081.jpg","comment_is_top":false,"comment_ctime":1612329020,"is_pvip":false,"replies":[{"id":"100601","content":"å—¯ï¼Œboltdbæœ¬èº«æ²¡é™åˆ¶ï¼Œetcdä¸»åŠ¨é™åˆ¶çš„ï¼ŒåŸå› åˆ†æå®è·µç¯‡ä¼šä»‹ç»ï¼Œç¨ç­‰å“ˆ","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1612342422,"ip_address":"","comment_id":277243,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1612329020","product_id":100069901,"comment_content":"è¯·é—®é™åˆ¶ETCD DB max sizeçš„ç“¶é¢ˆåœ¨å“ªï¼Œæˆ‘çœ‹B+æ ‘ db sizeå¯ä»¥æ”¯æŒåˆ°å¾ˆå¤§ï¼Œboltdbåº”è¯¥æ²¡æœ‰è¿™ä¸ªé™åˆ¶","like_count":1,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514973,"discussion_content":"å—¯ï¼Œboltdbæœ¬èº«æ²¡é™åˆ¶ï¼Œetcdä¸»åŠ¨é™åˆ¶çš„ï¼ŒåŸå› åˆ†æå®è·µç¯‡ä¼šä»‹ç»ï¼Œç¨ç­‰å“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612342422,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":276930,"user_name":"å¤§è¿œ","can_delete":false,"product_type":"c1","uid":1365409,"ip_address":"","ucode":"A2421ACDD78490","user_header":"https://static001.geekbang.org/account/avatar/00/14/d5/a1/9800de2f.jpg","comment_is_top":false,"comment_ctime":1612181642,"is_pvip":false,"replies":[{"id":"104096","content":"åœ¨æ–‡ä¸­æ˜¯æŒ‡ä¸€ä¸ªå·²æäº¤çš„raftæ—¥å¿—æ¡ç›®å‘½ä»¤ï¼Œæ‰§è¡Œå¤šæ¬¡ä¸æ‰§è¡Œä¸€æ¬¡æ•ˆæœä¸€æ ·ã€‚åœ¨å„ä¸ªä¸šåŠ¡åœºæ™¯åœ¨ä¸­ï¼Œä¸€èˆ¬å®ƒæ˜¯æŒ‡ä¸€ä¸ªæ¥å£æ˜¯å¦å¯ä»¥é‡å¤å¤šæ¬¡è°ƒç”¨ï¼Œå¤šæ¬¡è°ƒç”¨æ•ˆæœä¸ä¸€æ¬¡è°ƒç”¨ä¸€è‡´ï¼Œæ¥å£å¦‚å®ç°äº†å¹‚ç­‰æ€§ï¼Œå¯ä»¥ç®€åŒ–clientå¤æ‚åº¦ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1617439550,"ip_address":"","comment_id":276930,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1612181642","product_id":100069901,"comment_content":"å¹‚ç­‰æ€§æ˜¯å•¥","like_count":1,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514872,"discussion_content":"åœ¨æ–‡ä¸­æ˜¯æŒ‡ä¸€ä¸ªå·²æäº¤çš„raftæ—¥å¿—æ¡ç›®å‘½ä»¤ï¼Œæ‰§è¡Œå¤šæ¬¡ä¸æ‰§è¡Œä¸€æ¬¡æ•ˆæœä¸€æ ·ã€‚åœ¨å„ä¸ªä¸šåŠ¡åœºæ™¯åœ¨ä¸­ï¼Œä¸€èˆ¬å®ƒæ˜¯æŒ‡ä¸€ä¸ªæ¥å£æ˜¯å¦å¯ä»¥é‡å¤å¤šæ¬¡è°ƒç”¨ï¼Œå¤šæ¬¡è°ƒç”¨æ•ˆæœä¸ä¸€æ¬¡è°ƒç”¨ä¸€è‡´ï¼Œæ¥å£å¦‚å®ç°äº†å¹‚ç­‰æ€§ï¼Œå¯ä»¥ç®€åŒ–clientå¤æ‚åº¦ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617439550,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1480362,"avatar":"https://static001.geekbang.org/account/avatar/00/16/96/aa/dd1fe788.jpg","nickname":"å¼ å¼ å¼ å¼ å…ˆæ£®å•Š","note":"","ucode":"3388250093FEFA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":359105,"discussion_content":"æ¯”å¦‚é¡µé¢è¡¨å•æäº¤é‡å¤ç‚¹äº†ä¸¤æ¬¡ï¼Œé‚£ä¹ˆåå°ä¸å¯èƒ½å»æ‰§è¡Œä¸¤æ¬¡ï¼Œå¹‚ç­‰æ€§å°±æ˜¯ä¿è¯åœ¨é‡å¤æäº¤æ—¶åªä¼šæœ‰ä¸€æ¬¡æäº¤å†…å®¹æ­£å¸¸æ‰§è¡Œ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1616117087,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1083454,"avatar":"https://static001.geekbang.org/account/avatar/00/10/88/3e/5a91d9f3.jpg","nickname":"ä¸œé£","note":"","ucode":"EB0214A64B28E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348600,"discussion_content":"ä¸æ‡‚googleä¸€ä¸‹å•Šï¼ŒåŸºç¡€çŸ¥è¯†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612663903,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":276044,"user_name":"ä¸€æ­¥","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1611757032,"is_pvip":true,"replies":[{"id":"100281","content":"å—¯ï¼Œå‹ç¼©ä¼šåˆ é™¤æ—§ç‰ˆæœ¬ï¼Œ07 mvccä¼šè¯¦ç»†ä»‹ç»","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1611845473,"ip_address":"","comment_id":276044,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1611757032","product_id":100069901,"comment_content":"boltdb ä¼šä¿å­˜ key çš„æ‰€æœ‰ä¿®æ”¹ç‰ˆæœ¬ä¿¡æ¯å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514578,"discussion_content":"å—¯ï¼Œå‹ç¼©ä¼šåˆ é™¤æ—§ç‰ˆæœ¬ï¼Œ07 mvccä¼šè¯¦ç»†ä»‹ç»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611845473,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}