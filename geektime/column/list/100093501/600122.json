{"id":600122,"title":"39 | é©¯æœæ³›å‹ï¼šäº†è§£ç±»å‹å‚æ•°","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯Tony Baiã€‚</p><p>åœ¨ä¸“æ çš„<a href=\"https://time.geekbang.org/column/article/486536\">ç»“æŸè¯­</a>ä¸­ï¼Œæˆ‘æ›¾æ‰¿è¯ºè¦è¡¥å……â€œæ³›å‹ç¯‡â€ï¼Œå¸®åŠ©ä½ å…¥é—¨Goæ³›å‹è¯­æ³•ã€‚åœ¨ç»å†äº†2022å¹´3æœˆGo 1.18ç‰ˆæœ¬çš„æ³›å‹è½åœ°ä»¥åŠ8æœˆä»½Go 1.19å¯¹æ³›å‹é—®é¢˜çš„ä¸€è½®ä¿®å¤åï¼Œæˆ‘è®¤ä¸º<strong>æ˜¯æ—¶å€™å¼€è®²Goæ³›å‹ç¯‡äº†</strong>ã€‚</p><p>è™½è¯´ç›®å‰çš„Goæ³›å‹å®ç°å’Œæœ€åä¸€ç‰ˆçš„<a href=\"https://github.com/golang/proposal/blob/master/design/43651-type-parameters.md\">æ³›å‹è®¾è®¡æ–¹æ¡ˆ</a>ç›¸æ¯”è¿˜æœ‰å·®è·ï¼Œ<a href=\"https://tonybai.com/2022/04/20/some-changes-in-go-1-18\">ä¾æ—§ä¸æ˜¯å®Œå…¨ç‰ˆ</a>ï¼Œè¿˜æœ‰ä¸€äº›ç‰¹æ€§æ²¡æœ‰åŠ å…¥ï¼Œ<a href=\"https://go101.org/generics/888-the-status-quo-of-go-custom-generics.html\">è¿˜æœ‰é—®é¢˜äºŸå¾…è§£å†³</a>ï¼Œä½†å¯¹äºå…¥é—¨Goæ³›å‹è¯­æ³•æ¥è¯´ï¼Œæˆ‘è®¤ä¸ºå·²ç»æ˜¯è¶³å¤Ÿäº†ã€‚</p><p>ä¸è¿‡åœ¨æ­£å¼å¼€è®²ä¹‹å‰ï¼Œæˆ‘è¿˜æœ‰ä¸€äº›å‹æƒ…æç¤ºï¼šå’Œæ”¯æŒæ³›å‹çš„ä¸»æµç¼–ç¨‹è¯­è¨€ä¹‹é—´çš„æ³›å‹è®¾è®¡ä¸å®ç°å­˜åœ¨å·®å¼‚ä¸€æ ·ï¼ŒGoçš„æ³›å‹ä¸å…¶ä»–ä¸»æµç¼–ç¨‹è¯­è¨€çš„æ³›å‹ä¹Ÿæ˜¯ä¸åŒçš„ã€‚æˆ‘å¸Œæœ›ä½ åœ¨å­¦ä¹ ä¹‹å‰ï¼Œå…ˆçœ‹ä¸€ä¸‹Goæ³›å‹è®¾è®¡æ–¹æ¡ˆå·²ç»æ˜ç¡®<a href=\"https://github.com/golang/proposal/blob/master/design/43651-type-parameters.md#omissions\">ä¸æ”¯æŒçš„è‹¥å¹²ç‰¹æ€§</a>ï¼Œæ¯”å¦‚ï¼š</p><ul>\n<li><strong>ä¸æ”¯æŒæ³›å‹ç‰¹åŒ–ï¼ˆspecializationï¼‰</strong>ï¼Œå³ä¸æ”¯æŒç¼–å†™ä¸€ä¸ªæ³›å‹å‡½æ•°é’ˆå¯¹æŸä¸ªå…·ä½“ç±»å‹çš„ç‰¹æ®Šç‰ˆæœ¬ï¼›</li>\n<li><strong>ä¸æ”¯æŒå…ƒç¼–ç¨‹ï¼ˆmetaprogrammingï¼‰</strong>ï¼Œå³ä¸æ”¯æŒç¼–å†™åœ¨ç¼–è¯‘æ—¶æ‰§è¡Œçš„ä»£ç æ¥ç”Ÿæˆåœ¨è¿è¡Œæ—¶æ‰§è¡Œçš„ä»£ç ï¼›</li>\n<li><strong>ä¸æ”¯æŒæ“ä½œç¬¦æ–¹æ³•ï¼ˆoperator methodï¼‰</strong>ï¼Œå³åªèƒ½ç”¨æ™®é€šçš„æ–¹æ³•ï¼ˆmethodï¼‰æ“ä½œç±»å‹å®ä¾‹ï¼ˆæ¯”å¦‚ï¼šgetIndex(k)ï¼‰ï¼Œè€Œä¸èƒ½å°†æ“ä½œç¬¦è§†ä¸ºæ–¹æ³•å¹¶è‡ªå®šä¹‰å…¶å®ç°ï¼Œæ¯”å¦‚ä¸€ä¸ªå®¹å™¨ç±»å‹çš„ä¸‹æ ‡è®¿é—®c[k]ï¼›</li>\n<li><strong>ä¸æ”¯æŒå˜é•¿çš„ç±»å‹å‚æ•°ï¼ˆtype parametersï¼‰</strong>ï¼›</li>\n<li>â€¦ â€¦</li>\n</ul><!-- [[[read_end]]] --><p>è¿™äº›ç‰¹æ€§å¦‚ä»Šä¸æ”¯æŒï¼Œåç»­å¤§æ¦‚ç‡ä¹Ÿä¸ä¼šæ”¯æŒã€‚æ‰€ä»¥å°ä¼™ä¼´ä»¬ï¼Œå°¤å…¶æ˜¯æ¥è‡ªJavaã€C++ç­‰è¯­è¨€é˜µè¥çš„å°ä¼™ä¼´ï¼Œåœ¨è¿›å…¥Goæ³›å‹è¯­æ³•å­¦ä¹ ä¹‹å‰ï¼Œä½ ä¸€å®šè¦å…ˆäº†è§£Goå›¢é˜Ÿçš„è¿™äº›è®¾è®¡å†³ç­–ã€‚</p><p>æ³›å‹ç¯‡çš„å†…å®¹å…±æœ‰ä¸‰è®²ï¼Œæˆ‘ä»¬å°†ä»æ³›å‹çš„åŸºæœ¬è¯­æ³•ï¼Œä¹Ÿå°±æ˜¯<strong>ç±»å‹å‚æ•°</strong>ï¼ˆtype parameterï¼‰å¼€å¯é©¯æœæ³›å‹ä¹‹æ—…ï¼Œæ¥ä¸‹æ¥å†æå®šæ³›å‹çš„éš¾ç‚¹<strong>å®šä¹‰çº¦æŸ</strong>ï¼ˆconstraintsï¼‰ï¼Œæœ€åæˆ‘ä»¬å†æ¥è°ˆè°ˆGoæ³›å‹çš„ä½¿ç”¨æ—¶æœºã€‚å¦‚æœä½ è¿˜æƒ³Goæ³›å‹çš„æ¼”åŒ–ç®€å²ï¼Œè¯·ç§»æ­¥<a href=\"https://time.geekbang.org/column/article/485140\">ã€ŠåŠ é¤ï½œèŠèŠæœ€è¿‘å¤§çƒ­çš„Goæ³›å‹ã€‹</a>ï¼Œè¿™é‡Œæˆ‘ä¹Ÿåšäº†è¯¦ç»†åˆ†æã€‚</p><p>é‚£ä¹ˆï¼Œä»Šå¤©è¿™æ³›å‹ç¯‡çš„ç¬¬ä¸€è®²ï¼Œæˆ‘ä»¬å°±æ¥èšç„¦Goæ³›å‹çš„åŸºæœ¬è¯­æ³•ï¼Œ<strong>ç±»å‹å‚æ•°</strong>ã€‚ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæœ€å¸¸è§çš„æ³›å‹åº”ç”¨åœºæ™¯æ¥å¼€å¯ä»Šå¤©çš„å­¦ä¹ ä¹‹æ—…ã€‚ä¸€ä¸ªå°æé†’éœ€è¦ä½ æ³¨æ„ï¼Œ<strong>æ³›å‹ç¯‡è¿™ä¸‰è®²çš„æ‰€æœ‰ç¤ºä¾‹ä»£ç å‡åŸºäºGo 1.19.1ç‰ˆæœ¬ã€‚</strong></p><h2>ä¾‹å­ï¼šè¿”å›åˆ‡ç‰‡ä¸­å€¼æœ€å¤§çš„å…ƒç´ </h2><p>æ­£å¦‚å°æ ‡é¢˜å†™çš„é‚£æ ·ï¼Œæˆ‘ä»¬è¿™ä¸ªä¾‹å­è¦å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—ä¸€ä¸ªåˆ‡ç‰‡ä½œä¸ºè¾“å…¥å‚æ•°ï¼Œç„¶åè¿”å›è¯¥åˆ‡ç‰‡ä¸­å€¼æœ€å¤§çš„é‚£ä¸ªå…ƒç´ ã€‚é¢˜ç›®å¹¶æ²¡æœ‰æ˜ç¡®ä½¿ç”¨ä»€ä¹ˆå…ƒç´ ç±»å‹çš„åˆ‡ç‰‡ï¼Œæˆ‘ä»¬å°±å…ˆä»¥æœ€å¸¸è§çš„æ•´å‹åˆ‡ç‰‡ä¸ºä¾‹ï¼Œå®ç°ä¸€ä¸ªmaxIntå‡½æ•°ï¼š</p><pre><code class=\"language-plain\">// max_int.go\nfunc maxInt(sl []int) int { \n    if len(sl) == 0 { \n        panic(\"slice is empty\")\n    } \n\n    max := sl[0]\n    for _, v := range sl[1:] { \n        if v &gt; max { \n            max = v \n        } \n    } \n    return max\n}\n\nfunc main() {\n    fmt.Println(maxInt([]int{1, 2, -4, -6, 7, 0})) // è¾“å‡ºï¼š7\n}\n</code></pre><p>maxIntçš„é€»è¾‘ååˆ†ç®€å•ã€‚æˆ‘ä»¬ä½¿ç”¨ç¬¬ä¸€ä¸ªå…ƒç´ å€¼(max := sl[0])ä½œä¸ºmaxå˜é‡åˆå€¼ï¼Œç„¶åä¸åˆ‡ç‰‡åé¢çš„å…ƒç´ (sl[1:])è¿›è¡Œé€ä¸€æ¯”è¾ƒï¼Œå¦‚æœåé¢çš„å…ƒç´ å¤§äºmaxï¼Œåˆ™å°†å…¶å€¼èµ‹ç»™maxï¼Œè¿™æ ·åˆ°åˆ‡ç‰‡éå†ç»“æŸï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†è¿™ä¸ªåˆ‡ç‰‡ä¸­å€¼æœ€å¤§çš„é‚£ä¸ªå…ƒç´ ï¼ˆå³å˜é‡maxï¼‰ã€‚</p><p>æˆ‘ä»¬ç°åœ¨ç»™å®ƒåŠ ä¸€ä¸ªæ–°éœ€æ±‚ï¼šèƒ½å¦é’ˆå¯¹å…ƒç´ ä¸ºstringç±»å‹çš„åˆ‡ç‰‡è¿”å›å…¶æœ€å¤§ï¼ˆæŒ‰å­—å…¸åºï¼‰çš„å…ƒç´ å€¼å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆè‚¯å®šæ˜¯èƒ½ï¼æˆ‘ä»¬æ¥å®ç°è¿™ä¸ªmaxStringå‡½æ•°ï¼š</p><pre><code class=\"language-plain\">// max_string.go\nfunc maxString(sl []string) string {\n    if len(sl) == 0 {\n        panic(\"slice is empty\")\n    }\n\n    max := sl[0]\n    for _, v := range sl[1:] {\n        if v &gt; max {\n            max = v\n        }\n    }\n    return max\n}\n\nfunc main() {\n    fmt.Println(maxString([]string{\"11\", \"22\", \"44\", \"66\", \"77\", \"10\"})) // è¾“å‡ºï¼š77\n}\n</code></pre><p>maxStringå®ç°äº†è¿”å›stringåˆ‡ç‰‡ä¸­å€¼æœ€å¤§å…ƒç´ çš„éœ€æ±‚ã€‚ä¸è¿‡ä»å®ç°ä¸Šæ¥çœ‹ï¼ŒmaxStringä¸maxIntå¼‚æ›²åŒå·¥ï¼Œåªæ˜¯åˆ‡ç‰‡å…ƒç´ ç±»å‹ä¸åŒç½¢äº†ã€‚è¿™æ—¶å¦‚æœè®©ä½ å‚è€ƒä¸Šè¿°maxIntæˆ–maxStringå®ç°ä¸€ä¸ªè¿”å›æµ®ç‚¹ç±»å‹åˆ‡ç‰‡ä¸­æœ€å¤§å€¼çš„å‡½æ•°maxFloatï¼Œä½ è‚¯å®šâ€œç§’ç§’é’Ÿâ€å°±å¯ä»¥ç»™å‡ºä¸€ä¸ªæ­£ç¡®çš„å®ç°ï¼š</p><pre><code class=\"language-plain\">// max_float.go\nfunc maxFloat(sl []float64) float64 {\n    if len(sl) == 0 {\n        panic(\"slice is empty\")\n    }\n\n    max := sl[0]\n    for _, v := range sl[1:] {\n        if v &gt; max {\n            max = v\n        }\n    }\n    return max\n}\n\nfunc main() {\n    fmt.Println(maxFloat([]float64{1.01, 2.02, 3.03, 5.05, 7.07, 0.01})) // è¾“å‡ºï¼š7.07\n}\n</code></pre><p>é—®é¢˜æ¥äº†ï¼æœ‰ä»£ç æ´ç™–çš„åŒå­¦è‚¯å®šå·²ç»å—…åˆ°äº†ä¸Šé¢ä¸‰ä¸ªå‡½æ•°æ•£å‘çš„â€œç³Ÿç³•å‘³é“â€ï¼š<strong>ä»£ç é‡å¤</strong>ã€‚ä¸Šé¢ä¸‰ä¸ªå‡½æ•°é™¤äº†åˆ‡ç‰‡çš„å…ƒç´ ç±»å‹ä¸åŒï¼Œå…¶ä»–é€»è¾‘éƒ½ä¸€æ ·ã€‚</p><p>é‚£ä¹ˆèƒ½å¦å®ç°ä¸€ä¸ªâ€œé€šç”¨â€çš„å‡½æ•°ï¼Œå¯ä»¥å¤„ç†ä¸Šé¢ä¸‰ç§å…ƒç´ ç±»å‹çš„åˆ‡ç‰‡å‘¢ï¼Ÿæåˆ°â€œé€šç”¨â€ï¼Œä½ ä¸€å®šæƒ³åˆ°äº†Goè¯­è¨€æä¾›çš„anyï¼ˆinterface{}çš„åˆ«åï¼‰ï¼Œæˆ‘ä»¬æ¥è¯•è¯•ï¼š</p><pre><code class=\"language-plain\">// max_any.go\nfunc maxAny(sl []any) any {\n    if len(sl) == 0 {\n        panic(\"slice is empty\")\n    }\n\n    max := sl[0]\n    for _, v := range sl[1:] {\n        switch v.(type) {\n        case int:\n            if v.(int) &gt; max.(int) {\n                max = v\n            }\n        case string:\n            if v.(string) &gt; max.(string) {\n                max = v\n            }\n        case float64:\n            if v.(float64) &gt; max.(float64) {\n                max = v\n            }\n        }\n    }\n    return max\n}\n\nfunc main() {\n    i := maxAny([]any{1, 2, -4, -6, 7, 0})\n    m := i.(int)\n    fmt.Println(m) // è¾“å‡ºï¼š7\n    fmt.Println(maxAny([]any{\"11\", \"22\", \"44\", \"66\", \"77\", \"10\"})) // è¾“å‡ºï¼š77\n    fmt.Println(maxAny([]any{1.01, 2.02, 3.03, 5.05, 7.07, 0.01})) // è¾“å‡ºï¼š7.07\n}\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼ŒmaxAnyåˆ©ç”¨anyã€type switchå’Œç±»å‹æ–­è¨€ï¼ˆtype assertionï¼‰å®ç°äº†æˆ‘ä»¬é¢„æœŸçš„ç›®æ ‡ã€‚ä¸è¿‡è¿™ä¸ªå®ç°å¹¶ä¸ç†æƒ³ï¼Œå®ƒè‡³å°‘æœ‰å¦‚ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p><ul>\n<li>è‹¥è¦æ”¯æŒå…¶ä»–å…ƒç´ ç±»å‹çš„åˆ‡ç‰‡ï¼Œæˆ‘ä»¬éœ€å¯¹è¯¥å‡½æ•°è¿›è¡Œä¿®æ”¹ï¼›</li>\n<li>maxAnyçš„è¿”å›å€¼ç±»å‹ä¸ºanyï¼ˆinterface{}ï¼‰ï¼Œè¦å¾—åˆ°å…¶å®é™…ç±»å‹çš„å€¼è¿˜éœ€è¦é€šè¿‡ç±»å‹æ–­è¨€è½¬æ¢ï¼›</li>\n<li>ä½¿ç”¨anyï¼ˆinterface{}ï¼‰ä½œä¸ºè¾“å…¥å‚æ•°çš„å…ƒç´ ç±»å‹å’Œè¿”å›å€¼çš„ç±»å‹ï¼Œç”±äºå­˜åœ¨è£…ç®±å’Œæ‹†ç®±æ“ä½œï¼Œå…¶æ€§èƒ½ä¸maxIntç­‰æ¯”èµ·æ¥è¦é€Šè‰²ä¸å°‘ï¼Œå®æµ‹æ•°æ®å¦‚ä¸‹ï¼š</li>\n</ul><pre><code class=\"language-plain\">// max_test.go\nfunc BenchmarkMaxInt(b *testing.B) {\n    sl := []int{1, 2, 3, 4, 7, 8, 9, 0}\n    for i := 0; i &lt; b.N; i++ {\n        maxInt(sl)\n    }\n}\n\nfunc BenchmarkMaxAny(b *testing.B) {\n    sl := []any{1, 2, 3, 4, 7, 8, 9, 0}\n    for i := 0; i &lt; b.N; i++ {\n        maxAny(sl)\n    }\n}\n\n$go test -v -bench . ./max_test.go max_any.go max_int.go\ngoos: darwin\ngoarch: amd64\n... ...\nBenchmarkMaxInt\nBenchmarkMaxInt-8   \t398996863\t         2.982 ns/op\nBenchmarkMaxAny\nBenchmarkMaxAny-8   \t85883875\t        13.91 ns/op\nPASS\nok  \tcommand-line-arguments\t2.710s\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼ŒåŸºäºany(interface{})å®ç°çš„maxAnyå…¶æ‰§è¡Œæ€§èƒ½è¦æ¯”åƒmaxIntè¿™æ ·çš„å‡½æ•°æ…¢ä¸Šæ•°å€ã€‚</p><p>åœ¨Go 1.18ç‰ˆæœ¬ä¹‹å‰ï¼ŒGoçš„ç¡®æ²¡æœ‰æ¯”è¾ƒç†æƒ³çš„è§£å†³ç±»ä¼¼ä¸Šè¿°â€œé€šç”¨â€é—®é¢˜çš„æ‰‹æ®µï¼Œç›´åˆ°Go 1.18ç‰ˆæœ¬æ³›å‹è½åœ°åï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ³›å‹è¯­æ³•å®ç°maxGenericså‡½æ•°ï¼š</p><pre><code class=\"language-plain\">// max_generics.go\ntype ordered interface {\n    ~int | ~int8 | ~int16 | ~int32 | ~int64 |\n        ~uint | ~uint8 | ~uint16 | ~uint32 | ~uint64 | ~uintptr |\n        ~float32 | ~float64 |\n        ~string\n}\n\nfunc maxGenerics[T ordered](sl []T) T {\n    if len(sl) == 0 {\n        panic(\"slice is empty\")\n    }\n\n    max := sl[0]\n    for _, v := range sl[1:] {\n        if v &gt; max {\n            max = v\n        }\n    }\n    return max\n}\n\ntype myString string\n\nfunc main() {\n    var m int = maxGenerics([]int{1, 2, -4, -6, 7, 0})\n    fmt.Println(m) // è¾“å‡ºï¼š7\n    fmt.Println(maxGenerics([]string{\"11\", \"22\", \"44\", \"66\", \"77\", \"10\"})) // è¾“å‡ºï¼š77\n    fmt.Println(maxGenerics([]float64{1.01, 2.02, 3.03, 5.05, 7.07, 0.01})) // è¾“å‡ºï¼š7.07\n    fmt.Println(maxGenerics([]int8{1, 2, -4, -6, 7, 0})) // è¾“å‡ºï¼š7\n    fmt.Println(maxGenerics([]myString{\"11\", \"22\", \"44\", \"66\", \"77\", \"10\"})) // è¾“å‡ºï¼š77\n}\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œä»åŠŸèƒ½è§’åº¦çœ‹ï¼Œæ³›å‹ç‰ˆæœ¬çš„maxGenericså®ç°äº†é¢„æœŸçš„ç‰¹æ€§ï¼Œå¯¹äºorderedæ¥å£ä¸­å£°æ˜çš„é‚£äº›åŸç”Ÿç±»å‹ä»¥åŠä»¥è¿™äº›åŸç”Ÿç±»å‹ä¸ºåº•å±‚ç±»å‹ï¼ˆunderlying typeï¼‰çš„ç±»å‹ï¼ˆæ¯”å¦‚ç¤ºä¾‹ä¸­çš„myStringï¼‰ï¼ŒmaxGenericséƒ½å¯ä»¥æ— ç¼æ”¯æŒã€‚å¹¶ä¸”ï¼ŒmaxGenericsè¿”å›çš„ç±»å‹ä¸ä¼ å…¥çš„åˆ‡ç‰‡çš„å…ƒç´ ç±»å‹ä¸€è‡´ï¼Œè°ƒç”¨è€…ä¹Ÿæ— éœ€é€šè¿‡ç±»å‹æ–­è¨€åšè½¬æ¢ã€‚</p><p>æ­¤å¤–ï¼Œé€šè¿‡ä¸‹é¢çš„æ€§èƒ½åŸºå‡†æµ‹è¯•æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œä¸maxAnyç›¸æ¯”ï¼Œæ³›å‹ç‰ˆæœ¬çš„maxGenericsæ€§èƒ½è¦å¥½å¾ˆå¤šï¼Œä½†ä¸åŸç”Ÿç‰ˆå‡½æ•°å¦‚maxIntç­‰è¿˜æœ‰å·®è·ã€‚å…³äºæ³›å‹çš„è¿è¡Œæ—¶æ€§èƒ½æŸè€—é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨æ³›å‹ç¯‡ç¬¬ä¸‰è®²ä¸­ä¼šæœ‰è¯´æ˜ã€‚æ€§èƒ½æµ‹è¯•å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">$go test -v -bench . ./max_test.go max_any.go max_int.go max_generics.go\ngoos: darwin\ngoarch: amd64\nBenchmarkMaxInt\nBenchmarkMaxInt-8        \t400910706\t         2.983 ns/op\nBenchmarkMaxAny\nBenchmarkMaxAny-8        \t85257433\t        14.04 ns/op\nBenchmarkMaxGenerics\nBenchmarkMaxGenerics-8   \t209468593\t         5.701 ns/op\nPASS\nok  \tcommand-line-arguments\t4.492s\n</code></pre><p>é€šè¿‡è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°Goæ³›å‹ååˆ†<strong>é€‚åˆå®ç°ä¸€äº›æ“ä½œå®¹å™¨ç±»å‹ï¼ˆæ¯”å¦‚åˆ‡ç‰‡ã€mapç­‰ï¼‰çš„ç®—æ³•</strong>ï¼Œè¿™ä¹Ÿæ˜¯<a href=\"https://go.dev/blog/when-generics\">Goå®˜æ–¹æ¨èçš„ç¬¬ä¸€ç§æ³›å‹åº”ç”¨åœºæ™¯</a>ï¼Œæ­¤ç±»å®¹å™¨ç®—æ³•çš„æ³›å‹å®ç°ä½¿å¾—å®¹å™¨ç®—æ³•ä¸å®¹å™¨å†…å…ƒç´ ç±»å‹å½»åº•è§£è€¦ï¼</p><p>ä¸è¿‡çœ‹åˆ°è¿™é‡Œï¼Œå¾ˆå¤šåŒå­¦å¯èƒ½ä¼šæŠ±æ€¨ï¼šçœ‹ä¸æ‡‚maxGenericsçš„è¯­æ³•ï¼åˆ«æ€¥ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥åŸºäºè¿™ä¸ªä¾‹å­è¿›è¡Œæ³›å‹åŸºæœ¬è¯­æ³•çš„å­¦ä¹ ã€‚</p><h2>ç±»å‹å‚æ•°ï¼ˆtype parametersï¼‰</h2><p>æ ¹æ®å®˜æ–¹è¯´æ³•ï¼Œç”±äºæ³›å‹ï¼ˆgenericï¼‰ä¸€è¯åœ¨Goç¤¾åŒºä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼Œæ‰€ä»¥å®˜æ–¹ä¹Ÿå°±æ¥çº³äº†è¿™ä¸€è¯´æ³•ã€‚<strong>ä½†Goæ³›å‹æ–¹æ¡ˆçš„å®è´¨æ˜¯å¯¹ç±»å‹å‚æ•°ï¼ˆtype parameterï¼‰çš„æ”¯æŒ</strong>ï¼ŒåŒ…æ‹¬ï¼š</p><ul>\n<li>æ³›å‹å‡½æ•°ï¼ˆgeneric functionï¼‰ï¼šå¸¦æœ‰ç±»å‹å‚æ•°çš„å‡½æ•°ï¼›</li>\n<li>æ³›å‹ç±»å‹ï¼ˆgeneric typeï¼‰ï¼šå¸¦æœ‰ç±»å‹å‚æ•°çš„è‡ªå®šä¹‰ç±»å‹ï¼›</li>\n<li>æ³›å‹æ–¹æ³•ï¼ˆgeneric methodï¼‰ï¼šæ³›å‹ç±»å‹çš„æ–¹æ³•ã€‚</li>\n</ul><p>ä¸‹é¢æˆ‘ä»¬å…ˆä»¥æ³›å‹å‡½æ•°ä¸ºä¾‹æ¥å…·ä½“è¯´æ˜ä¸€ä¸‹ä»€ä¹ˆæ˜¯ç±»å‹å‚æ•°ã€‚</p><h3>æ³›å‹å‡½æ•°</h3><p>æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ä¸Šé¢çš„ç¤ºä¾‹ï¼ŒmaxGenericså°±æ˜¯ä¸€ä¸ªæ³›å‹å‡½æ•°ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹maxGenericsçš„å‡½æ•°åŸå‹ï¼š</p><pre><code class=\"language-plain\">func maxGenerics[T ordered](sl []T) T {\n    // ... ...\n}\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼ŒmaxGenericsè¿™ä¸ªå‡½æ•°ä¸æˆ‘ä»¬ä¹‹å‰å­¦è¿‡çš„æ™®é€šGoå‡½æ•°ï¼ˆordinary functionï¼‰ç›¸æ¯”ï¼Œè‡³å°‘æœ‰ä¸¤ç‚¹ä¸åŒï¼š</p><ul>\n<li>maxGenericså‡½æ•°åœ¨å‡½æ•°åç§°ä¸å‡½æ•°å‚æ•°åˆ—è¡¨ä¹‹é—´å¤šäº†ä¸€æ®µç”±æ–¹æ‹¬å·æ‹¬èµ·çš„ä»£ç ï¼š[T ordered]ï¼›</li>\n<li>maxGenericså‚æ•°åˆ—è¡¨ä¸­çš„å‚æ•°ç±»å‹ä»¥åŠè¿”å›å€¼åˆ—è¡¨ä¸­çš„è¿”å›å€¼ç±»å‹éƒ½æ˜¯Tï¼Œè€Œä¸æ˜¯æŸä¸ªå…·ä½“çš„ç±»å‹ã€‚</li>\n</ul><p>maxGenericså‡½æ•°åŸå‹ä¸­å¤šå‡ºçš„è¿™æ®µä»£ç [T ordered]å°±æ˜¯Goæ³›å‹çš„<strong>ç±»å‹å‚æ•°åˆ—è¡¨ï¼ˆtype parameters listï¼‰</strong>ï¼Œç¤ºä¾‹ä¸­è¿™ä¸ªåˆ—è¡¨ä¸­ä»…æœ‰ä¸€ä¸ª<strong>ç±»å‹å‚æ•°T</strong>ï¼Œorderedä¸ºç±»å‹å‚æ•°çš„ç±»å‹çº¦æŸï¼ˆtype constraintï¼‰ã€‚ç±»å‹çº¦æŸä¹‹äºç±»å‹å‚æ•°ï¼Œå°±å¥½æ¯”å¸¸è§„å‚æ•°åˆ—è¡¨ä¸­çš„ç±»å‹ä¹‹äºå¸¸è§„å‚æ•°ã€‚å…³äºç±»å‹çº¦æŸï¼Œæˆ‘ä»¬è¿˜ä¼šåœ¨ä¸‹ä¸€è®²ä¸­è¯¦ç»†è¯´æ˜ã€‚</p><p>Goè¯­è¨€è§„èŒƒè§„å®šï¼š<strong>å‡½æ•°çš„ç±»å‹å‚æ•°åˆ—è¡¨ä½äºå‡½æ•°åä¸å‡½æ•°å‚æ•°åˆ—è¡¨ä¹‹é—´ï¼Œç”±æ–¹æ‹¬å·æ‹¬èµ·çš„å›ºå®šä¸ªæ•°çš„ã€ç”±é€—å·åˆ†éš”çš„ç±»å‹å‚æ•°å£°æ˜ç»„æˆ</strong>ï¼Œå…¶ä¸€èˆ¬å½¢å¼å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">func genericsFunc[T1 constraint1, T2, constraint2, ..., Tn constraintN](ordinary parameters list) (return values list)\n</code></pre><p>å‡½æ•°ä¸€æ—¦æ‹¥æœ‰ç±»å‹å‚æ•°ï¼Œå°±å¯ä»¥ç”¨è¯¥å‚æ•°ä½œä¸ºå¸¸è§„å‚æ•°åˆ—è¡¨å’Œè¿”å›å€¼åˆ—è¡¨ä¸­ä¿®é¥°å‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹ã€‚æˆ‘ä»¬ç»§ç»­maxGenericsæ³›å‹å‡½æ•°ä¸ºä¾‹åˆ†æï¼Œå®ƒæ‹¥æœ‰ä¸€ä¸ªç±»å‹å‚æ•°Tï¼Œåœ¨å¸¸è§„å‚æ•°åˆ—è¡¨ä¸­ï¼ŒTè¢«ç”¨ä½œåˆ‡ç‰‡çš„å…ƒç´ ç±»å‹ï¼›åœ¨è¿”å›å€¼åˆ—è¡¨ä¸­ï¼ŒTè¢«ç”¨ä½œè¿”å›å€¼çš„ç±»å‹ã€‚</p><p>æŒ‰Goæƒ¯ä¾‹ï¼Œ<strong>ç±»å‹å‚æ•°åçš„é¦–å­—æ¯é€šå¸¸é‡‡ç”¨å¤§å†™å½¢å¼</strong>ï¼Œå¹¶ä¸”ç±»å‹å‚æ•°å¿…é¡»æ˜¯å…·åçš„ï¼Œå³ä¾¿ä½ åœ¨åç»­çš„å‡½æ•°å‚æ•°åˆ—è¡¨ã€è¿”å›å€¼åˆ—è¡¨å’Œå‡½æ•°ä½“ä¸­æ²¡æœ‰ä½¿ç”¨è¯¥ç±»å‹å‚æ•°ï¼Œä¹Ÿæ˜¯è¿™æ ·ã€‚æ¯”å¦‚ä¸‹é¢ä¾‹å­ä¸­çš„ç±»å‹å‚æ•°Tï¼š</p><pre><code class=\"language-plain\">func print[T any]() { // æ­£ç¡®\n}     \n\nfunc print[any]() {   // ç¼–è¯‘é”™è¯¯ï¼šall type parameters must be named \n}\n</code></pre><p>å’Œå¸¸è§„å‚æ•°åˆ—è¡¨ä¸­çš„å‚æ•°åå”¯ä¸€ä¸€æ ·ï¼Œåœ¨åŒä¸€ä¸ªç±»å‹å‚æ•°åˆ—è¡¨ä¸­ï¼Œç±»å‹å‚æ•°åå­—ä¹Ÿè¦å”¯ä¸€ï¼Œä¸‹é¢è¿™æ ·çš„ä»£ç å°†ä¼šå¯¼è‡´Goç¼–è¯‘å™¨æŠ¥é”™ï¼š</p><pre><code class=\"language-plain\">func print[T1 any, T1 comparable](sl []T) { //  ç¼–è¯‘é”™è¯¯ï¼šT1 redeclared in this block\n    //...\n}\n</code></pre><p>å¸¸è§„å‚æ•°åˆ—è¡¨ä¸­çš„å‚æ•°æœ‰å…¶ç‰¹å®šä½œç”¨åŸŸï¼Œå³ä»å‚æ•°å£°æ˜å¤„å¼€å§‹åˆ°å‡½æ•°ä½“ç»“æŸã€‚å’Œå¸¸è§„å‚æ•°ç±»ä¼¼ï¼Œæ³›å‹å‡½æ•°ä¸­ç±»å‹å‚æ•°ä¹Ÿæœ‰å…¶ä½œç”¨åŸŸèŒƒå›´ï¼Œè¿™ä¸ªèŒƒå›´ä»ç±»å‹å‚æ•°åˆ—è¡¨å·¦ä¾§çš„æ–¹æ‹¬å·<strong>[</strong>å¼€å§‹ï¼Œä¸€ç›´æŒç»­åˆ°å‡½æ•°ä½“ç»“æŸï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/e5/86/e5a5a95c07a260d487ee65eb1925a786.png?wh=1920x687\" alt=\"å›¾ç‰‡\"></p><p>ç±»å‹å‚æ•°çš„ä½œç”¨åŸŸä¹Ÿå†³å®šäº†ç±»å‹å‚æ•°çš„å£°æ˜é¡ºåºå¹¶ä¸é‡è¦ï¼Œä¹Ÿä¸ä¼šå½±å“æ³›å‹å‡½æ•°çš„è¡Œä¸ºï¼Œäºæ˜¯ä¸‹é¢çš„æ³›å‹å‡½æ•°å£°æ˜ä¸ä¸Šå›¾ä¸­çš„å‡½æ•°æ˜¯ç­‰ä»·çš„ï¼š</p><pre><code class=\"language-plain\">func foo[M map[E]T, T any, E comparable](m M)(E, T) {\n    //... ...\n}\n</code></pre><p>åˆ°è¿™é‡Œï¼Œæ³›å‹å‡½æ•°çš„ç»“æ„æˆ‘ä»¬å·²ç»äº†è§£å®Œäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•è°ƒç”¨æ³›å‹å‡½æ•°ã€‚</p><h4>è°ƒç”¨æ³›å‹å‡½æ•°</h4><p>åœ¨å‰é¢çš„è®²è§£ä¸­ï¼Œæˆ‘ä¸€ç›´ä½¿ç”¨â€œç±»å‹å‚æ•°â€è¿™ä¸ªåç§°ã€‚ä½†åœ¨å­¦ä¹ è°ƒç”¨æ³›å‹å‡½æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¯¹â€œç±»å‹å‚æ•°â€åšä¸€ä¸‹ç»†åˆ†ã€‚</p><p>å’Œæ™®é€šå‡½æ•°æœ‰å½¢å¼å‚æ•°ä¸å®é™…å‚æ•°ä¸€æ ·ï¼Œç±»å‹å‚æ•°ä¹Ÿæœ‰<strong>ç±»å‹å½¢å‚</strong>ï¼ˆtype parameterï¼‰å’Œ<strong>ç±»å‹å®å‚</strong>ï¼ˆtype argumentï¼‰ä¹‹åˆ†ã€‚å…¶ä¸­ç±»å‹å½¢å‚å°±æ˜¯æ³›å‹å‡½æ•°å£°æ˜ä¸­çš„ç±»å‹å‚æ•°ï¼Œä»¥å‰é¢ç¤ºä¾‹ä¸­çš„maxGenericsæ³›å‹å‡½æ•°ä¸ºä¾‹ï¼Œå¦‚ä¸‹é¢ä»£ç ï¼ŒmaxGenericsçš„ç±»å‹å½¢å‚å°±æ˜¯Tï¼Œè€Œç±»å‹å®å‚åˆ™æ˜¯åœ¨è°ƒç”¨maxGenericsæ—¶å®é™…ä¼ é€’çš„ç±»å‹intï¼š</p><pre><code class=\"language-plain\">// æ³›å‹å‡½æ•°å£°æ˜ï¼šTä¸ºç±»å‹å½¢å‚\nfunc maxGenerics[T ordered](sl []T) T\n\n// è°ƒç”¨æ³›å‹å‡½æ•°ï¼šintä¸ºç±»å‹å®å‚\nm := maxGenerics[int]([]int{1, 2, -4, -6, 7, 0})\n</code></pre><p>ä»ä¸Šé¢è¿™æ®µä»£ç æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºè°ƒç”¨æ³›å‹å‡½æ•°ä¸è°ƒç”¨æ™®é€šå‡½æ•°çš„åŒºåˆ«ã€‚<strong>åœ¨è°ƒç”¨æ³›å‹å‡½æ•°æ—¶ï¼Œé™¤äº†è¦ä¼ é€’æ™®é€šå‚æ•°åˆ—è¡¨å¯¹åº”çš„å®å‚ä¹‹å¤–ï¼Œè¿˜è¦æ˜¾å¼ä¼ é€’ç±»å‹å®å‚ï¼Œæ¯”å¦‚è¿™é‡Œçš„int</strong>ã€‚å¹¶ä¸”ï¼Œæ˜¾å¼ä¼ é€’çš„ç±»å‹å®å‚è¦æ”¾åœ¨å‡½æ•°åå’Œæ™®é€šå‚æ•°åˆ—è¡¨å‰çš„æ–¹æ‹¬å·ä¸­ã€‚</p><p>åœ¨åå¤æ£æ‘©ä¸Šé¢ä»£ç å’Œè¯´æ˜åï¼Œä½ å¯èƒ½ä¼šæå‡ºè¿™æ ·çš„ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœæ³›å‹å‡½æ•°çš„ç±»å‹å½¢å‚è¾ƒå¤šï¼Œé‚£ä¹ˆé€ä¸€æ˜¾å¼ä¼ å…¥ç±»å‹å®å‚ä¼šè®©æ³›å‹å‡½æ•°çš„è°ƒç”¨æ˜¾å¾—ååˆ†å†—é•¿ï¼Œæ¯”å¦‚ï¼š</p><pre><code class=\"language-plain\">foo[int, string, uint32, float64](1, \"hello\", 17, 3.14)\n</code></pre><p>è¿™æ ·çš„å†™æ³•å¯¹å¼€å‘è€…è€Œè¨€æ˜¾ç„¶è°ˆä¸ä¸Šååˆ†å‹å¥½ã€‚å…¶å®ä¸å…‰å¤§å®¶æƒ³åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼ŒGoå›¢é˜Ÿçš„æ³›å‹å®ç°è€…ä»¬ä¹Ÿè€ƒè™‘äº†è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ç»™å‡ºäº†è§£å†³æ–¹æ³•ï¼š<strong>å‡½æ•°ç±»å‹å®å‚çš„è‡ªåŠ¨æ¨æ–­ï¼ˆfunction argument type inferenceï¼‰</strong>ã€‚</p><p>é¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªæœºåˆ¶å°±æ˜¯é€šè¿‡åˆ¤æ–­ä¼ é€’çš„å‡½æ•°å®å‚çš„ç±»å‹æ¥æ¨æ–­å‡ºç±»å‹å®å‚çš„ç±»å‹ï¼Œä»è€Œå…è®¸å¼€å‘è€…ä¸å¿…æ˜¾å¼æä¾›ç±»å‹å®å‚ï¼Œä¸‹é¢æ˜¯ä»¥maxGenericså‡½æ•°ä¸ºä¾‹çš„ç±»å‹å®å‚æ¨æ–­è¿‡ç¨‹ç¤ºæ„å›¾ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/60/ea/60d7ee7c03d9a47bf5f15ab3442d1dea.png?wh=1387x860\" alt=\"å›¾ç‰‡\"></p><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œå½“maxGenericså‡½æ•°ä¼ å…¥çš„å®é™…å‚æ•°ä¸º[]int{â€¦} æ—¶ï¼ŒGoç¼–è¯‘å™¨ä¼šå°†å…¶ç±»å‹[]intä¸æ³›å‹å‡½æ•°å‚æ•°åˆ—è¡¨ä¸­å¯¹åº”å‚æ•°çš„ç±»å‹ï¼ˆ[]Tï¼‰ä½œæ¯”è¾ƒï¼Œå¹¶æ¨æ–­å‡ºT == intè¿™ä¸€ç»“æœã€‚å½“ç„¶è¿™ä¸ªä¾‹å­çš„æ¨æ–­è¿‡ç¨‹è¾ƒä¸ºç®€å•ï¼Œé‚£äº›æœ‰éš¾åº¦çš„ï¼Œç”šè‡³æ— æ³•è‚‰çœ¼å¯è§çš„å°±äº¤ç»™Goç¼–è¯‘å™¨å»å¤„ç†å§ï¼Œæˆ‘ä»¬æ²¡æœ‰å¿…è¦è¿‡äºæ·±å…¥ã€‚</p><p>ä¸è¿‡ï¼Œè¿™ä¸ªç±»å‹å®å‚è‡ªåŠ¨æ¨æ–­æœ‰ä¸€ä¸ªå‰æï¼Œä½ ä¸€å®šè¦è®°ç‰¢ï¼Œé‚£å°±æ˜¯å®ƒå¿…é¡»æ˜¯<strong>å‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸­ä½¿ç”¨äº†çš„ç±»å‹å½¢å‚</strong>ï¼Œå¦åˆ™å°±ä¼šåƒä¸‹é¢çš„ç¤ºä¾‹ä¸­çš„ä»£ç ï¼Œç¼–è¯‘å™¨å°†æŠ¥æ— æ³•æ¨æ–­ç±»å‹å®å‚çš„é”™è¯¯ï¼š</p><pre><code class=\"language-plain\">func foo[T comparable, E any](a int, s E) {\n}\n\nfoo(5, \"hello\") // ç¼–è¯‘å™¨é”™è¯¯ï¼šcannot infer T\n</code></pre><p>åœ¨ç¼–è¯‘å™¨æ— æ³•æ¨æ–­å‡ºç»“æœæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç»™äºˆç¼–è¯‘å™¨â€œéƒ¨åˆ†æç¤ºâ€ï¼Œæ¯”å¦‚æ—¢ç„¶ç¼–è¯‘å™¨æ— æ³•æ¨æ–­å‡ºTçš„å®å‚ç±»å‹ï¼Œé‚£æˆ‘ä»¬å°±æ˜¾å¼å‘Šè¯‰ç¼–è¯‘å™¨Tçš„å®å‚ç±»å‹ï¼Œå³åœ¨æ³›å‹å‡½æ•°è°ƒç”¨æ—¶ï¼Œåœ¨ç±»å‹å®å‚åˆ—è¡¨ä¸­æ˜¾å¼ä¼ å…¥Tçš„å®å‚ç±»å‹ï¼Œä½†Eçš„å®å‚ç±»å‹ä¾ç„¶ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ¨æ–­ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">var s = \"hello\"\nfoo[int](5, s)  //ok\nfoo[int,](5, s) //ok\n</code></pre><p>é‚£ä¹ˆï¼Œé™¤äº†å‡½æ•°å‚æ•°åˆ—è¡¨ä¸­çš„å‚æ•°ç±»å‹å¯ä»¥ä½œä¸ºç±»å‹å®å‚æ¨æ–­çš„ä¾æ®å¤–ï¼Œå‡½æ•°è¿”å›å€¼çš„ç±»å‹æ˜¯å¦ä¹Ÿå¯ä»¥å‘¢ï¼Ÿæˆ‘ä»¬çœ‹ä¸‹é¢ç¤ºä¾‹ï¼š</p><pre><code class=\"language-plain\">func foo[T any](a int) T {\n    var zero T\n    return zero\n}\n\nvar a int = foo(5) // ç¼–è¯‘å™¨é”™è¯¯ï¼šcannot infer T\nprintln(a)\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œè¿™ä¸ªå‡½æ•°ä»…åœ¨è¿”å›å€¼ä¸­ä½¿ç”¨äº†ç±»å‹å‚æ•°ï¼Œä½†ç¼–è¯‘å™¨æ²¡èƒ½æ¨æ–­å‡ºTçš„ç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ‡è®°ï¼š<strong>ä¸èƒ½é€šè¿‡è¿”å›å€¼ç±»å‹æ¥æ¨æ–­ç±»å‹å®å‚</strong>ã€‚</p><p>æœ‰äº†å‡½æ•°ç±»å‹å®å‚æ¨æ–­åï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è°ƒç”¨æ³›å‹å‡½æ•°å°±æ— é¡»æ˜¾å¼ä¼ é€’ç±»å‹å®å‚äº†ï¼Œå¼€å‘è€…ä¹Ÿå› æ­¤è·å¾—äº†ä¸æ™®é€šå‡½æ•°è°ƒç”¨å‡ ä¹ä¸€è‡´çš„ä½“éªŒã€‚</p><p>å…¶å®æ³›å‹å‡½æ•°è°ƒç”¨æ˜¯ä¸€ä¸ªä¸åŒäºæ™®é€šå‡½æ•°è°ƒç”¨çš„è¿‡ç¨‹ï¼Œä¸ºäº†æ­å¼€å…¶ä¸­çš„â€œå¥¥ç§˜â€ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æŠŠé•œå¤´æ”¾æ…¢ï¼Œçœ‹çœ‹æ³›å‹å‡½æ•°è°ƒç”¨è¿‡ç¨‹ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆã€‚</p><h4>æ³›å‹å‡½æ•°å®ä¾‹åŒ–ï¼ˆinstantiationï¼‰</h4><p>æˆ‘ä»¬è¿˜ä»¥maxGenericsä¸ºä¾‹æ¥æ¼”ç¤ºä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼š</p><pre><code class=\"language-plain\">maxGenerics([]int{1, 2, -4, -6, 7, 0})\n</code></pre><p>ä¸Šé¢ä»£ç æ˜¯å¯¹maxGenericsæ³›å‹å‡½æ•°çš„ä¸€æ¬¡è°ƒç”¨ï¼ŒGoå¯¹è¿™æ®µæ³›å‹å‡½æ•°è°ƒç”¨ä»£ç çš„å¤„ç†åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/ff/7c/ff88b4135c1da727da4fe68952742c7c.png?wh=1920x925\" alt=\"å›¾ç‰‡\"></p><p>æˆ‘ä»¬çœ‹åˆ°ï¼ŒGoé¦–å…ˆä¼šå¯¹æ³›å‹å‡½æ•°è¿›è¡Œå®ä¾‹åŒ–ï¼ˆinstantiationï¼‰ï¼Œå³æ ¹æ®è‡ªåŠ¨æ¨æ–­å‡ºçš„ç±»å‹å®å‚ç”Ÿæˆä¸€ä¸ªæ–°å‡½æ•°ï¼ˆå½“ç„¶è¿™ä¸€è¿‡ç¨‹æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µå®Œæˆçš„ï¼Œä¸ä¼šå¯¹è¿è¡Œæ—¶æ€§èƒ½äº§ç”Ÿå½±å“ï¼‰ï¼Œç„¶åæ‰ä¼šè°ƒç”¨è¿™ä¸ªæ–°å‡½æ•°å¯¹è¾“å…¥çš„å‡½æ•°å‚æ•°è¿›è¡Œå¤„ç†ã€‚</p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ä¸€ç§<strong>æ›´å½¢è±¡çš„æ–¹å¼</strong>æ¥æè¿°ä¸Šè¿°æ³›å‹å‡½æ•°çš„å®ä¾‹åŒ–è¿‡ç¨‹ã€‚å®ä¾‹åŒ–å°±<strong>å¥½æ¯”ä¸€å®¶ç”Ÿäº§â€œæ±‚æœ€å¤§å€¼â€æœºå™¨çš„å·¥å‚</strong>ï¼Œå®ƒä¼šæ ¹æ®è¦æ¯”è¾ƒå¤§å°çš„å¯¹è±¡çš„ç±»å‹å°†è¿™æ ·çš„æœºå™¨ç”Ÿäº§å‡ºæ¥ã€‚ä»¥ä¸Šé¢çš„ä¾‹å­æ¥è¯´ï¼Œæ•´ä¸ªå®ä¾‹åŒ–è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul>\n<li>å·¥å‚æ¥å•ï¼šè°ƒç”¨maxGenerics([]int{â€¦})ï¼Œå·¥å‚å¸ˆå‚…å‘ç°è¦æ¯”è¾ƒå¤§å°çš„å¯¹è±¡ç±»å‹ä¸ºintï¼›</li>\n<li>æ¨¡å…·æ£€æŸ¥ä¸åŒ¹é…ï¼šæ£€æŸ¥intç±»å‹æ˜¯å¦æ»¡è¶³æ¨¡å…·çš„çº¦æŸè¦æ±‚ï¼Œå³intæ˜¯å¦æ»¡è¶³orderedçº¦æŸï¼Œå¦‚æ»¡è¶³ï¼Œåˆ™å°†å…¶ä½œä¸ºç±»å‹å®å‚æ›¿æ¢maxGenericså‡½æ•°ä¸­çš„ç±»å‹å½¢å‚Tï¼Œç»“æœä¸º <strong>maxGenerics[int]</strong>ï¼›</li>\n<li>ç”Ÿäº§æœºå™¨ï¼šå°†æ³›å‹å‡½æ•°maxGenericså®ä¾‹åŒ–ä¸ºä¸€ä¸ª<strong>æ–°å‡½æ•°</strong>ï¼Œè¿™é‡Œå°†å…¶èµ·åä¸º<strong>maxGenericsInt</strong>ï¼Œå…¶å‡½æ•°åŸå‹ä¸º <strong>func([]int)int</strong>ã€‚æœ¬è´¨ä¸Š <strong>maxGenericsInt := maxGenerics[int]</strong>ã€‚</li>\n</ul><p>æˆ‘ä»¬å®é™…çš„ Go ä»£ç ä¹Ÿå¯ä»¥çœŸå®å¾—åˆ°è¿™å°æ–°ç”Ÿäº§å‡ºçš„â€œæœºå™¨â€ï¼Œå¦‚ä¸‹é¢ä»£ç æ‰€ç¤ºï¼š</p><pre><code class=\"language-plain\">maxGenericsInt := maxGenerics[int] // å®ä¾‹åŒ–åå¾—åˆ°çš„æ–°â€œæœºå™¨â€ï¼šmaxGenericsInt\nfmt.Printf(\"%T\\n\", maxGenericsInt) // func([]int) int\n</code></pre><p>ä¸€æ—¦é’ˆå¯¹intå¯¹è±¡çš„â€œæ±‚æœ€å¤§å€¼â€çš„æœºå™¨è¢«ç”Ÿäº§å‡ºæ¥äº†ï¼Œå®ƒå°±å¯ä»¥å¯¹ç›®æ ‡å¯¹è±¡è¿›è¡Œå¤„ç†äº†ï¼Œè¿™å’Œæ™®é€šçš„å‡½æ•°è°ƒç”¨æ²¡æœ‰åŒºåˆ«ã€‚è¿™é‡Œå°±ç›¸å½“äºè°ƒç”¨å¦‚ä¸‹ä»£ç ï¼š</p><pre><code class=\"language-plain\">maxGenericsInt([]int{1, 2, -4, -6, 7, 0}) // è¾“å‡ºï¼š7\n</code></pre><p>æ•´ä¸ªè¿‡ç¨‹åªéœ€æ£€æŸ¥ä¼ å…¥çš„å‡½æ•°å®å‚ï¼ˆ[]int{1, 2, â€¦}ï¼‰çš„ç±»å‹ä¸maxGenericsIntå‡½æ•°åŸå‹ä¸­çš„å½¢å‚ç±»å‹ï¼ˆ[]intï¼‰æ˜¯å¦åŒ¹é…å³å¯ã€‚</p><p>å¦å¤–è¦æ³¨æ„ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ç›¸åŒç±»å‹å®å‚å¯¹æ³›å‹å‡½æ•°è¿›è¡Œå¤šæ¬¡è°ƒç”¨æ—¶ï¼ŒGoä»…ä¼šåšä¸€æ¬¡å®ä¾‹åŒ–ï¼Œå¹¶å¤ç”¨å®ä¾‹åŒ–åçš„å‡½æ•°ï¼Œæ¯”å¦‚ï¼š</p><pre><code class=\"language-plain\">maxGenerics([]int{1, 2, -4, -6, 7, 0})\nmaxGenerics([]int{11, 12, 14, -36,27, 0}) // å¤ç”¨ç¬¬ä¸€æ¬¡è°ƒç”¨åç”Ÿæˆçš„åŸå‹ä¸ºfunc([]int) intçš„å‡½æ•°\n</code></pre><p>å¥½äº†ï¼Œå…³äºæ³›å‹å‡½æ•°çš„è®²è§£å°±å…ˆå‘Šä¸€æ®µè½ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥çœ‹Goå¯¹ç±»å‹å‚æ•°çš„å¦ä¸€ç±»æ”¯æŒï¼šå¸¦æœ‰ç±»å‹å‚æ•°çš„è‡ªå®šä¹‰ç±»å‹ï¼Œå³æ³›å‹ç±»å‹ã€‚</p><h3>æ³›å‹ç±»å‹</h3><p>æ‰€è°“æ³›å‹ç±»å‹ï¼Œå°±æ˜¯åœ¨ç±»å‹å£°æ˜ä¸­å¸¦æœ‰ç±»å‹å‚æ•°çš„Goç±»å‹ï¼Œæ¯”å¦‚ä¸‹é¢ä»£ç ä¸­çš„maxableSliceï¼š</p><pre><code class=\"language-plain\">// maxable_slice.go\n\ntype maxableSlice[T ordered] struct {\n    elems []T\n}\n</code></pre><p>é¡¾åæ€ä¹‰ï¼ŒmaxableSliceæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰åˆ‡ç‰‡ç±»å‹ï¼Œè¿™ä¸ªç±»å‹çš„ç‰¹ç‚¹æ˜¯æ€»å¯ä»¥è·å–å…¶å†…éƒ¨å…ƒç´ çš„æœ€å¤§å€¼ï¼Œå…¶å”¯ä¸€çš„è¦æ±‚æ˜¯å…¶å†…éƒ¨å…ƒç´ æ˜¯å¯æ’åºçš„ï¼Œå®ƒ<strong>é€šè¿‡å¸¦æœ‰orderedçº¦æŸçš„ç±»å‹å‚æ•°æ¥æ˜ç¡®è¿™ä¸€è¦æ±‚</strong>ã€‚åƒè¿™æ ·åœ¨å®šä¹‰ä¸­å¸¦æœ‰ç±»å‹å‚æ•°çš„ç±»å‹å°±è¢«ç§°ä¸ºæ³›å‹ç±»å‹ï¼ˆgeneric typeï¼‰ã€‚</p><p>ä»ä¾‹å­ä¸­çš„maxableSliceç±»å‹å£°æ˜ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ³›å‹ç±»å‹ä¸­ï¼Œç±»å‹å‚æ•°åˆ—è¡¨æ”¾åœ¨ç±»å‹åå­—åé¢çš„æ–¹æ‹¬å·ä¸­ã€‚å’Œæ³›å‹å‡½æ•°ä¸€æ ·ï¼Œæ³›å‹ç±»å‹å¯ä»¥æœ‰å¤šä¸ªç±»å‹å‚æ•°ï¼Œç±»å‹å‚æ•°åé€šå¸¸æ˜¯é¦–å­—æ¯å¤§å†™çš„ï¼Œè¿™äº›ç±»å‹å‚æ•°ä¹Ÿå¿…é¡»æ˜¯å…·åçš„ï¼Œä¸”å‘½åå”¯ä¸€ã€‚å…¶ä¸€èˆ¬å½¢å¼å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">type TypeName[T1 constraint1, T2 constraint2, ..., Tn constraintN] TypeLiteral\n</code></pre><p>å’Œæ³›å‹å‡½æ•°ä¸­ç±»å‹å‚æ•°æœ‰å…¶ä½œç”¨åŸŸä¸€æ ·ï¼Œæ³›å‹ç±»å‹ä¸­ç±»å‹å‚æ•°çš„ä½œç”¨åŸŸèŒƒå›´ä¹Ÿæ˜¯ä»ç±»å‹å‚æ•°åˆ—è¡¨å·¦ä¾§çš„æ–¹æ‹¬å·<strong>[</strong>å¼€å§‹ï¼Œä¸€ç›´æŒç»­åˆ°ç±»å‹å®šä¹‰ç»“æŸçš„ä½ç½®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/9e/87/9e0yya731f6cae9a6e1f578d63d2f787.png?wh=1298x628\" alt=\"å›¾ç‰‡\"></p><p>è¿™æ ·çš„ä½œç”¨åŸŸå°†æ–¹ä¾¿æˆ‘ä»¬åœ¨å„ä¸ªå­—æ®µä¸­çµæ´»ä½¿ç”¨ç±»å‹å‚æ•°ï¼Œä¸‹é¢æ˜¯ä¸€äº›è‡ªå®šä¹‰æ³›å‹ç±»å‹çš„ç¤ºä¾‹ï¼š</p><pre><code class=\"language-plain\">type Set[T comparable] map[T]struct{}\n\ntype sliceFn[T any] struct {\n\ts   []T\n\tcmp func(T, T) bool\n}\n\ntype Map[K, V any] struct {\n\troot    *node[K, V]\n\tcompare func(K, K) int\n}\n\ntype element[T any] struct {\n\tnext *element[T]\n\tval  T\n}\n\ntype Numeric interface {\n\t~int | ~int8 | ~int16 | ~int32 | ~int64 |\n\t\t~uint | ~uint8 | ~uint16 | ~uint32 | ~uint64 | ~uintptr |\n\t\t~float32 | ~float64 |\n\t\t~complex64 | ~complex128\n}\n\ntype NumericAbs[T Numeric] interface {\n\tAbs() T\n}\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œæ³›å‹ç±»å‹ä¸­çš„ç±»å‹å‚æ•°å¯ä»¥ç”¨æ¥ä½œä¸ºç±»å‹å£°æ˜ä¸­å­—æ®µçš„ç±»å‹ï¼ˆæ¯”å¦‚ä¸Šé¢çš„elementç±»å‹ï¼‰ã€å¤åˆç±»å‹çš„å…ƒç´ ç±»å‹ï¼ˆæ¯”å¦‚ä¸Šé¢çš„Setå’ŒMapç±»å‹ï¼‰æˆ–æ–¹æ³•çš„å‚æ•°å’Œè¿”å›å€¼ç±»å‹ï¼ˆå¦‚NumericAbsæ¥å£ç±»å‹ï¼‰ç­‰ã€‚</p><p>å¦‚æœè¦åœ¨æ³›å‹ç±»å‹å£°æ˜çš„å†…éƒ¨å¼•ç”¨è¯¥ç±»å‹åï¼Œå¿…é¡»è¦å¸¦ä¸Šç±»å‹å‚æ•°ï¼Œå¦‚ä¸Šé¢çš„elementç»“æ„ä½“ä¸­çš„nextå­—æ®µçš„ç±»å‹ï¼š*element[T]ã€‚æŒ‰ç…§æ³›å‹è®¾è®¡æ–¹æ¡ˆï¼Œå¦‚æœæ³›å‹ç±»å‹æœ‰ä¸æ­¢ä¸€ä¸ªç±»å‹å‚æ•°ï¼Œé‚£ä¹ˆåœ¨å…¶å£°æ˜å†…éƒ¨å¼•ç”¨è¯¥ç±»å‹åæ—¶ï¼Œä¸ä»…è¦å¸¦ä¸Šæ‰€æœ‰ç±»å‹å‚æ•°ï¼Œç±»å‹å‚æ•°çš„é¡ºåºä¹Ÿè¦ä¸å£°æ˜ä¸­ç±»å‹å‚æ•°åˆ—è¡¨ä¸­çš„é¡ºåºä¸€è‡´ï¼Œæ¯”å¦‚ï¼š</p><pre><code class=\"language-plain\">type P[T1, T2 any] struct {\n    F *P[T1, T2]  // ok\n}\n</code></pre><p>ä¸è¿‡ä»å®æµ‹ç»“æœæ¥çœ‹ï¼ŒGo 1.19ç‰ˆæœ¬å¯¹äºä¸‹é¢ä¸ç¬¦åˆæŠ€æœ¯æ–¹æ¡ˆçš„æ³›å‹ç±»å‹å£°æ˜ä¹Ÿå¹¶æœªæŠ¥é”™ï¼š</p><pre><code class=\"language-plain\">type P[T1, T2 any] struct {\n    F *P[T2, T1] // ä¸ç¬¦åˆæŠ€æœ¯æ–¹æ¡ˆï¼Œä½†Go 1.19ç¼–è¯‘å™¨å¹¶æœªæŠ¥é”™\n}\n</code></pre><p>äº†è§£äº†å¦‚ä½•å£°æ˜ä¸€ä¸ªæ³›å‹ç±»å‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨è¿™äº›æ³›å‹ç±»å‹ã€‚</p><h4>ä½¿ç”¨æ³›å‹ç±»å‹</h4><p>å’Œæ³›å‹å‡½æ•°ä¸€æ ·ï¼Œä½¿ç”¨æ³›å‹ç±»å‹æ—¶ä¹Ÿä¼šæœ‰ä¸€ä¸ª<strong>å®ä¾‹åŒ–</strong>ï¼ˆinstantiationï¼‰è¿‡ç¨‹ï¼Œæ¯”å¦‚ï¼š</p><pre><code class=\"language-plain\">var sl = maxableSlice[int]{\n    elems: []int{1, 2, -4, -6, 7, 0},\n} \n</code></pre><p>Goä¼šæ ¹æ®ä¼ å…¥çš„ç±»å‹å®å‚ï¼ˆintï¼‰ç”Ÿæˆä¸€ä¸ªæ–°çš„ç±»å‹å¹¶åˆ›å»ºè¯¥ç±»å‹çš„å˜é‡å®ä¾‹ï¼Œslçš„ç±»å‹ç­‰ä»·äºä¸‹é¢ä»£ç ï¼š</p><pre><code class=\"language-plain\">type maxableIntSlice struct {\n    elems []int\n}\n</code></pre><p>çœ‹åˆ°è¿™é‡Œä½ å¯èƒ½ä¼šé—®ï¼šæ³›å‹ç±»å‹æ˜¯å¦å¯ä»¥åƒæ³›å‹å‡½æ•°é‚£æ ·å®ç°ç±»å‹å®å‚çš„è‡ªåŠ¨æ¨æ–­å‘¢ï¼Ÿå¾ˆé—æ†¾ï¼Œç›®å‰çš„Go 1.19å°šä¸æ”¯æŒï¼Œä¸‹é¢ä»£ç ä¼šé­åˆ°Goç¼–è¯‘å™¨çš„æŠ¥é”™ï¼š</p><pre><code class=\"language-plain\">var sl = maxableSlice {\n    elems: []int{1, 2, -4, -6, 7, 0}, // ç¼–è¯‘å™¨é”™è¯¯ï¼šcannot use generic type maxableSlice[T ordered] without instantiation\n} \n</code></pre><p>ä¸è¿‡è¿™ä¸€ç‰¹æ€§åœ¨Goçš„æœªæ¥ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šå¾—åˆ°æ”¯æŒã€‚</p><p>æ—¢ç„¶æ¶‰åŠåˆ°äº†ç±»å‹ï¼Œä½ è‚¯å®šä¼šæƒ³åˆ°è¯¸å¦‚ç±»å‹åˆ«åã€ç±»å‹åµŒå…¥ç­‰Goè¯­è¨€æœºåˆ¶ï¼Œé‚£ä¹ˆè¿™äº›è¯­è¨€æœºåˆ¶å¯¹æ³›å‹ç±»å‹çš„æ”¯æŒæƒ…å†µåˆæ˜¯å¦‚ä½•å‘¢ï¼Ÿæˆ‘ä»¬é€ä¸€æ¥çœ‹ä¸€ä¸‹ã€‚</p><ul>\n<li><strong>æ³›å‹ç±»å‹ä¸ç±»å‹åˆ«å</strong><br>\nåœ¨ä¸“æ å‰é¢çš„è®²è§£ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ è¿‡ç±»å‹åˆ«åï¼ˆtype aliasï¼‰ã€‚æˆ‘ä»¬çŸ¥é“ç±»å‹åˆ«åä¸å…¶ç»‘å®šçš„åŸç±»å‹æ˜¯å®Œå…¨ç­‰ä»·çš„ï¼Œä½†è¿™ä»…é™äºåŸç±»å‹æ˜¯ä¸€ä¸ªç›´æ¥ç±»å‹ï¼Œå³å¯ç›´æ¥ç”¨äºå£°æ˜å˜é‡çš„ç±»å‹ã€‚é‚£ä¹ˆå°†ç±»å‹åˆ«åä¸æ³›å‹ç±»å‹ç»‘å®šæ˜¯å¦å¯è¡Œå‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼š</li>\n</ul><pre><code class=\"language-plain\">type foo[T1 any, T2 comparable] struct {\n    a T1\n    b T2\n}\n  \ntype fooAlias = foo // ç¼–è¯‘å™¨é”™è¯¯ï¼šcannot use generic type foo[T1 any, T2 comparable] without instantiation\n</code></pre><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¸ºæ³›å‹ç±»å‹fooå»ºç«‹äº†ç±»å‹åˆ«åfooAliasï¼Œä½†ç¼–è¯‘è¿™æ®µä»£ç æ—¶ï¼Œç¼–è¯‘å™¨è¿˜æ˜¯æŠ¥äº†é”™è¯¯ï¼</p><p>è¿™æ˜¯å› ä¸ºï¼Œæ³›å‹ç±»å‹åªæ˜¯ä¸€ä¸ªç”Ÿäº§çœŸå®ç±»å‹çš„â€œå·¥å‚â€ï¼Œå®ƒè‡ªèº«åœ¨æœªå®ä¾‹åŒ–ä¹‹å‰æ˜¯ä¸èƒ½ç›´æ¥ç”¨äºå£°æ˜å˜é‡çš„ï¼Œå› æ­¤ä¸ç¬¦åˆç±»å‹åˆ«åæœºåˆ¶çš„è¦æ±‚ã€‚æ³›å‹ç±»å‹åªæœ‰å®ä¾‹åŒ–åæ‰èƒ½å¾—åˆ°ä¸€ä¸ªçœŸå®ç±»å‹ï¼Œä¾‹å¦‚ä¸‹é¢çš„ä»£ç å°±æ˜¯åˆæ³•çš„ï¼š</p><pre><code class=\"language-plain\">type fooAlias = foo[int, string]\n</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åªèƒ½ä¸ºæ³›å‹ç±»å‹å®ä¾‹åŒ–åçš„ç±»å‹åˆ›å»ºç±»å‹åˆ«åï¼Œå®é™…ä¸Šä¸Šè¿°fooAliasç­‰ä»·äºå®ä¾‹åŒ–åçš„ç±»å‹fooInstantiationï¼š</p><pre><code class=\"language-plain\">type fooInstantiation struct {\n    a int   \n    b string\n}\n</code></pre><ul>\n<li><strong>æ³›å‹ç±»å‹ä¸ç±»å‹åµŒå…¥</strong><br>\nç±»å‹åµŒå…¥æ˜¯è¿ç”¨Goç»„åˆè®¾è®¡å“²å­¦çš„ä¸€ä¸ªé‡è¦æ‰‹æ®µã€‚å¼•å…¥æ³›å‹ç±»å‹ä¹‹åï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥åœ¨æ³›å‹ç±»å‹å®šä¹‰ä¸­åµŒå…¥æ™®é€šç±»å‹ï¼Œæ¯”å¦‚ä¸‹é¢ç¤ºä¾‹ä¸­Lockableç±»å‹ä¸­åµŒå…¥çš„sync.Mutexï¼š</li>\n</ul><pre><code class=\"language-plain\">type Lockable[T any] struct {\n    t T\n    sync.Mutex\n}\n\nfunc (l *Lockable[T]) Get() T {\n    l.Lock()\n    defer l.Unlock()\n    return l.t\n}\n\nfunc (l *Lockable[T]) Set(v T) {\n    l.Lock()\n    defer l.Unlock()\n    l.t = v\n}\n</code></pre><p>åœ¨æ³›å‹ç±»å‹å®šä¹‰ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å…¶ä»–æ³›å‹ç±»å‹å®ä¾‹åŒ–åçš„ç±»å‹ä½œä¸ºæˆå‘˜ã€‚ç°åœ¨æˆ‘ä»¬æ”¹å†™ä¸€ä¸‹ä¸Šé¢çš„Lockableï¼Œä¸ºå…¶åµŒå…¥å¦å¤–ä¸€ä¸ªæ³›å‹ç±»å‹å®ä¾‹åŒ–åçš„ç±»å‹Slice[int]ï¼š</p><pre><code class=\"language-plain\">type Slice[T any] []T\n  \nfunc (s Slice[T]) String() string {\n    if len(s) == 0 {\n        return \"\"\n    }\n    var result = fmt.Sprintf(\"%v\", s[0])\n    for _, v := range s[1:] {\n        result = fmt.Sprintf(\"%v, %v\", result, v)\n    }\n    return result\n}\n\ntype Lockable[T any] struct {\n    t T\n    Slice[int]\n    sync.Mutex\n}\n\nfunc main() {\n    n := Lockable[string]{\n        t:     \"hello\",\n        Slice: []int{1, 2, 3},\n    }\n    println(n.String()) // è¾“å‡ºï¼š1, 2, 3\n}\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œä»£ç ä½¿ç”¨æ³›å‹ç±»å‹åï¼ˆSliceï¼‰ä½œä¸ºåµŒå…¥åçš„å­—æ®µåï¼Œå¹¶ä¸”Slice[int]çš„æ–¹æ³•Stringè¢«æå‡ä¸ºLockableå®ä¾‹åŒ–åçš„ç±»å‹çš„æ–¹æ³•äº†ã€‚åŒç†ï¼Œåœ¨æ™®é€šç±»å‹å®šä¹‰ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å®ä¾‹åŒ–åçš„æ³›å‹ç±»å‹ä½œä¸ºæˆå‘˜ï¼Œæ¯”å¦‚è®©ä¸Šé¢çš„Slice[int]åµŒå…¥åˆ°ä¸€ä¸ªæ™®é€šç±»å‹Fooä¸­ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">type Foo struct {\n    Slice[int]\n}\n\nfunc main() {\n    f := Foo{\n        Slice: []int{1, 2, 3},\n    }\n    println(f.String()) // è¾“å‡ºï¼š1, 2, 3\n}\n</code></pre><p>æ­¤å¤–ï¼ŒGoæ³›å‹è®¾è®¡æ–¹æ¡ˆæ”¯æŒåœ¨æ³›å‹ç±»å‹å®šä¹‰ä¸­åµŒå…¥ç±»å‹å‚æ•°ä½œä¸ºæˆå‘˜ï¼Œæ¯”å¦‚ä¸‹é¢çš„æ³›å‹ç±»å‹Lockableå†…åµŒäº†ä¸€ä¸ªç±»å‹Tï¼Œä¸”Tæ°ä¸ºå…¶ç±»å‹å‚æ•°ï¼š</p><pre><code class=\"language-plain\">type Lockable[T any] struct {\n    T\n    sync.Mutex\n}\n</code></pre><p>ä¸è¿‡ï¼ŒGo 1.19ç‰ˆæœ¬ç¼–è¯‘ä¸Šè¿°ä»£ç æ—¶ä¼šé’ˆå¯¹åµŒå…¥Tçš„é‚£ä¸€è¡ŒæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</p><pre><code class=\"language-plain\">ç¼–è¯‘å™¨æŠ¥é”™ï¼šembedded field type cannot be a (pointer to a) type parameter\n</code></pre><p>å…³äºè¿™ä¸ªé”™è¯¯ï¼ŒGoå®˜æ–¹åœ¨<a href=\"https://github.com/golang/go/issues/49030\">å…¶issue</a> ä¸­ç»™å‡ºäº†ä¸´æ—¶çš„ç»“è®ºï¼šæš‚ä¸æ”¯æŒã€‚</p><h4>æ³›å‹æ–¹æ³•</h4><p>åœ¨ä¸“æ åŸºç¡€ç¯‡çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“Goç±»å‹å¯ä»¥æ‹¥æœ‰è‡ªå·±çš„æ–¹æ³•ï¼ˆmethodï¼‰ï¼Œæ³›å‹ç±»å‹ä¹Ÿä¸ä¾‹å¤–ï¼Œä¸ºæ³›å‹ç±»å‹å®šä¹‰çš„æ–¹æ³•ç§°ä¸º<strong>æ³›å‹æ–¹æ³•ï¼ˆgeneric methodï¼‰</strong>ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥è®²è®²å¦‚ä½•å®šä¹‰å’Œä½¿ç”¨æ³›å‹æ–¹æ³•ã€‚</p><p>æˆ‘ä»¬ç”¨ä¸€ä¸ªç¤ºä¾‹ï¼Œç»™maxableSliceæ³›å‹ç±»å‹å®šä¹‰maxæ–¹æ³•ï¼Œçœ‹ä¸€ä¸‹æ³›å‹æ–¹æ³•çš„ç»“æ„ï¼š</p><pre><code class=\"language-plain\">func (sl *maxableSlice[T]) max() T {\n    if len(sl.elems) == 0 {\n        panic(\"slice is empty\")\n    }\n\n    max := sl.elems[0]\n    for _, v := range sl.elems[1:] {\n        if v &gt; max {\n            max = v\n        }\n    }\n    return max\n}\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œåœ¨å®šä¹‰æ³›å‹ç±»å‹çš„æ–¹æ³•æ—¶ï¼Œæ–¹æ³•çš„receiveréƒ¨åˆ†ä¸ä»…è¦å¸¦ä¸Šç±»å‹åç§°ï¼Œè¿˜éœ€è¦å¸¦ä¸Šå®Œæ•´çš„ç±»å‹å½¢å‚åˆ—è¡¨ï¼ˆå¦‚maxableSlice[T]ï¼‰ï¼Œè¿™äº›ç±»å‹å½¢å‚åç»­å¯ä»¥ç”¨åœ¨æ–¹æ³•çš„å‚æ•°åˆ—è¡¨å’Œè¿”å›å€¼åˆ—è¡¨ä¸­ã€‚</p><p>ä¸è¿‡åœ¨Goæ³›å‹ç›®å‰çš„è®¾è®¡ä¸­ï¼Œæ³›å‹æ–¹æ³•è‡ªèº«ä¸å¯ä»¥å†æ”¯æŒç±»å‹å‚æ•°äº†ï¼Œä¸èƒ½åƒä¸‹é¢è¿™æ ·å®šä¹‰æ³›å‹æ–¹æ³•ï¼š</p><pre><code class=\"language-plain\">func (f *foo[T]) M1[E any](e E) T { // ç¼–è¯‘å™¨é”™è¯¯ï¼šsyntax error: method must have no type parameters\n    //... ...\n}\n</code></pre><p>å…³äºæ³›å‹æ–¹æ³•æœªæ¥æ˜¯å¦èƒ½æ”¯æŒç±»å‹å‚æ•°ï¼Œç›®å‰Goå›¢é˜Ÿå€¾å‘äºå¦ï¼Œä½†æœ€ç»ˆç»“æœGoå›¢é˜Ÿè¿˜è¦æ ¹æ®Goç¤¾åŒºåœ¨ä½¿ç”¨æ³›å‹è¿‡ç¨‹ä¸­çš„åé¦ˆè€Œå®šã€‚</p><p>åœ¨æ³›å‹æ–¹æ³•ä¸­ï¼Œreceiverä¸­æŸä¸ªç±»å‹å‚æ•°å¦‚æœæ²¡æœ‰åœ¨æ–¹æ³•å‚æ•°åˆ—è¡¨å’Œè¿”å›å€¼ä¸­ä½¿ç”¨ï¼Œå¯ä»¥ç”¨â€œ_â€ä»£æ›¿ï¼Œä½†ä¸èƒ½ä¸å†™ï¼Œæ¯”å¦‚ï¼š</p><pre><code class=\"language-plain\">type foo[A comparable, B any] struct{}\n\nfunc (foo[A, B]) M1() { // ok\n}\n\næˆ–\n\nfunc (foo[_, _]) M1() { // ok\n}\n\næˆ–\n\nfunc (foo[A, _]) M1() { // ok\n}\n\nä½†\n\nfunc (foo[]) M1() { // é”™è¯¯ï¼šreceiveréƒ¨åˆ†ç¼ºå°‘ç±»å‹å‚æ•°\n\n}\n</code></pre><p>å¦å¤–ï¼Œæ³›å‹æ–¹æ³•ä¸­çš„receiverä¸­ç±»å‹å‚æ•°åå­—å¯ä»¥ä¸æ³›å‹ç±»å‹ä¸­çš„ç±»å‹å½¢å‚åå­—ä¸åŒï¼Œä½ç½®å’Œæ•°é‡å¯¹ä¸Šå³å¯ã€‚æˆ‘ä»¬è¿˜ä»¥ä¸Šé¢çš„æ³›å‹ç±»å‹fooä¸ºä¾‹ï¼Œå¯ä»¥ä¸ºå®ƒæ·»åŠ ä¸‹é¢æ–¹æ³•ï¼š</p><pre><code class=\"language-plain\">type foo[A comparable, B any] struct{}\n\nfunc (foo[First, Second]) M1(a First, b Second) { // Firstå¯¹åº”ç±»å‹å‚æ•°Aï¼ŒSecondå¯¹åº”ç±»å‹å‚æ•°B\n\n}\n</code></pre><h2>å°ç»“</h2><p>å¥½äº†ï¼Œä»Šå¤©çš„è¯¾è®²åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œç°åœ¨æˆ‘ä»¬ä¸€èµ·æ¥å›é¡¾ä¸€ä¸‹å§ã€‚</p><p>åœ¨è¿™ä¸€è®²ä¸­ï¼Œæˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†Goæ³›å‹çš„åŸºæœ¬è¯­æ³•ï¼šç±»å‹å‚æ•°ã€‚<strong>ç±»å‹å‚æ•°æ˜¯Goæ³›å‹æ–¹æ¡ˆçš„å…·ä½“å®ç°</strong>ï¼Œé€šè¿‡ç±»å‹å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰æ³›å‹å‡½æ•°ã€æ³›å‹ç±»å‹ä»¥åŠå¯¹åº”çš„æ³›å‹æ–¹æ³•ã€‚</p><p>æ³›å‹å‡½æ•°æ˜¯å¸¦æœ‰ç±»å‹å‚æ•°çš„å‡½æ•°ï¼Œåœ¨å‡½æ•°åç§°ä¸å‚æ•°åˆ—è¡¨ä¹‹é—´å£°æ˜çš„ç±»å‹å‚æ•°åˆ—è¡¨ä½¿å¾—æ³›å‹å‡½æ•°çš„è¿è¡Œé€»è¾‘ä¸å‚æ•°/è¿”å›å€¼ç±»å‹è§£è€¦ã€‚è°ƒç”¨æ³›å‹å‡½æ•°ä¸æ™®é€šå‡½æ•°ç•¥æœ‰ä¸åŒï¼Œæ³›å‹å‡½æ•°éœ€è¦è¿›è¡Œå®ä¾‹åŒ–åæ‰èƒ½ç”ŸæˆçœŸæ­£æ‰§è¡Œçš„ã€å¸¦æœ‰ç±»å‹ä¿¡æ¯çš„å‡½æ•°ã€‚åŒæ—¶ï¼ŒGoæ³›å‹æ”¯æŒçš„ç±»å‹å®å‚æ¨æ–­ä¹Ÿä½¿å¾—å¼€å‘è€…åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ— éœ€æ˜¾å¼ä¼ é€’ç±»å‹å®å‚ï¼Œè·å¾—ä¸æ™®é€šå‡½æ•°è°ƒç”¨å‡ ä¹ä¸€è‡´çš„ä½“éªŒã€‚</p><p>æ³›å‹ç±»å‹æ˜¯å¸¦æœ‰ç±»å‹å‚æ•°çš„ç±»å‹ï¼Œæ³›å‹ç±»å‹çš„ç±»å‹å‚æ•°æ”¾åœ¨ç±»å‹åç§°åé¢çš„ç±»å‹å‚æ•°åˆ—è¡¨ä¸­å£°æ˜ï¼Œç±»å‹å‚æ•°åç»­å¯ä»¥åœ¨æ³›å‹ç±»å‹å£°æ˜ä¸­ç”¨ä½œæˆå‘˜å­—æ®µçš„ç±»å‹æˆ–å¤åˆç±»å‹æˆå‘˜å…ƒç´ çš„ç±»å‹ã€‚ä¸è¿‡ç›®å‰ï¼ˆGo 1.19ç‰ˆæœ¬ï¼‰Goå°šä¸æ”¯æŒæ³›å‹ç±»å‹çš„ç±»å‹å®å‚çš„è‡ªåŠ¨æ¨æ–­ï¼Œæˆ‘ä»¬åœ¨æ³›å‹ç±»å‹å®ä¾‹åŒ–æ—¶éœ€è¦æ˜¾å¼ä¼ å…¥ç±»å‹å®å‚ã€‚</p><p>ä¸æ³›å‹ç±»å‹ç»‘å®šçš„æ–¹æ³•è¢«ç§°ä¸ºæ³›å‹æ–¹æ³•ï¼Œæ³›å‹æ–¹æ³•çš„å‚æ•°åˆ—è¡¨å’Œè¿”å›å€¼åˆ—è¡¨ä¸­å¯ä»¥ä½¿ç”¨æ³›å‹ç±»å‹çš„ç±»å‹å‚æ•°ï¼Œä½†æ³›å‹æ–¹æ³•ç›®å‰å°šä¸æ”¯æŒå£°æ˜è‡ªå·±çš„ç±»å‹å‚æ•°åˆ—è¡¨ã€‚</p><p>Goæ³›å‹çš„å¼•å…¥ï¼Œä½¿å¾—Goå¼€å‘äººå‘˜åœ¨interface{}ä¹‹ååˆæ‹¥æœ‰äº†ä¸€ç§ç¼–å†™â€œé€šç”¨ä»£ç â€çš„æ‰‹æ®µï¼Œå¹¶ä¸”è¿™ç§æ–°æ‰‹æ®µå› å…¶æ›´å¤šåœ¨ç¼–è¯‘é˜¶æ®µçš„æ£€æŸ¥è€Œå˜å¾—æ›´åŠ å®‰å…¨ï¼Œä¹Ÿå› å…¶å‡å°‘äº†è¿è¡Œæ—¶çš„é¢å¤–å¼€é”€ä½¿å¾—ä»£ç æ€§èƒ½æ›´å¥½ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>ä½¿ç”¨è¿‡å…¶ä»–ç¼–ç¨‹è¯­è¨€æ³›å‹è¯­æ³•ç‰¹æ€§çš„å°ä¼™ä¼´ä»¬å¯èƒ½ä¼šé—®ï¼šä¸ºä»€ä¹ˆGoåœ¨æ–¹æ‹¬å·â€œ[]â€ä¸­å£°æ˜ç±»å‹å‚æ•°ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å…¶ä»–è¯­è¨€éƒ½ç”¨çš„å°–æ‹¬å·â€œ&lt;&gt;â€å‘¢ï¼Ÿä½ å¯ä»¥æ€è€ƒä¸€ä¸‹ã€‚</p><p>æ¬¢è¿åœ¨è¯„è®ºåŒºå†™ä¸‹ä½ çš„æƒ³æ³•ï¼Œæˆ‘ä»¬æ³›å‹ç¯‡çš„ç¬¬äºŒè®²è§ã€‚</p>","comments":[{"had_liked":false,"id":361985,"user_name":"é‚£æ—¶åˆ»","can_delete":false,"product_type":"c1","uid":1150927,"ip_address":"åŒ—äº¬","ucode":"B0D150856C3A4A","user_header":"https://static001.geekbang.org/account/avatar/00/11/8f/cf/890f82d6.jpg","comment_is_top":false,"comment_ctime":1668046049,"is_pvip":false,"replies":[{"id":131787,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1668401113,"ip_address":"åŒ—äº¬","comment_id":361985,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"goè¯­è¨€èŒƒå‹ä¸ä½¿ç”¨ &lt;&gt;ï¼Œæˆ‘æƒ³åˆ°ä¸€ä¸ªç‚¹ï¼Œæ˜¯ä¸æ˜¯è§£æçš„æ—¶å€™ å®¹æ˜“ä¸å¤§äº æˆ–è€…å°äº ç¬¦å·æ··æ·†ï¼Ÿ","like_count":3},{"had_liked":false,"id":361445,"user_name":"æ–‡æ­¦æœ¨å­","can_delete":false,"product_type":"c1","uid":1015986,"ip_address":"åŒ—äº¬","ucode":"348752BDECD65F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/80/b2/2e9f442d.jpg","comment_is_top":false,"comment_ctime":1667523837,"is_pvip":false,"replies":[{"id":131597,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1667817743,"ip_address":"åŒ—äº¬","comment_id":361445,"utype":1}],"discussion_count":1,"race_medal":1,"score":2,"product_id":100093501,"comment_content":"æ²™å‘ğŸ›‹ï¸","like_count":3,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593635,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1668401113,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1603004,"avatar":"https://static001.geekbang.org/account/avatar/00/18/75/bc/89d88775.jpg","nickname":"Calvin","note":"","ucode":"0EEF5B207623B5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593588,"discussion_content":"[] ä¸æ˜¯æ›´åƒåˆ‡ç‰‡æˆ–è€…æ•°ç»„å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1668357224,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1023930,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/9f/ba/5a9cb72f.jpg","nickname":"ä¸¹æ«æŸ“ç§‹è‰²","note":"","ucode":"4E9A35439B615F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593417,"discussion_content":"å°±æ˜¯è¿™ä¸ªåŸå› å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1668161279,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å››å·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":378578,"user_name":"å·¦è€³æœµä¸œ","can_delete":false,"product_type":"c1","uid":1160678,"ip_address":"å¹¿ä¸œ","ucode":"60134ACF12BB52","user_header":"https://static001.geekbang.org/account/avatar/00/11/b5/e6/c67f12bd.jpg","comment_is_top":false,"comment_ctime":1690444634,"is_pvip":false,"replies":[{"id":137959,"content":"ç¬¬41è®²æœ‰æ³›å‹åŸç†çš„è®²è§£ï¼Œé‚£é‡Œå¯ä»¥æ‰¾åˆ°ç­”æ¡ˆã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1690510749,"ip_address":"è¾½å®","comment_id":378578,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"æ—¢ç„¶æ³›å‹å‡½æ•°çš„å®ä¾‹åŒ–æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µåšçš„ï¼Œå®ä¾‹åŒ–ç”Ÿæˆçš„ä¹Ÿæ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œæ€ä¹ˆå‹æµ‹ç»“æœæ¯”æ™®é€šå‡½æ•°è¦æ…¢å‘¢ï¼Œä¸çŸ¥é“å“ªé‡Œå¤šå‡ºæ¥çš„æ€§èƒ½æŸè€—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":624370,"discussion_content":"ç¬¬41è®²æœ‰æ³›å‹åŸç†çš„è®²è§£ï¼Œé‚£é‡Œå¯ä»¥æ‰¾åˆ°ç­”æ¡ˆã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1690510749,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":384495,"user_name":"éº¦å­","can_delete":false,"product_type":"c1","uid":1296833,"ip_address":"æ±Ÿè‹","ucode":"160354D35D7ABB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIro8BKyich3jKa3z45RWMkXXSgXibbVN6d01KN4cot2ZzoAD5YsicxRV04QRlYfmVE4icLr5xQblrkqA/132","comment_is_top":false,"comment_ctime":1701066562,"is_pvip":false,"replies":[{"id":140288,"content":"ä¸æ˜¯ã€‚æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µçš„æŠ€æœ¯é—®é¢˜ï¼Œæ ¹æ®goå›¢é˜Ÿè¯´æ³•ï¼Œå¦‚æœç”¨&lt;&gt;ï¼Œåˆ™ä¼šåœ¨ç¼–è¯‘é˜¶æ®µè¯æ³•å’Œè¯­æ³•è§£æçš„æ—¶å€™ï¼Œäº§ç”Ÿæ— æ³•åŒ–è§£çš„æ­§ä¹‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1701298373,"ip_address":"è¾½å®","comment_id":384495,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"goè¯­è¨€èŒƒå‹ä¸ä½¿ç”¨ &lt;&gt; \néš¾é“å’Œç»„åˆæœ‰å…³ç³»ï¼Œä¸ºäº†ç»Ÿä¸€ï¼Ÿç±»ä¼¼[]int","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632751,"discussion_content":"ä¸æ˜¯ã€‚æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µçš„æŠ€æœ¯é—®é¢˜ï¼Œæ ¹æ®goå›¢é˜Ÿè¯´æ³•ï¼Œå¦‚æœç”¨&lt;&gt;ï¼Œåˆ™ä¼šåœ¨ç¼–è¯‘é˜¶æ®µè¯æ³•å’Œè¯­æ³•è§£æçš„æ—¶å€™ï¼Œäº§ç”Ÿæ— æ³•åŒ–è§£çš„æ­§ä¹‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1701298373,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":362574,"user_name":"return","can_delete":false,"product_type":"c1","uid":1135528,"ip_address":"åŒ—äº¬","ucode":"42B8A3380DF04B","user_header":"https://static001.geekbang.org/account/avatar/00/11/53/a8/abc96f70.jpg","comment_is_top":false,"comment_ctime":1668650000,"is_pvip":false,"replies":[{"id":131848,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1668660347,"ip_address":"åŒ—äº¬","comment_id":362574,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"ç™½è€å¸ˆä¸€å¦‚æ—¢å¾€çš„è¶…é«˜è´¨é‡ï¼Œæ„Ÿè°¢è€å¸ˆçš„æ— ç§å¥‰çŒ®ã€‚","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593930,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1668660347,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361781,"user_name":"ä¸€æ‰“ä¸ƒ","can_delete":false,"product_type":"c1","uid":1241197,"ip_address":"åŒ—äº¬","ucode":"D242C5EF70C176","user_header":"https://static001.geekbang.org/account/avatar/00/12/f0/6d/3e570bb8.jpg","comment_is_top":false,"comment_ctime":1667869049,"is_pvip":false,"replies":[{"id":131657,"content":"æ¬¢è¿å¸¸å›æ¥çœ‹çœ‹:)","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1667988412,"ip_address":"åŒ—äº¬","comment_id":361781,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"è¿˜å¥½æ—¶ä¸æ—¶å¤ä¹ ä¸€ä¸‹è€å¸ˆçš„è¯¾ï¼Œåˆç­‰åˆ°è€å¸ˆæ›´æ–°äº†ï¼Œæ„å¤–ä¹‹å–œ","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593180,"discussion_content":"æ¬¢è¿å¸¸å›æ¥çœ‹çœ‹:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667988412,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361639,"user_name":"ç½—æ°","can_delete":false,"product_type":"c1","uid":1320487,"ip_address":"åŒ—äº¬","ucode":"96BAFAA147341F","user_header":"https://static001.geekbang.org/account/avatar/00/14/26/27/eba94899.jpg","comment_is_top":false,"comment_ctime":1667726363,"is_pvip":false,"replies":[{"id":131545,"content":"å“ˆå“ˆï¼Œå±…ç„¶æ˜¯åŠæ—¶é›¨:)","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1667785466,"ip_address":"åŒ—äº¬","comment_id":361639,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"æœ€è¿‘æ‰“ç®—çœ‹çœ‹æ³›å‹ï¼Œç„¶åå°±çœ‹åˆ°äº†è€å¸ˆçš„æ›´æ–°ï¼Œéå¸¸åŠæ—¶ã€‚ä¸è¿‡ï¼Œçœ‹èµ·æ¥å¹¶æ²¡æœ‰é‚£ä¹ˆå®¹æ˜“ï¼Œè€å¸ˆå†™çš„å¾ˆè¯¦ç»†ï¼Œéœ€è¦å¥½å¥½æ¶ˆåŒ–ä¸€ä¸‹ã€‚","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592861,"discussion_content":"å“ˆå“ˆï¼Œå±…ç„¶æ˜¯åŠæ—¶é›¨:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667785466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361527,"user_name":"Calvin","can_delete":false,"product_type":"c1","uid":1603004,"ip_address":"åŒ—äº¬","ucode":"0EEF5B207623B5","user_header":"https://static001.geekbang.org/account/avatar/00/18/75/bc/89d88775.jpg","comment_is_top":false,"comment_ctime":1667578260,"is_pvip":false,"replies":[{"id":131546,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1667785483,"ip_address":"åŒ—äº¬","comment_id":361527,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"ç»ˆäºç­‰åˆ°ä½ ï¼Œè¿˜å¥½ä½ æ²¡æ”¾å¼ƒã€‚ğŸ˜‚\nç™½è€å¸ˆçš„è¯¾ç¨‹ä¸€å¦‚æ—¢å¾€çš„é«˜è´¨é‡ï¼Œè¿™ç¯‡æ–‡ç« è¡¥å……äº†æˆ‘å¾ˆå¤šå…³äºæ³›å‹çš„æœªçŸ¥çŸ¥è¯†ç‚¹ã€‚","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592861,"discussion_content":"å“ˆå“ˆï¼Œå±…ç„¶æ˜¯åŠæ—¶é›¨:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667785466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":369342,"user_name":"åƒæ©˜å­çš„æ±¤åœ†ğŸ³","can_delete":false,"product_type":"c1","uid":2557346,"ip_address":"æ²³å—","ucode":"88DA7981062AB5","user_header":"https://static001.geekbang.org/account/avatar/00/27/05/a2/3fa5a070.jpg","comment_is_top":false,"comment_ctime":1677424059,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"æ„Ÿè°¢","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592862,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667785483,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361985,"user_name":"é‚£æ—¶åˆ»","can_delete":false,"product_type":"c1","uid":1150927,"ip_address":"åŒ—äº¬","ucode":"B0D150856C3A4A","user_header":"https://static001.geekbang.org/account/avatar/00/11/8f/cf/890f82d6.jpg","comment_is_top":false,"comment_ctime":1668046049,"is_pvip":false,"replies":[{"id":131787,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1668401113,"ip_address":"åŒ—äº¬","comment_id":361985,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"goè¯­è¨€èŒƒå‹ä¸ä½¿ç”¨ &lt;&gt;ï¼Œæˆ‘æƒ³åˆ°ä¸€ä¸ªç‚¹ï¼Œæ˜¯ä¸æ˜¯è§£æçš„æ—¶å€™ å®¹æ˜“ä¸å¤§äº æˆ–è€…å°äº ç¬¦å·æ··æ·†ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593635,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1668401113,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1603004,"avatar":"https://static001.geekbang.org/account/avatar/00/18/75/bc/89d88775.jpg","nickname":"Calvin","note":"","ucode":"0EEF5B207623B5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593588,"discussion_content":"[] ä¸æ˜¯æ›´åƒåˆ‡ç‰‡æˆ–è€…æ•°ç»„å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1668357224,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1023930,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/9f/ba/5a9cb72f.jpg","nickname":"ä¸¹æ«æŸ“ç§‹è‰²","note":"","ucode":"4E9A35439B615F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593417,"discussion_content":"å°±æ˜¯è¿™ä¸ªåŸå› å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1668161279,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å››å·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361445,"user_name":"æ–‡æ­¦æœ¨å­","can_delete":false,"product_type":"c1","uid":1015986,"ip_address":"åŒ—äº¬","ucode":"348752BDECD65F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/80/b2/2e9f442d.jpg","comment_is_top":false,"comment_ctime":1667523837,"is_pvip":false,"replies":[{"id":131597,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1667817743,"ip_address":"åŒ—äº¬","comment_id":361445,"utype":1}],"discussion_count":1,"race_medal":1,"score":2,"product_id":100093501,"comment_content":"æ²™å‘ğŸ›‹ï¸","like_count":3,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592950,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667817743,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":378578,"user_name":"å·¦è€³æœµä¸œ","can_delete":false,"product_type":"c1","uid":1160678,"ip_address":"å¹¿ä¸œ","ucode":"60134ACF12BB52","user_header":"https://static001.geekbang.org/account/avatar/00/11/b5/e6/c67f12bd.jpg","comment_is_top":false,"comment_ctime":1690444634,"is_pvip":false,"replies":[{"id":137959,"content":"ç¬¬41è®²æœ‰æ³›å‹åŸç†çš„è®²è§£ï¼Œé‚£é‡Œå¯ä»¥æ‰¾åˆ°ç­”æ¡ˆã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1690510749,"ip_address":"è¾½å®","comment_id":378578,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"æ—¢ç„¶æ³›å‹å‡½æ•°çš„å®ä¾‹åŒ–æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µåšçš„ï¼Œå®ä¾‹åŒ–ç”Ÿæˆçš„ä¹Ÿæ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œæ€ä¹ˆå‹æµ‹ç»“æœæ¯”æ™®é€šå‡½æ•°è¦æ…¢å‘¢ï¼Œä¸çŸ¥é“å“ªé‡Œå¤šå‡ºæ¥çš„æ€§èƒ½æŸè€—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592950,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667817743,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":384495,"user_name":"éº¦å­","can_delete":false,"product_type":"c1","uid":1296833,"ip_address":"æ±Ÿè‹","ucode":"160354D35D7ABB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIro8BKyich3jKa3z45RWMkXXSgXibbVN6d01KN4cot2ZzoAD5YsicxRV04QRlYfmVE4icLr5xQblrkqA/132","comment_is_top":false,"comment_ctime":1701066562,"is_pvip":false,"replies":[{"id":140288,"content":"ä¸æ˜¯ã€‚æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µçš„æŠ€æœ¯é—®é¢˜ï¼Œæ ¹æ®goå›¢é˜Ÿè¯´æ³•ï¼Œå¦‚æœç”¨&lt;&gt;ï¼Œåˆ™ä¼šåœ¨ç¼–è¯‘é˜¶æ®µè¯æ³•å’Œè¯­æ³•è§£æçš„æ—¶å€™ï¼Œäº§ç”Ÿæ— æ³•åŒ–è§£çš„æ­§ä¹‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1701298373,"ip_address":"è¾½å®","comment_id":384495,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"goè¯­è¨€èŒƒå‹ä¸ä½¿ç”¨ &lt;&gt; \néš¾é“å’Œç»„åˆæœ‰å…³ç³»ï¼Œä¸ºäº†ç»Ÿä¸€ï¼Ÿç±»ä¼¼[]int","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":624370,"discussion_content":"ç¬¬41è®²æœ‰æ³›å‹åŸç†çš„è®²è§£ï¼Œé‚£é‡Œå¯ä»¥æ‰¾åˆ°ç­”æ¡ˆã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1690510749,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":362574,"user_name":"return","can_delete":false,"product_type":"c1","uid":1135528,"ip_address":"åŒ—äº¬","ucode":"42B8A3380DF04B","user_header":"https://static001.geekbang.org/account/avatar/00/11/53/a8/abc96f70.jpg","comment_is_top":false,"comment_ctime":1668650000,"is_pvip":false,"replies":[{"id":131848,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1668660347,"ip_address":"åŒ—äº¬","comment_id":362574,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"ç™½è€å¸ˆä¸€å¦‚æ—¢å¾€çš„è¶…é«˜è´¨é‡ï¼Œæ„Ÿè°¢è€å¸ˆçš„æ— ç§å¥‰çŒ®ã€‚","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632751,"discussion_content":"ä¸æ˜¯ã€‚æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µçš„æŠ€æœ¯é—®é¢˜ï¼Œæ ¹æ®goå›¢é˜Ÿè¯´æ³•ï¼Œå¦‚æœç”¨&lt;&gt;ï¼Œåˆ™ä¼šåœ¨ç¼–è¯‘é˜¶æ®µè¯æ³•å’Œè¯­æ³•è§£æçš„æ—¶å€™ï¼Œäº§ç”Ÿæ— æ³•åŒ–è§£çš„æ­§ä¹‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1701298373,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361781,"user_name":"ä¸€æ‰“ä¸ƒ","can_delete":false,"product_type":"c1","uid":1241197,"ip_address":"åŒ—äº¬","ucode":"D242C5EF70C176","user_header":"https://static001.geekbang.org/account/avatar/00/12/f0/6d/3e570bb8.jpg","comment_is_top":false,"comment_ctime":1667869049,"is_pvip":false,"replies":[{"id":131657,"content":"æ¬¢è¿å¸¸å›æ¥çœ‹çœ‹:)","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1667988412,"ip_address":"åŒ—äº¬","comment_id":361781,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"è¿˜å¥½æ—¶ä¸æ—¶å¤ä¹ ä¸€ä¸‹è€å¸ˆçš„è¯¾ï¼Œåˆç­‰åˆ°è€å¸ˆæ›´æ–°äº†ï¼Œæ„å¤–ä¹‹å–œ","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593930,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1668660347,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361639,"user_name":"ç½—æ°","can_delete":false,"product_type":"c1","uid":1320487,"ip_address":"åŒ—äº¬","ucode":"96BAFAA147341F","user_header":"https://static001.geekbang.org/account/avatar/00/14/26/27/eba94899.jpg","comment_is_top":false,"comment_ctime":1667726363,"is_pvip":false,"replies":[{"id":131545,"content":"å“ˆå“ˆï¼Œå±…ç„¶æ˜¯åŠæ—¶é›¨:)","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1667785466,"ip_address":"åŒ—äº¬","comment_id":361639,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"æœ€è¿‘æ‰“ç®—çœ‹çœ‹æ³›å‹ï¼Œç„¶åå°±çœ‹åˆ°äº†è€å¸ˆçš„æ›´æ–°ï¼Œéå¸¸åŠæ—¶ã€‚ä¸è¿‡ï¼Œçœ‹èµ·æ¥å¹¶æ²¡æœ‰é‚£ä¹ˆå®¹æ˜“ï¼Œè€å¸ˆå†™çš„å¾ˆè¯¦ç»†ï¼Œéœ€è¦å¥½å¥½æ¶ˆåŒ–ä¸€ä¸‹ã€‚","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593180,"discussion_content":"æ¬¢è¿å¸¸å›æ¥çœ‹çœ‹:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667988412,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361527,"user_name":"Calvin","can_delete":false,"product_type":"c1","uid":1603004,"ip_address":"åŒ—äº¬","ucode":"0EEF5B207623B5","user_header":"https://static001.geekbang.org/account/avatar/00/18/75/bc/89d88775.jpg","comment_is_top":false,"comment_ctime":1667578260,"is_pvip":false,"replies":[{"id":131546,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1667785483,"ip_address":"åŒ—äº¬","comment_id":361527,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"ç»ˆäºç­‰åˆ°ä½ ï¼Œè¿˜å¥½ä½ æ²¡æ”¾å¼ƒã€‚ğŸ˜‚\nç™½è€å¸ˆçš„è¯¾ç¨‹ä¸€å¦‚æ—¢å¾€çš„é«˜è´¨é‡ï¼Œè¿™ç¯‡æ–‡ç« è¡¥å……äº†æˆ‘å¾ˆå¤šå…³äºæ³›å‹çš„æœªçŸ¥çŸ¥è¯†ç‚¹ã€‚","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592862,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667785483,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":369342,"user_name":"åƒæ©˜å­çš„æ±¤åœ†ğŸ³","can_delete":false,"product_type":"c1","uid":2557346,"ip_address":"æ²³å—","ucode":"88DA7981062AB5","user_header":"https://static001.geekbang.org/account/avatar/00/27/05/a2/3fa5a070.jpg","comment_is_top":false,"comment_ctime":1677424059,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"æ„Ÿè°¢","like_count":1}]}