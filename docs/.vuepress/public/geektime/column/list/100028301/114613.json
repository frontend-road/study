{"id":114613,"title":"33 | æ€§èƒ½æå‡10å€çš„ç§˜è¯€ï¼šå¿…é¡»ç”¨å¥½ table","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æ¸©é“­ã€‚</p><p>åœ¨ OpenResty ä¸­ï¼Œé™¤äº†å­—ç¬¦ä¸²ç»å¸¸å‡ºç°æ€§èƒ½é—®é¢˜å¤–ï¼Œtable ä¹Ÿæ˜¯æ€§èƒ½çš„æ‹¦è·¯è™ã€‚åœ¨ä¹‹å‰çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬é›¶é›¶æ•£æ•£åœ°ä»‹ç»è¿‡ table ç›¸å…³çš„å‡½æ•°ï¼Œä½†å¹¶æ²¡æœ‰ä¸“é—¨æåˆ°å®ƒå¯¹æ€§èƒ½æ–¹é¢çš„æå‡ã€‚ä»Šå¤©ï¼Œæˆ‘å°±å¸¦ä½ ä¸“é—¨æ¥èŠèŠï¼Œtable æ“ä½œå¯¹æ€§èƒ½çš„å½±å“ã€‚</p><p>ä¸åŒäºå¯¹å­—ç¬¦ä¸²çš„ç†Ÿæ‚‰ï¼Œå¼€å‘è€…å¯¹äº table ç›¸å…³çš„æ€§èƒ½ä¼˜åŒ–çŸ¥ä¹‹ç”šå°‘ï¼Œè¿™ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹é¢çš„åŸå› ã€‚</p><ul>\n<li>å…¶ä¸€ï¼ŒOpenResty ä¸­ä½¿ç”¨çš„æ˜¯ Lua ï¼Œæ˜¯è‡ªå·±çš„ LuaJIT åˆ†æ”¯ï¼Œä¸æ˜¯æ ‡å‡†çš„ LuaJITï¼Œä¹Ÿä¸æ˜¯æ ‡å‡†çš„ Luaã€‚è€Œå¤§éƒ¨åˆ†å¼€å‘è€…å¹¶ä¸çŸ¥é“å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ï¼Œå€¾å‘äºä½¿ç”¨æ ‡å‡† Lua çš„ table åº“æ¥å†™ OpenResty ä»£ç ã€‚</li>\n<li>å…¶äºŒï¼Œåœ¨æ ‡å‡† LuaJIT å’Œ OpenResty è‡ªå·±çš„ LuaJIT åˆ†æ”¯ä¸­ï¼Œtable æ“ä½œç›¸å…³çš„æ–‡æ¡£éƒ½è—å¾—éå¸¸æ·±ï¼Œå¼€å‘è€…å¾ˆéš¾æ‰¾åˆ°ï¼›è€Œä¸”æ–‡æ¡£ä¸­ä¹Ÿæ²¡æœ‰ç¤ºä¾‹ä»£ç ï¼Œéœ€è¦å¼€å‘è€…è‡ªå·±å»å¼€æºé¡¹ç›®ä¸­å¯»æ‰¾ç¤ºä¾‹ã€‚</li>\n</ul><p>è¿™å°±å½¢æˆäº†æ¯”è¾ƒé«˜çš„è®¤çŸ¥å£å’ï¼Œå¯¼è‡´äº†ä¸¤æåˆ†åŒ–çš„ç»“æœâ€”â€”èµ„æ·±çš„ OpenResty å¼€å‘è€…èƒ½å¤Ÿå†™å‡ºå¾ˆé«˜æ€§èƒ½çš„ä»£ç ï¼Œè€Œåˆšå…¥é—¨çš„åˆ™ä¼šæ€€ç–‘ OpenResty çš„é«˜æ€§èƒ½æ˜¯ä¸æ˜¯ä¸€ä¸ªæ³¡æ²«ã€‚å½“ç„¶ï¼Œç­‰ä½ å­¦ä¹ å®Œè¿™èŠ‚è¯¾çš„å†…å®¹ï¼Œä½ å°±å¯ä»¥è½»æ¾åœ°æˆ³ç ´è¿™å±‚çª—æˆ·çº¸ï¼Œè®©æ€§èƒ½æå‡ 10 å€ä¸æ˜¯æ¢¦ã€‚</p><p>åœ¨è¯¦ç»†ä»‹ç» table ä¼˜åŒ–ä¹‹å‰ï¼Œæˆ‘æƒ³å…ˆå¼ºè°ƒçš„ä¸€ç‚¹æ˜¯ï¼Œtable ç›¸å…³çš„ä¼˜åŒ–ï¼Œæœ‰ä¸€ä¸ªè‡ªå·±çš„ç®€å•åŸåˆ™ï¼š</p><!-- [[[read_end]]] --><p><strong>å°½é‡å¤ç”¨ï¼Œé¿å…ä¸å¿…è¦çš„ table åˆ›å»ºã€‚</strong></p><p>ä½ å…ˆè®°ä½è¿™ä¸€ç‚¹ï¼Œä¸‹é¢ï¼Œæˆ‘ä»¬å°±ä» table çš„åˆ›å»ºã€å…ƒç´ çš„æ’å…¥ã€æ¸…ç©ºã€å¾ªç¯ä½¿ç”¨ç­‰æ–¹é¢ï¼Œåˆ†åˆ«æ¥ä»‹ç»ç›¸å…³çš„ä¼˜åŒ–ã€‚</p><h2>é¢„å…ˆç”Ÿæˆæ•°ç»„</h2><p>ç¬¬ä¸€æ­¥ï¼Œè‡ªç„¶æ˜¯åˆ›å»ºæ•°ç»„ã€‚åœ¨ Lua ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºæ•°ç»„çš„æ–¹å¼å¾ˆç®€å•ï¼š</p><pre><code>local t = {}\n</code></pre><p>ä¸Šé¢è¿™è¡Œä»£ç ï¼Œå°±åˆ›å»ºäº†ä¸€ä¸ªç©ºæ•°ç»„ï¼›å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨åˆ›å»ºçš„æ—¶å€™ï¼Œå°±åŠ ä¸Šåˆå§‹åŒ–çš„æ•°æ®ï¼š</p><pre><code>local color = {first = &quot;red&quot;, &quot;blue&quot;, third = &quot;green&quot;, &quot;yellow&quot;}\n</code></pre><p>ä¸è¿‡ï¼Œç¬¬äºŒç§å†™æ³•å¯¹äºæ€§èƒ½çš„æŸå¤±æ¯”è¾ƒå¤§ï¼ŒåŸå› åœ¨äºæ¯æ¬¡æ–°å¢å’Œåˆ é™¤æ•°ç»„å…ƒç´ çš„æ—¶å€™ï¼Œéƒ½ä¼šæ¶‰åŠåˆ°æ•°ç»„çš„ç©ºé—´åˆ†é…ã€<code>resize</code> å’Œ <code>rehash</code>ã€‚</p><p>é‚£ä¹ˆåº”è¯¥å¦‚ä½•ä¼˜åŒ–å‘¢ï¼Ÿç©ºé—´æ¢æ—¶é—´ï¼Œæ˜¯ä¸€ç§å¸¸è§çš„ä¼˜åŒ–æ€è·¯ã€‚æ—¢ç„¶è¿™é‡Œçš„æ€§èƒ½ç“¶é¢ˆæ˜¯åŠ¨æ€åˆ†é…æ•°ç»„ç©ºé—´ï¼Œé‚£ä¹ˆä¼˜åŒ–çš„æ–¹å‘ï¼Œå°±å¯ä»¥æ˜¯é¢„å…ˆç”Ÿæˆä¸€ä¸ªæŒ‡å®šå¤§å°çš„æ•°ç»„ã€‚è¿™æ ·åšè™½ç„¶å¯èƒ½ä¼šæµªè´¹ä¸€éƒ¨åˆ†çš„å†…å­˜ç©ºé—´ï¼Œä½†å¤šæ¬¡çš„ç©ºé—´åˆ†é…ã€<code>resize</code> å’Œ <code>rehash</code> ç­‰åŠ¨ä½œï¼Œå°±å¯ä»¥åˆå¹¶ä¸ºä¸€æ¬¡å®Œæˆäº†ï¼Œæ•ˆç‡é«˜äº†ä¸å°‘ã€‚</p><p>äº‹å®ä¸Šï¼ŒLuaJIT ä¸­çš„ <code>table.new(narray, nhash)</code> å‡½æ•°ï¼Œå°±æ˜¯å› æ­¤è€Œæ–°å¢çš„ã€‚</p><p>è¿™ä¸ªå‡½æ•°ï¼Œä¼šé¢„å…ˆåˆ†é…å¥½æŒ‡å®šçš„æ•°ç»„å’Œå“ˆå¸Œçš„ç©ºé—´å¤§å°ï¼Œè€Œä¸æ˜¯åœ¨æ’å…¥å…ƒç´ æ—¶è‡ªå¢é•¿ï¼Œè¿™ä¹Ÿæ˜¯å®ƒçš„ä¸¤ä¸ªå‚æ•° <code>narray</code> å’Œ <code>nhash</code> çš„å«ä¹‰ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¥çœ‹ä¸‹å…·ä½“çš„ä½¿ç”¨ã€‚å› ä¸ºè¿™ä¸ªå‡½æ•°æ˜¯ LuaJIT æ‰©å±•å‡ºæ¥çš„ï¼Œæ‰€ä»¥ï¼Œåœ¨ä½¿ç”¨å®ƒä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆ <code>require</code> ä¸€ä¸‹ï¼š</p><pre><code>local new_tab = require &quot;table.new&quot;\n local t = new_tab(100, 0)\n for i = 1, 100 do\n   t[i] = i\n end\n</code></pre><p>å¦å¤–ï¼Œå› ä¸ºä¹‹å‰çš„ OpenResty å¹¶æ²¡æœ‰å®Œå…¨ç»‘å®š LuaJITï¼Œè¿˜æ”¯æŒæ ‡å‡† Luaï¼Œæ‰€ä»¥æœ‰äº›æ—§çš„ä»£ç ä¼šåšè¿™æ–¹é¢çš„å…¼å®¹ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ° <code>table.new</code> è¿™ä¸ªå‡½æ•°ï¼Œå°±ä¼šæ¨¡æ‹Ÿå‡ºæ¥ä¸€ä¸ªç©ºçš„å‡½æ•°ï¼Œæ¥ä¿è¯è°ƒç”¨æ–¹çš„ç»Ÿä¸€ã€‚</p><pre><code>local ok, new_tab = pcall(require, &quot;table.new&quot;)\n  if not ok then\n    new_tab = function (narr, nrec) return {} end\n  end\n</code></pre><h2>è‡ªå·±è®¡ç®— table ä¸‹æ ‡</h2><p>æœ‰äº† table å¯¹è±¡ä¹‹åï¼Œä¸‹ä¸€æ­¥å°±æ˜¯å‘å®ƒé‡Œé¢å¢åŠ å…ƒç´ äº†ã€‚æœ€ç›´æ¥çš„æ–¹æ³•ï¼Œå°±æ˜¯è°ƒç”¨ <code>table.insert</code> è¿™ä¸ªå‡½æ•°æ¥æ’å…¥å…ƒç´ ï¼š</p><pre><code>local new_tab = require &quot;table.new&quot;\n local t = new_tab(100, 0)\n for i = 1, 100 do\n   table.insert(t, i)\n end\n</code></pre><p>æˆ–è€…æ˜¯å…ˆè·å–å½“å‰æ•°ç»„çš„é•¿åº¦ï¼Œé€šè¿‡ä¸‹æ ‡çš„æ–¹å¼æ¥æ’å…¥å…ƒç´ ï¼š</p><pre><code>local new_tab = require &quot;table.new&quot;\n local t = new_tab(100, 0)\n for i = 1, 100 do\n   t[#t + 1] = i\n end\n</code></pre><p>ä¸è¿‡ï¼Œè¿™ä¸¤ç§æ–¹å¼éƒ½éœ€è¦å…ˆè®¡ç®—æ•°ç»„çš„é•¿åº¦ï¼Œç„¶åå†æ–°å¢å…ƒç´ ã€‚æ˜¾ç„¶ï¼Œè¿™ä¸ªæ“ä½œæ˜¯ O(n) çš„æ—¶é—´å¤æ‚åº¦ã€‚å°±æ‹¿ä¸Šé¢ä»£ç çš„ä¾‹å­æ¥è¯´ï¼Œfor å¾ªç¯ä¼šè®¡ç®— 100 æ¬¡æ•°ç»„çš„é•¿åº¦ï¼Œè¿™æ ·ä¸‹æ¥æ€§èƒ½è‡ªç„¶ä¸ä¹è§‚ï¼Œå¹¶ä¸”æ•°ç»„è¶Šå¤§æ—¶ï¼Œæ€§èƒ½ä¹Ÿä¼šè¶Šä½ã€‚</p><p>è¿™ä¸€ç‚¹åˆè¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿè®©æˆ‘ä»¬çœ‹ä¸‹ <code>lua-resty-redis</code> è¿™ä¸ªå®˜æ–¹çš„åº“æ˜¯å¦‚ä½•åšçš„å§ï¼š</p><pre><code>local function _gen_req(args)\n    local nargs = #args\n\n\n    local req = new_tab(nargs * 5 + 1, 0)\n    req[1] = &quot;*&quot; .. nargs .. &quot;\\r\\n&quot;\n    local nbits = 2\n\n\n    for i = 1, nargs do\n        local arg = args[i]\n        req[nbits] = &quot;$&quot;\n        req[nbits + 1] = #arg\n        req[nbits + 2] = &quot;\\r\\n&quot;\n        req[nbits + 3] = arg\n        req[nbits + 4] = &quot;\\r\\n&quot;\n        nbits = nbits + 5\n    end\n    return req\nen\n</code></pre><p>è¿™ä¸ªå‡½æ•°é¢„å…ˆç”Ÿæˆäº†æ•°ç»„ <code>req</code>ï¼Œå®ƒçš„å¤§å°ç”±å‡½æ•°çš„å…¥å‚æ¥å†³å®šï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯å°½é‡ä¸æµªè´¹ç©ºé—´ã€‚</p><p>ç„¶åï¼Œå®ƒä½¿ç”¨ <code>nbits</code> è¿™ä¸ªå˜é‡ï¼Œæ¥è‡ªå·±ç»´æŠ¤ <code>req</code> çš„ä¸‹æ ‡ï¼Œè‡ªç„¶å°±æŠ›å¼ƒäº† Lua å†…ç½®çš„ <code>table.insert</code> å‡½æ•°å’Œè·å–é•¿åº¦çš„æ“ä½œç¬¦ <code>#</code>ã€‚ä½ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ for å¾ªç¯ä¸­ï¼Œ<code>nbits + 1</code> ç­‰ä¸€äº›è¿ç®—ï¼Œå°±æ˜¯ç›´æ¥ç”¨ä¸‹æ ‡çš„æ–¹å¼æ’å…¥å…ƒç´ ï¼›å¹¶åœ¨æœ€åç”¨ <code>nbits = nbits + 5</code> ï¼Œè®©ä¸‹æ ‡ä¿æŒä¸€ä¸ªæ­£ç¡®çš„å€¼ã€‚</p><p>è¿™ç§çš„å¥½å¤„å¾ˆæ˜æ˜¾ï¼Œå®ƒçœç•¥äº†è·å–æ•°ç»„å¤§å°è¿™ä¸ª O(n) çš„æ“ä½œï¼Œè€Œæ˜¯ç›´æ¥ç”¨ä¸‹æ ‡è®¿é—®ï¼Œæ—¶é—´å¤æ‚åº¦ä¹Ÿå˜æˆäº† O(1) ã€‚å½“ç„¶ï¼Œç¼ºç‚¹ä¹Ÿä¸€æ ·æ˜æ˜¾ï¼Œé‚£å°±æ˜¯é™ä½äº†ä»£ç çš„å¯è¯»æ€§ï¼Œå¹¶ä¸”å‡ºé”™æ¦‚ç‡å¤§å¤§æé«˜ï¼Œå¯ä»¥è¯´ï¼Œè¿™æ˜¯ä¸€æŠŠåŒåˆƒå‰‘ã€‚</p><h2>å¾ªç¯ä½¿ç”¨å•ä¸ª table</h2><p>æ—¢ç„¶ table è¿™ä¹ˆæ¥ä¹‹ä¸æ˜“ï¼Œæˆ‘ä»¬è‡ªç„¶è¦å¥½å¥½çæƒœï¼Œå°½é‡åšåˆ°é‡å¤ä½¿ç”¨ã€‚ä¸è¿‡ï¼Œå¾ªç¯åˆ©ç”¨ä¹Ÿæ˜¯æœ‰æ¡ä»¶çš„ã€‚æˆ‘ä»¬å…ˆè¦æŠŠ table ä¸­åŸæœ‰çš„æ•°æ®æ¸…ç†å¹²å‡€ï¼Œä»¥å…å¯¹ä¸‹ä¸€ä¸ªä½¿ç”¨è€…é€ æˆæ±¡æŸ“ã€‚</p><p>è¿™æ—¶ï¼Œ<code>table.clear</code> å‡½æ•°å°±æ´¾ä¸Šç”¨åœºäº†ã€‚ä»å®ƒçš„åå­—ä½ å°±èƒ½çœ‹å‡ºå®ƒçš„ä½œç”¨ï¼Œå®ƒä¼šæŠŠæ•°ç»„ä¸­çš„æ‰€æœ‰æ•°æ®æ¸…ç©ºï¼Œä½†æ•°ç»„çš„å¤§å°ä¸ä¼šå˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ ç”¨ <code>table.new(narray, nhash)</code> ç”Ÿäº†ä¸€ä¸ªé•¿åº¦ä¸º 100 çš„æ•°ç»„ï¼Œclear åï¼Œé•¿åº¦è¿˜æ˜¯ 100ã€‚</p><p>ä¸ºäº†è®©ä½ èƒ½å¤Ÿæ›´æ¸…æ¥šå®ƒçš„å®ç°ï¼Œä¸‹é¢æˆ‘ç»™å‡ºäº†ä¸€ä¸ªä»£ç ç¤ºä¾‹ï¼Œå®ƒå…¼å®¹äº†æ ‡å‡† Luaï¼š</p><pre><code>local ok, clear_tab = pcall(require, &quot;table.clear&quot;)\n  if not ok then\n    clear_tab = function (tab)\n      for k, _ in pairs(tab) do\n        tab[k] = nil\n      end\n    end\n  end\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œclear å‡½æ•°å®é™…ä¸Šå°±æ˜¯æŠŠæ¯ä¸€ä¸ªå…ƒç´ éƒ½ç½®ä¸ºäº†nilã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šæŠŠè¿™ç§å¾ªç¯ä½¿ç”¨çš„ tableï¼Œæ”¾åœ¨ä¸€ä¸ªæ¨¡å—çš„ top level ä¸­ã€‚è¿™æ ·ï¼Œåœ¨ä½ ä½¿ç”¨æ¨¡å—ä¸­çš„å‡½æ•°çš„æ—¶å€™ï¼Œå°±å¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µæ¥å†³å®šï¼Œåˆ°åº•æ˜¯ç›´æ¥ä½¿ç”¨ï¼Œè¿˜æ˜¯ clear åå†ä½¿ç”¨ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå®é™…åº”ç”¨çš„ä¾‹å­ã€‚ä¸‹é¢è¿™æ®µ  <a href=\"https://github.com/iresty/apisix/blob/master/lua/apisix/plugin.lua\">ä¼ªä»£ç </a>  å–è‡ªå¼€æºçš„å¾®æœåŠ¡ API ç½‘å…³ APISIXï¼Œè¿™æ˜¯å®ƒåœ¨åŠ è½½æ’ä»¶æ—¶å€™çš„é€»è¾‘ï¼š</p><pre><code>local local_plugins = {}\n\n\nfunction load()\n    core.table.clear(local_plugins)\n\n\n    local local_conf = core.config.local_conf()\n    local plugin_names = local_conf.plugins\n\n\n    local processed = {}\n    for _, name in ipairs(plugin_names) do\n        if processed[name] == nil then\n            processed[name] = true\n            insert_tab(local_plugins, name)\n        end\n    end\n\n\n    return local_plugins\n</code></pre><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œ<code>local_plugins</code> è¿™ä¸ªæ•°ç»„ï¼Œæ˜¯ plugin è¿™ä¸ªæ¨¡å—çš„ top level å˜é‡ã€‚åœ¨ load è¿™ä¸ªåŠ è½½æ’ä»¶å‡½æ•°çš„å¼€å§‹ä½ç½®ï¼Œ table å°±ä¼šè¢«æ¸…ç©ºï¼Œç„¶åæ ¹æ®å½“å‰çš„æƒ…å†µç”Ÿæˆæ–°çš„æ’ä»¶åˆ—è¡¨ã€‚</p><h2>table æ± </h2><p>åˆ°ç°åœ¨ï¼Œä½ å°±æŒæ¡äº†å¯¹å•ä¸ª table å¾ªç¯ä½¿ç”¨çš„ä¼˜åŒ–æ–¹æ³•äº†ã€‚é‚£ä¹ˆæ›´è¿›ä¸€æ­¥ï¼Œä½ è¿˜å¯ä»¥ç”¨ç¼“å­˜æ± çš„æ–¹å¼æ¥ä¿å­˜å¤šä¸ª tableï¼Œä»¥ä¾¿éšç”¨éšå–ï¼Œå®˜æ–¹æä¾›çš„ <code>lua-tablepool</code> æ­£æ˜¯å‡ºäºè¿™ä¸ªç›®çš„ã€‚</p><p>ä¸‹é¢è¿™æ®µä»£ç ï¼Œå±•ç¤ºäº† table æ± çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥ä»æŒ‡å®šçš„æ± å­ä¸­è·å–ä¸€ä¸ª tableï¼Œä½¿ç”¨å®Œä»¥åå†é‡Šæ”¾å›å»ï¼š</p><pre><code>local tablepool = require &quot;tablepool&quot;\n local tablepool_fetch = tablepool.fetch\n local tablepool_release = tablepool.release\n\n\nlocal pool_name = &quot;some_tag&quot; \nlocal function do_sth()\n     local t = tablepool_fetch(pool_name, 10, 0)\n     -- -- using t for some purposes\n    tablepool_release(pool_name, t) \nend\n</code></pre><p>æ˜¾ç„¶ï¼Œtablepool ä¸­ä¼šç”¨åˆ°å‰é¢æˆ‘ä»¬ä»‹ç»è¿‡çš„å‡ ä¸ªæ–¹æ³•ï¼Œè€Œä¸”å®ƒçš„ä»£ç åªæœ‰ä¸åˆ°ä¸€ç™¾è¡Œï¼Œæ‰€ä»¥ï¼Œå¦‚æœä½ å­¦æœ‰ä½™åŠ›ï¼Œæˆ‘ååˆ†æ¨èä½ å¯ä»¥è‡ªå·±æœç´¢å¹¶ç ”ç©¶ä¸€ä¸‹ã€‚è¿™é‡Œï¼Œæˆ‘ä¸»è¦ä»‹ç»ä¸‹å®ƒçš„ä¸¤ä¸ª APIã€‚</p><p>ç¬¬ä¸€ä¸ªæ˜¯ fetch æ–¹æ³•ï¼Œå®ƒçš„å‚æ•°å’Œ table.new åŸºæœ¬ä¸€æ ·ï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ª <code>pool_name</code>ã€‚å¦‚æœæ± å­ä¸­æ²¡æœ‰ç©ºé—²çš„æ•°ç»„ï¼Œfetch æ–¹æ³•å°±ä¼šè°ƒç”¨ table.new æ¥æ–°å»ºä¸€ä¸ªæ•°ç»„ã€‚</p><pre><code>tablepool.fetch(pool_name, narr, nrec)\n</code></pre><p>ç¬¬äºŒä¸ªæ˜¯ release è¿™ä¸ªæŠŠ table æ”¾å›æ± å­çš„å‡½æ•°ã€‚åœ¨å®ƒçš„å‚æ•°ä¸­ï¼Œæœ€åçš„ <code>no_clear</code> ï¼Œç”¨æ¥é…ç½®æ˜¯å¦è¦è°ƒç”¨ table.clear æŠŠæ•°ç»„æ¸…ç©ºã€‚</p><pre><code>tablepool.release(pool_name, tb, [no_clear])\n</code></pre><p>ä½ çœ‹ï¼Œæˆ‘ä»¬å‰é¢ä»‹ç»åˆ°çš„æ–¹æ³•ï¼Œåˆ°è¿™é‡Œæ˜¯ä¸æ˜¯å°±å…¨éƒ¨ä¸²è”èµ·æ¥äº†ï¼Ÿ</p><p>ä¸è¿‡ï¼Œæ³¨æ„ä¸è¦å› æ­¤æ»¥ç”¨tablepoolã€‚tablepool åœ¨å®é™…é¡¹ç›®ä¸­çš„ä½¿ç”¨å¹¶ä¸å¤šï¼Œæ¯”å¦‚ Kong ä¸­å°±æ²¡æœ‰ç”¨åˆ°ï¼ŒAPISIX ä¹Ÿåªæœ‰å°‘æ•°å‡ ä¸ªè°ƒç”¨ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸ç”¨ tablepool çš„è¿™å±‚å°è£…ï¼Œä¹Ÿæ˜¯è¶³å¤Ÿæˆ‘ä»¬ä½¿ç”¨çš„ã€‚</p><h2>å†™åœ¨æœ€å</h2><p>æ€§èƒ½ä¼˜åŒ–ï¼Œæ˜¯ OpenResty ä¸­çš„ç¡¬éª¨å¤´ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å¤§å®¶å…³æ³¨çš„çƒ­ç‚¹ã€‚ä»Šå¤©æˆ‘ä»‹ç»äº†tableç›¸å…³çš„æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼Œå¸Œæœ›èƒ½å¯¹ä½ çš„å®é™…é¡¹ç›®æœ‰æ‰€å¸®åŠ©ã€‚</p><p>æœ€åç»™ä½ ç•™ä¸€ä¸ªä½œä¸šé¢˜ï¼šä½ å¯ä»¥è‡ªå·±åšä¸ªæ€§èƒ½æµ‹è¯•ï¼Œå¯¹æ¯”ä¸‹ä½¿ç”¨ table ç›¸å…³ä¼˜åŒ–æŠ€å·§å‰åçš„æ€§èƒ½å·®å¼‚å—ï¼Ÿæ¬¢è¿ç•™è¨€å’Œæˆ‘äº¤æµï¼Œä½ çš„åšæ³•å’Œè§‚ç‚¹éƒ½æ˜¯æˆ‘å¸Œæœ›å¬åˆ°çš„å£°éŸ³ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«å‡ºå»ï¼Œè®©æ›´å¤šçš„äººä¸€èµ·å‚ä¸è¿›æ¥ã€‚</p><p></p>","neighbors":{"left":{"article_title":"32 | è®©äººåˆæ¨åˆçˆ±çš„å­—ç¬¦ä¸²æ“ä½œ","id":113066},"right":{"article_title":"34 | ç‰¹åˆ«æ”¾é€ï¼šOpenRestyç¼–ç æŒ‡å—","id":116204}},"comments":[{"had_liked":false,"id":122823,"user_name":"wusiration","can_delete":false,"product_type":"c1","uid":1104438,"ip_address":"","ucode":"A9403377054F1E","user_header":"https://static001.geekbang.org/account/avatar/00/10/da/36/ac0ff6a7.jpg","comment_is_top":false,"comment_ctime":1565535720,"is_pvip":false,"replies":[{"id":"46056","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"æ¸©é“­@OpenResty","uid":"1017955","ctime":1566196579,"ip_address":"","comment_id":122823,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14450437608","product_id":100028301,"comment_content":"å°è¯•äº†ä»¥ä¸‹æ€§èƒ½æµ‹è¯•ï¼š<br>ï¼ˆ1ï¼‰é¢„å…ˆç”Ÿæˆæ•°ç»„<br>resty -e &#39;<br>local begin = ngx.now()<br>local t = {}<br>for i = 1,100000000  do<br>  table.insert(t, i)<br>end<br>ngx.update_time()<br>print(ngx.now()-begin)<br>&#39;<br>ç”¨æ—¶ï¼š21.62700009346<br>resty -e &#39;<br>local new_tab = require &quot;table.new&quot;<br>local begin = ngx.now()<br>local t = new_tab(100000000, 0)<br>for i = 1,100000000  do<br>  table.insert(t, i)<br>end<br>ngx.update_time()<br>print(ngx.now()-begin)<br>&#39;<br>ç”¨æ—¶ï¼š7.595999956131<br><br>ï¼ˆ2ï¼‰è‡ªå·±è®¡ç®—tableä¸‹æ ‡<br>--ä½¿ç”¨insertå‡½æ•°<br>resty -e &#39;<br>local new_tab = require &quot;table.new&quot;<br>local begin = ngx.now()<br>local t = new_tab(100000000, 0)<br>for i = 1,100000000  do<br>  table.insert(t, i)<br>end<br>ngx.update_time()<br>print(ngx.now()-begin)<br>&#39;<br>ç”¨æ—¶ï¼š7.6459999084473<br>--è‡ªå·±è®¡ç®—ä¸‹æ ‡<br>resty -e &#39;<br>local new_tab = require &quot;table.new&quot;<br>local begin = ngx.now()<br>local t = new_tab(100000000, 0)<br>for i = 1,100000000  do<br>  t[i] = i<br>end<br>ngx.update_time()<br>print(ngx.now()-begin)<br>&#39;<br>ç”¨æ—¶ï¼š0.33599996566772<br><br>ï¼ˆ3ï¼‰å¾ªç¯ä½¿ç”¨å•ä¸ªtable<br>--åˆ†åˆ«å»ºç«‹ä¸¤ä¸ªtable<br>resty -e &#39;<br>local new_tab = require &quot;table.new&quot;<br>local begin = ngx.now()<br>local t1 = new_tab(100000000, 0)<br>for i = 1,100000000  do<br>  t1[i] = i<br>end<br>local t2 = new_tab(100000000, 0)<br>for i = 1,100000000  do<br>  t2[i] = i<br>end<br>ngx.update_time()<br>print(ngx.now()-begin)<br>&#39;<br>ç”¨æ—¶ï¼š0.66700005531311<br><br>--å¤ç”¨table<br>resty -e &#39;<br>local new_tab = require &quot;table.new&quot;<br>local begin = ngx.now()<br>local t = new_tab(100000000, 0)<br>for i = 1,100000000  do<br>  t[i] = i<br>end<br>for i = 1,100000000  do<br>  t[i] = i<br>end<br>ngx.update_time()<br>print(ngx.now()-begin)<br>&#39;<br>ç”¨æ—¶ï¼š0.40800023078918","like_count":3,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462418,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566196579,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127466,"user_name":"HelloBug","can_delete":false,"product_type":"c1","uid":1249598,"ip_address":"","ucode":"E61A4AD5C2F724","user_header":"https://static001.geekbang.org/account/avatar/00/13/11/3e/925aa996.jpg","comment_is_top":false,"comment_ctime":1566723930,"is_pvip":true,"replies":[{"id":"47536","content":"æˆ‘è®°å¾—æ˜¯ 1.15 è¿™ä¸ªç‰ˆæœ¬å¼€å§‹å°±åªæ”¯æŒè‡ªå·±çš„ LuaJIT äº†ã€‚lua å’Œå®˜æ–¹çš„ luajit éƒ½ä¸å†æ”¯æŒäº†","user_name":"ä½œè€…å›å¤","user_name_real":"æ¸©é“­@OpenResty","uid":"1017955","ctime":1566869016,"ip_address":"","comment_id":127466,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5861691226","product_id":100028301,"comment_content":"OpenRestyæ˜¯ä»å“ªä¸ªç‰ˆæœ¬å¼€å§‹å®Œå…¨ç»‘å®šLuaJITçš„å‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464507,"discussion_content":"æˆ‘è®°å¾—æ˜¯ 1.15 è¿™ä¸ªç‰ˆæœ¬å¼€å§‹å°±åªæ”¯æŒè‡ªå·±çš„ LuaJIT äº†ã€‚lua å’Œå®˜æ–¹çš„ luajit éƒ½ä¸å†æ”¯æŒäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566869016,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127510,"user_name":"HelloBug","can_delete":false,"product_type":"c1","uid":1249598,"ip_address":"","ucode":"E61A4AD5C2F724","user_header":"https://static001.geekbang.org/account/avatar/00/13/11/3e/925aa996.jpg","comment_is_top":false,"comment_ctime":1566730724,"is_pvip":true,"replies":[{"id":"47531","content":"APISIX é‡Œé¢æ˜¯åšäº†ä¸€å±‚å°è£…ï¼šcore.table.new()ï¼Œå…¶å®åº•å±‚è¿˜æ˜¯ table.new","user_name":"ä½œè€…å›å¤","user_name_real":"æ¸©é“­@OpenResty","uid":"1017955","ctime":1566868815,"ip_address":"","comment_id":127510,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1566730724","product_id":100028301,"comment_content":"table. cleanå‡½æ•°çš„å®ç°æ˜¯å¾ªç¯éå†æ¯ä¸€ä¸ªå…ƒç´ ï¼Œç„¶åç½®ç©ºï¼Œç›¸æ¯”é‡æ–°åˆ›å»ºä¸€ä¸ªtableæ¥è¯´æ•ˆç‡æ›´é«˜ã€‚è¿™ä¸ªæ˜¯å’Œtableçš„å¤§å°æ— å…³çš„æ˜¯å§ï¼Œtableçš„é‡åˆ©ç”¨çš„æ•ˆç‡æ€»æ˜¯é«˜äºæ–°å»ºä¸€ä¸ªè¡¨æ ¼ã€‚<br>è¿™æ ·ä¹Ÿæœ‰ä¸€ä¸ªè¦æ±‚ï¼Œé‡åˆ©ç”¨çš„tableçš„å¤§å°éœ€è¦æ»¡è¶³å¤šé‡æƒ…å†µã€‚APISIXä¸­çš„è¡¨æ ¼å˜é‡éƒ½æ²¡æœ‰ä½¿ç”¨table. new æ¥åˆ›å»ºï¼Œæ˜¯å› ä¸ºå¤§å°ä¸ç¡®å®šå—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464529,"discussion_content":"APISIX é‡Œé¢æ˜¯åšäº†ä¸€å±‚å°è£…ï¼šcore.table.new()ï¼Œå…¶å®åº•å±‚è¿˜æ˜¯ table.new","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566868815,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127507,"user_name":"HelloBug","can_delete":false,"product_type":"c1","uid":1249598,"ip_address":"","ucode":"E61A4AD5C2F724","user_header":"https://static001.geekbang.org/account/avatar/00/13/11/3e/925aa996.jpg","comment_is_top":false,"comment_ctime":1566730306,"is_pvip":true,"replies":[{"id":"47532","content":"å¤šè°¢","user_name":"ä½œè€…å›å¤","user_name_real":"æ¸©é“­@OpenResty","uid":"1017955","ctime":1566868828,"ip_address":"","comment_id":127507,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1566730306","product_id":100028301,"comment_content":"è€å¸ˆï¼ŒAPISIXä¸­çš„loadå‡½æ•°å°‘ä¸ªend. ","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464528,"discussion_content":"å¤šè°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566868828,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127500,"user_name":"HelloBug","can_delete":false,"product_type":"c1","uid":1249598,"ip_address":"","ucode":"E61A4AD5C2F724","user_header":"https://static001.geekbang.org/account/avatar/00/13/11/3e/925aa996.jpg","comment_is_top":false,"comment_ctime":1566729390,"is_pvip":true,"replies":[{"id":"47627","content":"å¥½çœ¼ç¥ï¼šï¼‰","user_name":"ä½œè€…å›å¤","user_name_real":"æ¸©é“­@OpenResty","uid":"1017955","ctime":1566888941,"ip_address":"","comment_id":127500,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1566729390","product_id":100028301,"comment_content":"è€å¸ˆï¼Œæ–‡ä¸­æœ‰è¿™æ ·ä¸€æ®µè¯ï¼š<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ ç”¨ table.new(narray, nhash) ç”Ÿäº†ä¸€ä¸ªé•¿åº¦ä¸º 100 çš„æ•°ç»„ï¼Œclear åï¼Œé•¿åº¦è¿˜æ˜¯ 100ã€‚<br>å“ˆå“ˆï¼Œç”Ÿäº†ä¸€ä¸ªæ•°ç»„","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464523,"discussion_content":"å¥½çœ¼ç¥ï¼šï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566888941,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127465,"user_name":"HelloBug","can_delete":false,"product_type":"c1","uid":1249598,"ip_address":"","ucode":"E61A4AD5C2F724","user_header":"https://static001.geekbang.org/account/avatar/00/13/11/3e/925aa996.jpg","comment_is_top":false,"comment_ctime":1566723825,"is_pvip":true,"replies":[{"id":"47537","content":"è¿™ä¸ªå‡½æ•°æ˜¯ LuaJIT çš„æ‰©å±•","user_name":"ä½œè€…å›å¤","user_name_real":"æ¸©é“­@OpenResty","uid":"1017955","ctime":1566869029,"ip_address":"","comment_id":127465,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1566723825","product_id":100028301,"comment_content":"è€å¸ˆå¥½ï¼Œæ–‡ç« ä¸­æåˆ°table. new å‡½æ•°å±äºLuaJITçš„æ‰©å±•ï¼Œæ˜¯OpenRestyç»´æŠ¤çš„LuaJITåˆ†æ”¯çš„æ‰©å±•è¿˜æ˜¯å°±æ˜¯LuaJITçš„æ‰©å±•ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464506,"discussion_content":"è¿™ä¸ªå‡½æ•°æ˜¯ LuaJIT çš„æ‰©å±•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566869029,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127462,"user_name":"HelloBug","can_delete":false,"product_type":"c1","uid":1249598,"ip_address":"","ucode":"E61A4AD5C2F724","user_header":"https://static001.geekbang.org/account/avatar/00/13/11/3e/925aa996.jpg","comment_is_top":false,"comment_ctime":1566723161,"is_pvip":true,"replies":[{"id":"47626","content":"æ˜¯çš„ï¼Œå¦‚æœä¸è¶…è¿‡ table.new çš„é¢„è®¾å¤§å°ï¼Œæ˜¯æ²¡æœ‰è¿™äº›æ“ä½œçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æ¸©é“­@OpenResty","uid":"1017955","ctime":1566888917,"ip_address":"","comment_id":127462,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1566723161","product_id":100028301,"comment_content":"è€å¸ˆï¼Œæ•°ç»„ä»¥ç©ºé—´æ¢æ—¶é—´åˆ›å»ºæ—¶ï¼Œåº”è¯¥æ˜¯æ²¡æœ‰resize å’Œrehash æ“ä½œçš„ï¼Œè€Œä¸æ˜¯è¿™äº›æ“ä½œä¸€æ¬¡å®Œæˆçš„æ˜¯å§ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464504,"discussion_content":"æ˜¯çš„ï¼Œå¦‚æœä¸è¶…è¿‡ table.new çš„é¢„è®¾å¤§å°ï¼Œæ˜¯æ²¡æœ‰è¿™äº›æ“ä½œçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566888917,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":123439,"user_name":"è§ä¹ å‹‡è€…","can_delete":false,"product_type":"c1","uid":1039221,"ip_address":"","ucode":"54CF6750E3E454","user_header":"https://static001.geekbang.org/account/avatar/00/0f/db/75/8264d2c3.jpg","comment_is_top":false,"comment_ctime":1565677530,"is_pvip":false,"replies":[{"id":"46084","content":"ç®—æ˜¯ä¸€ä¸ªä¹ æƒ¯äº†ï¼Œå¦‚æœæ˜¯ init worker é˜¶æ®µç¡®å®ä¼˜åŒ–ä¸äº†å¤šå°‘","user_name":"ä½œè€…å›å¤","user_name_real":"æ¸©é“­@OpenResty","uid":"1017955","ctime":1566201139,"ip_address":"","comment_id":123439,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1565677530","product_id":100028301,"comment_content":"é—®è€å¸ˆï¼Œæ‚¨å¥½ï¼Œæˆ‘æœ‰ä¸ªç–‘é—®ï¼Œæ‚¨ä¸¾ä¾‹çš„tableå¤ç”¨çš„é˜¶æ®µæ˜¯åœ¨init_workeré˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µåªä¼šåœ¨åˆå§‹åŒ–workerçš„æ—¶å€™è°ƒç”¨ä¸€æ¬¡ï¼Œå¹¶ä¸ä¼šå½±å“å®é™…çš„è¯·æ±‚ï¼Œæœ‰å¿…è¦è¿›è¡Œè¿™æ ·çš„ä¼˜åŒ–ä¹ˆï¼Ÿå¯¹åç»­çš„è¯·æ±‚å¤„ç†æœ‰æå‡ä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462674,"discussion_content":"ç®—æ˜¯ä¸€ä¸ªä¹ æƒ¯äº†ï¼Œå¦‚æœæ˜¯ init worker é˜¶æ®µç¡®å®ä¼˜åŒ–ä¸äº†å¤šå°‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566201139,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":122711,"user_name":"helloworld","can_delete":false,"product_type":"c1","uid":1105161,"ip_address":"","ucode":"1EECCA0F43E278","user_header":"https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg","comment_is_top":false,"comment_ctime":1565496628,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565496628","product_id":100028301,"comment_content":"è€å¸ˆï¼Œluaæœ€å¤§æ”¯æŒçš„æ•°æ˜¯2çš„53æ¬¡æ–¹ï¼Œé‚£å¦‚ä½•å¤„ç†ipv6åœ°å€ç›¸å…³çš„éœ€æ±‚å‘¢ï¼Œå°±æ˜¯128ä½å¤§æ•°çš„åŠ å‡ä¹˜é™¤ï¼Œæ¯”è¾ƒç­‰è¿ç®—ï¼Œç›®å‰luaå¥½åƒéƒ½ä¸æ”¯æŒï¼Œå¯¹äºè¿™ç§æƒ…å†µæ€ä¹ˆå¤„ç†æ¯”è¾ƒå¥½å‘¢","like_count":0},{"had_liked":false,"id":122543,"user_name":"dingjiayi","can_delete":false,"product_type":"c1","uid":1485477,"ip_address":"","ucode":"DAE189F6FB1B55","user_header":"https://static001.geekbang.org/account/avatar/00/16/aa/a5/194613c1.jpg","comment_is_top":false,"comment_ctime":1565420952,"is_pvip":false,"replies":[{"id":"46062","content":"ä½ å¯ä»¥ä½¿ç”¨ OpenResty çš„ç‰¹æƒè¿›ç¨‹æ¥åšæ—¥å¿—æ–‡ä»¶çš„åˆ‡å‰²ï¼Œç­‰äºè‡ªå·±ç”¨ timer.every æ¥å®ç°äº†crontabçš„åŠŸèƒ½ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æ¸©é“­@OpenResty","uid":"1017955","ctime":1566197017,"ip_address":"","comment_id":122543,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1565420952","product_id":100028301,"comment_content":"æ¸©è€å¸ˆï¼Œæœ‰æ²¡æœ‰æ¯”è¾ƒä¼˜é›…çš„æ–¹å¼å»åˆ‡å‰² access.log å’Œ error.log<br>ç°åœ¨æˆ‘çœ‹åˆ°ç½‘ä¸Šä»‹ç»çš„æ–¹æ¡ˆéƒ½æ˜¯ lograte æˆ–è€…crontab å¯åŠ¨å®šæ—¶ä»»åŠ¡å»åˆ‡å‰²<br>æƒ³è¯·é—®nginx æœ‰è‡ªå¸¦åˆ‡å‰²æ—¥å¿—çš„åŠŸèƒ½å—ï¼Ÿæˆ–è€…æœ‰æ¯”crontab æ›´ä¼˜é›…çš„æ–¹æ¡ˆå—","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462300,"discussion_content":"ä½ å¯ä»¥ä½¿ç”¨ OpenResty çš„ç‰¹æƒè¿›ç¨‹æ¥åšæ—¥å¿—æ–‡ä»¶çš„åˆ‡å‰²ï¼Œç­‰äºè‡ªå·±ç”¨ timer.every æ¥å®ç°äº†crontabçš„åŠŸèƒ½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566197017,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":122316,"user_name":"è®¸ç«¥ç«¥","can_delete":false,"product_type":"c1","uid":1003005,"ip_address":"","ucode":"4B799C0C6BC678","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg","comment_is_top":false,"comment_ctime":1565337652,"is_pvip":false,"replies":[{"id":"46059","content":"æ˜¯çš„ï¼Œå¾ˆå¤šä¼˜åŒ–éƒ½æ˜¯æŠ å‡ºæ¥çš„","user_name":"ä½œè€…å›å¤","user_name_real":"æ¸©é“­@OpenResty","uid":"1017955","ctime":1566196753,"ip_address":"","comment_id":122316,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1565337652","product_id":100028301,"comment_content":"tableä¼˜åŒ–æ€»ç»“ï¼š<br>é¢„å…ˆå®šä¹‰å¤§å°ï¼šç©ºé—´æ¢æ—¶é—´<br>tableæ± ï¼šå¯¹è±¡å¤ç”¨<br>è®¡ç®—ä¸‹æ ‡ï¼šæ”¹è¿›ç®—æ³•","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462203,"discussion_content":"æ˜¯çš„ï¼Œå¾ˆå¤šä¼˜åŒ–éƒ½æ˜¯æŠ å‡ºæ¥çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566196753,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":122121,"user_name":"é˜³å…‰æ¢¦","can_delete":false,"product_type":"c1","uid":1283965,"ip_address":"","ucode":"55BDA128D39931","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/TTPicMEZ5s1zKiaKYecIljicRV9dibITPM0958W3VuNHXlTQic2Dj6XYGibF7dqrG3JWr0LMx7hY9zXGzuvTDNGw8KAA/132","comment_is_top":false,"comment_ctime":1565307613,"is_pvip":false,"replies":[{"id":"46077","content":"è¿™é‡Œé¢è®²çš„ä¼˜åŒ–æ–¹æ³•ï¼Œæ˜¯é€‚ç”¨äº LuaJIT çš„","user_name":"ä½œè€…å›å¤","user_name_real":"æ¸©é“­@OpenResty","uid":"1017955","ctime":1566200190,"ip_address":"","comment_id":122121,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1565307613","product_id":100028301,"comment_content":"æ‚¨å¥½ï¼Œä½¿ç”¨æ ‡å‡†nginxå’Œluajitï¼Œæœ‰æ²¡æœ‰æ‚¨è¯´çš„è¿™æ ·ä¼˜åŒ–æ–¹æ³•ï¼Ÿè°¢è°¢","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462109,"discussion_content":"è¿™é‡Œé¢è®²çš„ä¼˜åŒ–æ–¹æ³•ï¼Œæ˜¯é€‚ç”¨äº LuaJIT çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566200190,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1105161,"avatar":"https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg","nickname":"helloworld","note":"","ucode":"1EECCA0F43E278","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4715,"discussion_content":"æ²¡æœ‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565684523,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}