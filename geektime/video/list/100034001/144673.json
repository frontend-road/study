{"id":144673,"title":"54 | 逃逸闭包和自动闭包","content":"<p><strong>课件地址</strong></p><p><a href=\"https://gitee.com/geektime-geekbang/swift-course\">https://gitee.com/geektime-geekbang/swift-course</a></p>","comments":[{"had_liked":false,"id":161630,"user_name":"Geek_jg3r26","can_delete":false,"product_type":"c3","uid":1454691,"ip_address":"","ucode":"7D093ED7273CBE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEK5icO2A4K7HYTYfQoagTz7VbtgxfS2ibBqLnKVWwQZgsePibZWFvFJEhPT8BtpQSaFx9IEodyp6c0dw/132","comment_is_top":false,"comment_ctime":1576253090,"is_pvip":false,"replies":[{"id":62432,"content":"@autoclosure是要传可计算&#47;执行表达式的，后面加（）才是一个可计算&#47;执行的表达式，要么就不加@autoclosure，你可以传闭包进去\n","user_name":"作者回复","user_name_real":"Geek_f72435","uid":1341726,"ctime":1576935016,"ip_address":"","comment_id":161630,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"老师，在使用 @autoclosure @escaping  修饰的时候。 \nfunc collection(proivder: @autoclosure @escaping () -&gt; String) {\n    proivders.append(proivder)\n}\ncollection( proivder: { names.remove(at: 0) }() )\n给参数传递闭包 ， 需要在花括号后边跟一对括号， 这个是什么意思呢？","like_count":0,"discussions":[{"author":{"id":1341726,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLxtKhpmvzx2VB4iajicfJVFmQR3eP3xBpdpQEovpSqUfAOrNImvYwVb7P37ibI0ONziau9sbFEk8oDaA/132","nickname":"elfgate","note":"","ucode":"3C0B5F7C1F664C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477791,"discussion_content":"@autoclosure是要传可计算/执行表达式的，后面加（）才是一个可计算/执行的表达式，要么就不加@autoclosure，你可以传闭包进去\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576935016,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":158695,"user_name":"Geek_35f801","can_delete":false,"product_type":"c3","uid":1729978,"ip_address":"","ucode":"3FA7ECDA1AA6A7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/IOlCQLibBNeD6whW8YgrOvZnsqiayp519TuMpxc4k5vPlaO2OtqCicU87utPBrsyjJ5FGxh3cGZTquaJwn9U7gecA/132","comment_is_top":false,"comment_ctime":1575435794,"is_pvip":false,"replies":[{"id":61082,"content":"给全局变量添加一个非逃逸的闭包是指？","user_name":"作者回复","user_name_real":"Geek_f72435","uid":1341726,"ctime":1575863597,"ip_address":"","comment_id":158695,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"老师 在函数里为什么不能给全局变量添加一个非逃逸的闭包呢？添加一个逃逸闭包有什么好处吗","like_count":0,"discussions":[{"author":{"id":1341726,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLxtKhpmvzx2VB4iajicfJVFmQR3eP3xBpdpQEovpSqUfAOrNImvYwVb7P37ibI0ONziau9sbFEk8oDaA/132","nickname":"elfgate","note":"","ucode":"3C0B5F7C1F664C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476816,"discussion_content":"给全局变量添加一个非逃逸的闭包是指？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575863597,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":299499,"user_name":"欢乐马","can_delete":false,"product_type":"c3","uid":2667111,"ip_address":"","ucode":"04341E375C7885","user_header":"https://static001.geekbang.org/account/avatar/00/28/b2/67/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1624681901,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"感觉自动闭包这种语法糖会降低代码的可读性，开发可能需要提前制定好使用规范。","like_count":3},{"had_liked":false,"id":361846,"user_name":"猪小擎","can_delete":false,"product_type":"c3","uid":1370959,"ip_address":"北京","ucode":"D9552746AE3327","user_header":"https://static001.geekbang.org/account/avatar/00/14/eb/4f/6a97b1cd.jpg","comment_is_top":false,"comment_ctime":1667911807,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"没看出escaping的意义，闭包当然是函数返回之后执行了，去掉@escaping也没看到任何影响。","like_count":0},{"had_liked":false,"id":307052,"user_name":"Arthur","can_delete":false,"product_type":"c3","uid":1377724,"ip_address":"","ucode":"A67D2D300E1DB1","user_header":"https://static001.geekbang.org/account/avatar/00/15/05/bc/850ae73c.jpg","comment_is_top":false,"comment_ctime":1628841175,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"这是一门神奇的语言","like_count":0},{"had_liked":false,"id":292575,"user_name":"Geek__2099","can_delete":false,"product_type":"c3","uid":1457784,"ip_address":"","ucode":"01444B60F18A66","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep8unibCib9rdHib0D6Rf6TjecPQu1yic0G9sjzriczlTcwGHP6DaxtEmHyN7pCrD9zV7OSegyf7EUBvaA/132","comment_is_top":false,"comment_ctime":1620882426,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"\n逃逸这个词，借用了这样的场景：星球通过引力拉住了某个参数石头，本来石头要落体到星球上并将自己展开，但是石头获得了特殊动能，在落地之前，成功起飞并逃脱了星球引力，重获自由。\n显然，逃逸闭包，在吸引函数的体内没有执行，因此它不是吸引函数的动作组成部分。\n那么在函数中引入逃逸闭包的作用是什么？\n只有一条：函数可以将闭包作为一种实体，而非动作本身来进行处理，即对动作的记忆。\n\n所以，逃逸闭包，其实是将闭包看作一种实体而非动作而诞生的，即闭包也可以成为状态，并被存储。\n比如在现实中，肌肉的动作记忆也是一种逃逸闭包。\n\n自动闭包，是一种函数参数类型为闭包时的语法糖，是将程序语言简化为近人语言的手段。\n自动闭包可以延迟处理，不是因为自动，而是因为是闭包。\n \n那么，闭包作为参数时，为什么会同时出现延迟处理这种机制？\n由前得知，闭包作为参数时，可能逃逸，也可能不逃逸。\n而是否逃逸，关键是闭包是否构成吸引函数的动作组成部分，也就是闭包是否在函数体内被调用执行。\n这个调用执行，必然是显式发生，即b()的语法必须出现在函数体内。\n因此，在闭包作为参数传递的过程中，必然不能执行。\n所以延迟执行这个词语，不是说延迟一段时间再执行，而是说 要执行只能在函数体内或者函数体外，在参数领域这个非军事化区中，闭包也只是个数据而已。\n\n\n\n\n\n\n\n\n\n\n\n\n\n","like_count":0}]}