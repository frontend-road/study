{"id":90546,"title":"16 | æ€§èƒ½ç›‘æ§ï¼šè¡¡é‡ App è´¨é‡çš„é‚£æŠŠå°º","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æˆ´é“­ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼ŒApp çš„æ€§èƒ½é—®é¢˜è™½ç„¶ä¸ä¼šå¯¼è‡´ Appä¸å¯ç”¨ï¼Œä½†ä¾ç„¶ä¼šå½±å“åˆ°ç”¨æˆ·ä½“éªŒã€‚å¦‚æœè¿™ä¸ªæ€§èƒ½é—®é¢˜ä¸æ–­ç´¯ç§¯ï¼Œè¾¾åˆ°ä¸´ç•Œç‚¹ä»¥åï¼Œé—®é¢˜å°±ä¼šçˆ†å‘å‡ºæ¥ã€‚è¿™æ—¶ï¼Œå½±å“åˆ°çš„å°±ä¸ä»…ä»…æ˜¯ç”¨æˆ·äº†ï¼Œè¿˜æœ‰è´Ÿè´£Appå¼€å‘çš„ä½ ã€‚</p><p>ä¸ºäº†èƒ½å¤Ÿä¸»åŠ¨ã€é«˜æ•ˆåœ°å‘ç°æ€§èƒ½é—®é¢˜ï¼Œé¿å…Appè´¨é‡è¿›å…¥æ— äººç›‘ç®¡çš„å¤±æ§çŠ¶æ€ï¼Œæˆ‘ä»¬å°±éœ€è¦å¯¹Appçš„æ€§èƒ½è¿›è¡Œç›‘æ§ã€‚ç›®å‰ï¼Œå¯¹Appçš„æ€§èƒ½ç›‘æ§ï¼Œä¸»è¦æ˜¯ä»çº¿ä¸‹å’Œçº¿ä¸Šä¸¤ä¸ªç»´åº¦å±•å¼€ã€‚</p><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å°±ä»è¿™ä¸¤ä¸ªæ–¹é¢æ¥å’Œä½ èŠèŠå¦‚ä½•åšæ€§èƒ½ç›‘æ§è¿™ä¸ªè¯é¢˜ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å…ˆçœ‹çœ‹è‹¹æœå®˜æ–¹çš„çº¿ä¸‹æ€§èƒ½ç›‘æ§ç‹ç‰Œ Instrumentsã€‚</p><h2>Instruments</h2><p>å…³äºçº¿ä¸‹æ€§èƒ½ç›‘æ§ï¼Œè‹¹æœå…¬å¸å®˜æ–¹å°±æœ‰ä¸€ä¸ªæ€§èƒ½ç›‘æ§å·¥å…·Instrumentsã€‚å®ƒæ˜¯ä¸€æ¬¾è¢«é›†æˆåœ¨ Xcode é‡Œï¼Œä¸“é—¨ç”¨æ¥åœ¨çº¿ä¸‹è¿›è¡Œæ€§èƒ½åˆ†æçš„å·¥å…·ã€‚</p><p>Instrumentsçš„åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œæ¯”å¦‚è¯´Energy Logå°±æ˜¯ç”¨æ¥ç›‘æ§è€—ç”µé‡çš„ï¼ŒLeakså°±æ˜¯ä¸“é—¨ç”¨æ¥ç›‘æ§å†…å­˜æ³„éœ²é—®é¢˜çš„ï¼ŒNetworkå°±æ˜¯ç”¨æ¥ä¸“é—¨æ£€æŸ¥ç½‘ç»œæƒ…å†µçš„ï¼ŒTime Profilerå°±æ˜¯é€šè¿‡æ—¶é—´é‡‡æ ·æ¥åˆ†æé¡µé¢å¡é¡¿é—®é¢˜çš„ã€‚</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå°±æ˜¯Instrumentsçš„å„ç§æ€§èƒ½æ£€æµ‹å·¥å…·ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/08/e9/087ddcf91e5c222804f753389edf2de9.png?wh=1690*3410\" alt=\"\"></p><center><span class=\"reference\">å›¾1 Instruments æä¾›çš„å„ç§æ€§èƒ½æ£€æµ‹å·¥å…·</span></center><!-- [[[read_end]]] --><p>é™¤äº†å¯¹å„ç§æ€§èƒ½é—®é¢˜è¿›è¡Œç›‘æ§å¤–ï¼Œ<strong>æœ€æ–°ç‰ˆæœ¬çš„Instruments 10è¿˜æœ‰ä»¥ä¸‹ä¸¤å¤§ä¼˜åŠ¿</strong>ï¼š</p><ol>\n<li>\n<p>InstrumentsåŸºäºos_signpost æ¶æ„ï¼Œå¯ä»¥æ”¯æŒæ‰€æœ‰å¹³å°ã€‚</p>\n</li>\n<li>\n<p>Instrumentsç”±äºæ ‡å‡†ç•Œé¢ï¼ˆStandard UIï¼‰å’Œåˆ†ææ ¸å¿ƒï¼ˆAnalysis Coreï¼‰æŠ€æœ¯ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥éå¸¸æ–¹ä¾¿åœ°è¿›è¡Œè‡ªå®šä¹‰æ€§èƒ½ç›‘æµ‹å·¥å…·çš„å¼€å‘ã€‚å½“ä½ æƒ³è¦ç»™Instrumentså†…ç½®çš„å·¥å…·æ¢ä¸ªäº¤äº’ç•Œé¢ï¼Œæˆ–è€…æ–°åˆ›å»ºä¸€ä¸ªå·¥å…·çš„æ—¶å€™ï¼Œéƒ½å¯ä»¥é€šè¿‡è‡ªå®šä¹‰å·¥å…·è¿™ä¸ªåŠŸèƒ½æ¥å®ç°ã€‚</p>\n</li>\n</ol><p>å…¶å®ï¼ŒInstrumentsçš„è¿™äº›ä¼˜åŠ¿ä¹Ÿä¸æ˜¯ä¸ç”Ÿä¿±æ¥çš„ï¼Œéƒ½æ˜¯ä¼´éšç€ç§»åŠ¨å¼€å‘æŠ€æœ¯çš„å‘å±•è€Œæ¼”è¿›æ¥çš„ã€‚å°±æ¯”å¦‚è¯´è‡ªå®šä¹‰å·¥å…·çš„åŠŸèƒ½å§ï¼Œè¿™æ˜¯å› ä¸ºAppçš„è§„æ¨¡è¶Šæ¥è¶Šå¤§ï¼Œå¾€å¾€è¿˜æ¶‰åŠåˆ°å¤šä¸ªå›¢é˜Ÿåˆä½œå¼€å‘ã€é›†æˆå¤šä¸ªå…¬å¸SDKçš„æƒ…å†µï¼Œæ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦ä»¥é»‘ç›’çš„æ–¹å¼æ¥è¿›è¡Œæ€§èƒ½ç›‘æ§ã€‚è¿™æ ·çš„éœ€æ±‚ï¼Œä¹Ÿå°±è¿«ä½¿è‹¹æœå…¬å¸è¦ä¸æ–­åœ°å¢å¼ºInstrumentsçš„åŠŸèƒ½ã€‚</p><p>ä»æ•´ä½“æ¶æ„æ¥çœ‹ï¼ŒInstruments åŒ…æ‹¬Standard UI å’Œ Analysis Core ä¸¤ä¸ªç»„ä»¶ï¼Œå®ƒçš„æ‰€æœ‰å·¥å…·éƒ½æ˜¯åŸºäºè¿™ä¸¤ä¸ªç»„ä»¶å¼€å‘çš„ã€‚è€Œä¸”ï¼Œä½ å¦‚æœè¦å¼€å‘è‡ªå®šä¹‰çš„æ€§èƒ½åˆ†æå·¥å…·çš„è¯ï¼Œå®Œå…¨åŸºäºè¿™ä¸¤ä¸ªç»„ä»¶å°±å¯ä»¥å®ç°ã€‚</p><p><strong>å¼€å‘ä¸€æ¬¾è‡ªå®šä¹‰Instrumentså·¥å…·</strong>ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹è¿™å‡ ä¸ªæ­¥éª¤ï¼š</p><ol>\n<li>\n<p>åœ¨Xcodeä¸­ï¼Œç‚¹å‡»File &gt; New &gt; Projectï¼›</p>\n</li>\n<li>\n<p>åœ¨å¼¹å‡ºçš„Projectæ¨¡æ¿é€‰æ‹©ç•Œé¢ï¼Œå°†å…¶è®¾ç½®ä¸ºmacOSï¼›</p>\n</li>\n<li>\n<p>é€‰æ‹© Instruments Packageï¼Œç‚¹å‡»åå³å¯å¼€å§‹è‡ªå®šä¹‰å·¥å…·çš„å¼€å‘äº†ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>\n</li>\n</ol><p><img src=\"https://static001.geekbang.org/resource/image/e5/be/e51d838fda0c79ff0a48566ec87305be.png?wh=1436*1034\" alt=\"\"></p><center><span class=\"reference\">å›¾2 å¼€å‘è‡ªå®šä¹‰Instrumentå·¥å…·</span></center><p>ç»è¿‡ä¸Šé¢çš„ä¸‰æ­¥ä¹‹åï¼Œä¼šåœ¨æ–°åˆ›å»ºçš„å·¥ç¨‹é‡Œé¢ç”Ÿæˆä¸€ä¸ª.instrpkg æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥çš„å¼€å‘è¿‡ç¨‹ä¸»è¦å°±æ˜¯å¯¹è¿™ä¸ªæ–‡ä»¶çš„é…ç½®å·¥ä½œäº†ã€‚è¿™äº›é…ç½®å·¥ä½œä¸­æœ€ä¸»è¦çš„æ˜¯è¦å®ŒæˆStandard UI å’Œ Analysis Core çš„é…ç½®ã€‚</p><p>ä¸Šé¢è¿™äº›å†…å®¹ï¼Œå°±æ˜¯ä½ åœ¨å¼€å‘ä¸€ä¸ªè‡ªå®šä¹‰Instrumentså·¥å…·æ—¶ï¼Œéœ€è¦å®Œæˆçš„ç¼–ç å·¥ä½œäº†ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒInstruments 10ç‰ˆæœ¬çš„è‡ªå®šä¹‰å·¥å…·å¼€å‘è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚ä¸æ­¤åŒæ—¶ï¼Œè‹¹æœå…¬å¸è¿˜æä¾›äº†å¤§é‡çš„ä»£ç ç‰‡æ®µï¼Œå¸®åŠ©ä½ è¿›è¡Œä¸ªæ€§åŒ–çš„é…ç½®ã€‚ä½ å¯ä»¥<a href=\"https://help.apple.com/instruments/developer/mac/current/\">ç‚¹å‡»è¿™ä¸ªé“¾æ¥</a>ï¼ŒæŸ¥çœ‹å®˜æ–¹æŒ‡å—ä¸­çš„è¯¦ç»†æ•™ç¨‹ã€‚</p><p>å¦‚æœä½ æƒ³è¦æ›´å¥½åœ°è¿›è¡Œä¸ªæ€§åŒ–å®šåˆ¶ï¼Œå°±è¿˜éœ€è¦å†äº†è§£Instrumentsæ”¶é›†å’Œå¤„ç†æ•°æ®çš„æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯<strong>åˆ†ææ ¸å¿ƒï¼ˆAnalysis Core ï¼‰çš„å·¥ä½œåŸç†</strong>ã€‚</p><p>Analysis Coreæ”¶é›†å’Œå¤„ç†æ•°æ®çš„è¿‡ç¨‹ï¼Œå¯ä»¥å¤§è‡´åˆ†ä¸ºä»¥ä¸‹è¿™ä¸‰æ­¥ï¼š</p><ol>\n<li>\n<p>å¤„ç†æˆ‘ä»¬é…ç½®å¥½çš„å„ç§æ•°æ®è¡¨ï¼Œå¹¶ç”³è¯·å­˜å‚¨ç©ºé—´ storeï¼›</p>\n</li>\n<li>\n<p>storeå»æ‰¾æ•°æ®æä¾›è€…ï¼Œå¦‚æœä¸èƒ½ç›´æ¥æ‰¾åˆ°ï¼Œå°±ä¼šé€šè¿‡ Modeler æ¥æ”¶å…¶ä»–store çš„è¾“å…¥ä¿¡å·è¿›è¡Œåˆæˆï¼›</p>\n</li>\n<li>\n<p>store è·å¾—æ•°æ®æºåï¼Œä¼šè¿›è¡Œ Binding Solution å·¥ä½œæ¥ä¼˜åŒ–æ•°æ®å¤„ç†è¿‡ç¨‹ã€‚</p>\n</li>\n</ol><p>è¿™é‡Œéœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œåœ¨æˆ‘ä»¬é€šè¿‡storeæ‰¾åˆ°çš„è¿™äº›æ•°æ®æä¾›è€…ä¸­ï¼Œå¯¹å¼€å‘è€…æ¥è¯´æœ€é‡è¦çš„å°±æ˜¯ os_signpostã€‚os_signpost çš„ä¸»è¦ä½œç”¨ï¼Œæ˜¯è®©ä½ å¯ä»¥åœ¨ç¨‹åºä¸­é€šè¿‡ç¼–å†™ä»£ç æ¥è·å–æ•°æ®ã€‚ä½ å¯ä»¥åœ¨å·¥ç¨‹ä¸­çš„ä»»ä½•åœ°æ–¹é€šè¿‡ os_signpost API ï¼Œå°†éœ€è¦çš„æ•°æ®æä¾›ç»™ Analysis Coreã€‚</p><p>è‹¹æœå…¬å¸åœ¨ WWDC 2018 Session 410 <a href=\"https://developer.apple.com/videos/play/wwdc2018/410\">Creating Custom Instruments</a> é‡Œæä¾›äº†ä¸€ä¸ªèŒƒä¾‹ï¼šé€šè¿‡ os_signpost API å°†å›¾ç‰‡ä¸‹è½½çš„æ•°æ®æä¾›ç»™ Analysis Core è¿›è¡Œç›‘æ§è§‚å¯Ÿã€‚è¿™ä¸ªç¤ºä¾‹åœ¨ App çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>os_signpost(.begin, log: parsinglog, name:&quot;Parsing&quot;, &quot;Parsing started SIZE:%ld&quot;, data.count)\n// Decode the JSON we just downloaded\nlet result = try jsonDecoder.decode(Trail.self, from: data)\nos_signpost(.end, log: parsingLog, name:&quot;Parsing&quot;, &quot;Parsing finished&quot;)\n</code></pre><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šé¢ä»£ç ä¸­ï¼Œos_signpost çš„ begin å’Œ end éœ€è¦æˆå¯¹å‡ºç°ã€‚</p><p>ä¸Šé¢è¿™æ®µä»£ç å°±æ˜¯ä½¿ç”¨ os_signpost çš„ API è·å–äº†ç¨‹åºé‡Œçš„æ•°æ®ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†çœ‹çœ‹ Instruments æ˜¯å¦‚ä½•é€šè¿‡é…ç½®æ•°æ®è¡¨æ¥ä½¿ç”¨è¿™äº›æ•°æ®çš„ã€‚é…ç½®çš„æ•°æ®è¡¨çš„ XML è®¾è®¡å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>&lt;os-signpost-interval-schema&gt;\n&lt;id&gt;json-parse&lt;/id&gt;\n&lt;title&gt;Image Download&lt;/title&gt;\n&lt;subsystem&gt;&quot;com.apple.trailblazer&lt;/subsystem&gt;\n&lt;category&gt;&quot;Networking&lt;/category&gt;\n&lt;name&gt;&quot;Parsing&quot;&lt;/name&gt;\n&lt;start-pattern&gt;\n&lt;message&gt;&quot;Parsing started SIZE:&quot; ?data-size&lt;/message&gt; \n&lt;/start-pattern&gt;\n&lt;column&gt;\n&lt;mnemonic&gt;data-size&lt;/mnemonic&gt;\n&lt;title&gt;JSON Data Size&lt;/title&gt;\n&lt;type&gt;size-in-bytes&lt;/type&gt;\n&lt;expression&gt;?data-size&lt;/expression&gt;\n&lt;/column&gt;\n&lt;/os-signpost-interval-schema&gt;\n</code></pre><p>è¿™é‡Œï¼Œæˆ‘ä»¬é…ç½®æ•°æ®è¡¨æ˜¯è¦å¯¹æ•°æ®è¾“å‡ºè¿›è¡Œå¯è§†åŒ–é…ç½®ï¼Œä»è€Œå¯ä»¥å°†ä»£ç ä¸­çš„æ•°æ®å±•ç¤ºå‡ºæ¥ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå°±æ˜¯å¯¹ä¸‹è½½å›¾ç‰‡å¤§å°ç›‘æ§çš„æ•ˆæœã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/cd/b2/cdf512c900bac905b21d28202386b8b2.png?wh=1482*997\" alt=\"\"></p><center><span class=\"reference\">å›¾3 å¯¹ä¸‹è½½å›¾ç‰‡å¤§å°çš„ç›‘æ§</span></center><p>é€šè¿‡ä¸Šé¢çš„åˆ†ææˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒInstruments 10é€šè¿‡æä¾› os_signpost API çš„æ–¹å¼ä½¿å¾—å¼€å‘è€…ç›‘æ§è‡ªå®šä¹‰çš„æ€§èƒ½æŒ‡æ ‡æ—¶æ›´æ–¹ä¾¿ï¼Œä»è€Œè§£å†³äº†åœ¨æ­¤ä¹‹å‰åªèƒ½é€šè¿‡é‡æ–°å»ºè®¾å·¥å…·æ¥å®Œæˆçš„é—®é¢˜ã€‚å¹¶ä¸”ï¼ŒInstrumentsé€šè¿‡ XML æ ‡å‡†æ•°æ®æ¥å£è§£è€¦å±•ç¤ºå’Œæ•°æ®åˆ†æçš„æ€è·¯ï¼Œä¹Ÿéå¸¸å€¼å¾—æˆ‘ä»¬å€Ÿé‰´å’Œå­¦ä¹ ã€‚</p><p>åœ¨çº¿ä¸‹æ€§èƒ½ç›‘æ§ä¸­ï¼ŒInstrumentså¯ä»¥è¯´æ˜¯ç‹è€…ï¼Œä½†å´å¯¹çº¿ä¸Šç›‘æ§æ— èƒ½ä¸ºåŠ›ã€‚é‚£ä¹ˆï¼Œå¯¹äºçº¿ä¸Šçš„æ€§èƒ½ç›‘æ§ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆå®ç°å‘¢ï¼Ÿ</p><h2>çº¿ä¸Šæ€§èƒ½ç›‘æ§</h2><p>å¯¹äºçº¿ä¸Šæ€§èƒ½ç›‘æ§ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ˜ç™½ä¸¤ä¸ªåŸåˆ™ï¼š</p><ol>\n<li>\n<p>ç›‘æ§ä»£ç ä¸è¦ä¾µå…¥åˆ°ä¸šåŠ¡ä»£ç ä¸­ï¼›</p>\n</li>\n<li>\n<p>é‡‡ç”¨æ€§èƒ½æ¶ˆè€—æœ€å°çš„ç›‘æ§æ–¹æ¡ˆã€‚</p>\n</li>\n</ol><p>çº¿ä¸Šæ€§èƒ½ç›‘æ§ï¼Œä¸»è¦é›†ä¸­åœ¨CPUä½¿ç”¨ç‡ã€FPSçš„å¸§ç‡å’Œå†…å­˜è¿™ä¸‰ä¸ªæ–¹é¢ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±åˆ†åˆ«ä»è¿™ä¸‰ä¸ªæ–¹é¢å±•å¼€è®¨è®ºå§ã€‚</p><h3>CPUä½¿ç”¨ç‡çš„çº¿ä¸Šç›‘æ§æ–¹æ³•</h3><p>Appä½œä¸ºè¿›ç¨‹è¿è¡Œèµ·æ¥åä¼šæœ‰å¤šä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹å¯¹CPU çš„ä½¿ç”¨ç‡ä¸åŒã€‚å„ä¸ªçº¿ç¨‹å¯¹CPUä½¿ç”¨ç‡çš„æ€»å’Œï¼Œå°±æ˜¯å½“å‰Appå¯¹CPU çš„ä½¿ç”¨ç‡ã€‚æ˜ç™½äº†è¿™ä¸€ç‚¹ä»¥åï¼Œæˆ‘ä»¬ä¹Ÿå°±æ‘¸æ¸…æ¥šäº†å¯¹CPUä½¿ç”¨ç‡è¿›è¡Œçº¿ä¸Šç›‘æ§çš„æ€è·¯ã€‚</p><p>åœ¨iOSç³»ç»Ÿä¸­ï¼Œä½ å¯ä»¥åœ¨ usr/include/mach/thread_info.h é‡Œçœ‹åˆ°çº¿ç¨‹åŸºæœ¬ä¿¡æ¯çš„ç»“æ„ä½“ï¼Œå…¶ä¸­çš„cpu_usage å°±æ˜¯ CPUä½¿ç”¨ç‡ã€‚ç»“æ„ä½“çš„å®Œæ•´ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>struct thread_basic_info {\n  time_value_t    user_time;     // ç”¨æˆ·è¿è¡Œæ—¶é•¿\n  time_value_t    system_time;   // ç³»ç»Ÿè¿è¡Œæ—¶é•¿\n  integer_t       cpu_usage;     // CPU ä½¿ç”¨ç‡\n  policy_t        policy;        // è°ƒåº¦ç­–ç•¥\n  integer_t       run_state;     // è¿è¡ŒçŠ¶æ€\n  integer_t       flags;         // å„ç§æ ‡è®°\n  integer_t       suspend_count; // æš‚åœçº¿ç¨‹çš„è®¡æ•°\n  integer_t       sleep_time;    // ä¼‘çœ çš„æ—¶é—´\n};\n</code></pre><p>å› ä¸ºæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰è¿™ä¸ª thread_basic_info ç»“æ„ä½“ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥çš„äº‹æƒ…å°±å¥½åŠäº†ï¼Œä½ åªéœ€è¦å®šæ—¶ï¼ˆæ¯”å¦‚ï¼Œå°†å®šæ—¶é—´éš”è®¾ç½®ä¸º2sï¼‰å»éå†æ¯ä¸ªçº¿ç¨‹ï¼Œç´¯åŠ æ¯ä¸ªçº¿ç¨‹çš„ cpu_usage å­—æ®µçš„å€¼ï¼Œå°±èƒ½å¤Ÿå¾—åˆ°å½“å‰Appæ‰€åœ¨è¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡äº†ã€‚å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>+ (integer_t)cpuUsage {\n    thread_act_array_t threads; //int ç»„æˆçš„æ•°ç»„æ¯”å¦‚ thread[1] = 5635\n    mach_msg_type_number_t threadCount = 0; //mach_msg_type_number_t æ˜¯ int ç±»å‹\n    const task_t thisTask = mach_task_self();\n    //æ ¹æ®å½“å‰ task è·å–æ‰€æœ‰çº¿ç¨‹\n    kern_return_t kr = task_threads(thisTask, &amp;threads, &amp;threadCount);\n    \n    if (kr != KERN_SUCCESS) {\n        return 0;\n    }\n    \n    integer_t cpuUsage = 0;\n    // éå†æ‰€æœ‰çº¿ç¨‹\n    for (int i = 0; i &lt; threadCount; i++) {\n        \n        thread_info_data_t threadInfo;\n        thread_basic_info_t threadBaseInfo;\n        mach_msg_type_number_t threadInfoCount = THREAD_INFO_MAX;\n        \n        if (thread_info((thread_act_t)threads[i], THREAD_BASIC_INFO, (thread_info_t)threadInfo, &amp;threadInfoCount) == KERN_SUCCESS) {\n            // è·å– CPU ä½¿ç”¨ç‡\n            threadBaseInfo = (thread_basic_info_t)threadInfo;\n            if (!(threadBaseInfo-&gt;flags &amp; TH_FLAGS_IDLE)) {\n                cpuUsage += threadBaseInfo-&gt;cpu_usage;\n            }\n        }\n    }\n    assert(vm_deallocate(mach_task_self(), (vm_address_t)threads, threadCount * sizeof(thread_t)) == KERN_SUCCESS);\n    return cpuUsage;\n}\n</code></pre><p>åœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œtask_threads æ–¹æ³•èƒ½å¤Ÿå–åˆ°å½“å‰è¿›ç¨‹ä¸­çš„çº¿ç¨‹æ€»æ•° threadCount å’Œæ‰€æœ‰çº¿ç¨‹çš„æ•°ç»„ threadsã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡éå†è¿™ä¸ªæ•°ç»„æ¥è·å–å•ä¸ªçº¿ç¨‹çš„åŸºæœ¬ä¿¡æ¯ã€‚å…¶ä¸­ï¼Œçº¿ç¨‹åŸºæœ¬ä¿¡æ¯çš„ç»“æ„ä½“æ˜¯ thread_basic_info_tï¼Œè¿™ä¸ªç»“æ„ä½“é‡Œå°±åŒ…å«äº†æˆ‘ä»¬éœ€è¦çš„ CPU ä½¿ç”¨ç‡çš„å­—æ®µ cpu_usageã€‚ç„¶åï¼Œæˆ‘ä»¬ç´¯åŠ è¿™ä¸ªå­—æ®µå°±èƒ½å¤Ÿè·å–åˆ°å½“å‰çš„æ•´ä½“ CPU ä½¿ç”¨ç‡ã€‚</p><p>åˆ°æ­¤ï¼Œæˆ‘ä»¬å°±å®ç°äº†å¯¹CPUä½¿ç”¨ç‡çš„çº¿ä¸Šç›‘æ§ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†çœ‹çœ‹å¯¹FPSçš„çº¿ä¸Šç›‘æ§æ–¹æ³•å§ã€‚</p><h3>FPS çº¿ä¸Šç›‘æ§æ–¹æ³•</h3><p>FPS æ˜¯æŒ‡å›¾åƒè¿ç»­åœ¨æ˜¾ç¤ºè®¾å¤‡ä¸Šå‡ºç°çš„é¢‘ç‡ã€‚FPSä½ï¼Œè¡¨ç¤ºAppä¸å¤Ÿæµç•…ï¼Œè¿˜éœ€è¦è¿›è¡Œä¼˜åŒ–ã€‚</p><p>ä½†æ˜¯ï¼Œå’Œå‰é¢å¯¹CPUä½¿ç”¨ç‡å’Œå†…å­˜ä½¿ç”¨é‡çš„ç›‘æ§ä¸åŒï¼ŒiOSç³»ç»Ÿä¸­æ²¡æœ‰ä¸€ä¸ªä¸“é—¨çš„ç»“æ„ä½“ï¼Œç”¨æ¥è®°å½•ä¸FPSç›¸å…³çš„æ•°æ®ã€‚ä½†æ˜¯ï¼Œå¯¹FPSçš„ç›‘æ§ä¹Ÿå¯ä»¥æ¯”è¾ƒç®€å•çš„å®ç°ï¼šé€šè¿‡æ³¨å†Œ CADisplayLink å¾—åˆ°å±å¹•çš„åŒæ­¥åˆ·æ–°ç‡ï¼Œè®°å½•æ¯æ¬¡åˆ·æ–°æ—¶é—´ï¼Œç„¶åå°±å¯ä»¥å¾—åˆ° FPSã€‚å…·ä½“çš„å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>- (void)start {\n    self.dLink = [CADisplayLink displayLinkWithTarget:self selector:@selector(fpsCount:)];\n    [self.dLink addToRunLoop:[NSRunLoop mainRunLoop] forMode:NSRunLoopCommonModes];\n}\n\n// æ–¹æ³•æ‰§è¡Œå¸§ç‡å’Œå±å¹•åˆ·æ–°ç‡ä¿æŒä¸€è‡´\n- (void)fpsCount:(CADisplayLink *)displayLink {\n    if (lastTimeStamp == 0) {\n        lastTimeStamp = self.dLink.timestamp;\n    } else {\n        total++;\n        // å¼€å§‹æ¸²æŸ“æ—¶é—´ä¸ä¸Šæ¬¡æ¸²æŸ“æ—¶é—´å·®å€¼\n        NSTimeInterval useTime = self.dLink.timestamp - lastTimeStamp;\n        if (useTime &lt; 1) return;\n        lastTimeStamp = self.dLink.timestamp;\n        // fps è®¡ç®—\n        fps = total / useTime; \n        total = 0;\n    }\n}\n</code></pre><h3>å†…å­˜ä½¿ç”¨é‡çš„çº¿ä¸Šç›‘æ§æ–¹æ³•</h3><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åœ¨è·å– iOS åº”ç”¨å†…å­˜ä½¿ç”¨é‡æ—¶ï¼Œéƒ½æ˜¯ä½¿ç”¨task_basic_info é‡Œçš„ resident_size å­—æ®µä¿¡æ¯ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å‘ç°è¿™æ ·è·å¾—çš„å†…å­˜ä½¿ç”¨é‡å’Œ Instruments é‡Œçœ‹åˆ°çš„ç›¸å·®å¾ˆå¤§ã€‚åæ¥ï¼Œåœ¨ 2018 WWDC Session 416 <a href=\"https://developer.apple.com/videos/play/wwdc2018/416/\">iOS Memory Deep Dive</a>ä¸­ï¼Œè‹¹æœå…¬å¸ä»‹ç»è¯´ phys_footprint æ‰æ˜¯å®é™…ä½¿ç”¨çš„ç‰©ç†å†…å­˜ã€‚</p><p>å†…å­˜ä¿¡æ¯å­˜åœ¨ task_info.h ï¼ˆå®Œæ•´è·¯å¾„ usr/include/mach/task.info.hï¼‰æ–‡ä»¶çš„ task_vm_info ç»“æ„ä½“ä¸­ï¼Œå…¶ä¸­phys_footprint å°±æ˜¯ç‰©ç†å†…å­˜çš„ä½¿ç”¨ï¼Œè€Œä¸æ˜¯é©»ç•™å†…å­˜ resident_sizeã€‚ç»“æ„ä½“é‡Œå’Œå†…å­˜ç›¸å…³çš„ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>struct task_vm_info {\n  mach_vm_size_t  virtual_size;       // è™šæ‹Ÿå†…å­˜å¤§å°\n  integer_t region_count;             // å†…å­˜åŒºåŸŸçš„æ•°é‡\n  integer_t page_size;\n  mach_vm_size_t  resident_size;      // é©»ç•™å†…å­˜å¤§å°\n  mach_vm_size_t  resident_size_peak; // é©»ç•™å†…å­˜å³°å€¼\n\n  ...\n\n  /* added for rev1 */\n  mach_vm_size_t  phys_footprint;     // ç‰©ç†å†…å­˜\n\n  ...\n</code></pre><p>OKï¼Œç±»ä¼¼äºå¯¹CPUä½¿ç”¨ç‡çš„ç›‘æ§ï¼Œæˆ‘ä»¬åªè¦ä»è¿™ä¸ªç»“æ„ä½“é‡Œå–å‡ºphys_footprint å­—æ®µçš„å€¼ï¼Œå°±èƒ½å¤Ÿç›‘æ§åˆ°å®é™…ç‰©ç†å†…å­˜çš„ä½¿ç”¨æƒ…å†µäº†ã€‚å…·ä½“å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>uint64_t memoryUsage() {\n    task_vm_info_data_t vmInfo;\n    mach_msg_type_number_t count = TASK_VM_INFO_COUNT;\n    kern_return_t result = task_info(mach_task_self(), TASK_VM_INFO, (task_info_t) &amp;vmInfo, &amp;count);\n    if (result != KERN_SUCCESS)\n        return 0;\n    return vmInfo.phys_footprint;\n}\n</code></pre><p>ä»ä»¥ä¸Šä¸‰ä¸ªçº¿ä¸Šæ€§èƒ½ç›‘æ§æ–¹æ¡ˆå¯ä»¥çœ‹å‡ºï¼Œå®ƒä»¬çš„ä»£ç å’Œä¸šåŠ¡é€»è¾‘æ˜¯å®Œå…¨è§£è€¦çš„ï¼Œç›‘æ§æ—¶åŸºæœ¬éƒ½æ˜¯ç›´æ¥è·å–ç³»ç»Ÿæœ¬èº«æä¾›çš„æ•°æ®ï¼Œæ²¡æœ‰é¢å¤–çš„è®¡ç®—é‡ï¼Œå› æ­¤å¯¹ App æœ¬èº«çš„æ€§èƒ½å½±å“ä¹Ÿéå¸¸å°ï¼Œæ»¡è¶³äº†æˆ‘ä»¬è¦è€ƒè™‘çš„ä¸¤ä¸ªåŸåˆ™ã€‚</p><h2>å°ç»“</h2><p>åœ¨ä»Šå¤©è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å’Œä½ åˆ†äº«äº†å¦‚ä½•é€šè¿‡çº¿ä¸‹å’Œçº¿ä¸Šç›‘æ§ï¼Œå»æŒæ§Appçš„æ€§èƒ½ã€‚</p><p>å…³äºçº¿ä¸‹çš„æ€§èƒ½ç›‘æ§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‹¹æœå®˜æ–¹çš„Instruments å»è§£å†³æ€§èƒ½ç›‘æ§çš„é—®é¢˜ã€‚åŒæ—¶ï¼Œæˆ‘è¿˜å’Œä½ åˆ†äº«äº†å¦‚ä½•ä½¿ç”¨ Instruments çš„ os_signpost API æ¥å®Œæˆè‡ªå®šä¹‰çš„æ€§èƒ½æ•°æ®ç›‘æ§å·¥å…·å¼€å‘ã€‚</p><p>å…³äºçº¿ä¸Šçš„æ€§èƒ½ç›‘æ§ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸å½±å“æ€§èƒ½çš„å‰æä¸‹ï¼Œå»ç›‘æ§çº¿ä¸Šçš„æ€§èƒ½é—®é¢˜ã€‚åœ¨è¿™ä¸€éƒ¨åˆ†å†…å®¹ä¸­ï¼Œæˆ‘ä¸»è¦å’Œä½ ä»‹ç»äº†å¯¹CPUä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨é‡å’ŒFPSçš„çº¿ä¸Šç›‘æ§æ–¹æ¡ˆã€‚</p><p>æœ€åï¼Œæˆ‘è¿˜è¦å†å’Œä½ æä¸€ä¸ªå»ºè®®ã€‚ä½œä¸ºä¸€å iOS å¼€å‘è€…ï¼Œä¸å…¶ä¸€èµ·å¼€å§‹åˆ°å¤„å»å¯»æ‰¾å„ç§è§£å†³æ–¹æ¡ˆï¼Œä¸å¦‚å…ˆæ‘¸é€è‹¹æœå…¬å¸è‡ªå·±çš„åº“å’Œå·¥å…·ï¼Œè¿™é‡Œé¢çš„è®¾è®¡æ€æƒ³å’Œæ¼”è¿›åŒ…å«æœ‰å¤§é‡å¯ä»¥å¸å–å’Œå­¦ä¹ çš„çŸ¥è¯†ã€‚æŒæ¡å¥½äº†è¿™äº›çŸ¥è¯†ï¼Œä½ ä¹Ÿå°±èƒ½å¤Ÿå¼€å‘å‡ºé€‚åˆè‡ªå·±å›¢é˜Ÿçš„å·¥å…·äº†ã€‚è¿™ï¼Œä¹Ÿæ­£æ˜¯æˆ‘æ²¡æœ‰åœ¨è¿™ç¯‡æ–‡ç« ä¸­å’Œä½ ä»‹ç»ç¬¬ä¸‰æ–¹çº¿ä¸Šæ€§èƒ½ç›‘æ§å·¥å…·çš„åŸå› ã€‚</p><h2>è¯¾åå°ä½œä¸š</h2><p>Instruments å¯ä»¥è‡ªå®šä¹‰æ€§èƒ½æ•°æ®çš„ç›‘æ§ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±è¯·ä½ çœ‹ä¸‹ï¼Œä½ ç°åœ¨å·¥ç¨‹ä¸­æœ‰å“ªäº›æ•°æ®æ˜¯éœ€è¦ç›‘æ§çš„ï¼Œç„¶åæ–°å»ºä¸€ä¸ªè‡ªå®šä¹‰ Instruments å·¥å…·å°†å…¶ç›‘æ§èµ·æ¥å§ã€‚</p><p>æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæ¬¢è¿ä½ åœ¨è¯„è®ºåŒºç»™æˆ‘ç•™è¨€åˆ†äº«ä½ çš„è§‚ç‚¹ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><p></p>","neighbors":{"left":{"article_title":"15 | æ—¥å¿—ç›‘æ§ï¼šæ€æ ·è·å– App ä¸­çš„å…¨é‡æ—¥å¿—ï¼Ÿ","id":90185},"right":{"article_title":"17 | è¿œè¶…ä½ æƒ³è±¡çš„å¤šçº¿ç¨‹çš„é‚£äº›å‘","id":90870}},"comments":[{"had_liked":false,"id":86939,"user_name":"drunkenMouse","can_delete":false,"product_type":"c1","uid":1454037,"ip_address":"","ucode":"AA8CEA703ECBE8","user_header":"","comment_is_top":false,"comment_ctime":1555484563,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"83159863187","product_id":100024501,"comment_content":"CADisplayLink:ä¸å±å¹•åˆ·æ–°é¢‘ç‡çš„è®¡æ—¶å™¨åŒæ­¥ï¼Œæ¯æ¬¡å±å¹•åˆ·æ–°éƒ½ä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œæ‰€ä»¥å¯ä»¥è·å–åˆ°ä¸€ç§’é’Ÿå±å¹•åˆ·æ–°çš„æ¬¡æ•°ã€‚<br>çº¿ä¸‹ç›‘æ§ï¼šInstrumentï¼Œä¸€ä¸ªå·¥å…·æ£€æµ‹æ‰€æœ‰ã€‚<br>çº¿ä¸Šç›‘æ§ï¼šCPUä½¿ç”¨ç›´æ¥è·å–æ‰€æœ‰çº¿ç¨‹çš„cpu_usageè®¡ç®—ç»¼åˆï¼Œå†…å­˜æ¶ˆè€—ä½¿ç”¨task_basic_infoçš„phys_footprintï¼ŒFPSç”¨CADisplayLinkã€‚","like_count":20},{"had_liked":false,"id":98977,"user_name":"xilie","can_delete":false,"product_type":"c1","uid":1013805,"ip_address":"","ucode":"AFCC4E157F7830","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJVegfjqa0gM4hcRrBhZkIf7Uc5oeTMYsg6o5pd76IQlUoIIh2ic6P22xVEFtRnAzjyLtiaPVstkKug/132","comment_is_top":false,"comment_ctime":1559122868,"is_pvip":false,"replies":[{"id":"38605","content":"æ¨èçš„è¯ï¼Œåšçš„å¥½çš„æ˜¯èš‚èšçš„ mPaaS","user_name":"ä½œè€…å›å¤","user_name_real":"æˆ´é“­","uid":"1140280","ctime":1561387856,"ip_address":"","comment_id":98977,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18738992052","product_id":100024501,"comment_content":"è¦ä¸è¿˜æ˜¯ä»‹ç»ä¸‹ç¬¬ä¸‰æ–¹çš„ç›‘æ§å¹³å°ï¼Œå°å…¬å¸ï¼Œç›‘æ§åå°éƒ½æ²¡äººåšå•Š","like_count":4,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"æˆ´é“­","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451915,"discussion_content":"æ¨èçš„è¯ï¼Œåšçš„å¥½çš„æ˜¯èš‚èšçš„ mPaaS","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561387856,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86753,"user_name":"å°é˜³å“¥","can_delete":false,"product_type":"c1","uid":1146840,"ip_address":"","ucode":"58848E5B54F734","user_header":"https://static001.geekbang.org/account/avatar/00/11/7f/d8/36512951.jpg","comment_is_top":false,"comment_ctime":1555457175,"is_pvip":true,"replies":[{"id":"31693","content":"ä¸ä¼šçš„","user_name":"ä½œè€…å›å¤","user_name_real":"æˆ´é“­","uid":"1140280","ctime":1555863392,"ip_address":"","comment_id":86753,"utype":1}],"discussion_count":2,"race_medal":0,"score":"18735326359","product_id":100024501,"comment_content":"æ¯2så»éå†çº¿ç¨‹ è¿™ä¸ªä¸ä¼šæœ‰é—®é¢˜å—ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"æˆ´é“­","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447153,"discussion_content":"ä¸ä¼šçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555863392,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1459863,"avatar":"https://static001.geekbang.org/account/avatar/00/16/46/97/ddd4b05f.jpg","nickname":"çˆ±ä¸Šæˆ‘ä»¬çš„å¾®ç¬‘","note":"","ucode":"40CDB7AB0991CE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"æˆ´é“­","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":531175,"discussion_content":"å“ˆå“ˆå“ˆğŸ˜„è¿™ä¹ˆä¹…æ‰å›å¤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637244989,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":447153,"ip_address":""},"score":531175,"extra":"{\"user_type\":1}"}]}]},{"had_liked":false,"id":86402,"user_name":"Onion","can_delete":false,"product_type":"c1","uid":1361456,"ip_address":"","ucode":"C36A7492AFA245","user_header":"https://static001.geekbang.org/account/avatar/00/14/c6/30/55a03b70.jpg","comment_is_top":false,"comment_ctime":1555375637,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14440277525","product_id":100024501,"comment_content":"ç›‘æ§èµ·æ¥å¦‚ä½•åˆ†æï¼Œæœ‰å®è·µæ–¹æ¡ˆå˜›","like_count":3},{"had_liked":false,"id":87210,"user_name":"ä¸€ä»£çœŸé¾™","can_delete":false,"product_type":"c1","uid":1454738,"ip_address":"","ucode":"9B5900D62E0C64","user_header":"https://static001.geekbang.org/account/avatar/00/16/32/92/78e66924.jpg","comment_is_top":false,"comment_ctime":1555548499,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10145483091","product_id":100024501,"comment_content":"çº¿ä¸Šç”µé‡ç›‘æ§æ˜¯ç›‘æ§ä¸äº†çš„ã€‚ç°æœ‰çš„æ–¹æ¡ˆéƒ½æ˜¯ä¸å¯è¡Œçš„ï¼Œæ²¡æœ‰å‚è€ƒä»·å€¼ã€‚","like_count":2},{"had_liked":false,"id":86941,"user_name":"æäºŒæŸ±å­","can_delete":false,"product_type":"c1","uid":1078186,"ip_address":"","ucode":"4A58F2C473642A","user_header":"https://static001.geekbang.org/account/avatar/00/10/73/aa/442e9eb1.jpg","comment_is_top":false,"comment_ctime":1555485683,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10145420275","product_id":100024501,"comment_content":"å¯¹äºæ€§èƒ½çš„ç›‘æ§æœ‰æ²¡æœ‰è¡¡é‡æ ‡å‡†ï¼Œå¦‚ä½•è¡¡é‡ä¼˜åŠ£ï¼Ÿ","like_count":3},{"had_liked":false,"id":210230,"user_name":"CoderY","can_delete":false,"product_type":"c1","uid":1251205,"ip_address":"","ucode":"8F50E7F7EF6A2E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PjTbTVicNs9wpgmmpxvSK6orvN2E4wOmQ1ukSNMd5icoFEulcA21QaQvtp6ADvgOicnibPLZQop91ISU6cyQmfKJwg/132","comment_is_top":false,"comment_ctime":1587701245,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5882668541","product_id":100024501,"comment_content":"æ–‡ä¸­æåˆ°â€œé›†æˆå¤šä¸ªå…¬å¸ SDK çš„æƒ…å†µï¼Œæ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦ä»¥é»‘ç›’çš„æ–¹å¼æ¥è¿›è¡Œæ€§èƒ½ç›‘æ§â€ï¼Œè¯·é—®å¤§ä½¬è¿™å—å…·ä½“æ€ä¹ˆç›‘æ§ï¼Ÿ","like_count":1},{"had_liked":false,"id":125287,"user_name":"å¼ ç‰æ£ ","can_delete":false,"product_type":"c1","uid":1203564,"ip_address":"","ucode":"40BF9506955A0B","user_header":"https://static001.geekbang.org/account/avatar/00/12/5d/6c/40bb7d92.jpg","comment_is_top":false,"comment_ctime":1566138549,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5861105845","product_id":100024501,"comment_content":"time profile å·¥å…·å†æœ€æ–°çš„xcodeç‰ˆæœ¬ä¸Šæ”¶é›†ä¸åˆ°æ•°æ®ï¼Œä½œè€…ä½ æœ‰é‡åˆ°è¿‡å—ï¼Ÿ","like_count":1},{"had_liked":false,"id":99222,"user_name":"å°åŸ","can_delete":false,"product_type":"c1","uid":1506522,"ip_address":"","ucode":"AB9B38617F64FB","user_header":"https://static001.geekbang.org/account/avatar/00/16/fc/da/1f1254e6.jpg","comment_is_top":false,"comment_ctime":1559179080,"is_pvip":false,"replies":[{"id":"38604","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","user_name_real":"æˆ´é“­","uid":"1140280","ctime":1561387775,"ip_address":"","comment_id":99222,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5854146376","product_id":100024501,"comment_content":"å†…å­˜çº¿ä¸Šç›‘æ§ï¼Œä¸æ˜¯é’ˆå¯¹å¤šä¸ªçº¿ç¨‹ï¼Œè€Œæ˜¯ç›´æ¥ä»ç»“æ„ä½“é‡Œé¢å–å‡ºphys_footprintå°±å¯ä»¥ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"æˆ´é“­","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452025,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561387775,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91418,"user_name":"å¼‚ç•Œ","can_delete":false,"product_type":"c1","uid":1467312,"ip_address":"","ucode":"90D4DF44C81B7E","user_header":"https://static001.geekbang.org/account/avatar/00/16/63/b0/b91fc19b.jpg","comment_is_top":false,"comment_ctime":1557033087,"is_pvip":false,"replies":[{"id":"32722","content":"ä¸ä¼š","user_name":"ä½œè€…å›å¤","user_name_real":"æˆ´é“­","uid":"1140280","ctime":1557052318,"ip_address":"","comment_id":91418,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5852000383","product_id":100024501,"comment_content":"å›¾ç‰‡åå­—ï¼Œä½¿ç”¨ä¸­æ–‡ï¼Œä¼šå½±å“æ€§èƒ½å—ï¼ˆé¡¹ç›®ä¸­90ï¼…ä»¥ä¸Šä½¿ç”¨çš„ä¸­æ–‡å‘½åå›¾ç‰‡ï¼‰ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"æˆ´é“­","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448912,"discussion_content":"ä¸ä¼š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557052318,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86458,"user_name":"drq","can_delete":false,"product_type":"c1","uid":1472758,"ip_address":"","ucode":"824FC464184FAD","user_header":"https://static001.geekbang.org/account/avatar/00/16/78/f6/231cb5cd.jpg","comment_is_top":false,"comment_ctime":1555379270,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"5850346566","product_id":100024501,"comment_content":"appè€—ç”µé‡æ€ä¹ˆç›‘æ§å‘¢","like_count":1,"discussions":[{"author":{"id":1001918,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/49/be/970590a0.jpg","nickname":"æ•…èƒ¤é“é•¿","note":"","ucode":"CC42C4CD543833","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":180943,"discussion_content":"Xcode Debug Gaugeæœ‰high levelçš„overviewï¼Œä¹Ÿå¯ä»¥ç”¨ energy log instrument åˆ†æ","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1582324791,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1456751,"avatar":"https://static001.geekbang.org/account/avatar/00/16/3a/6f/6ae4bcfd.jpg","nickname":"éº¦å­","note":"","ucode":"160838EC0CED4F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1001918,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/49/be/970590a0.jpg","nickname":"æ•…èƒ¤é“é•¿","note":"","ucode":"CC42C4CD543833","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":210345,"discussion_content":"å¤§ç¥æ½œä¼åœ¨è¯„è®ºåŒºğŸ˜‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584717974,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":180943,"ip_address":""},"score":210345,"extra":""}]},{"author":{"id":1635693,"avatar":"https://static001.geekbang.org/account/avatar/00/18/f5/6d/9cdebb65.jpg","nickname":"ç‹é½","note":"","ucode":"3EAD86A3448E2E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332932,"discussion_content":"https://perfdog.qq.com/ è…¾è®¯çš„æ€§èƒ½ç‹—ä¹Ÿä¸é”™","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1607397286,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":309383,"user_name":"...","can_delete":false,"product_type":"c1","uid":1020427,"ip_address":"","ucode":"35C881D8AA1C5E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/92/0b/2ccf7908.jpg","comment_is_top":false,"comment_ctime":1630078062,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630078062","product_id":100024501,"comment_content":"å†…å­˜æ³„éœ²çº¿ä¸Šç›‘æ§å¦‚ä½•åšå‘¢","like_count":0},{"had_liked":false,"id":119691,"user_name":"Yest","can_delete":false,"product_type":"c1","uid":1409087,"ip_address":"","ucode":"1E82B6355890C0","user_header":"https://static001.geekbang.org/account/avatar/00/15/80/3f/bc65b009.jpg","comment_is_top":false,"comment_ctime":1564653682,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1564653682","product_id":100024501,"comment_content":"æˆ´è€å¸ˆã€‚cpu_usageæ˜¯åƒåˆ†æ¯”å—ï¼Ÿæˆ‘æ‰“å°çš„æœ€é«˜æ˜¯1000<br>(lldb) p threadBaseInfo-&gt;cpu_usage<br>(integer_t) $10 = 965<br><br>çœ‹åŸæ–‡è§£é‡Š æ˜¯ç™¾åˆ†æ¯”å•Š<br>integer_t       cpu_usage;      &#47;* scaled cpu usage percentage *&#47;","like_count":0,"discussions":[{"author":{"id":1857126,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJZmm5lWL0PlY7P8SRw7iaB9An0MbLCAP8jS4t2yZd9v4pUtP49UCHfWbUFiaaSeQaRYPMXVo5pE1Jg/132","nickname":"åº¦æœ¨","note":"","ucode":"473334134C6682","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":413718,"discussion_content":"thread_info.hé‡Œé¢æœ‰ä¸ªTH_USAGE_SCALEï¼Œ æœ€åçš„cpu_usageéœ€è¦é™¤ä»¥è¿™ä¸ªscale","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636547752,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1471806,"avatar":"https://static001.geekbang.org/account/avatar/00/16/75/3e/71b16443.jpg","nickname":"Struggle","note":"","ucode":"C769D8FFD9C1B6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":287758,"discussion_content":"ç”¨æ¨¡æ‹Ÿå™¨è·‘çš„ï¼Œç›´æ¥çœ‹æ¨¡æ‹Ÿå™¨çš„cpu ä½¿ç”¨ç‡ï¼Œå¥½åƒæ˜¯é™¤ä»¥10æ‰å¯¹çš„ä¸Šï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593529158,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":94379,"user_name":"æ¯›æˆæ–¹","can_delete":false,"product_type":"c1","uid":1459289,"ip_address":"","ucode":"DFBF3D464D8D7C","user_header":"https://static001.geekbang.org/account/avatar/00/16/44/59/9cc7d8cd.jpg","comment_is_top":false,"comment_ctime":1557798114,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557798114","product_id":100024501,"comment_content":"threadBaseInfo = (thread_basic_info_data_t)threadInfo;<br>xcode8.2 æ— æ³•å¼ºåˆ¶è½¬æ¢<br>è¯·é—®å¾—æ›´æ–°xcodeï¼Ÿ","like_count":0},{"had_liked":false,"id":92618,"user_name":"æœˆè½æ³‰","can_delete":false,"product_type":"c1","uid":1458702,"ip_address":"","ucode":"FC03912F1EBB83","user_header":"https://static001.geekbang.org/account/avatar/00/16/42/0e/21b8025f.jpg","comment_is_top":false,"comment_ctime":1557306846,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1557306846","product_id":100024501,"comment_content":"mach_task_self()è¿™ä¸ªå‡½æ•°æŠ¥é”™Implicit declaration of function &#39;mach_task_self&#39; is invalid in C99ï¼Œå¦‚ä½•å¤„ç†","like_count":0,"discussions":[{"author":{"id":1741557,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/92/f5/77fa70bb.jpg","nickname":"è°¢ç«‹é¢–","note":"","ucode":"10EB71210C01B5","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":48709,"discussion_content":"#include <mach/mach_init.h>","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1573520901,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2046550,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLqxY3fx9Cs0BCxyuOqdlMY8UFZul9TEVp1rAKD16z3VHncBpfHAficsdHrxN6wUqH4xWFiby31iaZWA/132","nickname":"guoran","note":"","ucode":"D16D9F97219D9D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294205,"discussion_content":"æ¥¼ä¸Šè¯´å¯¹ï¼Œä¸è¿‡ç›´æ¥å¼•å…¥<mach/mach.h>ä¼šæ›´æ–¹ä¾¿ï¼Œé‡Œé¢å«æœ‰ä½ æ‰€ç”¨åˆ°çš„æ‰€æœ‰ç›¸å…³å¤´æ–‡ä»¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595828028,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89205,"user_name":"æ”¿","can_delete":false,"product_type":"c1","uid":1234640,"ip_address":"","ucode":"F17443038872DE","user_header":"https://static001.geekbang.org/account/avatar/00/12/d6/d0/259e7ce3.jpg","comment_is_top":false,"comment_ctime":1556106575,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556106575","product_id":100024501,"comment_content":"æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ç”¨instrumentçš„leakåŠŸèƒ½çš„æ—¶å€™ï¼Œappè¿è¡Œèµ·æ¥ä¼šæ¯”è¾ƒå¡ã€‚ä¸çŸ¥é“è‡ªå®šä¹‰çš„instrumentä¼šä¸ä¼šä¹Ÿæœ‰è¿™ä¸ªé—®é¢˜ã€‚","like_count":0},{"had_liked":false,"id":86956,"user_name":"Ant","can_delete":false,"product_type":"c1","uid":1079563,"ip_address":"","ucode":"07E6374F91F61E","user_header":"https://static001.geekbang.org/account/avatar/00/10/79/0b/4346a253.jpg","comment_is_top":false,"comment_ctime":1555487010,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555487010","product_id":100024501,"comment_content":"Xcode è¿˜æœ‰è¿™ä¹ˆç‰›çš„åŠŸèƒ½","like_count":0},{"had_liked":false,"id":86943,"user_name":"å›½æœ‹","can_delete":false,"product_type":"c1","uid":1220641,"ip_address":"","ucode":"B6EA8785E495C4","user_header":"https://static001.geekbang.org/account/avatar/00/12/a0/21/b20b2f44.jpg","comment_is_top":false,"comment_ctime":1555485731,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555485731","product_id":100024501,"comment_content":"è€å“¥ï¼Œè¯¢é—®ä¸ªé—®é¢˜ï¼ŒAPPç¬¬ä¸€æ¬¡å®‰è£…ï¼Œå®‰è£…åä¼šæç¤ºç½‘ç»œæƒé™ï¼Œæç¤ºæƒé™æ—¶APPæœ‰ä»€ä¹ˆæ´»åŠ¨å—ï¼Œè§¦å‘ç½‘ç»œè®¿é—®çš„ä»£ç åé¢çš„ç¨‹åºæ˜¯å‡ºäºç­‰å¾…çŠ¶æ€ï¼Œè¿˜æ˜¯å·²ç»æ‰§è¡Œäº†å‘¢","like_count":0}]}