{"id":41588,"title":"27 | æ¡ä»¶å˜é‡sync.Cond ï¼ˆä¸Šï¼‰","content":"<p>åœ¨ä¸Šç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦è¯´çš„æ˜¯äº’æ–¥é”ï¼Œä»Šå¤©æˆ‘å’Œä½ æ¥èŠä¸€èŠæ¡ä»¶å˜é‡ï¼ˆconditional variableï¼‰ã€‚</p><h2>å‰å¯¼å†…å®¹ï¼šæ¡ä»¶å˜é‡ä¸äº’æ–¥é”</h2><p>æˆ‘ä»¬å¸¸å¸¸ä¼šæŠŠæ¡ä»¶å˜é‡è¿™ä¸ªåŒæ­¥å·¥å…·æ‹¿æ¥ä¸äº’æ–¥é”ä¸€èµ·è®¨è®ºã€‚å®é™…ä¸Šï¼Œæ¡ä»¶å˜é‡æ˜¯åŸºäºäº’æ–¥é”çš„ï¼Œå®ƒå¿…é¡»æœ‰äº’æ–¥é”çš„æ”¯æ’‘æ‰èƒ½å‘æŒ¥ä½œç”¨ã€‚</p><p>æ¡ä»¶å˜é‡å¹¶ä¸æ˜¯è¢«ç”¨æ¥ä¿æŠ¤ä¸´ç•ŒåŒºå’Œå…±äº«èµ„æºçš„ï¼Œå®ƒæ˜¯ç”¨äºåè°ƒæƒ³è¦è®¿é—®å…±äº«èµ„æºçš„é‚£äº›çº¿ç¨‹çš„ã€‚å½“å…±äº«èµ„æºçš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒå¯ä»¥è¢«ç”¨æ¥é€šçŸ¥è¢«äº’æ–¥é”é˜»å¡çš„çº¿ç¨‹ã€‚</p><p>æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬ä¸¤ä¸ªäººåœ¨å…±åŒæ‰§è¡Œä¸€é¡¹ç§˜å¯†ä»»åŠ¡ï¼Œè¿™éœ€è¦åœ¨ä¸ç›´æ¥è”ç³»å’Œè§é¢çš„å‰æä¸‹è¿›è¡Œã€‚æˆ‘éœ€è¦å‘ä¸€ä¸ªä¿¡ç®±é‡Œæ”¾ç½®æƒ…æŠ¥ï¼Œä½ éœ€è¦ä»è¿™ä¸ªä¿¡ç®±ä¸­è·å–æƒ…æŠ¥ã€‚è¿™ä¸ªä¿¡ç®±å°±ç›¸å½“äºä¸€ä¸ªå…±äº«èµ„æºï¼Œè€Œæˆ‘ä»¬å°±åˆ†åˆ«æ˜¯è¿›è¡Œå†™æ“ä½œçš„çº¿ç¨‹å’Œè¿›è¡Œè¯»æ“ä½œçš„çº¿ç¨‹ã€‚</p><p>å¦‚æœæˆ‘åœ¨æ”¾ç½®çš„æ—¶å€™å‘ç°ä¿¡ç®±é‡Œè¿˜æœ‰æœªè¢«å–èµ°çš„æƒ…æŠ¥ï¼Œé‚£å°±ä¸å†æ”¾ç½®ï¼Œè€Œå…ˆè¿”å›ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä½ åœ¨è·å–çš„æ—¶å€™å‘ç°ä¿¡ç®±é‡Œæ²¡æœ‰æƒ…æŠ¥ï¼Œé‚£ä¹Ÿåªèƒ½å…ˆå›å»äº†ã€‚è¿™å°±ç›¸å½“äºå†™çš„çº¿ç¨‹æˆ–è¯»çš„çº¿ç¨‹é˜»å¡çš„æƒ…å†µã€‚</p><p>è™½ç„¶æˆ‘ä»¬ä¿©éƒ½æœ‰ä¿¡ç®±çš„é’¥åŒ™ï¼Œä½†æ˜¯åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªäººæ’å…¥é’¥åŒ™å¹¶æ‰“å¼€ä¿¡ç®±ï¼Œè¿™å°±æ˜¯é”çš„ä½œç”¨äº†ã€‚æ›´ä½•å†µå’±ä»¬ä¿©æ˜¯ä¸èƒ½ç›´æ¥è§é¢çš„ï¼Œæ‰€ä»¥è¿™ä¸ªä¿¡ç®±æœ¬èº«å°±å¯ä»¥è¢«è§†ä¸ºä¸€ä¸ªä¸´ç•ŒåŒºã€‚</p><p>å°½ç®¡æ²¡æœ‰åè°ƒå¥½ï¼Œå’±ä»¬ä¿©ä»ç„¶è¦æƒ³æ–¹è®¾æ³•çš„å®Œæˆä»»åŠ¡å•Šã€‚æ‰€ä»¥ï¼Œå¦‚æœä¿¡ç®±é‡Œæœ‰æƒ…æŠ¥ï¼Œè€Œä½ å´è¿Ÿè¿Ÿæœªå–èµ°ï¼Œé‚£æˆ‘å°±éœ€è¦æ¯è¿‡ä¸€æ®µæ—¶é—´å¸¦ç€æ–°æƒ…æŠ¥å»æ£€æŸ¥ä¸€æ¬¡ï¼Œè‹¥å‘ç°ä¿¡ç®±ç©ºäº†ï¼Œæˆ‘å°±éœ€è¦åŠæ—¶åœ°æŠŠæ–°æƒ…æŠ¥æ”¾åˆ°é‡Œé¢ã€‚</p><!-- [[[read_end]]] --><p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä¿¡ç®±é‡Œä¸€ç›´æ²¡æœ‰æƒ…æŠ¥ï¼Œé‚£ä½ ä¹Ÿè¦æ¯è¿‡ä¸€æ®µæ—¶é—´å»æ‰“å¼€çœ‹çœ‹ï¼Œä¸€æ—¦æœ‰äº†æƒ…æŠ¥å°±åŠæ—¶åœ°å–èµ°ã€‚è¿™ä¹ˆåšæ˜¯å¯ä»¥çš„ï¼Œä½†å°±æ˜¯å¤ªå±é™©äº†ï¼Œå¾ˆå®¹æ˜“è¢«æ•Œäººå‘ç°ã€‚</p><p>åæ¥ï¼Œæˆ‘ä»¬åˆæƒ³äº†ä¸€ä¸ªè®¡ç­–ï¼Œå„è‡ªé›‡ä½£äº†ä¸€ä¸ªä¸èµ·çœ¼çš„å°å­©å„¿ã€‚å¦‚æœæ—©ä¸Šä¸ƒç‚¹æœ‰ä¸€ä¸ªæˆ´çº¢è‰²å¸½å­çš„å°å­©å„¿ä»ä½ å®¶æ¥¼ä¸‹è·¯è¿‡ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€ä¿¡ç®±é‡Œæœ‰äº†æ–°æƒ…æŠ¥ã€‚å¦ä¸€è¾¹ï¼Œå¦‚æœä¸Šåˆä¹ç‚¹æœ‰ä¸€ä¸ªæˆ´è“è‰²å¸½å­çš„å°å­©å„¿ä»æˆ‘å®¶æ¥¼ä¸‹è·¯è¿‡ï¼Œé‚£å°±è¯´æ˜ä½ å·²ç»ä»ä¿¡ç®±ä¸­å–èµ°äº†æƒ…æŠ¥ã€‚</p><p>è¿™æ ·ä¸€æ¥ï¼Œå’±ä»¬æ‰§è¡Œä»»åŠ¡çš„éšè”½æ€§é«˜å¤šäº†ï¼Œå¹¶ä¸”æ•ˆç‡çš„æå‡éå¸¸æ˜¾è‘—ã€‚è¿™ä¸¤ä¸ªæˆ´ä¸åŒé¢œè‰²å¸½å­çš„å°å­©å„¿å°±ç›¸å½“äºæ¡ä»¶å˜é‡ï¼Œåœ¨å…±äº«èµ„æºçš„çŠ¶æ€äº§ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œèµ·åˆ°äº†é€šçŸ¥çš„ä½œç”¨ã€‚</p><p>å½“ç„¶äº†ï¼Œæˆ‘ä»¬æ˜¯åœ¨ç”¨Goè¯­è¨€ç¼–å†™ç¨‹åºï¼Œè€Œä¸æ˜¯åœ¨æ‰§è¡Œä»€ä¹ˆç§˜å¯†ä»»åŠ¡ã€‚å› æ­¤ï¼Œæ¡ä»¶å˜é‡åœ¨è¿™é‡Œçš„æœ€å¤§ä¼˜åŠ¿å°±æ˜¯åœ¨æ•ˆç‡æ–¹é¢çš„æå‡ã€‚å½“å…±äº«èµ„æºçš„çŠ¶æ€ä¸æ»¡è¶³æ¡ä»¶çš„æ—¶å€™ï¼Œæƒ³æ“ä½œå®ƒçš„çº¿ç¨‹å†ä¹Ÿä¸ç”¨å¾ªç¯å¾€å¤åœ°åšæ£€æŸ¥äº†ï¼Œåªè¦ç­‰å¾…é€šçŸ¥å°±å¥½äº†ã€‚</p><p>è¯´åˆ°è¿™é‡Œï¼Œæƒ³è€ƒè€ƒä½ çŸ¥é“æ€ä¹ˆä½¿ç”¨æ¡ä»¶å˜é‡å—ï¼Ÿæ‰€ä»¥ï¼Œ<strong>æˆ‘ä»¬ä»Šå¤©çš„é—®é¢˜å°±æ˜¯ï¼šæ¡ä»¶å˜é‡æ€æ ·ä¸äº’æ–¥é”é…åˆä½¿ç”¨ï¼Ÿ</strong></p><p><strong>è¿™é“é¢˜çš„å…¸å‹å›ç­”æ˜¯ï¼šæ¡ä»¶å˜é‡çš„åˆå§‹åŒ–ç¦»ä¸å¼€äº’æ–¥é”ï¼Œå¹¶ä¸”å®ƒçš„æ–¹æ³•æœ‰çš„ä¹Ÿæ˜¯åŸºäºäº’æ–¥é”çš„ã€‚</strong></p><p>æ¡ä»¶å˜é‡æä¾›çš„æ–¹æ³•æœ‰ä¸‰ä¸ªï¼šç­‰å¾…é€šçŸ¥ï¼ˆwaitï¼‰ã€å•å‘é€šçŸ¥ï¼ˆsignalï¼‰å’Œå¹¿æ’­é€šçŸ¥ï¼ˆbroadcastï¼‰ã€‚</p><p>æˆ‘ä»¬åœ¨åˆ©ç”¨æ¡ä»¶å˜é‡ç­‰å¾…é€šçŸ¥çš„æ—¶å€™ï¼Œéœ€è¦åœ¨å®ƒåŸºäºçš„é‚£ä¸ªäº’æ–¥é”ä¿æŠ¤ä¸‹è¿›è¡Œã€‚è€Œåœ¨è¿›è¡Œå•å‘é€šçŸ¥æˆ–å¹¿æ’­é€šçŸ¥çš„æ—¶å€™ï¼Œå´æ˜¯æ°æ°ç›¸åçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œéœ€è¦åœ¨å¯¹åº”çš„äº’æ–¥é”è§£é”ä¹‹åå†åšè¿™ä¸¤ç§æ“ä½œã€‚</p><h2>é—®é¢˜è§£æ</h2><p>è¿™ä¸ªé—®é¢˜çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä½†å…¶å®å¯ä»¥åŸºäºå®ƒ,å»¶ä¼¸å‡ºå¾ˆå¤šå…¶ä»–çš„é—®é¢˜ã€‚æ¯”å¦‚ï¼Œæ¯ä¸ªæ–¹æ³•çš„ä½¿ç”¨æ—¶æœºæ˜¯ä»€ä¹ˆï¼Ÿåˆæ¯”å¦‚ï¼Œæ¯ä¸ªæ–¹æ³•æ‰§è¡Œçš„å†…éƒ¨æµç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬ä¸€è¾¹ç”¨ä»£ç å®ç°å‰é¢é‚£ä¸ªä¾‹å­ï¼Œä¸€è¾¹è®¨è®ºæ¡ä»¶å˜é‡çš„ä½¿ç”¨ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæ¥åˆ›å»ºå¦‚ä¸‹å‡ ä¸ªå˜é‡ã€‚</p><pre><code>var mailbox uint8\nvar lock sync.RWMutex\nsendCond := sync.NewCond(&amp;lock)\nrecvCond := sync.NewCond(lock.RLocker())\n</code></pre><p><strong>å˜é‡<code>mailbox</code>ä»£è¡¨ä¿¡ç®±ï¼Œæ˜¯<code>uint8</code>ç±»å‹çš„ã€‚</strong> è‹¥å®ƒçš„å€¼ä¸º<code>0</code>åˆ™è¡¨ç¤ºä¿¡ç®±ä¸­æ²¡æœ‰æƒ…æŠ¥ï¼Œè€Œå½“å®ƒçš„å€¼ä¸º<code>1</code>æ—¶åˆ™è¯´æ˜ä¿¡ç®±ä¸­æœ‰æƒ…æŠ¥ã€‚<code>lock</code>æ˜¯ä¸€ä¸ªç±»å‹ä¸º<code>sync.RWMutex</code>çš„å˜é‡ï¼Œæ˜¯ä¸€ä¸ªè¯»å†™é”ï¼Œä¹Ÿå¯ä»¥è¢«è§†ä¸ºä¿¡ç®±ä¸Šçš„é‚£æŠŠé”ã€‚</p><p>å¦å¤–ï¼ŒåŸºäºè¿™æŠŠé”ï¼Œæˆ‘è¿˜åˆ›å»ºäº†ä¸¤ä¸ªä»£è¡¨æ¡ä»¶å˜é‡çš„å˜é‡ï¼Œ<strong>åå­—åˆ†åˆ«å«<code>sendCond</code>å’Œ<code>recvCond</code>ã€‚</strong> å®ƒä»¬éƒ½æ˜¯<code>*sync.Cond</code>ç±»å‹çš„ï¼ŒåŒæ—¶ä¹Ÿéƒ½æ˜¯ç”±<code>sync.NewCond</code>å‡½æ•°æ¥åˆå§‹åŒ–çš„ã€‚</p><p>ä¸<code>sync.Mutex</code>ç±»å‹å’Œ<code>sync.RWMutex</code>ç±»å‹ä¸åŒï¼Œ<code>sync.Cond</code>ç±»å‹å¹¶ä¸æ˜¯å¼€ç®±å³ç”¨çš„ã€‚æˆ‘ä»¬åªèƒ½åˆ©ç”¨<code>sync.NewCond</code>å‡½æ•°åˆ›å»ºå®ƒçš„æŒ‡é’ˆå€¼ã€‚è¿™ä¸ªå‡½æ•°éœ€è¦ä¸€ä¸ª<code>sync.Locker</code>ç±»å‹çš„å‚æ•°å€¼ã€‚</p><p>è¿˜è®°å¾—å—ï¼Ÿæˆ‘åœ¨å‰é¢è¯´è¿‡ï¼Œæ¡ä»¶å˜é‡æ˜¯åŸºäºäº’æ–¥é”çš„ï¼Œå®ƒå¿…é¡»æœ‰äº’æ–¥é”çš„æ”¯æ’‘æ‰èƒ½å¤Ÿèµ·ä½œç”¨ã€‚å› æ­¤ï¼Œè¿™é‡Œçš„å‚æ•°å€¼æ˜¯ä¸å¯æˆ–ç¼ºçš„ï¼Œå®ƒä¼šå‚ä¸åˆ°æ¡ä»¶å˜é‡çš„æ–¹æ³•å®ç°å½“ä¸­ã€‚</p><p><code>sync.Locker</code>å…¶å®æ˜¯ä¸€ä¸ªæ¥å£ï¼Œåœ¨å®ƒçš„å£°æ˜ä¸­åªåŒ…å«äº†ä¸¤ä¸ªæ–¹æ³•å®šä¹‰ï¼Œå³ï¼š<code>Lock()</code>å’Œ<code>Unlock()</code>ã€‚<code>sync.Mutex</code>ç±»å‹å’Œ<code>sync.RWMutex</code>ç±»å‹éƒ½æ‹¥æœ‰<code>Lock</code>æ–¹æ³•å’Œ<code>Unlock</code>æ–¹æ³•ï¼Œåªä¸è¿‡å®ƒä»¬éƒ½æ˜¯æŒ‡é’ˆæ–¹æ³•ã€‚å› æ­¤ï¼Œè¿™ä¸¤ä¸ªç±»å‹çš„æŒ‡é’ˆç±»å‹æ‰æ˜¯<code>sync.Locker</code>æ¥å£çš„å®ç°ç±»å‹ã€‚</p><p>æˆ‘åœ¨ä¸º<code>sendCond</code>å˜é‡åšåˆå§‹åŒ–çš„æ—¶å€™ï¼ŒæŠŠåŸºäº<code>lock</code>å˜é‡çš„æŒ‡é’ˆå€¼ä¼ ç»™äº†<code>sync.NewCond</code>å‡½æ•°ã€‚</p><p>åŸå› æ˜¯ï¼Œ<strong><code>lock</code>å˜é‡çš„<code>Lock</code>æ–¹æ³•å’Œ<code>Unlock</code>æ–¹æ³•åˆ†åˆ«ç”¨äºå¯¹å…¶ä¸­å†™é”çš„é”å®šå’Œè§£é”ï¼Œå®ƒä»¬ä¸<code>sendCond</code>å˜é‡çš„å«ä¹‰æ˜¯å¯¹åº”çš„ã€‚</strong><code>sendCond</code>æ˜¯ä¸“é—¨ä¸ºæ”¾ç½®æƒ…æŠ¥è€Œå‡†å¤‡çš„æ¡ä»¶å˜é‡ï¼Œå‘ä¿¡ç®±é‡Œæ”¾ç½®æƒ…æŠ¥ï¼Œå¯ä»¥è¢«è§†ä¸ºå¯¹å…±äº«èµ„æºçš„å†™æ“ä½œã€‚</p><p>ç›¸åº”çš„ï¼Œ<strong><code>recvCond</code>å˜é‡ä»£è¡¨çš„æ˜¯ä¸“é—¨ä¸ºè·å–æƒ…æŠ¥è€Œå‡†å¤‡çš„æ¡ä»¶å˜é‡ã€‚</strong> è™½ç„¶è·å–æƒ…æŠ¥ä¹Ÿä¼šæ¶‰åŠå¯¹ä¿¡ç®±çŠ¶æ€çš„æ”¹å˜ï¼Œä½†æ˜¯å¥½åœ¨åšè¿™ä»¶äº‹çš„äººåªä¼šæœ‰ä½ ä¸€ä¸ªï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿéœ€è¦å€Ÿæ­¤äº†è§£ä¸€ä¸‹ï¼Œæ¡ä»¶å˜é‡ä¸è¯»å†™é”ä¸­çš„è¯»é”çš„è”ç”¨æ–¹å¼ã€‚æ‰€ä»¥ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æš‚ä¸”æŠŠè·å–æƒ…æŠ¥çœ‹åšæ˜¯å¯¹å…±äº«èµ„æºçš„è¯»æ“ä½œã€‚</p><p>å› æ­¤ï¼Œä¸ºäº†åˆå§‹åŒ–<code>recvCond</code>è¿™ä¸ªæ¡ä»¶å˜é‡ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯<code>lock</code>å˜é‡ä¸­çš„è¯»é”ï¼Œå¹¶ä¸”è¿˜éœ€è¦æ˜¯<code>sync.Locker</code>ç±»å‹çš„ã€‚</p><p>å¯æ˜¯ï¼Œ<code>lock</code>å˜é‡ä¸­ç”¨äºå¯¹è¯»é”è¿›è¡Œé”å®šå’Œè§£é”çš„æ–¹æ³•å´æ˜¯<code>RLock</code>å’Œ<code>RUnlock</code>ï¼Œå®ƒä»¬ä¸<code>sync.Locker</code>æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•å¹¶ä¸åŒ¹é…ã€‚</p><p>å¥½åœ¨<code>sync.RWMutex</code>ç±»å‹çš„<code>RLocker</code>æ–¹æ³•å¯ä»¥å®ç°è¿™ä¸€éœ€æ±‚ã€‚æˆ‘ä»¬åªè¦åœ¨è°ƒç”¨<code>sync.NewCond</code>å‡½æ•°æ—¶ï¼Œä¼ å…¥è°ƒç”¨è¡¨è¾¾å¼<code>lock.RLocker()</code>çš„ç»“æœå€¼ï¼Œå°±å¯ä»¥ä½¿è¯¥å‡½æ•°è¿”å›ç¬¦åˆè¦æ±‚çš„æ¡ä»¶å˜é‡äº†ã€‚</p><p>ä¸ºä»€ä¹ˆè¯´é€šè¿‡<code>lock.RLocker()</code>å¾—æ¥çš„å€¼å°±æ˜¯<code>lock</code>å˜é‡ä¸­çš„è¯»é”å‘¢ï¼Ÿå®é™…ä¸Šï¼Œè¿™ä¸ªå€¼æ‰€æ‹¥æœ‰çš„<code>Lock</code>æ–¹æ³•å’Œ<code>Unlock</code>æ–¹æ³•ï¼Œåœ¨å…¶å†…éƒ¨ä¼šåˆ†åˆ«è°ƒç”¨<code>lock</code>å˜é‡çš„<code>RLock</code>æ–¹æ³•å’Œ<code>RUnlock</code>æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‰ä¸¤ä¸ªæ–¹æ³•ä»…ä»…æ˜¯åä¸¤ä¸ªæ–¹æ³•çš„ä»£ç†è€Œå·²ã€‚</p><p>å¥½äº†ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰å››ä¸ªå˜é‡ã€‚ä¸€ä¸ªæ˜¯ä»£è¡¨ä¿¡ç®±çš„<code>mailbox</code>ï¼Œä¸€ä¸ªæ˜¯ä»£è¡¨ä¿¡ç®±ä¸Šçš„é”çš„<code>lock</code>ã€‚è¿˜æœ‰ä¸¤ä¸ªæ˜¯ï¼Œä»£è¡¨äº†è“å¸½å­å°å­©å„¿çš„<code>sendCond</code>ï¼Œä»¥åŠä»£è¡¨äº†çº¢å¸½å­å°å­©å„¿çš„<code>recvCond</code>ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/36/5d/3619456ade9d45a4d9c0fbd22bb6fd5d.png?wh=1627*829\" alt=\"\"></p><p>ï¼ˆäº’æ–¥é”ä¸æ¡ä»¶å˜é‡ï¼‰</p><p>æˆ‘ï¼Œç°åœ¨æ˜¯ä¸€ä¸ªgoroutineï¼ˆæºå¸¦çš„<code>go</code>å‡½æ•°ï¼‰ï¼Œæƒ³è¦é€‚æ—¶åœ°å‘ä¿¡ç®±é‡Œæ”¾ç½®æƒ…æŠ¥å¹¶é€šçŸ¥ä½ ï¼Œåº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p><pre><code>lock.Lock()\nfor mailbox == 1 {\n sendCond.Wait()\n}\nmailbox = 1\nlock.Unlock()\nrecvCond.Signal()\n</code></pre><p>æˆ‘è‚¯å®šéœ€è¦å…ˆè°ƒç”¨<code>lock</code>å˜é‡çš„<code>Lock</code>æ–¹æ³•ã€‚æ³¨æ„ï¼Œè¿™ä¸ª<code>Lock</code>æ–¹æ³•åœ¨è¿™é‡Œæ„å‘³çš„æ˜¯ï¼šæŒæœ‰ä¿¡ç®±ä¸Šçš„é”ï¼Œå¹¶ä¸”æœ‰æ‰“å¼€ä¿¡ç®±çš„æƒåˆ©ï¼Œè€Œä¸æ˜¯é”ä¸Šè¿™ä¸ªé”ã€‚</p><p>ç„¶åï¼Œæˆ‘è¦æ£€æŸ¥<code>mailbox</code>å˜é‡çš„å€¼æ˜¯å¦ç­‰äº<code>1</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¦çœ‹çœ‹ä¿¡ç®±é‡Œæ˜¯ä¸æ˜¯è¿˜å­˜æœ‰æƒ…æŠ¥ã€‚å¦‚æœè¿˜æœ‰æƒ…æŠ¥ï¼Œé‚£ä¹ˆæˆ‘å°±å›å®¶å»ç­‰è“å¸½å­å°å­©å„¿äº†ã€‚</p><p>è¿™å°±æ˜¯é‚£æ¡<code>for</code>è¯­å¥ä»¥åŠå…¶ä¸­çš„è°ƒç”¨è¡¨è¾¾å¼<code>sendCond.Wait()</code>æ‰€è¡¨ç¤ºçš„å«ä¹‰äº†ã€‚ä½ å¯èƒ½ä¼šé—®ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œæ˜¯<code>for</code>è¯­å¥è€Œä¸æ˜¯<code>if</code>è¯­å¥å‘¢ï¼Ÿæˆ‘åœ¨åé¢ä¼šå¯¹æ­¤è¿›è¡Œè§£é‡Šçš„ã€‚</p><p>æˆ‘ä»¬å†å¾€åçœ‹ï¼Œå¦‚æœä¿¡ç®±é‡Œæ²¡æœ‰æƒ…æŠ¥ï¼Œé‚£ä¹ˆæˆ‘å°±æŠŠæ–°æƒ…æŠ¥æ”¾è¿›å»ï¼Œå…³ä¸Šä¿¡ç®±ã€é”ä¸Šé”ï¼Œç„¶åç¦»å¼€ã€‚ç”¨ä»£ç è¡¨è¾¾å‡ºæ¥å°±æ˜¯<code>mailbox = 1</code>å’Œ<code>lock.Unlock()</code>ã€‚</p><p>ç¦»å¼€ä¹‹åæˆ‘è¿˜è¦åšä¸€ä»¶äº‹ï¼Œé‚£å°±æ˜¯è®©çº¢å¸½å­å°å­©å„¿å‡†æ—¶å»ä½ å®¶æ¥¼ä¸‹è·¯è¿‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä¼šåŠæ—¶åœ°é€šçŸ¥ä½ â€œä¿¡ç®±é‡Œå·²ç»æœ‰æ–°æƒ…æŠ¥äº†â€ï¼Œæˆ‘ä»¬è°ƒç”¨<code>recvCond</code>çš„<code>Signal</code>æ–¹æ³•å°±å¯ä»¥å®ç°è¿™ä¸€æ­¥éª¤ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œä½ ç°åœ¨æ˜¯å¦ä¸€ä¸ªgoroutineï¼Œæƒ³è¦é€‚æ—¶åœ°ä»ä¿¡ç®±ä¸­è·å–æƒ…æŠ¥ï¼Œç„¶åé€šçŸ¥æˆ‘ã€‚</p><pre><code>lock.RLock()\nfor mailbox == 0 {\n recvCond.Wait()\n}\nmailbox = 0\nlock.RUnlock()\nsendCond.Signal()\n</code></pre><p>ä½ è·Ÿæˆ‘åšçš„äº‹æƒ…åœ¨æµç¨‹ä¸Šå…¶å®åŸºæœ¬ä¸€è‡´ï¼Œåªä¸è¿‡æ¯ä¸€æ­¥æ“ä½œçš„å¯¹è±¡æ˜¯ä¸åŒçš„ã€‚ä½ éœ€è¦è°ƒç”¨çš„æ˜¯<code>lock</code>å˜é‡çš„<code>RLock</code>æ–¹æ³•ã€‚å› ä¸ºä½ è¦è¿›è¡Œçš„æ˜¯è¯»æ“ä½œï¼Œå¹¶ä¸”ä¼šä½¿ç”¨<code>recvCond</code>å˜é‡ä½œä¸ºè¾…åŠ©ã€‚<code>recvCond</code>ä¸<code>lock</code>å˜é‡çš„è¯»é”æ˜¯å¯¹åº”çš„ã€‚</p><p>åœ¨æ‰“å¼€ä¿¡ç®±åï¼Œä½ è¦å…³æ³¨çš„æ˜¯ä¿¡ç®±é‡Œæ˜¯ä¸æ˜¯æ²¡æœ‰æƒ…æŠ¥ï¼Œä¹Ÿå°±æ˜¯æ£€æŸ¥<code>mailbox</code>å˜é‡çš„å€¼æ˜¯å¦ç­‰äº<code>0</code>ã€‚å¦‚æœå®ƒç¡®å®ç­‰äº<code>0</code>ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦å›å®¶å»ç­‰çº¢å¸½å­å°å­©å„¿ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨<code>recvCond</code>çš„<code>Wait</code>æ–¹æ³•ã€‚è¿™é‡Œä½¿ç”¨çš„ä¾ç„¶æ˜¯<code>for</code>è¯­å¥ã€‚</p><p>å¦‚æœä¿¡ç®±é‡Œæœ‰æƒ…æŠ¥ï¼Œé‚£ä¹ˆä½ å°±åº”è¯¥å–èµ°æƒ…æŠ¥ï¼Œå…³ä¸Šä¿¡ç®±ã€é”ä¸Šé”ï¼Œç„¶åç¦»å¼€ã€‚å¯¹åº”çš„ä»£ç æ˜¯<code>mailbox = 0</code>å’Œ<code>lock.RUnlock()</code>ã€‚ä¹‹åï¼Œä½ è¿˜éœ€è¦è®©è“å¸½å­å°å­©å„¿å‡†æ—¶å»æˆ‘å®¶æ¥¼ä¸‹è·¯è¿‡ã€‚è¿™æ ·æˆ‘å°±çŸ¥é“ä¿¡ç®±ä¸­çš„æƒ…æŠ¥å·²ç»è¢«ä½ è·å–äº†ã€‚</p><p>ä»¥ä¸Šè¿™äº›ï¼Œå°±æ˜¯å¯¹å’±ä»¬ä¿©è¦æ‰§è¡Œç§˜å¯†ä»»åŠ¡çš„ä»£ç å®ç°ã€‚å…¶ä¸­çš„æ¡ä»¶å˜é‡çš„ç”¨æ³•éœ€è¦ä½ ç‰¹åˆ«æ³¨æ„ã€‚</p><p>å†å¼ºè°ƒä¸€ä¸‹ï¼Œåªè¦æ¡ä»¶ä¸æ»¡è¶³ï¼Œæˆ‘å°±ä¼šé€šè¿‡è°ƒç”¨<code>sendCond</code>å˜é‡çš„<code>Wait</code>æ–¹æ³•ï¼Œå»ç­‰å¾…ä½ çš„é€šçŸ¥ï¼Œåªæœ‰åœ¨æ”¶åˆ°é€šçŸ¥ä¹‹åæˆ‘æ‰ä¼šå†æ¬¡æ£€æŸ¥ä¿¡ç®±ã€‚</p><p>å¦å¤–ï¼Œå½“æˆ‘éœ€è¦é€šçŸ¥ä½ çš„æ—¶å€™ï¼Œæˆ‘ä¼šè°ƒç”¨<code>recvCond</code>å˜é‡çš„<code>Signal</code>æ–¹æ³•ã€‚ä½ ä½¿ç”¨è¿™ä¸¤ä¸ªæ¡ä»¶å˜é‡çš„æ–¹å¼æ­£å¥½ä¸æˆ‘ç›¸åã€‚ä½ å¯èƒ½ä¹Ÿçœ‹å‡ºæ¥äº†ï¼Œåˆ©ç”¨æ¡ä»¶å˜é‡å¯ä»¥å®ç°å•å‘çš„é€šçŸ¥ï¼Œè€ŒåŒå‘çš„é€šçŸ¥åˆ™éœ€è¦ä¸¤ä¸ªæ¡ä»¶å˜é‡ã€‚è¿™ä¹Ÿæ˜¯æ¡ä»¶å˜é‡çš„åŸºæœ¬ä½¿ç”¨è§„åˆ™ã€‚</p><p>ä½ å¯ä»¥æ‰“å¼€demo61.goæ–‡ä»¶ï¼Œçœ‹åˆ°ä¸Šè¿°ä¾‹å­çš„å…¨éƒ¨å®ç°ä»£ç ã€‚</p><h2>æ€»ç»“</h2><p>æˆ‘ä»¬è¿™ä¸¤æœŸçš„æ–‡ç« ä¼šå›´ç»•æ¡ä»¶å˜é‡çš„å†…å®¹å±•å¼€ï¼Œæ¡ä»¶å˜é‡æ˜¯åŸºäºäº’æ–¥é”çš„ä¸€ç§åŒæ­¥å·¥å…·ï¼Œå®ƒå¿…é¡»æœ‰äº’æ–¥é”çš„æ”¯æ’‘æ‰èƒ½å‘æŒ¥ä½œç”¨ã€‚  æ¡ä»¶å˜é‡å¯ä»¥åè°ƒé‚£äº›æƒ³è¦è®¿é—®å…±äº«èµ„æºçš„çº¿ç¨‹ã€‚å½“å…±äº«èµ„æºçš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒå¯ä»¥è¢«ç”¨æ¥é€šçŸ¥è¢«äº’æ–¥é”é˜»å¡çš„çº¿ç¨‹ã€‚æˆ‘åœ¨æ–‡ç« ä¸¾äº†ä¸€ä¸ªä¸¤äººè®¿é—®ä¿¡ç®±çš„ä¾‹å­ï¼Œå¹¶ç”¨ä»£ç å®ç°äº†è¿™ä¸ªè¿‡ç¨‹ã€‚</p><h2>æ€è€ƒé¢˜</h2><p><code>*sync.Cond</code>ç±»å‹çš„å€¼å¯ä»¥è¢«ä¼ é€’å—ï¼Ÿé‚£<code>sync.Cond</code>ç±»å‹çš„å€¼å‘¢ï¼Ÿ</p><p>æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæˆ‘ä»¬ä¸‹æœŸå†è§ã€‚</p><p><a href=\"https://github.com/hyper0x/Golang_Puzzlers\">æˆ³æ­¤æŸ¥çœ‹Goè¯­è¨€ä¸“æ æ–‡ç« é…å¥—è¯¦ç»†ä»£ç ã€‚</a></p><p></p>","neighbors":{"left":{"article_title":"26 | sync.Mutexä¸sync.RWMutex","id":41350},"right":{"article_title":"28 | æ¡ä»¶å˜é‡sync.Cond ï¼ˆä¸‹ï¼‰","id":41717}},"comments":[{"had_liked":false,"id":35370,"user_name":"hello peter","can_delete":false,"product_type":"c1","uid":1201338,"ip_address":"","ucode":"4839DC4442CB0E","user_header":"https://static001.geekbang.org/account/avatar/00/12/54/ba/8721e403.jpg","comment_is_top":false,"comment_ctime":1540526510,"is_pvip":false,"replies":[{"id":"13311","content":"ä¼˜åŠ¿æ˜¯å¹¶å‘æµç¨‹ä¸Šçš„ååŒï¼Œchançš„ä¸»è¦ä»»åŠ¡æ˜¯ä¼ é€’æ•°æ®ã€‚å¦å¤–condæ˜¯æ›´ä½å±‚æ¬¡çš„å·¥å…·ï¼Œæ•ˆç‡æ›´é«˜ä¸€äº›ï¼Œä½†æ˜¯è‚¯å®šæ²¡æœ‰chanæ–¹ä¾¿ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1541482062,"ip_address":"","comment_id":35370,"utype":1}],"discussion_count":2,"race_medal":0,"score":"143274447278","product_id":100013101,"comment_content":"è€å¸ˆ, æ„Ÿè§‰è¿™ä¸ªé€ä¿¡çš„ä¾‹å­ä¼¼ä¹ç”¨chanelå®ç°æ›´ç®€å•.åœ¨ç½‘ä¸Šä¹ŸæŸ¥äº†ä¸€äº›ä¾‹å­, å‘ç°éƒ½å¯ä»¥ç”¨chanelæ›¿ä»£. é‚£ä½¿ç”¨sync.Cond çš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆå‘¢, æˆ–è€…æœ‰å“ªäº›ç‹¬ç‰¹çš„ä½¿ç”¨åœºæ™¯?","like_count":34,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427523,"discussion_content":"ä¼˜åŠ¿æ˜¯å¹¶å‘æµç¨‹ä¸Šçš„ååŒï¼Œchançš„ä¸»è¦ä»»åŠ¡æ˜¯ä¼ é€’æ•°æ®ã€‚å¦å¤–condæ˜¯æ›´ä½å±‚æ¬¡çš„å·¥å…·ï¼Œæ•ˆç‡æ›´é«˜ä¸€äº›ï¼Œä½†æ˜¯è‚¯å®šæ²¡æœ‰chanæ–¹ä¾¿ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1541482062,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1557834,"avatar":"https://static001.geekbang.org/account/avatar/00/17/c5/4a/340bda41.jpg","nickname":"æ°´é˜¡å¢¨","note":"","ucode":"87C949F0E295A9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":343003,"discussion_content":"è¿™ä¸ªé—®é¢˜é—®çš„å¥½ï¼Œæ¶¨å§¿åŠ¿äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610897594,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":31987,"user_name":"å±é›¨","can_delete":false,"product_type":"c1","uid":1202624,"ip_address":"","ucode":"700236847A5C94","user_header":"https://static001.geekbang.org/account/avatar/00/12/59/c0/6f02c096.jpg","comment_is_top":false,"comment_ctime":1539350133,"is_pvip":false,"replies":[{"id":"11828","content":"åŸºæœ¬æ­£ç¡®ã€‚Lockeræ˜¯æ¥å£ï¼Œæ˜¯å¼•ç”¨ç±»å‹ï¼Œnocopyæ˜¯ç»“æ„ä½“ï¼Œæ‰€ä»¥ç›´æ¥æ‹·è´å€¼çš„è¯ï¼Œåº•å±‚é”è¿˜æ˜¯ç”¨çš„åŒä¸€ä¸ªï¼Œä½¿ç”¨ä¸Šå®¹æ˜“å‡ºé—®é¢˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1539578589,"ip_address":"","comment_id":31987,"utype":1}],"discussion_count":1,"race_medal":0,"score":"126093401717","product_id":100013101,"comment_content":"ä¸ªäººç†è§£ï¼Œä¸ç¡®å®šå¯¹ä¸å¯¹ï¼Œè¯·è€å¸ˆè¯„åˆ¤ä¸€ä¸‹ï¼š<br>å› ä¸ºGoè¯­è¨€ä¼ é€’å¯¹è±¡æ—¶ï¼Œä½¿ç”¨çš„æ˜¯æµ…æ‹·è´çš„å€¼ä¼ é€’ï¼Œæ‰€ä»¥ï¼Œå½“ä¼ é€’ä¸€ä¸ªCondå¯¹è±¡æ—¶å¤åˆ¶äº†è¿™ä¸ªCondå¯¹è±¡ï¼Œä½†æ˜¯ä½å±‚ä¿å­˜çš„L(Lockerç±»å‹)ï¼ŒnoCopy(noCopyç±»å‹)ï¼Œnotify(notifyListç±»å‹)ï¼Œchecker(copyChecker)å¯¹è±¡çš„æŒ‡é’ˆæ²¡å˜ï¼Œå› æ­¤ï¼Œ*sync.Condå’Œsync.Condéƒ½å¯ä»¥ä¼ é€’ã€‚","like_count":30,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426596,"discussion_content":"åŸºæœ¬æ­£ç¡®ã€‚Lockeræ˜¯æ¥å£ï¼Œæ˜¯å¼•ç”¨ç±»å‹ï¼Œnocopyæ˜¯ç»“æ„ä½“ï¼Œæ‰€ä»¥ç›´æ¥æ‹·è´å€¼çš„è¯ï¼Œåº•å±‚é”è¿˜æ˜¯ç”¨çš„åŒä¸€ä¸ªï¼Œä½¿ç”¨ä¸Šå®¹æ˜“å‡ºé—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539578589,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":204578,"user_name":"ä¼ è¯´ä¸­çš„æˆå¤§å¤§","can_delete":false,"product_type":"c1","uid":1236766,"ip_address":"","ucode":"103543D6E706BF","user_header":"https://static001.geekbang.org/account/avatar/00/12/df/1e/cea897e8.jpg","comment_is_top":false,"comment_ctime":1586423919,"is_pvip":false,"replies":[{"id":"76910","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1586745777,"ip_address":"","comment_id":204578,"utype":1}],"discussion_count":1,"race_medal":0,"score":"66010933359","product_id":100013101,"comment_content":"è¿™å‡ å¤©ä¸€ç›´å¯¹æ¡ä»¶å˜é‡çš„ç†è§£æ¯”è¾ƒæ¨¡ç³Šï¼Œä½†æ˜¯æˆ‘æƒ³æ—¢ç„¶è¦å­¦å°±å­¦å¥½ äºæ˜¯åˆå»ç¿»äº†Unixç¯å¢ƒé«˜çº§ç¼–ç¨‹ æ€»ç®—æŠŠå®ƒè·Ÿäº’æ–¥é”åŒºåˆ†å¼€äº†<br>äº’æ–¥é” æ˜¯å¯¹ä¸€ä¸ªå…±äº«åŒºåŸŸè¿›è¡ŒåŠ é” æ‰€æœ‰çº¿ç¨‹éƒ½æ˜¯ä¸€ç§ç«äº‰çš„çŠ¶æ€å»è®¿é—®<br>è€Œæ¡ä»¶å˜é‡ ä¸»è¦æ˜¯é€šè¿‡æ¡ä»¶çŠ¶æ€æ¥åˆ¤æ–­ï¼Œå®é™…ä¸Šä»–è¿˜æ˜¯ä¼šé˜»å¡ åªä¸è¿‡ä¸ä¼šåƒäº’æ–¥é”ä¸€æ ·å»å‚ä¸ç«äº‰ï¼Œè€Œæ˜¯åœ¨å“ªé‡Œç­‰å¾…æ¡ä»¶å˜é‡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜è¿‡åçš„é€šçŸ¥ å†è¢«å”¤é†’","like_count":15,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491220,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586745777,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":123095,"user_name":"Geek_a8be59","can_delete":false,"product_type":"c1","uid":1563985,"ip_address":"","ucode":"BEC0F57B51DC44","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKdiaUiaCYQe9tibemaNU5ya7RrU3MYcSGEIG7zF27u0ZDnZs5lYxPb7KPrAsj3bibM79QIOnPXAatfIw/132","comment_is_top":false,"comment_ctime":1565604248,"is_pvip":false,"replies":[{"id":"45481","content":"å¦‚æœéƒ½ç”¨åŒä¸€ä¸ªäº’æ–¥é‡çš„è¯ï¼Œæ“ä½œåŒæ–¹å°±æ— æ³•ç‹¬ç«‹è¡Œäº‹ï¼Œè¿™å°±æ˜¯å®Œå…¨ä¸²è¡Œçš„æ“ä½œäº†ï¼Œæ•ˆç‡ä¸Šä¼šå¤§æ‰“æŠ˜æ‰£ã€‚<br><br>è¿›ä¸€æ­¥è¯´ï¼Œæœ¬æ¥å°±æ˜¯ä¸€ä¸ªå‘ä¸€ä¸ªæ”¶ï¼Œç†åº”ä¸€ä¸ªç”¨å†™é”ä¸€ä¸ªç”¨è¯»é”ï¼Œè¿™æ ·æ•ˆç‡é«˜ï¼Œä¹‹åæ‰©å±•èµ·æ¥ä¹Ÿæ–¹ä¾¿ã€‚å› ä¸ºè¯»ä¹‹é—´ä¸ç”¨äº’æ–¥ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1565795418,"ip_address":"","comment_id":123095,"utype":1}],"discussion_count":3,"race_medal":0,"score":"57400179096","product_id":100013101,"comment_content":"var mailbox uint8<br>var lock sync.RWMutex<br>sendCond := sync.NewCond(&amp;lock)<br>recvCond := sync.NewCond(&amp;lock)<br>ä¸ºä»€ä¹ˆä¸èƒ½å‘ä¸Šé¢é‚£æ ·éƒ½ç”¨åŒä¸€ä¸ªäº’æ–¥é‡ï¼Œéè¦ä¸¤ä¸ªä¸åŒå‘¢ï¼Ÿè€å¸ˆï¼Œèƒ½è®²ä¸€ä¸‹åŒºåˆ«ä¹ˆ<br>","like_count":13,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462537,"discussion_content":"å¦‚æœéƒ½ç”¨åŒä¸€ä¸ªäº’æ–¥é‡çš„è¯ï¼Œæ“ä½œåŒæ–¹å°±æ— æ³•ç‹¬ç«‹è¡Œäº‹ï¼Œè¿™å°±æ˜¯å®Œå…¨ä¸²è¡Œçš„æ“ä½œäº†ï¼Œæ•ˆç‡ä¸Šä¼šå¤§æ‰“æŠ˜æ‰£ã€‚\n\nè¿›ä¸€æ­¥è¯´ï¼Œæœ¬æ¥å°±æ˜¯ä¸€ä¸ªå‘ä¸€ä¸ªæ”¶ï¼Œç†åº”ä¸€ä¸ªç”¨å†™é”ä¸€ä¸ªç”¨è¯»é”ï¼Œè¿™æ ·æ•ˆç‡é«˜ï¼Œä¹‹åæ‰©å±•èµ·æ¥ä¹Ÿæ–¹ä¾¿ã€‚å› ä¸ºè¯»ä¹‹é—´ä¸ç”¨äº’æ–¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565795418,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2275396,"avatar":"","nickname":"13549804879","note":"","ucode":"303DFF7082E504","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":326149,"discussion_content":"è€å¸ˆï¼Œå¤šä¸ªè¯»ä¹‹é—´ä¹Ÿèƒ½å¹¶è¡Œå—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605532743,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1954540,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/d2/ec/27de7020.jpg","nickname":"zzz","note":"","ucode":"DF8939F2D953BE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2275396,"avatar":"","nickname":"13549804879","note":"","ucode":"303DFF7082E504","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":354415,"discussion_content":"å¯ä»¥çš„\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615290280,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":326149,"ip_address":""},"score":354415,"extra":""}]}]},{"had_liked":false,"id":160353,"user_name":"ç–¯ç´","can_delete":false,"product_type":"c1","uid":1099379,"ip_address":"","ucode":"82ACAA4A27753D","user_header":"https://static001.geekbang.org/account/avatar/00/10/c6/73/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1575940234,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"31640711306","product_id":100013101,"comment_content":"ç§˜å¯†æ¥å¤´çš„ç±»æ¯”å½¢è±¡ç”ŸåŠ¨ï¼Œå­¦ä¹ è¿‡ç¨‹è½»æ¾æœ‰è¶£åˆä¸å¤±æ·±åº¦ã€‚","like_count":7},{"had_liked":false,"id":31815,"user_name":"æ–‡@é›¨è·¯","can_delete":false,"product_type":"c1","uid":1103072,"ip_address":"","ucode":"1EE59E03F9939C","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/e0/513d185e.jpg","comment_is_top":false,"comment_ctime":1539306626,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27309110402","product_id":100013101,"comment_content":"æŒ‡é’ˆå¯ä»¥ä¼ é€’ï¼Œå€¼ä¸å¯ä»¥ï¼Œä¼ é€’å€¼ä¼šæ‹·è´ä¸€ä»½ï¼Œå¯¼è‡´å‡ºç°ä¸¤ä»½æ¡ä»¶å˜é‡ï¼Œå½¼æ­¤ä¹‹é—´æ²¡æœ‰è”ç³»","like_count":6},{"had_liked":false,"id":84283,"user_name":"ğŸ»","can_delete":false,"product_type":"c1","uid":1043072,"ip_address":"","ucode":"534EDAD496A0E6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ea/80/8759e4c1.jpg","comment_is_top":false,"comment_ctime":1554819295,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23029655775","product_id":100013101,"comment_content":"éœ€ä¼ é€’ *sync.Cond<br><br>å› ä¸º Cond ç»“æ„ä½“ä¸­çš„ notify å˜é‡å’Œ checker å˜é‡éƒ½æ˜¯å€¼ç±»å‹ï¼Œä¼ é€’sync.Cond ä¼šå¤åˆ¶å€¼ï¼Œè¿™æ ·ä¸¤ä¸ªé”ä¿ç•™çš„è¢«é˜»å¡çš„ Goroutine å°±ä¸åŒäº†ã€‚","like_count":6},{"had_liked":false,"id":55631,"user_name":"beiliu","can_delete":false,"product_type":"c1","uid":1292128,"ip_address":"","ucode":"06E1EC1244A52B","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLmBgic9UlGySyG377pCVzNnbgsGttrKTCFztunJlBTDS32oTyHsJjAFJJsYJyhk9cNE5OZeGKWJ6Q/132","comment_is_top":false,"comment_ctime":1546247086,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"23021083566","product_id":100013101,"comment_content":"æ‚¨å¥½ï¼Œè€å¸ˆï¼Œå®˜æ–¹æ–‡æ¡£æ˜¯å»ºè®®ï¼Œsingalåœ¨é”ä½çš„æƒ…å†µä¸‹ä½¿ç”¨çš„â€œSignalå”¤é†’ç­‰å¾…cçš„ä¸€ä¸ªçº¿ç¨‹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚è°ƒç”¨è€…åœ¨è°ƒç”¨æœ¬æ–¹æ³•æ—¶ï¼Œå»ºè®®ï¼ˆä½†å¹¶éå¿…é¡»ï¼‰ä¿æŒc.Lçš„é”å®šâ€œ","like_count":5},{"had_liked":false,"id":50765,"user_name":"ming","can_delete":false,"product_type":"c1","uid":1108056,"ip_address":"","ucode":"65E4A1E07D11A3","user_header":"https://static001.geekbang.org/account/avatar/00/10/e8/58/ecb493dc.jpg","comment_is_top":false,"comment_ctime":1545041640,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"23019878120","product_id":100013101,"comment_content":"å¤šroutineä»ä¿¡ç®±ä¸­è·å–æƒ…æŠ¥, éƒ½åœ¨ç­‰mailboxå˜é‡çš„å€¼ä¸ä¸º0çš„æ—¶å€™å†æŠŠå®ƒçš„å€¼å˜ä¸º0ï¼Œ<br>è¿™ä¸ª RLock é™åˆ¶ä¸äº†å†™æ“ä½œï¼Œå¯èƒ½ä¼šæœ‰å¤šä¸ªroutineåŒæ—¶å°† mailbox å˜ä¸º0çš„ï¼Œè·Ÿæ–‡ä¸­çš„åœºæ™¯æœ‰äº›ä¸åˆã€‚ <br>ä¸çŸ¥é“æˆ‘ç†è§£çš„æœ‰æ²¡æœ‰é—®é¢˜<br>","like_count":5,"discussions":[{"author":{"id":1033740,"avatar":"","nickname":"Sky","note":"","ucode":"7C585132491E8C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":449,"discussion_content":"æˆ‘è§‰å¾—æ˜¯æœ‰é—®é¢˜çš„ï¼Œè¿™é‡Œé¢çš„å‡è®¾â€œRLock é™åˆ¶ä¸äº†å†™æ“ä½œâ€æ˜¯ä¸å¯¹çš„ï¼ŒRLockè·å–ä¹‹åï¼Œæ˜¯å†™ä¸äº†çš„ï¼ˆå› ä¸ºå†™å…¥æ–¹è¿™æ—¶å€™æ²¡æ³•è·å–åˆ°å†™é”Lockï¼‰","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1561597008,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1108056,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e8/58/ecb493dc.jpg","nickname":"ming","note":"","ucode":"65E4A1E07D11A3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364510,"discussion_content":"ä»£ç ä¸­ä½¿ç”¨,å•å‘é€šçŸ¥ï¼ˆsignalï¼‰ï¼Œä¸ä¼šå­˜åœ¨å¤šä¸ªroutineåŒæ—¶è¢«å”¤é†’æ‰€ä»¥æ²¡æœ‰é—®é¢˜ã€‚\nå¦‚æœä½¿ç”¨ å¹¿æ’­é€šçŸ¥ï¼ˆbroadcastï¼‰ï¼Œåˆ™æœ‰å¯èƒ½å‡ºé—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617505954,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1108056,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e8/58/ecb493dc.jpg","nickname":"ming","note":"","ucode":"65E4A1E07D11A3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":109883,"discussion_content":"\nlock.RLock()\nfor mailbox == 0 {\n recvCond.Wait()\n}\nmailbox = 0\nlock.RUnlock()\nsendCond.Signal()\n\nç¬¬äº”è¡Œä»£ç å°±æ˜¯ï¼Œå†™æ“ä½œå“Ÿã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577713895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":258259,"user_name":"q","can_delete":false,"product_type":"c1","uid":1038802,"ip_address":"","ucode":"9FE8DF709D9953","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d9/d2/4ae9b17f.jpg","comment_is_top":false,"comment_ctime":1604362830,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14489264718","product_id":100013101,"comment_content":"ä¸ªäººæ„Ÿè§‰ï¼Œä»åº•å±‚åŸç†è§£é‡Šæ¡ä»¶å˜é‡å¯èƒ½æ›´å®¹æ˜“ç†è§£","like_count":4},{"had_liked":false,"id":245645,"user_name":"éƒ­æ˜Ÿ","can_delete":false,"product_type":"c1","uid":1182219,"ip_address":"","ucode":"8A0F5DF80E0C61","user_header":"https://static001.geekbang.org/account/avatar/00/12/0a/0b/985d3800.jpg","comment_is_top":false,"comment_ctime":1599015775,"is_pvip":false,"replies":[{"id":"90344","content":"æˆ‘åœ¨æ–‡ç« é‡Œè¯´äº†å•Šï¼Œæœ‰å¯èƒ½ä¼šç¢°åˆ°â€œå‡å”¤é†’â€çš„æƒ…å†µã€‚è€Œä¸”ï¼Œå¦‚æœå­˜åœ¨â€œæœ‰å¤šä¸ªwaitä½†åªéœ€å”¤é†’ä¸€ä¸ªâ€çš„æƒ…å†µï¼Œä¹Ÿéœ€è¦ç”¨forè¯­å¥ã€‚åœ¨forè¯­å¥é‡Œï¼Œå”¤é†’åå¯ä»¥å†æ¬¡æ£€æŸ¥çŠ¶æ€ï¼Œå¦‚æœçŠ¶æ€ç¬¦åˆå°±å¼€å§‹åç»­å·¥ä½œï¼Œå¦‚æœä¸ç¬¦åˆå°±å†æ¬¡waitã€‚ç”¨ifè¯­å¥å°±åŠä¸åˆ°ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1599019386,"ip_address":"","comment_id":245645,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10188950367","product_id":100013101,"comment_content":"åœ¨for å¾ªç¯ä¸­ä½¿ç”¨ wait,åœ¨æˆ‘çš„æµ‹è¯•ä¸­,å½“æ¡ä»¶å˜é‡å¤„äºwaitçŠ¶æ€æ—¶,å¦‚æœæ²¡æœ‰å”¤é†’,å½“å‰åç¨‹ä¼šä¸€ç›´é˜»å¡ç­‰å¾…åœ¨waitè¿™è¡Œä»£ç ,å› æ­¤ä½¿ç”¨for å’Œ ä½¿ç”¨if å®é™…æœ€ç»ˆç»“æœæ˜¯ç›¸åŒçš„,ä¸ºä»€ä¹ˆè¦ä½¿ç”¨forå‘¢?<br><br>package lesson27<br><br>import (<br>\t&quot;sync&quot;<br>\t&quot;testing&quot;<br>\t&quot;time&quot;<br>)<br><br>&#47;&#47; åˆ©ç”¨æ¡ä»¶å˜é‡å®ç°åè°ƒå¤šåç¨‹å‘å–ä¿¡ä»¶æ“ä½œ<br>func TestCond(t *testing.T) {<br>\tvar wg sync.WaitGroup<br>\tvar mu sync.RWMutex<br>\t&#47;&#47; ä¿¡ç®±<br>\tmail := false<br>\t&#47;&#47; ä¸¤ä¸ªæ¡ä»¶å˜é‡<br>\t&#47;&#47; å‘é€ä¿¡æ¡ä»¶å˜é‡<br>\tsendCond := sync.NewCond(&amp;mu)<br>\t&#47;&#47; æ¥æ”¶ä¿¡æ¡ä»¶å˜é‡, å¯¹äºæ¥æ”¶å®é™…æ˜¯åªè¯»æ“ä½œ,å› æ­¤åªéœ€è¦ä½¿ç”¨è¯»é”å°±å¯ä»¥<br>\treceiveCond := sync.NewCond(mu.RLocker())<br>\t&#47;&#47; æœ€å¤§å‘é€æ¥æ”¶æ¬¡æ•°<br>\tmax := 5<br>\twg.Add(2)<br>\t&#47;&#47; å‘é€äººåç¨‹<br>\tgo func(i int) {<br>\t\tfor ; i &gt; 0; i-- {<br>\t\t\ttime.Sleep(time.Second * 3)<br>\t\t\tmu.Lock()<br>\t\t\t&#47;&#47; å¦‚æœä¿¡ç®±ä¸ä¸ºç©º,åˆ™éœ€è¦ç­‰å¾…<br>\t\t\t&#47;&#47;for mail {<br>\t\t\tif mail {<br>\t\t\t\t&#47;&#47; å‘é€è€…ç­‰å¾…<br>\t\t\t\tt.Log(&quot;sendCondå‡†å¤‡è¿›å…¥ç­‰å¾…é˜Ÿåˆ—&quot;)<br>\t\t\t\tsendCond.Wait()<br>\t\t\t\tt.Log(&quot;sendCondè¿›å…¥ç­‰å¾…é˜Ÿåˆ—&quot;)<br>\t\t\t}<br>\t\t\tmail = true<br>\t\t\tt.Log(&quot;å‘é€ä¿¡ä»¶æˆåŠŸ&quot;)<br>\t\t\tmu.Unlock()<br>\t\t\t&#47;&#47; é€šçŸ¥å‘é€è€…<br>\t\t\treceiveCond.Signal()<br>\t\t\tt.Log(&quot;å”¤é†’receiveCond&quot;)<br>\t\t}<br>\t\twg.Done()<br>\t}(max)<br><br>\tgo func(i int) {<br>\t\tfor ; i &gt; 0; i-- {<br>\t\t\tmu.RLock()<br>\t\t\t&#47;&#47;for !mail {<br>\t\t\tif !mail {<br>\t\t\t\t&#47;&#47;æ¥æ”¶è€…ç­‰å¾…<br>\t\t\t\tt.Log(&quot;receiveCondå‡†å¤‡è¿›å…¥ç­‰å¾…é˜Ÿåˆ—&quot;)<br>\t\t\t\treceiveCond.Wait() &#47;&#47; å¦‚æœæ²¡æœ‰è¢«å”¤é†’ä¼šä¸€ç›´é˜»å¡åœ¨æ­¤<br>\t\t\t\tt.Log(&quot;receiveCondè¿›å…¥ç­‰å¾…é˜Ÿåˆ—&quot;)<br>\t\t\t}<br>\t\t\tmail = false<br>\t\t\tt.Log(&quot;è·å–ä¿¡ä»¶æˆåŠŸ&quot;)<br>\t\t\tmu.RUnlock()<br>\t\t\t&#47;&#47; é€šçŸ¥æ¥æ”¶è€…<br>\t\t\tsendCond.Signal()<br>\t\t\tt.Log(&quot;å”¤é†’sendCond&quot;)<br>\t\t}<br>\t\twg.Done()<br>\t}(max)<br>\twg.Wait()<br>}<br>","like_count":3,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":504939,"discussion_content":"æˆ‘åœ¨æ–‡ç« é‡Œè¯´äº†å•Šï¼Œæœ‰å¯èƒ½ä¼šç¢°åˆ°â€œå‡å”¤é†’â€çš„æƒ…å†µã€‚è€Œä¸”ï¼Œå¦‚æœå­˜åœ¨â€œæœ‰å¤šä¸ªwaitä½†åªéœ€å”¤é†’ä¸€ä¸ªâ€çš„æƒ…å†µï¼Œä¹Ÿéœ€è¦ç”¨forè¯­å¥ã€‚åœ¨forè¯­å¥é‡Œï¼Œå”¤é†’åå¯ä»¥å†æ¬¡æ£€æŸ¥çŠ¶æ€ï¼Œå¦‚æœçŠ¶æ€ç¬¦åˆå°±å¼€å§‹åç»­å·¥ä½œï¼Œå¦‚æœä¸ç¬¦åˆå°±å†æ¬¡waitã€‚ç”¨ifè¯­å¥å°±åŠä¸åˆ°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599019386,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":217468,"user_name":"ä¼šç©code","can_delete":false,"product_type":"c1","uid":1325282,"ip_address":"","ucode":"9220B072AF68C7","user_header":"https://static001.geekbang.org/account/avatar/00/14/38/e2/28aa8e6c.jpg","comment_is_top":false,"comment_ctime":1589510149,"is_pvip":false,"replies":[{"id":"80472","content":"åœ¨åªæœ‰ä¸€ä¸ªâ€œå–ä¿¡è€…â€çš„æƒ…å†µä¸‹ï¼Œè¿™é‡Œä½¿ç”¨è¯»é”æ˜¯æ²¡é—®é¢˜çš„ã€‚ä½†å¦‚æœæœ‰å¤šä¸ªâ€œå–ä¿¡è€…â€å°±éœ€è¦ç”¨å†™é”å•¦ã€‚ä½ å¯ä»¥çœ‹ä¸€çœ‹ä¸‹ä¸€ç¯‡æ–‡ç« å¯¹åº”çš„demoæ–‡ä»¶ï¼ˆdemo62.goï¼‰ï¼Œå…¶ä¸­å°±æœ‰å¤šä¸ªâ€œå–ä¿¡è€…â€çš„æ¼”ç¤ºã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1589523751,"ip_address":"","comment_id":217468,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10179444741","product_id":100013101,"comment_content":"è€å¸ˆï¼Œä¸æ‡‚è¿™é‡Œçš„recvCondä¸ºä»€ä¹ˆå¯ä»¥ç”¨è¯»é”å‘¢ï¼Ÿè¿™é‡Œä¹Ÿæ˜¯æœ‰å¯¹èµ„æºåšæ“ä½œçš„å‘€ï¼ˆå°†mailboxç½®ä¸º0ï¼‰ï¼Œç”¨è¯»é”ä¸ä¼šæœ‰é—®é¢˜å—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495159,"discussion_content":"åœ¨åªæœ‰ä¸€ä¸ªâ€œå–ä¿¡è€…â€çš„æƒ…å†µä¸‹ï¼Œè¿™é‡Œä½¿ç”¨è¯»é”æ˜¯æ²¡é—®é¢˜çš„ã€‚ä½†å¦‚æœæœ‰å¤šä¸ªâ€œå–ä¿¡è€…â€å°±éœ€è¦ç”¨å†™é”å•¦ã€‚ä½ å¯ä»¥çœ‹ä¸€çœ‹ä¸‹ä¸€ç¯‡æ–‡ç« å¯¹åº”çš„demoæ–‡ä»¶ï¼ˆdemo62.goï¼‰ï¼Œå…¶ä¸­å°±æœ‰å¤šä¸ªâ€œå–ä¿¡è€…â€çš„æ¼”ç¤ºã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589523751,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1449647,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1e/af/5b59f524.jpg","nickname":"yinyin","note":"","ucode":"D6C6E74D213EB4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553949,"discussion_content":"m","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646140693,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":347904,"user_name":"å•¦å•¦å•¦","can_delete":false,"product_type":"c1","uid":3020525,"ip_address":"","ucode":"243C4F9C12F87D","user_header":"https://static001.geekbang.org/account/avatar/00/2e/16/ed/acd6df5e.jpg","comment_is_top":false,"comment_ctime":1654570136,"is_pvip":false,"replies":[{"id":"126806","content":"â€œä¸€ç»„ç›¸å…³ä¸´ç•ŒåŒºâ€å¯ä»¥æ˜¯æ“ä½œåŒä¸€ä¸ªå…±äº«èµ„æºçš„å¤šæ®µä»£ç ï¼Œä¹Ÿå¯ä»¥æ˜¯åœ¨é€»è¾‘ä¸Šæœ‰å¼ºç›¸å…³å…³ç³»çš„å¤šæ®µä»£ç ã€‚åœ¨è¿™é‡Œï¼Œè¿™ä¸¤æ®µä»£ç éƒ½æ˜¯é’ˆå¯¹ mailbox å˜é‡çš„ï¼Œå±äºå‰è€…ã€‚åªä¸è¿‡å…¶ä¸­è¿˜å¤¹æ‚äº† ä¸åŒæ¡ä»¶å˜é‡ çš„ Wait æ“ä½œã€‚<br><br>æˆ‘æ€»ä½“å†è¯´ä¸€ä¸‹å§ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸¤ä¸ªç»´åº¦æ¥ç†è§£äº’æ–¥é”çš„ä¿æŠ¤ä½œç”¨ï¼š<br><br>1. å¤šä¸ªgoroutineå¹¶å‘æ‰§è¡ŒåŒä¸€æ®µä»£ç ï¼ˆå¦‚ä¸€ä¸ªå‡½æ•°æˆ–æ–¹æ³•ï¼‰ï¼Œä¸”è¿™æ®µä»£ç è®¿é—®æˆ–ä¿®æ”¹äº†å…±äº«çš„çŠ¶æ€æˆ–èµ„æºã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨äº’æ–¥é”ä¿æŠ¤è¿™æ®µä»£ç ã€‚è¿™ç›¸å½“äºä¿æŠ¤äº†é‚£ä¸ªå…±äº«çŠ¶æ€æˆ–èµ„æºã€‚è¿™é‡Œçš„â€œè¿™æ®µä»£ç â€å°±æ˜¯ä¸€ä¸ªä¸´ç•ŒåŒºã€‚<br><br>2. ï¼ˆå¦‚æœ¬ä¾‹ï¼‰å¤šä¸ªgoroutineä¸­çš„ä»£ç ï¼ˆç¡®åˆ‡åœ°è¯´ï¼Œæ˜¯goå‡½æ•°ï¼‰ç›´æ¥è®¿é—®æˆ–ä¿®æ”¹äº†å…±äº«çš„çŠ¶æ€æˆ–èµ„æºã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¾€å¾€å°±éœ€è¦ä½¿ç”¨åŒä¸€ä¸ªäº’æ–¥é”åŒæ—¶å»ä¿æŠ¤é‚£å‡ æ®µç›¸å…³çš„ä»£ç ã€‚è¿™é‡Œçš„å‡ æ®µä»£ç å„è‡ªæˆä¸ºç‹¬ç«‹çš„ä¸´ç•ŒåŒºï¼Œä½†å®ƒä»¬æ˜¯ç›¸å…³çš„ã€‚è¿™å°±æ˜¯æˆ‘è¯´çš„â€œä¸€ç»„ç›¸å…³çš„ä¸´ç•ŒåŒºâ€ã€‚<br><br>ä»¥ä¸Šè¿™ä¸¤ä¸ªç»´åº¦è¯´çš„å°±æ˜¯äº’æ–¥é”çš„å¸¸ç”¨åœºæ™¯ã€‚ä¸€ä¸ªæ˜¯â€œå•æ®µä»£ç çš„å¹¶å‘æ‰§è¡Œâ€ï¼Œä¸€ä¸ªæ˜¯â€œå¤šæ®µä»£ç çš„å„è‡ªæ‰§è¡Œï¼ˆä¹Ÿæ˜¯å¹¶å‘æ‰§è¡Œï¼‰â€ã€‚å…³é”®æ˜¯ï¼Œä¸ç®¡æ˜¯å•æ®µä»£ç è¿˜æ˜¯å¤šæ®µä»£ç ï¼Œå®ƒä»¬éƒ½åˆ†åˆ«è®¿é—®äº†åŒä¸€ä¸ªå…±äº«çš„ä¸œè¥¿ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1026643","ctime":1654601810,"ip_address":"","comment_id":347904,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5949537432","product_id":100013101,"comment_content":"æƒ³è¯·é—®ä¸‹è€å¸ˆï¼Œä¸¤ä¸ªgoroutineéƒ½ä½¿ç”¨äº†åŒä¸€æŠŠé”ï¼Œ26è®²ï¼ˆMutexï¼‰é‡Œä¸æ˜¯è¯´æ˜ï¼Œå°½é‡ä½¿ç”¨ï¼šæ˜¯è®©æ¯ä¸€ä¸ªäº’æ–¥é”éƒ½åªä¿æŠ¤ä¸€ä¸ªä¸´ç•ŒåŒºæˆ–ä¸€ç»„ç›¸å…³ä¸´ç•ŒåŒºã€‚æœ‰ç‚¹æä¸æ˜ç™½ï¼Œæœ›è€å¸ˆæŒ‡ç‚¹<br><br><br><br>go func(max int) { &#47;&#47; ç”¨äºå‘ä¿¡ã€‚<br>\t\tdefer func() {<br>\t\t\tsign &lt;- struct{}{}<br>\t\t}()<br>\t\tfor i := 1; i &lt;= max; i++ {<br>\t\t\ttime.Sleep(time.Millisecond * 500)<br>\t\t\tlock.Lock()<br>\t\t\tfor mailbox == 1 {<br>\t\t\t\tsendCond.Wait()<br>\t\t\t}<br>\t\t\tlog.Printf(&quot;sender [%d]: the mailbox is empty.&quot;, i)<br>\t\t\tmailbox = 1<br>\t\t\tlog.Printf(&quot;sender [%d]: the letter has been sent.&quot;, i)<br>\t\t\tlock.Unlock()<br>\t\t\trecvCond.Signal()<br>\t\t}<br>\t}(max)<br>\tgo func(max int) { &#47;&#47; ç”¨äºæ”¶ä¿¡ã€‚<br>\t\tdefer func() {<br>\t\t\tsign &lt;- struct{}{}<br>\t\t}()<br>\t\tfor j := 1; j &lt;= max; j++ {<br>\t\t\ttime.Sleep(time.Millisecond * 500)<br>\t\t\tlock.RLock()<br>\t\t\tfor mailbox == 0 {<br>\t\t\t\trecvCond.Wait()<br>\t\t\t}<br>\t\t\tlog.Printf(&quot;receiver [%d]: the mailbox is full.&quot;, j)<br>\t\t\tmailbox = 0<br>\t\t\tlog.Printf(&quot;receiver [%d]: the letter has been received.&quot;, j)<br>\t\t\tlock.RUnlock()<br>\t\t\tsendCond.Signal()<br>\t\t}<br>\t}(max)","like_count":2,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575117,"discussion_content":"â€œä¸€ç»„ç›¸å…³ä¸´ç•ŒåŒºâ€å¯ä»¥æ˜¯æ“ä½œåŒä¸€ä¸ªå…±äº«èµ„æºçš„å¤šæ®µä»£ç ï¼Œä¹Ÿå¯ä»¥æ˜¯åœ¨é€»è¾‘ä¸Šæœ‰å¼ºç›¸å…³å…³ç³»çš„å¤šæ®µä»£ç ã€‚åœ¨è¿™é‡Œï¼Œè¿™ä¸¤æ®µä»£ç éƒ½æ˜¯é’ˆå¯¹ mailbox å˜é‡çš„ï¼Œå±äºå‰è€…ã€‚åªä¸è¿‡å…¶ä¸­è¿˜å¤¹æ‚äº† ä¸åŒæ¡ä»¶å˜é‡ çš„ Wait æ“ä½œã€‚\n\næˆ‘æ€»ä½“å†è¯´ä¸€ä¸‹å§ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸¤ä¸ªç»´åº¦æ¥ç†è§£äº’æ–¥é”çš„ä¿æŠ¤ä½œç”¨ï¼š\n\n1. å¤šä¸ªgoroutineå¹¶å‘æ‰§è¡ŒåŒä¸€æ®µä»£ç ï¼ˆå¦‚ä¸€ä¸ªå‡½æ•°æˆ–æ–¹æ³•ï¼‰ï¼Œä¸”è¿™æ®µä»£ç è®¿é—®æˆ–ä¿®æ”¹äº†å…±äº«çš„çŠ¶æ€æˆ–èµ„æºã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨äº’æ–¥é”ä¿æŠ¤è¿™æ®µä»£ç ã€‚è¿™ç›¸å½“äºä¿æŠ¤äº†é‚£ä¸ªå…±äº«çŠ¶æ€æˆ–èµ„æºã€‚è¿™é‡Œçš„â€œè¿™æ®µä»£ç â€å°±æ˜¯ä¸€ä¸ªä¸´ç•ŒåŒºã€‚\n\n2. ï¼ˆå¦‚æœ¬ä¾‹ï¼‰å¤šä¸ªgoroutineä¸­çš„ä»£ç ï¼ˆç¡®åˆ‡åœ°è¯´ï¼Œæ˜¯goå‡½æ•°ï¼‰ç›´æ¥è®¿é—®æˆ–ä¿®æ”¹äº†å…±äº«çš„çŠ¶æ€æˆ–èµ„æºã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¾€å¾€å°±éœ€è¦ä½¿ç”¨åŒä¸€ä¸ªäº’æ–¥é”åŒæ—¶å»ä¿æŠ¤é‚£å‡ æ®µç›¸å…³çš„ä»£ç ã€‚è¿™é‡Œçš„å‡ æ®µä»£ç å„è‡ªæˆä¸ºç‹¬ç«‹çš„ä¸´ç•ŒåŒºï¼Œä½†å®ƒä»¬æ˜¯ç›¸å…³çš„ã€‚è¿™å°±æ˜¯æˆ‘è¯´çš„â€œä¸€ç»„ç›¸å…³çš„ä¸´ç•ŒåŒºâ€ã€‚\n\nä»¥ä¸Šè¿™ä¸¤ä¸ªç»´åº¦è¯´çš„å°±æ˜¯äº’æ–¥é”çš„å¸¸ç”¨åœºæ™¯ã€‚ä¸€ä¸ªæ˜¯â€œå•æ®µä»£ç çš„å¹¶å‘æ‰§è¡Œâ€ï¼Œä¸€ä¸ªæ˜¯â€œå¤šæ®µä»£ç çš„å„è‡ªæ‰§è¡Œï¼ˆä¹Ÿæ˜¯å¹¶å‘æ‰§è¡Œï¼‰â€ã€‚å…³é”®æ˜¯ï¼Œä¸ç®¡æ˜¯å•æ®µä»£ç è¿˜æ˜¯å¤šæ®µä»£ç ï¼Œå®ƒä»¬éƒ½åˆ†åˆ«è®¿é—®äº†åŒä¸€ä¸ªå…±äº«çš„ä¸œè¥¿ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654601810,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":307335,"user_name":"lesserror","can_delete":false,"product_type":"c1","uid":1351076,"ip_address":"","ucode":"25A54D1165FCF6","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","comment_is_top":false,"comment_ctime":1629034684,"is_pvip":false,"replies":[{"id":"111311","content":"æ­£å› ä¸ºæœ‰äº†æ¡ä»¶å˜é‡æ‰ä¼šæœ‰è¿™æ ·çš„åŒæ­¥çŠ¶æ€å•Šã€‚æ¡ä»¶å˜é‡å°±ç›¸å½“äºä¿¡å·å¼¹çš„å‘å°„å™¨ã€‚<br><br>åŒæ–¹å„æœ‰ä¸€ä¸ªä¿¡å·å¼¹å‘å°„å™¨ï¼ˆå°±åƒç¤ºä¾‹ç¨‹åºä¸­çš„ sendCond å’Œ recvCondï¼‰å¹¶äº’ç›¸å‘é€ä¿¡å·ï¼Œè¿™å°±æ˜¯ demo61 æ‰€åšçš„ã€‚<br><br><br>è¿™ä¸ªç¨‹åºä½ ä¹Ÿå¯ä»¥è¿™æ ·ç†è§£ï¼š<br><br>A å’Œ B åœ¨ä¸‹è±¡æ£‹ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š<br><br>A èµ°äº†ä¸€æ­¥æ£‹ï¼Œå¹¶å‘é€ä¿¡å·ç¤ºæ„è®© B èµ°ä¸€æ­¥ï¼›<br>B æ”¶åˆ°ä¿¡å·èµ°äº†ä¸€æ­¥æ£‹ï¼Œç„¶ååè¿‡æ¥å‘ A å‘é€ä¿¡å·ç¤ºæ„â€œæˆ‘èµ°äº†ä¸€æ­¥ï¼Œè¯¥ä½ äº†â€ï¼›<br>A å†èµ°ä¸€æ­¥æ£‹ï¼Œå¹¶å†æ¬¡å‘å°„ä¿¡å·ç¤ºæ„è®© B å†èµ°ä¸€æ­¥ï¼›<br>B å†èµ°ä¸€æ­¥åï¼Œå†å‘å°„ä¿¡å·å‘Šè¯‰ Aï¼›<br>å¦‚æ­¤å¾ªç¯å¾€å¤ã€‚<br><br><br>å†åšä¸€ä¸ªç±»æ¯”ï¼š<br><br>å•ä¸ªæ¡ä»¶å˜é‡ç”¨äºâ€œæ•™å®˜â€æŒ‡æŒ¥â€œå£«å…µâ€ï¼Œâ€œæ•™å®˜â€åªèƒ½æœ‰ä¸€ä¸ªï¼Œè€Œâ€œå£«å…µâ€å¯ä»¥æœ‰å¤šä¸ªï¼ˆdemo61 ä¸­åªæœ‰ä¸€ä¸ªå£«å…µï¼‰ã€‚åœ¨ demo61 ä¸­ï¼Œæˆ‘ä»¬åˆå¤šåŠ äº†ä¸€ä¸ªç”¨äºâ€œåé¦ˆâ€çš„ä¿¡å·å¼¹å‘å°„å™¨ã€‚è¿™æ ·ä¸€æ¥ï¼Œâ€œå£«å…µâ€æŒ‰ç…§æŒ‡æŒ¥è¡Œè¿›ä¸€æ­¥ä¹‹åï¼Œå°±å¯ä»¥åŠæ—¶å‘Šè¯‰æŒ‡æŒ¥å®˜å¹¶è¯·æ±‚ä¸‹ä¸€æ­¥çš„è¡ŒåŠ¨äº†ã€‚<br><br><br><br>","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1629095904,"ip_address":"","comment_id":307335,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5924001980","product_id":100013101,"comment_content":"éƒæ—è€å¸ˆï¼Œdemo61.go ä¸­çš„  ä¸¤ä¸ªgo functionï¼ˆæ”¶ä¿¡ å’Œ å‘ä¿¡ï¼‰ï¼Œæ˜¯æ€ä¹ˆä¿è¯å…ˆ å‘ä¿¡ åæ”¶ä¿¡çš„å‘¢ï¼Ÿ<br><br>ä¸æ˜¯è¯´ go function å‡½æ•° çš„æ‰§è¡Œ æ˜¯ éšæœºçš„ä¹ˆï¼Ÿ æˆ‘æ‰“å°äº†å¾ˆå¤šéï¼Œå‘ç° éƒ½æ˜¯æ‰§è¡Œçš„ å‘ä¿¡ æ“ä½œï¼Œç„¶åæ˜¯ æ”¶ä¿¡ æ“ä½œã€‚","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525116,"discussion_content":"æ­£å› ä¸ºæœ‰äº†æ¡ä»¶å˜é‡æ‰ä¼šæœ‰è¿™æ ·çš„åŒæ­¥çŠ¶æ€å•Šã€‚æ¡ä»¶å˜é‡å°±ç›¸å½“äºä¿¡å·å¼¹çš„å‘å°„å™¨ã€‚\n\nåŒæ–¹å„æœ‰ä¸€ä¸ªä¿¡å·å¼¹å‘å°„å™¨ï¼ˆå°±åƒç¤ºä¾‹ç¨‹åºä¸­çš„ sendCond å’Œ recvCondï¼‰å¹¶äº’ç›¸å‘é€ä¿¡å·ï¼Œè¿™å°±æ˜¯ demo61 æ‰€åšçš„ã€‚\n\n\nè¿™ä¸ªç¨‹åºä½ ä¹Ÿå¯ä»¥è¿™æ ·ç†è§£ï¼š\n\nA å’Œ B åœ¨ä¸‹è±¡æ£‹ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š\n\nA èµ°äº†ä¸€æ­¥æ£‹ï¼Œå¹¶å‘é€ä¿¡å·ç¤ºæ„è®© B èµ°ä¸€æ­¥ï¼›\nB æ”¶åˆ°ä¿¡å·èµ°äº†ä¸€æ­¥æ£‹ï¼Œç„¶ååè¿‡æ¥å‘ A å‘é€ä¿¡å·ç¤ºæ„â€œæˆ‘èµ°äº†ä¸€æ­¥ï¼Œè¯¥ä½ äº†â€ï¼›\nA å†èµ°ä¸€æ­¥æ£‹ï¼Œå¹¶å†æ¬¡å‘å°„ä¿¡å·ç¤ºæ„è®© B å†èµ°ä¸€æ­¥ï¼›\nB å†èµ°ä¸€æ­¥åï¼Œå†å‘å°„ä¿¡å·å‘Šè¯‰ Aï¼›\nå¦‚æ­¤å¾ªç¯å¾€å¤ã€‚\n\n\nå†åšä¸€ä¸ªç±»æ¯”ï¼š\n\nå•ä¸ªæ¡ä»¶å˜é‡ç”¨äºâ€œæ•™å®˜â€æŒ‡æŒ¥â€œå£«å…µâ€ï¼Œâ€œæ•™å®˜â€åªèƒ½æœ‰ä¸€ä¸ªï¼Œè€Œâ€œå£«å…µâ€å¯ä»¥æœ‰å¤šä¸ªï¼ˆdemo61 ä¸­åªæœ‰ä¸€ä¸ªå£«å…µï¼‰ã€‚åœ¨ demo61 ä¸­ï¼Œæˆ‘ä»¬åˆå¤šåŠ äº†ä¸€ä¸ªç”¨äºâ€œåé¦ˆâ€çš„ä¿¡å·å¼¹å‘å°„å™¨ã€‚è¿™æ ·ä¸€æ¥ï¼Œâ€œå£«å…µâ€æŒ‰ç…§æŒ‡æŒ¥è¡Œè¿›ä¸€æ­¥ä¹‹åï¼Œå°±å¯ä»¥åŠæ—¶å‘Šè¯‰æŒ‡æŒ¥å®˜å¹¶è¯·æ±‚ä¸‹ä¸€æ­¥çš„è¡ŒåŠ¨äº†ã€‚\n\n\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629095904,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":230214,"user_name":"www","can_delete":false,"product_type":"c1","uid":1898338,"ip_address":"","ucode":"ADC9BC655EA16C","user_header":"https://static001.geekbang.org/account/avatar/00/1c/f7/62/947004d0.jpg","comment_is_top":false,"comment_ctime":1593313712,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5888281008","product_id":100013101,"comment_content":"è¿™ç¯‡è®²è§£å¤ªæ£’äº†ï¼Œçœ‹äº†lock.RLocker()çš„æºç ï¼Œåˆè¿”å›å»çœ‹äº†å‰é¢ç¬¬14ç¯‡è®²è§£æ¥å£çš„æ–‡ç« ã€‚å¤šçœ‹å¤šå†™ï¼Œé€æ­¥æå‡","like_count":1},{"had_liked":false,"id":209419,"user_name":"ğŸ˜³","can_delete":false,"product_type":"c1","uid":1452857,"ip_address":"","ucode":"9AFB87EF308539","user_header":"https://static001.geekbang.org/account/avatar/00/16/2b/39/19041d78.jpg","comment_is_top":false,"comment_ctime":1587547282,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5882514578","product_id":100013101,"comment_content":"è¿™ä¸ªç±»æ¯”ç”ŸåŠ¨å½¢è±¡ï¼Œå¾ˆæœ‰è¶£ï¼Œç®€å•æ˜“æ‡‚","like_count":1},{"had_liked":false,"id":196628,"user_name":"Lywane","can_delete":false,"product_type":"c1","uid":1446512,"ip_address":"","ucode":"2B0027AA069CE9","user_header":"https://static001.geekbang.org/account/avatar/00/16/12/70/10faf04b.jpg","comment_is_top":false,"comment_ctime":1585298252,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5880265548","product_id":100013101,"comment_content":"recvCond.Signal()è¡¨ç¤ºæ¥æ”¶æ–¹å¯ä»¥æ¥å—äº†ï¼Œå‘é€è¿™ä¸ªä¿¡å·çš„æ˜¯å‘é€æ–¹ã€‚<br>sendCond.Signal()è¡¨ç¤ºå‘é€æ–¹å¯ä»¥å†æ¬¡å‘é€äº†ï¼Œå‘é€è¿™ä¸ªä¿¡å·çš„æ˜¯æ¥æ”¶æ–¹ã€‚","like_count":1},{"had_liked":false,"id":172402,"user_name":"lfn","can_delete":false,"product_type":"c1","uid":1026593,"ip_address":"","ucode":"2E1558C6A12A89","user_header":"https://static001.geekbang.org/account/avatar/00/0f/aa/21/6c3ba9af.jpg","comment_is_top":false,"comment_ctime":1579170103,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5874137399","product_id":100013101,"comment_content":"æ‰“å¡ï¼Œ2020-01-16.","like_count":1},{"had_liked":false,"id":118468,"user_name":"å…š","can_delete":false,"product_type":"c1","uid":1071974,"ip_address":"","ucode":"EE531DB3EA124D","user_header":"https://static001.geekbang.org/account/avatar/00/10/5b/66/ad35bc68.jpg","comment_is_top":false,"comment_ctime":1564370672,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5859337968","product_id":100013101,"comment_content":"demo60å¤ªç»å…¸äº† ä¸ä»…ä½“ä¼šåˆ°äº†é”çš„ç”¨æ³• è¿˜ä½“ä¼šåˆ°äº† å¦‚ä½•åˆ©ç”¨chan é˜»å¡ä¸»çº¿ç¨‹ ä»¥ä½¿goroutineå®Œå…¨è·‘å®Œ ç®—æ˜¯chanç»å…¸ç”¨æ³•å§","like_count":1,"discussions":[{"author":{"id":1435733,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e8/55/92f82281.jpg","nickname":"MClink","note":"","ucode":"F479190923355C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579389,"discussion_content":"å¯¹å¤´ï¼Œä¸€å¼€å§‹è¿˜ä¸€è„¸æ‡µé€¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657421987,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69075,"user_name":"...","can_delete":false,"product_type":"c1","uid":1142098,"ip_address":"","ucode":"9D73E00133C236","user_header":"https://static001.geekbang.org/account/avatar/00/11/6d/52/404912c3.jpg","comment_is_top":false,"comment_ctime":1550656410,"is_pvip":false,"replies":[{"id":"25231","content":"æ¯æ¬¡æ‰§è¡Œç»“æŸå‰éƒ½ä¼šé‡Šæ”¾ï¼Œè¦ä¸å…¶ä»–goroutineæ²¡æ³•è¿›å…¥é”ä¿æŠ¤çš„ä¸´ç•ŒåŒºã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1551178792,"ip_address":"","comment_id":69075,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5845623706","product_id":100013101,"comment_content":"è€å¸ˆ waitä¼šé‡Šæ”¾é”å—","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439942,"discussion_content":"æ¯æ¬¡æ‰§è¡Œç»“æŸå‰éƒ½ä¼šé‡Šæ”¾ï¼Œè¦ä¸å…¶ä»–goroutineæ²¡æ³•è¿›å…¥é”ä¿æŠ¤çš„ä¸´ç•ŒåŒºã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551178792,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1312212,"avatar":"https://static001.geekbang.org/account/avatar/00/14/05/d4/e06bf86d.jpg","nickname":"é•¿æ°","note":"","ucode":"DD52C9494005F7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":57414,"discussion_content":"waitæœ¬èº«ä¸é‡Šæ”¾é”å§ï¼Ÿå› ä¸ºåé¢çš„ä»£ç æ‰§è¡Œäº† lock.RUnlock()æ–¹æ³•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574604654,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1336951,"avatar":"https://static001.geekbang.org/account/avatar/00/14/66/77/194ba21d.jpg","nickname":"lzh","note":"","ucode":"C3D83DF4230109","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1312212,"avatar":"https://static001.geekbang.org/account/avatar/00/14/05/d4/e06bf86d.jpg","nickname":"é•¿æ°","note":"","ucode":"DD52C9494005F7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":363190,"discussion_content":"é‡Šæ”¾ï¼Œç‚¹è¿›å»çœ‹çœ‹waitçš„æºç ï¼Œæœ‰ä¸ªå¾ˆå¤§çš„c.L.Unlock()","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617121017,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":57414,"ip_address":""},"score":363190,"extra":""}]}]},{"had_liked":false,"id":31914,"user_name":"éªJero","can_delete":false,"product_type":"c1","uid":1133122,"ip_address":"","ucode":"C0D505B088275E","user_header":"https://static001.geekbang.org/account/avatar/00/11/4a/42/b2c7dd30.jpg","comment_is_top":false,"comment_ctime":1539329228,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5834296524","product_id":100013101,"comment_content":"ä¸ºä»€ä¹ˆè¿™é‡Œä½¿ç”¨for mailbox == 1 { }, çœ‹waitå†…éƒ¨å®ç°ï¼Œç­‰å¾…æ˜¯waitä¸­runtime_notifyListWait(&amp;c.notify, t)èµ·åˆ°çš„ä½œç”¨ï¼Œæ„Ÿè§‰ç”¨ifä¸€æ ·è¾¾åˆ°æ•ˆæœ","like_count":1},{"had_liked":false,"id":346539,"user_name":"å·å·","can_delete":false,"product_type":"c1","uid":2615426,"ip_address":"","ucode":"4296324E6C506B","user_header":"","comment_is_top":false,"comment_ctime":1653220863,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1653220863","product_id":100013101,"comment_content":"func (f *FIFO) Add(obj interface{}) error {<br>\tid, err := f.keyFunc(obj)<br>\tif err != nil {<br>\t\treturn KeyError{obj, err}<br>\t}<br>\tf.lock.Lock()<br>\tdefer f.lock.Unlock()<br>\tf.populated = true<br>\tif _, exists := f.items[id]; !exists {<br>\t\tf.queue = append(f.queue, id)<br>\t}<br>\tf.items[id] = obj<br>\tf.cond.Broadcast()<br>\treturn nil<br>}<br><br><br>æºç ä¸­å¥½å¤šå¹¿æ’­éƒ½æ˜¯åœ¨é”å†…å‘ç”Ÿçš„å•Š","like_count":0},{"had_liked":false,"id":346538,"user_name":"å·å·","can_delete":false,"product_type":"c1","uid":2615426,"ip_address":"","ucode":"4296324E6C506B","user_header":"","comment_is_top":false,"comment_ctime":1653220787,"is_pvip":true,"replies":[{"id":"126631","content":"è¿™è¦çœ‹ä½ åˆå§‹åŒ– cond çš„æ—¶å€™ç”¨çš„æ˜¯å“ªä¸ªé”ï¼ˆä»¥ä¸‹ç§°è¿™ä¸ªé”ä¸º Lï¼‰äº†ã€‚<br><br>åŸåˆ™ä¸Šï¼Œå¦‚æœè°ƒç”¨çš„æ˜¯ Signal æˆ–è€… Broadcast ï¼Œæ— éœ€é”å®š L ã€‚è€Œ Wait åœ¨è¢«è°ƒç”¨æ—¶ä¼šè‡ªåŠ¨è§£é” L ï¼Œå¹¶ä¸”åœ¨è¢«å”¤é†’æ—¶ä¼šå…ˆè‡ªåŠ¨é”å®š L ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è°ƒç”¨ Wait ä¹‹å‰ä¸€èˆ¬éœ€è¦å…ˆé”å®š L ï¼Œè¿™é‡Œä¸€å®šè¦æ³¨æ„ã€‚<br><br>åœ¨æˆ‘ä»¬çš„è¿™ä¸ªä¾‹å­é‡Œï¼Œæ˜¯æœ‰ä¸¤ä¸ª cond çš„ï¼Œæ‰€ä»¥ä¸ºäº†é…åˆï¼Œæ­¤ç±»æ“ä½œä¸ç›¸åº”çš„é”ä¹‹é—´å­˜åœ¨ä¸€å®šå…ˆåçš„å…³ç³»ã€‚å…·ä½“è§£é‡Šåœ¨æ–‡ç« ä¸­æ˜¯æœ‰çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1026643","ctime":1653893117,"ip_address":"","comment_id":346538,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1653220787","product_id":100013101,"comment_content":"è€å¸ˆï¼Œæˆ‘æ²¡å¤ªç†è§£ä¸ºå•¥ å¹¿æ’­ æ˜¯è¦åœ¨è§£é”ä¹‹åå† è§¦å‘å—ï¼Ÿ  client-go ä¸­å¹¿æ’­éƒ½æ˜¯åœ¨é”å†…å‘ç”Ÿçš„å•Š<br><br>func (f *FIFO) Add(obj interface{}) error {<br>\tid, err := f.keyFunc(obj)<br>\tif err != nil {<br>\t\treturn KeyError{obj, err}<br>\t}<br>\tf.lock.Lock()<br>\tdefer f.lock.Unlock()<br>\tf.populated = true<br>\tif _, exists := f.items[id]; !exists {<br>\t\tf.queue = append(f.queue, id)<br>\t}<br>\tf.items[id] = obj<br>\tf.cond.Broadcast()<br>\treturn nil<br>}","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":574188,"discussion_content":"è¿™è¦çœ‹ä½ åˆå§‹åŒ– cond çš„æ—¶å€™ç”¨çš„æ˜¯å“ªä¸ªé”ï¼ˆä»¥ä¸‹ç§°è¿™ä¸ªé”ä¸º Lï¼‰äº†ã€‚\n\nåŸåˆ™ä¸Šï¼Œå¦‚æœè°ƒç”¨çš„æ˜¯ Signal æˆ–è€… Broadcast ï¼Œæ— éœ€é”å®š L ã€‚è€Œ Wait åœ¨è¢«è°ƒç”¨æ—¶ä¼šè‡ªåŠ¨è§£é” L ï¼Œå¹¶ä¸”åœ¨è¢«å”¤é†’æ—¶ä¼šå…ˆè‡ªåŠ¨é”å®š L ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è°ƒç”¨ Wait ä¹‹å‰ä¸€èˆ¬éœ€è¦å…ˆé”å®š L ï¼Œè¿™é‡Œä¸€å®šè¦æ³¨æ„ã€‚\n\nåœ¨æˆ‘ä»¬çš„è¿™ä¸ªä¾‹å­é‡Œï¼Œæ˜¯æœ‰ä¸¤ä¸ª cond çš„ï¼Œæ‰€ä»¥ä¸ºäº†é…åˆï¼Œæ­¤ç±»æ“ä½œä¸ç›¸åº”çš„é”ä¹‹é—´å­˜åœ¨ä¸€å®šå…ˆåçš„å…³ç³»ã€‚å…·ä½“è§£é‡Šåœ¨æ–‡ç« ä¸­æ˜¯æœ‰çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653893117,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":321622,"user_name":"lofaith","can_delete":false,"product_type":"c1","uid":1322553,"ip_address":"","ucode":"5DF6922BBF1AD5","user_header":"https://static001.geekbang.org/account/avatar/00/14/2e/39/7682b49e.jpg","comment_is_top":false,"comment_ctime":1636968372,"is_pvip":false,"replies":[{"id":"116805","content":"è¯»å†™é”ä¸­çš„è¯»-å†™ã€å†™-å†™æ˜¯äº’æ–¥çš„ï¼Œä½†æ˜¯è¯»-è¯»ä¸äº’æ–¥ã€‚<br><br>```<br>lock.Lock() <br>for mailbox == 1 { <br>    sendCond.Wait() &#47;&#47; è‡³äºè¿™é‡Œéƒ½åšäº†ä»€ä¹ˆï¼Œä½ çœ‹åˆ°ä¸‹é›†åº”è¯¥å°±æ˜ç™½äº†<br>}<br>mailbox = 1<br>lock.Unlock()<br>recvCond.Signal()<br>```<br><br>è¯´åˆ°åœºæ™¯ï¼Œæ¡ä»¶å˜é‡æœ€ç®€å•çš„åº”ç”¨åœºæ™¯å°±æ˜¯ç”Ÿäº§-æ¶ˆè´¹åä½œã€‚è¿™ç¯‡æ–‡ç« ä¸­çš„ä¾‹å­åªä¸è¿‡æ˜¯â€œç”Ÿäº§-æ¶ˆè´¹åä½œâ€çš„åŒå‘å åŠ ç‰ˆã€‚<br><br>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨åˆ†åˆ«ç”¨å¤šä¸ªgoroutineé’ˆå¯¹åŒä¸€ä¸ªå…±äº«èµ„æºè¿›è¡Œè¯»å†™çš„æ—¶å€™å°±å¯ä»¥è¿ç”¨æ¡ä»¶å˜é‡ï¼Œå°¤å…¶æ˜¯â€œå•å†™å¤šè¯»â€æˆ–â€œå•è¯»å¤šå†™â€çš„æ—¶å€™ã€‚å‘ä¿¡å·çš„ä¸€æ–¹ä½œä¸ºâ€œå•â€çš„ä¸€æ–¹ï¼Œæ”¶ä¿¡å·çš„ä¸€æ–¹ä½œä¸ºâ€œå¤šâ€çš„ä¸€æ–¹ï¼ˆæˆ–è€…â€œå•â€çš„å¦ä¸€æ–¹ï¼‰ã€‚<br><br>è¿™é‡Œçš„â€œå•â€æ˜¯æŒ‡ï¼Œåªæœ‰ä¸€ä¸ªgoroutineåœ¨è¿›è¡Œè¯»æˆ–å†™çš„æ“ä½œï¼Œâ€œå¤šâ€è‡ªç„¶æ˜¯æŒ‡æœ‰å¤šä¸ªgoroutineåœ¨è¿›è¡Œç›¸åº”çš„æ“ä½œã€‚<br><br>å½“ç„¶äº†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠå®ƒé€‚ç”¨äºæ›´å¤æ‚çš„åœºæ™¯ï¼Œä¹Ÿå°±æ˜¯å­˜åœ¨å¤šç»„â€œå•å†™Nè¯»â€æˆ–â€œå•è¯»Nå†™â€çš„æƒ…å†µã€‚ä¸è¿‡ï¼Œæ¯ä¸€ç»„é€šå¸¸ä¼šåˆ†åˆ«å¯¹åº”ä¸åŒçš„å…±äº«èµ„æºã€‚<br><br>å¤šç»„é’ˆå¯¹åŒä¸€ä¸ªå…±äº«èµ„æºçš„æƒ…å†µä¹Ÿæ˜¯æœ‰çš„ã€‚æœ¬æ–‡çš„ä¾‹å­å°±æ˜¯ä¸¤ç»„â€œå•å†™å•è¯»â€çš„æƒ…å†µï¼Œè€Œä¸”é’ˆå¯¹çš„æ˜¯åŒä¸€ä¸ªå…±äº«èµ„æºï¼Œå¹¶äº’ä¸ºâ€œå¯¹ç«‹â€ä¿¡å·çš„æ”¶å‘æ–¹ï¼ˆå³åŒå‘å åŠ ç‰ˆï¼‰ã€‚<br><br>æœ€åè¯·è®°ä½ï¼Œæ¡ä»¶å˜é‡çš„é‡ç‚¹åœ¨äºå¤šgoroutineé—´çš„ç´§å¯†åä½œï¼Œè€Œéç®€å•çš„äº’æ–¥ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1636989961,"ip_address":"","comment_id":321622,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1636968372","product_id":100013101,"comment_content":"è€å¸ˆï¼Œè¯»å†™é”ä¹‹é—´ä¸æ˜¯äº’æ–¥çš„å—ï¼Œæˆ‘ç†è§£åº”è¯¥åœ¨åŠ ä¸Šè¯»é”çš„æ—¶å€™ï¼Œå†™é”å°±ä¼šé˜»å¡åœ¨lockè¿™é‡Œï¼Œä¸ä¼šèµ°åˆ° sendCond.Wait() è¿™é‡Œå•Šã€‚è™½ç„¶èƒ½æ˜ç™½æ¡ä»¶å˜é‡çš„ä½œç”¨äº†ï¼Œä½†è¿˜æ˜¯ä¸æ¸…æ¥šå®ƒçš„ä½¿ç”¨åœºæ™¯ï¼Œè€å¸ˆèƒ½è¯´ä¸€ä¸‹ä½¿ç”¨åœºæ™¯å—","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530322,"discussion_content":"è¯»å†™é”ä¸­çš„è¯»-å†™ã€å†™-å†™æ˜¯äº’æ–¥çš„ï¼Œä½†æ˜¯è¯»-è¯»ä¸äº’æ–¥ã€‚\n\n```\nlock.Lock() \nfor mailbox == 1 { \n    sendCond.Wait() // è‡³äºè¿™é‡Œéƒ½åšäº†ä»€ä¹ˆï¼Œä½ çœ‹åˆ°ä¸‹é›†åº”è¯¥å°±æ˜ç™½äº†\n}\nmailbox = 1\nlock.Unlock()\nrecvCond.Signal()\n```\n\nè¯´åˆ°åœºæ™¯ï¼Œæ¡ä»¶å˜é‡æœ€ç®€å•çš„åº”ç”¨åœºæ™¯å°±æ˜¯ç”Ÿäº§-æ¶ˆè´¹åä½œã€‚è¿™ç¯‡æ–‡ç« ä¸­çš„ä¾‹å­åªä¸è¿‡æ˜¯â€œç”Ÿäº§-æ¶ˆè´¹åä½œâ€çš„åŒå‘å åŠ ç‰ˆã€‚\n\nå› æ­¤ï¼Œæˆ‘ä»¬åœ¨åˆ†åˆ«ç”¨å¤šä¸ªgoroutineé’ˆå¯¹åŒä¸€ä¸ªå…±äº«èµ„æºè¿›è¡Œè¯»å†™çš„æ—¶å€™å°±å¯ä»¥è¿ç”¨æ¡ä»¶å˜é‡ï¼Œå°¤å…¶æ˜¯â€œå•å†™å¤šè¯»â€æˆ–â€œå•è¯»å¤šå†™â€çš„æ—¶å€™ã€‚å‘ä¿¡å·çš„ä¸€æ–¹ä½œä¸ºâ€œå•â€çš„ä¸€æ–¹ï¼Œæ”¶ä¿¡å·çš„ä¸€æ–¹ä½œä¸ºâ€œå¤šâ€çš„ä¸€æ–¹ï¼ˆæˆ–è€…â€œå•â€çš„å¦ä¸€æ–¹ï¼‰ã€‚\n\nè¿™é‡Œçš„â€œå•â€æ˜¯æŒ‡ï¼Œåªæœ‰ä¸€ä¸ªgoroutineåœ¨è¿›è¡Œè¯»æˆ–å†™çš„æ“ä½œï¼Œâ€œå¤šâ€è‡ªç„¶æ˜¯æŒ‡æœ‰å¤šä¸ªgoroutineåœ¨è¿›è¡Œç›¸åº”çš„æ“ä½œã€‚\n\nå½“ç„¶äº†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠå®ƒé€‚ç”¨äºæ›´å¤æ‚çš„åœºæ™¯ï¼Œä¹Ÿå°±æ˜¯å­˜åœ¨å¤šç»„â€œå•å†™Nè¯»â€æˆ–â€œå•è¯»Nå†™â€çš„æƒ…å†µã€‚ä¸è¿‡ï¼Œæ¯ä¸€ç»„é€šå¸¸ä¼šåˆ†åˆ«å¯¹åº”ä¸åŒçš„å…±äº«èµ„æºã€‚\n\nå¤šç»„é’ˆå¯¹åŒä¸€ä¸ªå…±äº«èµ„æºçš„æƒ…å†µä¹Ÿæ˜¯æœ‰çš„ã€‚æœ¬æ–‡çš„ä¾‹å­å°±æ˜¯ä¸¤ç»„â€œå•å†™å•è¯»â€çš„æƒ…å†µï¼Œè€Œä¸”é’ˆå¯¹çš„æ˜¯åŒä¸€ä¸ªå…±äº«èµ„æºï¼Œå¹¶äº’ä¸ºâ€œå¯¹ç«‹â€ä¿¡å·çš„æ”¶å‘æ–¹ï¼ˆå³åŒå‘å åŠ ç‰ˆï¼‰ã€‚\n\næœ€åè¯·è®°ä½ï¼Œæ¡ä»¶å˜é‡çš„é‡ç‚¹åœ¨äºå¤šgoroutineé—´çš„ç´§å¯†åä½œï¼Œè€Œéç®€å•çš„äº’æ–¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636989961,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":317524,"user_name":"jxs1211","can_delete":false,"product_type":"c1","uid":1101006,"ip_address":"","ucode":"B7F1F2D84389E7","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKELX1Rd1vmLRWibHib8P95NA87F4zcj8GrHKYQL2RcLDVnxNy1ia2geTWgW6L2pWn2kazrPNZMRVrIg/132","comment_is_top":false,"comment_ctime":1634824209,"is_pvip":false,"replies":[{"id":"115336","content":"mailbox ä»£è¡¨äº†ä¿¡ç®±çš„çŠ¶æ€ï¼ŒçŠ¶æ€çš„å˜æ›´è‚¯å®šéœ€è¦èµ‹å€¼æ“ä½œã€‚ä¸è¦æŠŠ mailbox çœ‹æˆæ–‡ä»¶ä¹‹ç±»çš„è¯»å†™å¥æŸ„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1635178440,"ip_address":"","comment_id":317524,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1634824209","product_id":100013101,"comment_content":"åœ¨è¿è¡Œè¯»å–mailboxçš„goroutineä¸­ï¼Œå½“mailbox=1æ—¶ï¼Œå¯ä»¥å–ä¿¡ï¼Œåœ¨è¿™æ®µç”±è¯»é”é”å®šçš„ä¸´ç•ŒåŒºä¸­ï¼Œmailbox=0å®é™…æ˜¯ä¸€ä¸ªå†™å…¥æ“ä½œï¼Œæ€ä¹ˆç†è§£è¿™ä¸ªè¯»é”é”å®šçš„ä¸´ç•ŒåŒºä¸­å®åˆ™ä¸ºä¸€ä¸ªå†™æ“ä½œå‘¢<br>log.Printf(&quot;receiver [%d]: the mailbox is full.&quot;, j)<br>mailbox = 0<br>log.Printf(&quot;receiver [%d]: the letter has been received.&quot;, j)<br>lock.RUnlock()","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528847,"discussion_content":"mailbox ä»£è¡¨äº†ä¿¡ç®±çš„çŠ¶æ€ï¼ŒçŠ¶æ€çš„å˜æ›´è‚¯å®šéœ€è¦èµ‹å€¼æ“ä½œã€‚ä¸è¦æŠŠ mailbox çœ‹æˆæ–‡ä»¶ä¹‹ç±»çš„è¯»å†™å¥æŸ„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635178440,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":307273,"user_name":"lesserror","can_delete":false,"product_type":"c1","uid":1351076,"ip_address":"","ucode":"25A54D1165FCF6","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","comment_is_top":false,"comment_ctime":1628999196,"is_pvip":false,"replies":[{"id":"111269","content":"ä½ æœ‰å“ªé‡Œä¸æ˜ç™½å°½ç®¡åœ¨è¿™é‡Œé—®","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1629034044,"ip_address":"","comment_id":307273,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1628999196","product_id":100013101,"comment_content":"éƒæ—è€å¸ˆï¼Œå¦‚æœèƒ½å¯¹ç…§ä»£ç çš„æ‰“å°è¾“å‡ºæµç¨‹è®²å°±å¥½äº†ï¼Œæœ‰å¥½å¤šè®²æˆ‘çœ‹ä»£ç çš„è¾“å‡ºæŒºæ‡µçš„ã€‚","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525100,"discussion_content":"ä½ æœ‰å“ªé‡Œä¸æ˜ç™½å°½ç®¡åœ¨è¿™é‡Œé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629034044,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":291099,"user_name":"moonfox","can_delete":false,"product_type":"c1","uid":1526355,"ip_address":"","ucode":"902BFF40EFA9FA","user_header":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","comment_is_top":false,"comment_ctime":1620023290,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1620023290","product_id":100013101,"comment_content":"é˜²æ­¢å‡å”¤é†’ for ç”¨çš„å¦™å‘€","like_count":0},{"had_liked":false,"id":289510,"user_name":"æ§‘Â·å…ˆç”Ÿ","can_delete":false,"product_type":"c1","uid":1445744,"ip_address":"","ucode":"897F0475592E3A","user_header":"https://static001.geekbang.org/account/avatar/00/16/0f/70/f59db672.jpg","comment_is_top":false,"comment_ctime":1619058155,"is_pvip":true,"discussion_count":0,"race_medal":2,"score":"1619058155","product_id":100013101,"comment_content":"ä»javaè½¬è¿‡æ¥çš„è¡¨ç¤ºè¿™ä¸€è®²è¿˜æ˜¯éå¸¸å¥½æ‡‚çš„ã€‚å¦å¤–æ¡ä»¶åˆ¤æ–­é‚£å„¿ç”¨å¾ªç¯æ˜¯ä¸ºäº†é¿å…è™šå‡å”¤é†’ã€‚","like_count":0},{"had_liked":false,"id":286053,"user_name":"lzh","can_delete":false,"product_type":"c1","uid":1336951,"ip_address":"","ucode":"C3D83DF4230109","user_header":"https://static001.geekbang.org/account/avatar/00/14/66/77/194ba21d.jpg","comment_is_top":false,"comment_ctime":1617121602,"is_pvip":false,"replies":[{"id":"103883","content":"å› ä¸ºåº•å±‚å®ç°å°±æ˜¯åŒä¸€ä¸ªè¯»å†™é”å•Šã€‚RLocker æ–¹æ³•è¿”å›çš„é”å…¶å®å°±æ˜¯è¿™ä¸ªè¯»å†™é”ä¸­çš„è¯»é”çš„ç®€å•åŒ…è£…è€Œå·²ï¼ˆä½¿å¾—è¿™ä¸ªè¯»é”ä¹Ÿæˆä¸º sync.Locker æ¥å£çš„å®ç°ï¼‰ã€‚ä½†æ˜¯ä»æ¦‚å¿µä¸Šè®²ï¼Œä¸€ä¸ªè¯»å†™é”æ˜¯ç”±ä¸€å¯¹å†™é”å’Œè¯»é”ç»„æˆçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1617184123,"ip_address":"","comment_id":286053,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1617121602","product_id":100013101,"comment_content":"a := &amp;lock<br>b := lock.RLocker()<br><br>fmt.Printf(&quot;%p\\n&quot;, a)<br>fmt.Printf(&quot;%p\\n&quot;, b)<br><br>å®ƒä»¬åœ°å€éƒ½æ˜¯ä¸€æ ·çš„å‘€ï¼Œä¸ºä»€ä¹ˆè¯´æ˜¯ä¸åŒçš„lockå‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517858,"discussion_content":"å› ä¸ºåº•å±‚å®ç°å°±æ˜¯åŒä¸€ä¸ªè¯»å†™é”å•Šã€‚RLocker æ–¹æ³•è¿”å›çš„é”å…¶å®å°±æ˜¯è¿™ä¸ªè¯»å†™é”ä¸­çš„è¯»é”çš„ç®€å•åŒ…è£…è€Œå·²ï¼ˆä½¿å¾—è¿™ä¸ªè¯»é”ä¹Ÿæˆä¸º sync.Locker æ¥å£çš„å®ç°ï¼‰ã€‚ä½†æ˜¯ä»æ¦‚å¿µä¸Šè®²ï¼Œä¸€ä¸ªè¯»å†™é”æ˜¯ç”±ä¸€å¯¹å†™é”å’Œè¯»é”ç»„æˆçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617184123,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":275257,"user_name":"å¯»è·¯äºº","can_delete":false,"product_type":"c1","uid":1195917,"ip_address":"","ucode":"1711F740D4D60A","user_header":"https://static001.geekbang.org/account/avatar/00/12/3f/8d/a89be8f9.jpg","comment_is_top":false,"comment_ctime":1611412795,"is_pvip":false,"replies":[{"id":"99907","content":"sync.RWMutexå½“ç„¶æ˜¯è¯»å†™é”ï¼Œä½†ä¸€ä¸ªsync.Condå®ä¾‹åªä¼šç”¨å®ç°äº†sync.Lockeræ¥å£çš„å•é”å•Šã€‚æ‰€ä»¥è¿™é‡Œæ‰åº”ç”¨äº†ä¸¤ä¸ªsync.Condå®ä¾‹ã€‚<br><br>å¦å¤–ï¼Œâ€œæ”¾ä¿¡â€å’Œâ€œå–ä¿¡â€è¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´ç†åº”æ˜¯äº’æ–¥çš„ã€‚å¦‚æœåŒæ–¹æ¯æ¬¡éƒ½ç›´æ¥ç¢°é¢ï¼Œé‚£å°±ä¸å«â€œåœ°ä¸‹å·¥ä½œè€…â€äº†ï¼Œä¹Ÿå°±æ²¡æœ‰è®¾ç«‹è¿™ä¸ªâ€œä¿¡ç®±â€çš„å¿…è¦äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1611471899,"ip_address":"","comment_id":275257,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1611412795","product_id":100013101,"comment_content":"var lock sync.RWMutexæ˜æ˜æ˜¯è¯»å†™é”ï¼Œ<br>ä¸€ä¸ªgoroutineä½¿ç”¨äº†lock.Lock()ï¼Œå¦ä¸€ä¸ªgoroutineå†è°ƒç”¨lock.RLock()ä¼šäº’æ–¥ã€‚<br>è¿™é‡Œä½œè€…åº”è¯¥å¿½ç•¥äº†å‘Šè¯‰è¯»è€…Wait()ä¼šé‡Šæ”¾ç‹¬å é”çš„ä¸€ä¸ªæ¦‚å¿µã€‚","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514285,"discussion_content":"sync.RWMutexå½“ç„¶æ˜¯è¯»å†™é”ï¼Œä½†ä¸€ä¸ªsync.Condå®ä¾‹åªä¼šç”¨å®ç°äº†sync.Lockeræ¥å£çš„å•é”å•Šã€‚æ‰€ä»¥è¿™é‡Œæ‰åº”ç”¨äº†ä¸¤ä¸ªsync.Condå®ä¾‹ã€‚\n\nå¦å¤–ï¼Œâ€œæ”¾ä¿¡â€å’Œâ€œå–ä¿¡â€è¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´ç†åº”æ˜¯äº’æ–¥çš„ã€‚å¦‚æœåŒæ–¹æ¯æ¬¡éƒ½ç›´æ¥ç¢°é¢ï¼Œé‚£å°±ä¸å«â€œåœ°ä¸‹å·¥ä½œè€…â€äº†ï¼Œä¹Ÿå°±æ²¡æœ‰è®¾ç«‹è¿™ä¸ªâ€œä¿¡ç®±â€çš„å¿…è¦äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611471899,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1195917,"avatar":"https://static001.geekbang.org/account/avatar/00/12/3f/8d/a89be8f9.jpg","nickname":"å¯»è·¯äºº","note":"","ucode":"1711F740D4D60A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344482,"discussion_content":"è°¢è°¢ï¼Œå…¶å®åœ¨ä¸‹ä¸€ç¯‡ä¸­å°±åšäº†æ¯”è¾ƒè¯¦ç»†çš„è§£é‡Šï¼Œå¦‚æœä¸¤ç¯‡éƒ½çœ‹å®Œå…¶å®å°±æ²¡æœ‰è¿™äº›ç–‘æƒ‘äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611475127,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":274305,"user_name":"æ¸…é£","can_delete":false,"product_type":"c1","uid":1142539,"ip_address":"","ucode":"ED1B6DECC3A102","user_header":"https://static001.geekbang.org/account/avatar/00/11/6f/0b/06480912.jpg","comment_is_top":false,"comment_ctime":1610960015,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1610960015","product_id":100013101,"comment_content":"package main<br><br>import (<br>\t&quot;fmt&quot;<br>\t&quot;math&#47;rand&quot;<br>\t&quot;sync&quot;<br>\t&quot;time&quot;<br>)<br><br>type User struct { &#47;&#47;æ¨¡æ‹Ÿç”¨æˆ·<br>\tmail *Mail<br>\tname string<br>}<br><br>type Mail struct { &#47;&#47;æ¨¡æ‹Ÿé‚®ç®±<br>\tmail     bool<br>\tmsg int<br>\tsendCond *sync.Cond<br>\trecvCond *sync.Cond<br>\tlock     sync.RWMutex<br>}<br><br>func NewMail() *Mail {<br>\tm := Mail{}<br>\tm.sendCond = sync.NewCond(&amp;m.lock)<br>\tm.recvCond = sync.NewCond(&amp;m.lock)<br>\treturn &amp;m<br>}<br><br>func (u *User) SendMail() {<br>\tu.mail.lock.Lock()<br>\tfor u.mail.mail {<br>\t\tfmt.Println(u.name + &quot;:å·²ç»æœ‰é‚®ä»¶äº†ç­‰å¾…æ¥æ”¶&quot;)<br>\t\tu.mail.sendCond.Wait()<br>\t}<br>\tu.mail.mail = true<br>\tu.mail.msg = rand.Intn(1000000)<br>\tfmt.Println(u.name + &quot;å‘é€äº†ä¸€å°é‚®ä»¶&quot;)<br>\tu.mail.lock.Unlock()<br>\tu.mail.recvCond.Broadcast() &#47;&#47;å‘æ¥æ”¶è€…å‘é€æ¶ˆæ¯<br>}<br><br>func (u *User) RecvMail() {<br>\tu.mail.lock.Lock()<br>\tfor !u.mail.mail {<br>\t\tfmt.Println(u.name + &quot;:æ²¡æœ‰é‚®ä»¶ï¼Œç­‰å¾…å‘é€é‚®ä»¶&quot;)<br>\t\tu.mail.recvCond.Wait()<br>\t}<br>\tu.mail.mail = false<br>\tfmt.Printf(&quot;%s:æ”¶åˆ°ä¸€å°é‚®ä»¶: %d\\n&quot;, u.name, u.mail.msg)<br>\tu.mail.lock.Unlock()<br>\tu.mail.sendCond.Signal()<br>}<br><br>func main() {<br>\tmail := NewMail()<br>\tlock := make(chan struct{}, 3)<br>\tuse1 := User{<br>\t\tmail: mail,<br>\t\tname: &quot;jacky&quot;,<br>\t}<br>\tuse2 := User{<br>\t\tmail: mail,<br>\t\tname: &quot;rose&quot;,<br>\t}<br>\tuse3 := User{<br>\t\tmail: mail,<br>\t\tname: &quot;allen&quot;,<br>\t}<br><br>\t&#47;&#47;send mail<br>\tgo func() {<br>\t\tdefer func() {<br>\t\t\tlock &lt;- struct{}{}<br>\t\t}()<br><br>\t\tfor {<br>\t\t\tuse1.SendMail()<br>\t\t\ttime.Sleep(time.Second + time.Millisecond * time.Duration(rand.Intn(100)))<br>\t\t}<br>\t}()<br><br>\t&#47;&#47;recv mail<br>\tgo func() {<br>\t\tdefer func() {<br>\t\t\tlock &lt;- struct{}{}<br>\t\t}()<br>\t\tfor {<br>\t\t\tuse2.RecvMail()<br>\t\t\ttime.Sleep(time.Second + time.Millisecond * time.Duration(rand.Intn(100)))<br>\t\t}<br>\t}()<br><br>\t&#47;&#47;recv mail<br>\tgo func() {<br>\t\tdefer func() {<br>\t\t\tlock &lt;- struct{}{}<br>\t\t}()<br>\t\tfor {<br>\t\t\tuse3.RecvMail()<br>\t\t\ttime.Sleep(time.Second + time.Millisecond * time.Duration(rand.Intn(100)))<br>\t\t\tfmt.Println()<br>\t\t}<br>\t}()<br><br>\t&lt;-lock<br>\t&lt;-lock<br>\t&lt;-lock<br>}","like_count":0},{"had_liked":false,"id":223908,"user_name":"Geek_2d276a","can_delete":false,"product_type":"c1","uid":1295596,"ip_address":"","ucode":"866B39EBE71356","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEIBJYQ73yYqmiaU7Zg0BHPh9gpSglI79Dzcbob7I2tZOhTjbTTCw13KzVusYhLbKkukV9Ru5UfJMxQ/132","comment_is_top":false,"comment_ctime":1591231091,"is_pvip":true,"replies":[{"id":"82493","content":"æ¡ä»¶å˜é‡çš„å”¤é†’æ“ä½œåˆ©ç”¨çš„æ­£æ˜¯å®ƒåŒ…å«çš„äº’æ–¥é”çš„å”¤é†’åŠŸèƒ½å•Šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1591259051,"ip_address":"","comment_id":223908,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1591231091","product_id":100013101,"comment_content":"æœ‰ä¸ªç–‘é—®ï¼šäº’æ–¥é”çš„è§£é”æ“ä½œå¯ä»¥å”¤é†’ä¹‹å‰å› ä¸ºåŠ é”å¯¼è‡´çš„é˜»å¡çš„åç¨‹ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”¨æ¡ä»¶å˜é‡æ¥å®ç°å”¤é†’é˜»å¡çš„åç¨‹å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":497295,"discussion_content":"æ¡ä»¶å˜é‡çš„å”¤é†’æ“ä½œåˆ©ç”¨çš„æ­£æ˜¯å®ƒåŒ…å«çš„äº’æ–¥é”çš„å”¤é†’åŠŸèƒ½å•Šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591259051,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1811495,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a4/27/15e75982.jpg","nickname":"å°è¢","note":"","ucode":"3F5D8721F577D9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349162,"discussion_content":"ä½ è¿˜æ˜¯æ²¡å›ç­”é—®é¢˜ã€‚ä¸ºå•¥äº’æ–¥é”æœ‰å”¤é†’çš„ä½œç”¨ï¼Œè¿˜è¦è®¾è®¡æ¡ä»¶å˜é‡æ¥å”¤é†’ï¼Ÿè¿™éš¾é“ä¸æ˜¯é‡å¤è®¾è®¡ä¹ˆï¼Ÿgoçš„è®¾è®¡è€…ä¸è‡³äºè¿™ä¹ˆæ— èŠå§ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612942640,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":203649,"user_name":"ä¼ è¯´ä¸­çš„æˆå¤§å¤§","can_delete":false,"product_type":"c1","uid":1236766,"ip_address":"","ucode":"103543D6E706BF","user_header":"https://static001.geekbang.org/account/avatar/00/12/df/1e/cea897e8.jpg","comment_is_top":false,"comment_ctime":1586246898,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586246898","product_id":100013101,"comment_content":"æ„Ÿè§‰å°±åƒæ˜¯æŠŠä¹‹å‰çš„é˜»å¡æ”¹å®Œäº†å¾ªç¯ï¼Ÿ<br>è¿˜ä¸å¦‚è®©å‡ºcpuæ—¶é—´ç‰‡ç­‰å¾…å”¤é†’","like_count":0},{"had_liked":false,"id":196024,"user_name":"ç»™åŠ›","can_delete":false,"product_type":"c1","uid":1113645,"ip_address":"","ucode":"646EE4AFC17224","user_header":"https://static001.geekbang.org/account/avatar/00/10/fe/2d/2c9177ca.jpg","comment_is_top":false,"comment_ctime":1585231260,"is_pvip":false,"replies":[{"id":"74425","content":"æ˜¯çš„ï¼Œè¿™æ ·ä¼šé€ æˆä¸ä¸€è‡´çš„é—®é¢˜ï¼Œè€Œä¸”å¦‚æœä¸æ˜¯äº‹å…ˆæƒ³åˆ°åŸå› çš„è¯å¾ˆéš¾æ’æŸ¥ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1585282547,"ip_address":"","comment_id":196024,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1585231260","product_id":100013101,"comment_content":"æŒ‡é’ˆç±»å‹å¯ä»¥è¢«ä¼ é€’ï¼Œå› ä¸ºåº•å±‚æ•°æ®æ˜¯åŒä¸€ä»½ã€‚<br>ä¼ å€¼çš„è¯<br>type Cond struct {<br>\tnoCopy noCopy<br><br>\t&#47;&#47; L is held while observing or changing the condition<br>\tL Locker<br><br>\tnotify  notifyList<br>\tchecker copyChecker<br>}<br>Locker æ˜¯æ¥å£ï¼Œä¼ é€’æ—¶æ˜¯å¼•ç”¨ç±»å‹<br>notifyList æ˜¯ç»“æ„ä½“ï¼Œä¼šè¢«æµ…æ‹·è´<br>checker æ˜¯æ•°å€¼ç±»å‹ï¼Œä¹Ÿä¼šè¢«æ‹·è´<br><br>å¦‚æœsync.Condåœ¨ä¼ é€’è¿‡ç¨‹ä¸­ï¼Œç»“æ„ä½“å’Œæ•°å€¼ç±»å‹å„å±‚éƒ½æœ‰ä¸€ä»½å¤‡ä»½æ•°æ®ï¼Œå®¹æ˜“é€ æˆä¸ä¸€è‡´æƒ…å†µï¼Œæ‰€ä»¥æå®¹æ˜“å‡ºé—®é¢˜ã€‚<br>","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489209,"discussion_content":"æ˜¯çš„ï¼Œè¿™æ ·ä¼šé€ æˆä¸ä¸€è‡´çš„é—®é¢˜ï¼Œè€Œä¸”å¦‚æœä¸æ˜¯äº‹å…ˆæƒ³åˆ°åŸå› çš„è¯å¾ˆéš¾æ’æŸ¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585282547,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":172663,"user_name":"æµ·ç›—èˆ¹é•¿","can_delete":false,"product_type":"c1","uid":1363634,"ip_address":"","ucode":"ECB28BA21A4113","user_header":"https://static001.geekbang.org/account/avatar/00/14/ce/b2/1f914527.jpg","comment_is_top":false,"comment_ctime":1579248032,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579248032","product_id":100013101,"comment_content":"â€œå¦‚æœä¿¡ç®±é‡Œæ²¡æœ‰æƒ…æŠ¥ï¼Œé‚£ä¹ˆæˆ‘å°±æŠŠæ–°æƒ…æŠ¥æ”¾è¿›å»ï¼Œå…³ä¸Šä¿¡ç®±ã€é”ä¸Šé”ï¼Œç„¶åç¦»å¼€ã€‚ç”¨ä»£ç è¡¨è¾¾å‡ºæ¥å°±æ˜¯mailbox = 1å’Œlock.Unlock()ã€‚â€  æ–‡ä¸­è¿™å¥ï¼Œé”ä¸Šé” å¯¹åº”çš„æ˜¯lock.Unlock()  è´¹è§£!!","like_count":0},{"had_liked":false,"id":162257,"user_name":"Howard","can_delete":false,"product_type":"c1","uid":1321620,"ip_address":"","ucode":"3634F77FF76746","user_header":"https://static001.geekbang.org/account/avatar/00/14/2a/94/8c128d36.jpg","comment_is_top":false,"comment_ctime":1576487675,"is_pvip":false,"replies":[{"id":"61746","content":"ä¸å¯ä»¥ï¼Œå…±äº«èµ„æºæ€»æ˜¯éœ€è¦å—åˆ°ä¿æŠ¤ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1576492643,"ip_address":"","comment_id":162257,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1576487675","product_id":100013101,"comment_content":"æˆ‘èƒ½æŠŠmailbox = 0æ”¾åˆ°lock.RUnlock()å¤–é¢å—ï¼Ÿæ€»è§‰å¾—è¯»é”é‡Œé¢æ”¹åŠ¨mailboxæœ‰ç‚¹ä¸å¥½ã€‚","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477991,"discussion_content":"ä¸å¯ä»¥ï¼Œå…±äº«èµ„æºæ€»æ˜¯éœ€è¦å—åˆ°ä¿æŠ¤ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576492643,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1321620,"avatar":"https://static001.geekbang.org/account/avatar/00/14/2a/94/8c128d36.jpg","nickname":"Howard","note":"","ucode":"3634F77FF76746","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":84799,"discussion_content":"è°¢è°¢å›ç­”ï¼Œè¿™æ ·çš„å¥½å¤„å°±æ˜¯è¿›å…¥å†™é”çš„æ—¶å€™ï¼Œè¿™é‡Œä¸ä¼šåŠ è½½è¯»é”ã€‚æ‰©å±•ä¸€ä¸‹é—®é¢˜ï¼Œå¦‚æœè¿™é‡Œæœ‰å¤šä¸ªæºç¨‹è¿›è¡Œè¯»æ“ä½œï¼Œè¿™é‡Œå°±åº”è¯¥æ¢ä¸€ç§å®ç°æ–¹æ³•äº†ï¼Œå¯¹ä¸ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576506420,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126632,"user_name":"qiushye","can_delete":false,"product_type":"c1","uid":1322164,"ip_address":"","ucode":"D005A152F8BEDC","user_header":"","comment_is_top":false,"comment_ctime":1566438904,"is_pvip":false,"replies":[{"id":"46959","content":"ä½ è¯´çš„æ˜¯ recvCondï¼Ÿè¿™å¯ä¸æ˜¯æ”¶ä¿¡çš„æ„æ€å•Šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1566526081,"ip_address":"","comment_id":126632,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1566438904","product_id":100013101,"comment_content":"æ–‡ç« çš„ä¾‹å­æ˜¯â€œæˆ‘å‘ä¿¡ï¼Œä½ æ”¶ä¿¡â€ï¼Œç¤ºä¾‹å›¾è¡¨è¾¾çš„æ˜¯â€œä½ å‘ä¿¡ï¼Œæˆ‘æ”¶ä¿¡â€ï¼Œç¨æœ‰ä¸è¶³.","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464093,"discussion_content":"ä½ è¯´çš„æ˜¯ recvCondï¼Ÿè¿™å¯ä¸æ˜¯æ”¶ä¿¡çš„æ„æ€å•Šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566526081,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1321620,"avatar":"https://static001.geekbang.org/account/avatar/00/14/2a/94/8c128d36.jpg","nickname":"Howard","note":"","ucode":"3634F77FF76746","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":84093,"discussion_content":"recvConæ˜¯é€šçŸ¥ä¿¡å·²ç»æ”¾å¥½äº†ï¼Œä½ å¯ä»¥æ”¶ä¿¡çš„ä¿¡ä½¿ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576487483,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":123686,"user_name":"bluuus","can_delete":false,"product_type":"c1","uid":1218438,"ip_address":"","ucode":"274D5063B5F542","user_header":"https://static001.geekbang.org/account/avatar/00/12/97/86/fb564a19.jpg","comment_is_top":false,"comment_ctime":1565743766,"is_pvip":false,"replies":[{"id":"45595","content":"ä½ å¯¹ demo61.go æœ‰æ”¹åŠ¨å—ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1565845338,"ip_address":"","comment_id":123686,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1565743766","product_id":100013101,"comment_content":"æˆ‘è¯•äº†ä¸€ä¸‹demo61.go, å‘ç°æ°¸è¿œåªæœ‰ä¸€ä¸ªåç¨‹å¯ä»¥è¿›åˆ°waitæ–¹æ³•ï¼Œå½“mailboxåˆå§‹å€¼æ˜¯0ï¼Œåªæœ‰å¯èƒ½æ”¶åç¨‹è¿›åˆ°waitæ–¹æ³•ï¼›å½“mailboxåˆå§‹å€¼ä¸º1ï¼Œåªæœ‰å¯èƒ½å‘åç¨‹è¿›åˆ°waitæ–¹æ³•ã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462769,"discussion_content":"ä½ å¯¹ demo61.go æœ‰æ”¹åŠ¨å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565845338,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1218438,"avatar":"https://static001.geekbang.org/account/avatar/00/12/97/86/fb564a19.jpg","nickname":"bluuus","note":"","ucode":"274D5063B5F542","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4937,"discussion_content":"æ²¡æœ‰ï¼Œæˆ‘å¤åˆ¶ä¸‹æ¥é‡å¤è·‘äº†å‡ æ¬¡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565845404,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":37931,"user_name":"æ‰“ä½ ","can_delete":false,"product_type":"c1","uid":1075199,"ip_address":"","ucode":"18403CA411C6C7","user_header":"https://static001.geekbang.org/account/avatar/00/10/67/ff/d4f31b87.jpg","comment_is_top":false,"comment_ctime":1541814830,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1541814830","product_id":100013101,"comment_content":"æˆ‘è‚¯å®šéœ€è¦å…ˆè°ƒç”¨lockå˜é‡çš„Lockæ–¹æ³•ã€‚æ³¨æ„ï¼Œè¿™ä¸ªLoc...<br><br>æå®¢æ—¶é—´ç‰ˆæƒæ‰€æœ‰: https:&#47;&#47;time.geekbang.org&#47;column&#47;article&#47;41588<br><br>è¿™ä¸€æ®µå†™å¾—å¤ªæ‹—å£å•¦ã€‚ä»€ä¹ˆå«æŒæœ‰é”ï¼Œè€Œä¸é”ä¸Šé”ã€‚åé¢ç„¶ååˆunlockï¼Œè´¹è§£ã€‚<br>åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™ä¸æ˜¯è¯»å†™é”ä¸­çš„å†™é”ä¹ˆï¼Œç›¸å½“äºè·å–äº†å†™é”","like_count":0},{"had_liked":false,"id":33545,"user_name":"äº‘å­¦","can_delete":false,"product_type":"c1","uid":1027233,"ip_address":"","ucode":"366AE90BA06356","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ac/a1/43d83698.jpg","comment_is_top":false,"comment_ctime":1539824032,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1539824032","product_id":100013101,"comment_content":"æœ¬æ–‡çš„ä¾‹å­å¦‚æœåªç”¨ä¸€ä¸ªæ¡ä»¶å˜é‡ï¼Œä¸ç”¨2ä¸ªï¼Œæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":32699,"user_name":"å’è¿¹","can_delete":false,"product_type":"c1","uid":1202095,"ip_address":"","ucode":"FAE1AA6038402C","user_header":"https://static001.geekbang.org/account/avatar/00/12/57/af/0b39cab7.jpg","comment_is_top":false,"comment_ctime":1539671567,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1539671567","product_id":100013101,"comment_content":"\t\t\tif mailbox ==0 {<br>\t\t\t\trecvCond.Wait()<br>\t\t\t}<br>ä¸ºä»€ä¹ˆå‘é€goroutineå’Œå‘é€goroutineç”¨if æ›¿æ¢foræ‰“å°çš„ç»“æœå’Œç”¨forç»“æ„ä¸€æ ·çš„","like_count":0,"discussions":[{"author":{"id":2806043,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLBFkSq1oiaEMRjtyyv4ZpCI0OuaSsqs04ODm0OkZF6QhsAh3SvqhxibS2n7PLAVZE3QRSn5Hic0DyXg/132","nickname":"ddh","note":"","ucode":"8E852375365F16","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541076,"discussion_content":"è¿™ä¸ªæ˜¯æœ‰å¶ç„¶æ€§çš„ï¼Œ forçš„ç›®çš„æ˜¯å»æ£€æŸ¥ä¸€æ¬¡ï¼Œ ifçš„è¯ï¼Œ å½“æœ‰å¤šä¸ªå‘é€è€…ï¼Œ ä¼šå‡ºç°è¿›æ¥äº†ä½†æ˜¯mailboxä¸æ˜¯0\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640249870,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}