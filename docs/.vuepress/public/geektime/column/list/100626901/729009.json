{"id":729009,"title":"18ï½œé”™è¯¯å¤„ç†ç³»ç»Ÿï¼šé”™è¯¯çš„æ„å»ºã€ä¼ é€’å’Œå¤„ç†","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯Mikeã€‚ä»Šå¤©æˆ‘ä»¬ä¸€èµ·æ¥å­¦ä¹ Rustè¯­è¨€ä¸­çš„é”™è¯¯è¡¨ç¤ºã€ä¼ é€’åŠå¤„ç†ç›¸å…³çš„çŸ¥è¯†ã€‚Rustçš„é”™è¯¯å¤„ç†å¾ˆé‡è¦ï¼Œä¹Ÿå¾ˆç³»ç»Ÿã€‚æ‰€ä»¥è¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬ç›´æ¥è¿›å…¥æ­£é¢˜ã€‚</p><h2>é”™è¯¯çš„åˆ†ç±»</h2><p>é”™è¯¯æ˜¯éœ€è¦åˆ†ç±»çš„ï¼Œä¸åŒç±»å‹çš„é”™è¯¯å¯èƒ½æœ‰ä¸åŒçš„å¤„ç†ç­–ç•¥ã€‚æ€»çš„æ¥çœ‹é”™è¯¯åˆ†æˆå¯æ¢å¤å‹é”™è¯¯å’Œä¸å¯æ¢å¤å‹é”™è¯¯ï¼Œä¸‹é¢æˆ‘ä»¬å…·ä½“æ¥çœ‹çœ‹è¿™ä¸¤ç§ç±»å‹ã€‚</p><h3>ä¸å¯æ¢å¤å‹é”™è¯¯</h3><p>æœ‰äº›é”™è¯¯ï¼Œæˆ‘ä»¬ç¢°åˆ°äº†åéœ€è¦åŠæ—©é€€å‡ºç¨‹åºï¼Œæˆ–è€…ç›´æ¥ä¸å¯åŠ¨ç¨‹åºï¼Œè€Œæ˜¯æ‰“å‡ºé”™è¯¯ä¿¡æ¯ã€‚</p><p>Rustä¸­ï¼Œå¯¹è¿™äº›é”™è¯¯çš„æ”¯æŒè®¾æ–½æœ‰4ä¸ªã€‚</p><ul>\n<li>panic!ï¼šè®©ç¨‹åºç›´æ¥å´©æ‰ï¼Œé€€å‡ºç¨‹åºï¼ŒåŒæ—¶å¯é€‰æ‹©æ˜¯å¦æ‰“å°å‡ºæ ˆå›æº¯ä¿¡æ¯ã€‚</li>\n<li>todo!ï¼šå¸¸ç”¨äºåŠŸèƒ½è¿˜æœªå®ç°ï¼Œæ‰§è¡Œåˆ°è¿™é‡Œç›´æ¥é€€å‡ºç¨‹åºï¼Œå¹¶æç¤ºè¯´è¿™ä¸ªåŠŸèƒ½å¤„äºå‡†å¤‡åšçš„çŠ¶æ€ã€‚</li>\n<li>unimplemented!ï¼šå¸¸ç”¨äºåŠŸèƒ½è¿˜æœªå®ç°ï¼Œæ‰§è¡Œåˆ°è¿™é‡Œç›´æ¥é€€å‡ºç¨‹åºï¼Œå¹¶æç¤ºè¯´è¿™ä¸ªåŠŸèƒ½å¤„äºæœªå®ç°çš„çŠ¶æ€ã€‚</li>\n<li>unreachable!ï¼šç”¨äºå†™åœ¨ä¸€äº›åŸåˆ™ä¸Šä¸å¯èƒ½æ‰§è¡Œåˆ°çš„è¯­å¥ï¼Œæ¯”å¦‚ä¸€ä¸ª <code>loop {}</code> æ­»å¾ªç¯çš„åé¢ï¼Œæ‰§è¡Œåˆ°é‚£é‡Œçš„è¯ï¼Œå°±è¡¨ç¤ºè‚¯å®šå‡ºé”™äº†ï¼Œç›´æ¥é€€å‡ºç¨‹åºã€‚</li>\n</ul><h3>å¯æ¢å¤å‹é”™è¯¯</h3><p>å¯æ¢å¤å‹é”™è¯¯æŒ‡çš„æ˜¯é‚£ä¸€ç±»é”™è¯¯ï¼Œåœ¨é‡åˆ°åï¼Œä¸åº”è¯¥è®©æ•´ä¸ªç¨‹åºç›´æ¥åœæ­¢è¿è¡Œï¼Œè€Œæ˜¯åœ¨ä»£ç é€»è¾‘ä¸­åˆ†æå¯èƒ½çš„é”™è¯¯åŸå› ï¼Œè¦ä¹ˆå°è¯•æ¢å¤æ€§çš„å¤„ç†æ–¹æ¡ˆï¼Œè¦ä¹ˆç»™ç”¨æˆ·è¿”å›è‡ªå®šä¹‰çš„é”™è¯¯ä¿¡æ¯ï¼Œè®©ç”¨æˆ·æ˜ç™½ä»»åŠ¡æœªè¾¾åˆ°é¢„æœŸçš„åŸå› ã€‚</p><!-- [[[read_end]]] --><p>åœ¨Rustä¸­ï¼Œä¸€èˆ¬ä½¿ç”¨ <code>Result&lt;T, E&gt;</code> æ¥æ‰¿è½½å¯èƒ½ä¼šå‡ºé”™çš„å‡½æ•°è¿”å›å€¼ã€‚<code>Result&lt;T, E&gt;</code> ä¸­çš„Tä»£è¡¨æ­£å¸¸æƒ…å†µä¸‹çš„è¿”å›ç±»å‹ï¼ŒEä»£è¡¨å‡ºé”™æƒ…å†µä¸‹çš„è¿”å›ç±»å‹ã€‚å¦‚ä½•æ–¹ä¾¿åœ°æ„é€ Eçš„å®ä¾‹ï¼Œæ˜¯ä¸€ä¸ªé‡è¦çš„è¯¾é¢˜ã€‚</p><p>ä¸å¯æ¢å¤å‹é”™è¯¯å’Œå¯æ¢å¤å‹é”™è¯¯åœ¨æŸäº›æ—¶å€™ç•Œé™ä¸æ˜¯é‚£ä¹ˆæ¸…æ™°ï¼Œåœ¨åŒä¸€ä¸ªåœ°æ–¹ï¼Œä½ æ—¢å¯ä»¥æŠŠå®ƒè®¾è®¡æˆå¯æ¢å¤å‹é”™è¯¯ï¼Œä¹Ÿå¯ä»¥æŠŠå®ƒå¤„ç†æˆä¸å¯æ¢å¤å‹é”™è¯¯ã€‚å› æ­¤ä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œæ˜¯ç”±ä¸šåŠ¡é€»è¾‘æ¥ç¡®å®šä½ è¦æŠŠå®ƒå½“æˆå“ªä¸€ç±»é”™è¯¯æ¥å¤„ç†ã€‚</p><h2>é”™è¯¯ç›¸å…³çš„åŸºç¡€è®¾æ–½</h2><h3><code>Result&lt;T, E&gt;</code></h3><p>Rustä¸­ä¸»è¦é€šè¿‡Resultç±»å‹ï¼ˆå®ä¾‹ï¼‰æ¥åŒ…è£¹é”™è¯¯ç±»å‹ï¼ˆå®ä¾‹ï¼‰ï¼ŒåŒ…è£¹åï¼ŒResultå¯ä»¥é€šè¿‡å‡½æ•°è¿”å›å€¼è¿”å›åˆ°ä¸Šä¸€å±‚è°ƒç”¨è€…å‡½æ•°ä¸­ï¼Œå†ç”±ä¸Šä¸€å±‚å‡½æ•°ä¸­çš„é€»è¾‘æ¥å†³å®šæ˜¯åœ¨è¿™ä¸€å±‚ç”¨æŸäº›é€»è¾‘å¤„ç†è¿™ä¸ªé”™è¯¯ï¼Œè¿˜æ˜¯ç»§ç»­æŠŠè¿™ä¸ªé”™è¯¯æŠ›åˆ°æ›´ä¸Šä¸€å±‚å‡½æ•°è¿›è¡Œå¤„ç†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠåŒ…è£¹é”™è¯¯çš„ <code>Result&lt;T, E&gt;</code> è½¬æ¢æˆ <code>panic!()</code> æˆ–è€…åœ¨matchçš„Erråˆ†æ”¯è°ƒç”¨ <code>panic!()</code> æ¥ä¸­æ­¢ç¨‹åºçš„è¿è¡Œã€‚</p><p>æˆ‘ä»¬å‰é¢è®²åˆ°è¿‡ <code>Result&lt;T, E&gt;</code> è§£åŒ…çš„ä¸¤ä¸ªå‡½æ•°ï¼š<code>unwrap()</code> å’Œ <code>expect()</code>ï¼Œèµ·çš„ä½œç”¨å°±æ˜¯æŠŠé”™è¯¯ Result å€¼è½¬æ¢æˆ <code>panic!()</code>ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•çš„åŒºåˆ«ä»…åœ¨äº <code>expect()</code> å¯ä»¥ä¸ºæˆ‘ä»¬æä¾›æ›´å¤šçš„ä¿¡æ¯ï¼Œè®©æˆ‘ä»¬çŸ¥é“è¿™ä¸ªpanicçš„ç²¾ç¡®ä½ç½®ï¼Œå‰ææ˜¯è¿™ä¸ªæç¤ºä¿¡æ¯è¦ç‹¬ä¸€æ— äºŒï¼Œç‰¹åˆ«æ˜¯åœ¨è°ƒç”¨æ ˆå±‚æ¬¡éå¸¸æ·±çš„æƒ…å†µä¸‹ï¼Œæä¾›å‡†ç¡®çš„panicä½ç½®ä¿¡æ¯éå¸¸é‡è¦ã€‚</p><p>ä»ä»¥ä¸Šå¯¹å‡½æ•°ä¸­é”™è¯¯å¤„ç†çš„æè¿°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œé”™è¯¯å¤„ç†æœ¬èº«æ˜¯ä¸€é¡¹ç³»ç»Ÿæ€§çš„å·¥ä½œï¼Œå…¶ä¸­åŒ…å«ï¼š</p><ol>\n<li>é”™è¯¯çš„è¡¨ç¤ºå’Œæ„é€ ï¼›</li>\n<li>é”™è¯¯çš„ä¼ é€’ï¼›</li>\n<li>é”™è¯¯çš„å¤„ç†ã€‚</li>\n</ol><p>æ®è°ƒæŸ¥ï¼Œä¸€ä¸ªè½¯ä»¶é¡¹ç›®å‘å±•åˆ°æˆç†Ÿé˜¶æ®µï¼Œç”¨äºé”™è¯¯å¤„ç†çš„ä»£ç å¯èƒ½ä¼šå æ‰€æœ‰ä»£ç çš„ä¸‰åˆ†ä¹‹ä¸€ä»¥ä¸Šã€‚è€ŒRustä»è¯­æ³•å’Œæ ‡å‡†åº“å±‚é¢ï¼Œå¯¹é”™è¯¯å¤„ç†åšäº†æ ¹æœ¬ä¸Šçš„åŸç”Ÿæ”¯æŒï¼Œå®ƒè¦æ±‚æˆ‘ä»¬å¿…é¡»å¯¹ç¨‹åºçš„å¥å£®æ€§è´Ÿè´£ï¼Œä½¿å¾—æˆ‘ä»¬æ²¡æ³•å·æ‡’ã€‚åœ¨éè¦å·æ‡’çš„æƒ…å†µä¸‹ï¼Œä¹Ÿä¼šç•™ä¸‹æ˜æ˜¾è¶³è¿¹ã€‚</p><p>æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­æ¼”ç¤ºäº†åœ¨æˆ‘ä»¬æƒ³å·æ‡’çš„æƒ…å†µä¸‹ï¼Œå‹¤å¥‹çš„Rustcå°åŠ©æ‰‹æ˜¯å¦‚ä½•æé†’æˆ‘ä»¬çš„ã€‚</p><pre><code class=\"language-plain\">fn foo() -&gt; Result&lt;String, String&gt; {\n    Ok(\"abc\".to_string())\n}\nfn main() {\n    foo();  // è¿™é‡ŒRustcå°åŠ©æ‰‹ä¼šè­¦å‘Šä½ \n}\n</code></pre><p>åœ¨å…¶ä»–è¯­è¨€ä¸­ï¼Œå¦‚æœæˆ‘ä»¬åƒä¸Šé¢ç¤ºä¾‹ä¸­é‚£æ ·è°ƒç”¨ <code>foo()</code> å‡½æ•°ï¼Œè€Œå¿½ç•¥äº†å®ƒçš„è¿”å›å€¼ï¼Œä¸€èˆ¬æ˜¯æ²¡é—®é¢˜çš„ã€‚ä½†æ˜¯åœ¨Rustçš„åœ°ç›˜ï¼ŒRustcå°åŠ©æ‰‹ä¼šæé†’æˆ‘ä»¬ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªResultæ²¡æœ‰è¢«ä½¿ç”¨ï¼Œä½ å¿…é¡»è¦å¤„ç†ä¸€ä¸‹ï¼Œå¹¶ç»™å‡ºäº†å¤„ç†å»ºè®®ã€‚</p><pre><code class=\"language-plain\">warning: unused `Result` that must be used\n&nbsp;--&gt; src/main.rs:5:5\n&nbsp; |\n5 |&nbsp; &nbsp; &nbsp;foo();&nbsp; // è¿™é‡ŒRustcå°åŠ©æ‰‹ä¼šè­¦å‘Šä½ \n&nbsp; |&nbsp; &nbsp; &nbsp;^^^^^\n&nbsp; |\n&nbsp; = note: this `Result` may be an `Err` variant, which should be handled\n&nbsp; = note: `#[warn(unused_must_use)]` on by default\nhelp: use `let _ = ...` to ignore the resulting value\n&nbsp; |\n5 |&nbsp; &nbsp; &nbsp;let _ = foo();&nbsp; // è¿™é‡ŒRustcå°åŠ©æ‰‹ä¼šè­¦å‘Šä½ \n&nbsp; |&nbsp; &nbsp; &nbsp;+++++++\n</code></pre><p>ç”±æ­¤å¯è§ï¼Œå°åŠ©æ‰‹ä¸ä¼šè®©æˆ‘ä»¬æ”¾è¿‡ä»»ä½•ä¸€ä¸ªå¯èƒ½çš„é”™è¯¯ã€‚</p><h3>Error trait</h3><p>Rustä¸­å®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡çš„Error traitï¼Œä»»ä½•å®ç°äº†è¿™ä¸ªtraitçš„ç±»å‹éƒ½è¢«Rustç”Ÿæ€è®¤ä¸ºæ˜¯ä¸€ä¸ªé”™è¯¯ç±»å‹ã€‚</p><pre><code class=\"language-plain\">pub trait Error: Debug + Display {}\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ªç±»å‹è¦å®ç°Errorï¼Œå¿…é¡»åŒæ—¶ä¸ºè¿™ä¸ªç±»å‹å®ç°Debugå’ŒDisplay traitã€‚å‰é¢æåˆ°è¿‡ï¼ŒDebug traitå¯ä»¥ä½¿ç”¨deriveå®ç”±Rustè‡ªåŠ¨ä¸ºä½ çš„ç±»å‹å®ç°ï¼Œè€ŒDisplay traitéœ€è¦ä½ è‡ªå·±æ‰‹åŠ¨implå®ç°ã€‚</p><p>å®ç°Error traitæ˜¯Rustç”Ÿæ€ä¸­çš„ä¸€ç§è§„èŒƒï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä½ æƒ³åœ¨ä½ çš„è¿™å±‚moduleé‡Œå®šä¹‰ä¸€ç§é”™è¯¯ç±»å‹çš„è¯ï¼Œä¸ºå®ƒå®ç°Debugã€Displayã€Error åï¼Œç”Ÿæ€å°±ä¼šæŠŠä½ çš„è¿™ä¸ªç±»å‹è®¤æˆä¸€ç§é”™è¯¯ç±»å‹ã€‚è¿™é‡Œå°±ä½“ç°äº†traitä½œä¸ºä¸€ç§ç¤¾åŒºåè®®çš„ä½œç”¨ã€‚</p><p>ä¸€ä¸ªé‡è¦çš„ç‚¹æ˜¯ï¼Œå®ç°äº†Error traitçš„ç±»å‹ï¼Œå¯ä»¥è¢«ä»£å…¥åˆ° dyn Error è¿™ä¸ªtrait objecté‡Œä½¿ç”¨ï¼Œè€Œç”Ÿæ€ä¸­å¾ˆå¤šåº“æ”¯æŒæ¥å— <code>&amp;dyn Error</code> æˆ– <code>Box&lt;dyn Error&gt;</code> ç±»å‹ï¼Œè¿™æ ·ä½ çš„ä»£ç å°±èƒ½å’Œé‚£äº›åº“æ— ç¼é›†æˆäº†ã€‚æ¯”å¦‚ï¼Œè®©ä½ è‡ªå®šä¹‰çš„é”™è¯¯ç±»å‹ä»ä¸‹é¢çš„å‡½æ•°ä¸­è¿”å›ã€‚</p><pre><code class=\"language-plain\">fn foo() -&gt; Result&lt;String, Box&lt;dyn Error&gt;&gt; {\n  // å¯è¿”å›ä¸€ä¸ªç”±BoxåŒ…èµ·æ¥çš„è‡ªå®šä¹‰é”™è¯¯ç±»å‹ã€‚\n}\n</code></pre><p>å½“ç„¶ï¼Œè¿™å¹¶ä¸æ˜¯è¯´ï¼Œå¯¹äº <code>std::result::Result&lt;T, E&gt;</code> è¿™ä¸ªç±»å‹ï¼Œè¿™é‡Œé¢çš„Eå°±ä¸€å®šè¦å®ç°Error traitï¼Œè¿™æ˜¯ä¸¤ç äº‹ã€‚<code>Result&lt;T, E&gt;</code> ä¸­çš„ E å¯ä»¥æ˜¯ä»»æ„ç±»å‹ã€‚æˆ‘ä»¬å†å¤ä¹ ä¸€ä¸‹æ ‡å‡†åº“é‡Œ <code>Result&lt;T, E&gt;</code> çš„å®šä¹‰ã€‚</p><pre><code class=\"language-plain\">pub enum Result&lt;T, E&gt; {\n    Ok(T),\n    Err(E),\n}\n</code></pre><p>ä»è¿™ä¸ªenumå¯ä»¥çœ‹åˆ°ï¼Œå¯¹Eæ²¡æœ‰ä»»ä½•çº¦æŸã€‚å› æ­¤ï¼Œå³ä½¿ä½ çš„ç±»å‹ä¸å®ç°Error traitï¼Œå®ƒè¿˜æ˜¯èƒ½è¢«ä»£å…¥ <code>Result&lt;T, E&gt;</code> ä¸­ä½œä¸ºé”™è¯¯ç±»å‹è€Œä½¿ç”¨ã€‚è¯·æ³¨æ„è¿™ç‚¹åŒºåˆ«ã€‚</p><p>å°æç¤ºï¼Œ<code>Result&lt;T, E&gt;</code> çš„å˜ä½“ Ok å’Œ Err å·²ç»è¢«åŠ å…¥åˆ° <code>pub std::prelude</code> é‡Œäº†ï¼Œå› æ­¤åœ¨ä»£ç ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸éœ€è¦åœ¨å‰é¢åŠ  Result å‰ç¼€ã€‚</p><h3>stdä¸­çš„é”™è¯¯ç±»å‹</h3><p>Rustæ ‡å‡†åº“é‡Œå·²ç»å®šä¹‰äº†ä¸€äº›é”™è¯¯ç±»å‹ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¸¸ç”¨çš„å‡ ä¸ªã€‚</p><h4>std::io:Error</h4><p>io Errorï¼Œè¢«å®šä¹‰æˆä¸€ä¸ªç»“æ„ä½“ï¼Œè´Ÿè´£è¡¨ç¤ºæ ‡å‡†åº“é‡ŒI/Oç›¸å…³åœºæ™¯çš„é”™è¯¯ç±»å‹ã€‚</p><pre><code class=\"language-plain\">pub struct Error { /* private fields */ }\n</code></pre><p>å¸¸è§çš„I/Oæ“ä½œæŒ‡çš„æ˜¯æ ‡å‡†è¾“å…¥è¾“å‡ºã€ç½‘ç»œè¯»å†™ã€æ–‡ä»¶è¯»å†™ç­‰ã€‚åœ¨std::ioæ¨¡å—ä¸­ï¼Œå¯¹è¿™ç§I/Oä¸Šçš„è¯»å†™åšäº†ç»Ÿä¸€çš„æŠ½è±¡ï¼Œè€Œç±»å‹io::Errorä¹Ÿæ˜¯è¿™ä¸ªæŠ½è±¡é‡Œçš„ä¸€éƒ¨åˆ†ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç”¨ <code>new()</code> å‡½æ•°åƒä¸‹é¢è¿™æ ·åˆ›å»ºä¸€ä¸ªio::Errorå®ä¾‹ï¼Œ<code>new()</code> å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ErrorKindæšä¸¾ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å…·ä½“çš„é”™è¯¯å†…å®¹ã€‚</p><pre><code class=\"language-plain\">use std::io::{Error, ErrorKind};\n\n// é”™è¯¯å¯ä»¥ä»å­—ç¬¦ä¸²ä¸­æ„é€ \nlet custom_error = Error::new(ErrorKind::Other, \"oh no!\");\n</code></pre><p>å…¶ä¸­ <a href=\"https://doc.rust-lang.org/std/io/enum.ErrorKind.html\">ErrorKind</a> æ˜¯ä¸€ä¸ªæšä¸¾ï¼Œç›®å‰åŒ…å«40ç§å˜ä½“ï¼ŒåŸºæœ¬ä¸ŠæŠŠåœ¨æ ‡å‡†åº“ä¸­èƒ½é‡åˆ°çš„I/Oé”™è¯¯éƒ½è¯¦å°½åœ°å®šä¹‰äº†ã€‚</p><pre><code class=\"language-plain\">pub enum ErrorKind {\n    NotFound,\n    PermissionDenied,\n    ConnectionRefused,\n    ConnectionReset,\n    HostUnreachable,\n    NetworkUnreachable,\n    ConnectionAborted,\n    NotConnected,\n    AddrInUse,\n    AddrNotAvailable,\n    NetworkDown,\n    BrokenPipe,\n    AlreadyExists,\n    WouldBlock,\n    NotADirectory,\n    IsADirectory,\n    DirectoryNotEmpty,\n    ReadOnlyFilesystem,\n    FilesystemLoop,\n    StaleNetworkFileHandle,\n    InvalidInput,\n    InvalidData,\n    TimedOut,\n    WriteZero,\n    StorageFull,\n    NotSeekable,\n    FilesystemQuotaExceeded,\n    FileTooLarge,\n    ResourceBusy,\n    ExecutableFileBusy,\n    Deadlock,\n    CrossesDevices,\n    TooManyLinks,\n    InvalidFilename,\n    ArgumentListTooLong,\n    Interrupted,\n    Unsupported,\n    UnexpectedEof,\n    OutOfMemory,\n    Other,\n}\n</code></pre><p>è™½ç„¶å¾ˆå¤šï¼Œä½†è¿™ä¹Ÿä»…é™äºæ ‡å‡†åº“ä¸­I/Oæ¨¡å—å¯èƒ½å‡ºç°çš„é”™è¯¯ç±»å‹ï¼Œå®ƒè¿œè¿œä¸èƒ½è¦†ç›–å…¨éƒ¨ï¼Œå› æ­¤è¿™ä¸ªErrorKindä»…ç”¨äºæ ‡å‡†åº“I/Oæ¨¡å—ç›¸å…³çš„é”™è¯¯ç±»å‹ã€‚</p><h4>parseError</h4><p>æ ‡å‡†åº“ä¸­å®šä¹‰äº†ä¸€ç»„parseç›¸å…³çš„é”™è¯¯ç±»å‹ã€‚</p><ul>\n<li>std::num::ParseIntError</li>\n<li>std::num::ParseFloatError</li>\n<li>std::char::ParseCharError</li>\n<li>std::str::ParseBoolError</li>\n<li>std::net::AddrParseError</li>\n</ul><p>è¿™äº›é”™è¯¯ç±»å‹æ˜¯ä¸FromStr traitç›¸å…³çš„ï¼Œä¹Ÿå°±æ˜¯åœ¨æŠŠå­—ç¬¦ä¸²è§£æåˆ°å…¶ä»–ç±»å‹çš„æ—¶å€™å¯èƒ½ä¼šå‡ºç°çš„é”™è¯¯ç±»å‹ï¼Œæ¯”å¦‚ï¼š</p><pre><code class=\"language-plain\">use std::net::IpAddr;\nfn main() {\n&nbsp; &nbsp; let s = \"100eee\";\n&nbsp; &nbsp; if let Err(e) = s.parse::&lt;i32&gt;() {\n        // e è¿™é‡Œæ˜¯ ParseIntError\n&nbsp; &nbsp; &nbsp; &nbsp; println!(\"Failed conversion to i32: {e}\");\n&nbsp; &nbsp; }\n\n&nbsp; &nbsp; let addr = \"127.0.0.1:8080\".parse::&lt;IpAddr&gt;();\n&nbsp; &nbsp; if let Err(e) = addr {\n        // e è¿™é‡Œæ˜¯ AddrParseError\n&nbsp; &nbsp; &nbsp; &nbsp; println!(\"Failed conversion to IpAddr: {e}\");\n&nbsp; &nbsp; }\n}\n// è¾“å‡º\nFailed conversion to i32: invalid digit found in string\nFailed conversion to IpAddr: invalid IP address syntax\n</code></pre><h3>ç”¨æšä¸¾å®šä¹‰é”™è¯¯</h3><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹åœ¨Rustä¸­ä½¿ç”¨Resultä½œä¸ºå‡½æ•°è¿”å›å€¼ï¼Œåœ¨ä¸Šå±‚ä¸­å¤„ç†çš„å…¸å‹æ–¹å¼ã€‚</p><pre><code class=\"language-plain\">// å®šä¹‰è‡ªå·±çš„é”™è¯¯ç±»å‹ï¼Œä¸€èˆ¬æ˜¯ä¸€ä¸ªæšä¸¾ï¼Œå› ä¸ºå¯èƒ½æœ‰å¤šç§é”™è¯¯\nenum HereError {\n&nbsp; &nbsp; Error1,\n&nbsp; &nbsp; Error2,\n&nbsp; &nbsp; Error3,\n}\n// ä¸€ä¸ªå‡½æ•°è¿”å›Err\nfn bar() -&gt; Result&lt;String, HereError&gt; {\n&nbsp; &nbsp; Err(HereError::Error3)\n}\n\nfn foo() {\n&nbsp; &nbsp; match bar() {\n&nbsp; &nbsp; &nbsp; &nbsp; Ok(_) =&gt; {}\n&nbsp; &nbsp; &nbsp; &nbsp; Err(err) =&gt; match err {  // åœ¨ä¸Šå±‚ä¸­é€šè¿‡matchè¿›è¡Œå¤„ç†\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HereError::Error1 =&gt; {}\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HereError::Error2 =&gt; {}\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HereError::Error3 =&gt; {}\n&nbsp; &nbsp; &nbsp; &nbsp; },\n&nbsp; &nbsp; }\n}\n</code></pre><p>é€šå¸¸æˆ‘ä»¬ä¼šåœ¨å½“å‰æ¨¡å—ä¸­å®šä¹‰é”™è¯¯ç±»å‹ï¼Œä¸€èˆ¬æ˜¯æšä¸¾ç±»å‹ï¼Œå› ä¸ºé”™è¯¯ç§ç±»å¾€å¾€ä¸æ­¢ä¸€ä¸ªã€‚å¦‚æœæŸä¸ªæ¥å£è¿”å›äº†è¿™ä¸ªé”™è¯¯ç±»å‹ï¼Œåœ¨ä¸Šå±‚å°±éœ€è¦matchè¿™ä¸ªæšä¸¾ç±»å‹è¿›è¡Œé”™è¯¯å¤„ç†ã€‚</p><p>åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å¹¶æ²¡æœ‰ç»™æˆ‘ä»¬è‡ªå®šä¹‰çš„é”™è¯¯ç±»å‹HereErrorå®ç°Debugã€Displayå’ŒError traitï¼Œæ‰€ä»¥æˆ‘ä»¬çš„é”™è¯¯ç±»å‹è¿˜ä»…é™äºè‡ªå·±ç©ï¼Œä¸ºäº†æŠŠå®ƒçº³å…¥Rustç”Ÿæ€ä½“ç³»ï¼Œæˆ‘ä»¬éœ€è¦ç»™å®ƒå®ç°è¿™3ä¸ªtraitã€‚ä½†æ˜¯æˆ‘ä»¬æ²¡å¿…è¦è‡ªå·±æ‰‹åŠ¨å»å®ç°ï¼Œç¤¾åŒºä¸­å·²ç»æœ‰å¾ˆå¥½çš„å·¥å…·crate: thiserror å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°è¿™ä¸ªç›®çš„ï¼Œç»§ç»­å¾€ä¸‹çœ‹ï¼Œå¾…ä¼šå„¿å°±ä¼šè®²åˆ°ã€‚</p><h2>é”™è¯¯çš„ä¼ é€’</h2><p>å‰é¢æˆ‘ä»¬ä»‹ç»äº†é”™è¯¯ç±»å‹çš„å®šä¹‰å’Œå¤„ç†çš„åŸºæœ¬æ–¹å¼ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¼€å§‹ç³»ç»Ÿæ€§åœ°ä»‹ç»é”™è¯¯çš„ä¼ é€’ã€‚</p><h3>å‡½æ•°è¿”å› <code>Result&lt;T, E&gt;</code></h3><p>å‰é¢å·²ç»è®²è¿‡ï¼Œåœ¨Rustä¸­åªè¦ä¸€ä¸ªå‡½æ•°ä¸­å¯èƒ½æœ‰å‡ºé”™çš„æƒ…å†µå‘ç”Ÿï¼Œé‚£ä¹ˆå®ƒçš„è¿”å›å€¼å°±é»˜è®¤çº¦å®šä¸ºResultã€‚åœ¨ç»§ç»­è®²ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå¯¹æ¯”ä¸€ä¸‹å…¶ä»–è¯­è¨€ä¸­æ˜¯æ€ä¹ˆå¤„ç†çš„ã€‚</p><p>Cè¯­è¨€ä¸­ï¼Œä¸€èˆ¬ç”¨åŒä¸€ç§ç±»å‹çš„ç‰¹æ®Šå€¼è¡¨ç¤ºå¼‚å¸¸ã€‚æ¯”å¦‚ä¸€ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªæœ‰ç¬¦å·æ•´æ•°ï¼Œå¯ä»¥ç”¨0è¡¨ç¤ºæ­£å¸¸æƒ…å†µä¸‹çš„è¿”å›ï¼Œç”¨-1æˆ–å…¶ä»–è´Ÿæ•°å€¼è¡¨ç¤ºå¼‚æ­¥æƒ…å†µä¸‹çš„è¿”å›ã€‚ä½†æ˜¯è¿™ä¸ªçº¦å®šå¹¶ä¸æ˜¯æ™®éå…±è¯†ï¼Œå› æ­¤ä½ å¯ä»¥åœ¨Cè¯­è¨€ä¸­çœ‹åˆ°ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹å‡½æ•°è¿”å›0è¡¨ç¤ºæ­£å¸¸ï¼Œä½†åœ¨ä¸€äº›ç‰¹å®šæƒ…å†µä¸‹ï¼Œè¿”å›0åˆè¡¨ç¤ºä¸æ­£ç¡®ã€‚ç¼ºä¹å¼ºåˆ¶çº¦æŸç»™æ•´ä¸ªç”Ÿæ€å¸¦æ¥äº†æ··ä¹±ã€‚</p><p>Javaè¿™ç§è¯­è¨€ï¼Œæä¾›å¼ºå¤§çš„try-catch-throwï¼Œåœ¨è¯­è¨€å±‚é¢æ•è·å¼‚å¸¸ã€‚è¿™ç§å½¢å¼è™½ç„¶æ–¹ä¾¿ï¼Œä½†å®é™…ä¸Šä¼šç»™è¯­è¨€Runtimeå¸¦æ¥è´Ÿæ‹…ï¼Œå› ä¸ºè¯­è¨€çš„Runtimeè¦è´Ÿè´£æ•è·ä»£ç ä¸­çš„å¼‚å¸¸ï¼Œä¼šæœ‰é¢å¤–çš„æ€§èƒ½æŸå¤±ã€‚å¦å¤–ï¼Œç”±äºtry-catch-throwä½¿ç”¨å¾ˆæ–¹ä¾¿ï¼Œæœ‰æ—¶ä¼šçœ‹åˆ°ç¨‹åºå‘˜ä¸ºäº†å·æ‡’ï¼Œå°†ä¸€å¤§æ®µä»£ç å…¨éƒ¨åŒ…åœ¨try-catch-throwä¸­çš„æƒ…å†µï¼Œæ— ç–‘è¿™ä¼šå¤§å¤§é™ä½ä»£ç çš„è´¨é‡ï¼Œæ•´ä¸ªç¨‹åºæ²¡åŠæ³•å¯¹é”™è¯¯æƒ…å†µåšç²¾ç»†åœ°å¤„ç†ã€‚</p><p>è€ŒRusté‡‡å–çš„æ–¹å¼æ˜¯æŠŠå¼‚å¸¸æƒ…å†µç‹¬ç«‹å‡ºæ¥ä¸€ä¸ªç»´åº¦ï¼Œæ”¾åœ¨ <code>Result&lt;T, E&gt;</code> çš„Errå˜ä½“ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé”™è¯¯åœ¨ç±»å‹ä¸Šå°±æ˜¯ä»¥ç‹¬ç«‹çš„ç»´åº¦å­˜åœ¨çš„ã€‚æ¯”å¦‚ï¼š</p><pre><code class=\"language-plain\">fn foo(num: u32) -&gt; Result&lt;String, String&gt; {\n&nbsp; &nbsp; if num == 10 {\n&nbsp; &nbsp; &nbsp; &nbsp; Ok(\"Hello world!\".to_string())\n&nbsp; &nbsp; } else {\n&nbsp; &nbsp; &nbsp; &nbsp; Err(\"I'm wrong!\".to_string())\n&nbsp; &nbsp; }\n}\n</code></pre><p>ä¸Šè¿°ä»£ç ä¸­çš„é”™è¯¯ç±»å‹éƒ¨åˆ†è¢«å®šä¹‰ä¸ºStringç±»å‹ï¼Œå®é™…ä¸Šä½ å¯ä»¥å®šä¹‰æˆä»»æ„ç±»å‹ï¼Œæ¯”å¦‚ä¸‹é¢æˆ‘ä»¬æŠŠé”™è¯¯å®šä¹‰æˆu32ç±»å‹ã€‚</p><pre><code class=\"language-plain\">fn foo(num: u32) -&gt; Result&lt;String, u32&gt; {\n&nbsp; &nbsp; if num == 10 {\n&nbsp; &nbsp; &nbsp; &nbsp; Ok(\"Hello world!\".to_string())\n&nbsp; &nbsp; } else {\n&nbsp; &nbsp; &nbsp; &nbsp; Err(100)\n&nbsp; &nbsp; }\n}\n</code></pre><p>æœ‰æ—¶ä¸€ä¸ªå‡½æ•°ä¸­çš„é”™è¯¯æƒ…å†µå¯èƒ½ä¸æ­¢ä¸€ç§ï¼Œè¿™æ—¶å€™è¯¥æ€æ ·å®šä¹‰è¿”å›ç±»å‹å‘¢ï¼Ÿæƒ¯ç”¨åŠæ³•å°±æ˜¯ä½¿ç”¨enumï¼Œå‰é¢å…¶å®å·²ç»è§è¿‡äº†ï¼Œè¿™é‡Œå†çœ‹ä¸€ä¸ªç¤ºä¾‹ã€‚</p><pre><code class=\"language-plain\">enum MyError {\n&nbsp; &nbsp; Error1,\n&nbsp; &nbsp; Error2,\n&nbsp; &nbsp; Error3,\n}\n\nfn foo(num: u32) -&gt; Result&lt;String, MyError&gt; {\n&nbsp; &nbsp; match num {\n&nbsp; &nbsp; &nbsp; &nbsp; 10 =&gt; Ok(\"Hello world!\".to_string()),\n&nbsp; &nbsp; &nbsp; &nbsp; 20 =&gt; Err(MyError::Error1),\n&nbsp; &nbsp; &nbsp; &nbsp; 30 =&gt; Err(MyError::Error2),\n&nbsp; &nbsp; &nbsp; &nbsp; _ =&gt; Err(MyError::Error3),\n&nbsp; &nbsp; }\n}\n</code></pre><p>è¿™é‡ŒResultçš„Eéƒ¨åˆ†ï¼Œç±»å‹å°±æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„MyErrorã€‚</p><p>å¦ä¸€ç§å¸¸ç”¨çš„åŠæ³•æ˜¯è®©å‡½æ•°è¿”å› <code>Result&lt;_, Box&lt;dyn Error&gt;&gt;</code>ï¼Œæ¯”å¦‚ï¼š</p><pre><code class=\"language-plain\">use std::error::Error;\nuse std::fmt;\n\n#[derive(Debug)]\nstruct MyError;\n\nimpl fmt::Display for MyError {\n&nbsp; &nbsp; fn fmt(&amp;self, f: &amp;mut fmt::Formatter&lt;'_&gt;) -&gt; fmt::Result {\n&nbsp; &nbsp; &nbsp; &nbsp; write!(f, \"{}\", self)\n&nbsp; &nbsp; }\n}\n\nimpl Error for MyError {}\n\nfn foo(num: u32) -&gt; Result&lt;String, Box&lt;dyn Error&gt;&gt; {\n&nbsp; &nbsp; match num {\n&nbsp; &nbsp; &nbsp; &nbsp; 10 =&gt; Ok(\"Hello world!\".to_string()),\n&nbsp; &nbsp; &nbsp; &nbsp; _ =&gt; {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let my_error = MyError;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Err(Box::new(my_error))\n&nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; }\n}\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸€æ—¦æŠŠé”™è¯¯ç‹¬ç«‹åˆ°å¦ä¸€ä¸ªç»´åº¦æ¥å¤„ç†åï¼Œæˆ‘ä»¬å¾—åˆ°äº†ç›¸å½“å¤§çš„çµæ´»æ€§å’Œå®‰å…¨æ€§ï¼šå¯ä»¥å€ŸåŠ©ç±»å‹ç³»ç»Ÿæ¥å¸®åŠ©æ£€æŸ¥æ­£å¸¸æƒ…å†µä¸å¼‚å¸¸æƒ…å†µçš„ä¸åŒè¿”å›ï¼Œå¤§å¤§å‡å°‘äº†ç¼–ç å‡ºé”™çš„æœºç‡ã€‚</p><p>æœ‰äº†è¿™å¥—ä¼˜ç§€çš„é”™è¯¯å¤„ç†åº•å±‚è®¾æ–½åï¼Œæ•´ä¸ªRustç”Ÿæ€ä¸Šå±‚å»ºç­‘é€æ¸ç»“æ„æ€§åœ°æ„å»ºèµ·æ¥äº†ï¼Œå¤§å®¶éƒ½éµä»è¿™ä¸ªçº¦å®šï¼Œç”¨åŒæ ·çš„æ–¹å¼æ¥ä¼ é€’å’Œå¤„ç†é”™è¯¯ï¼Œå½¢æˆäº†ä¸€ä¸ªå¥åº·è‰¯å¥½çš„ç”Ÿæ€ã€‚</p><h3>map_errè½¬æ¢é”™è¯¯ç±»å‹</h3><p>æˆ‘ä»¬å¸¸å¸¸ä½¿ç”¨Resultä¸Šçš„ <code>map_err</code> æ–¹æ³•æ‰‹åŠ¨è½¬æ¢é”™è¯¯ç±»å‹ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ï¼š</p><pre><code class=\"language-plain\">use std::fs::File;\nuse std::io::Read;\n\nfn read_file() -&gt; Result&lt;String, String&gt; {\n&nbsp; &nbsp; match File::open(\"example.txt\").map_err(|err| format!(\"Error opening file: {}\", err)) {\n&nbsp; &nbsp; &nbsp; &nbsp; Ok(mut file) =&gt; {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let mut contents = String::new();\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; match file\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .read_to_string(&amp;mut contents)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .map_err(|err| format!(\"Error reading file: {}\", err))\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Ok(_) =&gt; Ok(contents),\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Err(e) =&gt; {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return Err(e);\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; &nbsp; &nbsp; Err(e) =&gt; {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return Err(e);\n&nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; }\n}\n</code></pre><p>æˆ‘ä»¬è¦åœ¨ <code>read_file()</code> ä¸­æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶è¯»å–æ–‡ä»¶å…¨éƒ¨å†…å®¹åˆ°å­—ç¬¦ä¸²ä¸­ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œæœ‰å¯èƒ½å‡ºç°ä¸¤ä¸ªI/Oé”™è¯¯ï¼šæ‰“å¼€æ–‡ä»¶é”™è¯¯å’Œè¯»å–æ–‡ä»¶é”™è¯¯ã€‚å¯ä»¥çœ‹åˆ°åœ¨ç¤ºä¾‹ä¸­æˆ‘ä»¬ä½¿ç”¨ <code>map_err</code> å°†è¿™ä¸¤ä¸ªI/Oé”™è¯¯çš„ç±»å‹éƒ½è½¬æ¢æˆäº†Stringç±»å‹ï¼Œæ¥å’Œå‡½æ•°è¿”å›ç±»å‹ç­¾åç›¸åŒ¹é…ã€‚ç„¶åï¼Œå¯¹ä¸¤ä¸ªæ“ä½œçš„Resultè¿›è¡Œäº†matchåŒ¹é…ã€‚è¿™ä¸ªå‡½æ•°é‡Œçš„ä¸¤ä¸ªæ–‡ä»¶æ“ä½œå¯èƒ½çš„é”™è¯¯éƒ½æ˜¯std::io::Errorç±»å‹çš„ã€‚</p><p>å¾ˆå¤šæ—¶å€™åŒä¸€ä¸ªå‡½æ•°ä¸­ä¼šäº§ç”Ÿä¸åŒçš„é”™è¯¯ç±»å‹ï¼Œè¿™æ—¶ä»ç„¶å¯ä»¥ä½¿ç”¨ <code>map_err</code> æ˜¾å¼åœ°æŠŠä¸åŒçš„é”™è¯¯ç±»å‹è½¬æ¢æˆæˆ‘ä»¬éœ€è¦çš„åŒä¸€ç§é”™è¯¯ç±»å‹ã€‚</p><h3>Result é“¾å¼å¤„ç†</h3><p>é™¤äº†æ¯æ¬¡å¯¹Resultè¿›è¡Œmatchå¤„ç†å¤–ï¼ŒRustä¸­è¿˜æµè¡Œä¸€ç§æ–¹å¼ï¼Œå°±æ˜¯å¯¹Resultè¿›è¡Œé“¾å¼å¤„ç†ã€‚æˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢æ‰“å¼€æ–‡ä»¶å¹¶è¯»å–å†…å®¹çš„ä¾‹å­æ”¹å†™æˆé“¾å¼è°ƒç”¨çš„é£æ ¼ã€‚</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">use std::fs::File;\nuse std::io::Read;\n\nfn read_file() -&gt; Result&lt;String, String&gt; {\n&nbsp; &nbsp; File::open(\"example.txt\")\n&nbsp; &nbsp; &nbsp; &nbsp; .map_err(|err| format!(\"Error opening file: {}\", err))&nbsp;\n&nbsp; &nbsp; &nbsp; &nbsp; .and_then(|mut file| {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let mut contents = String::new();\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; file.read_to_string(&amp;mut contents)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .map_err(|err| format!(\"Error reading file: {}\", err))\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .map(|_| contents)\n&nbsp; &nbsp; &nbsp; &nbsp; })\n}\n\nfn main() {\n&nbsp; &nbsp; match read_file() {\n&nbsp; &nbsp; &nbsp; &nbsp; Ok(n) =&gt; println!(\"{}\", n),\n&nbsp; &nbsp; &nbsp; &nbsp; Err(err) =&gt; println!(\"Error: {}\", err),\n&nbsp; &nbsp; }\n}\n</code></pre><p>å¯ä»¥æ˜æ˜¾çœ‹åˆ°ï¼Œä½¿ç”¨é“¾å¼é£æ ¼æ”¹å†™çš„ç¤ºä¾‹æ¯”å‰é¢ç”¨matchè¿›è¡Œå¤„ç†çš„ç¤ºä¾‹ç®€æ´å¾ˆå¤šã€‚è¿™é‡Œç”¨åˆ°äº† <code>map_err</code>ã€<code>and_then</code>ã€<code>map</code> ä¸‰ç§é“¾å¼æ“ä½œï¼Œå®ƒä»¬å¯ä»¥åœ¨ä¸è§£å¼€ResultåŒ…çš„æƒ…å†µä¸‹ç›´æ¥å¯¹é‡Œé¢çš„å†…å®¹è¿›è¡Œå¤„ç†ã€‚å…³äºè¿™å‡ ä¸ªæ–¹æ³•çš„è¯¦ç»†å†…å®¹ï¼Œä½ å¯ä»¥å‚è€ƒ<a href=\"https://time.geekbang.org/column/article/722702\">ç¬¬ 8 è®²</a>ã€‚</p><p>è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œåœ¨ç¬¬5è¡Œ <code>File::open()</code> æ‰§è¡Œå®Œï¼Œå¦‚æœäº§ç”Ÿçš„ Result æ˜¯ Errï¼Œé‚£ä¹ˆåœ¨ç¬¬6è¡Œ <code>map_err()</code> åï¼Œä¸ä¼šå†èµ° <code>and_then()</code> æ“ä½œï¼Œè€Œæ˜¯ç›´æ¥ä» <code>read_file()</code> å‡½æ•°ä¸­è¿”å›è¿™ä¸ª Result äº†ã€‚å¦‚æœç¬¬5è¡Œçš„æ“ä½œäº§ç”Ÿçš„ Result æ˜¯ Okï¼Œå°±ä¼šè·³è¿‡ç¬¬6è¡Œï¼Œè¿›å…¥ç¬¬7è¡Œæ‰§è¡Œã€‚</p><p>è¿›å…¥ç¬¬7è¡Œåï¼Œä¼šæ¶ˆè§£å‰é¢äº§ç”Ÿçš„Resultï¼ŒæŠŠ file å¯¹è±¡ä¼ è¿›æ¥ä½¿ç”¨ã€‚ç„¶åæˆ‘ä»¬å†å»çœ‹ç¬¬9è¡Œäº§ç”Ÿçš„Resultï¼Œå¦‚æœè¿™ä¸ªResultå®ä¾‹æ˜¯Errï¼Œé‚£ä¹ˆæ‰§è¡Œå®Œç¬¬10è¡Œåï¼Œå°±ç›´æ¥ä»é—­åŒ…è¿”å›äº†ï¼Œè¿”å›çš„æ˜¯Errå€¼ï¼Œè¿™ä¸ªå€¼ä¼šè¿›ä¸€æ­¥ä½œä¸º <code>read_file()</code> å‡½æ•°çš„è¿”å›å€¼è¿”å›ã€‚è€Œå¦‚æœResultå®ä¾‹æ˜¯Okï¼Œå°±ä¼šè·³è¿‡ç¬¬10è¡Œï¼Œæ‰§è¡Œç¬¬11è¡Œï¼Œç¬¬11è¡Œå°† contents å­—ç¬¦ä¸²moveè¿›æ¥ä½œä¸ºå†…å±‚é—­åŒ…çš„è¿”å›å€¼ï¼Œå¹¶è¿›ä¸€æ­¥ä»¥ <code>Ok(contents)</code> çš„å½¢å¼ä½œä¸º <code>read_file()</code> å‡½æ•°çš„è¿”å›å€¼è¿”å›ã€‚</p><p>ä½ å¯èƒ½ä¼šæƒŠå¹ï¼Œè¿™ç§é“¾å¼å¤„ç†æ¯”å‰é¢çš„matchæ“ä½œä¼˜ç¾å¤ªå¤šï¼Œä½†æ˜¯ç†è§£èµ·æ¥ä¹Ÿå›°éš¾å¤ªå¤šã€‚è¿™æ˜¯æ­£å¸¸çš„ï¼Œå¼€å§‹çš„æ—¶å€™æˆ‘ä»¬å¯¹è¿™ç§é“¾å¼å†™æ³•ä¼šæ¯”è¾ƒé™Œç”Ÿï¼Œä¸è¿‡æ²¡å…³ç³»ï¼Œå¯ä»¥å¤šå†™å†™ï¼Œæ…¢æ…¢ç†è§£ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªç†Ÿèƒ½ç”Ÿå·§çš„äº‹æƒ…ï¼Œæœ¬èº«å…¶å®å¹¶ä¸å¤æ‚ã€‚</p><h3>? é—®å·æ“ä½œç¬¦</h3><p>å¦ä¸€æ–¹é¢ï¼Œå‰é¢çš„matchå†™æ³•ï¼Œæœ‰æ²¡æœ‰åŠæ³•ç®€åŒ–å‘¢ï¼Ÿå› ä¸ºçœ‹ä¸Šå»å¥½åƒæœ‰å¾ˆå¤šæ ·æ¿ä»£ç ã€‚</p><pre><code class=\"language-plain\">use std::fs::File;\nuse std::io::Read;\n\nfn read_file() -&gt; Result&lt;String, String&gt; {\n&nbsp; &nbsp; match File::open(\"example.txt\").map_err(|err| format!(\"Error opening file: {}\", err)) {\n&nbsp; &nbsp; &nbsp; &nbsp; Ok(mut file) =&gt; {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let mut contents = String::new();\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; match file\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .read_to_string(&amp;mut contents)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .map_err(|err| format!(\"Error reading file: {}\", err))\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Ok(_) =&gt; Ok(contents),\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Err(e) =&gt; {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return Err(e);\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; &nbsp; &nbsp; Err(e) =&gt; {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return Err(e);\n&nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; }\n}\n</code></pre><p>æ¯”å¦‚ä¸Šé¢ä»£ç ä¸­çš„ç¬¬13ï½15è¡Œå’Œç¬¬18ï½20è¡Œï¼Œéƒ½æ˜¯æŠŠé”™è¯¯ <code>Err(e)</code> è¿”å›åˆ°ä¸Šä¸€å±‚ã€‚</p><pre><code class=\"language-plain\">  Err(e) =&gt; {\n      return Err(e);\n  }\n</code></pre><p>Rustä¸­æœ‰ä¸€ä¸ª <code>ï¼Ÿ</code> æ“ä½œç¬¦ï¼Œå¯ä»¥ç”¨æ¥ç®€åŒ–è¿™ç§åœºæ™¯ã€‚æˆ‘ä»¬æŠŠå‰é¢ä»£ç ç”¨ <code>ï¼Ÿ</code> æ“ä½œç¬¦æ”¹é€ ä¸€ä¸‹ã€‚</p><pre><code class=\"language-plain\">use std::fs::File;\nuse std::io::Read;\n\nfn read_file() -&gt; Result&lt;String, String&gt; {\n&nbsp; &nbsp; let mut file =\n&nbsp; &nbsp; &nbsp; &nbsp; File::open(\"example.txt\").map_err(|err| format!(\"Error opening file: {}\", err))?;\n&nbsp; &nbsp; let mut contents = String::new();\n&nbsp; &nbsp; file.read_to_string(&amp;mut contents)\n&nbsp; &nbsp; &nbsp; &nbsp; .map_err(|err| format!(\"Error reading file: {}\", err))?;\n\n&nbsp; &nbsp; Ok(contents)\n}\n</code></pre><p>å“‡ï¼Œç¥å¥‡ä¸ï¼Ÿæ€ä¹ˆè¡Œæ•°ç¼©çŸ­äº†è¿™ä¹ˆå¤šã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œ<code>ï¼Ÿ</code> æ“ä½œç¬¦å¤§ä½“ä¸Šç­‰ä»·äºä¸€ä¸ªmatchè¯­å¥ã€‚</p><pre><code class=\"language-plain\">let ret = a_result?;\nç­‰ä»·äº\nlet ret = match a_result {\n    Ok(ret) =&gt; ret,                \n    Err(e) =&gt; return Err(e),   // æ³¨æ„è¿™é‡Œæœ‰ä¸€ä¸ªreturnè¯­å¥ã€‚\n};\n</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœresultçš„å€¼æ˜¯Okï¼Œå°±è§£åŒ…ï¼›å¦‚æœæ˜¯Errï¼Œå°±æå‰ä»æ­¤å‡½æ•°ä¸­è¿”å›è¿™ä¸ªErrã€‚è¿™å®é™…æ˜¯ä¸€ç§<strong>é˜²å¾¡å¼ç¼–ç¨‹</strong>ï¼Œé‡åˆ°äº†é”™è¯¯ï¼Œå°±æå‰è¿”å›ã€‚é˜²å¾¡å¼ç¼–ç¨‹èƒ½è®©å‡½æ•°ä½“ä¸­çš„ä»£ç å¤§å¤§ç®€åŒ–ï¼Œå¯ä»¥å‡å°‘å¾ˆå¤šå±‚æ‹¬å·ï¼Œç›¸ä¿¡ä½ å·²ç»ä»ä¸Šé¢çš„ç¤ºä¾‹å¯¹æ¯”ä¸­æ„Ÿå—åˆ°äº†ã€‚</p><p>ç»†å¿ƒçš„ä½ å¯èƒ½å·²ç»å‘ç°äº†ï¼Œè¿™é‡Œçš„eæ˜¯è¿™ä¸ª <code>a_result</code> é‡Œ <code>Err(e)</code> ä¸­çš„ eã€‚è¿™ä¸ªå®ä¾‹çš„ç±»å‹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä½¿ç”¨returnè¯­å¥è¿”å›å®ƒçš„è¯ï¼Œé‚£ä¹ˆå®ƒæ˜¯ä¸æ˜¯ä¸€å®šå’Œå‡½æ•°ä¸­å®šä¹‰çš„è¿”å›ç±»å‹ä¸­çš„é”™è¯¯ç±»å‹ä¸€è‡´å‘¢ï¼Ÿè¿™ä¸ªé—®é¢˜å…¶å®å¾ˆé‡è¦ã€‚ä»ä¸Šé¢çš„ç¤ºä¾‹æ¥çœ‹ï¼Œæˆ‘ä»¬æ˜ç¡®åœ°ç”¨ <code>map_err</code> æŠŠ io::Error è½¬æ¢æˆäº† String è¿™ç§ç±»å‹ï¼Œæ‰€ä»¥æ˜¯æ²¡é—®é¢˜çš„ã€‚æˆ‘ä»¬å¯ä»¥æ¥åšä¸ªå®éªŒï¼ŒæŠŠ <code>map_err</code> å»æ‰è¯•è¯•ã€‚</p><pre><code class=\"language-plain\">use std::fs::File;\nuse std::io::Read;\n\nfn read_file() -&gt; Result&lt;String, String&gt; {\n&nbsp; &nbsp; let mut file =\n&nbsp; &nbsp; &nbsp; &nbsp; File::open(\"example.txt\")?;\n&nbsp; &nbsp; let mut contents = String::new();\n&nbsp; &nbsp; file.read_to_string(&amp;mut contents)?;\n\n&nbsp; &nbsp; Ok(contents)\n}\n</code></pre><p>ç¼–è¯‘å™¨æŠ¥é”™äº†ï¼š</p><pre><code class=\"language-plain\">error[E0277]: `?` couldn't convert the error to `String`\n&nbsp;--&gt; src/lib.rs:6:34\n&nbsp; |\n4 | fn read_file() -&gt; Result&lt;String, String&gt; {\n&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;---------------------- expected `String` because of this\n5 |&nbsp; &nbsp; &nbsp;let mut file =\n6 |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;File::open(\"example.txt\")?;\n&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^ the trait `From&lt;std::io::Error&gt;` is not implemented for `String`\n&nbsp; |\n&nbsp; = note: the question mark operation (`?`) implicitly performs a conversion on the error value using the `From` trait\n&nbsp; = help: the following other types implement trait `From&lt;T&gt;`:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;String as From&lt;char&gt;&gt;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;String as From&lt;Box&lt;str&gt;&gt;&gt;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;String as From&lt;Cow&lt;'a, str&gt;&gt;&gt;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;String as From&lt;&amp;str&gt;&gt;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;String as From&lt;&amp;mut str&gt;&gt;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;String as From&lt;&amp;String&gt;&gt;\n&nbsp; = note: required for `Result&lt;String, String&gt;` to implement `FromResidual&lt;Result&lt;Infallible, std::io::Error&gt;&gt;`\n\nerror[E0277]: `?` couldn't convert the error to `String`\n&nbsp;--&gt; src/lib.rs:8:39\n&nbsp; |\n4 | fn read_file() -&gt; Result&lt;String, String&gt; {\n&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;---------------------- expected `String` because of this\n...\n8 |&nbsp; &nbsp; &nbsp;file.read_to_string(&amp;mut contents)?;\n&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;^ the trait `From&lt;std::io::Error&gt;` is not implemented for `String`\n&nbsp; |\n&nbsp; = note: the question mark operation (`?`) implicitly performs a conversion on the error value using the `From` trait\n&nbsp; = help: the following other types implement trait `From&lt;T&gt;`:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;String as From&lt;char&gt;&gt;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;String as From&lt;Box&lt;str&gt;&gt;&gt;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;String as From&lt;Cow&lt;'a, str&gt;&gt;&gt;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;String as From&lt;&amp;str&gt;&gt;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;String as From&lt;&amp;mut str&gt;&gt;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;String as From&lt;&amp;String&gt;&gt;\n&nbsp; = note: required for `Result&lt;String, String&gt;` to implement `FromResidual&lt;Result&lt;Infallible, std::io::Error&gt;&gt;`\n</code></pre><p>æç¤ºè¯´ï¼Œ<code>?</code> æ“ä½œç¬¦ä¸èƒ½æŠŠé”™è¯¯ç±»å‹è½¬æ¢æˆ String ç±»å‹ã€‚è¿™ä¹Ÿæ˜¯åˆå­¦è€…åœ¨ä½¿ç”¨ ï¼Ÿæ“ä½œç¬¦æ—¶çš„ä¸€ä¸ªå¸¸è§é”™è¯¯ï¼Œå®¹æ˜“é‡åˆ°é”™è¯¯ç±»å‹ä¸ä¸€è‡´çš„é—®é¢˜ã€‚å¹¶ä¸”é‡åˆ°è¿™ç§é”™è¯¯æ—¶å®Œå…¨ä¸çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆï¼Œæ›´ä¸çŸ¥é“æ€ä¹ˆè§£å†³ã€‚</p><p>æˆ‘ä»¬ç»§ç»­çœ‹é”™è¯¯æç¤ºï¼Œå®ƒè¯´ï¼Œ<code>ï¼Ÿ</code> æ“ä½œç¬¦åˆ©ç”¨From traitå°è¯•å¯¹é”™è¯¯ç±»å‹åšéšå¼è½¬æ¢ï¼Œå¹¶åˆ—å‡ºäº†å‡ ç§å·²ç»å®ç°äº†çš„å¯ä»¥è½¬æ¢åˆ°Stringçš„é”™è¯¯ç±»å‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒRuståœ¨å¤„ç† <code>ï¼Ÿ</code> æ“ä½œç¬¦çš„æ—¶å€™ï¼Œä¼šå°è¯•å¯¹é”™è¯¯ç±»å‹è¿›è¡Œè½¬æ¢ï¼Œè¯•ç€çœ‹èƒ½ä¸èƒ½è‡ªåŠ¨æŠŠé”™è¯¯ç±»å‹è½¬æ¢åˆ°å‡½æ•°è¿”å›ç±»å‹ä¸­çš„é‚£ä¸ªé”™è¯¯ç±»å‹ä¸Šå»ã€‚å¦‚æœä¸è¡Œï¼Œå°±ä¼šæŠ¥é”™ã€‚ä½ å¯ä»¥å‚è€ƒ<a href=\"https://time.geekbang.org/column/article/724942\">ç¬¬ 11 è®²</a>ï¼Œå›é¡¾ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ <code>From&lt;T&gt; trait</code>ã€‚æˆ‘ä»¬æŒ‰ç…§è¦æ±‚å¯¹ std::io::Error å®ç°ä¸€ä¸‹è¿™ä¸ªè½¬æ¢å°±å¥½äº†ã€‚</p><pre><code class=\"language-plain\">use std::fs::File;\nuse std::io::Read;\n\nimpl From&lt;std::io::Error&gt; for String {\n&nbsp; &nbsp; fn from(err: std::io::Error) -&gt; Self {\n&nbsp; &nbsp; &nbsp; &nbsp; format!(\"{}\", err)\n&nbsp; &nbsp; }\n}\n\nfn read_file() -&gt; Result&lt;String, String&gt; {\n&nbsp; &nbsp; let mut file =\n&nbsp; &nbsp; &nbsp; &nbsp; File::open(\"example.txt\")?;\n&nbsp; &nbsp; let mut contents = String::new();\n&nbsp; &nbsp; file.read_to_string(&amp;mut contents)?;\n\n&nbsp; &nbsp; Ok(contents)\n}\n</code></pre><p>å’¦ï¼Œä¸é€šè¿‡ï¼Œæç¤ºï¼š</p><pre><code class=\"language-plain\">error[E0117]: only traits defined in the current crate can be implemented for types defined outside of the crate\n&nbsp;--&gt; src/lib.rs:4:1\n&nbsp; |\n4 | impl From&lt;std::io::Error&gt; for String {\n&nbsp; | ^^^^^--------------------^^^^^------\n&nbsp; | |&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |\n&nbsp; | |&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; `String` is not defined in the current crate\n&nbsp; | |&nbsp; &nbsp; `std::io::Error` is not defined in the current crate\n&nbsp; | impl doesn't use only types from inside the current crate\n&nbsp; |\n&nbsp; = note: define and implement a trait or new type instead\n</code></pre><p>å‘ç°å®ƒè¿åäº†<a href=\"https://time.geekbang.org/column/article/723496\">ç¬¬ 9 è®²</a>æˆ‘ä»¬è¯´è¿‡çš„traitå­¤å„¿è§„åˆ™ã€‚æ€ä¹ˆè§£å†³å‘¢ï¼Ÿå¥½åŠï¼Œé‡æ–°å®šä¹‰ä¸€ä¸ªè‡ªå·±çš„ç±»å‹å°±å¯ä»¥äº†ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹ä¿®æ”¹åçš„ä»£ç ã€‚</p><pre><code class=\"language-plain\">use std::fs::File;\nuse std::io::Read;\n\nstruct MyError(String);  // ç”¨newtypeæ–¹æ³•å®šä¹‰äº†ä¸€ä¸ªæ–°çš„é”™è¯¯ç±»å‹\n\nimpl From&lt;std::io::Error&gt; for MyError {\n&nbsp; &nbsp; fn from(err: std::io::Error) -&gt; Self {\n&nbsp; &nbsp; &nbsp; &nbsp; MyError(format!(\"{}\", err))\n&nbsp; &nbsp; }\n}\n\nfn read_file() -&gt; Result&lt;String, MyError&gt; {\n&nbsp; &nbsp; let mut file =\n&nbsp; &nbsp; &nbsp; &nbsp; File::open(\"example.txt\")?;\n&nbsp; &nbsp; let mut contents = String::new();\n&nbsp; &nbsp; file.read_to_string(&amp;mut contents)?;\n\n&nbsp; &nbsp; Ok(contents)\n}\n</code></pre><p>è¿™ä¸‹å°±å¯¹äº†ã€‚</p><p>ç¤ºä¾‹é‡Œï¼Œæˆ‘ä»¬åœ¨ç¬¬4è¡Œç”¨newtypeæ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªè‡ªå®šä¹‰é”™è¯¯ç±»å‹ï¼Œé‡Œé¢åŒ…äº†Stringç±»å‹ï¼Œç„¶ååœ¨ç¬¬6è¡Œå¯¹å®ƒå®ç° <code>From&lt;std::io::Error&gt;</code>ï¼Œåœ¨ç¬¬8è¡Œäº§ç”Ÿäº†é”™è¯¯ç±»å‹å®ä¾‹ã€‚ç„¶ååœ¨ç¬¬12è¡Œï¼ŒæŠŠ <code>read_file()</code> çš„è¿”å›ç±»å‹æ”¹æˆäº† <code>Result&lt;String, MyError&gt;</code>ã€‚</p><p>è¿™æ ·å°±å¯ä»¥äº†ï¼Œå¦‚æœå‡ºç°æ‰“å¼€æ–‡ä»¶é”™è¯¯æˆ–è€…è¯»å–æ–‡ä»¶é”™è¯¯ï¼Œ<code>ï¼Ÿ</code> æ“ä½œç¬¦ä¼šè‡ªåŠ¨æŠŠstd::io::Errorç±»å‹è½¬æ¢åˆ°æˆ‘ä»¬çš„MyErrorç±»å‹ä¸Šå»ï¼Œå¹¶ä» <code>read_file()</code> å‡½æ•°é‡Œè¿”å›ã€‚ä¸å†éœ€è¦æˆ‘ä»¬æ¯æ¬¡æ‰‹åŠ¨å†™ <code>map_err</code> è½¬æ¢é”™è¯¯ç±»å‹äº†ã€‚æ•´ä¸ªä»£ç ç»“æ„çœ‹ä¸Šå»éå¸¸æ¸…çˆ½ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªéå¸¸ä¸é”™çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>åˆ©ç”¨ <code>ï¼Ÿ</code> æ“ä½œç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°çš„åµŒå¥—è°ƒç”¨ä¸­å®ç°ä¸€ç§å†’æ³¡å¼çš„é”™è¯¯å‘ä¸Šä¼ é€’çš„æ•ˆæœã€‚</p><h2>é”™è¯¯å¤„ç†ç³»ç»Ÿæœ€ä½³å®è·µ</h2><p>æœ‰äº†å‰é¢çš„é“ºå«ï¼Œä¸‹é¢æˆ‘ä»¬æ¥è®²ä¸€ä¸‹Rustä¸­çš„é”™è¯¯å¤„ç†ç³»ç»Ÿæœ€ä½³å®è·µæ˜¯ä»€ä¹ˆã€‚</p><h3>é”™è¯¯çš„å†’æ³¡</h3><p>é€šå¸¸æˆ‘ä»¬ç¼–å†™çš„è½¯ä»¶æœ‰å¾ˆå¤šä¾èµ–ï¼Œåœ¨æ¯ä¸ªä¾èµ–ç”šè‡³æ¯ä¸ªæ¨¡å—ä¸­ï¼Œå¯èƒ½éƒ½æœ‰å¯¹åº”çš„é”™è¯¯å­ç³»ç»Ÿè®¾è®¡ã€‚ä¸€èˆ¬ä¼šä»¥ä¸€ä¸ªcrateä¸ºè¾¹ç•Œæš´éœ²å‡ºå¯¹è±¡çš„é”™è¯¯ç±»å‹åŠå¯èƒ½ç›¸å…³çš„å¤„ç†æ¥å£ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬ä»ä¾èµ–æ ‘çš„è§’åº¦æ¥çœ‹ï¼Œä½ ç¼–å†™çš„è½¯ä»¶çš„é”™è¯¯ç³»ç»Ÿä¹Ÿæ˜¯ä»¥æ ‘çš„å½¢å¼ç»„ç»‡èµ·æ¥çš„ï¼Œæ˜¯ä¸€ä¸ªå±‚çº§ç³»ç»Ÿã€‚</p><p>åœ¨å±‚çº§é”™è¯¯ç³»ç»Ÿä¸­ï¼ŒæŸä¸€å±‚å‡ºç°çš„é”™è¯¯æœ‰çš„ä¼šåœ¨é‚£ä¸€å±‚å¤„ç†ï¼Œä½†æœ‰çš„ä¹Ÿä¸ä¸€å®šä¼šåœ¨é‚£ä¸€å±‚å¤„ç†æ‰ï¼Œè€Œæ˜¯é‡‡ç”¨ç±»ä¼¼å†’æ³¡çš„æ–¹å¼ä¼ é€’åˆ°æ›´ä¸Šå±‚æ¥å¤„ç†ã€‚å‰é¢è®²åˆ°çš„ ï¼Ÿæ“ä½œç¬¦å°±æ˜¯ç”¨äºç¼–å†™å†’æ³¡é”™è¯¯å¤„ç†èŒƒå¼çš„ä¾¿æ·è®¾æ–½ã€‚</p><p>é‚£ä¹ˆä»ä¸‹å±‚ä¼ ä¸Šæ¥çš„é”™è¯¯ï¼Œå…·ä½“åº”è¯¥åœ¨å“ªä¸ªå±‚æ¬¡è¿›è¡Œå¤„ç†å‘¢ï¼Ÿè¿™ä¸ªé—®é¢˜æ²¡æœ‰ç»Ÿä¸€çš„ç­”æ¡ˆï¼Œæ˜¯ç”±å…·ä½“çš„è½¯ä»¶æ¶æ„è®¾è®¡å†³å®šçš„ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªè½¯ä»¶å®ƒæœ¬èº«çš„æ¶æ„ä¹Ÿæ˜¯åœ¨ä¸æ–­æ¼”è¿›çš„ï¼Œå¾ˆå¯èƒ½å¼€å§‹çš„æ—¶å€™ï¼Œä½ ä¼šåœ¨ä¸­é—´æŸä¸€å±‚ç»™å‡ºä¸€ä¸ªå¤„ç†æ–¹æ¡ˆï¼Œä½†æ˜¯éšç€æ¶æ„æ¼”åŒ–ï¼Œå¯èƒ½æœ€åä¼šå¾€ä¸ŠæŠ›ï¼Œç”šè‡³æŠ›åˆ°ç•Œé¢å±‚ï¼ŒæŠ›ç»™ä½ çš„ç”¨æˆ·æ¥å¤„ç†ã€‚æƒ…å†µåƒå˜ä¸‡åŒ–ï¼Œéœ€è¦å…·ä½“é—®é¢˜å…·ä½“åˆ†æã€‚</p><p>é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰æœ€ä½³å®è·µå‘¢ï¼Ÿç»è¿‡Rustç¤¾åŒºå‡ å¹´çš„æ¢ç´¢ï¼Œç›®å‰ç¡®å®æœ‰ä¸€äº›å®è·µç»éªŒå¾—åˆ°äº†è¾ƒé«˜çš„è¯„ä»·ï¼Œæˆ‘ä»¬è¿™é‡Œå°±æ¥ä»‹ç»ä¸€ä¸‹ã€‚</p><p>å‰é¢è®²è¿‡ï¼Œä¸€ä¸ªå®Œæ•´çš„é”™è¯¯ç³»ç»ŸåŒ…æ‹¬ï¼šé”™è¯¯çš„æ„é€ å’Œè¡¨ç¤ºã€é”™è¯¯çš„ä¼ é€’ã€é”™è¯¯çš„å¤„ç†ã€‚é¦–å…ˆå°±æ˜¯åœ¨é”™è¯¯çš„æ„é€ å’Œè¡¨ç¤ºä¸Šï¼Œç›®å‰Rustç”Ÿæ€ä¸­æœ‰ä¸€ä¸ªå¾ˆæ£’çš„åº“ï¼š<a href=\"https://docs.rs/thiserror/\">thiserror</a>ã€‚</p><h3>é”™è¯¯çš„è¡¨ç¤ºæœ€ä½³å®è·µ</h3><p>å‰é¢æˆ‘ä»¬è®²è¿‡ï¼Œæˆ‘ä»¬å®šä¹‰çš„é”™è¯¯ç±»å‹å¾—å®ç°std::error::Error è¿™ä¸ªtraitï¼Œæ‰æ˜¯ä¸€ä¸ªåœ¨ç”Ÿæ€æ„ä¹‰ä¸Šæ¥è®²åˆæ ¼çš„é”™è¯¯ç±»å‹ã€‚ä½†æ˜¯è¦é è‡ªå·±å®Œæ•´åœ°æ‰‹åŠ¨å»å®ç°è¿™ä¸ªErrorï¼Œéœ€è¦å†™ä¸å°‘é‡å¤çš„å†—ä½™ä»£ç ã€‚å› ä¸ºå¯¹äºä¸€ä¸ªå¯é çš„åº”ç”¨æ¥è¯´ï¼Œæ¯ä¸€ä¸ªæ¨¡å—éƒ½å¯èƒ½ä¼šæœ‰å…¶é”™è¯¯ç±»å‹ã€‚</p><p>æ‰€ä»¥ä¸€ä¸ªå®Œæ•´çš„è½¯ä»¶ï¼Œå°±ä¼šæœ‰éå¸¸å¤šçš„é”™è¯¯ç±»å‹ï¼Œæ¯æ¬¡éƒ½å†™åŒæ ·çš„æ ·æ¿ä»£ç ï¼Œå¤§å®¶éƒ½ä¸ä¼šå–œæ¬¢ã€‚äºæ˜¯å°±å‡ºç°äº†è¿™æ ·ä¸€ä¸ªåº“ thiserrorï¼Œå®ƒèƒ½ä¸ºæˆ‘ä»¬ä¸€ä½“åŒ–æ ‡æ³¨å¼åœ°ç”Ÿæˆé‚£äº›æ ·æ¿ä»£ç ã€‚</p><p>ä½¿ç”¨ thiserror çš„æ–¹å¼å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">use thiserror::Error;    // å¼•å…¥å®\n\n#[derive(Error, Debug)]  // è¿™é‡Œderive Errorå®\npub enum DataStoreError {\n    #[error(\"data store disconnected\")]  // å±æ€§æ ‡æ³¨\n    Disconnect(#[from] io::Error),       // å±æ€§æ ‡æ³¨\n    #[error(\"the data for key `{0}` is not available\")]\n    Redaction(String),\n    #[error(\"invalid header (expected {expected:?}, found {found:?})\")]\n    InvalidHeader {\n        expected: String,\n        found: String,\n    },\n    #[error(\"unknown data store error\")]\n    Unknown,\n}\n</code></pre><p>åˆ©ç”¨thiserrorï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨æšä¸¾ä¸Šdrive Errorå®ã€‚è¿™å°±æ–¹ä¾¿å¾—å¤šäº†ã€‚åœ¨è¿™ä¸€ä¸ªå¤§å®çš„ä¸‹é¢ï¼Œè¿˜å¯ä»¥åˆ©ç”¨ <code>#[error(\"\")]</code>ã€<code>#[from]</code> ç­‰å±æ€§å®å¯¹æšä¸¾çš„å˜ä½“åšæ›´å¤šçš„é…ç½®ã€‚</p><p>é€šè¿‡è¿™æ ·çš„æ ‡æ³¨ï¼Œæˆ‘ä»¬æŠŠç›®æ ‡ç±»å‹è½¬æ¢æˆäº†ä¸€ä¸ªåˆæ ¼çš„è¢«Rustç”Ÿæ€è®¤è¯†çš„é”™è¯¯ç±»å‹ã€‚</p><h3>é”™è¯¯çš„ä¼ é€’æœ€ä½³å®è·µ</h3><p>å‰é¢æˆ‘ä»¬å·²ç»å¤šæ¬¡æåˆ°è¿‡ï¼Œåœ¨Rustä¸­ä½¿ç”¨ <code>ï¼Ÿ</code> æ“ä½œç¬¦å°±èƒ½æ–¹ä¾¿åœ°è¿›è¡Œé”™è¯¯çš„å†’æ³¡ä¼ é€’ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>ï¼Ÿ</code> è¿”å›çš„é”™è¯¯ç±»å‹å¯èƒ½ä¸å‡½æ•°è¿”å›å€¼å®šä¹‰çš„é”™è¯¯ç±»å‹ä¸ä¸€æ ·ï¼Œé‡åˆ°è¿™ç§æƒ…å†µï¼Œå°±è¦æ‰‹åŠ¨åš <code>map_err</code>ï¼Œæ‰‹åŠ¨å®ç° <code>From&lt;T&gt; trait</code>ï¼Œæˆ–è€…åˆ©ç”¨thiserror é‡Œæä¾›çš„ <code>#[from]</code> å±æ€§å®æ ‡æ³¨ã€‚</p><h3>é”™è¯¯å¤„ç†æœ€ä½³å®è·µ</h3><p>é”™è¯¯å¤„ç†æŒ‡çš„æ˜¯è¦å¯¹ä¼ è¿‡æ¥çš„é”™è¯¯è¿›è¡Œå¤„ç†ã€‚Rustç”Ÿæ€ä¸­æœ‰ä¸€ä¸ªanyhow crateï¼Œéå¸¸å¥½ç”¨ã€‚</p><p>anyhowè¿™ä¸ªcrateï¼Œæä¾›äº†ä¸€å¥—æ–¹ä¾¿çš„åŠŸèƒ½ï¼Œè®©æˆ‘ä»¬å¯ä»¥å¿«é€Ÿï¼ˆæ— è„‘ï¼‰åœ°æ¥æ”¶å’Œå¤„ç†é”™è¯¯ã€‚ä½ å¯ä»¥ç»Ÿä¸€ä½¿ç”¨ <code>Result&lt;T, anyhow::Error&gt;</code> æˆ–ç­‰ä»·çš„ <code>anyhow::Result&lt;T&gt;</code> ä½œä¸ºä¸€ä¸ªå‡½æ•°çš„è¿”å›ç±»å‹ï¼Œæ‹…å½“é”™è¯¯çš„æ¥æ”¶è€…ã€‚</p><p>è¿™æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿä»¥å‰ä½ éœ€è¦è‡ªå·±å®šä¹‰ä¸€ä¸ªæ¨¡å—çº§çš„Resultï¼Œæ‰èƒ½ç®€å†™ std::result::Resultã€‚æ¨¡å—å±‚çº§å¤šäº†åï¼Œå…‰ç»´æŠ¤è¿™äº›Resultç±»å‹ï¼Œéƒ½æ˜¯ä¸€ä»¶å¤´ç—›çš„äº‹æƒ…ã€‚</p><pre><code class=\"language-plain\">struct MyError;\ntype Result&lt;String&gt; = std::result::Result&lt;String, MyError&gt;;\n</code></pre><p>ç°åœ¨ä½ ä¸éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ª Result typeäº†ã€‚ç›´æ¥ä½¿ç”¨ <code>anyhow::Result&lt;T&gt;</code> å°±å¯ä»¥ã€‚</p><pre><code class=\"language-plain\">fn foo() -&gt; anyhow::Result&lt;String&gt; {}\n</code></pre><p>è¿™æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿå®é™…æ˜¯åˆåœ¨ä¸€ä¸ªæ›´é«˜çš„å±‚æ¬¡ä¸Šå®šä¹‰äº†ä¸€ç§é”™è¯¯æ¥æ”¶åè®®â€”â€”ä½ å†™çš„ä»»ä½•æ¨¡å—ï¼Œéƒ½å¯ä»¥ç”¨è¿™åŒä¸€ç§å®šä¹‰ï¼Œè€Œä¸éœ€è¦åœ¨ä¸åŒçš„æ¨¡å—ä¸­å®šä¹‰ä¸åŒçš„Resultç±»å‹ã€‚ä¸åŒçš„äººä¹Ÿä¸éœ€è¦å®šä¹‰å„è‡ªçš„Resultç±»å‹ï¼Œå¤§å®¶éƒ½ä¸€æ ·çš„ï¼Œä½¿ç”¨anyhow::Resultå°±è¡Œäº†ï¼Œè¿™æ ·äº¤æµèµ·æ¥å°±æ›´æ–¹ä¾¿ã€‚</p><p>ä½¿ç”¨ <code>anyhow::Result&lt;T&gt;</code> ä½œå‡½æ•°è¿”å›å€¼ï¼Œä½ åœ¨å‡½æ•°ä¸­å¯ä»¥ä½¿ç”¨ ï¼Ÿæ“ä½œç¬¦æ¥æŠŠé”™è¯¯å‘ä¸Šä¼ é€’ï¼Œåªè¦è¿™ä¸ªé”™è¯¯ç±»å‹å®ç°äº†std::error::Error è¿™ä¸ª trait å°±è¡Œäº†ã€‚è€Œæˆ‘ä»¬å‰é¢è®²è¿‡ï¼Œè¿™ä¸ªtraitæ˜¯stdæ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªæ ‡å‡†ç±»å‹ï¼Œå¦‚æœä½ æƒ³è®©è‡ªå·±çš„é”™è¯¯ç±»å‹èå…¥ç¤¾åŒºï¼Œéƒ½åº”è¯¥å®ç°è¿™ä¸ªtraitã€‚è€Œå‰é¢çš„thiserrorä¹Ÿæ˜¯æ–¹ä¾¿å®ç°è¿™ä¸ªtraitçš„ä¸€ä¸ªå·¥å…·åº“ã€‚è¿™æ ·æ˜¯ä¸æ˜¯ä¸€ä¸‹å­å°±ä¸²èµ·æ¥äº†ã€‚stdã€anyhow å’Œ thiseror å¯ä»¥æ— ç¼é…åˆèµ·æ¥ä½¿ç”¨ã€‚</p><p>è¿™æ ·å°±äº§ç”Ÿäº†ä¸€ä¸ªä»€ä¹ˆæ ·çš„æ•ˆæœå‘¢ï¼Ÿä½ ä¸ç”¨å†ä¸ºé”™è¯¯ç±»å‹çš„ä¸ä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯å‘ä¸Šä¼ é€’çš„é”™è¯¯ç±»å‹ä¸å‡½æ•°è¿”å›å€¼çš„é”™è¯¯ç±»å‹ä¸ä¸€è‡´ï¼Œè€Œå¤´ç—›äº†ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ— è„‘å†™å‡ºä¸‹é¢çš„ä»£ç ï¼š</p><pre><code class=\"language-plain\">use anyhow::Result;\n\nfn get_cluster_info() -&gt; Result&lt;ClusterMap&gt; {\n    let config = std::fs::read_to_string(\"cluster.json\")?;\n    let map: ClusterMap = serde_json::from_str(&amp;config)?;\n    Ok(map)\n}\n</code></pre><p>æ³¨æ„ï¼Œä¸Šé¢ç¬¬4è¡Œè¿”å›çš„é”™è¯¯ç±»å‹å’Œç¬¬5è¡Œè¿”å›çš„é”™è¯¯ç±»å‹æ˜¯ä¸åŒçš„ï¼Œä½†æ˜¯éƒ½èƒ½æ— è„‘åœ°æ‰”ç»™anyhow::Resultï¼Œå› ä¸ºå®ƒä»¬éƒ½å®ç°äº† std::error::Error traitã€‚</p><p>å½“ä½ ä½¿ç”¨ <code>anyhow::Result&lt;T&gt;</code> æ¥æ”¶åˆ°é”™è¯¯å®ä¾‹ä¹‹åï¼Œä¸‹ä¸€æ­¥å°±æ˜¯å¤„ç†é”™è¯¯ã€‚å¯ä»¥ä½¿ç”¨ match ç»“åˆdowncast ç³»åˆ—å‡½æ•°è¿›è¡Œå¤„ç†ã€‚</p><pre><code class=\"language-plain\">match root_cause.downcast_ref::&lt;DataStoreError&gt;() {\n    Some(DataStoreError::Censored(_)) =&gt; Ok(..),\n    None =&gt; Err(error),\n}\n</code></pre><p>å› ä¸º <code>anyhow::Result&lt;T&gt;</code> å®šä¹‰çš„æ˜¯ç»Ÿä¸€çš„é”™è¯¯ç±»å‹æ¥æ”¶è½½ä½“ï¼Œæ‰€ä»¥åœ¨å®é™…å¤„ç†çš„æ—¶å€™ï¼Œéœ€è¦æŠŠé”™è¯¯è¿˜åŸæˆåŸæ¥çš„ç±»å‹ï¼Œåˆ†åˆ«è¿›è¡Œå¤„ç†ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆéœ€è¦ downcast çš„åŸå› ï¼Œè¯­æ³•å°±å’Œä¸Šé¢çš„ç¤ºä¾‹å·®ä¸å¤šã€‚è¿™é‡Œä¹Ÿéšå«äº†ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œå°±æ˜¯anyhow::Errorå…¶å®ä¿ç•™äº†é”™è¯¯å®ä¾‹çš„åŸå§‹ç±»å‹ä¿¡æ¯ï¼Œæœ‰äº†è¿™äº›ä¿¡æ¯åé¢æˆ‘ä»¬æ‰èƒ½åšæ­£ç¡®çš„é”™è¯¯å¤„ç†åˆ†æ´¾ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œanyhowè¿˜æä¾›äº†å‡ ä¸ªè¾…åŠ©å®ï¼Œç”¨äºç®€åŒ–é”™è¯¯å®ä¾‹çš„ç”Ÿæˆã€‚å…¶ä¸­ä¸€ä¸ªæ˜¯anyhow! å®ï¼Œå®ƒå¯ä»¥å¿«é€Ÿåœ°æ„é€ å‡ºä¸€æ¬¡æ€§çš„èƒ½è¢« <code>anyhow::Result&lt;T&gt;</code> æ¥æ”¶çš„é”™è¯¯ã€‚</p><pre><code class=\"language-plain\">return Err(anyhow!(\"Missing attribute: {}\", missing));\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œanyhowè¿™ä¸ªcrateç›´æ¥æŠŠRustçš„é”™è¯¯å¤„ç†çš„ä½“éªŒæå‡äº†ä¸€ä¸ªæ¡£æ¬¡ï¼Œè®©æˆ‘ä»¬å¯ä»¥ä»¥ä¸€ç§ç»Ÿä¸€çš„å½¢å¼è®¾è®¡é¡¹ç›®çš„é”™è¯¯å¤„ç†ç³»ç»Ÿã€‚stdã€anyhowå’Œthiserror å®ƒä»¬ä¸€èµ·æ„æˆäº†Rustè¯­è¨€é”™è¯¯å¤„ç†çš„æœ€ä½³å®è·µã€‚</p><blockquote>\n<p><span class=\"reference\">æ³¨ï¼šæ›´å¤šanyhowçš„èµ„æ–™ï¼Œè¯·æŸ¥é˜…<a href=\"https://docs.rs/anyhow/\">é“¾æ¥</a>ã€‚</span></p>\n</blockquote><h2>å°ç»“</h2><p>è¿™èŠ‚è¯¾æˆ‘ä»¬ç³»ç»Ÿæ€§åœ°ä»‹ç»äº†Rustè¯­è¨€çš„é”™è¯¯å¤„ç†ç›¸å…³çš„çŸ¥è¯†ï¼ŒåŒæ—¶ä¹Ÿä»‹ç»äº†ç›®å‰Rustç”Ÿæ€ä¸­å·²ç»æ¢ç´¢å‡ºæ¥çš„é”™è¯¯å¤„ç†çš„æœ€ä½³å®è·µã€‚</p><p>Rustæœ¬èº«åªæä¾›äº†ä¸€äº›åŸºç¡€è®¾æ–½ï¼Œ<code>Result&lt;T, E&gt;</code>ã€<code>std::error::Error trait</code>ã€<code>map_err</code>ã€<code>ï¼Ÿ</code> è¡¨è¾¾å¼ã€<code>From&lt;T&gt; trait</code>ã€<code>panic!</code> ç³»åˆ—å®ç­‰ç­‰ã€‚è¿™äº›è®¾æ–½å·²ç»éå¸¸å¥½äº†ï¼Œä½†æ˜¯åœ¨æ„å»ºä¸­å¤§å‹å·¥ç¨‹çš„é”™è¯¯ç³»ç»Ÿçš„æ—¶å€™ï¼Œä¼šæ¯”è¾ƒç¹çï¼Œæ ‡å‡†ä¹Ÿæ²¡åŠæ³•ç»Ÿä¸€ã€‚</p><p>å› æ­¤åœ¨è¿™äº›åŸºç¡€è®¾æ–½ä¹‹ä¸Šï¼Œç¤¾åŒºé€šè¿‡å®è·µæ‘¸ç´¢å‡ºäº† thiserrorã€anyhow ç­‰ä¼˜ç§€çš„crateï¼Œä½¿Rustè¯­è¨€é”™è¯¯å¤„ç†çš„å·¥ç¨‹ä½“éªŒæå‡äº†ä¸€ä¸ªå±‚æ¬¡ï¼Œè¾¾åˆ°äº†æ—¢å¥½ç”¨åˆä¼˜ç¾çš„çŠ¶æ€ã€‚è¿™ä¸¤ä¸ªåº“å……åˆ†å±•ç°äº†Rustè¯­è¨€å¼ºå¤§çš„è¡¨è¾¾èƒ½åŠ›ï¼Œanyhow ä¸»è¦é€šè¿‡Rustå¼ºå¤§çš„ç±»å‹ç³»ç»Ÿå®ç°ï¼Œthiserrorä¸»è¦é€šè¿‡Rustå¼ºå¤§çš„å®èƒ½åŠ›å®ç°ï¼Œè€Œå®æ­£æ˜¯æˆ‘ä»¬ä¸‹èŠ‚è¯¾è¦è®²åˆ°çš„å†…å®¹ã€‚</p><p>é”™è¯¯å¤„ç†æ˜¯è½¯ä»¶ä¸­éå¸¸é‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œæ˜¯è½¯ä»¶ç¨³å®šæ€§å’Œå®‰å…¨æ€§çš„æ ¹æºæ‰€åœ¨ã€‚Rustè¯­è¨€å¼ºè¿«æˆ‘ä»¬å¿…é¡»åšå®Œå–„çš„é”™è¯¯å¤„ç†ï¼Œè¿™ä¹Ÿæ˜¯Rustè¯­è¨€ä¸ä¼—ä¸åŒçš„åœ°æ–¹ã€‚å¸Œæœ›ä½ è¶³å¤Ÿé‡è§†ï¼Œå¤šå®è·µï¼Œæ€»ç»“å‡ºè‡ªå·±çš„å¿ƒå¾—ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/40/ac/4096cd69a1d25d1a4bbceac9827f9bac.jpg?wh=1989x1764\" alt=\"\"></p><h2>æ€è€ƒé¢˜</h2><ul>\n<li>è¯·ä½ æŸ¥é˜…Rust stdèµ„æ–™ï¼Œå¹¶è¯´è¯´å¯¹ std::error::Error çš„ç†è§£ã€‚</li>\n<li>è¯·è¯´æ˜anyhow::Errorä¸è‡ªå®šä¹‰æšä¸¾ç±»å‹ç”¨ä½œé”™è¯¯çš„æ¥æ”¶æ—¶çš„åŒºåˆ«ã€‚</li>\n</ul><p>æ¬¢è¿ä½ æŠŠä½ çš„æ€è€ƒå’Œç†è§£åˆ†äº«åˆ°è¯„è®ºåŒºï¼Œå’Œæˆ‘ä¸€èµ·è®¨è®ºï¼Œå¦‚æœä½ è§‰å¾—æœ‰æ”¶è·çš„è¯ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾çš„å†…å®¹åˆ†äº«ç»™å…¶ä»–æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","comments":[{"had_liked":false,"id":384616,"user_name":"ä¸‹é›¨å¤©","can_delete":false,"product_type":"c1","uid":1008315,"ip_address":"æ¹–åŒ—","ucode":"816B3792ECC50A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/62/bb/323a3133.jpg","comment_is_top":false,"comment_ctime":1701244020,"is_pvip":false,"replies":[{"id":140292,"content":"çœŸæ£’ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1701322481,"ip_address":"æ±Ÿè‹","comment_id":384616,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"è¯·è¯´æ˜ anyhow::Error ä¸è‡ªå®šä¹‰æšä¸¾ç±»å‹ç”¨ä½œé”™è¯¯çš„æ¥æ”¶æ—¶çš„åŒºåˆ«ã€‚\nä»¥æ— ç©·å¯¹æœ‰ç©·ã€‚\n1.anyhow::Errorå¯ä»¥æ”¶æ‹¢æ‰€æœ‰ä½ è€ƒè™‘åˆ°æˆ–è€…æ²¡è€ƒè™‘åˆ°çš„é”™è¯¯ã€‚\n2. è‡ªå®šä¹‰æšä¸¾åªèƒ½æ”¶æ‹¢ä½ æƒ³åˆ°æ»´å¯èƒ½å‡ºç°é”™è¯¯ï¼Œæ¯”å¦‚std::io::Error è‡ªå®šä¹‰æšä¸¾æ²¡æ³•ç›´æ¥æ”¶æ‹¢äº†ï¼Œè¦å¤„ç†å¾—å†è½¬æ¢ä¸€æ³¢ã€‚","like_count":4,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632769,"discussion_content":"çœŸæ£’ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1701322481,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ±Ÿè‹","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":386768,"user_name":"Geek_3b58b9","can_delete":false,"product_type":"c1","uid":3196265,"ip_address":"æ±Ÿè‹","ucode":"E9DE52FD0B5E29","user_header":"","comment_is_top":false,"comment_ctime":1705505558,"is_pvip":false,"replies":[{"id":141007,"content":"åŸºæœ¬å¯ä»¥äº’æ¢ï¼Œanyhowï¼šï¼šError æ˜¯ä¸€ä¸ªç»“æ„ä½“ç±»å‹çš„ï¼Œè¿™ç‚¹æ›´æ–¹ä¾¿ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1705546716,"ip_address":"é‡åº†","comment_id":386768,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"é‚£ç©¶ç«Ÿä»€ä¹ˆæ—¶å€™ä½¿ç”¨anyhow::Errror, ä»€ä¹ˆæ—¶å€™ä½¿ç”¨Box&lt;dyn Error&gt;å‘¢ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":636060,"discussion_content":"åŸºæœ¬å¯ä»¥äº’æ¢ï¼Œanyhowï¼šï¼šError æ˜¯ä¸€ä¸ªç»“æ„ä½“ç±»å‹çš„ï¼Œè¿™ç‚¹æ›´æ–¹ä¾¿ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1705546717,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":386465,"user_name":"A0.ä½•æ–‡ç¥¥","can_delete":false,"product_type":"c1","uid":1052569,"ip_address":"ä¸­å›½é¦™æ¸¯","ucode":"2549126DAEA15D","user_header":"https://static001.geekbang.org/account/avatar/00/10/0f/99/0d72321f.jpg","comment_is_top":false,"comment_ctime":1704871618,"is_pvip":false,"replies":[{"id":140867,"content":"cè¯­è¨€é‡Œé¢å°±æ˜¯è¿™æ ·çš„ï¼Œä½†æ˜¯è¢«æ€»ç»“ä¸‹æ¥å¹¶ä¸æ˜¯ä¸€å¥—å¥½çš„å®è·µ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1704888589,"ip_address":"é‡åº†","comment_id":386465,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"æ¯”å¦‚ä¸€ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªæœ‰ç¬¦å·æ•´æ•°ï¼Œå¯ä»¥ç”¨ 0 è¡¨ç¤ºæ­£å¸¸æƒ…å†µä¸‹çš„è¿”å›ï¼Œç”¨ -1 æˆ–å…¶ä»–è´Ÿæ•°å€¼è¡¨ç¤ºå¼‚æ­¥æƒ…å†µä¸‹çš„è¿”å›ã€‚\nå¼‚æ­¥ -&gt; å¼‚å¸¸","like_count":1,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635499,"discussion_content":"cè¯­è¨€é‡Œé¢å°±æ˜¯è¿™æ ·çš„ï¼Œä½†æ˜¯è¢«æ€»ç»“ä¸‹æ¥å¹¶ä¸æ˜¯ä¸€å¥—å¥½çš„å®è·µ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1704888589,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":384651,"user_name":"åˆ˜ä¸¹","can_delete":false,"product_type":"c1","uid":1081922,"ip_address":"å¹¿ä¸œ","ucode":"66594D1C957E15","user_header":"https://static001.geekbang.org/account/avatar/00/10/82/42/8b04d489.jpg","comment_is_top":false,"comment_ctime":1701304523,"is_pvip":false,"replies":[{"id":140311,"content":"åé¢å¯ä»¥å†™ä¸€ä¸ªä¾‹å­æ¥å±•ç¤ºã€‚å¯ä»¥å…ˆæ¥çœ‹å‡ ä¸ªå®é™…åœºæ™¯ä¸­çš„ä¾‹å­ï¼šhttps:&#47;&#47;github.com&#47;facebook&#47;sapling&#47;blob&#47;47c8f223f24ef5359cb9216051522e23fa70130a&#47;eden&#47;scm&#47;lib&#47;clidispatch&#47;src&#47;errors.rs#L12 \nhttps:&#47;&#47;github.com&#47;google&#47;tarpc&#47;blob&#47;3264979993fefcaf3b7483fabd546dc5d5f15aa0&#47;tarpc&#47;src&#47;client.rs#L623\nhttps:&#47;&#47;github.com&#47;neondatabase&#47;neon&#47;blob&#47;e43cde7aba2681d8d2e703fdfdb963caccf5acd0&#47;pageserver&#47;src&#47;tenant.rs#L337","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1701558112,"ip_address":"é‡åº†","comment_id":384651,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"èƒ½å¦ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œè¯´æ˜ä¸€ä¸‹æ€æ ·æŠŠanyhowä¸thiserrorç»“åˆèµ·æ¥ä½¿ç”¨ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632893,"discussion_content":"åé¢å¯ä»¥å†™ä¸€ä¸ªä¾‹å­æ¥å±•ç¤ºã€‚å¯ä»¥å…ˆæ¥çœ‹å‡ ä¸ªå®é™…åœºæ™¯ä¸­çš„ä¾‹å­ï¼šhttps://github.com/facebook/sapling/blob/47c8f223f24ef5359cb9216051522e23fa70130a/eden/scm/lib/clidispatch/src/errors.rs#L12 \nhttps://github.com/google/tarpc/blob/3264979993fefcaf3b7483fabd546dc5d5f15aa0/tarpc/src/client.rs#L623\nhttps://github.com/neondatabase/neon/blob/e43cde7aba2681d8d2e703fdfdb963caccf5acd0/pageserver/src/tenant.rs#L337","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1701558113,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1027167,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ac/5f/894761f8.jpg","nickname":"åå…«å“¥","note":"","ucode":"C0130252F97814","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632806,"discussion_content":"ä¸€å¼€å§‹å¾ˆéš¾ç†è§£è¿™æ ·å†™çš„æ–¹ä¾¿ï¼Œæœ€å¥½ä»åŸç”ŸResult Error è¿™äº›å†™ä¸€æ¬¡ï¼Œå°±çŸ¥é“æœ‰å¤šéº»çƒ¦äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1701357581,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¤©æ´¥","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1027167,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ac/5f/894761f8.jpg","nickname":"åå…«å“¥","note":"","ucode":"C0130252F97814","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632805,"discussion_content":"1ã€å®šä¹‰trait æ–¹æ³• è¿”å› Result&lt;ResponseFrame, Error&gt;;\n2ã€å®šä¹‰é”™è¯¯æšä¸¾pub enum ProtocoError { \n    #[error(&#34;csæ•°æ® `{0}` Error&#34;)]\n    InvalidCSData(String)}\n3ã€ä¸šåŠ¡ä»£ç ä¸­åœ¨é€‚åˆçš„ä½ç½®\n return Err(anyhow!(ProtocoError::InvalidCSData(XXX)))\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1701357440,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¤©æ´¥","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":384633,"user_name":"é¸ æ‘©æ™º","can_delete":false,"product_type":"c1","uid":1106201,"ip_address":"æ±Ÿè‹","ucode":"853E584FC4CD64","user_header":"https://static001.geekbang.org/account/avatar/00/10/e1/19/c756aaed.jpg","comment_is_top":false,"comment_ctime":1701259730,"is_pvip":true,"replies":[{"id":140290,"content":"æ„Ÿè°¢è®¤åŒã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1701322448,"ip_address":"æ±Ÿè‹","comment_id":384633,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"ç¬¬ä¸€æ¬¡çœ‹åˆ°å°†thiserrorã€anyhowè¿™äº›é”™è¯¯å¤„ç†crateè®²å¾—è¿™ä¹ˆè¯¦ç»†çš„æ–‡ç« ï¼Œå¹²è´§æ»¡æ»¡","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632767,"discussion_content":"æ„Ÿè°¢è®¤åŒã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1701322448,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ±Ÿè‹","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":384626,"user_name":"æ¨èµ›å†›","can_delete":false,"product_type":"c1","uid":1050917,"ip_address":"åŒ—äº¬","ucode":"12F314F9E6F158","user_header":"https://static001.geekbang.org/account/avatar/00/10/09/25/2db95c79.jpg","comment_is_top":false,"comment_ctime":1701250342,"is_pvip":false,"replies":[{"id":140291,"content":"å¯ä»¥å‘€ï¼Œä½ è¯´çš„å“ªä¸ªåœ°æ–¹ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1701322468,"ip_address":"æ±Ÿè‹","comment_id":384626,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"è€å¸ˆ ä¸ºä»€ä¹ˆä¸èƒ½æŠŠresulté”™è¯¯è¿”å›å€¼æ”¹ä¸º Box&lt;dyn Error&gt;å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632768,"discussion_content":"å¯ä»¥å‘€ï¼Œä½ è¯´çš„å“ªä¸ªåœ°æ–¹ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1701322468,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ±Ÿè‹","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1546505,"avatar":"https://static001.geekbang.org/account/avatar/00/17/99/09/29c46a7b.jpg","nickname":"-","note":"","ucode":"7B34258D346793","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":632782,"discussion_content":"é‚£è‡ªå®šä¹‰çš„Errorä¸æ˜¯è¿˜è¦å»å®ç°Displayä¹ˆï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1701337009,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":632768,"ip_address":"åŒ—äº¬","group_id":0},"score":632782,"extra":""}]},{"author":{"id":1979955,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/36/33/3411df0d.jpg","nickname":"seven9t","note":"","ucode":"B7CA7D62C56938","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635834,"discussion_content":"anyhowå’Œdyn Errorè¡¨è¾¾ä»»æ„é”™è¯¯çš„åŒºåˆ«ã€ä¼˜åŠ£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1705286610,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":384589,"user_name":"ä¼¯é˜³","can_delete":false,"product_type":"c1","uid":1596631,"ip_address":"åŒ—äº¬","ucode":"DBDC8735AA54AD","user_header":"https://static001.geekbang.org/account/avatar/00/18/5c/d7/3b92bb0d.jpg","comment_is_top":false,"comment_ctime":1701213275,"is_pvip":false,"replies":[{"id":140282,"content":"å¯ä»¥ç›´æ¥ç”¨ã€‚æ¯ä¸ªç³»ç»Ÿéƒ½ä¸ä¸€æ ·ï¼Œæœ‰è‡ªå·±çš„è®¾è®¡ï¼Œä½†æ˜¯anyhowå’Œthiserrorç°åœ¨ç”¨å¾—æœ€å¤š","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1701220068,"ip_address":"é‡åº†","comment_id":384589,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"è€å¸ˆæ–°æ‰‹ä¸Šæ¥ç›´æ¥ç”¨è¿™ä¸ªanyhowä¸thiserrorï¼Œä¸ç”¨åŸç”Ÿçš„å¯ä»¥ä¹ˆï¼Œæ˜¯å¤§å‹ç³»ç»Ÿéƒ½æ˜¯ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å¯¹å§","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632689,"discussion_content":"å¯ä»¥ç›´æ¥ç”¨ã€‚æ¯ä¸ªç³»ç»Ÿéƒ½ä¸ä¸€æ ·ï¼Œæœ‰è‡ªå·±çš„è®¾è®¡ï¼Œä½†æ˜¯anyhowå’Œthiserrorç°åœ¨ç”¨å¾—æœ€å¤š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1701220068,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385839,"user_name":"superggn","can_delete":false,"product_type":"c1","uid":3623568,"ip_address":"åŒ—äº¬","ucode":"831CCD98B393FE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/7Q403U68Oy4lXG5sFBPVKLrfwaRzBqpBZibpEBXcPf9UOO3qrnh7RELoByTLzBZLkN9Nukfsj7DibynbZjKAKgag/132","comment_is_top":false,"comment_ctime":1703490554,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"æ€è€ƒé¢˜ï¼š\n- è¯·ä½ æŸ¥é˜… Rust std èµ„æ–™ï¼Œå¹¶è¯´è¯´å¯¹ std::error::Error çš„ç†è§£\n - æœ‰ä¿© trait (Debug + Display), èƒ½æ‰“å°\n- è¯·è¯´æ˜ anyhow::Error ä¸è‡ªå®šä¹‰æšä¸¾ç±»å‹ç”¨ä½œé”™è¯¯çš„æ¥æ”¶æ—¶çš„åŒºåˆ«\n - anyhow::Error æ›´é€šç”¨\n\nè¿™èŠ‚è¯¾æ„Ÿè§‰å°±å½“æ‰‹å†Œçœ‹äº†ï¼Œ å›å¤´å†å¾€å›è¿”å›ï¼Œ ç°åœ¨çœ‹äº†è·‘äº†ä¹Ÿè®°ä¸ä½","like_count":0}]}