{"id":419200,"title":"04 | è¿›ç¨‹æ¨¡å‹ä¸åˆ†å¸ƒå¼éƒ¨ç½²ï¼šåˆ†å¸ƒå¼è®¡ç®—æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å´ç£Šã€‚</p><p>åœ¨<a href=\"https://time.geekbang.org/column/article/417164\">ç¬¬2è®²</a>çš„æœ€åï¼Œæˆ‘ä»¬ç•™äº†ä¸€é“æ€è€ƒé¢˜ã€‚Word Countçš„è®¡ç®—æµå›¾ä¸åœŸè±†å·¥åŠçš„æµæ°´çº¿å·¥è‰ºï¼ŒäºŒè€…ä¹‹é—´æœ‰å“ªäº›åŒºåˆ«å’Œè”ç³»ï¼Ÿå¦‚æœä½ æœ‰ç‚¹è®°ä¸æ¸…äº†ï¼Œå¯ä»¥çœ‹ä¸‹åé¢çš„å›¾å›å¿†ä¸€ä¸‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/af/6d/af93e6f10b85df80a7d56a6c1965a36d.jpg?wh=1920x512\" alt=\"å›¾ç‰‡\" title=\"Word Countè®¡ç®—æµå›¾\"></p><p><img src=\"https://static001.geekbang.org/resource/image/4f/da/4fc5769e03f68eae79ea92fbb4756bda.jpg?wh=1920x586\" alt=\"å›¾ç‰‡\" title=\"åœŸè±†å·¥åŠçš„æµæ°´çº¿å·¥è‰º\"></p><p>æˆ‘ä»¬å…ˆæ¥è¯´åŒºåˆ«ã€‚é¦–å…ˆï¼ŒWord Countè®¡ç®—æµå›¾æ˜¯ä¸€ç§æŠ½è±¡çš„æµç¨‹å›¾ï¼Œè€ŒåœŸè±†å·¥åŠçš„æµæ°´çº¿æ˜¯å¯æ“ä½œã€å¯è¿è¡Œè€Œåˆå…·ä½“çš„æ‰§è¡Œæ­¥éª¤ã€‚ç„¶åï¼Œè®¡ç®—æµå›¾ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚lineRDDã€wordRDDï¼Œéƒ½æ˜¯â€œè™šâ€çš„æ•°æ®é›†æŠ½è±¡ï¼Œè€Œæµæ°´çº¿ä¸Šå„ä¸ªç¯èŠ‚ä¸åŒå½¢æ€çš„é£Ÿæï¼Œæ¯”å¦‚ä¸€é¢—é¢—è„å…®å…®çš„åœŸè±†ï¼Œéƒ½æ˜¯â€œå®å®åœ¨åœ¨â€çš„å®ç‰©ã€‚</p><p>å˜æ¸…äº†äºŒè€…ä¹‹é—´çš„åŒºåˆ«ä¹‹åï¼Œå®ƒä»¬ä¹‹é—´çš„è”ç³»è‡ªç„¶ä¹Ÿå°±æ˜¾è€Œæ˜“è§äº†ã€‚å¦‚æœæŠŠè®¡ç®—æµå›¾çœ‹ä½œæ˜¯â€œè®¾è®¡å›¾çº¸â€ï¼Œé‚£ä¹ˆæµæ°´çº¿å·¥è‰ºå…¶å®å°±æ˜¯â€œæ–½å·¥è¿‡ç¨‹â€ã€‚å‰è€…æ˜¯è®¾è®¡å±‚é¢ã€é«˜å±‹å»ºç“´çš„æŒ‡å¯¼æ„è§ï¼Œè€Œåè€…æ˜¯æ‰§è¡Œå±‚é¢ã€æŒ‰éƒ¨å°±ç­çš„å®æ–½è¿‡ç¨‹ã€‚å‰è€…æ˜¯åè€…çš„åŸºçŸ³ï¼Œè€Œåè€…æ˜¯å‰è€…çš„å…·åŒ–ã€‚</p><p>ä½ å¯èƒ½ä¼šå¥½å¥‡ï¼šâ€œæˆ‘ä»¬ä¸ºä»€ä¹ˆéè¦å¼„æ¸…è¿™äºŒè€…ä¹‹é—´çš„åŒºåˆ«å’Œè”ç³»å‘¢ï¼Ÿâ€åŸå› å…¶å®å¾ˆç®€å•ï¼Œ<strong>åˆ†å¸ƒå¼è®¡ç®—çš„ç²¾é«“ï¼Œåœ¨äºå¦‚ä½•æŠŠæŠ½è±¡çš„è®¡ç®—æµå›¾ï¼Œè½¬åŒ–ä¸ºå®å®åœ¨åœ¨çš„åˆ†å¸ƒå¼è®¡ç®—ä»»åŠ¡ï¼Œç„¶åä»¥å¹¶è¡Œè®¡ç®—çš„æ–¹å¼äº¤ä»˜æ‰§è¡Œã€‚</strong></p><p>ä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å°±æ¥èŠä¸€èŠï¼ŒSparkæ˜¯å¦‚ä½•å®ç°åˆ†å¸ƒå¼è®¡ç®—çš„ã€‚åˆ†å¸ƒå¼è®¡ç®—çš„å®ç°ï¼Œç¦»ä¸å¼€ä¸¤ä¸ªå…³é”®è¦ç´ ï¼Œä¸€ä¸ªæ˜¯è¿›ç¨‹æ¨¡å‹ï¼Œå¦ä¸€ä¸ªæ˜¯åˆ†å¸ƒå¼çš„ç¯å¢ƒéƒ¨ç½²ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆå»æ¢è®¨Sparkçš„è¿›ç¨‹æ¨¡å‹ï¼Œç„¶åå†æ¥ä»‹ç»Sparkéƒ½æœ‰å“ªäº›åˆ†å¸ƒå¼éƒ¨ç½²æ–¹å¼ã€‚</p><!-- [[[read_end]]] --><h2>è¿›ç¨‹æ¨¡å‹</h2><p>åœ¨Sparkçš„åº”ç”¨å¼€å‘ä¸­ï¼Œä»»ä½•ä¸€ä¸ªåº”ç”¨ç¨‹åºçš„å…¥å£ï¼Œéƒ½æ˜¯å¸¦æœ‰SparkSessionçš„mainå‡½æ•°ã€‚SparkSessionåŒ…ç½—ä¸‡è±¡ï¼Œå®ƒåœ¨æä¾›Sparkè¿è¡Œæ—¶ä¸Šä¸‹æ–‡çš„åŒæ—¶ï¼ˆå¦‚è°ƒåº¦ç³»ç»Ÿã€å­˜å‚¨ç³»ç»Ÿã€å†…å­˜ç®¡ç†ã€RPCé€šä¿¡ï¼‰ï¼Œä¹Ÿå¯ä»¥ä¸ºå¼€å‘è€…æä¾›åˆ›å»ºã€è½¬æ¢ã€è®¡ç®—åˆ†å¸ƒå¼æ•°æ®é›†ï¼ˆå¦‚RDDï¼‰çš„å¼€å‘APIã€‚</p><p>ä¸è¿‡ï¼Œåœ¨Sparkåˆ†å¸ƒå¼è®¡ç®—ç¯å¢ƒä¸­ï¼Œæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªJVMè¿›ç¨‹è¿è¡Œè¿™æ ·çš„mainå‡½æ•°ï¼Œè¿™ä¸ªç‰¹æ®Šçš„JVMè¿›ç¨‹ï¼Œåœ¨Sparkä¸­æœ‰ä¸ªä¸“é—¨çš„æœ¯è¯­ï¼Œå«ä½œâ€œ<strong>Driver</strong>â€ã€‚</p><p>Driveræœ€æ ¸å¿ƒçš„ä½œç”¨åœ¨äºï¼Œè§£æç”¨æˆ·ä»£ç ã€æ„å»ºè®¡ç®—æµå›¾ï¼Œç„¶åå°†è®¡ç®—æµå›¾è½¬åŒ–ä¸ºåˆ†å¸ƒå¼ä»»åŠ¡ï¼Œå¹¶æŠŠä»»åŠ¡åˆ†å‘ç»™é›†ç¾¤ä¸­çš„æ‰§è¡Œè¿›ç¨‹äº¤ä»˜è¿è¡Œã€‚æ¢å¥è¯è¯´ï¼ŒDriverçš„è§’è‰²æ˜¯æ‹†è§£ä»»åŠ¡ã€æ´¾æ´»å„¿ï¼Œè€ŒçœŸæ­£å¹²æ´»å„¿çš„â€œè‹¦åŠ›â€ï¼Œæ˜¯æ‰§è¡Œè¿›ç¨‹ã€‚åœ¨Sparkçš„åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œè¿™æ ·çš„æ‰§è¡Œè¿›ç¨‹å¯ä»¥æœ‰ä¸€ä¸ªæˆ–æ˜¯å¤šä¸ªï¼Œå®ƒä»¬ä¹Ÿæœ‰ä¸“é—¨çš„æœ¯è¯­ï¼Œå«ä½œâ€œ<strong>Executor</strong>â€ã€‚</p><p>æˆ‘æŠŠ<strong>Driver</strong>å’Œ<strong>Executor</strong>çš„å…³ç³»ç”»æˆäº†ä¸€å¼ å›¾ï¼Œä½ å¯ä»¥çœ‹çœ‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/de/36/de80376be9c39600ab7c4cc109c8f336.jpg?wh=1920x1503\" alt=\"å›¾ç‰‡\" title=\"Driverä¸Executorsï¼šSparkè¿›ç¨‹æ¨¡å‹\"></p><p>åˆ†å¸ƒå¼è®¡ç®—çš„æ ¸å¿ƒæ˜¯ä»»åŠ¡è°ƒåº¦ï¼Œè€Œåˆ†å¸ƒå¼ä»»åŠ¡çš„è°ƒåº¦ä¸æ‰§è¡Œï¼Œä»°ä»—çš„æ˜¯Driverä¸Executorsä¹‹é—´çš„é€šåŠ›åˆä½œã€‚åœ¨åç»­çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šæ·±å…¥è®²è§£Driverå¦‚ä½•ä¸ä¼—å¤šExecutorsåä½œå®Œæˆä»»åŠ¡è°ƒåº¦ï¼Œä¸è¿‡åœ¨æ­¤ä¹‹å‰ï¼Œå’±ä»¬å…ˆè¦å˜æ¸…Driverä¸Executorsçš„å…³ç³»ï¼Œä»è€Œä¸ºåç»­çš„è¯¾ç¨‹æ‰“ä¸‹åšå®çš„åŸºç¡€ã€‚</p><h3>Driverä¸Executorsï¼šåŒ…å·¥å¤´ä¸æ–½å·¥å·¥äºº</h3><p>ç®€å•æ¥çœ‹ï¼ŒDriverä¸Executorsçš„å…³ç³»ï¼Œå°±åƒæ˜¯å·¥åœ°ä¸ŠåŒ…å·¥å¤´ä¸æ–½å·¥å·¥äººä»¬ä¹‹é—´çš„å…³ç³»ã€‚åŒ…å·¥å¤´è´Ÿè´£â€œæ½æ´»å„¿â€ï¼Œæ‹¿åˆ°è®¾è®¡å›¾çº¸ä¹‹åè´Ÿè´£æ‹†è§£ä»»åŠ¡ï¼ŒæŠŠäºŒç»´å¹³é¢å›¾ï¼Œç»†åŒ–æˆå¤¯åœŸã€æ‰“åœ°åŸºã€ç Œå¢™ã€æµ‡ç­‘é’¢ç­‹æ··å‡åœŸç­‰ä»»åŠ¡ï¼Œç„¶åå†æŠŠä»»åŠ¡æ´¾å‘ç»™æ‰‹ä¸‹çš„å·¥äººã€‚å·¥äººä»¬è®¤é¢†åˆ°ä»»åŠ¡ä¹‹åï¼Œç›¸å¯¹ç‹¬ç«‹åœ°å»å®Œæˆå„è‡ªçš„ä»»åŠ¡ï¼Œä»…åœ¨å¿…è¦çš„æ—¶å€™è¿›è¡Œæ²Ÿé€šä¸åè°ƒã€‚</p><p>å…¶å®ä¸åŒçš„å»ºç­‘ä»»åŠ¡ä¹‹é—´ï¼Œå¾€å¾€æ˜¯å­˜åœ¨ä¾èµ–å…³ç³»çš„ï¼Œæ¯”å¦‚ï¼Œç Œå¢™ä¸€å®šæ˜¯åœ¨åœ°åŸºæ‰“æˆä¹‹åæ‰èƒ½æ–½å·¥ï¼ŒåŒç†ï¼Œæµ‡ç­‘é’¢ç­‹æ··å‡åœŸä¹Ÿä¸€å®šè¦ç­‰åˆ°ç –å¢™ç Œæˆä¹‹åæ‰èƒ½è¿›è¡Œã€‚å› æ­¤ï¼ŒDriverè¿™ä¸ªâ€œåŒ…å·¥å¤´â€çš„é‡è¦èŒè´£ä¹‹ä¸€ï¼Œå°±æ˜¯åˆç†æœ‰åºåœ°æ‹†è§£å¹¶å®‰æ’å»ºç­‘ä»»åŠ¡ã€‚</p><p>å†è€…ï¼Œä¸ºäº†ä¿è¯æ–½å·¥è¿›åº¦ï¼ŒDriveré™¤äº†åˆ†å‘ä»»åŠ¡ä¹‹å¤–ï¼Œè¿˜éœ€è¦å®šæœŸä¸æ¯ä¸ªExecutorè¿›è¡Œæ²Ÿé€šï¼ŒåŠæ—¶è·å–ä»–ä»¬çš„å·¥ä½œè¿›å±•ï¼Œä»è€Œåè°ƒæ•´ä½“çš„æ‰§è¡Œè¿›åº¦ã€‚</p><p>ä¸€ä¸ªç¯±ç¬†ä¸‰ä¸ªæ¡©ï¼Œä¸€ä¸ªå¥½æ±‰ä¸‰ä¸ªå¸®ã€‚è¦å±¥è¡Œä¸Šè¿°ä¸€ç³»åˆ—çš„èŒè´£ï¼ŒDriverè‡ªç„¶éœ€è¦ä¸€äº›ç»™åŠ›çš„å¸®æ‰‹æ‰è¡Œã€‚åœ¨Sparkçš„Driverè¿›ç¨‹ä¸­ï¼ŒDAGSchedulerã€TaskSchedulerå’ŒSchedulerBackendè¿™ä¸‰ä¸ªå¯¹è±¡é€šåŠ›åˆä½œï¼Œä¾æ¬¡å®Œæˆåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦çš„3ä¸ªæ ¸å¿ƒæ­¥éª¤ï¼Œä¹Ÿå°±æ˜¯ï¼š</p><p>1.æ ¹æ®ç”¨æˆ·ä»£ç æ„å»ºè®¡ç®—æµå›¾ï¼›<br>\n2.æ ¹æ®è®¡ç®—æµå›¾æ‹†è§£å‡ºåˆ†å¸ƒå¼ä»»åŠ¡ï¼›<br>\n3.å°†åˆ†å¸ƒå¼ä»»åŠ¡åˆ†å‘åˆ°Executorsä¸­å»ã€‚</p><p>æ¥æ”¶åˆ°ä»»åŠ¡ä¹‹åï¼ŒExecutorsè°ƒç”¨å†…éƒ¨çº¿ç¨‹æ± ï¼Œç»“åˆäº‹å…ˆåˆ†é…å¥½çš„æ•°æ®åˆ†ç‰‡ï¼Œå¹¶å‘åœ°æ‰§è¡Œä»»åŠ¡ä»£ç ã€‚å¯¹äºä¸€ä¸ªå®Œæ•´çš„RDDï¼Œæ¯ä¸ªExecutorsè´Ÿè´£å¤„ç†è¿™ä¸ªRDDçš„ä¸€ä¸ªæ•°æ®åˆ†ç‰‡å­é›†ã€‚è¿™å°±å¥½æ¯”æ˜¯ï¼Œå¯¹äºå·¥åœ°ä¸Šæ‰€æœ‰çš„ç –å¤´ï¼Œç”²ã€ä¹™ã€ä¸™ä¸‰ä¸ªå·¥äººåˆ†åˆ«è®¤é¢†å…¶ä¸­çš„ä¸‰åˆ†ä¹‹ä¸€ï¼Œç„¶åæ‹¿æ¥åˆ†åˆ«æ„ç­‘ä¸œã€è¥¿ã€åŒ—ä¸‰é¢é«˜å¢™ã€‚</p><p>å¥½å•¦ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œå…³äºDriverå’ŒExecutorsçš„æ¦‚å¿µï¼Œä»–ä»¬å„è‡ªçš„èŒè´£ä»¥åŠç›¸äº’ä¹‹é—´çš„å…³ç³»ï¼Œæˆ‘ä»¬æœ‰äº†æœ€åŸºæœ¬çš„äº†è§£ã€‚å°½ç®¡å¯¹äºä¸€äº›å…³é”®å¯¹è±¡ï¼Œå¦‚ä¸Šè¿°DAGSchedulerã€TaskSchedulerï¼Œæˆ‘ä»¬è¿˜æœ‰å¾…æ·±å…¥ï¼Œä½†è¿™å¹¶ä¸å½±å“å’±ä»¬å±…é«˜ä¸´ä¸‹åœ°å»ç†è§£Sparkè¿›ç¨‹æ¨¡å‹ã€‚</p><p>ä¸è¿‡ï¼Œä½ å¯èƒ½ä¼šè¯´ï¼šâ€œä¸€è¯´åˆ°æ¨¡å‹å°±æ€»è§‰å¾—æŠ½è±¡ï¼Œèƒ½ä¸èƒ½ç»“åˆç¤ºä¾‹æ¥å…·ä½“è¯´æ˜å‘¢ï¼Ÿâ€æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ²¿ç”¨å‰ä¸¤è®²å±•ç¤ºçš„Word Countç¤ºä¾‹ï¼Œä¸€èµ·å»æ¢ç©¶spark-shellåœ¨å¹•åæ˜¯å¦‚ä½•è¿è¡Œçš„ã€‚</p><h3>spark-shellæ‰§è¡Œè¿‡ç¨‹è§£æ</h3><p>åœ¨ç¬¬1è®²ï¼Œæˆ‘ä»¬åœ¨æœ¬æœºæ­å»ºäº†Sparkæœ¬åœ°è¿è¡Œç¯å¢ƒï¼Œå¹¶é€šè¿‡åœ¨ç»ˆç«¯æ•²å…¥spark-shellè¿›å…¥äº¤äº’å¼REPLã€‚ä¸å¾ˆå¤šå…¶ä»–ç³»ç»Ÿå‘½ä»¤ä¸€æ ·ï¼Œspark-shellæœ‰å¾ˆå¤šå‘½ä»¤è¡Œå‚æ•°ï¼Œå…¶ä¸­æœ€ä¸ºé‡è¦çš„æœ‰ä¸¤ç±»ï¼šä¸€ç±»æ˜¯ç”¨äºæŒ‡å®šéƒ¨ç½²æ¨¡å¼çš„masterï¼Œå¦ä¸€ç±»åˆ™ç”¨äºæŒ‡å®šé›†ç¾¤çš„è®¡ç®—èµ„æºå®¹é‡ã€‚</p><p>ä¸å¸¦ä»»ä½•å‚æ•°çš„spark-shellå‘½ä»¤ï¼Œå®é™…ä¸Šç­‰åŒäºä¸‹æ–¹è¿™ä¸ªå‘½ä»¤ï¼š</p><pre><code class=\"language-plain\">spark-shell --master local[*]\n</code></pre><p>è¿™è¡Œä»£ç çš„å«ä¹‰æœ‰ä¸¤å±‚ã€‚ç¬¬ä¸€å±‚å«ä¹‰æ˜¯éƒ¨ç½²æ¨¡å¼ï¼Œå…¶ä¸­localå…³é”®å­—è¡¨ç¤ºéƒ¨ç½²æ¨¡å¼ä¸ºLocalï¼Œä¹Ÿå°±æ˜¯æœ¬åœ°éƒ¨ç½²ï¼›ç¬¬äºŒå±‚å«ä¹‰æ˜¯éƒ¨ç½²è§„æ¨¡ï¼Œä¹Ÿå°±æ˜¯æ–¹æ‹¬å·é‡Œé¢çš„æ•°å­—ï¼Œå®ƒè¡¨ç¤ºçš„æ˜¯åœ¨æœ¬åœ°éƒ¨ç½²ä¸­éœ€è¦å¯åŠ¨å¤šå°‘ä¸ªExecutorsï¼Œæ˜Ÿå·åˆ™æ„å‘³ç€è¿™ä¸ªæ•°é‡ä¸æœºå™¨ä¸­å¯ç”¨CPUçš„ä¸ªæ•°ç›¸ä¸€è‡´ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡è®¾ä½ çš„ç¬”è®°æœ¬ç”µè„‘æœ‰4ä¸ªCPUï¼Œé‚£ä¹ˆå½“ä½ åœ¨å‘½ä»¤è¡Œæ•²å…¥spark-shellçš„æ—¶å€™ï¼ŒSparkä¼šåœ¨åå°å¯åŠ¨1ä¸ªDriverè¿›ç¨‹å’Œ3ä¸ªExecutorsè¿›ç¨‹ã€‚</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå½“æˆ‘ä»¬æŠŠWord Countçš„ç¤ºä¾‹ä»£ç ä¾æ¬¡æ•²å…¥åˆ°spark-shellä¸­ï¼ŒDriverè¿›ç¨‹å’Œ3ä¸ªExecutorsè¿›ç¨‹ä¹‹é—´æ˜¯å¦‚ä½•é€šåŠ›åˆä½œæ¥æ‰§è¡Œåˆ†å¸ƒå¼ä»»åŠ¡çš„å‘¢ï¼Ÿ</p><p>ä¸ºäº†å¸®ä½ ç†è§£è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ç‰¹æ„ç”»äº†ä¸€å¼ å›¾ï¼Œä½ å¯ä»¥å…ˆçœ‹ä¸€ä¸‹æ•´ä½“çš„æ‰§è¡Œè¿‡ç¨‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/b0/22/b05139c82a7882a5b3b3074f3be50d22.jpg?wh=1920x952\" alt=\"å›¾ç‰‡\" title=\"Word Countåœ¨spark-shellä¸­çš„æ‰§è¡Œè¿‡ç¨‹\"></p><p>é¦–å…ˆï¼ŒDriveré€šè¿‡takeè¿™ä¸ªActionç®—å­ï¼Œæ¥è§¦å‘æ‰§è¡Œå…ˆå‰æ„å»ºå¥½çš„è®¡ç®—æµå›¾ã€‚æ²¿ç€è®¡ç®—æµå›¾çš„æ‰§è¡Œæ–¹å‘ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­ä»ä¸Šåˆ°ä¸‹çš„æ–¹å‘ï¼ŒDriverä»¥Shuffleä¸ºè¾¹ç•Œåˆ›å»ºã€åˆ†å‘åˆ†å¸ƒå¼ä»»åŠ¡ã€‚</p><p><strong>Shuffle</strong>çš„æœ¬æ„æ˜¯æ‰‘å…‹ç‰Œä¸­çš„â€œæ´—ç‰Œâ€ï¼Œåœ¨å¤§æ•°æ®é¢†åŸŸçš„å¼•ç”³ä¹‰ï¼Œè¡¨ç¤ºçš„æ˜¯é›†ç¾¤èŒƒå›´å†…è·¨è¿›ç¨‹ã€è·¨èŠ‚ç‚¹çš„æ•°æ®äº¤æ¢ã€‚æˆ‘ä»¬åœ¨ä¸“æ åç»­çš„å†…å®¹ä¸­ä¼šå¯¹Shuffleåšä¸“é—¨çš„è®²è§£ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸å¦¨å…ˆç”¨Word Countçš„ä¾‹å­ï¼Œæ¥ç®€å•åœ°å¯¹Shuffleè¿›è¡Œç†è§£ã€‚</p><p>åœ¨reduceByKeyç®—å­ä¹‹å‰ï¼ŒåŒä¸€ä¸ªå•è¯ï¼Œæ¯”å¦‚â€œsparkâ€ï¼Œå¯èƒ½æ•£è½åœ¨ä¸ç”¨çš„Executorsè¿›ç¨‹ï¼Œæ¯”å¦‚å›¾ä¸­çš„Executor-0ã€Executor-1å’ŒExecutor-2ã€‚æ¢å¥è¯è¯´ï¼Œè¿™äº›Executorså¤„ç†çš„æ•°æ®åˆ†ç‰‡ä¸­ï¼Œéƒ½åŒ…å«å•è¯â€œsparkâ€ã€‚</p><p>é‚£ä¹ˆï¼Œè¦å®Œæˆå¯¹â€œsparkâ€çš„è®¡æ•°ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ‰€æœ‰â€œsparkâ€åˆ†å‘åˆ°åŒä¸€ä¸ªExecutorè¿›ç¨‹ï¼Œæ‰èƒ½å®Œæˆè®¡ç®—ã€‚è€Œè¿™ä¸ªæŠŠåŸæœ¬æ•£è½åœ¨ä¸åŒExecutorsçš„å•è¯ï¼Œåˆ†å‘åˆ°åŒä¸€ä¸ªExecutorçš„è¿‡ç¨‹ï¼Œå°±æ˜¯Shuffleã€‚</p><p>å¤§æ¦‚ç†è§£äº†Shuffleåï¼Œæˆ‘ä»¬å›è¿‡å¤´æ¥ç€è¯´Driveræ˜¯æ€ä¹ˆåˆ›å»ºåˆ†å¸ƒå¼ä»»åŠ¡çš„ã€‚å¯¹äºreduceByKeyä¹‹å‰çš„æ‰€æœ‰æ“ä½œï¼Œä¹Ÿå°±æ˜¯textFileã€flatMapã€filterã€mapç­‰ï¼ŒDriverä¼šæŠŠå®ƒä»¬â€œæåˆâ€æˆä¸€ä»½ä»»åŠ¡ï¼Œç„¶åä¸€æ¬¡æ€§åœ°æŠŠè¿™ä»½ä»»åŠ¡æ‰“åŒ…ã€åˆ†å‘ç»™æ¯ä¸€ä¸ªExecutorsã€‚</p><p>ä¸‰ä¸ªExecutorsæ¥æ”¶åˆ°ä»»åŠ¡ä¹‹åï¼Œå…ˆæ˜¯å¯¹ä»»åŠ¡è¿›è¡Œè§£æï¼ŒæŠŠä»»åŠ¡æ‹†è§£æˆtextFileã€flatMapã€filterã€mapè¿™4ä¸ªæ­¥éª¤ï¼Œç„¶ååˆ†åˆ«å¯¹è‡ªå·±è´Ÿè´£çš„æ•°æ®åˆ†ç‰‡è¿›è¡Œå¤„ç†ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿è¯´æ˜ï¼Œæˆ‘ä»¬ä¸å¦¨å‡è®¾å¹¶è¡Œåº¦ä¸º3ï¼Œä¹Ÿå°±æ˜¯åŸå§‹æ•°æ®æ–‡ä»¶wikiOfSpark.txtè¢«åˆ‡å‰²æˆäº†3ä»½ï¼Œè¿™æ ·æ¯ä¸ªExecutorsåˆšå¥½å¤„ç†å…¶ä¸­çš„ä¸€ä»½ã€‚æ•°æ®å¤„ç†å®Œæ¯•ä¹‹åï¼Œåˆ†ç‰‡å†…å®¹å°±ä»åŸæ¥çš„RDD[String]è½¬æ¢æˆäº†åŒ…å«é”®å€¼å¯¹çš„RDD[(String, Int)]ï¼Œå…¶ä¸­æ¯ä¸ªå•è¯çš„è®¡æ•°éƒ½ç½®ä½1ã€‚æ­¤æ—¶Executorsä¼šåŠæ—¶åœ°å‘Driveræ±‡æŠ¥è‡ªå·±çš„å·¥ä½œè¿›å±•ï¼Œä»è€Œæ–¹ä¾¿Driveræ¥ç»Ÿä¸€åè°ƒå¤§å®¶ä¸‹ä¸€æ­¥çš„å·¥ä½œã€‚</p><p>è¿™ä¸ªæ—¶å€™ï¼Œè¦ç»§ç»­è¿›è¡Œåé¢çš„èšåˆè®¡ç®—ï¼Œä¹Ÿå°±æ˜¯è®¡æ•°æ“ä½œï¼Œå°±å¿…é¡»è¿›è¡Œåˆšåˆšè¯´çš„Shuffleæ“ä½œã€‚åœ¨ä¸åŒExecutorså®Œæˆå•è¯çš„æ•°æ®äº¤æ¢ä¹‹åï¼ŒDriverç»§ç»­åˆ›å»ºå¹¶åˆ†å‘ä¸‹ä¸€ä¸ªé˜¶æ®µçš„ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯æŒ‰ç…§å•è¯åšåˆ†ç»„è®¡æ•°ã€‚</p><p>æ•°æ®äº¤æ¢ä¹‹åï¼Œæ‰€æœ‰ç›¸åŒçš„å•è¯éƒ½åˆ†å‘åˆ°äº†ç›¸åŒçš„Executorsä¸Šå»ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå„ä¸ªExecutorsæ‹¿åˆ°reduceByKeyçš„ä»»åŠ¡ï¼Œåªéœ€è¦å„è‡ªç‹¬ç«‹åœ°å»å®Œæˆç»Ÿè®¡è®¡æ•°å³å¯ã€‚å®Œæˆè®¡æ•°ä¹‹åï¼ŒExecutorsä¼šæŠŠæœ€ç»ˆçš„è®¡ç®—ç»“æœç»Ÿä¸€è¿”å›ç»™Driverã€‚</p><p>è¿™æ ·ä¸€æ¥ï¼Œspark-shellä¾¿å®Œæˆäº†Word Countç”¨æˆ·ä»£ç çš„è®¡ç®—è¿‡ç¨‹ã€‚ç»è¿‡äº†åˆšæ‰çš„åˆ†æï¼Œå¯¹äºSparkè¿›ç¨‹æ¨¡å‹ã€Driverä¸Executorsä¹‹é—´çš„å…³è”ä¸è”ç³»ï¼Œæƒ³å¿…ä½ å°±æœ‰äº†æ›´æ¸…æ™°çš„ç†è§£å’ŒæŠŠæ¡ã€‚</p><p>ä¸è¿‡ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œå¯¹äºWord Countç¤ºä¾‹å’Œspark-shellçš„è®²è§£ï¼Œæˆ‘ä»¬ä¸€ç›´æ˜¯åœ¨æœ¬åœ°éƒ¨ç½²çš„ç¯å¢ƒä¸­åšå±•ç¤ºã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒSparkçœŸæ­£çš„å¨åŠ›ï¼Œå…¶å®åœ¨äºåˆ†å¸ƒå¼é›†ç¾¤ä¸­çš„å¹¶è¡Œè®¡ç®—ã€‚åªæœ‰å……åˆ†åˆ©ç”¨é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„è®¡ç®—èµ„æºï¼Œæ‰èƒ½å……åˆ†å‘æŒ¥å‡ºSparkçš„æ€§èƒ½ä¼˜åŠ¿ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¾ˆæœ‰å¿…è¦å»å­¦ä¹ å¹¶äº†è§£Sparkçš„åˆ†å¸ƒå¼éƒ¨ç½²ã€‚</p><h2>åˆ†å¸ƒå¼ç¯å¢ƒéƒ¨ç½²</h2><p>Sparkæ”¯æŒå¤šç§åˆ†å¸ƒå¼éƒ¨ç½²æ¨¡å¼ï¼Œå¦‚Standaloneã€YARNã€Mesosã€Kubernetesã€‚å…¶ä¸­Standaloneæ˜¯Sparkå†…ç½®çš„èµ„æºè°ƒåº¦å™¨ï¼Œè€ŒYARNã€Mesosã€Kubernetesæ˜¯ç‹¬ç«‹çš„ç¬¬ä¸‰æ–¹èµ„æºè°ƒåº¦ä¸æœåŠ¡ç¼–æ’æ¡†æ¶ã€‚</p><p>ç”±äºåä¸‰è€…æä¾›ç‹¬ç«‹è€Œåˆå®Œå¤‡çš„èµ„æºè°ƒåº¦èƒ½åŠ›ï¼Œå¯¹äºè¿™äº›æ¡†æ¶æ¥è¯´ï¼ŒSparkä»…ä»…æ˜¯å…¶æ”¯æŒçš„ä¼—å¤šè®¡ç®—å¼•æ“ä¸­çš„ä¸€ç§ã€‚Sparkåœ¨è¿™äº›ç‹¬ç«‹æ¡†æ¶ä¸Šçš„åˆ†å¸ƒå¼éƒ¨ç½²æ­¥éª¤è¾ƒå°‘ï¼Œæµç¨‹æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å¼€å‘è€…åªéœ€ä¸‹è½½å¹¶è§£å‹Sparkå®‰è£…åŒ…ï¼Œç„¶åé€‚å½“è°ƒæ•´Sparké…ç½®æ–‡ä»¶ã€ä»¥åŠä¿®æ”¹ç¯å¢ƒå˜é‡å°±è¡Œäº†ã€‚</p><p>å› æ­¤ï¼Œå¯¹äºYARNã€Mesosã€Kubernetesè¿™ä¸‰ç§éƒ¨ç½²æ¨¡å¼ï¼Œæˆ‘ä»¬ä¸åšè¯¦ç»†å±•å¼€ï¼Œæˆ‘æŠŠå®ƒç»™ä½ ç•™ä½œè¯¾åä½œä¸šè¿›è¡Œæ¢ç´¢ã€‚ä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»…ä¸“æ³¨äºSparkåœ¨Standaloneæ¨¡å¼ä¸‹çš„åˆ†å¸ƒå¼éƒ¨ç½²ã€‚</p><p>ä¸ºäº†ç¤ºæ„Standaloneæ¨¡å¼çš„éƒ¨ç½²è¿‡ç¨‹ï¼Œæˆ‘è¿™è¾¹åœ¨AWSç¯å¢ƒä¸­åˆ›å»ºå¹¶å¯åŠ¨äº†3å°EC2è®¡ç®—èŠ‚ç‚¹ï¼Œæ“ä½œç³»ç»Ÿä¸ºLinux/CentOSã€‚</p><p>éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼ŒSparkåˆ†å¸ƒå¼è®¡ç®—ç¯å¢ƒçš„éƒ¨ç½²ï¼Œå¯¹äºèŠ‚ç‚¹ç±»å‹ä¸æ“ä½œç³»ç»Ÿæœ¬èº«æ˜¯æ²¡æœ‰è¦æ±‚å’Œé™åˆ¶çš„ï¼Œä½†æ˜¯<strong>åœ¨å®é™…çš„éƒ¨ç½²ä¸­ï¼Œè¯·ä½ å°½é‡ä¿æŒæ¯å°è®¡ç®—èŠ‚ç‚¹çš„æ“ä½œç³»ç»Ÿæ˜¯ä¸€è‡´çš„ï¼Œä»è€Œé¿å…ä¸å¿…è¦çš„éº»çƒ¦</strong>ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°±å¸¦ä½ æ‰‹æŠŠæ‰‹åœ°å»å®ŒæˆStandaloneæ¨¡å¼çš„åˆ†å¸ƒå¼éƒ¨ç½²ã€‚</p><p>Standaloneåœ¨èµ„æºè°ƒåº¦å±‚é¢ï¼Œé‡‡ç”¨äº†ä¸€ä¸»å¤šä»çš„ä¸»ä»æ¶æ„ï¼ŒæŠŠè®¡ç®—èŠ‚ç‚¹çš„è§’è‰²åˆ†ä¸ºMasterå’ŒWorkerã€‚å…¶ä¸­ï¼ŒMasteræœ‰ä¸”åªæœ‰ä¸€ä¸ªï¼Œè€ŒWorkerå¯ä»¥æœ‰ä¸€åˆ°å¤šä¸ªã€‚æ‰€æœ‰WorkerèŠ‚ç‚¹å‘¨æœŸæ€§åœ°å‘Masteræ±‡æŠ¥æœ¬èŠ‚ç‚¹å¯ç”¨èµ„æºçŠ¶æ€ï¼ŒMasterè´Ÿè´£æ±‡æ€»ã€å˜æ›´ã€ç®¡ç†é›†ç¾¤ä¸­çš„å¯ç”¨èµ„æºï¼Œå¹¶å¯¹Sparkåº”ç”¨ç¨‹åºä¸­Driverçš„èµ„æºè¯·æ±‚ä½œå‡ºå“åº”ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿æè¿°ï¼Œæˆ‘ä»¬æŠŠ3å°EC2çš„hostnameåˆ†åˆ«è®¾ç½®ä¸ºnode0ã€node1ã€node2ï¼Œå¹¶æŠŠnode0é€‰åšMasterèŠ‚ç‚¹ï¼Œè€ŒæŠŠnode1ã€node2é€‰åšWorkerèŠ‚ç‚¹ã€‚</p><p>é¦–å…ˆï¼Œä¸ºäº†å®ç°3å°æœºå™¨ä¹‹é—´çš„æ— ç¼é€šä¿¡ï¼Œæˆ‘ä»¬å…ˆæ¥åœ¨3å°èŠ‚ç‚¹ä¹‹é—´é…ç½®æ— å¯†ç çš„SSHç¯å¢ƒï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/f5/c0/f57e5456ff8a10d26d162ac52f20dcc0.jpg?wh=1394x617\" alt=\"å›¾ç‰‡\" title=\"é…ç½®3ä¸ªèŠ‚ç‚¹ä¹‹é—´å…å¯†çš„SSHç¯å¢ƒ\"></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šå‡†å¤‡Javaç¯å¢ƒå¹¶å®‰è£…Sparkï¼ˆå…¶ä¸­æ­¥éª¤2çš„â€œsudo wgetâ€ä½ å¯ä»¥å‚è€ƒ<a href=\"https://www.apache.org/dyn/closer.lua/spark/spark-3.1.2/spark-3.1.2-bin-hadoop3.2.tgz\">è¿™é‡Œ</a>çš„é“¾æ¥ï¼‰ï¼Œæ“ä½œå‘½ä»¤å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/0e/c4/0e1324ce7c3539698e70dae60609b6c4.jpg?wh=1591x1211\" alt=\"å›¾ç‰‡\" title=\"åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šå®‰è£…Javaå’ŒSpark\"></p><p>åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¹‹ä¸Šå®ŒæˆSparkçš„å®‰è£…ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¾æ¬¡å¯åŠ¨Masterå’ŒWorkerèŠ‚ç‚¹äº†ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/07/fc/078e9e891dee487a61b3f4f0931f80fc.jpg?wh=1489x607\" alt=\"å›¾ç‰‡\" title=\"åˆ†åˆ«å¯åŠ¨Masterå’ŒWorkers\"></p><p>é›†ç¾¤å¯åŠ¨ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Sparkè‡ªå¸¦çš„å°ä¾‹å­ï¼Œæ¥éªŒè¯Standaloneåˆ†å¸ƒå¼éƒ¨ç½²æ˜¯å¦æˆåŠŸã€‚é¦–å…ˆï¼Œæ‰“å¼€Masteræˆ–æ˜¯Workerçš„å‘½ä»¤è¡Œç»ˆç«¯ï¼Œç„¶åæ•²å…¥ä¸‹é¢è¿™ä¸ªå‘½ä»¤ï¼š</p><pre><code class=\"language-verilog\">MASTER=spark://node0:7077 $SPARK_HOME/bin/run-example org.apache.spark.examples.SparkPi\n</code></pre><p>å¦‚æœç¨‹åºèƒ½å¤ŸæˆåŠŸè®¡ç®—Piå€¼ï¼Œä¹Ÿå°±æ˜¯3.14ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé‚£ä¹ˆè¯´æ˜å’±ä»¬çš„Sparkåˆ†å¸ƒå¼è®¡ç®—é›†ç¾¤å·²ç„¶å°±ç»ªã€‚ä½ å¯ä»¥å¯¹ç…§æ–‡ç¨¿é‡Œçš„æˆªå›¾ï¼ŒéªŒè¯ä¸‹ä½ çš„ç¯å¢ƒæ˜¯å¦ä¹ŸæˆåŠŸäº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/99/20/990d84c917f4c1156cca663yyf2eb720.png?wh=578x42\" alt=\"å›¾ç‰‡\" title=\"Sparkè®¡ç®—Piçš„æ‰§è¡Œç»“æœ\"></p><h2>é‡ç‚¹å›é¡¾</h2><p>ä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘ä»¬æåˆ°ï¼Œ<strong>åˆ†å¸ƒå¼è®¡ç®—çš„ç²¾é«“åœ¨äºï¼Œå¦‚ä½•æŠŠæŠ½è±¡çš„è®¡ç®—æµå›¾ï¼Œè½¬åŒ–ä¸ºå®å®åœ¨åœ¨çš„åˆ†å¸ƒå¼è®¡ç®—ä»»åŠ¡ï¼Œç„¶åä»¥å¹¶è¡Œè®¡ç®—çš„æ–¹å¼äº¤ä»˜æ‰§è¡Œã€‚</strong>è€Œè¦æƒ³é€å½»ç†è§£åˆ†å¸ƒå¼è®¡ç®—ï¼Œä½ å°±éœ€è¦æŒæ¡Sparkè¿›ç¨‹æ¨¡å‹ã€‚</p><p>è¿›ç¨‹æ¨¡å‹çš„æ ¸å¿ƒæ˜¯Driverå’ŒExecutorsï¼Œæˆ‘ä»¬éœ€è¦é‡ç‚¹ç†è§£å®ƒä»¬ä¹‹é—´çš„åä½œå…³ç³»ã€‚ä»»ä½•ä¸€ä¸ªSparkåº”ç”¨ç¨‹åºçš„å…¥å£ï¼Œéƒ½æ˜¯å¸¦æœ‰SparkSessionçš„mainå‡½æ•°ï¼Œè€Œåœ¨Sparkçš„åˆ†å¸ƒå¼è®¡ç®—ç¯å¢ƒä¸­ï¼Œè¿è¡Œè¿™æ ·mainå‡½æ•°çš„JVMè¿›ç¨‹æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªï¼Œå®ƒè¢«ç§°ä¸º â€œDriverâ€ã€‚</p><p>Driveræœ€æ ¸å¿ƒçš„ä½œç”¨ï¼Œåœ¨äºè§£æç”¨æˆ·ä»£ç ã€æ„å»ºè®¡ç®—æµå›¾ï¼Œç„¶åå°†è®¡ç®—æµå›¾è½¬åŒ–ä¸ºåˆ†å¸ƒå¼ä»»åŠ¡ï¼Œå¹¶æŠŠä»»åŠ¡åˆ†å‘ç»™é›†ç¾¤ä¸­çš„Executorsäº¤ä»˜æ‰§è¡Œã€‚æ¥æ”¶åˆ°ä»»åŠ¡ä¹‹åï¼ŒExecutorsè°ƒç”¨å†…éƒ¨çº¿ç¨‹æ± ï¼Œç»“åˆäº‹å…ˆåˆ†é…å¥½çš„æ•°æ®åˆ†ç‰‡ï¼Œå¹¶å‘åœ°æ‰§è¡Œä»»åŠ¡ä»£ç ã€‚</p><p>å¯¹äºä¸€ä¸ªå®Œæ•´çš„RDDï¼Œæ¯ä¸ªExecutorsè´Ÿè´£å¤„ç†è¿™ä¸ªRDDçš„ä¸€ä¸ªæ•°æ®åˆ†ç‰‡å­é›†ã€‚æ¯å½“ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼ŒExecutorséƒ½ä¼šåŠæ—¶åœ°ä¸Driverè¿›è¡Œé€šä¿¡ã€æ±‡æŠ¥ä»»åŠ¡çŠ¶æ€ã€‚Driveråœ¨è·å–åˆ°Executorsçš„æ‰§è¡Œè¿›åº¦ä¹‹åï¼Œç»“åˆè®¡ç®—æµå›¾çš„ä»»åŠ¡æ‹†è§£ï¼Œä¾æ¬¡æœ‰åºåœ°å°†ä¸‹ä¸€é˜¶æ®µçš„ä»»åŠ¡å†æ¬¡åˆ†å‘ç»™Executorsä»˜è¯¸æ‰§è¡Œï¼Œç›´è‡³æ•´ä¸ªè®¡ç®—æµå›¾æ‰§è¡Œå®Œæ¯•ã€‚</p><p>ä¹‹åï¼Œæˆ‘ä»¬ä»‹ç»äº†Sparkæ”¯æŒçš„åˆ†å¸ƒå¼éƒ¨ç½²æ¨¡å¼ï¼Œä¸»è¦æœ‰Standaloneã€YARNã€Mesosã€Kubernetesã€‚å…¶ä¸­ï¼ŒStandaloneæ˜¯Sparkå†…ç½®çš„èµ„æºè°ƒåº¦å™¨ï¼Œè€ŒYARNã€Mesosã€Kubernetesæ˜¯ç‹¬ç«‹çš„ç¬¬ä¸‰æ–¹èµ„æºè°ƒåº¦ä¸æœåŠ¡ç¼–æ’æ¡†æ¶ã€‚åœ¨è¿™äº›éƒ¨ç½²æ¨¡å¼ä¸­ï¼Œä½ éœ€è¦é‡ç‚¹æŒæ¡Standaloneç¯å¢ƒéƒ¨ç½²çš„æ“ä½œæ­¥éª¤ã€‚</p><h2><strong>æ¯è¯¾ä¸€ç»ƒ</strong></h2><p>å¥½ï¼Œåœ¨è¿™ä¸€è®²çš„æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸¤é“ä½œä¸šï¼Œå¸®åŠ©ä½ å·©å›ºä»Šæ—¥æ‰€å­¦ã€‚</p><p>1.ä¸takeç®—å­ç±»ä¼¼ï¼Œcollectç®—å­ç”¨äºæ”¶é›†è®¡ç®—ç»“æœï¼Œç»“åˆSparkè¿›ç¨‹æ¨¡å‹ï¼Œä½ èƒ½è¯´ä¸€è¯´ï¼Œç›¸æ¯”collectç®—å­ç›¸æ¯”takeç®—å­æ¥è¯´éƒ½æœ‰å“ªäº›éšæ‚£å—ï¼Ÿ</p><p>2.å¦‚æœä½ çš„ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨äº†YARNã€Mesosæˆ–æ˜¯Kubernetesï¼Œä½ ä¸å¦¨è¯´ä¸€è¯´ï¼Œè¦å®ŒæˆSparkåœ¨è¿™äº›ç‹¬ç«‹æ¡†æ¶ä¸‹çš„åˆ†å¸ƒå¼éƒ¨ç½²ï¼Œéƒ½éœ€è¦å“ªäº›å¿…å¤‡çš„æ­¥éª¤ï¼Ÿ</p><p>ä»Šå¤©è¿™ä¸€è®²å°±åˆ°è¿™é‡Œäº†ï¼Œå¦‚æœä½ åœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°çš„ä»€ä¹ˆé—®é¢˜ï¼Œæ¬¢è¿ä½ åœ¨è¯„è®ºåŒºæé—®ã€‚å¦‚æœä½ è§‰å¾—è¿™ä¸€è®²å¸®åŠ©åˆ°äº†ä½ ï¼Œä¹Ÿæ¬¢è¿ä½ åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹å’ŒåŒäº‹ï¼Œæˆ‘ä»¬ä¸‹ä¸€è®²å†è§ã€‚</p>","comments":[{"had_liked":false,"id":312571,"user_name":"Geek_2dfa9a","can_delete":false,"product_type":"c1","uid":1435535,"ip_address":"","ucode":"B5FE7971F5E773","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epGTSTvn7r4ibk1PuaUrSvvLdviaLcne50jbvvfiaxKkM5SLibeP6jibA2bCCQBqETibvIvcsOhAZlwS8kQ/132","comment_is_top":true,"comment_ctime":1631870079,"is_pvip":false,"replies":[{"id":"113338","content":"æ»¡åˆ†ï¼æ»¡åˆ†ï¼ğŸ’¯ï¼ŒPerfectï¼<br><br>å¤ªèµäº†ï¼Œç›®å‰æœ€æ£’çš„ç­”æ¡ˆï¼<br><br>collectå’Œtakeçš„åˆ†æï¼Œå°¤å…¶åˆ°ä½ï¼Œå°¤å…¶æ˜¯takeçš„éƒ¨åˆ†ï¼æˆ‘è·Ÿç¼–è¾‘æ‰“ä¸ªæ‹›å‘¼ï¼ŒæŠŠä½ çš„ç­”æ¡ˆç½®é¡¶~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1632050850,"ip_address":"","comment_id":312571,"utype":1}],"discussion_count":2,"race_medal":0,"score":"9.2233721544508006e+18","product_id":100090001,"comment_content":"  1.<br>  collectï¼Œè§¦å‘actionè¿”å›å…¨éƒ¨ç»„åˆ†åŒºé‡Œçš„æ•°æ®ï¼Œresultsæ˜¯ä¸ªæ•°ç»„ç±»å‹çš„æ•°ç»„ï¼Œæœ€ååœ¨æŠŠè¿™äº›æ•°ç»„åˆå¹¶ã€‚<br>  å› ä¸ºæ‰€æœ‰æ•°æ®éƒ½ä¼šè¢«åŠ è½½åˆ°driverï¼Œæ‰€ä»¥å»ºè®®åªåœ¨æ•°æ®é‡å°‘çš„æ—¶å€™ä½¿ç”¨ã€‚æºç å¦‚ä¸‹ï¼š<br>  &#47;**<br>   * Return an array that contains all of the elements in this RDD.<br>   *<br>   * @note This method should only be used if the resulting array is expected to be small, as<br>   * all the data is loaded into the driver&#39;s memory.<br>   *&#47;<br>  def collect(): Array[T] = withScope {<br>    val results = sc.runJob(this, (iter: Iterator[T]) =&gt; iter.toArray)<br>    Array.concat(results: _*)<br>  }<br>  takeä»£ç å¤ªé•¿å°±ä¸å‘äº†ï¼Œæ³¨é‡Šä¸Šè¯´æ˜¯å…ˆå–ä¸€ä¸ªåˆ†åŒºï¼Œç„¶åæ ¹æ®å–åˆ°çš„æ•°é‡é¢„ä¼°å‡ºè¿˜éœ€è¦å–å¤šå°‘ä¸ªåˆ†åŒºã€‚<br>  å’Œcollectä¸€æ ·ï¼Œå»ºè®®åªåœ¨æ•°æ®é‡å°‘çš„æ—¶å€™ä½¿ç”¨ã€‚å¦‚æœrddé‡Œæœ‰Nothingå’ŒNullçš„è¯ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚<br>  å…·ä½“å®ç°ï¼š<br>  å…ˆå°è¯•ä»ç¬¬ä¸€ä¸ªåˆ†åŒº0å¼€å§‹colletæ•°æ®ï¼Œ<br>    å¦‚æœè¿”å›æ•°é‡ä¸º0çš„è¯ï¼Œæ¯æ¬¡éƒ½æ‹‰å·²æ‰«æåˆ†åŒºæ•°4å€çš„åˆ†åŒºæ•°ï¼ˆå¯ä»¥é€šè¿‡spark.rdd.limit.scaleUpFactorå‚æ•°è®¾ç½®ï¼Œé»˜è®¤å€¼ä¸º4ï¼‰ï¼Œ<br>    å¦‚æœè¿”å›æ•°é‡å¤§äº0ä½†æ˜¯è¿˜ä¸å¤Ÿéœ€è¦takeçš„æ•°é‡çš„è¯ï¼Œä»å·²æ‰«æåˆ†åŒºæ•°4å€çš„åˆ†åŒºæ•°å’Œå·²æ‰«æåˆ†åŒºæ•°é¢„ä¼°ä¸€ä¸ªéœ€è¦æ‰«æåˆ†åŒºæ•°ï¼ˆ1.5*å‰©ä½™éœ€è¦takeçš„æ•°æ®æ•°*å·²æ‰«æåˆ†åŒºæ•°&#47;å·²å–åˆ°çš„æ•°æ®æ•°ï¼Œç„¶åå‘ä¸Šå–æ•´ï¼‰é€‰ä¸€ä¸ªæœ€å°å€¼<br>  ä¸€ç›´åˆ°æ‹¿åˆ°takeæ•°æ®æ•°&#47;å…¨éƒ¨åˆ†åŒºéƒ½å–å®Œã€‚<br>  &#47;**<br>   * Take the first num elements of the RDD. It works by first scanning one partition, and use the<br>   * results from that partition to estimate the number of additional partitions needed to satisfy<br>   * the limit.<br>   *<br>   * @note This method should only be used if the resulting array is expected to be small, as<br>   * all the data is loaded into the driver&#39;s memory.<br>   *<br>   * @note Due to complications in the internal implementation, this method will raise<br>   * an exception if called on an RDD of `Nothing` or `Null`.<br>   *&#47;<br><br>   2.ä½¿ç”¨äº†yarnï¼Œæ²¡æœ‰ä½¿ç”¨standaloneæ‰€ä»¥ä¹Ÿæ²¡å•¥ç”Ÿäº§ç»éªŒï¼Œç®€å•çœ‹äº†ä¸‹å®˜æ–¹éƒ¨ç½²æ–‡æ¡£ï¼š<br>   é¦–å…ˆéœ€è¦å…³æ³¨å®‰å…¨é—®é¢˜ï¼ŒSparkRpcçš„èº«ä»½éªŒè¯å’ŒåŠ å¯†ï¼Œæœ¬åœ°æ–‡ä»¶ï¼ˆshuffleï¼‰çš„åŠ å¯†ï¼ŒSparkUIçš„å®‰å…¨ï¼ˆèº«ä»½éªŒè¯ï¼Œhttpsï¼Œå…¶ä»–webå®‰å…¨ï¼‰<br>   Event Loggingå’Œè®¿é—®ï¼Œå®¢æˆ·ç«¯æ¨¡å¼ä¸‹çš„æŒä¹…åŒ–æ—¥å¿—çš„æƒé™<br>   ç„¶åæ˜¯é«˜å¯ç”¨ï¼Œsparkçš„workeræ˜¯æ”¯æŒé«˜å¯ç”¨çš„ï¼Œmasteræ˜¯é€šè¿‡zkå®ç°çš„","like_count":28,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527030,"discussion_content":"æ»¡åˆ†ï¼æ»¡åˆ†ï¼ğŸ’¯ï¼ŒPerfectï¼\n\nå¤ªèµäº†ï¼Œç›®å‰æœ€æ£’çš„ç­”æ¡ˆï¼\n\ncollectå’Œtakeçš„åˆ†æï¼Œå°¤å…¶åˆ°ä½ï¼Œå°¤å…¶æ˜¯takeçš„éƒ¨åˆ†ï¼æˆ‘è·Ÿç¼–è¾‘æ‰“ä¸ªæ‹›å‘¼ï¼ŒæŠŠä½ çš„ç­”æ¡ˆç½®é¡¶~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632050850,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1096652,"avatar":"https://static001.geekbang.org/account/avatar/00/10/bb/cc/fac12364.jpg","nickname":"xxx","note":"","ucode":"E79CEA70430449","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544533,"discussion_content":"å“¦ï¼Œæˆ‘ç†è§£takeçš„é—®é¢˜å°±æ˜¯æœ‰æ”¾å¤§æ•ˆåº”ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641551173,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":320518,"user_name":"è·¯äººä¸","can_delete":false,"product_type":"c1","uid":1640477,"ip_address":"","ucode":"078F0235DAFCA5","user_header":"https://static001.geekbang.org/account/avatar/00/19/08/1d/30b32c93.jpg","comment_is_top":true,"comment_ctime":1636364474,"is_pvip":false,"replies":[{"id":"116301","content":"æ„Ÿè°¢è€å¼Ÿï¼Œé—®é¢˜æå¾—å¾ˆå¥½~ <br><br>å…ˆè¯´è¯´é€‰ä¸»ï¼Œè¿™ä¸ªå…¶å®æ¯”è¾ƒç®€å•ï¼ŒStandaloneéƒ¨ç½²æ¨¡å¼ä¸‹ï¼ŒMasterä¸Workerè§’è‰²ï¼Œè¿™ä¸ªæ˜¯æˆ‘ä»¬é€šè¿‡é…ç½®æ–‡ä»¶ï¼Œäº‹å…ˆé…ç½®å¥½çš„ï¼Œæ‰€ä»¥è¯´ï¼Œå“ªå°æ˜¯Masterï¼Œå“ªå°æ˜¯Workerï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶é‡Œé¢éƒ½æœ‰ã€‚åœ¨Standaloneéƒ¨ç½²ä¸‹ï¼Œå…ˆå¯åŠ¨Masterï¼Œç„¶åå¯åŠ¨Workerï¼Œç”±äºé…ç½®ä¸­æœ‰Masterçš„è¿æ¥åœ°å€ï¼Œæ‰€ä»¥Workerå¯åŠ¨çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å»è¿æ¥Masterï¼Œç„¶ååŒæ–¹å»ºç«‹å¿ƒè·³æœºåˆ¶ï¼Œéšåé›†ç¾¤è¿›å…¥readyçŠ¶æ€ã€‚<br><br>æ¥ä¸‹æ¥è¯´Masterã€Workerä¸Driverã€Executorsçš„å…³ç³»ã€‚é¦–å…ˆï¼Œè¿™4ä¸ªâ€œå®¶ä¼™â€ï¼Œéƒ½æ˜¯JVMè¿›ç¨‹ã€‚ä¸è¿‡å‘¢ï¼Œä»–ä»¬çš„å®šä½å’Œè§’è‰²ï¼Œæ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ã€‚Masterã€Workerç”¨æ¥åšèµ„æºçš„è°ƒåº¦ä¸åˆ†é…ï¼Œä½ å¯ä»¥è¿™æ ·ç†è§£ï¼Œè¿™ä¸¤ä¸ªå®¶ä¼™ï¼Œåªè´Ÿè´£ç»´æŠ¤é›†ç¾¤ä¸­å¯ç”¨ç¡¬ä»¶èµ„æºçš„çŠ¶æ€ã€‚æ¢å¥è¯è¯´ï¼ŒWorkerè®°å½•ç€æ¯ä¸ªè®¡ç®—èŠ‚ç‚¹å¯ç”¨CPU coresã€å¯ç”¨å†…å­˜ï¼Œç­‰ç­‰ã€‚è€ŒMasterä»Workeræ”¶é›†å¹¶æ±‡æ€»æ‰€æœ‰é›†ç¾¤ä¸­èŠ‚ç‚¹çš„å¯ç”¨è®¡ç®—èµ„æºã€‚<br><br>Driverå’ŒExecutorsçš„è§’è‰²ï¼Œé‚£å°±çº¯æ˜¯Sparkåº”ç”¨çº§åˆ«çš„è¿›ç¨‹äº†ã€‚è¿™ä¸ªå’±ä»¬è¯¾ç¨‹æœ‰ä»‹ç»ï¼Œå°±ä¸èµ˜è¿°äº†ã€‚Driverã€Executorsçš„è®¡ç®—èµ„æºï¼Œå…¨éƒ¨æ¥è‡ªäºMasterçš„è°ƒåº¦ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒDriverä¼šå ç”¨Masteræ‰€åœ¨èŠ‚ç‚¹çš„èµ„æºï¼›è€ŒExecutorsä¸€èˆ¬å ç”¨Workeræ‰€åœ¨èŠ‚ç‚¹çš„è®¡ç®—èµ„æºã€‚ä¸€æ—¦Driverã€Executorsä»Masterã€Workeré‚£é‡Œç”³è¯·åˆ°èµ„æºä¹‹åï¼ŒDriverã€Executorså°±ä¸å†â€œé¸Ÿâ€Masterå’ŒWorkeräº†ï¼Œå› ä¸ºèµ„æºå·²ç»åˆ°æ‰‹äº†ï¼Œåç»­å°±æ˜¯ä»»åŠ¡è°ƒåº¦çš„èŒƒç•´ã€‚ä»»åŠ¡è°ƒåº¦è¯¾ç¨‹ä¸­ä¹Ÿæœ‰è¯¦ç»†çš„ä»‹ç»ï¼Œè€å¼Ÿå¯ä»¥å…³æ³¨ä¸‹~<br><br>å¤§æ¦‚å…¶å°±æ˜¯è¿™ä¹ˆäº›å…³ç³»ï¼Œä¸çŸ¥é“å¯¹è€å¼Ÿæ˜¯å¦æœ‰æ‰€å¸®åŠ©~<br>","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1636471031,"ip_address":"","comment_id":320518,"utype":1}],"discussion_count":3,"race_medal":0,"score":"9.2233721072106004e+18","product_id":100090001,"comment_content":"è€å¸ˆå¥½ï¼è®²è§£å¾ˆç²¾å½©ï¼<br>ä¸ºäº†å¸®åŠ©å¤§å®¶ç†è§£ï¼Œè¿˜æ˜¯è¦è¯´è¯´ standalone æ¨¡å¼ä¸‹çš„ ä¸»ä»é€‰ä¸¾è¿‡ç¨‹ï¼Œä¸‰ä¸ªèŠ‚ç‚¹æ€ä¹ˆäº’ç›¸æ‰¾åˆ°å¹¶é€‰å‡ºä¸»ä»ã€‚å¦å¤–ï¼Œstandalone æ¨¡å¼ä¸‹çš„ master å’Œ workerï¼Œä¸å‰é¢è¿›ç¨‹æ¨¡å‹é‡Œè¯´çš„ Driver å’Œ executorï¼ŒäºŒç»„ä¹‹é—´çš„å¯¹åº”å…³ç³»ï¼Œä¹Ÿè¦è®²è®²ã€‚åªè¦èƒ½ç®€å•ä¸²èµ·æ¥å°±å¯ä»¥äº†ã€‚è®©å¤§å®¶è·å¾—ä¸€ä¸ªå³ä¾¿ç®€å•ã€ä½†å´å®Œæˆçš„ç†è§£æ¨¡å‹ã€‚<br>","like_count":17,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530026,"discussion_content":"æ„Ÿè°¢è€å¼Ÿï¼Œé—®é¢˜æå¾—å¾ˆå¥½~ \n\nå…ˆè¯´è¯´é€‰ä¸»ï¼Œè¿™ä¸ªå…¶å®æ¯”è¾ƒç®€å•ï¼ŒStandaloneéƒ¨ç½²æ¨¡å¼ä¸‹ï¼ŒMasterä¸Workerè§’è‰²ï¼Œè¿™ä¸ªæ˜¯æˆ‘ä»¬é€šè¿‡é…ç½®æ–‡ä»¶ï¼Œäº‹å…ˆé…ç½®å¥½çš„ï¼Œæ‰€ä»¥è¯´ï¼Œå“ªå°æ˜¯Masterï¼Œå“ªå°æ˜¯Workerï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶é‡Œé¢éƒ½æœ‰ã€‚åœ¨Standaloneéƒ¨ç½²ä¸‹ï¼Œå…ˆå¯åŠ¨Masterï¼Œç„¶åå¯åŠ¨Workerï¼Œç”±äºé…ç½®ä¸­æœ‰Masterçš„è¿æ¥åœ°å€ï¼Œæ‰€ä»¥Workerå¯åŠ¨çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å»è¿æ¥Masterï¼Œç„¶ååŒæ–¹å»ºç«‹å¿ƒè·³æœºåˆ¶ï¼Œéšåé›†ç¾¤è¿›å…¥readyçŠ¶æ€ã€‚\n\næ¥ä¸‹æ¥è¯´Masterã€Workerä¸Driverã€Executorsçš„å…³ç³»ã€‚é¦–å…ˆï¼Œè¿™4ä¸ªâ€œå®¶ä¼™â€ï¼Œéƒ½æ˜¯JVMè¿›ç¨‹ã€‚ä¸è¿‡å‘¢ï¼Œä»–ä»¬çš„å®šä½å’Œè§’è‰²ï¼Œæ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ã€‚Masterã€Workerç”¨æ¥åšèµ„æºçš„è°ƒåº¦ä¸åˆ†é…ï¼Œä½ å¯ä»¥è¿™æ ·ç†è§£ï¼Œè¿™ä¸¤ä¸ªå®¶ä¼™ï¼Œåªè´Ÿè´£ç»´æŠ¤é›†ç¾¤ä¸­å¯ç”¨ç¡¬ä»¶èµ„æºçš„çŠ¶æ€ã€‚æ¢å¥è¯è¯´ï¼ŒWorkerè®°å½•ç€æ¯ä¸ªè®¡ç®—èŠ‚ç‚¹å¯ç”¨CPU coresã€å¯ç”¨å†…å­˜ï¼Œç­‰ç­‰ã€‚è€ŒMasterä»Workeræ”¶é›†å¹¶æ±‡æ€»æ‰€æœ‰é›†ç¾¤ä¸­èŠ‚ç‚¹çš„å¯ç”¨è®¡ç®—èµ„æºã€‚\n\nDriverå’ŒExecutorsçš„è§’è‰²ï¼Œé‚£å°±çº¯æ˜¯Sparkåº”ç”¨çº§åˆ«çš„è¿›ç¨‹äº†ã€‚è¿™ä¸ªå’±ä»¬è¯¾ç¨‹æœ‰ä»‹ç»ï¼Œå°±ä¸èµ˜è¿°äº†ã€‚Driverã€Executorsçš„è®¡ç®—èµ„æºï¼Œå…¨éƒ¨æ¥è‡ªäºMasterçš„è°ƒåº¦ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒDriverä¼šå ç”¨Masteræ‰€åœ¨èŠ‚ç‚¹çš„èµ„æºï¼›è€ŒExecutorsä¸€èˆ¬å ç”¨Workeræ‰€åœ¨èŠ‚ç‚¹çš„è®¡ç®—èµ„æºã€‚ä¸€æ—¦Driverã€Executorsä»Masterã€Workeré‚£é‡Œç”³è¯·åˆ°èµ„æºä¹‹åï¼ŒDriverã€Executorså°±ä¸å†â€œé¸Ÿâ€Masterå’ŒWorkeräº†ï¼Œå› ä¸ºèµ„æºå·²ç»åˆ°æ‰‹äº†ï¼Œåç»­å°±æ˜¯ä»»åŠ¡è°ƒåº¦çš„èŒƒç•´ã€‚ä»»åŠ¡è°ƒåº¦è¯¾ç¨‹ä¸­ä¹Ÿæœ‰è¯¦ç»†çš„ä»‹ç»ï¼Œè€å¼Ÿå¯ä»¥å…³æ³¨ä¸‹~\n\nå¤§æ¦‚å…¶å°±æ˜¯è¿™ä¹ˆäº›å…³ç³»ï¼Œä¸çŸ¥é“å¯¹è€å¼Ÿæ˜¯å¦æœ‰æ‰€å¸®åŠ©~\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636471031,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":2,"child_discussions":[{"author":{"id":3009349,"avatar":"https://static001.geekbang.org/account/avatar/00/2d/eb/45/5cd08c28.jpg","nickname":"4.435kms","note":"","ucode":"5A3D7DEB6C9785","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":573440,"discussion_content":"ä½œè€…ä½ å¥½ï¼Œexecutoræ˜¯ä¸€ä¸ªè¿›ç¨‹çš„è¯ï¼Œé‚£ä¹ˆä¸€ä¸ªworkerèŠ‚ç‚¹æ˜¯å¦å¯èƒ½ä¼šæœ‰å¤šä¸ªexecutorå‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653410130,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":530026,"ip_address":""},"score":573440,"extra":""},{"author":{"id":1903790,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/iaQgtbE98VGIVIyribdo6dgLOnaNoe7ZdUuPr60ibsduibscrzQCTzdW2AfL9nxwe8YlSK75gOnK3YbAJKTaFPxibdg/132","nickname":"å°æ","note":"","ucode":"30BD251EE1B1E2","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":3009349,"avatar":"https://static001.geekbang.org/account/avatar/00/2d/eb/45/5cd08c28.jpg","nickname":"4.435kms","note":"","ucode":"5A3D7DEB6C9785","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591225,"discussion_content":"è¿™ä¸ªå®Œå…¨æ˜¯å¯èƒ½çš„ï¼Œæ¯”å¦‚workerçš„æ•°é‡å°äºç”³è¯·çš„executorsçš„æ•°é‡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666410453,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":573440,"ip_address":"å››å·"},"score":591225,"extra":""}]}]},{"had_liked":false,"id":312502,"user_name":"GACÂ·DU","can_delete":false,"product_type":"c1","uid":1385403,"ip_address":"","ucode":"7847FBE1C13740","user_header":"https://static001.geekbang.org/account/avatar/00/15/23/bb/a1a61f7c.jpg","comment_is_top":false,"comment_ctime":1631844377,"is_pvip":true,"replies":[{"id":"113336","content":"å¥½é—®é¢˜~<br><br>1. æ»¡åˆ†ğŸ’¯ï¼Œæˆ‘ç†è§£ï¼Œcollectæ›´å¤šçš„æ˜¯ç¤¾åŒºä¸ºå¼€å‘è€…æä¾›çš„ä¸€ç§èƒ½åŠ›æˆ–è€…è¯´åŠŸèƒ½ï¼Œå°±æ˜¯Sparkæœ‰èƒ½åŠ›æŠŠå…¨é‡ç»“æœæ”¶é›†åˆ°Driverï¼Œä½†æ˜¯å¦ç™½è¯´ï¼Œè¿™ç§éœ€æ±‚åœ¨å·¥ä¸šçº§åº”ç”¨ä¸­å¹¶ä¸å¤šã€‚ä½†æ˜¯Sparkå¿…é¡»æä¾›è¿™ç§èƒ½åŠ›æˆ–è€…é€‰é¡¹ï¼Œä»¥å¤‡å¼€å‘è€…ä¸æ—¶ä¹‹éœ€ã€‚æ¢å¥è¯è¯´ï¼Œcollectæ˜¯é¸¡è‚‹ï¼Œé£Ÿä¹‹æ— å‘³ï¼Œä½†æ˜¯ä¸èƒ½æ²¡æœ‰ã€‚<br><br>2. æˆ‘ç†è§£è¿™æ˜¯ä¸¤ä¸ªé—®é¢˜ã€‚å…ˆè¯´Top5ï¼Œå†è¯´take5ï¼Œä¸¤ä¸ªæœ‰ç€å¤©å£¤ä¹‹åˆ«ã€‚top5ï¼Œå…¶å®å°±æ˜¯å…¨é‡æ•°æ®ä¹‹ä¸Šçš„è®¡ç®—ï¼Œå…ˆåˆ†ç»„ï¼Œå†èšåˆï¼Œæœ€åæ’åºï¼Œè¿™ä¸ªä¸æ˜¯ä»å“ªä¸ªExecutorsæå–çš„ï¼Œè€Œæ˜¯æœ€ååšå½’å¹¶æ’åºï¼ˆGlobal sortï¼‰çš„æ—¶å€™ï¼ŒæŒ‰ç…§å¤§å°ä¸ªæå–å‡ºæ¥çš„ï¼Œå…·ä½“æ˜¯å“ªä¸ªExecutorsï¼Œè¦çœ‹å®ƒæ˜¯ä¸æ˜¯æä¾›äº†top5çš„wordsã€‚<br><br>å†è¯´take5ï¼Œè¿™ä¸ªå°±æœ‰æ„æ€äº†ã€‚top5ï¼Œæš—å«ç€çš„æ„æ€ï¼Œå°±æ˜¯æ•°æ®ä¸€å®šéœ€è¦æ’åºï¼Œå¦åˆ™å“ªé‡Œæœ‰â€œtopâ€çš„æ¦‚å¿µå‘¢ã€‚ä½†æ˜¯takeä¸ä¸€æ ·ï¼Œtakeï¼Œæ˜¯â€œéšä¾¿â€æ‹¿5ä¸ªã€‚åœ¨å’±ä»¬çš„word countç¤ºä¾‹ä¸­ï¼Œå‡è®¾æ²¡æœ‰sortByKeyï¼Œç›´æ¥ç”¨take(5)ï¼Œé‚£ä¹ˆSparkåœ¨è¿è¡Œæ—¶çš„è¡¨ç°ï¼Œä¼šå®Œå…¨ä¸ä¸€æ ·ã€‚å…·ä½“æ¥è¯´ï¼Œå› ä¸ºæ˜¯â€œéšä¾¿â€å–5ä¸ªï¼Œæ‰€ä»¥Sparkä¼šå·æ‡’ï¼Œä¸ä¼šå»runå…¨é‡æ•°æ®ï¼Œè€Œæ˜¯è¯•æ¢æ€§åœ°ï¼Œå»runå‡ ä¸ªå°çš„jobï¼Œè¿™äº›jobï¼Œåªç”¨éƒ¨åˆ†æ•°æ®ï¼Œåªè¦æœ€ç»ˆèƒ½å–åˆ°5ä¸ªå€¼ï¼Œâ€œéšä¾¿å–5ä¸ªâ€çš„ç›®çš„å°±è¾¾åˆ°äº†ï¼Œè¿™å…¶å®æ˜¯Sparkå¯¹äºfirstã€takeè¿™ç±»ç®—å­çš„ä¸€ç§ä¼˜åŒ–~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1632050584,"ip_address":"","comment_id":312502,"utype":1}],"discussion_count":3,"race_medal":0,"score":"31696615449","product_id":100090001,"comment_content":"1ã€collect()æ–¹æ³•å›æŠŠRDDæ‰€æœ‰çš„å…ƒç´ è¿”è¿˜ç»™Driverç«¯ï¼Œå¹¶åœ¨Driverç«¯æŠŠæ•°æ®åºåˆ—æˆæ•°ç»„ï¼Œå¦‚æœæ•°æ®é‡è¿‡å¤§ï¼Œä¼šå¯¼è‡´Driverç«¯å†…å­˜æº¢å‡ºï¼Œä¹Ÿä¼šå¯¼è‡´Driverè¿›ç¨‹å¥”æºƒã€‚ä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œæ—¢ç„¶collectæ–¹æ³•æœ‰å¼Šç«¯ï¼Œsparkå¼€å‘è€…ä¸ºä»€ä¹ˆè¿˜è¦å¯¹ç”¨æˆ·æä¾›å®ƒï¼Ÿéš¾é“è¿˜æœ‰åˆ«çš„ä»€ä¹ˆç‰¹æ®Šç”¨æˆ·åœºæ™¯å—ï¼Ÿè¯·è€å¸ˆæŒ‡ç‚¹ã€‚<br>2ã€ç›®å‰ä½¿ç”¨çš„æ˜¯YARNè¿›è¡Œä»»åŠ¡è°ƒåº¦ï¼Œæäº¤ä»»åŠ¡éœ€è¦æŒ‡å®š--master yarn å’Œ --deploy-mode [cluster | client]ã€‚<br>æœ‰ä¸ªé—®é¢˜å’¨è¯¢è€å¸ˆï¼Œæ¯”å¦‚è¯´wordCountçš„top5ï¼Œtake(5)æ˜¯å¦‚ä½•çŸ¥é“è¦ä»å“ªä¸ªexecutoræå–æƒ³è¦çš„æ•°æ®çš„ï¼Ÿ","like_count":8,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526990,"discussion_content":"å¥½é—®é¢˜~\n\n1. æ»¡åˆ†ğŸ’¯ï¼Œæˆ‘ç†è§£ï¼Œcollectæ›´å¤šçš„æ˜¯ç¤¾åŒºä¸ºå¼€å‘è€…æä¾›çš„ä¸€ç§èƒ½åŠ›æˆ–è€…è¯´åŠŸèƒ½ï¼Œå°±æ˜¯Sparkæœ‰èƒ½åŠ›æŠŠå…¨é‡ç»“æœæ”¶é›†åˆ°Driverï¼Œä½†æ˜¯å¦ç™½è¯´ï¼Œè¿™ç§éœ€æ±‚åœ¨å·¥ä¸šçº§åº”ç”¨ä¸­å¹¶ä¸å¤šã€‚ä½†æ˜¯Sparkå¿…é¡»æä¾›è¿™ç§èƒ½åŠ›æˆ–è€…é€‰é¡¹ï¼Œä»¥å¤‡å¼€å‘è€…ä¸æ—¶ä¹‹éœ€ã€‚æ¢å¥è¯è¯´ï¼Œcollectæ˜¯é¸¡è‚‹ï¼Œé£Ÿä¹‹æ— å‘³ï¼Œä½†æ˜¯ä¸èƒ½æ²¡æœ‰ã€‚\n\n2. æˆ‘ç†è§£è¿™æ˜¯ä¸¤ä¸ªé—®é¢˜ã€‚å…ˆè¯´Top5ï¼Œå†è¯´take5ï¼Œä¸¤ä¸ªæœ‰ç€å¤©å£¤ä¹‹åˆ«ã€‚top5ï¼Œå…¶å®å°±æ˜¯å…¨é‡æ•°æ®ä¹‹ä¸Šçš„è®¡ç®—ï¼Œå…ˆåˆ†ç»„ï¼Œå†èšåˆï¼Œæœ€åæ’åºï¼Œè¿™ä¸ªä¸æ˜¯ä»å“ªä¸ªExecutorsæå–çš„ï¼Œè€Œæ˜¯æœ€ååšå½’å¹¶æ’åºï¼ˆGlobal sortï¼‰çš„æ—¶å€™ï¼ŒæŒ‰ç…§å¤§å°ä¸ªæå–å‡ºæ¥çš„ï¼Œå…·ä½“æ˜¯å“ªä¸ªExecutorsï¼Œè¦çœ‹å®ƒæ˜¯ä¸æ˜¯æä¾›äº†top5çš„wordsã€‚\n\nå†è¯´take5ï¼Œè¿™ä¸ªå°±æœ‰æ„æ€äº†ã€‚top5ï¼Œæš—å«ç€çš„æ„æ€ï¼Œå°±æ˜¯æ•°æ®ä¸€å®šéœ€è¦æ’åºï¼Œå¦åˆ™å“ªé‡Œæœ‰â€œtopâ€çš„æ¦‚å¿µå‘¢ã€‚ä½†æ˜¯takeä¸ä¸€æ ·ï¼Œtakeï¼Œæ˜¯â€œéšä¾¿â€æ‹¿5ä¸ªã€‚åœ¨å’±ä»¬çš„word countç¤ºä¾‹ä¸­ï¼Œå‡è®¾æ²¡æœ‰sortByKeyï¼Œç›´æ¥ç”¨take(5)ï¼Œé‚£ä¹ˆSparkåœ¨è¿è¡Œæ—¶çš„è¡¨ç°ï¼Œä¼šå®Œå…¨ä¸ä¸€æ ·ã€‚å…·ä½“æ¥è¯´ï¼Œå› ä¸ºæ˜¯â€œéšä¾¿â€å–5ä¸ªï¼Œæ‰€ä»¥Sparkä¼šå·æ‡’ï¼Œä¸ä¼šå»runå…¨é‡æ•°æ®ï¼Œè€Œæ˜¯è¯•æ¢æ€§åœ°ï¼Œå»runå‡ ä¸ªå°çš„jobï¼Œè¿™äº›jobï¼Œåªç”¨éƒ¨åˆ†æ•°æ®ï¼Œåªè¦æœ€ç»ˆèƒ½å–åˆ°5ä¸ªå€¼ï¼Œâ€œéšä¾¿å–5ä¸ªâ€çš„ç›®çš„å°±è¾¾åˆ°äº†ï¼Œè¿™å…¶å®æ˜¯Sparkå¯¹äºfirstã€takeè¿™ç±»ç®—å­çš„ä¸€ç§ä¼˜åŒ–~","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1632050584,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1435535,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epGTSTvn7r4ibk1PuaUrSvvLdviaLcne50jbvvfiaxKkM5SLibeP6jibA2bCCQBqETibvIvcsOhAZlwS8kQ/132","nickname":"Geek_2dfa9a","note":"","ucode":"B5FE7971F5E773","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394409,"discussion_content":"å…ˆå–åˆ†åŒº0çš„ï¼Œä¸å¤Ÿå†ç»§ç»­å–","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1631870172,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":1435535,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epGTSTvn7r4ibk1PuaUrSvvLdviaLcne50jbvvfiaxKkM5SLibeP6jibA2bCCQBqETibvIvcsOhAZlwS8kQ/132","nickname":"Geek_2dfa9a","note":"","ucode":"B5FE7971F5E773","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394783,"discussion_content":"æ²¡é”™ï¼Œå…³äºtakeæ›´è¯¦ç»†çš„è§£é‡Šï¼Œå¯ä»¥å‚è€ƒè¯„è®ºåŒºGeek_2dfa9aè¿™ä½è€å¼Ÿçš„ç­”å¤ï¼Œéå¸¸çš„è¯¦å°½ï¼ŒèµğŸ‘ï¼Œå¤ªæ£’äº†ï¼","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1632050969,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":394409,"ip_address":""},"score":394783,"extra":""}]}]},{"had_liked":false,"id":312503,"user_name":"coderzjh","can_delete":false,"product_type":"c1","uid":1058974,"ip_address":"","ucode":"4147A5A66FC3A6","user_header":"https://static001.geekbang.org/account/avatar/00/10/28/9e/8801bfd6.jpg","comment_is_top":false,"comment_ctime":1631844564,"is_pvip":false,"replies":[{"id":"113282","content":"æ„Ÿè°¢è€å¼Ÿè®¤å¯ï½ è¿™è¾¹æ›´æ–°è¿›åº¦æ˜¯æ¯å‘¨ä¸€ä¸‰äº”å“ˆï½ ","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1631937704,"ip_address":"","comment_id":312503,"utype":1}],"discussion_count":2,"race_medal":0,"score":"27401648340","product_id":100090001,"comment_content":"è®²çš„çœŸå¥½æ‡‚ï¼Œè€å¸ˆèƒ½ä¸èƒ½æ›´å¿«ç‚¹å“ˆï¼Œä»æ¥æ²¡æœ‰åƒç°åœ¨è¿™æ ·çˆ±å¥½å­¦ä¹ ","like_count":6,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526991,"discussion_content":"æ„Ÿè°¢è€å¼Ÿè®¤å¯ï½ è¿™è¾¹æ›´æ–°è¿›åº¦æ˜¯æ¯å‘¨ä¸€ä¸‰äº”å“ˆï½ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631937704,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2137231,"avatar":"https://static001.geekbang.org/account/avatar/00/20/9c/8f/b865ddba.jpg","nickname":"é£ç§å­","note":"","ucode":"AE3DF52901DF95","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394380,"discussion_content":"+1æ­£å¥½ä¹‹åè¦ç”¨åˆ°sparkï¼Œå¥½æƒ³å¿«ç‚¹å­¦ä¹ ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1631862921,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314812,"user_name":"pythonbug","can_delete":false,"product_type":"c1","uid":1487274,"ip_address":"","ucode":"1A70CA92FFF8EB","user_header":"https://wx.qlogo.cn/mmopen/vi_32/wgMMrp1hvSB3E30KqZvMsj3KQdAI3T1uQM77LT7hZ65nVSjPGRg3AbUOyiahnssA6AIT5PAkyHFmlTBzUH9gdyQ/132","comment_is_top":false,"comment_ctime":1633446165,"is_pvip":true,"replies":[{"id":"114055","content":"æ˜¯åœ¨Executorsç«¯æ‰§è¡Œçš„ï¼Œä½†æ˜¯ï¼Œæ¯ä¸ªExecutorsåªè¯»å–æ–‡ä»¶çš„ä¸€éƒ¨åˆ†~ å¯ä»¥ç»“åˆåé¢ä¼šè®²çš„è°ƒåº¦ç³»ç»Ÿï¼Œæ¥ç†è§£è¿™ä¸€ç‚¹~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1633613937,"ip_address":"","comment_id":314812,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23108282645","product_id":100090001,"comment_content":"è€å¸ˆå¥½ï¼Œæœ‰ä¸€ä¸ªåœ°æ–¹ä¸€ç›´ä¸æ‡‚ï¼ŒtextFileç®—å­æ˜¯åœ¨excutorç«¯æ‰§è¡Œçš„å—ï¼Ÿé‚£å²‚ä¸æ˜¯æ¯ä¸ªexcutoréƒ½ä¼šå…ˆè¯»å–æ•´ä¸ªæ–‡ä»¶","like_count":6,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527798,"discussion_content":"æ˜¯åœ¨Executorsç«¯æ‰§è¡Œçš„ï¼Œä½†æ˜¯ï¼Œæ¯ä¸ªExecutorsåªè¯»å–æ–‡ä»¶çš„ä¸€éƒ¨åˆ†~ å¯ä»¥ç»“åˆåé¢ä¼šè®²çš„è°ƒåº¦ç³»ç»Ÿï¼Œæ¥ç†è§£è¿™ä¸€ç‚¹~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633613937,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":330635,"user_name":"A","can_delete":false,"product_type":"c1","uid":2709345,"ip_address":"","ucode":"3A60C9F3985A38","user_header":"https://static001.geekbang.org/account/avatar/00/29/57/61/369a609c.jpg","comment_is_top":false,"comment_ctime":1642079393,"is_pvip":false,"replies":[{"id":"120671","content":"å…¶å®è¿™é‡Œéœ€è¦ç†è§£Shuffleçš„è¿‡ç¨‹å“ˆ~ è€å¼Ÿå¯ä»¥å…³æ³¨åé¢Shuffleçš„éƒ¨åˆ†ã€‚<br>1ï¼‰dagè§£æï¼Œæ‹†åˆ†stagesï¼Œåˆ†å‘tasksï¼Œè¿™äº›å…¨éƒ¨ç”±driveræ¥åšï¼Œå¦‚ä½ æ‰€è¨€ï¼ŒExecutorsåªè´Ÿè´£è®¡ç®—ï¼Œ<br>2ï¼‰åœ¨ä¸€ä¸ªstageå†…éƒ¨ï¼Œå„ä¸ªExecutorsç¡®å®ä»…ä»…æ˜¯åšå¥½è‡ªå·±çš„åˆ†å†…äº‹ï¼Œå¤§å®¶ä¸“æ³¨åœ°æ‰§è¡Œè‡ªå·±çš„ä»»åŠ¡<br>3ï¼‰ä½†æ˜¯ï¼Œåœ¨shuffleé˜¶æ®µï¼Œæ‰€æœ‰Executorsï¼Œéƒ½éœ€è¦è·¨èŠ‚ç‚¹ï¼Œå»è®¿é—®å…¶ä»–æ‰€æœ‰Executorsçš„shuffleä¸­é—´æ–‡ä»¶ï¼Œè¿™éƒ¨åˆ†æˆ‘ä»¬åœ¨shuffleä¼šè®²ã€‚è€Œshuffleä¸­é—´æ–‡ä»¶ï¼Œæ˜¯å­˜å‚¨åœ¨spark.local.dirè¿™ä¸ªé…ç½®é¡¹æ‰€é…ç½®çš„æœ¬åœ°ç›®å½•çš„ã€‚ä¹Ÿå°±æ˜¯æ¯ä¸ªExecutorséƒ½çŸ¥é“ï¼Œå»å„ä¸ªèŠ‚ç‚¹çš„è¿™ä¸ªç›®å½•ä¸‹é¢å»æ‰¾ã€‚è‡³äºè¯´ï¼Œæ¯ä¸ªExecutorsæ€ä¹ˆçŸ¥é“è¯¥è·å–æ•°æ®çš„å“ªéƒ¨åˆ†ï¼Œè¿™å°±è¿˜è¦è¯´å›shuffleä¸­é—´æ–‡ä»¶ï¼Œå®ƒåŒ…å«dataå’Œindexä¸¤éƒ¨åˆ†ï¼Œindexä¼šæ ‡è®°ï¼Œæ¯ä¸ªreduce taskå»è·å–å“ªéƒ¨åˆ†æ•°æ®ã€‚<br>æ€»çš„æ¥è¯´ï¼Œè€å¼Ÿçš„é—®é¢˜ï¼Œå®é™…ä¸Šæ˜¯å…³äºshuffleçš„ï¼Œå¯ä»¥ç‰¹åˆ«å»å…³æ³¨é‚£ä¸€partå“ˆ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1043100","ctime":1642257108,"ip_address":"","comment_id":330635,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10232013985","product_id":100090001,"comment_content":"æ•°æ®äº¤æ¢ä¹‹åï¼Œæ‰€æœ‰ç›¸åŒçš„å•è¯éƒ½åˆ†å‘åˆ°äº†ç›¸åŒçš„ Executors ä¸Šå»ï¼›<br>è€å¸ˆè¿™é‡Œæˆ‘æœ‰ä¸ªé—®é¢˜åœ¨ä»»åŠ¡æ‰§è¡Œçš„æ—¶å€™executorä¹‹é—´è¿˜ä¼šè¿›è¡Œé€šä¿¡å˜›ï¼Ÿ<br>ä»»åŠ¡åˆ†å‘å®Œæˆä¹‹åæ¯ä¸€ä¸ªexecutorä¸å°±æ˜¯æŒ‰éƒ¨å°±ç­çš„æ‰§è¡Œè‡ªå·±çš„ä»»åŠ¡å˜›ï¼Ÿæˆ‘ä¸éœ€è¦å»æ‹‰å–åˆ«çš„executorä¸­çš„æ•°æ®æˆ‘åªéœ€è¦è®¡ç®—æˆ‘è‡ªå·±çš„å°±å¥½ï¼Œèšåˆ çš„æ—¶å€™ç”±driveræ¥å®Œæˆå°±å¥½ï¼ˆä¸è¿‡è¿™ç‚¹ä¹Ÿè¯´ä¸è¿‡å»å› ä¸ºdriverä¸è´Ÿè´£è®¡ç®—ï¼‰<br>ç–‘æƒ‘ç‚¹å°±æ˜¯executoræ€ä¹ˆé€šè¿‡dagæ¥è®©æ¯ä¸ªexecutorå»ä¸åŒçš„executorä¸Šæ‹‰å–æ•°æ®ï¼Ÿæ¯ä¸ªexecutoræ˜¯å¦‚ä½•æ„ŸçŸ¥ä¹‹å‰çš„stageç”Ÿæˆçš„æ•°æ®éƒ½å­˜åœ¨å“ªé‡Œï¼Ÿï¼ˆç›¸åŒçš„å•è¯ï¼‰éš¾ä¸æˆå¤„ç†å®Œå‰ä¸€ä¸ªstageåexecutorä¼šåƒdriveræŠ¥é“æˆ‘æœ¬æ¬¡å¤„ç†å®Œçš„æ•°æ®æ”¾åœ¨å“ªé‡Œ<br>éº»çƒ¦è€å¸ˆç»™è§£ç­”ä¸€ä¸‹ï¼Œæˆ–æ˜¯æä¾›ä¸ªå¼•å­æˆ‘å»è¿½ä¸€ä¸‹sparkæºç <br>æ„Ÿè°¢è€å¸ˆï¼","like_count":3,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546254,"discussion_content":"å…¶å®è¿™é‡Œéœ€è¦ç†è§£Shuffleçš„è¿‡ç¨‹å“ˆ~ è€å¼Ÿå¯ä»¥å…³æ³¨åé¢Shuffleçš„éƒ¨åˆ†ã€‚\n1ï¼‰dagè§£æï¼Œæ‹†åˆ†stagesï¼Œåˆ†å‘tasksï¼Œè¿™äº›å…¨éƒ¨ç”±driveræ¥åšï¼Œå¦‚ä½ æ‰€è¨€ï¼ŒExecutorsåªè´Ÿè´£è®¡ç®—ï¼Œ\n2ï¼‰åœ¨ä¸€ä¸ªstageå†…éƒ¨ï¼Œå„ä¸ªExecutorsç¡®å®ä»…ä»…æ˜¯åšå¥½è‡ªå·±çš„åˆ†å†…äº‹ï¼Œå¤§å®¶ä¸“æ³¨åœ°æ‰§è¡Œè‡ªå·±çš„ä»»åŠ¡\n3ï¼‰ä½†æ˜¯ï¼Œåœ¨shuffleé˜¶æ®µï¼Œæ‰€æœ‰Executorsï¼Œéƒ½éœ€è¦è·¨èŠ‚ç‚¹ï¼Œå»è®¿é—®å…¶ä»–æ‰€æœ‰Executorsçš„shuffleä¸­é—´æ–‡ä»¶ï¼Œè¿™éƒ¨åˆ†æˆ‘ä»¬åœ¨shuffleä¼šè®²ã€‚è€Œshuffleä¸­é—´æ–‡ä»¶ï¼Œæ˜¯å­˜å‚¨åœ¨spark.local.dirè¿™ä¸ªé…ç½®é¡¹æ‰€é…ç½®çš„æœ¬åœ°ç›®å½•çš„ã€‚ä¹Ÿå°±æ˜¯æ¯ä¸ªExecutorséƒ½çŸ¥é“ï¼Œå»å„ä¸ªèŠ‚ç‚¹çš„è¿™ä¸ªç›®å½•ä¸‹é¢å»æ‰¾ã€‚è‡³äºè¯´ï¼Œæ¯ä¸ªExecutorsæ€ä¹ˆçŸ¥é“è¯¥è·å–æ•°æ®çš„å“ªéƒ¨åˆ†ï¼Œè¿™å°±è¿˜è¦è¯´å›shuffleä¸­é—´æ–‡ä»¶ï¼Œå®ƒåŒ…å«dataå’Œindexä¸¤éƒ¨åˆ†ï¼Œindexä¼šæ ‡è®°ï¼Œæ¯ä¸ªreduce taskå»è·å–å“ªéƒ¨åˆ†æ•°æ®ã€‚\næ€»çš„æ¥è¯´ï¼Œè€å¼Ÿçš„é—®é¢˜ï¼Œå®é™…ä¸Šæ˜¯å…³äºshuffleçš„ï¼Œå¯ä»¥ç‰¹åˆ«å»å…³æ³¨é‚£ä¸€partå“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642257108,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":351524,"user_name":"DeanWinchester","can_delete":false,"product_type":"c1","uid":2277187,"ip_address":"","ucode":"10E08D227FEB4B","user_header":"https://static001.geekbang.org/account/avatar/00/22/bf/43/05571148.jpg","comment_is_top":false,"comment_ctime":1657864112,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5952831408","product_id":100090001,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæ‚¨æåˆ°æ¯ä¸ªExecutoråªè´Ÿè´£ä¸€ä¸ªæ•°æ®åˆ†ç‰‡ï¼Œé‚£å¦‚æœæ•°æ®åˆ†ç‰‡æ€»æ•°å¤§äºExecutorä¸ªæ•°æ—¶ï¼Œæ¯ä¸ªExecutorä¼šæ€ä¹ˆæ‰§è¡Œå‘€ï¼Ÿ<br>æˆ‘çŒœå¯èƒ½æ˜¯æ¯ä¸ªExecutor â€˜è´Ÿè´£â€™å¤šä¸ªæ•°æ®åˆ†ç‰‡ï¼Œç„¶åè‡ªå·±åˆ‡æ¢ä¸åŒçš„åˆ†ç‰‡æ‰§è¡Œå—ï¼Ÿ<br>è¾›è‹¦è€å¸ˆè§£ç­”å•¦","like_count":0},{"had_liked":false,"id":322117,"user_name":"å´”å°è±ª","can_delete":false,"product_type":"c1","uid":2604437,"ip_address":"","ucode":"ABB59CE5209E67","user_header":"https://static001.geekbang.org/account/avatar/00/27/bd/95/e923a332.jpg","comment_is_top":false,"comment_ctime":1637196230,"is_pvip":false,"replies":[{"id":"117223","content":"æ„Ÿè°¢è€å¼Ÿæä¾›çš„å»ºè®®~ å’Œã€Šå…¥é—¨ç¯‡ã€‹é…å¥—ï¼Œè¿˜æœ‰ä¸€ä¸ªã€Šè°ƒä¼˜ç¯‡ã€‹ï¼šSparkæ€§èƒ½è°ƒä¼˜å®æˆ˜ï¼Œé‚£é—¨è¯¾é‡Œé¢æ›´é’ˆå¯¹æ€§èƒ½ä¼˜åŒ–ä¸€äº›ï¼Œé‡Œé¢çš„æ¡ˆä¾‹ä¹Ÿæ›´ä¸°å¯Œï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯è€å¼Ÿæƒ³è¦çš„å†…å®¹~","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1043100","ctime":1637654143,"ip_address":"","comment_id":322117,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5932163526","product_id":100090001,"comment_content":"åˆ†äº«çš„ç»éªŒï¼šå·¥ä½œåä¸€å¼€å§‹æ¥è§¦åˆ†å¸ƒå¼è®¡ç®—æ—¶ï¼Œç›´æ¥ä¸Šæ‰‹çš„å°±æ˜¯åœ¨ Azure&#47;AWS&#47;GCP åˆ©ç”¨ DataBricks è¿›è¡Œæ•°æ®åˆ†æå¤„ç†å’Œå»ºæ¨¡ï¼Œæ„Ÿè§‰è‡ªå·±ç›´æ¥è·³è¿‡äº†å¾ˆå¤šå…³äº Spark åŸºç¡€çš„ä¸œè¥¿ï¼Œå…³äºå¦‚ä½•éƒ¨ç½²Sparkç³»ç»Ÿæ›´æ˜¯æ²¡æœ‰åŠ¨æ‰‹ç»éªŒï¼Œå¹³æ—¶å°±æ˜¯ Create Cluster ç„¶åä¸€è·¯ç‚¹ä¸‹å»ï¼Œæˆ–å¯åŠ¨ä¹‹å‰é…ç½®å¥½çš„ Clusterï¼Œé‡åˆ°é—¨æ§›ç›´æ¥æ‰¾ IT æˆ– DataBricks çš„æŠ€æœ¯æœåŠ¡å°±è§£å†³äº†ã€‚ä¸çŸ¥é“ä¼šä¸ä¼šå½±å“è‡ªå·±æœªæ¥æŠ€æœ¯ç§¯ç´¯å’Œäº‹ä¸šå‘å±•â€¦â€¦å¿ƒé‡Œå°å°æ…Œå¼ ä¸€ä¸‹ï¼Œä¸è¿‡ç›®å‰å¤§æ¦‚æ˜¯çŸ¥é“æ€ä¹ˆä¸ªæµç¨‹äº†ï¼Œä¸æ˜¯é‚£ä¹ˆæ…Œäº†ã€‚<br>åœ¨æˆ‘çœ‹æ¥è¿™ä¸ªâ€œé›¶åŸºç¡€â€å…¥é—¨Sparkå…¶å®ä¸æ˜¯å¾ˆé›¶åŸºç¡€ï½è¿˜æ˜¯æœ‰ä¸€å®šçš„é—¨æ§›çš„ã€‚<br>å´è€å¸ˆèƒ½å¦è€ƒè™‘ç¨åå‡ºä¸€ä¸ªåŸºäºSparké¡¹ç›®å®æˆ˜æŠ€æœ¯çš„æ•™ç¨‹ï¼Œé…ä¸Šè¾…åŠ©çš„ä»£ç å’Œæ•™ç¨‹ï¼Œè¿™æ ·å’Œè¿™ä¸ªåŸºç¡€å…¥é—¨ç»“åˆèµ·æ¥ä¼šæ›´å—æ¬¢è¿çš„ï¼","like_count":2,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":532615,"discussion_content":"æ„Ÿè°¢è€å¼Ÿæä¾›çš„å»ºè®®~ å’Œã€Šå…¥é—¨ç¯‡ã€‹é…å¥—ï¼Œè¿˜æœ‰ä¸€ä¸ªã€Šè°ƒä¼˜ç¯‡ã€‹ï¼šSparkæ€§èƒ½è°ƒä¼˜å®æˆ˜ï¼Œé‚£é—¨è¯¾é‡Œé¢æ›´é’ˆå¯¹æ€§èƒ½ä¼˜åŒ–ä¸€äº›ï¼Œé‡Œé¢çš„æ¡ˆä¾‹ä¹Ÿæ›´ä¸°å¯Œï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯è€å¼Ÿæƒ³è¦çš„å†…å®¹~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637654143,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312773,"user_name":"é’±é¹ Allen","can_delete":false,"product_type":"c1","uid":2518863,"ip_address":"","ucode":"7E95E82C0717DA","user_header":"https://static001.geekbang.org/account/avatar/00/26/6f/4f/3cf1e9c4.jpg","comment_is_top":false,"comment_ctime":1631980727,"is_pvip":true,"replies":[{"id":"113345","content":"æ„Ÿè°¢è€å¼Ÿçš„è®¤å¯~ å—¯å—¯ï¼Œåé¢ç»§ç»­åŠ æ²¹~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1632052138,"ip_address":"","comment_id":312773,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5926948023","product_id":100090001,"comment_content":"å´è€å¸ˆçš„è¿›ç¨‹æ¨¡å‹è®²å¾—æ˜“äºç†è§£ï¼Œ<br>å„ç§RDDçš„ç®—å­è®¡ç®—ï¼Œæˆ‘ä»¬å¸¦å…¥åˆ°æ—¥å¸¸çš„ç”Ÿæ´»åœºæ™¯é‡Œå»ç†è§£ã€‚Driverå’ŒExecutorï¼ŒåŒ…å·¥å¤´å’Œå·¥äººçš„æ¯”å–»ã€‚  <br>æœŸå¾…è€å¸ˆçš„åç»­è¯¾ç¨‹~","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527107,"discussion_content":"æ„Ÿè°¢è€å¼Ÿçš„è®¤å¯~ å—¯å—¯ï¼Œåé¢ç»§ç»­åŠ æ²¹~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632052138,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":350719,"user_name":"Ty","can_delete":false,"product_type":"c1","uid":2768574,"ip_address":"","ucode":"00865C19F67646","user_header":"https://static001.geekbang.org/account/avatar/00/2a/3e/be/f7bc225d.jpg","comment_is_top":false,"comment_ctime":1657117158,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1657117158","product_id":100090001,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæƒ³è¯·é—®ä¸‹reduceByKeyä¸æ˜¯åº”è¯¥å…ˆåœ¨å„ä¸ªåˆ†åŒºå†…éƒ¨å…ˆè¿›è¡Œä¸€æ¬¡èšåˆå†è¿›è¡Œshuffleæ“ä½œå—ï¼Ÿä¸ºä»€ä¹ˆæœ¬æ–‡ä¸­çš„å›¾è§£æ˜¯åœ¨è½¬æˆpairRDD valueä¸º1çš„æ—¶å€™å°±å¼€å§‹å’Œdriveré€šä¿¡äº†å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":346211,"user_name":"Geek_b2839b","can_delete":false,"product_type":"c1","uid":2876299,"ip_address":"","ucode":"6D8ABA989AB724","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIw0Nnvrrt9fV1wHVfBlPzrZmxNCRTbWPfNEbCEMtuoj6gw0LlMbbS3gtRLgLMfCoAV3TXsk5giavw/132","comment_is_top":false,"comment_ctime":1652920145,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1652920145","product_id":100090001,"comment_content":"è€å¸ˆï¼Œå¯¹äºç»Ÿè®¡æ¬¡æ•°ï¼Œå¦‚æœå…ˆä½¿ç”¨groupbyè¿™ä¸ªç®—å­ï¼Œç„¶åå†ä½¿ç”¨èšåˆç®—å­ç»Ÿè®¡æ¬¡æ•°ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­å¦‚æœgroup byç®—å­shuffleåæŸä¸€ä¸ªå•è¯çš„ä¸ªæ•°è¶…è¿‡äº†ä¸€ä¸ªexecutorå†…å­˜çš„æ•°é‡ï¼Œé‚£ä¹ˆåé¢æ€ä¹ˆå»ç»Ÿè®¡æ¬¡æ•°å‘¢","like_count":0,"discussions":[{"author":{"id":1184678,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJDgV2qia6eAL7Fb4egX3odViclRRwOlkfCBrjhU9lLeib90KGkIDjdddSibNVs47N90L36Brgnr6ppiag/132","nickname":"ddww","note":"","ucode":"2871112FC9B3F7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573600,"discussion_content":"ä¸ºä»€ä¹ˆè¦ä¸€æ¬¡æŠŠæ•°æ®åŠ è½½è¿›å»è®¡ç®—å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653537382,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":337993,"user_name":"åº·","can_delete":false,"product_type":"c1","uid":2935703,"ip_address":"","ucode":"4C77322D04DD74","user_header":"https://static001.geekbang.org/account/avatar/00/2c/cb/97/5bbf4d08.jpg","comment_is_top":false,"comment_ctime":1647225348,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1647225348","product_id":100090001,"comment_content":"è€å¸ˆå¥½ï¼Œè¯·æ•™å¦‚ä¸‹å‡ ä¸ªé—®é¢˜ï¼Œéº»çƒ¦æ‚¨å¾—ç©ºè§£ç­”ä¸‹ï¼Œè°¢è°¢ï¼<br>1. Driveråˆ†å‘ä»»åŠ¡æ˜¯ä»¥ä»€ä¹ˆå½¢å¼è¿›è¡Œçš„ï¼Œæ˜¯æŠŠç”¨æˆ·å†™çš„JAVAç¨‹åºç¼–è¯‘åï¼Œæ¯ä¸ªstageéƒ½å¯¹åº”ä¸€æ®µç¼–è¯‘åçš„ä»£ç ï¼Œæ¯æ¬¡åˆ†å‘ä»»åŠ¡å°±æ˜¯æŠŠè¿™ä¸€æ®µç¼–è¯‘åçš„ä»£ç åˆ†å‘ç»™Executorï¼Ÿ<br><br>2. é‡åˆ°æœ‰Shuffleçš„ç®—å­æ¯”å¦‚reduceByï¼Œåº•å±‚æ˜¯ä¼šæ‹†åˆ†ç»™ä¸¤ä¸ªå‡½æ•°å—ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°åˆ†åˆ«å¯¹åº”ä¸¤ä¸ªStageä¸­ ,å‰ä¸€ä¸ªå‡½æ•°ç”¨äºåœ¨åŒä¸€ä¸ªExecutoråšèšåˆï¼Œåä¸€ä¸ªå‡½æ•°è¿›è¡Œè·¨Executoræ•°æ®èšåˆï¼Ÿ<br><br>3. åœ¨æ•´ä¸ªjobæ‰§è¡Œä¸­ï¼ŒExecutorçš„æ•°é‡ä¼šå‘ç”Ÿå˜åŒ–å—ï¼Œæ¯”å¦‚åœ¨Word Countä¾‹å­ä¸­ï¼Œä¸€å¼€å§‹åˆ†é…äº†3ä¸ªExecutorï¼Œæœ€åæ‰§è¡Œç»Ÿè®¡çš„æ—¶å€™ï¼Œå¯èƒ½åªæœ‰ä¸¤ä¸ªå•è¯ï¼Œç†è®ºä¸Šæ¥è¯´ï¼Œåªéœ€è¦ä¸¤ä¸ªExecutorå°±å¤Ÿäº†","like_count":0},{"had_liked":false,"id":337558,"user_name":"ç©ºde","can_delete":false,"product_type":"c1","uid":1202258,"ip_address":"","ucode":"DF59457D5932A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/58/52/f35f5265.jpg","comment_is_top":false,"comment_ctime":1646893178,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1646893178","product_id":100090001,"comment_content":"è¯·é—®åœ¨å®é™…åº”ç”¨ä¸­ï¼Œ æ•°æ®åˆ†ç‰‡æ•°é‡æ˜¯å’ŒExecutorsæ•°é‡ä¸€è‡´å—ï¼Œè¿˜æ˜¯å¯ä»¥è‡ªç”±åˆ†é…åˆ†ç‰‡æ•°é‡ï¼Ÿ","like_count":0},{"had_liked":false,"id":331223,"user_name":"ä¸€æœŸä¸€ä¼š","can_delete":false,"product_type":"c1","uid":1043780,"ip_address":"","ucode":"1C44A6453F6381","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ed/44/2267a5a7.jpg","comment_is_top":false,"comment_ctime":1642490828,"is_pvip":true,"replies":[{"id":"121202","content":"å¥½é—®é¢˜ï¼ŒsortByKeyå…¶å®æ˜¯å…ˆshuffleï¼Œç„¶åå†merge sortï¼Œä¹Ÿå°±æ˜¯ï¼š<br>1ï¼‰Executorså±€éƒ¨sort<br>2ï¼‰ç”¨merge sortæŒ‘é€‰å‡ºå‰5ä¸ª<br>å…ˆshuffleï¼Œå…¶å®å°±ä¿è¯äº†keyä¸€æ ·çš„recordsï¼Œè¢«shuffleåˆ°åŒä¸€èŠ‚ç‚¹ï¼Œè¿™æ ·å…¨å±€å†åšsortçš„æ—¶å€™ï¼Œå°±ä¸ä¼šå‡ºç°ä½ è¯´çš„å±€éƒ¨ä¸å…¨å±€ä¸ä¸€è‡´çš„æƒ…å†µ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1043100","ctime":1642779440,"ip_address":"","comment_id":331223,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1642490828","product_id":100090001,"comment_content":"æœ‰ä¸ªé—®é¢˜éº»çƒ¦è€å¸ˆå›ç­”ï¼šåœ¨å’±ä»¬çš„word countç¤ºä¾‹ä¸­çš„take(5)å‰é¢è¿è¡Œäº†sortByKey(false)ï¼Œ é‚£æ˜¯ä¸æ˜¯å„åˆ†åŒºåœ¨åˆ†åŒºå†…éƒ¨åšäº†æ’åºï¼Œè€Œä¸æ˜¯æ‰€æœ‰åˆ†åŒºè¿›è¡Œäº†å½’å¹¶æ’åºå‘¢ï¼Ÿç„¶åtake(5)å°±æ˜¯è¿”å›å„åˆ†åŒºä¸­å–æ’åºå‰å‡ ä¸ªçš„ï¼Œæœ€åå‡‘å‡ºæ¥5ä¸ªç»“æœå‘¢ï¼Ÿä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå„åˆ†åŒºè‡ªå·±æ’åºç„¶åç»™å‡ºç»“æœå¹¶æ±‡æ€»ï¼Œé‚£take(5)çš„ç»“æœï¼Œå¹¶ä¸ä¸€å®šæ˜¯å…¨å±€ä¸­å‡ºç°é¢‘ç‡æœ€é«˜çš„5ä¸ªå•è¯ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":547646,"discussion_content":"å¥½é—®é¢˜ï¼ŒsortByKeyå…¶å®æ˜¯å…ˆshuffleï¼Œç„¶åå†merge sortï¼Œä¹Ÿå°±æ˜¯ï¼š\n1ï¼‰Executorså±€éƒ¨sort\n2ï¼‰ç”¨merge sortæŒ‘é€‰å‡ºå‰5ä¸ª\nå…ˆshuffleï¼Œå…¶å®å°±ä¿è¯äº†keyä¸€æ ·çš„recordsï¼Œè¢«shuffleåˆ°åŒä¸€èŠ‚ç‚¹ï¼Œè¿™æ ·å…¨å±€å†åšsortçš„æ—¶å€™ï¼Œå°±ä¸ä¼šå‡ºç°ä½ è¯´çš„å±€éƒ¨ä¸å…¨å±€ä¸ä¸€è‡´çš„æƒ…å†µ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1642779440,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":322913,"user_name":"å´”å°è±ª","can_delete":false,"product_type":"c1","uid":2604437,"ip_address":"","ucode":"ABB59CE5209E67","user_header":"https://static001.geekbang.org/account/avatar/00/27/bd/95/e923a332.jpg","comment_is_top":false,"comment_ctime":1637657490,"is_pvip":false,"replies":[{"id":"117436","content":"Exception in thread &quot;main&quot; org.apache.spark.SparkException: Master must either be yarn or start with spark, mesos, k8s, or localã€‚<br><br>ä»æŠ¥é”™æ¥çœ‹ï¼ŒMasteræ²¡æœ‰è®¾ç½®å¥½ï¼Œè€å¼Ÿçœ‹ä¸‹Masterçš„spark-defaults.confæ–‡ä»¶ï¼Œå¯ä»¥æŠŠæ–‡ä»¶å†…å®¹è´´å‡ºæ¥ï¼Œä¸€èµ·çœ‹çœ‹ï¼Œæˆ–è€…ä½ åŠ æˆ‘å¾®ä¿¡ä¹Ÿè¡Œï¼Œâ€œæ–¹å—Kâ€æˆ–è€…â€œrJuniorâ€ã€‚ç¯å¢ƒçš„é…ç½®ç¡®å®æ¯”è¾ƒéº»çƒ¦ï¼Œå“ªä¸€æ­¥ç¨æœ‰ä¸å¯¹ï¼Œå¯èƒ½å°±è·‘ä¸èµ·æ¥ï¼ŒåŠ å¾®ä¿¡ä¸€èµ·çœ‹çœ‹å§ã€‚<br><br>ç¡®è®¤ä¸‹ï¼Œæ— å¯†ç SSHæ²¡é—®é¢˜æ˜¯å§ï¼Ÿä¸åŒèŠ‚ç‚¹jpsä¸€ä¸‹ï¼Œçœ‹çœ‹Masterå’ŒWorkeræ˜¯ä¸æ˜¯æˆåŠŸå¯åŠ¨äº†ï¼Œå†æœ‰ï¼Œç”¨spark-shell --master spark:&#47;&#47;node0:7077ï¼Œè¯•ä¸€ä¸‹Masteræ˜¯ä¸æ˜¯readyçš„ï¼Œå…ˆçœ‹çœ‹spark-shellèƒ½ä¸èƒ½èµ·æ¥","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1043100","ctime":1638067268,"ip_address":"","comment_id":322913,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1637657490","product_id":100090001,"comment_content":"å´è€å¸ˆèƒ½å¦å‡ºä¸€ä¸ªæ›´ä¸ºè¯¦ç»†ä¸€ç‚¹çš„sparkåœ¨AWS EC2ä¸Šéƒ¨ç½²çš„noteï¼Œæˆ‘åœ¨AWSä¸Šå°è¯•äº†ä¸€é, é€‰çš„ä¹Ÿæ˜¯centOS7ï¼Œæœ€å¥½å¥½ä¸å®¹æ˜“æŠŠç¯å¢ƒè®¾ç½®å¥½äº†ï¼Œåœ¨è¿è¡Œæœ€åä¸€ä¸ªä¾‹å­æ—¶ï¼Œ åˆå‡ºç°äº†ä¸€ä¸ªbugå¦‚ä¸‹ã€‚æœ¬äººéITéœ€è¦æ‰‹æŠŠæ‰‹çš„å¸¦ä¸€éã€‚<br><br>[centos@ip-172-31-40-xxxx spark_latest]$ MASTER=spark:&#47;&#47;node0:7077 $SPARK_HOME&#47;bin&#47;run-example org.apache.spark.examples.SparkPi<br>WARNING: An illegal reflective access operation has occurred<br>WARNING: Illegal reflective access by org.apache.spark.unsafe.Platform (file:&#47;opt&#47;spark&#47;spark-3.1.2-bin-hadoop3.2&#47;jars&#47;spark-unsafe_2.12-3.1.2.jar) to constructor java.nio.DirectByteBuffer(long,int)<br>WARNING: Please consider reporting this to the maintainers of org.apache.spark.unsafe.Platform<br>WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations<br>WARNING: All illegal access operations will be denied in a future release<br>Exception in thread &quot;main&quot; org.apache.spark.SparkException: Master must either be yarn or start with spark, mesos, k8s, or local<br>","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":533999,"discussion_content":"Exception in thread &#34;main&#34; org.apache.spark.SparkException: Master must either be yarn or start with spark, mesos, k8s, or localã€‚\n\nä»æŠ¥é”™æ¥çœ‹ï¼ŒMasteræ²¡æœ‰è®¾ç½®å¥½ï¼Œè€å¼Ÿçœ‹ä¸‹Masterçš„spark-defaults.confæ–‡ä»¶ï¼Œå¯ä»¥æŠŠæ–‡ä»¶å†…å®¹è´´å‡ºæ¥ï¼Œä¸€èµ·çœ‹çœ‹ï¼Œæˆ–è€…ä½ åŠ æˆ‘å¾®ä¿¡ä¹Ÿè¡Œï¼Œâ€œæ–¹å—Kâ€æˆ–è€…â€œrJuniorâ€ã€‚ç¯å¢ƒçš„é…ç½®ç¡®å®æ¯”è¾ƒéº»çƒ¦ï¼Œå“ªä¸€æ­¥ç¨æœ‰ä¸å¯¹ï¼Œå¯èƒ½å°±è·‘ä¸èµ·æ¥ï¼ŒåŠ å¾®ä¿¡ä¸€èµ·çœ‹çœ‹å§ã€‚\n\nç¡®è®¤ä¸‹ï¼Œæ— å¯†ç SSHæ²¡é—®é¢˜æ˜¯å§ï¼Ÿä¸åŒèŠ‚ç‚¹jpsä¸€ä¸‹ï¼Œçœ‹çœ‹Masterå’ŒWorkeræ˜¯ä¸æ˜¯æˆåŠŸå¯åŠ¨äº†ï¼Œå†æœ‰ï¼Œç”¨spark-shell --master spark://node0:7077ï¼Œè¯•ä¸€ä¸‹Masteræ˜¯ä¸æ˜¯readyçš„ï¼Œå…ˆçœ‹çœ‹spark-shellèƒ½ä¸èƒ½èµ·æ¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638067268,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":322126,"user_name":"çŒ«å¤ªå¤ª","can_delete":false,"product_type":"c1","uid":1537617,"ip_address":"","ucode":"7A1D1CAA3AF260","user_header":"https://static001.geekbang.org/account/avatar/00/17/76/51/96291466.jpg","comment_is_top":false,"comment_ctime":1637199550,"is_pvip":false,"replies":[{"id":"117222","content":"ä¼ªåˆ†å¸ƒå¼éƒ¨ç½²çš„è¯ï¼Œå¯ä»¥ç”¨ä¸€å°èŠ‚ç‚¹çš„å¤šä¸ªè™šæ‹Ÿæœºæ­å»ºã€‚çœŸæ­£çš„åˆ†å¸ƒå¼çš„è¯ï¼Œè¿˜æ˜¯éœ€è¦å¤šå°ç‰©ç†èŠ‚ç‚¹çš„ï¼Œæˆ–è€…ä¸åŒç‰©ç†èŠ‚ç‚¹ä¸Šé¢çš„è™šæ‹Ÿæœº","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1043100","ctime":1637653944,"ip_address":"","comment_id":322126,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1637199550","product_id":100090001,"comment_content":"è¯·é—®åœ¨è‡ªå·±æœºå™¨ä¸Šè£…äº†ä¸€ä¸ªUbuntoçš„è™šæ‹Ÿæœºï¼Œå¦‚ä½•å®Œæˆsparkçš„åˆ†å¸ƒå¼éƒ¨ç½²","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":532613,"discussion_content":"ä¼ªåˆ†å¸ƒå¼éƒ¨ç½²çš„è¯ï¼Œå¯ä»¥ç”¨ä¸€å°èŠ‚ç‚¹çš„å¤šä¸ªè™šæ‹Ÿæœºæ­å»ºã€‚çœŸæ­£çš„åˆ†å¸ƒå¼çš„è¯ï¼Œè¿˜æ˜¯éœ€è¦å¤šå°ç‰©ç†èŠ‚ç‚¹çš„ï¼Œæˆ–è€…ä¸åŒç‰©ç†èŠ‚ç‚¹ä¸Šé¢çš„è™šæ‹Ÿæœº","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637653944,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":316344,"user_name":"welldo","can_delete":false,"product_type":"c1","uid":1598796,"ip_address":"","ucode":"D38E75364CD2E3","user_header":"https://static001.geekbang.org/account/avatar/00/18/65/4c/f7f86496.jpg","comment_is_top":false,"comment_ctime":1634279658,"is_pvip":false,"replies":[{"id":"114582","content":"Executorså°±æ˜¯JVMè¿›ç¨‹å“ˆï¼Œä¸€ä¸ªè®¡ç®—èŠ‚ç‚¹ï¼Œå½“ç„¶æ˜¯å¯ä»¥å¯åŠ¨å¤šä¸ªè¿›ç¨‹çš„~ <br><br>æˆ‘ä¸€ç›´ä»¥ä¸ºâ€œèŠ‚ç‚¹=executorâ€ï¼Œè¿™ä¸ªæ˜¯ä¸å¯¹çš„å“ˆ~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1634292067,"ip_address":"","comment_id":316344,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1634279658","product_id":100090001,"comment_content":"è€å¸ˆï¼Œ<br>å›¾ç‰‡â€œDriverä¸Executorsï¼šSparkè¿›ç¨‹æ¨¡å‹â€é‡Œï¼Œ<br>ä¸€ä¸ªèŠ‚ç‚¹é‡Œæœ‰ä¸¤ä¸ªexecutorï¼Œè¿™æ˜¯å•¥æ„æ€å‘¢ï¼Ÿ<br>æˆ‘ä¸€ç›´ä»¥ä¸ºâ€œèŠ‚ç‚¹=executorâ€","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528361,"discussion_content":"Executorså°±æ˜¯JVMè¿›ç¨‹å“ˆï¼Œä¸€ä¸ªè®¡ç®—èŠ‚ç‚¹ï¼Œå½“ç„¶æ˜¯å¯ä»¥å¯åŠ¨å¤šä¸ªè¿›ç¨‹çš„~ \n\næˆ‘ä¸€ç›´ä»¥ä¸ºâ€œèŠ‚ç‚¹=executorâ€ï¼Œè¿™ä¸ªæ˜¯ä¸å¯¹çš„å“ˆ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634292067,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":313794,"user_name":"å­å…®","can_delete":false,"product_type":"c1","uid":2767208,"ip_address":"","ucode":"BA213EAB26DF16","user_header":"https://static001.geekbang.org/account/avatar/00/2a/39/68/56dfc8c0.jpg","comment_is_top":false,"comment_ctime":1632668183,"is_pvip":false,"replies":[{"id":"113763","content":"æ˜¯çš„ï¼Œåˆ†ç‰‡å¯¹åº”çš„æ˜¯cpu coreï½<br>åˆ†ç‰‡ã€åˆ†åŒºã€taskã€coreï¼Œä¸€ä¸€å¯¹åº”","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1632830826,"ip_address":"","comment_id":313794,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1632668183","product_id":100090001,"comment_content":"è€å¸ˆï¼Œè¯·é—®æ¯ä¸ªæ•°æ®åˆ†ç‰‡ä¹Ÿå°±æ˜¯partitionçš„æ‰§è¡Œå•å…ƒä¸æ˜¯coreå˜›ï¼Ÿä¸ºä»€ä¹ˆè¯´æ˜¯excutorå‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527475,"discussion_content":"æ˜¯çš„ï¼Œåˆ†ç‰‡å¯¹åº”çš„æ˜¯cpu coreï½\nåˆ†ç‰‡ã€åˆ†åŒºã€taskã€coreï¼Œä¸€ä¸€å¯¹åº”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632830826,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312638,"user_name":"Alvin-L","can_delete":false,"product_type":"c1","uid":1603052,"ip_address":"","ucode":"5AC96AAB75B720","user_header":"https://static001.geekbang.org/account/avatar/00/18/75/ec/c60b29f5.jpg","comment_is_top":false,"comment_ctime":1631922256,"is_pvip":false,"replies":[{"id":"113276","content":"å®¢æ°”å…„å¼Ÿ~ <br><br>å—¯å—¯ï¼Œåé¢è¿˜ä¼šæœ‰æ›´å¤šæ•…äº‹çš„~ åŸºæœ¬ä¸Šæ¶‰åŠåˆ°åŸç†çš„éƒ¨åˆ†ï¼Œéƒ½ä¼šæœ‰æ•…äº‹","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1631932649,"ip_address":"","comment_id":312638,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1631922256","product_id":100090001,"comment_content":"å¤šè°¢è€å¸ˆï¼Œå¸Œæœ›ä»¥åéƒ½èƒ½æœ‰ç±»ä¼¼è–¯ç‰‡è¿™æ ·çš„å½¢è±¡ä¾‹å­ï¼Œå¸®åŠ©æ–°æ‰‹ç†è§£é‡Œé¢å„ç§å¬ä¸æ‡‚çš„æŠ½è±¡æ¦‚å¿µ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527059,"discussion_content":"å®¢æ°”å…„å¼Ÿ~ \n\nå—¯å—¯ï¼Œåé¢è¿˜ä¼šæœ‰æ›´å¤šæ•…äº‹çš„~ åŸºæœ¬ä¸Šæ¶‰åŠåˆ°åŸç†çš„éƒ¨åˆ†ï¼Œéƒ½ä¼šæœ‰æ•…äº‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631932649,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}