{"id":532651,"title":"40 | å¦‚ä½•åœ¨ç¼–è¯‘æœŸéå†æ•°æ®ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å´å’ç‚œã€‚</p><p>ä½ è€ƒè™‘è¿‡ <code>tuple</code> å’Œæ™®é€šçš„ç»“æ„ä½“å­˜åœ¨å“ªäº›åŒºåˆ«å—ï¼Ÿ</p><p>æ˜¾ç„¶ï¼Œä¸€ä¸ªå­—æ®µæ²¡æœ‰åå­—ï¼Œä¸€ä¸ªå­—æ®µæœ‰åå­—â€”â€”è¿™æ˜¯ä¸€ä¸ªéå¸¸åŸºæœ¬çš„åŒºåˆ«ã€‚</p><p>å…¶ä»–è¿˜æœ‰å—ï¼Ÿ</p><p>æœ‰ã€‚</p><p>å¯¹äº <code>tuple</code>ï¼Œæ ‡å‡† C++ é‡Œæä¾›äº†å¾ˆå¤šæœºåˆ¶ï¼Œå…è®¸ä½ ï¼š</p><ul>\n<li>çŸ¥é“ <code>tuple</code> çš„å¤§å°ï¼ˆæ•°æ®æˆå‘˜æ•°é‡ï¼‰</li>\n<li>é€šè¿‡ä¸€ä¸ªç¼–è¯‘æœŸçš„ç´¢å¼•å€¼ï¼ŒçŸ¥é“æŸä¸ªæ•°æ®æˆå‘˜çš„ç±»å‹</li>\n<li>é€šè¿‡ä¸€ä¸ªç¼–è¯‘æœŸçš„ç´¢å¼•å€¼ï¼Œå¯¹æŸä¸ªæ•°æ®æˆå‘˜è¿›è¡Œè®¿é—®</li>\n</ul><p>åˆ©ç”¨è¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥é¢å¤–åšå¾ˆå¤šäº‹æƒ…ï¼Œæ¯”å¦‚ï¼Œåƒ<a href=\"https://time.geekbang.org/column/article/523170\">ç¬¬ 38 è®²</a>æè¿°çš„é‚£æ ·ï¼Œç”¨ä¸€ä¸ªå‡½æ•°æ¨¡æ¿æ¥è¾“å‡ºæ‰€æœ‰ <code>tuple</code> ç±»å‹å¯¹è±¡çš„å†…å®¹ã€‚è¿™äº›åŠŸèƒ½æ˜¯æ™®é€šç»“æ„ä½“æ‰€æ²¡æœ‰çš„ï¼</p><p>åœ¨ C++ çš„é™æ€åå°„åˆ°æ¥ä¹‹å‰ï¼Œæˆ‘ä»¬æƒ³åœ¨ç»“æ„ä½“é‡Œè¾¾åˆ°ç±»ä¼¼çš„åŠŸèƒ½ï¼Œåªèƒ½è‡ªå·±é€šè¿‡ä¸€äº›ç¼–ç¨‹æŠ€å·§æ¥å®ç°ã€‚æœ¬è®²æˆ‘ä»¬å°±ä¼šä»‹ç»ä¸€ç§æ‰‹å·¥å®ç°é™æ€åå°„çš„æ–¹æ³•ï¼Œèƒ½å¤Ÿè®©ç»“æ„ä½“åœ¨ç”¨èµ·æ¥è·ŸåŸæ¥æ²¡æ„Ÿè§‰æœ‰åŒºåˆ«çš„æƒ…å†µä¸‹ï¼Œé¢å¤–æä¾›ç±»ä¼¼ <code>tuple</code> çš„åŠŸèƒ½ï¼Œç”šè‡³è¿˜æ›´å¤šã€‚æ¯•ç«Ÿï¼Œç»“æ„ä½“é‡Œçš„å­—æ®µæ˜¯æœ‰åå­—çš„ï¼Œå¯ä»¥äº§ç”Ÿæ›´å¯è¯»çš„ä»£ç ã€‚æˆ‘ä»¬è¿˜èƒ½è¿›ä¸€æ­¥åˆ©ç”¨ç¼–è¯‘æœŸçš„å­—ç¬¦ä¸²æ¨¡æ¿å‚æ•°æŠ€å·§ï¼ˆ<a href=\"https://time.geekbang.org/column/article/527423\">ç¬¬ 39 è®²</a>ï¼‰ï¼Œä½¿ç”¨å­—æ®µåç§°è¿™ä¸€æ•°æ®ï¼Œè®©ä¸‹é¢çš„ä»£ç èƒ½é€šè¿‡ç¼–è¯‘ï¼š</p><pre><code class=\"language-cpp\">DEFINE_STRUCT(\n  S1,\n  (int)v1,\n  (bool)v2,\n  (string)msg\n);\n\nDEFINE_STRUCT(\n  S2,\n  (long)v1,\n  (bool)v2\n);\n\nS1 s1{1, false, \"test\"};\nS2 s2;\ncopy_same_name_fields(s1, s2);\n</code></pre><!-- [[[read_end]]] --><p>è¿™æ®µä»£ç åšçš„äº‹æƒ…æ­£æ˜¯ä½ çœ‹åå­—å¯ä»¥æƒ³è±¡çš„ï¼ŒæŠŠ <code>s1</code> ä¸­è·Ÿ <code>s2</code> åŒåçš„å­—æ®µå¤åˆ¶åˆ° <code>s2</code> é‡Œé¢å»ï¼ï¼ˆæ³¨æ„è¿™ä¸æ˜¯ <code>memcpy</code>â€”â€”ä¸¤ä¸ªç»“æ„ä½“é‡ŒåŒåå­—æ®µçš„ç±»å‹å¯ä»¥ä¸åŒï¼Œå®ƒä»¬ä¹Ÿä¸éœ€è¦ç›¸é‚»ã€‚ï¼‰</p><h2>é™æ€åå°„çš„å®šä¹‰</h2><p>é™æ€åå°„çš„åŸºæœ¬åŸç†å’Œå®ç°æ‰‹æ³•ï¼Œåœ¨ç½—èƒ½çš„åšå®¢æ–‡ç« ä¸­å·²ç»æœ‰äº†è¾ƒè¯¦ç»†çš„æè¿° <span class=\"orange\">[1]</span>ã€‚å»ºè®®ä½ å»è¯»ä¸€ä¸‹ã€‚æˆ‘åœ¨è¿™é‡Œå°†ä¸å†é‡å¤å…¶ä¸­çš„ä¸€äº›æŠ€æœ¯ç»†èŠ‚ï¼Œè€Œæ˜¯å¼ºè°ƒåŸºæœ¬åŸç†ï¼Œä»¥åŠæˆ‘è¿™è¾¹å®ç°å¾—ä¸ä¸€æ ·çš„åœ°æ–¹ã€‚</p><h3>å®åŸºç¡€</h3><p>æ–‡ä»¶ metamacro.h ä¸­æä¾›äº†ä¸€äº›åŸºç¡€çš„å®å·¥å…·ï¼Œè¿™è¾¹æˆ‘ç®€å•ä»‹ç»ä¸€ä¸‹å…¶ä¸­ä¸»è¦çš„å‡ ä¸ªåŠŸèƒ½ï¼Œå¯¹å…¶å®ç°ç»†èŠ‚å°±ä¸è¿›è¡Œå±•å¼€äº†ï¼š</p><ul>\n<li><code>GET_ARG_COUNT</code>ï¼šè·å–å®å‚æ•°çš„æ•°é‡ï¼Œå¦‚ <code>GET_ARG_COUNT(a, b, c)</code> å°†å¾—åˆ° <code>3</code></li>\n<li><code>STRING</code>ï¼šæŠŠå‚æ•°å˜æˆå­—ç¬¦ä¸²ï¼Œå¦‚ <code>STRING(foo)</code> å°†å¾—åˆ° <code>\"foo\"</code></li>\n<li><code>PASTE</code>ï¼šæŠŠä¸¤ä¸ªå‚æ•°æ‹¼æ¥èµ·æ¥ï¼Œå¦‚ <code>PASTE(Hello, World)</code> å°†å¾—åˆ° <code>HelloWorld</code></li>\n<li><code>PAIR</code>ï¼šæŠŠ <code>(ç±»å‹)å­—æ®µå</code> è¿™æ ·çš„åºåˆ—è„±å»ç¬¬ä¸€å±‚æ‹¬å·ï¼Œå¦‚ <code>PAIR((long)v1)</code> å°†å¾—åˆ° <code>long v1</code></li>\n<li><code>STRIP</code>ï¼šæŠŠ <code>(ç±»å‹)å­—æ®µå</code> è¿™æ ·çš„åºåˆ—çš„ç±»å‹éƒ¨åˆ†å»æ‰ï¼Œå¦‚ <code>STRIP((long)v1)</code> å°†å¾—åˆ° <code>v1</code></li>\n<li><code>REPEAT_ON</code>ï¼šè¿™æ˜¯ä¸»è¦ç©é‡å¤å±•å¼€çš„åœ°æ–¹ï¼Œå¦‚ <code>REPEAT_ON(func, a, b, c)</code> å°†å¾—åˆ° <code>func(0, a) func(1, b) func(2, c)</code></li>\n</ul><p>æˆ‘ä»¬å¯¹ <code>DEFINE_STRUCT</code> çš„å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-cpp\">#define DEFINE_STRUCT(st, ...)      \\\n  struct st {                       \\\n    template &lt;typename, size_t&gt;     \\\n    struct _field;                  \\\n    static constexpr size_t _size = \\\n      GET_ARG_COUNT(__VA_ARGS__);   \\\n    REPEAT_ON(FIELD, __VA_ARGS__)   \\\n  }\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œå®å±•å¼€åæˆäº† <code>struct st</code> çš„å®šä¹‰ï¼ˆ<code>st</code> æ˜¯ç»“æ„ä½“åï¼‰ï¼Œé‡Œé¢æœ‰ä¸‰éƒ¨åˆ†ï¼š</p><ul>\n<li>é¦–å…ˆï¼Œæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªå« <code>_field</code> çš„åµŒå¥—ç±»æ¨¡æ¿ï¼ŒæŒ‡å®šå®ƒå…·æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªç±»å‹ï¼Œä¸€ä¸ªæ˜¯ <code>size_t</code>ï¼›</li>\n<li>ç„¶åï¼Œæˆ‘ä»¬æ ¹æ®å‚æ•°æ•°é‡ï¼Œç®—å‡ºå­—æ®µæ•°é‡ï¼Œèµ‹ç»™é™æ€ constexpr å˜é‡ <code>_size</code>ï¼›</li>\n<li>æœ€åï¼Œæˆ‘ä»¬åˆ©ç”¨ <code>REPEAT_ON</code> å®ï¼Œæœ‰å¤šå°‘ä¸ªå­—æ®µå°±é‡å¤å¤šå°‘æ¬¡ï¼Œé€é¡¹äº§ç”Ÿå­—æ®µçš„å®šä¹‰ã€‚</li>\n</ul><p>ä»¥æˆ‘ä»¬ä¸Šé¢çš„ <code>S2</code> ä¸ºä¾‹ï¼Œå®å±•å¼€åçš„ç»“æœå¤§è‡´å¦‚ä¸‹ï¼ˆå·²é‡æ–°æ ¼å¼åŒ–ï¼›å¦æ³¨æ„åˆ†å·æ˜¯å®å¤–é¢æ‰‹å·¥æ·»åŠ çš„ï¼‰ï¼š</p><pre><code class=\"language-cpp\">struct S2 {\n  template &lt;typename, size_t&gt;\n  struct _field;\n  static constexpr size_t _size = 2;\n  FIELD(0, (long)v1)\n  FIELD(1, (bool)v2)\n}\n</code></pre><p>ä¸‹é¢ï¼Œæˆ‘ä»¬ä¸»è¦å°±ä¸å†å…³å¿ƒå®çš„é—®é¢˜ï¼Œè€Œæ˜¯å¦‚ä½•åœ¨ç»™å®šç´¢å¼•å€¼çš„æƒ…å†µä¸‹ï¼Œåˆé€‚åœ°äº§ç”Ÿé™æ€åå°„æ‰€éœ€è¦çš„å…¨éƒ¨ä¿¡æ¯å’Œæ–¹æ³•ã€‚</p><p>ä¸è¿‡ï¼Œå…ˆæé†’ä¸€ä¸‹ï¼Œå¦‚æœä½ æŠŠå®æ”¾åˆ°ä¸€ä¸ªä¾›åˆ«äººä½¿ç”¨çš„å…¬å…±åº“çš„è¯ï¼Œä¸€èˆ¬æ‰€æœ‰çš„å®åç§°éƒ½åº”è¯¥åŠ ä¸Šå‰ç¼€ï¼Œä»¥å…è·Ÿå…¶ä»–å®å‘ç”Ÿå†²çªâ€”â€”æ¯•ç«Ÿå®æ˜¯æ²¡æœ‰ä½œç”¨åŸŸçš„ï¼Œä¼šæ±¡æŸ“å…¨å±€åç©ºé—´ã€‚æ¯”å¦‚ï¼ŒBoost.Test é‡Œçš„æµ‹è¯•å®å« <code>BOOST_CHECK</code> æˆ–ç±»ä¼¼çš„åå­—ï¼Œè€Œä¸æ˜¯ç®€å•çš„ <code>CHECK</code>ã€‚æˆ‘è¿™è¾¹å‡ºäºè®²è§£ä¸Šçš„ç®€æ´ï¼ŒåŸºæœ¬ä¸ç”¨åç©ºé—´å’Œå‰ç¼€ï¼Œä½†ä¸ç­‰äºä½ åœ¨é¡¹ç›®é‡Œä¹Ÿåº”è¯¥è¿™æ ·åšï¼šåƒ <code>PASTE</code>ã€<code>STRING</code> è¿™æ ·çš„å®è¿˜æ˜¯éå¸¸å®¹æ˜“äº§ç”Ÿå†²çªçš„ã€‚</p><p>å¦‚æœä½ ä½¿ç”¨ MSVC çš„è¯ï¼Œè¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„é—®é¢˜æ˜¯ MSVC çš„ä¼ ç»Ÿé¢„å¤„ç†æ–¹å¼ä¸ç¬¦åˆ C++ æ ‡å‡†ï¼Œæ— æ³•æ­£ç¡®å¤„ç†è¿™äº›å®ã€‚ä½ éœ€è¦å¯ç”¨å‘½ä»¤è¡Œé€‰é¡¹ <code>/Zc:preprocessor</code> æ‰è¡Œ <span class=\"orange\">[2]</span>ã€‚</p><h3>å­—æ®µçš„å®šä¹‰</h3><p>ç»™å®šäº†å­—æ®µç´¢å¼•ã€å­—æ®µç±»å‹å’Œå­—æ®µåç§°ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦ç”Ÿæˆä¸‹é¢è¿™äº›ä¿¡æ¯ï¼Œæ¥æ–¹ä¾¿é€šè¿‡ç´¢å¼•ä½¿ç”¨å®ƒä»¬ï¼š</p><ul>\n<li>å­—æ®µåç§°</li>\n<li>å­—æ®µç±»å‹</li>\n<li>å­—æ®µå€¼çš„è®¿é—®</li>\n</ul><p>æˆ‘ä»¬ä¸‹é¢éœ€è¦è€ƒè™‘çš„ï¼Œå°±æ˜¯ï¼ˆå‡è®¾ï¼‰ç»™å®šäº†ç´¢å¼•å€¼ <code>0</code>ã€å­—æ®µå†…å®¹ <code>(long)v1</code>ï¼Œå¦‚ä½•æ¥ç”Ÿæˆå­—æ®µçš„å®šä¹‰ã€‚</p><p>å­—æ®µåç§°çœ‹èµ·æ¥æœ€å¥½åŠï¼š</p><pre><code class=\"language-cpp\">template &lt;typename T&gt;\nstruct _field&lt;T, 0&gt; {\n  static constexpr auto name =\n    STRING(STRIP((long)v1));\n  â€¦\n};\n</code></pre><p>å¯¹ <code>(long)v1</code> è¿›è¡Œ <code>STRIP</code> åï¼Œæˆ‘ä»¬å¾—åˆ° <code>v1</code>ï¼›å†å¯¹å…¶ <code>STRING</code> å¤„ç†ï¼Œå³å¾—åˆ°å­—ç¬¦ä¸² <code>\"v1\"</code>ã€‚</p><p>å­—æ®µç±»å‹ä¹Ÿä¸å¤æ‚ã€‚å”¯ä¸€çš„éº»çƒ¦æ˜¯æˆ‘æ²¡æ‰¾åˆ°å®å¤„ç†çš„æ–¹æ³•ä» <code>(long)v1</code> å¾—åˆ° <code>long</code>ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¹¶ä¸ä¸€å®šéœ€è¦é‡‡ç”¨ <code>(long)v1</code> è¿™ç§å†™æ³•ï¼Œå†™æˆ <code>(long, v1)</code> è¿™æ ·å°±æ²¡è¿™ç§éº»çƒ¦äº†ã€‚åªä¸è¿‡ï¼Œä»å¯è¯»æ€§çš„è§’åº¦ï¼Œå­—æ®µå®šä¹‰æˆ <code>(long)v1</code> æ›´æ¥è¿‘ C/C++ çš„ç°æœ‰è¯­æ³•ï¼Œç¡®å®æ¯” <code>(long, v1)</code> çœ‹èµ·æ¥è¦ç›´è§‚å¾—å¤šï¼Œä¹Ÿèƒ½æ›´è‡ªç„¶åœ°å¤„ç†ç±»å‹ä¹‹ä¸­å¸¦é€—å·çš„æƒ…å†µï¼ˆå¦‚ <code>array&lt;int, 4&gt;</code>ï¼‰ã€‚æˆ‘è§‰å¾—ç½—èƒ½çš„è¿™ä¸ªé€‰æ‹©éå¸¸æ£’ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬è¿™é‡Œé‡‡å–ç»•å¼¯çš„æ–¹å¼ï¼Œå®šä¹‰ä¸ºï¼š</p><pre><code class=\"language-cpp\">  using type =\n    decltype(decay_t&lt;T&gt;::STRIP((long)v1));\n</code></pre><p>æ¢å¥è¯è¯´ï¼š</p><pre><code class=\"language-cpp\">  using type = decltype(S2::v1);\n</code></pre><p>ä¸ºä»€ä¹ˆè¦æŠŠ <code>T</code> ä½œä¸ºå‚æ•°ä¼ è¿›æ¥ï¼Œè¿˜è¦ä½¿ç”¨ <code>decay_t</code> å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬å…è®¸ <code>T</code> æ˜¯ <code>S2&amp;</code>ã€<code>const S2&amp;</code>ã€<code>S2&amp;&amp;</code> ç­‰å¤šç§æƒ…å†µï¼ˆé¡ºä¾¿è¯´ä¸€å¥ï¼Œå¦‚æœèƒ½ç”¨ C++20 çš„è¯ï¼Œé‚£ <code>remove_cvref_t</code> æ˜¯ä¸ªæ›´å¥½çš„é€‰æ‹©ï¼‰ã€‚åœ¨å­—æ®µå€¼çš„è®¿é—®æ—¶æˆ‘ä»¬å°±éœ€è¦ç”¨ä¸Šè¿™ç§çµæ´»æ€§äº†ï¼š</p><pre><code class=\"language-cpp\">  T&amp;&amp; obj_;\n  _field(T&amp;&amp; obj)\n    : obj_(forward&lt;T&gt;(obj)) {}\n  auto value() -&gt; decltype(auto)\n  {\n    return (forward&lt;T&gt;(obj_).v1);\n  }\n</code></pre><p>è¿™é‡Œçš„å¦å¤–ä¸€ä¸ªå°ç»†èŠ‚æ˜¯ï¼Œè¿”å›è¡¨è¾¾å¼ä¸Šçš„æ‹¬å·æ˜¯å¿…éœ€çš„ã€‚è¿”å›å€¼ç±»å‹ä¸º <code>decltype(auto)</code>ï¼Œæ„å‘³ç€æˆ‘ä»¬ä½¿ç”¨ <code>decltype(è¿”å›è¡¨è¾¾å¼)</code> ä½œä¸ºè¿”å›å€¼ç±»å‹ï¼šä½¿ç”¨ <code>decltype(obj_.v1)</code> æˆ‘ä»¬ä¼šå¾—åˆ° <code>long</code>ï¼Œè€Œä½¿ç”¨ <code>decltype((obj_.v1))</code> æˆ‘ä»¬æ‰ä¼šå¾—åˆ° <code>long&amp;</code>ï¼ˆæˆ– <code>const long&amp;</code> ä¹‹ç±»ï¼‰ï¼Œåè€…æ‰æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p><p>ä¸Šä¸€èŠ‚ç»“å°¾æ—¶çš„ <code>FIELD</code> å®ï¼Œå°±å¯ä»¥è‡ªåŠ¨å¸®æˆ‘ä»¬æ¥ç”Ÿæˆè¿™äº›å®šä¹‰ã€‚å®ƒæœ¬èº«è¢«å®šä¹‰ä¸ºï¼š</p><pre><code class=\"language-cpp\">#define FIELD(i, arg)                        \\\n  PAIR(arg);                                 \\\n  template &lt;typename T&gt;                      \\\n  struct _field&lt;T, i&gt; {                      \\\n    _field(T&amp;&amp; obj)                          \\\n      : obj_(forward&lt;T&gt;(obj)) {}             \\\n    static constexpr auto name =             \\\n      CTS_STRING(STRIP(arg));                \\\n    using type =                             \\\n      decltype(decay_t&lt;T&gt;::STRIP(arg));      \\\n    auto value() -&gt; decltype(auto)           \\\n    {                                        \\\n      return (forward&lt;T&gt;(obj_).STRIP(arg));  \\\n    }                                        \\\n    T&amp;&amp; obj_;                                \\\n  };\n</code></pre><h3>ç¼–è¯‘æœŸä½¿ç”¨å­—æ®µåç§°</h3><p>ä¸Šé¢çš„å®šä¹‰åœ¨åˆæ­¥ä½¿ç”¨æ—¶å·²ç»å¤Ÿç”¨äº†ï¼Œä½†ç­‰åˆ°ä½ æƒ³åœ¨ç¼–è¯‘æœŸå¯¹å­—æ®µåç§°è¿›è¡Œåˆ¤æ–­æ—¶ï¼Œä½ å°±ä¼šå‘ç°éº»çƒ¦æ¥äº†ã€‚å½“ç„¶ï¼Œåˆ©ç”¨ä¸Šä¸€è®²æˆ‘ä»¬è®²è¿°çš„ç¼–è¯‘æœŸä¼ å‚çš„æŠ€å·§ï¼Œæˆ‘ä»¬å¯ä»¥è§£å†³é—®é¢˜ã€‚ä½†ä¸å…¶å¦‚æ­¤ï¼Œä¸å¦‚æˆ‘ä»¬ç›´æ¥å¾€å‰èµ°ä¸€æ­¥ï¼Œåˆ©ç”¨å­—ç¬¦ä¸²æ¨¡æ¿å‚æ•°ï¼Œç›´æ¥æŠŠå­—æ®µåç§°ä»<strong>å€¼</strong>å˜æˆ<strong>ç±»å‹</strong>ï¼š</p><pre><code class=\"language-cpp\">  static constexpr auto name =\n    CTS_STRING(STRIP((long)v1));\n</code></pre><p>è¿™é‡Œæˆ‘ä»¬åªæ˜¯ç®€å•åœ°æŠŠ <code>STRING</code> å˜æˆäº† <code>CTS_STRING</code>ã€‚è¿™ä¸ªå˜åŒ–çœ‹èµ·æ¥å¾ˆå°ï¼Œä½†å®ƒä¼šå¯¼è‡´ä¸‹é¢è¿™äº›ç”¨æ³•ä¸Šçš„å¤§æ”¹å˜ï¼š</p><ul>\n<li>ç›¸ç­‰åˆ¤æ–­å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>is_same_v</code></li>\n<li>è¾“å‡ºçš„è¯éœ€è¦ä½¿ç”¨å® <code>CTS_GET_VALUE</code></li>\n<li>å‡½æ•°ä¼ å‚å¤§å¤§ç®€åŒ–ï¼Œä¸å†éœ€è¦ <code>CARG</code>ã€<code>CARG_WRAP</code> é‚£å¥—ä¸œè¥¿</li>\n</ul><p>è¿™æ ·å¸¦æ¥çš„ä¸€ä¸ªå°é—®é¢˜æ˜¯ï¼šå¦‚æœä½ ä½¿ç”¨ MSVC çš„è¯ï¼Œä½ å¿…é¡»å¯ç”¨ C++20 æ‰è¡Œã€‚</p><h2>é™æ€åå°„çš„ä½¿ç”¨</h2><h3>è¯†åˆ«å¯¹é™æ€åå°„çš„æ”¯æŒ</h3><p>å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å¤„ç†çš„æ•°æ®å¯¹è±¡æ˜¯å¦æ”¯æŒé™æ€åå°„ä½œåˆ†åˆ«çš„å¤„ç†ã€‚ä½¿ç”¨ç±»å‹ç‰¹å¾å¾ˆå®¹æ˜“å°±èƒ½åšåˆ°ï¼ˆå¯å‚è€ƒ<a href=\"https://time.geekbang.org/column/article/181636\">ç¬¬ 14 è®²</a>ï¼‰ï¼š</p><pre><code class=\"language-cpp\">template &lt;typename T, typename = void&gt;\nstruct is_reflected : false_type {};\n\ntemplate &lt;typename T&gt;\nstruct is_reflected&lt;\n  T, void_t&lt;decltype(T::_size)&gt;&gt;\n  : true_type {};\n\ntemplate &lt;typename T&gt;\nconstexpr static bool is_reflected_v =\n  is_reflected&lt;T&gt;::value;\n</code></pre><h3>ç»“æ„ä½“çš„æ•°æ®éå†ï¼šå¯¹è±¡æ‰“å°</h3><p>å¯¹äºä¸€ä¸ªæ”¯æŒé™æ€åå°„çš„ç»“æ„ä½“ï¼Œæˆ‘ä»¬å¯ä»¥åšçš„ä¸€ä¸ªéå¸¸åŸºæœ¬çš„æ“ä½œï¼Œå°±æ˜¯å¯ä»¥åƒ <code>tuple</code> ä¸€æ ·æ¥è¿›è¡Œç®€å•çš„éå†ã€‚ä¸ºäº†æ–¹ä¾¿è¿™ä¸ªå¸¸è§æ“ä½œä»¥åŠç±»ä¼¼éå†æ“ä½œçš„å®ç°ï¼Œæˆ‘ä»¬å®šä¹‰ä¸‹é¢çš„å‡½æ•°æ¨¡æ¿ï¼š</p><pre><code class=\"language-cpp\">template &lt;typename T, typename F,\n          size_t... Is&gt;\nconstexpr void\nfor_each_impl(T&amp;&amp; obj, F&amp;&amp; f,\n              index_sequence&lt;Is...&gt;)\n{\n  using DT = decay_t&lt;T&gt;;\n  (void(forward&lt;F&gt;(f)(\n     DT::template _field&lt;T, Is&gt;::name,\n     typename DT::template _field&lt;T, Is&gt;(\n       forward&lt;T&gt;(obj))\n       .value())),\n   ...);\n}\n\ntemplate &lt;typename T, typename F&gt;\nconstexpr void for_each(T&amp;&amp; obj, F&amp;&amp; f)\n{\n  using DT = decay_t&lt;T&gt;;\n  for_each_impl(\n    forward&lt;T&gt;(obj), forward&lt;F&gt;(f),\n    make_index_sequence&lt;DT::_size&gt;{});\n}\n</code></pre><p>è·Ÿä¹‹å‰ä¸€æ ·ï¼Œä¸ºäº†åœ¨æ¨å¯¼å‡º <code>T</code> æ˜¯ <code>S2&amp;</code> ç­‰æƒ…å†µä¸‹è®¿é—® <code>S2</code> çš„æˆå‘˜ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ <code>decay_t</code>ã€‚ä» <code>for_each</code> åˆ° <code>for_each_impl</code> åŸºæœ¬åªæ˜¯ä¸ªè½¬å‘ï¼Œä½†åŠ ä¸Šäº† <code>index_sequence</code> å‚æ•°ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬è®²ç¼–è¯‘æœŸç¼–ç¨‹æ—¶ä¸€ç›´åœ¨ä½¿ç”¨çš„æŠ€å·§äº†ã€‚</p><p>ä¸»è¦å·¥ä½œå½“ç„¶å°±åœ¨ <code>for_each_impl</code> é‡Œã€‚å®ƒæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæŠ˜å è¡¨è¾¾å¼çš„å±•å¼€ï¼ŒåŸºæœ¬å½¢å¼æ˜¯ï¼š</p><pre><code class=\"language-cpp\">(void(forward&lt;F&gt;(f)(â€¦)), ...)\n</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬é€é¡¹è°ƒç”¨å‡½æ•° <code>f</code>ï¼ˆä½¿ç”¨äº†å®Œç¾è½¬å‘ï¼‰ï¼Œå¹¶æŠ›å¼ƒè¿”å›å€¼ï¼ˆä½¿ç”¨ <code>void</code>ï¼‰ã€‚</p><p>æˆ‘ä»¬å†çœ‹ä¸€ä¸‹æ¯æ¬¡è°ƒç”¨å‡½æ•° <code>f</code> ä½¿ç”¨çš„å‚æ•°ï¼š</p><ul>\n<li>ç¬¬ä¸€é¡¹æ˜¯ <code>DT::template _field&lt;T, Is&gt;::name</code>ï¼Œè¡¨ç¤ºå­—æ®µçš„åç§°ã€‚è¿™é‡Œä½ å¯èƒ½æ„Ÿåˆ°é™Œç”Ÿçš„æ˜¯å¯¹æˆå‘˜æ¨¡æ¿çš„ <code>template</code> æ¶ˆæ­§ä¹‰ç¬¦ [3]ï¼Œå…¶ä»–å°±åº”è¯¥æ²¡å•¥ç‰¹åˆ«çš„åœ°æ–¹äº†ã€‚ä»é˜…è¯»çš„è§’åº¦ï¼Œä½ åŸºæœ¬ä¸Šå¯ä»¥ç®€å•åœ°å¿½ç•¥ <code>::</code> åé¢çš„ <code>template</code> å…³é”®å­—ã€‚</li>\n<li>ç¬¬äºŒé¡¹æ˜¯ <code>typename DT::template _field&lt;T, Is&gt;(forward&lt;T&gt;(obj)).value()</code>ã€‚è¿™ä¸ªè¡¨è¾¾å¼æœ‰ç‚¹é•¿ï¼Œå…¶ä¸­ï¼Œ<code>typename DT::template _field&lt;T, Is&gt;</code> æŒ‡å®šäº† <code>_field</code> æˆå‘˜æ¨¡æ¿çš„ç±»å‹ï¼Œç„¶åæˆ‘ä»¬æŠŠ <code>obj</code> å®Œç¾è½¬å‘åˆ°æ„é€ å‡½æ•°é‡Œï¼Œä¹‹åä½ å°±å¯ä»¥ç”¨ <code>value()</code> æ¥ä»¥åˆé€‚çš„å¼•ç”¨æ–¹å¼æ¥è®¿é—®å­—æ®µäº†ã€‚</li>\n</ul><p>æ‰€ä»¥ï¼Œå¯¹äºæˆ‘ä»¬æä¾›ç»™ <code>for_each</code> çš„å‡½æ•°ï¼Œå¯¹å®ƒçš„è¦æ±‚ä¹Ÿæ˜¯èƒ½æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªæ˜¯ç»“æ„ä½“çš„å­—æ®µåï¼Œç¬¬äºŒä¸ªæ˜¯å­—æ®µçš„å¼•ç”¨ã€‚ä½¿ç”¨è¿™æ ·ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å°±èƒ½å¯¹ä¸€ä¸ªç»“æ„ä½“è¿›è¡Œéå†äº†ã€‚</p><p>åªé™¤äº†ä¸€ç‚¹â€”â€”æˆ‘ä¸Šé¢é‚£å¥è¯ä¸ä¸¥æ ¼ã€‚ç”±äºå­—æ®µåä½¿ç”¨å¼ºç±»å‹ï¼Œæ›´ç”±äºæ¯ä¸€ä¸ªå­—æ®µçš„ç±»å‹éƒ½å¯èƒ½ä¸åŒï¼Œä¸€ä¸ªæ™®é€šå‡½æ•°æ— æ³•å·¥ä½œã€‚æˆ‘ä»¬ä¸€èˆ¬ä¼šä½¿ç”¨æ³›å‹ lambda è¡¨è¾¾å¼ï¼Œæœ¬è´¨ä¸Šï¼Œå®ƒæ˜¯ä¸€ä¸ªå…·æœ‰ <code>operator()</code> æˆå‘˜å‡½æ•°æ¨¡æ¿çš„å‡½æ•°å¯¹è±¡ã€‚</p><p>æœ‰äº†è¿™ä¸ªåŸºæœ¬å·¥å…·ä¹‹åï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥åƒ <code>print_tuple</code> ä¸€æ ·æ–¹ä¾¿åœ°è¾“å‡ºä»»ä½•æ”¯æŒé™æ€åå°„çš„ç»“æ„ä½“äº†ã€‚ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-cpp\">template &lt;typename T&gt;\nvoid dump_obj(const T&amp; obj,\n              ostream&amp; os = cout,\n              const char* field_name = \"\",\n              int depth = 0)\n{\n  auto indent = [&amp;os, depth] {\n    for (int i = 0; i &lt; depth; ++i) {\n      os &lt;&lt; \"    \";\n    }\n  };\n\n  if constexpr (is_reflected_v&lt;T&gt;) {\n    indent();\n    os &lt;&lt; field_name\n       &lt;&lt; (*field_name ? \": {\\n\" : \"{\\n\");\n    for_each(\n      obj, [depth, &amp;os](auto field_name,\n                        const auto&amp; value) {\n        dump_obj(value, os,\n                 CTS_GET_VALUE(field_name),\n                 depth + 1);\n      });\n    indent();\n    os &lt;&lt; \"}\" &lt;&lt; (depth == 0 ? \"\\n\" : \",\\n\");\n  } else {\n    indent();\n    os &lt;&lt; field_name &lt;&lt; \": \" &lt;&lt; obj &lt;&lt; \",\\n\";\n  }\n}\n</code></pre><p>ä»”ç»†çœ‹ä¸€ä¸‹ï¼Œä½ ä¼šå‘ç°è¿™ä¸ªå‡½æ•°çš„å®ç°ç›¸å½“ç®€å•ã€‚æˆ‘ä»¬æ ¹æ® <code>T</code> ç±»å‹æ˜¯å¦æ”¯æŒé™æ€åå°„ï¼Œå†³å®šæ˜¯éå†å…¶æ‰€æœ‰å­—æ®µï¼Œè¿˜æ˜¯ç›´æ¥è°ƒç”¨ <code>&lt;&lt;</code> è¿ç®—ç¬¦æ¥å°†å…¶è¾“å‡ºã€‚å¦‚æœæ˜¯éå†çš„è¯ï¼Œæˆ‘ä»¬å°±ä¼šè°ƒç”¨ <code>for_each</code>ï¼Œå¹¶åœ¨ä¼ é€’ç»™ <code>for_each</code> çš„æ³›å‹ lambda é‡Œé€’å½’è°ƒç”¨ <code>dump_obj</code>ï¼ŒæŠŠä¸‹é¢ä¸€å±‚çš„å€¼ã€å­—æ®µåç­‰ä¿¡æ¯ä¼ é€’è¿‡å»ã€‚</p><p>å¯¹äºæˆ‘ä»¬å¼€å¤´çš„é‚£ä¸ª <code>s2</code>ï¼Œ<code>dump_obj</code> å¯ä»¥ç»™å‡ºä¸‹é¢è¿™æ ·çš„è¾“å‡ºï¼š</p><blockquote>\n<p><code>{</code><br>\n<code>    v1: 1,</code><br>\n<code>    v2: false,</code><br>\n<code>}</code></p>\n</blockquote><h3>ç»“æ„ä½“çš„å…ƒæ•°æ®éå†ï¼šå¯¹è±¡å­—æ®µæŸ¥æ‰¾</h3><p>æœ‰æ—¶å€™æˆ‘ä»¬å¹¶ä¸å¸Œæœ›éå†å¯¹è±¡çš„å®é™…æ•°æ®ï¼Œè€Œåªæ˜¯éå†å¯¹è±¡çš„æ•°æ®ç±»å‹ã€‚ä¸€ç§å¯èƒ½çš„åœºæ™¯å°±æ˜¯ï¼Œé€šè¿‡ä¸€ä¸ªå­—æ®µçš„åç§°ï¼ŒæŸ¥æ‰¾å­—æ®µåœ¨ç»“æ„ä½“é‡Œçš„ç´¢å¼•å€¼ã€‚</p><p>ç±»ä¼¼äºåˆšæ‰çš„ <code>for_each</code>ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ª <code>for_each_meta</code>ã€‚å…¶å®ç°å¦‚ä¸‹ï¼š</p><pre><code class=\"language-cpp\">template &lt;typename T, typename F,\n          size_t... Is&gt;\nconstexpr void\nfor_each_meta_impl(F&amp;&amp; f,\n                   index_sequence&lt;Is...&gt;)\n{\n  using DT = decay_t&lt;T&gt;;\n  (void(forward&lt;F&gt;(f)(\n     Is, DT::template _field&lt;T, Is&gt;::name)),\n   ...);\n}\n\ntemplate &lt;typename T, typename F&gt;\nconstexpr void for_each_meta(F&amp;&amp; f)\n{\n  for_each_meta_impl&lt;T&gt;(\n    forward&lt;F&gt;(f),\n    make_index_sequence&lt;T::_size&gt;{});\n}\n</code></pre><p>ä½¿ç”¨è¿™ä¸ª <code>for_each_meta</code>ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°å‡ºåˆšæ‰è¯´çš„æ ¹æ®å­—æ®µåç§°æŸ¥æ‰¾ç´¢å¼•å€¼çš„å‡½æ•°äº†ï¼š</p><pre><code class=\"language-cpp\">template &lt;typename T, typename Name&gt;\nconstexpr size_t\nget_field_index(Name /*name*/)\n{\n  auto result = SIZE_MAX;\n  for_each_meta&lt;T&gt;([&amp;result](size_t index,\n                             auto name) {\n    if constexpr (is_same_v&lt;decltype(name),\n                            Name&gt;) {\n      result = index;\n    }\n  });\n  return result;\n}\n</code></pre><p>è¿™ä¸ªå‡½æ•°è¦æ±‚ä¼ é€’ä¸€ä¸ªâ€œç¼–è¯‘æœŸå­—ç¬¦ä¸²â€çš„å­—æ®µåç§°ï¼Œç„¶åå°±ä¼šæ‰¾å‡ºè¿™ä¸ªå­—æ®µåç§°å¯¹åº”çš„å­—æ®µç´¢å¼•å€¼ã€‚å¦‚æœè¿™ä¸ªå­—æ®µä¸å­˜åœ¨çš„è¯ï¼Œå°±ä¼šè¿”å› <code>SIZE_MAX</code>ã€‚</p><p>å¦‚å¯¹äºå¼€å¤´çš„ <code>S1</code>ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>get_field_index&lt;S1&gt;(CTS_STRING(msg))</code> å°±èƒ½åœ¨ç¼–è¯‘æœŸå¾—åˆ°ç»“æœ 2ã€‚</p><h3>ä¸¤ä¸ªç»“æ„ä½“çš„åŒæ—¶éå†ï¼šå¯¹è±¡æ‹·è´</h3><p>éå†ä¸€ä¸ªç»“æ„ä½“åªèƒ½æ»¡è¶³éƒ¨åˆ†å¸¸è§éœ€æ±‚ã€‚å¯¹äºåƒæ¯”è¾ƒã€å¤åˆ¶è¿™æ ·çš„æ“ä½œï¼Œæˆ‘ä»¬éœ€è¦åŒæ—¶éå†ä¸¤ä¸ªç»“æ„ä½“ã€‚è¿™ä¸ªå‡½æ•°ï¼Œä¾æ®ä¸€äº›ä¸šç•Œçš„æƒ¯ä¾‹ï¼Œæˆ‘å‘½åä¸º <code>zip</code>ã€‚</p><p>ä¸‹é¢æ˜¯ <code>zip</code> çš„å®ç°ï¼š</p><pre><code class=\"language-cpp\">template &lt;typename T, typename U, typename F,\n          size_t... Is&gt;\nconstexpr void zip_impl(T&amp;&amp; obj1,\n                        U&amp;&amp; obj2,\n                        F&amp;&amp; f,\n                        index_sequence&lt;Is...&gt;)\n{\n  using DT = decay_t&lt;T&gt;;\n  using DU = decay_t&lt;U&gt;;\n  static_assert(DT::_size == DU::_size);\n  (void(forward&lt;F&gt;(f)(\n     DT::template _field&lt;T, Is&gt;::name,\n     DU::template _field&lt;U, Is&gt;::name,\n     typename DT::template _field&lt;T, Is&gt;(\n       forward&lt;T&gt;(obj1))\n       .value(),\n     typename DU::template _field&lt;U, Is&gt;(\n       forward&lt;U&gt;(obj2))\n       .value())),\n   ...);\n}\n\ntemplate &lt;typename T, typename U, typename F&gt;\nconstexpr void zip(T&amp;&amp; obj1, U&amp;&amp; obj2, F&amp;&amp; f)\n{\n  using DT = decay_t&lt;T&gt;;\n  using DU = decay_t&lt;U&gt;;\n  static_assert(DT::_size == DU::_size);\n  zip_impl(forward&lt;T&gt;(obj1), forward&lt;U&gt;(obj2),\n           forward&lt;F&gt;(f),\n           make_index_sequence&lt;DT::_size&gt;{});\n}\n</code></pre><p>å®ƒç»“æ„ä¸Šä¹Ÿè¿˜æ˜¯ <code>for_each</code> çš„ä¸€ä¸ªç¿»ç‰ˆï¼Œæ²¡æœ‰å¤§çš„åŒºåˆ«ã€‚æ­¤å¤„ï¼Œæ ¹æ®æˆ‘è¿™è¾¹çš„å®é™…éœ€æ±‚ï¼Œæˆ‘è¦æ±‚ä¸¤ä¸ªè¢«éå†çš„ç»“æ„ä½“çš„å­—æ®µæ•°é‡å¿…é¡»å®Œå…¨ä¸€è‡´ã€‚æ ¹æ®ä½ çš„å®é™…éœ€è¦ï¼Œä½ å½“ç„¶ä¹Ÿå¯ä»¥å®ç°æˆä»¥è¾ƒå°çš„ç»“æ„ä½“ä¸ºå‡†ï¼›ä½†æŒ‰ç…§æˆ‘çš„å®é™…é¡¹ç›®ç»éªŒï¼Œè¿™ç§åœ¨åŠ¨æ€å¤§å°åœºæ™¯ä¸‹çš„å¸¸è§åšæ³•ï¼Œåœ¨ç¼–è¯‘æœŸæ˜¾å¾—æ¯”è¾ƒé¸¡è‚‹ï¼Œå®é™…ç”¨å¤„ä¸å¤§ã€‚</p><p>æœ‰äº† <code>zip</code> è¿™æ ·çš„å·¥å…·ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å®ç°ä¸€äº›è¾ƒå¤æ‚çš„æ“ä½œäº†ï¼Œæ¯”å¦‚ï¼Œå¯ä»¥æ”¯æŒå¼‚è´¨åŒæ„ç»“æ„ä½“ï¼ˆæˆå‘˜å¿…é¡»ä¸€ä¸€å¯¹åº”ï¼Œä½†ç±»å‹å¯ä»¥ä¸åŒï¼‰çš„é€æˆå‘˜å¤åˆ¶ã€‚å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-cpp\">template &lt;typename T, typename U&gt;\nconstexpr void copy(T&amp;&amp; src, U&amp; dest)\n{\n  if constexpr (is_reflected_v&lt;decay_t&lt;T&gt;&gt; &amp;&amp;\n                is_reflected_v&lt;decay_t&lt;U&gt;&gt;) {\n    zip(forward&lt;T&gt;(src), dest,\n        [](auto /*field_name1*/,\n           auto /*field_name1*/,\n           auto&amp;&amp; value1,\n           auto&amp; value2) {\n          copy(\n            forward&lt;decltype(value1)&gt;(value1),\n            value2);\n        });\n  } else {\n    dest = forward&lt;T&gt;(src);\n  }\n}\n</code></pre><p>ä¸ºäº†å¤„ç†ç§»åŠ¨ï¼Œæˆ‘ä»¬å¯¹æºå¯¹è±¡ä½¿ç”¨å®Œç¾è½¬å‘ï¼Œå…è®¸å®ƒæ˜¯ä¸€ä¸ªå³å€¼ã€‚ä¸ºäº†é˜²æ­¢è¯¯ç”¨å’Œç®€åŒ–ä»£ç ï¼Œç›®æ ‡å¯¹è±¡å¿…é¡»æ˜¯ä¸€ä¸ªå·¦å€¼ã€‚å½“ä¸¤ä¸ªå¯¹è±¡éƒ½æ”¯æŒé™æ€åå°„æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>zip</code> æ¥è¿›è¡Œé€å­—æ®µçš„éå†ï¼Œå¯¹æ¯ä¸€é¡¹ç»§ç»­è¿›è¡Œ <code>copy</code> çš„åŠ¨ä½œï¼›å¦åˆ™ï¼Œæˆ‘ä»¬å°è¯•æ™®é€šçš„èµ‹å€¼æ“ä½œï¼ˆä¸æ”¯æŒçš„è¯ï¼Œå³ä¼šå¯¼è‡´ç¼–è¯‘å¤±è´¥ï¼‰ã€‚</p><p>å¯¹äºåŒä¸€ç±»å‹ç»“æ„ä½“çš„å¤åˆ¶ï¼ŒC++ ä¸€èˆ¬å¯ä»¥é»˜è®¤æä¾›èµ‹å€¼è¿ç®—ç¬¦ã€‚ä½†å¦‚æœä¸¤ä¸ªç»“æ„ä½“ç±»å‹ä¸åŒï¼Œé‚£é»˜è®¤çš„èµ‹å€¼è¿ç®—ç¬¦å°±ä¸å·¥ä½œäº†ã€‚è¿™æ—¶å€™ï¼Œè¿™ä¸ª <code>copy</code> å‡½æ•°æ¨¡æ¿å°±èƒ½å¤§æ˜¾èº«æ‰‹äº†ã€‚ä¸€ç§å¯èƒ½çš„ä½¿ç”¨åœºæ™¯æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæ¥å®ç°ç½‘ç»œå­—èŠ‚åºå’Œä¸»æœºå­—èŠ‚åºçš„è‡ªåŠ¨è½¬æ¢ã€‚å‡è®¾æˆ‘ä»¬å®ç°äº†æ•°æ®ç±»å‹ <code>uint32s</code> å’Œ <code>uint16s</code>ï¼Œå¹¶ä¸”è¿™äº›æ•°æ®ç±»å‹æ”¯æŒåœ¨è·Ÿ <code>uint32_t</code> å’Œ <code>uint16_t</code> èµ‹å€¼çš„æ—¶å€™è‡ªåŠ¨è¿›è¡Œè½¬æ¢ï¼ˆè¿™ç›¸å½“å®¹æ˜“å®ç°ï¼‰ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥å®šä¹‰å‡ºç±»ä¼¼ä¸‹é¢çš„æ•°æ®ç»“æ„ï¼š</p><pre><code class=\"language-cpp\">DEFINE_STRUCT(\n  msg_host_t,\n  (uint16_t)tag,\n  (uint16_t)length,\n  (uint32_t)value\n);\n\nDEFINE_STRUCT(\n  msg_net_t,\n  (uint16s)tag,\n  (uint16s)length,\n  (uint32s)value\n);\n</code></pre><p>ä» <code>msg_host_t</code> çš„ä¸€ä¸ªå¯¹è±¡ <code>msg_host</code>ï¼Œè½¬æ¢åˆ°ä¸€ä¸ª <code>msg_net_t</code> çš„å¯¹è±¡ <code>msg_net</code>ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ä¸€è¡Œä»£ç æå®šï¼š</p><pre><code class=\"language-cpp\">copy(msg_host, msg_net);\n</code></pre><p>ä¸ä»…å¦‚æ­¤ï¼Œè¿™æ ·çš„ç»“æ„ä½“å¯ä»¥åµŒå¥—ã€‚å¦‚æœæˆ‘ä»¬æœ‰ä¸‹é¢çš„ç»“æ„ä½“å®šä¹‰ï¼š</p><pre><code class=\"language-cpp\">DEFINE_STRUCT(\n  data_host_t,\n  (msg_host_t)msg,\n  (array&lt;byte, 8&gt;)data\n);\n\nDEFINE_STRUCT(\n  data_net_t,\n  (msg_net_t)msg,\n  (array&lt;byte, 8&gt;)data\n);\n</code></pre><p>è¿™ä¸¤ç§ç±»å‹çš„å¯¹è±¡ä¹‹é—´ä¹Ÿå¯ä»¥ç”¨ <code>copy</code> æ¥è¿›è¡Œå¤åˆ¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨äº§ç”Ÿåˆé€‚çš„è½¬æ¢ä»£ç ã€‚</p><h3>åº”ç”¨ï¼šæ‹·è´åŒåå­—æ®µ</h3><p>åˆ©ç”¨é™æ€åå°„ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªåŠ¨åŒ–å¾ˆå¤šåŸæœ¬éœ€è¦æ‰‹å·¥ç¼–ç çš„æ“ä½œã€‚é™¤äº†ä¸Šé¢å±•ç¤ºçš„é‚£äº›ï¼Œå¸¸ç”¨çš„åœºæ™¯è¿˜æœ‰åºåˆ—åŒ–ã€ååºåˆ—åŒ–ç­‰ã€‚ç”±äºåºåˆ—åŒ–å’Œååºåˆ—åŒ–è·Ÿå®é™…åº”ç”¨åœºæ™¯å…³è”æ¯”è¾ƒç´§å¯†ï¼Œä»£ç ä¹Ÿæ¯”è¾ƒå¤æ‚ï¼Œæˆ‘æœ€åå°±è®²ä¸€ä¸‹å¼€å¤´æ‰€å±•ç¤ºçš„ã€æŒ‰å­—æ®µåå¤åˆ¶ç»“æ„ä½“çš„å®ç°ã€‚</p><p>æŒ‰å­—æ®µåæ¥å¤åˆ¶ç»“æ„ä½“ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å›ç­”ä¸‹é¢ä¸¤ä¸ªé—®é¢˜ï¼š</p><ul>\n<li>æˆ‘ä»¬æŒ‰æºç»“æ„ä½“ä¼˜å…ˆéå†ï¼Œè¿˜æ˜¯æŒ‰ç›®æ ‡ç»“æ„ä½“ä¼˜å…ˆéå†</li>\n<li>æˆ‘ä»¬å¦‚ä½•è§£å†³å­—æ®µç¼ºå¤±çš„é—®é¢˜</li>\n</ul><p>åœ¨å½“å‰çš„è§£å†³æ–¹æ¡ˆé‡Œï¼Œæˆ‘åšå‡ºäº†ä¸‹é¢çš„é€‰æ‹©ï¼š</p><ul>\n<li>æŒ‰ç›®æ ‡ç»“æ„ä½“ä¼˜å…ˆéå†ï¼ˆä¹Ÿå°±æ˜¯ä¸ºå¤§ç»“æ„ä½“å¾€å°ç»“æ„ä½“æ‹·è´è€Œä¼˜åŒ–ï¼›åè¿‡æ¥å®ç°ä¹Ÿä¸éš¾ã€å¾ˆç›¸ä¼¼ï¼‰</li>\n<li>ä¸¥æ ¼æŒ‡å®šç›®æ ‡ç»“æ„ä½“é‡Œæœ‰ã€æºç»“æ„ä½“é‡Œæ²¡æœ‰çš„å­—æ®µæ•°é‡ï¼ˆé»˜è®¤ä¸ºé›¶ï¼‰ï¼Œä¸æ­£ç¡®çš„è¯ï¼Œç›´æ¥ç¼–è¯‘å¤±è´¥</li>\n</ul><p>åœ¨å®ç° <code>copy_same_name_fields</code> ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›è¾…åŠ©çš„å·¥å…·å‡½æ•°æ¨¡æ¿ã€‚é¦–å…ˆæ˜¯ <code>count_missing_fields</code>ï¼Œæ•°ä¸€ä¸‹æºç»“æ„ä½“é‡Œç¼ºå¤±çš„å­—æ®µæ•°é‡ï¼š</p><pre><code class=\"language-cpp\">template &lt;typename T, typename U&gt;\nconstexpr size_t count_missing_fields()\n{\n  size_t result = 0;\n  for_each_meta&lt;U&gt;([&amp;result](size_t /*index*/,\n                             auto name) {\n    if constexpr (get_field_index&lt;T&gt;(name) ==\n                  SIZE_MAX) {\n      ++result;\n    }\n  });\n  return result;\n}\n</code></pre><p>è¿™é‡Œæˆ‘ä»¬ç”¨åˆ°äº†å‰é¢æè¿°è¿‡çš„ <code>get_field_index</code>ï¼Œé€šè¿‡ä¸¤é‡å¾ªç¯æœç´¢å­—æ®µåã€‚æ‰€æœ‰çš„è¿™äº›æ“ä½œå…¨éƒ¨å‘ç”Ÿåœ¨ç¼–è¯‘æ—¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸ç”¨å¤ªæ‹…å¿ƒè¿™ä¸ª $O(m \\times n)$ çº§åˆ«çš„æ€§èƒ½å¼€é”€ã€‚</p><p>åœ¨å®ç° <code>copy_same_name_fields</code> ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜è¦åšä¸€ä¸ªå°å°çš„å¤„ç†ï¼Œæ ‡è®°æºç»“æ„ä½“é‡Œç¼ºå¤±äº†å¤šå°‘ä¸ªå­—æ®µã€‚æ˜¾ç„¶ï¼Œä¸ºäº†ç¼–è¯‘æœŸæ£€æŸ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¼ é€’ä¸€ä¸ªæ¨¡æ¿å‚æ•°ï¼Œä½†æˆ‘ä»¬ç©¶ç«Ÿè¯¥ç”¨ä»€ä¹ˆç±»å‹å‘¢ï¼Ÿç”¨ <code>int</code>ï¼Ÿè¿˜æ˜¯ <code>size_t</code>ï¼Ÿ</p><p>éƒ½ä¸æ˜¯ï¼Œä¸ºäº†ç±»å‹ä¸Šæ›´ä¸¥æ ¼ï¼Œä¹Ÿä¸ºäº†ä»£ç å¯è¯»æ€§æ›´é«˜ï¼Œæˆ‘é€‰æ‹©ä½¿ç”¨å¼ºæšä¸¾ç±»å‹ï¼š</p><pre><code class=\"language-cpp\">enum class missing_fields : size_t {};\n</code></pre><p>å®ƒçš„åº•å±‚æ˜¯ <code>size_t</code>ï¼Œä½†ä½¿ç”¨è€…å¿…é¡»æ˜¾å¼åœ°ç»™å‡º <code>missing_fields{1}</code> è¿™æ ·çš„æ–¹å¼æ¥è¡¨è¾¾ç¼ºå¤±äº†ä¸€ä¸ªå­—æ®µã€‚æˆ‘è®¤ä¸ºè¿™æ ·å†™æ›´åŠ åˆé€‚ã€æ›´åŠ å¯è¯»ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥æœ€ç»ˆå®ç° <code>copy_same_name_fields</code> äº†ï¼š</p><pre><code class=\"language-cpp\">template &lt;missing_fields MissingFields =\n            missing_fields{0},\n          typename T, typename U&gt;\nconstexpr void\ncopy_same_name_fields(T&amp;&amp; src, U&amp; dest)\n{\n  constexpr size_t actual_missing_fields =\n    count_missing_fields&lt;decay_t&lt;T&gt;, U&gt;();\n  static_assert(size_t(MissingFields) ==\n                actual_missing_fields);\n  for_each(dest, [&amp;src](auto field_name,\n                        auto&amp; value) {\n    using DT = decay_t&lt;T&gt;;\n    constexpr auto field_index =\n      get_field_index&lt;DT&gt;(field_name);\n    if constexpr (field_index != SIZE_MAX) {\n      copy(typename DT::template _field&lt;\n             T, field_index&gt;(\n             forward&lt;T&gt;(src))\n             .value(),\n           value);\n    }\n  });\n}\n</code></pre><p>æˆ‘åœ¨è¿™ä¸ªå‡½æ•°é‡Œåšäº†ä»¥ä¸‹çš„äº‹æƒ…ï¼š</p><ol>\n<li>æ£€æŸ¥æŒ‡å®šçš„ç¼ºå¤±å­—æ®µæ•°é‡æ˜¯å¦å’Œå®é™…çš„ç¼ºå¤±å­—æ®µæ•°é‡ä¸€è‡´ï¼Œä¸ä¸€è‡´åˆ™é™æ€æ–­è¨€å¤±è´¥</li>\n<li>å¯¹ç›®æ ‡å¯¹è±¡è¿›è¡Œé€å­—æ®µéå†</li>\n<li>å¯¹æ¯ä¸ªå­—æ®µï¼Œæ ¹æ®å­—æ®µååœ¨æºå¯¹è±¡ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨å¯¹åº”çš„å­—æ®µï¼Œå­˜åœ¨çš„è¯ï¼Œåˆ™ <code>copy</code> è¿‡å»</li>\n</ol><p>å¾ˆç®€å•å§ï¼Ÿè¿™é‡Œé¢çš„å…³é”®ï¼Œè·Ÿä¸Šä¸€è®²çš„ç¼–è¯‘æœŸå­—ç¬¦ä¸²å¤„ç†ä¸€æ ·ï¼Œæ˜¯éœ€è¦å¤„å¤„ä¿æŒ constexpr æ€§ã€‚æˆ‘ç°åœ¨åº”è¯¥å·²ç»æä¾›äº†è¶³å¤Ÿå¤šçš„ä¾‹å­ï¼Œè®©ä½ çœ‹åˆ°è¯¥å¦‚ä½•å†™å‡ºè¿™ç§ä»£ç ã€‚</p><p>å¯¹äºå¼€å¤´ç»™å‡ºçš„ <code>copy_same_name_fields(s1, s2)</code>ï¼Œç¼–è¯‘å™¨å®é™…ç”Ÿæˆçš„ x86-64 çš„æ±‡ç¼–ä»£ç æ˜¯è¿™æ ·å­ï¼š</p><pre><code class=\"language-assembly\">movsx   rax, DWORD PTR s1[rip]\nmov     QWORD PTR s2[rip], rax\nmovzx   eax, BYTE PTR s1[rip+4]\nmov     BYTE PTR s2[rip+8], al\n</code></pre><p>Java ä¹‹ç±»çš„è¯­è¨€è™½ç„¶æœ‰ç€æ›´ä¸ºå¼ºå¤§çš„åå°„èƒ½åŠ›ï¼Œä½†å®ƒä»¬çš„åå°„æœºåˆ¶å°±å®Œå…¨æ²¡æœ‰ç”Ÿæˆè¿™æ ·çš„é«˜æ•ˆä»£ç çš„å¯èƒ½æ€§ï¼</p><h2>ä¸€äº›å®ç°ç»†èŠ‚</h2><p>è¿™ä¸€è®²çš„ä»£ç æœ‰ç‚¹å°å¤æ‚ï¼Œé‡Œé¢æœ‰å¾ˆå¤šå®¹æ˜“æé”™çš„å°ç»†èŠ‚ï¼Œå› æ­¤æˆ‘æŠŠä¸€ä¸ªå®Œæ•´çš„å®ç°å’Œæµ‹è¯•æ”¾åˆ°äº† GitHub ä¸Šçš„<a href=\"https://github.com/adah1972/geek_time_cpp\">ä»£ç åº“</a>é‡Œã€‚åŒæ—¶ï¼Œä¸ºäº†æ–¹ä¾¿è®²è§£ï¼Œæˆ‘ä¸Šé¢ç»™å‡ºçš„ä»£ç æœ‰ä¸€å®šçš„ç®€åŒ–ï¼›è€Œä»£ç åº“ä¸­çš„å®é™…ä»£ç æ›´åè¿‘å·¥ç¨‹åŒ–ä¸€äº›ï¼Œç›¸æ¯”æ–‡ä¸­çš„ç¤ºä¾‹æœ‰å¦‚ä¸‹çš„ä¸åŒï¼š</p><ul>\n<li>é™æ€åå°„çš„å·¥å…·å‡½æ•°æ¨¡æ¿æ”¾åœ¨äº†åç©ºé—´ <code>sr</code> ä¸­ï¼Œè·Ÿæ ‡å‡†åº“çš„åŒåå‡½æ•°æ¨¡æ¿å¯ä»¥æ¸…æ™°åœ°åŒºåˆ†</li>\n<li>ä¸ºäº†é˜²æ­¢å†²çªï¼Œ<code>for_each</code> ç­‰å‡½æ•°åŠ ä¸Šäº† <code>enable_if</code> è¿›è¡Œé™åˆ¶ï¼Œè¦æ±‚æ“ä½œçš„å¯¹è±¡å¿…é¡»æ»¡è¶³ <code>is_reflected</code></li>\n<li><code>for_each_meta</code> åœ¨è°ƒç”¨å‡½æ•°æ—¶å¢åŠ äº†ä¸€ä¸ªç›®å‰æ²¡æœ‰ç”¨åˆ°çš„å‚æ•°â€”â€”å­—æ®µç±»å‹</li>\n<li><code>dump_obj</code> çš„å®ç°æ–¹å¼æœ‰æ‰€å˜åŒ–</li>\n<li>æµ‹è¯•é‡Œæ·»åŠ äº†å¯¹ <code>tuple</code> è¡Œä¸ºçš„æ¨¡æ‹Ÿï¼Œå…è®¸æŸç§ç¨‹åº¦ä¸ŠæŠŠç»“æ„ä½“å½“æˆ <code>tuple</code> æ¥ç”¨</li>\n</ul><p>æ ¹æ®ä½ çš„å®é™…ä½¿ç”¨åœºæ™¯ï¼Œè¿™äº›ä»£ç å¯èƒ½è¿˜æœ‰è¿›ä¸€æ­¥çš„ä¼˜åŒ–ç©ºé—´ã€‚ä¸è¿‡ï¼Œä½œä¸ºä¸€ä¸ªåŸºæœ¬çš„å®ç°å‚è€ƒï¼Œæˆ‘æƒ³å®ƒä»¬å·²ç»å¾ˆæœ‰ç”¨äº†ã€‚</p><h2>å†…å®¹å°ç»“</h2><p>æœ¬è®²é€šè¿‡å®ç°å¤åˆ¶ä¸¤ä¸ªç»“æ„ä½“ä¸­çš„åŒåå­—æ®µï¼Œè®²è§£äº†ç¼–è¯‘æœŸæ•°æ®éå†å’Œä¸€ä¸ªé‡è¦çš„å®é™…ä½¿ç”¨æ¡ˆä¾‹ã€‚åœ¨ C++ æ ‡å‡†ä¸­å°šæœªå¼•å…¥æ­£å¼çš„é™æ€åå°„ä¹‹é™…ï¼Œè¿™äº›æŠ€å·§ä¼šæ˜¯ä½ çš„ç™¾å®ç®±ä¸­çš„é‡è¦å·¥å…·ã€‚</p><h2>è¯¾åæ€è€ƒ</h2><p>è¯·é˜…è¯»ç¤ºä¾‹ä»£ç ï¼Œå¹¶è€ƒè™‘ä¸€ä¸‹ï¼Œå¦‚ä½•å¯ä»¥ä½¿ç”¨è¿™äº›æŠ€å·§æ¥æ‰©å……æ›´å¤šçš„æ•°æ®å¤„ç†èƒ½åŠ›ï¼Œå¦‚å®ç°æ•°æ®ç»“æ„çš„åºåˆ—åŒ–ï¼Ÿ</p><p>æœŸå¾…ä½ çš„æ€è€ƒï¼Œæœ‰ä»»ä½•ç–‘é—®ï¼Œæ¬¢è¿åœ¨ç•™è¨€åŒºä¸æˆ‘è®¨è®ºï¼</p><h2>ç‰¹åˆ«è‡´è°¢</h2><p>ç½—èƒ½é˜…è¯»äº†æœ¬è®²çš„æ‰‹ç¨¿ï¼Œå¹¶æå‡ºäº†å¾ˆå¥½çš„æ”¹è¿›æ„è§ã€‚</p><h2><span class=\"reference\">å‚è€ƒèµ„æ–™</span></h2><p><span class=\"reference\">[1] ç½—èƒ½, â€œå¦‚ä½•ä¼˜é›…çš„å®ç° C++ ç¼–è¯‘æœŸé™æ€åå°„â€. <a href=\"https://netcan.github.io/2020/08/01/%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E5%AE%9E%E7%8E%B0C-%E7%BC%96%E8%AF%91%E6%9C%9F%E9%9D%99%E6%80%81%E5%8F%8D%E5%B0%84/\">https://netcan.github.io/2020/08/01/å¦‚ä½•ä¼˜é›…çš„å®ç°C-ç¼–è¯‘æœŸé™æ€åå°„/</a></span></p><p><span class=\"reference\">[2] Microsoft, â€œ<code>/Zc:preprocessor</code> (Enable preprocessor conformance mode)â€. <a href=\"https://docs.microsoft.com/en-us/cpp/build/reference/zc-preprocessor\">https://docs.microsoft.com/en-us/cpp/build/reference/zc-preprocessor</a></span></p><p><span class=\"reference\">[3] cppreference.com, â€œDependent names &gt; The <code>template</code> disambiguator for dependent namesâ€. <a href=\"https://en.cppreference.com/w/cpp/language/dependent_name#The_template_disambiguator_for_dependent_names\">https://en.cppreference.com/w/cpp/language/dependent_name#The_template_disambiguator_for_dependent_names</a></span></p><p><span class=\"reference\">[3a] cppreference.com, â€œå¾…å†³å &gt; å¾…å†³åçš„ <code>template</code> æ¶ˆæ­§ä¹‰ç¬¦â€. <a href=\"https://zh.cppreference.com/w/cpp/language/dependent_name#.E5.BE.85.E5.86.B3.E5.90.8D.E7.9A.84_template_.E6.B6.88.E6.AD.A7.E4.B9.89.E7.AC.A6\">https://zh.cppreference.com/w/cpp/language/dependent_name#.E5.BE.85.E5.86.B3.E5.90.8D.E7.9A.84_template_.E6.B6.88.E6.AD.A7.E4.B9.89.E7.AC.A6</a></span></p>","comments":[{"had_liked":false,"id":360107,"user_name":"å½“åˆè«ç›¸è¯†","can_delete":false,"product_type":"c1","uid":2768765,"ip_address":"æ±Ÿè‹","ucode":"313917BB360D48","user_header":"https://static001.geekbang.org/account/avatar/00/2a/3f/7d/f624fa69.jpg","comment_is_top":false,"comment_ctime":1666178159,"is_pvip":false,"replies":[{"id":131007,"content":"è¿™ä¸€è®²å±äºé«˜çº§æŠ€å·§äº†ï¼Œéš¾åº¦æ˜¯é«˜ç‚¹ã€‚æˆ‘ä¸»è¦æ˜¯æƒ³åˆ†äº«ä¸€ç‚¹å¯èƒ½ç”¨å¾—ä¸Šçš„æŠ€æœ¯ã€‚\n\nå¦å¤–ï¼Œå³ä½¿æ²¡çœ‹æ‡‚ï¼Œä½ ä¹Ÿå¯ä»¥è¯•è¯•çœ‹ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚æ¯•ç«Ÿï¼Œä½¿ç”¨ STL å¹¶ä¸è¦æ±‚ä½ èƒ½å¤Ÿå†™å‡º STLã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1666278946,"ip_address":"æ±Ÿè‹","comment_id":360107,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"è¿™äº›é€‰å­¦çš„æ–‡ç« ï¼Œéš¾åº¦å¤ªé«˜ï¼Œæˆ‘åªèƒ½è‰è‰é˜…è¿‡ï¼Œæ®µä½ä¸å¤ŸğŸ˜‚","like_count":4},{"had_liked":false,"id":384452,"user_name":"æäº‘é¾™","can_delete":false,"product_type":"c1","uid":3201926,"ip_address":"åŒ—äº¬","ucode":"785924B16BE788","user_header":"https://static001.geekbang.org/account/avatar/00/30/db/86/51ec4c41.jpg","comment_is_top":false,"comment_ctime":1700966604,"is_pvip":false,"replies":[{"id":140275,"content":"ä½ çœ‹å®ƒä»¬ä¸¤è€…çš„ç±»å‹å°±çŸ¥é“äº†ï¼š\n\nhttps:&#47;&#47;godbolt.org&#47;z&#47;GfqP4dEME\n\nåè€…çš„ç»“æœæ˜¯ cts_wrapper&lt;compile_time_string&lt;3ul&gt;{char [3]{(char)72, (char)105}}&gt; è¿™ç§æ ·å­ï¼šå­—ç¬¦ä¸²çš„å†…å®¹ä¹Ÿç¼–ç è¿›å»äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1701080329,"ip_address":"ä¸Šæµ·","comment_id":384452,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"æ˜¨å¤©æå‡ºçš„é—®é¢˜æœ‰è¯¯ï¼Œé‡æ–°è¯·æ•™è€å¸ˆï¼šä¸ºä»€ä¹ˆ cout &lt;&lt; is_same_v&lt;decltype(&quot;Hi&quot;_cts), decltype(&quot;He&quot;_cts)&gt; ; è¿”å›çš„æ˜¯trueï¼Œä½†æ˜¯ cout &lt;&lt; is_same_v&lt;decltype(cts_wrapper&lt;&quot;Hi&quot;&gt;{}), decltype(cts_wrapper&lt;&quot;He&quot;&gt;{}) &gt; è¿”å›çš„æ˜¯falseï¼Ÿå‰è€…æˆ‘çš„ç†è§£æ˜¯æŒ‰ç…§å­—ç¬¦ä¸²çš„å­—ç¬¦ä¸ªæ•°è¿›è¡Œå¯¹æ¯”ï¼Œåè€…ä¸ºä»€ä¹ˆå¯ä»¥æŒ‰ç…§å­—ç¬¦çš„å€¼è¿›è¡Œäº†å¯¹æ¯”ï¼Ÿä¸‹é¢çš„ä¸¤æ®µä»£ç çš„æ¨¡æ¿å‚æ•°éƒ½æ˜¯compile_time_string ctsï¼Œä¸ºä»€ä¹ˆå¯¹æ¯”çš„ç»“æœä¼šä¸ä¸€æ ·ï¼Ÿ\ntemplate &lt;compile_time_string cts&gt;\nconstexpr auto operator&quot;&quot;_cts()\n{\n    return cts;\n}\n\ntemplate &lt;compile_time_string cts&gt;\nstruct cts_wrapper {\n    static constexpr compile_time_string str{ cts };\n};","like_count":1,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591106,"discussion_content":"è¿™ä¸€è®²å±äºé«˜çº§æŠ€å·§äº†ï¼Œéš¾åº¦æ˜¯é«˜ç‚¹ã€‚æˆ‘ä¸»è¦æ˜¯æƒ³åˆ†äº«ä¸€ç‚¹å¯èƒ½ç”¨å¾—ä¸Šçš„æŠ€æœ¯ã€‚\n\nå¦å¤–ï¼Œå³ä½¿æ²¡çœ‹æ‡‚ï¼Œä½ ä¹Ÿå¯ä»¥è¯•è¯•çœ‹ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚æ¯•ç«Ÿï¼Œä½¿ç”¨ STL å¹¶ä¸è¦æ±‚ä½ èƒ½å¤Ÿå†™å‡º STLã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666278946,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ±Ÿè‹","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":384392,"user_name":"æäº‘é¾™","can_delete":false,"product_type":"c1","uid":3201926,"ip_address":"åŒ—äº¬","ucode":"785924B16BE788","user_header":"https://static001.geekbang.org/account/avatar/00/30/db/86/51ec4c41.jpg","comment_is_top":false,"comment_ctime":1700791140,"is_pvip":false,"replies":[{"id":140274,"content":"é™æ€åå°„æ—¶å¸¸ç”¨äºåºåˆ—åŒ–ã€‚\n\nä½†æ˜¯ï¼Œâ€œå°†å®¹å™¨ä¸­çš„æ•°æ®è½¬å­˜è‡³ç»“æ„ä½“ä¸­â€æœ‰ç‚¹è®©äººçš±çœ‰ã€‚ä½ æ˜¯å¯ä»¥ç›´æ¥å¯¹å®¹å™¨è¿›è¡Œåºåˆ—åŒ–çš„â€¦â€¦\n\nä¸€ä¸ªèŒƒä¾‹æ˜¯ struct_pack é¡¹ç›®ã€‚ä½ å¯ä»¥æœç´¢äº†çœ‹ä¸€ä¸‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1701079725,"ip_address":"ä¸Šæµ·","comment_id":384392,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"æˆ‘åœ¨å®é™…å·¥ç¨‹ä¸­é‡åˆ°è¿‡c++ STL å®¹å™¨éœ€è¦åºåˆ—åŒ–çš„åœºæ™¯ï¼Œå½“æ—¶æˆ‘ä»¬é‡‡ç”¨çš„æ–¹æ³•æ˜¯å°†å®¹å™¨ä¸­çš„æ•°æ®è½¬å­˜åˆ°Jsonä¸­ï¼Œç„¶ååˆ©ç”¨Jsonåº“çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–åŠŸèƒ½ã€‚æˆ‘è§‰å¾—è¿™æ ·çš„åºåˆ—åŒ–åº”è¯¥æ˜¯æ•ˆç‡ä¸é«˜ã€‚å­¦ä¹ äº†æœ¬è®²åï¼Œæˆ‘è§‰å¾—STLå®¹å™¨çš„åºåˆ—åŒ–æœ‰äº†ä¸€ä¸ªæ–°çš„æ–¹æ¡ˆï¼šå°†å®¹å™¨ä¸­çš„æ•°æ®è½¬å­˜è‡³ç»“æ„ä½“ä¸­ï¼Œç„¶åä½¿ç”¨æœ¬è®²çš„é™æ€åå°„è¿›è¡Œåºåˆ—åŒ–ã€‚","like_count":1,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632626,"discussion_content":"ä½ çœ‹å®ƒä»¬ä¸¤è€…çš„ç±»å‹å°±çŸ¥é“äº†ï¼š\n\nhttps://godbolt.org/z/GfqP4dEME\n\nåè€…çš„ç»“æœæ˜¯ cts_wrapper&lt;compile_time_string&lt;3ul&gt;{char [3]{(char)72, (char)105}}&gt; è¿™ç§æ ·å­ï¼šå­—ç¬¦ä¸²çš„å†…å®¹ä¹Ÿç¼–ç è¿›å»äº†ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1701080329,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3201926,"avatar":"https://static001.geekbang.org/account/avatar/00/30/db/86/51ec4c41.jpg","nickname":"æäº‘é¾™","note":"","ucode":"785924B16BE788","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632561,"discussion_content":"ç»è¿‡æˆ‘åå¤æ€è€ƒï¼Œç»ˆäºæ˜ç™½äº†ï¼šå‰è€…è¿”å›trueæ˜¯å› ä¸ºæ¯”è¾ƒçš„æ˜¯compile_time_stringç±»å‹ï¼Œè¿™ä¸ªç±»å‹çš„æ¯”è¾ƒæ˜¯æŒ‰ç…§å­—ç¬¦ä¸²çš„ä¸ªæ•°è¿›è¡Œçš„ã€‚åè€…è¿”å›falseæ˜¯å› ä¸ºæ¯”è¾ƒçš„æ˜¯cts_wrapperç±»å‹ï¼Œè¿™ä¸ªç±»å‹çš„æ¯”è¾ƒæ˜¯æŒ‰ç…§compile_time_string å¯¹è±¡è¿›è¡Œçš„ï¼Œä¸åŒçš„å­—ç¬¦ä¸²å­—é¢é‡ï¼Œå½“ç„¶æ˜¯ä¸åŒçš„compile_time_string å¯¹è±¡äº†ï¼Œå¯¼è‡´äº†cts_wrapperç±»å‹ä¸åŒã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1700983444,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":390295,"user_name":"Vä¸‡èƒ½çš„å°é»‘V","can_delete":false,"product_type":"c1","uid":2436694,"ip_address":"ç¾å›½","ucode":"262051F1B7847A","user_header":"https://static001.geekbang.org/account/avatar/00/25/2e/56/6f38de90.jpg","comment_is_top":false,"comment_ctime":1715020010,"is_pvip":false,"replies":[{"id":142017,"content":"å…ˆç”¨èµ·æ¥ï¼Œå€’ä¸ä¸€å®šéœ€è¦çœ‹æ‡‚ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1715303875,"ip_address":"ä¸Šæµ·","comment_id":390295,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"å¾—åå¤çœ‹å‡ éæ‰èƒ½åƒå¤Ÿï¼Œç°åœ¨åªèƒ½çœ‹æ‡‚ï¼Œè¿˜ä¸çŸ¥é“æ€ä¹ˆç”¨","like_count":0,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632625,"discussion_content":"é™æ€åå°„æ—¶å¸¸ç”¨äºåºåˆ—åŒ–ã€‚\n\nä½†æ˜¯ï¼Œâ€œå°†å®¹å™¨ä¸­çš„æ•°æ®è½¬å­˜è‡³ç»“æ„ä½“ä¸­â€æœ‰ç‚¹è®©äººçš±çœ‰ã€‚ä½ æ˜¯å¯ä»¥ç›´æ¥å¯¹å®¹å™¨è¿›è¡Œåºåˆ—åŒ–çš„â€¦â€¦\n\nä¸€ä¸ªèŒƒä¾‹æ˜¯ struct_pack é¡¹ç›®ã€‚ä½ å¯ä»¥æœç´¢äº†çœ‹ä¸€ä¸‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1701079726,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":351709,"user_name":"é’±è™","can_delete":false,"product_type":"c1","uid":1936980,"ip_address":"","ucode":"D60200C100096C","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqUCr2XW1bgTTTiaf1UJvNOVjpibGicVSY6icU8uyzx5WTLLbF54nrM0EfzAOE2xmiarCw2w83uHiceka7A/132","comment_is_top":false,"comment_ctime":1658113053,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"å¥½","like_count":0,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":644520,"discussion_content":"å…ˆç”¨èµ·æ¥ï¼Œå€’ä¸ä¸€å®šéœ€è¦çœ‹æ‡‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1715303876,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360107,"user_name":"å½“åˆè«ç›¸è¯†","can_delete":false,"product_type":"c1","uid":2768765,"ip_address":"æ±Ÿè‹","ucode":"313917BB360D48","user_header":"https://static001.geekbang.org/account/avatar/00/2a/3f/7d/f624fa69.jpg","comment_is_top":false,"comment_ctime":1666178159,"is_pvip":false,"replies":[{"id":131007,"content":"è¿™ä¸€è®²å±äºé«˜çº§æŠ€å·§äº†ï¼Œéš¾åº¦æ˜¯é«˜ç‚¹ã€‚æˆ‘ä¸»è¦æ˜¯æƒ³åˆ†äº«ä¸€ç‚¹å¯èƒ½ç”¨å¾—ä¸Šçš„æŠ€æœ¯ã€‚\n\nå¦å¤–ï¼Œå³ä½¿æ²¡çœ‹æ‡‚ï¼Œä½ ä¹Ÿå¯ä»¥è¯•è¯•çœ‹ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚æ¯•ç«Ÿï¼Œä½¿ç”¨ STL å¹¶ä¸è¦æ±‚ä½ èƒ½å¤Ÿå†™å‡º STLã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1666278946,"ip_address":"æ±Ÿè‹","comment_id":360107,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"è¿™äº›é€‰å­¦çš„æ–‡ç« ï¼Œéš¾åº¦å¤ªé«˜ï¼Œæˆ‘åªèƒ½è‰è‰é˜…è¿‡ï¼Œæ®µä½ä¸å¤ŸğŸ˜‚","like_count":4,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591106,"discussion_content":"è¿™ä¸€è®²å±äºé«˜çº§æŠ€å·§äº†ï¼Œéš¾åº¦æ˜¯é«˜ç‚¹ã€‚æˆ‘ä¸»è¦æ˜¯æƒ³åˆ†äº«ä¸€ç‚¹å¯èƒ½ç”¨å¾—ä¸Šçš„æŠ€æœ¯ã€‚\n\nå¦å¤–ï¼Œå³ä½¿æ²¡çœ‹æ‡‚ï¼Œä½ ä¹Ÿå¯ä»¥è¯•è¯•çœ‹ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚æ¯•ç«Ÿï¼Œä½¿ç”¨ STL å¹¶ä¸è¦æ±‚ä½ èƒ½å¤Ÿå†™å‡º STLã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666278946,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ±Ÿè‹","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":384452,"user_name":"æäº‘é¾™","can_delete":false,"product_type":"c1","uid":3201926,"ip_address":"åŒ—äº¬","ucode":"785924B16BE788","user_header":"https://static001.geekbang.org/account/avatar/00/30/db/86/51ec4c41.jpg","comment_is_top":false,"comment_ctime":1700966604,"is_pvip":false,"replies":[{"id":140275,"content":"ä½ çœ‹å®ƒä»¬ä¸¤è€…çš„ç±»å‹å°±çŸ¥é“äº†ï¼š\n\nhttps:&#47;&#47;godbolt.org&#47;z&#47;GfqP4dEME\n\nåè€…çš„ç»“æœæ˜¯ cts_wrapper&lt;compile_time_string&lt;3ul&gt;{char [3]{(char)72, (char)105}}&gt; è¿™ç§æ ·å­ï¼šå­—ç¬¦ä¸²çš„å†…å®¹ä¹Ÿç¼–ç è¿›å»äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1701080329,"ip_address":"ä¸Šæµ·","comment_id":384452,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"æ˜¨å¤©æå‡ºçš„é—®é¢˜æœ‰è¯¯ï¼Œé‡æ–°è¯·æ•™è€å¸ˆï¼šä¸ºä»€ä¹ˆ cout &lt;&lt; is_same_v&lt;decltype(&quot;Hi&quot;_cts), decltype(&quot;He&quot;_cts)&gt; ; è¿”å›çš„æ˜¯trueï¼Œä½†æ˜¯ cout &lt;&lt; is_same_v&lt;decltype(cts_wrapper&lt;&quot;Hi&quot;&gt;{}), decltype(cts_wrapper&lt;&quot;He&quot;&gt;{}) &gt; è¿”å›çš„æ˜¯falseï¼Ÿå‰è€…æˆ‘çš„ç†è§£æ˜¯æŒ‰ç…§å­—ç¬¦ä¸²çš„å­—ç¬¦ä¸ªæ•°è¿›è¡Œå¯¹æ¯”ï¼Œåè€…ä¸ºä»€ä¹ˆå¯ä»¥æŒ‰ç…§å­—ç¬¦çš„å€¼è¿›è¡Œäº†å¯¹æ¯”ï¼Ÿä¸‹é¢çš„ä¸¤æ®µä»£ç çš„æ¨¡æ¿å‚æ•°éƒ½æ˜¯compile_time_string ctsï¼Œä¸ºä»€ä¹ˆå¯¹æ¯”çš„ç»“æœä¼šä¸ä¸€æ ·ï¼Ÿ\ntemplate &lt;compile_time_string cts&gt;\nconstexpr auto operator&quot;&quot;_cts()\n{\n    return cts;\n}\n\ntemplate &lt;compile_time_string cts&gt;\nstruct cts_wrapper {\n    static constexpr compile_time_string str{ cts };\n};","like_count":1,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632626,"discussion_content":"ä½ çœ‹å®ƒä»¬ä¸¤è€…çš„ç±»å‹å°±çŸ¥é“äº†ï¼š\n\nhttps://godbolt.org/z/GfqP4dEME\n\nåè€…çš„ç»“æœæ˜¯ cts_wrapper&lt;compile_time_string&lt;3ul&gt;{char [3]{(char)72, (char)105}}&gt; è¿™ç§æ ·å­ï¼šå­—ç¬¦ä¸²çš„å†…å®¹ä¹Ÿç¼–ç è¿›å»äº†ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1701080329,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3201926,"avatar":"https://static001.geekbang.org/account/avatar/00/30/db/86/51ec4c41.jpg","nickname":"æäº‘é¾™","note":"","ucode":"785924B16BE788","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632561,"discussion_content":"ç»è¿‡æˆ‘åå¤æ€è€ƒï¼Œç»ˆäºæ˜ç™½äº†ï¼šå‰è€…è¿”å›trueæ˜¯å› ä¸ºæ¯”è¾ƒçš„æ˜¯compile_time_stringç±»å‹ï¼Œè¿™ä¸ªç±»å‹çš„æ¯”è¾ƒæ˜¯æŒ‰ç…§å­—ç¬¦ä¸²çš„ä¸ªæ•°è¿›è¡Œçš„ã€‚åè€…è¿”å›falseæ˜¯å› ä¸ºæ¯”è¾ƒçš„æ˜¯cts_wrapperç±»å‹ï¼Œè¿™ä¸ªç±»å‹çš„æ¯”è¾ƒæ˜¯æŒ‰ç…§compile_time_string å¯¹è±¡è¿›è¡Œçš„ï¼Œä¸åŒçš„å­—ç¬¦ä¸²å­—é¢é‡ï¼Œå½“ç„¶æ˜¯ä¸åŒçš„compile_time_string å¯¹è±¡äº†ï¼Œå¯¼è‡´äº†cts_wrapperç±»å‹ä¸åŒã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1700983444,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":384392,"user_name":"æäº‘é¾™","can_delete":false,"product_type":"c1","uid":3201926,"ip_address":"åŒ—äº¬","ucode":"785924B16BE788","user_header":"https://static001.geekbang.org/account/avatar/00/30/db/86/51ec4c41.jpg","comment_is_top":false,"comment_ctime":1700791140,"is_pvip":false,"replies":[{"id":140274,"content":"é™æ€åå°„æ—¶å¸¸ç”¨äºåºåˆ—åŒ–ã€‚\n\nä½†æ˜¯ï¼Œâ€œå°†å®¹å™¨ä¸­çš„æ•°æ®è½¬å­˜è‡³ç»“æ„ä½“ä¸­â€æœ‰ç‚¹è®©äººçš±çœ‰ã€‚ä½ æ˜¯å¯ä»¥ç›´æ¥å¯¹å®¹å™¨è¿›è¡Œåºåˆ—åŒ–çš„â€¦â€¦\n\nä¸€ä¸ªèŒƒä¾‹æ˜¯ struct_pack é¡¹ç›®ã€‚ä½ å¯ä»¥æœç´¢äº†çœ‹ä¸€ä¸‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1701079725,"ip_address":"ä¸Šæµ·","comment_id":384392,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"æˆ‘åœ¨å®é™…å·¥ç¨‹ä¸­é‡åˆ°è¿‡c++ STL å®¹å™¨éœ€è¦åºåˆ—åŒ–çš„åœºæ™¯ï¼Œå½“æ—¶æˆ‘ä»¬é‡‡ç”¨çš„æ–¹æ³•æ˜¯å°†å®¹å™¨ä¸­çš„æ•°æ®è½¬å­˜åˆ°Jsonä¸­ï¼Œç„¶ååˆ©ç”¨Jsonåº“çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–åŠŸèƒ½ã€‚æˆ‘è§‰å¾—è¿™æ ·çš„åºåˆ—åŒ–åº”è¯¥æ˜¯æ•ˆç‡ä¸é«˜ã€‚å­¦ä¹ äº†æœ¬è®²åï¼Œæˆ‘è§‰å¾—STLå®¹å™¨çš„åºåˆ—åŒ–æœ‰äº†ä¸€ä¸ªæ–°çš„æ–¹æ¡ˆï¼šå°†å®¹å™¨ä¸­çš„æ•°æ®è½¬å­˜è‡³ç»“æ„ä½“ä¸­ï¼Œç„¶åä½¿ç”¨æœ¬è®²çš„é™æ€åå°„è¿›è¡Œåºåˆ—åŒ–ã€‚","like_count":1,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632625,"discussion_content":"é™æ€åå°„æ—¶å¸¸ç”¨äºåºåˆ—åŒ–ã€‚\n\nä½†æ˜¯ï¼Œâ€œå°†å®¹å™¨ä¸­çš„æ•°æ®è½¬å­˜è‡³ç»“æ„ä½“ä¸­â€æœ‰ç‚¹è®©äººçš±çœ‰ã€‚ä½ æ˜¯å¯ä»¥ç›´æ¥å¯¹å®¹å™¨è¿›è¡Œåºåˆ—åŒ–çš„â€¦â€¦\n\nä¸€ä¸ªèŒƒä¾‹æ˜¯ struct_pack é¡¹ç›®ã€‚ä½ å¯ä»¥æœç´¢äº†çœ‹ä¸€ä¸‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1701079726,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":390295,"user_name":"Vä¸‡èƒ½çš„å°é»‘V","can_delete":false,"product_type":"c1","uid":2436694,"ip_address":"ç¾å›½","ucode":"262051F1B7847A","user_header":"https://static001.geekbang.org/account/avatar/00/25/2e/56/6f38de90.jpg","comment_is_top":false,"comment_ctime":1715020010,"is_pvip":false,"replies":[{"id":142017,"content":"å…ˆç”¨èµ·æ¥ï¼Œå€’ä¸ä¸€å®šéœ€è¦çœ‹æ‡‚ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1715303875,"ip_address":"ä¸Šæµ·","comment_id":390295,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"å¾—åå¤çœ‹å‡ éæ‰èƒ½åƒå¤Ÿï¼Œç°åœ¨åªèƒ½çœ‹æ‡‚ï¼Œè¿˜ä¸çŸ¥é“æ€ä¹ˆç”¨","like_count":0,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":644520,"discussion_content":"å…ˆç”¨èµ·æ¥ï¼Œå€’ä¸ä¸€å®šéœ€è¦çœ‹æ‡‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1715303876,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":351709,"user_name":"é’±è™","can_delete":false,"product_type":"c1","uid":1936980,"ip_address":"","ucode":"D60200C100096C","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqUCr2XW1bgTTTiaf1UJvNOVjpibGicVSY6icU8uyzx5WTLLbF54nrM0EfzAOE2xmiarCw2w83uHiceka7A/132","comment_is_top":false,"comment_ctime":1658113053,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"å¥½","like_count":0}]}