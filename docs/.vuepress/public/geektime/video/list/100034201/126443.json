{"id":126443,"title":"16 | 通过ZooKeeper Observer实现跨区域部署","content":"<p><strong>课件和Demo地址</strong></p><p><a href=\"https://gitee.com/geektime-geekbang/geekbang-zk-course\">https://gitee.com/geektime-geekbang/geekbang-zk-course</a></p>","comments":[{"had_liked":false,"id":183257,"user_name":"朱东旭","can_delete":false,"product_type":"c3","uid":1242338,"ip_address":"","ucode":"C48DD620A63868","user_header":"https://static001.geekbang.org/account/avatar/00/12/f4/e2/dbc4a5f2.jpg","comment_is_top":false,"comment_ctime":1582983182,"is_pvip":false,"replies":[{"id":75910,"content":"和读操作相比，写操作更耗时。而且对容错的要求越高，越要有更多的节点，写操作越耗时（因为写操作必须由leader来执行，还需要收到大多数节点的响应）。\n\n但是想要保证linearizable的写操作数据一致性和高容错，据我所知也没有其他更好的办法。\n\nZooKeeper最佳的应用场景是写少读多的场景。","user_name":"作者回复","user_name_real":"Geek_215586","uid":1591870,"ctime":1586141651,"ip_address":"","comment_id":183257,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100034201,"comment_content":"由此看来zookeeper的写吞吐量岂不是不高而且无法提升.","like_count":3,"discussions":[{"author":{"id":1591870,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJyDiaaDJrwRsdUia9HxA8EuWaDVLr4E1gMG5y2ZTxV7BNUhdNABCmH3GMZTzib796X5duibiaeuRmNXeg/132","nickname":"Geek_215586","note":"","ucode":"5916AC9CC5FBE2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485621,"discussion_content":"和读操作相比，写操作更耗时。而且对容错的要求越高，越要有更多的节点，写操作越耗时（因为写操作必须由leader来执行，还需要收到大多数节点的响应）。\n\n但是想要保证linearizable的写操作数据一致性和高容错，据我所知也没有其他更好的办法。\n\nZooKeeper最佳的应用场景是写少读多的场景。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586141651,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":131028,"user_name":"峰回路转","can_delete":false,"product_type":"c3","uid":1217230,"ip_address":"","ucode":"59B9805D7C2D92","user_header":"https://static001.geekbang.org/account/avatar/00/12/92/ce/9d24cb2c.jpg","comment_is_top":false,"comment_ctime":1567602301,"is_pvip":false,"replies":[{"id":49680,"content":"我想您说的是PPT第13页。以下是ZooKeeper leader处理一个写请求的过程：\n\n1. Leader把写请求通过propose消息发给所有的节点。\n2. Leader在收到集群中大部分节点的accept消息之后才可以发送commit消息给所有的节点。\n\nLeader不可以直接收到用户的写请求就commit。假设我们在图中的3节点集群中加入节点4和节点5形成一个5节点集群。节点2在收到写请求之后立刻给节点1发commit消息，节点1给客户端发写成功消息。如果在节点3、节点4和节点5收到这个commit消息之前发生了如下的网络分区。\n\n    分区A              分区B\n节点1 节点2 | 节点3 节点4 节点4\n\n分区B中的节点可以新选举一个leader，从而丢失上述的写请求。丢失已经commit的写操作是不可以的。\n\n关于这一部分的细节，后续的章节会详细说明。\n\n\n","user_name":"作者回复","user_name_real":"Geek_215586","uid":1591870,"ctime":1567696786,"ip_address":"","comment_id":131028,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100034201,"comment_content":"为什么要给每个节点推送给propose 而不是直接 commite 呢？","like_count":3,"discussions":[{"author":{"id":1591870,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJyDiaaDJrwRsdUia9HxA8EuWaDVLr4E1gMG5y2ZTxV7BNUhdNABCmH3GMZTzib796X5duibiaeuRmNXeg/132","nickname":"Geek_215586","note":"","ucode":"5916AC9CC5FBE2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466254,"discussion_content":"我想您说的是PPT第13页。以下是ZooKeeper leader处理一个写请求的过程：\n\n1. Leader把写请求通过propose消息发给所有的节点。\n2. Leader在收到集群中大部分节点的accept消息之后才可以发送commit消息给所有的节点。\n\nLeader不可以直接收到用户的写请求就commit。假设我们在图中的3节点集群中加入节点4和节点5形成一个5节点集群。节点2在收到写请求之后立刻给节点1发commit消息，节点1给客户端发写成功消息。如果在节点3、节点4和节点5收到这个commit消息之前发生了如下的网络分区。\n\n    分区A              分区B\n节点1 节点2 | 节点3 节点4 节点4\n\n分区B中的节点可以新选举一个leader，从而丢失上述的写请求。丢失已经commit的写操作是不可以的。\n\n关于这一部分的细节，后续的章节会详细说明。\n\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567696786,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":208291,"user_name":"NoBody","can_delete":false,"product_type":"c3","uid":1173766,"ip_address":"","ucode":"72E1B4FCDA2469","user_header":"https://static001.geekbang.org/account/avatar/00/11/e9/06/038a9cea.jpg","comment_is_top":false,"comment_ctime":1587317369,"is_pvip":false,"replies":[{"id":79203,"content":"谢谢","user_name":"作者回复","user_name_real":"Geek_215586","uid":1591870,"ctime":1588556906,"ip_address":"","comment_id":208291,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100034201,"comment_content":"看了视频和评论的答疑，谢谢老师和各位提问的。感觉收获了不少","like_count":2,"discussions":[{"author":{"id":1591870,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJyDiaaDJrwRsdUia9HxA8EuWaDVLr4E1gMG5y2ZTxV7BNUhdNABCmH3GMZTzib796X5duibiaeuRmNXeg/132","nickname":"Geek_215586","note":"","ucode":"5916AC9CC5FBE2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492405,"discussion_content":"谢谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588556906,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132540,"user_name":"Douglas","can_delete":false,"product_type":"c3","uid":1073027,"ip_address":"","ucode":"CFDE3D76B9DAE6","user_header":"https://static001.geekbang.org/account/avatar/00/10/5f/83/bb728e53.jpg","comment_is_top":false,"comment_ctime":1568163435,"is_pvip":false,"replies":[{"id":50968,"content":"这个没有太好的办法，我能想到的就是使用更好的网络资源。使用observer已经比使用follower好多了，跨区域消息少了。","user_name":"作者回复","user_name_real":"Geek_215586","uid":1591870,"ctime":1568377531,"ip_address":"","comment_id":132540,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100034201,"comment_content":"这种跨区域的observer节点，是不是会有较大的网络延迟，这个如何解决呢？","like_count":0,"discussions":[{"author":{"id":1591870,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJyDiaaDJrwRsdUia9HxA8EuWaDVLr4E1gMG5y2ZTxV7BNUhdNABCmH3GMZTzib796X5duibiaeuRmNXeg/132","nickname":"Geek_215586","note":"","ucode":"5916AC9CC5FBE2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466996,"discussion_content":"这个没有太好的办法，我能想到的就是使用更好的网络资源。使用observer已经比使用follower好多了，跨区域消息少了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568377531,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1490038,"avatar":"https://static001.geekbang.org/account/avatar/00/16/bc/76/a5b9d244.jpg","nickname":"bigbigboy","note":"","ucode":"18235CBDB0D88F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":278958,"discussion_content":"这么说，对于observer，其实是不能保证一致性的。因为有网络延迟，并且没有ack","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591264152,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":329213,"user_name":"Geek_74dea9","can_delete":false,"product_type":"c3","uid":2760246,"ip_address":"","ucode":"14092EEBC08171","user_header":"","comment_is_top":false,"comment_ctime":1641214759,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100034201,"comment_content":"您说道zookeeper处理写请求，leader只需要收到大多数节点的accept消息即可提交commit，那如果剩下的没有返回accept的节点异常了，commit也没有成功，1，那这个节点的当前写请求数据怎么和其他节点同步呢？2，根当前这个节点连接的客户端读取刚才更新的那条数据的时候如何保证最新呢？\n","like_count":0},{"had_liked":false,"id":267460,"user_name":"Geek_e00a1a","can_delete":false,"product_type":"c3","uid":1812301,"ip_address":"","ucode":"E633C953205903","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/l2FPHyhq7UtdVAaJPW8yxLQFbtfRdqjTBDEWYFoUJzKvpS5RgyWM0o6fLovxttlPhoTrI2YOc5Cl0vuia2agoaQ/132","comment_is_top":false,"comment_ctime":1607755983,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100034201,"comment_content":"请教一下老师\n您说道zookeeper处理写请求，leader只需要收到大多数节点的accept消息即可提交commit，那如果剩下的没有返回accept的节点异常了，commit也没有成功，那这个节点的当前写请求数据怎么和其他节点同步呢？","like_count":0}]}