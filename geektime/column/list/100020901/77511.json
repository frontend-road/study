{"id":77511,"title":"25 | 基础篇：Linux 磁盘I/O是怎么工作的（下）","content":"<p>你好，我是倪朋飞。</p><p>上一节我们学习了 Linux 磁盘 I/O 的工作原理，并了解了由文件系统层、通用块层和设备层构成的 Linux 存储系统 I/O 栈。</p><p>其中，通用块层是 Linux 磁盘 I/O 的核心。向上，它为文件系统和应用程序，提供访问了块设备的标准接口；向下，把各种异构的磁盘设备，抽象为统一的块设备，并会对文件系统和应用程序发来的 I/O 请求，进行重新排序、请求合并等，提高了磁盘访问的效率。</p><p>掌握了磁盘 I/O 的工作原理，你估计迫不及待想知道，怎么才能衡量磁盘的 I/O 性能。</p><p>接下来，我们就来看看，磁盘的性能指标，以及观测这些指标的方法。</p><h2>磁盘性能指标</h2><p>说到磁盘性能的衡量标准，必须要提到五个常见指标，也就是我们经常用到的，使用率、饱和度、IOPS、吞吐量以及响应时间等。这五个指标，是衡量磁盘性能的基本指标。</p><ul>\n<li>\n<p>使用率，是指磁盘处理I/O的时间百分比。过高的使用率（比如超过80%），通常意味着磁盘 I/O 存在性能瓶颈。</p>\n</li>\n<li>\n<p>饱和度，是指磁盘处理 I/O 的繁忙程度。过高的饱和度，意味着磁盘存在严重的性能瓶颈。当饱和度为 100% 时，磁盘无法接受新的 I/O 请求。</p>\n</li>\n<li>\n<p>IOPS（Input/Output Per Second），是指每秒的 I/O 请求数。</p>\n</li>\n<li>\n<p>吞吐量，是指每秒的 I/O 请求大小。</p>\n</li>\n<li>\n<p>响应时间，是指 I/O 请求从发出到收到响应的间隔时间。</p>\n</li>\n</ul><!-- [[[read_end]]] --><p>这里要注意的是，使用率只考虑有没有 I/O，而不考虑 I/O 的大小。换句话说，当使用率是 100% 的时候，磁盘依然有可能接受新的 I/O 请求。</p><p>这些指标，很可能是你经常挂在嘴边的，一讨论磁盘性能必定提起的对象。不过我还是要强调一点，不要孤立地去比较某一指标，而要结合读写比例、I/O类型（随机还是连续）以及 I/O 的大小，综合来分析。</p><p>举个例子，在数据库、大量小文件等这类随机读写比较多的场景中，IOPS 更能反映系统的整体性能；而在多媒体等顺序读写较多的场景中，吞吐量才更能反映系统的整体性能。</p><p>一般来说，我们在为应用程序的服务器选型时，要先对磁盘的 I/O 性能进行基准测试，以便可以准确评估，磁盘性能是否可以满足应用程序的需求。</p><p>这一方面，我推荐用性能测试工具 fio ，来测试磁盘的IOPS、吞吐量以及响应时间等核心指标。但还是那句话，因地制宜，灵活选取。在基准测试时，一定要注意根据应用程序 I/O 的特点，来具体评估指标。</p><p>当然，这就需要你测试出，不同 I/O 大小（一般是 512B 至 1MB 中间的若干值）分别在随机读、顺序读、随机写、顺序写等各种场景下的性能情况。</p><p>用性能工具得到的这些指标，可以作为后续分析应用程序性能的依据。一旦发生性能问题，你就可以把它们作为磁盘性能的极限值，进而评估磁盘 I/O 的使用情况。</p><p>了解磁盘的性能指标，只是我们I/O性能测试的第一步。接下来，又该用什么方法来观测它们呢？这里，我给你介绍几个常用的I/O性能观测方法。</p><h2><strong>磁盘I/O观测</strong></h2><p>第一个要观测的，是每块磁盘的使用情况。</p><p>iostat 是最常用的磁盘I/O性能观测工具，它提供了每个磁盘的使用率、IOPS、吞吐量等各种常见的性能指标，当然，这些指标实际上来自  /proc/diskstats。</p><p>iostat 的输出界面如下。</p><pre><code># -d -x表示显示所有磁盘I/O的指标\n$ iostat -d -x 1 \nDevice            r/s     w/s     rkB/s     wkB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util \nloop0            0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00    0.00   0.00     0.00     0.00   0.00   0.00 \nloop1            0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00    0.00   0.00     0.00     0.00   0.00   0.00 \nsda              0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00    0.00   0.00     0.00     0.00   0.00   0.00 \nsdb              0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00    0.00   0.00     0.00     0.00   0.00   0.00 \n</code></pre><p>从这里你可以看到，iostat 提供了非常丰富的性能指标。第一列的 Device 表示磁盘设备的名字，其他各列指标，虽然数量较多，但是每个指标的含义都很重要。为了方便你理解，我把它们总结成了一个表格。</p><p><img src=\"https://static001.geekbang.org/resource/image/cf/8d/cff31e715af51c9cb8085ce1bb48318d.png?wh=1712*1791\" alt=\"\"></p><p>这些指标中，你要注意：</p><ul>\n<li>\n<p>%util  ，就是我们前面提到的磁盘I/O使用率；</p>\n</li>\n<li>\n<p>r/s+  w/s  ，就是 IOPS；</p>\n</li>\n<li>\n<p>rkB/s+wkB/s ，就是吞吐量；</p>\n</li>\n<li>\n<p>r_await+w_await ，就是响应时间。</p>\n</li>\n</ul><p>在观测指标时，也别忘了结合请求的大小（ rareq-sz 和wareq-sz）一起分析。</p><p>你可能注意到，从 iostat 并不能直接得到磁盘饱和度。事实上，饱和度通常也没有其他简单的观测方法，不过，你可以把观测到的，平均请求队列长度或者读写请求完成的等待时间，跟基准测试的结果（比如通过 fio）进行对比，综合评估磁盘的饱和情况。</p><h2><strong>进程I/O观测</strong></h2><p>除了每块磁盘的 I/O 情况，每个进程的 I/O 情况也是我们需要关注的重点。</p><p>上面提到的 iostat 只提供磁盘整体的 I/O 性能数据，缺点在于，并不能知道具体是哪些进程在进行磁盘读写。要观察进程的I/O情况，你还可以使用 pidstat 和 iotop 这两个工具。</p><p>pidstat 是我们的老朋友了，这里我就不再啰嗦它的功能了。给它加上 -d 参数，你就可以看到进程的I/O情况，如下所示：</p><pre><code>$ pidstat -d 1 \n13:39:51      UID       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command \n13:39:52      102       916      0.00      4.00      0.00       0  rsyslogd\n</code></pre><p>从pidstat的输出你能看到，它可以实时查看每个进程的I/O情况，包括下面这些内容。</p><ul>\n<li>\n<p>用户ID（UID）和进程ID（PID）  。</p>\n</li>\n<li>\n<p>每秒读取的数据大小（kB_rd/s） ，单位是 KB。</p>\n</li>\n<li>\n<p>每秒发出的写请求数据大小（kB_wr/s） ，单位是 KB。</p>\n</li>\n<li>\n<p>每秒取消的写请求数据大小（kB_ccwr/s） ，单位是 KB。</p>\n</li>\n<li>\n<p>块I/O延迟（iodelay），包括等待同步块I/O和换入块I/O结束的时间，单位是时钟周期。</p>\n</li>\n</ul><p>除了可以用 pidstat 实时查看，根据 I/O 大小对进程排序，也是性能分析中一个常用的方法。这一点，我推荐另一个工具， iotop。它是一个类似于 top 的工具，你可以按照 I/O 大小对进程排序，然后找到I/O较大的那些进程。</p><p>iotop 的输出如下所示：</p><pre><code>$ iotop\nTotal DISK READ :       0.00 B/s | Total DISK WRITE :       7.85 K/s \nActual DISK READ:       0.00 B/s | Actual DISK WRITE:       0.00 B/s \n  TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO&gt;    COMMAND \n15055 be/3 root        0.00 B/s    7.85 K/s  0.00 %  0.00 % systemd-journald \n</code></pre><p>从这个输出，你可以看到，前两行分别表示，进程的磁盘读写大小总数和磁盘真实的读写大小总数。因为缓存、缓冲区、I/O合并等因素的影响，它们可能并不相等。</p><p>剩下的部分，则是从各个角度来分别表示进程的I/O情况，包括线程ID、I/O优先级、每秒读磁盘的大小、每秒写磁盘的大小、换入和等待I/O的时钟百分比等。</p><p>这两个工具，是我们分析磁盘 I/O 性能时最常用到的。你先了解它们的功能和指标含义，具体的使用方法，接下来的案例实战中我们一起学习。</p><h2>小结</h2><p>今天，我们梳理了 Linux 磁盘 I/O 的性能指标和性能工具。我们通常用IOPS、吞吐量、使用率、饱和度以及响应时间等几个指标，来评估磁盘的 I/O 性能。</p><p>你可以用 iostat 获得磁盘的 I/O 情况，也可以用 pidstat、iotop 等观察进程的 I/O 情况。不过在分析这些性能指标时，你要注意结合读写比例、I/O 类型以及 I/O 大小等，进行综合分析。</p><h2>思考</h2><p>最后，我想请你一起来聊聊，你碰到过的磁盘 I/O 问题。在碰到磁盘 I/O 性能问题时，你是怎么分析和定位的呢？你可以结合今天学到的磁盘 I/O 指标和工具，以及上一节学过的磁盘 I/O 原理，来总结你的思路。</p><p>欢迎在留言区和我讨论，也欢迎把这篇文章分享给你的同事、朋友。我们一起在实战中演练，在交流中进步。</p><p></p>","comments":[{"had_liked":false,"id":61349,"user_name":"每天晒白牙","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1547684789,"is_pvip":false,"replies":[{"id":"22319","content":"使用率是从时间角度衡量I&#47;O，但是磁盘还可以支持并行写，所以即使使用率100%，有可能还可以接收新的I&#47;O（不饱和）","user_name":"作者回复","comment_id":61349,"uid":"1001282","ip_address":"","utype":1,"ctime":1548250191,"user_name_real":"倪朋飞"}],"discussion_count":3,"race_medal":1,"score":"100331932597","product_id":100020901,"comment_content":"【D25打卡】<br>总结：<br>磁盘性能检测指标：<br>使用率：磁盘处理I&#47;O的时间百分比，使用率只考虑有没有I&#47;O，不考虑I&#47;O的大小。注意当使用率为100%时，由于可能存在并行I&#47;O，磁盘并不一定饱和，所以磁盘仍然可能接收新的I&#47;O请求<br>饱和度：磁盘处理I&#47;O的繁忙程度，注意当饱和度为100%时，磁盘不能接收新的I&#47;O请求<br>吞吐量：每秒I&#47;O请求大小<br>IOPS：Input&#47;Output Per Second 每秒的I&#47;O请求数<br>响应时间：I&#47;O请求从发出到收到响应的间隔时间<br><br>不孤立比较某项指标，结合读写比例、I&#47;O类型（随机还是连续）以及I&#47;O大小综合分析<br>例如：随机读写：多关注IOPS<br>          连续读写：多关注吞吐量<br><br>服务器选型时，对磁盘I&#47;O性能进行基础测试，使用 fio<br>磁盘I&#47;O观测：iostat<br>进程I&#47;O观测：pidstat,iotop<br>指导：遇到I&#47;O性能时，先通过iostat查看磁盘整体性能，然后用pidstat或iotop定位到具体的进程<br><br>疑惑：<br>对磁盘的使用率和饱和度还是没太理解，比如说磁盘的使用率达到100%，由于并行I&#47;O，不一定饱和了，所以还可能接收新的I&#47;O请求，还希望老师再指点下。","like_count":24,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436843,"discussion_content":"使用率是从时间角度衡量I/O，但是磁盘还可以支持并行写，所以即使使用率100%，有可能还可以接收新的I/O（不饱和）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548250191,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1445845,"avatar":"https://static001.geekbang.org/account/avatar/00/16/0f/d5/73ebd489.jpg","nickname":"于加硕","note":"","ucode":"723797D27971A4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308312,"discussion_content":"这个总结收藏了。！！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600913379,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1445845,"avatar":"https://static001.geekbang.org/account/avatar/00/16/0f/d5/73ebd489.jpg","nickname":"于加硕","note":"","ucode":"723797D27971A4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308311,"discussion_content":"我将使用率理解为一条道路上排满了车辆，没有发生拥堵，堵车的现象，每辆车都匀速形式中，即使有新的车辆进入，也会加入正常行驶中。饱和度我理解为，通过fio测试的结果与当前运行的结果的比例差；","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600913359,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61030,"user_name":"Christmas","can_delete":false,"product_type":"c1","uid":1219172,"ip_address":"","ucode":"F48F6BE4A7595B","user_header":"https://static001.geekbang.org/account/avatar/00/12/9a/64/ad837224.jpg","comment_is_top":false,"comment_ctime":1547606024,"is_pvip":false,"replies":[{"id":"22318","content":"是的","user_name":"作者回复","comment_id":61030,"uid":"1001282","ip_address":"","utype":1,"ctime":1548249977,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"57382180872","product_id":100020901,"comment_content":"一趟调度法，电梯调度法等调度是发生在磁盘控制器硬件上的吗？通用块层的调度是os级别的对吧？","like_count":14,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436714,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548249977,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":60936,"user_name":"Cranliu","can_delete":false,"product_type":"c1","uid":1304302,"ip_address":"","ucode":"DC2DE84B142FDA","user_header":"https://static001.geekbang.org/account/avatar/00/13/e6/ee/e3c4c9b3.jpg","comment_is_top":false,"comment_ctime":1547596841,"is_pvip":false,"replies":[{"id":"22312","content":"饱和度一般没法直接观测到，所以一般是通过实际观测值跟基准测试结果对比来分析","user_name":"作者回复","comment_id":60936,"uid":"1001282","ip_address":"","utype":1,"ctime":1548249434,"user_name_real":"倪朋飞"}],"discussion_count":2,"race_medal":0,"score":"31612367913","product_id":100020901,"comment_content":"关于磁盘的饱和度，有没有经验值可以参考下呢？谢谢","like_count":7,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436673,"discussion_content":"饱和度一般没法直接观测到，所以一般是通过实际观测值跟基准测试结果对比来分析","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548249434,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1445845,"avatar":"https://static001.geekbang.org/account/avatar/00/16/0f/d5/73ebd489.jpg","nickname":"于加硕","note":"","ucode":"723797D27971A4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308313,"discussion_content":"我觉得可以通过写程序的方式，将基准测试结果与生产实际运行结果进行匹配，比对，得出结论","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600913503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":60947,"user_name":"ninuxer","can_delete":false,"product_type":"c1","uid":1243135,"ip_address":"","ucode":"5394ADAF2667D6","user_header":"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKQMM4m7NHuicr55aRiblTSEWIYe0QqbpyHweaoAbG7j2v7UUElqqeP3Ihrm3UfDPDRb1Hv8LvPwXqA/132","comment_is_top":false,"comment_ctime":1547597820,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23022434300","product_id":100020901,"comment_content":"day26打卡<br>之前都没用过fio测试磁盘实际性能，基本都是依赖磁盘型号查官网数据作为依据～<br>iostat和iotop倒是会经常用，之前有几列输出的内容自己理解有偏差，这下算是纠正过来了💪","like_count":6},{"had_liked":false,"id":82572,"user_name":"Boy-struggle","can_delete":false,"product_type":"c1","uid":1402286,"ip_address":"","ucode":"94113E2837DC29","user_header":"https://static001.geekbang.org/account/avatar/00/15/65/ae/9727318e.jpg","comment_is_top":false,"comment_ctime":1554253032,"is_pvip":false,"replies":[{"id":"30194","content":"最简单的方法是根据系统调用判断I&#47;O读写的相对位置","user_name":"作者回复","comment_id":82572,"uid":"1001282","ip_address":"","utype":1,"ctime":1554639282,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"14439154920","product_id":100020901,"comment_content":"老师，如何根据系统调用判断IO为随机还是顺序，IO 的位置怎么体现，希望老师可以结合案例具体讲解一下，多谢！","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445643,"discussion_content":"最简单的方法是根据系统调用判断I/O读写的相对位置","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554639282,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65962,"user_name":"麋鹿在泛舟","can_delete":false,"product_type":"c1","uid":1121975,"ip_address":"","ucode":"1379CADA08688E","user_header":"https://static001.geekbang.org/account/avatar/00/11/1e/b7/b20ab184.jpg","comment_is_top":false,"comment_ctime":1549804305,"is_pvip":true,"replies":[{"id":"23682","content":"是的","user_name":"作者回复","comment_id":65962,"uid":"1001282","ip_address":"","utype":1,"ctime":1550065567,"user_name_real":"倪朋飞"}],"discussion_count":3,"race_medal":0,"score":"14434706193","product_id":100020901,"comment_content":"仲鬼<br>2019-01-25<br><br>2<br>&quot;r_await+w_await ，就是响应时间&quot;<br>对这句表述有怀疑。<br>r_await、w_await分别是读、写请求的平均等待时间，二者相加什么都不是。因为a&#47;b + c&#47;d不等于(a+c)&#47;(b+d)。<br>展开<br>作者回复: 从公式上是这样，但间隔时间相同的时候呢？<br><br>man手册解释await是平均等待时间，我理解意思是toal wait time &#47; total req number，跟间隔时间无关<br>-----------------------------------------------<br>&quot;r_await、w_await分别是读、写请求的平均等待时间&quot;基于读写的平均等待时间没错，但是结果也是基于一定的时间范围内的，比如说过去1s，过去5s，显然间隔时间无论设置成多少，都是一样的.<br>即a&#47;t + b&#47;t = (a+b)&#47;t","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438661,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550065567,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1995346,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/72/52/8e81daf1.jpg","nickname":"屈肖东","note":"","ucode":"A6E2250A3CFEA5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":287540,"discussion_content":"你说的不对哦，可以看下iostat的源码，跟你说的1s、5s没有关系，它计算使用的时间并不是时间间隔，而是读花费的时间和写花费的时间","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1593478740,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1318448,"avatar":"","nickname":"zzyalbert","note":"","ucode":"A6E3691ADCAECA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3924,"discussion_content":"我觉的不是，响应时间=(r_await * r_num + w_await * w_num)/(r_num + w_num)\niostat 里有await这一项，并不是将两者简单相加","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1564984207,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62482,"user_name":"程序员历小冰","can_delete":false,"product_type":"c1","uid":1110055,"ip_address":"","ucode":"DBC9D44082D9D3","user_header":"https://static001.geekbang.org/account/avatar/00/10/f0/27/6679da14.jpg","comment_is_top":false,"comment_ctime":1548067505,"is_pvip":false,"replies":[{"id":"22128","content":"建议学习一下各个章节的基本原理和思路，剩下的工具部分作为手册参考。不过有些工具过时了，使用的时候要注意","user_name":"作者回复","comment_id":62482,"uid":"1001282","ip_address":"","utype":1,"ctime":1548116025,"user_name_real":"倪朋飞"}],"discussion_count":2,"race_medal":0,"score":"14432969393","product_id":100020901,"comment_content":"请问作者对《性能之垫-洞悉系统、企业和云计算》这本书的看法？适合作为工具书，用于查阅；还是可以进行通篇学习","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437232,"discussion_content":"建议学习一下各个章节的基本原理和思路，剩下的工具部分作为手册参考。不过有些工具过时了，使用的时候要注意","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548116025,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1244665,"avatar":"https://static001.geekbang.org/account/avatar/00/12/fd/f9/61bdb3f8.jpg","nickname":"未来小鬼","note":"","ucode":"A0ED87F78E6319","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588606,"discussion_content":"这本书翻译真的是差，可见译者翻译没有用心，几乎是机翻的，有些地方名词完全是错误的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663896511,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"江苏"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61746,"user_name":"仲鬼","can_delete":false,"product_type":"c1","uid":1314692,"ip_address":"","ucode":"DB1CD7052D5BA6","user_header":"https://static001.geekbang.org/account/avatar/00/14/0f/84/d8e63885.jpg","comment_is_top":false,"comment_ctime":1547789540,"is_pvip":false,"replies":[{"id":"22327","content":"从公式上是这样，但间隔时间相同的时候呢？","user_name":"作者回复","comment_id":61746,"uid":"1001282","ip_address":"","utype":1,"ctime":1548251040,"user_name_real":"倪朋飞"}],"discussion_count":2,"race_medal":0,"score":"14432691428","product_id":100020901,"comment_content":"&quot;r_await+w_await ，就是响应时间&quot;<br>对这句表述有怀疑。<br>r_await、w_await分别是读、写请求的平均等待时间，二者相加什么都不是。因为a&#47;b + c&#47;d不等于(a+c)&#47;(b+d)。<br>","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436975,"discussion_content":"从公式上是这样，但间隔时间相同的时候呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548251040,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1013424,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/b0/14fec62f.jpg","nickname":"不了峰","note":"","ucode":"E23B96D6A3D4EC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551163,"discussion_content":"应该是  r/t + w/t = (r+w)/t 这就对了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1644914684,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":151883,"user_name":"88591","can_delete":false,"product_type":"c1","uid":1254656,"ip_address":"","ucode":"04CE3E46455185","user_header":"https://static001.geekbang.org/account/avatar/00/13/25/00/3afbab43.jpg","comment_is_top":false,"comment_ctime":1573806079,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10163740671","product_id":100020901,"comment_content":"老师 ，应用程序可以控制磁盘的顺序写吗？","like_count":2},{"had_liked":false,"id":63515,"user_name":"仲鬼","can_delete":false,"product_type":"c1","uid":1314692,"ip_address":"","ucode":"DB1CD7052D5BA6","user_header":"https://static001.geekbang.org/account/avatar/00/14/0f/84/d8e63885.jpg","comment_is_top":false,"comment_ctime":1548387457,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10138322049","product_id":100020901,"comment_content":"&quot;r_await+w_await ，就是响应时间&quot;<br>对这句表述有怀疑。<br>r_await、w_await分别是读、写请求的平均等待时间，二者相加什么都不是。因为a&#47;b + c&#47;d不等于(a+c)&#47;(b+d)。<br>展开<br>作者回复: 从公式上是这样，但间隔时间相同的时候呢？<br><br>man手册解释await是平均等待时间，我理解意思是toal wait time &#47; total req number，跟间隔时间无关","like_count":3,"discussions":[{"author":{"id":1069133,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/4d/db91e218.jpg","nickname":"sam700000","note":"","ucode":"C2ABDDC56B2D50","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3488,"discussion_content":"我觉得其实不必纠结于分母，分母就是一段间隔时间内的读或者写次数。但是分母不同不影响平均值相加，因为这个平均值的意义就是每次读或者写请求处理完成的平均时间，样本个数不同影响的只是精度，我是这样理解的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564536415,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356682,"user_name":"Geek_e2b0f9","can_delete":false,"product_type":"c1","uid":1602650,"ip_address":"北京","ucode":"CAB31078DDB515","user_header":"","comment_is_top":false,"comment_ctime":1662512776,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1662512776","product_id":100020901,"comment_content":"怎么分析io类型 是连续还是随机","like_count":1},{"had_liked":false,"id":334674,"user_name":"Black🐯","can_delete":false,"product_type":"c1","uid":1593345,"ip_address":"","ucode":"9AD756BD5D1C4D","user_header":"https://static001.geekbang.org/account/avatar/00/18/50/01/128bdef2.jpg","comment_is_top":false,"comment_ctime":1645068756,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1645068756","product_id":100020901,"comment_content":"使用率，是指磁盘处理 I&#47;O 的时间百分比。过高的使用率（比如超过 80%），通常意味着磁盘 I&#47;O 存在性能瓶颈。<br>%util ，就是我们前面提到的磁盘 I&#47;O 使用率；<br>---------------------------------------<br>man手册对%util的解释：Percentage  of elapsed time during which I&#47;O requests were issued to the device (bandwidth utilization for the device). Device saturation occurs when this value is close to 100%.<br>向设备发出I&#47;O请求所用的时间百分比（设备的带宽利用率）。当该值接近100%时，设备饱和。<br>换成公式的话，就是： 请求时间&#47;（请求时间+io处理时间）","like_count":0,"discussions":[{"author":{"id":1654090,"avatar":"https://static001.geekbang.org/account/avatar/00/19/3d/4a/7e488810.jpg","nickname":"闪电瘸子","note":"","ucode":"7C6723D14693AB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":561308,"discussion_content":"应该是 Io处理时间/（请求时间+io处理时间）？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649597201,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":334673,"user_name":"Black🐯","can_delete":false,"product_type":"c1","uid":1593345,"ip_address":"","ucode":"9AD756BD5D1C4D","user_header":"https://static001.geekbang.org/account/avatar/00/18/50/01/128bdef2.jpg","comment_is_top":false,"comment_ctime":1645068604,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1645068604","product_id":100020901,"comment_content":"%util ，就是我们前面提到的磁盘 I&#47;O 使用率；<br>-----------------------------<br>man手册对%util的解释","like_count":0},{"had_liked":false,"id":323966,"user_name":"折腾青春","can_delete":false,"product_type":"c1","uid":2187228,"ip_address":"","ucode":"969A612EE3B938","user_header":"https://static001.geekbang.org/account/avatar/00/21/5f/dc/a3a0c113.jpg","comment_is_top":false,"comment_ctime":1638241899,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638241899","product_id":100020901,"comment_content":"在用k8s里面搭建prometheus operator，自带了面板用了node_disk_io_time_weighted_seconds:rate1m去观察磁盘饱和度，这个值是准确的吗","like_count":0},{"had_liked":false,"id":311228,"user_name":"chaoxifuchen","can_delete":false,"product_type":"c1","uid":1292330,"ip_address":"","ucode":"95DCC5C4994F68","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/VX0ib4CV0m7fwxB2xFcIJaYYWXXpfxxYbfBErqBej9395hgZszqS3dz9bThCxOuFfJ8Xibx9HbdNmZJwL5m33wIw/132","comment_is_top":false,"comment_ctime":1631112545,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631112545","product_id":100020901,"comment_content":"现在业务应用程序对数据的操作有数据库，缓存中间件，一般只有日志直接涉及io读写，对io性能比较敏感的主要有数据库，es,prometheus等应用","like_count":0},{"had_liked":false,"id":310299,"user_name":"AceslupK","can_delete":false,"product_type":"c1","uid":1284474,"ip_address":"","ucode":"048F84D019CBBB","user_header":"https://static001.geekbang.org/account/avatar/00/13/99/7a/558666a5.jpg","comment_is_top":false,"comment_ctime":1630581394,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1630581394","product_id":100020901,"comment_content":"IOPS vs 吞吐量 <br>每秒IO请求数，每秒IO请求大小，这该咋区分","like_count":0,"discussions":[{"author":{"id":1061803,"avatar":"https://static001.geekbang.org/account/avatar/00/10/33/ab/d8ba4242.jpg","nickname":"哒哒哒","note":"","ucode":"9378AD329F8AE0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":547477,"discussion_content":"请求的个数和请求的数据量大小还是不同的，衡量的维度不同。后者的单位是KB/MB等。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642690094,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":309558,"user_name":"言十年","can_delete":false,"product_type":"c1","uid":1110039,"ip_address":"","ucode":"67B8B49C3A3B17","user_header":"https://static001.geekbang.org/account/avatar/00/10/f0/17/796a3d20.jpg","comment_is_top":false,"comment_ctime":1630230873,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1630230873","product_id":100020901,"comment_content":"工作多年，没有关注过IO这个问题。<br>观测命令。到是让我觉得，可以看一个进程打日志的速率。评估下磁盘容量了。或者优化程序中没必要的日志打印。<br>还有看打日志多的进程。","like_count":0},{"had_liked":false,"id":272643,"user_name":"言希","can_delete":false,"product_type":"c1","uid":1154218,"ip_address":"","ucode":"D7F80B86BCAF2E","user_header":"https://static001.geekbang.org/account/avatar/00/11/9c/aa/6f780187.jpg","comment_is_top":false,"comment_ctime":1610184079,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1610184079","product_id":100020901,"comment_content":"老师您好，我请假一个磁盘性能问题<br>我在压测Kafka写性能的时候发现如下问题<br>物理机挂载多块HDD盘，应用程序采用 内存映射的方式来写文件<br>现象：当随机性越强，多块盘的utils使用率会下降的很明显，增加客户端去压也压不上去<br>个人感觉瓶颈出在OS将数据从PageCache刷到磁盘，导致应用程序写PageCache会阻塞<br>","like_count":0},{"had_liked":false,"id":268106,"user_name":"海盗船长","can_delete":false,"product_type":"c1","uid":1363634,"ip_address":"","ucode":"ECB28BA21A4113","user_header":"https://static001.geekbang.org/account/avatar/00/14/ce/b2/1f914527.jpg","comment_is_top":false,"comment_ctime":1608074598,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608074598","product_id":100020901,"comment_content":"老师请问下：网络存储在创建目录和删除文件时比较慢，如何定位呀？","like_count":0},{"had_liked":false,"id":210485,"user_name":"马吉辉","can_delete":false,"product_type":"c1","uid":1854657,"ip_address":"","ucode":"4265EFBD2BB7BD","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKVIjh4T1akib5iav5IIGjXB9x98p9Y80STRcwpMDqxfGLrMvHamxlxEqLMTpiayWFWSNpBcbGwkRjRw/132","comment_is_top":false,"comment_ctime":1587776131,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1587776131","product_id":100020901,"comment_content":"其中 iostat 工具中的指标<br>%util ，就是我们前面提到的磁盘 I&#47;O 使用率；<br>r&#47;s+ w&#47;s ，就是 IOPS；<br>rkB&#47;s+wkB&#47;s ，就是吞吐量；<br>r_await+w_await ，就是响应时间。<br><br>问题：老师这些指标，对于ssd 或者机械盘 的正常指标范围是什么？","like_count":0,"discussions":[{"author":{"id":2015614,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/c1/7e/581ea34e.jpg","nickname":"苏世勇","note":"","ucode":"88BA5201E87783","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293972,"discussion_content":"可以使用fio对磁盘进行压测，不同类型，品牌，型号的磁盘指标并不一样","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1595749506,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2288440,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/bnE6A7diaOmMbOSYnu11Be9WibOSdSCs1ibRpiavUJ0q2vE1XGoicDLufZziato07AgNd43B8LetSOIOCibw0uO9zrqJw/132","nickname":"Geek_340f72","note":"","ucode":"04143CCC5430A5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":343149,"discussion_content":"不同的厂商应该标准也会有差异","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610956981,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":204890,"user_name":"刘友淙","can_delete":false,"product_type":"c1","uid":1620058,"ip_address":"","ucode":"97F3A69A308313","user_header":"","comment_is_top":false,"comment_ctime":1586487265,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586487265","product_id":100020901,"comment_content":"D11 打卡","like_count":0},{"had_liked":false,"id":196289,"user_name":"流水","can_delete":false,"product_type":"c1","uid":1055290,"ip_address":"","ucode":"433A403982C15A","user_header":"https://static001.geekbang.org/account/avatar/00/10/1a/3a/9001e627.jpg","comment_is_top":false,"comment_ctime":1585270254,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585270254","product_id":100020901,"comment_content":"磁盘饱和度是不是可以拿raid0来举例，raid0的磁盘阵列有多块磁盘，不同磁盘可以并行处理请求，所以util达到100%时可能还可以处理新的请求","like_count":0},{"had_liked":false,"id":182282,"user_name":"Geek_c381b9","can_delete":false,"product_type":"c1","uid":1622928,"ip_address":"","ucode":"CE6385CD3195F9","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoIjyuqRzMHzoaG0zOrnxVLfUyicTXvoUibktQ2errj7GUk5W2jyWGyjoANw7VVxxIDJ7b8pIou664Q/132","comment_is_top":false,"comment_ctime":1582762201,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1582762201","product_id":100020901,"comment_content":"如何能达到顺序I&#47;O写","like_count":0,"discussions":[{"author":{"id":1543040,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/80/8702bd5f.jpg","nickname":"evan","note":"","ucode":"491B073D5AFEDE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":317955,"discussion_content":"直接代码层面顺序读写, leveldb rocksdb都是基于lsm tree模型的顺序读写db","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603622201,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2068424,"avatar":"","nickname":"Geek_9815f1","note":"","ucode":"34EE8566A53F10","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291907,"discussion_content":"自己在代码上控制写文件的顺序","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594996335,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":145989,"user_name":"Backus","can_delete":false,"product_type":"c1","uid":1314844,"ip_address":"","ucode":"34BF63BC81C7E8","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoSMRiaMtAcqQ3YJOQTlqxnUp5w7p8jZKXiablY8alkPHvubjzbnlsSq4zkpO3F1OibyYLIv6jzB7CnA/132","comment_is_top":false,"comment_ctime":1572413726,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1572413726","product_id":100020901,"comment_content":"Iostat vmstat这些命令，第一行数据是不是数据不准，能代表什么吗","like_count":0,"discussions":[{"author":{"id":2616028,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ea/dc/aa699264.jpg","nickname":"宏典","note":"","ucode":"63953F36596C28","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":396160,"discussion_content":"man vmstat 可以看到以下信息：\nvmstat reports information about processes, memory, paging, block IO, traps, disks and cpu activity.\nThe  first  report produced gives averages since the last reboot.  Additional reports give information on a sampling period of length delay.  The process and memory reports are instantaneous in either case.\n\n这里提到第一行数据是上次reboot到目前的平均值。\n\n同样，iostat：\nThe first report generated by the iostat command provides statistics concerning the time since the system was booted, unless the -y option is used (in this case, this first re‐port is omitted).","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632399723,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112167,"user_name":"Geek_72833c","can_delete":false,"product_type":"c1","uid":1447573,"ip_address":"","ucode":"B6BA1C75D4B401","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erw2xoaJngrK42TQauB0WSvar7ACIj1FzSyeXsV8f74aibkYbrLNU0mlqgtpGtKX3OV9D7iaiboE74cA/132","comment_is_top":false,"comment_ctime":1562677426,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1562677426","product_id":100020901,"comment_content":"磁盘使用率这个指标通常不够准确 经常会标到80以上 突发的","like_count":0},{"had_liked":false,"id":100157,"user_name":"初学者","can_delete":false,"product_type":"c1","uid":1042833,"ip_address":"","ucode":"9471A905D07CE1","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e9/91/4219d305.jpg","comment_is_top":false,"comment_ctime":1559463680,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1559463680","product_id":100020901,"comment_content":"还是无法理解利用率和饱和度怎么计算出来的，利用率 - 是指磁盘处理 I&#47;O 的时间百分比，分子是什么指标，分母是什么指标？","like_count":0,"discussions":[{"author":{"id":1061803,"avatar":"https://static001.geekbang.org/account/avatar/00/10/33/ab/d8ba4242.jpg","nickname":"哒哒哒","note":"","ucode":"9378AD329F8AE0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":547478,"discussion_content":"都是时间，我的理解是单位时间内处理IO的时间占比。比如1s内，实际处理IO的时间是500ms，那么使用率就是50%。 想想CPU的使用率也是从时间维度来计算的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642690359,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81171,"user_name":"张挺","can_delete":false,"product_type":"c1","uid":1038954,"ip_address":"","ucode":"CDF8549440926D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/da/6a/91bd13de.jpg","comment_is_top":false,"comment_ctime":1553824935,"is_pvip":false,"replies":[{"id":"29605","content":"使用率，是指磁盘处理 I&#47;O 的时间百分比","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1554014489,"ip_address":"","comment_id":81171,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1553824935","product_id":100020901,"comment_content":"使用率指标不太理解，请问这个值是怎么计算出来的呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445101,"discussion_content":"使用率，是指磁盘处理 I/O 的时间百分比","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554014489,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1129668,"avatar":"https://static001.geekbang.org/account/avatar/00/11/3c/c4/7c2bf312.jpg","nickname":"草根","note":"","ucode":"7C97CB09A4D8F1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540992,"discussion_content":"那磁盘还要什么其他处理任务呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640228272,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79311,"user_name":"Vincent","can_delete":false,"product_type":"c1","uid":1221267,"ip_address":"","ucode":"FF679EAE2B683D","user_header":"https://static001.geekbang.org/account/avatar/00/12/a2/93/cfed7c6c.jpg","comment_is_top":false,"comment_ctime":1553433574,"is_pvip":false,"replies":[{"id":"29042","content":"数组和链表还是内存中的数据结构，I&#47;O是指跟磁盘的交互。跟踪进程的系统调用或者磁盘的I&#47;O，根据读写的相对位置可以判断","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553526048,"ip_address":"","comment_id":79311,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553433574","product_id":100020901,"comment_content":"随机io和顺序io就跟数据结构有关系了吧？比如数组和链表。除了通过代码判断是随机io还是顺序io 系统有什么工具可以判断吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444445,"discussion_content":"数组和链表还是内存中的数据结构，I/O是指跟磁盘的交互。跟踪进程的系统调用或者磁盘的I/O，根据读写的相对位置可以判断","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553526048,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79238,"user_name":"挺直腰板","can_delete":false,"product_type":"c1","uid":1178397,"ip_address":"","ucode":"B7DD679A3A4EEB","user_header":"https://static001.geekbang.org/account/avatar/00/11/fb/1d/12c7c021.jpg","comment_is_top":false,"comment_ctime":1553413476,"is_pvip":false,"replies":[{"id":"29050","content":"可以通过系统调用观察I&#47;O的相对位置","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553526400,"ip_address":"","comment_id":79238,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1553413476","product_id":100020901,"comment_content":"老师，如何知道是随机IO还是顺序IO,两者性能差还是蛮大","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444411,"discussion_content":"可以通过系统调用观察I/O的相对位置","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553526400,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2242772,"avatar":"","nickname":"Alice","note":"","ucode":"46CD751A0A0D56","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":531274,"discussion_content":"老师，系统调用怎么看呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637279909,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":72485,"user_name":"苦行僧","can_delete":false,"product_type":"c1","uid":1055334,"ip_address":"","ucode":"726024A9A9CF44","user_header":"https://static001.geekbang.org/account/avatar/00/10/1a/66/2d9db9ed.jpg","comment_is_top":false,"comment_ctime":1551658080,"is_pvip":false,"replies":[{"id":"26331","content":"这要看场景的，需要先定位出瓶颈是哪里导致的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551706607,"ip_address":"","comment_id":72485,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551658080","product_id":100020901,"comment_content":"老师在使用网络挂载的共享存储io性能差，有什么优化方式吗","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441611,"discussion_content":"这要看场景的，需要先定位出瓶颈是哪里导致的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551706607,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63177,"user_name":"jssfy","can_delete":false,"product_type":"c1","uid":1137238,"ip_address":"","ucode":"F16353CFE607B7","user_header":"https://static001.geekbang.org/account/avatar/00/11/5a/56/115c6433.jpg","comment_is_top":false,"comment_ctime":1548293884,"is_pvip":false,"replies":[{"id":"22581","content":"应该是可以的，不过我没有试过，你可以执行一下看看","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548576369,"ip_address":"","comment_id":63177,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548293884","product_id":100020901,"comment_content":"iotop可以看到在nfs上的流量不？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437491,"discussion_content":"应该是可以的，不过我没有试过，你可以执行一下看看","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548576369,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62602,"user_name":"刘涛^_^","can_delete":false,"product_type":"c1","uid":1168763,"ip_address":"","ucode":"ECE01CE9AC9C0E","user_header":"https://static001.geekbang.org/account/avatar/00/11/d5/7b/e863af2a.jpg","comment_is_top":false,"comment_ctime":1548119177,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1548119177","product_id":100020901,"comment_content":"老师，IO的饱和度怎么衡量","like_count":0},{"had_liked":false,"id":61769,"user_name":"dexter","can_delete":false,"product_type":"c1","uid":1315252,"ip_address":"","ucode":"DD51207438FBD6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEL5xnfuicbtRz4F87AAjZX6oCEjMtYiaIu4iaQichQmy0vEBA6Sumic1RDvUCeuBEqj6iatnt2kENbKYmuw/132","comment_is_top":false,"comment_ctime":1547796780,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1547796780","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":61534,"user_name":"fran712","can_delete":false,"product_type":"c1","uid":1284429,"ip_address":"","ucode":"B09A1186FA1FA5","user_header":"","comment_is_top":false,"comment_ctime":1547715503,"is_pvip":false,"replies":[{"id":"22323","content":"区别是你怎么创建文件系统的，是使用分区还是整块磁盘","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548250519,"ip_address":"","comment_id":61534,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547715503","product_id":100020901,"comment_content":"请问将&#47;dev&#47;sda直接挂载到某个目录和将磁盘只一个分区后，&#47;dev&#47;sda1挂载到某个目录，这两种挂载的区别是什么？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436900,"discussion_content":"区别是你怎么创建文件系统的，是使用分区还是整块磁盘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548250519,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61486,"user_name":"一生一世","can_delete":false,"product_type":"c1","uid":1254081,"ip_address":"","ucode":"D8C3E55A920676","user_header":"https://static001.geekbang.org/account/avatar/00/13/22/c1/d402bfbf.jpg","comment_is_top":false,"comment_ctime":1547706976,"is_pvip":false,"replies":[{"id":"22322","content":"这需要基准测试的，我的机器指标很可能不适合你的环境","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548250486,"ip_address":"","comment_id":61486,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547706976","product_id":100020901,"comment_content":"老师能否提供一些参数性能指标参考，有时候能看到指标却无法确定是否有问题","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436886,"discussion_content":"这需要基准测试的，我的机器指标很可能不适合你的环境","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548250486,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61409,"user_name":"行行行","can_delete":false,"product_type":"c1","uid":1066121,"ip_address":"","ucode":"2A8481C263FBD2","user_header":"","comment_is_top":false,"comment_ctime":1547692714,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1547692714","product_id":100020901,"comment_content":"老师页框回收算法可以讲下吗","like_count":0},{"had_liked":false,"id":61132,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1547624935,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1547624935","product_id":100020901,"comment_content":"[D25打卡]<br>今天又见到了新工具FIO和iotop<br>之前都是用的 vmstat iostat pidstat .<br>以前没有这么精细的分析i&#47;o.因为程序的瓶颈不在这块.","like_count":0},{"had_liked":false,"id":61018,"user_name":"唯美","can_delete":false,"product_type":"c1","uid":1263430,"ip_address":"","ucode":"9186A5B99DFBCA","user_header":"https://static001.geekbang.org/account/avatar/00/13/47/46/61f16147.jpg","comment_is_top":false,"comment_ctime":1547604431,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1547604431","product_id":100020901,"comment_content":"打卡Day24","like_count":0},{"had_liked":false,"id":61001,"user_name":"划时代","can_delete":false,"product_type":"c1","uid":1061454,"ip_address":"","ucode":"9554CE2F83B77F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/2o1Izf2YyJSnnI0ErZ51pYRlnrmibqUTaia3tCU1PjMxuwyXSKOLUYiac2TQ5pd5gNGvS81fVqKWGvDsZLTM8zhWg/132","comment_is_top":false,"comment_ctime":1547602893,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1547602893","product_id":100020901,"comment_content":"之前写过一个跨语言日志库，将它的压测结果和iozone的基准测试数据进行对比。","like_count":0},{"had_liked":false,"id":60983,"user_name":"胡萝卜","can_delete":false,"product_type":"c1","uid":1056926,"ip_address":"","ucode":"306139A86C182D","user_header":"https://static001.geekbang.org/account/avatar/00/10/20/9e/3278e1d8.jpg","comment_is_top":false,"comment_ctime":1547600990,"is_pvip":false,"replies":[{"id":"22315","content":"磁盘处理 I&#47;O 的繁忙程度，也就是能否接受新的 I&#47;O 请求","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548249644,"ip_address":"","comment_id":60983,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1547600990","product_id":100020901,"comment_content":"饱和度具体是怎么定义的呢？还是有的明白","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436694,"discussion_content":"磁盘处理 I/O 的繁忙程度，也就是能否接受新的 I/O 请求","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548249644,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1445845,"avatar":"https://static001.geekbang.org/account/avatar/00/16/0f/d5/73ebd489.jpg","nickname":"于加硕","note":"","ucode":"723797D27971A4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308319,"discussion_content":"老师，我们通过fio压测出来的结果就是该机型的上限吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600915340,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":60974,"user_name":"二三子也","can_delete":false,"product_type":"c1","uid":1245787,"ip_address":"","ucode":"69C7D86583277D","user_header":"https://static001.geekbang.org/account/avatar/00/13/02/5b/ce326cfc.jpg","comment_is_top":false,"comment_ctime":1547600073,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1547600073","product_id":100020901,"comment_content":"Flag<br>2019&#47;01&#47;16","like_count":0}]}