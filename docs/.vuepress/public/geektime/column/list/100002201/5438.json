{"id":5438,"title":"65 |  区块链技术细节：加密和挖矿","content":"<p>你好，我是陈皓，网名左耳朵耗子。</p>\n<p>前面一讲中提到的技术解决了交易信息不能被篡改的问题。但还有一个比较重要的问题，那就是，我们每个人只能发起和自己有关的交易，也就是能发起自己对别人付钱的交易，我们不能发起别人对我付钱，或是别人向别人付钱的交易。</p>\n<p>那么，在比特币中是怎么解决这个问题的？让我们先看一些基础的加密技术。</p>\n<h1>比特币的加密方法</h1>\n<h2>密钥对/签名/证书</h2>\n<p>所谓密钥对，也就是一种非对称加密技术。这种技术，在对信息进行加密和解密时，使用两个不同的密钥。这样一来，我们就可以把其中一个密钥公布出去，称之为公钥，另一个密钥私密地保管好，称之为私钥。</p>\n<p>现实社会中，有人使用公钥加密，私钥解密，也有反过来用私钥加密，公钥解密，这得看具体的场景。（比特币使用了非对称加密的技术，其使用了<a href=\"https://en.wikipedia.org/wiki/Elliptic_Curve_Digital_Signature_Algorithm\">ECDSA</a> 密钥对比技术。）</p>\n<p>比如，我把我加密的密钥发布给所有人，然后大家都用这个公钥加密信息，但其他人没有私钥，所以他们解不了密文，只有我能解密文，也只有我能看得懂别人用我的公钥加密后发给我的密文。如下图所示。</p>\n<p><img src=\"https://static001.geekbang.org/resource/image/ee/71/ee63472f10b0c179a5c3c58d47d9f271.png?wh=864*385\" alt=\"\" /></p>\n<p>但是，这会有个问题，那就是每个人都有我的公钥，别人可以截获Mike发给我的信息，然后自己用我的公钥加密一个别的信息，伪装成Mike发给我， 这样我就被黑了。于是，我们需要对Mike的身份进行验证，此时就需要用到“数字签名”的概念了。</p>\n<!-- [[[read_end]]] -->\n<p>Mike也有一对密钥对，一个公钥给了我，私钥自己保留。</p>\n<ul>\n<li>\n<p>Mike发自己想要的信息，做个SHA或MD5的hash，得到一个hash串，又叫Digest。</p>\n</li>\n<li>\n<p>Mike用自己的私钥，把Digest加密，得到一段Digest的密文。我们把这个事叫数字签名，Signature。</p>\n</li>\n<li>\n<p>然后，Mike把他想发给我的信息用我的公钥加密后，连同他的数字签名一同发给我。</p>\n</li>\n<li>\n<p>我用我的私钥解密Mike发给我的密文，然后用Mike的公钥解密其数字签名得到Digest。然后，我用SHA或MD5对解开的密文做Hash。如果结果和Digest一致，就说明，这个信息是Mike发给我的，没有人更改过。</p>\n</li>\n</ul>\n<p>这个过程如下图所示。</p>\n<p><img src=\"https://static001.geekbang.org/resource/image/5a/28/5a44ceb1af5a27cc0873cbe4e2571028.png?wh=864*264\" alt=\"\" /></p>\n<p>但是问题还没完。假设有个黑客偷偷地把Jack电脑上的Mike的公钥给换了，换成自己的，然后截获Mike发出来的信息，用自己的密钥加密一段自己的信息，以及自己的数字签名。</p>\n<p>于是，对于Jack来看，因为他用了黑客的公钥，而不是Mike的，那么对他来说，他就以为信息来自Mike，于是黑客可以用自己的私钥伪装成Mike给Jack通信。反之亦然，于是黑客就可以在中间伪装成Jack或Mike来通信，这就是中间人攻击。如下图所示。</p>\n<p><img src=\"https://static001.geekbang.org/resource/image/87/00/876f36ed6a0a617f6356603798f7d700.png?wh=864*262\" alt=\"\" /></p>\n<p>这个时候就比较麻烦了。Mike看到有人在伪造他的公钥，想了想，他只能和Jack找了个大家都相信的永不作恶的权威的可信机构来认证他的公钥。这个权威机构，用自己的私钥把Mike的公钥和其相关信息一起加密，生成一个证书。</p>\n<p>此时，Jack就可以放心地使用这个权威机构的证书了。Mike只需要在发布其信息的时候放上这个权威机构发的数字证书，然后Jack用这个权威机构的公钥解密这个证书，得到Mike的公钥，再用Mike的公钥来验证Mike的数字签名。</p>\n<p><img src=\"https://static001.geekbang.org/resource/image/bb/57/bb3a47bf0b8c84a6c85d864c88739357.png?wh=864*408\" alt=\"\" /></p>\n<p>上面就是整个密钥对、签名和证书的全部基础细节。比特币也用了这样的基础技术来认证用户的身份的。下面，我们来看看比特币的一些细节。</p>\n<h2>比特币的加密</h2>\n<p>在比特币的世界里，每一笔交易的From和To都是每个用户的公钥（Public Key）。也就是说，使用用户的公钥来做交易的账户。于是，这个过程很简单。</p>\n<ul>\n<li>\n<p>交易的发起方只能是支付方，支付方需要用自己的私钥来加密交易信息并制作相关的交易签名。</p>\n</li>\n<li>\n<p>网络上其他人会用你的公钥（也就是交易的支出方）来做解密来验证。</p>\n</li>\n</ul>\n<p>为什么不需要那个证书机构呢？不怕中间人攻击吗？这是因为，如果黑客想要伪造一笔别人的交易，那么他需要换掉半数以上结点上的被攻击者的公钥，这不太现实。与其这样做，还不如去偷被攻击者的私钥，可能还简单一些。</p>\n<p>下面是一个交易链的图示。这个交易链的钱从A -&gt; B -&gt; C -&gt; D，一共3笔交易。</p>\n<p><img src=\"https://static001.geekbang.org/resource/image/fe/a8/feaaa557eab454dd1678415da7f554a8.png?wh=722*387\" alt=\"\" /></p>\n<p>图片来源：<a href=\"http://www.righto.com/2014/02/bitcoins-hard-way-using-raw-bitcoin.html\">Ken Shirriff Blog</a></p>\n<ul>\n<li>\n<p><strong>发起交易</strong>。我们从第一笔交易可以看到，A用自己的私钥为交易信息和自己的地址生成了交易的签名，然后把交易信息、自己的地址、交易签名和自己的公钥放出去，这样方便别人来验证的确是A发起的。</p>\n</li>\n<li>\n<p><strong>验证交易</strong>。在验证时，使用A的公钥解密交易签名，得到交易的hash值。把交易信息和自己的地址做hash，看看是不是和签名解密后的hash值一致。</p>\n</li>\n</ul>\n<p>这里需要注意一个细节，比特币的地址是由我们的公钥生成的，生成规则比较复杂，可以参看Bitcoin的Wiki页 - <a href=\"https://en.bitcoin.it/wiki/Technical_background_of_version_1_Bitcoin_addresses\">Technical background of version 1 Bitcoin addresses</a>。</p>\n<h1>比特币的挖矿</h1>\n<p>前面说到，在比特币的区块hash算法中，要确保下面这个公式成立：</p>\n<pre><code>SHA-256(SHA-256 (Block Header)) &lt; Target\n</code></pre>\n<p>而在区块头中，可以完全自由修改的只有一个字段，就是Nonce，其他的Timestamp可以在特定范围内修改，Merkle Root和你需要记录的交易信息有关系（所有的矿工可以自由地从待确认交易列表中挑选自己想要的交易打包）。</p>\n<p>所以，基本上来说，你要找到某个数字，让整个hash值小于Target。这个Target是一个数，<strong>其决定了，我们计算出来的hash值的字符串最前面有几个零</strong>。我们知道，hash值本身就是一串相对比较随机的字符串。但是要让这个随机的字符串有规律，是一件很困难的事，除了使用暴力破解，没有其他办法。在计算机世界里，我们把这个事叫&quot;哈希碰撞&quot;(hash collision)，碰撞前几个位都是0的哈希值。</p>\n<p>下面是一个示例。我想找到一个数，其和&quot;ChenHao&quot;加起来被hash后的值前面有5个零。</p>\n<p>测试程序如下：</p>\n<pre><code>import hashlib\n\ndata=&quot;ChenHao&quot;\n\nn=1\nwhile n &lt; 2**32:\n    str = data + `n`\n    hash = hashlib.sha256(str).hexdigest()\n    hash = hashlib.sha256(hash).hexdigest()\n    if hash.startswith('00000'):\n        print  str, hash\n        break\n    n = n + 1\n</code></pre>\n<p>这是一个暴力破解的算法。这个程序在我的MacBook Pro上基本要10秒钟才跑得出来结果。</p>\n<p>找到1192481时，找到了第一个解，如下所示：</p>\n<pre><code>ChenHao1192481   \n00000669e0eeb33ee5dbb672d3bd2deb0c32ef9879ef260f0debbdcb80121160\n</code></pre>\n<p>那么，控制前面有多个0的那个Target又是怎么来的呢？是由Bits这个字段控制的，也就是难度系数，前面需要的0越多，难度也就越大。其中的算法你可以看一下Bitcoin的Wiki上的<a href=\"https://en.bitcoin.it/wiki/Difficulty\">Difficulty词条</a>，这里我就不多说了。</p>\n<p><strong>这个难度系数，会在每出2016个区块后就调整一次。现在，这个难度是要在前面找到有18个零。如下所示(一个真实的区块链的Hash值)</strong>：</p>\n<p><a href=\"https://blockchain.info/block/000000000000000000424118cc80622cb26c07b69fbe2bdafe57fea7d5f59d68\">000000000000000000424118cc80622cb26c07b69fbe2bdafe57fea7d5f59d68</a></p>\n<p>**一个SHA-256算法算出来的哈希值有  $2^{256}$ 种可能性，而前面有18个零意味着前面有72个bits是零。于是，满足条件的哈希值是有$2^{184}$种可能性，概率是$\\frac{1}{2^{72}}$  **。</p>\n<p>是的，很有可能你穷举完Nonce后还找不到，那就只能调整Timestamp和Merkle Root（调整不同的记账交易）了。</p>\n<p>所以，一般的挖矿流程如下。</p>\n<ul>\n<li>\n<p>从网络上取得之前的区块信息。</p>\n</li>\n<li>\n<p>从&quot;待记账区&quot;中获取一组交易数据（有优先级，比如成长时间、矿工小费等）。</p>\n</li>\n<li>\n<p>形成区块头（计算Merkle Root并设计记账时间Timestamp等）。</p>\n</li>\n<li>\n<p>开始穷举Nonce，来计算区块头的hash值。如果前面有18个零（小于Target），那么记账成功。如果没有，则从第一步重新开始。</p>\n</li>\n<li>\n<p>一旦某矿工成功打包一个区块，他就会告诉其他矿工。收到消息的矿工会停下手上的工作，开始验证，验证通过后，广播给其他矿工。</p>\n</li>\n</ul>\n<p>所以，满足条件的这个难度系数成为了挖矿的关键。设置这个难度系数就是为了让全网产生的区域名平均在10分钟一块。而根据比特币无中心服务器的架构，也就是其挖矿的机器数量是想来就来想走就走的，计算力可能会不一样。因此，为了保证每10分钟产生一个区块，当算力不足的时候，难度下降，当算力充足的时候，难度提高。</p>\n<p>今天的这18个零，基本上来说，一般的电脑和服务器就不用想了，必须要算力非常非常高的机器才能搞定。所以，在今天，挖矿这个事，已经不是一般老百姓能玩的了。</p>\n<p>下图展示了整个比特币的难度历史。</p>\n<p><img src=\"https://static001.geekbang.org/resource/image/4d/14/4d7e09ee0c03a807c1c5326d0d5c2e14.png?wh=849*566\" alt=\"\" /><br />\n（图片来源：<a href=\"http://bitcoin.sipa.be\">http://bitcoin.sipa.be</a> ）</p>\n<p>上面这个图只是算力的表现，可能并不直观。我们还是用其耗电量来说可能会更好一些。根据&quot;Bitcoin Energy Consumption Index&quot;统计，截至 2017年11 月 20 日，比特币过去一年挖矿的电力总消耗已累计达 29.51 TWh（1TWh = $10^{12}$ Wh），约占全球总电力消耗的 0.13%。该数字甚至已经超过近 160 个国家或地区一年的电力消耗，包含冰岛和尼日利亚。若全球的比特币矿工自成一国，该国的电力消耗排名可排到全球第 61 名。</p>\n<p>看到这里，你一定要问，为什么要挖矿呢，不就是记个账呗。为了系统地说明这个问题，我们下节课来看看去中心化的共识机制。</p>\n<p>文末给出了《区块链技术》系列文章的目录，希望这一系列内容对你有启发，有帮助。</p>\n<ul>\n<li><a href=\"https://time.geekbang.org/column/article/5197\">区块链的革命性及技术概要</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/5363\">区块链技术细节：哈希算法</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/5438\">区块链技术细节：加密和挖矿</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/5612\">去中心化的共识机制</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/5623\">智能合约</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/5636\">传统金融和虚拟货币</a></li>\n</ul>\n","neighbors":{"left":{"article_title":"64 | 区块链技术细节：哈希算法","id":5363},"right":{"article_title":"66 | 区块链技术细节：去中心化的共识机制","id":5612}},"comments":[{"had_liked":false,"id":5229,"user_name":"陈小喵～","can_delete":false,"product_type":"c1","uid":1019019,"ip_address":"","ucode":"527380770B6230","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8c/8b/53ee320d.jpg","comment_is_top":false,"comment_ctime":1522904525,"is_pvip":false,"replies":[{"id":"1432","content":"后面我会写提高学习能力的文章，敬请关注！","user_name":"作者回复","user_name_real":"左耳朵","uid":"1001269","ctime":1523160777,"ip_address":"","comment_id":5229,"utype":1}],"discussion_count":1,"race_medal":0,"score":"108897086925","product_id":100002201,"comment_content":"耗子叔，非常佩服您的知识广度和深度。想问下这么多知识您是怎么记录下来的呢？简单来说您是否有一套自己记笔记或收集存储知识的方法…包括知识的分类，整理，定期的回顾，新知识的添加，老知识的内容更新等等…以及使用的工具什么的…这个是否能分享下呢？","like_count":25,"discussions":[{"author":{"id":1001269,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/35/89726f5f.jpg","nickname":"左耳朵","note":"","ucode":"8A4741D677702E","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":416644,"discussion_content":"后面我会写提高学习能力的文章，敬请关注！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1523160777,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":5246,"user_name":"Ray","can_delete":false,"product_type":"c1","uid":1014886,"ip_address":"","ucode":"E826A17A40B971","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7c/66/719292c3.jpg","comment_is_top":false,"comment_ctime":1522938529,"is_pvip":false,"replies":[{"id":"1431","content":"当然可以，其除了需要伪装成发送和接收方，还要伪装成证书机构，才能做到神不知鬼不觉，证书中有证书的源信息，比如，公钥的服务器域名，你还要伪造DNS服务器……另外，如果黑客种了木马，那不需要这么复杂了，这意味着私钥都被黑了，这才是灾难——你的身份就是你的私匙！别人拿到了你的私匙，你就已经不是你了。所以，如果你的比特币的私匙被盗，相当于你的钱被盗了，区块链不像银行，其只认私匙，不认人……","user_name":"作者回复","user_name_real":"左耳朵","uid":"1001269","ctime":1523160539,"ip_address":"","comment_id":5246,"utype":1}],"discussion_count":3,"race_medal":0,"score":"35882676897","product_id":100002201,"comment_content":"关于证书机构颁发公私钥匙那段，如何做到防止中间人攻击？黑客不是照样可能通过木马方式获得通信双方的公私钥匙嘛？","like_count":8,"discussions":[{"author":{"id":1001269,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/35/89726f5f.jpg","nickname":"左耳朵","note":"","ucode":"8A4741D677702E","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":416650,"discussion_content":"当然可以，其除了需要伪装成发送和接收方，还要伪装成证书机构，才能做到神不知鬼不觉，证书中有证书的源信息，比如，公钥的服务器域名，你还要伪造DNS服务器……另外，如果黑客种了木马，那不需要这么复杂了，这意味着私钥都被黑了，这才是灾难——你的身份就是你的私匙！别人拿到了你的私匙，你就已经不是你了。所以，如果你的比特币的私匙被盗，相当于你的钱被盗了，区块链不像银行，其只认私匙，不认人……","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1523160539,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1740409,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/8e/79/f9d5dd3a.jpg","nickname":"吕超","note":"","ucode":"B36883984BE16B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339568,"discussion_content":"非对称加密的所有前提条件就是私钥不能丢。一旦丢了私钥，除了线下方式让该密钥对过期并更换，否则什么办法都没有。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609735855,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1882962,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/bb/52/71aab155.jpg","nickname":"猪脚姜","note":"","ucode":"13F104E2B00190","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":246991,"discussion_content":"所以就是保护自己的私钥是根本啦。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587794102,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":5332,"user_name":"龚极客","can_delete":false,"product_type":"c1","uid":1060645,"ip_address":"","ucode":"11AADCCD31D53C","user_header":"https://static001.geekbang.org/account/avatar/00/10/2f/25/d2162fce.jpg","comment_is_top":false,"comment_ctime":1523148171,"is_pvip":false,"replies":[{"id":"1426","content":"是的。我的图可能没画好，但是文字描述如你所说。","user_name":"作者回复","user_name_real":"左耳朵","uid":"1001269","ctime":1523159333,"ip_address":"","comment_id":5332,"utype":1}],"discussion_count":1,"race_medal":0,"score":"22997984651","product_id":100002201,"comment_content":"关于数字签名的图片左侧应该是用公钥对数字签名解密，然后把解密结果和md5(&#39;hello&#39;)比对吧？","like_count":5,"discussions":[{"author":{"id":1001269,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/35/89726f5f.jpg","nickname":"左耳朵","note":"","ucode":"8A4741D677702E","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":416686,"discussion_content":"是的。我的图可能没画好，但是文字描述如你所说。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1523159333,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":182479,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1582794477,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10172729069","product_id":100002201,"comment_content":"没想到耗电如此之巨，投入这么多，到底有多少产出呢？","like_count":2},{"had_liked":false,"id":163882,"user_name":"liuyong","can_delete":false,"product_type":"c1","uid":1128318,"ip_address":"","ucode":"D68555E8057F6E","user_header":"https://static001.geekbang.org/account/avatar/00/11/37/7e/219dd994.jpg","comment_is_top":false,"comment_ctime":1576817965,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5871785261","product_id":100002201,"comment_content":"「假设有个黑客偷偷地把 Jack 电脑上的 Mike 的公钥给换了，换成自己的，然后截获 Mike 发出来的信息，用自己的密钥加密一段自己的信息，以及自己的数字签名。」<br>证书并不能解决黑客黑掉 Mike 电脑的问题啊，既然他能黑掉 Mike 电脑，也就能够使用 Mike 的私钥，然后假装自己是 Mike，和 Jack 通信了。","like_count":1},{"had_liked":false,"id":33925,"user_name":"尾巴的爸爸","can_delete":false,"product_type":"c1","uid":1145913,"ip_address":"","ucode":"C382560F7DAF8F","user_header":"","comment_is_top":false,"comment_ctime":1539919358,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5834886654","product_id":100002201,"comment_content":"尊敬的陈老师，您好！<br>我在阅读专栏时，顺便学习代码，发现了 一个问题，期望您的解答。<br>在测试程序部分：<br>str = data + `n`<br>这行代码是否存在问题？  这样的话，这个传入的字符串始终是“ChenHaon&quot;，程序就陷入死循环了。<br>我修改了一下，将变量名改名为input_str:<br>input_str = data + str(n)<br>程序能正常运行，得到结果，耗时约1.72秒（台式机）。<br>请问这样改是否合理？<br>多谢","like_count":1,"discussions":[{"author":{"id":1470374,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/ry20aMia1d7Tmtx0UiapibTuib5V5VCh8NbyicLowveiakjJyjt8V84VItgBiaEwYlz0R2pdia1lsvVfR8k8Zjd1sCiaEtg/132","nickname":"Chuck","note":"","ucode":"08A8DA5ABC1DA9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":320031,"discussion_content":"Python2里，这语法是可以将数字转成字符串的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604227900,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":25560,"user_name":"够扽","can_delete":false,"product_type":"c1","uid":1184463,"ip_address":"","ucode":"E16A6BAE234CB8","user_header":"https://static001.geekbang.org/account/avatar/00/12/12/cf/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1537362988,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5832330284","product_id":100002201,"comment_content":"那我们还是去银行把，，，既然黑客这么🐂🍺","like_count":1},{"had_liked":false,"id":13605,"user_name":"anbien","can_delete":false,"product_type":"c1","uid":1154948,"ip_address":"","ucode":"71AD890EAE308C","user_header":"","comment_is_top":false,"comment_ctime":1529844104,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5824811400","product_id":100002201,"comment_content":"“用这个权威机构的公钥解密这个证书，得到 Mike 的公钥，再用 Mike 的公钥来验证 Mike 的数字签名”，Mike的公钥本身应该没用CA私钥加密吧？加密的应该只是Mike证书内容的摘要","like_count":1},{"had_liked":false,"id":13473,"user_name":"neohope","can_delete":false,"product_type":"c1","uid":1043475,"ip_address":"","ucode":"C0268F6E7E2B6E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ec/13/49e98289.jpg","comment_is_top":false,"comment_ctime":1529664403,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5824631699","product_id":100002201,"comment_content":"其实感觉Fabric的整体架构和经典的安全架构更靠近一些。 挖矿的化，是不是增加一下分叉的相关知识，以及BITCOIN和ETH如何奖励矿工稍微好一些？","like_count":1},{"had_liked":false,"id":11273,"user_name":"i","can_delete":false,"product_type":"c1","uid":1017510,"ip_address":"","ucode":"B6D6B294C077DF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/86/a6/0aeceb81.jpg","comment_is_top":false,"comment_ctime":1528016853,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5822984149","product_id":100002201,"comment_content":"难度系数是自动调整的吧？这个调整机制是怎样的？","like_count":1},{"had_liked":false,"id":6052,"user_name":"杨洪林","can_delete":false,"product_type":"c1","uid":1078679,"ip_address":"","ucode":"FA48C280791A55","user_header":"https://static001.geekbang.org/account/avatar/00/10/75/97/abcd222a.jpg","comment_is_top":false,"comment_ctime":1524303633,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5819270929","product_id":100002201,"comment_content":"不太明白下面挖矿的代码为什么计算两次哈希值？一次不就可以验证有没有挖到矿了吗？<br><br>hash = hashlib.sha256(str).hexdigest()<br>hash = hashlib.sha256(hash).hexdigest()<br>","like_count":1},{"had_liked":false,"id":5346,"user_name":"一般无","can_delete":false,"product_type":"c1","uid":1082075,"ip_address":"","ucode":"020661AA6BFEC7","user_header":"https://static001.geekbang.org/account/avatar/00/10/82/db/bf51d186.jpg","comment_is_top":false,"comment_ctime":1523170274,"is_pvip":false,"replies":[{"id":"1531","content":"小费是：我转你10元，但给你12元，其中2元是给矿工的小费。手续费：比特币不鼓励小额交易，对于小额要收手续费。比特币如果是无限的，就会导致通货膨胀。第三个问题，一笔交易会有未确认时间，未确认时间越长被记账的优先级就越高。","user_name":"作者回复","user_name_real":"左耳朵","uid":"1001269","ctime":1523496102,"ip_address":"","comment_id":5346,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5818137570","product_id":100002201,"comment_content":"请问所谓的小费是怎么回事？<br>为什么比特币会是有限的？<br>有没有可能一笔交易额太小了没有挖矿机愿意为他记账？<br>","like_count":1,"discussions":[{"author":{"id":1001269,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/35/89726f5f.jpg","nickname":"左耳朵","note":"","ucode":"8A4741D677702E","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":416693,"discussion_content":"小费是：我转你10元，但给你12元，其中2元是给矿工的小费。手续费：比特币不鼓励小额交易，对于小额要收手续费。比特币如果是无限的，就会导致通货膨胀。第三个问题，一笔交易会有未确认时间，未确认时间越长被记账的优先级就越高。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1523496102,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":5232,"user_name":"horizon","can_delete":false,"product_type":"c1","uid":1043715,"ip_address":"","ucode":"46175ADD9143EE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ed/03/84ce687d.jpg","comment_is_top":false,"comment_ctime":1522910981,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5817878277","product_id":100002201,"comment_content":"资源浪费啊！","like_count":1},{"had_liked":false,"id":360240,"user_name":"Geek__JASON","can_delete":false,"product_type":"c1","uid":1457801,"ip_address":"浙江","ucode":"B1B4BD97BE3A55","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEK7j6kFBH6Wy9KYcRGjbH7c7zqvjJW6yfu5lFMQEf5qDgJzJbGA1CwMbJwxCedJUTE2Hoj2AfQajQ/132","comment_is_top":false,"comment_ctime":1666332507,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1666332507","product_id":100002201,"comment_content":"关于中间人攻击(非对称加密<br>Tom生成密钥(a_pri&#47;a_pub), Bob生成密钥(b_pri&#47;b_pub)两者都公开公钥 a_pub和 b_pub为了相互传递信息. 第三人(窃听者)也生成密钥(ca_pri&#47;ca_pub)和(cb_pri&#47;cb_pub) 生成两对.<br>首先John(窃听者)会把Tom的公钥 a_pub截取保存, 再把自己的 ca_pub发给Bob, 然后Bob的公钥 b_pub截取保存, 再把自己的 cb_pub发给Tom. 他们两者都会认为自己拿到的公钥是对方的.<br>此时Tom和Bob相互传递自认为对方的公钥(实际是窃听者John的)加密后的信息发给对方, John在两边接收密文通过自己的私钥(ca_pri, cb_pri)解密, 再发给各方 完美扮演了中间人的角色.<br>————————————————<br>版权声明：本文为CSDN博主「Shawn Jeon」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br>原文链接：https:&#47;&#47;blog.csdn.net&#47;qcl108&#47;article&#47;details&#47;102767276","like_count":0},{"had_liked":false,"id":359969,"user_name":"梅子黄时雨","can_delete":false,"product_type":"c1","uid":1015938,"ip_address":"上海","ucode":"9F788D09C2E9E7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/80/82/3c21b30c.jpg","comment_is_top":false,"comment_ctime":1666092802,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1666092802","product_id":100002201,"comment_content":"学习了。","like_count":0},{"had_liked":false,"id":354954,"user_name":"fanlong","can_delete":false,"product_type":"c1","uid":1181138,"ip_address":"北京","ucode":"F9FB500B1565B3","user_header":"https://static001.geekbang.org/account/avatar/00/12/05/d2/dcda10a4.jpg","comment_is_top":false,"comment_ctime":1660904891,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1660904891","product_id":100002201,"comment_content":"从 &quot; 待记账区 &quot; 中获取一组交易数据<br>代记账区的数据是可靠的吗， 如何保证，  代记账区保存在哪，每个节点都有吗？ ","like_count":0},{"had_liked":false,"id":218934,"user_name":"天草二十六","can_delete":false,"product_type":"c1","uid":1360712,"ip_address":"","ucode":"3165EE3007527B","user_header":"https://static001.geekbang.org/account/avatar/00/14/c3/48/3a739da6.jpg","comment_is_top":false,"comment_ctime":1589900508,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589900508","product_id":100002201,"comment_content":"和https协议差不多，安全机制而言，支付宝支付也是这样做的","like_count":0},{"had_liked":false,"id":210600,"user_name":"猪脚姜","can_delete":false,"product_type":"c1","uid":1882962,"ip_address":"","ucode":"13F104E2B00190","user_header":"https://static001.geekbang.org/account/avatar/00/1c/bb/52/71aab155.jpg","comment_is_top":false,"comment_ctime":1587794402,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587794402","product_id":100002201,"comment_content":"挖矿的电量巨大，很多人觉得不值得，但这同时也是一个壁垒吧。在大家都认比特币有价值的前提下，巨大的能源消耗会与其价值相匹配，导致串改成本增加去，然后就能体现区块链的价值啦，类似一个正向激励的过程。但一个问题是，若大家都不认比特币的价值后，所有的资产就全部归零。","like_count":0},{"had_liked":false,"id":198000,"user_name":"迪","can_delete":false,"product_type":"c1","uid":1760077,"ip_address":"","ucode":"57EF0AF897A8B3","user_header":"https://static001.geekbang.org/account/avatar/00/1a/db/4d/8dec7917.jpg","comment_is_top":false,"comment_ctime":1585406352,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585406352","product_id":100002201,"comment_content":"挖矿就是代价吧，必须给生成区块链的人以奖励来刺激使人愿意记账","like_count":0},{"had_liked":false,"id":149045,"user_name":"疯狂土豆","can_delete":false,"product_type":"c1","uid":1273966,"ip_address":"","ucode":"16ADC351B57151","user_header":"https://static001.geekbang.org/account/avatar/00/13/70/6e/27f43b70.jpg","comment_is_top":false,"comment_ctime":1573130749,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1573130749","product_id":100002201,"comment_content":"耗子叔：最近一直在看区块链，但是还是很蒙圈，<br>1 区块链是一个分布式数据库，他是那个节点的数据是全部复制的一模一样的嘛？我看好多人解说的时候说那个节点上的交易信息都是一样的，而且区块的哈希值很内容有关。这样在内容被篡改的时候哈希值会变化区块脱链。那么如果生成有新的交易记录的时候语言广播，同步信息到所有的区块中，那么之前生成的区块的内容是不是有变化，内容变化以后hash值也会变化，是不是也就脱链了。感觉怎么都说不通？望耗子叔指点指点","like_count":0,"discussions":[{"author":{"id":1014665,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7b/89/34f2cbcc.jpg","nickname":"杨宇","note":"","ucode":"EB74DF6E269F03","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389298,"discussion_content":"新的交易记录会被打包到新的区块中，然后这个新区块再加入区块链","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629207678,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":119184,"user_name":"edisonhuang","can_delete":false,"product_type":"c1","uid":1530167,"ip_address":"","ucode":"BB2F639A779F96","user_header":"https://static001.geekbang.org/account/avatar/00/17/59/37/bd2de0a4.jpg","comment_is_top":false,"comment_ctime":1564535307,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564535307","product_id":100002201,"comment_content":"区块链中的安全性通过每个人的一对密钥，公钥和私钥，以及对自己数据做数字证书的方式来保证。挖矿则是通过算计暴力穷举一个合法字符串的过程，挖矿难度与算力相关动态调整，全网算力越强挖矿难度越大","like_count":0},{"had_liked":false,"id":88389,"user_name":"xinnong","can_delete":false,"product_type":"c1","uid":1005415,"ip_address":"","ucode":"3C1F1EB93FBA5B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/67/01d1580f.jpg","comment_is_top":false,"comment_ctime":1555915713,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555915713","product_id":100002201,"comment_content":"“然后 Jack 用这个权威机构的公钥解密这个证书，得到 Mike的公钥，再用 Mike 的公钥来验证 Mike 的数字签名”，我觉得文中这句话有错误。<br>证书的数字签名是由CA的私钥生成的，所以数字签名的验证需要用CA的公钥来验证，而不是Mike的公钥。","like_count":0},{"had_liked":false,"id":65924,"user_name":"沙漠之鹰","can_delete":false,"product_type":"c1","uid":1222887,"ip_address":"","ucode":"9FB290B874317F","user_header":"https://static001.geekbang.org/account/avatar/00/12/a8/e7/b86938a1.jpg","comment_is_top":false,"comment_ctime":1549776998,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1549776998","product_id":100002201,"comment_content":"比特币是怎么保证有限的","like_count":0},{"had_liked":false,"id":65660,"user_name":"李海洋","can_delete":false,"product_type":"c1","uid":1157684,"ip_address":"","ucode":"0DF14EE889FDB0","user_header":"https://static001.geekbang.org/account/avatar/00/11/aa/34/49d36311.jpg","comment_is_top":false,"comment_ctime":1549545711,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1549545711","product_id":100002201,"comment_content":"比特币的总量是怎么控制的，算法上怎么做的，10分钟产生一个区块又是怎么定的","like_count":0},{"had_liked":false,"id":12090,"user_name":"Cong Chen","can_delete":false,"product_type":"c1","uid":1147728,"ip_address":"","ucode":"05AB7AAACB6802","user_header":"https://static001.geekbang.org/account/avatar/00/11/83/50/20091630.jpg","comment_is_top":false,"comment_ctime":1528561769,"is_pvip":false,"replies":[{"id":"4007","content":"这种方式只是为了验证消息是不是Mike发出来的。不是为了私密。","user_name":"作者回复","user_name_real":"左耳朵","uid":"1001269","ctime":1528648685,"ip_address":"","comment_id":12090,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1528561769","product_id":100002201,"comment_content":"如果可以使用Mike的公钥来验证签名，而Mike的公钥是全网发布的，那么Mike所发的信息不就变成全网可截获了吗？所以这种信息不确保私密性？","like_count":0,"discussions":[{"author":{"id":1001269,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/35/89726f5f.jpg","nickname":"左耳朵","note":"","ucode":"8A4741D677702E","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419107,"discussion_content":"这种方式只是为了验证消息是不是Mike发出来的。不是为了私密。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528648685,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":5884,"user_name":"Wilson_qqs","can_delete":false,"product_type":"c1","uid":1044241,"ip_address":"","ucode":"53169919DD5A84","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ef/11/dd71f70f.jpg","comment_is_top":false,"comment_ctime":1524098537,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1524098537","product_id":100002201,"comment_content":"比特币的挖矿中那个公式用的是&lt;target而不是=.意思是只要找到一个符合条件的hash就可以了？","like_count":0},{"had_liked":false,"id":5878,"user_name":"Wilson_qqs","can_delete":false,"product_type":"c1","uid":1044241,"ip_address":"","ucode":"53169919DD5A84","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ef/11/dd71f70f.jpg","comment_is_top":false,"comment_ctime":1524096512,"is_pvip":false,"replies":[{"id":"1628","content":"是可以的。但为了成为中间人，攻击者不但要能同时和服务器，客户端通信，还要嵌入到服务器和客户端的通信链路之中，将服务器的数据转发给客户端，将客户端的数据转发给服务器。实现这样目的的手段有多种，比较常见的有DNS劫持和局域网ARP欺骗。","user_name":"作者回复","user_name_real":"左耳朵","uid":"1001269","ctime":1524105484,"ip_address":"","comment_id":5878,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1524096512","product_id":100002201,"comment_content":"同样的疑问被一个读者提问了。就是权威机构颁发证书来防止中间人攻击。其实，黑客同样可以把jack电脑上的机构公钥换成自己的，然后截取证书，用机构公钥解密证书获取各种信息再伪装成自己的发给jack.只是这种方法对黑客来说成本有些高？这种方式并不能绝对防止中间人攻击对吧，耗子哥？","like_count":0,"discussions":[{"author":{"id":1001269,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/35/89726f5f.jpg","nickname":"左耳朵","note":"","ucode":"8A4741D677702E","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":416879,"discussion_content":"是可以的。但为了成为中间人，攻击者不但要能同时和服务器，客户端通信，还要嵌入到服务器和客户端的通信链路之中，将服务器的数据转发给客户端，将客户端的数据转发给服务器。实现这样目的的手段有多种，比较常见的有DNS劫持和局域网ARP欺骗。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1524105484,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":5325,"user_name":"李连杰","can_delete":false,"product_type":"c1","uid":1083928,"ip_address":"","ucode":"F3731DB11CE290","user_header":"https://static001.geekbang.org/account/avatar/00/10/8a/18/21a30087.jpg","comment_is_top":false,"comment_ctime":1523133159,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1523133159","product_id":100002201,"comment_content":"交易费用太高了，算力或电力消耗就是维护区块链交易制度所需的交易费用，肯定是行不通的，不符合经济学原理。人是追求利益最大化的，所以大家有动力一起建立和遵守某个规则，这个规则一定使大部分人的个体收益和整体收益增加。感觉区块链很“脑残”啊，少了最重要的一根弦。","like_count":0},{"had_liked":false,"id":5263,"user_name":"逆行","can_delete":false,"product_type":"c1","uid":1001431,"ip_address":"","ucode":"01FAD0A8A34686","user_header":"https://static001.geekbang.org/account/avatar/00/0f/47/d7/55a74a8d.jpg","comment_is_top":false,"comment_ctime":1522980718,"is_pvip":false,"replies":[{"id":"1428","content":"交易的手续费","user_name":"作者回复","user_name_real":"左耳朵","uid":"1001269","ctime":1523159528,"ip_address":"","comment_id":5263,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1522980718","product_id":100002201,"comment_content":"“挖矿”是有奖励机制的，即奖励比特币，而比特币又是有限的，等比特币到达上限后，谁又来给“挖矿”买单呢？或者没有了奖励机制，谁又来打包交易生成区块呢？","like_count":0,"discussions":[{"author":{"id":1001269,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/35/89726f5f.jpg","nickname":"左耳朵","note":"","ucode":"8A4741D677702E","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":416658,"discussion_content":"交易的手续费","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1523159528,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":5239,"user_name":"刘老铁","can_delete":false,"product_type":"c1","uid":1062882,"ip_address":"","ucode":"7CDE26AA74FA13","user_header":"https://static001.geekbang.org/account/avatar/00/10/37/e2/3db1f544.jpg","comment_is_top":false,"comment_ctime":1522918271,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1522918271","product_id":100002201,"comment_content":"https:&#47;&#47;www.jianshu.com&#47;p&#47;954e143e97d2<br><br>哇 大大也在关注区块链<br>恰巧看到有人写的 btc如何生成地址 比较的详细","like_count":0}]}