{"id":781900,"title":"23｜赋值兼容性的再说明","content":"","comments":[{"had_liked":false,"id":396014,"user_name":"Vongola","can_delete":false,"product_type":"c3","uid":1047073,"ip_address":"陕西","ucode":"F2FDAEBC049CBC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fa/21/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1732697121,"is_pvip":false,"replies":[{"id":143790,"content":"+5👍 完美。","user_name":"作者回复","user_name_real":"编辑","uid":1521669,"ctime":1732763367,"ip_address":"江苏","comment_id":396014,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100761001,"comment_content":"type MapTX&lt;Source, T&gt; = {\n    [k in keyof Source]: k extends keyof T ? T[k] : Source[k]\n}\n\ntype MapMartix2&lt;Source extends any[]&gt; = [[&#39;&#39;, ...Source], ...{\n    [k in keyof Source]: k extends `${number}`\n        ? [Source[k], ...MapTX&lt;Source, {\n            [i in Extract&lt;keyof Source, `${number}`&gt;]:\n                Source[k] extends Source[i] ? true : false\n          }&gt;]\n        : Source[k]\n}]","like_count":1,"discussions":[{"author":{"id":1521669,"avatar":"https://static001.geekbang.org/account/avatar/00/17/38/05/7beecd5d.jpg","nickname":"Aiming","note":"","ucode":"66292B32F9960A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":654459,"discussion_content":"+5👍 完美。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1732763367,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"江苏","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":393217,"user_name":"Geek_aeb936","can_delete":false,"product_type":"c3","uid":3887128,"ip_address":"日本","ucode":"863338D4895F25","user_header":"","comment_is_top":false,"comment_ctime":1723179802,"is_pvip":false,"replies":[{"id":142823,"content":"本来……其实……一切都挺对的，结构还特别清晰（编程的好习惯）。但是AddHeaders存在一点儿小错误。\n\n```\n&#47;&#47; 正确的AddHeaders\ntype AddHeaders&lt;Matrix extends any[], Header extends string[]&gt; = [\n  [&#39;&#39;, ...Header], \n  ...{ &#47;&#47; 注意下面应该用extends来再次筛选，而不是直接对每一个K用交叉\n    [K in keyof Matrix]: K extends (keyof Header &amp; `${number}`)\n        ? [Header[K], ...Matrix[K]]\n        : Matrix[K]\n  }\n];\n```\n\n其中 “K extends (keyof Header &amp; `${number}`)”用于筛选那些能用在Header[]中的number成员key用于取行header，这是目前来说比较可行的的方法。在后续课程中介绍过模板中的推断后，你也可以使用一个较简单的表达式：“K extends `${infer I extends number}`”，然后使用Header[I]取行的header。\n","user_name":"作者回复","user_name_real":"作者","uid":1521669,"ctime":1723223283,"ip_address":"江苏","comment_id":393217,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100761001,"comment_content":"type MapMartix2&lt;Source extends any[]&gt; = {\n    [k in keyof Source]: k extends `${number}`\n        ? MapTX&lt;Source, {\n            [i in Extract&lt;keyof Source, `${number}`&gt;]:\n                Source[k] extends Source[i] ? true : false\n          }&gt;\n        : Source[k]\n};\n\ntype AddHeaders&lt;Matrix extends any[], Header extends string[]&gt; = [\n  [&#39;&#39;, ...Header],\n  ...{\n    [K in keyof Matrix]: [Header[K &amp; number], ...Matrix[K]]\n  }\n];\n\ntype MatrixWithHeaders&lt;Source extends any[], Header extends string[]&gt; = AddHeaders&lt;MapMartix2&lt;Source&gt;, Header&gt;;\n\n&#47;&#47; Example usage:\ntype Source = [any, never, unknown, void, null, undefined, 1, &#39;a&#39;, string, true, false, boolean];\ntype Header = [&#39;any&#39;, &#39;never&#39;, &#39;unknown&#39;, &#39;void&#39;, &#39;null&#39;, &#39;undefined&#39;, &#39;1&#39;, &quot;&#39;a&#39;&quot;, &#39;string&#39;, &#39;true&#39;, &#39;false&#39;, &#39;boolean&#39;];\n\ntype Result = MatrixWithHeaders&lt;Source, Header&gt;;\n\n这样的result 对吗 老师","like_count":1,"discussions":[{"author":{"id":3887128,"avatar":"","nickname":"Geek_aeb936","note":"","ucode":"863338D4895F25","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":649386,"discussion_content":"谢谢老师纠正","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1723266960,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"日本","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":396204,"user_name":"fatme","can_delete":false,"product_type":"c3","uid":1034451,"ip_address":"广东","ucode":"75A805D2BB2AD1","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c8/d3/3020ae46.jpg","comment_is_top":false,"comment_ctime":1733547488,"is_pvip":false,"replies":[{"id":143842,"content":"谢谢，已修正~","user_name":"作者回复","user_name_real":"编辑","uid":1521669,"ctime":1733737424,"ip_address":"江苏","comment_id":396204,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100761001,"comment_content":"老师，代码和课件里面都有一个拼写错误，应该是 Matrix 而不是 Martix","like_count":0,"discussions":[{"author":{"id":1521669,"avatar":"https://static001.geekbang.org/account/avatar/00/17/38/05/7beecd5d.jpg","nickname":"Aiming","note":"","ucode":"66292B32F9960A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":654894,"discussion_content":"谢谢，已修正~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1733737424,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"江苏","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]}]}