{"id":126444,"title":"17 | 通过动态配置实现不中断服务的集群成员变更","content":"<p><strong>课件和Demo地址</strong></p><p><a href=\"https://gitee.com/geektime-geekbang/geekbang-zk-course\">https://gitee.com/geektime-geekbang/geekbang-zk-course</a></p>","comments":[{"had_liked":false,"id":145799,"user_name":"清静淡泊","can_delete":false,"product_type":"c3","uid":1215670,"ip_address":"","ucode":"8A0DD8BF7405F1","user_header":"https://static001.geekbang.org/account/avatar/00/12/8c/b6/9ff2dfea.jpg","comment_is_top":false,"comment_ctime":1572368493,"is_pvip":false,"replies":[{"id":56752,"content":"通过以下操作可以保证每个follower节点和leader节点的数据是一样的。\n\n1. 停止所有对ZooKeeper集群的访问。\n2. 使用zkCli.sh连接每一个ZooKeeper的follower节点，并执行sync。\n\n执行以上步骤可以避免提交数据被覆盖问题。","user_name":"作者回复","user_name_real":"Geek_215586","uid":1591870,"ctime":1572697404,"ip_address":"","comment_id":145799,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100034201,"comment_content":"为了防止全部下线时再重启后已提交数据被覆盖问题，关机前执行 &quot;sync &#47;path&quot; 可以起到帮助作用吧","like_count":4,"discussions":[{"author":{"id":1591870,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJyDiaaDJrwRsdUia9HxA8EuWaDVLr4E1gMG5y2ZTxV7BNUhdNABCmH3GMZTzib796X5duibiaeuRmNXeg/132","nickname":"Geek_215586","note":"","ucode":"5916AC9CC5FBE2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472582,"discussion_content":"通过以下操作可以保证每个follower节点和leader节点的数据是一样的。\n\n1. 停止所有对ZooKeeper集群的访问。\n2. 使用zkCli.sh连接每一个ZooKeeper的follower节点，并执行sync。\n\n执行以上步骤可以避免提交数据被覆盖问题。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1572697404,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":149708,"user_name":"Geek_ee6004","can_delete":false,"product_type":"c3","uid":1288285,"ip_address":"","ucode":"C98AD1486746C3","user_header":"","comment_is_top":false,"comment_ctime":1573351095,"is_pvip":false,"replies":[{"id":58521,"content":"要做reconfig首先需要有一个处于quorum模式的ZooKeeper集群，您最初是怎么启动集群的呢？","user_name":"作者回复","user_name_real":"Geek_215586","uid":1591870,"ctime":1573914686,"ip_address":"","comment_id":149708,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100034201,"comment_content":"老师，您好，关于动态配置有个问题：\n假设我从A\\B\\C依次添加节点，执行reconfig命令是否可以这样执行(通过reconfig api）：\n    1.1  A节点上，执行reconfig add A\n    1.2 B节点上，执行reconfig add A,B\n    1.3 C节点上，执行reconfig add A,B,C\n    因为从实际的使用来看，这样也是能够组建集群成功，但就是不知道是否有什么后遗症？","like_count":0,"discussions":[{"author":{"id":1591870,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJyDiaaDJrwRsdUia9HxA8EuWaDVLr4E1gMG5y2ZTxV7BNUhdNABCmH3GMZTzib796X5duibiaeuRmNXeg/132","nickname":"Geek_215586","note":"","ucode":"5916AC9CC5FBE2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473948,"discussion_content":"要做reconfig首先需要有一个处于quorum模式的ZooKeeper集群，您最初是怎么启动集群的呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573914686,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1288285,"avatar":"","nickname":"Geek_ee6004","note":"","ucode":"C98AD1486746C3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":99383,"discussion_content":"老师，您好，\n我启动方式是从单个节点开始动态添加节点的。\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577199429,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":278292,"user_name":"搬砖人员","can_delete":false,"product_type":"c3","uid":1346889,"ip_address":"","ucode":"F864808A282657","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKQIk0Zu0ic03bzIwUFS9ic6yooJLRPKF7awJDUUg7uSt89yejqRecBrhFjiaj6SLVAU5woYgLQmjaKg/132","comment_is_top":false,"comment_ctime":1612859274,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100034201,"comment_content":"老师您好,在服务端实现动态配置之后,假设服务端添加了一台机器,客户端如果需要添加重新修改zookeper的链接地址才能读取到新的服务器吗","like_count":0,"discussions":[{"author":{"id":1063308,"avatar":"https://static001.geekbang.org/account/avatar/00/10/39/8c/ff48ece3.jpg","nickname":"小乙哥","note":"","ucode":"C77E79BEA0C325","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":652105,"discussion_content":"好问题,我也在想这个事情,客户端依赖了动态配置文件,zk集群变更的时候,如何让客户端感知到呢?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1728349272,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}