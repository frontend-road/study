{"id":741168,"title":"13ï½œFilterä¸Listenerï¼šå¦‚ä½•å®ç°è¿‡æ»¤å’ŒæŒç»­ç›‘å¬ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯éƒ­å±¹ã€‚ä»Šå¤©æˆ‘ä»¬ç»§ç»­æ‰‹å†™MiniTomcatã€‚</p><p>ä¸Šä¸€èŠ‚è¯¾æˆ‘ä»¬å®ç°äº†Pipelineå’ŒValveï¼Œè¿™æ ·æˆ‘ä»¬åœ¨æµç¨‹èµ°é€šçš„å‰æä¸‹ï¼Œå¯ä»¥åœ¨æ¯ä¸€å±‚Containerä¹‹é—´å¢åŠ æƒé™æ ¡éªŒã€æ—¥å¿—æ‰“å°ã€é”™è¯¯è¾“å‡ºç­‰è‡ªå®šä¹‰çš„å¤„ç†é€»è¾‘ã€‚æ­¤å¤–æˆ‘ä»¬å¼•å…¥äº†è´£ä»»é“¾è¿™ä¸€è®¾è®¡æ¨¡å¼ï¼Œæ¥ä¾æ¬¡è°ƒç”¨è¿™äº›å¤„ç†é€»è¾‘ã€‚</p><p>è¿™èŠ‚è¯¾æˆ‘ä»¬ç»§ç»­æ¥å®Œå–„MiniTomcatï¼Œæˆ‘ä»¬è®¡åˆ’å¼•å…¥ä¸¤ä¸ªç»„ä»¶â€”â€”Filterï¼ˆè¿‡æ»¤å™¨ï¼‰ä»¥åŠListenerï¼ˆç›‘å¬å™¨ï¼‰ï¼Œå¹¶ä¸”è¿˜æ˜¯ä½¿ç”¨ç»å…¸çš„èŒè´£é“¾æ¨¡å¼ã€‚</p><p>è¿‡æ»¤å™¨å¯ä»¥æ£€æŸ¥è¯·æ±‚å¯¹è±¡ä»¥åŠè¿”å›å¯¹è±¡ï¼Œå¹¶é€šè¿‡è¯·æ±‚å¯¹è±¡å’Œè¿”å›å¯¹è±¡çš„åŒ…è£…ç±»è¿›è¡Œä¿®æ”¹ï¼Œè€Œä¸”å¤šä¸ªè¿‡æ»¤å™¨ä¹‹é—´å¯ä»¥ä¸²è”ï¼Œå°±åƒæµæ°´çº¿ä¸€æ ·ä¸€å±‚å±‚è¿›è¡Œè¿‡æ»¤ï¼ŒååŒèµ·æ¥ç»„è£…æˆæœ€ç»ˆçš„è¯·æ±‚å¯¹è±¡å’Œå“åº”å¯¹è±¡ã€‚</p><p>è€Œç›‘å¬å™¨çš„å­˜åœ¨æ˜¯ä¸ºäº†é…åˆæˆ‘ä»¬ç›®å‰å·²æœ‰çš„Containerã€Sessionç­‰æœºåˆ¶ï¼Œé€šè¿‡ç›‘å¬è¿™äº›æœºåˆ¶çš„äº‹ä»¶ï¼Œæ¯”å¦‚å¯åŠ¨ã€è¶…æ—¶ã€ç»“æŸç­‰ï¼Œæ›´å¥½åœ°å¯¹æœåŠ¡å™¨è¿›è¡Œå¤„ç†ã€‚</p><p>æˆ‘ä»¬ä¸€èµ·æ¥åŠ¨æ‰‹å®ç°ã€‚</p><h2>é¡¹ç›®ç»“æ„</h2><p>è¿™èŠ‚è¯¾æˆ‘ä»¬ä¸»è¦æ–°å¢äº†Filterç›¸å…³å¤„ç†æ–¹æ³•ç±»ï¼Œè¿˜æœ‰Containerã€Instanceä¸Sessionçš„äº‹ä»¶å’Œç›‘å¬å™¨ï¼Œå…·ä½“ç±»çš„åŠŸèƒ½æˆ‘ä»¬åé¢ä¼šè¯¦ç»†ä»‹ç»ã€‚ä½ å¯ä»¥çœ‹ä¸€ä¸‹ç°åœ¨çš„é¡¹ç›®ç»“æ„ã€‚</p><pre><code class=\"language-plain\">MiniTomcat\nâ”œâ”€ src\nâ”‚  â”œâ”€ main\nâ”‚  â”‚  â”œâ”€ java\nâ”‚  â”‚  â”‚  â”œâ”€ com\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ minit\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ connector\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ http\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ DefaultHeaders.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpConnector.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpHeader.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpProcessor.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpRequestImpl.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpRequestLine.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpResponseImpl.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ ServletProcessor.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ SocketInputStream.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ StatisResourceProcessor.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpRequestFacade.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpResponseFacade.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ core\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ ApplicationFilterChain.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ ApplicationFilterConfig.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ ContainerBase.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ ContainerListenerDef.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ FilterDef.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ FilterMap.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ StandardContext.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ StandardContextValve.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ StandardPipeline.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ StandardWrapper.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ StandardWrapperValve.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ logger\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ Constants.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ FileLogger.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ LoggerBase.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ SystemErrLogger.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ SystemOutLogger.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ session\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ StandardSession.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ StandardSessionFacade.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ startup\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ BootStrap.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ util\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ CookieTools.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ StringManager.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ URLDecoder.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ valves\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ AccessLogValve.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ ValveBase.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Connector.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Container.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ ContainerEvent.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ ContainerListener.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Context.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ InstanceEvent.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ InstanceListener.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Logger.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Pipeline.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Request.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Response.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Session.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ SessionEvent.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ SessionListener.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Valve.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ ValveContext.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Wrapper.java\nâ”‚  â”‚  â”œâ”€ resources\nâ”‚  â”œâ”€ test\nâ”‚  â”‚  â”œâ”€ java\nâ”‚  â”‚  â”‚  â”œâ”€ test\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HelloServlet.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ TestFilter.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ TestListener.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ TestServlet.java\nâ”‚  â”‚  â”œâ”€ resources\nâ”œâ”€ webroot\nâ”‚  â”œâ”€ test\nâ”‚  â”‚  â”œâ”€ HelloServlet.class\nâ”‚  â”‚  â”œâ”€ TestFilter.class\nâ”‚  â”‚  â”œâ”€ TestListener.class\nâ”‚  â”‚  â”œâ”€ TestServlet.class\nâ”‚  â”œâ”€ hello.txt\nâ”œâ”€ pom.xml\n</code></pre><!-- [[[read_end]]] --><h2>å¼•å…¥è¿‡æ»¤å™¨</h2><p>é¦–å…ˆæˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å¼•å…¥è¿‡æ»¤å™¨ã€‚æŒ‰ç…§Servletè§„èŒƒï¼Œæˆ‘ä»¬å®šä¹‰äº†Filterã€FilterConfigå’ŒFilterChainä¸‰ä¸ªæ¥å£ã€‚æˆ‘ä»¬å…ˆé‡‡ç”¨ApplicationFilterConfigç±»ï¼Œå¯¹Filterè¿›è¡ŒåŒ…è£…ã€‚ä½ å¯ä»¥çœ‹ä¸€ä¸‹ApplicationFilterConfigç±»çš„å®šä¹‰ã€‚</p><pre><code class=\"language-java\">package com.minit.core;\nfinal class ApplicationFilterConfig implements FilterConfig {\n    public ApplicationFilterConfig(Context context, FilterDef filterDef)\n            throws ClassCastException, ClassNotFoundException,\n            IllegalAccessException, InstantiationException,\n            ServletException {\n        super();\n        this.context = context;\n        setFilterDef(filterDef);\n    }\n    private Context context = null;\n    private Filter filter = null;\n    private FilterDef filterDef = null;\n    public String getFilterName() {\n        return (filterDef.getFilterName());\n    }\n    public String getInitParameter(String name) {\n        Map&lt;String,String&gt; map = filterDef.getParameterMap();\n        if (map == null)\n            return (null);\n        else\n            return ((String) map.get(name));\n    }\n    public Enumeration&lt;String&gt; getInitParameterNames() {\n        Map&lt;String,String&gt; map = filterDef.getParameterMap();\n        if (map == null)\n            return Collections.enumeration(new ArrayList&lt;String&gt;());\n        else\n            return (Collections.enumeration(map.keySet()));\n    }\n    public ServletContext getServletContext() {\n        return (this.context.getServletContext());\n    }\n    public String toString() {\n        StringBuffer sb = new StringBuffer(\"ApplicationFilterConfig[\");\n        sb.append(\"name=\");\n        sb.append(filterDef.getFilterName());\n        sb.append(\", filterClass=\");\n        sb.append(filterDef.getFilterClass());\n        sb.append(\"]\");\n        return (sb.toString());\n    }\n    Filter getFilter() throws ClassCastException, ClassNotFoundException,\n            IllegalAccessException, InstantiationException, ServletException {\n        // è¿”å›ç°æœ‰çš„è¿‡æ»¤å™¨å®ä¾‹ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰\n        if (this.filter != null)\n            return (this.filter);\n        // ç¡®å®šæˆ‘ä»¬å°†ä½¿ç”¨çš„ç±»åŠ è½½å™¨\n        String filterClass = filterDef.getFilterClass();\n        ClassLoader classLoader = null;\n        classLoader = context.getLoader();\n        ClassLoader oldCtxClassLoader =\n                Thread.currentThread().getContextClassLoader();\n        // å®ä¾‹åŒ–è¿™ä¸ªè¿‡æ»¤å™¨çš„æ–°å®ä¾‹å¹¶è¿”å›\n        Class clazz = classLoader.loadClass(filterClass);\n        this.filter = (Filter) clazz.newInstance();\n        filter.init(this);\n        return (this.filter);\n    }\n    FilterDef getFilterDef() {\n        return (this.filterDef);\n    }\n    void release() {\n        if (this.filter != null)\n            filter.destroy();\n        this.filter = null;\n    }\n    void setFilterDef(FilterDef filterDef)\n            throws ClassCastException, ClassNotFoundException,\n            IllegalAccessException, InstantiationException,\n            ServletException {\n        this.filterDef = filterDef;\n        if (filterDef == null) {\n            // é‡Šæ”¾ä¹‹å‰åˆ†é…çš„æ‰€æœ‰è¿‡æ»¤å™¨å®ä¾‹\n            if (this.filter != null)\n                this.filter.destroy();\n            this.filter = null;\n        } else {\n            // åˆ†é…ä¸€ä¸ªæ–°çš„è¿‡æ»¤å™¨å®ä¾‹\n            Filter filter = getFilter();\n        }\n    }\n}\n</code></pre><p>é€šè¿‡ApplicationFilterConfigç±»çš„å®ç°æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¼•å…¥äº†Filterå¯¹è±¡ï¼Œè¿™ä¸ªFilterå¯¹è±¡å°±æ˜¯ <code>javax.servlet.Filter</code>ï¼ŒåŒæ—¶è¿˜å®šä¹‰äº†Contextå’ŒFilterDefï¼ŒFilterDefå®šä¹‰äº†Filterçš„éƒ¨åˆ†å‚æ•°ä¿¡æ¯ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹ç›¸å…³å®ç°ã€‚</p><pre><code class=\"language-java\">package com.minit.core;\nimport java.util.Map;\nimport java.util.concurrent.ConcurrentHashMap;\npublic final class FilterDef {\n    private String description = null;\n    public String getDescription() {\n        return (this.description);\n    }\n    public void setDescription(String description) {\n        this.description = description;\n    }\n    private String displayName = null;\n    public String getDisplayName() {\n        return (this.displayName);\n    }\n    public void setDisplayName(String displayName) {\n        this.displayName = displayName;\n    }\n    private String filterClass = null;\n    public String getFilterClass() {\n        return (this.filterClass);\n    }\n    public void setFilterClass(String filterClass) {\n        this.filterClass = filterClass;\n    }\n    private String filterName = null;\n    public String getFilterName() {\n        return (this.filterName);\n    }\n    public void setFilterName(String filterName) {\n        this.filterName = filterName;\n    }\n    private String largeIcon = null;\n    public String getLargeIcon() {\n        return (this.largeIcon);\n    }\n    public void setLargeIcon(String largeIcon) {\n        this.largeIcon = largeIcon;\n    }\n    private Map&lt;String,String&gt; parameters = new ConcurrentHashMap&lt;&gt;();\n    public Map&lt;String,String&gt; getParameterMap() {\n        return (this.parameters);\n    }\n    private String smallIcon = null;\n    public String getSmallIcon() {\n        return (this.smallIcon);\n    }\n    public void setSmallIcon(String smallIcon) {\n        this.smallIcon = smallIcon;\n    }\n    public void addInitParameter(String name, String value) {\n        parameters.put(name, value);\n    }\n    public String toString() {\n        StringBuffer sb = new StringBuffer(\"FilterDef[\");\n        sb.append(\"filterName=\");\n        sb.append(this.filterName);\n        sb.append(\", filterClass=\");\n        sb.append(this.filterClass);\n        sb.append(\"]\");\n        return (sb.toString());\n    }\n}\n</code></pre><p>FilterDefå®šä¹‰ä¸éš¾ç†è§£ï¼Œä¸»è¦åŒ…æ‹¬Filterçš„æè¿°ã€åç§°ç­‰ä¿¡æ¯ï¼Œå®šä¹‰äº†ä¼—å¤šGetterå’ŒSetteræ–¹æ³•ã€‚åœ¨FilterDefç±»å®šä¹‰å®Œæ¯•åï¼Œæˆ‘ä»¬å°±é€šè¿‡Configæ‹¿åˆ°äº†Filterï¼Œå¹¶è¿›è¡Œåˆå§‹åŒ–å·¥ä½œã€‚</p><p>ç”±äºæ”¯æŒå¤šä¸ªFilterConfigï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨é“¾è·¯æ¨¡å¼è¿›è¡Œç®¡ç†ï¼Œå®šä¹‰ApplicationFilterChainç±»ã€‚</p><pre><code class=\"language-java\">package com.minit.core;\nimport java.io.IOException;\nimport java.util.ArrayList;\nimport java.util.Iterator;\nimport javax.servlet.Filter;\nimport javax.servlet.FilterChain;\nimport javax.servlet.Servlet;\nimport javax.servlet.ServletException;\nimport javax.servlet.ServletRequest;\nimport javax.servlet.ServletResponse;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport com.minit.connector.HttpRequestFacade;\nimport com.minit.connector.HttpResponseFacade;\nimport com.minit.connector.http.HttpRequestImpl;\nimport com.minit.connector.http.HttpResponseImpl;\nfinal class ApplicationFilterChain implements FilterChain {\n    public ApplicationFilterChain() {\n        super();\n    }\n    private ArrayList&lt;ApplicationFilterConfig&gt; filters = new ArrayList&lt;&gt;();\n    private Iterator&lt;ApplicationFilterConfig&gt; iterator = null;\n    private Servlet servlet = null;\n    \n    //æ ¸å¿ƒæ–¹æ³•ï¼Œå¯åŠ¨è¿‡æ»¤\n    public void doFilter(ServletRequest request, ServletResponse response)\n            throws IOException, ServletException {\n        System.out.println(\"FilterChain doFilter()\");\n        internalDoFilter(request,response);\n    }\n    private void internalDoFilter(ServletRequest request, ServletResponse response)\n            throws IOException, ServletException {\n        if (this.iterator == null)\n            this.iterator = filters.iterator();\n        if (this.iterator.hasNext()) {\n            //æ‹¿åˆ°ä¸‹ä¸€ä¸ªfilter\n            ApplicationFilterConfig filterConfig =\n                    (ApplicationFilterConfig) iterator.next();\n            Filter filter = null;\n            try {\n                //è¿›è¡Œè¿‡æ»¤ï¼Œè¿™æ˜¯èŒè´£é“¾æ¨¡å¼ï¼Œä¸€ä¸ªä¸€ä¸ªå¾€ä¸‹ä¼ \n                filter = filterConfig.getFilter();\n                System.out.println(\"Filter doFilter()\");\n                //è°ƒç”¨filterçš„è¿‡æ»¤é€»è¾‘ï¼Œæ ¹æ®è§„èŒƒï¼Œfilterä¸­è¦å†æ¬¡è°ƒç”¨filterChain.doFilter\n                //è¿™æ ·åˆä¼šå›åˆ°internalDoFilter()æ–¹æ³•ï¼Œå°±ä¼šå†æ‹¿åˆ°ä¸‹ä¸€ä¸ªfilterï¼Œ\n                //å¦‚æ­¤å®ç°ä¸€ä¸ªä¸€ä¸ªå¾€ä¸‹ä¼ \n                filter.doFilter(request, response, this);\n            } catch (IOException e) {\n                throw e;\n            } catch (ServletException e) {\n                throw e;\n            } catch (RuntimeException e) {\n                throw e;\n            } catch (Throwable e) {\n                throw new ServletException(\"filterChain.filter\", e);\n            }\n            return;\n        }\n        try {\n            //æœ€åè°ƒç”¨servlet\n            HttpServletRequest requestFacade = new HttpRequestFacade((HttpRequestImpl) request);\n            HttpServletResponse responseFacade = new HttpResponseFacade((HttpResponseImpl) response);\n            servlet.service(requestFacade, responseFacade);\n        } catch (IOException e) {\n            throw e;\n        } catch (ServletException e) {\n            throw e;\n        } catch (RuntimeException e) {\n            throw e;\n        } catch (Throwable e) {\n            throw new ServletException(\"filterChain.servlet\", e);\n        }\n    }\n    void addFilter(ApplicationFilterConfig filterConfig) {\n        this.filters.add(filterConfig);\n    }\n    void release() {\n        this.filters.clear();\n        this.iterator = iterator;\n        this.servlet = null;\n    }\n    void setServlet(Servlet servlet) {\n        this.servlet = servlet;\n    }\n}\n</code></pre><p>æˆ‘ä»¬ä½¿ç”¨ArrayListå­˜æ”¾æ‰€æœ‰çš„filterï¼Œè€Œæœ€é‡è¦çš„å®ç°æ–¹æ³•å°±æ˜¯ <strong>doFilter</strong>ï¼Œè¿™ä¹Ÿæ˜¯FilterChainæ¥å£æœ¬èº«æ‰€å®šä¹‰çš„ï¼Œæˆ‘ä»¬åœ¨è¿™è¿›è¡Œäº†å®ç°ã€‚doFilteræ–¹æ³•å†…åˆè°ƒç”¨äº†internalDoFilteræ–¹æ³•æ¥å®ç°ã€‚æˆ‘ä»¬ä½¿ç”¨äº†iteratorè¿­ä»£å™¨æŒ‡å‘filtersï¼Œé€šè¿‡ <code>filterConfig.getFilter()</code> æ–¹æ³•è·å–ç¬¬ä¸€ä¸ªfilteråè°ƒç”¨ <code>filter.doFilter(request, response, this)</code>ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªåœ°æ–¹è°ƒç”¨äº†ç¬¬ä¸€ä¸ª <code>Filter.doFilter()</code>ï¼Œè€Œä¸æ˜¯åœ¨ApplicationFilterChainä¸­è¿­ä»£éå†ã€‚ä¹‹åçš„filterè¿˜æ˜¯é‡‡ç”¨èŒè´£é“¾è®¾è®¡æ¨¡å¼ï¼Œç”±ç¬¬ä¸€ä¸ªFilterè°ƒç”¨ä¸‹ä¸€ä¸ªï¼Œä¸€ä¸ªä¸€ä¸ªåœ°ç»§ç»­ã€‚</p><p>å½“æ‰€æœ‰Filterè¿‡æ»¤å®Œä¹‹åï¼Œæ‰§è¡Œ <code>servlet.service(requestFacade, responseFacade)</code> æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯Filter Chainè‡ªåŠ¨å®Œæˆçš„ï¼Œ<code>service()</code> æˆäº†Chainä¹‹åçš„ä¸€ä¸ªç¯èŠ‚ï¼Œæ‰€ä»¥Processorå’ŒContainerä¸å†éœ€è¦æ˜¾å¼åœ°è°ƒç”¨ <code>service()</code>ã€‚</p><p>æœ‰äº†è¿™äº›å‡†å¤‡åï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å¯ä»¥æŠŠFilteråŠ å…¥åˆ°Containeré‡Œï¼Œæ¯ä¸€å±‚éƒ½å¯ä»¥åŠ ï¼Œæˆ‘ä»¬åªåœ¨StandardContextè¿™ä¸€å±‚ä¿å­˜ï¼Œé‡æ–°å¯åŠ¨çš„æ—¶å€™åœ¨BootStrapé‡ŒåŠ ä¸Šï¼Œè°ƒç”¨çš„ç¨‹åºå†™åœ¨StandardWrapperValveé‡Œã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å®ç°ï¼Œé¦–å…ˆå®šä¹‰FilterMapç±»ä»¥åŠURLDecoderå·¥å…·ç±»ã€‚</p><p>URLDecoderå·¥å…·ç±»ï¼š</p><pre><code class=\"language-java\">package com.minit.util;\npublic class URLDecoder {\n    public static String URLDecode(String str) {\n        return URLDecode(str, null);\n    }\n    public static String URLDecode(String str, String enc) {\n        if (str == null)\n            return (null);\n        int len = str.length();\n        byte[] bytes = new byte[len];\n        bytes = str.getBytes();\n        return URLDecode(bytes, enc);\n    }\n    public static String URLDecode(byte[] bytes) {\n        return URLDecode(bytes, null);\n    }\n    public static String URLDecode(byte[] bytes, String enc) {\n        if (bytes == null)\n            return (null);\n        int len = bytes.length;\n        int ix = 0;\n        int ox = 0;\n        while (ix &lt; len) {\n            byte b = bytes[ix++];     // è·å–è¦æµ‹è¯•çš„å­—èŠ‚\n            if (b == '+') {\n                b = (byte)' ';\n            } else if (b == '%') {\n                b = (byte) ((convertHexDigit(bytes[ix++]) &lt;&lt; 4)\n                        + convertHexDigit(bytes[ix++]));\n            }\n            bytes[ox++] = b;\n        }\n        if (enc != null) {\n            try {\n                return new String(bytes, 0, ox, enc);\n            } catch (Exception e) {\n                e.printStackTrace();\n            }\n        }\n        return new String(bytes, 0, ox);\n    }\n    private static byte convertHexDigit( byte b ) {\n        if ((b &gt;= '0') &amp;&amp; (b &lt;= '9')) return (byte)(b - '0');\n        if ((b &gt;= 'a') &amp;&amp; (b &lt;= 'f')) return (byte)(b - 'a' + 10);\n        if ((b &gt;= 'A') &amp;&amp; (b &lt;= 'F')) return (byte)(b - 'A' + 10);\n        return 0;\n    }\n}\n</code></pre><p>FilterMapç±»ï¼š</p><pre><code class=\"language-java\">package com.minit.core;\nimport com.minit.util.URLDecoder;\npublic final class FilterMap {\n    private String filterName = null;\n    public String getFilterName() {\n        return (this.filterName);\n    }\n    public void setFilterName(String filterName) {\n        this.filterName = filterName;\n    }\n    private String servletName = null;\n    public String getServletName() {\n        return (this.servletName);\n    }\n    public void setServletName(String servletName) {\n        this.servletName = servletName;\n    }\n    private String urlPattern = null;\n    public String getURLPattern() {\n        return (this.urlPattern);\n    }\n    public void setURLPattern(String urlPattern) {\n        this.urlPattern = URLDecoder.URLDecode(urlPattern);\n    }\n    public String toString() {\n        StringBuffer sb = new StringBuffer(\"FilterMap[\");\n        sb.append(\"filterName=\");\n        sb.append(this.filterName);\n        if (servletName != null) {\n            sb.append(\", servletName=\");\n            sb.append(servletName);\n        }\n        if (urlPattern != null) {\n            sb.append(\", urlPattern=\");\n            sb.append(urlPattern);\n        }\n        sb.append(\"]\");\n        return (sb.toString());\n    }\n}\n</code></pre><p>ç´§æ¥ç€è°ƒæ•´StandardContextï¼Œæ–°å¢ä¸‹é¢è¿™äº›ä»£ç ã€‚è¿™äº›ä»£ç è¿›è¡Œäº†è¿‡æ»¤å™¨çš„é…ç½®å’Œå¤„ç†ã€‚</p><pre><code class=\"language-java\">package com.minit.core;\npublic class StandardContext extends ContainerBase implements Context{\n    //ä¸‹é¢çš„å±æ€§è®°å½•äº†filterçš„é…ç½®\n    private Map&lt;String,ApplicationFilterConfig&gt; filterConfigs = new ConcurrentHashMap&lt;&gt;();\n    private Map&lt;String,FilterDef&gt; filterDefs = new ConcurrentHashMap&lt;&gt;();\n    private FilterMap filterMaps[] = new FilterMap[0];\n    \n    public void addFilterDef(FilterDef filterDef) {\n        filterDefs.put(filterDef.getFilterName(), filterDef);\n    }\n    public void addFilterMap(FilterMap filterMap) {\n        // éªŒè¯æ‰€å»ºè®®çš„è¿‡æ»¤å™¨æ˜ å°„\n        String filterName = filterMap.getFilterName();\n        String servletName = filterMap.getServletName();\n        String urlPattern = filterMap.getURLPattern();\n        if (findFilterDef(filterName) == null)\n            throw new IllegalArgumentException(\"standardContext.filterMap.name\"+filterName);\n        if ((servletName == null) &amp;&amp; (urlPattern == null))\n            throw new IllegalArgumentException(\"standardContext.filterMap.either\");\n        if ((servletName != null) &amp;&amp; (urlPattern != null))\n            throw new IllegalArgumentException(\"standardContext.filterMap.either\");\n        // å› ä¸ºè¿‡æ»¤å™¨æ¨¡å¼æ˜¯2.3ä¸­çš„æ–°åŠŸèƒ½ï¼Œæ‰€ä»¥ä¸éœ€è¦è°ƒæ•´\n        // å¯¹äº2.2ç‰ˆæœ¬çš„å‘åå…¼å®¹æ€§\n        if ((urlPattern != null) &amp;&amp; !validateURLPattern(urlPattern))\n            throw new IllegalArgumentException(\"standardContext.filterMap.pattern\"+urlPattern);\n        // å°†è¿™ä¸ªè¿‡æ»¤å™¨æ˜ å°„æ·»åŠ åˆ°æˆ‘ä»¬å·²æ³¨å†Œçš„é›†åˆä¸­\n        synchronized (filterMaps) {\n            FilterMap results[] =new FilterMap[filterMaps.length + 1];\n            System.arraycopy(filterMaps, 0, results, 0, filterMaps.length);\n            results[filterMaps.length] = filterMap;\n            filterMaps = results;\n        }\n    }\n    public FilterDef findFilterDef(String filterName) {\n        return ((FilterDef) filterDefs.get(filterName));\n    }\n    public FilterDef[] findFilterDefs() {\n        synchronized (filterDefs) {\n            FilterDef results[] = new FilterDef[filterDefs.size()];\n            return ((FilterDef[]) filterDefs.values().toArray(results));\n        }\n    }\n    public FilterMap[] findFilterMaps() {\n        return (filterMaps);\n    }\n    public void removeFilterDef(FilterDef filterDef) {\n        filterDefs.remove(filterDef.getFilterName());\n    }\n    \n    public void removeFilterMap(FilterMap filterMap) {\n        synchronized (filterMaps) {\n            // ç¡®ä¿å½“å‰å­˜åœ¨è¿™ä¸ªè¿‡æ»¤å™¨æ˜ å°„\n            int n = -1;\n            for (int i = 0; i &lt; filterMaps.length; i++) {\n                if (filterMaps[i] == filterMap) {\n                    n = i;\n                    break;\n                }\n            }\n            if (n &lt; 0)\n                return;\n            // åˆ é™¤æŒ‡å®šçš„è¿‡æ»¤å™¨æ˜ å°„\n            FilterMap results[] = new FilterMap[filterMaps.length - 1];\n            System.arraycopy(filterMaps, 0, results, 0, n);\n            System.arraycopy(filterMaps, n + 1, results, n,\n                    (filterMaps.length - 1) - n);\n            filterMaps = results;\n        }\n    }\n    //å¯¹é…ç½®å¥½çš„æ‰€æœ‰filteråå­—ï¼Œåˆ›å»ºå®ä¾‹ï¼Œå­˜å‚¨åœ¨filterConfigsä¸­ï¼Œå¯ä»¥ç”Ÿæ•ˆäº†\n    public boolean filterStart() {\n        System.out.println(\"Filter Start..........\");\n        // ä¸ºæ¯ä¸ªå®šä¹‰çš„è¿‡æ»¤å™¨å®ä¾‹åŒ–å¹¶è®°å½•ä¸€ä¸ªFilterConfig\n        boolean ok = true;\n        synchronized (filterConfigs) {\n            filterConfigs.clear();\n            Iterator&lt;String&gt; names = filterDefs.keySet().iterator();\n            while (names.hasNext()) {\n                String name = names.next();\n                ApplicationFilterConfig filterConfig = null;\n                try {\n                    filterConfig = new ApplicationFilterConfig\n                            (this, (FilterDef) filterDefs.get(name));\n                    filterConfigs.put(name, filterConfig);\n                } catch (Throwable t) {\n                    ok = false;\n                }\n            }\n        }\n        return (ok);\n    }\n    public FilterConfig findFilterConfig(String name) {\n        return (filterConfigs.get(name));\n    }\n    private boolean validateURLPattern(String urlPattern) {\n        if (urlPattern == null)\n            return (false);\n        if (urlPattern.startsWith(\"*.\")) {\n            if (urlPattern.indexOf('/') &lt; 0)\n                return (true);\n            else\n                return (false);\n        }\n        if (urlPattern.startsWith(\"/\"))\n            return (true);\n        else\n            return (false);\n    }\n}\n</code></pre><p>å¯ä»¥çœ‹åˆ°StandardContexté‡Œä¸»è¦å®šä¹‰äº†filterçš„å¯åŠ¨æ–¹æ³•ï¼Œç”¨æ¥åœ¨BootStrapå¯åŠ¨ç±»ä¸­å¯åŠ¨è¿‡æ»¤å™¨ã€‚</p><p>æ¥ä¸‹æ¥å†è°ƒæ•´StandardContextValveç±»é‡Œçš„invokeæ–¹æ³•çš„å®ç°ï¼Œå¢åŠ äº†filterçš„æ”¯æŒï¼Œä¸æ˜¯ç›´æ¥è°ƒç”¨Servletï¼Œè€Œæ˜¯æ”¾åœ¨filterChainä¸­è¿›è¡Œè°ƒç”¨ï¼Œå³å…ˆè¿›è¡Œè¿‡æ»¤ï¼Œç„¶åå†åˆ°Servletã€‚</p><pre><code class=\"language-java\">package com.minit.core;\npublic class StandardWrapperValve extends ValveBase {\n    private FilterDef filterDef = null;\n    @Override\n    public void invoke(Request request, Response response, ValveContext context) throws IOException, ServletException {\n        //åˆ›å»ºfilter Chainï¼Œå†è°ƒç”¨filterï¼Œç„¶åè°ƒç”¨servlet\n        System.out.println(\"StandardWrapperValve invoke()\");\n        Servlet instance = ((StandardWrapper)getContainer()).getServlet();\n        ApplicationFilterChain filterChain = createFilterChain(request, instance);\n        if ((instance != null) &amp;&amp; (filterChain != null)) {\n            filterChain.doFilter((ServletRequest)request, (ServletResponse)response);\n        }\n        filterChain.release();\n    }\n    //æ ¹æ®contextä¸­çš„filter mapä¿¡æ¯æŒ‘é€‰å‡ºç¬¦åˆæ¨¡å¼çš„filterï¼Œåˆ›å»ºfilterChain\n    private ApplicationFilterChain createFilterChain(Request request, Servlet servlet) {\n        System.out.println(\"createFilterChain()\");\n        if (servlet == null)\n            return (null);\n        ApplicationFilterChain filterChain = new ApplicationFilterChain();\n        filterChain.setServlet(servlet);\n        StandardWrapper wrapper = (StandardWrapper) getContainer();\n        StandardContext context = (StandardContext) wrapper.getParent();\n        //ä»contextä¸­æ‹¿åˆ°filterçš„ä¿¡æ¯\n        FilterMap filterMaps[] = context.findFilterMaps();\n        if ((filterMaps == null) || (filterMaps.length == 0))\n            return (filterChain);\n        //è¦åŒ¹é…çš„è·¯å¾„\n        String requestPath = null;\n        if (request instanceof HttpServletRequest) {\n            String contextPath = \"\";\n            String requestURI = ((HttpRequestImpl)request).getUri(); //((HttpServletRequest) request).getRequestURI();\n            if (requestURI.length() &gt;= contextPath.length())\n                requestPath = requestURI.substring(contextPath.length());\n        }\n        //è¦åŒ¹é…çš„servletå\n        String servletName = wrapper.getName();\n        \n        //ä¸‹é¢éå†filter Mapï¼Œæ‰¾åˆ°åŒ¹é…URLæ¨¡å¼çš„filterï¼ŒåŠ å…¥åˆ°filterChainä¸­\n        int n = 0;\n        for (int i = 0; i &lt; filterMaps.length; i++) {\n            if (!matchFiltersURL(filterMaps[i], requestPath))\n                continue;\n            ApplicationFilterConfig filterConfig = (ApplicationFilterConfig)\n                    context.findFilterConfig(filterMaps[i].getFilterName());\n            if (filterConfig == null) {\n                continue;\n            }\n            filterChain.addFilter(filterConfig);\n            n++;\n        }\n        //ä¸‹é¢éå†filter Mapï¼Œæ‰¾åˆ°åŒ¹é…servletçš„filterï¼ŒåŠ å…¥åˆ°filterChainä¸­\n        for (int i = 0; i &lt; filterMaps.length; i++) {\n            if (!matchFiltersServlet(filterMaps[i], servletName))\n                continue;\n            ApplicationFilterConfig filterConfig = (ApplicationFilterConfig)\n                    context.findFilterConfig(filterMaps[i].getFilterName());\n            if (filterConfig == null) {\n                continue;\n            }\n            filterChain.addFilter(filterConfig);\n            n++;\n        }\n        return (filterChain);\n    }\n    //å­—ç¬¦ä¸²æ¨¡å¼åŒ¹é…filterçš„è¿‡æ»¤è·¯å¾„\n    private boolean matchFiltersURL(FilterMap filterMap, String requestPath) {\n        if (requestPath == null)\n            return (false);\n        String testPath = filterMap.getURLPattern();\n        if (testPath == null)\n            return (false);\n        if (testPath.equals(requestPath))\n            return (true);\n        if (testPath.equals(\"/*\"))\n            return (true);\n        if (testPath.endsWith(\"/*\")) { //è·¯å¾„ç¬¦åˆ/å‰ç¼€ï¼Œé€šé…æˆåŠŸ\n            String comparePath = requestPath;\n            while (true) {  //ä»¥/æˆªå–å‰æ®µå­—ç¬¦ä¸²ï¼Œå¾ªç¯åŒ¹é…\n                if (testPath.equals(comparePath + \"/*\"))\n                    return (true);\n                int slash = comparePath.lastIndexOf('/');\n                if (slash &lt; 0)\n                    break;\n                comparePath = comparePath.substring(0, slash);\n            }\n            return (false);\n        }\n        if (testPath.startsWith(\"*.\")) {\n            int slash = requestPath.lastIndexOf('/');\n            int period = requestPath.lastIndexOf('.');\n            if ((slash &gt;= 0) &amp;&amp; (period &gt; slash))\n                return (testPath.equals(\"*.\" + requestPath.substring(period + 1)));\n        }\n        return (false); // NOTE - Not relevant for selecting filters\n    }\n    private boolean matchFiltersServlet(FilterMap filterMap, String servletName) {\n        if (servletName == null)\n            return (false);\n        else\n            return (servletName.equals(filterMap.getServletName()));\n    }\n}\n\n</code></pre><p>æœ€åè°ƒæ•´BootStrapç±»ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹å½“å‰mainå‡½æ•°çš„å®ç°ã€‚ä¸»è¦çš„å˜åŒ–å°±æ˜¯é…ç½®äº†filterä¿¡æ¯ã€åç§°ã€ç±»åã€è¿‡æ»¤è·¯å¾„ç­‰ç­‰ã€‚</p><pre><code class=\"language-java\">package com.minit.startup;\npublic class BootStrap {\n    public static void main(String[] args) {\n        if (debug &gt;= 1)\n            log(\".... startup ....\");\n        HttpConnector connector = new HttpConnector();\n        StandardContext container = new StandardContext();\n        connector.setContainer(container);\n        container.setConnector(connector);\n        Logger logger = new FileLogger();\n        container.setLogger(logger);\n        FilterDef filterDef = new FilterDef();\n        filterDef.setFilterName(\"TestFilter\");\n        filterDef.setFilterClass(\"test.TestFilter\");\n        container.addFilterDef(filterDef);\n        FilterMap filterMap = new FilterMap();\n        filterMap.setFilterName(\"TestFilter\");\n        filterMap.setURLPattern(\"/*\");\n        container.addFilterMap(filterMap);\n        container.filterStart();\n        connector.start();\n    }\n}\n</code></pre><p>è¿™æ ·Filterå°±å®šä¹‰å¥½äº†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æµ‹è¯•æ–‡ä»¶å¤¹é‡Œå®šä¹‰TestFIlterç±»æ¥æµ‹è¯•ä¸€ä¸‹ã€‚</p><pre><code class=\"language-java\">package test;\npublic class TestFilter implements Filter{\n    @Override\n    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)\n            throws IOException, ServletException {\n        System.out.println(\"The very first Filter\");\n        chain.doFilter(request, response);\n    }\n}\n</code></pre><p>æµ‹è¯•ç±»æ¯”è¾ƒç®€å•ï¼Œå®ç°Servletçš„æ ‡å‡†Filterè§„èŒƒï¼Œå®ç°doFilteræ–¹æ³•ã€‚</p><p>å®Œæˆè¿‡æ»¤å™¨çš„å®šä¹‰ä¸å®ç°åï¼Œæˆ‘ä»¬å†æ¥çœ‹ç›‘å¬å™¨çš„å®ç°ã€‚</p><h2>å¼•å…¥ç›‘å¬å™¨</h2><p>ç›‘å¬å™¨ä¸€èˆ¬å’Œäº‹ä»¶å…±åŒå­˜åœ¨ï¼Œä¹Ÿå°±æ˜¯å…ˆæœ‰äº‹ä»¶å®šä¹‰ï¼Œåé¢å¯¹è¿™ä¸ªäº‹ä»¶è¿›è¡Œç›‘å¬ã€‚åœ¨MiniTomcaté‡Œï¼Œæˆ‘ä»¬å®šä¹‰InstanceListenerã€ContainerListenerã€SessionListenerä¸‰ç§ç›‘å¬å™¨ä»¥åŠå¯¹åº”çš„äº‹ä»¶ï¼Œåˆ†åˆ«ä½œç”¨äºæ•´ä¸ªå¯¹è±¡å®ä¾‹ã€å®¹å™¨Containerå’ŒSessionå¤„ç†ã€‚è¿™æ ·æˆ‘ä»¬MiniTomcatå†…éƒ¨ä¸»è¦å¯¹è±¡çš„å„ç§è¡Œä¸ºéƒ½èƒ½å¤Ÿè¢«ç›‘å¬äº†ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹äº‹ä»¶å’Œç›‘å¬å™¨çš„ä»£ç å®šä¹‰ã€‚</p><p>ContainerEventæ˜¯ä¸€ä¸ªåŸºç¡€çš„å®¹å™¨äº‹ä»¶å¯¹è±¡ã€‚</p><pre><code class=\"language-java\">package com.minit;\npublic final class ContainerEvent extends EventObject {\n    private Container container = null;\n    private Object data = null;\n    private String type = null;\n    public ContainerEvent(Container container, String type, Object data) {\n        super(container);\n        this.container = container;\n        this.type = type;\n        this.data = data;\n    }\n    public Object getData() {\n        return (this.data);\n    }\n    public Container getContainer() {\n        return (this.container);\n    }\n    public String getType() {\n        return (this.type);\n    }\n    public String toString() {\n        return (\"ContainerEvent['\" + getContainer() + \"','\" +\n                getType() + \"','\" + getData() + \"']\");\n    }\n}\n</code></pre><p>ContainerListenerç”¨äºç›‘å¬å®¹å™¨äº‹ä»¶ã€‚</p><pre><code class=\"language-java\">package com.minit;\npublic interface ContainerListener {\n    public void containerEvent(ContainerEvent event);\n}\n</code></pre><p>InstanceEventæ˜¯Servletçš„äº‹ä»¶ã€‚</p><pre><code class=\"language-java\">package com.minit;\npublic final class InstanceEvent extends EventObject {\n    public static final String BEFORE_INIT_EVENT = \"beforeInit\";\n    public static final String AFTER_INIT_EVENT = \"afterInit\";\n    public static final String BEFORE_SERVICE_EVENT = \"beforeService\";\n    public static final String AFTER_SERVICE_EVENT = \"afterService\";\n    public static final String BEFORE_DESTROY_EVENT = \"beforeDestroy\";\n    public static final String AFTER_DESTROY_EVENT = \"afterDestroy\";\n    public static final String BEFORE_DISPATCH_EVENT = \"beforeDispatch\";\n    public static final String AFTER_DISPATCH_EVENT = \"afterDispatch\";\n    public static final String BEFORE_FILTER_EVENT = \"beforeFilter\";\n    public static final String AFTER_FILTER_EVENT = \"afterFilter\";\n    public InstanceEvent(Wrapper wrapper, Filter filter, String type) {\n        super(wrapper);\n        this.wrapper = wrapper;\n        this.filter = filter;\n        this.servlet = null;\n        this.type = type;\n    }\n    public InstanceEvent(Wrapper wrapper, Filter filter, String type,\n                         Throwable exception) {\n        super(wrapper);\n        this.wrapper = wrapper;\n        this.filter = filter;\n        this.servlet = null;\n        this.type = type;\n        this.exception = exception;\n    }\n    public InstanceEvent(Wrapper wrapper, Filter filter, String type,\n                         ServletRequest request, ServletResponse response) {\n        super(wrapper);\n        this.wrapper = wrapper;\n        this.filter = filter;\n        this.servlet = null;\n        this.type = type;\n        this.request = request;\n        this.response = response;\n    }\n    public InstanceEvent(Wrapper wrapper, Filter filter, String type,\n                         ServletRequest request, ServletResponse response,\n                         Throwable exception) {\n        super(wrapper);\n        this.wrapper = wrapper;\n        this.filter = filter;\n        this.servlet = null;\n        this.type = type;\n        this.request = request;\n        this.response = response;\n        this.exception = exception;\n    }\n    public InstanceEvent(Wrapper wrapper, Servlet servlet, String type) {\n        super(wrapper);\n        this.wrapper = wrapper;\n        this.filter = null;\n        this.servlet = servlet;\n        this.type = type;\n    }\n    public InstanceEvent(Wrapper wrapper, Servlet servlet, String type,\n                         Throwable exception) {\n        super(wrapper);\n        this.wrapper = wrapper;\n        this.filter = null;\n        this.servlet = servlet;\n        this.type = type;\n        this.exception = exception;\n    }\n    public InstanceEvent(Wrapper wrapper, Servlet servlet, String type,\n                         ServletRequest request, ServletResponse response) {\n        super(wrapper);\n        this.wrapper = wrapper;\n        this.filter = null;\n        this.servlet = servlet;\n        this.type = type;\n        this.request = request;\n        this.response = response;\n    }\n    public InstanceEvent(Wrapper wrapper, Servlet servlet, String type,\n                         ServletRequest request, ServletResponse response,\n                         Throwable exception) {\n        super(wrapper);\n        this.wrapper = wrapper;\n        this.filter = null;\n        this.servlet = servlet;\n        this.type = type;\n        this.request = request;\n        this.response = response;\n        this.exception = exception;\n    }\n    private Throwable exception = null;\n    private Filter filter = null;\n    private ServletRequest request = null;\n    private ServletResponse response = null;\n    private Servlet servlet = null;\n    private String type = null;\n    private Wrapper wrapper = null;\n    public Throwable getException() {\n        return (this.exception);\n    }\n    public Filter getFilter() {\n        return (this.filter);\n    }\n    public ServletRequest getRequest() {\n        return (this.request);\n    }\n    public ServletResponse getResponse() {\n        return (this.response);\n    }\n    public Servlet getServlet() {\n        return (this.servlet);\n    }\n    public String getType() {\n        return (this.type);\n    }\n    public Wrapper getWrapper() {\n        return (this.wrapper);\n    }\n}\n</code></pre><p>InstanceListeneræ˜¯Servletäº‹ä»¶çš„ç›‘å¬å™¨ã€‚</p><pre><code class=\"language-java\">package com.minit;\npublic interface InstanceListener {\n    public void instanceEvent(InstanceEvent event);\n}\n</code></pre><p>SessionEventæ˜¯sessionäº‹ä»¶ã€‚</p><pre><code class=\"language-java\">package com.minit;\npublic final class SessionEvent extends EventObject {\n    private Object data = null;\n    private Session session = null;\n    private String type = null;\n    public SessionEvent(Session session, String type, Object data) {\n        super(session);\n        this.session = session;\n        this.type = type;\n        this.data = data;\n    }\n    public Object getData() {\n        return (this.data);\n    }\n    public Session getSession() {\n        return (this.session);\n    }\n    public String getType() {\n        return (this.type);\n    }\n    public String toString() {\n        return (\"SessionEvent['\" + getSession() + \"','\" +\n                getType() + \"']\");\n    }\n}\n</code></pre><p>SessionListeneræ˜¯sessionäº‹ä»¶ç›‘å¬å™¨ã€‚</p><pre><code class=\"language-java\">package com.minit;\npublic interface SessionListener {\n    public void sessionEvent(SessionEvent event);\n}\n</code></pre><p>æœ‰äº†è¿™äº›äº‹ä»¶å’Œç›‘å¬å™¨çš„å®šä¹‰åï¼Œåœ¨å“åº”çš„ç±»é‡Œé¢åŠ ä¸Š <code>addlistener()</code>ã€<code>removelistener()</code> æ–¹æ³•ä»¥åŠ <code>fireEvent()</code> å°±å¯ä»¥äº†ã€‚æ‰€ä»¥åœ¨StandardContextç±»å’ŒStandardSessionç±»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ è¿™ä¸‰ä¸ªæ–¹æ³•ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹ç›¸å…³å®ç°ã€‚</p><p>é¦–å…ˆæ˜¯StandardContextç±»ï¼Œæˆ‘ä»¬åœ¨ä»£ç é‡Œæ–°å¢æ–¹æ³•å®ç°ã€‚è¿™äº›æ–°ä»£ç å¤„ç†äº†å®¹å™¨ç›‘å¬å™¨ã€‚</p><pre><code class=\"language-java\">package com.minit.core;\npublic class StandardContext extends ContainerBase implements Context{\n    private ArrayList&lt;ContainerListenerDef&gt; listenerDefs = new ArrayList&lt;&gt;();\n    private ArrayList&lt;ContainerListener&gt; listeners = new ArrayList&lt;&gt;();\n    \n    public void start(){\n    &nbsp;   // è§¦å‘ä¸€ä¸ªå®¹å™¨å¯åŠ¨äº‹ä»¶&nbsp;&nbsp;\n        fireContainerEvent(\"Container Started\",this);\n    }\n    public void addContainerListener(ContainerListener listener) {\n        // æ·»åŠ ä¸€ä¸ªæ–°çš„å®¹å™¨ç›‘å¬å™¨åˆ°ç›‘å¬å™¨åˆ—è¡¨ï¼Œå¹¶ç¡®ä¿çº¿ç¨‹å®‰å…¨&nbsp;&nbsp;\n        synchronized (listeners) {\n            listeners.add(listener);\n        }\n    }\n    public void removeContainerListener(ContainerListener listener) {\n        // ç§»é™¤æŒ‡å®šçš„å®¹å™¨ç›‘å¬å™¨ï¼Œå¹¶ç¡®ä¿çº¿ç¨‹å®‰å…¨&nbsp;&nbsp;\n        synchronized (listeners) {\n            listeners.remove(listener);\n        }\n    }\n    public void fireContainerEvent(String type, Object data) {\n        // æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰ç›‘å¬å™¨ï¼Œå¦‚æœæ²¡æœ‰åˆ™ç›´æ¥è¿”å›&nbsp;&nbsp;\n        if (listeners.size() &lt; 1)\n            return;\n        ContainerEvent event = new ContainerEvent(this, type, data);\n        ContainerListener list[] = new ContainerListener[0];\n        synchronized (listeners) {\n            list = (ContainerListener[]) listeners.toArray(list);\n        }\n        // éå†æ‰€æœ‰ç›‘å¬å™¨å¹¶è§¦å‘äº‹ä»¶&nbsp;&nbsp;\n        for (int i = 0; i &lt; list.length; i++)\n            ((ContainerListener) list[i]).containerEvent(event);\n    }\n    public void addListenerDef(ContainerListenerDef listenererDef) {\n        synchronized (listenerDefs) {\n            listenerDefs.add(listenererDef);\n        }\n    }\n    \n    public boolean listenerStart() {\n        System.out.println(\"Listener Start..........\");\n        boolean ok = true;\n        synchronized (listeners) {\n            listeners.clear();\n            Iterator&lt;ContainerListenerDef&gt; defs = listenerDefs.iterator();\n            while (defs.hasNext()) {\n                ContainerListenerDef def = defs.next();\n                ContainerListener listener = null;\n                try {\n                    // ç¡®å®šæˆ‘ä»¬å°†è¦ä½¿ç”¨çš„ç±»åŠ è½½å™¨\n                    String listenerClass = def.getListenerClass();\n                    ClassLoader classLoader = null;\n                    classLoader = this.getLoader();\n                    ClassLoader oldCtxClassLoader =\n                            Thread.currentThread().getContextClassLoader();\n                    // åˆ›å»ºè¿™ä¸ªè¿‡æ»¤å™¨çš„æ–°å®ä¾‹å¹¶è¿”å›å®ƒ\n                    Class&lt;?&gt; clazz = classLoader.loadClass(listenerClass);\n                    listener = (ContainerListener) clazz.newInstance();\n                    addContainerListener(listener);\n                } catch (Throwable t) {\n                    t.printStackTrace();\n                    ok = false;\n                }\n            }\n        }\n        return (ok);\n    }\n}\n</code></pre><p>å’Œå‰é¢è¯´çš„ä¸€æ ·ï¼Œæˆ‘ä»¬åœ¨è¿™å„¿æ–°å¢äº†addContainerListenerã€removeContainerListenerä»¥åŠfireContainerEventä¸‰ä¸ªæ–¹æ³•ï¼Œä½¿æ–¹æ³•åç§°æ›´åŠ å…·ä½“åŒ–äº†ã€‚æœ‰ä¸€äº›ä¸åŒçš„æ˜¯æˆ‘ä»¬è¿˜å¼•å…¥äº†addListenerDefæ–¹æ³•ï¼Œæ¥å—ContainerListenerDefç±»å‹çš„ä¼ å‚æ•°ã€‚å…¶å®ContainerListenerDefå’Œä¸Šä¸€éƒ¨åˆ†çš„FilterDefç±»ä¼¼ï¼Œä¹Ÿåªæ˜¯å¯¹Containerç›‘å¬å™¨çš„å±æ€§è¿›è¡Œå®šä¹‰ï¼Œæˆ‘ä»¬çœ‹çœ‹å…·ä½“å®šä¹‰å†…å®¹ã€‚</p><pre><code class=\"language-java\">package com.minit.core;\npublic final class ContainerListenerDef {\n    private String description = null;\n    public String getDescription() {\n        return (this.description);\n    }\n    public void setDescription(String description) {\n        this.description = description;\n    }\n    private String displayName = null;\n    public String getDisplayName() {\n        return (this.displayName);\n    }\n    public void setDisplayName(String displayName) {\n        this.displayName = displayName;\n    }\n    private String listenerClass = null;\n    public String getListenerClass() {\n        return (this.listenerClass);\n    }\n    public void setListenerClass(String listenerClass) {\n        this.listenerClass = listenerClass;\n    }\n    private String listenerName = null;\n    public String getListenerName() {\n        return (this.listenerName);\n    }\n    public void setListenerName(String listenerName) {\n        this.listenerName = listenerName;\n    }\n    private Map&lt;String,String&gt; parameters = new ConcurrentHashMap&lt;&gt;();\n    public Map&lt;String,String&gt; getParameterMap() {\n        return (this.parameters);\n    }\n    public void addInitParameter(String name, String value) {\n        parameters.put(name, value);\n    }\n    public String toString() {\n        StringBuffer sb = new StringBuffer(\"ListenerDef[\");\n        sb.append(\"listenerName=\");\n        sb.append(this.listenerName);\n        sb.append(\", listenerClass=\");\n        sb.append(this.listenerClass);\n        sb.append(\"]\");\n        return (sb.toString());\n    }\n}\n</code></pre><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹StandardSessionç±»å¦‚ä½•è¿›è¡Œæ”¹é€ ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹æ–°å¢çš„ä»£ç å®ç°ã€‚ä»£ç é‡Œé¢å¢åŠ äº†sessionç›‘å¬å™¨çš„å¤„ç†ã€‚</p><pre><code class=\"language-java\">package com.minit.session;\npublic class StandardSession implements HttpSession, Session {\n    private transient ArrayList&lt;SessionListener&gt; listeners = new ArrayList&lt;&gt;();\n    public void addSessionListener(SessionListener listener) {\n        synchronized (listeners) {\n            listeners.add(listener);\n        }\n    }\n    public void removeSessionListener(SessionListener listener) {\n        synchronized (listeners) {\n            listeners.remove(listener);\n        }\n    }\n    public void fireSessionEvent(String type, Object data) {\n        if (listeners.size() &lt; 1)\n            return;\n        SessionEvent event = new SessionEvent(this, type, data);\n        SessionListener list[] = new SessionListener[0];\n        synchronized (listeners) {\n            list = (SessionListener[]) listeners.toArray(list);\n        }\n        for (int i = 0; i &lt; list.length; i++)\n            ((SessionListener) list[i]).sessionEvent(event);\n    }\n    \n    public void setId(String sessionId) {\n        this.sessionid = sessionId;\n        fireSessionEvent(Session.SESSION_CREATED_EVENT, null);\n    }\n}\n</code></pre><p>å…¶å®ä¹ŸåŸºæœ¬ä¸Šç±»ä¼¼äºStandardContextã€‚å’Œè¿‡æ»¤å™¨ä¸€æ ·ï¼Œæœ€åæˆ‘ä»¬åœ¨å¯åŠ¨ç±»BootStrapçš„mainå‡½æ•°é‡Œå¯åŠ¨ç›‘å¬å™¨å°±å¯ä»¥äº†ï¼Œè¿™æ ·åœ¨æœåŠ¡å™¨è¿è¡Œè¿‡ç¨‹ä¸­åˆ™ä¼šæŒç»­ç›‘å¬æŒ‡å®šäº‹ä»¶ã€‚ä½ å¯ä»¥çœ‹ä¸€ä¸‹æ”¹é€ åBootStrapç±»ä¸­çš„mainæ–¹æ³•ã€‚</p><pre><code class=\"language-java\">package com.minit.startup;\npublic class BootStrap {\n    public static final String WEB_ROOT =\n            System.getProperty(\"user.dir\") + File.separator + \"webroot\";\n    private static int debug = 0;\n    public static void main(String[] args) {\n        if (debug &gt;= 1)\n            log(\".... startup ....\");\n        HttpConnector connector = new HttpConnector();\n        StandardContext container = new StandardContext();\n        connector.setContainer(container);\n        container.setConnector(connector);\n        Logger logger = new FileLogger();\n        container.setLogger(logger);\n        FilterDef filterDef = new FilterDef();\n        filterDef.setFilterName(\"TestFilter\");\n        filterDef.setFilterClass(\"test.TestFilter\");\n        container.addFilterDef(filterDef);\n        FilterMap filterMap = new FilterMap();\n        filterMap.setFilterName(\"TestFilter\");\n        filterMap.setURLPattern(\"/*\");\n        container.addFilterMap(filterMap);\n        container.filterStart();\n        ContainerListenerDef listenerDef = new ContainerListenerDef();\n        listenerDef.setListenerName(\"TestListener\");\n        listenerDef.setListenerClass(\"test.TestListener\");\n        container.addListenerDef(listenerDef);\n        container.listenerStart();\n        container.start();\n        connector.start();\n    }\n}\n</code></pre><p>åˆ°è¿™é‡Œç›‘å¬å™¨éƒ¨åˆ†çš„æ”¹é€ å°±å…ˆå‘Šä¸€æ®µè½ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥ç›‘å¬Sessionå’ŒContainerçš„åŠ¨æ€äº†ã€‚</p><p>åŒæ ·åœ°ï¼Œåœ¨æµ‹è¯•ç›®å½•ä¸­æ–°å¢TestListenerï¼Œå¯ä»¥æµ‹è¯•æˆ‘ä»¬çš„åŠŸèƒ½ï¼Œæµ‹è¯•æ–¹æ³•çš„å®ç°æ¯”è¾ƒç®€å•ï¼Œç›´æ¥è¾“å‡ºäº‹ä»¶å¯¹è±¡ï¼Œèƒ½å¤Ÿåœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°è¾“å‡ºå°±å¯ä»¥äº†ã€‚</p><pre><code class=\"language-java\">package test;\nimport com.minit.ContainerEvent;\nimport com.minit.ContainerListener;\npublic class TestListener implements ContainerListener{\n    @Override\n    public void containerEvent(ContainerEvent event) {\n        System.out.println(event);\n    }\n}\n</code></pre><p>æˆ‘ä»¬éœ€è¦å°† <code>TestFilter.java</code> ä¸ <code>TestListener.java</code> è¿›è¡Œç¼–è¯‘ï¼Œç”Ÿæˆçš„ <code>.class</code> æ–‡ä»¶æ”¾å…¥webrootç›®å½•ä¸‹ã€‚</p><h2>å°ç»“</h2><p>è¿™èŠ‚è¯¾æˆ‘ä»¬è¿›ä¸€æ­¥å®Œå–„äº†MiniTomcatï¼Œæ–°å¢äº†è¿‡æ»¤å™¨å’Œäº‹ä»¶ç›‘å¬å™¨ã€‚è¿‡æ»¤å™¨å¯ä»¥åœ¨Containeräº’ç›¸è°ƒç”¨çš„æ—¶å€™å‘æŒ¥ä½œç”¨ï¼Œå¯¹è¯·æ±‚å¯¹è±¡ä¸å“åº”å¯¹è±¡è¿›ä¸€æ­¥å°è£…æ”¹é€ ï¼Œè€Œä¸”é€šè¿‡FilterChainå¯ä»¥è®©è¿‡æ»¤å™¨è·Ÿé“¾æ¡ä¸€æ ·ä¸²è”ä½¿ç”¨ã€‚è€Œäº‹ä»¶ç›‘å¬å™¨åˆ™å¯ä»¥å¯¹æœåŠ¡å™¨è¿è¡Œè¿‡ç¨‹ä¸­çš„Containerä¸Sessionç­‰è¿›è¡ŒæŒç»­ç›‘å¬ï¼Œæ•è·å®ƒä»¬çš„çŠ¶æ€ï¼Œå¯ä»¥å¯¹å¯åŠ¨ã€è¶…æ—¶ã€å“åº”ç­‰è¿‡ç¨‹è¿›è¡Œå¤„ç†ã€‚</p><p>è¿™ä¸¤ç§æœºåˆ¶ä½¿æˆ‘ä»¬çš„MiniTomcatæ›´åŠ æ˜“äºç»´æŠ¤å’Œæ‰©å±•ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°é€‚åº”å„ç§ä¸šåŠ¡éœ€æ±‚å’Œå˜åŒ–ã€‚åŒæ—¶ï¼Œè¿‡æ»¤å™¨å’Œç›‘å¬å™¨ä¹Ÿæé«˜äº†ç³»ç»Ÿçš„çµæ´»æ€§å’Œå¯è¿½æº¯æ€§ï¼Œå¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç®¡ç†å’Œç›‘æ§æœåŠ¡å™¨çš„è¿è¡ŒçŠ¶å†µã€‚</p><p>è¿™èŠ‚è¯¾ä»£ç å‚è§ï¼š<a href=\"https://gitee.com/yaleguo1/minit-learning-demo/tree/geek_chapter13\">https://gitee.com/yaleguo1/minit-learning-demo/tree/geek_chapter13</a></p><h2>æ€è€ƒé¢˜</h2><p>å­¦å®Œäº†è¿™èŠ‚è¯¾çš„å†…å®¹ï¼Œæˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šå‡ ä¸ªfilteræŒ‰ç…§èŒè´£é“¾ä¸²åœ¨ä¸€èµ·ï¼Œå…·ä½“å“ªå‡ æ®µä»£ç æ˜¯ç”¨æ¥å®ç°é“¾æ¡ä¾æ¬¡è°ƒç”¨çš„å‘¢ï¼Ÿ</p><p>æ¬¢è¿ä½ æŠŠä½ çš„ç­”æ¡ˆåˆ†äº«åˆ°è¯„è®ºåŒºï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾çš„å†…å®¹åˆ†äº«ç»™å…¶ä»–æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","comments":[{"had_liked":false,"id":386337,"user_name":"HHğŸ·ğŸ ","can_delete":false,"product_type":"c1","uid":1133678,"ip_address":"å¹¿ä¸œ","ucode":"C50172BDA604D5","user_header":"https://static001.geekbang.org/account/avatar/00/11/4c/6e/5435e214.jpg","comment_is_top":false,"comment_ctime":1704612612,"is_pvip":false,"replies":[{"id":140890,"content":"å¾ˆå¥½ã€‚ å†è€ƒè™‘ä¸€ä¸‹valveä¹‹é—´çš„æ¬¡åºï¼Œå’Œfilterä¹‹é—´çš„æ¬¡åºï¼Œæ˜¯ä¸€æ ·çš„å—ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1705023594,"ip_address":"æ¾³å¤§åˆ©äºš","comment_id":386337,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"æŠ“å¤§æ”¾å°ï¼Œ ä¸ªäººè§‰å¾—æ ¸å¿ƒæµç¨‹ï¼š ApplicationFilterChain.doFilter()  --&gt;  ApplicationFilterChain.internalDoFilter()   --&gt;   Filter.doFilter()  --&gt; ApplicationFilterChain.doFilter()   ä¸€ä¸ªç¯çŠ¶ï¼› å…¥å£ StandardWrapperValve ï¼Œ å‡ºå£æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªFilterã€‚ ","like_count":0,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635646,"discussion_content":"å¾ˆå¥½ã€‚ å†è€ƒè™‘ä¸€ä¸‹valveä¹‹é—´çš„æ¬¡åºï¼Œå’Œfilterä¹‹é—´çš„æ¬¡åºï¼Œæ˜¯ä¸€æ ·çš„å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1705023594,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¾³å¤§åˆ©äºš","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":1,"child_discussions":[{"author":{"id":1133678,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4c/6e/5435e214.jpg","nickname":"HHğŸ·ğŸ ","note":"","ucode":"C50172BDA604D5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":635767,"discussion_content":"ä¸ä¸€æ ·ï¼Œ åˆšå¥½ç›¸å","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1705142708,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":635646,"ip_address":"å¹¿ä¸œ","group_id":0},"score":635767,"extra":""}]}]},{"had_liked":false,"id":386323,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"åŒ—äº¬","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1704579857,"is_pvip":false,"replies":[{"id":140894,"content":"HttpServerè¿™ä¸ªåå­—å«ä¹‰æ˜¯æœåŠ¡å™¨ï¼ŒBootstrapå«ä¹‰æ˜¯å¯åŠ¨ï¼ŒåŠŸèƒ½çš„åˆ’åˆ†ï¼Œå¯åŠ¨çš„æ¦‚å¿µæ›´åŠ è´´åˆ‡\nFilter&#47;Listeneræ˜¯è§„èŒƒå®šä¹‰çš„ï¼Œå¿…é¡»ç¬¦åˆè§„èŒƒï¼Œåªèƒ½è‡ªå·±å®ç°ä¸èƒ½ä¿®æ”¹æ¥å£\nç”¨Arraylistæ˜¯è¿™ç§åœºæ™¯ï¼šæœ‰æ¬¡åºï¼Œä¸éœ€è¦åå­—ã€‚æ‰€ä»¥è¿™é‡Œç”¨çš„arraylist\næ˜¯filterchainæœ€åè°ƒç”¨servletï¼Œè¿™æ˜¯è§„èŒƒè§„å®šçš„\nä»æœ¯è¯­ä¸Šï¼Œservletæ˜¯åç«¯ï¼Œä¸æ˜¯æµè§ˆå™¨ä¸Šçš„ï¼Œè¿œå¤æ—¶ä»£ï¼Œæµè§ˆå™¨ä¸Šæœ‰applet","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1705024086,"ip_address":"æ¾³å¤§åˆ©äºš","comment_id":386323,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"è¯·æ•™è€å¸ˆå‡ ä¸ªé—®é¢˜ï¼š\nQ1ï¼šBootStrapä»£æ›¿äº†HttpServerå—ï¼Ÿä¸ºä»€ä¹ˆè¿™ä¹ˆåšï¼Ÿ\nQ2ï¼šFilterã€Listenerå¯ä»¥æ‰©å±•å—ï¼Ÿ\næ¯”å¦‚ï¼Œç”¨æˆ·è‡ªå®šä¹‰Filterã€Listenerï¼Œæ˜¯å¦æ”¯æŒï¼Ÿ\nQ3ï¼šç”¨ ArrayList å­˜æ”¾æ‰€æœ‰çš„ filterå’Œlistenerï¼Œæœ‰ä»€ä¹ˆè€ƒè™‘ï¼Ÿ\nç”¨Mapä¸è¡Œå—ï¼Ÿ\nQ4ï¼šå¯¹äºFilterï¼Œæ˜¯FilterChainæœ€åè°ƒç”¨servletå—ï¼Ÿ\næŒ‰è¯´ä¸åº”è¯¥ç”±Filterè°ƒç”¨servletï¼Œè€Œæ˜¯ç”±ä¸€ä¸ªæ›´é«˜å±‚çš„ä¸€ä¸ªä¸œè¥¿æ¥è°ƒç”¨ï¼Œç±»ä¼¼äºæ§åˆ¶å™¨æˆ–è°ƒåº¦å™¨ä¸€ç±»çš„æ¥è°ƒç”¨ã€‚\nQ5ï¼šæœ‰æµè§ˆå™¨ä¸Šçš„servletå—ï¼Ÿ\næˆ‘ä»¬è¿™é‡Œè¯´çš„servletï¼Œéƒ½æ˜¯è¿è¡Œåœ¨åç«¯ã€‚æˆ‘å¬è¯´æœ‰è¿è¡Œåœ¨æµè§ˆå™¨ä¸Šçš„servletï¼Œæ˜¯å¦æœ‰ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635650,"discussion_content":"HttpServerè¿™ä¸ªåå­—å«ä¹‰æ˜¯æœåŠ¡å™¨ï¼ŒBootstrapå«ä¹‰æ˜¯å¯åŠ¨ï¼ŒåŠŸèƒ½çš„åˆ’åˆ†ï¼Œå¯åŠ¨çš„æ¦‚å¿µæ›´åŠ è´´åˆ‡\nFilter/Listeneræ˜¯è§„èŒƒå®šä¹‰çš„ï¼Œå¿…é¡»ç¬¦åˆè§„èŒƒï¼Œåªèƒ½è‡ªå·±å®ç°ä¸èƒ½ä¿®æ”¹æ¥å£\nç”¨Arraylistæ˜¯è¿™ç§åœºæ™¯ï¼šæœ‰æ¬¡åºï¼Œä¸éœ€è¦åå­—ã€‚æ‰€ä»¥è¿™é‡Œç”¨çš„arraylist\næ˜¯filterchainæœ€åè°ƒç”¨servletï¼Œè¿™æ˜¯è§„èŒƒè§„å®šçš„\nä»æœ¯è¯­ä¸Šï¼Œservletæ˜¯åç«¯ï¼Œä¸æ˜¯æµè§ˆå™¨ä¸Šçš„ï¼Œè¿œå¤æ—¶ä»£ï¼Œæµè§ˆå™¨ä¸Šæœ‰applet","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1705024086,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¾³å¤§åˆ©äºš","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":390184,"user_name":"åˆ°ä¸äº†çš„å¡”","can_delete":false,"product_type":"c1","uid":1258362,"ip_address":"ä¸Šæµ·","ucode":"0F5BE3CB58DE31","user_header":"https://static001.geekbang.org/account/avatar/00/13/33/7a/ac307bfc.jpg","comment_is_top":false,"comment_ctime":1714611535,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"éƒ­è€å¸ˆï¼Œä½ å¥½ï¼Œè¯·é—®ä¸‹ä¸ºå•¥StandardContextä¸­ä¼šæœ‰listenerDefså­—æ®µæ¥ä¿å­˜listener configå‘¢, æœ‰listenerså­—æ®µæ¥ä¿å­˜listenerå®ä¾‹åº”è¯¥å°±è¶³å¤Ÿæ»¡è¶³éœ€æ±‚äº†å§ã€‚ \næˆ‘çœ‹filterçš„è®¾è®¡ä¹Ÿè·Ÿè¿™ç±»ä¼¼ï¼Œä¹Ÿæœ‰filter configï¼Œè¿™ç§è®¾è®¡çš„å¥½å¤„æ˜¯å•¥ï¼Ÿ","like_count":0}]}