{"id":464273,"title":"23ï½œå‡½æ•°ï¼šæ€ä¹ˆè®©å‡½æ•°æ›´ç®€æ´å¥å£®ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯Tony Baiã€‚</p><p>åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å¼€å§‹å­¦ä¹ å‡½æ•°è®¾è®¡çš„ç›¸å…³çŸ¥è¯†ï¼Œå­¦ä¹ äº†å¦‚ä½•åŸºäºGoå‡½æ•°çš„å¤šè¿”å›å€¼æœºåˆ¶è¿›è¡Œå‡½æ•°é”™è¯¯å€¼æ„é€ æ–¹å¼çš„è®¾è®¡ï¼Œä½ è¿˜è®°å¾—é‚£å‡ ç§é”™è¯¯å€¼æ„é€ ä¸å¤„ç†çš„ç­–ç•¥å—ï¼Ÿå½“ç„¶ï¼Œè‰¯å¥½çš„å‡½æ•°è®¾è®¡ä¸ä»…ä»…è¦åŒ…å«é”™è¯¯è®¾è®¡ï¼Œå‡½æ•°çš„å¥å£®æ€§ä¸ç®€æ´ä¼˜é›…ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨å‡½æ•°è®¾è®¡è¿‡ç¨‹ä¸­è¦è€ƒè™‘çš„é—®é¢˜ã€‚</p><p>å¥å£®çš„å‡½æ•°æ„å‘³ç€ï¼Œæ— è®ºè°ƒç”¨è€…å¦‚ä½•ä½¿ç”¨ä½ çš„å‡½æ•°ï¼Œä½ çš„å‡½æ•°éƒ½èƒ½ä»¥åˆç†çš„æ–¹å¼å¤„ç†è°ƒç”¨è€…çš„ä»»ä½•è¾“å…¥ï¼Œå¹¶ç»™è°ƒç”¨è€…è¿”å›é¢„è®¾çš„ã€æ¸…æ™°çš„é”™è¯¯å€¼ã€‚å³ä¾¿ä½ çš„å‡½æ•°å‘ç”Ÿå†…éƒ¨å¼‚å¸¸ï¼Œå‡½æ•°ä¹Ÿä¼šå°½åŠ›ä»å¼‚å¸¸ä¸­æ¢å¤ï¼Œå°½å¯èƒ½åœ°ä¸è®©å¼‚å¸¸è”“å»¶åˆ°æ•´ä¸ªç¨‹åºã€‚è€Œç®€æ´ä¼˜é›…ï¼Œåˆ™æ„å‘³ç€å‡½æ•°çš„å®ç°æ˜“è¯»ã€æ˜“ç†è§£ã€æ›´æ˜“ç»´æŠ¤ï¼ŒåŒæ—¶ç®€æ´ä¹Ÿæ„å‘³ç€ç»Ÿè®¡æ„ä¹‰ä¸Šçš„æ›´å°‘çš„bugã€‚</p><p>è¿™ä¸€èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°±å°†ç»§ç»­æˆ‘ä»¬çš„å‡½æ•°è®¾è®¡ä¹‹æ—…ï¼Œèšç„¦åœ¨å¥å£®ä¸ç®€æ´è¿™ä¸¤æ–¹é¢ï¼Œæˆ‘ä»¬éœ€è¦é‡ç‚¹å…³æ³¨çš„å†…å®¹ã€‚</p><p>æˆ‘ä»¬å…ˆä»å¥å£®æ€§å¼€å§‹ã€‚</p><h2>å¥å£®æ€§çš„â€œä¸‰ä¸è¦â€åŸåˆ™</h2><p>å‡½æ•°çš„å¥å£®æ€§è®¾è®¡åŒ…æ‹¬å¾ˆå¤šæ–¹é¢ï¼Œé¦–å…ˆå°±æœ‰æœ€åŸºæœ¬çš„â€œä¸‰ä¸è¦â€åŸåˆ™ï¼Œæˆ‘ä»¬ç®€å•æ¥åˆ†æä¸€ä¸‹ã€‚</p><p><strong>åŸåˆ™ä¸€ï¼šä¸è¦ç›¸ä¿¡ä»»ä½•å¤–éƒ¨è¾“å…¥çš„å‚æ•°ã€‚</strong></p><p>å‡½æ•°çš„ä½¿ç”¨è€…å¯èƒ½æ˜¯ä»»ä½•äººï¼Œè¿™äº›äººåœ¨ä½¿ç”¨å‡½æ•°ä¹‹å‰å¯èƒ½éƒ½æ²¡æœ‰é˜…è¯»è¿‡ä»»ä½•æ‰‹å†Œæˆ–æ–‡æ¡£ï¼Œä»–ä»¬ä¼šå‘å‡½æ•°ä¼ å…¥ä½ æ„æƒ³ä¸åˆ°çš„å‚æ•°ã€‚å› æ­¤ï¼Œä¸ºäº†ä¿è¯å‡½æ•°çš„å¥å£®æ€§ï¼Œå‡½æ•°éœ€è¦å¯¹æ‰€æœ‰è¾“å…¥çš„å‚æ•°è¿›è¡Œåˆæ³•æ€§çš„æ£€æŸ¥ã€‚ä¸€æ—¦å‘ç°é—®é¢˜ï¼Œç«‹å³ç»ˆæ­¢å‡½æ•°çš„æ‰§è¡Œï¼Œè¿”å›é¢„è®¾çš„é”™è¯¯å€¼ã€‚</p><!-- [[[read_end]]] --><p><strong>åŸåˆ™äºŒï¼šä¸è¦å¿½ç•¥ä»»ä½•ä¸€ä¸ªé”™è¯¯ã€‚</strong></p><p>åœ¨æˆ‘ä»¬çš„å‡½æ•°å®ç°ä¸­ï¼Œä¹Ÿä¼šè°ƒç”¨æ ‡å‡†åº“æˆ–ç¬¬ä¸‰æ–¹åŒ…æä¾›çš„å‡½æ•°æˆ–æ–¹æ³•ã€‚å¯¹äºè¿™äº›è°ƒç”¨ï¼Œæˆ‘ä»¬ä¸èƒ½å‡å®šå®ƒä¸€å®šä¼šæˆåŠŸï¼Œæˆ‘ä»¬ä¸€å®šè¦æ˜¾å¼åœ°æ£€æŸ¥è¿™äº›è°ƒç”¨è¿”å›çš„é”™è¯¯å€¼ã€‚ä¸€æ—¦å‘ç°é”™è¯¯ï¼Œè¦åŠæ—¶ç»ˆæ­¢å‡½æ•°æ‰§è¡Œï¼Œé˜²æ­¢é”™è¯¯ç»§ç»­ä¼ æ’­ã€‚</p><p><strong>åŸåˆ™ä¸‰ï¼šä¸è¦å‡å®šå¼‚å¸¸ä¸ä¼šå‘ç”Ÿã€‚</strong></p><p>è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆè¦ç¡®å®šä¸€ä¸ªè®¤çŸ¥ï¼šå¼‚å¸¸ä¸æ˜¯é”™è¯¯ã€‚é”™è¯¯æ˜¯å¯é¢„æœŸçš„ï¼Œä¹Ÿæ˜¯ç»å¸¸ä¼šå‘ç”Ÿçš„ï¼Œæˆ‘ä»¬æœ‰å¯¹åº”çš„å…¬å¼€é”™è¯¯ç å’Œé”™è¯¯å¤„ç†é¢„æ¡ˆï¼Œä½†å¼‚å¸¸å´æ˜¯å°‘è§çš„ã€æ„æ–™ä¹‹å¤–çš„ã€‚é€šå¸¸æ„ä¹‰ä¸Šçš„å¼‚å¸¸ï¼ŒæŒ‡çš„æ˜¯ç¡¬ä»¶å¼‚å¸¸ã€æ“ä½œç³»ç»Ÿå¼‚å¸¸ã€è¯­è¨€è¿è¡Œæ—¶å¼‚å¸¸ï¼Œè¿˜æœ‰æ›´å¤§å¯èƒ½æ˜¯ä»£ç ä¸­æ½œåœ¨bugå¯¼è‡´çš„å¼‚å¸¸ï¼Œæ¯”å¦‚ä»£ç ä¸­å‡ºç°äº†ä»¥0ä½œä¸ºåˆ†æ¯ï¼Œæˆ–è€…æ˜¯æ•°ç»„è¶Šç•Œè®¿é—®ç­‰æƒ…å†µã€‚</p><p>è™½ç„¶å¼‚å¸¸å‘ç”Ÿæ˜¯â€œå°ä¼—äº‹ä»¶â€ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸èƒ½å‡å®šå¼‚å¸¸ä¸ä¼šå‘ç”Ÿã€‚æ‰€ä»¥ï¼Œå‡½æ•°è®¾è®¡æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦æ ¹æ®å‡½æ•°çš„è§’è‰²å’Œä½¿ç”¨åœºæ™¯ï¼Œè€ƒè™‘æ˜¯å¦è¦åœ¨å‡½æ•°å†…è®¾ç½®å¼‚å¸¸æ•æ‰å’Œæ¢å¤çš„ç¯èŠ‚ã€‚</p><p>åœ¨è¿™ä¸‰æ¡å¥å£®æ€§è®¾è®¡åŸåˆ™ä¸­ï¼Œåšåˆ°å‰ä¸¤æ¡æ˜¯ç›¸å¯¹å®¹æ˜“çš„ï¼Œä¹Ÿæ²¡æœ‰å¤ªå¤šæŠ€å·§å¯è¨€ã€‚ä½†å¯¹ç¬¬ä¸‰æ¡å¼‚å¸¸çš„å¤„ç†ï¼Œå¾ˆå¤šåˆå­¦è€…æ‹¿æä¸å¥½ã€‚æ‰€ä»¥åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°±é‡ç‚¹è¯´ä¸€ä¸‹<strong>Goå‡½æ•°çš„å¼‚å¸¸å¤„ç†è®¾è®¡</strong>ã€‚</p><h2>è®¤è¯†Goè¯­è¨€ä¸­çš„å¼‚å¸¸ï¼španic</h2><p>ä¸åŒç¼–ç¨‹è¯­è¨€è¡¨ç¤ºå¼‚å¸¸ï¼ˆExceptionï¼‰è¿™ä¸ªæ¦‚å¿µçš„è¯­æ³•éƒ½ä¸ç›¸åŒã€‚åœ¨Goè¯­è¨€ä¸­ï¼Œå¼‚å¸¸è¿™ä¸ªæ¦‚å¿µç”±panicè¡¨ç¤ºã€‚ä¸€äº›æ•™ç¨‹æˆ–æ–‡ç« ä¼šæŠŠå®ƒè¯‘ä¸ºææ…Œï¼Œæˆ‘è¿™é‡Œä¾æ—§é€‰æ‹©ä¸è¯‘ï¼Œä¿ç•™panicçš„åŸæ±åŸå‘³ã€‚</p><p>panicæŒ‡çš„æ˜¯Goç¨‹åºåœ¨è¿è¡Œæ—¶å‡ºç°çš„ä¸€ä¸ªå¼‚å¸¸æƒ…å†µã€‚å¦‚æœå¼‚å¸¸å‡ºç°äº†ï¼Œä½†æ²¡æœ‰è¢«æ•è·å¹¶æ¢å¤ï¼ŒGoç¨‹åºçš„æ‰§è¡Œå°±ä¼šè¢«ç»ˆæ­¢ï¼Œå³ä¾¿å‡ºç°å¼‚å¸¸çš„ä½ç½®ä¸åœ¨ä¸»Goroutineä¸­ä¹Ÿä¼šè¿™æ ·ã€‚</p><p>åœ¨Goä¸­ï¼Œpanicä¸»è¦æœ‰ä¸¤ç±»æ¥æºï¼Œä¸€ç±»æ˜¯æ¥è‡ª <strong>Goè¿è¡Œæ—¶</strong>ï¼Œå¦ä¸€ç±»åˆ™æ˜¯ <strong>Goå¼€å‘äººå‘˜é€šè¿‡panicå‡½æ•°ä¸»åŠ¨è§¦å‘çš„</strong>ã€‚æ— è®ºæ˜¯å“ªç§ï¼Œä¸€æ—¦panicè¢«è§¦å‘ï¼Œåç»­Goç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹éƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«Goè¯­è¨€ç§°ä¸º <strong>panicking</strong>ã€‚</p><p><a href=\"https://blog.golang.org/defer-panic-and-recover\">Goå®˜æ–¹æ–‡æ¡£</a>ä»¥æ‰‹å·¥è°ƒç”¨panicå‡½æ•°è§¦å‘panicä¸ºä¾‹ï¼Œå¯¹panickingè¿™ä¸ªè¿‡ç¨‹è¿›è¡Œäº†è¯ é‡Šï¼šå½“å‡½æ•°Fè°ƒç”¨panicå‡½æ•°æ—¶ï¼Œå‡½æ•°Fçš„æ‰§è¡Œå°†åœæ­¢ã€‚ä¸è¿‡ï¼Œå‡½æ•°Fä¸­å·²è¿›è¡Œæ±‚å€¼çš„deferredå‡½æ•°éƒ½ä¼šå¾—åˆ°æ­£å¸¸æ‰§è¡Œï¼Œæ‰§è¡Œå®Œè¿™äº›deferredå‡½æ•°åï¼Œå‡½æ•°Fæ‰ä¼šæŠŠæ§åˆ¶æƒè¿”è¿˜ç»™å…¶è°ƒç”¨è€…ã€‚</p><p>å¯¹äºå‡½æ•°Fçš„è°ƒç”¨è€…è€Œè¨€ï¼Œå‡½æ•°Fä¹‹åçš„è¡Œä¸ºå°±å¦‚åŒè°ƒç”¨è€…è°ƒç”¨çš„å‡½æ•°æ˜¯panicä¸€æ ·ï¼Œè¯¥ <code>panicking</code> è¿‡ç¨‹å°†ç»§ç»­åœ¨æ ˆä¸Šè¿›è¡Œä¸‹å»ï¼Œç›´åˆ°å½“å‰Goroutineä¸­çš„æ‰€æœ‰å‡½æ•°éƒ½è¿”å›ä¸ºæ­¢ï¼Œç„¶åGoç¨‹åºå°†å´©æºƒé€€å‡ºã€‚</p><p>æˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­æ¥æ›´ç›´è§‚åœ°è§£é‡Šä¸€ä¸‹panickingè¿™ä¸ªè¿‡ç¨‹ï¼š</p><pre><code class=\"language-plain\">func foo() {\n    println(\"call foo\")\n    bar()\n    println(\"exit foo\")\n}\n\nfunc bar() {\n    println(\"call bar\")\n    panic(\"panic occurs in bar\")\n    zoo()\n    println(\"exit bar\")\n}\n\nfunc zoo() {\n    println(\"call zoo\")\n    println(\"exit zoo\")\n}\n\nfunc main() {\n    println(\"call main\")\n    foo()\n    println(\"exit main\")\n}\n</code></pre><p>ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œä»Goåº”ç”¨å…¥å£å¼€å§‹ï¼Œå‡½æ•°çš„è°ƒç”¨æ¬¡åºä¾æ¬¡ä¸º <code>main -&gt; foo -&gt; bar -&gt; zoo</code>ã€‚åœ¨barå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨panicå‡½æ•°æ‰‹åŠ¨è§¦å‘äº†panicã€‚</p><p>æˆ‘ä»¬æ‰§è¡Œè¿™ä¸ªç¨‹åºçš„è¾“å‡ºç»“æœæ˜¯è¿™æ ·çš„ï¼š</p><pre><code class=\"language-plain\">call main\ncall foo\ncall bar\npanic: panic occurs in bar\n</code></pre><p>æˆ‘ä»¬å†æ ¹æ®å‰é¢å¯¹panickingè¿‡ç¨‹çš„è¯ é‡Šï¼Œç†è§£ä¸€ä¸‹è¿™ä¸ªä¾‹å­ã€‚</p><p>è¿™é‡Œï¼Œç¨‹åºä»å…¥å£å‡½æ•°mainå¼€å§‹ä¾æ¬¡è°ƒç”¨äº†fooã€barå‡½æ•°ï¼Œåœ¨barå‡½æ•°ä¸­ï¼Œä»£ç åœ¨è°ƒç”¨zooå‡½æ•°ä¹‹å‰è°ƒç”¨äº†panicå‡½æ•°è§¦å‘äº†å¼‚å¸¸ã€‚é‚£ç¤ºä¾‹çš„panickingè¿‡ç¨‹å°±ä»è¿™å¼€å§‹äº†ã€‚barå‡½æ•°è°ƒç”¨panicå‡½æ•°ä¹‹åï¼Œå®ƒè‡ªèº«çš„æ‰§è¡Œå°±æ­¤åœæ­¢äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿæ²¡æœ‰çœ‹åˆ°ä»£ç ç»§ç»­è¿›å…¥zooå‡½æ•°æ‰§è¡Œã€‚å¹¶ä¸”ï¼Œbarå‡½æ•°æ²¡æœ‰æ•æ‰è¿™ä¸ªpanicï¼Œè¿™æ ·è¿™ä¸ªpanicå°±ä¼šæ²¿ç€å‡½æ•°è°ƒç”¨æ ˆå‘ä¸Šèµ°ï¼Œæ¥åˆ°äº†barå‡½æ•°çš„è°ƒç”¨è€…fooå‡½æ•°ä¸­ã€‚</p><p>ä»fooå‡½æ•°çš„è§†è§’æ¥çœ‹ï¼Œè¿™å°±å¥½æ¯”å°†å®ƒå¯¹barå‡½æ•°çš„è°ƒç”¨ï¼Œæ¢æˆäº†å¯¹panicå‡½æ•°çš„è°ƒç”¨ä¸€æ ·ã€‚è¿™æ ·ä¸€æ¥ï¼Œfooå‡½æ•°çš„æ‰§è¡Œä¹Ÿè¢«åœæ­¢äº†ã€‚ç”±äºfooå‡½æ•°ä¹Ÿæ²¡æœ‰æ•æ‰panicï¼Œäºæ˜¯panicç»§ç»­æ²¿ç€å‡½æ•°è°ƒç”¨æ ˆå‘ä¸Šèµ°ï¼Œæ¥åˆ°äº†fooå‡½æ•°çš„è°ƒç”¨è€…mainå‡½æ•°ä¸­ã€‚</p><p>åŒç†ï¼Œä»mainå‡½æ•°çš„è§†è§’æ¥çœ‹ï¼Œè¿™å°±å¥½æ¯”å°†å®ƒå¯¹fooå‡½æ•°çš„è°ƒç”¨ï¼Œæ¢æˆäº†å¯¹panicå‡½æ•°çš„è°ƒç”¨ä¸€æ ·ã€‚ç»“æœå°±æ˜¯ï¼Œmainå‡½æ•°çš„æ‰§è¡Œä¹Ÿè¢«ç»ˆæ­¢äº†ï¼Œäºæ˜¯æ•´ä¸ªç¨‹åºå¼‚å¸¸é€€å‡ºï¼Œæ—¥å¿—\"exit main\"ä¹Ÿæ²¡æœ‰å¾—åˆ°è¾“å‡ºçš„æœºä¼šã€‚</p><p>ä¸è¿‡ï¼ŒGoä¹Ÿæä¾›äº†æ•æ‰panicå¹¶æ¢å¤ç¨‹åºæ­£å¸¸æ‰§è¡Œç§©åºçš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <strong>recoverå‡½æ•°</strong>æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p><p>æˆ‘ä»¬ç»§ç»­ç”¨ä¸Šé¢è¿™ä¸ªä¾‹å­åˆ†æï¼Œåœ¨è§¦å‘panicçš„barå‡½æ•°ä¸­ï¼Œå¯¹panicè¿›è¡Œæ•æ‰å¹¶æ¢å¤ï¼Œæˆ‘ä»¬ç›´æ¥æ¥çœ‹æ¢å¤åï¼Œæ•´ä¸ªç¨‹åºçš„æ‰§è¡Œæƒ…å†µæ˜¯ä»€ä¹ˆæ ·çš„ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬åªåˆ—å‡ºäº†å˜æ›´åçš„barå‡½æ•°ä»£ç ï¼Œå…¶ä»–å‡½æ•°ä»£ç å¹¶æ²¡æœ‰æ”¹å˜ï¼š</p><pre><code class=\"language-plain\">func bar() {\n    defer func() {\n        if e := recover(); e != nil {\n            fmt.Println(\"recover the panic:\", e)\n        }\n    }()\n\n    println(\"call bar\")\n    panic(\"panic occurs in bar\")\n    zoo()\n    println(\"exit bar\")\n}\n</code></pre><p>åœ¨æ›´æ–°ç‰ˆçš„barå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ªdeferåŒ¿åå‡½æ•°ä¸­è°ƒç”¨recoverå‡½æ•°å¯¹panicè¿›è¡Œäº†æ•æ‰ã€‚recoveræ˜¯Goå†…ç½®çš„ä¸“é—¨ç”¨äºæ¢å¤panicçš„å‡½æ•°ï¼Œå®ƒå¿…é¡»è¢«æ”¾åœ¨ä¸€ä¸ªdeferå‡½æ•°ä¸­æ‰èƒ½ç”Ÿæ•ˆã€‚å¦‚æœrecoveræ•æ‰åˆ°panicï¼Œå®ƒå°±ä¼šè¿”å›ä»¥panicçš„å…·ä½“å†…å®¹ä¸ºé”™è¯¯ä¸Šä¸‹æ–‡ä¿¡æ¯çš„é”™è¯¯å€¼ã€‚å¦‚æœæ²¡æœ‰panicå‘ç”Ÿï¼Œé‚£ä¹ˆrecoverå°†è¿”å›nilã€‚è€Œä¸”ï¼Œå¦‚æœpanicè¢«recoveræ•æ‰åˆ°ï¼Œpanicå¼•å‘çš„panickingè¿‡ç¨‹å°±ä¼šåœæ­¢ã€‚</p><p>å…³äºdeferå‡½æ•°çš„å†…å®¹æˆ‘ä»¬ç­‰ä¼šè¿˜ä¼šè¯¦ç»†è®²ã€‚æ­¤åˆ»ä½ åªéœ€è¦çŸ¥é“ï¼Œæ— è®ºbarå‡½æ•°æ­£å¸¸æ‰§è¡Œç»“æŸï¼Œè¿˜æ˜¯å› panicå¼‚å¸¸ç»ˆæ­¢ï¼Œåœ¨é‚£ä¹‹å‰è®¾ç½®æˆåŠŸçš„deferå‡½æ•°éƒ½ä¼šå¾—åˆ°æ‰§è¡Œå°±å¯ä»¥äº†ã€‚</p><p>æˆ‘ä»¬æ‰§è¡Œæ›´æ–°åçš„ç¨‹åºï¼Œå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p><pre><code class=\"language-plain\">call main\ncall foo\ncall bar\nrecover the panic: panic occurs in bar\nexit foo\nexit main\n</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°mainå‡½æ•°ç»ˆäºå¾—ä»¥â€œå–„ç»ˆâ€ã€‚é‚£è¿™ä¸ªè¿‡ç¨‹ä¸­ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>åœ¨æ›´æ–°åçš„ä»£ç ä¸­ï¼Œå½“barå‡½æ•°è°ƒç”¨panicå‡½æ•°è§¦å‘å¼‚å¸¸åï¼Œbarå‡½æ•°çš„æ‰§è¡Œå°±ä¼šè¢«ä¸­æ–­ã€‚ä½†è¿™ä¸€æ¬¡ï¼Œåœ¨ä»£ç æ‰§è¡Œæµå›åˆ°barå‡½æ•°è°ƒç”¨è€…ä¹‹å‰ï¼Œbarå‡½æ•°ä¸­çš„ã€åœ¨panicä¹‹å‰å°±å·²ç»è¢«è®¾ç½®æˆåŠŸçš„derferå‡½æ•°å°±ä¼šè¢«æ‰§è¡Œã€‚è¿™ä¸ªåŒ¿åå‡½æ•°ä¼šè°ƒç”¨recoveræŠŠåˆšåˆšè§¦å‘çš„panicæ¢å¤ï¼Œè¿™æ ·ï¼Œpanicè¿˜æ²¡ç­‰æ²¿ç€å‡½æ•°æ ˆå‘ä¸Šèµ°ï¼Œå°±è¢«æ¶ˆé™¤äº†ã€‚</p><p>æ‰€ä»¥ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä»fooå‡½æ•°çš„è§†è§’æ¥çœ‹ï¼Œbarå‡½æ•°ä¸æ­£å¸¸è¿”å›æ²¡æœ‰ä»€ä¹ˆå·®åˆ«ã€‚fooå‡½æ•°ä¾æ—§ç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œç›´è‡³mainå‡½æ•°æˆåŠŸè¿”å›ã€‚è¿™æ ·ï¼Œè¿™ä¸ªç¨‹åºçš„panicâ€œå±æœºâ€å°±è§£é™¤äº†ã€‚</p><p>é¢å¯¹æœ‰å¦‚æ­¤è¡Œä¸ºç‰¹ç‚¹çš„panicï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•åº”å¯¹å‘¢ï¼Ÿæ˜¯ä¸æ˜¯åœ¨æ‰€æœ‰Goå‡½æ•°æˆ–æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬éƒ½è¦ç”¨deferå‡½æ•°æ¥æ•æ‰å’Œæ¢å¤panicå‘¢ï¼Ÿ</p><h2>å¦‚ä½•åº”å¯¹panicï¼Ÿ</h2><p>å…¶å®å¤§å¯ä¸å¿…ã€‚</p><p>ä¸€æ¥ï¼Œè¿™æ ·åšä¼šå¾’å¢å¼€å‘äººå‘˜å‡½æ•°å®ç°æ—¶çš„å¿ƒæ™ºè´Ÿæ‹…ã€‚äºŒæ¥ï¼Œå¾ˆå¤šå‡½æ•°éå¸¸ç®€å•ï¼Œæ ¹æœ¬ä¸ä¼šå‡ºç°panicæƒ…å†µï¼Œæˆ‘ä»¬å¢åŠ panicæ•è·å’Œæ¢å¤ï¼Œåå€’ä¼šå¢åŠ å‡½æ•°çš„å¤æ‚æ€§ã€‚åŒæ—¶ï¼Œdeferå‡½æ•°ä¹Ÿä¸æ˜¯â€œå…è´¹â€çš„ï¼Œä¹Ÿæœ‰å¸¦æ¥æ€§èƒ½å¼€é”€ï¼ˆè¿™ä¸ªæˆ‘ä»¬åé¢ä¼šè®²è§£ï¼‰ã€‚</p><p>é‚£ä¹ˆï¼Œæ—¥å¸¸æƒ…å†µä¸‹æˆ‘ä»¬åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿæˆ‘è¿™é‡Œæä¾›äº†ä¸‰ç‚¹ç»éªŒï¼Œä½ å¯ä»¥å‚è€ƒä¸€ä¸‹ã€‚</p><h3>ç¬¬ä¸€ç‚¹ï¼šè¯„ä¼°ç¨‹åºå¯¹panicçš„å¿å—åº¦</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬åº”è¯¥çŸ¥é“ä¸€ä¸ªäº‹å®ï¼š<strong>ä¸åŒåº”ç”¨å¯¹å¼‚å¸¸å¼•èµ·çš„ç¨‹åºå´©æºƒé€€å‡ºçš„å¿å—åº¦æ˜¯ä¸ä¸€æ ·çš„</strong>ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªå•æ¬¡è¿è¡Œäºæ§åˆ¶å°çª—å£ä¸­çš„å‘½ä»¤è¡Œäº¤äº’ç±»ç¨‹åºï¼ˆCLIï¼‰ï¼Œå’Œä¸€ä¸ªå¸¸é©»å†…å­˜çš„åç«¯HTTPæœåŠ¡å™¨ç¨‹åºï¼Œå¯¹å¼‚å¸¸å´©æºƒçš„å¿å—åº¦å°±æ˜¯ä¸åŒçš„ã€‚</p><p>å‰è€…å³ä¾¿å› å¼‚å¸¸å´©æºƒï¼Œå¯¹ç”¨æˆ·æ¥è¯´ä¹Ÿä»…ä»…æ˜¯å†é‡æ–°è¿è¡Œä¸€æ¬¡è€Œå·²ã€‚ä½†åè€…ä¸€æ—¦å´©æºƒï¼Œå°±å¾ˆå¯èƒ½å¯¼è‡´æ•´ä¸ªç½‘ç«™åœæ­¢æœåŠ¡ã€‚æ‰€ä»¥ï¼Œ<strong>é’ˆå¯¹å„ç§åº”ç”¨å¯¹panicå¿å—åº¦çš„å·®å¼‚ï¼Œæˆ‘ä»¬é‡‡å–çš„åº”å¯¹panicçš„ç­–ç•¥ä¹Ÿåº”è¯¥æœ‰ä¸åŒ</strong>ã€‚åƒåç«¯HTTPæœåŠ¡å™¨ç¨‹åºè¿™æ ·çš„ä»»åŠ¡å…³é”®ç³»ç»Ÿï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨ç‰¹å®šä½ç½®æ•æ‰å¹¶æ¢å¤panicï¼Œä»¥ä¿è¯æœåŠ¡å™¨æ•´ä½“çš„å¥å£®åº¦ã€‚åœ¨è¿™æ–¹é¢ï¼ŒGoæ ‡å‡†åº“ä¸­çš„http serverå°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ä»£è¡¨ã€‚</p><p>Goæ ‡å‡†åº“æä¾›çš„http serveré‡‡ç”¨çš„æ˜¯ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥éƒ½ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„Goroutineè¿›è¡Œå¤„ç†çš„å¹¶å‘å¤„ç†æ¨¡å‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯ä¸€æ—¦ä¸http serverè¿æ¥æˆåŠŸï¼Œhttp serverå°±ä¼šä¸ºè¿™ä¸ªè¿æ¥æ–°åˆ›å»ºä¸€ä¸ªGoroutineï¼Œå¹¶åœ¨è¿™Goroutineä¸­æ‰§è¡Œå¯¹åº”è¿æ¥ï¼ˆconnï¼‰çš„serveæ–¹æ³•ï¼Œæ¥å¤„ç†è¿™æ¡è¿æ¥ä¸Šçš„å®¢æˆ·ç«¯è¯·æ±‚ã€‚</p><p>å‰é¢æåˆ°äº†panicçš„â€œå±å®³â€æ—¶ï¼Œæˆ‘ä»¬è¯´è¿‡ï¼Œ<strong>æ— è®ºåœ¨å“ªä¸ªGoroutineä¸­å‘ç”Ÿæœªè¢«æ¢å¤çš„panicï¼Œæ•´ä¸ªç¨‹åºéƒ½å°†å´©æºƒé€€å‡º</strong>ã€‚æ‰€ä»¥ï¼Œä¸ºäº†ä¿è¯å¤„ç†æŸä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥çš„Goroutineå‡ºç°panicæ—¶ï¼Œä¸å½±å“åˆ°http serverä¸»Goroutineçš„è¿è¡Œï¼ŒGoæ ‡å‡†åº“åœ¨serveæ–¹æ³•ä¸­åŠ å…¥äº†å¯¹panicçš„æ•æ‰ä¸æ¢å¤ï¼Œä¸‹é¢æ˜¯serveæ–¹æ³•çš„éƒ¨åˆ†ä»£ç ç‰‡æ®µï¼š</p><pre><code class=\"language-plain\">// $GOROOT/src/net/http/server.go\n// Serve a new connection.\nfunc (c *conn) serve(ctx context.Context) {\n    c.remoteAddr = c.rwc.RemoteAddr().String()\n    ctx = context.WithValue(ctx, LocalAddrContextKey, c.rwc.LocalAddr())\n    defer func() {\n        if err := recover(); err != nil &amp;&amp; err != ErrAbortHandler {\n            const size = 64 &lt;&lt; 10\n            buf := make([]byte, size)\n            buf = buf[:runtime.Stack(buf, false)]\n            c.server.logf(\"http: panic serving %v: %v\\n%s\", c.remoteAddr, err, buf)\n        }\n        if !c.hijacked() {\n            c.close()\n            c.setState(c.rwc, StateClosed, runHooks)\n        }\n    }()\n    ... ...\n}\n</code></pre><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œserveæ–¹æ³•åœ¨ä¸€å¼€å§‹å¤„å°±è®¾ç½®äº†deferå‡½æ•°ï¼Œå¹¶åœ¨è¯¥å‡½æ•°ä¸­æ•æ‰å¹¶æ¢å¤äº†å¯èƒ½å‡ºç°çš„panicã€‚è¿™æ ·ï¼Œå³ä¾¿å¤„ç†æŸä¸ªå®¢æˆ·ç«¯è¿æ¥çš„Goroutineå‡ºç°panicï¼Œå¤„ç†å…¶ä»–è¿æ¥Goroutineä»¥åŠhttp serverè‡ªèº«éƒ½ä¸ä¼šå—åˆ°å½±å“ã€‚</p><p>è¿™ç§<strong>å±€éƒ¨ä¸è¦å½±å“æ•´ä½“</strong>çš„å¼‚å¸¸å¤„ç†ç­–ç•¥ï¼Œåœ¨å¾ˆå¤šå¹¶å‘ç¨‹åºä¸­éƒ½æœ‰åº”ç”¨ã€‚å¹¶ä¸”ï¼Œæ•æ‰å’Œæ¢å¤panicçš„ä½ç½®é€šå¸¸éƒ½åœ¨å­Goroutineçš„èµ·å§‹å¤„ï¼Œè¿™æ ·è®¾ç½®å¯ä»¥æ•æ‰åˆ°åé¢ä»£ç ä¸­å¯èƒ½å‡ºç°çš„æ‰€æœ‰panicï¼Œå°±åƒserveæ–¹æ³•ä¸­é‚£æ ·ã€‚</p><h3>ç¬¬äºŒç‚¹ï¼šæç¤ºæ½œåœ¨bug</h3><p>æœ‰äº†å¯¹panicå¿å—åº¦çš„è¯„ä¼°ï¼Œpanicæ˜¯ä¸æ˜¯ä¹Ÿæ²¡æœ‰é‚£ä¹ˆâ€œææ€–â€äº†å‘¢ï¼Ÿè€Œä¸”ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥å€ŸåŠ©panicæ¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿæ‰¾åˆ°æ½œåœ¨bugã€‚</p><p>Cè¯­è¨€ä¸­æœ‰ä¸ªå¾ˆå¥½ç”¨çš„è¾…åŠ©å‡½æ•°ï¼Œæ–­è¨€ï¼ˆassertå®ï¼‰ã€‚åœ¨ä½¿ç”¨Cç¼–å†™ä»£ç æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸åœ¨ä¸€äº›ä»£ç æ‰§è¡Œè·¯å¾„ä¸Šï¼Œä½¿ç”¨æ–­è¨€æ¥è¡¨è¾¾è¿™æ®µæ‰§è¡Œè·¯å¾„ä¸ŠæŸç§æ¡ä»¶ä¸€å®šä¸ºçœŸçš„ä¿¡å¿ƒã€‚æ–­è¨€ä¸ºçœŸï¼Œåˆ™ç¨‹åºå¤„äºæ­£ç¡®è¿è¡ŒçŠ¶æ€ï¼Œæ–­è¨€ä¸ºå¦å°±æ˜¯å‡ºç°äº†æ„æ–™ä¹‹å¤–çš„é—®é¢˜ï¼Œè€Œè¿™ä¸ªé—®é¢˜å¾ˆå¯èƒ½å°±æ˜¯ä¸€ä¸ªæ½œåœ¨çš„bugï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥å€ŸåŠ©æ–­è¨€ä¿¡æ¯å¿«é€Ÿå®šä½åˆ°é—®é¢˜æ‰€åœ¨ã€‚</p><p>ä¸è¿‡ï¼ŒGoè¯­è¨€æ ‡å‡†åº“ä¸­å¹¶æ²¡æœ‰æä¾›æ–­è¨€ä¹‹ç±»çš„è¾…åŠ©å‡½æ•°ï¼Œä½†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨panicï¼Œéƒ¨åˆ†æ¨¡æ‹Ÿæ–­è¨€å¯¹æ½œåœ¨bugçš„æç¤ºåŠŸèƒ½ã€‚æ¯”å¦‚ï¼Œä¸‹é¢å°±æ˜¯æ ‡å‡†åº“ <code>encoding/json</code>åŒ…ä½¿ç”¨panicæŒ‡ç¤ºæ½œåœ¨bugçš„ä¸€ä¸ªä¾‹å­ï¼š</p><pre><code class=\"language-plain\">// $GOROOT/src/encoding/json/decode.go\n... ...\n//å½“ä¸€äº›æœ¬ä¸è¯¥å‘ç”Ÿçš„äº‹æƒ…å¯¼è‡´æˆ‘ä»¬ç»“æŸå¤„ç†æ—¶ï¼ŒphasePanicMsgå°†è¢«ç”¨ä½œpanicæ¶ˆæ¯\n//å®ƒå¯ä»¥æŒ‡ç¤ºJSONè§£ç å™¨ä¸­çš„bugï¼Œæˆ–è€…\n//åœ¨è§£ç å™¨æ‰§è¡Œæ—¶è¿˜æœ‰å…¶ä»–ä»£ç æ­£åœ¨ä¿®æ”¹æ•°æ®åˆ‡ç‰‡ã€‚\n\nconst phasePanicMsg = \"JSON decoder out of sync - data changing underfoot?\"\n\nfunc (d *decodeState) init(data []byte) *decodeState {\n    d.data = data\n    d.off = 0\n    d.savedError = nil\n    if d.errorContext != nil {\n        d.errorContext.Struct = nil\n        // Reuse the allocated space for the FieldStack slice.\n        d.errorContext.FieldStack = d.errorContext.FieldStack[:0]\n    }\n    return d\n}\n\nfunc (d *decodeState) valueQuoted() interface{} {\n    switch d.opcode {\n    default:\n        panic(phasePanicMsg)\n\n    case scanBeginArray, scanBeginObject:\n        d.skip()\n        d.scanNext()\n\n    case scanBeginLiteral:\n        v := d.literalInterface()\n        switch v.(type) {\n        case nil, string:\n            return v\n        }\n    }\n    return unquotedValue{}\n}\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œåœ¨ <code>valueQuoted</code> è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œå¦‚æœç¨‹åºæ‰§è¡Œæµè¿›å…¥äº†defaultåˆ†æ”¯ï¼Œé‚£è¿™ä¸ªæ–¹æ³•å°±ä¼šå¼•å‘panicï¼Œè¿™ä¸ªpanicä¼šæç¤ºå¼€å‘äººå‘˜ï¼šè¿™é‡Œå¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªbugã€‚</p><p>åŒæ ·ï¼Œåœ¨jsonåŒ…çš„encode.goä¸­ä¹Ÿæœ‰ä½¿ç”¨panicåšæ½œåœ¨bugæç¤ºçš„ä¾‹å­ï¼š</p><pre><code class=\"language-plain\">// $GOROOT/src/encoding/json/encode.go\n\nfunc (w *reflectWithString) resolve() error {\n    ... ...\n    switch w.k.Kind() {\n    case reflect.Int, reflect.Int8, reflect.Int16, reflect.Int32, reflect.Int64:\n        w.ks = strconv.FormatInt(w.k.Int(), 10)\n        return nil\n    case reflect.Uint, reflect.Uint8, reflect.Uint16, reflect.Uint32, reflect.Uint64, reflect.Uintptr:\n        w.ks = strconv.FormatUint(w.k.Uint(), 10)\n        return nil\n    }\n    panic(\"unexpected map key type\")\n}\n\n</code></pre><p>è¿™æ®µä»£ç ä¸­ï¼Œ<code>resolve</code> æ–¹æ³•çš„æœ€åä¸€è¡Œä»£ç å°±ç›¸å½“äºä¸€ä¸ªâ€œä»£ç é€»è¾‘ä¸ä¼šèµ°åˆ°è¿™é‡Œâ€çš„æ–­è¨€ã€‚ä¸€æ—¦è§¦å‘â€œæ–­è¨€â€ï¼Œè¿™å¾ˆå¯èƒ½å°±æ˜¯ä¸€ä¸ªæ½œåœ¨bugã€‚</p><p>æˆ‘ä»¬ä¹Ÿçœ‹åˆ°ï¼Œå»æ‰è¿™è¡Œä»£ç å¹¶ä¸ä¼šå¯¹ <code>resolve</code> æ–¹æ³•çš„é€»è¾‘é€ æˆä»»ä½•å½±å“ï¼Œä½†çœŸæ­£å‡ºç°é—®é¢˜æ—¶ï¼Œå¼€å‘äººå‘˜å°±ç¼ºå°‘äº†â€œæ–­è¨€â€æ½œåœ¨bugæé†’çš„è¾…åŠ©æ”¯æŒäº†ã€‚åœ¨Goæ ‡å‡†åº“ä¸­ï¼Œ<strong>å¤§å¤šæ•°panicçš„ä½¿ç”¨éƒ½æ˜¯å……å½“ç±»ä¼¼æ–­è¨€çš„ä½œç”¨çš„</strong>ã€‚</p><h3>ç¬¬ä¸‰ç‚¹ï¼šä¸è¦æ··æ·†å¼‚å¸¸ä¸é”™è¯¯</h3><p>åœ¨æ—¥å¸¸ç¼–ç ä¸­ï¼Œæˆ‘ç»å¸¸ä¼šçœ‹åˆ°ä¸€äº›Goè¯­è¨€åˆå­¦è€…ï¼Œå°¤å…¶æ˜¯ä¸€äº›æœ‰è¿‡Javaè¯­è¨€ç¼–ç¨‹ç»éªŒçš„ç¨‹åºå‘˜ï¼Œä¼šå› ä¸ºä¹ æƒ¯äº†Javaé‚£ç§åŸºäº <code>try-catch-finally</code> çš„é”™è¯¯å¤„ç†æ€ç»´ï¼Œè€Œå°†Go panicå½“æˆJavaçš„â€œchecked exceptionâ€å»ç”¨ï¼Œè¿™æ˜¾ç„¶æ˜¯æ··æ·†äº†Goä¸­çš„å¼‚å¸¸ä¸é”™è¯¯ï¼Œè¿™æ˜¯Goé”™è¯¯å¤„ç†çš„ä¸€ç§åæ¨¡å¼ã€‚</p><p>æŸ¥çœ‹Javaæ ‡å‡†ç±»åº“ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€äº›Javaå·²é¢„å®šä¹‰å¥½çš„ <code>checked exception</code> ç±»ï¼Œæ¯”è¾ƒå¸¸è§çš„æœ‰ <code>IOException</code>ã€<code>TimeoutException</code>ã€<code>EOFException</code>ã€<code>FileNotFoundException</code>ï¼Œç­‰ç­‰ã€‚çœ‹åˆ°è¿™é‡Œï¼Œä½ æ˜¯ä¸æ˜¯è§‰å¾—è¿™äº›checked exceptionå’Œæˆ‘ä»¬ä¸Šä¸€èŠ‚è®²çš„â€œå“¨å…µé”™è¯¯å€¼â€ååˆ†ç›¸ä¼¼å‘¢ï¼Ÿã€‚å®ƒä»¬éƒ½æ˜¯é¢„å®šä¹‰å¥½çš„ã€ä»£è¡¨ç‰¹å®šåœºæ™¯ä¸‹çš„é”™è¯¯çŠ¶æ€ã€‚</p><p>é‚£Javaçš„ <code>checked exception</code>  å’ŒGoä¸­çš„panicæœ‰å•¥å·®åˆ«å‘¢ï¼Ÿ</p><p>Javaçš„ <code>checked exception</code> ç”¨äºä¸€äº›å¯é¢„è§çš„ã€å¸¸ä¼šå‘ç”Ÿçš„é”™è¯¯åœºæ™¯ï¼Œæ¯”å¦‚ï¼Œé’ˆå¯¹ <code>checked exception</code> çš„æ‰€è°“â€œå¼‚å¸¸å¤„ç†â€ï¼Œå°±æ˜¯é’ˆå¯¹è¿™äº›åœºæ™¯çš„<strong>â€œé”™è¯¯å¤„ç†é¢„æ¡ˆâ€</strong>ã€‚ä¹Ÿå¯ä»¥è¯´å¯¹ <code>checked exception</code> çš„ä½¿ç”¨ã€æ•è·ã€è‡ªå®šä¹‰ç­‰è¡Œä¸ºéƒ½æ˜¯â€œ<strong>æœ‰æ„è€Œä¸ºä¹‹</strong>â€çš„ã€‚</p><p>å¦‚æœå®ƒéè¦å’ŒGoä¸­çš„æŸç§è¯­æ³•å¯¹åº”æ¥çœ‹ï¼Œå®ƒå¯¹åº”çš„ä¹Ÿæ˜¯Goçš„é”™è¯¯å¤„ç†ï¼Œä¹Ÿå°±æ˜¯åŸºäºerrorå€¼æ¯”è¾ƒæ¨¡å‹çš„é”™è¯¯å¤„ç†ã€‚æ‰€ä»¥ï¼ŒJavaä¸­å¯¹ <code>checked exception</code> å¤„ç†çš„æœ¬è´¨æ˜¯<strong>é”™è¯¯å¤„ç†</strong>ï¼Œè™½ç„¶å®ƒçš„åå­—ç”¨äº†å¸¦æœ‰â€œå¼‚å¸¸â€çš„å­—æ ·ã€‚</p><p>è€ŒGoä¸­çš„panicå‘¢ï¼Œæ›´æ¥è¿‘äºJavaçš„ <code>RuntimeException</code>+<code>Error</code> ï¼Œè€Œä¸æ˜¯ <code>checked exception</code> ã€‚æˆ‘ä»¬å‰é¢æåˆ°è¿‡Javaçš„ <code>checked exception</code> æ˜¯å¿…é¡»è¦è¢«ä¸Šå±‚ä»£ç å¤„ç†çš„ï¼Œä¹Ÿå°±æ˜¯è¦ä¹ˆæ•è·å¤„ç†ï¼Œè¦ä¹ˆé‡æ–°æŠ›ç»™æ›´ä¸Šå±‚ã€‚ä½†æ˜¯åœ¨Goä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå¯¼å…¥å¤§é‡ç¬¬ä¸‰æ–¹åŒ…ï¼Œè€Œå¯¹äºè¿™äº›ç¬¬ä¸‰æ–¹åŒ…APIä¸­æ˜¯å¦ä¼šå¼•å‘ <code>panic</code> ï¼Œæˆ‘ä»¬æ˜¯ä¸çŸ¥é“çš„ã€‚</p><p>å› æ­¤ä¸Šå±‚ä»£ç ï¼Œä¹Ÿå°±æ˜¯APIè°ƒç”¨è€…æ ¹æœ¬ä¸ä¼šå»é€ä¸€äº†è§£APIæ˜¯å¦ä¼šå¼•å‘<code>panic</code>ï¼Œä¹Ÿæ²¡æœ‰ä¹‰åŠ¡å»å¤„ç†å¼•å‘çš„panicã€‚ä¸€æ—¦ä½ åœ¨ç¼–å†™çš„APIä¸­ï¼Œåƒ <code>checked exception</code> é‚£æ ·ä½¿ç”¨panicä½œä¸ºæ­£å¸¸é”™è¯¯å¤„ç†çš„æ‰‹æ®µï¼ŒæŠŠå¼•å‘çš„ <code>panic</code> å½“ä½œé”™è¯¯ï¼Œé‚£ä¹ˆä½ å°±ä¼šç»™ä½ çš„APIä½¿ç”¨è€…å¸¦å»å¤§éº»çƒ¦ï¼å› æ­¤ï¼Œåœ¨Goä¸­ï¼Œä½œä¸ºAPIå‡½æ•°çš„ä½œè€…ï¼Œä½ ä¸€å®š<strong>ä¸è¦å°†panicå½“ä½œé”™è¯¯è¿”å›ç»™APIè°ƒç”¨è€…</strong>ã€‚</p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»åŸºæœ¬è®²å®Œäº†å‡½æ•°å¥å£®æ€§è®¾è®¡è¦æ³¨æ„çš„å„ç§äº‹é¡¹ï¼Œä½ ä¸€å®šè¦æ³¨æ„æˆ‘å‰é¢æåˆ°çš„è¿™å‡ ç‚¹ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿›å…¥ä¸‹ä¸€éƒ¨åˆ†ï¼Œçœ‹çœ‹å‡½æ•°çš„ç®€æ´æ€§è®¾è®¡ã€‚</p><h2>ä½¿ç”¨deferç®€åŒ–å‡½æ•°å®ç°</h2><p>å¯¹å‡½æ•°è®¾è®¡æ¥è¯´ï¼Œå¦‚ä½•å®ç°ç®€æ´çš„ç›®æ ‡æ˜¯ä¸€ä¸ªå¤§è¯é¢˜ã€‚ä½ å¯ä»¥ä»é€šç”¨çš„è®¾è®¡åŸåˆ™å»è°ˆï¼Œæ¯”å¦‚å‡½æ•°è¦éµå®ˆå•ä¸€èŒè´£ï¼ŒèŒè´£å•ä¸€çš„å‡½æ•°è‚¯å®šè¦æ¯”æ‹…è´Ÿå¤šç§èŒè´£çš„å‡½æ•°æ›´ç®€å•ã€‚ä½ ä¹Ÿå¯ä»¥ä»å‡½æ•°å®ç°çš„è§„æ¨¡å»è°ˆï¼Œæ¯”å¦‚å‡½æ•°ä½“çš„è§„æ¨¡è¦å°ï¼Œå°½é‡æ§åˆ¶åœ¨80è¡Œä»£ç ä¹‹å†…ç­‰ã€‚</p><p>ä½†æˆ‘ä»¬è¿™ä¸ªæ˜¯Goè¯­è¨€çš„è¯¾ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„è§’åº¦æ›´ä¾§é‡äº <strong>Goä¸­æ˜¯å¦æœ‰ç°æˆçš„è¯­æ³•å…ƒç´ ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç®€åŒ–Goå‡½æ•°çš„è®¾è®¡å’Œå®ç°</strong>ã€‚æˆ‘ä¹ŸæŠŠç­”æ¡ˆå‰§é€ç»™ä½ ï¼Œæœ‰çš„ï¼Œå®ƒå°±æ˜¯ <strong>defer</strong>ã€‚</p><p>åŒæ ·åœ°ï¼Œæˆ‘ä»¬ä¹Ÿç”¨ä¸€ä¸ªå…·ä½“çš„ä¾‹å­æ¥ç†è§£ä¸€ä¸‹ã€‚æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šç¼–å†™ä¸€äº›ç±»ä¼¼ä¸‹é¢ç¤ºä¾‹ä¸­çš„ä¼ªä»£ç ï¼š</p><pre><code class=\"language-plain\">func doSomething() error {\n    var mu sync.Mutex\n    mu.Lock()\n\n    r1, err := OpenResource1()\n    if err != nil {\n        mu.Unlock()\n        return err\n    }\n\n    r2, err := OpenResource2()\n    if err != nil {\n        r1.Close()\n        mu.Unlock()\n        return err\n    }\n\n    r3, err := OpenResource3()\n    if err != nil {\n        r2.Close()\n        r1.Close()\n        mu.Unlock()\n        return err\n    }\n\n    // ä½¿ç”¨r1ï¼Œr2, r3\n    err = doWithResources() \n    if err != nil {\n        r3.Close()\n        r2.Close()\n        r1.Close()\n        mu.Unlock()\n        return err\n    }\n\n    r3.Close()\n    r2.Close()\n    r1.Close()\n    mu.Unlock()\n    return nil\n}\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œè¿™ç±»ä»£ç çš„ç‰¹ç‚¹å°±æ˜¯åœ¨å‡½æ•°ä¸­ä¼šç”³è¯·ä¸€äº›èµ„æºï¼Œå¹¶åœ¨å‡½æ•°é€€å‡ºå‰é‡Šæ”¾æˆ–å…³é—­è¿™äº›èµ„æºï¼Œæ¯”å¦‚è¿™é‡Œçš„äº’æ–¥é”muä»¥åŠèµ„æºr1~r3å°±æ˜¯è¿™æ ·ã€‚</p><p>å‡½æ•°çš„å®ç°éœ€è¦ç¡®ä¿ï¼Œæ— è®ºå‡½æ•°çš„æ‰§è¡Œæµæ˜¯æŒ‰é¢„æœŸé¡ºåˆ©è¿›è¡Œï¼Œè¿˜æ˜¯å‡ºç°é”™è¯¯ï¼Œè¿™äº›èµ„æºåœ¨å‡½æ•°é€€å‡ºæ—¶éƒ½è¦è¢«åŠæ—¶ã€æ­£ç¡®åœ°é‡Šæ”¾ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°¤ä¸ºå…³æ³¨å‡½æ•°ä¸­çš„é”™è¯¯å¤„ç†ï¼Œåœ¨é”™è¯¯å¤„ç†æ—¶ä¸èƒ½é—æ¼å¯¹èµ„æºçš„é‡Šæ”¾ã€‚</p><p>ä½†è¿™æ ·çš„è¦æ±‚ï¼Œå°±å¯¼è‡´æˆ‘ä»¬åœ¨è¿›è¡Œèµ„æºé‡Šæ”¾ï¼Œå°¤å…¶æ˜¯æœ‰å¤šä¸ªèµ„æºéœ€è¦é‡Šæ”¾çš„æ—¶å€™ï¼Œæ¯”å¦‚ä¸Šé¢ç¤ºä¾‹é‚£æ ·ï¼Œä¼šå¤§å¤§å¢åŠ å¼€å‘äººå‘˜çš„å¿ƒæ™ºè´Ÿæ‹…ã€‚åŒæ—¶å½“å¾…é‡Šæ”¾çš„èµ„æºä¸ªæ•°è¾ƒå¤šæ—¶ï¼Œæ•´ä¸ªä»£ç é€»è¾‘å°±ä¼šå˜å¾—ååˆ†å¤æ‚ï¼Œç¨‹åºå¯è¯»æ€§ã€å¥å£®æ€§ä¹Ÿä¼šéšä¹‹ä¸‹é™ã€‚ä½†å³ä¾¿å¦‚æ­¤ï¼Œå¦‚æœå‡½æ•°å®ç°ä¸­çš„æŸæ®µä»£ç é€»è¾‘æŠ›å‡ºpanicï¼Œä¼ ç»Ÿçš„é”™è¯¯å¤„ç†æœºåˆ¶ä¾ç„¶æ²¡æœ‰åŠæ³•æ•è·å®ƒå¹¶å°è¯•ä»panicæ¢å¤ã€‚</p><p><strong>Goè¯­è¨€å¼•å…¥deferçš„åˆè¡·ï¼Œå°±æ˜¯è§£å†³è¿™äº›é—®é¢˜ã€‚é‚£ä¹ˆï¼Œdeferå…·ä½“æ˜¯æ€ä¹ˆè§£å†³è¿™äº›é—®é¢˜çš„å‘¢ï¼Ÿæˆ–è€…è¯´ï¼Œdeferå…·ä½“çš„è¿ä½œæœºåˆ¶æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</strong></p><p>deferæ˜¯Goè¯­è¨€æä¾›çš„ä¸€ç§å»¶è¿Ÿè°ƒç”¨æœºåˆ¶ï¼Œdeferçš„è¿ä½œç¦»ä¸å¼€å‡½æ•°ã€‚æ€ä¹ˆç†è§£å‘¢ï¼Ÿè¿™å¥è¯è‡³å°‘æœ‰ä»¥ä¸‹ä¸¤ç‚¹å«ä¹‰ï¼š</p><ul>\n<li>åœ¨Goä¸­ï¼Œåªæœ‰åœ¨å‡½æ•°ï¼ˆå’Œæ–¹æ³•ï¼‰å†…éƒ¨æ‰èƒ½ä½¿ç”¨deferï¼›</li>\n<li>deferå…³é”®å­—åé¢åªèƒ½æ¥å‡½æ•°ï¼ˆæˆ–æ–¹æ³•ï¼‰ï¼Œè¿™äº›å‡½æ•°è¢«ç§°ä¸º <strong>deferredå‡½æ•°</strong>ã€‚deferå°†å®ƒä»¬æ³¨å†Œåˆ°å…¶æ‰€åœ¨Goroutineä¸­ï¼Œç”¨äºå­˜æ”¾deferredå‡½æ•°çš„æ ˆæ•°æ®ç»“æ„ä¸­ï¼Œè¿™äº›deferredå‡½æ•°å°†åœ¨æ‰§è¡Œdeferçš„å‡½æ•°é€€å‡ºå‰ï¼ŒæŒ‰åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰çš„é¡ºåºè¢«ç¨‹åºè°ƒåº¦æ‰§è¡Œï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ã€‚<br>\n<img src=\"https://static001.geekbang.org/resource/image/89/c0/89d2f5ec28f6c291bf44deb4c5f979c0.jpg?wh=1920x1080\" alt=\"å›¾ç‰‡\"></li>\n</ul><p>è€Œä¸”ï¼Œæ— è®ºæ˜¯æ‰§è¡Œåˆ°å‡½æ•°ä½“å°¾éƒ¨è¿”å›ï¼Œè¿˜æ˜¯åœ¨æŸä¸ªé”™è¯¯å¤„ç†åˆ†æ”¯æ˜¾å¼returnï¼Œåˆæˆ–æ˜¯å‡ºç°panicï¼Œå·²ç»å­˜å‚¨åˆ°deferredå‡½æ•°æ ˆä¸­çš„å‡½æ•°ï¼Œéƒ½ä¼šè¢«è°ƒåº¦æ‰§è¡Œã€‚æ‰€ä»¥è¯´ï¼Œdeferredå‡½æ•°æ˜¯ä¸€ä¸ªå¯ä»¥åœ¨ä»»ä½•æƒ…å†µä¸‹ä¸ºå‡½æ•°è¿›è¡Œ<strong>æ”¶å°¾å·¥ä½œ</strong>çš„å¥½â€œä¼™ä¼´â€ã€‚</p><p>æˆ‘ä»¬å›åˆ°åˆšæ‰çš„é‚£ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬æŠŠæ”¶å°¾å·¥ä½œæŒªåˆ°deferredå‡½æ•°ä¸­ï¼Œé‚£ä¹ˆä»£ç å°†å˜æˆå¦‚ä¸‹è¿™ä¸ªæ ·å­ï¼š</p><pre><code class=\"language-plain\">func doSomething() error {\n    var mu sync.Mutex\n    mu.Lock()\n    defer mu.Unlock()\n\n    r1, err := OpenResource1()\n    if err != nil {\n        return err\n    }\n    defer r1.Close()\n\n    r2, err := OpenResource2()\n    if err != nil {\n        return err\n    }\n    defer r2.Close()\n\n    r3, err := OpenResource3()\n    if err != nil {\n        return err\n    }\n    defer r3.Close()\n\n    // ä½¿ç”¨r1ï¼Œr2, r3\n    return doWithResources() \n}\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œä½¿ç”¨deferåå¯¹å‡½æ•°å®ç°é€»è¾‘çš„ç®€åŒ–æ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚è€Œä¸”ï¼Œè¿™é‡Œèµ„æºé‡Šæ”¾å‡½æ•°çš„deferæ³¨å†ŒåŠ¨ä½œï¼Œç´§é‚»ç€èµ„æºç”³è¯·æˆåŠŸçš„åŠ¨ä½œï¼Œè¿™æ ·æˆå¯¹å‡ºç°çš„æƒ¯ä¾‹å°±æå¤§é™ä½äº†é—æ¼èµ„æºé‡Šæ”¾çš„å¯èƒ½æ€§ï¼Œæˆ‘ä»¬å¼€å‘äººå‘˜ä¹Ÿä¸ç”¨å†å°å¿ƒç¿¼ç¿¼åœ°åœ¨æ¯ä¸ªé”™è¯¯å¤„ç†åˆ†æ”¯ä¸­æ£€æŸ¥æ˜¯å¦é—æ¼äº†æŸä¸ªèµ„æºçš„é‡Šæ”¾åŠ¨ä½œã€‚åŒæ—¶ï¼Œä»£ç çš„ç®€åŒ–ä¹Ÿæ„å‘³ä»£ç å¯è¯»æ€§çš„æé«˜ï¼Œä»¥åŠä»£ç å¥å£®åº¦çš„å¢å¼ºã€‚</p><p>é‚£æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ä½¿ç”¨deferï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆè¦ç‰¹åˆ«æ³¨æ„çš„å‘¢ï¼Ÿ</p><h2>deferä½¿ç”¨çš„å‡ ä¸ªæ³¨æ„äº‹é¡¹</h2><p>å¤§å¤šæ•°Gopheréƒ½å–œæ¬¢deferï¼Œå› ä¸ºå®ƒä¸ä»…å¯ä»¥ç”¨æ¥æ•æ‰å’Œæ¢å¤panicï¼Œè¿˜èƒ½è®©å‡½æ•°å˜å¾—æ›´ç®€æ´å’Œå¥å£®ã€‚ä½†â€œå·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨â€œï¼Œä¸€æ—¦ä½ è¦ç”¨deferï¼Œæœ‰å‡ ä¸ªå…³äºdeferä½¿ç”¨çš„æ³¨æ„äº‹é¡¹æ˜¯ä½ ä¸€å®šè¦æå‰äº†è§£æ¸…æ¥šçš„ï¼Œå¯ä»¥é¿å…æ‰è¿›ä¸€äº›ä¸å¿…è¦çš„â€œå‘â€ã€‚</p><h3>ç¬¬ä¸€ç‚¹ï¼šæ˜ç¡®å“ªäº›å‡½æ•°å¯ä»¥ä½œä¸ºdeferredå‡½æ•°</h3><p>è¿™é‡Œï¼Œä½ è¦æ¸…æ¥šï¼Œå¯¹äºè‡ªå®šä¹‰çš„å‡½æ•°æˆ–æ–¹æ³•ï¼Œdeferå¯ä»¥ç»™ä¸æ— æ¡ä»¶çš„æ”¯æŒï¼Œä½†æ˜¯å¯¹äºæœ‰è¿”å›å€¼çš„è‡ªå®šä¹‰å‡½æ•°æˆ–æ–¹æ³•ï¼Œè¿”å›å€¼ä¼šåœ¨deferredå‡½æ•°è¢«è°ƒåº¦æ‰§è¡Œçš„æ—¶å€™è¢«è‡ªåŠ¨ä¸¢å¼ƒã€‚</p><p>è€Œä¸”ï¼ŒGoè¯­è¨€ä¸­é™¤äº†è‡ªå®šä¹‰å‡½æ•°/æ–¹æ³•ï¼Œè¿˜æœ‰Goè¯­è¨€å†…ç½®çš„/é¢„å®šä¹‰çš„å‡½æ•°ï¼Œè¿™é‡Œæˆ‘ç»™å‡ºäº†Goè¯­è¨€å†…ç½®å‡½æ•°çš„å®Œå…¨åˆ—è¡¨ï¼š</p><pre><code class=\"language-plain\">Functions:\n\tappend cap close complex copy delete imag len\n\tmake new panic print println real recover\n</code></pre><p>é‚£ä¹ˆï¼ŒGoè¯­è¨€ä¸­çš„å†…ç½®å‡½æ•°æ˜¯å¦éƒ½èƒ½ä½œä¸ºdeferredå‡½æ•°å‘¢ï¼Ÿæˆ‘ä»¬çœ‹ä¸‹é¢çš„ç¤ºä¾‹ï¼š</p><pre><code class=\"language-plain\">// defer1.go\n\n func bar() (int, int) {\n     return 1, 2\n }\n \n func foo() {\n     var c chan int\n     var sl []int\n     var m = make(map[string]int, 10)\n     m[\"item1\"] = 1\n     m[\"item2\"] = 2\n     var a = complex(1.0, -1.4)\n \n     var sl1 []int\n     defer bar()\n     defer append(sl, 11)\n     defer cap(sl)\n     defer close(c)\n     defer complex(2, -2)\n     defer copy(sl1, sl)\n     defer delete(m, \"item2\")\n     defer imag(a)\n     defer len(sl)\n     defer make([]int, 10)\n     defer new(*int)\n     defer panic(1)\n     defer print(\"hello, defer\\n\")\n     defer println(\"hello, defer\")\n     defer real(a)\n     defer recover()\n }\n \n func main() {\n     foo()\n }\n</code></pre><p>è¿è¡Œè¿™ä¸ªç¤ºä¾‹ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ï¼š</p><pre><code class=\"language-plain\">$go run defer1.go\n# command-line-arguments\n./defer1.go:17:2: defer discards result of append(sl, 11)\n./defer1.go:18:2: defer discards result of cap(sl)\n./defer1.go:20:2: defer discards result of complex(2, -2)\n./defer1.go:23:2: defer discards result of imag(a)\n./defer1.go:24:2: defer discards result of len(sl)\n./defer1.go:25:2: defer discards result of make([]int, 10)\n./defer1.go:26:2: defer discards result of new(*int)\n./defer1.go:30:2: defer discards result of real(a)\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼ŒGoç¼–è¯‘å™¨å±…ç„¶ç»™å‡ºä¸€ç»„é”™è¯¯æç¤ºï¼</p><p>ä»è¿™ç»„é”™è¯¯æç¤ºä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œappendã€capã€lenã€makeã€newã€imagç­‰å†…ç½®å‡½æ•°éƒ½æ˜¯ä¸èƒ½ç›´æ¥ä½œä¸ºdeferredå‡½æ•°çš„ï¼Œè€Œcloseã€copyã€deleteã€printã€recoverç­‰å†…ç½®å‡½æ•°åˆ™å¯ä»¥ç›´æ¥è¢«deferè®¾ç½®ä¸ºdeferredå‡½æ•°ã€‚</p><p>ä¸è¿‡ï¼Œå¯¹äºé‚£äº›ä¸èƒ½ç›´æ¥ä½œä¸ºdeferredå‡½æ•°çš„å†…ç½®å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªåŒ…è£¹å®ƒçš„åŒ¿åå‡½æ•°æ¥é—´æ¥æ»¡è¶³è¦æ±‚ï¼Œä»¥appendä¸ºä¾‹æ˜¯è¿™æ ·çš„ï¼š</p><pre><code class=\"language-plain\">defer func() {\n\t_ = append(sl, 11)\n}()\n</code></pre><h3>ç¬¬äºŒç‚¹ï¼šæ³¨æ„deferå…³é”®å­—åé¢è¡¨è¾¾å¼çš„æ±‚å€¼æ—¶æœº</h3><p>è¿™é‡Œï¼Œä½ ä¸€å®šè¦ç‰¢è®°ä¸€ç‚¹ï¼š<strong>deferå…³é”®å­—åé¢çš„è¡¨è¾¾å¼ï¼Œæ˜¯åœ¨å°†deferredå‡½æ•°æ³¨å†Œåˆ°deferredå‡½æ•°æ ˆçš„æ—¶å€™è¿›è¡Œæ±‚å€¼çš„</strong>ã€‚</p><p>æˆ‘ä»¬åŒæ ·ç”¨ä¸€ä¸ªå…¸å‹çš„ä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹deferåè¡¨è¾¾å¼çš„æ±‚å€¼æ—¶æœºï¼š</p><pre><code class=\"language-plain\">func foo1() {\n    for i := 0; i &lt;= 3; i++ {\n        defer fmt.Println(i)\n    }\n}\n\nfunc foo2() {\n    for i := 0; i &lt;= 3; i++ {\n        defer func(n int) {\n            fmt.Println(n)\n        }(i)\n    }\n}\n\nfunc foo3() {\n    for i := 0; i &lt;= 3; i++ {\n        defer func() {\n            fmt.Println(i)\n        }()\n    }\n}\n\nfunc main() {\n    fmt.Println(\"foo1 result:\")\n    foo1()\n    fmt.Println(\"\\nfoo2 result:\")\n    foo2()\n    fmt.Println(\"\\nfoo3 result:\")\n    foo3()\n}\n</code></pre><p>è¿™é‡Œï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸ªåˆ†æfoo1ã€foo2å’Œfoo3ä¸­deferåçš„è¡¨è¾¾å¼çš„æ±‚å€¼æ—¶æœºã€‚</p><p>é¦–å…ˆæ˜¯foo1ã€‚foo1ä¸­deferåé¢ç›´æ¥ç”¨çš„æ˜¯fmt.Printlnå‡½æ•°ï¼Œæ¯å½“deferå°†fmt.Printlnæ³¨å†Œåˆ°deferredå‡½æ•°æ ˆçš„æ—¶å€™ï¼Œéƒ½ä¼šå¯¹Printlnåé¢çš„å‚æ•°è¿›è¡Œæ±‚å€¼ã€‚æ ¹æ®ä¸Šè¿°ä»£ç é€»è¾‘ï¼Œä¾æ¬¡å‹å…¥deferredå‡½æ•°æ ˆçš„å‡½æ•°æ˜¯ï¼š</p><pre><code class=\"language-plain\">fmt.Println(0)\nfmt.Println(1)\nfmt.Println(2)\nfmt.Println(3)\n</code></pre><p>å› æ­¤ï¼Œå½“foo1è¿”å›åï¼Œdeferredå‡½æ•°è¢«è°ƒåº¦æ‰§è¡Œæ—¶ï¼Œä¸Šè¿°å‹å…¥æ ˆçš„deferredå‡½æ•°å°†ä»¥LIFOæ¬¡åºå‡ºæ ˆæ‰§è¡Œï¼Œè¿™æ—¶çš„è¾“å‡ºçš„ç»“æœä¸ºï¼š</p><pre><code class=\"language-plain\">3\n2\n1\n0\n</code></pre><p>ç„¶åæˆ‘ä»¬å†çœ‹foo2ã€‚foo2ä¸­deferåé¢æ¥çš„æ˜¯ä¸€ä¸ªå¸¦æœ‰ä¸€ä¸ªå‚æ•°çš„åŒ¿åå‡½æ•°ã€‚æ¯å½“deferå°†åŒ¿åå‡½æ•°æ³¨å†Œåˆ°deferredå‡½æ•°æ ˆçš„æ—¶å€™ï¼Œéƒ½ä¼šå¯¹è¯¥åŒ¿åå‡½æ•°çš„å‚æ•°è¿›è¡Œæ±‚å€¼ã€‚æ ¹æ®ä¸Šè¿°ä»£ç é€»è¾‘ï¼Œä¾æ¬¡å‹å…¥deferredå‡½æ•°æ ˆçš„å‡½æ•°æ˜¯ï¼š</p><pre><code class=\"language-plain\">func(0)\nfunc(1)\nfunc(2)\nfunc(3)\n</code></pre><p>å› æ­¤ï¼Œå½“foo2è¿”å›åï¼Œdeferredå‡½æ•°è¢«è°ƒåº¦æ‰§è¡Œæ—¶ï¼Œä¸Šè¿°å‹å…¥æ ˆçš„deferredå‡½æ•°å°†ä»¥LIFOæ¬¡åºå‡ºæ ˆæ‰§è¡Œï¼Œå› æ­¤è¾“å‡ºçš„ç»“æœä¸ºï¼š</p><pre><code class=\"language-plain\">3\n2\n1\n0\n</code></pre><p>æœ€åæˆ‘ä»¬æ¥çœ‹foo3ã€‚foo3ä¸­deferåé¢æ¥çš„æ˜¯ä¸€ä¸ªä¸å¸¦å‚æ•°çš„åŒ¿åå‡½æ•°ã€‚æ ¹æ®ä¸Šè¿°ä»£ç é€»è¾‘ï¼Œä¾æ¬¡å‹å…¥deferredå‡½æ•°æ ˆçš„å‡½æ•°æ˜¯ï¼š</p><pre><code class=\"language-plain\">func()\nfunc()\nfunc()\nfunc()\n</code></pre><p>æ‰€ä»¥ï¼Œå½“foo3è¿”å›åï¼Œdeferredå‡½æ•°è¢«è°ƒåº¦æ‰§è¡Œæ—¶ï¼Œä¸Šè¿°å‹å…¥æ ˆçš„deferredå‡½æ•°å°†ä»¥LIFOæ¬¡åºå‡ºæ ˆæ‰§è¡Œã€‚åŒ¿åå‡½æ•°ä¼šä»¥é—­åŒ…çš„æ–¹å¼è®¿é—®å¤–å›´å‡½æ•°çš„å˜é‡iï¼Œå¹¶é€šè¿‡Printlnè¾“å‡ºiçš„å€¼ï¼Œæ­¤æ—¶içš„å€¼ä¸º4ï¼Œå› æ­¤foo3çš„è¾“å‡ºç»“æœä¸ºï¼š</p><pre><code class=\"language-plain\">4\n4\n4\n4\n</code></pre><p>é€šè¿‡è¿™äº›ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ— è®ºä»¥ä½•ç§å½¢å¼å°†å‡½æ•°æ³¨å†Œåˆ°deferä¸­ï¼Œdeferredå‡½æ•°çš„å‚æ•°å€¼éƒ½æ˜¯åœ¨æ³¨å†Œçš„æ—¶å€™è¿›è¡Œæ±‚å€¼çš„ã€‚</p><h3>ç¬¬ä¸‰ç‚¹ï¼šçŸ¥æ™“deferå¸¦æ¥çš„æ€§èƒ½æŸè€—</h3><p>é€šè¿‡å‰é¢çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œdeferè®©æˆ‘ä»¬è¿›è¡Œèµ„æºé‡Šæ”¾ï¼ˆå¦‚æ–‡ä»¶æè¿°ç¬¦ã€é”ï¼‰çš„è¿‡ç¨‹å˜å¾—ä¼˜é›…å¾ˆå¤šï¼Œä¹Ÿä¸æ˜“å‡ºé”™ã€‚ä½†åœ¨æ€§èƒ½æ•æ„Ÿçš„åº”ç”¨ä¸­ï¼Œdeferå¸¦æ¥çš„æ€§èƒ½è´Ÿæ‹…ä¹Ÿæ˜¯æˆ‘ä»¬å¿…é¡»è¦çŸ¥æ™“å’Œæƒè¡¡çš„é—®é¢˜ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªæ€§èƒ½åŸºå‡†æµ‹è¯•ï¼ˆBenchmarkï¼‰ï¼Œç›´è§‚åœ°çœ‹çœ‹deferç©¶ç«Ÿä¼šå¸¦æ¥å¤šå°‘æ€§èƒ½æŸè€—ã€‚åŸºäºGoå·¥å…·é“¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä¸ºGoæºç å†™ä¸€ä¸ªæ€§èƒ½åŸºå‡†æµ‹è¯•ï¼Œåªéœ€å°†ä»£ç æ”¾åœ¨ä»¥â€œ_test.goâ€ä¸ºåç¼€çš„æºæ–‡ä»¶ä¸­ï¼Œç„¶ååˆ©ç”¨testingåŒ…æä¾›çš„â€œæ¡†æ¶â€å°±å¯ä»¥äº†ï¼Œæˆ‘ä»¬çœ‹ä¸‹é¢ä»£ç ï¼š</p><pre><code class=\"language-plain\">// defer_test.go\npackage main\n  \nimport \"testing\"\n\nfunc sum(max int) int {\n    total := 0\n    for i := 0; i &lt; max; i++ {\n        total += i\n    }\n\n    return total\n}\n\nfunc fooWithDefer() {\n    defer func() {\n        sum(10)\n    }()\n}\nfunc fooWithoutDefer() {\n    sum(10)\n}\n\nfunc BenchmarkFooWithDefer(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        fooWithDefer()\n    }\n}\nfunc BenchmarkFooWithoutDefer(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        fooWithoutDefer()\n    }\n}\n</code></pre><p>è¿™ä¸ªåŸºå‡†æµ‹è¯•åŒ…å«äº†ä¸¤ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œåˆ†åˆ«æ˜¯BenchmarkFooWithDeferå’ŒBenchmarkFooWithoutDeferã€‚å‰è€…æµ‹é‡çš„æ˜¯å¸¦æœ‰deferçš„å‡½æ•°æ‰§è¡Œçš„æ€§èƒ½ï¼Œåè€…æµ‹é‡çš„æ˜¯ä¸å¸¦æœ‰deferçš„å‡½æ•°çš„æ‰§è¡Œçš„æ€§èƒ½ã€‚</p><p>åœ¨Go 1.13å‰çš„ç‰ˆæœ¬ä¸­ï¼Œdeferå¸¦æ¥çš„å¼€é”€è¿˜æ˜¯å¾ˆå¤§çš„ã€‚æˆ‘ä»¬å…ˆç”¨Go 1.12.7ç‰ˆæœ¬æ¥è¿è¡Œä¸€ä¸‹ä¸Šè¿°åŸºå‡†æµ‹è¯•ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p><pre><code class=\"language-plain\">$go test -bench . defer_test.go\ngoos: darwin\ngoarch: amd64\nBenchmarkFooWithDefer-8      \t30000000\t        42.6 ns/op\nBenchmarkFooWithoutDefer-8   \t300000000\t         5.44 ns/op\nPASS\nok  \tcommand-line-arguments\t3.511s\n</code></pre><p>ä»è¿™ä¸ªåŸºå‡†æµ‹è¯•ç»“æœä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°ï¼š<strong>ä½¿ç”¨deferçš„å‡½æ•°çš„æ‰§è¡Œæ—¶é—´æ˜¯æ²¡æœ‰ä½¿ç”¨deferå‡½æ•°çš„8å€å·¦å³</strong>ã€‚</p><p>ä½†ä»Go 1.13ç‰ˆæœ¬å¼€å§‹ï¼ŒGoæ ¸å¿ƒå›¢é˜Ÿå¯¹deferæ€§èƒ½è¿›è¡Œäº†å¤šæ¬¡ä¼˜åŒ–ï¼Œåˆ°ç°åœ¨çš„Go 1.17ç‰ˆæœ¬ï¼Œdeferçš„å¼€é”€å·²ç»è¶³å¤Ÿå°äº†ã€‚æˆ‘ä»¬çœ‹çœ‹ä½¿ç”¨Go 1.17ç‰ˆæœ¬è¿è¡Œä¸Šè¿°åŸºå‡†æµ‹è¯•çš„ç»“æœï¼š</p><pre><code class=\"language-plain\">$go test -bench . defer_test.go\ngoos: darwin\ngoarch: amd64\nBenchmarkFooWithDefer-8      \t194593353\t         6.183 ns/op\nBenchmarkFooWithoutDefer-8   \t284272650\t         4.259 ns/op\nPASS\nok  \tcommand-line-arguments\t3.472s\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œå¸¦æœ‰deferçš„å‡½æ•°æ‰§è¡Œå¼€é”€ï¼Œä»…æ˜¯ä¸å¸¦æœ‰deferçš„å‡½æ•°çš„æ‰§è¡Œå¼€é”€çš„1.45å€å·¦å³ï¼Œå·²ç»è¾¾åˆ°äº†å‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®¡çš„ç¨‹åº¦ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾å¿ƒä½¿ç”¨ã€‚</p><h2>å°ç»“</h2><p>å¥½äº†ï¼Œä»Šå¤©çš„è¯¾è®²åˆ°è¿™é‡Œå°±ç»“æŸäº†ã€‚åœ¨è¿™ä¸€è®²ä¸­ï¼Œæˆ‘ä»¬å»¶ç»­ä¸Šä¸€èŠ‚çš„è„‰ç»œï¼Œè®²è§£äº†å‡½æ•°è®¾è®¡è¿‡ç¨‹ä¸­åº”è¯¥è€ƒè™‘çš„ã€å¥å£®æ€§ä¸ç®€æ´æ€§æ–¹é¢çš„å†…å®¹ã€‚</p><p>åœ¨å‡½æ•°å¥å£®æ€§æ–¹é¢ï¼Œæˆ‘ç»™å‡ºäº†â€œä¸‰ä¸è¦â€åŸåˆ™ï¼Œè¿™ä¸‰ä¸ªåŸåˆ™ä½ ä¸€å®šè¦è®°ä½ã€‚è¿™é‡Œæˆ‘ä»¬é‡ç‚¹è®²è§£äº†ç¬¬ä¸‰ä¸ªåŸåˆ™ï¼š<strong>ä¸è¦å‡å®šå¼‚å¸¸ä¸ä¼šå‘ç”Ÿ</strong>ã€‚å€Ÿæ­¤ï¼Œæˆ‘ä»¬è®¤è¯†äº†Goè¯­è¨€ä¸­è¡¨ç¤ºå¼‚å¸¸çš„panicï¼Œä¹Ÿå­¦ä¹ äº†panicå‘ç”Ÿåçš„ä»£ç æ‰§è¡Œæµç¨‹ã€‚åŸºäºpanicçš„è¡Œä¸ºç‰¹å¾ï¼Œæˆ‘ä»¬ç»™å‡ºäº†Goå‡½æ•°è®¾è®¡è¿‡ç¨‹ä¸­åº”å¯¹panicçš„ä¸‰ç‚¹ç»éªŒï¼Œè¿™é‡Œä½ è¦æ³¨æ„ï¼Œâ€œè¯„ä¼°ç¨‹åºå¯¹panicçš„å¿å—åº¦â€æ˜¯æˆ‘ä»¬é€‰å–åº”å¯¹panicæªæ–½çš„å‰æã€‚</p><p>å¦å¤–ï¼Œå¯¹äºæ¥è‡ªåƒJavaè¿™æ ·çš„ã€åŸºäºExceptionè¿›è¡Œé”™è¯¯å¤„ç†çš„ç¼–ç¨‹è¯­è¨€çš„Goåˆå­¦è€…ä»¬ï¼Œåˆ‡è®°ä¸è¦å°†panicä¸é”™è¯¯å¤„ç†æ··æ·†ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆè®²è§£äº†å¦‚ä½•è®©å‡½æ•°å®ç°æ›´åŠ ç®€æ´ã€‚ç®€æ´æ€§å¯¹äºå‡½æ•°æ¥è¯´æ„å‘³ç€å¯è¯»æ€§æ›´å¥½ï¼Œæ›´æ˜“äºç†è§£ï¼Œä¹Ÿæœ‰åˆ©äºæˆ‘ä»¬ä»£ç å¥å£®æ€§çš„æå‡ã€‚Goè¯­è¨€å±‚é¢æä¾›çš„deferæœºåˆ¶å¯ç”¨äºç®€åŒ–å‡½æ•°å®ç°ï¼Œå°¤å…¶æ˜¯åœ¨å‡½æ•°ç”³è¯·å’Œé‡Šæ”¾èµ„æºä¸ªæ•°è¾ƒå¤šçš„æƒ…å†µä¸‹ã€‚</p><p>å¦‚æœæˆ‘ä»¬è¦ç”¨å¥½deferï¼Œå‰æå°±æ˜¯è¦äº†è§£deferçš„è¿ä½œæœºåˆ¶ï¼Œè¿™é‡Œä½ è¦æŠŠæ¡ä½ä¸¤ç‚¹ï¼š</p><ul>\n<li>å‡½æ•°è¿”å›å‰ï¼Œdeferredå‡½æ•°æ˜¯æŒ‰ç…§åå…¥å…ˆå‡ºï¼ˆLIFOï¼‰çš„é¡ºåºæ‰§è¡Œçš„ï¼›</li>\n<li>deferå…³é”®å­—æ˜¯åœ¨æ³¨å†Œå‡½æ•°æ—¶å¯¹å‡½æ•°çš„å‚æ•°è¿›è¡Œæ±‚å€¼çš„ã€‚</li>\n</ul><p>æœ€åï¼Œåœ¨æœ€æ–°Goç‰ˆæœ¬Go1.17ä¸­ï¼Œä½¿ç”¨deferå¸¦æ¥çš„å¼€é”€å‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®¡äº†ï¼Œä½ å¯ä»¥æ”¾å¿ƒä½¿ç”¨ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>deferæ˜¯Gopherä»¬éƒ½å–œæ¬¢çš„è¯­è¨€æœºåˆ¶ï¼Œé‚£ä¹ˆæˆ‘æƒ³è¯·ä½ æ€è€ƒä¸€ä¸‹ï¼Œé™¤äº†æ•æ‰panicã€å»¶è¿Ÿé‡Šæ”¾èµ„æºå¤–ï¼Œæˆ‘ä»¬æ—¥å¸¸ç¼–ç ä¸­è¿˜æœ‰å“ªäº›ä½¿ç”¨deferçš„å°æŠ€å·§å‘¢ï¼Ÿä¸€ä¸ªå°æç¤ºï¼šä½ å¯ä»¥é˜…è¯»ä¸€ä¸‹Goæ ‡å‡†åº“ä¸­å…³äºdeferçš„ä½¿ç”¨æ–¹æ³•ï¼Œçœ‹çœ‹æ˜¯å¦èƒ½æ€»ç»“å‡ºä¸€äº›å°tipsã€‚</p><p>æ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™æ›´å¤šå¯¹Goè¯­è¨€å‡½æ•°æ„Ÿå…´è¶£çš„æœ‹å‹ã€‚æˆ‘æ˜¯Tony Baiï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ã€‚</p>","comments":[{"had_liked":false,"id":325071,"user_name":"è¿›åŒ–èŒ","can_delete":false,"product_type":"c1","uid":1276861,"ip_address":"","ucode":"B30A5F78BB4171","user_header":"https://static001.geekbang.org/account/avatar/00/13/7b/bd/ccb37425.jpg","comment_is_top":false,"comment_ctime":1638797063,"is_pvip":true,"replies":[{"id":117956,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1638827663,"ip_address":"","comment_id":325071,"utype":1}],"discussion_count":2,"race_medal":4,"score":2,"product_id":100093501,"comment_content":"panic ææ…Œï¼Œæ…Œæ…Œå¼ å¼ çš„æŠ›å‡ºå¼‚å¸¸ï¼›recover æ¢å¤ï¼Œæ·¡å®šè¿˜æœ‰äº‹æƒ…è¦åšï¼Œå…ˆåˆ«é€€å‡ºï¼›defer å»¶è¿Ÿï¼Œæ™šç‚¹è¦åšçš„äº‹æƒ…ä¸èƒ½å¿˜â€¦â€¦","like_count":23},{"had_liked":false,"id":325107,"user_name":"helloxiaomin","can_delete":false,"product_type":"c1","uid":1187293,"ip_address":"","ucode":"607CAEA41B8B9A","user_header":"https://static001.geekbang.org/account/avatar/00/12/1d/dd/95cdb4d8.jpg","comment_is_top":false,"comment_ctime":1638829062,"is_pvip":false,"replies":[{"id":118584,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1639558106,"ip_address":"","comment_id":325107,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"deferçš„ä½¿ç”¨æŠ€å·§ï¼š1ï¼‰deferè¦åœ¨panicä¹‹å‰ï¼Œæ‰èƒ½æ‰§è¡Œï¼›2ï¼‰deferå†…éƒ¨çš„recoveråªèƒ½æ•è·å½“å‰åç¨‹çš„Panicï¼Œä¸èƒ½è·¨åç¨‹æ‰§è¡Œï¼›3ï¼‰recoveråªèƒ½åœ¨deferä¸­è°ƒç”¨æ‰èƒ½ç”Ÿæ•ˆã€‚æš‚æ—¶æƒ³åˆ°è¿™äº›","like_count":19,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536582,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638827663,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2166073,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","nickname":"æˆ’é…’çš„æç™½","note":"","ucode":"744E1A22761647","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585758,"discussion_content":"è§£é‡Šçš„é€šä¿—æ˜“æ‡‚ï¼Œ ç‚¹èµ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661791006,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324968,"user_name":"return","can_delete":false,"product_type":"c1","uid":1135528,"ip_address":"","ucode":"42B8A3380DF04B","user_header":"https://static001.geekbang.org/account/avatar/00/11/53/a8/abc96f70.jpg","comment_is_top":false,"comment_ctime":1638762006,"is_pvip":false,"replies":[{"id":117952,"content":"å¦‚æœåœ¨å¹³æ—¶panicç”¨çš„ï¼Œé‚£ä¹ˆå°±è¯´æ˜ä½ èµ°åœ¨äº†æ­£ç¡®çš„é“è·¯ä¸Š:)ã€‚panicæœ¬èº«å°±æ˜¯å¼‚å¸¸ï¼Œå¼‚å¸¸æœ¬èº«å°±æ˜¯å¾ˆå°‘å‘ç”Ÿçš„ã€‚ç›®å‰çœ‹panicæœ€å¸¸ä½¿ç”¨çš„å°±æ˜¯å……å½“â€œæ–­è¨€â€ï¼Œæç¤ºæ½œåœ¨bugæ—¶ç”¨çš„æœ€å¤šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1638827555,"ip_address":"","comment_id":324968,"utype":1}],"discussion_count":5,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"è€å¸ˆè®²çš„å¤ªå¥½äº†ï¼Œ\nå†è¯·æ•™ä¸€ä¸‹è€å¸ˆï¼Œ panicåº”è¯¥åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨ï¼Œ\næ„Ÿè§‰å¹³æ—¶ ä¸šåŠ¡ä»£ç  ä½¿ç”¨ errè¶³å¤Ÿï¼Œæ²¡æœ‰ä½¿ç”¨panicçš„åœºæ™¯ï¼Œ\næ–‡ä¸­ä¸¾ä¾‹çš„ http serveræ¯”è¾ƒåˆé€‚ï¼Œ ä½†æ˜¯json encodeï¼Œè™½ç„¶å®˜æ–¹ç”¨äº†panicï¼Œä½†æ˜¯ä¸ªäººæ„Ÿè§‰ ä½¿ç”¨errä¹Ÿæ²¡æ¯›ç—…ï¼Œ ä¼ å…¥çš„ jsonä¸² æœ‰é—®é¢˜å˜›ï¼Œå°±æ˜¯ å…¥å‚æ ¡éªŒerrå‘—ã€‚ \næ‰€ä»¥ get ä¸åˆ° ä»€ä¹ˆæƒ…å†µä¸‹ç”¨ panicã€‚","like_count":15,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538925,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639558106,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324994,"user_name":"liaomars","can_delete":false,"product_type":"c1","uid":2104856,"ip_address":"","ucode":"4FCA97EE9FB57D","user_header":"https://static001.geekbang.org/account/avatar/00/20/1e/18/9d1f1439.jpg","comment_is_top":false,"comment_ctime":1638774414,"is_pvip":false,"replies":[{"id":117951,"content":"å¯ä»¥çš„ã€‚åœ¨åé¢çš„ä¸€ä¸ªå®æˆ˜é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°±ä¼šåº”ç”¨åˆ°è¿™ä¸€ç‚¹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1638827327,"ip_address":"","comment_id":324994,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"çœ‹äº†å®˜æ–¹æ ‡å‡†åº“çš„deferè¯´æ˜ï¼Œå‘ç°ä¸€ä¸ªtipsæ˜¯ï¼šå¯ä»¥è·Ÿè¸ªå‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹","like_count":11,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536577,"discussion_content":"å¯ä»¥çš„ã€‚åœ¨åé¢çš„ä¸€ä¸ªå®æˆ˜é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°±ä¼šåº”ç”¨åˆ°è¿™ä¸€ç‚¹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638827327,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1025239,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a4/d7/5d2bfaa7.jpg","nickname":"Aliliin","note":"","ucode":"61F9A09BB6650F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546689,"discussion_content":"deferï¼š è€å­å°±è¦çœ‹çœ‹æ˜¯è°å‡ºçš„é”™ã€‚ğŸ˜‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642392714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1363671,"avatar":"https://static001.geekbang.org/account/avatar/00/14/ce/d7/5315f6ce.jpg","nickname":"ä¸è´Ÿé’æ˜¥ä¸è´Ÿå·±ğŸ¤˜","note":"","ucode":"A6DD8E8B20EA6E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536932,"discussion_content":"ç±»ä¼¼äº log æ—¥å¿—ï¼šï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638893674,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":325151,"user_name":"å¥•","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1638843979,"is_pvip":false,"replies":[{"id":118585,"content":"è¿™æ˜¯ä¸€ç§é€šè¿‡æ•°ç»„ä¸‹æ ‡æ–¹å¼å¯¹æ•°ç»„è¿›è¡Œåˆå§‹åŒ–çš„æ–¹å¼ã€‚æˆ‘è®°å¾—æˆ‘åœ¨ç¬¬15è®²ä¸­æåˆ°è¿‡å§ã€‚è¿™é‡Œæ•°ç»„å­—é¢å€¼ä¸­æœ€å¤§çš„ä¸‹æ ‡å€¼ä¸º3ï¼Œgoç¼–è¯‘å™¨å°±è®¤ä¸ºæ•°ç»„é•¿åº¦æ˜¯4.ï¼ˆä¸‹æ ‡å€¼èŒƒå›´0~3ï¼‰","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1639558205,"ip_address":"","comment_id":325151,"utype":1}],"discussion_count":6,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"è¯·æ•™ä¸€ä¸ªéè¯¾ç¨‹çš„é—®é¢˜ï¼š\nv := [...]int{1: 2, 3: 4}\nfmt.Println(len(v)) \n\nè¿™é‡Œä¸ºä»€ä¹ˆæ‰“å°å‡ºæ¥çš„ é•¿åº¦æ˜¯ 4å‘¢ï¼Ÿ","like_count":8,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538926,"discussion_content":"è¿™æ˜¯ä¸€ç§é€šè¿‡æ•°ç»„ä¸‹æ ‡æ–¹å¼å¯¹æ•°ç»„è¿›è¡Œåˆå§‹åŒ–çš„æ–¹å¼ã€‚æˆ‘è®°å¾—æˆ‘åœ¨ç¬¬15è®²ä¸­æåˆ°è¿‡å§ã€‚è¿™é‡Œæ•°ç»„å­—é¢å€¼ä¸­æœ€å¤§çš„ä¸‹æ ‡å€¼ä¸º3ï¼Œgoç¼–è¯‘å™¨å°±è®¤ä¸ºæ•°ç»„é•¿åº¦æ˜¯4.ï¼ˆä¸‹æ ‡å€¼èŒƒå›´0~3ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639558205,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1667175,"avatar":"https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg","nickname":"qinsi","note":"","ucode":"090D9C4068FF12","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537654,"discussion_content":"ä¸‰ä¸ªç‚¹&#34;...&#34;è¡¨ç¤ºlenåœ¨æœ€å¤§çš„ä¸‹æ ‡åé¢ï¼Œæœ€å¤§çš„ä¸‹æ ‡æ˜¯3ï¼Œæ‰€ä»¥lenå°±æ˜¯4","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1639129698,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"å¥•","note":"","ucode":"73CEA468CE70C3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1667175,"avatar":"https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg","nickname":"qinsi","note":"","ucode":"090D9C4068FF12","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":537680,"discussion_content":"â€¦æ˜¯è‡ªåŠ¨æ¨æ–­æ•°ç»„çš„é•¿åº¦ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆé•¿åº¦æ˜¯4çš„ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639141838,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":537654,"ip_address":"","group_id":0},"score":537680,"extra":""},{"author":{"id":1667175,"avatar":"https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg","nickname":"qinsi","note":"","ucode":"090D9C4068FF12","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"å¥•","note":"","ucode":"73CEA468CE70C3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537814,"discussion_content":"ç¨€ç–æ•°ç»„çš„åˆå§‹åŒ–ï¼Œå‰é¢ç¬¬15è¯¾æœ‰è®²çš„","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1639205542,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":537680,"ip_address":"","group_id":0},"score":537814,"extra":""},{"author":{"id":2885586,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/07/d2/1bdf9d33.jpg","nickname":"å‹¤å­¦å¦‚æ˜¥èµ·ä¹‹è‹—,ä¸è§å…¶å¢,æ—¥æœ‰æ‰€é•¿","note":"","ucode":"E8E885754513BE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"å¥•","note":"","ucode":"73CEA468CE70C3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585238,"discussion_content":"åº”è¯¥æ˜¯ï¼ŒæŠŠ4èµ‹å€¼ç»™æ•°ç»„ä¸‹æ ‡ä¸º3çš„å…ƒç´ ï¼Œå°±æ˜¯ç¬¬4ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥é•¿åº¦æ˜¯4ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661413267,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":537680,"ip_address":"ä¸Šæµ·","group_id":0},"score":585238,"extra":""}]}]},{"had_liked":false,"id":325234,"user_name":"lesserror","can_delete":false,"product_type":"c1","uid":1351076,"ip_address":"","ucode":"25A54D1165FCF6","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","comment_is_top":false,"comment_ctime":1638872654,"is_pvip":false,"replies":[{"id":118592,"content":"deferæ˜¯åœ¨å‡½æ•°é€€å‡ºæ—¶è°ƒç”¨çš„ã€‚å¦‚æœåœ¨forè¯­å¥çš„æ¯ä¸ªè¿­ä»£éƒ½ä½¿ç”¨deferè®¾ç½®deferredå‡½æ•°ï¼Œè¿™äº›deferredå‡½æ•°ä¼šå‹å…¥runtimeå®ç°çš„deferåˆ—è¡¨ä¸­ã€‚ä¼šå ç”¨å†…å­˜èµ„æºï¼Œå¹¶ä¸”å¦‚æœforçš„loopæ¬¡æ•°å¾ˆå¤šï¼Œè¿™ä¸ªæ¶ˆè€—å°†å¾ˆå¯è§‚ã€‚æ–‡ä¸­åœ¨forä¸­ä½¿ç”¨deferä»…æ˜¯ä¸ºäº†ä¸¾ä¾‹è€Œå·²ã€‚ç”Ÿäº§ä»£ç è¿™å—çš„ç¡®è¦è°¨æ…ï¼Œé€šå¸¸æ˜¯æ²¡æœ‰å¿…è¦è¿™ä¹ˆåšçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1639560668,"ip_address":"","comment_id":325234,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"æ„Ÿè°¢ Tony Bai è€å¸ˆå…³äºdeferçš„æ·±å…¥è®²è§£ï¼Œä¸è¿‡æˆ‘æƒ³é—®ä¸€ä¸‹ï¼Œåœ¨forä¸­ä½¿ç”¨deferå‡½æ•°ï¼Œç¼–è¾‘å™¨ä¼šæç¤ºå¯èƒ½é€ æˆèµ„æºæ³„éœ²ï¼Œèƒ½å¤§è‡´è¯´æ˜ä¸€ä¸‹è¿™å—å„¿çš„çŸ¥è¯†å—ï¼Ÿ","like_count":6,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538941,"discussion_content":"deferæ˜¯åœ¨å‡½æ•°é€€å‡ºæ—¶è°ƒç”¨çš„ã€‚å¦‚æœåœ¨forè¯­å¥çš„æ¯ä¸ªè¿­ä»£éƒ½ä½¿ç”¨deferè®¾ç½®deferredå‡½æ•°ï¼Œè¿™äº›deferredå‡½æ•°ä¼šå‹å…¥runtimeå®ç°çš„deferåˆ—è¡¨ä¸­ã€‚ä¼šå ç”¨å†…å­˜èµ„æºï¼Œå¹¶ä¸”å¦‚æœforçš„loopæ¬¡æ•°å¾ˆå¤šï¼Œè¿™ä¸ªæ¶ˆè€—å°†å¾ˆå¯è§‚ã€‚æ–‡ä¸­åœ¨forä¸­ä½¿ç”¨deferä»…æ˜¯ä¸ºäº†ä¸¾ä¾‹è€Œå·²ã€‚ç”Ÿäº§ä»£ç è¿™å—çš„ç¡®è¦è°¨æ…ï¼Œé€šå¸¸æ˜¯æ²¡æœ‰å¿…è¦è¿™ä¹ˆåšçš„ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1639560668,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1351076,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","nickname":"lesserror","note":"","ucode":"25A54D1165FCF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":539481,"discussion_content":"è°¢è°¢è€å¸ˆçš„å›ç­”ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639727479,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":538941,"ip_address":"","group_id":0},"score":539481,"extra":""}]}]},{"had_liked":false,"id":343987,"user_name":"van","can_delete":false,"product_type":"c1","uid":1766293,"ip_address":"","ucode":"26FAFF7224F12D","user_header":"https://static001.geekbang.org/account/avatar/00/1a/f3/95/77628ed0.jpg","comment_is_top":false,"comment_ctime":1651156808,"is_pvip":true,"replies":[{"id":125653,"content":"æŠŠpanicå½“åšæ–­è¨€ä½¿ç”¨çš„ç›®çš„æ˜¯åŠæ—©å‘ç°bugï¼Œä¸€æ—¦æ–­è¨€å‘ç”Ÿï¼Œæ„å‘³ç€æ•´ä¸ªç¨‹åºå‡ºç°äº†ä¸å¯æ¢å¤çš„çŠ¶æ€ã€‚å¯¹äºè¿™ç±»panicï¼Œä¸è¦recoverã€‚å°½æ—©å¤±è´¥å¹¶è§£å†³bugã€‚æ‰€ä»¥åœ¨ä»€ä¹ˆä½ç½®è¿›è¡Œæ–­è¨€ï¼Œå¯¹å“ªäº›æ¡ä»¶è¿›è¡Œæ–­è¨€æ˜¯éœ€è¦è€ƒé‡çš„ã€‚åœ¨Cè¯­è¨€ä¸­ä½¿ç”¨assertä¹Ÿæ˜¯åŒæ ·çš„é“ç†ã€‚ä¸€æ—¦assertå¤±è´¥ï¼Œä¾¿ä¼šdump coreæ–‡ä»¶ã€‚ç¨‹åºç»ˆæ­¢ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1651270636,"ip_address":"","comment_id":343987,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"panicä½œä¸ºæ–­è¨€ä½¿ç”¨ï¼Œä¸Šä¸€å±‚çš„è°ƒç”¨è€…è¿˜æ˜¯éœ€è¦è‡ªå·±recoverå›æ¥å§ï¼Œä¸ç„¶è¿™ä¸ªè°ƒç”¨é“¾ä¼šæœ€ç»ˆä¼ åˆ°mainå‡½æ•°","like_count":3,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538941,"discussion_content":"deferæ˜¯åœ¨å‡½æ•°é€€å‡ºæ—¶è°ƒç”¨çš„ã€‚å¦‚æœåœ¨forè¯­å¥çš„æ¯ä¸ªè¿­ä»£éƒ½ä½¿ç”¨deferè®¾ç½®deferredå‡½æ•°ï¼Œè¿™äº›deferredå‡½æ•°ä¼šå‹å…¥runtimeå®ç°çš„deferåˆ—è¡¨ä¸­ã€‚ä¼šå ç”¨å†…å­˜èµ„æºï¼Œå¹¶ä¸”å¦‚æœforçš„loopæ¬¡æ•°å¾ˆå¤šï¼Œè¿™ä¸ªæ¶ˆè€—å°†å¾ˆå¯è§‚ã€‚æ–‡ä¸­åœ¨forä¸­ä½¿ç”¨deferä»…æ˜¯ä¸ºäº†ä¸¾ä¾‹è€Œå·²ã€‚ç”Ÿäº§ä»£ç è¿™å—çš„ç¡®è¦è°¨æ…ï¼Œé€šå¸¸æ˜¯æ²¡æœ‰å¿…è¦è¿™ä¹ˆåšçš„ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1639560668,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1351076,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","nickname":"lesserror","note":"","ucode":"25A54D1165FCF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":539481,"discussion_content":"è°¢è°¢è€å¸ˆçš„å›ç­”ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639727479,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":538941,"ip_address":"","group_id":0},"score":539481,"extra":""}]}]},{"had_liked":false,"id":329678,"user_name":"ã‚éª‘ç€å°è½¦å»å…œé£ã€‚","can_delete":false,"product_type":"c1","uid":2600957,"ip_address":"","ucode":"35F9E5360DF42C","user_header":"https://static001.geekbang.org/account/avatar/00/27/af/fd/a1708649.jpg","comment_is_top":false,"comment_ctime":1641466575,"is_pvip":false,"replies":[{"id":120477,"content":"å¾ªç¯ç»“æŸåï¼Œiçš„å€¼ä¸º4. deferè¾“å‡ºçš„æ˜¯içš„å€¼ï¼Œäºæ˜¯å°±éƒ½æ˜¯4.","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1642040805,"ip_address":"","comment_id":329678,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæ²¡å¤ªæ˜ç™½é—­åŒ…çš„åŸç†ï¼Œæƒ³ä¸æ˜ç™½ä¸ºä»€ä¹ˆè¾“å‡ºçš„æ˜¯4ï¼Œè¯·å¸®å¿™è§£ç­”ä¸‹","like_count":3,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":568934,"discussion_content":"æŠŠpanicå½“åšæ–­è¨€ä½¿ç”¨çš„ç›®çš„æ˜¯åŠæ—©å‘ç°bugï¼Œä¸€æ—¦æ–­è¨€å‘ç”Ÿï¼Œæ„å‘³ç€æ•´ä¸ªç¨‹åºå‡ºç°äº†ä¸å¯æ¢å¤çš„çŠ¶æ€ã€‚å¯¹äºè¿™ç±»panicï¼Œä¸è¦recoverã€‚å°½æ—©å¤±è´¥å¹¶è§£å†³bugã€‚æ‰€ä»¥åœ¨ä»€ä¹ˆä½ç½®è¿›è¡Œæ–­è¨€ï¼Œå¯¹å“ªäº›æ¡ä»¶è¿›è¡Œæ–­è¨€æ˜¯éœ€è¦è€ƒé‡çš„ã€‚åœ¨Cè¯­è¨€ä¸­ä½¿ç”¨assertä¹Ÿæ˜¯åŒæ ·çš„é“ç†ã€‚ä¸€æ—¦assertå¤±è´¥ï¼Œä¾¿ä¼šdump coreæ–‡ä»¶ã€‚ç¨‹åºç»ˆæ­¢ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1651270636,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":325821,"user_name":"åŠŸå¤«ç†ŠçŒ«","can_delete":false,"product_type":"c1","uid":2732243,"ip_address":"","ucode":"D124F4FA4E816F","user_header":"https://static001.geekbang.org/account/avatar/00/29/b0/d3/200e82ff.jpg","comment_is_top":false,"comment_ctime":1639152392,"is_pvip":false,"replies":[{"id":119090,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1640054649,"ip_address":"","comment_id":325821,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"deferæ•°æ®åº“çš„å¼€å…³ã€‚é”çš„ç”³è¯·é‡Šæ”¾ã€‚TCPçš„è¿æ¥å’Œæ–­å¼€ä¹‹ç±»çš„","like_count":3,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545693,"discussion_content":"å¾ªç¯ç»“æŸåï¼Œiçš„å€¼ä¸º4. deferè¾“å‡ºçš„æ˜¯içš„å€¼ï¼Œäºæ˜¯å°±éƒ½æ˜¯4.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642040805,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":2,"child_discussions":[{"author":{"id":2175841,"avatar":"https://static001.geekbang.org/account/avatar/00/21/33/61/16505a1a.jpg","nickname":"He","note":"","ucode":"7F5FF5BEE48AF1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":579999,"discussion_content":"è€å¸ˆä½ å¥½\nä¸è€ƒè™‘ continueå’Œbreak,for çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸æ˜¯è¿™æ ·çš„\nå‰ç½®æ“ä½œ-&gt;åˆ¤æ–­æ¡ä»¶è¡¨è¾¾å¼-&gt;å¾ªç¯ä½“\nç„¶å\nåç½®æ“ä½œ-&gt;åˆ¤æ–­æ¡ä»¶è¡¨è¾¾å¼å¾ªç¯ä½“\ni=3 çš„æ—¶å€™ï¼Œåç½®æ“ä½œè¿˜æ˜¯æ‰§è¡Œäº†i++ï¼Œåªæ˜¯åˆ¤æ–­æ¡ä»¶æ²¡è¿‡ï¼Œæ‰€ä»¥i=4","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1657794593,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":545693,"ip_address":"","group_id":0},"score":579999,"extra":""},{"author":{"id":1351076,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","nickname":"lesserror","note":"","ucode":"25A54D1165FCF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2175841,"avatar":"https://static001.geekbang.org/account/avatar/00/21/33/61/16505a1a.jpg","nickname":"He","note":"","ucode":"7F5FF5BEE48AF1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":621001,"discussion_content":"æ˜¯è¿™æ ·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1686728311,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":579999,"ip_address":"å¹¿ä¸œ","group_id":0},"score":621001,"extra":""}]},{"author":{"id":1915533,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/3a/8d/f5e7a20d.jpg","nickname":"ä½•ä»¥è§£å¿§","note":"","ucode":"4DFE2BDBAF4919","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":654200,"discussion_content":"iteration å…±äº«ä½œç”¨åŸŸï¼Œè¿™ä¸ªä¾‹å­æ”¾åœ¨åŠæ—¶æ±‚å€¼æœ‰ç‚¹ç»•äººï¼Œåƒæ˜¯æ‰§è¡Œçš„æ—¶å€™å–æœ€æ–°çš„å€¼ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1732164126,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ±Ÿè‹","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324930,"user_name":"å®‹ä¸–æ°","can_delete":false,"product_type":"c1","uid":2068776,"ip_address":"","ucode":"0869FF74808452","user_header":"https://static001.geekbang.org/account/avatar/00/1f/91/28/f2dcbbfe.jpg","comment_is_top":false,"comment_ctime":1638722190,"is_pvip":true,"replies":[{"id":117954,"content":"æ˜¯go runtimeå±‚å®ç°çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1638827605,"ip_address":"","comment_id":324930,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"Deferå‡½æ•°è¢«æ”¾åœ¨ä¸€ä¸ªä¸åŒäºä¸»å‡½æ•°çš„å‡½æ•°æ ˆä¸­å—ï¼Ÿ æ˜¯ç”¨sliceå®ç°çš„å—ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540415,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640054649,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":325071,"user_name":"è¿›åŒ–èŒ","can_delete":false,"product_type":"c1","uid":1276861,"ip_address":"","ucode":"B30A5F78BB4171","user_header":"https://static001.geekbang.org/account/avatar/00/13/7b/bd/ccb37425.jpg","comment_is_top":false,"comment_ctime":1638797063,"is_pvip":true,"replies":[{"id":117956,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1638827663,"ip_address":"","comment_id":325071,"utype":1}],"discussion_count":2,"race_medal":4,"score":2,"product_id":100093501,"comment_content":"panic ææ…Œï¼Œæ…Œæ…Œå¼ å¼ çš„æŠ›å‡ºå¼‚å¸¸ï¼›recover æ¢å¤ï¼Œæ·¡å®šè¿˜æœ‰äº‹æƒ…è¦åšï¼Œå…ˆåˆ«é€€å‡ºï¼›defer å»¶è¿Ÿï¼Œæ™šç‚¹è¦åšçš„äº‹æƒ…ä¸èƒ½å¿˜â€¦â€¦","like_count":23,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536582,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638827663,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2166073,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","nickname":"æˆ’é…’çš„æç™½","note":"","ucode":"744E1A22761647","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585758,"discussion_content":"è§£é‡Šçš„é€šä¿—æ˜“æ‡‚ï¼Œ ç‚¹èµ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661791006,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":325107,"user_name":"helloxiaomin","can_delete":false,"product_type":"c1","uid":1187293,"ip_address":"","ucode":"607CAEA41B8B9A","user_header":"https://static001.geekbang.org/account/avatar/00/12/1d/dd/95cdb4d8.jpg","comment_is_top":false,"comment_ctime":1638829062,"is_pvip":false,"replies":[{"id":118584,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1639558106,"ip_address":"","comment_id":325107,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"deferçš„ä½¿ç”¨æŠ€å·§ï¼š1ï¼‰deferè¦åœ¨panicä¹‹å‰ï¼Œæ‰èƒ½æ‰§è¡Œï¼›2ï¼‰deferå†…éƒ¨çš„recoveråªèƒ½æ•è·å½“å‰åç¨‹çš„Panicï¼Œä¸èƒ½è·¨åç¨‹æ‰§è¡Œï¼›3ï¼‰recoveråªèƒ½åœ¨deferä¸­è°ƒç”¨æ‰èƒ½ç”Ÿæ•ˆã€‚æš‚æ—¶æƒ³åˆ°è¿™äº›","like_count":19,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538925,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639558106,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324968,"user_name":"return","can_delete":false,"product_type":"c1","uid":1135528,"ip_address":"","ucode":"42B8A3380DF04B","user_header":"https://static001.geekbang.org/account/avatar/00/11/53/a8/abc96f70.jpg","comment_is_top":false,"comment_ctime":1638762006,"is_pvip":false,"replies":[{"id":117952,"content":"å¦‚æœåœ¨å¹³æ—¶panicç”¨çš„ï¼Œé‚£ä¹ˆå°±è¯´æ˜ä½ èµ°åœ¨äº†æ­£ç¡®çš„é“è·¯ä¸Š:)ã€‚panicæœ¬èº«å°±æ˜¯å¼‚å¸¸ï¼Œå¼‚å¸¸æœ¬èº«å°±æ˜¯å¾ˆå°‘å‘ç”Ÿçš„ã€‚ç›®å‰çœ‹panicæœ€å¸¸ä½¿ç”¨çš„å°±æ˜¯å……å½“â€œæ–­è¨€â€ï¼Œæç¤ºæ½œåœ¨bugæ—¶ç”¨çš„æœ€å¤šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1638827555,"ip_address":"","comment_id":324968,"utype":1}],"discussion_count":5,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"è€å¸ˆè®²çš„å¤ªå¥½äº†ï¼Œ\nå†è¯·æ•™ä¸€ä¸‹è€å¸ˆï¼Œ panicåº”è¯¥åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨ï¼Œ\næ„Ÿè§‰å¹³æ—¶ ä¸šåŠ¡ä»£ç  ä½¿ç”¨ errè¶³å¤Ÿï¼Œæ²¡æœ‰ä½¿ç”¨panicçš„åœºæ™¯ï¼Œ\næ–‡ä¸­ä¸¾ä¾‹çš„ http serveræ¯”è¾ƒåˆé€‚ï¼Œ ä½†æ˜¯json encodeï¼Œè™½ç„¶å®˜æ–¹ç”¨äº†panicï¼Œä½†æ˜¯ä¸ªäººæ„Ÿè§‰ ä½¿ç”¨errä¹Ÿæ²¡æ¯›ç—…ï¼Œ ä¼ å…¥çš„ jsonä¸² æœ‰é—®é¢˜å˜›ï¼Œå°±æ˜¯ å…¥å‚æ ¡éªŒerrå‘—ã€‚ \næ‰€ä»¥ get ä¸åˆ° ä»€ä¹ˆæƒ…å†µä¸‹ç”¨ panicã€‚","like_count":15,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536578,"discussion_content":"å¦‚æœåœ¨å¹³æ—¶panicç”¨çš„ï¼Œé‚£ä¹ˆå°±è¯´æ˜ä½ èµ°åœ¨äº†æ­£ç¡®çš„é“è·¯ä¸Š:)ã€‚panicæœ¬èº«å°±æ˜¯å¼‚å¸¸ï¼Œå¼‚å¸¸æœ¬èº«å°±æ˜¯å¾ˆå°‘å‘ç”Ÿçš„ã€‚ç›®å‰çœ‹panicæœ€å¸¸ä½¿ç”¨çš„å°±æ˜¯å……å½“â€œæ–­è¨€â€ï¼Œæç¤ºæ½œåœ¨bugæ—¶ç”¨çš„æœ€å¤šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638827555,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":3,"child_discussions":[{"author":{"id":1135528,"avatar":"https://static001.geekbang.org/account/avatar/00/11/53/a8/abc96f70.jpg","nickname":"return","note":"","ucode":"42B8A3380DF04B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":536633,"discussion_content":"æ˜ç™½äº†ï¼Œ æ„Ÿè°¢è€å¸ˆè§£ç­”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638840010,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":536578,"ip_address":"","group_id":0},"score":536633,"extra":""},{"author":{"id":2273620,"avatar":"https://static001.geekbang.org/account/avatar/00/22/b1/54/6d663b95.jpg","nickname":"ç“œç‰›","note":"","ucode":"5EB7D2F4400A70","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":560428,"discussion_content":"æ–‡ç« ä¸­æåˆ°çš„APIä½œè€…å°½é‡ä¸è¦ä½¿ç”¨panicæŠ›å‡ºå¼‚å¸¸ï¼Œä½†æ˜¯æ–‡ç« åˆä¸¾ä¾‹jsonå®˜æ–¹åŒ…ä½¿ç”¨äº†panicï¼Œä¸ºå•¥å®˜æ–¹åŒ…ä½¿ç”¨å°±æ˜¯åˆç†çš„ï¼Ÿå¹¶ä¸”ä½œè€…æ‚¨å¸®ç€ä»–è§£é‡Šä¸ºæ–­è¨€ç”¨æ³•ï¼Œæ„Ÿè§‰ä¸æ˜¯å¾ˆå¥½ç†è§£ä½œè€…æ‚¨æƒ³è¡¨è¾¾ä»€ä¹ˆæ„æ€ï¼Ÿæˆ‘ä»¬æ™®é€šgopherç”¨å’‹å°±ä¸èƒ½ç§°ä¹‹ä¸ºæ–­è¨€äº†ï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1649325803,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":536578,"ip_address":"","group_id":0},"score":560428,"extra":""},{"author":{"id":2869118,"avatar":"","nickname":"Geek_73c432","note":"","ucode":"3E11EB02B14DE0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2273620,"avatar":"https://static001.geekbang.org/account/avatar/00/22/b1/54/6d663b95.jpg","nickname":"ç“œç‰›","note":"","ucode":"5EB7D2F4400A70","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":636667,"discussion_content":"æ–‡ç« çš„è§‚ç‚¹æ˜¯ API ä½œè€…ä¸è¦æŠŠé”™è¯¯å½“ä½œå¼‚å¸¸ï¼Œå³ï¼Œå¦‚æœä½ æƒ³è¿”å›ä¸€ä¸ªé”™è¯¯ç»™è°ƒç”¨æ–¹ï¼Œä¸è¦ä½¿ç”¨ Panic\n\njson åŒ…çš„ panic ç”¨æ³•æ˜¯æœ‰æ„è€Œä¸ºä¹‹çš„ï¼ŒæŒ‡ç¤ºç¨‹åºæ‰§è¡Œäº†ä¸è¯¥æ‰§è¡Œçš„åˆ†æ”¯ï¼Œé€šå¸¸æ„å‘³ç€ BUGã€‚è¿™æ—¶æ•°æ®çŠ¶æ€æ˜¯ä¸ç¬¦åˆé¢„æœŸçš„ï¼Œäºæ˜¯åˆ©ç”¨ panicking æœºåˆ¶é€€å‡º","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1706687448,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":560428,"ip_address":"å¹¿ä¸œ","group_id":0},"score":636667,"extra":""}]},{"author":{"id":1479120,"avatar":"https://static001.geekbang.org/account/avatar/00/16/91/d0/35bc62b1.jpg","nickname":"æ— å’","note":"","ucode":"B9759B5646F3AB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":603098,"discussion_content":"ä¸ªäººä»¥ä¸ºï¼Œjsonçš„è§£æåˆ°ä¸­é€”ï¼Œå‘ç°æ ¼å¼æŸåï¼Œé€šå¸¸æ˜¯æœåŠ¡ç«¯çš„ç¨‹åºé”™è¯¯ï¼Œéå¸¸å°‘è§ï¼Œæ‰€ä»¥æç¤ºå®¢æˆ·ä»£ç panicã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1675940914,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324994,"user_name":"liaomars","can_delete":false,"product_type":"c1","uid":2104856,"ip_address":"","ucode":"4FCA97EE9FB57D","user_header":"https://static001.geekbang.org/account/avatar/00/20/1e/18/9d1f1439.jpg","comment_is_top":false,"comment_ctime":1638774414,"is_pvip":false,"replies":[{"id":117951,"content":"å¯ä»¥çš„ã€‚åœ¨åé¢çš„ä¸€ä¸ªå®æˆ˜é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°±ä¼šåº”ç”¨åˆ°è¿™ä¸€ç‚¹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1638827327,"ip_address":"","comment_id":324994,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"çœ‹äº†å®˜æ–¹æ ‡å‡†åº“çš„deferè¯´æ˜ï¼Œå‘ç°ä¸€ä¸ªtipsæ˜¯ï¼šå¯ä»¥è·Ÿè¸ªå‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹","like_count":11,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536578,"discussion_content":"å¦‚æœåœ¨å¹³æ—¶panicç”¨çš„ï¼Œé‚£ä¹ˆå°±è¯´æ˜ä½ èµ°åœ¨äº†æ­£ç¡®çš„é“è·¯ä¸Š:)ã€‚panicæœ¬èº«å°±æ˜¯å¼‚å¸¸ï¼Œå¼‚å¸¸æœ¬èº«å°±æ˜¯å¾ˆå°‘å‘ç”Ÿçš„ã€‚ç›®å‰çœ‹panicæœ€å¸¸ä½¿ç”¨çš„å°±æ˜¯å……å½“â€œæ–­è¨€â€ï¼Œæç¤ºæ½œåœ¨bugæ—¶ç”¨çš„æœ€å¤šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638827555,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":3,"child_discussions":[{"author":{"id":1135528,"avatar":"https://static001.geekbang.org/account/avatar/00/11/53/a8/abc96f70.jpg","nickname":"return","note":"","ucode":"42B8A3380DF04B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":536633,"discussion_content":"æ˜ç™½äº†ï¼Œ æ„Ÿè°¢è€å¸ˆè§£ç­”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638840010,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":536578,"ip_address":"","group_id":0},"score":536633,"extra":""},{"author":{"id":2273620,"avatar":"https://static001.geekbang.org/account/avatar/00/22/b1/54/6d663b95.jpg","nickname":"ç“œç‰›","note":"","ucode":"5EB7D2F4400A70","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":560428,"discussion_content":"æ–‡ç« ä¸­æåˆ°çš„APIä½œè€…å°½é‡ä¸è¦ä½¿ç”¨panicæŠ›å‡ºå¼‚å¸¸ï¼Œä½†æ˜¯æ–‡ç« åˆä¸¾ä¾‹jsonå®˜æ–¹åŒ…ä½¿ç”¨äº†panicï¼Œä¸ºå•¥å®˜æ–¹åŒ…ä½¿ç”¨å°±æ˜¯åˆç†çš„ï¼Ÿå¹¶ä¸”ä½œè€…æ‚¨å¸®ç€ä»–è§£é‡Šä¸ºæ–­è¨€ç”¨æ³•ï¼Œæ„Ÿè§‰ä¸æ˜¯å¾ˆå¥½ç†è§£ä½œè€…æ‚¨æƒ³è¡¨è¾¾ä»€ä¹ˆæ„æ€ï¼Ÿæˆ‘ä»¬æ™®é€šgopherç”¨å’‹å°±ä¸èƒ½ç§°ä¹‹ä¸ºæ–­è¨€äº†ï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1649325803,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":536578,"ip_address":"","group_id":0},"score":560428,"extra":""},{"author":{"id":2869118,"avatar":"","nickname":"Geek_73c432","note":"","ucode":"3E11EB02B14DE0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2273620,"avatar":"https://static001.geekbang.org/account/avatar/00/22/b1/54/6d663b95.jpg","nickname":"ç“œç‰›","note":"","ucode":"5EB7D2F4400A70","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":636667,"discussion_content":"æ–‡ç« çš„è§‚ç‚¹æ˜¯ API ä½œè€…ä¸è¦æŠŠé”™è¯¯å½“ä½œå¼‚å¸¸ï¼Œå³ï¼Œå¦‚æœä½ æƒ³è¿”å›ä¸€ä¸ªé”™è¯¯ç»™è°ƒç”¨æ–¹ï¼Œä¸è¦ä½¿ç”¨ Panic\n\njson åŒ…çš„ panic ç”¨æ³•æ˜¯æœ‰æ„è€Œä¸ºä¹‹çš„ï¼ŒæŒ‡ç¤ºç¨‹åºæ‰§è¡Œäº†ä¸è¯¥æ‰§è¡Œçš„åˆ†æ”¯ï¼Œé€šå¸¸æ„å‘³ç€ BUGã€‚è¿™æ—¶æ•°æ®çŠ¶æ€æ˜¯ä¸ç¬¦åˆé¢„æœŸçš„ï¼Œäºæ˜¯åˆ©ç”¨ panicking æœºåˆ¶é€€å‡º","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1706687448,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":560428,"ip_address":"å¹¿ä¸œ","group_id":0},"score":636667,"extra":""}]},{"author":{"id":1479120,"avatar":"https://static001.geekbang.org/account/avatar/00/16/91/d0/35bc62b1.jpg","nickname":"æ— å’","note":"","ucode":"B9759B5646F3AB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":603098,"discussion_content":"ä¸ªäººä»¥ä¸ºï¼Œjsonçš„è§£æåˆ°ä¸­é€”ï¼Œå‘ç°æ ¼å¼æŸåï¼Œé€šå¸¸æ˜¯æœåŠ¡ç«¯çš„ç¨‹åºé”™è¯¯ï¼Œéå¸¸å°‘è§ï¼Œæ‰€ä»¥æç¤ºå®¢æˆ·ä»£ç panicã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1675940914,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":325151,"user_name":"å¥•","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1638843979,"is_pvip":false,"replies":[{"id":118585,"content":"è¿™æ˜¯ä¸€ç§é€šè¿‡æ•°ç»„ä¸‹æ ‡æ–¹å¼å¯¹æ•°ç»„è¿›è¡Œåˆå§‹åŒ–çš„æ–¹å¼ã€‚æˆ‘è®°å¾—æˆ‘åœ¨ç¬¬15è®²ä¸­æåˆ°è¿‡å§ã€‚è¿™é‡Œæ•°ç»„å­—é¢å€¼ä¸­æœ€å¤§çš„ä¸‹æ ‡å€¼ä¸º3ï¼Œgoç¼–è¯‘å™¨å°±è®¤ä¸ºæ•°ç»„é•¿åº¦æ˜¯4.ï¼ˆä¸‹æ ‡å€¼èŒƒå›´0~3ï¼‰","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1639558205,"ip_address":"","comment_id":325151,"utype":1}],"discussion_count":6,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"è¯·æ•™ä¸€ä¸ªéè¯¾ç¨‹çš„é—®é¢˜ï¼š\nv := [...]int{1: 2, 3: 4}\nfmt.Println(len(v)) \n\nè¿™é‡Œä¸ºä»€ä¹ˆæ‰“å°å‡ºæ¥çš„ é•¿åº¦æ˜¯ 4å‘¢ï¼Ÿ","like_count":8,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536577,"discussion_content":"å¯ä»¥çš„ã€‚åœ¨åé¢çš„ä¸€ä¸ªå®æˆ˜é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°±ä¼šåº”ç”¨åˆ°è¿™ä¸€ç‚¹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638827327,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1025239,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a4/d7/5d2bfaa7.jpg","nickname":"Aliliin","note":"","ucode":"61F9A09BB6650F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546689,"discussion_content":"deferï¼š è€å­å°±è¦çœ‹çœ‹æ˜¯è°å‡ºçš„é”™ã€‚ğŸ˜‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642392714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1363671,"avatar":"https://static001.geekbang.org/account/avatar/00/14/ce/d7/5315f6ce.jpg","nickname":"ä¸è´Ÿé’æ˜¥ä¸è´Ÿå·±ğŸ¤˜","note":"","ucode":"A6DD8E8B20EA6E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536932,"discussion_content":"ç±»ä¼¼äº log æ—¥å¿—ï¼šï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638893674,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":325234,"user_name":"lesserror","can_delete":false,"product_type":"c1","uid":1351076,"ip_address":"","ucode":"25A54D1165FCF6","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","comment_is_top":false,"comment_ctime":1638872654,"is_pvip":false,"replies":[{"id":118592,"content":"deferæ˜¯åœ¨å‡½æ•°é€€å‡ºæ—¶è°ƒç”¨çš„ã€‚å¦‚æœåœ¨forè¯­å¥çš„æ¯ä¸ªè¿­ä»£éƒ½ä½¿ç”¨deferè®¾ç½®deferredå‡½æ•°ï¼Œè¿™äº›deferredå‡½æ•°ä¼šå‹å…¥runtimeå®ç°çš„deferåˆ—è¡¨ä¸­ã€‚ä¼šå ç”¨å†…å­˜èµ„æºï¼Œå¹¶ä¸”å¦‚æœforçš„loopæ¬¡æ•°å¾ˆå¤šï¼Œè¿™ä¸ªæ¶ˆè€—å°†å¾ˆå¯è§‚ã€‚æ–‡ä¸­åœ¨forä¸­ä½¿ç”¨deferä»…æ˜¯ä¸ºäº†ä¸¾ä¾‹è€Œå·²ã€‚ç”Ÿäº§ä»£ç è¿™å—çš„ç¡®è¦è°¨æ…ï¼Œé€šå¸¸æ˜¯æ²¡æœ‰å¿…è¦è¿™ä¹ˆåšçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1639560668,"ip_address":"","comment_id":325234,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"æ„Ÿè°¢ Tony Bai è€å¸ˆå…³äºdeferçš„æ·±å…¥è®²è§£ï¼Œä¸è¿‡æˆ‘æƒ³é—®ä¸€ä¸‹ï¼Œåœ¨forä¸­ä½¿ç”¨deferå‡½æ•°ï¼Œç¼–è¾‘å™¨ä¼šæç¤ºå¯èƒ½é€ æˆèµ„æºæ³„éœ²ï¼Œèƒ½å¤§è‡´è¯´æ˜ä¸€ä¸‹è¿™å—å„¿çš„çŸ¥è¯†å—ï¼Ÿ","like_count":6,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538926,"discussion_content":"è¿™æ˜¯ä¸€ç§é€šè¿‡æ•°ç»„ä¸‹æ ‡æ–¹å¼å¯¹æ•°ç»„è¿›è¡Œåˆå§‹åŒ–çš„æ–¹å¼ã€‚æˆ‘è®°å¾—æˆ‘åœ¨ç¬¬15è®²ä¸­æåˆ°è¿‡å§ã€‚è¿™é‡Œæ•°ç»„å­—é¢å€¼ä¸­æœ€å¤§çš„ä¸‹æ ‡å€¼ä¸º3ï¼Œgoç¼–è¯‘å™¨å°±è®¤ä¸ºæ•°ç»„é•¿åº¦æ˜¯4.ï¼ˆä¸‹æ ‡å€¼èŒƒå›´0~3ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639558205,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1667175,"avatar":"https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg","nickname":"qinsi","note":"","ucode":"090D9C4068FF12","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537654,"discussion_content":"ä¸‰ä¸ªç‚¹&#34;...&#34;è¡¨ç¤ºlenåœ¨æœ€å¤§çš„ä¸‹æ ‡åé¢ï¼Œæœ€å¤§çš„ä¸‹æ ‡æ˜¯3ï¼Œæ‰€ä»¥lenå°±æ˜¯4","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1639129698,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"å¥•","note":"","ucode":"73CEA468CE70C3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1667175,"avatar":"https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg","nickname":"qinsi","note":"","ucode":"090D9C4068FF12","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":537680,"discussion_content":"â€¦æ˜¯è‡ªåŠ¨æ¨æ–­æ•°ç»„çš„é•¿åº¦ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆé•¿åº¦æ˜¯4çš„ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639141838,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":537654,"ip_address":"","group_id":0},"score":537680,"extra":""},{"author":{"id":1667175,"avatar":"https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg","nickname":"qinsi","note":"","ucode":"090D9C4068FF12","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"å¥•","note":"","ucode":"73CEA468CE70C3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537814,"discussion_content":"ç¨€ç–æ•°ç»„çš„åˆå§‹åŒ–ï¼Œå‰é¢ç¬¬15è¯¾æœ‰è®²çš„","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1639205542,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":537680,"ip_address":"","group_id":0},"score":537814,"extra":""},{"author":{"id":2885586,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/07/d2/1bdf9d33.jpg","nickname":"å‹¤å­¦å¦‚æ˜¥èµ·ä¹‹è‹—,ä¸è§å…¶å¢,æ—¥æœ‰æ‰€é•¿","note":"","ucode":"E8E885754513BE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"å¥•","note":"","ucode":"73CEA468CE70C3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585238,"discussion_content":"åº”è¯¥æ˜¯ï¼ŒæŠŠ4èµ‹å€¼ç»™æ•°ç»„ä¸‹æ ‡ä¸º3çš„å…ƒç´ ï¼Œå°±æ˜¯ç¬¬4ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥é•¿åº¦æ˜¯4ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661413267,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":537680,"ip_address":"ä¸Šæµ·","group_id":0},"score":585238,"extra":""}]}]},{"had_liked":false,"id":343987,"user_name":"van","can_delete":false,"product_type":"c1","uid":1766293,"ip_address":"","ucode":"26FAFF7224F12D","user_header":"https://static001.geekbang.org/account/avatar/00/1a/f3/95/77628ed0.jpg","comment_is_top":false,"comment_ctime":1651156808,"is_pvip":true,"replies":[{"id":125653,"content":"æŠŠpanicå½“åšæ–­è¨€ä½¿ç”¨çš„ç›®çš„æ˜¯åŠæ—©å‘ç°bugï¼Œä¸€æ—¦æ–­è¨€å‘ç”Ÿï¼Œæ„å‘³ç€æ•´ä¸ªç¨‹åºå‡ºç°äº†ä¸å¯æ¢å¤çš„çŠ¶æ€ã€‚å¯¹äºè¿™ç±»panicï¼Œä¸è¦recoverã€‚å°½æ—©å¤±è´¥å¹¶è§£å†³bugã€‚æ‰€ä»¥åœ¨ä»€ä¹ˆä½ç½®è¿›è¡Œæ–­è¨€ï¼Œå¯¹å“ªäº›æ¡ä»¶è¿›è¡Œæ–­è¨€æ˜¯éœ€è¦è€ƒé‡çš„ã€‚åœ¨Cè¯­è¨€ä¸­ä½¿ç”¨assertä¹Ÿæ˜¯åŒæ ·çš„é“ç†ã€‚ä¸€æ—¦assertå¤±è´¥ï¼Œä¾¿ä¼šdump coreæ–‡ä»¶ã€‚ç¨‹åºç»ˆæ­¢ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1651270636,"ip_address":"","comment_id":343987,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"panicä½œä¸ºæ–­è¨€ä½¿ç”¨ï¼Œä¸Šä¸€å±‚çš„è°ƒç”¨è€…è¿˜æ˜¯éœ€è¦è‡ªå·±recoverå›æ¥å§ï¼Œä¸ç„¶è¿™ä¸ªè°ƒç”¨é“¾ä¼šæœ€ç»ˆä¼ åˆ°mainå‡½æ•°","like_count":3,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":568934,"discussion_content":"æŠŠpanicå½“åšæ–­è¨€ä½¿ç”¨çš„ç›®çš„æ˜¯åŠæ—©å‘ç°bugï¼Œä¸€æ—¦æ–­è¨€å‘ç”Ÿï¼Œæ„å‘³ç€æ•´ä¸ªç¨‹åºå‡ºç°äº†ä¸å¯æ¢å¤çš„çŠ¶æ€ã€‚å¯¹äºè¿™ç±»panicï¼Œä¸è¦recoverã€‚å°½æ—©å¤±è´¥å¹¶è§£å†³bugã€‚æ‰€ä»¥åœ¨ä»€ä¹ˆä½ç½®è¿›è¡Œæ–­è¨€ï¼Œå¯¹å“ªäº›æ¡ä»¶è¿›è¡Œæ–­è¨€æ˜¯éœ€è¦è€ƒé‡çš„ã€‚åœ¨Cè¯­è¨€ä¸­ä½¿ç”¨assertä¹Ÿæ˜¯åŒæ ·çš„é“ç†ã€‚ä¸€æ—¦assertå¤±è´¥ï¼Œä¾¿ä¼šdump coreæ–‡ä»¶ã€‚ç¨‹åºç»ˆæ­¢ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1651270636,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":329678,"user_name":"ã‚éª‘ç€å°è½¦å»å…œé£ã€‚","can_delete":false,"product_type":"c1","uid":2600957,"ip_address":"","ucode":"35F9E5360DF42C","user_header":"https://static001.geekbang.org/account/avatar/00/27/af/fd/a1708649.jpg","comment_is_top":false,"comment_ctime":1641466575,"is_pvip":false,"replies":[{"id":120477,"content":"å¾ªç¯ç»“æŸåï¼Œiçš„å€¼ä¸º4. deferè¾“å‡ºçš„æ˜¯içš„å€¼ï¼Œäºæ˜¯å°±éƒ½æ˜¯4.","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1642040805,"ip_address":"","comment_id":329678,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæ²¡å¤ªæ˜ç™½é—­åŒ…çš„åŸç†ï¼Œæƒ³ä¸æ˜ç™½ä¸ºä»€ä¹ˆè¾“å‡ºçš„æ˜¯4ï¼Œè¯·å¸®å¿™è§£ç­”ä¸‹","like_count":3,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545693,"discussion_content":"å¾ªç¯ç»“æŸåï¼Œiçš„å€¼ä¸º4. deferè¾“å‡ºçš„æ˜¯içš„å€¼ï¼Œäºæ˜¯å°±éƒ½æ˜¯4.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642040805,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":2,"child_discussions":[{"author":{"id":2175841,"avatar":"https://static001.geekbang.org/account/avatar/00/21/33/61/16505a1a.jpg","nickname":"He","note":"","ucode":"7F5FF5BEE48AF1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":579999,"discussion_content":"è€å¸ˆä½ å¥½\nä¸è€ƒè™‘ continueå’Œbreak,for çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸æ˜¯è¿™æ ·çš„\nå‰ç½®æ“ä½œ-&gt;åˆ¤æ–­æ¡ä»¶è¡¨è¾¾å¼-&gt;å¾ªç¯ä½“\nç„¶å\nåç½®æ“ä½œ-&gt;åˆ¤æ–­æ¡ä»¶è¡¨è¾¾å¼å¾ªç¯ä½“\ni=3 çš„æ—¶å€™ï¼Œåç½®æ“ä½œè¿˜æ˜¯æ‰§è¡Œäº†i++ï¼Œåªæ˜¯åˆ¤æ–­æ¡ä»¶æ²¡è¿‡ï¼Œæ‰€ä»¥i=4","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1657794593,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":545693,"ip_address":"","group_id":0},"score":579999,"extra":""},{"author":{"id":1351076,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","nickname":"lesserror","note":"","ucode":"25A54D1165FCF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2175841,"avatar":"https://static001.geekbang.org/account/avatar/00/21/33/61/16505a1a.jpg","nickname":"He","note":"","ucode":"7F5FF5BEE48AF1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":621001,"discussion_content":"æ˜¯è¿™æ ·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1686728311,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":579999,"ip_address":"å¹¿ä¸œ","group_id":0},"score":621001,"extra":""}]},{"author":{"id":1915533,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/3a/8d/f5e7a20d.jpg","nickname":"ä½•ä»¥è§£å¿§","note":"","ucode":"4DFE2BDBAF4919","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":654200,"discussion_content":"iteration å…±äº«ä½œç”¨åŸŸï¼Œè¿™ä¸ªä¾‹å­æ”¾åœ¨åŠæ—¶æ±‚å€¼æœ‰ç‚¹ç»•äººï¼Œåƒæ˜¯æ‰§è¡Œçš„æ—¶å€™å–æœ€æ–°çš„å€¼ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1732164126,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ±Ÿè‹","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":325821,"user_name":"åŠŸå¤«ç†ŠçŒ«","can_delete":false,"product_type":"c1","uid":2732243,"ip_address":"","ucode":"D124F4FA4E816F","user_header":"https://static001.geekbang.org/account/avatar/00/29/b0/d3/200e82ff.jpg","comment_is_top":false,"comment_ctime":1639152392,"is_pvip":false,"replies":[{"id":119090,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1640054649,"ip_address":"","comment_id":325821,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"deferæ•°æ®åº“çš„å¼€å…³ã€‚é”çš„ç”³è¯·é‡Šæ”¾ã€‚TCPçš„è¿æ¥å’Œæ–­å¼€ä¹‹ç±»çš„","like_count":3,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540415,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640054649,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324930,"user_name":"å®‹ä¸–æ°","can_delete":false,"product_type":"c1","uid":2068776,"ip_address":"","ucode":"0869FF74808452","user_header":"https://static001.geekbang.org/account/avatar/00/1f/91/28/f2dcbbfe.jpg","comment_is_top":false,"comment_ctime":1638722190,"is_pvip":true,"replies":[{"id":117954,"content":"æ˜¯go runtimeå±‚å®ç°çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1638827605,"ip_address":"","comment_id":324930,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"Deferå‡½æ•°è¢«æ”¾åœ¨ä¸€ä¸ªä¸åŒäºä¸»å‡½æ•°çš„å‡½æ•°æ ˆä¸­å—ï¼Ÿ æ˜¯ç”¨sliceå®ç°çš„å—ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1479120,"avatar":"https://static001.geekbang.org/account/avatar/00/16/91/d0/35bc62b1.jpg","nickname":"æ— å’","note":"","ucode":"B9759B5646F3AB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":603101,"discussion_content":"ç”±Go runtimeæ¥å®ç°ã€‚\nä»è¯­ä¹‰ä¸Šä¸å®¹å™¨å‡½æ•°åœ¨åŒä¸€ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œä»å®ç°ä¸Šè¯´ï¼Œåœ¨åŒä¸€ä¸ªstack frameä¸Šæ¯”è¾ƒå®¹æ˜“å®ç°ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1675941229,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1351076,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","nickname":"lesserror","note":"","ucode":"25A54D1165FCF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536813,"discussion_content":"åŒå­¦ï¼Œä½ è¿™é‡Œä¸ºä½•è¯´ï¼šâ€œä¸€ä¸ªä¸åŒäºä¸»å‡½æ•°çš„å‡½æ•°æ ˆä¸­â€ã€‚æˆ‘çœ‹æ–‡ä¸­è€å¸ˆè¯´ï¼šâ€œdefer å°†å®ƒä»¬æ³¨å†Œåˆ°å…¶æ‰€åœ¨ Goroutine ä¸­ï¼Œç”¨äºå­˜æ”¾ deferred å‡½æ•°çš„æ ˆæ•°æ®ç»“æ„ä¸­â€ã€‚æ²¡æ˜ç™½ä½ è¯´çš„ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1638873564,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2323716,"avatar":"https://static001.geekbang.org/account/avatar/00/23/75/04/d26cd437.jpg","nickname":"lemon","note":"","ucode":"47626025C55E5E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1351076,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","nickname":"lesserror","note":"","ucode":"25A54D1165FCF6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540526,"discussion_content":"æ„Ÿè§‰è¿™ä¸ªåŒå­¦è¦è¡¨è¾¾çš„æ˜¯è¯´ï¼Œdeferredå‡½æ•°æ‰€åœ¨çš„å‡½æ•°æ ˆå’Œè°ƒç”¨deferçš„å‡½æ•°æ‰€åœ¨çš„æ­£å¸¸å‡½æ•°æ ˆä¸æ˜¯åŒä¸€ä¸ª","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1640075645,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":536813,"ip_address":"","group_id":0},"score":540526,"extra":""}]},{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536580,"discussion_content":"æ˜¯go runtimeå±‚å®ç°çš„ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1638827605,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345769,"user_name":"Felix","can_delete":false,"product_type":"c1","uid":1285253,"ip_address":"","ucode":"6F674755CAB29D","user_header":"https://static001.geekbang.org/account/avatar/00/13/9c/85/d9614715.jpg","comment_is_top":false,"comment_ctime":1652583011,"is_pvip":false,"replies":[{"id":126231,"content":"func fooWithDefer() {\n    defer func() {\n        sum(10)\n    }()\n}\n\nè¿™ä¸ªå‡½æ•°ç®—ä¸ä¸Šé—­åŒ…å•Šã€‚deferåªæ˜¯æ³¨å†Œäº†ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œè¯¥å‡½æ•°å¹¶æ²¡æœ‰æ•æ‰fooWithDeferå‡½æ•°çš„æœ¬åœ°å˜é‡ã€‚\n\næˆ‘æ€€ç–‘func fooWithDefer() {\n    defer func() {\n        sum(10)\n    }()\n}\nä¸­çš„sum(10)è°ƒç”¨è¢«ç›´æ¥å†…è”ä¼˜åŒ–äº†(inline)ï¼Œè€Œä¸æ˜¯åšå‡½æ•°è°ƒç”¨äº†ã€‚\n\nåŒç†fooWithoutDeferå¯¹sumçš„è°ƒç”¨ä¹Ÿå¾ˆå¤§å¯èƒ½è¢«inlineäº†ã€‚\n\næˆ‘åœ¨macosä¸Šå…³é—­inlineå’Œä¼˜åŒ–çš„ç»“æœï¼š\n\n$go test -gcflags &quot;-N -l&quot; -v -bench .\ngoos: darwin\ngoarch: amd64\npkg: demo\ncpu: Intel(R) Core(TM) i5-8257U CPU @ 1.40GHz\nBenchmarkFooWithDeferNoClosure\nBenchmarkFooWithDeferNoClosure-8   \t37973526\t        27.60 ns&#47;op\nBenchmarkFooWithDefer\nBenchmarkFooWithDefer-8            \t43756006\t        27.57 ns&#47;op\nBenchmarkFooWithoutDefer\nBenchmarkFooWithoutDefer-8         \t71541520\t        17.22 ns&#47;op\nPASS\nok  \tdemo\t3.576s\n\nä¸¤ä¸ªå¸¦deferçš„å‡ ä¹æ²¡åŒºåˆ«äº†ã€‚\n","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1652691068,"ip_address":"","comment_id":345769,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"defer benchmarkçš„ä¾‹å­ä¸­ï¼Œå‡½æ•°sumæœ‰è¿”å›å€¼ï¼Œæ‰€æœ‰deferçš„æ—¶å€™æ”¾åœ¨é—­åŒ…é‡Œé¢ï¼Œå¦‚æœå‡½æ•°sumæ²¡æœ‰è¿”å›å€¼ï¼Œå¯ä»¥ç›´æ¥æ”¾åœ¨deferåé¢defer sum()ï¼Œæˆ‘åšäº†ä¸€ä¸‹benchmarkï¼Œå‘ç°è¿˜æ˜¯æ”¾é—­åŒ…é‡Œé¢æ¯”è¾ƒå¿«ï¼Œgoè¯­è¨€å¯¹é—­åŒ…æœ‰ä»€ä¹ˆä¼˜åŒ–å—ï¼Œæ„Ÿè§‰ç”¨é—­åŒ…ä¼šå¤šå‹ä¸€æ¬¡æ ˆï¼Œä½†æ˜¯åè€Œæ›´å¿«ï¼Œè€å¸ˆèƒ½è§£ç­”ä¸€ä¸‹å—ï¼Ÿ\n&#47;&#47; defer_test.go\npackage main\n\nimport &quot;testing&quot;\n\nfunc sum(max int) {\n    total := 0\n    for i := 0; i &lt; max; i++ {\n        total += i\n    }\n}\n\nfunc fooWithDeferNoClosure() {\n\tdefer sum(10)\n}\n\nfunc fooWithDefer() {\n    defer func() {\n        sum(10)\n    }()\n}\nfunc fooWithoutDefer() {\n    sum(10)\n}\n\nfunc BenchmarkFooWithDeferNoClosure(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        fooWithDeferNoClosure()\n    }\n}\n\nfunc BenchmarkFooWithDefer(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        fooWithDefer()\n    }\n}\nfunc BenchmarkFooWithoutDefer(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        fooWithoutDefer()\n    }\n}\n\nbenchmarkç»“æœï¼š\n$ go test -bench . defer_test.go\ngoos: linux\ngoarch: amd64\ncpu: Intel Core Processor (Broadwell, IBRS)\nBenchmarkFooWithDeferNoClosure-2   \t67386957\t        18.59 ns&#47;op\nBenchmarkFooWithDefer-2                  \t80693001\t        15.45 ns&#47;op\nBenchmarkFooWithoutDefer-2             \t100000000\t11.03 ns&#47;op\nPASS\nok  \tcommand-line-arguments\t3.665s","like_count":2},{"had_liked":false,"id":338018,"user_name":"Rayjun","can_delete":false,"product_type":"c1","uid":1002514,"ip_address":"","ucode":"61A3D1A3D03569","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4c/12/f0c145d4.jpg","comment_is_top":false,"comment_ctime":1647239134,"is_pvip":false,"replies":[{"id":123617,"content":"å¥½é—®é¢˜ï¼panicæ˜¯ä¸€ä¸ªstack unwindingçš„è¿‡ç¨‹ï¼Œè€Œæ¯ä¸ªgoroutineéƒ½æœ‰è‡ªå·±çš„æ‰§è¡Œæ ˆã€‚ä¸€ä¸ªgoroutineæ‰§è¡Œæ ˆä¸Šå‘ç”Ÿçš„panicï¼Œå¦å¤–ä¸€ä¸ªgoroutineè‚¯å®šæ˜¯ä¸çŸ¥æ™“çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1647321802,"ip_address":"","comment_id":338018,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"è€å¸ˆï¼Œå’¨è¯¢ä¸€ä¸ªé—®é¢˜ï¼Œpanic æ— æ³•è·¨ goroutine æ•è·ï¼Œè¿™ä¸ªæ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572282,"discussion_content":"func fooWithDefer() {\n    defer func() {\n        sum(10)\n    }()\n}\n\nè¿™ä¸ªå‡½æ•°ç®—ä¸ä¸Šé—­åŒ…å•Šã€‚deferåªæ˜¯æ³¨å†Œäº†ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œè¯¥å‡½æ•°å¹¶æ²¡æœ‰æ•æ‰fooWithDeferå‡½æ•°çš„æœ¬åœ°å˜é‡ã€‚\n\næˆ‘æ€€ç–‘func fooWithDefer() {\n    defer func() {\n        sum(10)\n    }()\n}\nä¸­çš„sum(10)è°ƒç”¨è¢«ç›´æ¥å†…è”ä¼˜åŒ–äº†(inline)ï¼Œè€Œä¸æ˜¯åšå‡½æ•°è°ƒç”¨äº†ã€‚\n\nåŒç†fooWithoutDeferå¯¹sumçš„è°ƒç”¨ä¹Ÿå¾ˆå¤§å¯èƒ½è¢«inlineäº†ã€‚\n\næˆ‘åœ¨macosä¸Šå…³é—­inlineå’Œä¼˜åŒ–çš„ç»“æœï¼š\n\n$go test -gcflags &#34;-N -l&#34; -v -bench .\ngoos: darwin\ngoarch: amd64\npkg: demo\ncpu: Intel(R) Core(TM) i5-8257U CPU @ 1.40GHz\nBenchmarkFooWithDeferNoClosure\nBenchmarkFooWithDeferNoClosure-8   \t37973526\t        27.60 ns/op\nBenchmarkFooWithDefer\nBenchmarkFooWithDefer-8            \t43756006\t        27.57 ns/op\nBenchmarkFooWithoutDefer\nBenchmarkFooWithoutDefer-8         \t71541520\t        17.22 ns/op\nPASS\nok  \tdemo\t3.576s\n\nä¸¤ä¸ªå¸¦deferçš„å‡ ä¹æ²¡åŒºåˆ«äº†ã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652691068,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":336953,"user_name":"é£é“ƒ","can_delete":false,"product_type":"c1","uid":2633228,"ip_address":"","ucode":"999A26CC937C78","user_header":"https://static001.geekbang.org/account/avatar/00/28/2e/0c/b6180a5f.jpg","comment_is_top":false,"comment_ctime":1646488489,"is_pvip":false,"replies":[{"id":123235,"content":"å—¯ï¼Œè¿™æ ·å†™å°±æŠŠé”™è¯¯å¤„ç†ä¸å¼‚å¸¸å¤„ç†æ··æ·†äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1646722245,"ip_address":"","comment_id":336953,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"è‡ªå·±ä»¥å‰å†™ä»£ç ï¼Œæ€»æ˜¯åœ¨panicæŠŠé”™è¯¯ä¿¡æ¯åŒ…è¿›å»\nif !=nil{\n    panic(fmt.Errorf(&quot;err is:%s\\n&quot;,err))\n}","like_count":2,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555016,"discussion_content":"å—¯ï¼Œè¿™æ ·å†™å°±æŠŠé”™è¯¯å¤„ç†ä¸å¼‚å¸¸å¤„ç†æ··æ·†äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646722245,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328614,"user_name":"Geek_7jzyrf","can_delete":false,"product_type":"c1","uid":1780608,"ip_address":"","ucode":"604202E40E9AA5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/pibibkbticCqnwDJkluy5QAWibesJ7vxLbQIG5sewicnjyjYFD9S4Oq9XYxxmjWTQTtFaNeYN6MpXwNAqfe8vUib21PA/132","comment_is_top":false,"comment_ctime":1640789355,"is_pvip":false,"replies":[{"id":120424,"content":"i=3åï¼Œå¾ªç¯ä½“æ‰§è¡Œï¼Œç„¶åæ‰§è¡Œå¾ªç¯åç½®è¯­å¥i++ï¼Œè¿™æ ·iå°±ä¸º4äº†å•Šã€‚ä¹‹ådeferred å‡½æ•°è¢«æ‰§è¡Œï¼Œè¾“å‡ºçš„iä¸º4ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1641997053,"ip_address":"","comment_id":328614,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"è€å¸ˆï¼Œåœ¨  â€œæ³¨æ„ defer å…³é”®å­—åé¢è¡¨è¾¾å¼çš„æ±‚å€¼æ—¶æœºâ€ è¿™ä¸ªçŸ¥è¯†ç‚¹ï¼Œ\n func foo3(){\n\t for i :=0; i &lt;=3; i++{\n\t\t defer func(){  \n\t\t\t fmt.Println(i)\n\n\t\t }()\n\t }\n }\nè¾“å‡ºç»“æœä¸ºå•¥æ˜¯4ï¼Ÿ i æœ€å¤§åº”è¯¥åªèƒ½å–åˆ°3å§ï¼Ÿæ²¡çœ‹æ˜ç™½ï¼Œå¸Œæœ›è€å¸ˆè¿›ä¸€æ­¥è§£ç­”ä¸‹ï¼","like_count":2,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545583,"discussion_content":"i=3åï¼Œå¾ªç¯ä½“æ‰§è¡Œï¼Œç„¶åæ‰§è¡Œå¾ªç¯åç½®è¯­å¥i++ï¼Œè¿™æ ·iå°±ä¸º4äº†å•Šã€‚ä¹‹ådeferred å‡½æ•°è¢«æ‰§è¡Œï¼Œè¾“å‡ºçš„iä¸º4ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641997054,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1559831,"avatar":"https://static001.geekbang.org/account/avatar/00/17/cd/17/d7fdb428.jpg","nickname":"çŸ³å¤´","note":"","ucode":"BD9A4319961733","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543510,"discussion_content":"æœ€åä¸€æ¬¡å¾ªç¯ä¹‹åiæ˜¯3ï¼Œä½†æ˜¯æœ€åè¿›è¡Œäº†i++å°±æ˜¯4äº†ï¼Œåˆ¤è¯»4æ¯”3å¤§ä¹‹åæ‰ä¼šç»“æŸå¾ªç¯ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1641188861,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":325332,"user_name":"aoe","can_delete":false,"product_type":"c1","uid":1121758,"ip_address":"","ucode":"1C6201EDB4E954","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","comment_is_top":false,"comment_ctime":1638926098,"is_pvip":false,"replies":[{"id":118593,"content":"æ˜¯çš„ã€‚ä½†å¤æ´»äº†ï¼Œç¨‹åºä¹Ÿç»“æŸäº†:)ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1639560727,"ip_address":"","comment_id":325332,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"åœ¨ main å‡½æ•°å¼€å§‹åŠ ä¸Šè¿™æ ·çš„ä»£ç ï¼Œå¯ä»¥ä» panic ä¸­æ— é™å¤æ´»äº†\ndefer func() {\n\tif e := recover(); e != nil {\n\t\tfmt.Println(&quot;recover the panic:&quot;, e)\n\t}\n}()","like_count":2,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545583,"discussion_content":"i=3åï¼Œå¾ªç¯ä½“æ‰§è¡Œï¼Œç„¶åæ‰§è¡Œå¾ªç¯åç½®è¯­å¥i++ï¼Œè¿™æ ·iå°±ä¸º4äº†å•Šã€‚ä¹‹ådeferred å‡½æ•°è¢«æ‰§è¡Œï¼Œè¾“å‡ºçš„iä¸º4ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641997054,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1559831,"avatar":"https://static001.geekbang.org/account/avatar/00/17/cd/17/d7fdb428.jpg","nickname":"çŸ³å¤´","note":"","ucode":"BD9A4319961733","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543510,"discussion_content":"æœ€åä¸€æ¬¡å¾ªç¯ä¹‹åiæ˜¯3ï¼Œä½†æ˜¯æœ€åè¿›è¡Œäº†i++å°±æ˜¯4äº†ï¼Œåˆ¤è¯»4æ¯”3å¤§ä¹‹åæ‰ä¼šç»“æŸå¾ªç¯ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1641188861,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":325207,"user_name":"Bynow","can_delete":false,"product_type":"c1","uid":2735072,"ip_address":"","ucode":"1E4F3ADD65CF18","user_header":"https://static001.geekbang.org/account/avatar/00/29/bb/e0/c7cd5170.jpg","comment_is_top":false,"comment_ctime":1638863486,"is_pvip":false,"replies":[{"id":118586,"content":"ä½ æ¢æˆç›´æ¥åœ¨å‘½ä»¤è¡Œæ‰§è¡Œè¿™ä¸ªç¨‹åºå‘¢ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1639558549,"ip_address":"","comment_id":325207,"utype":1}],"discussion_count":6,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"æˆ‘ç”¨çš„goland ï¼Œæ–‡ä¸­æ›´æ–°åçš„barä»£ç ï¼šæˆ‘çš„ç¼–è¾‘å™¨ç»ˆç«¯è¾“å‡ºæ˜¯\ncall main\ncall foo\ncall bar\nexit foo\nexit main\nrecover the panic: panic occurs in bar\n\nä½†æ˜¯æˆ‘æ‰“æ–­ç‚¹è°ƒè¯•çš„ç¡®æ˜¯æŒ‰ç…§è€å¸ˆçš„é‚£æ ·å»æ‰§è¡Œå’Œè¾“å‡ºçš„ï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538929,"discussion_content":"ä½ æ¢æˆç›´æ¥åœ¨å‘½ä»¤è¡Œæ‰§è¡Œè¿™ä¸ªç¨‹åºå‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639558549,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2735072,"avatar":"https://static001.geekbang.org/account/avatar/00/29/bb/e0/c7cd5170.jpg","nickname":"Bynow","note":"","ucode":"1E4F3ADD65CF18","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":545509,"discussion_content":"\nprintLnå’Œfmt.PrintLn æ··ç”¨ä¼šå¯¼è‡´è¾“å‡ºé¡ºåºä¸ä¸€è‡´","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641979639,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":538929,"ip_address":"","group_id":0},"score":545509,"extra":""}]},{"author":{"id":1248326,"avatar":"https://static001.geekbang.org/account/avatar/00/13/0c/46/dfe32cf4.jpg","nickname":"å¤šé€‰å‚æ•°","note":"","ucode":"B2294D80AB075F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537349,"discussion_content":"è¿™ä¸ªæˆ‘è§‰å¾—æ›´å¤šæ˜¯è¾“å‡ºçš„é—®é¢˜ï¼Œè€Œä¸æ˜¯æ‰§è¡Œçš„é—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639040533,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2049562,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/aQmhiahazRFUA4W3r1hdxxreSB5Pl54IwAJ8bwN6j02lzicydWAfPFbWx1LSFtzXH8MkI0jUKjlpUtmQBoZ4kReA/132","nickname":"Geek_99b47c","note":"","ucode":"D25E22C1D84E09","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537091,"discussion_content":"æ˜¯çš„ã€‚æ··åˆç”¨è¾“å‡ºé¡ºåºä¼šä¸ä¸€æ ·ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638955040,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2735072,"avatar":"https://static001.geekbang.org/account/avatar/00/29/bb/e0/c7cd5170.jpg","nickname":"Bynow","note":"","ucode":"1E4F3ADD65CF18","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536880,"discussion_content":"printLnå’Œfmt.PrintLn æ··ç”¨ä¼šå¯¼è‡´è¾“å‡ºé¡ºåºä¸ä¸€è‡´","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638886245,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2735072,"avatar":"https://static001.geekbang.org/account/avatar/00/29/bb/e0/c7cd5170.jpg","nickname":"Bynow","note":"","ucode":"1E4F3ADD65CF18","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536764,"discussion_content":"æˆ‘æŠŠè¾“å‡ºç»Ÿä¸€éƒ½æ”¹æˆfmt.Printlnå°±å¯ä»¥äº†ã€‚ä¸çŸ¥é“æ˜¯ä¸ºå•¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638864512,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":375169,"user_name":"å¤§å¹´ç³•","can_delete":false,"product_type":"c1","uid":2687098,"ip_address":"å±±ä¸œ","ucode":"D776067299F785","user_header":"https://static001.geekbang.org/account/avatar/00/29/00/7a/791d0f5e.jpg","comment_is_top":false,"comment_ctime":1685003433,"is_pvip":false,"replies":[{"id":136929,"content":"æˆ‘ç†è§£ï¼šæ‰¿æ‹…ä¸€éƒ¨åˆ†ç›¸ä¼¼çš„èŒè´£ï¼Œä½†ä¸ç­‰ä»·å“¦ã€‚ææ„å‡½æ•°åœ¨å¯¹è±¡é”€æ¯æ—¶è‡ªåŠ¨è°ƒç”¨ï¼Œdeferåªæ˜¯é’ˆå¯¹å‡½æ•°æˆ–æ–¹æ³•ã€‚goæ²¡æœ‰ææ„å‡½æ•°è¿™ä¸€è¯´ã€‚å¦‚æœè¦åœ¨ä¸€ä¸ªheapå¯¹è±¡è¢«gcé‡Šæ”¾æ—¶åšä¸€äº›äº‹æƒ…ï¼Œå¯ä»¥ç”¨runtime.SetFinalizerï¼Œä¸è¿‡è¿™æ˜¯é«˜çº§ç”¨æ³•ï¼Œå¤§å¤šæ•°æƒ…å†µæ— éœ€è€ƒè™‘ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1685068799,"ip_address":"åŒ—äº¬","comment_id":375169,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"æŠŠdeferä½œä¸ºææ„å‡½æ•°ä½¿ç”¨?","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":619405,"discussion_content":"æˆ‘ç†è§£ï¼šæ‰¿æ‹…ä¸€éƒ¨åˆ†ç›¸ä¼¼çš„èŒè´£ï¼Œä½†ä¸ç­‰ä»·å“¦ã€‚ææ„å‡½æ•°åœ¨å¯¹è±¡é”€æ¯æ—¶è‡ªåŠ¨è°ƒç”¨ï¼Œdeferåªæ˜¯é’ˆå¯¹å‡½æ•°æˆ–æ–¹æ³•ã€‚goæ²¡æœ‰ææ„å‡½æ•°è¿™ä¸€è¯´ã€‚å¦‚æœè¦åœ¨ä¸€ä¸ªheapå¯¹è±¡è¢«gcé‡Šæ”¾æ—¶åšä¸€äº›äº‹æƒ…ï¼Œå¯ä»¥ç”¨runtime.SetFinalizerï¼Œä¸è¿‡è¿™æ˜¯é«˜çº§ç”¨æ³•ï¼Œå¤§å¤šæ•°æƒ…å†µæ— éœ€è€ƒè™‘ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1685068799,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":374793,"user_name":"Geek_73c432","can_delete":false,"product_type":"c1","uid":2869118,"ip_address":"å¹¿ä¸œ","ucode":"3E11EB02B14DE0","user_header":"","comment_is_top":false,"comment_ctime":1684426108,"is_pvip":false,"replies":[{"id":136765,"content":"Goçš„panicè¯­ä¹‰å°±æ˜¯è¿™æ ·çš„ï¼ˆgo specï¼‰ï¼šâ€œWhile executing a function F, an explicit call to panic or a run-time panic terminates the execution of F. Any functions deferred by F are then executed as usual. Next, any deferred functions run by F&#39;s caller are run, and so on up to any deferred by the top-level function in the executing goroutineâ€ ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1684502071,"ip_address":"è¾½å®","comment_id":374793,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"æœ‰æ²¡æœ‰å¯èƒ½ deferred å‡½æ•°æœ¬èº«æ‰§è¡Œçš„æ—¶å€™ä¼šå¼•å‘å¼‚å¸¸ï¼ˆpanicï¼‰å‘¢ï¼Ÿ\n\nç»æµ‹è¯•ï¼ˆgo version go1.20.2 linux&#47;amd64ï¼‰åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…¶ä»–å·²ç»æ³¨å†Œçš„ deferred å‡½æ•°è¿˜ä¼šæ­£å¸¸æ‰§è¡Œï¼Œä¾‹å¦‚è¿™ä¸ªæ•è· panic å¹¶æ¢å¤çš„ deferred å‡½æ•°\n\nfunc deferTest() {\n        &#47;&#47; func1\n\tdefer func() {\n\t\tif err := recover(); err != nil {\n\t\t\tfmt.Println(&quot;recover the panic: &quot;, err)\n\t\t}\n\t}()\n\tdefer func() {\n\t\tfmt.Println(&quot;exit... with panic&quot;)\n\t\tpanic(&quot;whatever...&quot;)\n\t}()\n}\n\nä¸ºå•¥å·²ç»è§¦å‘ panickingï¼Œfunc1 è¿˜ä¼šæ‰§è¡Œå‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":618749,"discussion_content":"Goçš„panicè¯­ä¹‰å°±æ˜¯è¿™æ ·çš„ï¼ˆgo specï¼‰ï¼šâ€œWhile executing a function F, an explicit call to panic or a run-time panic terminates the execution of F. Any functions deferred by F are then executed as usual. Next, any deferred functions run by F&#39;s caller are run, and so on up to any deferred by the top-level function in the executing goroutineâ€ ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1684502071,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371396,"user_name":"Geek_0d5d37","can_delete":false,"product_type":"c1","uid":3522132,"ip_address":"å››å·","ucode":"1BB4AEF1328C64","user_header":"","comment_is_top":false,"comment_ctime":1679899925,"is_pvip":false,"replies":[{"id":135517,"content":"1. deferæ³¨å†Œæ—¶æ±‚å€¼çš„æ˜¯å…¶æ³¨å†Œçš„å‡½æ•°çš„å‚æ•°ï¼Œè¿™é‡Œæ˜¯defer func() {....}ï¼Œåé¢çš„åŒ¿åå‡½æ•°æ²¡æœ‰å‚æ•°ã€‚\n2. é—­åŒ…ç¯å¢ƒæŒ‡çš„æ˜¯åŒ…è£¹(wrap)é—­åŒ…å‡½æ•°çš„é‚£ä¸ªå‡½æ•°ï¼Œè¿™é‡Œå°±æ˜¯foo3ï¼Œè€Œä¸æ˜¯å¾ªç¯ä½“ã€‚å¾ªç¯ä½“æ˜¯foo3å†…æ‰§è¡Œçš„é€»è¾‘ï¼Œä¸æ˜¯é—­åŒ…ç¯å¢ƒã€‚å› æ­¤é—­åŒ…å‡½æ•°æ•æ‰åˆ°çš„foo3çš„å˜é‡å°±æ˜¯å¾ªç¯å˜é‡iï¼š\n\nè¿™é‡Œç”¨ä¸€ä¸ªfoo3çš„ç­‰ä»·å‡½æ•°æ¥è¡¨ç¤ºï¼Œä½ å¯èƒ½å°±ç†è§£äº†ï¼š\n\nfunc foo3() {\n       i := 0\n       for i = 0; i &lt;= 3; i++ {\n        defer func() {\n            fmt.Println(i)\n        }()\n    }\n}","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1679926099,"ip_address":"è¾½å®","comment_id":371396,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"ä½œè€…å›å¤: é¦–å…ˆç¡®è®¤ä¸€ä¸‹å¯¹forè¯­ä¹‰çš„ç†è§£ã€‚é’ˆå¯¹for i := 0; i &lt;= 3; i++ {}å¾ªç¯ï¼Œ å½“i=3æ—¶ï¼Œforè¿›å…¥å¾ªç¯ä½“ï¼Œç„¶åæ‰§è¡Œåç½®è¯­å¥i++ï¼Œä¹‹åiçš„å€¼ä¸º4. ç„¶åå†åˆ¤æ–­å¾ªç¯æ¡ä»¶i&lt;=3ï¼Œä¸æ»¡è¶³ï¼Œforå¾ªç¯ç»“æŸã€‚äºæ˜¯içš„æœ€ç»ˆå€¼å°±æ˜¯4ã€‚\n\ndeferæ‰§è¡Œæ—¶ï¼Œiæ˜¯4ï¼Œé—­åŒ…å¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªiï¼Œæ‰€ä»¥éƒ½è¾“å‡º4ã€‚\n\nè€å¸ˆæ‚¨å¥½ã€‚ ä¸Šé¢æ˜¯æ‚¨å›ç­”çš„ä¸€ä¸ªé—®é¢˜ï¼ŒåŸºäºè¿™ä¸ªé—®é¢˜æˆ‘æœ‰ç‚¹ä¸ç†è§£\n\næ—¢ç„¶defer åé¢çš„å‡½æ•°æ˜¯åœ¨æ‰§è¡Œdeferçš„æ—¶å€™æ³¨å†Œå¹¶æ±‚å€¼ï¼Œé‚£é—­åŒ…å¼•ç”¨çš„ä¹Ÿæ˜¯å½“å‰ç¯å¢ƒçš„å˜é‡ã€‚ ä¹Ÿå°±æ˜¯for æ¯æ¬¡æ‰§è¡Œå¾ªç¯ä½“æ—¶æ³¨å†Œçš„é—­åŒ…ç¯å¢ƒï¼Œ æœ€åå»¶è¿Ÿè°ƒç”¨ä¹Ÿæ˜¯æ³¨å†Œæ—¶å¯¹åº”çš„é—­åŒ…ç¯å¢ƒçš„iå€¼ï¼Œ è€Œä¸æ˜¯å¾ªç¯åˆ¤æ–­ä¸æ»¡è¶³æ¡ä»¶ç»“æŸå¾ªç¯åè¿è¡Œçš„ç¯å¢ƒã€‚  è¿™æ˜¯ä¸æ˜ç™½çš„ç‚¹ï¼Œéº»çƒ¦è€å¸ˆæœ‰ç©ºæ—¶è®²è§£ä¸‹","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":611103,"discussion_content":"1. deferæ³¨å†Œæ—¶æ±‚å€¼çš„æ˜¯å…¶æ³¨å†Œçš„å‡½æ•°çš„å‚æ•°ï¼Œè¿™é‡Œæ˜¯defer func() {....}ï¼Œåé¢çš„åŒ¿åå‡½æ•°æ²¡æœ‰å‚æ•°ã€‚\n2. é—­åŒ…ç¯å¢ƒæŒ‡çš„æ˜¯åŒ…è£¹(wrap)é—­åŒ…å‡½æ•°çš„é‚£ä¸ªå‡½æ•°ï¼Œè¿™é‡Œå°±æ˜¯foo3ï¼Œè€Œä¸æ˜¯å¾ªç¯ä½“ã€‚å¾ªç¯ä½“æ˜¯foo3å†…æ‰§è¡Œçš„é€»è¾‘ï¼Œä¸æ˜¯é—­åŒ…ç¯å¢ƒã€‚å› æ­¤é—­åŒ…å‡½æ•°æ•æ‰åˆ°çš„foo3çš„å˜é‡å°±æ˜¯å¾ªç¯å˜é‡iï¼š\n\nè¿™é‡Œç”¨ä¸€ä¸ªfoo3çš„ç­‰ä»·å‡½æ•°æ¥è¡¨ç¤ºï¼Œä½ å¯èƒ½å°±ç†è§£äº†ï¼š\n\nfunc foo3() {\n       i := 0\n       for i = 0; i &lt;= 3; i++ {\n        defer func() {\n            fmt.Println(i)\n        }()\n    }\n}","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679926099,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3522132,"avatar":"","nickname":"Geek_0d5d37","note":"","ucode":"1BB4AEF1328C64","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":611164,"discussion_content":"æ„Ÿè°¢è€å¸ˆçš„ç»†å¿ƒå›ç­”ï¼Œå¯¹é—­åŒ…çš„ç†è§£åˆæ·±å…¥ä¸€äº›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679969704,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å››å·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":365569,"user_name":"geektime_zpf","can_delete":false,"product_type":"c1","uid":1041743,"ip_address":"åŒ—äº¬","ucode":"FD61BCAD02CA54","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e5/4f/731ef2c1.jpg","comment_is_top":false,"comment_ctime":1672791171,"is_pvip":true,"replies":[{"id":133167,"content":"å°±æ˜¯å½“ç¨‹åºæŒ‡ä»¤æ‰§è¡Œåˆ°defer xxxxé‚£ä¸€è¡Œæ—¶ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1672809214,"ip_address":"åŒ—äº¬","comment_id":365569,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"&quot;defer å…³é”®å­—åé¢çš„è¡¨è¾¾å¼ï¼Œæ˜¯åœ¨å°† deferred å‡½æ•°æ³¨å†Œåˆ° deferred å‡½æ•°æ ˆçš„æ—¶å€™è¿›è¡Œæ±‚å€¼çš„&quot;\nè€å¸ˆä½ å¥½ï¼Œè¯·é—®defferedå‡½æ•°æ³¨å†Œåˆ°å‡½æ•°æ ˆçš„æ—¶æœºå…·ä½“æ˜¯ä»€ä¹ˆï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":598401,"discussion_content":"å°±æ˜¯å½“ç¨‹åºæŒ‡ä»¤æ‰§è¡Œåˆ°defer xxxxé‚£ä¸€è¡Œæ—¶ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672809214,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345769,"user_name":"Felix","can_delete":false,"product_type":"c1","uid":1285253,"ip_address":"","ucode":"6F674755CAB29D","user_header":"https://static001.geekbang.org/account/avatar/00/13/9c/85/d9614715.jpg","comment_is_top":false,"comment_ctime":1652583011,"is_pvip":false,"replies":[{"id":126231,"content":"func fooWithDefer() {\n    defer func() {\n        sum(10)\n    }()\n}\n\nè¿™ä¸ªå‡½æ•°ç®—ä¸ä¸Šé—­åŒ…å•Šã€‚deferåªæ˜¯æ³¨å†Œäº†ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œè¯¥å‡½æ•°å¹¶æ²¡æœ‰æ•æ‰fooWithDeferå‡½æ•°çš„æœ¬åœ°å˜é‡ã€‚\n\næˆ‘æ€€ç–‘func fooWithDefer() {\n    defer func() {\n        sum(10)\n    }()\n}\nä¸­çš„sum(10)è°ƒç”¨è¢«ç›´æ¥å†…è”ä¼˜åŒ–äº†(inline)ï¼Œè€Œä¸æ˜¯åšå‡½æ•°è°ƒç”¨äº†ã€‚\n\nåŒç†fooWithoutDeferå¯¹sumçš„è°ƒç”¨ä¹Ÿå¾ˆå¤§å¯èƒ½è¢«inlineäº†ã€‚\n\næˆ‘åœ¨macosä¸Šå…³é—­inlineå’Œä¼˜åŒ–çš„ç»“æœï¼š\n\n$go test -gcflags &quot;-N -l&quot; -v -bench .\ngoos: darwin\ngoarch: amd64\npkg: demo\ncpu: Intel(R) Core(TM) i5-8257U CPU @ 1.40GHz\nBenchmarkFooWithDeferNoClosure\nBenchmarkFooWithDeferNoClosure-8   \t37973526\t        27.60 ns&#47;op\nBenchmarkFooWithDefer\nBenchmarkFooWithDefer-8            \t43756006\t        27.57 ns&#47;op\nBenchmarkFooWithoutDefer\nBenchmarkFooWithoutDefer-8         \t71541520\t        17.22 ns&#47;op\nPASS\nok  \tdemo\t3.576s\n\nä¸¤ä¸ªå¸¦deferçš„å‡ ä¹æ²¡åŒºåˆ«äº†ã€‚\n","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1652691068,"ip_address":"","comment_id":345769,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"defer benchmarkçš„ä¾‹å­ä¸­ï¼Œå‡½æ•°sumæœ‰è¿”å›å€¼ï¼Œæ‰€æœ‰deferçš„æ—¶å€™æ”¾åœ¨é—­åŒ…é‡Œé¢ï¼Œå¦‚æœå‡½æ•°sumæ²¡æœ‰è¿”å›å€¼ï¼Œå¯ä»¥ç›´æ¥æ”¾åœ¨deferåé¢defer sum()ï¼Œæˆ‘åšäº†ä¸€ä¸‹benchmarkï¼Œå‘ç°è¿˜æ˜¯æ”¾é—­åŒ…é‡Œé¢æ¯”è¾ƒå¿«ï¼Œgoè¯­è¨€å¯¹é—­åŒ…æœ‰ä»€ä¹ˆä¼˜åŒ–å—ï¼Œæ„Ÿè§‰ç”¨é—­åŒ…ä¼šå¤šå‹ä¸€æ¬¡æ ˆï¼Œä½†æ˜¯åè€Œæ›´å¿«ï¼Œè€å¸ˆèƒ½è§£ç­”ä¸€ä¸‹å—ï¼Ÿ\n&#47;&#47; defer_test.go\npackage main\n\nimport &quot;testing&quot;\n\nfunc sum(max int) {\n    total := 0\n    for i := 0; i &lt; max; i++ {\n        total += i\n    }\n}\n\nfunc fooWithDeferNoClosure() {\n\tdefer sum(10)\n}\n\nfunc fooWithDefer() {\n    defer func() {\n        sum(10)\n    }()\n}\nfunc fooWithoutDefer() {\n    sum(10)\n}\n\nfunc BenchmarkFooWithDeferNoClosure(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        fooWithDeferNoClosure()\n    }\n}\n\nfunc BenchmarkFooWithDefer(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        fooWithDefer()\n    }\n}\nfunc BenchmarkFooWithoutDefer(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        fooWithoutDefer()\n    }\n}\n\nbenchmarkç»“æœï¼š\n$ go test -bench . defer_test.go\ngoos: linux\ngoarch: amd64\ncpu: Intel Core Processor (Broadwell, IBRS)\nBenchmarkFooWithDeferNoClosure-2   \t67386957\t        18.59 ns&#47;op\nBenchmarkFooWithDefer-2                  \t80693001\t        15.45 ns&#47;op\nBenchmarkFooWithoutDefer-2             \t100000000\t11.03 ns&#47;op\nPASS\nok  \tcommand-line-arguments\t3.665s","like_count":2,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572282,"discussion_content":"func fooWithDefer() {\n    defer func() {\n        sum(10)\n    }()\n}\n\nè¿™ä¸ªå‡½æ•°ç®—ä¸ä¸Šé—­åŒ…å•Šã€‚deferåªæ˜¯æ³¨å†Œäº†ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œè¯¥å‡½æ•°å¹¶æ²¡æœ‰æ•æ‰fooWithDeferå‡½æ•°çš„æœ¬åœ°å˜é‡ã€‚\n\næˆ‘æ€€ç–‘func fooWithDefer() {\n    defer func() {\n        sum(10)\n    }()\n}\nä¸­çš„sum(10)è°ƒç”¨è¢«ç›´æ¥å†…è”ä¼˜åŒ–äº†(inline)ï¼Œè€Œä¸æ˜¯åšå‡½æ•°è°ƒç”¨äº†ã€‚\n\nåŒç†fooWithoutDeferå¯¹sumçš„è°ƒç”¨ä¹Ÿå¾ˆå¤§å¯èƒ½è¢«inlineäº†ã€‚\n\næˆ‘åœ¨macosä¸Šå…³é—­inlineå’Œä¼˜åŒ–çš„ç»“æœï¼š\n\n$go test -gcflags &#34;-N -l&#34; -v -bench .\ngoos: darwin\ngoarch: amd64\npkg: demo\ncpu: Intel(R) Core(TM) i5-8257U CPU @ 1.40GHz\nBenchmarkFooWithDeferNoClosure\nBenchmarkFooWithDeferNoClosure-8   \t37973526\t        27.60 ns/op\nBenchmarkFooWithDefer\nBenchmarkFooWithDefer-8            \t43756006\t        27.57 ns/op\nBenchmarkFooWithoutDefer\nBenchmarkFooWithoutDefer-8         \t71541520\t        17.22 ns/op\nPASS\nok  \tdemo\t3.576s\n\nä¸¤ä¸ªå¸¦deferçš„å‡ ä¹æ²¡åŒºåˆ«äº†ã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652691068,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":338018,"user_name":"Rayjun","can_delete":false,"product_type":"c1","uid":1002514,"ip_address":"","ucode":"61A3D1A3D03569","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4c/12/f0c145d4.jpg","comment_is_top":false,"comment_ctime":1647239134,"is_pvip":false,"replies":[{"id":123617,"content":"å¥½é—®é¢˜ï¼panicæ˜¯ä¸€ä¸ªstack unwindingçš„è¿‡ç¨‹ï¼Œè€Œæ¯ä¸ªgoroutineéƒ½æœ‰è‡ªå·±çš„æ‰§è¡Œæ ˆã€‚ä¸€ä¸ªgoroutineæ‰§è¡Œæ ˆä¸Šå‘ç”Ÿçš„panicï¼Œå¦å¤–ä¸€ä¸ªgoroutineè‚¯å®šæ˜¯ä¸çŸ¥æ™“çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1647321802,"ip_address":"","comment_id":338018,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"è€å¸ˆï¼Œå’¨è¯¢ä¸€ä¸ªé—®é¢˜ï¼Œpanic æ— æ³•è·¨ goroutine æ•è·ï¼Œè¿™ä¸ªæ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556347,"discussion_content":"å¥½é—®é¢˜ï¼panicæ˜¯ä¸€ä¸ªstack unwindingçš„è¿‡ç¨‹ï¼Œè€Œæ¯ä¸ªgoroutineéƒ½æœ‰è‡ªå·±çš„æ‰§è¡Œæ ˆã€‚ä¸€ä¸ªgoroutineæ‰§è¡Œæ ˆä¸Šå‘ç”Ÿçš„panicï¼Œå¦å¤–ä¸€ä¸ªgoroutineè‚¯å®šæ˜¯ä¸çŸ¥æ™“çš„ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1647321802,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1002514,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/4c/12/f0c145d4.jpg","nickname":"Rayjun","note":"","ucode":"61A3D1A3D03569","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":556631,"discussion_content":"å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œé‚£ä¹ˆä¸€ä¸ª goroutine ä¸­çš„ panic æ˜¯æ€ä¹ˆåšåˆ°è®©æ•´ä¸ªç¨‹åºå´©æºƒçš„å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647430467,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":556347,"ip_address":"","group_id":0},"score":556631,"extra":""}]}]},{"had_liked":false,"id":336953,"user_name":"é£é“ƒ","can_delete":false,"product_type":"c1","uid":2633228,"ip_address":"","ucode":"999A26CC937C78","user_header":"https://static001.geekbang.org/account/avatar/00/28/2e/0c/b6180a5f.jpg","comment_is_top":false,"comment_ctime":1646488489,"is_pvip":false,"replies":[{"id":123235,"content":"å—¯ï¼Œè¿™æ ·å†™å°±æŠŠé”™è¯¯å¤„ç†ä¸å¼‚å¸¸å¤„ç†æ··æ·†äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1646722245,"ip_address":"","comment_id":336953,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"è‡ªå·±ä»¥å‰å†™ä»£ç ï¼Œæ€»æ˜¯åœ¨panicæŠŠé”™è¯¯ä¿¡æ¯åŒ…è¿›å»\nif !=nil{\n    panic(fmt.Errorf(&quot;err is:%s\\n&quot;,err))\n}","like_count":2,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556347,"discussion_content":"å¥½é—®é¢˜ï¼panicæ˜¯ä¸€ä¸ªstack unwindingçš„è¿‡ç¨‹ï¼Œè€Œæ¯ä¸ªgoroutineéƒ½æœ‰è‡ªå·±çš„æ‰§è¡Œæ ˆã€‚ä¸€ä¸ªgoroutineæ‰§è¡Œæ ˆä¸Šå‘ç”Ÿçš„panicï¼Œå¦å¤–ä¸€ä¸ªgoroutineè‚¯å®šæ˜¯ä¸çŸ¥æ™“çš„ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1647321802,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1002514,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/4c/12/f0c145d4.jpg","nickname":"Rayjun","note":"","ucode":"61A3D1A3D03569","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":556631,"discussion_content":"å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œé‚£ä¹ˆä¸€ä¸ª goroutine ä¸­çš„ panic æ˜¯æ€ä¹ˆåšåˆ°è®©æ•´ä¸ªç¨‹åºå´©æºƒçš„å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647430467,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":556347,"ip_address":"","group_id":0},"score":556631,"extra":""}]}]},{"had_liked":false,"id":328614,"user_name":"Geek_7jzyrf","can_delete":false,"product_type":"c1","uid":1780608,"ip_address":"","ucode":"604202E40E9AA5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/pibibkbticCqnwDJkluy5QAWibesJ7vxLbQIG5sewicnjyjYFD9S4Oq9XYxxmjWTQTtFaNeYN6MpXwNAqfe8vUib21PA/132","comment_is_top":false,"comment_ctime":1640789355,"is_pvip":false,"replies":[{"id":120424,"content":"i=3åï¼Œå¾ªç¯ä½“æ‰§è¡Œï¼Œç„¶åæ‰§è¡Œå¾ªç¯åç½®è¯­å¥i++ï¼Œè¿™æ ·iå°±ä¸º4äº†å•Šã€‚ä¹‹ådeferred å‡½æ•°è¢«æ‰§è¡Œï¼Œè¾“å‡ºçš„iä¸º4ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1641997053,"ip_address":"","comment_id":328614,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"è€å¸ˆï¼Œåœ¨  â€œæ³¨æ„ defer å…³é”®å­—åé¢è¡¨è¾¾å¼çš„æ±‚å€¼æ—¶æœºâ€ è¿™ä¸ªçŸ¥è¯†ç‚¹ï¼Œ\n func foo3(){\n\t for i :=0; i &lt;=3; i++{\n\t\t defer func(){  \n\t\t\t fmt.Println(i)\n\n\t\t }()\n\t }\n }\nè¾“å‡ºç»“æœä¸ºå•¥æ˜¯4ï¼Ÿ i æœ€å¤§åº”è¯¥åªèƒ½å–åˆ°3å§ï¼Ÿæ²¡çœ‹æ˜ç™½ï¼Œå¸Œæœ›è€å¸ˆè¿›ä¸€æ­¥è§£ç­”ä¸‹ï¼","like_count":2,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555016,"discussion_content":"å—¯ï¼Œè¿™æ ·å†™å°±æŠŠé”™è¯¯å¤„ç†ä¸å¼‚å¸¸å¤„ç†æ··æ·†äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646722245,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":325332,"user_name":"aoe","can_delete":false,"product_type":"c1","uid":1121758,"ip_address":"","ucode":"1C6201EDB4E954","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","comment_is_top":false,"comment_ctime":1638926098,"is_pvip":false,"replies":[{"id":118593,"content":"æ˜¯çš„ã€‚ä½†å¤æ´»äº†ï¼Œç¨‹åºä¹Ÿç»“æŸäº†:)ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1639560727,"ip_address":"","comment_id":325332,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"åœ¨ main å‡½æ•°å¼€å§‹åŠ ä¸Šè¿™æ ·çš„ä»£ç ï¼Œå¯ä»¥ä» panic ä¸­æ— é™å¤æ´»äº†\ndefer func() {\n\tif e := recover(); e != nil {\n\t\tfmt.Println(&quot;recover the panic:&quot;, e)\n\t}\n}()","like_count":2,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538942,"discussion_content":"æ˜¯çš„ã€‚ä½†å¤æ´»äº†ï¼Œç¨‹åºä¹Ÿç»“æŸäº†:)ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1639560727,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":325207,"user_name":"Bynow","can_delete":false,"product_type":"c1","uid":2735072,"ip_address":"","ucode":"1E4F3ADD65CF18","user_header":"https://static001.geekbang.org/account/avatar/00/29/bb/e0/c7cd5170.jpg","comment_is_top":false,"comment_ctime":1638863486,"is_pvip":false,"replies":[{"id":118586,"content":"ä½ æ¢æˆç›´æ¥åœ¨å‘½ä»¤è¡Œæ‰§è¡Œè¿™ä¸ªç¨‹åºå‘¢ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1639558549,"ip_address":"","comment_id":325207,"utype":1}],"discussion_count":6,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"æˆ‘ç”¨çš„goland ï¼Œæ–‡ä¸­æ›´æ–°åçš„barä»£ç ï¼šæˆ‘çš„ç¼–è¾‘å™¨ç»ˆç«¯è¾“å‡ºæ˜¯\ncall main\ncall foo\ncall bar\nexit foo\nexit main\nrecover the panic: panic occurs in bar\n\nä½†æ˜¯æˆ‘æ‰“æ–­ç‚¹è°ƒè¯•çš„ç¡®æ˜¯æŒ‰ç…§è€å¸ˆçš„é‚£æ ·å»æ‰§è¡Œå’Œè¾“å‡ºçš„ï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538942,"discussion_content":"æ˜¯çš„ã€‚ä½†å¤æ´»äº†ï¼Œç¨‹åºä¹Ÿç»“æŸäº†:)ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1639560727,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":375169,"user_name":"å¤§å¹´ç³•","can_delete":false,"product_type":"c1","uid":2687098,"ip_address":"å±±ä¸œ","ucode":"D776067299F785","user_header":"https://static001.geekbang.org/account/avatar/00/29/00/7a/791d0f5e.jpg","comment_is_top":false,"comment_ctime":1685003433,"is_pvip":false,"replies":[{"id":136929,"content":"æˆ‘ç†è§£ï¼šæ‰¿æ‹…ä¸€éƒ¨åˆ†ç›¸ä¼¼çš„èŒè´£ï¼Œä½†ä¸ç­‰ä»·å“¦ã€‚ææ„å‡½æ•°åœ¨å¯¹è±¡é”€æ¯æ—¶è‡ªåŠ¨è°ƒç”¨ï¼Œdeferåªæ˜¯é’ˆå¯¹å‡½æ•°æˆ–æ–¹æ³•ã€‚goæ²¡æœ‰ææ„å‡½æ•°è¿™ä¸€è¯´ã€‚å¦‚æœè¦åœ¨ä¸€ä¸ªheapå¯¹è±¡è¢«gcé‡Šæ”¾æ—¶åšä¸€äº›äº‹æƒ…ï¼Œå¯ä»¥ç”¨runtime.SetFinalizerï¼Œä¸è¿‡è¿™æ˜¯é«˜çº§ç”¨æ³•ï¼Œå¤§å¤šæ•°æƒ…å†µæ— éœ€è€ƒè™‘ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1685068799,"ip_address":"åŒ—äº¬","comment_id":375169,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"æŠŠdeferä½œä¸ºææ„å‡½æ•°ä½¿ç”¨?","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538929,"discussion_content":"ä½ æ¢æˆç›´æ¥åœ¨å‘½ä»¤è¡Œæ‰§è¡Œè¿™ä¸ªç¨‹åºå‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639558549,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2735072,"avatar":"https://static001.geekbang.org/account/avatar/00/29/bb/e0/c7cd5170.jpg","nickname":"Bynow","note":"","ucode":"1E4F3ADD65CF18","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":545509,"discussion_content":"\nprintLnå’Œfmt.PrintLn æ··ç”¨ä¼šå¯¼è‡´è¾“å‡ºé¡ºåºä¸ä¸€è‡´","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641979639,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":538929,"ip_address":"","group_id":0},"score":545509,"extra":""}]},{"author":{"id":1248326,"avatar":"https://static001.geekbang.org/account/avatar/00/13/0c/46/dfe32cf4.jpg","nickname":"å¤šé€‰å‚æ•°","note":"","ucode":"B2294D80AB075F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537349,"discussion_content":"è¿™ä¸ªæˆ‘è§‰å¾—æ›´å¤šæ˜¯è¾“å‡ºçš„é—®é¢˜ï¼Œè€Œä¸æ˜¯æ‰§è¡Œçš„é—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639040533,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2049562,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/aQmhiahazRFUA4W3r1hdxxreSB5Pl54IwAJ8bwN6j02lzicydWAfPFbWx1LSFtzXH8MkI0jUKjlpUtmQBoZ4kReA/132","nickname":"Geek_99b47c","note":"","ucode":"D25E22C1D84E09","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537091,"discussion_content":"æ˜¯çš„ã€‚æ··åˆç”¨è¾“å‡ºé¡ºåºä¼šä¸ä¸€æ ·ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638955040,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2735072,"avatar":"https://static001.geekbang.org/account/avatar/00/29/bb/e0/c7cd5170.jpg","nickname":"Bynow","note":"","ucode":"1E4F3ADD65CF18","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536880,"discussion_content":"printLnå’Œfmt.PrintLn æ··ç”¨ä¼šå¯¼è‡´è¾“å‡ºé¡ºåºä¸ä¸€è‡´","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638886245,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2735072,"avatar":"https://static001.geekbang.org/account/avatar/00/29/bb/e0/c7cd5170.jpg","nickname":"Bynow","note":"","ucode":"1E4F3ADD65CF18","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536764,"discussion_content":"æˆ‘æŠŠè¾“å‡ºç»Ÿä¸€éƒ½æ”¹æˆfmt.Printlnå°±å¯ä»¥äº†ã€‚ä¸çŸ¥é“æ˜¯ä¸ºå•¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638864512,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":374793,"user_name":"Geek_73c432","can_delete":false,"product_type":"c1","uid":2869118,"ip_address":"å¹¿ä¸œ","ucode":"3E11EB02B14DE0","user_header":"","comment_is_top":false,"comment_ctime":1684426108,"is_pvip":false,"replies":[{"id":136765,"content":"Goçš„panicè¯­ä¹‰å°±æ˜¯è¿™æ ·çš„ï¼ˆgo specï¼‰ï¼šâ€œWhile executing a function F, an explicit call to panic or a run-time panic terminates the execution of F. Any functions deferred by F are then executed as usual. Next, any deferred functions run by F&#39;s caller are run, and so on up to any deferred by the top-level function in the executing goroutineâ€ ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1684502071,"ip_address":"è¾½å®","comment_id":374793,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"æœ‰æ²¡æœ‰å¯èƒ½ deferred å‡½æ•°æœ¬èº«æ‰§è¡Œçš„æ—¶å€™ä¼šå¼•å‘å¼‚å¸¸ï¼ˆpanicï¼‰å‘¢ï¼Ÿ\n\nç»æµ‹è¯•ï¼ˆgo version go1.20.2 linux&#47;amd64ï¼‰åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…¶ä»–å·²ç»æ³¨å†Œçš„ deferred å‡½æ•°è¿˜ä¼šæ­£å¸¸æ‰§è¡Œï¼Œä¾‹å¦‚è¿™ä¸ªæ•è· panic å¹¶æ¢å¤çš„ deferred å‡½æ•°\n\nfunc deferTest() {\n        &#47;&#47; func1\n\tdefer func() {\n\t\tif err := recover(); err != nil {\n\t\t\tfmt.Println(&quot;recover the panic: &quot;, err)\n\t\t}\n\t}()\n\tdefer func() {\n\t\tfmt.Println(&quot;exit... with panic&quot;)\n\t\tpanic(&quot;whatever...&quot;)\n\t}()\n}\n\nä¸ºå•¥å·²ç»è§¦å‘ panickingï¼Œfunc1 è¿˜ä¼šæ‰§è¡Œå‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":619405,"discussion_content":"æˆ‘ç†è§£ï¼šæ‰¿æ‹…ä¸€éƒ¨åˆ†ç›¸ä¼¼çš„èŒè´£ï¼Œä½†ä¸ç­‰ä»·å“¦ã€‚ææ„å‡½æ•°åœ¨å¯¹è±¡é”€æ¯æ—¶è‡ªåŠ¨è°ƒç”¨ï¼Œdeferåªæ˜¯é’ˆå¯¹å‡½æ•°æˆ–æ–¹æ³•ã€‚goæ²¡æœ‰ææ„å‡½æ•°è¿™ä¸€è¯´ã€‚å¦‚æœè¦åœ¨ä¸€ä¸ªheapå¯¹è±¡è¢«gcé‡Šæ”¾æ—¶åšä¸€äº›äº‹æƒ…ï¼Œå¯ä»¥ç”¨runtime.SetFinalizerï¼Œä¸è¿‡è¿™æ˜¯é«˜çº§ç”¨æ³•ï¼Œå¤§å¤šæ•°æƒ…å†µæ— éœ€è€ƒè™‘ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1685068799,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371396,"user_name":"Geek_0d5d37","can_delete":false,"product_type":"c1","uid":3522132,"ip_address":"å››å·","ucode":"1BB4AEF1328C64","user_header":"","comment_is_top":false,"comment_ctime":1679899925,"is_pvip":false,"replies":[{"id":135517,"content":"1. deferæ³¨å†Œæ—¶æ±‚å€¼çš„æ˜¯å…¶æ³¨å†Œçš„å‡½æ•°çš„å‚æ•°ï¼Œè¿™é‡Œæ˜¯defer func() {....}ï¼Œåé¢çš„åŒ¿åå‡½æ•°æ²¡æœ‰å‚æ•°ã€‚\n2. é—­åŒ…ç¯å¢ƒæŒ‡çš„æ˜¯åŒ…è£¹(wrap)é—­åŒ…å‡½æ•°çš„é‚£ä¸ªå‡½æ•°ï¼Œè¿™é‡Œå°±æ˜¯foo3ï¼Œè€Œä¸æ˜¯å¾ªç¯ä½“ã€‚å¾ªç¯ä½“æ˜¯foo3å†…æ‰§è¡Œçš„é€»è¾‘ï¼Œä¸æ˜¯é—­åŒ…ç¯å¢ƒã€‚å› æ­¤é—­åŒ…å‡½æ•°æ•æ‰åˆ°çš„foo3çš„å˜é‡å°±æ˜¯å¾ªç¯å˜é‡iï¼š\n\nè¿™é‡Œç”¨ä¸€ä¸ªfoo3çš„ç­‰ä»·å‡½æ•°æ¥è¡¨ç¤ºï¼Œä½ å¯èƒ½å°±ç†è§£äº†ï¼š\n\nfunc foo3() {\n       i := 0\n       for i = 0; i &lt;= 3; i++ {\n        defer func() {\n            fmt.Println(i)\n        }()\n    }\n}","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1679926099,"ip_address":"è¾½å®","comment_id":371396,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"ä½œè€…å›å¤: é¦–å…ˆç¡®è®¤ä¸€ä¸‹å¯¹forè¯­ä¹‰çš„ç†è§£ã€‚é’ˆå¯¹for i := 0; i &lt;= 3; i++ {}å¾ªç¯ï¼Œ å½“i=3æ—¶ï¼Œforè¿›å…¥å¾ªç¯ä½“ï¼Œç„¶åæ‰§è¡Œåç½®è¯­å¥i++ï¼Œä¹‹åiçš„å€¼ä¸º4. ç„¶åå†åˆ¤æ–­å¾ªç¯æ¡ä»¶i&lt;=3ï¼Œä¸æ»¡è¶³ï¼Œforå¾ªç¯ç»“æŸã€‚äºæ˜¯içš„æœ€ç»ˆå€¼å°±æ˜¯4ã€‚\n\ndeferæ‰§è¡Œæ—¶ï¼Œiæ˜¯4ï¼Œé—­åŒ…å¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªiï¼Œæ‰€ä»¥éƒ½è¾“å‡º4ã€‚\n\nè€å¸ˆæ‚¨å¥½ã€‚ ä¸Šé¢æ˜¯æ‚¨å›ç­”çš„ä¸€ä¸ªé—®é¢˜ï¼ŒåŸºäºè¿™ä¸ªé—®é¢˜æˆ‘æœ‰ç‚¹ä¸ç†è§£\n\næ—¢ç„¶defer åé¢çš„å‡½æ•°æ˜¯åœ¨æ‰§è¡Œdeferçš„æ—¶å€™æ³¨å†Œå¹¶æ±‚å€¼ï¼Œé‚£é—­åŒ…å¼•ç”¨çš„ä¹Ÿæ˜¯å½“å‰ç¯å¢ƒçš„å˜é‡ã€‚ ä¹Ÿå°±æ˜¯for æ¯æ¬¡æ‰§è¡Œå¾ªç¯ä½“æ—¶æ³¨å†Œçš„é—­åŒ…ç¯å¢ƒï¼Œ æœ€åå»¶è¿Ÿè°ƒç”¨ä¹Ÿæ˜¯æ³¨å†Œæ—¶å¯¹åº”çš„é—­åŒ…ç¯å¢ƒçš„iå€¼ï¼Œ è€Œä¸æ˜¯å¾ªç¯åˆ¤æ–­ä¸æ»¡è¶³æ¡ä»¶ç»“æŸå¾ªç¯åè¿è¡Œçš„ç¯å¢ƒã€‚  è¿™æ˜¯ä¸æ˜ç™½çš„ç‚¹ï¼Œéº»çƒ¦è€å¸ˆæœ‰ç©ºæ—¶è®²è§£ä¸‹","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":618749,"discussion_content":"Goçš„panicè¯­ä¹‰å°±æ˜¯è¿™æ ·çš„ï¼ˆgo specï¼‰ï¼šâ€œWhile executing a function F, an explicit call to panic or a run-time panic terminates the execution of F. Any functions deferred by F are then executed as usual. Next, any deferred functions run by F&#39;s caller are run, and so on up to any deferred by the top-level function in the executing goroutineâ€ ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1684502071,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":365569,"user_name":"geektime_zpf","can_delete":false,"product_type":"c1","uid":1041743,"ip_address":"åŒ—äº¬","ucode":"FD61BCAD02CA54","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e5/4f/731ef2c1.jpg","comment_is_top":false,"comment_ctime":1672791171,"is_pvip":true,"replies":[{"id":133167,"content":"å°±æ˜¯å½“ç¨‹åºæŒ‡ä»¤æ‰§è¡Œåˆ°defer xxxxé‚£ä¸€è¡Œæ—¶ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1672809214,"ip_address":"åŒ—äº¬","comment_id":365569,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"&quot;defer å…³é”®å­—åé¢çš„è¡¨è¾¾å¼ï¼Œæ˜¯åœ¨å°† deferred å‡½æ•°æ³¨å†Œåˆ° deferred å‡½æ•°æ ˆçš„æ—¶å€™è¿›è¡Œæ±‚å€¼çš„&quot;\nè€å¸ˆä½ å¥½ï¼Œè¯·é—®defferedå‡½æ•°æ³¨å†Œåˆ°å‡½æ•°æ ˆçš„æ—¶æœºå…·ä½“æ˜¯ä»€ä¹ˆï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":611103,"discussion_content":"1. deferæ³¨å†Œæ—¶æ±‚å€¼çš„æ˜¯å…¶æ³¨å†Œçš„å‡½æ•°çš„å‚æ•°ï¼Œè¿™é‡Œæ˜¯defer func() {....}ï¼Œåé¢çš„åŒ¿åå‡½æ•°æ²¡æœ‰å‚æ•°ã€‚\n2. é—­åŒ…ç¯å¢ƒæŒ‡çš„æ˜¯åŒ…è£¹(wrap)é—­åŒ…å‡½æ•°çš„é‚£ä¸ªå‡½æ•°ï¼Œè¿™é‡Œå°±æ˜¯foo3ï¼Œè€Œä¸æ˜¯å¾ªç¯ä½“ã€‚å¾ªç¯ä½“æ˜¯foo3å†…æ‰§è¡Œçš„é€»è¾‘ï¼Œä¸æ˜¯é—­åŒ…ç¯å¢ƒã€‚å› æ­¤é—­åŒ…å‡½æ•°æ•æ‰åˆ°çš„foo3çš„å˜é‡å°±æ˜¯å¾ªç¯å˜é‡iï¼š\n\nè¿™é‡Œç”¨ä¸€ä¸ªfoo3çš„ç­‰ä»·å‡½æ•°æ¥è¡¨ç¤ºï¼Œä½ å¯èƒ½å°±ç†è§£äº†ï¼š\n\nfunc foo3() {\n       i := 0\n       for i = 0; i &lt;= 3; i++ {\n        defer func() {\n            fmt.Println(i)\n        }()\n    }\n}","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679926099,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3522132,"avatar":"","nickname":"Geek_0d5d37","note":"","ucode":"1BB4AEF1328C64","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":611164,"discussion_content":"æ„Ÿè°¢è€å¸ˆçš„ç»†å¿ƒå›ç­”ï¼Œå¯¹é—­åŒ…çš„ç†è§£åˆæ·±å…¥ä¸€äº›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679969704,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å››å·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":348978,"user_name":"å®¥æ™“","can_delete":false,"product_type":"c1","uid":2528776,"ip_address":"","ucode":"14473AB22CE7FC","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/LN7qpRLUGO2IHMnbDuF4YEsd9PxdFHAumWsHE8AhibeQUryIfgsQZ3JIZswVcCRkVSaelhFiatCZ6wpQFoLBLVFA/132","comment_is_top":false,"comment_ctime":1655619314,"is_pvip":false,"replies":[{"id":127023,"content":"æˆ‘åœ¨è‡ªå·±æœºå™¨ä¸Šç”¨go 1.18.3è·‘äº†ä¸€ä¸‹ï¼š\n\n$go test -bench . defer_test.go\ngoos: darwin\ngoarch: amd64\ncpu: Intel(R) Core(TM) i5-8257U CPU @ 1.40GHz\nBenchmarkFooWithDefer-8      \t196703528\t         6.086 ns&#47;op\nBenchmarkFooWithoutDefer-8   \t309812937\t         3.840 ns&#47;op\nPASS\nok  \tcommand-line-arguments\t3.408s\n\nç›¸å¯¹äºæ–‡ä¸­çš„go 1.17çš„ç»“æœçš„ç¡®æœ‰äº›å·®å¼‚ã€‚ä½†è€ƒè™‘åˆ°æµ‹è¯•æ‰§è¡Œçš„ç¯å¢ƒå¹¶éç‹¬å ï¼Œæœ‰å¾ˆå¤šå½±å“å› ç´ ï¼Œå› æ­¤ï¼Œä¸èƒ½æ–­å®šæ˜¯go 1.18.3å¸¦æ¥çš„æ€§èƒ½å›é€€ã€‚\n\nä»go 1.18.3çš„milestoneä¸­çš„issue listæ¥çœ‹ï¼Œä¼¼ä¹æ²¡æœ‰å“ªä¸ªä¸deferæœ‰å…³ã€‚\n\nhttps:&#47;&#47;github.com&#47;golang&#47;go&#47;issues?q=milestone%3AGo1.18.3+label%3ACherryPickApproved\n\n","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1655700721,"ip_address":"","comment_id":348978,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"go çš„ç‰ˆæœ¬1.18.3, deferçš„æ€§èƒ½ä¸‹é™äº†ï¼Œè¿™æ˜¯æœ‰ä»€ä¹ˆå¤§çš„å˜åŠ¨å—ï¼Ÿ\n\ngo test -bench . defer_test.go\n\ngoos: darwin\ngoarch: amd64\ncpu: Intel(R) Core(TM) i5-1038NG7 CPU @ 2.00GHz\nBenchmarkFooWithDefer-8         191820978                6.144 ns&#47;op\nBenchmarkFooWithoutDefer-8      527924869                2.245 ns&#47;op\nPASS\nok      command-line-arguments  3.643s\n","like_count":1},{"had_liked":false,"id":347640,"user_name":"qiutian","can_delete":false,"product_type":"c1","uid":1313498,"ip_address":"","ucode":"99658A8E342498","user_header":"https://static001.geekbang.org/account/avatar/00/14/0a/da/dcf8f2b1.jpg","comment_is_top":false,"comment_ctime":1654243647,"is_pvip":false,"replies":[{"id":126779,"content":"ä¸¥æ ¼æ¥è¯´zooæ˜¯æ‰§è¡Œä¸åˆ°çš„ï¼Œå› ä¸ºpanicå‘ç”Ÿåœ¨zooå‰é¢ã€‚ä¸è¿‡ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†æ¼”ç¤ºè€Œæ•…æ„ç¼–å†™çš„ä¾‹å­ã€‚ä¸ç”¨å¤ªè¿‡è®¡è¾ƒ:)ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1654482082,"ip_address":"","comment_id":347640,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"æˆ‘çš„vscodeé™æ€æ£€æŸ¥å‡ºï¼šfunc zoo is unused (U1000)go-staticcheck\nä½†æ˜¯é€šè¿‡build æ„å»ºå’Œ è¿è¡Œæ˜¯å¯ä»¥å¾—åˆ°å’Œç›®æ ‡ç›¸åŒçš„ç»“æœçš„","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576603,"discussion_content":"æˆ‘åœ¨è‡ªå·±æœºå™¨ä¸Šç”¨go 1.18.3è·‘äº†ä¸€ä¸‹ï¼š\n\n$go test -bench . defer_test.go\ngoos: darwin\ngoarch: amd64\ncpu: Intel(R) Core(TM) i5-8257U CPU @ 1.40GHz\nBenchmarkFooWithDefer-8      \t196703528\t         6.086 ns/op\nBenchmarkFooWithoutDefer-8   \t309812937\t         3.840 ns/op\nPASS\nok  \tcommand-line-arguments\t3.408s\n\nç›¸å¯¹äºæ–‡ä¸­çš„go 1.17çš„ç»“æœçš„ç¡®æœ‰äº›å·®å¼‚ã€‚ä½†è€ƒè™‘åˆ°æµ‹è¯•æ‰§è¡Œçš„ç¯å¢ƒå¹¶éç‹¬å ï¼Œæœ‰å¾ˆå¤šå½±å“å› ç´ ï¼Œå› æ­¤ï¼Œä¸èƒ½æ–­å®šæ˜¯go 1.18.3å¸¦æ¥çš„æ€§èƒ½å›é€€ã€‚\n\nä»go 1.18.3çš„milestoneä¸­çš„issue listæ¥çœ‹ï¼Œä¼¼ä¹æ²¡æœ‰å“ªä¸ªä¸deferæœ‰å…³ã€‚\n\nhttps://github.com/golang/go/issues?q=milestone%3AGo1.18.3+label%3ACherryPickApproved\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655700722,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":346032,"user_name":"Junior Programmer","can_delete":false,"product_type":"c1","uid":2395539,"ip_address":"","ucode":"C56FF19934512E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/tVrFvKWxQAuL7DE911OmlcqnfEkBnx14dBmCdI8eOx6ziaQB4Pgml65tcIDO4ePfW5yPTyAxGovYQmXLZHAPe2Q/132","comment_is_top":false,"comment_ctime":1652779753,"is_pvip":false,"replies":[{"id":126260,"content":"é‡æ–°æ¸©ä¹ ä¸€ä¸‹ç¬¬19è®²ä¸­å…³äºforå¾ªç¯è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä½ å°±èƒ½æ˜ç™½äº†:)ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1652822426,"ip_address":"","comment_id":346032,"utype":1}],"discussion_count":0,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"è€å¸ˆæ‚¨å¥½,å¯¹äºdeferå‚æ•°æ±‚å€¼æ—¶æœºæœ‰ä¸€ç‚¹ç–‘æƒ‘ï¼Œfunc foo1() { for i := 0; i &lt;= 3; i++ { defer fmt.Println(i) }}è¿™ä¸ªiå‚æ•°ï¼Œä¼ å…¥åˆ°fmt.Printlinä¸­ä¸æ˜¯åº”è¯¥æ˜¯1å¼€å§‹çš„å—ï¼Œç„¶åæ ¹æ®deferæ‰§è¡Œæ—¶å…ˆè¿›åå‡ºåŸåˆ™,åº”è¯¥æ˜¯4,3,2,1,ä½†æ˜¯æˆ‘åœ¨æœ¬åœ°è¿è¡Œçš„æ˜¯3,2,1,0ï¼Œä¹Ÿå°±æ˜¯è¯´deferå‚æ•°ä¼ å…¥çš„æ—¶æœºï¼Œè¿˜æ²¡æœ‰æ‰§è¡Œi++ï¼Œè¿™ä¸ªæ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ","like_count":1},{"had_liked":false,"id":343840,"user_name":"mikewoo","can_delete":false,"product_type":"c1","uid":1118888,"ip_address":"","ucode":"9AE90E05048DE1","user_header":"https://static001.geekbang.org/account/avatar/00/11/12/a8/8aaf13e0.jpg","comment_is_top":false,"comment_ctime":1651074025,"is_pvip":true,"replies":[{"id":125587,"content":"é¦–å…ˆç¡®è®¤ä¸€ä¸‹å¯¹forè¯­ä¹‰çš„ç†è§£ã€‚é’ˆå¯¹for i := 0; i &lt;= 3; i++ {}å¾ªç¯ï¼Œ å½“i=3æ—¶ï¼Œforè¿›å…¥å¾ªç¯ä½“ï¼Œç„¶åæ‰§è¡Œåç½®è¯­å¥i++ï¼Œä¹‹åiçš„å€¼ä¸º4. ç„¶åå†åˆ¤æ–­å¾ªç¯æ¡ä»¶i&lt;=3ï¼Œä¸æ»¡è¶³ï¼Œforå¾ªç¯ç»“æŸã€‚äºæ˜¯içš„æœ€ç»ˆå€¼å°±æ˜¯4ã€‚\n\ndeferæ‰§è¡Œæ—¶ï¼Œiæ˜¯4ï¼Œé—­åŒ…å¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªiï¼Œæ‰€ä»¥éƒ½è¾“å‡º4ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1651136940,"ip_address":"","comment_id":343840,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"è€å¸ˆï¼Œè¿™ç¯‡æ–‡ç« ç»™äº†æˆ‘å¾ˆå¤šæ–°çš„ç†è§£ï¼Œæ”¶è·æ»¡æ»¡ã€‚è¯¾ç¨‹ä¸­â€œå½“ foo3 è¿”å›åï¼Œdeferred å‡½æ•°è¢«è°ƒåº¦æ‰§è¡Œæ—¶ï¼Œä¸Šè¿°å‹å…¥æ ˆçš„ deferred å‡½æ•°å°†ä»¥ LIFO æ¬¡åºå‡ºæ ˆæ‰§è¡Œã€‚åŒ¿åå‡½æ•°ä¼šä»¥é—­åŒ…çš„æ–¹å¼è®¿é—®å¤–å›´å‡½æ•°çš„å˜é‡ iï¼Œå¹¶é€šè¿‡ Println è¾“å‡º i çš„å€¼ï¼Œæ­¤æ—¶ i çš„å€¼ä¸º 4ã€‚â€ä¸ºä»€ä¹ˆè¾“å‡ºçš„ç»“æœéƒ½æ˜¯4ï¼Œè¿™ä¸ªä¸æ˜¯å¾ˆç†è§£ï¼Œèƒ½å¦å¸®å¿™å†è§£é‡Šä¸€ä¸‹ï¼Œè°¢è°¢ã€‚","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":568442,"discussion_content":"é¦–å…ˆç¡®è®¤ä¸€ä¸‹å¯¹forè¯­ä¹‰çš„ç†è§£ã€‚é’ˆå¯¹for i := 0; i &lt;= 3; i++ {}å¾ªç¯ï¼Œ å½“i=3æ—¶ï¼Œforè¿›å…¥å¾ªç¯ä½“ï¼Œç„¶åæ‰§è¡Œåç½®è¯­å¥i++ï¼Œä¹‹åiçš„å€¼ä¸º4. ç„¶åå†åˆ¤æ–­å¾ªç¯æ¡ä»¶i&lt;=3ï¼Œä¸æ»¡è¶³ï¼Œforå¾ªç¯ç»“æŸã€‚äºæ˜¯içš„æœ€ç»ˆå€¼å°±æ˜¯4ã€‚\n\ndeferæ‰§è¡Œæ—¶ï¼Œiæ˜¯4ï¼Œé—­åŒ…å¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªiï¼Œæ‰€ä»¥éƒ½è¾“å‡º4ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651136940,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":339386,"user_name":"William Ning","can_delete":false,"product_type":"c1","uid":1592279,"ip_address":"","ucode":"4DB8D05E69E5F3","user_header":"https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg","comment_is_top":false,"comment_ctime":1648051464,"is_pvip":false,"replies":[{"id":124082,"content":"ğŸ’ª","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1648107970,"ip_address":"","comment_id":339386,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"å¤§å¡ï¼Œç»§ç»­å­¦ä¹ ï¼Œæ€è€ƒä¸­ï½ï½","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":568442,"discussion_content":"é¦–å…ˆç¡®è®¤ä¸€ä¸‹å¯¹forè¯­ä¹‰çš„ç†è§£ã€‚é’ˆå¯¹for i := 0; i &lt;= 3; i++ {}å¾ªç¯ï¼Œ å½“i=3æ—¶ï¼Œforè¿›å…¥å¾ªç¯ä½“ï¼Œç„¶åæ‰§è¡Œåç½®è¯­å¥i++ï¼Œä¹‹åiçš„å€¼ä¸º4. ç„¶åå†åˆ¤æ–­å¾ªç¯æ¡ä»¶i&lt;=3ï¼Œä¸æ»¡è¶³ï¼Œforå¾ªç¯ç»“æŸã€‚äºæ˜¯içš„æœ€ç»ˆå€¼å°±æ˜¯4ã€‚\n\ndeferæ‰§è¡Œæ—¶ï¼Œiæ˜¯4ï¼Œé—­åŒ…å¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªiï¼Œæ‰€ä»¥éƒ½è¾“å‡º4ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651136940,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328175,"user_name":"ç¾Šç¾Š","can_delete":false,"product_type":"c1","uid":1162597,"ip_address":"","ucode":"B220CE8D1CA5DA","user_header":"https://static001.geekbang.org/account/avatar/00/11/bd/65/fbdf4fc1.jpg","comment_is_top":false,"comment_ctime":1640588869,"is_pvip":false,"replies":[{"id":120402,"content":"å¯¹çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1641995491,"ip_address":"","comment_id":328175,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"å¯¹äºè‡ªå®šä¹‰çš„å‡½æ•°æˆ–æ–¹æ³•ï¼Œdefer å¯ä»¥ç»™ä¸æ— æ¡ä»¶çš„æ”¯æŒï¼Œä½†æ˜¯å¯¹äºæœ‰è¿”å›å€¼çš„è‡ªå®šä¹‰å‡½æ•°æˆ–æ–¹æ³•ï¼Œè¿”å›å€¼ä¼šåœ¨ deferred å‡½æ•°è¢«è°ƒåº¦æ‰§è¡Œçš„æ—¶å€™è¢«è‡ªåŠ¨ä¸¢å¼ƒã€‚  æ˜¯æŒ‡deferè¯­å¥åé¢çš„å‡½æ•°çš„è¿”å›å€¼ä¼šè¢«ä¸¢å¼ƒä¹ˆï¼Ÿä¸‹é¢åŒ¿åå‡½æ•°çš„è¿”å›å€¼2æ²¡æœ‰æ¥å—è€…ï¼Œreturnäº†ä¹Ÿæ²¡å•¥ç”¨ï¼Œå¯ä»¥è¿™ä¹ˆç†è§£ä¹ˆï¼Ÿ\nfunc bar() {\n\tdefer func() int {\n\t\tfmt.Println(&quot;defer func in bar&quot;)\n\t\treturn 2\n\t}()\n\tfmt.Println(&quot;call bar&quot;)\n\tfmt.Println(&quot;exit bar&quot;)\n}","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558142,"discussion_content":"ğŸ’ª","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648107970,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324954,"user_name":"ç½—æ°","can_delete":false,"product_type":"c1","uid":1320487,"ip_address":"","ucode":"96BAFAA147341F","user_header":"https://static001.geekbang.org/account/avatar/00/14/26/27/eba94899.jpg","comment_is_top":false,"comment_ctime":1638754806,"is_pvip":false,"replies":[{"id":117953,"content":"å—¯å—¯ï¼Œå¦‚æœ‰é—®é¢˜ï¼Œéšæ—¶äº¤æµã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1638827577,"ip_address":"","comment_id":324954,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"å…³äº defer æˆ‘è¿˜è¦å¥½å¥½çœ‹çœ‹ï¼Œä¸€ç›´éƒ½æ²¡æ€ä¹ˆç†è§£é€å½»","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545552,"discussion_content":"å¯¹çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641995491,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":393861,"user_name":"Geek_73c432","can_delete":false,"product_type":"c1","uid":2869118,"ip_address":"å¹¿ä¸œ","ucode":"3E11EB02B14DE0","user_header":"","comment_is_top":false,"comment_ctime":1725117613,"is_pvip":false,"replies":[{"id":143130,"content":"æ ‡å‡†åº“æ˜¯goç”¨æˆ·ä¾èµ–çš„åº•å±‚åº“ï¼Œåœ¨è¿™ä¸ªå±‚é¢å¦‚æœå‘ç°recoverä¹Ÿæ²¡æœ‰ä»»ä½•æ„ä¹‰çš„é”™è¯¯ï¼Œé‚£ä»–ä¼šè®¤ä¸ºè¿˜æ˜¯fail fastæœ€å¥½ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1726441201,"ip_address":"è¾½å®","comment_id":393861,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"è€å¸ˆå¥½ï¼Œæˆ‘åœ¨é˜…è¯»æ ‡å‡†åº“çš„ä¸€äº›ä¾‹å­çš„æ—¶å€™å‘ç°ï¼Œå½“ caller æ¥æ”¶åˆ°ä¸€ä¸ª error æ—¶ï¼Œæƒ¯ç”¨æ³•æ˜¯ä½¿ç”¨ log.Fatal&#47;log.Fatalf æ‰“å°è¿™ä¸ª errorï¼Œè¿™å°†å¯¼è‡´æ‰§è¡Œ os.Exit(1)ï¼Œè¿™æ ·ä¸ä¼šæ‰§è¡Œ deferred å‡½æ•°ã€‚ä¾‹å¦‚ï¼š\n\nctx, stop := signal.NotifyContext(context.Background(), os.Interrupt)\ndefer stop()\n\np, err := os.FindProcess(os.Getpid())\nif err != nil {\n  log.Fatal(err)\n}\n\n...\n\nè¿™æ®µä»£ç ä¸­ï¼Œå¦‚æœ os.FindProcess è°ƒç”¨è¿”å› errorï¼Œstop å‡½æ•°å°†ä¸ä¼šè¢«æ‰§è¡Œã€‚å¦‚æœæ¢æˆ log.Panicf(err) çš„è¯ stop å‡½æ•°ä¼šè¢«æ‰§è¡Œã€‚\n\nä½†æ˜¯è¿™ç§åœºæ™¯ä½¿ç”¨ Panic æœ‰ç‚¹æ··æ·†é”™è¯¯å’Œå¼‚å¸¸çš„æ¦‚å¿µ\n\nä½ æ€ä¹ˆçœ‹å¾…è¿™ä¸¤ç§å¤„ç†æ–¹å¼ï¼Ÿæ›´æ¨èå“ªä¸€ç§å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536579,"discussion_content":"å—¯å—¯ï¼Œå¦‚æœ‰é—®é¢˜ï¼Œéšæ—¶äº¤æµã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638827577,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":391980,"user_name":"å±±æ·±æ²¾è¡£","can_delete":false,"product_type":"c1","uid":1314754,"ip_address":"é‡åº†","ucode":"2BBECDF549E3E8","user_header":"https://static001.geekbang.org/account/avatar/00/14/0f/c2/de176336.jpg","comment_is_top":false,"comment_ctime":1719568178,"is_pvip":false,"replies":[{"id":142522,"content":"ä½ ç”¨çš„æ˜¯Go 1.22ç‰ˆæœ¬å§ã€‚Go 1.22ç‰ˆæœ¬ä¿®æ”¹äº†loopvarçš„è¯­ä¹‰ã€‚ä¿®æ”¹åï¼Œä¸Šé¢ä»£ç ç›¸å½“äºGo 1.22ç‰ˆæœ¬ä¹‹å‰çš„å¦‚ä¸‹ä»£ç ï¼š\n\nfunc foo3() {\n\tfor i := 0; i &lt;= 3; i++ {\n                i := i\n\t\tdefer func() {\n\t\t\tfmt.Println(i)\n\t\t}()\n\t}\n}","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1719928464,"ip_address":"è¾½å®","comment_id":391980,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"func foo3() {\n\tfor i := 0; i &lt;= 3; i++ {\n\t\tdefer func() {\n\t\t\tfmt.Println(i)\n\t\t}()\n\t}\n}\n\nè¿™ä¸ªå‡½æ•°è¾“å‡ºçš„ç»“æœæ˜¯3 2 1 0 æ€ä¹ˆå’Œè€å¸ˆçš„ä¸ä¸€æ ·å‘¢","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":651183,"discussion_content":"æ ‡å‡†åº“æ˜¯goç”¨æˆ·ä¾èµ–çš„åº•å±‚åº“ï¼Œåœ¨è¿™ä¸ªå±‚é¢å¦‚æœå‘ç°recoverä¹Ÿæ²¡æœ‰ä»»ä½•æ„ä¹‰çš„é”™è¯¯ï¼Œé‚£ä»–ä¼šè®¤ä¸ºè¿˜æ˜¯fail fastæœ€å¥½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1726441201,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":390656,"user_name":"äººè¨€æœ‰åŠ›","can_delete":false,"product_type":"c1","uid":1690736,"ip_address":"æµ™æ±Ÿ","ucode":"3708FBBFB641FE","user_header":"https://static001.geekbang.org/account/avatar/00/19/cc/70/64045bc0.jpg","comment_is_top":false,"comment_ctime":1715874099,"is_pvip":false,"replies":[{"id":142123,"content":"å­¦ä¹ è¿‡ç¨‹ä¸­å¤šåšæ€»ç»“æ˜¯å¾ˆå¥½çš„ä¹ æƒ¯ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1716345200,"ip_address":"åŒ—äº¬","comment_id":390656,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"æœ¬èŠ‚æ ¸å¿ƒä»‹ç»äº†panicã€recoverã€deferä¸‰ä¸ªå…³é”®å­—å¯¹ç¨‹åºå¼‚å¸¸å’Œå¥å£®æ€§çš„å¸®åŠ©\n1. panicæ˜¯æ‰‹åŠ¨è§¦å‘ç¨‹åºå´©æºƒï¼Œå¸¸ç”¨äºæ–­è¨€\n2.recoveræ˜¯æ¢å¤panicï¼Œä½†æ˜¯éœ€è¦åœ¨deferå…³é”®å­—åï¼Œdeferedå‡½æ•°ä¼šåœ¨æœ¬ä½“å‡½æ•°é€€å‡ºå‰æŒ‰LIFOå£°æ˜çš„é¡ºåºæ‰§è¡Œ\n3.deferæ˜¯æœ‰æ€§èƒ½å¼€é”€çš„ï¼Œä½†æ˜¯å¾ˆé€‚åˆä½œä¸ºèµ„æºé‡Šæ”¾å’Œå¼‚å¸¸å¤„ç†ï¼Œç±»ä¼¼JAVAçš„finallyã€‚ä½†æ˜¯ä¸è¦æ»¥ç”¨ï¼Œä¸€äº›checked exceptionåº”è¯¥å½“ä½œé”™è¯¯è¿›è¡Œè¿”å›å€¼å¤„ç†","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":647363,"discussion_content":"ä½ ç”¨çš„æ˜¯Go 1.22ç‰ˆæœ¬å§ã€‚Go 1.22ç‰ˆæœ¬ä¿®æ”¹äº†loopvarçš„è¯­ä¹‰ã€‚ä¿®æ”¹åï¼Œä¸Šé¢ä»£ç ç›¸å½“äºGo 1.22ç‰ˆæœ¬ä¹‹å‰çš„å¦‚ä¸‹ä»£ç ï¼š\n\nfunc foo3() {\n\tfor i := 0; i &lt;= 3; i++ {\n                i := i\n\t\tdefer func() {\n\t\t\tfmt.Println(i)\n\t\t}()\n\t}\n}","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1719928464,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":348978,"user_name":"å®¥æ™“","can_delete":false,"product_type":"c1","uid":2528776,"ip_address":"","ucode":"14473AB22CE7FC","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/LN7qpRLUGO2IHMnbDuF4YEsd9PxdFHAumWsHE8AhibeQUryIfgsQZ3JIZswVcCRkVSaelhFiatCZ6wpQFoLBLVFA/132","comment_is_top":false,"comment_ctime":1655619314,"is_pvip":false,"replies":[{"id":127023,"content":"æˆ‘åœ¨è‡ªå·±æœºå™¨ä¸Šç”¨go 1.18.3è·‘äº†ä¸€ä¸‹ï¼š\n\n$go test -bench . defer_test.go\ngoos: darwin\ngoarch: amd64\ncpu: Intel(R) Core(TM) i5-8257U CPU @ 1.40GHz\nBenchmarkFooWithDefer-8      \t196703528\t         6.086 ns&#47;op\nBenchmarkFooWithoutDefer-8   \t309812937\t         3.840 ns&#47;op\nPASS\nok  \tcommand-line-arguments\t3.408s\n\nç›¸å¯¹äºæ–‡ä¸­çš„go 1.17çš„ç»“æœçš„ç¡®æœ‰äº›å·®å¼‚ã€‚ä½†è€ƒè™‘åˆ°æµ‹è¯•æ‰§è¡Œçš„ç¯å¢ƒå¹¶éç‹¬å ï¼Œæœ‰å¾ˆå¤šå½±å“å› ç´ ï¼Œå› æ­¤ï¼Œä¸èƒ½æ–­å®šæ˜¯go 1.18.3å¸¦æ¥çš„æ€§èƒ½å›é€€ã€‚\n\nä»go 1.18.3çš„milestoneä¸­çš„issue listæ¥çœ‹ï¼Œä¼¼ä¹æ²¡æœ‰å“ªä¸ªä¸deferæœ‰å…³ã€‚\n\nhttps:&#47;&#47;github.com&#47;golang&#47;go&#47;issues?q=milestone%3AGo1.18.3+label%3ACherryPickApproved\n\n","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1655700721,"ip_address":"","comment_id":348978,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"go çš„ç‰ˆæœ¬1.18.3, deferçš„æ€§èƒ½ä¸‹é™äº†ï¼Œè¿™æ˜¯æœ‰ä»€ä¹ˆå¤§çš„å˜åŠ¨å—ï¼Ÿ\n\ngo test -bench . defer_test.go\n\ngoos: darwin\ngoarch: amd64\ncpu: Intel(R) Core(TM) i5-1038NG7 CPU @ 2.00GHz\nBenchmarkFooWithDefer-8         191820978                6.144 ns&#47;op\nBenchmarkFooWithoutDefer-8      527924869                2.245 ns&#47;op\nPASS\nok      command-line-arguments  3.643s\n","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576603,"discussion_content":"æˆ‘åœ¨è‡ªå·±æœºå™¨ä¸Šç”¨go 1.18.3è·‘äº†ä¸€ä¸‹ï¼š\n\n$go test -bench . defer_test.go\ngoos: darwin\ngoarch: amd64\ncpu: Intel(R) Core(TM) i5-8257U CPU @ 1.40GHz\nBenchmarkFooWithDefer-8      \t196703528\t         6.086 ns/op\nBenchmarkFooWithoutDefer-8   \t309812937\t         3.840 ns/op\nPASS\nok  \tcommand-line-arguments\t3.408s\n\nç›¸å¯¹äºæ–‡ä¸­çš„go 1.17çš„ç»“æœçš„ç¡®æœ‰äº›å·®å¼‚ã€‚ä½†è€ƒè™‘åˆ°æµ‹è¯•æ‰§è¡Œçš„ç¯å¢ƒå¹¶éç‹¬å ï¼Œæœ‰å¾ˆå¤šå½±å“å› ç´ ï¼Œå› æ­¤ï¼Œä¸èƒ½æ–­å®šæ˜¯go 1.18.3å¸¦æ¥çš„æ€§èƒ½å›é€€ã€‚\n\nä»go 1.18.3çš„milestoneä¸­çš„issue listæ¥çœ‹ï¼Œä¼¼ä¹æ²¡æœ‰å“ªä¸ªä¸deferæœ‰å…³ã€‚\n\nhttps://github.com/golang/go/issues?q=milestone%3AGo1.18.3+label%3ACherryPickApproved\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655700722,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":347640,"user_name":"qiutian","can_delete":false,"product_type":"c1","uid":1313498,"ip_address":"","ucode":"99658A8E342498","user_header":"https://static001.geekbang.org/account/avatar/00/14/0a/da/dcf8f2b1.jpg","comment_is_top":false,"comment_ctime":1654243647,"is_pvip":false,"replies":[{"id":126779,"content":"ä¸¥æ ¼æ¥è¯´zooæ˜¯æ‰§è¡Œä¸åˆ°çš„ï¼Œå› ä¸ºpanicå‘ç”Ÿåœ¨zooå‰é¢ã€‚ä¸è¿‡ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†æ¼”ç¤ºè€Œæ•…æ„ç¼–å†™çš„ä¾‹å­ã€‚ä¸ç”¨å¤ªè¿‡è®¡è¾ƒ:)ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1654482082,"ip_address":"","comment_id":347640,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"æˆ‘çš„vscodeé™æ€æ£€æŸ¥å‡ºï¼šfunc zoo is unused (U1000)go-staticcheck\nä½†æ˜¯é€šè¿‡build æ„å»ºå’Œ è¿è¡Œæ˜¯å¯ä»¥å¾—åˆ°å’Œç›®æ ‡ç›¸åŒçš„ç»“æœçš„","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":574938,"discussion_content":"ä¸¥æ ¼æ¥è¯´zooæ˜¯æ‰§è¡Œä¸åˆ°çš„ï¼Œå› ä¸ºpanicå‘ç”Ÿåœ¨zooå‰é¢ã€‚ä¸è¿‡ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†æ¼”ç¤ºè€Œæ•…æ„ç¼–å†™çš„ä¾‹å­ã€‚ä¸ç”¨å¤ªè¿‡è®¡è¾ƒ:)ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654482082,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":346032,"user_name":"Junior Programmer","can_delete":false,"product_type":"c1","uid":2395539,"ip_address":"","ucode":"C56FF19934512E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/tVrFvKWxQAuL7DE911OmlcqnfEkBnx14dBmCdI8eOx6ziaQB4Pgml65tcIDO4ePfW5yPTyAxGovYQmXLZHAPe2Q/132","comment_is_top":false,"comment_ctime":1652779753,"is_pvip":false,"replies":[{"id":126260,"content":"é‡æ–°æ¸©ä¹ ä¸€ä¸‹ç¬¬19è®²ä¸­å…³äºforå¾ªç¯è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä½ å°±èƒ½æ˜ç™½äº†:)ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1652822426,"ip_address":"","comment_id":346032,"utype":1}],"discussion_count":0,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"è€å¸ˆæ‚¨å¥½,å¯¹äºdeferå‚æ•°æ±‚å€¼æ—¶æœºæœ‰ä¸€ç‚¹ç–‘æƒ‘ï¼Œfunc foo1() { for i := 0; i &lt;= 3; i++ { defer fmt.Println(i) }}è¿™ä¸ªiå‚æ•°ï¼Œä¼ å…¥åˆ°fmt.Printlinä¸­ä¸æ˜¯åº”è¯¥æ˜¯1å¼€å§‹çš„å—ï¼Œç„¶åæ ¹æ®deferæ‰§è¡Œæ—¶å…ˆè¿›åå‡ºåŸåˆ™,åº”è¯¥æ˜¯4,3,2,1,ä½†æ˜¯æˆ‘åœ¨æœ¬åœ°è¿è¡Œçš„æ˜¯3,2,1,0ï¼Œä¹Ÿå°±æ˜¯è¯´deferå‚æ•°ä¼ å…¥çš„æ—¶æœºï¼Œè¿˜æ²¡æœ‰æ‰§è¡Œi++ï¼Œè¿™ä¸ªæ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ","like_count":1},{"had_liked":false,"id":343840,"user_name":"mikewoo","can_delete":false,"product_type":"c1","uid":1118888,"ip_address":"","ucode":"9AE90E05048DE1","user_header":"https://static001.geekbang.org/account/avatar/00/11/12/a8/8aaf13e0.jpg","comment_is_top":false,"comment_ctime":1651074025,"is_pvip":true,"replies":[{"id":125587,"content":"é¦–å…ˆç¡®è®¤ä¸€ä¸‹å¯¹forè¯­ä¹‰çš„ç†è§£ã€‚é’ˆå¯¹for i := 0; i &lt;= 3; i++ {}å¾ªç¯ï¼Œ å½“i=3æ—¶ï¼Œforè¿›å…¥å¾ªç¯ä½“ï¼Œç„¶åæ‰§è¡Œåç½®è¯­å¥i++ï¼Œä¹‹åiçš„å€¼ä¸º4. ç„¶åå†åˆ¤æ–­å¾ªç¯æ¡ä»¶i&lt;=3ï¼Œä¸æ»¡è¶³ï¼Œforå¾ªç¯ç»“æŸã€‚äºæ˜¯içš„æœ€ç»ˆå€¼å°±æ˜¯4ã€‚\n\ndeferæ‰§è¡Œæ—¶ï¼Œiæ˜¯4ï¼Œé—­åŒ…å¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªiï¼Œæ‰€ä»¥éƒ½è¾“å‡º4ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1651136940,"ip_address":"","comment_id":343840,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"è€å¸ˆï¼Œè¿™ç¯‡æ–‡ç« ç»™äº†æˆ‘å¾ˆå¤šæ–°çš„ç†è§£ï¼Œæ”¶è·æ»¡æ»¡ã€‚è¯¾ç¨‹ä¸­â€œå½“ foo3 è¿”å›åï¼Œdeferred å‡½æ•°è¢«è°ƒåº¦æ‰§è¡Œæ—¶ï¼Œä¸Šè¿°å‹å…¥æ ˆçš„ deferred å‡½æ•°å°†ä»¥ LIFO æ¬¡åºå‡ºæ ˆæ‰§è¡Œã€‚åŒ¿åå‡½æ•°ä¼šä»¥é—­åŒ…çš„æ–¹å¼è®¿é—®å¤–å›´å‡½æ•°çš„å˜é‡ iï¼Œå¹¶é€šè¿‡ Println è¾“å‡º i çš„å€¼ï¼Œæ­¤æ—¶ i çš„å€¼ä¸º 4ã€‚â€ä¸ºä»€ä¹ˆè¾“å‡ºçš„ç»“æœéƒ½æ˜¯4ï¼Œè¿™ä¸ªä¸æ˜¯å¾ˆç†è§£ï¼Œèƒ½å¦å¸®å¿™å†è§£é‡Šä¸€ä¸‹ï¼Œè°¢è°¢ã€‚","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":574938,"discussion_content":"ä¸¥æ ¼æ¥è¯´zooæ˜¯æ‰§è¡Œä¸åˆ°çš„ï¼Œå› ä¸ºpanicå‘ç”Ÿåœ¨zooå‰é¢ã€‚ä¸è¿‡ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†æ¼”ç¤ºè€Œæ•…æ„ç¼–å†™çš„ä¾‹å­ã€‚ä¸ç”¨å¤ªè¿‡è®¡è¾ƒ:)ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654482082,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":339386,"user_name":"William Ning","can_delete":false,"product_type":"c1","uid":1592279,"ip_address":"","ucode":"4DB8D05E69E5F3","user_header":"https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg","comment_is_top":false,"comment_ctime":1648051464,"is_pvip":false,"replies":[{"id":124082,"content":"ğŸ’ª","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1648107970,"ip_address":"","comment_id":339386,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"å¤§å¡ï¼Œç»§ç»­å­¦ä¹ ï¼Œæ€è€ƒä¸­ï½ï½","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558142,"discussion_content":"ğŸ’ª","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648107970,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328175,"user_name":"ç¾Šç¾Š","can_delete":false,"product_type":"c1","uid":1162597,"ip_address":"","ucode":"B220CE8D1CA5DA","user_header":"https://static001.geekbang.org/account/avatar/00/11/bd/65/fbdf4fc1.jpg","comment_is_top":false,"comment_ctime":1640588869,"is_pvip":false,"replies":[{"id":120402,"content":"å¯¹çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1641995491,"ip_address":"","comment_id":328175,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"å¯¹äºè‡ªå®šä¹‰çš„å‡½æ•°æˆ–æ–¹æ³•ï¼Œdefer å¯ä»¥ç»™ä¸æ— æ¡ä»¶çš„æ”¯æŒï¼Œä½†æ˜¯å¯¹äºæœ‰è¿”å›å€¼çš„è‡ªå®šä¹‰å‡½æ•°æˆ–æ–¹æ³•ï¼Œè¿”å›å€¼ä¼šåœ¨ deferred å‡½æ•°è¢«è°ƒåº¦æ‰§è¡Œçš„æ—¶å€™è¢«è‡ªåŠ¨ä¸¢å¼ƒã€‚  æ˜¯æŒ‡deferè¯­å¥åé¢çš„å‡½æ•°çš„è¿”å›å€¼ä¼šè¢«ä¸¢å¼ƒä¹ˆï¼Ÿä¸‹é¢åŒ¿åå‡½æ•°çš„è¿”å›å€¼2æ²¡æœ‰æ¥å—è€…ï¼Œreturnäº†ä¹Ÿæ²¡å•¥ç”¨ï¼Œå¯ä»¥è¿™ä¹ˆç†è§£ä¹ˆï¼Ÿ\nfunc bar() {\n\tdefer func() int {\n\t\tfmt.Println(&quot;defer func in bar&quot;)\n\t\treturn 2\n\t}()\n\tfmt.Println(&quot;call bar&quot;)\n\tfmt.Println(&quot;exit bar&quot;)\n}","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545552,"discussion_content":"å¯¹çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641995491,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324954,"user_name":"ç½—æ°","can_delete":false,"product_type":"c1","uid":1320487,"ip_address":"","ucode":"96BAFAA147341F","user_header":"https://static001.geekbang.org/account/avatar/00/14/26/27/eba94899.jpg","comment_is_top":false,"comment_ctime":1638754806,"is_pvip":false,"replies":[{"id":117953,"content":"å—¯å—¯ï¼Œå¦‚æœ‰é—®é¢˜ï¼Œéšæ—¶äº¤æµã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1638827577,"ip_address":"","comment_id":324954,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"å…³äº defer æˆ‘è¿˜è¦å¥½å¥½çœ‹çœ‹ï¼Œä¸€ç›´éƒ½æ²¡æ€ä¹ˆç†è§£é€å½»","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536579,"discussion_content":"å—¯å—¯ï¼Œå¦‚æœ‰é—®é¢˜ï¼Œéšæ—¶äº¤æµã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638827577,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":393861,"user_name":"Geek_73c432","can_delete":false,"product_type":"c1","uid":2869118,"ip_address":"å¹¿ä¸œ","ucode":"3E11EB02B14DE0","user_header":"","comment_is_top":false,"comment_ctime":1725117613,"is_pvip":false,"replies":[{"id":143130,"content":"æ ‡å‡†åº“æ˜¯goç”¨æˆ·ä¾èµ–çš„åº•å±‚åº“ï¼Œåœ¨è¿™ä¸ªå±‚é¢å¦‚æœå‘ç°recoverä¹Ÿæ²¡æœ‰ä»»ä½•æ„ä¹‰çš„é”™è¯¯ï¼Œé‚£ä»–ä¼šè®¤ä¸ºè¿˜æ˜¯fail fastæœ€å¥½ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1726441201,"ip_address":"è¾½å®","comment_id":393861,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"è€å¸ˆå¥½ï¼Œæˆ‘åœ¨é˜…è¯»æ ‡å‡†åº“çš„ä¸€äº›ä¾‹å­çš„æ—¶å€™å‘ç°ï¼Œå½“ caller æ¥æ”¶åˆ°ä¸€ä¸ª error æ—¶ï¼Œæƒ¯ç”¨æ³•æ˜¯ä½¿ç”¨ log.Fatal&#47;log.Fatalf æ‰“å°è¿™ä¸ª errorï¼Œè¿™å°†å¯¼è‡´æ‰§è¡Œ os.Exit(1)ï¼Œè¿™æ ·ä¸ä¼šæ‰§è¡Œ deferred å‡½æ•°ã€‚ä¾‹å¦‚ï¼š\n\nctx, stop := signal.NotifyContext(context.Background(), os.Interrupt)\ndefer stop()\n\np, err := os.FindProcess(os.Getpid())\nif err != nil {\n  log.Fatal(err)\n}\n\n...\n\nè¿™æ®µä»£ç ä¸­ï¼Œå¦‚æœ os.FindProcess è°ƒç”¨è¿”å› errorï¼Œstop å‡½æ•°å°†ä¸ä¼šè¢«æ‰§è¡Œã€‚å¦‚æœæ¢æˆ log.Panicf(err) çš„è¯ stop å‡½æ•°ä¼šè¢«æ‰§è¡Œã€‚\n\nä½†æ˜¯è¿™ç§åœºæ™¯ä½¿ç”¨ Panic æœ‰ç‚¹æ··æ·†é”™è¯¯å’Œå¼‚å¸¸çš„æ¦‚å¿µ\n\nä½ æ€ä¹ˆçœ‹å¾…è¿™ä¸¤ç§å¤„ç†æ–¹å¼ï¼Ÿæ›´æ¨èå“ªä¸€ç§å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":651183,"discussion_content":"æ ‡å‡†åº“æ˜¯goç”¨æˆ·ä¾èµ–çš„åº•å±‚åº“ï¼Œåœ¨è¿™ä¸ªå±‚é¢å¦‚æœå‘ç°recoverä¹Ÿæ²¡æœ‰ä»»ä½•æ„ä¹‰çš„é”™è¯¯ï¼Œé‚£ä»–ä¼šè®¤ä¸ºè¿˜æ˜¯fail fastæœ€å¥½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1726441201,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":391980,"user_name":"å±±æ·±æ²¾è¡£","can_delete":false,"product_type":"c1","uid":1314754,"ip_address":"é‡åº†","ucode":"2BBECDF549E3E8","user_header":"https://static001.geekbang.org/account/avatar/00/14/0f/c2/de176336.jpg","comment_is_top":false,"comment_ctime":1719568178,"is_pvip":false,"replies":[{"id":142522,"content":"ä½ ç”¨çš„æ˜¯Go 1.22ç‰ˆæœ¬å§ã€‚Go 1.22ç‰ˆæœ¬ä¿®æ”¹äº†loopvarçš„è¯­ä¹‰ã€‚ä¿®æ”¹åï¼Œä¸Šé¢ä»£ç ç›¸å½“äºGo 1.22ç‰ˆæœ¬ä¹‹å‰çš„å¦‚ä¸‹ä»£ç ï¼š\n\nfunc foo3() {\n\tfor i := 0; i &lt;= 3; i++ {\n                i := i\n\t\tdefer func() {\n\t\t\tfmt.Println(i)\n\t\t}()\n\t}\n}","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1719928464,"ip_address":"è¾½å®","comment_id":391980,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"func foo3() {\n\tfor i := 0; i &lt;= 3; i++ {\n\t\tdefer func() {\n\t\t\tfmt.Println(i)\n\t\t}()\n\t}\n}\n\nè¿™ä¸ªå‡½æ•°è¾“å‡ºçš„ç»“æœæ˜¯3 2 1 0 æ€ä¹ˆå’Œè€å¸ˆçš„ä¸ä¸€æ ·å‘¢","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":647363,"discussion_content":"ä½ ç”¨çš„æ˜¯Go 1.22ç‰ˆæœ¬å§ã€‚Go 1.22ç‰ˆæœ¬ä¿®æ”¹äº†loopvarçš„è¯­ä¹‰ã€‚ä¿®æ”¹åï¼Œä¸Šé¢ä»£ç ç›¸å½“äºGo 1.22ç‰ˆæœ¬ä¹‹å‰çš„å¦‚ä¸‹ä»£ç ï¼š\n\nfunc foo3() {\n\tfor i := 0; i &lt;= 3; i++ {\n                i := i\n\t\tdefer func() {\n\t\t\tfmt.Println(i)\n\t\t}()\n\t}\n}","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1719928464,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":390656,"user_name":"äººè¨€æœ‰åŠ›","can_delete":false,"product_type":"c1","uid":1690736,"ip_address":"æµ™æ±Ÿ","ucode":"3708FBBFB641FE","user_header":"https://static001.geekbang.org/account/avatar/00/19/cc/70/64045bc0.jpg","comment_is_top":false,"comment_ctime":1715874099,"is_pvip":false,"replies":[{"id":142123,"content":"å­¦ä¹ è¿‡ç¨‹ä¸­å¤šåšæ€»ç»“æ˜¯å¾ˆå¥½çš„ä¹ æƒ¯ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1716345200,"ip_address":"åŒ—äº¬","comment_id":390656,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"æœ¬èŠ‚æ ¸å¿ƒä»‹ç»äº†panicã€recoverã€deferä¸‰ä¸ªå…³é”®å­—å¯¹ç¨‹åºå¼‚å¸¸å’Œå¥å£®æ€§çš„å¸®åŠ©\n1. panicæ˜¯æ‰‹åŠ¨è§¦å‘ç¨‹åºå´©æºƒï¼Œå¸¸ç”¨äºæ–­è¨€\n2.recoveræ˜¯æ¢å¤panicï¼Œä½†æ˜¯éœ€è¦åœ¨deferå…³é”®å­—åï¼Œdeferedå‡½æ•°ä¼šåœ¨æœ¬ä½“å‡½æ•°é€€å‡ºå‰æŒ‰LIFOå£°æ˜çš„é¡ºåºæ‰§è¡Œ\n3.deferæ˜¯æœ‰æ€§èƒ½å¼€é”€çš„ï¼Œä½†æ˜¯å¾ˆé€‚åˆä½œä¸ºèµ„æºé‡Šæ”¾å’Œå¼‚å¸¸å¤„ç†ï¼Œç±»ä¼¼JAVAçš„finallyã€‚ä½†æ˜¯ä¸è¦æ»¥ç”¨ï¼Œä¸€äº›checked exceptionåº”è¯¥å½“ä½œé”™è¯¯è¿›è¡Œè¿”å›å€¼å¤„ç†","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":645544,"discussion_content":"å­¦ä¹ è¿‡ç¨‹ä¸­å¤šåšæ€»ç»“æ˜¯å¾ˆå¥½çš„ä¹ æƒ¯ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1716345200,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":390221,"user_name":"å‘æ¡æ©™","can_delete":false,"product_type":"c1","uid":3875922,"ip_address":"ä¸Šæµ·","ucode":"F52E4EB1F9A3C9","user_header":"https://static001.geekbang.org/account/avatar/00/3b/24/52/4e1f33d0.jpg","comment_is_top":false,"comment_ctime":1714790846,"is_pvip":false,"replies":[{"id":142008,"content":"ä½ æ˜¯ç”¨Go 1.22ç‰ˆæœ¬è¿è¡Œçš„å§ã€‚1.22ç‰ˆæœ¬ä¸­loopvarè¯­ä¹‰å‘ç”Ÿäº†å˜æ›´ï¼Œä»å¾ªç¯å˜é‡iä»per loop varå˜ä¸ºper iteration varäº†ã€‚æ‰€ä»¥æ¯æ¬¡è¿›å…¥å¾ªç¯ï¼Œé—­åŒ…æ•è·çš„éƒ½æ˜¯ä¸€ä¸ªæ–°å˜é‡iï¼Œä¸”è¯¥æ–°å˜é‡içš„å€¼ä¸ºå½“æ¬¡è¿­ä»£æ—¶çš„iå€¼ã€‚ç­‰ä»·äº1.22ç‰ˆæœ¬ä»¥å‰çš„å¦‚ä¸‹ä»£ç ï¼š\n\nfunc foo3() { \n    for i := 0; i &lt;= 3; i++ { \n        i := i\n        defer func() { \n            fmt.Println(i) \n        }   \n    }   \n}","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1715262161,"ip_address":"è¾½å®","comment_id":390221,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100093501,"comment_content":"foo3è¿è¡Œçš„ç»“æœä¹Ÿæ˜¯\n3\n2\n1\n0","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":644469,"discussion_content":"ä½ æ˜¯ç”¨Go 1.22ç‰ˆæœ¬è¿è¡Œçš„å§ã€‚1.22ç‰ˆæœ¬ä¸­loopvarè¯­ä¹‰å‘ç”Ÿäº†å˜æ›´ï¼Œä»å¾ªç¯å˜é‡iä»per loop varå˜ä¸ºper iteration varäº†ã€‚æ‰€ä»¥æ¯æ¬¡è¿›å…¥å¾ªç¯ï¼Œé—­åŒ…æ•è·çš„éƒ½æ˜¯ä¸€ä¸ªæ–°å˜é‡iï¼Œä¸”è¯¥æ–°å˜é‡içš„å€¼ä¸ºå½“æ¬¡è¿­ä»£æ—¶çš„iå€¼ã€‚ç­‰ä»·äº1.22ç‰ˆæœ¬ä»¥å‰çš„å¦‚ä¸‹ä»£ç ï¼š\n\nfunc foo3() { \n    for i := 0; i &lt;= 3; i++ { \n        i := i\n        defer func() { \n            fmt.Println(i) \n        }   \n    }   \n}","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1715262161,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":388725,"user_name":"å†’æ³¡é›ªç¢§ ğŸˆ","can_delete":false,"product_type":"c1","uid":1255745,"ip_address":"æ±Ÿè‹","ucode":"E4AB442B0167CF","user_header":"https://static001.geekbang.org/account/avatar/00/13/29/41/a413ca91.jpg","comment_is_top":false,"comment_ctime":1710773650,"is_pvip":false,"replies":[{"id":141531,"content":"å’Œåœ¨æ™®é€šå‡½æ•°ä¸­panicä¸€æ ·ï¼Œä¼šè‡ªä¸‹è€Œä¸Šèµ°ä¸€ä¸ªpanickingçš„è¿‡ç¨‹ï¼Œå¦‚æœæœ‰recoveræ•æ‰panicï¼Œå°±è¿›è¡Œrecoverï¼Œå¦‚æœæ²¡æœ‰ï¼Œä¼šæœ€ç»ˆå¯¼è‡´ç¨‹åºå¼‚å¸¸é€€å‡ºã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1711075245,"ip_address":"åŒ—äº¬","comment_id":388725,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100093501,"comment_content":"defer+logå¯ä»¥è¿½è¸ªè®°å½•ç¨‹åºè°ƒç”¨è·¯å¾„ã€‚\næˆ‘æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœåœ¨deferä¸­è¿›è¡Œpanicä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":387172,"user_name":"Geek_73c432","can_delete":false,"product_type":"c1","uid":2869118,"ip_address":"å¹¿ä¸œ","ucode":"3E11EB02B14DE0","user_header":"","comment_is_top":false,"comment_ctime":1706627722,"is_pvip":false,"replies":[{"id":141131,"content":"1. panicå¦‚æœæ²¡æœ‰è¢«æ¢å¤(recover)ï¼Œå°±ä¼šä¸€ç›´å‘ä¸Šä¼ å¯¼åˆ°mainå‡½æ•°ä¸­ï¼Œå¦‚æœä¸»goroutineä¹Ÿæ²¡æœ‰æ¢å¤è¯¥panicï¼Œé‚£ä¹ˆä¸»goroutineå°±ä¼šå› panicè€Œé€€å‡ºã€‚\n2. éå¸¸å¥½çš„é—®é¢˜ï¼Œæˆ‘æ¥å°è¯•å›ç­”ä¸€ä¸‹ã€‚\n\ndeferred å‡½æ•°ä¼šåœ¨å‡½æ•°returnåè¢«è°ƒç”¨ã€‚å› æ­¤barå‡½æ•°è¿™ä¸ªæ¯”è¾ƒå¥½ç†è§£ã€‚barå‡½æ•°ä½¿ç”¨äº†å…·åè¿”å›å€¼ã€‚è€Œdefered funcæ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œé—­åŒ…ä¸­ä½¿ç”¨äº†iè¿™è¿”å›å€¼å˜é‡ï¼Œå› æ­¤returnåï¼Œdeferred funcå¯¹è¿”å›å˜é‡içš„ä¿®æ”¹ä¼šæœ€ç»ˆåæ˜ åˆ°å‡½æ•°barçš„è¿”å›å€¼ä¸Šã€‚\n\nfooå‡½æ•°æ²¡æœ‰ä½¿ç”¨å…·åè¿”å›å€¼ï¼Œå…¶ä¸­çš„deferred funcä¿®æ”¹çš„æ˜¯å‡½æ•°ä½“å†…éƒ¨çš„æœ¬åœ°å˜é‡iã€‚å½“å‡½æ•°return iæ—¶ï¼Œå…¶å®æ˜¯å°†içš„å€¼(æ­¤æ—¶ä¸º1)copyåˆ°å‡½æ•°è¿”å›å€¼çš„å†…å­˜å—ä¸­ï¼Œæ­¤æ—¶è¿”å›å€¼ä¹Ÿä¸º1ã€‚returnåï¼Œdeferred funcè¢«æ‰§è¡Œï¼Œè€Œä¿®æ”¹çš„æ˜¯æœ¬åœ°å˜é‡iï¼Œä¸fooå‡½æ•°çš„è¿”å›å€¼å¹¶æ— å…³è”äº†ã€‚å› æ­¤æœ€ç»ˆè¿”å›å€¼å°±æ˜¯1\n\n\n","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1706959724,"ip_address":"è¾½å®","comment_id":387172,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100093501,"comment_content":"è€å¸ˆå¥½\n\n1. æ¯ä¸ª goroutine éƒ½æœ‰è‡ªå·±çš„æ‰§è¡Œæ ˆï¼Œå½“ä¸€ä¸ª goroutine ä¸­å‘ç”Ÿ panic æ—¶ï¼Œå¦ä¸€ä¸ª goroutine å¹¶ä¸èƒ½æ„ŸçŸ¥ï¼Œé‚£ä¸ºä»€ä¹ˆä¸» goroutine ä¼šé€€å‡ºå‘¢ï¼Ÿ\n\n2. ä¸‹é¢ä¸¤ä¸ªå‡½æ•°ä¸ºä»€ä¹ˆè¿”å›å€¼ä¸ä¸€è‡´å‘¢ï¼Ÿ\nfunc foo() int {\n\ti := 1\n\n\tdefer func() {\n\t\ti++\n\t}()\n\n\treturn i\n}\n\nfunc bar() (i int) {\n\ti = 1\n\n\tdefer func() {\n\t\ti++\n\t}()\n\n\treturn\n}\n\nfunc main() {\n\tfmt.Println(foo()) &#47;&#47; 1\n\tfmt.Println(bar()) &#47;&#47; 2\n}\n\n3. deferred å‡½æ•°æ˜¯åœ¨ return è¯­å¥ï¼ˆå‡å¦‚å‡½æ•°æœ‰ï¼‰ä¹‹å‰è¿˜æ˜¯ä¹‹åæ‰§è¡Œå‘¢ï¼Ÿé—®é¢˜ 3 å¯èƒ½è·Ÿé—®é¢˜ 2 æœ‰å…³","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":644469,"discussion_content":"ä½ æ˜¯ç”¨Go 1.22ç‰ˆæœ¬è¿è¡Œçš„å§ã€‚1.22ç‰ˆæœ¬ä¸­loopvarè¯­ä¹‰å‘ç”Ÿäº†å˜æ›´ï¼Œä»å¾ªç¯å˜é‡iä»per loop varå˜ä¸ºper iteration varäº†ã€‚æ‰€ä»¥æ¯æ¬¡è¿›å…¥å¾ªç¯ï¼Œé—­åŒ…æ•è·çš„éƒ½æ˜¯ä¸€ä¸ªæ–°å˜é‡iï¼Œä¸”è¯¥æ–°å˜é‡içš„å€¼ä¸ºå½“æ¬¡è¿­ä»£æ—¶çš„iå€¼ã€‚ç­‰ä»·äº1.22ç‰ˆæœ¬ä»¥å‰çš„å¦‚ä¸‹ä»£ç ï¼š\n\nfunc foo3() { \n    for i := 0; i &lt;= 3; i++ { \n        i := i\n        defer func() { \n            fmt.Println(i) \n        }   \n    }   \n}","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1715262161,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":376353,"user_name":"lesserror","can_delete":false,"product_type":"c1","uid":1351076,"ip_address":"å¹¿ä¸œ","ucode":"25A54D1165FCF6","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","comment_is_top":false,"comment_ctime":1686729205,"is_pvip":false,"replies":[{"id":137242,"content":"è¿™ä¸€è®²é‡Œæœ‰ä¸“é—¨è¯´deferç”¨æ³•çš„æ®µè½ï¼Œé‡Œé¢æ˜ç¡®è¯´äº†deferçš„åŠŸç”¨ã€ä½¿ç”¨æ–¹æ³•çš„å•Šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1686792546,"ip_address":"åŒ—äº¬","comment_id":376353,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100093501,"comment_content":"Tony bai è€å¸ˆï¼Œå¾ˆå¤šæ–‡ç« ä¸­è®² defer åé¢å¿…é¡»æ¥ä¸€ä¸ª å‡½æ•°æˆ–è€…æ–¹æ³•çš„è°ƒç”¨ï¼Œæ–‡ä¸­çš„ç”¨æ³•æ˜¯è¿™æ ·çš„ï¼Œä½†æ˜¯å¥½åƒæ²¡æœ‰ç‰¹æ„å¼ºè°ƒè¿™ä¸€æ¦‚å¿µã€‚","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":640023,"discussion_content":"å’Œåœ¨æ™®é€šå‡½æ•°ä¸­panicä¸€æ ·ï¼Œä¼šè‡ªä¸‹è€Œä¸Šèµ°ä¸€ä¸ªpanickingçš„è¿‡ç¨‹ï¼Œå¦‚æœæœ‰recoveræ•æ‰panicï¼Œå°±è¿›è¡Œrecoverï¼Œå¦‚æœæ²¡æœ‰ï¼Œä¼šæœ€ç»ˆå¯¼è‡´ç¨‹åºå¼‚å¸¸é€€å‡ºã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1711075245,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328378,"user_name":"ä¸€ä¸ªå­¦å‘˜","can_delete":false,"product_type":"c1","uid":1566227,"ip_address":"","ucode":"427049337F6565","user_header":"https://static001.geekbang.org/account/avatar/00/17/e6/13/d93997aa.jpg","comment_is_top":false,"comment_ctime":1640696396,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100093501,"comment_content":"è®²çš„å¤ªæ¸…æ™°äº†ã€‚","like_count":1},{"had_liked":false,"id":338829,"user_name":"Kepler","can_delete":false,"product_type":"c1","uid":1214303,"ip_address":"","ucode":"0C9CA3DB8B3CF0","user_header":"https://static001.geekbang.org/account/avatar/00/12/87/5f/6bf8b74a.jpg","comment_is_top":false,"comment_ctime":1647755991,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100093501,"comment_content":"deferçš„å¸¸ç”¨ç”¨é€”ï¼š\n1.æ¥å£ç»Ÿä¸€ä¸ŠæŠ¥ï¼›\n2.æ‰“å°è€—æ—¶ï¼Œä¸è¿‡è¿™ç‚¹ä¹Ÿå¯ä»¥å½’åˆ°1ä¸­ï¼›","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":636779,"discussion_content":"1. panicå¦‚æœæ²¡æœ‰è¢«æ¢å¤(recover)ï¼Œå°±ä¼šä¸€ç›´å‘ä¸Šä¼ å¯¼åˆ°mainå‡½æ•°ä¸­ï¼Œå¦‚æœä¸»goroutineä¹Ÿæ²¡æœ‰æ¢å¤è¯¥panicï¼Œé‚£ä¹ˆä¸»goroutineå°±ä¼šå› panicè€Œé€€å‡ºã€‚\n2. éå¸¸å¥½çš„é—®é¢˜ï¼Œæˆ‘æ¥å°è¯•å›ç­”ä¸€ä¸‹ã€‚\n\ndeferred å‡½æ•°ä¼šåœ¨å‡½æ•°returnåè¢«è°ƒç”¨ã€‚å› æ­¤barå‡½æ•°è¿™ä¸ªæ¯”è¾ƒå¥½ç†è§£ã€‚barå‡½æ•°ä½¿ç”¨äº†å…·åè¿”å›å€¼ã€‚è€Œdefered funcæ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œé—­åŒ…ä¸­ä½¿ç”¨äº†iè¿™è¿”å›å€¼å˜é‡ï¼Œå› æ­¤returnåï¼Œdeferred funcå¯¹è¿”å›å˜é‡içš„ä¿®æ”¹ä¼šæœ€ç»ˆåæ˜ åˆ°å‡½æ•°barçš„è¿”å›å€¼ä¸Šã€‚\n\nfooå‡½æ•°æ²¡æœ‰ä½¿ç”¨å…·åè¿”å›å€¼ï¼Œå…¶ä¸­çš„deferred funcä¿®æ”¹çš„æ˜¯å‡½æ•°ä½“å†…éƒ¨çš„æœ¬åœ°å˜é‡iã€‚å½“å‡½æ•°return iæ—¶ï¼Œå…¶å®æ˜¯å°†içš„å€¼(æ­¤æ—¶ä¸º1)copyåˆ°å‡½æ•°è¿”å›å€¼çš„å†…å­˜å—ä¸­ï¼Œæ­¤æ—¶è¿”å›å€¼ä¹Ÿä¸º1ã€‚returnåï¼Œdeferred funcè¢«æ‰§è¡Œï¼Œè€Œä¿®æ”¹çš„æ˜¯æœ¬åœ°å˜é‡iï¼Œä¸fooå‡½æ•°çš„è¿”å›å€¼å¹¶æ— å…³è”äº†ã€‚å› æ­¤æœ€ç»ˆè¿”å›å€¼å°±æ˜¯1\n\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1706959724,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":390221,"user_name":"å‘æ¡æ©™","can_delete":false,"product_type":"c1","uid":3875922,"ip_address":"ä¸Šæµ·","ucode":"F52E4EB1F9A3C9","user_header":"https://static001.geekbang.org/account/avatar/00/3b/24/52/4e1f33d0.jpg","comment_is_top":false,"comment_ctime":1714790846,"is_pvip":false,"replies":[{"id":142008,"content":"ä½ æ˜¯ç”¨Go 1.22ç‰ˆæœ¬è¿è¡Œçš„å§ã€‚1.22ç‰ˆæœ¬ä¸­loopvarè¯­ä¹‰å‘ç”Ÿäº†å˜æ›´ï¼Œä»å¾ªç¯å˜é‡iä»per loop varå˜ä¸ºper iteration varäº†ã€‚æ‰€ä»¥æ¯æ¬¡è¿›å…¥å¾ªç¯ï¼Œé—­åŒ…æ•è·çš„éƒ½æ˜¯ä¸€ä¸ªæ–°å˜é‡iï¼Œä¸”è¯¥æ–°å˜é‡içš„å€¼ä¸ºå½“æ¬¡è¿­ä»£æ—¶çš„iå€¼ã€‚ç­‰ä»·äº1.22ç‰ˆæœ¬ä»¥å‰çš„å¦‚ä¸‹ä»£ç ï¼š\n\nfunc foo3() { \n    for i := 0; i &lt;= 3; i++ { \n        i := i\n        defer func() { \n            fmt.Println(i) \n        }   \n    }   \n}","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1715262161,"ip_address":"è¾½å®","comment_id":390221,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100093501,"comment_content":"foo3è¿è¡Œçš„ç»“æœä¹Ÿæ˜¯\n3\n2\n1\n0","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":640023,"discussion_content":"å’Œåœ¨æ™®é€šå‡½æ•°ä¸­panicä¸€æ ·ï¼Œä¼šè‡ªä¸‹è€Œä¸Šèµ°ä¸€ä¸ªpanickingçš„è¿‡ç¨‹ï¼Œå¦‚æœæœ‰recoveræ•æ‰panicï¼Œå°±è¿›è¡Œrecoverï¼Œå¦‚æœæ²¡æœ‰ï¼Œä¼šæœ€ç»ˆå¯¼è‡´ç¨‹åºå¼‚å¸¸é€€å‡ºã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1711075245,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":388725,"user_name":"å†’æ³¡é›ªç¢§ ğŸˆ","can_delete":false,"product_type":"c1","uid":1255745,"ip_address":"æ±Ÿè‹","ucode":"E4AB442B0167CF","user_header":"https://static001.geekbang.org/account/avatar/00/13/29/41/a413ca91.jpg","comment_is_top":false,"comment_ctime":1710773650,"is_pvip":false,"replies":[{"id":141531,"content":"å’Œåœ¨æ™®é€šå‡½æ•°ä¸­panicä¸€æ ·ï¼Œä¼šè‡ªä¸‹è€Œä¸Šèµ°ä¸€ä¸ªpanickingçš„è¿‡ç¨‹ï¼Œå¦‚æœæœ‰recoveræ•æ‰panicï¼Œå°±è¿›è¡Œrecoverï¼Œå¦‚æœæ²¡æœ‰ï¼Œä¼šæœ€ç»ˆå¯¼è‡´ç¨‹åºå¼‚å¸¸é€€å‡ºã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1711075245,"ip_address":"åŒ—äº¬","comment_id":388725,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100093501,"comment_content":"defer+logå¯ä»¥è¿½è¸ªè®°å½•ç¨‹åºè°ƒç”¨è·¯å¾„ã€‚\næˆ‘æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœåœ¨deferä¸­è¿›è¡Œpanicä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":636779,"discussion_content":"1. panicå¦‚æœæ²¡æœ‰è¢«æ¢å¤(recover)ï¼Œå°±ä¼šä¸€ç›´å‘ä¸Šä¼ å¯¼åˆ°mainå‡½æ•°ä¸­ï¼Œå¦‚æœä¸»goroutineä¹Ÿæ²¡æœ‰æ¢å¤è¯¥panicï¼Œé‚£ä¹ˆä¸»goroutineå°±ä¼šå› panicè€Œé€€å‡ºã€‚\n2. éå¸¸å¥½çš„é—®é¢˜ï¼Œæˆ‘æ¥å°è¯•å›ç­”ä¸€ä¸‹ã€‚\n\ndeferred å‡½æ•°ä¼šåœ¨å‡½æ•°returnåè¢«è°ƒç”¨ã€‚å› æ­¤barå‡½æ•°è¿™ä¸ªæ¯”è¾ƒå¥½ç†è§£ã€‚barå‡½æ•°ä½¿ç”¨äº†å…·åè¿”å›å€¼ã€‚è€Œdefered funcæ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œé—­åŒ…ä¸­ä½¿ç”¨äº†iè¿™è¿”å›å€¼å˜é‡ï¼Œå› æ­¤returnåï¼Œdeferred funcå¯¹è¿”å›å˜é‡içš„ä¿®æ”¹ä¼šæœ€ç»ˆåæ˜ åˆ°å‡½æ•°barçš„è¿”å›å€¼ä¸Šã€‚\n\nfooå‡½æ•°æ²¡æœ‰ä½¿ç”¨å…·åè¿”å›å€¼ï¼Œå…¶ä¸­çš„deferred funcä¿®æ”¹çš„æ˜¯å‡½æ•°ä½“å†…éƒ¨çš„æœ¬åœ°å˜é‡iã€‚å½“å‡½æ•°return iæ—¶ï¼Œå…¶å®æ˜¯å°†içš„å€¼(æ­¤æ—¶ä¸º1)copyåˆ°å‡½æ•°è¿”å›å€¼çš„å†…å­˜å—ä¸­ï¼Œæ­¤æ—¶è¿”å›å€¼ä¹Ÿä¸º1ã€‚returnåï¼Œdeferred funcè¢«æ‰§è¡Œï¼Œè€Œä¿®æ”¹çš„æ˜¯æœ¬åœ°å˜é‡iï¼Œä¸fooå‡½æ•°çš„è¿”å›å€¼å¹¶æ— å…³è”äº†ã€‚å› æ­¤æœ€ç»ˆè¿”å›å€¼å°±æ˜¯1\n\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1706959724,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":387172,"user_name":"Geek_73c432","can_delete":false,"product_type":"c1","uid":2869118,"ip_address":"å¹¿ä¸œ","ucode":"3E11EB02B14DE0","user_header":"","comment_is_top":false,"comment_ctime":1706627722,"is_pvip":false,"replies":[{"id":141131,"content":"1. panicå¦‚æœæ²¡æœ‰è¢«æ¢å¤(recover)ï¼Œå°±ä¼šä¸€ç›´å‘ä¸Šä¼ å¯¼åˆ°mainå‡½æ•°ä¸­ï¼Œå¦‚æœä¸»goroutineä¹Ÿæ²¡æœ‰æ¢å¤è¯¥panicï¼Œé‚£ä¹ˆä¸»goroutineå°±ä¼šå› panicè€Œé€€å‡ºã€‚\n2. éå¸¸å¥½çš„é—®é¢˜ï¼Œæˆ‘æ¥å°è¯•å›ç­”ä¸€ä¸‹ã€‚\n\ndeferred å‡½æ•°ä¼šåœ¨å‡½æ•°returnåè¢«è°ƒç”¨ã€‚å› æ­¤barå‡½æ•°è¿™ä¸ªæ¯”è¾ƒå¥½ç†è§£ã€‚barå‡½æ•°ä½¿ç”¨äº†å…·åè¿”å›å€¼ã€‚è€Œdefered funcæ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œé—­åŒ…ä¸­ä½¿ç”¨äº†iè¿™è¿”å›å€¼å˜é‡ï¼Œå› æ­¤returnåï¼Œdeferred funcå¯¹è¿”å›å˜é‡içš„ä¿®æ”¹ä¼šæœ€ç»ˆåæ˜ åˆ°å‡½æ•°barçš„è¿”å›å€¼ä¸Šã€‚\n\nfooå‡½æ•°æ²¡æœ‰ä½¿ç”¨å…·åè¿”å›å€¼ï¼Œå…¶ä¸­çš„deferred funcä¿®æ”¹çš„æ˜¯å‡½æ•°ä½“å†…éƒ¨çš„æœ¬åœ°å˜é‡iã€‚å½“å‡½æ•°return iæ—¶ï¼Œå…¶å®æ˜¯å°†içš„å€¼(æ­¤æ—¶ä¸º1)copyåˆ°å‡½æ•°è¿”å›å€¼çš„å†…å­˜å—ä¸­ï¼Œæ­¤æ—¶è¿”å›å€¼ä¹Ÿä¸º1ã€‚returnåï¼Œdeferred funcè¢«æ‰§è¡Œï¼Œè€Œä¿®æ”¹çš„æ˜¯æœ¬åœ°å˜é‡iï¼Œä¸fooå‡½æ•°çš„è¿”å›å€¼å¹¶æ— å…³è”äº†ã€‚å› æ­¤æœ€ç»ˆè¿”å›å€¼å°±æ˜¯1\n\n\n","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1706959724,"ip_address":"è¾½å®","comment_id":387172,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100093501,"comment_content":"è€å¸ˆå¥½\n\n1. æ¯ä¸ª goroutine éƒ½æœ‰è‡ªå·±çš„æ‰§è¡Œæ ˆï¼Œå½“ä¸€ä¸ª goroutine ä¸­å‘ç”Ÿ panic æ—¶ï¼Œå¦ä¸€ä¸ª goroutine å¹¶ä¸èƒ½æ„ŸçŸ¥ï¼Œé‚£ä¸ºä»€ä¹ˆä¸» goroutine ä¼šé€€å‡ºå‘¢ï¼Ÿ\n\n2. ä¸‹é¢ä¸¤ä¸ªå‡½æ•°ä¸ºä»€ä¹ˆè¿”å›å€¼ä¸ä¸€è‡´å‘¢ï¼Ÿ\nfunc foo() int {\n\ti := 1\n\n\tdefer func() {\n\t\ti++\n\t}()\n\n\treturn i\n}\n\nfunc bar() (i int) {\n\ti = 1\n\n\tdefer func() {\n\t\ti++\n\t}()\n\n\treturn\n}\n\nfunc main() {\n\tfmt.Println(foo()) &#47;&#47; 1\n\tfmt.Println(bar()) &#47;&#47; 2\n}\n\n3. deferred å‡½æ•°æ˜¯åœ¨ return è¯­å¥ï¼ˆå‡å¦‚å‡½æ•°æœ‰ï¼‰ä¹‹å‰è¿˜æ˜¯ä¹‹åæ‰§è¡Œå‘¢ï¼Ÿé—®é¢˜ 3 å¯èƒ½è·Ÿé—®é¢˜ 2 æœ‰å…³","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":621056,"discussion_content":"è¿™ä¸€è®²é‡Œæœ‰ä¸“é—¨è¯´deferç”¨æ³•çš„æ®µè½ï¼Œé‡Œé¢æ˜ç¡®è¯´äº†deferçš„åŠŸç”¨ã€ä½¿ç”¨æ–¹æ³•çš„å•Šã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1686792546,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":376353,"user_name":"lesserror","can_delete":false,"product_type":"c1","uid":1351076,"ip_address":"å¹¿ä¸œ","ucode":"25A54D1165FCF6","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","comment_is_top":false,"comment_ctime":1686729205,"is_pvip":false,"replies":[{"id":137242,"content":"è¿™ä¸€è®²é‡Œæœ‰ä¸“é—¨è¯´deferç”¨æ³•çš„æ®µè½ï¼Œé‡Œé¢æ˜ç¡®è¯´äº†deferçš„åŠŸç”¨ã€ä½¿ç”¨æ–¹æ³•çš„å•Šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1686792546,"ip_address":"åŒ—äº¬","comment_id":376353,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100093501,"comment_content":"Tony bai è€å¸ˆï¼Œå¾ˆå¤šæ–‡ç« ä¸­è®² defer åé¢å¿…é¡»æ¥ä¸€ä¸ª å‡½æ•°æˆ–è€…æ–¹æ³•çš„è°ƒç”¨ï¼Œæ–‡ä¸­çš„ç”¨æ³•æ˜¯è¿™æ ·çš„ï¼Œä½†æ˜¯å¥½åƒæ²¡æœ‰ç‰¹æ„å¼ºè°ƒè¿™ä¸€æ¦‚å¿µã€‚","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":621056,"discussion_content":"è¿™ä¸€è®²é‡Œæœ‰ä¸“é—¨è¯´deferç”¨æ³•çš„æ®µè½ï¼Œé‡Œé¢æ˜ç¡®è¯´äº†deferçš„åŠŸç”¨ã€ä½¿ç”¨æ–¹æ³•çš„å•Šã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1686792546,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328378,"user_name":"ä¸€ä¸ªå­¦å‘˜","can_delete":false,"product_type":"c1","uid":1566227,"ip_address":"","ucode":"427049337F6565","user_header":"https://static001.geekbang.org/account/avatar/00/17/e6/13/d93997aa.jpg","comment_is_top":false,"comment_ctime":1640696396,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100093501,"comment_content":"è®²çš„å¤ªæ¸…æ™°äº†ã€‚","like_count":1},{"had_liked":false,"id":338829,"user_name":"Kepler","can_delete":false,"product_type":"c1","uid":1214303,"ip_address":"","ucode":"0C9CA3DB8B3CF0","user_header":"https://static001.geekbang.org/account/avatar/00/12/87/5f/6bf8b74a.jpg","comment_is_top":false,"comment_ctime":1647755991,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100093501,"comment_content":"deferçš„å¸¸ç”¨ç”¨é€”ï¼š\n1.æ¥å£ç»Ÿä¸€ä¸ŠæŠ¥ï¼›\n2.æ‰“å°è€—æ—¶ï¼Œä¸è¿‡è¿™ç‚¹ä¹Ÿå¯ä»¥å½’åˆ°1ä¸­ï¼›","like_count":0}]}