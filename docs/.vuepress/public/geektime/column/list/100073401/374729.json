{"id":374729,"title":"28 | å¤§è¡¨Joinå¤§è¡¨ï¼ˆä¸€ï¼‰ï¼šä»€ä¹ˆæ˜¯â€œåˆ†è€Œæ²»ä¹‹â€çš„è°ƒä¼˜æ€è·¯ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å´ç£Šã€‚</p><p>ä¸Šä¸€è®²ï¼Œæˆ‘ä»¬æ¢è®¨äº†â€œå¤§è¡¨Joinå°è¡¨â€åœºæ™¯çš„è°ƒä¼˜æ€è·¯å’Œåº”å¯¹æ–¹æ³•ã€‚é‚£ä¹ˆï¼Œé™¤äº†å¤§è¡¨Joinå°è¡¨çš„åœºæ™¯ï¼Œæ•°æ®åˆ†æé¢†åŸŸæœ‰æ²¡æœ‰â€œå¤§è¡¨Joinå¤§è¡¨â€çš„åœºæ™¯å‘¢ï¼Ÿç¡®å®æ˜¯æœ‰çš„ï¼Œå®ƒæŒ‡çš„æ˜¯å‚ä¸Joinçš„ä¸¤å¼ ä½“é‡è¾ƒå¤§çš„äº‹å®è¡¨ï¼Œå°ºå¯¸ç›¸å·®åœ¨3å€ä»¥å†…ï¼Œä¸”å…¨éƒ¨æ— æ³•æ”¾è¿›å¹¿æ’­å˜é‡ã€‚</p><p>ä½†æ˜¯é€šå¸¸æ¥è¯´ï¼Œåœ¨æ•°æ®åˆ†æé¢†åŸŸï¼Œç”¨ä¸€å¼ å¤§è¡¨å»å…³è”å¦ä¸€å¼ å¤§è¡¨ï¼Œè¿™ç§åšæ³•åœ¨ä¸šå†…æ˜¯æå…¶ä¸æ¨èçš„ã€‚ç”šè‡³æ¯«ä¸å®¢æ°”åœ°è¯´ï¼Œâ€œå¤§è¡¨Joinå¤§è¡¨â€æ˜¯å†’å¤©ä¸‹ä¹‹å¤§ä¸éŸªï¼ŒçŠ¯äº†æ•°æ®åˆ†æçš„å¤§å¿Œã€‚å¦‚æœéè¦ç”¨â€œå¤§è¡¨Joinå¤§è¡¨â€æ‰èƒ½å®ç°ä¸šåŠ¡é€»è¾‘ã€å®Œæˆæ•°æ®åˆ†æï¼Œè¿™è¯´æ˜æ•°æ®ä»“åº“åœ¨è®¾è®¡ä¹‹åˆï¼Œå¼€å‘è€…è€ƒè™‘å¾—ä¸å¤Ÿå®Œå–„ã€çœ‹å¾—ä¸å¤Ÿè¿œã€‚</p><p>ä¸è¿‡ï¼Œä½ å¯èƒ½ä¼šè¯´ï¼šâ€œæˆ‘åˆšå…¥èŒçš„æ—¶å€™ï¼Œå…¬å¸çš„æ•°ä»“å°±å·²ç»å®šå‹äº†ï¼Œè¿™åˆä¸æ˜¯æˆ‘çš„é”…ï¼Œæˆ‘ä¹Ÿåªèƒ½éšåœ†å°±æ–¹ã€‚â€ä¸ºäº†åº”å¯¹è¿™ç§æƒ…å†µï¼Œä»Šå¤©è¿™ä¸€è®²æˆ‘ä»¬å°±æ¥è¯´è¯´ï¼Œå½“ä½ ä¸å¾—ä¸é¢å¯¹â€œå¤§è¡¨Joinå¤§è¡¨â€çš„æ—¶å€™ï¼Œè¿˜æœ‰å“ªäº›è°ƒä¼˜æ€è·¯å’ŒæŠ€å·§ã€‚</p><p>è¦åº”å¯¹â€œå¤§è¡¨Joinå¤§è¡¨â€çš„è®¡ç®—åœºæ™¯ï¼Œæˆ‘ä»¬ä¸»è¦æœ‰ä¸¤ç§è°ƒä¼˜æ€è·¯ã€‚<strong>ä¸€ç§å«åšâ€œåˆ†è€Œæ²»ä¹‹â€ï¼Œå¦ä¸€ç§æˆ‘æŠŠå®ƒç»Ÿç§°ä¸ºâ€œè´Ÿéš…é¡½æŠ—â€ã€‚</strong>ä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å…ˆæ¥è¯´è¯´â€œåˆ†è€Œæ²»ä¹‹â€ï¼Œâ€œè´Ÿéš…é¡½æŠ—â€æˆ‘ä»¬ç•™åˆ°ä¸‹ä¸€è®²å†å»å±•å¼€ã€‚</p><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå³ä¾¿ä½ ä¸éœ€è¦å»åº”å¯¹â€œå¤§è¡¨Joinå¤§è¡¨â€è¿™å—çƒ«æ‰‹çš„å±±èŠ‹ï¼Œâ€œåˆ†è€Œæ²»ä¹‹â€ä¸â€œè´Ÿéš…é¡½æŠ—â€æ‰€æ¶‰åŠçš„è°ƒä¼˜æ€è·¯ä¸æ–¹æ³•ï¼Œä¹Ÿéå¸¸å€¼å¾—æˆ‘ä»¬èŠ±æ—¶é—´å»æ·±å…¥äº†è§£ï¼Œå› ä¸ºè¿™äº›æ€è·¯ä¸æ–¹æ³•çš„å¯è¿ç§»æ€§éå¸¸å¼ºï¼Œå­¦ä¹ è¿‡åä½ ä¼šå‘ç°ï¼Œå®ƒä»¬å®Œå…¨å¯ä»¥æ‹¿æ¥å»åº”å¯¹å…¶ä»–çš„åº”ç”¨åœºæ™¯ã€‚</p><!-- [[[read_end]]] --><p>è¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬ç›´æ¥å¼€å§‹ä»Šå¤©çš„è¯¾ç¨‹å§ï¼</p><h2>å¦‚ä½•ç†è§£â€œåˆ†è€Œæ²»ä¹‹â€ï¼Ÿ</h2><p>â€œåˆ†è€Œæ²»ä¹‹â€çš„è°ƒä¼˜æ€è·¯æ˜¯æŠŠâ€œå¤§è¡¨Joinå¤§è¡¨â€é™çº§ä¸ºâ€œå¤§è¡¨Joinå°è¡¨â€ï¼Œç„¶åä½¿ç”¨ä¸Šä¸€è®²ä¸­â€œå¤§è¡¨Joinå°è¡¨â€çš„è°ƒä¼˜æ–¹æ³•æ¥è§£å†³æ€§èƒ½é—®é¢˜ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œ<strong>å…ˆæŠŠä¸€ä¸ªå¤æ‚ä»»åŠ¡æ‹†è§£æˆå¤šä¸ªç®€å•ä»»åŠ¡ï¼Œå†åˆå¹¶å¤šä¸ªç®€å•ä»»åŠ¡çš„è®¡ç®—ç»“æœ</strong>ã€‚é‚£ä¹ˆï¼Œâ€œå¤§è¡¨Joinå¤§è¡¨â€çš„åœºæ™¯æ˜¯å¦‚ä½•åº”ç”¨â€œåˆ†è€Œæ²»ä¹‹â€çš„è®¡ç®—æ€æƒ³çš„å‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦æ ¹æ®ä¸¤å¼ è¡¨çš„å°ºå¯¸å¤§å°åŒºåˆ†å‡ºå¤–è¡¨å’Œå†…è¡¨ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå†…è¡¨æ˜¯å°ºå¯¸è¾ƒå°çš„é‚£ä¸€æ–¹ã€‚ç„¶åï¼Œæˆ‘ä»¬äººä¸ºåœ°åœ¨å†…è¡¨ä¸Šæ·»åŠ è¿‡æ»¤æ¡ä»¶ï¼ŒæŠŠå†…è¡¨åˆ’åˆ†ä¸ºå¤šä¸ªä¸é‡å¤çš„å®Œæ•´å­é›†ã€‚æ¥ç€ï¼Œæˆ‘ä»¬è®©å¤–è¡¨ä¾æ¬¡ä¸è¿™äº›å­é›†åšå…³è”ï¼Œå¾—åˆ°éƒ¨åˆ†è®¡ç®—ç»“æœã€‚æœ€åï¼Œå†ç”¨Unionæ“ä½œæŠŠæ‰€æœ‰çš„éƒ¨åˆ†ç»“æœåˆå¹¶åˆ°ä¸€èµ·ï¼Œå¾—åˆ°å®Œæ•´çš„è®¡ç®—ç»“æœï¼Œè¿™å°±æ˜¯ç«¯åˆ°ç«¯çš„å…³è”è®¡ç®—ã€‚æ•´ä¸ªâ€œåˆ†è€Œæ²»ä¹‹â€çš„è®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/b7/36/b7f69a554c2e5745625ea1aa969e0136.jpg?wh=6069*1974\" alt=\"\" title=\"å¤§è¡¨Joinå¤§è¡¨çš„â€œåˆ†è€Œæ²»ä¹‹â€\"></p><h2>å¦‚ä½•ä¿è¯å†…è¡¨æ‹†åˆ†çš„ç²’åº¦è¶³å¤Ÿç»†ï¼Ÿ</h2><p>é‡‡ç”¨â€œåˆ†è€Œæ²»ä¹‹â€çš„æ ¸å¿ƒç›®çš„åœ¨äºï¼Œå°†â€œå¤§è¡¨Joinå¤§è¡¨â€è½¬åŒ–ä¸ºâ€œå¤§è¡¨Joinå°è¡¨â€ï¼Œå› æ­¤<strong>â€œåˆ†è€Œæ²»ä¹‹â€ä¸­ä¸€ä¸ªå…³é”®çš„ç¯èŠ‚å°±æ˜¯å†…è¡¨æ‹†åˆ†ï¼Œæˆ‘ä»¬è¦æ±‚æ¯ä¸€ä¸ªå­è¡¨çš„å°ºå¯¸ç›¸å¯¹å‡åŒ€ï¼Œä¸”éƒ½å°åˆ°å¯ä»¥æ”¾è¿›å¹¿æ’­å˜é‡</strong>ã€‚åªæœ‰è¿™æ ·ï¼ŒåŸæœ¬çš„Shuffle Joinæ‰èƒ½è½¬åŒ–æˆä¸€ä¸ªåˆä¸€ä¸ªçš„Broadcast Joinsï¼ŒåŸæœ¬çš„æµ·é‡æ•°æ®Shuffleæ‰èƒ½è¢«æ¶ˆé™¤ï¼Œæˆ‘ä»¬ä¹Ÿæ‰èƒ½å› æ­¤äº«å—åˆ°æ€§èƒ½è°ƒä¼˜çš„æ”¶ç›Šã€‚ç›¸åï¼Œå¦‚æœå†…è¡¨æ‹†åˆ†ä¸èƒ½æ»¡è¶³ä¸Šè¿°æ¡ä»¶ï¼Œæˆ‘ä»¬å°±â€œç™½å¿™æ´»â€äº†ã€‚</p><p><strong>æ‹†åˆ†çš„å…³é”®åœ¨äºæ‹†åˆ†åˆ—çš„é€‰å–</strong>ï¼Œä¸ºäº†è®©å­è¡¨è¶³å¤Ÿå°ï¼Œæ‹†åˆ†åˆ—çš„åŸºæ•°ï¼ˆCardinalityï¼‰è¦è¶³å¤Ÿå¤§æ‰è¡Œã€‚è¿™ä¹ˆè¯´æ¯”è¾ƒæŠ½è±¡ï¼Œæˆ‘ä»¬æ¥ä¸¾å‡ ä¸ªä¾‹å­ã€‚å‡è®¾å†…è¡¨çš„æ‹†åˆ†åˆ—æ˜¯â€œæ€§åˆ«â€ï¼Œæ€§åˆ«çš„åŸºæ•°æ˜¯2ï¼Œå–å€¼åˆ†åˆ«æ˜¯â€œç”·â€å’Œâ€œå¥³â€ã€‚æˆ‘ä»¬æ ¹æ®è¿‡æ»¤æ¡ä»¶ â€œæ€§åˆ« = ç”·â€å’Œâ€œæ€§åˆ« = å¥³â€æŠŠå†…è¡¨æ‹†åˆ†ä¸ºä¸¤ä»½ï¼Œæ˜¾ç„¶ï¼Œè¿™æ ·æ‹†å‡ºæ¥çš„å­è¡¨è¿˜æ˜¯å¾ˆå¤§ï¼Œè¿œè¿œè¶…å‡ºå¹¿æ’­é˜ˆå€¼ã€‚</p><p>ä½ å¯èƒ½ä¼šè¯´ï¼šâ€œæ—¢ç„¶æ€§åˆ«çš„åŸºæ•°è¿™ä¹ˆä½ï¼Œä¸å¦‚æˆ‘ä»¬é€‰æ‹©åƒèº«ä»½è¯å·è¿™ç§åŸºæ•°å¤§çš„æ•°æ®åˆ—ã€‚â€èº«ä»½è¯å·ç çš„åŸºæ•°ç¡®å®è¶³å¤Ÿå¤§ï¼Œå°±æ˜¯å…¨å›½çš„äººå£æ•°é‡ã€‚ä½†æ˜¯ï¼Œèº«ä»½è¯å·ç è¿™ç§åŸºæ•°æ¯”è¾ƒå¤§çš„å­—ç¬¦ä¸²å……å½“è¿‡æ»¤æ¡ä»¶æœ‰ä¸¤ä¸ªç¼ºç‚¹ï¼šä¸€ï¼Œä¸å®¹æ˜“æ‹†åˆ†ï¼Œå¼€å‘æˆæœ¬å¤ªé«˜ï¼›äºŒï¼Œè¿‡æ»¤æ¡ä»¶å¾ˆéš¾äº«å—åˆ°åƒè°“è¯ä¸‹æ¨è¿™ç§Spark SQLçš„å†…éƒ¨ä¼˜åŒ–æœºåˆ¶ã€‚</p><p>æ—¢ç„¶åŸºæ•°ä½ä¹Ÿä¸è¡Œã€é«˜ä¹Ÿä¸è¡Œï¼Œé‚£åˆ°åº•ä»€ä¹ˆæ ·çš„åŸºæ•°åˆé€‚å‘¢ï¼Ÿé€šå¸¸æ¥è¯´ï¼Œåœ¨ç»å¤§å¤šæ•°çš„æ•°ä»“åœºæ™¯ä¸­ï¼Œäº‹å®è¡¨ä¸Šéƒ½æœ‰ä¸æ—¶é—´ç›¸å…³çš„å­—æ®µï¼Œæ¯”å¦‚æ—¥æœŸæˆ–æ˜¯æ›´ç»†è‡´çš„æ—¶é—´æˆ³ã€‚è¿™ä¹Ÿæ˜¯å¾ˆå¤šäº‹å®è¡¨åœ¨å»ºè¡¨çš„æ—¶å€™ï¼Œéƒ½æ˜¯ä»¥æ—¥æœŸä¸ºç²’åº¦åšåˆ†åŒºå­˜å‚¨çš„åŸå› ã€‚å› æ­¤ï¼Œé€‰æ‹©æ—¥æœŸä½œä¸ºæ‹†åˆ†åˆ—å¾€å¾€æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œæ—¢èƒ½äº«å—åˆ°Spark SQLåˆ†åŒºå‰ªè£ï¼ˆPartition Pruningï¼‰çš„æ€§èƒ½æ”¶ç›Šï¼ŒåŒæ—¶å¼€å‘æˆæœ¬åˆå¾ˆä½ã€‚</p><h2>å¦‚ä½•é¿å…å¤–è¡¨çš„é‡å¤æ‰«æï¼Ÿ</h2><p>å†…è¡¨æ‹†åˆ†ä¹‹åï¼Œå¤–è¡¨å°±è¦åˆ†åˆ«å’Œæ‰€æœ‰çš„å­è¡¨åšå…³è”ï¼Œå°½ç®¡æ¯ä¸€ä¸ªå…³è”éƒ½å˜æˆäº†â€œå¤§è¡¨Joinå°è¡¨â€å¹¶è½¬åŒ–ä¸ºBHJï¼Œä½†æ˜¯åœ¨Sparkçš„è¿è¡Œæœºåˆ¶ä¸‹ï¼Œæ¯ä¸€æ¬¡å…³è”è®¡ç®—éƒ½éœ€è¦é‡æ–°ã€é‡å¤´æ‰«æå¤–è¡¨çš„å…¨é‡æ•°æ®ã€‚æ¯«æ— ç–‘é—®ï¼Œè¿™æ ·çš„æ“ä½œæ˜¯è®©äººæ— æ³•æ¥å—çš„ã€‚è¿™å°±æ˜¯â€œåˆ†è€Œæ²»ä¹‹â€ä¸­å¦ä¸€ä¸ªå…³é”®çš„ç¯èŠ‚ï¼šå¤–è¡¨çš„é‡å¤æ‰«æã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/9f/9c/9fab5a256d544ef2b1f895c4990f4e9c.jpg?wh=3549*1509\" alt=\"\" title=\"å¤–è¡¨çš„é‡å¤æ‰«æ\"></p><p>æˆ‘ä»¬ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œå†…è¡¨è¢«æ‹†åˆ†ä¸º4ä»½ï¼ŒåŸæœ¬ä¸¤ä¸ªå¤§è¡¨çš„Shuffle Joinï¼Œè¢«è½¬åŒ–ä¸º4ä¸ªBroadcast Joinsã€‚å¤–è¡¨åˆ†åˆ«ä¸4ä¸ªå­è¡¨åšå…³è”ï¼Œæ‰€æœ‰å…³è”çš„ç»“æœé›†æœ€ç»ˆé€šè¿‡Unionåˆå¹¶åˆ°ä¸€èµ·ï¼Œå®Œæˆè®¡ç®—ã€‚å¯¹äºè¿™4ä¸ªå…³è”æ¥è¯´ï¼Œæ¯ä¸€æ¬¡è®¡ç®—éƒ½éœ€è¦é‡å¤´æ‰«æä¸€éå¤–è¡¨ã€‚æ¢å¥è¯è¯´ï¼Œå¤–è¡¨ä¼šè¢«é‡å¤æ‰«æ4æ¬¡ã€‚æ˜¾ç„¶ï¼Œå¤–è¡¨æ‰«æçš„æ¬¡æ•°å–å†³äºå†…è¡¨æ‹†åˆ†çš„ä»½æ•°ã€‚</p><p>æˆ‘ä»¬åˆšåˆšè¯´åˆ°ï¼Œå†…è¡¨çš„æ‹†åˆ†éœ€è¦è¶³å¤Ÿç»†è‡´ï¼Œæ‰èƒ½äº«å—åˆ°æ€§èƒ½è°ƒä¼˜å¸¦æ¥çš„æ”¶ç›Šï¼Œè€Œè¿™å¾€å¾€æ„å‘³ç€ï¼Œå†…è¡¨æ‹†åˆ†çš„ä»½æ•°æˆç™¾ä¸Šåƒã€ç”šè‡³æˆåƒä¸Šä¸‡ã€‚åœ¨è¿™æ ·çš„æ•°é‡çº§ä¹‹ä¸‹ï¼Œé‡å¤æ‰«æå¤–è¡¨å¸¦æ¥çš„å¼€é”€æ˜¯å·¨å¤§çš„ã€‚</p><p>è¦è§£å†³æ•°æ®é‡å¤æ‰«æçš„é—®é¢˜ï¼ŒåŠæ³•å…¶å®ä¸æ­¢ä¸€ç§ï¼Œæˆ‘ä»¬æœ€å®¹æ˜“æƒ³åˆ°çš„å°±æ˜¯Cacheã€‚ç¡®å®ï¼Œå¦‚æœèƒ½æŠŠå¤–è¡¨çš„å…¨é‡æ•°æ®ç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œæˆ‘ä»¬å°±ä¸å¿…æ‹…å¿ƒé‡å¤æ‰«æçš„é—®é¢˜ï¼Œæ¯•ç«Ÿå†…å­˜çš„è®¡ç®—å»¶è¿Ÿè¿œä½äºç£ç›˜ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬é¢ä¸´çš„æƒ…å†µæ˜¯å¤–è¡¨çš„æ•°æ®é‡éå¸¸åœ°åºå¤§ï¼Œå¾€å¾€éƒ½æ˜¯TBçº§åˆ«èµ·æ­¥ï¼Œæƒ³è¦æŠŠTBä½“é‡çš„æ•°æ®å…¨éƒ¨ç¼“å­˜åˆ°å†…å­˜ï¼Œè¿™è¦æ±‚æˆ‘ä»¬çš„è®¡ç®—é›†ç¾¤åœ¨èµ„æºé…ç½®ä¸Šè¦è¶³å¤Ÿçš„å¼ºæ‚ï¼Œå†è¯´ç›´ç™½ä¸€ç‚¹ï¼Œä½ è¦æœ‰è¶³å¤Ÿçš„é¢„ç®—å»é…ç½®è¶³å¤Ÿå¤§çš„å†…å­˜ã€‚</p><p>è¦æ˜¯é›†ç¾¤æ²¡è¿™ä¹ˆå¼ºæ‚ï¼Œè€æ¿ä¹Ÿä¸ç»™æ‰¹é¢„ç®—å»æ‰©å®¹é›†ç¾¤å†…å­˜ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬è¿˜æ˜¯è¦éµå¾ªâ€œåˆ†è€Œæ²»ä¹‹â€çš„æ€æƒ³ï¼Œæ—¢ç„¶å†…è¡¨å¯ä»¥â€œåˆ†è€Œæ²»ä¹‹â€ï¼Œå¤–è¡¨ä¸ºä»€ä¹ˆä¸å¯ä»¥å‘¢ï¼Ÿ<strong>å¯¹äºå¤–è¡¨å‚ä¸çš„æ¯ä¸€ä¸ªå­å…³è”ï¼Œåœ¨é€»è¾‘ä¸Šï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥åªæ‰«æé‚£äº›ä¸å†…è¡¨å­è¡¨ç›¸å…³çš„å¤–è¡¨æ•°æ®ï¼Œå¹¶ä¸éœ€è¦æ¯æ¬¡éƒ½æ‰«æå¤–è¡¨çš„å…¨é‡æ•°æ®ã€‚</strong>å¦‚æ­¤ä¸€æ¥ï¼Œåœ¨æ•ˆæœä¸Šï¼Œå¤–è¡¨çš„å…¨é‡æ•°æ®ä»…ä»…è¢«æ‰«æäº†ä¸€æ¬¡ã€‚ä½ å¯èƒ½ä¼šè¯´ï¼šâ€œè¯´å¾—è½»å·§ï¼Œé€»è¾‘ä¸Šæ˜¯æ²¡é—®é¢˜ï¼Œä½†æ˜¯å…·ä½“æ€ä¹ˆåšåˆ°å¤–è¡¨çš„â€œåˆ†è€Œæ²»ä¹‹â€å‘¢ï¼Ÿâ€</p><p>è¿™äº‹è¦æ˜¯æåˆ°ä»¥å‰è¿˜çœŸæ˜¯æ²¡ä»€ä¹ˆæ“ä½œç©ºé—´ï¼Œä½†æ˜¯ï¼Œå­¦ä¹ è¿‡Spark 3.0çš„DPPæœºåˆ¶ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨DPPæ¥å¯¹å¤–è¡¨è¿›è¡Œâ€œåˆ†è€Œæ²»ä¹‹â€ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/fa/23/fa4bfb52cb42928f15b1dc7c37c30b23.jpg?wh=5109*2034\" alt=\"\" title=\"å¤–è¡¨çš„â€œåˆ†è€Œæ²»ä¹‹â€\"></p><p>å‡è®¾å¤–è¡¨çš„åˆ†åŒºé”®åŒ…å«Join Keysï¼Œé‚£ä¹ˆï¼Œæ¯ä¸€ä¸ªå†…è¡¨å­è¡¨éƒ½å¯ä»¥é€šè¿‡DPPæœºåˆ¶ï¼Œå¸®åŠ©ä¸ä¹‹å…³è”çš„å¤–è¡¨å‡å°‘æ•°æ®æ‰«æé‡ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ­¥éª¤1ã€2ã€3ã€4åˆ†åˆ«ä»£è¡¨å¤–è¡¨ä¸4ä¸ªä¸åŒå­è¡¨çš„å…³è”è®¡ç®—ã€‚ä»¥æ­¥éª¤1ä¸ºä¾‹ï¼Œåœ¨DPPæœºåˆ¶çš„å¸®åŠ©ä¸‹ï¼Œè¦å®Œæˆå…³è”è®¡ç®—ï¼Œå¤–è¡¨åªéœ€è¦æ‰«æä¸ç»¿è‰²å­è¡¨å¯¹åº”çš„åˆ†åŒºæ•°æ®å³å¯ï¼Œå¦‚å›¾ä¸­çš„ä¸¤ä¸ªç»¿è‰²åˆ†åŒºæ‰€ç¤ºã€‚åŒç†ï¼Œè¦å®Œæˆæ­¥éª¤4çš„å…³è”è®¡ç®—ï¼Œå¤–è¡¨åªéœ€è¦æ‰«æä¸ç´«è‰²å­è¡¨å¯¹åº”çš„åˆ†åŒºå³å¯ï¼Œå¦‚å›¾ä¸­å·¦ä¾§ç”¨ç´«è‰²æ ‡è®°çš„ä¸¤ä¸ªæ•°æ®åˆ†åŒºã€‚</p><p>ä¸éš¾å‘ç°ï¼Œæ¯ä¸ªå­æŸ¥è¯¢åªæ‰«æå¤–è¡¨çš„ä¸€éƒ¨åˆ†ã€ä¸€ä¸ªå­é›†ï¼Œæ‰€æœ‰è¿™äº›å­é›†åŠ èµ·æ¥ï¼Œåˆšå¥½å°±æ˜¯å¤–è¡¨çš„å…¨é‡æ•°æ®ã€‚å› æ­¤ï¼Œåˆ©ç”¨â€œåˆ†è€Œæ²»ä¹‹â€çš„è°ƒä¼˜æŠ€å·§ï¼Œç«¯åˆ°ç«¯çš„å…³è”è®¡ç®—ä»…éœ€å¯¹å¤–è¡¨åšä¸€æ¬¡å®Œæ•´çš„å…¨é‡æ‰«æå³å¯ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œåœ¨æŠŠåŸå§‹çš„Shuffle Joinè½¬åŒ–ä¸ºå¤šä¸ªBroadcast Joinsä¹‹åï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å¼•å…¥é¢å¤–çš„æ€§èƒ½å¼€é”€ã€‚æ¯«æ— ç–‘é—®ï¼ŒæŸ¥è¯¢ç»è¿‡è¿™æ ·çš„è°ƒä¼˜è¿‡åï¼Œæ‰§è¡Œæ•ˆç‡ä¸€å®šä¼šæœ‰è¾ƒå¤§å¹…åº¦çš„æå‡ã€‚</p><p>ä½†æ˜¯ï¼Œä½ å¯èƒ½ä¼šè¯´ï¼šâ€œè¯´äº†åŠå¤©ï¼Œéƒ½æ˜¯ä¸€äº›æ€è·¯å’Œç†è®ºï¼Œè¦å®ç°â€œåˆ†è€Œæ²»ä¹‹â€ï¼Œä»£ç è¯¥æ€ä¹ˆå†™å‘¢ï¼Ÿâ€æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ç»“åˆä¸€ä¸ªå°ä¾‹å­ä¸€èµ·å»å®æˆ˜ä¸€ä¸‹â€œåˆ†è€Œæ²»ä¹‹â€çš„ä¼˜åŒ–æ€è·¯ã€‚</p><h2>â€œåˆ†è€Œæ²»ä¹‹â€è°ƒä¼˜æ€è·¯å®æˆ˜</h2><p>è¿™ä¸ªå®æˆ˜ä¾‹å­æ¥è‡ªäºä¸€ä¸ªè·¨å¢ƒç”µå•†ï¼Œè¿™å®¶ç”µå•†åœ¨å…¨çƒèŒƒå›´å†…äº¤æ˜“å¤§å‹ç»„è£…è®¾å¤‡ï¼Œè¿™äº›è®¾å¤‡çš„é›¶éƒ¨ä»¶æ¥è‡ªäºå…¨çƒä¸åŒåœ°åŒºçš„ä¸åŒä¾›è´§å•†ï¼Œå› æ­¤ä¸€ä¸ªè®¾å¤‡è®¢å•å¾€å¾€åŒ…å«å¤šä¸ªé›¶éƒ¨ä»¶æ˜ç»†ã€‚è¿™å®¶ç”µå•†ä½¿ç”¨ordersè¡¨å’Œtransactionsè¡¨æ¥åˆ†åˆ«è®°å½•è®¢å•å’Œäº¤æ˜“æ˜ç»†ï¼Œä¸¤å¼ è¡¨çš„å…³é”®å­—æ®µå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚</p><pre><code>//ordersè¡¨çš„å…³é”®å­—æ®µ\norderId: Int\ncustomerId: Int\nstatus: String\ndate: Date //åˆ†åŒºé”®\n \n//lineitemsè¡¨çš„å…³é”®å­—æ®µ\norderId: Int //åˆ†åŒºé”®\ntxId: Int\nitemId: Int\nprice: Float\nquantity: Int\n\n</code></pre><p>orderså’Œtransactionséƒ½æ˜¯äº‹å®è¡¨ï¼Œä½“é‡éƒ½åœ¨TBçº§åˆ«ã€‚åŸºäºè¿™ä¸¤å¼ äº‹å®è¡¨ï¼Œè¿™å®¶ç”µå•†æ¯éš”ä¸€æ®µæ—¶é—´ï¼Œå°±ä¼šè®¡ç®—ä¸Šä¸€ä¸ªå­£åº¦æ‰€æœ‰è®¢å•çš„äº¤æ˜“é¢ï¼Œä¸šåŠ¡ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre><code>//ç»Ÿè®¡è®¢å•äº¤æ˜“é¢çš„ä»£ç å®ç°\nval txFile: String = _\nval orderFile: String = _\n \nval transactions: DataFrame = spark.read.parquent(txFile)\nval orders: DataFrame = spark.read.parquent(orderFile)\n \ntransactions.createOrReplaceTempView(&quot;transactions&quot;)\norders.createOrReplaceTempView(&quot;orders&quot;)\n \nval query: String = &quot;\nselect sum(tx.price * tx.quantity) as revenue, o.orderId\nfrom transactions as tx inner join orders as o\non tx.orderId = o.orderId\nwhere o.status = 'COMPLETE'\nand o.date between '2020-01-01' and '2020-03-31'\ngroup by o.orderId\n&quot;\n \nval outFile: String = _\nspark.sql(query).save.parquet(outFile)\n\n</code></pre><p>ä¸éš¾å‘ç°ï¼Œåœ¨ä¸¤å¼ è¡¨çš„å…³è”è®¡ç®—ä¸­ï¼Œtransactionsçš„è§’è‰²æ˜¯å¤–è¡¨ï¼Œè‡ªç„¶ ordersçš„è§’è‰²å°±æ˜¯å†…è¡¨ã€‚éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œå³ä¾¿å†…è¡¨ä¸­æœ‰ä¸å°‘è¿‡æ»¤æ¡ä»¶ï¼Œå¦‚è®¢å•çŠ¶æ€ä¸ºâ€œå®Œæˆâ€ä¸”æˆäº¤æ—¥æœŸæ»¡è¶³ä¸€å®šèŒƒå›´ï¼Œä½†è¿‡æ»¤ä¹‹åçš„å†…è¡¨ä»ç„¶åœ¨ç™¾GBé‡çº§ï¼Œéš¾ä»¥æ”¾å…¥å¹¿æ’­å˜é‡ã€‚å› æ­¤ï¼Œè¿™ä¸¤å¼ å¤§è¡¨çš„å…³è”è®¡ç®—ï¼Œè‡ªç„¶ä¼šé€€åŒ–åˆ°Shuffle Joinsçš„å®ç°æœºåˆ¶ã€‚</p><p>é‚£ä¹ˆï¼Œå¦‚æœç”¨â€œåˆ†è€Œæ²»ä¹‹â€çš„æ€è·¯æ¥åšä¼˜åŒ–ï¼Œä»£ç åº”è¯¥æ€ä¹ˆæ”¹å‘¢ï¼Ÿâ€œåˆ†è€Œæ²»ä¹‹â€æœ‰ä¸¤ä¸ªå…³é”®å› ç´ ï¼Œä¹Ÿå°±æ˜¯å†…è¡¨æ‹†åˆ†å’Œå¤–è¡¨é‡å¤æ‰«æã€‚æˆ‘ä»¬ä¸å¦¨ä»è¿™ä¸¤ä¸ªå› ç´ å‡ºå‘æ¥è°ƒæ•´åŸæ¥çš„ä»£ç ã€‚</p><p>é¦–å…ˆï¼Œå†…è¡¨æ‹†åˆ†æ˜¯å¦åˆç†å®Œå…¨å–å†³äºæ‹†åˆ†åˆ—çš„é€‰å–ï¼Œè€Œå€™é€‰æ‹†åˆ†åˆ—è¦åŒæ—¶æ»¡è¶³åŸºæ•°é€‚ä¸­ã€å­è¡¨åˆ†å¸ƒå‡åŒ€ï¼Œå¹¶ä¸”å­è¡¨å°ºå¯¸å°äºå¹¿æ’­é˜ˆå€¼ç­‰å¤šä¸ªæ¡ä»¶ã€‚çºµè§‚ordersè¡¨çš„æ‰€æœ‰å…³é”®å­—æ®µï¼Œåªæœ‰dateå­—æ®µèƒ½å¤ŸåŒæ—¶æ»¡è¶³è¿™äº›æ¡ä»¶ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨dateå­—æ®µï¼Œä»¥å¤©ä¸ºå•ä½å¯¹ordersè¡¨åšæ‹†åˆ†ï¼Œé‚£ä¹ˆåŸä»£ç ä¸­çš„æŸ¥è¯¢è¯­å¥éœ€è¦ä½œå¦‚ä¸‹è°ƒæ•´ã€‚</p><pre><code>//ä»¥dateå­—æ®µæ‹†åˆ†å†…è¡¨\nval query: String = &quot;\nselect sum(tx.price * tx.quantity) as revenue, o.orderId\nfrom transactions as tx inner join orders as o\non tx.orderId = o.orderId\nwhere o.status = 'COMPLETE'\nand o.date = '2020-01-01'\ngroup by o.orderId\n&quot;\n\n</code></pre><p>ä½ å¯èƒ½ä¼šè¯´ï¼šâ€œè¿™ä¸å¯¹å§ï¼Œä¸šåŠ¡éœ€æ±‚æ˜¯è®¡ç®—ä¸€ä¸ªå­£åº¦çš„äº¤æ˜“é¢ï¼ŒæŸ¥è¯¢è¿™ä¹ˆæ”¹ä¸æ˜¯åªè®¡ç®—ä¸€å¤©çš„é‡å—ï¼Ÿâ€åˆ«ç€æ€¥ï¼Œä»£ç çš„è°ƒæ•´è¿˜å·®ä¸€æ­¥ï¼šå¤–è¡¨é‡å¤æ‰«æã€‚å†…è¡¨æ‹†åˆ†ä¹‹åï¼Œå¤–è¡¨è‡ªç„¶è¦ä¾æ¬¡ä¸æ‰€æœ‰çš„å­è¡¨åšå…³è”ï¼Œæœ€ç»ˆæŠŠå…¨éƒ¨å­å…³è”çš„ç»“æœåˆå¹¶åˆ°ä¸€èµ·ï¼Œæ‰ç®—æ˜¯å®Œæˆâ€œåˆ†è€Œæ²»ä¹‹â€çš„å®ç°ã€‚</p><pre><code>//å¾ªç¯éå†datesã€å®Œæˆâ€œåˆ†è€Œæ²»ä¹‹â€çš„è®¡ç®—\nval dates: Seq[String] = Seq(&quot;2020-01-01&quot;, &quot;2020-01-02&quot;, â€¦ &quot;2020-03-31&quot;)\n \nfor (date &lt;- dates) {\n \nval query: String = s&quot;\nselect sum(tx.price * tx.quantity) as revenue, o.orderId\nfrom transactions as tx inner join orders as o\non tx.orderId = o.orderId\nwhere o.status = 'COMPLETE'\nand o.date = ${date}\ngroup by o.orderId\n&quot;\n \nval file: String = s&quot;${outFile}/${date}&quot;\nspark.sql(query).save.parquet(file)\n}\n</code></pre><p>å†æ¬¡è°ƒæ•´åçš„ä»£ç å¦‚ä¸Šè¡¨æ‰€ç¤ºï¼Œæˆ‘ä»¬åˆ©ç”¨ä¸€ä¸ªç®€å•çš„forå¾ªç¯æ¥éå†æ—¥æœŸï¼Œä»è€Œè®©å¤–è¡¨ä¾æ¬¡ä¸å­è¡¨åšå…³è”ï¼Œå¹¶æŠŠå­å…³è”çš„è®¡ç®—ç»“æœç›´æ¥å†™åˆ°outFileæ ¹ç›®å½•ä¸‹çš„å­ç›®å½•ã€‚ä»£ç çš„æ”¹åŠ¨è¿˜æ˜¯å¾ˆç®€å•çš„ã€‚ä¸è¿‡ï¼Œç»†å¿ƒçš„ä½ å¯èƒ½ä¼šå‘ç°ï¼šâ€œè¿™ç§å†™æ³•ï¼Œä¸æ˜¯æˆ‘ä»¬ä¸€ç›´è¦æåŠ›é¿å…çš„å•æœºæ€ç»´æ¨¡å¼å—ï¼Ÿâ€æ²¡é”™ï¼Œå•çº¯ä»å†™æ³•ä¸Šæ¥çœ‹ï¼Œè¿™ä»½ä»£ç çš„â€œå•æœºæ€ç»´â€å‘³é“éå¸¸æµ“åšã€‚</p><p>ä¸è¿‡ï¼Œå¯¹äºâ€œå•æœºæ€ç»´æ¨¡å¼â€çš„ç†è§£ï¼Œæˆ‘ä»¬ä¸èƒ½ä»…ä»…åœç•™åœ¨å½¢å¼æˆ–æ˜¯è¡¨é¢ä¸Šã€‚æ‰€è°“å•æœºæ€ç»´æ¨¡å¼ï¼Œå®ƒæŒ‡çš„æ˜¯å¼€å‘è€…ä¸å‡æ€ç´¢åœ°ç›´å…¥é¢å‘è¿‡ç¨‹ç¼–ç¨‹ï¼Œå¿½ç•¥æˆ–æ— è§†åˆ†å¸ƒå¼æ•°æ®å®ä½“çš„ç¼–ç¨‹æ¨¡å¼ã€‚ä½†åœ¨åˆšåˆšæ•´ç†è°ƒä¼˜æ€è·¯çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸€ç›´æŠŠå¤–è¡¨çš„é‡å¤æ‰«æç‰¢è®°äºå¿ƒï¼Œå¹¶æƒ³åˆ°é€šè¿‡åˆ©ç”¨DPPæœºåˆ¶æ¥é¿å…å®ƒã€‚å› æ­¤ï¼Œè™½ç„¶æˆ‘ä»¬ä½¿ç”¨äº†forå¾ªç¯ï¼Œä½†å¹¶ä¸ä¼šåœ¨è¿è¡Œæ—¶å¼•å…¥åˆ†å¸ƒå¼æ•°æ®é›†çš„é‡å¤æ‰«æã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œåœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œåˆ©ç”¨â€œåˆ†è€Œæ²»ä¹‹â€çš„è°ƒä¼˜æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ‰€æœ‰â€œå¤§è¡¨Joinå¤§è¡¨â€çš„å…³è”æŸ¥è¯¢è½¬åŒ–ä¸ºâ€œå¤§è¡¨Joinå°è¡¨â€ï¼ŒæŠŠåŸå§‹çš„Shuffle Joinè½¬åŒ–ä¸ºå¤šä¸ªBroadcast Joinsï¼Œè€Œä¸”Broadcast Joinsåˆå¯ä»¥æœ‰æ•ˆåº”å¯¹å…³è”ä¸­çš„æ•°æ®å€¾æ–œé—®é¢˜ï¼Œå¯ä»¥è¯´æ˜¯ä¸€ä¸¾ä¸¤å¾—ã€‚</p><h2>å°ç»“</h2><p>â€œå¤§è¡¨Joinå¤§è¡¨â€çš„ç¬¬ä¸€ç§è°ƒä¼˜æ€è·¯æ˜¯â€œåˆ†è€Œæ²»ä¹‹â€ï¼Œæˆ‘ä»¬è¦é‡ç‚¹æŒæ¡å®ƒçš„è°ƒä¼˜æ€è·¯ä»¥åŠä¸¤ä¸ªå…³é”®ç¯èŠ‚çš„ä¼˜åŒ–å¤„ç†ã€‚</p><p>â€œåˆ†è€Œæ²»ä¹‹â€çš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡å‡åŒ€æ‹†åˆ†å†…è¡¨çš„æ–¹å¼ ï¼ŒæŠŠä¸€ä¸ªå¤æ‚è€Œåˆåºå¤§çš„Shuffle Joinè½¬åŒ–ä¸ºå¤šä¸ªBroadcast Joinsï¼Œå®ƒçš„ç›®çš„æ˜¯ï¼Œæ¶ˆé™¤åŸæœ‰Shuffle Joinä¸­ä¸¤å¼ å¤§è¡¨æ‰€å¼•å…¥çš„æµ·é‡æ•°æ®åˆ†å‘ï¼Œå¤§å¹…å‰Šå‡ç£ç›˜ä¸ç½‘ç»œå¼€é”€çš„åŒæ—¶ï¼Œä»æ•´ä½“ä¸Šæå‡ä½œä¸šç«¯åˆ°ç«¯çš„æ‰§è¡Œæ€§èƒ½ã€‚</p><p>åœ¨â€œåˆ†è€Œæ²»ä¹‹â€çš„è°ƒä¼˜è¿‡ç¨‹ä¸­ï¼Œå†…è¡¨çš„æ‹†åˆ†æœ€ä¸ºå…³é”®ï¼Œå› ä¸ºå®ƒè‚©è´Ÿç€Shuffle Joinèƒ½å¦æˆåŠŸè½¬åŒ–ä¸ºBroadcast Joinsçš„é‡è¦ä½œç”¨ã€‚è€Œæ‹†åˆ†çš„å…³é”®åœ¨äºæ‹†åˆ†åˆ—çš„é€‰å–ã€‚ä¸ºäº†å…¼é¡¾æ‰§è¡Œæ€§èƒ½ä¸å¼€å‘æ•ˆç‡ï¼Œæ‹†åˆ†åˆ—çš„åŸºæ•°è¦è¶³å¤Ÿå¤§ï¼Œè¿™æ ·æ‰èƒ½è®©å­è¡¨å°åˆ°è¶³ä»¥æ”¾è¿›å¹¿æ’­å˜é‡ï¼Œä½†åŒæ—¶ï¼Œæ‹†åˆ†åˆ—çš„åŸºæ•°ä¹Ÿä¸å®œè¿‡å¤§ï¼Œå¦åˆ™å®ç°â€œåˆ†è€Œæ²»ä¹‹â€çš„å¼€å‘æˆæœ¬å°±ä¼šé™¡ç„¶ä¸Šå‡ã€‚é€šå¸¸æ¥è¯´ï¼Œæ—¥æœŸåˆ—å¾€å¾€æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p><p>ä¸ºäº†é¿å…åœ¨è°ƒä¼˜çš„è¿‡ç¨‹ä¸­å¼•å…¥é¢å¤–çš„è®¡ç®—å¼€é”€ï¼Œæˆ‘ä»¬è¦ç‰¹åˆ«æ³¨æ„å¤–è¡¨çš„é‡å¤æ‰«æé—®é¢˜ã€‚é’ˆå¯¹å¤–è¡¨çš„é‡å¤æ‰«æï¼Œæˆ‘ä»¬è‡³å°‘æœ‰ä¸¤ç§åº”å¯¹æ–¹æ³•ã€‚ç¬¬ä¸€ç§æ˜¯å°†å¤–è¡¨å…¨é‡ç¼“å­˜åˆ°å†…å­˜ï¼Œä¸è¿‡è¿™ç§æ–¹æ³•å¯¹äºå†…å­˜ç©ºé—´çš„è¦æ±‚è¾ƒé«˜ï¼Œä¸å…·å¤‡æ™®é€‚æ€§ã€‚ç¬¬äºŒç§æ˜¯åˆ©ç”¨Spark 3.0ç‰ˆæœ¬æ¨å‡ºçš„DPPç‰¹æ€§ï¼Œåœ¨æ•°ä»“è®¾è®¡ä¹‹åˆï¼Œå°±ä»¥Join Keyä½œä¸ºåˆ†åŒºé”®ï¼Œå¯¹å¤–è¡¨åšåˆ†åŒºå­˜å‚¨ã€‚</p><p>å½“æˆ‘ä»¬åšå¥½äº†å†…è¡¨æ‹†åˆ†ï¼ŒåŒæ—¶ä¹Ÿé¿å…äº†å¤–è¡¨çš„é‡å¤æ‰«æï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠåŸå§‹çš„Shuffle Joinè½¬åŒ–ä¸ºå¤šä¸ªBroadcast Joinsï¼Œåœ¨æ¶ˆé™¤æµ·é‡æ•°æ®åœ¨å…¨ç½‘åˆ†å‘çš„åŒæ—¶ï¼Œé¿å…å¼•å…¥é¢å¤–çš„æ€§èƒ½å¼€é”€ã€‚é‚£ä¹ˆæ¯«æ— ç–‘é—®ï¼ŒæŸ¥è¯¢ç»è¿‡â€œåˆ†è€Œæ²»ä¹‹â€çš„è°ƒä¼˜è¿‡åï¼Œä½œä¸šç«¯åˆ°ç«¯çš„æ‰§è¡Œæ€§èƒ½ä¸€å®šä¼šå¾—åˆ°å¤§å¹…æå‡ã€‚</p><h2>æ¯æ—¥ä¸€ç»ƒ</h2><p>åœ¨å¤§è¡¨æ•°æ®åˆ†å¸ƒå‡åŒ€çš„æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬é‡‡ç”¨â€œåˆ†è€Œæ²»ä¹‹â€çš„è°ƒä¼˜æŠ€å·§ï¼Œè¦é¿å…å¤–è¡¨çš„é‡å¤æ‰«æï¼Œé™¤äº†é‡‡ç”¨ç¼“å­˜æˆ–æ˜¯DPPæœºåˆ¶ä»¥å¤–ï¼Œè¿˜æœ‰å“ªäº›å…¶ä»–åŠæ³•ï¼Ÿ</p><p>æœŸå¾…åœ¨ç•™è¨€åŒºçœ‹åˆ°ä½ çš„æ€è€ƒå’Œç­”æ¡ˆï¼Œæˆ‘ä»¬ä¸‹ä¸€è®²è§ï¼</p>","comments":[{"had_liked":false,"id":327279,"user_name":"èµµé¹ä¸¾","can_delete":false,"product_type":"c1","uid":1260182,"ip_address":"","ucode":"B3785788D6176C","user_header":"https://static001.geekbang.org/account/avatar/00/13/3a/96/9fddfb4a.jpg","comment_is_top":false,"comment_ctime":1640047313,"is_pvip":false,"replies":[{"id":"119393","content":"1ï¼‰SQLä¹Ÿæ˜¯å¯ä»¥çš„å“ˆ~ ä¸è¿‡å¾—ç”¨åˆ°spark-sql CLIï¼Œæˆ–æ˜¯Beelineè¿™æ ·çš„å®¢æˆ·ç«¯<br>2ï¼‰2.xè¿˜ä¸è¡Œï¼Œè¿™é‡Œéœ€è¦åˆ©ç”¨åˆ°3.xæ‰æœ‰çš„DPPæœºåˆ¶","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1043100","ctime":1640356344,"ip_address":"","comment_id":327279,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14524949201","product_id":100073401,"comment_content":"1 ä¼˜åŒ–è¿‡ç¨‹æ˜¯scallaå†™çš„ï¼Œçº¯SQLæœ‰æ²¡æœ‰å®ç°å—ï¼Ÿ<br>2 sparkç‰ˆæœ¬ä¸º2.4.3æœ‰åŠæ³•è¾¾åˆ°ç±»ä¼¼æ•ˆæœå—ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541403,"discussion_content":"1ï¼‰SQLä¹Ÿæ˜¯å¯ä»¥çš„å“ˆ~ ä¸è¿‡å¾—ç”¨åˆ°spark-sql CLIï¼Œæˆ–æ˜¯Beelineè¿™æ ·çš„å®¢æˆ·ç«¯\n2ï¼‰2.xè¿˜ä¸è¡Œï¼Œè¿™é‡Œéœ€è¦åˆ©ç”¨åˆ°3.xæ‰æœ‰çš„DPPæœºåˆ¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640356344,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":307215,"user_name":"wow_xiaodi","can_delete":false,"product_type":"c1","uid":1511712,"ip_address":"","ucode":"B3FB301556A7EA","user_header":"https://static001.geekbang.org/account/avatar/00/17/11/20/9f31c4f4.jpg","comment_is_top":false,"comment_ctime":1628942001,"is_pvip":false,"replies":[{"id":"111314","content":"å¥½é—®é¢˜ï¼Œcolocated joinså¾ˆæœ‰æ„æ€ï¼Œå®ƒå…¶å®ç‰¹æŒ‡çš„æ˜¯è¿™ç§æƒ…å†µï¼Œå‚ä¸Joinçš„ä¸¤å¼ è¡¨ï¼š<br>1. å¹¶è¡Œåº¦ä¸€æ ·<br>2. ä»¥Join Keyä¸ºåŸºå‡†ï¼Œæ•°æ®åˆ†å¸ƒä¸€è‡´<br><br>æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶çš„ä¸¤å¼ è¡¨å‚ä¸çš„Joinï¼Œå°±å«colocated joinsã€‚<br><br>å…¶å®ï¼Œè¯´ç™½äº†ï¼Œå°±æ˜¯ä¸¤å¼ è¡¨çš„æ•°æ®åˆ†å¸ƒå®Œå…¨ä¸€è‡´ï¼ˆç›¸å¯¹Join Keyæ¥è¯´ï¼‰ã€‚å› æ­¤ï¼Œå¯¹ä»–ä»¬åšå…³è”ï¼Œè‡ªç„¶ä¸å†éœ€è¦Shuffleç¯èŠ‚ï¼Œå› ä¸ºä¸¤å¼ è¡¨çš„æ•°æ®åˆ†ç‰‡éƒ½å·²ç»ç›¸äº’â€œé…å¥½å¯¹â€äº†ï¼Œä¸¤è¾¹Join Keysç›¸åŒçš„æ•°æ®è®°å½•ï¼Œéƒ½åˆ†å¸ƒåœ¨åŒæ ·Executorsä¸­ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1629106152,"ip_address":"","comment_id":307215,"utype":1}],"discussion_count":4,"race_medal":0,"score":"5923909297","product_id":100073401,"comment_content":"è€å¸ˆï¼Œå¯¹äºè¯„è®ºåŒºé‡Œçš„è¯´åˆ°çš„colocated joinsï¼Œå¯å¦ç®€å•è¯´ä¸‹è¿è¡Œæœºåˆ¶ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525082,"discussion_content":"å¥½é—®é¢˜ï¼Œcolocated joinså¾ˆæœ‰æ„æ€ï¼Œå®ƒå…¶å®ç‰¹æŒ‡çš„æ˜¯è¿™ç§æƒ…å†µï¼Œå‚ä¸Joinçš„ä¸¤å¼ è¡¨ï¼š\n1. å¹¶è¡Œåº¦ä¸€æ ·\n2. ä»¥Join Keyä¸ºåŸºå‡†ï¼Œæ•°æ®åˆ†å¸ƒä¸€è‡´\n\næ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶çš„ä¸¤å¼ è¡¨å‚ä¸çš„Joinï¼Œå°±å«colocated joinsã€‚\n\nå…¶å®ï¼Œè¯´ç™½äº†ï¼Œå°±æ˜¯ä¸¤å¼ è¡¨çš„æ•°æ®åˆ†å¸ƒå®Œå…¨ä¸€è‡´ï¼ˆç›¸å¯¹Join Keyæ¥è¯´ï¼‰ã€‚å› æ­¤ï¼Œå¯¹ä»–ä»¬åšå…³è”ï¼Œè‡ªç„¶ä¸å†éœ€è¦Shuffleç¯èŠ‚ï¼Œå› ä¸ºä¸¤å¼ è¡¨çš„æ•°æ®åˆ†ç‰‡éƒ½å·²ç»ç›¸äº’â€œé…å¥½å¯¹â€äº†ï¼Œä¸¤è¾¹Join Keysç›¸åŒçš„æ•°æ®è®°å½•ï¼Œéƒ½åˆ†å¸ƒåœ¨åŒæ ·Executorsä¸­ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629106152,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1260182,"avatar":"https://static001.geekbang.org/account/avatar/00/13/3a/96/9fddfb4a.jpg","nickname":"èµµé¹ä¸¾","note":"","ucode":"B3785788D6176C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":540780,"discussion_content":"2.4ç¯å¢ƒä¸‹åº”è¯¥æ€æ ·è°ƒç”¨è¯¥åŠŸèƒ½å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640165521,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":525082,"ip_address":""},"score":540780,"extra":""}]},{"author":{"id":1086505,"avatar":"https://static001.geekbang.org/account/avatar/00/10/94/29/2ce8ffd5.jpg","nickname":"ä»¤ç‹å†²ã€‚ğŸ€ ğŸŒ» ğŸ¸","note":"","ucode":"5B46B5CE1C57C3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530768,"discussion_content":"å¦‚æœä¸¤ä¸ªè¡¨æ˜¯åŸºäºç›¸åŒçš„keyè¿›è¡Œåˆ†æ¡¶ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿæ˜¯colocated joinsï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637144448,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":1,"child_discussions":[{"author":{"id":1401217,"avatar":"https://static001.geekbang.org/account/avatar/00/15/61/81/9e34165b.jpg","nickname":"rovernerd","note":"","ucode":"C8620AAF0E4920","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1086505,"avatar":"https://static001.geekbang.org/account/avatar/00/10/94/29/2ce8ffd5.jpg","nickname":"ä»¤ç‹å†²ã€‚ğŸ€ ğŸŒ» ğŸ¸","note":"","ucode":"5B46B5CE1C57C3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542612,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640792965,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":530768,"ip_address":""},"score":542612,"extra":""}]}]},{"had_liked":false,"id":294273,"user_name":"å¨çŒ›çš„å°è€è™","can_delete":false,"product_type":"c1","uid":1785715,"ip_address":"","ucode":"817F254E6D28E2","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ2tyVlQiaqp5kEOf1LlZB6nJPicN8lzcEkAsSEDmicvib8T3xUEcDibRichLrh3Qiclo3UyuAhhKNGQxGmg/132","comment_is_top":false,"comment_ctime":1621859459,"is_pvip":false,"replies":[{"id":"106769","content":"å”¯ä¸€çš„åŠæ³•æ˜¯æŠŠCPJè½¬åŒ–ä¸ºBNLJï¼Œå¦‚æœå†…è¡¨ä¸å¤Ÿå°ï¼Œæ²¡æ³•å¹¿æ’­ï¼Œå¿…é¡»è¦ç”¨CPJæ¥å®ç°ï¼Œå¦ç™½è¯´ï¼Œè¿˜çœŸæ²¡ä»€ä¹ˆå¥½åŠæ³•ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦æåŠ›é¿å…CPJçš„åŸå› ~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1621866362,"ip_address":"","comment_id":294273,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5916826755","product_id":100073401,"comment_content":"ç¬›å¡å°”ç§¯ å¦‚ä½•ä¼˜åŒ–å‘¢","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520583,"discussion_content":"å”¯ä¸€çš„åŠæ³•æ˜¯æŠŠCPJè½¬åŒ–ä¸ºBNLJï¼Œå¦‚æœå†…è¡¨ä¸å¤Ÿå°ï¼Œæ²¡æ³•å¹¿æ’­ï¼Œå¿…é¡»è¦ç”¨CPJæ¥å®ç°ï¼Œå¦ç™½è¯´ï¼Œè¿˜çœŸæ²¡ä»€ä¹ˆå¥½åŠæ³•ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦æåŠ›é¿å…CPJçš„åŸå› ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621866362,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1785715,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ2tyVlQiaqp5kEOf1LlZB6nJPicN8lzcEkAsSEDmicvib8T3xUEcDibRichLrh3Qiclo3UyuAhhKNGQxGmg/132","nickname":"å¨çŒ›çš„å°è€è™","note":"","ucode":"817F254E6D28E2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375910,"discussion_content":"å—¯ï¼Œä¹Ÿæ˜¯å¤´ç–¼ã€‚è¡¨è‡ªå…³è”ã€‚åœ¨ä¸šåŠ¡å±‚é¢è¿›è¡Œäº†ä¸€å®šçš„ä¼˜åŒ–ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621866501,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":293118,"user_name":"jerry guo","can_delete":false,"product_type":"c1","uid":1267753,"ip_address":"","ucode":"179943AFCB93F8","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eo2GMhevabZrjINs2TKvIeGC7TJkicNlLvqTticuM5KL8ZN80OC2CnrsUyzPcZXO4uptj4Q1S4jT2lQ/132","comment_is_top":false,"comment_ctime":1621227046,"is_pvip":true,"replies":[{"id":"106294","content":"å¯¹ï¼Œéå¸¸å¥½~ æ»¡åˆ†ğŸ’¯ï¼ä½ è¯´çš„è¿™ä¸ªï¼Œå…¶å®å°±æ˜¯collocated joinsï¼Œcollocated joinsæ˜¯ä¸€ç§ç‰¹æ®Šçš„joinsï¼Œå°±æ˜¯å‚ä¸Joinçš„ä¸¤è¡¨æå‰æŒ‰ç…§Join Keyéƒ½åšäº†é‡åˆ†å¸ƒï¼Œé‚£ä¹ˆå†æ¬¡å…³è”çš„æ—¶å€™ï¼Œè‡ªç„¶ä¸ä¼šå¼•å…¥Shuffle~<br><br>ä¸è¿‡ï¼Œå¯¹äºä¸¤ä¸ªbucketè¡¨ï¼Œè¦æ±‚ä»–ä»¬çš„bucket idæ˜¯ä¸€è‡´çš„ï¼Œéƒ½è¦åŒ…å«Join Keyï¼Œå¦åˆ™å…³è”çš„æ—¶å€™è¿˜æ˜¯ä¼šæœ‰Shuffleã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1621414935,"ip_address":"","comment_id":293118,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5916194342","product_id":100073401,"comment_content":"å¦‚æœå¤–è¡¨æ˜¯bucketè¡¨ï¼Œå†…è¡¨ä¹Ÿæ˜¯ç›¸åŒçš„bucketè¡¨ï¼Œé‚£ä¹ˆä¹Ÿæ˜¯å¯ä»¥é¿å…å¤šæ¬¡æ‰«æå¤–è¡¨çš„ã€‚è¿™ç§æƒ…å†µè¯´ä¸å®šå¸shjæ›´å¥½ï¼Œå› ä¸ºä¸éœ€è¦shuffle","like_count":2,"discussions":[{"author":{"id":2304851,"avatar":"https://static001.geekbang.org/account/avatar/00/23/2b/53/1adc2037.jpg","nickname":"é£å‘å†³å®šå‘å‹","note":"","ucode":"7EE798C3ADFC11","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":410793,"discussion_content":"è¿™ä¸ªè·Ÿhiveé‡Œé¢çš„æ¡¶è¡¨è§£å†³æ•°æ®å€¾æ–œçš„æ€è·¯æ˜¯ä¸€è‡´çš„","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1635777182,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520083,"discussion_content":"å¯¹ï¼Œéå¸¸å¥½~ æ»¡åˆ†ğŸ’¯ï¼ä½ è¯´çš„è¿™ä¸ªï¼Œå…¶å®å°±æ˜¯collocated joinsï¼Œcollocated joinsæ˜¯ä¸€ç§ç‰¹æ®Šçš„joinsï¼Œå°±æ˜¯å‚ä¸Joinçš„ä¸¤è¡¨æå‰æŒ‰ç…§Join Keyéƒ½åšäº†é‡åˆ†å¸ƒï¼Œé‚£ä¹ˆå†æ¬¡å…³è”çš„æ—¶å€™ï¼Œè‡ªç„¶ä¸ä¼šå¼•å…¥Shuffle~\n\nä¸è¿‡ï¼Œå¯¹äºä¸¤ä¸ªbucketè¡¨ï¼Œè¦æ±‚ä»–ä»¬çš„bucket idæ˜¯ä¸€è‡´çš„ï¼Œéƒ½è¦åŒ…å«Join Keyï¼Œå¦åˆ™å…³è”çš„æ—¶å€™è¿˜æ˜¯ä¼šæœ‰Shuffleã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1621414935,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":293115,"user_name":"licl1008","can_delete":false,"product_type":"c1","uid":1265135,"ip_address":"","ucode":"6467D6DB97A00A","user_header":"","comment_is_top":false,"comment_ctime":1621223944,"is_pvip":false,"replies":[{"id":"106274","content":"å¥½é—®é¢˜ï¼ŒDPPç¡®å®æœ‰è¿™æ–¹é¢çš„é™åˆ¶ï¼Œå°±æ˜¯è¦æ±‚Join Keyæœ¬èº«æ˜¯åˆ†åŒºé”®ï¼Œè¿™ä¸ªè¦æ±‚ç¡®å®æ¯”è¾ƒè‹›åˆ»ã€‚Join Keyå’Œåˆ†åŒºé”®ç¡®å®æœ¬èº«æ˜¯ä¸€å¯¹çŸ›ç›¾ï¼Œå› ä¸ºé€šå¸¸æ¥è¯´ï¼ŒJoin Keyçš„cardinalityéƒ½ä¸å°ï¼Œè€Œåˆ†åŒºé”®å´è¦æ±‚cardinalityä¸èƒ½å¤ªå¤§ã€‚<br><br>ä½ è¯´çš„æ˜¯å¯¹çš„ï¼Œæˆ‘ä»¬è¿™ä¸ªä¾‹å­å…¶å®ä¸¾çš„ä¸å¥½ï¼Œè¿™é‡Œä¸ºäº†demo DPPï¼Œæˆ‘ä»¬é€‰æ‹©äº†orderIDï¼Œä½†å®é™…ä¸Šå°±åƒä½ è¯´çš„ï¼ŒorderIDæœ¬èº«çš„cardinalityå¤ªå¤§äº†ï¼Œä¸é€‚åˆåšåˆ†åŒºé”®ã€‚<br><br>æ‰€ä»¥è¯´ï¼Œåˆ©ç”¨DPPæœºåˆ¶æœ‰ä¸ªå¾ˆé‡è¦çš„å‰æï¼Œå°±æ˜¯æ•°ä»“çš„è®¾è®¡ï¼Œä¹Ÿå°±æ˜¯ç»“åˆåç»­å¸¸ç”¨çš„æŸ¥è¯¢ï¼Œæå‰æŠŠè¡¨ç»“æ„è®¾è®¡å¥½ã€‚è¿™ä¸ªè¡¨ç»“æ„çš„è®¾è®¡ï¼Œå°±éœ€è¦è€ƒè™‘Join Keyså’Œåˆ†åŒºé”®çš„åšå¼ˆ~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1621411348,"ip_address":"","comment_id":293115,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5916191240","product_id":100073401,"comment_content":"è€å¸ˆ ç°å®ä¸­ç”¨orderIDä½œä¸ºåˆ†åŒºé”® æ˜¯ä¸æ˜¯åˆ†åŒºä¼šå¤ªå¤š æ„Ÿè§‰è®¢å•IDåŸºæ•°å¾ˆå¤§","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520080,"discussion_content":"å¥½é—®é¢˜ï¼ŒDPPç¡®å®æœ‰è¿™æ–¹é¢çš„é™åˆ¶ï¼Œå°±æ˜¯è¦æ±‚Join Keyæœ¬èº«æ˜¯åˆ†åŒºé”®ï¼Œè¿™ä¸ªè¦æ±‚ç¡®å®æ¯”è¾ƒè‹›åˆ»ã€‚Join Keyå’Œåˆ†åŒºé”®ç¡®å®æœ¬èº«æ˜¯ä¸€å¯¹çŸ›ç›¾ï¼Œå› ä¸ºé€šå¸¸æ¥è¯´ï¼ŒJoin Keyçš„cardinalityéƒ½ä¸å°ï¼Œè€Œåˆ†åŒºé”®å´è¦æ±‚cardinalityä¸èƒ½å¤ªå¤§ã€‚\n\nä½ è¯´çš„æ˜¯å¯¹çš„ï¼Œæˆ‘ä»¬è¿™ä¸ªä¾‹å­å…¶å®ä¸¾çš„ä¸å¥½ï¼Œè¿™é‡Œä¸ºäº†demo DPPï¼Œæˆ‘ä»¬é€‰æ‹©äº†orderIDï¼Œä½†å®é™…ä¸Šå°±åƒä½ è¯´çš„ï¼ŒorderIDæœ¬èº«çš„cardinalityå¤ªå¤§äº†ï¼Œä¸é€‚åˆåšåˆ†åŒºé”®ã€‚\n\næ‰€ä»¥è¯´ï¼Œåˆ©ç”¨DPPæœºåˆ¶æœ‰ä¸ªå¾ˆé‡è¦çš„å‰æï¼Œå°±æ˜¯æ•°ä»“çš„è®¾è®¡ï¼Œä¹Ÿå°±æ˜¯ç»“åˆåç»­å¸¸ç”¨çš„æŸ¥è¯¢ï¼Œæå‰æŠŠè¡¨ç»“æ„è®¾è®¡å¥½ã€‚è¿™ä¸ªè¡¨ç»“æ„çš„è®¾è®¡ï¼Œå°±éœ€è¦è€ƒè™‘Join Keyså’Œåˆ†åŒºé”®çš„åšå¼ˆ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621411348,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":342694,"user_name":"sweet smile","can_delete":false,"product_type":"c1","uid":2956361,"ip_address":"","ucode":"B0D0B3502AA7A1","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ4VFiaGZicIG5Fx9pMd8vibntD6E91IdzKgER10wJUSas2G8zib1pl5yzMFvkIA5zLBDB8Wa21xkynIw/132","comment_is_top":false,"comment_ctime":1650422063,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1650422063","product_id":100073401,"comment_content":"è€å¸ˆï¼Œæœ‰ä¸ªç–‘é—®ï¼Œå°±æ˜¯å’±ä»¬ä½¿ç”¨DPPçš„æœºåˆ¶æ¥é˜²æ­¢å¤–è¡¨è¿›è¡Œé‡å¤æ‰«æï¼Œä½†æ˜¯DPPæœºåˆ¶è¦æ±‚joinkeyæ˜¯åˆ†åŒºå­—æ®µã€‚ä½†æ˜¯æ—¥å¸¸ä¸­joinkeyå¾€å¾€æ˜¯ä¸šåŠ¡ä¸»é”®ï¼Œå¦‚æœæŠŠä¸šåŠ¡ä¸»é”®è®¾è®¡æˆåˆ†åŒºå­—æ®µï¼Œè¿™æ ·æ˜¯ä¸æ˜¯ä¸å¤ªåˆç†å‘€ã€‚æ¯”å¦‚è¯´å’±ä»¬æ¡ˆä¾‹é‡Œé¢çš„orderIDå­—æ®µã€‚","like_count":1,"discussions":[{"author":{"id":1296063,"avatar":"https://static001.geekbang.org/account/avatar/00/13/c6/bf/52b3f71d.jpg","nickname":"dawn","note":"","ucode":"1757B28F1EF5C4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585941,"discussion_content":"ä¸€èˆ¬ä¸æ˜¯æ—¶é—´å­—æ®µæ¥åˆ†åŒºçš„å˜›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661914714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ±Ÿè‹"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":302998,"user_name":"é™ˆå¨æ´‹","can_delete":false,"product_type":"c1","uid":2264679,"ip_address":"","ucode":"DCF84B4D3A7354","user_header":"https://static001.geekbang.org/account/avatar/00/22/8e/67/afb412fb.jpg","comment_is_top":false,"comment_ctime":1626507939,"is_pvip":false,"replies":[{"id":"109816","content":"è¿˜æœ‰ä¸€ç§æ€è·¯ï¼Œå°±æ˜¯ç³»ç»Ÿé›†æˆã€‚<br><br>ä¹‹å‰æœ‰ä¸€ä¸ªå†…å­˜åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œå«Tachyonï¼Œåæ¥æ”¹åå«Alluxioï¼Œå¯ä»¥ç†è§£ä¸ºå†…å­˜é‡Œé¢çš„HDFSã€‚å®ƒæä¾›å†…å­˜çº§åˆ«çš„æ–‡ä»¶ç³»ç»Ÿã€‚<br><br>Alluxioä¸å°‘å…¬å¸åœ¨ç”¨ï¼Œå°±ç”¨æ¥åŠ é€Ÿæ•°æ®è®¿é—®çš„ï¼Œä»–ä»¬æå‰æŠŠâ€œçƒ­æ•°æ®â€ä»HDFSåŠ è½½åˆ°Alluxioï¼Œç„¶åSparkå†ä»Alluxioè®¿é—®åˆ†å¸ƒå¼å†…å­˜æ–‡ä»¶ï¼ŒæŠŠç£ç›˜I&#47;Oå˜æˆäº†å†…å­˜è®¿é—®ã€‚è¯»å–æ•ˆç‡è‡ªç„¶èƒ½æå‡ä¸å°‘ã€‚<br><br>å½“ç„¶ï¼Œåšè¿™ç§ç³»ç»Ÿé›†æˆçš„å‰ææ˜¯â€œæœ‰é’±â€ï¼Œå¾—æœ‰è¶³å¤Ÿçš„é¢„ç®—æ¥è´­ç½®å¤§é‡å†…å­˜ï¼Œä¸è¿‡ï¼Œè¿˜æ˜¯é‚£å¥è¯ï¼Œè°ƒä¼˜æœ€é‡è¦çš„æ˜¯æ€è·¯å’Œæ‰‹æ®µï¼Œæ¯ç§æ–¹æ³•éƒ½æœ‰å…¶ä¼˜ç¼ºç‚¹ã€‚ç¡®å®æœ‰å¤§å‚å®æ„¿å¤šèŠ±é’±ä¹°å†…å­˜æ¥èŠ‚çœæ—¶é—´ã€‚<br><br>æ€»ä¹‹ï¼Œè¿™ç§ç³»ç»Ÿé›†æˆçš„æ€è·¯ä¹Ÿæ˜¯ä¸€ç§ä¼˜åŒ–é€‰é¡¹ï¼Œåœ¨æ¡ä»¶å…·å¤‡çš„æ—¶å€™ï¼Œä¸å¦¨åŠ ä»¥è€ƒè™‘~<br><br>å…¶å®æ²¿ç€è¿™ä¸ªæ€è·¯ï¼Œä½ è¿˜å¯ä»¥å‘ç°æ›´å¤šé›†æˆçš„å¯èƒ½ï¼ŒAlluxioè¿™é‡Œä»…ä»…æ˜¯ä¸¾ä¸ªä¾‹å­åŠ ä»¥è¯´æ˜ï¼Œå…¶å®å’±ä»¬ä½œä¸ºå¼€å‘è€…ï¼Œå¹³æ—¶è¦å¤šå…³æ³¨æŠ€æœ¯åŠ¨æ€å’Œè¿›å±•ï¼Œå¼€é˜”çœ¼ç•Œå’Œæ€è·¯ï¼Œæˆ‘è§‰å¾—è¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼Œä¸ªäººè§‚ç‚¹å“ˆ~ ä¸ä¸€å®šå¯¹~<br><br>ä¸€ä¸ªæ–°æŠ€æœ¯ï¼Œä¸ç®¡å°†æ¥ç”¨ä¸ç”¨å¾—ä¸Šï¼Œå¤šäº†è§£ã€ç†Ÿæ‚‰ä¸€äº›ï¼Œæ€»æ˜¯ä¸åƒäºçš„~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1626775975,"ip_address":"","comment_id":302998,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1626507939","product_id":100073401,"comment_content":"é—®é¢˜å›ç­”ï¼š<br>é™¤äº†shuffleï¼Œæƒ³ä¸å‡ºå…¶ä»–åŠæ³•....å“­~","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523507,"discussion_content":"è¿˜æœ‰ä¸€ç§æ€è·¯ï¼Œå°±æ˜¯ç³»ç»Ÿé›†æˆã€‚\n\nä¹‹å‰æœ‰ä¸€ä¸ªå†…å­˜åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œå«Tachyonï¼Œåæ¥æ”¹åå«Alluxioï¼Œå¯ä»¥ç†è§£ä¸ºå†…å­˜é‡Œé¢çš„HDFSã€‚å®ƒæä¾›å†…å­˜çº§åˆ«çš„æ–‡ä»¶ç³»ç»Ÿã€‚\n\nAlluxioä¸å°‘å…¬å¸åœ¨ç”¨ï¼Œå°±ç”¨æ¥åŠ é€Ÿæ•°æ®è®¿é—®çš„ï¼Œä»–ä»¬æå‰æŠŠâ€œçƒ­æ•°æ®â€ä»HDFSåŠ è½½åˆ°Alluxioï¼Œç„¶åSparkå†ä»Alluxioè®¿é—®åˆ†å¸ƒå¼å†…å­˜æ–‡ä»¶ï¼ŒæŠŠç£ç›˜I/Oå˜æˆäº†å†…å­˜è®¿é—®ã€‚è¯»å–æ•ˆç‡è‡ªç„¶èƒ½æå‡ä¸å°‘ã€‚\n\nå½“ç„¶ï¼Œåšè¿™ç§ç³»ç»Ÿé›†æˆçš„å‰ææ˜¯â€œæœ‰é’±â€ï¼Œå¾—æœ‰è¶³å¤Ÿçš„é¢„ç®—æ¥è´­ç½®å¤§é‡å†…å­˜ï¼Œä¸è¿‡ï¼Œè¿˜æ˜¯é‚£å¥è¯ï¼Œè°ƒä¼˜æœ€é‡è¦çš„æ˜¯æ€è·¯å’Œæ‰‹æ®µï¼Œæ¯ç§æ–¹æ³•éƒ½æœ‰å…¶ä¼˜ç¼ºç‚¹ã€‚ç¡®å®æœ‰å¤§å‚å®æ„¿å¤šèŠ±é’±ä¹°å†…å­˜æ¥èŠ‚çœæ—¶é—´ã€‚\n\næ€»ä¹‹ï¼Œè¿™ç§ç³»ç»Ÿé›†æˆçš„æ€è·¯ä¹Ÿæ˜¯ä¸€ç§ä¼˜åŒ–é€‰é¡¹ï¼Œåœ¨æ¡ä»¶å…·å¤‡çš„æ—¶å€™ï¼Œä¸å¦¨åŠ ä»¥è€ƒè™‘~\n\nå…¶å®æ²¿ç€è¿™ä¸ªæ€è·¯ï¼Œä½ è¿˜å¯ä»¥å‘ç°æ›´å¤šé›†æˆçš„å¯èƒ½ï¼ŒAlluxioè¿™é‡Œä»…ä»…æ˜¯ä¸¾ä¸ªä¾‹å­åŠ ä»¥è¯´æ˜ï¼Œå…¶å®å’±ä»¬ä½œä¸ºå¼€å‘è€…ï¼Œå¹³æ—¶è¦å¤šå…³æ³¨æŠ€æœ¯åŠ¨æ€å’Œè¿›å±•ï¼Œå¼€é˜”çœ¼ç•Œå’Œæ€è·¯ï¼Œæˆ‘è§‰å¾—è¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼Œä¸ªäººè§‚ç‚¹å“ˆ~ ä¸ä¸€å®šå¯¹~\n\nä¸€ä¸ªæ–°æŠ€æœ¯ï¼Œä¸ç®¡å°†æ¥ç”¨ä¸ç”¨å¾—ä¸Šï¼Œå¤šäº†è§£ã€ç†Ÿæ‚‰ä¸€äº›ï¼Œæ€»æ˜¯ä¸åƒäºçš„~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626775975,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2264679,"avatar":"https://static001.geekbang.org/account/avatar/00/22/8e/67/afb412fb.jpg","nickname":"é™ˆå¨æ´‹","note":"","ucode":"DCF84B4D3A7354","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384878,"discussion_content":"éå¸¸èµåŒå¼€æ‹“çœ¼ç•Œå’Œæ€è·¯çš„å»ºè®®ï¼Œæˆ‘ç»å¸¸ä¸ŠInf Qå“ˆå“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626779751,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":301098,"user_name":"ç©ºæ ¼","can_delete":false,"product_type":"c1","uid":2654533,"ip_address":"","ucode":"7609477C8B5EBB","user_header":"https://static001.geekbang.org/account/avatar/00/28/81/45/37db494c.jpg","comment_is_top":false,"comment_ctime":1625536170,"is_pvip":false,"replies":[{"id":"109176","content":"éœ€è¦ç»“åˆDPPæœºåˆ¶æ‰è¡Œå“ˆ~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1625800870,"ip_address":"","comment_id":301098,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1625536170","product_id":100073401,"comment_content":"è€å¸ˆï¼Œdemoä¸­æŒ‰ç…§dateå¾ªç¯æŸ¥è¯¢çš„sqlç›´æ¥ä½¿ç”¨spark sqlæ‰§è¡Œå¯ä»¥å®ç°å¤–è¾¹æ‰«æä¸€æ¬¡å˜›ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522897,"discussion_content":"éœ€è¦ç»“åˆDPPæœºåˆ¶æ‰è¡Œå“ˆ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625800870,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2654533,"avatar":"https://static001.geekbang.org/account/avatar/00/28/81/45/37db494c.jpg","nickname":"ç©ºæ ¼","note":"","ucode":"7609477C8B5EBB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383952,"discussion_content":"äº†è§£äº†ï¼Œæ„Ÿè°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626316591,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":299192,"user_name":"orangelin","can_delete":false,"product_type":"c1","uid":2010843,"ip_address":"","ucode":"730CC9997C16F2","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoG8k56TKsdCmVletmYKYwibickH5Ced8UyxicpY9icZEM2ZTcqyUaEk2PRmH1FVLtGTggw/132","comment_is_top":false,"comment_ctime":1624504980,"is_pvip":true,"replies":[{"id":"108576","content":"è¿™æ ·åšç¡®å®èƒ½é™ä½åˆ†åŒºé”®çš„Cardinalityï¼Œä»è€Œç¼“è§£åˆ†åŒºå­˜å‚¨çš„å‹åŠ›ã€‚ä¸è¿‡æŒ‰ç…§å°¾å·å¯¹orderIdåšå…³è”ï¼Œä¸šåŠ¡é€»è¾‘ä¸Šä¼¼ä¹ä¸æˆç«‹ã€‚å› ä¸ºä¸€èˆ¬æ¥è¯´ï¼Œè‚¯å®šæ˜¯orderIdè¦å®Œå…¨ä¸€è‡´Joinåœ¨ä¸€èµ·æ‰ä¼šæœ‰æ„ä¹‰ï¼Œå¦åˆ™ï¼Œä»…ä»…æ˜¯å°¾å·ç›¸åŒã€ä½†å®é™…æ˜¯ä¸åŒçš„orderIdï¼Œä»–ä»¬joinåœ¨ä¸€èµ·å…¶å®ä¸šåŠ¡é€»è¾‘ä¸Šè¯´ä¸é€šçš„~<br><br>ä¸è¿‡ï¼Œè¯è¯´å›æ¥ï¼Œå¦‚æœç¡®å®å…³è”æ¡ä»¶å°±æ˜¯orderIdçš„å°¾å·ï¼Œé‚£ä¹ˆåœ¨è¿è¡Œæ—¶ä¹Ÿæ˜¯ä¼šè§¦å‘DPPçš„ï¼Œæ¯•ç«Ÿä½ è¯´çš„è¿™ç§åœºæ™¯æ˜¯æ»¡è¶³DPPçš„å„ç§å‰ææ¡ä»¶çš„~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1624633567,"ip_address":"","comment_id":299192,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1624504980","product_id":100073401,"comment_content":"è™½ç„¶orderidä½œä¸ºåˆ†åŒºé”®æœ‰ç‚¹å¤ªå¤šï¼Œæ˜¯å¦å¯ä»¥è€ƒè™‘æŒ‰ç…§orderidçš„æ•°æ®ç‰¹å¾ï¼Œæ¯”å¦‚idæ˜¯å­—æ¯ç»“å°¾äº¦æˆ–è€…æ˜¯æ•°å­—ç»“å°¾ï¼ŒæŒ‰è¿™ä¸ªåˆ—å»åšåˆ†åŒºæ˜¯å¯ä»¥å‡å°‘ä¸€å®šçš„åˆ†åŒºæ•°ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘çš„åˆ†åŒºå…³è”æ¡ä»¶æ˜¯ æ•°å­—idçš„å°¾å·ï¼Œé‚£ä¹ˆå…³è”çš„åˆ†åŒºæœ€å¤šå°±æ˜¯ä»0-9çš„10ä¸ªæ•°å­—ï¼Œç”¨è¿™ç§æ–¹å¼çš„è¯æ˜¯å¯ä»¥è§¦å‘dppå‘¢","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522359,"discussion_content":"è¿™æ ·åšç¡®å®èƒ½é™ä½åˆ†åŒºé”®çš„Cardinalityï¼Œä»è€Œç¼“è§£åˆ†åŒºå­˜å‚¨çš„å‹åŠ›ã€‚ä¸è¿‡æŒ‰ç…§å°¾å·å¯¹orderIdåšå…³è”ï¼Œä¸šåŠ¡é€»è¾‘ä¸Šä¼¼ä¹ä¸æˆç«‹ã€‚å› ä¸ºä¸€èˆ¬æ¥è¯´ï¼Œè‚¯å®šæ˜¯orderIdè¦å®Œå…¨ä¸€è‡´Joinåœ¨ä¸€èµ·æ‰ä¼šæœ‰æ„ä¹‰ï¼Œå¦åˆ™ï¼Œä»…ä»…æ˜¯å°¾å·ç›¸åŒã€ä½†å®é™…æ˜¯ä¸åŒçš„orderIdï¼Œä»–ä»¬joinåœ¨ä¸€èµ·å…¶å®ä¸šåŠ¡é€»è¾‘ä¸Šè¯´ä¸é€šçš„~\n\nä¸è¿‡ï¼Œè¯è¯´å›æ¥ï¼Œå¦‚æœç¡®å®å…³è”æ¡ä»¶å°±æ˜¯orderIdçš„å°¾å·ï¼Œé‚£ä¹ˆåœ¨è¿è¡Œæ—¶ä¹Ÿæ˜¯ä¼šè§¦å‘DPPçš„ï¼Œæ¯•ç«Ÿä½ è¯´çš„è¿™ç§åœºæ™¯æ˜¯æ»¡è¶³DPPçš„å„ç§å‰ææ¡ä»¶çš„~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624633567,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":294200,"user_name":"å¤©ç¿¼","can_delete":false,"product_type":"c1","uid":2459638,"ip_address":"","ucode":"82153820B786E0","user_header":"https://static001.geekbang.org/account/avatar/00/25/87/f6/bc199560.jpg","comment_is_top":false,"comment_ctime":1621828187,"is_pvip":false,"replies":[{"id":"106771","content":"æ˜¯çš„ï¼Œä¸»è¦æ˜¯è¡¨å¤§å°ï¼Œé€šå¸¸æ¥è¯´ï¼Œå¤§å¤šæ•°æ•°æ®åº“å¼•æ“ï¼Œéƒ½ä¼šæŠŠå°ºå¯¸æ¯”è¾ƒå¤§çš„è¡¨ï¼Œå½“ä½œå¤–è¡¨ï¼›è€Œå°ºå¯¸è¾ƒå°çš„è¡¨ï¼Œå½“ä½œå†…è¡¨ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1621866714,"ip_address":"","comment_id":294200,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1621828187","product_id":100073401,"comment_content":"è¯·é—®ä¸€ä¸‹ï¼Œè€å¸ˆçš„å†…è¡¨å’Œå¤–è¡¨çš„å®šä¹‰æ˜¯æ€ä¹ˆæ¥çš„ï¼Œæ˜¯æ ¹æ®è¡¨çš„å¤§å°å—ï¼Ÿè¿˜æ˜¯è¯´æœ‰ä»€ä¹ˆå…¶ä»–çš„åˆ¤æ–­ä¾æ®ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520555,"discussion_content":"æ˜¯çš„ï¼Œä¸»è¦æ˜¯è¡¨å¤§å°ï¼Œé€šå¸¸æ¥è¯´ï¼Œå¤§å¤šæ•°æ•°æ®åº“å¼•æ“ï¼Œéƒ½ä¼šæŠŠå°ºå¯¸æ¯”è¾ƒå¤§çš„è¡¨ï¼Œå½“ä½œå¤–è¡¨ï¼›è€Œå°ºå¯¸è¾ƒå°çš„è¡¨ï¼Œå½“ä½œå†…è¡¨ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621866714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":293077,"user_name":"æ–¯ç›–ä¸¸","can_delete":false,"product_type":"c1","uid":1168504,"ip_address":"","ucode":"B881D14B028F14","user_header":"https://static001.geekbang.org/account/avatar/00/11/d4/78/66b3f2a2.jpg","comment_is_top":false,"comment_ctime":1621206101,"is_pvip":false,"replies":[{"id":"106292","content":"è¿™é‡Œé¢txè¡¨æ˜¯äº‹å®è¡¨å“ˆï¼Œå®ƒçš„åˆ†åŒºé”®æ˜¯orderIdï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><br>&#47;&#47;lineitemsè¡¨çš„å…³é”®å­—æ®µ<br>orderId: Int &#47;&#47;åˆ†åŒºé”®<br>txId: Int<br>itemId: Int<br>price: Float<br>quantity: Int<br><br>Join keyæ˜¯orderIdï¼Œä¹Ÿå°±æ˜¯on tx.orderId = o.orderIdï¼Œå› æ­¤å°±è¿™ä¸ªä¾‹å­æ¥è¯´ï¼Œæ˜¯å¯ä»¥è§¦å‘DPPçš„ï¼Œå½“ç„¶ï¼Œtxè¡¨é€‰orderIdä½œä¸ºåˆ†åŒºé”®ï¼Œæ˜¯å€¼å¾—å•†æ¦·çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1621414516,"ip_address":"","comment_id":293077,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1621206101","product_id":100073401,"comment_content":"è€å¸ˆï¼Œä½ çš„ä¾‹å­é‡Œï¼Œtxè¡¨çš„joinæ¡ä»¶æ²¡æœ‰ç”¨åˆ°dateï¼Œè€ŒDPPçš„å®ç°å¿…é¡»ä¾èµ–joinæ¡ä»¶é‡ŒåŒ…å«åˆ†åŒºå­—æ®µï¼Œä¹Ÿå°±æ˜¯dateæ‰å¯ä»¥çš„ï¼Œè¿™æ ·å¥½åƒä¸èƒ½å®ç°ä¼˜åŒ–å§ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520060,"discussion_content":"è¿™é‡Œé¢txè¡¨æ˜¯äº‹å®è¡¨å“ˆï¼Œå®ƒçš„åˆ†åŒºé”®æ˜¯orderIdï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n//lineitemsè¡¨çš„å…³é”®å­—æ®µ\norderId: Int //åˆ†åŒºé”®\ntxId: Int\nitemId: Int\nprice: Float\nquantity: Int\n\nJoin keyæ˜¯orderIdï¼Œä¹Ÿå°±æ˜¯on tx.orderId = o.orderIdï¼Œå› æ­¤å°±è¿™ä¸ªä¾‹å­æ¥è¯´ï¼Œæ˜¯å¯ä»¥è§¦å‘DPPçš„ï¼Œå½“ç„¶ï¼Œtxè¡¨é€‰orderIdä½œä¸ºåˆ†åŒºé”®ï¼Œæ˜¯å€¼å¾—å•†æ¦·çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621414516,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1370659,"avatar":"https://static001.geekbang.org/account/avatar/00/14/ea/23/508f71e3.jpg","nickname":"Jefitar","note":"","ucode":"D7ED9F32ADA5B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374508,"discussion_content":"DPPçš„æ¡ä»¶æ˜¯ï¼Œå¤§è¡¨çš„åˆ†åŒºé”®åŒ…å«å¤§å°è¡¨çš„join keysï¼Œè·Ÿå°è¡¨çš„åˆ†åŒºé”®æ²¡å…³ç³»å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621220993,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":1370659,"avatar":"https://static001.geekbang.org/account/avatar/00/14/ea/23/508f71e3.jpg","nickname":"Jefitar","note":"","ucode":"D7ED9F32ADA5B1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375928,"discussion_content":"å¯¹ï¼Œæ²¡é”™~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621871126,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":374508,"ip_address":""},"score":375928,"extra":""}]}]}]}