{"id":128178,"title":"17 | 赋值和算数运算符","content":"<p><strong>课件地址</strong></p><p><a href=\"https://gitee.com/geektime-geekbang/swift-course\">https://gitee.com/geektime-geekbang/swift-course</a></p>","comments":[{"had_liked":false,"id":153851,"user_name":"Life is fantastic","can_delete":false,"product_type":"c3","uid":1627686,"ip_address":"","ucode":"CB53002C82F1AA","user_header":"https://static001.geekbang.org/account/avatar/00/18/d6/26/8c06d424.jpg","comment_is_top":false,"comment_ctime":1574318710,"is_pvip":false,"replies":[{"id":59134,"content":"我把你的例子改了一下，既然是赋值运算，你的实现里明显不是。\n\ninfix operator +-☀ : PlusMinusPrecedence\n\nprecedencegroup PlusMinusPrecedence {\n    associativity: none\n    higherThan: AdditionPrecedence\n    lowerThan: MultiplicationPrecedence\n    assignment: true\n}\n\nstruct Point {\n    var x: Int, y: Int\n    static func +-☀(left: inout Point, right: Point) {\n        left = Point(x: left.x + right.x, y: left.y - right.y)\n    }\n}\n\nstruct Person {\n    var point: Point\n}\nvar person: Person?\nperson?.point +-☀ Point(x: 10, y: 20)\nprint(person?.point as Any)\n\n你可以尝试把assignment的true改成false，是会报错的，所以assignment的可选链里的作用如下：\n\n“This proposal quietly drops the assignment modifier that exists on operators today. This modifier had one important function–an operator marked assignment gets folded into an optional chain, allowing foo?.bar += 2 to work as foo?(.bar += 2) instead of failing to type-check as (foo?.bar) += 2. In practice, all Swift operators currently marked assignment are at the equivalent of the Assignment precedence level, so the core team recommends making this optional chaining interaction a special feature of the Assignment precedence group.”","user_name":"作者回复","user_name_real":"Geek_f72435","uid":1341726,"ctime":1574330391,"ip_address":"","comment_id":153851,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"不好意思，前几天学所有权在消化做笔记。今天把这段代码分享给老师和大家，代码来源于互联网，注释为本人注释，如有不对的地方请大家指正，。\nprefix operator +☀\ninfix operator +-☀ : PlusMinusPrecedence\n\nprecedencegroup PlusMinusPrecedence {\n    associativity: none &#47;&#47; 结合性(left\\right\\none)\n    higherThan: AdditionPrecedence &#47;&#47;比谁的优先级高\n    lowerThan: MultiplicationPrecedence&#47;&#47;比谁的优先级低，不能是该模块内部的\n    assignment: false  &#47;&#47;如果设置成true，那么遇到可选链的时候该操作符就相当于赋值操作符。否则false就不执行赋值操作。\n}\n\n\nstruct Point {\n    var x: Int, y: Int\n    static prefix func +☀(point: inout Point) -&gt; Point {\n        point = Point(x: point.x + point.x, y: point.y + point.y)\n        return point\n    }\n    static func +-☀(left: Point,right: Point) -&gt; Point {\n        return Point(x: left.x + right.x, y: left.y - right.y)\n    }\n    static func +-☀(left: Point?,right: Point) -&gt; Point {\n        print(&quot;+-☀&quot;)\n        return Point(x: left?.x ?? 0 + right.x, y: left?.y ?? 0 - right.y)\n    }\n}\n\nstruct Person {\n    var point: Point &#47;&#47;= Point(x: 10, y: 20)\n}\nvar person: Person? &#47;&#47;= Person.init()\nperson?.point +-☀ Point(x: 10, y: 20)&#47;&#47;(Point(x: 10, y: 20) +-☀ Point(x: 10, y: 20))\nprint(person?.point as Any)\nvar test = Point(x: 10, y: 20)\nPoint(x: 10, y: 20) +-☀ (+☀test)","like_count":1,"discussions":[{"author":{"id":1341726,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLxtKhpmvzx2VB4iajicfJVFmQR3eP3xBpdpQEovpSqUfAOrNImvYwVb7P37ibI0ONziau9sbFEk8oDaA/132","nickname":"elfgate","note":"","ucode":"3C0B5F7C1F664C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475297,"discussion_content":"我把你的例子改了一下，既然是赋值运算，你的实现里明显不是。\n\ninfix operator +-☀ : PlusMinusPrecedence\n\nprecedencegroup PlusMinusPrecedence {\n    associativity: none\n    higherThan: AdditionPrecedence\n    lowerThan: MultiplicationPrecedence\n    assignment: true\n}\n\nstruct Point {\n    var x: Int, y: Int\n    static func +-☀(left: inout Point, right: Point) {\n        left = Point(x: left.x + right.x, y: left.y - right.y)\n    }\n}\n\nstruct Person {\n    var point: Point\n}\nvar person: Person?\nperson?.point +-☀ Point(x: 10, y: 20)\nprint(person?.point as Any)\n\n你可以尝试把assignment的true改成false，是会报错的，所以assignment的可选链里的作用如下：\n\n“This proposal quietly drops the assignment modifier that exists on operators today. This modifier had one important function–an operator marked assignment gets folded into an optional chain, allowing foo?.bar += 2 to work as foo?(.bar += 2) instead of failing to type-check as (foo?.bar) += 2. In practice, all Swift operators currently marked assignment are at the equivalent of the Assignment precedence level, so the core team recommends making this optional chaining interaction a special feature of the Assignment precedence group.”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574330391,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1627686,"avatar":"https://static001.geekbang.org/account/avatar/00/18/d6/26/8c06d424.jpg","nickname":"Life is fantastic","note":"","ucode":"CB53002C82F1AA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":54990,"discussion_content":"感谢老师的教导，谢谢！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574330759,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132309,"user_name":"Life is fantastic","can_delete":false,"product_type":"c3","uid":1627686,"ip_address":"","ucode":"CB53002C82F1AA","user_header":"https://static001.geekbang.org/account/avatar/00/18/d6/26/8c06d424.jpg","comment_is_top":false,"comment_ctime":1568081764,"is_pvip":false,"replies":[{"id":58090,"content":"assignment只是表明是否是赋值，你这个有代码么，拿出来看一下","user_name":"作者回复","user_name_real":"Geek_f72435","uid":1341726,"ctime":1573639745,"ip_address":"","comment_id":132309,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"高级运算符文档中，在定义优先级组的时候有个布尔值的属性assignment，设置true的时候有什么讲究。看了人家写的代码可选链为空的时候做赋值运算返回nil，而不是中缀运算了。可以看出这个中缀自定义的运算符相当于赋值运算符了，并不会调用左边形式参数为可选类型的自定义运算。","like_count":0,"discussions":[{"author":{"id":1341726,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLxtKhpmvzx2VB4iajicfJVFmQR3eP3xBpdpQEovpSqUfAOrNImvYwVb7P37ibI0ONziau9sbFEk8oDaA/132","nickname":"elfgate","note":"","ucode":"3C0B5F7C1F664C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466869,"discussion_content":"assignment只是表明是否是赋值，你这个有代码么，拿出来看一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573639745,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1627686,"avatar":"https://static001.geekbang.org/account/avatar/00/18/d6/26/8c06d424.jpg","nickname":"Life is fantastic","note":"","ucode":"CB53002C82F1AA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":8844,"discussion_content":"有时候文档内容太专业，翻译过来理解不了，又没有代码所以看了很知乎，还好网上搜到了代码。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568081944,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":129293,"user_name":"Geek_zoey","can_delete":false,"product_type":"c3","uid":1522496,"ip_address":"","ucode":"9A7E29FAFD8C74","user_header":"","comment_is_top":false,"comment_ctime":1567081163,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"老师生病了呀，保重身体","like_count":5},{"had_liked":false,"id":178899,"user_name":"邦邦","can_delete":false,"product_type":"c3","uid":1004720,"ip_address":"","ucode":"D05B108D9468E0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/b0/cabe4fa8.jpg","comment_is_top":false,"comment_ctime":1581849842,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"＝不返回值挺好，也不能做连续赋值了！","like_count":0}]}