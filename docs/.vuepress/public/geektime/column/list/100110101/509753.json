{"id":509753,"title":"11ï½œç»„ä»¶å®æˆ˜ï¼šå¦‚ä½•å®ç°ç€‘å¸ƒæµï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯è’‹å®ä¼Ÿã€‚</p><p>ç°åœ¨ï¼Œå›½å†…è´­ç‰© App çš„é¦–é¡µå¤§éƒ½é‡‡ç”¨äº†åŒåˆ—ç€‘å¸ƒæµçš„å¸ƒå±€ï¼Œå‡å¦‚ä½ çš„äº§å“ç»ç†ä¹Ÿæƒ³å®ç°åŒæ ·çš„ç€‘å¸ƒæµæ•ˆæœï¼Œä½ åœ¨ç½‘ä¸Šæ‰¾äº†å¾ˆå¤šçš„ React Native åˆ—è¡¨ç»„ä»¶ï¼Œä½†éƒ½æ»¡è¶³ä¸äº†éœ€æ±‚ï¼Œä½ ä¼šæ€ä¹ˆåŠï¼Ÿä½ ä¼šé€‰æ‹©æ”¹è®©äº§å“æ”¹æ–¹æ¡ˆï¼Œè¿˜æ˜¯è‡ªå·±å†ç ”ç©¶ç ”ç©¶ï¼Ÿ</p><p>å¤§æ¦‚æ˜¯ 2019 å¹´çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„äº§å“ä¹Ÿæäº†åŒæ ·çš„éœ€æ±‚ï¼Œä½¿ç”¨ React Native å®ç°ç€‘å¸ƒæµæ•ˆæœã€‚å½“æ—¶æˆ‘ä»¬æœ‰ä¸ªåŒäº‹è¯•äº†å¾ˆå¤šæ–¹æ¡ˆï¼Œæ¯”å¦‚åŒ Listã€å¤šå±‚åµŒå¥— Listï¼Œæ€§èƒ½éƒ½å¾ˆå·®æ•ˆæœä¸å¥½ï¼Œåæ¥æˆ‘ä»¬å¼€ä¼šçš„æ—¶å€™æåˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä¹Ÿå‚ä¸äº†è®¨è®ºã€‚</p><p>å½“æ—¶æˆ‘æå‡ºäº†ä¸€ç§æ€è·¯ï¼šæ”¹ RecyclerListView çš„æºç ã€‚æˆ‘è¯´ï¼ŒRecyclerListView çš„å¸ƒå±€åŸç†æ˜¯ç»å¯¹å®šä½ï¼Œæ¯ä¸ª item çš„ xã€y è½´åæ ‡æ˜¯æ ¹æ®ä¼ å…¥çš„ heightã€width å€¼ç®—å‡ºæ¥çš„ï¼Œç°åœ¨å®ƒçš„å¸ƒå±€ç®—æ³•æ˜¯å•åˆ—çš„ï¼Œæˆ‘ä»¬åªè¦æŠŠå•åˆ—å¸ƒå±€ç®—æ³•æ”¹æˆåŒåˆ—å¸ƒå±€ç®—æ³•ï¼Œè¿™ä»¶äº‹æƒ…åº”è¯¥èƒ½æˆã€‚</p><p>åæ¥æˆ‘ä»¬å›¢é˜Ÿçš„å¦ä¸€ä¸ªå¤§ç‰›æŠŠå®ƒè½åœ°å®ç°äº†ï¼Œå®ç°äº†ä¸€ä¸ª React Native ç€‘å¸ƒæµé¡µé¢ã€‚</p><p>åœ¨å‡†å¤‡å†™å®æˆ˜æ¡ˆä¾‹çš„æ—¶å€™ï¼Œæˆ‘åˆæƒ³èµ·äº†å½“åˆçš„è¿™ä¸ªäº‹æƒ…ã€‚ä½¿ç”¨ç€‘å¸ƒæµçš„ä¸šåŠ¡åœºæ™¯å¾ˆå¤šï¼Œå´æ²¡æœ‰ç›´æ¥èƒ½ç”¨çš„å¼€æºæ–¹æ¡ˆï¼Œä½†å®ƒçš„å®ç°åŸç†å…¶å®å¹¶ä¸å¤æ‚ï¼Œåº”è¯¥æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å®æˆ˜æ¡ˆä¾‹ã€‚äºæ˜¯æˆ‘å°±åŸºäº RecyclerListView æœ€æ–°çš„ç‰ˆæœ¬ï¼Œåˆå®ç°äº†ä¸€ç‰ˆã€‚</p><!-- [[[read_end]]] --><p>æˆ‘ä»Šå¤©å°±å’Œä½ è®²è®²ï¼Œæˆ‘æ˜¯å¦‚ä½•é€šè¿‡ä¿®æ”¹ RecyclerListView ç»„ä»¶çš„æºç ï¼Œå®ç°ç€‘å¸ƒæµæ•ˆæœçš„ã€‚å¸Œæœ›ä½ èƒ½é€šè¿‡è¿™æ¬¡å®æˆ˜ï¼ŒæŠŠæˆ‘ä»¬ä»¥å‰å­¦çš„çŸ¥è¯†å’ŒæŠ€å·§éƒ½ç”¨èµ·æ¥ã€‚ä¹Ÿåªæœ‰é€šè¿‡å®æˆ˜æ‰èƒ½<strong>æŠŠçŸ¥è¯†å˜æˆèƒ½åŠ›</strong>ï¼Œå¿«å’Œæˆ‘ä¸€èµ·åŠ¨æ‰‹è¯•è¯•å§ã€‚</p><h2>å‡†å¤‡å¼€å‘è°ƒè¯•ç¯å¢ƒ</h2><p>å…³äº RecyclerListView çš„åŸºç¡€ç”¨æ³•ï¼Œæˆ‘åœ¨ã€ŠListã€‹ä¸€è®²ä¸­å·²ç»ä»‹ç»ï¼Œå®ƒä¸»è¦æ˜¯é€šè¿‡åˆ—è¡¨æ•°æ® dataProvider æ¥é©±åŠ¨åˆ—è¡¨é¡¹çš„æ¸²æŸ“ rowRendererï¼Œå¹¶ä¸”æŒ‡å®šä¸ºåˆ—è¡¨é¡¹æŒ‡å®šäº†å¸ƒå±€æ–¹å¼ layoutProviderã€‚</p><p>ç°åœ¨ï¼Œä½ éœ€è¦åšçš„æ˜¯å‡†å¤‡å¼€å‘è°ƒè¯•ç¯å¢ƒã€‚å‡†å¤‡å¼€å‘è°ƒè¯•ç¯å¢ƒæ°¸è¿œæ˜¯ç¬¬ä¸€æ­¥ï¼Œè€Œä¸”ç°åœ¨æˆ‘ä»¬è¦è°ƒè¯•çš„æ˜¯æ”¾åœ¨ node_modeuls ç›®å½•ä¸‹çš„ç¬¬ä¸‰æ–¹ç»„ä»¶ RecyclerListViewï¼Œæ‰€ä»¥ç°åœ¨æˆ‘ä»¬è¦å‡†å¤‡<strong>ç¬¬ä¸‰æ–¹ä¾èµ–åŒ…çš„å¼€å‘è°ƒè¯•ç¯å¢ƒ</strong>ï¼Œè¿™æ€ä¹ˆå‡†å¤‡å‘¢ï¼Ÿ</p><p>åœ¨ React Native ä¸­ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡ import å¯¼å…¥ç¬¬ä¸‰æ–¹æ¨¡å— RecyclerListView çš„ï¼š</p><pre><code class=\"language-plain\">import {RecyclerListView, DataProvider, LayoutProvider} from 'recyclerlistview';\n</code></pre><p>è¿™æ®µä»£ç çš„æ„æ€æ˜¯ä»<code>recyclerlistview</code>æ¨¡å—ä¸­å¯¼å…¥ RecyclerListView ç»„ä»¶ã€DataProvider åˆ—è¡¨æ•°æ®ç±»ã€LayoutProvider å¸ƒå±€æ–¹å¼ç±»ã€‚</p><p>é‚£<code>recyclerlistview</code>æ¨¡å—åˆ°åº•åœ¨å“ªå‘¢ï¼Ÿé€šå¸¸æƒ…å†µä¸‹ï¼Œè¯¥æ¨¡å—æ˜¯<code>node_modules/recyclerlistview</code>ç›®å½•ä¸‹çš„ <code>index.js</code>æ–‡ä»¶<code>export</code>å¯¼å‡ºçš„æ¨¡å—ã€‚ä¸è¿‡ç¬¬ä¸‰æ–¹åº“ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>package.json</code>ä¸­çš„<code>main</code>å­—æ®µè¿›è¡Œé…ç½®ã€‚<code>recyclerlistview</code>é‡‡ç”¨çš„å°±æ˜¯è¿™ç§é…ç½®æ–¹æ³•ï¼š</p><pre><code class=\"language-plain\">// node_modules/recyclerlistview/package.json\n{\n  \"name\": \"recyclerlistview\",\n  \"main\": \"dist/reactnative/index.js\",\n  ...\n}\n</code></pre><p>ä½ çœ‹ï¼Œåœ¨<code>recyclerlistview</code>çš„<code>package.json</code>æ–‡ä»¶ä¸­ï¼Œå®ƒé€šè¿‡<code>main</code>å‚æ•°æŒ‡å®šäº†æ¨¡å—è·¯å¾„<code>dist/reactnative/index.js</code>ã€‚</p><p>ä½†ä½ å†çœ‹ä¸‹ <code>recyclerlistview</code> çš„ç›®å½•ï¼š</p><pre><code class=\"language-plain\">node_modules/recyclerlistview/\nâ”œâ”€â”€ dist\nâ”‚   â””â”€â”€ reactnative\nâ”‚       â”œâ”€â”€ core\nâ”‚       â””â”€â”€ index.js\nâ”œâ”€â”€ src\nâ”‚   â”œâ”€â”€ core\nâ”‚   â””â”€â”€ index.ts\nâ””â”€â”€ package.json\n</code></pre><p>ä½ ä¼šå‘ç°ï¼Œ<code>dist</code>ç›®å½•ä¸‹æ”¾çš„æ˜¯ç¼–è¯‘åçš„ .js æ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥è·‘é¡¹ç›®ï¼Œåªèƒ½è°ƒè¯•ç¼–è¯‘åçš„ .js æ–‡ä»¶ï¼Œä¸èƒ½è°ƒè¯•æ”¾åœ¨ <code>src</code> ç›®å½•ä¸­çš„ .ts æºç ã€‚</p><p>é‚£æ€æ ·æ‰èƒ½è°ƒè¯• .ts çš„æºç æ–‡ä»¶å‘¢ï¼Ÿæœ‰ä¸€æ‹›å¾ˆç®€å•ï¼Œä¿®æ”¹ <code>recyclerlistview</code> çš„å¯¼å‡ºæ¨¡å—çš„é…ç½®ï¼š</p><pre><code class=\"language-plain\">// node_modules/recyclerlistview/package.json\n\n- \"main\": \"dist/reactnative/index.js\"\n+ \"main\": \"src/index.ts\"\n</code></pre><p>ä½ åªéœ€æŠŠ<code>recyclerlistview/package.json</code>çš„ <code>main</code>å‚æ•°æ”¹ä¸º<code>src/index.ts</code>å³å¯ï¼ŒReact Native ä¼šåœ¨ç¼–è¯‘æ—¶é€šè¿‡ babel å°† .tsã€.tsx æ–‡ä»¶ç¼–è¯‘ä¸º .js æ–‡ä»¶å†æ‰§è¡Œã€‚</p><p>æ”¹å®Œä¹‹åï¼Œä½ å†é‡æ–°è·‘ä¸€æ¬¡<code>yarn start</code> ï¼Œä¼šé‡åˆ°ä¸€ä¸ªæŠ¥é”™ï¼š</p><pre><code class=\"language-plain\">error: node_modules/recyclerlistview/src/core/RecyclerListView.tsx: \n\n`import debounce = require('lodash.debounce')` is not supported by @babel/plugin-transform-typescript\n\nPlease consider using `import debounce from 'lodash.debounce';` alongside Typescript's --allowSyntheticDefaultImports option.\n\n&gt; 21 | import debounce = require('lodash.debounce');\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre><p>ç°åœ¨æˆ‘ä»¬æ¥åˆ†æè¿™ä¸ªæŠ¥é”™ä¿¡æ¯ã€‚ä½ è¿˜è®°å¾—è§£å†³å…·ä½“ BUG çš„é¡ºåºå—ï¼Ÿâ€œä¸€æ¨ç†â€ã€â€œäºŒåˆ†æ³•â€ã€â€œä¸‰é—®äººâ€ã€‚</p><p>é‡åˆ°æŠ¥é”™å…ˆä¸ç”¨ç€æ€¥å»ç½‘ä¸Šæœï¼Œå…ˆçœ‹çœ‹çº¢å±çš„æŠ¥é”™æç¤ºã€‚ç¬¬ä¸€è¡ŒæŠ¥é”™ï¼Œè¯´çš„æ˜¯<code>core/RecyclerListView.tsx</code>æ–‡ä»¶ä¸­æœ‰æŠ¥é”™ã€‚ç¬¬äºŒè¡Œï¼Œè¯´çš„æ˜¯ <code>@babel/plugin-transform-typescript</code> æ’ä»¶ä¸æ”¯æŒ <code>import = require()</code> çš„å¯¼å…¥è¯­æ³•ã€‚ç¬¬ä¸‰è¡Œï¼Œç›´æ¥æŠŠå»ºè®®ç­”æ¡ˆå‘Šè¯‰ä½ äº†ï¼Œä½ å¯ä»¥ç”¨<code>import from</code>çš„è¯­æ³•è¿›è¡Œå¯¼å…¥ã€‚ç¬¬å››è¡Œï¼Œæç¤ºäº†å…·ä½“æ˜¯å“ªè¡Œä»£ç æŠ¥é”™äº†ã€‚</p><p>ä½ çœ‹ï¼Œè¿™ç±»æŠ¥é”™ä¿¡æ¯éƒ½æŠŠç­”æ¡ˆéƒ½å‘Šè¯‰æˆ‘ä»¬äº†ï¼Œæˆ‘ä»¬åªè¦è®¤çœŸè¯»ä¸€ä¸‹å°±è¡Œï¼Œæˆ‘ä»¬çš„â€œä¸€æ¨ç†â€åˆšåˆšå¼€å§‹ï¼Œå°±æŠŠè¿™ä¸ª BUG è§£å†³äº†ï¼Œéƒ½ç”¨ä¸ç€åé¢çš„â€œäºŒåˆ†æ³•â€å’Œâ€œä¸‰é—®äººâ€ã€‚</p><p>åœ¨ä½ æŠŠä»£ç è·‘èµ·æ¥åï¼Œè¿˜éœ€è¦å‡†å¤‡ä¸€ä¸‹è°ƒè¯•å·¥å…· Flipper å’Œ React Native Toolã€‚</p><p>Flipper è°ƒè¯•å·¥å…·ï¼Œä½ åªéœ€è¦ä¸‹è½½ä¸€ä¸‹å°±è¡Œï¼Œå®ƒçš„åŠŸèƒ½å¾ˆå¼ºå¤§ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/e4/d1/e4e1f3a26e124dd4c582342ayy70b7d1.png?wh=1726x3472\" alt=\"å›¾ç‰‡\"></p><p>è¿™å¼ é•¿æˆªå›¾æ˜¾ç¤ºäº† Flipper çš„åŠŸèƒ½ï¼Œä»ä¸Šåˆ°ä¸‹ä¾æ¬¡æ˜¯æ‰“å°æ—¥å¿— Logsã€ç»„ä»¶æ ‘ Componentsã€æ€§èƒ½ç«ç„°å›¾ Profilerã€å®¿ä¸»ç»„ä»¶æ ‘å’Œå¸ƒå±€ Layoutã€ç½‘ç»œè¯·æ±‚ Networkã€‚å®ƒè¿˜æœ‰ä¸€ä¸ªåŠŸèƒ½æ˜¯æ”¯æŒ Hermes å¼•æ“ Debuggerï¼Œå®ƒå’Œæµè§ˆå™¨çš„ Debugger ç±»ä¼¼ï¼Œè¿™é‡Œæˆ‘æ²¡æœ‰è¿›è¡Œæˆªå›¾äº†ã€‚</p><p>ç°åœ¨ RecyclerListView æºç å·²ç»è·‘èµ·æ¥äº†ï¼Œè°ƒè¯•ç¯å¢ƒä¹Ÿå·²ç»å‡†å¤‡å®Œæˆï¼Œæ¥ç€ä¸‹ä¸€æ­¥å°±æ˜¯æ‰¾åˆ°æ§åˆ¶å¸ƒå±€çš„å…³é”®æºç ã€‚</p><h2>æ‰¾åˆ°å…³é”®æºç </h2><p>è¦æ‰¾åˆ°å…³é”®æºç ï¼Œæˆ‘ä»¬å¾—å…ˆä»æ•´ä½“ä¸Šç†è§£æºç ã€‚å¾ˆå¤šäººè¯»æºç æ²¡æœ‰æ–¹æ³•ï¼Œä¸çŸ¥é“ä»å“ªé‡Œå…¥æ‰‹ï¼Œç”šè‡³æœ‰äº›ç¨‹åºå‘˜ä»æ¥æ²¡æœ‰è¯»è¿‡åˆ«äººçš„æºç ã€‚å…¶å®å†™ä»£ç å’Œè¯»ä»£ç ï¼Œå°±åƒå†™æ–‡ç« å’Œè¯»æ–‡ç« çš„å…³ç³»ä¸€æ ·ï¼Œ<strong>æ²¡æœ‰å¤§é‡çš„é˜…è¯»ç§¯ç´¯ï¼Œæ€<strong><strong>ä¹ˆ</strong></strong>èƒ½å†™å‡ºå¥½çš„ä»£ç å‘¢ï¼Ÿ</strong></p><p>ç†è§£ RecyclerListView è¿™ç±»å¤åˆç»„ä»¶çš„æºç ï¼Œæˆ‘æœ‰ä¸€ä¸ªæŠ€å·§ï¼Œå°±æ˜¯ä»å¤åˆç»„ä»¶ JSX éƒ¨åˆ†å¼€å§‹åˆ‡å…¥ã€‚</p><p>è¿™æ—¶æˆ‘ä»¬èƒ½ç›´æ¥è§‚å¯Ÿåˆ°çš„æ˜¯ UI è§†å›¾ï¼Œä»¥ UI è§†å›¾ä¸ºé”šç‚¹ï¼Œå»ç†è§£ JSX æ–‡ä»¶å°±å¾ˆå®¹æ˜“äº†ã€‚åœ¨ä½ äº†è§£  JSX ä¹‹åï¼Œå†æ ¹æ®çŠ¶æ€ <code>state</code> å’Œå±æ€§<code>props</code>å»æ¨æ–­ç»„ä»¶çš„å†…éƒ¨é€»è¾‘ <code>f</code> ï¼Œä¼šå®¹æ˜“å¾ˆå¤šã€‚ä¸€ä¸ªé¡µé¢ï¼Œæ— éä¹Ÿå°±æ˜¯ç”±è¿™å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p><pre><code class=\"language-plain\">UI/JSX = f(state, props)\n</code></pre><p>äº†è§£äº†åŸºæœ¬æ–¹æ³•ï¼Œç°åœ¨æˆ‘ä»¬å¼€å§‹åˆ†æRecyclerListViewç»„ä»¶çš„æºç ï¼Œè¯·ä½ å…ˆ<strong>åœ¨æœ¬åœ°æ‰“å¼€</strong> <a href=\"https://github.com/Flipkart/recyclerlistview/blob/master/src/core/RecyclerListView.tsx\">RecyclerListView çš„æºç æ–‡ä»¶</a>ã€‚ä¸‹é¢æ˜¯æˆ‘ä» RecyclerListView ç±»ç»„ä»¶æ‘˜å‡ºæ¥çš„ 3 ä¸ªå’Œ JSX ç›¸å…³çš„æ–¹æ³•ï¼š</p><pre><code class=\"language-plain\">// node_modules/recyclerlistview/src/core/RecyclerListView.tsx\npublic renderCompat() { // å…ˆè°ƒç”¨ render åè°ƒç”¨å®ƒ\n  return (\n    &lt;ScrollComponent&gt;\n      {this._generateRenderStack()}\n    &lt;/ScrollComponent&gt;\n  );    \n}\n\nprivate _generateRenderStack(){\n  for(const key in this.state.renderStack){\n    renderedItems.push(this._renderRowUsingMeta(this.state.renderStack[key]))      \n  }\n  return renderedItems\n}\n\nprivate _renderRowUsingMeta() {return &lt;ViewRenderer/&gt;}\n</code></pre><p>å®ƒä»¬åˆ†åˆ«æ˜¯ï¼š</p><ul>\n<li><code>renderCompat</code> æ–¹æ³•ï¼šå®é™…å°±æ˜¯ç±»ç»„ä»¶çš„ <code>render</code>æ–¹æ³•ï¼Œå®ƒæœ€å¤–å±‚æ˜¯ä¸€ä¸ªæ»šåŠ¨ç»„ä»¶<code>ScrollComponent</code> ï¼›</li>\n<li><code>_generateRenderStack</code>æ–¹æ³•ï¼šå¾ªç¯äº†çŠ¶æ€ <code>state.renderStack</code>ï¼Œç”Ÿæˆäº†è‹¥å¹²ä¸ª<code>renderedItems</code>ï¼›</li>\n<li><code>_renderRowUsingMeta</code> æ–¹æ³•ï¼šè¿”å›çš„æ˜¯å…·ä½“çš„<code>renderedItems</code> ï¼Œä¹Ÿå°±æ˜¯<code>ViewRenderer</code>å®¹å™¨å…ƒç´ ã€‚</li>\n</ul><p>å½“ä½ æŠŠ UI è§†å›¾å’Œ JSX éƒ¨åˆ†è”ç³»åœ¨ä¸€èµ·æ—¶ä½ å°±æ˜ç™½äº†ï¼ŒRecyclerListView æ¸²æŸ“å‡ºçš„ UI é¡µé¢ï¼Œæ˜¯ç”±ä¸€ä¸ªæ»šåŠ¨å®¹å™¨å’Œè‹¥å¹²ä¸ª<code>ViewRenderer</code>å®¹å™¨ç»„æˆçš„ã€‚</p><p>æˆ‘ä»¬è¿˜æ˜¯å›åˆ°æœ€åŸºç¡€çš„ UI å…¬å¼ï¼š</p><pre><code class=\"language-plain\">UI/JSX = f(state, props)\n</code></pre><p>ç°åœ¨æˆ‘ä»¬å·²çŸ¥ <strong>JSX</strong> æ˜¯ ScrollView + Viewï¼Œå·²çŸ¥ <strong>state</strong> æ˜¯ç”¨ <code>for...in</code>å¾ªç¯çš„å¯¹è±¡ renderStackï¼Œè¿˜å·²çŸ¥ RecyclerListView çš„ä¸‰ä¸ªå¿…ä¼  <strong>props</strong>ï¼šåˆ—è¡¨æ•°æ® dataProvider(dp)ã€åˆ—è¡¨é¡¹çš„å¸ƒå±€æ–¹æ³• layoutProviderã€åˆ—è¡¨é¡¹çš„æ¸²æŸ“å‡½æ•° rowRendererã€‚</p><p>è¿™æ—¶è™½ç„¶ä½ è¿˜ä¸çŸ¥é“ç»„ä»¶å†…éƒ¨é€»è¾‘ <code>f</code> å…·ä½“æ˜¯ä»€ä¹ˆï¼Œä½†æ˜¯ä½ åº”è¯¥å·²ç»æŠŠæ¡ä½äº†å‡½æ•°çš„â€œå…¥å£â€å’Œâ€œå‡ºå£â€ï¼Œä½ çŸ¥é“æ”¾è¿›å»çš„å…¥å‚æ˜¯ä»€ä¹ˆï¼Œèƒ½å¤Ÿäº§å‡ºçš„ UI åˆæ˜¯ä»€ä¹ˆã€‚çŸ¥é“äº†â€œå…¥å£â€â€œå‡ºå£â€çš„ç‰¹ç‚¹åï¼Œå†ä»ä¸¤ç«¯å¾€ä¸­é—´æ¨ç†ï¼Œç†è§£ç»„ä»¶å†…éƒ¨é€»è¾‘ <code>f</code>å°±ä¼šå˜å¾—ç®€å•å¾ˆå¤šã€‚</p><p>è¿™æ—¶å€™ï¼Œä½ å¯èƒ½ä¼šæœ‰ä¸€äº›å…³äºå†…éƒ¨é€»è¾‘<code>f</code>çš„é—®é¢˜ï¼Œä½ æˆ–è®¸æƒ³é—®<code>state.renderStack</code>å’Œä¸‰ä¸ª props æ˜¯æ€ä¹ˆæ§åˆ¶ JSX çš„ï¼Ÿ</p><p>é‚£æˆ‘ä»¬å°±è¦å†ä»”ç»†è¯»ä¸€ä¸‹<code>_renderRowUsingMeta</code>ä¸­çš„ä»£ç äº†ï¼š</p><pre><code class=\"language-plain\">private _renderRowUsingMeta(itemMeta: RenderStackItem): JSX.Element | null {\n  const dataIndex = itemMeta.dataIndex;\n  const data = this.props.dataProvider.getDataForIndex(dataIndex);\n  const type = this.props.layoutProvider.getLayoutTypeForIndex(dataIndex);\n  return (\n    &lt;ViewRenderer\n      data={data}\n      layoutType={type}\n      index={dataIndex}\n      layoutProvider={this.props.layoutProvider}\n      childRenderer={this.props.rowRenderer}\n    /&gt;\n  );\n}\n</code></pre><p>åœ¨è¿™æ®µæºç ä¸­ï¼Œæˆ‘åªæ ‡è®°å‡ºäº† stateã€props å’Œ ViewRenderer ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå³ä¾¿åªæœ‰è¿™äº›ä»£ç ç‰‡æ®µï¼Œä½ å¯ä»¥çŒœå‡ºå®ƒçš„å¤§è‡´é€»è¾‘ã€‚</p><p>çŠ¶æ€ <code>state.renderStack[key]</code> å°±æ˜¯ <code>itemMeta</code>ï¼Œæ¯ä¸ª <code>itemMeta</code> çš„ <code>dataIndex</code> æ˜¯ä¸ä¸€æ ·çš„ï¼Œé€šè¿‡ <code>dataIndex</code> ä»åˆ—è¡¨æ•°æ® dataProvider  å’Œå¸ƒå±€æ–¹æ³• layoutProvider ä¸­ï¼Œé€‰å–äº†å¯¹åº”é¡¹çš„æ•°æ® <code>data</code> å’Œå¸ƒå±€ç±»å‹ <code>type</code> ï¼Œå¹¶å°†è¿™äº›å€¼å’Œåˆ—è¡¨é¡¹çš„æ¸²æŸ“å‡½æ•° rowRenderer éƒ½èµ‹å€¼ç»™äº† <code>ViewRenderer</code>çš„<code>childRenderer</code>å±æ€§ã€‚</p><p>è¯»å®Œè¿™æ®µæºç ç‰‡æ®µï¼Œä½ å¤§æ¦‚èƒ½å¤Ÿè¡¥å…¨æ­¤æ®µä»£ç çš„å†…éƒ¨é€»è¾‘<code>f</code>ã€‚<code>ViewRenderer</code> æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå†…éƒ¨è£…çš„æ˜¯ä½ ä¼ ç»™å®ƒçš„æ¸²æŸ“å‡½æ•° rowRenderer æ–¹æ³•ï¼Œå¹¶ä¸”æŒ‰ç…§ä½ æŒ‡å®šçš„æ•°æ®<code>data</code>ã€ç±»å‹<code>type</code> è¿›è¡Œæ¸²æŸ“ã€‚</p><p>å› ä¸º<code>ViewRenderer</code>æ˜¯ä½ æŒ‡å®šçš„åˆ—è¡¨é¡¹<code>rowRenderer</code>çš„çˆ¶å®¹å™¨ï¼Œçˆ¶å®¹å™¨çš„ä½ç½®å†³å®šäº†ä½ åˆ—è¡¨é¡¹çš„ä½ç½®ã€‚è¿™æ—¶å€™ï¼Œä½ å†è¯»ä¸€é<code>_renderRowUsingMeta</code>çš„æºç ï¼š</p><pre><code class=\"language-plain\">  private _renderRowUsingMeta(itemMeta: RenderStackItem): JSX.Element | null {\n    const dataSize = this.props.dataProvider.getSize();\n    const dataIndex = itemMeta.dataIndex;\n    const itemRect = (\n    this._virtualRenderer.getLayoutManager() as LayoutManager\n    ).getLayouts()[dataIndex];\n    return (\n      &lt;ViewRenderer\n        key={key}\n        data={data}\n        x={itemRect.x}\n        y={itemRect.y}\n        layoutType={type}\n        index={dataIndex}\n        layoutProvider={this.props.layoutProvider}\n        onSizeChanged={this._onViewContainerSizeChange}\n        childRenderer={this.props.rowRenderer}\n        height={itemRect.height}\n        width={itemRect.width}\n      /&gt;\n    );\n  }\n</code></pre><p>åœ¨è¿™ä¸ªæºç ç‰‡æ®µä¸­ï¼Œè¿™äº›ç”±<code>LayoutManager</code>ç±»çš„<code>getLayouts</code>æ–¹æ³•ç”Ÿæˆçš„ x/y/width/height å±æ€§ï¼Œå°±æ˜¯å†³å®šä½ åˆ—è¡¨é¡¹å¸ƒå±€æ–¹å¼çš„å…³é”®æºç ã€‚</p><p>ä½† <code>getLayouts</code> åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¯·ä½ æ‰“å¼€ <code>LayoutManager</code> ç±»çš„æºç ï¼š</p><pre><code class=\"language-plain\">// node_modules/recyclerlistview/src/core/layoutmanager/LayoutManager.ts   \n   public getLayouts(): Layout[] {\n        return this._layouts;\n   }\n\n    public relayoutFromIndex(): void {\n        let startX = 0;\n        let startY = 0;\n        let maxBound = 0;\n\n        for () {\n            oldLayout = this._layouts[i];\n            if () {\n                itemDim.height = oldLayout.height;\n                itemDim.width = oldLayout.width;\n                maxBound = 0;\n            }\n            while () {\n                startX = 0;\n                startY += maxBound;\n            }\n\n            maxBound = Math.max(maxBound, itemDim.height);\n            this._layouts.push({ x: startX, y: startY, height: itemDim.height, width: itemDim.width, type: layoutType });\n\n        }\n    }\n</code></pre><p>ä¸Šè¿°çš„ä»£ç ç‰‡æ®µæ˜¯ <code>getLayouts</code> æ–¹æ³•å’Œè®¾ç½®<code>this._layouts</code>çš„<code>relayoutFromIndex</code>æ–¹æ³•ã€‚å¤§è‡´æ‰«ä¸€çœ¼ï¼Œä½ å°±èƒ½æ˜ç™½<code>relayoutFromIndex</code>æ–¹æ³•é€šè¿‡ä¸€å †è®¡ç®—ï¼Œè®¡ç®—å‡ºäº†å®ç°å•åˆ—å¸ƒå±€çš„ x/y/height/width å€¼ï¼Œç„¶åæŠŠå®ƒä»¬ä½œä¸ºå¯¹è±¡ push åˆ°äº† <code>this._layouts</code>ã€‚</p><p>è€Œ ViewRenderer æ ¹æ® <code>this._layouts</code> æŠŠä½ çš„åˆ—è¡¨é¡¹ï¼Œæ¸²æŸ“åˆ°äº†æŒ‡å®šçš„ä½ç½®ä¸Šã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¦æƒ³å®ç°åŒåˆ—ç€‘å¸ƒæµå¸ƒå±€ï¼Œå°±å¾—ç†è§£å’Œä¿®æ”¹ <code>relayoutFromIndex</code> æ–¹æ³•ã€‚</p><h2>ä¿®æ”¹æºç </h2><p>åœ¨â€œæ‰¾åˆ°å…³é”®æºç â€è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬è¯»æºç å…¶å®åªè¦æœ‰å®è§‚ä¸Šçš„ç†è§£å°±è¡Œäº†ï¼Œä½†è¦â€œä¿®æ”¹åˆ«äººæºç â€å°±éœ€è¦æ›´å¾®è§‚ä¸Šçš„ç†è§£äº†ã€‚</p><p>æˆ‘è¯´çš„å®è§‚ä¸Šç†è§£æºç ï¼Œè®²ç©¶çš„æ˜¯é€Ÿåº¦ï¼Œå¤§è‡´ç†è§£å°±è¡Œï¼Œç»†èŠ‚ä¸Šæœ‰ç‚¹å°åå·®ä¹Ÿä¸è¦ç´§ã€‚ä½†å¾®è§‚ä¸Šç†è§£æºç ï¼Œè®²ç©¶çš„æ˜¯å‡†ç¡®ï¼Œæˆ‘ä»¬è¦æ”¹åˆ«äººçš„æºç ï¼Œç†è§£è¦æ˜¯ä¸å‡†ç¡®ï¼Œæ”¹èµ·æ¥è‚¯å®šå®¹æ˜“å‡ºé—®é¢˜ã€‚</p><p>åœ¨æé«˜ç†è§£çš„å‡†ç¡®æ€§ä¸Šï¼Œæˆ‘æ˜¯è¿™ä¹ˆåšçš„ã€‚é¦–å…ˆæˆ‘ä¼šä½¿ç”¨æ–­ç‚¹å·¥å…·ï¼Œä¸€è¡Œä¸€è¡Œåœ°æ‰§è¡Œä»£ç ï¼Œå¹¶å¯¹ä¸Šä¸‹æ–‡ä¸­çš„å˜é‡è¿›è¡Œä¸€äº›â€œç»ˆææ‹·é—®â€ï¼šâ€œå˜é‡ä»å“ªæ¥â€ã€â€œå˜é‡ç”¨åˆ°å“ªé‡Œå»â€ã€â€œå˜é‡çš„æ„ä¹‰æ˜¯ä»€ä¹ˆâ€ï¼Œå†æŠŠè‡ªå·±çš„ç†è§£é©¬ä¸Šå¤‡æ³¨èµ·æ¥ï¼Œä¸ç„¶å®¹æ˜“å¿˜ã€‚</p><p>åœ¨å¾®è§‚ç†è§£ä¸Šï¼Œæˆ‘ä»¬ä¹Ÿè¦æ‰¾åˆ°åˆ‡å…¥ç‚¹ã€‚æ¯”å¦‚ï¼Œåœ¨ç†è§£ <code>relayoutFromIndex</code> æ–¹æ³•æ—¶ï¼Œæˆ‘æ‰¾çš„åˆ‡å…¥ç‚¹å°±æ˜¯è®¾ç½®åˆ—è¡¨é¡¹çš„ x/yã€‚è®¾ç½® x/y çš„æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">  public relayoutFromIndex(itemCount: number): void {\n    // æ–° item x y åæ ‡\n    let startX = 0;\n    let startY = 0;\n    // è®°å½•å½“å‰ä¸€è¡Œæœ€é«˜å…ƒç´ çš„é«˜åº¦\n    let maxBound = 0;\n\n    for (let i = 0; i &lt; itemCount; i++) {\n\n      // å¦‚æœå½“å‰å¤šä¸ª item å®½åº¦ä¹‹å’Œè¶…è¿‡å±å¹•å®½åº¦å°±æ¢è¡Œ\n      while (!this._checkBounds(startX, startY, this._layouts[i])) {\n        // å°†å®é™… x åæ ‡è®¾ç½®ä¸º 0\n        startX = 0;\n        // å°†å®é™… y åæ ‡è®¾ç½®å¢åŠ ä¸Šä¸€è¡Œæœ€é«˜ item çš„é«˜åº¦\n        startY += maxBound;\n        maxBound = 0;\n      }\n\n      // è®¾ç½®æ–°çš„å®½é«˜\n      this._layouts.push({ x: startX, y: startY, height: itemDim.height, width: itemDim.width, type: layoutType });\n\n      // è®°å½•å½“å‰ä¸€è¡Œæœ€é«˜ item çš„é«˜åº¦\n      maxBound =  Math.max(maxBound, this._layouts[i].height);\n      // é»˜è®¤æƒ…å†µä¸‹ï¼šä¸‹ä¸€ä¸ª item çš„åˆå§‹åŒ–çš„ x åæ ‡\n      startX += itemDim.width;\n    }\n  }\n  private _checkBounds(\n    itemX: number,\n    itemY: number,\n    itemDim: Dimension,\n  ): boolean {\n    return itemX + itemDim.width &lt;= this._window.width;\n  }\n</code></pre><p>è™½ç„¶æˆ‘å·²ç»æŠŠä»£ç ç²¾ç®€å¹¶å†™äº†å¤‡æ³¨ï¼Œä½†ç†è§£èµ·æ¥å¯èƒ½è¿˜æ˜¯æœ‰ç‚¹éš¾åº¦ï¼Œæ‰€ä»¥æˆ‘è¿˜ç»™ä½ é…äº†å•åˆ—å¸ƒå±€çš„åŸç†ç¤ºæ„å›¾ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/c0/a8/c03b10ea793948d7f280072a857964a8.png?wh=1920x556\" alt=\"å›¾ç‰‡\"></p><p>å•åˆ—å¸ƒå±€çš„åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ä»ä»£ç å±‚é¢çœ‹ï¼Œå®ƒå¯¹ä½ ä¼ å…¥çš„åˆ—è¡¨é¡¹è¿›è¡Œ<code>for</code>å¾ªç¯éå†ï¼Œå¹¶é€šè¿‡ <code>_checkBounds</code>æ–¹æ³•æ¥åˆ¤æ–­ã€‚å¦‚æœå½“å‰éå†çš„åˆ—è¡¨é¡¹å®½åº¦å’Œå½“å‰ä¸€åˆ—å·²æœ‰åˆ—è¡¨é¡¹çš„å®½åº¦ä¹‹å’Œï¼Œä¸è¶…è¿‡å±å¹•å®½åº¦ï¼Œä¹Ÿå°±æ˜¯<code>itemX + itemDim.width &lt;= this._window.width</code>ï¼Œé‚£ä¹ˆå°±è·³è¿‡ <code>while</code> å¾ªç¯ï¼Œç›´æ¥ä½¿ç”¨åŒä¸€è¡Œå‰å‡ ä¸ªåˆ—è¡¨é¡¹çš„å®½åº¦ä¹‹å’Œ<code>startX += itemDim.width</code> ï¼Œä½œä¸ºå½“å‰åˆ—è¡¨é¡¹çš„ x(startX) åæ ‡ã€‚ä¹Ÿå°±æ˜¯æƒ…å†µä¸€ï¼š<strong>å®½åº¦è¶³å¤Ÿï¼Œæ”¾åˆ°åŒä¸€è¡Œã€‚</strong></p><p>å¦‚æœ<code>_checkBounds</code>åˆ¤æ–­ï¼ŒåŒä¸€è¡Œå‰©ä½™å®½åº¦ä¸å¤Ÿäº†ï¼Œé‚£ä¹ˆå°±è¿›å…¥  <code>while</code> å¾ªç¯ï¼Œå°†å½“å‰åˆ—è¡¨é¡¹çš„ x(startX) åæ ‡è®¾ç½®ä¸º 0ï¼Œy åæ ‡è®¾ç½®å¢åŠ ä¸Šä¸€è¡Œæœ€é«˜ item çš„é«˜åº¦<code>maxBound</code>ã€‚ä¹Ÿå°±æ˜¯æƒ…å†µäºŒï¼š<strong>å®½åº¦ä¸å¤Ÿï¼Œæ”¾åˆ°ä¸‹ä¸€è¡Œã€‚</strong></p><p>æˆ‘è¿˜åœ¨å›¾ä¸­ç»™ä½ ç”»äº†ä¸€ä¸ªå•åˆ—å¸ƒå±€çš„ä¾‹å­ã€‚ç¬¬ä¸€è¡Œ Aã€B åˆ—è¡¨é¡¹å®½åº¦æ­£å¥½å æ»¡æ•´ä¸ªå±å¹•å®½åº¦ï¼Œæ‰€ä»¥åˆ—è¡¨é¡¹ C å¾—å†èµ·ä¸€è¡Œï¼Œå…¶ x åæ ‡ä¸º 0ï¼Œå…¶ y åæ ‡ä¸º A çš„ y åæ ‡å’Œ B çš„é«˜åº¦ height ä¹‹å’Œã€‚åˆ—è¡¨é¡¹ C æ¨ªå‘ç‹¬å äº†ä¸€è¡Œï¼Œæ‰€ä»¥ Dã€E å°±åªèƒ½æ”¾åˆ°ä¸‹ä¸€è¡Œäº†ã€‚æ•´ä½“ä¸Šçœ‹ï¼ŒRecyclerListView å®ç°çš„è¿˜æ˜¯ä¸€ç§å•åˆ—å¸ƒå±€ï¼Œåªä¸è¿‡åŒä¸€è¡Œä¸­å¯ä»¥æ”¾ç½®å¤šä¸ªåˆ—è¡¨é¡¹ã€‚</p><p>ç†è§£å®Œ RecyclerListView çš„å•åˆ—å¸ƒå±€æºç åï¼Œæ¥ä¸‹æ¥å°±è¦è®¾è®¡æˆ‘ä»¬è‡ªå·±çš„åŒåˆ—ç€‘å¸ƒæµå¸ƒå±€äº†ã€‚æˆ‘ç»™ä½ ç”»äº†ä¸€å¼ ç€‘å¸ƒæµçš„ç¤ºæ„å›¾ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/93/9c/938fbe382fc3438c4ee41ed01c8eab9c.png?wh=1920x548\" alt=\"å›¾ç‰‡\"></p><p>åŒåˆ—ç€‘å¸ƒæµå¸ƒå±€åªæœ‰ä¸¤ç§æƒ…å†µï¼Œç¬¬ä¸€ç§æƒ…å†µæ˜¯å¦‚æœå·¦è¾¹å·²æœ‰åˆ—è¡¨é¡¹çš„é«˜åº¦ä¹‹å’Œ  <code>startLeftY</code> å¤§äºå³è¾¹å·²æœ‰åˆ—è¡¨é¡¹çš„é«˜åº¦ä¹‹å’Œ <code>startRightY</code>ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªåˆ—è¡¨é¡¹å°±è¦æ”¾å³è¾¹ã€‚ç¬¬äºŒç§æƒ…å†µåˆ™åˆšå¥½ç›¸åï¼Œæˆ‘ä»¬éœ€è¦æŠŠä¸‹ä¸€ä¸ªåˆ—è¡¨é¡¹æ”¾åœ¨å·¦è¾¹ã€‚ç®€å•æ¥è¯´å°±æ˜¯ï¼Œ<strong>å·¦é«˜æ”¾å³ã€å³é«˜æ”¾å·¦ã€‚</strong></p><p>æˆ‘åŒæ ·ç»™ä½ ä¸¾äº†ä¸€ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥å¯¹ç…§åŒåˆ—ç€‘å¸ƒæµå¸ƒå±€çš„å›¾ç‰‡çœ‹ä¸€ä¸‹ã€‚èµ·å§‹æ—¶å·¦å³ä¸¤è¾¹ä¸€æ ·é«˜ï¼Œæ‰€ä»¥å…ˆæ˜¯å·¦ Aï¼Œå†æ˜¯å³ Bã€‚æ¥ä¸‹æ¥ï¼Œç”±äºå·¦è¾¹æ¯”å³è¾¹é«˜ï¼Œæ‰€ä»¥å†æ˜¯å³ Cï¼Œæœ€åæ˜¯å·¦ Dã€‚å¦‚æœæ˜¯å•åˆ—å¸ƒå±€ï¼ŒC åº”è¯¥æ”¾åœ¨å·¦è¾¹ï¼ŒD åº”è¯¥æ”¾åœ¨å³è¾¹ï¼Œè¿™å°±æ˜¯åŒåˆ—ç€‘å¸ƒæµå¸ƒå±€å’Œå•åˆ—å¸ƒå±€ä¸åŒä¹‹å¤„ã€‚</p><p>åŒåˆ—ç€‘å¸ƒæµå®ç°çš„æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">  public relayoutFromIndex(startIndex: number, itemCount: number): void {\n\n    // å‡è®¾: æ¯ä¸ª item çš„å®½åº¦ä¸º 1/2*window.width ä¸¤ç§æƒ…å†µ\n    const halfWindowWidth = this._window.width / 2;\n\n    let startLeftY = 0; // å·¦è¾¹æ‰€æœ‰ item çš„é«˜åº¦ä¹‹å’Œ\n    let startRightY = 0; // å³è¾¹æ‰€æœ‰ item çš„é«˜åº¦ä¹‹å’Œ\n\n    let startX = 0; // æ–°å¢ item çš„ X\n    let startY = 0; // æ–°å¢ item çš„ Y\n\n    for (let i = startIndex; i &lt; itemCount; i++) {\n      itemDim.height = oldLayout.height;\n      itemDim.width = halfWindowWidth;\n\n      // ä¿è¯ä¸€è¡Œä¸­æ‰€æœ‰çš„ item å®½åº¦ä¹‹å’Œä¸è¶…è¿‡å±å¹•å®½åº¦ï¼Œè¶…è¿‡å°±æ¢è¡Œ\n      if (startLeftY &gt; startRightY) {\n        startX = halfWindowWidth;\n        startY = startRightY;\n        startRightY += itemDim.height;\n      } else {\n        startX = 0;\n        startY = startLeftY;\n        startLeftY += itemDim.height;\n      }\n\n      // å¦‚æœæ˜¯ item æ˜¯æ–°å¢çš„ï¼Œåœ¨æ·»åŠ æ–°çš„ layout\n      this._layouts.push({x: startX, y: startY, height: itemDim.height, width: itemDim.width, type: layoutType,});\n  }\n</code></pre><p>é¦–å…ˆï¼ŒåŒåˆ—ç€‘å¸ƒæµæœ‰ä¸€ä¸ªå‡è®¾ï¼Œå‡è®¾æ¯ä¸ªåˆ—è¡¨é¡¹çš„å®½åº¦ä¸ºå±å¹•çš„ä¸€åŠã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®°å½•å·¦è¾¹çš„é«˜åº¦ä¹‹å’Œ<code>startLeftY</code>å’Œå³è¾¹çš„é«˜åº¦ä¹‹å’Œ<code>startRightY</code>ã€‚åœ¨<code>for</code>éå†åˆ—è¡¨é¡¹æ—¶ï¼Œå¦‚æœå·¦è¾¹é«˜ <code>startLeftY &gt; startRightY</code>ï¼Œé‚£ä¹ˆå½“å‰åˆ—è¡¨é¡¹æ”¾å³è¾¹<code>startX = halfWindowWidth</code>ï¼Œå¦åˆ™å½“å‰åˆ—è¡¨é¡¹æ”¾å·¦è¾¹<code>startX = 0</code>ï¼ŒåŒæ—¶è®°å½•æœ€æ–°çš„å·¦è¾¹/å³è¾¹é«˜åº¦ä¹‹å’Œã€‚æœ€åæŠŠå½“å‰åˆ—è¡¨é¡¹ push åˆ° <code>this._layouts</code> ä¸­ã€‚</p><p>å°†å•åˆ—å¸ƒå±€æ”¹ä¸ºåŒåˆ—ç€‘å¸ƒæµå¸ƒå±€ï¼Œæ”¹åŠ¨çš„ä»£ç é‡å¾ˆå°‘ï¼Œä½ å¯ä»¥ç°åœ¨å°±åŠ¨æ‰‹è¯•ä¸€è¯•ã€‚æˆ‘ä¹Ÿå°†æˆ‘æ”¹åŠ¨çš„ä»£ç å‰åå¯¹æ¯”å›¾ï¼Œæ”¾åœ¨äº†ä¸‹é¢ï¼Œä½ å¯ä»¥å‚è€ƒä¸€ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/3b/b1/3b0cbcb54e6e06fd52b7fe0d5d1f35b1.png?wh=1920x3413\" alt=\"å›¾ç‰‡\"></p><h2>ä¿å­˜ä¿®æ”¹</h2><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥åˆ°äº†æœ€åä¸€æ­¥ä¿å­˜ä¿®æ”¹çš„æºç ã€‚</p><p>åœ¨ä¿®æ”¹å®Œ node_modules ä¸­çš„æºç åï¼Œå¦‚æœä¸è¿›è¡Œä¿å­˜ï¼Œå¾ˆæœ‰å¯èƒ½å°±ä¼šä¸¢å¤±ã€‚å¹¶ä¸”ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦å’ŒåŒäº‹è¿›è¡Œåˆä½œï¼ŒåŒäº‹ä¹Ÿéœ€è¦æˆ‘ä»¬ä¿®æ”¹åçš„ä»£ç ï¼Œåˆæˆ–è€…æ˜¯åœ¨ä½¿ç”¨ä¸Šçº¿å¹³å°è¿›è¡Œæ‰“åŒ…æ—¶ï¼Œä¹Ÿéœ€è¦å°†ä¿®æ”¹åçš„ node_modules æºç åŒæ­¥ç»™ä¸Šçº¿å¹³å°ä¸€ä»½ã€‚æœ¬åœ°ä¿®æ”¹ node_modules æºç åï¼Œä¸ä¿å­˜ã€ä¸åŒæ­¥è‚¯å®šä¼šå‡ºçº¿ä¸Šé—®é¢˜ã€‚</p><p>æ€ä¹ˆæŠŠä¿®æ”¹å¥½çš„ node_modules ä»£ç ä¿å­˜å‘¢ï¼Ÿæœ‰ä¸‰ç§æ€è·¯ï¼š</p><p>ç¬¬ä¸€ç§<strong>ç›´æ¥å¤åˆ¶æºç </strong>ã€‚ä½†å¤åˆ¶æºç åç»­æƒ³è¦å‡çº§ RecyclerListview çš„ç‰ˆæœ¬ä¼šéå¸¸å›°éš¾ï¼Œæ¯æ¬¡å‡çº§å¯èƒ½é¢ä¸´çš„æ˜¯ä¸€æ¬¡é‡æ–°æ”¹é€ ã€‚</p><p>ç¬¬äºŒç§<strong>åœ¨è¿è¡Œæ—¶è¿›è¡Œä¿®æ”¹</strong>ã€‚è¿™ç§æ–¹æ³•å¯¹æºç çš„ä¾µå…¥æ€§å°ï¼Œä½†æ¯æ¬¡å‡çº§å‰æˆ‘ä»¬è¿˜æ˜¯éœ€è¦æ‰‹åŠ¨æ£€æŸ¥ä¸€ä¸‹çš„ï¼Œä¸ç„¶ç›¸å…³ä»£ç é€»è¾‘æœ‰å˜åŒ–ï¼Œæˆ‘ä»¬çš„ä¿®æ”¹å°±ä¼šå—åˆ°å½±å“ã€‚</p><p>æˆ‘åœ¨è¿™æ¬¡å®æˆ˜ä¸­ï¼Œé‡‡ç”¨çš„å°±æ˜¯åœ¨è¿è¡Œæ—¶è¿›è¡Œä¿®æ”¹çš„æ–¹æ¡ˆã€‚æˆ‘è§‚å¯Ÿäº†ä¸€ä¸‹ RecyclerListview çš„ä»£ç ï¼Œå®ƒçš„ä»£ç é£æ ¼æ˜¯é¢å‘å¯¹è±¡çš„ç¼–ç¨‹é£æ ¼ï¼Œå‡ ä¹æŠŠæ‰€æœ‰çš„å†…éƒ¨ç±»éƒ½æš´éœ²å‡ºæ¥äº†ã€‚</p><p>ä½†ç”±äºå®ƒ LayoutManager ç±»çš„æ‰€æœ‰å±æ€§æ˜¯ç§æœ‰å±æ€§ï¼Œæˆ‘æ²¡åŠæ³•é€šè¿‡ç»§æ‰¿çš„æ–¹å¼è¯»å–åˆ° LayoutManager çš„ç§æœ‰å±æ€§ã€‚</p><p>å› æ­¤æˆ‘å¤åˆ¶äº† <code>LayoutManager</code> å’Œ <code>layoutProvider</code> ç±»ï¼Œå¹¶å°†å…¶é‡å†™ä¸º <code>WaterfallLayoutManager</code> å’Œ <code>WaterfallLayoutProvider</code>ã€‚</p><p>å½“ä½ çš„åˆ—è¡¨æ˜¯å•åˆ—å¸ƒå±€æ—¶ï¼Œå°±åº”è¯¥ä½¿ç”¨<code>layoutProvider</code>ç±» ï¼Œå½“ä½ çš„åˆ—è¡¨æ˜¯åŒåˆ—ç€‘å¸ƒæµå¸ƒå±€æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨æˆ‘åˆ›å»ºçš„<code>WaterfallLayoutProvider</code>ç±»ã€‚</p><p>ç¬¬ä¸‰ç§<strong>åœ¨ç¼–è¯‘æ—¶ä¿®æ”¹</strong>ã€‚è¿™é‡Œåˆ©ç”¨çš„æ˜¯ <code>patch-package</code> å³æ—¶ä¿®å¤ç¬¬ä¸‰æ–¹ npm åŒ…çš„èƒ½åŠ›ï¼Œå®ƒçš„åŸç†æ˜¯å…ˆå¯¹ä½ çš„ä¿®æ”¹è¿›è¡Œä¿å­˜ï¼Œç„¶ååœ¨ä½ æ¯æ¬¡å®‰è£… npm åŒ…çš„æ—¶å€™æŠŠä½ åŸå…ˆçš„ä¿®æ”¹ç»™æ³¨å…¥è¿›å»ï¼Œä¹Ÿå°±æ˜¯ patch packageã€‚å®ƒæ˜¯ä¾µå…¥å¼çš„ä¿®æ”¹æ–¹å¼ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><p>åœ¨ä¿®æ”¹å®Œ node_modules ç›®å½•ä¸‹çš„ RecyclerListview æ–‡ä»¶åï¼Œä½ ç›´æ¥è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><pre><code class=\"language-plain\">$ npx patch-package some-package\n</code></pre><p>è¿™æ—¶ä½ ä¿®æ”¹çš„ä»£ç å°±ä¼šä»¥ patch æ–‡ä»¶çš„å½¢å¼è¿›è¡Œä¿å­˜ï¼Œpatch æ–‡ä»¶çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">diff --git a/node_modules/recyclerlistview/src/core/layoutmanager/LayoutManager.ts b/node_modules/recyclerlistview/src/core/layoutmanager/LayoutManager.ts\nindex e9454a4..3168330 100644\n\n--- a/node_modules/recyclerlistview/src/core/layoutmanager/LayoutManager.ts\n+++ b/node_modules/recyclerlistview/src/core/layoutmanager/LayoutManager.ts\n\n@@ -95,75 +95,113 @@ export class WrapGridLayoutManager extends LayoutManager {\n         }\n     }\n\n-    public relayoutFromIndex(startIndex: number, itemCount: number): void {\n\n+  // startIndexï¼šä»ç¬¬å‡ ä¸ª item å¼€å§‹æœ‰äº†æ›´æ–°ï¼Œä»è¿™ä¸ª item å¼€å§‹ç®—ï¼Œç›®çš„æ˜¯ä¸ºäº†å‡å°‘è®¡ç®—é‡ã€‚é»˜è®¤ï¼š0\n+  // itemCount: ä¸€å…±å¤šä¸ª itemã€‚\n+  // ä»¥ä¸‹æ³¨é‡Šåªè€ƒè™‘å‚ç›´æ»šåŠ¨ï¼Œæ°´å¹³æ»šåŠ¨åŒç†ã€‚\n+  public relayoutFromIndex(startIndex: number, itemCount: number): void {\n\n     private _pointDimensionsToRect(itemRect: Layout): void {\n         if (this._isHorizontal) {\n</code></pre><p>é‚£å¦‚æœåˆ«äººæƒ³ç”¨ä½ ç€‘å¸ƒæµç‰ˆæœ¬çš„ RecyclerListview æ€ä¹ˆåŠå‘¢ï¼Ÿé¦–å…ˆï¼Œä½ éœ€è¦ä¿®æ”¹ package.json æ–‡ä»¶ï¼š</p><pre><code class=\"language-plain\"> // package.json\n \"scripts\": {\n+  \"postinstall\": \"patch-package\"\n }\n</code></pre><p>ç„¶åå°†ä¿®æ”¹åçš„ package.json å’Œå‰é¢è‡ªåŠ¨ç”Ÿæˆçš„ patch æ–‡ä»¶ç”¨ Gitlab/GitHub ä¿å­˜èµ·æ¥ã€‚</p><p>è¿™æ ·ï¼Œä½ åŒäº‹ä¸‹è½½æœ€æ–°ä»£ç ï¼Œå†æ‰§è¡Œ <code>npm install</code> æˆ– <code>yarn</code> å‘½ä»¤åï¼Œå°±ä¼šè‡ªåŠ¨è§¦å‘ <code>patch-package</code> å‘½ä»¤ã€‚ <code>patch-package</code> å‘½ä»¤ä¼šåˆ©ç”¨ä½ ç”Ÿæˆçš„ patch æ–‡ä»¶ï¼Œå°†å®˜æ–¹çš„ RecyclerListview ä¿®æ”¹æˆä½ çš„ç€‘å¸ƒæµç‰ˆæœ¬çš„ RecyclerListviewã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œæ— è®ºæ˜¯å¿«é€Ÿä¿®æ”¹ç¬¬ä¸‰æ–¹ç»„ä»¶æºç ï¼Œè¿˜æ˜¯ä¿®æ”¹ React Native çš„ JavaScript å±‚çš„æºç ï¼Œæˆ‘éƒ½ä¸å»ºè®®ä½¿ç”¨ç¬¬ä¸€ç§ç›´æ¥å¤åˆ¶æºç çš„æ–¹å¼ã€‚æˆ‘ä¼š<strong>ä¼˜å…ˆè€ƒè™‘åœ¨è¿è¡Œæ—¶çš„ä¿®æ”¹æ–¹æ³•</strong>ï¼Œé€šå¸¸è¯¥æ–¹æ¡ˆæ”¹åŠ¨æœ€å°ã€ä¾µå…¥æ€§ä¹Ÿæœ€å°ã€‚<strong>å¦‚æœè¿è¡Œæ—¶æ–¹æ¡ˆæ”¹ä¸äº†ï¼Œæˆ‘æ‰ä¼šè€ƒè™‘æœ‰ä¾µå…¥æ€§çš„ç¼–è¯‘æ—¶çš„</strong><code>patch-package</code><strong>æ–¹æ¡ˆã€‚</strong></p><h2>æ€»ç»“</h2><p>åœ¨å‰é¢çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘è®²çš„å¤§å¤šæ˜¯æ¦‚å¿µæ€§çš„çŸ¥è¯†ï¼Œè¦æ¶ˆåŒ–è¿™äº›æ¦‚å¿µæ€§çš„çŸ¥è¯†å°±å¿…é¡»è¦æœ‰ç»ƒä¹ ï¼Œæ‰€ä»¥æˆ‘åœ¨æ¯èŠ‚è¯¾ä¸­éƒ½ç»™ä½ ç•™äº†ä¸€é“å®æ“çš„ç»ƒä¹ é¢˜ï¼Œç›®çš„å°±æ˜¯å¸®ä½ æŠŠçŸ¥è¯†å†…åŒ–ä¸ºèƒ½åŠ›ã€‚è¿™ä¸€è®²ä¸­ï¼Œæˆ‘å‡†å¤‡çš„å®æˆ˜æ¡ˆä¾‹ä¹Ÿæ˜¯ä¸ºäº†è®©ä½ æŠŠå‰å‡ è®²ä¸­å­¦ä¹ åˆ°çš„çŸ¥è¯†çµæ´»è¿ç”¨èµ·æ¥ã€‚</p><p>é¦–å…ˆä½ éœ€è¦æå‰å‡†å¤‡å¥½å†™ä»£ç æ—¶ä¼šç”¨åˆ°è°ƒè¯•å·¥å…· Flipper ï¼Œå¹¶çµæ´»è¿è¡Œâ€œä¸€æ¨ç†â€ã€â€œäºŒåˆ†æ³•â€ã€â€œä¸‰é—®äººâ€çš„æ€è·¯æ¥è§£å†³è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ã€‚</p><p>åœ¨ç†è§£åˆ«äººçš„ç»„ä»¶ä»£ç æ—¶ï¼Œåˆ©ç”¨ <code>UI/JSX = f(state, props)</code> è¿™ä¸ªæœ€åŸºæœ¬ React/React Native åŸç†ï¼Œå…ˆæ‰¾åˆ°å®ç° UI çš„ JSX éƒ¨åˆ†ï¼Œå†æ‰¾åˆ° stateã€propsï¼Œç„¶åå†ç†è§£é€»è¾‘ <code>f</code> çš„éƒ¨åˆ†ã€‚</p><p>åœ¨ä¿®æ”¹åˆ«äººçš„é€»è¾‘ä»£ç æ—¶ï¼Œå…ˆé€šè¿‡è°ƒè¯•å·¥å…·æ¥ç†è§£å„ä¸ªå˜é‡ä¸Šä¸‹æ–‡å«ä¹‰ï¼Œç†æ¸…æ¥šåˆ«äººçš„é€»è¾‘åï¼Œå†æ ¹æ®è‡ªå·±ç›®çš„è¿›è¡Œä¿®æ”¹ã€‚</p><p>æœ€åè¦æ„è¯†åˆ°ï¼Œä½ ä¿®æ”¹çš„æ˜¯åˆ«äººçš„æºç ï¼Œä½ å¯ä»¥é€šè¿‡è¿è¡Œæ—¶ã€ç¼–è¯‘æ—¶ä¸¤ç§æ–¹æ¡ˆæŠŠå…¶ä¿å­˜ä¸‹æ¥ã€‚</p><h2>é™„åŠ ææ–™</h2><ol>\n<li><a href=\"https://github.com/ds300/patch-package\">patch-package</a> å¯ä»¥å¸®ä½ ä¿å­˜å¯¹ç¬¬ä¸‰æ–¹æ¨¡å—çš„é—®é¢˜ä¿®å¤ã€‚</li>\n<li>æœ¬èŠ‚è¯¾çš„æºç ï¼Œæˆ‘æ”¾åœ¨äº†<a href=\"https://github.com/jiangleo/react-native-classroom/tree/main/src/11_Waterfall\">GitHub</a>ä¸­ã€‚</li>\n</ol><h2>ä½œä¸š</h2><ol>\n<li>è¯·ä½ æ ¹æ®è¿™èŠ‚è¯¾çš„èµ„æ–™ï¼Œå®ç°ä¸€ä¸ªä¸‰åˆ—ç€‘å¸ƒæµå¸ƒå±€ã€‚</li>\n<li>ä½ è§‰å¾—é˜…è¯»æºç ï¼Œæœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ</li>\n</ol><p>æ¬¢è¿åœ¨è¯„è®ºåŒºå†™ä¸‹ä½ çš„æƒ³æ³•ã€‚æˆ‘æ˜¯è’‹å®ä¼Ÿï¼Œå’±ä»¬ä¸‹èŠ‚è¯¾è§ã€‚</p>","neighbors":{"left":{"article_title":"10ï½œDebugï¼šè§£å†³ BUG æ€è·¯æœ‰å“ªäº›ï¼Ÿ","id":508776},"right":{"article_title":"12ï½œé¡µé¢å®æˆ˜ï¼šå¦‚ä½•æ­å»ºä¸€ä¸ªç”µå•†é¦–é¡µï¼Ÿ","id":510659}},"comments":[{"had_liked":false,"id":353648,"user_name":"songyq","can_delete":false,"product_type":"c1","uid":2427725,"ip_address":"ç¾å›½","ucode":"0A95EBA8D2F16A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLib4GiaK4KB3UvnnzIkMAD4QzKBAkOzdntPwsb8RX1xjHYgr2w0GLWhmoPdwy3iby3zOHbeTBR2DgRQ/132","comment_is_top":false,"comment_ctime":1659660650,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5954627946","product_id":100110101,"comment_content":"è¿™ä¸ªå­¦ä¹ æ›²çº¿æœ‰ç‚¹é™¡å³­","like_count":1},{"had_liked":false,"id":350465,"user_name":"wilson","can_delete":false,"product_type":"c1","uid":1286793,"ip_address":"","ucode":"55CFA9D4AA9A19","user_header":"https://static001.geekbang.org/account/avatar/00/13/a2/89/7098b532.jpg","comment_is_top":false,"comment_ctime":1656928390,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5951895686","product_id":100110101,"comment_content":"æˆ‘æŒ‰ç€ä¿®æ”¹å®Œåï¼Œç€‘å¸ƒæµæ•ˆæœæ˜¯æœ‰äº†ï¼Œä½†æ˜¯ä¸ºå•¥ä¸èƒ½æ»‘åŠ¨äº†ã€‚ä¸€æ»‘åŠ¨å°±å¡æ­»","like_count":1},{"had_liked":false,"id":348657,"user_name":"å­¦ä¹ ä¸­...","can_delete":false,"product_type":"c1","uid":1126774,"ip_address":"","ucode":"AF180F386ABC09","user_header":"https://static001.geekbang.org/account/avatar/00/11/31/76/8e3347a1.jpg","comment_is_top":false,"comment_ctime":1655282326,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5950249622","product_id":100110101,"comment_content":"è€å¸ˆè®²çš„å¾ˆå¥½ï¼Œä¸è¿‡è¯•ç”¨äº†demoå’Œç»“åˆè‡ªå·±å®é™…é¡¹ç›®ä¸­çš„éœ€æ±‚æ¥è¯´ï¼Œé­”æ”¹RecyclerListViewæˆç€‘å¸ƒæµä¹‹åè¿˜æ˜¯éœ€è¦åœ¨layoutProviderä¸­è®¾ç½®Dimension.widthå’Œheightï¼Œä½†æ˜¯åœ¨éœ€æ±‚ä¸Šæœ‰å¯èƒ½UIå¹¶ä¸èƒ½ç¡®å®šå¥½å½“å‰ç€‘å¸ƒæµitemçš„é«˜åº¦ï¼Œä¹Ÿå°±æ˜¯æ— æ³•è¯´æˆ‘åŒºåˆ†typeçš„æ–¹å¼æ¥ç¡®å®šitemï¼Œä¾‹å¦‚æ–‡å­—ä¸€è¡Œä¸¤è¡Œå¤šè¡Œç­‰éœ€è¦åœ¨itemè¿›è¡Œäº†layoutä¹‹åæ‰èƒ½ç¡®å®šï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•measureï¼Œè¿™æ ·çš„è¯å¦‚æœåœ¨itemçš„onLayoutä¹‹åå†æ¬¡åˆ·æ–°é«˜åº¦çš„è¯å°±ä¼šå‡ºç°æŠ–åŠ¨ç­‰é—®é¢˜äº†ã€‚<br><br>è¯·æ•™è€å¸ˆä¸€ä¸‹è¿™ç§æƒ…å†µæœ‰ä»€ä¹ˆè§£å†³åŠæ³•å—ï¼Ÿæ˜¯å¦èƒ½å¤Ÿè®©recyclerListViewå’ŒFlatListä¸€æ ·åœ¨å¸ƒå±€çš„æ—¶å€™å¯ä»¥è‡ªå·±åŠ¨æ€çš„è®¡ç®—é«˜åº¦æˆ–è€…å®½åº¦è¿›è¡Œå¸ƒå±€å‘¢","like_count":1},{"had_liked":false,"id":343174,"user_name":"python4","can_delete":false,"product_type":"c1","uid":1023327,"ip_address":"","ucode":"BFEE720743B53E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9d/5f/06671a0d.jpg","comment_is_top":false,"comment_ctime":1650690056,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5945657352","product_id":100110101,"comment_content":"é•¿è§è¯†äº†ï¼Œä»¥å‰éƒ½æ˜¯ç›´æ¥å¤åˆ¶","like_count":1},{"had_liked":false,"id":351460,"user_name":"æœªæœˆ","can_delete":false,"product_type":"c1","uid":1975122,"ip_address":"","ucode":"80964C11623AF3","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/eMtXYzYicV03GIlIMx7tiabZq0HFve24jQ8QRqaatvd5BGE2DssrFIEdAk8ZTJHiad4XJNWcaBDWTndGzDPhsEq9Q/132","comment_is_top":false,"comment_ctime":1657806459,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1657806459","product_id":100110101,"comment_content":"è€å¸ˆï¼Œè¯·é—®ä¸‹ï¼ŒæŒ‰ç…§ä¸Šé¢ä¿®æ”¹å®Œä¹‹åè°ƒç”¨WaterfallLayoutProvideré‡Œé¢æ— é™å›è°ƒæ˜¯ä»€ä¹ˆåŸå› ï¼Ÿ","like_count":0},{"had_liked":false,"id":347685,"user_name":"é™å¿ƒ","can_delete":false,"product_type":"c1","uid":1335457,"ip_address":"","ucode":"EB264FA6519FDA","user_header":"https://static001.geekbang.org/account/avatar/00/14/60/a1/8f003697.jpg","comment_is_top":false,"comment_ctime":1654312492,"is_pvip":true,"discussion_count":0,"race_medal":2,"score":"1654312492","product_id":100110101,"comment_content":"é«˜æ‰‹ï¼Œä¸ä»…æŠŠåŸç†è§£é‡Šæ¸…æ¥šäº†ï¼Œæ”¹çš„ä»£ç æˆæœ¬ä¹Ÿå¾ˆä½","like_count":0},{"had_liked":false,"id":346864,"user_name":"å¤§ç¥åšå£«","can_delete":false,"product_type":"c1","uid":1195144,"ip_address":"","ucode":"8C4318095949F0","user_header":"https://static001.geekbang.org/account/avatar/00/12/3c/88/6bef27d6.jpg","comment_is_top":false,"comment_ctime":1653477699,"is_pvip":true,"replies":[{"id":"126477","content":"ç°åœ¨æ²¡æœ‰å“¦","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1088541","ctime":1653522579,"ip_address":"","comment_id":346864,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1653477699","product_id":100110101,"comment_content":"æ²¡æœ‰ç°æˆçš„é«˜æ€§èƒ½ç€‘å¸ƒæµç»„ä»¶å—ï¼Œæ”¹å¼€æºåº“æºç ä¹Ÿä¸æ˜¯å¾ˆæ–¹ä¾¿å‘","like_count":0,"discussions":[{"author":{"id":1088541,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9c/1d/f0f10198.jpg","nickname":"è’‹å®ä¼Ÿ","note":"","ucode":"02226CABD5ECE7","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573574,"discussion_content":"ç°åœ¨æ²¡æœ‰å“¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653522580,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345133,"user_name":"dao","can_delete":false,"product_type":"c1","uid":1087879,"ip_address":"","ucode":"4181FB270462CF","user_header":"https://static001.geekbang.org/account/avatar/00/10/99/87/98ebb20e.jpg","comment_is_top":false,"comment_ctime":1652071978,"is_pvip":true,"replies":[{"id":"126001","content":"ç‚¹èµğŸ‘<br>å®ç°ä¸‰åˆ—å¸ƒå±€çš„å…³é”®æ˜¯ç†è§£ ç€‘å¸ƒæµ æ¯ä¸€é¡¹è¯¥æ”¾å“ªã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1088541","ctime":1652157979,"ip_address":"","comment_id":345133,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1652071978","product_id":100110101,"comment_content":"ä¸‰åˆ—å¸ƒå±€è¿˜æ²¡æœ‰æ¥å¾—åŠå†™ï¼Œå•çº¯æŠ„è€å¸ˆçš„æ€è·¯æ¥æä¸¤åˆ—çš„ç€‘å¸ƒå¸ƒå±€å°±èŠ±äº†å¥½å‡ ä¸ªå°æ—¶ã€‚ç”¨ä¸Šäº† npm åŒ…çš„å‡ ç§ä¿®æ”¹æ–¹å¼â€”â€”è¿™æ˜¯ä¸ªé¢å¤–çš„æ”¶è·ã€‚ï¼ˆhttps:&#47;&#47;github.com&#47;hdouhua&#47;hybrid-mobile-app&#47;tree&#47;main&#47;AwesomeProject&#47;src&#47;c11ï¼‰<br>è¦æ‰©å±•è¿™ä¸ªç»„ä»¶çš„ç€‘å¸ƒå¸ƒå±€å°±å¿…é¡»é˜…è¯»æºç ã€‚é˜…è¯»æºç æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œä¹Ÿæ˜¯æ¯ä¸ªç¨‹åºå‘˜æˆé•¿å’Œè¿›é˜¶çš„å¿…ç»ä¹‹è·¯ï¼<br>","like_count":0,"discussions":[{"author":{"id":1088541,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9c/1d/f0f10198.jpg","nickname":"è’‹å®ä¼Ÿ","note":"","ucode":"02226CABD5ECE7","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571251,"discussion_content":"ç‚¹èµğŸ‘\nå®ç°ä¸‰åˆ—å¸ƒå±€çš„å…³é”®æ˜¯ç†è§£ ç€‘å¸ƒæµ æ¯ä¸€é¡¹è¯¥æ”¾å“ªã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652157980,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345132,"user_name":"dao","can_delete":false,"product_type":"c1","uid":1087879,"ip_address":"","ucode":"4181FB270462CF","user_header":"https://static001.geekbang.org/account/avatar/00/10/99/87/98ebb20e.jpg","comment_is_top":false,"comment_ctime":1652071420,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1652071420","product_id":100110101,"comment_content":"åˆ†äº«ä¸€ä¸‹ RN å‡çº§åŠ©æ‰‹ https:&#47;&#47;react-native-community.github.io&#47;upgrade-helper&#47;","like_count":0},{"had_liked":false,"id":343787,"user_name":"geeklyc","can_delete":false,"product_type":"c1","uid":1264061,"ip_address":"","ucode":"F25441AB6433B3","user_header":"https://static001.geekbang.org/account/avatar/00/13/49/bd/ae37990b.jpg","comment_is_top":false,"comment_ctime":1651054241,"is_pvip":false,"replies":[{"id":"125611","content":"æ·˜å®é¦–é¡µçš„æ•ˆæœæ˜¯å§ï¼Ÿ<br>ç¤¾åŒºæœ‰å®ç°ï¼Œä¸è¿‡ä»£ç æœ‰ç‚¹è€äº†ï¼Œå®Œæ•´ demo æˆ‘æ”¾åœ¨äº† Github æ‰‹åŠ¿åº“ Gesture çš„ç›®å½•ä¸‹äº†ï¼ˆè¿‡å‡ å¤©ä¸Šä¼ ï¼‰ã€‚<br><br>å…³é”®åº“å¦‚ä¸‹ï¼š<br>import { HScrollView } from &#39;react-native-head-tab-view&#39;<br>import { CollapsibleHeaderTabView } from &#39;react-native-tab-view-collapsible-header&#39;<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1088541","ctime":1651208183,"ip_address":"","comment_id":343787,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1651054241","product_id":100110101,"comment_content":"è€å¸ˆï¼Œå¯¹äºåˆ—è¡¨å‚ç›´æ»‘åŠ¨å¸é¡¶ï¼Œæ°´å¹³ä¹Ÿå¯ä»¥æ»‘åŠ¨çš„åˆ‡æ¢ä¸åŒçš„åˆ—è¡¨ï¼Œæœ‰ä»€ä¹ˆå¥½çš„å®ç°ä¸ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1088541,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9c/1d/f0f10198.jpg","nickname":"è’‹å®ä¼Ÿ","note":"","ucode":"02226CABD5ECE7","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":568714,"discussion_content":"æ·˜å®é¦–é¡µçš„æ•ˆæœæ˜¯å§ï¼Ÿ\nç¤¾åŒºæœ‰å®ç°ï¼Œä¸è¿‡ä»£ç æœ‰ç‚¹è€äº†ï¼Œå®Œæ•´ demo æˆ‘æ”¾åœ¨äº† Github æ‰‹åŠ¿åº“ Gesture çš„ç›®å½•ä¸‹äº†ï¼ˆè¿‡å‡ å¤©ä¸Šä¼ ï¼‰ã€‚\n\nå…³é”®åº“å¦‚ä¸‹ï¼š\nimport { HScrollView } from &#39;react-native-head-tab-view&#39;\nimport { CollapsibleHeaderTabView } from &#39;react-native-tab-view-collapsible-header&#39;\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651208183,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":343019,"user_name":"å­¦ä¹ ä¸­...","can_delete":false,"product_type":"c1","uid":1126774,"ip_address":"","ucode":"AF180F386ABC09","user_header":"https://static001.geekbang.org/account/avatar/00/11/31/76/8e3347a1.jpg","comment_is_top":false,"comment_ctime":1650596418,"is_pvip":true,"replies":[{"id":"125292","content":"ä¸ä¼šã€‚<br>ä»åŸç†å±‚é¢ï¼Œä½ å¯ä»¥ç”¨ Flipper æŸ¥çœ‹ Tree çš„é”€æ¯ã€å¤ç”¨ã€‚<br>ä»å®è·µå±‚é¢ï¼Œä½ å¯ä»¥ç”¨ Xcode AS ç­‰å·¥å…·æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1088541","ctime":1650598856,"ip_address":"","comment_id":343019,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1650596418","product_id":100110101,"comment_content":"å¤§ä½¬ï¼Œè¿™ç§æ–¹å¼ä¼šå½±å“RecyclerListViewçš„å¤ç”¨é€»è¾‘å—ï¼Œæ„Ÿè§‰è¿™ç§æ–¹å¼å¸ƒå±€viewå¤ç”¨é€»è¾‘ä¼šæœ‰é—®é¢˜ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1088541,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9c/1d/f0f10198.jpg","nickname":"è’‹å®ä¼Ÿ","note":"","ucode":"02226CABD5ECE7","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":566093,"discussion_content":"ä¸ä¼šã€‚\nä»åŸç†å±‚é¢ï¼Œä½ å¯ä»¥ç”¨ Flipper æŸ¥çœ‹ Tree çš„é”€æ¯ã€å¤ç”¨ã€‚\nä»å®è·µå±‚é¢ï¼Œä½ å¯ä»¥ç”¨ Xcode AS ç­‰å·¥å…·æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650598856,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":342916,"user_name":"è´ºå­å","can_delete":false,"product_type":"c1","uid":1003168,"ip_address":"","ucode":"472F4ECD9E7B17","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4e/a0/67782623.jpg","comment_is_top":false,"comment_ctime":1650531874,"is_pvip":false,"replies":[{"id":"125248","content":"ç›´æ¥ä¸Šä»£ç å§ï¼Œçœ‹äº†å°±æ‡‚ï¼š<br><br>https:&#47;&#47;github.com&#47;jiangleo&#47;react-native-classroom&#47;tree&#47;main&#47;src&#47;11_Waterfall&#47;lib&#47;RecyclerListView","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1088541","ctime":1650545812,"ip_address":"","comment_id":342916,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1650531874","product_id":100110101,"comment_content":"è¿è¡Œæ—¶ä¿®æ”¹è¿™ä¸ªæ–¹æ³•æ²¡å¤ªç†è§£<br>","like_count":0,"discussions":[{"author":{"id":1088541,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9c/1d/f0f10198.jpg","nickname":"è’‹å®ä¼Ÿ","note":"","ucode":"02226CABD5ECE7","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":565804,"discussion_content":"ç›´æ¥ä¸Šä»£ç å§ï¼Œçœ‹äº†å°±æ‡‚ï¼š\n\nhttps://github.com/jiangleo/react-native-classroom/tree/main/src/11_Waterfall/lib/RecyclerListView","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650545813,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}