{"id":469274,"title":"åŠ é¤ï½œèŠèŠGo 1.17ç‰ˆæœ¬çš„é‚£äº›æ–°ç‰¹æ€§","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯Tony Baiã€‚</p><p>ç°åœ¨æ˜¯2021å¹´12æœˆï¼Œä¸‡ä¼—æœŸç›¼çš„æ½œåŠ›ç½‘çº¢ç‰ˆæœ¬Go 1.18çš„å¼€å‘å·²ç»å†»ç»“ï¼ŒGoæ ¸å¿ƒå¼€å‘å›¢é˜Ÿæ­£åœ¨ç´§é”£å¯†é¼“åœ°ä¿®bugã€‚æˆ‘ä»¬å·²ç»å¯ä»¥å¼€å§‹æœŸå¾…2022å¹´çš„2æœˆä»½ï¼ŒGo 1.18å°†æºå¸¦åŒ…æ‹¬æ³›å‹è¯­æ³•çš„å¤§æ‰¹æ–°ç‰¹æ€§èµ¶æ¥ã€‚ä¸è¿‡å½“ä¸‹æˆ‘ä»¬ä¸èƒ½â€œèˆè¿‘æ±‚è¿œâ€ï¼Œä»Šå¹´8æœˆä¸­æ—¬Goæ ¸å¿ƒå›¢é˜Ÿå‘å¸ƒçš„<a href=\"https://go.dev/blog/go1.17\">Go 1.17ç‰ˆæœ¬</a>æ‰æ˜¯å½“ä¸‹æœ€å…·ç»Ÿæ²»åŠ›çš„Goç¤¾åŒºç½‘çº¢ï¼Œå®ƒçš„å½±å“åŠ›ä¾æ—§å¤„äºå·…å³°ã€‚</p><p>æ ¹æ®æˆ‘ä»¬åœ¨<a href=\"https://time.geekbang.org/column/article/427489\">ç¬¬3è®²</a>ä¸­æåˆ°çš„Goç‰ˆæœ¬é€‰æ‹©ç­–ç•¥ï¼Œæˆ‘ä¼°è®¡å¾ˆå¤šGoå¼€å‘è€…éƒ½è¿˜æ²¡åˆ‡æ¢åˆ°Go 1.17ç‰ˆæœ¬ï¼Œæ²¡æœ‰äº²è‡ªä½“éªŒè¿‡Go 1.17æ–°ç‰¹æ€§å¸¦æ¥çš„å˜åŒ–ï¼›è¿˜æœ‰ä¸€äº›Goå¼€å‘è€…è™½ç„¶å·²ç»å‡çº§åˆ°Go 1.17ç‰ˆæœ¬ï¼Œä½†ä¹Ÿä»…é™äºå¯¹Go 1.17ç‰ˆæœ¬çš„åŸºæœ¬ä½¿ç”¨ï¼Œå¯èƒ½è¿˜ä¸æ˜¯å¾ˆæ¸…æ¥šGo 1.17ç‰ˆæœ¬ä¸­ç©¶ç«Ÿæœ‰å“ªäº›æ–°ç‰¹æ€§ï¼Œä»¥åŠè¿™äº›æ–°ç‰¹æ€§ä¼šå¸¦ç»™ä»–ä»¬å“ªäº›å¥½å¤„ã€‚</p><p>æ‰€ä»¥ä»Šå¤©è¿™è®²ï¼Œæˆ‘ä»¬å°±æ¥èŠèŠGo 1.17ç‰ˆæœ¬ä¸­çš„æ–°ç‰¹æ€§ï¼Œç›®çš„æ˜¯è®©é‚£äº›æ²¡ç”¨è¿‡Go 1.17ç‰ˆæœ¬ï¼Œæˆ–è€…ç”¨è¿‡Go 1.17ç‰ˆæœ¬ä½†è¿˜ä¸çŸ¥é“å®ƒæ–°ç‰¹æ€§å˜åŒ–çš„Goå¼€å‘è€…ï¼Œå¯¹Go 1.17æœ‰ä¸€ä¸ªå…¨é¢çš„äº†è§£ã€‚</p><p>Go 1.17ç‰ˆæœ¬ä¸­çš„æ–°ç‰¹æ€§å¾ˆå¤šï¼Œåœ¨è¿™é‡Œæˆ‘å°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ï¼Œæˆ‘ä»…æŒ‘å‡ ä¸ªæœ‰ä»£è¡¨æ€§çš„ã€é‡è¦çš„æ–°ç‰¹æ€§å’Œä½ å¥½å¥½èŠèŠã€‚è¿™é‡Œä¼šåŒ…æ‹¬æ–°çš„è¯­æ³•ç‰¹æ€§ã€Go Moduleæœºåˆ¶å˜åŒ–ï¼Œä»¥åŠGoç¼–è¯‘å™¨ä¸è¿è¡Œæ—¶æ–¹é¢çš„å˜åŒ–ã€‚</p><!-- [[[read_end]]] --><h2>æ–°çš„è¯­æ³•ç‰¹æ€§</h2><p>åœ¨<a href=\"https://time.geekbang.org/column/article/426740\">ç¬¬2è®²</a>å­¦ä¹ Goè¯­è¨€è®¾è®¡å“²å­¦æ—¶ï¼Œæˆ‘ä»¬çŸ¥é“äº†Goè¯­è¨€çš„è®¾è®¡è€…ä»¬åœ¨è¯­è¨€è®¾è®¡ä¹‹åˆï¼Œå°±<strong>æ‹’ç»äº†èµ°è¯­è¨€ç‰¹æ€§èåˆçš„é“è·¯</strong>ï¼Œé€‰æ‹©äº†â€œåšå‡æ³•â€ï¼Œå¹¶è‡´åŠ›äºæ‰“é€ ä¸€é—¨<strong>ç®€å•</strong>çš„ç¼–ç¨‹è¯­è¨€ã€‚ä»è¯ç”Ÿåˆ°ç°åœ¨ï¼ŒGoè¯­è¨€è‡ªèº«è¯­æ³•ç‰¹æ€§å˜åŒ–å¾ˆå°ï¼Œç”šè‡³å¯ä»¥ç”¨<strong>å±ˆæŒ‡å¯æ•°</strong>æ¥å½¢å®¹ï¼Œå› æ­¤æ–°è¯­æ³•ç‰¹æ€§å¯¹äºGopheræ¥è¯´å±äºâ€œç¨€ç¼ºå“â€ã€‚è¿™ä¹Ÿç›´æ¥å¯¼è‡´äº†æ¯æ¬¡Goæ–°ç‰ˆæœ¬å‘å¸ƒï¼Œæˆ‘ä»¬éƒ½è¦å…ˆçœ‹çœ‹è¯­æ³•ç‰¹æ€§æ˜¯å¦æœ‰å˜æ›´ï¼Œæ¯ä¸ªæ–°åŠ å…¥è¯­æ³•ç‰¹æ€§éƒ½å€¼å¾—æˆ‘ä»¬æŠ•å…¥æ›´å¤šå…³æ³¨ï¼Œå»æ·±å…¥ç ”ç©¶ã€‚</p><p>ä¸å‡ºæ‰€æ–™ï¼ŒGo 1.17ç‰ˆæœ¬åœ¨è¯­æ³•ç‰¹æ€§æ–¹é¢ä»…ä»…åšäº†ä¸€å¤„å¢å¼ºï¼Œé‚£å°±æ˜¯<strong>æ”¯æŒåˆ‡ç‰‡è½¬æ¢ä¸ºæ•°ç»„æŒ‡é’ˆ</strong>ã€‚ä¸‹é¢æˆ‘ä»¬è¯¦ç»†æ¥çœ‹ä¸€ä¸‹ã€‚</p><h3>æ”¯æŒå°†åˆ‡ç‰‡è½¬æ¢ä¸ºæ•°ç»„æŒ‡é’ˆ</h3><p>åœ¨<a href=\"https://time.geekbang.org/column/article/444348\">ç¬¬15è®²</a>ä¸­ï¼Œæˆ‘ä»¬å¯¹Goä¸­çš„åˆ‡ç‰‡åšäº†ç³»ç»Ÿå…¨é¢çš„è®²è§£ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œé€šè¿‡æ•°ç»„åˆ‡ç‰‡åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªæ•°ç»„è½¬æ¢ä¸ºåˆ‡ç‰‡ã€‚è½¬æ¢åï¼Œæ•°ç»„å°†æˆä¸ºè½¬æ¢åçš„åˆ‡ç‰‡çš„åº•å±‚æ•°ç»„ï¼Œé€šè¿‡åˆ‡ç‰‡ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ”¹å˜æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œå°±åƒä¸‹é¢ä»£ç è¿™æ ·ï¼š</p><pre><code class=\"language-plain\">a := [3]int{11, 12, 13}\nb := a[:] // é€šè¿‡åˆ‡ç‰‡åŒ–å°†æ•°ç»„aè½¬æ¢ä¸ºåˆ‡ç‰‡b\nb[1] += 10\nfmt.Printf(\"%v\\n\", a) // [11 22 13]\n</code></pre><p>ä½†åè¿‡æ¥å°±ä¸è¡Œäº†ã€‚åœ¨Go 1.17ç‰ˆæœ¬ä¹‹å‰ï¼ŒGoå¹¶ä¸æ”¯æŒå°†åˆ‡ç‰‡å†è½¬æ¢å›æ•°ç»„ç±»å‹ã€‚å½“ç„¶ï¼Œå¦‚æœä½ éè¦è¿™ä¹ˆåšä¹Ÿä¸æ˜¯æ²¡æœ‰åŠæ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡unsafeåŒ…ä»¥ä¸å®‰å…¨çš„æ–¹å¼å®ç°è¿™æ ·çš„è½¬æ¢ï¼Œå¦‚ä¸‹é¢ä»£ç æ‰€ç¤ºï¼š</p><pre><code class=\"language-plain\">b := []int{11, 12, 13}\nvar p = (*[3]int)(unsafe.Pointer(&amp;b[0]))\np[1] += 10\nfmt.Printf(\"%v\\n\", b) // [11 22 13]\n</code></pre><p>ä½†æ˜¯unsafeåŒ…ï¼Œæ­£å¦‚å…¶åï¼Œå®ƒçš„å®‰å…¨æ€§æ²¡æœ‰å¾—åˆ°ç¼–è¯‘å™¨å’Œruntimeå±‚çš„ä¿è¯ï¼Œåªèƒ½ç”±å¼€å‘è€…è‡ªå·±ä¿è¯ï¼Œæ‰€ä»¥æˆ‘å»ºè®®Gopherä»¬åœ¨é€šå¸¸æƒ…å†µä¸‹ä¸è¦ä½¿ç”¨ã€‚</p><p>2009å¹´æœ«ï¼Œä¹Ÿå°±æ˜¯Goè¯­è¨€å®£å¸ƒå¼€æºåä¸ä¹…ï¼Œ<a href=\"https://github.com/rogpeppe\">Roger Peppe</a>ä¾¿æå‡ºä¸€ä¸ª<a href=\"https://github.com/golang/go/issues/395\">issue</a>ï¼Œå¸Œæœ›Goæ ¸å¿ƒå›¢é˜Ÿè€ƒè™‘åœ¨è¯­æ³•å±‚é¢è¡¥å……ä»åˆ‡ç‰‡åˆ°æ•°ç»„çš„è½¬æ¢è¯­æ³•ï¼ŒåŒæ—¶å¸Œæœ›è¿™ç§è½¬æ¢ä»¥åŠè½¬æ¢åçš„æ•°ç»„åœ¨ä½¿ç”¨æ—¶çš„ä¸‹æ ‡è¾¹ç•Œï¼Œèƒ½å¾—åˆ°ç¼–è¯‘å™¨å’Œruntimeçš„ååŠ©æ£€æŸ¥ã€‚<strong>åäºŒå¹´å</strong>è¿™ä¸ªissueç»ˆäºè¢«Goæ ¸å¿ƒå›¢é˜Ÿæ¥å—ï¼Œå¹¶åœ¨Go 1.17ç‰ˆæœ¬åŠ å…¥åˆ°Goè¯­æ³•ç‰¹æ€§å½“ä¸­ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨Go 1.17ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åƒä¸‹é¢ä»£ç è¿™æ ·å°†ä¸€ä¸ªåˆ‡ç‰‡è½¬æ¢ä¸ºæ•°ç»„ç±»å‹æŒ‡é’ˆï¼Œä¸ç”¨å†å€ŸåŠ©unsafeåŒ…çš„â€œé»‘é­”æ³•â€äº†ï¼š</p><pre><code class=\"language-plain\">b := []int{11, 12, 13}\np := (*[3]int)(b) // å°†åˆ‡ç‰‡è½¬æ¢ä¸ºæ•°ç»„ç±»å‹æŒ‡é’ˆ\np[1] = p[1] + 10\nfmt.Printf(\"%v\\n\", b) // [11 22 13]\n</code></pre><p>ä¸è¿‡ï¼Œè¿™é‡Œä½ è¦æ³¨æ„çš„æ˜¯ï¼ŒGoä¼šé€šè¿‡è¿è¡Œæ—¶è€Œä¸æ˜¯ç¼–è¯‘å™¨å»å¯¹è¿™ç±»åˆ‡ç‰‡åˆ°æ•°ç»„æŒ‡é’ˆçš„è½¬æ¢ä»£ç åšæ£€æŸ¥ï¼Œå¦‚æœå‘ç°è¶Šç•Œè¡Œä¸ºï¼Œå°±ä¼šè§¦å‘è¿è¡Œæ—¶panicã€‚Goè¿è¡Œæ—¶å®æ–½æ£€æŸ¥çš„ä¸€æ¡åŸåˆ™å°±æ˜¯â€œ<strong>è½¬æ¢åçš„æ•°ç»„é•¿åº¦ä¸èƒ½å¤§äºåŸåˆ‡ç‰‡çš„é•¿åº¦</strong>â€ï¼Œæ³¨æ„è¿™é‡Œæ˜¯åˆ‡ç‰‡çš„é•¿åº¦ï¼ˆlenï¼‰ï¼Œè€Œä¸æ˜¯åˆ‡ç‰‡çš„å®¹é‡ï¼ˆcapï¼‰ã€‚äºæ˜¯ä½ ä¼šçœ‹åˆ°ï¼Œä¸‹é¢çš„è½¬æ¢æœ‰äº›åˆæ³•ï¼Œæœ‰äº›éæ³•ï¼š</p><pre><code class=\"language-plain\">var b = []int{11, 12, 13}\nvar p = (*[4]int)(b) // cannot convert slice with length 3 to pointer to array with length 4\nvar p = (*[0]int)(b) // okï¼Œ*p = []\nvar p = (*[1]int)(b) // okï¼Œ*p = [11]\nvar p = (*[2]int)(b) // okï¼Œ*p = [11, 12]\nvar p = (*[3]int)(b) // okï¼Œ*p = [11, 12, 13]\nvar p = (*[3]int)(b[:1]) // cannot convert slice with length 1 to pointer to array with length 3 \n</code></pre><p>å¦å¤–ï¼Œnilåˆ‡ç‰‡æˆ–capä¸º0çš„emptyåˆ‡ç‰‡éƒ½å¯ä»¥è¢«è½¬æ¢ä¸ºä¸€ä¸ªé•¿åº¦ä¸º0çš„æ•°ç»„æŒ‡é’ˆï¼Œæ¯”å¦‚ï¼š</p><pre><code class=\"language-plain\">var b1 []int // nilåˆ‡ç‰‡\np1 := (*[0]int)(b1)\nvar b2 = []int{} // emptyåˆ‡ç‰‡\np2 := (*[0]int)(b2)\n</code></pre><p>è¯´å®Œäº†Goè¯­æ³•ç‰¹æ€§çš„å˜åŒ–åï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹Go Moduleæ„å»ºæ¨¡å¼åœ¨Go 1.17ä¸­çš„æ¼”è¿›ã€‚</p><h2>Go Moduleæ„å»ºæ¨¡å¼çš„å˜åŒ–</h2><p>è‡ªä»Go 1.11ç‰ˆæœ¬å¼•å…¥Go Moduleæ„å»ºæ¨¡å¼ä»¥æ¥ï¼Œæ¯ä¸ªGoå¤§ç‰ˆæœ¬å‘å¸ƒæ—¶ï¼ŒGo Moduleéƒ½ä¼šæœ‰ä¸å°‘çš„ç§¯æå˜åŒ–ï¼ŒGo 1.17ç‰ˆæœ¬ä¹Ÿä¸ä¾‹å¤–ã€‚</p><h3>ä¿®å‰ªçš„moduleä¾èµ–å›¾</h3><p>Go 1.17ç‰ˆæœ¬ä¸­ï¼ŒGo Moduleæœ€é‡è¦çš„ä¸€ä¸ªå˜åŒ–å°±æ˜¯<strong>pruned module graph</strong>ï¼Œå³<strong>ä¿®å‰ªçš„moduleä¾èµ–å›¾</strong>ã€‚è¦ç†è§£è¿™ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬å…ˆæ¥è®²ä»€ä¹ˆæ˜¯<strong>å®Œæ•´moduleä¾èµ–å›¾ã€‚</strong></p><p>åœ¨Go 1.17ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼ŒæŸä¸ªmoduleçš„ä¾èµ–å›¾æ˜¯ç”±è¿™ä¸ªmoduleçš„ç›´æ¥ä¾èµ–ä»¥åŠæ‰€æœ‰é—´æ¥ä¾èµ–ç»„æˆçš„ã€‚è¿™æ ·ï¼Œæ— è®ºæŸä¸ªé—´æ¥ä¾èµ–æ˜¯å¦çœŸæ­£ä¸ºåŸmoduleçš„æ„å»ºåšå‡ºè´¡çŒ®ï¼ŒGoå‘½ä»¤åœ¨è§£å†³ä¾èµ–æ—¶éƒ½ä¼šè¯»å–æ¯ä¸ªä¾èµ–çš„go.modï¼ŒåŒ…æ‹¬é‚£äº›æ²¡æœ‰è¢«çœŸæ­£ä½¿ç”¨åˆ°çš„moduleï¼Œè¿™æ ·å½¢æˆçš„moduleä¾èµ–å›¾è¢«ç§°ä¸º<strong>å®Œæ•´moduleä¾èµ–å›¾ï¼ˆcomplete module graphï¼‰</strong>ã€‚</p><p>ä»Go 1.17çš„ç‰ˆæœ¬å¼€å§‹ï¼ŒGoä¸å†ä½¿ç”¨â€œå®Œæ•´moduleä¾èµ–å›¾â€ï¼Œè€Œæ˜¯å¼•å…¥äº†pruned module graphï¼Œä¹Ÿå°±æ˜¯ä¿®å‰ªçš„moduleä¾èµ–å›¾ã€‚ä¿®å‰ªçš„moduleä¾èµ–å›¾å°±æ˜¯åœ¨å®Œæ•´moduleä¾èµ–å›¾çš„åŸºç¡€ä¸Šï¼Œå°†é‚£äº›å¯¹æ„å»ºå®Œå…¨æ²¡æœ‰â€œè´¡çŒ®â€çš„é—´æ¥ä¾èµ–moduleä¿®å‰ªæ‰åï¼Œå‰©ä½™çš„ä¾èµ–å›¾ã€‚ä½¿ç”¨ä¿®å‰ªåçš„moduleä¾èµ–å›¾è¿›è¡Œæ„å»ºï¼Œæœ‰åŠ©äºé¿å…ä¸‹è½½æˆ–é˜…è¯»é‚£äº›ä¸å¿…è¦çš„go.modæ–‡ä»¶ï¼Œè¿™æ ·Goå‘½ä»¤å¯ä»¥ä¸å»è·å–é‚£äº›ä¸ç›¸å…³çš„ä¾èµ–å…³ç³»ï¼Œä»è€Œåœ¨æ—¥å¸¸å¼€å‘ä¸­èŠ‚çœæ—¶é—´ã€‚</p><p>è¿™ä¹ˆè¯´è¿˜æ˜¯æ¯”è¾ƒæŠ½è±¡ï¼Œæˆ‘ä»¬ç”¨ä¸‹å›¾ä¸­çš„ä¾‹å­æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹moduleä¾èµ–å›¾ä¿®å‰ªçš„åŸç†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/2d/0b/2da4da70a5yy998bf635209642b5c80b.jpg?wh=1980x1080\" alt=\"\"></p><p>ä¸Šå›¾ä¸­çš„ä¾‹å­æ¥è‡ªäºGo 1.17æºç ä¸­çš„src/cmd/go/testdata/script/mod_lazy_new_import.txtï¼Œé€šè¿‡æ‰§è¡Œ<a href=\"https://golang.org/x/exp/cmd/txtar\">txtarå·¥å…·</a>ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªtxtè½¬æ¢ä¸ºmod_lazy_new_import.txtä¸­æè¿°çš„ç¤ºä¾‹ç»“æ„ï¼Œè½¬æ¢å‘½ä»¤ä¸º: <code>txtar -x &lt; $GOROOT/src/cmd/go/testdata/script/mod_lazy_new_import.txt</code>ã€‚</p><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œmain moduleä¸­çš„lazy.goå¯¼å…¥äº†module açš„package xï¼Œåè€…åˆ™å¯¼å…¥äº†module bä¸­çš„package bã€‚å¹¶ä¸”ï¼Œmodule aè¿˜æœ‰ä¸€ä¸ªpackage yï¼Œè¿™ä¸ªåŒ…å¯¼å…¥äº†module cçš„package cã€‚é€šè¿‡go mod graphå‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°main moduleçš„å®Œæ•´moduleä¾èµ–å›¾ï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾çš„å³ä¸Šè§’çš„é‚£å¼ ã€‚</p><p>ç°åœ¨é—®é¢˜æ¥äº†ï¼package yæ˜¯å› ä¸ºè‡ªèº«æ˜¯module açš„ä¸€éƒ¨åˆ†è€Œè¢«main moduleä¾èµ–çš„ï¼Œå®ƒè‡ªå·±æ²¡æœ‰ä¸ºmain moduleçš„æ„å»ºåšå‡ºä»»ä½•â€œä»£ç çº§è´¡çŒ®â€ï¼ŒåŒç†ï¼Œpackage yæ‰€ä¾èµ–çš„module cäº¦æ˜¯å¦‚æ­¤ã€‚ä½†æ˜¯åœ¨Go 1.17ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœGoç¼–è¯‘å™¨æ‰¾ä¸åˆ°module cï¼Œé‚£ä¹ˆmain moduleçš„æ„å»ºä¹Ÿä¼šå¤±è´¥ï¼Œè¿™ä¼šè®©å¼€å‘è€…ä»¬è§‰å¾—ä¸å¤Ÿåˆç†ï¼</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬ç›´è§‚åœ°çœ‹ä¸€ä¸‹åœ¨Go 1.16.5ä¸‹ï¼Œè¿™ä¸ªç¤ºä¾‹çš„go.modæ˜¯æ€æ ·çš„ï¼š</p><pre><code class=\"language-plain\">module example.com/lazy\n\ngo 1.15\n\nrequire example.com/a v0.1.0\n\nreplace (\n\texample.com/a v0.1.0 =&gt; ./a\n\texample.com/b v0.1.0 =&gt; ./b\n\texample.com/c v0.1.0 =&gt; ./c1\n\texample.com/c v0.2.0 =&gt; ./c2\n)\n</code></pre><p>æˆ‘ä»¬åªéœ€è¦å…³æ³¨requireå—ä¸­çš„å†…å®¹å°±å¯ä»¥äº†ï¼Œä¸‹é¢çš„replaceå—ä¸»è¦æ˜¯ä¸ºäº†ç¤ºä¾‹èƒ½æ‰¾åˆ°å„ç§ä¾èµ–moduleè€Œè®¾ç½®çš„ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨Go 1.16åŠä»¥å‰æ”¯æŒGo Moduleçš„ç‰ˆæœ¬å»ºç«‹çš„Go Moduleä¸­ï¼Œåœ¨go.modç»è¿‡go mod tidyåï¼Œrequireå—ä¸­ä¿ç•™çš„éƒ½æ˜¯main moduleçš„ç›´æ¥ä¾èµ–ï¼Œ<a href=\"https://go.dev/ref/mod#go-mod-file-require\">åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¹Ÿä¼šè®°å½•indirectä¾èµ–</a>ï¼Œè¿™äº›ä¾èµ–ä¼šåœ¨è¡Œå°¾ç”¨indirectæŒ‡ç¤ºç¬¦æ˜ç¤ºã€‚ä½†åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çœ‹ä¸åˆ°main moduleçš„é—´æ¥ä¾èµ–ä»¥åŠå®ƒä»¬çš„ç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨go mod graphæ¥æŸ¥çœ‹moduleä¾èµ–å›¾ï¼š</p><pre><code class=\"language-plain\">$go mod graph\nexample.com/lazy example.com/a@v0.1.0\nexample.com/a@v0.1.0 example.com/b@v0.1.0\nexample.com/a@v0.1.0 example.com/c@v0.1.0\n</code></pre><p>è¿™ä¸ªgo mod graphçš„è¾“å‡ºï¼Œå’Œæˆ‘ä»¬åœ¨ä¸Šé¢å›¾ä¸­å³ä¸Šè§’ç”»çš„module graphæ˜¯ä¸€è‡´çš„ã€‚æ­¤æ—¶ï¼Œå¦‚æœæˆ‘ä»¬å°†replaceä¸­çš„ç¬¬ä¸‰è¡Œï¼ˆexample.com/c v0.1.0 =&gt; ./c1è¿™ä¸€è¡Œï¼‰åˆ é™¤ï¼Œä¹Ÿå°±æ˜¯è®©Goç¼–è¯‘å™¨æ‰¾ä¸åˆ°module c@v0.1.0ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ„å»ºmain modueæ—¶å°±ä¼šå¾—åˆ°ä¸‹é¢çš„é”™è¯¯æç¤ºï¼š</p><pre><code class=\"language-plain\">$go build\ngo: example.com/a@v0.1.0 requires\n\texample.com/c@v0.1.0: missing go.sum entry; to add it:\n\tgo mod download example.com/c\n</code></pre><p>ç°åœ¨æˆ‘ä»¬å°†æ‰§è¡Œæƒé™äº¤ç»™Go 1.17çœ‹çœ‹ä¼šæ€æ ·ï¼</p><p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å¯¹go.modåšä¸€äº›ä¿®æ”¹ï¼Œä¹Ÿå°±æ˜¯å°†go.modä¸­çš„go 1.15æ”¹ä¸ºgo 1.17ï¼Œè¿™æ ·Go 1.17æ‰èƒ½èµ·åˆ°ä½œç”¨ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ‰§è¡Œgo mod tidyï¼Œè®©Go 1.17é‡æ–°æ„å»ºgo.modï¼š</p><pre><code class=\"language-plain\">$go mod tidy\n$cat go.mod\n\nmodule example.com/lazy\n\ngo 1.17\n\nrequire example.com/a v0.1.0\n\nrequire example.com/b v0.1.0 // indirect\n\nreplace (\n\texample.com/a v0.1.0 =&gt; ./a\n\texample.com/b v0.1.0 =&gt; ./b\n\texample.com/c v0.1.0 =&gt; ./c1\n\texample.com/c v0.2.0 =&gt; ./c2\n)\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°æ‰§è¡Œgo mod tidyä¹‹åï¼Œgo.modå‘ç”Ÿäº†å˜åŒ–ï¼šå¢åŠ äº†ä¸€ä¸ªrequireè¯­å¥å—ï¼Œè®°å½•äº†main moduleçš„é—´æ¥ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯module b@v0.10ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬ä¹ŸåŒæ ·å°†go.mod replaceå—ä¸­çš„ç¬¬ä¸‰è¡Œï¼ˆexample.com/c v0.1.0 =&gt; ./c1è¿™ä¸€è¡Œï¼‰åˆ é™¤ï¼Œå†æ¥ç”¨go 1.17æ„å»ºä¸€æ¬¡main moduleã€‚</p><p>è¿™ä¸€æ¬¡æˆ‘ä»¬æ²¡æœ‰çœ‹åˆ°Goç¼–è¯‘å™¨çš„é”™è¯¯æç¤ºã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨æ„å»ºè¿‡ç¨‹ä¸­ï¼ŒGoç¼–è¯‘å™¨çœ‹åˆ°çš„main moduleä¾èµ–å›¾ä¸­å¹¶æ²¡æœ‰module c@v0.1.0ã€‚è¿™æ˜¯å› ä¸ºmodule cå¹¶æ²¡æœ‰ä¸ºmain moduleçš„æ„å»ºæä¾›â€œä»£ç çº§è´¡çŒ®â€ï¼Œæ‰€ä»¥Goå‘½ä»¤æŠŠå®ƒä»moduleä¾èµ–å›¾ä¸­å‰ªé™¤äº†ã€‚è¿™ä¸€æ¬¡ï¼ŒGoç¼–è¯‘å™¨ä½¿ç”¨çš„çœŸå®çš„ä¾èµ–å›¾æ˜¯ä¸Šå›¾å³ä¸‹è§’çš„é‚£å¼ ã€‚è¿™ç§å°†é‚£äº›å¯¹æ„å»ºå®Œå…¨æ²¡æœ‰â€œè´¡çŒ®â€çš„é—´æ¥ä¾èµ–moduleä»æ„å»ºæ—¶ä½¿ç”¨çš„ä¾èµ–å›¾ä¸­ä¿®å‰ªæ‰çš„è¿‡ç¨‹ï¼Œå°±è¢«ç§°ä¸º<strong>moduleä¾èµ–å›¾ä¿®å‰ªï¼ˆpruned module graphï¼‰</strong>ã€‚</p><p><strong>ä½†moduleä¾èµ–å›¾ä¿®å‰ªä¹Ÿå¸¦æ¥äº†ä¸€ä¸ªå‰¯ä½œç”¨ï¼Œé‚£å°±æ˜¯go.modæ–‡ä»¶sizeçš„å˜å¤§ã€‚</strong>å› ä¸ºä»Go 1.17ç‰ˆæœ¬å¼€å§‹ï¼Œæ¯æ¬¡è°ƒç”¨go mod tidyï¼ŒGoå‘½ä»¤éƒ½ä¼šå¯¹main moduleçš„ä¾èµ–åšä¸€æ¬¡æ·±åº¦æ‰«æï¼ˆdeepening scanï¼‰ï¼Œå¹¶å°†main moduleçš„æ‰€æœ‰ç›´æ¥å’Œé—´æ¥ä¾èµ–éƒ½è®°å½•åœ¨go.modä¸­ã€‚è€ƒè™‘åˆ°ä¾èµ–çš„å†…å®¹è¾ƒå¤šï¼Œgo 1.17ä¼šå°†ç›´æ¥ä¾èµ–å’Œé—´æ¥ä¾èµ–åˆ†åˆ«æ”¾åœ¨å¤šä¸ªä¸åŒçš„requireå—ä¸­ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨Go 1.17ç‰ˆæœ¬ä¸­ï¼Œgo.modä¸­å­˜å‚¨äº†main moduleçš„æ‰€æœ‰ä¾èµ–moduleåˆ—è¡¨ï¼Œè¿™ä¼¼ä¹ä¹Ÿæ˜¯Goé¡¹ç›®ç¬¬ä¸€æ¬¡æœ‰äº†é¡¹ç›®ä¾èµ–çš„å®Œæ•´åˆ—è¡¨ã€‚ä¸çŸ¥é“ä¼šä¸ä¼šè®©ä½ æƒ³èµ·å…¶ä»–ä¸»æµè¯­è¨€æ„æ¶ç³»ç»Ÿä¸­çš„é‚£ä¸ªlockæ–‡ä»¶å‘¢ï¼Ÿè™½ç„¶go.modå¹¶ä¸æ˜¯lockæ–‡ä»¶ï¼Œä½†æœ‰äº†å®Œæ•´ä¾èµ–åˆ—è¡¨ï¼Œè‡³å°‘æˆ‘ä»¬å¯ä»¥åƒå…¶ä»–è¯­è¨€çš„lockæ–‡ä»¶é‚£æ ·ï¼ŒçŸ¥æ™“å½“å‰Goé¡¹ç›®æ‰€æœ‰ä¾èµ–çš„ç²¾ç¡®ç‰ˆæœ¬äº†ã€‚</p><p>åœ¨è®²è§£ä¸‹ä¸€ä¸ªé‡è¦å˜åŒ–ä¹‹å‰ï¼Œæˆ‘è¿˜è¦æä¸€ç‚¹å°å˜åŒ–ï¼Œé‚£å°±æ˜¯<strong>åœ¨Go 1.17ç‰ˆæœ¬ä¸­ï¼Œgo getå·²ç»ä¸å†è¢«ç”¨æ¥å®‰è£…æŸä¸ªå‘½ä»¤çš„å¯æ‰§è¡Œæ–‡ä»¶äº†</strong>ã€‚å¦‚æœä½ ä¾æ—§ä½¿ç”¨go getå®‰è£…ï¼ŒGoå‘½ä»¤ä¼šæç¤ºé”™è¯¯ã€‚è¿™ä¹Ÿæ˜¯å¾ˆå¤šåŒå­¦åœ¨å­¦ä¹ æˆ‘ä»¬è¯¾ç¨‹çš„å…¥é—¨ç¯‡æ—¶ç»å¸¸ä¼šé—®çš„ä¸€ä¸ªé—®é¢˜ã€‚</p><p>æ–°ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨go installæ¥å®‰è£…ï¼Œå¹¶ä¸”ä½¿ç”¨go installå®‰è£…æ—¶è¿˜è¦ç”¨@vx.y.zæ˜ç¡®è¦å®‰è£…çš„å‘½ä»¤çš„äºŒè¿›åˆ¶æ–‡ä»¶çš„ç‰ˆæœ¬ï¼Œæˆ–è€…æ˜¯ä½¿ç”¨@latestæ¥å®‰è£…æœ€æ–°ç‰ˆæœ¬ã€‚</p><p>é™¤äº†Goè¯­æ³•ç‰¹æ€§ä¸Go Moduleæœ‰é‡è¦å˜åŒ–ä¹‹å¤–ï¼ŒGoç¼–è¯‘å™¨çš„å˜åŒ–å¯¹Goç¨‹åºçš„æ„å»ºä¸è¿è¡Œå½±å“åŒæ ·ååˆ†å·¨å¤§ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°±æ¥çœ‹ä¸€ä¸‹Go 1.17åœ¨è¿™æ–¹é¢çš„é‡è¦å˜åŒ–ã€‚</p><h2>Goç¼–è¯‘å™¨çš„å˜åŒ–</h2><p>åœ¨Go1.17ç‰ˆæœ¬ï¼ŒGoç¼–è¯‘å™¨çš„å˜åŒ–ä¸»è¦æ˜¯åœ¨AMD64æ¶æ„ä¸‹å®ç°äº†åŸºäºå¯„å­˜å™¨çš„è°ƒç”¨æƒ¯ä¾‹ï¼Œä»¥åŠæ–°å¼•å…¥äº†//go:buildå½¢å¼çš„æ„å»ºçº¦æŸæŒ‡ç¤ºç¬¦ã€‚ç°åœ¨æˆ‘ä»¬å°±æ¥åˆ†æä¸‹è¿™ä¸¤ç‚¹ã€‚</p><h3>åŸºäºå¯„å­˜å™¨çš„è°ƒç”¨æƒ¯ä¾‹</h3><p>Go 1.17ç‰ˆæœ¬ä¸­ï¼ŒGoç¼–è¯‘å™¨æœ€å¤§çš„å˜åŒ–æ˜¯åœ¨AMD64æ¶æ„ä¸‹ç‡å…ˆå®ç°äº†<a href=\"https://github.com/golang/go/issues/40724\">ä»åŸºäºå †æ ˆçš„è°ƒç”¨æƒ¯ä¾‹åˆ°åŸºäºå¯„å­˜å™¨çš„è°ƒç”¨æƒ¯ä¾‹çš„åˆ‡æ¢</a>ã€‚</p><p>æ‰€è°“â€œè°ƒç”¨æƒ¯ä¾‹ï¼ˆcalling conventionï¼‰â€ï¼Œæ˜¯æŒ‡è°ƒç”¨æ–¹å’Œè¢«è°ƒç”¨æ–¹å¯¹äºå‡½æ•°è°ƒç”¨çš„ä¸€ä¸ªæ˜ç¡®çš„çº¦å®šï¼ŒåŒ…æ‹¬å‡½æ•°å‚æ•°ä¸è¿”å›å€¼çš„ä¼ é€’æ–¹å¼ã€ä¼ é€’é¡ºåºã€‚åªæœ‰åŒæ–¹éƒ½éµå®ˆåŒæ ·çš„çº¦å®šï¼Œå‡½æ•°æ‰èƒ½è¢«æ­£ç¡®åœ°è°ƒç”¨å’Œæ‰§è¡Œã€‚å¦‚æœä¸éµå®ˆè¿™ä¸ªçº¦å®šï¼Œå‡½æ•°å°†æ— æ³•æ­£ç¡®æ‰§è¡Œã€‚</p><p>Go 1.17ç‰ˆæœ¬ä¹‹å‰ï¼ŒGoé‡‡ç”¨åŸºäºæ ˆçš„è°ƒç”¨çº¦å®šï¼Œä¹Ÿå°±æ˜¯è¯´å‡½æ•°çš„å‚æ•°ä¸è¿”å›å€¼éƒ½é€šè¿‡æ ˆæ¥ä¼ é€’ï¼Œè¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯å®ç°ç®€å•ï¼Œä¸ç”¨æ‹…å¿ƒåº•å±‚CPUæ¶æ„å¯„å­˜å™¨çš„å·®å¼‚ï¼Œé€‚åˆè·¨å¹³å°ï¼Œä½†ç¼ºç‚¹å°±æ˜¯ç‰ºç‰²äº†ä¸€äº›æ€§èƒ½ã€‚</p><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå¯„å­˜å™¨çš„è®¿é—®é€Ÿåº¦æ˜¯è¦è¿œé«˜äºå†…å­˜çš„ã€‚æ‰€ä»¥ï¼Œç°åœ¨å¤§å¤šæ•°å¹³å°ä¸Šçš„å¤§å¤šæ•°è¯­è¨€å®ç°éƒ½ä½¿ç”¨åŸºäºå¯„å­˜å™¨çš„è°ƒç”¨çº¦å®šï¼Œé€šè¿‡å¯„å­˜å™¨è€Œä¸æ˜¯å†…å­˜ä¼ é€’å‡½æ•°å‚æ•°å’Œè¿”å›ç»“æœï¼Œå¹¶æŒ‡å®šä¸€äº›å¯„å­˜å™¨ä¸ºè°ƒç”¨ä¿å­˜å¯„å­˜å™¨ï¼Œå…è®¸å‡½æ•°åœ¨ä¸åŒçš„è°ƒç”¨ä¸­ä¿æŒçŠ¶æ€ã€‚Goæ ¸å¿ƒå›¢é˜Ÿå†³å®šåœ¨1.17ç‰ˆæœ¬å‘è¿™äº›è¯­è¨€çœ‹é½ï¼Œå¹¶åœ¨AMD64æ¶æ„ä¸‹ç‡å…ˆå®ç°åŸºäºå¯„å­˜å™¨çš„è°ƒç”¨æƒ¯ä¾‹ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åœ¨Go 1.17çš„ç‰ˆæœ¬å‘å¸ƒè¯´æ˜æ–‡æ¡£ä¸­çœ‹åˆ°ï¼Œåˆ‡æ¢åˆ°åŸºäºå¯„å­˜å™¨çš„è°ƒç”¨æƒ¯ä¾‹åï¼Œä¸€ç»„æœ‰ä»£è¡¨æ€§çš„GoåŒ…å’Œç¨‹åºçš„åŸºå‡†æµ‹è¯•æ˜¾ç¤ºï¼ŒGoç¨‹åºçš„è¿è¡Œæ€§èƒ½æé«˜äº†çº¦5%ï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶å¤§å°å…¸å‹å‡å°‘çº¦2%ã€‚</p><p>é‚£æˆ‘ä»¬è¿™é‡Œå°±æ¥å®æµ‹ä¸€ä¸‹ï¼Œçœ‹çœ‹æ˜¯å¦çœŸçš„èƒ½æå‡é‚£ä¹ˆå¤šã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨å¤šç§æ–¹æ³•è¿›è¡Œå­—ç¬¦ä¸²è¿æ¥çš„benchmarkæµ‹è¯•æºç ï¼š</p><pre><code class=\"language-plain\">var sl []string = []string{\n\t\"Rob Pike \",\n\t\"Robert Griesemer \",\n\t\"Ken Thompson \",\n}\n\nfunc concatStringByOperator(sl []string) string {\n\tvar s string\n\tfor _, v := range sl {\n\t\ts += v\n\t}\n\treturn s\n}\n\nfunc concatStringBySprintf(sl []string) string {\n\tvar s string\n\tfor _, v := range sl {\n\t\ts = fmt.Sprintf(\"%s%s\", s, v)\n\t}\n\treturn s\n}\n\nfunc concatStringByJoin(sl []string) string {\n\treturn strings.Join(sl, \"\")\n}\n\nfunc concatStringByStringsBuilder(sl []string) string {\n\tvar b strings.Builder\n\tfor _, v := range sl {\n\t\tb.WriteString(v)\n\t}\n\treturn b.String()\n}\n\nfunc concatStringByStringsBuilderWithInitSize(sl []string) string {\n\tvar b strings.Builder\n\tb.Grow(64)\n\tfor _, v := range sl {\n\t\tb.WriteString(v)\n\t}\n\treturn b.String()\n}\n\nfunc concatStringByBytesBuffer(sl []string) string {\n\tvar b bytes.Buffer\n\tfor _, v := range sl {\n\t\tb.WriteString(v)\n\t}\n\treturn b.String()\n}\n\nfunc concatStringByBytesBufferWithInitSize(sl []string) string {\n\tbuf := make([]byte, 0, 64)\n\tb := bytes.NewBuffer(buf)\n\tfor _, v := range sl {\n\t\tb.WriteString(v)\n\t}\n\treturn b.String()\n}\n\nfunc BenchmarkConcatStringByOperator(b *testing.B) {\n\tfor n := 0; n &lt; b.N; n++ {\n\t\tconcatStringByOperator(sl)\n\t}\n}\n\nfunc BenchmarkConcatStringBySprintf(b *testing.B) {\n\tfor n := 0; n &lt; b.N; n++ {\n\t\tconcatStringBySprintf(sl)\n\t}\n}\n\nfunc BenchmarkConcatStringByJoin(b *testing.B) {\n\tfor n := 0; n &lt; b.N; n++ {\n\t\tconcatStringByJoin(sl)\n\t}\n}\n\nfunc BenchmarkConcatStringByStringsBuilder(b *testing.B) {\n\tfor n := 0; n &lt; b.N; n++ {\n\t\tconcatStringByStringsBuilder(sl)\n\t}\n}\n\nfunc BenchmarkConcatStringByStringsBuilderWithInitSize(b *testing.B) {\n\tfor n := 0; n &lt; b.N; n++ {\n\t\tconcatStringByStringsBuilderWithInitSize(sl)\n\t}\n}\n\nfunc BenchmarkConcatStringByBytesBuffer(b *testing.B) {\n\tfor n := 0; n &lt; b.N; n++ {\n\t\tconcatStringByBytesBuffer(sl)\n\t}\n}\n\nfunc BenchmarkConcatStringByBytesBufferWithInitSize(b *testing.B) {\n\tfor n := 0; n &lt; b.N; n++ {\n\t\tconcatStringByBytesBufferWithInitSize(sl)\n\t}\n}\n</code></pre><p>æˆ‘ä»¬ä½¿ç”¨Go 1.16.5å’ŒGo 1.17åˆ†åˆ«è¿è¡Œè¿™ä¸ªBenchmarkç¤ºä¾‹ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p>Go 1.16.5ï¼š</p><pre><code class=\"language-plain\">$go test -bench .\ngoos: darwin\ngoarch: amd64\npkg: github.com/bigwhite/demo\ncpu: Intel(R) Core(TM) i5-8257U CPU @ 1.40GHz\nBenchmarkConcatStringByOperator-8                     \t12132355\t        91.51 ns/op\nBenchmarkConcatStringBySprintf-8                      \t 2707862\t       445.1 ns/op\nBenchmarkConcatStringByJoin-8                         \t24101215\t        50.84 ns/op\nBenchmarkConcatStringByStringsBuilder-8               \t11104750\t       124.4 ns/op\nBenchmarkConcatStringByStringsBuilderWithInitSize-8   \t24542085\t        48.24 ns/op\nBenchmarkConcatStringByBytesBuffer-8                  \t14425054\t        77.73 ns/op\nBenchmarkConcatStringByBytesBufferWithInitSize-8      \t20863174\t        49.07 ns/op\nPASS\nok  \tgithub.com/bigwhite/demo\t9.166s\n</code></pre><p>Go 1.17ï¼š</p><pre><code class=\"language-plain\">$go test -bench .\ngoos: darwin\ngoarch: amd64\npkg: github.com/bigwhite/demo\ncpu: Intel(R) Core(TM) i5-8257U CPU @ 1.40GHz\nBenchmarkConcatStringByOperator-8                     \t13058850\t        89.47 ns/op\nBenchmarkConcatStringBySprintf-8                      \t 2889898\t       410.1 ns/op\nBenchmarkConcatStringByJoin-8                         \t25469310\t        47.15 ns/op\nBenchmarkConcatStringByStringsBuilder-8               \t13064298\t        92.33 ns/op\nBenchmarkConcatStringByStringsBuilderWithInitSize-8   \t29780911\t        41.14 ns/op\nBenchmarkConcatStringByBytesBuffer-8                  \t16900072\t        70.28 ns/op\nBenchmarkConcatStringByBytesBufferWithInitSize-8      \t27310650\t        43.96 ns/op\nPASS\nok  \tgithub.com/bigwhite/demo\t9.198s\n</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç›¸å¯¹äºGo 1.16.5è·‘å‡ºçš„ç»“æœï¼ŒGo 1.17åœ¨æ¯ä¸€ä¸ªæµ‹è¯•é¡¹ä¸Šéƒ½æœ‰å°å¹…çš„æ€§èƒ½æå‡ï¼Œæœ‰äº›æ€§èƒ½æå‡ç”šè‡³è¾¾åˆ°10%å·¦å³ï¼ˆä»¥BenchmarkConcatStringBySprintfä¸ºä¾‹ï¼Œå®ƒçš„æ€§èƒ½æå‡ä¸º(445.1-410.1)/445.1=7.8%ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ä½ çš„Goæºç ä½¿ç”¨Go 1.17ç‰ˆæœ¬é‡æ–°ç¼–è¯‘ä¸€ä¸‹ï¼Œå°±èƒ½è·å¾—å¤§çº¦5%çš„æ€§èƒ½æå‡ï¼Œè¿™ç§æ–°ç‰ˆæœ¬å¸¦æ¥çš„æ€§èƒ½çš„â€œè‡ªç„¶æå‡â€æ˜¾ç„¶æ˜¯å¹¿å¤§Gopherä¹æ„çœ‹åˆ°çš„ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹ç¼–è¯‘åçš„GoäºŒè¿›åˆ¶æ–‡ä»¶çš„Sizeå˜åŒ–ã€‚æˆ‘ä»¬ä»¥ä¸€ä¸ªè‡ªæœ‰çš„1wè¡Œå·¦å³ä»£ç çš„Goç¨‹åºä¸ºä¾‹ï¼Œåˆ†åˆ«ç”¨Go 1.16.5å’ŒGo 1.17è¿›è¡Œç¼–è¯‘ï¼Œå¾—åˆ°çš„ç»“æœå¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">-rwxr-xr-x   1 tonybai  staff  7264432  8 13 18:31 myapp-go1.16.5*\n-rwxr-xr-x   1 tonybai  staff  6934352  8 13 18:32 myapp-go1.17*\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼ŒGo 1.17ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶å¤§å°ç›¸æ¯”Go 1.16.5ç‰ˆæœ¬å‡å°‘äº†çº¦4%ï¼Œæ¯”Goå®˜æ–¹æ–‡æ¡£å‘å¸ƒçš„å¹³å‡æ•ˆæœè¿˜è¦å¥½ä¸Šä¸€äº›ã€‚</p><p>è€Œä¸”ï¼ŒGo 1.17å‘å¸ƒè¯´æ˜ä¹Ÿæåˆ°äº†ï¼š<strong>æ”¹ä¸ºåŸºäºå¯„å­˜å™¨çš„è°ƒç”¨æƒ¯ä¾‹åï¼Œç»å¤§å¤šæ•°ç¨‹åºä¸ä¼šå—åˆ°å½±å“ã€‚</strong>åªæœ‰é‚£äº›ä¹‹å‰å°±å·²ç»è¿åunsafe.Pointerçš„ä½¿ç”¨è§„åˆ™çš„ä»£ç å¯èƒ½ä¼šå—åˆ°å½±å“ï¼Œæ¯”å¦‚ä¸éµå®ˆunsafeè§„åˆ™é€šè¿‡unsafe.Pointerè®¿é—®å‡½æ•°å‚æ•°ï¼Œæˆ–è€…ä¾èµ–ä¸€äº›åƒæ¯”è¾ƒå‡½æ•°ä»£ç æŒ‡é’ˆçš„æœªå…¬å¼€çš„è¡Œä¸ºã€‚</p><h3>//go:buildå½¢å¼çš„æ„å»ºçº¦æŸæŒ‡ç¤ºç¬¦</h3><p>æ­¤å¤–ï¼ŒGoç¼–è¯‘å™¨è¿˜åœ¨Go 1.17ä¸­å¼•å…¥äº†//go:buildå½¢å¼çš„æ„å»ºçº¦æŸæŒ‡ç¤ºç¬¦ï¼Œä»¥æ›¿ä»£åŸå…ˆæ˜“é”™çš„// +buildå½¢å¼ã€‚</p><p>åœ¨Go 1.17ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨æºç æ–‡ä»¶å¤´éƒ¨æ”¾ç½®// +buildæ„å»ºçº¦æŸæŒ‡ç¤ºç¬¦æ¥å®ç°æ„å»ºçº¦æŸï¼Œä½†è¿™ç§å½¢å¼ååˆ†æ˜“é”™ï¼Œå¹¶ä¸”å®ƒå¹¶ä¸æ”¯æŒ&amp;&amp;å’Œ||è¿™æ ·çš„ç›´è§‚çš„é€»è¾‘æ“ä½œç¬¦ï¼Œè€Œæ˜¯ç”¨é€—å·ã€ç©ºæ ¼æ›¿ä»£ï¼Œè¿™é‡Œä½ å¯ä»¥çœ‹ä¸‹åŸ// +buildå½¢å¼æ„å»ºçº¦æŸæŒ‡ç¤ºç¬¦çš„ç”¨æ³•åŠå«ä¹‰ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/22/21/22c37012e48157bdc9a71110bc314421.png?wh=1920x532\" alt=\"å›¾ç‰‡\"></p><p>ä½†è¿™ç§ä¸ç¨‹åºå‘˜ç›´è§‰â€œæœ‰æ‚–â€çš„å½¢å¼è®©Gopherä»¬ååˆ†ç—›è‹¦ï¼Œäºæ˜¯Go 1.17å›å½’â€œ<s>æ­£è§„</s>æ­£è½¨â€ï¼Œå¼•å…¥äº†<a href=\"https://go.googlesource.com/proposal/+/master/design/draft-gobuild.md\">//go:buildå½¢å¼çš„æ„å»ºçº¦æŸæŒ‡ç¤ºç¬¦</a>ã€‚ä¸€æ–¹é¢ï¼Œè¿™å¯ä»¥ä¸æºæ–‡ä»¶ä¸­çš„å…¶ä»–æŒ‡ç¤ºç¬¦ä¿æŒå½¢å¼ä¸€è‡´ï¼Œæ¯”å¦‚ //go:nosplitã€//go:noraceã€//go:noinlineã€//go:generateç­‰ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œæ–°å½¢å¼å°†æ”¯æŒ&amp;&amp;å’Œ||é€»è¾‘æ“ä½œç¬¦ï¼Œè¿™æ ·çš„å½¢å¼å°±æ˜¯è‡ªè§£é‡Šçš„ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬ç¨‹åºå‘˜å°±ä¸éœ€è¦å†åƒä¸Šé¢é‚£æ ·åˆ—å‡ºä¸€ä¸ªè¡¨æ¥è§£é‡Šæ¯ä¸ªæŒ‡ç¤ºç¬¦ç»„åˆçš„å«ä¹‰äº†ã€‚æ–°å½¢å¼æ˜¯è¿™æ ·çš„ï¼š</p><pre><code class=\"language-plain\">//go:build linux &amp;&amp; (386 || amd64 || arm || arm64 || mips64 || mips64le || ppc64 || ppc64le)\n//go:build linux &amp;&amp; (mips64 || mips64le)\n//go:build linux &amp;&amp; (ppc64 || ppc64le)\n//go:build linux &amp;&amp; !386 &amp;&amp; !arm\n</code></pre><p>è€ƒè™‘åˆ°å…¼å®¹æ€§ï¼ŒGoå‘½ä»¤å¯ä»¥è¯†åˆ«è¿™ä¸¤ç§å½¢å¼çš„æ„å»ºçº¦æŸæŒ‡ç¤ºç¬¦ï¼Œä½†æ¨èGo 1.17ä¹‹åéƒ½ç”¨æ–°å¼•å…¥çš„è¿™ç§å½¢å¼ã€‚</p><p>å¦å¤–ï¼Œgofmtä¹Ÿå¯ä»¥å…¼å®¹å¤„ç†ä¸¤ç§å½¢å¼ã€‚å®ƒçš„å¤„ç†åŸåˆ™æ˜¯ï¼šå¦‚æœä¸€ä¸ªæºç æ–‡ä»¶åªæœ‰// +buildå½¢å¼çš„æŒ‡ç¤ºç¬¦ï¼Œgofmtä¼šæŠŠå’Œå®ƒç­‰ä»·çš„//go:buildè¡ŒåŠ å…¥ã€‚å¦åˆ™ï¼Œå¦‚æœä¸€ä¸ªæºæ–‡ä»¶ä¸­åŒæ—¶å­˜åœ¨è¿™ä¸¤ç§å½¢å¼çš„æŒ‡ç¤ºç¬¦è¡Œï¼Œé‚£ä¹ˆ//+buildè¡Œçš„ä¿¡æ¯å°±ä¼šè¢«//go:buildè¡Œçš„ä¿¡æ¯æ‰€è¦†ç›–ã€‚</p><p>é™¤äº†gofmtå¤–ï¼Œgo vetå·¥å…·ä¹Ÿä¼šæ£€æµ‹æºæ–‡ä»¶ä¸­æ˜¯å¦åŒæ—¶å­˜åœ¨ä¸åŒå½¢å¼çš„ã€è¯­ä¹‰ä¸ä¸€è‡´çš„æ„å»ºæŒ‡ç¤ºç¬¦ï¼Œæ¯”å¦‚é’ˆå¯¹ä¸‹é¢è¿™æ®µä»£ç ï¼š</p><pre><code class=\"language-plain\">//go:build linux &amp;&amp; !386 &amp;&amp; !arm\n// +build linux\n\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n\tfmt.Println(\"hello, world\")\n}\n</code></pre><p>go vetä¼šæç¤ºå¦‚ä¸‹é—®é¢˜ï¼š</p><pre><code class=\"language-plain\">./buildtag.go:2:1: +build lines do not match //go:build condition\n</code></pre><h2>å°ç»“</h2><p>Go 1.17ç‰ˆæœ¬çš„ä¸€äº›é‡è¦æ–°ç‰¹æ€§å°±ä»‹ç»åˆ°è¿™é‡Œäº†ï¼Œé™¤äº†ä¸Šé¢è¿™äº›é‡è¦å˜åŒ–ä¹‹å¤–ï¼ŒGo 1.17è¿˜æœ‰å¾ˆå¤šå˜æ›´ä¸æ”¹è¿›ï¼Œå¦‚æœä½ è¿˜æ„çŠ¹æœªå°½ï¼Œå»ºè®®ä½ å»è®¤çœŸè¯»è¯»<a href=\"https://go.dev/doc/go1.17\">Go 1.17çš„å‘å¸ƒè¯´æ˜æ–‡æ¡£</a>ã€‚</p><p>å¦å¤–æˆ‘è¿˜è¦å¤šè¯´ä¸€å¥ï¼ŒGo 1.17ç‰ˆæœ¬çš„è¿™äº›å˜æ›´éƒ½æ˜¯åœ¨Go1å…¼å®¹æ€§çš„æ‰¿è¯ºèŒƒå›´å†…çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒGo 1.17ç‰ˆæœ¬ç§‰æŒäº†Goè¯­è¨€å¼€æºä»¥æ¥å„ä¸ªç‰ˆæœ¬çš„ä¸€è´¯åŸåˆ™ï¼š<strong>å‘åå…¼å®¹</strong>ï¼Œä¹Ÿå°±æ˜¯å³ä½¿ä½ ä½¿ç”¨Go 1.17ç‰ˆæœ¬ï¼Œä¹Ÿå¯ä»¥æˆåŠŸç¼–è¯‘ä½ åå¹´å‰å†™ä¸‹çš„Goä»£ç ã€‚</p><p>è¯»åˆ°è¿™é‡Œï¼Œä½ æ˜¯ä¸æ˜¯æœ‰ä¸€ç§è¦å°½å¿«åˆ‡æ¢åˆ°Go 1.17ç‰ˆæœ¬çš„å†²åŠ¨å‘¢ï¼èµ¶å¿«<a href=\"https://go.dev/dl\">å»Goå®˜ç½‘ä¸‹è½½Go 1.17çš„æœ€æ–°è¡¥ä¸ç‰ˆæœ¬</a>ï¼Œå¼€å¯ä½ çš„Go1.17ä½“éªŒä¹‹æ—…å§ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>åœ¨ä½ é˜…è¯»å®Œ<a href=\"https://go.dev/doc/go1.17\">Go 1.17çš„å‘å¸ƒè¯´æ˜æ–‡æ¡£</a>ä¹‹åï¼Œä½ ä¼šå‘ç°Go 1.17ç‰ˆæœ¬ä¸­çš„å˜åŒ–æœ‰å¾ˆå¤šï¼Œé™¤äº†ä¸Šé¢å‡ ä¸ªé‡è¦ç‰¹æ€§å˜åŒ–å¤–ï¼Œæœ€è®©ä½ å—ç›Šæˆ–å°è±¡æ·±åˆ»çš„å˜åŒ–æ˜¯å“ªä¸€ä¸ªå‘¢ï¼Ÿæ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«ã€‚</p><p>æ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™æ›´å¤šå¯¹Go 1.17ç‰ˆæœ¬æ„Ÿå…´è¶£çš„æœ‹å‹ã€‚æˆ‘æ˜¯Tony Baiï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ã€‚</p>","neighbors":{"left":{"article_title":"åŠ é¤ï½œæˆ‘â€œç§è—â€çš„é‚£äº›ä¼˜è´¨ä¸”æƒå¨çš„Goè¯­è¨€å­¦ä¹ èµ„æ–™","id":468213},"right":{"article_title":"åŠ é¤ï½œå¦‚ä½•æ‹‰å–ç§æœ‰çš„Go Moduleï¼Ÿ","id":481148}},"comments":[{"had_liked":false,"id":327050,"user_name":"æœ¨æœ¨","can_delete":false,"product_type":"c1","uid":2704565,"ip_address":"","ucode":"86820F26A27308","user_header":"https://static001.geekbang.org/account/avatar/00/29/44/b5/7eba5a0e.jpg","comment_is_top":false,"comment_ctime":1639885881,"is_pvip":false,"replies":[{"id":"119119","content":"é™¤äº†åŒ…åä¸importä¹‹å¤–ï¼Œæ˜¯å®Œæ•´æºç ã€‚go test -bench .å°±æ˜¯æ‰§è¡Œå½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰benchmark testçš„æ„æ€ã€‚","user_name":"ä½œè€…å›å¤","comment_id":327050,"uid":"1026224","ip_address":"","utype":1,"ctime":1640061618,"user_name_real":"ç¼–è¾‘"}],"discussion_count":2,"race_medal":0,"score":"10229820473","product_id":100093501,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæˆ‘ä¹Ÿæƒ³è·‘ä¸€ä¸‹æ‚¨çš„è¿™ä¸ªbenchmarkæµ‹è¯•ä»£ç ï¼Œè¯·é—®æ–‡ä¸­çš„ä»£ç æ˜¯å®Œæ•´ä»£ç ä¹ˆï¼Ÿä»¥åŠgo test -bench . ä¸­çš„â€œ-bench .â€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540470,"discussion_content":"é™¤äº†åŒ…åä¸importä¹‹å¤–ï¼Œæ˜¯å®Œæ•´æºç ã€‚go test -bench .å°±æ˜¯æ‰§è¡Œå½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰benchmark testçš„æ„æ€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640061618,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2704565,"avatar":"https://static001.geekbang.org/account/avatar/00/29/44/b5/7eba5a0e.jpg","nickname":"æœ¨æœ¨","note":"","ucode":"86820F26A27308","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540819,"discussion_content":"æ„Ÿè°¢è€å¸ˆå›å¤ã€‚æˆ‘æ˜¯winå¹³å°çš„ï¼Œå°å°æ€»ç»“ä¸€ä¸‹ã€‚ä¸ºäº†è¿è¡Œæµ‹è¯•éœ€è¦æœ‰ä¸‰ä¸ªå‰ç½®æ¡ä»¶ã€‚1 import bytesã€fmtã€stringã€testingå››ä¸ªåŒ…ï¼Œ 2 ç›®å½•ä¸‹è¿è¡Œgo mod init xxxx() + go mod tidy å£°æ˜module 3 æ–‡ä»¶åä¿å­˜ä¸ºxxxx_test.go ã€‚ç„¶åè¿è¡Œgo.exe test -bench ^. è¿™ä¸ªå‘½ä»¤ å°±å¯ä»¥å¾—åˆ°ç»“æœäº†ï¼","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1640176770,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":327070,"user_name":"lesserror","can_delete":false,"product_type":"c1","uid":1351076,"ip_address":"","ucode":"25A54D1165FCF6","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","comment_is_top":false,"comment_ctime":1639902045,"is_pvip":false,"replies":[{"id":"119126","content":"1. å¯ä»¥çš„ã€‚åº”è¯¥æ˜¯macä¸Šæœ€å¸¸ç”¨çš„å®‰è£…å’Œå‡çº§æ–¹å¼<br>2. å…³äºåŸºäºå¯„å­˜å™¨è°ƒç”¨çš„ABIæ–¹é¢çš„å†…å®¹å¾ˆå¤šï¼Œå¾ˆéš¾ç†è§£ï¼Œæœ‰å…´è¶£çš„è¯ï¼Œå»ºè®®æ‰¾ä¸€ç¯‡ä¸“é—¨çš„èµ„æ–™çœ‹çœ‹å§ã€‚<br>3. æœ‰ä¸€äº›goåŒ…ä¸ºäº†æå‡æ€§èƒ½ç­‰åŸå› ï¼Œé€šè¿‡hack go runtimeä½¿ç”¨ä¸€äº›unsafeçš„æ–¹æ³•æˆ–æ±‡ç¼–ä»£ç è¿›è¡Œä¸å®‰å…¨æ“ä½œï¼Œè¿™äº›æ“ä½œæ˜¯ä¸ABIçš„å®ç°ç›¸å…³çš„ï¼Œæ˜¯åŸºäºä¹‹å‰çš„åŸºäºæ ˆè°ƒç”¨çº¦å®šçš„ï¼Œgo1.17æ”¹ä¸ºåŸºäºå¯„å­˜å™¨è°ƒç”¨çš„çº¦å®šåï¼Œè¿™äº›æ“ä½œå°±ä¸å†é€‚ç”¨äº†ï¼Œå¾ˆå¯èƒ½ä¼šå‡ºé”™ã€‚<br><br>4. æ­£ç¡®<br><br>txtarå·¥å…·çš„ç¡®éœ€è¦å®‰è£…ï¼Œæ„Ÿè°¢æé†’ã€‚","user_name":"ä½œè€…å›å¤","comment_id":327070,"uid":"1026224","ip_address":"","utype":1,"ctime":1640067354,"user_name_real":"ä½œè€…"}],"discussion_count":2,"race_medal":0,"score":"5934869341","product_id":100093501,"comment_content":"çœ‹äº†å¤§ç™½è€å¸ˆçš„è¿™èŠ‚è¯¾åï¼Œé©¬ä¸Šå‡çº§åˆ°äº†1.17ç‰ˆæœ¬ã€‚<br><br>1. æˆ‘æ˜¯ç›´æ¥ä¸‹è½½macOSçš„pkgå®‰è£…åŒ…è¦†ç›–åŸæ¥å®‰è£…çš„ï¼Œä¹‹å‰çš„ç‰ˆæœ¬ä¹Ÿæ˜¯è¿™ä¹ˆå®‰è£…çš„ï¼Œè¯·é—®è€å¸ˆï¼Œè¿™ä¹ˆæ“ä½œåœ¨Macä¸Šé¢ï¼Œå±äºæ¯”è¾ƒé€šç”¨çš„å‡çº§æ–¹å¼å—ï¼Ÿ<br><br>2. å¦å¤–æ–‡ä¸­è¿™è¿™å¥è¯ï¼šâ€œå¹¶æŒ‡å®šä¸€äº›å¯„å­˜å™¨ä¸ºè°ƒç”¨ä¿å­˜å¯„å­˜å™¨ï¼Œå…è®¸å‡½æ•°åœ¨ä¸åŒçš„è°ƒç”¨ä¸­ä¿æŒçŠ¶æ€ã€‚â€ èƒ½å±•å¼€è¯´ä¸€ä¸‹ä¸ï¼Œæ²¡å¤ªæ˜ç™½è¿™å¥è¯ï¼Ÿ<br><br>2. â€œæˆ–è€…ä¾èµ–ä¸€äº›åƒæ¯”è¾ƒå‡½æ•°ä»£ç æŒ‡é’ˆçš„æœªå…¬å¼€çš„è¡Œä¸ºã€‚â€ èƒ½è¯¦ç»†è¯´ä¸€ä¸‹ä»€ä¹ˆæ˜¯æœªå…¬å¼€çš„è¡Œä¸ºå‘¢ï¼Ÿ<br><br>3. æˆ‘æ˜¯ç›´æ¥ä¿®æ”¹go.modä¸­çš„go ç‰ˆæœ¬ä¸ºï¼šgo 1.15ï¼Œç„¶åæ‰§è¡Œæœ¬è¯¾ç¨‹ä¹‹å‰è®²çš„åœ¨æœ¬åœ°å®‰è£…å¤šä¸ªgoç‰ˆæœ¬çš„go 1.15.13 ç‰ˆæœ¬çš„æµ‹è¯•å‘½ä»¤ï¼š go1.15.13 test -bench .  å‘ç°æ¯”1.17ç‰ˆæœ¬è€—æ—¶å¢åŠ å¾ˆå¤šã€‚  è¯·é—®è€å¸ˆï¼Œæˆ‘çš„è¿™ä¸ªæµ‹è¯•æ–¹å¼æ˜¯æ­£ç¡®çš„ä¹ˆï¼Ÿ<br><br>ps: go module çš„å˜æ›´é‚£é‡Œï¼Œéœ€è¦å…ˆ æ‰§è¡Œgo install golang.org&#47;x&#47;exp&#47;cmd&#47;txtar@latest  å®‰è£…txtarå·¥å…·ã€‚<br>","like_count":2,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540484,"discussion_content":"1. å¯ä»¥çš„ã€‚åº”è¯¥æ˜¯macä¸Šæœ€å¸¸ç”¨çš„å®‰è£…å’Œå‡çº§æ–¹å¼\n2. å…³äºåŸºäºå¯„å­˜å™¨è°ƒç”¨çš„ABIæ–¹é¢çš„å†…å®¹å¾ˆå¤šï¼Œå¾ˆéš¾ç†è§£ï¼Œæœ‰å…´è¶£çš„è¯ï¼Œå»ºè®®æ‰¾ä¸€ç¯‡ä¸“é—¨çš„èµ„æ–™çœ‹çœ‹å§ã€‚\n3. æœ‰ä¸€äº›goåŒ…ä¸ºäº†æå‡æ€§èƒ½ç­‰åŸå› ï¼Œé€šè¿‡hack go runtimeä½¿ç”¨ä¸€äº›unsafeçš„æ–¹æ³•æˆ–æ±‡ç¼–ä»£ç è¿›è¡Œä¸å®‰å…¨æ“ä½œï¼Œè¿™äº›æ“ä½œæ˜¯ä¸ABIçš„å®ç°ç›¸å…³çš„ï¼Œæ˜¯åŸºäºä¹‹å‰çš„åŸºäºæ ˆè°ƒç”¨çº¦å®šçš„ï¼Œgo1.17æ”¹ä¸ºåŸºäºå¯„å­˜å™¨è°ƒç”¨çš„çº¦å®šåï¼Œè¿™äº›æ“ä½œå°±ä¸å†é€‚ç”¨äº†ï¼Œå¾ˆå¯èƒ½ä¼šå‡ºé”™ã€‚\n\n4. æ­£ç¡®\n\ntxtarå·¥å…·çš„ç¡®éœ€è¦å®‰è£…ï¼Œæ„Ÿè°¢æé†’ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1640067355,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1351076,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","nickname":"lesserror","note":"","ucode":"25A54D1165FCF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":540485,"discussion_content":"è°¢è°¢è€å¸ˆå›å¤ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640067414,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":540484,"ip_address":""},"score":540485,"extra":""}]}]},{"had_liked":false,"id":326973,"user_name":"Darren","can_delete":false,"product_type":"c1","uid":1254968,"ip_address":"","ucode":"CCD2B2C492BE9A","user_header":"https://static001.geekbang.org/account/avatar/00/13/26/38/ef063dc2.jpg","comment_is_top":false,"comment_ctime":1639808060,"is_pvip":true,"replies":[{"id":"119098","content":"å¯¹javaäº†è§£ä¸å¤šï¼Œä¸åŒjvmå¯èƒ½æƒ…å†µä¸ä¸€ï¼Œæœ‰çš„åŸºäºå¯„å­˜å™¨ï¼Œæœ‰çš„åŸºäºå †æ ˆã€‚","user_name":"ä½œè€…å›å¤","comment_id":326973,"uid":"1026224","ip_address":"","utype":1,"ctime":1640056749,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"5934775356","product_id":100093501,"comment_content":"è€å¸ˆï¼Œjavaæ˜¯åŸºäºå †æ ˆçš„è¿˜æ˜¯åŸºäºå¯„å­˜å™¨çš„ï¼Ÿæˆ‘çš„ç†è§£å¥½åƒæ˜¯åŸºäºå †æ ˆçš„ğŸ˜‚ï¼Œä½†ä¸çŸ¥é“æ˜¯å¦æ­£ç¡®","like_count":2,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540428,"discussion_content":"å¯¹javaäº†è§£ä¸å¤šï¼Œä¸åŒjvmå¯èƒ½æƒ…å†µä¸ä¸€ï¼Œæœ‰çš„åŸºäºå¯„å­˜å™¨ï¼Œæœ‰çš„åŸºäºå †æ ˆã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640056749,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326845,"user_name":"è¨€å·±","can_delete":false,"product_type":"c1","uid":1751496,"ip_address":"","ucode":"FDD2A90EFA3B5A","user_header":"https://static001.geekbang.org/account/avatar/00/1a/b9/c8/4c0cc367.jpg","comment_is_top":false,"comment_ctime":1639719839,"is_pvip":false,"replies":[{"id":"118796","content":"æ˜¯çš„ï¼Œä¸åŒæ‹¼æ¥æ–¹å¼æ€§èƒ½å·®è·è¾ƒå¤§ã€‚","user_name":"ä½œè€…å›å¤","comment_id":326845,"uid":"1026224","ip_address":"","utype":1,"ctime":1639803809,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"5934687135","product_id":100093501,"comment_content":"æ€§èƒ½æµ‹è¯•ç¤ºä¾‹ä»£ç ï¼Œgolang çš„å­—ç¬¦ä¸²æ‹¼æ¥åŸæ¥æœ‰è¿™ä¹ˆå¤šæ–¹å¼ã€‚","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539669,"discussion_content":"æ˜¯çš„ï¼Œä¸åŒæ‹¼æ¥æ–¹å¼æ€§èƒ½å·®è·è¾ƒå¤§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639803809,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326805,"user_name":"åœ¨ä¸‹å®é¾™ã€","can_delete":false,"product_type":"c1","uid":1618030,"ip_address":"","ucode":"0735B64EB61CAC","user_header":"https://static001.geekbang.org/account/avatar/00/18/b0/6e/921cb700.jpg","comment_is_top":false,"comment_ctime":1639706521,"is_pvip":false,"replies":[{"id":"119117","content":"å› ä¸ºä½ çš„go.modä¸­goçš„versionä¸ºgo 1.16ã€‚go 1.17è€ƒè™‘åˆ°å…¼å®¹æ€§ï¼Œç»™ä½ å‡ ä¸ªæç¤ºã€‚æŒ‰æç¤ºæ‰§è¡Œå°±å¥½ã€‚","user_name":"ä½œè€…å›å¤","comment_id":326805,"uid":"1026224","ip_address":"","utype":1,"ctime":1640061382,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"5934673817","product_id":100093501,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæˆ‘æœ€è¿‘ä½¿ç”¨go mod tidy å‘ç°å¹¶ä¸èƒ½å¾ˆå¥½çš„ç”Ÿæ•ˆï¼Œä½¿ç”¨ä¹‹å go modæ–‡ä»¶å¹¶æ²¡æœ‰å¢åŠ å‡ºè‡ªå·±æƒ³è¦çš„åŒ…ä¿¡æ¯ï¼Œç»™æˆ‘çš„æç¤ºæ˜¯è¿™ä¸ªï¼Œæˆ‘å°è¯•å»ç†è§£å¹¶æ²¡æœ‰æ‰¾åˆ°ç­”æ¡ˆ- =ï¼Œæˆ‘çš„goç‰ˆæœ¬æ˜¯1.17<br>To upgrade to the versions selected by go 1.16:<br>        go mod tidy -go=1.16 &amp;&amp; go mod tidy -go=1.17<br>If reproducibility with go 1.16 is not needed:<br>        go mod tidy -compat=1.17","like_count":2,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540468,"discussion_content":"å› ä¸ºä½ çš„go.modä¸­goçš„versionä¸ºgo 1.16ã€‚go 1.17è€ƒè™‘åˆ°å…¼å®¹æ€§ï¼Œç»™ä½ å‡ ä¸ªæç¤ºã€‚æŒ‰æç¤ºæ‰§è¡Œå°±å¥½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640061383,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":327297,"user_name":"å¤§å°¾å·´è€çŒ«","can_delete":false,"product_type":"c1","uid":1260089,"ip_address":"","ucode":"246AB375244773","user_header":"https://static001.geekbang.org/account/avatar/00/13/3a/39/72d81605.jpg","comment_is_top":false,"comment_ctime":1640052579,"is_pvip":true,"replies":[{"id":"119094","content":"æœ‰ä¸€ç¯‡è§„åˆ’å¥½çš„åŠ é¤æ˜¯è®²è§£è¿™æ–¹é¢çš„å†…å®¹çš„ï¼Œæ•¬è¯·æœŸå¾…:)","user_name":"ä½œè€…å›å¤","comment_id":327297,"uid":"1026224","ip_address":"","utype":1,"ctime":1640055649,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1640052579","product_id":100093501,"comment_content":"åç»­æ˜¯å¦ä¼šè®²è§£å¦‚ä½•æ­å»ºä¸€å¥—ç§æœ‰çš„å¼€å‘ç¯å¢ƒï¼Ÿä¼ä¸šçº§åº”ç”¨å¼€å‘ï¼Œé€šå¸¸æœ‰ä¸€äº›å®‰å…¨åˆè§„ç›¸å…³çš„è¦æ±‚ï¼Œä½¿ç”¨go modï¼Œä¸å¤ªå¯èƒ½ç›´æ¥ä»githubæˆ–è€…giteeä¸Šå¼•ç”¨ï¼Œç§æœ‰ä»£ç åº“é€šå¸¸ä¹Ÿæ˜¯éœ€è¦èº«ä»½éªŒè¯çš„ï¼Œè¿™ç§æƒ…å†µä¸‹å¦‚ä½•ä½¿ç”¨go getï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540421,"discussion_content":"æœ‰ä¸€ç¯‡è§„åˆ’å¥½çš„åŠ é¤æ˜¯è®²è§£è¿™æ–¹é¢çš„å†…å®¹çš„ï¼Œæ•¬è¯·æœŸå¾…:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640055649,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":327068,"user_name":"é™ˆä¸œ","can_delete":false,"product_type":"c1","uid":2213995,"ip_address":"","ucode":"FCDE6D237CC621","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Ge7uhlEVxicQT73YuomDPrVKI8UmhqxKWrhtO5GMNlFjrHWfd3HAjgaSribR4Pzorw8yalYGYqJI4VPvUyPzicSKg/132","comment_is_top":false,"comment_ctime":1639901019,"is_pvip":true,"replies":[{"id":"119057","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":327068,"uid":"1026224","ip_address":"","utype":1,"ctime":1640037245,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":1,"score":"1639901019","product_id":100093501,"comment_content":"ä¸æ—¶ä¿±è¿›çš„ä¸€ä¸ªè¯­è¨€ã€‚","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540343,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640037245,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":327061,"user_name":"æ— åæ— å§“","can_delete":false,"product_type":"c1","uid":2621412,"ip_address":"","ucode":"487BD5AA2CD305","user_header":"https://static001.geekbang.org/account/avatar/00/27/ff/e4/927547a9.jpg","comment_is_top":false,"comment_ctime":1639895599,"is_pvip":true,"replies":[{"id":"119056","content":"go 1.18beta1å·²ç»å‘å¸ƒï¼Œå¦‚æœæ„Ÿå…´è¶£ï¼Œå¯ä»¥å»ä¸‹è½½ä½“éªŒä¸€ä¸‹ã€‚https:&#47;&#47;go.dev&#47;dl","user_name":"ä½œè€…å›å¤","comment_id":327061,"uid":"1026224","ip_address":"","utype":1,"ctime":1640037238,"user_name_real":"ç¼–è¾‘"}],"discussion_count":2,"race_medal":0,"score":"1639895599","product_id":100093501,"comment_content":"go 1.18ç‰ˆæœ¬çš„æ³›å‹è¿˜æ˜¯æ¯”è¾ƒè®©äººæœŸå¾…çš„","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540342,"discussion_content":"go 1.18beta1å·²ç»å‘å¸ƒï¼Œå¦‚æœæ„Ÿå…´è¶£ï¼Œå¯ä»¥å»ä¸‹è½½ä½“éªŒä¸€ä¸‹ã€‚https://go.dev/dl","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640037238,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1603004,"avatar":"https://static001.geekbang.org/account/avatar/00/18/75/bc/e24e181e.jpg","nickname":"Calvin","note":"","ucode":"0EEF5B207623B5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540262,"discussion_content":"è¿˜æœ‰å·¥ä½œåŒºæ¨¡å¼ï¼Œä»¥åå°±å¯ä»¥å¤š Module å¼€å‘äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640002396,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326961,"user_name":"ç½—æ°","can_delete":false,"product_type":"c1","uid":1320487,"ip_address":"","ucode":"96BAFAA147341F","user_header":"https://static001.geekbang.org/account/avatar/00/14/26/27/eba94899.jpg","comment_is_top":false,"comment_ctime":1639797586,"is_pvip":false,"discussion_count":0,"race_medal":2,"score":"1639797586","product_id":100093501,"comment_content":"ä¿®å‰ªçš„ go mod ä¾èµ–ç»ˆäºç¬¦åˆæˆ‘çš„ç›´è§‰äº†ï¼Œåˆšå¼€å§‹ä½¿ç”¨ go mod çš„æ—¶å€™ï¼Œè¿™ç§ç®€æ¥ä¾èµ–çœŸçš„è®©æˆ‘å¾ˆä¸ç†è§£ï¼Œç°åœ¨ç»ˆäºè¢«ä¿®å¤äº†ã€‚","like_count":1},{"had_liked":false,"id":326933,"user_name":"é™ˆä¸œ","can_delete":false,"product_type":"c1","uid":2213995,"ip_address":"","ucode":"FCDE6D237CC621","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Ge7uhlEVxicQT73YuomDPrVKI8UmhqxKWrhtO5GMNlFjrHWfd3HAjgaSribR4Pzorw8yalYGYqJI4VPvUyPzicSKg/132","comment_is_top":false,"comment_ctime":1639762975,"is_pvip":true,"replies":[{"id":"119097","content":"ç”¨çš„go 1.17ä¹ˆï¼Ÿä¸ºå•¥è¦æ‰§è¡Œgo get -u -v github.com&#47;karalabe&#47;xgo ï¼Ÿè¿™æ˜¯ä»€ä¹ˆåŒ…ï¼Ÿè°ä¾èµ–çš„ï¼Ÿ","user_name":"ä½œè€…å›å¤","comment_id":326933,"uid":"1026224","ip_address":"","utype":1,"ctime":1640056659,"user_name_real":"ç¼–è¾‘"}],"discussion_count":2,"race_medal":1,"score":"1639762975","product_id":100093501,"comment_content":"æŒ‰ç¬¬7è®²çš„ç¬¬ä¸€æ®µä»£ç ï¼Œèƒ½go runä»£ç ï¼Œä½†æ˜¯logrus.Println ä¸€ç›´æ˜¾ç¤ºçº¢è‰²æŠ¥é”™ï¼Œå°è¯•å¾ˆå¤šåŠæ³•ï¼Œè§£å†³<br>goæ„å»ºçº¦æŸé—®é¢˜ï¼ŒBuild constraints exclude all Go files in cï¼šsrcä¸‹ä»£ç ç›®å½•æ–‡ä»¶å¤¹ï¼Ÿ<br>å°è¯•ä»¥ä¸‹åŠæ³•è§£å†³ä¸äº†<br>1ã€searcheverything æœç´¢ååˆ é™¤æ‰€æœ‰åŒ…,<br>$GOPATHç›®å½•ä¸‹ï¼ŒæŠŠå¯¹åº”çš„åŒ…åˆ é™¤ï¼Œé‡æ–°go get,è¿˜æ˜¯ä¸è¡Œ.<br>2ã€go get -u -v github.com&#47;karalabe&#47;xgo<br>3ã€Right click -&gt; Mark folder as not excluded.<br>4ã€å¼•ç”¨åŒ…æŠ¥é”™ï¼Œé‡å¯ç”µè„‘ï¼ŒæŸ¥çœ‹goproxyé…ç½®ï¼Œè¿˜ä¸è¡Œé‡è£…golandï¼Œè¿˜æ˜¯IDEï¼Œå¼•ç”¨çš„github.com&#47;sirupsen&#47;logrusçº¢è‰²ä¸‹ç”»æ³¢æµªçº¿ï¼Œå’Œlogrus.Printlnçº¢è‰²æŠ¥é”™<br>æ€ä¹ˆè§£å†³ï¼Œå¯»æ±‚è€å¸ˆå¸®åŠ©ï¼Œè°¢è°¢ã€‚","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540427,"discussion_content":"ç”¨çš„go 1.17ä¹ˆï¼Ÿä¸ºå•¥è¦æ‰§è¡Œgo get -u -v github.com/karalabe/xgo ï¼Ÿè¿™æ˜¯ä»€ä¹ˆåŒ…ï¼Ÿè°ä¾èµ–çš„ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640056659,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2213995,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Ge7uhlEVxicQT73YuomDPrVKI8UmhqxKWrhtO5GMNlFjrHWfd3HAjgaSribR4Pzorw8yalYGYqJI4VPvUyPzicSKg/132","nickname":"é™ˆä¸œ","note":"","ucode":"FCDE6D237CC621","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540799,"discussion_content":"æ˜¯go version go1.17.2 windows/amd64ï¼Œæ˜¯æ‰§è¡Œgo get -u -v  github.com/sirupsen/logrusã€‚æ˜¯å› ä¸ºhooks/syslog/syslog.go è¿™ä¸ªæ–‡ä»¶ä¸èƒ½åœ¨windowsä¸Šç¼–è¯‘ã€‚éœ€è¦è®¾ç½®GOOS=linuxï¼Œè®¾ç½®linuxä¹‹åå¯ä»¥æ­£å¸¸runï¼Œä½†æ˜¯logrus.Println(uuid.NewString())ä¸­çš„Printlnå’ŒNewSrtingä¸€ç›´çº¢è‰²æŠ¥é”™ï¼Ÿ\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640172519,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326925,"user_name":"åŠŸå¤«ç†ŠçŒ«","can_delete":false,"product_type":"c1","uid":2732243,"ip_address":"","ucode":"D124F4FA4E816F","user_header":"https://static001.geekbang.org/account/avatar/00/29/b0/d3/200e82ff.jpg","comment_is_top":false,"comment_ctime":1639754510,"is_pvip":true,"replies":[{"id":"119055","content":"go 1.18ç‰ˆæœ¬ä¹‹å‰ç”¨replaceä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå°±æ˜¯æ‰‹å·¥æ“ä½œgo.modæ¯”è¾ƒå¤šã€‚go 1.18åç”¨go.workæœºåˆ¶å°±æ–¹ä¾¿äº†ã€‚","user_name":"ä½œè€…å›å¤","comment_id":326925,"uid":"1026224","ip_address":"","utype":1,"ctime":1640037073,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1639754510","product_id":100093501,"comment_content":"æˆ‘å·²ç»è¢«go modçš„æœ¬åœ°åŒ…çš„å¼•å…¥æ–¹å¼éš¾å—æ­»äº†ï¼Œä¸ºäº†èƒ½å¼•å…¥æœ¬åœ°åŒ…ï¼Œæˆ‘ä¸å¾—ä¸æŠŠæˆ‘çš„ä»£ç æå‰ä¸Šä¼ åˆ°ç äº‘ã€‚","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540341,"discussion_content":"go 1.18ç‰ˆæœ¬ä¹‹å‰ç”¨replaceä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå°±æ˜¯æ‰‹å·¥æ“ä½œgo.modæ¯”è¾ƒå¤šã€‚go 1.18åç”¨go.workæœºåˆ¶å°±æ–¹ä¾¿äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640037073,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326781,"user_name":"Calvin","can_delete":false,"product_type":"c1","uid":1603004,"ip_address":"","ucode":"0EEF5B207623B5","user_header":"https://static001.geekbang.org/account/avatar/00/18/75/bc/e24e181e.jpg","comment_is_top":false,"comment_ctime":1639677790,"is_pvip":false,"replies":[{"id":"119116","content":"æˆ‘å…ˆè®°å½•ä¸‹æ¥ï¼Œæ˜¯å¦æœ‰ï¼Œç°åœ¨è¿˜ä¸èƒ½ç¡®å®š:)ã€‚","user_name":"ä½œè€…å›å¤","comment_id":326781,"uid":"1026224","ip_address":"","utype":1,"ctime":1640061291,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1639677790","product_id":100093501,"comment_content":"è€å¸ˆåé¢å¯ä»¥åŠ é¤è¯´ä¸‹ go 1.18 çš„æ–°â€œå·¥ä½œåŒºæ¨¡å¼â€ç‰¹æ€§å—ï¼Ÿæ„Ÿè§‰å’Œæ³›å‹ä¸€æ ·ï¼Œå®ƒä¹Ÿä¼šæ˜¯ä¸€ä¸ªé‡è¦çš„æ–°ç‰¹æ€§ã€‚","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540467,"discussion_content":"æˆ‘å…ˆè®°å½•ä¸‹æ¥ï¼Œæ˜¯å¦æœ‰ï¼Œç°åœ¨è¿˜ä¸èƒ½ç¡®å®š:)ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640061291,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}