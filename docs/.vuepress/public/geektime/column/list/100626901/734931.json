{"id":734931,"title":"23ï½œRustä¸å¤§æ¨¡å‹ï¼šç”¨ Candle åšä¸€ä¸ªèŠå¤©æœºå™¨äºº","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯Mikeã€‚ä»Šå¤©æˆ‘ä»¬æ¥èŠä¸€èŠå¦‚ä½•ç”¨Ruståšä¸€ä¸ªåŸºäºå¤§è¯­è¨€æ¨¡å‹çš„èŠå¤©æœºå™¨äººã€‚</p><p>å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æ˜¯2023å¹´æœ€ç«çš„é¢†åŸŸï¼Œæ²¡æœ‰ä¹‹ä¸€ã€‚è¿™æ³¢çƒ­æ½®æ˜¯ç”±OpenAIçš„ChatGPTåœ¨ä»Šå¹´ä¸ŠåŠå¹´å‘å¸ƒåå¼•èµ·çš„ï¼Œä¹‹åå…¨ä¸–ç•Œçš„ç ”ç©¶æœºæ„å’Œç§‘æŠ€å…¬å¸éƒ½å·å…¥äº†å¤§æ¨¡å‹çš„ç«äº‰ä¸­ã€‚ç›®å‰ä¸šç•Œåº”ç”¨å¤§æ¨¡å‹è®­ç»ƒåŠæ¨ç†çš„ä¸»è¦è¯­è¨€æ˜¯Pythonå’ŒC/C++ã€‚Pythonä¸€èˆ¬ç”¨æ¥å®ç°ä¸Šå±‚æ¡†æ¶ï¼Œè€ŒC/C++ä¸€èˆ¬èµ·åº•å±‚é«˜æ€§èƒ½æ‰§è¡Œçš„ä½œç”¨ï¼Œæ¯”å¦‚è‘—åçš„æ¡†æ¶ PyTorchï¼Œå®ƒçš„ä¸Šå±‚ä¸šåŠ¡å±‚é¢æ˜¯ç”¨Pythonå†™çš„ï¼Œä¸‹å±‚æ‰§è¡Œå±‚é¢ç”±Cæ‰§è¡Œï¼Œå› ä¸ºGPUåŠ é€Ÿçš„éƒ¨åˆ†åªèƒ½ç”±C/C++æ¥è°ƒç”¨ã€‚</p><p>çœ‹èµ·æ¥å¤§è¯­è¨€æ¨¡å‹å¥½åƒå’ŒRustæ²¡ä»€ä¹ˆå…³ç³»ï¼Œå¿…é¡»æ‰¿è®¤ï¼Œç”±äºå†å²ç§¯ç´¯çš„åŸå› ï¼Œåœ¨AIè¿™ä¸€å—å„¿Rustçš„å½±å“åŠ›è¿˜éå¸¸å°ã€‚ä½†ä»å¦ä¸€æ–¹é¢æ¥è®²å‘¢ï¼ŒRustæ˜¯ç›®å‰ä¸šç•Œé™¤Pythonã€C++ å¤–ï¼Œå”¯ä¸€æœ‰æ½œåŠ›åœ¨æœªæ¥20å¹´çš„AI å‘å±•ä¸­å‘æŒ¥é‡è¦ä½œç”¨çš„è¯­è¨€äº†ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ</p><p>é¦–å…ˆRustçš„æ€§èƒ½ä¸C/C++ä¸€è‡´ï¼Œå¹¶ä¸”åœ¨è°ƒç”¨GPUèƒ½åŠ›æ–¹é¢ä¹ŸåŒæ ·æ–¹ä¾¿ï¼›å…¶æ¬¡ï¼ŒRustå¼ºå¤§çš„è¡¨è¾¾èƒ½åŠ›ï¼Œä¸è¾“äºPythonï¼Œè¿™è®©äººä»¬ä½¿ç”¨Ruståšä¸šåŠ¡å¹¶ä¸éš¾ï¼›ç„¶åï¼ŒRustçš„cargoç¼–è¯‘æˆå•æ–‡ä»¶çš„èƒ½åŠ›ï¼Œä»¥åŠå¯¹WebAssemblyå®Œå–„çš„æ”¯æŒï¼Œéƒ¨ç½²åº”ç”¨çš„æ—¶å€™éå¸¸æ–¹ä¾¿ï¼Œè¿™æ¯”Py + C/C++ç»„åˆéœ€è¦å®‰è£…çš„ä¸€å †ä¾èµ–å’Œæ•°Gçš„åº“æ–¹ä¾¿å¤ªå¤šã€‚</p><!-- [[[read_end]]] --><p>ç›®å‰Rustç”Ÿæ€ä¸­å…¶å®å·²ç»æœ‰å¾ˆå¤šAIç›¸å…³çš„åŸºç¡€è®¾æ–½äº†ï¼Œä½ å¯ä»¥ä»æˆ‘ç»™å‡ºçš„<a href=\"https://www.arewelearningyet.com/\">é“¾æ¥</a>é‡Œæ‰¾åˆ°ã€‚</p><p>ä¸–ç•Œä¸Šæœ€å¤§çš„æœºå™¨å­¦ä¹ æ¨¡å‹ä»“åº“å¹³å° HuggingFaceï¼ˆæœºå™¨å­¦ä¹ é¢†åŸŸçš„Githubï¼‰ æ¨å‡ºäº† Rust æœºå™¨å­¦ä¹ æ¡†æ¶ <a href=\"https://github.com/huggingface/candle\">Candle</a>ã€‚åœ¨è¿™ä¸ªå®˜æ–¹ä»£ç ä»“åº“ä¸Šï¼ŒHuggingFaceä¸Šè§£é‡Šäº†ä¸ºä»€ä¹ˆè¦åšä¸€ä¸ªRustçš„æœºå™¨å­¦ä¹ æ¡†æ¶ã€‚</p><ol>\n<li>Candleä¸Šäº‘ç«¯çš„ Serverless æ¨ç†å¯è¡Œã€‚PyTorché‚£ä¸€å¥—ä½“ç§¯å¤ªå¤§ï¼Œå®‰è£…å®Œå¾—å‡ ä¸ªGï¼Œè€ŒCandleç¼–è¯‘åçš„å¯æ‰§è¡Œæ–‡ä»¶æ‰åå‡ Måˆ°å‡ åMã€‚</li>\n<li>Candleå¯ä»¥è®©ä½ é¿å…Pythonçš„ <a href=\"https://www.backblaze.com/blog/the-python-gil-past-present-and-future/\">GIL</a>ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</li>\n<li>HuggingFaceå·²ç»ç”¨Rustå†™äº†ä¸å°‘åŸºç¡€å·¥å…·äº†ï¼Œæ¯”å¦‚ <a href=\"https://github.com/huggingface/safetensors\">safetensors</a> å’Œ <a href=\"https://github.com/huggingface/tokenizers\">tokenizers</a>ã€‚</li>\n</ol><p>Elon Muskçš„ <a href=\"https://x.ai/\">x.ai</a> å‘å¸ƒåï¼Œé¡µé¢ä¸Šä¹Ÿæœ‰ä¸€æ®µå¯¹Rustçš„æº¢ç¾ä¹‹è¯ï¼šRustè¢«è¯æ˜æ˜¯ä¸€ä¸ªç†æƒ³çš„é€‰æ‹©ï¼Œç”¨äºæ„å»ºå¯æ‰©å±•çš„ã€å¯é çš„ã€å¯ç»´æŠ¤æ€§çš„åŸºç¡€è®¾æ–½ã€‚å®ƒæä¾›äº†é«˜æ€§èƒ½ã€ä¸°å¯Œçš„ç”Ÿæ€ç³»ç»Ÿï¼Œå®ƒèƒ½é˜»æ­¢å¤§éƒ¨åˆ†é”™è¯¯ï¼Œè¿™äº›é”™è¯¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ç»å¸¸ä¼šç¢°åˆ°ã€‚ç”±äºæˆ‘ä»¬çš„å›¢é˜Ÿè§„æ¨¡å¾ˆå°ï¼ŒåŸºç¡€è®¾æ–½çš„å¯é æ€§å°±æ˜¾å¾—è‡³å…³é‡è¦ï¼Œå¦åˆ™ç»´æŠ¤å·¥ä½œä¼šæµªè´¹å¤§é‡åˆ›æ–°çš„æ—¶é—´ã€‚Rustç»™æˆ‘ä»¬æä¾›äº†ä¿¡å¿ƒï¼Œä»»ä½•çš„ä»£ç ä¿®æ”¹æˆ–é‡æ„éƒ½å¯ä»¥äº§å‡ºå¯å·¥ä½œçš„ç¨‹åºï¼Œå¹¶ä¸”åœ¨æœ€å°ç›‘ç®¡ä¸‹å¯ä»¥æŒç»­è¿è¡Œå¥½å‡ ä¸ªæœˆï¼ˆè€Œä¸ä¼šå‡ºé—®é¢˜ï¼‰ã€‚</p><p>Muskç”šè‡³è¯´Rustè¯­è¨€æ˜¯æœªæ¥<a href=\"https://zhuanlan.zhihu.com/p/648565007\">æ„å»º AGI</a> çš„è¯­è¨€ã€‚</p><p>åœ¨ä½¿ç”¨Rustå°è¯•åšèŠå¤©æœºå™¨äººä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ç›¸å…³çš„èƒŒæ™¯çŸ¥è¯†ã€‚</p><h2>å¤§è¯­è¨€æ¨¡å‹èƒŒæ™¯çŸ¥è¯†</h2><p>è¿™èŠ‚è¯¾æˆ‘ä»¬è¿˜æ˜¯ä¸»è¦è®²RuståŠRustçš„åº”ç”¨ï¼Œæ‰€ä»¥ç›¸å…³çš„èƒŒæ™¯çŸ¥è¯†æˆ‘ä»¬å°±ç®€å•æ¦‚æ‹¬ä¸€ä¸‹ã€‚</p><p>æœºå™¨å­¦ä¹ ï¼ˆMachine Learningï¼ŒMLï¼‰æ³›æŒ‡ç”¨è®¡ç®—æœºå¯¹æ•°æ®é›†æŒ‰ç…§ä¸€å®šçš„ç®—æ³•è¿›è¡Œæ•°æ®å¤„ç†ã€åˆ†æã€èšç±»ã€å›å½’ç­‰ã€‚åœ¨æ‰§è¡Œå‰ï¼Œäººå¾€å¾€ä¸çŸ¥é“ç»“æœæ˜¯ä»€ä¹ˆï¼Œæ‰€ä»¥å«æœºå™¨å­¦ä¹ ã€‚æœºå™¨å­¦ä¹ å¯ä»¥ç”¨äºè‡ªåŠ¨æå–ä¿¡æ¯ï¼Œè‡ªåŠ¨æˆ–è¾…åŠ©äººç±»åšå†³ç­–ã€‚</p><p>è€Œç¥ç»ç½‘ç»œï¼ˆNeural Networkï¼‰æ˜¯æœºå™¨å­¦ä¹ çš„ä¸€ç±»ç®—æ³•ï¼Œå®ƒæ˜¯æ¨¡æ‹Ÿäººçš„å¤§è„‘ç¥ç»å…ƒå’Œè¿æ¥çš„ä¸€ç§ç®—æ³•ã€‚ç›®å‰æ•´ä¸ªä¸šç•ŒæŠ•å…¥èµ„æºæœ€å¤šçš„å°±æ˜¯åœ¨è¿™ç±»ç®—æ³•ä¸Šé¢ï¼Œåœ¨è¿™ä¸ªç±»åˆ«ä¸­çš„åˆ›æ–°ä¹Ÿæ˜¯æœ€å¤šçš„ï¼Œæœ‰ç§è§‚ç‚¹è®¤ä¸ºç¥ç»ç½‘ç»œç®—æ³•æ˜¯é€šå‘çœŸæ­£çš„AIæœ€å¯èƒ½æ­£ç¡®çš„è·¯å¾„ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/6b/91/6bc0b61202yy14dfb11a834d0a649b91.png?wh=1525x811\" alt=\"å›¾ç‰‡\" title=\"å›¾ç‰‡æ¥æºï¼šhttps://victorzhou.com/media/nn-series/network.svg\n\"></p><p>è€Œæ·±åº¦å­¦ä¹ ï¼ˆDeep Learningï¼‰ï¼Œå…¶å®å°±æ˜¯å±‚æ¬¡å¾ˆå¤šå¾ˆæ·±çš„ç¥ç»ç½‘ç»œã€‚ä½ å¯ä»¥æƒ³è±¡ï¼Œå±‚æ¬¡è¶Šæ·±ï¼ŒèŠ‚ç‚¹æ•°ï¼ˆå›¾é‡Œé‚£äº›åœˆï¼‰è¶Šå¤šï¼Œå°±è¶Šèƒ½æ¨¡æ‹Ÿå¤§è„‘ã€‚ä½†æ˜¯æ·±åº¦å­¦ä¹ å¸¦æ¥çš„é—®é¢˜å°±æ˜¯ï¼Œå±‚æ¬¡è¶Šæ·±ï¼ŒèŠ‚ç‚¹æ•°è¶Šå¤šï¼Œåˆ™é‚£äº›çº¿ï¼ˆå°±æ˜¯æƒé‡å€¼ï¼‰å°±ä¼šè¶Šå¤šï¼Œå‘ˆæŒ‡æ•°çº§å¢é•¿ï¼Œé‚£ä¹ˆè®¡ç®—é‡å°±ä¼šè¶Šæ¥è¶Šå¤§ã€‚å…¶å®ä¹‹å‰åå‡ ã€äºŒåå¹´AIè¿›å±•ä¸å¤§ï¼Œä¸»è¦å°±æ˜¯å› ä¸ºè¿™ä¸ªè®¡ç®—èƒ½åŠ›é™åˆ¶äº†ã€‚</p><p>é€šè¿‡æ— æ•°äººçš„æ¢ç´¢ï¼Œæˆ‘ä»¬å‘ç°å¯ä»¥æŠŠæ·±åº¦å­¦ä¹ çš„è®¡ç®—å¹¶è¡ŒåŒ–ï¼Œä¼˜åŒ–äº†å¾ˆå¤šå·¥ç¨‹ä¸Šçš„ç®—æ³•ã€‚è¿™æ ·å°±èƒ½å¤Ÿåœ¨å¤§å®¶ç†Ÿæ‚‰çš„ä¸»è¦ç”¨æ¥ç©æ¸¸æˆçš„GPUæ˜¾å¡ä¸Šè¿è¡Œï¼Œå¤§å¤§æé«˜äº†è®¡ç®—é€Ÿåº¦ã€‚è¿™ä¸ªè§†è§’ï¼ŒäºŒåå¤šå¹´å‰Nvidiaçš„è€é»„å°±çœ‹æ˜ç™½äº†ï¼Œæ—©æ—©åœ°æä¾›å¥½äº†åŸºç¡€è®¾æ–½ï¼ŒCUDAã€CUDNNç­‰ã€‚æ‰€ä»¥ç°åœ¨ä½ å°±çœ‹åˆ°äº†ï¼Œä¸€å¡éš¾æ±‚ï¼Œå·²ç»ä¸¥é‡å½±å“åˆ°äº†æ¸¸æˆç©å®¶çš„ç”Ÿå­˜ã€‚</p><h3>ChatGPTä¸LLaMA</h3><p>é‚£ä¹ˆChatGPTæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè‹±æ–‡æ˜¯Chat Generative Pre-trained Transformerï¼Œæ˜¯OpenAIæä¾›çš„åœ¨çº¿AIå¯¹è¯æœåŠ¡ï¼Œå…·æœ‰ä»¤äººæƒŠå¹çš„ç†è§£èƒ½åŠ›å’Œå›ç­”èƒ½åŠ›ã€‚ä½ å¯ä»¥æŠŠChatGPTç†è§£æˆä¸€ä¸ªä¸ºå¯¹è¯è°ƒä¼˜çš„é¢„è®­ç»ƒè½¬æ¢æ¨¡å‹ã€‚GPT 3 æœ‰ 1750 äº¿å‚æ•°ï¼Œæœ‰ä¼ è¨€GPT 4 æœ‰ 1.76ä¸‡äº¿å‚æ•°ã€‚å‚æ•°æ˜¯ä»€ä¹ˆï¼Œå°±æ˜¯å›¾ä¸­èŠ‚ç‚¹ä¹‹é—´çš„è¿çº¿ï¼Œä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹1750äº¿æ ¹çº¿çš„åœºæ™¯ã€‚</p><p>OpenAIæå‡ºäº†ChatGPTï¼Œè®©å…¨ä¸–ç•ŒæƒŠæ‰äº†ä¸‹å·´ï¼Œä½†æ˜¯å®ƒæ˜¯é—­æºçš„ã€‚äºæ˜¯Metaå…¬å¸ï¼ˆå‰Facebookï¼‰çš„Yann LeCunï¼ˆå›¾çµå¥–å¾—ä¸»ï¼‰å›¢é˜Ÿï¼Œæäº†ä¸€ä¸ªå¼€æºç‰ˆæœ¬çš„GPTï¼Œå« LLaMAã€‚å®ƒä¹Ÿæ˜¯åœ¨å·¨é‡çš„æºæ•°æ®é›†ä¸Šè¿›è¡Œçš„è®­ç»ƒï¼Œç”Ÿæˆäº† 70äº¿ï¼ˆ7Bï¼‰ï¼Œ130äº¿ï¼ˆ13Bï¼‰ï¼Œ650äº¿ï¼ˆ65Bï¼‰ä¸‰ä¸ªç‰ˆæœ¬å‚æ•°çš„å¤§æ¨¡å‹æ–‡ä»¶ï¼Œå¯ä»¥ä¾›ä¸šç•Œåšå­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚ç°åœ¨å·²æ¨å‡ºLLaMA 2ï¼Œæ­£åœ¨åšLLaMA 3ã€‚</p><p>LLaMAæå‡ºæ¥åï¼Œæ€èµ·äº†LLMç•Œçš„ç‹‚æ¬¢ã€‚å…¨ä¸–ç•Œçš„å›¢é˜Ÿåœ¨LLaMAçš„åŸºç¡€ä¸Šï¼Œç»§ç»­è°ƒä¼˜ï¼Œæ¨å‡ºäº†å„ç§å„æ ·çš„å¤§æ¨¡å‹ã€‚æ¯”å¦‚å›½å†…æ¸…åçš„ ChatGLM, é›¶ä¸€ä¸‡ç‰©çš„ Yiã€‚å›½å¤–çš„ Mistralã€OpenChatã€Starling ç­‰ã€‚è¿™å—å„¿éå¸¸å·ï¼Œå¤§å®¶éƒ½åœ¨äº‰ç›¸æ¨å‡ºè‡ªå·±è°ƒä¼˜åçš„ç‰ˆæœ¬ï¼Œæ¯å¤©æ—©ä¸Šç¡é†’èµ·æ¥ï¼Œéƒ½å‘ç°åˆæ¨å‡ºäº†å‡ ä¸ªæ–°çš„LLMã€‚</p><p>è¿™äº›è®­ç»ƒå¥½åçš„æ–‡ä»¶ä¸€èˆ¬ä»å‡ ä¸ªGåˆ°å‡ åGä¸ç­‰ï¼Œä¹Ÿæœ‰å‡ ç™¾Gçš„ã€‚è¦è¿è¡Œå®ƒä»¬ï¼Œå¾—æœ‰éå¸¸å¼ºå¤§çš„æœºå™¨æ‰è¡Œã€‚æ¯”å¦‚7B çš„ LLaMA 2 æ–‡ä»¶ï¼Œæ¯ä¸ªæƒé‡ä¸ºä¸€ä¸ª f16 æµ®ç‚¹æ•°ï¼Œå ä¸¤ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥å¯ä»¥ä¼°ç®—å‡ºè¦è¿è¡Œ LLaMA 2 æ¨¡å‹ï¼Œèµ·ç å¾—æœ‰ 14G çš„å†…å­˜æˆ–æ˜¾å­˜ã€‚å†…å­˜è¿˜å¥½ï¼Œæ˜¾å­˜è¶…è¿‡14Gçš„ä¸ªäººç”¨æˆ·çœŸä¸å¤šã€‚å¹¶ä¸”ï¼ŒLLaMA2çš„æ¨¡å‹æ–‡ä»¶æ˜¯PyTorchå¯¼å‡ºçš„ï¼Œåªèƒ½ç”±PyTorchæ¡†æ¶æ¥è¿è¡Œã€‚</p><h3>llama.cppä¸é‡å­åŒ–æ–¹æ³•</h3><p>è½¦åˆ°å±±å‰å¿…æœ‰è·¯ï¼Œå¤§ç¥ Georgi Gerganov æäº†ä¸€ä¸ªé¡¹ç›®ï¼š<a href=\"https://github.com/ggerganov/llama.cpp\">llama.cpp</a>ã€‚å®ƒæ˜¯ä¸€ä¸ªç”¨C/C++é‡æ–°å®ç°å¼•æ“çš„ç‰ˆæœ¬ï¼Œä¸éœ€è¦å®‰è£…PyTorchï¼Œå°±å¯ä»¥è¿è¡ŒLLaMA 2æ¨¡å‹æ–‡ä»¶ã€‚æœ€å…³é”®çš„æ˜¯ï¼Œå®ƒæå‡ºäº†ä¸€ç§é‡å­åŒ–ï¼ˆquantizationï¼‰æ–¹æ³•ï¼Œå¯ä»¥å°†æƒé‡ä» 16 ä½é‡å­åŒ–åˆ°8ä½ã€6ä½ã€5ä½ã€4ä½ï¼Œç”šè‡³2ä½ã€‚è¿™æ ·ï¼Œå°±ç›¸å½“äºç­‰æ¯”ç¼©å°äº†å ç”¨å†…å­˜çš„è§„æ¨¡ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ª4ä½é‡å­åŒ–ç‰ˆæœ¬çš„LLaMA 2 7Bæ¨¡å‹ï¼Œå°±åªéœ€è¦ä¸åˆ°4Gçš„å†…å­˜/æ˜¾å­˜å°±èƒ½è¿è¡Œã€‚è¿™æ ·ï¼Œå°±èƒ½é€‚é…å¤§å¤šæ•°çš„ä¸ªäººè®¡ç®—æœºäº†ã€‚</p><p>è¿™ç§é‡å­åŒ–æ–¹æ³•æ˜¯ä¸ªé‡å¤§åˆ›æ–°ï¼Œå®ƒç›´æ¥ä¿ƒè¿›äº†LLMç”Ÿæ€çš„è¿›ä¸€æ­¥ç¹è£ã€‚ç°åœ¨HuggingFaceä¸Šæœ‰å¤§é‡é‡å­åŒ–åçš„æ¨¡å‹ï¼Œæ¯”å¦‚ <a href=\"https://huggingface.co/TheBloke/openchat_3.5-GGUF/blob/main/openchat_3.5.Q4_K_M.gguf\">openchat_3.5.Q4_K_M.gguf</a> å°±æ˜¯ä¸€ä¸ªOpenChatçš„4ä½é‡å­åŒ–çš„ç‰ˆæœ¬ã€‚æˆ‘ä»¬ä¸‹è½½çš„æ—¶å€™ï¼Œç›´æ¥ä¸‹è½½è¿™äº›é‡å­åŒ–åçš„æ¨¡å‹æ–‡ä»¶å°±å¯ä»¥äº†ã€‚</p><p>è¯·æ³¨æ„ï¼Œè¿™äº›æ–‡ä»¶æ˜¯è®­ç»ƒåçš„æˆå“ï¼Œæˆ‘ä»¬ä¸‹è½½å®ƒæ˜¯ç”¨æ¥åšæ¨ç†ï¼ˆinferï¼‰çš„ï¼Œè€Œä¸æ˜¯è®­ç»ƒï¼ˆtrainï¼‰çš„ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™äº›æˆå“æ¨¡å‹ä¸Šè¿è¡Œè°ƒä¼˜ï¼ˆfine tuneï¼‰ã€‚</p><h3>å¤§æ¨¡å‹æ–‡ä»¶æ ¼å¼</h3><p>ç›®å‰HuggingFaceä¸Šæœ‰å‡ ç§å¸¸è§çš„LLMæ–‡ä»¶æ ¼å¼ã€‚</p><ul>\n<li>binæ ¼å¼ï¼šPytorchå¯¼å‡ºçš„æ¨¡å‹æ–‡ä»¶æ ¼å¼</li>\n<li>safetensorsæ ¼å¼ï¼šHuggingFaceå®šä¹‰çš„ä¸€ç§æ–°çš„æ¨¡å‹æ–‡ä»¶æ ¼å¼ï¼Œæœ‰å¯èƒ½æˆä¸ºæœªæ¥çš„ä¸»æµæ ¼å¼ã€‚HuggingFaceç”¨Rustå®ç°safetensorsæ ¼å¼çš„è§£æï¼Œå¹¶å¯¼å‡ºä¸ºPyæ¥å£ï¼Œè¯·å‚è§<a href=\"https://huggingface.co/docs/safetensors/index\">é“¾æ¥</a>ã€‚</li>\n<li>ggmlæ ¼å¼ï¼šllama.cpp é¡¹ç›®é‡å­åŒ–æ¨¡å‹çš„å‰æœŸæ¨¡å‹æ ¼å¼ã€‚</li>\n<li>ggufæ ¼å¼ï¼šllama.cppé¡¹ç›®é‡å­åŒ–æ¨¡å‹çš„åæœŸæ¨¡å‹æ ¼å¼ï¼Œä¹Ÿæ˜¯ç°åœ¨ä¸»æµçš„é‡å­åŒ–LLMæ ¼å¼ã€‚</li>\n</ul><h3>Rustçš„æœºå™¨å­¦ä¹ æ¡†æ¶</h3><p>Rustç”Ÿæ€ç°åœ¨æœ‰å‡ ä¸ªæ¯”è¾ƒä¸é”™çš„MLæ¡†æ¶ï¼Œæœ€å¥½çš„ä¸¤ä¸ªæ˜¯ï¼š<a href=\"https://github.com/huggingface/candle\">Candle</a> å’Œ <a href=\"https://github.com/Tracel-AI/burn\">burn</a>ã€‚åç»­ï¼Œæˆ‘ä»¬ä»¥Candleä¸ºä¾‹æ¥ä»‹ç»ã€‚</p><h2>Candleä»‹ç»</h2><p>æ®Candleå®˜ç½‘ä»‹ç»ï¼Œå®ƒæ˜¯ä¸€ä¸ªæå°ä¸»ä¹‰æœºå™¨å­¦ä¹ æ¡†æ¶ï¼Œä¹Ÿå°±æ˜¯æ²¡ä»€ä¹ˆä¾èµ–ï¼Œä¸åƒPytorché‚£æ ·è£…ä¸€å †ä¸œè¥¿ï¼Œéƒ¨ç½²èµ·æ¥å¾ˆéº»çƒ¦ã€‚ä½†å…¶å®å®ƒä¹Ÿèƒ½ç”¨æ¥è®­ç»ƒã€‚</p><p>å®ƒæœ‰ä¸‹é¢è¿™äº›ç‰¹æ€§ï¼š</p><ul>\n<li>HuggingFaceå‡ºå“ã€‚è¿‘æ°´æ¥¼å°å…ˆå¾—æœˆï¼ŒCandleå‡ ä¹èƒ½æ”¯æŒHuggingFaceä¸Šæ‰€æœ‰çš„æ¨¡å‹ï¼ˆæœ‰çš„éœ€è¦ç»è¿‡è½¬æ¢ï¼‰ã€‚</li>\n<li>è¯­æ³•ç®€å•ï¼Œè·ŸPyTorchå·®ä¸å¤šã€‚</li>\n<li>CPUã€Cudaã€Metalçš„æ”¯æŒã€‚</li>\n<li>è®©serverlesså’Œå¿«é€Ÿéƒ¨ç½²æˆä¸ºå¯èƒ½ã€‚</li>\n<li>æ¨¡å‹è®­ç»ƒã€‚</li>\n<li>åˆ†å¸ƒå¼è®¡ç®—ï¼ˆé€šè¿‡NCCLï¼‰ã€‚</li>\n<li>å¼€ç®±å³ç”¨çš„æ¨¡å‹æ”¯æŒï¼ŒLLaMAã€Whisperã€ Falcon ç­‰ç­‰ã€‚</li>\n</ul><p>Candleä¸ä»…ä»…æ˜¯å¤§æ¨¡å‹æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œå®ƒè¿˜æ˜¯ä¸€ä¸ªæœºå™¨å­¦ä¹ æ¡†æ¶ï¼Œå› æ­¤å®ƒä¹Ÿæ”¯æŒå…¶ä»–çš„æœºå™¨å­¦ä¹ ç®—æ³•å’Œå¼ºåŒ–å­¦ä¹ ï¼ˆreinforcement learningï¼‰ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹å¦‚ä½•åˆ©ç”¨Candleæ¡†æ¶åšä¸€ä¸ªèŠå¤©æœºå™¨äººã€‚</p><p><span class=\"reference\">æ³¨ï¼šè¿™èŠ‚è¯¾çš„ä»£ç é€‚ç”¨äº candle_core v0.3 ç‰ˆæœ¬ã€‚</span></p><h2>ä½¿ç”¨Candleåšä¸€ä¸ªèŠå¤©æœºå™¨äºº</h2><h3>ä¸‹è½½æ¨¡å‹æ–‡ä»¶</h3><p>æˆ‘å¯¹ä¸€äº›å¤§æ¨¡å‹è¿›è¡Œäº†æµ‹è¯•ï¼Œå‘ç°OpenChatçš„å¯¹è¯æ•ˆæœæ¯”è¾ƒå¥½ï¼Œæ‰€ä»¥ä¸‹é¢æˆ‘ä»¬ç”¨OpenChat LLMæ¥è¿›è¡Œå±•ç¤ºã€‚æˆ‘ä»¬ä¼šç”¨ <a href=\"https://huggingface.co/TheBloke/openchat_3.5-GGUF/blob/main/openchat_3.5.Q8_0.gguf\">quantized 8bit</a> çš„ç‰ˆæœ¬ã€‚å…¶å® 4bit çš„ç‰ˆæœ¬ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæ•ˆæœä¹Ÿéå¸¸å¥½ã€‚</p><p>Candle å®˜æ–¹çš„ç¤ºä¾‹æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä¸ºè¿™ä¸ªè¯¾ç¨‹å®šåˆ¶äº†ä¸€ä¸ªæ›´ç®€å•çš„ç‹¬ç«‹è¿è¡Œçš„<a href=\"https://github.com/miketang84/jikeshijian/tree/master/23-candle_chat\">ç¤ºä¾‹</a>ã€‚ä½ å¯ä»¥å°†è¿™ä¸ªä»“åº“å…‹éš†ä¸‹æ¥ï¼Œè¿›å…¥ç›®å½•ã€‚åœ¨è¿è¡Œä»£ç ä¹‹å‰ï¼Œä¸‹è½½æ¨¡å‹æ–‡ä»¶å’Œtokenizer.jsonæ–‡ä»¶ã€‚</p><pre><code class=\"language-plain\">ä¸ä»£ç ç›®å½•åŒçº§çš„ä½ç½®ï¼Œåˆ›å»ºä¸€ä¸ªç›®å½•\nmkdir hf_hub\nè¿›å…¥è¿™ä¸ªç›®å½•ï¼Œè¯·ä¸‹è½½\nhttps://huggingface.co/TheBloke/openchat_3.5-GGUF/blob/main/openchat_3.5.Q8_0.gguf\nå’Œ\nhttps://huggingface.co/openchat/openchat_3.5/blob/main/tokenizer.json\nå°†è¿™ä¸ª tokenizer.json é‡å‘½åä¸º openchat_3.5_tokenizer.json\n</code></pre><p>ç›®å½•ç»“æ„ï¼š</p><pre><code class=\"language-plain\">23-candle_chat/\n    Cargo.toml\n    src/\nhf_hub/\n    openchat_3.5_tokenizer.json\n    openchat_3.5.Q8_0.gguf\n</code></pre><h3>è¿è¡Œæ¼”ç¤º</h3><p>ç„¶åï¼Œè¿›å…¥ 23-candle_chat/ è¿è¡Œï¼š</p><pre><code class=\"language-plain\">cargo run --release --bin simple\n</code></pre><p>å‡ºç°å¦‚ä¸‹ç•Œé¢ï¼Œå°±å¯ä»¥èŠå¤©äº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/18/27/18d6de5afca0b6ffb61e1bc309877127.png?wh=1531x255\" alt=\"å›¾ç‰‡\"></p><p>ä¸‹é¢æ˜¯æˆ‘é—®çš„ä¸€ä¸ªé—®é¢˜ï¼Œbotçš„å›ç­”å¥½åƒæœ‰ç‚¹é—®é¢˜ï¼Œè¿™ä¸ªæ¨¡å‹ç”¨è‹±æ–‡é—®çš„æ•ˆæœä¼šå¥½ä¸€äº›ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/6e/c1/6e420065087c82b10813d2694a67c6c1.png?wh=1920x791\" alt=\"å›¾ç‰‡\"></p><h3>ä»£ç è®²è§£</h3><p>ä½ å¯ä»¥çœ‹ä¸€ä¸‹ä»£ç ã€‚</p><pre><code class=\"language-plain\">#![allow(unused)]\n\nuse std::fs::File;\nuse std::io::Write;\nuse std::path::PathBuf;\nuse tokenizers::Tokenizer;\n\nuse candle_core::quantized::gguf_file;\nuse candle_core::utils;\nuse candle_core::{Device, Tensor};\nuse candle_transformers::generation::LogitsProcessor;\nuse candle_transformers::models::quantized_llama as quantized_model;\n\nuse anyhow::Result;\n\nmod token_output_stream;\nuse token_output_stream::TokenOutputStream;\n\nstruct Args {\n&nbsp; &nbsp; tokenizer: String,\n&nbsp; &nbsp; model: String,\n&nbsp; &nbsp; sample_len: usize,\n&nbsp; &nbsp; temperature: f64,\n&nbsp; &nbsp; seed: u64,\n&nbsp; &nbsp; repeat_penalty: f32,\n&nbsp; &nbsp; repeat_last_n: usize,\n&nbsp; &nbsp; gqa: usize,\n}\n\nimpl Args {\n&nbsp; &nbsp; fn tokenizer(&amp;self) -&gt; Result&lt;Tokenizer&gt; {\n&nbsp; &nbsp; &nbsp; &nbsp; let tokenizer_path = PathBuf::from(&amp;self.tokenizer);\n&nbsp; &nbsp; &nbsp; &nbsp; Tokenizer::from_file(tokenizer_path).map_err(anyhow::Error::msg)\n&nbsp; &nbsp; }\n\n&nbsp; &nbsp; fn model(&amp;self) -&gt; Result&lt;PathBuf&gt; {\n&nbsp; &nbsp; &nbsp; &nbsp; Ok(std::path::PathBuf::from(&amp;self.model))\n&nbsp; &nbsp; }\n}\n\nfn main() -&gt; anyhow::Result&lt;()&gt; {\n&nbsp; &nbsp; println!(\n&nbsp; &nbsp; &nbsp; &nbsp; \"avx: {}, neon: {}, simd128: {}, f16c: {}\",\n&nbsp; &nbsp; &nbsp; &nbsp; utils::with_avx(),\n&nbsp; &nbsp; &nbsp; &nbsp; utils::with_neon(),\n&nbsp; &nbsp; &nbsp; &nbsp; utils::with_simd128(),\n&nbsp; &nbsp; &nbsp; &nbsp; utils::with_f16c()\n&nbsp; &nbsp; );\n\n&nbsp; &nbsp; let args = Args {\n&nbsp; &nbsp; &nbsp; &nbsp; tokenizer: String::from(\"../hf_hub/openchat_3.5_tokenizer.json\"),\n&nbsp; &nbsp; &nbsp; &nbsp; model: String::from(\"../hf_hub/openchat_3.5.Q8_0.gguf\"),\n&nbsp; &nbsp; &nbsp; &nbsp; sample_len: 1000,\n&nbsp; &nbsp; &nbsp; &nbsp; temperature: 0.8,\n&nbsp; &nbsp; &nbsp; &nbsp; seed: 299792458,\n&nbsp; &nbsp; &nbsp; &nbsp; repeat_penalty: 1.1,\n&nbsp; &nbsp; &nbsp; &nbsp; repeat_last_n: 64,\n&nbsp; &nbsp; &nbsp; &nbsp; gqa: 8,\n&nbsp; &nbsp; };\n\n&nbsp; &nbsp; // load model\n&nbsp; &nbsp; let model_path = args.model()?;\n&nbsp; &nbsp; let mut file = File::open(&amp;model_path)?;\n&nbsp; &nbsp; let start = std::time::Instant::now();\n\n&nbsp; &nbsp; // This is the model instance\n&nbsp; &nbsp; let model = gguf_file::Content::read(&amp;mut file)?;\n&nbsp; &nbsp; let mut total_size_in_bytes = 0;\n&nbsp; &nbsp; for (_, tensor) in model.tensor_infos.iter() {\n&nbsp; &nbsp; &nbsp; &nbsp; let elem_count = tensor.shape.elem_count();\n&nbsp; &nbsp; &nbsp; &nbsp; total_size_in_bytes +=\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elem_count * tensor.ggml_dtype.type_size() / tensor.ggml_dtype.blck_size();\n&nbsp; &nbsp; }\n&nbsp; &nbsp; println!(\n&nbsp; &nbsp; &nbsp; &nbsp; \"loaded {:?} tensors ({}bytes) in {:.2}s\",\n&nbsp; &nbsp; &nbsp; &nbsp; model.tensor_infos.len(),\n&nbsp; &nbsp; &nbsp; &nbsp; total_size_in_bytes,\n&nbsp; &nbsp; &nbsp; &nbsp; start.elapsed().as_secs_f32(),\n&nbsp; &nbsp; );\n&nbsp; &nbsp; let mut model = quantized_model::ModelWeights::from_gguf(model, &amp;mut file)?;\n&nbsp; &nbsp; println!(\"model built\");\n\n&nbsp; &nbsp; // load tokenizer\n&nbsp; &nbsp; let tokenizer = args.tokenizer()?;\n&nbsp; &nbsp; let mut tos = TokenOutputStream::new(tokenizer);\n&nbsp; &nbsp; // left for future improvement: interactive\n&nbsp; &nbsp; for prompt_index in 0.. {\n&nbsp; &nbsp; &nbsp; &nbsp; print!(\"&gt; \");\n&nbsp; &nbsp; &nbsp; &nbsp; std::io::stdout().flush()?;\n&nbsp; &nbsp; &nbsp; &nbsp; let mut prompt = String::new();\n&nbsp; &nbsp; &nbsp; &nbsp; std::io::stdin().read_line(&amp;mut prompt)?;\n&nbsp; &nbsp; &nbsp; &nbsp; if prompt.ends_with('\\n') {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; prompt.pop();\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if prompt.ends_with('\\r') {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; prompt.pop();\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; &nbsp; &nbsp; let prompt_str = format!(\"User: {prompt} &lt;|end_of_turn|&gt; Assistant: \");\n&nbsp; &nbsp; &nbsp; &nbsp; print!(\"bot: \");\n\n&nbsp; &nbsp; &nbsp; &nbsp; let tokens = tos\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .tokenizer()\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .encode(prompt_str, true)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .map_err(anyhow::Error::msg)?;\n\n&nbsp; &nbsp; &nbsp; &nbsp; let prompt_tokens = tokens.get_ids();\n&nbsp; &nbsp; &nbsp; &nbsp; let mut all_tokens = vec![];\n&nbsp; &nbsp; &nbsp; &nbsp; let mut logits_processor = LogitsProcessor::new(args.seed, Some(args.temperature), None);\n\n&nbsp; &nbsp; &nbsp; &nbsp; let start_prompt_processing = std::time::Instant::now();\n&nbsp; &nbsp; &nbsp; &nbsp; let mut next_token = {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let input = Tensor::new(prompt_tokens, &amp;Device::Cpu)?.unsqueeze(0)?;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let logits = model.forward(&amp;input, 0)?;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let logits = logits.squeeze(0)?;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; logits_processor.sample(&amp;logits)?\n&nbsp; &nbsp; &nbsp; &nbsp; };\n&nbsp; &nbsp; &nbsp; &nbsp; let prompt_dt = start_prompt_processing.elapsed();\n&nbsp; &nbsp; &nbsp; &nbsp; all_tokens.push(next_token);\n&nbsp; &nbsp; &nbsp; &nbsp; if let Some(t) = tos.next_token(next_token)? {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print!(\"{t}\");\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; std::io::stdout().flush()?;\n&nbsp; &nbsp; &nbsp; &nbsp; }\n\n&nbsp; &nbsp; &nbsp; &nbsp; let eos_token = \"&lt;|end_of_turn|&gt;\";\n&nbsp; &nbsp; &nbsp; &nbsp; let eos_token = *tos.tokenizer().get_vocab(true).get(eos_token).unwrap();\n&nbsp; &nbsp; &nbsp; &nbsp; let start_post_prompt = std::time::Instant::now();\n&nbsp; &nbsp; &nbsp; &nbsp; let to_sample = args.sample_len.saturating_sub(1);\n&nbsp; &nbsp; &nbsp; &nbsp; let mut sampled = 0;\n&nbsp; &nbsp; &nbsp; &nbsp; for index in 0..to_sample {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let input = Tensor::new(&amp;[next_token], &amp;Device::Cpu)?.unsqueeze(0)?;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let logits = model.forward(&amp;input, prompt_tokens.len() + index)?;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let logits = logits.squeeze(0)?;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let logits = if args.repeat_penalty == 1. {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; logits\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let start_at = all_tokens.len().saturating_sub(args.repeat_last_n);\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; candle_transformers::utils::apply_repeat_penalty(\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;logits,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; args.repeat_penalty,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;all_tokens[start_at..],\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )?\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; next_token = logits_processor.sample(&amp;logits)?;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; all_tokens.push(next_token);\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if let Some(t) = tos.next_token(next_token)? {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print!(\"{t}\");\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; std::io::stdout().flush()?;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sampled += 1;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if next_token == eos_token {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };\n&nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; &nbsp; &nbsp; if let Some(rest) = tos.decode_rest().map_err(candle_core::Error::msg)? {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print!(\"{rest}\");\n&nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; &nbsp; &nbsp; std::io::stdout().flush()?;\n&nbsp; &nbsp; &nbsp; &nbsp; let dt = start_post_prompt.elapsed();\n&nbsp; &nbsp; &nbsp; &nbsp; println!(\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \"\\n\\n{:4} prompt tokens processed: {:.2} token/s\",\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; prompt_tokens.len(),\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; prompt_tokens.len() as f64 / prompt_dt.as_secs_f64(),\n&nbsp; &nbsp; &nbsp; &nbsp; );\n&nbsp; &nbsp; &nbsp; &nbsp; println!(\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \"{sampled:4} tokens generated: {:.2} token/s\",\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sampled as f64 / dt.as_secs_f64(),\n&nbsp; &nbsp; &nbsp; &nbsp; );\n&nbsp; &nbsp; }\n\n&nbsp; &nbsp; Ok(())\n}\n</code></pre><p>æˆ‘ä»¬åˆ†æ®µè®²è§£è¿™100å¤šè¡Œä»£ç ã€‚</p><p>ç¬¬19è¡Œï¼Œå®šä¹‰äº†Argså‚æ•°ï¼Œè¿™æ˜¯æ¨¡å‹å¿…è¦çš„å‚æ•°é…ç½®å®šä¹‰ã€‚ç¬¬42ï½48è¡Œï¼Œçœ‹çœ‹æœ‰å“ªäº›CPUç‰¹æ€§æ”¯æŒã€‚ç¬¬50ï½59è¡Œï¼Œå®ä¾‹åŒ–Argsï¼Œè¿™äº›å‚æ•°éƒ½æ˜¯ç¡¬ç¼–ç è¿›å»çš„ï¼Œé™¤äº†ä¸¤ä¸ªæ–‡ä»¶çš„è·¯å¾„å¤–ï¼Œéœ€è¦LLMç›¸å…³çŸ¥è¯†æ‰èƒ½ç†è§£ã€‚</p><p>ç¬¬62ï½81è¡Œï¼ŒåŠ è½½å¤§æ¨¡å‹æ–‡ä»¶ï¼Œå¹¶ç”Ÿæˆæ¨¡å‹å¯¹è±¡ã€‚æˆ‘ä»¬è¿™ä¸ªæ¨¡å‹æ˜¯GGUFæ ¼å¼çš„ï¼Œå› æ­¤éœ€è¦ç”¨gguf_fileæ¨¡å—æ¥è¯»ã€‚Tensoræ˜¯LLMä¸­çš„é‡è¦æ¦‚å¿µï¼Œå®ƒæ˜¯ä¸€ä¸ªå¤šç»´æ•°ç»„ï¼Œå¯ä»¥åœ¨CPUå’ŒGPUä¸Šè®¡ç®—ï¼Œåœ¨GPUä¸Šè¿˜å¯ä»¥å¹¶è¡Œè®¡ç®—ã€‚ä¸€ä¸ªå¤§æ¨¡å‹ç”±å¾ˆå¤šçš„Tensorç»„æˆã€‚æˆ‘ä»¬è¿™ä¸ªæ¨¡å‹ä¸­ï¼ŒåŠ è½½è¿›æ¥äº† 291 ä¸ª Tensorã€‚</p><p>ç¬¬84è¡Œï¼ŒåŠ è½½tokenizer.jsonæ–‡ä»¶ï¼Œå¹¶ç”Ÿæˆ tokenizer å®ä¾‹ã€‚tokenizer ç”¨äºå°†è¾“å…¥å’Œè¾“å‡ºçš„æ–‡æœ¬è½¬åŒ–ä¸ºTensorï¼Œå˜æˆå¤§æ¨¡å‹å¯ç†è§£çš„æ•°æ®ã€‚ç¬¬85è¡Œåˆ›å»ºtokenè¾“å‡ºæµå®ä¾‹ã€‚ç¬¬89ï½99è¡Œï¼Œå»ºç«‹é—®ç­”ç•Œé¢ï¼Œè¾“å…¥æç¤ºç¬¦ä¸ºä¸€ä¸ª &gt; å·ï¼Œè¾“å‡ºä¸º <code>bot:</code> å¼€å¤´ã€‚ç¬¬101ï½104è¡Œå°†è¾“å…¥çš„é—®ç­”è½¬åŒ–ä¸º tokensã€‚è¿™ä¸ªtokenså°±æ˜¯Tensorå®ä¾‹ã€‚</p><p>ç¬¬106ï½122è¡Œï¼Œæ˜¯ç”¨äºå¤„ç†è¾“å…¥ï¼Œå¤§æ¨¡å‹å¯¹è¾“å…¥çš„tokenåšä¸€å¤„ç†ï¼Œä½ å¯ä»¥ç†è§£æˆå¤§æ¨¡å‹å¯¹ä½ çš„è¾“å…¥é—®é¢˜å…ˆè¦è¿›è¡Œä¸€ä¸‹ç†è§£ï¼Œç„¶ååé¢æ‰èƒ½åšå‡ºå¯¹åº”çš„å›ç­”ã€‚<br>\nLogitsProcessor æ˜¯ä¸€ä¸ªç”¨äºä¿®æ”¹æ¨¡å‹è¾“å‡ºæ¦‚ç‡åˆ†å¸ƒçš„å·¥å…·ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ä½¿ç”¨çš„è®¾å¤‡å†™æ­»äº†ï¼Œç”¨çš„CPUã€‚</p><p>ç¬¬124è¡Œï¼Œ<code>\"&lt;|end_of_turn|&gt;\"</code> æ˜¯ OpenChat æ¨¡å¼å®šä¹‰çš„ä¸€è½®å¯¹è¯ç»“æŸçš„æ ‡å¿—ã€‚ç¬¬125ï½156è¡Œï¼Œå°±æ˜¯å¯¹é—®é¢˜çš„å›ç­”ã€‚ç”¨çš„è®¾å¤‡ä»ç„¶ä¸ºCPUï¼Œæˆ‘ä»¬å¯ä»¥çŒœæµ‹åº”è¯¥ä¼šå¾ˆæ…¢ã€‚å®ƒè¿™é‡Œé¢è¿˜æœ‰å¯¹penaltyæœºåˆ¶çš„å¤„ç†ã€‚ç»†èŠ‚ä¹Ÿéœ€è¦å»æŸ¥é˜…å¤§æ¨¡å‹NLPç›¸å…³çš„çŸ¥è¯†ã€‚</p><p>ç¬¬158ï½167è¡Œï¼Œæ˜¯å¯¹æœ¬æ¬¡å¤„ç†æ€§èƒ½çš„ä¸€ä¸ªæ±‡æ€»ã€‚åœ¨æˆ‘çš„ç”µè„‘ä¸Šï¼Œçº¯ç”¨CPUè®¡ç®—çš„è¯ï¼Œåªèƒ½è¾¾åˆ°1ç§’ä¸€ä¸ªå¤štokençš„é€Ÿåº¦ï¼Œéå¸¸å¡ã€‚æœ‰GPUåŠ æŒçš„è¯ï¼Œä¼šå¿«å¾ˆå¤šã€‚</p><p>ä½ å¯èƒ½å‘ç°äº†ï¼Œç¬¬87è¡Œæœ‰ä¸ªå¾ªç¯ï¼Œå®ƒæ˜¯ç”¨æ¥å®ç° interactive äº¤äº’æ•ˆæœçš„ï¼Œé—®å®Œä¸€å¥ï¼Œå›ç­”å®Œï¼Œè¿˜å¯ä»¥é—®ä¸‹ä¸€å¥ã€‚</p><h3>æ·»åŠ å‘½ä»¤è¡Œå‚æ•°</h3><p>å‰é¢çš„simpleç¤ºä¾‹ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„å‚æ•°éƒ½æ˜¯å†™æ­»åœ¨ä»£ç é‡Œé¢çš„ã€‚è¿™æ ·æ–¹ä¾¿ç†è§£ï¼Œä½†ä¸æ–¹ä¾¿ä½¿ç”¨ã€‚æˆ‘ä»¬å¯ä»¥å°è¯•ä¸ºå®ƒæ·»åŠ å‘½ä»¤è¡Œå‚æ•°åŠŸèƒ½ã€‚</p><p>åœ¨Rustä¸­ï¼Œå†™ä¸€ä¸ªå‘½ä»¤è¡Œéå¸¸ç®€å•ï¼Œç›´æ¥ç”¨clapï¼Œæ”¹å‡ è¡Œä»£ç å°±å¯ä»¥äº†ã€‚å°†ä¸Šé¢ç¤ºä¾‹ä¸­çš„Argsç»“æ„ä½“çš„å®šä¹‰å˜æˆä¸‹é¢è¿™æ ·å°±å¯ä»¥äº†ï¼Œç„¶ååœ¨è°ƒç”¨çš„æ—¶å€™ä½¿ç”¨ <code>Args::parse()</code> ç”Ÿæˆ Args å®ä¾‹ã€‚</p><pre><code class=\"language-plain\">#[derive(Parser, Debug)]\n#[command(author, version, about, long_about = None)]\nstruct Args {\n&nbsp; &nbsp; #[arg(long, default_value = \"../hf_hub/openchat_3.5_tokenizer.json\")]\n&nbsp; &nbsp; tokenizer: String,\n&nbsp; &nbsp; #[arg(long, default_value = \"../hf_hub/openchat_3.5.Q8_0.gguf\")]\n&nbsp; &nbsp; model: String,\n&nbsp; &nbsp; #[arg(short = 'n', long, default_value_t = 1000)]\n&nbsp; &nbsp; sample_len: usize,\n&nbsp; &nbsp; #[arg(long, default_value_t = 0.8)]\n&nbsp; &nbsp; temperature: f64,\n&nbsp; &nbsp; #[arg(long, default_value_t = 299792458)]\n&nbsp; &nbsp; seed: u64,\n&nbsp; &nbsp; #[arg(long, default_value_t = 1.1)]\n&nbsp; &nbsp; repeat_penalty: f32,\n&nbsp; &nbsp; #[arg(long, default_value_t = 64)]\n&nbsp; &nbsp; repeat_last_n: usize,\n&nbsp; &nbsp; #[arg(long, default_value_t = 8)]\n&nbsp; &nbsp; gqa: usize,\n}\n\nfn main() {\n    // ...\n    let args = Args::parse();  \n    // ...\n}\n</code></pre><p>ç»è¿‡å‡çº§çš„å‘½ä»¤æœ‰äº†ä¸‹é¢è¿™äº›å‚æ•°ï¼š</p><pre><code class=\"language-plain\">$ cargo run --release --bin cli -- --help\n    Finished release [optimized] target(s) in 0.04s\n     Running `target/release/cli --help`\navx: false, neon: false, simd128: false, f16c: false\nUsage: cli [OPTIONS]\nOptions:\n      --tokenizer &lt;TOKENIZER&gt;            [default: ../hf_hub/openchat_3.5_tokenizer.json]\n      --model &lt;MODEL&gt;                    [default: ../hf_hub/openchat_3.5.Q8_0.gguf]\n  -n, --sample-len &lt;SAMPLE_LEN&gt;          [default: 1000]\n      --temperature &lt;TEMPERATURE&gt;        [default: 0.8]\n      --seed &lt;SEED&gt;                      [default: 299792458]\n      --repeat-penalty &lt;REPEAT_PENALTY&gt;  [default: 1.1]\n      --repeat-last-n &lt;REPEAT_LAST_N&gt;    [default: 64]\n      --gqa &lt;GQA&gt;                        [default: 8]\n  -h, --help                             Print help\n  -V, --version                          Print version\n</code></pre><p>æ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Ÿè°è¯´Rustç”Ÿäº§åŠ›ä¸è¡Œçš„ï¼</p><p>ç‚¹å‡»<a href=\"https://github.com/miketang84/jikeshijian/tree/master/23-candle_chat\">è¿™é‡Œ</a>å¯ä»¥æ‰¾åˆ°æºæ–‡ä»¶ï¼Œä½ å¯ä»¥æœ¬åœ°è¯•è¯•è·‘èµ·ä¸€ä¸ªå¤§æ¨¡å‹å¯¹è¯æœºå™¨äººã€‚å¦å¤–ï¼ŒCandleå®˜æ–¹ä»“åº“ä¸­çš„<a href=\"https://github.com/huggingface/candle/tree/main/candle-examples/examples/quantized\">ç¤ºä¾‹</a>åŠŸèƒ½æ›´å¼ºå¤§ï¼Œä½†ä¹Ÿæ›´å¤æ‚ï¼Œä½ å¯ä»¥ç»§ç»­æ·±å…¥ç ”ç©¶ã€‚</p><h2>å°ç»“</h2><p>è¿™èŠ‚è¯¾æˆ‘ä»¬ä¸€èµ·æ¢ç´¢äº†ä½¿ç”¨Ruståˆ©ç”¨Candleæœºå™¨å­¦ä¹ æ¡†æ¶å¼€å‘ä¸€ä¸ªå¤§æ¨¡å‹èŠå¤©æœºå™¨äººçš„åº”ç”¨ã€‚Rustç›®å‰åœ¨AIç•Œè™½ç„¶è¿˜ä¸å¤Ÿæœ‰å½±å“åŠ›ï¼Œä½†æ˜¯æœªæ¥æ˜¯ç›¸å½“æœ‰æ½œåŠ›çš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆHuggingFaceå¸¦å¤´å‡ºä¸€ä¸ªRustæœºå™¨å­¦ä¹ æ¡†æ¶çš„åŸå› ã€‚</p><p>ä¸è¿‡è¿™èŠ‚è¯¾æˆ‘ä»¬åªæ˜¯è®²äº†æ€ä¹ˆç”¨èµ·æ¥ï¼Œè€Œå¦‚æœè¦æ·±å…¥ä¸‹å»çš„è¯ï¼Œæœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹ çš„åŸºç¡€çŸ¥è¯†å°±å¿…ä¸å¯å°‘äº†ã€‚å¦‚æœä½ æœ‰æ—¶é—´ç²¾åŠ›çš„è¯ï¼Œä½ å¯ä»¥æ·±å…¥ä¸‹å»å¥½å¥½è¡¥å……ä¸€ä¸‹è¿™æ–¹é¢çš„å­¦æœ¯çŸ¥è¯†ï¼Œæ¯•ç«Ÿæœªæ¥å‡ åå¹´ï¼ŒAIæ˜¯ä¸€ä¸ªä¸»è¦é—®é¢˜ï¼Œä¹Ÿä¼šæ˜¯ä¸€ä¸ªä¸»è¦æœºä¼šã€‚ç›®å‰AIå‘å±•é€Ÿåº¦å¤ªå¿«äº†ï¼Œæœ‰ç§å­¦ä¹ è·Ÿä¸ä¸Šä¸šç•Œå‘å±•é€Ÿåº¦çš„æ„Ÿè§‰ã€‚ä½†æ˜¯ä¸ç®¡æ€æ ·ï¼Œå­¦å¥½åŸºç¡€ï¼Œæ°¸è¿œä¸ä¼šè¿‡æ—¶ã€‚</p><p>å¦å¤–ï¼ŒRust AIè¿™å—å„¿ï¼Œè™½ç„¶å·²ç»å°æœ‰èµ·è‰²ï¼Œä½†æ˜¯ä½œä¸ºç”Ÿæ€æ¥è®²ï¼Œç©ºç™½å¤„è¿˜å¾ˆå¤šã€‚æ‰€ä»¥è¿™ä¹Ÿæ­£æ˜¯å­¦å¥½Rustçš„æœºä¼šï¼ŒRustå¯ä»¥åœ¨AIåŸºå»ºè¿™å—åšå¤§é‡çš„å·¥ä½œï¼Œè¿™äº›å·¥ä½œå¯ä»¥æœåŠ¡äºRustç¤¾åŒºï¼Œä¹Ÿå¯ä»¥æœåŠ¡äºPythonä¹ƒè‡³æ•´ä¸ªAIç¤¾åŒºã€‚</p><h2>æ€è€ƒé¢˜</h2><p>ä½ å¯ä»¥åœ¨æˆ‘çš„ç¤ºä¾‹ä¸Šç»§ç»­æ£é¼“ï¼Œæ·»åŠ GPUçš„æ”¯æŒï¼Œåœ¨Linuxã€Windowsã€macOSå¤šç§å¹³å°ä¸Šæµ‹è¯•ä¸€ä¸‹ã€‚æ¬¢è¿ä½ åœ¨è¯„è®ºåŒºè´´å‡ºä½ è‡ªå·±çš„ä»£ç ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™å…¶ä»–æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","neighbors":{"left":{"article_title":"22ï½œWebå¼€å‘ï¼ˆä¸‹ï¼‰ï¼šå¦‚ä½•å®ç°ä¸€ä¸ªTodo Liståº”ç”¨ï¼Ÿ","id":734130},"right":{"article_title":"24ï½œRustå›¾åƒè¯†åˆ«ï¼šåˆ©ç”¨YOLOv8è¯†åˆ«å¯¹è±¡","id":734943}},"comments":[{"had_liked":false,"id":386591,"user_name":"eriklee","can_delete":false,"product_type":"c1","uid":2826132,"ip_address":"åŒ—äº¬","ucode":"6F755DB7C29DD6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIyhbzdkFM64Npva5ZKf4IPwhy6rDAX0L77QNESbalnXhnGKibcTbwtSaNC0hO6z0icO8DYI9Nf4xwg/132","comment_is_top":false,"comment_ctime":1705158488,"is_pvip":false,"replies":[{"id":140944,"content":"æœ‰äº†cæ¥å£ï¼Œå°±ç­‰äºæœ‰äº†rustæ¥å£ï¼Œå› ä¸ºrustè°ƒç”¨cæ¥å£æ²¡æœ‰æ€§èƒ½æŸè€—ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1705326671,"ip_address":"é‡åº†","comment_id":386591,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"&quot;é¦–å…ˆ Rust çš„æ€§èƒ½ä¸ C&#47;C++ ä¸€è‡´ï¼Œå¹¶ä¸”åœ¨è°ƒç”¨ GPU èƒ½åŠ›æ–¹é¢ä¹ŸåŒæ ·æ–¹ä¾¿&quot;\nrustç›®å‰åº”è¯¥è¿˜ä¸èƒ½ç›´æ¥è®¿é—®cudaå§ï¼Ÿæ¯•ç«Ÿcudaæ˜¯cæ¥å£","like_count":6,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635885,"discussion_content":"æœ‰äº†cæ¥å£ï¼Œå°±ç­‰äºæœ‰äº†rustæ¥å£ï¼Œå› ä¸ºrustè°ƒç”¨cæ¥å£æ²¡æœ‰æ€§èƒ½æŸè€—ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1705326671,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385760,"user_name":"å¬é›¨","can_delete":false,"product_type":"c1","uid":3793352,"ip_address":"å››å·","ucode":"A95C65A31FC72F","user_header":"https://static001.geekbang.org/account/avatar/00/39/e1/c8/c7ed7336.jpg","comment_is_top":false,"comment_ctime":1703263632,"is_pvip":false,"replies":[{"id":140632,"content":"æˆ‘åœ¨wslä¸­æµ‹è¿‡ï¼Œå¯ä»¥çš„ã€‚å¦‚æœæƒ³è¦wslæ”¯æŒå›¾å½¢ç•Œé¢åº”ç”¨ï¼Œéœ€è¦updateåˆ°æœ€æ–°ç‰ˆwslã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1703577793,"ip_address":"é‡åº†","comment_id":385760,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"è€å¸ˆï¼Œæˆ‘ä¸‹è½½åˆ°äº†windowä¸‹çš„å­Linuxä¸­è¿è¡Œï¼ŒæŠ¥OS errorã€‚è¯·é—®æ˜¯ä¸æ˜¯ä¸æ”¯æŒåœ¨è¿™é‡Œé¢è¿è¡Œå•Š","like_count":2,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634498,"discussion_content":"æˆ‘åœ¨wslä¸­æµ‹è¿‡ï¼Œå¯ä»¥çš„ã€‚å¦‚æœæƒ³è¦wslæ”¯æŒå›¾å½¢ç•Œé¢åº”ç”¨ï¼Œéœ€è¦updateåˆ°æœ€æ–°ç‰ˆwslã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1703577793,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":386660,"user_name":"tan","can_delete":false,"product_type":"c1","uid":1477463,"ip_address":"é‡åº†","ucode":"20E176CB1EFD51","user_header":"https://static001.geekbang.org/account/avatar/00/16/8b/57/a3daeaae.jpg","comment_is_top":false,"comment_ctime":1705302969,"is_pvip":false,"replies":[{"id":140976,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1705410899,"ip_address":"é‡åº†","comment_id":386660,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"wsl: Error: No such file or directory (os error 2) . å¤„ç†ï¼šsimple.rsä¸­ tikenizerå’Œmodelçš„å‚æ•°å†™å…¨[&#47;mnt&#47;xx&#47;xx&#47;openchat_3.5_tokenizer.json]","like_count":1,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635965,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1705410899,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1624977,"avatar":"https://static001.geekbang.org/account/avatar/00/18/cb/91/14398631.jpg","nickname":"ç‹è¶…","note":"","ucode":"3CE4B6863C28A5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":637302,"discussion_content":"æˆ–è€…é‡æ–°ln -sfä¸€ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1708312353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":389009,"user_name":"zhuxiufenghust","can_delete":false,"product_type":"c1","uid":1034291,"ip_address":"å¹¿ä¸œ","ucode":"A8719F8407E74F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c8/33/2d4c464b.jpg","comment_is_top":false,"comment_ctime":1711369434,"is_pvip":false,"replies":[{"id":141744,"content":"æˆ‘æ²¡é‡åˆ°è¿‡è¿™ç§é”™è¯¯ï¼Œä½ æ˜¯ä»€ä¹ˆç¯å¢ƒä¸‹è¿è¡Œçš„ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1713028423,"ip_address":"åŠ æ‹¿å¤§","comment_id":389009,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"avx: false, neon: false, simd128: false, f16c: false\nError: unknown magic 0x6f64213c è¿™ä¸ªé”™è¯¯è¦æ€ä¹ˆè§£å†³","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":641825,"discussion_content":"æˆ‘æ²¡é‡åˆ°è¿‡è¿™ç§é”™è¯¯ï¼Œä½ æ˜¯ä»€ä¹ˆç¯å¢ƒä¸‹è¿è¡Œçš„ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1713028423,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŠ æ‹¿å¤§","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1494311,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epdUKuOV21hnfTmXPibv5ReJCCIxiamtzXkibh9p41sSJeYQ87swreLWlTNEibh5ibefsoJfFppOvR088Q/132","nickname":"Geek_05de53","note":"","ucode":"20872B89D6A782","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":644670,"discussion_content":"è¯¥æŠ¥é”™æ˜¯æ²¡æ­£ç¡®ä¸‹è½½ggufæ–‡ä»¶ï¼Œç”¨wgetä¸‹è½½çš„æ˜¯ä¸€ä¸ª&lt;!doctype html&gt;æ–‡ä»¶ï¼Œéœ€è¦æ­£ç¡®ä¸‹è½½ggufæ–‡ä»¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1715417436,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":388864,"user_name":"ä¸å¿˜åˆå¿ƒ","can_delete":false,"product_type":"c1","uid":3737491,"ip_address":"å››å·","ucode":"8262D42405F4E2","user_header":"https://static001.geekbang.org/account/avatar/00/39/07/93/710c7ee2.jpg","comment_is_top":false,"comment_ctime":1711021853,"is_pvip":false,"replies":[{"id":141746,"content":"Voice LLM + å®¢æœç³»ç»Ÿ + ç”µé”€ç³»ç»Ÿ ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1713028477,"ip_address":"åŠ æ‹¿å¤§","comment_id":388864,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"è€å¸ˆ, AI ç”µé”€, éœ€è¦ä»€ä¹ˆæ ·çš„æŠ€æœ¯æ ˆ?","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":641827,"discussion_content":"Voice LLM + å®¢æœç³»ç»Ÿ + ç”µé”€ç³»ç»Ÿ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1713028477,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŠ æ‹¿å¤§","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":388798,"user_name":"xl000","can_delete":false,"product_type":"c1","uid":1117935,"ip_address":"å±±ä¸œ","ucode":"6FEABE7F7D0DC0","user_header":"https://static001.geekbang.org/account/avatar/00/11/0e/ef/030e6d27.jpg","comment_is_top":false,"comment_ctime":1710907806,"is_pvip":false,"replies":[{"id":141749,"content":"ğŸ‘éå¸¸æ£’ï¼Œé‡åˆ°è¿™ç§ç‰ˆæœ¬å‡çº§çš„äº‹æƒ…ã€‚ä¸€èˆ¬å°é—®é¢˜ï¼Œrustç¼–è¯‘å™¨ä¼šæŒ‡å¯¼æˆ‘ä»¬æ”¹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1713028679,"ip_address":"åŠ æ‹¿å¤§","comment_id":388798,"utype":1}],"discussion_count":2,"race_medal":2,"score":2,"product_id":100626901,"comment_content":"candle-core 0.4ç‰ˆæœ¬, åªéœ€è¦æ”¹ä¸¤å¤„\ntensor.ggml_dtype.blck_size() æ”¹ä¸º tensor.ggml_dtype.block_size()\nfrom_gguf(model, &amp;mut file)é‚£è¡Œæ”¹ä¸º \nlet device = Device::cuda_if_available(0)?;\nlet mut model = quantized_model::ModelWeights::from_gguf(model, &amp;mut file, &amp;device)?;","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":641831,"discussion_content":"ğŸ‘éå¸¸æ£’ï¼Œé‡åˆ°è¿™ç§ç‰ˆæœ¬å‡çº§çš„äº‹æƒ…ã€‚ä¸€èˆ¬å°é—®é¢˜ï¼Œrustç¼–è¯‘å™¨ä¼šæŒ‡å¯¼æˆ‘ä»¬æ”¹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1713028679,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŠ æ‹¿å¤§","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1117935,"avatar":"https://static001.geekbang.org/account/avatar/00/11/0e/ef/030e6d27.jpg","nickname":"xl000","note":"","ucode":"6FEABE7F7D0DC0","race_medal":2,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":639926,"discussion_content":"è¿˜æœ‰ä¸¤å¤„ç›´æ¥ä¼ Device::Cpuçš„åœ°æ–¹æ”¹ä¸ºä¼ device","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1710993194,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å±±ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":387350,"user_name":"Geek_3b58b9","can_delete":false,"product_type":"c1","uid":3196265,"ip_address":"æ±Ÿè‹","ucode":"E9DE52FD0B5E29","user_header":"","comment_is_top":false,"comment_ctime":1707028054,"is_pvip":false,"replies":[{"id":141161,"content":"å¯¹çš„ï¼Œå¯ä»¥åšè¿™æ–¹é¢çš„å·¥ä½œ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1707198502,"ip_address":"å››å·","comment_id":387350,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"Candle è¦æ˜¯æ”¯æŒ ROCm å°±æ›´å¥½äº†","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":636895,"discussion_content":"å¯¹çš„ï¼Œå¯ä»¥åšè¿™æ–¹é¢çš„å·¥ä½œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1707198502,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å››å·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":386649,"user_name":"tan","can_delete":false,"product_type":"c1","uid":1477463,"ip_address":"é‡åº†","ucode":"20E176CB1EFD51","user_header":"https://static001.geekbang.org/account/avatar/00/16/8b/57/a3daeaae.jpg","comment_is_top":false,"comment_ctime":1705288311,"is_pvip":false,"replies":[{"id":140975,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1705410889,"ip_address":"é‡åº†","comment_id":386649,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"WSL: linker `cc` not found å¤„ç†æ–¹å¼ï¼š sudo apt update &amp;&amp; sudo apt install build-essential","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635964,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1705410889,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":386590,"user_name":"eriklee","can_delete":false,"product_type":"c1","uid":2826132,"ip_address":"åŒ—äº¬","ucode":"6F755DB7C29DD6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIyhbzdkFM64Npva5ZKf4IPwhy6rDAX0L77QNESbalnXhnGKibcTbwtSaNC0hO6z0icO8DYI9Nf4xwg/132","comment_is_top":false,"comment_ctime":1705158190,"is_pvip":false,"replies":[{"id":140943,"content":"ä½ çš„åˆ†æä¸­çŸ­æœŸå†…ä¸€å®šæ˜¯å¯¹çš„ã€‚åœ¨å­¦æœ¯ç•Œrustä¸€å®šå¹²ä¸è¿‡pythonã€‚ burnä¹Ÿå¾ˆä¼˜ç§€ï¼Œä½†æ˜¯èƒŒåèµ„æºæ²¡æœ‰candleå¤šã€‚ä¸¤ä¸ªæ¡†æ¶éƒ½å¸Œæœ›èƒ½å¿«ç‚¹å‘å±•èµ·æ¥ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1705326636,"ip_address":"é‡åº†","comment_id":386590,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"è€å¸ˆèƒ½å¯¹æ¯”ä¸‹candleå’Œburnå—ï¼Ÿ\nå¦å¤–ï¼Œæ„Ÿè§‰rustä¼˜åŠ¿æ˜¯è¾¹ç¼˜ç«¯æ¨ç†ï¼Œæ¯•ç«Ÿè¾¹ç¼˜ä¾§èµ„æºç´§å¼ . æœåŠ¡å™¨ç«¯æ¨ç†ï¼Œæ¯•ç«Ÿè¿˜æ˜¯æ¯”ä¸è¿‡pythonç”Ÿæ€","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635884,"discussion_content":"ä½ çš„åˆ†æä¸­çŸ­æœŸå†…ä¸€å®šæ˜¯å¯¹çš„ã€‚åœ¨å­¦æœ¯ç•Œrustä¸€å®šå¹²ä¸è¿‡pythonã€‚ burnä¹Ÿå¾ˆä¼˜ç§€ï¼Œä½†æ˜¯èƒŒåèµ„æºæ²¡æœ‰candleå¤šã€‚ä¸¤ä¸ªæ¡†æ¶éƒ½å¸Œæœ›èƒ½å¿«ç‚¹å‘å±•èµ·æ¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1705326636,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":386316,"user_name":"é¸ æ‘©æ™º","can_delete":false,"product_type":"c1","uid":1106201,"ip_address":"æ±Ÿè‹","ucode":"853E584FC4CD64","user_header":"https://static001.geekbang.org/account/avatar/00/10/e1/19/c756aaed.jpg","comment_is_top":false,"comment_ctime":1704542520,"is_pvip":true,"replies":[{"id":140812,"content":"è¿™ä¸ªæ–¹å‘å¯ä»¥å°è¯•çš„ï¼Œéœ€è¦ç”¨åˆ°code ç”Ÿæˆçš„æ¨¡å‹ã€‚è¿™æ˜¯ä¸ªéå¸¸æœ‰è¶£çš„æ–¹å‘ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1704684795,"ip_address":"é‡åº†","comment_id":386316,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"è€å¸ˆï¼Œè¯·é—®ä¸€ä¸‹ï¼Œå¯ä»¥ä¸‹è½½åˆ«äººè®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œé€šè¿‡candle æ¥å®ç°æ ¹æ®éœ€æ±‚æè¿°è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹çš„è¿™ç§åŠŸèƒ½å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635273,"discussion_content":"è¿™ä¸ªæ–¹å‘å¯ä»¥å°è¯•çš„ï¼Œéœ€è¦ç”¨åˆ°code ç”Ÿæˆçš„æ¨¡å‹ã€‚è¿™æ˜¯ä¸ªéå¸¸æœ‰è¶£çš„æ–¹å‘ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1704684796,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":386147,"user_name":"superggn","can_delete":false,"product_type":"c1","uid":3623568,"ip_address":"åŒ—äº¬","ucode":"831CCD98B393FE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/7Q403U68Oy4lXG5sFBPVKLrfwaRzBqpBZibpEBXcPf9UOO3qrnh7RELoByTLzBZLkN9Nukfsj7DibynbZjKAKgag/132","comment_is_top":false,"comment_ctime":1704192068,"is_pvip":false,"replies":[{"id":140776,"content":"å¯¹ç”µè„‘è¦æ±‚æœ‰ç‚¹é«˜","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1704259355,"ip_address":"é‡åº†","comment_id":386147,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100626901,"comment_content":"mac 2021 æ¬¾ intel èŠ¯ç‰‡ï¼Œ ç³»ç»Ÿç‰ˆæœ¬ Montery 12.5.1 ä¼šå¡ä½ï¼Œ model built ä¹‹åè¾“å…¥ä¸€ä¸ª hello å°±ä¸åŠ¨äº†ï¼Œ è¦è¿‡ 5 åˆ†é’Ÿä»¥ä¸Šæ‰ä¼šæœ‰å›å¤","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634979,"discussion_content":"å¯¹ç”µè„‘è¦æ±‚æœ‰ç‚¹é«˜","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1704259355,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385456,"user_name":"Geek_54dac1","can_delete":false,"product_type":"c1","uid":3793601,"ip_address":"å››å·","ucode":"649A0AE325056A","user_header":"","comment_is_top":false,"comment_ctime":1702636682,"is_pvip":false,"replies":[{"id":140475,"content":"å¾ˆæ£’çš„æ¢ç´¢å’Œåˆ†äº«ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1702734984,"ip_address":"é‡åº†","comment_id":385456,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100626901,"comment_content":"è¯¥æ¨¡å‹åœ¨ Candle ä¸­è¿˜æš‚æ—¶ä¸æ”¯æŒåœ¨ GPU ä¸Šè¿è¡Œï¼Œå› ä¸º Quantized models on Cuda è¿˜ä¸æ”¯æŒï¼Œå‚è€ƒï¼šhttps:&#47;&#47;github.com&#47;huggingface&#47;candle&#47;issues&#47;1250ï¼›é¿å…å¤§å®¶æŒ–å‘","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":633899,"discussion_content":"å¾ˆæ£’çš„æ¢ç´¢å’Œåˆ†äº«ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1702734984,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385428,"user_name":"æ— é™å¯èƒ½","can_delete":false,"product_type":"c1","uid":1007654,"ip_address":"åŒ—äº¬","ucode":"D3CE995904BF58","user_header":"https://static001.geekbang.org/account/avatar/00/0f/60/26/35ef9bef.jpg","comment_is_top":false,"comment_ctime":1702618807,"is_pvip":false,"replies":[{"id":140469,"content":"1ã€‚ä¸»è¦æ˜¯é¢„è®­ç»ƒç¥ç»ç½‘ç»œæ¨¡å‹æƒé‡æ•°æ®\n2ã€‚è¦ä¸‹è½½åˆ°æœ¬åœ°ï¼Œè¦åŠ è½½åˆ°æ˜¾å­˜æˆ–è€…å†…å­˜ä¸­è¿è¡Œ\n3ã€‚æ˜¯çš„","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1702697921,"ip_address":"é‡åº†","comment_id":385428,"utype":1}],"discussion_count":3,"race_medal":0,"score":3,"product_id":100626901,"comment_content":"è€å¸ˆå¥½ï¼Œå¤§æ¨¡å‹å°ç™½æœ‰å‡ ä¸ªé—®é¢˜ã€‚é€šè¿‡ huggingface-cli scan-cacheï¼Œæ‰«æäº†ä¸€ä¸‹ huggingface ä¸‹è½½è¿‡çš„æ–‡ä»¶ï¼Œéƒ½æ˜¯ 7G æˆ–è€…æ›´å¤§ï¼š\n1. è¿™äº›æ¨¡å‹æ–‡ä»¶é‡Œä¸»è¦æ˜¯ä»€ä¹ˆå†…å®¹ï¼Œæ˜¯åŒ…æ‹¬äº†æ•°æ®ä¹ˆï¼Ÿä¸ºå•¥ä¼šè¿™ä¹ˆå¤§ï¼Ÿ\n2. ç±»ä¼¼è¿™ä¹ˆå¤§çš„æ–‡ä»¶ï¼Œä¸€å®šè¦ä¸‹è½½åˆ°æœ¬åœ°ä¹ˆï¼Œæ˜¯å¦å¯ä»¥äº‘éƒ¨ç½²ä¹‹ç±»ï¼Œå¯ä»¥ç”¨å®Œé”€æ¯ã€‚\n3. æˆ‘ç†è§£ï¼Œæˆ‘æƒ³è¦è¿è¡Œæœ¬èŠ‚è¯¾çš„demoï¼Œè¿™ 7G çš„ç©ºé—´å°±æ˜¯è¦é•¿æœŸè§„åˆ’å‡ºå»äº†å§","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":633869,"discussion_content":"1ã€‚ä¸»è¦æ˜¯é¢„è®­ç»ƒç¥ç»ç½‘ç»œæ¨¡å‹æƒé‡æ•°æ®\n2ã€‚è¦ä¸‹è½½åˆ°æœ¬åœ°ï¼Œè¦åŠ è½½åˆ°æ˜¾å­˜æˆ–è€…å†…å­˜ä¸­è¿è¡Œ\n3ã€‚æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1702697921,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1077733,"avatar":"https://static001.geekbang.org/account/avatar/00/10/71/e5/bcdc382a.jpg","nickname":"My dream","note":"","ucode":"2FEFB344230C17","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":633868,"discussion_content":"è€å¸ˆè®²è¿™èŠ‚æ—¶ï¼Œæ„Ÿè§‰æ²¡è®²é€ï¼Œèƒ½è®²ä¸€ä¸‹æ¨¡å‹æ˜¯æ€ä¹ˆè®­ç»ƒçš„ä¸ï¼Ÿæ•™æ•™æˆ‘ä»¬è‡ªå·±è®­ç»ƒæ¨¡å‹å˜›ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1702697793,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å››å·","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1052528,"avatar":"https://static001.geekbang.org/account/avatar/00/10/0f/70/cdef7a3d.jpg","nickname":"Joe Black","note":"","ucode":"21FE222A286445","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1077733,"avatar":"https://static001.geekbang.org/account/avatar/00/10/71/e5/bcdc382a.jpg","nickname":"My dream","note":"","ucode":"2FEFB344230C17","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635021,"discussion_content":"è¿™å¯å°±ä¸æ˜¯rustè¯¾ç¨‹è¯¥æ•™çš„å†…å®¹äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1704320417,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":633868,"ip_address":"åŒ—äº¬","group_id":0},"score":635021,"extra":""}]}]},{"had_liked":false,"id":385415,"user_name":"å­¦æ°´","can_delete":false,"product_type":"c1","uid":2557688,"ip_address":"åŠ æ‹¿å¤§","ucode":"F8B27FD11187EC","user_header":"https://static001.geekbang.org/account/avatar/00/27/06/f8/09ad484b.jpg","comment_is_top":false,"comment_ctime":1702608725,"is_pvip":false,"replies":[{"id":140460,"content":"æ˜¯çš„ï¼Œå¦‚æœè®²mlçš„è¯ï¼Œåˆæ˜¯ä¸“é—¨ä¸€é—¨è¯¾ç¨‹äº†ã€‚å¯ä»¥åœ¨åç»­ç»§ç»­æ·±å…¥ä¸‹å»ã€‚ä½ æœ‰pytorchåŸºç¡€å°±éå¸¸æœ‰åˆ©ã€‚ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1702637007,"ip_address":"é‡åº†","comment_id":385415,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100626901,"comment_content":"è¿™å¼ æ„Ÿè§‰ä¸»è¦æ˜¯ç»™å¯¹rustæœ‰å…´è¶£çš„mleï¼Œä¸­é—´ä¸€äº›ä»£ç å¦‚æœä¸æ˜¯å› ä¸ºç”¨è¿‡pytorchï¼Œå®Œå…¨ä¸çŸ¥é“åœ¨å¹²å•¥","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":633839,"discussion_content":"æ˜¯çš„ï¼Œå¦‚æœè®²mlçš„è¯ï¼Œåˆæ˜¯ä¸“é—¨ä¸€é—¨è¯¾ç¨‹äº†ã€‚å¯ä»¥åœ¨åç»­ç»§ç»­æ·±å…¥ä¸‹å»ã€‚ä½ æœ‰pytorchåŸºç¡€å°±éå¸¸æœ‰åˆ©ã€‚ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1702637007,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385408,"user_name":"åˆ˜ä¸¹","can_delete":false,"product_type":"c1","uid":1081922,"ip_address":"å¹¿ä¸œ","ucode":"66594D1C957E15","user_header":"https://static001.geekbang.org/account/avatar/00/10/82/42/8b04d489.jpg","comment_is_top":false,"comment_ctime":1702600157,"is_pvip":false,"replies":[{"id":140456,"content":"æœ‰å‡ ä¸ªè¿˜ä¸é”™çš„ã€‚\nhttps:&#47;&#47;github.com&#47;sobelio&#47;llm-chain\nhttps:&#47;&#47;github.com&#47;rustformers&#47;llm\nhttps:&#47;&#47;github.com&#47;jondot&#47;awesome-rust-llm\n\nå½“ç„¶æœ€å¼ºçš„ï¼Œè¿˜æ˜¯candleå•¦ã€‚\nhttps:&#47;&#47;github.com&#47;huggingface&#47;candle","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1702610466,"ip_address":"é‡åº†","comment_id":385408,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100626901,"comment_content":"è€å¸ˆï¼Œä½ å¥½ï¼Œè¯·é—®èƒ½å¦æ¨èå‡ ä¸ªå’Œ ChatGPT äº¤äº’çš„ Rust SDK ? æœ€å¥½ä¹Ÿèƒ½æ”¯æŒå…¶å®ƒ LLM ã€‚","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":633774,"discussion_content":"æœ‰å‡ ä¸ªè¿˜ä¸é”™çš„ã€‚\nhttps://github.com/sobelio/llm-chain\nhttps://github.com/rustformers/llm\nhttps://github.com/jondot/awesome-rust-llm\n\nå½“ç„¶æœ€å¼ºçš„ï¼Œè¿˜æ˜¯candleå•¦ã€‚\nhttps://github.com/huggingface/candle","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1702610466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":392757,"user_name":"Yanxiaoç¾…","can_delete":false,"product_type":"c1","uid":1423217,"ip_address":"ç¦å»º","ucode":"D3A180FC11F42D","user_header":"https://static001.geekbang.org/account/avatar/00/15/b7/71/f0d3a1af.jpg","comment_is_top":false,"comment_ctime":1721705958,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100626901,"comment_content":"ä½¿ç”¨GPUåŠ é€Ÿé‡åˆ°é—®é¢˜åŠå¤„ç†è®°å½•\n\n1ã€candleç‰ˆæœ¬å‡çº§åˆ°0.4.0ï¼Œapiå˜åŒ–éœ€è¦è°ƒæ•´ä¸¤å¤„ã€‚å‚è€ƒä¸Šé¢è¯„è®º\n\n2ã€candleå®˜ç½‘æç¤ºGPUå¼€å¯éœ€ä½¿ç”¨ `--features cuda` ï¼Œç»“åˆæŸ¥çœ‹`Device::cuda_if_available(0)` å†…éƒ¨åˆ¤æ–­æ¡ä»¶ä¸ºè¯»å–é…ç½® `config == cuda` ã€‚é¦–å…ˆä¿®æ”¹ä»£ç ä¸­CPUçš„è®¾ç½®\n\n114è¡Œã€132è¡Œ\n\n```rust\n&#47;&#47;ä½¿ç”¨Device::new_cuda(0)æ›¿æ¢Device::CPU\nlet input = Tensor::new(&amp;[next_token], &amp;Device::new_cuda(0)?)?.unsqueeze(0)?;\n```\næ‰§è¡ŒåæŠ¥æ‰¾ä¸åˆ°å¯¹åº”çš„å‘½ä»¤features\n\n3ã€`Cargo.toml` ï¼ŒæŸ¥çœ‹å®˜æ–¹æ–‡æ¡£exampleé…ç½®ï¼Œæ·»åŠ å¯¹åº”é…ç½®\n\n```toml\n[features]\ncuda = [&quot;candle&#47;cuda&quot;, &quot;candle-nn&#47;cuda&quot;, &quot;candle-transformers&#47;cuda&quot;]\n```\n\n4ã€æ‰§è¡ŒååŒ…candleæŠ¥é”™ï¼ŒåŸå› ä¸ºå®˜ç½‘ä½¿ç”¨workspaceï¼ŒåŒ…å«äº†`candle-core`ã€`candle-transformes`ã€`candle-nn`ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦å•ç‹¬é…ç½®\n\n```toml\n[dependencies]\nanyhow = &quot;1.0.75&quot;\ncandle-core = { version = &quot;0.4.0&quot; }\ncandle-transformers = &quot;0.4.0&quot;\ncandle-nn = &quot;0.4.0&quot;\nclap = &quot;4.4.10&quot;\nhf-hub = &quot;0.3.2&quot;\ntokenizers = &quot;0.15.0&quot;\n\n[features]\ncuda = [&quot;candle-core&#47;cuda&quot;, &quot;candle-nn&#47;cuda&quot;, &quot;candle-transformers&#47;cuda&quot;]\n```\n\n4ã€æ‰§è¡ŒåæŠ¥æ‰¾ä¸åˆ°CUDAç¯å¢ƒå˜é‡ï¼Œå‚è€ƒä»¥ä¸‹æ–‡ç« ï¼Œè®°å¾—å…ˆæŸ¥çœ‹å½“å‰æœºå™¨CUDAç‰ˆæœ¬ï¼Œå»NVIDAå®˜ç½‘ä¸‹è½½å¯¹åº”çš„cuda\n\n[windowsä¸‹å®‰è£…cudaå’Œcudnn - è‹èŒ«è¯¯æ­¤ç”Ÿåšå®¢ (cangmang.xyz)](https:&#47;&#47;cangmang.xyz&#47;articles&#47;1682852371010)\n\n5ã€æ‰§è¡ŒåæŠ¥æ‰¾ä¸åˆ°`Cannot find compiler &#39;cl.exe&#39; in PATH`ï¼Œæ ¹æ®stackoverflowä¸Šæ’æŸ¥ï¼Œé…ç½®Visual Studioçš„binç›®å½•åˆ°ç¯å¢ƒå˜é‡ã€‚æ³¨æ„æ–°ç‰ˆæœ¬è·¯å¾„ä¸stackoverflowä¸Šæœ€ä½³å›ç­”ä¸åŒï¼Œæ‰¾åˆ°å¯¹åº”ä½ç½®ï¼Œå¤§è‡´å¦‚ä¸‹ï¼š\n\n`C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Community\\VC\\Tools\\MSVC\\14.23.28105\\bin\\Hostx64\\x64`\n\n6ã€æ‰§è¡ŒåæŠ¥\n\n```rust\nDriverError(CUDA_ERROR_NOT_FOUND, &quot;named symbol not found&quot;) when loading dequantize_block_q8_0\n```\n\næå®¢æ—¶é—´åç»­è¯„è®ºä¸ºcandleä¸æ”¯æŒï¼Œè€ƒè™‘åˆ°è¯„è®ºæ—¶é—´ä¸ºå»å¹´ã€‚ç»§ç»­googleï¼Œcandle githubå®˜ç½‘issueä¸­æœ‰ç›¸åº”çš„å›ç­”ï¼Œå·²å¤„ç†å¹¶åˆå¹¶åˆ°ä¸»å¹²ï¼Œæ—¶é—´ä¸º2024å¹´3æœˆä»½ã€‚è·Ÿè¸ª3æœˆä»½åï¼Œç¦»3æœˆä»½æœ€è¿‘ç‰ˆæœ¬ä¸º`0.5.0` ï¼ˆé¿å…APIå˜åŒ–å¤§ï¼Œæœªä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ï¼‰ã€‚æ›´æ–°`cargo.toml` \n\n```toml\n[dependencies]\ncandle-core = { version = &quot;0.5.0&quot; }\ncandle-transformers = &quot;0.5.0&quot;\ncandle-nn = &quot;0.5.0&quot;\n```\n\n7ã€æ‰§è¡ŒæˆåŠŸã€‚","like_count":1},{"had_liked":false,"id":391136,"user_name":"HanStrong","can_delete":false,"product_type":"c1","uid":1372962,"ip_address":"æµ™æ±Ÿ","ucode":"1E0E26E1237180","user_header":"https://static001.geekbang.org/account/avatar/00/14/f3/22/9090dfc8.jpg","comment_is_top":false,"comment_ctime":1717405297,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100626901,"comment_content":"ä¸ä½¿ç”¨gpu 3ç§’é’Ÿç”Ÿæˆä¸€ä¸ªtoken è¿™æ˜¯æ­£å¸¸çš„é€Ÿåº¦ä¹ˆ è¿˜æ˜¯è·Ÿç”µè„‘æœ‰å…³ç³»","like_count":0}]}