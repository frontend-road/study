{"id":497807,"title":"15 | é™æµå™¨è®¾è®¡ï¼šå¦‚ä½•é¿å…è¶…é¢„æœŸçš„é«˜å¹¶å‘å‹åŠ›å‹å®ç³»ç»Ÿï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ææ™ºæ…§ã€‚</p><p>åœ¨äº’è”ç½‘é«˜å¯ç”¨æ¶æ„è®¾è®¡ä¸­ï¼Œé™æµæ˜¯ä¸€ç§ç»å…¸çš„é«˜å¯ç”¨æ¶æ„æ¨¡å¼ã€‚å› ä¸ºæŸäº›åŸå› ï¼Œå¤§é‡ç”¨æˆ·çªç„¶è®¿é—®æˆ‘ä»¬çš„ç³»ç»Ÿæ—¶ï¼Œæˆ–è€…æœ‰é»‘å®¢æ¶æ„ç”¨DoSï¼ˆDenial of Serviceï¼Œæ‹’ç»æœåŠ¡ï¼‰æ–¹å¼æ”»å‡»æˆ‘ä»¬çš„ç³»ç»Ÿæ—¶ï¼Œè¿™ç§æœªæ›¾é¢„æœŸçš„é«˜å¹¶å‘è®¿é—®å¯¹ç³»ç»Ÿäº§ç”Ÿçš„è´Ÿè½½å‹åŠ›å¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚</p><p>è§£å†³è¿™ç§é—®é¢˜çš„ä¸€ä¸ªä¸»è¦æ‰‹æ®µå°±æ˜¯é™æµï¼Œå³æ‹’ç»éƒ¨åˆ†è®¿é—®è¯·æ±‚ï¼Œä½¿è®¿é—®è´Ÿè½½å‹åŠ›é™ä½åˆ°ä¸€ä¸ªç³»ç»Ÿå¯ä»¥æ‰¿å—çš„ç¨‹åº¦ã€‚è¿™æ ·è™½ç„¶æœ‰éƒ¨åˆ†ç”¨æˆ·è®¿é—®å¤±è´¥ï¼Œä½†æ˜¯æ•´ä¸ªç³»ç»Ÿä¾ç„¶æ˜¯å¯ç”¨çš„ï¼Œä¾ç„¶èƒ½å¯¹å¤–æä¾›æœåŠ¡ï¼Œè€Œä¸æ˜¯å› ä¸ºè´Ÿè½½å‹åŠ›å¤ªå¤§è€Œå´©æºƒï¼Œå¯¼è‡´æ‰€æœ‰ç”¨æˆ·éƒ½ä¸èƒ½è®¿é—®ã€‚</p><p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬å‡†å¤‡å¼€å‘ä¸€ä¸ªé™æµå™¨ï¼Œäº§å“åç§°ä¸ºâ€œDianaâ€ã€‚</p><h2>éœ€æ±‚åˆ†æ</h2><p>æˆ‘ä»¬å°†Dianaå®šä½ä¸ºä¸€ä¸ªé™æµå™¨ç»„ä»¶ï¼Œå³Dianaçš„ä¸»è¦åº”ç”¨åœºæ™¯æ˜¯éƒ¨ç½²åœ¨å¾®æœåŠ¡ç½‘å…³æˆ–è€…å…¶ä»–HTTPæœåŠ¡å™¨å…¥å£ï¼Œä»¥è¿‡æ»¤å™¨çš„æ–¹å¼å¯¹è¯·æ±‚è¿›è¡Œè¿‡æ»¤ï¼Œå¯¹è¶…è¿‡é™æµè§„åˆ™çš„è¯·æ±‚è¿”å›â€œæœåŠ¡ä¸å¯ç”¨â€HTTPå“åº”ã€‚</p><p>Dianaçš„é™æµè§„åˆ™å¯é€šè¿‡é…ç½®æ–‡ä»¶è·å–ï¼Œå¹¶éœ€è¦æ”¯æŒæœ¬åœ°é…ç½®å’Œè¿œç¨‹é…ç½®ä¸¤ç§æ–¹å¼ï¼Œè¿œç¨‹é…ç½®ä¼˜å…ˆäºæœ¬åœ°é…ç½®ã€‚é™æµæ–¹å¼åŒ…æ‹¬ï¼š</p><ul>\n<li>å…¨å±€é™æµï¼šé’ˆå¯¹æ‰€æœ‰è¯·æ±‚è¿›è¡Œé™æµï¼Œå³ä¿è¯æ•´ä¸ªç³»ç»Ÿå¤„ç†çš„è¯·æ±‚æ€»æ•°æ»¡è¶³é™æµé…ç½®ã€‚</li>\n<li>è´¦å·é™æµï¼šé’ˆå¯¹è´¦å·è¿›è¡Œé™æµï¼Œå³å¯¹å•ä¸ªè´¦å·å‘é€çš„è¯·æ±‚è¿›è¡Œé™æµã€‚</li>\n<li>è®¾å¤‡é™æµï¼šé’ˆå¯¹è®¾å¤‡è¿›è¡Œé™æµï¼Œå³å¯¹å•ä¸ªå®¢æˆ·ç«¯è®¾å¤‡å‘é€çš„è¯·æ±‚è¿›è¡Œé™æµã€‚</li>\n<li>èµ„æºé™æµï¼šé’ˆå¯¹æŸä¸ªèµ„æºï¼ˆå³æŸä¸ªURLï¼‰è¿›è¡Œé™æµï¼Œå³ä¿è¯è®¿é—®è¯¥èµ„æºçš„è¯·æ±‚æ€»æ•°æ»¡è¶³é™æµé…ç½®ã€‚</li>\n</ul><!-- [[[read_end]]] --><p>å¹¶ä¸”Dianaè®¾è®¡åº”éµå¾ªå¼€é—­åŸåˆ™ï¼Œèƒ½å¤Ÿæ”¯æŒçµæ´»çš„é™æµè§„åˆ™åŠŸèƒ½æ‰©å±•ï¼Œå³æœªæ¥åœ¨ä¸ä¿®æ”¹ç°æœ‰ä»£ç å’Œå…¼å®¹ç°æœ‰é…ç½®æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œæ”¯æŒæ–°çš„é…ç½®è§„åˆ™ã€‚</p><h2>æ¦‚è¦è®¾è®¡</h2><p>Dianaçš„è®¾è®¡ç›®æ ‡æ˜¯ä¸€ä¸ªé™æµå™¨ç»„ä»¶ï¼Œå³Dianaå¹¶ä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç³»ç»Ÿï¼Œä¸å¯ä»¥ç‹¬ç«‹éƒ¨ç½²è¿›è¡Œé™æµï¼Œè€Œæ˜¯éƒ¨ç½²åœ¨ç³»ç»Ÿç½‘å…³ï¼ˆæˆ–è€…å…¶ä»–HTTPæœåŠ¡å™¨ä¸Šï¼‰ï¼Œä½œä¸ºç½‘å…³çš„ä¸€ä¸ªç»„ä»¶è¿›è¡Œé™æµï¼Œéƒ¨ç½²æ¨¡å‹å¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/e7/4e/e77c0eaf41d816223d8b603f02a3854e.jpg?wh=1920x973\" alt=\"å›¾ç‰‡\"></p><p>ç”¨æˆ·è¯·æ±‚ï¼ˆé€šè¿‡è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼‰åˆ°è¾¾ç½‘å…³æœåŠ¡å™¨ã€‚ç½‘å…³æœåŠ¡å™¨æœ¬è´¨ä¹Ÿæ˜¯ä¸€ä¸ªHTTPæœåŠ¡å™¨ï¼Œé™æµå™¨æ˜¯éƒ¨ç½²åœ¨ç½‘å…³ä¸­çš„ä¸€ä¸ªè¿‡æ»¤å™¨ï¼ˆfilterï¼‰ç»„ä»¶ï¼Œå’Œç½‘å…³ä¸­çš„ç­¾åæ ¡éªŒè¿‡æ»¤å™¨ã€ç”¨æˆ·æƒé™è¿‡æ»¤å™¨ç­‰é…ç½®åœ¨åŒä¸€ä¸ªè¿‡æ»¤å™¨è´£ä»»é“¾ï¼ˆChain of Responsibilityï¼‰ä¸Šã€‚é™æµå™¨åº”è¯¥é…ç½®åœ¨æ•´ä¸ªè¿‡æ»¤å™¨è´£ä»»é“¾çš„å‰ç«¯ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè¯·æ±‚è¶…è¿‡äº†é™æµï¼Œè¯·æ±‚ä¸éœ€è¦å†è¿›å…¥å…¶ä»–è¿‡æ»¤å™¨ï¼Œç›´æ¥è¢«é™æµå™¨æ‹’ç»ã€‚</p><p>ç”¨æˆ·è¯·æ±‚è¿›å…¥é™æµå™¨åï¼Œæ ¹æ®é™æµç­–ç•¥ï¼Œåˆ¤æ–­è¯¥è¯·æ±‚æ˜¯å¦å·²ç»è¶…è¿‡é™æµï¼Œå¦‚æœè¶…è¿‡ï¼Œé™æµå™¨ç›´æ¥è¿”å›çŠ¶æ€ç ä¸º503ï¼ˆToo Many Requestsï¼‰çš„å“åº”ï¼›å¦‚æœæ²¡æœ‰è¶…è¿‡é™æµï¼Œè¯·æ±‚ç»§ç»­å‘ä¸‹å¤„ç†ï¼ˆç»è¿‡å…¶ä»–ç½‘å…³è¿‡æ»¤å™¨ï¼‰ï¼Œå¹¶æœ€ç»ˆè°ƒç”¨å¾®æœåŠ¡å®Œæˆå¤„ç†ã€‚</p><p>é™æµå™¨çš„ç­–ç•¥å¯ä»¥åœ¨æœ¬åœ°é…ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿œç¨‹çš„é…ç½®ä¸­å¿ƒæœåŠ¡å™¨åŠ è½½ï¼Œå³è¿œç¨‹é…ç½®ã€‚è¿œç¨‹é…ç½®ä¼˜å…ˆäºæœ¬åœ°é…ç½®ã€‚</p><h4>é™æµæ¨¡å¼è®¾è®¡</h4><p>è¯·æ±‚æ˜¯å¦è¶…è¿‡é™æµï¼Œä¸»è¦å°±æ˜¯åˆ¤æ–­å•ä½æ—¶é—´è¯·æ±‚æ•°é‡æ˜¯å¦è¶…è¿‡é…ç½®çš„è¯·æ±‚é™æµæ•°é‡ã€‚å•ä½æ—¶é—´è¯·æ±‚æ•°é‡ï¼Œå¯ä»¥æœ¬åœ°è®°å½•ï¼Œä¹Ÿå¯ä»¥è¿œç¨‹è®°å½•ã€‚æ–¹ä¾¿èµ·è§ï¼Œæœ¬åœ°è®°å½•ç§°ä½œæœ¬åœ°é™æµï¼Œè¿œç¨‹è®°å½•ç§°ä½œè¿œç¨‹é™æµï¼ˆä¹Ÿå«åˆ†å¸ƒå¼é™æµï¼‰ã€‚</p><p>æœ¬åœ°é™æµæ„å‘³ç€ï¼Œæ¯ä¸ªç½‘å…³æœåŠ¡å™¨éœ€è¦æ ¹æ®æœ¬åœ°è®°å½•çš„å•ä½æ—¶é—´è¯·æ±‚æ•°é‡è¿›è¡Œé™æµã€‚å‡è®¾é™æµé…ç½®ä¸ºæ¯ç§’é™æµ50è¯·æ±‚ï¼Œå¦‚æœè¯¥ç½‘å…³æœåŠ¡å™¨æœ¬åœ°è®°å½•çš„å½“å‰ä¸€ç§’å†…æ¥å—è¯·æ±‚æ•°é‡è¾¾åˆ°50ï¼Œé‚£ä¹ˆè¿™ä¸€ç§’å†…çš„åç»­è¯·æ±‚éƒ½è¿”å›503å“åº”ã€‚å¦‚æœæ•´ä¸ªç³»ç»Ÿéƒ¨ç½²äº†100å°ç½‘å…³æœåŠ¡å™¨ï¼Œæ¯ä¸ªç½‘å…³é…ç½®æœ¬åœ°é™æµä¸ºæ¯ç§’50ï¼Œé‚£ä¹ˆï¼Œæ•´ä¸ªç³»ç»Ÿæ¯ç§’æœ€å¤šå¯ä»¥å¤„ç†5000ä¸ªè¯·æ±‚ã€‚</p><p>è¿œç¨‹é™æµæ„å‘³ç€ï¼Œæ‰€æœ‰ç½‘å…³å…±äº«åŒä¸€ä¸ªé™æµæ•°é‡ï¼Œæ¯ä¸ªç½‘å…³æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œä»è¿œç¨‹æœåŠ¡å™¨ä¸­è·å–å•ä½æ—¶é—´å†…å·²å¤„ç†è¯·æ±‚æ•°ï¼Œå¦‚æœè¶…è¿‡é™æµï¼Œå°±è¿”å›503å“åº”ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯èƒ½æŸä¸ªç½‘å…³æœåŠ¡å™¨ä¸€æ®µæ—¶é—´å†…æ ¹æœ¬å°±æ²¡æœ‰è¯·æ±‚åˆ°è¾¾ï¼Œä½†æ˜¯è¿œç¨‹çš„å·²å¤„ç†è¯·æ±‚æ•°å·²ç»è¾¾åˆ°äº†é™æµä¸Šé™ï¼Œé‚£ä¹ˆè¿™å°ç½‘å…³æœåŠ¡å™¨ä¹Ÿå¿…é¡»æ‹’ç»è¯·æ±‚ã€‚æˆ‘ä»¬ä½¿ç”¨Redisä½œä¸ºè®°å½•å•ä½æ—¶é—´è¯·æ±‚æ•°é‡çš„è¿œç¨‹æœåŠ¡å™¨ã€‚</p><h4>é«˜å¯ç”¨è®¾è®¡</h4><p>ä¸ºäº†ä¿è¯é…ç½®ä¸­å¿ƒæœåŠ¡å™¨å’ŒRedisæœåŠ¡å™¨å®•æœºæ—¶ï¼Œé™æµå™¨ç»„ä»¶çš„é«˜å¯ç”¨ã€‚é™æµå™¨åº”å…·æœ‰è‡ªåŠ¨é™çº§åŠŸèƒ½ï¼Œå³é…ç½®ä¸­å¿ƒä¸å¯ç”¨ï¼Œåˆ™ä½¿ç”¨æœ¬åœ°é…ç½®ï¼›RedisæœåŠ¡å™¨ä¸å¯ç”¨ï¼Œåˆ™é™çº§ä¸ºæœ¬åœ°é™æµã€‚</p><h2>è¯¦ç»†è®¾è®¡</h2><p>å¸¸ç”¨çš„é™æµç®—æ³•æœ‰4ç§ï¼Œå›ºå®šçª—å£ï¼ˆWindowï¼‰é™æµç®—æ³•ï¼Œæ»‘åŠ¨çª—å£ï¼ˆSliding Windowï¼‰é™æµç®—æ³•ï¼Œæ¼æ¡¶ï¼ˆLeaky Bucketï¼‰é™æµç®—æ³•ï¼Œä»¤ç‰Œæ¡¶ï¼ˆToken Bucketï¼‰é™æµç®—æ³•ã€‚æˆ‘ä»¬å°†è¯¦ç»†è®¨è®ºè¿™å››ç§ç®—æ³•çš„å®ç°ã€‚</p><p>æ­¤å¤–ï¼Œé™æµå™¨è¿è¡ŒæœŸéœ€è¦é€šè¿‡é…ç½®æ–‡ä»¶è·å–å¯¹å“ªäº›URLè·¯å¾„è¿›è¡Œé™æµï¼›æœ¬åœ°é™æµè¿˜æ˜¯åˆ†å¸ƒå¼é™æµï¼›å¯¹ç”¨æˆ·é™æµè¿˜æ˜¯å¯¹è®¾å¤‡é™æµï¼Œè¿˜æ˜¯å¯¹æ‰€æœ‰è¯·æ±‚é™æµï¼›é™æµçš„é˜ˆå€¼æ˜¯å¤šå°‘ï¼›é˜ˆå€¼çš„æ—¶é—´å•ä½æ˜¯ä»€ä¹ˆï¼›å…·ä½“ä½¿ç”¨å“ªç§é™æµç®—æ³•ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å…ˆçœ‹ä¸‹é…ç½®æ–‡ä»¶çš„è®¾è®¡ã€‚</p><h4>é…ç½®æ–‡ä»¶è®¾è®¡</h4><p>Dianaé™æµå™¨ä½¿ç”¨YAMLè¿›è¡Œé…ç½®ï¼Œé…ç½®æ–‡ä»¶ä¸¾ä¾‹å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">Url:/\nrules:\n - actor:device\n   unit:second\n   rpu:10\n   algo:TB\n   scope:global\n - actor:all\n   unit:second\n   rpu:50\n   algo:W\n   scope:local\n</code></pre><p>é…ç½®æ–‡ä»¶çš„é…ç½®é¡¹æœ‰7ç§ï¼Œåˆ†åˆ«è¯´æ˜å¦‚ä¸‹ï¼š</p><ol>\n<li>Urlè®°å½•é™æµçš„èµ„æºåœ°å€ï¼Œ\"/â€œè¡¨ç¤ºæ‰€æœ‰è¯·æ±‚ï¼Œé…ç½®æ–‡ä»¶ä¸­çš„è·¯å¾„å¯ä»¥äº’ç›¸åŒ…å«ï¼Œæ¯”å¦‚â€œ/â€åŒ…å«â€œ/sampleâ€ï¼Œé™æµå™¨è¦å…ˆåŒ¹é…â€œ/â€çš„é™æµè§„åˆ™ï¼Œå¦‚æœâ€œ/â€çš„é™æµè§„åˆ™è¿˜æ²¡æœ‰è§¦å‘ï¼ˆå³è®¿é—®â€/\"çš„æµé‡ï¼Œä¹Ÿå°±æ˜¯å•ä½æ—¶é—´æ‰€æœ‰çš„è¯·æ±‚æ€»å’Œæ²¡æœ‰è¾¾åˆ°é™æµè§„åˆ™ï¼‰ï¼Œåˆ™å†åŒ¹é…â€œ/sampleâ€ã€‚</li>\n<li>æ¯ä¸ªUrlå¯ä»¥é…ç½®å¤šä¸ªè§„åˆ™rulesï¼Œæ¯ä¸ªè§„åˆ™åŒ…æ‹¬actorï¼Œunitï¼Œrpuï¼Œalgoï¼Œscope</li>\n<li>actorä¸ºé™æµå¯¹è±¡ï¼Œå¯ä»¥æ˜¯è´¦å·ï¼ˆactorï¼‰ï¼Œè®¾å¤‡ï¼ˆdeviceï¼‰ï¼Œå…¨éƒ¨ï¼ˆallï¼‰</li>\n<li>unitä¸ºé™æµæ—¶é—´å•ä½ï¼Œå¯ä»¥æ˜¯ç§’ï¼ˆsecondï¼‰ï¼Œåˆ†ï¼ˆminuteï¼‰ï¼Œæ—¶ï¼ˆhourï¼‰ï¼Œå¤©ï¼ˆdayï¼‰</li>\n<li>rpuä¸ºå•ä½æ—¶é—´é™æµè¯·æ±‚æ•°ï¼ˆrequest per unitï¼‰ï¼Œå³ä¸Šé¢unitå®šä¹‰çš„å•ä½æ—¶é—´å†…å…è®¸é€šè¿‡çš„è¯·æ±‚æ•°ç›®ï¼Œå¦‚unitä¸ºsecondï¼Œrpuä¸º100ï¼Œè¡¨ç¤ºæ¯ç§’å…è®¸é€šè¿‡100ä¸ªè¯·æ±‚ï¼Œæ¯ç§’è¶…è¿‡100ä¸ªè¯·æ±‚å°±è¿›è¡Œé™æµï¼Œè¿”å›503å“åº”</li>\n<li>scopeä¸ºrpuç”Ÿæ•ˆèŒƒå›´ï¼Œå¯ä»¥æ˜¯æœ¬åœ°ï¼ˆlocalï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¨å±€ï¼ˆglobalï¼‰ï¼Œscopeä¹Ÿå†³å®šäº†å•ä½æ—¶é—´è¯·æ±‚æ•°é‡æ˜¯è®°å½•åœ¨æœ¬åœ°è¿˜æ˜¯è¿œç¨‹ï¼Œlocalè®°å½•åœ¨æœ¬åœ°ï¼Œglobalè®°å½•åœ¨è¿œç¨‹ã€‚</li>\n<li>algoé™æµç®—æ³•ï¼Œå¯ä»¥æ˜¯windowï¼Œsliding windowï¼Œleaky bucketï¼Œtoken bucket ã€‚</li>\n</ol><p>Dianaæ”¯æŒé…ç½®4ç§é™æµç®—æ³•ï¼Œä½¿ç”¨è€…å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚åœºæ™¯ï¼Œä¸ºä¸åŒèµ„æºåœ°å€é…ç½®ä¸åŒçš„é™æµç®—æ³•ï¼Œä¸‹é¢è¯¦ç»†æè¿°è¿™å››ç§ç®—æ³•å®ç°ã€‚</p><h4><strong>å›ºå®šçª—å£ï¼ˆWindowï¼‰é™æµç®—æ³•</strong></h4><p>å›ºå®šçª—å£é™æµç®—æ³•å°±æ˜¯å°†é…ç½®æ–‡ä»¶ä¸­çš„æ—¶é—´å•ä½unitä½œä¸ºä¸€ä¸ªæ—¶é—´çª—å£ï¼Œæ¯ä¸ªçª—å£ä»…å…è®¸é™åˆ¶æµé‡å†…çš„è¯·æ±‚é€šè¿‡ï¼Œå¦‚å›¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/96/a3/9656050d518cca2825de965d180838a3.jpg?wh=1920x412\" alt=\"å›¾ç‰‡\"></p><p>æˆ‘ä»¬å°†æ—¶é—´è½´åˆ‡åˆ†æˆä¸€ä¸ªä¸€ä¸ªçš„é™æµçª—å£ï¼Œæ¯ä¸ªé™æµçª—å£æœ‰ä¸€ä¸ªçª—å£å¼€å§‹æ—¶é—´å’Œä¸€ä¸ªçª—å£ç»“æŸæ—¶é—´ï¼Œçª—å£å¼€å§‹æ—¶ï¼Œè®¡æ•°å™¨æ¸…é›¶ï¼Œæ¯è¿›å…¥ä¸€ä¸ªè¯·æ±‚ï¼Œè®¡æ•°å™¨å°±è®°å½•+1ã€‚å¦‚æœè¯·æ±‚æ•°ç›®è¶…è¿‡rpué…ç½®çš„é™æµè¯·æ±‚æ•°ï¼Œå°±æ‹’ç»æœåŠ¡ï¼Œè¿”å›503å“åº”ã€‚å½“å‰é™æµçª—å£ç»“æŸåï¼Œå°±è¿›å…¥ä¸‹ä¸ªé™æµçª—å£ï¼Œè®¡æ•°å™¨å†æ¬¡æ¸…é›¶ï¼Œé‡æ–°å¼€å§‹ã€‚å¤„ç†æµç¨‹æ´»åŠ¨å›¾å¦‚ä¸‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/cc/dd/cc5b503a196cd917d35464eb0e53bddd.jpg?wh=1920x1489\" alt=\"å›¾ç‰‡\"></p><p>ä¸Šå›¾åŒ…æ‹¬â€œåˆå§‹åŒ–â€å’Œâ€œå¤„ç†æµç¨‹â€ä¸¤ä¸ªæ³³é“ã€‚åˆå§‹åŒ–çš„æ—¶å€™ï¼Œè®¾ç½®â€œçª—å£è®¡æ•°å™¨â€å’Œâ€œå½“å‰çª—å£ç»“æŸæ—¶é—´â€ä¸¤ä¸ªå˜é‡ã€‚å¤„ç†è¯·æ±‚çš„æ—¶å€™ï¼Œåˆ¤æ–­å½“å‰æ—¶é—´æ˜¯å¦å¤§äºâ€œå½“å‰çª—å£ç»“æŸæ—¶é—´â€ï¼Œå¦‚æœå¤§äºï¼Œé‚£ä¹ˆé‡ç½®â€œçª—å£è®¡æ•°å™¨â€å’Œâ€œå½“å‰çª—å£ç»“æŸæ—¶é—´â€ä¸¤ä¸ªå˜é‡ï¼›å¦‚æœæ²¡æœ‰ï¼Œçª—å£è®¡æ•°å™¨+1ï¼Œå¹¶åˆ¤æ–­è®¡æ•°å™¨æ˜¯å¦å¤§äºé…ç½®çš„é™æµè¯·æ±‚æ•°rpuï¼Œæ ¹æ®ç»“æœå†³å®šæ˜¯å¦è¿›è¡Œé™æµã€‚</p><p>è¿™é‡Œçš„â€œçª—å£è®¡æ•°å™¨â€å¯ä»¥æœ¬åœ°è®°å½•ï¼Œä¹Ÿå¯ä»¥è¿œç¨‹è®°å½•ï¼Œä¹Ÿå°±æ˜¯é…ç½®ä¸­çš„localå’Œglobalã€‚å›ºå®šçª—å£ç®—æ³•åœ¨é…ç½®æ–‡ä»¶ä¸­algoé¡¹å¯é…ç½®â€œwindowâ€æˆ–è€…ç¼©å†™â€œWâ€ã€‚</p><p>å›ºå®šçª—å£å®ç°æ¯”è¾ƒå®¹æ˜“ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨è¿™ç§é™æµç®—æ³•ï¼Œåœ¨ä¸€ä¸ªé™æµæ—¶é—´å•ä½å†…ï¼Œé€šè¿‡çš„è¯·æ±‚æ•°å¯èƒ½æ˜¯rpuçš„ä¸¤å€ï¼Œæ— æ³•è¾¾åˆ°é™æµçš„ç›®çš„ï¼Œå¦‚ä¸‹å›¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/c7/c6/c7b2dae2c9b96dd775557295ba3680c6.jpg?wh=1920x412\" alt=\"å›¾ç‰‡\"></p><p>å‡è®¾å•ä½æ—¶é—´è¯·æ±‚é™æµæ•°rpuä¸º100ï¼Œåœ¨ç¬¬ä¸€ä¸ªé™æµçª—å£å¿«è¦åˆ°ç»“æŸæ—¶é—´çš„æ—¶å€™ï¼Œçªç„¶è¿›æ¥100ä¸ªè¯·æ±‚ï¼Œå› ä¸ºè¿™ä¸ªè¯·æ±‚é‡åœ¨é™æµèŒƒå›´å†…ï¼Œæ‰€ä»¥æ²¡æœ‰è§¦å‘é™æµï¼Œè¯·æ±‚å…¨éƒ¨é€šè¿‡ã€‚ç„¶åè¿›å…¥ç¬¬äºŒä¸ªé™æµçª—å£ï¼Œé™æµè®¡æ•°å™¨æ¸…é›¶ã€‚è¿™æ—¶åˆå¿½ç„¶è¿›å…¥100ä¸ªè¯·æ±‚ï¼Œå› ä¸ºå·²ç»è¿›å…¥ç¬¬äºŒä¸ªé™æµçª—å£ï¼Œæ‰€ä»¥ä¹Ÿæ²¡è§¦å‘é™æµã€‚åœ¨çŸ­æ—¶é—´å†…ï¼Œé€šè¿‡äº†200ä¸ªè¯·æ±‚ï¼Œè¿™æ ·å¯èƒ½ä¼šç»™ç³»ç»Ÿé€ æˆå·¨å¤§çš„è´Ÿè½½å‹åŠ›ã€‚</p><h4>æ»‘åŠ¨çª—å£ï¼ˆSliding Windowï¼‰é™æµç®—æ³•</h4><p>æ”¹è¿›å›ºå®šçª—å£ç¼ºé™·çš„æ–¹æ³•æ˜¯é‡‡ç”¨æ»‘åŠ¨çª—å£é™æµç®—æ³•ï¼Œå¦‚ä¸‹å›¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/12/cf/12d45534b212abf3cbfd764b85bd72cf.jpg?wh=1920x536\" alt=\"å›¾ç‰‡\"></p><p>æ»‘åŠ¨çª—å£å°±æ˜¯å°†é™æµçª—å£å†…éƒ¨åˆ‡åˆ†æˆä¸€äº›æ›´å°çš„æ—¶é—´ç‰‡ï¼Œç„¶ååœ¨æ—¶é—´è½´ä¸Šæ»‘åŠ¨ï¼Œæ¯æ¬¡æ»‘åŠ¨ï¼Œæ»‘è¿‡ä¸€ä¸ªå°æ—¶é—´ç‰‡ï¼Œå°±å½¢æˆä¸€ä¸ªæ–°çš„é™æµçª—å£ï¼Œå³æ»‘åŠ¨çª—å£ã€‚ç„¶ååœ¨è¿™ä¸ªæ»‘åŠ¨çª—å£å†…æ‰§è¡Œå›ºå®šçª—å£ç®—æ³•å³å¯ã€‚</p><p>æ»‘åŠ¨çª—å£å¯ä»¥é¿å…å›ºå®šçª—å£å‡ºç°çš„æ”¾è¿‡ä¸¤å€è¯·æ±‚çš„é—®é¢˜ï¼Œå› ä¸ºä¸€ä¸ªçŸ­æ—¶é—´å†…å‡ºç°çš„æ‰€æœ‰è¯·æ±‚å¿…ç„¶åœ¨ä¸€ä¸ªæ»‘åŠ¨çª—å£å†…ï¼Œæ‰€ä»¥ä¸€å®šä¼šè¢«æ»‘åŠ¨çª—å£é™æµã€‚</p><p>æ»‘åŠ¨çª—å£çš„ç®—æ³•å®ç°åŸºæœ¬å’Œå›ºå®šçª—å£ä¸€è‡´ï¼Œåªè¦æ”¹åŠ¨é‡ç½®â€œçª—å£è®¡æ•°å™¨â€å’Œâ€œå½“å‰çª—å£ç»“æŸæ—¶é—´â€çš„é€»è¾‘å°±å¯ä»¥ã€‚å›ºå®šçª—å£ç®—æ³•é‡ç½®ä¸ºçª—å£ç»“æŸæ—¶é—´+1 unit æ—¶é—´ï¼Œæ»‘åŠ¨çª—å£ç®—æ³•é‡ç½®ä¸ºçª—å£ç»“æŸæ—¶é—´+1ä¸ªæ—¶é—´ç‰‡ã€‚ä½†æ˜¯å›ºå®šçª—å£ç®—æ³•é‡ç½®åï¼Œçª—å£è®¡æ•°å™¨ä¸º0ï¼Œè€Œæ»‘åŠ¨çª—å£éœ€è¦å°†çª—å£è®¡æ•°å™¨è®¾ç½®ä¸ºå½“å‰çª—å£å·²ç»ç»è¿‡çš„æ—¶é—´ç‰‡çš„è¯·æ±‚æ€»æ•°ï¼Œæ¯”å¦‚ä¸Šå›¾é‡Œï¼Œä¸€ä¸ªæ»‘åŠ¨çª—å£è¢«åˆ†ä¸º5ä¸ªæ—¶é—´ç‰‡ï¼Œæ»‘åŠ¨çª—å£2çš„æµ…è“è‰²éƒ¨åˆ†å°±æ˜¯å·²ç»ç»è¿‡äº†4ä¸ªæ—¶é—´ç‰‡ã€‚</p><p>æ»‘åŠ¨çª—å£ç®—æ³•åœ¨é…ç½®æ–‡ä»¶ä¸­algoé¡¹å¯é…ç½®â€œsliding windowâ€æˆ–è€…ç¼©å†™â€œSWâ€ã€‚</p><h4>æ¼æ¡¶ï¼ˆLeaky Bucketï¼‰é™æµç®—æ³•</h4><p>æ¼æ¡¶é™æµç®—æ³•æ˜¯æ¨¡æ‹Ÿæ°´æµè¿‡ä¸€ä¸ªæœ‰æ¼æ´çš„æ¡¶è¿›è€Œé™æµçš„æ€è·¯ï¼Œå¦‚å›¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/d5/11/d5de3e408c2abc1ff15ee96a60439d11.jpg?wh=2000x654\" alt=\"\"></p><p>æ°´é¾™å¤´çš„æ°´å…ˆæµå…¥æ¼æ¡¶ï¼Œå†é€šè¿‡æ¼æ¡¶åº•éƒ¨çš„å­”æµå‡ºã€‚å¦‚æœæµå…¥çš„æ°´é‡å¤ªå¤§ï¼Œåº•éƒ¨çš„å­”æ¥ä¸åŠæµå‡ºï¼Œå°±ä¼šå¯¼è‡´æ°´æ¡¶å¤ªæ»¡æº¢å‡ºå»ã€‚</p><p>é™æµå™¨åˆ©ç”¨æ¼æ¡¶çš„è¿™ä¸ªåŸç†è®¾è®¡æ¼æ¡¶é™æµç®—æ³•ï¼Œç”¨æˆ·è¯·æ±‚å…ˆæµå…¥åˆ°ä¸€ä¸ªç‰¹å®šå¤§å°çš„æ¼æ¡¶ä¸­ï¼Œç³»ç»Ÿä»¥ç‰¹å®šçš„é€Ÿç‡ä»æ¼æ¡¶ä¸­è·å–è¯·æ±‚å¹¶å¤„ç†ã€‚å¦‚æœç”¨æˆ·è¯·æ±‚è¶…è¿‡é™æµï¼Œå°±ä¼šå¯¼è‡´æ¼æ¡¶è¢«è¯·æ±‚æ•°æ®å¡«æ»¡ï¼Œè¯·æ±‚æº¢å‡ºï¼Œè¿”å›503å“åº”ã€‚</p><p>æ‰€ä»¥æ¼æ¡¶ç®—æ³•ä¸ä»…å¯ä»¥é™æµï¼Œå½“æµé‡è¶…è¿‡é™åˆ¶çš„æ—¶å€™ä¼šæ‹’ç»å¤„ç†ï¼Œç›´æ¥è¿”å›503å“åº”ï¼Œè¿˜èƒ½æ§åˆ¶è¯·æ±‚çš„å¤„ç†é€Ÿåº¦ã€‚</p><p>å®è·µä¸­ï¼Œå¯ä»¥é‡‡ç”¨é˜Ÿåˆ—å½“åšæ¼æ¡¶ã€‚å¦‚å›¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/bb/16/bb8ca5effb1458600a7a43a622764a16.jpg?wh=1920x354\" alt=\"å›¾ç‰‡\"></p><p>æ„å»ºä¸€ä¸ªç‰¹å®šé•¿åº¦çš„é˜Ÿåˆ—queueä½œä¸ºæ¼æ¡¶ï¼Œå¼€å§‹çš„æ—¶å€™ï¼Œé˜Ÿåˆ—ä¸ºç©ºï¼Œç”¨æˆ·è¯·æ±‚åˆ°è¾¾åä»é˜Ÿåˆ—å°¾éƒ¨å†™å…¥é˜Ÿåˆ—ï¼Œè€Œåº”ç”¨ç¨‹åºä»é˜Ÿåˆ—å¤´éƒ¨ä»¥ç‰¹å®šé€Ÿç‡è¯»å–è¯·æ±‚ã€‚å½“è¯»å–é€Ÿåº¦ä½äºå†™å…¥é€Ÿåº¦çš„æ—¶å€™ï¼Œä¸€æ®µæ—¶é—´åï¼Œé˜Ÿåˆ—ä¼šè¢«å†™æ»¡ï¼Œè¿™æ—¶å€™å†™å…¥é˜Ÿåˆ—æ“ä½œå¤±è´¥ã€‚å†™å…¥å¤±è´¥çš„è¯·æ±‚ç›´æ¥æ„é€ 503å“åº”è¿”å›ã€‚</p><p>ä½†æ˜¯ä½¿ç”¨é˜Ÿåˆ—è¿™ç§æ–¹å¼ï¼Œå®é™…ä¸Šæ˜¯æŠŠè¯·æ±‚å¤„ç†å¼‚æ­¥åŒ–äº†ï¼ˆå†™å…¥è¯·æ±‚çš„çº¿ç¨‹å’Œè·å–è¯·æ±‚çš„çº¿ç¨‹ä¸æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ï¼‰ï¼Œå¹¶ä¸é€‚åˆæˆ‘ä»¬ç›®å‰åŒæ­¥ç½‘å…³çš„åœºæ™¯ï¼ˆå¦‚æœä½¿ç”¨å‰é¢è®¾è®¡è¿‡çš„Floweræ¡†æ¶å¼€å‘çš„å¼‚æ­¥ç½‘å…³å°±å¯ä»¥ç”¨è¿™ç§é˜Ÿåˆ—æ–¹å¼ï¼‰ã€‚</p><p>å› æ­¤Dianaå®ç°æ¼æ¡¶é™æµç®—æ³•å¹¶ä¸ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè€Œæ˜¯é˜»å¡ç­‰å¾…ã€‚æ ¹æ®é™æµé…ç½®æ–‡ä»¶è®¡ç®—æ¯ä¸ªè¯·æ±‚ä¹‹é—´çš„é—´éš”æ—¶é—´ï¼Œä¾‹å¦‚ï¼šé™æµæ¯ç§’10ä¸ªè¯·æ±‚ï¼Œé‚£ä¹ˆæ¯ä¸¤ä¸ªè¯·æ±‚çš„é—´éš”æ—¶é—´å°±å¿…é¡»&gt;=100msã€‚ç”¨æˆ·è¯·æ±‚åˆ°è¾¾é™æµå™¨åï¼Œæ ¹æ®å½“å‰æœ€è¿‘ä¸€ä¸ªè¯·æ±‚å¤„ç†çš„æ—¶é—´å’Œé˜»å¡çš„è¯·æ±‚çº¿ç¨‹æ•°ç›®ï¼Œè®¡ç®—å½“å‰è¯·æ±‚çº¿ç¨‹çš„sleepæ—¶é—´ã€‚æ¯ä¸ªè¯·æ±‚çº¿ç¨‹çš„sleepæ—¶é—´ä¸åŒï¼Œæœ€åå°±å¯ä»¥å®ç°æ¯éš”100mså”¤é†’ä¸€ä¸ªè¯·æ±‚çº¿ç¨‹å»å¤„ç†ï¼Œä»è€Œè¾¾åˆ°æ¼æ¡¶é™æµçš„æ•ˆæœã€‚</p><p>è®¡ç®—è¯·æ±‚çº¿ç¨‹sleepæ—¶é—´çš„ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-java\">åˆå§‹åŒ– :\né—´éš”æ—¶é—´ = 100ms;\né˜»å¡çº¿ç¨‹æ•° = 0;\næœ€è¿‘è¯·æ±‚å¤„ç†æ—¶é—´æˆ³  = 0ï¼›\n\nlong sleepæ—¶é—´(){\n  //æœ€è¿‘æ²¡æœ‰è¯·æ±‚ï¼Œä¸é˜»å¡\n  if((now - æœ€è¿‘è¯·æ±‚å¤„ç†æ—¶é—´æˆ³ï¼‰ &gt;= é—´éš”æ—¶é—´ and é˜»å¡çº¿ç¨‹æ•° &lt;= 0ï¼‰{\n    æœ€è¿‘è¯·æ±‚å¤„ç†æ—¶é—´æˆ³ = now;\n    return 0; //ä¸é˜»å¡\n  }\n  //æ’é˜Ÿè¯·æ±‚å¤ªå¤šï¼Œæ¼æ¡¶æº¢å‡º\n  if(é˜»å¡çº¿ç¨‹æ•° &gt; æœ€å¤§æº¢å‡ºçº¿ç¨‹æ•°) {\n    return MAX_TIME;//MAX_TIMEè¡¨ç¤ºé˜»å¡æ—¶é—´æ— ç©·å¤§ï¼Œå½“å‰è¯·æ±‚è¢«é™æµ\n  }\n  //è¯·æ±‚åœ¨æ’é˜Ÿï¼Œé˜»å¡ç­‰å¾…\n    é˜»å¡çº¿ç¨‹æ•°++;\n    return é—´éš”æ—¶é—´ * é˜»å¡çº¿ç¨‹æ•° - (now - æœ€è¿‘è¯·æ±‚å¤„ç†æ—¶é—´æˆ³) ;\n}\n</code></pre><p>è¯·æ±‚çº¿ç¨‹sleepæ—¶é—´ç»“æŸï¼Œç»§ç»­æ‰§è¡Œçš„æ—¶å€™ï¼Œä¿®æ”¹é˜»å¡çº¿ç¨‹æ•°ï¼š</p><pre><code class=\"language-plain\">æœ€è¿‘è¯·æ±‚å¤„ç†æ—¶é—´æˆ³ = now;\né˜»å¡çº¿ç¨‹æ•°--;\n</code></pre><p>æ³¨æ„ï¼Œä»¥ä¸Šä»£ç å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œéœ€è¦è¿›è¡ŒåŠ é”æ“ä½œã€‚</p><p>ä½¿ç”¨æ¼æ¡¶é™æµç®—æ³•ï¼Œå³ä½¿ç³»ç»Ÿèµ„æºå¾ˆç©ºé—²ï¼Œå¤šä¸ªè¯·æ±‚åŒæ—¶åˆ°è¾¾æ—¶ï¼Œæ¼æ¡¶ä¹Ÿæ˜¯æ…¢æ…¢åœ°ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°å»å¤„ç†è¯·æ±‚ï¼Œè¿™å…¶å®å¹¶ä¸ç¬¦åˆäººä»¬çš„æœŸæœ›ï¼Œå› ä¸ºè¿™æ ·å°±æ˜¯åœ¨æµªè´¹è®¡ç®—èµ„æºã€‚å› æ­¤é™¤éæœ‰ç‰¹åˆ«çš„åœºæ™¯éœ€æ±‚ï¼Œå¦åˆ™ä¸æ¨èä½¿ç”¨è¯¥ç®—æ³•ã€‚</p><p>æ¼æ¡¶ç®—æ³•çš„algoé…ç½®é¡¹åç§°ä¸ºâ€œleaky bucketâ€æˆ–è€…â€œLBâ€ã€‚</p><h4>ä»¤ç‰Œæ¡¶ï¼ˆToken Bucketï¼‰é™æµç®—æ³•</h4><p>ä»¤ç‰Œæ¡¶æ˜¯å¦ä¸€ç§æ¡¶é™æµç®—æ³•ï¼Œæ¨¡æ‹Ÿä¸€ä¸ªç‰¹å®šå¤§å°çš„æ¡¶ï¼Œç„¶åå‘æ¡¶ä¸­ä»¥ç‰¹å®šçš„é€Ÿåº¦æ”¾å…¥ä»¤ç‰Œï¼ˆtokenï¼‰ï¼Œè¯·æ±‚åˆ°è¾¾åï¼Œå¿…é¡»ä»æ¡¶ä¸­å–å‡ºä¸€ä¸ªä»¤ç‰Œæ‰èƒ½ç»§ç»­å¤„ç†ã€‚å¦‚æœæ¡¶ä¸­å·²ç»æ²¡æœ‰ä»¤ç‰Œäº†ï¼Œé‚£ä¹ˆå½“å‰è¯·æ±‚å°±è¢«é™æµï¼Œè¿”å›503å“åº”ã€‚å¦‚æœæ¡¶ä¸­çš„ä»¤ç‰Œæ”¾æ»¡äº†ï¼Œä»¤ç‰Œæ¡¶ä¹Ÿä¼šæº¢å‡ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/ee/a8/eede538f223553d706aa77b7340407a8.png?wh=892x536\" alt=\"å›¾ç‰‡\"></p><p>ä¸Šé¢çš„ç®—æ³•æè¿°ä¼¼ä¹éœ€è¦æœ‰ä¸€ä¸ªä¸“é—¨çº¿ç¨‹ç”Ÿæˆä»¤ç‰Œï¼Œè¿˜éœ€è¦ä¸€ä¸ªæ•°æ®ç»“æ„æ¨¡æ‹Ÿæ¡¶ã€‚å®é™…ä¸Šï¼Œä»¤ç‰Œæ¡¶çš„å®ç°ï¼Œåªéœ€è¦åœ¨è¯·æ±‚è·å–ä»¤ç‰Œçš„æ—¶å€™ï¼Œé€šè¿‡æ—¶é—´è®¡ç®—ï¼Œå°±å¯ä»¥ç®—å‡ºä»¤ç‰Œæ¡¶ä¸­çš„æ€»ä»¤ç‰Œæ•°ã€‚ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">åˆå§‹åŒ– :\næœ€è¿‘ç”Ÿæˆä»¤ç‰Œæ—¶é—´æˆ³ = 0ï¼›\næ€»ä»¤ç‰Œæ•° = 0ï¼›\nä»¤ç‰Œç”Ÿæˆæ—¶é—´é—´éš” = 100ms;\n\nboolean è·å–ä»¤ç‰Œ(){\n  //ä»¤ç‰Œæ¡¶ä¸­æœ‰ä»¤ç‰Œï¼Œç›´æ¥å–ä»¤ç‰Œå³å¯\n  if(æ€»ä»¤ç‰Œæ•° &gt;= 1){\n    æ€»ä»¤ç‰Œæ•°--ï¼›\n    return true;\n  }\n  //ä»¤ç‰Œæ¡¶ä¸­æ²¡æœ‰ä»¤ç‰Œäº†ï¼Œé‡ç®—ç°åœ¨ä»¤ç‰Œæ¡¶ä¸­çš„æ€»ä»¤ç‰Œæ•°ï¼Œå¯èƒ½ç®—å‡ºçš„æ€»ä»¤ç‰Œæ•°ä¾ç„¶ä¸º0\n  æ€»ä»¤ç‰Œæ•° = min(ä»¤ç‰Œæ•°ä¸Šé™å€¼ï¼Œæ€»ä»¤ç‰Œæ•° + \n  (now - æœ€è¿‘ç”Ÿæˆä»¤ç‰Œæ—¶é—´æˆ³) / ä»¤ç‰Œç”Ÿæˆæ—¶é—´é—´éš”)ï¼›\n  if(æ€»ä»¤ç‰Œæ•° &gt;= 1){\n    æ€»ä»¤ç‰Œæ•°--ï¼›\n    æœ€è¿‘ç”Ÿæˆä»¤ç‰Œæ—¶é—´æˆ³ = nowï¼›//æœ‰ä»¤ç‰Œäº†ï¼Œæ‰èƒ½é‡è®¾æ—¶é—´\n    return trueï¼›\n  }\n  return falseï¼›\n}\n</code></pre><p>ä»¤ç‰Œæ¡¶é™æµç®—æ³•ç»¼åˆæ•ˆæœæ¯”è¾ƒå¥½ï¼Œèƒ½åœ¨æœ€å¤§ç¨‹åº¦åˆ©ç”¨ç³»ç»Ÿèµ„æºå¤„ç†è¯·æ±‚çš„åŸºç¡€ä¸Šï¼Œå®ç°é™æµçš„ç›®æ ‡ï¼Œå»ºè®®é€šå¸¸åœºæ™¯ä¸­ä¼˜å…ˆä½¿ç”¨è¯¥ç®—æ³•ï¼ŒDianaçš„ç¼ºçœé…ç½®ç®—æ³•ä¹Ÿæ˜¯ä»¤ç‰Œæ¡¶ã€‚ä»¤ç‰Œæ¡¶ç®—æ³•çš„algoé…ç½®é¡¹åç§°ä¸ºâ€œtoken bucketâ€æˆ–â€œTBâ€ã€‚</p><h2>å°ç»“</h2><p>é™æµå™¨æ˜¯ä¸€ä¸ªå…¸å‹çš„æŠ€æœ¯ä¸­é—´ä»¶ï¼Œä½¿ç”¨è€…æ˜¯åº”ç”¨ç³»ç»Ÿå¼€å‘å·¥ç¨‹å¸ˆï¼Œä»–ä»¬åœ¨è‡ªå·±çš„åº”ç”¨ç³»ç»Ÿä¸­ä½¿ç”¨é™æµå™¨ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶æ¥å®ç°æ»¡è¶³è‡ªå·±ä¸šåŠ¡åœºæ™¯çš„é™æµéœ€æ±‚ã€‚è¿™é‡Œéšå«äº†ä¸€ä¸ªé—®é¢˜ï¼šå¤§å®¶éƒ½æ˜¯å¼€å‘è€…ï¼Œè¿™äº›åº”ç”¨ç³»ç»Ÿå¼€å‘å·¥ç¨‹å¸ˆä¸ºä»€ä¹ˆè¦ç”¨ä½ å¼€å‘çš„ä¸­é—´ä»¶ï¼Ÿäº‹å®ä¸Šï¼ŒæŠ€æœ¯ä¸­é—´ä»¶å¤©ç„¶ä¼šå—åˆ°æ›´å¤šçš„æŒ‘å‰”ï¼Œæ¶æ„å¸ˆåœ¨è®¾è®¡æŠ€æœ¯ç»„ä»¶çš„æ—¶å€™è¦æ ¼å¤–è€ƒè™‘<strong>æ˜“ç”¨æ€§å’Œæ‰©å±•æ€§</strong>ï¼Œå¼€å‘å‡ºæ¥çš„æŠ€æœ¯ä¸­é—´ä»¶è¦èƒ½ç»å¾—èµ·åŒè¡Œçš„å®¡è§†å’ŒæŒ‘æˆ˜ã€‚</p><p>è¿™ç¯‡è®¾è®¡æ–‡æ¡£ä¸­ï¼ŒåŒ…å«äº†å¾ˆå¤šä¼ªä»£ç ï¼Œè¿™äº›ä¼ªä»£ç æ˜¯é™æµç®—æ³•å®ç°çš„æ ¸å¿ƒé€»è¾‘ã€‚æ¶æ„å¸ˆä¸€æ–¹é¢éœ€è¦æ€è€ƒå®è§‚çš„æŠ€æœ¯å†³ç­–ï¼Œä¸€æ–¹é¢è¦æ€è€ƒå¾®è§‚çš„æ ¸å¿ƒä»£ç ã€‚è¿™é‡Œä¸¤æ–¹é¢çš„èƒ½åŠ›æ”¯æ’‘èµ·æ¶æ„å¸ˆçš„æŠ€æœ¯å½±å“åŠ›ï¼Œæ—¢è¦èƒ½ä¸Šå¾—å…å ‚ï¼Œåœ¨è€æ¿ã€å®¢æˆ·ç­‰å¤–éƒ¨ç›¸å…³æ–¹é¢å‰ä¾ƒä¾ƒè€Œè°ˆï¼Œä¿éšœè‡ªå·±å’Œå›¢é˜Ÿèƒ½æŒæ§è‡ªå·±çš„æŠ€æœ¯æ–¹å‘ï¼›ä¹Ÿè¦èƒ½ä¸‹å¾—å¨æˆ¿ï¼Œæå®šæœ€æœ‰éš¾åº¦çš„ä»£ç å®ç°ï¼Œè®©å›¢é˜Ÿæˆå‘˜ç›¸ä¿¡è·Ÿç€ä½ æ··ï¼Œæ²¡æœ‰è¿ˆä¸è¿‡å»çš„æŠ€æœ¯åã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æ»‘åŠ¨çª—å£ç®—æ³•ä¸­ï¼Œå¦‚ä½•ç®¡ç†æ—¶é—´ç‰‡ï¼Œä»¥åŠå¦‚ä½•è®¡ç®—æ»‘åŠ¨è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªçª—å£å†…å„ä¸ªæ—¶é—´ç‰‡çš„çª—å£è®¡æ•°å™¨ä¹‹å’Œï¼Ÿç”¨ä»€ä¹ˆæ ·çš„æ•°æ®ç»“æ„å’Œç®—æ³•æ¯”è¾ƒåˆé€‚ï¼Ÿ</p><p>æ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„æ€è€ƒï¼Œæˆ‘ä»¬å…±åŒè¿›æ­¥ã€‚</p>","comments":[{"had_liked":false,"id":339637,"user_name":"javaadu","can_delete":false,"product_type":"c1","uid":1000519,"ip_address":"","ucode":"8C0B140F1C8992","user_header":"https://static001.geekbang.org/account/avatar/00/0f/44/47/3ddb94d0.jpg","comment_is_top":false,"comment_ctime":1648264052,"is_pvip":true,"replies":[{"id":"124211","content":"éå¸¸èµ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1007349","ctime":1648433341,"ip_address":"","comment_id":339637,"utype":1}],"discussion_count":1,"race_medal":0,"score":"31713035124","product_id":100105701,"comment_content":"ï¼ˆ1ï¼‰ä½¿ç”¨é˜Ÿåˆ—ç®¡ç†æ—¶é—´ç‰‡ï¼Œæ¯æ¬¡çª—å£ç§»åŠ¨å°±æ˜¯ä¸€ä¸ªå‡ºé˜Ÿå’Œå…¥é˜Ÿæ“ä½œ<br><br>ï¼ˆ2ï¼‰ä½¿ç”¨hashmapç®¡ç†å„ä¸ªæ—¶é—´ç‰‡çš„è®¡æ•°å™¨keyï¼Œå¦‚æœæ˜¯æœ¬åœ°æ¨¡å¼åˆ™valueå­˜åœ¨å†…å­˜ä¸­ï¼Œå¦‚æœæ˜¯åˆ†å¸ƒå¼æ¨¡å¼åˆ™valueå­˜æ”¾åœ¨redisä¸­","like_count":7,"discussions":[{"author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558665,"discussion_content":"éå¸¸èµ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648433341,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":339464,"user_name":"Geek_7347cf","can_delete":false,"product_type":"c1","uid":2343516,"ip_address":"","ucode":"2E25574FAB1B3B","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/mmTEibMibic5ibsVpNZkR3HBlpPpZYt0gHGdIqOduLGxRHZpTWRG3q56CT1eejoLgNsdaW5aQGWXfyibN4vm9CicYb3w/132","comment_is_top":false,"comment_ctime":1648114243,"is_pvip":false,"replies":[{"id":"124203","content":"å¾ˆèµ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1007349","ctime":1648432652,"ip_address":"","comment_id":339464,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23122950723","product_id":100105701,"comment_content":"ä¸ªäººè§‰å¾—å¯ä»¥ä½¿ç”¨redisçš„çš„hash  é€šè¿‡ å¯¹æ—¶é—´è¿›è¡Œå–æ¨¡åˆ†ç‰‡","like_count":5,"discussions":[{"author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558656,"discussion_content":"å¾ˆèµ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648432652,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":339345,"user_name":"å‘¨æ–‡ç«¥","can_delete":false,"product_type":"c1","uid":1005411,"ip_address":"","ucode":"0C65A0A67229FA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/63/be6db73e.jpg","comment_is_top":false,"comment_ctime":1648040964,"is_pvip":true,"replies":[{"id":"124202","content":"å¾ˆèµã€‚ç›¸å½“äºç”¨æ—¶é—´æˆ³è®¡ç®—Hashå€¼ï¼Œkeyå°±æ˜¯æ—¶é—´ç‰‡ï¼Œæ‰€ä»¥å…¶å®ä¸ç”¨éå†æ•°ç»„ï¼Œå–æ¨¡å°±å¾—åˆ°æ•°ç»„ä¸‹æ ‡ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1007349","ctime":1648432577,"ip_address":"","comment_id":339345,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14532942852","product_id":100105701,"comment_content":"Sentinel æ˜¯ç”¨ Atomic çš„ Array å­˜å‚¨ï¼Œæ¯ä¸ªæ•°ç»„å…ƒç´ ä¸ºä¸€ä¸ª bucketï¼Œå­˜å‚¨çš„æ—¶å€™ç”¨æ—¶é—´æˆ³å’Œæ•°ç»„çš„ length å–æ¨¡ã€‚ç®—ç´¯è®¡æ—¶é—´å°±åªéœ€è¦éå†æ•°ç»„ï¼Œç®—æ¯ä¸€ä¸ª bucket é‡Œé¢çš„æ—¶é—´æˆ³å’Œå½“å‰æ—¶é—´æˆ³æ˜¯å¦åœ¨ä¸€ä¸ªæ—¶é—´é™åˆ¶é‡Œé¢ã€‚","like_count":3,"discussions":[{"author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558655,"discussion_content":"å¾ˆèµã€‚ç›¸å½“äºç”¨æ—¶é—´æˆ³è®¡ç®—Hashå€¼ï¼Œkeyå°±æ˜¯æ—¶é—´ç‰‡ï¼Œæ‰€ä»¥å…¶å®ä¸ç”¨éå†æ•°ç»„ï¼Œå–æ¨¡å°±å¾—åˆ°æ•°ç»„ä¸‹æ ‡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648432577,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345905,"user_name":"ç¾¤ä¹¦","can_delete":false,"product_type":"c1","uid":1437036,"ip_address":"","ucode":"BA9EE71D2D818A","user_header":"https://static001.geekbang.org/account/avatar/00/15/ed/6c/6fb35017.jpg","comment_is_top":false,"comment_ctime":1652690554,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"5947657850","product_id":100105701,"comment_content":"åœ¨ä»¤ç‰Œæ¡¶ç®—æ³•ä¸­ï¼Œè®¡ç®—ä»¤ç‰Œçš„æ–¹æ³•å¦‚ä¸‹ï¼š<br>æ€»ä»¤ç‰Œæ•° = min(ä»¤ç‰Œæ•°ä¸Šé™å€¼ï¼Œæ€»ä»¤ç‰Œæ•° +   (now - æœ€è¿‘ç”Ÿæˆä»¤ç‰Œæ—¶é—´æˆ³) &#47; ä»¤ç‰Œç”Ÿæˆæ—¶é—´é—´éš”)ï¼›<br>ä¸ºä½•è¦ â€œæ€»ä»¤ç‰Œæ•° +   (now - æœ€è¿‘ç”Ÿæˆä»¤ç‰Œæ—¶é—´æˆ³) &#47; ä»¤ç‰Œç”Ÿæˆæ—¶é—´é—´éš”â€ ï¼Œæ€»ä»¤ç‰Œæ•°ä¸æ˜¯ä¸ºé›¶å—ï¼Ÿéœ€è¦åŠ ä¸Š â€œæ€»ä»¤ç‰Œæ•°â€å—","like_count":1,"discussions":[{"author":{"id":2804063,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/c9/5f/db8073d3.jpg","nickname":"ball","note":"","ucode":"C20917ACD5F006","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584160,"discussion_content":"éœ€è¦ï¼Œæ€»ä»¤ç‰Œæ•°å°±æ˜¯ä¸Šä¸€è½®ç”Ÿæˆè¿‡ç¨‹ä¸­å‰©ä¸‹çš„è¿˜æœªæ¶ˆè€—çš„ä»¤ç‰Œæ•°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660647887,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":340990,"user_name":"é£ŸæŒ‡å¯çˆ±å¤š","can_delete":false,"product_type":"c1","uid":1045721,"ip_address":"","ucode":"B918E07F55AB9E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f4/d9/e572ae4d.jpg","comment_is_top":false,"comment_ctime":1649256247,"is_pvip":true,"replies":[{"id":"124666","content":"èµ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1007349","ctime":1649295611,"ip_address":"","comment_id":340990,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5944223543","product_id":100105701,"comment_content":"æˆ‘ä¹‹å‰åšè¿‡ä¸€ä¸ªåˆ†å¸ƒå¼é™æµç»„å»ºï¼Œå°±æ˜¯ç”¨ä»¤ç‰Œæ¡¶ç®—æ³•ã€‚redisåšå­˜å‚¨ï¼Œè„šæœ¬é€»è¾‘ç”¨luaè„šæœ¬å®ç°ï¼Œç®—æ³•é€»è¾‘å‚è€ƒGoogle Guavaä¸­çš„å®ç°ã€‚","like_count":1,"discussions":[{"author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560349,"discussion_content":"èµ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649295611,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":339209,"user_name":"ğŸ‘½","can_delete":false,"product_type":"c1","uid":1274117,"ip_address":"","ucode":"D313AF941B412D","user_header":"https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg","comment_is_top":false,"comment_ctime":1647995151,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5942962447","product_id":100105701,"comment_content":"æˆ‘å¯èƒ½ä¼šä½¿ç”¨å®šé•¿é˜Ÿåˆ—å­˜å‚¨æ¯ä¸€ä¸ªæ—¶é—´çª—ã€‚æ—¶é—´çª—åªç»Ÿè®¡æœ€è¿‘çš„è‹¥å¹²ä¸ªï¼Œç¬¦åˆå…ˆè¿›å…ˆå‡ºçš„è¦æ±‚ã€‚é¢å¤–ç”¨ä¸€ä¸ªå˜é‡å­˜å‚¨æ€»è®¡æ•°å™¨ã€‚<br><br>æ–°çš„è¯·æ±‚è¿›æ¥ï¼Œå¦‚æœæ²¡æœ‰åˆ‡æ¢æ–°çš„æ—¶é—´çª—ï¼Œå°†æœ€åçš„æ—¶é—´çª—è®¡æ•°å™¨+1ã€‚å¦‚æœæ¶‰åŠæ—¶é—´çª—åˆ‡æ¢ï¼Œåˆ™éœ€è¦å…ˆåšå‡ºé˜Ÿæ“ä½œã€‚å¹¶ä¸”æ€»è®¡æ•°å™¨æ‰£é™¤å‡ºé˜Ÿçš„æ—¶é—´çª—è®¡æ•°å™¨ã€‚ç„¶åå…¥é˜Ÿæ–°çš„æ—¶é—´çª—ï¼Œæ—¶é—´çª—è®¡æ•°å™¨ä¸º1<br><br>å¦‚æœï¼Œä¸­é—´è¯·æ±‚é—´éš”è¿‡é•¿ï¼Œæ¶‰åŠè·³æ—¶é—´çª—ï¼Œåˆ™æ ¹æ®å®é™…æƒ…å†µï¼Œå…¥é˜Ÿè‹¥å¹²ä¸ª0æ—¶é—´çª—è¿›è¡Œå¡«å……ã€‚","like_count":1,"discussions":[{"author":{"id":1242401,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f5/21/17814610.jpg","nickname":"å±±ä¸œå“¥å“¥å¸…","note":"","ucode":"6BBEA84359262F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576434,"discussion_content":"ä½¿ç”¨é˜Ÿåˆ—å®ç°æ»‘åŠ¨çª—å£ï¼Œè¿™ä¸ªé™æµæ˜¯ç»å¯¹çš„å¹³ç¨³","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655544934,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2911084,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/6b/6c/3e80afaf.jpg","nickname":"HappyHasson","note":"","ucode":"B84CC43E349CFA","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558219,"discussion_content":"æˆ‘ä»¬ç”Ÿäº§ç¯å¢ƒç”¨äº†è¿™ç§å®ç°ç®—æ³•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648136972,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360955,"user_name":"ITå°æ‘","can_delete":false,"product_type":"c1","uid":1330357,"ip_address":"åŒ—äº¬","ucode":"BDFEE0D821CB6E","user_header":"https://static001.geekbang.org/account/avatar/00/14/4c/b5/fcede1a9.jpg","comment_is_top":false,"comment_ctime":1667032752,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1667032752","product_id":100105701,"comment_content":"å…¬å¸ç”¨çš„ï¼Œå°±æ˜¯ä»¤ç‰Œæ¡¶ç®—æ³•","like_count":0},{"had_liked":false,"id":357961,"user_name":"Jav","can_delete":false,"product_type":"c1","uid":2846808,"ip_address":"åŒ—äº¬","ucode":"2562623ADD4BC1","user_header":"https://static001.geekbang.org/account/avatar/00/2b/70/58/69e4ae1c.jpg","comment_is_top":false,"comment_ctime":1663774997,"is_pvip":false,"replies":[{"id":"130717","content":"å…¨å±€é™æµé€šå¸¸æ˜¯éœ€è¦è¿›è¡Œå°æµé‡ã€ç²¾ç¡®é™æµçš„åœºæ™¯ï¼Œæ¯”å¦‚ç§’æ€å•†å“ï¼Œæ§åˆ¶è®¿é—®é‡ä¸è¦è¶…è¿‡å•†å“æ•°é‡å¤ªå¤šï¼Œè¿™ç±»åœºæ™¯çš„rpué€šå¸¸ä¸ä¼šå¾ˆå¤§ã€‚10ä¸‡çº§rpuçš„é™æµå»ºè®®å°±ä¸è¦å…¨å±€é™æµäº†ï¼Œæ„ä¹‰ä¸å¤§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1007349","ctime":1665540729,"ip_address":"åŒ—äº¬","comment_id":357961,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1663774997","product_id":100105701,"comment_content":"Rediså•æœº10wå•Šï¼Œç”¨redisä½œä¸ºé™æµå™¨æœ‰ç“¶é¢ˆï¼Œæœ‰æ²¡æœ‰æ–¹æ¡ˆå¯ä»¥è§£å†³è¿™ä¸ªæ€§èƒ½ç“¶é¢ˆçš„ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590110,"discussion_content":"å…¨å±€é™æµé€šå¸¸æ˜¯éœ€è¦è¿›è¡Œå°æµé‡ã€ç²¾ç¡®é™æµçš„åœºæ™¯ï¼Œæ¯”å¦‚ç§’æ€å•†å“ï¼Œæ§åˆ¶è®¿é—®é‡ä¸è¦è¶…è¿‡å•†å“æ•°é‡å¤ªå¤šï¼Œè¿™ç±»åœºæ™¯çš„rpué€šå¸¸ä¸ä¼šå¾ˆå¤§ã€‚10ä¸‡çº§rpuçš„é™æµå»ºè®®å°±ä¸è¦å…¨å±€é™æµäº†ï¼Œæ„ä¹‰ä¸å¤§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665540729,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345775,"user_name":"Logan","can_delete":false,"product_type":"c1","uid":2727984,"ip_address":"","ucode":"D812A9F8A53E5B","user_header":"https://static001.geekbang.org/account/avatar/00/29/a0/30/b53fb2ee.jpg","comment_is_top":false,"comment_ctime":1652588639,"is_pvip":false,"replies":[{"id":"126221","content":"æ˜¯çš„ï¼Œä¼šå½±å“æ€§èƒ½ï¼Œæ‰€ä»¥å…¨å±€é™æµå™¨åº”è¯¥åº”ç”¨åœ¨éœ€è¦ç²¾ç¡®æ§åˆ¶è®¿é—®é‡çš„æ¥å£ä¸Šï¼Œè¿™ç§æ¥å£çš„å¹¶å‘é‡é€šå¸¸ä¸ä¼šå¤ªé«˜ã€‚<br><br>redisçš„æ­£å¸¸è€—æ—¶åº”è¯¥åœ¨1~2msï¼Œä½ çš„é¡¹ç›®ä¸­è€—æ—¶ä¼¼ä¹æœ‰ç‚¹åé«˜äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1007349","ctime":1652682675,"ip_address":"","comment_id":345775,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1652588639","product_id":100105701,"comment_content":"å…³äºåˆ†å¸ƒå¼é™æµï¼Œå¦‚æœæ¯ä¸ªè¯·æ±‚è¿‡æ¥ï¼Œéƒ½å’ŒRedisè¿›è¡Œäº¤äº’ï¼Œå²‚ä¸æ˜¯ä¼šå½±å“æ¥å£è€—æ—¶ï¼Ÿ<br>ç›®å‰é¡¹ç›®ä¸­å’ŒRedisäº¤äº’çš„è€—æ—¶å¤§çº¦éœ€è¦5~10ms","like_count":0,"discussions":[{"author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572259,"discussion_content":"æ˜¯çš„ï¼Œä¼šå½±å“æ€§èƒ½ï¼Œæ‰€ä»¥å…¨å±€é™æµå™¨åº”è¯¥åº”ç”¨åœ¨éœ€è¦ç²¾ç¡®æ§åˆ¶è®¿é—®é‡çš„æ¥å£ä¸Šï¼Œè¿™ç§æ¥å£çš„å¹¶å‘é‡é€šå¸¸ä¸ä¼šå¤ªé«˜ã€‚\n\nredisçš„æ­£å¸¸è€—æ—¶åº”è¯¥åœ¨1~2msï¼Œä½ çš„é¡¹ç›®ä¸­è€—æ—¶ä¼¼ä¹æœ‰ç‚¹åé«˜äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652682675,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345045,"user_name":"test","can_delete":false,"product_type":"c1","uid":1065849,"ip_address":"","ucode":"9A4973E591DD12","user_header":"https://static001.geekbang.org/account/avatar/00/10/43/79/18073134.jpg","comment_is_top":false,"comment_ctime":1651979378,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1651979378","product_id":100105701,"comment_content":"å›ºå®šæ—¶é—´çª—å£ï¼šæŠŠæ—¶é—´è½´åˆ’åˆ†ä¸ºå›ºå®šé•¿åº¦æ—¶é—´çš„åˆ†æ®µï¼Œå†…å­˜é‡Œé¢å­˜å‚¨å½“å‰æ—¶é—´ç‰‡çš„å¼€å§‹æ—¶é—´ã€ç»“æŸæ—¶é—´å’Œå·²ç»å¤„ç†çš„è¯·æ±‚æ•°é‡ï¼Œè¯·æ±‚è¿‡æ¥çš„æ—¶å€™æŸ¥çœ‹æ˜¯å¦åœ¨å­˜å‚¨çš„æ—¶é—´ç‰‡å†…ï¼Œæ˜¯åˆ™è¯·æ±‚æ•°é‡+1çœ‹æ˜¯å¦è¶…è¿‡ï¼Œå¦åˆ™é‡ç½®å­˜å‚¨ï¼›<br>æ»‘åŠ¨çª—å£ï¼šæŠŠå›ºå®šçª—å£æ—¶é—´è½´å†åˆ†ä¸ºnæ®µï¼Œè¯·æ±‚è¿‡æ¥çš„æ—¶å€™æŸ¥çœ‹å½“å‰å°æ®µ ~ å¾€å‰æ¨næ®µçš„æ—¶é—´å†…çš„è¯·æ±‚æ•°æ˜¯å¦å·²ç»è¶…è¿‡é™æµ<br>æ¼æ¡¶ï¼šè¯·æ±‚å¿…é¡»åŒ€é€Ÿæ”¾è¡Œï¼Œå¼‚æ­¥çš„æ–¹æ³•é€šå¸¸ç”¨é˜Ÿåˆ—ï¼Œæ¶ˆè´¹ç«¯å–å¾—è¯·æ±‚ååŒ€é€Ÿçš„å¤„ç†ã€‚åŒæ­¥çš„æ–¹å¼é€šå¸¸æ˜¯sleepåˆ°è·Ÿä¸Šä¸ªè¯·æ±‚çš„æ—¶é—´é—´éš”è¾¾åˆ°é¢„æœŸåæ”¾è¡Œï¼ˆå³ä½¿å¤„ç†èµ„æºå¾ˆç©ºé—²ï¼Œå¤šä¸ªè¯·æ±‚åˆ°æ¥æ—¶ä¹Ÿæ˜¯åŒ€é€Ÿå¤„ç†ï¼Œæ‰€ä»¥å°‘ç”¨ï¼‰<br>ä»¤ç‰Œæ¡¶ï¼šæ± å­é‡Œæœ‰ä¸€å®šçš„ä»¤ç‰Œï¼Œè¯·æ±‚åˆ°è¾¾åè·å¾—ä»¤ç‰Œå³å¯æ”¾è¡Œã€‚å†…å­˜é‡Œä¿å­˜ç”Ÿæˆä»¤ç‰Œçš„æ—¶é—´ä»¥åŠç”Ÿæˆæ•°ï¼Œè¯·æ±‚åˆ°è¾¾æ—¶å¦‚æœæ²¡æœ‰ä»¤ç‰Œï¼Œåˆ™é‡æ–°ç”Ÿæˆä»¤ç‰Œã€‚","like_count":0},{"had_liked":false,"id":344500,"user_name":"gesanri","can_delete":false,"product_type":"c1","uid":1121174,"ip_address":"","ucode":"AE3B97DC3ED668","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELtOO0HKrj5SI5JSlmwiaCvaF6GLiaTmf5NX88OZaO3HymTAGTeIoicBUjqzmMF6sF5raPFjuqLFibrrw/132","comment_is_top":false,"comment_ctime":1651587790,"is_pvip":false,"replies":[{"id":"125786","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1007349","ctime":1651720441,"ip_address":"","comment_id":344500,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1651587790","product_id":100105701,"comment_content":"è¿™ä¸ªæ¼æ¡¶ç®—æ³•çš„ä¼ªä»£ç ï¼Œçœ‹æ„æ€æ˜¯å‡è®¾1ç§’é™åˆ¶10ä¸ªè¯·æ±‚ï¼Œå‡è®¾ç¬¬ä¸€ä¸ªè¯·æ±‚åœ¨2msçš„æ—¶å€™æ¥äº†å¹¶ä¸”å½“æ—¶å°±å¤„ç†å®Œäº†ï¼Œå®Œåç¬¬äºŒä¸ªè¯·æ±‚åœ¨5msçš„æ—¶å€™æ¥äº†ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªè¯·æ±‚ä¹Ÿå¿…é¡»ç­‰åˆ°102msçš„æ—¶å€™æ‰èƒ½è¢«å¤„ç†ï¼Œæ˜¯è¿™æ ·å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":570266,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651720441,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":343431,"user_name":"å¼€å¿ƒå°æ¯›","can_delete":false,"product_type":"c1","uid":1023762,"ip_address":"","ucode":"9D57A2773759F3","user_header":"","comment_is_top":false,"comment_ctime":1650850945,"is_pvip":false,"replies":[{"id":"125388","content":"æ¼æ¡¶å’Œä»¤ç‰Œæ¡¶åœ¨æ˜¯å¦ä¸¥æ ¼æ§åˆ¶æ¯ç§’è¯·æ±‚ä¸Šé™ä¸Šæ²¡åŒºåˆ«å•Šï¼ŒåŒºåˆ«å°±æ˜¯åœ¨äºé€‚ç”¨åœºæ™¯ä¸åŒï¼Œæ¯”å¦‚ä¸€ä¸ªè®¡ç®—å¯†é›†å‹çš„åº”ç”¨åœ¨ä¸€ä¸ªå•CPUè®¡ç®—æœºä¸Šè¿è¡Œï¼Œæ¯ä¸ªè¯·æ±‚éœ€è¦è¿ç®—10msï¼Œé‚£ä¹ˆæ˜¾ç„¶è®¾ç½®rpuä¸º100çš„æ¼æ¡¶æ¯”ä»¤ç‰Œæ¡¶æ›´å¥½ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1007349","ctime":1650855877,"ip_address":"","comment_id":343431,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1650850945","product_id":100105701,"comment_content":"æƒ³è¯·æ•™æè€å¸ˆä¸€ä¸ªé€‰ç”¨é™æµç­–ç•¥çš„é—®é¢˜ï¼šå¦‚æœä¸è¿½æ±‚ä¸¥æ ¼çš„æ¯ç§’è¯·æ±‚ä¸Šé™ï¼Œåˆ°åº•å­˜ä¸å­˜åœ¨ä¸€ç§åº”ç”¨åœºæ™¯æ˜¯åªèƒ½ç”¨æ¼æ¡¶è€Œä¸èƒ½ç”¨ä»¤ç‰Œæ¡¶çš„å‘¢ï¼Ÿå¦‚æœä¸è¿½æ±‚ä¸¥æ ¼çš„æ¯ç§’è¯·æ±‚ä¸Šé™ï¼Œå­˜ä¸å­˜åœ¨ä¸€ç§åº”ç”¨åœºæ™¯æ¼æ¡¶ç­–ç•¥ä¼šä¼˜äºä»¤ç‰Œæ¡¶ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":567190,"discussion_content":"æ¼æ¡¶å’Œä»¤ç‰Œæ¡¶åœ¨æ˜¯å¦ä¸¥æ ¼æ§åˆ¶æ¯ç§’è¯·æ±‚ä¸Šé™ä¸Šæ²¡åŒºåˆ«å•Šï¼ŒåŒºåˆ«å°±æ˜¯åœ¨äºé€‚ç”¨åœºæ™¯ä¸åŒï¼Œæ¯”å¦‚ä¸€ä¸ªè®¡ç®—å¯†é›†å‹çš„åº”ç”¨åœ¨ä¸€ä¸ªå•CPUè®¡ç®—æœºä¸Šè¿è¡Œï¼Œæ¯ä¸ªè¯·æ±‚éœ€è¦è¿ç®—10msï¼Œé‚£ä¹ˆæ˜¾ç„¶è®¾ç½®rpuä¸º100çš„æ¼æ¡¶æ¯”ä»¤ç‰Œæ¡¶æ›´å¥½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650855877,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1023762,"avatar":"","nickname":"å¼€å¿ƒå°æ¯›","note":"","ucode":"9D57A2773759F3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":567210,"discussion_content":"åœ¨è€å¸ˆçš„ä¾‹å­ä¸­ï¼ˆâ€œä¸€ä¸ªè®¡ç®—å¯†é›†å‹çš„åº”ç”¨åœ¨ä¸€ä¸ªå•CPUè®¡ç®—æœºä¸Šè¿è¡Œï¼Œæ¯ä¸ªè¯·æ±‚éœ€è¦è¿ç®—10msâ€ï¼‰å¦‚æœé€‰æ‹©ä»¤ç‰Œæ•°ä¸Šé™ä¸º1çš„ä»¤ç‰Œæ¡¶ç­–ç•¥ï¼Œä¼šæ¯”æ¼æ¡¶ç­–ç•¥æ€§èƒ½å·®ä¹ˆï¼Ÿè¿˜æ˜¯è¯´å› ä¸ºä»¤ç‰Œæ¡¶ä¼šæ‹’ç»å¤ªå¤šæ‰å †åˆ°æ¥çš„è¯·æ±‚ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650858079,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":567190,"ip_address":""},"score":567210,"extra":""}]}]},{"had_liked":false,"id":341822,"user_name":"Tico","can_delete":false,"product_type":"c1","uid":2825710,"ip_address":"","ucode":"768F5FD8562DF5","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqMd9DibRjo8gqHo4DRSZO3lkZ2KMezY3z9ia77kNKv8hRLLDCics35Ll2HTMt2Eiadk8uZA0l0EiaOvLQ/132","comment_is_top":false,"comment_ctime":1649846937,"is_pvip":false,"replies":[{"id":"124897","content":"å¼€å§‹é˜Ÿåˆ—ä¸ºç©ºçš„æ—¶å€™ï¼Œå¦‚æœåŒæ—¶æ¥50ä¸ªè¯·æ±‚ï¼Œéƒ½èƒ½æ”¾è¿›é˜Ÿåˆ—ï¼Œé‚£å°±åŒæ—¶å»æ‰§è¡Œï¼Ÿè¿™ä¸æ˜¯æ¼æ¡¶ï¼Œè¿™æ˜¯ä»¤ç‰Œæ¡¶ã€‚ã€‚ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1007349","ctime":1649907934,"ip_address":"","comment_id":341822,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1649846937","product_id":100105701,"comment_content":"æ¼æ¡¶ç®—æ³•å¯ä»¥ç”¨äºåŒæ­¥ç½‘å…³çš„åœºæ™¯ï¼Œé‡ç‚¹æ˜¯ä¸è¦æŠŠè¯·æ±‚æ”¾åˆ°é˜Ÿåˆ—é‡Œé¢å»æ¶ˆè´¹ï¼Œæ¯”å¦‚è¯´è®¾ç½®ä¸€ä¸ª50æ·±åº¦çš„é˜Ÿåˆ—ï¼Œè¯·æ±‚æ¥æˆ‘å¾€é˜Ÿåˆ—é‡Œæ”¾ä¸€ä¸ªå¯¹è±¡ï¼ˆè¿™ä¸ªå¯¹è±¡ä¸æ˜¯è¯·æ±‚ä¿¡æ¯ï¼‰ï¼Œè‹¥èƒ½æ”¾è¿›é˜Ÿåˆ—è¯´æ˜é˜Ÿåˆ—æœªæ»¡å¯ä»¥ç»§ç»­æ‰§è¡Œè¯·æ±‚ï¼Œåº”ç”¨è¿”å›å¤„ç†ç»“æœçš„æ—¶å€™å»æ¶ˆè´¹ä¸€ä¸ªé˜Ÿåˆ—æ•°æ®ï¼Œè‹¥æ”¾ä¸è¿›å»è¯´æ˜é˜Ÿåˆ—æ»¡äº†ç›´æ¥è¿”å›503","like_count":0,"discussions":[{"author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":562920,"discussion_content":"å¼€å§‹é˜Ÿåˆ—ä¸ºç©ºçš„æ—¶å€™ï¼Œå¦‚æœåŒæ—¶æ¥50ä¸ªè¯·æ±‚ï¼Œéƒ½èƒ½æ”¾è¿›é˜Ÿåˆ—ï¼Œé‚£å°±åŒæ—¶å»æ‰§è¡Œï¼Ÿè¿™ä¸æ˜¯æ¼æ¡¶ï¼Œè¿™æ˜¯ä»¤ç‰Œæ¡¶ã€‚ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649907934,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2825710,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqMd9DibRjo8gqHo4DRSZO3lkZ2KMezY3z9ia77kNKv8hRLLDCics35Ll2HTMt2Eiadk8uZA0l0EiaOvLQ/132","nickname":"Tico","note":"","ucode":"768F5FD8562DF5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":562932,"discussion_content":"å—¯å—¯ï¼Œå¦å¤–ä¸€ç§å®ç°æ€è·¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649910097,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":340504,"user_name":"dao","can_delete":false,"product_type":"c1","uid":1087879,"ip_address":"","ucode":"4181FB270462CF","user_header":"https://static001.geekbang.org/account/avatar/00/10/99/87/98ebb20e.jpg","comment_is_top":false,"comment_ctime":1648866924,"is_pvip":true,"replies":[{"id":"124623","content":"èµ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1007349","ctime":1649211100,"ip_address":"","comment_id":340504,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1648866924","product_id":100105701,"comment_content":"å›ºå®šçª—å£æ˜¯æ»‘åŠ¨çª—å£çš„ä¸€ä¸ªç‰¹ä¾‹ã€‚æ»‘åŠ¨çª—å£ç®—æ³•ï¼š<br>1ï¼‰åœ¨åŒä¸€æ—¶é—´ç‰‡å†…ç´¯åŠ è®¡æ•°ï¼›<br>2ï¼‰åœ¨åŒä¸€æ—¶é—´çª—å£å†…ï¼Œåˆ‡æ¢æ—¶é—´ç‰‡æ—¶è®¡æ•°ä¼šç§»äº¤ä¸‹ä¸€æ—¶é—´ç‰‡ï¼›<br>3ï¼‰çª—å£åˆ‡æ¢æ—¶ï¼Œé‡ç½®æ—¶é—´ç‰‡åºå·å’Œè®¡ç®—å™¨ã€‚<br>å›ºå®šçª—å£æ²¡æœ‰2ï¼‰ï¼Œå¹¶ä¸”1ï¼‰æ˜¯æŒ‡åŒä¸€æ—¶é—´çª—å£ï¼Œ3ï¼‰æ²¡æœ‰æ—¶é—´ç‰‡åºå·é‡ç½®ã€‚<br>ä¸ªäººçœ‹æ³•ï¼Œå¯¹äºåŒä¸€é™æµè®¡æ•°å™¨ï¼Œä¸éœ€è¦ç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œä½¿ç”¨ä¸€èˆ¬å¯¹è±¡å°±å¯ä»¥ã€‚å¯¹è±¡å¯èƒ½åŒ…å«çš„ä¿¡æ¯å¦‚ä¸‹ï¼Œ<br>{ æ—¶é—´ç‰‡åºå·ï¼Œæˆªæ­¢æ—¶é—´æˆ³ï¼Œè®¡æ•° } ï¼ˆé™„ï¼šè¿™ä¸ªå¯¹è±¡æ˜¯å¤ç”¨çš„ï¼Œåœ¨è®¡æ•°ã€æ—¶é—´ç‰‡åˆ‡æ¢ã€çª—å£åˆ‡æ¢æ—¶æ›´æ–°ï¼‰<br>å¤šç§é™æµè®¡æ•°å™¨ä¹‹é—´ä½¿ç”¨ hashmap ã€‚<br>","like_count":0,"discussions":[{"author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560144,"discussion_content":"èµ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649211100,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":339813,"user_name":"Lance-Yanh","can_delete":false,"product_type":"c1","uid":2925298,"ip_address":"","ucode":"2869845EFFBBDA","user_header":"https://static001.geekbang.org/account/avatar/00/2c/a2/f2/db06a8bc.jpg","comment_is_top":false,"comment_ctime":1648399197,"is_pvip":false,"replies":[{"id":"124257","content":"å—¯å—¯ï¼Œå…·ä½“å¦‚ä½•å®ç°å‘¢ï¼Œkey valueå¦‚ä½•è®¾è®¡ï¼Ÿæ—¶é—´ç‰‡å†…è¯·æ±‚å¦‚ä½•è®¡æ•°ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1007349","ctime":1648446881,"ip_address":"","comment_id":339813,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1648399197","product_id":100105701,"comment_content":"æœ¬åœ°ç”¨concurrentSkipListMapï¼Œè¿œç¨‹ç”¨redis zsetï¼Œè¾›è‹¦è€å¸ˆç‚¹è¯„","like_count":0,"discussions":[{"author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558742,"discussion_content":"å—¯å—¯ï¼Œå…·ä½“å¦‚ä½•å®ç°å‘¢ï¼Œkey valueå¦‚ä½•è®¾è®¡ï¼Ÿæ—¶é—´ç‰‡å†…è¯·æ±‚å¦‚ä½•è®¡æ•°ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648446881,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":339232,"user_name":"Geek_7347cf","can_delete":false,"product_type":"c1","uid":2343516,"ip_address":"","ucode":"2E25574FAB1B3B","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/mmTEibMibic5ibsVpNZkR3HBlpPpZYt0gHGdIqOduLGxRHZpTWRG3q56CT1eejoLgNsdaW5aQGWXfyibN4vm9CicYb3w/132","comment_is_top":false,"comment_ctime":1648001511,"is_pvip":false,"replies":[{"id":"123974","content":"1 è¿™ç§æƒ…å†µå¯ä»¥ç”¨æ›´å°çš„çª—å£å’Œæ›´å°çš„æ—¶é—´ç‰‡æ”¹å–„<br>2 å3&#47;4å¹¶æ²¡æœ‰é—²ç½®ï¼Œå‰é¢é›†ä¸­è¿›æ¥çš„è¯·æ±‚è¿˜åœ¨æœåŠ¡å™¨ä¸­å¤„ç†å‘¢ï¼Œè¿™å°±æ˜¯é™æµå™¨çš„ç›®çš„ã€‚é€šå¸¸ä¹Ÿä¸å­˜åœ¨ç³»ç»Ÿä¸å¯ç”¨æ—¶é—´&gt;ç³»ç»Ÿå¯ç”¨æ—¶é—´ï¼Œå¦‚æœæ˜¯é›†ä¸­åœ¨å‰1&#47;4è¿›æ¥çš„ï¼Œå°±æ„å‘³ç€å3&#47;4è¯·æ±‚å¾ˆå°‘ï¼›å¦‚æœå‰åçš„è¯·æ±‚éƒ½å¾ˆå¤šï¼Œæ„å‘³ç€æ­£å¸¸è¯·æ±‚å°±æœ‰è¿™ä¹ˆå¤šï¼Œé‚£å°±æ˜¯é˜ˆå€¼è®¾ç½®ä¸åˆç†æˆ–è€…æœåŠ¡å™¨éƒ¨ç½²å¤ªå°‘äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1007349","ctime":1648006253,"ip_address":"","comment_id":339232,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1648001511","product_id":100105701,"comment_content":"å¯¹äºå›ºå®šçª—å£æˆ–æ»‘åŠ¨çª—å£ å¦‚æœæ‰€æœ‰è¯·æ±‚éƒ½é›†ä¸­åœ¨ç¬¬ä¸€ä¸ª1&#47;4åŒºæ®µè§¦å‘é˜ˆå€¼ï¼Œé‚£ä¹ˆåé¢3&#47;4åŒºæ®µå°†è¢«é—²ç½®ï¼Œæ— æ³•å¤„ç†ç”¨æˆ·è¯·æ±‚ï¼Œç³»ç»Ÿä¸å¯ç”¨æ—¶é—´&gt;ç³»ç»Ÿå¯ç”¨æ—¶é—´ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µæœ‰æ²¡æœ‰æ¯”è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆ","like_count":0,"discussions":[{"author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557870,"discussion_content":"1 è¿™ç§æƒ…å†µå¯ä»¥ç”¨æ›´å°çš„çª—å£å’Œæ›´å°çš„æ—¶é—´ç‰‡æ”¹å–„\n2 å3/4å¹¶æ²¡æœ‰é—²ç½®ï¼Œå‰é¢é›†ä¸­è¿›æ¥çš„è¯·æ±‚è¿˜åœ¨æœåŠ¡å™¨ä¸­å¤„ç†å‘¢ï¼Œè¿™å°±æ˜¯é™æµå™¨çš„ç›®çš„ã€‚é€šå¸¸ä¹Ÿä¸å­˜åœ¨ç³»ç»Ÿä¸å¯ç”¨æ—¶é—´&gt;ç³»ç»Ÿå¯ç”¨æ—¶é—´ï¼Œå¦‚æœæ˜¯é›†ä¸­åœ¨å‰1/4è¿›æ¥çš„ï¼Œå°±æ„å‘³ç€å3/4è¯·æ±‚å¾ˆå°‘ï¼›å¦‚æœå‰åçš„è¯·æ±‚éƒ½å¾ˆå¤šï¼Œæ„å‘³ç€æ­£å¸¸è¯·æ±‚å°±æœ‰è¿™ä¹ˆå¤šï¼Œé‚£å°±æ˜¯é˜ˆå€¼è®¾ç½®ä¸åˆç†æˆ–è€…æœåŠ¡å™¨éƒ¨ç½²å¤ªå°‘äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648006253,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":339229,"user_name":"Geek_7347cf","can_delete":false,"product_type":"c1","uid":2343516,"ip_address":"","ucode":"2E25574FAB1B3B","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/mmTEibMibic5ibsVpNZkR3HBlpPpZYt0gHGdIqOduLGxRHZpTWRG3q56CT1eejoLgNsdaW5aQGWXfyibN4vm9CicYb3w/132","comment_is_top":false,"comment_ctime":1648000759,"is_pvip":false,"replies":[{"id":"123972","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1007349","ctime":1648005828,"ip_address":"","comment_id":339229,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1648000759","product_id":100105701,"comment_content":"é‡ç½®çª—å£æ—¶é—´çš„é€»è¾‘ åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ æ˜¯ä¸æ˜¯åº”è¯¥è€ƒè™‘é”çš„é—®é¢˜","like_count":0,"discussions":[{"author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557866,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648005828,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":339227,"user_name":"å¥”æµª","can_delete":false,"product_type":"c1","uid":2915106,"ip_address":"","ucode":"537B9FB02F5EA0","user_header":"https://static001.geekbang.org/account/avatar/00/2c/7b/22/2a810977.jpg","comment_is_top":false,"comment_ctime":1648000161,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1648000161","product_id":100105701,"comment_content":"é¦–å…ˆ:<br>        èƒ½æƒ³åˆ°çš„æ˜¯é“¾è¡¨å¸¦å¤´å°¾æŒ‡é’ˆå‘¢ç§ï¼Œæ–°æ¥çš„ä»å¤´éƒ¨æ’å…¥ï¼Œè€Œæ£€æŸ¥æ˜¯å¦è¿‡æœŸç›´æ¥ä»å°¾éƒ¨æ£€æŸ¥ã€å‰ææ˜¯è¿›å…¥çš„å…ƒç´ è¦å¸¦æœ‰æ—¶é—´å¦åˆ™æ²¡æ³•åˆ¤æ–­ã€‘<br>ç¬¬äºŒç§:<br>        åŸºäºä¸Šé¢è¿›è¡Œå˜å½¢ï¼Œä¸Šé¢æ£€æŸ¥æ˜¯å¦è¿‡æœŸæ˜¯æœ‰ä¸ªä¸€çº¿ç¨‹å®šæ—¶è½®è¯¢ï¼Œæˆ–è€…åœ¨å‡†å¤‡è¿›å…¥æ–°å…ƒç´ çš„æ—¶å€™è¢«åŠ¨æ£€æŸ¥æ˜¯å¦èƒ½å¼¹å‡ºè¿‡æœŸå…ƒç´ è¿™æ ·çš„æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†æ­¤å·¥ä½œå°å…¥é“¾è¡¨ç»“æ„æœ¬èº«ï¼Œåœ¨æ’å…¥å…ƒç´ è‡ªåŠ¨æ£€æŸ¥å°¾éƒ¨å…ƒç´ æ˜¯å¦è¿‡æœŸå¦‚æœè¿‡æœŸè‡ªåŠ¨å¼¹å‡ºã€‚<br>        å½“ç„¶ä»¥ä¸Šå½“æ£€æŸ¥åˆ°å°¾éƒ¨æœ‰è¿‡æœŸçš„é‚£ä¹ˆæ¥ç€è¿­ä»£æ£€æŸ¥ä¸‹ä¸€ä¸ªå…ƒç´ ","like_count":0},{"had_liked":false,"id":339220,"user_name":"ä¸«ä¸«","can_delete":false,"product_type":"c1","uid":2896229,"ip_address":"","ucode":"982AE515E87971","user_header":"","comment_is_top":false,"comment_ctime":1647999286,"is_pvip":false,"replies":[{"id":"123971","content":"Redisè¿›è¡Œå…¨å±€è®¡æ•°","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1007349","ctime":1648005767,"ip_address":"","comment_id":339220,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1647999286","product_id":100105701,"comment_content":"è°¢è°¢è€å¸ˆçš„ä¸“é¢˜ï¼<br>è¯·é—®è€å¸ˆï¼Œåœ¨åˆ†å¸ƒå¼é™æµä¸­ï¼Œæœ¬åœ°é™æµå™¨å¦‚ä½•çŸ¥é“å…¶ä»–é™æµå™¨çš„è®¡æ•°ï¼Œå·¥ç¨‹ä¸­ç”¨ä»€ä¹ˆåŒæ­¥ç®—æ³•æˆ–è€…åè®®ï¼Ÿè°¢è°¢è€å¸ˆã€‚","like_count":0,"discussions":[{"author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557865,"discussion_content":"Redisè¿›è¡Œå…¨å±€è®¡æ•°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648005767,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":2,"child_discussions":[{"author":{"id":2896229,"avatar":"","nickname":"ä¸«ä¸«","note":"","ucode":"982AE515E87971","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":557884,"discussion_content":"è€å¸ˆå¯èƒ½æˆ‘çš„é—®é¢˜æ²¡æœ‰é—®å¥½ï¼Œ å¦‚æœqpsè¶…è¿‡äº†ç™¾ä¸‡çº§åˆ«ï¼Œæˆ‘ä»¬å¿…é¡»è¦ä½¿ç”¨redisé›†ç¾¤ï¼Œè¿™ä¸ªæ—¶å€™å¦‚ä½•è·å–å…¨å±€çš„é™æµå™¨è®¡æ•°å‘¢ï¼Ÿé›†ç¾¤ä¸­æ¶ˆæ¯åŒæ­¥è‚¯å®šä¼šæœ‰å»¶è¿Ÿï¼Œ å¦‚ä½•åœ¨æœ€å¿«çš„é€Ÿåº¦åŒæ­¥å‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648017267,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":557865,"ip_address":""},"score":557884,"extra":""},{"author":{"id":2911084,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/6b/6c/3e80afaf.jpg","nickname":"HappyHasson","note":"","ucode":"B84CC43E349CFA","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":2896229,"avatar":"","nickname":"ä¸«ä¸«","note":"","ucode":"982AE515E87971","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558216,"discussion_content":"ä¸€ç§ç±»å‹çš„è®¡æ•°å™¨å°±ä¸€ä¸ªkeyï¼Œqpså¤§å°ä¸å½±å“redisé›†ç¾¤ï¼Œè®¡æ•°å™¨ä¸ªæ•°æ‰å½±å“","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648136846,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":557884,"ip_address":""},"score":558216,"extra":""}]}]},{"had_liked":false,"id":339214,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1647995520,"is_pvip":true,"replies":[{"id":"123970","content":"1 å¿«é€Ÿçœ‹äº†ä¸‹sentinelæ–‡æ¡£ï¼Œsentinelçš„æ§åˆ¶å°æ˜¯ç‹¬ç«‹éƒ¨ç½²ï¼Œsentinelæµæ§ç»„ä»¶ä¹Ÿéœ€è¦å’Œç½‘å…³æˆ–è€…åº”ç”¨éƒ¨ç½²åœ¨ä¸€èµ·ã€‚<br>2 å¯ä»¥<br>3 ä¸æ˜¯ï¼Œè¯·æ±‚è¿›å…¥çš„æ—¶å€™åˆ¤æ–­ï¼Œæ–‡ä¸­æœ‰è®²<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1007349","ctime":1648005717,"ip_address":"","comment_id":339214,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1647995520","product_id":100105701,"comment_content":"è¯·æ•™è€å¸ˆå‡ ä¸ªé—®é¢˜å•Šï¼š<br>Q1ï¼šé™æµå™¨å¯ä»¥å’Œç½‘å…³ç›¸äº’ç‹¬ç«‹å—ï¼Ÿ<br>æ–‡ä¸­æåˆ°çš„é™æµå™¨æ˜¯ç½‘å…³çš„ä¸€ä¸ªç»„ä»¶ï¼Œé™æµå™¨ä¸æ˜¯ç‹¬ç«‹çš„ã€‚SpringCloudä¸­çš„sentinelå’Œç½‘å…³æ˜¯ç‹¬ç«‹éƒ¨ç½²çš„ã€‚é™æµå™¨åº”è¯¥å¯ä»¥å’Œç½‘å…³ç›¸äº’ç‹¬ç«‹å§ã€‚<br>Q2ï¼šNginxå¯ä»¥ä½œä¸ºé™æµå™¨ä½¿ç”¨å—ï¼Ÿ<br>Q3ï¼šå›ºå®šçª—å£æ–¹æ³•ä¸­çš„æ—¶é—´ç»“æŸæ˜¯é€šè¿‡å®šæ—¶å™¨å®ç°çš„å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557863,"discussion_content":"1 å¿«é€Ÿçœ‹äº†ä¸‹sentinelæ–‡æ¡£ï¼Œsentinelçš„æ§åˆ¶å°æ˜¯ç‹¬ç«‹éƒ¨ç½²ï¼Œsentinelæµæ§ç»„ä»¶ä¹Ÿéœ€è¦å’Œç½‘å…³æˆ–è€…åº”ç”¨éƒ¨ç½²åœ¨ä¸€èµ·ã€‚\n2 å¯ä»¥\n3 ä¸æ˜¯ï¼Œè¯·æ±‚è¿›å…¥çš„æ—¶å€™åˆ¤æ–­ï¼Œæ–‡ä¸­æœ‰è®²\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648005717,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}