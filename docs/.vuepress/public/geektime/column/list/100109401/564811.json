{"id":564811,"title":"80｜Line Editor （2）：如何重构生成与更新锚点控制点的逻辑？","content":"<p>你好，我是徐昊。今天我们继续使用TDD的方式实现一个线段编辑器。</p><h2>回顾任务与代码</h2><p>目前代码为：</p><pre><code class=\"language-plain\">import Konva from \"konva\";\nexport class LineEditor extends Konva.Group {\n    private line?: Konva.Line\n    attach(line: Konva.Line) {\n        let points = line.points()\n        let previous = -1\n        for (let i = 0; i &lt; points.length / 2; i++) {\n            this.add(new Konva.Circle({name: `${i}-anchor`, radius: 10, x: points[i * 2], y: points[i * 2 + 1]}))\n            if (previous !== -1)\n                this.add(new Konva.Circle({\n                    name: `${i}-control`, radius: 10,\n                    x: points[previous * 2] + (points[i * 2] - points[previous * 2]) / 2,\n                    y: points[previous * 2 + 1] + (points[i * 2 + 1] - points[previous * 2 + 1]) / 2\n                }))\n            previous = i\n        }\n        this.line = line\n        line.on('pointsChange', () =&gt; {\n            this.update()\n        })\n    }\n    update() {\n        let points = this.line!.points()\n        let previous = -1\n        for (let i = 0; i &lt; points.length / 2; i++) {\n            this.findOne(`.${i}-anchor`).setAttrs({x: points[i * 2], y: points[i * 2 + 1]})\n            if (previous !== -1)\n                this.findOne(`.${i}-control`).setAttrs({\n                    x: points[previous * 2] + (points[i * 2] - points[previous * 2]) / 2,\n                    y: points[previous * 2 + 1] + (points[i * 2 + 1] - points[previous * 2 + 1]) / 2\n                })\n            previous = i\n        }\n    }\n}\n\n</code></pre><!-- [[[read_end]]] --><p>任务列表为：</p><ul>\n<li><s>在线段编辑（Line Editor）上设置锚点（Anchor）</s>\n<ul>\n<li><s>将线（Line）数据，生成锚点</s></li>\n<li><s>在Line Editor重绘时，按照数据更新锚点位置</s></li>\n</ul>\n</li>\n<li><s>在锚点与锚点之间设置控制点</s>\n<ul>\n<li>通过线段数据，在两个锚点之间生成控制点（Control）</li>\n<li><s>在Line Editor重绘时，按照数据更新控制点位置</s></li>\n</ul>\n</li>\n<li>拖动锚点时，改变线段中的位置</li>\n<li>拖动控制点时，在线段上增加锚点</li>\n<li>双击锚点时，删除锚点</li>\n</ul><h2>视频演示</h2><p>接下来让我们进入开发：</p><p><video poster=\"https://media001.geekbang.org/e8246ef3b88d44ddb262d8df457e09c4/snapshots/a36ef26528c5465796eda895ed6c5839-00005.jpg\" preload=\"none\" controls=\"\"><source src=\"https://media001.geekbang.org/customerTrans/7e27d07d27d407ebcc195a0e78395f55/4e6adb6a-18331075603-0000-0000-01d-dbacd.mp4\" type=\"video/mp4\"><source src=\" https://media001.geekbang.org/7c9042b1d6d848a58801582b585a96a8/83e24b2b7a7e49afab90825dd7c6b027-e532bb1b7e0b7097f6c35d5970496727-sd.m3u8\" type=\"application/x-mpegURL\"></video></p><h2>思考题</h2><p>对于UI的样式要如何测试？</p><p>欢迎把你的项目代码地址分享在留言区，我们下节课再见！</p>","neighbors":{"left":{"article_title":"79｜线段编辑器：架构思路与任务拆分","id":564801},"right":{"article_title":"81｜结束语：掌握TDD的那天，我才成为了可靠高效的职业程序员","id":566904}},"comments":[{"had_liked":false,"id":357699,"user_name":"davix","can_delete":false,"product_type":"c1","uid":1074465,"ip_address":"北京","ucode":"CBFB39BAD7938B","user_header":"https://static001.geekbang.org/account/avatar/00/10/65/21/101a7075.jpg","comment_is_top":false,"comment_ctime":1663573056,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1663573056","product_id":100109401,"comment_content":"老師，實際開發時，會實現了這些任務還看不到頁面啥樣嗎？<br>TDD時每完成一個任務是不是也結合一個手工UI測試？要不那些 .on 啊，.fire啊，哪些參數啥都不知道生沒生效。最後少刪一些線等情況沒有實際看到UI，單純頭腦想也很容易忽略。","like_count":0}]}