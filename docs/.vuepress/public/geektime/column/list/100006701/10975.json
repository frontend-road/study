{"id":10975,"title":"ç¬¬30è®² | Javaç¨‹åºè¿è¡Œåœ¨Dockerç­‰å®¹å™¨ç¯å¢ƒæœ‰å“ªäº›æ–°é—®é¢˜ï¼Ÿ","content":"<p>å¦‚ä»Šï¼ŒDockerç­‰å®¹å™¨æ—©å·²ä¸æ˜¯æ–°ç”Ÿäº‹ç‰©ï¼Œæ­£åœ¨é€æ­¥æˆä¸ºæ—¥å¸¸å¼€å‘ã€éƒ¨ç½²ç¯å¢ƒçš„ä¸€éƒ¨åˆ†ã€‚Javaèƒ½å¦æ— ç¼åœ°è¿è¡Œåœ¨å®¹å™¨ç¯å¢ƒï¼Œæ˜¯å¦ç¬¦åˆå¾®æœåŠ¡ã€Serverlessç­‰æ–°çš„è½¯ä»¶æ¶æ„å’Œåœºæ™¯ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šä¹Ÿä¼šå½±å“æœªæ¥çš„æŠ€æœ¯æ ˆé€‰æ‹©ã€‚å½“ç„¶ï¼ŒJavaå¯¹Dockerç­‰å®¹å™¨ç¯å¢ƒçš„æ”¯æŒä¹Ÿåœ¨ä¸æ–­å¢å¼ºï¼Œè‡ªç„¶åœ°ï¼ŒJavaåœ¨å®¹å™¨åœºæ™¯çš„å®è·µä¹Ÿé€æ¸åœ¨é¢è¯•ä¸­è¢«æ¶‰åŠã€‚æˆ‘å¸Œæœ›é€šè¿‡ä¸“æ ä»Šå¤©è¿™ä¸€è®²ï¼Œèƒ½å¤Ÿå¸®ä½ èƒ½åšåˆ°èƒ¸æœ‰æˆç«¹ã€‚</p>\n<p>ä»Šå¤©æˆ‘è¦é—®ä½ çš„é—®é¢˜æ˜¯ï¼Œ<span class=\"orange\">Javaç¨‹åºè¿è¡Œåœ¨Dockerç­‰å®¹å™¨ç¯å¢ƒæœ‰å“ªäº›æ–°é—®é¢˜ï¼Ÿ</span></p>\n<h2>å…¸å‹å›ç­”</h2>\n<p>å¯¹äºJavaæ¥è¯´ï¼ŒDockeræ¯•ç«Ÿæ˜¯ä¸€ä¸ªè¾ƒæ–°çš„ç¯å¢ƒï¼Œä¾‹å¦‚ï¼Œå…¶å†…å­˜ã€CPUç­‰èµ„æºé™åˆ¶æ˜¯é€šè¿‡CGroupï¼ˆControl Groupï¼‰å®ç°çš„ï¼Œæ—©æœŸçš„JDKç‰ˆæœ¬ï¼ˆ8u131ä¹‹å‰ï¼‰å¹¶ä¸èƒ½è¯†åˆ«è¿™äº›é™åˆ¶ï¼Œè¿›è€Œä¼šå¯¼è‡´ä¸€äº›åŸºç¡€é—®é¢˜ï¼š</p>\n<ul>\n<li>\n<p>å¦‚æœæœªé…ç½®åˆé€‚çš„JVMå †å’Œå…ƒæ•°æ®åŒºã€ç›´æ¥å†…å­˜ç­‰å‚æ•°ï¼ŒJavaå°±æœ‰å¯èƒ½è¯•å›¾ä½¿ç”¨è¶…è¿‡å®¹å™¨é™åˆ¶çš„å†…å­˜ï¼Œæœ€ç»ˆè¢«å®¹å™¨OOM killï¼Œæˆ–è€…è‡ªèº«å‘ç”ŸOOMã€‚</p>\n</li>\n<li>\n<p>é”™è¯¯åˆ¤æ–­äº†å¯è·å–çš„CPUèµ„æºï¼Œä¾‹å¦‚ï¼ŒDockeré™åˆ¶äº†CPUçš„æ ¸æ•°ï¼ŒJVMå°±å¯èƒ½è®¾ç½®ä¸åˆé€‚çš„GCå¹¶è¡Œçº¿ç¨‹æ•°ç­‰ã€‚</p>\n</li>\n</ul>\n<p>ä»åº”ç”¨æ‰“åŒ…ã€å‘å¸ƒç­‰è§’åº¦å‡ºå‘ï¼ŒJDKè‡ªèº«å°±æ¯”è¾ƒå¤§ï¼Œç”Ÿæˆçš„é•œåƒå°±æ›´ä¸ºè‡ƒè‚¿ï¼Œå½“æˆ‘ä»¬çš„é•œåƒéå¸¸å¤šçš„æ—¶å€™ï¼Œé•œåƒçš„å­˜å‚¨ç­‰å¼€é”€å°±æ¯”è¾ƒæ˜æ˜¾äº†ã€‚</p><!-- [[[read_end]]] -->\n<p>å¦‚æœè€ƒè™‘åˆ°å¾®æœåŠ¡ã€Serverlessç­‰æ–°çš„æ¶æ„å’Œåœºæ™¯ï¼ŒJavaè‡ªèº«çš„å¤§å°ã€å†…å­˜å ç”¨ã€å¯åŠ¨é€Ÿåº¦ï¼Œéƒ½å­˜åœ¨ä¸€å®šå±€é™æ€§ï¼Œå› ä¸ºJavaæ—©æœŸçš„ä¼˜åŒ–å¤§å¤šæ˜¯é’ˆå¯¹é•¿æ—¶é—´è¿è¡Œçš„å¤§å‹æœåŠ¡å™¨ç«¯åº”ç”¨ã€‚</p>\n<h2>è€ƒç‚¹åˆ†æ</h2>\n<p>ä»Šå¤©çš„é—®é¢˜æ˜¯ä¸ªé’ˆå¯¹ç‰¹å®šåœºæ™¯å’ŒçŸ¥è¯†ç‚¹çš„é—®é¢˜ï¼Œæˆ‘ç»™å‡ºçš„å›ç­”ç®€å•æ€»ç»“äº†ç›®å‰ä¸šç•Œå®è·µä¸­å‘ç°çš„ä¸€äº›é—®é¢˜ã€‚</p>\n<p>å¦‚æœæˆ‘æ˜¯é¢è¯•å®˜ï¼Œé’ˆå¯¹è¿™ç§é—®é¢˜ï¼Œå¦‚æœä½ ç¡®å®æ²¡æœ‰å¤ªå¤šJavaåœ¨Dockerç¯å¢ƒçš„ä½¿ç”¨ç»éªŒï¼Œç›´æ¥è¯´ä¸çŸ¥é“ï¼Œä¹Ÿç®—æ˜¯å¯ä»¥æ¥å—çš„ï¼Œæ¯•ç«Ÿæ²¡æœ‰äººèƒ½å¤ŸæŒæ¡æ‰€æœ‰çŸ¥è¯†ç‚¹å˜›ã€‚</p>\n<p>ä½†æˆ‘ä»¬è¦æ¸…æ¥šï¼Œæœ‰ç»éªŒçš„é¢è¯•å®˜ï¼Œä¸€èˆ¬ä¸ä¼šä»¥çº¯ç²¹ååƒ»çš„çŸ¥è¯†ç‚¹ä½œä¸ºé¢è¯•è€ƒå¯Ÿçš„ç›®çš„ï¼Œæ›´å¤šæ˜¯è€ƒå¯Ÿæ€è€ƒé—®é¢˜çš„æ€è·¯å’Œè§£å†³é—®é¢˜çš„æ–¹æ³•ã€‚æ‰€ä»¥ï¼Œå¦‚æœæœ‰åŸºç¡€çš„è¯ï¼Œå¯ä»¥ä»æ“ä½œç³»ç»Ÿã€å®¹å™¨åŸç†ã€JVMå†…éƒ¨æœºåˆ¶ã€è½¯ä»¶å¼€å‘å®è·µç­‰è§’åº¦ï¼Œå±•ç¤ºç³»ç»Ÿæ€§åˆ†ææ–°é—®é¢˜ã€æ–°åœºæ™¯çš„èƒ½åŠ›ã€‚æ¯•ç«Ÿï¼Œå˜åŒ–æ‰æ˜¯ä¸–ç•Œæ°¸è¿œçš„ä¸»é¢˜ï¼Œèƒ½å¤Ÿåœ¨æ–°å˜åŒ–ä¸­æ‰¾å‡ºå…±æ€§ä¸å…³é”®ï¼Œæ˜¯ä¼˜ç§€å·¥ç¨‹å¸ˆçš„å¿…å¤‡èƒ½åŠ›ã€‚</p>\n<p>ä»Šå¤©æˆ‘ä¼šå›´ç»•ä¸‹é¢å‡ ä¸ªæ–¹é¢å±•å¼€ï¼š</p>\n<ul>\n<li>\n<p>é¢è¯•å®˜å¯èƒ½ä¼šè¿›ä¸€æ­¥é—®åˆ°ï¼Œæœ‰æ²¡æœ‰æƒ³è¿‡ä¸ºä»€ä¹ˆç±»ä¼¼Dockerè¿™ç§å®¹å™¨ç¯å¢ƒï¼Œä¼šæœ‰ç‚¹â€œæ¬ºè´Ÿâ€Javaï¼Ÿä»JVMå†…éƒ¨æœºåˆ¶æ¥è¯´ï¼Œé—®é¢˜å‡ºç°åœ¨å“ªé‡Œï¼Ÿ</p>\n</li>\n<li>\n<p>æˆ‘æ³¨æ„åˆ°æœ‰ç§è®ºè°ƒè¯´â€œæ²¡äººåœ¨å®¹å™¨ç¯å¢ƒç”¨Javaâ€ï¼Œä¸å»äº‰è®ºè¿™ä¸ªè§‚ç‚¹æ­£ç¡®ä¸å¦ï¼Œæˆ‘ä¼šä»å·¥ç¨‹å®è·µå‡ºå‘ï¼Œæ¢³ç†é—®é¢˜åŸå› å’Œç›¸å…³è§£å†³æ–¹æ¡ˆï¼Œå¹¶æ¢è®¨ä¸‹æ–°åœºæ™¯ä¸‹çš„æœ€ä½³å®è·µã€‚</p>\n</li>\n</ul>\n<h2>çŸ¥è¯†æ‰©å±•</h2>\n<p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæ¥ææ¸…æ¥šJavaåœ¨å®¹å™¨ç¯å¢ƒçš„å±€é™æ€§æ¥æºï¼Œ<strong>Dockeråˆ°åº•æœ‰ä»€ä¹ˆç‰¹åˆ«</strong>ï¼Ÿ</p>\n<p>è™½ç„¶çœ‹èµ·æ¥Dockerä¹‹ç±»å®¹å™¨å’Œè™šæ‹Ÿæœºéå¸¸ç›¸ä¼¼ï¼Œä¾‹å¦‚ï¼Œå®ƒä¹Ÿæœ‰è‡ªå·±çš„shellï¼Œèƒ½ç‹¬ç«‹å®‰è£…è½¯ä»¶åŒ…ï¼Œè¿è¡Œæ—¶ä¸å…¶ä»–å®¹å™¨äº’ä¸å¹²æ‰°ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ·±å…¥åˆ†æä½ ä¼šå‘ç°ï¼ŒDockerå¹¶ä¸æ˜¯ä¸€ç§å®Œå…¨çš„<strong>è™šæ‹ŸåŒ–</strong>æŠ€æœ¯ï¼Œè€Œæ›´æ˜¯ä¸€ç§è½»é‡çº§çš„<strong>éš”ç¦»</strong>æŠ€æœ¯ã€‚<br />\n<img src=\"https://static001.geekbang.org/resource/image/a0/fb/a069a294d32d7778f3410192221358fb.png?wh=733*382\" alt=\"\" /></p>\n<p>ä¸Šé¢çš„ç¤ºæ„å›¾ï¼Œå±•ç¤ºäº†Dockerä¸è™šæ‹Ÿæœºçš„åŒºåˆ«ã€‚ä»æŠ€æœ¯è§’åº¦ï¼ŒåŸºäºnamespaceï¼ŒDockerä¸ºæ¯ä¸ªå®¹å™¨æä¾›äº†å•ç‹¬çš„å‘½åç©ºé—´ï¼Œå¯¹ç½‘ç»œã€PIDã€ç”¨æˆ·ã€IPCé€šä¿¡ã€æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹ç­‰å®ç°äº†éš”ç¦»ã€‚å¯¹äºCPUã€å†…å­˜ã€ç£ç›˜IOç­‰è®¡ç®—èµ„æºï¼Œåˆ™æ˜¯é€šè¿‡CGroupè¿›è¡Œç®¡ç†ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šDockerçš„ç»†èŠ‚ï¼Œè¯·å‚è€ƒç›¸å…³<a href=\"https://medium.freecodecamp.org/a-beginner-friendly-introduction-to-containers-vms-and-docker-79a9e3e119b\">æŠ€æœ¯æ–‡æ¡£</a>ã€‚</p>\n<p>Dockerä»…åœ¨ç±»ä¼¼Linuxå†…æ ¸ä¹‹ä¸Šå®ç°äº†æœ‰é™çš„éš”ç¦»å’Œè™šæ‹ŸåŒ–ï¼Œå¹¶ä¸æ˜¯åƒä¼ ç»Ÿè™šæ‹ŸåŒ–è½¯ä»¶é‚£æ ·ï¼Œç‹¬ç«‹è¿è¡Œä¸€ä¸ªæ–°çš„æ“ä½œç³»ç»Ÿã€‚å¦‚æœæ˜¯è™šæ‹ŸåŒ–çš„æ“ä½œç³»ç»Ÿï¼Œä¸ç®¡æ˜¯Javaè¿˜æ˜¯å…¶ä»–ç¨‹åºï¼Œåªè¦è°ƒç”¨çš„æ˜¯åŒä¸€ä¸ªç³»ç»ŸAPIï¼Œéƒ½å¯ä»¥é€æ˜åœ°è·å–æ‰€éœ€çš„ä¿¡æ¯ï¼ŒåŸºæœ¬ä¸éœ€è¦é¢å¤–çš„å…¼å®¹æ€§æ”¹å˜ã€‚</p>\n<p>å®¹å™¨è™½ç„¶çœç•¥äº†è™šæ‹Ÿæ“ä½œç³»ç»Ÿçš„å¼€é”€ï¼Œå®ç°äº†è½»é‡çº§çš„ç›®æ ‡ï¼Œä½†ä¹Ÿå¸¦æ¥äº†é¢å¤–å¤æ‚æ€§ï¼Œå®ƒé™åˆ¶å¯¹äºåº”ç”¨ä¸æ˜¯é€æ˜çš„ï¼Œéœ€è¦ç”¨æˆ·ç†è§£Dockerçš„æ–°è¡Œä¸ºã€‚æ‰€ä»¥ï¼Œæœ‰ä¸“å®¶æ›¾ç»è¯´è¿‡ï¼Œâ€œå¹¸è¿çš„æ˜¯Dockeræ²¡æœ‰å®Œå…¨éšè—åº•å±‚ä¿¡æ¯ï¼Œä½†æ˜¯ä¸å¹¸çš„ä¹Ÿæ˜¯Dockeræ²¡æœ‰éšè—åº•å±‚ä¿¡æ¯ï¼â€</p>\n<p>å¯¹äºJavaå¹³å°æ¥è¯´ï¼Œè¿™äº›æœªéšè—çš„åº•å±‚ä¿¡æ¯å¸¦æ¥äº†å¾ˆå¤šæ„å¤–çš„å›°éš¾ï¼Œä¸»è¦ä½“ç°åœ¨å‡ ä¸ªæ–¹é¢ï¼š</p>\n<p>ç¬¬ä¸€ï¼Œå®¹å™¨ç¯å¢ƒå¯¹äºè®¡ç®—èµ„æºçš„ç®¡ç†æ–¹å¼æ˜¯å…¨æ–°çš„ï¼ŒCGroupä½œä¸ºç›¸å¯¹æ¯”è¾ƒæ–°çš„æŠ€æœ¯ï¼Œå†å²ç‰ˆæœ¬çš„Javaæ˜¾ç„¶å¹¶ä¸èƒ½è‡ªç„¶åœ°ç†è§£ç›¸åº”çš„èµ„æºé™åˆ¶ã€‚</p>\n<p>ç¬¬äºŒï¼Œnamespaceå¯¹äºå®¹å™¨å†…çš„åº”ç”¨ç»†èŠ‚å¢åŠ äº†ä¸€äº›å¾®å¦™çš„å·®å¼‚ï¼Œæ¯”å¦‚jcmdã€jstackç­‰å·¥å…·ä¼šä¾èµ–äºâ€œ/proc/<pid>/â€ä¸‹é¢æä¾›çš„éƒ¨åˆ†ä¿¡æ¯ï¼Œä½†æ˜¯Dockerçš„è®¾è®¡æ”¹å˜äº†è¿™éƒ¨åˆ†ä¿¡æ¯çš„åŸæœ‰ç»“æ„ï¼Œæˆ‘ä»¬éœ€è¦å¯¹åŸæœ‰å·¥å…·è¿›è¡Œ<a href=\"https://bugs.openjdk.java.net/browse/JDK-8179498\">ä¿®æ”¹</a>ä»¥é€‚åº”è¿™ç§å˜åŒ–ã€‚</p>\n<p><strong>ä»JVMè¿è¡Œæœºåˆ¶çš„è§’åº¦ï¼Œä¸ºä»€ä¹ˆè¿™äº›â€œæ²Ÿé€šéšœç¢â€ä¼šå¯¼è‡´OOMç­‰é—®é¢˜å‘¢ï¼Ÿ</strong></p>\n<p>ä½ å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼Œè¿™ä¸ªé—®é¢˜å®é™…æ˜¯åæ˜ äº†JVMå¦‚ä½•æ ¹æ®ç³»ç»Ÿèµ„æºï¼ˆå†…å­˜ã€CPUç­‰ï¼‰æƒ…å†µï¼Œåœ¨å¯åŠ¨æ—¶è®¾ç½®é»˜è®¤å‚æ•°ã€‚</p>\n<p>è¿™å°±æ˜¯æ‰€è°“çš„<a href=\"https://docs.oracle.com/javase/10/gctuning/ergonomics.htm#JSGCT-GUID-DB4CAE94-2041-4A16-90EC-6AE3D91EC1F1\">Ergonomics</a>æœºåˆ¶ï¼Œä¾‹å¦‚ï¼š</p>\n<ul>\n<li>\n<p>JVMä¼šå¤§æ¦‚æ ¹æ®æ£€æµ‹åˆ°çš„å†…å­˜å¤§å°ï¼Œè®¾ç½®æœ€åˆå¯åŠ¨æ—¶çš„å †å¤§å°ä¸ºç³»ç»Ÿå†…å­˜çš„1/64ï¼›å¹¶å°†å †æœ€å¤§å€¼ï¼Œè®¾ç½®ä¸ºç³»ç»Ÿå†…å­˜çš„1/4ã€‚</p>\n</li>\n<li>\n<p>è€ŒJVMæ£€æµ‹åˆ°ç³»ç»Ÿçš„CPUæ ¸æ•°ï¼Œåˆ™ç›´æ¥å½±å“åˆ°äº†Parallel GCçš„å¹¶è¡Œçº¿ç¨‹æ•°ç›®å’ŒJIT complierçº¿ç¨‹æ•°ç›®ï¼Œç”šè‡³æ˜¯æˆ‘ä»¬åº”ç”¨ä¸­ForkJoinPoolç­‰æœºåˆ¶çš„å¹¶è¡Œç­‰çº§ã€‚</p>\n</li>\n</ul>\n<p>è¿™äº›é»˜è®¤å‚æ•°ï¼Œæ˜¯æ ¹æ®é€šç”¨åœºæ™¯é€‰æ‹©çš„åˆå§‹å€¼ã€‚ä½†æ˜¯ç”±äºå®¹å™¨ç¯å¢ƒçš„å·®å¼‚ï¼ŒJavaçš„åˆ¤æ–­å¾ˆå¯èƒ½æ˜¯åŸºäºé”™è¯¯ä¿¡æ¯è€Œåšå‡ºçš„ã€‚è¿™å°±ç±»ä¼¼ï¼Œæˆ‘ä»¥ä¸ºæˆ‘ä½çš„æ˜¯æ•´æ ‹åˆ«å¢…ï¼Œå®é™…ä¸Šå´åªæœ‰ä¸€ä¸ªæˆ¿é—´æ˜¯ç»™æˆ‘ä½çš„ã€‚</p>\n<p>æ›´åŠ ä¸¥é‡çš„æ˜¯ï¼ŒJVMçš„ä¸€äº›åŸæœ‰è¯Šæ–­æˆ–å¤‡ç”¨æœºåˆ¶ä¹Ÿä¼šå—åˆ°å½±å“ã€‚ä¸ºä¿è¯æœåŠ¡çš„å¯ç”¨æ€§ï¼Œä¸€ç§å¸¸è§çš„é€‰æ‹©æ˜¯ä¾èµ–â€œ-XX:OnOutOfMemoryErrorâ€åŠŸèƒ½ï¼Œé€šè¿‡è°ƒç”¨å¤„ç†è„šæœ¬çš„å½¢å¼æ¥åšä¸€äº›è¡¥æ•‘æªæ–½ï¼Œæ¯”å¦‚è‡ªåŠ¨é‡å¯æœåŠ¡ç­‰ã€‚ä½†æ˜¯ï¼Œè¿™ç§æœºåˆ¶æ˜¯åŸºäºforkå®ç°çš„ï¼Œå½“Javaè¿›ç¨‹å·²ç»è¿‡åº¦æäº¤å†…å­˜æ—¶ï¼Œforkæ–°çš„è¿›ç¨‹å¾€å¾€å·²ç»ä¸å¯èƒ½æ­£å¸¸è¿è¡Œäº†ã€‚</p>\n<p>æ ¹æ®å‰é¢çš„æ€»ç»“ï¼Œä¼¼ä¹é—®é¢˜éå¸¸æ£˜æ‰‹ï¼Œé‚£æˆ‘ä»¬åœ¨å®è·µä¸­ï¼Œ<strong>å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜å‘¢ï¼Ÿ</strong></p>\n<p>é¦–å…ˆï¼Œå¦‚æœä½ èƒ½å¤Ÿ<strong>å‡çº§åˆ°æœ€æ–°çš„JDKç‰ˆæœ¬</strong>ï¼Œè¿™ä¸ªé—®é¢˜å°±è¿åˆƒè€Œè§£äº†ã€‚</p>\n<ul>\n<li>é’ˆå¯¹è¿™ç§æƒ…å†µï¼ŒJDK 9ä¸­å¼•å…¥äº†ä¸€äº›å®éªŒæ€§çš„å‚æ•°ï¼Œä»¥æ–¹ä¾¿Dockerå’ŒJavaâ€œæ²Ÿé€šâ€ï¼Œä¾‹å¦‚é’ˆå¯¹å†…å­˜é™åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‚æ•°è®¾ç½®ï¼š</li>\n</ul>\n<pre><code>-XX:+UnlockExperimentalVMOptions\n-XX:+UseCGroupMemoryLimitForHeap\n</code></pre>\n<p>æ³¨æ„ï¼Œè¿™ä¸¤ä¸ªå‚æ•°æ˜¯é¡ºåºæ•æ„Ÿçš„ï¼Œå¹¶ä¸”åªæ”¯æŒLinuxç¯å¢ƒã€‚è€Œå¯¹äºCPUæ ¸å¿ƒæ•°é™å®šï¼ŒJavaå·²ç»è¢«ä¿®æ­£ä¸ºå¯ä»¥æ­£ç¡®ç†è§£â€œâ€“cpuset-cpusâ€ç­‰è®¾ç½®ï¼Œæ— éœ€å•ç‹¬è®¾ç½®å‚æ•°ã€‚</p>\n<ul>\n<li>å¦‚æœä½ å¯ä»¥åˆ‡æ¢åˆ°JDK 10æˆ–è€…æ›´æ–°çš„ç‰ˆæœ¬ï¼Œé—®é¢˜å°±æ›´åŠ ç®€å•äº†ã€‚Javaå¯¹å®¹å™¨ï¼ˆDockerï¼‰çš„æ”¯æŒå·²ç»æ¯”è¾ƒå®Œå–„ï¼Œé»˜è®¤å°±ä¼šè‡ªé€‚åº”å„ç§èµ„æºé™åˆ¶å’Œå®ç°å·®å¼‚ã€‚å‰é¢æåˆ°çš„å®éªŒæ€§å‚æ•°â€œUseCGroupMemoryLimitForHeapâ€å·²ç»è¢«æ ‡è®°ä¸ºåºŸå¼ƒã€‚</li>\n</ul>\n<p>ä¸æ­¤åŒæ—¶ï¼Œæ–°å¢äº†å‚æ•°ç”¨ä»¥æ˜ç¡®æŒ‡å®šCPUæ ¸å¿ƒçš„æ•°ç›®ã€‚</p>\n<pre><code>-XX:ActiveProcessorCount=N\n</code></pre>\n<p>å¦‚æœå®è·µä¸­å‘ç°æœ‰é—®é¢˜ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨â€œ-XX:-UseContainerSupportâ€ï¼Œå…³é—­Javaçš„å®¹å™¨æ”¯æŒç‰¹æ€§ï¼Œè¿™å¯ä»¥ä½œä¸ºä¸€ç§é˜²å¾¡æ€§æœºåˆ¶ï¼Œé¿å…æ–°ç‰¹æ€§ç ´ååŸæœ‰åŸºç¡€åŠŸèƒ½ã€‚å½“ç„¶ï¼Œä¹Ÿæ¬¢è¿ä½ å‘OpenJDKç¤¾åŒºåé¦ˆé—®é¢˜ã€‚</p>\n<ul>\n<li>å¹¸è¿çš„æ˜¯ï¼ŒJDK 9ä¸­çš„å®éªŒæ€§æ”¹è¿›å·²ç»è¢«ç§»æ¤åˆ°Oracle JDK 8u131ä¹‹ä¸­ï¼Œä½ å¯ä»¥ç›´æ¥ä¸‹è½½ç›¸åº”<a href=\"https://store.docker.com/images/oracle-serverjre-8\">é•œåƒ</a>ï¼Œå¹¶é…ç½®â€œUseCGroupMemoryLimitForHeapâ€ï¼Œåç»­å¾ˆæœ‰å¯èƒ½è¿˜ä¼šè¿›ä¸€æ­¥å°†JDK 10ä¸­ç›¸å…³çš„å¢å¼ºï¼Œåº”ç”¨åˆ°JDK 8æœ€æ–°çš„æ›´æ–°ä¸­ã€‚</li>\n</ul>\n<p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘æš‚æ—¶åªèƒ½ä½¿ç”¨è€ç‰ˆæœ¬çš„JDKæ€ä¹ˆåŠï¼Ÿ</p>\n<p>æˆ‘è¿™é‡Œæœ‰å‡ ä¸ªå»ºè®®ï¼š</p>\n<ul>\n<li>æ˜ç¡®è®¾ç½®å †ã€å…ƒæ•°æ®åŒºç­‰å†…å­˜åŒºåŸŸå¤§å°ï¼Œä¿è¯Javaè¿›ç¨‹çš„æ€»å¤§å°å¯æ§ã€‚</li>\n</ul>\n<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½åœ¨ç¯å¢ƒä¸­ï¼Œè¿™æ ·é™åˆ¶å®¹å™¨å†…å­˜ï¼š</p>\n<pre><code>$ docker run -it --rm --name yourcontainer -p 8080:8080 -m 800M repo/your-java-container:openjdk\n</code></pre>\n<p>é‚£ä¹ˆï¼Œå°±å¯ä»¥é¢å¤–é…ç½®ä¸‹é¢çš„ç¯å¢ƒå˜é‡ï¼Œç›´æ¥æŒ‡å®šJVMå †å¤§å°ã€‚</p>\n<pre><code>-e JAVA_OPTIONS='-Xmx300m'\n</code></pre>\n<ul>\n<li>æ˜ç¡®é…ç½®GCå’ŒJITå¹¶è¡Œçº¿ç¨‹æ•°ç›®ï¼Œä»¥é¿å…äºŒè€…å ç”¨è¿‡å¤šè®¡ç®—èµ„æºã€‚</li>\n</ul>\n<pre><code>-XX:ParallelGCThreads\n-XX:CICompilerCount\n</code></pre>\n<p>é™¤äº†æˆ‘å‰é¢ä»‹ç»çš„OOMç­‰é—®é¢˜ï¼Œåœ¨å¾ˆå¤šåœºæ™¯ä¸­è¿˜å‘ç°Javaåœ¨Dockerç¯å¢ƒä¸­ï¼Œä¼¼ä¹ä¼šæ„å¤–ä½¿ç”¨Swapã€‚å…·ä½“åŸå› å¾…æŸ¥ï¼Œä½†å¾ˆæœ‰å¯èƒ½ä¹Ÿæ˜¯å› ä¸ºErgonomicsæœºåˆ¶å¤±æ•ˆå¯¼è‡´çš„ï¼Œæˆ‘å»ºè®®é…ç½®ä¸‹é¢å‚æ•°ï¼Œæ˜ç¡®å‘ŠçŸ¥JVMç³»ç»Ÿå†…å­˜é™é¢ã€‚</p>\n<pre><code>-XX:MaxRAM=`cat /sys/fs/cgroup/memory/memory.limit_in_bytes`\n</code></pre>\n<p>ä¹Ÿå¯ä»¥æŒ‡å®šDockerè¿è¡Œå‚æ•°ï¼Œä¾‹å¦‚ï¼š</p>\n<pre><code>--memory-swappiness=0\n</code></pre>\n<p>è¿™æ˜¯å—æ“ä½œç³»ç»Ÿ<a href=\"https://en.wikipedia.org/wiki/Swappiness\">Swappiness</a>æœºåˆ¶å½±å“ï¼Œå½“å†…å­˜æ¶ˆè€—è¾¾åˆ°ä¸€å®šé—¨é™ï¼Œæ“ä½œç³»ç»Ÿä¼šè¯•å›¾å°†ä¸æ´»è·ƒçš„è¿›ç¨‹æ¢å‡ºï¼ˆSwap outï¼‰ï¼Œä¸Šé¢çš„å‚æ•°æœ‰æ˜¾å¼å…³é—­Swapçš„ä½œç”¨ã€‚æ‰€ä»¥å¯ä»¥çœ‹åˆ°ï¼ŒJavaåœ¨Dockerä¸­çš„ä½¿ç”¨ï¼Œä»æ“ä½œç³»ç»Ÿã€å†…æ ¸åˆ°JVMè‡ªèº«æœºåˆ¶ï¼Œéœ€è¦ç»¼åˆè¿ç”¨æˆ‘ä»¬æ‰€æŒæ¡çš„çŸ¥è¯†ã€‚</p>\n<p>å›é¡¾æˆ‘åœ¨ä¸“æ ç¬¬25è®²JVMå†…å­˜åŒºåŸŸçš„ä»‹ç»ï¼ŒJVMå†…å­˜æ¶ˆè€—è¿œä¸æ­¢åŒ…æ‹¬å †ï¼Œå¾ˆå¤šæ—¶å€™ä»…ä»…è®¾ç½®Xmxæ˜¯ä¸å¤Ÿçš„ï¼ŒMaxRAMä¹Ÿæœ‰åŠ©äºJVMåˆç†åˆ†é…å…¶ä»–å†…å­˜åŒºåŸŸã€‚å¦‚æœåº”ç”¨éœ€è¦è®¾ç½®æ›´å¤šJavaå¯åŠ¨å‚æ•°ï¼Œä½†åˆä¸ç¡®å®šä»€ä¹ˆæ•°å€¼åˆç†ï¼Œå¯ä»¥è¯•è¯•ä¸€äº›ç¤¾åŒºæä¾›çš„<a href=\"https://github.com/cloudfoundry/java-buildpack-memory-calculator\">å·¥å…·</a>ï¼Œä½†è¦æ³¨æ„é€šç”¨å·¥å…·çš„å±€é™æ€§ã€‚</p>\n<p>æ›´è¿›ä¸€æ­¥æ¥è¯´ï¼Œå¯¹äºå®¹å™¨é•œåƒå¤§å°çš„é—®é¢˜ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯JDK 9ä»¥åçš„ç‰ˆæœ¬ï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨jlinkå·¥å…·å®šåˆ¶æœ€å°ä¾èµ–çš„Javaè¿è¡Œç¯å¢ƒï¼Œå°†JDKè£å‰ªä¸ºå‡ åMçš„å¤§å°ï¼Œè¿™æ ·è¿è¡Œèµ·æ¥å¹¶ä¸å›°éš¾ã€‚</p>\n<p>ä»Šå¤©æˆ‘ä»Dockerç¯å¢ƒä¸­Javaå¯èƒ½å‡ºç°çš„é—®é¢˜å¼€å§‹ï¼Œåˆ†æäº†ä¸ºä»€ä¹ˆå®¹å™¨ç¯å¢ƒå¯¹åº”ç”¨å¹¶ä¸é€æ˜ï¼Œä»¥åŠè¿™ç§åå·®å¹²æ‰°äº†JVMçš„ç›¸å…³æœºåˆ¶ã€‚æœ€åï¼Œæˆ‘ä»å®è·µå‡ºå‘ï¼Œä»‹ç»äº†ä¸»è¦é—®é¢˜çš„è§£å†³æ€è·¯ï¼Œå¸Œæœ›å¯¹ä½ åœ¨å®é™…å¼€å‘æ—¶æœ‰æ‰€å¸®åŠ©ã€‚</p>\n<h2>ä¸€è¯¾ä¸€ç»ƒ</h2>\n<p>å…³äºä»Šå¤©æˆ‘ä»¬è®¨è®ºçš„é¢˜ç›®ä½ åšåˆ°å¿ƒä¸­æœ‰æ•°äº†å—ï¼Ÿä»Šå¤©çš„æ€è€ƒé¢˜æ˜¯ï¼Œé’ˆå¯¹æˆ‘æåˆ°çš„å¾®æœåŠ¡å’ŒServerlessç­‰åœºæ™¯Javaè¡¨ç°å‡ºçš„ä¸è¶³ï¼Œæœ‰å“ªäº›æ–¹æ³•å¯ä»¥æ”¹å–„Javaçš„è¡¨ç°ï¼Ÿ</p>\n<p>è¯·ä½ åœ¨ç•™è¨€åŒºå†™å†™ä½ å¯¹è¿™ä¸ªé—®é¢˜çš„æ€è€ƒï¼Œæˆ‘ä¼šé€‰å‡ºç»è¿‡è®¤çœŸæ€è€ƒçš„ç•™è¨€ï¼Œé€ç»™ä½ ä¸€ä»½å­¦ä¹ å¥–åŠ±ç¤¼åˆ¸ï¼Œæ¬¢è¿ä½ ä¸æˆ‘ä¸€èµ·è®¨è®ºã€‚</p>\n<p>ä½ çš„æœ‹å‹æ˜¯ä¸æ˜¯ä¹Ÿåœ¨å‡†å¤‡é¢è¯•å‘¢ï¼Ÿä½ å¯ä»¥â€œè¯·æœ‹å‹è¯»â€ï¼ŒæŠŠä»Šå¤©çš„é¢˜ç›®åˆ†äº«ç»™å¥½å‹ï¼Œæˆ–è®¸ä½ èƒ½å¸®åˆ°ä»–ã€‚</p>\n<p></p>\n","comments":[{"had_liked":false,"id":17061,"user_name":"æ›²ä¸œæ–¹","can_delete":false,"product_type":"c1","uid":1177819,"ip_address":"","ucode":"6C3EA2F47A0B98","user_header":"https://static001.geekbang.org/account/avatar/00/11/f8/db/c4edf697.jpg","comment_is_top":false,"comment_ctime":1532401827,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"186215995555","product_id":100006701,"comment_content":"cpué—®é¢˜<br><br>java 10ä¹‹å‰ï¼š æ‰‹åŠ¨è®¾ç½®jvmç›¸å…³çš„é€‰é¡¹ï¼Œå¦‚ï¼š<br><br>    ParallelGCThreads<br>    ConcGCThreads<br>    G1ConcRefinementThreads<br>    CICompilerCount &#47; CICompilerCountPerCPU<br><br>java 10+: UseContainerSupportï¼Œ é»˜è®¤å¼€å¯<br><br>------------------------------------------------------------------<br>memé—®é¢˜<br><br>éœ€å…³æ³¨è¿™å‡ ä¸ªå‚æ•°ï¼š<br><br>    Xmx: 1&#47;4 * ç‰©ç†å†…å­˜<br>    MaxDirectMemorySize<br>        Xmx æœªè®¾ç½®ï¼Œç‰©ç†å†…å­˜<br>        Xmx è®¾ç½®äº†ï¼Œ Xmx - S0(1&#47;10 * Xmx) = 0.9 * Xmx # why? SurvivorRatioé»˜è®¤å€¼8<br>    MaxPermSize: é»˜è®¤64M<br>        [5.0+ 64 bit: 64M * 1.3 = 85M](http:&#47;&#47;www.oracle.com&#47;technetwork&#47;java&#47;javase&#47;tech&#47;vmoptions-jsp-140102.html)<br>    MaxMetaspaceSize: -1ï¼Œæ— é™åˆ¶<br><br>--------------------------------<br>java5&#47;6&#47;7&#47;8u131-ï¼šåŠ¡å¿…è®¾ç½®ä¸Šé¢æåˆ°çš„å†…å­˜é€‰é¡¹<br><br>  æ‡’äººå¯è€ƒè™‘ï¼Œè™½ç„¶ä¹Ÿä¸å‡†ç¡®<br>  java -Xmx`cat &#47;sys&#47;fs&#47;cgroup&#47;memory&#47;memory.limit_in_bytes`<br><br>java8u131+å’Œjava9+<br><br>\tjava 8u131+å’Œjava 9+-XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap<br>\tjava 8u191+ UseContainerSupporté»˜è®¤å¼€å¯ï¼Œbackportedï¼›java 9æš‚æœªbackportè¿™ä¸ªfeature<br><br>java 10+: UseContainerSupportï¼Œ é»˜è®¤å¼€å¯<br>------------------------------------------------------------------","like_count":44},{"had_liked":false,"id":105371,"user_name":"paopao","can_delete":false,"product_type":"c1","uid":1086724,"ip_address":"","ucode":"4D8247A5B57894","user_header":"https://static001.geekbang.org/account/avatar/00/10/95/04/dc153120.jpg","comment_is_top":false,"comment_ctime":1560990797,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"96050271309","product_id":100006701,"comment_content":"å¹´å‰å°±é‡åˆ°äº†æ–‡ä¸­Gcçº¿ç¨‹æ•°è¶…è¿‡k8sè®¾ç½®æ ¸å¿ƒæ•°ï¼Œjvmç›´æ¥æŒ‚æ‰ï¼Œçœ‹è¿™æ–‡ç« å°è±¡æ·±åˆ»","like_count":23},{"had_liked":false,"id":67274,"user_name":"Harryé™ˆç¥¥","can_delete":false,"product_type":"c1","uid":1016584,"ip_address":"","ucode":"EC44D97731116D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/83/08/91caf5c1.jpg","comment_is_top":false,"comment_ctime":1550119667,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"48794759923","product_id":100006701,"comment_content":"è€å¸ˆæ‚¨å¥½ã€‚å¯¹äºjava8+dockerçš„åœºæ™¯ï¼Œdockerçš„cpu å†…å­˜é…é¢æ˜¯å¯èƒ½åŠ¨æ€å˜åŒ–å’Œä¼¸ç¼©çš„ï¼Œ dockerå¯åŠ¨ä¹‹å‰ï¼Œä¸çŸ¥é“ä¼šè¢«åˆ†é…å¤šå¤§å†…å­˜å¤šå°‘cpuï¼Œè¿™ç§æƒ…å†µï¼Œåº”è¯¥æ€ä¹ˆå¤„ç†å‚æ•°é—®é¢˜ï¼Ÿ<br>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šdocker hubé‡Œé¢æœ‰javaå„ä¸ªç‰ˆæœ¬çš„é•œåƒï¼Œè¿™äº›é•œåƒæ˜¯å¦å·²ç»å¯¹æ–‡ä¸­æåˆ°çš„é—®é¢˜éƒ½åšäº†é€‚é…ï¼Ÿæˆ‘ä»¬åœ¨æ„å»ºdockerçš„æ—¶å€™ï¼Œç›´æ¥from javaé•œåƒï¼Œè€Œä¸å†è®¾ç½®java options ä¼šä¸ä¼šæœ‰é—®é¢˜ï¼Ÿ","like_count":12,"discussions":[{"author":{"id":1401685,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/oEicpuoN6vAdFuvIicibn6OsUIDIsMlWVkd21mcd53zjoBIXdiadZCXFkJDUUWPkHuheybQjxQLQnPuxRMpszXmQ4A/132","nickname":"Jovi","note":"","ucode":"E5D399A3E4F02A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":346057,"discussion_content":"è€å¸ˆå¹¶ä¸åµä½ ğŸ˜‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1611846568,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1110662,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f2/86/d689f77e.jpg","nickname":"Hank_Yan","note":"","ucode":"86899B561C502B","race_medal":3,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":289179,"discussion_content":"+1","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1594018640,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1018620,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8a/fc/d1dd57dd.jpg","nickname":"ipofss","note":"","ucode":"DE3061C9259F9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391451,"discussion_content":"åŒé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630470152,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":28500,"user_name":"sgl","can_delete":false,"product_type":"c1","uid":1252243,"ip_address":"","ucode":"D73875BA22954F","user_header":"https://static001.geekbang.org/account/avatar/00/13/1b/93/e3b44969.jpg","comment_is_top":false,"comment_ctime":1538097162,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23012933642","product_id":100006701,"comment_content":"æ²¡æœ‰ä¸€ç§æŠ€æœ¯æ˜¯ä¸‡èƒ½çš„ï¼Œéœ€è¦ç†è§£æŠ€æœ¯çš„ä¼˜ç‚¹å’Œä¸è¶³ï¼Œæ‰èƒ½ä½¿ç”¨å¥½å®ƒ","like_count":5},{"had_liked":false,"id":19920,"user_name":"å¤§å«æ","can_delete":false,"product_type":"c1","uid":1012163,"ip_address":"","ucode":"CFEB849481BCB3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/71/c3/09e22c1d.jpg","comment_is_top":false,"comment_ctime":1534163695,"is_pvip":false,"replies":[{"id":"7053","content":"å¯ä»¥è¯•éªŒä¸€ä¸‹ï¼Œæˆ‘åœ¨å¤–é¢ä¸å¥½ç¿»æ–‡æ¡£ï¼Œä½†åº”è¯¥oracle jdkæ˜¯æœ‰çš„ï¼Œopenjdkå¯ä»¥è¯´æ˜¯oracle jdkçš„å­é›†<br>","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1534319059,"ip_address":"","comment_id":19920,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23009000175","product_id":100006701,"comment_content":"MAXRAMè¿™ä¸ªå‚æ•°å¥½åƒæ˜¯openjdkçš„ï¼Œoracle jdkæ–‡æ¡£é‡Œæ²¡æœ‰æ‰¾åˆ°","like_count":5,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":422021,"discussion_content":"å¯ä»¥è¯•éªŒä¸€ä¸‹ï¼Œæˆ‘åœ¨å¤–é¢ä¸å¥½ç¿»æ–‡æ¡£ï¼Œä½†åº”è¯¥oracle jdkæ˜¯æœ‰çš„ï¼Œopenjdkå¯ä»¥è¯´æ˜¯oracle jdkçš„å­é›†\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1534319059,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":18844,"user_name":"æ­£æ˜¯é‚£æœµç«ç‘°","can_delete":false,"product_type":"c1","uid":1048261,"ip_address":"","ucode":"73D630B654573F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fe/c5/3467cf94.jpg","comment_is_top":false,"comment_ctime":1533598931,"is_pvip":false,"replies":[{"id":"6582","content":"æœ‰æ’æŸ¥å…¶ä»–è¿›ç¨‹å—ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1533628444,"ip_address":"","comment_id":18844,"utype":1}],"discussion_count":3,"race_medal":0,"score":"23008435411","product_id":100006701,"comment_content":"è€å¸ˆå¥½ï¼Œå†æè¿°ä¸‹æˆ‘ä»¬çš„åœºæ™¯ï¼Œæˆ‘ä»¬åœ¨çº¿ä¸Šç¯å¢ƒçš„å‚æ•°æ˜¯ï¼šxmx1gï¼Œæ°¸ä¹…å¸¦256mï¼Œdockeré™åˆ¶2.2gï¼Œå…¶ä»–å¹¶æ²¡æœ‰è®¾ç½®ï¼Œæˆ‘ä»¬ä¹Ÿæ€€ç–‘æ˜¯ä¸æ˜¯å †å¤–å†…å­˜æœ‰é—®é¢˜ï¼Œäºæ˜¯åœ¨å‡†ç”Ÿäº§ç¯å¢ƒä¿®æ”¹äº†å‚æ•°è¿›è¡Œæµ‹è¯•ï¼Œè®¾ç½®äº†MaxRAM1gï¼Œå †å¤–æ•…æ„è®¾å°128mï¼Œç„¶åè¿›è¡Œæµ‹è¯•ï¼Œç”¨jconsoleè¿›è¡Œç›‘æ§ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°dockerå®¹å™¨çš„å†…å­˜ä¸æ–­é£™å‡ï¼Œåªå‡ä¸é™ï¼Œè€Œjconsoleç›‘æ§çš„å´å¾ˆæ­£å¸¸ï¼Œyoung gcå¾ˆé¢‘ç¹ï¼Œä½†æ˜¯full gcä¸€æ¬¡æ²¡æœ‰ï¼Œå½“dockerå†…å­˜æ¥è¿‘è®¾ç½®çš„2.2gæ—¶ï¼Œjavaè¿›ç¨‹å°±åŸºæœ¬è¦è¢«killæ‰äº†ï¼Œæ²¡æœ‰ä»»ä½•å†…å­˜æº¢å‡ºçš„å¼‚å¸¸ï¼","like_count":5,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":421662,"discussion_content":"æœ‰æ’æŸ¥å…¶ä»–è¿›ç¨‹å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1533628444,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1052718,"avatar":"https://static001.geekbang.org/account/avatar/00/10/10/2e/1a0e7c59.jpg","nickname":"ç†Šå­©å­é©¬æ´›ä¼Š","note":"","ucode":"C907D62052FB4E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":178649,"discussion_content":"çœ‹çœ‹dockerå†…çš„å“ªäº›çº¿ç¨‹è°ƒç”¨å ç”¨äº†å¤§é‡å†…å­˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582185276,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1033066,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c3/6a/3272e095.jpg","nickname":"ææ˜¥æ’","note":"","ucode":"F2DCA19EC66DC1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":117648,"discussion_content":"å¯ä»¥å°è¯•ç”¨dmesg çœ‹ä¸‹oom killer äº†å“ªä¸ªè¿›ç¨‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578132939,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":15815,"user_name":"å¡æ–¯ç“¦å¾·","can_delete":false,"product_type":"c1","uid":1011332,"ip_address":"","ucode":"E944E5BC507D5C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6e/84/45a909a6.jpg","comment_is_top":false,"comment_ctime":1531536406,"is_pvip":false,"replies":[{"id":"5467","content":"1ï¼Œæ³•å¾‹é—®é¢˜æˆ‘ä¸çŸ¥é“ä¸è¯„ä»·ã€‚ä¸ªäººå»ºè®®çœ‹æ¸…äº‹å®ï¼Œè«è¢«äººprï¼›2ï¼Œæ˜¯ï¼Œå‡ºé—®é¢˜æ˜¯æç«¯æƒ…å†µï¼Œå¤§éƒ¨åˆ†åœºæ™¯å¹¶ä¸å¤æ‚ï¼›3ï¼Œå…·ä½“æˆ‘åªæ³¨æ„åˆ°æœ‰äººååº”é—®é¢˜ï¼Œä½†æ²¡æœ‰ç»†èŠ‚ï¼›å›åˆ°ä¸€äº›å¸¸è§å®è·µï¼Œä¾‹å¦‚ç”¨G1ï¼Œå¦‚æœååé‡ä¸è¾¾æ ‡ï¼Œé€šå¸¸è°ƒä¼˜å †å¤§å°è®¾ç½®ä¸ºå°½é‡å¤§ä½†åˆswapä¸å‘ç”Ÿï¼Œä¸ç„¶ä¼šå½±å“ååé‡ï¼›4ï¼Œå¾ˆæ„Ÿè°¢æä¾›è¿™ä¸ªæ¡ˆä¾‹ï¼Œäº†è§£å…·ä½“é—®é¢˜å—","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1531571656,"ip_address":"","comment_id":15815,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23006372886","product_id":100006701,"comment_content":"1.è€å¸ˆå¬è¯´dockeré‡Œé¢åªèƒ½ç”¨open-jdkä½¿ç”¨oracle-jdkæ˜¯æœ‰æ³•å¾‹é£é™©çš„ï¼Œç°åœ¨è¿˜æ˜¯è¿™æ ·ä¹ˆï¼Ÿ            2.jdk8è®¾ç½®äº†-xmxå€¼å°äºdockerè®¾å®šçš„å€¼å°±å¥½ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†docker-composeè²Œä¼¼è¿™ä¸ªåªæœ‰è®¾å®šå†…å­˜ä½¿ç”¨ä¸Šé™ï¼Œä½†æ˜¯ä¸è¶…è¿‡è¿™ä¸ªå€¼ä¸€èˆ¬æ²¡é—®é¢˜ï¼Œ3.è‡³äºswapæ²¡æœ‰é‡è§è¿‡ï¼Œèƒ½èƒ½è®²ä½•æ—¶ä¼šå‡ºç°ä¹ˆï¼Œå¥½é¢„è­¦ä¸‹ã€‚                                                                  4.è¯´ä¸ªdockeré‡åˆ°ç›¸å…³é—®é¢˜å°±æ˜¯jdbcé©±åŠ¨ï¼Œè²Œä¼¼mysql5.14ä»¥å‰çš„é©±åŠ¨å¯¹dockerä¸å‹å¥½ï¼Œå¦‚æœselect countï¼ˆ*ï¼‰ from table è¿™ä¸ªå€¼è¶…è¿‡5000å°±ä¼šæ‹¿ä¸åˆ°ç»“æœï¼Œè€Œå®é™…mysql-serverç«¯å·²ç»æ‰§è¡Œå®Œæ¯•å¹¶ä¸”sleepäº†","like_count":5,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420564,"discussion_content":"1ï¼Œæ³•å¾‹é—®é¢˜æˆ‘ä¸çŸ¥é“ä¸è¯„ä»·ã€‚ä¸ªäººå»ºè®®çœ‹æ¸…äº‹å®ï¼Œè«è¢«äººprï¼›2ï¼Œæ˜¯ï¼Œå‡ºé—®é¢˜æ˜¯æç«¯æƒ…å†µï¼Œå¤§éƒ¨åˆ†åœºæ™¯å¹¶ä¸å¤æ‚ï¼›3ï¼Œå…·ä½“æˆ‘åªæ³¨æ„åˆ°æœ‰äººååº”é—®é¢˜ï¼Œä½†æ²¡æœ‰ç»†èŠ‚ï¼›å›åˆ°ä¸€äº›å¸¸è§å®è·µï¼Œä¾‹å¦‚ç”¨G1ï¼Œå¦‚æœååé‡ä¸è¾¾æ ‡ï¼Œé€šå¸¸è°ƒä¼˜å †å¤§å°è®¾ç½®ä¸ºå°½é‡å¤§ä½†åˆswapä¸å‘ç”Ÿï¼Œä¸ç„¶ä¼šå½±å“ååé‡ï¼›4ï¼Œå¾ˆæ„Ÿè°¢æä¾›è¿™ä¸ªæ¡ˆä¾‹ï¼Œäº†è§£å…·ä½“é—®é¢˜å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1531571656,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":272042,"user_name":"éšå¿ƒè€Œè‡³","can_delete":false,"product_type":"c1","uid":1097836,"ip_address":"","ucode":"31866865255101","user_header":"https://static001.geekbang.org/account/avatar/00/10/c0/6c/29be1864.jpg","comment_is_top":false,"comment_ctime":1609916828,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10199851420","product_id":100006701,"comment_content":"æœ¬ç§‘æ¯•ä¸šä¸¤å¹´äº†ï¼Œæ‰“äº†ä¸¤å¹´å¤šçš„è®¡ç®—æœºç§‘å­¦çš„åŸºç¡€ï¼Œåç«¯è¿™äº›éƒ½æ˜¯é€šç”¨çš„ï¼Œç¼–ç¨‹è¯­è¨€çœŸçš„åªæ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå®¹å™¨ç›¸å…³çš„åŸç†è¿˜æ˜¯éœ€è¦å­¦ä¹ ï¼Œè¦ä¸ç„¶ç©ä¸è½¬ã€‚","like_count":3},{"had_liked":false,"id":18976,"user_name":"æ­£æ˜¯é‚£æœµç«ç‘°","can_delete":false,"product_type":"c1","uid":1048261,"ip_address":"","ucode":"73D630B654573F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fe/c5/3467cf94.jpg","comment_is_top":false,"comment_ctime":1533628812,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10123563404","product_id":100006701,"comment_content":"ç›®å‰å®¹å™¨åªè·‘äº†javaå’Œconsulçš„clientè¿›ç¨‹ï¼Œconsulå çš„å†…å­˜å¾ˆå°ï¼Œjavaè¿›ç¨‹è¢«killæ‰åï¼Œconsulè¿›ç¨‹è¿˜åœ¨ï¼Œæˆ‘ä»¬çš„javaè¿›ç¨‹è¢«killæ‰éƒ½æ˜¯åœ¨æ²¡æœ‰æµé‡è¿›æ¥çš„æ—¶å€™ï¼Œä¸è¿‡æ‚¨è¯´çš„ä½¿ç”¨swapåŒºçš„æˆ‘æ²¡æœ‰è®¾ç½®ï¼Œä¸çŸ¥é“æœ‰æ²¡æœ‰ä»€ä¹ˆå½±å“ï¼Ÿ","like_count":2},{"had_liked":false,"id":18716,"user_name":"æ­£æ˜¯é‚£æœµç«ç‘°","can_delete":false,"product_type":"c1","uid":1048261,"ip_address":"","ucode":"73D630B654573F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fe/c5/3467cf94.jpg","comment_is_top":false,"comment_ctime":1533555901,"is_pvip":false,"replies":[{"id":"6555","content":"å®¹å™¨å†…å­˜é™åˆ¶ï¼Œjava xmx MaxDirectMemorySizeä¹‹ç±»éƒ½æ˜¯å¤šå¤§ï¼Ÿæˆ‘ä»¬è¯´è¿‡å†…å­˜ä¸åªæ˜¯å †ï¼Œè¿˜æœ‰ä¸€äº›åœ¨å †å¤–ï¼Œéœ€è¦ç•™ç‚¹å„¿ä½™åœ°ï¼›killçš„æ—¶é—´ç‚¹é™„è¿‘æœ‰æ”¶é›†ä»€ä¹ˆä¿¡æ¯æ²¡æœ‰","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1533566840,"ip_address":"","comment_id":18716,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10123490493","product_id":100006701,"comment_content":"è€å¸ˆï¼Œæœ‰ä¸ªé—®é¢˜æƒ³å’¨è¯¢ä¸‹ï¼Œæˆ‘ä»¬ç°åœ¨è¿ç§»åˆ°dockerç¯å¢ƒï¼Œä½¿ç”¨çš„è¿˜æ˜¯java7ï¼Œæ‚¨è¯´çš„é‚£äº›å‚æ•°æˆ‘ä»¬éƒ½æœ‰è®¾ç½®ï¼Œæ¯”å¦‚dockerå®¹å™¨å†…å­˜å¤§å°ï¼Œæœ€å¤§å †å†…å­˜ï¼ŒMaxRAMç­‰ï¼Œç°åœ¨çš„é—®é¢˜æ˜¯javaåº”ç”¨åœ¨dockerä¸Šè·‘ä¸€æ®µæ—¶é—´å°±ä¼šè¢«killæ‰ï¼Œæˆ‘ä»¬ç›‘æ§å†…å­˜æƒ…å†µæ˜¯dockerå®¹å™¨å†…å­˜ä½¿ç”¨å‡ ä¹è¢«å æ»¡ï¼Œä½†æ˜¯jvmçš„å†…å­˜ä½¿ç”¨å´å¾ˆæ­£å¸¸ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Ÿè€å¸ˆèƒ½å¦æŒ‡ç‚¹ä¸‹æ€è·¯ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":421639,"discussion_content":"å®¹å™¨å†…å­˜é™åˆ¶ï¼Œjava xmx MaxDirectMemorySizeä¹‹ç±»éƒ½æ˜¯å¤šå¤§ï¼Ÿæˆ‘ä»¬è¯´è¿‡å†…å­˜ä¸åªæ˜¯å †ï¼Œè¿˜æœ‰ä¸€äº›åœ¨å †å¤–ï¼Œéœ€è¦ç•™ç‚¹å„¿ä½™åœ°ï¼›killçš„æ—¶é—´ç‚¹é™„è¿‘æœ‰æ”¶é›†ä»€ä¹ˆä¿¡æ¯æ²¡æœ‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1533566840,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2324073,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/ziaicqaAJT18CS3xlPgGmLyicMkYiarDhSR9I79DnIjxpnETjOoHe9DM7wmC0icdw1XzwPDKF4TEFuqRicqSgyFtTtBQ/132","nickname":"Geek_c57a51","note":"","ucode":"843AE20C5610BD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344874,"discussion_content":"dmesg -T çœ‹ä¸‹log","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611597361,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":214694,"user_name":"Shy","can_delete":false,"product_type":"c1","uid":1364424,"ip_address":"","ucode":"97EC8ACA32F129","user_header":"https://static001.geekbang.org/account/avatar/00/14/d1/c8/bf71ac51.jpg","comment_is_top":false,"comment_ctime":1588783013,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5883750309","product_id":100006701,"comment_content":"è€å¸ˆï¼Œæˆ‘åœ¨å®¹å™¨ä¸­éƒ¨ç½²Javaåº”ç”¨æ—¶é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œåº”ç”¨ä¸­å­˜åœ¨ä¸€äº›jarå†²çªï¼Œä½†åœ¨ç‰©ç†æœºä¸Šèƒ½æ­£å¸¸å¯åŠ¨ï¼Œæ”¾åˆ°å®¹å™¨ä¸­å¿…å®šä¼šå¯åŠ¨å¤±è´¥ï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ","like_count":1},{"had_liked":false,"id":335140,"user_name":"æ¨±å°è·¯ä¾ç„¶","can_delete":false,"product_type":"c1","uid":1269957,"ip_address":"","ucode":"DBA9FF68015FE5","user_header":"https://static001.geekbang.org/account/avatar/00/13/60/c5/69286d58.jpg","comment_is_top":false,"comment_ctime":1645353193,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1645353193","product_id":100006701,"comment_content":"æ—¶éš”ä¸‰å¹´å¤šå†æ¬¡çœ‹è¿™ä¸ªä¸“æ ï¼Œåˆæœ‰ä¸ä¸€æ ·çš„æ„Ÿå—ï¼Œå½“åˆå¯¹dockeræ ¹æœ¬æ²¡ä»€ä¹ˆæ¦‚å¿µï¼Œç°åœ¨å…¬å¸å†…å·²ç»å…¨éƒ¨å®¹å™¨åŒ–äº†ï¼Œä½†æ˜¯å¯¹æœåŠ¡åœ¨å®¹å™¨ä¸Šè·‘ä¼šå‡ºç°è¿™äº›é—®é¢˜ç«Ÿç„¶æ²¡ä»€ä¹ˆå°è±¡ã€‚å›è¿‡å¤´çœ‹ï¼Œå¯èƒ½æ˜¯å› ä¸ºæœåŠ¡å¯åŠ¨è„šæœ¬æ—©å°±é…ç½®å¥½äº†å…·ä½“å‚æ•°è€Œæˆ‘ä¹Ÿæ²¡æœ‰å¤šæ³¨æ„ï¼Œå­¦ä¹ åˆ°äº†ï¼Œè°¢è°¢è€å¸ˆ","like_count":1},{"had_liked":false,"id":285075,"user_name":"Î»-Drive","can_delete":false,"product_type":"c1","uid":1007176,"ip_address":"","ucode":"E6A91B142BF7E1","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5e/48/4ad04a37.jpg","comment_is_top":false,"comment_ctime":1616599724,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616599724","product_id":100006701,"comment_content":"è€å¸ˆï¼Œdockerä¼šè¿‡åº¦ä½¿ç”¨å®¿ä¸»æœºcpuçš„èµ„æºå—ï¼Ÿ","like_count":0},{"had_liked":false,"id":65449,"user_name":"è‹¦è¡Œåƒ§","can_delete":false,"product_type":"c1","uid":1055334,"ip_address":"","ucode":"726024A9A9CF44","user_header":"https://static001.geekbang.org/account/avatar/00/10/1a/66/2d9db9ed.jpg","comment_is_top":false,"comment_ctime":1549364976,"is_pvip":false,"replies":[{"id":"23350","content":"å—¯å‘¢","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1549818625,"ip_address":"","comment_id":65449,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1549364976","product_id":100006701,"comment_content":"ç›®å‰åœ¨å®é™…å·¥ä½œä¸­è¿˜æ²¡æœ‰ä½¿ç”¨è¿‡docker","like_count":1,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438455,"discussion_content":"å—¯å‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549818625,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}