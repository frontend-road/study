{"id":774403,"title":"06ï½œå¾ªç¯è¯­å¥ï¼šæ§åˆ¶æµè®©è™šæ‹Ÿæœºæ‰§è¡Œå¤æ‚çš„è¿ç®—","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æµ·çº³ã€‚</p><p>ä¸Šä¸€èŠ‚è¯¾æˆ‘ä»¬ä»‹ç»äº†æ§åˆ¶æµä¸­çš„ç¬¬ä¸€ç§åŸºæœ¬ç»“æ„â€”â€”åˆ†æ”¯è¯­å¥ã€‚è¿™ä¸€èŠ‚è¯¾æˆ‘ä»¬ä¼šä»‹ç»ç¬¬äºŒç§åŸºæœ¬ç»“æ„â€”â€”å¾ªç¯è¯­å¥ã€‚</p><p>Python ä¸­æœ‰ä¸¤ç§å¾ªç¯ç»“æ„ï¼Œåˆ†åˆ«æ˜¯ while è¯­å¥å’Œ for è¯­å¥ã€‚Python ä¸­çš„ while è¯­å¥å’Œå…¶ä»–è¯­è¨€ä¸­çš„ while è¯­å¥å·®ä¸å¤šï¼Œä½†æ˜¯ for è¯­å¥å´å’Œ Cã€C++ã€Java ç­‰å¸¸è§è¯­è¨€æœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼ŒPython ä¸­çš„ for è¯­å¥æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªè¿­ä»£å™¨ã€‚æˆ‘ä»¬è¦ç­‰åˆ°å®ç°äº†ç±»æœºåˆ¶ä»¥åï¼Œæ‰èƒ½å®ç°è¿­ä»£å™¨ï¼Œæ‰€ä»¥è¿™èŠ‚è¯¾æˆ‘ä»¬çš„é‡ç‚¹æ˜¯å®ç° while å¾ªç¯ã€‚</p><h2>å®ç°å˜é‡</h2><p>è¦å®ç°å¾ªç¯ç»“æ„ï¼Œé¦–å…ˆå°±è¦å®ç°å˜é‡ã€‚åœ¨æ¯æ¬¡å¾ªç¯ä¸­ï¼Œå˜é‡éƒ½åº”è¯¥æœ‰æ‰€å˜åŒ–ï¼Œè¿™æ ·æ‰èƒ½åœ¨è‹¥å¹²æ¬¡å¾ªç¯ä»¥åï¼Œç ´åå¾ªç¯ç»§ç»­çš„æ¡ä»¶ï¼Œä»è€Œè·³å‡ºè¿™ä¸ªå¾ªç¯ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±å®ç°è¿™ä¸ªå˜é‡æœºåˆ¶ã€‚æˆ‘ä»¬è¿˜æ˜¯ä»ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­å¼€å§‹ã€‚</p><pre><code class=\"language-python\">a = 1\nb = a + 1\nprint(a)\nprint(b)\n</code></pre><p>æˆ‘ä»¬æŒ‰ç…§ä»¥å‰çš„æ–¹æ³•æŠŠå®ƒç¼–è¯‘æˆ pyc æ–‡ä»¶ï¼Œç„¶åé€šè¿‡ show_file å·¥å…·æŸ¥çœ‹å®ƒçš„å­—èŠ‚ç ã€‚</p><pre><code class=\"language-python\">&nbsp; 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 LOAD_CONST&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 (1)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 STORE_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 (a)\n\n&nbsp; 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 (a)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 6 LOAD_CONST&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 (1)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8 BINARY_ADD\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10 STORE_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 (b)\n\n&nbsp; 3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 12 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 (print)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;14 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 (a)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;16 CALL_FUNCTION&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;18 POP_TOP\n\n&nbsp; 4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 20 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 (print)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;22 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 (b)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;24 CALL_FUNCTION&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;26 POP_TOP\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;28 LOAD_CONST&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 (None)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;30 RETURN_VALUE\n&nbsp; &nbsp;consts\n&nbsp; &nbsp; &nbsp; 1\n&nbsp; &nbsp; &nbsp; None\n&nbsp; &nbsp;names ('a', 'b', 'print')\n&nbsp; &nbsp;varnames ()\n&nbsp; &nbsp;freevars ()\n&nbsp; &nbsp;cellvars ()\n</code></pre><!-- [[[read_end]]] --><p>åœ¨è¿™ä¸ªåç¼–è¯‘çš„ç»“æœä¸­å‡ºç°äº†ä¸€ä¸ªæ–°çš„å­—èŠ‚ç ï¼š<strong>STORE_NAME</strong>ï¼ˆç¬¬2è¡Œï¼‰ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°ï¼Œnames è¡¨é‡Œé™¤äº† print ä¹‹å¤–åˆå‡ºç°äº†ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒä»¬æ­£å¥½å°±æ˜¯æµ‹è¯•ä»£ç é‡Œä½¿ç”¨çš„é‚£ä¸¤ä¸ªå˜é‡ï¼ša å’Œ bã€‚</p><p>åœ¨ä»‹ç» pyc æ–‡ä»¶ç»“æ„çš„æ—¶å€™ï¼Œæˆ‘ä»¬å·²ç»è¯´è¿‡äº†ï¼Œnames è¡¨é‡Œæ”¾çš„æ˜¯ CodeObject æ‰€ä½¿ç”¨çš„å˜é‡çš„åå­—ï¼Œè¿™é‡Œæ­£å¥½é€šè¿‡å®ä¾‹éªŒè¯äº†è¿™ä¸€è¯´æ³•ã€‚</p><p>å°±åƒåå­—é‡Œæš—ç¤ºçš„é‚£æ ·ï¼ŒSTORE_NAME å’Œ LOAD_NAME è·Ÿ names è¡¨æœ‰å…³ç³»ã€‚åœ¨ç¬¬ä¸€èŠ‚è¯¾çš„å›¾é‡Œï¼Œé™¤äº†æ“ä½œæ•°æ ˆä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå˜é‡è¡¨ã€‚å˜é‡è¡¨çš„ä½œç”¨æ˜¯è®°å½•åœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå˜é‡çš„å®é™…å€¼æ˜¯å¤šå°‘ã€‚</p><p>è¦å®ç°è¿™ä¸¤ä¸ªå­—èŠ‚ç ï¼Œæˆ‘ä»¬å°±å¿…é¡»è¦å…ˆå®ç°å˜é‡è¡¨ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/32/a7/324197e998ee7d274439d6ae1318aaa7.png?wh=2548x1264\" alt=\"å›¾ç‰‡\"></p><p>å˜é‡è¡¨æ˜¯ä¸€ä¸ªå…¸å‹çš„é”®å€¼ï¼ˆkey-valueï¼‰äºŒå…ƒç»“æ„ï¼Œå®ƒæ˜¯ä¸€å¼ è¡¨ï¼Œæ¯ä¸ªé”®ï¼ˆkeyï¼‰éƒ½å¯¹åº”ç€ä¸€ä¸ªå€¼ï¼ˆvalueï¼‰ï¼Œé”®åœ¨è¿™å¼ è¡¨é‡Œæ˜¯å”¯ä¸€çš„ï¼Œä¸èƒ½é‡å¤ã€‚</p><p>è¿™ç§ç»“æ„ï¼Œæˆ‘ä»¬é€šå¸¸ç§°ä¹‹ä¸º mapã€‚map çš„å®ç°æœ‰å¾ˆå¤šç§ï¼Œæœ€å¸¸è§çš„æœ‰åŸºäºå“ˆå¸Œè¡¨çš„ HashMapï¼Œè¿˜æœ‰åŸºäºäºŒå‰æ’åºæ ‘çš„ BinaryMap ç­‰ã€‚ç”±äº HashMap è¦å®šä¹‰é”®çš„å“ˆå¸Œå‡½æ•°ï¼Œè€Œæœ‰åºçš„ map åˆéœ€è¦é”®ä¹‹é—´çš„ååºå…³ç³»ï¼Œæ‰€ä»¥æˆ‘ä»¬æš‚æ—¶éƒ½å…ˆä¸é‡‡ç”¨ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¸€ç§æœ€ç®€å•çš„æ–¹å¼ï¼š<strong>ç›´æ¥ä½¿ç”¨æ•°ç»„å®ç°</strong>ã€‚å½“æ’å…¥ä¸€ä¸ªé”®å€¼å¯¹çš„æ—¶å€™ï¼Œå¦‚æœ map é‡Œä¸åŒ…å« keyï¼Œå°±ç›´æ¥æ’å…¥ã€‚å¦‚æœå·²ç»åŒ…å«äº† keyï¼Œå°±æŠŠå®ƒåŸæ¥çš„å€¼æ›´æ–°æˆæ–°çš„å€¼ã€‚æŸ¥è¯¢çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯éå†æ•´ä¸ªæ•°ç»„ï¼Œæ‰¾åˆ°ä¸æŸ¥è¯¢çš„é”®ç›¸ç­‰çš„é‚£ä¸ªé”®ï¼Œè¿”å›å¯¹åº”çš„å€¼ã€‚</p><p>è¿™é‡Œæˆ‘ç»™å‡ºä¸€ä¸ªç®€å•çš„å®ç°ã€‚</p><pre><code class=\"language-c++\">template &lt;typename K, typename V&gt;\nclass MapEntry {\npublic:\n    K _k;\n    V _v;\n    \n    MapEntry(const MapEntry&lt;K, V&gt;&amp; entry);\n    MapEntry(K k, V v) : _k(k), _v(v) {}\n    MapEntry() : _k(0), _v(0) {}\n};\n\ntemplate &lt;typename K, typename V&gt;\nclass Map {\nprivate:\n    MapEntry&lt;K, V&gt;* _entries;\n    int _size;\n    int _length;\n    \n    void expand();\npublic:\n    Map();\n\n    int  size() { return _size; }\n    void put(K k, V v);\n    V    get(K k);\n    K    get_key(int index);\n    bool has_key(K k);\n    V    remove(K k);\n    int  index(K k);\n    MapEntry&lt;K, V&gt;* entries() { return _entries; }\n};\n</code></pre><p>Map çš„å®šä¹‰ä¸ ArrayList ååˆ†ç›¸ä¼¼ï¼Œå†…å­˜éƒ½æ˜¯å¯ä»¥æŒ‰éœ€å¢é•¿çš„ã€‚å…¶ä¸­ï¼Œput æ–¹æ³•å¯ä»¥æŠŠé”®å€¼å¯¹å­˜å…¥ Map ç»“æ„ä¸­ã€‚index æ–¹æ³•å¯ä»¥è¿”å›å‚æ•° k åœ¨ _entries æ•°ç»„ä¸­çš„åºå·ã€‚å…¶ä»–çš„æ–¹æ³•ï¼Œæ¯”å¦‚getã€removeï¼Œéƒ½å’Œå®ƒä»¬åå­—æ‰€æŒ‡ç¤ºçš„æ„ä¹‰ä¸€æ ·ï¼Œç”¨äºè·å–å€¼å’Œåˆ é™¤é”®å€¼å¯¹ã€‚</p><p>æ¥ä¸‹æ¥å°±å¯ä»¥å®ç° Map é‡Œå®šä¹‰çš„æ‰€æœ‰å‡½æ•°äº†ã€‚æˆ‘å»ºè®®ä½ ä¸è¦ç…§ç€è¯¾ç¨‹ä¸­çš„ä»£ç æŠ„ï¼Œæœ€å¥½æ˜¯è‡ªå·±å®ç°ä¸€é Map è¿™ç§ç»“æ„ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç»ƒæ‰‹æœºä¼šã€‚ä¸ºäº†æé«˜ç¼–ç¨‹æ°´å¹³ï¼Œä¸æ–­åœ°ç»ƒä¹ æ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p><pre><code class=\"language-c++\">template &lt;typename K, typename V&gt;\nMap&lt;K, V&gt;::Map() {\n    _entries = new MapEntry&lt;K, V&gt;[8];\n    _length  = 8;\n    _size    = 0;\n}\n\ntemplate &lt;typename K, typename V&gt;\nMapEntry&lt;K, V&gt;::MapEntry(const MapEntry&lt;K, V&gt;&amp; entry) {\n    _k = entry._k;\n    _v = entry._v;\n}\n\ntemplate &lt;typename K, typename V&gt;\nvoid Map&lt;K, V&gt;::put(K k, V v) {\n    for (int i = 0; i &lt; _size; i++) {\n        if (_entries[i]._k-&gt;equal(k) == Universe::HiTrue) {\n            _entries[i]._v = v;\n            return;\n        }\n    }\n    \n    expand();\n    _entries[_size++] = MapEntry&lt;K, V&gt;(k, v);\n}\n\ntemplate &lt;typename K, typename V&gt;\nbool Map&lt;K, V&gt;::has_key(K k) {\n    int i = index(k);\n    return i &gt;= 0;\n}\n\ntemplate &lt;typename K, typename V&gt;\nV Map&lt;K, V&gt;::get(K k) {\n    int i = index(k);\n    if (i &lt; 0)\n        return Universe::HiNone;\n    else\n        return _entries[i]._v;\n}\n\ntemplate &lt;typename K, typename V&gt;\nint Map&lt;K, V&gt;::index(K k) {\n    for (int i = 0; i &lt; _size; i++) {\n        if (_entries[i]._k-&gt;equal(k) == Universe::HiTrue) {\n            return i;\n        }\n    }\n\n    return -1;\n}\n\ntemplate &lt;typename K, typename V&gt;\nvoid Map&lt;K, V&gt;::expand() {\n    if (_size &gt;= _length) {\n        MapEntry&lt;K, V&gt;* new_entries = new MapEntry&lt;K, V&gt;[_length &lt;&lt; 1];\n        for (int i = 0; i &lt; _size; i++) {\n            new_entries[i] = _entries[i];\n        }\n        _length &lt;&lt;= 1;\n        delete[] _entries;\n        _entries = new_entries;\n    }\n}\n\ntemplate &lt;typename K, typename V&gt;\nV Map&lt;K, V&gt;::remove(K k) {\n    int i = index(k);\n\n    if (i &lt; 0)\n        return 0; \n\n    V v = _entries[i]._v;\n    _entries[i] = _entries[--_size];\n    return v;\n}\n\ntemplate &lt;typename K, typename V&gt;\nK Map&lt;K, V&gt;::get_key(int index) {\n    return _entries[index]._k;\n}\n\ntemplate class Map&lt;HiObject*, HiObject*&gt;;\n</code></pre><p>è¿™æ®µä»£ç è™½ç„¶è¡Œæ•°å¾ˆå¤šï¼Œä½†æ˜¯é€»è¾‘éƒ½å¾ˆç®€å•ã€‚æœ‰ä¸¤ä¸ªåœ°æ–¹æ˜¯ä½ éœ€è¦æ³¨æ„çš„ã€‚ç¬¬ä¸€å¤„æ˜¯ <strong>put æ–¹æ³•çš„å®ç°</strong>ï¼ˆç¬¬15è¡Œï¼‰ã€‚ç”±äº Map ä¸­çš„ key æ˜¯å”¯ä¸€çš„ï¼Œä¸ä¼šé‡å¤ï¼Œæ‰€ä»¥åœ¨å¾€ Map æ’å…¥é”®å€¼å¯¹çš„æ—¶å€™ï¼Œéœ€è¦å…ˆæ£€æŸ¥ Map ä¸­æ˜¯å¦å·²ç»å­˜åœ¨ç›¸åŒçš„ key äº†ã€‚å¦‚æœå­˜åœ¨ï¼Œå°±ç›´æ¥æ›´æ–°å®ƒçš„å€¼ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå†æ’å…¥é”®å€¼å¯¹ã€‚</p><p>ç¬¬äºŒå¤„è¦æ³¨æ„çš„æ˜¯ <strong>remove æ–¹æ³•çš„å®ç°</strong>ã€‚ç”±äº Map ä¸­çš„å…ƒç´ æ²¡æœ‰å…ˆåé¡ºåºçš„è¦æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†é”®å€¼å¯¹ä»»æ„æ’åˆ—ã€‚å½“è¦åˆ é™¤å®¹å™¨ä¸­çš„æŸä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦å°†æœ€åä¸€ä¸ªå…ƒç´ ä¸å¾…åˆ é™¤å…ƒç´ äº¤æ¢ä½ç½®ï¼Œè¿™æ ·å¾…åˆ é™¤å…ƒç´ å°±å‡ºç°åœ¨æœ€åä¸€ä½äº†ã€‚è¿™ä¸ªæ—¶å€™åªéœ€è¦æŠŠæœ€åä¸€ä¸ªå…ƒç´ åˆ é™¤å°±å¯ä»¥äº†ã€‚è€Œæˆ‘ä»¬çŸ¥é“ï¼Œåˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ æ˜¯éå¸¸é«˜æ•ˆçš„ï¼ŒæŠŠ size å˜é‡å‡ 1 å°±å¯ä»¥å®ç°äº†ã€‚</p><p>æœ‰äº† map ç»“æ„ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›ä¸€æ­¥å®ç°å˜é‡è¡¨äº†ã€‚è§£é‡Šå™¨ä¸­çš„å˜é‡è¡¨æ˜¯ä¸€ä¸ªä»¥å­—ç¬¦ä¸²ä¸ºé”®çš„ map ç»“æ„ï¼Œå˜é‡åå­˜å‚¨åœ¨ CodeObject çš„ names åˆ—è¡¨ä¸­ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿™æ ·å®ç°å˜é‡è¡¨ï¼š</p><pre><code class=\"language-plain\">void Interpreter::run(CodeObject* codes) {\n    // ...\n&nbsp; &nbsp; HiList* names&nbsp; = codes-&gt;_names;\n&nbsp; &nbsp; Map&lt;HiObject*, HiObject*&gt;* locals&nbsp; = new Map&lt;HiObject*, HiObject*&gt;();\n\n    while (pc &lt; code_length) {\n        unsigned char op_code = codes-&gt;_bytecodes-&gt;value()[pc++];\n        short op_arg = (codes-&gt;_bytecodes-&gt;value()[pc++] &amp; 0xFF);\n        \n        // ....\n\n        switch (op_code) {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case ByteCode::LOAD_NAME:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v = names-&gt;get(op_arg);\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; w = locals-&gt;get(v);\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PUSH(w);\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;\n\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case ByteCode::STORE_NAME:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v = names-&gt;get(op_arg);\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; locals-&gt;put(v, POP());\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;\n             //....\n         }\n     }\n}\n</code></pre><p>åœ¨å˜é‡è¡¨çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥æ”¯æŒäº† LOAD_NAME å’Œ STORE_NAME ä¸¤ä¸ªå­—èŠ‚ç ã€‚</p><p>STORE_NAME çš„ä½œç”¨æ˜¯åœ¨å±€éƒ¨å˜é‡è¡¨ locals å†™å…¥å˜é‡çš„å€¼ã€‚å˜é‡çš„åç§°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå­˜å‚¨åœ¨ names ä¸­ï¼Œæ‰€ä»¥è¦å…ˆä» names ä¸­å–å‡ºå˜é‡åï¼ˆç¬¬ 20 è¡Œï¼‰ï¼Œç„¶åä»¥å˜é‡åä¸ºé”®ï¼Œå°†å€¼å†™å…¥å˜é‡è¡¨ï¼ˆç¬¬21è¡Œï¼‰ã€‚</p><p>LOAD_NAME çš„è¿‡ç¨‹ä¸ STORE_NAME ç›¸åï¼Œå®ƒè´Ÿè´£ä»å˜é‡è¡¨é‡Œå–å‡ºå€¼ã€‚</p><p>ç”±äºå¾ªç¯ç»“æ„çš„å®ç°ä¾èµ–äºå¾ªç¯å˜é‡çš„è¿­ä»£ä¿®æ”¹ï¼Œæ‰€ä»¥åœ¨å®ç°äº†å˜é‡çš„åŠŸèƒ½ä»¥åï¼Œæˆ‘ä»¬æ‰å¯ä»¥è¿›ä¸€æ­¥æ”¯æŒå¾ªç¯ç»“æ„ã€‚ä¸‹é¢æˆ‘ä»¬å°±å¼€å§‹å®ç°å¾ªç¯ç»“æ„ã€‚</p><h2>å¾ªç¯å†…çš„è·³è½¬</h2><p>åœ¨å¾ªç¯å†…æœ‰ä¸‰ç§è·³è½¬ï¼Œç¬¬ä¸€ç§æ˜¯å¾ªç¯ä½“æ­£å¸¸æ‰§è¡Œï¼Œæ­£å¸¸ç»“æŸï¼›ç¬¬äºŒç§æ˜¯ä½¿ç”¨ continue è¯­å¥ï¼Œè·³è½¬å›å¾ªç¯å¤´éƒ¨å†è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼›ç¬¬ä¸‰ç§æ˜¯ä½¿ç”¨ break è¯­å¥ï¼Œè·³è½¬åˆ°å¾ªç¯ç»“æŸå¤„ã€‚æ¯ä¸€æ¬¡å¾ªç¯ä½“æ‰§è¡Œç»“æŸä»¥åï¼Œéƒ½è¦è·³åˆ°å¾ªç¯å¼€å§‹çš„åœ°æ–¹å†è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼Œæ¥å†³å®šæ˜¯å¦è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯ã€‚ä¸¾ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œä¸ºäº†æ–¹ä¾¿ç ”ç©¶ï¼Œæˆ‘ä»¬æŠŠæºä»£ç å’Œå­—èŠ‚ç æ··åˆåœ¨ä¸€èµ·æ‰“å°ã€‚</p><pre><code class=\"language-c++\">i = 0\n&nbsp; 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 LOAD_CONST&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 (0)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 STORE_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 (i)\n\nwhile i &lt; 2:\n&nbsp; 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 (i)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 6 LOAD_CONST&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 (2)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8 COMPARE_OP&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 (&lt;)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10 POP_JUMP_IF_FALSE&nbsp; &nbsp; &nbsp; &nbsp;20 (to 40)\n\n    print(i)\n&nbsp; 3&nbsp; &nbsp; &nbsp;&gt;&gt;&nbsp; &nbsp;12 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 (print)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;14 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 (i)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;16 CALL_FUNCTION&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;18 POP_TOP\n\n    i = i + 1\n&nbsp; 4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 20 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 (i)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;22 LOAD_CONST&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 (1)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;24 BINARY_ADD\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;26 STORE_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 (i)\n\n&nbsp; 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 28 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 (i)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;30 LOAD_CONST&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 (2)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;32 COMPARE_OP&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 (&lt;)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;34 POP_JUMP_IF_TRUE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6 (to 12)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;36 LOAD_CONST&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3 (None)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;38 RETURN_VALUE\n&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&nbsp; &nbsp;40 LOAD_CONST&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3 (None)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;42 RETURN_VALUE\n</code></pre><p>ä»è¿™ä¸ªåç¼–è¯‘ç»“æœä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œé¢åªæœ‰ä¸€ä¸ªæ–°å¢çš„å­—èŠ‚ç ï¼Œé‚£å°±æ˜¯ <strong>POP_JUMP_IF_TRUE</strong>ã€‚é™¤äº†å®ƒä¹‹å¤–ï¼Œå…¶ä»–çš„å­—èŠ‚ç æˆ‘ä»¬éƒ½å·²ç»å¾ˆç†Ÿæ‚‰äº†ã€‚</p><p><span class=\"reference\">æ³¨ï¼šä¸åŒç‰ˆæœ¬çš„ç¼–è¯‘å™¨å¾—åˆ°çš„å­—èŠ‚ç å¯èƒ½ä¼šæœ‰å¾ˆå¤§çš„ä¸åŒï¼Œä¾‹å¦‚Python 2.7ä¼šä½¿ç”¨JUMP_ABSOLUTEæ¥å®ç°ç»å¯¹è·³è½¬ã€‚</span></p><p>å¦‚æœå¾ªç¯åˆ¤æ–­ä¸æˆåŠŸï¼Œå°±ä½¿ç”¨ POP_JUMP_IF_FALSEï¼Œè·³è¿‡æ•´ä¸ªå¾ªç¯ä½“ã€‚è¿™ä¸ªæœºåˆ¶ä¸ if è¯­å¥å®Œå…¨ç›¸åŒï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p><p>å¥½äº†ï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å°±æŠŠ while å¾ªç¯æ‰€éœ€è¦çš„å­—èŠ‚ç å…¨éƒ¨å®ç°äº†ã€‚ä½ å¯ä»¥ç¼–è¯‘è¿è¡Œä¸€ä¸‹ï¼Œä¸Šé¢ä¸¾çš„ä¾‹å­è™½ç„¶ç®€å•ï¼Œä½†éƒ½æ˜¯å¯ä»¥è¿è¡Œçš„ã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç ä½œç”¨æ˜¯æ‰“å° Fibonacci æ•°åˆ—çš„å‰10é¡¹ï¼Œç¼–è¯‘ä¹‹åï¼Œåœ¨æˆ‘ä»¬çš„è™šæ‹Ÿæœºä¸Šå°±å¯ä»¥æ­£ç¡®åœ°æ‰“å°å‡ºç»“æœã€‚</p><pre><code class=\"language-c++\">a = 1 \nb = 0 \ni = 0 \n\nprint(a)\nprint(b)\nprint(i)\n\nwhile i &lt; 10: \n    print(a)\n    t = a \n    a = a + b \n    b = t \n\n    i = i + 1 \n</code></pre><h2>å®ç°continueè¯­å¥</h2><p>å½±å“ while æ§åˆ¶æµçš„ä¸¤ä¸ªé‡è¦çš„å…³é”®å­—ï¼Œåˆ†åˆ«æ˜¯ continue å’Œ breakã€‚continue çš„ä½œç”¨æ˜¯ç›´æ¥è·³åˆ°å¾ªç¯å¼€å§‹çš„åœ°æ–¹è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼Œæ¥å†³å®šæ˜¯å¦è¦æ‰§è¡Œä¸‹ä¸€æ¬¡å¾ªç¯ã€‚è¿™ç§è·³è½¬å°† continue åé¢çš„å¾ªç¯ä½“éƒ¨åˆ†ç›´æ¥è·³è¿‡äº†ã€‚</p><p>åœ¨æŸ¥çœ‹ continue çš„å…·ä½“å®ç°ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥çŒœæƒ³ä¸€ä¸‹ï¼Œè¿™ç§è·³è½¬å¹¶ä¸éœ€è¦é¢å¤–çš„æ•°æ®ç»“æ„ï¼Œé‚£æ˜¯ä¸æ˜¯åªè¦ä¸€ä¸ªç»å¯¹è·³è½¬è¯­å¥å°±å¯ä»¥å®ç°å‘¢ï¼Ÿæˆ‘ä»¬å†™ä¸€ä¸ªä¾‹å­éªŒè¯ä¸€ä¸‹ã€‚</p><pre><code class=\"language-python\">i = 0\n\nwhile i &lt; 10:\n\n&nbsp; 3&nbsp; &nbsp; &nbsp;&gt;&gt;&nbsp; &nbsp; 4 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 (i)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 6 LOAD_CONST&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 (10)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8 COMPARE_OP&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 (&lt;)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10 POP_JUMP_IF_FALSE&nbsp; &nbsp; &nbsp; &nbsp;25 (to 50)\n\n&nbsp; &nbsp; if i &lt; 2:\n\n&nbsp; 4&nbsp; &nbsp; &nbsp;&gt;&gt;&nbsp; &nbsp;12 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 (i)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;14 LOAD_CONST&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 (2)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;16 COMPARE_OP&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 (&lt;)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;18 POP_JUMP_IF_FALSE&nbsp; &nbsp; &nbsp; &nbsp;11 (to 22)\n\n&nbsp; &nbsp; &nbsp; &nbsp; continue\n&nbsp; 5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 20 JUMP_ABSOLUTE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 (to 4)\n\n&nbsp; &nbsp; print(i)\n\n&nbsp; 7&nbsp; &nbsp; &nbsp;&gt;&gt;&nbsp; &nbsp;22 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 (print)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;24 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 (i)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;26 CALL_FUNCTION&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;28 POP_TOP\n\n&nbsp; &nbsp; i = i + 1\n</code></pre><p>æˆ‘ä»¬åªå±•ç¤ºäº†æœ€å…³é”®çš„éƒ¨åˆ†ã€‚æ³¨æ„ä½ç½®ä¸º 20 çš„é‚£æ¡ JUMP_ABSOLUTE æŒ‡ä»¤ï¼ˆç¬¬ 18 è¡Œï¼‰ï¼Œå®ƒå°±æ˜¯continue è¯­å¥ç¿»è¯‘å‡ºæ¥çš„ç»“æœã€‚Python é€šè¿‡ç»å¯¹è·³è½¬æ¥å®ç° continue è¯­ä¹‰ã€‚</p><p>JUMP_ABSOLUTE è¿™ä¸ªå­—èŠ‚ç çš„ä½œç”¨æ˜¯å½“å¾ªç¯ä½“æ‰§è¡Œç»“æŸä»¥åï¼Œè·³åˆ°å¾ªç¯å¼€å§‹çš„ä½ç½®ï¼Œè¿›è¡Œæ¡ä»¶åˆ¤æ–­æ¥å†³å®šæ˜¯å¦è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯ã€‚å®ƒçš„å‚æ•°æ˜¯ä¸€ä¸ªç»å¯¹åœ°å€ï¼Œä¾‹å¦‚åœ¨åˆšåˆšé‚£ä¸ªä¾‹å­é‡Œï¼Œå‚æ•°æ˜¯ 9ï¼Œå°±ä»£è¡¨ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„å­—èŠ‚ç ä½ç½®æ˜¯9ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹ä½ç½®ä¸º 9 çš„é‚£æ¡å­—èŠ‚ç ï¼Œæ°å¥½å°±æ˜¯ i &lt; 2 è¿™ä¸ªæ¯”è¾ƒå¼€å§‹çš„åœ°æ–¹ã€‚æ‰€ä»¥è¿™æ¡å­—èŠ‚ç çš„å®ç°å¦‚ä¸‹ï¼š</p><pre><code class=\"language-c++\">// code/bytecode.hpp\nclass ByteCode {\n    ......\n    static const unsigned char JUMP_ABSOLUTE = 113;\n    ......\n};\n\n// runtime/interpreter.cpp\nvoid Interpreter::run(CodeObject* codes) {\n    ....\n    while (pc &lt; code_length) {\n\t    switch (op_code) {\n            case ByteCode::JUMP_ABSOLUTE:\n                pc = op_arg;\n                break;\n            ....\n        }\n    }\n}\n</code></pre><p>å¦‚æœå¾ªç¯åˆ¤æ–­ä¸æˆåŠŸï¼Œå°±ä½¿ç”¨ POP_JUMP_IF_FALSE è·³è¿‡æ•´ä¸ªå¾ªç¯ä½“ï¼Œè¿™ä¸ªæœºåˆ¶ä¸ if è¯­å¥å®Œå…¨ç›¸åŒï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œè¿™èŠ‚è¯¾çš„ continue çš„ä¾‹å­å°±å¯ä»¥æ­£å¸¸æ‰§è¡Œäº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å®ç°ç¬¬ä¸‰ç§è·³è½¬â€”â€”breakè¯­å¥ã€‚</p><p>æˆ‘ä»¬å…ˆç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥æµ‹è¯•ä¸€ä¸‹ã€‚</p><pre><code class=\"language-c++\">i = 0\n\nwhile i &lt; 5:\n&nbsp; &nbsp; print(i)\n&nbsp; &nbsp; if i == 3:\n&nbsp; &nbsp; &nbsp; &nbsp; break\n&nbsp; &nbsp; i = i + 1\n\nprint(i)\n</code></pre><p>å¾—åˆ°çš„å­—èŠ‚ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-plain\">&nbsp; 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 LOAD_CONST&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 (0)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 STORE_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 (i)\n\n&nbsp; 3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 (i)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 6 LOAD_CONST&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 (5)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8 COMPARE_OP&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 (&lt;)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10 POP_JUMP_IF_FALSE&nbsp; &nbsp; &nbsp; &nbsp;23 (to 46)\n\n&nbsp; 4&nbsp; &nbsp; &nbsp;&gt;&gt;&nbsp; &nbsp;12 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 (print)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;14 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 (i)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;16 CALL_FUNCTION&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;18 POP_TOP\n\n&nbsp; 5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 20 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 (i)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;22 LOAD_CONST&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 (3)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;24 COMPARE_OP&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 (==)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;26 POP_JUMP_IF_FALSE&nbsp; &nbsp; &nbsp; &nbsp;15 (to 30)\n\n&nbsp; 6&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 28 JUMP_FORWARD&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8 (to 46)\n\n&nbsp; 7&nbsp; &nbsp; &nbsp;&gt;&gt;&nbsp; &nbsp;30 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 (i)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;32 LOAD_CONST&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3 (1)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;34 BINARY_ADD\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;36 STORE_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 (i)\n\n&nbsp; 3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 38 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 (i)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;40 LOAD_CONST&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 (5)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;42 COMPARE_OP&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 (&lt;)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;44 POP_JUMP_IF_TRUE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6 (to 12)\n\n&nbsp; 9&nbsp; &nbsp; &nbsp;&gt;&gt;&nbsp; &nbsp;46 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 (print)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;48 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 (i)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;50 CALL_FUNCTION&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;52 POP_TOP\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;54 LOAD_CONST&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 (None)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;56 RETURN_VALUE\n</code></pre><p>ç¬¬ 17 è¡Œçš„ POP_JUMP_IF_FALSE ä»£è¡¨äº† (i==3) è¿™ä¸ªæ¡ä»¶ä¸æ»¡è¶³çš„æ—¶å€™ï¼Œåº”è¯¥ç»§ç»­æ‰§è¡Œå¾ªç¯ä½“ã€‚ç¬¬ 19 è¡Œçš„ JUMP_FORWARD åˆ™ä»£è¡¨ (i == 3) æ¡ä»¶æ»¡è¶³æ—¶ï¼Œåº”è¯¥ç›´æ¥è·³åˆ°å¾ªç¯ä½“ç»“å°¾å¤„ã€‚</p><p>åˆ°è¿™é‡Œï¼Œåˆ†æ”¯è¯­å¥å’Œå¾ªç¯è¯­å¥å°±å…¨éƒ¨å®ç°å®Œäº†ã€‚ä½ å¯ä»¥åœ¨è‡ªå·±çš„è™šæ‹Ÿæœºä¸Šå®éªŒä¸‹é¢è¿™ä¸ªå¾ªç¯åµŒå¥—ä»£ç ï¼Œçœ‹çœ‹æ˜¯å¦èƒ½æ­£ç¡®æ‰§è¡Œã€‚</p><pre><code class=\"language-python\">i = 0\nj = 0\nwhile j &lt; 3:\n&nbsp; &nbsp; i = 0\n\n&nbsp; &nbsp; while i &lt; 10:\n&nbsp; &nbsp; &nbsp; &nbsp; if i == 3:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break\n&nbsp; &nbsp; &nbsp; &nbsp; i = i + 1\n\n&nbsp; &nbsp; j = j + 1\n</code></pre><h2>æ€»ç»“</h2><p>è¿™èŠ‚è¯¾æˆ‘ä»¬å®ç°äº†å¾ªç¯è¯­å¥ã€‚å˜é‡çš„è¯»å†™æ“ä½œå’Œè·³è½¬æŒ‡ä»¤æ”¯æ’‘äº†å¾ªç¯è¯­å¥çš„å®ç°ã€‚</p><p><strong>ç¬¬ä¸€éƒ¨åˆ†æˆ‘ä»¬å®ç°äº†å˜é‡çš„è¯»å†™æ“ä½œã€‚</strong>åœ¨è§£é‡Šå™¨é‡Œï¼Œé™¤äº†æ“ä½œæ•°æ ˆä¹‹å¤–ï¼Œæœ€é‡è¦çš„æ•°æ®ç»“æ„å°±æ˜¯å˜é‡è¡¨äº†ã€‚å˜é‡è¡¨é‡‡ç”¨å…³è”æ•°æ®ç»“æ„ï¼Œä¹Ÿå°±æ˜¯ Map æ¥å®ç°ã€‚LOAD å’Œ STORE æ“ä½œå°±æ˜¯é’ˆå¯¹å˜é‡è¡¨çš„è¯»å†™ã€‚</p><p><strong>ç¬¬äºŒéƒ¨åˆ†æˆ‘ä»¬é‡ç‚¹å®ç°äº† POP_JUMP_IF_TRUE æŒ‡ä»¤ã€‚</strong>å®ƒçš„å®ç°æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œè¿™é‡Œéœ€è¦ä½ é‡ç‚¹ç†è§£ while è¯­å¥æ˜¯å¦‚ä½•å¯¹åº”åˆ°è¿™æ¡è·³è½¬æŒ‡ä»¤çš„ã€‚</p><p><strong>ç¬¬ä¸‰éƒ¨åˆ†æˆ‘ä»¬åˆ†æäº† continue è¯­å¥å’Œ break è¯­å¥ï¼Œå¹¶é‡ç‚¹å®ç°äº† JUMP_ABSOLUTE æŒ‡ä»¤ã€‚</strong>è¿™æ˜¯ä¸€æ¡ç»å¯¹è·³è½¬æŒ‡ä»¤ã€‚é€šè¿‡ä»¥ä¸Šå‡ ç§è·³è½¬æŒ‡ä»¤ï¼Œå¾ªç¯è¯­å¥å°±å…¨éƒ¨èƒ½è¿è¡Œäº†ï¼ŒåŒ…æ‹¬æ¯”è¾ƒå¤æ‚çš„åµŒå¥—å¾ªç¯è¯­å¥ä¹Ÿèƒ½æ­£å¸¸æ‰§è¡Œã€‚</p><p>ç›¸æ¯”äº2.7ç‰ˆæœ¬çš„å­—èŠ‚ç ï¼Œ3.8ç‰ˆæœ¬çš„å¾ªç¯è¯­å¥æå¤§åœ°ç®€åŒ–äº†ã€‚å¦‚æœä½ æœ‰ä½™åŠ›çš„è¯ï¼Œä¹Ÿå¯ä»¥ç ”ç©¶ä¸€ä¸‹Python 2.7çš„å­—èŠ‚ç æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œè™šæ‹Ÿæœºå·²ç»å…·å¤‡äº†ä¸€å®šçš„è®¡ç®—èƒ½åŠ›ã€‚åœ¨è¿‡å»çš„ä¸¤èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬é‡åˆ°è¿‡å¾ˆå¤šæ¬¡éœ€è¦å¤„ç†å¯¹è±¡çš„æƒ…å†µã€‚å½“æ—¶æˆ‘ä»¬éƒ½æ˜¯é€šè¿‡ä¸€äº›æ‰‹æ®µæŠŠé—®é¢˜å›é¿è¿‡å»äº†ï¼Œé‚£ä¹ˆä¸‹èŠ‚è¯¾æˆ‘ä»¬å°±åº”è¯¥æŠŠ<strong>å¯¹è±¡ä½“ç³»</strong>é‡æ–°æ¢³ç†ä¸€ä¸‹ï¼Œè®©å®ƒèƒ½å¤Ÿæ”¯æŒæ•´æ•°ã€æµ®ç‚¹æ•°ã€å­—ç¬¦ä¸²ç­‰æ›´å¤šçš„åŸºæœ¬æ•°æ®ç±»å‹ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>è€ç‰ˆæœ¬çš„Pythonå­—èŠ‚ç ä¸­ï¼Œæœ‰ä¸€ä¸ªBREAK_LOOPæŒ‡ä»¤ï¼Œä½ å¯ä»¥ç ”ç©¶ä¸€ä¸‹è¿™æ¡æŒ‡ä»¤ï¼Œç„¶åæ€è€ƒä¸ºä»€ä¹ˆæ–°ç‰ˆæœ¬çš„è™šæ‹Ÿæœºä¸­ä¸éœ€è¦è¿™æ¡æŒ‡ä»¤äº†ã€‚æœŸå¾…ä½ æŠŠä½ çš„ç­”æ¡ˆåˆ†äº«åˆ°è¯„è®ºåŒºï¼Œå¦‚æœä½ è§‰å¾—è¿™èŠ‚è¯¾çš„å†…å®¹å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œä¹Ÿæ¬¢è¿ä½ åˆ†äº«ç»™å…¶ä»–æœ‹å‹ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","neighbors":{"left":{"article_title":"05ï½œåˆ†æ”¯è¯­å¥ï¼šæ§åˆ¶æµè®©ç¨‹åºå…·å¤‡åŸºæœ¬çš„è¿ç®—èƒ½åŠ›","id":772703},"right":{"article_title":"07ï½œç±»å‹æ ‡è¯†ï¼šè™šæ‹Ÿæœºæ”¯æŒå¯¹è±¡è‡ªæ£€çš„åŸºç¡€è®¾æ–½","id":774409}},"comments":[{"had_liked":false,"id":390682,"user_name":"Se7en","can_delete":false,"product_type":"c1","uid":1225368,"ip_address":"åŒ—äº¬","ucode":"93EFAE37AFB12D","user_header":"https://static001.geekbang.org/account/avatar/00/12/b2/98/82b76c88.jpg","comment_is_top":false,"comment_ctime":1715958815,"is_pvip":false,"replies":[{"id":142113,"content":"ğŸ‘ğŸŒ¹","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1360512,"ctime":1716176853,"ip_address":"ä¸Šæµ·","comment_id":390682,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100761401,"comment_content":"æœ‰äººçœ‹åˆ°è¿™é‡Œå—","like_count":3,"discussions":[{"author":{"id":1360512,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c2/80/6ebf32e8.jpg","nickname":"æµ·çº³","note":"","ucode":"AB9F7ADB1428D2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":645448,"discussion_content":"ğŸ‘ğŸŒ¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1716176853,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1143015,"avatar":"https://static001.geekbang.org/account/avatar/00/11/70/e7/82cd831d.jpg","nickname":"Timothy","note":"","ucode":"A3E94236DD7A82","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":645733,"discussion_content":"åˆšçœ‹åˆ°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1716604485,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":396190,"user_name":"Se7en","can_delete":false,"product_type":"c1","uid":1225368,"ip_address":"åŒ—äº¬","ucode":"93EFAE37AFB12D","user_header":"https://static001.geekbang.org/account/avatar/00/12/b2/98/82b76c88.jpg","comment_is_top":false,"comment_ctime":1733469900,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100761401,"comment_content":"å…³äºæ€è€ƒé¢˜ï¼Œæˆ‘èŠ‚é€‰äº†ä¸€ä¸‹python3.8æ–‡æ¡£çš„å†…å®¹\nPOP_FINALLY(preserve_tos)\nCleans up the value stack and the block stack. If preserve_tos is not 0 TOS first is popped from the stack and pushed on the stack after performing other stack operations:\n\nIf TOS is NULL or an integer (pushed by BEGIN_FINALLY or CALL_FINALLY) it is popped from the stack.\n\nIf TOS is an exception type (pushed when an exception has been raised) 6 values are popped from the stack, the last three popped values are used to restore the exception state. An exception handler block is removed from the block stack.\n\nIt is similar to END_FINALLY, but doesnâ€™t change the bytecode counter nor raise an exception. Used for implementing break, continue and return in the finally block.\n\nNew in version 3.8.","like_count":0},{"had_liked":false,"id":396188,"user_name":"Se7en","can_delete":false,"product_type":"c1","uid":1225368,"ip_address":"åŒ—äº¬","ucode":"93EFAE37AFB12D","user_header":"https://static001.geekbang.org/account/avatar/00/12/b2/98/82b76c88.jpg","comment_is_top":false,"comment_ctime":1733469800,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100761401,"comment_content":"å…³äºæ€è€ƒé¢˜ï¼Œæˆ‘èŠ‚é€‰äº†ä¸€ä¸‹æ–‡æ¡£çš„å†…å®¹\nIt is similar to END_FINALLY, but doesnâ€™t change the bytecode counter nor raise an exception. Used for implementing break, continue and return in the finally block.","like_count":0},{"had_liked":false,"id":395117,"user_name":"ifelse","can_delete":false,"product_type":"c1","uid":2550743,"ip_address":"æµ™æ±Ÿ","ucode":"D0565908C99695","user_header":"https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg","comment_is_top":false,"comment_ctime":1729491786,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":3,"score":2,"product_id":100761401,"comment_content":"å­¦ä¹ æ‰“å¡","like_count":0}]}