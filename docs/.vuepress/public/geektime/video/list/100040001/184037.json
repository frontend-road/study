{"id":184037,"title":"27 | 实验：分片集群搭建及扩容","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-mongodb-course\">https://gitee.com/geektime-geekbang/geektime-mongodb-course</a></p>","comments":[{"had_liked":false,"id":172123,"user_name":"hal","can_delete":false,"product_type":"c3","uid":1359844,"ip_address":"","ucode":"98E625F7327FD9","user_header":"https://static001.geekbang.org/account/avatar/00/14/bf/e4/45758517.jpg","comment_is_top":false,"comment_ctime":1579093485,"is_pvip":false,"replies":[{"id":66839,"content":"mongos在你新建库的时候会为你的库挑一个“primary shard”，所有未分片的集合都会在这个shard里面。挑选的规则就是看哪个分片相对数据量小一点。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1579166245,"ip_address":"","comment_id":172123,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"没有分片的集合是会随机找个shard 复制集存吗？","like_count":4,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481629,"discussion_content":"mongos在你新建库的时候会为你的库挑一个“primary shard”，所有未分片的集合都会在这个shard里面。挑选的规则就是看哪个分片相对数据量小一点。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1579166245,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1359844,"avatar":"https://static001.geekbang.org/account/avatar/00/14/bf/e4/45758517.jpg","nickname":"hal","note":"","ucode":"98E625F7327FD9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":136936,"discussion_content":"👌， 谢谢老师","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579172374,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":241256,"user_name":"Geek_7f0514","can_delete":false,"product_type":"c3","uid":1204498,"ip_address":"","ucode":"5F39443023769A","user_header":"","comment_is_top":false,"comment_ctime":1597225941,"is_pvip":false,"replies":[{"id":89365,"content":"config server通常有1~2c就可以,内存也不用大，通常4G就可以。\n\nmongos 因为要承接很多连接处理，一般建议CPU还是有给够，可以和mongod参考。因为它不缓存数据，所以内存也可以不用太大。可以参考mongod的一半。\n\n","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1597626198,"ip_address":"","comment_id":241256,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师你好， mongos configsvr 是否需要高内存 多核心的服务器，这2个服务能部署在同一个服务器上面么","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503685,"discussion_content":"config server通常有1~2c就可以,内存也不用大，通常4G就可以。\n\nmongos 因为要承接很多连接处理，一般建议CPU还是有给够，可以和mongod参考。因为它不缓存数据，所以内存也可以不用太大。可以参考mongod的一半。\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597626198,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":227713,"user_name":"注意力$","can_delete":false,"product_type":"c3","uid":1142316,"ip_address":"","ucode":"7FB3399A1EAB72","user_header":"https://static001.geekbang.org/account/avatar/00/11/6e/2c/e2f3cfc0.jpg","comment_is_top":false,"comment_ctime":1592462485,"is_pvip":false,"replies":[{"id":88173,"content":"所有操作必须要使用mongos。不能直接使用分片主节点。直接操作主节点仅仅限于数据库故障恢复","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1596278986,"ip_address":"","comment_id":227713,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师，我搭建好分片集群后，开始用的其中一个分片的主节点连接的数据库进行写入数据，写完之后，再使用mongos连接数据库，发现找不到数据，以后我连接数据库 是直接用mongos就可以了吗，还是直接用其中一个分片，还有导入数据也用mongos吗","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":498758,"discussion_content":"所有操作必须要使用mongos。不能直接使用分片主节点。直接操作主节点仅仅限于数据库故障恢复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596278986,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":216875,"user_name":"兰辉","can_delete":false,"product_type":"c3","uid":1942616,"ip_address":"","ucode":"ADF0638E4B6E45","user_header":"","comment_is_top":false,"comment_ctime":1589360066,"is_pvip":false,"replies":[{"id":81240,"content":"db.adminCommand( { movePrimary : &quot;your_dbname&quot;, to : &quot;shard0001&quot; } )\n\n\nhttps:&#47;&#47;docs.mongodb.com&#47;manual&#47;reference&#47;command&#47;movePrimary&#47;","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1590156148,"ip_address":"","comment_id":216875,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"有个问题，就是有的库我不分片，目前我有2个分片集(A和B)，然后我创建一个新数据库，怎么指定其在分片集B上面","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494974,"discussion_content":"db.adminCommand( { movePrimary : &amp;quot;your_dbname&amp;quot;, to : &amp;quot;shard0001&amp;quot; } )\n\n\nhttps://docs.mongodb.com/manual/reference/command/movePrimary/","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590156148,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":181692,"user_name":"密码123456","can_delete":false,"product_type":"c3","uid":1126593,"ip_address":"","ucode":"9889463CC0EA71","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/c1/2dde6700.jpg","comment_is_top":false,"comment_ctime":1582617197,"is_pvip":false,"replies":[{"id":70952,"content":"是的，谢谢强调。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1583028922,"ip_address":"","comment_id":181692,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"复制集 必须要加shardsvr   。不然mongos 加分片加不进去","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485080,"discussion_content":"是的，谢谢强调。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583028922,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":167843,"user_name":"cheriston","can_delete":false,"product_type":"c3","uid":1309984,"ip_address":"","ucode":"617CBFCE0925C4","user_header":"https://static001.geekbang.org/account/avatar/00/13/fd/20/2761ef0e.jpg","comment_is_top":false,"comment_ctime":1577948764,"is_pvip":false,"replies":[{"id":65184,"content":"非常棒！我们这个主要是让大家知道具体的步骤，是个学习的过程。上线或者稳定后一般都要用脚本或者工具来管理进程。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1577965729,"ip_address":"","comment_id":167843,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"我全部写在各类脚本里面，比老师的更加方便。","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480021,"discussion_content":"非常棒！我们这个主要是让大家知道具体的步骤，是个学习的过程。上线或者稳定后一般都要用脚本或者工具来管理进程。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577965729,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1320243,"avatar":"https://static001.geekbang.org/account/avatar/00/14/25/33/290fcb42.jpg","nickname":"依乐祝","note":"","ucode":"0FAE2C7FE1ECDB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291887,"discussion_content":"脚本可否共享下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594987004,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1679543,"avatar":"https://static001.geekbang.org/account/avatar/00/19/a0/b7/1327ae60.jpg","nickname":"hellojd_gk","note":"","ucode":"319AF4C1AD568D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":216945,"discussion_content":"在极客另外一个课程里学到的。 ops/dev理论：人管代码，代码管机器....","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585492952,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":236540,"user_name":"奔跑的脑细胞","can_delete":false,"product_type":"c3","uid":2059107,"ip_address":"","ucode":"84D3DCDE2C96BE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/cabLXAUXiavUplEOz3rdXFmbiary8v28mrE3f0IEDYogiarKCGFWiaMUTWJBOJ71osicT5r1MFpAQIAm4l43I6QYvBw/132","comment_is_top":false,"comment_ctime":1595463631,"is_pvip":false,"replies":[{"id":88159,"content":"1)  是的\n2) 是的","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1596277010,"ip_address":"","comment_id":236540,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师，我是新手，我想问下\n1、如果使用三个虚拟机，是不是每个虚拟机都需要安装MongoDB呢？\n2、您是通过一个命令行工具，打开三个标签页分别连接到三台虚拟机上进行操作的吗？","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":502115,"discussion_content":"1)  是的\n2) 是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596277010,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2059107,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/cabLXAUXiavUplEOz3rdXFmbiary8v28mrE3f0IEDYogiarKCGFWiaMUTWJBOJ71osicT5r1MFpAQIAm4l43I6QYvBw/132","nickname":"奔跑的脑细胞","note":"","ucode":"84D3DCDE2C96BE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":296122,"discussion_content":"谢谢老师，由于对虚拟机服务器不了解，最近在啃相关知识的书籍，希望能对这部分有所掌握。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596456675,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":231097,"user_name":"LL","can_delete":false,"product_type":"c3","uid":1317784,"ip_address":"","ucode":"E5749C4AB99003","user_header":"","comment_is_top":false,"comment_ctime":1593581512,"is_pvip":false,"replies":[{"id":88171,"content":" config上面存着分片的重要元数据（如chunk分布），没有config server 分片集群无法工作的。shard server会建立到configserver的连接(正常端口）来获取并缓存配置数据。\n\n改完端口以后，config 复制集是否正常？你有重新启动mongos 和 shard mongod 实例吗？","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1596278836,"ip_address":"","comment_id":231097,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师，遇到一个问题，有一套环境config改完端口shard不能启动了，还去连修改之前的端口。为什么shard启动的时候会去连config？shard从哪里读取config的信息？如何修改","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500155,"discussion_content":" config上面存着分片的重要元数据（如chunk分布），没有config server 分片集群无法工作的。shard server会建立到configserver的连接(正常端口）来获取并缓存配置数据。\n\n改完端口以后，config 复制集是否正常？你有重新启动mongos 和 shard mongod 实例吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596278836,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2215928,"avatar":"https://static001.geekbang.org/account/avatar/00/21/cf/f8/86076de4.jpg","nickname":"宏彬","note":"","ucode":"8EFDD45EA62342","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382629,"discussion_content":"哥们，后续有结果了吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625648804,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":227409,"user_name":"注意力$","can_delete":false,"product_type":"c3","uid":1142316,"ip_address":"","ucode":"7FB3399A1EAB72","user_header":"https://static001.geekbang.org/account/avatar/00/11/6e/2c/e2f3cfc0.jpg","comment_is_top":false,"comment_ctime":1592374952,"is_pvip":false,"replies":[{"id":88221,"content":"“Kill掉一个分片的从库之后，再kill掉一个分片的主库” 你必须保证多数节点（如果是3节点复制集，那就要有2个节点存活）","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1596353564,"ip_address":"","comment_id":227409,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师，MongoDB 4.0.18 两分片环境，每个分片做一个复制集，测试高可用 Kill掉一个分片的从库之后，再kill掉一个分片的主库，发现另外一个从库不能接管成为主库， 大家有遇到过吗","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":498626,"discussion_content":"“Kill掉一个分片的从库之后，再kill掉一个分片的主库” 你必须保证多数节点（如果是3节点复制集，那就要有2个节点存活）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596353564,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":201631,"user_name":"Jone_乔泓恺","can_delete":false,"product_type":"c3","uid":1407941,"ip_address":"","ucode":"158154301D5E40","user_header":"https://static001.geekbang.org/account/avatar/00/15/7b/c5/35f92dad.jpg","comment_is_top":false,"comment_ctime":1585814412,"is_pvip":false,"replies":[{"id":75803,"content":"对，正式部署需要多个mongos","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1586080941,"ip_address":"","comment_id":201631,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"请问：mongos 第 7，8 步是不是要在 3 台机器上都配置呢，这样其他一台机器宕机后另外两台中的其一可以顶上继续进行 mongos 的作用。我这样理解是否正确？","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490383,"discussion_content":"对，正式部署需要多个mongos","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586080941,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":199645,"user_name":"hellojd_gk","can_delete":false,"product_type":"c3","uid":1679543,"ip_address":"","ucode":"319AF4C1AD568D","user_header":"https://static001.geekbang.org/account/avatar/00/19/a0/b7/1327ae60.jpg","comment_is_top":false,"comment_ctime":1585493084,"is_pvip":false,"replies":[{"id":75811,"content":"是的，如果已经有大量数据，会有迁移动作，比较耗时。 \n\n至于是否以2的倍数扩容，这一点mongo没有这样的最佳实践。mongo的迁移是一对一对之间发生，一对间迁移就是一个线程，所以理论上双数的话会好一点提高点迁移效率，但是这一点不是决定多少个扩容节点的关键考量。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1586081444,"ip_address":"","comment_id":199645,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"enableSharding  涉及到数据迁移，是不是很耗时。 我了解点memcached, 是不是类似的要扩展时，要以2的倍数扩容，降低迁移成本。","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489860,"discussion_content":"是的，如果已经有大量数据，会有迁移动作，比较耗时。 \n\n至于是否以2的倍数扩容，这一点mongo没有这样的最佳实践。mongo的迁移是一对一对之间发生，一对间迁移就是一个线程，所以理论上双数的话会好一点提高点迁移效率，但是这一点不是决定多少个扩容节点的关键考量。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586081444,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":199632,"user_name":"hellojd_gk","can_delete":false,"product_type":"c3","uid":1679543,"ip_address":"","ucode":"319AF4C1AD568D","user_header":"https://static001.geekbang.org/account/avatar/00/19/a0/b7/1327ae60.jpg","comment_is_top":false,"comment_ctime":1585492869,"is_pvip":false,"replies":[{"id":78484,"content":"集群如果启用验证的话，需要用一个shared key文件，或者使用 X509 公钥机制来进行集群间的互相认证。\n\n可以先看下这个英文文档，有问题再提。\nhttps:&#47;&#47;docs.mongodb.com&#47;manual&#47;core&#47;security-internal-authentication&#47;","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1587879046,"ip_address":"","comment_id":199632,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"集群，不需要SSH免密登录配置吗？ 如果某个节点挂了，要选举等操作。怎么做到node角色切换呢，不需要免密登录，不明白。","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489857,"discussion_content":"集群如果启用验证的话，需要用一个shared key文件，或者使用 X509 公钥机制来进行集群间的互相认证。\n\n可以先看下这个英文文档，有问题再提。\nhttps://docs.mongodb.com/manual/core/security-internal-authentication/","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587879046,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":178865,"user_name":"jiachen1230","can_delete":false,"product_type":"c3","uid":1460552,"ip_address":"","ucode":"9C313508763797","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIIyvZt8rnGnOibictHOLkYe9E7TiaPFqmzOqNu515APWF0lFjtU26rHAibe75mKkLz5tTVgrxQN2u4Rw/132","comment_is_top":false,"comment_ctime":1581842286,"is_pvip":false,"replies":[{"id":70058,"content":"不是很理解你想问的问题。\n“分片后所有的数据都在一个复制集中，这样可以提高性能吗” ：分片是用来解决性能瓶颈，但是如果你的性能还没到瓶颈，提前分片时可能看不到明显的效果。\n\n命中片键的时候会读相应的分片服务器，但是如何确定哪个分片？就是通过chunk - 分片 的对应表（存储在config server里并且缓存到mongos）就可以得知。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1582336611,"ip_address":"","comment_id":178865,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"老师我想求教个问题，我线上只有一个复制集，但是有些数据量很大了，比如5000w，如果我把复制集改造成sharding，，然后针对这个表做分片，分片后所有的数据都在一个复制集中，这样可以提高性能吗？ 我记得分片是按chrunk来分配的，是否我命中片键的时候只要读取相应的chrunk就好了","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483999,"discussion_content":"不是很理解你想问的问题。\n“分片后所有的数据都在一个复制集中，这样可以提高性能吗” ：分片是用来解决性能瓶颈，但是如果你的性能还没到瓶颈，提前分片时可能看不到明显的效果。\n\n命中片键的时候会读相应的分片服务器，但是如何确定哪个分片？就是通过chunk - 分片 的对应表（存储在config server里并且缓存到mongos）就可以得知。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582336611,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1460552,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIIyvZt8rnGnOibictHOLkYe9E7TiaPFqmzOqNu515APWF0lFjtU26rHAibe75mKkLz5tTVgrxQN2u4Rw/132","nickname":"jiachen1230","note":"","ucode":"9C313508763797","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290067,"discussion_content":"老师，我的想法很简单，我其实是想把sharding功能当做分区表来用，因为机器不够，但单边读取的性能不好，我想通过shaing的功能实现分表但是不分库，不知道能否做到","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594334928,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":170707,"user_name":"Jason","can_delete":false,"product_type":"c3","uid":1131778,"ip_address":"","ucode":"1FD1A9D9F6341A","user_header":"https://static001.geekbang.org/account/avatar/00/11/45/02/795ce950.jpg","comment_is_top":false,"comment_ctime":1578670104,"is_pvip":false,"replies":[{"id":66202,"content":"1）可以使用zone sharding方式来自己控制数据的分布。比如说分片1是16Core SSD，那你可以给它更多的数据。\n\n2）是的，最后3个分片会给有10G左右\n","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1578741987,"ip_address":"","comment_id":170707,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":" 老师，\n1、如果两个分片服务器性能不一样，访问和存储可以权重类的设置吗？\n2、加入新的分片后，集群里的分片数据会自动均衡到各分片吗？比如首先只有第一个分片有30G数据，后面新增两个分片，各分片会迁移10G数据吗？","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481076,"discussion_content":"1）可以使用zone sharding方式来自己控制数据的分布。比如说分片1是16Core SSD，那你可以给它更多的数据。\n\n2）是的，最后3个分片会给有10G左右\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578741987,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":168112,"user_name":"cheriston","can_delete":false,"product_type":"c3","uid":1309984,"ip_address":"","ucode":"617CBFCE0925C4","user_header":"https://static001.geekbang.org/account/avatar/00/13/fd/20/2761ef0e.jpg","comment_is_top":false,"comment_ctime":1578015033,"is_pvip":false,"replies":[{"id":66773,"content":"这个问题好像我们线下讨论了，我们线下跟进","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1579132533,"ip_address":"","comment_id":168112,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"老师，我集群正常，数据分布在shard1与shard2 分片上，我将数据库迁移到shard2 上，再移除shard1 ，都正常；但是我再次添加shard1时候，里面没有数据，为什么 ？怎么让里面也有数据？急急急 ！！！！","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480141,"discussion_content":"这个问题好像我们线下讨论了，我们线下跟进","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579132533,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":168092,"user_name":"cheriston","can_delete":false,"product_type":"c3","uid":1309984,"ip_address":"","ucode":"617CBFCE0925C4","user_header":"https://static001.geekbang.org/account/avatar/00/13/fd/20/2761ef0e.jpg","comment_is_top":false,"comment_ctime":1578012818,"is_pvip":false,"replies":[{"id":66211,"content":"使用 enableSharding 命令","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1578749049,"ip_address":"","comment_id":168092,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"老师，MongoDB添加shard分片后，是如何让数据迁移到该分片的 ？","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480134,"discussion_content":"使用 enableSharding 命令","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578749049,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":273469,"user_name":"暴力的小石头","can_delete":false,"product_type":"c3","uid":1178779,"ip_address":"","ucode":"4C69E24A54C2FB","user_header":"https://static001.geekbang.org/account/avatar/00/11/fc/9b/0e79a034.jpg","comment_is_top":false,"comment_ctime":1610607294,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"如果片键hash之后写操作是能均衡分布了，但是做片键批量查询的时候比如id &gt; 10000这种动作的时候，岂不是会变的很慢吗？","like_count":2},{"had_liked":false,"id":376671,"user_name":"lpqoang","can_delete":false,"product_type":"c3","uid":1190090,"ip_address":"北京","ucode":"EB1E09117503A3","user_header":"https://static001.geekbang.org/account/avatar/00/12/28/ca/47333d8b.jpg","comment_is_top":false,"comment_ctime":1687183019,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"最近开始学习mongoDB,用6.0版本做这个实验，执行sh.enableSharding(&quot;foo&quot;)之后，sh.status()查看foo库partition值还是false，是6.0有什么改动吗？","like_count":0},{"had_liked":false,"id":362235,"user_name":"wljs","can_delete":false,"product_type":"c3","uid":1306543,"ip_address":"广东","ucode":"6B88A664972AD2","user_header":"https://static001.geekbang.org/account/avatar/00/13/ef/af/adce8c49.jpg","comment_is_top":false,"comment_ctime":1668327443,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"老师，你部署集群，没有启动认证，这个在生产上是要开启认证的吧？不然怎么玩","like_count":0},{"had_liked":false,"id":353711,"user_name":"固态U盘","can_delete":false,"product_type":"c3","uid":1043446,"ip_address":"上海","ucode":"9C473DA25CB4C1","user_header":"https://static001.geekbang.org/account/avatar/00/0f/eb/f6/ec7971f4.jpg","comment_is_top":false,"comment_ctime":1659690778,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"请问 TJ 老师，Config Server 启用认证之后，mongos 就连不上 Config Server 了，在连接 URI 上面添加了账号及密码，还是报错。请问有什么办法吗？多谢老师了。\n\nmongos \\\n--bind_ip mongos1.lavenliu.cn \\\n--port 27017 \\\n--logpath &#47;var&#47;log&#47;mongodb&#47;mongos.log \\\n--configdb config&#47;admin:admin@cfg1.lavenliu.cn:27000,cfg2.lavenliu.cn:27000,cfg3.lavenliu.cn:27000 \\\n--fork","like_count":0,"discussions":[{"author":{"id":1306543,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ef/af/adce8c49.jpg","nickname":"wljs","note":"","ucode":"6B88A664972AD2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593557,"discussion_content":"请问搞定了吗？加认证是不是不好搞啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1668327889,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":336353,"user_name":"Geek_f41676","can_delete":false,"product_type":"c3","uid":1336304,"ip_address":"","ucode":"08304FD693A696","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIKOQPxT4FB85PjRox4pFbvXhtyLKvYBgyZKSo31zxZN5n8vRrNBIRCdOX32ZLlibUwadL1Kdqhcmg/132","comment_is_top":false,"comment_ctime":1646107142,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"老师好,请教一个问题，我在搭建分片集群,添加分片时候提示报错\n sh.addShard(&quot;xxxxxxxxx&quot;)\n{\n\t&quot;ok&quot; : 0,\n\t&quot;errmsg&quot; : &quot;Failed to refresh the balancer settings :: caused by :: Could not find host matching read preference { mode: \\&quot;nearest\\&quot; } for set mongo_xxx_shard&quot;,\n\t&quot;code&quot; : 133,\n\t&quot;codeName&quot; : &quot;FailedToSatisfyReadPreference&quot;,\n\t&quot;operationTime&quot; : Timestamp(1646106840, 4),\n\t&quot;$clusterTime&quot; : {\n\t\t&quot;clusterTime&quot; : Timestamp(1646106840, 4),\n\t\t&quot;signature&quot; : {\n\t\t\t&quot;hash&quot; : BinData(0,&quot;ylhnEWpDviVjrA2II+MwK1UU9zI=&quot;),\n\t\t\t&quot;keyId&quot; : NumberLong(&quot;7069962807160078360&quot;)\n\t\t}\n\t}\n}\n","like_count":0},{"had_liked":false,"id":318650,"user_name":"༼¥༽ ༼་ཅ་༽","can_delete":false,"product_type":"c3","uid":2142688,"ip_address":"","ucode":"7F77A85B16AEF7","user_header":"https://static001.geekbang.org/account/avatar/00/20/b1/e0/8930fa26.jpg","comment_is_top":false,"comment_ctime":1635382800,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"请问老师，MongoDB的gridfs如何分片呢","like_count":0},{"had_liked":false,"id":295976,"user_name":"Bin","can_delete":false,"product_type":"c3","uid":1304406,"ip_address":"","ucode":"26BA010D2990C4","user_header":"https://static001.geekbang.org/account/avatar/00/13/e7/56/87f45704.jpg","comment_is_top":false,"comment_ctime":1622688451,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"TJ老师好，mongos 本身是怎么保证高可用的？","like_count":0,"discussions":[{"author":{"id":2215928,"avatar":"https://static001.geekbang.org/account/avatar/00/21/cf/f8/86076de4.jpg","nickname":"宏彬","note":"","ucode":"8EFDD45EA62342","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382627,"discussion_content":"可以mongos是无状态的，多起几个就好了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625648521,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":290106,"user_name":"Jack 乐","can_delete":false,"product_type":"c3","uid":1205795,"ip_address":"","ucode":"D5E36481290E60","user_header":"https://static001.geekbang.org/account/avatar/00/12/66/23/d67cc01a.jpg","comment_is_top":false,"comment_ctime":1619362882,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"老师，你好！我在配置分片复制集用户权限验证时出现无法启动mongo情况，请指教，谢谢！\n安全配置如下：\nsecurity:\n   keyFile: &#47;data&#47;mongodb&#47;shard1&#47;key&#47;r001\n   clusterAuthMode: keyFile\n   authorization: enabled\n执行启动mongod命令mongod -f mong.conf \n报错信息如下：about to fork child process, waiting until server is ready for connections.\nforked process: 31202\nERROR: child process failed, exited with 1\nTo see additional information in this output, start without the &quot;--fork&quot; option.\n","like_count":0},{"had_liked":false,"id":209382,"user_name":"齐宝金","can_delete":false,"product_type":"c3","uid":1305074,"ip_address":"","ucode":"F783442C82FCC2","user_header":"https://static001.geekbang.org/account/avatar/00/13/e9/f2/9067371a.jpg","comment_is_top":false,"comment_ctime":1587543652,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"老师，好请教一个问题，我在搭建分片集群，添加了shard1命令都正常，执行sh.status()报错：\nsh.addShard(‘xxxxxxxxxxx’）\n{\n        &quot;shardAdded&quot; : &quot;shard1&quot;,\n        &quot;ok&quot; : 1,\n        &quot;operationTime&quot; : Timestamp(1587540966, 1),\n        &quot;$clusterTime&quot; : {\n                &quot;clusterTime&quot; : Timestamp(1587540966, 1),\n                &quot;signature&quot; : {\n                        &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;),\n                        &quot;keyId&quot; : NumberLong(0)\n                }\n        }\n}\n\nmongos&gt; sh.status()\n2020-04-22T15:41:58.938+0800 E  QUERY    [js] uncaught exception: Error: command failed: {\n        &quot;ok&quot; : 0,\n        &quot;errmsg&quot; : &quot;unrecognized field &#39;useNewUpsert&#39;&quot;,\n        &quot;code&quot; : 9,\n        &quot;codeName&quot; : &quot;FailedToParse&quot;,\n        &quot;operationTime&quot; : Timestamp(1587541318, 3),\n        &quot;$clusterTime&quot; : {\n                &quot;clusterTime&quot; : Timestamp(1587541318, 3),\n                &quot;signature&quot; : {\n                        &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;),\n                        &quot;keyId&quot; : NumberLong(0)\n                }\n        }\n} : aggregate failed :\n_getErrorWithCode@src&#47;mongo&#47;shell&#47;utils.js:25:13\ndoassert@src&#47;mongo&#47;shell&#47;assert.js:18:14\n_assertCommandWorked@src&#47;mongo&#47;shell&#47;assert.js:583:17\nassert.commandWorked@src&#47;mongo&#47;shell&#47;assert.js:673:16\nDB.prototype._runAggregate@src&#47;mongo&#47;shell&#47;db.js:266:5\nDBCollection.prototype.aggregate@src&#47;mongo&#47;shell&#47;collection.js:1012:12\nprintShardingStatus@src&#47;mongo&#47;shell&#47;utils_sh.js:599:13\nsh.status@src&#47;mongo&#47;shell&#47;utils_sh.js:97:5\n@(shell):1:1\n\n这是什么问题","like_count":0,"discussions":[{"author":{"id":2922717,"avatar":"","nickname":"Geek_24eb6b","note":"","ucode":"700C2EA4585250","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576051,"discussion_content":"HI，老师，您解决了吗？我也遇到这个问题呢：   &#34;errmsg&#34; : &#34;unrecognized field &#39;useNewUpsert&#39;&#34;。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655260563,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}