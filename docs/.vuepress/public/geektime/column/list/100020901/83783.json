{"id":83783,"title":"43 | å¥—è·¯ç¯‡ï¼šç½‘ç»œæ€§èƒ½ä¼˜åŒ–çš„å‡ ä¸ªæ€è·¯ï¼ˆä¸Šï¼‰","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å€ªæœ‹é£ã€‚</p><p>ä¸Šä¸€èŠ‚ï¼Œæˆ‘ä»¬äº†è§£äº†NATï¼ˆç½‘ç»œåœ°å€è½¬æ¢ï¼‰çš„åŸç†ï¼Œå­¦ä¼šäº†å¦‚ä½•æ’æŸ¥ NAT å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ï¼Œæœ€åè¿˜æ€»ç»“äº† NAT æ€§èƒ½ä¼˜åŒ–çš„åŸºæœ¬æ€è·¯ã€‚æˆ‘å…ˆå¸¦ä½ ç®€å•å›é¡¾ä¸€ä¸‹ã€‚</p><p>NAT åŸºäº Linux å†…æ ¸çš„è¿æ¥è·Ÿè¸ªæœºåˆ¶ï¼Œå®ç°äº† IP åœ°å€åŠç«¯å£å·é‡å†™çš„åŠŸèƒ½ï¼Œä¸»è¦è¢«ç”¨æ¥è§£å†³å…¬ç½‘ IP åœ°å€çŸ­ç¼ºçš„é—®é¢˜ã€‚</p><p>åœ¨åˆ†æ NAT æ€§èƒ½é—®é¢˜æ—¶ï¼Œå¯ä»¥å…ˆä»å†…æ ¸è¿æ¥è·Ÿè¸ªæ¨¡å— conntrack è§’åº¦æ¥åˆ†æï¼Œæ¯”å¦‚ç”¨ systemtapã€perfã€netstat ç­‰å·¥å…·ï¼Œä»¥åŠ proc æ–‡ä»¶ç³»ç»Ÿä¸­çš„å†…æ ¸é€‰é¡¹ï¼Œæ¥åˆ†æç½‘ç»œåè®®æ ˆçš„è¡Œä¸ºï¼›ç„¶åï¼Œé€šè¿‡å†…æ ¸é€‰é¡¹è°ƒä¼˜ã€åˆ‡æ¢åˆ°æ— çŠ¶æ€ NATã€ä½¿ç”¨ DPDK ç­‰æ–¹å¼ï¼Œè¿›è¡Œå®é™…ä¼˜åŒ–ã€‚</p><p>é€šè¿‡å‰é¢çš„å­¦ä¹ ï¼Œä½ åº”è¯¥å·²ç»ä½“ä¼šåˆ°ï¼Œç½‘ç»œé—®é¢˜æ¯”æˆ‘ä»¬å‰é¢å­¦è¿‡çš„ CPUã€å†…å­˜æˆ–ç£ç›˜ I/O éƒ½è¦å¤æ‚ã€‚æ— è®ºæ˜¯åº”ç”¨å±‚çš„å„ç§ I/O æ¨¡å‹ï¼Œå†—é•¿çš„ç½‘ç»œåè®®æ ˆå’Œä¼—å¤šçš„å†…æ ¸é€‰é¡¹ï¼ŒæŠ‘æˆ–æ˜¯å„ç§å¤æ‚çš„ç½‘ç»œç¯å¢ƒï¼Œéƒ½æé«˜äº†ç½‘ç»œçš„å¤æ‚æ€§ã€‚</p><p>ä¸è¿‡ï¼Œä¹Ÿä¸è¦è¿‡åˆ†æ‹…å¿ƒï¼Œåªè¦ä½ æŒæ¡äº† Linux ç½‘ç»œçš„åŸºæœ¬åŸç†å’Œå¸¸è§ç½‘ç»œåè®®çš„å·¥ä½œæµç¨‹ï¼Œå†ç»“åˆå„ä¸ªç½‘ç»œå±‚çš„æ€§èƒ½æŒ‡æ ‡æ¥åˆ†æï¼Œä½ ä¼šå‘ç°ï¼Œå®šä½ç½‘ç»œç“¶é¢ˆå¹¶ä¸éš¾ã€‚</p><p>æ‰¾åˆ°ç½‘ç»œæ€§èƒ½ç“¶é¢ˆåï¼Œä¸‹ä¸€æ­¥è¦åšçš„å°±æ˜¯ä¼˜åŒ–äº†ï¼Œä¹Ÿå°±æ˜¯å¦‚ä½•é™ä½ç½‘ç»œå»¶è¿Ÿï¼Œå¹¶æé«˜ç½‘ç»œçš„ååé‡ã€‚å­¦å®Œç›¸å…³åŸç†å’Œæ¡ˆä¾‹åï¼Œæˆ‘å°±æ¥è®²è®²ï¼Œä¼˜åŒ–ç½‘ç»œæ€§èƒ½é—®é¢˜çš„æ€è·¯å’Œä¸€äº›æ³¨æ„äº‹é¡¹ã€‚</p><!-- [[[read_end]]] --><p>ç”±äºç½‘ç»œä¼˜åŒ–æ€è·¯çš„å†…å®¹æ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬åˆ†ä¸¤èŠ‚æ¥å­¦ä¹ ï¼Œä»Šå¤©æˆ‘ä»¬å…ˆæ¥çœ‹ä¸Šç¯‡ã€‚</p><h2>ç¡®å®šä¼˜åŒ–ç›®æ ‡</h2><p>è·Ÿ CPU å’Œ I/O æ–¹é¢çš„æ€§èƒ½ä¼˜åŒ–ä¸€æ ·ï¼Œä¼˜åŒ–å‰ï¼Œæˆ‘ä¼šå…ˆé—®é—®è‡ªå·±ï¼Œç½‘ç»œæ€§èƒ½ä¼˜åŒ–çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿæ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°çš„ç½‘ç»œæ€§èƒ½æŒ‡æ ‡ï¼Œè¦è¾¾åˆ°å¤šå°‘æ‰åˆé€‚å‘¢ï¼Ÿ</p><p>å®é™…ä¸Šï¼Œè™½ç„¶ç½‘ç»œæ€§èƒ½ä¼˜åŒ–çš„æ•´ä½“ç›®æ ‡ï¼Œæ˜¯é™ä½ç½‘ç»œå»¶è¿Ÿï¼ˆå¦‚ RTTï¼‰å’Œæé«˜ååé‡ï¼ˆå¦‚ BPS å’Œ PPSï¼‰ï¼Œä½†å…·ä½“åˆ°ä¸åŒåº”ç”¨ä¸­ï¼Œæ¯ä¸ªæŒ‡æ ‡çš„ä¼˜åŒ–æ ‡å‡†å¯èƒ½ä¼šä¸åŒï¼Œä¼˜å…ˆçº§é¡ºåºä¹Ÿå¤§ç›¸å¾„åº­ã€‚</p><p>å°±æ‹¿ä¸Šä¸€èŠ‚æåˆ°çš„ NAT ç½‘å…³æ¥è¯´ï¼Œç”±äºå…¶ç›´æ¥å½±å“æ•´ä¸ªæ•°æ®ä¸­å¿ƒçš„ç½‘ç»œå‡ºå…¥æ€§èƒ½ï¼Œæ‰€ä»¥ NAT ç½‘å…³é€šå¸¸éœ€è¦è¾¾åˆ°æˆ–æ¥è¿‘çº¿æ€§è½¬å‘ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ PPS æ˜¯æœ€ä¸»è¦çš„æ€§èƒ½ç›®æ ‡ã€‚</p><p>å†å¦‚ï¼Œå¯¹äºæ•°æ®åº“ã€ç¼“å­˜ç­‰ç³»ç»Ÿï¼Œå¿«é€Ÿå®Œæˆç½‘ç»œæ”¶å‘ï¼Œå³ä½å»¶è¿Ÿï¼Œæ˜¯ä¸»è¦çš„æ€§èƒ½ç›®æ ‡ã€‚</p><p>è€Œå¯¹äºæˆ‘ä»¬ç»å¸¸è®¿é—®çš„ Web æœåŠ¡æ¥è¯´ï¼Œåˆ™éœ€è¦åŒæ—¶å…¼é¡¾ååé‡å’Œå»¶è¿Ÿã€‚</p><p>æ‰€ä»¥ï¼Œä¸ºäº†æ›´å®¢è§‚åˆç†åœ°è¯„ä¼°ä¼˜åŒ–æ•ˆæœï¼Œæˆ‘ä»¬é¦–å…ˆåº”è¯¥æ˜ç¡®ä¼˜åŒ–çš„æ ‡å‡†ï¼Œå³è¦å¯¹ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºè¿›è¡ŒåŸºå‡†æµ‹è¯•ï¼Œå¾—åˆ°ç½‘ç»œåè®®æ ˆå„å±‚çš„åŸºå‡†æ€§èƒ½ã€‚</p><p>åœ¨ <a href=\"https://time.geekbang.org/column/article/81497\">æ€ä¹ˆè¯„ä¼°ç³»ç»Ÿçš„ç½‘ç»œæ€§èƒ½</a> ä¸­ï¼Œæˆ‘å·²ç»ä»‹ç»è¿‡ï¼Œç½‘ç»œæ€§èƒ½æµ‹è¯•çš„æ–¹æ³•ã€‚ç®€å•å›é¡¾ä¸€ä¸‹ï¼ŒLinux ç½‘ç»œåè®®æ ˆï¼Œæ˜¯æˆ‘ä»¬éœ€è¦æŒæ¡çš„æ ¸å¿ƒåŸç†ã€‚å®ƒæ˜¯åŸºäº TCP/IP åè®®æ—çš„åˆ†å±‚ç»“æ„ï¼Œæˆ‘ç”¨ä¸€å¼ å›¾æ¥è¡¨ç¤ºè¿™ä¸ªç»“æ„ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/c7/ac/c7b5b16539f90caabb537362ee7c27ac.png?wh=1092*1316\" alt=\"\"></p><p>æ˜ç™½äº†è¿™ä¸€ç‚¹ï¼Œåœ¨è¿›è¡ŒåŸºå‡†æµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŒ‰ç…§åè®®æ ˆçš„æ¯ä¸€å±‚æ¥æµ‹è¯•ã€‚ç”±äºåº•å±‚æ˜¯å…¶ä¸Šæ–¹å„å±‚çš„åŸºç¡€ï¼Œåº•å±‚æ€§èƒ½ä¹Ÿå°±å†³å®šäº†é«˜å±‚æ€§èƒ½ã€‚æ‰€ä»¥æˆ‘ä»¬è¦æ¸…æ¥šï¼Œåº•å±‚æ€§èƒ½æŒ‡æ ‡ï¼Œå…¶å®å°±æ˜¯å¯¹åº”é«˜å±‚çš„æé™æ€§èƒ½ã€‚æˆ‘ä»¬ä»ä¸‹åˆ°ä¸Šæ¥ç†è§£è¿™ä¸€ç‚¹ã€‚</p><p>é¦–å…ˆæ˜¯ç½‘ç»œæ¥å£å±‚å’Œç½‘ç»œå±‚ï¼Œå®ƒä»¬ä¸»è¦è´Ÿè´£ç½‘ç»œåŒ…çš„å°è£…ã€å¯»å€ã€è·¯ç”±ï¼Œä»¥åŠå‘é€å’Œæ¥æ”¶ã€‚æ¯ç§’å¯å¤„ç†çš„ç½‘ç»œåŒ…æ•° PPSï¼Œå°±æ˜¯å®ƒä»¬æœ€é‡è¦çš„æ€§èƒ½æŒ‡æ ‡ï¼ˆç‰¹åˆ«æ˜¯åœ¨å°åŒ…çš„æƒ…å†µä¸‹ï¼‰ã€‚ä½ å¯ä»¥ç”¨å†…æ ¸è‡ªå¸¦çš„å‘åŒ…å·¥å…· pktgen ï¼Œæ¥æµ‹è¯• PPS çš„æ€§èƒ½ã€‚</p><p>å†å‘ä¸Šåˆ°ä¼ è¾“å±‚çš„ TCP å’Œ UDPï¼Œå®ƒä»¬ä¸»è¦è´Ÿè´£ç½‘ç»œä¼ è¾“ã€‚å¯¹å®ƒä»¬è€Œè¨€ï¼Œååé‡ï¼ˆBPSï¼‰ã€è¿æ¥æ•°ä»¥åŠå»¶è¿Ÿï¼Œå°±æ˜¯æœ€é‡è¦çš„æ€§èƒ½æŒ‡æ ‡ã€‚ä½ å¯ä»¥ç”¨ iperf æˆ– netperf ï¼Œæ¥æµ‹è¯•ä¼ è¾“å±‚çš„æ€§èƒ½ã€‚</p><p>ä¸è¿‡è¦æ³¨æ„ï¼Œç½‘ç»œåŒ…çš„å¤§å°ï¼Œä¼šç›´æ¥å½±å“è¿™äº›æŒ‡æ ‡çš„å€¼ã€‚æ‰€ä»¥ï¼Œé€šå¸¸ï¼Œä½ éœ€è¦æµ‹è¯•ä¸€ç³»åˆ—ä¸åŒå¤§å°ç½‘ç»œåŒ…çš„æ€§èƒ½ã€‚</p><p>æœ€åï¼Œå†å¾€ä¸Šåˆ°äº†åº”ç”¨å±‚ï¼Œæœ€éœ€è¦å…³æ³¨çš„æ˜¯ååé‡ï¼ˆBPSï¼‰ã€æ¯ç§’è¯·æ±‚æ•°ä»¥åŠå»¶è¿Ÿç­‰æŒ‡æ ‡ã€‚ä½ å¯ä»¥ç”¨ wrkã€ab ç­‰å·¥å…·ï¼Œæ¥æµ‹è¯•åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚</p><p>ä¸è¿‡ï¼Œè¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œæµ‹è¯•åœºæ™¯è¦å°½é‡æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒï¼Œè¿™æ ·çš„æµ‹è¯•æ‰æ›´æœ‰ä»·å€¼ã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå½•åˆ¶å®é™…çš„è¯·æ±‚æƒ…å†µï¼Œå†åˆ°æµ‹è¯•ä¸­å›æ”¾ã€‚</p><p>æ€»ä¹‹ï¼Œæ ¹æ®è¿™äº›åŸºå‡†æŒ‡æ ‡ï¼Œå†ç»“åˆå·²ç»è§‚å¯Ÿåˆ°çš„æ€§èƒ½ç“¶é¢ˆï¼Œæˆ‘ä»¬å°±å¯ä»¥æ˜ç¡®æ€§èƒ½ä¼˜åŒ–çš„ç›®æ ‡ã€‚</p><h2>ç½‘ç»œæ€§èƒ½å·¥å…·</h2><p>åŒå‰é¢å­¦ä¹ ä¸€æ ·ï¼Œæˆ‘å»ºè®®ä»æŒ‡æ ‡å’Œå·¥å…·ä¸¤ä¸ªä¸åŒç»´åº¦å‡ºå‘ï¼Œæ•´ç†è®°å¿†ç½‘ç»œç›¸å…³çš„æ€§èƒ½å·¥å…·ã€‚</p><p>ç¬¬ä¸€ä¸ªç»´åº¦ï¼Œä»ç½‘ç»œæ€§èƒ½æŒ‡æ ‡å‡ºå‘ï¼Œä½ æ›´å®¹æ˜“æŠŠæ€§èƒ½å·¥å…·åŒç³»ç»Ÿå·¥ä½œåŸç†å…³è”èµ·æ¥ï¼Œå¯¹æ€§èƒ½é—®é¢˜æœ‰å®è§‚çš„è®¤è¯†å’ŒæŠŠæ¡ã€‚è¿™æ ·ï¼Œå½“ä½ æƒ³æŸ¥çœ‹æŸä¸ªæ€§èƒ½æŒ‡æ ‡æ—¶ï¼Œå°±èƒ½æ¸…æ¥šçŸ¥é“ï¼Œå¯ä»¥ç”¨å“ªäº›å·¥å…·ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘æŠŠæä¾›ç½‘ç»œæ€§èƒ½æŒ‡æ ‡çš„å·¥å…·ï¼Œåšæˆäº†ä¸€ä¸ªè¡¨æ ¼ï¼Œæ–¹ä¾¿ä½ æ¢³ç†å…³ç³»å’Œç†è§£è®°å¿†ã€‚ä½ å¯ä»¥æŠŠå®ƒä¿å­˜å¹¶æ‰“å°å‡ºæ¥ï¼Œéšæ—¶æŸ¥çœ‹ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠå®ƒå½“æˆä¸€ä¸ªâ€œæŒ‡æ ‡å·¥å…·â€æŒ‡å—æ¥ä½¿ç”¨ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a1/3b/a1eb07e281e5795be83c11d7255c543b.png?wh=1714*1944\" alt=\"\"></p><p>å†æ¥çœ‹ç¬¬äºŒä¸ªç»´åº¦ï¼Œä»æ€§èƒ½å·¥å…·å‡ºå‘ã€‚è¿™å¯ä»¥è®©ä½ æ›´å¿«ä¸Šæ‰‹ä½¿ç”¨å·¥å…·ï¼Œè¿…é€Ÿæ‰¾å‡ºæƒ³è¦è§‚å¯Ÿçš„æ€§èƒ½æŒ‡æ ‡ã€‚ç‰¹åˆ«æ˜¯åœ¨å·¥å…·æœ‰é™çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ›´è¦å……åˆ†åˆ©ç”¨å¥½æ‰‹å¤´çš„æ¯ä¸€ä¸ªå·¥å…·ï¼Œç”¨å°‘é‡å·¥å…·ä¹Ÿè¦å°½åŠ›æŒ–æ˜å‡ºå¤§é‡ä¿¡æ¯ã€‚</p><p>åŒæ ·çš„ï¼Œæˆ‘ä¹Ÿå°†è¿™äº›å¸¸ç”¨å·¥å…·ï¼Œæ±‡æ€»æˆäº†ä¸€ä¸ªè¡¨æ ¼ï¼Œæ–¹ä¾¿ä½ åŒºåˆ†å’Œç†è§£ã€‚è‡ªç„¶ï¼Œä½ ä¹Ÿå¯ä»¥å½“æˆä¸€ä¸ªâ€œå·¥å…·æŒ‡æ ‡â€æŒ‡å—ä½¿ç”¨ï¼Œéœ€è¦æ—¶æŸ¥è¡¨å³å¯ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/0d/a0/0d87b39b89a1b7f325fc5477c0182ea0.png?wh=1714*2280\" alt=\"\"></p><h2>ç½‘ç»œæ€§èƒ½ä¼˜åŒ–</h2><p>æ€»çš„æ¥è¯´ï¼Œå…ˆè¦è·å¾—ç½‘ç»œåŸºå‡†æµ‹è¯•æŠ¥å‘Šï¼Œç„¶åé€šè¿‡ç›¸å…³æ€§èƒ½å·¥å…·ï¼Œå®šä½å‡ºç½‘ç»œæ€§èƒ½ç“¶é¢ˆã€‚å†æ¥ä¸‹æ¥çš„ä¼˜åŒ–å·¥ä½œï¼Œå°±æ˜¯æ°´åˆ°æ¸ æˆçš„äº‹æƒ…äº†ã€‚</p><p>å½“ç„¶ï¼Œè¿˜æ˜¯é‚£å¥è¯ï¼Œè¦ä¼˜åŒ–ç½‘ç»œæ€§èƒ½ï¼Œè‚¯å®šç¦»ä¸å¼€ Linux ç³»ç»Ÿçš„ç½‘ç»œåè®®æ ˆå’Œç½‘ç»œæ”¶å‘æµç¨‹çš„è¾…åŠ©ã€‚ä½ å¯ä»¥ç»“åˆä¸‹é¢è¿™å¼ å›¾å†å›å¿†ä¸€ä¸‹è¿™éƒ¨åˆ†çš„çŸ¥è¯†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a1/3f/a118911721f9b67ce9c83de15666753f.png?wh=1826*1242\" alt=\"\"></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»åº”ç”¨ç¨‹åºã€å¥—æ¥å­—ã€ä¼ è¾“å±‚ã€ç½‘ç»œå±‚ä»¥åŠé“¾è·¯å±‚ç­‰å‡ ä¸ªè§’åº¦ï¼Œåˆ†åˆ«æ¥çœ‹ç½‘ç»œæ€§èƒ½ä¼˜åŒ–çš„åŸºæœ¬æ€è·¯ã€‚</p><h3>åº”ç”¨ç¨‹åº</h3><p>åº”ç”¨ç¨‹åºï¼Œé€šå¸¸é€šè¿‡å¥—æ¥å­—æ¥å£è¿›è¡Œç½‘ç»œæ“ä½œã€‚ç”±äºç½‘ç»œæ”¶å‘é€šå¸¸æ¯”è¾ƒè€—æ—¶ï¼Œæ‰€ä»¥åº”ç”¨ç¨‹åºçš„ä¼˜åŒ–ï¼Œä¸»è¦å°±æ˜¯å¯¹ç½‘ç»œ I/O å’Œè¿›ç¨‹è‡ªèº«çš„å·¥ä½œæ¨¡å‹çš„ä¼˜åŒ–ã€‚</p><p>ç›¸å…³å†…å®¹ï¼Œå…¶å®æˆ‘ä»¬åœ¨ <a href=\"https://time.geekbang.org/column/article/81268\">C10K å’Œ C1000K å›é¡¾</a> çš„æ–‡ç« ä¸­å·²ç»å­¦è¿‡äº†ã€‚è¿™é‡Œæˆ‘ä»¬ç®€å•å›é¡¾ä¸€ä¸‹ã€‚</p><p>ä»ç½‘ç»œ I/O çš„è§’åº¦æ¥è¯´ï¼Œä¸»è¦æœ‰ä¸‹é¢ä¸¤ç§ä¼˜åŒ–æ€è·¯ã€‚</p><p>ç¬¬ä¸€ç§æ˜¯æœ€å¸¸ç”¨çš„ I/O å¤šè·¯å¤ç”¨æŠ€æœ¯ epollï¼Œä¸»è¦ç”¨æ¥å–ä»£ select å’Œ pollã€‚è¿™å…¶å®æ˜¯è§£å†³ C10K é—®é¢˜çš„å…³é”®ï¼Œä¹Ÿæ˜¯ç›®å‰å¾ˆå¤šç½‘ç»œåº”ç”¨é»˜è®¤ä½¿ç”¨çš„æœºåˆ¶ã€‚</p><p>ç¬¬äºŒç§æ˜¯ä½¿ç”¨å¼‚æ­¥ I/Oï¼ˆAsynchronous I/Oï¼ŒAIOï¼‰ã€‚AIO å…è®¸åº”ç”¨ç¨‹åºåŒæ—¶å‘èµ·å¾ˆå¤š I/O æ“ä½œï¼Œè€Œä¸ç”¨ç­‰å¾…è¿™äº›æ“ä½œå®Œæˆã€‚ç­‰åˆ° I/Oå®Œæˆåï¼Œç³»ç»Ÿä¼šç”¨äº‹ä»¶é€šçŸ¥çš„æ–¹å¼ï¼Œå‘Šè¯‰åº”ç”¨ç¨‹åºç»“æœã€‚ä¸è¿‡ï¼ŒAIO çš„ä½¿ç”¨æ¯”è¾ƒå¤æ‚ï¼Œä½ éœ€è¦å°å¿ƒå¤„ç†å¾ˆå¤šè¾¹ç¼˜æƒ…å†µã€‚</p><p>è€Œä»è¿›ç¨‹çš„å·¥ä½œæ¨¡å‹æ¥è¯´ï¼Œä¹Ÿæœ‰ä¸¤ç§ä¸åŒçš„æ¨¡å‹ç”¨æ¥ä¼˜åŒ–ã€‚</p><p>ç¬¬ä¸€ç§ï¼Œä¸»è¿›ç¨‹+å¤šä¸ª worker å­è¿›ç¨‹ã€‚å…¶ä¸­ï¼Œä¸»è¿›ç¨‹è´Ÿè´£ç®¡ç†ç½‘ç»œè¿æ¥ï¼Œè€Œå­è¿›ç¨‹è´Ÿè´£å®é™…çš„ä¸šåŠ¡å¤„ç†ã€‚è¿™ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§æ¨¡å‹ã€‚</p><p>ç¬¬äºŒç§ï¼Œç›‘å¬åˆ°ç›¸åŒç«¯å£çš„å¤šè¿›ç¨‹æ¨¡å‹ã€‚åœ¨è¿™ç§æ¨¡å‹ä¸‹ï¼Œæ‰€æœ‰è¿›ç¨‹éƒ½ä¼šç›‘å¬ç›¸åŒæ¥å£ï¼Œå¹¶ä¸”å¼€å¯ SO_REUSEPORT é€‰é¡¹ï¼Œç”±å†…æ ¸è´Ÿè´£ï¼ŒæŠŠè¯·æ±‚è´Ÿè½½å‡è¡¡åˆ°è¿™äº›ç›‘å¬è¿›ç¨‹ä¸­å»ã€‚</p><p>é™¤äº†ç½‘ç»œ I/O å’Œè¿›ç¨‹çš„å·¥ä½œæ¨¡å‹å¤–ï¼Œåº”ç”¨å±‚çš„ç½‘ç»œåè®®ä¼˜åŒ–ï¼Œä¹Ÿæ˜¯è‡³å…³é‡è¦çš„ä¸€ç‚¹ã€‚æˆ‘æ€»ç»“äº†å¸¸è§çš„å‡ ç§ä¼˜åŒ–æ–¹æ³•ã€‚</p><ul>\n<li>\n<p>ä½¿ç”¨é•¿è¿æ¥å–ä»£çŸ­è¿æ¥ï¼Œå¯ä»¥æ˜¾è‘—é™ä½ TCP å»ºç«‹è¿æ¥çš„æˆæœ¬ã€‚åœ¨æ¯ç§’è¯·æ±‚æ¬¡æ•°è¾ƒå¤šæ—¶ï¼Œè¿™æ ·åšçš„æ•ˆæœéå¸¸æ˜æ˜¾ã€‚</p>\n</li>\n<li>\n<p>ä½¿ç”¨å†…å­˜ç­‰æ–¹å¼ï¼Œæ¥ç¼“å­˜ä¸å¸¸å˜åŒ–çš„æ•°æ®ï¼Œå¯ä»¥é™ä½ç½‘ç»œ I/O æ¬¡æ•°ï¼ŒåŒæ—¶åŠ å¿«åº”ç”¨ç¨‹åºçš„å“åº”é€Ÿåº¦ã€‚</p>\n</li>\n<li>\n<p>ä½¿ç”¨ Protocol Buffer ç­‰åºåˆ—åŒ–çš„æ–¹å¼ï¼Œå‹ç¼©ç½‘ç»œ I/O çš„æ•°æ®é‡ï¼Œå¯ä»¥æé«˜åº”ç”¨ç¨‹åºçš„ååã€‚</p>\n</li>\n<li>\n<p>ä½¿ç”¨ DNS ç¼“å­˜ã€é¢„å–ã€HTTPDNS ç­‰æ–¹å¼ï¼Œå‡å°‘ DNS è§£æçš„å»¶è¿Ÿï¼Œä¹Ÿå¯ä»¥æå‡ç½‘ç»œ I/O çš„æ•´ä½“é€Ÿåº¦ã€‚</p>\n</li>\n</ul><h3>å¥—æ¥å­—</h3><p>å¥—æ¥å­—å¯ä»¥å±è”½æ‰ Linux å†…æ ¸ä¸­ä¸åŒåè®®çš„å·®å¼‚ï¼Œä¸ºåº”ç”¨ç¨‹åºæä¾›ç»Ÿä¸€çš„è®¿é—®æ¥å£ã€‚æ¯ä¸ªå¥—æ¥å­—ï¼Œéƒ½æœ‰ä¸€ä¸ªè¯»å†™ç¼“å†²åŒºã€‚</p><ul>\n<li>\n<p>è¯»ç¼“å†²åŒºï¼Œç¼“å­˜äº†è¿œç«¯å‘è¿‡æ¥çš„æ•°æ®ã€‚å¦‚æœè¯»ç¼“å†²åŒºå·²æ»¡ï¼Œå°±ä¸èƒ½å†æ¥æ”¶æ–°çš„æ•°æ®ã€‚</p>\n</li>\n<li>\n<p>å†™ç¼“å†²åŒºï¼Œç¼“å­˜äº†è¦å‘å‡ºå»çš„æ•°æ®ã€‚å¦‚æœå†™ç¼“å†²åŒºå·²æ»¡ï¼Œåº”ç”¨ç¨‹åºçš„å†™æ“ä½œå°±ä¼šè¢«é˜»å¡ã€‚</p>\n</li>\n</ul><p>æ‰€ä»¥ï¼Œä¸ºäº†æé«˜ç½‘ç»œçš„ååé‡ï¼Œä½ é€šå¸¸éœ€è¦è°ƒæ•´è¿™äº›ç¼“å†²åŒºçš„å¤§å°ã€‚æ¯”å¦‚ï¼š</p><ul>\n<li>\n<p>å¢å¤§æ¯ä¸ªå¥—æ¥å­—çš„ç¼“å†²åŒºå¤§å° net.core.optmem_maxï¼›</p>\n</li>\n<li>\n<p>å¢å¤§å¥—æ¥å­—æ¥æ”¶ç¼“å†²åŒºå¤§å° net.core.rmem_max å’Œå‘é€ç¼“å†²åŒºå¤§å° net.core.wmem_maxï¼›</p>\n</li>\n<li>\n<p>å¢å¤§ TCP æ¥æ”¶ç¼“å†²åŒºå¤§å° net.ipv4.tcp_rmem å’Œå‘é€ç¼“å†²åŒºå¤§å° net.ipv4.tcp_wmemã€‚</p>\n</li>\n</ul><p>è‡³äºå¥—æ¥å­—çš„å†…æ ¸é€‰é¡¹ï¼Œæˆ‘æŠŠå®ƒä»¬æ•´ç†æˆäº†ä¸€ä¸ªè¡¨æ ¼ï¼Œæ–¹ä¾¿ä½ åœ¨éœ€è¦æ—¶å‚è€ƒï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/5f/f0/5f2d4957663dd8bf3410da8180ab18f0.png?wh=1696*959\" alt=\"\"></p><p>ä¸è¿‡æœ‰å‡ ç‚¹éœ€è¦ä½ æ³¨æ„ã€‚</p><ul>\n<li>\n<p>tcp_rmem å’Œ tcp_wmem çš„ä¸‰ä¸ªæ•°å€¼åˆ†åˆ«æ˜¯ minï¼Œdefaultï¼Œmaxï¼Œç³»ç»Ÿä¼šæ ¹æ®è¿™äº›è®¾ç½®ï¼Œè‡ªåŠ¨è°ƒæ•´TCPæ¥æ”¶/å‘é€ç¼“å†²åŒºçš„å¤§å°ã€‚</p>\n</li>\n<li>\n<p>udp_mem çš„ä¸‰ä¸ªæ•°å€¼åˆ†åˆ«æ˜¯ minï¼Œpressureï¼Œmaxï¼Œç³»ç»Ÿä¼šæ ¹æ®è¿™äº›è®¾ç½®ï¼Œè‡ªåŠ¨è°ƒæ•´UDPå‘é€ç¼“å†²åŒºçš„å¤§å°ã€‚</p>\n</li>\n</ul><p>å½“ç„¶ï¼Œè¡¨æ ¼ä¸­çš„æ•°å€¼åªæä¾›å‚è€ƒä»·å€¼ï¼Œå…·ä½“åº”è¯¥è®¾ç½®å¤šå°‘ï¼Œè¿˜éœ€è¦ä½ æ ¹æ®å®é™…çš„ç½‘ç»œçŠ¶å†µæ¥ç¡®å®šã€‚æ¯”å¦‚ï¼Œå‘é€ç¼“å†²åŒºå¤§å°ï¼Œç†æƒ³æ•°å€¼æ˜¯ååé‡*å»¶è¿Ÿï¼Œè¿™æ ·æ‰å¯ä»¥è¾¾åˆ°æœ€å¤§ç½‘ç»œåˆ©ç”¨ç‡ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œå¥—æ¥å­—æ¥å£è¿˜æä¾›äº†ä¸€äº›é…ç½®é€‰é¡¹ï¼Œç”¨æ¥ä¿®æ”¹ç½‘ç»œè¿æ¥çš„è¡Œä¸ºï¼š</p><ul>\n<li>\n<p>ä¸º TCP è¿æ¥è®¾ç½® TCP_NODELAY åï¼Œå°±å¯ä»¥ç¦ç”¨ Nagle ç®—æ³•ï¼›</p>\n</li>\n<li>\n<p>ä¸º TCP è¿æ¥å¼€å¯ TCP_CORK åï¼Œå¯ä»¥è®©å°åŒ…èšåˆæˆå¤§åŒ…åå†å‘é€ï¼ˆæ³¨æ„ä¼šé˜»å¡å°åŒ…çš„å‘é€ï¼‰ï¼›</p>\n</li>\n<li>\n<p>ä½¿ç”¨ SO_SNDBUF å’Œ SO_RCVBUF ï¼Œå¯ä»¥åˆ†åˆ«è°ƒæ•´å¥—æ¥å­—å‘é€ç¼“å†²åŒºå’Œæ¥æ”¶ç¼“å†²åŒºçš„å¤§å°ã€‚</p>\n</li>\n</ul><h2>å°ç»“</h2><p>ä»Šå¤©ï¼Œæˆ‘ä»¬ä¸€èµ·æ¢³ç†äº†å¸¸è§çš„ Linux ç½‘ç»œæ€§èƒ½ä¼˜åŒ–æ–¹æ³•ã€‚</p><p>åœ¨ä¼˜åŒ–ç½‘ç»œæ€§èƒ½æ—¶ï¼Œä½ å¯ä»¥ç»“åˆ Linux ç³»ç»Ÿçš„ç½‘ç»œåè®®æ ˆå’Œç½‘ç»œæ”¶å‘æµç¨‹ï¼Œç„¶åä»åº”ç”¨ç¨‹åºã€å¥—æ¥å­—ã€ä¼ è¾“å±‚ã€ç½‘ç»œå±‚å†åˆ°é“¾è·¯å±‚ç­‰ï¼Œè¿›è¡Œé€å±‚ä¼˜åŒ–ã€‚</p><p>å½“ç„¶ï¼Œå…¶å®æˆ‘ä»¬åˆ†æã€å®šä½ç½‘ç»œç“¶é¢ˆï¼Œä¹Ÿæ˜¯åŸºäºè¿™äº›è¿›è¡Œçš„ã€‚å®šä½å‡ºæ€§èƒ½ç“¶é¢ˆåï¼Œå°±å¯ä»¥æ ¹æ®ç“¶é¢ˆæ‰€åœ¨çš„åè®®å±‚è¿›è¡Œä¼˜åŒ–ã€‚æ¯”å¦‚ï¼Œä»Šå¤©æˆ‘ä»¬å­¦äº†åº”ç”¨ç¨‹åºå’Œå¥—æ¥å­—çš„ä¼˜åŒ–æ€è·¯ï¼š</p><ul>\n<li>\n<p>åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œä¸»è¦ä¼˜åŒ– I/O æ¨¡å‹ã€å·¥ä½œæ¨¡å‹ä»¥åŠåº”ç”¨å±‚çš„ç½‘ç»œåè®®ï¼›</p>\n</li>\n<li>\n<p>åœ¨å¥—æ¥å­—å±‚ä¸­ï¼Œä¸»è¦ä¼˜åŒ–å¥—æ¥å­—çš„ç¼“å†²åŒºå¤§å°ã€‚</p>\n</li>\n</ul><p>è€Œå…¶ä»–å„ä¸ªç½‘ç»œå±‚çš„ä¼˜åŒ–æ–¹æ³•ï¼Œå»ºè®®ä½ å…ˆè‡ªå·±æƒ³ä¸€æƒ³ï¼Œä¸‹ä¸€èŠ‚ï¼Œæˆ‘ä»¬å†æ¥ä¸€èµ·æ€»ç»“ã€‚</p><h2>æ€è€ƒ</h2><p>æœ€åï¼Œæˆ‘æƒ³é‚€è¯·ä½ ä¸€èµ·æ¥èŠèŠï¼Œä½ åœ¨ç¢°åˆ°ç½‘ç»œçš„æ€§èƒ½é—®é¢˜æ—¶ï¼Œæ˜¯æ€ä¹ˆè§£å†³çš„ï¼Ÿä½ å¯ä»¥ç»“åˆä»Šå¤©çš„å†…å®¹ï¼Œä»åº”ç”¨ç¨‹åºã€å¥—æ¥å­—ç­‰æ–¹é¢ï¼Œæ¥æ€»ç»“è‡ªå·±çš„æ€è·¯ã€‚</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºå’Œæˆ‘è®¨è®ºï¼Œä¹Ÿæ¬¢è¿æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„åŒäº‹ã€æœ‹å‹ã€‚æˆ‘ä»¬ä¸€èµ·åœ¨å®æˆ˜ä¸­æ¼”ç»ƒï¼Œåœ¨äº¤æµä¸­è¿›æ­¥ã€‚</p><p></p>","comments":[{"had_liked":false,"id":71767,"user_name":"åˆ†æ¸…äº‘æ·¡","can_delete":false,"product_type":"c1","uid":1269873,"ip_address":"","ucode":"7045AE6BF72D31","user_header":"https://static001.geekbang.org/account/avatar/00/13/60/71/895ee6cf.jpg","comment_is_top":false,"comment_ctime":1551428346,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"207709858554","product_id":100020901,"comment_content":"ç½‘ç»œå­¦ä¹ åƒåŠ›çš„åŒå­¦ï¼Œå…ˆå»æŠŠæ—æ²›æ»¡è€å¸ˆä¸¤æœ¬Wiresharkåˆ†æç½‘ç»œçœ‹å®Œï¼Œä¸å»ºè®®ä¸€ä¸Šæ¥ç›´æ¥çœ‹TCPã€IPä¸¤å·ï¼Œä¹‹æ‰€ä»¥åƒåŠ›å°±æ˜¯çº¯ç†è®ºçœ‹èµ·æ¥æ²¡æœ‰ä½“æ„Ÿï¼Œç†è§£ä¸æ·±ï¼Œçœ‹å®Œå°±å¿˜è®°äº†ã€‚è€ŒWireSharkä¹¦å¸®æˆ‘ä»¬å¢åŠ äº†ä½“æ„Ÿ","like_count":49,"discussions":[{"author":{"id":1000004,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/44/d3d67640.jpg","nickname":"Hillså½•","note":"","ucode":"779020947ACABA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":214828,"discussion_content":"å¾®ä¿¡è¯»ä¹¦å¯ä»¥çœ‹","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1585235587,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1269873,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/71/895ee6cf.jpg","nickname":"åˆ†æ¸…äº‘æ·¡","note":"","ucode":"7045AE6BF72D31","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1000004,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/44/d3d67640.jpg","nickname":"Hillså½•","note":"","ucode":"779020947ACABA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366835,"discussion_content":"å¾—ç”µè„‘ï¼Œè¿˜è¦æ‰“å¼€Wiresharkå¯¹ç€çœ‹ï¼Œå¾®ä¿¡è¯»ä¹¦çœ‹è¿™ç§ä¹¦å°±æ˜¯æµªè´¹æ—¶é—´","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1618203257,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":214828,"ip_address":""},"score":366835,"extra":""}]},{"author":{"id":1284474,"avatar":"https://static001.geekbang.org/account/avatar/00/13/99/7a/558666a5.jpg","nickname":"AceslupK","note":"","ucode":"048F84D019CBBB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394199,"discussion_content":"æ„Ÿè°¢åˆ†äº«å­¦ä¹ ç»éªŒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631780278,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1026042,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a7/fa/1dca9fd5.jpg","nickname":"ç‹æ˜Ÿæ——","note":"","ucode":"F1C742527D3A05","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":11872,"discussion_content":"æ„Ÿè°¢åˆ†äº«è¿™ä¹ˆæœ‰ä»·å€¼çš„ä¹¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568439144,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81502,"user_name":"allan","can_delete":false,"product_type":"c1","uid":1142819,"ip_address":"","ucode":"CA0BE868AA9FF5","user_header":"https://static001.geekbang.org/account/avatar/00/11/70/23/972dcd30.jpg","comment_is_top":false,"comment_ctime":1553928644,"is_pvip":false,"replies":[{"id":"29577","content":"æ˜¯çš„ï¼Œå†…æ ¸é€‰é¡¹çš„èŒƒå›´æ˜¯å…¨å±€çš„ï¼Œå¥—æ¥å­—æ¥å£é‡Œé¢è®¾ç½®çš„æ˜¯å•ä¸ª<br>","user_name":"ä½œè€…å›å¤","comment_id":81502,"uid":"1001282","ip_address":"","utype":1,"ctime":1554001367,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":3,"race_medal":0,"score":"44503601604","product_id":100020901,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼Œé—®ä¸€ä¸‹  å¥—æ¥å­—æ¥æ”¶å‘é€ç¼“å†²åŒºå’ŒTCPæ¥æ”¶å‘é€ç¼“å†²åŒºï¼Œæ˜¯ç›¸åŒçš„å—ï¼Ÿæˆ‘çš„ç†è§£è¿™ä¸¤ä¸ªåº”è¯¥æ˜¯ç›¸åŒçš„ç¼“å†²åŒºï¼Œåªæ˜¯å¥—æ¥å­—é€‰é¡¹çš„è®¾ç½®æ˜¯é’ˆå¯¹å•ä¸ªå¥—æ¥å­—ï¼Œè€Œå¯¹ TCPæ¥æ”¶å‘é€ç¼“å†²åŒºçš„è®¾ç½®ï¼Œé’ˆå¯¹çš„æ˜¯ å…¨å±€çš„æ‰€æœ‰å¥—æ¥å­— ï¼Œæ˜¯è¿™æ ·ç†è§£å—ï¼Ÿè¯·è€å¸ˆæŒ‡æ•™ã€‚","like_count":11,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445231,"discussion_content":"æ˜¯çš„ï¼Œå†…æ ¸é€‰é¡¹çš„èŒƒå›´æ˜¯å…¨å±€çš„ï¼Œå¥—æ¥å­—æ¥å£é‡Œé¢è®¾ç½®çš„æ˜¯å•ä¸ª\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554001367,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1803259,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/83/fb/621adceb.jpg","nickname":"linker","note":"","ucode":"6C5799F2FC2C82","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":217739,"discussion_content":"ä¸ä¸€æ ·ï¼Œä¸€ä¸ªæ˜¯udp,ä¸€ä¸ªæ˜¯tcp","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585578669,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1086235,"avatar":"https://static001.geekbang.org/account/avatar/00/10/93/1b/bf902c9d.jpg","nickname":"aliuql","note":"","ucode":"FCF6CEC8138A94","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3575,"discussion_content":"è€å¸ˆï¼Œé‚£net.core.rmem_maxå’Œnet.ipv4.tcp_rmemè¿™ä¸¤å‚æ•°æ˜¯é’ˆå¯¹åŒä¸€ä¸ªç¼“å†²åŒºçš„ä¹ˆï¼Ÿå¦‚æœæ˜¯åŒä¸€ä¸ªç¼“å†²åŒºï¼Œè¿™ä¸¤ä¸ªå‚æ•°çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘€ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564615922,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115402,"user_name":"è€¿é•¿å­¦","can_delete":false,"product_type":"c1","uid":1309948,"ip_address":"","ucode":"C7A262812854D4","user_header":"https://static001.geekbang.org/account/avatar/00/13/fc/fc/1e235814.jpg","comment_is_top":false,"comment_ctime":1563576942,"is_pvip":false,"replies":[{"id":"42487","content":"cat &#47;proc&#47;sys&#47;net&#47;ipv4&#47;tcp_mem æŸ¥çœ‹é…ç½®<br>cat &#47;proc&#47;net&#47;sockstat æŸ¥çœ‹å½“å‰tcpçš„ç»Ÿè®¡<br><br>ç„¶åå¯ä»¥é€šè¿‡ sysctl -w net.ipv4.tcp_mem=æ–°é…ç½® æ¥å¢å¤§<br>","user_name":"ä½œè€…å›å¤","comment_id":115402,"uid":"1001282","ip_address":"","utype":1,"ctime":1563805315,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"40218282606","product_id":100020901,"comment_content":"è€å¸ˆï¼Œæˆ‘æƒ³å’¨è¯¢ä¸‹tcp_memæ»¡äº†å¦‚ä½•æ’æŸ¥ï¼Œtcp_memæ»¡äº†ä¹‹åæ–°çš„è¿æ¥è¿›ä¸æ¥ï¼Œdmesgçœ‹åˆ°æœ‰tcp_memï¼šout of memçš„æç¤º","like_count":10,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459090,"discussion_content":"cat /proc/sys/net/ipv4/tcp_mem æŸ¥çœ‹é…ç½®\ncat /proc/net/sockstat æŸ¥çœ‹å½“å‰tcpçš„ç»Ÿè®¡\n\nç„¶åå¯ä»¥é€šè¿‡ sysctl -w net.ipv4.tcp_mem=æ–°é…ç½® æ¥å¢å¤§\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563805315,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":71592,"user_name":"ninuxer","can_delete":false,"product_type":"c1","uid":1243135,"ip_address":"","ucode":"5394ADAF2667D6","user_header":"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKQMM4m7NHuicr55aRiblTSEWIYe0QqbpyHweaoAbG7j2v7UUElqqeP3Ihrm3UfDPDRb1Hv8LvPwXqA/132","comment_is_top":false,"comment_ctime":1551399086,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"31616170158","product_id":100020901,"comment_content":"æ‰“å¡day45<br>å¥—è·¯ç¯‡æ€»æ˜¯å¹²è´§æ»¡æ»¡ï¼Œåªèƒ½é æ­»è®°ç¡¬èƒŒäº†<br>ç½‘ç»œæ˜¯æˆ‘çš„ç¡¬ä¼¤ï¼Œè€Œä¸”çœ‹ç½‘ç»œçš„ä¹¦ï¼Œæ¯”å¦‚ tcp&#47;ipåè®®å· æ€»æ˜¯æ²¡åŠæ³•å•ƒåˆ°åº•ï½æœ€é«˜å³°ä¹Ÿæ‰çœ‹åˆ°ä¸€ç™¾å…­åå¤šé¡µğŸ˜³","like_count":8},{"had_liked":false,"id":78079,"user_name":"é’çŸ³","can_delete":false,"product_type":"c1","uid":1215531,"ip_address":"","ucode":"B0056AD6453322","user_header":"https://static001.geekbang.org/account/avatar/00/12/8c/2b/3ab96998.jpg","comment_is_top":false,"comment_ctime":1553067661,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23027904141","product_id":100020901,"comment_content":"åšè§†é¢‘ä¸šåŠ¡æ—¶ï¼Œå…¬å¸äº§å“Recorderç”¨æ¥æ”¶å½•ç»„æ’­è§†é¢‘æºï¼Œæ”¶å½•ä¸‹æ¥çš„è§†é¢‘æ¯é—´éš”ä¸€æ®µæ—¶é—´å°±ä¼šå‡ºç°é©¬èµ›å…‹é—®é¢˜ã€‚<br><br>æœ€åˆä»æ—¥å¿—å’Œç›‘æ§ä¸­ï¼Œå‘ç°å‡ºç°é©¬èµ›å…‹çš„æ—¶é—´ç‚¹ï¼Œè¿›ç¨‹åœ¨åšå†™æ“ä½œï¼ŒåŒæ—¶ç›‘æ§ä¸Šçš„ç£ç›˜IOä¹Ÿæ¯”è¾ƒå¤§ï¼Œä½†å¹¶æ²¡æœ‰è¾¾åˆ°ç“¶é¢ˆã€‚<br><br>åæ¥å‘ç°ç½‘å¡UDPçš„packet receive errorsä¸æ–­å¢å¤§ã€‚å’Œç ”å‘ç¡®è®¤åï¼Œä»£ç ä¸Šæ¥æ”¶å’Œå†™æ˜¯åŒä¸€ä¸ªè¿›ç¨‹ã€‚å½“æ—¶æ€€ç–‘çš„åŸå› æ˜¯ï¼Œä½¿ç”¨åŒæ­¥IOå¯¼è‡´è¿›ç¨‹é˜»å¡ï¼Œé˜»å¡æ—¶é—´é•¿å¯¼è‡´æ¥æ”¶ç¼“æ…¢ï¼ŒUDPç¼“å­˜è¢«å æ»¡ç›´æ¥ä¸¢åŒ…ï¼Œè°ƒå¤§UDPçš„ç¼“å†²åŒºåï¼Œä¹Ÿåªæ˜¯ç¼“è§£é—®é¢˜å‘ç”Ÿçš„é¢‘ç‡ï¼Œå¹¶æ²¡æœ‰è§£å†³ã€‚å’Œç ”å‘æå‡ºæ”¹æˆå¼‚æ­¥IOï¼Œç ”å‘ç›´æ¥æ‹’ç»ï¼Œç°åœºè‡ªå·±æƒ³åŠæ³•ã€‚<br><br>æ²¡åŠæ³•ï¼Œåªèƒ½ç”³è¯·æœåŠ¡å™¨ï¼Œå¢åŠ æ”¶å½•æœåŠ¡å™¨æ•°é‡ã€è°ƒå¤§ç¼“å†²åŒºï¼Œé™ä½ç£ç›˜IOï¼Œå‡å°‘é—®é¢˜å‡ºç°çš„æ¦‚ç‡ã€‚","like_count":6},{"had_liked":false,"id":71655,"user_name":"æ˜ç¿¼","can_delete":false,"product_type":"c1","uid":1068361,"ip_address":"","ucode":"E77F86BEB3D5C1","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","comment_is_top":false,"comment_ctime":1551407867,"is_pvip":false,"replies":[{"id":"26309","content":"æˆ‘ä»¬ä¸“æ æœ‰ä¸ªå¾®ä¿¡ç¾¤å¯ä»¥åŠ å…¥","user_name":"ä½œè€…å›å¤","comment_id":71655,"uid":"1001282","ip_address":"","utype":1,"ctime":1551703673,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":7,"race_medal":0,"score":"23026244347","product_id":100020901,"comment_content":"è·Ÿä¸Šäº†ï¼Œä½†æ˜¯çœ‹çš„æœ‰ç‚¹ç²—ï¼Œè¿™ä¸ªç³»åˆ—æˆ‘è¦å¤šçœ‹å‡ éï¼Œæ€§èƒ½é—®é¢˜æ— éCPU å†…å­˜ IO ç½‘ç»œï¼Œæ„Ÿè°¢è€å¸ˆçš„è¯¾ç¨‹ï¼Œå¯¹è¿™ç±»é—®é¢˜å¿ƒç†æœ‰åº•äº†ï¼Œå¾ˆå–œæ¬¢å»æŒ‘æˆ˜é—®é¢˜äº†ğŸ˜å¥½æƒ³åŠ è€å¸ˆå¾®ä¿¡ï¼Œå¤§ç¥å¯ä»¥ä¸ğŸ˜³","like_count":6,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441258,"discussion_content":"æˆ‘ä»¬ä¸“æ æœ‰ä¸ªå¾®ä¿¡ç¾¤å¯ä»¥åŠ å…¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551703673,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":272355,"discussion_content":"åŠ æˆ‘å¾®ä¿¡å§ feisky","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1590292864,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1314794,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0f/ea/1c46a958.jpg","nickname":"å¤§é»„å–µ","note":"","ucode":"C993C43991F583","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366355,"discussion_content":"è¯·é—®ç¾¤å·å¤šå°‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618042138,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1827961,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/e4/79/0f0114ba.jpg","nickname":"taochao_zs","note":"","ucode":"77382AB0B3CC0E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":346918,"discussion_content":"ç¾¤å·å¤šå°‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612098375,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1339022,"avatar":"https://static001.geekbang.org/account/avatar/00/14/6e/8e/5d309a85.jpg","nickname":"æ‹¯æ•‘åœ°çƒå¥½ç´¯","note":"","ucode":"7643439601EF4C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":98620,"discussion_content":"æ±‚ç¾¤å·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577178173,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1068361,"avatar":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","nickname":"æ˜ç¿¼","note":"","ucode":"E77F86BEB3D5C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":45806,"discussion_content":"è€å¸ˆç¾¤å·å¤šå°‘ä¸€ç›´æ²¡æ‰¾åˆ°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573087991,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1000439,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/43/f7/abb7bfe3.jpg","nickname":"åˆ˜å†²","note":"","ucode":"0C4F66921AE76C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":43846,"discussion_content":"å¾®ä¿¡ç¾¤å·éº»çƒ¦å¤§ç¥å‘ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572913078,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":71798,"user_name":"å¤œç©ºä¸­æœ€äº®çš„æ˜Ÿ","can_delete":false,"product_type":"c1","uid":1267566,"ip_address":"","ucode":"ADC3E7B6789955","user_header":"https://static001.geekbang.org/account/avatar/00/13/57/6e/b6795c44.jpg","comment_is_top":false,"comment_ctime":1551436574,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14436338462","product_id":100020901,"comment_content":"è€å¸ˆçš„å¥—è·¯æ€»ç»“ï¼Œæ•´ç†çš„è¡¨æ ¼å¤ªæ£’äº†ï¼","like_count":3},{"had_liked":false,"id":71714,"user_name":"è…¾è¾¾","can_delete":false,"product_type":"c1","uid":1079876,"ip_address":"","ucode":"72F9CFBA44FDEE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL9hlAIKQ1sGDu16oWLOHyCSicr18XibygQSMLMjuDvKk73deDlH9aMphFsj41WYJh121aniaqBLiaMNg/132","comment_is_top":false,"comment_ctime":1551419703,"is_pvip":false,"replies":[{"id":"26318","content":"å¯ä»¥é€šè¿‡ &#47;proc&#47;net&#47;sockstatã€ss è¿™äº›å·¥å…·æ¥æŸ¥çœ‹ã€‚å›¾å½¢ç•Œé¢ä¹Ÿæœ‰å¾ˆå¤šï¼Œä¸è¿‡ä¸€èˆ¬éƒ½æ˜¯å†…ç½®åœ¨ç›‘æ§ç³»ç»Ÿé‡Œé¢ï¼Œé€šè¿‡ Web çš„æ–¹å¼æ¥å±•ç¤ºã€‚æ¯”å¦‚ zabbixã€Nagiosç­‰ç­‰","user_name":"ä½œè€…å›å¤","comment_id":71714,"uid":"1001282","ip_address":"","utype":1,"ctime":1551704921,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"14436321591","product_id":100020901,"comment_content":"tcp_rmemã€ tcp_wmemä»¥åŠå…¶ä»–å‡ ä¸ªæ‰€å¯¹åº”çš„ç¼“å†²åŒºçš„ä½¿ç”¨æƒ…å†µï¼Œæœ‰å·¥å…·å¯ä»¥æŸ¥çœ‹å—ï¼Ÿ åƒç±»ä¼¼â€œwatch -d cat &#47;proc&#47;softirqsâ€ è¿™æ ·å¯ä»¥è§‚å¯Ÿåˆ°ç¼“å†²åŒºçš„å˜åŒ–ã€‚å¦å¤–æœ‰å›¾å½¢ç•Œé¢å·¥å…·å—ï¼ŸæŸ¥çœ‹å¥—æ¥å­—ç¼“å†²åŒºã€TCPç¼“å†²åŒºå¤§å°å˜åŒ–çš„å›¾å½¢å·¥å…·ï¼Ÿ å¦å¤–å†é—®ä¸€ä¸‹ï¼Œå¥—æ¥å­—ç¼“å†²åŒºã€TCPç¼“å†²åŒº è¿™2ä¸ªæœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Ÿ<br>","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441292,"discussion_content":"å¯ä»¥é€šè¿‡ /proc/net/sockstatã€ss è¿™äº›å·¥å…·æ¥æŸ¥çœ‹ã€‚å›¾å½¢ç•Œé¢ä¹Ÿæœ‰å¾ˆå¤šï¼Œä¸è¿‡ä¸€èˆ¬éƒ½æ˜¯å†…ç½®åœ¨ç›‘æ§ç³»ç»Ÿé‡Œé¢ï¼Œé€šè¿‡ Web çš„æ–¹å¼æ¥å±•ç¤ºã€‚æ¯”å¦‚ zabbixã€Nagiosç­‰ç­‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551704921,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":72117,"user_name":"xfan","can_delete":false,"product_type":"c1","uid":1315147,"ip_address":"","ucode":"48ED8D498D7F56","user_header":"https://static001.geekbang.org/account/avatar/00/14/11/4b/fa64f061.jpg","comment_is_top":false,"comment_ctime":1551524197,"is_pvip":false,"replies":[{"id":"26327","content":"å¯ä»¥å»å‚è€ƒä¸€ä¸‹XDPçš„æ–‡æ¡£https:&#47;&#47;prototype-kernel.readthedocs.io&#47;en&#47;latest&#47;networking&#47;XDP&#47;index.html","user_name":"ä½œè€…å›å¤","comment_id":72117,"uid":"1001282","ip_address":"","utype":1,"ctime":1551706230,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"10141458789","product_id":100020901,"comment_content":"è€å¸ˆï¼Œæˆ‘æ˜¯ç”¨bpftoolsç”Ÿæˆäº†ä¸€ä¸ªè¿‡æ»¤è§„åˆ™çš„å­—èŠ‚ç bytecodeï¼Œbpfgen dns -- *.www.example.ukï¼Œè¿™ä¸ªè§„åˆ™æ€ä¹ˆæ ·åŠ åˆ°ç½‘å¡é©±åŠ¨ä¸Šå»å‘¢ï¼Œå°±æ˜¯æ€ä¹ˆå®‰è£…åˆ° linux18.04 ä¸Šå»å‘¢.æˆ‘çŸ¥é“load_bpf_file è¿™ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯æˆ‘åœ¨å“ªè°ƒç”¨å‘¢ï¼Œè€å¸ˆç»™æˆ‘ä¸€ä¸ªæ€è·¯ï¼Œæˆ‘æƒ³è‡ªå·±å®ç°ä¸€å¥—å…³äºåŠ¨æ€ä½¿ç”¨XDPæ‹¦æˆªåŒ…çš„é¡¹ç›®","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441467,"discussion_content":"å¯ä»¥å»å‚è€ƒä¸€ä¸‹XDPçš„æ–‡æ¡£https://prototype-kernel.readthedocs.io/en/latest/networking/XDP/index.html","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551706230,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":212568,"user_name":"lupguo","can_delete":false,"product_type":"c1","uid":1009098,"ip_address":"","ucode":"1B55A01DF78647","user_header":"https://static001.geekbang.org/account/avatar/00/0f/65/ca/38dcd55a.jpg","comment_is_top":false,"comment_ctime":1588151111,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5883118407","product_id":100020901,"comment_content":"å…³äºå¥—æ¥å­—ç¼“å­˜Bufferçš„è¡¥å……ä¸‹man tcpçš„ä¿¡æ¯ï¼š<br>1. æ»‘åŠ¨çª—å£æ”¯æŒ &gt; 64kçš„TCPçª—å£ï¼Œæ”¯æŒé«˜æ—¶å»¶é“¾æ¥ï¼›é»˜è®¤ç¼“å†²åŒºå¤§å°å—å…¨å±€&#47;proc&#47;sys&#47;net&#47;ipv4&#47;tcp_wmemã€&#47;proc&#47;sys&#47;net&#47;ipv4&#47;tcp_rmemé™åˆ¶ï¼Œé’ˆå¯¹å•ä¸ªå¥—æ¥å­—é“¾æ¥ï¼Œå¯ä»¥åŸºäºSO_SNDBUFå’ŒSO_RCVBUFæ¥è®¾ç½®ï¼ˆéœ€è¦åœ¨è°ƒç”¨connectæˆ–listenä¹‹å‰é€šè¿‡setsockoptè®¾ç½®ï¼‰ï¼›<br>2. å¥—æ¥å­—çš„ç¼“å†²åŒºSO_SNDBUFå’ŒSO_RCVBUFFæœ€å¤§å€¼ï¼Œå—&#47;proc&#47;sys&#47;net&#47;core&#47;rmem_maxã€&#47;proc&#47;sys&#47;net&#47;core&#47;wmem_maxå†…æ ¸é™åˆ¶<br>3. é€šè¿‡setsockoptè®¾ç½®çš„ç¼“å­˜åŒºå®é™…å†…æ ¸åˆ†é…çš„ç©ºé—´æ˜¯ä¸¤å€è®¾ç½®çš„å¤§å°<br>4. ä¸è¦éšæ„è®¾ç½®å¥—æ¥å­—çš„SO_SNDBUFå’ŒSO_RCVBUFFï¼Œå†…æ ¸æ–¹é¢çš„è‡ªåŠ¨è°ƒæ§æ•ˆæœæ¯”é…ç½®çš„è¦å¥½ï¼Œå…·ä½“è°ƒæ•´èŒƒå›´tcp_wmem [min,default,max]","like_count":2},{"had_liked":false,"id":74307,"user_name":"cliff(äº®å‰‘)","can_delete":false,"product_type":"c1","uid":1314866,"ip_address":"","ucode":"A8D1A92331AE20","user_header":"https://static001.geekbang.org/account/avatar/00/14/10/32/e37aacfe.jpg","comment_is_top":false,"comment_ctime":1552185808,"is_pvip":false,"replies":[{"id":"27334","content":"å†…æ ¸é…ç½®é€‰é¡¹æ˜¯å…¨å±€çš„ï¼Œå¯¹æ‰€æœ‰socketç”Ÿæ•ˆï¼›ç³»ç»Ÿè°ƒç”¨é’ˆå¯¹çš„æ˜¯å•ä¸ªsocketï¼Œä»–ä»¬çš„æ€»å’Œå—é™äºå†…æ ¸é…ç½®","user_name":"ä½œè€…å›å¤","comment_id":74307,"uid":"1001282","ip_address":"","utype":1,"ctime":1552349555,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"5847153104","product_id":100020901,"comment_content":"è€å¸ˆå¥½ï¼Œ è¯´å®åœ¨ï¼Œå­¦äº†ä¸¤è¾¹è¿˜æ˜¯ä¸æ˜ç™½å¦‚ä¸‹æ•°æ®ä¹‹é—´çš„å…³ç³»ï¼š<br><br>SO_RCVBUFF, net&#47;core&#47;optmem_maxï¼Œ<br>net&#47;core&#47;rmem_maxï¼Œ<br>net&#47;ipv4&#47;tcp_rmem å’Œnet&#47;ipv4&#47;tcp_mem<br><br>æ¯”å¦‚æœ‰å¦‚ä¸‹çš„æµ‹è¯•ç¯å¢ƒï¼š<br>1ï¼‰æœåŠ¡å™¨ç«¯:<br>åº”ç”¨ç¨‹åºå¼€äº†10ä¸ªtcpæœåŠ¡å™¨socketï¼Œæ¯ä¸ªè®¾ç½®10K SO_RCVBUFF<br>è®¾ç½®ç³»ç»Ÿå‚æ•°å¦‚ä¸‹:<br>net&#47;core&#47;optmem_max = 10K<br>net&#47;core&#47;rmem_max =100K<br>net&#47;ipv4&#47;tcp_rmem 4k  16K 80K<br>net&#47;ipv4&#47;tcp_mem  40K  50K 120K<br>2ï¼‰å®¢æˆ·ç«¯è½®æµå‘é€TCPæ¶ˆæ¯ç»™æœåŠ¡å™¨:<br>é‚£å‡è®¾æœåŠ¡å™¨çš„åº”ç”¨å¿™ï¼Œ æ‰€æœ‰10ä¸ªTCPçš„bufferèƒ½ç¼“å­˜100Kçš„TCPæ•°æ®ä¹ˆï¼Ÿ<br>å¦‚æœä¸èƒ½ï¼Œ å¦‚ä½•è°ƒæ•´ç³»ç»Ÿå‚æ•°å¯ä»¥æ»¡è¶³ç¼“å­˜100Kçš„æ•°æ®ï¼Ÿ<br>å…ˆè°¢è°¢è€å¸ˆ","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442520,"discussion_content":"å†…æ ¸é…ç½®é€‰é¡¹æ˜¯å…¨å±€çš„ï¼Œå¯¹æ‰€æœ‰socketç”Ÿæ•ˆï¼›ç³»ç»Ÿè°ƒç”¨é’ˆå¯¹çš„æ˜¯å•ä¸ªsocketï¼Œä»–ä»¬çš„æ€»å’Œå—é™äºå†…æ ¸é…ç½®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552349555,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":72360,"user_name":"J!","can_delete":false,"product_type":"c1","uid":1305003,"ip_address":"","ucode":"71C946119B59D1","user_header":"https://static001.geekbang.org/account/avatar/00/13/e9/ab/37903736.jpg","comment_is_top":false,"comment_ctime":1551596857,"is_pvip":false,"replies":[{"id":"26329","content":"ç³»ç»Ÿä¼šå›æ”¶æ‰","user_name":"ä½œè€…å›å¤","comment_id":72360,"uid":"1001282","ip_address":"","utype":1,"ctime":1551706458,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"5846564153","product_id":100020901,"comment_content":"å¯¹äºkill -9 è¿›ç¨‹è¿™æ ·çš„æƒ…å†µï¼Œå·²å»ºç«‹çš„tcpè¿æ¥å¦‚ä½•å¤„ç†ï¼Œè¿˜æ˜¯ç”±æ“ä½œç³»ç»Ÿä¸»åŠ¨å›æ”¶ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441557,"discussion_content":"ç³»ç»Ÿä¼šå›æ”¶æ‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551706458,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":71841,"user_name":"ç§‘å­¦Jia","can_delete":false,"product_type":"c1","uid":1080409,"ip_address":"","ucode":"95430413F82A69","user_header":"https://static001.geekbang.org/account/avatar/00/10/7c/59/26b1e65a.jpg","comment_is_top":false,"comment_ctime":1551449280,"is_pvip":false,"replies":[{"id":"26322","content":"å®é™…ä¸Šæ²¡æœ‰é€šç”¨çš„æ–¹æ³•ï¼Œuprobeåº”è¯¥æ˜¯å¯ä»¥ç”¨çš„ï¼Œä¸è¿‡ä½¿ç”¨èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ã€‚æ¨èçš„åšæ³•æ˜¯åœ¨åº”ç”¨å†…éƒ¨æä¾›metrics æ¥å£ï¼Œè¿™ä¸ªæ¥å£å†…éƒ¨ç»Ÿè®¡æ¯ä¸ªæ–¹æ³•çš„è°ƒç”¨æƒ…å†µã€‚","user_name":"ä½œè€…å›å¤","comment_id":71841,"uid":"1001282","ip_address":"","utype":1,"ctime":1551705344,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"5846416576","product_id":100020901,"comment_content":"è€å¸ˆï¼Œæƒ³é—®é—®æ‚¨ï¼šç°åœ¨æˆ‘é‡åˆ°åº”ç”¨ç¨‹åºåœ¨è´Ÿè½½æµ‹è¯•ä¸­å¯èƒ½å¤„ç†é€Ÿåº¦æ…¢é€ æˆäº†æ¶ˆæ¯å“åº”å»¶è¿Ÿï¼Œæˆ‘è¯¥ç”¨ä»€ä¹ˆæ–¹æ³•æˆ–è€…å·¥å…·å»æŸ¥çœ‹è¿™ä¸ªåº”ç”¨ç¨‹åºé‡Œæ¯ä¸ªæ–¹æ³•çš„æ—¶é—´è°ƒç”¨ï¼Ÿåƒperfè¿™ä¸ªå·¥å…·å¯ä»¥çœ‹æ¯ä¸ªè°ƒç”¨æ–¹æ³•çš„cpuåˆ©ç”¨ç‡ä¸€æ ·ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441354,"discussion_content":"å®é™…ä¸Šæ²¡æœ‰é€šç”¨çš„æ–¹æ³•ï¼Œuprobeåº”è¯¥æ˜¯å¯ä»¥ç”¨çš„ï¼Œä¸è¿‡ä½¿ç”¨èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ã€‚æ¨èçš„åšæ³•æ˜¯åœ¨åº”ç”¨å†…éƒ¨æä¾›metrics æ¥å£ï¼Œè¿™ä¸ªæ¥å£å†…éƒ¨ç»Ÿè®¡æ¯ä¸ªæ–¹æ³•çš„è°ƒç”¨æƒ…å†µã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551705344,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":71685,"user_name":"æˆ‘æ¥ä¹Ÿ","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1551413267,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5846380563","product_id":100020901,"comment_content":"[D43æ‰“å¡]<br>åˆå¼€å§‹å¥—è·¯å’¯ã€‚å¥½å¥½æ”¶è—ã€‚<br>ç½‘ç»œæ¥æ”¶&#47;å‘é€æµç¨‹ å›¾ç‰‡ç”»çš„å¾ˆç›´è§‚ã€‚ğŸ˜„<br>","like_count":1},{"had_liked":false,"id":71677,"user_name":"æ€€ç‰¹","can_delete":false,"product_type":"c1","uid":1072331,"ip_address":"","ucode":"3DACB205798ED3","user_header":"https://static001.geekbang.org/account/avatar/00/10/5c/cb/3ebdcc49.jpg","comment_is_top":false,"comment_ctime":1551410362,"is_pvip":true,"replies":[{"id":"26312","content":"ä¸ä¸€å®šéè¦å¼‚æ­¥ï¼Œä½†éé˜»å¡ã€epoll æ˜¯æ¯”è¾ƒé€šç”¨çš„ç½‘ç»œæ€§èƒ½ä¼˜åŒ–æ–¹æ³•","user_name":"ä½œè€…å›å¤","comment_id":71677,"uid":"1001282","ip_address":"","utype":1,"ctime":1551704395,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"5846377658","product_id":100020901,"comment_content":"      æˆ‘ä¹‹å‰åšè¿‡ä¸€ä¸ªä¼˜åŒ–é¡¹ç›®ã€‚è¯¥é¡¹ç›®éœ€è¦å®ç°ä¸€ä¸ªC&#47;Sç»“æ„çš„ç¨‹åºï¼Œå‘é€URLç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨è¿”å›URLçš„ç±»åˆ«ï¼Œæ¯”å¦‚å±äºå†›äº‹ï¼Œè¿˜æ˜¯å±äºä½“è‚²ã€‚<br>      å½“æ—¶åœ¨å±€åŸŸç½‘ç¯å¢ƒä¸‹ï¼Œæ€§èƒ½è¾ƒå·®ï¼Œæˆ‘ç»è¿‡åˆ†æä¹‹åï¼Œâ€œæ„Ÿè§‰â€œç“¶é¢ˆåœ¨ç½‘ç»œï¼Œæ˜¯å› ä¸ºæ¯ä¸ªåŒ…çš„æœ‰æ•ˆè´Ÿè½½å¤ªå°ï¼Œæ‰€ä»¥æ”¹è¿›ç­–ç•¥æ˜¯å°†å¤šä¸ªurlæ‹¼æ¥åœ¨ä¸€èµ·å†å‘é€å‡ºå»ï¼Œç„¶åè§£æè¿”å›çš„ç»“æœç»™æ¯ä¸ªurlã€‚æ‹¼æ¥è¿‡ç¨‹å’Œè§£æè¿‡ç¨‹éƒ½æ˜¯æˆ‘è‡ªå·±å®ç°çš„ã€‚<br>      å¬äº†å€ªå·¥çš„è®²åº§ï¼Œå†å›é¡¾å½“æ—¶çš„å®ç°ï¼Œèƒ½çœ‹åˆ°å½“æ—¶çš„ä¸è¶³ï¼šæˆ‘æ‰¾åˆ°äº†é—®é¢˜çš„ç—‡ç»“æ‰€åœ¨ï¼Œä½†å´ç”¨äº†å¾ˆç¬¨çš„å®ç°æ–¹æ³•æ¥æ”¹è¿›ã€‚è²Œä¼¼åœ¨å¥—æ¥å­—å±‚å¢åŠ TCP_COREï¼Œç„¶ååœ¨åº”ç”¨ç¨‹åºå±‚å°†å¤„ç†æ”¹ä¸ºå¼‚æ­¥éé˜»å¡çš„ï¼Œå°±å¯ä»¥äº†å§ï¼Ÿ<br>      æ”¶è·é¢‡å¤šï¼Œè°¢è°¢å€ªå·¥ã€‚","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441271,"discussion_content":"ä¸ä¸€å®šéè¦å¼‚æ­¥ï¼Œä½†éé˜»å¡ã€epoll æ˜¯æ¯”è¾ƒé€šç”¨çš„ç½‘ç»œæ€§èƒ½ä¼˜åŒ–æ–¹æ³•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551704395,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":315935,"user_name":"Helios","can_delete":false,"product_type":"c1","uid":1380758,"ip_address":"","ucode":"BE6B98EE8F0D09","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJrOl63enWXCRxN0SoucliclBme0qrRb19ATrWIOIvibKIz8UAuVgicBMibIVUznerHnjotI4dm6ibODA/132","comment_is_top":false,"comment_ctime":1634053061,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634053061","product_id":100020901,"comment_content":"è¯·é—®è€å¸ˆsocketçš„ç¼“å†²åŒºå¤§å°é€‚ç”¨äºUnix domain socketä¹ˆ","like_count":0},{"had_liked":false,"id":244726,"user_name":"æ°¸å","can_delete":false,"product_type":"c1","uid":2074095,"ip_address":"","ucode":"23BAB07BC3E103","user_header":"https://static001.geekbang.org/account/avatar/00/1f/a5/ef/22e92738.jpg","comment_is_top":false,"comment_ctime":1598632450,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1598632450","product_id":100020901,"comment_content":"è€å¸ˆè¯·æ•™ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆSpring booté¡¹ç›®ä¸­ï¼Œç”¨curlå»äº§ç”Ÿä¸€ä¸ªtomcatçº¿ç¨‹æ‰§è¡Œä¸€ä¸ªé•¿æ—¶é—´ä»»åŠ¡ï¼ˆtomcatæ²¡æœ‰åˆ«çš„è¯·æ±‚ï¼‰ï¼Œä¼šioæ˜æ˜¾å¿™äº jdkçº¿ç¨‹æ± èµ·çš„ä¸€ä¸ªçº¿ç¨‹åšåŒæ ·çš„ä»»åŠ¡ï¼Œç›®å‰æ²¡æœ‰å¥½çš„æ€è·¯ï¼Œæˆ‘ä»»åŠ¡éƒ½æ˜¯å•çº¿ç¨‹æ‰§è¡Œç†è®ºæ—¶é—´éƒ½å·®ä¸å¤šï¼Œæµ‹è¯•ç¯å¢ƒåœ¨æ²¡æœ‰ä»»ä½•è®¿é—®çš„æƒ…å†µä¸‹ä¹Ÿæ˜¯åŒæ ·çš„å¤ç°ã€‚è®¿é—®æ–¹å¼æ˜¯jpaè®¿é—®çš„oracleã€‚","like_count":0,"discussions":[{"author":{"id":1959822,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/e7/8e/318cfde0.jpg","nickname":"Spoon","note":"","ucode":"2FF9193AD482C2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335927,"discussion_content":"IOæ˜æ˜¾å¿™äºJDKçº¿ç¨‹æ± èµ·ä¸€ä¸ªçº¿ç¨‹åšåŒæ ·ä»»åŠ¡ï¼Œè¿™é‡ŒIOæ˜æ˜¾å¿™äºä½ æ˜¯ç”¨ä»€ä¹ˆæŒ‡æ ‡å»è¡¡é‡çš„ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608386252,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":224866,"user_name":"å¦¥å","can_delete":false,"product_type":"c1","uid":1249656,"ip_address":"","ucode":"7201DFE9C12669","user_header":"https://static001.geekbang.org/account/avatar/00/13/11/78/4f0cd172.jpg","comment_is_top":false,"comment_ctime":1591579300,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1591579300","product_id":100020901,"comment_content":"çœ‹äº†æ–‡ç« å’Œç•™è¨€ï¼Œå¯¹å¥—æ¥å­—è¯»å†™ç¼“å­˜åŒºå’ŒTCPè¯»å†™ç¼“å­˜åŒºï¼Œè¿˜æ˜¯æœ‰äº›ç–‘é—®ï¼Œè€å¸ˆç•™è¨€å›å¤ä¸­ï¼šå†…æ ¸é€‰é¡¹çš„èŒƒå›´æ˜¯å…¨å±€çš„ï¼Œå¥—æ¥å­—æ¥å£é‡Œé¢è®¾ç½®çš„æ˜¯å•ä¸ªã€‚è€Œè€å¸ˆæˆªå›¾ä¸­çš„å¥—æ¥å­—å†…æ ¸é€‰é¡¹åˆ—è¡¨ï¼Œé‡Œé¢éƒ½æ˜¯å†…æ ¸çš„ã€‚å¥—æ¥å­—è¯»å†™ç¼“å­˜åŒºå’ŒTCPè¯»å†™ç¼“å­˜åŒºæ˜¯ä»€ä¹ˆå…³ç³»ï¼Œæœ‰å“ªäº›å·®å¼‚å‘¢ã€‚æˆ‘ç†è§£æ˜¯ä¸€ä¸ªTCPè¿æ¥å¯¹åº”ä¸€ä¸ªè¯»å†™ç¼“å­˜åŒºï¼Œè€ŒUDPåªæœ‰è¯»ç¼“å­˜åŒºï¼Œè€å¸ˆæŒ‡çš„æ˜¯æŒ‡é’ˆå…¨å±€çš„ï¼Œæˆ‘ç†è§£æ˜¯å¯¹äºæ¯ä¸€ä¸ªTCPè¿æ¥æˆ–è€…UDPéƒ½æ˜¯ç”Ÿæ•ˆçš„ï¼Œä½†æ˜¯é’ˆå¯¹å•ä¸ªç”Ÿæ•ˆæ˜¯å•¥æ„æ€ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1959822,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/e7/8e/318cfde0.jpg","nickname":"Spoon","note":"","ucode":"2FF9193AD482C2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335928,"discussion_content":"æ˜¯è°ƒç”¨ç³»ç»ŸAPIè¿›è¡Œè®¾ç½®ï¼Œåº”è¯¥æ˜¯ç”¨æˆ·è®¾ç½®ä¼šè¦†ç›–é»˜è®¤è®¾ç½®ï¼Œå¯ä»¥å‚çœ‹ä¸‹UNIXç½‘ç»œç¼–ç¨‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608386317,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":199705,"user_name":"å—å±±","can_delete":false,"product_type":"c1","uid":1119593,"ip_address":"","ucode":"94656FE4A6C378","user_header":"https://static001.geekbang.org/account/avatar/00/11/15/69/187b9968.jpg","comment_is_top":false,"comment_ctime":1585494178,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1585494178","product_id":100020901,"comment_content":"ç½‘ç»œåŸºç¡€ç†è®ºç›¸å…³çš„çŸ¥è¯†çœŸçš„æ˜¯ç¡¬ä¼¤ï¼","like_count":0},{"had_liked":false,"id":192637,"user_name":"201200986","can_delete":false,"product_type":"c1","uid":1900861,"ip_address":"","ucode":"6042C42D1C904E","user_header":"","comment_is_top":false,"comment_ctime":1584864762,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584864762","product_id":100020901,"comment_content":"å®é™…ä¸­å‘ç°ä»€ä¹ˆç“¶é¢ˆç‚¹éœ€è¦è°ƒèŠ‚å¥—æ¥å­—çš„è®¾ç½®é€‰é¡¹å‘¢ï¼Ÿæˆ‘åœ¨å®é™…çš„ä¸šåŠ¡ä¸­å‘ç°ç½‘ç»œå¸¦å®½åˆ©ç”¨ç‡å¾ˆé«˜ï¼Œä½†æ˜¯è°ƒèŠ‚è¿™äº›å‚æ•°æ²¡æœ‰ä»€ä¹ˆä½œç”¨","like_count":0},{"had_liked":false,"id":184617,"user_name":"gamefu","can_delete":false,"product_type":"c1","uid":1210031,"ip_address":"","ucode":"0446E369725FD7","user_header":"https://static001.geekbang.org/account/avatar/00/12/76/af/96f9893f.jpg","comment_is_top":false,"comment_ctime":1583371878,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583371878","product_id":100020901,"comment_content":"è€å¸ˆï¼Œæƒ³è¯·æ•™ä¸ªé—®é¢˜ï¼Œå¦‚ä½•åˆ¤æ–­tcpåè®®æ ˆç¼“å†²åŒºå’Œå¥—æ¥å­—ç¼“å†²åŒºåˆ°ç“¶é¢ˆäº†ï¼Ÿ","like_count":0},{"had_liked":false,"id":96802,"user_name":"zhoufeng","can_delete":false,"product_type":"c1","uid":1447741,"ip_address":"","ucode":"6F92F7866F9EB4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKq0oQVibKcmYJqmpqaNNQibVgia7EsEgW65LZJIpDZBMc7FyMcs7J1JmFCtp06pY8ibbcpW4ibRtG7Frg/132","comment_is_top":false,"comment_ctime":1558511371,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558511371","product_id":100020901,"comment_content":"è€å¸ˆå¥½ï¼Œ<br>è¯·æ•™ä¸‹è¯»ç¼“å†²åŒºå’Œæ¥æ”¶çª—å£ã€å†™ç¼“å†²åŒºå’Œå‘é€çª—å£ä¹‹é—´æ˜¯å¦æœ‰å…³ç³»ï¼Ÿæˆ‘åˆ†ä¸æ¸…ä»–ä»¬ä¹‹é—´çš„åŒºåˆ«ã€‚<br>è°¢è°¢ã€‚","like_count":0},{"had_liked":false,"id":91988,"user_name":"ThinkerWalker","can_delete":false,"product_type":"c1","uid":1317111,"ip_address":"","ucode":"8CD44FFC37ACB7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/rQOn22bNV0kHpoPWRLRicjQCOkiaYmcVABiaIJxIDWIibSdqWXYTxjcdjiadibIxFsGVp5UE4DBd6Nx2DxjhAdlMIZeQ/132","comment_is_top":false,"comment_ctime":1557149787,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557149787","product_id":100020901,"comment_content":"ä½ å¥½è€å¸ˆï¼Œä¸å¤ªç†è§£å¥—æ¥å­—æ”¶å‘ç¼“å†²åŒºå’Œtcpæ”¶å‘ç¼“å†²åŒºçš„åŒºåˆ«ï¼Œéº»çƒ¦è¯¦ç»†è®²è§£ä¸€ä¸‹ã€‚","like_count":0},{"had_liked":false,"id":90507,"user_name":"tinsang","can_delete":false,"product_type":"c1","uid":1066414,"ip_address":"","ucode":"89AE9D3837BEFA","user_header":"https://static001.geekbang.org/account/avatar/00/10/45/ae/a213a2a3.jpg","comment_is_top":false,"comment_ctime":1556539972,"is_pvip":false,"replies":[{"id":"32526","content":"è¯·å‚è€ƒI&#47;Oæ¨¡å—æ’æŸ¥IOé—®é¢˜","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1556633882,"ip_address":"","comment_id":90507,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1556539972","product_id":100020901,"comment_content":"ä½ å¥½ é¡¹ç›®é‡Œå‘ç°ä¸ªé—®é¢˜ï¼ŒæœåŠ¡å™¨centos6.5å¼€å¯tcpæœåŠ¡ï¼Œå®¢æˆ·ç«¯æ¯ç§’100ä¸ªè¯·æ±‚ï¼Œå‘ç°ioè´Ÿè½½åé«˜ï¼Œå½“å‰æœåŠ¡ç«¯åªæ˜¯æ¥æ”¶è¯·æ±‚è®¡ç®— ï¼Œcpuä½¿ç”¨ç‡ä¹Ÿå¾ˆä½ï¼Œè¯·é—®å¦‚ä½•å»å®šä½é—®é¢˜å‘¢","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448549,"discussion_content":"è¯·å‚è€ƒI/Oæ¨¡å—æ’æŸ¥IOé—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556633882,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89400,"user_name":"ä¸œå®‡","can_delete":false,"product_type":"c1","uid":1118347,"ip_address":"","ucode":"2F0A8C67D55B5C","user_header":"https://static001.geekbang.org/account/avatar/00/11/10/8b/7e84507c.jpg","comment_is_top":false,"comment_ctime":1556164133,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1556164133","product_id":100020901,"comment_content":"æ‚¨å¥½è€å¸ˆï¼Œæˆ‘æƒ³å’¨è¯¢ä¸‹ æˆ‘ä»¬çš„æ¥å—ç¨‹åºAæ˜¯10ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹åˆè¿æ¥90ä¸ªç¨‹åºBï¼Œæ¯ä¸ªçº¿ç¨‹è¿æ¥90ä¸ªç¨‹åºBéƒ½æ˜¯ç›¸åŒçš„ï¼Œç¨‹åºAä¹Ÿæ˜¯ä¸ªæ¥å—ç¨‹åºï¼Œç°åœ¨å‘ç°ç¨‹åºAçš„socketçš„tcpæ¥å—ç¼“å­˜å‡ºç°å µçš„ç°è±¡ï¼Œè€Œä¸”tcpç¼“å­˜ä¸å˜åŒ–ï¼Œæˆ‘æƒ³å’¨è¯¢ä¸‹ï¼Œå¦‚æœç¨‹åºAä¸è¿æ¥ç¨‹åºBï¼Œtcpä¸ä¼šå‡ºç°å µï¼Œæ˜¯socketæ•°é‡å¤ªå¤šï¼Œå¯¼è‡´tcpç¼“å­˜å µå—ã€‚","like_count":0,"discussions":[{"author":{"id":1959822,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/e7/8e/318cfde0.jpg","nickname":"Spoon","note":"","ucode":"2FF9193AD482C2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335929,"discussion_content":"æ„Ÿè§‰ç“¶é¢ˆå‡ºç°åœ¨è¿æ¥90ä¸ªç¨‹åºBå¤„ï¼Œæ¢å¥è¯è¯´å°±æ˜¯ä¸šåŠ¡é€»è¾‘å¤„ç†äº‹ä»¶è¿‡é•¿ï¼Œå¯¼è‡´tcpå…¨è¿æ¥é˜Ÿåˆ—ä¸­å †ç§¯äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608386496,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":84585,"user_name":"å¦‚æœ","can_delete":false,"product_type":"c1","uid":1320638,"ip_address":"","ucode":"138A3EEEE50850","user_header":"","comment_is_top":false,"comment_ctime":1554880132,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554880132","product_id":100020901,"comment_content":"DAY43ï¼Œæ‰“å¡","like_count":0},{"had_liked":false,"id":79415,"user_name":"Maxwell","can_delete":false,"product_type":"c1","uid":1086275,"ip_address":"","ucode":"720A00AD472616","user_header":"https://static001.geekbang.org/account/avatar/00/10/93/43/0e84492d.jpg","comment_is_top":false,"comment_ctime":1553478024,"is_pvip":false,"replies":[{"id":"29339","content":"çº¿ç¨‹æ•°è¿˜å—é™äºCPUï¼Œä¸åªæ˜¯ç½‘ç»œå¸¦å®½","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1553698735,"ip_address":"","comment_id":79415,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553478024","product_id":100020901,"comment_content":"iperfæµ‹è¯•çš„ç½‘ç»œå¸¦å®½æ˜¯1G,é‚£å¦‚æœ1ä¸ªçº¿ç¨‹éœ€è¦æ¶ˆè€—2mb,å‹æµ‹çš„æ—¶å€™æ˜¯ä¸æ˜¯å°±å¯ä»¥æ”¯æŒ500ä¸ªçº¿ç¨‹ï¼Ÿä¹Ÿå°±æ˜¯è¯´è¶…è¿‡500çº¿ç¨‹ç½‘ç»œå°±æˆä¸ºç“¶é¢ˆäº†ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444491,"discussion_content":"çº¿ç¨‹æ•°è¿˜å—é™äºCPUï¼Œä¸åªæ˜¯ç½‘ç»œå¸¦å®½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553698735,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":73927,"user_name":"dancer","can_delete":false,"product_type":"c1","uid":1019036,"ip_address":"","ucode":"B8D5641A3AC490","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8c/9c/d48473ab.jpg","comment_is_top":false,"comment_ctime":1552036073,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552036073","product_id":100020901,"comment_content":"è€å¸ˆçš„å°è¡¨æ ¼å’Œå°æŠ„å·®ä¸å¤šäº†ï¼Œæ‰“å°å‡ºæ¥è´´åœ¨åŠå…¬æ¡Œä¸Š","like_count":0},{"had_liked":false,"id":72891,"user_name":"xfan","can_delete":false,"product_type":"c1","uid":1315147,"ip_address":"","ucode":"48ED8D498D7F56","user_header":"https://static001.geekbang.org/account/avatar/00/14/11/4b/fa64f061.jpg","comment_is_top":false,"comment_ctime":1551751312,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551751312","product_id":100020901,"comment_content":"æ–‡æ¡£å¾ˆè¯¦ç»†ï¼Œæ„Ÿè°¢","like_count":0}]}