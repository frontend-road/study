{"id":613301,"title":"03ï½œéšå¼ä¼ é€’ï¼šå¦‚ä½•ç²¾å‡†æ‰¾å‡ºä¸€æ¬¡è¯·æ±‚çš„å…¨éƒ¨æ—¥å¿—ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ä½•è¾‰ã€‚</p><p>ä¸Šä¸€è®²æˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•æŠŠä¸€äº›è€—æ—¶çš„ä¸šåŠ¡è¿›è¡Œå¼‚æ­¥åŒ–æ”¹é€ ï¼Œæ ¸å¿ƒä¸‰è¦ç´ å°±æ˜¯å¼€å¯å¼‚æ­¥æ¨¡å¼ã€è¡”æ¥ä¸Šä¸‹æ–‡ä¿¡æ¯ã€å°†ç»“æœå†™å…¥åˆ°ä¸Šä¸‹æ–‡ä¸­ï¼Œè¿™ä¹Ÿæ˜¯Dubboçš„å¼‚æ­¥å®ç°åŸç†ã€‚</p><p>ä»Šå¤©æˆ‘ä»¬ç»§ç»­æ¢ç´¢Dubboæ¡†æ¶çš„ç¬¬äºŒé“ç‰¹è‰²é£å‘³ï¼Œéšå¼ä¼ é€’ã€‚</p><p>åœ¨æˆ‘ä»¬ç—›å¹¶å¿«ä¹ç€çš„æ—¥å¸¸å¼€å‘å·¥ä½œä¸­ï¼Œä¿®bugå·²ç»æ˜¯å¾ˆå¸¸è§ä¸€ç¯äº†ï¼Œå½“ç¼–å†™çš„åŠŸèƒ½å‡ºäº†bugï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šå…ˆæ ¹æ®ç°è±¡åˆ†æå¯èƒ½å­˜åœ¨çš„é—®é¢˜ï¼Œå¦‚æœæ²¡å¤´ç»ªï¼Œå°±ä¼šç»§ç»­æ ¹æ®ç”¨æˆ·æä¾›çš„æœ‰é™å…³é”®å­—ä¿¡æ¯ï¼Œå»æŸ¥çœ‹ç›¸å…³æ—¥å¿—å¸Œæœ›èƒ½æ‰¾åˆ°è››ä¸é©¬è¿¹ã€‚</p><p>åœ¨è¿™ä¸ªç¯èŠ‚ï¼Œå¦‚æœå…³é”®å­—ä¿¡æ¯æ¯”è¾ƒç‹¬ç‰¹ä¸”å”¯ä¸€ï¼Œæˆ‘ä»¬æ¯”è¾ƒå®¹æ˜“æ’æŸ¥å‡ºé—®é¢˜ï¼Œä½†å¦‚æœå…³é”®å­—ä¸é‚£ä¹ˆç‹¬ç‰¹ï¼Œæˆ‘ä»¬å¾ˆå¯èƒ½éœ€è¦ä»æ£€ç´¢å‡ºæ¥çš„ä¸€å †æ—¥å¿—ä¸­ç»§ç»­ç—›è‹¦åœ°åˆ†æã€‚</p><p>ç„¶è€Œç—›è‹¦æ‰åˆšåˆšå¼€å§‹ï¼Œå®é™…å¼€å‘ä¼šæ¶‰åŠå¾ˆå¤šç³»ç»Ÿï¼Œå¦‚æœå‡ºé—®é¢˜çš„åŠŸèƒ½è°ƒç”¨æµç¨‹éå¸¸å¤æ‚ï¼Œä½ å¯èƒ½éƒ½ä¸ç¡®å®šæ‰¾åˆ°çš„æ—¥å¿—æ˜¯ä¸æ˜¯å‡ºé—®é¢˜æ—¶çš„æ—¥å¿—ï¼Œä¹Ÿå¯èƒ½åªæ˜¯æ‰¾åˆ°äº†å‡ºé—®é¢˜æ—¶æ—¥å¿—ä½“ç³»ä¸­çš„å°éƒ¨åˆ†ï¼Œè¿˜å¯èƒ½æ‰¾åˆ°ä¸€å †ä¸é—®é¢˜æ¯«æ— å…³ç³»çš„æ—¥å¿—ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªå¤æ‚è°ƒç”¨å…³ç³»ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/33/47/33b9bcba4120a1e2cbd081f98ce69447.jpg?wh=1920x817\" alt=\"å›¾ç‰‡\"></p><p>å›¾ä¸­æè¿°äº†ä¸€ç§å¤šç³»ç»Ÿåˆä½œçš„é“¾è·¯ï¼Œä¸€ä¸ªè¯·æ±‚è°ƒç”¨äº†ç³»ç»ŸAï¼Œæ¥ç€ç³»ç»ŸAåˆ†åˆ«è°ƒç”¨äº†ç³»ç»ŸBå’Œç³»ç»ŸDï¼Œç„¶åç³»ç»ŸBè¿˜è°ƒç”¨äº†ç³»ç»ŸCã€‚</p><p>é€šè¿‡è¯·æ±‚ä¸­çš„å…³é”®å­—ï¼Œæˆ‘ä»¬åœ¨Aã€Bã€Cã€Dç³»ç»Ÿä¸­æ‰¾åˆ°äº†ç›¸å…³æ—¥å¿—ï¼š</p><pre><code class=\"language-java\">2022-10-28 23:29:01.302 [ç³»ç»ŸA,DubboServerHandler-1095] INFO com.XxxJob - [JOB] calling start [emp_airOrderNoticeJob]&nbsp;\n2022-10-28 23:29:02.523 [ç³»ç»ŸB,DubboServerHandler-1093] INFO WARN XxxImpl - queryUser å…¥å‚å‚æ•°ä¸º: xxxx&nbsp;\n2022-10-28 23:30:23.257 [ç³»ç»ŸC,DubboServerHandler-1096] INFO ABCImpl - recv Request...&nbsp;\n2022-10-28 23:30:25.679 [ç³»ç»ŸD,DubboServerHandler-1094] INFO XyzImpl - doQuery Start...&nbsp;\n2022-10-28 23:31:18.310 [ç³»ç»ŸB,DubboServerHandler-1093] INFO WARN XxxImpl - queryUser å…¥å‚å‚æ•°ä¸æ­£ç¡®\n</code></pre><!-- [[[read_end]]] --><p>è¯´æ˜ä¸€ä¸‹ï¼Œè¿™æ®µæ—¥å¿—ä¿¡æ¯æ˜¯æ–¹ä¾¿æˆ‘ä»¬å…·ä½“åˆ†æé—®é¢˜æ¨¡æ‹Ÿå‡ºæ¥çš„ï¼Œä½†æ—¥å¸¸ä½ çœ‹åˆ°çš„æ—¥å¿—æ ¼å¼ä¹Ÿæ˜¯å¤§åŒå°å¼‚ã€‚çœ‹ç³»ç»ŸBçš„ DubboServerHandler-1093 çº¿ç¨‹æ‰“å°çš„ä¸¤è¡Œæ—¥å¿—ï¼Œç¬¬ä¸€çœ¼ä»æ‰“å°å†…å®¹çš„ä¸Šä¸‹æ–‡å…³ç³»ä¸Šçœ‹ï¼Œæˆ‘ä»¬ä¼šè¯¯è®¤ä¸ºè¿™å°±æ˜¯è¦æ‰¾çš„é”™è¯¯ä¿¡æ¯ã€‚</p><p>ä½†å®é™…å¼€å‘ä¸­ä¸€å®šè¦è€ƒè™‘ä¸åŒè¯·æ±‚ã€ä¸åŒçº¿ç¨‹è¿™ä¸¤ä¸ªå› ç´ ï¼Œ<strong>ä½ èƒ½ç¡®å®šè¿™ä¸¤è¡Œæ—¥å¿—ä¸€å®šæ˜¯åŒä¸€æ¬¡è¯·æ±‚ã€åŒä¸€ä¸ªçº¿ç¨‹æ‰“å°å‡ºæ¥çš„ä¹ˆï¼Ÿ</strong></p><p>å…¶å®å¹¶ä¸èƒ½ï¼Œé‚£æœ‰ä»€ä¹ˆæ›´å¥½çš„åŠæ³•æ¥åŒºåˆ†å‡ºæ¥å‘¢ã€‚</p><h2>æ—¥å¿—æ£€ç´¢é—®é¢˜</h2><p>ç°åœ¨çš„ä¸»è¦é—®é¢˜å°±å˜æˆäº†ä¸€æ¬¡è¯·æ±‚è°ƒç”¨ç³»ç»ŸAã€Bã€Cã€Dï¼Œå¦‚ä½•ç²¾å‡†æ‰¾å‡ºä¸€æ¬¡è¯·æ±‚æ‰€æ‰“å°çš„å…¨éƒ¨æ—¥å¿—ï¼Ÿ</p><p>å…¶å®æ€è·¯ä¹Ÿå¾ˆç®€å•ï¼Œç±»ä¼¼ç”°å¾„400ç±³æ¥åŠ›èµ›è·‘ï¼Œä¸€ä¸ªè¯·æ±‚ï¼Œå¦‚æœæœ‰ä¸€ä¸ªåºåˆ—å·ï¼Œè€Œä¸”åºåˆ—å·è¿˜èƒ½è¢«â€œæ¥æ£’â€ä¼ åˆ°ç³»ç»ŸAã€Bã€Cã€Dï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªåºåˆ—å·ï¼Œå°†è¿™æ¬¡è¯·æ±‚çš„æ—¥å¿—å…¨éƒ¨æ£€ç´¢å‡ºæ¥ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f7/93/f73c30db757a51c0aaeff59b7cd81793.jpg?wh=1920x817\" alt=\"å›¾ç‰‡\"></p><p>ç»“åˆåˆšæ‰çš„ä¾‹å­ï¼Œç³»ç»ŸBçš„ DubboServerHandler-1093 çº¿ç¨‹æ‰“å°çš„ä¸¤è¡Œæ—¥å¿—ï¼Œå¦‚æœæœ‰ä¸€ä¸ªåºåˆ—å·çš„ä½“ç°ï¼Œæˆ‘ä»¬å°±èƒ½ç¡®å®šæ˜¯ä¸æ˜¯åŒä¸€æ¬¡è¯·æ±‚æ‰€æ‰“å°çš„ã€‚</p><p>å¯æ˜¯è¯¥æ€ä¹ˆæŠŠä¸€æ¬¡è¯·æ±‚åŠ¨æ€ç”Ÿæˆçš„åºåˆ—å·ï¼Œä¼ é€’åˆ°æ­¤æ¬¡è¯·æ±‚æ‰€æ¶‰åŠçš„æ‰€æœ‰ç³»ç»Ÿä¸­å»å‘¢ï¼Ÿ</p><h3>1. æ˜¾å¼ä¼ é€’</h3><p>æœ€æ˜¾è€Œæ˜“è§çš„æ–¹æ¡ˆå°±æ˜¯æ˜¾å¼ä¼ å‚ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ‰€æœ‰ç³»ç»Ÿæ¥æ”¶è¯·æ±‚çš„å¯¹è±¡ä¸­ï¼Œç»Ÿä¸€æ·»åŠ ä¸€ä¸ªåºåˆ—å·å­—æ®µï¼Œè®©å¤§å®¶éƒ½æŒ‰ç…§ä¸€å®šçš„è§„çº¦è¿›è¡Œç¼–ç ä¼ é€’ã€‚æ¥è‰æ‹Ÿä¸€ä¸ªæŠ½è±¡è¯·æ±‚åŸºç±»ï¼š</p><pre><code class=\"language-java\">@Setter\n@Getter\n@ToString\npublic class AbstractRequest implements Serializable {\n    \n    /** &lt;h2&gt;è¯·æ±‚æµæ°´å·ï¼Œæ‰“å°æ—¥å¿—ä½¿ç”¨ï¼Œè€Œä¸”è¿˜æ˜¯å¿…å¡«å­—æ®µ&lt;/h2&gt; **/\n    @NotBlank\n    private String reqNo;\n}\n</code></pre><p>åœ¨ä»£ç ä¸­å®šä¹‰ä¸€ä¸ª AbstractRequest æŠ½è±¡çš„è¯·æ±‚ç±»ï¼Œå†å®šä¹‰ä¸€ä¸ªè¯·æ±‚æµæ°´å·å­—æ®µï¼Œå¹¶ä¸”æ ‡æ˜æ˜¯å¿…å¡«å­—æ®µï¼Œè®©ç³»ç»Ÿæ‰€æœ‰æ¥æ”¶è¯·æ±‚çš„å¯¹è±¡éƒ½ç»§æ‰¿è¿™ä¸ª AbstractRequest æŠ½è±¡ç±»ã€‚<br>\nè¿™æ ·ä¸€æ¥ï¼Œå› ä¸ºç»§æ‰¿å…³ç³»ï¼Œæ¯ä¸ªæ¥æ”¶è¯·æ±‚çš„å¯¹è±¡éƒ½ç›¸å½“äºæœ‰äº† reqNo å­—æ®µï¼Œæœ€åå‘Šè¯‰è°ƒç”¨æ–¹æŒ‰ç…§è¦æ±‚ä¼ å‚å°±å¯ä»¥äº†ã€‚</p><p>æ€è·¯å¾ˆç¾å¥½ï¼Œä½†è¿™ä¸ªæ—¶å€™ç›¸ä¿¡ä½ ä¸€å®šå‘ç°äº†ç¬¬ä¸€ä¸ªç›²ç‚¹ï¼š<strong>è€ƒè™‘æ–¹æ¡ˆçš„è½åœ°ï¼Œå·²æœ‰å¯¹è±¡å¦‚ä½•ä¿®æ”¹å‘¢ï¼Ÿ</strong></p><p>æˆ‘ä»¬é¡ºç€è¿™ä¸ªæ€è·¯å…ˆæ¯”åˆ’æ¯”åˆ’æµç¨‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/34/f0/343af91420f4582ec87743739c64b9f0.jpg?wh=1920x580\" alt=\"å›¾ç‰‡\"></p><p>æŠŠç³»ç»Ÿä¸­æ‰€æœ‰æ¥æ”¶è¯·æ±‚çš„å¯¹è±¡æ‰¾å‡ºæ¥ï¼Œç„¶åæŒ¨ä¸ªä¿®æ”¹è¿™äº›å¯¹è±¡çš„ç»§æ‰¿å±æ€§ï¼Œæ”¹ä¸ºç»§æ‰¿ AbstractRequest ç±»ï¼Œæœ€ååœ¨æ‰“å°æ—¥å¿—çš„æ—¶å€™é¡ºä¾¿æŠŠ reqNo å­—æ®µå€¼æ‰“å°å‡ºæ¥ã€‚</p><p>ä½†æ˜¯éœ€è¦ä¿®æ”¹å¤šå°‘ä¸ªæ¥æ”¶è¯·æ±‚å¯¹è±¡çš„ç±»å‘¢ï¼Ÿç³»ç»Ÿä¸­æœ‰10ä¸ªå¯¹è±¡å°±è¦æ”¹10ä¸ªï¼Œæœ‰100ä¸ªå¯¹è±¡é‚£å°±æ”¹100ä¸ªï¼Œä½†ç³»ç»Ÿä¸­æœ‰10000ä¸ªå¯¹è±¡ï¼Œè¦æ”¹10000ä¸ªï¼Ÿä¸å¤ªå®é™…ï¼Œè€Œä¸”åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œç³»ç»Ÿä¸­æ¥æ”¶è¯·æ±‚å¯¹è±¡çš„ä¸ªæ•°æ˜¯ä¸å¯ä¼°é‡çš„ï¼Œæˆ‘ä»¬å…‰æ”¹ä¸ªç»§æ‰¿å…³ç³»ï¼Œå°±èƒ½æ”¹ä¸Šå‡ å¤©å‡ å¤œï¼Œè¿˜æ— æ³•ä¿è¯ä¸å‡ºé—®é¢˜ã€‚</p><p>å“ªæ€•å‡è®¾ä¿®æ”¹é‡ä¸å¤§ï¼Œæˆ‘ä»¬åœ¨æ‰“å°æ—¥å¿—çš„æ—¶å€™è¿˜ä¼šé‡åˆ°ç¬¬äºŒä¸ªæ›´éš¾å¤„ç†çš„é—®é¢˜ã€‚</p><p>æ‰“å°çš„ä¸€èˆ¬æ€è·¯æ˜¯åœ¨å¤„ç†ä¸šåŠ¡é€»è¾‘ä¹‹å‰ï¼Œå°†å…¥å‚ req å¯¹è±¡ä¸­çš„ reqNo å­—æ®µå€¼æ‰“å°å‡ºæ¥ï¼š</p><pre><code class=\"language-java\">@DubboService\n@Component\npublic class UserQueryFacadeImpl implements UserQueryFacade {\n    private Logger logger = LoggerFactory.getLogger(UserQueryFacadeImpl.class);\n    @Override\n    public QueryUserInfoUserResp queryUserInfo(QueryUserInfoReq req) {\n        logger.info(\"reqNo: {}, queryUser å…¥å‚å‚æ•°ä¸º: {}\", req.getReqNo(), req);\n        \n        // çœç•¥å…¶ä»–é€»è¾‘...\n    }\n}\n</code></pre><p>çœ‹èµ·æ¥ä¸é”™ï¼Œè‡³å°‘å¯ä»¥é€šè¿‡æµæ°´å·æ¥æ£€ç´¢å‡ºæ—¥å¿—äº†ã€‚ä½†é—®é¢˜æ˜¯æˆ‘ä»¬åªæœ‰åœ¨ queryUserInfo å½“å‰çš„æ–¹æ³•ä½“ä¸­æ‰èƒ½æ‹¿åˆ° req å¯¹è±¡ã€‚</p><p><strong>ä¸‡ä¸€å…¶ä»–æ¥å£çš„è¯·æ±‚å¯¹è±¡ä¸æ˜¯ QueryUserInfoReq è¿™ç§ç±»å‹ï¼Œè€Œæ˜¯ Stringã€Integer è¿™ç§ç±»å‹çš„è¯ï¼Œè¯¥æ€ä¹ˆç»§æ‰¿å‘¢ï¼Ÿ</strong>Stringã€Integer éƒ½æ˜¯ JDK ä¸­éå¸¸åŸºç¡€çš„ç±»ï¼Œæ ¹æœ¬æ— æ³•ä¿®æ”¹ï¼Œå³ä¾¿èƒ½ä¿®æ”¹ï¼Œæˆ‘ä»¬ä¹Ÿä¸æ•¢æ”¹ï¼Œæ¯•ç«Ÿè¿™äº›ç±»åœ¨ä»£ç ä¸­éåœ°éƒ½æ˜¯ï¼Œä¸€æ—¦ä¿®æ”¹å½±å“é¢æ ¹æœ¬æ— æ³•é¢„ä¼°ã€‚</p><p>è€Œä¸”ä¸ºäº†ç¡®ä¿åœ¨ä»£ç çš„ä»»ä½•ä¸€ä¸ªè§’è½éƒ½èƒ½æ‹¿åˆ° reqNo å­—æ®µå€¼ï¼Œå¦‚æœæƒ³åœ¨å­æ–¹æ³•ã€å­å­æ–¹æ³•ä¸­ç»§ç»­æ‰“å° reqNo å­—æ®µï¼Œè¿˜å¾—æŠŠ req å¯¹è±¡ä¼ ä¸‹å»ï¼Œæˆ‘ä»¬éƒ½èƒ½æƒ³åƒåˆ°å°†æ¥ä»£ç ä¸­éåœ°éƒ½æ˜¯å„ç§ req å¯¹è±¡ä¼ æ¥ä¼ å»æƒ¨ä¸å¿ç¹çš„ç”»é¢ï¼Œä»£ç çš„å¯è¯»æ€§éå¸¸ç³Ÿç³•ã€‚</p><p>å¦‚æœ queryUserInfo è¿˜éœ€è¦è°ƒç”¨ä¸‹æ¸¸ç³»ç»Ÿï¼Œè¿˜å¾—æƒ³åŠæ³•æŠŠ QueryUserInfoReq å¯¹è±¡ä¸­çš„ reqNo å­—æ®µå€¼å–å‡ºæ¥ï¼Œç„¶åèµ‹å€¼åˆ°ä¸‹æ¸¸çš„è¯·æ±‚å¯¹è±¡ä¸­ï¼Œè¿™åˆå¾—æŠŠæ‰€æœ‰æ¶‰åŠä¸‹æ¸¸ç³»ç»Ÿè¯·æ±‚å¯¹è±¡çš„ä»£ç åˆå…¨éƒ¨æ”¹ä¸€éã€‚</p><p>æ‰€ä»¥ï¼ŒæŒ‰æ˜¾å¼æ–¹å¼å¤„ç†åºåˆ—å·è¶Šæƒ³é—®é¢˜è¶Šå¤šï¼Œæˆ‘ä»¬ä¸ä½†å¾—ä¸€é¡¿å¤§æ”¹ï¼Œè¿˜ä¼šæŠŠæ•´ä¸ªå·¥ç¨‹ä»£ç æ•´å¾—é¸¡çŠ¬ä¸å®ï¼Œä¹ŒçƒŸç˜´æ°”ã€‚æ—¢ç„¶æ˜¾å¼ä¼ å‚ä¸è¡Œï¼Œæœ‰æ²¡æœ‰å…¶ä»–æ–¹æ¡ˆå‘¢ï¼Ÿ</p><h3>2.éšå¼ä¼ é€’</h3><p>ç°åœ¨çš„é—®é¢˜å°±è½¬å˜ä¸ºï¼Œæ—¢ä¸èƒ½æ”¹åŠ¨æ–¹æ³•çš„è¯·æ±‚å…¥å‚å¯¹è±¡ï¼Œä¹Ÿä¸èƒ½åœ¨å·¥ç¨‹ä¸­éåœ°å¼€èŠ±åœ°ä¿®æ”¹ä»£ç ï¼Œè¿˜è¦èƒ½åœ¨æ—¥å¿—ä¸­çœ‹åˆ°åºåˆ—å·ï¼Œä¼¼ä¹æœ‰ç‚¹å›°éš¾ã€‚</p><p>ä½†æ˜¯ä»”ç»†åˆ†æè¿™ä¸ªéœ€æ±‚ï¼Œä½ å°±èƒ½æ‰¾åˆ°çªç ´ç‚¹ã€‚è¯·æ±‚å…¥å‚å¯¹è±¡ï¼Œéƒ½æ˜¯ä¸€äº›å¤„ç†ä¸šåŠ¡åŠŸèƒ½éœ€è¦çš„å¯¹è±¡ï¼Œä½†æ˜¯è¿™ä¸ªåºåˆ—å·å‚æ•°ï¼Œä¸šåŠ¡å…¶å®å¹¶ä¸éœ€è¦ï¼Œå› ä¸ºä¸šåŠ¡ä¸å…³å¿ƒæ—¥å¿—æ€ä¹ˆæ‰“å°ï¼Œä¹Ÿä¸å…³å¿ƒå¼€å‘äººå‘˜æ€ä¹ˆæ’æŸ¥é—®é¢˜ã€‚</p><p>æ‰€ä»¥åºåˆ—å·å’Œä¸šåŠ¡å¯¹è±¡åœ¨ä¸€å®šç¨‹åº¦ä¸Šåˆ’åˆ†äº†ç•Œé™ï¼Œæˆ‘ä»¬å¯ä»¥<strong>æŠŠä¸šåŠ¡å¯¹è±¡åˆ’åˆ†åˆ°ä¸šåŠ¡å±æ€§ï¼ŒæŠŠè¯·æ±‚åºåˆ—å·åˆ’åˆ†åˆ°æŠ€æœ¯å±æ€§</strong>ã€‚ä»¥ä¸€æ¬¡ç®€å•çš„è¯·æ±‚å‘é€ä¸ºä¾‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/bb/28/bbc733e24580345846cfda3362c18528.jpg?wh=1920x580\" alt=\"å›¾ç‰‡\"></p><p>HTTPè¯·æ±‚åœ¨å‘ç³»ç»ŸAå‘èµ·è¯·æ±‚æ—¶ï¼Œéœ€è¦æƒ³åŠæ³•å°†æŠ€æœ¯å±æ€§å’Œä¸šåŠ¡å±æ€§éƒ½å‘é€ç»™ç³»ç»ŸAï¼Œæ€ä¹ˆç¼–å†™ä»£ç å‘é€HTTPè¯·æ±‚çš„å‘¢ï¼Ÿ</p><p>å›å¿†å¹³æ—¶å‘é€HTTPè¯·æ±‚çš„é€»è¾‘æ­¥éª¤ï¼š</p><ol>\n<li>å°†ä¸šåŠ¡å¯¹è±¡è®¾ç½®åˆ°HTTPçš„è¯·æ±‚ä½“ä¸­ï¼›</li>\n<li>å°†ä¸€äº›Content-Typeã€Content-Lengthå±æ€§ç­‰è®¾ç½®åˆ°è¯·æ±‚å¤´ä¸­ï¼›</li>\n<li>è®¾ç½®URLï¼Œå‘èµ·HTTPè¯·æ±‚ã€‚</li>\n</ol><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†ä¸šåŠ¡å±æ€§æ”¾åˆ°è¯·æ±‚ä½“ä¸­ï¼Œå°†æŠ€æœ¯å±æ€§æ”¾åˆ°è¯·æ±‚å¤´ä¸­ï¼Œè¿™æ ·ä¸å°±æŠŠæŠ€æœ¯å±æ€§å’Œä¸šåŠ¡å±æ€§ä¸€èµ·å‘é€å‡ºå»äº†ä¹ˆã€‚</p><p><strong>å¯æ˜¯ç³»ç»ŸAä¸ç³»ç»ŸBã€Cã€Dä¹‹é—´æ˜¯Dubboè°ƒç”¨çš„ï¼Œåˆè¯¥æ€ä¹ˆè§£å†³æŠ€æœ¯å±æ€§çš„ä¼ é€’é—®é¢˜å‘¢ï¼Ÿ</strong></p><p>åŒæ ·åœ°ï¼Œæˆ‘ä»¬å›å¿†å¹³æ—¶ç¼–å†™ä»£ç è¿›è¡ŒDubboè¿œç¨‹è°ƒç”¨æ—¶çš„æµç¨‹é“¾è·¯ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/22/05/22e6b83e56f00123cd7c5db848e3e005.jpg?wh=1920x823\" alt=\"å›¾ç‰‡\"></p><p>è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„æ¶ˆè´¹è€…è°ƒç”¨æä¾›è€…çš„é“¾è·¯å›¾ï¼Œåœ¨æ¶ˆè´¹è€…è°ƒç”¨çš„è¿‡ç¨‹ä¸­ï¼Œä¸€äº›é™„åŠ çš„ä¿¡æ¯å¯ä»¥è®¾ç½®åˆ°RpcContextä¸Šä¸‹æ–‡ä¸­å»ï¼Œç„¶åRpcContextä¸­çš„ä¿¡æ¯å°±ä¼šéšç€è¿œç¨‹è°ƒç”¨å»å¾€æä¾›è€…é‚£è¾¹ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè°ƒç”¨é“¾è·¯å›¾ä¸­çš„é™„å¸¦å‚æ•°è®¾ç½®å½¢å¼å’ŒHTTPçš„è¯·æ±‚å¤´è®¾ç½®å½¢å¼ï¼Œå‡ ä¹æ˜¯å¦‚å‡ºä¸€è¾™ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘å°†åºåˆ—å·è®¾ç½®åˆ°RpcContextä¸­ï¼Œè¿™æ ·å°±èƒ½æ—¢ä¸æ”¹åŠ¨æ–¹æ³•çš„è¯·æ±‚å…¥å‚å¯¹è±¡ï¼Œåˆä¸ç”¨å¤§èŒƒå›´è¿›è¡Œä¿®æ”¹äº†ã€‚</p><p>é‚£å¦‚ä½•æŠŠå‚æ•°è®¾ç½®åˆ°RpcContextä¸­å‘¢ï¼Ÿæˆ‘ä»¬è¿›å…¥ä»Šå¤©çš„é«˜æ½®ç¯èŠ‚â€”â€”éšå¼ä¼ å‚çš„å®ç°ã€‚</p><h2>ç¼–ç å®ç°</h2><p>å¯¹äºæŠ€æœ¯å±æ€§çš„è®¾ç½®ï¼Œç°åœ¨çš„ä½ è‚¯å®šçŸ¥é“æ˜¯ä¸èƒ½å¤§è‚†åœ¨ä»£ç å„ä¸ªè§’è½è¿›è¡Œæ“ä½œçš„ï¼Œä¹Ÿä¸ç°å®ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªé›†ä¸­çš„ç¯èŠ‚å¯ä»¥è¿›è¡Œæ“ä½œï¼Œé‚£ä¹ˆè¿™ä¸ªé›†ä¸­ç¯èŠ‚åœ¨å“ªé‡Œå‘¢ï¼Ÿ</p><p>å†æ¥çœ‹è°ƒç”¨é“¾è·¯å›¾ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/53/9b/53da04ab9bb2d105779ecb45c9d3d49b.jpg?wh=1920x823\" alt=\"å›¾ç‰‡\"></p><p>ä¸ºäº†å°½å¯èƒ½é™ä½ä¾µå…¥æ€§ï¼Œæˆ‘ä»¬æœ€å¥½èƒ½åœ¨ç³»ç»Ÿçš„å…¥å£å’Œå‡ºå£ï¼ŒæŠŠæ¥æ”¶æ•°æ®çš„æ“ä½œä»¥åŠå‘é€æ•°æ®çš„æ“ä½œè¿›è¡Œå®Œç¾è¡”æ¥ã€‚è¿™å°±æ„å‘³ç€éœ€è¦åœ¨æ¥æ”¶è¯·æ±‚çš„å†…éƒ¨ã€å‘é€è¯·æ±‚çš„å†…éƒ¨åšå¥½æ•°æ®çš„äº¤æ¢ã€‚</p><p>å†ç»“åˆå‰é¢çš„æ¶ˆè´¹è€…è°ƒç”¨æä¾›è€…çš„é“¾è·¯å›¾ï¼Œç¼–å†™ä¸šåŠ¡ä»£ç æ— æ„ŸçŸ¥çš„â€œè¿‡æ»¤å™¨â€ï¼Œä¼¼ä¹èƒ½å®Œç¾æ»¡è¶³éœ€æ±‚ï¼š</p><ul>\n<li>ç³»ç»ŸAæ¥æ”¶è¯·æ±‚ï¼Œç«™åœ¨æä¾›è€…çš„è§’åº¦ï¼Œåœ¨å¤„ç†æ¥å£å®ç°é€»è¾‘ä¹‹å‰ä¼šç»è¿‡æ»¤å™¨å¤„ç†ã€‚</li>\n<li>ç³»ç»ŸAå‘é€è¯·æ±‚ï¼Œç«™åœ¨æ¶ˆè´¹è€…çš„è§’åº¦ï¼Œä¸€æ ·ä¼šç»è¿‡æ»¤å™¨å¤„ç†ã€‚</li>\n</ul><p>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å®šä¹‰ä¸€ä¸ªæ¶ˆè´¹è€…ç»´åº¦çš„åºåˆ—å·è¿‡æ»¤å™¨ï¼Œç„¶åå†å®šä¹‰ä¸€ä¸ªæä¾›è€…ç»´åº¦çš„åºåˆ—å·è¿‡æ»¤å™¨ï¼Œå°±å¯ä»¥æŠŠåºåˆ—å·åœ¨è°ƒç”¨é“¾è·¯ä¸­å®Œç¾è¡”æ¥èµ·æ¥äº†ã€‚</p><p>æ¥çœ‹ä»£ç å®ç°ï¼š</p><pre><code class=\"language-java\">@Activate(group = PROVIDER, order = -9000)\npublic class ReqNoProviderFilter implements Filter {\n    public static final String TRACE_ID = \"TRACE-ID\";\n    @Override\n    public Result invoke(Invoker&lt;?&gt; invoker, Invocation invocation) throws RpcException {\n        // è·å–å…¥å‚çš„è·Ÿè¸ªåºåˆ—å·å€¼\n        Map&lt;String, Object&gt; attachments = invocation.getObjectAttachments();\n        String reqTraceId = attachments != null ? (String) attachments.get(TRACE_ID) : null;\n        \n        // è‹¥ reqTraceId ä¸ºç©ºåˆ™é‡æ–°ç”Ÿæˆä¸€ä¸ªåºåˆ—å·å€¼ï¼Œåºåˆ—å·åœ¨ä¸€æ®µç›¸å¯¹é•¿çš„æ—¶é—´å†…å”¯ä¸€è¶³å¤Ÿäº†\n        reqTraceId = reqTraceId == null ? generateTraceId() : reqTraceId;\n        \n        // å°†åºåˆ—å·å€¼è®¾ç½®åˆ°ä¸Šä¸‹æ–‡å¯¹è±¡ä¸­\n        RpcContext.getServerAttachment().setObjectAttachment(TRACE_ID, reqTraceId);\n        \n        // å¹¶ä¸”å°†åºåˆ—å·è®¾ç½®åˆ°æ—¥å¿—æ‰“å°å™¨ä¸­ï¼Œæ–¹ä¾¿åœ¨æ—¥å¿—ä¸­ä½“ç°å‡ºæ¥\n        MDC.put(TRACE_ID, reqTraceId);\n        \n        // ç»§ç»­åé¢è¿‡æ»¤å™¨çš„è°ƒç”¨\n        return invoker.invoke(invocation);\n    }\n}\n\n@Activate(group = CONSUMER, order = Integer.MIN_VALUE + 1000)\npublic class ReqNoConsumerFilter implements Filter, Filter.Listener {\n    public static final String TRACE_ID = \"TRACE-ID\";\n    @Override\n    public Result invoke(Invoker&lt;?&gt; invoker, Invocation invocation) throws RpcException {\n        // ä»ä¸Šä¸‹æ–‡å¯¹è±¡ä¸­å–å‡ºè·Ÿè¸ªåºåˆ—å·å€¼\n        String existsTraceId = RpcContext.getServerAttachment().getAttachment(TRACE_ID);\n        \n        // ç„¶åå°†åºåˆ—å·å€¼è®¾ç½®åˆ°è¯·æ±‚å¯¹è±¡ä¸­\n        invocation.getObjectAttachments().put(TRACE_ID, existsTraceId);\n        RpcContext.getClientAttachment().setObjectAttachment(TRACE_ID, existsTraceId);\n        \n        // ç»§ç»­åé¢è¿‡æ»¤å™¨çš„è°ƒç”¨\n        return invoker.invoke(invocation);\n    }\n}\n</code></pre><p>æ€è·¯ä¹Ÿå¾ˆæ¸…æ™°ï¼Œä¸»è¦æ–°å¢äº†ä¸¤ä¸ªè¿‡æ»¤å™¨ï¼š</p><ul>\n<li>ReqNoProviderFilter ä¸ºæä¾›è€…ç»´åº¦çš„è¿‡æ»¤å™¨ï¼Œä¸»è¦æ¥æ”¶è¯·æ±‚å‚æ•°ä¸­çš„ traceIdï¼Œå¹¶å°† traceId çš„å€¼æ”¾ç½®åˆ°RpcContextä¸Šä¸‹æ–‡å¯¹è±¡ä¸­ã€‚</li>\n<li>ReqNoConsumerFilter ä¸ºæ¶ˆè´¹è€…ç»´åº¦çš„è¿‡æ»¤å™¨ï¼Œä¸»è¦ä»RpcContextä¸Šä¸‹æ–‡å¯¹è±¡ä¸­å–å‡º traceId çš„å€¼ï¼Œå¹¶æ”¾ç½®åˆ° invocation è¯·æ±‚å¯¹è±¡ä¸­ã€‚</li>\n</ul><p>ç„¶åéµå¾ªDubboçš„SPIç‰¹æ€§å°†ä¸¤ä¸ªè¿‡æ»¤å™¨æ·»åŠ åˆ° META-INF/dubbo/org.apache.dubbo.rpc.Filter é…ç½®æ–‡ä»¶ä¸­ï¼š</p><pre><code class=\"language-markdown\">reqNoConsumerFilter=com.hmilyylimh.cloud.ReqNoConsumerFilter\nreqNoProviderFilter=com.hmilyylimh.cloud.ReqNoProviderFilter\n</code></pre><p>æœ€åä¿®æ”¹ä¸€ä¸‹æ—¥å¿—å™¨çš„æ‰“å°æ—¥å¿—æ¨¡å¼ï¼š</p><pre><code class=\"language-makefile\">%d{yyyy-MM-dd HH:mm:ss.SSS} [${APP_NAME}, %thread, %X{X-TraceId}] %-5level %c{1} -%msg%n\n</code></pre><p>ç»è¿‡æ”¹é€ åï¼Œæˆ‘ä»¬çœ‹åˆ°çš„æ—¥å¿—å°±ä¼šæ˜¯è¿™æ ·çš„ï¼š</p><pre><code class=\"language-java\">2022-10-29 14:29:01.302 [ç³»ç»ŸA,DubboServerHandler-1095,5a2e67913efee084] INFO com.XxxJob - [JOB] calling start [emp_airOrderNoticeJob]&nbsp;\n2022-10-29 14:29:02.523 [ç³»ç»ŸB,DubboServerHandler-1093,9b42e2bf4bc2808e] INFO WARN XxxImpl - queryUser å…¥å‚å‚æ•°ä¸º: xxxx&nbsp;\n2022-10-29 14:30:23.257 [ç³»ç»ŸC,DubboServerHandler-1096,6j40e2mn4bc4508e] INFO ABCImpl - recv Request...&nbsp;\n2022-10-29 14:30:25.679 [ç³»ç»ŸD,DubboServerHandler-1094,wx92bn9f4bc2m8z4] INFO XyzImpl - doQuery Start...&nbsp;\n2022-10-29 14:31:18.310 [ç³»ç»ŸB,DubboServerHandler-1093,9b42e2bf4bc2808e] INFO WARN XxxImpl - queryUser å…¥å‚å‚æ•°ä¸æ­£ç¡®\n</code></pre><p>çœ‹ç³»ç»ŸBçš„DubboServerHandler-1093çº¿ç¨‹æ‰“å°çš„ä¸¤è¡Œæ—¥å¿—ï¼Œ1093åé¢éƒ½æ˜¯ 9b42e2bf4bc2808e è¿™ä¸ªåºåˆ—å·å€¼ï¼Œè¯´æ˜è¿™ä¸€å®šæ˜¯åŒä¸€æ¬¡è¯·æ±‚ã€åŒä¸€ä¸ªçº¿ç¨‹æ‰“å°å‡ºæ¥çš„æ—¥å¿—ã€‚</p><p>æœ‰äº†è¿™æ ·çš„æ—¥å¿—æ£€ç´¢èƒ½åŠ›æ”¯æ’‘ï¼Œä¹‹å‰æ¯”è¾ƒéš¾æ’æŸ¥çš„é—®é¢˜ï¼ŒåŸºæœ¬ä¸Šæˆ‘ä»¬åªéœ€è¦ä¸¤æ­¥å°±èƒ½å¾ˆå¿«æå®šï¼š</p><ul>\n<li>ç¬¬ä¸€æ­¥ï¼Œé€šè¿‡ç”¨æˆ·æä¾›çš„å°‘è®¸å…³é”®å­—ï¼Œæ£€ç´¢å‡ºç¬¦åˆæ¡ä»¶çš„æ—¥å¿—ï¼Œä»è¿™äº›æ—¥å¿—ä¸­å¤§è‡´ç­›é€‰å‡ºç¬¦åˆç”¨æˆ·å‡ºé—®é¢˜çš„æ—¥å¿—ï¼Œç„¶åä»ä¸­éšæœºæ‹·è´ä¸€è¡Œæ—¥å¿—çš„è·Ÿè¸ªå·ã€‚</li>\n<li>ç¬¬äºŒæ­¥ï¼Œç”¨æ‹·è´çš„è·Ÿè¸ªå·ç»§ç»­æ£€ç´¢æ‰€æœ‰æ—¥å¿—ï¼Œå°±å¯ä»¥å°†è·Ÿè¸ªå·è¿™ä¸€æ¬¡è¯·æ±‚çš„æ‰€æœ‰æ—¥å¿—å…¨éƒ¨æ£€ç´¢å‡ºæ¥ï¼Œå†æ¥ç€é‡åˆ†æé—®é¢˜ã€‚</li>\n</ul><h2>éšå¼ä¼ é€’çš„åº”ç”¨</h2><p>æ˜¾å¼ä¼ é€’ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œä¸€èˆ¬æ˜¯åœ¨æ˜ç¡®ä¸šåŠ¡æ„ä¹‰çš„ä¸€ç§æ¥å£å¥‘çº¦å½¢å¼ï¼Œå¤§å®¶éƒ½æŒ‰ç…§æ¥å£å¥‘çº¦å„è‡ªè¡Œäº‹ã€‚é‚£ä»Šå¤©å­¦ä¹ çš„éšå¼ä¼ é€’ï¼Œåœ¨æˆ‘ä»¬çš„æ—¥å¸¸å¼€å‘ä¸­ï¼Œåˆæœ‰å“ªäº›åº”ç”¨åœºæ™¯å‘¢ï¼Ÿ</p><p>ç¬¬ä¸€ï¼Œä¼ é€’è¯·æ±‚æµæ°´å·ï¼Œåˆ†å¸ƒå¼åº”ç”¨ä¸­é€šè¿‡é“¾è·¯è¿½è¸ªå·æ¥å…¨å±€æ£€ç´¢æ—¥å¿—ã€‚</p><p>ç¬¬äºŒï¼Œä¼ é€’ç”¨æˆ·ä¿¡æ¯ï¼Œä»¥ä¾¿ä¸åŒç³»ç»Ÿåœ¨å¤„ç†ä¸šåŠ¡é€»è¾‘æ—¶å¯ä»¥è·å–ç”¨æˆ·å±‚é¢çš„ä¸€äº›ä¿¡æ¯ã€‚</p><p>ç¬¬ä¸‰ï¼Œä¼ é€’å‡­è¯ä¿¡æ¯ï¼Œä»¥ä¾¿ä¸åŒç³»ç»Ÿå¯ä»¥æœ‰é€‰æ‹©æ€§åœ°å–å‡ºä¸€äº›æ•°æ®åšä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚Cookieã€Tokenç­‰ã€‚</p><p>æ€»ä½“æ¥è¯´ä¼ é€’çš„éƒ½æ˜¯ä¸€äº›æŠ€æœ¯å±æ€§æ•°æ®ï¼Œå’Œä¸šåŠ¡å±æ€§æ²¡æœ‰å¤ªå¤§å…³è”ï¼Œä¸ºäº†æ–¹ä¾¿å¼€å‘äººå‘˜æ›´ä¸ºçµæ´»åœ°æ‰©å±•ç³»ç»Ÿèƒ½åŠ›ï¼Œæ¥æ›´å¥½åœ°æ”¯æ’‘ä¸šåŠ¡çš„å‘å±•ã€‚</p><h2>æ€»ç»“</h2><p>ä»Šå¤©ï¼Œæˆ‘ä»¬ä»ä¸€ä¸ªæ£€ç´¢æ—¥å¿—å›°éš¾çš„é—®é¢˜å¼€å§‹ï¼Œåˆ†æäº†æ˜¾å¼ä¼ é€’å’Œéšå¼ä¼ é€’ä¸¤ç§ä¸åŒæ–¹æ¡ˆå¸¦æ¥çš„é—®é¢˜å’Œå½±å“ã€‚</p><p>æ˜¾å¼ä¼ é€’ï¼Œä¼šå¯¼è‡´æ‰€æœ‰è¯·æ±‚å¯¹è±¡å¤§æ”¹é€ ã€è¯·æ±‚å¯¹è±¡ä¸ºStringç±»å‹çš„å±€é™æ€§ã€è°ƒç”¨ä¸‹æ¸¸ç³»ç»Ÿè®¾ç½®å…¥å‚é€»è¾‘å¤§æ”¹é€ ç­‰ï¼Œæ‰€ä»¥æˆ‘ä»¬è€ƒè™‘é€šè¿‡éšå¼ä¼ é€’æ¥å¤„ç†ã€‚</p><p>ç±»æ¯”HTTPåè®®çš„è®¾è®¡ç†å¿µï¼Œæˆ‘ä»¬å‘ç°æŠ€æœ¯å±æ€§ä¸ä¸šåŠ¡å±æ€§çš„åŒºåˆ«ï¼Œå†ç»“åˆDubboè°ƒç”¨çš„æµç¨‹å›¾ï¼Œåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å°†æŠ€æœ¯å±æ€§è®¾ç½®åˆ°RpcContextä¸­è¿›è¡Œç³»ç»Ÿé—´ä¼ é€’ï¼Œè¿™æ ·æ—¢ä¸éœ€è¦å¤§æ”¹ä»£ç ï¼Œä¹Ÿä¸éœ€è¦å’Œä¸šåŠ¡å±æ€§æ··åœ¨ä¸€èµ·ï¼Œæœ€ç»ˆé€šè¿‡è‡ªå®šä¹‰ä¸¤ä¸ªè¿‡æ»¤å™¨ä»ä»£ç å±‚é¢è½å®æ–¹æ¡ˆã€‚</p><p>è¿™é‡Œä¹Ÿæ€»ç»“ä¸€ä¸‹è‡ªå®šä¹‰è¿‡æ»¤å™¨çš„å››ä¸ªæ­¥éª¤ï¼š</p><ul>\n<li>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ç±»ï¼Œå¹¶å®ç° org.apache.dubbo.rpc.Filter æ¥å£ï¼›</li>\n<li>å…¶æ¬¡ï¼Œåœ¨è‡ªå®šä¹‰ç±»ä¸Šé€šè¿‡ @Activate æ³¨è§£æ ‡è¯†æ˜¯æä¾›æ–¹ç»´åº¦çš„è¿‡æ»¤å™¨ï¼Œè¿˜æ˜¯æ¶ˆè´¹æ–¹ç»´åº¦çš„è¿‡æ»¤å™¨ï¼›</li>\n<li>ç„¶åï¼Œåœ¨è‡ªå®šä¹‰ç±»ä¸­çš„ invoke æ–¹æ³•ä¸­å®ç°ä¼ é€’é€»è¾‘ï¼Œæä¾›æ–¹è¿‡æ»¤å™¨ä» invocation å–å‡º traceId å¹¶è®¾ç½®åˆ° ClientAttachmentã€MDC ä¸­ï¼Œæ¶ˆè´¹æ–¹è¿‡æ»¤å™¨ä» ClientAttachment å–å‡º traceId å¹¶è®¾ç½®åˆ° invocation ä¸­ï¼›</li>\n<li>æœ€åï¼Œå°†è‡ªå®šä¹‰çš„ç±»è·¯å¾„æ·»åŠ åˆ° META-INF/dubbo/org.apache.dubbo.rpc.Filter æ–‡ä»¶ä¸­ï¼Œå¹¶å–ä¸ªåˆ«åã€‚</li>\n</ul><p>éšå¼ä¼ é€’çš„åº”ç”¨åœºæ™¯ä¸»è¦æœ‰3ç±»ï¼Œä¼ é€’é“¾è·¯è¿½è¸ªå·ã€ä¼ é€’ç”¨æˆ·ä¿¡æ¯ã€ä¼ é€’å‡­è¯ä¿¡æ¯ã€‚</p><h3>æ€è€ƒé¢˜</h3><p>ä½ å·²ç»å­¦ä¼šäº†ä½¿ç”¨RpcContextè®¾ç½®æŠ€æœ¯å±æ€§å¹¶ä¼ é€’åˆ°ä¸åŒçš„ç³»ç»Ÿä¸­å»ï¼Œè€Œ RpcContext è¿™ä¸ªç±»ä¹Ÿç¡®å®åœ¨å®é™…å¼€å‘ä¸­å¾ˆå¸¸ç”¨ã€‚æºç ä¸­æ˜¯è¿™ä¹ˆæè¿°å®ƒçš„ï¼š</p><pre><code class=\"language-markdown\">RpcContext is a temporary state holder. States in RpcContext changes every time when request is sent or received.\n</code></pre><p>ç”±æ­¤å¯è§ï¼ŒRpcContextæ˜¯ä¸´æ—¶çŠ¶æ€çš„ä¿æŒå™¨ï¼Œæ¯æ¬¡å‘é€æˆ–æ¥æ”¶è¯·æ±‚æ—¶ï¼ŒRpcContextä¸­çš„çŠ¶æ€éƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚<br>\nRpcContextæœ‰4ä¸ªé‡è¦å±æ€§å’Œä½ è®¾ç½®éšå¼çš„æŠ€æœ¯å±æ€§æœ‰å…³ï¼Œåˆ†åˆ«æ˜¯ SERVER_LOCALã€CLIENT_ATTACHMENTã€SERVER_ATTACHMENTã€SERVICE_CONTEXTï¼Œä½ çŸ¥é“å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸå—ï¼Ÿ</p><p>æœŸå¾…çœ‹åˆ°ä½ çš„æ€è€ƒï¼Œå¦‚æœä½ å¯¹éšå¼ä¼ é€’è¿˜æœ‰ä»€ä¹ˆå›°æƒ‘ï¼Œæ¬¢è¿åœ¨ç•™è¨€åŒºæé—®ï¼Œæˆ‘ä¼šç¬¬ä¸€æ—¶é—´å›å¤ã€‚</p><p>å¦‚æœè§‰å¾—ä»Šå¤©çš„å†…å®¹å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä¹Ÿæ¬¢è¿åˆ†äº«ç»™èº«è¾¹çš„æœ‹å‹ä¸€èµ·è®¨è®ºã€‚æˆ‘ä»¬ä¸‹ä¸€è®²è§ã€‚</p><h3>02æ€è€ƒé¢˜å‚è€ƒ</h3><p>ä¸Šä¸€æœŸçš„é—®é¢˜æ˜¯åˆ©ç”¨ CompletableFuture ä¸­çš„ä¸€äº› API ï¼Œå°†å¤æ‚çš„å¤šä»»åŠ¡åœºæ™¯é€šè¿‡ç¼–å†™ä»£ç è®¡ç®—å‡ºç´¯åŠ å’Œã€‚è§£ç­”æ­¤é¢˜æˆ‘ä»¬å…³æ³¨3ç‚¹ï¼š</p><ol>\n<li>ä»»åŠ¡æ‰§è¡Œå®Œæˆåå†å¹¶å‘æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ thenXxxAsync è¿™æ ·çš„æ–¹æ³•ï¼Œå¹¶ä¸”æ‰§è¡Œå®Œæˆä¹‹åè¿˜å¾—è¿”å›ç»“æœå€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é‡‡ç”¨ thenApplyAsync æ–¹æ³•ã€‚</li>\n<li>åˆå¹¶ä¸¤ä¸ªçº¿ç¨‹ä»»åŠ¡çš„ç»“æœï¼Œå¹¶åšè¿›ä¸€æ­¥ç´¯åŠ å’Œå¤„ç†ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ thenCombine æ–¹æ³•ã€‚</li>\n<li>ä¸¤ä¸ªçº¿ç¨‹ä»»åŠ¡å¹¶å‘æ‰§è¡Œï¼Œè°å…ˆæ‰§è¡Œå®Œæˆå°±ä»¥è°ä¸ºå‡†ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ applyToEither æ–¹æ³•ã€‚</li>\n</ol><p>æœ€ç»ˆå®ç°çš„ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-java\">public static void main(String[] args) throws Throwable {\n    ///////////////////////////////////////////////////\n    // ä»»åŠ¡ä¸€æ‰§è¡Œæµç¨‹\n    ///////////////////////////////////////////////////\n    // æ‰§è¡Œ taskA1\n    CompletableFuture&lt;Integer&gt; taskA1 = CompletableFuture.supplyAsync(() -&gt; 1);\n    // taskA1 æ‰§è¡Œå®Œåï¼Œå†å¹¶å‘æ‰§è¡Œ taskB1ã€taskC1\n    CompletableFuture&lt;Integer&gt; taskB1 = taskA1.thenApplyAsync(integer -&gt; 2);\n    CompletableFuture&lt;Integer&gt; taskC1 = taskA1.thenApplyAsync(integer -&gt; 3);\n    // ä»»åŠ¡ä¸€çš„ç»“æœ\n    CompletableFuture&lt;Integer&gt; result1 =\n            // ç­‰åˆ° taskB2ã€taskC2 éƒ½æ‰§è¡Œå®Œå¹¶åˆå¹¶ç»“æœå\n            taskB1.thenCombine(taskC1, Integer::sum)\n            // å†åˆå¹¶ taskA1 çš„ç»“æœå\n            .thenCombine(taskA1, Integer::sum)\n            // å†å¼‚æ­¥æ‰§è¡Œ taskD1\n            .thenApplyAsync(integer -&gt; integer + 4);\n            \n    ///////////////////////////////////////////////////\n    // ä»»åŠ¡äºŒæ‰§è¡Œæµç¨‹\n    ///////////////////////////////////////////////////\n    // æ‰§è¡Œ taskA2\n    CompletableFuture&lt;Integer&gt; taskA2 = CompletableFuture.supplyAsync(() -&gt; 1);\n    // taskA2 æ‰§è¡Œå®Œåï¼Œå†å¹¶å‘æ‰§è¡Œ taskB2ã€taskC2\n    CompletableFuture&lt;Integer&gt; taskB2 = taskA2.thenApplyAsync(integer -&gt; 2);\n    CompletableFuture&lt;Integer&gt; taskC2 = taskA2.thenApplyAsync(integer -&gt; 3);\n    // ä»»åŠ¡äºŒçš„ç»“æœ\n    CompletableFuture&lt;Integer&gt; result2 =\n            // ç­‰åˆ° taskB2ã€taskC2 ä»»æ„å…¶ä¸­ä¸€ä¸ªæœ‰ç»“æœå\n            taskB2.applyToEither(taskC2, Function.identity())\n            // å†åˆå¹¶ taskA2 çš„ç»“æœå\n            .thenCombine(taskA2, Integer::sum)\n            // å†å¼‚æ­¥æ‰§è¡Œ taskD2\n            .thenApplyAsync(integer -&gt; integer + 4);\n            \n    ///////////////////////////////////////////////////\n    // ä»»åŠ¡ä¸€ + ä»»åŠ¡äºŒï¼Œåˆå¹¶ç»“æœ\n    ///////////////////////////////////////////////////\n    CompletableFuture&lt;Integer&gt; result = result1.thenCombine(result2, Integer::sum);\n    try {\n        // ä»»åŠ¡æ€»è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º5s\n        System.out.println(result.get(5, TimeUnit.SECONDS));\n    } catch (InterruptedException | ExecutionException | TimeoutException e) {\n        // è¶…æ—¶åˆ™æ‰“å°0\n        System.out.println(0);\n        e.printStackTrace();\n    }\n}\n</code></pre><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±ç”¨ä»£ç å°†å›¾ä¸­çš„å¤šä»»åŠ¡åœºæ™¯å®ç°å®Œäº†ï¼Œæœ€ç»ˆæ‰“å°çš„ç»“æœä¸º 17 æˆ–è€… 18ï¼Œç»“æœä¸º 0 çš„æ¦‚ç‡éå¸¸éå¸¸ä½ã€‚</p>","neighbors":{"left":{"article_title":"02ï½œå¼‚æ­¥åŒ–å®è·µï¼šè«åå…¶å¦™å‡ºç°çº¿ç¨‹æ± è€—å°½æ€ä¹ˆåŠï¼Ÿ","id":611392},"right":{"article_title":"04ï½œæ³›åŒ–è°ƒç”¨ï¼šä¸‰æ­¥æ•™ä½ æ­å»ºé€šç”¨çš„æ³›åŒ–è°ƒç”¨æ¡†æ¶","id":613308}},"comments":[{"had_liked":false,"id":365104,"user_name":"å°ç™½","can_delete":false,"product_type":"c1","uid":1202143,"ip_address":"å¹¿ä¸œ","ucode":"717B408EDC07FD","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Z8t0JKFjnmdx4s4wuRePZXRL2L9awEpicp0rjT9rfXmZKOBIleZuOC86OzZE0tSdkfy3LWWa7YU67MicWeiaFd3jA/132","comment_is_top":false,"comment_ctime":1672111443,"is_pvip":false,"replies":[{"id":132952,"content":"ä½ å¥½ï¼Œå°ç™½ï¼šorg.apache.dubbo.rpc.RpcContext#get()ã€org.apache.dubbo.rpc.RpcContext#setã€org.apache.dubbo.rpc.RpcContext#removeã€org.apache.dubbo.rpc.RpcContext#get(java.lang.String) ç­‰ç­‰ API å·²ç»åœ¨ RpcContext ä¸­è¢«æ ‡æ³¨ @Deprecated æ³¨è§£ï¼Œè¯´æ˜åœ¨æ–°ç‰ˆæœ¬æ˜¯ä¸å†å»ºè®®ä½¿ç”¨äº†ã€‚\n\nè€Œæ˜¯ä½¿ç”¨æ›´åŠ æ˜ç¡®çš„è·å–æ–¹å¼ï¼ˆinvocation.getObjectAttachments()ã€RpcContext.getClientAttachment()ï¼‰ï¼Œä» invocation ä¸­è·å–æ•°æ®æ˜¯æ˜ç¡®è¡¨ç¤ºè¯¥æ•°æ®ä¸€å®šæ˜¯ä»æ¥æ”¶çš„å‚æ•°ä¸­è·å–çš„ï¼Œè¿™æ˜¯ä¸€ç§è§åçŸ¥æ„çš„å†™ä»£ç è¡¨è¿°æ–¹å¼è€Œå·²ã€‚\n\nä½†æ˜¯è¿™é‡Œä½ è¿˜è¦ç»“åˆ ContextFilterã€ConsumerContextFilter æ¥çœ‹ï¼Œä½ è¦æŠŠæ•°æ®æ”¾å¯¹å°±è¡Œäº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1364525,"ctime":1672187788,"ip_address":"å¹¿ä¸œ","comment_id":365104,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312101,"comment_content":"è€å¸ˆï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨RpcContextè¿›è¡Œget å’Œ set ä¼ é€’å‘¢ï¼Ÿä¸ºä»€ä¹ˆè¿˜è¦æ¶‰åŠåˆ°invocationï¼Œè¿™å—ä¸æ˜¯å¾ˆç†è§£ã€‚","like_count":3,"discussions":[{"author":{"id":1364525,"avatar":"https://static001.geekbang.org/account/avatar/00/14/d2/2d/d303cfe0.jpg","nickname":"HMILYYLIMH","note":"","ucode":"9355AB4A1A1B97","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597694,"discussion_content":"ä½ å¥½ï¼Œå°ç™½ï¼šorg.apache.dubbo.rpc.RpcContext#get()ã€org.apache.dubbo.rpc.RpcContext#setã€org.apache.dubbo.rpc.RpcContext#removeã€org.apache.dubbo.rpc.RpcContext#get(java.lang.String) ç­‰ç­‰ API å·²ç»åœ¨ RpcContext ä¸­è¢«æ ‡æ³¨ @Deprecated æ³¨è§£ï¼Œè¯´æ˜åœ¨æ–°ç‰ˆæœ¬æ˜¯ä¸å†å»ºè®®ä½¿ç”¨äº†ã€‚\n\nè€Œæ˜¯ä½¿ç”¨æ›´åŠ æ˜ç¡®çš„è·å–æ–¹å¼ï¼ˆinvocation.getObjectAttachments()ã€RpcContext.getClientAttachment()ï¼‰ï¼Œä» invocation ä¸­è·å–æ•°æ®æ˜¯æ˜ç¡®è¡¨ç¤ºè¯¥æ•°æ®ä¸€å®šæ˜¯ä»æ¥æ”¶çš„å‚æ•°ä¸­è·å–çš„ï¼Œè¿™æ˜¯ä¸€ç§è§åçŸ¥æ„çš„å†™ä»£ç è¡¨è¿°æ–¹å¼è€Œå·²ã€‚\n\nä½†æ˜¯è¿™é‡Œä½ è¿˜è¦ç»“åˆ ContextFilterã€ConsumerContextFilter æ¥çœ‹ï¼Œä½ è¦æŠŠæ•°æ®æ”¾å¯¹å°±è¡Œäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672187789,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":365508,"user_name":"å¼ ä¸‰ä¸°","can_delete":false,"product_type":"c1","uid":1155275,"ip_address":"å¹¿ä¸œ","ucode":"3A6215A40B3B21","user_header":"https://static001.geekbang.org/account/avatar/00/11/a0/cb/aab3b3e7.jpg","comment_is_top":false,"comment_ctime":1672714232,"is_pvip":false,"replies":[{"id":133140,"content":"ä½ å¥½ï¼Œå¼ ä¸‰ä¸°ï¼šä½ ç«™åœ¨çš„è§’åº¦æ˜¯æ¶ˆè´¹è€…åº”ç”¨ä¸€å®šæ˜¯è¯·æ±‚çš„æºå¤´ï¼Œæ‰€ä»¥ä½ ä¼šè¿™ä¹ˆç†è§£ã€‚è‹¥æ¶ˆè´¹æ–¹æ˜¯å‰ç«¯å‘¢ï¼Ÿéš¾é“éœ€è¦å‰ç«¯æ¥ç”ŸæˆtraceIdä¹ˆï¼Ÿ\n\nåªæ˜¯ç«™åœ¨çœ‹é—®é¢˜çš„è§’åº¦ä¸åŒç½¢äº†ï¼Œä¸è¿‡ä¹ŸæŒºå¥½çš„ï¼Œè¯´æ˜è‡³å°‘æ˜¯è®¤çœŸåœ¨æ€è€ƒè¿™ä¸ªtraceIdä¼ é€’è¡”æ¥çš„é—®é¢˜ï¼ŒæŒºæ£’çš„ã€‚\n\næˆ‘è¿™é‡Œå¼•ç”¨æˆ‘ä¹‹å‰å›ç­”è¿‡çš„å†…å®¹ï¼Œå¦‚ä¸‹ï¼š\n\nè¯´æ¶ˆè´¹æ–¹è¿˜æœ‰ç‚¹ä¸å¤ªå‡†ç¡®ï¼Œç²¾å‡†ç‚¹è¯´ï¼Œåº”è¯¥æ˜¯ä»æ¥æ”¶è¯·æ±‚çš„é‚£ä¸ªæºå¤´å°±å¯ä»¥è€ƒè™‘ç”ŸæˆtraceIdã€‚\n\næ¯”å¦‚æ¥æ”¶å‰ç«¯è¯·æ±‚ï¼ŒWebå®¹å™¨æ¯”å¦‚Tomcatçš„Filteræ˜¯æœ€èƒ½ç¬¬ä¸€æ—¶é—´æ„ŸçŸ¥è¯·æ±‚çš„å­˜åœ¨ï¼Œå¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œæ‹¦æˆªç›´æ¥ç”ŸæˆTraceIdï¼Œè‡³äºTomcatåœ¨Filterä¹‹åçš„ä¸€äº›å¤„ç†ç¯èŠ‚ï¼Œå°±å¯ä»¥ç›´æ¥æ‹¿åˆ°TraceIdäº†ã€‚å†è¿›å…¥Controllerè°ƒç”¨ä¸‹æ¸¸Dubboæ¥å£çš„è¯ï¼Œæ¶ˆè´¹æ–¹å‘ç°ä¸Šä¸‹æ–‡æ²¡æœ‰ traceId çš„ä¹Ÿæ˜¯å¯ä»¥è€ƒè™‘ç”Ÿæˆï¼Œä¹Ÿæ˜¯ä¸€ç§å…¼å®¹è€ƒè™‘æ–¹æ³•ï¼ŒæŒºå¥½çš„ã€‚\n\næ¯”å¦‚ A -&gt;B -&gt; Cï¼ŒæŠ›å¼€Webå®¹å™¨æ¥çœ‹å¾…çš„è¯ï¼ŒA çš„æ¶ˆè´¹æ–¹è¿‡æ»¤å™¨å…¶å®æ‹¿åˆ°çš„ traceId æ˜¯ null å€¼ï¼Œä½†æ˜¯ B æ‰€èƒ½å¾ˆå¥½è¡”æ¥ traceId çš„è¯ï¼Œé‚£ä¹ˆ B åœ¨å‘èµ·è°ƒç”¨ C çš„æ—¶å€™ï¼ŒB çš„æ¶ˆè´¹æ–¹è¿‡æ»¤å™¨æ˜¯èƒ½æ­£å¸¸æ‹¿åˆ° traceId çš„ã€‚\n","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1364525,"ctime":1672720622,"ip_address":"å¹¿ä¸œ","comment_id":365508,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100312101,"comment_content":"æ„Ÿè§‰æ–‡ä¸­è·å–traceidçš„åœ°æ–¹æœ‰é—®é¢˜ï¼Œä¸åº”è¯¥åœ¨æä¾›è€…å¤„ç”Ÿæˆï¼Œåº”è¯¥åœ¨æ¶ˆè´¹ç«¯ç”Ÿæˆæ˜¯traceidï¼Œå†æŠŠtraceidä¼ ç»™æä¾›è€…ï¼Œå¦‚æœæä¾›è€…æ‹¿åˆ°äº†traceidå°±æ‰“å°å‡ºæ¥ï¼Œå¦‚æœæ‹¿ä¸åˆ°å†ç”Ÿæˆtraceidè¿”å›ç»™æ¶ˆè´¹è€…","like_count":2,"discussions":[{"author":{"id":1364525,"avatar":"https://static001.geekbang.org/account/avatar/00/14/d2/2d/d303cfe0.jpg","nickname":"HMILYYLIMH","note":"","ucode":"9355AB4A1A1B97","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":598263,"discussion_content":"ä½ å¥½ï¼Œå¼ ä¸‰ä¸°ï¼šä½ ç«™åœ¨çš„è§’åº¦æ˜¯æ¶ˆè´¹è€…åº”ç”¨ä¸€å®šæ˜¯è¯·æ±‚çš„æºå¤´ï¼Œæ‰€ä»¥ä½ ä¼šè¿™ä¹ˆç†è§£ã€‚è‹¥æ¶ˆè´¹æ–¹æ˜¯å‰ç«¯å‘¢ï¼Ÿéš¾é“éœ€è¦å‰ç«¯æ¥ç”ŸæˆtraceIdä¹ˆï¼Ÿ\n\nåªæ˜¯ç«™åœ¨çœ‹é—®é¢˜çš„è§’åº¦ä¸åŒç½¢äº†ï¼Œä¸è¿‡ä¹ŸæŒºå¥½çš„ï¼Œè¯´æ˜è‡³å°‘æ˜¯è®¤çœŸåœ¨æ€è€ƒè¿™ä¸ªtraceIdä¼ é€’è¡”æ¥çš„é—®é¢˜ï¼ŒæŒºæ£’çš„ã€‚\n\næˆ‘è¿™é‡Œå¼•ç”¨æˆ‘ä¹‹å‰å›ç­”è¿‡çš„å†…å®¹ï¼Œå¦‚ä¸‹ï¼š\n\nè¯´æ¶ˆè´¹æ–¹è¿˜æœ‰ç‚¹ä¸å¤ªå‡†ç¡®ï¼Œç²¾å‡†ç‚¹è¯´ï¼Œåº”è¯¥æ˜¯ä»æ¥æ”¶è¯·æ±‚çš„é‚£ä¸ªæºå¤´å°±å¯ä»¥è€ƒè™‘ç”ŸæˆtraceIdã€‚\n\næ¯”å¦‚æ¥æ”¶å‰ç«¯è¯·æ±‚ï¼ŒWebå®¹å™¨æ¯”å¦‚Tomcatçš„Filteræ˜¯æœ€èƒ½ç¬¬ä¸€æ—¶é—´æ„ŸçŸ¥è¯·æ±‚çš„å­˜åœ¨ï¼Œå¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œæ‹¦æˆªç›´æ¥ç”ŸæˆTraceIdï¼Œè‡³äºTomcatåœ¨Filterä¹‹åçš„ä¸€äº›å¤„ç†ç¯èŠ‚ï¼Œå°±å¯ä»¥ç›´æ¥æ‹¿åˆ°TraceIdäº†ã€‚å†è¿›å…¥Controllerè°ƒç”¨ä¸‹æ¸¸Dubboæ¥å£çš„è¯ï¼Œæ¶ˆè´¹æ–¹å‘ç°ä¸Šä¸‹æ–‡æ²¡æœ‰ traceId çš„ä¹Ÿæ˜¯å¯ä»¥è€ƒè™‘ç”Ÿæˆï¼Œä¹Ÿæ˜¯ä¸€ç§å…¼å®¹è€ƒè™‘æ–¹æ³•ï¼ŒæŒºå¥½çš„ã€‚\n\næ¯”å¦‚ A -&gt;B -&gt; Cï¼ŒæŠ›å¼€Webå®¹å™¨æ¥çœ‹å¾…çš„è¯ï¼ŒA çš„æ¶ˆè´¹æ–¹è¿‡æ»¤å™¨å…¶å®æ‹¿åˆ°çš„ traceId æ˜¯ null å€¼ï¼Œä½†æ˜¯ B æ‰€èƒ½å¾ˆå¥½è¡”æ¥ traceId çš„è¯ï¼Œé‚£ä¹ˆ B åœ¨å‘èµ·è°ƒç”¨ C çš„æ—¶å€™ï¼ŒB çš„æ¶ˆè´¹æ–¹è¿‡æ»¤å™¨æ˜¯èƒ½æ­£å¸¸æ‹¿åˆ° traceId çš„ã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672720623,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1701455,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM6BVsSS2KsmwrcCKv3xyb6icrhbodyfNhXL5Q5AziaROdBDickkibSyWjL1WSq5dLliaHicIHVS3oiaLhHqg/132","nickname":"jdom","note":"","ucode":"058F92792875CD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600986,"discussion_content":"æœåŠ¡æä¾›æ–¹ç”ŸæˆtraceIdä¼šå¥½äº›å§ï¼Œä¸ç„¶å®šæ—¶å¹³å°è°ƒç”¨æ—¶ä¼šæ²¡æœ‰traceIdã€‚å¦å¤–controllerå±‚ï¼ˆæœ€å¼€å§‹çš„æ¶ˆè´¹æ–¹ï¼‰ä¸€èˆ¬æ¥è¯´å‡ ä¹æ²¡æœ‰é€»è¾‘ä»£ç ï¼ŒåŸºæœ¬å°±æ˜¯è°ƒç”¨dubboæ¥å£ï¼Œå°±ç®—æŠ¥é”™ä¹Ÿä¸æ€ä¹ˆéœ€è¦traceIdæ¥æ’æŸ¥é—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1674981840,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1104601,"avatar":"https://static001.geekbang.org/account/avatar/00/10/da/d9/f051962f.jpg","nickname":"æµ©ä»”æ˜¯ç¨‹åºå‘˜","note":"","ucode":"A7E5CF9E1571A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":598324,"discussion_content":"è€å¸ˆï¼Œæˆ‘è§‰å¾—ç”±å‰ç«¯ç”Ÿæˆè¿™ä¸ªtraceIdæˆ–è€…reqIdä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œæœ‰äº›æ—¶å€™ç¡®å®éœ€è¦å‰ç«¯æä¾›reqIdå»æ’æŸ¥é—®é¢˜ï¼Œä¸€èˆ¬åšæ³•ç”±å‰ç«¯å‘èµ·çš„è¯·æ±‚ç”±å‰ç«¯ç”ŸæˆreqIdï¼Œè€Œåç«¯æœåŠ¡é—´çš„è°ƒç”¨ç”±è°ƒç”¨æ–¹ç”ŸæˆtraceIdï¼Œå¦‚æœç”±æ¥æ”¶æ–¹ç”Ÿæˆå¯¹æ’æŸ¥é—®é¢˜ä¼šæ‰¾ä¸åˆ°æ ¹æº","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672753331,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1159084,"avatar":"https://static001.geekbang.org/account/avatar/00/11/af/ac/dd36cf29.jpg","nickname":"on the way","note":"","ucode":"17AAAAF068EA68","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1104601,"avatar":"https://static001.geekbang.org/account/avatar/00/10/da/d9/f051962f.jpg","nickname":"æµ©ä»”æ˜¯ç¨‹åºå‘˜","note":"","ucode":"A7E5CF9E1571A2","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":599247,"discussion_content":"å¯ä»¥é€šè¿‡æŠŠtraceIdè¿”å›ç»™å‰ç«¯æ¥è§£å†³","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673420814,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":598324,"ip_address":"å››å·","group_id":0},"score":599247,"extra":""}]}]},{"had_liked":false,"id":380927,"user_name":"é«˜çº§æŒ‰æ‘©å¸ˆ ğŸ‘ ^ ğŸ‘âƒ¢*","can_delete":false,"product_type":"c1","uid":1435006,"ip_address":"å¹¿ä¸œ","ucode":"31518306EF81B6","user_header":"https://static001.geekbang.org/account/avatar/00/15/e5/7e/5190f9b2.jpg","comment_is_top":false,"comment_ctime":1694447383,"is_pvip":false,"replies":[{"id":138794,"content":"ä½ å¥½ï¼Œé«˜çº§æŒ‰æ‘©å¸ˆï¼šäº†è§£ä¸‹ ThreadLocal è¿™ä¸ªä¸œè¥¿ï¼Œå°±æ˜¯é å®ƒæ¥è¿›è¡Œè¡”æ¥çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1364525,"ctime":1694644396,"ip_address":"åŒ—äº¬","comment_id":380927,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312101,"comment_content":"RPCConextæ˜¯æ€ä¹ˆä¼ é€’çš„ï¼ŒæœåŠ¡ä¹‹é—´è°ƒç”¨ï¼Œä¸Šä¸‹æ–‡æ€ä¹ˆä¼ é€’çš„å‘¢","like_count":1,"discussions":[{"author":{"id":1364525,"avatar":"https://static001.geekbang.org/account/avatar/00/14/d2/2d/d303cfe0.jpg","nickname":"HMILYYLIMH","note":"","ucode":"9355AB4A1A1B97","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":627878,"discussion_content":"ä½ å¥½ï¼Œé«˜çº§æŒ‰æ‘©å¸ˆï¼šäº†è§£ä¸‹ ThreadLocal è¿™ä¸ªä¸œè¥¿ï¼Œå°±æ˜¯é å®ƒæ¥è¿›è¡Œè¡”æ¥çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1694644396,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":369327,"user_name":"Lum","can_delete":false,"product_type":"c1","uid":3231352,"ip_address":"åŒ—äº¬","ucode":"7EF828425E685A","user_header":"https://static001.geekbang.org/account/avatar/00/31/4e/78/ee4e12cc.jpg","comment_is_top":false,"comment_ctime":1677412361,"is_pvip":false,"replies":[{"id":134869,"content":"ä½ å¥½ï¼ŒLumï¼šä½ åˆšåˆšæ‰€æè¿°çš„åœºæ™¯ï¼Œå…¶å®å°±æ˜¯ã€ä»»åŠ¡ä¸€ã€‘è™šçº¿æ¡†ä¸­çš„åœºæ™¯ï¼Œè¿™ç§æ˜¯æ¯”è¾ƒå•ä¸€çš„ï¼Œå¯¹äºå•ä¸€çš„åœºæ™¯ï¼Œå¤§å¯ä»¥æ‹¿ç€ä¸€å †çš„ Future åˆ—è¡¨æŒ¨ä¸ªè°ƒç”¨ get æ–¹æ³•ï¼Œä½†æ˜¯å¦‚æœ Future ä¸ Future ä¹‹é—´å¦‚æœæœ‰å…ˆåé¡ºåºã€ç»“æœèšåˆã€é€»è¾‘è®¡ç®—ç­‰ç­‰ï¼Œé‚£ä¸€ç›´ä½¿ç”¨ get æ“ä½œå°±ç©ä¸è½¬äº†~","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1364525,"ctime":1678193259,"ip_address":"å¹¿ä¸œ","comment_id":369327,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312101,"comment_content":"è¯·é—®ä¸€ä¸‹ CompleteableFutureé‚£äº›å¹¶è¡Œè®¡ç®—çš„æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé¡¹ç›®ä¸­æ¯”å¦‚ä»å¤šä¸ªç³»ç»Ÿä¸­å–æ•°æ®ï¼Œä¸€èˆ¬æˆ‘éƒ½ç”¨äº†5,6ä¸ªCompletableFutureï¼Œç„¶åç›´æ¥æ¯ä¸ªéƒ½getäº†ã€‚ã€‚ã€‚  æ²¡æ€ä¹ˆç”¨åˆ°ä¸Šé¢çš„é‚£äº›api","like_count":1,"discussions":[{"author":{"id":1364525,"avatar":"https://static001.geekbang.org/account/avatar/00/14/d2/2d/d303cfe0.jpg","nickname":"HMILYYLIMH","note":"","ucode":"9355AB4A1A1B97","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":607938,"discussion_content":"ä½ å¥½ï¼ŒLumï¼šä½ åˆšåˆšæ‰€æè¿°çš„åœºæ™¯ï¼Œå…¶å®å°±æ˜¯ã€ä»»åŠ¡ä¸€ã€‘è™šçº¿æ¡†ä¸­çš„åœºæ™¯ï¼Œè¿™ç§æ˜¯æ¯”è¾ƒå•ä¸€çš„ï¼Œå¯¹äºå•ä¸€çš„åœºæ™¯ï¼Œå¤§å¯ä»¥æ‹¿ç€ä¸€å †çš„ Future åˆ—è¡¨æŒ¨ä¸ªè°ƒç”¨ get æ–¹æ³•ï¼Œä½†æ˜¯å¦‚æœ Future ä¸ Future ä¹‹é—´å¦‚æœæœ‰å…ˆåé¡ºåºã€ç»“æœèšåˆã€é€»è¾‘è®¡ç®—ç­‰ç­‰ï¼Œé‚£ä¸€ç›´ä½¿ç”¨ get æ“ä½œå°±ç©ä¸è½¬äº†~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678193259,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":364969,"user_name":"ç‹å·","can_delete":false,"product_type":"c1","uid":1023106,"ip_address":"å¹¿ä¸œ","ucode":"F65F2E72C98D62","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9c/82/6073884b.jpg","comment_is_top":false,"comment_ctime":1671801036,"is_pvip":false,"replies":[{"id":132915,"content":"ä½ å¥½ï¼Œç‹å·ï¼šä½ é—®å¾—è¿™ä¸ªç»†èŠ‚éå¸¸ niceï¼Œè¿›ç¨‹ä¸­å¤šçº¿ç¨‹çš„ traceId ä¼ é€’ï¼Œæ˜¯å¦å¤–ä¸€ä¸ªè¯é¢˜ã€‚\n\nè¿™é‡Œæˆ‘ç»™ä¸ªå¤§æ¦‚æ€è·¯ï¼Œä½ å¯ä»¥å•ç‹¬å°†è¿™äº›å¤šçº¿ç¨‹ä¹‹é—´å¦‚ä½•ä¼ é€’ traceId åšæˆä¸€ä¸ªæ’ä»¶ï¼Œæ¯”å¦‚å¯ä»¥æ¨ªåˆ‡Springçš„AsyncTaskExecutorçš„æ–¹æ³•ï¼Œæ¯”å¦‚ç»Ÿä¸€æŒ‡å®šå…¬å¸è§„èŒƒä½¿ç”¨æŸå‡ ç§ Runnable&#47;Callable æ¥æ“ä½œçº¿ç¨‹ï¼Œæ¯”å¦‚ MQ&#47;Job åœ¨è§¦å‘æ—¶åˆ»çš„æºå¤´ç›´æ¥è‡ªåŠ¨æ¨ªåˆ‡ä¸€åˆ€èµ‹ä¸ŠtraceIdï¼Œç­‰ç­‰ç­‰ç­‰ï¼Œæ€»ä¹‹æ—¨åœ¨å°†æ–¹æ³•æ‰§è¡Œå‰ä¸æ–¹æ³•æ‰§è¡Œåçš„traceIdè¡”æ¥èµ·æ¥ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1364525,"ctime":1672025660,"ip_address":"å¹¿ä¸œ","comment_id":364969,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312101,"comment_content":"å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œçº¿ç¨‹ä¹Ÿèƒ½è·å–åˆ°æ­£ç¡®çš„ traceId å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1364525,"avatar":"https://static001.geekbang.org/account/avatar/00/14/d2/2d/d303cfe0.jpg","nickname":"HMILYYLIMH","note":"","ucode":"9355AB4A1A1B97","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597564,"discussion_content":"ä½ å¥½ï¼Œç‹å·ï¼šä½ é—®å¾—è¿™ä¸ªç»†èŠ‚éå¸¸ niceï¼Œè¿›ç¨‹ä¸­å¤šçº¿ç¨‹çš„ traceId ä¼ é€’ï¼Œæ˜¯å¦å¤–ä¸€ä¸ªè¯é¢˜ã€‚\n\nè¿™é‡Œæˆ‘ç»™ä¸ªå¤§æ¦‚æ€è·¯ï¼Œä½ å¯ä»¥å•ç‹¬å°†è¿™äº›å¤šçº¿ç¨‹ä¹‹é—´å¦‚ä½•ä¼ é€’ traceId åšæˆä¸€ä¸ªæ’ä»¶ï¼Œæ¯”å¦‚å¯ä»¥æ¨ªåˆ‡Springçš„AsyncTaskExecutorçš„æ–¹æ³•ï¼Œæ¯”å¦‚ç»Ÿä¸€æŒ‡å®šå…¬å¸è§„èŒƒä½¿ç”¨æŸå‡ ç§ Runnable/Callable æ¥æ“ä½œçº¿ç¨‹ï¼Œæ¯”å¦‚ MQ/Job åœ¨è§¦å‘æ—¶åˆ»çš„æºå¤´ç›´æ¥è‡ªåŠ¨æ¨ªåˆ‡ä¸€åˆ€èµ‹ä¸ŠtraceIdï¼Œç­‰ç­‰ç­‰ç­‰ï¼Œæ€»ä¹‹æ—¨åœ¨å°†æ–¹æ³•æ‰§è¡Œå‰ä¸æ–¹æ³•æ‰§è¡Œåçš„traceIdè¡”æ¥èµ·æ¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672025661,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":366715,"user_name":"ä¹Œå‡Œå…ˆæ£®","can_delete":false,"product_type":"c1","uid":1179862,"ip_address":"å¹¿è¥¿","ucode":"52ED46F8C6208C","user_header":"https://static001.geekbang.org/account/avatar/00/12/00/d6/e49c6ac2.jpg","comment_is_top":false,"comment_ctime":1674099553,"is_pvip":false,"replies":[{"id":133612,"content":"ä½ å¥½ï¼Œä¹Œå‡Œå…ˆæ£®ï¼šè¿™ä¿©æ³¨è§£å„è‡ªè§£å†³çš„é—®é¢˜ä¸ä¸€æ ·ï¼š\n\n1.@DubboService è§£å†³çš„æ˜¯åœ¨ç¼–ç å±‚é¢æ—¶æ¥å£å®ç°ç±»å¯ä»¥å¤„ç†Dubboçš„æ¥æ”¶è¯·æ±‚ã€‚\n\n2.@Component è§£å†³çš„æ˜¯åœ¨ Spring æ¡†æ¶ä¸­è¯¥æ¥å£å®ç°ç±»å˜æˆå•å®ä¾‹å¯¹è±¡ä»¥ä¾¿åç»­å¯ä»¥è¢« @Autowiredã€@Resource è¿›è¡Œæ³¨å…¥ä½¿ç”¨ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1364525,"ctime":1674133008,"ip_address":"æ¹–å—","comment_id":366715,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100312101,"comment_content":"è€å¸ˆä½ å¥½ï¼Œ@DubboService + @Component è¿™ç§ä½¿ç”¨æ–¹å¼æœ‰å•¥å¥½å¤„ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1364525,"avatar":"https://static001.geekbang.org/account/avatar/00/14/d2/2d/d303cfe0.jpg","nickname":"HMILYYLIMH","note":"","ucode":"9355AB4A1A1B97","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600250,"discussion_content":"ä½ å¥½ï¼Œä¹Œå‡Œå…ˆæ£®ï¼šè¿™ä¿©æ³¨è§£å„è‡ªè§£å†³çš„é—®é¢˜ä¸ä¸€æ ·ï¼š\n\n1.@DubboService è§£å†³çš„æ˜¯åœ¨ç¼–ç å±‚é¢æ—¶æ¥å£å®ç°ç±»å¯ä»¥å¤„ç†Dubboçš„æ¥æ”¶è¯·æ±‚ã€‚\n\n2.@Component è§£å†³çš„æ˜¯åœ¨ Spring æ¡†æ¶ä¸­è¯¥æ¥å£å®ç°ç±»å˜æˆå•å®ä¾‹å¯¹è±¡ä»¥ä¾¿åç»­å¯ä»¥è¢« @Autowiredã€@Resource è¿›è¡Œæ³¨å…¥ä½¿ç”¨ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1674133008,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¹–å—","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1198895,"avatar":"https://static001.geekbang.org/account/avatar/00/12/4b/2f/a93ff216.jpg","nickname":"å¤©å®‡æ˜Ÿæ—‹","note":"","ucode":"69D10D5F4EB782","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1364525,"avatar":"https://static001.geekbang.org/account/avatar/00/14/d2/2d/d303cfe0.jpg","nickname":"HMILYYLIMH","note":"","ucode":"9355AB4A1A1B97","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":612784,"discussion_content":"è€å¸ˆï¼Œ@DubboService æ³¨è§£æœ¬èº«åœ¨è§£æçš„æ—¶å€™å°±ä¼šè¢«æ³¨å…¥Springå®¹å™¨ä¸­ç®¡ç†ï¼Œå†åŠ ä¸Š@Component æ³¨è§£æ˜¯ç§å†—ä½™äº†å§ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680938148,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":600250,"ip_address":"ä¸Šæµ·","group_id":0},"score":612784,"extra":""}]}]},{"had_liked":false,"id":364977,"user_name":"Geek_10086","can_delete":false,"product_type":"c1","uid":1635976,"ip_address":"å¹¿ä¸œ","ucode":"EAEB2F7B59EAC0","user_header":"https://static001.geekbang.org/account/avatar/00/18/f6/88/791d0f5e.jpg","comment_is_top":false,"comment_ctime":1671842671,"is_pvip":false,"replies":[{"id":132916,"content":"ä½ å¥½ï¼ŒGeek_10086ï¼šè¯´æ¶ˆè´¹æ–¹è¿˜æœ‰ç‚¹ä¸å¤ªå‡†ç¡®ï¼Œç²¾å‡†ç‚¹è¯´ï¼Œåº”è¯¥æ˜¯ä»æ¥æ”¶è¯·æ±‚çš„é‚£ä¸ªæºå¤´å°±å¯ä»¥è€ƒè™‘ç”ŸæˆtraceIdã€‚\n\næ¯”å¦‚æ¥æ”¶å‰ç«¯è¯·æ±‚ï¼ŒWebå®¹å™¨æ¯”å¦‚Tomcatçš„Filteræ˜¯æœ€èƒ½ç¬¬ä¸€æ—¶é—´æ„ŸçŸ¥è¯·æ±‚çš„å­˜åœ¨ï¼Œå¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œæ‹¦æˆªç›´æ¥ç”ŸæˆTraceIdï¼Œè‡³äºTomcatåœ¨Filterä¹‹åçš„ä¸€äº›å¤„ç†ç¯èŠ‚ï¼Œå°±å¯ä»¥ç›´æ¥æ‹¿åˆ°TraceIdäº†ã€‚å†è¿›å…¥Controllerè°ƒç”¨ä¸‹æ¸¸Dubboæ¥å£çš„è¯ï¼Œæ¶ˆè´¹æ–¹å‘ç°ä¸Šä¸‹æ–‡æ²¡æœ‰ traceId çš„ä¹Ÿæ˜¯å¯ä»¥è€ƒè™‘ç”Ÿæˆï¼Œä¹Ÿæ˜¯ä¸€ç§å…¼å®¹è€ƒè™‘æ–¹æ³•ï¼ŒæŒºå¥½çš„ã€‚\n\nè‡³äºä½ è¯´çš„æ¶ˆè´¹æ–¹è¿‡æ»¤å™¨é»˜è®¤ä¸º null çš„æƒ…å†µï¼Œä¸€åŠå¯¹ä¸€åŠä¸å¯¹ï¼Œæ¯”å¦‚ A -&gt;B -&gt; Cï¼ŒæŠ›å¼€Webå®¹å™¨æ¥çœ‹å¾…çš„è¯ï¼ŒA çš„æ¶ˆè´¹æ–¹è¿‡æ»¤å™¨å…¶å®æ‹¿åˆ°çš„ traceId æ˜¯ null å€¼ï¼Œä½†æ˜¯ B æ‰€èƒ½å¾ˆå¥½è¡”æ¥ traceId çš„è¯ï¼Œé‚£ä¹ˆ B åœ¨å‘èµ·è°ƒç”¨ C çš„æ—¶å€™ï¼ŒB çš„æ¶ˆè´¹æ–¹è¿‡æ»¤å™¨æ˜¯èƒ½æ­£å¸¸æ‹¿åˆ° traceId çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1364525,"ctime":1672026349,"ip_address":"å¹¿ä¸œ","comment_id":364977,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312101,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼ŒtraceIdæ˜¯ä¸æ˜¯åº”è¯¥åœ¨æ¶ˆè´¹è€…ç«¯ï¼ˆReqNoConsumerFilterï¼‰ç”Ÿæˆï¼Œé€šè¿‡éšå¼ä¼ é€’åˆ°æœåŠ¡æä¾›ç«¯ï¼ˆReqNoProviderFilterï¼‰ï¼Œæ–‡ä¸­ä»£ç åœ¨ReqNoConsumerFilterä¸­ä»ä¸Šä¸‹æ–‡è·å–åº”è¯¥æ˜¯nullå§","like_count":0,"discussions":[{"author":{"id":1364525,"avatar":"https://static001.geekbang.org/account/avatar/00/14/d2/2d/d303cfe0.jpg","nickname":"HMILYYLIMH","note":"","ucode":"9355AB4A1A1B97","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597565,"discussion_content":"ä½ å¥½ï¼ŒGeek_10086ï¼šè¯´æ¶ˆè´¹æ–¹è¿˜æœ‰ç‚¹ä¸å¤ªå‡†ç¡®ï¼Œç²¾å‡†ç‚¹è¯´ï¼Œåº”è¯¥æ˜¯ä»æ¥æ”¶è¯·æ±‚çš„é‚£ä¸ªæºå¤´å°±å¯ä»¥è€ƒè™‘ç”ŸæˆtraceIdã€‚\n\næ¯”å¦‚æ¥æ”¶å‰ç«¯è¯·æ±‚ï¼ŒWebå®¹å™¨æ¯”å¦‚Tomcatçš„Filteræ˜¯æœ€èƒ½ç¬¬ä¸€æ—¶é—´æ„ŸçŸ¥è¯·æ±‚çš„å­˜åœ¨ï¼Œå¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œæ‹¦æˆªç›´æ¥ç”ŸæˆTraceIdï¼Œè‡³äºTomcatåœ¨Filterä¹‹åçš„ä¸€äº›å¤„ç†ç¯èŠ‚ï¼Œå°±å¯ä»¥ç›´æ¥æ‹¿åˆ°TraceIdäº†ã€‚å†è¿›å…¥Controllerè°ƒç”¨ä¸‹æ¸¸Dubboæ¥å£çš„è¯ï¼Œæ¶ˆè´¹æ–¹å‘ç°ä¸Šä¸‹æ–‡æ²¡æœ‰ traceId çš„ä¹Ÿæ˜¯å¯ä»¥è€ƒè™‘ç”Ÿæˆï¼Œä¹Ÿæ˜¯ä¸€ç§å…¼å®¹è€ƒè™‘æ–¹æ³•ï¼ŒæŒºå¥½çš„ã€‚\n\nè‡³äºä½ è¯´çš„æ¶ˆè´¹æ–¹è¿‡æ»¤å™¨é»˜è®¤ä¸º null çš„æƒ…å†µï¼Œä¸€åŠå¯¹ä¸€åŠä¸å¯¹ï¼Œæ¯”å¦‚ A -&gt;B -&gt; Cï¼ŒæŠ›å¼€Webå®¹å™¨æ¥çœ‹å¾…çš„è¯ï¼ŒA çš„æ¶ˆè´¹æ–¹è¿‡æ»¤å™¨å…¶å®æ‹¿åˆ°çš„ traceId æ˜¯ null å€¼ï¼Œä½†æ˜¯ B æ‰€èƒ½å¾ˆå¥½è¡”æ¥ traceId çš„è¯ï¼Œé‚£ä¹ˆ B åœ¨å‘èµ·è°ƒç”¨ C çš„æ—¶å€™ï¼ŒB çš„æ¶ˆè´¹æ–¹è¿‡æ»¤å™¨æ˜¯èƒ½æ­£å¸¸æ‹¿åˆ° traceId çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672026349,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}