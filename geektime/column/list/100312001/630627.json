{"id":630627,"title":"30ï½œåº”ç”¨å¥åº·ï¼šå¦‚ä½•è¿…é€Ÿåˆ¤æ–­ä¸šåŠ¡çŠ¶æ€å’Œå¯ç”¨æ€§ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç‹ç‚œã€‚</p><p>ä»è¿™èŠ‚è¯¾å¼€å§‹ï¼Œæˆ‘ä»¬æ­£å¼è¿›å…¥äº‘åŸç”Ÿæ¶æ„çš„å…¨æ–°é¢†åŸŸï¼šåº”ç”¨å¯è§‚æµ‹æ€§ã€‚</p><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šè¢«é—®åˆ°è¿™äº›é—®é¢˜ï¼šä¸šåŠ¡ç°åœ¨å¥åº·å—ï¼Ÿçº¿ä¸Šéƒ¨ç½²çš„æ˜¯ä»€ä¹ˆç‰ˆæœ¬ï¼Œæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™éƒ¨ç½²çš„ï¼Ÿå®ƒçš„æ•´ä½“å¯ç”¨æ€§æ€ä¹ˆæ ·ï¼Ÿæ˜¯å¦æœ‰æŠ¥é”™ä¿¡æ¯ç­‰ç­‰ã€‚åœ¨å•ä½“åº”ç”¨æ¶æ„ä¸‹ï¼Œè¿™äº›é—®é¢˜å¯èƒ½éå¸¸å®¹æ˜“å›ç­”ï¼Œä½†æ˜¯åœ¨åˆ†å¸ƒå¼çš„å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œè¦è¿…é€Ÿå›ç­”è¿™äº›é—®é¢˜å¹¶ä¸ç®€å•ã€‚</p><p>ä»æ¦‚å¿µçš„å®šä¹‰ä¸Šæ¥è¯´ï¼Œå¯è§‚æµ‹æ€§åŒ…æ‹¬ä¸‰ä¸ªæ–¹é¢ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„æŒ‡æ ‡ã€æ—¥å¿—å’Œé“¾è·¯ã€‚æŒ‡æ ‡ä¸»è¦ç”¨äºè¡¡é‡ç¨‹åºæ€§èƒ½ï¼Œé€šè¿‡æŒ‡æ ‡çš„åº¦é‡å€¼æˆ‘ä»¬å¯ä»¥åˆ¤æ–­ç³»ç»Ÿçš„è¡¨ç°æƒ…å†µã€‚æœ€å¸¸è§çš„æŒ‡æ ‡æœ‰ CPUã€å†…å­˜ã€ç£ç›˜å’Œç½‘ç»œç­‰ã€‚æ—¥å¿—ä¸»è¦ç”¨æ¥ç»Ÿä¸€æ”¶é›†ä¸šåŠ¡è¾“å‡ºçš„æ—¥å¿—ï¼ŒåŒ…æ‹¬å„ç§çº§åˆ«çš„æç¤ºè­¦å‘Šå’Œé”™è¯¯æ—¥å¿—ä¿¡æ¯ç­‰ï¼Œç»“åˆæŸ¥è¯¢ç³»ç»Ÿæˆ‘ä»¬ä¾¿èƒ½å¤Ÿå¿«é€Ÿå®šä½é”™è¯¯ã€‚é“¾è·¯ä¸€èˆ¬æŒ‡çš„æ˜¯åˆ†å¸ƒå¼è¿½è¸ªï¼Œå®ƒå¯ä»¥è¯„ä¼°ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚é“¾ä¸Šå¾®æœåŠ¡çš„æ€§èƒ½æƒ…å†µã€‚</p><p>ä¸è¿‡ï¼Œå¯è§‚æµ‹æ€§æ›´å¤šçš„æ˜¯æ·±å…¥åˆ°å¾®æœåŠ¡å†…éƒ¨ç›‘æ§æ€§èƒ½å’ŒæŒ‡æ ‡ï¼Œè€Œåœ¨å®é™…çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå½“ä¸šåŠ¡å‡ºç°å¼‚å¸¸æ—¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šä»å¤–åˆ°å†…æ’æŸ¥é—®é¢˜ã€‚ä¹Ÿå°±æ˜¯å…ˆæ£€æŸ¥åº”ç”¨æ•´ä½“çš„çŠ¶æ€å’Œå¯ç”¨æ€§ï¼Œå†å€ŸåŠ©å¯è§‚æµ‹æ€§å·¥å…·å¯¹åº”ç”¨å†…æ¯ä¸€ä¸ªå¾®æœåŠ¡è¿›è¡Œæ·±å…¥æ’æŸ¥ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨æ­£å¼è¿›å…¥åˆ°å¯è§‚æµ‹æ€§çš„å­¦ä¹ ä¹‹å‰ï¼Œè¿™èŠ‚è¯¾ï¼Œæˆ‘ä¼šå…ˆä»æ’æŸ¥é—®é¢˜çš„ç¬¬ä¸€åŸåˆ™å‡ºå‘ï¼Œä¹Ÿå°±æ˜¯ä»æœ€å¤–å±‚çš„ä¸šåŠ¡åº”ç”¨å‡ºå‘ï¼Œä»‹ç»åœ¨ GitOps åœºæ™¯ä¸‹åˆ¤æ–­ä¸šåŠ¡çŠ¶æ€ã€æŸ¥æ‰¾æ•…éšœçš„å‡ ç§æ–¹æ³•ã€‚å½“ä½ åœ¨å®è·µä¸­é‡åˆ°ç”Ÿäº§æ•…éšœæ—¶ï¼Œå®Œå…¨å¯ä»¥æŠŠè¿™èŠ‚è¯¾çš„å†…å®¹ä½œä¸ºæ•…éšœæ’æŸ¥æ‰‹å†Œæ¥ä½¿ç”¨ã€‚</p><!-- [[[read_end]]] --><h2>åº”ç”¨å¥åº·çŠ¶æ€</h2><p>å¯¹äº Kubernetes åº”ç”¨è€Œè¨€ï¼Œå®ƒå¾€å¾€ä¼šåŒ…å«ä¸åŒçš„ Kubernetes å¯¹è±¡å’Œå·¥ä½œè´Ÿè½½ï¼Œè¦åˆ¤æ–­åº”ç”¨æ˜¯å¦å¤„äºå¥åº·çŠ¶æ€ï¼Œç­‰åŒäºåˆ¤æ–­åº”ç”¨æ‰€æœ‰çš„å·¥ä½œè´Ÿè½½æ˜¯å¦éƒ½å¤„äºå¥åº·çŠ¶æ€ï¼Œè¿™å¾ˆç¹çå¹¶ä¸”ä¹Ÿä¸ç›´è§‚ã€‚</p><p>æˆ‘ä¹‹å‰ä¹‹æ‰€ä»¥æ¨èä½¿ç”¨ ArgoCD æ¥éƒ¨ç½²åº”ç”¨ï¼Œå…¶ä¸­ä¸€ä¸ªå¾ˆé‡è¦çš„åŸå› å°±æ˜¯å®ƒå†…ç½®äº†åº”ç”¨çº§çš„<strong>â€œå¥åº·çŠ¶æ€â€</strong>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/7c/b7/7c39db2067c0b887746bf233ef4be0b7.png?wh=1920x204\" alt=\"å›¾ç‰‡\"></p><p>ArgoCD ä¸ºå‡ ç§æ ‡å‡†çš„ Kubernetes å¯¹è±¡æä¾›äº†å¥åº·çŠ¶æ€çš„ç®—æ³•ï¼Œå½“åº”ç”¨å†…æ‰€æœ‰èµ„æºéƒ½å¤„äºå¥åº·çŠ¶æ€æ—¶ï¼Œå°±è®¤ä¸ºåº”ç”¨ä¹Ÿå¤„äºå¥åº·çŠ¶æ€ï¼Œè¿™éå¸¸ç¬¦åˆæˆ‘ä»¬åˆ¤æ–­åº”ç”¨çŠ¶æ€çš„æ ‡å‡†ã€‚</p><p>å¯¹äº Kubernetes çš„å·¥ä½œè´Ÿè½½ï¼Œä¾‹å¦‚ Deploymentã€StatefulSet å’Œ DaemonSet ç­‰ï¼Œæœ‰ä¸‹é¢ä¸‰ä¸ªåˆ¤æ–­å¥åº·çŠ¶æ€çš„æ¡ä»¶ã€‚</p><ol>\n<li>å·¥ä½œè´Ÿè½½å¤„äºè¿è¡ŒçŠ¶æ€ã€‚</li>\n<li>éƒ¨ç½²çš„ç‰ˆæœ¬ç¬¦åˆæœŸæœ›ç‰ˆæœ¬ã€‚</li>\n<li>å®é™…çš„å‰¯æœ¬æ•°ç¬¦åˆæœŸæœ›çš„å‰¯æœ¬æ•°ã€‚</li>\n</ol><p>å¯¹äº Service æ¥è¯´ï¼ŒArgoCD ä¼šæ£€æŸ¥ç±»å‹æ˜¯å¦ä¸º LoadBalancer ï¼Œå¹¶åˆ¤æ–­ status.loadBalancer.ingress å­—æ®µæ˜¯å¦ä¸ºç©ºï¼Œä»è€Œåˆ¤æ–­æ˜¯å¦æˆåŠŸåˆ›å»ºäº†è´Ÿè½½å‡è¡¡å™¨ã€‚è€Œå¯¹äº Ingress ï¼Œåˆ™åˆ¤æ–­ status.loadBalancer.ingress å­—æ®µæ˜¯å¦ä¸ºç©ºã€‚</p><p>æœ€åï¼Œå¯¹äºæŒä¹…å·ï¼ˆPVCï¼‰ï¼ŒArgoCD ä¼šåˆ¤æ–­ status.phase å­—æ®µæ˜¯å¦ä¸º Bound çŠ¶æ€ã€‚</p><p>æ‰€ä»¥ï¼Œè¦æ£€æŸ¥ä¸šåŠ¡åº”ç”¨çš„å¥åº·çŠ¶æ€ï¼Œä½ åº”è¯¥é¦–å…ˆæŸ¥çœ‹ ArgoCD çš„åº”ç”¨å¥åº·çŠ¶æ€ã€‚å¦‚æœçŠ¶æ€æ˜¯ Heathyï¼Œè¯´æ˜åº”ç”¨è¿è¡Œæ­£å¸¸ï¼Œå¦‚æœçŠ¶æ€æ˜¯ Degradedï¼Œè¯´æ˜åº”ç”¨å¤„äºå¼‚å¸¸çŠ¶æ€ã€‚</p><p>æ­¤å¤–ï¼ŒArgoCD çš„ â€œCURRENT SYNC STATUSâ€ è¿˜èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬è¿›ä¸€æ­¥åˆ¤æ–­é›†ç¾¤å†…æ‰€æœ‰èµ„æºæ˜¯å¦å·²ç»å’Œä»“åº“è¿›è¡Œäº†åŒæ­¥ã€‚Synced çŠ¶æ€è¡¨ç¤ºå·²ç»åŒæ­¥å®Œæˆï¼ŒOut-Of-Sync ä»£è¡¨é›†ç¾¤èµ„æºå’Œ Git ä»“åº“æœ‰å·®å¼‚ï¼Œè¿™æ—¶å€™å°±éœ€è¦ç•™æ„äº§ç”Ÿå·®å¼‚çš„åŸå› ï¼Œä¾‹å¦‚æ˜¯å¦æ‰‹åŠ¨ä¿®æ”¹äº†é›†ç¾¤å†…çš„èµ„æºæˆ–è€…ç›´æ¥åœ¨é›†ç¾¤å†…åˆ›å»ºäº†æ–°çš„èµ„æºç­‰ã€‚</p><h2>Pod å¥åº·çŠ¶æ€</h2><p>å¦‚æœ ArgoCD çš„åº”ç”¨çŠ¶æ€ä¸º Degradedï¼Œä»£è¡¨åº”ç”¨çŠ¶æ€å¼‚å¸¸ï¼Œè¿™æ—¶å€™å°±éœ€è¦è¿›ä¸€æ­¥æ’æŸ¥ï¼Œå¹¶ä» Kubernetes å¯¹è±¡å¼€å§‹ç€æ‰‹äº†ã€‚</p><p>åœ¨ä¹‹å‰çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬æåˆ° Pod æ˜¯ Kubernetes è°ƒåº¦çš„æœ€å°å•ä½ã€‚æ‰€ä»¥ï¼Œå½“å·¥ä½œè´Ÿè½½å‡ºç°æ•…éšœæ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆåº”è¯¥æŸ¥çœ‹ Pod çš„çŠ¶æ€ã€‚</p><p>Pod çš„çŠ¶æ€æ¶‰åŠåˆ°å¯åŠ¨çŠ¶æ€å’Œè¿è¡ŒçŠ¶æ€ï¼Œæ’æŸ¥é—®é¢˜ä¹Ÿç›¸å¯¹å¤æ‚ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹æ’æŸ¥æ–¹æ³•ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºç”¨æ¥å®éªŒçš„ Podï¼Œå°†ä¸‹é¢çš„å†…å®¹ä¿å­˜ä¸º pod-status.yaml æ–‡ä»¶ã€‚</p><pre><code class=\"language-yaml\">apiVersion: v1\nkind: Pod\nmetadata:\n  name: running\n  labels:\n    app: nginx\nspec:\n  containers:\n    - name: web\n      image: nginx\n      ports:\n        - name: web\n          containerPort: 80\n          protocol: TCP\n\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: backoff\nspec:\n  containers:\n    - name: web\n      image: nginx:not-exist\n\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: error\nspec:\n  containers:\n    - name: web\n      image: nginx\n      command: [\"sleep\", \"a\"]\n</code></pre><p>ç„¶åï¼Œä½¿ç”¨ kubectl apply å‘½ä»¤å°†å®ƒåº”ç”¨åˆ°é›†ç¾¤å†…ã€‚</p><pre><code class=\"language-yaml\">$ kubectl apply -f pod-status.yaml\npod/running created\npod/backoff created\npod/error created\n</code></pre><p>æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ kubectl get pods æŸ¥çœ‹åˆšæ‰åˆ›å»ºçš„ 3 ä¸ª Podã€‚</p><pre><code class=\"language-yaml\">NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;READY&nbsp; &nbsp;STATUS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RESTARTS&nbsp; &nbsp; &nbsp; &nbsp; AGE\nbackoff&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0/1&nbsp; &nbsp; &nbsp;ImagePullBackOff&nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;50s\nerror&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0/1&nbsp; &nbsp; &nbsp;CrashLoopBackOff&nbsp;  1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4s\nrunning&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1/1&nbsp; &nbsp; &nbsp;Running&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;50s\n</code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¸€å…±åˆ›å»ºäº† 3 ä¸ª Podï¼Œå®ƒä»¬çš„çŠ¶æ€åŒ…å« ImagePullBackOffã€CrashLoopBackOff å’Œ Runningã€‚</p><p>Running çŠ¶æ€è¡¨ç¤ºè¿è¡Œä¸­ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå‰©ä¸‹ä¸¤ç§å¼‚å¸¸çŠ¶æ€åˆ†åˆ«ä»£è¡¨<strong>å¯åŠ¨å’Œè¿è¡Œé˜¶æ®µçš„é”™è¯¯</strong>ï¼Œå®ƒä»¬ä¹Ÿæ˜¯ç”Ÿäº§ç¯å¢ƒå‡ºç°é¢‘ç‡æœ€é«˜çš„é”™è¯¯ï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šå¯¹å®ƒä»¬ç»§ç»­æ·±å…¥åˆ†æã€‚</p><h3>ImagePullBackOff</h3><p>ImagePullBackOff æ˜¯ä¸€ä¸ªå…¸å‹çš„<strong>å®¹å™¨å¯åŠ¨é”™è¯¯</strong>ï¼Œé™¤å®ƒä¹‹å¤–ï¼Œä½ å¯èƒ½è¿˜ä¼šçœ‹åˆ°ä¸‹é¢è¿™å‡ ä¸ªå®¹å™¨å¯åŠ¨é˜¶æ®µçš„é”™è¯¯ï¼š</p><ul>\n<li>ErrImagePull</li>\n<li>ImageInspectError</li>\n<li>ErrImageNeverPull</li>\n<li>RegistryUnavailable</li>\n<li>InvalidImageName</li>\n</ul><p>è¿™å‡ ç§é”™è¯¯å‡ºç°çš„æ¦‚ç‡æ¯”è¾ƒä½ï¼Œå¹¶ä¸”å•çº¯ä»å­—é¢ä¸Šä¹Ÿå°±èƒ½å¤§æ¦‚ç†è§£å®ƒçš„å«ä¹‰æ‰€ä»¥è¿™é‡Œæˆ‘ä¸»è¦ä»‹ç» ImagePullBackOff é”™è¯¯ã€‚å®ƒå¯èƒ½æ˜¯ä¸‹é¢è¿™ä¸¤ä¸ªåŸå› å¯¼è‡´çš„ã€‚</p><ol>\n<li>é•œåƒåç§°æˆ–è€…ç‰ˆæœ¬é”™è¯¯ï¼Œåœ¨æˆ‘ä»¬åˆšæ‰åˆ›å»ºçš„ backoff Pod ä¸­ï¼Œæˆ‘ä»¬æŒ‡å®šçš„é•œåƒä¸º nginx:not-existï¼Œä½†æ˜¯å®é™…ä¸Šé•œåƒç‰ˆæœ¬ not-exist å¹¶ä¸å­˜åœ¨ï¼Œè‡ªç„¶ä¹Ÿå°±ä¼šæŠ›å‡ºé”™è¯¯ã€‚</li>\n<li>æŒ‡å®šäº†ç§æœ‰é•œåƒï¼Œä½†åˆæ²¡æœ‰æä¾›æ‹‰å–å‡­æ®ã€‚</li>\n</ol><p>æœ‰çš„æ—¶å€™ï¼Œä½ å¯èƒ½çœ‹åˆ°äº†é”™è¯¯ï¼Œä½†å¾ˆéš¾ç«‹åˆ»æ‰¾åˆ°å…·ä½“çš„åŸå› ï¼Œè¿™é‡Œæˆ‘ä¸ºä½ æ€»ç»“ä¸€ä¸ªæ–¹æ³•ã€‚å¯¹äºå¯åŠ¨é˜¶æ®µçš„é”™è¯¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ kubectl describe å‘½ä»¤æ¥æŸ¥çœ‹é”™è¯¯çš„è¯¦æƒ…ã€‚</p><pre><code class=\"language-yaml\">$ kubectl describe pod backoff\nEvents:\n&nbsp; Type&nbsp; &nbsp; &nbsp;Reason&nbsp; &nbsp; &nbsp;Age&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; From&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Message\n&nbsp; ----&nbsp; &nbsp; &nbsp;------&nbsp; &nbsp; &nbsp;----&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;----&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-------\n&nbsp; Normal&nbsp; &nbsp;Scheduled&nbsp; 10m&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default-scheduler&nbsp; Successfully assigned default/backoff to kind-control-plane\n&nbsp; Normal&nbsp; &nbsp;Pulling&nbsp; &nbsp; 8m43s (x4 over 10m)&nbsp; kubelet&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Pulling image \"nginx:not-exist\"\n&nbsp; Warning&nbsp; Failed&nbsp; &nbsp; &nbsp;8m40s (x4 over 10m)&nbsp; kubelet&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Failed to pull image \"nginx:not-exist\": rpc error: code = NotFound desc = failed to pull and unpack image \"docker.io/library/nginx:not-exist\": failed to resolve reference \"docker.io/library/nginx:not-exist\": docker.io/library/nginx:not-exist: not found\n&nbsp; Warning&nbsp; Failed&nbsp; &nbsp; &nbsp;8m40s (x4 over 10m)&nbsp; kubelet&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Error: ErrImagePull\n&nbsp; Warning&nbsp; Failed&nbsp; &nbsp; &nbsp;8m11s (x6 over 10m)&nbsp; kubelet&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Error: ImagePullBackOff\n&nbsp; Normal&nbsp; &nbsp;BackOff&nbsp; &nbsp; 4s (x42 over 10m)&nbsp; &nbsp; kubelet&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Back-off pulling image \"nginx:not-exist\"\n</code></pre><p>ä»è¿”å›ç»“æœé‡Œ Event äº‹ä»¶ä¸­çš„ç¬¬ä¸‰è¡Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œé›†ç¾¤æŠ›å‡ºäº† nginx:not-exist: not found çš„å¼‚å¸¸ï¼Œè¿™æ ·æˆ‘ä»¬ä¹Ÿå°±å®šä½åˆ°äº†å…·ä½“çš„é”™è¯¯ã€‚</p><h3>CrashLoopBackOff</h3><p>CrashLoopBackOff æ˜¯ä¸€ç§å…¸å‹çš„å®¹å™¨<strong>è¿è¡Œé˜¶æ®µçš„é”™è¯¯</strong>ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä½ å¯èƒ½è¿˜ä¼šçœ‹åˆ°ç±»ä¼¼çš„ RunContainerError é”™è¯¯ã€‚</p><p>å‡ºç°è¿™ä¸ªé”™è¯¯çš„åŸå› ä¸»è¦æœ‰ä¸‹é¢ä¸¤ä¸ªã€‚</p><ol>\n<li>å®¹å™¨å†…çš„åº”ç”¨ç¨‹åºåœ¨å¯åŠ¨æ—¶å‡ºç°äº†é”™è¯¯ï¼Œä¾‹å¦‚é…ç½®è¯»å–å¤±è´¥å¯¼è‡´æ— æ³•å¯åŠ¨ã€‚</li>\n<li>é…ç½®å‡ºé”™ï¼Œä¾‹å¦‚é…ç½®äº†é”™è¯¯çš„å®¹å™¨å¯åŠ¨å‘½ä»¤ã€‚</li>\n</ol><p>åœ¨ä¸Šé¢åˆ›å»ºçš„ error Pod çš„ä¾‹å­ä¸­ï¼Œæˆ‘æ•…æ„é”™è¯¯åœ°é…ç½®äº†å®¹å™¨çš„å¯åŠ¨å‘½ä»¤ï¼Œè¿™æ ·æˆ‘ä»¬ä¹Ÿå°±çœ‹åˆ°äº† CrashLoopBackOff å¼‚å¸¸ã€‚</p><p>å¯¹äºè¿è¡Œé˜¶æ®µçš„é”™è¯¯ï¼Œå¤§éƒ¨åˆ†é”™è¯¯éƒ½æ¥æºäºä¸šåŠ¡æœ¬èº«çš„å¯åŠ¨é˜¶æ®µï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦æŸ¥çœ‹ Pod çš„æ—¥å¿—ä¸€èˆ¬å°±èƒ½å¤Ÿæ‰¾åˆ°é—®é¢˜æ‰€åœ¨ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å°è¯•æ¥æŸ¥çœ‹ error Pod çš„æ—¥å¿—ã€‚</p><pre><code class=\"language-yaml\">$ kubectl logs error\nsleep: invalid time interval 'a'\nTry 'sleep --help' for more information.\n</code></pre><p>ä»è¿”å›çš„æ—¥å¿—æ¥çœ‹ï¼Œsleep å‘½ä»¤æŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯å‚æ•°é”™è¯¯ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šç”¨ Deoloyment å·¥ä½œè´Ÿè½½æ¥ç®¡ç† Podï¼Œåœ¨ Pod å‡ºç°è¿è¡Œé˜¶æ®µå¼‚å¸¸çš„æƒ…å†µä¸‹ï¼ŒPod åç§°ä¼šéšç€é‡æ–°å¯åŠ¨è€Œå‡ºç°å˜åŒ–ï¼Œè¿™æ—¶å€™ä½ å¯ä»¥åœ¨æŸ¥çœ‹æ—¥å¿—æ—¶å¢åŠ  --previous å‚æ•°ï¼Œä»¥æ­¤æŸ¥çœ‹ä¹‹å‰çš„ Pod æ—¥å¿—ã€‚</p><pre><code class=\"language-yaml\">$ kubectl logs pod-name --previous\n</code></pre><h3>Pending</h3><p>æœ‰æ—¶å€™ï¼Œä½ å¯èƒ½ä¸ä¼šçœ‹åˆ°å¯åŠ¨å’Œè¿è¡Œçš„é”™è¯¯çŠ¶æ€ï¼Œä½†æŸ¥çœ‹çŠ¶æ€æ—¶ï¼Œä¼šçœ‹åˆ° Pod å¤„äº Pending çŠ¶æ€ã€‚ä½ å¯ä»¥å°è¯•å°†ä¸‹é¢çš„å†…å®¹ä¿å­˜ä¸º pending-pod.yaml æ–‡ä»¶ï¼Œå¹¶é€šè¿‡ kubectl apppy -f å°†è¿™ä¸ªä¾‹å­éƒ¨ç½²åˆ°é›†ç¾¤å†…ã€‚</p><pre><code class=\"language-yaml\">apiVersion: v1\nkind: Pod\nmetadata:\n  name: pending\nspec:\n  containers:\n    - name: web\n      image: nginx\n      resources:\n        requests:\n          cpu: 32\n          memory: 64Gi\n</code></pre><p>æ¥ä¸‹æ¥ï¼Œå°è¯•æŸ¥çœ‹ Pod çš„çŠ¶æ€ã€‚</p><pre><code class=\"language-yaml\">$ kubectl get pods\nNAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;READY&nbsp; &nbsp;STATUS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RESTARTS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AGE\npending&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0/1&nbsp; &nbsp; &nbsp;Pending&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 15s\n</code></pre><p>ä»è¿”å›ç»“æœæˆ‘ä»¬ä¼šå‘ç°ï¼ŒPod æ²¡æœ‰æŠ›å‡ºä»»ä½•å¼‚å¸¸ï¼Œä½†å®ƒçš„çŠ¶æ€å¤„äº Pendingï¼ŒåŒæ—¶ READY 0/1 è¡¨ç¤º Pod æ²¡æœ‰å‡†å¤‡å¥½æ¥æ”¶å¤–éƒ¨æµé‡ã€‚</p><p>å‡ºç° Pending çŠ¶æ€ä¸»è¦çš„åŸå› å¯èƒ½æœ‰ä¸‹é¢ä¸‰ç§ã€‚</p><ol>\n<li>é›†ç¾¤èµ„æºä¸è¶³ä»¥è°ƒåº¦ Podã€‚</li>\n<li>Pod æ­£åœ¨ç­‰å¾… PVC æŒä¹…åŒ–å­˜å‚¨å·ã€‚</li>\n<li>Pod èµ„æºç”¨é‡è¶…è¿‡äº†å‘½åç©ºé—´çš„èµ„æºé…é¢ã€‚</li>\n</ol><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¸º Pod é…ç½®äº† 32 æ ¸ 64G çš„èµ„æºè¯·æ±‚é…é¢ï¼Œè¿™æ˜¾ç„¶è¶…å‡ºäº†é›†ç¾¤èµ„æºã€‚æ­¤æ—¶ Pod ä¼šå¤„äº Pending çŠ¶æ€ï¼Œå¹¶ä¸” Kubernetes ä¼šä¸€ç›´å°è¯•è°ƒåº¦ï¼Œä¸€æ—¦åŠ å…¥äº†æ–°çš„èŠ‚ç‚¹å¹¶æ»¡è¶³èµ„æºè¦æ±‚ï¼ŒPod å°±ä¼šè¢«é‡æ–°å¯åŠ¨ã€‚</p><p>Pending çŠ¶æ€å…¶å®ä¹Ÿç®—æ˜¯å®¹å™¨å¯åŠ¨å¼‚å¸¸çš„ä¸€ç§æƒ…å†µï¼Œä½†å®ƒå¹¶ä¸èƒ½ç®—æ˜¯é”™è¯¯ï¼Œåªæ˜¯æš‚æ—¶æ— æ³•è°ƒåº¦ã€‚è¦æŸ¥æ˜ Pending çŠ¶æ€çš„å…·ä½“åŸå› ï¼Œä½ å¯ä»¥å‚è€ƒå¯»æ‰¾å®¹å™¨å¯åŠ¨é”™è¯¯çš„æ–¹æ³•ï¼Œé€šè¿‡ kubectl describe å‘½ä»¤æ¥æŸ¥çœ‹ã€‚</p><pre><code class=\"language-yaml\">$ kubectl describe pod pending\nEvents:\n&nbsp; Type&nbsp; &nbsp; &nbsp;Reason&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Age&nbsp; &nbsp; From&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Message\n&nbsp; ----&nbsp; &nbsp; &nbsp;------&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ----&nbsp; &nbsp;----&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-------\n&nbsp; Warning&nbsp; FailedScheduling&nbsp; 11m&nbsp; &nbsp; default-scheduler&nbsp; 0/1 nodes are available: 1 Insufficient cpu, 1 Insufficient memory. preemption: 0/1 nodes are available: 1 No preemption victims found for incoming pod.\n&nbsp; Warning&nbsp; FailedScheduling&nbsp; 6m45s&nbsp; default-scheduler&nbsp; 0/1 nodes are available: 1 Insufficient cpu, 1 Insufficient memory. preemption: 0/1 nodes are available: 1 No preemption victims found for incoming pod.\n</code></pre><p>ä»è¿”å›ç»“æœçš„ Event äº‹ä»¶ä¸­æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼ŒPending å‡ºç°çš„åŸå› æ˜¯æ²¡æœ‰ç¬¦åˆ CPU èµ„æºæ¡ä»¶çš„ Node èŠ‚ç‚¹ï¼ŒKubernetes å°è¯•è°ƒåº¦äº†ä¸¤æ¬¡ï¼Œå¼‚å¸¸æƒ…å†µç›¸åŒã€‚</p><h2>Service è¿æ¥çŠ¶æ€</h2><p>æœ‰æ—¶å€™ï¼Œå³ä¾¿æ˜¯ Pod å¤„äºè¿è¡Œä¸”å¤„äºå°±ç»ªçŠ¶æ€ï¼Œæˆ‘ä»¬ä¹Ÿæ— æ³•ä»å¤–éƒ¨è¯·æ±‚åˆ°ä¸šåŠ¡æœåŠ¡ã€‚è¿™æ—¶å€™å°±è¦å…³æ³¨ Service çš„è¿æ¥çŠ¶æ€äº†ã€‚</p><p>Service æ˜¯ Kubernetes çš„æ ¸å¿ƒç»„ä»¶ï¼Œæ­£å¸¸æƒ…å†µä¸‹å®ƒéƒ½æ˜¯å¯ç”¨çš„ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæµé‡çš„æµå‘ä¸€èˆ¬æ˜¯ä» Ingress åˆ° Service å†åˆ° Podã€‚æ‰€ä»¥ï¼Œå½“æ— æ³•åœ¨å¤–éƒ¨è®¿é—®åˆ° Pod çš„ä¸šåŠ¡æœåŠ¡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆä»æœ€å†…å±‚ä¹Ÿå°±æ˜¯ Pod å¼€å§‹æ£€æŸ¥ï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ç›´è¿ Pod å¹¶å‘èµ·è¯·æ±‚ï¼ŒæŸ¥çœ‹ Pod æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚</p><p>è¦åœ¨æœ¬åœ°è®¿é—® Podï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ kubectl port-forward è¿›è¡Œç«¯å£è½¬å‘ï¼Œä»¥æˆ‘ä»¬åˆšæ‰åˆ›å»ºçš„ Nginx Pod ä¸ºä¾‹ã€‚</p><pre><code class=\"language-yaml\">$ kubectl port-forward pod/running 8081:80\n</code></pre><p>å¦‚æœåœ¨æœ¬åœ°è®¿é—® 8081 ç«¯å£è¯·æ±‚èƒ½å¤ŸæˆåŠŸï¼Œåˆ™ä»£è¡¨ Pod å’Œä¸šåŠ¡å±‚é¢æ˜¯æ­£å¸¸çš„ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥æ£€æŸ¥ Service çš„è¿æ¥çŠ¶æ€ã€‚åŒæ ·åœ°ï¼Œæœ€ç®€å•çš„æ–¹å¼ä¹Ÿæ˜¯é€šè¿‡ç«¯å£è½¬å‘ç›´è¿ Service å‘èµ·è¯·æ±‚ã€‚</p><pre><code class=\"language-yaml\">$ kubectl port-forward service/&lt;service-name&gt; local_port:service_pod\n</code></pre><p>å¦‚æœè¯·æ±‚ Service èƒ½å¤Ÿæ­£ç¡®è¿”å›å†…å®¹ï¼Œè¯´æ˜ Service è¿™ä¸€å±‚ä¹Ÿæ˜¯æ­£å¸¸çš„ã€‚å¦‚æœæ— æ³•è¿”å›å†…å®¹ï¼Œè¿™æ—¶å€™é€šå¸¸å¯èƒ½æœ‰ä¸¤ä¸ªåŸå› ã€‚</p><ol>\n<li>Service Selector é€‰æ‹©å™¨æ²¡æœ‰æ­£ç¡®åŒ¹é…åˆ° Podã€‚</li>\n<li>Service çš„ Port å’Œ TargetPort é…ç½®é”™è¯¯ã€‚</li>\n</ol><p>é€šè¿‡ä¿®å¤è¿™ä¸¤é¡¹é…ç½®ï¼Œä½ åº”è¯¥å°±èƒ½ä¿®å¤ Service åˆ° Pod çš„è¿æ¥é—®é¢˜äº†ã€‚</p><h2>Ingress è¿æ¥çŠ¶æ€</h2><p>åˆ°è¿™é‡Œï¼Œå¦‚æœä»ç„¶æ— æ³•ä» Ingress è®¿é—®ä¸šåŠ¡æœåŠ¡ï¼Œé‚£ä¹ˆå°±éœ€è¦ç»§ç»­æ’æŸ¥ Ingress äº†ã€‚</p><p>é¦–å…ˆï¼Œç¡®è®¤ Ingress æ§åˆ¶å™¨çš„ Pod æ˜¯å¦å¤„äºè¿è¡ŒçŠ¶æ€ã€‚</p><pre><code class=\"language-yaml\">$ kubectl get pods -n ingress-nginx\nNAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; READY&nbsp; &nbsp;STATUS&nbsp; &nbsp; &nbsp; RESTARTS&nbsp; &nbsp; &nbsp; &nbsp; AGE\ningress-nginx-controller-8544b85788-c9m2g&nbsp; &nbsp;1/1&nbsp; &nbsp; &nbsp;Running&nbsp; &nbsp; &nbsp;6 (4h35m ago)&nbsp; &nbsp;1d\n</code></pre><p>åœ¨ç¡®è®¤ Ingress æ§åˆ¶å™¨å¹¶æ— å¼‚å¸¸ä¹‹åï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ç¡®è®¤æ˜¯ Ingress ç­–ç•¥é…ç½®é”™è¯¯å¯¼è‡´çš„æ•…éšœäº†ã€‚</p><p>ä½ å¯ä»¥é€šè¿‡ kubectl describe ingress å‘½ä»¤æ¥æŸ¥çœ‹ Ingress ç­–ç•¥ã€‚</p><pre><code class=\"language-yaml\">$ kubectl describe ingress ingress_name\nName:             ingress_name\nNamespace:        default\nRules:\n  Host        Path  Backends\n  ----        ----  --------\n              /     running-service:80 (&lt;error: endpoints \"running-service\" not found&gt;)\n</code></pre><p>å¦‚æœç»“æœä¸­å‡ºç° not foundï¼Œé‚£ä¹ˆä¿®æ­£é…ç½®å³å¯ä¿®å¤ Ingress è®¿é—®çš„é—®é¢˜äº†ã€‚</p><h2>æ€»ç»“</h2><p>è¿™èŠ‚è¯¾ï¼Œæˆ‘å‘ä½ ç®€å•ä»‹ç»äº†å¯è§‚æµ‹æ€§ï¼Œå®ƒä»¬åŒ…æ‹¬æŒ‡æ ‡ã€æ—¥å¿—å’Œé“¾è·¯ã€‚ä¸è¿‡ï¼Œåœ¨å¸¦ä½ å®è·µå¯è§‚æµ‹æ€§ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£åº”ç”¨çŠ¶æ€çš„åˆ¤å®šæ ‡å‡†ä»¥åŠæ’é™¤å¸¸è§æ•…éšœçš„æ–¹æ³•ã€‚</p><p>åœ¨åˆ¤æ–­åº”ç”¨å¥åº·çŠ¶æ€æ–¹é¢ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© ArgoCD æ§åˆ¶å°çš„<strong>â€œåº”ç”¨å¥åº·â€</strong>æ¥å¿«é€Ÿäº†è§£ä¸šåŠ¡çš„å¯ç”¨æ€§ã€‚ä¸šåŠ¡åº”ç”¨å¾€å¾€æ˜¯ç”±å¾ˆå¤šä¸åŒçš„ Kubernetes å¯¹è±¡ç»„æˆçš„ï¼ŒArgoCD ä¼šå¯¹å®ƒä»¬è¿›è¡Œç»¼åˆåˆ¤æ–­å¾—åˆ°åº”ç”¨å¥åº·çŠ¶æ€ï¼Œè¿™ä½¿æˆ‘ä»¬ä¸å†éœ€è¦æ‰‹åŠ¨æŸ¥çœ‹æ¯ä¸€ä¸ªèµ„æºçš„çŠ¶æ€ã€‚</p><p>å½“åº”ç”¨å¤„äºä¸å¥åº·çš„çŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦è¿›ä¸€æ­¥æ·±å…¥åˆ° Kubernetes å¯¹è±¡ä¸­æŸ¥æ‰¾å…·ä½“çš„åŸå› äº†ã€‚</p><p>åœ¨è¿™ä¹ˆå¤šçš„å·¥ä½œè´Ÿè½½ç±»å‹ä¸­ï¼ŒPod çš„å¥åº·çŠ¶æ€æ˜¯æˆ‘ä»¬é¦–å…ˆè¦æŸ¥çœ‹çš„ã€‚å®ƒå¯èƒ½åœ¨<strong>å¯åŠ¨å’Œè¿è¡Œé˜¶æ®µ</strong>äº§ç”Ÿæ•…éšœï¼Œè¿™ä¸¤ä¸ªæ•…éšœç±»å‹çš„å…¸å‹çš„ä»£è¡¨æ˜¯ ImagePullBackOff å’Œ CrashLoopBackOffã€‚æ ¹æ®æˆ‘çš„ç”Ÿäº§ç»éªŒï¼Œè¿™ä¸¤ç§æ•…éšœå¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯é•œåƒåå’Œç‰ˆæœ¬é”™è¯¯ï¼Œæˆ–è€…ä¸šåŠ¡è¿›ç¨‹è‡ªèº«å¯åŠ¨å¼‚å¸¸å¯¼è‡´çš„ã€‚è¦æŸ¥æ‰¾å…·ä½“çš„åŸå› ï¼Œä½ åªéœ€è¦è®°ä½ä¸¤æ¡å‘½ä»¤ï¼ˆkubectl logs å’Œ kubectl describe pod ï¼‰å°±å¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†çš„åœºæ™¯äº†ã€‚</p><p>Pod çš„ Pending çŠ¶æ€åˆ™ç›¸å¯¹ç‰¹æ®Šï¼Œå®ƒå¹¶ä¸æ˜¯é”™è¯¯ï¼Œè€Œæ˜¯è°ƒåº¦å±‚é¢çš„é™åˆ¶å¯¼è‡´çš„ã€‚ä¾‹å¦‚èµ„æºé…é¢ä¸è¶³æˆ–è€…ç­‰å¾… PVC ç»‘å®šç­‰ã€‚</p><p>æœ€åï¼Œå¦‚æœ Pod å¤„äºè¿è¡Œå’Œå°±ç»ªçŠ¶æ€ï¼Œä½†æ˜¯ä»ç„¶æ— æ³•ä»é›†ç¾¤å¤–éƒ¨è®¿é—®ä¸šåŠ¡ç³»ç»Ÿï¼Œæˆ‘ä»¬å°±éœ€è¦è¿›ä¸€æ­¥æŸ¥çœ‹ Service å’Œ Ingress äº†ï¼Œè¿™ä¸€èˆ¬æ˜¯ç”±<strong>é…ç½®é”™è¯¯</strong>å¯¼è‡´çš„ã€‚é€šå¸¸ï¼Œä½ å¯ä»¥å…ˆå°† Pod è¿›è¡Œç«¯å£è½¬å‘ï¼Œå¹¶å°è¯•åœ¨æœ¬åœ°ç›´æ¥è®¿é—® Podï¼Œå¦‚æœè®¿é—®æ­£å¸¸ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿›ä¸€æ­¥æ’æŸ¥ Service å’Œ Ingress é…ç½®ï¼Œä¾‹å¦‚æŸ¥çœ‹ Service é€‰æ‹©å™¨å’Œç«¯å£é…ç½®ï¼Œä»¥åŠ Ingress æŒ‡å‘åç«¯ Service çš„é…ç½®ã€‚</p><p>åœ¨ä¸‹ä¸€èŠ‚è¯¾ï¼Œæˆ‘å°†ä¼šä»‹ç»å¯è§‚æµ‹æ€§çš„æ—¥å¿—æ–¹å‘ï¼Œå¹¶å¸¦ä½ ä»é›¶æ­å»ºä¸€ä¸ªå®æ—¶çš„æ—¥å¿—ç³»ç»Ÿã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æœ€åï¼Œç»™ä½ ç•™ä¸€é“æ€è€ƒé¢˜å§ã€‚</p><p>å¦‚ä½•åœ¨ä¸å€ŸåŠ© Ingress å¤–ç½‘ IP çš„æƒ…å†µä¸‹ï¼Œè°ƒè¯•å®Œæ•´çš„è¯·æ±‚é“¾è·¯ï¼ˆä»åŸŸå-&gt;Ingress-&gt;Service-&gt;Pod å®Œæ•´çš„é“¾è·¯ï¼‰ï¼Ÿ</p><p>æ¬¢è¿ä½ ç»™æˆ‘ç•™è¨€äº¤æµè®¨è®ºï¼Œä½ ä¹Ÿå¯ä»¥æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ã€‚</p>","comments":[{"had_liked":false,"id":368870,"user_name":"éƒ‘æµ·æˆ","can_delete":false,"product_type":"c1","uid":1192616,"ip_address":"åŒ—äº¬","ucode":"B0363EA4B2C646","user_header":"https://static001.geekbang.org/account/avatar/00/12/32/a8/d5bf5445.jpg","comment_is_top":false,"comment_ctime":1676855441,"is_pvip":true,"replies":[{"id":134340,"content":"ğŸ‘ğŸ»ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥å®ç°æš´éœ²å¯¹å¤–æš´éœ²ï¼Œmetallb çš„æ–¹æ¡ˆå¯èƒ½ä¼šæ›´å¥½ä¸€äº›ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1676861499,"ip_address":"å¹¿ä¸œ","comment_id":368870,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"æˆ‘ç†è§£é—®é¢˜å¯ä»¥è®¤ä¸ºå’Œä¸‹é¢çš„è¯´æ³•ä¸€è‡´ã€‚å¦‚ä½•åœ¨æœ¬åœ°æœºæˆ¿é€šè¿‡åŸŸåæš´éœ²æœåŠ¡?\n1.serviceå’Œpodé…ç½®æ–¹æ³•å’Œæœ‰å¤–ç½‘IPæ˜¯ä¸€æ ·çš„ï¼Œå°±ä¸é‡å¤è¯´äº†\n2.Ingressåœ¨äº‘å‚å•†ç¯å¢ƒä¸‹ä¼šæä¾›å¤–ç½‘çš„LB-VIPï¼Œåœ¨æœ¬åœ°æœºæˆ¿ç¯å¢ƒåˆ™æ²¡æœ‰ï¼Œéœ€è¦è§£å†³ä¸€ä¸‹ã€‚æ–¹æ³•æƒ³åˆ°ä¸¤ä¸ªï¼šæ–¹æ³•ä¸€ï¼ŒIngress-controllerçš„serviceç”±loadbalanceræ”¹ä¸ºnodeportï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨é›†ç¾¤nodeçš„IPæ›¿ä»£VIPï¼Œç¼ºç‚¹æ˜¯nodeportæ˜¯ä¸€ä¸ªå¤§ç«¯å£è¿˜å¯èƒ½ä¼šå˜ï¼›æ–¹æ³•äºŒï¼Œä½¿ç”¨metallbç­‰å…¶ä»–lbæ–¹æ¡ˆä¸ºIngress-controller serviceæä¾›VIPè¿™æ ·åœ¨å¤§äºŒå±‚ç½‘ç»œé€šçš„æƒ…å†µä¸‹å°±å¯ä»¥è®¿é—®äº†\n3.åŸŸåè§£æåœ¨äº‘å‚å•†ç¯å¢ƒæ˜¯é€šè¿‡å…¶æä¾›çš„DNSè§£æåˆ°LB-VIPå®ç°ï¼Œæœ¬åœ°æœºæˆ¿å¯ä»¥ä½¿ç”¨åŸºç¡€ç½‘ç»œé‡Œçš„è‡ªå»ºDNSå®ç°æˆ–è€…hostæ–‡ä»¶å®ç°","like_count":1,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":605684,"discussion_content":"ğŸ‘ğŸ»ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥å®ç°æš´éœ²å¯¹å¤–æš´éœ²ï¼Œmetallb çš„æ–¹æ¡ˆå¯èƒ½ä¼šæ›´å¥½ä¸€äº›ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1676861499,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":391566,"user_name":"DaemonLoveğŸ’¤ğŸ’¤ğŸ’¤","can_delete":false,"product_type":"c1","uid":1285473,"ip_address":"å¹¿ä¸œ","ucode":"3718D9D9F8CBEE","user_header":"https://static001.geekbang.org/account/avatar/00/13/9d/61/4c2e5e5d.jpg","comment_is_top":false,"comment_ctime":1718535439,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"å¯¹äº Service æ¥è¯´ï¼ŒArgoCD ä¼šæ£€æŸ¥ç±»å‹æ˜¯å¦ä¸º LoadBalancer ï¼Œå¹¶åˆ¤æ–­ status.loadBalancer.ingress å­—æ®µæ˜¯å¦ä¸ºç©ºï¼Œä»è€Œåˆ¤æ–­æ˜¯å¦æˆåŠŸåˆ›å»ºäº†è´Ÿè½½å‡è¡¡å™¨ã€‚è€Œå¯¹äº Ingress ï¼Œåˆ™åˆ¤æ–­ status.loadBalancer.ingress å­—æ®µæ˜¯å¦ä¸ºç©ºã€‚\nè€å¸ˆï¼Œè¯·é—®è¿™é‡Œæ˜¯ä¸æ˜¯é‡å¤äº†ï¼Ÿ\n","like_count":0}]}