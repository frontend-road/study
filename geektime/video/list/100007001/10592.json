{"id":10592,"title":"64 | Zuul网关生产最佳实践","content":"无","comments":[{"had_liked":false,"id":71807,"user_name":"丁志勇","can_delete":false,"product_type":"c3","uid":1313109,"ip_address":"","ucode":"2E537DF7061B8A","user_header":"https://static001.geekbang.org/account/avatar/00/14/09/55/2240a81a.jpg","comment_is_top":false,"comment_ctime":1551439180,"is_pvip":false,"replies":[{"id":26302,"content":"你好，网关是服务对外的一个出入口，其性能影响整个网站的稳定性，所以除了异步Servlet措施，网关上同时需要做好限流熔断。建议配合Hystrix做，通过Hystrix信号量可以实现服务限流和隔离，另外严格控制服务超时，Hystrix支持超时熔断，对于一些特别慢的服务可以单独设定超时，或者也可以考虑为特别慢的服务单独部署一套网关，这也是一种物理隔离策略，避免一小部分很慢的服务影响大部分正常服务。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1551703063,"ip_address":"","comment_id":71807,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"杨波老师，有个问题请教，zuul网关在做了异步Servlet之后，Servlet容器的线程资源释放了，但业务处理线程池的资源会因下游服务处理过慢而被占用，这样，当有大量慢服务的请求调用时，那些处理很快的服务会由于没有业务线程资源而不能得到处理，那这样是否还需要根据服务的不同而设置多种业务线程做资源隔离呢？","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441338,"discussion_content":"你好，网关是服务对外的一个出入口，其性能影响整个网站的稳定性，所以除了异步Servlet措施，网关上同时需要做好限流熔断。建议配合Hystrix做，通过Hystrix信号量可以实现服务限流和隔离，另外严格控制服务超时，Hystrix支持超时熔断，对于一些特别慢的服务可以单独设定超时，或者也可以考虑为特别慢的服务单独部署一套网关，这也是一种物理隔离策略，避免一小部分很慢的服务影响大部分正常服务。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551703063,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":37490,"user_name":"张小马","can_delete":false,"product_type":"c3","uid":1008860,"ip_address":"","ucode":"73F573011B15A7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/64/dc/3e1ad321.jpg","comment_is_top":false,"comment_ctime":1541606622,"is_pvip":false,"replies":[{"id":13629,"content":"这个是AsncServlet的一种用法，背后使用线程池，像一个队列，提交丢进去即可，不需返回，后台线程会处理请求。Callable只是后台线程要处理的一个任务，也不需返回，任务被处理时会处理http request&#47;response","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1541766270,"ip_address":"","comment_id":37490,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"波波老师，看了您的s2g源码，对于AsyncSerlvet有个小疑问，为什么调用异步线程去执行的时候使用submit+callable而不是execute+runnable呢 ?主要源码里callable也并没有返回啊，还是不需要纠结这些东西？","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428365,"discussion_content":"这个是AsncServlet的一种用法，背后使用线程池，像一个队列，提交丢进去即可，不需返回，后台线程会处理请求。Callable只是后台线程要处理的一个任务，也不需返回，任务被处理时会处理http request/response","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541766270,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":28019,"user_name":"bxov","can_delete":false,"product_type":"c3","uid":1132779,"ip_address":"","ucode":"CE9F1DBE3BA4F4","user_header":"https://static001.geekbang.org/account/avatar/00/11/48/eb/91b0b5f4.jpg","comment_is_top":false,"comment_ctime":1537976103,"is_pvip":false,"replies":[{"id":10671,"content":"可以，需注意做好压力测试和监控，如有性能问题及时优化或扩容。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1538479725,"ip_address":"","comment_id":28019,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"如果在网关上对入口和出口数据进行加密和解密有什么问题吗？","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425119,"discussion_content":"可以，需注意做好压力测试和监控，如有性能问题及时优化或扩容。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538479725,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":25947,"user_name":"kyll","can_delete":false,"product_type":"c3","uid":1103329,"ip_address":"","ucode":"2425DCF5753786","user_header":"https://static001.geekbang.org/account/avatar/00/10/d5/e1/a05a9e22.jpg","comment_is_top":false,"comment_ctime":1537487057,"is_pvip":false,"replies":[{"id":9629,"content":"谢支持🌹后面继续增加实践环节","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1537674713,"ip_address":"","comment_id":25947,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"这个最佳实践章节很喜欢","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424470,"discussion_content":"谢支持🌹后面继续增加实践环节","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537674713,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45669,"user_name":"Visual C++","can_delete":false,"product_type":"c3","uid":1110792,"ip_address":"","ucode":"5BD6FA88D65D39","user_header":"https://static001.geekbang.org/account/avatar/00/10/f3/08/66541a84.jpg","comment_is_top":false,"comment_ctime":1543742431,"is_pvip":false,"replies":[{"id":16459,"content":"可以需定制","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1543841351,"ip_address":"","comment_id":45669,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"可据于spring cloud2.x进行?对zuul网关路由动态加载","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431147,"discussion_content":"可以需定制","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543841351,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44684,"user_name":"Visual C++","can_delete":false,"product_type":"c3","uid":1110792,"ip_address":"","ucode":"5BD6FA88D65D39","user_header":"https://static001.geekbang.org/account/avatar/00/10/f3/08/66541a84.jpg","comment_is_top":false,"comment_ctime":1543475928,"is_pvip":false,"replies":[{"id":15963,"content":"zuul网关的自助路由能力，目前还没有成熟开源的，需定制自研，核心原理就是网关路由表可以由开发人员自助管理，具体实现也不是特别复杂，简单做个基于数据库的web应用，能够管理网关路由表，zuul集群定期去抓取更新这个路由表。开源产品traefik(golang实现)，这块做得较完善，有界面可自助管理路由，可参考。内部服务不暴露，如果用eureka的话，可以在app上附一些元数据（标识内外服务），然后ribbon做一些过滤。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1543492667,"ip_address":"","comment_id":44684,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"自助路由有示倒吗?对于路由，尤其是服务中心自动发现给zuul，则不足，内部服务不想通过zuul暴露,如何解决？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430815,"discussion_content":"zuul网关的自助路由能力，目前还没有成熟开源的，需定制自研，核心原理就是网关路由表可以由开发人员自助管理，具体实现也不是特别复杂，简单做个基于数据库的web应用，能够管理网关路由表，zuul集群定期去抓取更新这个路由表。开源产品traefik(golang实现)，这块做得较完善，有界面可自助管理路由，可参考。内部服务不暴露，如果用eureka的话，可以在app上附一些元数据（标识内外服务），然后ribbon做一些过滤。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543492667,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1000015,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/4f/ff1ac464.jpg","nickname":"又双叒叕是一年啊","note":"","ucode":"E067320E537DEE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":692,"discussion_content":"波波老师这块为啥还要自己维护开发一套路由表 直接用Apollo配置中心配置不行？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561965523,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}