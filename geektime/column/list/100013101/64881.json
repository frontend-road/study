{"id":64881,"title":"39 | bytesåŒ…ä¸å­—èŠ‚ä¸²æ“ä½œï¼ˆä¸‹ï¼‰","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯éƒæ—ï¼Œä»Šå¤©æˆ‘ä»¬ç»§ç»­åˆ†äº«bytesåŒ…ä¸å­—èŠ‚ä¸²æ“ä½œçš„ç›¸å…³å†…å®¹ã€‚</p><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬åˆ†äº«äº†<code>bytes.Buffer</code>ä¸­å·²è¯»è®¡æ•°çš„å¤§è‡´åŠŸç”¨ï¼Œå¹¶å›´ç»•ç€è¿™ä¸ªé—®é¢˜åšäº†è§£æï¼Œä¸‹é¢æˆ‘ä»¬æ¥è¿›è¡Œç›¸å…³çš„çŸ¥è¯†æ‰©å±•ã€‚</p><h2>çŸ¥è¯†æ‰©å±•</h2><h3>é—®é¢˜ 1ï¼š<code>bytes.Buffer</code>çš„æ‰©å®¹ç­–ç•¥æ˜¯æ€æ ·çš„ï¼Ÿ</h3><p><code>Buffer</code>å€¼æ—¢å¯ä»¥è¢«æ‰‹åŠ¨æ‰©å®¹ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œè‡ªåŠ¨æ‰©å®¹ã€‚å¹¶ä¸”ï¼Œè¿™ä¸¤ç§æ‰©å®¹æ–¹å¼çš„ç­–ç•¥æ˜¯åŸºæœ¬ä¸€è‡´çš„ã€‚æ‰€ä»¥ï¼Œé™¤éæˆ‘ä»¬å®Œå…¨ç¡®å®šåç»­å†…å®¹æ‰€éœ€çš„å­—èŠ‚æ•°ï¼Œå¦åˆ™è®©<code>Buffer</code>å€¼è‡ªåŠ¨å»æ‰©å®¹å°±å¥½äº†ã€‚</p><p>åœ¨æ‰©å®¹çš„æ—¶å€™ï¼Œ<code>Buffer</code>å€¼ä¸­ç›¸åº”çš„ä»£ç ï¼ˆä»¥ä¸‹ç®€ç§°æ‰©å®¹ä»£ç ï¼‰ä¼š<strong>å…ˆåˆ¤æ–­å†…å®¹å®¹å™¨çš„å‰©ä½™å®¹é‡</strong>ï¼Œæ˜¯å¦å¯ä»¥æ»¡è¶³è°ƒç”¨æ–¹çš„è¦æ±‚ï¼Œæˆ–è€…æ˜¯å¦è¶³å¤Ÿå®¹çº³æ–°çš„å†…å®¹ã€‚</p><p><strong>å¦‚æœå¯ä»¥ï¼Œé‚£ä¹ˆæ‰©å®¹ä»£ç ä¼šåœ¨å½“å‰çš„å†…å®¹å®¹å™¨ä¹‹ä¸Šï¼Œè¿›è¡Œé•¿åº¦æ‰©å……ã€‚</strong></p><p>æ›´å…·ä½“åœ°è¯´ï¼Œå¦‚æœå†…å®¹å®¹å™¨çš„å®¹é‡ä¸å…¶é•¿åº¦çš„å·®ï¼Œå¤§äºæˆ–ç­‰äºå¦éœ€çš„å­—èŠ‚æ•°ï¼Œé‚£ä¹ˆæ‰©å®¹ä»£ç å°±ä¼šé€šè¿‡åˆ‡ç‰‡æ“ä½œå¯¹åŸæœ‰çš„å†…å®¹å®¹å™¨çš„é•¿åº¦è¿›è¡Œæ‰©å……ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š</p><pre><code>b.buf = b.buf[:length+need]\n</code></pre><p><strong>åä¹‹ï¼Œå¦‚æœå†…å®¹å®¹å™¨çš„å‰©ä½™å®¹é‡ä¸å¤Ÿäº†ï¼Œé‚£ä¹ˆæ‰©å®¹ä»£ç å¯èƒ½å°±ä¼šç”¨æ–°çš„å†…å®¹å®¹å™¨å»æ›¿ä»£åŸæœ‰çš„å†…å®¹å®¹å™¨ï¼Œä»è€Œå®ç°æ‰©å®¹ã€‚</strong></p><p>ä¸è¿‡ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€æ­¥ä¼˜åŒ–ã€‚</p><p><strong>å¦‚æœå½“å‰å†…å®¹å®¹å™¨çš„å®¹é‡çš„ä¸€åŠï¼Œä»ç„¶å¤§äºæˆ–ç­‰äºå…¶ç°æœ‰é•¿åº¦ï¼ˆå³æœªè¯»å­—èŠ‚æ•°ï¼‰å†åŠ ä¸Šå¦éœ€çš„å­—èŠ‚æ•°çš„å’Œ</strong>ï¼Œå³ï¼š</p><!-- [[[read_end]]] --><pre><code>cap(b.buf)/2 &gt;= b.Len() + need\n</code></pre><p>é‚£ä¹ˆï¼Œæ‰©å®¹ä»£ç å°±ä¼šå¤ç”¨ç°æœ‰çš„å†…å®¹å®¹å™¨ï¼Œå¹¶æŠŠå®¹å™¨ä¸­çš„æœªè¯»å†…å®¹æ‹·è´åˆ°å®ƒçš„å¤´éƒ¨ä½ç½®ã€‚</p><p>è¿™ä¹Ÿæ„å‘³ç€å…¶ä¸­çš„å·²è¯»å†…å®¹ï¼Œå°†ä¼šå…¨éƒ¨è¢«æœªè¯»å†…å®¹å’Œä¹‹åçš„æ–°å†…å®¹è¦†ç›–æ‰ã€‚</p><p>è¿™æ ·çš„å¤ç”¨é¢„è®¡å¯ä»¥è‡³å°‘èŠ‚çœæ‰ä¸€æ¬¡åç»­çš„æ‰©å®¹æ‰€å¸¦æ¥çš„å†…å­˜åˆ†é…ï¼Œä»¥åŠè‹¥å¹²å­—èŠ‚çš„æ‹·è´ã€‚</p><p><strong>è‹¥è¿™ä¸€æ­¥ä¼˜åŒ–æœªèƒ½è¾¾æˆ</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å‰å†…å®¹å®¹å™¨çš„å®¹é‡å°äºæ–°é•¿åº¦çš„äºŒå€ã€‚</p><p>é‚£ä¹ˆï¼Œæ‰©å®¹ä»£ç å°±åªèƒ½å†åˆ›å»ºä¸€ä¸ªæ–°çš„å†…å®¹å®¹å™¨ï¼Œå¹¶æŠŠåŸæœ‰å®¹å™¨ä¸­çš„æœªè¯»å†…å®¹æ‹·è´è¿›å»ï¼Œæœ€åå†ç”¨æ–°çš„å®¹å™¨æ›¿æ¢æ‰åŸæœ‰çš„å®¹å™¨ã€‚è¿™ä¸ªæ–°å®¹å™¨çš„å®¹é‡å°†ä¼šç­‰äºåŸæœ‰å®¹é‡çš„äºŒå€å†åŠ ä¸Šå¦éœ€å­—èŠ‚æ•°çš„å’Œã€‚</p><blockquote>\n<p>æ–°å®¹å™¨çš„å®¹é‡=2*åŸæœ‰å®¹é‡+æ‰€éœ€å­—èŠ‚æ•°</p>\n</blockquote><p>é€šè¿‡ä¸Šé¢è¿™äº›æ­¥éª¤ï¼Œå¯¹å†…å®¹å®¹å™¨çš„æ‰©å……åŸºæœ¬ä¸Šå°±å®Œæˆäº†ã€‚ä¸è¿‡ï¼Œä¸ºäº†å†…éƒ¨æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä»¥åŠé¿å…åŸæœ‰çš„å·²è¯»å†…å®¹å¯èƒ½é€ æˆçš„æ•°æ®æ··ä¹±ï¼Œæ‰©å®¹ä»£ç è¿˜ä¼šæŠŠå·²è¯»è®¡æ•°ç½®ä¸º<code>0</code>ï¼Œå¹¶å†å¯¹å†…å®¹å®¹å™¨åšä¸€ä¸‹åˆ‡ç‰‡æ“ä½œï¼Œä»¥æ©ç›–æ‰åŸæœ‰çš„å·²è¯»å†…å®¹ã€‚</p><p>é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œå¯¹äºå¤„åœ¨é›¶å€¼çŠ¶æ€çš„<code>Buffer</code>å€¼æ¥è¯´ï¼Œå¦‚æœç¬¬ä¸€æ¬¡æ‰©å®¹æ—¶çš„å¦éœ€å­—èŠ‚æ•°ä¸å¤§äº<code>64</code>ï¼Œé‚£ä¹ˆè¯¥å€¼å°±ä¼šåŸºäºä¸€ä¸ªé¢„å…ˆå®šä¹‰å¥½çš„ã€é•¿åº¦ä¸º<code>64</code>çš„å­—èŠ‚æ•°ç»„æ¥åˆ›å»ºå†…å®¹å®¹å™¨ã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå†…å®¹å®¹å™¨çš„å®¹é‡å°±æ˜¯<code>64</code>ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†è®©<code>Buffer</code>å€¼åœ¨åˆšè¢«çœŸæ­£ä½¿ç”¨çš„æ—¶å€™å°±å¯ä»¥å¿«é€Ÿåœ°åšå¥½å‡†å¤‡ã€‚</p><h3>é—®é¢˜2ï¼š<code>bytes.Buffer</code>ä¸­çš„å“ªäº›æ–¹æ³•å¯èƒ½ä¼šé€ æˆå†…å®¹çš„æ³„éœ²ï¼Ÿ</h3><p>é¦–å…ˆæ˜ç¡®ä¸€ç‚¹ï¼Œä»€ä¹ˆå«å†…å®¹æ³„éœ²ï¼Ÿè¿™é‡Œæ‰€è¯´çš„å†…å®¹æ³„éœ²æ˜¯æŒ‡ï¼Œä½¿ç”¨<code>Buffer</code>å€¼çš„ä¸€æ–¹é€šè¿‡æŸç§éæ ‡å‡†çš„ï¼ˆæˆ–è€…è¯´ä¸æ­£å¼çš„ï¼‰æ–¹å¼ï¼Œå¾—åˆ°äº†æœ¬ä¸è¯¥å¾—åˆ°çš„å†…å®¹ã€‚</p><p>æ¯”å¦‚è¯´ï¼Œæˆ‘é€šè¿‡è°ƒç”¨<code>Buffer</code>å€¼çš„æŸä¸ªç”¨äºè¯»å–å†…å®¹çš„æ–¹æ³•ï¼Œå¾—åˆ°äº†ä¸€éƒ¨åˆ†æœªè¯»å†…å®¹ã€‚æˆ‘åº”è¯¥ï¼Œä¹Ÿåªåº”è¯¥é€šè¿‡è¿™ä¸ªæ–¹æ³•çš„ç»“æœå€¼ï¼Œæ‹¿åˆ°åœ¨é‚£ä¸€æ—¶åˆ»<code>Buffer</code>å€¼ä¸­çš„æœªè¯»å†…å®¹ã€‚</p><p>ä½†æ˜¯ï¼Œåœ¨è¿™ä¸ª<code>Buffer</code>å€¼åˆæœ‰äº†ä¸€äº›æ–°å†…å®¹ä¹‹åï¼Œæˆ‘å´å¯ä»¥é€šè¿‡å½“æ—¶å¾—åˆ°çš„ç»“æœå€¼ï¼Œç›´æ¥è·å¾—æ–°çš„å†…å®¹ï¼Œè€Œä¸éœ€è¦å†æ¬¡è°ƒç”¨ç›¸åº”çš„æ–¹æ³•ã€‚</p><p>è¿™å°±æ˜¯å…¸å‹çš„éæ ‡å‡†è¯»å–æ–¹å¼ã€‚è¿™ç§è¯»å–æ–¹å¼æ˜¯ä¸åº”è¯¥å­˜åœ¨çš„ï¼Œå³ä½¿å­˜åœ¨ï¼Œæˆ‘ä»¬ä¹Ÿä¸åº”è¯¥ä½¿ç”¨ã€‚å› ä¸ºå®ƒæ˜¯åœ¨æ— æ„ä¸­ï¼ˆæˆ–è€…è¯´ä¸€ä¸å°å¿ƒï¼‰æš´éœ²å‡ºæ¥çš„ï¼Œå…¶è¡Œä¸ºå¾ˆå¯èƒ½æ˜¯ä¸ç¨³å®šçš„ã€‚</p><p>åœ¨<code>bytes.Buffer</code>ä¸­ï¼Œ<code>Bytes</code>æ–¹æ³•å’Œ<code>Next</code>æ–¹æ³•éƒ½å¯èƒ½ä¼šé€ æˆå†…å®¹çš„æ³„éœ²ã€‚åŸå› åœ¨äºï¼Œå®ƒä»¬éƒ½æŠŠåŸºäºå†…å®¹å®¹å™¨çš„åˆ‡ç‰‡ç›´æ¥è¿”å›ç»™äº†æ–¹æ³•çš„è°ƒç”¨æ–¹ã€‚</p><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œé€šè¿‡åˆ‡ç‰‡ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è®¿é—®å’Œæ“çºµå®ƒçš„åº•å±‚æ•°ç»„ã€‚ä¸è®ºè¿™ä¸ªåˆ‡ç‰‡æ˜¯åŸºäºæŸä¸ªæ•°ç»„å¾—æ¥çš„ï¼Œè¿˜æ˜¯é€šè¿‡å¯¹å¦ä¸€ä¸ªåˆ‡ç‰‡åšåˆ‡ç‰‡æ“ä½œè·å¾—çš„ï¼Œéƒ½æ˜¯å¦‚æ­¤ã€‚</p><p>åœ¨è¿™é‡Œï¼Œ<code>Bytes</code>æ–¹æ³•å’Œ<code>Next</code>æ–¹æ³•è¿”å›çš„å­—èŠ‚åˆ‡ç‰‡ï¼Œéƒ½æ˜¯é€šè¿‡å¯¹å†…å®¹å®¹å™¨åšåˆ‡ç‰‡æ“ä½œå¾—åˆ°çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬ä¸å†…å®¹å®¹å™¨å…±ç”¨äº†åŒä¸€ä¸ªåº•å±‚æ•°ç»„ï¼Œèµ·ç åœ¨ä¸€æ®µæ—¶æœŸä¹‹å†…æ˜¯è¿™æ ·çš„ã€‚</p><p>ä»¥<code>Bytes</code>æ–¹æ³•ä¸ºä¾‹ã€‚å®ƒä¼šè¿”å›åœ¨è°ƒç”¨é‚£ä¸€åˆ»å…¶æ‰€å±å€¼ä¸­çš„æ‰€æœ‰æœªè¯»å†…å®¹ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>contents := &quot;ab&quot;\nbuffer1 := bytes.NewBufferString(contents)\nfmt.Printf(&quot;The capacity of new buffer with contents %q: %d\\n&quot;,\n contents, buffer1.Cap()) // å†…å®¹å®¹å™¨çš„å®¹é‡ä¸ºï¼š8ã€‚\nunreadBytes := buffer1.Bytes()\nfmt.Printf(&quot;The unread bytes of the buffer: %v\\n&quot;, unreadBytes) // æœªè¯»å†…å®¹ä¸ºï¼š[97 98]ã€‚\n</code></pre><p>æˆ‘ç”¨å­—ç¬¦ä¸²å€¼<code>\"ab\"</code>åˆå§‹åŒ–äº†ä¸€ä¸ª<code>Buffer</code>å€¼ï¼Œç”±å˜é‡<code>buffer1</code>ä»£è¡¨ï¼Œå¹¶æ‰“å°äº†å½“æ—¶è¯¥å€¼çš„ä¸€äº›çŠ¶æ€ã€‚</p><p>ä½ å¯èƒ½ä¼šæœ‰ç–‘æƒ‘ï¼Œæˆ‘åªåœ¨è¿™ä¸ª<code>Buffer</code>å€¼ä¸­æ”¾å…¥äº†ä¸€ä¸ªé•¿åº¦ä¸º<code>2</code>çš„å­—ç¬¦ä¸²å€¼ï¼Œä½†ä¸ºä»€ä¹ˆè¯¥å€¼çš„å®¹é‡å´å˜ä¸ºäº†<code>8</code>ã€‚</p><p>è™½ç„¶è¿™ä¸æˆ‘ä»¬å½“å‰çš„ä¸»é¢˜æ— å…³ï¼Œä½†æ˜¯æˆ‘å¯ä»¥æç¤ºä½ ä¸€ä¸‹ï¼šä½ å¯ä»¥å»é˜…è¯»<code>runtime</code>åŒ…ä¸­ä¸€ä¸ªåå«<code>stringtoslicebyte</code>çš„å‡½æ•°ï¼Œç­”æ¡ˆå°±åœ¨å…¶ä¸­ã€‚</p><p>æ¥ç€è¯´<code>buffer1</code>ã€‚æˆ‘åˆå‘è¯¥å€¼å†™å…¥äº†å­—ç¬¦ä¸²å€¼<code>\"cdefg\"</code>ï¼Œæ­¤æ—¶ï¼Œå…¶å®¹é‡ä»ç„¶æ˜¯<code>8</code>ã€‚æˆ‘åœ¨å‰é¢é€šè¿‡è°ƒç”¨<code>buffer1</code>çš„<code>Bytes</code>æ–¹æ³•å¾—åˆ°çš„ç»“æœå€¼<code>unreadBytes</code>ï¼ŒåŒ…å«äº†åœ¨é‚£æ—¶å…¶ä¸­çš„æ‰€æœ‰æœªè¯»å†…å®¹ã€‚</p><p>ä½†æ˜¯ï¼Œç”±äºè¿™ä¸ªç»“æœå€¼ä¸<code>buffer1</code>çš„å†…å®¹å®¹å™¨åœ¨æ­¤æ—¶è¿˜å…±ç”¨ç€åŒä¸€ä¸ªåº•å±‚æ•°ç»„ï¼Œæ‰€ä»¥ï¼Œæˆ‘åªéœ€é€šè¿‡ç®€å•çš„å†åˆ‡ç‰‡æ“ä½œï¼Œå°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªç»“æœå€¼æ‹¿åˆ°<code>buffer1</code>åœ¨æ­¤æ—¶çš„æ‰€æœ‰æœªè¯»å†…å®¹ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œ<code>buffer1</code>çš„æ–°å†…å®¹å°±è¢«æ³„éœ²å‡ºæ¥äº†ã€‚</p><pre><code>buffer1.WriteString(&quot;cdefg&quot;)\nfmt.Printf(&quot;The capacity of buffer: %d\\n&quot;, buffer1.Cap()) // å†…å®¹å®¹å™¨çš„å®¹é‡ä»ä¸ºï¼š8ã€‚\nunreadBytes = unreadBytes[:cap(unreadBytes)]\nfmt.Printf(&quot;The unread bytes of the buffer: %v\\n&quot;, unreadBytes) // åŸºäºå‰é¢è·å–åˆ°çš„ç»“æœå€¼å¯å¾—ï¼Œæœªè¯»å†…å®¹ä¸ºï¼š[97 98 99 100 101 102 103 0]ã€‚\n</code></pre><p>å¦‚æœæˆ‘å½“æ—¶æŠŠ<code>unreadBytes</code>çš„å€¼ä¼ åˆ°äº†å¤–ç•Œï¼Œé‚£ä¹ˆå¤–ç•Œå°±å¯ä»¥é€šè¿‡è¯¥å€¼æ“çºµ<code>buffer1</code>çš„å†…å®¹äº†ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š</p><pre><code>unreadBytes[len(unreadBytes)-2] = byte('X') // 'X'çš„ASCIIç¼–ç ä¸º88ã€‚\nfmt.Printf(&quot;The unread bytes of the buffer: %v\\n&quot;, buffer1.Bytes()) // æœªè¯»å†…å®¹å˜ä¸ºäº†ï¼š[97 98 99 100 101 102 88]ã€‚\n</code></pre><p>ç°åœ¨ï¼Œä½ åº”è¯¥èƒ½å¤Ÿä½“ä¼šåˆ°ï¼Œè¿™é‡Œçš„å†…å®¹æ³„éœ²å¯èƒ½é€ æˆçš„ä¸¥é‡åæœäº†å§ï¼Ÿå¯¹äº<code>Buffer</code>å€¼çš„<code>Next</code>æ–¹æ³•ï¼Œä¹Ÿå­˜åœ¨ç›¸åŒçš„é—®é¢˜ã€‚</p><p>ä¸è¿‡ï¼Œå¦‚æœç»è¿‡æ‰©å®¹ï¼Œ<code>Buffer</code>å€¼çš„å†…å®¹å®¹å™¨æˆ–è€…å®ƒçš„åº•å±‚æ•°ç»„è¢«é‡æ–°è®¾å®šäº†ï¼Œé‚£ä¹ˆä¹‹å‰çš„å†…å®¹æ³„éœ²é—®é¢˜å°±æ— æ³•å†è¿›ä¸€æ­¥å‘å±•äº†ã€‚æˆ‘åœ¨demo80.goæ–‡ä»¶ä¸­å†™äº†ä¸€ä¸ªæ¯”è¾ƒå®Œæ•´çš„ç¤ºä¾‹ï¼Œä½ å¯ä»¥å»çœ‹ä¸€çœ‹ï¼Œå¹¶æ£æ‘©ä¸€ä¸‹ã€‚</p><h2>æ€»ç»“</h2><p>æˆ‘ä»¬ç»“åˆä¸¤ç¯‡å†…å®¹æ€»ç»“ä¸€ä¸‹ã€‚ä¸<code>strings.Builder</code>ç±»å‹ä¸åŒï¼Œ<code>bytes.Buffer</code>ä¸ä½†å¯ä»¥æ‹¼æ¥ã€æˆªæ–­å…¶ä¸­çš„å­—èŠ‚åºåˆ—ï¼Œä»¥å„ç§å½¢å¼å¯¼å‡ºå…¶ä¸­çš„å†…å®¹ï¼Œè¿˜å¯ä»¥é¡ºåºåœ°è¯»å–å…¶ä¸­çš„å­åºåˆ—ã€‚</p><p><code>bytes.Buffer</code>ç±»å‹ä½¿ç”¨å­—èŠ‚åˆ‡ç‰‡ä½œä¸ºå…¶å†…å®¹å®¹å™¨ï¼Œå¹¶ä¸”ä¼šç”¨ä¸€ä¸ªå­—æ®µå®æ—¶åœ°è®°å½•å·²è¯»å­—èŠ‚çš„è®¡æ•°ã€‚</p><p>è™½ç„¶æˆ‘ä»¬æ— æ³•ç›´æ¥è®¡ç®—å‡ºè¿™ä¸ªå·²è¯»è®¡æ•°ï¼Œä½†æ˜¯ç”±äºå®ƒåœ¨<code>Buffer</code>å€¼ä¸­èµ·åˆ°çš„ä½œç”¨éå¸¸å…³é”®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾ˆæœ‰å¿…è¦å»ç†è§£å®ƒã€‚</p><p>æ— è®ºæ˜¯è¯»å–ã€å†™å…¥ã€æˆªæ–­ã€å¯¼å‡ºè¿˜æ˜¯é‡ç½®ï¼Œå·²è¯»è®¡æ•°éƒ½æ˜¯åŠŸèƒ½å®ç°ä¸­çš„é‡è¦ä¸€ç¯ã€‚</p><p>ä¸<code>strings.Builder</code>ç±»å‹çš„å€¼ä¸€æ ·ï¼Œ<code>Buffer</code>å€¼æ—¢å¯ä»¥è¢«æ‰‹åŠ¨æ‰©å®¹ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œè‡ªåŠ¨çš„æ‰©å®¹ã€‚é™¤éæˆ‘ä»¬å®Œå…¨ç¡®å®šåç»­å†…å®¹æ‰€éœ€çš„å­—èŠ‚æ•°ï¼Œå¦åˆ™è®©<code>Buffer</code>å€¼è‡ªåŠ¨å»æ‰©å®¹å°±å¥½äº†ã€‚</p><p><code>Buffer</code>å€¼çš„æ‰©å®¹æ–¹æ³•å¹¶ä¸ä¸€å®šä¼šä¸ºäº†è·å¾—æ›´å¤§çš„å®¹é‡ï¼Œæ›¿æ¢æ‰ç°æœ‰çš„å†…å®¹å®¹å™¨ï¼Œè€Œæ˜¯å…ˆä¼šæœ¬ç€å°½é‡å‡å°‘å†…å­˜åˆ†é…å’Œå†…å®¹æ‹·è´çš„åŸåˆ™ï¼Œå¯¹å½“å‰çš„å†…å®¹å®¹å™¨è¿›è¡Œé‡ç”¨ã€‚å¹¶ä¸”ï¼Œåªæœ‰åœ¨å®¹é‡å®åœ¨æ— æ³•æ»¡è¶³è¦æ±‚çš„æ—¶å€™ï¼Œå®ƒæ‰ä¼šå»åˆ›å»ºæ–°çš„å†…å®¹å®¹å™¨ã€‚</p><p>æ­¤å¤–ï¼Œä½ å¯èƒ½å¹¶æ²¡æœ‰æƒ³åˆ°ï¼Œ<code>Buffer</code>å€¼çš„æŸäº›æ–¹æ³•å¯èƒ½ä¼šé€ æˆå†…å®¹çš„æ³„éœ²ã€‚è¿™ä¸»è¦æ˜¯ç”±äºè¿™äº›æ–¹æ³•è¿”å›çš„ç»“æœå€¼ï¼Œåœ¨ä¸€æ®µæ—¶æœŸå†…ä¼šä¸å…¶æ‰€å±å€¼çš„å†…å®¹å®¹å™¨å…±ç”¨åŒä¸€ä¸ªåº•å±‚æ•°ç»„ã€‚</p><p><strong>å¦‚æœæˆ‘ä»¬æœ‰æ„æˆ–æ— æ„åœ°æŠŠè¿™äº›ç»“æœå€¼ä¼ åˆ°äº†å¤–ç•Œï¼Œé‚£ä¹ˆå¤–ç•Œå°±æœ‰å¯èƒ½é€šè¿‡å®ƒä»¬æ“çºµç›¸å…³è”<code>Buffer</code>å€¼çš„å†…å®¹ã€‚</strong></p><p>è¿™å±äºå¾ˆä¸¥é‡çš„æ•°æ®å®‰å…¨é—®é¢˜ã€‚æˆ‘ä»¬ä¸€å®šè¦é¿å…è¿™ç§æƒ…å†µçš„å‘ç”Ÿã€‚æœ€å½»åº•çš„åšæ³•æ˜¯ï¼Œåœ¨ä¼ å‡ºåˆ‡ç‰‡è¿™ç±»å€¼ä¹‹å‰è¦åšå¥½éš”ç¦»ã€‚æ¯”å¦‚ï¼Œå…ˆå¯¹å®ƒä»¬è¿›è¡Œæ·±åº¦æ‹·è´ï¼Œç„¶åå†æŠŠå‰¯æœ¬ä¼ å‡ºå»ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>ä»Šå¤©çš„æ€è€ƒé¢˜æ˜¯ï¼šå¯¹æ¯”<code>strings.Builder</code>å’Œ<code>bytes.Buffer</code>çš„<code>String</code>æ–¹æ³•ï¼Œå¹¶åˆ¤æ–­å“ªä¸€ä¸ªæ›´é«˜æ•ˆï¼ŸåŸå› æ˜¯ä»€ä¹ˆï¼Ÿ</p><p><a href=\"https://github.com/hyper0x/Golang_Puzzlers\">æˆ³æ­¤æŸ¥çœ‹Goè¯­è¨€ä¸“æ æ–‡ç« é…å¥—è¯¦ç»†ä»£ç ã€‚</a></p>","comments":[{"had_liked":false,"id":38092,"user_name":"å¤±äº†æ™ºçš„æ²«é›¨","can_delete":false,"product_type":"c1","uid":1199282,"ip_address":"","ucode":"59CB2A90BB1EC7","user_header":"https://static001.geekbang.org/account/avatar/00/12/4c/b2/74519a7c.jpg","comment_is_top":false,"comment_ctime":1541931265,"is_pvip":true,"discussion_count":3,"race_medal":0,"score":"126095982849","product_id":100013101,"comment_content":"å¦‚æœåªçœ‹strings.Builder å’Œbytes.Bufferçš„Stringæ–¹æ³•çš„è¯ï¼Œstrings.Builder æ›´é«˜æ•ˆä¸€äº›ã€‚<br>æˆ‘ä»¬å¯ä»¥ç›´æ¥æŸ¥çœ‹ä¸¤ä¸ªStringæ–¹æ³•çš„æºä»£ç ï¼Œå…¶ä¸­strings.Builder Stringæ–¹æ³•ä¸­<br>*(*string)(unsafe.Pointer(&amp;b.buf))  æ˜¯ç›´æ¥å–å¾—bufçš„åœ°å€ç„¶åè½¬æ¢æˆstringè¿”å›ã€‚<br>è€Œbytes.Bufferçš„Stringæ–¹æ³•æ˜¯   string(b.buf[b.off:])<br> å¯¹buf è¿›è¡Œåˆ‡ç‰‡æ“ä½œ,æˆ‘è®¤ä¸ºè¿™æ¯”ç›´æ¥å–å€è¦èŠ±è´¹æ›´å¤šçš„æ—¶é—´ã€‚<br>æµ‹è¯•å‡½æ•°:<br>func BenchmarkStrings(b *testing.B) {<br>\tstr := strings.Builder{}&#47;bytes.Buffer{}<br>\tstr.WriteString(&quot;test&quot;)<br>\tfor i := 0; i &lt; b.N; i++ {<br>\t\tstr.String()<br>\t}<br>}<br>ç»“æœä¸º<br>BenchmarkStrings-8   \t2000000000\t         0.66 ns&#47;op<br>BenchmarkBuffer-8    \t300000000\t         5.64 ns&#47;op<br>æ‰€ä»¥strings.Builderçš„Stringæ–¹æ³•æ›´é«˜æ•ˆ","like_count":30,"discussions":[{"author":{"id":1233748,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/peVXJxibHW5xicV0o87BniaV31KSDaT9SibhQd1VH1lpgmwc77nezp81n3amCzjYhT5jOpw6sfOxXGajzyL1cZjeZw/132","nickname":"Jo","note":"","ucode":"0EF4D66963C112","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":40341,"discussion_content":"string(b.buf[b.off:])ï¼Œè¿™ä¸ªæ˜¯æ·±æ‹·è´ï¼Œstring()æ“ä½œæ–°å»ºäº†ä¸€ä¸ªåº•å±‚æ•°ç»„ï¼Œç„¶åå°†b.bufçš„å†…å®¹æ‹·è´åˆ°æ–°æ•°ç»„ã€‚è€Œstringsçš„æ–¹æ³•æ˜¯æµ…æ‹·è´ï¼Œæ‰€ä»¥æ€§èƒ½ä¼šæ›´é«˜","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1572169841,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":2875604,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/e0/d4/63647ae9.jpg","nickname":"ç¬¦ä½³æˆfjc","note":"","ucode":"DAC86F7BBF8085","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1233748,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/peVXJxibHW5xicV0o87BniaV31KSDaT9SibhQd1VH1lpgmwc77nezp81n3amCzjYhT5jOpw6sfOxXGajzyL1cZjeZw/132","nickname":"Jo","note":"","ucode":"0EF4D66963C112","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544805,"discussion_content":"åˆ«çè¯´","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641720049,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":40341,"ip_address":""},"score":544805,"extra":""},{"author":{"id":2551927,"avatar":"https://static001.geekbang.org/account/avatar/00/26/f0/77/992c5a39.jpg","nickname":"breeze","note":"","ucode":"2432C3C79A6CD7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1233748,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/peVXJxibHW5xicV0o87BniaV31KSDaT9SibhQd1VH1lpgmwc77nezp81n3amCzjYhT5jOpw6sfOxXGajzyL1cZjeZw/132","nickname":"Jo","note":"","ucode":"0EF4D66963C112","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":564152,"discussion_content":"è¿™æ‹·è´ä¸ªå¯„å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650170409,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":40341,"ip_address":""},"score":564152,"extra":""}]}]},{"had_liked":false,"id":89864,"user_name":"ğŸ»","can_delete":false,"product_type":"c1","uid":1043072,"ip_address":"","ucode":"534EDAD496A0E6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ea/80/8759e4c1.jpg","comment_is_top":false,"comment_ctime":1556288266,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23031124746","product_id":100013101,"comment_content":"https:&#47;&#47;github.com&#47;golang&#47;go&#47;blob&#47;master&#47;src&#47;strings&#47;builder_test.go#L319-L366<br><br>å‘ç°æœ€åçš„é—®é¢˜ï¼ŒGo çš„æ ‡å‡†åº“ä¸­ï¼Œå·²ç»ç»™å‡ºäº†ç›¸å…³çš„æµ‹è¯•ä»£ç äº†ã€‚","like_count":6},{"had_liked":false,"id":39675,"user_name":"1thinc0","can_delete":false,"product_type":"c1","uid":1239533,"ip_address":"","ucode":"943DBBF650793A","user_header":"https://static001.geekbang.org/account/avatar/00/12/e9/ed/daa94663.jpg","comment_is_top":false,"comment_ctime":1542334651,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18722203835","product_id":100013101,"comment_content":"bytes.Buffer å€¼çš„ String() æ–¹æ³•åœ¨è½¬æ¢æ—¶é‡‡ç”¨äº†æŒ‡é’ˆ *(*string)(unsafe.Pointer(&amp;b.buf))ï¼Œæ›´èŠ‚çœæ—¶é—´å’Œå†…å­˜","like_count":5},{"had_liked":false,"id":224615,"user_name":"Geek_51aa7f","can_delete":false,"product_type":"c1","uid":2029348,"ip_address":"","ucode":"B92E2C36923EB8","user_header":"","comment_is_top":false,"comment_ctime":1591471036,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14476372924","product_id":100013101,"comment_content":"åœ¨Byte()æˆ–è€…Next()ç»“æœè¿”å›çš„å­—èŠ‚åˆ‡ç‰‡å¤„ç†åæ‰å¯ä»¥è¿”å›ç»™å¤–éƒ¨å‡½æ•°<br>unreadBytes = unreadBytes[:len(unreadBytes):len(unreadBytes)]","like_count":3},{"had_liked":false,"id":37798,"user_name":"éªJero","can_delete":false,"product_type":"c1","uid":1133122,"ip_address":"","ucode":"C0D505B088275E","user_header":"https://static001.geekbang.org/account/avatar/00/11/4a/42/b2c7dd30.jpg","comment_is_top":false,"comment_ctime":1541729919,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14426631807","product_id":100013101,"comment_content":"è¯»äº†è€å¸ˆçš„ä¸¤ç¯‡æ–‡ç« ï¼Œstrings.Builderæ›´å¤šæ˜¯æ‹¼æ¥æ•°æ®å’Œä»¥åŠæ‹¼æ¥å®Œæˆåçš„è¯»å–ä½¿ç”¨ä¸Šåº”è¯¥æ›´é€‚åˆã€‚è€Œbufferæ›´ä¸ºåŠ¨æ€æ¥å—å’Œè¯»å–æ•°æ®æ—¶ï¼Œæ›´ä¸ºé«˜æ•ˆã€‚","like_count":3},{"had_liked":false,"id":38529,"user_name":"cygnus","can_delete":false,"product_type":"c1","uid":1120452,"ip_address":"","ucode":"C60A86E3084754","user_header":"https://static001.geekbang.org/account/avatar/00/11/18/c4/e55fdc1c.jpg","comment_is_top":false,"comment_ctime":1542071543,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10132006135","product_id":100013101,"comment_content":"```<br>func (b *Buffer) grow(n int) int {<br>        ......<br>\t&#47;&#47; Restore b.off and len(b.buf).<br>\tb.off = 0<br>\tb.buf = b.buf[:m+n]<br>\treturn m<br><br>func (b *Buffer) Grow(n int) {<br>\tif n &lt; 0 {<br>\t\tpanic(&quot;bytes.Buffer.Grow: negative count&quot;)<br>\t}<br>\tm := b.grow(n)<br>\tb.buf = b.buf[:m]<br>}<br>```<br>è¯·é—®ä¸‹è€å¸ˆï¼Œbytes.Bufferé‡Œgrowå‡½æ•°è¿”å›å‰åšè¿‡ä¸€æ¬¡åˆ‡ç‰‡b.buf = b.buf[:m+n]ï¼Œè¿”å›ååœ¨Growå‡½æ•°åˆåšäº†ä¸€æ¬¡åˆ‡ç‰‡b.buf = b.buf[:m]ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ„Ÿè§‰æœ‰ç‚¹å†—ä½™","like_count":2,"discussions":[{"author":{"id":1505155,"avatar":"https://static001.geekbang.org/account/avatar/00/16/f7/83/7fa4bd45.jpg","nickname":"è¶£å­¦è½¦","note":"","ucode":"5279A6BF4C67A3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":327195,"discussion_content":"b.buf[:m+n] ä¼šä½¿b.bufçš„é•¿åº¦ä¸ºm+n, è€Œè°ƒç”¨Growçš„æ—¶å€™åªæ˜¯æ‰©å®¹ï¼Œ å¹¶ä¸éœ€è¦å¢åŠ é•¿åº¦ï¼Œæ‰€ä»¥è¦é‡ç½®b.bufçš„é•¿åº¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605765551,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295901,"user_name":"moonfox","can_delete":false,"product_type":"c1","uid":1526355,"ip_address":"","ucode":"902BFF40EFA9FA","user_header":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","comment_is_top":false,"comment_ctime":1622635143,"is_pvip":false,"replies":[{"id":"107433","content":"æºç ï¼š n &lt;= c&#47;2-m<br>ç›¸å½“äºï¼š n &lt;= cap(b.buf)&#47;2 - b.Len()<br>ç›¸å½“äºï¼š n + b.Len() &lt;= cap(b.buf)&#47;2<br>å¾—å‡ºï¼š cap(b.buf)&#47;2 &gt;= len(b.buf) + need ï¼ˆä¸ºäº†åœ¨çœç•¥æ‰å¤šä½™ä¸Šä¸‹æ–‡çš„åŒæ—¶ä¿æŒæ¸…æ™°ï¼Œæˆ‘åœ¨è¿™é‡Œä½¿ç”¨äº†æ›´å®¹æ˜“ç†è§£çš„ä»£ç  cap(b.buf) å’Œ len(b.buf) ï¼Œä»¥åŠè‹±æ–‡å•è¯ needï¼‰<br><br>æ‰€ä»¥æˆ‘è¿™é‡Œæ²¡å†™é”™å•Šã€‚ä½ åé¢æè¿°çš„ä¸æ˜¯è·Ÿæˆ‘è¯´çš„ä¸€ä¸ªæ„æ€æ˜¯ä¹ˆï¼Ÿï¼Ÿ<br><br>ä¸è¿‡ï¼Œå¦‚æœè¿™é‡Œè®©ä½ äº§ç”Ÿäº†è¯¯è§£ï¼Œè¯´æ˜æˆ‘çš„æ–‡å­—æœ‰æ‰€æ¬ ç¼ºï¼Œæˆ‘æ”¹è¿›ä¸€ä¸‹å§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1622693157,"ip_address":"","comment_id":295901,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5917602439","product_id":100013101,"comment_content":"æ–‡ç« ä¸­è¯´ï¼šâ€œå¦‚æœå½“å‰å†…å®¹å®¹å™¨çš„å®¹é‡çš„ä¸€åŠï¼Œä»ç„¶å¤§äºæˆ–ç­‰äºå…¶ç°æœ‰é•¿åº¦å†åŠ ä¸Šå¦éœ€çš„å­—èŠ‚æ•°çš„å’Œï¼Œcap(b.buf)&#47;2 &gt;= len(b.buf)+needâ€ã€‚<br><br>å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œé‚£è¯´æ˜è¿˜æœ‰å¾ˆå¤šçš„æœªä½¿ç”¨çš„ç©ºé—´ï¼Œèµ·ç æœ‰ä¸€åŠï¼Œé‚£å°±ä¸ç”¨æ‰©å®¹ï¼Œç›´æ¥è¿½åŠ å°±å¯ä»¥äº†ã€‚æ‰€ä»¥è¿™é‡Œçš„ä»£ç æ˜¯é”™çš„ï¼Œæºç (1.16.2)ä¸­æ˜¯ n &lt;= c&#47;2-m ï¼Œå³cap(b.buf) &gt;= b.Len() + needï¼Œä¹Ÿå°±æ˜¯æœªè¯»å­—èŠ‚é•¿åº¦ + å¦éœ€çš„å­—èŠ‚æ•° å°äºç­‰äºå®¹é‡çš„ä¸€åŠæ—¶ï¼Œæ‰ä¼šæŠŠæœªè¯»å­—èŠ‚copyåˆ°bufçš„å¤´éƒ¨ï¼Œåªæœ‰åœ¨æœªè¯»å­—èŠ‚è¾ƒå°‘çš„æ—¶å€™ï¼Œæ‰å‘ç”Ÿcopyï¼Œå¦‚æœæœ‰å¤ªå¤šçš„æœªè¯»å­—èŠ‚ï¼Œå°±ä¸copyåˆ°å¤´éƒ¨äº†(è´¹æ—¶)","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521256,"discussion_content":"æºç ï¼š n &amp;lt;= c/2-m\nç›¸å½“äºï¼š n &amp;lt;= cap(b.buf)/2 - b.Len()\nç›¸å½“äºï¼š n + b.Len() &amp;lt;= cap(b.buf)/2\nå¾—å‡ºï¼š cap(b.buf)/2 &amp;gt;= len(b.buf) + need ï¼ˆä¸ºäº†åœ¨çœç•¥æ‰å¤šä½™ä¸Šä¸‹æ–‡çš„åŒæ—¶ä¿æŒæ¸…æ™°ï¼Œæˆ‘åœ¨è¿™é‡Œä½¿ç”¨äº†æ›´å®¹æ˜“ç†è§£çš„ä»£ç  cap(b.buf) å’Œ len(b.buf) ï¼Œä»¥åŠè‹±æ–‡å•è¯ needï¼‰\n\næ‰€ä»¥æˆ‘è¿™é‡Œæ²¡å†™é”™å•Šã€‚ä½ åé¢æè¿°çš„ä¸æ˜¯è·Ÿæˆ‘è¯´çš„ä¸€ä¸ªæ„æ€æ˜¯ä¹ˆï¼Ÿï¼Ÿ\n\nä¸è¿‡ï¼Œå¦‚æœè¿™é‡Œè®©ä½ äº§ç”Ÿäº†è¯¯è§£ï¼Œè¯´æ˜æˆ‘çš„æ–‡å­—æœ‰æ‰€æ¬ ç¼ºï¼Œæˆ‘æ”¹è¿›ä¸€ä¸‹å§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622693157,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1526355,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","nickname":"moonfox","note":"","ucode":"902BFF40EFA9FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377542,"discussion_content":"ä½† b. Len()è¡¨ç¤ºçš„æ˜¯æœªè¯»å­—èŠ‚é•¿åº¦ï¼Œlen(b.buf)è¡¨ç¤ºçš„æ˜¯ç¼“å†²åŒºå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå®ƒä»¬æ˜¯ä¸ä¸€æ ·çš„ï¼Œå¯¹å§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622704558,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1526355,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","nickname":"moonfox","note":"","ucode":"902BFF40EFA9FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377441,"discussion_content":"cap(b.buf) / 2 >= b.Len() + need","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622643984,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":204153,"user_name":"Lywane","can_delete":false,"product_type":"c1","uid":1446512,"ip_address":"","ucode":"2B0027AA069CE9","user_header":"https://static001.geekbang.org/account/avatar/00/16/12/70/10faf04b.jpg","comment_is_top":false,"comment_ctime":1586342840,"is_pvip":false,"replies":[{"id":"76911","content":"å¯¹ï¼Œä¸»è¦æ˜¯å®ç°æ¥å£ï¼Œè€Œä¸”ä¹Ÿä¿ç•™è¿”å›é”™è¯¯å€¼çš„æƒåˆ©å’Œä¹‰åŠ¡ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1586745861,"ip_address":"","comment_id":204153,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5881310136","product_id":100013101,"comment_content":"è€å¸ˆï¼ŒBufferçš„Writeï¼ŒWriteStringæ–¹æ³•è¿”å›ä¸€ä¸ªintï¼Œä¸€ä¸ªerrï¼Œintæ˜¯å‚æ•°é•¿åº¦ï¼Œerræ°¸è¿œæ˜¯nilï¼Œæ„Ÿè§‰è¿™ä¸ªè¿”å›æ²¡å•¥ç”¨å•Šã€‚è¿™ä¹ˆè®¾è®¡æ˜¯ä¸ºäº†å®ç°æŸäº›æ¥å£ä¹ˆï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491089,"discussion_content":"å¯¹ï¼Œä¸»è¦æ˜¯å®ç°æ¥å£ï¼Œè€Œä¸”ä¹Ÿä¿ç•™è¿”å›é”™è¯¯å€¼çš„æƒåˆ©å’Œä¹‰åŠ¡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586745861,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":169668,"user_name":"ç–¯ç´","can_delete":false,"product_type":"c1","uid":1099379,"ip_address":"","ucode":"82ACAA4A27753D","user_header":"https://static001.geekbang.org/account/avatar/00/10/c6/73/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1578401389,"is_pvip":false,"replies":[{"id":"65836","content":"å› ä¸ºæœ‰ç¼“å†²åŒºå•Šï¼Œæ¯”è¾ƒé€‚åˆåˆ†æ­¥æ„å»ºå­—ç¬¦ä¸²å€¼ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1578407217,"ip_address":"","comment_id":169668,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5873368685","product_id":100013101,"comment_content":"è¯·é—®è€å¸ˆï¼Œç”¨ bytes.Buffer è€Œä¸ç”¨å­—èŠ‚åˆ‡ç‰‡æ˜¯å› ä¸ºå®ƒæœ‰è®¡æ•°å™¨å’Œä¸€äº›æ–¹æ³•ä½¿å¾—æ“ä½œæ›´æ–¹ä¾¿ï¼Œè¿˜æœ‰é«˜æ•ˆçš„æ‰©å®¹ç­–ç•¥ä¹ˆã€‚è¿™ä¹ˆè¯´å¯¹ä¹ˆï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480662,"discussion_content":"å› ä¸ºæœ‰ç¼“å†²åŒºå•Šï¼Œæ¯”è¾ƒé€‚åˆåˆ†æ­¥æ„å»ºå­—ç¬¦ä¸²å€¼ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578407217,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":122807,"user_name":"çª—å¤–","can_delete":false,"product_type":"c1","uid":1542520,"ip_address":"","ucode":"3FF86229C97428","user_header":"","comment_is_top":false,"comment_ctime":1565531056,"is_pvip":false,"replies":[{"id":"45157","content":"ä½ å¯ä»¥æŠŠå‰å› åæœéƒ½æ‘†ä¸Šæ¥ã€‚è¿™ç¯‡æ–‡ç« é‡Œæœ‰ tmpBuf å—ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1565577136,"ip_address":"","comment_id":122807,"utype":1}],"discussion_count":4,"race_medal":0,"score":"5860498352","product_id":100013101,"comment_content":"è€å¸ˆä½ å¥½ï¼Œä¸ºä»€ä¹ˆæˆ‘æœ¬åœ°çš„src&#47;runtimeåŒ…ä¸‹çš„stringtoslicebyteæ–¹æ³•é‡Œé¢tmpBufçš„é»˜è®¤é•¿åº¦æ˜¯32ã€‚<br>æ‰€ä»¥æ–‡ä¸­ä¾‹å­ï¼Œè¾“å‡ºçš„å®¹é‡æ˜¯32","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462412,"discussion_content":"ä½ å¯ä»¥æŠŠå‰å› åæœéƒ½æ‘†ä¸Šæ¥ã€‚è¿™ç¯‡æ–‡ç« é‡Œæœ‰ tmpBuf å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565577136,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1198664,"avatar":"https://static001.geekbang.org/account/avatar/00/12/4a/48/95007650.jpg","nickname":"ç¬¨","note":"","ucode":"D5FDEEFAAB7AB3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":246015,"discussion_content":"åŒå­¦ï¼Œè¿™é‡Œstringtoslicebyteçš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¿è¡Œæ—¶æ˜¯nilå¾—ï¼Œæ‰€ä»¥ä»–ä¼šèµ°elseè¯­å¥ï¼Œä½ å¯ä»¥è·Ÿç€è·³è½¬ï¼Œæœ€åä¼šæ¥runtime/msize.go å¾— roundupsizeå‡½æ•°ï¼Œè¿™é‡Œä¼šè®¡ç®—å‡ºcapä¸º8","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587718103,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2538540,"avatar":"https://static001.geekbang.org/account/avatar/00/26/bc/2c/963688bb.jpg","nickname":"noisyes","note":"","ucode":"94EC310B284AD2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1198664,"avatar":"https://static001.geekbang.org/account/avatar/00/12/4a/48/95007650.jpg","nickname":"ç¬¨","note":"","ucode":"D5FDEEFAAB7AB3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368555,"discussion_content":"åŒå­¦æˆ‘æœ‰å‡ ä¸ªç–‘æƒ‘1.ä¸ºå•¥è¿è¡Œæ—¶ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯nilï¼Œæˆ‘æ²¡æ‰¾åˆ°è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„åœ°æ–¹ã€‚2.å¦‚æœæˆ‘å°†ä¸€ä¸ª s := &#34;ab&#34;,c := []byte(a),ç„¶åcap(c)çš„å€¼æ˜¯32","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618750942,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":246015,"ip_address":""},"score":368555,"extra":""}]},{"author":{"id":1542520,"avatar":"","nickname":"çª—å¤–","note":"","ucode":"3FF86229C97428","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4587,"discussion_content":"å¼•è¿°:ä½ å¯èƒ½ä¼šæœ‰ç–‘æƒ‘ï¼Œæˆ‘åªåœ¨è¿™ä¸ªBufferå€¼ä¸­æ”¾å…¥äº†ä¸€ä¸ªé•¿åº¦ä¸º2çš„å­—ç¬¦ä¸²å€¼ï¼Œä½†ä¸ºä»€ä¹ˆè¯¥å€¼çš„å®¹é‡å´å˜ä¸ºäº†8ã€‚\n----------------------------------------\nè€å¸ˆï¼Œæˆ‘è¯´çš„æ˜¯è¿™ä¸ªé—®é¢˜\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565579221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":348217,"user_name":"Aeins","can_delete":false,"product_type":"c1","uid":1045910,"ip_address":"","ucode":"D5BF220767541D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f5/96/0cf9f3c7.jpg","comment_is_top":false,"comment_ctime":1654849568,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1654849568","product_id":100013101,"comment_content":"â€œä½ å¯èƒ½ä¼šæœ‰ç–‘æƒ‘ï¼Œæˆ‘åªåœ¨è¿™ä¸ªBufferå€¼ä¸­æ”¾å…¥äº†ä¸€ä¸ªé•¿åº¦ä¸º2çš„å­—ç¬¦ä¸²å€¼ï¼Œä½†ä¸ºä»€ä¹ˆè¯¥å€¼çš„å®¹é‡å´å˜ä¸ºäº†8â€<br><br>ç›®å‰ï¼Œå­—ç¬¦ä¸²é•¿åº¦å°äº 32 çš„ç›´æ¥åˆ†é…åœ¨ç¼“å†²åŒºä¸Šï¼ŒCap æ˜¯ 32ï¼Œå¤§äº 32 çš„ï¼Œå†é‡æ–°åˆ†é…å†…å­˜","like_count":0},{"had_liked":false,"id":334659,"user_name":"costaLong","can_delete":false,"product_type":"c1","uid":1361244,"ip_address":"","ucode":"0A07A86F94B86C","user_header":"https://static001.geekbang.org/account/avatar/00/14/c5/5c/04be6fb7.jpg","comment_is_top":false,"comment_ctime":1645063311,"is_pvip":false,"replies":[{"id":"122317","content":"æ²¡çœ‹æ˜ç™½ï¼Œâ€œå•ç‹¬æ‰§è¡Œè¿™æ®µä»£ç â€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1026643","ctime":1645158947,"ip_address":"","comment_id":334659,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1645063311","product_id":100013101,"comment_content":"\tcontents := &quot;ab&quot;<br>\tbuffer1 := bytes.NewBufferString(contents)<br>\tfmt.Printf(&quot;The capacity of new buffer with content %q: %d\\n&quot;, contents, buffer1.Cap()) &#47;&#47; å†…å®¹å®¹å™¨çš„å®¹é‡ï¼š8<br>å•ç‹¬æ‰§è¡Œè¿™æ®µä»£ç è¾“å‡ºçš„ç»“æœæ˜¯ï¼šThe capacity of new buffer with content &quot;ab&quot;: 32<br> è¯·é—®æ˜¯åŸå› å‘¢","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551871,"discussion_content":"æ²¡çœ‹æ˜ç™½ï¼Œâ€œå•ç‹¬æ‰§è¡Œè¿™æ®µä»£ç â€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645158947,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332732,"user_name":"æ— åæ— å§“","can_delete":false,"product_type":"c1","uid":2621412,"ip_address":"","ucode":"487BD5AA2CD305","user_header":"https://static001.geekbang.org/account/avatar/00/27/ff/e4/927547a9.jpg","comment_is_top":false,"comment_ctime":1643528834,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1643528834","product_id":100013101,"comment_content":"è€å¸ˆè®²çš„å¾ˆé€å½»ï¼Œéœ€è¦ç»“åˆæºç ","like_count":0},{"had_liked":false,"id":305131,"user_name":"æ¼ æ˜ æ®‹å¤•","can_delete":false,"product_type":"c1","uid":1201985,"ip_address":"","ucode":"AAE763C91146AB","user_header":"https://static001.geekbang.org/account/avatar/00/12/57/41/22e85c6c.jpg","comment_is_top":false,"comment_ctime":1627836011,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627836011","product_id":100013101,"comment_content":"æ›´å…·ä½“åœ°è¯´ï¼Œå¦‚æœå†…å®¹å®¹å™¨çš„å®¹é‡ä¸å…¶é•¿åº¦çš„å·®ï¼Œå¤§äºæˆ–ç­‰äºå¦éœ€çš„å­—èŠ‚æ•°ï¼Œé‚£ä¹ˆæ‰©å®¹ä»£ç å°±ä¼šé€šè¿‡åˆ‡ç‰‡æ“ä½œå¯¹åŸæœ‰çš„å†…å®¹å®¹å™¨çš„é•¿åº¦è¿›è¡Œæ‰©å……ã€‚<br>è¿™å¥è¯ä¸­ä¸â€œå…¶é•¿åº¦çš„å·®â€ï¼Œè¡¨è¿°ä¸æ˜ç¡®ï¼Œåº”è¯¥æ˜¯å·²å­˜å†…å®¹é•¿åº¦çš„å·®ã€‚","like_count":0},{"had_liked":false,"id":295863,"user_name":"moonfox","can_delete":false,"product_type":"c1","uid":1526355,"ip_address":"","ucode":"902BFF40EFA9FA","user_header":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","comment_is_top":false,"comment_ctime":1622623067,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622623067","product_id":100013101,"comment_content":"æ€è€ƒé¢˜: strings.Builderçš„å®ç°æ˜¯ return *(*string)(unsafe.Pointer(&amp;b.buf))ï¼Œ bytes.Buffeçš„å®ç°æ˜¯string(b.buf[b.off:])ï¼Œæ˜¾ç„¶strings.Builderçš„Stringæ–¹æ³•æ›´é«˜æ•ˆï¼Œå®ƒæ²¡æœ‰å‘ç”Ÿæ‹·è´ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨(å…±äº«)äº†bufçš„å†…å­˜æ•°æ®(æ•°ç»„ï¼Œé•¿åº¦)","like_count":0},{"had_liked":false,"id":204152,"user_name":"Lywane","can_delete":false,"product_type":"c1","uid":1446512,"ip_address":"","ucode":"2B0027AA069CE9","user_header":"https://static001.geekbang.org/account/avatar/00/16/12/70/10faf04b.jpg","comment_is_top":false,"comment_ctime":1586342322,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586342322","product_id":100013101,"comment_content":"å¦‚æœå½“å‰å†…å®¹å®¹å™¨çš„å®¹é‡çš„ä¸€åŠï¼Œä»ç„¶å¤§äºæˆ–ç­‰äºå…¶ç°æœ‰é•¿åº¦å†åŠ ä¸Šå¦éœ€çš„å­—èŠ‚æ•°çš„å’Œï¼Œå³ï¼šcap(b.buf)&#47;2 &gt;= len(b.buf)+needï¼Œé‚£ä¹ˆï¼Œæ‰©å®¹ä»£ç å°±ä¼šå¤ç”¨ç°æœ‰çš„å†…å®¹å®¹å™¨ï¼Œå¹¶æŠŠå®¹å™¨ä¸­çš„æœªè¯»å†…å®¹æ‹·è´åˆ°å®ƒçš„å¤´éƒ¨ä½ç½®ã€‚è¿™ä¹Ÿæ„å‘³ç€å…¶ä¸­çš„å·²è¯»å†…å®¹ï¼Œå°†ä¼šå…¨éƒ¨è¢«æœªè¯»å†…å®¹å’Œä¹‹åçš„æ–°å†…å®¹è¦†ç›–æ‰ã€‚<br><br>å…¶å®è¿™ä¸€æ­¥å¹¶ä¸ä¼šè¦†ç›–æ‰€æœ‰å·²è¯»å†…å®¹ï¼ˆcopy(b.buf, b.buf[b.off:])ï¼‰ï¼Œå› ä¸ºæ ¹æ®æ¡ä»¶å¯ä»¥æ¨å‡ºæœªè¯»+å‰©ä½™&lt;å·²è¯»éƒ¨åˆ†ã€‚æ‰€ä»¥åœ¨Growæ–¹æ³•çš„æœ€ååˆæˆªå–äº†ä¸€ä¸‹","like_count":0},{"had_liked":false,"id":113609,"user_name":"rename","can_delete":false,"product_type":"c1","uid":1123100,"ip_address":"","ucode":"25D54752F54C05","user_header":"https://static001.geekbang.org/account/avatar/00/11/23/1c/d5c164df.jpg","comment_is_top":false,"comment_ctime":1563093956,"is_pvip":false,"replies":[{"id":"41390","content":"å½“ç„¶æ˜¯è¦çœ‹ buf æœ¬èº«çš„é•¿åº¦äº†ã€‚è¿™æ˜¯ bytes.Buffer å†…éƒ¨çš„ç®—æ³•ï¼Œä½ å¯ä»¥çœ‹ä¸€çœ‹æºç ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1563114837,"ip_address":"","comment_id":113609,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1563093956","product_id":100013101,"comment_content":"å¦‚æœå½“å‰å†…å®¹å®¹å™¨çš„å®¹é‡çš„ä¸€åŠï¼Œä»ç„¶å¤§äºæˆ–ç­‰äºå…¶ç°æœ‰é•¿åº¦å†åŠ ä¸Šæ‰€éœ€çš„å­—èŠ‚æ•°çš„å’Œï¼Œå³ï¼šcap(b.buf)&#47;2 &gt;= len(b.buf)+need<br>è¿™è¾¹len(b.buf)ç”¨b.Len()ä¼¼ä¹æ›´å‡†ç¡®ï¼Ÿæ‰æ˜¯è·å–æœªè¯»éƒ¨åˆ†çš„å®é™…é•¿åº¦","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458306,"discussion_content":"å½“ç„¶æ˜¯è¦çœ‹ buf æœ¬èº«çš„é•¿åº¦äº†ã€‚è¿™æ˜¯ bytes.Buffer å†…éƒ¨çš„ç®—æ³•ï¼Œä½ å¯ä»¥çœ‹ä¸€çœ‹æºç ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563114837,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1123100,"avatar":"https://static001.geekbang.org/account/avatar/00/11/23/1c/d5c164df.jpg","nickname":"rename","note":"","ucode":"25D54752F54C05","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2323,"discussion_content":"å¥½çš„ï¼Œè°¢è°¢è€å¸ˆ~ 1.11.5ç‰ˆæœ¬æ˜¯ç”¨çš„b.Len() ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563462381,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":76534,"user_name":"å˜å˜","can_delete":false,"product_type":"c1","uid":1356047,"ip_address":"","ucode":"039447D8E1353A","user_header":"https://static001.geekbang.org/account/avatar/00/14/b1/0f/e81a93ed.jpg","comment_is_top":false,"comment_ctime":1552629003,"is_pvip":false,"replies":[{"id":"28882","content":"è¿™ä¸ªBufferç±»å‹æ¯”strings.Builderç±»å‹å‡ºç°è¦æ—©ã€‚æˆ‘è§‰å¾—åè€…è´¨é‡æ›´é«˜ä¸€äº›ã€‚ä½ å¯ä»¥å‚çœ‹ä¸€ä¸‹åè€…çš„Stringæ–¹æ³•ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1553399365,"ip_address":"","comment_id":76534,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1552629003","product_id":100013101,"comment_content":"æºç é‡Œç»™äº†æ¨èçš„æ„å»ºæ–¹æ³•<br>&#47;&#47; To build strings more efficiently, see the strings.Builder type.<br>func (b *Buffer) String() string {<br>\tif b == nil {<br>\t\t&#47;&#47; Special case, useful in debugging.<br>\t\treturn &quot;&lt;nil&gt;&quot;<br>\t}<br>\treturn string(b.buf[b.off:])<br>}","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443343,"discussion_content":"è¿™ä¸ªBufferç±»å‹æ¯”strings.Builderç±»å‹å‡ºç°è¦æ—©ã€‚æˆ‘è§‰å¾—åè€…è´¨é‡æ›´é«˜ä¸€äº›ã€‚ä½ å¯ä»¥å‚çœ‹ä¸€ä¸‹åè€…çš„Stringæ–¹æ³•ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553399365,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":73157,"user_name":"è™¢åœ‹æŠ€é†¬","can_delete":false,"product_type":"c1","uid":1056807,"ip_address":"","ucode":"5A192262AA037E","user_header":"https://static001.geekbang.org/account/avatar/00/10/20/27/a6932fbe.jpg","comment_is_top":false,"comment_ctime":1551832973,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551832973","product_id":100013101,"comment_content":"æ‰“å¡","like_count":0}]}