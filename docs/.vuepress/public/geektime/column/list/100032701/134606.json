{"id":134606,"title":"18 | é˜²äººä¹‹å¿ƒä¸å¯æ— ï¼šæ£€æŸ¥æ•°æ®çš„æœ‰æ•ˆæ€§","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç››å»¶æ•ï¼Œè¿™é‡Œæ˜¯ç½‘ç»œç¼–ç¨‹å®æˆ˜ç¬¬18è®²ï¼Œæ¬¢è¿å›æ¥ã€‚</p><p>åœ¨å‰é¢ä¸€è®²ä¸­ï¼Œæˆ‘ä»¬ä»”ç»†åˆ†æäº†å¼•èµ·æ•…éšœçš„åŸå› ï¼Œå¹¶ä¸”å·²ç»çŸ¥é“ä¸ºäº†åº”å¯¹å¯èƒ½å‡ºç°çš„å„ç§æ•…éšœï¼Œå¿…é¡»åœ¨ç¨‹åºä¸­åšå¥½é˜²å¾¡å·¥ä½œã€‚</p><p>åœ¨è¿™ä¸€è®²é‡Œï¼Œæˆ‘ä»¬ç»§ç»­å‰é¢çš„è®¨è®ºï¼Œçœ‹ä¸€çœ‹ä¸ºäº†å¢å¼ºç¨‹åºçš„å¥å£®æ€§ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å‡†å¤‡ä»€ä¹ˆã€‚</p><h2>å¯¹ç«¯çš„å¼‚å¸¸çŠ¶å†µ</h2><p>åœ¨å‰é¢çš„ç¬¬11è®²ä»¥åŠç¬¬17è®²ä¸­ï¼Œæˆ‘ä»¬å·²ç»åˆæ­¥æ¥è§¦è¿‡ä¸€äº›é˜²èŒƒå¯¹ç«¯å¼‚å¸¸çš„æ–¹æ³•ï¼Œæ¯”å¦‚ï¼Œé€šè¿‡readç­‰è°ƒç”¨æ—¶ï¼Œå¯ä»¥é€šè¿‡å¯¹EOFçš„åˆ¤æ–­ï¼Œéšæ—¶é˜²èŒƒå¯¹æ–¹ç¨‹åºå´©æºƒã€‚</p><pre><code>int nBytes = recv(connfd, buffer, sizeof(buffer), 0);\nif (nBytes == -1) {\n    error(1, errno, &quot;error read message&quot;);\n} else if (nBytes == 0) {\n    error(1, 0, &quot;client closed \\n&quot;);\n}\n</code></pre><p>ä½ å¯ä»¥çœ‹åˆ°è¿™ä¸€ä¸ªç¨‹åºä¸­çš„ç¬¬4è¡Œï¼Œå½“è°ƒç”¨readå‡½æ•°è¿”å›0å­—èŠ‚æ—¶ï¼Œå®é™…ä¸Šå°±æ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸è¿”å›EOFçš„ä¸€ç§åæ˜ ã€‚å¦‚æœæ˜¯æœåŠ¡å™¨ç«¯åŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼Œä¸€èˆ¬è¿™é‡Œä¼šè°ƒç”¨shutdownå…³é—­è¿æ¥çš„è¿™ä¸€ç«¯ã€‚</p><p>ä¸Šä¸€è®²ä¹Ÿè®²åˆ°äº†ï¼Œä¸æ˜¯æ¯ç§æƒ…å†µéƒ½å¯ä»¥é€šè¿‡è¯»æ“ä½œæ¥æ„ŸçŸ¥å¼‚å¸¸ï¼Œæ¯”å¦‚ï¼ŒæœåŠ¡å™¨å®Œå…¨å´©æºƒï¼Œæˆ–è€…ç½‘ç»œä¸­æ–­çš„æƒ…å†µä¸‹ï¼Œæ­¤æ—¶ï¼Œå¦‚æœæ˜¯é˜»å¡å¥—æ¥å­—ï¼Œä¼šä¸€ç›´é˜»å¡åœ¨readç­‰è°ƒç”¨ä¸Šï¼Œæ²¡æœ‰åŠæ³•æ„ŸçŸ¥å¥—æ¥å­—çš„å¼‚å¸¸ã€‚</p><p>å…¶å®æœ‰å‡ ç§åŠæ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>ç¬¬ä¸€ä¸ªåŠæ³•æ˜¯ç»™å¥—æ¥å­—çš„readæ“ä½œè®¾ç½®è¶…æ—¶ï¼Œå¦‚æœè¶…è¿‡äº†ä¸€æ®µæ—¶é—´å°±è®¤ä¸ºè¿æ¥å·²ç»ä¸å­˜åœ¨ã€‚å…·ä½“çš„ä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š</p><pre><code>struct timeval tv;\ntv.tv_sec = 5;\ntv.tv_usec = 0;\nsetsockopt(connfd, SOL_SOCKET, SO_RCVTIMEO, (const char *) &amp;tv, sizeof tv);\n\nwhile (1) {\n    int nBytes = recv(connfd, buffer, sizeof(buffer), 0);\n    if (nBytes == -1) {\n        if (errno == EAGAIN || errno == EWOULDBLOCK) {\n            printf(&quot;read timeout\\n&quot;);\n            onClientTimeout(connfd);\n        } else {\n            error(1, errno, &quot;error read message&quot;);\n        }\n    } else if (nBytes == 0) {\n        error(1, 0, &quot;client closed \\n&quot;);\n    }\n    ...\n}\n</code></pre><p>è¿™ä¸ªä»£ç ç‰‡æ®µåœ¨ç¬¬4è¡Œè°ƒç”¨setsockoptå‡½æ•°ï¼Œè®¾ç½®äº†å¥—æ¥å­—çš„è¯»æ“ä½œè¶…æ—¶ï¼Œè¶…æ—¶æ—¶é—´ä¸ºåœ¨ç¬¬1-3è¡Œè®¾ç½®çš„5ç§’ï¼Œå½“ç„¶åœ¨è¿™é‡Œè¿™ä¸ªæ—¶é—´å€¼æ˜¯â€œæ‹è„‘è¢‹â€è®¾ç½®çš„ï¼Œæ¯”è¾ƒç§‘å­¦çš„è®¾ç½®æ–¹æ³•æ˜¯é€šè¿‡ä¸€å®šçš„ç»Ÿè®¡ä¹‹åå¾—åˆ°ä¸€ä¸ªæ¯”è¾ƒåˆç†çš„å€¼ã€‚å…³é”®ä¹‹å¤„åœ¨è¯»æ“ä½œè¿”å›å¼‚å¸¸çš„ç¬¬9-11è¡Œï¼Œæ ¹æ®å‡ºé”™ä¿¡æ¯æ˜¯<code>EAGAIN</code>æˆ–è€…<code>EWOULDBLOCK</code>ï¼Œåˆ¤æ–­å‡ºè¶…æ—¶ï¼Œè½¬è€Œè°ƒç”¨<code>onClientTimeout</code>å‡½æ•°æ¥è¿›è¡Œå¤„ç†ã€‚</p><!-- [[[read_end]]] --><p>è¿™ä¸ªå¤„ç†æ–¹å¼è™½ç„¶æ¯”è¾ƒç®€å•ï¼Œå´å¾ˆå®ç”¨ï¼Œå¾ˆå¤šFTPæœåŠ¡å™¨ç«¯å°±æ˜¯è¿™ä¹ˆè®¾è®¡çš„ã€‚è¿æ¥è¿™ç§FTPæœåŠ¡å™¨ä¹‹åï¼Œå¦‚æœFTPçš„å®¢æˆ·ç«¯æ²¡æœ‰ç»­ä¼ çš„åŠŸèƒ½ï¼Œåœ¨ç¢°åˆ°ç½‘ç»œæ•…éšœæˆ–æœåŠ¡å™¨å´©æºƒæ—¶å°±ä¼šæŒ‚æ–­ã€‚</p><p>ç¬¬äºŒä¸ªåŠæ³•æ˜¯ç¬¬12è®²ä¸­æåˆ°çš„åŠæ³•ï¼Œæ·»åŠ å¯¹è¿æ¥æ˜¯å¦æ­£å¸¸çš„æ£€æµ‹ã€‚å¦‚æœè¿æ¥ä¸æ­£å¸¸ï¼Œéœ€è¦ä»å½“å‰readé˜»å¡ä¸­è¿”å›å¹¶å¤„ç†ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªåŠæ³•ï¼Œå‰é¢ç¬¬12è®²ä¹Ÿæåˆ°è¿‡ï¼Œé‚£å°±æ˜¯åˆ©ç”¨å¤šè·¯å¤ç”¨æŠ€æœ¯è‡ªå¸¦çš„è¶…æ—¶èƒ½åŠ›ï¼Œæ¥å®Œæˆå¯¹å¥—æ¥å­—I/Oçš„æ£€æŸ¥ï¼Œå¦‚æœè¶…è¿‡äº†é¢„è®¾çš„æ—¶é—´ï¼Œå°±è¿›å…¥å¼‚å¸¸å¤„ç†ã€‚</p><pre><code>struct timeval tv;\ntv.tv_sec = 5;\ntv.tv_usec = 0;\n\nFD_ZERO(&amp;allreads);\nFD_SET(socket_fd, &amp;allreads);\nfor (;;) {\n    readmask = allreads;\n    int rc = select(socket_fd + 1, &amp;readmask, NULL, NULL, &amp;tv);\n    if (rc &lt; 0) {\n      error(1, errno, &quot;select failed&quot;);\n    }\n    if (rc == 0) {\n      printf(&quot;read timeout\\n&quot;);\n      onClientTimeout(socket_fd);\n    }\n ...   \n}\n</code></pre><p>è¿™æ®µä»£ç ä½¿ç”¨äº†selectå¤šè·¯å¤ç”¨æŠ€æœ¯æ¥å¯¹å¥—æ¥å­—è¿›è¡ŒI/Oäº‹ä»¶çš„è½®è¯¢ï¼Œç¨‹åºçš„13è¡Œæ˜¯åˆ°è¾¾è¶…æ—¶åçš„å¤„ç†é€»è¾‘ï¼Œè°ƒç”¨<code>onClientTimeout</code>å‡½æ•°æ¥è¿›è¡Œè¶…æ—¶åçš„å¤„ç†ã€‚</p><h2>ç¼“å†²åŒºå¤„ç†</h2><p>ä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„ç½‘ç»œç¨‹åºï¼Œåº”è¯¥å¯ä»¥åœ¨éšæœºè¾“å…¥çš„æƒ…å†µä¸‹è¡¨ç°ç¨³å®šã€‚ä¸ä»…æ˜¯è¿™æ ·ï¼Œéšç€äº’è”ç½‘çš„å‘å±•ï¼Œç½‘ç»œå®‰å…¨ä¹Ÿæ„ˆå‘é‡è¦ï¼Œæˆ‘ä»¬ç¼–å†™çš„ç½‘ç»œç¨‹åºèƒ½ä¸èƒ½åœ¨é»‘å®¢çš„åˆ»æ„æ”»å‡»ä¹‹ä¸‹è¡¨ç°ç¨³å®šï¼Œä¹Ÿæ˜¯ä¸€ä¸ªé‡è¦è€ƒé‡å› ç´ ã€‚</p><p>å¾ˆå¤šé»‘å®¢ç¨‹åºï¼Œä¼šé’ˆå¯¹æ€§åœ°æ„å»ºå‡ºä¸€å®šæ ¼å¼çš„ç½‘ç»œåè®®åŒ…ï¼Œå¯¼è‡´ç½‘ç»œç¨‹åºäº§ç”Ÿè¯¸å¦‚ç¼“å†²åŒºæº¢å‡ºã€æŒ‡é’ˆå¼‚å¸¸çš„åæœï¼Œå½±å“ç¨‹åºçš„æœåŠ¡èƒ½åŠ›ï¼Œä¸¥é‡çš„ç”šè‡³å¯ä»¥å¤ºå–æœåŠ¡å™¨ç«¯çš„æ§åˆ¶æƒï¼Œéšå¿ƒæ‰€æ¬²åœ°è¿›è¡Œç ´åæ´»åŠ¨ï¼Œæ¯”å¦‚è‘—åçš„SQLæ³¨å…¥ï¼Œå°±æ˜¯é€šè¿‡é’ˆå¯¹æ€§åœ°æ„é€ å‡ºSQLè¯­å¥ï¼Œå®Œæˆå¯¹æ•°æ®åº“æ•æ„Ÿä¿¡æ¯çš„çªƒå–ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨ç½‘ç»œç¨‹åºçš„ç¼–å†™è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ—¶æ—¶åˆ»åˆ»æé†’è‡ªå·±é¢å¯¹çš„æ˜¯å„ç§å¤æ‚å¼‚å¸¸çš„åœºæ™¯ï¼Œç”šè‡³æ˜¯åˆ«æœ‰ç”¨å¿ƒçš„æ”»å‡»è€…ï¼Œä¿æŒâ€œé˜²äººä¹‹å¿ƒä¸å¯æ— â€çš„è­¦æƒ•ã€‚</p><p>é‚£ä¹ˆç¨‹åºéƒ½æœ‰å¯èƒ½å‡ºç°å“ªå‡ ç§æ¼æ´å‘¢ï¼Ÿ</p><h3>ç¬¬ä¸€ä¸ªä¾‹å­</h3><pre><code>char Response[] = &quot;COMMAND OK&quot;;\nchar buffer[128];\n\nwhile (1) {\n    int nBytes = recv(connfd, buffer, sizeof(buffer), 0);\n    if (nBytes == -1) {\n        error(1, errno, &quot;error read message&quot;);\n    } else if (nBytes == 0) {\n        error(1, 0, &quot;client closed \\n&quot;);\n    }\n\n    buffer[nBytes] = '\\0';\n    if (strcmp(buffer, &quot;quit&quot;) == 0) {\n        printf(&quot;client quit\\n&quot;);\n        send(socket, Response, sizeof(Response), 0);\n    }\n\n    printf(&quot;received %d bytes: %s\\n&quot;, nBytes, buffer);\n}\n</code></pre><p>è¿™æ®µä»£ç ä»è¿æ¥å¥—æ¥å­—ä¸­è·å–å­—èŠ‚æµï¼Œå¹¶ä¸”åˆ¤æ–­äº†å‡ºå·®å’ŒEOFæƒ…å†µï¼Œå¦‚æœå¯¹ç«¯å‘é€æ¥çš„å­—ç¬¦æ˜¯â€œquitâ€å°±å›åº”â€œCOMAAND OKâ€çš„å­—ç¬¦æµï¼Œä¹çœ‹ä¸Šå»ä¸€åˆ‡æ­£å¸¸ã€‚</p><p>ä½†ä»”ç»†çœ‹ä¸€ä¸‹ï¼Œè¿™æ®µä»£ç å¾ˆæœ‰å¯èƒ½ä¼šäº§ç”Ÿä¸‹é¢çš„ç»“æœã€‚</p><pre><code>char buffer[128];\nbuffer[128] = '\\0';\n</code></pre><p>é€šè¿‡recvè¯»å–çš„å­—ç¬¦æ•°ä¸º128æ—¶ï¼Œå°±ä¼šè¿™æ ·çš„ç»“æœã€‚å› ä¸ºbufferçš„å¤§å°åªæœ‰128å­—èŠ‚ï¼Œæœ€åçš„èµ‹å€¼ç¯èŠ‚ï¼Œäº§ç”Ÿäº†ç¼“å†²åŒºæº¢å‡ºçš„é—®é¢˜ã€‚</p><p>æ‰€è°“ç¼“å†²åŒºæº¢å‡ºï¼Œæ˜¯æŒ‡è®¡ç®—æœºç¨‹åºä¸­å‡ºç°çš„ä¸€ç§å†…å­˜è¿è§„æ“ä½œã€‚æœ¬è´¨æ˜¯è®¡ç®—æœºç¨‹åºå‘ç¼“å†²åŒºå¡«å……çš„æ•°æ®ï¼Œè¶…å‡ºäº†åŸæœ¬ç¼“å†²åŒºè®¾ç½®çš„å¤§å°é™åˆ¶ï¼Œå¯¼è‡´äº†æ•°æ®è¦†ç›–äº†å†…å­˜æ ˆç©ºé—´çš„å…¶ä»–åˆæ³•æ•°æ®ã€‚è¿™ç§è¦†ç›–ç ´åäº†åŸæ¥ç¨‹åºçš„å®Œæ•´æ€§ï¼Œä½¿ç”¨è¿‡æ¸¸æˆä¿®æ”¹å™¨çš„åŒå­¦è‚¯å®šçŸ¥é“ï¼Œå¦‚æœä¸å°å¿ƒä¿®æ”¹é”™æ¸¸æˆæ•°æ®çš„å†…å­˜ç©ºé—´ï¼Œå¾ˆå¯èƒ½å¯¼è‡´åº”ç”¨ç¨‹åºäº§ç”Ÿå¦‚â€œAccess violationâ€çš„é”™è¯¯ï¼Œå¯¼è‡´åº”ç”¨ç¨‹åºå´©æºƒã€‚</p><p>æˆ‘ä»¬å¯ä»¥å¯¹è¿™ä¸ªç¨‹åºç¨åŠ ä¿®æ”¹ï¼Œä¸»è¦çš„æƒ³æ³•æ˜¯ç•™ä¸‹bufferé‡Œçš„ä¸€ä¸ªå­—èŠ‚ï¼Œä»¥å®¹çº³åé¢çš„<code>'\\0'</code>ã€‚</p><pre><code>int nBytes = recv(connfd, buffer, sizeof(buffer)-1, 0);\n</code></pre><p>è¿™ä¸ªä¾‹å­é‡Œé¢ï¼Œè¿˜æ˜­ç¤ºäº†ä¸€ä¸ªæœ‰è¶£çš„ç°è±¡ã€‚ä½ ä¼šå‘ç°æˆ‘ä»¬å‘é€è¿‡å»çš„å­—ç¬¦ä¸²ï¼Œè°ƒç”¨çš„æ˜¯<code>sizeof</code>ï¼Œé‚£ä¹Ÿå°±æ„å‘³ç€ï¼ŒResponseå­—ç¬¦ä¸²ä¸­çš„<code>'\\0'</code>æ˜¯è¢«å‘é€å‡ºå»çš„ï¼Œè€Œæˆ‘ä»¬åœ¨æ¥æ”¶å­—ç¬¦æ—¶ï¼Œåˆ™å‡è®¾æ²¡æœ‰<code>'\\0'</code>å­—ç¬¦çš„å­˜åœ¨ã€‚</p><p>ä¸ºäº†ç»Ÿä¸€ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹æˆå¦‚ä¸‹çš„æ–¹å¼ï¼Œä½¿ç”¨strlençš„æ–¹å¼å¿½ç•¥æœ€åä¸€ä¸ª<code>'\\0'</code>å­—ç¬¦ã€‚</p><pre><code>send(socket, Response, strlen(Response), 0);\n</code></pre><h3>ç¬¬äºŒä¸ªä¾‹å­</h3><p>ç¬¬16è®²ä¸­æåˆ°äº†å¯¹å˜é•¿æŠ¥æ–‡è§£æçš„ä¸¤ç§æ‰‹æ®µï¼Œä¸€ä¸ªæ˜¯ä½¿ç”¨ç‰¹æ®Šçš„è¾¹ç•Œç¬¦å·ï¼Œä¾‹å¦‚HTTPä½¿ç”¨çš„å›è½¦æ¢è¡Œç¬¦ï¼›å¦ä¸€ä¸ªæ˜¯å°†æŠ¥æ–‡ä¿¡æ¯çš„é•¿åº¦ç¼–ç è¿›å…¥æ¶ˆæ¯ã€‚</p><p>åœ¨å®æˆ˜ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å¯¹è¿™éƒ¨åˆ†æŠ¥æ–‡é•¿åº¦ä¿æŒè­¦æƒ•ã€‚</p><pre><code>size_t read_message(int fd, char *buffer, size_t length) {\n    u_int32_t msg_length;\n    u_int32_t msg_type;\n    int rc;\n\n    rc = readn(fd, (char *) &amp;msg_length, sizeof(u_int32_t));\n    if (rc != sizeof(u_int32_t))\n        return rc &lt; 0 ? -1 : 0;\n    msg_length = ntohl(msg_length);\n\n    rc = readn(fd, (char *) &amp;msg_type, sizeof(msg_type));\n    if (rc != sizeof(u_int32_t))\n        return rc &lt; 0 ? -1 : 0;\n\n    if (msg_length &gt; length) {\n        return -1;\n    }\n\n    /* Retrieve the record itself */\n    rc = readn(fd, buffer, msg_length);\n    if (rc != msg_length)\n        return rc &lt; 0 ? -1 : 0;\n    return rc;\n}\n</code></pre><p>åœ¨è¿›è¡ŒæŠ¥æ–‡è§£ææ—¶ï¼Œç¬¬15è¡Œå¯¹å®é™…çš„æŠ¥æ–‡é•¿åº¦<code>msg_length</code>å’Œåº”ç”¨ç¨‹åºåˆ†é…çš„ç¼“å†²åŒºå¤§å°è¿›è¡Œäº†æ¯”è¾ƒï¼Œå¦‚æœæŠ¥æ–‡é•¿åº¦è¿‡å¤§ï¼Œå¯¼è‡´ç¼“å†²åŒºå®¹çº³ä¸ä¸‹ï¼Œç›´æ¥è¿”å›-1è¡¨ç¤ºå‡ºé”™ã€‚åƒä¸‡ä¸è¦å°çœ‹è¿™éƒ¨åˆ†çš„åˆ¤æ–­ï¼Œè¯•æƒ³å¦‚æœæ²¡æœ‰è¿™ä¸ªåˆ¤æ–­ï¼Œå¯¹æ–¹ç¨‹åºå‘é€å‡ºæ¥çš„æ¶ˆæ¯ä½“ï¼Œå¯èƒ½æ„å»ºå‡ºä¸€ä¸ªéå¸¸å¤§çš„<code>msg_length</code>ï¼Œè€Œå®é™…å‘é€çš„æŠ¥æ–‡æœ¬ä½“é•¿åº¦å´æ²¡æœ‰è¿™ä¹ˆå¤§ï¼Œè¿™æ ·åé¢çš„è¯»å–æ“ä½œå°±ä¸ä¼šæˆåŠŸï¼Œå¦‚æœåº”ç”¨ç¨‹åºå®é™…ç¼“å†²åŒºå¤§å°æ¯”<code>msg_length</code>å°ï¼Œä¹Ÿäº§ç”Ÿäº†ç¼“å†²åŒºæº¢å‡ºçš„é—®é¢˜ã€‚</p><pre><code>struct {\n    u_int32_t message_length;\n    u_int32_t message_type;\n    char data[128];\n} message;\n\nint n = 65535;\nmessage.message_length = htonl(n);\nmessage.message_type = 1;\nchar buf[128] = &quot;just for fun\\0&quot;;\nstrncpy(message.data, buf, strlen(buf));\nif (send(socket_fd, (char *) &amp;message,\n         sizeof(message.message_length) + sizeof(message.message_type) + strlen(message.data), 0) &lt; 0)\n    error(1, errno, &quot;send failure&quot;);\n</code></pre><p>å°±æ˜¯è¿™æ ·ä¸€æ®µå‘é€ç«¯â€œä¸å°å¿ƒâ€æ„é€ çš„ä¸€ä¸ªç¨‹åºï¼Œæ¶ˆæ¯çš„é•¿åº¦â€œä¸å°å¿ƒâ€è¢«è®¾ç½®ä¸º65535é•¿åº¦ï¼Œå®é™…å‘é€çš„æŠ¥æ–‡æ•°æ®ä¸ºâ€œjust for funâ€ã€‚åœ¨å»æ‰å®é™…çš„æŠ¥æ–‡é•¿åº¦<code>msg_length</code>å’Œåº”ç”¨ç¨‹åºåˆ†é…çš„ç¼“å†²åŒºå¤§å°åšæ¯”è¾ƒä¹‹åï¼ŒæœåŠ¡å™¨ç«¯ä¸€ç›´é˜»å¡åœ¨readè°ƒç”¨ä¸Šï¼Œè¿™æ˜¯å› ä¸ºæœåŠ¡å™¨ç«¯è¯¯è®¤ä¸ºéœ€è¦æ¥æ”¶65535å¤§å°çš„å­—èŠ‚ã€‚</p><h3>ç¬¬ä¸‰ä¸ªä¾‹å­</h3><p>å¦‚æœæˆ‘ä»¬éœ€è¦å¼€å‘ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å‡è®¾æŠ¥æ–‡çš„åˆ†ç•Œç¬¦æ˜¯æ¢è¡Œç¬¦ï¼ˆ\\nï¼‰ï¼Œä¸€ä¸ªç®€å•çš„æƒ³æ³•æ˜¯æ¯æ¬¡è¯»å–ä¸€ä¸ªå­—ç¬¦ï¼Œåˆ¤æ–­è¿™ä¸ªå­—ç¬¦æ˜¯ä¸æ˜¯æ¢è¡Œç¬¦ã€‚</p><p>è¿™é‡Œæœ‰ä¸€ä¸ªè¿™æ ·çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„æœ€å¤§é—®é¢˜æ˜¯å·¥ä½œæ•ˆç‡å¤ªä½ï¼Œè¦çŸ¥é“æ¯æ¬¡è°ƒç”¨recvå‡½æ•°éƒ½æ˜¯ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼Œéœ€è¦ä»ç”¨æˆ·ç©ºé—´åˆ‡æ¢åˆ°å†…æ ¸ç©ºé—´ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€å¯¹äºé«˜æ€§èƒ½æ¥è¯´æœ€å¥½æ˜¯èƒ½çœåˆ™çœã€‚</p><pre><code>size_t readline(int fd, char *buffer, size_t length) {\n    char *buf_first = buffer;\n\n    char c;\n    while (length &gt; 0 &amp;&amp; recv(fd, &amp;c, 1, 0) == 1) {\n        *buffer++ = c;\n        length--;\n        if (c == '\\n') {\n            *buffer = '\\0';\n            return buffer - buf_first;\n        }\n    }\n\n    return -1;\n}\n</code></pre><p>äºæ˜¯ï¼Œå°±æœ‰äº†ç¬¬äºŒä¸ªç‰ˆæœ¬ï¼Œè¿™ä¸ªå‡½æ•°ä¸€æ¬¡æ€§è¯»å–æœ€å¤š512å­—èŠ‚åˆ°ä¸´æ—¶ç¼“å†²åŒºï¼Œä¹‹åå°†ä¸´æ—¶ç¼“å†²åŒºçš„å­—ç¬¦ä¸€ä¸ªä¸€ä¸ªæ‹·è´åˆ°åº”ç”¨ç¨‹åºæœ€ç»ˆçš„ç¼“å†²åŒºä¸­ï¼Œè¿™æ ·çš„åšæ³•æ˜æ˜¾æ•ˆç‡ä¼šé«˜å¾ˆå¤šã€‚</p><pre><code>size_t readline(int fd, char *buffer, size_t length) {\n    char *buf_first = buffer;\n    static char *buffer_pointer;\n    int nleft = 0;\n    static char read_buffer[512];\n    char c;\n\n    while (length-- &gt; 0) {\n        if (nleft &lt;= 0) {\n            int nread = recv(fd, read_buffer, sizeof(read_buffer), 0);\n            if (nread &lt; 0) {\n                if (errno == EINTR) {\n                    length++;\n                    continue;\n                }\n                return -1;\n            }\n            if (nread == 0)\n                return 0;\n            buffer_pointer = read_buffer;\n            nleft = nread;\n        }\n        c = *buffer_pointer++;\n        *buffer++ = c;\n        nleft--;\n        if (c == '\\n') {\n            *buffer = '\\0';\n            return buffer - buf_first;\n        }\n    }\n    return -1;\n}\n</code></pre><p>è¿™ä¸ªç¨‹åºçš„ä¸»å¾ªç¯åœ¨ç¬¬8è¡Œï¼Œé€šè¿‡å¯¹lengthå˜é‡çš„åˆ¤æ–­ï¼Œè¯•å›¾è§£å†³ç¼“å†²åŒºé•¿åº¦æº¢å‡ºé—®é¢˜ï¼›ç¬¬9è¡Œæ˜¯åˆ¤æ–­ä¸´æ—¶ç¼“å†²åŒºçš„å­—ç¬¦æœ‰æ²¡æœ‰è¢«å…¨éƒ¨æ‹·è´å®Œï¼Œå¦‚æœè¢«å…¨éƒ¨æ‹·è´å®Œï¼Œå°±ä¼šå†æ¬¡å°è¯•è¯»å–æœ€å¤š512å­—èŠ‚ï¼›ç¬¬20-21è¡Œåœ¨è¯»å–å­—ç¬¦æˆåŠŸä¹‹åï¼Œé‡ç½®äº†ä¸´æ—¶ç¼“å†²åŒºè¯»æŒ‡é’ˆã€ä¸´æ—¶ç¼“å†²åŒºå¾…è¯»çš„å­—ç¬¦ä¸ªæ•°ï¼›ç¬¬23-25è¡Œåˆ™æ˜¯åœ¨æ‹·è´ä¸´æ—¶ç¼“å†²åŒºå­—ç¬¦ï¼Œæ¯æ¬¡æ‹·è´ä¸€ä¸ªå­—ç¬¦ï¼Œå¹¶ç§»åŠ¨ä¸´æ—¶ç¼“å†²åŒºè¯»æŒ‡é’ˆï¼Œå¯¹ä¸´æ—¶ç¼“å†²åŒºå¾…è¯»çš„å­—ç¬¦ä¸ªæ•°è¿›è¡Œå‡1æ“ä½œã€‚åœ¨ç¨‹åºçš„26-28è¡Œï¼Œåˆ¤æ–­æ˜¯å¦è¯»åˆ°æ¢è¡Œç¬¦ï¼Œå¦‚æœè¯»åˆ°åˆ™å°†åº”ç”¨ç¨‹åºæœ€ç»ˆç¼“å†²åŒºæˆªæ–­ï¼Œè¿”å›æœ€ç»ˆè¯»å–çš„å­—ç¬¦ä¸ªæ•°ã€‚</p><p>è¿™ä¸ªç¨‹åºè¿è¡Œèµ·æ¥å¯èƒ½å¾ˆä¹…éƒ½æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯ï¼Œå®ƒè¿˜æ˜¯æœ‰ä¸€ä¸ªå¾®å°çš„ç‘•ç–µï¼Œè¿™ä¸ªç‘•ç–µå¾ˆå¯èƒ½ä¼šé€ æˆçº¿ä¸Šæ•…éšœã€‚</p><p>ä¸ºäº†è®²æ¸…è¿™ä¸ªæ•…éšœï¼Œæˆ‘ä»¬å‡è®¾è¿™æ ·è°ƒç”¨ï¼Œ è¾“å…¥çš„å­—ç¬¦ä¸º<code>012345678\\n</code>ã€‚</p><pre><code>//è¾“å…¥å­—ç¬¦ä¸º: 012345678\\n\nchar buf[10]\nreadline(fd, buf, 10)\n</code></pre><p>å½“è¯»åˆ°æœ€åä¸€ä¸ª\\nå­—ç¬¦æ—¶ï¼Œlengthä¸º1ï¼Œé—®é¢˜æ˜¯åœ¨ç¬¬26è¡Œå’Œ27è¡Œï¼Œå¦‚æœè¯»åˆ°äº†æ¢è¡Œç¬¦ï¼Œå°±ä¼šå¢åŠ ä¸€ä¸ªå­—ç¬¦ä¸²æˆªæ­¢ç¬¦ï¼Œè¿™æ˜¾ç„¶è¶Šè¿‡äº†åº”ç”¨ç¨‹åºç¼“å†²åŒºçš„å¤§å°ã€‚</p><p>è¿™æ˜¯æ­£ç¡®çš„ç¨‹åºï¼Œè¿™é‡Œæœ€å…³é”®çš„æ˜¯éœ€è¦å…ˆå¯¹lengthè¿›è¡Œå¤„ç†ï¼Œå†å»åˆ¤æ–­lengthçš„å¤§å°æ˜¯å¦å¯ä»¥å®¹çº³ä¸‹å­—ç¬¦ã€‚</p><pre><code>size_t readline(int fd, char *buffer, size_t length) {\n    char *buf_first = buffer;\n    static char *buffer_pointer;\n    int nleft = 0;\n    static char read_buffer[512];\n    char c;\n\n    while (--length&gt; 0) {\n        if (nleft &lt;= 0) {\n            int nread = recv(fd, read_buffer, sizeof(read_buffer), 0);\n            if (nread &lt; 0) {\n                if (errno == EINTR) {\n                    length++;\n                    continue;\n                }\n                return -1;\n            }\n            if (nread == 0)\n                return 0;\n            buffer_pointer = read_buffer;\n            nleft = nread;\n        }\n        c = *buffer_pointer++;\n        *buffer++ = c;\n        nleft--;\n        if (c == '\\n') {\n            *buffer = '\\0';\n            return buffer - buf_first;\n        }\n    }\n    return -1;\n}\n</code></pre><h2>æ€»ç»“</h2><p>ä»Šå¤©çš„å†…å®¹åˆ°è¿™é‡Œå°±ç»“æŸäº†ã€‚è®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ï¼š åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œæ˜¯å¦åšå¥½äº†å¯¹å„ç§å¼‚å¸¸è¾¹ç•Œçš„æ£€æµ‹ï¼Œå°†å†³å®šæˆ‘ä»¬çš„ç¨‹åºåœ¨æ¶åŠ£æƒ…å†µä¸‹çš„ç¨³å®šæ€§ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸€å®šè¦æ—¶åˆ»æé†’è‡ªå·±åšå¥½åº”å¯¹å„ç§å¤æ‚æƒ…å†µçš„å‡†å¤‡ï¼Œè¿™é‡Œçš„å¼‚å¸¸æƒ…å†µåŒ…æ‹¬ç¼“å†²åŒºæº¢å‡ºã€æŒ‡é’ˆé”™è¯¯ã€è¿æ¥è¶…æ—¶æ£€æµ‹ç­‰ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>å’Œå¾€å¸¸ä¸€æ ·ï¼Œç»™ä½ ç•™ä¸¤é“æ€è€ƒé¢˜å§ã€‚</p><p>ç¬¬ä¸€é“ï¼Œæˆ‘ä»¬åœ¨è¯»æ•°æ®çš„æ—¶å€™ï¼Œä¸€èˆ¬éƒ½éœ€è¦ç»™åº”ç”¨ç¨‹åºæœ€ç»ˆç¼“å†²åŒºåˆ†é…å¤§å°ï¼Œè¿™ä¸ªå¤§å°æœ‰ä»€ä¹ˆè®²ç©¶å—ï¼Ÿ</p><p>ç¬¬äºŒé“ï¼Œä½ èƒ½åˆ†æä¸€ä¸‹ï¼Œæˆ‘ä»¬æ–‡ç« ä¸­çš„ä¾‹å­æ‰€åˆ†é…çš„ç¼“å†²æ˜¯å¦å¯ä»¥æ¢æˆåŠ¨æ€åˆ†é…å—ï¼Ÿæ¯”å¦‚è°ƒç”¨mallocå‡½æ•°æ¥åˆ†é…ç¼“å†²åŒºï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨è¯„è®ºåŒºå†™ä¸‹ä½ çš„æ€è€ƒï¼Œä¹Ÿæ¬¢è¿æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–è€…åŒäº‹ï¼Œä¸€èµ·äº¤æµä¸€ä¸‹ã€‚</p>","neighbors":{"left":{"article_title":"17 | TCPå¹¶ä¸æ€»æ˜¯â€œå¯é â€çš„ï¼Ÿ","id":132639},"right":{"article_title":"19ä¸¨æé«˜ç¯‡ç­”ç–‘ï¼šå¦‚ä½•ç†è§£TCPå››æ¬¡æŒ¥æ‰‹ï¼Ÿ","id":135735}},"comments":[{"had_liked":false,"id":132827,"user_name":"LDxy","can_delete":false,"product_type":"c1","uid":1188710,"ip_address":"","ucode":"956432CE7B7761","user_header":"https://static001.geekbang.org/account/avatar/00/12/23/66/413c0bb5.jpg","comment_is_top":false,"comment_ctime":1568248558,"is_pvip":false,"replies":[{"id":"51629","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1568887726,"ip_address":"","comment_id":132827,"utype":1}],"discussion_count":1,"race_medal":0,"score":"117532365550","product_id":100032701,"comment_content":"1ï¼Œæœ€ç»ˆç¼“å†²åŒºçš„å¤§å°åº”è¯¥æ¯”é¢„è®¡æ¥æ”¶çš„æ•°æ®å¤§å°å¤§ä¸€äº›ï¼Œé¢„é˜²ç¼“å†²åŒºæº¢å‡ºã€‚2ï¼Œå®Œå…¨å¯ä»¥åŠ¨æ€åˆ†é…ï¼Œä½†æ˜¯è¦è®°å¾—åœ¨returnå‰é‡Šæ”¾ç¼“å†²åŒº","like_count":28,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467139,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568887726,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":231368,"user_name":"éƒ‘ç¥–ç…Œ","can_delete":false,"product_type":"c1","uid":1469608,"ip_address":"","ucode":"49A0D2E3279826","user_header":"https://static001.geekbang.org/account/avatar/00/16/6c/a8/1922a0f5.jpg","comment_is_top":false,"comment_ctime":1593658142,"is_pvip":false,"replies":[{"id":"85729","content":"å›ç­”çš„è¿™ä¹ˆèµï¼Œæˆ‘è¿˜èƒ½è¯´å•¥å‘¢ :)","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1593954453,"ip_address":"","comment_id":231368,"utype":1}],"discussion_count":1,"race_medal":0,"score":"74608102174","product_id":100032701,"comment_content":"(1).ç¬¬ä¸€é“ï¼Œæˆ‘ä»¬åœ¨è¯»æ•°æ®çš„æ—¶å€™ï¼Œä¸€èˆ¬éƒ½éœ€è¦ç»™åº”ç”¨ç¨‹åºæœ€ç»ˆç¼“å†²åŒºåˆ†é…å¤§å°ï¼Œè¿™ä¸ªå¤§å°æœ‰ä»€ä¹ˆè®²ç©¶å—ï¼Ÿ æœ‰è®²ç©¶çš„ã€‚å¦‚æœåˆ†é…çš„å¤ªå°ï¼Œé‚£å°±ä¼šé¢‘ç¹çš„ä»ç”¨æˆ·å¤ªåˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œè¿™æ ·å…¶å®éå¸¸æŸè€—CPUçš„æ—¶é—´ã€‚åŒæ—¶å¦‚æœè®¾ç½®çš„å¤ªå¤§çš„è¯ï¼Œé‚£å°±ä¼šé•¿æœŸé˜»å¡åœ¨readæˆ–è€…recvå‡½æ•°ä¸Šï¼Œé€ æˆå¯ä»¥å…ˆæœåŠ¡æˆ–è€…å…ˆå®Œæˆçš„å†…å®¹æ²¡å®Œæˆã€‚å†æ¬¡ï¼Œä¹Ÿå¾—æ¯”å®é™…çš„æ•°æ®ç¨å¾®å¤§ä¸€äº›ä»¥å…ç¼“å†²åŒºæº¢å‡ºï¼Œè¾¹ç•Œçš„é—®é¢˜è¦æƒ³åŠæ³•åšå¥½çš„è°ƒæ•´ã€‚ã€‚<br>(2). ç¬¬äºŒé“ï¼Œä½ èƒ½åˆ†æä¸€ä¸‹ï¼Œæˆ‘ä»¬æ–‡ç« ä¸­çš„ä¾‹å­æ‰€åˆ†é…çš„ç¼“å†²æ˜¯å¦å¯ä»¥æ¢æˆåŠ¨æ€åˆ†é…å—ï¼Ÿæ¯”å¦‚è°ƒç”¨ malloc å‡½æ•°æ¥åˆ†é…ç¼“å†²åŒºï¼Ÿæ˜¯å¯ä»¥åŠ¨æ€åˆ†é…ï¼Œå°±æ˜¯newçš„è¯è¦è®°å¾—åŠæ—¶çš„å»deleteï¼Œä»¥å…é€ æˆå†…å­˜æ³„éœ²ã€‚","like_count":18,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500276,"discussion_content":"å›ç­”çš„è¿™ä¹ˆèµï¼Œæˆ‘è¿˜èƒ½è¯´å•¥å‘¢ :)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593954453,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":170805,"user_name":"è¶…å¤§çº¢ç»†èƒ","can_delete":false,"product_type":"c1","uid":1780519,"ip_address":"","ucode":"08FA6FE03A8C27","user_header":"https://static001.geekbang.org/account/avatar/00/1b/2b/27/9676d6b3.jpg","comment_is_top":false,"comment_ctime":1578728369,"is_pvip":false,"replies":[{"id":"68056","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1580628249,"ip_address":"","comment_id":170805,"utype":1}],"discussion_count":1,"race_medal":0,"score":"53118335921","product_id":100032701,"comment_content":"ä¸€å¼€å§‹ä¸ç†è§£ä¸ºä»€ä¹ˆè®¾ç½®äº† timeout çš„ recv ä¼šè¿”å› EAGAIN é”™è¯¯ï¼Œåœ¨æˆ‘çš„çŸ¥è¯†ä½“ç³»ä¸­ EAGAIN ä¸€èˆ¬å‡ºç°åœ¨éé˜»å¡çš„ socket ä¸­ï¼Œåæ¥ man äº†ä¸€ä¸‹ SO_RCVTIMEOï¼Œå‘ç°ç¡®å®å¦‚æ­¤ï¼Œç»™åé¢çš„åŒå­¦æä¸ªé†’ï¼š<br>Specify the receiving or sending timeouts until reporting an error. The argument is a  struct timeval. If an input or output function blocks for this period of time, and data has been sent or received, the return value of that function will be the amount of data transferred; if no data has been transferred and the timeout has been reached then -1 is returned with errno set to  EAGAIN or  EWOULDBLOCK, or  EINPROGRESS (for  connect(2)) just as if the socket was specified to be nonblocking. <br>æ€»ä¹‹ä¸€å¥è¯ï¼ŒSO_RCVTIMEO ä¼šå¯¼è‡´ recv è¿”å› EAGAIN","like_count":13,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481117,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580628249,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":133325,"user_name":"ä¼ è¯´ä¸­çš„æˆå¤§å¤§","can_delete":false,"product_type":"c1","uid":1236766,"ip_address":"","ucode":"103543D6E706BF","user_header":"https://static001.geekbang.org/account/avatar/00/12/df/1e/cea897e8.jpg","comment_is_top":false,"comment_ctime":1568517057,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"18748386241","product_id":100032701,"comment_content":"ç¬¬ä¸€é—®:<br>ä¸èƒ½å¤ªå°ä¹Ÿä¸èƒ½å¤ªå¤§  å¤ªå°äº†é¢‘ç¹çš„ç”¨æˆ·æ€å’Œå†…æ ¸æ€åˆ‡æ¢,å¤ªå¤§äº†è¯»ä¸å¤Ÿå®¹æ˜“é˜»å¡,å°±ç®—ä¸é˜»å¡ä¹Ÿå®¹æ˜“æµªè´¹<br>ç¬¬äºŒé—®:<br>å¦‚æœç”¨mallocé¢‘ç¹çš„ç”³è¯·å’Œé‡Šæ”¾ä¹Ÿä¸å¤ªå¥½ å®¹æ˜“é€ æˆç¢ç‰‡<br>","like_count":4,"discussions":[{"author":{"id":2224386,"avatar":"https://static001.geekbang.org/account/avatar/00/21/f1/02/96082034.jpg","nickname":"Guchen","note":"","ucode":"9BD34F616F167A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":317382,"discussion_content":"å¤ªå¤§äº†æ²¡æœ‰è¯»ä¸å¤Ÿé˜»å¡è¿™ä¸€è¯´ï¼ŒreadæŒ‡å®šçš„nbytesåªæ˜¯è¯´æ¯æ¬¡æœ€å¤šè¯»å¤šå°‘å­—èŠ‚ï¼Œè€Œä¸æ˜¯å¿…é¡»è¯»æ»¡è¿™äº›å­—èŠ‚æ‰è¿”å›ã€‚\nreadè¯»é˜»å¡/éé˜»å¡socketï¼Œåªè¦æ¥æ”¶ç¼“å†²åŒºæœ‰æ•°æ®ï¼Œé‚£å°±ç«‹åˆ»è¿”å›;ä¸¤è€…å·®åˆ«åœ¨äºï¼Œå½“æ¥å—ç¼“å†²åŒºæ— æ•°æ®æ—¶ï¼Œå‰è€…ä¼šé˜»å¡åœ¨readè°ƒç”¨ä¸Šï¼Œåè€…ä¼šç«‹åˆ»è¿”å›-1å¹¶è®¾ç½®errnoä¸ºEAGIN/EWOULDBLOCKã€‚\næˆ‘è§‰å¾—å¤ªå¤§ä¸»è¦æ˜¯ä¼šæµªè´¹æ ˆç©ºé—´ï¼Œå› ä¸ºæ¯æ¬¡readä¸ä¸€å®šä¼šè¿”å›è¿™ä¹ˆå¤šæ•°æ®","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1603538614,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1803259,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/83/fb/621adceb.jpg","nickname":"linker","note":"","ucode":"6C5799F2FC2C82","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":210988,"discussion_content":"ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±éœ€è¦åå¤è°ƒè¯•å¾—åˆ°ä¸€ä¸ªç›¸å¯¹æœ€ä½³å€¼ï¼Œå¤ªå¤§äº†é€ æˆæ ˆæº¢å‡º\nç¬¬äºŒä¸ªé—®é¢˜ï¼Œä¸€ä¸ªæ˜¯é€ æˆç¢ç‰‡ï¼Œå¦ä¸€ä¸ªå®¹æ˜“å‡ºé—®é¢˜ï¼ˆä¸€æ—¦å¿˜äº†é‡Šæ”¾ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584796852,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132508,"user_name":"yusuf","can_delete":false,"product_type":"c1","uid":1170784,"ip_address":"","ucode":"9F32149B2ADDA0","user_header":"https://static001.geekbang.org/account/avatar/00/11/dd/60/eae432c6.jpg","comment_is_top":false,"comment_ctime":1568158204,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"14453060092","product_id":100032701,"comment_content":"1ã€å¤§å°ä¸€èˆ¬ä¸º2çš„å¤šå°‘æ¬¡æ–¹<br>2ã€ä¸èƒ½æ¢æˆåŠ¨æ€åˆ†é…ã€‚åœ¨readä¸­éœ€è¦sizeofæŒ‡æ˜æ¥å—æ•°æ®çš„æœ€å¤§é•¿åº¦ï¼Œmallocè¿”å›çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œæ±‚æŒ‡é’ˆçš„sizeofæ—¶è¿”å›çš„æ˜¯æŒ‡é’ˆæ‰€å å†…å­˜å¤§å°ï¼ˆ32ä½ä¸º4ï¼Œ64ä½ä¸º8ï¼‰ï¼Œè·Ÿå®é™…æ•°æ®çš„å¤§å°ä¸ä¸€è‡´","like_count":3,"discussions":[{"author":{"id":1258295,"avatar":"https://static001.geekbang.org/account/avatar/00/13/33/37/94746ab7.jpg","nickname":"ç¬›å£°ä½•å¤„","note":"","ucode":"A8E67932357888","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":9582,"discussion_content":"å¯ä»¥æ¢æˆåŠ¨æ€åˆ†é…ï¼Œreadä¸­æŒ‡æ˜é•¿åº¦ä¸ä¸€å®šè¦ç”¨sizeof","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1568192787,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1659177,"avatar":"https://static001.geekbang.org/account/avatar/00/19/51/29/24739c58.jpg","nickname":"å‡‰äººã€‚","note":"","ucode":"4DB16004A62015","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":117319,"discussion_content":"åŠ¨æ€åˆ†é…ç†è§£ä¸å¤Ÿï¼Œè¿™åº”è¯¥ä¼šä¸€ç›´æ‰©å®¹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578108239,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1170784,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/60/eae432c6.jpg","nickname":"yusuf","note":"","ucode":"9F32149B2ADDA0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":9612,"discussion_content":"æ„Ÿè§‰åº”è¯¥æ˜¯ä¸èƒ½çš„ã€‚åŠ¨æ€åˆ†é…ä¸€èˆ¬æ˜¯è¯´ç”¨å¤šå°‘å­—èŠ‚å°±åˆ†é…å¤šå°‘å­—èŠ‚ï¼Œreadä¼šåŒæ—¶è¿”å›å­—èŠ‚æ•°å’Œæ•°æ®ã€‚å¦‚æœå…ˆåŠ¨æ€åˆ†é…çš„è¯ï¼Œä¸çŸ¥é“åé¢readè¯»å–çš„å­—èŠ‚æ•°ï¼Œå°±æ²¡æ³•ç”³è¯·æ°åˆ°å¥½å¤„çš„ç©ºé—´ï¼›è€Œå¦‚æœreadååŠ¨æ€åˆ†é…çš„è¯ï¼Œèƒ½çŸ¥é“readçš„å­—èŠ‚æ•°ï¼Œä½†å¯¹åº”çš„æ•°æ®åˆæ— æ³•ä¿å­˜ä¸‹æ¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568195931,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132789,"user_name":"J.M.Liu","can_delete":false,"product_type":"c1","uid":1200037,"ip_address":"","ucode":"B2CB84B8E923A6","user_header":"https://static001.geekbang.org/account/avatar/00/12/4f/a5/71358d7b.jpg","comment_is_top":false,"comment_ctime":1568219836,"is_pvip":false,"replies":[{"id":"51631","content":"æ˜¯çš„ï¼Œå¦‚æœæ˜¯è¿™æ ·ï¼Œåªèƒ½è¯´æˆ‘ä»¬åŒæ–¹çš„é€šä¿¡åè®®æ²¡æœ‰å¾—åˆ°ä¸¥æ ¼çš„éµå®ˆã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1568887803,"ip_address":"","comment_id":132789,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10158154428","product_id":100032701,"comment_content":"è€å¸ˆï¼Œç¬¬äºŒä¸ªä¾‹å­ä¸­ï¼ŒåŠæ—¶åŠ ä¸Šäº†msg_lengthå’Œç¼“å†²åŒºlengthçš„å¤§å°æ¯”è¾ƒï¼Œå¦‚æœmsg_lengthå†™å¾—å¾ˆå¤§ï¼ˆä½†å°äºlengthï¼‰è€Œå®é™…æ•°æ®æ²¡æœ‰é‚£ä¹ˆå¤§æ—¶ï¼ŒæœåŠ¡å™¨ä¹Ÿä¼šé˜»å¡åœ¨readä¸Šå§ï¼Ÿæ‰€ä»¥è¯´åˆ¤æ–­msg_length&lt;=lengthå¹¶ä¸èƒ½æ¥readé˜»å¡çš„é—®é¢˜å‘€ï¼Œåªèƒ½è§£å†…å­˜æº¢å‡ºçš„é—®é¢˜ã€‚","like_count":2,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467119,"discussion_content":"æ˜¯çš„ï¼Œå¦‚æœæ˜¯è¿™æ ·ï¼Œåªèƒ½è¯´æˆ‘ä»¬åŒæ–¹çš„é€šä¿¡åè®®æ²¡æœ‰å¾—åˆ°ä¸¥æ ¼çš„éµå®ˆã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568887803,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":287646,"user_name":"é»„æ¯…","can_delete":false,"product_type":"c1","uid":1159363,"ip_address":"","ucode":"201C9FD58CF90B","user_header":"https://static001.geekbang.org/account/avatar/00/11/b0/c3/e1e2c097.jpg","comment_is_top":false,"comment_ctime":1618066916,"is_pvip":false,"replies":[{"id":"104493","content":"è¿™è¦çœ‹ä½ çš„ç¨‹åºæ˜¯æ€ä¹ˆè®¾è®¡çš„ï¼Œå¦‚æœæ˜¯é¢„å…ˆè¯»å–äº†512å­—èŠ‚ï¼Œé‚£ç¡®å®200åçš„æ•°æ®ï¼Œä½ å¾—æƒ³åŠæ³•é‡æ–°&quot;ç¼“å†²&quot;èµ·æ¥ï¼Œä»¥ä¾¿å’Œåé¢çš„æ•°æ®æ‹¼å‡‘æˆå®Œæ•´æ„ä¹‰çš„å­—èŠ‚æµï¼›å¦‚æœä½ æ˜¯ä¸€ä¸ªä¸€ä¸ªå­—èŠ‚è¯»çš„ï¼ŒçŸ¥é“è¯»åˆ°\\nï¼Œé‚£ä¹ˆåˆ™ä¸å¿…äº†ã€‚<br><br>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯ç”¨ç¼“å†²æ¥åšè¿™ä»¶äº‹æƒ…ï¼Œä½ å¯ä»¥è·³åˆ°åé¢çš„Bufferè®¾è®¡éƒ¨åˆ†ï¼Œé€šè¿‡æŒ‡é’ˆæ¥æŒ‡å‘å½“å‰æ¶ˆè´¹çš„ä½ç½®ï¼Œå’Œæ•°æ®è¯»å–çš„ä½ç½®åšä¸€ä¸ªæ¯”è¾ƒï¼Œå°±å¯ä»¥ä¸ç”¨æ¯æ¬¡é‡æ–°ç”ŸæˆåŠ¨æ€åˆ†é…çš„bufferã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1618140504,"ip_address":"","comment_id":287646,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5913034212","product_id":100032701,"comment_content":"å…³äºæ€è€ƒé¢˜çš„ç¬¬äºŒä¸ªé—®é¢˜ï¼Œæœ‰ä¸ªç–‘é—®ï¼Œå¦‚æœé€šè¿‡åŠ¨æ€åˆ†é…read_bufferï¼Œå‡è®¾recvèƒ½è¯»å–512ä¸ªå­—èŠ‚ï¼Œè¿›ä¸€æ­¥å‡è®¾ç¬¬200ä¸ªå­—ç¬¦æ˜¯\\nï¼Œé‚£ä¹ˆåœ¨read_lineé€€å‡ºå‰èƒ½deleteå—ï¼Ÿå¦‚æœdeleteçš„è¯ï¼Œä¼šä¸ä¼šç¬¬201åˆ°512å­—èŠ‚çš„æ•°æ®ä¸¢å¤±ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518378,"discussion_content":"è¿™è¦çœ‹ä½ çš„ç¨‹åºæ˜¯æ€ä¹ˆè®¾è®¡çš„ï¼Œå¦‚æœæ˜¯é¢„å…ˆè¯»å–äº†512å­—èŠ‚ï¼Œé‚£ç¡®å®200åçš„æ•°æ®ï¼Œä½ å¾—æƒ³åŠæ³•é‡æ–°&amp;quot;ç¼“å†²&amp;quot;èµ·æ¥ï¼Œä»¥ä¾¿å’Œåé¢çš„æ•°æ®æ‹¼å‡‘æˆå®Œæ•´æ„ä¹‰çš„å­—èŠ‚æµï¼›å¦‚æœä½ æ˜¯ä¸€ä¸ªä¸€ä¸ªå­—èŠ‚è¯»çš„ï¼ŒçŸ¥é“è¯»åˆ°\\nï¼Œé‚£ä¹ˆåˆ™ä¸å¿…äº†ã€‚\n\nä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯ç”¨ç¼“å†²æ¥åšè¿™ä»¶äº‹æƒ…ï¼Œä½ å¯ä»¥è·³åˆ°åé¢çš„Bufferè®¾è®¡éƒ¨åˆ†ï¼Œé€šè¿‡æŒ‡é’ˆæ¥æŒ‡å‘å½“å‰æ¶ˆè´¹çš„ä½ç½®ï¼Œå’Œæ•°æ®è¯»å–çš„ä½ç½®åšä¸€ä¸ªæ¯”è¾ƒï¼Œå°±å¯ä»¥ä¸ç”¨æ¯æ¬¡é‡æ–°ç”ŸæˆåŠ¨æ€åˆ†é…çš„bufferã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618140504,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":346465,"user_name":"æ— åæ°","can_delete":false,"product_type":"c1","uid":1256121,"ip_address":"","ucode":"584E697AE276AB","user_header":"https://static001.geekbang.org/account/avatar/00/13/2a/b9/2bf8cc89.jpg","comment_is_top":false,"comment_ctime":1653172712,"is_pvip":false,"replies":[{"id":"126587","content":"ä½ ç»†å“ï¼š<br>int nBytes = recv(connfd, buffer, sizeof(buffer), 0);<br>int nBytes = recv(connfd, buffer, sizeof(buffer)-1, 0);","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1618647","ctime":1653808135,"ip_address":"","comment_id":346465,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1653172712","product_id":100032701,"comment_content":"ä¸´æ—¶ç¼“å­˜åŒºï¼Œé‚£ä¸ªâ€œå¾®å°ç‘•ç–µâ€ï¼Œå‰åä¸¤æ®µç¨‹åºç¨‹åºæ²¡æœ‰åŒºåˆ«å•ŠğŸ˜„ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":574035,"discussion_content":"ä½ ç»†å“ï¼š\nint nBytes = recv(connfd, buffer, sizeof(buffer), 0);\nint nBytes = recv(connfd, buffer, sizeof(buffer)-1, 0);","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653808135,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":340308,"user_name":"çºªç¥ç±½","can_delete":false,"product_type":"c1","uid":1409466,"ip_address":"","ucode":"442F0120F98894","user_header":"https://static001.geekbang.org/account/avatar/00/15/81/ba/b8ed949a.jpg","comment_is_top":false,"comment_ctime":1648733755,"is_pvip":true,"replies":[{"id":"124555","content":"ä½ è¯´çš„æ²¡é”™ï¼Œæ˜¯éœ€è¦æŠŠå‰©ä¸‹çš„412å­—èŠ‚ä¿å­˜ä¸‹æ¥çš„ã€‚è¿™ä¸ªä¾‹å­åªæ˜¯å¯¹readlineè¯¥æ³¨æ„çš„äº‹é¡¹è¿›è¡Œäº†æ¨¡æ‹Ÿåˆ†æã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1618647","ctime":1648989914,"ip_address":"","comment_id":340308,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1648733755","product_id":100032701,"comment_content":"ç¬¬ä¸‰ä¸ªä¾‹å­æœ‰ç‚¹ç–‘é—®ï¼Œå¦‚æœç¬¬ä¸€æ¬¡è°ƒç”¨readlineï¼Œè¯»å–512å­—èŠ‚ï¼ŒæŸ¥åˆ°ç¬¬100å­—èŠ‚æ˜¯æ¢è¡Œç¬¦ï¼Œç„¶åå°±è¿”å›ç»“æœï¼Œè¿™æ ·å­å‰©ä¸‹çš„412å­—èŠ‚ä¸å°±ä¼šä¸¢å¤±äº†ã€‚æ˜¯ä¸æ˜¯åº”è¯¥å…ˆæŠŠä¸Šæ¬¡readlineçš„æ•°æ®å¤„ç†å®Œåœ¨è¿›è¡Œæ–°çš„recvã€‚","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559825,"discussion_content":"ä½ è¯´çš„æ²¡é”™ï¼Œæ˜¯éœ€è¦æŠŠå‰©ä¸‹çš„412å­—èŠ‚ä¿å­˜ä¸‹æ¥çš„ã€‚è¿™ä¸ªä¾‹å­åªæ˜¯å¯¹readlineè¯¥æ³¨æ„çš„äº‹é¡¹è¿›è¡Œäº†æ¨¡æ‹Ÿåˆ†æã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648989914,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":318888,"user_name":"è‹å¿—è¾‰","can_delete":false,"product_type":"c1","uid":1068927,"ip_address":"","ucode":"39B25CE21C04EE","user_header":"https://static001.geekbang.org/account/avatar/00/10/4f/7f/5dc11380.jpg","comment_is_top":false,"comment_ctime":1635474339,"is_pvip":false,"replies":[{"id":"115707","content":"è¯»å–çš„æ—¶å€™ï¼Œæ˜¯ä¸€æ¬¡æ€§å°è¯•è¯»å–æœ€å¤š 512 å­—èŠ‚ã€‚<br>æœ€å¤–é¢çš„lengthå¾ªç¯å®é™…ä¸Šæ§åˆ¶çš„æ˜¯æ‹·è´ä¸´æ—¶ç¼“å†²åŒºå­—ç¬¦çš„å·¥ä½œã€‚<br>æ‰€ä»¥ï¼Œè¿˜æ˜¯è¯»å–ä¸€æ¬¡ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1635669385,"ip_address":"","comment_id":318888,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1635474339","product_id":100032701,"comment_content":"ç¬¬ä¸‰ä¸ªä¾‹å­ä¿®æ”¹åçš„ç‰ˆæœ¬ï¼Œå¦‚æœlengthä¸º10å‘é€çš„ä¹Ÿæ˜¯012345678\\nä¸€å…±10ä¸ªï¼Œç”±äº--length,æ‰€ä»¥ä¸€æ¬¡æœ€å¤šè¯»9ä¸ªï¼Œè¦è¯»å®Œå®Œæ•´çš„æ¶ˆæ¯ï¼Œéœ€è¦è¯»ä¸¤æ¬¡å§","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529416,"discussion_content":"è¯»å–çš„æ—¶å€™ï¼Œæ˜¯ä¸€æ¬¡æ€§å°è¯•è¯»å–æœ€å¤š 512 å­—èŠ‚ã€‚\næœ€å¤–é¢çš„lengthå¾ªç¯å®é™…ä¸Šæ§åˆ¶çš„æ˜¯æ‹·è´ä¸´æ—¶ç¼“å†²åŒºå­—ç¬¦çš„å·¥ä½œã€‚\næ‰€ä»¥ï¼Œè¿˜æ˜¯è¯»å–ä¸€æ¬¡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635669385,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":305869,"user_name":"åƒçŒ«çš„é±¼","can_delete":false,"product_type":"c1","uid":2007786,"ip_address":"","ucode":"DC15372C47A0CD","user_header":"https://static001.geekbang.org/account/avatar/00/1e/a2/ea/8f913dfa.jpg","comment_is_top":false,"comment_ctime":1628214790,"is_pvip":false,"replies":[{"id":"111680","content":"è¿™ä¸ªä¾‹å­çš„å‡è®¾å°±æ˜¯\\nä¸ºæŠ¥æ–‡çš„åˆ†ç•Œç¬¦ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1629636962,"ip_address":"","comment_id":305869,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1628214790","product_id":100032701,"comment_content":"ç¬¬ä¸‰ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœrecvè¯»å–å‡ºçš„æ•°æ®æ ¼å¼å¦‚ä¸‹ â€œxxx\\n yyy\\nâ€ï¼Œç„¶ålength=4ï¼Œæ­¤æ—¶åœ¨ä¸å°±åªè¯»å‡º â€œxxx\\nâ€ï¼Œä½†æ˜¯ä¸‹ä¸€æ¬¡è°ƒç”¨recvï¼Œâ€œyyy\\nâ€æ²¡è¢«åº”ç”¨å°±è¢«ä¸¢å¼ƒäº†ã€‚ã€‚ã€‚","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524543,"discussion_content":"è¿™ä¸ªä¾‹å­çš„å‡è®¾å°±æ˜¯\\nä¸ºæŠ¥æ–‡çš„åˆ†ç•Œç¬¦ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629636962,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":286756,"user_name":"null","can_delete":false,"product_type":"c1","uid":1024294,"ip_address":"","ucode":"F9039EFED6B55D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","comment_is_top":false,"comment_ctime":1617552861,"is_pvip":false,"replies":[{"id":"104486","content":"ä¸ä¼šå•Šï¼Œå› ä¸ºreadlineè¿™ä¸ªå‡½æ•°æ˜¯è¢«åå¤è°ƒç”¨çš„ï¼Œæ‰€ä»¥ä¼šè¯»åˆ°ç¬¬äºŒè¡Œ(ä¹Ÿå°±æ˜¯ç¬¬äºŒä¸ªæ¢è¡Œç¬¦)ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1618136099,"ip_address":"","comment_id":286756,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1617552861","product_id":100032701,"comment_content":"åŸæ–‡ï¼š<br>è¿™ä¸ªå‡½æ•°ä¸€æ¬¡æ€§è¯»å–æœ€å¤š 512 å­—èŠ‚åˆ°ä¸´æ—¶ç¼“å†²åŒºï¼Œä¹‹åå°†ä¸´æ—¶ç¼“å†²åŒºçš„å­—ç¬¦ä¸€ä¸ªä¸€ä¸ªæ‹·è´åˆ°åº”ç”¨ç¨‹åºæœ€ç»ˆçš„ç¼“å†²åŒºä¸­ã€‚<br>åœ¨ç¨‹åºçš„ 26-28 è¡Œï¼Œåˆ¤æ–­æ˜¯å¦è¯»åˆ°æ¢è¡Œç¬¦ï¼Œå¦‚æœè¯»åˆ°åˆ™å°†åº”ç”¨ç¨‹åºæœ€ç»ˆç¼“å†²åŒºæˆªæ–­ï¼Œè¿”å›æœ€ç»ˆè¯»å–çš„å­—ç¬¦ä¸ªæ•°ã€‚<br><br><br>é—®é¢˜ï¼š<br>å‡è®¾ client åœ¨ä¸€ä¸ªè¿æ¥ä¸­ï¼Œå‘äº†2æ¬¡è¯·æ±‚ï¼š<br>ç¬¬ä¸€æ¬¡å‘äº†1000ä¸ªå­—ç¬¦(åŒ…å«æ¢è¡Œç¬¦)ï¼›<br>ç¬¬äºŒæ¬¡å‘äº†24ä¸ªå­—ç¬¦(åŒ…å«æ¢è¡Œç¬¦)ã€‚<br>å¯¹ç«¯ server åœ¨ socket ç¼“å†²åŒºï¼Œæ¯æ¬¡éƒ½è¯»å– 512 ä¸ªå­—ç¬¦ã€‚è¯»åˆ°æ¢è¡Œå°±æˆªæ–­ã€‚é‚£ç¬¬äºŒæ¬¡è¯·æ±‚çš„24ä¸ªå­—ç¬¦ä¸å°±è¢«æˆªæ–­ä¸¢å¼ƒäº†ï¼Œåº”ç”¨ç¨‹åºå†ä¹Ÿè¯»ä¸åˆ°è¿™24å­—ç¬¦äº†ã€‚<br>è¯·é—®è€å¸ˆï¼Œä¼šå‡ºç°è¿™ç§æƒ…å†µä¹ˆï¼Ÿè°¢è°¢","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518080,"discussion_content":"ä¸ä¼šå•Šï¼Œå› ä¸ºreadlineè¿™ä¸ªå‡½æ•°æ˜¯è¢«åå¤è°ƒç”¨çš„ï¼Œæ‰€ä»¥ä¼šè¯»åˆ°ç¬¬äºŒè¡Œ(ä¹Ÿå°±æ˜¯ç¬¬äºŒä¸ªæ¢è¡Œç¬¦)ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618136099,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":276192,"user_name":"éƒ­æ™“æœ‹","can_delete":false,"product_type":"c1","uid":2368802,"ip_address":"","ucode":"7D6FAEB1C5FB2A","user_header":"","comment_is_top":false,"comment_ctime":1611826510,"is_pvip":false,"replies":[{"id":"100427","content":"ä½ æ˜¯è¯´æ ·ä¾‹çš„readlineç¨‹åºæœ‰é—®é¢˜ä¹ˆï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1612101808,"ip_address":"","comment_id":276192,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1611826510","product_id":100032701,"comment_content":"ä½ å¥½ï¼Œå¯¹äºæœ€åä¸€ä¸ªä¾‹å­æˆ‘æ„Ÿè§‰å¥½åƒæœ‰é—®é¢˜ï¼Œ--lengthè¿™ç§å†™æ³•ä¼šè¯»ä¸åˆ°012345678\\nè¿™ä¸ªå­—ç¬¦ä¸²çš„ï¼Œæœ€ç»ˆå¯¼è‡´è¯»åˆ°çš„å­—ç¬¦ä¸²æ²¡æœ‰ç»“æŸç¬¦\\0ã€‚length--å¯¼è‡´è¶Šç•Œçš„åŸå› æ˜¯*buffer++ = c;ã€‚ä¸åº”è¯¥å…ˆæ‰§è¡Œbuffer++ï¼Œåº”è¯¥æ”¾åˆ°ifè¯­å¥ä¹‹åã€‚","like_count":1,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514625,"discussion_content":"ä½ æ˜¯è¯´æ ·ä¾‹çš„readlineç¨‹åºæœ‰é—®é¢˜ä¹ˆï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612101808,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":235864,"user_name":"NEVER SETTLE","can_delete":false,"product_type":"c1","uid":1101894,"ip_address":"","ucode":"9C86BDAFDBF768","user_header":"https://static001.geekbang.org/account/avatar/00/10/d0/46/1a9229b3.jpg","comment_is_top":false,"comment_ctime":1595228237,"is_pvip":false,"replies":[{"id":"87599","content":"åŸæ¥é—®é¢˜åœ¨è¿™å•Šã€‚<br><br>ä¸ä¼šå•Šï¼Œå¯ä»¥ç»§ç»­è°ƒç”¨recvå‡½æ•°æ¥è¯»ä¸‹ä¸€ä¸ª512å­—èŠ‚ã€‚åœ¨ç½‘ç»œå­—èŠ‚æµå¤„ç†ä¸­ï¼Œå¾ªç¯è¯»å–æ˜¯ä¸€ä¸ªå¸¸è§çš„æŠ€å·§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1595679868,"ip_address":"","comment_id":235864,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1595228237","product_id":100032701,"comment_content":"â€œç¬¬äºŒä¸ªç‰ˆæœ¬ï¼Œè¿™ä¸ªå‡½æ•°ä¸€æ¬¡æ€§è¯»å–æœ€å¤š 512 å­—èŠ‚åˆ°ä¸´æ—¶ç¼“å†²åŒºï¼Œä¹‹åå°†ä¸´æ—¶ç¼“å†²åŒºçš„å­—ç¬¦ä¸€ä¸ªä¸€ä¸ªæ‹·è´åˆ°åº”ç”¨ç¨‹åºæœ€ç»ˆçš„ç¼“å†²åŒºä¸­â€œ   è€å¸ˆï¼Œé’ˆå¯¹ç¬¬äºŒä¸ªç‰ˆæœ¬ï¼Œæˆ‘æœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœâ€œ\\nâ€ä¹‹åè¿˜ä¼šæœ‰å†…å®¹ï¼Œå½“è°ƒç”¨recvå‡½æ•°åï¼Œå‡å¦‚è¿”å›512ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯ç¨‹åºåªå–äº†â€œ\\nâ€ä¹‹å‰çš„å­—ç¬¦ä¸²ï¼Œé‚£â€œ\\nâ€ä¹‹åçš„å†…å®¹æ˜¯ä¸æ˜¯å°±æ˜¯ä¸¢å¼ƒäº†ã€‚","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501855,"discussion_content":"åŸæ¥é—®é¢˜åœ¨è¿™å•Šã€‚\n\nä¸ä¼šå•Šï¼Œå¯ä»¥ç»§ç»­è°ƒç”¨recvå‡½æ•°æ¥è¯»ä¸‹ä¸€ä¸ª512å­—èŠ‚ã€‚åœ¨ç½‘ç»œå­—èŠ‚æµå¤„ç†ä¸­ï¼Œå¾ªç¯è¯»å–æ˜¯ä¸€ä¸ªå¸¸è§çš„æŠ€å·§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595679868,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1471387,"avatar":"https://static001.geekbang.org/account/avatar/00/16/73/9b/67a38926.jpg","nickname":"keepgoing","note":"","ucode":"A2FE0687FB17E0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":296084,"discussion_content":"è¿™ä¸ªåŒå­¦çš„æ„æ€æ˜¯read_bufferä¸­\\nä¹‹åçš„æ•°æ®æ˜¯ä¸æ˜¯å°±ç›´æ¥ä¸¢å¼ƒäº†ï¼Œå…¶å®æ²¡æœ‰ï¼Œå› ä¸ºè¿™ä¸ªå˜é‡æ˜¯static","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1596447769,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1024294,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","nickname":"null","note":"","ucode":"F9039EFED6B55D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1471387,"avatar":"https://static001.geekbang.org/account/avatar/00/16/73/9b/67a38926.jpg","nickname":"keepgoing","note":"","ucode":"A2FE0687FB17E0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364701,"discussion_content":"æ„Ÿè°¢ï¼Œæ˜ç™½äº†ï¼Œä»socketè¯»å–çš„æ•°æ®ï¼Œåªè¦ä¸é‡Šæ”¾ read_bufferï¼Œæ•°æ®ä»åœ¨ read_bufferä¸­ã€‚ä¸‹æ¬¡å†è°ƒç”¨ read_line å‡½æ•°å°±å¥½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617553348,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":296084,"ip_address":""},"score":364701,"extra":""}]}]},{"had_liked":false,"id":235863,"user_name":"NEVER SETTLE","can_delete":false,"product_type":"c1","uid":1101894,"ip_address":"","ucode":"9C86BDAFDBF768","user_header":"https://static001.geekbang.org/account/avatar/00/10/d0/46/1a9229b3.jpg","comment_is_top":false,"comment_ctime":1595228041,"is_pvip":false,"replies":[{"id":"87598","content":"æ²¡çœ‹æ‡‚é—®é¢˜.....","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1595679749,"ip_address":"","comment_id":235863,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1595228041","product_id":100032701,"comment_content":"â€œç¬¬äºŒä¸ªç‰ˆæœ¬ï¼Œè¿™ä¸ªå‡½æ•°ä¸€æ¬¡æ€§è¯»å–æœ€å¤š 512 å­—èŠ‚åˆ°ä¸´æ—¶ç¼“å†²åŒºï¼Œä¹‹åå°†ä¸´æ—¶ç¼“å†²åŒºçš„å­—ç¬¦ä¸€ä¸ªä¸€ä¸ªæ‹·è´åˆ°åº”ç”¨ç¨‹åºæœ€ç»ˆçš„ç¼“å†²åŒºä¸­ã€‚â€œ ","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501854,"discussion_content":"æ²¡çœ‹æ‡‚é—®é¢˜.....","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595679749,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":235772,"user_name":"YC","can_delete":false,"product_type":"c1","uid":2029526,"ip_address":"","ucode":"487213D7B37601","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f7/d6/9ebe565c.jpg","comment_is_top":false,"comment_ctime":1595186614,"is_pvip":false,"replies":[{"id":"87597","content":"æ³¨æ„æ˜¯å¢åŠ ä¸€ä¸ª\\0å“¦ï¼ŒåŸæ¥çš„æ¢è¡Œç¬¦è¿˜æ˜¯ä¼šè¯»å–çš„ï¼Œæ‰€ä»¥ä¼šæº¢å‡ºçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1595679670,"ip_address":"","comment_id":235772,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1595186614","product_id":100032701,"comment_content":"<br>&#47;&#47;è¾“å…¥å­—ç¬¦ä¸º: 012345678\\n<br>char buf[10]<br>readline(fd, buf, 10)<br><br>ä¸ºä»€ä¹ˆä¼šæº¢å‡ºå‘¢ï¼Ÿä¸åº”è¯¥åˆšåˆšå¥½å¡«æ»¡bufferå˜›ã€‚<br>0123456789\\næ‰ä¼šæº¢å‡ºå§","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501828,"discussion_content":"æ³¨æ„æ˜¯å¢åŠ ä¸€ä¸ª\\0å“¦ï¼ŒåŸæ¥çš„æ¢è¡Œç¬¦è¿˜æ˜¯ä¼šè¯»å–çš„ï¼Œæ‰€ä»¥ä¼šæº¢å‡ºçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595679670,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":170975,"user_name":"lupguo","can_delete":false,"product_type":"c1","uid":1009098,"ip_address":"","ucode":"1B55A01DF78647","user_header":"https://static001.geekbang.org/account/avatar/00/0f/65/ca/38dcd55a.jpg","comment_is_top":false,"comment_ctime":1578807998,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578807998","product_id":100032701,"comment_content":"è¯¾åé¢˜ï¼Œæˆ‘çš„ç†è§£æ˜¯åº”ç”¨ç¨‹åºç¼“å†²åŒºå¤§å°è®¾ç½®ï¼Œå¦‚æœæ˜¯é¢„åˆ†é…bufferæƒ…å†µï¼Œåº”è¯¥æ ¹æ®ç¨‹åºåœºæ™¯æ¥çš„ã€‚è¿™ä¸ªbufferæ˜¯é€šè¿‡recvç³»ç»Ÿè°ƒç”¨ä»å†…æ ¸ç©ºé—´å°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå¦‚æœbufferè¿‡å°ï¼Œä¼šå¯¼è‡´éœ€è¦å¤šæ¬¡ç³»ç»Ÿè°ƒç”¨çš„å¼€é”€ï¼Œè¿‡å¤§åˆä¼šå¯¼è‡´ç”¨æˆ·ç©ºé—´æµªè´¹ï¼Œå› æ­¤éœ€è¦é€‰æ‹©åˆé€‚å¤§å°ï¼›ç¬¬äºŒä¸ªæ˜¯å¯ä»¥é€‰æ‹©åŠ¨æ€mallocï¼Œåªæ˜¯éœ€è¦æ³¨æ„é‡Šæ”¾ï¼Œå¦åˆ™ä¼šæœ‰å†…å­˜æ³„éœ²çš„é£é™©ï¼›å½“ç„¶ä¹Ÿå¯ä»¥åŸºäºgcæœºåˆ¶æ¥ç»Ÿä¸€å›æ”¶ï¼","like_count":1},{"had_liked":false,"id":164436,"user_name":"æ»¡æ€€","can_delete":false,"product_type":"c1","uid":1483113,"ip_address":"","ucode":"EFAC662A37D684","user_header":"https://static001.geekbang.org/account/avatar/00/16/a1/69/0ddda908.jpg","comment_is_top":false,"comment_ctime":1576989691,"is_pvip":false,"replies":[{"id":"63897","content":"æŠ±æ­‰ï¼Œè¿™æ®µæ—¶é—´ä¸€ç›´å¿™ï¼Œè´´ä¸‹ä½ çš„ä»£ç é“¾æ¥","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1577603981,"ip_address":"","comment_id":164436,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1576989691","product_id":100032701,"comment_content":"è€å¸ˆèƒ½å¸®æˆ‘çœ‹ä¸€ä¸‹ä»£ç å— æˆ‘æŠŠè¿™æ®µæ—¶é—´å­¦ä¹ åˆ°çš„ æ•´åˆåœ¨ä¸€èµ· ç°åœ¨æ‰§è¡Œçš„æ—¶å€™å‡ºäº†ä¸€ç‚¹é—®é¢˜ åˆ†æä¸å‡ºé”™è¯¯åŸå› ","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478766,"discussion_content":"æŠ±æ­‰ï¼Œè¿™æ®µæ—¶é—´ä¸€ç›´å¿™ï¼Œè´´ä¸‹ä½ çš„ä»£ç é“¾æ¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577603981,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1483113,"avatar":"https://static001.geekbang.org/account/avatar/00/16/a1/69/0ddda908.jpg","nickname":"æ»¡æ€€","note":"","ucode":"EFAC662A37D684","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":107755,"discussion_content":"å·²ç»è§£å†³å•¦ï½éº»çƒ¦è€å¸ˆäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577604575,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":154780,"user_name":"é’±","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1574562051,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574562051","product_id":100032701,"comment_content":"ğŸ˜…è¯»å®Œå¥½åƒæ˜ç™½äº†ï¼Œå…¶å®åº”è¯¥æ²¡æ˜ç™½ï¼Œå› ä¸ºï¼Œè¯¾åæ€è€ƒé¢˜ï¼Œç­”ä¸ä¸Šæ¥ï¼<br><br>åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œæ˜¯å¦åšå¥½äº†å¯¹å„ç§å¼‚å¸¸è¾¹ç•Œçš„æ£€æµ‹ï¼Œå°†å†³å®šæˆ‘ä»¬çš„ç¨‹åºåœ¨æ¶åŠ£æƒ…å†µä¸‹çš„ç¨³å®šæ€§ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸€å®šè¦æ—¶åˆ»æé†’è‡ªå·±åšå¥½åº”å¯¹å„ç§å¤æ‚æƒ…å†µçš„å‡†å¤‡ï¼Œè¿™é‡Œçš„å¼‚å¸¸æƒ…å†µåŒ…æ‹¬ç¼“å†²åŒºæº¢å‡ºã€æŒ‡é’ˆé”™è¯¯ã€è¿æ¥è¶…æ—¶æ£€æµ‹ç­‰ã€‚","like_count":1},{"had_liked":false,"id":148594,"user_name":"ç‹ç››æ­¦","can_delete":false,"product_type":"c1","uid":1182516,"ip_address":"","ucode":"DE7EF246D3DCE8","user_header":"https://static001.geekbang.org/account/avatar/00/12/0b/34/f41d73a4.jpg","comment_is_top":false,"comment_ctime":1573035699,"is_pvip":false,"replies":[{"id":"57488","content":"æ˜¯è¿™æ ·ï¼Œå£°æ˜äº†ä¸€ä¸ª128å­—èŠ‚çš„æ•°ç»„ï¼Œä½†æ˜¯å®é™…ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯¹ç¬¬129ä¸ªå…ƒç´ è¿›è¡Œäº†èµ‹å€¼æ“ä½œï¼Œç›¸å½“äºè®¿é—®äº†ä¸€ä¸ªæ²¡æœ‰å£°æ˜çš„å†…å­˜åœ°å€ï¼Œå¯¼è‡´äº§ç”Ÿè®¿é—®é”™è¯¯ï¼Œç¨‹åºä¼šé€€å‡ºã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1573283108,"ip_address":"","comment_id":148594,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1573035699","product_id":100032701,"comment_content":"ä½†ä»”ç»†çœ‹ä¸€ä¸‹ï¼Œè¿™æ®µä»£ç å¾ˆæœ‰å¯èƒ½ä¼šäº§ç”Ÿä¸‹é¢çš„ç»“æœã€‚   ä¸‹é¢è´´çš„æ˜¯ä¸¤å¥ä»£ç å˜é‡å£°æ˜å’Œèµ‹å€¼ï¼Œå¹¶ä¸æ˜¯æ‰€è°“çš„ç»“æœï¼Œæ±‚è§£","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473545,"discussion_content":"æ˜¯è¿™æ ·ï¼Œå£°æ˜äº†ä¸€ä¸ª128å­—èŠ‚çš„æ•°ç»„ï¼Œä½†æ˜¯å®é™…ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯¹ç¬¬129ä¸ªå…ƒç´ è¿›è¡Œäº†èµ‹å€¼æ“ä½œï¼Œç›¸å½“äºè®¿é—®äº†ä¸€ä¸ªæ²¡æœ‰å£°æ˜çš„å†…å­˜åœ°å€ï¼Œå¯¼è‡´äº§ç”Ÿè®¿é—®é”™è¯¯ï¼Œç¨‹åºä¼šé€€å‡ºã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573283108,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":148592,"user_name":"ç‹ç››æ­¦","can_delete":false,"product_type":"c1","uid":1182516,"ip_address":"","ucode":"DE7EF246D3DCE8","user_header":"https://static001.geekbang.org/account/avatar/00/12/0b/34/f41d73a4.jpg","comment_is_top":false,"comment_ctime":1573035415,"is_pvip":false,"replies":[{"id":"57487","content":"<br>char buffer[128];<br>buffer[128] = &#39;\\0&#39;;<br><br>æ–‡ç¨¿ä¸­ç»™å‡ºäº†ï¼Œå˜æˆç¼“å†²åŒºæº¢å‡ºäº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1573282976,"ip_address":"","comment_id":148592,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1573035415","product_id":100032701,"comment_content":"é€šè¿‡ recv è¯»å–çš„å­—ç¬¦æ•°ä¸º 128 æ—¶ï¼Œå°±ä¼šæ˜¯æ–‡ç¨¿ä¸­çš„ç»“æœã€‚   ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿæ–‡ç¨¿é‡Œå¹¶æ²¡ç»™å‡ºç›¸å…³ç»“æœ","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473544,"discussion_content":"\nchar buffer[128];\nbuffer[128] = &amp;#39;\\0&amp;#39;;\n\næ–‡ç¨¿ä¸­ç»™å‡ºäº†ï¼Œå˜æˆç¼“å†²åŒºæº¢å‡ºäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573282976,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":133033,"user_name":"ä¸€å‘¨æ€è¿›","can_delete":false,"product_type":"c1","uid":1032125,"ip_address":"","ucode":"00BE5402479B16","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bf/bd/0c40979f.jpg","comment_is_top":false,"comment_ctime":1568331786,"is_pvip":false,"replies":[{"id":"51627","content":"å—¯ï¼Œæ˜¯éœ€è¦æŠ½è±¡ä¸€ä¸ªbufferå¯¹è±¡æ¥åšçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1568887628,"ip_address":"","comment_id":133033,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1568331786","product_id":100032701,"comment_content":"åˆ¤æ–­æ˜¯å¦æ¢è¡Œä¹Ÿå¯ä»¥ç›´æ¥strstråˆ¤æ–­å§ï¼Ÿ<br>https:&#47;&#47;mp.weixin.qq.com&#47;s&#47;YvfZMO2gCjHWmrNRGpdibA<br>æˆ‘è§‰å¾—è¿™ä¸¤ç§æ–¹å¼çš„é—®é¢˜å°±æ˜¯æŠŠåé¢è¯»å–çš„æ•°æ®ä¸¢å¼ƒäº†ï¼Œè¿™å¯¹äºtcpé€šä¿¡å¯èƒ½å­˜åœ¨é—®é¢˜å§ï¼Ÿ<br>åœ¨æƒ³åé¢æ˜¯ä¸æ˜¯å¾—æ¢æˆå…¨å±€å¾ªç¯ç¼“å†²åŒºè¯»å†™ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467227,"discussion_content":"å—¯ï¼Œæ˜¯éœ€è¦æŠ½è±¡ä¸€ä¸ªbufferå¯¹è±¡æ¥åšçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568887628,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132802,"user_name":"å¾å‡¯","can_delete":false,"product_type":"c1","uid":1244991,"ip_address":"","ucode":"12F82BA3649CD5","user_header":"https://static001.geekbang.org/account/avatar/00/12/ff/3f/bbb8a88c.jpg","comment_is_top":false,"comment_ctime":1568242677,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568242677","product_id":100032701,"comment_content":"ç¬¬ä¸€é¢˜ã€‚æ˜¯ä¸æ˜¯è·Ÿç»“æ„ä½“å­—èŠ‚å¯¹é½ä¸€æ ·çš„æ„æ€ã€‚æ•°æ®æ¯”å¦‚æ˜¯2çš„å€æ•° å¯ä»¥æ–¹ä¾¿cpuå¤„ç†ï¼Ÿ<br>ç¬¬äºŒé¢˜  å¯ä»¥æ˜¯åŠ¨æ€å†…å­˜ æœ‰æ—¶å€™åº”ç”¨å±‚åˆ†åŒ…å¯ä»¥è‡ªå®šä¹‰å‡ mä¸€ä¸ªåŒ… ç”šè‡³æ›´å¤§ è€Œæ ˆä¸Šåˆ†é…ç©ºé—´æ˜¯æœ‰é™çš„ å¹³å‡éƒ½åœ¨2åˆ°4mçš„æ ·å­ å¦‚æœåœ¨æ ˆä¸Šåˆ†é…ç¼“å†²åŒº å¯èƒ½ä½ çš„ç¨‹åºä¼šæ ¹æ®å¹³å°ä¸åŒé€‰æ‹©æ€§å´©æºƒï¼Œè€Œåœ¨å †ä¸Šåˆ™æ²¡æœ‰è¿™ä¸ªé—®é¢˜å”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯å†…å­˜æ³„æ¼é—®é¢˜ c++æœ‰æ™ºèƒ½æŒ‡é’ˆå¯ä»¥é¿å…ï¼Œjavaåº”è¯¥æ›´æ–¹ä¾¿å§ å®ƒçš„å†…å­˜å›æ”¶ä¸æ˜¯å¾ˆå‰å®³çš„å˜›","like_count":0},{"had_liked":false,"id":132747,"user_name":"Steiner","can_delete":false,"product_type":"c1","uid":1622329,"ip_address":"","ucode":"232C1C75207A1E","user_header":"https://static001.geekbang.org/account/avatar/00/18/c1/39/11904266.jpg","comment_is_top":false,"comment_ctime":1568212237,"is_pvip":false,"discussion_count":7,"race_medal":0,"score":"1568212237","product_id":100032701,"comment_content":"æˆ‘è§‰å¾—ä¸èƒ½ç”¨åŠ¨æ€åˆ†é…ï¼Œå¦‚æœç¨‹åºå´©æºƒäº†ï¼Œå†…å­˜è¿˜æ²¡å›æ”¶ä¼šå†…å­˜æº¢å‡ºå§","like_count":0,"discussions":[{"author":{"id":2355978,"avatar":"https://static001.geekbang.org/account/avatar/00/23/f3/0a/1314ae1f.jpg","nickname":"Sincostan","note":"","ucode":"92473175750E30","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":338453,"discussion_content":"ç¡®å®å»ºè®®è¿™ä½åŒå­¦è¡¥ä¹ ä¸€ä¸‹æ“ä½œç³»ç»Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609293944,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1032125,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/bf/bd/0c40979f.jpg","nickname":"ä¸€å‘¨æ€è¿›","note":"","ucode":"00BE5402479B16","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":10873,"discussion_content":"ç¨‹åºå´©æºƒï¼Œç”³è¯·çš„èµ„æºç³»ç»Ÿéƒ½ä¼šå›æ”¶çš„å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568332073,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":5,"child_discussions":[{"author":{"id":1622329,"avatar":"https://static001.geekbang.org/account/avatar/00/18/c1/39/11904266.jpg","nickname":"Steiner","note":"","ucode":"232C1C75207A1E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1032125,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/bf/bd/0c40979f.jpg","nickname":"ä¸€å‘¨æ€è¿›","note":"","ucode":"00BE5402479B16","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":11052,"discussion_content":"ä¸ä¼šï¼Œè¯·å‚è€ƒc++RAII","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568355324,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":10873,"ip_address":""},"score":11052,"extra":""},{"author":{"id":1101405,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ce/5d/5297717a.jpg","nickname":"åˆè§","note":"","ucode":"06D7952CED37D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1622329,"avatar":"https://static001.geekbang.org/account/avatar/00/18/c1/39/11904266.jpg","nickname":"Steiner","note":"","ucode":"232C1C75207A1E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":12459,"discussion_content":"ç¨‹åºå´©æºƒï¼Œè¿›ç¨‹éƒ½æ²¡äº†ï¼Œå½“ç„¶ä¼šè¢«å›æ”¶å‘€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568534279,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":11052,"ip_address":""},"score":12459,"extra":""},{"author":{"id":1622329,"avatar":"https://static001.geekbang.org/account/avatar/00/18/c1/39/11904266.jpg","nickname":"Steiner","note":"","ucode":"232C1C75207A1E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1101405,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ce/5d/5297717a.jpg","nickname":"åˆè§","note":"","ucode":"06D7952CED37D3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":12727,"discussion_content":"https://mp.weixin.qq.com/s/fM9fM1UhLhFWHJyKhFyhrg\n\nhttps://mp.weixin.qq.com/s/m44zVWMvactsLPjKsFnlSg\n\nå»ºè®®å­¦å¥½æŒ‡é’ˆÙ©Ì‹(à¹‘ËƒÌê‡´Ë‚Ì€à¹‘)ä¸­ç§‹å¿«ä¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568565326,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":12459,"ip_address":""},"score":12727,"extra":""}]}]}]}