{"id":671056,"title":"29ï½œåç«¯åŠŸèƒ½æ¥å£å®æˆ˜ï¼ˆä¸€ï¼‰ï¼šåç«¯æ¥å£è¯¥å¦‚ä½•å¼€å‘ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯Barryã€‚</p><p>åœ¨å‰é¢è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»å­¦è¿‡äº†åç«¯æ¥å£å¼€å‘çš„å‰ç½®çŸ¥è¯†ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¹Ÿé€šè¿‡ä¸€äº›åŠŸèƒ½æ¡ˆä¾‹å°è¯•äº†æ¥å£å¼€å‘ã€‚</p><p>æ¥ä¸‹æ¥çš„ä¸¤èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°±ç»“åˆç›´æ’­è§†é¢‘å¹³å°çš„éœ€æ±‚ï¼Œæ¥å®Œæˆç³»ç»ŸåŒ–çš„æ¥å£å¼€å‘ï¼Œè®©ä½ æŒæ¡ç‹¬ç«‹å®ŒæˆåŠŸèƒ½æ¥å£å¼€å‘çš„èƒ½åŠ›ã€‚è¿™èŠ‚è¯¾æˆ‘ä»¬å…ˆæ¥æ¢³ç†å¼€å‘æµç¨‹è§„èŒƒå’Œæ¥å£éœ€æ±‚ï¼Œå¹¶é€šè¿‡åˆ›å»ºpassportè®¤è¯æ¨¡å—ç¼–å†™ç™»å½•æ³¨å†Œç›¸å…³çš„æ¥å£ä»£ç ã€‚</p><h2>æ¥å£å¼€å‘æµç¨‹è§„èŒƒ</h2><p>æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹æ¥å£å¼€å‘çš„æµç¨‹è§„èŒƒï¼Œè®©ä½ å¯¹é¡¹ç›®åŠå¼€å‘æ•´ä½“çš„æµç¨‹æ›´åŠ ç†Ÿæ‚‰ã€‚ä¼ä¸šçº§çš„é¡¹ç›®å¼€å‘éƒ½è¦éµå¾ªå¼€å‘è§„èŒƒï¼Œç›®çš„æ˜¯è®©å¼€å‘æ“ä½œæ›´è§„èŒƒï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚æµç¨‹è§„èŒƒä¸€å…±æœ‰äº”æ¡ï¼Œæˆ‘ä»¬ä¾æ¬¡æ¥çœ‹çœ‹ã€‚</p><p><strong>ä¸€æ˜¯éœ€æ±‚æ˜ç¡®ã€‚</strong>åœ¨å¼€å‘æ¥å£ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè¦æ˜ç¡®æ¥å£çš„åŠŸèƒ½éœ€æ±‚å’Œæ•°æ®éœ€æ±‚ã€‚è¿™åŒ…æ‹¬æ¥å£éœ€è¦å®ç°çš„åŠŸèƒ½ã€éœ€è¦æ¥æ”¶çš„å‚æ•°ä»¥åŠè¿”å›çš„æ•°æ®æ ¼å¼ã€‚è¿™äº›å¦‚æœä¸åœ¨å¼€å‘å‰æ˜ç¡®ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´æˆ‘ä»¬åæœŸè¿”å·¥ã€‚</p><p><strong>äºŒæ˜¯ä½¿ç”¨æ¡†æ¶ã€‚</strong>ä½¿ç”¨ç°æœ‰çš„æ¡†æ¶ï¼Œæ¯”å¦‚Flaskæˆ–Djangoè¿™æ ·çš„æ¡†æ¶å¯ä»¥å¤§å¤§æé«˜å¼€å‘æ•ˆç‡ã€‚è¿™äº›æ¡†æ¶å·²ç»ä¸ºä½ å¤„ç†äº†è®¸å¤šåº•å±‚çš„ç»†èŠ‚ï¼Œä½ åªéœ€è¦å…³æ³¨ä¸šåŠ¡é€»è¾‘å³å¯ã€‚æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„å°±æ˜¯Flaskæ¡†æ¶ã€‚</p><p><strong>ä¸‰æ˜¯è®¾è®¡RESTful APIã€‚</strong>RESTfulæ˜¯ä¸€ç§å¸¸ç”¨çš„APIè®¾è®¡é£æ ¼ï¼Œå®ƒç®€å•æ˜“ç”¨ï¼Œå®¹æ˜“ç†è§£ï¼Œä¹Ÿæ–¹ä¾¿ä¸å‰ç«¯è¿›è¡Œäº¤äº’ã€‚è¿™ä¸€éƒ¨åˆ†æˆ‘ä»¬åœ¨Flask-RESTfulè¿™èŠ‚è¯¾å·²ç»è®²è¿‡äº†ï¼Œä¹Ÿä¸ºä½ æ‰“å¥½äº†åŸºç¡€ã€‚</p><!-- [[[read_end]]] --><p><strong>å››å°±æ˜¯è¿›è¡Œæ¥å£æµ‹è¯•ã€‚</strong>æ¥å£æµ‹è¯•èƒ½å¤Ÿä¿è¯å¼€å‘åŠŸèƒ½çš„å®ç”¨æ€§å’Œå®Œæ•´æ€§ã€‚é€šè¿‡è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å°±èƒ½åœ¨æŠ•å…¥ä½¿ç”¨å‰æå‰æ£€éªŒæˆ‘ä»¬çš„æ¥å£åŠŸèƒ½ï¼Œä¿è¯åŠŸèƒ½é¡ºåˆ©ä¸Šçº¿ã€‚å…·ä½“å°±æ˜¯ä½¿ç”¨Postmanæµ‹è¯•æˆ‘ä»¬çš„APIæ¥å£ã€‚è¿™äº›å·¥å…·æ— éœ€ç­‰å¾…å‰ç«¯çš„é…åˆï¼Œç”¨èµ·æ¥å¾ˆæ–¹ä¾¿ã€‚</p><p><strong>æœ€åæ˜¯ç¬¬äº”ç‚¹ï¼Œç¼–å†™æ¥å£æ–‡æ¡£</strong>ï¼Œè¿™æ˜¯ä¼ä¸šé‡Œæ¯ä¸ªç ”å‘å›¢é˜Ÿå¿…é¡»è¦åšçš„è§„èŒƒåŒ–ç®¡ç†ã€‚è‰¯å¥½çš„æ–‡æ¡£å¯ä»¥å¸®åŠ©å…¶ä»–å¼€å‘è€…ç†è§£å’Œä½¿ç”¨ä½ çš„æ¥å£ï¼Œæ–¹ä¾¿å›¢é˜Ÿç®¡ç†åä½œï¼Œä¹Ÿæœ‰åˆ©äºæ¥å£çš„åæœŸç»´æŠ¤ã€‚</p><h2>æ¥å£éœ€æ±‚æ¢³ç†</h2><p>æ˜ç¡®äº†å¼€å‘è§„èŒƒï¼Œæˆ‘ä»¬å†ç»“åˆç›´æ’­è§†é¢‘å¹³å°çš„åŠŸèƒ½æ¢³ç†ä¸€ä¸‹æ¥å£éœ€æ±‚çš„æ¢³ç†ï¼Œä¸ºåç»­å¼€å‘å®æˆ˜åšå¥½å‡†å¤‡ã€‚</p><p>åªæœ‰ç†é¡ºäº†æ¥å£éœ€æ±‚ï¼Œæˆ‘ä»¬æ‰èƒ½æ›´æ¸…æ™°æ•°æ®åº“è¡¨è®¾è®¡ä»¥åŠæ¥å£çš„åŠŸèƒ½å®ç°æ–¹å¼ã€‚æˆ‘ä»¬è¿™å°±æ¥çœ‹çœ‹åœ¨çº¿è§†é¢‘å¹³å°é‡Œæœ€æœ‰ä»£è¡¨æ€§çš„å‡ ä¸ªå¿…å¤‡æ¥å£ï¼Œä½ å¯ä»¥å‚è€ƒåé¢çš„è¡¨æ ¼æ¥çœ‹çœ‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/bc/6d/bc530b11b47eb2db69b5ba5d896f5f6d.jpg?wh=3621x1851\" alt=\"\"></p><p>æ˜ç¡®äº†åŠŸèƒ½æ¥å£çš„å¼€å‘è§„èŒƒå’Œéœ€æ±‚æƒ…å†µï¼Œæ¥ä¸‹æ¥å°±æ˜¯å®æ“ç¯èŠ‚ã€‚</p><h2>é¡¹ç›®æ¥å£å®æˆ˜</h2><p>åœ¨æ•´ä¸ªåç«¯å®æˆ˜è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ¯ä¸€ä¸ªæ¨¡å—çš„å­¦ä¹ å’Œåº”ç”¨éƒ½æ˜¯ä¸ºäº†æœ€ç»ˆé¡¹ç›®æ¥å£å¼€å‘åšå‡†å¤‡ã€‚è¯¾ç¨‹é‡Œæˆ‘æ”¾çš„æ˜¯æ ¸å¿ƒä»£ç ï¼Œå®Œæ•´çš„ä»£ç ä½ å¯ä»¥é€šè¿‡ <a href=\"https://gitee.com/Barry_Python_web/python_web_code/tree/master/29-%E5%90%8E%E7%AB%AF%E5%8A%9F%E8%83%BD%E6%8E%A5%E5%8F%A3%E5%AE%9E%E6%88%98-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%E5%85%A8%E6%B5%81%E7%A8%8B\">Giteeé“¾æ¥</a>è·å–ã€‚</p><h3>configé…ç½®ç®¡ç†</h3><p>é¦–å…ˆéœ€è¦æ­å»ºæ•´ä½“ç»“æ„ã€‚æˆ‘ä»¬åœ¨configæ–‡ä»¶ä¸­å®Œæˆé…ç½®ç®¡ç†ã€‚åé¢æ˜¯åˆ›å»ºé…ç½®åŸºç±»çš„ä»£ç å®ç°ã€‚</p><pre><code class=\"language-python\">class Config:\n  DEBUG = True\n  LEVEL_LOG = logging.INFO\n  SECRET_KEY = 'slajfasfjkajfj'\n  SQL_HOST = '127.0.0.1'\n  SQL_USERNAME = 'root'\n  SQL_PASSWORD = 'root'\n  SQL_PORT = 3306\n  SQL_DB = 'my_project'\n  JSON_AS_ASCII = False\n  # æ•°æ®åº“çš„é…ç½®\n  SQLALCHEMY_DATABASE_URI = f\"mysql+pymysql://{SQL_USERNAME}:{SQL_PASSWORD}@{SQL_HOST}:{SQL_PORT}/{SQL_DB}\"\n  SQLALCHEMY_TRACK_MODIFICATIONS = False\n  REDIS_HOST = '127.0.0.1'\n  REDIS_PORT = 6379\n  \n\n# æŒ‡å®šsessionä½¿ç”¨ä»€ä¹ˆæ¥å­˜å‚¨\n  SESSION_TYPE = 'redis'\n  # æŒ‡å®šsessionæ•°æ®å­˜å‚¨åœ¨åç«¯çš„ä½ç½®\n  SESSION_REDIS = StrictRedis(host=REDIS_HOST, port=REDIS_PORT)\n  # æ˜¯å¦ä½¿ç”¨secret_keyç­¾åä½ çš„sessin\n  SESSION_USE_SIGNER = True\n  # è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè¦æ±‚'SESSION_PERMANENT', Trueã€‚è€Œé»˜è®¤å°±æ˜¯31å¤©\n  PERMANENT_SESSION_LIFETIME = 60 * 60 * 24  # ä¸€å¤©æœ‰æ•ˆæœŸ\n</code></pre><p>å®ŒæˆåŸºæœ¬é…ç½®ä¹‹åï¼Œåœ¨configæ–‡ä»¶ä¸­æˆ‘ä»¬è¿˜éœ€è¦åšä¸åŒç¯å¢ƒçš„é…ç½®ã€‚é…ç½®ç±»çš„ä½œç”¨å°±æ˜¯æä¾›ä¸€ä¸ªåˆ†ç¦»çš„ç¯å¢ƒé…ç½®é€»è¾‘çš„æœºåˆ¶ï¼Œè®©æˆ‘ä»¬æ— éœ€ä¿®æ”¹ä»£ç ï¼Œå°±å¯ä»¥åœ¨ä¸åŒçš„ç¯å¢ƒä¸­è½»æ¾ä½¿ç”¨ä¸åŒçš„é…ç½®å‚æ•°ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦åˆ†æˆæµ‹è¯•ç¯å¢ƒã€å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒè¿™ä¸‰ç§æ¨¡å¼æ¥è®¾ç½®ã€‚</p><p>é¦–å…ˆæ¥çœ‹æµ‹è¯•ç¯å¢ƒé…ç½®ç±»çš„å…·ä½“ä»£ç ã€‚</p><pre><code class=\"language-python\">class TestConfig(Config):\n&nbsp; &nbsp; pass\n</code></pre><p>ç„¶åæ˜¯å¼€å‘ç¯å¢ƒé…ç½®ç±»å…·ä½“ä»£ç ã€‚</p><pre><code class=\"language-python\">class DevConfig(Config):\n&nbsp; &nbsp; pass\n</code></pre><p>æœ€åæ˜¯ç”Ÿäº§ç¯å¢ƒé…ç½®ç±»å…·ä½“ä»£ç ã€‚</p><pre><code class=\"language-python\">class ProConfig(Config):\n&nbsp; &nbsp; LEVEL_LOG = logging.ERROR\n&nbsp; &nbsp; DEBUG = False\n&nbsp; &nbsp; SQLALCHEMY_DATABASE_URI = \"mysql+pymysql://root:root@127.0.0.1:3306/aaa\"\n</code></pre><p></p><h3>ä¸»ç¨‹åºç¼–å†™</h3><p>æå®šé…ç½®ç®¡ç†ä»¥åå°±å¯ä»¥ç¼–å†™ä¸»ç¨‹åºäº†ã€‚æˆ‘ä»¬å…ˆå®Œæˆappå¯¹è±¡çš„å®ä¾‹åŒ–ï¼Œè¿™ä¸€æ­¥æ˜¯åˆ›å»ºFlaskåº”ç”¨å®ä¾‹çš„é‡è¦æ­¥éª¤ï¼Œå®ƒåŒ…å«äº†åº”ç”¨çš„å„ç§å±æ€§å’Œæ–¹æ³•ï¼Œç”¨äºæ„å»º Web åº”ç”¨ç¨‹åºã€‚é€šè¿‡appå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰åº”ç”¨çš„è·¯ç”±ã€æ·»åŠ è“å›¾ã€åˆå§‹åŒ–æ‰©å±•ç­‰åŠŸèƒ½ï¼Œè¿›è€Œæ„å»ºå‡ºå®Œæ•´çš„åº”ç”¨ç¨‹åºã€‚</p><p>å…·ä½“åšæ³•å°±æ˜¯åœ¨é¡¹ç›®ä¸­åˆ›å»ºæ¥å£apiåŒ…ç›®å½•ï¼Œç„¶ååœ¨__init__.pyä¸­åˆ›å»ºappå¯¹è±¡ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre><code class=\"language-python\">def create_app(config_name):\n    app = Flask(__name__)\n&nbsp; &nbsp; config = config_dict.get(config_name)\n&nbsp; &nbsp; setup_log(log_file='logs/root.log', level=config.LEVEL_LOG)\n&nbsp; &nbsp; app.config.from_object(config)\n&nbsp; &nbsp; db.init_app(app)\n    global redis_store\n&nbsp; &nbsp; redis_store = StrictRedis(host=config.REDIS_HOST, port=config.REDIS_PORT, decode_responses=True)\n    register_bp(app)\n</code></pre><p>è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬å®Œæˆäº†åé¢è¿™å››æ­¥åŠ¨ä½œã€‚</p><ol>\n<li>å·¥å‚æ¨¡å¼ä¸‹ï¼Œå®Œæˆä¸åŒç¯å¢ƒä¸‹é…ç½®ä¿¡æ¯å¯¼å…¥ã€‚</li>\n<li>å¢åŠ appæ—¥å¿—ç®¡ç†ã€‚</li>\n<li>åˆå§‹åŒ–æ•°æ®åº“ï¼Œå¹¶å…³è”appå¯¹è±¡ã€‚</li>\n<li>å¢åŠ å…¨å±€redisé“¾æ¥å¯¹è±¡ã€‚</li>\n</ol><p>å®Œæˆä¸Šé¢çš„æ“ä½œä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¢åŠ æ³¨å†Œè“å›¾æ–¹æ³•ï¼Œå®Œæˆä¸åŒåŠŸèƒ½æ¨¡å—çš„ç®¡ç†ã€‚æˆ‘ä»¥passport_bluæ¨¡å—ä¸ºä»£è¡¨æ¡ˆä¾‹ï¼Œå¸¦ä½ çœ‹çœ‹å…·ä½“çš„ä»£ç å®ç°ã€‚å…¶ä»–æ¨¡å—å¢åŠ è“å›¾æ³¨å†Œæ–¹æ³•å’Œè¿™é‡Œç±»ä¼¼ï¼Œåªä¸è¿‡å¯¹åº”çš„æ¨¡å—åä¸ä¸€æ ·ã€‚</p><pre><code class=\"language-python\">def register_bp(app)\n&nbsp; &nbsp; from api.modules.passport import passport_blu\n&nbsp; &nbsp; app.register_blueprint(passport_blu)\n\n</code></pre><p>åˆ°è¿™é‡Œæˆ‘ä»¬å°±å®Œæˆäº†å®ä¾‹åŒ–appå¯¹è±¡ï¼Œå®Œæˆäº†ä¸»ç¨‹åºçš„å„ä¸ªé…ç½®é¡¹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥å®ŒæˆmoduelsåŒ…çš„é…ç½®ä¸å¼€å‘ã€‚</p><h3>åˆ›å»ºæ•°æ®åº“è¡¨</h3><p>åœ¨è¿™ä¸€éƒ¨åˆ†æˆ‘ä»¬å°†è¦å®Œæˆåˆ›å»ºpassportè®¤è¯æ¨¡å—ï¼Œå¹¶ä¸”ç¼–å†™å¥½ç™»å½•å’Œæ³¨å†Œæ¥å£åŠŸèƒ½çš„ä»£ç ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨modelsä¸‹é¢çš„base.pyæ–‡ä»¶ä¸­ï¼Œåˆ›å»ºæ¨¡å‹åŸºç±»ã€‚å¦‚ä½•åˆ›å»ºæ¨¡å‹åŸºç±»ï¼Œæˆ‘ä»¬åœ¨æ•°æ®åº“å®æˆ˜<a href=\"https://time.geekbang.org/column/article/667908\">é‚£èŠ‚è¯¾</a>å·²ç»è¯¦ç»†è®²è¿‡äº†ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥çœ‹å…·ä½“ä»£ç ã€‚</p><pre><code class=\"language-python\">class BaseModels:\n&nbsp; &nbsp; \"\"\"æ¨¡å‹åŸºç±»\"\"\"\n&nbsp; &nbsp; create_time = db.Column(db.DateTime, default=datetime.now)&nbsp; # åˆ›å»ºæ—¶é—´\n&nbsp; &nbsp; update_time = db.Column(db.DateTime, default=datetime.now, onupdate=datetime.now)&nbsp; # è®°å½•ä½ çš„æ›´æ–°æ—¶é—´\n&nbsp; &nbsp; status = db.Column(db.SmallInteger, default=1)&nbsp; # è®°å½•å­˜æ´»çŠ¶æ€\n\n&nbsp; &nbsp; def add(self, obj):\n&nbsp; &nbsp; &nbsp; &nbsp; db.session.add(obj)\n&nbsp; &nbsp; &nbsp; &nbsp; return session_commit()\n\n&nbsp; &nbsp; def update(self):\n&nbsp; &nbsp; &nbsp; &nbsp; return session_commit()\n\n&nbsp; &nbsp; def delete(self):\n&nbsp; &nbsp; &nbsp; &nbsp; self.status = 0\n&nbsp; &nbsp; &nbsp; &nbsp; return session_commit()\n</code></pre><p>å®Œæˆæ¨¡å‹åŸºç±»çš„åˆ›å»ºåï¼Œæˆ‘ä»¬å°±è¦åˆ›å»ºç”¨æˆ·ç™»å½•è¡¨ï¼ŒåŒæ ·è¿˜æ˜¯åœ¨modelsæ–‡ä»¶ä¸‹çš„user.pyæ–‡ä»¶ä¸­åˆ›å»ºã€‚</p><pre><code class=\"language-plain\">class UserLogin(BaseModels, db.Model):\n    \"\"\"ç”¨æˆ·ç™»å½•è¡¨\"\"\"\n    __tablename__ = \"user_login\"\n\n    id = db.Column(db.Integer, primary_key=True, autoincrement=True)  # ç”¨æˆ·id\n    mobile = db.Column(db.String(16), unique=True, nullable=False)  # æ‰‹æœºå·\n    password_hash = db.Column(db.String(128), nullable=False)  # åŠ å¯†çš„å¯†ç \n    user_id = db.Column(db.Integer)  # ç”¨æˆ·id\n    last_login = db.Column(db.DateTime, default=datetime.now)  # æœ€åä¸€æ¬¡ç™»å½•æ—¶é—´\n    last_login_stamp = db.Column(db.Integer)  # æœ€åä¸€æ¬¡ç™»å½•æ—¶é—´\n\n    @property\n    def password(self):\n        raise AttributeError('å¯†ç å±æ€§ä¸èƒ½ç›´æ¥è·å–')\n\n    @password.setter\n    def password(self, value):  \n        self.password_hash = generate_password_hash(value)\n\n    # ä¼ å…¥çš„æ˜¯æ˜æ–‡ï¼Œæ ¡éªŒæ˜æ–‡å’Œæ•°æ®åº“é‡Œé¢çš„hashä¹‹åå¯†ç  æ­£ç¡®true\n    def check_password(self, password):\n        return check_password_hash(self.password_hash, password)\n</code></pre><p>ä¸‹ä¸€æ­¥æ˜¯é¡¹ç›®ä¸­çš„ç”¨æˆ·ç®¡ç†ï¼Œåœ¨ç™»å½•æˆåŠŸä¹‹åè¦å±•ç¤ºç”¨æˆ·ä¿¡æ¯ã€‚ä¸‹é¢çš„UserInfoç±»ä¸»è¦ç”¨æ¥åˆ›å»ºç”¨æˆ·ä¿¡æ¯è¡¨ã€‚</p><pre><code class=\"language-python\">class UserInfo(BaseModels, db.Model):\n&nbsp; &nbsp; \"\"\"ç”¨æˆ·ä¿¡æ¯è¡¨\"\"\"\n&nbsp; &nbsp; __tablename__ = \"user_info\"\n&nbsp; &nbsp; id = db.Column(db.Integer, primary_key=True, autoincrement=True)&nbsp; # ç”¨æˆ·id\n&nbsp; &nbsp; nickname = db.Column(db.String(64), nullable=False)&nbsp; # ç”¨æˆ·æ˜µç§°\n&nbsp; &nbsp; mobile = db.Column(db.String(16))&nbsp; # æ‰‹æœºå·\n&nbsp; &nbsp; avatar_url = db.Column(db.String(256))&nbsp; # ç”¨æˆ·å¤´åƒè·¯å¾„\n&nbsp; &nbsp; signature = db.Column(db.String(256))&nbsp; # ç­¾å\n&nbsp; &nbsp; sex = db.Column(db.Enum('0', '1', '2'), default='0')&nbsp; # 1ç”·&nbsp; 2 å¥³ 0 æš‚ä¸å¡«å†™\n&nbsp; &nbsp; birth_date = db.Column(db.DateTime)&nbsp; # å‡ºç”Ÿæ—¥æœŸ\n&nbsp; &nbsp; role_id = db.Column(db.Integer)&nbsp; # è§’è‰²id\n&nbsp; &nbsp; is_admin = db.Column(db.SmallInteger, default=0)\n\n&nbsp; &nbsp; last_message_read_time = db.Column(db.DateTime)\n\n&nbsp; &nbsp; def new_messages_counts(self):\n&nbsp; &nbsp; &nbsp; &nbsp; last_read_time = self.last_message_read_time or datetime(1900, 1, 1)\n&nbsp; &nbsp; &nbsp; &nbsp; return Message.query.filter_by(recipient_id=self.id).filter(\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Message.timestamp &gt; last_read_time).count()\n\n&nbsp; &nbsp; def to_dict(self):\n&nbsp; &nbsp; &nbsp; &nbsp; return {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'id': self.id,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'nickname': self.nickname,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'mobile': self.mobile,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'avatar_url': self.avatar_url,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'sex': self.sex,\n&nbsp; &nbsp; &nbsp; &nbsp; }\n</code></pre><h3>æ¥å£å¼€å‘</h3><p>å®Œæˆäº†æ¨¡å‹åŸºç±»å’Œè¡¨çš„åˆ›å»ºä¹‹åï¼Œæˆ‘ä»¬è¿˜è¦å®ç°å…·ä½“çš„åŠŸèƒ½æ¥å£ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥æ¢³ç†ä¸€ä¸‹æ³¨å†Œæ¥å£çš„å…·ä½“åŠŸèƒ½å®ç°ã€‚ç”¨æˆ·æ³¨å†Œçš„æ ¸å¿ƒé€»è¾‘å°±æ˜¯ï¼Œåœ¨ç”¨æˆ·å®Œæˆä¸€ç³»åˆ—ä¿¡æ¯çš„å½•å…¥åï¼Œç‚¹å‡»æ³¨å†ŒæŒ‰é’®ï¼Œç„¶åå°†ç”¨æˆ·ä¿¡æ¯æäº¤åˆ°æ•°æ®åº“ä¸­ã€‚</p><p>æˆ‘ä»¬ç›´æ¥åœ¨modulesæ–‡ä»¶ä¸‹çš„view.pyæ–‡ä»¶ä¸­å®ç°æ³¨å†Œæ¥å£ã€‚</p><pre><code class=\"language-python\">@passport_blu.route('/register', methods=['POST'])\ndef register():\n&nbsp; &nbsp; \"\"\"\n&nbsp; &nbsp; æ³¨å†Œæ¥å£\n&nbsp; &nbsp; :return: code msg\n&nbsp; &nbsp; \"\"\"\n&nbsp; &nbsp; data_dict = request.form\n&nbsp; &nbsp; mobile = data_dict.get('mobile')\n&nbsp; &nbsp; password = data_dict.get('password')\n&nbsp; &nbsp; img_code_id = data_dict.get('img_code_id')&nbsp; # cur_id\n&nbsp; &nbsp; img_code = data_dict.get('img_code')&nbsp; # å¡«å†™çš„code\n\n&nbsp; &nbsp; if not all([mobile, password, img_code_id, img_code]):\n&nbsp; &nbsp; &nbsp; &nbsp; return error(code=HttpCode.parmas_error, msg='æ³¨å†Œæ‰€éœ€å‚æ•°ä¸èƒ½ä¸ºç©º')\n\n&nbsp; &nbsp; # 2.1éªŒè¯æ‰‹æœºå·æ ¼å¼\n&nbsp; &nbsp; if not re.match('1[3456789]\\\\d{9}', mobile):\n&nbsp; &nbsp; &nbsp; &nbsp; return error(code=HttpCode.parmas_error, msg='æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®')\n\n&nbsp; &nbsp; # 3.é€šè¿‡æ‰‹æœºå·å–å‡ºredisä¸­çš„éªŒè¯ç \n&nbsp; &nbsp; redis_img_code = None\n&nbsp; &nbsp; # ä»rediså–å‡ºimg_code_idå¯¹åº”çš„éªŒè¯ç \n&nbsp; &nbsp; try:\n&nbsp; &nbsp; &nbsp; &nbsp; redis_img_code = redis_store.get(f'img_code: {img_code_id}')\n&nbsp; &nbsp; except Exception as e:\n&nbsp; &nbsp; &nbsp; &nbsp; current_app.logger.errer(e)\n\n&nbsp; &nbsp; if not redis_img_code:\n&nbsp; &nbsp; &nbsp; &nbsp; return error(HttpCode.parmas_error, 'rediså›¾ç‰‡éªŒè¯ç è·å–å¤±è´¥')\n\n&nbsp; &nbsp; if img_code.lower() != redis_img_code.lower():\n&nbsp; &nbsp; &nbsp; &nbsp; return error(HttpCode.parmas_error, 'å›¾ç‰‡éªŒè¯ç ä¸æ­£ç¡®')\n\n&nbsp; &nbsp; user_info = UserInfo()\n&nbsp; &nbsp; user_info.mobile = mobile\n&nbsp; &nbsp; user_info.nickname = mobile\n&nbsp; &nbsp; user_info.add(user_info)\n\n&nbsp; &nbsp; user_login = UserLogin()\n&nbsp; &nbsp; user_login.mobile = mobile\n&nbsp; &nbsp; user_login.password = password\n&nbsp; &nbsp; user_login.user_id = user_info.id\n&nbsp; &nbsp; user_login.add(user_login)\n\n&nbsp; &nbsp; return success('æ³¨å†ŒæˆåŠŸ')\n</code></pre><p>åœ¨å‰é¢è¿™æ®µä»£ç ä¸­ï¼Œé€šè¿‡request.formè·å–åˆ°ç”¨æˆ·ä¿¡æ¯ä¹‹åï¼Œæˆ‘ä»¬åˆ†åˆ«è¿›è¡Œäº†è¡¨å•éç©ºéªŒè¯ã€æ‰‹æœºå·æ ¼å¼è®¤è¯ä»¥åŠå›¾ç‰‡éªŒè¯ç çš„è®¤è¯ã€‚ç”¨æˆ·å¿…é¡»å®Œæˆä»¥ä¸Šè®¤è¯ä¹‹åï¼Œæ‰å¯ä»¥å®Œæˆæ³¨å†Œã€‚</p><p>æˆ‘ä»¬éœ€è¦ç‰¹åˆ«ç•™æ„ä¸€ä¸‹å›¾ç‰‡éªŒè¯ç çš„å®ç°ã€‚è¿™é‡Œæˆ‘ä»¬ä¸»è¦å€ŸåŠ©ä¸‰æ–¹åŒ…æ¥ç”Ÿæˆç®€å•çš„éªŒè¯ç æ¥å£ã€‚</p><pre><code class=\"language-python\">@passport_blu.route('/image_code')\ndef img_code():\n&nbsp; &nbsp; \"\"\"\n&nbsp; &nbsp; ç”Ÿæˆå›¾åƒéªŒè¯ç \n&nbsp; &nbsp; :return: å›¾ç‰‡çš„å“åº”\n&nbsp; &nbsp; \"\"\"\n&nbsp; &nbsp; # 1.è·å–è¯·æ±‚å‚æ•°,argsæ˜¯è·å–?åé¢çš„å‚æ•°\n&nbsp; &nbsp; cur_id = request.args.get('cur_id')\n&nbsp; &nbsp; pre_id = request.args.get('pre_id')\n&nbsp; &nbsp; # 2.ç”Ÿæˆå›¾ç‰‡éªŒè¯ç \n&nbsp; &nbsp; name, text, img_data = captcha.captcha.generate_captcha()\n&nbsp; &nbsp; # 3.ä¿å­˜åˆ°redis\n&nbsp; &nbsp; try:\n&nbsp; &nbsp; &nbsp; &nbsp; redis_store.set(f'img_code: {cur_id}', text, IMAGE_CODE_REDIS_EXPIRES)\n&nbsp; &nbsp; &nbsp; &nbsp; # åˆ¤æ–­æ˜¯å¦æœ‰ä¸Šä¸€ä¸ªuuid,å¦‚æœå­˜åœ¨åˆ™åˆ é™¤\n&nbsp; &nbsp; &nbsp; &nbsp; if pre_id:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; redis_store.delete(f'img_code: {pre_id}')\n&nbsp; &nbsp; except Exception as e:\n&nbsp; &nbsp; &nbsp; &nbsp; current_app.logger.error(e)\n&nbsp; &nbsp; &nbsp; &nbsp; return error(HttpCode.db_error, 'rediså­˜å‚¨å¤±è´¥')\n&nbsp; &nbsp; # 4. è¿”å›å›¾ç‰‡éªŒè¯ç \n&nbsp; &nbsp; response = make_response(img_data)\n&nbsp; &nbsp; response.headers[\"Content-Type\"] = \"image/jpg\"\n\n&nbsp; &nbsp; return response\n</code></pre><p>å‰é¢è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯ç”Ÿæˆä¸€ä¸ªéªŒè¯ç ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨å˜é‡ nameã€text å’Œ img_data ä¸­ã€‚é€šè¿‡è°ƒç”¨captcha.captcha.generate_captcha()æ–¹æ³•ï¼ˆè¿™æ˜¯ä¸€ä¸ªç”ŸæˆéªŒè¯ç çš„å‡½æ•°ï¼‰ï¼Œè¿”å›ä¸€ä¸ªå…ƒç»„ (name, text, img_data)ã€‚å…¶ä¸­nameæ˜¯éªŒè¯ç çš„åç§°ï¼Œtextæ˜¯éªŒè¯ç çš„æ–‡æœ¬ï¼Œimg_dataæ˜¯éªŒè¯ç çš„å›¾åƒæ•°æ®ã€‚</p><p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½å¿½ç•¥åé¢å¯¹åº”çš„å¼‚å¸¸å¤„ç†ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯ç¨‹åºç¨³å®šæ‰§è¡Œã€‚</p><p>ç”¨æˆ·æ³¨å†Œæ¥å£çš„å¼€å‘ä¸­ï¼Œæœ‰ä¸ªéå¸¸é‡è¦çš„åŠŸèƒ½â€”â€”ç”¨æˆ·åˆ¤é‡ã€‚</p><p>æ¯”æ–¹è¯´ï¼Œä¸€ä¸ªæ‰‹æœºå·æˆ‘ä»¬ä¸æ”¯æŒå¤šæ¬¡æ³¨å†Œã€‚è¿™ä¸€æ­¥å®ç°çš„é€»è¾‘æ˜¯è¿™æ ·çš„ï¼šæˆ‘ä»¬è¦åœ¨ç”¨æˆ·ç‚¹å‡»æ³¨å†Œæˆ–å®Œæˆæ‰‹æœºå·è¾“å…¥ä¹‹åï¼Œå°±é€šè¿‡æŸ¥è¯¢ç°æœ‰ç”¨æˆ·æ‰‹æœºå·æ¥åˆ¤æ–­æ˜¯å¦é‡åˆã€‚å¦‚æœæŸ¥è¯¢åˆ°ç›¸åŒçš„åˆ™æ³¨å†Œå¤±è´¥ï¼Œç›¸åç›´æ¥æ³¨å†ŒæˆåŠŸã€‚ä½ å¯ä»¥ç»“åˆåé¢çš„ä»£ç å®ç°æ¥åŠ æ·±ç†è§£ã€‚</p><pre><code class=\"language-python\">@passport_blu.route('/check_mobile', methods=['POST'])\ndef check_mobile():\n&nbsp; &nbsp; \"\"\"\n&nbsp; &nbsp; éªŒè¯æ‰‹æœºå·\n&nbsp; &nbsp; # è¯·æ±‚è·¯å¾„: /passport/check_mobile\n&nbsp; &nbsp; # è¯·æ±‚æ–¹å¼: POST\n&nbsp; &nbsp; # è¯·æ±‚å‚æ•°: mobile\n&nbsp; &nbsp; :return:code,msg\n&nbsp; &nbsp; \"\"\"\n&nbsp; &nbsp; data_dict = request.form\n&nbsp; &nbsp; mobile = data_dict.get('mobile')\n\n&nbsp; &nbsp; try:\n&nbsp; &nbsp; &nbsp; &nbsp; users = UserLogin.query.all()\n&nbsp; &nbsp; except Exception as e:\n&nbsp; &nbsp; &nbsp; &nbsp; current_app.logger.error(e)\n&nbsp; &nbsp; &nbsp; &nbsp; return error(code=HttpCode.db_error, msg='æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯å¼‚å¸¸')\n\n&nbsp; &nbsp; if mobile in [i.mobile for i in users]:\n&nbsp; &nbsp; &nbsp; &nbsp; return error(code=HttpCode.parmas_error, msg='æ‰‹æœºå·å·²å­˜åœ¨ï¼Œè¯·é‡æ–°è¾“å…¥')\n\n&nbsp; &nbsp; return success(msg=f'{mobile}ï¼Œæ­¤æ‰‹æœºå·å¯ä»¥ä½¿ç”¨')\n</code></pre><p>è¿™æ®µä»£ç ä¸­ï¼Œæœ€æ ¸å¿ƒçš„éƒ¨åˆ†å°±æ˜¯åœ¨è·å–åˆ°mobileä¹‹åï¼Œé€šè¿‡UserLogin.query.all()æ–¹æ³•æŸ¥è¯¢æ•°æ®ï¼Œæ ¹æ®è¿”å›çš„æ•°æ®æ¥åˆ¤æ–­æ³¨å†Œæ‰‹æœºå·ã€‚</p><p>åˆ°è¿™é‡Œæˆ‘ä»¬å°±å®Œæˆäº†ç”¨æˆ·çš„æ³¨å†ŒåŠŸèƒ½ï¼Œè‡³äºç™»å½•åŠŸèƒ½ã€‚æˆ‘ä»¬ä¸ŠèŠ‚è¯¾è®²è®¤è¯æœºåˆ¶çš„æ—¶å€™å·²ç»è¯¦ç»†è¯´è¿‡ï¼Œä»ç”ŸæˆTokenåˆ°ç”¨æˆ·é‰´æƒçš„å…¨è¿‡ç¨‹ç›¸ä¿¡ä½ å·²ç»éå¸¸ç†Ÿæ‚‰äº†ï¼Œå®Œæ•´ä»£ç ä½ åŒæ ·å¯ä»¥å‚è€ƒ <a href=\"https://gitee.com/Barry_Python_web/python_web_code/tree/master/29-%E5%90%8E%E7%AB%AF%E5%8A%9F%E8%83%BD%E6%8E%A5%E5%8F%A3%E5%AE%9E%E6%88%98-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%E5%85%A8%E6%B5%81%E7%A8%8B\">Gitee</a>ã€‚</p><h2>æ€»ç»“</h2><p>åˆåˆ°äº†è¯¾ç¨‹çš„å°¾å£°ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·å¯¹è¿™èŠ‚è¯¾å­¦åˆ°çš„å†…å®¹åšä¸ªæ€»ç»“ã€‚</p><p>å‰é¢çš„è¯¾ç¨‹ä¸­æˆ‘ä»¬æˆ–å¤šæˆ–å°‘çš„éƒ½æœ‰æ¶‰åŠåˆ°æ¥å£å®ç°çš„æ–¹æ³•ï¼Œè¿™èŠ‚è¯¾æˆ‘ä»¬ä»¥ç”¨æˆ·æ³¨å†Œçš„æ¥å£å®ç°ä¸ºä¾‹ï¼Œæ›´åŠ ä½“ç³»åŒ–åœ°å®ç°äº†å®Œæ•´çš„åŠŸèƒ½å¼€å‘ã€‚</p><p>å…·ä½“å®æˆ˜å‰ï¼Œæˆ‘ä»¬å…ˆæ¢³ç†äº†å¼€å‘æµç¨‹è§„èŒƒå’Œæ¥å£éœ€æ±‚ã€‚è§„èŒƒçš„æµç¨‹ä¸ä½†èƒ½æé«˜æ•ˆç‡ï¼Œä¹Ÿèƒ½æ›´å¥½åœ°å®ç°å›¢é˜Ÿåˆä½œã€‚æ¥å£éœ€æ±‚èƒ½è®©æˆ‘ä»¬æ˜ç¡®ä¹‹åè¦åšå“ªäº›åŠŸèƒ½ï¼Œä¸ºä¹‹åçš„å®ç°ç¯èŠ‚åšå¥½é¢„çƒ­ã€‚</p><p>æ¥å£å¼€å‘é˜¶æ®µï¼Œæˆ‘ä»¬ä»configé¡¹ç›®é…ç½®ç®¡ç†åˆ°ä¸»ç¨‹åºç¼–å†™ï¼Œä½ å¿…é¡»è¦æŒæ¡å®ä¾‹åŒ–appå¯¹è±¡çš„åˆ›å»ºä»£ç ä¸­æ¯ä¸€é¡¹çš„ä½œç”¨ã€‚è€Œåœ¨æ¨¡å‹åŸºç±»å’Œç”¨æˆ·è¡¨åˆ›å»ºè¿™ä¸€éƒ¨åˆ†é‡Œï¼Œæˆ‘ä»¬è¦æ³¨æ„<strong>æå‰æ¢³ç†å¥½æ¯ä¸€æ¨¡å—çš„å­—æ®µä¿¡æ¯ä»¥åŠå¯¹åº”çš„å­—æ®µç±»å‹ã€‚</strong>æ¥å£å®ç°è¿‡ç¨‹ä¸­ä¸€å®šè¦æ³¨æ„æœ‰ä¸šåŠ¡é€»è¾‘å®ç°å’Œå¼‚å¸¸å¤„ç†ï¼Œåªæœ‰å…¨é¢è€ƒè™‘ï¼Œæ‰èƒ½ä¿è¯ç¨‹åºçš„ç¨³å®šæ‰§è¡Œã€‚</p><p>è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬ä»¥æ³¨å†Œæ¥å£ä¸ºæ¡ˆä¾‹å¸¦ä½ ä½“éªŒäº†æ¥å£ç³»ç»ŸåŒ–å¼€å‘çš„è¿‡ç¨‹ã€‚ç”¨æˆ·ç›¸å…³çš„æ¥å£å¼€å‘ä¹Ÿæ˜¯ä¸€æ ·çš„å®ç°æ–¹æ³•ï¼Œç›¸ä¿¡ä½ åœ¨æŒæ¡äº†æ³¨å†Œçš„æ¥å£å®ç°ä¹‹åï¼Œåº”å¯¹å…¶ä»–ç”¨æˆ·ç›¸å…³çš„æ¥å£å®ç°ä¹Ÿä¼šéå¸¸è½»æ¾ã€‚å¸Œæœ›ä½ è¯¾åå¯¹ç…§é…å¥—ä»£ç å¤šå¤šç»ƒä¹ ï¼Œå·©å›ºå­¦ä¹ æ•ˆæœã€‚</p><h2>æ€è€ƒé¢˜</h2><p>åœ¨è¯¾ç¨‹ä¸­æ³¨å†Œçš„æ—¶å€™æˆ‘ä»¬åšäº†å›¾å½¢éªŒè¯ï¼Œå¦‚æœé€šè¿‡çŸ­ä¿¡è®¤è¯çš„æ–¹å¼æ¥å®ç°æ³¨å†Œï¼Œä½ æœ‰ä»€ä¹ˆå¥½çš„æƒ³æ³•åˆ†äº«ä¹ˆï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºå’Œæˆ‘äº¤æµäº’åŠ¨ï¼Œå¦‚æœè¿™èŠ‚è¯¾å¯¹ä½ æœ‰å¯å‘ï¼Œåˆ«å¿˜äº†åˆ†äº«ç»™èº«è¾¹æ›´å¤šæœ‹å‹ã€‚</p>","comments":[{"had_liked":false,"id":381296,"user_name":"èƒ¡è¶…","can_delete":false,"product_type":"c1","uid":1259236,"ip_address":"å¹¿ä¸œ","ucode":"C2C2AA341F854C","user_header":"https://static001.geekbang.org/account/avatar/00/13/36/e4/f24efa91.jpg","comment_is_top":false,"comment_ctime":1695003676,"is_pvip":false,"replies":[{"id":138939,"content":"å¥½çš„ï¼Œæ„Ÿè°¢å»ºè®®ï¼Œå¯ä»¥è°ƒæ•´ä¸€ä¸‹ï¼Œå­¦ä¹ è¿‡ç¨‹ä¸­çš„ç›¸å…³é—®é¢˜å¯ä»¥ç›´æ¥åœ¨èŠå¤©åŒºç•™è¨€ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3050845,"ctime":1695196500,"ip_address":"åŒ—äº¬","comment_id":381296,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100546501,"comment_content":"å»ºè®®åœ¨æ¯æ®µä»£ç ä¸­é’ˆå¯¹éœ€è¦å¼•å…¥çš„æ¨¡å—ï¼Œimportä¸‹æˆ–è€…form * import *ä¸‹ï¼Œä¸ç„¶æœ‰æ—¶ä¼šçœ‹ç‚¹æœ‰ç‚¹æ¨¡ç³Šï¼Œæ‰“ä¸ªæ¯”æ–¹ï¼šname, text, img_data = captcha.captcha.generate_captcha()å…¶ä¸­captchpå¼•å…¥çš„æ˜¯å“ªä¸ªæ¨¡å—ç­‰ï¼Œè¿™æ ·ä¼šæœ‰åŠ©äºé˜…è¯»ä»£ç ï¼Œè°¢è°¢ğŸ™","like_count":0,"discussions":[{"author":{"id":3050845,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/8d/5d/9a86007c.jpg","nickname":"Barry","note":"","ucode":"82175C78B4CAED","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":628321,"discussion_content":"å¥½çš„ï¼Œæ„Ÿè°¢å»ºè®®ï¼Œå¯ä»¥è°ƒæ•´ä¸€ä¸‹ï¼Œå­¦ä¹ è¿‡ç¨‹ä¸­çš„ç›¸å…³é—®é¢˜å¯ä»¥ç›´æ¥åœ¨èŠå¤©åŒºç•™è¨€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1695196501,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1259236,"avatar":"https://static001.geekbang.org/account/avatar/00/13/36/e4/f24efa91.jpg","nickname":"èƒ¡è¶…","note":"","ucode":"C2C2AA341F854C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":3050845,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/8d/5d/9a86007c.jpg","nickname":"Barry","note":"","ucode":"82175C78B4CAED","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":630129,"discussion_content":"from api.thirdparty.captcha import captchaï¼Œè¯·é—®ä¸‹è¿™ä¸ªæ˜¯å¼•å…¥çš„æ˜¯pythonçš„å“ªä¸ªæ¨¡å—ï¼Œæˆ‘çœ‹æºæ–‡ä»¶apiçš„__init__æ–‡ä»¶ä¸‹æ²¡æœ‰thirdparty.captchaè¿™ä¸ªçš„å¼•å…¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1698130838,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":628321,"ip_address":"","group_id":0},"score":630129,"extra":""}]},{"author":{"id":1259236,"avatar":"https://static001.geekbang.org/account/avatar/00/13/36/e4/f24efa91.jpg","nickname":"èƒ¡è¶…","note":"","ucode":"C2C2AA341F854C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":630130,"discussion_content":"è¡¥å……æé—®ï¼Œæ˜¯pip3 install captcha? captchaæ¨¡å—å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1698131079,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}