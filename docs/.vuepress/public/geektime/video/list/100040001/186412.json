{"id":186412,"title":"32 | MongoDB安全加固实践","content":"<p><strong>亲爱的学员：</strong><br>\n你好，在回答学员问题的过程中，我发现大家对于第二章的事务处理, 特别是隔离级别，以及第三章的分片集群有相对较多的问题。在这里我给大家推荐一些补充的学习材料可以从另外一个角度来加深一些这些概念的理解。<br>\nMongoDB事务的原子性<br>\n<a href=\"https://docs.mongodb.com/manual/core/write-operations-atomicity/\">https://docs.mongodb.com/manual/core/write-operations-atomicity/</a><br>\nMongoDB事务的隔离级别和一致性模型<br>\n<a href=\"https://docs.mongodb.com/manual/core/read-isolation-consistency-recency/\">https://docs.mongodb.com/manual/core/read-isolation-consistency-recency/</a><br>\n如果英文不太感冒，在MongoDB中文网站上有不少内容，比如分片相关的：<br>\n<a href=\"http://www.mongoing.com/?s=%E5%88%86%E7%89%87%E9%9B%86%E7%BE%A4\">http://www.mongoing.com/?s=分片集群</a></p><p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-mongodb-course\">https://gitee.com/geektime-geekbang/geektime-mongodb-course</a></p>","comments":[{"had_liked":false,"id":205568,"user_name":"book尾汁","can_delete":false,"product_type":"c3","uid":1446375,"ip_address":"","ucode":"AE2B8DFC643ACC","user_header":"https://static001.geekbang.org/account/avatar/00/16/11/e7/044a9a6c.jpg","comment_is_top":false,"comment_ctime":1586675516,"is_pvip":false,"replies":[{"id":77492,"content":"因为我在admin库创建的用户呀。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1587097183,"ip_address":"","comment_id":205568,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"db.createUser({user:&quot;taobao&quot;,pwd:&quot;taobao123&quot;, roles:[{role:&quot;readWrite&quot;, db:&quot;taobao&quot;}]})，创建了一个taobao库的用户，登录的时候 --authenticationDatabase admin 登录不上，换成--authenticationDatabase taobao就可以，老师的怎么admin就可以登录啊","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491513,"discussion_content":"因为我在admin库创建的用户呀。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587097183,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":181037,"user_name":"长脖子树","can_delete":false,"product_type":"c3","uid":1182802,"ip_address":"","ucode":"D9090EF67EEB1B","user_header":"https://static001.geekbang.org/account/avatar/00/12/0c/52/f25c3636.jpg","comment_is_top":false,"comment_ctime":1582464081,"is_pvip":true,"replies":[{"id":70951,"content":"正确。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1583028793,"ip_address":"","comment_id":181037,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"mongo -u reader -p abc123 --authenticationDatabase admin 上面的命令中, 一定要加上 --authenticationDatabase admin 否则会导致 Authentication failed","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484896,"discussion_content":"正确。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583028793,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":174261,"user_name":"hal","can_delete":false,"product_type":"c3","uid":1359844,"ip_address":"","ucode":"98E625F7327FD9","user_header":"https://static001.geekbang.org/account/avatar/00/14/bf/e4/45758517.jpg","comment_is_top":false,"comment_ctime":1580111923,"is_pvip":false,"replies":[{"id":67797,"content":"新年好！\n\n启动鉴权后，你可以无密码登录进去，但是只能做一件事：创建超级用户。这个事情也只能做一次（无密码创建超级用户），以后“黑客”再来，他就必须要登录才能做创建用户的事情。所以你要做的事情，就是尽快创建那个超级用户。\n \n","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1580251853,"ip_address":"","comment_id":174261,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师新年好，身体健康 万事如意 ，，问个小白问题，如果黑客mongo连接进去然后创建个超级用户再登录这种情况怎么办。","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482349,"discussion_content":"新年好！\n\n启动鉴权后，你可以无密码登录进去，但是只能做一件事：创建超级用户。这个事情也只能做一次（无密码创建超级用户），以后“黑客”再来，他就必须要登录才能做创建用户的事情。所以你要做的事情，就是尽快创建那个超级用户。\n \n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580251853,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1261108,"avatar":"https://static001.geekbang.org/account/avatar/00/13/3e/34/dd0a3c61.jpg","nickname":"爱吃彩虹糖的猫~","note":"","ucode":"9EC7A8FD4B7DB1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":156594,"discussion_content":"看到现在，老师真的是每问必答，祝TJ新年快乐","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580384171,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1359844,"avatar":"https://static001.geekbang.org/account/avatar/00/14/bf/e4/45758517.jpg","nickname":"hal","note":"","ucode":"98E625F7327FD9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":155643,"discussion_content":"明白了，谢谢老师！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580271856,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":195216,"user_name":"追忆似水年华","can_delete":false,"product_type":"c3","uid":1160192,"ip_address":"","ucode":"C1D7C0DD7E7411","user_header":"https://static001.geekbang.org/account/avatar/00/11/b4/00/661fb98d.jpg","comment_is_top":false,"comment_ctime":1585147424,"is_pvip":false,"replies":[{"id":74311,"content":"你最棒！","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1585215818,"ip_address":"","comment_id":195216,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"这一节其实非常重要，安全是很多人都常常会忽略的一个主题，但又往往是实际工作中很薄弱的一个环节。","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489000,"discussion_content":"你最棒！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585215818,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":201588,"user_name":"DZZ","can_delete":false,"product_type":"c3","uid":1516167,"ip_address":"","ucode":"C8E4C4B089BCE2","user_header":"https://static001.geekbang.org/account/avatar/00/17/22/87/e7bd2acf.jpg","comment_is_top":false,"comment_ctime":1585808254,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"生产环境对读写权限分离是非常重要的，一旦有人误使用一些写操作，对生产会带来很大的损失。","like_count":1},{"had_liked":false,"id":283197,"user_name":"玖月","can_delete":false,"product_type":"c3","uid":2367247,"ip_address":"","ucode":"427737A95CAE0C","user_header":"https://static001.geekbang.org/account/avatar/00/24/1f/0f/4fe3788e.jpg","comment_is_top":false,"comment_ctime":1615616771,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"唐老师，看了视频中 mongodb 基于证书认证部分，有个疑问：看了mongodb 官方文档也不是太理解，PEMKeyFile 参数官方解释是TLS&#47;SSL证书和密钥PEM文件的路径，clusterFile 参数官方解释x.509成员资格证书和密钥PEM文件的路径。这个两个有什么不同，clusterFile 是指集群中所有节点使用同一个证书吗？如果是，是不是直接挑一个节点进行证书生成，然后拷贝到其他节点上？另外 PEMKeyFile 是不同节点各自的证书吗？","like_count":0},{"had_liked":false,"id":193597,"user_name":"冷脚","can_delete":false,"product_type":"c3","uid":1101601,"ip_address":"","ucode":"C693E75F417D3C","user_header":"https://static001.geekbang.org/account/avatar/00/10/cf/21/87888b61.jpg","comment_is_top":false,"comment_ctime":1584932115,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师createRole失败，麻烦帮忙看一下\n2020-03-23T10:45:05.120+0800 F REPL     [repl writer worker 6] writer worker caught exception: NamespaceNotFound: Failed to apply operation: { ts: Timestamp(1584931505, 1), t: 34, h: -1891726699602646205, v: 2, op: &quot;i&quot;, ns: &quot;admin.system.roles&quot;, ui: UUID(&quot;591c696f-8201-4b4f-902b-d27447aa8b76&quot;), wall: new Date(1584931505114), o: { _id: &quot;admin.&#39;restoreEx&quot;, role: &quot;&#39;restoreEx&quot;, db: &quot;admin&quot;, privileges: [ { resource: { cluster: true }, actions: [ &quot;addShard&quot; ] }, { resource: { db: &quot;config&quot;, collection: &quot;&quot; }, actions: [ &quot;find&quot;, &quot;insert&quot;, &quot;remove&quot;, &quot;update&quot; ] } ], roles: [ { role: &quot;restore&quot;, db: &quot;admin&quot; } ] } } :: caused by :: Unable to resolve 591c696f-8201-4b4f-902b-d27447aa8b76 on: { op: &quot;i&quot;, ns: &quot;admin.system.roles&quot;, ui: UUID(&quot;591c696f-8201-4b4f-902b-d27447aa8b76&quot;), o: { _id: &quot;admin.&#39;restoreEx&quot;, role: &quot;&#39;restoreEx&quot;, db: &quot;admin&quot;, privileges: [ { resource: { cluster: true }, actions: [ &quot;addShard&quot; ] }, { resource: { db: &quot;config&quot;, collection: &quot;&quot; }, actions: [ &quot;find&quot;, &quot;insert&quot;, &quot;remove&quot;, &quot;update&quot; ] } ], roles: [ { role: &quot;restore&quot;, db: &quot;admin&quot; } ] }, ts: Timestamp(1584931505, 1), t: 34, h: -1891726699602646205, v: 2, wall: new Date(1584931505114) }\n2020-03-23T10:45:05.120+0800 F -        [rsSync-0] Fatal assertion 34437 NamespaceNotFound: Failed to apply operation: { ts: Timestamp(1584931505, 1), t: 34, h: -1891726699602646205, v: 2, op: &quot;i&quot;, ns: &quot;admin.system.roles&quot;, ui: UUID(&quot;591c696f-8201-4b4f-902b-d27447aa8b76&quot;), wall: new Date(1584931505114), o: { _id: &quot;admin.&#39;restoreEx&quot;, role: &quot;&#39;restoreEx&quot;, db: &quot;admin&quot;, privileges: [ { resource: { cluster: true }, actions: [ &quot;addShard&quot; ] }, { resource: { db: &quot;config&quot;, collection: &quot;&quot; }, actions: [ &quot;find&quot;, &quot;insert&quot;, &quot;remove&quot;, &quot;update&quot; ] } ], roles: [ { role: &quot;restore&quot;, db: &quot;admin&quot; } ] } } :: caused by :: Unable to resolve 591c696f-8201-4b4f-902b-d27447aa8b76 at src&#47;mongo&#47;db&#47;repl&#47;sync_tail.cpp 1016\n2020-03-23T10:45:05.120+0800 F -        [rsSync-0] \n\n***aborting after fassert() failure","like_count":0}]}