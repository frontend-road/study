{"id":7157,"title":"15 | 什么是 JWT 令牌","content":"无","comments":[{"had_liked":false,"id":206151,"user_name":"喆里","can_delete":false,"product_type":"c3","uid":1125033,"ip_address":"","ucode":"0B4B38104645CA","user_header":"https://static001.geekbang.org/account/avatar/00/11/2a/a9/83684d4a.jpg","comment_is_top":false,"comment_ctime":1586794382,"is_pvip":false,"replies":[{"id":77408,"content":"jwt自校验的意思是说它的状态是自包含的(jwt令牌里头本身就有状态信息，例如用户id，也有签名算法信息)，并不需要到DB或者其它地方去获取状态。\n\njwt令牌的有效性是通过签名算法+secret(也可以用公私钥)保证的，任何拿到jwt(并且有secret)的服务都可以校验。\n\n任何没有secret的中间环节，都可以看到jwt里头信息，但是不能篡改里头的信息。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1587038565,"ip_address":"","comment_id":206151,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"请教下，jwt token自校验有点不明白，是谁验证，client，还是资源服务器？ 如果自校验，是不是得有私钥或公钥，否则怎么验证签名是有效的呢？ ","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491692,"discussion_content":"jwt自校验的意思是说它的状态是自包含的(jwt令牌里头本身就有状态信息，例如用户id，也有签名算法信息)，并不需要到DB或者其它地方去获取状态。\n\njwt令牌的有效性是通过签名算法+secret(也可以用公私钥)保证的，任何拿到jwt(并且有secret)的服务都可以校验。\n\n任何没有secret的中间环节，都可以看到jwt里头信息，但是不能篡改里头的信息。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587038565,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52652,"user_name":"萬物一馬","can_delete":false,"product_type":"c3","uid":1041405,"ip_address":"","ucode":"A28AC9B37ADCB7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e3/fd/499bbb36.jpg","comment_is_top":false,"comment_ctime":1545467113,"is_pvip":false,"replies":[{"id":19373,"content":"我认为有两种可能，一是你经常用这些app，令牌及时刷新了，二是这些应用令牌的过期时间本身设置较长，毕竟安全上可接受（如果你真买东西到支付环节还要额外认证的）。个人观点，具体要看内部实现","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1545655479,"ip_address":"","comment_id":52652,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"想问一下，像京东和淘宝这样的APP，基本登录过后，永远都在登陆状态下，像这样的token实现机制是怎么样的？","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433939,"discussion_content":"我认为有两种可能，一是你经常用这些app，令牌及时刷新了，二是这些应用令牌的过期时间本身设置较长，毕竟安全上可接受（如果你真买东西到支付环节还要额外认证的）。个人观点，具体要看内部实现","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545655479,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":32263,"user_name":"chon","can_delete":false,"product_type":"c3","uid":1068925,"ip_address":"","ucode":"1C32170972F726","user_header":"https://static001.geekbang.org/account/avatar/00/10/4f/7d/dd852b04.jpg","comment_is_top":false,"comment_ctime":1539504245,"is_pvip":true,"replies":[{"id":11729,"content":"传统web应用有session概念，如有需要可以集中存memcached&#47;redis等实现分布式session。微服务尽量无状态，一般不讲session，授权认证可用无状态jwt，也可用oauth2集中校验式令牌，令牌存memccached&#47;redis缓存，由网关集中验，或每个资源服务集中验，这种方式有点类似分布式session。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1539516289,"ip_address":"","comment_id":32263,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"老师，请教一下，jwt是无状态的，对于spring cloud这种分布式系统是否还需要分布式session？如果需要处理分布式session，能否给个文章链接参考一下？谢谢","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426706,"discussion_content":"传统web应用有session概念，如有需要可以集中存memcached/redis等实现分布式session。微服务尽量无状态，一般不讲session，授权认证可用无状态jwt，也可用oauth2集中校验式令牌，令牌存memccached/redis缓存，由网关集中验，或每个资源服务集中验，这种方式有点类似分布式session。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539516289,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10619,"user_name":"Coder Cat","can_delete":false,"product_type":"c3","uid":1136920,"ip_address":"","ucode":"AF0291604CCB11","user_header":"https://static001.geekbang.org/account/avatar/00/11/59/18/87898f15.jpg","comment_is_top":false,"comment_ctime":1527635279,"is_pvip":false,"replies":[{"id":3663,"content":"token有意义包含用户等信息，就是自包含token，jwt是自包含例子","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1528130279,"ip_address":"","comment_id":10619,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"老师您好，我用的OAuth2 库，在账号密码授权模式下返回的token 里面包含了用户身份信息的，这个算自包含吗","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418541,"discussion_content":"token有意义包含用户等信息，就是自包含token，jwt是自包含例子","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528130279,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":76993,"user_name":"不工","can_delete":false,"product_type":"c3","uid":1462843,"ip_address":"","ucode":"A8725E6D0E1765","user_header":"https://static001.geekbang.org/account/avatar/00/16/52/3b/f1501d79.jpg","comment_is_top":false,"comment_ctime":1552797869,"is_pvip":false,"replies":[{"id":28179,"content":"有，我最近正在开发一个准生产级的微服务SaaS应用，会开源，采用JWT认证，有一些工作量，预计到5月份左右开发完，你可以加我微信bulldog2015，我拉你入我的极客群，到时候会通知大家。如果你比较着急的话，可以先参考我的一个简化项目：https:&#47;&#47;github.com&#47;jskillcloud&#47;MovieApp，也是采用jwt认证，我正在制作一个免费视频教程，你可以留意readme中的教程链接更新。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1552914786,"ip_address":"","comment_id":76993,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"老师，你好。这边都是实验性质的demo，因为该课程的标题是实战，有贴近生产的项目实战吗？将jwt以及微服务中的各个组件一起结合起来使用的","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443534,"discussion_content":"有，我最近正在开发一个准生产级的微服务SaaS应用，会开源，采用JWT认证，有一些工作量，预计到5月份左右开发完，你可以加我微信bulldog2015，我拉你入我的极客群，到时候会通知大家。如果你比较着急的话，可以先参考我的一个简化项目：https://github.com/jskillcloud/MovieApp，也是采用jwt认证，我正在制作一个免费视频教程，你可以留意readme中的教程链接更新。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552914786,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43438,"user_name":"lester","can_delete":false,"product_type":"c3","uid":1025747,"ip_address":"","ucode":"79BD59B50C97BA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a6/d3/856316dd.jpg","comment_is_top":false,"comment_ctime":1543227111,"is_pvip":false,"replies":[{"id":15804,"content":"这里的演示代码有点小问题，没有加当前时间，结果用起点时间（1970-01-01）+令牌有效期（8小时候）表示了。我会修复一下代码。实际这个值应该表示令牌到什么时候过期，具体影响解释要看客户应用逻辑，一种逻辑会根据这个字段判断是否快过期了，如果是就提前审请新令牌，另一种逻辑可能不关心这个字段，由授权服务器检验判断令牌是否过期。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1543407422,"ip_address":"","comment_id":43438,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"老师您好！在clientdb.client_user表中access_token_validity为什么是1970-01-01 08:00:43？在实际的应用中这个字段的影响大么？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430383,"discussion_content":"这里的演示代码有点小问题，没有加当前时间，结果用起点时间（1970-01-01）+令牌有效期（8小时候）表示了。我会修复一下代码。实际这个值应该表示令牌到什么时候过期，具体影响解释要看客户应用逻辑，一种逻辑会根据这个字段判断是否快过期了，如果是就提前审请新令牌，另一种逻辑可能不关心这个字段，由授权服务器检验判断令牌是否过期。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543407422,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}