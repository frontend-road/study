{"id":796937,"title":"15ï½œPodæ¢é’ˆä¸æœåŠ¡è´¨é‡QoS","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯é›ªé£ã€‚</p><p>å‰ä¸¤èŠ‚è¯¾æˆ‘å¸¦ä½ äº†è§£äº†é›†ç¾¤çš„å®‰å…¨ç­–ç•¥ï¼ŒK8s é€šè¿‡ RBAC æƒé™æ§åˆ¶æœ‰æ•ˆåº”å¯¹äº†å¤–éƒ¨è®¿é—®é£é™©ï¼Œå¹¶ä¸”é€šè¿‡ç½‘ç»œç­–ç•¥æ§åˆ¶ Pod çš„å‡ºå…¥å£æµé‡ï¼Œä»è€Œåº”å¯¹äº†å†…éƒ¨è®¿é—®é£é™©ã€‚è¿™èŠ‚è¯¾æˆ‘ä»¬è®¨è®ºå¦‚ä½•ä¿éšœ K8s é›†ç¾¤ä¸­åº”ç”¨çš„ç¨³å®šæ€§ï¼Œç”±äºåº”ç”¨æ˜¯ä»¥ Pod çš„æ–¹å¼éƒ¨ç½²åœ¨é›†ç¾¤ä¸­ï¼Œæ‰€ä»¥ K8s ç¨³å®šæ€§çš„ç­–ç•¥ä¸»è¦æ˜¯é’ˆå¯¹ Podã€‚</p><p>æˆ‘ç»™ä½ ä»‹ç»ä¿éšœ Pod ç¨³å®šæ€§æœ€å¸¸ç”¨çš„ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ Pod æ¢é’ˆï¼Œå¦ä¸€ç§æ˜¯ Pod çš„èµ„æºè¯·æ±‚å’Œé™åˆ¶ã€‚</p><h2>Pod æ¢é’ˆ</h2><p>ä½ ä¸€å®šè§è¿‡å¿ƒç”µç›‘æµ‹è®¾å¤‡å§ï¼Œåœ¨ç—…äººèº«ä¸Šè´´ä¸Šå‡ ä¸ªç”µææ¥æ£€æŸ¥å¿ƒè·³æƒ…å†µï¼Œä»è€Œäº†è§£ç—…äººçš„å¥åº·çŠ¶å†µã€‚K8s æä¾›çš„ Pod æ¢é’ˆä¹Ÿæœ‰ç±»ä¼¼çš„åŠŸèƒ½ï¼Œåªä¸è¿‡å®ƒçš„ç›‘æµ‹å¯¹è±¡æ˜¯é›†ç¾¤ä¸­çš„ Podã€‚Pod æ¢é’ˆé€šè¿‡å®šæœŸæ£€æŸ¥ Pod å®¹å™¨çš„å­˜æ´»å’Œå°±ç»ªçŠ¶æ€ï¼Œä»è€Œç›‘æµ‹ Pod å®¹å™¨çš„å¥åº·æƒ…å†µã€‚å¯¹äºä¸å¥åº·çš„ Pod å®¹å™¨ï¼Œå¯ä»¥æ ¹æ®ç­–ç•¥è‡ªåŠ¨é‡å¯ã€æ›¿æ¢ï¼Œæˆ–è€…ç§»å‡º Service çš„ä»£ç†åˆ—è¡¨ï¼Œç¡®ä¿åº”ç”¨çš„ç¨³å®šæ€§å’Œå¯é æ€§ï¼Œå¤§å¤§å‡è½»äº†è¿ç»´äººå‘˜çš„å·¥ä½œé‡ã€‚</p><h3>æ¢é’ˆç§ç±»</h3><p>é’ˆå¯¹ Pod å®¹å™¨å¯åŠ¨å’Œè¿è¡Œè¿‡ç¨‹ï¼ŒK8s æä¾›äº† 3 ç§ç±»å‹çš„æ¢é’ˆã€‚</p><ul>\n<li><strong>å¯åŠ¨æ¢é’ˆï¼ˆStartup Probesï¼‰</strong><strong>ï¼š</strong>å¯åŠ¨æ¢é’ˆç”¨äºç¡®å®šå®¹å™¨æ˜¯å¦å·²ç»å®Œå…¨å¯åŠ¨ã€‚åœ¨å®¹å™¨å¯åŠ¨æœŸé—´ï¼Œå¯åŠ¨æ¢é’ˆè¿›è¡Œæ¢æµ‹ï¼Œå¦‚æœæ¢æµ‹å¤±è´¥ï¼ŒK8s ä¼šè®¤ä¸ºå®¹å™¨å¯åŠ¨å¤±è´¥ï¼Œå¹¶æ ¹æ®é‡å¯ç­–ç•¥è¿›è¡Œé‡å¯ã€‚åœ¨å¯åŠ¨æ¢é’ˆæ¢æµ‹æˆåŠŸä¹‹å‰ï¼Œå…¶ä»–ç±»å‹çš„æ¢é’ˆéƒ½ä¼šæš‚æ—¶å¤„äºç¦ç”¨çŠ¶æ€ã€‚å¯åŠ¨æ¢é’ˆä¸€æ—¦æ£€æµ‹æˆåŠŸï¼Œå°±åœæ­¢äº†ã€‚è¿™ä¸»è¦é€‚ç”¨äºå®¹å™¨å¯åŠ¨æ—¶é—´è¾ƒé•¿çš„åœºæ™¯ã€‚</li>\n<li><strong>å°±ç»ªæ¢é’ˆï¼ˆReadiness Probesï¼‰</strong><strong>ï¼š</strong>å°±ç»ªæ¢é’ˆç”¨äºç¡®å®šå®¹å™¨æ˜¯å¦å·²ç»å‡†å¤‡å¥½æ¥æ”¶è®¿é—®è¯·æ±‚ã€‚å¦‚æœå°±ç»ªæ¢é’ˆæ¢æµ‹å¤±è´¥ï¼ŒK8s ä¼šå°†è¯¥å®¹å™¨ä» Service è´Ÿè½½å‡è¡¡çš„ä»£ç†åˆ—è¡¨ä¸­æ¸…é™¤ã€‚å¦‚æœæ¢æµ‹æˆåŠŸï¼ŒPod ä¼šè¿›å…¥ READY çŠ¶æ€ï¼Œå¹¶è¢«åŠ å…¥åˆ° Service çš„ Endpoints ç»ˆç«¯åˆ—è¡¨ä¸­ã€‚è¿™ç¡®ä¿äº†åªæœ‰å®Œå…¨å¯åŠ¨å¹¶å‡†å¤‡å¥½å¯¹å¤–æä¾›æœåŠ¡çš„å®¹å™¨æ‰ä¼šæ¥æ”¶è¯·æ±‚ã€‚</li>\n<li><strong>å­˜æ´»æ¢é’ˆï¼ˆLiveness Probesï¼‰</strong><strong>ï¼š</strong>å­˜æ´»æ¢é’ˆç”¨äºç¡®å®šå®¹å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚å¦‚æœå­˜æ´»æ¢é’ˆæ¢æµ‹å¤±è´¥ï¼ŒK8s ä¼šè®¤ä¸ºå®¹å™¨ä¸å†å¥åº·ï¼Œå¹¶æ ¹æ®å®¹å™¨çš„é‡å¯ç­–ç•¥æ¥é‡å¯å®ƒã€‚è¿™æœ‰åŠ©äºè‡ªåŠ¨æ¢å¤é‚£äº›è¿›å…¥å¼‚å¸¸çŠ¶æ€ä½†æœªå´©æºƒçš„å®¹å™¨ã€‚</li>\n</ul><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/c1/37/c1c79a90f246caef00c3f6f26900fc37.jpg?wh=1600x792\" alt=\"å›¾ç‰‡\"></p><p>è¿™ 3 ç§æ¢é’ˆåˆ†åˆ«å¯¹åº” Pod å®¹å™¨çš„ä¸åŒç›‘æµ‹åœºæ™¯ï¼Œå¯ä»¥ç»„åˆä½¿ç”¨ï¼Œä»è€Œæä¾›æ›´å…¨é¢ã€æ›´å¯é ã€æ›´ç²¾ç»†çš„å®¹å™¨çŠ¶æ€ç®¡ç†ç­–ç•¥ï¼Œæ»¡è¶³ä¸åŒçš„åº”ç”¨ç›‘æµ‹éœ€æ±‚ã€‚</p><h3>ä½¿ç”¨æ¢é’ˆ</h3><p>ä¸‹é¢æˆ‘æ¥ä»‹ç»ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨æ¢é’ˆã€‚æ¯ç§æ¢é’ˆéƒ½å®šä¹‰åœ¨ Pod çš„ YAML æ–‡ä»¶ä¸­ï¼Œé€šè¿‡ä¸€ç»„ç‰¹å®šçš„å±æ€§æ¥é…ç½®æ¢é’ˆã€‚å…¶ä¸­æœ€é‡è¦çš„å±æ€§æ˜¯æ¢æµ‹æ–¹å¼ï¼ˆProbe Typeï¼‰ï¼Œå®ƒæœ‰ 4 ç§ç±»å‹ï¼Œéœ€è¦å’Œæ¢æµ‹æ“ä½œï¼ˆProbe Actionï¼‰é…åˆä½¿ç”¨ã€‚</p><ul>\n<li><strong>httpGetï¼š</strong>è¿™ç§ç±»å‹é€šè¿‡ HTTP&nbsp;GET&nbsp;è¯·æ±‚çš„æ–¹å¼è®¿é—®å®¹å™¨ä¸­åº”ç”¨å¯¹å¤–æä¾›çš„ API æ¥å£ã€‚å¦‚æœå“åº”çš„çŠ¶æ€ç å¤§äºç­‰äº 200 ä¸”å°äº 400ï¼Œåˆ™è®¤ä¸ºè¯Šæ–­æˆåŠŸã€‚é€šå¸¸ï¼Œä½ å¯ä»¥åœ¨åº”ç”¨ä¸­ä¸“é—¨æä¾›ä¸€ä¸ªç®€å•çš„ HTTP GET è¯·æ±‚æ¢æµ‹æ¥å£ã€‚</li>\n<li><strong>tcpSocketï¼š</strong>è¿™ç§ç±»å‹å¯ä»¥å¯¹å®¹å™¨çš„æŒ‡å®šç«¯å£æ‰§è¡Œ TCP æ£€æŸ¥ã€‚å¦‚æœç«¯å£æ‰“å¼€ï¼Œåˆ™è®¤ä¸ºè¯Šæ–­æˆåŠŸã€‚é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šæ¢æµ‹å®¹å™¨ä¸­åº”ç”¨æš´éœ²çš„ç«¯å£ï¼ŒTCP æ£€æµ‹çš„é…ç½®å’Œ HTTP æ£€æµ‹éå¸¸ç›¸ä¼¼ã€‚</li>\n<li><strong>execï¼š</strong>åœ¨å®¹å™¨å†…æ‰§è¡ŒæŒ‡å®šå‘½ä»¤ã€‚å¦‚æœå‘½ä»¤é€€å‡ºæ—¶è¿”å›ç ä¸º0ï¼Œåˆ™è®¤ä¸ºè¯Šæ–­æˆåŠŸã€‚è¿™ç§æ–¹å¼é€šå¸¸æ›´åŠ ç®€å•ï¼Œæ¯”å¦‚åœ¨è¿è¡Œ Nginx çš„å®¹å™¨ä¸­æ£€æµ‹é…ç½®æ–‡ä»¶æ˜¯å¦å¯ä»¥è¯»å–æˆåŠŸã€‚</li>\n<li><strong>grpcï¼š</strong>ä½¿ç”¨&nbsp;gRPC&nbsp;æ‰§è¡Œä¸€ä¸ªè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ã€‚åº”ç”¨éœ€è¦å®ç°&nbsp;gRPC å¥åº·æ£€æŸ¥ï¼Œè¿™ç§æ–¹å¼æ¯”è¾ƒå°‘ç”¨ã€‚</li>\n</ul><p><strong>æ³¨æ„ï¼š</strong>Pod æ¢é’ˆç”¨äºæ£€æµ‹å®¹å™¨ä¸­è¿è¡Œçš„åº”ç”¨çš„å¥åº·çŠ¶æ€ã€‚å¦‚æœä¸€ä¸ª Pod æœ‰å¤šä¸ªå®¹å™¨ï¼Œæ¯ä¸ªå®¹å™¨éƒ½å¯ä»¥å®šä¹‰è‡ªå·±çš„æ¢é’ˆã€‚å› æ­¤ï¼Œåœ¨ YAML æ–‡ä»¶ä¸­ï¼Œæ¢é’ˆçš„å®šä¹‰ä½äºå®¹å™¨å±‚çº§ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æ¥å†™ä¸€ä¸ªä½¿ç”¨æ¢é’ˆçš„ Pod çš„ YAML æ–‡ä»¶ï¼ˆmy-probe-nginx-pod.yamlï¼‰ï¼Œäº†è§£æ¢é’ˆå¦‚ä½•åº”ç”¨ã€‚å½“ç„¶æ¢é’ˆä¹Ÿå¯ä»¥ç”¨åœ¨ Deployment ç­‰èµ„æºå¯¹è±¡çš„ Pod æ¨¡æ¿ä¸­ã€‚</p><pre><code class=\"language-yaml\"># my-probe-nginx-pod.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n&nbsp; name: my-probe-nginx-pod\nspec:\n&nbsp; containers:\n&nbsp; - name: nginx-c\n&nbsp; &nbsp; image: ubuntu/nginx\n&nbsp; &nbsp; startupProbe:  # å¯åŠ¨æ¢é’ˆ\n      exec:\n        command:\n        - cat\n        - /etc/nginx/nginx.conf\n      initialDelaySeconds: 5\n      periodSeconds: 5\n      failureThreshold: 3\n    readinessProbe:  # å°±ç»ªæ¢é’ˆ\n      httpGet:\n        path: /\n        port: 80\n      initialDelaySeconds: 15\n      periodSeconds: 10\n      timeoutSeconds: 3\n    livenessProbe:  # å­˜æ´»æ¢é’ˆ\n&nbsp; &nbsp; &nbsp; tcpSocket:\n&nbsp; &nbsp; &nbsp; &nbsp; port: 80\n&nbsp; &nbsp; &nbsp; initialDelaySeconds: 15\n&nbsp; &nbsp; &nbsp; periodSeconds: 10\n      failureThreshold: 3\n</code></pre><ul>\n<li><strong>initialDelaySeconds</strong><strong>ï¼š</strong>æŒ‡å®šå®¹å™¨å¯åŠ¨åï¼Œéœ€è¦å»¶è¿Ÿç­‰å¾…å¤šå°‘ç§’åæ‰å¯åŠ¨æ¢é’ˆã€‚å¦‚æœå®šä¹‰äº†å¯åŠ¨æ¢é’ˆï¼Œåˆ™å­˜æ´»æ¢é’ˆå’Œå°±ç»ªæ¢é’ˆçš„å»¶è¿Ÿå°†åœ¨å¯åŠ¨æ¢é’ˆæˆåŠŸåæ‰å¼€å§‹è®¡ç®—ã€‚é»˜è®¤å€¼å’Œæœ€å°å€¼éƒ½æ˜¯0ã€‚</li>\n<li><strong>periodSeconds</strong><strong>ï¼š</strong>æŒ‡å®šæ¯æ¬¡æ‰§è¡Œæ¢æµ‹çš„é—´éš”æ—¶é—´ï¼ˆç§’ï¼‰ã€‚é»˜è®¤å€¼ 10ï¼Œæœ€å°å€¼ 1ã€‚</li>\n<li><strong>timeoutSeconds</strong><strong>ï¼š</strong>æŒ‡å®šæ¢æµ‹è¶…æ—¶åç­‰å¾…é‡è¯•çš„æ—¶é—´ï¼ˆç§’ï¼‰ã€‚é»˜è®¤å€¼ 1ï¼Œæœ€å°å€¼ 1ã€‚</li>\n<li><strong>failureThreshold</strong><strong>ï¼š</strong>æŒ‡å®šå¦‚æœæ¢é’ˆè¿ç»­å¤±è´¥è¾¾åˆ°å¤šå°‘æ¬¡ï¼ŒK8s å°†è®¤ä¸ºæ•´ä½“æ£€æŸ¥å¤±è´¥ï¼Œå³å®¹å™¨çš„çŠ¶æ€ä¸ºæœªå°±ç»ªã€ä¸å¥åº·æˆ–ä¸æ´»è·ƒã€‚</li>\n</ul><p><strong>æ³¨æ„</strong><strong>ï¼š</strong>è¿™é‡Œ Pod ä½¿ç”¨ ubuntu/nginx é•œåƒï¼Œå› æ­¤ï¼Œå¯ä»¥è¿›å…¥å®¹å™¨æ‰§è¡Œ Linux å‘½ä»¤ï¼Œæ–¹ä¾¿æŸ¥çœ‹æ¢é’ˆæ•ˆæœï¼Œå¦‚æœæ˜¯å®˜æ–¹çš„ Nginx é•œåƒï¼Œé‡Œé¢æ²¡æœ‰å®‰è£… Linux ç»ˆç«¯å‘½ä»¤ã€‚</p><p>æˆ‘ä»¬åœ¨è¿™ä¸ª Pod ä¸­å®šä¹‰äº† 3 ç§æ¢é’ˆï¼Œå¯åŠ¨æ¢é’ˆä½¿ç”¨ exec å‘½ä»¤æ¢æµ‹ï¼Œæ‰§è¡Œå‘½ä»¤æŸ¥çœ‹ Nginx é…ç½®æ–‡ä»¶ï¼›å°±ç»ªæ¢é’ˆä½¿ç”¨ httpGet çš„æ–¹å¼æ¢æµ‹ï¼Œé€šè¿‡ HTTP è¯·æ±‚è·å– Web æœåŠ¡çš„é¦–é¡µï¼›å­˜æ´»æ¢é’ˆä½¿ç”¨ tcpSocket æ–¹å¼æ¢æµ‹ï¼Œé€šè¿‡æ£€æµ‹ Nginx ä½¿ç”¨çš„ TCP 80 ç«¯å£ã€‚</p><p>éƒ¨ç½² Podï¼Œä½¿ç”¨ â€œkubectl describeâ€ å‘½ä»¤æŸ¥çœ‹ Pod è¯¦æƒ…ï¼Œå¯ä»¥çœ‹åˆ° 3 ä¸ªæ¢é’ˆå·²ç»è¢«åŠ è½½ã€‚</p><pre><code class=\"language-bash\">[root@k8s-master ~]# kubectl apply -f my-probe-nginx-pod.yaml&nbsp;\npod/my-probe-nginx-pod created \n\n[root@k8s-master ~]# kubectl describe pod my-probe-nginx-pod \n......\nContainers:\n&nbsp; nginx-c:\n&nbsp; &nbsp; ......\n&nbsp; &nbsp; Liveness:&nbsp; &nbsp; &nbsp; &nbsp;tcp-socket :80 delay=15s timeout=1s period=10s #success=1 #failure=3\n&nbsp; &nbsp; Readiness:&nbsp; &nbsp; &nbsp; http-get http://:80/ delay=15s timeout=3s period=10s #success=1 #failure=3\n&nbsp; &nbsp; Startup:&nbsp; &nbsp; &nbsp; &nbsp; exec [cat /etc/nginx/aaa.conf] delay=5s timeout=1s period=5s #success=1 #failure=3\n......\n</code></pre><h3>éªŒè¯æ¢é’ˆ</h3><p>ç›®å‰è¿™ä¸ª Pod è¿è¡Œæ­£å¸¸ï¼Œæ¢é’ˆä¹Ÿåœ¨æ­£å¸¸å·¥ä½œã€‚æˆ‘ä»¬æ¥ä¿®æ”¹æ¢é’ˆçš„é…ç½®ï¼Œåˆ¶é€ ä¸€ä¸ªæ¢é’ˆæ¢æµ‹å¤±è´¥çš„æƒ…å†µï¼Œå†æ¥è§‚å¯Ÿ Pod çš„è¿è¡Œæƒ…å†µã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ä¿®æ”¹ Pod ä¸­çš„å¯åŠ¨æ¢é’ˆï¼Œæ”¹æˆæ£€æµ‹ä¸€ä¸ª Nginx åº”ç”¨ä¸­ä¸å­˜åœ¨çš„æ–‡ä»¶åï¼Œå†é‡æ–°éƒ¨ç½²ä¸€ä¸‹ï¼ŒæŸ¥çœ‹ Pod è¯¦æƒ…ã€‚</p><pre><code class=\"language-yaml\">...\n    startupProbe:  # å¯åŠ¨æ¢é’ˆ\n      exec:\n        command:\n        - cat\n        - /etc/nginx/aaa.conf    # ä¸å­˜åœ¨çš„é…ç½®æ–‡ä»¶\n      initialDelaySeconds: 5\n      periodSeconds: 5\n      failureThreshold: 3\n...\n</code></pre><p>é€šè¿‡ Pod è¯¦æƒ…ä¸­çš„ Events äº‹ä»¶å¯ä»¥çœ‹å‡ºï¼Œå¯åŠ¨æ¢é’ˆæ£€æµ‹å¤±è´¥ï¼Œä¸‰æ¬¡é‡è¯•ä¹‹åï¼ŒPod é‡å¯ã€‚</p><pre><code class=\"language-bash\">Events:\n&nbsp; Type&nbsp; &nbsp; &nbsp;Reason&nbsp; &nbsp; &nbsp;Age&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;From&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Message\n&nbsp; ----&nbsp; &nbsp; &nbsp;------&nbsp; &nbsp; &nbsp;----&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ----&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-------\n&nbsp; Normal&nbsp; &nbsp;Scheduled&nbsp; 9m23s&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default-scheduler&nbsp; Successfully assigned default/my-probe-nginx-pod to k8s-worker2\n&nbsp; Normal&nbsp; &nbsp;Pulled&nbsp; &nbsp; &nbsp;8m59s&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;kubelet&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Successfully pulled image \"ubuntu/nginx\" in 21.994s (21.994s including waiting)\n&nbsp; Normal&nbsp; &nbsp;Pulled&nbsp; &nbsp; &nbsp;8m27s&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;kubelet&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Successfully pulled image \"ubuntu/nginx\" in 15.434s (15.434s including waiting)\n&nbsp; Normal&nbsp; &nbsp;Created&nbsp; &nbsp; 7m57s (x3 over 8m59s)&nbsp; &nbsp;kubelet&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Created container nginx-c\n&nbsp; Normal&nbsp; &nbsp;Started&nbsp; &nbsp; 7m57s (x3 over 8m59s)&nbsp; &nbsp;kubelet&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Started container nginx-c\n&nbsp; Normal&nbsp; &nbsp;Pulled&nbsp; &nbsp; &nbsp;7m57s&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;kubelet&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Successfully pulled image \"ubuntu/nginx\" in 15.453s (15.453s including waiting)\n&nbsp; Normal&nbsp; &nbsp;Pulling&nbsp; &nbsp; 7m42s (x4 over 9m21s)&nbsp; &nbsp;kubelet&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Pulling image \"ubuntu/nginx\"\n&nbsp; Warning&nbsp; Unhealthy&nbsp; 7m42s (x9 over 8m52s)&nbsp; &nbsp;kubelet&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Startup probe failed: cat: /etc/nginx/aaa.conf: No such file or directory\n&nbsp; Normal&nbsp; &nbsp;Killing&nbsp; &nbsp; 7m42s (x3 over 8m42s)&nbsp; &nbsp;kubelet&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Container nginx-c failed startup probe, will be restarted\n</code></pre><p>å¯¹äºå‰©ä½™ä¸¤ç§æ¢é’ˆï¼ŒhttpGet æ–¹å¼çš„å°±ç»ªæ¢é’ˆå’Œ tcpSocket æ–¹å¼çš„å­˜æ´»æ¢é’ˆï¼Œå°±ä¸å†æ¼”ç¤ºæ¢æµ‹å¤±è´¥çš„æƒ…å†µã€‚ä½ å¯ä»¥é€šè¿‡ç±»ä¼¼çš„æ–¹æ³•è‡ªè¡Œä¿®æ”¹ YAML æ–‡ä»¶ä¸­çš„æ¢é’ˆé…ç½®æ¥å°è¯•ä¸€ä¸‹ã€‚</p><p>ä½¿ç”¨ Pod æ¢é’ˆæ˜¯å¢å¼ºåº”ç”¨ç¨³å®šæ€§çš„æœ€ä½³å®è·µä¹‹ä¸€ï¼Œå®ƒä»¬ä¸ºå®¹å™¨åŒ–åº”ç”¨æä¾›äº†å†…ç½®çš„è‡ªæˆ‘ä¿®å¤æœºåˆ¶ï¼Œç¡®ä¿åº”ç”¨çš„ç¨³å®šæ€§å’Œé«˜å¯ç”¨æ€§ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å°†å¸¦ä½ äº†è§£å¦ä¸€ç§é’ˆå¯¹ Pod çš„é…ç½®ï¼Œä»¥ä¿éšœé›†ç¾¤ç¨³å®šã€‚</p><h2>Pod çš„èµ„æºè¯·æ±‚å’Œèµ„æºé™é¢</h2><p>åœ¨ K8s é›†ç¾¤ä¸­ï¼Œå¯ä»¥é€šè¿‡ä¸º Pod ä¸­çš„å®¹å™¨è®¾ç½®èµ„æºè¯·æ±‚ï¼ˆRequestsï¼‰å’Œèµ„æºé™é¢ï¼ˆLimitsï¼‰ï¼Œç¡®ä¿ Pod è·å¾—è¶³å¤Ÿçš„ CPU å’Œå†…å­˜èµ„æºè¿è¡Œï¼ŒåŒæ—¶åˆé¿å… Pod æ¶ˆè€—è¿‡å¤šèŠ‚ç‚¹èµ„æºä»è€Œå½±å“é›†ç¾¤ä¸­çš„å…¶ä»–ç»„ä»¶ã€‚</p><p>èµ„æºè¯·æ±‚æŒ‡æ˜äº† Pod è¿è¡Œæ‰€éœ€çš„æœ€å°èµ„æºé‡ï¼Œæœ‰åŠ©äº K8s çš„è°ƒåº¦å™¨é€‰æ‹©åˆé€‚çš„èŠ‚ç‚¹è¿›è¡Œè°ƒåº¦ã€‚è€Œèµ„æºé™é¢å®šä¹‰äº† Pod å¯ä»¥ä½¿ç”¨çš„æœ€å¤§èµ„æºé‡ï¼Œå¦‚æœè¶…å‡ºè¿™äº›é™åˆ¶ï¼ŒPod å¯èƒ½ä¼šè¢«ç³»ç»Ÿç»ˆæ­¢ï¼Œä»¥ä¿æŠ¤é›†ç¾¤çš„ç¨³å®šæ€§ã€‚åœ¨ K8s ä¸­ï¼Œä½ åœ¨æäº¤ Pod æ—¶ï¼Œå¯ä»¥å£°æ˜ä¸€ä¸ªç›¸å¯¹è¾ƒå°çš„èµ„æºè¯·æ±‚å€¼ä¾›è°ƒåº¦å™¨ä½¿ç”¨ï¼Œè€Œ K8s å®é™…ä¸ºå®¹å™¨åˆ†é…çš„ CPU å’Œå†…å­˜ï¼Œåˆ™æ˜¯ç›¸å¯¹è¾ƒå¤§çš„èµ„æºé™é¢å€¼ã€‚å› æ­¤ï¼Œè°ƒåº¦æ—¶èµ„æºè¯·æ±‚æ¯”è¾ƒé‡è¦ï¼Œè€Œè¿è¡Œæ—¶èµ„æºé™é¢æ¯”è¾ƒé‡è¦ã€‚</p><h3>ä½¿ç”¨èµ„æºè¯·æ±‚å’Œèµ„æºé™é¢</h3><p>æˆ‘ä»¬æ¥åŠ¨æ‰‹ç»™ä¸€ä¸ª Pod å®¹å™¨é…ç½®èµ„æºè¯·æ±‚å’Œèµ„æºé™é¢ï¼Œèµ„æºè¯·æ±‚å’Œèµ„æºé™é¢ä¹Ÿæ˜¯é€šè¿‡å±æ€§å®šä¹‰åœ¨ Pod çš„ YAML æ–‡ä»¶ï¼ˆmy-nginx-resources.yamlï¼‰ä¸­ã€‚</p><pre><code class=\"language-yaml\"># my-nginx-resources-limit.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n&nbsp; name: my-nginx-resources-limit\nspec:\n&nbsp; containers:\n&nbsp; - name: nginx-c\n&nbsp; &nbsp; image: nginx\n&nbsp; &nbsp; resources:\n&nbsp; &nbsp; &nbsp; requests:\n&nbsp; &nbsp; &nbsp; &nbsp; memory: \"256Mi\"\n&nbsp; &nbsp; &nbsp; &nbsp; cpu: \"100m\"\n&nbsp; &nbsp; &nbsp; limits:\n&nbsp; &nbsp; &nbsp; &nbsp; memory: \"512Mi\"\n&nbsp; &nbsp; &nbsp; &nbsp; cpu: \"500m\"\n</code></pre><ul>\n<li><strong>cpuï¼š</strong>CPU èµ„æºåˆ†é…çš„ç»†ç²’åº¦æ˜¯é€šè¿‡ä½¿ç”¨æ¯«æ ¸ï¼ˆmillicoresï¼‰æ¥å®ç°çš„ï¼Œå…¶ä¸­1000 æ¯«æ ¸ç›¸å½“äº 1 ä¸ª CPU æ ¸ã€‚ä¾‹å¦‚ï¼Œ100m =100æ¯«æ ¸= 0.1ä¸ª CPU æ ¸ã€‚å› æ­¤ï¼Œåœ¨ä¸€ä¸ªæ‹¥æœ‰ 4 æ ¸ CPU çš„èŠ‚ç‚¹ä¸Šï¼Œå¯åˆ†é…çš„ CPU èµ„æºæ€»é‡ä¸º4000æ¯«æ ¸ã€‚</li>\n<li><strong>memoryï¼š</strong>å†…å­˜èµ„æºé€šå¸¸ä»¥å­—èŠ‚ä¸ºå•ä½ï¼Œå¦‚ Kiã€Mi å’Œ Giã€‚æ³¨æ„ï¼Œ MiB â‰  MBï¼ŒMB æ˜¯åè¿›åˆ¶å•ä½ï¼Œå³ 1MB=1000KBï¼›è€Œ MiB æ˜¯äºŒè¿›åˆ¶ï¼Œå³ 1MiB=1024KiBã€‚</li>\n</ul><p><strong>æ³¨æ„</strong><strong>ï¼š</strong>Pod èµ„æºè¯·æ±‚å’Œèµ„æºé™é¢éƒ½æ˜¯é’ˆå¯¹å®¹å™¨çš„é…ç½®ã€‚å¦‚æœä¸€ä¸ª Pod æœ‰å¤šä¸ªå®¹å™¨ï¼Œæ¯ä¸ªå®¹å™¨éƒ½å¯ä»¥å®šä¹‰è‡ªå·±çš„èµ„æºè¯·æ±‚å’Œèµ„æºé™é¢ã€‚å› æ­¤ï¼Œåœ¨ YAML æ–‡ä»¶ä¸­ï¼Œå®ƒä»¬ä¹Ÿæ˜¯ä½äºå®¹å™¨å±‚çº§ã€‚</p><p>å¦‚æœæ²¡æœ‰è®¾ç½®èµ„æºé™é¢ï¼ŒPod å¯ä»¥ä½¿ç”¨èŠ‚ç‚¹ä¸Šæ‰€æœ‰å¯ç”¨çš„ç©ºé—²èµ„æºã€‚å¦‚æœè®¾ç½®äº†èµ„æºé™é¢è€Œæ²¡æœ‰è®¾ç½®èµ„æºè¯·æ±‚æ—¶ï¼ŒK8s é»˜è®¤ä¼šå°†èµ„æºè¯·æ±‚å€¼ç­‰äºèµ„æºé™é¢å€¼ã€‚</p><p>éƒ¨ç½² Pod èµ„æºï¼ŒæŸ¥çœ‹ Pod è¯¦æƒ…ï¼Œå¯ä»¥çœ‹åˆ°èµ„æºè¯·æ±‚å’Œèµ„æºé™é¢ã€‚</p><pre><code class=\"language-bash\">[root@k8s-master ~]# kubectl apply -f my-nginx-resources-limit.yaml\npod/my-nginx-resources-limit created\n[root@k8s-master ~]# kubectl describe pod my-nginx-resources-limit\n......\nContainers:\n&nbsp; nginx-c:\n&nbsp; &nbsp; ......\n&nbsp; &nbsp; Limits:\n&nbsp; &nbsp; &nbsp; cpu:&nbsp; &nbsp; &nbsp;500m\n&nbsp; &nbsp; &nbsp; memory:&nbsp; 512Mi\n&nbsp; &nbsp; Requests:\n&nbsp; &nbsp; &nbsp; cpu:&nbsp; &nbsp; &nbsp; &nbsp; 100m\n&nbsp; &nbsp; &nbsp; memory:&nbsp; &nbsp; &nbsp;256Mi\n......\n</code></pre><h3>Pod æœåŠ¡è´¨é‡ Qos</h3><p>é…ç½®å¥½ Pod çš„èµ„æºè¯·æ±‚å’Œèµ„æºé™é¢ï¼Œæˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼šå½“èŠ‚ç‚¹ä¸Šèµ„æºä¸å¤Ÿæ—¶ï¼ŒK8s ä¼šè§¦å‘æœºåˆ¶æ¥é©±é€ Podã€‚è¿™æ—¶ï¼ŒèŠ‚ç‚¹å¦‚ä½•é€‰æ‹©é©±é€å“ªä¸ª Pod å‘¢ï¼ŸPod ä¹‹é—´æœ‰ä¼˜å…ˆçº§å—ï¼Ÿ</p><p>è¿™å°±è¦è®²åˆ° K8s çš„æœåŠ¡è´¨é‡ QoSï¼ˆQuality of Serviceï¼‰æœºåˆ¶ã€‚K8s æ ¹æ® Pod çš„èµ„æºè¯·æ±‚å’Œèµ„æºé™é¢ï¼Œå°† Pod åˆ†ä¸ºä¸åŒçš„ QoS ç±»åˆ«ï¼Œå½“èŠ‚ç‚¹èµ„æºä¸è¶³æ—¶ï¼ŒK8s åŸºäºè¿™äº›ç±»åˆ«å†³å®šå“ªäº› Pod ä¼šè¢«ä¼˜å…ˆé©±é€ã€‚</p><p>æœåŠ¡è´¨é‡ç±»åˆ«åˆ†ä¸ºä¸‰ç§ï¼šGuaranteedã€Burstable å’Œ BestEffortã€‚K8s åŸºäºæ¯ä¸ª Pod çš„èµ„æºè¯·æ±‚å’Œèµ„æºé™é¢ä¸º Pod è®¾ç½® QoS ç±»åˆ«ï¼Œåˆ†ç±»è§„åˆ™å¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/5f/38/5f0f9b52b5f80d64c001e4f328f58f38.jpg?wh=1916x628\" alt=\"å›¾ç‰‡\"></p><p>å½“èŠ‚ç‚¹èµ„æºè€—å°½æ—¶ï¼ŒK8s å°†é¦–å…ˆé©±é€ BestEffort&nbsp;ç±»åˆ«çš„ Podï¼Œå…¶æ¬¡æ˜¯&nbsp;Burstable&nbsp;ç±»åˆ«çš„ Podï¼Œæœ€åæ‰æ˜¯&nbsp;Guaranteed&nbsp;ç±»åˆ« Podã€‚K8s ä¼šä¿éšœåªæœ‰å½“ Guaranteed ç±»åˆ«çš„ Pod çš„èµ„æºä½¿ç”¨é‡è¶…è¿‡äº†å…¶èµ„æºé™é¢çš„é™åˆ¶ï¼Œæˆ–è€…å®¿ä¸»æœºé¢ä¸´å†…å­˜ä¸è¶³æ—¶ï¼Œæ‰ä¼šç»ˆæ­¢è¿™ç±» Podã€‚</p><p>é€šè¿‡ QoS ç±»åˆ«ï¼ŒK8s èƒ½å¤Ÿå®ç° Pod èµ„æºçš„ä¼˜å…ˆçº§åˆ†é…ï¼Œä¼˜åŒ–èŠ‚ç‚¹çš„ CPU å’Œå†…å­˜åˆ©ç”¨ç‡ï¼Œä»è€Œç¡®ä¿å…³é”®åº”ç”¨çš„ç¨³å®šæ€§å’Œæ€§èƒ½ï¼Œå¸®åŠ©é›†ç¾¤åœ¨é¢ä¸´èµ„æºæœ‰é™æ—¶åšå‡ºåˆç†çš„è°ƒåº¦å†³ç­–ã€‚</p><h2><strong>å°ç»“</strong></h2><p>ä»Šå¤©ï¼Œæˆ‘è·Ÿä½ è®¨è®ºäº† K8s é›†ç¾¤ä¸­åº”ç”¨ç¨³å®šæ€§çš„ä¿éšœæœºåˆ¶ã€‚</p><p>é¦–å…ˆæ˜¯ Pod æ¢é’ˆï¼ŒK8s æä¾›äº† 3 ç§æ¢é’ˆç±»å‹ï¼ˆå¯åŠ¨æ¢é’ˆã€å°±ç»ªæ¢é’ˆã€å­˜æ´»æ¢é’ˆï¼‰ï¼Œå¦‚æœå®šä¹‰äº†å¯åŠ¨æ¢é’ˆï¼Œå®ƒä¼šé¦–å…ˆè¢«æ‰§è¡Œï¼Œå¯åŠ¨æ¢é’ˆç”¨äºåˆ¤æ–­å®¹å™¨æ˜¯å¦å·²ç»å¯åŠ¨å¹¶å‡†å¤‡æ¥å—è¯·æ±‚ã€‚å½“å¯åŠ¨æ¢é’ˆæˆåŠŸæˆ–è€…æœªå®šä¹‰æ—¶ï¼Œå°±ç»ªæ¢é’ˆå°†å¼€å§‹æ‰§è¡Œï¼Œå°±ç»ªæ¢é’ˆç”¨äºæ£€æŸ¥å®¹å™¨æ˜¯å¦å·²ç»å‡†å¤‡å¥½æ¥æ”¶å¤–éƒ¨è¯·æ±‚ã€‚æœ€åæ‰§è¡Œçš„æ˜¯å­˜æ´»æ¢é’ˆï¼Œå­˜æ´»æ¢é’ˆç”¨äºæ£€æŸ¥å®¹å™¨æ˜¯å¦è¿˜åœ¨è¿è¡Œã€‚å¦‚æœå­˜æ´»æ¢é’ˆæ£€æŸ¥å¤±è´¥ï¼ŒK8s ä¼šæ€æ­»å®¹å™¨å¹¶å°è¯•é‡å¯å®ƒã€‚è¿™äº›æ¢é’ˆé€šè¿‡ä¸åŒçš„ç›‘æµ‹æ–¹å¼ï¼Œå¯ä»¥å®šæ—¶ç›‘æµ‹å®¹å™¨çš„å¯åŠ¨ã€å°±ç»ªã€å­˜æ´»çŠ¶æ€ï¼Œä»è€Œè‡ªåŠ¨è¿›è¡Œå®¹å™¨çš„é‡å¯ã€æ›¿æ¢ã€ç§»å‡ºæœåŠ¡åˆ—è¡¨ç­‰æ“ä½œï¼Œç¡®ä¿åº”ç”¨çš„ç¨³å®šæ€§ã€‚</p><p>å…¶æ¬¡ï¼Œæˆ‘ä»¬è®²äº† Pod èµ„æºè¯·æ±‚å’Œèµ„æºé™é¢ï¼Œé€šè¿‡ä¸º Pod é…ç½® CPU å’Œå†…å­˜çš„èµ„æºè¯·æ±‚ï¼ˆRequestsï¼‰å’Œèµ„æºé™é¢ï¼ˆLimitsï¼‰ï¼Œå¯ä»¥ä¿è¯ Pod è·å¾—å¿…è¦çš„èŠ‚ç‚¹èµ„æºè¿è¡Œï¼ŒåŒæ—¶é˜²æ­¢èµ„æºè¢«è¿‡åº¦æ¶ˆè€—ã€‚Pod æŒ‰ç…§ä¸åŒèµ„æºè¯·æ±‚å’Œèµ„æºé™é¢é…ç½®ï¼Œå¯ä»¥å®šä¹‰ä¸ºä¸åŒçš„æœåŠ¡è´¨é‡ï¼ˆQoSï¼‰ç±»åˆ«ã€‚K8s æœ‰ä¸‰ç§æœåŠ¡è´¨é‡ç±»åˆ«ï¼ˆGuaranteedã€Burstableã€BestEffortï¼‰ï¼Œå½“èŠ‚ç‚¹èµ„æºè€—å°½æ—¶ï¼ŒK8s å°†é¦–å…ˆé©±é€ BestEffort&nbsp;ç±»åˆ«çš„ Podï¼Œ å…¶æ¬¡æ˜¯&nbsp;Burstable&nbsp;ç±»åˆ«çš„ Podï¼Œæœ€åæ‰æ˜¯&nbsp;Guaranteed&nbsp;ç±»åˆ«çš„ Podã€‚</p><p>æ³¨æ„ï¼ŒPod æ¢é’ˆå’Œ Pod èµ„æºè¯·æ±‚å’Œèµ„æºé™é¢çš„é…ç½®éƒ½æ˜¯é’ˆå¯¹ Pod ä¸­çš„å®¹å™¨ï¼Œå¦‚æœ Pod æœ‰å¤šä¸ªå®¹å™¨ï¼Œæ¯ä¸ªå®¹å™¨éƒ½å¯ä»¥é…ç½®è‡ªå·±çš„æ¢é’ˆã€èµ„æºè¯·æ±‚å’Œèµ„æºé™é¢ï¼Œåœ¨ç¼–å†™ YAML æ–‡ä»¶æ—¶éœ€è¦æ³¨æ„å±‚çº§å…³ç³»ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>è¿™å°±æ˜¯ä»Šå¤©çš„å…¨éƒ¨å†…å®¹ï¼Œæœ€åç»™ä½ ç•™ä¸€é“ç»ƒä¹ é¢˜ã€‚</p><p>è¯·ä½ éƒ¨ç½²ä¸€ä¸ªé•œåƒä¸º Busybox çš„ Podï¼Œå®šä¹‰å¯åŠ¨æ¢é’ˆæ¥æ£€æŸ¥å®¹å™¨ä¸­ â€œ/data/config.txtâ€ æ–‡ä»¶æ˜¯å¦åˆ›å»ºï¼ŒæŸ¥çœ‹ä¸€ä¸‹ Pod çš„è¿è¡ŒçŠ¶æ€ã€‚</p><p>ç„¶åå†æ¥ä¿®æ”¹ Podï¼Œåœ¨è¿è¡Œå®¹å™¨æ—¶æ‰§è¡Œ â€œtouch  /data/config.txtâ€ å‘½ä»¤æ¥åˆ›å»ºè¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œå†è§‚å¯Ÿä¸€ä¸‹ Pod çš„è¿è¡Œæƒ…å†µã€‚</p><p>ç›¸ä¿¡ç»è¿‡åŠ¨æ‰‹å®è·µï¼Œä¼šè®©ä½ å¯¹çŸ¥è¯†çš„ç†è§£æ›´åŠ æ·±åˆ»ã€‚</p>","neighbors":{"left":{"article_title":"14ï½œPodç›¸äº’è®¿é—®çš„ç½‘ç»œç­–ç•¥","id":796302},"right":{"article_title":"16ï½œé›†ç¾¤çŠ¶æ€è§‚æµ‹ä¸æŸ¥çœ‹æ—¥å¿—","id":797497}},"comments":[{"had_liked":false,"id":393579,"user_name":"Y","can_delete":false,"product_type":"c1","uid":1179432,"ip_address":"å¹¿ä¸œ","ucode":"952AA9B2CD91CE","user_header":"https://static001.geekbang.org/account/avatar/00/11/ff/28/040f6f01.jpg","comment_is_top":false,"comment_ctime":1724239173,"is_pvip":true,"replies":[{"id":142953,"content":"ä½ å¥½ï¼ŒYï¼Œåœ¨æ‰§è¡Œcommandçš„æ—¶å€™ä¼šè‡ªåŠ¨æ›¿æ¢é•œåƒä¸­å¯åŠ¨nginxçš„å‘½ä»¤ï¼Œæ‰€ä»¥nginxå®¹å™¨ä¼šå¯åŠ¨å¤±è´¥ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç”¨busyboxé•œåƒæ¥åšå®éªŒ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1209006,"ctime":1724653487,"ip_address":"åŒ—äº¬","comment_id":393579,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100780501,"comment_content":"1.è®¾ç½®å¯åŠ¨æ¢é’ˆ\n# my-pod-probe.yaml \napiVersion: v1\nkind: Pod\nmetadata:\n  name: my-pod-probe\nspec:\n  containers:\n  - name: nginx-c-probe\n    image: swr.cn-north-4.myhuaweicloud.com&#47;ddn-k8s&#47;docker.io&#47;nginx:1.26.1-alpine\n    startupProbe:\n      exec:\n        command:\n        - cat\n        - &#47;root&#47;config.txt\n      initialDelaySeconds: 5\n      periodSeconds: 5\n      successThreshold: 1\n      failureThreshold: 3\n\n2.ç„¶åå†æ¥ä¿®æ”¹ Podï¼Œåœ¨è¿è¡Œå®¹å™¨æ—¶æ‰§è¡Œ â€œtouch &#47;data&#47;config.txtâ€ å‘½ä»¤æ¥åˆ›å»ºè¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œå†è§‚å¯Ÿä¸€ä¸‹ Pod çš„è¿è¡Œæƒ…å†µ\n\nè¿™ä¸ªè¯•äº†åŠå¤©éƒ½æ²¡æˆåŠŸã€‚ä¸çŸ¥é“å“ªé‡Œå‡ºé—®é¢˜äº†ã€‚è¯·è€å¸ˆå¸®çœ‹ä¸€ä¸‹ã€‚\n# my-pod-probe.yaml \napiVersion: v1\nkind: Pod\nmetadata:\n  name: my-pod-probe\nspec:\n  containers:\n  - name: nginx-c-probe\n    image: swr.cn-north-4.myhuaweicloud.com&#47;ddn-k8s&#47;docker.io&#47;nginx:1.26.1-alpine\n    command: [&quot;&#47;bin&#47;sh&quot;, &quot;-c&quot;]\n    args: [&quot;touch &#47;root&#47;config.txt&quot;]\n    startupProbe:\n      exec:\n        command:\n        - cat\n        - &#47;root&#47;config.txt\n      initialDelaySeconds: 5\n      periodSeconds: 5\n      successThreshold: 1\n      failureThreshold: 3\n\n","like_count":0,"discussions":[{"author":{"id":1209006,"avatar":"https://static001.geekbang.org/account/avatar/00/12/72/ae/cef8a848.jpg","nickname":"é›ªé£","note":"","ucode":"36BDFD1E35E9DA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":650251,"discussion_content":"ä½ å¥½ï¼ŒYï¼Œåœ¨æ‰§è¡Œcommandçš„æ—¶å€™ä¼šè‡ªåŠ¨æ›¿æ¢é•œåƒä¸­å¯åŠ¨nginxçš„å‘½ä»¤ï¼Œæ‰€ä»¥nginxå®¹å™¨ä¼šå¯åŠ¨å¤±è´¥ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç”¨busyboxé•œåƒæ¥åšå®éªŒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1724653487,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":392892,"user_name":"æŠ±ç´§æˆ‘çš„å°é²¤é±¼","can_delete":false,"product_type":"c1","uid":1014603,"ip_address":"æ±Ÿè‹","ucode":"139780FB860FA3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7b/4b/95812b15.jpg","comment_is_top":false,"comment_ctime":1722070288,"is_pvip":false,"replies":[{"id":142729,"content":"ä½ å¥½ï¼Œå°é²¤é±¼ï¼Œæ²¡é—®é¢˜ğŸ‘ğŸ»","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1209006,"ctime":1722225635,"ip_address":"åŒ—äº¬","comment_id":392892,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100780501,"comment_content":"\n    readinessProbe:\n      exec:\n        command:\n        - cat\n        - &#47;data&#47;config.txt\n      initialDelaySeconds: 5\n      periodSeconds: 5\n      successThreshold: 1\n      failureThreshold: 3\n","like_count":0,"discussions":[{"author":{"id":1209006,"avatar":"https://static001.geekbang.org/account/avatar/00/12/72/ae/cef8a848.jpg","nickname":"é›ªé£","note":"","ucode":"36BDFD1E35E9DA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":648796,"discussion_content":"ä½ å¥½ï¼Œå°é²¤é±¼ï¼Œæ²¡é—®é¢˜ğŸ‘ğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1722225635,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]}]}