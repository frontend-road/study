{"id":702846,"title":"07ï½œè¾“å‡ºè§£æï¼šç”¨OutputParserç”Ÿæˆé²œèŠ±æ¨èåˆ—è¡¨","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯é»„ä½³ï¼Œæ¬¢è¿æ¥åˆ°LangChainå®æˆ˜è¯¾ï¼</p><p>é¦–å…ˆè¯·ä½ å›å¿†ä¸€ä¸‹<a href=\"https://time.geekbang.org/column/article/700699\">ç¬¬4è¯¾</a>ä¸­æˆ‘ä»¬å­¦äº†ä»€ä¹ˆ: ä¸ºä¸€äº›èŠ±å’Œä»·æ ¼ç”Ÿæˆå¸å¼•äººçš„æè¿°ï¼Œå¹¶å°†è¿™äº›æè¿°å’ŒåŸå› å­˜å‚¨åˆ°ä¸€ä¸ªCSVæ–‡ä»¶ä¸­ã€‚ä¸ºäº†å®ç°è¿™ä¸ªç›®æ ‡ï¼Œç¨‹åºè°ƒç”¨äº†OpenAIæ¨¡å‹ï¼Œå¹¶åˆ©ç”¨äº†ç»“æ„åŒ–è¾“å‡ºè§£æå™¨ï¼Œä»¥åŠä¸€äº›æ•°æ®å¤„ç†å’Œå­˜å‚¨çš„å·¥å…·ã€‚</p><p>ä»Šå¤©æˆ‘è¦å¸¦ç€ä½ æ·±å…¥ç ”ç©¶ä¸€ä¸‹LangChainä¸­çš„è¾“å‡ºè§£æå™¨ï¼Œå¹¶ç”¨ä¸€ä¸ªæ–°çš„è§£æå™¨â€”â€”Pydantic è§£æå™¨æ¥é‡æ„ç¬¬4è¯¾ä¸­çš„ç¨‹åºã€‚è¿™èŠ‚è¯¾ä¹Ÿæ˜¯æ¨¡å‹I/Oæ¡†æ¶çš„æœ€åä¸€è®²ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/62/2d/6215fdd31373523a46bb02f86283522d.jpg?wh=4000x1536\" alt=\"\" title=\"æ¨¡å‹ I/O Pipeline\"></p><p>ä¸‹é¢å…ˆæ¥çœ‹çœ‹LangChainä¸­çš„è¾“å‡ºè§£æå™¨ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Œæœ‰å“ªäº›ç§ç±»ã€‚</p><h2>LangChain ä¸­çš„è¾“å‡ºè§£æå™¨</h2><p>è¯­è¨€æ¨¡å‹è¾“å‡ºçš„æ˜¯æ–‡æœ¬ï¼Œè¿™æ˜¯ç»™äººç±»é˜…è¯»çš„ã€‚ä½†å¾ˆå¤šæ—¶å€™ï¼Œä½ å¯èƒ½æƒ³è¦è·å¾—çš„æ˜¯ç¨‹åºèƒ½å¤Ÿå¤„ç†çš„ç»“æ„åŒ–ä¿¡æ¯ã€‚è¿™å°±æ˜¯è¾“å‡ºè§£æå™¨å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚</p><p>è¾“å‡ºè§£æå™¨æ˜¯<strong>ä¸€ç§ä¸“ç”¨äºå¤„ç†å’Œæ„å»ºè¯­è¨€æ¨¡å‹å“åº”çš„ç±»</strong>ã€‚ä¸€ä¸ªåŸºæœ¬çš„è¾“å‡ºè§£æå™¨ç±»é€šå¸¸éœ€è¦å®ç°ä¸¤ä¸ªæ ¸å¿ƒæ–¹æ³•ã€‚</p><ul>\n<li>get_format_instructionsï¼šè¿™ä¸ªæ–¹æ³•éœ€è¦è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”¨äºæŒ‡å¯¼å¦‚ä½•æ ¼å¼åŒ–è¯­è¨€æ¨¡å‹çš„è¾“å‡ºï¼Œå‘Šè¯‰å®ƒåº”è¯¥å¦‚ä½•ç»„ç»‡å¹¶æ„å»ºå®ƒçš„å›ç­”ã€‚</li>\n<li>parseï¼šè¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆä¹Ÿå°±æ˜¯è¯­è¨€æ¨¡å‹çš„è¾“å‡ºï¼‰å¹¶å°†å…¶è§£æä¸ºç‰¹å®šçš„æ•°æ®ç»“æ„æˆ–æ ¼å¼ã€‚è¿™ä¸€æ­¥é€šå¸¸ç”¨äºç¡®ä¿æ¨¡å‹çš„è¾“å‡ºç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸï¼Œå¹¶ä¸”èƒ½å¤Ÿä»¥æˆ‘ä»¬éœ€è¦çš„å½¢å¼è¿›è¡Œåç»­å¤„ç†ã€‚</li>\n</ul><!-- [[[read_end]]] --><p>è¿˜æœ‰ä¸€ä¸ªå¯é€‰çš„æ–¹æ³•ã€‚</p><ul>\n<li>parse_with_promptï¼šè¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆä¹Ÿå°±æ˜¯è¯­è¨€æ¨¡å‹çš„è¾“å‡ºï¼‰å’Œä¸€ä¸ªæç¤ºï¼ˆç”¨äºç”Ÿæˆè¿™ä¸ªè¾“å‡ºçš„æç¤ºï¼‰ï¼Œå¹¶å°†å…¶è§£æä¸ºç‰¹å®šçš„æ•°æ®ç»“æ„ã€‚è¿™æ ·ï¼Œä½ å¯ä»¥æ ¹æ®åŸå§‹æç¤ºæ¥ä¿®æ­£æˆ–é‡æ–°è§£ææ¨¡å‹çš„è¾“å‡ºï¼Œç¡®ä¿è¾“å‡ºçš„ä¿¡æ¯æ›´åŠ å‡†ç¡®å’Œè´´åˆè¦æ±‚ã€‚</li>\n</ul><p>ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºäºä¸Šè¿°æè¿°çš„ç®€å•ä¼ªä»£ç ç¤ºä¾‹ï¼š</p><pre><code class=\"language-plain\">class OutputParser:\n&nbsp; &nbsp; def __init__(self):\n&nbsp; &nbsp; &nbsp; &nbsp; pass\n\n&nbsp; &nbsp; def get_format_instructions(self):\n&nbsp; &nbsp; &nbsp; &nbsp; # è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒæŒ‡å¯¼å¦‚ä½•æ ¼å¼åŒ–æ¨¡å‹çš„è¾“å‡º\n&nbsp; &nbsp; &nbsp; &nbsp; pass\n\n&nbsp; &nbsp; def parse(self, model_output):\n&nbsp; &nbsp; &nbsp; &nbsp; # è§£ææ¨¡å‹çš„è¾“å‡ºï¼Œè½¬æ¢ä¸ºæŸç§æ•°æ®ç»“æ„æˆ–æ ¼å¼\n&nbsp; &nbsp; &nbsp; &nbsp; pass\n\n&nbsp; &nbsp; def parse_with_prompt(self, model_output, prompt):\n&nbsp; &nbsp; &nbsp; &nbsp; # åŸºäºåŸå§‹æç¤ºè§£ææ¨¡å‹çš„è¾“å‡ºï¼Œè½¬æ¢ä¸ºæŸç§æ•°æ®ç»“æ„æˆ–æ ¼å¼\n&nbsp; &nbsp; &nbsp; &nbsp; pass\n</code></pre><p>åœ¨LangChainä¸­ï¼Œé€šè¿‡å®ç°get_format_instructionsã€parse å’Œ parse_with_prompt è¿™äº›æ–¹æ³•ï¼Œé’ˆå¯¹ä¸åŒçš„ä½¿ç”¨åœºæ™¯å’Œç›®æ ‡ï¼Œè®¾è®¡äº†å„ç§è¾“å‡ºè§£æå™¨ã€‚è®©æˆ‘ä»¬æ¥é€ä¸€è®¤è¯†ä¸€ä¸‹ã€‚</p><ol>\n<li>åˆ—è¡¨è§£æå™¨ï¼ˆList Parserï¼‰ï¼šè¿™ä¸ªè§£æå™¨ç”¨äºå¤„ç†æ¨¡å‹ç”Ÿæˆçš„è¾“å‡ºï¼Œå½“éœ€è¦æ¨¡å‹çš„è¾“å‡ºæ˜¯ä¸€ä¸ªåˆ—è¡¨çš„æ—¶å€™ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ è¯¢é—®æ¨¡å‹â€œåˆ—å‡ºæ‰€æœ‰é²œèŠ±çš„åº“å­˜â€ï¼Œæ¨¡å‹çš„å›ç­”åº”è¯¥æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚</li>\n<li>æ—¥æœŸæ—¶é—´è§£æå™¨ï¼ˆDatetime Parserï¼‰ï¼šè¿™ä¸ªè§£æå™¨ç”¨äºå¤„ç†æ—¥æœŸå’Œæ—¶é—´ç›¸å…³çš„è¾“å‡ºï¼Œç¡®ä¿æ¨¡å‹çš„è¾“å‡ºæ˜¯æ­£ç¡®çš„æ—¥æœŸæˆ–æ—¶é—´æ ¼å¼ã€‚</li>\n<li>æšä¸¾è§£æå™¨ï¼ˆEnum Parserï¼‰ï¼šè¿™ä¸ªè§£æå™¨ç”¨äºå¤„ç†é¢„å®šä¹‰çš„ä¸€ç»„å€¼ï¼Œå½“æ¨¡å‹çš„è¾“å‡ºåº”è¯¥æ˜¯è¿™ç»„é¢„å®šä¹‰å€¼ä¹‹ä¸€æ—¶ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å®šä¹‰äº†ä¸€ä¸ªé—®é¢˜çš„ç­”æ¡ˆåªèƒ½æ˜¯â€œæ˜¯â€æˆ–â€œå¦â€ï¼Œé‚£ä¹ˆæšä¸¾è§£æå™¨å¯ä»¥ç¡®ä¿æ¨¡å‹çš„å›ç­”æ˜¯è¿™ä¸¤ä¸ªé€‰é¡¹ä¹‹ä¸€ã€‚</li>\n<li>ç»“æ„åŒ–è¾“å‡ºè§£æå™¨ï¼ˆStructured Output Parserï¼‰ï¼šè¿™ä¸ªè§£æå™¨ç”¨äºå¤„ç†å¤æ‚çš„ã€ç»“æ„åŒ–çš„è¾“å‡ºã€‚å¦‚æœä½ çš„åº”ç”¨éœ€è¦æ¨¡å‹ç”Ÿæˆå…·æœ‰ç‰¹å®šç»“æ„çš„å¤æ‚å›ç­”ï¼ˆä¾‹å¦‚ä¸€ä»½æŠ¥å‘Šã€ä¸€ç¯‡æ–‡ç« ç­‰ï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ç»“æ„åŒ–è¾“å‡ºè§£æå™¨æ¥å®ç°ã€‚</li>\n<li>Pydanticï¼ˆJSONï¼‰è§£æå™¨ï¼šè¿™ä¸ªè§£æå™¨ç”¨äºå¤„ç†æ¨¡å‹çš„è¾“å‡ºï¼Œå½“æ¨¡å‹çš„è¾“å‡ºåº”è¯¥æ˜¯ä¸€ä¸ªç¬¦åˆç‰¹å®šæ ¼å¼çš„JSONå¯¹è±¡æ—¶ä½¿ç”¨ã€‚å®ƒä½¿ç”¨Pydanticåº“ï¼Œè¿™æ˜¯ä¸€ä¸ªæ•°æ®éªŒè¯åº“ï¼Œå¯ä»¥ç”¨äºæ„å»ºå¤æ‚çš„æ•°æ®æ¨¡å‹ï¼Œå¹¶ç¡®ä¿æ¨¡å‹çš„è¾“å‡ºç¬¦åˆé¢„æœŸçš„æ•°æ®æ¨¡å‹ã€‚</li>\n<li>è‡ªåŠ¨ä¿®å¤è§£æå™¨ï¼ˆAuto-Fixing Parserï¼‰ï¼šè¿™ä¸ªè§£æå™¨å¯ä»¥è‡ªåŠ¨ä¿®å¤æŸäº›å¸¸è§çš„æ¨¡å‹è¾“å‡ºé”™è¯¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ¨¡å‹çš„è¾“å‡ºåº”è¯¥æ˜¯ä¸€æ®µæ–‡æœ¬ï¼Œä½†æ˜¯æ¨¡å‹è¿”å›äº†ä¸€æ®µåŒ…å«è¯­æ³•æˆ–æ‹¼å†™é”™è¯¯çš„æ–‡æœ¬ï¼Œè‡ªåŠ¨ä¿®å¤è§£æå™¨å¯ä»¥è‡ªåŠ¨çº æ­£è¿™äº›é”™è¯¯ã€‚</li>\n<li>é‡è¯•è§£æå™¨ï¼ˆRetryWithErrorOutputParserï¼‰ï¼šè¿™ä¸ªè§£æå™¨ç”¨äºåœ¨æ¨¡å‹çš„åˆæ¬¡è¾“å‡ºä¸ç¬¦åˆé¢„æœŸæ—¶ï¼Œå°è¯•ä¿®å¤æˆ–é‡æ–°ç”Ÿæˆæ–°çš„è¾“å‡ºã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ¨¡å‹çš„è¾“å‡ºåº”è¯¥æ˜¯ä¸€ä¸ªæ—¥æœŸï¼Œä½†æ˜¯æ¨¡å‹è¿”å›äº†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆé‡è¯•è§£æå™¨å¯ä»¥é‡æ–°æç¤ºæ¨¡å‹ç”Ÿæˆæ­£ç¡®çš„æ—¥æœŸæ ¼å¼ã€‚</li>\n</ol><p>ä¸Šé¢çš„å„ç§è§£æå™¨ä¸­ï¼Œå‰ä¸‰ç§å¾ˆå®¹æ˜“ç†è§£ï¼Œè€Œç»“æ„åŒ–è¾“å‡ºè§£æå™¨ä½ å·²ç»ç”¨è¿‡äº†ã€‚æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬é‡ç‚¹è®²ä¸€è®²Pydanticï¼ˆJSONï¼‰è§£æå™¨ã€è‡ªåŠ¨ä¿®å¤è§£æå™¨å’Œé‡è¯•è§£æå™¨ã€‚</p><h2>Pydanticï¼ˆJSONï¼‰è§£æå™¨å®æˆ˜</h2><p>Pydantic (JSON) è§£æå™¨åº”è¯¥æ˜¯æœ€å¸¸ç”¨ä¹Ÿæ˜¯æœ€é‡è¦çš„è§£æå™¨ï¼Œæˆ‘å¸¦ç€ä½ ç”¨å®ƒæ¥é‡æ„é²œèŠ±æ–‡æ¡ˆç”Ÿæˆç¨‹åºã€‚</p><blockquote>\n<p><span class=\"reference\">Pydantic æ˜¯ä¸€ä¸ª Python æ•°æ®éªŒè¯å’Œè®¾ç½®ç®¡ç†åº“ï¼Œä¸»è¦åŸºäº Python ç±»å‹æç¤ºã€‚å°½ç®¡å®ƒä¸æ˜¯ä¸“ä¸º JSON è®¾è®¡çš„ï¼Œä½†ç”±äº JSON æ˜¯ç°ä»£ Web åº”ç”¨å’Œ API äº¤äº’ä¸­çš„å¸¸è§æ•°æ®æ ¼å¼ï¼ŒPydantic åœ¨å¤„ç†å’ŒéªŒè¯ JSON æ•°æ®æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚</span></p>\n</blockquote><h3>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæ¨¡å‹å®ä¾‹</h3><p>å…ˆé€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½®OpenAI APIå¯†é’¥ï¼Œç„¶åä½¿ç”¨LangChainåº“åˆ›å»ºäº†ä¸€ä¸ªOpenAIçš„æ¨¡å‹å®ä¾‹ã€‚è¿™é‡Œæˆ‘ä»¬ä»ç„¶é€‰æ‹©äº†text-davinci-003ä½œä¸ºå¤§è¯­è¨€æ¨¡å‹ã€‚</p><pre><code class=\"language-plain\"># ------Part 1\n# è®¾ç½®OpenAI APIå¯†é’¥\nimport os\nos.environ[\"OPENAI_API_KEY\"] = 'ä½ çš„OpenAI API Key'\n\n# åˆ›å»ºæ¨¡å‹å®ä¾‹\nfrom langchain import OpenAI\nmodel = OpenAI(model_name='gpt-3.5-turbo-instruct')\n</code></pre><h3>ç¬¬äºŒæ­¥ï¼šå®šä¹‰è¾“å‡ºæ•°æ®çš„æ ¼å¼</h3><p>å…ˆåˆ›å»ºäº†ä¸€ä¸ªç©ºçš„DataFrameï¼Œç”¨äºå­˜å‚¨ä»æ¨¡å‹ç”Ÿæˆçš„æè¿°ã€‚æ¥ä¸‹æ¥ï¼Œé€šè¿‡ä¸€ä¸ªåä¸ºFlowerDescriptionçš„Pydantic BaseModelç±»ï¼Œå®šä¹‰äº†æœŸæœ›çš„æ•°æ®æ ¼å¼ï¼ˆä¹Ÿå°±æ˜¯æ•°æ®çš„ç»“æ„ï¼‰ã€‚</p><pre><code class=\"language-plain\"># ------Part 2\n# åˆ›å»ºä¸€ä¸ªç©ºçš„DataFrameç”¨äºå­˜å‚¨ç»“æœ\nimport pandas as pd\ndf = pd.DataFrame(columns=[\"flower_type\", \"price\", \"description\", \"reason\"])\n\n# æ•°æ®å‡†å¤‡\nflowers = [\"ç«ç‘°\", \"ç™¾åˆ\", \"åº·ä¹ƒé¦¨\"]\nprices = [\"50\", \"30\", \"20\"]\n\n# å®šä¹‰æˆ‘ä»¬æƒ³è¦æ¥æ”¶çš„æ•°æ®æ ¼å¼\nfrom pydantic import BaseModel, Field\nclass FlowerDescription(BaseModel):\n&nbsp; &nbsp; flower_type: str = Field(description=\"é²œèŠ±çš„ç§ç±»\")\n&nbsp; &nbsp; price: int = Field(description=\"é²œèŠ±çš„ä»·æ ¼\")\n&nbsp; &nbsp; description: str = Field(description=\"é²œèŠ±çš„æè¿°æ–‡æ¡ˆ\")\n&nbsp; &nbsp; reason: str = Field(description=\"ä¸ºä»€ä¹ˆè¦è¿™æ ·å†™è¿™ä¸ªæ–‡æ¡ˆ\")\n</code></pre><p>åœ¨è¿™é‡Œæˆ‘ä»¬ç”¨åˆ°äº†è´Ÿè´£æ•°æ®æ ¼å¼éªŒè¯çš„Pydanticåº“æ¥åˆ›å»ºå¸¦æœ‰ç±»å‹æ³¨è§£çš„ç±»FlowerDescriptionï¼Œå®ƒå¯ä»¥è‡ªåŠ¨éªŒè¯è¾“å…¥æ•°æ®ï¼Œç¡®ä¿è¾“å…¥æ•°æ®ç¬¦åˆä½ æŒ‡å®šçš„ç±»å‹å’Œå…¶ä»–éªŒè¯æ¡ä»¶ã€‚</p><p>Pydanticæœ‰è¿™æ ·å‡ ä¸ªç‰¹ç‚¹ã€‚</p><ol>\n<li>æ•°æ®éªŒè¯ï¼šå½“ä½ å‘Pydanticç±»èµ‹å€¼æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨è¿›è¡Œæ•°æ®éªŒè¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ åˆ›å»ºäº†ä¸€ä¸ªå­—æ®µéœ€è¦æ˜¯æ•´æ•°ï¼Œä½†è¯•å›¾å‘å®ƒèµ‹äºˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒPydanticä¼šå¼•å‘å¼‚å¸¸ã€‚</li>\n<li>æ•°æ®è½¬æ¢ï¼šPydanticä¸ä»…è¿›è¡Œæ•°æ®éªŒè¯ï¼Œè¿˜å¯ä»¥è¿›è¡Œæ•°æ®è½¬æ¢ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªéœ€è¦æ•´æ•°çš„å­—æ®µï¼Œä½†ä½ æä¾›äº†ä¸€ä¸ªå¯ä»¥è½¬æ¢ä¸ºæ•´æ•°çš„å­—ç¬¦ä¸²ï¼Œå¦‚ <code>\"42\"</code>ï¼ŒPydanticä¼šè‡ªåŠ¨å°†è¿™ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°42ã€‚</li>\n<li>æ˜“äºä½¿ç”¨ï¼šåˆ›å»ºä¸€ä¸ªPydanticç±»å°±åƒå®šä¹‰ä¸€ä¸ªæ™®é€šçš„Pythonç±»ä¸€æ ·ç®€å•ã€‚åªéœ€è¦ä½¿ç”¨Pythonçš„ç±»å‹æ³¨è§£åŠŸèƒ½ï¼Œå³å¯åœ¨ç±»å®šä¹‰ä¸­æŒ‡å®šæ¯ä¸ªå­—æ®µçš„ç±»å‹ã€‚</li>\n<li>JSONæ”¯æŒï¼šPydanticç±»å¯ä»¥å¾ˆå®¹æ˜“åœ°ä»JSONæ•°æ®åˆ›å»ºï¼Œå¹¶å¯ä»¥å°†ç±»çš„æ•°æ®è½¬æ¢ä¸ºJSONæ ¼å¼ã€‚</li>\n</ol><p>ä¸‹é¢ï¼Œæˆ‘ä»¬åŸºäºè¿™ä¸ªPydanticæ•°æ®æ ¼å¼ç±»æ¥åˆ›å»ºLangChainçš„è¾“å‡ºè§£æå™¨ã€‚</p><h3>ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºè¾“å‡ºè§£æå™¨</h3><p>åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºè¾“å‡ºè§£æå™¨å¹¶è·å–è¾“å‡ºæ ¼å¼æŒ‡ç¤ºã€‚å…ˆä½¿ç”¨LangChainåº“ä¸­çš„PydanticOutputParseråˆ›å»ºäº†è¾“å‡ºè§£æå™¨ï¼Œè¯¥è§£æå™¨å°†ç”¨äºè§£ææ¨¡å‹çš„è¾“å‡ºï¼Œä»¥ç¡®ä¿å…¶ç¬¦åˆFlowerDescriptionçš„æ ¼å¼ã€‚ç„¶åï¼Œä½¿ç”¨è§£æå™¨çš„get_format_instructionsæ–¹æ³•è·å–äº†è¾“å‡ºæ ¼å¼çš„æŒ‡ç¤ºã€‚</p><pre><code class=\"language-plain\"># ------Part 3\n# åˆ›å»ºè¾“å‡ºè§£æå™¨\nfrom langchain.output_parsers import PydanticOutputParser\noutput_parser = PydanticOutputParser(pydantic_object=FlowerDescription)\n\n# è·å–è¾“å‡ºæ ¼å¼æŒ‡ç¤º\nformat_instructions = output_parser.get_format_instructions()\n# æ‰“å°æç¤º\nprint(\"è¾“å‡ºæ ¼å¼ï¼š\",format_instructions)\n</code></pre><p>ç¨‹åºè¾“å‡ºå¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">è¾“å‡ºæ ¼å¼ï¼š The output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\": \"Foo\", \"description\": \"a list of strings\", \"type\": \"array\", \"items\": {\"type\": \"string\"}}}, \"required\": [\"foo\"]}}\nthe object {\"foo\": [\"bar\", \"baz\"]} is a well-formatted instance of the schema. The object {\"properties\": {\"foo\": [\"bar\", \"baz\"]}} is not well-formatted.\n\nHere is the output schema:\n\n{\"properties\": {\"flower_type\": {\"title\": \"Flower Type\", \"description\": \"\\u9c9c\\u82b1\\u7684\\u79cd\\u7c7b\", \"type\": \"string\"}, \"price\": {\"title\": \"Price\", \"description\": \"\\u9c9c\\u82b1\\u7684\\u4ef7\\u683c\", \"type\": \"integer\"}, \"description\": {\"title\": \"Description\", \"description\": \"\\u9c9c\\u82b1\\u7684\\u63cf\\u8ff0\\u6587\\u6848\", \"type\": \"string\"}, \"reason\": {\"title\": \"Reason\", \"description\": \"\\u4e3a\\u4ec0\\u4e48\\u8981\\u8fd9\\u6837\\u5199\\u8fd9\\u4e2a\\u6587\\u6848\", \"type\": \"string\"}}, \"required\": [\"flower_type\", \"price\", \"description\", \"reason\"]}\n</code></pre><p>ä¸Šé¢è¿™ä¸ªè¾“å‡ºï¼Œè¿™éƒ¨åˆ†æ˜¯é€šè¿‡output_parser.get_format_instructions()æ–¹æ³•ç”Ÿæˆçš„ï¼Œè¿™æ˜¯Pydantic (JSON) è§£æå™¨çš„æ ¸å¿ƒä»·å€¼ï¼Œå€¼å¾—ä½ å¥½å¥½ç ”ç©¶ç ”ç©¶ã€‚åŒæ—¶å®ƒä¹Ÿç®—å¾—ä¸Šæ˜¯ä¸€ä¸ªå¾ˆæ¸…æ™°çš„æç¤ºæ¨¡æ¿ï¼Œèƒ½å¤Ÿä¸ºæ¨¡å‹æä¾›è‰¯å¥½çš„æŒ‡å¯¼ï¼Œæè¿°äº†æ¨¡å‹è¾“å‡ºåº”è¯¥ç¬¦åˆçš„æ ¼å¼ã€‚ï¼ˆå…¶ä¸­descriptionä¸­çš„ä¸­æ–‡è¢«è½¬æˆäº†UTF-8ç¼–ç ã€‚ï¼‰</p><p>å®ƒæŒ‡ç¤ºæ¨¡å‹è¾“å‡ºJSON Schemaçš„å½¢å¼ï¼Œå®šä¹‰äº†ä¸€ä¸ªæœ‰æ•ˆçš„è¾“å‡ºåº”è¯¥åŒ…å«å“ªäº›å­—æ®µï¼Œä»¥åŠè¿™äº›å­—æ®µçš„æ•°æ®ç±»å‹ã€‚ä¾‹å¦‚ï¼Œå®ƒæŒ‡å®šäº† <code>\"flower_type\"</code> å­—æ®µåº”è¯¥æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œ<code>\"price\"</code> å­—æ®µåº”è¯¥æ˜¯æ•´æ•°ç±»å‹ã€‚è¿™ä¸ªæŒ‡ç¤ºä¸­è¿˜æä¾›äº†ä¸€ä¸ªä¾‹å­ï¼Œè¯´æ˜äº†ä»€ä¹ˆæ˜¯ä¸€ä¸ªæ ¼å¼è‰¯å¥½çš„è¾“å‡ºã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬ä¼šæŠŠè¿™ä¸ªå†…å®¹ä¹Ÿä¼ è¾“åˆ°æ¨¡å‹çš„æç¤ºä¸­ï¼Œ<strong>è®©è¾“å…¥æ¨¡å‹çš„æç¤ºå’Œè¾“å‡ºè§£æå™¨çš„è¦æ±‚ç›¸äº’å»åˆï¼Œå‰åå°±å‘¼åº”å¾—ä¸Š</strong>ã€‚</p><h3>ç¬¬å››æ­¥ï¼šåˆ›å»ºæç¤ºæ¨¡æ¿</h3><p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæç¤ºæ¨¡æ¿ï¼Œè¯¥æ¨¡æ¿å°†ç”¨äºä¸ºæ¨¡å‹ç”Ÿæˆè¾“å…¥æç¤ºã€‚æ¨¡æ¿ä¸­åŒ…å«äº†ä½ éœ€è¦æ¨¡å‹å¡«å……çš„å˜é‡ï¼ˆå¦‚ä»·æ ¼å’ŒèŠ±çš„ç§ç±»ï¼‰ï¼Œä»¥åŠä¹‹å‰è·å–çš„è¾“å‡ºæ ¼å¼æŒ‡ç¤ºã€‚</p><pre><code class=\"language-plain\"># ------Part 4\n# åˆ›å»ºæç¤ºæ¨¡æ¿\nfrom langchain import PromptTemplate\nprompt_template = \"\"\"æ‚¨æ˜¯ä¸€ä½ä¸“ä¸šçš„é²œèŠ±åº—æ–‡æ¡ˆæ’°å†™å‘˜ã€‚\nå¯¹äºå”®ä»·ä¸º {price} å…ƒçš„ {flower} ï¼Œæ‚¨èƒ½æä¾›ä¸€ä¸ªå¸å¼•äººçš„ç®€çŸ­ä¸­æ–‡æè¿°å—ï¼Ÿ\n{format_instructions}\"\"\"\n\n# æ ¹æ®æ¨¡æ¿åˆ›å»ºæç¤ºï¼ŒåŒæ—¶åœ¨æç¤ºä¸­åŠ å…¥è¾“å‡ºè§£æå™¨çš„è¯´æ˜\nprompt = PromptTemplate.from_template(prompt_template, \n&nbsp; &nbsp; &nbsp;  partial_variables={\"format_instructions\": format_instructions}) \n\n# æ‰“å°æç¤º\nprint(\"æç¤ºï¼š\", prompt)\n</code></pre><p>è¾“å‡ºï¼š</p><pre><code class=\"language-plain\">æç¤ºï¼š \ninput_variables=['flower', 'price'] \n\noutput_parser=None \n\npartial_variables={'format_instructions': 'The output should be formatted as a JSON instance that conforms to the JSON schema below.\\n\\n\nAs an example, for the schema {\n\"properties\": {\"foo\": {\"title\": \"Foo\", \"description\": \"a list of strings\", \"type\": \"array\", \"items\": {\"type\": \"string\"}}}, \n\"required\": [\"foo\"]}}\\n\nthe object {\"foo\": [\"bar\", \"baz\"]} is a well-formatted instance of the schema. \nThe object {\"properties\": {\"foo\": [\"bar\", \"baz\"]}} is not well-formatted.\\n\\n\nHere is the output schema:\\n```\\n\n{\"properties\": {\n\"flower_type\": {\"title\": \"Flower Type\", \"description\": \"\\\\u9c9c\\\\u82b1\\\\u7684\\\\u79cd\\\\u7c7b\", \"type\": \"string\"}, \n\"price\": {\"title\": \"Price\", \"description\": \"\\\\u9c9c\\\\u82b1\\\\u7684\\\\u4ef7\\\\u683c\", \"type\": \"integer\"}, \n\"description\": {\"title\": \"Description\", \"description\": \"\\\\u9c9c\\\\u82b1\\\\u7684\\\\u63cf\\\\u8ff0\\\\u6587\\\\u6848\", \"type\": \"string\"}, \n\"reason\": {\"title\": \"Reason\", \"description\": \"\\\\u4e3a\\\\u4ec0\\\\u4e48\\\\u8981\\\\u8fd9\\\\u6837\\\\u5199\\\\u8fd9\\\\u4e2a\\\\u6587\\\\u6848\", \"type\": \"string\"}}, \n\"required\": [\"flower_type\", \"price\", \"description\", \"reason\"]}\\n```'} \n\ntemplate='æ‚¨æ˜¯ä¸€ä½ä¸“ä¸šçš„é²œèŠ±åº—æ–‡æ¡ˆæ’°å†™å‘˜ã€‚\n\\nå¯¹äºå”®ä»·ä¸º {price} å…ƒçš„ {flower} ï¼Œæ‚¨èƒ½æä¾›ä¸€ä¸ªå¸å¼•äººçš„ç®€çŸ­ä¸­æ–‡æè¿°å—ï¼Ÿ\\n\n{format_instructions}' \n\ntemplate_format='f-string' \n\nvalidate_template=True\n</code></pre><p>è¿™å°±æ˜¯åŒ…å«äº†format_instructionsä¿¡æ¯çš„æç¤ºæ¨¡æ¿ã€‚</p><ol>\n<li><code>input_variables=['flower', 'price']</code>ï¼šè¿™æ˜¯ä¸€ä¸ªåŒ…å«ä½ æƒ³è¦åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨çš„è¾“å…¥å˜é‡çš„åˆ—è¡¨ã€‚æˆ‘ä»¬åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨äº† <code>'flower'</code> å’Œ <code>'price'</code> ä¸¤ä¸ªå˜é‡ï¼Œåé¢æˆ‘ä»¬ä¼šç”¨å…·ä½“çš„å€¼ï¼ˆå¦‚ç«ç‘°ã€20å…ƒï¼‰æ¥æ›¿æ¢è¿™ä¸¤ä¸ªå˜é‡ã€‚</li>\n<li><code>output_parser=None</code>ï¼šè¿™æ˜¯ä½ å¯ä»¥é€‰æ‹©åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨çš„ä¸€ä¸ªè¾“å‡ºè§£æå™¨ã€‚åœ¨æ­¤ä¾‹ä¸­ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰é€‰æ‹©åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨è¾“å‡ºè§£æå™¨ï¼Œè€Œæ˜¯åœ¨æ¨¡å‹å¤–éƒ¨è¿›è¡Œè¾“å‡ºè§£æï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯ <code>None</code>ã€‚</li>\n<li><code>partial_variables</code>ï¼šåŒ…å«äº†ä½ æƒ³è¦åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ï¼Œä½†åœ¨ç”Ÿæˆæ¨¡æ¿æ—¶æ— æ³•ç«‹å³æä¾›çš„å˜é‡ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡ <code>'format_instructions'</code> ä¼ å…¥è¾“å‡ºæ ¼å¼çš„è¯¦ç»†è¯´æ˜ã€‚</li>\n<li><code>template</code>ï¼šè¿™æ˜¯æ¨¡æ¿å­—ç¬¦ä¸²æœ¬èº«ã€‚å®ƒåŒ…å«äº†ä½ æƒ³è¦æ¨¡å‹ç”Ÿæˆçš„æ–‡æœ¬çš„ç»“æ„ã€‚åœ¨æ­¤ä¾‹ä¸­ï¼Œæ¨¡æ¿å­—ç¬¦ä¸²æ˜¯ä½ è¯¢é—®é²œèŠ±æè¿°çš„é—®é¢˜ï¼Œä»¥åŠå…³äºè¾“å‡ºæ ¼å¼çš„è¯´æ˜ã€‚</li>\n<li><code>template_format='f-string'</code>ï¼šè¿™æ˜¯ä¸€ä¸ªè¡¨ç¤ºæ¨¡æ¿å­—ç¬¦ä¸²æ ¼å¼çš„é€‰é¡¹ã€‚æ­¤å¤„æ˜¯f-stringæ ¼å¼ã€‚</li>\n<li><code>validate_template=True</code>ï¼šè¡¨ç¤ºæ˜¯å¦åœ¨åˆ›å»ºæ¨¡æ¿æ—¶æ£€æŸ¥æ¨¡æ¿çš„æœ‰æ•ˆæ€§ã€‚è¿™é‡Œé€‰æ‹©äº†åœ¨åˆ›å»ºæ¨¡æ¿æ—¶è¿›è¡Œæ£€æŸ¥ï¼Œä»¥ç¡®ä¿æ¨¡æ¿æ˜¯æœ‰æ•ˆçš„ã€‚</li>\n</ol><p>æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªæç¤ºæ¨¡æ¿æ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆæ¨¡å‹è¾“å…¥çš„å·¥å…·ã€‚ä½ å¯ä»¥åœ¨æ¨¡æ¿ä¸­å®šä¹‰éœ€è¦çš„è¾“å…¥å˜é‡ï¼Œä»¥åŠæ¨¡æ¿å­—ç¬¦ä¸²çš„æ ¼å¼å’Œç»“æ„ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªæ¨¡æ¿æ¥ä¸ºæ¯ç§é²œèŠ±ç”Ÿæˆä¸€ä¸ªæè¿°ã€‚</p><p>åé¢ï¼Œæˆ‘ä»¬è¿˜è¦æŠŠå®é™…çš„ä¿¡æ¯ï¼Œå¾ªç¯ä¼ å…¥æç¤ºæ¨¡æ¿ï¼Œç”Ÿæˆä¸€ä¸ªä¸ªçš„å…·ä½“æç¤ºã€‚ä¸‹é¢è®©æˆ‘ä»¬ç»§ç»­ã€‚</p><h3>ç¬¬äº”æ­¥ï¼šç”Ÿæˆæç¤ºï¼Œä¼ å…¥æ¨¡å‹å¹¶è§£æè¾“å‡º</h3><p>è¿™éƒ¨åˆ†æ˜¯ç¨‹åºçš„ä¸»ä½“ï¼Œæˆ‘ä»¬å¾ªç¯æ¥å¤„ç†æ‰€æœ‰çš„èŠ±å’Œå®ƒä»¬çš„ä»·æ ¼ã€‚å¯¹äºæ¯ç§èŠ±ï¼Œéƒ½æ ¹æ®æç¤ºæ¨¡æ¿åˆ›å»ºäº†è¾“å…¥ï¼Œç„¶åè·å–æ¨¡å‹çš„è¾“å‡ºã€‚ç„¶åä½¿ç”¨ä¹‹å‰åˆ›å»ºçš„è§£æå™¨æ¥è§£æè¿™ä¸ªè¾“å‡ºï¼Œå¹¶å°†è§£æåçš„è¾“å‡ºæ·»åŠ åˆ°DataFrameä¸­ã€‚æœ€åï¼Œä½ æ‰“å°å‡ºäº†æ‰€æœ‰çš„ç»“æœï¼Œå¹¶ä¸”å¯ä»¥é€‰æ‹©å°†å…¶ä¿å­˜åˆ°CSVæ–‡ä»¶ä¸­ã€‚</p><pre><code class=\"language-plain\"># ------Part 5\nfor flower, price in zip(flowers, prices):\n&nbsp; &nbsp; # æ ¹æ®æç¤ºå‡†å¤‡æ¨¡å‹çš„è¾“å…¥\n&nbsp; &nbsp; input = prompt.format(flower=flower, price=price)\n&nbsp; &nbsp; # æ‰“å°æç¤º\n&nbsp; &nbsp; print(\"æç¤ºï¼š\", input)\n\n&nbsp; &nbsp; # è·å–æ¨¡å‹çš„è¾“å‡º\n&nbsp; &nbsp; output = model(input)\n\n&nbsp; &nbsp; # è§£ææ¨¡å‹çš„è¾“å‡º\n&nbsp; &nbsp; parsed_output = output_parser.parse(output)\n&nbsp; &nbsp; parsed_output_dict = parsed_output.dict() &nbsp;# å°†Pydanticæ ¼å¼è½¬æ¢ä¸ºå­—å…¸\n\n&nbsp; &nbsp; # å°†è§£æåçš„è¾“å‡ºæ·»åŠ åˆ°DataFrameä¸­\n&nbsp; &nbsp; df.loc[len(df)] = parsed_output.dict()\n\n# æ‰“å°å­—å…¸\nprint(\"è¾“å‡ºçš„æ•°æ®ï¼š\", df.to_dict(orient='records'))\n</code></pre><p>è¿™ä¸€æ­¥ä¸­ï¼Œä½ ä½¿ç”¨ä½ çš„æ¨¡å‹å’Œè¾“å…¥æç¤ºï¼ˆç”±é²œèŠ±ç§ç±»å’Œä»·æ ¼ç»„æˆï¼‰ç”Ÿæˆäº†ä¸€ä¸ªå…·ä½“é²œèŠ±çš„æ–‡æ¡ˆéœ€æ±‚ï¼ˆåŒæ—¶å¸¦æœ‰æ ¼å¼æè¿°ï¼‰ï¼Œç„¶åä¼ é€’ç»™å¤§æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæç¤ºæ¨¡æ¿ä¸­çš„ flower å’Œ priceï¼Œæ­¤æ—¶éƒ½è¢«å…·ä½“çš„èŠ±å–ä»£äº†ï¼Œè€Œä¸”æ¨¡æ¿ä¸­çš„ {format_instructions}ï¼Œä¹Ÿè¢«æ›¿æ¢æˆäº† JSON Schema ä¸­æŒ‡æ˜çš„æ ¼å¼ä¿¡æ¯ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œè¾“å‡ºçš„ä¸€ä¸ªæç¤ºæ˜¯è¿™æ ·çš„ï¼š</p><blockquote>\n<p><strong>æç¤º</strong>ï¼š æ‚¨æ˜¯ä¸€ä½ä¸“ä¸šçš„é²œèŠ±åº—æ–‡æ¡ˆæ’°å†™å‘˜ã€‚<br>\nå¯¹äºå”®ä»·ä¸º 20 å…ƒçš„ åº·ä¹ƒé¦¨ ï¼Œæ‚¨èƒ½æä¾›ä¸€ä¸ªå¸å¼•äººçš„ç®€çŸ­ä¸­æ–‡æè¿°å—ï¼Ÿ<br>\n&nbsp;<br>\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.<br>\n&nbsp;<br>\nAs an example, for the schema {â€œpropertiesâ€: {â€œfooâ€: {â€œtitleâ€: â€œFooâ€, â€œdescriptionâ€: â€œa list of stringsâ€, â€œtypeâ€: â€œarrayâ€, â€œitemsâ€: {â€œtypeâ€: â€œstringâ€}}}, â€œrequiredâ€: [â€œfooâ€]}}<br>\nthe object {â€œfooâ€: [â€œbarâ€, â€œbazâ€]} is a well-formatted instance of the schema. The object {â€œpropertiesâ€: {â€œfooâ€: [â€œbarâ€, â€œbazâ€]}} is not well-formatted.<br>\n&nbsp;<br>\nHere is the output schema:</p>\n<pre><code>{&quot;properties&quot;: {&quot;flower_type&quot;: {&quot;title&quot;: &quot;Flower Type&quot;, &quot;description&quot;: &quot;\\u9c9c\\u82b1\\u7684\\u79cd\\u7c7b&quot;, &quot;type&quot;: &quot;string&quot;}, &quot;price&quot;: {&quot;title&quot;: &quot;Price&quot;, &quot;description&quot;: &quot;\\u9c9c\\u82b1\\u7684\\u4ef7\\u683c&quot;, &quot;type&quot;: &quot;integer&quot;}, &quot;description&quot;: {&quot;title&quot;: &quot;Description&quot;, &quot;description&quot;: &quot;\\u9c9c\\u82b1\\u7684\\u63cf\\u8ff0\\u6587\\u6848&quot;, &quot;type&quot;: &quot;string&quot;}, &quot;reason&quot;: {&quot;title&quot;: &quot;Reason&quot;, &quot;description&quot;: &quot;\\u4e3a\\u4ec0\\u4e48\\u8981\\u8fd9\\u6837\\u5199\\u8fd9\\u4e2a\\u6587\\u6848&quot;, &quot;type&quot;: &quot;string&quot;}}, &quot;required&quot;: [&quot;flower_type&quot;, &quot;price&quot;, &quot;description&quot;, &quot;reason&quot;]}\n</code></pre>\n</blockquote><p>ä¸‹é¢ï¼Œç¨‹åºè§£ææ¨¡å‹çš„è¾“å‡ºã€‚åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œä½ ä½¿ç”¨ä½ ä¹‹å‰å®šä¹‰çš„è¾“å‡ºè§£æå™¨ï¼ˆoutput_parserï¼‰å°†æ¨¡å‹çš„è¾“å‡ºè§£ææˆäº†ä¸€ä¸ªFlowerDescriptionçš„å®ä¾‹ã€‚FlowerDescriptionæ˜¯ä½ ä¹‹å‰å®šä¹‰çš„ä¸€ä¸ªPydanticç±»ï¼Œå®ƒåŒ…å«äº†é²œèŠ±çš„ç±»å‹ã€ä»·æ ¼ã€æè¿°ä»¥åŠæè¿°çš„ç†ç”±ã€‚</p><p>ç„¶åï¼Œå°†è§£æåçš„è¾“å‡ºæ·»åŠ åˆ°DataFrameä¸­ã€‚åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œä½ å°†è§£æåçš„è¾“å‡ºï¼ˆå³FlowerDescriptionå®ä¾‹ï¼‰è½¬æ¢ä¸ºä¸€ä¸ªå­—å…¸ï¼Œå¹¶å°†è¿™ä¸ªå­—å…¸æ·»åŠ åˆ°ä½ çš„DataFrameä¸­ã€‚è¿™ä¸ªDataFrameæ˜¯ä½ ç”¨æ¥å­˜å‚¨æ‰€æœ‰é²œèŠ±æè¿°çš„ã€‚</p><p>æ¨¡å‹çš„æœ€åè¾“å‡ºå¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">è¾“å‡ºçš„æ•°æ®ï¼š \n[{'flower_type': 'Rose', 'price': 50, 'description': 'ç«ç‘°æ˜¯æœ€æµªæ¼«çš„èŠ±ï¼Œå®ƒå…·æœ‰æŸ”å’Œçš„ç²‰çº¢è‰²ï¼Œæœ‰ç€æµ“æµ“çš„çˆ±æ„ï¼Œä»·æ ¼å®æƒ ï¼Œ50å…ƒå°±å¯ä»¥æ‹¥æœ‰ä¸€æŸç«ç‘°ã€‚', 'reason': 'ç«ç‘°ä»£è¡¨ç€çˆ±æƒ…ï¼Œæ˜¯æœ€æµªæ¼«çš„ç¤¼ç‰©ï¼Œä»¥å®æƒ çš„ä»·æ ¼ï¼Œå¯ä»¥è®©æ‚¨å°½æƒ…ä½“éªŒçˆ±çš„æµªæ¼«ã€‚'}, \n{'flower_type': 'ç™¾åˆ', 'price': 30, 'description': 'è¿™æ”¯ç™¾åˆï¼ŒæŸ”ç¾çš„èŠ±è•¾ï¼Œåœ¨ä½ çš„æ‰‹ä¸­æ‘‡æ›³ï¼Œä»¿ä½›åœ¨ä¸ä½ æ·±æƒ…çš„äº¤è°ˆ', 'reason': 'è¥é€ æµªæ¼«æ°›å›´'}, \n{'flower_type': 'Carnation', 'price': 20, 'description': 'è‰³ä¸½ç¼¤çº·çš„åº·ä¹ƒé¦¨ï¼Œå¸¦ç»™ä½ æ¸©é¦¨ã€æµªæ¼«çš„æ°”æ°›ï¼Œæ˜¯æœ€ä½³çš„ç¤¼ç‰©é€‰æ‹©ï¼', 'reason': 'åº·ä¹ƒé¦¨æ˜¯ä¸€ç§é¢œè‰²é²œè‰³ã€èŠ¬èŠ³æ·¡é›…ã€å…·æœ‰æµªæ¼«å¯“æ„çš„é²œèŠ±ï¼Œéå¸¸é€‚åˆä½œä¸ºç¤¼ç‰©ï¼Œè€Œä¸”20å…ƒçš„ä»·æ ¼æ¯”è¾ƒå®æƒ ã€‚'}]\n</code></pre><p>å› æ­¤ï¼ŒPydanticçš„ä¼˜ç‚¹å°±æ˜¯å®¹æ˜“è§£æï¼Œè€Œè§£æä¹‹åçš„å­—å…¸æ ¼å¼çš„åˆ—è¡¨åœ¨è¿›è¡Œæ•°æ®åˆ†æã€å¤„ç†å’Œå­˜å‚¨æ—¶éå¸¸æ–¹ä¾¿ã€‚æ¯ä¸ªå­—å…¸ä»£è¡¨ä¸€æ¡è®°å½•ï¼Œå®ƒçš„é”®ï¼ˆ å³ <code>\"flower_type\"</code>ã€<code>\"price\"</code>ã€<code>\"description\"</code> å’Œ <code>\"reason\"</code>ï¼‰æ˜¯å­—æ®µåç§°ï¼Œå¯¹åº”çš„å€¼æ˜¯è¿™ä¸ªå­—æ®µçš„å†…å®¹ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ¯ä¸ªå­—æ®µéƒ½å¯¹åº”ä¸€åˆ—ï¼Œæ¯ä¸ªå­—å…¸å°±æ˜¯ä¸€è¡Œï¼Œé€‚åˆä»¥DataFrameçš„å½¢å¼æ¥è¡¨ç¤ºå’Œå¤„ç†ã€‚</p><h2>è‡ªåŠ¨ä¿®å¤è§£æå™¨ï¼ˆOutputFixingParserï¼‰å®æˆ˜</h2><p>ä¸‹é¢å’±ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨è‡ªåŠ¨ä¿®å¤è§£æå™¨ã€‚</p><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥è®¾è®¡ä¸€ä¸ªè§£ææ—¶å‡ºç°çš„é”™è¯¯ã€‚</p><pre><code class=\"language-plain\"># å¯¼å…¥æ‰€éœ€è¦çš„åº“å’Œæ¨¡å—\nfrom langchain.output_parsers import PydanticOutputParser\nfrom pydantic import BaseModel, Field\nfrom typing import List\n\n# ä½¿ç”¨Pydanticåˆ›å»ºä¸€ä¸ªæ•°æ®æ ¼å¼ï¼Œè¡¨ç¤ºèŠ±\nclass Flower(BaseModel):\n&nbsp; &nbsp; name: str = Field(description=\"name of a flower\")\n&nbsp; &nbsp; colors: List[str] = Field(description=\"the colors of this flower\")\n# å®šä¹‰ä¸€ä¸ªç”¨äºè·å–æŸç§èŠ±çš„é¢œè‰²åˆ—è¡¨çš„æŸ¥è¯¢\nflower_query = \"Generate the charaters for a random flower.\"\n\n# å®šä¹‰ä¸€ä¸ªæ ¼å¼ä¸æ­£ç¡®çš„è¾“å‡º\nmisformatted = \"{'name': 'åº·ä¹ƒé¦¨', 'colors': ['ç²‰çº¢è‰²','ç™½è‰²','çº¢è‰²','ç´«è‰²','é»„è‰²']}\"\n\n# åˆ›å»ºä¸€ä¸ªç”¨äºè§£æè¾“å‡ºçš„Pydanticè§£æå™¨ï¼Œæ­¤å¤„å¸Œæœ›è§£æä¸ºFloweræ ¼å¼\nparser = PydanticOutputParser(pydantic_object=Flower)\n# ä½¿ç”¨Pydanticè§£æå™¨è§£æä¸æ­£ç¡®çš„è¾“å‡º\nparser.parse(misformatted)\n</code></pre><p>è¿™æ®µä»£ç å¦‚æœè¿è¡Œï¼Œä¼šå‡ºç°é”™è¯¯ã€‚</p><pre><code class=\"language-plain\">langchain.schema.output_parser.OutputParserException: Failed to parse Flower from completion {'name': 'åº·ä¹ƒé¦¨', 'colors': ['ç²‰çº¢è‰²','ç™½è‰²']}. Got: Expecting property name enclosed in double quotes: line 1 column 2 (char 1)\n</code></pre><p>è¿™ä¸ªé”™è¯¯æ¶ˆæ¯æ¥è‡ªPythonçš„å†…å»ºJSONè§£æå™¨å‘ç°æˆ‘ä»¬è¾“å…¥çš„JSONæ ¼å¼ä¸æ­£ç¡®ã€‚ç¨‹åºå°è¯•ç”¨PydanticOutputParseræ¥è§£æJSONå­—ç¬¦ä¸²æ—¶ï¼ŒPythonæœŸæœ›å±æ€§åç§°è¢«åŒå¼•å·åŒ…å›´ï¼Œä½†åœ¨ç»™å®šçš„JSONå­—ç¬¦ä¸²ä¸­æ˜¯å•å¼•å·ã€‚</p><p>å½“è¿™ä¸ªé”™è¯¯è¢«è§¦å‘åï¼Œç¨‹åºè¿›ä¸€æ­¥å¼•å‘äº†ä¸€ä¸ªè‡ªå®šä¹‰å¼‚å¸¸ï¼šOutputParserExceptionï¼Œå®ƒæä¾›äº†æ›´å¤šå…³äºé”™è¯¯çš„ä¸Šä¸‹æ–‡ã€‚è¿™ä¸ªè‡ªå®šä¹‰å¼‚å¸¸çš„æ¶ˆæ¯è¡¨ç¤ºåœ¨å°è¯•è§£æflowerå¯¹è±¡æ—¶é‡åˆ°äº†é—®é¢˜ã€‚</p><p>åˆšæ‰è¯´äº†ï¼Œé—®é¢˜åœ¨äºmisformattedå­—ç¬¦ä¸²çš„å†…å®¹ï¼š</p><p><code>\"{'name': 'åº·ä¹ƒé¦¨', 'colors': ['ç²‰çº¢è‰²','ç™½è‰²','çº¢è‰²','ç´«è‰²','é»„è‰²']}\"</code></p><p>åº”è¯¥æ”¹ä¸ºï¼š</p><p><code>'{\"name\": \"åº·ä¹ƒé¦¨\", \"colors\": [\"ç²‰çº¢è‰²\",\"ç™½è‰²\",\"çº¢è‰²\",\"ç´«è‰²\",\"é»„è‰²\"]}'</code></p><p>è¿™æ ·ï¼Œä½ çš„JSONå­—ç¬¦ä¸²å°±ä¼šä½¿ç”¨æ­£ç¡®çš„åŒå¼•å·æ ¼å¼ï¼Œåº”è¯¥å¯ä»¥è¢«æ­£ç¡®åœ°è§£æã€‚</p><p>ä¸è¿‡ï¼Œè¿™é‡Œæˆ‘å¹¶ä¸æƒ³è¿™æ ·è§£å†³é—®é¢˜ï¼Œè€Œæ˜¯å°è¯•ä½¿ç”¨OutputFixingParseræ¥å¸®åŠ©å’±ä»¬è‡ªåŠ¨è§£å†³ç±»ä¼¼çš„æ ¼å¼é”™è¯¯ã€‚</p><pre><code class=\"language-plain\"># ä»langchainåº“å¯¼å…¥æ‰€éœ€çš„æ¨¡å—\nfrom langchain.chat_models import ChatOpenAI\nfrom langchain.output_parsers import OutputFixingParser\n\n# è®¾ç½®OpenAI APIå¯†é’¥\nimport os\nos.environ[\"OPENAI_API_KEY\"] = 'ä½ çš„OpenAI API Key'\n\n# ä½¿ç”¨OutputFixingParseråˆ›å»ºä¸€ä¸ªæ–°çš„è§£æå™¨ï¼Œè¯¥è§£æå™¨èƒ½å¤Ÿçº æ­£æ ¼å¼ä¸æ­£ç¡®çš„è¾“å‡º\nnew_parser = OutputFixingParser.from_llm(parser=parser, llm=ChatOpenAI())\n\n# ä½¿ç”¨æ–°çš„è§£æå™¨è§£æä¸æ­£ç¡®çš„è¾“å‡º\nresult = new_parser.parse(misformatted) # é”™è¯¯è¢«è‡ªåŠ¨ä¿®æ­£\nprint(result) # æ‰“å°è§£æåçš„è¾“å‡ºç»“æœ\n</code></pre><p>ç”¨ä¸Šé¢çš„æ–°çš„new_parseræ¥ä»£æ›¿Parserè¿›è¡Œè§£æï¼Œä½ ä¼šå‘ç°ï¼ŒJSONæ ¼å¼çš„é”™è¯¯é—®é¢˜è¢«è§£å†³äº†ï¼Œç¨‹åºä¸å†å‡ºé”™ã€‚</p><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">name='Rose' colors=['red', 'pink', 'white']\n</code></pre><p>è¿™é‡Œçš„ç§˜å¯†åœ¨äºï¼Œåœ¨OutputFixingParserå†…éƒ¨ï¼Œè°ƒç”¨äº†åŸæœ‰çš„PydanticOutputParserï¼Œå¦‚æœæˆåŠŸï¼Œå°±è¿”å›ï¼›å¦‚æœå¤±è´¥ï¼Œå®ƒä¼šå°†æ ¼å¼é”™è¯¯çš„è¾“å‡ºä»¥åŠæ ¼å¼åŒ–çš„æŒ‡ä»¤ä¼ é€’ç»™å¤§æ¨¡å‹ï¼Œå¹¶è¦æ±‚LLMè¿›è¡Œç›¸å…³çš„ä¿®å¤ã€‚</p><p>ç¥å¥‡å§ï¼Œå¤§æ¨¡å‹ä¸ä»…ç»™æˆ‘ä»¬æä¾›çŸ¥è¯†ï¼Œè¿˜éšæ—¶å¸®åŠ©åˆ†æå¹¶è§£å†³ç¨‹åºå‡ºé”™çš„ä¿¡æ¯ã€‚</p><h2>é‡è¯•è§£æå™¨ï¼ˆRetryWithErrorOutputParserï¼‰å®æˆ˜</h2><p>OutputFixingParserä¸é”™ï¼Œä½†å®ƒåªèƒ½åšç®€å•çš„æ ¼å¼ä¿®å¤ã€‚å¦‚æœå‡ºé”™çš„ä¸åªæ˜¯æ ¼å¼ï¼Œæ¯”å¦‚ï¼Œè¾“å‡ºæ ¹æœ¬ä¸å®Œæ•´ï¼Œæœ‰ç¼ºå¤±å†…å®¹ï¼Œé‚£ä¹ˆä»…ä»…æ ¹æ®è¾“å‡ºå’Œæ ¼å¼æœ¬èº«ï¼Œæ˜¯æ— æ³•ä¿®å¤å®ƒçš„ã€‚</p><p>æ­¤æ—¶ï¼Œé€šè¿‡å®ç°è¾“å‡ºè§£æå™¨ä¸­parse_with_promptæ–¹æ³•ï¼ŒLangChainæä¾›çš„é‡è¯•è§£æå™¨å¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ©ç”¨å¤§æ¨¡å‹çš„æ¨ç†èƒ½åŠ›æ ¹æ®åŸå§‹æç¤ºæ‰¾å›ç›¸å…³ä¿¡æ¯ã€‚</p><p>æˆ‘ä»¬é€šè¿‡åˆ†æä¸€ä¸ªé‡è¯•è§£æå™¨çš„ç”¨ä¾‹æ¥ç†è§£ä¸Šé¢çš„è¿™æ®µè¯ã€‚</p><p>é¦–å…ˆè¿˜æ˜¯è®¾è®¡ä¸€ä¸ªè§£æè¿‡ç¨‹ä¸­çš„é”™è¯¯ã€‚</p><pre><code class=\"language-plain\"># å®šä¹‰ä¸€ä¸ªæ¨¡æ¿å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªæ¨¡æ¿å°†ç”¨äºç”Ÿæˆæé—®\ntemplate = \"\"\"Based on the user question, provide an Action and Action Input for what step should be taken.\n{format_instructions}\nQuestion: {query}\nResponse:\"\"\"\n\n# å®šä¹‰ä¸€ä¸ªPydanticæ•°æ®æ ¼å¼ï¼Œå®ƒæè¿°äº†ä¸€ä¸ª\"è¡ŒåŠ¨\"ç±»åŠå…¶å±æ€§\nfrom pydantic import BaseModel, Field\nclass Action(BaseModel):\n&nbsp; &nbsp; action: str = Field(description=\"action to take\")\n&nbsp; &nbsp; action_input: str = Field(description=\"input to the action\")\n\n# ä½¿ç”¨Pydanticæ ¼å¼Actionæ¥åˆå§‹åŒ–ä¸€ä¸ªè¾“å‡ºè§£æå™¨\nfrom langchain.output_parsers import PydanticOutputParser\nparser = PydanticOutputParser(pydantic_object=Action)\n\n# å®šä¹‰ä¸€ä¸ªæç¤ºæ¨¡æ¿ï¼Œå®ƒå°†ç”¨äºå‘æ¨¡å‹æé—®\nfrom langchain.prompts import PromptTemplate\nprompt = PromptTemplate(\n&nbsp; &nbsp; template=\"Answer the user query.\\n{format_instructions}\\n{query}\\n\",\n&nbsp; &nbsp; input_variables=[\"query\"],\n&nbsp; &nbsp; partial_variables={\"format_instructions\": parser.get_format_instructions()},\n)\nprompt_value = prompt.format_prompt(query=\"What are the colors of Orchid?\")\n\n# å®šä¹‰ä¸€ä¸ªé”™è¯¯æ ¼å¼çš„å­—ç¬¦ä¸²\nbad_response = '{\"action\": \"search\"}'\nparser.parse(bad_response) # å¦‚æœç›´æ¥è§£æï¼Œå®ƒä¼šå¼•å‘ä¸€ä¸ªé”™è¯¯\n</code></pre><p>ç”±äºbad_responseåªæä¾›äº†actionå­—æ®µï¼Œè€Œæ²¡æœ‰æä¾›action_inputå­—æ®µï¼Œè¿™ä¸Actionæ•°æ®æ ¼å¼çš„é¢„æœŸä¸ç¬¦ï¼Œæ‰€ä»¥è§£æä¼šå¤±è´¥ã€‚</p><p>æˆ‘ä»¬é¦–å…ˆå°è¯•ç”¨OutputFixingParseræ¥è§£å†³è¿™ä¸ªé”™è¯¯ã€‚</p><pre><code class=\"language-plain\">from langchain.output_parsers import OutputFixingParser\nfrom langchain.chat_models import ChatOpenAI\nfix_parser = OutputFixingParser.from_llm(parser=parser, llm=ChatOpenAI())\nparse_result = fix_parser.parse(bad_response)\nprint('OutputFixingParserçš„parseç»“æœ:',parse_result)\n</code></pre><p>OutputFixingParserçš„parseç»“æœï¼š<code>action='search' action_input='query'</code></p><p>æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªå°è¯•è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Œæ²¡è§£å†³ä»€ä¹ˆé—®é¢˜ã€‚</p><p><strong>è§£å†³çš„é—®é¢˜æœ‰ï¼š</strong></p><ul>\n<li>ä¸å®Œæ•´çš„æ•°æ®ï¼šåŸå§‹çš„bad_responseåªæä¾›äº†actionå­—æ®µè€Œæ²¡æœ‰action_inputå­—æ®µã€‚OutputFixingParserå·²ç»å¡«è¡¥äº†è¿™ä¸ªç¼ºå¤±ï¼Œä¸ºaction_inputå­—æ®µæä¾›äº†å€¼ <code>'query'</code>ã€‚</li>\n</ul><p><strong>æ²¡è§£å†³çš„é—®é¢˜æœ‰ï¼š</strong></p><ul>\n<li>å…·ä½“æ€§ï¼šå°½ç®¡OutputFixingParserä¸ºaction_inputå­—æ®µæä¾›äº†é»˜è®¤å€¼ <code>'query'</code>ï¼Œä½†è¿™å¹¶ä¸å…·æœ‰æè¿°æ€§ã€‚çœŸæ­£çš„æŸ¥è¯¢æ˜¯ â€œOrchidï¼ˆå…°èŠ±ï¼‰çš„é¢œè‰²æ˜¯ä»€ä¹ˆï¼Ÿâ€ã€‚æ‰€ä»¥ï¼Œè¿™ä¸ªä¿®å¤åªæ˜¯æä¾›äº†ä¸€ä¸ªé€šç”¨çš„å€¼ï¼Œå¹¶æ²¡æœ‰çœŸæ­£åœ°å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚</li>\n<li>å¯èƒ½çš„è¯¯å¯¼ï¼š<code>'query'</code> å¯èƒ½è¢«è¯¯è§£ä¸ºä¸€ä¸ªæŒ‡ç¤ºï¼Œè¦æ±‚è¿›ä¸€æ­¥æŸ¥è¯¢æŸäº›å†…å®¹ï¼Œè€Œä¸æ˜¯ä½œä¸ºå®é™…çš„æŸ¥è¯¢è¾“å…¥ã€‚</li>\n</ul><p>å½“ç„¶ï¼Œè¿˜æœ‰æ›´é²æ£’çš„é€‰æ‹©ï¼Œæˆ‘ä»¬æœ€åå°è¯•ä¸€ä¸‹RetryWithErrorOutputParserè¿™ä¸ªè§£æå™¨ã€‚</p><pre><code class=\"language-plain\"># åˆå§‹åŒ–RetryWithErrorOutputParserï¼Œå®ƒä¼šå°è¯•å†æ¬¡æé—®æ¥å¾—åˆ°ä¸€ä¸ªæ­£ç¡®çš„è¾“å‡º\nfrom langchain.output_parsers import RetryWithErrorOutputParser\nfrom langchain.llms import OpenAI\nretry_parser = RetryWithErrorOutputParser.from_llm(\n&nbsp; &nbsp; parser=parser, llm=OpenAI(temperature=0)\n)\nparse_result = retry_parser.parse_with_prompt(bad_response, prompt_value)\nprint('RetryWithErrorOutputParserçš„parseç»“æœ:',parse_result)\n</code></pre><p>è¿™ä¸ªè§£æå™¨æ²¡æœ‰è®©æˆ‘ä»¬å¤±æœ›ï¼ŒæˆåŠŸåœ°è¿˜åŸäº†æ ¼å¼ï¼Œç”šè‡³ä¹Ÿæ ¹æ®ä¼ å…¥çš„åŸå§‹æç¤ºï¼Œè¿˜åŸäº†action_inputå­—æ®µçš„å†…å®¹ã€‚</p><p>RetryWithErrorOutputParserçš„parseç»“æœï¼š<code>action='search' action_input='colors of Orchid'</code></p><h2>æ€»ç»“æ—¶åˆ»</h2><p>ç»“æ„åŒ–è§£æå™¨å’ŒPydanticè§£æå™¨éƒ½æ—¨åœ¨ä»å¤§å‹è¯­è¨€æ¨¡å‹ä¸­è·å–æ ¼å¼åŒ–çš„è¾“å‡ºã€‚ç»“æ„åŒ–è§£æå™¨æ›´é€‚åˆç®€å•çš„æ–‡æœ¬å“åº”ï¼Œè€ŒPydanticè§£æå™¨åˆ™æä¾›äº†å¯¹å¤æ‚æ•°æ®ç»“æ„å’Œç±»å‹çš„æ”¯æŒã€‚é€‰æ‹©å“ªç§è§£æå™¨å–å†³äºåº”ç”¨çš„å…·ä½“éœ€æ±‚å’Œè¾“å‡ºçš„å¤æ‚æ€§ã€‚</p><p>è‡ªåŠ¨ä¿®å¤è§£æå™¨ä¸»è¦é€‚ç”¨äºçº æ­£å°çš„æ ¼å¼é”™è¯¯ï¼Œå®ƒæ›´åŠ â€œè¢«åŠ¨â€ï¼Œä»…åœ¨åŸå§‹è¾“å‡ºå‡ºç°é—®é¢˜æ—¶è¿›è¡Œä¿®å¤ã€‚é‡è¯•è§£æå™¨åˆ™å¯ä»¥å¤„ç†æ›´å¤æ‚çš„é—®é¢˜ï¼ŒåŒ…æ‹¬æ ¼å¼é”™è¯¯å’Œå†…å®¹ç¼ºå¤±ã€‚å®ƒé€šè¿‡é‡æ–°ä¸æ¨¡å‹äº¤äº’ï¼Œä½¿å¾—è¾“å‡ºæ›´åŠ å®Œæ•´å’Œç¬¦åˆé¢„æœŸã€‚</p><p>åœ¨é€‰æ‹©å“ªç§è§£æå™¨æ—¶ï¼Œéœ€è¦è€ƒè™‘å…·ä½“çš„åº”ç”¨åœºæ™¯ã€‚å¦‚æœä»…é¢ä¸´æ ¼å¼é—®é¢˜ï¼Œè‡ªåŠ¨ä¿®å¤è§£æå™¨å¯èƒ½è¶³å¤Ÿï¼›ä½†å¦‚æœè¾“å‡ºçš„å®Œæ•´æ€§å’Œå‡†ç¡®æ€§è‡³å…³é‡è¦ï¼Œé‚£ä¹ˆé‡è¯•è§£æå™¨å¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p><h2>æ€è€ƒé¢˜</h2><ol>\n<li>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨äº†å“ªäº›LangChainè¾“å‡ºè§£æå™¨ï¼Ÿè¯·ä½ è¯´ä¸€è¯´å®ƒä»¬çš„ç”¨æ³•å’Œå¼‚åŒã€‚åŒæ—¶ä¹Ÿè¯·ä½ å°è¯•ä½¿ç”¨å…¶ä»–ç±»å‹çš„è¾“å‡ºè§£æå™¨ï¼Œå¹¶æŠŠä»£ç ä¸å¤§å®¶åˆ†äº«ã€‚</li>\n<li>ä¸ºä»€ä¹ˆå¤§æ¨¡å‹èƒ½å¤Ÿè¿”å›JSONæ ¼å¼çš„æ•°æ®ï¼Œè¾“å‡ºè§£æå™¨ç”¨äº†ä»€ä¹ˆé­”æ³•è®©å¤§æ¨¡å‹åšåˆ°äº†è¿™ä¸€ç‚¹ï¼Ÿ</li>\n<li>è‡ªåŠ¨ä¿®å¤è§£æå™¨çš„â€œä¿®å¤â€åŠŸèƒ½å…·ä½“æ¥è¯´æ˜¯æ€æ ·å®ç°çš„ï¼Ÿè¯·åšdebugï¼Œç ”ç©¶ä¸€ä¸‹LangChainåœ¨è°ƒç”¨å¤§æ¨¡å‹ä¹‹å‰å¦‚ä½•è®¾è®¡â€œæç¤ºâ€ã€‚</li>\n<li>é‡è¯•è§£æå™¨çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿå®ƒä¸»è¦å®ç°äº†è§£æå™¨ç±»çš„å“ªä¸ªå¯é€‰æ–¹æ³•ï¼Ÿ</li>\n</ol><p>é¢˜ç›®è¾ƒå¤šï¼Œå¯ä»¥é€‰æ‹©æ€§æ€è€ƒï¼ŒæœŸå¾…åœ¨ç•™è¨€åŒºçœ‹åˆ°ä½ çš„åˆ†äº«ã€‚å¦‚æœä½ è§‰å¾—å†…å®¹å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä¹Ÿæ¬¢è¿åˆ†äº«ç»™æœ‰éœ€è¦çš„æœ‹å‹ï¼æœ€åå¦‚æœä½ å­¦æœ‰ä½™åŠ›ï¼Œå¯ä»¥è¿›ä¸€æ­¥å­¦ä¹ ä¸‹é¢çš„å»¶ä¼¸é˜…è¯»ã€‚</p><h2>å»¶ä¼¸é˜…è¯»</h2><ol>\n<li>å·¥å…·ï¼š<a href=\"https://docs.pydantic.dev/latest/\">Pydantic</a> æ˜¯ä¸€ä¸ªPythonåº“ï¼Œç”¨äºæ•°æ®éªŒè¯ï¼Œå¯ä»¥ç¡®ä¿æ•°æ®ç¬¦åˆç‰¹å®šçš„æ ¼å¼</li>\n<li>æ–‡æ¡£ï¼šLangChainä¸­çš„å„ç§ <a href=\"https://python.langchain.com/docs/modules/model_io/output_parsers/\">Output Parsers</a></li>\n</ol>","neighbors":{"left":{"article_title":"06ï½œè°ƒç”¨æ¨¡å‹ï¼šä½¿ç”¨OpenAI APIè¿˜æ˜¯å¾®è°ƒå¼€æºLlama2/ChatGLMï¼Ÿ","id":702140},"right":{"article_title":"08ï½œé“¾ï¼ˆä¸Šï¼‰ï¼šå†™ä¸€ç¯‡å®Œç¾é²œèŠ±æ¨æ–‡ï¼Ÿç”¨SequencialChainé“¾æ¥ä¸åŒçš„ç»„ä»¶","id":703296}},"comments":[{"had_liked":false,"id":381431,"user_name":"åœ¨è·¯ä¸Š","can_delete":false,"product_type":"c1","uid":1402511,"ip_address":"å¹¿ä¸œ","ucode":"6E31908EFE1107","user_header":"https://static001.geekbang.org/account/avatar/00/15/66/8f/02be926d.jpg","comment_is_top":false,"comment_ctime":1695199544,"is_pvip":false,"replies":[{"id":138946,"content":"æ€»ç»“çš„æ¸…æ™°é€å½» ğŸ§‘â€ğŸ“","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1809833,"ctime":1695226179,"ip_address":"æ–°åŠ å¡","comment_id":381431,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100617601,"comment_content":"ä»æºç ä¸Šçœ‹ï¼ŒOutputFixingParserå’ŒRetryWithErrorOutputParserçš„æœ¬è´¨æ˜¯ç›¸åŒçš„ï¼Œéƒ½æ˜¯å½“PydanticOutputParser.parse(input)è§£æå¤±è´¥ï¼Œé€šè¿‡è¯­è¨€æ¨¡å‹åˆ†ææŠ›å‡ºçš„å¼‚å¸¸ï¼Œä¿®æ­£inputã€‚\nä¸åŒä¹‹å¤„åœ¨äºï¼ŒOutputFixingParseråˆ©ç”¨input schemaã€inputã€exceptionæ¥ä¿®æ­£inputï¼ŒRetryWithErrorOutputParseré™¤äº†åˆ©ç”¨input schemaã€inputã€exceptionï¼Œè¿˜åˆ©ç”¨ä¸€ä¸ªé¢å¤–çš„promptæ¥ä¿®æ­£inputï¼Œæœ‰äº†é¢å¤–çš„promptï¼Œè‡ªç„¶å°±èƒ½å¤Ÿæ—¢ä¿®æ­£inputæ ¼å¼ï¼Œåˆè¡¥å…¨inputå†…å®¹ã€‚","like_count":22,"discussions":[{"author":{"id":1809833,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/a9/4602808f.jpg","nickname":"é»„ä½³","note":"","ucode":"8EC41D2EAB0E3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":628363,"discussion_content":"æ€»ç»“çš„æ¸…æ™°é€å½» ğŸ§‘â€ğŸ“","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1695226179,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ–°åŠ å¡","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383296,"user_name":"é«˜æº","can_delete":false,"product_type":"c1","uid":1048887,"ip_address":"å‰æ—","ucode":"751B41FD38EF7D","user_header":"https://static001.geekbang.org/account/avatar/00/10/01/37/12e4c9c9.jpg","comment_is_top":false,"comment_ctime":1698826070,"is_pvip":false,"replies":[{"id":139678,"content":"ä½ çš„é—®é¢˜æ¶‰åŠåˆ°å¤§å‹é¢„è®­ç»ƒæ¨¡å‹åœ¨ä¼ä¸šåº”ç”¨ä¸­çš„å¾®è°ƒã€æ€§èƒ½æ¯”è¾ƒä»¥åŠä¼ä¸šè½åœ°å®ç°çš„å¯è¡Œæ€§å’Œæ¡ä»¶ã€‚æˆ‘ç»™å‡ºæ¯”è¾ƒå®˜æ–¹çš„å›ç­”ã€‚\nå¾®è°ƒå¤§æ¨¡å‹\nå¯¹äºä¼ä¸šæ¥è¯´ï¼Œç¡®å®ï¼Œå°†ä¸€ä¸ªé€šç”¨çš„å¤§å‹è¯­è¨€æ¨¡å‹ç›´æ¥ç”¨äºç‰¹å®šä¸šåŠ¡åœºæ™¯é€šå¸¸æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºé€šç”¨æ¨¡å‹åœ¨é¢„è®­ç»ƒæ—¶ä½¿ç”¨çš„æ˜¯è·¨é¢†åŸŸçš„æ•°æ®é›†ï¼Œè¿™å¯èƒ½æ— æ³•å……åˆ†è¦†ç›–ä¼ä¸šç‰¹å®šçš„æœ¯è¯­ã€é£æ ¼æˆ–ä»»åŠ¡ã€‚å› æ­¤ï¼Œå¾®è°ƒæ˜¯ä¸€ç§å¸¸ç”¨çš„æŠ€æœ¯ï¼Œå¯ä»¥æé«˜æ¨¡å‹åœ¨ç‰¹å®šåº”ç”¨ä¸Šçš„è¡¨ç°ã€‚\nå¾®è°ƒè¿‡ç¨‹é€šå¸¸åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š\næ•°æ®å‡†å¤‡ï¼šæ”¶é›†å’Œæ•´ç†ä¼ä¸šç›¸å…³çš„æ•°æ®é›†ï¼Œå¦‚å†…éƒ¨æ–‡æ¡£ã€æ—¥å¿—ã€å¯¹è¯è®°å½•ç­‰ã€‚\né¢„å¤„ç†ï¼šå¯¹æ•°æ®è¿›è¡Œæ¸…æ´—å’Œæ ¼å¼åŒ–ï¼Œä½¿å…¶é€‚åˆæ¨¡å‹è¾“å…¥ã€‚\nå¾®è°ƒï¼šåœ¨ä¼ä¸šæ•°æ®ä¸Šç»§ç»­è®­ç»ƒæ¨¡å‹ï¼Œä»¥é€‚åº”ç‰¹å®šä»»åŠ¡ã€‚\nè¯„ä¼°ï¼šæµ‹è¯•å¾®è°ƒåæ¨¡å‹çš„æ€§èƒ½ï¼Œç¡®ä¿å…¶æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ã€‚\néƒ¨ç½²ï¼šå°†å¾®è°ƒåçš„æ¨¡å‹éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚\nå¯¹äºæ¨¡å‹çš„å±‚æ¬¡ç»“æ„å’Œæ¶æ„ç†Ÿæ‚‰ç¨‹åº¦ï¼Œå®é™…ä¸Šç°åœ¨æœ‰å¾ˆå¤šå·¥å…·å’Œåº“å·²ç»ç®€åŒ–äº†è¿™ä¸€è¿‡ç¨‹ï¼Œä½¿å¾—å³ä½¿ä¸æ˜¯æ·±åº¦å­¦ä¹ ä¸“å®¶ä¹Ÿèƒ½è¿›è¡ŒåŸºæœ¬çš„å¾®è°ƒå·¥ä½œã€‚å½“ç„¶ï¼Œæ›´æ·±å…¥çš„å®šåˆ¶åŒ–å’Œä¼˜åŒ–ä»ç„¶éœ€è¦å¯¹æ¨¡å‹çš„å·¥ä½œåŸç†å’Œæœºå™¨å­¦ä¹ çš„ç›¸å…³çŸ¥è¯†æœ‰è¾ƒæ·±å…¥çš„ç†è§£ã€‚\nå¤§æ¨¡å‹æ€§èƒ½æ¯”è¾ƒ\nå…³äºæ¨¡å‹æ€§èƒ½çš„æ¯”è¾ƒï¼Œå¦‚ç™¾åº¦çš„æ–‡å¿ƒä¸€è¨€ï¼Œç§‘å¤§çš„æ˜Ÿç«è®¤çŸ¥ï¼Œä¸OpenAIçš„GPT-3æˆ–GPT-4çš„æ¯”è¾ƒï¼Œä¸å¥½æ¯”è¾ƒã€‚éœ€è¦æ ¹æ®å…·ä½“ä»»åŠ¡å’Œç‹¬ç«‹è¯„ä¼°æ¥è€ƒé‡ã€‚ä¸åŒçš„æ¨¡å‹å¯èƒ½åœ¨ä¸åŒçš„ä»»åŠ¡ä¸Šè¡¨ç°å‡ºä¸åŒçš„æ€§èƒ½æ°´å¹³ï¼Œè€Œä¸”æ€§èƒ½ä¹Ÿå—æ•°æ®é›†ã€è¯„ä¼°æŒ‡æ ‡ã€æµ‹è¯•æ¡ä»¶ç­‰å› ç´ çš„å½±å“ã€‚å› æ­¤ï¼Œæ²¡æœ‰ç»å¯¹çš„â€œæœ€å¥½â€æ¨¡å‹ï¼Œåªæœ‰æœ€é€‚åˆç‰¹å®šä»»åŠ¡å’Œæ¡ä»¶çš„æ¨¡å‹ã€‚\nä¼ä¸šè½åœ°è‡ªå»ºæ¨¡å‹çš„ç°å®æ€§\nå¯¹äºä¼ä¸šæ¥è¯´ï¼Œè‡ªå·±ä»å¤´å¼€å§‹è®­ç»ƒä¸€ä¸ªå¤§å‹è¯­è¨€æ¨¡å‹é€šå¸¸æ˜¯ä¸ç°å®çš„ï¼ŒåŸå› æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\næˆæœ¬ï¼šè®­ç»ƒå¤§å‹æ¨¡å‹éœ€è¦å¤§é‡çš„è®¡ç®—èµ„æºï¼Œè¿™æ„å‘³ç€é«˜æ˜‚çš„ç¡¬ä»¶å’Œç”µåŠ›æˆæœ¬ã€‚\næ•°æ®ï¼šéœ€è¦å¤§è§„æ¨¡çš„ã€é«˜è´¨é‡çš„è®­ç»ƒæ•°æ®ã€‚\nä¸“ä¸šçŸ¥è¯†ï¼šéœ€è¦æœ‰ç»éªŒçš„æ•°æ®ç§‘å­¦å®¶å’Œæœºå™¨å­¦ä¹ å·¥ç¨‹å¸ˆã€‚\næ—¶é—´ï¼šè®­ç»ƒå¯èƒ½éœ€è¦æ•°å‘¨ç”šè‡³æ•°æœˆçš„æ—¶é—´ã€‚\nç»´æŠ¤ï¼šæ¨¡å‹è®­ç»ƒåè¿˜éœ€è¦æŒç»­çš„ç»´æŠ¤å’Œæ›´æ–°ã€‚\nå› æ­¤ï¼Œå¤§å¤šæ•°ä¼ä¸šä¼šé€‰æ‹©ä½¿ç”¨ç°æˆçš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œå¾®è°ƒæ¥æ»¡è¶³è‡ªå·±çš„éœ€è¦ï¼Œè€Œä¸æ˜¯ä»é›¶å¼€å§‹è®­ç»ƒã€‚\nä¼ä¸šè‡ªå»ºæ¨¡å‹éœ€è¦çš„æ¡ä»¶\nå¦‚æœä¼ä¸šç¡®å®æƒ³è¦è‡ªå»ºæ¨¡å‹ï¼Œé‚£ä¹ˆéœ€è¦ï¼š\nå›¢é˜Ÿï¼šç”±æ•°æ®ç§‘å­¦å®¶ã€æœºå™¨å­¦ä¹ å·¥ç¨‹å¸ˆå’Œé¢†åŸŸä¸“å®¶ç»„æˆçš„å›¢é˜Ÿã€‚\næ•°æ®ï¼šè®¿é—®æˆ–åˆ›å»ºè¶³å¤Ÿçš„è®­ç»ƒæ•°æ®ã€‚\nè®¡ç®—èµ„æºï¼šé«˜æ€§èƒ½çš„è®¡ç®—ç¡¬ä»¶æˆ–äº‘è®¡ç®—èµ„æºã€‚\næ—¶é—´å’Œè€å¿ƒï¼šæ¨¡å‹å¼€å‘æ˜¯ä¸€ä¸ªé•¿æœŸçš„è¿‡ç¨‹ã€‚\nç­–ç•¥ï¼šæ¸…æ™°çš„ä¸šåŠ¡ç†è§£å’Œæˆ˜ç•¥ï¼Œä»¥ç¡®å®šæ¨¡å‹çš„å…·ä½“ç”¨é€”å’ŒROIã€‚\nç»“åˆå¤–éƒ¨æœåŠ¡æä¾›å•†çš„ä¸“ä¸šçŸ¥è¯†å’Œèµ„æºå¯èƒ½æ˜¯ä¸€ä¸ªæ›´å®é™…çš„é€”å¾„ã€‚é€šè¿‡åˆä½œï¼Œä¼ä¸šå¯ä»¥åœ¨ä¸æ‰¿æ‹…å…¨éƒ¨å¼€å‘è´Ÿæ‹…çš„æƒ…å†µä¸‹ï¼Œæœ‰æ•ˆåˆ©ç”¨å¤§å‹è¯­è¨€æ¨¡å‹ã€‚\nå¸Œæœ›ä½ æœ‰ä»€ä¹ˆç–‘é—®å¯ä»¥ç»§ç»­æ¢è®¨ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1809833,"ctime":1699003287,"ip_address":"ç‘å£«","comment_id":383296,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100617601,"comment_content":"è€å¸ˆæœ‰ä¸ªé—®é¢˜è¯·æ•™ï¼Œä¾‹å¦‚ç›®å‰å¤§æ¨¡å‹æ¯”è¾ƒå¤šï¼Œæˆ‘çš„ç†è§£å¦‚æœæ»¡è¶³ä¼ä¸šå†…éƒ¨è‡ªå·±ä½¿ç”¨ï¼Œæ˜¯éœ€è¦å¯¹å¤§æ¨¡å‹å¾®è°ƒå§æ‰èƒ½å®Œå…¨æ»¡è¶³å®šåˆ¶ï¼Œä¾‹å¦‚è¾“å‡ºä¼ä¸šè‡ªå·±ç›¸å…³æ•°æ®ï¼Œæ–‡æ¡£ï¼Œä»£ç ç­‰ï¼Œè€Œä¸æ˜¯ç®€å•æŠŠæç¤ºå†™å¥½å¼„ä¸ªå·®ä¸å¤šå¼€æºå¤§æ¨¡å‹ä¸Šå»ã€‚æˆ‘çš„ç†è§£æ˜¯éœ€è¦å¾®è°ƒå§ï¼Œé’ˆå¯¹è‡ªå·±ä¼ä¸šæ•°æ®è¿›è¡Œè®­ç»ƒå¯¹æ¨¡å‹ï¼Œä½†è¿™å—å¬è€å¸ˆè¯¾æˆ‘ç†è§£éœ€è¦å¯¹æ¨¡å‹å±‚æ¬¡ç†Ÿæ‚‰æ‰èƒ½ä¸‹æ‰‹è¿›è¡Œå¾®è°ƒå§ï¼Œæˆ‘è‡ªå·±ç†è§£ç›®å‰ä»æ•ˆæœä¸Šè¿˜æ˜¯gptå…¶å®ƒæ¨¡å‹è¿˜æ˜¯æ¯”è¾ƒå¼±ï¼Œç™¾åº¦è¯´ä»–çš„2.0å·²ç»è¶…è¿‡gpt3.5ï¼Œæ¯”gpt4å·®ç‚¹ï¼Œæˆ‘è§‰å¾—æ²¡é‚£ä¹ˆå¿«å§ï¼Œå¦å¤–è®­ç»ƒæ¨¡å‹æœºå™¨ç¡¬ä»¶äººå‘˜ç­‰å„ç§å› ç´ å åŠ ï¼Œä¸æ˜¯è¯´éƒ½èƒ½åšå¥½äº†å§ï¼Œä¼ä¸šè‡ªå·±è½åœ°è‡ªå·±æ¨¡å‹è¿™å—ç°å®å—ï¼Œè‡ªå·±åšéœ€è¦é‚£äº›æ¡ä»¶ï¼Œä¾‹å¦‚äººå‘˜è¦æ±‚ç­‰ï¼Œè°¢è°¢","like_count":9,"discussions":[{"author":{"id":1809833,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/a9/4602808f.jpg","nickname":"é»„ä½³","note":"","ucode":"8EC41D2EAB0E3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":630885,"discussion_content":"ä½ çš„é—®é¢˜æ¶‰åŠåˆ°å¤§å‹é¢„è®­ç»ƒæ¨¡å‹åœ¨ä¼ä¸šåº”ç”¨ä¸­çš„å¾®è°ƒã€æ€§èƒ½æ¯”è¾ƒä»¥åŠä¼ä¸šè½åœ°å®ç°çš„å¯è¡Œæ€§å’Œæ¡ä»¶ã€‚æˆ‘ç»™å‡ºæ¯”è¾ƒå®˜æ–¹çš„å›ç­”ã€‚\nå¾®è°ƒå¤§æ¨¡å‹\nå¯¹äºä¼ä¸šæ¥è¯´ï¼Œç¡®å®ï¼Œå°†ä¸€ä¸ªé€šç”¨çš„å¤§å‹è¯­è¨€æ¨¡å‹ç›´æ¥ç”¨äºç‰¹å®šä¸šåŠ¡åœºæ™¯é€šå¸¸æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºé€šç”¨æ¨¡å‹åœ¨é¢„è®­ç»ƒæ—¶ä½¿ç”¨çš„æ˜¯è·¨é¢†åŸŸçš„æ•°æ®é›†ï¼Œè¿™å¯èƒ½æ— æ³•å……åˆ†è¦†ç›–ä¼ä¸šç‰¹å®šçš„æœ¯è¯­ã€é£æ ¼æˆ–ä»»åŠ¡ã€‚å› æ­¤ï¼Œå¾®è°ƒæ˜¯ä¸€ç§å¸¸ç”¨çš„æŠ€æœ¯ï¼Œå¯ä»¥æé«˜æ¨¡å‹åœ¨ç‰¹å®šåº”ç”¨ä¸Šçš„è¡¨ç°ã€‚\nå¾®è°ƒè¿‡ç¨‹é€šå¸¸åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š\næ•°æ®å‡†å¤‡ï¼šæ”¶é›†å’Œæ•´ç†ä¼ä¸šç›¸å…³çš„æ•°æ®é›†ï¼Œå¦‚å†…éƒ¨æ–‡æ¡£ã€æ—¥å¿—ã€å¯¹è¯è®°å½•ç­‰ã€‚\né¢„å¤„ç†ï¼šå¯¹æ•°æ®è¿›è¡Œæ¸…æ´—å’Œæ ¼å¼åŒ–ï¼Œä½¿å…¶é€‚åˆæ¨¡å‹è¾“å…¥ã€‚\nå¾®è°ƒï¼šåœ¨ä¼ä¸šæ•°æ®ä¸Šç»§ç»­è®­ç»ƒæ¨¡å‹ï¼Œä»¥é€‚åº”ç‰¹å®šä»»åŠ¡ã€‚\nè¯„ä¼°ï¼šæµ‹è¯•å¾®è°ƒåæ¨¡å‹çš„æ€§èƒ½ï¼Œç¡®ä¿å…¶æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ã€‚\néƒ¨ç½²ï¼šå°†å¾®è°ƒåçš„æ¨¡å‹éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚\nå¯¹äºæ¨¡å‹çš„å±‚æ¬¡ç»“æ„å’Œæ¶æ„ç†Ÿæ‚‰ç¨‹åº¦ï¼Œå®é™…ä¸Šç°åœ¨æœ‰å¾ˆå¤šå·¥å…·å’Œåº“å·²ç»ç®€åŒ–äº†è¿™ä¸€è¿‡ç¨‹ï¼Œä½¿å¾—å³ä½¿ä¸æ˜¯æ·±åº¦å­¦ä¹ ä¸“å®¶ä¹Ÿèƒ½è¿›è¡ŒåŸºæœ¬çš„å¾®è°ƒå·¥ä½œã€‚å½“ç„¶ï¼Œæ›´æ·±å…¥çš„å®šåˆ¶åŒ–å’Œä¼˜åŒ–ä»ç„¶éœ€è¦å¯¹æ¨¡å‹çš„å·¥ä½œåŸç†å’Œæœºå™¨å­¦ä¹ çš„ç›¸å…³çŸ¥è¯†æœ‰è¾ƒæ·±å…¥çš„ç†è§£ã€‚\nå¤§æ¨¡å‹æ€§èƒ½æ¯”è¾ƒ\nå…³äºæ¨¡å‹æ€§èƒ½çš„æ¯”è¾ƒï¼Œå¦‚ç™¾åº¦çš„æ–‡å¿ƒä¸€è¨€ï¼Œç§‘å¤§çš„æ˜Ÿç«è®¤çŸ¥ï¼Œä¸OpenAIçš„GPT-3æˆ–GPT-4çš„æ¯”è¾ƒï¼Œä¸å¥½æ¯”è¾ƒã€‚éœ€è¦æ ¹æ®å…·ä½“ä»»åŠ¡å’Œç‹¬ç«‹è¯„ä¼°æ¥è€ƒé‡ã€‚ä¸åŒçš„æ¨¡å‹å¯èƒ½åœ¨ä¸åŒçš„ä»»åŠ¡ä¸Šè¡¨ç°å‡ºä¸åŒçš„æ€§èƒ½æ°´å¹³ï¼Œè€Œä¸”æ€§èƒ½ä¹Ÿå—æ•°æ®é›†ã€è¯„ä¼°æŒ‡æ ‡ã€æµ‹è¯•æ¡ä»¶ç­‰å› ç´ çš„å½±å“ã€‚å› æ­¤ï¼Œæ²¡æœ‰ç»å¯¹çš„â€œæœ€å¥½â€æ¨¡å‹ï¼Œåªæœ‰æœ€é€‚åˆç‰¹å®šä»»åŠ¡å’Œæ¡ä»¶çš„æ¨¡å‹ã€‚\nä¼ä¸šè½åœ°è‡ªå»ºæ¨¡å‹çš„ç°å®æ€§\nå¯¹äºä¼ä¸šæ¥è¯´ï¼Œè‡ªå·±ä»å¤´å¼€å§‹è®­ç»ƒä¸€ä¸ªå¤§å‹è¯­è¨€æ¨¡å‹é€šå¸¸æ˜¯ä¸ç°å®çš„ï¼ŒåŸå› æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\næˆæœ¬ï¼šè®­ç»ƒå¤§å‹æ¨¡å‹éœ€è¦å¤§é‡çš„è®¡ç®—èµ„æºï¼Œè¿™æ„å‘³ç€é«˜æ˜‚çš„ç¡¬ä»¶å’Œç”µåŠ›æˆæœ¬ã€‚\næ•°æ®ï¼šéœ€è¦å¤§è§„æ¨¡çš„ã€é«˜è´¨é‡çš„è®­ç»ƒæ•°æ®ã€‚\nä¸“ä¸šçŸ¥è¯†ï¼šéœ€è¦æœ‰ç»éªŒçš„æ•°æ®ç§‘å­¦å®¶å’Œæœºå™¨å­¦ä¹ å·¥ç¨‹å¸ˆã€‚\næ—¶é—´ï¼šè®­ç»ƒå¯èƒ½éœ€è¦æ•°å‘¨ç”šè‡³æ•°æœˆçš„æ—¶é—´ã€‚\nç»´æŠ¤ï¼šæ¨¡å‹è®­ç»ƒåè¿˜éœ€è¦æŒç»­çš„ç»´æŠ¤å’Œæ›´æ–°ã€‚\nå› æ­¤ï¼Œå¤§å¤šæ•°ä¼ä¸šä¼šé€‰æ‹©ä½¿ç”¨ç°æˆçš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œå¾®è°ƒæ¥æ»¡è¶³è‡ªå·±çš„éœ€è¦ï¼Œè€Œä¸æ˜¯ä»é›¶å¼€å§‹è®­ç»ƒã€‚\nä¼ä¸šè‡ªå»ºæ¨¡å‹éœ€è¦çš„æ¡ä»¶\nå¦‚æœä¼ä¸šç¡®å®æƒ³è¦è‡ªå»ºæ¨¡å‹ï¼Œé‚£ä¹ˆéœ€è¦ï¼š\nå›¢é˜Ÿï¼šç”±æ•°æ®ç§‘å­¦å®¶ã€æœºå™¨å­¦ä¹ å·¥ç¨‹å¸ˆå’Œé¢†åŸŸä¸“å®¶ç»„æˆçš„å›¢é˜Ÿã€‚\næ•°æ®ï¼šè®¿é—®æˆ–åˆ›å»ºè¶³å¤Ÿçš„è®­ç»ƒæ•°æ®ã€‚\nè®¡ç®—èµ„æºï¼šé«˜æ€§èƒ½çš„è®¡ç®—ç¡¬ä»¶æˆ–äº‘è®¡ç®—èµ„æºã€‚\næ—¶é—´å’Œè€å¿ƒï¼šæ¨¡å‹å¼€å‘æ˜¯ä¸€ä¸ªé•¿æœŸçš„è¿‡ç¨‹ã€‚\nç­–ç•¥ï¼šæ¸…æ™°çš„ä¸šåŠ¡ç†è§£å’Œæˆ˜ç•¥ï¼Œä»¥ç¡®å®šæ¨¡å‹çš„å…·ä½“ç”¨é€”å’ŒROIã€‚\nç»“åˆå¤–éƒ¨æœåŠ¡æä¾›å•†çš„ä¸“ä¸šçŸ¥è¯†å’Œèµ„æºå¯èƒ½æ˜¯ä¸€ä¸ªæ›´å®é™…çš„é€”å¾„ã€‚é€šè¿‡åˆä½œï¼Œä¼ä¸šå¯ä»¥åœ¨ä¸æ‰¿æ‹…å…¨éƒ¨å¼€å‘è´Ÿæ‹…çš„æƒ…å†µä¸‹ï¼Œæœ‰æ•ˆåˆ©ç”¨å¤§å‹è¯­è¨€æ¨¡å‹ã€‚\nå¸Œæœ›ä½ æœ‰ä»€ä¹ˆç–‘é—®å¯ä»¥ç»§ç»­æ¢è®¨ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1699003287,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ç‘å£«","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1048887,"avatar":"https://static001.geekbang.org/account/avatar/00/10/01/37/12e4c9c9.jpg","nickname":"é«˜æº","note":"","ucode":"751B41FD38EF7D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":647279,"discussion_content":"è€å¸ˆå¾®è°ƒå…·ä½“æ–¹æ³•å’Œå®æˆ˜ä½ çš„æ–°è¯¾ç¨‹é‡Œæœ‰å…·ä½“è¯´æ˜å’Œè°ƒè¯•æ–¹æ³•å—ï¼Œæˆ‘æ¯”è¾ƒæ„Ÿå…´è¶£çš„æ˜¯å¦‚ä½•é’ˆå¯¹æŸä¸€é¢†åŸŸçŸ¥è¯†ä½ ç»™æ¨¡å‹åŠ è½½ä¸“ä¸šæ•°æ®åï¼Œæ˜¯å¦‚ä½•å¾®è°ƒå‚æ•°è®©æ¨¡å‹å¯¹æ­¤ä¸“ä¸šå›ç­”æ›´å‡†ç¡®çš„ï¼Œå¦å¤–ä¹‹å‰æåˆ°æ¨¡å‹æ ¹æ®ä½ çš„é—®é¢˜å¦‚ä½•å¾—å‡ºæ­£ç¡®ç­”æ¡ˆè¾“å‡ºï¼Œæˆ‘æŒ‡çš„æ˜¯å…·ä½“æ€ä¹ˆç»™ç­”æ¡ˆçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1719805935,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å‰æ—","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":382083,"user_name":"æ£Ÿ","can_delete":false,"product_type":"c1","uid":2050798,"ip_address":"å¹¿ä¸œ","ucode":"D85800A3BA3CF8","user_header":"https://static001.geekbang.org/account/avatar/00/1f/4a/ee/fe035424.jpg","comment_is_top":false,"comment_ctime":1696669650,"is_pvip":false,"replies":[{"id":139199,"content":"è¿™é‡Œç¤ºä¾‹çš„æ„æ€æ˜¯action_inputæ˜¯å¿…é¡»çš„å­—æ®µï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰passåˆ°æ¨¡å‹é‡Œé¢å»ã€‚è¦ç¡®ä¿ä½ åœ¨ä¼ é€’æ•°æ®ä¹‹å‰å°†JSONå­—ç¬¦ä¸²è§£æä¸ºPythonå­—å…¸ã€‚å¯ä»¥ä½¿ç”¨ json.loads() æ–¹æ³•æ¥å®ç°è¿™ä¸€ç‚¹ï¼š\nimport json\nbad_response = &#39;{&quot;action&quot;: &quot;search&quot;}&#39;\nparsed_response = json.loads(bad_response)\nä¸çŸ¥é“æˆ‘è¿™é‡Œæ˜¯å¦ç†è§£äº†åŒå­¦çš„å…·ä½“é—®é¢˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1809833,"ctime":1696846382,"ip_address":"ç‘å£«","comment_id":382083,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100617601,"comment_content":"è€å¸ˆï¼Œè¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼Œ\nfix_parseræˆ–retry_parserä¸­ï¼Œå¦‚æœé”™è¯¯çš„è¾“å‡ºæ˜¯jsonæ ¼å¼ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š\naction_input\n  Field required [type=missing, input_value={&#39;action&#39;: &#39;search&#39;}, input_type=dict]\n    For further information visit https:&#47;&#47;errors.pydantic.dev&#47;2.3&#47;v&#47;missing\n\næˆ‘æ˜¯å°†é”™è¯¯bad_response = &#39;{&quot;action&quot;: &quot;search&quot;}&#39;  --&gt; æ›´æ”¹ä¸ºbad_response = &quot;{&#39;action&#39;: &#39;search&#39;}&quot;æ‰èƒ½æ­£å¸¸è°ƒç”¨æ¨¡å‹ï¼Œè¿™ä¸ªè¦æ€ä¹ˆä¿®å¤ã€‚\nçŸ¥é“çš„æœ‹å‹ä¹Ÿè¯·æŒ‡ç‚¹ï¼Œæ„Ÿè°¢ï¼","like_count":1,"discussions":[{"author":{"id":1809833,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/a9/4602808f.jpg","nickname":"é»„ä½³","note":"","ucode":"8EC41D2EAB0E3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":629228,"discussion_content":"è¿™é‡Œç¤ºä¾‹çš„æ„æ€æ˜¯action_inputæ˜¯å¿…é¡»çš„å­—æ®µï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰passåˆ°æ¨¡å‹é‡Œé¢å»ã€‚è¦ç¡®ä¿ä½ åœ¨ä¼ é€’æ•°æ®ä¹‹å‰å°†JSONå­—ç¬¦ä¸²è§£æä¸ºPythonå­—å…¸ã€‚å¯ä»¥ä½¿ç”¨ json.loads() æ–¹æ³•æ¥å®ç°è¿™ä¸€ç‚¹ï¼š\nimport json\nbad_response = &#39;{&#34;action&#34;: &#34;search&#34;}&#39;\nparsed_response = json.loads(bad_response)\nä¸çŸ¥é“æˆ‘è¿™é‡Œæ˜¯å¦ç†è§£äº†åŒå­¦çš„å…·ä½“é—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1696846382,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ç‘å£«","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2050798,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/4a/ee/fe035424.jpg","nickname":"æ£Ÿ","note":"","ucode":"D85800A3BA3CF8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1809833,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/a9/4602808f.jpg","nickname":"é»„ä½³","note":"","ucode":"8EC41D2EAB0E3C","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":629232,"discussion_content":"æ„Ÿè°¢è€å¸ˆçš„æŒ‡ç‚¹ï¼Œæ˜¯è¿™ä¸ªæ„æ€ã€‚ç°åœ¨çœ‹æŠ¥é”™æ˜ç™½æ˜¯pysanticè¦æ±‚ä¼ å…¥LLMçš„å¿…é¡»æ˜¯dictç±»å‹æ•°æ®äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1696847201,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":629228,"ip_address":"å¹¿ä¸œ","group_id":0},"score":629232,"extra":""}]},{"author":{"id":3600600,"avatar":"https://static001.geekbang.org/account/avatar/00/36/f0/d8/c344594a.jpg","nickname":"ğŸ‡¾.ğŸ‡¨.","note":"","ucode":"C033E961553EA3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":640865,"discussion_content":"æˆ‘çœŸæ˜¯æœäº†ï¼Œåˆšå†™å®Œï¼Œæ›´æ–°äº†ä¸€ä¸‹langchainï¼Œçœ‹äº†çœ¼langchainçš„ä»“åº“å‘ç°è¿™ä¸ªé—®é¢˜ä¿®æ‰äº†ï¼Œ1ä¸ªå°æ—¶å‰ã€‚ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1711952934,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3600600,"avatar":"https://static001.geekbang.org/account/avatar/00/36/f0/d8/c344594a.jpg","nickname":"ğŸ‡¾.ğŸ‡¨.","note":"","ucode":"C033E961553EA3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":640864,"discussion_content":"åœ¨è€å“¥ä½ å¸–å­ä¸‹é¢è¡¥ä¸€ä¸‹ï¼š\nç›´åˆ°24/04/01ï¼šlangchainä»»ç„¶åªæ”¯æŒpydantic.v1ï¼Œåœ¨PydanticOutputParserç±»æœ‰ä¸€æ®µæè¿°ï¼š\nclass PydanticOutputParser(JsonOutputParser, Generic[TBaseModel]):\n    &#34;&#34;&#34;Parse an output using a pydantic model.&#34;&#34;&#34;\n\n    pydantic_object: Type[TBaseModel]\n    &#34;&#34;&#34;The pydantic model to parse.\n    \n    Attention: To avoid potential compatibility issues, it&#39;s recommended to use\n        pydantic &lt;2 or leverage the v1 namespace in pydantic &gt;= 2.\n    &#34;&#34;&#34;\nä¸Šæ–‡æåˆ°ç›®å‰è¿˜æ˜¯æ¨èä½¿ç”¨pydantic1æˆ–è€…ä½¿ç”¨from pydantic.v1 import BaseModel,Field","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1711951864,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":391132,"user_name":"æ›¹èƒ–å­","can_delete":false,"product_type":"c1","uid":1374648,"ip_address":"æ¹–å—","ucode":"8911E5DA412E59","user_header":"https://static001.geekbang.org/account/avatar/00/14/f9/b8/0f3bd8ec.jpg","comment_is_top":false,"comment_ctime":1717397713,"is_pvip":false,"replies":[{"id":142251,"content":"è°¢è°¢åŒå­¦","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1809833,"ctime":1717498861,"ip_address":"æ–°åŠ å¡","comment_id":391132,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100617601,"comment_content":"parsed_output = output_parser.parse(output.content)   ä¼šæŠ¥å¼‚å¸¸ï¼Œ ç›®å‰æˆ‘å°è¯•æ‰“å°äº† outputçš„æ•°æ®ç±»å‹å’Œç»“æ„ï¼Œæ„Ÿè§‰æ˜¯è¿”å›çš„æ•°æ®ç»“æ„å‡ºç°çš„å˜åŠ¨ï¼Œæœ€ç»ˆæˆ‘è°ƒæ•´ä¸º parsed_output = output_parser.parse(output.content) åä»£ç å¯æ‰§è¡Œã€‚","like_count":0,"discussions":[{"author":{"id":1809833,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/a9/4602808f.jpg","nickname":"é»„ä½³","note":"","ucode":"8EC41D2EAB0E3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":646179,"discussion_content":"è°¢è°¢åŒå­¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1717498861,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ–°åŠ å¡","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385455,"user_name":"é£éš¼[å’–å•¡]","can_delete":false,"product_type":"c1","uid":1044188,"ip_address":"ä¸Šæµ·","ucode":"075116DF9B0D88","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ee/dc/39fa0a55.jpg","comment_is_top":false,"comment_ctime":1702635183,"is_pvip":false,"replies":[{"id":140830,"content":"å¥½å˜ï¼Œè°¢è°¢æ‚¨çš„åˆ†äº«ï¼ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1809833,"ctime":1704803147,"ip_address":"æ–°åŠ å¡","comment_id":385455,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100617601,"comment_content":"    # parsed_output_dict = parsed_output.dict()  # å°†Pydanticæ ¼å¼è½¬åŒ–ä½å­—å…¸\n    # Pydantic æ ¼å¼è½¬åŒ–ä¸ºå­—å…¸,Pydantic V2dict æ–¹æ³•å·²ç»è¢«åºŸå¼ƒï¼Œæ¨èä½¿ç”¨ model_dump æ–¹æ³•æ¥ä»£æ›¿\n    parsed_output_dict = parsed_output.model_dump()","like_count":0,"discussions":[{"author":{"id":1809833,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/a9/4602808f.jpg","nickname":"é»„ä½³","note":"","ucode":"8EC41D2EAB0E3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635402,"discussion_content":"å¥½å˜ï¼Œè°¢è°¢æ‚¨çš„åˆ†äº«ï¼ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1704803147,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ–°åŠ å¡","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":384968,"user_name":"rick009","can_delete":false,"product_type":"c1","uid":1016406,"ip_address":"åŒ—äº¬","ucode":"8F931876692B7B","user_header":"","comment_is_top":false,"comment_ctime":1701859258,"is_pvip":false,"replies":[{"id":140845,"content":"å¯èƒ½è¿™ä¸ªæ ¼å¼è¿‡äºå¤æ‚äº†ï¼Œéœ€è¦ç®€åŒ–ä»»åŠ¡ã€‚å¦å¤–ï¼Œç”¨æœ€æ–°çš„gpt-4-1106-previewæ¨¡å‹è¯•è¯•ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1809833,"ctime":1704816924,"ip_address":"ç‘å£«","comment_id":384968,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100617601,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæœ‰ä¸ªé—®é¢˜è¯·æ•™ä¸€ä¸‹ï¼Œæˆ‘æƒ³è¦ä»ç»™å®šçš„ä¸€æ®µæ–‡æœ¬ä¸­æŠ½ç¦»ä¸€äº›FAQï¼Œç„¶åæƒ³è¿”å›JSONæ•°ç»„çš„æ ¼å¼ï¼Œä»¥ä¸‹æ˜¯promptï¼š\ntemplate = &quot;&quot;&quot;ä½ æ˜¯ä¸€åçŸ¥è¯†åº“ç®¡ç†å‘˜ï¼Œéœ€å°†ä»¥ä¸‹å†…å®¹æ‹†åˆ†æˆ {nums} ä¸ªé—®ç­”å¯¹ï¼Œç¡®ä¿å‡†ç¡®æ— è¯¯ä¸”åªä»æ–‡çŒ®ä¸­è·å–ï¼Œä¸å¾—æ‰©æ•£ã€‚ä½ çš„ç®—æ³•æˆ–æµç¨‹åº”è¯¥èƒ½å¤Ÿå‡†ç¡®æŠ½å–å…³é”®ä¿¡æ¯ï¼Œå¹¶ç”Ÿæˆå‡†ç¡®çš„é—®ç­”å¯¹ï¼Œä»¥å……åˆ†åˆ©ç”¨æ–‡çŒ®ã€‚\n    {doc_content}\n    {format_instructions}  \n    &quot;&quot;&quot;\næƒ³è¦è¿”å›çš„æ ¼å¼ä¸º\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\\n\\nAs an example, for the schema {&quot;properties&quot;: {&quot;foo&quot;: {&quot;title&quot;: &quot;Foo&quot;, &quot;description&quot;: &quot;a list of strings&quot;, &quot;type&quot;: &quot;array&quot;, &quot;items&quot;: {&quot;type&quot;: &quot;string&quot;}}}, &quot;required&quot;: [&quot;foo&quot;]}\\nthe object {&quot;foo&quot;: [&quot;bar&quot;, &quot;baz&quot;]} is a well-formatted instance of the schema. The object {&quot;properties&quot;: {&quot;foo&quot;: [&quot;bar&quot;, &quot;baz&quot;]}} is not well-formatted.\\n\\nHere is the output schema:\\n```\\n{&quot;$defs&quot;: {&quot;QA&quot;: {&quot;properties&quot;: {&quot;Q&quot;: {&quot;description&quot;: &quot;\\\\u95ee\\\\u9898&quot;, &quot;title&quot;: &quot;Q&quot;, &quot;type&quot;: &quot;string&quot;}, &quot;A&quot;: {&quot;description&quot;: &quot;\\\\u7b54\\\\u6848&quot;, &quot;title&quot;: &quot;A&quot;, &quot;type&quot;: &quot;string&quot;}}, &quot;required&quot;: [&quot;Q&quot;, &quot;A&quot;], &quot;title&quot;: &quot;QA&quot;, &quot;type&quot;: &quot;object&quot;}}, &quot;items&quot;: {&quot;$ref&quot;: &quot;#&#47;$defs&#47;QA&quot;}}\\n```\nclass QA(BaseModel):\n    Q: str = Field(description=&quot;é—®é¢˜&quot;)\n    A: str = Field(description=&quot;ç­”æ¡ˆ&quot;)\n\nclass QAList(RootModel):\n    root: List[QA] = Field(description=&quot;FAQé—®ç­”å¯¹åˆ—è¡¨&quot;)\nä½†æ˜¯è¿”å›çš„æ ¼å¼æ€»æ˜¯ä¸åœçš„åœ¨å˜ï¼Œéƒ½æ— æ³•è¿”å›å¸Œæœ›çš„æ•°æ®ç»“æ„","like_count":0,"discussions":[{"author":{"id":1809833,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/a9/4602808f.jpg","nickname":"é»„ä½³","note":"","ucode":"8EC41D2EAB0E3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635428,"discussion_content":"å¯èƒ½è¿™ä¸ªæ ¼å¼è¿‡äºå¤æ‚äº†ï¼Œéœ€è¦ç®€åŒ–ä»»åŠ¡ã€‚å¦å¤–ï¼Œç”¨æœ€æ–°çš„gpt-4-1106-previewæ¨¡å‹è¯•è¯•ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1704816924,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ç‘å£«","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":382965,"user_name":"é²¸é±¼","can_delete":false,"product_type":"c1","uid":1052643,"ip_address":"åŒ—äº¬","ucode":"71437C1C601040","user_header":"https://static001.geekbang.org/account/avatar/00/10/0f/e3/c49aa508.jpg","comment_is_top":false,"comment_ctime":1698241206,"is_pvip":false,"replies":[{"id":139531,"content":"åŒå­¦çš„è¿™ä¸ªè§‚å¯Ÿå¾ˆå¥½ã€‚ä¹Ÿå¾ˆæœ‰ç”¨ã€‚å¯ä»¥å†LangChainä¸­Logä¸€ä¸ªIssueä¸€èµ·è®¨è®ºä¸€ä¸‹è§£å†³æ–¹æ¡ˆã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1809833,"ctime":1698382135,"ip_address":"ç‘å£«","comment_id":382965,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100617601,"comment_content":"æˆ‘é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œç›®å‰çš„langchainå¿…é¡»ä½¿ç”¨v1ç‰ˆæœ¬çš„pydanticï¼Œå¦‚æœä½¿ç”¨äº†v2ç‰ˆæœ¬æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ä¸å¯¹ï¼Œä¼šå¯¼è‡´PydanticOutputParseræ— æ³•æ•è·æ­£å¸¸çš„ValidationErrorå¼‚å¸¸ï¼Œä»è€Œä¸ä¼šå»è¯·æ±‚openAIä¿®å¤responseã€‚\nPydanticOutputParserçš„å…·ä½“æ•è·ä»£ç æ˜¯è¿™é‡Œ\n\nclass PydanticOutputParser(BaseOutputParser[T]):\n    &quot;&quot;&quot;Parse an output using a pydantic model.&quot;&quot;&quot;\n\n    pydantic_object: Type[T]\n    &quot;&quot;&quot;The pydantic model to parse.&quot;&quot;&quot;\n\n    def parse(self, text: str) -&gt; T:\n        try:\n            # Greedy search for 1st json candidate.\n            match = re.search(\n                r&quot;\\{.*\\}&quot;, text.strip(), re.MULTILINE | re.IGNORECASE | re.DOTALL\n            )\n            json_str = &quot;&quot;\n            if match:\n                json_str = match.group()\n            json_object = json.loads(json_str, strict=False)\n            return self.pydantic_object.parse_obj(json_object)\n\n        except (json.JSONDecodeError, ValidationError) as e: # è¿™é‡Œåªèƒ½æ•è·v1ç‰ˆæœ¬çš„ValidationError\n            name = self.pydantic_object.__name__\n            msg = f&quot;Failed to parse {name} from completion {text}. Got: {e}&quot;\n            raise OutputParserException(msg, llm_output=text)\n","like_count":0,"discussions":[{"author":{"id":1809833,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/a9/4602808f.jpg","nickname":"é»„ä½³","note":"","ucode":"8EC41D2EAB0E3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":630394,"discussion_content":"åŒå­¦çš„è¿™ä¸ªè§‚å¯Ÿå¾ˆå¥½ã€‚ä¹Ÿå¾ˆæœ‰ç”¨ã€‚å¯ä»¥å†LangChainä¸­Logä¸€ä¸ªIssueä¸€èµ·è®¨è®ºä¸€ä¸‹è§£å†³æ–¹æ¡ˆã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1698382135,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ç‘å£«","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":381428,"user_name":"åœ¨è·¯ä¸Š","can_delete":false,"product_type":"c1","uid":1402511,"ip_address":"å¹¿ä¸œ","ucode":"6E31908EFE1107","user_header":"https://static001.geekbang.org/account/avatar/00/15/66/8f/02be926d.jpg","comment_is_top":false,"comment_ctime":1695197072,"is_pvip":false,"replies":[{"id":138945,"content":"å¾ˆå¥½çš„å°è¯•ï¼Œè°¢è°¢åˆ†äº«ï¼ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1809833,"ctime":1695226120,"ip_address":"æ–°åŠ å¡","comment_id":381428,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100617601,"comment_content":"ä½³å“¥å¥½ï¼Œæˆ‘å‘ç°åœ¨OutputFixingParserç¤ºä¾‹ä¸­ï¼Œå¦‚æœåšå¦‚ä¸‹ä¿®æ”¹ï¼š\nnew_parser = OutputFixingParser.from_llm(parser=parser, llm=ChatOpenAI(temperature=0))\næˆ–è€…\nnew_parser = OutputFixingParser.from_llm(parser=parser, llm=OpenAI(temperature=0))\nå¯ä»¥å¾—åˆ°ç¨³å®šçš„è¾“å‡ºï¼š\nname=&#39;åº·ä¹ƒé¦¨&#39; colors=[&#39;ç²‰çº¢è‰²&#39;, &#39;ç™½è‰²&#39;, &#39;çº¢è‰²&#39;, &#39;ç´«è‰²&#39;, &#39;é»„è‰²&#39;]\nè€Œä¸æ˜¯ï¼š\nname=&#39;Rose&#39; colors=[&#39;red&#39;, &#39;pink&#39;, &#39;white&#39;]","like_count":0,"discussions":[{"author":{"id":1809833,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/a9/4602808f.jpg","nickname":"é»„ä½³","note":"","ucode":"8EC41D2EAB0E3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":628362,"discussion_content":"å¾ˆå¥½çš„å°è¯•ï¼Œè°¢è°¢åˆ†äº«ï¼ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1695226120,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ–°åŠ å¡","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":392877,"user_name":"yanyu-xin","can_delete":false,"product_type":"c1","uid":1899757,"ip_address":"å¹¿ä¸œ","ucode":"3AA389F9E4C236","user_header":"","comment_is_top":false,"comment_ctime":1722050823,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100617601,"comment_content":"é‡è¯•è§£æå™¨ï¼ˆRetryWithErrorOutputParserï¼‰å®æˆ˜å­¦ä¹ ï¼Œä¿®æ”¹ä»£ç å¦‚ä¸‹ã€‚æ³¨æ„ï¼šè¦è®¾ç½®max_retries=3ï¼Œå¢åŠ é‡è¯•æ¬¡æ•°ï¼Œè§£ææˆåŠŸç‡ä¼šæå¤§æé«˜\nï¼ˆ1ï¼‰åŸä»£ç ï¼š\nfix_parser = OutputFixingParser.from_llm(parser=parser, llm=ChatOpenAI())\næ–°ä»£ç ï¼š\nos.environ[&quot;BAICHUAN_API_KEY&quot;] =&quot;xxx&quot; # è¯·æ›¿æ¢ä¸ºä½ çš„ç™¾å·æ¨¡å‹ BAICHUAN API Key\nfrom langchain_community.llms import BaichuanLLM\n# åŠ è½½ç™¾å·æ¨¡å‹\nllm = BaichuanLLM()\nfix_parser = OutputFixingParser.from_llm(parser=parser, llm=llm, max_retries=3) # ä½¿ç”¨ç™¾å·æ¨¡å‹ï¼Œå¢åŠ é‡è¯•æ¬¡æ•°:3\nï¼ˆ2ï¼‰\nåŸä»£ç ï¼š\nfrom langchain.llms import OpenAI\nretry_parser = RetryWithErrorOutputParser.from_llm(\n    parser=parser, llm=OpenAI(temperature=0)\n)\næ–°ä»£ç ï¼š\nfrom langchain_community.llms import BaichuanLLM\n# åˆå§‹åŒ–ç™¾å·æ™ºèƒ½æ¨¡å‹\nbaichuan_llm = BaichuanLLM()\n# åˆå§‹åŒ–RetryWithErrorOutputParserï¼Œä½¿ç”¨ç™¾å·æ™ºèƒ½æ¨¡å‹\nretry_parser = RetryWithErrorOutputParser.from_llm(\n    parser=parser, llm=baichuan_llm  , max_retries=3     # ä½¿ç”¨ç™¾å·æ¨¡å‹\n)","like_count":1},{"had_liked":false,"id":392876,"user_name":"yanyu-xin","can_delete":false,"product_type":"c1","uid":1899757,"ip_address":"å¹¿ä¸œ","ucode":"3AA389F9E4C236","user_header":"","comment_is_top":false,"comment_ctime":1722047404,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100617601,"comment_content":"ç»§ç»­ä½¿ç”¨å›½äº§å¤§æ¨¡å‹æ›¿ä»£OpenAIè¿›è¡Œä»£ç å­¦ä¹ ã€‚\nåœ¨è‡ªåŠ¨ä¿®å¤è§£æå™¨ï¼ˆOutputFixingParserï¼‰å®æˆ˜ä¸­å‘ç°ï¼Œä½¿ç”¨é€šä¹‰åƒé—®æ¨¡å‹è°ƒç”¨æ—¶å‡ºé”™ï¼Œæ— æ³•è§£æã€‚ä½†æ˜¯ç”¨ç™¾å·æ™ºèƒ½æ¨¡å‹èƒ½å¤Ÿæ­£ç¡®è§£æã€‚\nä½¿ç”¨ç™¾å·æ¨¡å‹ä¿®æ­£ä»£ç å¦‚ä¸‹ï¼š\nåŸä»£ç ï¼š\nnew_parser = OutputFixingParser.from_llm(parser=parser, llm=ChatOpenAI())\næ–°ä»£ç ï¼š\nos.environ[&quot;BAICHUAN_API_KEY&quot;] =&quot;xxx&quot; # è¯·æ›¿æ¢ä¸ºä½ çš„ç™¾å·æ¨¡å‹ BAICHUAN API Key\nfrom langchain_community.llms import BaichuanLLM\nllm = BaichuanLLM()  # åŠ è½½ç™¾å·æ¨¡å‹\nnew_parser = OutputFixingParser.from_llm(parser=parser, llm=llm, max_retries=3) # å¢åŠ é‡è¯•æ¬¡æ•°:3","like_count":1},{"had_liked":false,"id":392404,"user_name":"å¼ ç”³å‚²","can_delete":false,"product_type":"c1","uid":1182372,"ip_address":"åŒ—äº¬","ucode":"22D46BC529BA8A","user_header":"https://static001.geekbang.org/account/avatar/00/12/0a/a4/828a431f.jpg","comment_is_top":false,"comment_ctime":1720838095,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":2,"score":3,"product_id":100617601,"comment_content":"ç¬¬7è®²æ‰“å¡~\nå†è¡¥å……ä¸€ä¸ªæœ€ç®€å•çš„StrOutputParserå­—ç¬¦ä¸²è§£æå™¨ï¼Œå®ƒå°†LLMçš„è¾“å‡ºç»“æœç›´æ¥è§£ææˆå­—ç¬¦ä¸²ï¼Œåœ¨å®¢æœç³»ç»Ÿã€èŠå¤©æœºå™¨äººç­‰åœºæ™¯ä¸­ä½¿ç”¨å¾—æ¯”è¾ƒå¤šã€‚","like_count":1},{"had_liked":false,"id":393350,"user_name":"å‹¤å°ç ","can_delete":false,"product_type":"c1","uid":1071860,"ip_address":"æ—¥æœ¬","ucode":"E9813F165F5EA5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKr3ZPRg8ECLpOkfpN1ny8HGV8DIkQ0fo4blKFSQgK0x76C5WiaxFXQpoIqTHWEV3bia603bBmtwZcg/132","comment_is_top":false,"comment_ctime":1723567625,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100617601,"comment_content":"2024&#47;8 ç›®å‰ä½¿ langchain==0.2.12ï¼Œè¿è¡Œæ–‡ä¸­ç¤ºä¾‹ä»£ç ä¼šæŠ›å¼‚å¸¸ã€‚å‚è€ƒå®˜æ–¹æ–‡æ¡£å‘ç°éœ€è¦ä¿®æ”¹ä¸¤å¤„å¯¼å…¥ï¼š\n\nfrom langchain_core.pydantic_v1 import BaseModel, Field\nfrom langchain.output_parsers import RetryOutputParser\n\nå…·ä½“å†…å®¹è§å®˜æ–¹How-toæ–‡æ¡£\nhttps:&#47;&#47;python.langchain.com&#47;v0.2&#47;docs&#47;how_to&#47;output_parser_retry&#47;\n\nlangchain ç›®å‰æ›´æ–°æ¯”è¾ƒå¿«ï¼Œå„ç§APIä¹Ÿä¸ç¨³å®šï¼Œå®¹æ˜“å‡ºç°å„ç§æ„æƒ³ä¸åˆ°çš„é—®é¢˜ã€‚æœ¬ç¤ºä¾‹å¼‚å¸¸åŸå› åç»­å†debugè¯¦ç»†çœ‹çœ‹ã€‚\n","like_count":0},{"had_liked":false,"id":392805,"user_name":"æ ¸æ¡ƒçˆ¸çˆ¸","can_delete":false,"product_type":"c1","uid":1269052,"ip_address":"é™•è¥¿","ucode":"EF5C6132724FB3","user_header":"https://static001.geekbang.org/account/avatar/00/13/5d/3c/2253daa8.jpg","comment_is_top":false,"comment_ctime":1721818955,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100617601,"comment_content":"2024å¹´7æœˆ24æ—¥ï¼Œæœ€æ–°ç‰ˆæœ¬çš„ langchain åº“æ— æ³•è¿è¡ŒæˆåŠŸ","like_count":0},{"had_liked":false,"id":392337,"user_name":"chenyang","can_delete":false,"product_type":"c1","uid":3692736,"ip_address":"ä¸Šæµ·","ucode":"3E56A8A605C619","user_header":"https://static001.geekbang.org/account/avatar/00/38/58/c0/d1d488b0.jpg","comment_is_top":false,"comment_ctime":1720625430,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100617601,"comment_content":"è€å¸ˆä½ å¥½ï¼Œ\n02_OutputFixParser.py å’Œ 03_RetryParser.py è¿è¡Œæ—¶ï¼Œéƒ½ä¼šæŠ¥\nKeyError: &quot;Input to PromptTemplate is missing variables {&#39;completion&#39;}.  Expected: [&#39;completion&#39;, &#39;error&#39;, &#39;instructions&#39;] Received: [&#39;instructions&#39;, &#39;input&#39;, &#39;error&#39;]&quot;\nè¯·é—®æ˜¯ä»€ä¹ˆåŸå› å‘€","like_count":0},{"had_liked":false,"id":391981,"user_name":"eagle","can_delete":false,"product_type":"c1","uid":1129632,"ip_address":"æ±Ÿè‹","ucode":"D7601A2AFC1D17","user_header":"https://static001.geekbang.org/account/avatar/00/11/3c/a0/8b9d5aca.jpg","comment_is_top":false,"comment_ctime":1719568416,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100617601,"comment_content":"å¯¹äºRetryWithErrorOutputParserï¼Œtemplate å˜é‡çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ ä¼¼ä¹æ²¡æœ‰è¢«å¼•ç”¨å•Šï¼Ÿ\n\ntemplate = &quot;&quot;&quot;Based on the user question, provide an Action and Action Input for what step should be taken.{format_instructions}Question: {query}Response:&quot;&quot;&quot;","like_count":0},{"had_liked":false,"id":388239,"user_name":"zhang","can_delete":false,"product_type":"c1","uid":1517047,"ip_address":"åŒ—äº¬","ucode":"650C292030057B","user_header":"https://static001.geekbang.org/account/avatar/00/17/25/f7/4cc60573.jpg","comment_is_top":false,"comment_ctime":1709694317,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100617601,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæˆ‘æ˜¯ä¸€ä¸ªä»äº‹äº†å‡ å¹´çš„Cè¯­è¨€å¼€å‘è€…ã€‚è®¡åˆ’åœ¨æœºå™¨å­¦ä¹ é¢†åŸŸæ‹“å±•æ‹“å±•ã€‚å¯æ˜¯æˆ‘çœ‹äº†LangChainçš„ä¸€äº›åŸºæœ¬ç†å¿µä¹‹åï¼Œä½¿ç”¨æç¤ºæ¨¡æ¿åœ¨æ€§èƒ½æ–¹é¢æ¯”ç›´æ¥ç”¨ä»£ç å¤„ç†å¼‚å¸¸å¼€é”€è¦å·®å¾ˆå¤šå§ã€‚\n\næ¯”å¦‚ä½œä¸ºä¸€ä¸ªserverå¯¹å¤–æä¾›æœåŠ¡çš„æ—¶å€™ï¼Œå®ƒçš„å»¶è¿Ÿã€å¹¶å‘æ•°ç­‰åˆè¯¥å¦‚ä½•è€ƒé‡å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":387160,"user_name":"Geek_a23cc7","can_delete":false,"product_type":"c1","uid":3819862,"ip_address":"é»‘é¾™æ±Ÿ","ucode":"70341CF4FDCD10","user_header":"","comment_is_top":false,"comment_ctime":1706593761,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100617601,"comment_content":"Traceback (most recent call last):\n  File &quot;E:\\Code-python\\langchain-main\\langchain-main\\07_è§£æè¾“å‡º\\01_Pydantic_Parser.py&quot;, line 71, in &lt;module&gt;\n    parsed_output = output_parser.parse(output)\n  File &quot;D:\\Anaconda\\envs\\python3.10\\lib\\site-packages\\langchain\\output_parsers\\pydantic.py&quot;, line 34, in parse\n    return self.pydantic_object.parse_obj(json_object)\n  File &quot;D:\\Anaconda\\envs\\python3.10\\lib\\site-packages\\typing_extensions.py&quot;, line 2499, in wrapper\n    return arg(*args, **kwargs)\n  File &quot;D:\\Anaconda\\envs\\python3.10\\lib\\site-packages\\pydantic\\main.py&quot;, line 1027, in parse_obj\n    return cls.model_validate(obj)\n  File &quot;D:\\Anaconda\\envs\\python3.10\\lib\\site-packages\\pydantic\\main.py&quot;, line 503, in model_validate\n    return cls.__pydantic_validator__.validate_python(\npydantic_core._pydantic_core.ValidationError: 4 validation errors for FlowerDescription\nflower_type\n  Field required [type=missing, input_value={&#39;properties&#39;: {&#39;flower_t...description&#39;, &#39;reason&#39;]}, input_type=dict]\n    For further information visit https:&#47;&#47;errors.pydantic.dev&#47;2.5&#47;v&#47;missing\nprice\n  Field required [type=missing, input_value={&#39;properties&#39;: {&#39;flower_t...description&#39;, &#39;reason&#39;]}, input_type=dict]\n    For further information visit https:&#47;&#47;errors.pydantic.dev&#47;2.5&#47;v&#47;missing\ndescription\n  Field required [type=missing, input_value={&#39;properties&#39;: {&#39;flower_t...description&#39;, &#39;reason&#39;]}, input_type=dict]\n    For further information visit https:&#47;&#47;errors.pydantic.dev&#47;2.5&#47;v&#47;missing\nreason\n  Field required [type=missing, input_value={&#39;properties&#39;: {&#39;flower_t...description&#39;, &#39;reason&#39;]}, input_type=dict]\n    For further information visit https:&#47;&#47;errors.pydantic.dev&#47;2.5&#47;v&#47;missing\né»„è€å¸ˆæ‚¨çœ‹ä¸€ä¸‹æˆ‘è¿™ä¸ªé—®é¢˜","like_count":0,"discussions":[{"author":{"id":1285971,"avatar":"https://static001.geekbang.org/account/avatar/00/13/9f/53/0979bba2.jpg","nickname":"HashMap","note":"","ucode":"078992C980734E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":637520,"discussion_content":"æˆ‘ä¹Ÿé‡åˆ°è¿‡ç±»ä¼¼çš„é—®é¢˜ï¼ŒåŸºæœ¬ä¸Šæ˜¯ChatGPTè¾“å‡ºçš„å†…å®¹æœ‰é—®é¢˜ï¼Œæ¯”å¦‚æˆ‘é‡åˆ°è¿‡ä¸‹é¢è¿™ç§ã€‚\n```\n{&#34;properties&#34;: {&#34;flower_type&#34;: {&#34;description&#34;: &#34;é²œèŠ±çš„ç§ç±»&#34;, &#34;title&#34;: &#34;Flower Type&#34;, &#34;type&#34;: &#34;string&#34;}, &#34;price&#34;: {&#34;description&#34;: &#34;é²œèŠ±çš„ä»·æ ¼&#34;, &#34;title&#34;: &#34;Price&#34;, &#34;type&#34;: &#34;integer&#34;}, &#34;description&#34;: {&#34;description&#34;: &#34;é²œèŠ±çš„æè¿°æ–‡æ¡ˆ&#34;, &#34;title&#34;: &#34;Description&#34;, &#34;type&#34;: &#34;string&#34;}, &#34;reason&#34;: {&#34;description&#34;: &#34;ä¸ºä»€ä¹ˆè¦å†™è¿™ä¸ªæ–‡æ¡ˆ&#34;, &#34;title&#34;: &#34;Reason&#34;, &#34;type&#34;: &#34;string&#34;}}, &#34;required&#34;: [&#34;flower_type&#34;, &#34;price&#34;, &#34;description&#34;, &#34;reason&#34;]}\n```\n\næ¢ä¸€ä¸ªAPI_KEYå¯èƒ½ä¼šæœ‰æ”¹å–„ï¼Œä½†æˆ‘ä¹Ÿé‡åˆ°è¿‡ï¼Œç«ç‘°å’Œç™¾åˆçš„ç»“æœéƒ½æ˜¯æ­£ç¡®çš„ï¼Œåº·ä¹ƒé¦¨çš„è¿”å›ç»“æ„ä¸æ­£ç¡®è¿™ç§å¥‡æ€ªçš„äº‹æƒ…ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1708586484,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}