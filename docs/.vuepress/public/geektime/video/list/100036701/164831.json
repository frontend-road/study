{"id":164831,"title":"34 | 完成一个客户端雏形","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geek_netty\">https://gitee.com/geektime-geekbang/geek_netty</a></p>","comments":[{"had_liked":false,"id":154597,"user_name":"苏帅","can_delete":false,"product_type":"c3","uid":1712081,"ip_address":"","ucode":"289585ACAC19DC","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKwKz6up5gdHNzfibmaXP2JjBjMaCC65iacH70YicYPBXwtPISYB7Alo9rEA2qmOC8SYrz9JlUjkpP9Q/132","comment_is_top":false,"comment_ctime":1574489368,"is_pvip":false,"replies":[{"id":59372,"content":"你第一步要把C服务器要求的传输数据结构搞清楚，然后就可以用netty写了，你先写一个简单的，能收发一个消息的，然后再考虑性能优化什么的，主要还是看你们的协议怎么定义，比如要求授权，那你发第一个消息估计就是授权了，还有可能要持续发keepalive什么的。所以先搞出最简单的，再想着丰富它。其实你这个应该不难，因为别人数据结构都给你定义好了，你就照着翻译应该就行了。","user_name":"作者回复","user_name_real":"Geek_9bc307","uid":1638649,"ctime":1574515350,"ip_address":"","comment_id":154597,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"老师，我们公司让我实现自定义协议的客户端，和服务端进行tcp通讯，服务器是C写的，让我用java写一个客户端，进行数据解析和传输，按照指定的数据格式能传输数据 ,没有什么思路 老师有什么建议吗？","like_count":5,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475518,"discussion_content":"你第一步要把C服务器要求的传输数据结构搞清楚，然后就可以用netty写了，你先写一个简单的，能收发一个消息的，然后再考虑性能优化什么的，主要还是看你们的协议怎么定义，比如要求授权，那你发第一个消息估计就是授权了，还有可能要持续发keepalive什么的。所以先搞出最简单的，再想着丰富它。其实你这个应该不难，因为别人数据结构都给你定义好了，你就照着翻译应该就行了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574515350,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":154009,"user_name":"Stephen","can_delete":false,"product_type":"c3","uid":1129549,"ip_address":"","ucode":"6210B499F0A8E5","user_header":"https://static001.geekbang.org/account/avatar/00/11/3c/4d/0db7b5dc.jpg","comment_is_top":false,"comment_ctime":1574346410,"is_pvip":false,"replies":[{"id":59382,"content":"后面也提到了，这个顺序问题确实挺重要的，handler就两个重要的点：（1）是否可共享；（2）位置放哪里。\n那简单说，读顺序自上而下，写顺序自下而上，业务处理在中间（谷底）：换个记法：左青龙，右白虎，老牛在中间，就像一个V。","user_name":"作者回复","user_name_real":"Geek_9bc307","uid":1638649,"ctime":1574518366,"ip_address":"","comment_id":154009,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"老师应该讲一下在pipeline里添加handler时的顺序问题。","like_count":5,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475351,"discussion_content":"后面也提到了，这个顺序问题确实挺重要的，handler就两个重要的点：（1）是否可共享；（2）位置放哪里。\n那简单说，读顺序自上而下，写顺序自下而上，业务处理在中间（谷底）：换个记法：左青龙，右白虎，老牛在中间，就像一个V。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574518366,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1442588,"avatar":"https://static001.geekbang.org/account/avatar/00/16/03/1c/c9fe6738.jpg","nickname":"Kvicii.Y","note":"","ucode":"446BFA633569EA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":237456,"discussion_content":"还是不太理解client和server的pipeline的addLast","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587143173,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1129549,"avatar":"https://static001.geekbang.org/account/avatar/00/11/3c/4d/0db7b5dc.jpg","nickname":"Stephen","note":"","ucode":"6210B499F0A8E5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":56867,"discussion_content":"今天刚追完，结合netty实战学习效果更棒","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574520706,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":166559,"user_name":"13501018051","can_delete":false,"product_type":"c3","uid":1218076,"ip_address":"","ucode":"D90E50B9C249AE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLOl1UYFpFtC1FCZOMsLjhxXfw5npovzFSIHKn8vz3tHRGrTIsEvVgqNOYNaKAPkRJ3gKw3HaPP9g/132","comment_is_top":false,"comment_ctime":1577499339,"is_pvip":false,"replies":[{"id":63636,"content":"future去获取结果的时候有带超时参数的方法，直接调用就可以了，很方便;\n还有一种做法是在add的地方，自己启动一个定时器，到了时间还没结果就去set这个future并从“中心”中移除走。","user_name":"作者回复","user_name_real":"stroller","uid":1638649,"ctime":1577525807,"ip_address":"","comment_id":166559,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"初次接触Netty，收益很多。 看到这里的时候逐渐有了感觉， 但是想了解下客户端如何来处理响应超时？OperationResultFuture 这里我们再Add的时候 设置 await时间可以吗？","like_count":3,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":479540,"discussion_content":"future去获取结果的时候有带超时参数的方法，直接调用就可以了，很方便;\n还有一种做法是在add的地方，自己启动一个定时器，到了时间还没结果就去set这个future并从“中心”中移除走。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577525807,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":151483,"user_name":"鱼向北游","can_delete":false,"product_type":"c3","uid":1439908,"ip_address":"","ucode":"580EC7DCE57E9A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/IPdZZXuHVMibwfZWmm7NiawzeEFGsaRoWjhuN99iaoj5amcRkiaOePo6rH1KJ3jictmNlic4OibkF4I20vOGfwDqcBxfA/132","comment_is_top":false,"comment_ctime":1573729432,"is_pvip":false,"replies":[{"id":58347,"content":"是的，编码就是：找找，抄抄，改改，有点时候虽然我们不喜欢这样，但是这样风险最小，排除抄错了，或者硬抄。","user_name":"作者回复","user_name_real":"Geek_9bc307","uid":1638649,"ctime":1573786211,"ip_address":"","comment_id":151483,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"打卡 优秀的代码和框架永远离不开复制和粘贴","like_count":1,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474491,"discussion_content":"是的，编码就是：找找，抄抄，改改，有点时候虽然我们不喜欢这样，但是这样风险最小，排除抄错了，或者硬抄。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573786211,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":159024,"user_name":"南秋同学","can_delete":false,"product_type":"c3","uid":1420957,"ip_address":"","ucode":"E1A08773B512DC","user_header":"https://static001.geekbang.org/account/avatar/00/15/ae/9d/791d0f5e.jpg","comment_is_top":false,"comment_ctime":1575516580,"is_pvip":false,"replies":[{"id":61849,"content":"1 当thread通过下面类似的方式设置成守护线程时：\nEventLoopGroup group = new NioEventLoopGroup(0, new DefaultThreadFactory(&quot;boss&quot;, true));\n加这样一句可以阻止客户端直接退出了。同时配合finally（执行关闭）可以实现优美的被动关闭。\n \n2 这2者区别不大，内部都是wait来等，区别在于一个有返回结果，一个无返回结果；\n","user_name":"作者回复","user_name_real":"stroller","uid":1638649,"ctime":1576566108,"ip_address":"","comment_id":159024,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"老师，您好！\n这句话不是很清晰，麻烦帮忙解答一下：\n为什么客户端建立连接之后需要调用channelFuture.channel().closeFuture().get();\n另外就是channelFuture.channel().closeFuture().get();和channelFuture.channel().closeFuture().sync();等的区别，非常感谢！","like_count":0,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476918,"discussion_content":"1 当thread通过下面类似的方式设置成守护线程时：\nEventLoopGroup group = new NioEventLoopGroup(0, new DefaultThreadFactory(&amp;quot;boss&amp;quot;, true));\n加这样一句可以阻止客户端直接退出了。同时配合finally（执行关闭）可以实现优美的被动关闭。\n \n2 这2者区别不大，内部都是wait来等，区别在于一个有返回结果，一个无返回结果；\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576566108,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":235756,"user_name":"Geek_d18bea","can_delete":false,"product_type":"c3","uid":2050473,"ip_address":"","ucode":"F8250913E5AD50","user_header":"https://static001.geekbang.org/account/avatar/00/1f/49/a9/d6ec336d.jpg","comment_is_top":false,"comment_ctime":1595172779,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"老师我想问一下 如果有多种参数类型 就多创建几个operation对象及对应的encoder和decoder然后放在client和service的pipeline中吗","like_count":0},{"had_liked":false,"id":193536,"user_name":"yang","can_delete":false,"product_type":"c3","uid":1074310,"ip_address":"","ucode":"1AA1497C5A293C","user_header":"https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg","comment_is_top":false,"comment_ctime":1584924719,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"netty真的好强大 好灵活","like_count":0}]}