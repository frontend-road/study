{"id":543993,"title":"02ï½œiOSå¹³å°éŸ³é¢‘æ¸²æŸ“ï¼ˆäºŒï¼‰ï¼šä½¿ç”¨ AudioUnit æ¸²æŸ“éŸ³é¢‘","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å±•æ™“å‡¯ã€‚</p><p>ä¸ŠèŠ‚è¯¾æˆ‘ä»¬å­¦ä¹ äº†iOSå¹³å°çš„éŸ³é¢‘æ¡†æ¶çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œæ·±å…¥äº†è§£äº†AVAudioSessionä»¥åŠAudioQueueçš„ä½¿ç”¨æ–¹æ³•ï¼ŒåŒæ—¶ä¹Ÿå­¦ä¹ äº†iOSéŸ³é¢‘æ ¼å¼çš„è¡¨ç¤ºæ–¹æ³•ï¼Œå°±æ˜¯ASBDã€‚å…¶ä¸­é‡ç‚¹å­¦ä¹ äº†AudioQueueæ¸²æŸ“éŸ³é¢‘çš„æ–¹æ³•ã€‚AudioQueueè¿™ä¸ªAPIå…¶å®æ˜¯ä»‹äºAVPlayer/AVAudioPlayerä¸Audio Unitä¹‹é—´çš„ä¸€ä¸ªéŸ³é¢‘æ¸²æŸ“æ¡†æ¶ã€‚å¦‚æœæˆ‘ä»¬æƒ³å¯¹éŸ³é¢‘æœ‰æ›´é«˜å±‚æ¬¡çš„æ§åˆ¶ï¼Œè€ŒAudioQueueæ»¡è¶³ä¸äº†æˆ‘ä»¬çš„å¼€å‘éœ€æ±‚çš„æ—¶å€™ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨å“ªä¸ªéŸ³é¢‘æ¡†æ¶å‘¢ï¼Ÿ</p><p><img src=\"https://static001.geekbang.org/resource/image/53/9a/5398e87e2955052a62f9dc5accc1b89a.png?wh=1744x704\" alt=\"å›¾ç‰‡\" title=\"å›¾1 iOSå¹³å°çš„éŸ³é¢‘æ¡†æ¶ï¼ˆå›¾ç‰‡æ¥è‡ªè‹¹æœå®˜ç½‘ï¼‰\"></p><p>æ²¡é”™ï¼Œå°±æ˜¯AudioUnitã€‚ä½œä¸ºiOSæœ€åº•å±‚çš„éŸ³é¢‘æ¡†æ¶ï¼ŒAudioUnitæ˜¯éŸ³è§†é¢‘å¼€å‘è€…å¿…é¡»è¦æŒæ¡çš„å†…å®¹ã€‚æˆ‘ä»¬åœ¨å¼€å‘éŸ³é¢‘ç›¸å…³äº§å“çš„æ—¶å€™ï¼Œå¦‚æœå¯¹éŸ³é¢‘æœ‰æ›´é«˜ç¨‹åº¦çš„æ§åˆ¶ã€æ€§èƒ½ä»¥åŠçµæ´»æ€§éœ€æ±‚ï¼Œæˆ–è€…æƒ³ä½¿ç”¨ä¸€äº›ç‰¹æ®ŠåŠŸèƒ½ï¼ˆæ¯”å¦‚å›å£°æ¶ˆé™¤ã€å®æ—¶è€³è¿”ï¼‰çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨AudioUnitè¿™ä¸€å±‚çš„APIï¼Œè¿™äº›æ¥å£æ˜¯é¢å‘Cè¯­è¨€çš„ã€‚</p><p>éšç€iOSçš„APIä¸æ–­å‡çº§ï¼ŒAudioUnitè¿˜é€æ¸æ¼”å˜å‡ºäº†AUGraphä¸AVAudioEngineæ¡†æ¶ï¼Œå®ƒä»¬å¯ä»¥ä¸ºä½ çš„Appèå…¥æ›´å¼ºå¤§çš„éŸ³é¢‘å¤šåª’ä½“èƒ½åŠ›ã€‚</p><p>æ­£å¦‚è‹¹æœå®˜æ–¹æ–‡æ¡£ä¸­æè¿°çš„ï¼ŒAudioUnitæä¾›äº†å¿«é€Ÿçš„éŸ³é¢‘æ¨¡å—åŒ–å¤„ç†åŠŸèƒ½ï¼Œå¦‚æœæ˜¯åœ¨ä»¥ä¸‹åœºæ™¯ä¸­ï¼Œæ›´é€‚åˆä½¿ç”¨AudioUnitï¼Œè€Œä¸æ˜¯é«˜å±‚æ¬¡çš„éŸ³é¢‘æ¡†æ¶ã€‚</p><!-- [[[read_end]]] --><ul>\n<li>åœ¨VOIPçš„åº”ç”¨åœºæ™¯ä¸‹ï¼Œæƒ³ä½¿ç”¨ä½å»¶è¿Ÿçš„éŸ³é¢‘I/Oï¼›</li>\n<li>åˆæˆå¤šè·¯å£°éŸ³å¹¶ä¸”å›æ”¾ï¼Œæ¯”å¦‚æ¸¸æˆæˆ–è€…éŸ³ä¹åˆæˆå™¨ï¼ˆå¼¹å”±ã€å¤šè½¨ä¹å™¨ï¼‰çš„åº”ç”¨ï¼›</li>\n<li>ä½¿ç”¨AudioUnité‡Œç‰¹æœ‰çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼šå‡è¡¡å™¨ã€å‹ç¼©å™¨ã€æ··å“å™¨ç­‰æ•ˆæœå™¨ï¼Œä»¥åŠå›å£°æ¶ˆé™¤ã€Mixä¸¤è½¨éŸ³é¢‘ç­‰ï¼›</li>\n<li>éœ€è¦å›¾çŠ¶ç»“æ„æ¥å¤„ç†éŸ³é¢‘æ—¶ï¼Œå¯ä»¥ä½¿ç”¨iOSæä¾›çš„AUGraphå’ŒAVAudioEngineçš„APIæ¥å£ï¼ŒæŠŠéŸ³é¢‘å¤„ç†æ¨¡å—ç»„è£…åˆ°çµæ´»çš„å›¾çŠ¶ç»“æ„ä¸­ã€‚</li>\n</ul><p>æ—¢ç„¶AudioUnitè¿™ä¹ˆå¼ºå¤§ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆå¥½å¥½åˆ©ç”¨å®ƒå‘¢ï¼Ÿä¸è¦æ€¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±ä¸€èµ·æ¥çœ‹ä¸€ä¸‹AudioUnitçš„ä½¿ç”¨æ–¹æ³•ã€‚</p><h2>AudioUnit</h2><p>è¿™éƒ¨åˆ†æˆ‘ä¼šä»åˆ†ç±»ã€åˆ›å»ºã€å‚æ•°è®¾ç½®ã€æ„å»ºå¤„ç†æ¡†æ¶å››ä¸ªæ–¹é¢æ¥è®²è§£ï¼Œæˆ‘ä»¬å…ˆçœ‹AudioUnitåˆ†ä¸ºå“ªå‡ ç±»ã€‚</p><h3>AudioUnitçš„åˆ†ç±»</h3><p>iOSæ ¹æ®AudioUnitçš„åŠŸèƒ½ä¸åŒï¼Œå°†AudioUnitåˆ†æˆäº†5å¤§ç±»ï¼Œäº†è§£AudioUnitçš„åˆ†ç±»å¯¹äºéŸ³é¢‘æ¸²æŸ“å’Œå¤„ç†æ˜¯éå¸¸é‡è¦çš„ã€‚è¿™é‡Œæˆ‘ä»¬ä¼šä»å…¨å±€è§†è§’æ¥è®¤è¯†ä¸€ä¸‹æ¯ä¸ªå¤§ç±»å‹ï¼ˆTypeï¼‰ä»¥åŠå¤§ç±»å‹ä¸‹é¢çš„å­ç±»å‹ï¼ˆSubTypeï¼‰ï¼Œå¹¶ä¸”è¿˜ä¼šä»‹ç»æ¯ä¸ªå¤§ç±»å‹ä¸‹é¢å­ç±»å‹AudioUnitçš„ç”¨é€”ï¼Œä»¥åŠå¯¹åº”å‚æ•°çš„æ„ä¹‰ã€‚</p><ol>\n<li><strong>Effect Unit</strong></li>\n</ol><p>ç¬¬ä¸€ä¸ªå¤§ç±»å‹æ˜¯kAudioUnitType_Effectï¼Œä¸»è¦æä¾›å£°éŸ³ç‰¹æ•ˆå¤„ç†çš„åŠŸèƒ½ã€‚å­ç±»å‹åŠç”¨é€”å¦‚ä¸‹ï¼š</p><ul>\n<li>å‡è¡¡æ•ˆæœå™¨ï¼šå­ç±»å‹æ˜¯kAudioUnitSubType_NBandEQï¼Œä¸»è¦ä½œç”¨æ˜¯ç»™å£°éŸ³çš„æŸä¸€äº›é¢‘å¸¦å¢å¼ºæˆ–è€…å‡å¼±èƒ½é‡ï¼Œè¿™ä¸ªæ•ˆæœå™¨éœ€è¦æŒ‡å®šå¤šä¸ªé¢‘å¸¦ï¼Œç„¶åä¸ºæ¯ä¸ªé¢‘å¸¦è®¾ç½®å®½åº¦ä»¥åŠå¢ç›Šï¼Œæœ€ç»ˆå°†æ”¹å˜å£°éŸ³åœ¨é¢‘åŸŸä¸Šçš„èƒ½é‡åˆ†å¸ƒã€‚</li>\n<li>å‹ç¼©æ•ˆæœå™¨ï¼šå­ç±»å‹æ˜¯kAudioUnitSubType_DynamicsProcessorï¼Œä¸»è¦ä½œç”¨æ˜¯å½“å£°éŸ³è¾ƒå°çš„æ—¶å€™å¯ä»¥æé«˜å£°éŸ³çš„èƒ½é‡ï¼Œå½“å£°éŸ³èƒ½é‡è¶…è¿‡äº†è®¾ç½®çš„é˜ˆå€¼ï¼Œå¯ä»¥é™ä½å£°éŸ³çš„èƒ½é‡ï¼Œå½“ç„¶æˆ‘ä»¬è¦è®¾ç½®åˆé€‚çš„ä½œç”¨æ—¶é—´å’Œé‡Šæ”¾æ—¶é—´ä»¥åŠè§¦å‘å€¼ï¼Œæœ€ç»ˆå¯ä»¥å°†å£°éŸ³åœ¨æ—¶åŸŸä¸Šçš„èƒ½é‡å‹ç¼©åˆ°ä¸€å®šèŒƒå›´ä¹‹å†…ã€‚</li>\n<li>æ··å“æ•ˆæœå™¨ï¼šå­ç±»å‹æ˜¯kAudioUnitSubType_Reverb2ï¼Œæ˜¯å¯¹äººå£°å¤„ç†éå¸¸é‡è¦çš„æ•ˆæœå™¨ï¼Œå¯ä»¥æƒ³è±¡æˆ‘ä»¬åœ¨ä¸€ä¸ªç©ºæˆ¿å­ä¸­ï¼Œæœ‰éå¸¸å¤šçš„åå°„å£°å’ŒåŸå§‹å£°éŸ³å åŠ åœ¨ä¸€èµ·ï¼Œå¯èƒ½ä»å¬æ„Ÿä¸Šä¼šæ›´æœ‰éœ‡æ’¼åŠ›ï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿä¼šä½¿åŸå§‹å£°éŸ³æ›´åŠ æ¨¡ç³Šï¼Œé®ç›–æ‰åŸå§‹å£°éŸ³çš„ä¸€äº›ç»†èŠ‚ï¼Œæ‰€ä»¥æ··å“è®¾ç½®å¾—å¤§æˆ–å°å¯¹ä¸åŒçš„äººæ¥è®²éå¸¸ä¸ä¸€è‡´ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„å–œå¥½æ¥è®¾ç½®ã€‚</li>\n</ul><p>Effect Unitä¸‹æœ€å¸¸ä½¿ç”¨çš„å°±æ˜¯è¿™ä¸‰ç§æ•ˆæœå™¨ï¼Œå½“ç„¶è¿™ä¸ªå¤§ç±»å‹ä¸‹é¢è¿˜æœ‰å¾ˆå¤šç§å­ç±»å‹çš„æ•ˆæœå™¨ï¼Œåƒé«˜é€šï¼ˆHigh Passï¼‰ã€ä½é€šï¼ˆLow Passï¼‰ã€å¸¦é€šï¼ˆBand Passï¼‰ã€å»¶è¿Ÿï¼ˆDelayï¼‰ã€å‹é™ï¼ˆLimiterï¼‰ç­‰æ•ˆæœå™¨ï¼Œä½ å¯ä»¥è‡ªå·±ä½¿ç”¨ä¸€ä¸‹ï¼Œæ„Ÿå—ä¸€ä¸‹æ•ˆæœã€‚</p><ol start=\"2\">\n<li><strong>Mixer Units</strong></li>\n</ol><p>ç¬¬äºŒä¸ªå¤§ç±»å‹æ˜¯kAudioUnitType_Mixerï¼Œä¸»è¦æä¾›Mixå¤šè·¯å£°éŸ³çš„åŠŸèƒ½ã€‚å­ç±»å‹åŠç”¨é€”å¦‚ä¸‹ã€‚</p><ul>\n<li>3D Mixerï¼šè¿™ä¸ªæ•ˆæœå™¨åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæ— æ³•ä½¿ç”¨ï¼Œåªèƒ½åœ¨OS Xä¸Šä½¿ç”¨ï¼Œæ‰€ä»¥è¿™é‡Œä¸ä»‹ç»äº†ã€‚</li>\n<li>MultiChannelMixerï¼šå­ç±»å‹æ˜¯kAudioUnitSubType_MultiChannelMixerï¼Œè¿™ä¸ªæ•ˆæœå™¨æ˜¯æˆ‘ä»¬é‡ç‚¹ä»‹ç»çš„å¯¹è±¡ï¼Œ<strong>å®ƒæ˜¯å¤šè·¯å£°éŸ³æ··éŸ³çš„æ•ˆæœå™¨ï¼Œå¯ä»¥æ¥æ”¶å¤šè·¯éŸ³é¢‘çš„è¾“å…¥ï¼Œè¿˜å¯ä»¥åˆ†åˆ«è°ƒæ•´æ¯ä¸€è·¯éŸ³é¢‘çš„å¢ç›Šä¸å¼€å…³ï¼Œå¹¶å°†å¤šè·¯éŸ³é¢‘åˆå¹¶æˆä¸€è·¯</strong>ï¼Œè¿™ä¸ªæ•ˆæœå™¨åœ¨å¤„ç†éŸ³é¢‘çš„å›¾çŠ¶ç»“æ„ä¸­éå¸¸æœ‰ç”¨ã€‚</li>\n</ul><ol start=\"3\">\n<li><strong>I/O Units</strong></li>\n</ol><p>ç¬¬ä¸‰ä¸ªå¤§ç±»å‹æ˜¯kAudioUnitType_Outputï¼Œå®ƒçš„ç”¨é€”å°±åƒå®ƒåˆ†ç±»çš„åå­—ä¸€æ ·ï¼Œä¸»è¦æä¾›çš„å°±æ˜¯I/OåŠŸèƒ½ã€‚å­ç±»å‹åŠç”¨é€”å¦‚ä¸‹ï¼š</p><ul>\n<li>RemoteIOï¼šå­ç±»å‹æ˜¯kAudioUnitSubType_RemoteIOï¼Œä»åå­—ä¸Šä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œè¿™æ˜¯ç”¨æ¥é‡‡é›†éŸ³é¢‘ä¸æ’­æ”¾éŸ³é¢‘çš„ï¼Œå½“å¼€å‘è€…åœ¨åº”ç”¨åœºæ™¯ä¸­è¦ä½¿ç”¨éº¦å…‹é£åŠæ‰¬å£°å™¨çš„æ—¶å€™ï¼Œéƒ½ä¼šç”¨åˆ°è¿™ä¸ªAudioUnitã€‚</li>\n<li>Generic Outputï¼šå­ç±»å‹æ˜¯kAudioUnitSubType_GenericOutputï¼Œå½“å¼€å‘è€…éœ€è¦ç¦»çº¿å¤„ç†ï¼Œæˆ–è€…è¯´åœ¨AUGraphä¸­ä¸ä½¿ç”¨Speakerï¼ˆæ‰¬å£°å™¨ï¼‰æ¥é©±åŠ¨æ•´ä¸ªæ•°æ®æµï¼Œè€Œæ˜¯å¸Œæœ›ä½¿ç”¨ä¸€ä¸ªè¾“å‡ºï¼ˆå¯ä»¥æ”¾å…¥å†…å­˜é˜Ÿåˆ—æˆ–è€…è¿›è¡Œç£ç›˜I/Oæ“ä½œï¼‰æ¥é©±åŠ¨æ•°æ®æµçš„è¯ï¼Œå°±ä½¿ç”¨è¿™ä¸ªå­ç±»å‹ã€‚</li>\n</ul><ol start=\"4\">\n<li><strong>Format Converter Units</strong></li>\n</ol><p>ç¬¬å››ä¸ªå¤§ç±»å‹æ˜¯kAudioUnitType_FormatConverterï¼Œæä¾›æ ¼å¼è½¬æ¢çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼šé‡‡æ ·æ ¼å¼ç”±Floatåˆ°SInt16çš„è½¬æ¢ã€äº¤é”™å’Œå¹³é“ºçš„æ ¼å¼è½¬æ¢ã€å•åŒå£°é“çš„è½¬æ¢ç­‰ï¼Œå­ç±»å‹åŠç”¨é€”è¯´æ˜å¦‚ä¸‹ã€‚</p><ul>\n<li>AUConverterï¼šå­ç±»å‹æ˜¯kAudioUnitSubType_AUConverterï¼Œè¿™æ˜¯æˆ‘ä»¬è¦é‡ç‚¹ä»‹ç»çš„æ ¼å¼è½¬æ¢æ•ˆæœå™¨ï¼ŒæŸäº›æ•ˆæœå™¨å¯¹è¾“å…¥çš„éŸ³é¢‘æ ¼å¼æœ‰æ˜ç¡®è¦æ±‚ï¼Œæ¯”å¦‚3D Mixer Unitå°±å¿…é¡»ä½¿ç”¨UInt16æ ¼å¼çš„sampleï¼Œæˆ–è€…å¼€å‘è€…å°†éŸ³é¢‘æ•°æ®åç»­äº¤ç»™ä¸€äº›å…¶ä»–ç¼–ç å™¨å¤„ç†ï¼Œåˆæˆ–è€…å¼€å‘è€…æƒ³ä½¿ç”¨SInt16æ ¼å¼çš„PCMè£¸æ•°æ®è¿›è¡Œå…¶ä»–CPUä¸ŠéŸ³é¢‘ç®—æ³•è®¡ç®—ç­‰åœºæ™¯ä¸‹ï¼Œå°±éœ€è¦ç”¨åˆ°è¿™ä¸ªConverterNodeã€‚</li>\n</ul><p>æ¯”è¾ƒå…¸å‹çš„åœºæ™¯æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ä¸€ä¸ªéŸ³é¢‘æ’­æ”¾å™¨ï¼Œç”±FFmpegè§£ç å‡ºæ¥çš„PCMæ•°æ®æ˜¯SInt16æ ¼å¼è¡¨ç¤ºçš„ï¼Œæˆ‘ä»¬ä¸å¯ä»¥ç›´æ¥è®©RemoteIO Unitæ’­æ”¾ï¼Œè€Œæ˜¯éœ€è¦æ„å»ºä¸€ä¸ªConvertNodeï¼Œå°†SInt16æ ¼å¼è¡¨ç¤ºçš„æ•°æ®è½¬æ¢ä¸ºFloat32è¡¨ç¤ºçš„æ•°æ®ï¼Œç„¶åå†ç»™åˆ°RemoteIO Unitï¼Œæœ€ç»ˆæ‰èƒ½æ­£å¸¸æ’­æ”¾å‡ºæ¥ã€‚</p><ul>\n<li>Time Pitchï¼šå­ç±»å‹æ˜¯kAudioUnitSubType_NewTimePitchï¼Œå³å˜é€Ÿå˜è°ƒæ•ˆæœå™¨ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ„æ€çš„æ•ˆæœå™¨ï¼Œå¯ä»¥å¯¹å£°éŸ³çš„éŸ³é«˜ã€é€Ÿåº¦è¿›è¡Œæ›´æ”¹ï¼ŒåƒTomçŒ«è¿™æ ·çš„åº”ç”¨åœºæ™¯å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ•ˆæœå™¨æ¥å®ç°ã€‚</li>\n</ul><ol start=\"5\">\n<li><strong>Generator Units</strong></li>\n</ol><p>ç¬¬äº”ä¸ªå¤§ç±»å‹æ˜¯kAudioUnitType_Generatorï¼Œåœ¨å¼€å‘ä¸­æˆ‘ä»¬ç»å¸¸ç”¨å®ƒæ¥æä¾›æ’­æ”¾å™¨çš„åŠŸèƒ½ã€‚å­ç±»å‹åŠç”¨é€”è¯´æ˜å¦‚ä¸‹ã€‚</p><ul>\n<li>AudioFilePlayerï¼šå­ç±»å‹æ˜¯kAudioUnitSubType_AudioFilePlayerï¼Œåœ¨AudioUnité‡Œé¢ï¼Œå¦‚æœæˆ‘ä»¬çš„è¾“å…¥ä¸æ˜¯éº¦å…‹é£ï¼Œè€Œæ˜¯ä¸€ä¸ªåª’ä½“æ–‡ä»¶ï¼Œè¦æ€ä¹ˆåŠå‘¢ï¼Ÿå½“ç„¶ä¹Ÿå¯ä»¥è‡ªå·±è¿›è¡Œè§£ç ï¼Œé€šè¿‡è½¬æ¢ä¹‹åç»™RemoteIO Unitæ’­æ”¾å‡ºæ¥ã€‚ä½†å…¶å®è¿˜æœ‰ä¸€ç§æ›´åŠ ç®€å•ã€æ–¹ä¾¿çš„æ–¹å¼ï¼Œé‚£å°±æ˜¯ä½¿ç”¨AudioFilePlayerè¿™ä¸ªAudioUnitï¼Œå…¶å®æ•°æ®æºè¿˜æ˜¯ä¼šè°ƒç”¨AudioFileé‡Œé¢çš„è§£ç åŠŸèƒ½ï¼Œå°†åª’ä½“æ–‡ä»¶ä¸­çš„å‹ç¼©æ•°æ®è§£å‹æˆä¸ºPCMè£¸æ•°æ®ï¼Œæœ€ç»ˆå†äº¤ç»™AudioFilePlayer Unitè¿›è¡Œåç»­å¤„ç†ã€‚</li>\n</ul><p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œ<strong>æˆ‘ä»¬å¿…é¡»åœ¨AUGraphåˆå§‹åŒ–äº†ä¹‹åï¼Œå†å»é…ç½®AudioFilePlayerçš„æ•°æ®æºä»¥åŠæ’­æ”¾èŒƒå›´ç­‰å±æ€§ï¼Œå¦åˆ™ä¼šå‡ºç°é”™è¯¯ã€‚</strong></p><h3>åˆ›å»ºAudioUnit</h3><p>æ„å»ºAudioUnitæ—¶ï¼Œéœ€è¦æŒ‡å®šç±»å‹ï¼ˆTypeï¼‰ã€å­ç±»å‹ï¼ˆSubtypeï¼‰ä»¥åŠå‚å•†ï¼ˆManufactureï¼‰ã€‚</p><p>ç±»å‹å°±æ˜¯åˆšåˆšæˆ‘ä»¬è®²åˆ°çš„å‡ ä¸ªå¤§ç±»å‹ï¼›è€Œå­ç±»å‹æ˜¯è¿™ä¸ªå¤§ç±»å‹ä¸‹é¢çš„å°ç±»å‹ï¼Œæ¯”å¦‚Effectè¿™ä¸ªå¤§ç±»å‹ä¸‹é¢æœ‰EQã€Compressorã€limiterç­‰å­ç±»å‹ï¼›å‚å•†ä¸€èˆ¬æƒ…å†µä¸‹æ¯”è¾ƒå›ºå®šï¼Œç›´æ¥å†™æˆkAudioUnitManufacturer_Appleå°±å¥½äº†ã€‚</p><p>åˆ©ç”¨ä»¥ä¸Šè¿™ä¸‰ä¸ªå˜é‡ï¼Œå¼€å‘è€…å°±å¯ä»¥å®Œæ•´æè¿°å‡ºä¸€ä¸ªAudioUnitäº†ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„ä»£ç åˆ›å»ºä¸€ä¸ªRemoteIOç±»å‹çš„AudioUnitçš„æè¿°ã€‚</p><pre><code class=\"language-plain\">AudioComponentDescription&nbsp;ioUnitDescription;\nioUnitDescription.componentType&nbsp;= kAudioUnitType_Output;\nioUnitDescription.componentSubType&nbsp;= kAudioUnitSubType_RemoteIO;\nioUnitDescription.componentManufacturer=kAudioUnitManufacturer_Apple;\nioUnitDescription.componentFlags&nbsp;= 0;\nioUnitDescription.componentFlagsMask&nbsp;= 0;\n</code></pre><p>ä¸Šè¿°ä»£ç æ„é€ äº†RemoteIOè¿™ä¸ªAudioUnitæè¿°çš„ç»“æ„ä½“ï¼Œé‚£å¦‚ä½•å†ä½¿ç”¨è¿™ä¸ªæè¿°æ¥æ„é€ çœŸæ­£çš„AudioUnitå‘¢ï¼Ÿæœ‰ä¸¤ç§æ–¹å¼ï¼šç¬¬ä¸€ç§æ–¹å¼æ˜¯ç›´æ¥ä½¿ç”¨AudioUnitè£¸çš„åˆ›å»ºæ–¹å¼ï¼›ç¬¬äºŒç§æ–¹å¼åˆ™æ˜¯ä½¿ç”¨AUGraphå’ŒAUNodeï¼ˆå…¶å®ä¸€ä¸ªAUNodeå°±æ˜¯å¯¹AudioUnitçš„å°è£…ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªAudioUnitçš„Wrapperï¼‰æ–¹å¼æ¥æ„å»ºã€‚ä¸‹é¢æˆ‘æ¥ä»‹ç»ä¸€ä¸‹è¿™ä¸¤ç§æ–¹å¼ã€‚</p><ol>\n<li><strong>è£¸åˆ›å»ºæ–¹å¼</strong></li>\n</ol><p>é¦–å…ˆæ ¹æ®AudioUnitæè¿°ï¼Œæ‰¾å‡ºå®é™…çš„AudioUnitç±»å‹ï¼š</p><pre><code class=\"language-plain\">AudioComponent&nbsp;ioUnitRef = AudioComponentFindNext(NULL,&nbsp;&amp;ioUnitDescription);\n</code></pre><p>ç„¶åå£°æ˜ä¸€ä¸ªAudioUnitå¼•ç”¨ï¼š</p><pre><code class=\"language-plain\">AudioUnit&nbsp;ioUnitInstance;\n</code></pre><p>æœ€åæ ¹æ®ç±»å‹åˆ›å»ºå‡ºè¿™ä¸ªAudioUnitå®ä¾‹ï¼š</p><pre><code class=\"language-plain\">AudioComponentInstanceNew(ioUnitRef,&nbsp;&amp;ioUnitInstance);\n</code></pre><ol start=\"2\">\n<li><strong>AUGraphåˆ›å»ºæ–¹å¼</strong></li>\n</ol><p>é¦–å…ˆå£°æ˜å¹¶ä¸”å®ä¾‹åŒ–ä¸€ä¸ªAUGraphï¼š</p><pre><code class=\"language-plain\">AUGraph&nbsp;processingGraph;\nNewAUGraph(&amp;processingGraph);\n</code></pre><p>ç„¶ååˆ©ç”¨AudioUnitçš„æè¿°åœ¨AUGraphä¸­æŒ‰ç…§æè¿°å¢åŠ ä¸€ä¸ªAUNodeï¼š</p><pre><code class=\"language-plain\">AUNode&nbsp;ioNode;\nAUGraphAddNode(processingGraph,&nbsp;&amp;ioUnitDescription,&nbsp;&amp;ioNode);\n</code></pre><p>æ¥ä¸‹æ¥æ‰“å¼€AUGraphï¼Œå…¶å®æ‰“å¼€AUGraphçš„è¿‡ç¨‹ä¹Ÿæ˜¯é—´æ¥å®ä¾‹åŒ–AUGraphä¸­æ‰€æœ‰çš„AUNodeçš„è¿‡ç¨‹ã€‚<strong>æ³¨æ„ï¼Œå¿…é¡»åœ¨è·å–AudioUnitä¹‹å‰æ‰“å¼€æ•´ä¸ªGraph</strong>ï¼Œå¦åˆ™æˆ‘ä»¬ä¸èƒ½ä»å¯¹åº”çš„AUNodeé‡Œé¢è·å–åˆ°æ­£ç¡®çš„AudioUnitã€‚</p><pre><code class=\"language-plain\">AUGraphOpen(processingGraph);\n</code></pre><p>æœ€ååœ¨AUGraphä¸­çš„æŸä¸ªNodeé‡Œé¢è·å¾—AudioUnitçš„å¼•ç”¨ï¼š</p><pre><code class=\"language-plain\">AudioUnit&nbsp;ioUnit;\nAUGraphNodeInfo(processingGraph,&nbsp;ioNode, NULL,&nbsp;&amp;ioUnit);\n</code></pre><p>æ— è®ºä½¿ç”¨ä¸Šé¢çš„å“ªä¸€ç§æ–¹å¼ï¼Œéƒ½å¯ä»¥åˆ›å»ºå‡ºæˆ‘ä»¬æƒ³è¦çš„AudioUnitï¼Œè€Œå…·ä½“åº”è¯¥ä½¿ç”¨å“ªä¸€ç§æ–¹å¼ï¼Œå…¶å®è¿˜æ˜¯åº”è¯¥æ ¹æ®å®é™…çš„åº”ç”¨åœºæ™¯æ¥å†³å®šã€‚ç»“åˆæˆ‘çš„å®é™…å·¥ä½œç»éªŒï¼Œæˆ‘è®¤ä¸º<strong>ä½¿ç”¨AUGraphçš„ç»“æ„å¯ä»¥åœ¨æˆ‘ä»¬çš„åº”ç”¨ä¸­æ­å»ºå‡ºæ‰©å±•æ€§æ›´é«˜çš„ç³»ç»Ÿ</strong>ï¼Œæ‰€ä»¥æˆ‘æ¨èä½ ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ï¼Œæˆ‘ä»¬æ•´ä¸ªéŸ³é¢‘å¤„ç†ç³»ç»Ÿå°±æ˜¯ä½¿ç”¨çš„ç¬¬äºŒç§æ–¹å¼æ¥æ­å»ºçš„ã€‚</p><p></p><h3>RemoteIOè¯¦è§£</h3><p>AudioUnitåˆ›å»ºå¥½ä¹‹åï¼Œå°±åº”è¯¥å¯¹å…¶è¿›è¡Œé…ç½®å’Œä½¿ç”¨äº†ï¼Œå› ä¸ºæˆ‘ä»¬åé¢çš„æ’­æ”¾å™¨é¡¹ç›®ä¼šç”¨åˆ°RemoteIO Unitï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæˆ‘å°±ä»¥RemoteIOè¿™ä¸ªAudioUnitä¸ºä¾‹ï¼Œè¯¦ç»†è®²è§£AudioUnitçš„ä½¿ç”¨ã€‚</p><p>RemoteIOè¿™ä¸ªAudioUnitæ˜¯ä¸ç¡¬ä»¶IOç›¸å…³çš„ä¸€ä¸ªUnitï¼Œå®ƒå¯ä»¥æ§åˆ¶ç¡¬ä»¶è®¾å¤‡çš„è¾“å…¥å’Œè¾“å‡ºï¼ˆIä»£è¡¨Inputï¼ŒOä»£è¡¨Outputï¼‰ã€‚è¾“å…¥ç«¯æ˜¯éº¦å…‹é£ï¼ˆæœºèº«éº¦å…‹é£æˆ–è€…è“ç‰™è€³æœºéº¦å…‹é£ï¼‰ï¼Œè¾“å‡ºç«¯çš„è¯å¯èƒ½æ˜¯æ‰¬å£°å™¨ï¼ˆSpeakerï¼‰æˆ–è€…è€³æœºã€‚å¦‚æœè¦åŒæ—¶ä½¿ç”¨è¾“å…¥è¾“å‡ºï¼Œå³Kæ­Œåº”ç”¨ä¸­çš„è€³è¿”åŠŸèƒ½ï¼ˆç”¨æˆ·åœ¨å”±æ­Œæˆ–è€…è¯´è¯çš„åŒæ—¶ï¼Œè€³æœºä¸­ä¼šå°†éº¦å…‹é£æ”¶å½•çš„å£°éŸ³æ’­æ”¾å‡ºæ¥ï¼Œè®©ç”¨æˆ·è‡ªå·±èƒ½å¬åˆ°è‡ªå·±çš„å£°éŸ³ï¼‰ï¼Œéœ€è¦å¼€å‘è€…å°†å®ƒä»¬è¿æ¥èµ·æ¥ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/16/1c/16287030b548e0600f7e5fcd4d611f1c.jpg?wh=1920x1063\" alt=\"å›¾ç‰‡\" title=\"å›¾2 RemoteIO\"></p><p>å¦‚å›¾æ‰€ç¤ºï¼ŒRemoteIO Unitåˆ†ä¸ºElement0å’ŒElement1ï¼Œå…¶ä¸­Element0æ§åˆ¶è¾“å‡ºç«¯ï¼ŒElement1æ§åˆ¶è¾“å…¥ç«¯ï¼ŒåŒæ—¶æ¯ä¸ªElementåˆåˆ†ä¸ºInput Scopeå’ŒOutput Scopeã€‚å¦‚æœå¼€å‘è€…æƒ³è¦ä½¿ç”¨æ‰¬å£°å™¨çš„æ’­æ”¾å£°éŸ³åŠŸèƒ½ï¼Œé‚£ä¹ˆå¿…é¡»å°†è¿™ä¸ªUnitçš„Element0çš„OutputScopeå’ŒSpeakerè¿›è¡Œè¿æ¥ã€‚è€Œå¦‚æœå¼€å‘è€…æƒ³è¦ä½¿ç”¨éº¦å…‹é£çš„å½•éŸ³åŠŸèƒ½ï¼Œé‚£ä¹ˆå¿…é¡»å°†è¿™ä¸ªUnitçš„Element1çš„InputScopeå’Œéº¦å…‹é£è¿›è¡Œè¿æ¥ã€‚ä½¿ç”¨æ‰¬å£°å™¨çš„ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">OSStatus status = noErr;\nUInt32 oneFlag = 1;\nUInt32 busZero = 0;//Element 0\nstatus = AudioUnitSetProperty(remoteIOUnit,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; kAudioOutputUnitProperty_EnableIO,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; kAudioUnitScope_Output,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; busZero,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;oneFlag,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sizeof(oneFlag));\nCheckStatus(status, @\"Could not Connect To Speaker\", YES);\n</code></pre><p>ä¸Šé¢è¿™æ®µä»£ç å°±æ˜¯æŠŠRemoteIO Unitä¸­Element0çš„OutputScopeè¿æ¥åˆ°Speakerä¸Šï¼Œè¿æ¥è¿‡ç¨‹ä¼šè¿”å›ä¸€ä¸ªOSStatusç±»å‹çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„CheckErrorå‡½æ•°æ¥åˆ¤æ–­é”™è¯¯å¹¶ä¸”æ‰“å°Could not Connect To Speakeræç¤ºã€‚å…·ä½“çš„CheckErrorå‡½æ•°å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">static void CheckStatus(OSStatus status, NSString *message, BOOL fatal)\n{\n&nbsp;&nbsp;&nbsp; if(status != noErr)\n&nbsp;&nbsp;&nbsp; {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; char fourCC[16];\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *(UInt32 *)fourCC = CFSwapInt32HostToBig(status);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fourCC[4] = '\\0';\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(isprint(fourCC[0]) &amp;&amp; isprint(fourCC[1]) &amp;&amp; isprint(fourCC[2]) &amp;&amp;\nisprint(fourCC[3]))\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NSLog(@\"%@: %s\", message, fourCC);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NSLog(@\"%@: %d\", message, (int)status);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(fatal)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exit(-1);\n&nbsp;&nbsp;&nbsp; }\n</code></pre><p>è¿æ¥æˆåŠŸä¹‹åï¼Œå°±åº”è¯¥ç»™AudioUnitè®¾ç½®æ•°æ®æ ¼å¼ï¼ˆASBDï¼‰äº†ï¼ŒASBDæˆ‘ä»¬åœ¨å‰é¢å·²ç»è¯¦ç»†è®²è¿‡äº†ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚æ„é€ å¥½åˆé€‚çš„ASBDç»“æ„ä½“ï¼Œæœ€ç»ˆè®¾ç½®ç»™AudioUnitå¯¹åº”çš„Scopeï¼ˆInput/Outputï¼‰ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">AudioUnitSetProperty(&nbsp;remoteIOUnit,kAudioUnitProperty_StreamFormat,&nbsp;\nkAudioUnitScope_Output, 1,&nbsp;&amp;asbd, sizeof(asbd));\n</code></pre><p>æ’­æ”¾äº†è§£æ¸…æ¥šäº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·çœ‹ä¸‹å¦‚ä½•æ§åˆ¶è¾“å…¥ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®é™…çš„åœºæ™¯æ¥å­¦ä¹ è¿™éƒ¨åˆ†çš„å†…å®¹ã€‚åœ¨Kæ­Œåº”ç”¨çš„åœºæ™¯ä¸­ï¼Œä¼šé‡‡é›†åˆ°ç”¨æˆ·çš„äººå£°å¤„ç†ä¹‹åä¸”ç«‹å³ç»™ç”¨æˆ·ä¸€ä¸ªè€³è¿”ï¼ˆå°†å£°éŸ³åœ¨50msä¹‹å†…è¾“å‡ºåˆ°è€³æœºä¸­ï¼Œè®©ç”¨æˆ·å¯ä»¥å¬åˆ°ï¼‰ï¼Œé‚£ä¹ˆå¦‚ä½•è®©RemoteIO Unitåˆ©ç”¨éº¦å…‹é£é‡‡é›†å‡ºæ¥çš„å£°éŸ³ï¼Œç»è¿‡ä¸­é—´æ•ˆæœå™¨å¤„ç†ï¼Œæœ€ç»ˆè¾“å‡ºåˆ°Speakerä¸­æ’­æ”¾ç»™ç”¨æˆ·å‘¢ï¼Ÿ</p><p>è¿™é‡Œæˆ‘æ¥ä»‹ç»ä¸€ä¸‹ï¼Œå¦‚ä½•ä»¥AUGraphçš„æ–¹å¼å°†å£°éŸ³é‡‡é›†ã€å¤„ç†ä»¥åŠå£°éŸ³è¾“å‡ºçš„æ•´ä¸ªè¿‡ç¨‹ç®¡ç†èµ·æ¥ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f4/d9/f435eb739f6eec3039e6ebbe1180afd9.jpg?wh=1920x1096\" alt=\"å›¾ç‰‡\" title=\"å›¾3 é‡‡é›†ã€å¤„ç†åŠè¾“å‡ºå£°éŸ³çš„è¿‡ç¨‹\"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œé¦–å…ˆè¦çŸ¥é“æ•°æ®å¯ä»¥ä»é€šé“ä¸­ä¼ é€’æ˜¯ç”±æœ€å³ç«¯Speakerï¼ˆRemoteIO Unitï¼‰æ¥é©±åŠ¨çš„ï¼Œå®ƒä¼šå‘å®ƒçš„å‰ä¸€çº§AUNodeå»è¦æ•°æ®ï¼ˆå›¾ä¸­åºå·1ï¼‰ï¼Œç„¶åå®ƒçš„å‰ä¸€çº§ä¼šç»§ç»­å‘ä¸Šä¸€çº§èŠ‚ç‚¹è¦æ•°æ®ï¼ˆå›¾ä¸­åºå·2ï¼‰ï¼Œæœ€ç»ˆä¼šä»æˆ‘ä»¬çš„RemoteIO Unitçš„Element1ï¼ˆå³éº¦å…‹é£ï¼‰ä¸­å–å¾—æ•°æ®ï¼Œè¿™æ ·å°±å¯ä»¥å°†æ•°æ®æŒ‰ç…§ç›¸åçš„æ–¹å‘ä¸€çº§ä¸€çº§åœ°ä¼ é€’ä¸‹å»ï¼ˆå›¾ä¸­åºå·4ã€5ï¼‰ï¼Œæœ€ç»ˆä¼ é€’åˆ°RemoteIOUnitçš„Element0ï¼ˆå³Speakerï¼Œå›¾ä¸­åºå·6ï¼‰å°±å¯ä»¥è®©ç”¨æˆ·å¬åˆ°äº†ã€‚</p><p>å½“ç„¶è¿™æ—¶å€™ä½ å¯èƒ½ä¼šæƒ³ç¦»çº¿å¤„ç†çš„æ—¶å€™æ˜¯ä¸èƒ½æ’­æ”¾å‡ºæ¥çš„ï¼Œé‚£ä¹ˆåº”è¯¥ç”±è°æ¥è¿›è¡Œé©±åŠ¨å‘¢ï¼Ÿå…¶å®åœ¨ç¦»çº¿å¤„ç†çš„æ—¶å€™ï¼Œåº”è¯¥ä½¿ç”¨Mixer Unitè¿™ä¸ªå¤§ç±»å‹ä¸‹é¢çš„å­ç±»å‹ä¸ºGeneric Outputçš„AudioUnitæ¥åšé©±åŠ¨ç«¯ã€‚é‚£ä¹ˆè¿™äº›AudioUnitæˆ–è€…è¯´AUNodeæ˜¯å¦‚ä½•è¿›è¡Œè¿æ¥çš„å‘¢ï¼Ÿæœ‰ä¸¤ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§æ–¹å¼æ˜¯ç›´æ¥å°†AUNodeè¿æ¥èµ·æ¥ï¼›ç¬¬äºŒç§æ–¹å¼æ˜¯é€šè¿‡å›è°ƒæŠŠä¸¤ä¸ªAUNodeè¿æ¥èµ·æ¥ã€‚ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«æ¥ä»‹ç»ä¸‹è¿™ä¸¤ç§æ–¹å¼ã€‚</p><ol>\n<li><strong>ç›´æ¥è¿æ¥çš„æ–¹å¼</strong></li>\n</ol><pre><code class=\"language-plain\">AUGraphConnectNodeInput(mPlayerGraph, mPlayerNode, 0, mPlayerIONode, 0);\n</code></pre><p>è¿™æ®µä»£ç æ˜¯æŠŠAudio File Player Unitå’ŒRemoteIO Unitè¿æ¥èµ·æ¥äº†ï¼Œå½“RemoteIO Unitéœ€è¦æ’­æ”¾çš„æ•°æ®çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨AudioFilePlayer Unitæ¥è·å–æ•°æ®ï¼Œæœ€ç»ˆæ•°æ®ä¼šä¼ é€’åˆ°RemoteIOä¸­æ’­æ”¾å‡ºæ¥ã€‚</p><ol start=\"2\">\n<li><strong>å›è°ƒçš„æ–¹å¼</strong></li>\n</ol><pre><code class=\"language-plain\">AURenderCallbackStruct&nbsp;renderProc;\nrenderProc.inputProc = &amp;inputAvailableCallback;\nrenderProc.inputProcRefCon = (__bridge void *)self;\nAUGraphSetNodeInputCallback(mGraph, ioNode, 0, &amp;finalRenderProc);\n</code></pre><p>è¿™æ®µä»£ç é¦–å…ˆæ„é€ äº†ä¸€ä¸ªAURenderCallbackçš„ç»“æ„ä½“ï¼Œç»“æ„ä½“ä¸­éœ€è¦æŒ‡å®šä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œç„¶åè®¾ç½®ç»™RemoteIO Unitï¼Œå½“è¿™ä¸ªRemoteIO Unitéœ€è¦æ•°æ®è¾“å…¥çš„æ—¶å€™å°±ä¼šå›è°ƒè¿™ä¸ªå›è°ƒå‡½æ•°ï¼Œè€Œå›è°ƒå‡½æ•°çš„å®ç°å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">static OSStatus&nbsp;renderCallback(void *inRefCon, AudioUnitRenderActionFlags&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *ioActionFlags, const AudioTimeStamp *inTimeStamp, UInt32\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inBusNumber, UInt32 inNumberFrames, AudioBufferList *ioData)\n{\n&nbsp;&nbsp;&nbsp; OSStatus result = noErr;\n&nbsp;&nbsp;&nbsp; __unsafe_unretained&nbsp;AUGraphRecorder *THIS = (__bridge\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AUGraphRecorder *)inRefCon;\n&nbsp;&nbsp;&nbsp; AudioUnitRender(THIS-&gt;mixerUnit, ioActionFlags, inTimeStamp, 0,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inNumberFrames, ioData);\n&nbsp;&nbsp;&nbsp; return result;\n}\n</code></pre><p>è¿™ä¸ªå›è°ƒå‡½æ•°ä¸­ä¸»è¦åšä¸¤ä»¶äº‹æƒ…ï¼Œç¬¬ä¸€ä»¶äº‹æƒ…æ˜¯å»Mixer Unité‡Œé¢è¦æ•°æ®ï¼Œé€šè¿‡è°ƒç”¨AudioUnitRenderçš„æ–¹å¼æ¥é©±åŠ¨Mixer Unitè·å–æ•°æ®ï¼Œå¾—åˆ°æ•°æ®ä¹‹åæ”¾å…¥ioDataä¸­ï¼Œè¿™ä¹Ÿå°±å¡«å……äº†å›è°ƒæ–¹æ³•ä¸­çš„æ•°æ®ï¼Œä»è€Œå®ç°äº†Mixer Unitå’ŒRemoteIO Unitçš„è¿æ¥ã€‚</p><p>å¦‚æœè¦æ’­æ”¾ä¸€ä¸ªéŸ³é¢‘æ–‡ä»¶ï¼Œå°±è‡ªå·±æ„é€ ä¸€å¥—AUGraphæ˜¯ååˆ†ä¸æ–¹ä¾¿çš„ï¼Œä½†æˆ‘ä»¬è¿™æ ·åšå®é™…æœ‰ä¸¤ä¸ªç›®çš„ï¼š<strong>å…¶ä¸€æ˜¯ä¸ºäº†è®©ä½ ä½“éªŒåœ¨å¼€å‘iOSå¹³å°çš„ç¨‹åºæ—¶ï¼Œä¼˜å…ˆä½¿ç”¨iOSå¹³å°è‡ªèº«æä¾›çš„APIçš„ä¾¿æ·æ€§ä¸é‡è¦æ€§ï¼›å…¶äºŒæ˜¯ä¸ºäº†ç»™åç»­çš„è§†é¢‘æ’­æ”¾å™¨é¡¹ç›®æ‰“ä¸‹åŸºç¡€ã€‚</strong>ä½ å¯ä»¥å¥½å¥½å­¦ä¹ ä¸€ä¸‹è¿™ä¸¤ä¸ªå®ä¾‹ï¼Œå……åˆ†æ„Ÿå—iOSå¹³å°ä¸ºå¼€å‘è€…æä¾›çš„å¼ºå¤§çš„å¤šåª’ä½“å¼€å‘APIã€‚</p><h2>å°ç»“</h2><p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥ä¸€èµ·æ¥å›é¡¾ä¸€ä¸‹ã€‚</p><p>è¿™èŠ‚è¯¾æˆ‘ä»¬é‡ç‚¹å­¦ä¹ äº†ä½¿ç”¨AudioUnitæ¥æ¸²æŸ“éŸ³é¢‘çš„æ–¹æ³•ã€‚å…¶å®åœ¨iOSå¼€å‘ä¸­é™¤äº†è¿™äº›åº•å±‚çš„éŸ³é¢‘æ¡†æ¶ï¼Œè¿˜æœ‰ä¸€äº›å¸¸ç”¨çš„ä¸Šå±‚æ¡†æ¶ï¼Œäº†è§£è¿™äº›æ¡†æ¶çš„ç‰¹ç‚¹ä¸é€‚ç”¨åœºæ™¯èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬åšæŠ€æœ¯é€‰å‹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·ç®€å•çœ‹ä¸‹iOSä¸ºå¼€å‘è€…æä¾›çš„å„ä¸ªå±‚æ¬¡çš„éŸ³é¢‘æ’­æ”¾æ¡†æ¶ï¼Œä»¥ä¾¿ä»¥ååœ¨ä½ çš„åº”ç”¨ä¸­åšæŠ€æœ¯é€‰å‹ï¼š</p><ul>\n<li>AVAudioPlayerï¼šå¦‚æœä½ è¦ç›´æ¥æ’­æ”¾ä¸€ä¸ªæœ¬åœ°éŸ³é¢‘æ–‡ä»¶ï¼ˆæ— è®ºæ˜¯æœ¬åœ°è·¯å¾„è¿˜æ˜¯å†…å­˜ä¸­çš„æ•°æ®ï¼‰ï¼Œä½¿ç”¨AVAudioPlayerä¼šæ˜¯æœ€ä½³é€‰æ‹©ï¼›</li>\n<li>AVPlayerï¼šå¦‚æœæ˜¯æ™®é€šç½‘ç»œåè®®ï¼ˆHTTPã€HLSï¼‰éŸ³é¢‘æ–‡ä»¶è¦ç›´æ¥æ’­æ”¾ï¼Œä½¿ç”¨AVPlayerä¼šæ˜¯æœ€ä½³é€‰æ‹©ï¼›</li>\n<li>AudioQueueï¼šä½†æ˜¯å¦‚æœä½ çš„è¾“å…¥æ˜¯PCMï¼ˆæ¯”å¦‚è§†é¢‘æ’­æ”¾å™¨åœºæ™¯ã€RTCç­‰éœ€è¦ä¸šåŠ¡è‡ªå·±Mixæˆ–è€…å¤„ç†PCMçš„åœºæ™¯ï¼‰ï¼Œå…¶å®ä½¿ç”¨AudioQueueæ˜¯é€‚åˆçš„ä¸€ç§æ–¹å¼ï¼›</li>\n<li>AudioUnitï¼šå¦‚æœéœ€è¦æ„é€ ä¸€ä¸ªå¤æ‚çš„ä½å»¶è¿Ÿé‡‡é›†ã€æ’­æ”¾ã€å¤„ç†çš„éŸ³é¢‘ç³»ç»Ÿï¼Œé‚£ä¹ˆä½¿ç”¨AudioUnitï¼ˆå®é™…å®ç°å¯èƒ½æ˜¯ä½¿ç”¨AUGraphæˆ–è€…AVAudioEngineæ¡†æ¶ï¼‰ä¼šæ˜¯æœ€ä½³é€‰æ‹©ã€‚</li>\n</ul><p><strong>çœŸæ­£å¥½çš„æ¶æ„å¸ˆåº”è¯¥åƒè£ç¼ä¸€æ ·æ‡‚å¾—é‡ä½“è£è¡£</strong>ï¼Œè¦äº†è§£æ¸…æ¥šå½“å‰åº”ç”¨åœºæ™¯çš„ç°çŠ¶å’Œæœªæ¥ï¼Œç„¶åæ ¹æ®è‡ªå·±çš„ç»éªŒåšå‡ºåˆç†çš„æŠ€æœ¯é€‰å‹ï¼Œè®©å¼€å‘çš„Appå¯ä»¥å¿«é€Ÿã€é«˜è´¨é‡åœ°ä¸Šçº¿å¹¶ä¸”è¿˜æœ‰ä¸€å®šçš„æ‰©å±•æ€§ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥çš„æŒ‘æˆ˜å°±çœ‹ä½ çš„äº†ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>å¦‚æœä½ æƒ³è¦å®ç°ä¸€ä¸ªKæ­Œå½•åˆ¶çš„åŠŸèƒ½ï¼Œåœºæ™¯æè¿°å¦‚ä¸‹ï¼š</p><ol>\n<li>æ’­æ”¾ä¼´å¥çš„åŒæ—¶ï¼Œå¯ä»¥å°†äººå£°è¿›è¡Œå½•éŸ³ï¼›</li>\n<li>å¯ä»¥å®æ—¶å¬åˆ°ç”¨æˆ·è‡ªå·±çš„äººå£°è€³è¿”ï¼Œå¹¶ä¸”è¦åœ¨è€³è¿”ä¸­åŠ å…¥æ··å“æ•ˆæœå™¨ï¼›</li>\n<li>å¯ä»¥è°ƒèŠ‚ä¼´å¥ä¸äººå£°çš„éŸ³é‡ï¼›</li>\n</ol><p>è¯·ä½ æ€è€ƒä¸€ä¸‹ï¼Œä½¿ç”¨AUGraphå¦‚ä½•æ„é€ å‡ºä½ çš„å›¾çŠ¶ç»“æ„ã€‚æ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„æ€è€ƒï¼Œä¹Ÿæ¬¢è¿æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™æ›´å¤šå¯¹éŸ³è§†é¢‘æ„Ÿå…´è¶£çš„æœ‹å‹ï¼Œæˆ‘ä»¬å…±åŒäº¤æµã€å…±åŒè¿›æ­¥ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","comments":[{"had_liked":false,"id":352718,"user_name":"å¤§åœŸè±†","can_delete":false,"product_type":"c1","uid":1121636,"ip_address":"åŒ—äº¬","ucode":"67445DC3EC9DB0","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/64/52a5863b.jpg","comment_is_top":false,"comment_ctime":1658896411,"is_pvip":false,"replies":[{"id":128505,"content":"iOSçš„å¤šåª’ä½“èƒ½åŠ›è¿˜æ˜¯éå¸¸å¼ºå¤§çš„ï¼Œä¸è®ºåº•å±‚çš„AUGraphè¿˜æ˜¯AVFoundationæ¡†æ¶ï¼Œå¼€å‘è€…åœ¨ä¸åŒçš„åœºæ™¯å¯ä»¥é€‰æ‹©é€‚åˆè‡ªå·±å½“å‰é˜¶æ®µä¸šåŠ¡çš„æ¡†æ¶å»å®ç°ï¼Œéå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯ç¼ºç‚¹å°±æ˜¯ä¸å¤Ÿé€šç”¨ï¼Œè¦æƒ³åšè·¨å¹³å°çš„éŸ³é¢‘å¤„ç†ã€è§†é¢‘å¤„ç†æ¨¡å—ï¼Œè¿˜æ˜¯è¦æŒæ¡åº•å±‚åŸç†ï¼Œä½¿ç”¨é€šç”¨çš„APIæˆ–è€…å¼€æºåº“ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3069513,"ctime":1659439961,"ip_address":"åŒ—äº¬","comment_id":352718,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100117601,"comment_content":"iOS Apiå°±æ˜¯èŠ±æ ·å¤šï¼Œè¿™ä¸ªGraphç±»ä¼¼FFmpegçš„æ»¤é•œgraphï¼ŒæŠ½è±¡äº†ä¸€éƒ¨åˆ†çš„éŸ³é¢‘å¤„ç†ã€‚Android Apiå°±åŸå§‹å¤šäº†ï¼Œè§£ç å‡ºæ¥çš„PCMï¼Œè‡ªå·±å»å¤„ç†å§ï¼Œä¸æä¾›ä»»ä½•Apiï¼Œè¿é‡é‡‡æ ·éƒ½æ²¡æœ‰ã€‚","like_count":3,"discussions":[{"author":{"id":3069513,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/d6/49/27f68f7d.jpg","nickname":"Kevin","note":"","ucode":"5FCE361CB8C187","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582467,"discussion_content":"iOSçš„å¤šåª’ä½“èƒ½åŠ›è¿˜æ˜¯éå¸¸å¼ºå¤§çš„ï¼Œä¸è®ºåº•å±‚çš„AUGraphè¿˜æ˜¯AVFoundationæ¡†æ¶ï¼Œå¼€å‘è€…åœ¨ä¸åŒçš„åœºæ™¯å¯ä»¥é€‰æ‹©é€‚åˆè‡ªå·±å½“å‰é˜¶æ®µä¸šåŠ¡çš„æ¡†æ¶å»å®ç°ï¼Œéå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯ç¼ºç‚¹å°±æ˜¯ä¸å¤Ÿé€šç”¨ï¼Œè¦æƒ³åšè·¨å¹³å°çš„éŸ³é¢‘å¤„ç†ã€è§†é¢‘å¤„ç†æ¨¡å—ï¼Œè¿˜æ˜¯è¦æŒæ¡åº•å±‚åŸç†ï¼Œä½¿ç”¨é€šç”¨çš„APIæˆ–è€…å¼€æºåº“ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659439961,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1028139,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b0/2b/87aff702.jpg","nickname":"ä¸€ä¸ªæ­£ç›´çš„å°é¾™çŒ«","note":"","ucode":"7C9CFFAA299D1A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":3069513,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/d6/49/27f68f7d.jpg","nickname":"Kevin","note":"","ucode":"5FCE361CB8C187","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":586828,"discussion_content":"è€å¸ˆåœ¨æ‚¨çš„å·¥ä½œç»å†ä¸­ï¼ŒéŸ³é¢‘å¤„ç†ã€è§†é¢‘å¤„ç†æ¨¡å—æ˜¯å®‰å“iOSå„åšå„çš„ï¼Ÿè¿˜æ˜¯è·¨å¹³å°ç»Ÿä¸€ç ”å‘ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662532335,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":582467,"ip_address":"è¾½å®","group_id":0},"score":586828,"extra":""}]}]},{"had_liked":false,"id":363758,"user_name":"keepgoing","can_delete":false,"product_type":"c1","uid":1471387,"ip_address":"åŒ—äº¬","ucode":"A2FE0687FB17E0","user_header":"https://static001.geekbang.org/account/avatar/00/16/73/9b/67a38926.jpg","comment_is_top":false,"comment_ctime":1670140323,"is_pvip":false,"replies":[{"id":132970,"content":"1 æ˜¯1ï¼ŒåŸå› æ˜¯è¿™é‡Œè®¾ç½®çš„æ˜¯remoteIOè¿™ä¸ªUnitçš„Outputï¼ˆå³æ‰¬å£°å™¨ï¼Œå¦‚æœæ˜¯Inputåˆ™æ˜¯éº¦å…‹é£ï¼‰éƒ¨åˆ†ï¼Œå¯¹äºOutputéƒ¨åˆ†çš„è¾“å‡ºæ˜¯ä¸èƒ½è®¾ç½®çš„ï¼Œåªèƒ½è®¾ç½®Outputçš„è¾“å…¥ä¹Ÿå°±æ˜¯inputElementä¹Ÿå°±æ˜¯1ï¼›\n\n2 kAudioOutputUnitProperty_EnableIOå…¶å®åªæœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦ä½¿ç”¨ï¼Œå°±æ˜¯å¯åŠ¨éº¦å…‹é£çš„æ—¶å€™ï¼›\n3 è¿™ä¸ªå…¶å®æ˜¯è€³è¿”ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®callbackæˆ–è€…Notifyçš„å½¢å¼å®ç°\n\nå»ºè®®ç›´æ¥å»githubä¸Šçœ‹ä¸€ä¸‹ä¸¤ä¸ªé¡¹ç›®ï¼Œç›´æ¥è¿è¡Œèµ·æ¥debugä¸€ä¸‹å°±ä¼šç†è§£çš„æ›´é€å½»ï¼š\nhttps:&#47;&#47;github.com&#47;zhanxiaokai&#47;iOS-AudioPlayer\nhttps:&#47;&#47;github.com&#47;zhanxiaokai&#47;iOS-AudioRecorder","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3069513,"ctime":1672197266,"ip_address":"åŒ—äº¬","comment_id":363758,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100117601,"comment_content":"è€å¸ˆè¿™ä¸€è®²çš„å†…å®¹éå¸¸è¯¦ç»†ï¼Œå¯¹iOS audio unitçš„ä½¿ç”¨æœ‰äº†å¾ˆè¯¦ç»†çš„äº†è§£ï¼Œå…¶ä¸­è¿˜æ˜¯æœ‰å‡ ä¸ªé—®é¢˜æƒ³ç¡®è®¤å¸Œæœ›è€å¸ˆæœ‰ç©ºæ—¶å¸®å¿™è§£ç­”ï¼Œååˆ†æ„Ÿè°¢ï¼š\n\n1. ç¤ºä¾‹ä»£ç ä¸­ç»™audio unitæ‰¬å£°å™¨æ’­æ”¾çš„åœºæ™¯è®¾ç½®ASBDä»£ç æ˜¯ï¼š\nAudioUnitSetProperty( remoteIOUnit,kAudioUnitProperty_StreamFormat, \nkAudioUnitScope_Output, 1, &amp;asbd, sizeof(asbd));\nè¿™é‡Œçš„element æ˜¯1ï¼Œè¯·é—®æ˜¯ä¸æ˜¯åº”è¯¥æ”¹æˆelementä¸º0ï¼›å¦å¤–asbdéœ€è¦ç»™elementçš„0çš„outputå’Œinput scopeéƒ½è®¾ç½®ä¸€ä¸‹å—ï¼Ÿ\n\n2. è€å¸ˆåœ¨æ–‡ä¸­ç»™å‡ºçš„å°†remote i&#47;o audio unit element 0 ä¸æ‰¬å£°å™¨è¿›è¡Œè¿æ¥ä½¿ç”¨çš„keyæ˜¯ kAudioOutputUnitProperty_EnableIOï¼Œè¿™ä¸ªkeyçš„æœ¬è´¨æ˜¯ä¸€ä¸ªå¼€å…³ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥ç†è§£remote i&#47;o audio unit çš„ element 0 output å’Œ element 1 input æœ¬èº«å·²ç»ä¸æ‰¬å£°å™¨&#47;éº¦å…‹é£è¿æ¥äº†ï¼Œæˆ‘ä»¬ä½¿ç”¨æ—¶åªéœ€è¦å°†kAudioOutputUnitProperty_EnableIOçš„å€¼è®¾ç½®ä¸º1ï¼Œå³å¯åŠ¨äº†è¿™ä¸ªè¿æ¥ï¼Ÿ\n\n3. åœ¨é—®é¢˜2çš„åŸºç¡€ä¸Šï¼Œè¯·é—®è¯¥å¦‚ä½•å°† element 0 çš„ input å’Œ element 1 çš„ output è¿æ¥èµ·æ¥ã€‚\nå¦‚æœæƒ³å®ç°è€å¸ˆæ–‡ä¸­æåˆ°çš„ä»éº¦å…‹é£ä¸­é‡‡é›†éŸ³é¢‘åä½¿ç”¨æ‰¬å£°å™¨æ’­æ”¾çš„åœºæ™¯ï¼Œelement 0 éœ€è¦æ•°æ®æ—¶å¯ä»¥é€šè¿‡é¢„å…ˆè®¾ç½®çš„call back æ–¹æ³•æ„ŸçŸ¥åˆ°ï¼Œéœ€è¦è°ƒç”¨ä»€ä¹ˆæ¥å£æ‰èƒ½ä» element 1 ä¸­è·å–é‡‡é›†åˆ°çš„æ•°æ®å‘¢ï¼Œè¿™å—æ²¡æœ‰ç‰¹åˆ«æƒ³æ˜ç™½ï¼Œæƒ³è¯·è€å¸ˆæç¤ºä¸‹ç»†èŠ‚ï¼Œæ„Ÿè°¢ï¼\n\nå­¦äº†è€å¸ˆçš„è¯¾ç¡®å®å¯¹ audio unit æœ‰äº†æ›´å¤šå¥½å¥‡çš„åœ°æ–¹ï¼Œä¸Šé¢æ˜¯ä¸€äº›å›°æƒ‘ï¼Œå¸Œæœ›è€å¸ˆæœ‰ç©ºæ—¶èƒ½å¸®å¿™è§£ç­”ï¼Œéå¸¸æ„Ÿè°¢ï¼å¦‚æœæœ‰ä¸€äº›ç†è§£é”™è¯¯æˆ–è€…é±¼å”‡çš„åœ°æ–¹ï¼Œè¯·è€å¸ˆå¤šå¤šåŒ…æ¶µ","like_count":1,"discussions":[{"author":{"id":3069513,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/d6/49/27f68f7d.jpg","nickname":"Kevin","note":"","ucode":"5FCE361CB8C187","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597724,"discussion_content":"1 æ˜¯1ï¼ŒåŸå› æ˜¯è¿™é‡Œè®¾ç½®çš„æ˜¯remoteIOè¿™ä¸ªUnitçš„Outputï¼ˆå³æ‰¬å£°å™¨ï¼Œå¦‚æœæ˜¯Inputåˆ™æ˜¯éº¦å…‹é£ï¼‰éƒ¨åˆ†ï¼Œå¯¹äºOutputéƒ¨åˆ†çš„è¾“å‡ºæ˜¯ä¸èƒ½è®¾ç½®çš„ï¼Œåªèƒ½è®¾ç½®Outputçš„è¾“å…¥ä¹Ÿå°±æ˜¯inputElementä¹Ÿå°±æ˜¯1ï¼›\n\n2 kAudioOutputUnitProperty_EnableIOå…¶å®åªæœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦ä½¿ç”¨ï¼Œå°±æ˜¯å¯åŠ¨éº¦å…‹é£çš„æ—¶å€™ï¼›\n3 è¿™ä¸ªå…¶å®æ˜¯è€³è¿”ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®callbackæˆ–è€…Notifyçš„å½¢å¼å®ç°\n\nå»ºè®®ç›´æ¥å»githubä¸Šçœ‹ä¸€ä¸‹ä¸¤ä¸ªé¡¹ç›®ï¼Œç›´æ¥è¿è¡Œèµ·æ¥debugä¸€ä¸‹å°±ä¼šç†è§£çš„æ›´é€å½»ï¼š\nhttps://github.com/zhanxiaokai/iOS-AudioPlayer\nhttps://github.com/zhanxiaokai/iOS-AudioRecorder","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672197266,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1471387,"avatar":"https://static001.geekbang.org/account/avatar/00/16/73/9b/67a38926.jpg","nickname":"keepgoing","note":"","ucode":"A2FE0687FB17E0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":3069513,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/d6/49/27f68f7d.jpg","nickname":"Kevin","note":"","ucode":"5FCE361CB8C187","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":598374,"discussion_content":"å¤šè°¢è€å¸ˆè§£ç­”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672800466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":597724,"ip_address":"åŒ—äº¬","group_id":0},"score":598374,"extra":""}]}]},{"had_liked":false,"id":353961,"user_name":"jcy","can_delete":false,"product_type":"c1","uid":1264411,"ip_address":"åŒ—äº¬","ucode":"7C3E10C4E0FA87","user_header":"https://static001.geekbang.org/account/avatar/00/13/4b/1b/e3b3bcff.jpg","comment_is_top":false,"comment_ctime":1659952200,"is_pvip":false,"replies":[{"id":128750,"content":"æ˜¯çš„ï¼Œå› ä¸ºä¸€äº›æ•ˆæœå™¨åœ¨AUGraphå±‚å¯ä»¥æ›´åŠ æ–¹ä¾¿çš„ä½¿ç”¨ï¼ŒAVAudioEngineæ˜¯æ›´åŠ é¢å‘å¯¹è±¡çš„å°è£…ï¼Œæä¾›çš„æ¥å£ä¸APIä¹Ÿæ›´åŠ å‹å¥½ä¸€äº›ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3069513,"ctime":1660011260,"ip_address":"åŒ—äº¬","comment_id":353961,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100117601,"comment_content":"é—®ä¸€ä¸‹ï¼Œå¦‚ä½•éœ€è¦æä¾›å¾ˆå¤æ‚ã€å¾ˆå¼ºå¤§çš„éŸ³é¢‘åŠŸèƒ½ï¼Œä½¿ç”¨ AUGraph æ˜¯å¦æ¯”ä½¿ç”¨ AVAudioEngine æœ‰æ›´å¤§åœ°çµæ´»æ€§","like_count":1,"discussions":[{"author":{"id":3069513,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/d6/49/27f68f7d.jpg","nickname":"Kevin","note":"","ucode":"5FCE361CB8C187","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583272,"discussion_content":"æ˜¯çš„ï¼Œå› ä¸ºä¸€äº›æ•ˆæœå™¨åœ¨AUGraphå±‚å¯ä»¥æ›´åŠ æ–¹ä¾¿çš„ä½¿ç”¨ï¼ŒAVAudioEngineæ˜¯æ›´åŠ é¢å‘å¯¹è±¡çš„å°è£…ï¼Œæä¾›çš„æ¥å£ä¸APIä¹Ÿæ›´åŠ å‹å¥½ä¸€äº›ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660011260,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358262,"user_name":"Ins","can_delete":false,"product_type":"c1","uid":1328500,"ip_address":"åŒ—äº¬","ucode":"A2509BAD9CB72C","user_header":"https://static001.geekbang.org/account/avatar/00/14/45/74/7a82eebb.jpg","comment_is_top":false,"comment_ctime":1664152010,"is_pvip":false,"replies":[{"id":132944,"content":"åç»­æœ‰æœºä¼šå¯ä»¥å½“ä½œé—²èŠå¸–å­æ¥è®²ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹æˆ‘çš„é‚£æœ¬ä¹¦ï¼ˆéŸ³è§†é¢‘å¼€å‘è¿›é˜¶æŒ‡å—ï¼‰ï¼Œä¹¦é‡Œé¢æœ‰æ›´è¯¦ç»†çš„åˆ†äº«ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3069513,"ctime":1672140691,"ip_address":"åŒ—äº¬","comment_id":358262,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100117601,"comment_content":"è€å¸ˆèƒ½å¦è¡¥ä¸€ä¸‹éŸ³é¢‘æŠ€æœ¯çš„å†å²å‘å±•ï¼Œæ¯”å¦‚ä¸€äº›æ ‡å‡†ã€é¢‘è°±ã€ç¼–ç ä¹‹ç±»çš„ï¼Œè®²ä¸€ä¸‹éŸ³é¢‘çš„ä¸€äº›åº•å±‚é€»è¾‘ã€‚","like_count":0,"discussions":[{"author":{"id":3069513,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/d6/49/27f68f7d.jpg","nickname":"Kevin","note":"","ucode":"5FCE361CB8C187","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597675,"discussion_content":"åç»­æœ‰æœºä¼šå¯ä»¥å½“ä½œé—²èŠå¸–å­æ¥è®²ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹æˆ‘çš„é‚£æœ¬ä¹¦ï¼ˆéŸ³è§†é¢‘å¼€å‘è¿›é˜¶æŒ‡å—ï¼‰ï¼Œä¹¦é‡Œé¢æœ‰æ›´è¯¦ç»†çš„åˆ†äº«ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672140691,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353957,"user_name":"jcy","can_delete":false,"product_type":"c1","uid":1264411,"ip_address":"åŒ—äº¬","ucode":"7C3E10C4E0FA87","user_header":"https://static001.geekbang.org/account/avatar/00/13/4b/1b/e3b3bcff.jpg","comment_is_top":false,"comment_ctime":1659951323,"is_pvip":false,"replies":[{"id":128748,"content":"æ˜¯çš„ï¼Œè¿™é‡Œå†™é”™äº†ï¼Œæˆ‘ä¿®æ”¹ä¸€ä¸‹ï¼Œè°¢è°¢ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3069513,"ctime":1660011182,"ip_address":"åŒ—äº¬","comment_id":353957,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100117601,"comment_content":"\nAURenderCallbackStruct renderProc;\nrenderProc.inputProc = &amp;inputAvailableCallback;\nrenderProc.inputProcRefCon = (__bridge void *)self;\nAUGraphSetNodeInputCallback(mGraph, ioNode, 0, &amp;finalRenderProc);\n\nè¿™é‡Œçš„ finalRenderProc åº”è¯¥æ˜¯ renderProc å§","like_count":0,"discussions":[{"author":{"id":3069513,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/d6/49/27f68f7d.jpg","nickname":"Kevin","note":"","ucode":"5FCE361CB8C187","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583270,"discussion_content":"æ˜¯çš„ï¼Œè¿™é‡Œå†™é”™äº†ï¼Œæˆ‘ä¿®æ”¹ä¸€ä¸‹ï¼Œè°¢è°¢ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660011182,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":352836,"user_name":"å¥½å¥½æµ©æµ©","can_delete":false,"product_type":"c1","uid":2996592,"ip_address":"é™•è¥¿","ucode":"55FD6BBDD6B39F","user_header":"https://static001.geekbang.org/account/avatar/00/2d/b9/70/fd0ab6b9.jpg","comment_is_top":false,"comment_ctime":1658976473,"is_pvip":false,"replies":[{"id":128308,"content":"ä¸‹ä¸€è®²å°±æ˜¯å“¦ï½","user_name":"ç¼–è¾‘å›å¤","user_name_real":"ç¼–è¾‘","uid":2843479,"ctime":1659008577,"ip_address":"é™•è¥¿","comment_id":352836,"utype":2}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100117601,"comment_content":"æœ‰åŸºäºAndroidçš„å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2843479,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/63/57/cba4c68b.jpg","nickname":"å°è™å­ğŸ¯","note":"","ucode":"4C9530B3FB407B","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":581825,"discussion_content":"ä¸‹ä¸€è®²å°±æ˜¯å“¦ï½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659008577,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é™•è¥¿","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":8}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":352904,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"é™•è¥¿","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1659001647,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100117601,"comment_content":"è€å¸ˆçš„è¯¾å¾ˆå¥½ï¼Œå¾ˆæœ‰ä»·å€¼ï¼›åˆšå‘ç°è¿™ä¸ªä¸“æ ï¼Œèµ¶ç´§è¿½èµ¶ï¼Œç»ˆäºèµ¶ä¸Šäº†è¿›åº¦ã€‚\nè¯·æ•™è€å¸ˆä¸€ä¸ªé—®é¢˜ï¼š\nå¼€ç¯‡è¯ä¸­è€å¸ˆæåˆ°â€œæˆ‘æ‰€åœ¨çš„å›¢é˜Ÿå¼€å‘å¹¶ç»´æŠ¤äº†å”±é¸­ã€é²¸é¸£ã€è™¾ç±³éŸ³ä¹ç­‰äº§å“ã€‚å½“æ—¶æˆ‘ä»¬å°†å¼¹å”±çš„å®æ—¶è€³è¿”åšåˆ°äº†ä¸šç•Œæœ€ä½³å¹¶ç‹¬åˆ›äº†éŸ³ä¹å¼¹å¹•çš„äº¤äº’å½¢å¼â€ï¼Œ\n\nè¯·é—®ï¼šå…·æœ‰â€œéŸ³ä¹å¼¹å¹•â€åŠŸèƒ½çš„APPçš„å®Œæ•´åå­—å«ä»€ä¹ˆï¼Ÿ æˆ‘æƒ³ä¸‹è½½ä¸€ä¸ªã€‚çŸ¥é“APPåå­—åæˆ‘å¯ä»¥æ ¹æ®åå­—ä»åº”ç”¨å¸‚åœºä¸Šæœã€‚","like_count":0,"discussions":[{"author":{"id":3069513,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/d6/49/27f68f7d.jpg","nickname":"Kevin","note":"","ucode":"5FCE361CB8C187","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582468,"discussion_content":"åœ¨åº”ç”¨å•†åº—æœç´¢ã€å›æ£®ã€‘è¿™ä¸ªAppï¼Œå¯ä»¥ä½“éªŒä¸€ä¸‹å“ˆã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659440038,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}