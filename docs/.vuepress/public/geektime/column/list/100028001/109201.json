{"id":109201,"title":"26 | ç­”ç–‘è¯¾å ‚ï¼šæ¨¡å—å››çƒ­ç‚¹é—®é¢˜è§£ç­”","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯åˆ˜è¶…ã€‚</p><p>æœ¬å‘¨æˆ‘ä»¬ç»“æŸäº†â€œJVMæ€§èƒ½ç›‘æµ‹åŠè°ƒä¼˜â€çš„å­¦ä¹ ï¼Œè¿™ä¸€æœŸç­”ç–‘è¯¾å ‚æˆ‘ç²¾é€‰äº†æ¨¡å—å››ä¸­ 11 ä½åŒå­¦çš„ç•™è¨€ï¼Œè¿›è¡Œé›†ä¸­è§£ç­”ï¼Œå¸Œæœ›ä¹Ÿèƒ½å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚å¦å¤–ï¼Œæˆ‘æƒ³ä¸ºåšæŒè·Ÿåˆ°ç°åœ¨çš„åŒå­¦ç‚¹ä¸ªèµï¼ŒæœŸå¾…æˆ‘ä»¬èƒ½æœ‰æ›´å¤šçš„æŠ€æœ¯äº¤æµï¼Œå…±åŒæˆé•¿ã€‚</p><h2><a href=\"https://time.geekbang.org/column/article/106203\">ç¬¬20è®²</a></h2><p><img src=\"https://static001.geekbang.org/resource/image/31/3a/31a205290c3b2391f115ee77f511a43a.jpeg?wh=1125*1306\" alt=\"\"></p><p>å¾ˆå¤šåŒå­¦éƒ½é—®åˆ°äº†ç±»ä¼¼â€œé»‘å¤œé‡Œçš„çŒ«\"é—®åˆ°çš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘æ¥é›†ä¸­å›å¤ä¸€ä¸‹ã€‚JVMçš„å†…å­˜æ¨¡å‹åªæ˜¯ä¸€ä¸ªè§„èŒƒï¼Œæ–¹æ³•åŒºä¹Ÿæ˜¯ä¸€ä¸ªè§„èŒƒï¼Œä¸€ä¸ªé€»è¾‘åˆ†åŒºï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªç‰©ç†ç©ºé—´ï¼Œæˆ‘ä»¬è¿™é‡Œè¯´çš„å­—ç¬¦ä¸²å¸¸é‡æ”¾åœ¨å †å†…å­˜ç©ºé—´ä¸­ï¼Œæ˜¯æŒ‡å®é™…çš„ç‰©ç†ç©ºé—´ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/2a/01/2ac5ee0c9a6fe67ce8f896be75d05f01.jpeg?wh=1125*1218\" alt=\"\"></p><p>æ–‡ççš„é—®é¢˜å’Œä¸Šä¸€ä¸ªç±»ä¼¼ï¼Œä¸€åŒå›å¤ä¸€ä¸‹ã€‚å…ƒç©ºé—´æ˜¯å±äºæ–¹æ³•åŒºçš„ï¼Œæ–¹æ³•åŒºåªæ˜¯ä¸€ä¸ªé€»è¾‘åˆ†åŒºï¼Œè€Œå…ƒç©ºé—´æ˜¯å…·ä½“å®ç°ã€‚æ‰€ä»¥ç±»çš„å…ƒæ•°æ®æ˜¯å­˜æ”¾åœ¨å…ƒç©ºé—´ï¼Œé€»è¾‘ä¸Šå±äºæ–¹æ³•åŒºã€‚</p><h2><a href=\"https://time.geekbang.org/column/article/106953\">ç¬¬21è®²</a></h2><p><img src=\"https://static001.geekbang.org/resource/image/f2/76/f2fa07e388f5a3dbe84bb12bfea5ee76.jpeg?wh=1125*1164\" alt=\"\"></p><p>LiamåŒå­¦ï¼Œç›®å‰Hotspotè™šæ‹Ÿæœºæš‚æ—¶ä¸æ”¯æŒæ ˆä¸Šåˆ†é…å¯¹è±¡ã€‚W.LIåŒå­¦çš„ç•™è¨€å€¼å¾—å‚è€ƒï¼Œæ‰€ä»¥è¿™é‡Œä¸€åŒè´´å‡ºæ¥äº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/20/f2/20e59cb2df51bd171d41c81e074821f2.jpeg?wh=1080*2566\" alt=\"\"></p><h2><a href=\"https://time.geekbang.org/column/article/107396\">ç¬¬22è®²</a></h2><p><img src=\"https://static001.geekbang.org/resource/image/09/25/09ada15236e8ceeef2558d6ab7505425.jpeg?wh=1125*4041\" alt=\"\"></p><p>éå¸¸èµï¼ŒRegionè¿™å—ï¼ŒJxinåŒå­¦è®²è§£å¾—å¾ˆåˆ°ä½ã€‚è¿™é‡Œæˆ‘å†æ€»ç»“ä¸‹CMSå’ŒG1çš„ä¸€äº›çŸ¥è¯†ç‚¹ã€‚</p><p>CMSåƒåœ¾æ”¶é›†å™¨æ˜¯åŸºäºæ ‡è®°æ¸…é™¤ç®—æ³•å®ç°çš„ï¼Œç›®å‰ä¸»è¦ç”¨äºè€å¹´ä»£åƒåœ¾å›æ”¶ã€‚CMSæ”¶é›†å™¨çš„GCå‘¨æœŸä¸»è¦ç”±7ä¸ªé˜¶æ®µç»„æˆï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªé˜¶æ®µä¼šå‘ç”Ÿstop-the-worldï¼Œå…¶å®ƒé˜¶æ®µéƒ½æ˜¯å¹¶å‘æ‰§è¡Œçš„ã€‚</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/50/aa/500c2f0e112ced378fd49a09c61c5caa.jpg?wh=1276*1132\" alt=\"\"></p><p>G1åƒåœ¾æ”¶é›†å™¨æ˜¯åŸºäºæ ‡è®°æ•´ç†ç®—æ³•å®ç°çš„ï¼Œæ˜¯ä¸€ä¸ªåˆ†ä»£åƒåœ¾æ”¶é›†å™¨ï¼Œæ—¢è´Ÿè´£å¹´è½»ä»£ï¼Œä¹Ÿè´Ÿè´£è€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€‚</p><p>è·Ÿä¹‹å‰å„ä¸ªåˆ†ä»£ä½¿ç”¨è¿ç»­çš„è™šæ‹Ÿå†…å­˜åœ°å€ä¸ä¸€æ ·ï¼ŒG1ä½¿ç”¨äº†ä¸€ç§  Region  æ–¹å¼å¯¹å †å†…å­˜è¿›è¡Œäº†åˆ’åˆ†ï¼ŒåŒæ ·ä¹Ÿåˆ†å¹´è½»ä»£ã€è€å¹´ä»£ï¼Œä½†æ¯ä¸€ä»£ä½¿ç”¨çš„æ˜¯Nä¸ªä¸è¿ç»­çš„Regionå†…å­˜å—ï¼Œæ¯ä¸ªRegionå ç”¨ä¸€å—è¿ç»­çš„è™šæ‹Ÿå†…å­˜åœ°å€ã€‚</p><p>åœ¨G1ä¸­ï¼Œè¿˜æœ‰ä¸€ç§å« Humongous  åŒºåŸŸï¼Œç”¨äºå­˜å‚¨ç‰¹åˆ«å¤§çš„å¯¹è±¡ã€‚G1å†…éƒ¨åšäº†ä¸€ä¸ªä¼˜åŒ–ï¼Œä¸€æ—¦å‘ç°æ²¡æœ‰å¼•ç”¨æŒ‡å‘å·¨å‹å¯¹è±¡ï¼Œåˆ™å¯ç›´æ¥åœ¨å¹´è½»ä»£çš„YoungGCä¸­è¢«å›æ”¶æ‰ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f8/be/f832278afd5cdb94decd1f6826056dbe.jpg?wh=868*578\" alt=\"\"></p><p>G1åˆ†ä¸ºYoung GCã€Mix GCä»¥åŠFull GCã€‚</p><p>G1 Young GCä¸»è¦æ˜¯åœ¨EdenåŒºè¿›è¡Œï¼Œå½“EdenåŒºç©ºé—´ä¸è¶³æ—¶ï¼Œåˆ™ä¼šè§¦å‘ä¸€æ¬¡Young GCã€‚å°†EdenåŒºæ•°æ®ç§»åˆ°Survivorç©ºé—´æ—¶ï¼Œå¦‚æœSurvivorç©ºé—´ä¸è¶³ï¼Œåˆ™ä¼šç›´æ¥æ™‹å‡åˆ°è€å¹´ä»£ã€‚æ­¤æ—¶Survivorçš„æ•°æ®ä¹Ÿä¼šæ™‹å‡åˆ°è€å¹´ä»£ã€‚Young GCçš„æ‰§è¡Œæ˜¯å¹¶è¡Œçš„ï¼ŒæœŸé—´ä¼šå‘ç”ŸSTWã€‚</p><p>å½“å †ç©ºé—´çš„å ç”¨ç‡è¾¾åˆ°ä¸€å®šé˜ˆå€¼åä¼šè§¦å‘G1 Mix GCï¼ˆé˜ˆå€¼ç”±å‘½ä»¤å‚æ•°-XX:InitiatingHeapOccupancyPercentè®¾å®šï¼Œé»˜è®¤å€¼45ï¼‰ï¼ŒMix GCä¸»è¦åŒ…æ‹¬äº†å››ä¸ªé˜¶æ®µï¼Œå…¶ä¸­åªæœ‰å¹¶å‘æ ‡è®°é˜¶æ®µä¸ä¼šå‘ç”ŸSTWï¼Œå…¶å®ƒé˜¶æ®µå‡ä¼šå‘ç”ŸSTWã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b8/2f/b8090ff2c7ddf54fb5f6e3c19a36d32f.jpg?wh=2536*1032\" alt=\"\"></p><p>G1å’ŒCMSä¸»è¦çš„åŒºåˆ«åœ¨äºï¼š</p><ul>\n<li>CMSä¸»è¦é›†ä¸­åœ¨è€å¹´ä»£çš„å›æ”¶ï¼Œè€ŒG1é›†ä¸­åœ¨åˆ†ä»£å›æ”¶ï¼ŒåŒ…æ‹¬äº†å¹´è½»ä»£çš„Young GCä»¥åŠè€å¹´ä»£çš„Mix GCï¼›</li>\n<li>G1ä½¿ç”¨äº†Regionæ–¹å¼å¯¹å †å†…å­˜è¿›è¡Œäº†åˆ’åˆ†ï¼Œä¸”åŸºäºæ ‡è®°æ•´ç†ç®—æ³•å®ç°ï¼Œæ•´ä½“å‡å°‘äº†åƒåœ¾ç¢ç‰‡çš„äº§ç”Ÿï¼›</li>\n<li>åœ¨åˆå§‹åŒ–æ ‡è®°é˜¶æ®µï¼Œæœç´¢å¯è¾¾å¯¹è±¡ä½¿ç”¨åˆ°çš„Card Tableï¼Œå…¶å®ç°æ–¹å¼ä¸ä¸€æ ·ã€‚</li>\n</ul><p>è¿™é‡Œæˆ‘ç®€å•è§£é‡Šä¸‹Card Tableï¼Œåœ¨åƒåœ¾å›æ”¶çš„æ—¶å€™éƒ½æ˜¯ä»Rootå¼€å§‹æœç´¢ï¼Œè¿™ä¼šå…ˆç»è¿‡å¹´è½»ä»£å†åˆ°è€å¹´ä»£ï¼Œä¹Ÿæœ‰å¯èƒ½è€å¹´ä»£å¼•ç”¨åˆ°å¹´è½»ä»£å¯¹è±¡ï¼Œå¦‚æœå‘ç”ŸYoung GCï¼Œé™¤äº†ä»å¹´è½»ä»£æ‰«ææ ¹å¯¹è±¡ä¹‹å¤–ï¼Œè¿˜éœ€è¦å†ä»è€å¹´ä»£æ‰«ææ ¹å¯¹è±¡ï¼Œç¡®è®¤å¼•ç”¨å¹´è½»ä»£å¯¹è±¡çš„æƒ…å†µã€‚</p><p><strong>è¿™ç§å±äºè·¨ä»£å¤„ç†ï¼Œéå¸¸æ¶ˆè€—æ€§èƒ½ã€‚</strong>ä¸ºäº†é¿å…åœ¨å›æ”¶å¹´è½»ä»£æ—¶è·¨ä»£æ‰«ææ•´ä¸ªè€å¹´ä»£ï¼ŒCMSå’ŒG1éƒ½ç”¨åˆ°äº†Card Tableæ¥è®°å½•è¿™äº›å¼•ç”¨å…³ç³»ã€‚åªæ˜¯G1åœ¨Card Tableçš„åŸºç¡€ä¸Šå¼•å…¥äº†RSetï¼Œæ¯ä¸ªRegionåˆå§‹åŒ–æ—¶ï¼Œéƒ½ä¼šåˆå§‹åŒ–ä¸€ä¸ªRSetï¼ŒRSetè®°å½•äº†å…¶å®ƒRegionä¸­çš„å¯¹è±¡å¼•ç”¨æœ¬Regionå¯¹è±¡çš„å…³ç³»ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼ŒCMSå’ŒG1åœ¨è§£å†³å¹¶å‘æ ‡è®°æ—¶æ¼æ ‡çš„æ–¹å¼ä¹Ÿä¸ä¸€æ ·ï¼ŒCMSä½¿ç”¨çš„æ˜¯Incremental Updateç®—æ³•ï¼Œè€ŒG1ä½¿ç”¨çš„æ˜¯SATBç®—æ³•ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦äº†è§£åœ¨å¹¶å‘æ ‡è®°ä¸­ï¼ŒG1å’ŒCMSéƒ½æ˜¯åŸºäºä¸‰è‰²æ ‡è®°ç®—æ³•æ¥å®ç°çš„ï¼š</p><ul>\n<li>é»‘è‰²ï¼šæ ¹å¯¹è±¡ï¼Œæˆ–è€…å¯¹è±¡å’Œå¯¹è±¡ä¸­çš„å­å¯¹è±¡éƒ½è¢«æ‰«æï¼›</li>\n<li>ç°è‰²ï¼šå¯¹è±¡æœ¬èº«è¢«æ‰«æï¼Œä½†è¿˜æ²¡æ‰«æå¯¹è±¡ä¸­çš„å­å¯¹è±¡ï¼›</li>\n<li>ç™½è‰²ï¼šä¸å¯è¾¾å¯¹è±¡ã€‚</li>\n</ul><p>åŸºäºè¿™ç§æ ‡è®°æœ‰ä¸€ä¸ªæ¼æ ‡çš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä¸€ä¸ªç™½è‰²æ ‡è®°å¯¹è±¡ï¼Œåœ¨åƒåœ¾å›æ”¶è¢«æ¸…ç†æ‰æ—¶ï¼Œæ­£å¥½æœ‰ä¸€ä¸ªå¯¹è±¡å¼•ç”¨äº†è¯¥ç™½è‰²æ ‡è®°å¯¹è±¡ï¼Œæ­¤æ—¶ç”±äºè¢«å›æ”¶æ‰äº†ï¼Œå°±ä¼šå‡ºç°å¯¹è±¡ä¸¢å¤±çš„é—®é¢˜ã€‚</p><p>ä¸ºäº†é¿å…ä¸Šè¿°é—®é¢˜ï¼ŒCMSé‡‡ç”¨äº†Incremental Updateç®—æ³•ï¼Œåªè¦åœ¨å†™å±éšœï¼ˆwrite barrierï¼‰é‡Œå‘ç°ä¸€ä¸ªç™½å¯¹è±¡çš„å¼•ç”¨è¢«èµ‹å€¼åˆ°ä¸€ä¸ªé»‘å¯¹è±¡çš„å­—æ®µé‡Œï¼Œé‚£å°±æŠŠè¿™ä¸ªç™½å¯¹è±¡å˜æˆç°è‰²çš„ã€‚è€Œåœ¨G1ä¸­ï¼Œé‡‡ç”¨çš„æ˜¯SATBç®—æ³•ï¼Œè¯¥ç®—æ³•è®¤ä¸ºå¼€å§‹æ—¶æ‰€æœ‰èƒ½éå†åˆ°çš„å¯¹è±¡éƒ½æ˜¯éœ€è¦æ ‡è®°çš„ï¼Œå³è®¤ä¸ºéƒ½æ˜¯æ´»çš„ã€‚</p><p>G1å…·å¤‡Pause Prediction Model ï¼Œå³åœé¡¿é¢„æµ‹æ¨¡å‹ã€‚ç”¨æˆ·å¯ä»¥è®¾å®šæ•´ä¸ªGCè¿‡ç¨‹ä¸­æœŸæœ›çš„åœé¡¿æ—¶é—´ï¼Œç”¨å‚æ•°-XX:MaxGCPauseMilliså¯ä»¥æŒ‡å®šä¸€ä¸ªG1æ”¶é›†è¿‡ç¨‹çš„ç›®æ ‡åœé¡¿æ—¶é—´ï¼Œé»˜è®¤å€¼200msã€‚</p><p>G1ä¼šæ ¹æ®è¿™ä¸ªæ¨¡å‹ç»Ÿè®¡å‡ºæ¥çš„å†å²æ•°æ®ï¼Œæ¥é¢„æµ‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ‰€éœ€è¦çš„Regionæ•°é‡ï¼Œé€šè¿‡æ§åˆ¶Regionæ•°æ¥æ§åˆ¶ç›®æ ‡åœé¡¿æ—¶é—´çš„å®ç°ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/91/b4/915e9793981a278112087f0c880b96b4.jpeg?wh=1125*1386\" alt=\"\"></p><p>Liamæå‡ºçš„è¿™ä¸¤ä¸ªé—®é¢˜éƒ½éå¸¸å¥½ã€‚</p><p>ä¸ç®¡ä»€ä¹ˆGCï¼Œéƒ½ä¼šå‘é€stop-the-worldï¼ŒåŒºåˆ«æ˜¯å‘ç”Ÿçš„æ—¶é—´é•¿çŸ­ã€‚è€Œè¿™ä¸ªæ—¶é—´è·Ÿåƒåœ¾æ”¶é›†å™¨åˆæœ‰å…³ç³»ï¼ŒSerialã€PartNewã€Parallel Scavengeæ”¶é›†å™¨æ— è®ºæ˜¯ä¸²è¡Œè¿˜æ˜¯å¹¶è¡Œï¼Œéƒ½ä¼šæŒ‚èµ·ç”¨æˆ·çº¿ç¨‹ï¼Œè€ŒCMSå’ŒG1åœ¨å¹¶å‘æ ‡è®°æ—¶ï¼Œæ˜¯ä¸ä¼šæŒ‚èµ·ç”¨æˆ·çº¿ç¨‹çš„ï¼Œä½†å…¶å®ƒæ—¶å€™ä¸€æ ·ä¼šæŒ‚èµ·ç”¨æˆ·çº¿ç¨‹ï¼Œstop the world çš„æ—¶é—´ç›¸å¯¹æ¥è¯´å°±å°å¾ˆå¤šäº†ã€‚</p><p>Major Gc åœ¨å¾ˆå¤šå‚è€ƒèµ„æ–™ä¸­æ˜¯ç­‰ä»·äº Full GCçš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å‘ç°å¾ˆå¤šæ€§èƒ½ç›‘æµ‹å·¥å…·ä¸­åªæœ‰Minor GC å’Œ Full GCã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€æ¬¡Full GCå°†ä¼šå¯¹å¹´è½»ä»£ã€è€å¹´ä»£ã€å…ƒç©ºé—´ä»¥åŠå †å¤–å†…å­˜è¿›è¡Œåƒåœ¾å›æ”¶ã€‚è§¦å‘Full GCçš„åŸå› æœ‰å¾ˆå¤šï¼š</p><ul>\n<li>å½“å¹´è½»ä»£æ™‹å‡åˆ°è€å¹´ä»£çš„å¯¹è±¡å¤§å°ï¼Œå¹¶æ¯”ç›®å‰è€å¹´ä»£å‰©ä½™çš„ç©ºé—´å¤§å°è¿˜è¦å¤§æ—¶ï¼Œä¼šè§¦å‘Full GCï¼›</li>\n<li>å½“è€å¹´ä»£çš„ç©ºé—´ä½¿ç”¨ç‡è¶…è¿‡æŸé˜ˆå€¼æ—¶ï¼Œä¼šè§¦å‘Full GCï¼›</li>\n<li>å½“å…ƒç©ºé—´ä¸è¶³æ—¶ï¼ˆJDK1.7æ°¸ä¹…ä»£ä¸è¶³ï¼‰ï¼Œä¹Ÿä¼šè§¦å‘Full GCï¼›</li>\n<li>å½“è°ƒç”¨System.gc()ä¹Ÿä¼šå®‰æ’ä¸€æ¬¡Full GCã€‚</li>\n</ul><p><img src=\"https://static001.geekbang.org/resource/image/a8/24/a8a506a512922609669b4073d0dbc224.jpeg?wh=1125*2314\" alt=\"\"></p><p>æ¥ä¸‹æ¥è§£ç­” ninghtmare çš„æé—®ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡  jstat -gc pid interval  æŸ¥çœ‹æ¯æ¬¡GCä¹‹åï¼Œå…·ä½“æ¯ä¸€ä¸ªåˆ†åŒºçš„å†…å­˜ä½¿ç”¨ç‡å˜åŒ–æƒ…å†µã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡JVMçš„è®¾ç½®å‚æ•°ï¼Œæ¥æŸ¥çœ‹åƒåœ¾æ”¶é›†å™¨çš„å…·ä½“è®¾ç½®å‚æ•°ï¼Œä½¿ç”¨çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚  jcmd pid VM.flags å°±å¯ä»¥æŸ¥çœ‹åˆ°ç›¸å…³çš„è®¾ç½®å‚æ•°ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/26/2e/26d688a3af534fb00fe3b89d261e5c2e.jpg?wh=1926*190\" alt=\"\"></p><p>è¿™é‡Œé™„ä¸Šç¬¬22è®²ä¸­ï¼Œæˆ‘æ€»ç»“çš„å„ä¸ªè®¾ç½®å‚æ•°å¯¹åº”çš„åƒåœ¾æ”¶é›†å™¨å›¾è¡¨ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/e2/56/e29c9ac3e53ffbc8a5648644a87d6256.jpeg?wh=1896*702\" alt=\"\"></p><h2><a href=\"https://time.geekbang.org/column/article/108139\">ç¬¬23è®²</a></h2><p><img src=\"https://static001.geekbang.org/resource/image/bb/76/bb92ec845c715f9d36a6ce48a0c7d276.jpeg?wh=1125*2227\" alt=\"\"></p><p>æˆ‘åˆä¸ä¹±æ¥åŒå­¦çš„ç•™è¨€çœŸæ˜¯æ²¡æœ‰ä¹±æ¥ï¼Œç»†èŠ‚æŒæ¡å¾—å¾ˆå¥½ï¼</p><p>å‰ææ˜¯è€å¹´ä»£æœ‰è¶³å¤Ÿæ¥å—è¿™äº›å¯¹è±¡çš„ç©ºé—´ï¼Œæ‰ä¼šè¿›è¡Œåˆ†é…æ‹…ä¿ã€‚å¦‚æœè€å¹´ä»£å‰©ä½™ç©ºé—´å°äºæ¯æ¬¡Minor GCæ™‹å‡åˆ°è€å¹´ä»£çš„å¹³å‡å€¼ï¼Œåˆ™ä¼šå‘èµ·ä¸€æ¬¡  Full GCã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/28/20/2838514b87e62d69bf51d7a7f12a0c20.jpeg?wh=1125*2271\" alt=\"\"></p><p>çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘å‘ç°çˆ±æé—®çš„åŒå­¦å§‹ç»ˆçˆ±æé—®ï¼Œéå¸¸é¼“åŠ±å•Šï¼ŒæŠ€æœ¯æ˜¯éœ€è¦äº¤æµçš„ï¼Œä¹Ÿæ¬¢è¿ä½ æœ‰ä»»ä½•ç–‘é—®ï¼Œéšæ—¶ç•™è¨€ç»™æˆ‘ï¼Œæˆ‘ä¼šçŸ¥æ— ä¸å°½ã€‚</p><p>ç°åœ¨å›ç­”W.LIåŒå­¦çš„é—®é¢˜ã€‚è¿™ä¸ªä¼šæ ¹æ®æˆ‘ä»¬åˆ›å»ºå¯¹è±¡å ç”¨çš„å†…å­˜ä½¿ç”¨ç‡ï¼Œåˆç†åˆ†é…å†…å­˜ï¼Œå¹¶ä¸ä»…ä»…è€ƒè™‘å¯¹è±¡æ™‹å‡çš„é—®é¢˜ï¼Œè¿˜ä¼šç»¼åˆè€ƒè™‘å›æ”¶åœé¡¿æ—¶é—´ç­‰å› ç´ ã€‚é’ˆå¯¹æŸäº›ç‰¹æ®Šåœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æ¥è°ƒä¼˜é…ç½®ã€‚</p><h2><a href=\"https://time.geekbang.org/column/article/108582\">ç¬¬24è®²</a></h2><p><img src=\"https://static001.geekbang.org/resource/image/10/24/1080a8574a1a1ded35b736ccbec40524.jpeg?wh=1125*1164\" alt=\"\"></p><p>ä¸‹é¢è§£ç­”Geek_75b4cdåŒå­¦çš„é—®é¢˜ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼ŒThreadLocalæ˜¯åŸºäºThreadLocalMapå®ç°çš„ï¼Œè¿™ä¸ªMapçš„Entryç»§æ‰¿äº†WeakReferenceï¼Œè€ŒEntryå¯¹è±¡ä¸­çš„keyä½¿ç”¨äº†WeakReferenceå°è£…ï¼Œä¹Ÿå°±æ˜¯è¯´Entryä¸­çš„keyæ˜¯ä¸€ä¸ªå¼±å¼•ç”¨ç±»å‹ï¼Œè€Œå¼±å¼•ç”¨ç±»å‹åªèƒ½å­˜æ´»åœ¨ä¸‹æ¬¡GCä¹‹å‰ã€‚</p><p>å¦‚æœä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ThreadLocalçš„setè®¾ç½®å˜é‡ï¼Œå½“å‰ThreadLocalMapåˆ™ä¼šæ–°å¢ä¸€æ¡è®°å½•ï¼Œä½†ç”±äºå‘ç”Ÿäº†ä¸€æ¬¡åƒåœ¾å›æ”¶ï¼Œæ­¤æ—¶çš„keyå€¼å°±ä¼šè¢«å›æ”¶ï¼Œè€Œvalueå€¼ä¾ç„¶å­˜åœ¨å†…å­˜ä¸­ï¼Œç”±äºå½“å‰çº¿ç¨‹ä¸€ç›´å­˜åœ¨ï¼Œæ‰€ä»¥valueå€¼å°†ä¸€ç›´è¢«å¼•ç”¨ã€‚.</p><p>è¿™äº›è¢«åƒåœ¾å›æ”¶æ‰çš„keyå°±ä¼šä¸€ç›´å­˜åœ¨ä¸€æ¡å¼•ç”¨é“¾çš„å…³ç³»ï¼šThread --&gt; ThreadLocalMapâ€“&gt;Entryâ€“&gt;Valueã€‚è¿™æ¡å¼•ç”¨é“¾ä¼šå¯¼è‡´Entryä¸ä¼šè¢«å›æ”¶ï¼ŒValueä¹Ÿä¸ä¼šè¢«å›æ”¶ï¼Œä½†Entryä¸­çš„keyå´å·²ç»è¢«å›æ”¶çš„æƒ…å†µå‘ç”Ÿï¼Œä»è€Œé€ æˆå†…å­˜æ³„æ¼ã€‚</p><p>æˆ‘ä»¬åªéœ€è¦åœ¨ä½¿ç”¨å®Œè¯¥keyå€¼ä¹‹åï¼Œå°†valueå€¼é€šè¿‡removeæ–¹æ³•removeæ‰ï¼Œå°±å¯ä»¥é˜²æ­¢å†…å­˜æ³„æ¼äº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/8d/9a/8da35d95d5b31e3f0a582dbd4d47fd9a.jpeg?wh=1125*1252\" alt=\"\"></p><p>æœ€åä¸€ä¸ªé—®é¢˜æ¥è‡ªäºWLåŒå­¦ã€‚</p><p>å†…å­˜æ³„æ¼æ˜¯æŒ‡ä¸å†ä½¿ç”¨çš„å¯¹è±¡æ— æ³•å¾—åˆ°åŠæ—¶çš„å›æ”¶ï¼ŒæŒç»­å ç”¨å†…å­˜ç©ºé—´ï¼Œä»è€Œé€ æˆå†…å­˜ç©ºé—´çš„æµªè´¹ã€‚ä¾‹å¦‚ï¼Œæˆ‘åœ¨<a href=\"https://time.geekbang.org/column/article/97215\">ç¬¬03è®²</a>ä¸­è¯´åˆ°çš„ï¼ŒJava6ä¸­substringæ–¹æ³•å°±å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p><p>å½“è°ƒç”¨substringæ–¹æ³•æ—¶ä¼šè°ƒç”¨new stringæ„é€ å‡½æ•°ï¼Œæ­¤æ—¶ä¼šå¤ç”¨åŸæ¥å­—ç¬¦ä¸²çš„charæ•°ç»„ï¼Œè€Œå¦‚æœæˆ‘ä»¬ä»…ä»…æ˜¯ç”¨substringè·å–ä¸€å°æ®µå­—ç¬¦ï¼Œè€Œåœ¨åŸæœ¬stringå­—ç¬¦ä¸²éå¸¸å¤§çš„æƒ…å†µä¸‹ï¼Œsubstringçš„å¯¹è±¡å¦‚æœä¸€ç›´è¢«å¼•ç”¨ï¼Œç”±äºsubstringé‡Œçš„charæ•°ç»„ä»ç„¶æŒ‡å‘åŸå­—ç¬¦ä¸²ï¼Œæ­¤æ—¶stringå­—ç¬¦ä¸²ä¹Ÿæ— æ³•å›æ”¶ï¼Œä»è€Œå¯¼è‡´å†…å­˜æ³„éœ²ã€‚</p><p>å†…å­˜æº¢å‡ºåˆ™æ˜¯å‘ç”Ÿäº†OutOfMemoryExceptionï¼Œå†…å­˜æº¢å‡ºçš„æƒ…å†µæœ‰å¾ˆå¤šï¼Œä¾‹å¦‚å †å†…å­˜ç©ºé—´ä¸è¶³ï¼Œæ ˆç©ºé—´ä¸è¶³ï¼Œè¿˜æœ‰æ–¹æ³•åŒºç©ºé—´ä¸è¶³ç­‰éƒ½ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºã€‚</p><p>å†…å­˜æ³„æ¼ä¸å†…å­˜æº¢å‡ºçš„å…³ç³»ï¼šå†…å­˜æ³„æ¼å¾ˆå®¹æ˜“å¯¼è‡´å†…å­˜æº¢å‡ºï¼Œä½†å†…å­˜æº¢å‡ºä¸ä¸€å®šæ˜¯å†…å­˜æ³„æ¼å¯¼è‡´çš„ã€‚</p><p>ä»Šå¤©çš„ç­”ç–‘å°±åˆ°è¿™é‡Œï¼Œ<span class=\"orange\">å¦‚æœä½ è¿˜æœ‰å…¶å®ƒé—®é¢˜ï¼Œè¯·åœ¨ç•™è¨€åŒºä¸­æå‡ºï¼Œ</span>æˆ‘ä¼šä¸€ä¸€è§£ç­”ã€‚æœ€åæ¬¢è¿ä½ ç‚¹å‡»â€œè¯·æœ‹å‹è¯»â€ï¼ŒæŠŠä»Šå¤©çš„å†…å®¹åˆ†äº«ç»™èº«è¾¹çš„æœ‹å‹ï¼Œé‚€è¯·ä»–åŠ å…¥è®¨è®ºã€‚</p><p></p>","comments":[{"had_liked":false,"id":130042,"user_name":"å°”å†¬æ©™","can_delete":false,"product_type":"c1","uid":1225224,"ip_address":"","ucode":"0B013A49BC18DA","user_header":"https://static001.geekbang.org/account/avatar/00/12/b2/08/92f42622.jpg","comment_is_top":false,"comment_ctime":1567359932,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"139006313404","product_id":100028001,"comment_content":"è¿™æ˜¯ä¸€é—¨ç¥è¯¾","like_count":33},{"had_liked":false,"id":119249,"user_name":"Nu11PointerEx","can_delete":false,"product_type":"c1","uid":1177802,"ip_address":"","ucode":"D5C19A98F894B7","user_header":"https://static001.geekbang.org/account/avatar/00/11/f8/ca/1a1e190a.jpg","comment_is_top":false,"comment_ctime":1564543290,"is_pvip":false,"replies":[{"id":"44111","content":"å¦‚æœçº¿ç¨‹æ²¡æœ‰é”€æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥keyå€¼ä¾ç„¶å­˜åœ¨å¼•ç”¨ï¼Œå³ä½¿æ˜¯å¼±å¼•ç”¨ï¼Œä¹Ÿä¸ä¼šè¢«å›æ”¶æ‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1564800099,"ip_address":"","comment_id":119249,"utype":1}],"discussion_count":4,"race_medal":0,"score":"23039379770","product_id":100028001,"comment_content":"åˆ˜è€å¸ˆ,æˆ‘æœ‰ä¸ªç–‘é—®ï¼Œæ–‡ä¸­æŒ‡å‡ºå¼±å¼•ç”¨åªèƒ½å­˜æ´»å†ä¸‹æ¬¡GCä¹‹å‰ï¼Œé‚£å‡å¦‚çº¿ç¨‹åœ¨æ­¥éª¤Aè®¾ç½®äº†threadlocalçš„å€¼,ç„¶åéœ€è¦åœ¨æ­¥éª¤Bè¯»å‡ºæ¥ï¼Œä½†æ˜¯åœ¨ABä¹‹é—´å‘ç”Ÿäº†GC,è¿™æ ·ä¼šä¸ä¼šå¯¼è‡´åœ¨æ­¥éª¤Bä¸­æ— æ³•å–åˆ°å¯¹åº”çš„å€¼","like_count":6,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460807,"discussion_content":"å¦‚æœçº¿ç¨‹æ²¡æœ‰é”€æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥keyå€¼ä¾ç„¶å­˜åœ¨å¼•ç”¨ï¼Œå³ä½¿æ˜¯å¼±å¼•ç”¨ï¼Œä¹Ÿä¸ä¼šè¢«å›æ”¶æ‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564800099,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1926759,"avatar":"","nickname":"èµµç‰é—¯","note":"","ucode":"82E85AC08206EA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":230755,"discussion_content":"æˆ‘è§‰å¾—æ—¢ç„¶ä½ è¿˜è¦è¯»ï¼Œè¯´æ˜è¿˜å­˜åœ¨ä¸€ä¸ªå¯¹ThreadLocalå˜é‡çš„å¼ºå¼•ç”¨ï¼Œè¦ä¸ç„¶ä½ æ€ä¹ˆè¯»å•Š","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1586769234,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1591965,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ0F94uoYZQicTtcnDBmbhtc7kZDhKowk41K0G8pZib78swFWv9St1l2fUXX9OakMcmVUAYrLhlEZcQ/132","nickname":"Geek_f9c1a9","note":"","ucode":"147BE9F15BCC56","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591971,"discussion_content":"æ­¥éª¤Aè¿˜å­˜åœ¨ç€å¯¹ThreadLocalçš„å¼ºå¼•ç”¨ï¼Œå°±ä¸ä¼šè¢«å›æ”¶æ‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666967364,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æµ™æ±Ÿ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1937062,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/8e/a6/c3286b61.jpg","nickname":"Javaå’å¢™å·¥ç¨‹å¸ˆ","note":"","ucode":"E76AE44A9C76AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302972,"discussion_content":"å­˜åœ¨å¼ºå¼•ç”¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599101771,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115444,"user_name":"-W.LI-","can_delete":false,"product_type":"c1","uid":1210699,"ip_address":"","ucode":"3556786538664F","user_header":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","comment_is_top":false,"comment_ctime":1563589818,"is_pvip":false,"replies":[{"id":"43561","content":"å¯¹çš„ï¼Œè°ƒç”¨waitä¹‹åï¼Œä¼šè¿›å…¥åˆ°WaitSeté˜Ÿåˆ—ï¼Œå½“è°ƒç”¨notifyä¹‹åï¼Œé»˜è®¤ç­–ç•¥æ˜¯å°†å…¶ä»WaitSeté˜Ÿåˆ—è½¬è‡³EntryListé˜Ÿåˆ—ä¸­ï¼Œå†å°è¯•è·å–é”ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1564452241,"ip_address":"","comment_id":115444,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18743459002","product_id":100028001,"comment_content":"è€å¸ˆå¥½!æœ€è¿‘æ­£å¥½åœ¨çœ‹å¤šçº¿ç¨‹ç¼–ç¨‹æŒ‡å—ã€‚æœ‰ä¸ªä¸œè¥¿æ²¡ææ˜ç™½ã€‚<br>æˆ‘è‡ªå·±å†™äº†ä¸ªdemoæŠŠæ‰€æœ‰çº¿ç¨‹éƒ½åœ¨ä¸´ç•ŒåŒºè°ƒç”¨waitæ–¹æ³•ï¼Œwaitæ–¹æ³•åæ˜¯sleepæ–¹æ³•ã€‚æˆ‘åœ¨ä¸»çº¿ç¨‹è°ƒç”¨äº†notifyall()ï¼Œåœ¨ä¸´ç•ŒåŒºå†…æ‰“å°äº†æ‰€æœ‰çº¿ç¨‹çš„çŠ¶æ€ï¼Œnotifyall()ä¹‹å‰éƒ½æ˜¯waitingï¼Œä¹‹åéƒ½æ˜¯blockedã€‚å‡ºäº†ä¸´ç•ŒåŒºä¹‹ååˆæ‰“å°äº†ä¸€æ¬¡ï¼Œå‘ç°æœ‰ä¸€ä¸ªæ˜¯timed_waitingï¼Œåˆ«çš„è¿˜æ˜¯blockedã€‚<br>ä»è¡¨ç°æ¥çœ‹<br>notifyall():wait-&gt;blocked<br>è°ƒç”¨notifyall()çš„çº¿ç¨‹å‡ºä¸´ç•ŒåŒºé‡Šæ”¾é”é”:<br>ç«äº‰åˆ°é”å®šblocked-&gt;runnableï¼Œåˆ«çš„è¿˜æ˜¯blockedã€‚<br>ä¹‹å‰è€å¸ˆè¯´notifyall()åœ¨å‡ºä¸´ç•ŒåŒºçš„æ—¶å€™è°ƒç”¨æ¯”è¾ƒå¥½ï¼Œå¯ä»¥é˜²æ­¢è¢«å”¤é†’çš„é˜»å¡çŠ¶æ€çº¿ç¨‹ï¼Œç«äº‰ä¸åˆ°é”å†æ¬¡é˜»å¡ã€‚<br>notifyallæ˜¯æœ¬åœ°æ–¹æ³•çœ‹ä¸åˆ°å®ç°ã€‚æˆ‘æƒ³ç¡®è®¤ä¸‹<br>notifyallçš„é€»è¾‘æ˜¯:å”¤é†’waitingçº¿ç¨‹-&gt;å°è¯•è·å–é”-&gt;è·å–ä¸åˆ°blocked?<br>è¿˜æ˜¯:æ‰€æœ‰waitingçŠ¶æ€çº¿ç¨‹-&gt;blockedçŠ¶æ€è¿›å»é”æ± é˜Ÿåˆ—ã€‚(åªæœ‰åœ¨æœ‰çº¿ç¨‹é‡Šæ”¾é”çš„æ—¶å€™(å‡ºä¸´ç•ŒåŒº)æ‰ä¼šä»é”æ± é˜Ÿåˆ—æ‹¿ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å–é”)ã€‚æˆ‘æ¯”è¾ƒå€¾å‘äºç¬¬äºŒç§ã€‚æ²¡çœ‹æºç å¸Œæœ›è€å¸ˆå¸®å¿™è§£æƒ‘ä¸‹ï¼Œæˆ‘ç‰¹æ„ç¿»äº†ä¹‹å‰çš„è¯¾åœ¨é‚£è¾¹ä¹Ÿç•™è¨€äº†ï¼Œè€å¸ˆåœ¨è¿™å›å¤å°±å¥½äº†è°¢è°¢è€å¸ˆ","like_count":4,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459113,"discussion_content":"å¯¹çš„ï¼Œè°ƒç”¨waitä¹‹åï¼Œä¼šè¿›å…¥åˆ°WaitSeté˜Ÿåˆ—ï¼Œå½“è°ƒç”¨notifyä¹‹åï¼Œé»˜è®¤ç­–ç•¥æ˜¯å°†å…¶ä»WaitSeté˜Ÿåˆ—è½¬è‡³EntryListé˜Ÿåˆ—ä¸­ï¼Œå†å°è¯•è·å–é”ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564452241,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":118166,"user_name":"Stalary","can_delete":false,"product_type":"c1","uid":1101749,"ip_address":"","ucode":"F69AFF7C958D31","user_header":"https://static001.geekbang.org/account/avatar/00/10/cf/b5/d1ec6a7d.jpg","comment_is_top":false,"comment_ctime":1564281873,"is_pvip":false,"replies":[{"id":"43394","content":"æ˜¯çš„ï¼Œå¦‚æœæˆ‘ä»¬çš„çº¿ç¨‹åœ¨ä½¿ç”¨ThreadLocalçš„setä¹‹åå°±ç«‹åˆ»é”€æ¯äº†ï¼Œæ­¤æ—¶ä¹‹å‰setçš„çº¿ç¨‹çš„keyå€¼é€šè¿‡åƒåœ¾å›æ”¶å›æ”¶æ‰ï¼Œæ­¤æ—¶valueåˆ™ä¼šå­˜åœ¨å†…å­˜æ³„æ¼ï¼Œè€Œé©¬ä¸Šåˆæœ‰ä¸‹ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ThreadLocalçš„setï¼Œåˆ™ä¼šæ¸…é™¤ä¹‹å‰keyä¸ºnullçš„valueï¼Œè¿™ç§æƒ…å†µä¸‹æ˜¯ä¸ä¼šå‡ºç°å†…å­˜æ³„æ¼çš„ã€‚<br><br>ä¹Ÿå°±æ˜¯ThreadLocalçš„get(),set(),remove()çš„æ—¶å€™éƒ½ä¼šæ¸…é™¤çº¿ç¨‹ThreadLocalMapé‡Œæ‰€æœ‰keyä¸ºnullçš„valueã€‚<br><br>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨setä¹‹åï¼Œsleepä¸‹è¯¥çº¿ç¨‹ï¼Œç­‰å¾…å…¶ä»–è¯·æ±‚éƒ½ä¸€èµ·ä½¿ç”¨å®Œäº†setï¼Œè¿™æ ·å¾ˆå®¹æ˜“é‡ç°å†…å­˜ä¸­çš„ä¸€éƒ¨åˆ†å¯¹è±¡æ— æ³•å›æ”¶æ‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1564365850,"ip_address":"","comment_id":118166,"utype":1}],"discussion_count":3,"race_medal":0,"score":"14449183761","product_id":100028001,"comment_content":"è€å¸ˆï¼ŒThreadLocalä½¿ç”¨çš„æ—¶å€™æˆ‘å­˜å‚¨äº†ä¸€äº›è¯·æ±‚ç›¸å…³çš„ä¸œè¥¿ï¼Œæ²¡æœ‰ä½¿ç”¨removeï¼Œä½†æ˜¯ä¸€æ¬¡è¯·æ±‚ç»“æŸå°±ä¼šè‡ªåŠ¨é‡Šæ”¾æ‰äº†å§ï¼Œæ˜¯ä¸æ˜¯ä¸ä¼šå‡ºç°å†…å­˜æ³„æ¼ï¼Ÿè¿˜æ˜¯æ²¡å¤ªæ˜ç™½å‡ºç°å†…å­˜æ³„æ¼çš„åœºæ™¯ï¼Œçº¿ç¨‹ä¸éƒ½æ˜¯å·¥ä½œå®Œå°±ä¼šé‡Šæ”¾æ‰äº†å—","like_count":3,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460286,"discussion_content":"æ˜¯çš„ï¼Œå¦‚æœæˆ‘ä»¬çš„çº¿ç¨‹åœ¨ä½¿ç”¨ThreadLocalçš„setä¹‹åå°±ç«‹åˆ»é”€æ¯äº†ï¼Œæ­¤æ—¶ä¹‹å‰setçš„çº¿ç¨‹çš„keyå€¼é€šè¿‡åƒåœ¾å›æ”¶å›æ”¶æ‰ï¼Œæ­¤æ—¶valueåˆ™ä¼šå­˜åœ¨å†…å­˜æ³„æ¼ï¼Œè€Œé©¬ä¸Šåˆæœ‰ä¸‹ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ThreadLocalçš„setï¼Œåˆ™ä¼šæ¸…é™¤ä¹‹å‰keyä¸ºnullçš„valueï¼Œè¿™ç§æƒ…å†µä¸‹æ˜¯ä¸ä¼šå‡ºç°å†…å­˜æ³„æ¼çš„ã€‚\n\nä¹Ÿå°±æ˜¯ThreadLocalçš„get(),set(),remove()çš„æ—¶å€™éƒ½ä¼šæ¸…é™¤çº¿ç¨‹ThreadLocalMapé‡Œæ‰€æœ‰keyä¸ºnullçš„valueã€‚\n\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨setä¹‹åï¼Œsleepä¸‹è¯¥çº¿ç¨‹ï¼Œç­‰å¾…å…¶ä»–è¯·æ±‚éƒ½ä¸€èµ·ä½¿ç”¨å®Œäº†setï¼Œè¿™æ ·å¾ˆå®¹æ˜“é‡ç°å†…å­˜ä¸­çš„ä¸€éƒ¨åˆ†å¯¹è±¡æ— æ³•å›æ”¶æ‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564365850,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1263932,"avatar":"https://static001.geekbang.org/account/avatar/00/13/49/3c/5d54c510.jpg","nickname":"é™é™è†å¬","note":"","ucode":"0A8600CB928EFE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333722,"discussion_content":"è€å¸ˆè¯´çš„æœ‰ç‚¹ä¸å¯¹ï¼Œæˆ‘è¡¥å……ä¸‹ï¼Œçº¿ç¨‹å›æ”¶æ‰åï¼Œthreadlocalæ•´ä¸ªå¯¹è±¡ä¹Ÿä¼šè¢«å›æ”¶ï¼Œä¸ä¼šå†…å­˜æ³„éœ²ï¼Œ\nthreadlocalè¿™ä¸ªå¯¹è±¡æ˜¯è¢«å½“å‰çº¿ç¨‹å¼•ç”¨çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607603746,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1139455,"avatar":"https://static001.geekbang.org/account/avatar/00/11/62/ff/f71034e9.jpg","nickname":"æ‚Ÿç©ºWuKong","note":"","ucode":"49AFD2B048C1BA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":44170,"discussion_content":"ä½¿ç”¨çº¿ç¨‹æ± çš„æ—¶å€™ï¼Œæ ¸å¿ƒçº¿ç¨‹æ˜¯ä¸ä¼šé”€æ¯çš„ï¼Œè¿™ç§æƒ…å†µä¸‹æ˜¯ä¸æ˜¯å¿…é¡»è¦æ‰‹åŠ¨removeæ¥æ¸…æ¥švalue","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572936987,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115395,"user_name":"nightmare","can_delete":false,"product_type":"c1","uid":1056314,"ip_address":"","ucode":"EF2E51C2122A86","user_header":"https://static001.geekbang.org/account/avatar/00/10/1e/3a/5b21c01c.jpg","comment_is_top":false,"comment_ctime":1563557049,"is_pvip":false,"replies":[{"id":"42361","content":"å¥½çš„ï¼Œå¯ä»¥è€ƒè™‘ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1563760818,"ip_address":"","comment_id":115395,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14448458937","product_id":100028001,"comment_content":"è€å¸ˆcmså’Œg1èƒ½ä¸èƒ½åŠ é¤è®²è¯¦ç»†ä¸€ç‚¹ å› ä¸ºäº’è”ç½‘å…¬å¸ cmså’Œg1é—®çš„éå¸¸å¤š","like_count":3,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459086,"discussion_content":"å¥½çš„ï¼Œå¯ä»¥è€ƒè™‘ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563760818,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132505,"user_name":"è¡Œåˆ™å°†è‡³","can_delete":false,"product_type":"c1","uid":1542987,"ip_address":"","ucode":"DB972F2DF059C4","user_header":"https://static001.geekbang.org/account/avatar/00/17/8b/4b/fa52d222.jpg","comment_is_top":false,"comment_ctime":1568157494,"is_pvip":false,"replies":[{"id":"50689","content":"ä¸è¡Œï¼Œåªæ˜¯åŸæ¥çš„å¼•ç”¨ç½®ä¸ºnulläº†ï¼Œä½†å †ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡ä¾ç„¶ä¸ä¼šè¢«å›æ”¶æ‰","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1568165106,"ip_address":"","comment_id":132505,"utype":1}],"discussion_count":1,"race_medal":1,"score":"10158092086","product_id":100028001,"comment_content":"è€å¸ˆï¼Œjdk1.6çš„substringå¯¼è‡´å†…å­˜æ³„æ¼çš„é—®é¢˜ã€‚å¤§å­—ç¬¦ä¸²æˆªå–å®Œä¹‹åï¼Œæˆ‘ä»¬ç›´æ¥æŠŠåŸå¤§å­—ç¬¦ä¸²çš„å¼•ç”¨ç½®ä¸ºnullï¼Œå¯ä»¥è§£å†³è¿™ä¸ªå†…å­˜æ³„æ¼çš„é—®é¢˜å—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466977,"discussion_content":"ä¸è¡Œï¼Œåªæ˜¯åŸæ¥çš„å¼•ç”¨ç½®ä¸ºnulläº†ï¼Œä½†å †ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡ä¾ç„¶ä¸ä¼šè¢«å›æ”¶æ‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568165106,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115880,"user_name":"ãƒ¾(â—Â°âˆ‡Â°â—)ï¾‰ï¾","can_delete":false,"product_type":"c1","uid":1044175,"ip_address":"","ucode":"89545632BDA56E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJOBwR7MCVqwZbPA5RQ2mjUjd571jUXUcBCE7lY5vSMibWn8D5S4PzDZMaAhRPdnRBqYbVOBTJibhJg/132","comment_is_top":false,"comment_ctime":1563761162,"is_pvip":false,"replies":[{"id":"43108","content":"æ˜¯çš„ï¼Œå¯¹è±¡çš„å¼•ç”¨ä¹Ÿè¢«æŒ‡å‘æ–°çš„åœ°å€ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1564109599,"ip_address":"","comment_id":115880,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10153695754","product_id":100028001,"comment_content":"javaçš„åƒåœ¾å›æ”¶ä½¿ç”¨çš„æ˜¯å¤åˆ¶ç®—æ³•å’Œæ ‡è®°æ•´ç†ç®—æ³•ï¼Œè¿™æ ·å¯¹è±¡çš„å†…å­˜æ˜¯å˜åŒ–çš„å§ï¼Ÿé‚£ä¹ˆå¼•ç”¨å®ƒçš„æ ˆä¸Šçš„åœ°å€ä¹Ÿä¼šå˜æ‰å—ï¼Ÿå¦‚æœæ˜¯çš„è¯å¦‚æœhashmapçš„keyå¦‚æœæ²¡æœ‰è‡ªå·±å®ç°hashcodeçš„è¯ï¼Œæ˜¯ä¸æ˜¯å°±ä¼šå¼•èµ·äº†å†…å­˜æ³„æ¼å’Œç¨‹åºé”™ä¹±","like_count":2,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459328,"discussion_content":"æ˜¯çš„ï¼Œå¯¹è±¡çš„å¼•ç”¨ä¹Ÿè¢«æŒ‡å‘æ–°çš„åœ°å€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564109599,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115563,"user_name":"Jxin","can_delete":false,"product_type":"c1","uid":1251111,"ip_address":"","ucode":"4C03928388C413","user_header":"https://static001.geekbang.org/account/avatar/00/13/17/27/ec30d30a.jpg","comment_is_top":false,"comment_ctime":1563627545,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10153562137","product_id":100028001,"comment_content":"æŠ›ç –å¼•ç‰äº†ï¼Œæ„Ÿè°¢è€å¸ˆçš„çŸ¥æ— ä¸å°½ã€‚( Â´â—”â€¸â—”`)","like_count":2},{"had_liked":false,"id":132804,"user_name":"é’±","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1568243029,"is_pvip":false,"replies":[{"id":"51109","content":"æˆ‘ä»¬å¯ä»¥è¯»å–å¤§éƒ¨åˆ†è¯»å†™ä¸­é—´ä»¶å®ç°æºç ï¼Œå¯ä»¥å‘ç°ThreadLocalä½¿ç”¨çš„æœ€ä¸ºé¢‘ç¹ï¼Œé€šå¸¸æ˜¯é€šè¿‡ThreadLocalæ¥è·å–å½“å‰çº¿ç¨‹çš„æ“ä½œç±»å‹æ¥å®ç°è¯»å†™æ•°æ®æºçš„åˆ‡æ¢ã€‚<br><br>åœ¨ä½¿ç”¨å®Œä¹‹åå®ç°removeæ“ä½œï¼Œå¯ä»¥è§„é¿é£é™©ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1568534088,"ip_address":"","comment_id":132804,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5863210325","product_id":100028001,"comment_content":"æˆ‘ä»¬çš„é¡¹ç›®ä¸­ThreadLocalä½¿ç”¨çš„è›®å¤šçš„ï¼Œä½¿ç”¨åŸå› æ˜¯å› ä¸ºæ¥å£è°ƒç”¨é“¾é•¿ä¸æƒ³ä¿®æ”¹æ–¹æ³•ç”Ÿå‘½ï¼Œä½†æœ‰äº›å‚æ•°è¦é€ä¼ å°±ç”¨ThreadLocalæ¥é€ä¼ å‚æ•°ã€‚<br>è€å¸ˆèƒ½å¦ä»‹ç»ä¸€ä¸‹é¢˜ThreadLocalçš„æœ€ä½³å®è·µï¼Ÿä»€ä¹ˆåœºæ™¯ä¸‹ä¼šä½¿ç”¨ï¼Ÿæœ‰ä»€ä¹ˆå‘éœ€è¦å¡«ï¼Ÿæ€ä¹ˆè§„é¿é£é™©ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467127,"discussion_content":"æˆ‘ä»¬å¯ä»¥è¯»å–å¤§éƒ¨åˆ†è¯»å†™ä¸­é—´ä»¶å®ç°æºç ï¼Œå¯ä»¥å‘ç°ThreadLocalä½¿ç”¨çš„æœ€ä¸ºé¢‘ç¹ï¼Œé€šå¸¸æ˜¯é€šè¿‡ThreadLocalæ¥è·å–å½“å‰çº¿ç¨‹çš„æ“ä½œç±»å‹æ¥å®ç°è¯»å†™æ•°æ®æºçš„åˆ‡æ¢ã€‚\n\nåœ¨ä½¿ç”¨å®Œä¹‹åå®ç°removeæ“ä½œï¼Œå¯ä»¥è§„é¿é£é™©ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568534088,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1763335,"avatar":"","nickname":"Geek_373e87","note":"","ucode":"9DBAD30E4ED24A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":275946,"discussion_content":"ä¸€èˆ¬ç”¨æ¥ç»´æŠ¤å…¨å±€ä¸Šä¸‹æ–‡ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥ç»´æŠ¤traceIdç­‰ã€‚éœ€è¦æ³¨æ„çš„å°±æ˜¯å†…å­˜æ³„éœ²é—®é¢˜ï¼Œåœ¨finallyä¸­removeä¸‹ï¼Œè¿˜æœ‰TLå¯¹è±¡è¦è®¾ç½®ä¸ºä¸å¯å˜å¯¹è±¡ï¼Œå› ä¸ºå®ƒæ˜¯keyã€‚å¦‚æœå¼•ç”¨å˜äº†ï¼Œå°±æ²¡æ³•æ‰¾åˆ°åŸæ¥çš„valueäº†ã€‚åœ¨çº¿ç¨‹æ± ä½¿ç”¨æ—¶ä¸€å®šè¦remove","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590772996,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1061786,"avatar":"https://static001.geekbang.org/account/avatar/00/10/33/9a/a323b2f1.jpg","nickname":"æ‚ æ‚ å°ç«¹å­","note":"","ucode":"A5E6731D28EBF9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":224532,"discussion_content":"ä½¿ç”¨threadlockä¼ é€’å‚æ•°æœ¬èº«å°±æ˜¯å‘ï¼Œç»´æŠ¤ç«è‘¬åœºå•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586313658,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132560,"user_name":"è¡Œåˆ™å°†è‡³","can_delete":false,"product_type":"c1","uid":1542987,"ip_address":"","ucode":"DB972F2DF059C4","user_header":"https://static001.geekbang.org/account/avatar/00/17/8b/4b/fa52d222.jpg","comment_is_top":false,"comment_ctime":1568166001,"is_pvip":false,"replies":[{"id":"50988","content":"å‡çº§ç‰ˆæœ¬å°±å¥½äº†ï¼Œç°åœ¨åŸºæœ¬éƒ½æ˜¯åŸºäº1.8ç‰ˆæœ¬äº†","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1568423330,"ip_address":"","comment_id":132560,"utype":1}],"discussion_count":2,"race_medal":1,"score":"5863133297","product_id":100028001,"comment_content":"è€å¸ˆï¼Œjdk1.6çš„substringçš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚é™¤äº†å‡çº§jdkç‰ˆæœ¬ï¼Œæ‚¨æœ‰æ²¡æœ‰å…¶ä»–çš„åŠæ³•ã€‚æˆ‘åœ¨ç½‘ä¸Šæœäº†ä¸€ä¸‹ï¼Œæ²¡æœ‰çœ‹åˆ°å•¥å¥½åŠæ³•","like_count":1,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467008,"discussion_content":"å‡çº§ç‰ˆæœ¬å°±å¥½äº†ï¼Œç°åœ¨åŸºæœ¬éƒ½æ˜¯åŸºäº1.8ç‰ˆæœ¬äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568423330,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2243285,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqOD0m6ibmDGTRmfMCW2oNTEGpibMkIRLFibzhTT5uHr0RFIFsCmW8zFsw2N3Pl7bxDZs8RQS4pr6ibhg/132","nickname":"aaa","note":"","ucode":"BE2FDB7D73122D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":361608,"discussion_content":"åŠ ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚åˆ©ç”¨å­—ç¬¦ä¸²æ‹¼æ¥æŠ€æœ¯ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616718218,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":116168,"user_name":"Mq","can_delete":false,"product_type":"c1","uid":1178359,"ip_address":"","ucode":"041F572AFAB275","user_header":"https://static001.geekbang.org/account/avatar/00/11/fa/f7/91ac44c5.jpg","comment_is_top":false,"comment_ctime":1563796755,"is_pvip":false,"replies":[{"id":"43118","content":"å¦‚æœçº¿ç¨‹è¿˜å­˜æ´»ï¼Œæ­¤æ—¶getæ˜¯èƒ½è·å–åˆ°çš„ï¼Œå› ä¸ºè¿˜å­˜åœ¨å¼ºå¼•ç”¨ã€‚å¦‚æœçº¿ç¨‹ç”Ÿå‘½å‘¨æœŸå·²ç»ç»“æŸï¼Œåˆ™ThreadLocalçš„çº¿ç¨‹æœ¬åœ°å˜é‡å°†ä¼šå¤±å»å¼•ç”¨ï¼Œæˆ‘ä»¬çŸ¥é“ThreadLocalæ˜¯æˆå‘˜å˜é‡ï¼Œå¦‚æœkeyå€¼æ²¡æœ‰è®¾ç½®ä¸ºå¼±å¼•ç”¨ï¼Œåˆ™ç»“æŸç”Ÿå‘½å‘¨æœŸçš„çº¿ç¨‹å˜é‡ä¾ç„¶ä¼šå­˜åœ¨ThreadLocalä¸­ã€‚<br>æ‰€ä»¥ï¼Œå½“çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸç»“æŸï¼ŒThreadLocalçš„keyåˆä¸ºäº†å¼±å¼•ç”¨ï¼Œkeyå€¼å°±ä¼šåœ¨åƒåœ¾å›æ”¶æœŸè¢«å›æ”¶æ‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1564118811,"ip_address":"","comment_id":116168,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5858764051","product_id":100028001,"comment_content":"è€å¸ˆthreadlocalçš„entryä¸å›æ”¶æ˜¯å› ä¸ºvalueå—ï¼Œå¦å¤–æˆ‘ä¸ç†è§£jvmæ€ä¹ˆçŸ¥é“æˆ‘è¿™æ¬¡gcçš„æ—¶å€™keyå°±å¯ä»¥å›æ”¶ï¼Œä¼šä¸ä¼šå‡ºç°æˆ‘å¤šæ¬¡getçš„æ—¶å€™æœ‰ä¸€æ¬¡å°±å–ä¸åˆ°äº†","like_count":2,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459420,"discussion_content":"å¦‚æœçº¿ç¨‹è¿˜å­˜æ´»ï¼Œæ­¤æ—¶getæ˜¯èƒ½è·å–åˆ°çš„ï¼Œå› ä¸ºè¿˜å­˜åœ¨å¼ºå¼•ç”¨ã€‚å¦‚æœçº¿ç¨‹ç”Ÿå‘½å‘¨æœŸå·²ç»ç»“æŸï¼Œåˆ™ThreadLocalçš„çº¿ç¨‹æœ¬åœ°å˜é‡å°†ä¼šå¤±å»å¼•ç”¨ï¼Œæˆ‘ä»¬çŸ¥é“ThreadLocalæ˜¯æˆå‘˜å˜é‡ï¼Œå¦‚æœkeyå€¼æ²¡æœ‰è®¾ç½®ä¸ºå¼±å¼•ç”¨ï¼Œåˆ™ç»“æŸç”Ÿå‘½å‘¨æœŸçš„çº¿ç¨‹å˜é‡ä¾ç„¶ä¼šå­˜åœ¨ThreadLocalä¸­ã€‚\næ‰€ä»¥ï¼Œå½“çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸç»“æŸï¼ŒThreadLocalçš„keyåˆä¸ºäº†å¼±å¼•ç”¨ï¼Œkeyå€¼å°±ä¼šåœ¨åƒåœ¾å›æ”¶æœŸè¢«å›æ”¶æ‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564118811,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115854,"user_name":"æ˜ç¿¼","can_delete":false,"product_type":"c1","uid":1068361,"ip_address":"","ucode":"E77F86BEB3D5C1","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","comment_is_top":false,"comment_ctime":1563758772,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5858726068","product_id":100028001,"comment_content":"è¶…å“¥ï¼Œæœ‰é—®é¢˜è¯·æ•™ä¸‹ï¼š<br>1ï¼‰æ›¾ç»è¢«é—®åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯javaå¤šçº¿ç¨‹åˆ†é…å†…å­˜çš„æ—¶å€™æ˜¯å¦‚ä½•æ§åˆ¶å¹¶å‘å†²çªçš„é‚£ï¼Ÿ<br>2ï¼‰èƒ½ä¸èƒ½ç»“åˆä»£ç æŠŠjavaå†…å­˜åˆ›å»ºçš„è¿‡ç¨‹è®²ä¸€æ¬¡ï¼Œæ¯”å¦‚æˆå‘˜å˜é‡çš„å¼•ç”¨æ˜¯åœ¨å“ªé‡Œåˆ†é…çš„ï¼ˆæˆ‘ç†è§£æ˜¯å †ä¸Šï¼‰ï¼Œå †ä¸Šè¿˜æ˜¯æ ˆä¸Šï¼Œä¸´æ—¶å˜é‡é‚£ï¼Œé€šè¿‡è¿™ç§æ•´ä½“çš„è®²è§£ä¼šå¯¹æˆ‘ä»¬å°è±¡æ¯”è¾ƒæ·±åˆ»ã€‚","like_count":1,"discussions":[{"author":{"id":1763335,"avatar":"","nickname":"Geek_373e87","note":"","ucode":"9DBAD30E4ED24A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":275944,"discussion_content":"TLABå’ŒCAS","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590772295,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1099053,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c5/2d/1eebfc3c.jpg","nickname":"GaGiî","note":"","ucode":"CC8D22E1DD8CA2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":256426,"discussion_content":"ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œæ˜¯ä½¿ç”¨TLABé¢„åˆ†é…å †å†…å­˜æ¥è§£å†³","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588479321,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":213385,"user_name":"ty_young","can_delete":false,"product_type":"c1","uid":1284337,"ip_address":"","ucode":"EB1D5DB0AE7B33","user_header":"","comment_is_top":false,"comment_ctime":1588400257,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1588400257","product_id":100028001,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œcard tableåªæ˜¯è€å¹´ä»£æ‰ç»´æŠ¤çš„å§ï¼Œé‚£G1åƒåœ¾æ”¶é›†å™¨çš„RSetä¹Ÿæ˜¯åªç»´æŠ¤è€å¹´ä»£çš„å¼•ç”¨ä¹ˆ(è€å¹´ä»£å¼•ç”¨å¹´è½»ä»£å’Œè€å¹´ä»£å¼•ç”¨è€å¹´ä»£)","like_count":0,"discussions":[{"author":{"id":1763335,"avatar":"","nickname":"Geek_373e87","note":"","ucode":"9DBAD30E4ED24A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":275945,"discussion_content":"ä¸ï¼Œcmsçš„åªæ˜¯å¹´è½»ä»£ç»´æŠ¤çš„ã€‚é¦–å…ˆè¦ç†è§£ä¸ºå•¥è¦ç»´æŠ¤å¡è¡¨ã€‚æ˜¯ä¸ºäº†è§£å†³è·¨ä»£å¼•ç”¨é—®é¢˜ï¼Œå¦‚æœå¹´è½»ä»£å¼•ç”¨äº†è€å¹´ä»£å¯¹è±¡ï¼Œåœ¨å¯è¾¾æ€§åˆ†æçš„æ—¶å€™å°±è¦éå†å…¨éƒ¨è€å¹´ä»£ï¼Œæ‰èƒ½çŸ¥é“ï¼Œæ‰€ä»¥åœ¨å¹´è½»ä»£ç»´æŠ¤äº†å¡è¡¨ï¼ŒæŒ‡å‘ä¸€ä¸ªè€å¹´ä»£çš„å†…å­˜åœ°å€ï¼Œåªéœ€è¦éå†ä¸€ç‚¹ç©ºé—´å°±è¡Œäº†ã€‚è€Œè€å¹´ä»£å¼•ç”¨äº†å¹´è½»ä»£å¯¹è±¡æ˜¯ä¸å¤ªå¯èƒ½çš„ï¼Œå¹´è½»ä»£è¢«å¼•ç”¨å¯¹è±¡ä¸€å®šä¼šæ™‹å‡åˆ°è€å¹´ä»£ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1590772696,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":212649,"user_name":"ty_young","can_delete":false,"product_type":"c1","uid":1284337,"ip_address":"","ucode":"EB1D5DB0AE7B33","user_header":"","comment_is_top":false,"comment_ctime":1588169804,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588169804","product_id":100028001,"comment_content":"æ±‚è€å¸ˆæŠŠcmsï¼Œg1è®²å¾—è¯¦ç»†ç‚¹ï¼Œæ±‚åŠ é¤","like_count":0},{"had_liked":false,"id":174002,"user_name":"asura","can_delete":false,"product_type":"c1","uid":1105148,"ip_address":"","ucode":"4AF66C19B4AE65","user_header":"https://static001.geekbang.org/account/avatar/00/10/dc/fc/5c3ad841.jpg","comment_is_top":false,"comment_ctime":1579863448,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579863448","product_id":100028001,"comment_content":"æ¯æ¬¡çœ‹å®Œè¯¾ç¨‹ï¼Œè¯¾åè¯„è®ºä¹Ÿä¼šçœ‹å®Œã€‚å¤§å®¶çœ‹é—®é¢˜çš„è§’åº¦ä¸åŒï¼Œæ€è€ƒçº¬åº¦ä¹Ÿä¸åŒï¼Œç€å®å­¦åˆ°äº†å¾ˆå¤š ğŸ‘ã€‚æ„Ÿè°¢è€å¸ˆçš„çƒ­æƒ…å›ç­”ï¼","like_count":0},{"had_liked":false,"id":145079,"user_name":"ty_young","can_delete":false,"product_type":"c1","uid":1284337,"ip_address":"","ucode":"EB1D5DB0AE7B33","user_header":"","comment_is_top":false,"comment_ctime":1572182285,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572182285","product_id":100028001,"comment_content":"çœŸçš„å—ç›Šé¢‡å¤šï¼Œè°¢è°¢è€å¸ˆ","like_count":0}]}