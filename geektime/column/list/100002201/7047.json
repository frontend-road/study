{"id":7047,"title":"61 | 性能设计篇之“秒杀”","content":"<p>你好，我是陈皓，网名左耳朵耗子。</p>\n<p>一说起秒杀，大家都觉得这事很有技术含量。实际上，并不是这个样子的，秒杀这种互联网的交易方式其实并没有我们想象中的那么复杂。下面先让我们来系统地看一下，秒杀是怎么做的。</p>\n<h1>秒杀的流程</h1>\n<p>“秒杀”其实是商家为了促销，使用非常低的价格销售商品，比如，1元卖iPhone，100台，于是来了一百万人抢购。</p>\n<p>我们把技术挑战放在一边，先从用户或是产品的角度来看一下，秒杀的流程是什么样的。</p>\n<ul>\n<li>首先，你需要一个秒杀的landing page，在这个秒杀页上有一个倒计时的按钮。</li>\n<li>一旦这个倒计时的时间到了，按钮就被点亮，让你可以点击按钮下单。</li>\n<li>一般来说下单时需要你填写一个校验码，以防止是机器来抢。</li>\n</ul>\n<p>从技术上来说，这个倒计时按钮上的时间和按钮可以被点击的时间是需要后台服务器来校准的，这意味着：</p>\n<ul>\n<li>前端页面要不断地向后端来请求，开没开始，开没开始……</li>\n<li>每次询问的时候，后端都会给前端一个时间，以校准前端的时间。</li>\n<li>一旦后端服务器表示OK可以开始，后端服务会返回一个URL。</li>\n<li>这个URL会被安置在那个按钮上，就可以点击了。</li>\n<li>点击后，如果抢到了库存，就进入支付页面，如果没有则返回秒杀已结束。</li>\n</ul>\n<p>这个不断轮询的过程，就好像大家等着抢。你想想，有100万人来不停地询问有没有开始了这个事，估计后端也扛不住。</p>\n<!-- [[[read_end]]] -->\n<h1>秒杀的技术挑战</h1>\n<p>接下来，我们需要来看一下“秒杀”的技术挑战。</p>\n<p>面对上面我们要解决的技术问题，我们的技术上的挑战就是怎么应对这100万人同时下单请求？100万的同时并发会导致我们的网站瞬间就崩溃了，一方面是100万人同时请求，我们的网络带宽不够，另一方面是理论上来说要扛100万的TPS，需要非常多的机器。</p>\n<p>但是最恐怖的是，所有的请求都会集中在同一条数据库记录上，无论是怎么分库分表，还是使用了分布式数据库都无济于事，因为你面对的是单条的热点数据。</p>\n<p>这几乎是一件无法解决的技术问题。</p>\n<h1>秒杀的解决方案</h1>\n<p>很明显，要让100万用户能够在同一时间打开一个页面，这个时候，我们就需要用到CDN了。数据中心肯定是扛不住的，所以，我们要引入CDN。</p>\n<p>在CDN上，这100万个用户就会被几十个甚至上百个CDN的边缘结点给分担了，于是就能够扛得住。然后，我们还需要在这些CDN结点上做点小文章。</p>\n<p>一方面，我们需要把小服务部署到CDN结点上去，这样，当前端页面来问开没开始时，这个小服务除了告诉前端开没开始外，它还可以统计下有多少人在线。每个小服务会把当前在线等待秒杀的人数每隔一段时间就回传给我们的数据中心，于是我们就知道全网总共在线的人数有多少。</p>\n<p>假设，我们知道有大约100万的人在线等着抢，那么，在我们快要开始的时候，由数据中心向各个部署在CDN结点上的小服务上传递一个概率值，比如说是0.02%。</p>\n<p>于是，当秒杀开始的时候，这100万用户都在点下单按钮，首先他们请求到的是CDN上的这些服务，这些小服务按照0.02%的量把用户放到后面的数据中心，也就是1万个人放过去两个，剩下的9998个都直接返回秒杀已结束。</p>\n<p>于是，100万用户被放过了0.02%的用户，也就是200个左右，而这200个人在数据中心抢那100个iPhone，也就是200 TPS，这个并发量怎么都应该能扛住了。</p>\n<p>这就是整个“秒杀”的技术细节，是不是有点不敢相信？</p>\n<p>说到这里，我相信你一定会问我12306和奥运会抢票的问题。我觉得2008年奥运会抢票把服务器抢挂了是可以使用秒杀这个解决方案的。而12306则不行，因为他们完全不知道用户来是要买哪张火车票的。不知道这个信息，很不好过滤用户，而且用户在买票前需要有很多查询操作，然后在查询中选择自己的车票。</p>\n<p>对此，12306最好的应对方式，除了不要一次把所有的票放出来，而是分批在不同的时间段把票放出来，这样可以让人们不要集中在一个时间点来抢票，做到人肉分流，可以降低一些并发度。</p>\n<p>另外，我一直觉得，12306最好是用预售的方式，让大家把自己的购票先输入到系统中。系统并不真正放票，而是把大家的需求都收集好，然后做整体统筹安排，该增加车次的增加车次，该加车厢的加车厢，这样可以确保大家都能走。实在不行，那就抽签了。</p>\n<h1>更多的思考</h1>\n<p>我们可以看到，解决秒杀这种特定业务场景，可以使用CDN的边缘结点来扛流量，然后过滤用户请求（限流用户请求），来保护数据中心的系统，这样才让整个秒杀得以顺利进行。</p>\n<p>那么，如果我们像双11那样，想尽可能多地卖出商品，那么就不像秒杀了。这是要尽可能多地收订单，但又不能超过库存，其中还有大量的银行支付，各大仓库的库存查询和分配，这些都是非常慢的操作。为了保证一致性，还要能够扛得住像双11这样的大规模并发访问，那么，应该怎么做呢？</p>\n<p>使用秒杀这样的解决方案基本上不太科学了。这个时候就需要认认真真地做高并发的架构和测试了，需要各个系统把自己的性能调整上去，还要小心地做性能规划，更要把分布式的弹力设计做好，最后是要不停地做性能测试，找到整个架构的系统瓶颈，然后不断地做水平扩展，以解决大规模的并发。</p>\n<p>但是，从另一方面来说，像我们用边缘结点来解决秒杀这样的场景的玩法，是否也有一定的普适性？这里，我想说，一定是有的。</p>\n<p>有些时候，我们总是在想数据中心的解决方案。其实，我们有时候也需要换一换思路，也许，在数据中心解决并不一定是最好的方式，放在边缘来解决可能会更好一些。尤其是针对一些有地域特征的业务，比如像外卖、共享单车、打车这样的业务。其实，把一些简单的业务逻辑放在边缘，比放在数据中心不但能够有更好的性能，还有更便宜的成本。</p>\n<p>我觉得，随着请求量越来越大，数据也越来越多，数据中心是有点到瓶颈了，而需要边缘结点来帮忙了。而且，这个边缘化解决方案的趋势也会越来越有优势。</p>\n<p>在这里，我先按住不表，因为这是我的创业方向，我会在下一篇文章，也是本系列的最后一篇文章，向你介绍边缘计算以及我想用边缘计算干些什么事。</p>\n<h1>小结</h1>\n<p>好了，我们来总结一下今天分享的主要内容。首先，我介绍了秒杀。先是分析了其业务流程，并列举了其所面临的技术挑战，随后介绍了其解决方案。接着，分析了相关的奥运会和12306抢票问题，以及双十一购物节问题。</p>\n<p>它们各自有不同的解决思路，其中双十一则要求我们必须认认真真地用高并发架构来应对。最后，从秒杀解决方案中的CDN边缘节点计算，我引出了普适的边缘节点计算。下节课，我们详细讲述边缘计算。希望对你有帮助。</p>\n<p>也欢迎你分享一下你参与过秒杀系统的构建吗？双十一呢？解决方案是怎样的呢？</p>\n<p>文末给出了《分布式系统设计模式》系列文章的目录，希望你能在这个列表里找到自己感兴趣的内容。</p>\n<ul>\n<li>弹力设计篇\n<ul>\n<li><a href=\"https://time.geekbang.org/column/article/3912\">认识故障和弹力设计</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/3917\">隔离设计Bulkheads</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/3926\">异步通讯设计Asynchronous</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/4050\">幂等性设计Idempotency</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/4086\">服务的状态State</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/4087\">补偿事务Compensating Transaction</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/4121\">重试设计Retry</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/4241\">熔断设计Circuit Breaker</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/4245\">限流设计Throttle</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/4252\">降级设计degradation</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/4253\">弹力设计总结</a></li>\n</ul>\n</li>\n<li>管理设计篇\n<ul>\n<li><a href=\"https://time.geekbang.org/column/article/5175\">分布式锁Distributed Lock</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/5819\">配置中心Configuration Management</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/5909\">边车模式Sidecar</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/5920\">服务网格Service Mesh</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/6086\">网关模式Gateway</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/6283\">部署升级策略</a></li>\n</ul>\n</li>\n<li>性能设计篇\n<ul>\n<li><a href=\"https://time.geekbang.org/column/article/6282\">缓存Cache</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/7036\">异步处理Asynchronous</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/7045\">数据库扩展</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/7047\">秒杀Flash Sales</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/7086\">边缘计算Edge Computing</a></li>\n</ul>\n</li>\n</ul>\n","comments":[{"had_liked":false,"id":9538,"user_name":"曾经的十字镐","can_delete":false,"product_type":"c1","uid":1083415,"ip_address":"","ucode":"EC9297BEC3085F","user_header":"https://static001.geekbang.org/account/avatar/00/10/88/17/68aa48cb.jpg","comment_is_top":false,"comment_ctime":1526949697,"is_pvip":false,"replies":[{"id":"2934","content":"还想问一下具体哪方面我可以改进？或是你想了解什么样的内容？","user_name":"作者回复","user_name_real":"左耳朵","uid":"1001269","ctime":1526977237,"ip_address":"","comment_id":9538,"utype":1}],"discussion_count":2,"race_medal":0,"score":"254930020161","product_id":100002201,"comment_content":"最近文章有点水呀","like_count":59,"discussions":[{"author":{"id":1001269,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/35/89726f5f.jpg","nickname":"左耳朵","note":"","ucode":"8A4741D677702E","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418107,"discussion_content":"还想问一下具体哪方面我可以改进？或是你想了解什么样的内容？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1526977237,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1702997,"avatar":"https://static001.geekbang.org/account/avatar/00/19/fc/55/e03bb6db.jpg","nickname":"i-neojos","note":"","ucode":"1808C25269948A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":569473,"discussion_content":"up","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651454927,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":9789,"user_name":"一飞","can_delete":false,"product_type":"c1","uid":1059308,"ip_address":"","ucode":"A51A3714D6E5AB","user_header":"https://static001.geekbang.org/account/avatar/00/10/29/ec/19566a0a.jpg","comment_is_top":false,"comment_ctime":1527086143,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"121786170431","product_id":100002201,"comment_content":"某东逻辑是这样的：网关限流，单机限流（流量值可以在压测时评估出来），redis 扣减库存key（定时load库存），数据库扣减库存，如果都成功的话，用户拿到这个券了。","like_count":29,"discussions":[{"author":{"id":1332352,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/sic7iatOg6ibkc8ZfWke5mKfgTK8gJ6CVLDFp4D8LuGOMMHbOnNhu81EA3Kfjg95tWqeySgJxvTQSdPkwOHAuBybg/132","nickname":"Geek_092552","note":"","ucode":"FE13A36E15DBA3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":354762,"discussion_content":"网关能支持这么大的并发吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615339665,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":9525,"user_name":"mgxian","can_delete":false,"product_type":"c1","uid":1014806,"ip_address":"","ucode":"7B7E77E6A83B87","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7c/16/4d1e5cc1.jpg","comment_is_top":false,"comment_ctime":1526948446,"is_pvip":false,"replies":[{"id":"2931","content":"CDN当然可以执行逻辑，但是你要去谈商务合作。","user_name":"作者回复","user_name_real":"左耳朵","uid":"1001269","ctime":1526974792,"ip_address":"","comment_id":9525,"utype":1}],"discussion_count":4,"race_medal":0,"score":"121786032734","product_id":100002201,"comment_content":"文章里说的CDN是我们平常是的CDN吗？ CDN不是只能缓存一些静态内容的吗？难道还可以放代码，执行业务逻辑吗？","like_count":29,"discussions":[{"author":{"id":1001269,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/35/89726f5f.jpg","nickname":"左耳朵","note":"","ucode":"8A4741D677702E","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418100,"discussion_content":"CDN当然可以执行逻辑，但是你要去谈商务合作。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1526974792,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1520703,"avatar":"https://static001.geekbang.org/account/avatar/00/17/34/3f/53aca22e.jpg","nickname":"ken","note":"","ucode":"DCAFD1DD5C6A0C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394613,"discussion_content":"那我想问你一下，如果商务那边不能执行逻辑，还有没有其他解决方案乃？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631955049,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1945788,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJib08Z8K6zgp5xibjKLupKQxibztk8703326bSP7gC84u07g6GGwrAtPqUQN5ajIS7WKOMNHQ3ptatg/132","nickname":"高见","note":"","ucode":"55E21373F78E8B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":244801,"discussion_content":"cdn加逻辑一般要多少钱？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587632530,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2446418,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/zdK3dSkFwicZHtx5CLAKFJRORRibq2YqvHOP0tySLxVx0X1oD9AJanan2wia2hHaswgxdrCzEEGyVgFTVZ8sElTzQ/132","nickname":"Geek_fbfc4f","note":"","ucode":"7010B242A3F474","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1945788,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJib08Z8K6zgp5xibjKLupKQxibztk8703326bSP7gC84u07g6GGwrAtPqUQN5ajIS7WKOMNHQ3ptatg/132","nickname":"高见","note":"","ucode":"55E21373F78E8B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374722,"discussion_content":"。。直接问服务商比这里问好吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621325963,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":244801,"ip_address":""},"score":374722,"extra":""}]}]},{"had_liked":false,"id":9657,"user_name":"路西法","can_delete":false,"product_type":"c1","uid":1078911,"ip_address":"","ucode":"63169B0823C12A","user_header":"https://static001.geekbang.org/account/avatar/00/10/76/7f/0ab2763d.jpg","comment_is_top":false,"comment_ctime":1527005417,"is_pvip":false,"replies":[{"id":"3085","content":"这篇文章只专注讲秒杀这一个案例，不讲性能调优。","user_name":"作者回复","user_name_real":"左耳朵","uid":"1001269","ctime":1527183867,"ip_address":"","comment_id":9657,"utype":1}],"discussion_count":2,"race_medal":0,"score":"61656547561","product_id":100002201,"comment_content":"耗子哥这章有点凑字数啊 ，能专注于讲点秒杀方案吗，例如后端如何hold住请求、能否利用websocket或http2异步响应提高吞吐、能否保证请求有序-先到先得、小米网抢购做的出神入化，能否也聊下，哈哈","like_count":15,"discussions":[{"author":{"id":1001269,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/35/89726f5f.jpg","nickname":"左耳朵","note":"","ucode":"8A4741D677702E","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418152,"discussion_content":"这篇文章只专注讲秒杀这一个案例，不讲性能调优。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527183867,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2446418,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/zdK3dSkFwicZHtx5CLAKFJRORRibq2YqvHOP0tySLxVx0X1oD9AJanan2wia2hHaswgxdrCzEEGyVgFTVZ8sElTzQ/132","nickname":"Geek_fbfc4f","note":"","ucode":"7010B242A3F474","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374723,"discussion_content":"有专门的文章。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621325987,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":9598,"user_name":"chenc","can_delete":false,"product_type":"c1","uid":1026901,"ip_address":"","ucode":"6EF16BE3CEA9B0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ab/55/5242e583.jpg","comment_is_top":false,"comment_ctime":1526978997,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"61656521141","product_id":100002201,"comment_content":"我们微信发红包的一个解决方案，cdn上放静态排队页面，js随机数0.5%的概率进入真正的红包领取页面。活动时用微信公众号推送cdn排队地址。虽然排队页面上可以直接看到真实地址，但是基本能过滤大部分请求了。","like_count":14,"discussions":[{"author":{"id":1332352,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/sic7iatOg6ibkc8ZfWke5mKfgTK8gJ6CVLDFp4D8LuGOMMHbOnNhu81EA3Kfjg95tWqeySgJxvTQSdPkwOHAuBybg/132","nickname":"Geek_092552","note":"","ucode":"FE13A36E15DBA3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":354765,"discussion_content":"js可能被篡改吧？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615339773,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2009734,"avatar":"","nickname":"一墨","note":"","ucode":"2EFB72EEC69FE2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":281391,"discussion_content":"感谢@chenc和作者, 果然大体思路和文中说的一致, 细节我自己再google挖一挖","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591718281,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":9522,"user_name":"Just4test","can_delete":false,"product_type":"c1","uid":1046848,"ip_address":"","ucode":"F10FF54BF3D26D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f9/40/6c9773fd.jpg","comment_is_top":false,"comment_ctime":1526947723,"is_pvip":false,"replies":[{"id":"2935","content":"还有更多的场景。这也是我创业的一个方向。","user_name":"作者回复","user_name_real":"左耳朵","uid":"1001269","ctime":1526977278,"ip_address":"","comment_id":9522,"utype":1}],"discussion_count":1,"race_medal":0,"score":"53066555275","product_id":100002201,"comment_content":"最近在研究Lambda@Edge，和这个场景完全契合。","like_count":12,"discussions":[{"author":{"id":1001269,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/35/89726f5f.jpg","nickname":"左耳朵","note":"","ucode":"8A4741D677702E","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418099,"discussion_content":"还有更多的场景。这也是我创业的一个方向。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1526977278,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":9590,"user_name":"风华神使","can_delete":false,"product_type":"c1","uid":1119845,"ip_address":"","ucode":"ECAAB52216820D","user_header":"https://static001.geekbang.org/account/avatar/00/11/16/65/c22b4415.jpg","comment_is_top":false,"comment_ctime":1526968514,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"40181674178","product_id":100002201,"comment_content":"楼上，cdn是可以部署程序的。个别公司还尝试过把nodejs部署到cdn上","like_count":9},{"had_liked":false,"id":9553,"user_name":"anti corruption","can_delete":false,"product_type":"c1","uid":1059642,"ip_address":"","ucode":"5B52A77D204D8D","user_header":"https://static001.geekbang.org/account/avatar/00/10/2b/3a/adb219e7.jpg","comment_is_top":false,"comment_ctime":1526951207,"is_pvip":false,"replies":[{"id":"2933","content":"最好是FaaS，像AWS的Lambda一样","user_name":"作者回复","user_name_real":"左耳朵","uid":"1001269","ctime":1526977156,"ip_address":"","comment_id":9553,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27296754983","product_id":100002201,"comment_content":"能运行逻辑的cdn的确是很屌的<br>lua么 皓哥","like_count":6,"discussions":[{"author":{"id":1001269,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/35/89726f5f.jpg","nickname":"左耳朵","note":"","ucode":"8A4741D677702E","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418113,"discussion_content":"最好是FaaS，像AWS的Lambda一样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1526977156,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":14527,"user_name":"FOCUS","can_delete":false,"product_type":"c1","uid":1140080,"ip_address":"","ucode":"DFE3078B632026","user_header":"https://static001.geekbang.org/account/avatar/00/11/65/70/7e137498.jpg","comment_is_top":false,"comment_ctime":1530511825,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"18710381009","product_id":100002201,"comment_content":"1 万人，放过 2 个到数据中心。<br><br>可是，这 1 万个请求，肯定是不同时到达的。<br><br>问题1、这也就是说，这种活动根本无法做到真正的公平？<br><br>问题2、边缘结算，是不是可以应用到视频网站应用啊？","like_count":4,"discussions":[{"author":{"id":1187545,"avatar":"https://static001.geekbang.org/account/avatar/00/12/1e/d9/cb12e020.jpg","nickname":"豆豆","note":"","ucode":"F38848C82F7520","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":136736,"discussion_content":"跟同时到达与否有啥关系，秒杀不论怎么搞，都很公平，就是随机。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579160248,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1993770,"avatar":"","nickname":"Geek_5cea88","note":"","ucode":"D3011486E5FBD1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1187545,"avatar":"https://static001.geekbang.org/account/avatar/00/12/1e/d9/cb12e020.jpg","nickname":"豆豆","note":"","ucode":"F38848C82F7520","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":289150,"discussion_content":"秒杀是谁快谁得,手快有,手慢无。理应是一个队列，先进先得的过程。跟概率有啥关系，扯上概率就不公平了","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1594006994,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":136736,"ip_address":""},"score":289150,"extra":""},{"author":{"id":1319157,"avatar":"https://static001.geekbang.org/account/avatar/00/14/20/f5/6cdbfa90.jpg","nickname":"刘匿名","note":"","ucode":"CB4C1DC8C1BB31","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1993770,"avatar":"","nickname":"Geek_5cea88","note":"","ucode":"D3011486E5FBD1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":313127,"discussion_content":"深表赞同，尽管对于服务提供者来说效果一样，但是对于用户来说，秒杀和网速手速无关，而是命中注定这件事，还是让人觉得不公平吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602949142,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":289150,"ip_address":""},"score":313127,"extra":""}]}]},{"had_liked":false,"id":9574,"user_name":"华烬","can_delete":false,"product_type":"c1","uid":1008444,"ip_address":"","ucode":"D36AE0FBEF665A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/63/3c/b4cfbce9.jpg","comment_is_top":false,"comment_ctime":1526954140,"is_pvip":false,"replies":[{"id":"2932","content":"前面的限流模式有讲","user_name":"作者回复","user_name_real":"左耳朵","uid":"1001269","ctime":1526977108,"ip_address":"","comment_id":9574,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18706823324","product_id":100002201,"comment_content":"个人理解，秒杀要做到最底层数据库无压力，上面每层要进行层层过滤和限制，以达到最后到数据库只有少量请求，比如针对ip限制，不能多次请求，应用层进行数量上的限制，因为你知道自己有多少库存等等吧，cdn方式如何我个人不了解，但针对限制和过滤方面介绍很少啊","like_count":4,"discussions":[{"author":{"id":1001269,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/35/89726f5f.jpg","nickname":"左耳朵","note":"","ucode":"8A4741D677702E","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418120,"discussion_content":"前面的限流模式有讲","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1526977108,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":253929,"user_name":"刘匿名","can_delete":false,"product_type":"c1","uid":1319157,"ip_address":"","ucode":"CB4C1DC8C1BB31","user_header":"https://static001.geekbang.org/account/avatar/00/14/20/f5/6cdbfa90.jpg","comment_is_top":false,"comment_ctime":1602949793,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"14487851681","product_id":100002201,"comment_content":"平时谈秒杀，我们一般习惯性从业务服务或者数据中心出发考虑怎么解决问题，文章里提的通过边缘节点过滤请求，降低业务压力的思路倒是很少想过。<br>这种思路的确很通用，很多场景下都用得到，感谢","like_count":4},{"had_liked":false,"id":245353,"user_name":"固态U盘","can_delete":false,"product_type":"c1","uid":1043446,"ip_address":"","ucode":"9C473DA25CB4C1","user_header":"https://static001.geekbang.org/account/avatar/00/0f/eb/f6/ec7971f4.jpg","comment_is_top":false,"comment_ctime":1598922713,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14483824601","product_id":100002201,"comment_content":"多谢浩哥的详细解答。面试用上了。","like_count":4},{"had_liked":false,"id":211390,"user_name":"刘欣洲","can_delete":false,"product_type":"c1","uid":1020871,"ip_address":"","ucode":"767B7D80D01623","user_header":"https://static001.geekbang.org/account/avatar/00/0f/93/c7/1640226d.jpg","comment_is_top":false,"comment_ctime":1587956717,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10177891309","product_id":100002201,"comment_content":"简单设计，解决大问题，很有收获","like_count":2},{"had_liked":false,"id":9632,"user_name":"顾慎为","can_delete":false,"product_type":"c1","uid":1118826,"ip_address":"","ucode":"E58CCF424A7B79","user_header":"https://static001.geekbang.org/account/avatar/00/11/12/6a/25a97cce.jpg","comment_is_top":false,"comment_ctime":1526995261,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10116929853","product_id":100002201,"comment_content":"边缘计算和雾计算有没有什么关联呀？","like_count":2,"discussions":[{"author":{"id":1000070,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/86/d05de870.jpg","nickname":"Xiang","note":"","ucode":"374744FF627C00","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":33146,"discussion_content":"雾计算是针对 海量物联网设备的吧，就是计算放在物联网设备上计算","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571102318,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":9528,"user_name":"王喜糖","can_delete":false,"product_type":"c1","uid":1061260,"ip_address":"","ucode":"7E1CC86B9EABFE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTID49TgGdY2NDIAexCGibmgDJImgT0EdLaEKfz2SiaiaaZdgQ3MwbiaTH1vN0pQOCdia9MnQ6g6yRdicIPA/132","comment_is_top":false,"comment_ctime":1526948557,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10116883149","product_id":100002201,"comment_content":"原来秒杀背后是这么玩的","like_count":2},{"had_liked":false,"id":210454,"user_name":"Geek_CK2020","can_delete":false,"product_type":"c1","uid":1961826,"ip_address":"","ucode":"5DF4BE058F5A58","user_header":"https://static001.geekbang.org/account/avatar/00/1d/ef/62/87d9ef62.jpg","comment_is_top":false,"comment_ctime":1587747181,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5882714477","product_id":100002201,"comment_content":"有意思的秒杀，把集中式的概率分散到分布式的边缘","like_count":1},{"had_liked":false,"id":149268,"user_name":"guhowo","can_delete":false,"product_type":"c1","uid":1143767,"ip_address":"","ucode":"5B7FB80766C07E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqz1bZVBb2NOibN2bbRZhv8alB38W8d7ujib9oPyVBvoQiahtN2OEUicCWFiadtdjCUs8Gkp0IG7KURZzA/132","comment_is_top":false,"comment_ctime":1573180773,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5868148069","product_id":100002201,"comment_content":"耗子哥，请问：如果按照每个cdn的0.02%请求转发的后台数据中心，那么后台就收到了总请求量的0.02%，但是有个场景CDN A的第0.03%个请求可能比CDN B的第0.02个请求还要快，那么岂不是对连接到A的用户不太公平了么？","like_count":2},{"had_liked":false,"id":11928,"user_name":"颇忒妥","can_delete":false,"product_type":"c1","uid":1026448,"ip_address":"","ucode":"AA86AD1049BC2E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a9/90/0c5ed3d9.jpg","comment_is_top":false,"comment_ctime":1528443501,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5823410797","product_id":100002201,"comment_content":"受益良多。顺便有个请求，能把文章最后的链接补上吗？现在都是文本，不是超链。","like_count":1},{"had_liked":false,"id":9586,"user_name":"飞翔","can_delete":false,"product_type":"c1","uid":1065986,"ip_address":"","ucode":"3D3D10273BED18","user_header":"https://static001.geekbang.org/account/avatar/00/10/44/02/5c8e4b81.jpg","comment_is_top":false,"comment_ctime":1526964532,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5821931828","product_id":100002201,"comment_content":"看到这个 我想到我们做saas系统 经常部分客户被别人ddos攻击 导致我们整个系统不稳定 是否用这个方法可以解决 ？","like_count":1},{"had_liked":false,"id":9560,"user_name":"考拉","can_delete":false,"product_type":"c1","uid":1100729,"ip_address":"","ucode":"DF7775AB265FBF","user_header":"https://static001.geekbang.org/account/avatar/00/10/cb/b9/839fda09.jpg","comment_is_top":false,"comment_ctime":1526952052,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5821919348","product_id":100002201,"comment_content":"之前面试问的问题 如何不入队列直接返回是否成功","like_count":1},{"had_liked":false,"id":347940,"user_name":"Geek9182","can_delete":false,"product_type":"c1","uid":2810862,"ip_address":"","ucode":"4F426766F5AC8B","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eq8b0APWPRKItzUXVYhGs10sCtrjuxVH1a6LIdceMLwsCFOI8icZA2WNnz95y21K89UTmZSuXAsW9Q/132","comment_is_top":false,"comment_ctime":1654594530,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1654594530","product_id":100002201,"comment_content":"过滤还要放到CDN上？js上做成本不是更低么","like_count":0},{"had_liked":false,"id":325567,"user_name":"无朽","can_delete":false,"product_type":"c1","uid":1992347,"ip_address":"","ucode":"1708E4523D59DD","user_header":"https://static001.geekbang.org/account/avatar/00/1e/66/9b/54b899f4.jpg","comment_is_top":false,"comment_ctime":1639024299,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1639024299","product_id":100002201,"comment_content":"这个失去了先来后到的公平性","like_count":0},{"had_liked":false,"id":321719,"user_name":"方勇(gopher)","can_delete":false,"product_type":"c1","uid":1290625,"ip_address":"","ucode":"D199911C4CFEF5","user_header":"https://static001.geekbang.org/account/avatar/00/13/b1/81/13f23d1e.jpg","comment_is_top":false,"comment_ctime":1637025005,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637025005","product_id":100002201,"comment_content":"边缘计算也越来越重要，目前在组织内部论坛，找大佬一起讨论秒杀系统！","like_count":0},{"had_liked":false,"id":312730,"user_name":"ken","can_delete":false,"product_type":"c1","uid":1520703,"ip_address":"","ucode":"DCAFD1DD5C6A0C","user_header":"https://static001.geekbang.org/account/avatar/00/17/34/3f/53aca22e.jpg","comment_is_top":false,"comment_ctime":1631955267,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631955267","product_id":100002201,"comment_content":"耗子老师，请问一下，我能理解为这个是做了一个流量的阀门控制吗？","like_count":0},{"had_liked":false,"id":309762,"user_name":"KK","can_delete":false,"product_type":"c1","uid":1324863,"ip_address":"","ucode":"FFC31A3FE3A285","user_header":"https://static001.geekbang.org/account/avatar/00/14/37/3f/a9127a73.jpg","comment_is_top":false,"comment_ctime":1630323402,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1630323402","product_id":100002201,"comment_content":"只是点到即止，不深入。","like_count":0},{"had_liked":false,"id":291864,"user_name":"Hello World","can_delete":false,"product_type":"c1","uid":1208981,"ip_address":"","ucode":"368D87D53DC58F","user_header":"https://static001.geekbang.org/account/avatar/00/12/72/95/5f83598c.jpg","comment_is_top":false,"comment_ctime":1620556503,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1620556503","product_id":100002201,"comment_content":"CDN做秒杀的套路Get了","like_count":0},{"had_liked":false,"id":209889,"user_name":"高见","can_delete":false,"product_type":"c1","uid":1945788,"ip_address":"","ucode":"55E21373F78E8B","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJib08Z8K6zgp5xibjKLupKQxibztk8703326bSP7gC84u07g6GGwrAtPqUQN5ajIS7WKOMNHQ3ptatg/132","comment_is_top":false,"comment_ctime":1587632446,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587632446","product_id":100002201,"comment_content":"非常好，边缘计算很六，我目前都是使用中心化的秒杀策略，确实量上来会有问题","like_count":0},{"had_liked":false,"id":169320,"user_name":"文刂 氵共 超","can_delete":false,"product_type":"c1","uid":1282813,"ip_address":"","ucode":"C2CE1512D23012","user_header":"https://static001.geekbang.org/account/avatar/00/13/92/fd/6b0e58fe.jpg","comment_is_top":false,"comment_ctime":1578314252,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578314252","product_id":100002201,"comment_content":"坚持学习，学习笔记 https:&#47;&#47;mubu.com&#47;colla&#47;65_uC_T3vB0","like_count":0},{"had_liked":false,"id":137195,"user_name":"丁丁历险记","can_delete":false,"product_type":"c1","uid":1661704,"ip_address":"","ucode":"A43829E454C067","user_header":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","comment_is_top":false,"comment_ctime":1569645030,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1569645030","product_id":100002201,"comment_content":"小米就是这样忽悠客户的","like_count":0,"discussions":[{"author":{"id":1336475,"avatar":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","nickname":"J.Smile","note":"","ucode":"C4D98DFDBF7584","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":165050,"discussion_content":"饥饿营销","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581251401,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117265,"user_name":"edisonhuang","can_delete":false,"product_type":"c1","uid":1530167,"ip_address":"","ucode":"BB2F639A779F96","user_header":"https://static001.geekbang.org/account/avatar/00/17/59/37/bd2de0a4.jpg","comment_is_top":false,"comment_ctime":1564016992,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564016992","product_id":100002201,"comment_content":"秒杀是一堆人在同一个时间点抢同一个东西，大家要访问的数据，要请求的库存都集中在同一点，因此如果单独使用数据中心来处理必然会有性能瓶颈。此时可以把计算从数据中心往边缘计算迁移，分区的用户只有比较小的概率通过边缘节点来提交请求，从而保证系统可以抗住大流量","like_count":0},{"had_liked":false,"id":20853,"user_name":"壹雁🌟","can_delete":false,"product_type":"c1","uid":1016970,"ip_address":"","ucode":"D27B32780FB1CB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/84/8a/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1534775619,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1534775619","product_id":100002201,"comment_content":"只能手机端访问吗？想取链接在pc上访问很麻烦","like_count":0},{"had_liked":false,"id":12793,"user_name":"guhowo","can_delete":false,"product_type":"c1","uid":1143767,"ip_address":"","ucode":"5B7FB80766C07E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqz1bZVBb2NOibN2bbRZhv8alB38W8d7ujib9oPyVBvoQiahtN2OEUicCWFiadtdjCUs8Gkp0IG7KURZzA/132","comment_is_top":false,"comment_ctime":1529033663,"is_pvip":false,"replies":[{"id":"4270","content":"关注程序练级攻略后续的文章，分布式系统会有极为丰富的学习","user_name":"作者回复","user_name_real":"左耳朵","uid":"1001269","ctime":1529067014,"ip_address":"","comment_id":12793,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1529033663","product_id":100002201,"comment_content":"耗子哥，看了您这么多分布式的文章，想问一下，如何入门及系统的学习分布式呢","like_count":0,"discussions":[{"author":{"id":1001269,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/35/89726f5f.jpg","nickname":"左耳朵","note":"","ucode":"8A4741D677702E","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419412,"discussion_content":"关注程序练级攻略后续的文章，分布式系统会有极为丰富的学习","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1529067014,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12170,"user_name":"XinghaiVictorStarseaSingHoy星海","can_delete":false,"product_type":"c1","uid":1028923,"ip_address":"","ucode":"1E45557EAAC7D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b3/3b/1104b8e6.jpg","comment_is_top":false,"comment_ctime":1528633974,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1528633974","product_id":100002201,"comment_content":"CDN 现在的云服务都是只能推静态内容的吧，有要实现耗子哥你说的这个秒杀设计，那个云供应商有这样的CDN服务？","like_count":0},{"had_liked":false,"id":11906,"user_name":"弄堂风","can_delete":false,"product_type":"c1","uid":1098039,"ip_address":"","ucode":"0E6A03019F74F1","user_header":"https://static001.geekbang.org/account/avatar/00/10/c1/37/35f25642.jpg","comment_is_top":false,"comment_ctime":1528428363,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1528428363","product_id":100002201,"comment_content":"耗子哥会考虑写数据库方面的知识吗？比如，数据库的性能优化，数据库的cluster等","like_count":0},{"had_liked":false,"id":11595,"user_name":"AIR","can_delete":false,"product_type":"c1","uid":1081999,"ip_address":"","ucode":"999D0202170EDE","user_header":"https://static001.geekbang.org/account/avatar/00/10/82/8f/1bfd765e.jpg","comment_is_top":false,"comment_ctime":1528244105,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1528244105","product_id":100002201,"comment_content":"js做前端过滤吧","like_count":0},{"had_liked":false,"id":10551,"user_name":"嘻嘻嘻","can_delete":false,"product_type":"c1","uid":1105682,"ip_address":"","ucode":"09268C1E1D5721","user_header":"https://static001.geekbang.org/account/avatar/00/10/df/12/edd287d4.jpg","comment_is_top":false,"comment_ctime":1527591475,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1527591475","product_id":100002201,"comment_content":"cdn要怎么保证时间一致性呢。","like_count":0},{"had_liked":false,"id":9777,"user_name":"子悠","can_delete":false,"product_type":"c1","uid":1000383,"ip_address":"","ucode":"070BB09477E8A8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/43/bf/9a982bc1.jpg","comment_is_top":false,"comment_ctime":1527082577,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1527082577","product_id":100002201,"comment_content":"学习了，原来CDN还可以放代码。","like_count":0},{"had_liked":false,"id":9771,"user_name":"湖心亭看雪","can_delete":false,"product_type":"c1","uid":1023363,"ip_address":"","ucode":"88BAEBA964B6BC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9d/83/968da410.jpg","comment_is_top":false,"comment_ctime":1527081045,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1527081045","product_id":100002201,"comment_content":"一般有很多个秒杀，只一个的话手段太多了。","like_count":0},{"had_liked":false,"id":9709,"user_name":"天天向上","can_delete":false,"product_type":"c1","uid":1031113,"ip_address":"","ucode":"5948D359734193","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bb/c9/37924ad4.jpg","comment_is_top":false,"comment_ctime":1527040078,"is_pvip":false,"replies":[{"id":"3084","content":"你没好好看我的文章。这个比例是动态算出来的。","user_name":"作者回复","user_name_real":"左耳朵","uid":"1001269","ctime":1527183780,"ip_address":"","comment_id":9709,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1527040078","product_id":100002201,"comment_content":"0.02%是基于自己假想的瞬间并发请数量以及自己计划的可售资源给出的评估，如果可售资源不变，实际瞬间并发再扩大一百倍，或者降低一百倍呢？会不会出现多卖和少卖的尴尬？","like_count":0,"discussions":[{"author":{"id":1001269,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/35/89726f5f.jpg","nickname":"左耳朵","note":"","ucode":"8A4741D677702E","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418174,"discussion_content":"你没好好看我的文章。这个比例是动态算出来的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527183780,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":9629,"user_name":"袁克强😅","can_delete":false,"product_type":"c1","uid":1004909,"ip_address":"","ucode":"DAC29E5FF3FA86","user_header":"https://static001.geekbang.org/account/avatar/00/0f/55/6d/75e6a9d8.jpg","comment_is_top":false,"comment_ctime":1526994033,"is_pvip":false,"replies":[{"id":"3087","content":"你要谈定制化需求","user_name":"作者回复","user_name_real":"左耳朵","uid":"1001269","ctime":1527183944,"ip_address":"","comment_id":9629,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1526994033","product_id":100002201,"comment_content":"国内cdn哪个能执行逻辑代码？七牛之类的","like_count":0,"discussions":[{"author":{"id":1001269,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/35/89726f5f.jpg","nickname":"左耳朵","note":"","ucode":"8A4741D677702E","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418141,"discussion_content":"你要谈定制化需求","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527183944,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":9523,"user_name":"bensinos","can_delete":false,"product_type":"c1","uid":1042981,"ip_address":"","ucode":"FFE7FB3DF5A16A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ea/25/4559f116.jpg","comment_is_top":false,"comment_ctime":1526948050,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1526948050","product_id":100002201,"comment_content":"感谢皓哥","like_count":0}]}