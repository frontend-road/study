{"id":67672,"title":"122 | Prometheus 架构设计","content":"无","comments":[{"had_liked":false,"id":204074,"user_name":"J.Smile","can_delete":false,"product_type":"c3","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/d1ab239e.jpg","comment_is_top":false,"comment_ctime":1586329829,"is_pvip":false,"replies":[{"id":76337,"content":"只有最近的那一块是mutable(可写入)的，近期频繁访问的一些块(1 mutable + 若干immutable)在内存中，加快近期查询。非近期块踢出内存存到磁盘上，类似一种LRU机制。具体块数量和存储细节要看源码。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1586354462,"ip_address":"","comment_id":204074,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"Time Sharding机制中的每个mutable是存在磁盘还是内存中呢？貌似那篇文章里没有看到。https:&#47;&#47;coreos.com&#47;blog&#47;prometheus-2.0-storage-layer-optimization","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491070,"discussion_content":"只有最近的那一块是mutable(可写入)的，近期频繁访问的一些块(1 mutable + 若干immutable)在内存中，加快近期查询。非近期块踢出内存存到磁盘上，类似一种LRU机制。具体块数量和存储细节要看源码。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586354462,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":121858,"user_name":"citysun2009","can_delete":false,"product_type":"c3","uid":1090468,"ip_address":"","ucode":"285AB0E13C5927","user_header":"https://static001.geekbang.org/account/avatar/00/10/a3/a4/fc9cf791.jpg","comment_is_top":false,"comment_ctime":1565235417,"is_pvip":false,"replies":[{"id":44810,"content":"promethues 2.0存储设计是Time Sharding机制，默认2小时一个时间块，视频里头讲的满了应该指2小时时间间隔到了，这种方式通过时间范围查询定位比较快的，具体可以参考：https:&#47;&#47;coreos.com&#47;blog&#47;prometheus-2.0-storage-layer-optimization","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1565276007,"ip_address":"","comment_id":121858,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"老师，你好：\n     prometheus的数据块默认是2小时产生一块，视频里挺您说到也有可能是满了就产生下一块，如果没有到2小时就满了，那么这个块里的数据就不是标准的2小时，那么通过promQL查询起来也不能用2小时一块的方式定位了，这种情况下如何定位查询呢？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461980,"discussion_content":"promethues 2.0存储设计是Time Sharding机制，默认2小时一个时间块，视频里头讲的满了应该指2小时时间间隔到了，这种方式通过时间范围查询定位比较快的，具体可以参考：https://coreos.com/blog/prometheus-2.0-storage-layer-optimization","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565276007,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}