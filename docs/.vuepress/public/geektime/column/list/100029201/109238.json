{"id":109238,"title":"22 | 消费者组消费进度监控都怎么实现？","content":"<p>你好，我是胡夕。今天我要跟你分享的主题是：消费者组消费进度监控如何实现。</p><p>对于Kafka消费者来说，最重要的事情就是监控它们的消费进度了，或者说是监控它们消费的滞后程度。这个滞后程度有个专门的名称：消费者Lag或Consumer Lag。</p><p><strong>所谓滞后程度，就是指消费者当前落后于生产者的程度</strong>。比方说，Kafka生产者向某主题成功生产了100万条消息，你的消费者当前消费了80万条消息，那么我们就说你的消费者滞后了20万条消息，即Lag等于20万。</p><p>通常来说，Lag的单位是消息数，而且我们一般是在主题这个级别上讨论Lag的，但实际上，Kafka监控Lag的层级是在分区上的。如果要计算主题级别的，你需要手动汇总所有主题分区的Lag，将它们累加起来，合并成最终的Lag值。</p><p>我们刚刚说过，对消费者而言，Lag应该算是最最重要的监控指标了。它直接反映了一个消费者的运行情况。一个正常工作的消费者，它的Lag值应该很小，甚至是接近于0的，这表示该消费者能够及时地消费生产者生产出来的消息，滞后程度很小。反之，如果一个消费者Lag值很大，通常就表明它无法跟上生产者的速度，最终Lag会越来越大，从而拖慢下游消息的处理速度。</p><!-- [[[read_end]]] --><p>更可怕的是，由于消费者的速度无法匹及生产者的速度，极有可能导致它消费的数据已经不在操作系统的页缓存中了。这样的话，消费者就不得不从磁盘上读取它们，这就进一步拉大了与生产者的差距，进而出现马太效应，即那些Lag原本就很大的消费者会越来越慢，Lag也会越来越大。</p><p>鉴于这些原因，<strong>你在实际业务场景中必须时刻关注消费者的消费进度</strong>。一旦出现Lag逐步增加的趋势，一定要定位问题，及时处理，避免造成业务损失。</p><p>既然消费进度这么重要，我们应该怎么监控它呢？简单来说，有3种方法。</p><ol>\n<li>使用Kafka自带的命令行工具kafka-consumer-groups脚本。</li>\n<li>使用Kafka Java Consumer API编程。</li>\n<li>使用Kafka自带的JMX监控指标。</li>\n</ol><p>接下来，我们分别来讨论下这3种方法。</p><h2>Kafka自带命令</h2><p>我们先来了解下第一种方法：使用Kafka自带的命令行工具bin/kafka-consumer-groups.sh(bat)。<strong>kafka-consumer-groups脚本是Kafka为我们提供的最直接的监控消费者消费进度的工具</strong>。当然，除了监控Lag之外，它还有其他的功能。今天，我们主要讨论如何使用它来监控Lag。</p><p>如果只看名字，你可能会以为它只是操作和管理消费者组的。实际上，它也能够监控独立消费者（Standalone Consumer）的Lag。我们之前说过，<strong>独立消费者就是没有使用消费者组机制的消费者程序</strong>。和消费者组相同的是，它们也要配置group.id参数值，但和消费者组调用KafkaConsumer.subscribe()不同的是，独立消费者调用KafkaConsumer.assign()方法直接消费指定分区。今天的重点不是要学习独立消费者，你只需要了解接下来我们讨论的所有内容都适用于独立消费者就够了。</p><p>使用kafka-consumer-groups脚本很简单。该脚本位于Kafka安装目录的bin子目录下，我们可以通过下面的命令来查看某个给定消费者的Lag值：</p><pre><code>$ bin/kafka-consumer-groups.sh --bootstrap-server &lt;Kafka broker连接信息&gt; --describe --group &lt;group名称&gt;\n</code></pre><p><strong>Kafka连接信息就是&lt;主机名：端口&gt;对，而group名称就是你的消费者程序中设置的group.id值</strong>。我举个实际的例子来说明具体的用法，请看下面这张图的输出：</p><p><img src=\"https://static001.geekbang.org/resource/image/18/7d/18bc0ee629cfa761b1d17e638be9f67d.png?wh=861*122\" alt=\"\"></p><p>在运行命令时，我指定了Kafka集群的连接信息，即localhost:9092。另外，我还设置了要查询的消费者组名：testgroup。kafka-consumer-groups脚本的输出信息很丰富。首先，它会按照消费者组订阅主题的分区进行展示，每个分区一行数据；其次，除了主题、分区等信息外，它会汇报每个分区当前最新生产的消息的位移值（即LOG-END-OFFSET列值）、该消费者组当前最新消费消息的位移值（即CURRENT-OFFSET值）、LAG值（前两者的差值）、消费者实例ID、消费者连接Broker的主机名以及消费者的CLIENT-ID信息。</p><p>毫无疑问，在这些数据中，我们最关心的当属LAG列的值了，图中每个分区的LAG值大约都是60多万，这表明，在我的这个测试中，消费者组远远落后于生产者的进度。理想情况下，我们希望该列所有值都是0，因为这才表明我的消费者完全没有任何滞后。</p><p>有的时候，你运行这个脚本可能会出现下面这种情况，如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/59/04/59f9fd209e9559c098d2f56b8c959c04.png?wh=826*156\" alt=\"\"></p><p>简单比较一下，我们很容易发现它和前面那张图输出的区别，即CONSUMER-ID、HOST和CLIENT-ID列没有值！如果碰到这种情况，你不用惊慌，这是因为我们运行kafka-consumer-groups脚本时没有启动消费者程序。请注意我标为橙色的文字，它显式地告诉我们，当前消费者组没有任何active成员，即没有启动任何消费者实例。虽然这些列没有值，但LAG列依然是有效的，它依然能够正确地计算出此消费者组的Lag值。</p><p>除了上面这三列没有值的情形，还可能出现的一种情况是该命令压根不返回任何结果。此时，你也不用惊慌，这是因为你使用的Kafka版本比较老，kafka-consumer-groups脚本还不支持查询非active消费者组。一旦碰到这个问题，你可以选择升级你的Kafka版本，也可以采用我接下来说的其他方法来查询。</p><h2>Kafka Java Consumer API</h2><p>很多时候，你可能对运行命令行工具查询Lag这种方式并不满意，而是希望用程序的方式自动化监控。幸运的是，社区的确为我们提供了这样的方法。这就是我们今天要讲的第二种方法。</p><p>简单来说，社区提供的Java Consumer API分别提供了查询当前分区最新消息位移和消费者组最新消费消息位移两组方法，我们使用它们就能计算出对应的Lag。</p><p>下面这段代码展示了如何利用Consumer端API监控给定消费者组的Lag值：</p><pre><code>public static Map&lt;TopicPartition, Long&gt; lagOf(String groupID, String bootstrapServers) throws TimeoutException {\n        Properties props = new Properties();\n        props.put(CommonClientConfigs.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);\n        try (AdminClient client = AdminClient.create(props)) {\n            ListConsumerGroupOffsetsResult result = client.listConsumerGroupOffsets(groupID);\n            try {\n                Map&lt;TopicPartition, OffsetAndMetadata&gt; consumedOffsets = result.partitionsToOffsetAndMetadata().get(10, TimeUnit.SECONDS);\n                props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, false); // 禁止自动提交位移\n                props.put(ConsumerConfig.GROUP_ID_CONFIG, groupID);\n                props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());\n                props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());\n                try (final KafkaConsumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(props)) {\n                    Map&lt;TopicPartition, Long&gt; endOffsets = consumer.endOffsets(consumedOffsets.keySet());\n                    return endOffsets.entrySet().stream().collect(Collectors.toMap(entry -&gt; entry.getKey(),\n                            entry -&gt; entry.getValue() - consumedOffsets.get(entry.getKey()).offset()));\n                }\n            } catch (InterruptedException e) {\n                Thread.currentThread().interrupt();\n                // 处理中断异常\n                // ...\n                return Collections.emptyMap();\n            } catch (ExecutionException e) {\n                // 处理ExecutionException\n                // ...\n                return Collections.emptyMap();\n            } catch (TimeoutException e) {\n                throw new TimeoutException(&quot;Timed out when getting lag for consumer group &quot; + groupID);\n            }\n        }\n    }\n</code></pre><p>你不用完全了解上面这段代码每一行的具体含义，只需要记住3处地方即可：第1处是调用AdminClient.listConsumerGroupOffsets方法获取给定消费者组的最新消费消息的位移；第2处则是获取订阅分区的最新消息位移；最后1处就是执行相应的减法操作，获取Lag值并封装进一个Map对象。</p><p>我把这段代码送给你，你可以将lagOf方法直接应用于你的生产环境，以实现程序化监控消费者Lag的目的。<strong>不过请注意，这段代码只适用于Kafka 2.0.0及以上的版本</strong>，2.0.0之前的版本中没有AdminClient.listConsumerGroupOffsets方法。</p><h2>Kafka JMX监控指标</h2><p>上面这两种方式，都可以很方便地查询到给定消费者组的Lag信息。但在很多实际监控场景中，我们借助的往往是现成的监控框架。如果是这种情况，以上这两种办法就不怎么管用了，因为它们都不能集成进已有的监控框架中，如Zabbix或Grafana。下面我们就来看第三种方法，使用Kafka默认提供的JMX监控指标来监控消费者的Lag值。</p><p>当前，Kafka消费者提供了一个名为kafka.consumer:type=consumer-fetch-manager-metrics,client-id=“{client-id}”的JMX指标，里面有很多属性。和我们今天所讲内容相关的有两组属性：<strong>records-lag-max和records-lead-min</strong>，它们分别表示此消费者在测试窗口时间内曾经达到的最大的Lag值和最小的Lead值。</p><p>Lag值的含义我们已经反复讲过了，我就不再重复了。<strong>这里的Lead值是指消费者最新消费消息的位移与分区当前第一条消息位移的差值</strong>。很显然，Lag和Lead是一体的两个方面：<strong>Lag越大的话，Lead就越小，反之也是同理</strong>。</p><p>你可能会问，为什么要引入Lead呢？我只监控Lag不就行了吗？这里提Lead的原因就在于这部分功能是我实现的。开个玩笑，其实社区引入Lead的原因是，只看Lag的话，我们也许不能及时意识到可能出现的严重问题。</p><p>试想一下，监控到Lag越来越大，可能只会给你一个感受，那就是消费者程序变得越来越慢了，至少是追不上生产者程序了，除此之外，你可能什么都不会做。毕竟，有时候这也是能够接受的。但反过来，一旦你监测到Lead越来越小，甚至是快接近于0了，你就一定要小心了，这可能预示着消费者端要丢消息了。</p><p>为什么？我们知道Kafka的消息是有留存时间设置的，默认是1周，也就是说Kafka默认删除1周前的数据。倘若你的消费者程序足够慢，慢到它要消费的数据快被Kafka删除了，这时你就必须立即处理，否则一定会出现消息被删除，从而导致消费者程序重新调整位移值的情形。这可能产生两个后果：一个是消费者从头消费一遍数据，另一个是消费者从最新的消息位移处开始消费，之前没来得及消费的消息全部被跳过了，从而造成丢消息的假象。</p><p>这两种情形都是不可忍受的，因此必须有一个JMX指标，清晰地表征这种情形，这就是引入Lead指标的原因。所以，Lag值从100万增加到200万这件事情，远不如Lead值从200减少到100这件事来得重要。<strong>在实际生产环境中，请你一定要同时监控Lag值和Lead值</strong>。当然了，这个lead JMX指标的确也是我开发的，这一点倒是事实。</p><p>接下来，我给出一张使用JConsole工具监控此JMX指标的截图。从这张图片中，我们可以看到，client-id为consumer-1的消费者在给定的测量周期内最大的Lag值为714202，最小的Lead值是83，这说明此消费者有很大的消费滞后性。</p><p><img src=\"https://static001.geekbang.org/resource/image/59/52/598a8e2c16efb23b1dc07376773c7252.png?wh=831*691\" alt=\"\"></p><p><strong>Kafka消费者还在分区级别提供了额外的JMX指标，用于单独监控分区级别的Lag和Lead值</strong>。JMX名称为：kafka.consumer:type=consumer-fetch-manager-metrics,partition=“{partition}”,topic=“{topic}”,client-id=“{client-id}”。</p><p>在我们的例子中，client-id还是consumer-1，主题和分区分别是test和0。下图展示出了分区级别的JMX指标：</p><p><img src=\"https://static001.geekbang.org/resource/image/85/4a/850e91e0025c2443aebce21a29ac784a.png?wh=742*624\" alt=\"\"></p><p>分区级别的JMX指标中多了records-lag-avg和records-lead-avg两个属性，可以计算平均的Lag值和Lead值。在实际场景中，我们会更多地使用这两个JMX指标。</p><h2>小结</h2><p>我今天完整地介绍了监控消费者组以及独立消费者程序消费进度的3种方法。从使用便捷性上看，应该说方法1是最简单的，我们直接运行Kafka自带的命令行工具即可。方法2使用Consumer API组合计算Lag，也是一种有效的方法，重要的是它能集成进很多企业级的自动化监控工具中。不过，集成性最好的还是方法3，直接将JMX监控指标配置到主流的监控框架就可以了。</p><p>在真实的线上环境中，我建议你优先考虑方法3，同时将方法1和方法2作为备选，装进你自己的工具箱中，随时取出来应对各种实际场景。</p><p><img src=\"https://static001.geekbang.org/resource/image/c2/e2/c2a03833838589fa5839c7c27f3982e2.jpg?wh=2069*2535\" alt=\"\"></p><h2>开放讨论</h2><p>请说说你对这三种方法的看法。另外，在真实的业务场景中，你是怎么监控消费者进度的呢？</p><p>欢迎写下你的思考和答案，我们一起讨论。如果你觉得有所收获，也欢迎把文章分享给你的朋友。</p>","comments":[{"had_liked":false,"id":116456,"user_name":"刘丹","can_delete":false,"product_type":"c1","uid":1081922,"ip_address":"","ucode":"66594D1C957E15","user_header":"https://static001.geekbang.org/account/avatar/00/10/82/42/8b04d489.jpg","comment_is_top":false,"comment_ctime":1563852344,"is_pvip":false,"replies":[{"id":"42674","content":"lead越小意味着consumer消费的消息越来越接近被删除的边缘，显然是不好的","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1563929800,"ip_address":"","comment_id":116456,"utype":1}],"discussion_count":8,"race_medal":0,"score":"147592740408","product_id":100029201,"comment_content":"对lead这个指标的含义还是不能理解。既然Lead 值是指消费者最新消费消息的位移与分区当前第一条消息的差值。好像这个值应该是越小越好，越小的话就意味着分区里未被消费的消息越少？","like_count":35,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459548,"discussion_content":"lead越小意味着consumer消费的消息越来越接近被删除的边缘，显然是不好的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563929800,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2577451,"avatar":"","nickname":"Geek_9c6c3e","note":"","ucode":"F3B71465B25BC6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372039,"discussion_content":"(start)----lead-----(consume offset)---------lag--------(end)--->","likes_number":11,"is_delete":false,"is_hidden":false,"ctime":1620136682,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1261493,"avatar":"https://static001.geekbang.org/account/avatar/00/13/3f/b5/5fe77e16.jpg","nickname":"不经意间","note":"","ucode":"C39D98697ACB8B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":187894,"discussion_content":"       如果你了解过mongodb的oplg就能懂了。说白了，保留一周的数据，其实可以把某一broker或者broker集群当做一个固定集合。\n       所谓固定集合，就是一个数据表他的大小是确定的（容量或者存储数据条数或者时间轴）。当这个集合写满后，就会擦除最旧的、位于集合开头的消息，并在擦除的位置重新写入新数据，反反复复。\n       每个broker维护一个写游标，消费程序在消费完一条消息后更新读游标（消费位）。正常情况下读游标略微落后与写游标，即延迟。\n       lead就是消费位，它的大小取决于它和这个固定集合开始位置距离。距离越大，表示想要消费的数据暂时还不会被擦除，比较安全，相应的延迟也会很低。\n        如果距离较进，表示想要被消费的数据快要被擦除了，再不提高消费速度就要面临丢数据的风险。\n       消费慢，有可能是消费程序端的问题需要垂直扩展比如单线程变多线程。也有可能是消息队列集群本身的性能问题。","likes_number":8,"is_delete":false,"is_hidden":false,"ctime":1582776745,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2289723,"avatar":"https://static001.geekbang.org/account/avatar/00/22/f0/3b/3a142c70.jpg","nickname":"大姐","note":"","ucode":"F23143AB43DDDF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":353688,"discussion_content":"lag越小才表示未被消费的消息少，因为lag = log_end_offset - current_offset；lead = current_offset - oldest_msg_offset， lead越小表示消息越来越接近被删除的边缘，认真体会一下。","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1615190263,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1344289,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLEYbNElGIxY6Le1rfiakWJecz8JIOp06Y9JQFR2YBn3T3gx3icI5CKxZNgxgqiaKbfVOicXquO3QBw9w/132","nickname":"july","note":"","ucode":"E081987929063A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":233671,"discussion_content":"第一条是最老的消息，不是最新的；","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1586938024,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1564943,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJUJKviaecwxpAZCAnHWap86kXUichv5JwUoAtrUNy4ugC0kMMmssFDdyayKFgAoA9Z62sqMZaibbvUg/132","nickname":"Geek_edc612","note":"","ucode":"3E01DE3CE4BF3E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2696,"discussion_content":"这里的 Lead 值是指消费者最新消费消息的位移与分区当前第一条消息位移的差值。\n\n老师文中标黑提到的，单个分区的offset是一直增加的，你与分区的第一条数据的offset越小，说明你消费的消息越靠近分区刚开始写入的那几条消息， 这样的话不就说明该分区之后的消息你都没消费吗？\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1563867505,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2695785,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/qUHuge7oea6mA4bUTyJ4rpTP7Havj5m2WEqKvrARDbe8HYnu52vQ8DfAWNkLEfQbic83ibDhnUZYRTwut5Dl8icDA/132","nickname":"谢鸿旺","note":"","ucode":"C703A7FDCAD58C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578498,"discussion_content":"lag=当前分区最新消息位移-消费者组该分区最新消费消息位移\n\nlead=消费者组该分区最新消费消息位移-当前分区最旧消息位移\n\nlag+lead=当前分区所有消息","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656837379,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1261493,"avatar":"https://static001.geekbang.org/account/avatar/00/13/3f/b5/5fe77e16.jpg","nickname":"不经意间","note":"","ucode":"C39D98697ACB8B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":187898,"discussion_content":"消费程序最好是水平扩展","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582776968,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117520,"user_name":"皇家救星","can_delete":false,"product_type":"c1","uid":1326106,"ip_address":"","ucode":"89F1274A3835FE","user_header":"https://static001.geekbang.org/account/avatar/00/14/3c/1a/1806ef25.jpg","comment_is_top":false,"comment_ctime":1564065892,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"104643280996","product_id":100029201,"comment_content":"前天用别人号提了一个问题，我今天找到答案了。问题：搭建了一个kafka单机服务器，消息收发正常。升级成3个服务器集群后消息能写但不能读（启动命令行消费工具后一直没输出，使用strace -f跟踪发现一直在epoll&gt;超时&gt;epoll的循环中），观察服务器日志无输出。定位问题过程：使用topic查询consumer_offest，发现分区leader的brokerid是0，但是我机器集群brokerid是1-3，这时才想起升级过程中把0号broker改成了1号（修改了logs和config下面的配置id）。尝试把1号改回0，重启即可正常消费。最终解决方法：使用kafka提供的工具，调整offset主题分布机器为1，2，3，生产消费即恢复正常","like_count":25},{"had_liked":false,"id":120445,"user_name":"zander","can_delete":false,"product_type":"c1","uid":1602385,"ip_address":"","ucode":"B3A5E6F0D2293E","user_header":"https://static001.geekbang.org/account/avatar/00/18/73/51/5668a02c.jpg","comment_is_top":false,"comment_ctime":1564899813,"is_pvip":false,"replies":[{"id":"44242","content":"可能出现丢失数据了。lag&lt;0一定要重点关注","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1564965675,"ip_address":"","comment_id":120445,"utype":1}],"discussion_count":5,"race_medal":0,"score":"78874311141","product_id":100029201,"comment_content":"在公司的kafka消费者监控上，经常可以看到lag 为一个负数，比如-3，-109等，想咨询一下，为什么会出现负数呢？","like_count":19,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461336,"discussion_content":"可能出现丢失数据了。lag&amp;lt;0一定要重点关注","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564965675,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1468131,"avatar":"https://static001.geekbang.org/account/avatar/00/16/66/e3/f19ac5b6.jpg","nickname":"道道法","note":"","ucode":"3FC083A1EC0127","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":331584,"discussion_content":"在CMAK这样解释过这个问题，producer的offset是通过JMX轮询获取的，consumer的offset是从topic中直接读取的，很明显，轮询的话，因为存在时间差，所以获取的offset就可能比实际的小，计算之后，就变成负数了","likes_number":13,"is_delete":false,"is_hidden":false,"ctime":1606905743,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1132315,"avatar":"https://static001.geekbang.org/account/avatar/00/11/47/1b/64262861.jpg","nickname":"胡小禾","note":"","ucode":"1C23B7492C0C9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":265444,"discussion_content":"KM 上的瞬时lag <0 是正常的。尤其是消费得特别快的时候","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1589386873,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1638570,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/aa/1f5fceda.jpg","nickname":"明月朔风","note":"","ucode":"C9CAF7B14C38FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":243040,"discussion_content":"老师能简单描述下出现负数的场景吗？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1587517571,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1054827,"avatar":"https://static001.geekbang.org/account/avatar/00/10/18/6b/a1448af1.jpg","nickname":"贝影","note":"","ucode":"19545C8DCBF8A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544212,"discussion_content":"负数其实正常，甚至可以说是证明此时在实时正常消费，出现负数只不过是因为消费者消费到的offset是后算的，比先算的分区offset更实时，所以会出现负数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641440828,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130628,"user_name":"Guard-God","can_delete":false,"product_type":"c1","uid":1323298,"ip_address":"","ucode":"8B335151DE7977","user_header":"https://static001.geekbang.org/account/avatar/00/14/31/22/6c2677ec.jpg","comment_is_top":false,"comment_ctime":1567496831,"is_pvip":true,"replies":[{"id":"48890","content":"你连接的是Broker的JMX端口吧，你需要连接consumer的JMX端口","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1567507394,"ip_address":"","comment_id":130628,"utype":1}],"discussion_count":5,"race_medal":0,"score":"65992006271","product_id":100029201,"comment_content":"老师您好，jmx 监控的lead我认为很重要，但是，我使用JConsole连接后怎么就没有kafka.consumer，这块呢？我测了好多版本，我想问一下，这个是如何配置的<br>","like_count":16,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466039,"discussion_content":"你连接的是Broker的JMX端口吧，你需要连接consumer的JMX端口","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567507394,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1054827,"avatar":"https://static001.geekbang.org/account/avatar/00/10/18/6b/a1448af1.jpg","nickname":"贝影","note":"","ucode":"19545C8DCBF8A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544214,"discussion_content":"其实吧，很多consumer是在k8s上的实例，开不开jmx不说，基本不会给你除了应用需要其他端口权限的，所以lead的监控其实不太普遍","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1641440972,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1854657,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKVIjh4T1akib5iav5IIGjXB9x98p9Y80STRcwpMDqxfGLrMvHamxlxEqLMTpiayWFWSNpBcbGwkRjRw/132","nickname":"马吉辉","note":"","ucode":"4265EFBD2BB7BD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":277025,"discussion_content":"consumer的JMX端口 ？   如何去链接呢？ kafka配置的是9999 consumer的jmx是如何配置的？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590983731,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1015754,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","nickname":"helloworld","note":"","ucode":"00DF2FEC58D2E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":205072,"discussion_content":"我用的Kafka版本为kafka_2.11-2.1.1，Kafka Java 客户端版本为1.0.0发现只有kafka.consumer中的records-lag-max，没有records-lead-min；并且也没有分区相关的jmx信息","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584259744,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1323298,"avatar":"https://static001.geekbang.org/account/avatar/00/14/31/22/6c2677ec.jpg","nickname":"Guard-God","note":"","ucode":"8B335151DE7977","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7439,"discussion_content":"嗯嗯，我发现了，后来修改了。但是，又发现如果要配置监控consumer端的话，就不好维护了。因为有几十个消费者，同时有几十个topic, 如果这要是配置的话，大约配置需要几百个。请问还有其他好的监控或者配置方式吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567511577,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":148630,"user_name":"注定非凡","can_delete":false,"product_type":"c1","uid":1113597,"ip_address":"","ucode":"80673056E131B7","user_header":"https://static001.geekbang.org/account/avatar/00/10/fd/fd/326be9bb.jpg","comment_is_top":false,"comment_ctime":1573041132,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"48817681388","product_id":100029201,"comment_content":"1 为什么要监控<br>\tA ：对于Kafka消费者，最重要的事情就是监控它们的消费进度（消费的滞后程度）常称为：Consumer Lag<br><br>\tB ：Lag的单位是消息数，他直接反映了一个消费者的运行情况。一个正常的消费者的Lag应当很小，设置为0。这表明消费者能够及时地消费生产者生产出来的消息。反之，一个消费者Lag值很大的话表明它无法跟上生产者的速度。<br><br>\tC ：如果消费者速度无法匹及生产者的数据，极有可能导致它消费的数据已经不在操作系统的页缓存中了，那些数据就失去了享有Zero Copy技术的条件，不得不从磁盘中读取，进一步拉大了与生产者的差距。并且会越来大。<br><br>所以：在实际业务场景中必须时刻关注消费者的消费进度。一旦出现Lag逐步增加的趋势，就要立即定位问题，及时处理，避免问题扩散。<br><br>2 如何监控<br>\tA ：使用Kafka自带的命令行工具kafka-consumer-groups脚本<br>\tB ：使用Kafka Java Conssumer API编程<br>\tC ：使用Kafka自带的JMX监控指标<br><br>3 方法具体分析<br>\tA ：Kafka自带命令<br>\t\t（1） kafka-consumer-groups脚本是kafka为我们提供的最直接的监控消费者消费进度工具。<br>\t\t（2） 使用：<br>$ bin&#47;kafka-consumer-groups.sh --bootstrap-server &lt;Kafka broker连接信息 &gt; --describe --group &lt;group 名称 &gt;<br>\t<br>\t&lt;Kafka broker 连接信息 &gt;：主机：端口<br>\t&lt;group 名称 &gt; ：要监控的消费组的 group.id值<br>\t\t（3）展示的信息：主题，分区，该消费者组最新消费消息的位移值（CURRENT-OFFSET值），每个分区当前最新生产的消息的位移值（LOG-END-OFFSET）,LAG（前两者的差值），消费者实例ID，消费者连接Broker的主机名以及消费者的CLENT-ID信息。<br><br>\tB ：Kafka Java Consumer API<br>\t\t（1）首先获取给定的消费者组的最新消费消息的位移<br>\t\t（2）在获取订阅分区的最新消息位移<br>\t\t（3）最后执行相应的减法操作，获取Lag值并封装进一个Map对象。<br>\t<br>\tC ：Kafka JMX监控指标<br>\t\t使用Kafka默认提供 的JMX监控指标来监控消费者的Lag值。<br>\t\t（1）Kafka消费者提供了一个名为Kafka.consumer:type=consumer-fetch-manager-metrics，client-id=”{client-id}”的JMX指标。<br>\t\t（2）有两个重要的属性：records-lag-max 和 records-lead-min 分别表示消费者在测试窗口时间内曾经达到的最大的Lag值和最小的Lead值。<br>\t\t（3）Lead值是指消费者最新消费消息的位移和分区当前第一条消息的位移的差值。即：Lag越大，Lead就越小。<br>","like_count":10},{"had_liked":false,"id":219026,"user_name":"行则将至","can_delete":false,"product_type":"c1","uid":1542987,"ip_address":"","ucode":"DB972F2DF059C4","user_header":"https://static001.geekbang.org/account/avatar/00/17/8b/4b/fa52d222.jpg","comment_is_top":false,"comment_ctime":1589934753,"is_pvip":false,"replies":[{"id":"80943","content":"是的","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1589942671,"ip_address":"","comment_id":219026,"utype":1}],"discussion_count":2,"race_medal":1,"score":"44539607713","product_id":100029201,"comment_content":"老师，我理解的lead会变小的原因是：kafka的消息会定期清除。所以分区第一条消息的offset值会变大。如果消费的速度慢，则current-offset的值会增长很难。此时lead的值就越来越小。是这样吗？","like_count":11,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495658,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589942671,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1155275,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a0/cb/aab3b3e7.jpg","nickname":"张三丰","note":"","ucode":"3A6215A40B3B21","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":376063,"discussion_content":"这个解释完美","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621947362,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":119007,"user_name":"小头针","can_delete":false,"product_type":"c1","uid":1422920,"ip_address":"","ucode":"21EB7CDE48EC9B","user_header":"https://static001.geekbang.org/account/avatar/00/15/b6/48/1275e0ce.jpg","comment_is_top":false,"comment_ctime":1564484017,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"44514156977","product_id":100029201,"comment_content":"听胡老师这节课，最大的收获就是知道了Lead指标的重要性，之前就没注意到这个指标。<br><br>真实业务场景中，我们采用过kafka tool，kafka manager和jconsole和jvisualvm。<br>如果监控kafka主题、分区、数据流入流出、调整分区数、Lag等kafka manager比较直观好看，不推荐kafka tool，不方便会卡顿。<br>如果要监控内存、线程安全、进程，Lag、Lead等的话，就会使用jconsole和jvisualvm，另外，有利于排查kafka是否存在死锁问题。<br>","like_count":11},{"had_liked":false,"id":135519,"user_name":"天天向上","can_delete":false,"product_type":"c1","uid":1031113,"ip_address":"","ucode":"5948D359734193","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bb/c9/37924ad4.jpg","comment_is_top":false,"comment_ctime":1569202959,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"31633974031","product_id":100029201,"comment_content":"分区第一条生产的消息偏移量 记为i1 <br>分区最后一条生产的消息偏移量 记为i2<br>消费者在当前分区消费的最后一条消息的偏移量 记为i3<br><br>lead=i3-i1<br>lag=i2-i3<br><br>画条直线标记三个点就特别容易理解啦<br>lag越大说明 消费速度小于生产速度<br>lead越小 说明消费速度快临近删除速度啦 要特别小心啦<br><br>消费慢 如果消息不删除可以慢慢消费无大碍<br><br>消费慢 如果消息有删除策略 就要掂记着别过分的慢 还没来得及消费就删除啦<br><br>而消息中间件不可能不删除陈旧消息的 所以lead参数的监控更要注意<br><br>","like_count":7,"discussions":[{"author":{"id":1397677,"avatar":"https://static001.geekbang.org/account/avatar/00/15/53/ad/d1efda5c.jpg","nickname":"对方正在输入...","note":"","ucode":"08B7F728449529","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383362,"discussion_content":"瞬间明白了，感谢！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626070080,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":161095,"user_name":"曾轼麟","can_delete":false,"product_type":"c1","uid":1451391,"ip_address":"","ucode":"D418371AC11270","user_header":"https://static001.geekbang.org/account/avatar/00/16/25/7f/473d5a77.jpg","comment_is_top":false,"comment_ctime":1576117873,"is_pvip":false,"replies":[{"id":"61496","content":"不会引发，因为是用的AdminClient","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1576199118,"ip_address":"","comment_id":161095,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27345921649","product_id":100029201,"comment_content":"老师，请问你的这个消费者堆积监控代码，是否会触发消费者组的rebalance呢？","like_count":6,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477595,"discussion_content":"不会引发，因为是用的AdminClient","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576199118,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":187852,"user_name":"helloworld","can_delete":false,"product_type":"c1","uid":1015754,"ip_address":"","ucode":"00DF2FEC58D2E6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","comment_is_top":false,"comment_ctime":1584260256,"is_pvip":false,"replies":[{"id":"72587","content":"这个JMX是在整个consumer级别上统计，而不是在单个topic或topic分区上统计。records-lag-max即记录所有订阅分区上最大的lag。lead也是同理","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1584320277,"ip_address":"","comment_id":187852,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23059096736","product_id":100029201,"comment_content":"若该消费者消费了一个主题中的多个分区，那通过JMX方式的第一个JMX指标kafka.consumer:type=consumer-fetch-manager-metrics,client-id=“{client-id}”角度如何理解，此时的两个监控项records-lag-max和records-lead-min分别代表什么含义？","like_count":5,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487267,"discussion_content":"这个JMX是在整个consumer级别上统计，而不是在单个topic或topic分区上统计。records-lag-max即记录所有订阅分区上最大的lag。lead也是同理","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584320277,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":162342,"user_name":"灰机","can_delete":false,"product_type":"c1","uid":1179580,"ip_address":"","ucode":"46F6CFC2DFAA2B","user_header":"https://static001.geekbang.org/account/avatar/00/11/ff/bc/368b9f80.jpg","comment_is_top":false,"comment_ctime":1576501783,"is_pvip":false,"replies":[{"id":"61785","content":"lead = end of offset - log start offset。通常情况下log start offset不等于0","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1576544051,"ip_address":"","comment_id":162342,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23051338263","product_id":100029201,"comment_content":"老师您好 理想情况下是不是lead值要等于offset-1？","like_count":5,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478019,"discussion_content":"lead = end of offset - log start offset。通常情况下log start offset不等于0","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576544051,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":161193,"user_name":"hunterlodge","can_delete":false,"product_type":"c1","uid":1069755,"ip_address":"","ucode":"5B83A79E784161","user_header":"https://static001.geekbang.org/account/avatar/00/10/52/bb/225e70a6.jpg","comment_is_top":false,"comment_ctime":1576141291,"is_pvip":false,"replies":[{"id":"61494","content":"不会引发lag，因为用的是AdminClient","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1576198979,"ip_address":"","comment_id":161193,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23050977771","product_id":100029201,"comment_content":"老师，您的那段获取消费组的lag代码，是会导致新的consumer加入到消费组里，从而引起rebalance的吧？","like_count":5,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477637,"discussion_content":"不会引发lag，因为用的是AdminClient","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576198979,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":140188,"user_name":"昀溪","can_delete":false,"product_type":"c1","uid":1493286,"ip_address":"","ucode":"BFAF31542BC24A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoCl6Nxf9oW9sDOoibA7p8lKf0jqjPeDszqI4e7iavicQHtbtyibHIhLibyXYAaT02l7GRQvM9BJUxh6yQ/132","comment_is_top":false,"comment_ctime":1570845735,"is_pvip":false,"replies":[{"id":"54224","content":"目前无法获取到集群中生产者的数量信息，因为broker端并没有这方面的记录。消费者的话可以使用kafka-consumer-groups命令来间接获取","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1570868984,"ip_address":"","comment_id":140188,"utype":1}],"discussion_count":3,"race_medal":0,"score":"18750714919","product_id":100029201,"comment_content":"老师 怎么能够获取生产者 消费者和主题的关系呢。 我们想要梳理目前线上的 哪些生产者往哪些主题发消息以及哪些消费者消费某些主题。希望能快速获取并梳理出来 老师能不能给一些思路 谢谢","like_count":4,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470289,"discussion_content":"目前无法获取到集群中生产者的数量信息，因为broker端并没有这方面的记录。消费者的话可以使用kafka-consumer-groups命令来间接获取","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570868984,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1132315,"avatar":"https://static001.geekbang.org/account/avatar/00/11/47/1b/64262861.jpg","nickname":"胡小禾","note":"","ucode":"1C23B7492C0C9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":265446,"discussion_content":"有一种思路：生产者自己上报到ZK等 存储中","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589387076,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1493286,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoCl6Nxf9oW9sDOoibA7p8lKf0jqjPeDszqI4e7iavicQHtbtyibHIhLibyXYAaT02l7GRQvM9BJUxh6yQ/132","nickname":"昀溪","note":"","ucode":"BFAF31542BC24A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":30907,"discussion_content":"那生产者就只能从代码里去找了吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570869139,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":119456,"user_name":"陆攀","can_delete":false,"product_type":"c1","uid":1182242,"ip_address":"","ucode":"340C18A6111EF8","user_header":"https://static001.geekbang.org/account/avatar/00/12/0a/22/fed393e9.jpg","comment_is_top":false,"comment_ctime":1564593667,"is_pvip":false,"replies":[{"id":"43862","content":"消息里面有创建的时间戳，可以用程序自行计算","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1564627638,"ip_address":"","comment_id":119456,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18744462851","product_id":100029201,"comment_content":"老师，除了监控lag外，我还想监控消费的延迟时间。比如我想知道消费的当条数据的产生时间和当前最后一条数据的产生时间的差。这种有什么办法吗？","like_count":4,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460910,"discussion_content":"消息里面有创建的时间戳，可以用程序自行计算","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564627638,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117919,"user_name":"wykkx","can_delete":false,"product_type":"c1","uid":1122358,"ip_address":"","ucode":"ABCDF49E7A95C8","user_header":"https://static001.geekbang.org/account/avatar/00/11/20/36/b3e2f1d5.jpg","comment_is_top":false,"comment_ctime":1564191827,"is_pvip":false,"replies":[{"id":"43216","content":"可以随意指定，不过要额外加上--partition参数","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1564216251,"ip_address":"","comment_id":117919,"utype":1}],"discussion_count":2,"race_medal":0,"score":"18744061011","product_id":100029201,"comment_content":"老师请教下，使用bin&#47;kafka-consumer-groups.sh这个方法，如果是独立的消费者，groupid那个地方要怎么填，刚才文章里还是没有说啊，谢谢。","like_count":4,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460180,"discussion_content":"可以随意指定，不过要额外加上--partition参数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564216251,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1155646,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKotsBr2icbYNYlRSlicGUD1H7lulSTQUAiclsEz9gnG5kCW9qeDwdYtlRMXic3V6sj9UrfKLPJnQojag/132","nickname":"ppd0705","note":"","ucode":"EB63D4E3FD1E9A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579628,"discussion_content":"同问，python 和 go 版本standalone 消费者都没有 groupID 的, 该怎么查呢？ kafka-consumer-group.sh --list 也看不到 standalone 消费者","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657588330,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":237358,"user_name":"小源哥","can_delete":false,"product_type":"c1","uid":1730754,"ip_address":"","ucode":"B5130CE20CF31D","user_header":"https://static001.geekbang.org/account/avatar/00/1a/68/c2/b112da90.jpg","comment_is_top":false,"comment_ctime":1595808271,"is_pvip":false,"replies":[{"id":"87675","content":"可以的~","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1595810994,"ip_address":"","comment_id":237358,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14480710159","product_id":100029201,"comment_content":"leed指的是消费者的位移距离当前还没被删除的第一条消息的差值，可以这么理解吗","like_count":3,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":502387,"discussion_content":"可以的~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595810994,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":187850,"user_name":"helloworld","can_delete":false,"product_type":"c1","uid":1015754,"ip_address":"","ucode":"00DF2FEC58D2E6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","comment_is_top":false,"comment_ctime":1584259749,"is_pvip":false,"replies":[{"id":"72588","content":"这是客户端的JMX指标，进了2.0.0版本的客户端代码。详见https:&#47;&#47;issues.apache.org&#47;jira&#47;browse&#47;KAFKA-6184","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1584320572,"ip_address":"","comment_id":187850,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14469161637","product_id":100029201,"comment_content":"我用的Kafka版本为kafka_2.11-2.1.1，Kafka Java 客户端版本为1.0.0发现只有kafka.consumer中的records-lag-max，没有records-lead-min；并且也没有分区相关的jmx信息","like_count":3,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487266,"discussion_content":"这是客户端的JMX指标，进了2.0.0版本的客户端代码。详见https://issues.apache.org/jira/browse/KAFKA-6184","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584320572,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1015754,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","nickname":"helloworld","note":"","ucode":"00DF2FEC58D2E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":205777,"discussion_content":"感谢老师提供这么有说服力的答案！给赞！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584340966,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":149652,"user_name":"柯察金","can_delete":false,"product_type":"c1","uid":1115149,"ip_address":"","ucode":"F722BF8FCD2C47","user_header":"https://static001.geekbang.org/account/avatar/00/11/04/0d/3dc5683a.jpg","comment_is_top":false,"comment_ctime":1573304690,"is_pvip":false,"replies":[{"id":"57670","content":"第一、不会引入rebalance，因为没有subscribe；<br>第二、可以，因为AdminClient的listConsumerGroupOffsets访问所有分区","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1573433261,"ip_address":"","comment_id":149652,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14458206578","product_id":100029201,"comment_content":"感觉通过 javaAPI 的方式有问题啊。第一，引入 consumer 只是获取位移，可能会引起 rebalance。而且 consumer.endOffsets(consumedOffsets.keySet()); 这个方法，consumer 能获取到所有分区的位移信息吗？我一直以为是这样的：consumer 只能获取这个 consumer 所分配到的分区的位移","like_count":3,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473927,"discussion_content":"第一、不会引入rebalance，因为没有subscribe；\n第二、可以，因为AdminClient的listConsumerGroupOffsets访问所有分区","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573433261,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":116816,"user_name":"我已经设置了昵称","can_delete":false,"product_type":"c1","uid":1364034,"ip_address":"","ucode":"ED672C5EBDBDC4","user_header":"https://static001.geekbang.org/account/avatar/00/14/d0/42/6fd01fb9.jpg","comment_is_top":false,"comment_ctime":1563929550,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14448831438","product_id":100029201,"comment_content":"我们用的kafka manager。有个疑问，kafka监控工具对于单条信息支持都不好，是kafka本身特性就不支持还是怎么样。rocketMQ支持的就很好","like_count":3,"discussions":[{"author":{"id":1181106,"avatar":"https://static001.geekbang.org/account/avatar/00/12/05/b2/2ff81f75.jpg","nickname":"bee","note":"","ucode":"5D9820E5C36F1F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3871,"discussion_content":"可以试试kafkahq 我觉得比kafkamanage好用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564905335,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":116333,"user_name":"nightmare","can_delete":false,"product_type":"c1","uid":1056314,"ip_address":"","ucode":"EF2E51C2122A86","user_header":"https://static001.geekbang.org/account/avatar/00/10/1e/3a/5b21c01c.jpg","comment_is_top":false,"comment_ctime":1563842134,"is_pvip":false,"replies":[{"id":"42577","content":"是啊，因为已经逼近最早的消息了","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1563849674,"ip_address":"","comment_id":116333,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14448744022","product_id":100029201,"comment_content":"Lead的越小就代表可能会丢消息了吗？","like_count":3,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459490,"discussion_content":"是啊，因为已经逼近最早的消息了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563849674,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1536109,"avatar":"","nickname":"Geek_271d79","note":"","ucode":"5F40D1042D70F6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4112,"discussion_content":"有没可能是工具的原因，取分区offset和group的consumer offset的时间差导致的，我看yahoo的kafka manager有这个问题。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565140504,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":134157,"user_name":"谢特","can_delete":false,"product_type":"c1","uid":1248684,"ip_address":"","ucode":"9C30DBFECFE649","user_header":"https://static001.geekbang.org/account/avatar/00/13/0d/ac/09678490.jpg","comment_is_top":false,"comment_ctime":1568768465,"is_pvip":false,"replies":[{"id":"51436","content":"也不是绝对的相反关系，只是说明大概率情况下如果lag增加了，那么说明consumer消费速度慢了，自然已消费的位移就比较靠近起始位移了","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1568769545,"ip_address":"","comment_id":134157,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10158703057","product_id":100029201,"comment_content":"为什么lag值大，lead值就小呢","like_count":2,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467635,"discussion_content":"也不是绝对的相反关系，只是说明大概率情况下如果lag增加了，那么说明consumer消费速度慢了，自然已消费的位移就比较靠近起始位移了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568769545,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132448,"user_name":"chp","can_delete":false,"product_type":"c1","uid":1112415,"ip_address":"","ucode":"F0A2442230CD45","user_header":"https://static001.geekbang.org/account/avatar/00/10/f9/5f/b0a125a9.jpg","comment_is_top":false,"comment_ctime":1568124279,"is_pvip":false,"replies":[{"id":"50672","content":"我不太建议出现问题就重启，因为重启之后在想弄清楚原因就比较困难了。不妨先诊断一下为什么出现滞后，是否是因为消息处理时间太长导致，如果是因为这个即使重启也无助于事的","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1568161095,"ip_address":"","comment_id":132448,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10158058871","product_id":100029201,"comment_content":"老师，发现消息滞后后，应该怎么办？重启消费者？","like_count":2,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466944,"discussion_content":"我不太建议出现问题就重启，因为重启之后在想弄清楚原因就比较困难了。不妨先诊断一下为什么出现滞后，是否是因为消息处理时间太长导致，如果是因为这个即使重启也无助于事的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568161095,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":121213,"user_name":"老邢","can_delete":false,"product_type":"c1","uid":1433138,"ip_address":"","ucode":"28944333440C0D","user_header":"https://static001.geekbang.org/account/avatar/00/15/de/32/509d6b10.jpg","comment_is_top":false,"comment_ctime":1565079609,"is_pvip":false,"replies":[{"id":"44623","content":"你可以手动写代码实现。用AdminClient的各个API组合实现<br>","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1565138610,"ip_address":"","comment_id":121213,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10155014201","product_id":100029201,"comment_content":"老师，请教下: 是否有方法可以直接监控某个topic的各个消费组的消费进度？","like_count":2,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461683,"discussion_content":"你可以手动写代码实现。用AdminClient的各个API组合实现\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565138610,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":116671,"user_name":"wykkx","can_delete":false,"product_type":"c1","uid":1122358,"ip_address":"","ucode":"ABCDF49E7A95C8","user_header":"https://static001.geekbang.org/account/avatar/00/11/20/36/b3e2f1d5.jpg","comment_is_top":false,"comment_ctime":1563887994,"is_pvip":false,"replies":[{"id":"42671","content":"可能是因为你的__consumer_offsets主题的副本因子是1，导致位移提交无法写入了，严格来说这也算是一个小bug。不过你可以先确认下，比如这样：<br>bin&#47;kafka-topics.sh --describe --bootstrap-server localhost:9092 --topic __consumer_offsets<br><br>要是2.0之前的版本，使用--zookeeper zk:port替换--bootstrap-server","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1563929350,"ip_address":"","comment_id":116671,"utype":1}],"discussion_count":3,"race_medal":0,"score":"10153822586","product_id":100029201,"comment_content":"老师 我三个节点的kafka集群，当min.insync.replicas=1设置为1的时候消费者可以正常消费数据，但是当这个值改为2的时候，消费者就收不到数据了。这是什么问题啊？<br>其他主要参数：<br>replica.fetch.max.bytes=10020000<br>message.max.bytes=10000000<br>auto.leader.rebalance.enable=false<br>unclean.leader.election.enable=false<br>request.required.acks=-1<br>default.replication.factor=3<br>message.send.max.retries=5<br>auto.create.topics.enable=false<br>这个问题搞了好几天了，也没搞明白，麻烦老师给看下，谢谢","like_count":2,"discussions":[{"author":{"id":1201577,"avatar":"https://static001.geekbang.org/account/avatar/00/12/55/a9/5282a560.jpg","nickname":"yic","note":"","ucode":"C8DC471B7C28B8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":168245,"discussion_content":"胡老师，问一下，为什么__consumer_offsets主题的副本因子是1，会导致位移提交无法写入呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581564599,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1292032,"avatar":"https://static001.geekbang.org/account/avatar/00/13/b7/00/12149f4e.jpg","nickname":"郭刚","note":"","ucode":"22CB8ECE8E3DCA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2834,"discussion_content":"我也是遇到了这种问题，修改了__consumer_offsets的副本数量就可以了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563961259,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1122358,"avatar":"https://static001.geekbang.org/account/avatar/00/11/20/36/b3e2f1d5.jpg","nickname":"wykkx","note":"","ucode":"ABCDF49E7A95C8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2770,"discussion_content":"一、首先非常感激老师，这个问题让我困惑很久了，确实如您所说 复制因子确实是1，那我要怎么处理呢？\n[root@cmwaec-kafka01 bin]# ./kafka-topics.sh --describe --zookeeper IP:2181 --topic __consumer_offsets    \nTopic:__consumer_offsets        PartitionCount:50       ReplicationFactor:1     Configs:segment.bytes=104857600,cleanup.policy=compact,compression.type=producer\n        Topic: __consumer_offsets       Partition: 0    Leader: 2       Replicas: 2     Isr: 2\n        Topic: __consumer_offsets       Partition: 1    Leader: 0       Replicas: 0     Isr: 0\n        Topic: __consumer_offsets       Partition: 2    Leader: 1       Replicas: 1     Isr: 1\n二、另外，我的版本是2.11但是kafka-topics.sh 里没有--bootstrap-server 还是--zookeeper 消费者sh中参数是--bootstrap-server\n麻烦老师了，我要怎么处理，才能设置min.insync.replicas=2\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563930075,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":116602,"user_name":"风中花","can_delete":false,"product_type":"c1","uid":1085237,"ip_address":"","ucode":"067E0A1E116844","user_header":"https://static001.geekbang.org/account/avatar/00/10/8f/35/f1839bb2.jpg","comment_is_top":false,"comment_ctime":1563879243,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"10153813835","product_id":100029201,"comment_content":"Lead 越小可以理解为消息回头跑了，不往前跑了，越小代表越接近来的地方，代表它回原点了。快完蛋了。相当于一个逆向衡量指标。","like_count":2,"discussions":[{"author":{"id":1529262,"avatar":"https://static001.geekbang.org/account/avatar/00/17/55/ae/7af3f742.jpg","nickname":"科学界","note":"","ucode":"E84BFE2C025209","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":185868,"discussion_content":"是因为消费速度跟不上kafka清理日志的速度了","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1582641762,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1336951,"avatar":"https://static001.geekbang.org/account/avatar/00/14/66/77/194ba21d.jpg","nickname":"lzh","note":"","ucode":"C3D83DF4230109","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":325710,"discussion_content":"我感觉你自己都不理解你自己在说啥...","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605411209,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":116453,"user_name":"Li Shunduo","can_delete":false,"product_type":"c1","uid":1222882,"ip_address":"","ucode":"6C5AB4129E9780","user_header":"https://static001.geekbang.org/account/avatar/00/12/a8/e2/f8e51df2.jpg","comment_is_top":false,"comment_ctime":1563852009,"is_pvip":false,"replies":[{"id":"42675","content":"都可以","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1563929820,"ip_address":"","comment_id":116453,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10153786601","product_id":100029201,"comment_content":"假设Kafka集群有3台broker，如果想要监控整个集群的指标，应该连接哪个broker，还是任何一个broker都可以？","like_count":2,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459545,"discussion_content":"都可以","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563929820,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":272619,"user_name":"归零","can_delete":false,"product_type":"c1","uid":1103208,"ip_address":"","ucode":"C99B8E93009A46","user_header":"https://static001.geekbang.org/account/avatar/00/10/d5/68/2201b6b9.jpg","comment_is_top":false,"comment_ctime":1610177733,"is_pvip":true,"replies":[{"id":"99094","content":"加油","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1610621000,"ip_address":"","comment_id":272619,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5905145029","product_id":100029201,"comment_content":"看到这里，kafka学习了一半，懵懵懂懂吧，打算回去梳理一下。再继续深入。<br>主要是看一下官方的文档。搭建一下集群和代码实操下(在公司主要是只用运维和中间件的同学搭好的架子实现相关的业务逻辑)","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513326,"discussion_content":"加油","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610621000,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":263993,"user_name":"Coding小先","can_delete":false,"product_type":"c1","uid":1051563,"ip_address":"","ucode":"965B1CC757E026","user_header":"https://static001.geekbang.org/account/avatar/00/10/0b/ab/0e2857e5.jpg","comment_is_top":false,"comment_ctime":1606309156,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5901276452","product_id":100029201,"comment_content":"Lag 是消费者最新 offset 跟 broker 最新的 LSO 之间的差距。Lead 是消费者最新 offset 跟 broker 最旧的 offset 的差距。<br>Lag 变大，消费者消费速度跟不上生产者速度<br>Lead 变小，未消费的消息积压太久了，可能会被删除导致消息丢失。","like_count":1},{"had_liked":false,"id":212522,"user_name":"马吉辉","can_delete":false,"product_type":"c1","uid":1854657,"ip_address":"","ucode":"4265EFBD2BB7BD","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKVIjh4T1akib5iav5IIGjXB9x98p9Y80STRcwpMDqxfGLrMvHamxlxEqLMTpiayWFWSNpBcbGwkRjRw/132","comment_is_top":false,"comment_ctime":1588141053,"is_pvip":false,"replies":[{"id":"78961","content":"这是默认已经提供的，不需要用户实现。只要你连入consumer的JMX端口服务就能看到它","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1588152403,"ip_address":"","comment_id":212522,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5883108349","product_id":100029201,"comment_content":"Kafka 消费者还在分区级别提供了额外的 JMX 指标，用于单独监控分区级别的 Lag 和 Lead 值。JMX 名称为：kafka.consumer:type=consumer-fetch-manager-metrics,partition=“{partition}”,topic=“{topic}”,client-id=“{client-id}”。<br>--------<br>这个具体应该如何去实现呢？小白，望请教","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493535,"discussion_content":"这是默认已经提供的，不需要用户实现。只要你连入consumer的JMX端口服务就能看到它","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588152403,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":212517,"user_name":"马吉辉","can_delete":false,"product_type":"c1","uid":1854657,"ip_address":"","ucode":"4265EFBD2BB7BD","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKVIjh4T1akib5iav5IIGjXB9x98p9Y80STRcwpMDqxfGLrMvHamxlxEqLMTpiayWFWSNpBcbGwkRjRw/132","comment_is_top":false,"comment_ctime":1588140520,"is_pvip":false,"replies":[{"id":"78960","content":"consumer端JMX端口也是用户自己设置的，和Broker端jmx端口设置方法一致","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1588152366,"ip_address":"","comment_id":212517,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5883107816","product_id":100029201,"comment_content":"consumer端的jmx的端口是什么呢？比如我是用Python clickhouse 去消费kafka的数据的<br>----<br>我可能就是连接的broker端的jmx端口 9999 但是 consumer端的jmx有是多少呢？","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493530,"discussion_content":"consumer端JMX端口也是用户自己设置的，和Broker端jmx端口设置方法一致","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588152366,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1097125,"avatar":"https://static001.geekbang.org/account/avatar/00/10/bd/a5/179015d9.jpg","nickname":"Alan","note":"","ucode":"FC21DDAF34B492","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288111,"discussion_content":"老师 你好，这个没懂是怎么设置？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593653635,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117636,"user_name":"明翼","can_delete":false,"product_type":"c1","uid":1068361,"ip_address":"","ucode":"E77F86BEB3D5C1","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","comment_is_top":false,"comment_ctime":1564103951,"is_pvip":false,"replies":[{"id":"43368","content":"1. 没听说有这样的机制。相互影响肯定是有，不过我倾向于认为是负相关。你说的这种正相关我觉得一定是其他的原因<br>2. 你能确定哪个是原因，哪个是结果吗？有没有可能是因为你的producer快，所以consumer快，而不是consumer快producer才快？","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1564362171,"ip_address":"","comment_id":117636,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5859071247","product_id":100029201,"comment_content":"老师，我有个问题啊，我们生成环境用用kafka0.10.2.0这个版本，我们有一个程序从kafka中消费数据入到es中，我们一直在监控lag的情况，发现一个规律就是生产者生成的越快，消费端越快，开始以为是因为数据在系统缓存中，所以消费快，后面一看不对，理由是数据延迟比较大，数据无论如何是没办法用到缓存的都需要从磁盘读的；；另外我查看了分区的均衡性，很均衡；此外，我们也分析了日志，从kafka的消费的速度一直很快，延迟卡在入es的速度；<br>我的问题是：<br>1）对kafka来讲，消费端和生成端的速度是否相互影响，比如我消费的快了，生产才可以快？<br>2）还有什么可能原因造成消费端的消费速度和生成速度又这种正相关？","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460062,"discussion_content":"1. 没听说有这样的机制。相互影响肯定是有，不过我倾向于认为是负相关。你说的这种正相关我觉得一定是其他的原因\n2. 你能确定哪个是原因，哪个是结果吗？有没有可能是因为你的producer快，所以consumer快，而不是consumer快producer才快？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564362171,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":116793,"user_name":"james","can_delete":false,"product_type":"c1","uid":1049208,"ip_address":"","ucode":"5701899403917C","user_header":"https://static001.geekbang.org/account/avatar/00/10/02/78/23c56bce.jpg","comment_is_top":false,"comment_ctime":1563927360,"is_pvip":false,"replies":[{"id":"42670","content":"lead不会为负，消息都被删除了就没法消费了：（","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1563929112,"ip_address":"","comment_id":116793,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5858894656","product_id":100029201,"comment_content":"start 是 1，生产到了 10，消费到6，那么lag 是 4，head 是 3，如果消费足够慢慢到删除老的消息后，start 变成 5，那 head 就变成 1，此时还没丢消息，当继续慢，start 变为 8，head 变为 -2，因此只有当变为负数，才代表要丢消息，老师对吗？","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459687,"discussion_content":"lead不会为负，消息都被删除了就没法消费了：（","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563929112,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1068361,"avatar":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","nickname":"明翼","note":"","ucode":"E77F86BEB3D5C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2991,"discussion_content":"老师，他这个例子中，开始的时候lead应该是为6-1 =5吧，不是3；我是这样理解的，单位时间内的消息看作一个线段，起点是最老消息，终点是最新消息，消费的消息在这个线段中的一点，用消费消息-最老消息就是lead，用最新消息-消费消息就是lag，对不对？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564103565,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":116476,"user_name":"Jian","can_delete":false,"product_type":"c1","uid":1023040,"ip_address":"","ucode":"358133EC2AFEB0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9c/40/6323850e.jpg","comment_is_top":false,"comment_ctime":1563854986,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5858822282","product_id":100029201,"comment_content":"还是该选用监控系统，除非是需要自己尝试编写一个监控服务。各个云厂商也会提供自己的监控服务吧","like_count":0},{"had_liked":false,"id":116396,"user_name":"lmtoo","can_delete":false,"product_type":"c1","uid":1133918,"ip_address":"","ucode":"FCD5B9C941D448","user_header":"https://static001.geekbang.org/account/avatar/00/11/4d/5e/c5c62933.jpg","comment_is_top":false,"comment_ctime":1563846631,"is_pvip":false,"replies":[{"id":"42578","content":"取决于auto.offset.reset的值","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1563849734,"ip_address":"","comment_id":116396,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5858813927","product_id":100029201,"comment_content":"如果消费者慢到消费的数据被删除，会出现两个后果，1消费者从头消费一遍数据，2从最新消息位移开始消费；这个从头消费一遍数据，也会导致消费的消息丢失？导致这两个后果的条件分别是什么？为什么同样的情况会导致不同的后果","like_count":2,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459520,"discussion_content":"取决于auto.offset.reset的值","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563849734,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1132315,"avatar":"https://static001.geekbang.org/account/avatar/00/11/47/1b/64262861.jpg","nickname":"胡小禾","note":"","ucode":"1C23B7492C0C9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":265447,"discussion_content":"默认情况下，auto.offset.reset=latest. 即 从分区上的最新的offset开始。若设为ealiest，则为最小的offset开始（未必是0）。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589387397,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1068361,"avatar":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","nickname":"明翼","note":"","ucode":"E77F86BEB3D5C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2993,"discussion_content":"哇，那这样，如果消费慢到被删除了的消息了，还是非常危险的事情，如果设置从最新消息处消费会造成大量丢失啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564103671,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":340188,"user_name":"i_chase","can_delete":false,"product_type":"c1","uid":1795511,"ip_address":"","ucode":"09C41C863F4EA3","user_header":"https://static001.geekbang.org/account/avatar/00/1b/65/b7/058276dc.jpg","comment_is_top":false,"comment_ctime":1648649269,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1648649269","product_id":100029201,"comment_content":"这个lead的概念好像搜不到，有文档吗","like_count":0},{"had_liked":false,"id":338704,"user_name":"佐加佑－","can_delete":false,"product_type":"c1","uid":2346162,"ip_address":"","ucode":"1287213A378A0B","user_header":"https://static001.geekbang.org/account/avatar/00/23/cc/b2/c038ca2e.jpg","comment_is_top":false,"comment_ctime":1647675082,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1647675082","product_id":100029201,"comment_content":"所以通过jmx来监控消费进度只能在consumer端，在broker端没有jmx指标可以用来监控消费进度吗？","like_count":0},{"had_liked":false,"id":268926,"user_name":"李勇","can_delete":false,"product_type":"c1","uid":1303796,"ip_address":"","ucode":"7BC9DE501890D4","user_header":"https://static001.geekbang.org/account/avatar/00/13/e4/f4/96fa9deb.jpg","comment_is_top":false,"comment_ctime":1608434773,"is_pvip":true,"replies":[{"id":"97586","content":"消费者要消费的消息不在页缓存中，所以需要执行物理I&#47;O去磁盘中读取，这是很慢的操作","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1608516105,"ip_address":"","comment_id":268926,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1608434773","product_id":100029201,"comment_content":"老师，分享中有句话如下：更可怕的是，由于消费者的速度无法匹及生产者的速度，极有可能导致它消费的数据已经不在操作系统的页缓存中了。 这句话应该如何理解呢？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":512085,"discussion_content":"消费者要消费的消息不在页缓存中，所以需要执行物理I/O去磁盘中读取，这是很慢的操作","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608516105,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":261014,"user_name":"快跑","can_delete":false,"product_type":"c1","uid":1564645,"ip_address":"","ucode":"90ED7E6D40C58E","user_header":"https://static001.geekbang.org/account/avatar/00/17/df/e5/65e37812.jpg","comment_is_top":false,"comment_ctime":1605173077,"is_pvip":false,"replies":[{"id":"94903","content":"lead趋于0说明consumer在消费的消息已经位于消息分区的头部了，说明消费的很慢了。需要加快处理的速度。","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1605423229,"ip_address":"","comment_id":261014,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1605173077","product_id":100029201,"comment_content":"真实环境中，如果遇到Lead趋近于0的情况，应该紧急处理下？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":509350,"discussion_content":"lead趋于0说明consumer在消费的消息已经位于消息分区的头部了，说明消费的很慢了。需要加快处理的速度。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605423229,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":261013,"user_name":"快跑","can_delete":false,"product_type":"c1","uid":1564645,"ip_address":"","ucode":"90ED7E6D40C58E","user_header":"https://static001.geekbang.org/account/avatar/00/17/df/e5/65e37812.jpg","comment_is_top":false,"comment_ctime":1605173033,"is_pvip":false,"replies":[{"id":"94904","content":"在非常非常老的版本中，它支持--zookeeper参数，说明也能从zookeeper中获取老版本consumer的位移，不过目前该工具只支持新版本consumer了","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1605423297,"ip_address":"","comment_id":261013,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1605173033","product_id":100029201,"comment_content":"kafka-consumer-groups.sh这个脚本工具是不是只能获取到offset保存在__consumer_offsets的情况下？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":509349,"discussion_content":"在非常非常老的版本中，它支持--zookeeper参数，说明也能从zookeeper中获取老版本consumer的位移，不过目前该工具只支持新版本consumer了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605423297,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":260267,"user_name":"翟岳辉","can_delete":false,"product_type":"c1","uid":1099755,"ip_address":"","ucode":"B5C0777AF0092B","user_header":"https://static001.geekbang.org/account/avatar/00/10/c7/eb/50a4842a.jpg","comment_is_top":false,"comment_ctime":1604972571,"is_pvip":false,"replies":[{"id":"94910","content":"这个是由底层的监控组件控制的，不是Kafka实现的。。。","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1605423561,"ip_address":"","comment_id":260267,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1604972571","product_id":100029201,"comment_content":"请问老师，什么叫窗口时间，怎么计算的","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":509151,"discussion_content":"这个是由底层的监控组件控制的，不是Kafka实现的。。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605423561,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":236178,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1595338645,"is_pvip":false,"replies":[{"id":"87310","content":"如何判定位移提交失败的？有什么错误日志吗？另外lag增加也许就是consumer无法追上producer的缘故<br>","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1595386668,"ip_address":"","comment_id":236178,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1595338645","product_id":100029201,"comment_content":"老师好，我用kafka manager监控topic的消费进度，只设置了一个分区，发现lag持续增加，但消费端也拿到消息了，我设置的自动提交位移。但是很奇怪，貌似位移提交不起作用了。也没有报错！！！请问老师有没遇到过位移提交失效导致的lag变大？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501972,"discussion_content":"如何判定位移提交失败的？有什么错误日志吗？另外lag增加也许就是consumer无法追上producer的缘故\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595386668,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":232177,"user_name":"蚂蚁","can_delete":false,"product_type":"c1","uid":1211429,"ip_address":"","ucode":"B3FEFB399536DF","user_header":"https://static001.geekbang.org/account/avatar/00/12/7c/25/7d9a2538.jpg","comment_is_top":false,"comment_ctime":1593886861,"is_pvip":false,"replies":[{"id":"85763","content":"对的。在引入消息时间戳之前，这的确是流行的做法","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1593997728,"ip_address":"","comment_id":232177,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1593886861","product_id":100029201,"comment_content":"如果消息连续不间断生产的，消息中业务可以加入写入消息的时间戳，这样消费者在消费时可以计算消息滞后的时间，这样也是表达滞后程度的一种表达方式。","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500546,"discussion_content":"对的。在引入消息时间戳之前，这的确是流行的做法","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593997728,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":224804,"user_name":"James","can_delete":false,"product_type":"c1","uid":1134861,"ip_address":"","ucode":"48B0F2A334D1C1","user_header":"https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg","comment_is_top":false,"comment_ctime":1591543812,"is_pvip":false,"replies":[{"id":"82958","content":"leader=-2有别的含义，它不是计算出来的","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1591709868,"ip_address":"","comment_id":224804,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1591543812","product_id":100029201,"comment_content":"请问下,在评论中有说lead为啥不会为负; 当前消费位移是10,慢到数据删除了,分区第一个位移是12了,lead=10-12=-2","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":497612,"discussion_content":"leader=-2有别的含义，它不是计算出来的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591709868,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":220414,"user_name":"行则将至","can_delete":false,"product_type":"c1","uid":1542987,"ip_address":"","ucode":"DB972F2DF059C4","user_header":"https://static001.geekbang.org/account/avatar/00/17/8b/4b/fa52d222.jpg","comment_is_top":false,"comment_ctime":1590237947,"is_pvip":false,"replies":[{"id":"81430","content":"首先要保持是一个session，bash有可能创建额外的session启动broker，和设置JMX_PORT的不是一个session。另外一个可能的原因是连接远程JMX需要一些认证和SSL配置。试试-Dcom.sun.management.jmxremote.authenticate=false<br><br>-Dcom.sun.management.jmxremote.ssl=false","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1590329530,"ip_address":"","comment_id":220414,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1590237947","product_id":100029201,"comment_content":"老师，我启动kafka的时候，启动命令的开头添加了JMX_PORT=9999，为啥在本地用jConsole连不上kafka呢？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496135,"discussion_content":"首先要保持是一个session，bash有可能创建额外的session启动broker，和设置JMX_PORT的不是一个session。另外一个可能的原因是连接远程JMX需要一些认证和SSL配置。试试-Dcom.sun.management.jmxremote.authenticate=false\n\n-Dcom.sun.management.jmxremote.ssl=false","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590329530,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":165949,"user_name":"林","can_delete":false,"product_type":"c1","uid":1039758,"ip_address":"","ucode":"C1483A3473E6A2","user_header":"https://static001.geekbang.org/account/avatar/00/0f/dd/8e/6f557300.jpg","comment_is_top":false,"comment_ctime":1577349438,"is_pvip":false,"replies":[{"id":"63325","content":"这通常是因为你的consumer group没有启动的缘故","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1577409654,"ip_address":"","comment_id":165949,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1577349438","product_id":100029201,"comment_content":"老师，你好，我们生产环境因为特殊的原因，会在很长时期内某个topic不会有新增数据，这时用kafka-consumer-groups.sh查看就会出现CURRENT-OFFSET和LAG显示为&#39;-&#39;，而LOG-END-OFFSET有值的情况，这是怎么回事，请解惑，谢谢。","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":479326,"discussion_content":"这通常是因为你的consumer group没有启动的缘故","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577409654,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1132315,"avatar":"https://static001.geekbang.org/account/avatar/00/11/47/1b/64262861.jpg","nickname":"胡小禾","note":"","ucode":"1C23B7492C0C9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":265449,"discussion_content":"consumer 太久没有启动的话， kafka 会把consumer group 可删除了。在KM或者用脚本看就会没有了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589387477,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":163145,"user_name":"宁静致远","can_delete":false,"product_type":"c1","uid":1659397,"ip_address":"","ucode":"B5AB4BE887BDE6","user_header":"https://static001.geekbang.org/account/avatar/00/19/52/05/cd180870.jpg","comment_is_top":false,"comment_ctime":1576663105,"is_pvip":false,"replies":[{"id":"62103","content":"这种多是ZooKeeper端的瞬时错误。Kafka端有什么具体的问题表现吗？如果没有忽略就好","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1576717305,"ip_address":"","comment_id":163145,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1576663105","product_id":100029201,"comment_content":"胡老师，你好。kafka集群有3个节点，有个节点每天22点左右总是报以下错误。Opening socket connection to server 192.4.0.28&#47;192.4.0.28:2181. Will not attempt to authenticate using SASL (unknown error) (org.apache.zookeeper.ClientCnxn)","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478264,"discussion_content":"这种多是ZooKeeper端的瞬时错误。Kafka端有什么具体的问题表现吗？如果没有忽略就好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576717305,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1659397,"avatar":"https://static001.geekbang.org/account/avatar/00/19/52/05/cd180870.jpg","nickname":"宁静致远","note":"","ucode":"B5AB4BE887BDE6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":89742,"discussion_content":"这个是kafka的错误，zookeeper错误和这个类似，在这个时间点，消费者rebalance出现的概率很大。kafka  zookeeper都是部署在docker环境，后来发现在这个点附近，其他服务访问时间也比平时长很多。估计那个时间段网络环境有问题。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576761592,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":162131,"user_name":"第一片心意","can_delete":false,"product_type":"c1","uid":1682331,"ip_address":"","ucode":"4CFE5F1D615743","user_header":"https://static001.geekbang.org/account/avatar/00/19/ab/9b/b12c223d.jpg","comment_is_top":false,"comment_ctime":1576464890,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576464890","product_id":100029201,"comment_content":"kafkaTool是个不错的工具。","like_count":0},{"had_liked":false,"id":130887,"user_name":"Guard-God","can_delete":false,"product_type":"c1","uid":1323298,"ip_address":"","ucode":"8B335151DE7977","user_header":"https://static001.geekbang.org/account/avatar/00/14/31/22/6c2677ec.jpg","comment_is_top":false,"comment_ctime":1567564956,"is_pvip":true,"replies":[{"id":"49121","content":"确实没有更好的了。因为目前你只能连接单个进程开放的JMX","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1567595873,"ip_address":"","comment_id":130887,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1567564956","product_id":100029201,"comment_content":"您好，我已经连接consumer的JMX端口。但是，又发现如果要配置监控consumer端的话，就不好维护了。因为有几十个消费者，同时有几十个topic, 如果这要是配置的话，大约配置需要几百个。我们基本上就是通过监控Broker，获取到每秒产生的消息数量，按照消费者和topic计算出生产速度和消费速度，同时监控topic所在的网络IO等。我们也是只是配置几个重要消费者，并没有全配置，因为维护成本有点高，请问还有其他好的监控或者配置方式吗","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466176,"discussion_content":"确实没有更好的了。因为目前你只能连接单个进程开放的JMX","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567595873,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1132315,"avatar":"https://static001.geekbang.org/account/avatar/00/11/47/1b/64262861.jpg","nickname":"胡小禾","note":"","ucode":"1C23B7492C0C9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":265455,"discussion_content":"consumer级别的JMX监控，可以集成到公司内部的监控系统中去。\n其实KM就应该在consumer instance级别提供JMX 指标入口\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589387991,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":125009,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1566043344,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566043344","product_id":100029201,"comment_content":"我和明翼的理解一样<br>好比一个带固定格子的传送带，producer不断的往格子里放砖头，consumer在后面追赶他不断的从格子中捡砖头，producer的位置和consumer的位置的格子数就是consumer没捡完的砖头数——lag。而这个传送带从头开始在燃烧着，consumer的位置和传送带当前正在燃烧的位置之间的格子数就是——lead<br>我们没用kafka，是公司架构部自研的，使用入队数、出队数、积压数、归档数等来表示消费的进度，这些数的取数原理和kafka想必类似!<br>","like_count":0},{"had_liked":false,"id":123756,"user_name":"大树","can_delete":false,"product_type":"c1","uid":1051102,"ip_address":"","ucode":"53768ABF0013E7","user_header":"https://static001.geekbang.org/account/avatar/00/10/09/de/55cc6c2f.jpg","comment_is_top":false,"comment_ctime":1565752655,"is_pvip":false,"replies":[{"id":"45567","content":"你连接是不是Broker端的JMX","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1565834580,"ip_address":"","comment_id":123756,"utype":1}],"discussion_count":4,"race_medal":0,"score":"1565752655","product_id":100029201,"comment_content":"为什么我在mbean树下找不到kafka.consumer,我的kafka版本是2.1.0","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462802,"discussion_content":"你连接是不是Broker端的JMX","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565834580,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1304528,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e7/d0/92803218.jpg","nickname":"黄腾飞","note":"","ucode":"E7EDF4A5A3BBBD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374761,"discussion_content":"我也碰到找不到kafka.consumer的情况，大佬们有思路了吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621337872,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1854657,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKVIjh4T1akib5iav5IIGjXB9x98p9Y80STRcwpMDqxfGLrMvHamxlxEqLMTpiayWFWSNpBcbGwkRjRw/132","nickname":"马吉辉","note":"","ucode":"4265EFBD2BB7BD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":252085,"discussion_content":"consumer端的jmx的端口是什么呢？比如我是用Python clickhouse 去消费kafka的数据的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588140442,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1051102,"avatar":"https://static001.geekbang.org/account/avatar/00/10/09/de/55cc6c2f.jpg","nickname":"大树","note":"","ucode":"53768ABF0013E7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4932,"discussion_content":"是的，你指的是消费端么","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565840130,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":118897,"user_name":"chon","can_delete":false,"product_type":"c1","uid":1068925,"ip_address":"","ucode":"1C32170972F726","user_header":"https://static001.geekbang.org/account/avatar/00/10/4f/7d/dd852b04.jpg","comment_is_top":false,"comment_ctime":1564459793,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1564459793","product_id":100029201,"comment_content":"那有啥工具可以查发送的消息是否真的被broker接收到了。生产中也经常需要定位某个消息是否已经成功发送，不知有啥好的工具","like_count":0,"discussions":[{"author":{"id":1391216,"avatar":"https://static001.geekbang.org/account/avatar/00/15/3a/70/a874d69c.jpg","nickname":"Mick","note":"","ucode":"5CCE3E2BDB110A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3470,"discussion_content":"写入成功之后会有回调通知的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564502777,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":118304,"user_name":"金hb.Ryan 冷空氣駕到","can_delete":false,"product_type":"c1","uid":1222233,"ip_address":"","ucode":"CAD363576696E4","user_header":"https://static001.geekbang.org/account/avatar/00/12/a6/59/1689ea0c.jpg","comment_is_top":false,"comment_ctime":1564317498,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564317498","product_id":100029201,"comment_content":"确实lead在一些场景下很重要","like_count":0},{"had_liked":false,"id":116548,"user_name":"许童童","can_delete":false,"product_type":"c1","uid":1003005,"ip_address":"","ucode":"4B799C0C6BC678","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg","comment_is_top":false,"comment_ctime":1563867242,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563867242","product_id":100029201,"comment_content":"老师讲得好！","like_count":0},{"had_liked":false,"id":116515,"user_name":"开水","can_delete":false,"product_type":"c1","uid":1528555,"ip_address":"","ucode":"651491C38B925B","user_header":"https://static001.geekbang.org/account/avatar/00/17/52/eb/eec719f3.jpg","comment_is_top":false,"comment_ctime":1563861989,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563861989","product_id":100029201,"comment_content":"lead越小应该是当前consumer消费的offset越接近该partition依旧保存消息的最大offset。再不快点消费完，就要被Kafka server删掉啦……","like_count":0},{"had_liked":false,"id":116462,"user_name":"柠檬C","can_delete":false,"product_type":"c1","uid":1181505,"ip_address":"","ucode":"BC0EE704D952A4","user_header":"https://static001.geekbang.org/account/avatar/00/12/07/41/2d477385.jpg","comment_is_top":false,"comment_ctime":1563852928,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563852928","product_id":100029201,"comment_content":"lead在左，lag在右","like_count":0}]}