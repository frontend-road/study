{"id":191493,"title":"11 | 文件配置提供程序：自由选择配置的格式","content":"<p><strong>各位亲爱的学员：</strong><br>\n推荐大家阅读一下配置框架的源码，代码量虽然不多，但这里面有不少可以借鉴的设计方法和代码风格，另外其中有一个ChainedConfigurationProvider，是课程里没有提到的，可以思考一下这个提供程序的使用场景。<br>\n源码下载地址：<a href=\"https://github.com/dotnet/extensions\">https://github.com/dotnet/extensions</a></p><p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/NET-Core\">https://gitee.com/geektime-geekbang/NET-Core</a></p>","comments":[{"had_liked":false,"id":197515,"user_name":"吕哲","can_delete":false,"product_type":"c3","uid":1118096,"ip_address":"","ucode":"C69AA0C296DDE3","user_header":"https://static001.geekbang.org/account/avatar/00/11/0f/90/1dc1c940.jpg","comment_is_top":false,"comment_ctime":1585382997,"is_pvip":false,"replies":[{"id":77157,"content":"感谢建议和支持","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1586875515,"ip_address":"","comment_id":197515,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"学到现在，感觉体验不是太好。提两个建议：\n1. 自上而下，讲一个东西的时候，最好能先结合案例讲清楚为什么要用这个东西。\n2. 抓住重点，类似的东西，可以举一反三的，就不用全部都演示一遍了。\n全站唯一一个.net相关的课程，老师加油啊！","like_count":5,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489538,"discussion_content":"感谢建议和支持","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586875515,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1661704,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","nickname":"丁丁历险记","note":"","ucode":"A43829E454C067","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582890,"discussion_content":"这老师应当该是不习惯whw 方法。\n这就是一个基础使用的cookbook\n基础实现一讲，能让人上个路就完了，别想太多。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659757413,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":209810,"user_name":"Geek_ae287d","can_delete":false,"product_type":"c3","uid":1974714,"ip_address":"","ucode":"7B627A8B1EF9FE","user_header":"","comment_is_top":false,"comment_ctime":1587619280,"is_pvip":false,"replies":[{"id":80610,"content":"感谢建议","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1589685468,"ip_address":"","comment_id":209810,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"希望提供一个id4权限和授权的东西希望可以深入讲解(id4在微服务的应用)  你可以在开一个课程  肯定会购买因为网上东东太乱没系统  老师课程讲解容易懂 喜欢这种授课方式 希望可以加入微服务架构负载均衡算法Consul实现服务治理的应用例子 ","like_count":1,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492872,"discussion_content":"感谢建议","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589685468,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":174367,"user_name":"ff","can_delete":false,"product_type":"c3","uid":1024545,"ip_address":"","ucode":"2CE7182F48FE01","user_header":"","comment_is_top":false,"comment_ctime":1580181442,"is_pvip":false,"replies":[{"id":67832,"content":"应用程序池是IIS里的概念，ASP.NET Core经过了重新设计，与Framework的ASP.NET完全不同，修改配置文件，程序不会重启，并不会造成session丢失。\n\n另外，你说的之前ASP.NET改配置重启session丢失应该是使用了应用内存session，如果使用分布式session存储的话，也是不会丢失的。","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1580269525,"ip_address":"","comment_id":174367,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"老师好\n当监听到文件变化时，如果是web程序，应用程序池会重启吗，因为之前的framework版本的话，调整了配置文件时，会直接导致session丢失","like_count":1,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482379,"discussion_content":"应用程序池是IIS里的概念，ASP.NET Core经过了重新设计，与Framework的ASP.NET完全不同，修改配置文件，程序不会重启，并不会造成session丢失。\n\n另外，你说的之前ASP.NET改配置重启session丢失应该是使用了应用内存session，如果使用分布式session存储的话，也是不会丢失的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580269525,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1313882,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0c/5a/3b01789e.jpg","nickname":"Quintos","note":"","ucode":"DD1FB190599279","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":158721,"discussion_content":".net framework 用的webconfig修改的话，应该会导致站点重启","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580617507,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":182334,"user_name":"王亚","can_delete":false,"product_type":"c3","uid":1810841,"ip_address":"","ucode":"765CDC2A4DF8CF","user_header":"https://static001.geekbang.org/account/avatar/00/1b/a1/99/137f5ff7.jpg","comment_is_top":false,"comment_ctime":1582769792,"is_pvip":false,"replies":[{"id":70991,"content":"应该是ConfigurationBuilder，单词拼错拉","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1583044785,"ip_address":"","comment_id":182334,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"老师您好  在引用相同包的前提下 var builder = new ConfigurationBinder(); 这行代码在控制台可以编译   但在wepapi中却不能这样写  为什么呢？","like_count":0,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485309,"discussion_content":"应该是ConfigurationBuilder，单词拼错拉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583044785,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":173957,"user_name":"WAKU","can_delete":false,"product_type":"c3","uid":1692584,"ip_address":"","ucode":"CC1F885AD95F10","user_header":"https://static001.geekbang.org/account/avatar/00/19/d3/a8/5b1e9c03.jpg","comment_is_top":false,"comment_ctime":1579830252,"is_pvip":false,"replies":[{"id":67687,"content":"optional 默认为 false，如果为true，则表示如果文件不存在，就忽略掉。\n\n","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1579960743,"ip_address":"","comment_id":173957,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"Optional = true时, 没有讲解, 是忘了吗","like_count":0,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482257,"discussion_content":"optional 默认为 false，如果为true，则表示如果文件不存在，就忽略掉。\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579960743,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":178444,"user_name":"路人甲","can_delete":false,"product_type":"c3","uid":1480119,"ip_address":"","ucode":"B720984454AFAF","user_header":"https://static001.geekbang.org/account/avatar/00/16/95/b7/15e157ec.jpg","comment_is_top":false,"comment_ctime":1581690838,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"踩坑了， json,ini 文件 要始终复制。","like_count":3},{"had_liked":false,"id":370722,"user_name":"Green","can_delete":false,"product_type":"c3","uid":1997351,"ip_address":"广东","ucode":"05953EB6CD972F","user_header":"https://static001.geekbang.org/account/avatar/00/1e/7a/27/edf429a4.jpg","comment_is_top":false,"comment_ctime":1679140640,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"AddJsonFile(&quot;appsettings.json&quot;) 报错找不到可选文件\n1. 修改.csproj \n&lt;ItemGroup&gt;\n  &lt;Content Include=&quot;appsettings.json&quot;&gt;\n    &lt;CopyToOutputDirectory&gt;Always&lt;&#47;CopyToOutputDirectory&gt;\n  &lt;&#47;Content&gt;\n&lt;&#47;ItemGroup&gt;\n通过将文件的 &quot;Copy to Output Directory&quot; 属性设置为 &quot;Copy always&quot; 或 &quot;Copy if newer&quot;，您可以确保文件在运行时可用，并且它们始终与源文件同步。\n\n2.右键appsettings.json -&gt; 属性 -&gt; 复制到输出目录 -&gt; 选择 “始终复制” 即可解决这个坑","like_count":0},{"had_liked":false,"id":353765,"user_name":"丁丁历险记","can_delete":false,"product_type":"c3","uid":1661704,"ip_address":"广东","ucode":"A43829E454C067","user_header":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","comment_is_top":false,"comment_ctime":1659757297,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"几行基础代码，那么多坑，builder.AddJsonFile(&quot;xxx.json&quot;) 没屁用，文件加载不了。\n\n写绝对路径才出来。","like_count":0},{"had_liked":false,"id":344225,"user_name":"A","can_delete":false,"product_type":"c3","uid":2665768,"ip_address":"","ucode":"4BCD7E95816C28","user_header":"https://static001.geekbang.org/account/avatar/00/28/ad/28/408ca65b.jpg","comment_is_top":false,"comment_ctime":1651378851,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"这里补充下，AddJsonFile方法的optional参数如果选择false,bin文件中没有该文件，也就是没有选择总是复制选项，在build时会抛出错误，而选择为true，则不会，当然对应的配置里面也不会加载到文件数据了，\n总结：就是没有文件会提示你抛出一个异常","like_count":0},{"had_liked":false,"id":338478,"user_name":"Duke","can_delete":false,"product_type":"c3","uid":2131512,"ip_address":"","ucode":"77BB22ADCC2AB9","user_header":"https://static001.geekbang.org/account/avatar/00/20/86/38/379a9da5.jpg","comment_is_top":false,"comment_ctime":1647517273,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"看了蒋金楠大佬的书之后。再来看，这些代码的作用 用途是什么非常清晰","like_count":0},{"had_liked":false,"id":309735,"user_name":"InHero","can_delete":false,"product_type":"c3","uid":2634637,"ip_address":"","ucode":"F1D09AA0EBABDF","user_header":"https://static001.geekbang.org/account/avatar/00/28/33/8d/767a13ec.jpg","comment_is_top":false,"comment_ctime":1630315717,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100044601,"comment_content":".NetCore5.0之后更新了 大家可以参考文档 https:&#47;&#47;docs.microsoft.com&#47;zh-cn&#47;aspnet&#47;core&#47;fundamentals&#47;configuration&#47;?view=aspnetcore-6.0#file-configuration-provider","like_count":0},{"had_liked":false,"id":306664,"user_name":"Geek_590cca","can_delete":false,"product_type":"c3","uid":2616085,"ip_address":"","ucode":"D0D6BDC62E5AE8","user_header":"https://static001.geekbang.org/account/avatar/00/27/eb/15/456dcc3d.jpg","comment_is_top":false,"comment_ctime":1628662920,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100044601,"comment_content":"关于Json配置文件的两点：\n1. 添加配置文件后，要将“复制到输出目录” 设置为始终复制\n2. 如果你的配置文件有中文，输出会乱码，建议用VScode 打开配置文件进行修改，保存后可以成功显示中文","like_count":0},{"had_liked":false,"id":262582,"user_name":"背包客","can_delete":false,"product_type":"c3","uid":1671740,"ip_address":"","ucode":"C07A0F137C5CB5","user_header":"https://static001.geekbang.org/account/avatar/00/19/82/3c/8a0cacd4.jpg","comment_is_top":false,"comment_ctime":1605773184,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100044601,"comment_content":"老师好！\n    appsettings  中 &quot;Key1&quot;:&quot;我是 Key1&quot;，value内容包含中文。\n    获取的时候 Console.WriteLine($&quot;我要获取key1 的值:{configureationRoot[&quot;Key1&quot;]}&quot;);\n    显示结果：  ????Key1   。\n    这是不支持中文吗？\n    \n\n\n\n","like_count":0}]}