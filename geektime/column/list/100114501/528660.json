{"id":528660,"title":"04｜创建容器镜像：如何编写正确、高效的Dockerfile","content":"<p>你好，我是Chrono。</p><p>上一次的课程里我们一起学习了容器化的应用，也就是被打包成镜像的应用程序，然后再用各种Docker命令来运行、管理它们。</p><p>那么这又会带来一个疑问：这些镜像是怎么创建出来的？我们能不能够制作属于自己的镜像呢？</p><p>所以今天，我就来讲解镜像的内部机制，还有高效、正确地编写Dockerfile制作容器镜像的方法。</p><h2>镜像的内部机制是什么</h2><p>现在你应该知道，镜像就是一个打包文件，里面包含了应用程序还有它运行所依赖的环境，例如文件系统、环境变量、配置参数等等。</p><p>环境变量、配置参数这些东西还是比较简单的，随便用一个manifest清单就可以管理，真正麻烦的是文件系统。为了保证容器运行环境的一致性，镜像必须把应用程序所在操作系统的根目录，也就是rootfs，都包含进来。</p><p>虽然这些文件里不包含系统内核（因为容器共享了宿主机的内核），但如果每个镜像都重复做这样的打包操作，仍然会导致大量的冗余。可以想象，如果有一千个镜像，都基于Ubuntu系统打包，那么这些镜像里就会重复一千次Ubuntu根目录，对磁盘存储、网络传输都是很大的浪费。</p><p>很自然的，我们就会想到，应该把重复的部分抽取出来，只存放一份Ubuntu根目录文件，然后让这一千个镜像以某种方式共享这部分数据。</p><!-- [[[read_end]]] --><p>这个思路，也正是容器镜像的一个重大创新点：分层，术语叫“<strong>Layer</strong>”。</p><p>容器镜像内部并不是一个平坦的结构，而是由许多的镜像层组成的，每层都是只读不可修改的一组文件，相同的层可以在镜像之间共享，然后多个层像搭积木一样堆叠起来，再使用一种叫“<strong>Union FS联合文件系统</strong>”的技术把它们合并在一起，就形成了容器最终看到的文件系统（<a href=\"https://linoxide.com/wp-content/uploads/2015/03/docker-filesystems-busyboxrw.png\">图片来源</a>）。</p><p><img src=\"https://static001.geekbang.org/resource/image/c7/3f/c750a7795ff4787c6639dd42bf0a473f.png?wh=800x600\" alt=\"图片\"></p><p>我来拿大家都熟悉的千层糕做一个形象的比喻吧。</p><p>千层糕也是由很多层叠加在一起的，从最上面可以看到每层里面镶嵌的葡萄干、核桃、杏仁、青丝等，每一层糕就相当于一个Layer，干果就好比是Layer里的各个文件。但如果某两层的同一个位置都有干果，也就是有文件同名，那么我们就只能看到上层的文件，而下层的就被屏蔽了。</p><p>你可以用命令 <code>docker inspect</code> 来查看镜像的分层信息，比如nginx:alpine镜像：</p><pre><code class=\"language-plain\">docker inspect nginx:alpine\n</code></pre><p>它的分层信息在“RootFS”部分：<br>\n<img src=\"https://static001.geekbang.org/resource/image/5y/b7/5yybd821a12ec1323f6ea8bb5a5c4ab7.png?wh=1920x592\" alt=\"图片\"></p><p>通过这张截图就可以看到，nginx:alpine镜像里一共有6个Layer。</p><p>相信你现在也就明白，之前在使用 <code>docker pull</code>、<code>docker rmi</code> 等命令操作镜像的时候，那些“奇怪”的输出信息是什么了，其实就是镜像里的各个Layer。Docker会检查是否有重复的层，如果本地已经存在就不会重复下载，如果层被其他镜像共享就不会删除，这样就可以节约磁盘和网络成本。</p><h2>Dockerfile是什么</h2><p>知道了容器镜像的内部结构和基本原理，我们就可以来学习如何自己动手制作容器镜像了，也就是自己打包应用。</p><p>在之前我们讲容器的时候，曾经说过容器就是“小板房”，镜像就是“样板间”。那么，要造出这个“样板间”，就必然要有一个“施工图纸”，由它来规定如何建造地基、铺设水电、开窗搭门等动作。这个“施工图纸”就是“<strong>Dockerfile</strong>”。</p><p>比起容器、镜像来说，Dockerfile非常普通，它就是一个纯文本，里面记录了一系列的构建指令，比如选择基础镜像、拷贝文件、运行脚本等等，每个指令都会生成一个Layer，而Docker顺序执行这个文件里的所有步骤，最后就会创建出一个新的镜像出来。</p><p>我们来看一个最简单的Dockerfile实例：</p><pre><code class=\"language-plain\"># Dockerfile.busybox\nFROM busybox                  # 选择基础镜像\nCMD echo \"hello world\"        # 启动容器时默认运行的命令\n</code></pre><p>这个文件里只有两条指令。</p><p>第一条指令是 <code>FROM</code>，所有的Dockerfile都要从它开始，表示选择构建使用的基础镜像，相当于“打地基”，这里我们使用的是busybox。</p><p>第二条指令是 <code>CMD</code>，它指定 <code>docker run</code> 启动容器时默认运行的命令，这里我们使用了echo命令，输出“hello world”字符串。</p><p>现在有了Dockerfile这张“施工图纸”，我们就可以请出“施工队”了，用 <code>docker build</code> 命令来创建出镜像：</p><pre><code class=\"language-plain\">docker build -f Dockerfile.busybox .\n\nSending build context to Docker daemon&nbsp; &nbsp;7.68kB\nStep 1/2 : FROM busybox\n&nbsp;---&gt; d38589532d97\nStep 2/2 : CMD echo \"hello world\"\n&nbsp;---&gt; Running in c5a762edd1c8\nRemoving intermediate container c5a762edd1c8\n&nbsp;---&gt; b61882f42db7\nSuccessfully built b61882f42db7\n</code></pre><p>你需要特别注意命令的格式，用 <code>-f</code> 参数指定Dockerfile文件名，后面必须跟一个文件路径，叫做“<strong>构建上下文</strong>”（build’s context），这里只是一个简单的点号，表示当前路径的意思。</p><p>接下来，你就会看到Docker会逐行地读取并执行Dockerfile里的指令，依次创建镜像层，再生成完整的镜像。</p><p>新的镜像暂时还没有名字（用 <code>docker images</code> 会看到是 <code>&lt;none&gt;</code>），但我们可以直接使用“IMAGE ID”来查看或者运行：</p><pre><code class=\"language-plain\">docker inspect b61\ndocker run b61\n</code></pre><h2>怎样编写正确、高效的Dockerfile</h2><p>大概了解了Dockerfile之后，我再来讲讲编写Dockerfile的一些常用指令和最佳实践，帮你在今后的工作中把它写好、用好。</p><p>首先因为构建镜像的第一条指令必须是 <code>FROM</code>，所以基础镜像的选择非常关键。如果关注的是镜像的安全和大小，那么一般会选择Alpine；如果关注的是应用的运行稳定性，那么可能会选择Ubuntu、Debian、CentOS。</p><pre><code class=\"language-plain\">FROM alpine:3.15                # 选择Alpine镜像\nFROM ubuntu:bionic              # 选择Ubuntu镜像\n</code></pre><p>我们在本机上开发测试时会产生一些源码、配置等文件，需要打包进镜像里，这时可以使用 <code>COPY</code> 命令，它的用法和Linux的cp差不多，不过拷贝的源文件必须是“<strong>构建上下文</strong>”路径里的，不能随意指定文件。也就是说，如果要从本机向镜像拷贝文件，就必须把这些文件放到一个专门的目录，然后在 <code>docker build</code> 里指定“构建上下文”到这个目录才行。</p><p>这里有两个 <code>COPY</code> 命令示例，你可以看一下：</p><pre><code class=\"language-plain\">COPY ./a.txt  /tmp/a.txt    # 把构建上下文里的a.txt拷贝到镜像的/tmp目录\nCOPY /etc/hosts  /tmp       # 错误！不能使用构建上下文之外的文件\n</code></pre><p>接下来要说的就是Dockerfile里最重要的一个指令 <code>RUN</code> ，它可以执行任意的Shell命令，比如更新系统、安装应用、下载文件、创建目录、编译程序等等，实现任意的镜像构建步骤，非常灵活。</p><p><code>RUN</code> 通常会是Dockerfile里最复杂的指令，会包含很多的Shell命令，但Dockerfile里一条指令只能是一行，所以有的 <code>RUN</code> 指令会在每行的末尾使用续行符 <code>\\</code>，命令之间也会用 <code>&amp;&amp;</code> 来连接，这样保证在逻辑上是一行，就像下面这样：</p><pre><code class=\"language-plain\">RUN apt-get update \\\n&nbsp; &nbsp; &amp;&amp; apt-get install -y \\\n&nbsp; &nbsp; &nbsp; &nbsp; build-essential \\\n&nbsp; &nbsp; &nbsp; &nbsp; curl \\\n&nbsp; &nbsp; &nbsp; &nbsp; make \\\n&nbsp; &nbsp; &nbsp; &nbsp; unzip \\\n&nbsp; &nbsp; &amp;&amp; cd /tmp \\\n&nbsp; &nbsp; &amp;&amp; curl -fSL xxx.tar.gz -o xxx.tar.gz\\\n&nbsp; &nbsp; &amp;&amp; tar xzf xxx.tar.gz \\\n&nbsp; &nbsp; &amp;&amp; cd xxx \\\n&nbsp; &nbsp; &amp;&amp; ./config \\\n&nbsp; &nbsp; &amp;&amp; make \\\n    &amp;&amp; make clean\n</code></pre><p>有的时候在Dockerfile里写这种超长的 <code>RUN</code> 指令很不美观，而且一旦写错了，每次调试都要重新构建也很麻烦，所以你可以采用一种变通的技巧：<strong>把这些Shell命令集中到一个脚本文件里，用 <code>COPY</code> 命令拷贝进去再用 <code>RUN</code> 来执行</strong>：</p><pre><code class=\"language-plain\">COPY setup.sh  /tmp/                # 拷贝脚本到/tmp目录\n\nRUN cd /tmp &amp;&amp; chmod +x setup.sh \\  # 添加执行权限\n    &amp;&amp; ./setup.sh &amp;&amp; rm setup.sh    # 运行脚本然后再删除\n</code></pre><p><code>RUN</code> 指令实际上就是Shell编程，如果你对它有所了解，就应该知道它有变量的概念，可以实现参数化运行，这在Dockerfile里也可以做到，需要使用两个指令 <code>ARG</code> 和<code> ENV</code>。</p><p><strong>它们区别在于 <code>ARG</code> 创建的变量只在镜像构建过程中可见，容器运行时不可见，而 <code>ENV</code> 创建的变量不仅能够在构建镜像的过程中使用，在容器运行时也能够以环境变量的形式被应用程序使用。</strong></p><p>下面是一个简单的例子，使用 <code>ARG</code> 定义了基础镜像的名字（可以用在“FROM”指令里），使用 <code>ENV</code> 定义了两个环境变量：</p><pre><code class=\"language-plain\">ARG IMAGE_BASE=\"node\"\nARG IMAGE_TAG=\"alpine\"\n\nENV PATH=$PATH:/tmp\nENV DEBUG=OFF\n</code></pre><p>还有一个重要的指令是 <code>EXPOSE</code>，它用来声明容器对外服务的端口号，对现在基于Node.js、Tomcat、Nginx、Go等开发的微服务系统来说非常有用：</p><pre><code class=\"language-plain\">EXPOSE 443           # 默认是tcp协议\nEXPOSE 53/udp        # 可以指定udp协议\n</code></pre><p>讲了这些Dockerfile指令之后，我还要特别强调一下，因为每个指令都会生成一个镜像层，所以Dockerfile里最好不要滥用指令，尽量精简合并，否则太多的层会导致镜像臃肿不堪。</p><h2>docker build是怎么工作的</h2><p>Dockerfile必须要经过 <code>docker build</code> 才能生效，所以我们再来看看 <code>docker build</code> 的详细用法。</p><p>刚才在构建镜像的时候，你是否对“构建上下文”这个词感到有些困惑呢？它到底是什么含义呢？</p><p>我觉得用Docker的官方架构图来理解会比较清楚（注意图中与“docker build”关联的虚线）。</p><p>因为命令行“docker”是一个简单的客户端，真正的镜像构建工作是由服务器端的“Docker daemon”来完成的，所以“docker”客户端就只能把“构建上下文”目录打包上传（显示信息 <code>Sending build context to Docker daemon</code> ），这样服务器才能够获取本地的这些文件。</p><p><img src=\"https://static001.geekbang.org/resource/image/c8/fe/c8116066bdbf295a7c9fc25b87755dfe.jpg?wh=1920x1048\" alt=\"图片\"></p><p>明白了这一点，你就会知道，“构建上下文”其实与Dockerfile并没有直接的关系，它其实指定了要打包进镜像的一些依赖文件。而 <code>COPY</code> 命令也只能使用基于“构建上下文”的相对路径，因为“Docker daemon”看不到本地环境，只能看到打包上传的那些文件。</p><p>但这个机制也会导致一些麻烦，如果目录里有的文件（例如readme/.git/.svn等）不需要拷贝进镜像，docker也会一股脑地打包上传，效率很低。</p><p>为了避免这种问题，你可以在“构建上下文”目录里再建立一个 <code>.dockerignore</code> 文件，语法与 <code>.gitignore</code> 类似，排除那些不需要的文件。</p><p>下面是一个简单的示例，表示不打包上传后缀是“swp”“sh”的文件：</p><pre><code class=\"language-plain\"># docker ignore\n*.swp\n*.sh\n</code></pre><p>另外关于Dockerfile，一般应该在命令行里使用 <code>-f</code> 来显式指定。但如果省略这个参数，<code>docker build</code> 就会在当前目录下找名字是 <code>Dockerfile</code> 的文件。所以，如果只有一个构建目标的话，文件直接叫“Dockerfile”是最省事的。</p><p>现在我们使用 <code>docker build</code> 应该就没什么难点了，不过构建出来的镜像只有“IMAGE ID”没有名字，不是很方便。</p><p>为此你可以加上一个 <code>-t</code> 参数，也就是指定镜像的标签（tag），这样Docker就会在构建完成后自动给镜像添加名字。当然，名字必须要符合上节课里的命名规范，用 <code>:</code> 分隔名字和标签，如果不提供标签默认就是“latest”。</p><h2>小结</h2><p>好了，今天我们一起学习了容器镜像的内部结构，重点理解<strong>容器镜像是由多个只读的Layer构成的，同一个Layer可以被不同的镜像共享</strong>，减少了存储和传输的成本。</p><p>如何编写Dockerfile内容稍微多一点，我再简单做个小结：</p><ol>\n<li>创建镜像需要编写Dockerfile，写清楚创建镜像的步骤，每个指令都会生成一个Layer。</li>\n<li>Dockerfile里，第一个指令必须是 <code>FROM</code>，用来选择基础镜像，常用的有Alpine、Ubuntu等。其他常用的指令有：<code>COPY</code>、<code>RUN</code>、<code>EXPOSE</code>，分别是拷贝文件，运行Shell命令，声明服务端口号。</li>\n<li><code>docker build</code> 需要用 <code>-f</code> 来指定Dockerfile，如果不指定就使用当前目录下名字是“Dockerfile”的文件。</li>\n<li><code>docker build</code> 需要指定“构建上下文”，其中的文件会打包上传到Docker daemon，所以尽量不要在“构建上下文”中存放多余的文件。</li>\n<li>创建镜像的时候应当尽量使用 <code>-t</code> 参数，为镜像起一个有意义的名字，方便管理。</li>\n</ol><p>今天讲了不少，但关于创建镜像还有很多高级技巧等待你去探索，比如使用缓存、多阶段构建等等，你可以再参考Docker官方文档（<a href=\"https://docs.docker.com/engine/reference/builder/\">https://docs.docker.com/engine/reference/builder/</a>），或者一些知名应用的镜像（如Nginx、Redis、Node.js等）进一步学习。</p><h2>课下作业</h2><p>最后是课下作业时间，这里有一个完整的Dockerfile示例，你可以尝试着去解释一下它的含义，然后再自己构建一下：</p><pre><code class=\"language-plain\"># Dockerfile\n# docker build -t ngx-app .\n# docker build -t ngx-app:1.0 .\n\nARG IMAGE_BASE=\"nginx\"\nARG IMAGE_TAG=\"1.21-alpine\"\n\nFROM ${IMAGE_BASE}:${IMAGE_TAG}\n\nCOPY ./default.conf /etc/nginx/conf.d/\n\nRUN cd /usr/share/nginx/html \\\n&nbsp; &nbsp; &amp;&amp; echo \"hello nginx\" &gt; a.txt\n\nEXPOSE 8081 8082 8083\n</code></pre><p>当然还有两个思考题：</p><ol>\n<li>镜像里的层都是只读不可修改的，但容器运行的时候经常会写入数据，这个冲突应该怎么解决呢？（答案在本期找）</li>\n<li>你能再列举一下镜像的分层结构带来了哪些好处吗？</li>\n</ol><p>欢迎积极留言。如果你觉得有收获，也欢迎分享给身边的朋友同事一起讨论学习。</p><p><img src=\"https://static001.geekbang.org/resource/image/17/24/1705133103a8aaf6c7fed770afa6dc24.jpg?wh=1920x2805\" alt=\"\"></p>","comments":[{"had_liked":false,"id":349988,"user_name":"includestdio.h","can_delete":false,"product_type":"c1","uid":2314854,"ip_address":"","ucode":"5027BACE9319CD","user_header":"https://static001.geekbang.org/account/avatar/00/23/52/66/3e4d4846.jpg","comment_is_top":false,"comment_ctime":1656491186,"is_pvip":true,"replies":[{"id":127374,"content":"many thanks。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1656546001,"ip_address":"","comment_id":349988,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"关于指令生成层的问题需要再补充哈：只有 RUN, COPY, ADD 会生成新的镜像层，其它指令只会产生临时层，不影响构建大小，官网的镜像构建最佳实践里面有提及\n\nhttps:&#47;&#47;docs.docker.com&#47;develop&#47;develop-images&#47;dockerfile_best-practices&#47;\nOnly the instructions RUN, COPY, ADD create layers. Other instructions create temporary intermediate images, and do not increase the size of the build.","like_count":78,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578143,"discussion_content":"many thanks。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656546001,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2608728,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ce/58/71ed845f.jpg","nickname":"Dexter","note":"","ucode":"909CABC4AC4AC9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579662,"discussion_content":"确定不是buildkit的功能？一直记得是每个指令都会产生一层","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657604950,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":349994,"user_name":"陈卧虫","can_delete":false,"product_type":"c1","uid":1481979,"ip_address":"","ucode":"44BB84712436AB","user_header":"https://static001.geekbang.org/account/avatar/00/16/9c/fb/7fe6df5b.jpg","comment_is_top":false,"comment_ctime":1656493976,"is_pvip":false,"replies":[{"id":127373,"content":"great","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1656545972,"ip_address":"","comment_id":349994,"utype":1}],"discussion_count":1,"race_medal":5,"score":2,"product_id":100114501,"comment_content":"1. 创建和修改文件：通过在写时复制实现；删除文件：通过白障实现，也就是通过一个文件记录已经被删除的文件。\n2. 镜像分层的好处：可以重复使用未被改动的layer，每次修改打包镜像，只需重新构建被改动的部分","like_count":19,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578142,"discussion_content":"great","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656545972,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":349938,"user_name":"风飘，吾独思","can_delete":false,"product_type":"c1","uid":1131032,"ip_address":"","ucode":"4DF0E7DC22EE53","user_header":"https://static001.geekbang.org/account/avatar/00/11/42/18/edc1b373.jpg","comment_is_top":false,"comment_ctime":1656464637,"is_pvip":false,"replies":[{"id":127360,"content":"great","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1656471874,"ip_address":"","comment_id":349938,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"1.容器最上一层是读写层，镜像所有的层是只读层。容器启动后，Docker daemon会在容器的镜像上添加一个读写层。\n2.容器分层可以共享资源，节约空间，相同的内容只需要加载一份份到内存。","like_count":18,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578016,"discussion_content":"great","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656471874,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":351871,"user_name":"hiDaLao","can_delete":false,"product_type":"c1","uid":2917100,"ip_address":"","ucode":"3C2DC2A3A377E4","user_header":"https://static001.geekbang.org/account/avatar/00/2c/82/ec/99b480e8.jpg","comment_is_top":false,"comment_ctime":1658244413,"is_pvip":false,"replies":[{"id":127954,"content":"docker pull的layer是压缩数据的sha256，docker inspect是解压后数据的sha256。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1658282463,"ip_address":"","comment_id":351871,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"请问下docker pull时输出的layer的值为什么和docker inspect里面layer信息的sha256的值不一样呢？","like_count":13,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580596,"discussion_content":"docker pull的layer是压缩数据的sha256，docker inspect是解压后数据的sha256。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658282463,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":350047,"user_name":"CK","can_delete":false,"product_type":"c1","uid":2005775,"ip_address":"","ucode":"F91C280D773738","user_header":"https://static001.geekbang.org/account/avatar/00/1e/9b/0f/ef415e32.jpg","comment_is_top":false,"comment_ctime":1656520091,"is_pvip":false,"replies":[{"id":127384,"content":"“上下文”这个词确实很难理解，最好直接用英文context，就是要打包进镜像的文件所在的目录。\n\n如果copy时在这个目录里找不到文件，当然就会报错了。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1656557722,"ip_address":"","comment_id":350047,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"还是没太理解构建上下文的意思，是指docker build的时候指定路径？比如文中示例docker build -f Dockerfile.busybox .  是一个.表示，我执行文末的课下作业时，显示COPY failed: file not found in build context or excluded by .dockerignore: stat default.conf: file does not exist，是不是docker build时的路径没指定好呢\n","like_count":9,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578184,"discussion_content":"“上下文”这个词确实很难理解，最好直接用英文context，就是要打包进镜像的文件所在的目录。\n\n如果copy时在这个目录里找不到文件，当然就会报错了。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1656557722,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3953407,"avatar":"","nickname":"Geek_3aef82","note":"","ucode":"924CBC3865F4FB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":650220,"discussion_content":"可以自己把这个文件touch出来，放到build命令里，就可以了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1724579249,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":350042,"user_name":"奕","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1656514988,"is_pvip":false,"replies":[{"id":127379,"content":"看小贴士应该就能够理解它们两个的区别了，ENTRYPOINT是执行的命令， CMD是参数。\n\n感觉这应该是docker当初的设计小失误，其实用哪个没有什么太严格的区分。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1656546226,"ip_address":"","comment_id":350042,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"ENTRYPOINT 和 CMD 的本质区别是什么的？ 什么时候用 ENTRYPOINT 什么时候用 CMD？","like_count":9,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578149,"discussion_content":"看小贴士应该就能够理解它们两个的区别了，ENTRYPOINT是执行的命令， CMD是参数。\n\n感觉这应该是docker当初的设计小失误，其实用哪个没有什么太严格的区分。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656546226,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2935759,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/cb/cf/fc97de76.jpg","nickname":"Geektimer","note":"","ucode":"13746813BA173A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590626,"discussion_content":"一个可以被外部覆盖，一个不可以(CMD)","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1665931944,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1888300,"avatar":"","nickname":"MS-Click","note":"","ucode":"3D409E43FDBC32","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2935759,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/cb/cf/fc97de76.jpg","nickname":"Geektimer","note":"","ucode":"13746813BA173A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":654260,"discussion_content":"你是不是说反了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1732260776,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":590626,"ip_address":"上海","group_id":0},"score":654260,"extra":""}]}]},{"had_liked":false,"id":358586,"user_name":"Geek_666217","can_delete":false,"product_type":"c1","uid":2750205,"ip_address":"北京","ucode":"46E70539D34E32","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL6RvdCzKZCGibZqanPxlib453uP5oXvMTjR6uJsjfMZsib5ShMicDdgBUr6yHSibSKSKgiazqR6tNibDibibQ/132","comment_is_top":false,"comment_ctime":1664444331,"is_pvip":false,"replies":[{"id":130453,"content":"是的，Dockerfile的注释比较特殊，必须的单独一行，不能在行尾。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1664459606,"ip_address":"北京","comment_id":358586,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"构建包如果出错了，注意注释和内容不要再同一行，会将注释视为参数\n","like_count":8,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589160,"discussion_content":"是的，Dockerfile的注释比较特殊，必须的单独一行，不能在行尾。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1664459606,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":357588,"user_name":"Geek_f20da9","can_delete":false,"product_type":"c1","uid":3181095,"ip_address":"北京","ucode":"8D8F0F0A3527BE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er3Ey0Uq2w4wLhVNGGReZKLd06PCDU4ZeefZWFMNvf3LibtibDqzBBpzkYW5n5AkYuJGPa4KEdQ5qgA/132","comment_is_top":false,"comment_ctime":1663427770,"is_pvip":false,"replies":[{"id":130169,"content":"写的很好。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1663556908,"ip_address":"北京","comment_id":357588,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"老师有时间帮忙看一下，不知道写的对不对。\n\ndockerfile常用参数：\n1.ARG：镜像层的环境变量\n2.FROM：拉取基础镜像\n3.COPY:拷贝文件\n4.ADD：拷贝文件、URL、压缩文件等\n5.EVN：镜像层和容器层参数\n6.EXPOSE:暴露容器内部端口给外部使用\n7.RUN：执行shell指令\n8.CMD：构建完成时执行的指令\n\n思考题：\n1.docker采用UNION FS文件系统，将文件系统分为上层和下层。即上层为容器层，下层为镜像层。如果下层有修改，运行容器时，上层会同步修改。如果上层有数据修改（即容器层数据修改），不会影响到下层（即镜像层）。\n2.好处：共享已存在的layer，如果有新的数据加入，只会增量在最上层新增layer层。减少了网络传输等一些成本。","like_count":6,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588103,"discussion_content":"写的很好。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663556909,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1581878,"avatar":"https://static001.geekbang.org/account/avatar/00/18/23/36/8bc95dca.jpg","nickname":"Lee","note":"","ucode":"5A232B7388EB2C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612129,"discussion_content":"第5行 ENV","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1680525404,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"中国香港","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":374694,"user_name":"每天晒白牙","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"北京","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1684317416,"is_pvip":false,"replies":[{"id":136743,"content":"awesome，不过chatGPT使用也要适度，当心它一本正经地胡说八道。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1684393906,"ip_address":"上海","comment_id":374694,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"chatgpt的回答\n1.容器运行时需要写入数据，但是Docker镜像的分层技术是只读的，这会导致冲突。为了解决这个问题，Docker采用了一种称为“容器层”的技术，用于在镜像的基础上创建一个可写的文件系统层，用于存储容器中的数据和修改。\n\n具体来说，当创建一个新的Docker容器时，Docker会在镜像的基础上创建一个可写的文件系统层，称为“容器层”，用于存储容器中的数据和修改。容器层会覆盖镜像中相应的文件系统层，从而实现容器的个性化定制和隔离。\n\n容器层是可写的，因此容器运行时可以向其中写入数据和修改文件。这些修改都是存储在容器层中的，而不会影响到镜像中的文件系统层。这样可以保证镜像的不变性和可重复性，从而方便镜像的管理和使用。\n\n需要注意的是，容器层是临时的，当容器被删除时，容器层也会被删除。因此，容器层中存储的数据和修改都是临时的，不会对镜像产生影响。如果需要将容器中的数据持久化保存，可以使用Docker的数据卷或者绑定挂载等技术\n\n2.镜像的分层结构带来了以下好处：\n\n减小镜像的大小：镜像的分层结构可以将镜像拆分成多个只读的文件系统层，这些层可以共用相同的Layer，从而减小镜像的大小，提高镜像的构建和传输效率。\n\n提高镜像的可重复性：镜像的分层结构可以保证镜像的不变性和可重复性，因为每个文件系统层都是只读的，不会被修改。这样可以方便镜像的管理和使用。\n\n方便镜像的定制和扩展：镜像的分层结构可以方便镜像的定制和扩展，因为可以在镜像的基础上创建一个可写的容器层，用于存储容器中的数据和修改。这样可以实现容器的个性化定制和隔离。\n\n提高镜像的安全性：镜像的分层结构可以提高镜像的安全性，因为每个文件系统层都是只读的，不会被修改。这样可以避免恶意软件或攻击者修改镜像中的文件，从而提高镜像的安全性。\n\n方便镜像的共享和复用：镜像的分层结构可以方便镜像的共享和复用，因为可以将多个镜像共用相同的Layer，从而减小镜像的大小，提高镜像的构建和传输效率。这样可以方便镜像的共享和复用，提高镜像的可用性和可维护性。","like_count":5,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":618619,"discussion_content":"awesome，不过chatGPT使用也要适度，当心它一本正经地胡说八道。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1684393906,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":370137,"user_name":"虢國技醬","can_delete":false,"product_type":"c1","uid":1056807,"ip_address":"广东","ucode":"5A192262AA037E","user_header":"https://static001.geekbang.org/account/avatar/00/10/20/27/a6932fbe.jpg","comment_is_top":false,"comment_ctime":1678422265,"is_pvip":false,"replies":[{"id":134935,"content":"great","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1678495025,"ip_address":"北京","comment_id":370137,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"&quot;Dockerfile 里，第一个指令必须是 FROM，用来选择基础镜像&quot;\n\n一直有个疑问，写Dockerfile都必须有个基础镜像，那么依赖的这些基础镜像 的最原始镜像是怎么制作的？\n\n这里研究了一下文档，同步给大家：\n\nhttps:&#47;&#47;docs.docker.com&#47;build&#47;building&#47;base-images&#47;#create-a-simple-parent-image-using-scratch\n\n两个方式：\n\n1、Create a full image using tar\n\n2、Create a simple parent image using scratch\n\n特别是 scratch 这个：\n\nYou can use Docker’s reserved, minimal image, scratch, as a starting point for building containers. Using the scratch “image” signals to the build process that you want the next command in the Dockerfile to be the first filesystem layer in your image.\n\nWhile scratch appears in Docker’s repository on the hub, you can’t pull it, run it, or tag any image with the name scratch. Instead, you can refer to it in your Dockerfile.","like_count":4,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":608525,"discussion_content":"great","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678495025,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356100,"user_name":"jone","can_delete":false,"product_type":"c1","uid":1318619,"ip_address":"北京","ucode":"00D0C54BE1005C","user_header":"https://static001.geekbang.org/account/avatar/00/14/1e/db/921367d6.jpg","comment_is_top":false,"comment_ctime":1661963797,"is_pvip":false,"replies":[{"id":129626,"content":"这个要看镜像里是什么了，如果是Nginx、Redis这样的会自动在后台运行，如果是shell脚本那么启动后会立即结束。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1661997331,"ip_address":"北京","comment_id":356100,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"【课下作业】 ，用docker build打好镜像后，即使使用-d，也是会自动退出。如果想要看容器里面刚刚copy和生成的a.txt文件，只能采用： docker run -it ngx-app:1.0 sh ，这样就进入到容器里面了，当然exits之后，就会退出容器了。  老师，这个要怎么理解呢。即使用了-d，也是一次性执行容器。","like_count":4,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586125,"discussion_content":"这个要看镜像里是什么了，如果是Nginx、Redis这样的会自动在后台运行，如果是shell脚本那么启动后会立即结束。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661997331,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":377248,"user_name":"芋头","can_delete":false,"product_type":"c1","uid":1070287,"ip_address":"广东","ucode":"390438CFF71F0A","user_header":"https://static001.geekbang.org/account/avatar/00/10/54/cf/fddcf843.jpg","comment_is_top":false,"comment_ctime":1688135601,"is_pvip":false,"replies":[{"id":137496,"content":"有一个scratch的空白镜像，可以用这个构建其他的基础镜像。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1688343829,"ip_address":"北京","comment_id":377248,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"老师，课程里面讲的是编写一个docker file，那dockerfile中 FROM的镜像是怎么生成的呢","like_count":3,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":622488,"discussion_content":"有一个scratch的空白镜像，可以用这个构建其他的基础镜像。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1688343829,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353369,"user_name":"rongyefeng","can_delete":false,"product_type":"c1","uid":1959482,"ip_address":"北京","ucode":"9A15D947E9D645","user_header":"https://static001.geekbang.org/account/avatar/00/1d/e6/3a/382cf024.jpg","comment_is_top":false,"comment_ctime":1659406904,"is_pvip":false,"replies":[{"id":128479,"content":"其实不需要太明白，因为我们的目的是学习Kubernetes，容器只要知道个大概就行，等熟悉了Kubernetes再回头看容器可能会更容易理解。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1659425809,"ip_address":"北京","comment_id":353369,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"说实话，容器的内部结构讲解还是没看太明白","like_count":2,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582409,"discussion_content":"其实不需要太明白，因为我们的目的是学习Kubernetes，容器只要知道个大概就行，等熟悉了Kubernetes再回头看容器可能会更容易理解。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659425809,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":349947,"user_name":"萝卜头王","can_delete":false,"product_type":"c1","uid":1008716,"ip_address":"","ucode":"A8DEB35A48E651","user_header":"https://static001.geekbang.org/account/avatar/00/0f/64/4c/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1656468269,"is_pvip":false,"replies":[{"id":127361,"content":"是的，Dockerfile的注释必须是#开头，在文档里只是示意性质的说明。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1656472159,"ip_address":"","comment_id":349947,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"文章中的dockerfile里面的注释信息(以#开头的内容)，是不是应该放在单独的一行？","like_count":2,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578018,"discussion_content":"是的，Dockerfile的注释必须是#开头，在文档里只是示意性质的说明。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656472159,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":369824,"user_name":"jingtong","can_delete":false,"product_type":"c1","uid":3556309,"ip_address":"湖北","ucode":"03BA5DA52A09C7","user_header":"","comment_is_top":false,"comment_ctime":1678006332,"is_pvip":false,"replies":[{"id":134812,"content":"docker的运行原理就是共享内核，mac上的Linux是在虚拟机里，用的还是Linux内核。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1678057029,"ip_address":"北京","comment_id":369824,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"虽然这些文件里不包含系统内核（因为容器共享了宿主机的内核），但如果每个镜像都重复做这样的打包操作，仍然会导致大量的冗余。\n\n-----\n\n共享宿主机内核这里如果是Mac上面跑Linux，这个没法共享内核吧，包括不同版本的内核也没法共享？","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":607636,"discussion_content":"docker的运行原理就是共享内核，mac上的Linux是在虚拟机里，用的还是Linux内核。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678057029,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":3556309,"avatar":"","nickname":"jingtong","note":"","ucode":"03BA5DA52A09C7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":608448,"discussion_content":"低版本内核的Linux，在上面运行高版本内核的Linux，这种场景呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678443062,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":607636,"ip_address":"广东","group_id":0},"score":608448,"extra":""}]}]},{"had_liked":false,"id":352255,"user_name":"YueShi","can_delete":false,"product_type":"c1","uid":1625530,"ip_address":"","ucode":"8F7AFAE4641A7D","user_header":"https://static001.geekbang.org/account/avatar/00/18/cd/ba/3a348f2d.jpg","comment_is_top":false,"comment_ctime":1658483020,"is_pvip":true,"replies":[{"id":128141,"content":"\n1.不可以，因为context会被打包发送给daemon，它就是根。\n\n2.这个就是docker的build cache，可以再查相关的资料。\n\n3.是的，默认就是docker hub的library名字，后面会讲。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1658486356,"ip_address":"","comment_id":352255,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"1: 构建上下文使用相对路径，是不是当前就是顶层，限制通过 ..&#47; 的方式去到构建上下文的上一层\n\n2. run的指令会生成新的一层，但是如果 【run之前的指令不一样，例如from】【run里面的东西太多】，是不是大部分run生成的这一层都不能重用呢？这一块比较好奇\n\n3. build后的名字为  =&gt; =&gt; naming to docker.io&#47;library&#47;homework。      前面的这个docker.Io&#47;library 这个是默认的吗？","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":581078,"discussion_content":"\n1.不可以，因为context会被打包发送给daemon，它就是根。\n\n2.这个就是docker的build cache，可以再查相关的资料。\n\n3.是的，默认就是docker hub的library名字，后面会讲。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1658486356,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1625530,"avatar":"https://static001.geekbang.org/account/avatar/00/18/cd/ba/3a348f2d.jpg","nickname":"YueShi","note":"","ucode":"8F7AFAE4641A7D","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":581079,"discussion_content":"感谢罗老师解惑👍👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658486420,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":581078,"ip_address":"","group_id":0},"score":581079,"extra":""}]}]},{"had_liked":false,"id":350786,"user_name":"自由","can_delete":false,"product_type":"c1","uid":2576960,"ip_address":"","ucode":"4E3B53D29D86CA","user_header":"https://static001.geekbang.org/account/avatar/00/27/52/40/db9b0eb2.jpg","comment_is_top":false,"comment_ctime":1657192445,"is_pvip":false,"replies":[{"id":127636,"content":"\n1.镜像会包含基础镜像里的层。\n\n2.具体层数是如何计算的可能得深入去看docker的内部了，我觉得暂时可以不关心，把docker、Kubernetes都学完了，有必要再深究。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1657250322,"ip_address":"","comment_id":350786,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"罗老师，我练习了结尾的作业，有一个问题。为什么构建出来的 ngx-app ，通过 docker inspect xxx 查看，它的 Layers 有 8 层呢？在我看来 Dockerfile 只有 7 个命令。还有一个问题，FROM 是否会构建一个层？如果会，为什么之前的 docker build -f Dockerfile.busybox . 的 image 产物通过 docker inspect 查看只有一层 Layer 呢？","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579211,"discussion_content":"\n1.镜像会包含基础镜像里的层。\n\n2.具体层数是如何计算的可能得深入去看docker的内部了，我觉得暂时可以不关心，把docker、Kubernetes都学完了，有必要再深究。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657250322,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2576960,"avatar":"https://static001.geekbang.org/account/avatar/00/27/52/40/db9b0eb2.jpg","nickname":"自由","note":"","ucode":"4E3B53D29D86CA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":579660,"discussion_content":"谢谢罗老师回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657602268,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":579211,"ip_address":"","group_id":0},"score":579660,"extra":""}]}]},{"had_liked":false,"id":350363,"user_name":"九暮","can_delete":false,"product_type":"c1","uid":3034677,"ip_address":"","ucode":"85DEB728BF6097","user_header":"https://static001.geekbang.org/account/avatar/00/2e/4e/35/d5d1aec8.jpg","comment_is_top":false,"comment_ctime":1656847341,"is_pvip":false,"replies":[{"id":127441,"content":"肯定是有的，Dockerfile里的指令在build的时候就生成在镜像里了，看看目录对不对。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1656896205,"ip_address":"","comment_id":350363,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"RUN cd &#47;usr&#47;share&#47;nginx&#47;html \\    &amp;&amp; echo &quot;hello nginx&quot; &gt; a.txt\n老师，这句话在容器执行，我进入到容器内部结果没有保存下来呢，没有这个文件\n","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578547,"discussion_content":"肯定是有的，Dockerfile里的指令在build的时候就生成在镜像里了，看看目录对不对。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656896206,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":350158,"user_name":"今天你学习了吗？","can_delete":false,"product_type":"c1","uid":1489002,"ip_address":"","ucode":"1CACF4492D7843","user_header":"https://static001.geekbang.org/account/avatar/00/16/b8/6a/d37ed9ab.jpg","comment_is_top":false,"comment_ctime":1656605686,"is_pvip":false,"replies":[{"id":127399,"content":"正文里没有写，其实这个也不是需要特别了解的知识点，不影响我们的使用。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1656644641,"ip_address":"","comment_id":350158,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"没看到说cow的方法呀，这个从哪说到了呢\n","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578295,"discussion_content":"正文里没有写，其实这个也不是需要特别了解的知识点，不影响我们的使用。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656644642,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1625530,"avatar":"https://static001.geekbang.org/account/avatar/00/18/cd/ba/3a348f2d.jpg","nickname":"YueShi","note":"","ucode":"8F7AFAE4641A7D","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":581067,"discussion_content":"没说到，但是那个图可以看出来","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1658482608,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":350144,"user_name":"朱雯","can_delete":false,"product_type":"c1","uid":1035744,"ip_address":"","ucode":"064C45FBF6B51F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/cd/e0/c85bb948.jpg","comment_is_top":false,"comment_ctime":1656597408,"is_pvip":false,"replies":[{"id":127404,"content":"当然了，每个层都会有一点空间占用，积累多了镜像就会越来越大。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1656644867,"ip_address":"","comment_id":350144,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"老师有个问题 层数多少会影响镜像总大小吗 还是不影响 ","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578303,"discussion_content":"当然了，每个层都会有一点空间占用，积累多了镜像就会越来越大。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656644867,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1035744,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/cd/e0/c85bb948.jpg","nickname":"朱雯","note":"","ucode":"064C45FBF6B51F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":578526,"discussion_content":"老师我的意思是 同样的安装，但使用不同的层数 她们的大小有区别吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656856639,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":578303,"ip_address":"","group_id":0},"score":578526,"extra":""}]}]},{"had_liked":false,"id":350021,"user_name":"马以","can_delete":false,"product_type":"c1","uid":1344431,"ip_address":"","ucode":"3FEA06CA14DE28","user_header":"https://static001.geekbang.org/account/avatar/00/14/83/af/1cb42cd3.jpg","comment_is_top":false,"comment_ctime":1656508406,"is_pvip":false,"replies":[{"id":127377,"content":"awesome","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1656546080,"ip_address":"","comment_id":350021,"utype":1}],"discussion_count":2,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"1: docker在挂载镜像文件的时候除了镜像文件的只读层，还会挂载一个‘可读写层’，在容器运行是，它以copy-on-write的方式，记录容器中的“写”操作；\n2: a: 镜像分层的好处在于他可以减少制作成本，从而迅速迭代，它使得我们能以一种增量的方式对现有已经存在的镜像做改造，而不是每一次都从0开始重复制作，\n        降低了技术人员之间的操作成本；\n    b: 占用空间更下，每次拉取和推送都只操作增量的部分，省时省力；","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578147,"discussion_content":"awesome","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656546080,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1351076,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","nickname":"lesserror","note":"","ucode":"25A54D1165FCF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578233,"discussion_content":"这里的“copy-on-write”该怎么理解呢？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1656596016,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":350010,"user_name":"星垂平野阔","can_delete":false,"product_type":"c1","uid":3010581,"ip_address":"","ucode":"036EC20979D406","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/WrANpwBMr6DsGAE207QVs0YgfthMXy3MuEKJxR8icYibpGDCI1YX4DcpDq1EsTvlP8ffK1ibJDvmkX9LUU4yE8X0w/132","comment_is_top":false,"comment_ctime":1656503108,"is_pvip":false,"replies":[{"id":127376,"content":"差不多，可以再参考其他同学的回答。\n\n层数太多就会导致镜像加载效率低，所以要优化Dockerfile。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1656546068,"ip_address":"","comment_id":350010,"utype":1}],"discussion_count":3,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"作业：\n1.写的时候往上叠加一层\n2.避免重复打包\n\n课后思考：\n万一打包层数过高怎么办？","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578146,"discussion_content":"差不多，可以再参考其他同学的回答。\n\n层数太多就会导致镜像加载效率低，所以要优化Dockerfile。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656546068,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":606424,"discussion_content":"我记得好像最高时127层","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677134556,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3254520,"avatar":"","nickname":"Geek_baed16","note":"","ucode":"9D8D3A69677E23","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":601104,"discussion_content":"可以多段构建 好像 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1675062283,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":388555,"user_name":"Geek_07ead6","can_delete":false,"product_type":"c1","uid":1714992,"ip_address":"广东","ucode":"424137ADA9AA23","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoREZlw6JWh1OXYvcKhOToBPCSqVr33Vhc0gmW9jNT3JHtW7NtaiaiaNJicjjxyVia7Oec3Qq1bzLGreQ/132","comment_is_top":false,"comment_ctime":1710387681,"is_pvip":false,"replies":[{"id":141486,"content":"第二步不可能是基于CentOS的吧，在Ubuntu里添加Redis必然是Ubuntu版本的Redis。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1710586766,"ip_address":"北京","comment_id":388555,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"老师您好，创建dockerfile时都有一个基础镜像，假如我创建了一个dockerfile是基于Ubuntu的，然后里面添加进去的Redis镜像又是基于Centos的，那我这个镜像运行成容器时，里面的Redis是运行在Ubuntu环境的还是centos环境的？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":639394,"discussion_content":"第二步不可能是基于CentOS的吧，在Ubuntu里添加Redis必然是Ubuntu版本的Redis。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1710586766,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":380411,"user_name":"ZebByte","can_delete":false,"product_type":"c1","uid":3218284,"ip_address":"广东","ucode":"91EC593D45A782","user_header":"","comment_is_top":false,"comment_ctime":1693504442,"is_pvip":false,"replies":[{"id":138565,"content":"不错的比喻，good","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1693554776,"ip_address":"上海","comment_id":380411,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":" 我想养一条鱼(构建一个自定义镜像)\n 我的操作步骤(dockerfile)\n 1.上网购买养鱼套餐 (基础镜像)\n 2.从套餐里取出资源 (分配好CPU、内存、容量资源)\n 3.放好鱼缸\n 4.放水\n 5.放金鱼\t(4、5、6是自定义镜像的过程)\n 6.完成养鱼梦想 (构建好了自定义镜像)\n \n 此时，我想养些水草 (构建另外一个自定义镜像)\n 我的操作步骤(dockerfile)\n 1.上网购买养鱼套餐 (基础镜像)\n 2.从套餐里取出资源 (分配好CPU、内存、容量资源)\n 3.放好鱼缸\n 4.放水\n 5.放水草\t(4、5、6是自定义镜像的过程)\n 6.完成养水草梦想 (构建好了自定义镜像)\n \n 基于UnionFS（联合文件系统）\n docker不需要重复以上1-4步骤，可以直接在之前养鱼的鱼缸放置水草即可，节省了资源。\n \n 水草和鱼  可类比成  redis和nginx等镜像，可以这么理解吗","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":626977,"discussion_content":"不错的比喻，good","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1693554776,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":370285,"user_name":"GeekNeo","can_delete":false,"product_type":"c1","uid":1146405,"ip_address":"浙江","ucode":"1D355A9BEB8BEA","user_header":"https://static001.geekbang.org/account/avatar/00/11/7e/25/3932dafd.jpg","comment_is_top":false,"comment_ctime":1678679216,"is_pvip":false,"replies":[{"id":135033,"content":"docker build只是打包文件，它不会也无法检查内容是否正确，不过我们也可以写脚本，在run里执行校验检查。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1678701122,"ip_address":"上海","comment_id":370285,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"default.conf只要在构建的临时目录中存在就可以，不会检查这个文件内容是否真的正确对吧，是否是不是nginx的正确语法配置文件？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":608856,"discussion_content":"docker build只是打包文件，它不会也无法检查内容是否正确，不过我们也可以写脚本，在run里执行校验检查。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678701122,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":369629,"user_name":"蔡晓慧","can_delete":false,"product_type":"c1","uid":1588301,"ip_address":"北京","ucode":"8D177D2B37BD6D","user_header":"https://static001.geekbang.org/account/avatar/00/18/3c/4d/3dec4bfe.jpg","comment_is_top":false,"comment_ctime":1677739564,"is_pvip":false,"replies":[{"id":134695,"content":"great","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1677746172,"ip_address":"上海","comment_id":369629,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"Dockerfile解释\n\n1.构建一个nginx:1.21-alpine的基础镜像；\n2.拷贝配置文件到容器的&#47;etc&#47;nginx&#47;conf.d&#47;目录下；\n3.切换到&#47;usr&#47;share&#47;nginx&#47;html目录下，并生成一个a.txt文件，内容是hello nginx;\n4.暴露容器的8081，8082，8083端口；","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":607293,"discussion_content":"great","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677746173,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":367305,"user_name":"随遇而安","can_delete":false,"product_type":"c1","uid":1716709,"ip_address":"广东","ucode":"5A1222D6F16B4E","user_header":"https://static001.geekbang.org/account/avatar/00/1a/31/e5/8d45547d.jpg","comment_is_top":false,"comment_ctime":1675129361,"is_pvip":false,"replies":[{"id":133816,"content":"可以用docker inspect来查看。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1675156500,"ip_address":"上海","comment_id":367305,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"老师，您好，想问下镜像的层怎么才算一层？比如乌班图的镜像，那整个乌班图就是镜像中的一层吗？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":601244,"discussion_content":"可以用docker inspect来查看。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1675156500,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":367011,"user_name":"Geek_596972","can_delete":false,"product_type":"c1","uid":3251532,"ip_address":"广东","ucode":"1361788F8AD32F","user_header":"","comment_is_top":false,"comment_ctime":1674803394,"is_pvip":false,"replies":[{"id":133744,"content":"镜像存在磁盘上，是docker的内置目录，管理的话就要用Registry，可以看后面几节课。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1674892099,"ip_address":"北京","comment_id":367011,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"生成的镜像放哪呢，跟远程仓库又是什么关系呢","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600805,"discussion_content":"镜像存在磁盘上，是docker的内置目录，管理的话就要用Registry，可以看后面几节课。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1674892099,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":365710,"user_name":"Mr.J","can_delete":false,"product_type":"c1","uid":1267172,"ip_address":"北京","ucode":"372D8C614F6C3D","user_header":"https://static001.geekbang.org/account/avatar/00/13/55/e4/7061abd5.jpg","comment_is_top":false,"comment_ctime":1672910885,"is_pvip":false,"replies":[{"id":133203,"content":"是的，很正确。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1672966922,"ip_address":"北京","comment_id":365710,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"我理解的构建上下文是本机上一个单独的临时目录，用来存放构建镜像所需要的文件，当执行docker build的时候，所需要的文件（coyp、run等）都只会从这里找，找到之后打包给docker doamn去真正的创建出镜像，是这样吗老师","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":598621,"discussion_content":"是的，很正确。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672966922,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361354,"user_name":"snake","can_delete":false,"product_type":"c1","uid":3183263,"ip_address":"上海","ucode":"0C7398D3A68119","user_header":"https://static001.geekbang.org/account/avatar/00/30/92/9f/d5255fe8.jpg","comment_is_top":false,"comment_ctime":1667445174,"is_pvip":false,"replies":[{"id":131429,"content":"这个a.txt文件是个示例文件，可以自己生成，比如echo &#39;aaa&#39; &gt; a.txt。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1667447154,"ip_address":"上海","comment_id":361354,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"我按照课下作业的Dockerfile构建好了Nginx，但是没有找到a.txt文件，请问老师是哪里有问题吗","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592495,"discussion_content":"这个a.txt文件是个示例文件，可以自己生成，比如echo &#39;aaa&#39; &gt; a.txt。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667447155,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":357529,"user_name":"torchlight","can_delete":false,"product_type":"c1","uid":1586169,"ip_address":"北京","ucode":"1E05FD0360BEF3","user_header":"https://static001.geekbang.org/account/avatar/00/18/33/f9/658f5bd2.jpg","comment_is_top":false,"comment_ctime":1663338831,"is_pvip":false,"replies":[{"id":130146,"content":"看样子copy是成功了，在run这步出错，好像是setup.sh有问题，可以修改run里的命令，逐个试验，看具体是哪里有问题。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1663396783,"ip_address":"北京","comment_id":357529,"utype":1}],"discussion_count":2,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"\nCOPY setup.sh  &#47;tmp&#47;                # 拷贝脚本到&#47;tmp目录\n\nRUN cd &#47;tmp &amp;&amp; chmod +x setup.sh \\  # 添加执行权限\n    &amp;&amp; .&#47;setup.sh &amp;&amp; rm setup.sh    # 运行脚本然后再删除\n---------------------------------------------\n老师，想问下用docker build执行Dockerfile后，显示“docker build -f Dockerfile .\nSending build context to Docker daemon  4.096kB\nStep 1&#47;3 : FROM ubuntu:latest\n ---&gt; 2dc39ba059dc\nStep 2&#47;3 : COPY setup.sh  &#47;tmp&#47;\n ---&gt; Using cache\n ---&gt; 6c98412815b0\nStep 3&#47;3 : RUN cd &#47;tmp &amp;&amp; chmod +x setup.sh &amp;&amp; .&#47;setup.sh &amp;&amp; rm setup.sh\n ---&gt; Running in f854d51dc422\n.&#47;setup.sh: 2: RUN: not found\nThe command &#39;&#47;bin&#47;sh -c cd &#47;tmp &amp;&amp; chmod +x setup.sh &amp;&amp; .&#47;setup.sh &amp;&amp; rm setup.sh&#39; returned a non-zero code: 127”，能否指点下迷津，谢谢","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587946,"discussion_content":"看样子copy是成功了，在run这步出错，好像是setup.sh有问题，可以修改run里的命令，逐个试验，看具体是哪里有问题。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663396783,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1586169,"avatar":"https://static001.geekbang.org/account/avatar/00/18/33/f9/658f5bd2.jpg","nickname":"torchlight","note":"","ucode":"1E05FD0360BEF3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588113,"discussion_content":"最后试了把./setup.sh这个指令改成 sh setup.sh就可以了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663557930,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"湖南","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355270,"user_name":"Panda.","can_delete":false,"product_type":"c1","uid":2919755,"ip_address":"北京","ucode":"FFD5930D0D4CC5","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/G0U7VYeOiaeBoqcibZ5fzYxgmBIEGAjl7ibg9sib91s1U7Bxib3qI4qywpTNpEzEOiabnic5x5BicibdrhrSJt3ssgEm28Q/132","comment_is_top":false,"comment_ctime":1661241774,"is_pvip":false,"replies":[{"id":129276,"content":"应该是没有找到文件Dockerfile.busybox吧，看看路径是否正确。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1661300103,"ip_address":"北京","comment_id":355270,"utype":1}],"discussion_count":3,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"输入“docker build -f Dockerfile.busybox .”之后显示“unable to prepare the content ..... no such file or directory”该怎么办，在CSDN里面找不到好的解决方法","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585026,"discussion_content":"应该是没有找到文件Dockerfile.busybox吧，看看路径是否正确。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661300103,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2919755,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/G0U7VYeOiaeBoqcibZ5fzYxgmBIEGAjl7ibg9sib91s1U7Bxib3qI4qywpTNpEzEOiabnic5x5BicibdrhrSJt3ssgEm28Q/132","nickname":"Panda.","note":"","ucode":"FFD5930D0D4CC5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":585366,"discussion_content":"老师，路径不是只有一个点吗，表示当前路径，这怎么出错的啊。而且我的理解是在当前路径build一个新的file，为什么报错是说找不到呢。老师有空的话可以回复再详细一点吗，谢谢您！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661500782,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":585026,"ip_address":"广东","group_id":0},"score":585366,"extra":""}]},{"author":{"id":2863851,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/b2/eb/0e63a8db.jpg","nickname":"眸","note":"","ucode":"4181EBB38E57B7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587588,"discussion_content":"你要先创建这个Dockerfile.busybox文件","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1663158309,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":351201,"user_name":"星期一的包子","can_delete":false,"product_type":"c1","uid":2914948,"ip_address":"","ucode":"A37C5310C0EB64","user_header":"https://static001.geekbang.org/account/avatar/00/2c/7a/84/07b4c263.jpg","comment_is_top":false,"comment_ctime":1657606750,"is_pvip":false,"replies":[{"id":127749,"content":"这个不太了解了，sorry。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1657610938,"ip_address":"","comment_id":351201,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"老师提到Union FS 联合文件系统是否和云盘的原理相似啊","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579672,"discussion_content":"这个不太了解了，sorry。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657610938,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":351107,"user_name":"邮差","can_delete":false,"product_type":"c1","uid":2939706,"ip_address":"","ucode":"65ED22E1ABCF5D","user_header":"https://static001.geekbang.org/account/avatar/00/2c/db/3a/e470d9fd.jpg","comment_is_top":false,"comment_ctime":1657529270,"is_pvip":false,"replies":[{"id":127728,"content":"\n1.这个要看这个镜像的相关文档好Dockerfile，history可能不会那么详细。\n\n2.inspect应该就差不多了。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1657534362,"ip_address":"","comment_id":351107,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"罗老师，我有两个理解您看对不对。1，我pull一镜像下来后，想知道该镜像的程序安装目录、配置文件所在目录、端口等 是不是用docker history（因为比如我要映射配置文件我得知道这个镜像构建得时候放在哪里）；2，我使用docker run 运行一个容器后，我想知道这个容器得基本信息（docker run 后面得相关参数，比如端口、目录映射等）是不是通过docker inspect 容器名。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579578,"discussion_content":"\n1.这个要看这个镜像的相关文档好Dockerfile，history可能不会那么详细。\n\n2.inspect应该就差不多了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657534362,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":350743,"user_name":"pythonbug","can_delete":false,"product_type":"c1","uid":1487274,"ip_address":"","ucode":"1A70CA92FFF8EB","user_header":"https://wx.qlogo.cn/mmopen/vi_32/wgMMrp1hvSB3E30KqZvMsj3KQdAI3T1uQM77LT7hZ65nVSjPGRg3AbUOyiahnssA6AIT5PAkyHFmlTBzUH9gdyQ/132","comment_is_top":false,"comment_ctime":1657155847,"is_pvip":false,"replies":[{"id":127606,"content":"是的，看一下那张图片，在镜像的最上面，有一个可写层。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1657159741,"ip_address":"","comment_id":350743,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"1、又回去翻了翻，是不是就是那个千层糕的例子，生成一个可写的同名层，这样下层不可写的镜像就被屏蔽了。\n2、还真没想出来，看了其他同学的评论，感觉说的很好","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579058,"discussion_content":"是的，看一下那张图片，在镜像的最上面，有一个可写层。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657159741,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":350315,"user_name":"pyhhou","can_delete":false,"product_type":"c1","uid":1256496,"ip_address":"","ucode":"31EF8D50CF91A5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ibZVAmmdAibBeVpUjzwId8ibgRzNk7fkuR5pgVicB5mFSjjmt2eNadlykVLKCyGA0GxGffbhqLsHnhDRgyzxcKUhjg/132","comment_is_top":false,"comment_ctime":1656784254,"is_pvip":false,"replies":[{"id":127432,"content":"第一个路径是context目录，不是当前目录，一定要弄清楚。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1656842384,"ip_address":"","comment_id":350315,"utype":1}],"discussion_count":2,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"尝试了几次，关于 `COPY .&#47;default.conf &#47;etc&#47;nginx&#47;conf.d&#47;` 这个指令，前面的一个路径表示的当前环境，这里指定的 filepath 必须在构建目录下且真实存在，否则会报错。后面的路径表示的是镜像中的路径，这个 path 不需要在原始镜像（FROM ...）中真实存在，如果不存在，构建过程中会自动创建（区别于 Linux 中的 cp）。不知道我理解的对不对，望老师指教","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578509,"discussion_content":"第一个路径是context目录，不是当前目录，一定要弄清楚。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656842384,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1256496,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/ibZVAmmdAibBeVpUjzwId8ibgRzNk7fkuR5pgVicB5mFSjjmt2eNadlykVLKCyGA0GxGffbhqLsHnhDRgyzxcKUhjg/132","nickname":"pyhhou","note":"","ucode":"31EF8D50CF91A5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578589,"discussion_content":"了解了，context 目录是我们在 docker build 时指定的吧，比如 docker build -f Dockerfile . 就指定了当前目录为 context 目录。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656911511,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":350141,"user_name":"lesserror","can_delete":false,"product_type":"c1","uid":1351076,"ip_address":"","ucode":"25A54D1165FCF6","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","comment_is_top":false,"comment_ctime":1656596356,"is_pvip":false,"replies":[{"id":127398,"content":"思考题，没有标准答案，就是要自己思考得出结论，重要的是过程。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1656644592,"ip_address":"","comment_id":350141,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"课后的问题，如果让老师来回答，老师会怎么回呢？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578294,"discussion_content":"思考题，没有标准答案，就是要自己思考得出结论，重要的是过程。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656644593,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":350043,"user_name":"lesserror","can_delete":false,"product_type":"c1","uid":1351076,"ip_address":"","ucode":"25A54D1165FCF6","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","comment_is_top":false,"comment_ctime":1656515995,"is_pvip":false,"replies":[{"id":127372,"content":"\n1.一般翻译成清单。不过我认为这种英文术语还是不要强求中文翻译，just feel it。\n\n2.会以加餐的形式。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1656545962,"ip_address":"","comment_id":350043,"utype":1}],"discussion_count":2,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"请问老师：\n\n1. manifest 这个单词正确的中文翻译应该是什么？怎么理解这个术语的含义比较准确呢？\n\n2. docker-compose 后面会讲解到么？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578141,"discussion_content":"\n1.一般翻译成清单。不过我认为这种英文术语还是不要强求中文翻译，just feel it。\n\n2.会以加餐的形式。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1656545962,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1351076,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","nickname":"lesserror","note":"","ucode":"25A54D1165FCF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":578144,"discussion_content":"谢谢老师回答。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656546004,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":578141,"ip_address":"","group_id":0},"score":578144,"extra":""}]}]},{"had_liked":false,"id":349949,"user_name":"xmr","can_delete":false,"product_type":"c1","uid":1009622,"ip_address":"","ucode":"1BBF165F91F10B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/d6/2f5cb85c.jpg","comment_is_top":false,"comment_ctime":1656469199,"is_pvip":false,"replies":[{"id":127358,"content":"great","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1656471801,"ip_address":"","comment_id":349949,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"1.cow: 写时复制\n2.减少储存空间，减少上传和下载的时间","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578014,"discussion_content":"great","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656471802,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}