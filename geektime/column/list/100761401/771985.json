{"id":771985,"title":"03ï½œç¼–ç¨‹è¯­è¨€å…¨æ™¯å›¾ï¼ˆä¸‹ï¼‰ï¼šè™šæ‹Ÿæœºæ˜¯å¦‚ä½•æ‰§è¡Œå­—èŠ‚ç çš„ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æµ·çº³ã€‚</p><p>ä¸Šä¸€èŠ‚è¯¾æˆ‘ä»¬ä»‹ç»äº†ç¼–è¯‘å™¨æ˜¯å¦‚ä½•æŠŠæºä»£ç ç¿»è¯‘æˆå­—èŠ‚ç çš„ï¼Œè¿™ä¸€èŠ‚è¯¾æˆ‘ä»¬å°†ä¼šæ²¿ç”¨ä¸ŠèŠ‚è¯¾ä¸­çš„ä¾‹å­ï¼Œ<strong>å®ç°ä¸€ä¸ªç®€å•çš„è™šæ‹Ÿæœºï¼Œæ¥è¿è¡Œç”Ÿæˆçš„å­—èŠ‚ç </strong>ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸ŠèŠ‚è¯¾å®šä¹‰çš„å­—èŠ‚ç ã€‚</p><pre><code class=\"language-plain\">#define BINARY_MUL      20\n#define BINARY_DIV      21\n#define BINARY_ADD\t    23\n#define BINARY_SUB      24\n\n#define LOAD_CONST\t100\n</code></pre><p>ä¸ŠèŠ‚è¯¾çš„æœ€åï¼Œç”Ÿæˆçš„å­—èŠ‚ç å†…å®¹æ˜¯ <code>[100, 00, 12, 100, 00, 48, 20, 100, 00, 59, 23]</code>ï¼Œæˆ‘ä»¬æŠŠè¿™æ®µå­—èŠ‚ç ç¿»è¯‘å‡ºæ¥ã€‚</p><pre><code class=\"language-plain\">LOAD_CONST      12\nLOAD_CONST      48\nBINARY_MUL\nLOAD_CONST      59\nBINARY_ADD\n</code></pre><p>è¿™æ®µå­—èŠ‚ç å…±åŒ…å«äº†5ä¸ªæ“ä½œã€‚</p><ol>\n<li>å°†æ•°å­— 12 åŠ è½½åˆ°æ“ä½œæ•°æ ˆé¡¶ã€‚</li>\n<li>å°†æ•°å­— 48 åŠ è½½åˆ°æ“ä½œæ•°æ ˆé¡¶ã€‚</li>\n<li>å°†ä¸¤ä¸ªæ•°å­—ä»æ ˆé¡¶å–å‡ºï¼Œå¹¶åšä¹˜æ³•ï¼Œç„¶åå°†ç»“æœé€å›æ ˆé¡¶ã€‚</li>\n<li>å°†æ•°å­— 59 åŠ è½½åˆ°æ ˆé¡¶ã€‚</li>\n<li>å°†ä¸¤ä¸ªæ•°å­—ä»æ ˆé¡¶å–å‡ºï¼Œå¹¶åšåŠ æ³•ï¼Œç„¶åå°†ç»“æœé€å›æ ˆé¡¶ã€‚</li>\n</ol><p>è¿™èŠ‚è¯¾æˆ‘ä»¬å°†å®Œæˆä¸‰ä¸ªä»»åŠ¡ï¼šä¸€æ˜¯å°†å­—èŠ‚ç ä»å†…å­˜ä¸­å†™å…¥ç¡¬ç›˜æ–‡ä»¶ä¸­ï¼Œå®ç°å­—èŠ‚ç çš„åºåˆ—åŒ–ï¼›äºŒæ˜¯å®ç°ä¸€ä¸ªå°çš„è™šæ‹Ÿæœºï¼Œå°†å­—èŠ‚ç æ–‡ä»¶å†è¯»å…¥å†…å­˜ï¼›ä¸‰æ˜¯æ¯”è¾ƒè§£é‡Šå™¨å’ŒJITç¼–è¯‘å™¨ä¸¤ç§ä¸åŒçš„æ‰§è¡Œç­–ç•¥ã€‚</p><!-- [[[read_end]]] --><h2>ä¿å­˜å­—èŠ‚ç æ–‡ä»¶</h2><p>ç”±æºä»£ç ç¿»è¯‘æˆçš„Pythonå­—èŠ‚ç ä¼šæŒ‰ç…§ä¸€å®šçš„æ ¼å¼ä¿å­˜åœ¨ç¡¬ç›˜ä¸Šï¼Œè¿™å°±æ˜¯å­—èŠ‚ç æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬å¼•å…¥ä¸€ä¸ªæ–°çš„ç±» CodeObject æ¥è¡¨ç¤ºç¼–è¯‘å¾—åˆ°çš„å­—èŠ‚ç å¯¹è±¡ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹å®ƒçš„ä»£ç ã€‚</p><pre><code class=\"language-c++\">int CodeObject::write_to_file(string&amp; filename, CodeObject&amp; co) {\n    ofstream file = ofstream(filename, ios::out | ios::binary);\n    int magic_number = 0xa0df303;\n\n    if (!file.good()) {\n        cerr &lt;&lt; \"stream buf state is bad\" &lt;&lt; endl;\n        return -1;\n    }\n\n    file.write(reinterpret_cast&lt;const char*&gt;(&amp;magic_number), 4);\n\n    co.save_to_file(file);\n\n    file.close();\n    return 0;\n}\n\nint CodeObject::save_to_file(ofstream&amp; file) {\n    save_code_to_file(file);\n\n    return 0;\n}\n\ntemplate&lt;typename T&gt;\nint CodeObject::save_const_value(T t, ofstream&amp; file) {\n    file.write(reinterpret_cast&lt;const char*&gt;(&amp;t), sizeof(T));\n    return 0;\n}\n\nint CodeObject::save_code_to_file(ofstream&amp; file) {\n    file &lt;&lt; 's';\n    save_const_value((int)_insts.size(), file);\n    for (auto it = _insts.begin(); it != _insts.end(); it++) {\n        file &lt;&lt; *it;\n    }\n    return 0;\n}\n</code></pre><p>è¿™æ®µä»£ç çš„ä¸»è¦ä½œç”¨æ˜¯<strong>æŠŠå­—èŠ‚ç ä»¥ä¸€å®šçš„æ ¼å¼å†™å…¥åˆ°æ–‡ä»¶ä¸­</strong>ã€‚0xa0df303 æ˜¯ Python è™šæ‹Ÿæœºè¦æ±‚çš„é­”æ•°ï¼Œæ‰€æœ‰çš„å­—èŠ‚ç æ–‡ä»¶éƒ½å¿…é¡»ä»¥è¿™ä¸ªé­”æ•°ä¸ºå¼€å¤´ï¼Œä»£è¡¨è‡ªå·±æ˜¯ä¸€ä¸ªåˆæ³•çš„ Python å­—èŠ‚ç æ–‡ä»¶ï¼ˆç¬¬3è¡Œå’Œç¬¬10è¡Œï¼‰ã€‚</p><p>save_code_to_fileæ–¹æ³•è´Ÿè´£å°†å­—èŠ‚ç å¯¹è±¡å†™å…¥æ–‡ä»¶ä¸­ã€‚è¿™ä¸ªæ–¹æ³•å…ˆå‘æ–‡ä»¶ä¸­å†™å…¥ä¸€ä¸ªå­—ç¬¦ <code>'s'</code>ï¼Œä»£è¡¨æ¥ä¸‹æ¥æ˜¯ä¸€æ®µå¯å˜é•¿åº¦çš„å­—ç¬¦ä¸²ï¼ˆç¬¬31è¡Œï¼‰ï¼Œç„¶åå‘æ–‡ä»¶ä¸­å†™å…¥å­—ç¬¦ä¸²çš„é•¿åº¦ï¼ˆç¬¬32è¡Œï¼‰ï¼Œæœ€åéå†æŒ‡ä»¤åºåˆ—ï¼Œå°†æ‰€æœ‰çš„æŒ‡ä»¤ä¾æ¬¡å†™å…¥æ–‡ä»¶ï¼ˆç¬¬33è‡³35è¡Œï¼‰ã€‚</p><p>save_const_value æ˜¯ä¸€ä¸ªæ³›å‹æ–¹æ³•ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å°†ä¸åŒç±»å‹çš„æ•°å­—ä»¥å­—ç¬¦çš„å½¢å¼å†™å…¥æ–‡ä»¶ä¸­ã€‚è¿™é‡Œä½¿ç”¨äº†reinterpret_castï¼Œä»£è¡¨ä»¥å­—ç¬¦æŒ‡é’ˆçš„å½¢å¼è¯»å–ä¼ å…¥çš„å‚æ•°ï¼ˆç¬¬26è¡Œï¼‰ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œå…¶ä»–çš„ä»£ç æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œæˆ‘å°±ä¸å†èµ˜è¿°äº†ã€‚</p><p>ç¼–è¯‘æ‰§è¡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªåä¸º test_token.txtc çš„æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ–‡ä»¶çš„å†…å®¹æ˜¯ç”±æºä»£ç æ‰€ç”Ÿæˆçš„å­—èŠ‚ç æ–‡ä»¶ã€‚ä½¿ç”¨ Linux è‡ªå¸¦çš„ xxd å‘½ä»¤ä»¥16è¿›åˆ¶æ¥æŸ¥çœ‹è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-plain\"># xxd test_token.txtc\n00000000: 03f3 0d0a 7308 0000 0064 0c64 3014 643b&nbsp; ....s....d.d0.d;\n00000010: 17&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.\n</code></pre><p>æ³¨æ„ï¼Œ0x64æ­£æ˜¯åè¿›åˆ¶çš„100ï¼Œä»£è¡¨ LOAD_CONST æŒ‡ä»¤ï¼Œç´§è·Ÿåœ¨åé¢çš„é‚£ä¸ªå­—èŠ‚æ˜¯è¿™ä¸ªæŒ‡ä»¤çš„æ“ä½œæ•°ã€‚0x14 æ˜¯åè¿›åˆ¶çš„ 20ï¼Œä»£è¡¨ BINARY_MUL æŒ‡ä»¤ã€‚å¯è§è¿™ä¸ªå­—èŠ‚ç æ–‡ä»¶æ˜¯ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸçš„ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°ä¸€ä¸ªç®€å•çš„è™šæ‹Ÿæœºæ¥æ‰§è¡Œè¿™ä¸ªå­—èŠ‚ç æ–‡ä»¶äº†ã€‚</p><h2>è™šæ‹Ÿæœºè§£é‡Šæ‰§è¡Œå­—èŠ‚ç </h2><p>æˆ‘ä»¬å…ˆåœ¨é¡¹ç›®ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªå­ç›®å½•ï¼Œåä¸ºvmï¼Œä»£è¡¨ Python è™šæ‹Ÿæœºã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œä½¿ç”¨ BinaryFileParser ç±»åŠ è½½å­—èŠ‚ç æ–‡ä»¶ï¼Œè¯»å‡ºæ–‡ä»¶çš„ magic numberï¼Œç„¶åæŠŠå­—èŠ‚ç è£…è½½è¿› HiString ç±»ã€‚HiString ä»£è¡¨è™šæ‹Ÿæœºä¸­çš„å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªç±»ä¸ C++ å†…å»ºçš„ string ç±»æœ‰æ‰€ä¸åŒï¼Œè™šæ‹Ÿæœºä¸­çš„æ¯ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦éƒ½ç”± length å±æ€§æè¿°ã€‚å­—ç¬¦ 0 åœ¨ HiString ä¸­æ˜¯åˆæ³•å­—ç¬¦ï¼Œä¸ä»£è¡¨å­—ç¬¦ä¸²ç»“å°¾ã€‚</p><p>HiString çš„æ„é€ å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p><pre><code class=\"language-c++\">HiString::HiString(const char* x) {\n    _length = strlen(x);\n    _value = new char[_length];\n    strcpy(_value, x);\n}\n\nHiString::HiString(const char * x, const int length) {\n    _length = length;\n    _value = new char[length];\n\n    // do not use strcpy here, since '\\0' is allowed.\n    for (int i = 0; i &lt; length; i++) {\n        _value[i] = x[i];\n    }\n}\n</code></pre><p>è¯·æ³¨æ„ï¼Œè™šæ‹Ÿæœºçš„ä»£ç é‡Œä¸ä½¿ç”¨ä»»ä½•çš„ STL å†…å»ºåº“ï¼Œè¿™æ˜¯å› ä¸ºè™šæ‹Ÿæœºä¸­çš„å­—ç¬¦ä¸²ã€æ•´æ•°ã€åˆ—è¡¨ã€å­—å…¸ç­‰ç»“æ„æœªæ¥éƒ½åº”è¯¥ç”±åƒåœ¾å›æ”¶å™¨è‡ªåŠ¨ç®¡ç†ã€‚æ‰€ä»¥è™šæ‹Ÿæœºå¿…é¡»å¯¹æ•°æ®ç»“æ„ä¸­çš„æ¯ä¸€ä¸ªå­—èŠ‚çš„åˆ†é…ä½ç½®å’Œç”Ÿå‘½å‘¨æœŸæœ‰å®Œå…¨çš„æŒæ§æƒï¼Œè¿™å°±å¿…ç„¶è¦æ±‚æ‰€æœ‰çš„æ•°æ®ç»“æ„éƒ½è‡ªä¸»å®ç°ï¼Œè€Œä¸èƒ½ä½¿ç”¨ç¬¬ä¸‰æ–¹ç±»åº“ã€‚</p><p>BinaryFileParser å…¶ä»–éƒ¨åˆ†çš„ä»£ç ä¸»è¦æ˜¯æ–‡ä»¶è¯»å…¥æ“ä½œï¼Œé€»è¾‘ååˆ†ç®€å•ï¼Œè¿™é‡Œå°±ä¸å†åˆ—å‡ºå®ƒçš„æºç äº†ã€‚</p><p>æœ€åä¸€æ­¥ï¼Œå®ç° Interpreter ç±»ï¼Œæ‰§è¡Œå­—èŠ‚ç ã€‚è¿™æ˜¯è™šæ‹Ÿæœºè§£é‡Šå™¨çš„ä¸»ç±»ï¼Œå®ƒçš„ run æ–¹æ³•çš„èŒè´£æ˜¯é€æ¡å–å‡ºå­—èŠ‚ç ï¼Œç„¶åä¾æ¬¡æ‰§è¡Œã€‚ä½ å¯ä»¥çœ‹ä¸€ä¸‹å¯¹åº”çš„ä»£ç ã€‚</p><pre><code class=\"language-c++\">void Interpreter::run(HiString* codes) {\n&nbsp; &nbsp; int pc = 0;\n&nbsp; &nbsp; int code_length = codes-&gt;length();\n\n&nbsp; &nbsp; _stack&nbsp; = new int[16];\n&nbsp; &nbsp; int top = 0;\n\n&nbsp; &nbsp; while (pc &lt; code_length) {\n&nbsp; &nbsp; &nbsp; &nbsp; unsigned char op_code = codes-&gt;value()[pc++];\n&nbsp; &nbsp; &nbsp; &nbsp; bool has_argument = (op_code &amp; 0xFF) &gt;= ByteCode::HAVE_ARGUMENT;\n\n&nbsp; &nbsp; &nbsp; &nbsp; int op_arg = -1;\n&nbsp; &nbsp; &nbsp; &nbsp; if (has_argument) {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; op_arg = (codes-&gt;value()[pc++] &amp; 0xFF);\n&nbsp; &nbsp; &nbsp; &nbsp; }\n\n&nbsp; &nbsp; &nbsp; &nbsp; int v, w;\n\n&nbsp; &nbsp; &nbsp; &nbsp; switch (op_code) {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case ByteCode::LOAD_CONST:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _stack[top++] = op_arg;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;\n\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case ByteCode::BINARY_ADD:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v = _stack[--top];\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; w = _stack[--top];\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _stack[top++] = v + w;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;\n\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case ByteCode::BINARY_MULTIPLY:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v = _stack[--top];\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; w = _stack[--top];\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _stack[top++] = v * w;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;\n\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; printf(\"Error: Unrecognized byte code %d\\n\", op_code);\n&nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; }\n&nbsp; &nbsp; printf(\"%d\\n\", _stack[0]);\n\n&nbsp; &nbsp; delete[] _stack;\n}\n</code></pre><p>run æ–¹æ³•åˆ›å»ºä¸€ä¸ªè¿è¡Œæ—¶æ ˆï¼ˆç¬¬ 5 è¡Œï¼‰ï¼Œç„¶åä½¿ç”¨ä¸€ä¸ªå¤§çš„å¾ªç¯ä¸æ–­åœ°ä»å­—èŠ‚ç æ•°ç»„ä¸­å–å‡ºæŒ‡ä»¤ï¼ˆç¬¬ 8 è‡³ 39 è¡Œï¼‰ã€‚</p><p>æ¯å–å‡ºä¸€æ¡æŒ‡ä»¤éƒ½éœ€è¦åˆ¤æ–­è¿™æ¡æŒ‡ä»¤æ˜¯å¦å¸¦æœ‰å‚æ•°ï¼ˆç¬¬ 10 è¡Œï¼‰ï¼Œå¦‚æœæœ‰å‚æ•°ï¼Œè¿˜è¦å–å‡ºå‚æ•°ã€‚LOAD_CONST æŒ‡ä»¤æ˜¯å¸¦æœ‰å‚æ•°çš„ï¼Œè€ŒBINARY_ADDæŒ‡ä»¤åˆ™æ˜¯æ²¡æœ‰å‚æ•°çš„ã€‚</p><p>æ¥ä¸‹æ¥çš„ switch è¯­å¥åˆ†åˆ«å¯¹ä¸åŒçš„æŒ‡ä»¤è¿›è¡Œå¤„ç†ã€‚LOAD_CONST å°±æ˜¯å°†æŒ‡ä»¤å‚æ•°åŠ è½½åˆ°æ“ä½œæ•°æ ˆé¡¶ï¼ˆç¬¬ 20 è‡³ 22 è¡Œï¼‰ï¼ŒäºŒå…ƒæ“ä½œæ•°æŒ‡ä»¤ä»æ ˆé¡¶å–å‡ºä¸¤ä¸ªæ•°ï¼Œè¿›è¡ŒäºŒå…ƒè¿ç®—ä»¥åï¼Œå†æŠŠç»“æœæ”¾å›æ ˆé¡¶ï¼ˆç¬¬ 24 è‡³ 34 è¡Œï¼‰ã€‚è¿™å’Œå‰é¢ç¤ºä¾‹çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯å®Œå…¨å¯¹åº”çš„ã€‚</p><p>è¿™ç§æŠŠå­—èŠ‚ç é€æ¡å–å‡ºï¼Œç„¶åæŒ‰ç…§å­—èŠ‚ç çš„è¯­ä¹‰ç›´æ¥åœ¨æ“ä½œæ•°æ ˆä¸Šè¿›è¡Œè¿ç®—çš„æ–¹å¼å°±æ˜¯<strong>è§£é‡Šæ‰§è¡Œ</strong>ã€‚è¿™ç§åšæ³•çš„ä¼˜ç‚¹æ˜¯è¯­ä¹‰æ¸…æ™°ã€å®ç°ç®€å•ï¼Œç¼ºç‚¹åœ¨äºè¿è¡Œçš„æ€§èƒ½ä¸é«˜ã€‚</p><p>å¯¹äºä¸€ä¸ªç®€å•çš„è¿ç®—ï¼Œå¦‚æœä½¿ç”¨ C è¯­è¨€ï¼Œç»è¿‡ GCC ç­‰ç¼–è¯‘å™¨çš„ä¼˜åŒ–ï¼Œåªéœ€è¦ä¸‰å››æ¡æœºå™¨æŒ‡ä»¤å°±å¯ä»¥å®Œæˆäº†ã€‚è€Œä½¿ç”¨è§£é‡Šæ‰§è¡Œï¼Œæœ€å°‘ä¹Ÿè¦å‡ ç™¾æ¡æŒ‡ä»¤æ‰èƒ½å®Œæˆã€‚æ‰€ä»¥é‡‡ç”¨è§£é‡Šæ‰§è¡Œçš„ Pythonã€Lua ç­‰è„šæœ¬è¯­è¨€ç›¸æ¯” C è¯­è¨€ç­‰é™æ€ç¼–è¯‘è¯­è¨€ï¼Œæ€§èƒ½è¡¨ç°ä¸Šå¾€å¾€æœ‰æ•°é‡çº§çš„å·®è·ã€‚</p><p>ç„¶è€Œé‡‡ç”¨è™šæ‹Ÿæœºçš„è¯­è¨€ï¼Œæ€§èƒ½å¹¶ä¸ä¸€å®šå°±éƒ½å¾ˆå·®ã€‚åŸºäº Hotspot è™šæ‹Ÿæœºçš„ Java è¯­è¨€å’ŒåŸºäº V8 è™šæ‹Ÿæœºçš„ Node.js åœ¨å¾ˆå¤šåœºæ™¯ä¸Šéƒ½å¯ä»¥è¾¾åˆ°ä¸ C/C++ ç›¸åŒçš„æ€§èƒ½è¡¨ç°ã€‚è¿™ä¸»è¦å¾—ç›Šäºå®ƒä»¬é‡‡ç”¨äº†ä¸€ç§åä¸º<strong>å³æ—¶ç¼–è¯‘ï¼ˆJust In Timeï¼ŒJITï¼‰</strong>çš„ç­–ç•¥ã€‚</p><h2>ç¬¬äºŒç§æ‰§è¡Œç­–ç•¥â€”â€”JIT</h2><p>Java è¯­è¨€è™šæ‹Ÿæœºï¼ˆJVMï¼‰åœ¨è¿è¡Œä¹‹åˆå°†classæ–‡ä»¶åŠ è½½è¿›å†…å­˜ï¼Œç„¶åå°±å¼€å§‹è§£é‡Šæ‰§è¡Œã€‚å¦‚æœä¸€ä¸ªå‡½æ•°è¢«æ‰§è¡Œå¤šæ¬¡ï¼ŒJVMå°±ä¼šè®¤ä¸ºè¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ªçƒ­ç‚¹ï¼ˆhotspotï¼‰å‡½æ•°ï¼Œç„¶åå°±å°†å®ƒç¿»è¯‘æˆæœºå™¨ç æ‰§è¡Œã€‚JITæœ€å¤§çš„ç‰¹ç‚¹æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶è¿›è¡Œç¼–è¯‘ã€‚</p><p>è¿™ç§ç¼–è¯‘æ–¹å¼ç›¸å¯¹è§£é‡Šå™¨ï¼Œæ€§èƒ½å¾—åˆ°äº†å·¨å¤§çš„æå‡ã€‚å®ƒä¸é™æ€ç¼–è¯‘ç›¸æ¯”åˆå…·æœ‰æ€æ ·çš„ç‰¹ç‚¹å‘¢ï¼Ÿæˆ‘ä»¬æ¥ä¸‹æ¥ä»åŸç†å…¥æ‰‹ï¼Œæ¥å›ç­”è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬å…ˆæ¥äº†è§£JITç¼–è¯‘å™¨èƒ½æˆåŠŸè¿è¡Œæ‰€ä¾èµ–çš„ä¸¤å¤§æ ¸å¿ƒæœºåˆ¶ã€‚</p><ol>\n<li>ç”³è¯·å¯å†™å¯æ‰§è¡Œçš„å†…å­˜åŒºåŸŸï¼Œç¡®ä¿åœ¨è¿è¡ŒæœŸå¯ä»¥ç”Ÿæˆå¯æ‰§è¡Œçš„æœºå™¨ç ã€‚</li>\n<li>åŸºäºæ€§èƒ½é‡‡æ ·çš„ç¼–è¯‘ä¼˜åŒ–ï¼ˆProfiling Guided Optimization, PGOï¼‰ï¼Œå¯ä»¥ä½¿JITç¼–è¯‘å™¨è·å¾—è¶…è¿‡é™æ€ç¼–è¯‘å™¨çš„è¿è¡Œæ€§èƒ½ã€‚</li>\n</ol><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹JITç¼–è¯‘çš„ç¬¬ä¸€ä¸ªæ ¸å¿ƒæœºåˆ¶ï¼šå¯å†™å¯æ‰§è¡Œçš„å†…å­˜åŒºåŸŸã€‚</p><h3>å¯å†™å¯æ‰§è¡Œçš„å†…å­˜åŒºåŸŸ</h3><p>å…·ä½“æ¥è®²ï¼Œè¿™ä¸ªæœºåˆ¶æ˜¯ç”³è¯·ä¸€å—æ—¢æœ‰å†™æƒé™åˆæœ‰æ‰§è¡Œæƒé™çš„å†…å­˜ï¼Œç„¶åæŠŠä½ è¦ç¼–è¯‘çš„Javaæ–¹æ³•ç¿»è¯‘æˆæœºå™¨ç ï¼Œå†™å…¥åˆ°è¿™å—å†…å­˜é‡Œã€‚å½“éœ€è¦å†æ¬¡è°ƒç”¨åŸæ¥çš„Javaæ–¹æ³•æ—¶ï¼Œå°±è½¬å‘è°ƒç”¨è¿™å—å†…å­˜ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚</p><pre><code class=\"language-c++\">#include&lt;stdio.h&gt;\n\nint inc(int a) {\n&nbsp; &nbsp; return a + 1;\n}\n\nint main() {\n&nbsp; &nbsp; printf(\"%d\\n\", inc(3));\n&nbsp; &nbsp; return 0;\n}\n</code></pre><p>è¿™ä¸ªä¾‹å­å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠ3åŠ ä¸Š1ï¼Œç„¶åæ‰“å°å‡ºæ¥ï¼Œæˆ‘ä»¬é€šè¿‡ä»¥ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹ä¸€ä¸‹å®ƒçš„æœºå™¨ç ã€‚</p><pre><code class=\"language-plain\">$ gcc -o inc inc.c\n$ objdump -d inc\n</code></pre><p>åœ¨è¿™ä¸€å †è¾“å‡ºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° inc æ–¹æ³•æœ€ç»ˆè¢«ç¿»è¯‘æˆäº†è¿™æ ·çš„æœºå™¨ç ï¼š</p><pre><code class=\"language-plain\">&nbsp; 40052d:\t55&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\tpush&nbsp; &nbsp;%rbp\n&nbsp; 40052e:\t48 89 e5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\tmov&nbsp; &nbsp; %rsp,%rbp\n&nbsp; 400531:\t89 7d fc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\tmov&nbsp; &nbsp; %edi,-0x4(%rbp)\n&nbsp; 400534:\t8b 45 fc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\tmov&nbsp; &nbsp; -0x4(%rbp),%eax\n&nbsp; 400537:\t83 c0 01&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\tadd&nbsp; &nbsp; $0x1,%eax\n&nbsp; 40053a:\t5d&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\tpop&nbsp; &nbsp; %rbp\n&nbsp; 40053b:\tc3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\tretq&nbsp;\n</code></pre><p>æˆ‘ä»¬å…ˆæ¥åˆ†æä¸€ä¸‹è¿™å—æœºå™¨ç ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå®ƒé¦–å…ˆä¼šä¿å­˜ä¸Šä¸€ä¸ªæ ˆå¸§çš„åŸºå€ï¼Œå¹¶æŠŠå½“å‰çš„æ ˆæŒ‡é’ˆèµ‹ç»™æ ˆåŸºå€å¯„å­˜å™¨ï¼ˆç¬¬1è¡Œï¼‰ï¼Œè¿™æ˜¯è¿›å…¥ä¸€ä¸ªå‡½æ•°çš„å¸¸è§„æ“ä½œã€‚</p><p>ç„¶åæŠŠediå­˜åˆ°æ ˆä¸Šï¼ˆç¬¬3è¡Œï¼‰ã€‚åœ¨X86 64ä½Linuxç³»ç»Ÿä¸Šï¼Œå‰6ä¸ªå‚æ•°éƒ½æ˜¯ä½¿ç”¨å¯„å­˜å™¨ä¼ å‚çš„ã€‚ç¬¬ä¸€ä¸ªå‚æ•°ä¼šä½¿ç”¨rdiï¼Œç¬¬äºŒä¸ªå‚æ•°ä½¿ç”¨ rsiï¼Œåé¢å‡ ä¸ªå‚æ•°ä¹Ÿæ˜¯è¿™æ ·ã€‚æ‰€ä»¥ edi é‡Œå­˜çš„å…¶å®å°±æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯æ•´æ•° 3ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨rdiçš„ä½32ä½ï¼Œä¹Ÿå°±æ˜¯ edi å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬çš„å…¥å‚ a æ˜¯ int å‹ï¼Œä½ å¯ä»¥è¯•ç€æ¢æˆlongå‹ï¼Œçœ‹çœ‹ä¼šæœ‰ä»€ä¹ˆæ ·çš„æ•ˆæœã€‚</p><p>æ¥ç€ï¼ŒæŠŠä¸Šä¸€æ­¥å­˜åˆ°æ ˆä¸Šçš„é‚£ä¸ªæ•´æ•°å†å­˜è¿› eax ä¸­ï¼ˆç¬¬4è¡Œï¼‰ã€‚æœ€åç»™ eax åŠ ä¸Š 1ï¼Œ ç„¶åå°±é€€æ ˆï¼Œè¿”å›ï¼ˆç¬¬5è¡Œå¾€åï¼‰ã€‚æŒ‰ç…§äºŒè¿›åˆ¶æ¥å£ï¼ˆApplication Binary Interfaceï¼ŒABIï¼‰çš„è§„å®šï¼Œè¿”å›å€¼é€šè¿‡eaxä¼ é€’ã€‚</p><p>é€šè¿‡åˆšåˆšçš„åˆ†æï¼Œä½ ä¼šå‘ç°ï¼Œå…¶å®ä¸Šé¢ç¼–è¯‘ä»£ç çš„ç¬¬3è¡Œå’Œç¬¬4è¡Œæ ¹æœ¬æ²¡æœ‰å­˜åœ¨çš„å¿…è¦ï¼ŒGCC  åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œç”Ÿæˆçš„æœºå™¨ç æœ‰ç‚¹å‚»ï¼Œå®ƒæ€»æ˜¯è¦æŠŠå…¥å‚æ”¾åˆ°æ ˆä¸Šï¼Œä½†å…¶å®æˆ‘ä»¬æ˜¯å¯ä»¥ç›´æ¥æŠŠå‚æ•°ä» rdi ä¸­æ”¾åˆ° rax ä¸­çš„ã€‚</p><p>å¦‚æœä½ è¿˜æ˜¯è§‰å¾—è¿™æ®µä»£ç å¤ªå¤æ‚äº†ï¼Œé‚£æˆ‘ä»¬å¯ä»¥è‡ªå·±æ”¹ä¸€ä¸‹ï¼Œè®©å®ƒæ›´ç²¾ç®€ä¸€ç‚¹ã€‚æ€ä¹ˆåšå‘¢ï¼Ÿå°±æ˜¯åœ¨è¿è¡Œæ—¶ä¿®æ”¹ inc çš„é€»è¾‘ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹ä¿®æ”¹åçš„ä»£ç ã€‚</p><pre><code class=\"language-c++\">#include&lt;stdio.h&gt;\n#include&lt;memory.h&gt;\n#include&lt;sys/mman.h&gt;\n\ntypedef int (* inc_func)(int a);&nbsp;\n\nint main() {\n&nbsp; &nbsp; char code[] = {&nbsp;\n&nbsp; &nbsp; &nbsp; &nbsp; 0x55,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// push rbp\n&nbsp; &nbsp; &nbsp; &nbsp; 0x48, 0x89, 0xe5, // mov rsp, rbp\n&nbsp; &nbsp; &nbsp; &nbsp; 0x89, 0xf8,&nbsp; &nbsp; &nbsp; &nbsp;// mov edi, eax\n&nbsp; &nbsp; &nbsp; &nbsp; 0x83, 0xc0, 0x01, // add $1, eax\n&nbsp; &nbsp; &nbsp; &nbsp; 0x5d,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// pop rbp\n&nbsp; &nbsp; &nbsp; &nbsp; 0xc3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // ret\n&nbsp; &nbsp; };&nbsp;&nbsp;\n\n&nbsp; &nbsp; void * temp = mmap(NULL, sizeof(code), PROT_WRITE | PROT_EXEC,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MAP_ANONYMOUS | MAP_PRIVATE, -1, 0);&nbsp;\n\n&nbsp; &nbsp; memcpy(temp, code, sizeof(code));\n&nbsp; &nbsp; inc_func p_inc = (inc_func)temp;\n&nbsp; &nbsp; printf(\"%d\\n\", p_inc(7));\n\n&nbsp; &nbsp; return 0;\n}\n</code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† mmap ç”³è¯·äº†ä¸€å—æœ‰å†™æƒé™å’Œæ‰§è¡Œæƒé™çš„å†…å­˜ï¼ŒæŠŠæˆ‘ä»¬æ‰‹å†™çš„æœºå™¨ç å¤åˆ¶è¿›å»ï¼Œç„¶åä½¿ç”¨ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆæŒ‡å‘è¿™å—å†…å­˜ï¼Œå¹¶ä¸”è°ƒç”¨å®ƒã€‚é€šè¿‡è¿™ç§æ–¹å¼æˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œè¿™ä¸€æ®µæ‰‹å†™çš„æœºå™¨ç äº†ã€‚æˆ‘ä»¬æ¥è¿è¡Œä¸€ä¸‹çœ‹çœ‹ã€‚</p><pre><code class=\"language-plain\">$ gcc -o inc inc.c \n$ ./inc\n8\n</code></pre><p>ä¸ºäº†ç”Ÿæˆæ›´ç²¾ç®€çš„æœºå™¨ç ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥ç¼–è¯‘å™¨ä¼˜åŒ–æ‰‹æ®µï¼Œä¾‹å¦‚å…¨å±€å€¼ç¼–ç ã€æ­»ä»£ç æ¶ˆé™¤ã€æ ‡é‡å±•å¼€ã€å…¬å…±å­è¡¨è¾¾å¼æ¶ˆé™¤å’Œå¸¸é‡ä¼ æ’­ç­‰ç­‰ã€‚è¿™æ ·ç”Ÿæˆå‡ºæ¥çš„æœºå™¨ç ä¼šæ›´ä¼˜ã€‚æ‰€ä»¥è¿™ç§ç¼–è¯‘æ–¹å¼å°±è¢«å«åšå³æ—¶ç¼–è¯‘ã€‚</p><p>æˆ‘ä»¬ææ¸…æ¥šäº†JITç¼–è¯‘çš„ç¬¬ä¸€ä¸ªæ ¸å¿ƒæœºåˆ¶åï¼Œå†æ¥çœ‹å®ƒçš„ç¬¬äºŒä¸ªæ ¸å¿ƒæœºåˆ¶ï¼šåŸºäºé‡‡æ ·çš„ç¼–è¯‘ä¼˜åŒ–ã€‚</p><h3>åŸºäºé‡‡æ ·çš„ç¼–è¯‘ä¼˜åŒ–å’Œé€€ä¼˜åŒ–</h3><p>æˆ‘ä»¬çŸ¥é“ï¼Œæ¶æ„å¸ˆçš„ä¸€ä¸ªæ ¸å¿ƒèŒè´£æ˜¯å¯¹æ¯”å„ç§æŠ€æœ¯æ–¹æ¡ˆçš„ä¼˜åŠ£ï¼Œæˆ‘è‡³ä»Šè¿˜èƒ½å¬åˆ°æœ‰çš„æ¶æ„å¸ˆè¯´Javaæ€§èƒ½ä¸å¥½ï¼Œç†ç”±æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚Javaæ˜¯è§£é‡Šæ‰§è¡Œï¼ŒJavaé‡Œæ‰€æœ‰å‡½æ•°éƒ½æ˜¯è™šå‡½æ•°ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½éœ€è¦æŸ¥è¯¢è™šè¡¨ç­‰ç­‰ã€‚</p><p>è¿™äº›è¯´æ³•åœ¨è€ç‰ˆæœ¬çš„JVMä¸­å¯èƒ½æ˜¯å¯¹çš„ï¼Œä½†éšç€JVMä¸­JITç¼–è¯‘å™¨çš„æ¼”è¿›å’Œä¼˜åŒ–ï¼ŒJavaè¯­è¨€çš„è¿™äº›æ€§èƒ½ç¼ºé™·éƒ½åœ¨é€æ¸è¢«å…‹æœã€‚</p><p>ç¼–è¯‘å™¨çš„ä½œç”¨æ˜¯æŠŠé«˜çº§è¯­è¨€ç¿»è¯‘æˆæ€§èƒ½æœ€å¥½çš„æœºå™¨ç ã€‚ä¸ç®¡æ˜¯é™æ€ç¼–è¯‘è¿˜æ˜¯JITç¼–è¯‘ï¼Œå®ƒä»¬çš„åŠŸèƒ½éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯JITç¼–è¯‘å¾€å¾€å¯ä»¥åšå¾—æ›´å¥½ã€‚æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç¼–è¯‘ä¼˜åŒ–çš„å¸¸é‡ä¼ æ’­ä¾‹å­æ¥è¯´æ˜ã€‚</p><p>è¿™ä¸ªä¾‹å­çš„ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-java\">public static int test() {\n    int b = 3;  \n    int c = 4;\n    return b + c;\n}\n</code></pre><p>åœ¨è¿™å—ä»£ç ä¸­ï¼Œç”±äºç¬¬2è¡Œç»™bèµ‹å€¼ä¸€ä¸ªå¸¸é‡åï¼Œåé¢çš„è¯­å¥æ²¡æœ‰å†æ”¹è¿‡bçš„å€¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠåé¢æ‰€æœ‰å‡ºç°bçš„åœ°æ–¹éƒ½æ”¹ä¸º3ï¼ŒåŒç†ï¼Œæ‰€æœ‰å‡ºç°cçš„åœ°æ–¹éƒ½æ”¹ä¸º4ã€‚ç»è¿‡è¿™ç§ä¼˜åŒ–ï¼Œä»£ç çš„ç¬¬4è¡Œå°±å¯ä»¥æ”¹å†™æˆ <code>return 3 + 4;</code> ã€‚æ¥ç€ï¼Œç¼–è¯‘å™¨å†åšä¸€è½®åˆ†æï¼Œå¯¹äºè¿ç®—ç¬¦ä¸¤è¾¹éƒ½æ˜¯å¸¸é‡çš„æƒ…å†µï¼Œç›´æ¥è¿›è¡Œè®¡ç®—ï¼Œä¹Ÿå°±æ˜¯æŠŠä¸Šé¢çš„ä»£ç å†ä¼˜åŒ–æˆ <code>return 7;</code>ã€‚è¿™ç§ä¼˜åŒ–è¢«å«åš<strong>å¸¸é‡æŠ˜å </strong>ã€‚</p><p>è¿™é‡Œä¹Ÿè¯·ä½ æ€è€ƒä¸€ä¸‹ï¼Œå¦‚æœè¿™è¡Œä»£ç æ˜¯Cè¯­è¨€çš„ï¼Œé‚£ä¹ˆåœ¨æœ€ä¼˜çš„æƒ…å†µä¸‹ï¼ŒGCC ä¼šç”Ÿæˆä»€ä¹ˆæ ·çš„æœºå™¨ç ï¼Ÿ</p><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬è®²äº†ç¼–è¯‘å™¨ä¼˜åŒ–çš„ä¸€ä¸ªç®€å•æ€è·¯ã€‚å…¶å®ï¼Œç¼–è¯‘å™¨çš„ä¼˜åŒ–è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„æ€è·¯å’Œæ–¹æ³•ï¼Œè¿™é‡Œæˆ‘å°±ä¸å†ä¸€ä¸€åˆ—ä¸¾äº†ï¼Œå¦‚æœä½ å¯¹ç¼–è¯‘å™¨è®¾è®¡ç‰¹åˆ«æ„Ÿå…´è¶£çš„è¯ï¼Œæˆ‘æ¨èä½ å»çœ‹çœ‹<a href=\"https://book.douban.com/subject/3774682\">ã€Šç¼–è¯‘åŸç†ã€‹</a>å’Œ<a href=\"https://book.douban.com/subject/1400374\">ã€Šé«˜çº§ç¼–è¯‘å™¨è®¾è®¡ä¸å®ç° ã€‹</a>è¿™2æœ¬ä¹¦ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†çœ‹ç¬¬äºŒä¸ªä¾‹å­ï¼Œè¿™æ˜¯ä¸€ä¸ªCè¯­è¨€ç¼–è¯‘å™¨æ²¡æœ‰åŠæ³•ä¼˜åŒ–ï¼Œä½†æ˜¯JITç¼–è¯‘å´èƒ½è¿›ä¸€æ­¥ä¼˜åŒ–çš„ä¾‹å­ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ ä¼šå‘ç°å¸¸é‡ä¼ æ’­ä¸å†èµ·ä½œç”¨äº†ã€‚</p><pre><code class=\"language-java\">public static int test(boolean flag) {\n    int b = 0;\n    if (flag) {\n        b = 3;\n    }\n    else {\n        b = 2;\n    }\n    return b + 4;\n}\n</code></pre><p>å’Œç¬¬ä¸€ä¸ªä¾‹å­ç›¸æ¯”è¾ƒï¼Œè¿™ä¸ªä¾‹å­å¢åŠ äº†ç¬¬3è¡Œåˆ°ç¬¬8è¡Œçš„æ¡ä»¶åˆ¤æ–­ã€‚æ‰€ä»¥ç¼–è¯‘å™¨æ— æ³•çŸ¥é“ç¬¬9è¡Œbçš„çœŸå®å–å€¼æ˜¯ä»€ä¹ˆã€‚åªèƒ½ä¸¥æ ¼æŒ‰ç…§è¿™ä¸ªå‡½æ•°çš„é€»è¾‘å»ç”Ÿæˆæ¯”è¾ƒã€è·³è½¬ã€èµ‹å€¼ç­‰æ“ä½œï¼Œé‚£ä¹ˆè¿™ä¸ªä¾‹å­å°±æ¯”å¯ä»¥å¸¸é‡æŠ˜å çš„é‚£ä¸ªä¾‹å­å¤æ‚å¤šäº†ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè™½ç„¶è¿™ä¸ªä¾‹å­ä¸­çš„testå‡½æ•°æ²¡æœ‰ä¼˜åŒ–ç©ºé—´äº†ï¼Œä½†æ˜¯JVMçš„JITæŠ€æœ¯è¿˜æ˜¯åœ¨è¿™é‡Œæ‰¾åˆ°äº†ä¼˜åŒ–çš„æœºä¼šã€‚å‡å¦‚å­˜åœ¨ä¸€ç§æƒ…å†µï¼Œæ¯ä¸€æ¬¡testæ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä¼ çš„å‚æ•°flagéƒ½æ˜¯trueæˆ–è€…éƒ½æ˜¯falseï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œflagçš„å–å€¼å›ºå®šã€‚é‚£ä¹ˆJITç¼–è¯‘å™¨å°±å¯ä»¥è®¤ä¸ºå¦å¤–ä¸€ä¸ªåˆ†æ”¯æ˜¯ä¸å­˜åœ¨çš„ï¼Œå¯ä»¥ä¸ç¼–è¯‘ã€‚</p><p>JITç¼–è¯‘å™¨åœ¨å¼€å§‹ä¹‹å‰ï¼Œtestæ–¹æ³•æ˜¯ç”±è§£é‡Šå™¨æ‰§è¡Œçš„ã€‚è§£é‡Šå™¨ä¸€è¾¹æ‰§è¡Œï¼Œä¸€è¾¹ä¼šç»Ÿè®¡flagçš„å–å€¼ï¼Œè¿™ç§ç»Ÿè®¡å°±å«åšæ€§èƒ½é‡‡æ ·ï¼ˆProfilingï¼‰ã€‚å½“JITç¼–è¯‘å™¨å‘ç°ï¼Œtestæ–¹æ³•è¢«è°ƒç”¨äº†500æ¬¡ï¼ˆè¿™ä¸ªé˜ˆå€¼ç”±JVMå‚æ•°æŒ‡å®šï¼‰ï¼Œæ¯ä¸€æ¬¡flagçš„å€¼éƒ½æ˜¯trueï¼Œé‚£å®ƒå°±å¯ä»¥åˆç†åœ°çŒœæµ‹ï¼Œä¸‹ä¸€æ¬¡å¯èƒ½è¿˜æ˜¯trueï¼Œå®ƒå°±ä¼šæŠŠtestæ–¹æ³•ä¼˜åŒ–æˆä¸‹é¢è¿™ä¸ªæ ·å­ï¼š</p><pre><code class=\"language-java\">public static int test(boolean flag) {\n    return 7;\n}\n</code></pre><p>ä½†æ˜¯è¿™ç§åšæ³•æœ‰ä¸€äº›é—®é¢˜ï¼Œç›¸ä¿¡ä½ ä¹Ÿçœ‹å‡ºæ¥äº†ï¼Œå¦‚æœæ°å¥½testæ–¹æ³•çš„ä¸‹ä¸€æ¬¡è°ƒç”¨å°±æ˜¯falseå‘¢ï¼Ÿæ‰€ä»¥JVMå¿…é¡»åœ¨testæ–¹æ³•é‡Œç•™ä¸€ä¸ªå“¨å…µï¼Œå½“å‚æ•°flagçš„å€¼ä¸ºfalseçš„æ—¶å€™ï¼Œå¯ä»¥å†é€€å›åˆ°è§£é‡Šå™¨æ‰§è¡Œã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯<strong>é€€ä¼˜åŒ–ï¼ˆDeoptimizationï¼‰</strong>ï¼ŒJVMçš„JITç¼–è¯‘å™¨ç”Ÿæˆçš„æœºå™¨ç ç­‰æ•ˆäºä»¥ä¸‹ä»£ç ï¼š</p><pre><code class=\"language-java\">public static int test(boolean flag) {\n    if (!flag)\n        deoptimize()\n    return 7;\n}\n</code></pre><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œdeoptimizeæ–¹æ³•æ˜¯JVMæä¾›çš„å†…å»ºæ–¹æ³•ï¼Œå®ƒçš„ä½œç”¨æ˜¯ç”±JITç¼–è¯‘å™¨é€€å›åˆ°è§£é‡Šå™¨è¿›è¡Œæ‰§è¡Œã€‚è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠæ ˆå¸§çš„è¿è¡Œæ—¶åˆ‡æ¢ï¼Œæ— ç–‘æ˜¯éå¸¸ç²¾å·§å’Œå¤æ‚çš„ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯å®ç°ä¸€ä¸ªç®€å•çš„è™šæ‹Ÿæœºï¼Œå¹¶ä¸æ‰“ç®—å®ç°å®Œå¤‡çš„JITæœºåˆ¶ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¸å†å±•å¼€ä»‹ç»å®ƒçš„æŠ€æœ¯ç»†èŠ‚äº†ã€‚</p><p>è®©JITç¼–è¯‘å™¨è¿è¡Œå¾—å¥½ï¼Œæˆ‘ä»¬åªéœ€è¦éµå®ˆä¸€æ¡åŸåˆ™ï¼š<strong>è®©ç¨‹åºè¡Œä¸ºå¯é¢„æµ‹</strong>ã€‚å› ä¸ºJITç¼–è¯‘ä¼˜åŒ–çš„åŸºæœ¬å‡è®¾æ˜¯è¿‡å»å’Œæœªæ¥ï¼Œç¨‹åºçš„è¿è¡Œè§„å¾‹åŸºæœ¬ä¸€è‡´ï¼Œæ‰€ä»¥å®ƒåŸºäºè¿‡å»çš„è¡Œä¸ºæµ‹è¯•æœªæ¥ã€‚å¦‚æœå®ƒé¢„æµ‹çš„æœªæ¥å’ŒçœŸå®æƒ…å†µä¸ä¸€è‡´ï¼Œå°±ä¼šå‘ç”Ÿé€€ä¼˜åŒ–ã€‚é€€ä¼˜åŒ–ä¼šå¯¹æ€§èƒ½å¸¦æ¥å·¨å¤§çš„ä¼¤å®³ï¼Œæ‰€ä»¥JITæœ‰æ—¶ä¹Ÿå¯èƒ½æ˜¯ä¸€æŠŠåŒåˆƒå‰‘ã€‚</p><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å°±æŠŠJITç¼–è¯‘å™¨çš„åŸºæœ¬åŸç†ä»‹ç»å®Œäº†ã€‚å¯å†™å¯æ‰§è¡Œå†…å­˜å’ŒåŸºäºé‡‡æ ·çš„ç¼–è¯‘ä¼˜åŒ–è¿™ä¸¤å¤§æœºåˆ¶ä¿éšœäº†JITç¼–è¯‘å™¨çš„å®ç°ï¼Œè€ŒJITç¼–è¯‘å™¨åˆæ˜¯JVMé«˜æ•ˆæ‰§è¡Œçš„æ ¸å¿ƒç§˜å¯†ã€‚</p><h2>æ€»ç»“</h2><p>è¿™èŠ‚è¯¾æˆ‘ä»¬ç»§ç»­ä¸ŠèŠ‚è¯¾çš„å†…å®¹ï¼Œå°†ç¼–è¯‘å™¨å‰ç«¯ç”Ÿæˆçš„å­—èŠ‚ç å…ˆä¿å­˜æˆäºŒè¿›åˆ¶æ–‡ä»¶ã€‚ç„¶åå®ç°äº†ä¸€ä¸ªéå¸¸ç®€å•çš„è™šæ‹Ÿæœºï¼Œç”¨äºè§£é‡Šæ‰§è¡Œå­—èŠ‚ç ã€‚</p><p>è™šæ‹Ÿæœºçš„ä¸»æµæ‰§è¡Œç­–ç•¥æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯<strong>è§£é‡Šæ‰§è¡Œ</strong>ï¼Œè§£é‡Šå™¨æŒ‰ç…§å­—èŠ‚ç çš„è¯­ä¹‰ç›´æ¥åœ¨æ“ä½œæ•°æ ˆä¸Šè¿›è¡Œè¿ç®—ã€‚å¦ä¸€ç§æ˜¯<strong>å³æ—¶ç¼–è¯‘æ‰§è¡Œ</strong>ï¼Œå®ƒä¼šåœ¨è¿è¡Œæ—¶ç”Ÿæˆæœºå™¨ç ï¼Œä»è€Œæå¤§åœ°æå‡è™šæ‹Ÿæœºæ€§èƒ½ã€‚å³æ—¶ç¼–è¯‘åŒ…æ‹¬ä¸¤ä¸ªæ ¸å¿ƒæŠ€æœ¯ï¼Œä¸€æ˜¯åœ¨è¿è¡Œæ—¶ç”³è¯·å¯å†™æ‰§è¡Œçš„å†…å­˜åŒºåŸŸï¼Œå¯ä»¥è®©ç¼–è¯‘å™¨åœ¨è¿è¡Œæ—¶ç”Ÿæˆæœºå™¨ç ï¼ŒäºŒæ˜¯åŸºäºé‡‡æ ·çš„ç¼–è¯‘ä¼˜åŒ–å’Œé€€ä¼˜åŒ–ï¼Œå¯ä»¥è®©ç¼–è¯‘å™¨ç”Ÿæˆæ¿€è¿›çš„ä¼˜åŒ–ä»£ç ï¼Œä»è€Œè·å¾—æè‡´çš„è¿è¡Œæ€§èƒ½ã€‚</p><p>ä»è¿™ä¸¤èŠ‚è¯¾çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<strong>å­—èŠ‚ç æ–‡ä»¶æ˜¯ Python ç¼–è¯‘å™¨å’Œè™šæ‹Ÿæœºçš„å…³é”®ä¸­æ¢</strong>ã€‚ç¼–è¯‘å™¨çš„è¾“å‡ºæ˜¯å­—èŠ‚ç æ–‡ä»¶ï¼Œè€Œè™šæ‹Ÿæœºä¹Ÿæ˜¯ä»åŠ è½½å­—èŠ‚ç æ–‡ä»¶å¼€å§‹ã€‚æ‰€ä»¥ä¸‹ä¸€èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°±æ¥ç ”ç©¶ Python å­—èŠ‚ç æ–‡ä»¶çš„æ ¼å¼ã€‚</p><p><span class=\"reference\">æ³¨ï¼šç‚¹å‡»é“¾æ¥æŸ¥çœ‹<a href=\"https://gitee.com/hinus/pythonvm/tree/geektime/\">è¯¾ç¨‹ä»£ç åœ°å€</a></span></p><h2>æ€è€ƒé¢˜</h2><p>è¯·é˜…è¯» PEP 542ï¼Œå¹¶æ€è€ƒèƒ½å¦ä½¿ç”¨ CPython çš„ç°æœ‰æœºåˆ¶æ¥å®ç°æ’å…¥å¼çš„ JIT æ‰§è¡Œå™¨ï¼Ÿæ¬¢è¿ä½ æŠŠä½ æ€è€ƒåçš„ç»“æœåˆ†äº«åˆ°è¯„è®ºåŒºï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾çš„å†…å®¹åˆ†äº«ç»™éœ€è¦çš„æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","comments":[{"had_liked":false,"id":391078,"user_name":"@Michael","can_delete":false,"product_type":"c1","uid":1952068,"ip_address":"ç¾å›½","ucode":"C8981CA55F59FC","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/9gGibPjZttS6OHmvwGncbEuFMJudlT2sFUlcy5LPcT7icrfUNtOTuXukTaxsL0zZj1OZtDK36ib6iczSY5mp22X1LA/132","comment_is_top":false,"comment_ctime":1717235756,"is_pvip":false,"replies":[{"id":142236,"content":"æ²¡å¼€æ”¾ã€‚å…¬å¼€å‡ºæ¥çš„åªæœ‰è§£é‡Šå™¨ã€‚è¿™ä¸ªé¡¹ç›®ä½œä¸ºå®ä¹ ç”Ÿé¡¹ç›®åœ¨å…¬å¸å†…éƒ¨ç”¨äºæ”¯æŒæ–°çš„ç¼–ç¨‹è¯­è¨€ï¼Œæœ‰åŠ jitåŠŸèƒ½ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1360512,"ctime":1717437010,"ip_address":"æµ™æ±Ÿ","comment_id":391078,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100761401,"comment_content":"æˆ‘ä»¬çš„pythonè™šæ‹Ÿæœºä¼šåŸºäºjitæ¥å®ç°å—ï¼Ÿæˆ‘ç²—ç•¥çœ‹äº†ä¸€ä¸‹ä»“åº“ä»£ç ï¼Œå¥½åƒæ²¡çœ‹è§æ¬¸","like_count":1,"discussions":[{"author":{"id":1360512,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c2/80/6ebf32e8.jpg","nickname":"æµ·çº³","note":"","ucode":"AB9F7ADB1428D2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":646138,"discussion_content":"æ²¡å¼€æ”¾ã€‚å…¬å¼€å‡ºæ¥çš„åªæœ‰è§£é‡Šå™¨ã€‚è¿™ä¸ªé¡¹ç›®ä½œä¸ºå®ä¹ ç”Ÿé¡¹ç›®åœ¨å…¬å¸å†…éƒ¨ç”¨äºæ”¯æŒæ–°çš„ç¼–ç¨‹è¯­è¨€ï¼Œæœ‰åŠ jitåŠŸèƒ½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1717437010,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":390480,"user_name":"qinsi","can_delete":false,"product_type":"c1","uid":1667175,"ip_address":"ä¸Šæµ·","ucode":"090D9C4068FF12","user_header":"https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg","comment_is_top":false,"comment_ctime":1715421567,"is_pvip":true,"replies":[{"id":142053,"content":"å’¦ï¼Œè¿˜çœŸçš„æœ‰å¯èƒ½å“¦ã€‚jvmé‡Œå¯¹sigsegvçš„actioné‡å†™æ‰äº†ã€‚é‡Œé¢æœ‰å¾ˆå¤šéªšæ“ä½œã€‚å¦‚æœéæ³•è®¿é—®å†…å­˜åªè§¦å‘sigkillï¼Œæˆ‘è§‰å¾—é—®é¢˜ä¸æ­¢è¿™ä¸€ç‚¹å“¦ã€‚ä¸è¿‡å¦‚æœç¡®å®šæ˜¯è¿™ä¸ªåŸå› é‚£å€’ä¹Ÿå¥½ä¿®ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1360512,"ctime":1715562784,"ip_address":"ä¸Šæµ·","comment_id":390480,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100761401,"comment_content":"ä¸¤ä¸ªæœˆå‰å¬è¯´çš„ä¸€ä¸ªä¾‹å­, å…·ä½“ç»†èŠ‚å¯èƒ½ä¸å‡†ç¡®: jvmåšæ€§èƒ½é‡‡æ ·æ—¶å¦‚æœå‘ç°æ£€æŸ¥nullæŒ‡é’ˆçš„æ¬¡æ•°è¾¾åˆ°ä¸€å®šé˜ˆå€¼, å°±ä¼šç”Ÿæˆjitä»£ç , å°è¯•ç›´æ¥è®¿é—®æŒ‡é’ˆå¹¶æ•è·sigsegvä¿¡å·æ¥æ£€æŸ¥nullæŒ‡é’ˆ. ç»“æœmacos 14.4æ­£å¼ç‰ˆå‘å¸ƒçš„æ—¶å€™, å¦‚æœæ˜¯mèŠ¯ç‰‡çš„mac, é‡åˆ°å†…å­˜éæ³•è®¿é—®å°±ç›´æ¥sigkill. äºæ˜¯å°±å‡ºç°äº†macä¸Šçš„javaç¨‹åºéšæœºæ€§å´©æºƒ.","like_count":1,"discussions":[{"author":{"id":1360512,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c2/80/6ebf32e8.jpg","nickname":"æµ·çº³","note":"","ucode":"AB9F7ADB1428D2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":644850,"discussion_content":"å’¦ï¼Œè¿˜çœŸçš„æœ‰å¯èƒ½å“¦ã€‚jvmé‡Œå¯¹sigsegvçš„actioné‡å†™æ‰äº†ã€‚é‡Œé¢æœ‰å¾ˆå¤šéªšæ“ä½œã€‚å¦‚æœéæ³•è®¿é—®å†…å­˜åªè§¦å‘sigkillï¼Œæˆ‘è§‰å¾—é—®é¢˜ä¸æ­¢è¿™ä¸€ç‚¹å“¦ã€‚ä¸è¿‡å¦‚æœç¡®å®šæ˜¯è¿™ä¸ªåŸå› é‚£å€’ä¹Ÿå¥½ä¿®ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1715562784,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":391115,"user_name":"ç»†éœ²ä»”","can_delete":false,"product_type":"c1","uid":2054967,"ip_address":"å¹¿ä¸œ","ucode":"58A586052657A8","user_header":"https://static001.geekbang.org/account/avatar/00/1f/5b/37/aedccd85.jpg","comment_is_top":false,"comment_ctime":1717377522,"is_pvip":false,"replies":[{"id":142239,"content":"è£…é¥°å™¨å¯ä»¥æŠŠä¸€ä¸ªå‡½æ•°çš„å­—èŠ‚ç æ‹¿å‡ºæ¥ï¼Œç„¶åæŠŠå­—èŠ‚ç è½¬æˆllvm irï¼Œäº¤ç»™llvmçš„jitç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œã€‚å› ä¸ºè§£é‡Šå™¨çš„å®ç°æ€§èƒ½è¿‡äºæ‹‰å®ï¼Œæ‰€ä»¥ä¸€ç‚¹ç‚¹ç¼–è¯‘æå‡å°±å¾ˆæ˜æ˜¾ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1360512,"ctime":1717437183,"ip_address":"æµ™æ±Ÿ","comment_id":391115,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100761401,"comment_content":"è€å¸ˆæ‚¨å¥½ã€‚ä¹‹å‰ç»å¸¸çœ‹åˆ°ä¸€äº›æ–‡ç« è¯´ä»€ä¹ˆä¸¤è¡Œä»£ç åŠ é€Ÿpythonã€‚ç„¶åç‚¹è¿›å»å…¨æ˜¯è¯´çš„ç”¨numba.njitè£…é¥°ä¸€ä¸‹å°±è¡Œäº†ã€‚ä½†æ˜¯è¿™ç§æ–‡ç« é‡Œéƒ½æ²¡æœ‰ä»‹ç»åŸç†æ˜¯å•¥ã€‚æˆ‘å°è±¡ä¸­py3.13å®˜æ–¹è‡ªå·±ä»è§£é‡Šå™¨çš„å±‚é¢å®ç°äº†jitè¿™ä¸ªåŠŸèƒ½ï¼Œé‚£è¯·é—®numba.njitæ˜¯æ€ä¹ˆé€šè¿‡åªæ”¹pythonä»£ç å°±åšåˆ°äº†å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1360512,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c2/80/6ebf32e8.jpg","nickname":"æµ·çº³","note":"","ucode":"AB9F7ADB1428D2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":646141,"discussion_content":"è£…é¥°å™¨å¯ä»¥æŠŠä¸€ä¸ªå‡½æ•°çš„å­—èŠ‚ç æ‹¿å‡ºæ¥ï¼Œç„¶åæŠŠå­—èŠ‚ç è½¬æˆllvm irï¼Œäº¤ç»™llvmçš„jitç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œã€‚å› ä¸ºè§£é‡Šå™¨çš„å®ç°æ€§èƒ½è¿‡äºæ‹‰å®ï¼Œæ‰€ä»¥ä¸€ç‚¹ç‚¹ç¼–è¯‘æå‡å°±å¾ˆæ˜æ˜¾ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1717437183,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":390525,"user_name":"buckwheat","can_delete":false,"product_type":"c1","uid":1466067,"ip_address":"åŒ—äº¬","ucode":"3FE4251F6BD2B9","user_header":"https://static001.geekbang.org/account/avatar/00/16/5e/d3/e4d2ae68.jpg","comment_is_top":false,"comment_ctime":1715566441,"is_pvip":false,"replies":[{"id":142058,"content":"æ–‡ç« é‡Œå…¶å®æ”¾äº†è¶…é“¾æ¥äº†ï¼Œå¯èƒ½ä¸å¤ªæ˜æ˜¾:( ä»£ç åœ¨è¿™é‡Œï¼šhttps:&#47;&#47;gitee.com&#47;hinus&#47;pythonvm&#47;tree&#47;geektime&#47;ã€‚è®°å¾—åŠ å…¥å¾®ä¿¡ç¾¤ï¼Œè·å–æœ€åŠæ—¶çš„ç›´æ¥ç­”ç–‘ä¿¡æ¯ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1360512,"ctime":1715613163,"ip_address":"æµ™æ±Ÿ","comment_id":390525,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100761401,"comment_content":"è€å¸ˆï¼Œæœ‰å®ç°çš„æºç å¯ä¾›å‚è€ƒå—","like_count":0,"discussions":[{"author":{"id":1360512,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c2/80/6ebf32e8.jpg","nickname":"æµ·çº³","note":"","ucode":"AB9F7ADB1428D2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":644932,"discussion_content":"æ–‡ç« é‡Œå…¶å®æ”¾äº†è¶…é“¾æ¥äº†ï¼Œå¯èƒ½ä¸å¤ªæ˜æ˜¾:( ä»£ç åœ¨è¿™é‡Œï¼šhttps://gitee.com/hinus/pythonvm/tree/geektime/ã€‚è®°å¾—åŠ å…¥å¾®ä¿¡ç¾¤ï¼Œè·å–æœ€åŠæ—¶çš„ç›´æ¥ç­”ç–‘ä¿¡æ¯ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1715613163,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":390467,"user_name":"qinsi","can_delete":false,"product_type":"c1","uid":1667175,"ip_address":"ä¸Šæµ·","ucode":"090D9C4068FF12","user_header":"https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg","comment_is_top":false,"comment_ctime":1715400522,"is_pvip":true,"replies":[{"id":142050,"content":"å¯¹ï¼Œæ˜¯çš„ã€‚è¿™é‡Œåº”è¯¥ç”¨sizeofï¼Œè¿™æ ·ä¸¥æ ¼ä¸€äº›ã€‚ä¸è¿‡ç¤ºä¾‹ä»£ç ï¼Œç®€æ´ä¸ºä¸»ã€‚å“ˆå“ˆã€‚åé¢è¯¾ç¨‹é‡Œçš„ç›¸å¯¹ä¸¥è°¨ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1360512,"ctime":1715562426,"ip_address":"ä¸Šæµ·","comment_id":390467,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100761401,"comment_content":"ä¼¼ä¹æœ‰ç‚¹å°é—®é¢˜. save_const_valueæ—¶ç”¨äº†åŸç”Ÿç±»å‹çš„å­—é•¿, è€Œè§£é‡Šå™¨å‡è®¾intéƒ½æ˜¯32ä½çš„, è·Ÿå®é™…ç¯å¢ƒä¸ä¸€è‡´çš„è¯å°±ä¼šå‡ºé”™","like_count":0,"discussions":[{"author":{"id":1360512,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c2/80/6ebf32e8.jpg","nickname":"æµ·çº³","note":"","ucode":"AB9F7ADB1428D2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":644845,"discussion_content":"å¯¹ï¼Œæ˜¯çš„ã€‚è¿™é‡Œåº”è¯¥ç”¨sizeofï¼Œè¿™æ ·ä¸¥æ ¼ä¸€äº›ã€‚ä¸è¿‡ç¤ºä¾‹ä»£ç ï¼Œç®€æ´ä¸ºä¸»ã€‚å“ˆå“ˆã€‚åé¢è¯¾ç¨‹é‡Œçš„ç›¸å¯¹ä¸¥è°¨ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1715562426,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":390408,"user_name":"Geek_0050d6","can_delete":false,"product_type":"c1","uid":2977200,"ip_address":"åŒ—äº¬","ucode":"53604AAE9F9360","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM7HqgKaE3eRjGriciaUKcSPfG0xYgX6Ikp4CpAsM51icpbvlW8Og2P0ibGCazIdTcjone1axxPCymuJWQ/132","comment_is_top":false,"comment_ctime":1715281848,"is_pvip":false,"replies":[{"id":142018,"content":"æœ‰å›æ”¾ï¼Œä¸è¿‡å»ºè®®è¿˜æ˜¯ç°åœºå¬ï¼Œæ¯”è¾ƒæœ‰æ„æ€","user_name":"ç¼–è¾‘å›å¤","user_name_real":"ç¼–è¾‘","uid":2843479,"ctime":1715305410,"ip_address":"åŒ—äº¬","comment_id":390408,"utype":2}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100761401,"comment_content":"ç›´æ’­è¯¾ğŸˆ¶å›æ”¾å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2843479,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/63/57/cba4c68b.jpg","nickname":"å°è™å­ğŸ¯","note":"","ucode":"4C9530B3FB407B","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":644523,"discussion_content":"æœ‰å›æ”¾ï¼Œä¸è¿‡å»ºè®®è¿˜æ˜¯ç°åœºå¬ï¼Œæ¯”è¾ƒæœ‰æ„æ€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1715305410,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":8,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":390399,"user_name":"æ—å…ˆæ£®","can_delete":false,"product_type":"c1","uid":1130951,"ip_address":"æµ™æ±Ÿ","ucode":"A25699D1A768B4","user_header":"https://static001.geekbang.org/account/avatar/00/11/41/c7/3aead12b.jpg","comment_is_top":false,"comment_ctime":1715256897,"is_pvip":false,"replies":[{"id":142006,"content":"luaè™šæ‹Ÿæœºæ˜¯æœºé‡å¯„å­˜å™¨çš„ã€‚å…¶å®æ ¸å¿ƒæ€æƒ³å¾ˆç®€å•ï¼šç”¨å˜é‡è¡¨ç¤ºå¯„å­˜å™¨å°±å¯ä»¥äº†ã€‚å¯ä»¥åŠ å¾®ä¿¡ç¾¤ï¼Œäº†è§£å³æ—¶çš„ç›´æ’­ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ç›´æ’­è¯¾é‡Œå»è®²è§£ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1360512,"ctime":1715259221,"ip_address":"ä¸Šæµ·","comment_id":390399,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100761401,"comment_content":"è€å¸ˆå¥½ï¼Œæ‚¨çš„ä¾‹å­ä¸­æ˜¯æŒ‰ç…§åŸºäºæ ˆçš„æ–¹å¼æ¥å®ç°è™šæ‹Ÿæœºæ‰§è¡Œå­—èŠ‚ç çš„ï¼Œèƒ½è®²è®²åŸºäºå¯„å­˜å™¨çš„è™šæ‹Ÿæœºæ˜¯å¦‚ä½•æ‰§è¡Œå­—èŠ‚ç çš„å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1360512,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c2/80/6ebf32e8.jpg","nickname":"æµ·çº³","note":"","ucode":"AB9F7ADB1428D2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":644459,"discussion_content":"luaè™šæ‹Ÿæœºæ˜¯æœºé‡å¯„å­˜å™¨çš„ã€‚å…¶å®æ ¸å¿ƒæ€æƒ³å¾ˆç®€å•ï¼šç”¨å˜é‡è¡¨ç¤ºå¯„å­˜å™¨å°±å¯ä»¥äº†ã€‚å¯ä»¥åŠ å¾®ä¿¡ç¾¤ï¼Œäº†è§£å³æ—¶çš„ç›´æ’­ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ç›´æ’­è¯¾é‡Œå»è®²è§£ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1715259221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":395062,"user_name":"ifelse","can_delete":false,"product_type":"c1","uid":2550743,"ip_address":"æµ™æ±Ÿ","ucode":"D0565908C99695","user_header":"https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg","comment_is_top":false,"comment_ctime":1729223907,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":3,"score":2,"product_id":100761401,"comment_content":"å­¦ä¹ æ‰“å¡ï¼Œéå¸¸ä¸æˆ³","like_count":0}]}