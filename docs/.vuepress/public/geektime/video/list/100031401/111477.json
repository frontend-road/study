{"id":111477,"title":"34 | 安全认证架构演进：单块阶段（下）","content":"<ul>\n<li>\n<p>代码：<a href=\"https://gitee.com/geektime-geekbang/staffjoy\">https://gitee.com/geektime-geekbang/staffjoy</a></p>\n</li>\n<li>\n<p>课件：<a href=\"https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ\">https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ</a> 提取码: 1aeh</p>\n</li>\n</ul>","comments":[{"had_liked":false,"id":119469,"user_name":"飞翔","can_delete":false,"product_type":"c3","uid":1068571,"ip_address":"","ucode":"65AF6AF292DAD6","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/1b/f4b786b9.jpg","comment_is_top":false,"comment_ctime":1564611078,"is_pvip":false,"replies":[{"id":43919,"content":"这个叫会话Session劫持，理论上黑客是可以做到的，实践中对于安全敏感的网站一般需要考虑防范会话劫持，例如启用https防止传输层泄漏，cookie设置httponly防止xss攻击，服务器端跟踪客户登录设备ip等手段。可以参考这个帖子：https:&#47;&#47;bbs.csdn.net&#47;topics&#47;391057791?page=1","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1564672850,"ip_address":"","comment_id":119469,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"老师 求教 呢就是我要是拦截得到了对方的sessionid 我就可以发请求带上sessionid 就获得了别人的登陆过的页面了嘛？","like_count":4,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460916,"discussion_content":"这个叫会话Session劫持，理论上黑客是可以做到的，实践中对于安全敏感的网站一般需要考虑防范会话劫持，例如启用https防止传输层泄漏，cookie设置httponly防止xss攻击，服务器端跟踪客户登录设备ip等手段。可以参考这个帖子：https://bbs.csdn.net/topics/391057791?page=1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564672850,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":120455,"user_name":"sayid","can_delete":false,"product_type":"c3","uid":1101465,"ip_address":"","ucode":"E40E0D86768DCA","user_header":"https://static001.geekbang.org/account/avatar/00/10/ce/99/4382727b.jpg","comment_is_top":false,"comment_ctime":1564905347,"is_pvip":false,"replies":[{"id":44347,"content":"对，很多公司集中会话数据放redis缓存，注意监控+按需扩容。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1565003596,"ip_address":"","comment_id":120455,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"我司是：放在redis中集中式会话管理。","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461340,"discussion_content":"对，很多公司集中会话数据放redis缓存，注意监控+按需扩容。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565003596,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":171316,"user_name":"ella","can_delete":false,"product_type":"c3","uid":1449133,"ip_address":"","ucode":"D7DD3CCA5FECDB","user_header":"https://static001.geekbang.org/account/avatar/00/16/1c/ad/27c7dae0.jpg","comment_is_top":false,"comment_ctime":1578901064,"is_pvip":false,"replies":[{"id":66439,"content":"session数据可以集中存数据库，也是集中式session的一种实现方式，这样可以不再用sticky session。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1578917269,"ip_address":"","comment_id":171316,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"如果session id从数据库中读取，是不是可以不用设置stricky","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481294,"discussion_content":"session数据可以集中存数据库，也是集中式session的一种实现方式，这样可以不再用sticky session。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578917269,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":228903,"user_name":"ethan","can_delete":false,"product_type":"c3","uid":1066229,"ip_address":"","ucode":"DA70975A40ABE2","user_header":"https://static001.geekbang.org/account/avatar/00/10/44/f5/486d696c.jpg","comment_is_top":false,"comment_ctime":1592836316,"is_pvip":false,"replies":[{"id":84564,"content":"粘性会话和一致性哈希是两码事，但是分布式会话技术可以采用一致性哈希来实现。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1592930649,"ip_address":"","comment_id":228903,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"粘性回话不是通过一致性哈希实现吗？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499244,"discussion_content":"粘性会话和一致性哈希是两码事，但是分布式会话技术可以采用一致性哈希来实现。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592930649,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":121252,"user_name":"而立斋","can_delete":false,"product_type":"c3","uid":1087258,"ip_address":"","ucode":"5FED6E9E148195","user_header":"https://static001.geekbang.org/account/avatar/00/10/97/1a/389eab84.jpg","comment_is_top":false,"comment_ctime":1565087026,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"v1:客户端cookie保存sesionid,服务端保存session。存在问题，多节点session不共享\n\nv1.1 解决上述问题，session粘性会话，负载均衡服务器实现。会话期间，用户请求个某台服务器绑定\n\nv1.5粘性会话带来的问题:稳定性问题(升级，宕机会丢失一波会话)，拓展性(有状态架构，难易拓展)\n\n(会话同步复制-复杂性升高、无状态-会话存在客户端有泄密风险，大小限制、集中状态会话-高性能缓存redis-易拓展、高性能)\n","like_count":9},{"had_liked":false,"id":188726,"user_name":"钱","can_delete":false,"product_type":"c3","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1584408883,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"单服务器的情况下保持用户登录状态信息通过cookie和session就可以做到，不过如果后端服务器是集群架构，由于session仅存在一台服务器上，这种方式就失灵了。\n解决这种方式的方案依次如下：\n1：粘性回话——将请求打到有session的服务器上\n2：状态同步——解决粘性回话服务器不可用的状况\n3：无状态回话——用户状态仅存储在浏览器端\n4：集中状态回话——用户状态集中存储在缓存页","like_count":3,"discussions":[{"author":{"id":1339724,"avatar":"https://static001.geekbang.org/account/avatar/00/14/71/4c/2cefec07.jpg","nickname":"静水流深","note":"","ucode":"644F05EFBD2E7B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301895,"discussion_content":"每章都会看到老兄有高质量的评论，给你点个赞。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598702499,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":119243,"user_name":"虎哥","can_delete":false,"product_type":"c3","uid":1185061,"ip_address":"","ucode":"29D604EC85D3BC","user_header":"https://static001.geekbang.org/account/avatar/00/12/15/25/1d3d616f.jpg","comment_is_top":false,"comment_ctime":1564542493,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"集中状态会话，无状态会话","like_count":1}]}