{"id":131826,"title":"19 | æ•°æ®å‹ç¼©ï¼šæ—¶é—´æ¢ç©ºé—´çš„æ¸¸æˆ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æç¥ã€‚</p><p>è¿™èŠ‚è¯¾æˆ‘ä»¬ä¸€èµ·æ¥èŠä¸€èŠæ•°æ®å‹ç¼©ã€‚æˆ‘åœ¨å‰é¢æ–‡ç« ä¸­æåˆ°è¿‡ï¼Œæˆ‘æ›¾ç»åœ¨ä¸€å°é…ç½®æ¯”è¾ƒé«˜çš„æœåŠ¡å™¨ä¸Šï¼Œå¯¹Kafkaåšè¿‡ä¸€ä¸ªæé™çš„æ€§èƒ½å‹æµ‹ï¼Œæƒ³éªŒè¯ä¸€ä¸‹Kafkaåˆ°åº•æœ‰å¤šå¿«ã€‚æˆ‘ä½¿ç”¨çš„ç§å­æ¶ˆæ¯å¤§å°ä¸º1KBï¼Œåªè¦æ˜¯å¹¶å‘æ•°é‡è¶³å¤Ÿå¤šï¼Œä¸å¼€å¯å‹ç¼©æ—¶ï¼Œå¯ä»¥æ‰“æ»¡ä¸‡å…†ç½‘å¡çš„å…¨éƒ¨å¸¦å®½ï¼ŒTPSæ¥è¿‘100ä¸‡ã€‚å¼€å¯å‹ç¼©æ—¶ï¼ŒTPSå¯ä»¥è¾¾åˆ°2000ä¸‡å·¦å³ï¼Œååé‡æå‡äº†å¤§çº¦20å€ï¼</p><p>ç®—æœ¯å¥½çš„åŒå­¦å¯èƒ½ä¼šç«‹åˆ»åé©³æˆ‘è¯´ï¼Œ2000ä¸‡TPSä¹˜ä»¥1KBçš„æ¶ˆæ¯å¤§å°ï¼Œå†æŠŠå­—èŠ‚Byteè½¬æ¢æˆæ¯”ç‰¹bitï¼Œæ¢ç®—æˆç½‘ç»œä¼ è¾“çš„å¸¦å®½æ˜¯200Gb/sï¼ŒæœåŠ¡å™¨ç½‘å¡æ ¹æœ¬è¾¾ä¸åˆ°è¿™ä¹ˆå¤§çš„ä¼ è¾“å¸¦å®½ï¼</p><p>æˆ‘ä»¬çš„æµ‹è¯•æœåŠ¡å™¨çš„ç½‘å¡å°±æ˜¯æ™®é€šçš„ä¸‡å…†ç½‘å¡ï¼Œæé™å¸¦å®½ä¹Ÿå°±æ˜¯10Gb/sï¼Œå‹æµ‹æ—¶å€™çš„å®é™…ç½‘ç»œæµé‡å¤§æ¦‚åœ¨7Gb/så·¦å³ã€‚è¿™é‡Œé¢ï¼Œæœ€é‡è¦çš„åŸå› å°±æ˜¯ï¼Œæˆ‘åœ¨æµ‹è¯•çš„æ—¶å€™å¼€å¯äº†Kafkaçš„å‹ç¼©åŠŸèƒ½ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºKafkaæ¥è¯´ï¼Œä½¿ç”¨æ•°æ®å‹ç¼©ï¼Œæå‡äº†å¤§æ¦‚å‡ åå€çš„ååé‡ã€‚å½“ç„¶ï¼Œåœ¨å®é™…ç”Ÿäº§æ—¶ï¼Œä¸å¤ªå¯èƒ½è¾¾åˆ°è¿™ä¹ˆé«˜çš„å‹ç¼©ç‡ï¼Œä½†æ˜¯åˆç†åœ°ä½¿ç”¨æ•°æ®å‹ç¼©ï¼Œä»ç„¶å¯ä»¥åšåˆ°æå‡æ•°å€çš„ååé‡ã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>æ•°æ®å‹ç¼©ä¸ä»…èƒ½èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œè¿˜å¯ä»¥ç”¨äºæå‡ç½‘ç»œä¼ è¾“æ€§èƒ½ã€‚</strong>è¿™ç§ä½¿ç”¨å‹ç¼©æ¥æå‡ç³»ç»Ÿæ€§èƒ½çš„æ–¹æ³•ï¼Œä¸ä»…é™äºåœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ä½¿ç”¨ï¼Œæˆ‘ä»¬æ—¥å¸¸å¼€å‘çš„åº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬çš„ç¨‹åºè¦ä¼ è¾“å¤§é‡çš„æ•°æ®ï¼Œæˆ–è€…è¦åœ¨ç£ç›˜ã€æ•°æ®åº“ä¸­å­˜å‚¨æ¯”è¾ƒå¤§çš„æ•°æ®ï¼Œè¿™äº›æƒ…å†µä¸‹ï¼Œéƒ½å¯ä»¥è€ƒè™‘ä½¿ç”¨æ•°æ®å‹ç¼©æ¥æå‡æ€§èƒ½ï¼Œè¿˜èƒ½èŠ‚çœç½‘ç»œå¸¦å®½å’Œå­˜å‚¨ç©ºé—´ã€‚</p><!-- [[[read_end]]] --><p>é‚£å¦‚ä½•åœ¨ä½ çš„ç¨‹åºä¸­ä½¿ç”¨å‹ç¼©ï¼Ÿåº”è¯¥é€‰æ‹©ä»€ä¹ˆæ ·çš„å‹ç¼©ç®—æ³•æ›´é€‚åˆæˆ‘ä»¬çš„ç³»ç»Ÿå‘¢ï¼Ÿè¿™èŠ‚è¯¾ï¼Œæˆ‘å¸¦ä½ ä¸€èµ·å­¦ä¹ ä¸€ä¸‹ï¼Œä½¿ç”¨æ•°æ®å‹ç¼©æ¥æå‡ç³»ç»Ÿæ€§èƒ½çš„æ–¹æ³•ã€‚</p><h2>ä»€ä¹ˆæƒ…å†µé€‚åˆä½¿ç”¨æ•°æ®å‹ç¼©ï¼Ÿ</h2><p>åœ¨ä½¿ç”¨å‹ç¼©ä¹‹å‰ï¼Œé¦–å…ˆä½ éœ€è¦è€ƒè™‘ï¼Œå½“å‰è¿™ä¸ªåœºæ™¯æ˜¯ä¸æ˜¯çœŸçš„é€‚åˆä½¿ç”¨æ•°æ®å‹ç¼©ã€‚</p><p>æ¯”å¦‚ï¼Œè¿›ç¨‹ä¹‹é—´é€šè¿‡ç½‘ç»œä¼ è¾“æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®æ˜¯ä¸æ˜¯éœ€è¦å‹ç¼©å‘¢ï¼Ÿæˆ‘å’Œä½ ä¸€èµ·æ¥å¯¹æ¯”ä¸€ä¸‹ï¼š</p><ul>\n<li>ä¸å‹ç¼©ç›´æ¥ä¼ è¾“éœ€è¦çš„æ—¶é—´æ˜¯ï¼š ä¼ è¾“<strong>æœªå‹ç¼©</strong>æ•°æ®çš„è€—æ—¶ã€‚</li>\n<li>ä½¿ç”¨æ•°æ®å‹ç¼©éœ€è¦çš„æ—¶é—´æ˜¯ï¼š å‹ç¼©è€—æ—¶ + ä¼ è¾“<strong>å‹ç¼©</strong>æ•°æ®è€—æ—¶ + è§£å‹è€—æ—¶ã€‚</li>\n</ul><p>åˆ°åº•æ˜¯å‹ç¼©å¿«ï¼Œè¿˜æ˜¯ä¸å‹ç¼©å¿«å‘¢ï¼Ÿå…¶å®ä¸å¥½è¯´ã€‚å½±å“çš„å› ç´ éå¸¸å¤šï¼Œæ¯”å¦‚æ•°æ®çš„å‹ç¼©ç‡ã€ç½‘ç»œå¸¦å®½ã€æ”¶å‘ä¸¤ç«¯æœåŠ¡å™¨çš„ç¹å¿™ç¨‹åº¦ç­‰ç­‰ã€‚</p><p>å‹ç¼©å’Œè§£å‹çš„æ“ä½œéƒ½æ˜¯è®¡ç®—å¯†é›†å‹çš„æ“ä½œï¼Œéå¸¸è€—è´¹CPUèµ„æºã€‚å¦‚æœä½ çš„åº”ç”¨å¤„ç†ä¸šåŠ¡é€»è¾‘å°±éœ€è¦è€—è´¹å¤§é‡çš„CPUèµ„æºï¼Œå°±ä¸å¤ªé€‚åˆå†è¿›è¡Œå‹ç¼©å’Œè§£å‹ã€‚</p><p>åˆæ¯”å¦‚è¯´ï¼Œå¦‚æœä½ çš„ç³»ç»Ÿçš„ç“¶é¢ˆæ˜¯ç£ç›˜çš„IOæ€§èƒ½ï¼ŒCPUèµ„æºåˆå¾ˆé—²ï¼Œè¿™ç§æƒ…å†µå°±éå¸¸é€‚åˆåœ¨æŠŠæ•°æ®å†™å…¥ç£ç›˜å‰å…ˆè¿›è¡Œå‹ç¼©ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœä½ çš„ç³»ç»Ÿè¯»å†™æ¯”ä¸¥é‡ä¸å‡è¡¡ï¼Œä½ è¿˜è¦è€ƒè™‘ï¼Œæ¯è¯»ä¸€æ¬¡æ•°æ®å°±è¦è§£å‹ä¸€æ¬¡æ˜¯ä¸æ˜¯åˆ’ç®—ã€‚</p><p><strong>å‹ç¼©å®ƒçš„æœ¬è´¨æ˜¯èµ„æºçš„ç½®æ¢ï¼Œæ˜¯ä¸€ä¸ªæ—¶é—´æ¢ç©ºé—´ï¼Œæˆ–è€…è¯´æ˜¯CPUèµ„æºæ¢å­˜å‚¨èµ„æºçš„æ¸¸æˆã€‚</strong></p><p>å°±åƒæœ¨æ¡¶çš„é‚£ä¸ªçŸ­æ¿ä¸€æ ·ï¼Œæ¯ä¸€ä¸ªç³»ç»Ÿå®ƒéƒ½æœ‰ä¸€ä¸ªæ€§èƒ½ç“¶é¢ˆèµ„æºï¼Œå¯èƒ½æ˜¯ç£ç›˜IOï¼Œç½‘ç»œå¸¦å®½ï¼Œä¹Ÿå¯èƒ½æ˜¯CPUã€‚å¦‚æœä½¿ç”¨å‹ç¼©ï¼Œèƒ½ç”¨é•¿æ¿æ¥æ¢ä¸€äº›çŸ­æ¿ï¼Œé‚£æ€»ä½“ä¸Šå°±èƒ½æå‡æ€§èƒ½ï¼Œè¿™æ ·å°±æ˜¯åˆ’ç®—çš„ã€‚å¦‚æœç”¨äº†å‹ç¼©ä¹‹åï¼ŒçŸ­æ¿æ›´çŸ­äº†ï¼Œé‚£å°±ä¸åˆ’ç®—äº†ï¼Œä¸å¦‚ä¸ç”¨ã€‚</p><p>å¦‚æœé€šè¿‡æƒè¡¡ï¼Œä½¿ç”¨æ•°æ®å‹ç¼©ç¡®å®å¯ä»¥æå‡ç³»ç»Ÿçš„æ€§èƒ½ï¼Œæ¥ä¸‹æ¥å°±éœ€è¦é€‰æ‹©åˆé€‚çš„å‹ç¼©ç®—æ³•ã€‚</p><h2>åº”è¯¥é€‰æ‹©ä»€ä¹ˆå‹ç¼©ç®—æ³•ï¼Ÿ</h2><p>å‹ç¼©ç®—æ³•å¯ä»¥åˆ†ä¸ºæœ‰æŸå‹ç¼©å’Œæ— æŸå‹ç¼©ã€‚æœ‰æŸå‹ç¼©ä¸»è¦æ˜¯ç”¨æ¥å‹ç¼©éŸ³è§†é¢‘ï¼Œå®ƒå‹ç¼©ä¹‹åæ˜¯ä¼šä¸¢å¤±ä¿¡æ¯çš„ã€‚æˆ‘ä»¬è¿™é‡Œè®¨è®ºçš„å…¨éƒ½æ˜¯æ— æŸå‹ç¼©ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®ç»è¿‡å‹ç¼©å’Œè§£å‹è¿‡ç¨‹ä¹‹åï¼Œä¸å‹ç¼©ä¹‹å‰ç›¸æ¯”ï¼Œæ˜¯100%ç›¸åŒçš„ã€‚</p><p>æ•°æ®ä¸ºä»€ä¹ˆå¯ä»¥è¢«å‹ç¼©å‘¢ï¼Ÿå„ç§å„æ ·çš„å‹ç¼©ç®—æ³•åˆæ˜¯æ€ä¹ˆå»å‹ç¼©æ•°æ®çš„å‘¢ï¼Ÿæˆ‘ä¸¾ä¸ªä¾‹å­æ¥ç®€å•è¯´æ˜ä¸€ä¸‹ã€‚</p><p>æ¯”å¦‚è¯´ï¼Œä¸‹é¢è¿™æ®µæ•°æ®ï¼š</p><blockquote>\n<p>00000000000000000000</p>\n</blockquote><p>æˆ‘æ¥ç»™ä½ äººè‚‰å‹ç¼©ä¸€ä¸‹ï¼š</p><blockquote>\n<p>20ä¸ª0</p>\n</blockquote><p>20ä¸ªå­—ç¬¦å°±è¢«å‹ç¼©æˆäº†4ä¸ªå­—ç¬¦ï¼Œå¹¶ä¸”æ˜¯å¯ä»¥æ— æŸè¿˜åŸçš„ã€‚å½“ç„¶ï¼Œæˆ‘ä¸¾çš„ä¾‹å­æ¯”è¾ƒæç«¯ï¼Œæˆ‘çš„å‹ç¼©ç®—æ³•ä¹Ÿå‡ ä¹æ²¡ä»€ä¹ˆå®ç”¨æ€§ï¼Œä½†æ˜¯ï¼Œè¿™ç¡®å®æ˜¯ä¸€ä¸ªå‹ç¼©ç®—æ³•ï¼Œå¹¶ä¸”å’Œå…¶ä»–çš„å‹ç¼©ç®—æ³•æœ¬è´¨æ˜¯æ²¡ä»€ä¹ˆåŒºåˆ«çš„ã€‚</p><p>ç›®å‰å¸¸ç”¨çš„å‹ç¼©ç®—æ³•åŒ…æ‹¬ï¼šZIPï¼ŒGZIPï¼ŒSNAPPYï¼ŒLZ4ç­‰ç­‰ã€‚é€‰æ‹©å‹ç¼©ç®—æ³•çš„æ—¶å€™ï¼Œä¸»è¦éœ€è¦è€ƒè™‘æ•°æ®çš„å‹ç¼©ç‡å’Œå‹ç¼©è€—æ—¶ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå‹ç¼©ç‡è¶Šé«˜çš„ç®—æ³•ï¼Œå‹ç¼©è€—æ—¶ä¹Ÿè¶Šé«˜ã€‚å¦‚æœæ˜¯å¯¹æ€§èƒ½è¦æ±‚é«˜çš„ç³»ç»Ÿï¼Œå¯ä»¥é€‰æ‹©å‹ç¼©é€Ÿåº¦å¿«çš„ç®—æ³•ï¼Œæ¯”å¦‚LZ4ï¼›å¦‚æœéœ€è¦æ›´é«˜çš„å‹ç¼©æ¯”ï¼Œå¯ä»¥è€ƒè™‘GZIPæˆ–è€…å‹ç¼©ç‡æ›´é«˜çš„XZç­‰ç®—æ³•ã€‚</p><p>å‹ç¼©æ ·æœ¬å¯¹å‹ç¼©é€Ÿåº¦å’Œå‹ç¼©æ¯”çš„å½±å“ä¹Ÿæ˜¯æ¯”è¾ƒå¤§çš„ï¼ŒåŒæ ·å¤§å°çš„ä¸€æ®µæ•°å­—å’Œä¸€æ®µæ–°é—»çš„æ–‡æœ¬ï¼Œå³ä½¿æ˜¯ä½¿ç”¨ç›¸åŒçš„å‹ç¼©ç®—æ³•ï¼Œå‹ç¼©ç‡å’Œå‹ç¼©æ—¶é—´çš„å·®å¼‚ä¹Ÿæ˜¯æ¯”è¾ƒå¤§çš„ã€‚æ‰€ä»¥ï¼Œæœ‰çš„æ—¶å€™åœ¨é€‰æ‹©å‹ç¼©ç®—æ³•çš„ä¹‹å‰ï¼Œç”¨ç³»ç»Ÿçš„æ ·ä¾‹ä¸šåŠ¡æ•°æ®åšä¸€ä¸ªæµ‹è¯•ï¼Œå¯ä»¥å¸®åŠ©ä½ æ‰¾åˆ°æœ€åˆé€‚çš„å‹ç¼©ç®—æ³•ã€‚</p><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä¸ä¼šå»ç»™ä½ è®²æŸä¸€ç§å‹ç¼©ç®—æ³•ï¼Œå› ä¸ºå‹ç¼©ç®—æ³•éƒ½å¾ˆå¤æ‚ï¼Œä¸€èˆ¬æ¥è¯´ä¹Ÿä¸éœ€è¦æˆ‘ä»¬æ¥å®ç°æŸç§å‹ç¼©ç®—æ³•ï¼Œå¦‚æœä½ æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥å»å­¦ä¹ ä¸€ä¸‹æœ€ç»å…¸å‹ç¼©ç®—æ³•ï¼šå“ˆå¤«æ›¼ç¼–ç ï¼ˆä¹Ÿå«éœå¤«æ›¼ç¼–ç ï¼ŒHuffman Codingï¼‰ã€‚</p><h2>å¦‚ä½•é€‰æ‹©åˆé€‚çš„å‹ç¼©åˆ†æ®µï¼Ÿ</h2><p>å¤§éƒ¨åˆ†çš„å‹ç¼©ç®—æ³•ï¼Œä»–ä»¬çš„åŒºåˆ«ä¸»è¦æ˜¯ï¼Œå¯¹æ•°æ®è¿›è¡Œç¼–ç çš„ç®—æ³•ï¼Œå‹ç¼©çš„æµç¨‹å’Œå‹ç¼©åŒ…çš„ç»“æ„å¤§è‡´ä¸€æ ·çš„ã€‚è€Œåœ¨å‹ç¼©è¿‡ç¨‹ä¸­ï¼Œä½ æœ€éœ€è¦äº†è§£çš„å°±æ˜¯å¦‚ä½•é€‰æ‹©åˆé€‚çš„å‹ç¼©åˆ†æ®µå¤§å°ã€‚</p><p>åœ¨å‹ç¼©æ—¶ï¼Œç»™å®šçš„è¢«å‹ç¼©æ•°æ®å®ƒå¿…é¡»æœ‰ç¡®å®šçš„é•¿åº¦ï¼Œæˆ–è€…è¯´ï¼Œæ˜¯æœ‰å¤´æœ‰å°¾çš„ï¼Œä¸èƒ½æ˜¯ä¸€ä¸ªæ— é™çš„æ•°æ®æµï¼Œ<strong>å¦‚æœè¦å¯¹æµæ•°æ®è¿›è¡Œå‹ç¼©ï¼Œé‚£å¿…é¡»æŠŠæµæ•°æ®åˆ’åˆ†æˆå¤šä¸ªå¸§ï¼Œä¸€å¸§ä¸€å¸§çš„åˆ†æ®µå‹ç¼©ã€‚</strong></p><p>ä¸»è¦åŸå› æ˜¯ï¼Œå‹ç¼©ç®—æ³•åœ¨å¼€å§‹å‹ç¼©ä¹‹å‰ï¼Œä¸€èˆ¬éƒ½éœ€è¦å¯¹è¢«å‹ç¼©æ•°æ®ä»å¤´åˆ°å°¾è¿›è¡Œä¸€æ¬¡æ‰«æï¼Œæ‰«æçš„ç›®çš„æ˜¯ç¡®å®šå¦‚ä½•å¯¹æ•°æ®è¿›è¡Œåˆ’åˆ†å’Œç¼–ç ï¼Œä¸€èˆ¬çš„åŸåˆ™æ˜¯é‡å¤æ¬¡æ•°å¤šã€å ç”¨ç©ºé—´å¤§çš„å†…å®¹ï¼Œä½¿ç”¨å°½é‡çŸ­çš„ç¼–ç ï¼Œè¿™æ ·å‹ç¼©ç‡ä¼šæ›´é«˜ã€‚</p><p>å¦å¤–ï¼Œè¢«å‹ç¼©çš„æ•°æ®é•¿åº¦è¶Šå¤§ï¼Œé‡ç ç‡ä¼šæ›´é«˜ï¼Œå‹ç¼©æ¯”ä¹Ÿå°±è¶Šé«˜ã€‚è¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™ç¯‡æ–‡ç« ï¼Œå¯èƒ½å‡ºç°äº†å‡ åæ¬¡â€œå‹ç¼©â€è¿™ä¸ªè¯ï¼Œå¦‚æœå°†æ•´ç¯‡æ–‡ç« å‹ç¼©ï¼Œè¿™ä¸ªè¯çš„é‡å¤ç‡æ˜¯å‡ åæ¬¡ï¼Œä½†å¦‚æœæˆ‘ä»¬æŒ‰ç…§æ¯ä¸ªè‡ªç„¶æ®µæ¥å‹ç¼©ï¼Œé‚£æ¯æ®µä¸­è¿™ä¸ªè¯çš„é‡å¤ç‡åªæœ‰äºŒä¸‰æ¬¡ã€‚æ˜¾ç„¶å…¨æ–‡å‹ç¼©çš„å‹ç¼©ç‡è‚¯å®šé«˜äºåˆ†æ®µå‹ç¼©ã€‚</p><p>å½“ç„¶ï¼Œåˆ†æ®µä¹Ÿä¸æ˜¯è¶Šå¤§è¶Šå¥½ï¼Œå®é™…ä¸Šåˆ†æ®µå¤§å°è¶…è¿‡ä¸€å®šé•¿åº¦ä¹‹åï¼Œå†å¢åŠ é•¿åº¦å¯¹å‹ç¼©ç‡çš„è´¡çŒ®å°±ä¸å¤ªå¤§äº†ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸå› ã€‚å¦å¤–ï¼Œè¿‡å¤§çš„åˆ†æ®µé•¿åº¦ï¼Œåœ¨è§£å‹ç¼©çš„æ—¶å€™ï¼Œä¼šæœ‰æ›´å¤šçš„è§£å‹æµªè´¹ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ª1MBå¤§å°çš„å‹ç¼©æ–‡ä»¶ï¼Œå³ä½¿ä½ åªæ˜¯éœ€è¦è¯»å…¶ä¸­å¾ˆçŸ­çš„å‡ ä¸ªå­—èŠ‚ï¼Œä¹Ÿä¸å¾—ä¸æŠŠæ•´ä¸ªæ–‡ä»¶å…¨éƒ¨è§£å‹ç¼©ï¼Œé€ æˆå¾ˆå¤§çš„è§£å‹æµªè´¹ã€‚</p><p>æ‰€ä»¥ï¼Œä½ éœ€è¦æ ¹æ®ä½ çš„ä¸šåŠ¡ï¼Œé€‰æ‹©åˆé€‚çš„å‹ç¼©åˆ†æ®µï¼Œåœ¨å‹ç¼©ç‡ã€å‹ç¼©é€Ÿåº¦å’Œè§£å‹æµªè´¹ä¹‹é—´æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„å¹³è¡¡ã€‚</p><p>ç¡®å®šäº†å¦‚ä½•å¯¹æ•°æ®è¿›è¡Œåˆ’åˆ†å’Œå‹ç¼©ç®—æ³•ä¹‹åï¼Œå°±å¯ä»¥è¿›è¡Œå‹ç¼©äº†ï¼Œå‹ç¼©çš„è¿‡ç¨‹å°±æ˜¯ç”¨ç¼–ç æ¥æ›¿æ¢åŸå§‹æ•°æ®çš„è¿‡ç¨‹ã€‚å‹ç¼©ä¹‹åçš„å‹ç¼©åŒ…å°±æ˜¯ç”±è¿™ä¸ªç¼–ç å­—å…¸å’Œç”¨ç¼–ç æ›¿æ¢ä¹‹åçš„æ•°æ®ç»„æˆçš„ã€‚</p><p>è¿™å°±æ˜¯æ•°æ®å‹ç¼©çš„è¿‡ç¨‹ã€‚è§£å‹çš„æ—¶å€™ï¼Œå…ˆè¯»å–ç¼–ç å­—å…¸ï¼Œç„¶åæŒ‰ç…§å­—å…¸æŠŠå‹ç¼©ç¼–ç è¿˜åŸæˆåŸå§‹çš„æ•°æ®å°±å¯ä»¥äº†ã€‚</p><h2>Kafkaæ˜¯å¦‚ä½•å¤„ç†æ¶ˆæ¯å‹ç¼©çš„ï¼Ÿ</h2><p>å›è¿‡å¤´æ¥ï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸‹Kafkaå®ƒæ˜¯å¦‚ä½•æ¥å¤„ç†æ•°æ®å‹ç¼©çš„ã€‚</p><p>é¦–å…ˆï¼ŒKafkaæ˜¯å¦å¼€å¯å‹ç¼©ï¼Œè¿™æ˜¯å¯ä»¥é…ç½®ï¼Œå®ƒä¹Ÿæ”¯æŒé…ç½®ä½¿ç”¨å“ªä¸€ç§å‹ç¼©ç®—æ³•ã€‚åŸå› æˆ‘ä»¬åœ¨ä¸Šé¢è¯´è¿‡ï¼Œä¸åŒçš„ä¸šåŠ¡åœºæ™¯æ˜¯å¦éœ€è¦å¼€å¯å‹ç¼©ï¼Œé€‰æ‹©å“ªç§å‹ç¼©ç®—æ³•æ˜¯ä¸èƒ½ä¸€æ¦‚è€Œè®ºçš„ã€‚æ‰€ä»¥ï¼ŒKafkaçš„è®¾è®¡è€…æŠŠè¿™ä¸ªé€‰æ‹©æƒäº¤ç»™ä½¿ç”¨è€…ã€‚</p><p>åœ¨å¼€å¯å‹ç¼©æ—¶ï¼ŒKafkaé€‰æ‹©ä¸€æ‰¹æ¶ˆæ¯ä¸€èµ·å‹ç¼©ï¼Œæ¯ä¸€ä¸ªæ‰¹æ¶ˆæ¯å°±æ˜¯ä¸€ä¸ªå‹ç¼©åˆ†æ®µã€‚ä½¿ç”¨è€…ä¹Ÿå¯ä»¥é€šè¿‡å‚æ•°æ¥æ§åˆ¶æ¯æ‰¹æ¶ˆæ¯çš„å¤§å°ã€‚</p><p>æˆ‘ä»¬ä¹‹å‰è®²è¿‡ï¼Œåœ¨Kafkaä¸­ï¼Œç”Ÿäº§è€…ç”Ÿæˆä¸€ä¸ªæ‰¹æ¶ˆæ¯å‘ç»™æœåŠ¡ç«¯ï¼Œåœ¨æœåŠ¡ç«¯ä¸­æ˜¯ä¸ä¼šæ‹†åˆ†æ‰¹æ¶ˆæ¯çš„ã€‚é‚£æŒ‰ç…§æ‰¹æ¥å‹ç¼©ï¼Œæ„å‘³ç€ï¼Œåœ¨æœåŠ¡ç«¯ä¹Ÿä¸ç”¨å¯¹è¿™æ‰¹æ¶ˆæ¯è¿›è¡Œè§£å‹ï¼Œå¯ä»¥æ•´æ‰¹ç›´æ¥å­˜å‚¨ï¼Œç„¶åæ•´æ‰¹å‘é€ç»™æ¶ˆè´¹è€…ã€‚æœ€åï¼Œæ‰¹æ¶ˆæ¯ç”±æ¶ˆè´¹è€…è¿›è¡Œè§£å‹ã€‚</p><p>åœ¨æœåŠ¡ç«¯ä¸ç”¨è§£å‹ï¼Œå°±ä¸ä¼šè€—è´¹æœåŠ¡ç«¯å®è´µçš„CPUèµ„æºï¼ŒåŒæ—¶è¿˜èƒ½è·å¾—å‹ç¼©åï¼Œå ç”¨ä¼ è¾“å¸¦å®½å°ï¼Œå ç”¨å­˜å‚¨ç©ºé—´å°çš„è¿™äº›å¥½å¤„ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸èªæ˜çš„è®¾è®¡ã€‚</p><p>åœ¨ä½¿ç”¨Kafkaæ—¶ï¼Œå¦‚æœç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„CPUèµ„æºä¸æ˜¯ç‰¹åˆ«åƒç´§ï¼Œå¼€å¯å‹ç¼©åï¼Œå¯ä»¥èŠ‚çœç½‘ç»œå¸¦å®½å’ŒæœåŠ¡ç«¯çš„å­˜å‚¨ç©ºé—´ï¼Œæå‡æ€»ä½“çš„ååé‡ï¼Œä¸€èˆ¬éƒ½æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p><h2>å°ç»“</h2><p>æ•°æ®å‹ç¼©ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯ç”¨CPUèµ„æºæ¢å–å­˜å‚¨èµ„æºï¼Œæˆ–è€…è¯´æ˜¯ç”¨å‹ç¼©è§£å‹çš„æ—¶é—´æ¥æ¢å–å­˜å‚¨çš„ç©ºé—´ï¼Œè¿™ä¸ªä¹°å–æ˜¯ä¸æ˜¯åˆ’ç®—ï¼Œéœ€è¦ä½ æ ¹æ®è‡ªå·±çš„æƒ…å†µå…ˆè¡¡é‡ä¸€ä¸‹ã€‚</p><p>åœ¨é€‰æ‹©å‹ç¼©ç®—æ³•çš„æ—¶å€™ï¼Œéœ€è¦ç»¼åˆè€ƒè™‘å‹ç¼©æ—¶é—´å’Œå‹ç¼©ç‡ä¸¤ä¸ªå› ç´ ï¼Œè¢«å‹ç¼©æ•°æ®çš„å†…å®¹ä¹Ÿæ˜¯å½±å“å‹ç¼©æ—¶é—´å’Œå‹ç¼©ç‡çš„é‡è¦å› ç´ ï¼Œå¿…è¦çš„æ—¶å€™å¯ä»¥å…ˆç”¨ä¸šåŠ¡æ•°æ®åšä¸€ä¸ªå‹ç¼©æµ‹è¯•ï¼Œè¿™æ ·æœ‰åŠ©äºé€‰æ‹©æœ€åˆé€‚çš„å‹ç¼©ç®—æ³•ã€‚</p><p>å¦å¤–ä¸€ä¸ªå½±å“å‹ç¼©ç‡çš„é‡è¦å› ç´ æ˜¯å‹ç¼©åˆ†æ®µçš„å¤§å°ï¼Œä½ éœ€è¦æ ¹æ®ä¸šåŠ¡æƒ…å†µé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„åˆ†æ®µç­–ç•¥ï¼Œåœ¨ä¿è¯ä¸é”™çš„å‹ç¼©ç‡çš„å‰æä¸‹ï¼Œå°½é‡å‡å°‘è§£å‹æµªè´¹ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬è®²äº†ä¸€ä¸‹Kafkaå®ƒæ˜¯å¦‚ä½•å¤„ç†æ¶ˆæ¯å‹ç¼©çš„ã€‚Kafkaåœ¨ç”Ÿäº§è€…ä¸Šï¼Œå¯¹æ¯æ‰¹æ¶ˆæ¯è¿›è¡Œå‹ç¼©ï¼Œæ‰¹æ¶ˆæ¯åœ¨æœåŠ¡ç«¯ä¸è§£å‹ï¼Œæ¶ˆè´¹è€…åœ¨æ”¶åˆ°æ¶ˆæ¯ä¹‹åå†è¿›è¡Œè§£å‹ã€‚ç®€å•åœ°è¯´ï¼ŒKafkaçš„å‹ç¼©å’Œè§£å‹éƒ½æ˜¯åœ¨å®¢æˆ·ç«¯å®Œæˆçš„ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>è¯¾åï¼Œä½ å¯ä»¥å»çœ‹ä¸€ä¸‹RocketMQçš„æ–‡æ¡£æˆ–è€…æºä»£ç ï¼Œçœ‹ä¸€ä¸‹ï¼ŒRocketMQæ˜¯æ€ä¹ˆå¤„ç†æ¶ˆæ¯å‹ç¼©çš„ã€‚ç„¶åå’ŒKafkaçš„å‹ç¼©æ–¹å¼å¯¹æ¯”ä¸€ä¸‹ï¼Œæƒ³ä¸€æƒ³å“ªç§å¤„ç†æ–¹å¼æ›´é€‚åˆä½ çš„ç³»ç»Ÿï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºæŠŠä½ çš„æ€è€ƒåˆ†äº«å‡ºæ¥ï¼Œå¦‚æœæœ‰ä»»ä½•é—®é¢˜ä¹Ÿæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºæé—®ã€‚</p><p>æ„Ÿè°¢é˜…è¯»ï¼Œå¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰ä¸€äº›å¯å‘ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚</p><p></p>","neighbors":{"left":{"article_title":"18 | å¦‚ä½•ç”¨ç¡¬ä»¶åŒæ­¥åŸè¯­ï¼ˆCASï¼‰æ›¿ä»£é”ï¼Ÿ","id":130743},"right":{"article_title":"20 | RocketMQ Produceræºç åˆ†æï¼šæ¶ˆæ¯ç”Ÿäº§çš„å®ç°è¿‡ç¨‹","id":132889}},"comments":[{"had_liked":false,"id":131159,"user_name":"å§œæˆˆ","can_delete":false,"product_type":"c1","uid":1058972,"ip_address":"","ucode":"45C4BE93C8E4CC","user_header":"https://static001.geekbang.org/account/avatar/00/10/28/9c/73e76b19.jpg","comment_is_top":false,"comment_ctime":1567655638,"is_pvip":false,"replies":[{"id":"49814","content":"ğŸ‘ğŸ‘ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"æç¥","uid":"1501046","ctime":1567732255,"ip_address":"","comment_id":131159,"utype":1}],"discussion_count":1,"race_medal":0,"score":"263560660694","product_id":100032301,"comment_content":"RocketMq(rockmq-all 4.4.1-SNAPSHOT): é»˜è®¤å‹ç¼©å¤§äº4Kçš„æ¶ˆæ¯ï¼ˆå¯é…ç½®ï¼‰ï¼Œå‹ç¼©ç®—æ³•æ˜¯zipï¼Œé»˜è®¤çº§åˆ«5ï¼ˆå¯é…ç½®ï¼‰ï¼ŒåŒæ ·ä¹Ÿæ˜¯å®¢æˆ·ç«¯åšè§£å‹ç¼©å·¥ä½œï¼ŒæœåŠ¡ç«¯åªå­˜å‚¨ï¼›å¯¹äºæ‰¹é‡æ¶ˆæ¯çš„å‹ç¼©ï¼Œç›®å‰å¹¶ä¸æ”¯æŒã€‚<br>æ‘˜å–DefaultMQProducerImpl.java éƒ¨åˆ†æºç ï¼š<br>private boolean tryToCompressMessage(final Message msg) {<br>        if (msg instanceof MessageBatch) {<br>            &#47;&#47;batch dose not support compressing right now<br>            return false;<br>        }<br>        byte[] body = msg.getBody();<br>        if (body != null) {<br>            if (body.length &gt;= this.defaultMQProducer.getCompressMsgBodyOverHowmuch()) {<br>                try {<br>                    byte[] data = UtilAll.compress(body, zipCompressLevel);<br>                    if (data != null) {<br>                        msg.setBody(data);<br>                        return true;<br>                    }<br>                } catch (IOException e) {<br>                    log.error(&quot;tryToCompressMessage exception&quot;, e);<br>                    log.warn(msg.toString());<br>                }<br>            }<br>        }<br><br>        return false;<br>    }","like_count":62,"discussions":[{"author":{"id":1501046,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e7/76/79c1f23a.jpg","nickname":"æç¥","note":"","ucode":"B19E91EE248591","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466316,"discussion_content":"ğŸ‘ğŸ‘ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567732255,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":131071,"user_name":"leslie","can_delete":false,"product_type":"c1","uid":1324255,"ip_address":"","ucode":"798E7C1CC98CC2","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/df/64e3d533.jpg","comment_is_top":false,"comment_ctime":1567631257,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"151891486617","product_id":100032301,"comment_content":"     è€å¸ˆæåˆ°äº†å‹ç¼©ï¼šé€‚å½“æ‰©å±•ä¸€ä¸‹ï¼Œè¿™ä¸ªä¸œè¥¿æ—©æœŸæ•°æ®åº“å¤‡ä»½å…¶å®ç»å¸¸ä¼šè¦å»ä½¿ç”¨ï¼›ä¸ªäººçš„æ„Ÿå—ä¸æ˜¯è€—èµ„æº-æ˜¯æåº¦è€—è´¹èµ„æºï¼Œå‹ç¼©æ¯”è¶Šå¤§CPUè¶Šå¤§ï¼ŒæœåŠ¡å™¨åšæ•°æ®åº“å¤‡ä»½å‹ç¼©æ—¶åŸºæœ¬ä¸Šä»€ä¹ˆäº‹æƒ…éƒ½åšä¸äº†ï¼Œå°¤å…¶åƒoracleã€sybaseè¿™ç§ï¼›sybaseçš„å¤‡ä»½ç­–ç•¥æ›´äººæ€§ä½†æ˜¯ä»£ä»·çš„æƒè¡¡å…¶å®å½“æ—¶å°±ã€ã€ã€ã€ã€ã€<br>     å¤§å¤šæ•°æƒ…å†µä¸‹å…¶å®æˆ‘ä»¬åœ¨åšè¿™ç§äº‹æƒ…æ—¶ä¸å¤ªå¯èƒ½å•ç‹¬ä»€ä¹ˆäº‹æƒ…éƒ½ä¸åšï¼šå¯èƒ½ç”Ÿäº§ç¯å¢ƒè¿˜æ˜¯ä¼šå»é€‰æ‹©Rockmqå§ï¼Œæ¯•ç«Ÿä¸­é—´ä»¶ä¸åƒæ•°æ®åº“-å•ç‹¬çš„æœåŠ¡å™¨ï¼Œcpuçš„èµ„æºä½¿ç”¨ä¸Šç›¸å¯¹å®½è£•ï¼Œå°¤å…¶æ˜¯å¯¹äºä¸­å°å‹ä¼ä¸šï¼Œç¡¬ä»¶èµ„æºæ²¡æœ‰é‚£ä¹ˆå®½è£•ï¼ŒRockmqæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œè®¡ç®—æœºç»„æˆåŸç†çš„è¯¾ç¨‹è¿˜æ˜¯å¯¹äºæ•°æ®å¤‡ä»½åšäº†ä¸€äº›æ¯”è¾ƒå¥½çš„è®²è§£ï¼Œèƒ¡è€å¸ˆçš„è¯¾å¯¹kafkaçš„å‹ç¼©æœºåˆ¶æœ‰è®²è§£ï¼›ç»¼åˆä¸‹æ¥æˆ‘åº”å½“ä¼šé€‰æ‹©Rockmqã€‚<br>     å‡ é—¨è¯¾ç¨‹åŒæ—¶åœ¨è·Ÿ-ç¡®å®å‘ç°æ—¶é—´ä¸Šè›®åƒåŠ›ï¼Œä¸ºäº†å­¦ä¹ å¤©å¤©çš„ä¸šä½™ç”Ÿæ´»æ´»åœ¨é—¹é’Ÿä¹‹ä¸­ï¼šå¯èƒ½å¾ˆå¤šä¸œè¥¿åªèƒ½ç­‰å®Œè¯¾äº†å†è¿›ä¸€æ­¥æ¢³ç†ï¼›åªèƒ½ç”¨åˆ˜è¶…è€å¸ˆçš„å­¦ä¹ æ³•-ç¬¬ä¸€éå…ˆç²—å­¦äº†ï¼Œç¬¬ä¸€éè¿˜æ˜¯å¸Œæœ›æ˜ç™½æ˜¯ä»€ä¹ˆå›äº‹ï¼Œä»€ä¹ˆåœºæ™¯æ€ä¹ˆç”¨ï¼›è€å¸ˆçš„æ¶ˆæ¯é˜Ÿåˆ—è¯¾ç¨‹ä¸è®¡ç®—æœºç»„æˆåŸç†ã€æ“ä½œç³»ç»Ÿçš„å…³ç³»æ›´å¤§äº›ï¼ŒåŒæ—¶è·Ÿè¿™ä¸‰é—¨å°±å·²ç»æŒ¤å‹ä¸å‡ºæ—¶é—´åˆ°kafkaä¸Šäº†ï¼Œå®Œè¯¾çš„æ—¶å€™æ˜ç™½é€‰ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆé€‰ç®—æ˜¯åŸºæœ¬è¾¾åˆ°å­¦ä¹ è¿™é—¨åŠŸè¯¾çš„åŸºæœ¬ç›®æ ‡å§ï¼Œå­¦ä¹ è¿‡ç¨‹ä¸­ä¸ºäº†æ˜ç™½åŸæ¥è€Œäº¤å‰å»å­¦ä¹ å…¶å®ƒä¸¤é—¨è¯¾æ‰€ä»˜å‡ºçš„æ—¶é—´ä»£ä»·å…¶å®è¿œè¶…ä¸é¢„æœŸã€‚<br>     æ„Ÿè°¢è€å¸ˆçš„åˆ†äº«ï¼šæœŸå¾…è€å¸ˆä¸‹èŠ‚è¯¾çš„åˆ†äº«ã€‚","like_count":36},{"had_liked":false,"id":134048,"user_name":"z.l","can_delete":false,"product_type":"c1","uid":1181055,"ip_address":"","ucode":"805CC5784D3F76","user_header":"https://static001.geekbang.org/account/avatar/00/12/05/7f/d35ab9a1.jpg","comment_is_top":false,"comment_ctime":1568728813,"is_pvip":false,"replies":[{"id":"51434","content":"åªä¼šè§£å‹headerï¼Œæ¶ˆæ¯ä½“ä¸ä¼šè§£å‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æç¥","uid":"1501046","ctime":1568769392,"ip_address":"","comment_id":134048,"utype":1}],"discussion_count":1,"race_medal":0,"score":"108942911213","product_id":100032301,"comment_content":"Kafkaæ¯ä¸ªå‹ç¼©è¿‡çš„æ¶ˆæ¯é›†åˆåœ¨ Broker ç«¯å†™å…¥æ—¶éƒ½è¦å‘ç”Ÿè§£å‹ç¼©æ“ä½œï¼Œç›®çš„æ˜¯ä¸ºäº†å¯¹æ¶ˆæ¯æ‰§è¡Œå„ç§éªŒè¯ã€‚<br>å¥½åƒæ˜¯è¿™æ ·å§ï¼Ÿ","like_count":26,"discussions":[{"author":{"id":1501046,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e7/76/79c1f23a.jpg","nickname":"æç¥","note":"","ucode":"B19E91EE248591","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467599,"discussion_content":"åªä¼šè§£å‹headerï¼Œæ¶ˆæ¯ä½“ä¸ä¼šè§£å‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568769392,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":131139,"user_name":"DFighting","can_delete":false,"product_type":"c1","uid":1233193,"ip_address":"","ucode":"F3BA2426FF8582","user_header":"https://static001.geekbang.org/account/avatar/00/12/d1/29/1b1234ed.jpg","comment_is_top":false,"comment_ctime":1567650067,"is_pvip":true,"replies":[{"id":"49817","content":"ğŸ‘ğŸ‘ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"æç¥","uid":"1501046","ctime":1567732550,"ip_address":"","comment_id":131139,"utype":1}],"discussion_count":1,"race_medal":0,"score":"44517323027","product_id":100032301,"comment_content":"ä¸€ç›´å­¦ä¹ ç®—æ³•éƒ½æ˜¯ç©ºé—´æ¢æ—¶é—´ï¼Œä½†æ˜¯åœ¨æ¶ˆæ¯ä¸­é—´ä»¶å’Œä¸€äº›IOå¯†é›†å‹çš„åº”ç”¨ä¸­è¿˜ä¼šæœ‰CPUè®¡ç®—èµ„æºæ¢ç½‘ç»œå¸¦å®½&#47;ç£ç›˜IOï¼Œåˆšåˆšçœ‹äº†ä¸‹RocketMQæºç ï¼Œåœ¨DefaultMQPullConsumerlmpl.pullSyncImplä¸­ä¼šè°ƒç”¨PullAPIWrapper.processPullResultï¼Œåœ¨è¿™é‡Œä¼šä¸ºå‹ç¼©çš„æ¶ˆæ¯è¿›è¡Œè§£å‹ç¼©ã€‚Producerç«¯æ²¡æ‰¾åˆ°å‹ç¼©çš„æºç ï¼Œåªæ˜¯åœ¨checkMessageä¸­ä¼šå¯¹æ¶ˆæ¯ä½“çš„é•¿åº¦è¿›è¡Œé™åˆ¶ï¼Œè¶…è¿‡4K(ç½‘ä¸ŠæŸ¥çš„)ä¼šæŠ›å‡ºæ¥MQClientExceptionï¼ŒçŒœæµ‹åº”è¯¥ä¹Ÿæ˜¯ä¼šå‹ç¼©ã€‚ä¹Ÿå°±æ˜¯RocketMQçš„å‹ç¼©æœºåˆ¶ä¹Ÿæ˜¯Producerå‹ç¼©ï¼ŒBrokerä¼ è¾“ï¼ŒConsumerè§£å‹ç¼©ï¼Œä¸åŒçš„æ˜¯kaffkaçš„å‹ç¼©æ˜¯åŸºäºä¸€æ‰¹ä¸€æ‰¹æ¶ˆæ¯çš„ï¼Œå¯¹äºCPUç©ºé—²è¾ƒå¤šçš„åœºæ™¯ä¸‹ä¼šæœ‰æ›´å¤§çš„ååæå‡ã€‚","like_count":11,"discussions":[{"author":{"id":1501046,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e7/76/79c1f23a.jpg","nickname":"æç¥","note":"","ucode":"B19E91EE248591","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466307,"discussion_content":"ğŸ‘ğŸ‘ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567732550,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":131258,"user_name":"è·¯é€”","can_delete":false,"product_type":"c1","uid":1581140,"ip_address":"","ucode":"A999998E04618B","user_header":"https://static001.geekbang.org/account/avatar/00/18/20/54/08c28585.jpg","comment_is_top":false,"comment_ctime":1567682516,"is_pvip":false,"replies":[{"id":"49812","content":"æ­£å¸¸æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯æ¯æ¬¡æ‹‰æ¶ˆæ¯éƒ½æ˜¯æ•´æ‰¹æ‹‰å–ï¼Œä¸ä¼šå‡ºç°ä½ è¯´çš„æƒ…å†µã€‚å¦‚æœæ˜¯æŒ‡å®šæ¶ˆè´¹ä½ç½®æ¥æ¶ˆè´¹ï¼Œå®¢æˆ·ç«¯åœ¨æ‹‰å–æ•´æ‰¹æ¶ˆæ¯ä¹‹åï¼Œå†è®¡ç®—ä¸€ä¸‹æ‰¹å†…çš„åç§»é‡ï¼ŒæŠŠæ­£ç¡®çš„æ¶ˆæ¯è¿”å›ç»™ç”¨æˆ·ä»£ç ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æç¥","uid":"1501046","ctime":1567731914,"ip_address":"","comment_id":131258,"utype":1}],"discussion_count":3,"race_medal":0,"score":"31632453588","product_id":100032301,"comment_content":"kafkaå‹ç¼©åå®ƒçš„offsetå¦‚ä½•è®¡ç®—ï¼Œå‡å¦‚åˆšå¥½è¦å›æº¯çš„æ•°æ®å°±åœ¨å‹ç¼©åŒ…ä¸­offsetå¦‚ä½•è®¡ç®—","like_count":7,"discussions":[{"author":{"id":1501046,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e7/76/79c1f23a.jpg","nickname":"æç¥","note":"","ucode":"B19E91EE248591","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466354,"discussion_content":"æ­£å¸¸æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯æ¯æ¬¡æ‹‰æ¶ˆæ¯éƒ½æ˜¯æ•´æ‰¹æ‹‰å–ï¼Œä¸ä¼šå‡ºç°ä½ è¯´çš„æƒ…å†µã€‚å¦‚æœæ˜¯æŒ‡å®šæ¶ˆè´¹ä½ç½®æ¥æ¶ˆè´¹ï¼Œå®¢æˆ·ç«¯åœ¨æ‹‰å–æ•´æ‰¹æ¶ˆæ¯ä¹‹åï¼Œå†è®¡ç®—ä¸€ä¸‹æ‰¹å†…çš„åç§»é‡ï¼ŒæŠŠæ­£ç¡®çš„æ¶ˆæ¯è¿”å›ç»™ç”¨æˆ·ä»£ç ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567731914,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1532404,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEIvUlicgrWtibbDzwhLw5cQrDSy2JuE1mVvmXq11KQIwpLicgDuWfpp9asE0VCN6HhibPDWn7wBc2lfmA/132","nickname":"aã€","note":"","ucode":"590FE8DB111492","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7901,"discussion_content":"kafkaå‹ç¼©æ¶ˆæ¯ï¼Œæ¯”å¦‚è¿™æ‰¹æ¶ˆæ¯çš„offsetæ˜¯1024~1030æ€»å…±7æ¡ï¼Œé‚£ä¹ˆå‹ç¼©åçš„æ¶ˆæ¯æ ¼å¼ä¼šæœ‰ä¸€æ¡ï¼Œä½†æ˜¯æœ‰ä¸¤å±‚ï¼Œå¤–å±‚çš„offsetæ˜¯1030ï¼Œå¤–å±‚çš„valueé‡Œæœ‰7æ¡è®°å½•ï¼Œoffsetä¾æ¬¡æ˜¯0~7ï¼Œè§£å‹ç¼©åè¦é‡æ–°è®¡ç®—è¿™ä¸ƒæ¡çš„offsetï¼Œé¦–å…ˆç”¨å†…å±‚çš„æœ€åä¸€æ¡offset(7)ï¼æ±‚çš„é‚£æ¡çš„offset(æ¯”å¦‚æ˜¯0)ï¼Œé‚£ä¹ˆç»“æœå°±æ˜¯-6ï¼Œç„¶åå†ç”¨å¤–å±‚çš„offsetåŠ ä¸Š-6å°±æ˜¯1024ã€‚ä»¥ä¸Šå‚è€ƒï¼œæ·±å…¥ç†è§£kafka:æ ¸å¿ƒè®¾è®¡ä¸å®ç°åŸç†ï¼","likes_number":8,"is_delete":false,"is_hidden":false,"ctime":1567702284,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1049360,"avatar":"https://static001.geekbang.org/account/avatar/00/10/03/10/26f9f762.jpg","nickname":"Switch","note":"","ucode":"D8A7F7F6A0BEA9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1532404,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEIvUlicgrWtibbDzwhLw5cQrDSy2JuE1mVvmXq11KQIwpLicgDuWfpp9asE0VCN6HhibPDWn7wBc2lfmA/132","nickname":"aã€","note":"","ucode":"590FE8DB111492","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":39842,"discussion_content":"offset ä¾æ¬¡æ˜¯ 0~7 åº”è¯¥æ˜¯ 0-6 å§\nç”¨å†…å±‚çš„æœ€åä¸€æ¡ offset (7) åº”è¯¥æ˜¯ offset(6) å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571997576,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":7901,"ip_address":""},"score":39842,"extra":""}]}]},{"had_liked":false,"id":131148,"user_name":"é’èˆŸ","can_delete":false,"product_type":"c1","uid":1192732,"ip_address":"","ucode":"2651482AC0DEC6","user_header":"https://static001.geekbang.org/account/avatar/00/12/33/1c/59a4e803.jpg","comment_is_top":false,"comment_ctime":1567652209,"is_pvip":false,"replies":[{"id":"49815","content":"å› ä¸ºæ‰¹æ¶ˆæ¯è¿˜ä¸æ”¯æŒå‹ç¼©","user_name":"ä½œè€…å›å¤","user_name_real":"æç¥","uid":"1501046","ctime":1567732276,"ip_address":"","comment_id":131148,"utype":1}],"discussion_count":3,"race_medal":0,"score":"23042488689","product_id":100032301,"comment_content":"RocketMQ åœ¨DefaultMQProducerImpl.tryToCompressMessageä¸­åˆ¤æ–­æ¶ˆæ¯é•¿åº¦å¤§äº4Kbå°±è¿›è¡Œå‹ç¼©ï¼Œå‹ç¼©ç®—æ³•æ˜¯zipï¼ˆjava.util.zip.Deflaterï¼‰<br><br>æˆ‘æ³¨æ„åˆ°åœ¨å‘é€æ—¶ï¼Œä¼šåˆ¤æ–­å¦‚æœæ¶ˆæ¯æ˜¯ä¸€ä¸ªæ‰¹é‡æ¶ˆæ¯ï¼ˆMessageBatchï¼‰ï¼Œå°±ä¸å¼€å¯å‹ç¼©ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1501046,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e7/76/79c1f23a.jpg","nickname":"æç¥","note":"","ucode":"B19E91EE248591","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466312,"discussion_content":"å› ä¸ºæ‰¹æ¶ˆæ¯è¿˜ä¸æ”¯æŒå‹ç¼©","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567732276,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1058972,"avatar":"https://static001.geekbang.org/account/avatar/00/10/28/9c/73e76b19.jpg","nickname":"å§œæˆˆ","note":"","ucode":"45C4BE93C8E4CC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7733,"discussion_content":"ä½ çœ‹ä¸€ä¸‹æºç å°±çŸ¥é“äº†ï¼Œå½“å‰rocketmqä¸æ”¯æŒæ‰¹é‡æ¶ˆæ¯å‹ç¼©ã€‚ï¼ˆæ ‡æ³¨ï¼‰\nprivate boolean tryToCompressMessage(final Message msg) {\n        if (msg instanceof MessageBatch) {\n            //batch dose not support compressing right now\n            //å½“å‰ä¸æ”¯æŒå‹ç¼©æ‰¹æ¶ˆæ¯\n            return false;\n        }\n        byte[] body = msg.getBody();\n        if (body != null) {\n            if (body.length >= this.defaultMQProducer.getCompressMsgBodyOverHowmuch()) {\n                try {\n                    byte[] data = UtilAll.compress(body, zipCompressLevel);\n                    if (data != null) {\n                        msg.setBody(data);\n                        return true;\n                    }\n                } catch (IOException e) {\n                    log.error(&#34;tryToCompressMessage exception&#34;, e);\n                    log.warn(msg.toString());\n                }\n            }\n        }\n\n        return false;\n    }","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1567656485,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1192732,"avatar":"https://static001.geekbang.org/account/avatar/00/12/33/1c/59a4e803.jpg","nickname":"é’èˆŸ","note":"","ucode":"2651482AC0DEC6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1058972,"avatar":"https://static001.geekbang.org/account/avatar/00/10/28/9c/73e76b19.jpg","nickname":"å§œæˆˆ","note":"","ucode":"45C4BE93C8E4CC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7824,"discussion_content":"æˆ‘å°±æ˜¯çœ‹åˆ°è¿™é‡Œä¸æ”¯æŒå‹ç¼©ï¼Œæ‰€ä»¥æ‰æƒ³æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´å®ƒä¸æ”¯æŒå‹ç¼©ï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1567685080,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":7733,"ip_address":""},"score":7824,"extra":""}]}]},{"had_liked":false,"id":187679,"user_name":"Ryoma","can_delete":false,"product_type":"c1","uid":1130590,"ip_address":"","ucode":"7F692369239692","user_header":"https://static001.geekbang.org/account/avatar/00/11/40/5e/b8fada94.jpg","comment_is_top":false,"comment_ctime":1584191406,"is_pvip":true,"discussion_count":2,"race_medal":2,"score":"18764060590","product_id":100032301,"comment_content":"å…³äº Kafka Broker ç«¯å¯¹äºå‹ç¼©çš„å¤„ç†ï¼Œéš”å£è¯¾ç¨‹æœ‰ä¸ä¸€æ ·çš„è®²è§£ã€‚å¦‚æœ producer ç«¯ä¸ Broker é€‰æ‹©çš„å‹ç¼©ç®—æ³•ä¸ä¸€è‡´ï¼Œæ­¤æ—¶ Broker åªèƒ½å…ˆè§£å‹ç¼©ï¼Œç„¶åå†é‡æ–°å‹ç¼©ã€‚","like_count":5,"discussions":[{"author":{"id":1018177,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK9uWq1YjJ79IftTc4g4N2icNRLrLjibyia25iaBMWmpTmuq1Av62cP8oqf28ZjjgRMRGDcnLib69ZdVEQ/132","nickname":"Lè§è§æœ¨å¶","note":"","ucode":"78CABDECA48DE4","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":356481,"discussion_content":"è¯·é—®æ˜¯éš”å£çš„å“ªä¸ªè¯¾ç¨‹ï¼Ÿæˆ‘å»ç…ç…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615607201,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1133014,"avatar":"https://static001.geekbang.org/account/avatar/00/11/49/d6/96894426.jpg","nickname":"lijava","note":"","ucode":"0B1B4396C0DAE8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1018177,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK9uWq1YjJ79IftTc4g4N2icNRLrLjibyia25iaBMWmpTmuq1Av62cP8oqf28ZjjgRMRGDcnLib69ZdVEQ/132","nickname":"Lè§è§æœ¨å¶","note":"","ucode":"78CABDECA48DE4","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":589755,"discussion_content":"åº”è¯¥æ˜¯kafkaåŸç†é‚£ä¸ª","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665301013,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":356481,"ip_address":"åŒ—äº¬"},"score":589755,"extra":""}]}]},{"had_liked":false,"id":235555,"user_name":"xuanyuan","can_delete":false,"product_type":"c1","uid":1113737,"ip_address":"","ucode":"1EC79B9372868F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI2icbib62icXtibTkThtyRksbuJLoTLMts7zook2S30MiaBtbz0f5JskwYicwqXkhpYfvCpuYkcvPTibEaQ/132","comment_is_top":false,"comment_ctime":1595084615,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10185019207","product_id":100032301,"comment_content":"å°è±¡ä¸­linuxæé™tpsæ˜¯ç™¾ä¸‡çº§ï¼Œåé¢å°±æ˜¯å†…æ ¸æˆç“¶é¢ˆäº†ã€‚200ä¸‡ä¸€èˆ¬éœ€è¦ç”¨æˆ·æ€åè®®æ ˆäº†","like_count":2,"discussions":[{"author":{"id":1256821,"avatar":"https://static001.geekbang.org/account/avatar/00/13/2d/75/e7c29de4.jpg","nickname":"wkq2786130","note":"","ucode":"0F3A9DF9928C67","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587341,"discussion_content":"2000ä¸‡QPSæŒ‡çš„æ˜¯å•æ¡æ¶ˆæ¯ç»´åº¦çš„ï¼Œå®é™…ä¸Škafkaæ˜¯æ‰¹å¤„ç†çš„ï¼ŒæŒ‰ç…§(æ‰¹å¤„ç†)ç½‘ç»œIOçš„QPSå¤§æ¦‚åœ¨100ä¸‡QPSå·¦å³ï¼Œç”šè‡³æ›´å°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662985882,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":131334,"user_name":"å¼ ä¸‰","can_delete":false,"product_type":"c1","uid":1004092,"ip_address":"","ucode":"1155528FAE1546","user_header":"https://static001.geekbang.org/account/avatar/00/0f/52/3c/d6fcb93a.jpg","comment_is_top":false,"comment_ctime":1567727262,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10157661854","product_id":100032301,"comment_content":"ç¡®å®æƒ³åˆ°äº†éœå¤«æ›¼ç¼–ç ï¼Œè¿˜æœ‰ä½å›¾ã€‚","like_count":2},{"had_liked":false,"id":131127,"user_name":"ä¸€æ­¥","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1567648120,"is_pvip":true,"replies":[{"id":"49816","content":"è¿™ä¸ªä¸èƒ½ä¸€æ¦‚è€Œè®ºå•Šï¼Œä½ éœ€è¦æ ¹æ®æˆ‘è¿™èŠ‚è¯¾çš„è®²çš„é‚£äº›åŸåˆ™è‡ªå·±è¡¡é‡ä¸€ä¸‹ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœæ¶ˆæ¯ä½“æ¯”è¾ƒå¤§ï¼Œå®¢æˆ·ç«¯çš„CPUä¸æ˜¯å¾ˆå¿™ï¼Œå¼€å¯å‹ç¼©åéƒ½ä¼šæœ‰ä¸€å®šçš„æ€§èƒ½æå‡ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æç¥","uid":"1501046","ctime":1567732519,"ip_address":"","comment_id":131127,"utype":1}],"discussion_count":1,"race_medal":1,"score":"10157582712","product_id":100032301,"comment_content":"ç°åœ¨ç³»ç»Ÿä½¿ç”¨çš„æ˜¯rabbitmqï¼Œåœ¨å‘é€æ•°æ®æ—¶å€™ä½¿ç”¨çš„æ˜¯protobufferè¿›è¡Œåºåˆ—åŒ–ï¼Œè¿™æ—¶å€™è¿˜æœ‰å¿…è¦å¼€å¯å‹ç¼©å—ï¼Ÿå¦‚æœå¼€å¯äº†å‹ç¼©ä¼šä¸ä¼šæ•ˆæœæ›´å¥½çš„ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1501046,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e7/76/79c1f23a.jpg","nickname":"æç¥","note":"","ucode":"B19E91EE248591","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466300,"discussion_content":"è¿™ä¸ªä¸èƒ½ä¸€æ¦‚è€Œè®ºå•Šï¼Œä½ éœ€è¦æ ¹æ®æˆ‘è¿™èŠ‚è¯¾çš„è®²çš„é‚£äº›åŸåˆ™è‡ªå·±è¡¡é‡ä¸€ä¸‹ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœæ¶ˆæ¯ä½“æ¯”è¾ƒå¤§ï¼Œå®¢æˆ·ç«¯çš„CPUä¸æ˜¯å¾ˆå¿™ï¼Œå¼€å¯å‹ç¼©åéƒ½ä¼šæœ‰ä¸€å®šçš„æ€§èƒ½æå‡ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1567732519,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":131767,"user_name":"åŒ—å†¥Master","can_delete":false,"product_type":"c1","uid":1014142,"ip_address":"","ucode":"EBCCEC79AFC5DF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/79/7e/c38ac02f.jpg","comment_is_top":false,"comment_ctime":1567902892,"is_pvip":false,"replies":[{"id":"50422","content":"åœ¨å‘é€ç«¯ï¼Œæ‰¹çš„å¤§å°æ˜¯æœ‰å‚æ•°æ§åˆ¶çš„ï¼Œä¸ä¼šè¿‡å¤§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æç¥","uid":"1501046","ctime":1567992832,"ip_address":"","comment_id":131767,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5862870188","product_id":100032301,"comment_content":"å¦‚æœæ˜¯æ‰¹æ¶ˆæ¯ï¼ŒæœåŠ¡ç«¯ä¸è§£å‹ï¼Œç›´æ¥è¿”å›ç»™æ¶ˆè´¹è€…ç«¯è§£å‹---å¦‚æœæ‰¹æ¶ˆæ¯å¾ˆå¤§ï¼Œä¸€ä¸ªæ‰¹æ¬¡å‡ ç™¾ä¸Šåƒå‘¢ï¼Ÿä¹Ÿæ˜¯ä¸€æ¬¡æ€§è¿”å›ç»™æ¶ˆè´¹è€…ç«¯å—ï¼Ÿè¿™æ ·å²‚ä¸æ˜¯å½±å“å¹¶å‘æ¶ˆè´¹ï¼Œä»è€Œå½±å“æ¶ˆè´¹é€Ÿåº¦ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1501046,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e7/76/79c1f23a.jpg","nickname":"æç¥","note":"","ucode":"B19E91EE248591","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466613,"discussion_content":"åœ¨å‘é€ç«¯ï¼Œæ‰¹çš„å¤§å°æ˜¯æœ‰å‚æ•°æ§åˆ¶çš„ï¼Œä¸ä¼šè¿‡å¤§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567992832,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":131102,"user_name":"ä¸šä½™è‰","can_delete":false,"product_type":"c1","uid":1126538,"ip_address":"","ucode":"99BDC1E629049D","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/8a/b5ca7286.jpg","comment_is_top":false,"comment_ctime":1567644174,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5862611470","product_id":100032301,"comment_content":"Kafkaè®¾è®¡çš„å¾ˆç²¾å¦™ï¼Œä½†æ˜¯ä½¿ç”¨çš„åœºæ™¯å±€é™æ€§ä¹Ÿå¾ˆå¤§ã€‚å‹ç¼©æ˜¯ç°ä»£ç½‘ç»œé€šä¿¡ä¸­å¿…ä¸å¯å°‘çš„ä¸€ç¯ï¼Œä¹Ÿæœ‰ä¸å°‘ä¸“æ éƒ½å†™è¿‡äº†ã€‚","like_count":1},{"had_liked":false,"id":341084,"user_name":"å†è§ç†æƒ³","can_delete":false,"product_type":"c1","uid":1245999,"ip_address":"","ucode":"FAC88B3F6F6DFD","user_header":"https://static001.geekbang.org/account/avatar/00/13/03/2f/0a5e0751.jpg","comment_is_top":false,"comment_ctime":1649336871,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1649336871","product_id":100032301,"comment_content":"æ•°æ®å‹ç¼© é€šè¿‡æ—¶é—´æ¢ç©ºé—´ã€‚<br>åœ¨ç³»ç»Ÿç“¶é¢ˆåœ¨IOä¸Šï¼Œå¹¶ä¸”å¯¹cpuåˆ©ç”¨ç‡ä¸é«˜æ—¶ï¼Œå¯ä»¥é€‰æ‹©å¯¹æ•°æ®è¿›è¡Œå‹ç¼©åä¼ è¾“ã€‚<br>ä½†æ˜¯æ•°æ® å‹ç¼©&#47;è§£å‹ç¼©çš„æ€§èƒ½æŸè€—ä¹Ÿæ˜¯æˆ‘ä»¬åº”è¯¥æ³¨æ„çš„ï¼Œ<br>éœ€è¦æ ¹æ®æ•°æ®çš„å½¢æ€é€‰æ‹©ä¸åŒçš„å‹ç¼©ç®—æ³•ï¼ˆä¸åŒçš„å‹ç¼©æ¯”&#47;å‹ç¼©æ•ˆç‡ï¼‰ä»¥åŠå‹ç¼©åˆ†æ®µã€‚<br>å¯¹æ•°æ®å‹ç¼©åä¼ è¾“å¯ä»¥æœ‰æ•ˆåœ°å‡å°‘å¸¦å®½ä¸è¶³å¯¹ç³»ç»Ÿçš„å½±å“ï¼Œæå‡æœåŠ¡ç«¯çš„ååé‡ã€‚","like_count":0},{"had_liked":false,"id":337626,"user_name":"William Ning","can_delete":false,"product_type":"c1","uid":1592279,"ip_address":"","ucode":"4DB8D05E69E5F3","user_header":"https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg","comment_is_top":false,"comment_ctime":1646921140,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1646921140","product_id":100032301,"comment_content":"æ–‡ç« ä¸è¯„è®ºçœ‹å®Œï¼Œè¿˜æ˜¯è¦å»å›é¡¾å‰é¢çš„çŸ¥è¯†ç‚¹ï¼Œä»¥åŠå…¶ä»–çš„çŸ¥è¯†ç‚¹ã€‚ è¦å­¦çš„ä¸œè¥¿å¯çœŸå¤šï¼Œç‰¹åˆ«æ˜¯è¿™äº›çŸ¥è¯†å¦‚ä½•èä¼šè´¯é€šèµ·æ¥ -- å­¦ä¹ å¹¶æ€è€ƒç€...","like_count":0},{"had_liked":false,"id":336194,"user_name":"Panmax","can_delete":false,"product_type":"c1","uid":1004871,"ip_address":"","ucode":"9D65E3B84C5519","user_header":"https://static001.geekbang.org/account/avatar/00/0f/55/47/d217c45f.jpg","comment_is_top":false,"comment_ctime":1646006300,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646006300","product_id":100032301,"comment_content":"å¦‚ä½•ç†è§£ã€Œå¦‚æœä½ çš„ç³»ç»Ÿè¯»å†™æ¯”ä¸¥é‡ä¸å‡è¡¡ï¼Œä½ è¿˜è¦è€ƒè™‘ï¼Œæ¯è¯»ä¸€æ¬¡æ•°æ®å°±è¦è§£å‹ä¸€æ¬¡æ˜¯ä¸æ˜¯åˆ’ç®—ã€‚ã€ï¼Ÿ","like_count":0},{"had_liked":false,"id":327551,"user_name":"æœ±å»¶äº‘","can_delete":false,"product_type":"c1","uid":1319759,"ip_address":"","ucode":"08E6EE2AB82DE9","user_header":"https://static001.geekbang.org/account/avatar/00/14/23/4f/3ce24bed.jpg","comment_is_top":false,"comment_ctime":1640166675,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1640166675","product_id":100032301,"comment_content":"2000 ä¸‡ TPS ä¹˜ä»¥ 1KB çš„æ¶ˆæ¯å¤§å°ï¼Œå†æŠŠå­—èŠ‚ Byte è½¬æ¢æˆæ¯”ç‰¹ bitï¼Œæ¢ç®—æˆç½‘ç»œä¼ è¾“çš„å¸¦å®½æ˜¯ 200Gb&#47;s<br><br>ä¸åº”è¯¥æ˜¯ 20Gb&#47;s å—ï¼Ÿ<br>","like_count":0,"discussions":[{"author":{"id":1158930,"avatar":"https://static001.geekbang.org/account/avatar/00/11/af/12/fe5196f8.jpg","nickname":"Tutu","note":"","ucode":"1F105484397134","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546155,"discussion_content":"20GBï¼Œçº¦ç­‰äº200Gb","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642178319,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":234506,"user_name":"Sun Fei","can_delete":false,"product_type":"c1","uid":1032631,"ip_address":"","ucode":"092EC0992050BB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c1/b7/57f153f6.jpg","comment_is_top":false,"comment_ctime":1594708948,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594708948","product_id":100032301,"comment_content":"    private boolean tryToCompressMessage(final Message msg) {<br>        if (msg instanceof MessageBatch) {<br>            &#47;&#47;ä¸æ”¯æŒæ‰¹æ¶ˆæ¯çš„å‹ç¼©<br>            return false;<br>        }<br>        byte[] body = msg.getBody();<br>        if (body != null) {<br>            &#47;&#47; compressMsgBodyOverHowmuch = 1024 * 4 <br>            if (body.length &gt;= this.defaultMQProducer.getCompressMsgBodyOverHowmuch()) {<br>                try {<br>                    byte[] data = UtilAll.compress(body, zipCompressLevel);<br>                    if (data != null) {<br>                        msg.setBody(data);<br>                        return true;<br>                    }<br>                } catch (IOException e) {<br>                    log.error(&quot;tryToCompressMessage exception&quot;, e);<br>                    log.warn(msg.toString());<br>                }<br>            }<br>        }<br><br>        return false;<br>    }","like_count":0},{"had_liked":false,"id":135999,"user_name":"é’±","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1569324415,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569324415","product_id":100032301,"comment_content":"å‹ç¼©â€”â€”ä»¥CPUè®¡ç®—èµ„æºæ¢ç©ºé—´ï¼Œä»¥æœŸå‡å°‘ç½‘ç»œå¸¦å®½æˆ–ç£ç›˜å­˜å‚¨ç©ºé—´ï¼Œæé«˜ä¼ è¾“é€Ÿç‡ã€‚è€å¸ˆï¼Œè®²çš„20ä¸ª0çš„ä¾‹å­å¾ˆå½¢è±¡ï¼Œå¦‚æœå¤¸å¼ ç‚¹2000ä¸ª0å°±æ›´èƒ½ä½“ä¼šå‹ç¼©çš„æ•ˆæœå•¦ğŸ˜„","like_count":0},{"had_liked":false,"id":132115,"user_name":"ç‹è¹","can_delete":false,"product_type":"c1","uid":1203920,"ip_address":"","ucode":"0A6F91068A13E8","user_header":"https://static001.geekbang.org/account/avatar/00/12/5e/d0/e676ac19.jpg","comment_is_top":false,"comment_ctime":1568024765,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568024765","product_id":100032301,"comment_content":"RockerMQç”Ÿäº§è€…å‹ç¼©ï¼š<br>å‹ç¼©é€»è¾‘æ§åˆ¶<br>  DefaultMQProducerImpl#tryToCompressMessage<br>    æ‰¹æ¶ˆæ¯ï¼Œæš‚ä¸æ”¯æŒ<br>    Messageçš„body byte[] è¶…è¿‡ 4Kï¼Œå¼€å¯å‹ç¼©<br>    å‹ç¼©levelé»˜è®¤5ï¼Œå¯åŠ¨å‚æ•°-Drocketmq.message.compressLevelå¯ä»¥é…ç½®<br>å‹ç¼©æ•°æ®å¤„ç†<br>  UtilAll#compress(final byte[] src, final int level)<br>    ä½¿ç”¨JDKçš„<br>      java.io.ByteArrayOutputStream<br>      java.util.zip.Deflater<br>      java.util.zip.DeflaterOutputStream<br>","like_count":0}]}