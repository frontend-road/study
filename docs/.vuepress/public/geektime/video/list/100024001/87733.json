{"id":87733,"title":"36 | Benchmark","content":"<h1>è¯¾ä»¶åŠæºä»£ç åœ°å€</h1><p><a href=\"https://gitee.com/geektime-geekbang/go_learning\">https://gitee.com/geektime-geekbang/go_learning</a></p><h2>ä¹¦ç›®æ¨è</h2><p><a href=\"time://mall?url=https%3A%2F%2Fh5.youzan.com%2Fv2%2Fgoods%2F1ycmk3uob0ryw\">ã€Šè®¡ç®—æœºç¨‹åºçš„æ„é€ å’Œè§£é‡Šã€‹</a></p>","comments":[{"had_liked":false,"id":162644,"user_name":"è‹æ ¼æ‹‰æ²¡åº•","can_delete":false,"product_type":"c3","uid":1476300,"ip_address":"","ucode":"282B56405AE1B9","user_header":"https://static001.geekbang.org/account/avatar/00/16/86/cc/d63bb0f2.jpg","comment_is_top":false,"comment_ctime":1576572010,"is_pvip":false,"replies":[{"id":63266,"content":"æœ€ç®€å•çš„æ–¹æ³•æ˜¯ï¼š\ngo test -v polymorphsim_test.go &gt;&gt; 1.txt","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1577355147,"ip_address":"","comment_id":162644,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"è¯·é—®èƒ½å¦å°†ç»ˆç«¯çš„è¾“å‡ºç»“æœå†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Ÿä»¥åšåç»­çš„åˆ†æå¤„ç†ï¼Œè°¢è°¢","like_count":2,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478117,"discussion_content":"æœ€ç®€å•çš„æ–¹æ³•æ˜¯ï¼š\ngo test -v polymorphsim_test.go &amp;gt;&amp;gt; 1.txt","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577355147,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":363821,"user_name":"slssdhs","can_delete":false,"product_type":"c3","uid":1138058,"ip_address":"æ¹–åŒ—","ucode":"6644520A415C69","user_header":"https://static001.geekbang.org/account/avatar/00/11/5d/8a/894479c1.jpg","comment_is_top":false,"comment_ctime":1670225674,"is_pvip":false,"replies":[{"id":141644,"content":"èµğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1008262,"ctime":1712158152,"ip_address":"åŒ—äº¬","comment_id":363821,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"å¦‚æœå‘ç°è¿è¡Œ go test -bench=. ä»…ç»™å‡ºä¸€è¡Œç±»ä¼¼\nok      Study&#47;src&#47;ch35&#47;benchmark        0.037s \nè¿™æ ·çš„è¾“å‡º è¯·ç¡®è®¤æ˜¯å¦ä½¿ç”¨çš„æ˜¯Windows PowerShell å¦‚æœæ˜¯è¯·åˆ‡æ¢åˆ° å‘½ä»¤è¡Œ æˆ–è€…è¯´ CMD æ‰§è¡Œ å°±èƒ½è·å¾—ä¸è§†é¢‘ä¸€æ ·çš„è¾“å‡ºäº†","like_count":1,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":641096,"discussion_content":"èµğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1712158152,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":299218,"user_name":"FR","can_delete":false,"product_type":"c3","uid":1226754,"ip_address":"","ucode":"E111881ED789C1","user_header":"https://static001.geekbang.org/account/avatar/00/12/b8/02/7bcba09e.jpg","comment_is_top":false,"comment_ctime":1624516253,"is_pvip":false,"replies":[{"id":113329,"content":"åŠ ä¸Š-vçš„å‚æ•°","user_name":"ä½œè€…å›å¤","user_name_real":"è”¡è¶…","uid":1008262,"ctime":1632020920,"ip_address":"","comment_id":299218,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"è€å¸ˆï¼Œè¯·é—®ä¸‹ä¸ºä»€ä¹ˆæˆ‘çš„benchmarkè¾“å‡ºå‚æ•°åªæœ‰PASS\nok      trgo&#47;src&#47;ch35&#47;benchmark 0.224sï¼Œæ‰§è¡Œçš„å‘½ä»¤ä¹Ÿæ˜¯go test -bench=.","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522367,"discussion_content":"åŠ ä¸Š-vçš„å‚æ•°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632020920,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":143312,"user_name":"sasmiditer","can_delete":false,"product_type":"c3","uid":1158519,"ip_address":"","ucode":"C82AE609CFB223","user_header":"https://static001.geekbang.org/account/avatar/00/11/ad/77/f81c61d6.jpg","comment_is_top":false,"comment_ctime":1571666648,"is_pvip":false,"replies":[{"id":55914,"content":"&quot;for i := 0; i &lt; b.N; i++ &quot; å¤–é¢è¿™ä¸ªå¾ªç¯æ˜¯ç”¨æ¥æ§åˆ¶æµ‹è¯•æ¬¡æ•°çš„","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1572177238,"ip_address":"","comment_id":143312,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"...buffé‚£ä¸ªå‡½æ•°ï¼Œå˜é‡bufçš„å£°æ˜æ˜¯å¦åº”è¯¥æ”¾åœ¨å¾ªç¯å¤–é¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471482,"discussion_content":"&amp;quot;for i := 0; i &amp;lt; b.N; i++ &amp;quot; å¤–é¢è¿™ä¸ªå¾ªç¯æ˜¯ç”¨æ¥æ§åˆ¶æµ‹è¯•æ¬¡æ•°çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572177238,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":83340,"user_name":"cfanbo","can_delete":false,"product_type":"c3","uid":1043738,"ip_address":"","ucode":"39D8D71453E575","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ed/1a/269eb3d6.jpg","comment_is_top":false,"comment_ctime":1554540137,"is_pvip":false,"replies":[{"id":30144,"content":"ä»£ç è¢«è¿è¡Œçš„æ¬¡æ•°ï¼Œå•æ¬¡çš„è¿è¡Œæ—¶é—´","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1554597216,"ip_address":"","comment_id":83340,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"-benchmem å‚æ•°çš„è¾“å‡ºç»“æœé‚£ä¸¤åˆ—è¡¨ç¤ºçš„ä»€ä¹ˆæ„æ€ï¼Ÿä¸€ç›´æ²¡æœ‰æ‰¾åˆ°æ¯”è¾ƒè¯¦æƒ…çš„è§£é‡Š","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445984,"discussion_content":"ä»£ç è¢«è¿è¡Œçš„æ¬¡æ•°ï¼Œå•æ¬¡çš„è¿è¡Œæ—¶é—´","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554597216,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":118030,"user_name":"è™¢åœ‹æŠ€é†¬","can_delete":false,"product_type":"c3","uid":1056807,"ip_address":"","ucode":"5A192262AA037E","user_header":"https://static001.geekbang.org/account/avatar/00/10/20/27/a6932fbe.jpg","comment_is_top":false,"comment_ctime":1564214817,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"B&#47;op:æ¯æ¬¡æ“ä½œåˆ†é…çš„å†…å­˜å­—èŠ‚æ•°\nallocs&#47;op:æ¯æ¬¡æ“ä½œåˆ†é…å†…å­˜çš„æ¬¡æ•°","like_count":13},{"had_liked":false,"id":287654,"user_name":"escray","can_delete":false,"product_type":"c3","uid":1020525,"ip_address":"","ucode":"1F4204930E47C4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","comment_is_top":false,"comment_ctime":1618070485,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"Benchmark ç”¨äºå¯¹ä»£ç ç‰‡æ®µæˆ–è€…ç¬¬ä¸‰æ–¹åº“è¿›è¡Œæ€§èƒ½æµ‹è¯•\n\n- æ–¹æ³•åä»¥ Benchmark å¼€å¤´\n- å‚æ•°ç±»å‹æ˜¯ *testing.B\n- ç”¨ b.ResetTimer( ) å’Œ b.StopTimer() æ¥éš”ç¦»ä¸æ€§èƒ½æµ‹è¯•æ— å…³çš„ä»£ç \n- æ€§èƒ½æµ‹è¯•äº¤ç»™ framework æ¥åšï¼Œå°†éœ€è¦æµ‹è¯•çš„ä»£ç æ”¾åœ¨å¾ªç¯ä¸­ï¼Œå¾ªç¯çš„æ¬¡æ•°ç”± framework æ¥è¿”å›\n\nåœ¨ç•™è¨€é‡Œé¢çœ‹åˆ°å…³äºå°†  buf çš„å£°æ˜æ˜¯å¦æ”¾åœ¨æ€§èƒ½æµ‹è¯•ä¸­ï¼Œä¹Ÿå°±æ˜¯å¤–å±‚ for  å¾ªç¯çš„è®¨è®º\n\n```\nvar buf bytes.Buff\n```\n\nå¦‚æœä»æ€§èƒ½æ¯”è¾ƒä¸Šæ¥è®²ï¼Œbuf å’Œ str çš„å£°æ˜éƒ½åº”è¯¥æ”¾åœ¨æ§åˆ¶æµ‹è¯•æ¬¡æ•°çš„ for å¾ªç¯å†…ã€‚\n\nä½†æ˜¯å¦‚æœæŠŠ buf å’Œ str çš„å£°æ˜éƒ½æŒªåˆ° for å¾ªç¯çš„å¤–é¢ï¼Œå¯ä»¥çœ‹åˆ°å¯¹äº str çš„å½±å“ä¼šæ›´å¤§ä¸€äº›ï¼Œä½†æ˜¯è¿™ä¸ªå’Œæœ¬æ¬¡æ€§èƒ½æµ‹è¯•æ— å…³ï¼Œåº”è¯¥æ˜¯ç”± string å’Œ bytes.Buff çš„ç‰¹æ€§å†³å®šçš„ã€‚","like_count":2},{"had_liked":false,"id":367536,"user_name":"èª","can_delete":false,"product_type":"c3","uid":2058233,"ip_address":"å¹¿ä¸œ","ucode":"BB979E798CC247","user_header":"https://static001.geekbang.org/account/avatar/00/1f/67/f9/b81705cf.jpg","comment_is_top":false,"comment_ctime":1675308299,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"åˆšæµ‹è¯•äº†ä¸€ä¸‹ï¼Œæµ‹è¯•å°†æµ‹è¯•ç¨‹åºä»£ç æ®µå•ç‹¬å°è£…\n\nfunc ConcatStringByAdd(elems []string) string{\n\tret := &quot;&quot;\n\tfor _, elem := range elems {\n\t\tret += elem\n\t}\n\treturn ret\n}\n\nfunc ConcatStringByBytesBuffer(elems []string) string{\n\tvar buf bytes.Buffer\n\tfor _, elem := range elems {\n\t\tbuf.WriteString(elem)\n\t}\n\treturn buf.String()\n}\n\nç„¶åè¿›è¡Œå¯¹æ¯”æµ‹è¯•ï¼Œå‘ç°buffstirng æ“ä½œäº†å¤šä¸€æ¬¡å†…å­˜åˆ†é…ï¼Œæ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ\n\nfunc BenchmarkConcatStringByAdd(b *testing.B) {\n\telems := []string{&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;}\n\tb.ResetTimer()\n\tfor i := 0; i &lt; b.N; i++ {\n\t\tret := &quot;&quot;\n\t\tfor _, elem := range elems {\n\t\t\tret += elem\n\t\t}\n\n\t}\n\tb.StopTimer()\n}\n\nfunc BenchmarkConcatStringByAddFunc(b *testing.B) {\n\telems := []string{&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;}\n\tb.ResetTimer()\n\tfor i := 0; i &lt; b.N; i++ {\n\t\tConcatStringByAdd(elems)\n\t}\n\tb.StopTimer()\n}\nfunc BenchmarkConcatStringByBytesBuffer(b *testing.B) {\n\telems := []string{&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;}\n\tb.ResetTimer()\n\tfor i := 0; i &lt; b.N; i++ {\n\t\tvar buf bytes.Buffer\n\t\tfor _, elem := range elems {\n\t\t\tbuf.WriteString(elem)\n\t\t}\n\t}\n\tb.StopTimer()\n}\nfunc BenchmarkConcatStringByBytesBufferFunc(b *testing.B) {\n\telems := []string{&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;}\n\tb.ResetTimer()\n\tfor i := 0; i &lt; b.N; i++ {\n\t\tConcatStringByBytesBuffer(elems)\n\t}\n\tb.StopTimer()\n}\n\næµ‹è¯•ç»“æœï¼š\n\ngoos: windows\ngoarch: amd64\npkg: ch35&#47;benchmark\ncpu: 11th Gen Intel(R) Core(TM) i5-1135G7 @ 2.40GHz\nBenchmarkConcatStringByAdd-8                    11933446                97.55 ns&#47;op           16 B&#47;op          4 allocs&#47;op\nBenchmarkConcatStringByAddFunc-8                12663584                97.21 ns&#47;op           16 B&#47;op          4 allocs&#47;op\nBenchmarkConcatStringByBytesBuffer-8            23991170                50.52 ns&#47;op           64 B&#47;op          1 allocs&#47;op\nBenchmarkConcatStringByBytesBufferFunc-8        17990841                64.41 ns&#47;op           69 B&#47;op          2 allocs&#47;op\nPASS\nok      ch35&#47;benchmark  5.486s","like_count":0},{"had_liked":false,"id":337433,"user_name":"Return12321","can_delete":false,"product_type":"c3","uid":1134694,"ip_address":"","ucode":"F7A3C5ED02E1D9","user_header":"https://static001.geekbang.org/account/avatar/00/11/50/66/047ee060.jpg","comment_is_top":false,"comment_ctime":1646820487,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"å®Œå…¨å¯ä»¥æŠŠè¾“å‡ºçš„ç»“æœå­—æ®µè§£é‡Šè¡¥ä¸Šçš„","like_count":0},{"had_liked":false,"id":306485,"user_name":"å™¼é‡Œå•ªå•¦å•ªå•¦å™¼é‡Œå™¼é‡Œå•ªå•¦","can_delete":false,"product_type":"c3","uid":1109143,"ip_address":"","ucode":"2A4B86D38F7E11","user_header":"https://static001.geekbang.org/account/avatar/00/10/ec/97/58e7bc9a.jpg","comment_is_top":false,"comment_ctime":1628581326,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"func concatStringByAdd(elems []string) string {\n\tretString := &quot;&quot;\n\tfor _, elem := range elems {\n\t\tretString += elem\n\t}\n\treturn retString\n}\n\nfunc concatStringByBytesBuffer(elems []string) string {\n\tvar buf bytes.Buffer\n\tfor _, elem := range elems {\n\t\tbuf.WriteString(elem)\n\t}\n\treturn buf.String()\n}\n\nè€å¸ˆï¼Œè¯·é—®æˆ‘æŠŠå‡½æ•°å•ç‹¬å®šä¹‰äº†ï¼Œæ²¡æœ‰å†™é“Testé‡Œ. ç„¶åç”¨go test -bench=. -benchmemå°±æ²¡æœ‰ç›¸å…³ä¿¡æ¯äº†ã€‚è¯·é—®æ˜¯ä¸ºä»€ä¹ˆå‘¢\n$ go test -bench=. -benchmem\ngoos: windows\ngoarch: amd64\ncpu: Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz\nBenchmarkConcatStringByAdd-8            1000000000             0 B&#47;op          0 allocs&#47;op\nBenchmarkConcatStringByBytesBuffer-8    1000000000             0 B&#47;op          0 allocs&#47;op\nPASS\nok      _&#47;F_&#47;Work&#47;open_courses&#47;learninggo&#47;Chao_s_55_Sessions_of_Golang&#47;ch29&#47;benchmark   0.134s\n","like_count":0}]}