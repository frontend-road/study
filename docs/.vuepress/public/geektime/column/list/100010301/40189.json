{"id":40189,"title":"27 | æ³¨è§£å¤„ç†å™¨","content":"<p>æ³¨è§£ï¼ˆannotationï¼‰æ˜¯Java 5å¼•å…¥çš„ï¼Œç”¨æ¥ä¸ºç±»ã€æ–¹æ³•ã€å­—æ®µã€å‚æ•°ç­‰Javaç»“æ„æä¾›é¢å¤–ä¿¡æ¯çš„æœºåˆ¶ã€‚æˆ‘å…ˆä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ï¼ŒJavaæ ¸å¿ƒç±»åº“ä¸­çš„<code>@Override</code>æ³¨è§£æ˜¯è¢«ç”¨æ¥å£°æ˜æŸä¸ªå®ä¾‹æ–¹æ³•é‡å†™äº†çˆ¶ç±»çš„åŒååŒå‚æ•°ç±»å‹çš„æ–¹æ³•ã€‚</p>\n<pre><code>package java.lang;\n\n@Target(ElementType.METHOD)\n@Retention(RetentionPolicy.SOURCE)\npublic @interface Override {\n}\n</code></pre>\n<p><code>@Override</code>æ³¨è§£æœ¬èº«è¢«å¦å¤–ä¸¤ä¸ªå…ƒæ³¨è§£ï¼ˆå³ä½œç”¨åœ¨æ³¨è§£ä¸Šçš„æ³¨è§£ï¼‰æ‰€æ ‡æ³¨ã€‚å…¶ä¸­ï¼Œ<code>@Target</code>ç”¨æ¥é™å®šç›®æ ‡æ³¨è§£æ‰€èƒ½æ ‡æ³¨çš„Javaç»“æ„ï¼Œè¿™é‡Œ<code>@Override</code>ä¾¿åªèƒ½è¢«ç”¨æ¥æ ‡æ³¨æ–¹æ³•ã€‚</p>\n<p><code>@Retention</code>åˆ™ç”¨æ¥é™å®šå½“å‰æ³¨è§£ç”Ÿå‘½å‘¨æœŸã€‚æ³¨è§£å…±æœ‰ä¸‰ç§ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸï¼š<code>SOURCE</code>ï¼Œ<code>CLASS</code>æˆ–<code>RUNTIME</code>ï¼Œåˆ†åˆ«è¡¨ç¤ºæ³¨è§£åªå‡ºç°åœ¨æºä»£ç ä¸­ï¼Œåªå‡ºç°åœ¨æºä»£ç å’Œå­—èŠ‚ç ä¸­ï¼Œä»¥åŠå‡ºç°åœ¨æºä»£ç ã€å­—èŠ‚ç å’Œè¿è¡Œè¿‡ç¨‹ä¸­ã€‚</p>\n<p>è¿™é‡Œ<code>@Override</code>ä¾¿åªèƒ½å‡ºç°åœ¨æºä»£ç ä¸­ã€‚ä¸€æ—¦æ ‡æ³¨äº†<code>@Override</code>çš„æ–¹æ³•æ‰€åœ¨çš„æºä»£ç è¢«ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼Œè¯¥æ³¨è§£ä¾¿ä¼šè¢«æ“¦é™¤ã€‚</p>\n<p>æˆ‘ä»¬ä¸éš¾çŒœåˆ°ï¼Œ<code>@Override</code>ä»…å¯¹Javaç¼–è¯‘å™¨æœ‰ç”¨ã€‚äº‹å®ä¸Šï¼Œå®ƒä¼šä¸ºJavaç¼–è¯‘å™¨å¼•å…¥äº†ä¸€æ¡æ–°çš„ç¼–è¯‘è§„åˆ™ï¼Œå³å¦‚æœæ‰€æ ‡æ³¨çš„æ–¹æ³•ä¸æ˜¯Javaè¯­è¨€ä¸­çš„é‡å†™æ–¹æ³•ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚è€Œå½“ç¼–è¯‘å®Œæˆæ—¶ï¼Œå®ƒçš„ä½¿å‘½ä¹Ÿå°±ç»“æŸäº†ã€‚</p>\n<p>æˆ‘ä»¬çŸ¥é“ï¼ŒJavaçš„æ³¨è§£æœºåˆ¶å…è®¸å¼€å‘äººå‘˜è‡ªå®šä¹‰æ³¨è§£ã€‚è¿™äº›è‡ªå®šä¹‰æ³¨è§£åŒæ ·å¯ä»¥ä¸ºJavaç¼–è¯‘å™¨æ·»åŠ ç¼–è¯‘è§„åˆ™ã€‚ä¸è¿‡ï¼Œè¿™ç§åŠŸèƒ½éœ€è¦ç”±å¼€å‘äººå‘˜æä¾›ï¼Œå¹¶ä¸”ä»¥æ’ä»¶çš„å½¢å¼æ¥å…¥Javaç¼–è¯‘å™¨ä¸­ï¼Œè¿™äº›æ’ä»¶æˆ‘ä»¬ç§°ä¹‹ä¸ºæ³¨è§£å¤„ç†å™¨ï¼ˆannotation processorï¼‰ã€‚</p><!-- [[[read_end]]] -->\n<p>é™¤äº†å¼•å…¥æ–°çš„ç¼–è¯‘è§„åˆ™ä¹‹å¤–ï¼Œæ³¨è§£å¤„ç†å™¨è¿˜å¯ä»¥ç”¨äºä¿®æ”¹å·²æœ‰çš„Javaæºæ–‡ä»¶ï¼ˆä¸æ¨èï¼‰ï¼Œæˆ–è€…ç”Ÿæˆæ–°çš„Javaæºæ–‡ä»¶ã€‚ä¸‹é¢ï¼Œæˆ‘å°†ç”¨å‡ ä¸ªæ¡ˆä¾‹æ¥è¯¦ç»†é˜è¿°æ³¨è§£å¤„ç†å™¨çš„è¿™äº›åŠŸèƒ½ï¼Œä»¥åŠå®ƒèƒŒåçš„åŸç†ã€‚</p>\n<h2>æ³¨è§£å¤„ç†å™¨çš„åŸç†</h2>\n<p>åœ¨ä»‹ç»æ³¨è§£å¤„ç†å™¨ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹Javaç¼–è¯‘å™¨çš„å·¥ä½œæµç¨‹ã€‚</p>\n<p><img src=\"https://static001.geekbang.org/resource/image/64/b8/64e93f67c3b422afd90966bfe9aaf5b8.png?wh=600*75\" alt=\"\" /></p>\n<p>å¦‚ä¸Šå›¾æ‰€ç¤º å‡ºå¤„[1]ï¼ŒJavaæºä»£ç çš„ç¼–è¯‘è¿‡ç¨‹å¯åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š</p>\n<ol>\n<li>å°†æºæ–‡ä»¶è§£æä¸ºæŠ½è±¡è¯­æ³•æ ‘ï¼›</li>\n<li>è°ƒç”¨å·²æ³¨å†Œçš„æ³¨è§£å¤„ç†å™¨ï¼›</li>\n<li>ç”Ÿæˆå­—èŠ‚ç ã€‚</li>\n</ol>\n<p>å¦‚æœåœ¨ç¬¬2æ­¥è°ƒç”¨æ³¨è§£å¤„ç†å™¨è¿‡ç¨‹ä¸­ç”Ÿæˆäº†æ–°çš„æºæ–‡ä»¶ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°†é‡å¤ç¬¬1ã€2æ­¥ï¼Œè§£æå¹¶ä¸”å¤„ç†æ–°ç”Ÿæˆçš„æºæ–‡ä»¶ã€‚æ¯æ¬¡é‡å¤æˆ‘ä»¬ç§°ä¹‹ä¸ºä¸€è½®ï¼ˆRoundï¼‰ã€‚</p>\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œç¬¬ä¸€è½®è§£æã€å¤„ç†çš„æ˜¯è¾“å…¥è‡³ç¼–è¯‘å™¨ä¸­çš„å·²æœ‰æºæ–‡ä»¶ã€‚å¦‚æœæ³¨è§£å¤„ç†å™¨ç”Ÿæˆäº†æ–°çš„æºæ–‡ä»¶ï¼Œåˆ™å¼€å§‹ç¬¬äºŒè½®ã€ç¬¬ä¸‰è½®ï¼Œè§£æå¹¶ä¸”å¤„ç†è¿™äº›æ–°ç”Ÿæˆçš„æºæ–‡ä»¶ã€‚å½“æ³¨è§£å¤„ç†å™¨ä¸å†ç”Ÿæˆæ–°çš„æºæ–‡ä»¶ï¼Œç¼–è¯‘è¿›å…¥æœ€åä¸€è½®ï¼Œå¹¶æœ€ç»ˆè¿›å…¥ç”Ÿæˆå­—èŠ‚ç çš„ç¬¬3æ­¥ã€‚</p>\n<pre><code>package foo;\n\nimport java.lang.annotation.*;\n\n@Target({ ElementType.TYPE, ElementType.FIELD })\n@Retention(RetentionPolicy.SOURCE)\npublic @interface CheckGetter {\n}\n</code></pre>\n<p>åœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘å®šä¹‰äº†ä¸€ä¸ªæ³¨è§£<code>@CheckGetter</code>ã€‚å®ƒæ—¢å¯ä»¥ç”¨æ¥æ ‡æ³¨ç±»ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥æ ‡æ³¨å­—æ®µã€‚æ­¤å¤–ï¼Œå®ƒå’Œ<code>@Override</code>ç›¸åŒï¼Œå…¶ç”Ÿå‘½å‘¨æœŸè¢«é™å®šåœ¨æºä»£ç ä¸­ã€‚</p>\n<p>ä¸‹é¢æˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªå¤„ç†<code>@CheckGetter</code>æ³¨è§£çš„å¤„ç†å™¨ã€‚å®ƒå°†éå†è¢«æ ‡æ³¨çš„ç±»ä¸­çš„å®ä¾‹å­—æ®µï¼Œå¹¶æ£€æŸ¥æœ‰æ²¡æœ‰ç›¸åº”çš„<code>getter</code>æ–¹æ³•ã€‚</p>\n<pre><code>public interface Processor {\n\n  void init(ProcessingEnvironment processingEnv);\n  \n  Set&lt;String&gt; getSupportedAnnotationTypes();\n  \n  SourceVersion getSupportedSourceVersion();\n  \n  boolean process(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment roundEnv);\n  \n  ...\n}\n</code></pre>\n<p>æ‰€æœ‰çš„æ³¨è§£å¤„ç†å™¨ç±»éƒ½éœ€è¦å®ç°æ¥å£<code>Processor</code>ã€‚è¯¥æ¥å£ä¸»è¦æœ‰å››ä¸ªé‡è¦æ–¹æ³•ã€‚å…¶ä¸­ï¼Œ<code>init</code>æ–¹æ³•ç”¨æ¥å­˜æ”¾æ³¨è§£å¤„ç†å™¨çš„åˆå§‹åŒ–ä»£ç ã€‚ä¹‹æ‰€ä»¥ä¸ç”¨æ„é€ å™¨ï¼Œæ˜¯å› ä¸ºåœ¨Javaç¼–è¯‘å™¨ä¸­ï¼Œæ³¨è§£å¤„ç†å™¨çš„å®ä¾‹æ˜¯é€šè¿‡åå°„APIç”Ÿæˆçš„ã€‚ä¹Ÿæ­£æ˜¯å› ä¸ºä½¿ç”¨åå°„APIï¼Œæ¯ä¸ªæ³¨è§£å¤„ç†å™¨ç±»éƒ½éœ€è¦å®šä¹‰ä¸€ä¸ªæ— å‚æ•°æ„é€ å™¨ã€‚</p>\n<p>é€šå¸¸æ¥è¯´ï¼Œå½“ç¼–å†™æ³¨è§£å¤„ç†å™¨æ—¶ï¼Œæˆ‘ä»¬ä¸å£°æ˜ä»»ä½•æ„é€ å™¨ï¼Œå¹¶ä¾èµ–äºJavaç¼–è¯‘å™¨ï¼Œä¸ºä¹‹æ’å…¥ä¸€ä¸ªæ— å‚æ•°æ„é€ å™¨ã€‚è€Œå…·ä½“çš„åˆå§‹åŒ–ä»£ç ï¼Œåˆ™æ”¾å…¥<code>init</code>æ–¹æ³•ä¹‹ä¸­ã€‚</p>\n<p>åœ¨å‰©ä¸‹çš„ä¸‰ä¸ªæ–¹æ³•ä¸­ï¼Œ<code>getSupportedAnnotationTypes</code>æ–¹æ³•å°†è¿”å›æ³¨è§£å¤„ç†å™¨æ‰€æ”¯æŒçš„æ³¨è§£ç±»å‹ï¼Œè¿™äº›æ³¨è§£ç±»å‹åªéœ€ç”¨å­—ç¬¦ä¸²å½¢å¼è¡¨ç¤ºå³å¯ã€‚</p>\n<p><code>getSupportedSourceVersion</code>æ–¹æ³•å°†è¿”å›è¯¥å¤„ç†å™¨æ‰€æ”¯æŒçš„Javaç‰ˆæœ¬ï¼Œé€šå¸¸ï¼Œè¿™ä¸ªç‰ˆæœ¬éœ€è¦ä¸ä½ çš„Javaç¼–è¯‘å™¨ç‰ˆæœ¬ä¿æŒä¸€è‡´ï¼›è€Œ<code>process</code>æ–¹æ³•åˆ™æ˜¯æœ€ä¸ºå…³é”®çš„æ³¨è§£å¤„ç†æ–¹æ³•ã€‚</p>\n<p>JDKæä¾›äº†ä¸€ä¸ªå®ç°<code>Processor</code>æ¥å£çš„æŠ½è±¡ç±»<code>AbstractProcessor</code>ã€‚è¯¥æŠ½è±¡ç±»å®ç°äº†<code>init</code>ã€<code>getSupportedAnnotationTypes</code>å’Œ<code>getSupportedSourceVersion</code>æ–¹æ³•ã€‚</p>\n<p>å®ƒçš„å­ç±»å¯ä»¥é€šè¿‡<code>@SupportedAnnotationTypes</code>å’Œ<code>@SupportedSourceVersion</code>æ³¨è§£æ¥å£°æ˜æ‰€æ”¯æŒçš„æ³¨è§£ç±»å‹ä»¥åŠJavaç‰ˆæœ¬ã€‚</p>\n<p>ä¸‹é¢è¿™æ®µä»£ç ä¾¿æ˜¯<code>@CheckGetter</code>æ³¨è§£å¤„ç†å™¨çš„å®ç°ã€‚ç”±äºæˆ‘ä½¿ç”¨äº†Java 10çš„ç¼–è¯‘å™¨ï¼Œå› æ­¤å°†æ”¯æŒç‰ˆæœ¬è®¾ç½®ä¸º<code>SourceVersion.RELEASE_10</code>ã€‚</p>\n<pre><code>package bar;\n\nimport java.util.Set;\n\nimport javax.annotation.processing.*;\nimport javax.lang.model.SourceVersion;\nimport javax.lang.model.element.*;\nimport javax.lang.model.util.ElementFilter;\nimport javax.tools.Diagnostic.Kind;\n\nimport foo.CheckGetter;\n\n@SupportedAnnotationTypes(&quot;foo.CheckGetter&quot;)\n@SupportedSourceVersion(SourceVersion.RELEASE_10)\npublic class CheckGetterProcessor extends AbstractProcessor {\n\n  @Override\n  public boolean process(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment roundEnv) {\n    // TODO: annotated ElementKind.FIELD\n    for (TypeElement annotatedClass : ElementFilter.typesIn(roundEnv.getElementsAnnotatedWith(CheckGetter.class))) {\n      for (VariableElement field : ElementFilter.fieldsIn(annotatedClass.getEnclosedElements())) {\n        if (!containsGetter(annotatedClass, field.getSimpleName().toString())) {\n          processingEnv.getMessager().printMessage(Kind.ERROR,\n              String.format(&quot;getter not found for '%s.%s'.&quot;, annotatedClass.getSimpleName(), field.getSimpleName()));\n        }\n      }\n    }\n    return true;\n  }\n\n  private static boolean containsGetter(TypeElement typeElement, String name) {\n    String getter = &quot;get&quot; + name.substring(0, 1).toUpperCase() + name.substring(1).toLowerCase();\n    for (ExecutableElement executableElement : ElementFilter.methodsIn(typeElement.getEnclosedElements())) {\n      if (!executableElement.getModifiers().contains(Modifier.STATIC)\n          &amp;&amp; executableElement.getSimpleName().toString().equals(getter)\n          &amp;&amp; executableElement.getParameters().isEmpty()) {\n        return true;\n      }\n    }\n    return false;\n  }\n}\n</code></pre>\n<p>è¯¥æ³¨è§£å¤„ç†å™¨ä»…é‡å†™äº†<code>process</code>æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•å°†æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä»£è¡¨è¯¥æ³¨è§£å¤„ç†å™¨æ‰€èƒ½å¤„ç†çš„æ³¨è§£ç±»å‹ï¼Œä»¥åŠå›Šæ‹¬å½“å‰è½®ç”Ÿæˆçš„æŠ½è±¡è¯­æ³•æ ‘çš„<code>RoundEnvironment</code>ã€‚</p>\n<p>ç”±äºè¯¥å¤„ç†å™¨é’ˆå¯¹çš„æ³¨è§£ä»…æœ‰<code>@CheckGetter</code>ä¸€ä¸ªï¼Œè€Œä¸”æˆ‘ä»¬å¹¶ä¸ä¼šè¯»å–æ³¨è§£ä¸­çš„å€¼ï¼Œå› æ­¤ç¬¬ä¸€ä¸ªå‚æ•°å¹¶ä¸é‡è¦ã€‚åœ¨ä»£ç ä¸­ï¼Œæˆ‘ç›´æ¥ä½¿ç”¨äº†</p>\n<pre><code>`roundEnv.getElementsAnnotatedWith(CheckGetter.class)`\n</code></pre>\n<p>æ¥è·å–æ‰€æœ‰è¢«<code>@CheckGetter</code>æ³¨è§£çš„ç±»ï¼ˆä»¥åŠå­—æ®µï¼‰ã€‚</p>\n<p><code>process</code>æ–¹æ³•æ¶‰åŠå„ç§ä¸åŒç±»å‹çš„<code>Element</code>ï¼Œåˆ†åˆ«æŒ‡ä»£Javaç¨‹åºä¸­çš„å„ä¸ªç»“æ„ã€‚å¦‚<code>TypeElement</code>æŒ‡ä»£ç±»æˆ–è€…æ¥å£ï¼Œ<code>VariableElement</code>æŒ‡ä»£å­—æ®µã€å±€éƒ¨å˜é‡ã€enumå¸¸é‡ç­‰ï¼Œ<code>ExecutableElement</code>æŒ‡ä»£æ–¹æ³•æˆ–è€…æ„é€ å™¨ã€‚</p>\n<pre><code>package foo;     // PackageElement\n\nclass Foo {      // TypeElement\n  int a;           // VariableElement\n  static int b;    // VariableElement\n  Foo () {}        // ExecutableElement\n  void setA (      // ExecutableElement\n    int newA         // VariableElement\n  ) {}\n}\n</code></pre>\n<p>è¿™äº›ç»“æ„ä¹‹é—´ä¹Ÿæœ‰ä»å±å…³ç³»ï¼Œå¦‚ä¸Šé¢è¿™æ®µä»£ç æ‰€ç¤º(å‡ºå¤„[2]ï¼‰ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>TypeElement.getEnclosedElements</code>æ–¹æ³•ï¼Œè·å¾—ä¸Šé¢è¿™æ®µä»£ç ä¸­<code>Foo</code>ç±»çš„å­—æ®µã€æ„é€ å™¨ä»¥åŠæ–¹æ³•ã€‚</p>\n<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡<code>ExecutableElement.getParameters</code>æ–¹æ³•ï¼Œè·å¾—<code>setA</code>æ–¹æ³•çš„å‚æ•°ã€‚å…·ä½“è¿™äº›<code>Element</code>ç±»éƒ½æœ‰å“ªäº›APIï¼Œä½ å¯ä»¥å‚è€ƒå®ƒä»¬çš„Javadoc[3]ã€‚</p>\n<p>åœ¨å°†è¯¥æ³¨è§£å¤„ç†å™¨ç¼–è¯‘æˆclassæ–‡ä»¶åï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥å°†å…¶æ³¨å†Œä¸ºJavaç¼–è¯‘å™¨çš„æ’ä»¶ï¼Œå¹¶ç”¨æ¥å¤„ç†å…¶ä»–æºä»£ç ã€‚æ³¨å†Œçš„æ–¹æ³•ä¸»è¦æœ‰ä¸¤ç§ã€‚ç¬¬ä¸€ç§æ˜¯ç›´æ¥ä½¿ç”¨javacå‘½ä»¤çš„<code>-processor</code>å‚æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<pre><code>$ javac -cp /CLASSPATH/TO/CheckGetterProcessor -processor bar.CheckGetterProcessor Foo.java\nerror: Class 'Foo' is annotated as @CheckGetter, but field 'a' is without getter\n1 error\n</code></pre>\n<p>ç¬¬äºŒç§åˆ™æ˜¯å°†æ³¨è§£å¤„ç†å™¨ç¼–è¯‘ç”Ÿæˆçš„classæ–‡ä»¶å‹ç¼©å…¥jaråŒ…ä¸­ï¼Œå¹¶åœ¨jaråŒ…çš„é…ç½®æ–‡ä»¶ä¸­è®°å½•è¯¥æ³¨è§£å¤„ç†å™¨çš„åŒ…ååŠç±»åï¼Œå³<code>bar.CheckGetterProcessor</code>ã€‚</p>\n<pre><code>ï¼ˆå…·ä½“è·¯å¾„åŠé…ç½®æ–‡ä»¶åä¸º`META-INF/services/javax.annotation.processing.Processor`ï¼‰\n</code></pre>\n<p>å½“å¯åŠ¨Javaç¼–è¯‘å™¨æ—¶ï¼Œå®ƒä¼šå¯»æ‰¾classpathè·¯å¾„ä¸Šçš„jaråŒ…æ˜¯å¦åŒ…å«ä¸Šè¿°é…ç½®æ–‡ä»¶ï¼Œå¹¶è‡ªåŠ¨æ³¨å†Œå…¶ä¸­è®°å½•çš„æ³¨è§£å¤„ç†å™¨ã€‚</p>\n<pre><code>$ javac -cp /PATH/TO/CheckGetterProcessor.jar Foo.java\nerror: Class 'Foo' is annotated as @CheckGetter, but field 'a' is without getter\n1 error\n</code></pre>\n<p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨IDEä¸­é…ç½®æ³¨è§£å¤„ç†å™¨ã€‚è¿™é‡Œæˆ‘å°±ä¸è¿‡å¤šæ¼”ç¤ºäº†ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œæœç´¢ã€‚</p>\n<h2>åˆ©ç”¨æ³¨è§£å¤„ç†å™¨ç”Ÿæˆæºä»£ç </h2>\n<p>å‰é¢æåˆ°ï¼Œæ³¨è§£å¤„ç†å™¨å¯ä»¥ç”¨æ¥ä¿®æ”¹å·²æœ‰æºä»£ç æˆ–è€…ç”Ÿæˆæºä»£ç ã€‚</p>\n<p>ç¡®åˆ‡åœ°è¯´ï¼Œæ³¨è§£å¤„ç†å™¨å¹¶ä¸èƒ½çœŸæ­£åœ°ä¿®æ”¹å·²æœ‰æºä»£ç ã€‚è¿™é‡ŒæŒ‡çš„æ˜¯ä¿®æ”¹ç”±Javaæºä»£ç ç”Ÿæˆçš„æŠ½è±¡è¯­æ³•æ ‘ï¼Œåœ¨å…¶ä¸­ä¿®æ”¹å·²æœ‰æ ‘èŠ‚ç‚¹æˆ–è€…æ’å…¥æ–°çš„æ ‘èŠ‚ç‚¹ï¼Œä»è€Œä½¿ç”Ÿæˆçš„å­—èŠ‚ç å‘ç”Ÿå˜åŒ–ã€‚</p>\n<p>å¯¹æŠ½è±¡è¯­æ³•æ ‘çš„ä¿®æ”¹æ¶‰åŠäº†Javaç¼–è¯‘å™¨çš„å†…éƒ¨APIï¼Œè¿™éƒ¨åˆ†å¾ˆå¯èƒ½éšç€ç‰ˆæœ¬å˜æ›´è€Œå¤±æ•ˆã€‚å› æ­¤ï¼Œæˆ‘å¹¶ä¸æ¨èè¿™ç§ä¿®æ”¹æ–¹å¼ã€‚</p>\n<p>å¦‚æœä½ æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥å‚è€ƒ[Project Lombok][4]ã€‚è¿™ä¸ªé¡¹ç›®è‡ªå®šä¹‰äº†ä¸€ç³»åˆ—æ³¨è§£ï¼Œå¹¶æ ¹æ®æ³¨è§£çš„å†…å®¹æ¥ä¿®æ”¹å·²æœ‰çš„æºä»£ç ã€‚ä¾‹å¦‚å®ƒæä¾›äº†<code>@Getter</code>å’Œ<code>@Setter</code>æ³¨è§£ï¼Œèƒ½å¤Ÿä¸ºç¨‹åºè‡ªåŠ¨æ·»åŠ <code>getter</code>ä»¥åŠ<code>setter</code>æ–¹æ³•ã€‚æœ‰å…³å¯¹ä½¿ç”¨å†…éƒ¨APIçš„è®¨è®ºï¼Œä½ å¯ä»¥å‚è€ƒ[è¿™ç¯‡åšå®¢][5]ï¼Œä»¥åŠ[Lombokçš„å›åº”][6]ã€‚</p>\n<p>ç”¨æ³¨è§£å¤„ç†å™¨æ¥ç”Ÿæˆæºä»£ç åˆ™æ¯”è¾ƒå¸¸ç”¨ã€‚æˆ‘ä»¬ä»¥å‰ä»‹ç»è¿‡çš„å‹åŠ›æµ‹è¯•jcstressï¼Œä»¥åŠæ¥ä¸‹æ¥å³å°†ä»‹ç»çš„JMHå·¥å…·ï¼Œéƒ½æ˜¯ä¾èµ–è¿™ç§æ–¹å¼æ¥ç”Ÿæˆæµ‹è¯•ä»£ç çš„ã€‚</p>\n<pre><code>package foo;\n\nimport java.lang.annotation.*;\n\n@Target(ElementType.METHOD)\n@Retention(RetentionPolicy.SOURCE)\npublic @interface Adapt {\n  Class&lt;?&gt; value();\n}\n</code></pre>\n<p>åœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘å®šä¹‰äº†ä¸€ä¸ªæ³¨è§£<code>@Adapt</code>ã€‚è¿™ä¸ªæ³¨è§£å°†æ¥æ”¶ä¸€ä¸ª<code>Class</code>ç±»å‹çš„å‚æ•°<code>value</code>ï¼ˆå¦‚æœæ³¨è§£ç±»ä»…åŒ…å«ä¸€ä¸ªåä¸º<code>value</code>çš„å‚æ•°æ—¶ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨æ³¨è§£æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœç•¥<code>value=</code>ï¼‰ï¼Œå…·ä½“ç”¨æ³•å¦‚è¿™æ®µä»£ç æ‰€ç¤ºã€‚</p>\n<pre><code>// Bar.java\npackage test;\nimport java.util.function.IntBinaryOperator;\nimport foo.Adapt;\n\npublic class Bar {\n  @Adapt(IntBinaryOperator.class)\n  public static int add(int a, int b) {\n    return a + b;\n  }\n}\n</code></pre>\n<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªå¤„ç†<code>@Adapt</code>æ³¨è§£çš„å¤„ç†å™¨ã€‚è¯¥å¤„ç†å™¨å°†ç”Ÿæˆä¸€ä¸ªæ–°çš„æºæ–‡ä»¶ï¼Œå®ç°å‚æ•°<code>value</code>æ‰€æŒ‡å®šçš„æ¥å£ï¼Œå¹¶ä¸”è°ƒç”¨è‡³è¢«è¯¥æ³¨è§£æ‰€æ ‡æ³¨çš„æ–¹æ³•ä¹‹ä¸­ã€‚å…·ä½“çš„å®ç°ä»£ç æ¯”è¾ƒé•¿ï¼Œå»ºè®®ä½ åœ¨<a href=\"https://time.geekbang.org/column/108\">ç½‘é¡µç«¯</a>è§‚çœ‹ã€‚</p>\n<pre><code>package bar;\n\nimport java.io.*;\nimport java.util.Set;\n\nimport javax.annotation.processing.*;\nimport javax.lang.model.SourceVersion;\nimport javax.lang.model.element.*;\nimport javax.lang.model.type.TypeMirror;\nimport javax.lang.model.util.ElementFilter;\nimport javax.tools.JavaFileObject;\n\nimport javax.tools.Diagnostic.Kind;\n\n@SupportedAnnotationTypes(&quot;foo.Adapt&quot;)\n@SupportedSourceVersion(SourceVersion.RELEASE_10)\npublic class AdaptProcessor extends AbstractProcessor {\n\n  @Override\n  public boolean process(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment roundEnv) {\n    for (TypeElement annotation : annotations) {\n      if (!&quot;foo.Adapt&quot;.equals(annotation.getQualifiedName().toString())) {\n        continue;\n      }\n\n      ExecutableElement targetAsKey = getExecutable(annotation, &quot;value&quot;);\n\n      for (ExecutableElement annotatedMethod : ElementFilter.methodsIn(roundEnv.getElementsAnnotatedWith(annotation))) {\n        if (!annotatedMethod.getModifiers().contains(Modifier.PUBLIC)) {\n          processingEnv.getMessager().printMessage(Kind.ERROR, &quot;@Adapt on non-public method&quot;);\n          continue;\n        }\n        if (!annotatedMethod.getModifiers().contains(Modifier.STATIC)) {\n          // TODO support non-static methods\n          continue;\n        }\n\n        TypeElement targetInterface = getAnnotationValueAsTypeElement(annotatedMethod, annotation, targetAsKey);\n        if (targetInterface.getKind() != ElementKind.INTERFACE) {\n          processingEnv.getMessager().printMessage(Kind.ERROR, &quot;@Adapt with non-interface input&quot;);\n          continue;\n        }\n\n        TypeElement enclosingType = getTopLevelEnclosingType(annotatedMethod);\n        createAdapter(enclosingType, annotatedMethod, targetInterface);\n      }\n    }\n    return true;\n  }\n\n  private void createAdapter(TypeElement enclosingClass, ExecutableElement annotatedMethod,\n      TypeElement targetInterface) {\n    PackageElement packageElement = (PackageElement) enclosingClass.getEnclosingElement();\n    String packageName = packageElement.getQualifiedName().toString();\n    String className = enclosingClass.getSimpleName().toString();\n    String methodName = annotatedMethod.getSimpleName().toString();\n    String adapterName = className + &quot;_&quot; + methodName + &quot;Adapter&quot;;\n\n    ExecutableElement overriddenMethod = getFirstNonDefaultExecutable(targetInterface);\n\n    try {\n      Filer filer = processingEnv.getFiler();\n      JavaFileObject sourceFile = filer.createSourceFile(packageName + &quot;.&quot; + adapterName, new Element[0]);\n\n      try (PrintWriter out = new PrintWriter(sourceFile.openWriter())) {\n        out.println(&quot;package &quot; + packageName + &quot;;&quot;);\n        out.println(&quot;import &quot; + targetInterface.getQualifiedName() + &quot;;&quot;);\n        out.println();\n        out.println(&quot;public class &quot; + adapterName + &quot; implements &quot; + targetInterface.getSimpleName() + &quot; {&quot;);\n        out.println(&quot;  @Override&quot;);\n        out.println(&quot;  public &quot; + overriddenMethod.getReturnType() + &quot; &quot; + overriddenMethod.getSimpleName()\n            + formatParameter(overriddenMethod, true) + &quot; {&quot;);\n        out.println(&quot;    return &quot; + className + &quot;.&quot; + methodName + formatParameter(overriddenMethod, false) + &quot;;&quot;);\n        out.println(&quot;  }&quot;);\n        out.println(&quot;}&quot;);\n      }\n    } catch (IOException e) {\n      throw new RuntimeException(e);\n    }\n  }\n\n  private ExecutableElement getExecutable(TypeElement annotation, String methodName) {\n    for (ExecutableElement method : ElementFilter.methodsIn(annotation.getEnclosedElements())) {\n      if (methodName.equals(method.getSimpleName().toString())) {\n        return method;\n      }\n    }\n    processingEnv.getMessager().printMessage(Kind.ERROR, &quot;Incompatible @Adapt.&quot;);\n    return null;\n  }\n\n  private ExecutableElement getFirstNonDefaultExecutable(TypeElement annotation) {\n    for (ExecutableElement method : ElementFilter.methodsIn(annotation.getEnclosedElements())) {\n      if (!method.isDefault()) {\n        return method;\n      }\n    }\n    processingEnv.getMessager().printMessage(Kind.ERROR,\n        &quot;Target interface should declare at least one non-default method.&quot;);\n    return null;\n  }\n\n  private TypeElement getAnnotationValueAsTypeElement(ExecutableElement annotatedMethod, TypeElement annotation,\n      ExecutableElement annotationFunction) {\n    TypeMirror annotationType = annotation.asType();\n\n    for (AnnotationMirror annotationMirror : annotatedMethod.getAnnotationMirrors()) {\n      if (processingEnv.getTypeUtils().isSameType(annotationMirror.getAnnotationType(), annotationType)) {\n        AnnotationValue value = annotationMirror.getElementValues().get(annotationFunction);\n        if (value == null) {\n          processingEnv.getMessager().printMessage(Kind.ERROR, &quot;Unknown @Adapt target&quot;);\n          continue;\n        }\n        TypeMirror targetInterfaceTypeMirror = (TypeMirror) value.getValue();\n        return (TypeElement) processingEnv.getTypeUtils().asElement(targetInterfaceTypeMirror);\n      }\n    }\n    processingEnv.getMessager().printMessage(Kind.ERROR, &quot;@Adapt should contain target()&quot;);\n    return null;\n  }\n\n  private TypeElement getTopLevelEnclosingType(ExecutableElement annotatedMethod) {\n    TypeElement enclosingType = null;\n    Element enclosing = annotatedMethod.getEnclosingElement();\n\n    while (enclosing != null) {\n      if (enclosing.getKind() == ElementKind.CLASS) {\n        enclosingType = (TypeElement) enclosing;\n      } else if (enclosing.getKind() == ElementKind.PACKAGE) {\n        break;\n      }\n      enclosing = enclosing.getEnclosingElement();\n    }\n    return enclosingType;\n  }\n\n  private String formatParameter(ExecutableElement method, boolean includeType) {\n    StringBuilder builder = new StringBuilder();\n    builder.append('(');\n    String separator = &quot;&quot;;\n\n    for (VariableElement parameter : method.getParameters()) {\n      builder.append(separator);\n      if (includeType) {\n        builder.append(parameter.asType());\n        builder.append(' ');\n      }\n      builder.append(parameter.getSimpleName());\n      separator = &quot;, &quot;;\n    }\n    builder.append(')');\n    return builder.toString();\n  }\n}\n</code></pre>\n<p>åœ¨è¿™ä¸ªæ³¨è§£å¤„ç†å™¨å®ç°ä¸­ï¼Œæˆ‘ä»¬å°†è¯»å–æ³¨è§£ä¸­çš„å€¼ï¼Œå› æ­¤æˆ‘å°†ä½¿ç”¨<code>process</code>æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¹¶é€šè¿‡å®ƒè·å¾—è¢«æ ‡æ³¨æ–¹æ³•å¯¹åº”çš„<code>@Adapt</code>æ³¨è§£ä¸­çš„<code>value</code>å€¼ã€‚</p>\n<p>ä¹‹æ‰€ä»¥é‡‡ç”¨è¿™ç§éº»çƒ¦çš„æ–¹å¼ï¼Œæ˜¯å› ä¸º<code>value</code>å€¼å±äº<code>Class</code>ç±»å‹ã€‚åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œè¢«ç¼–è¯‘ä»£ç ä¸­çš„<code>Class</code>å¸¸é‡æœªå¿…è¢«åŠ è½½è¿›Javaç¼–è¯‘å™¨æ‰€åœ¨çš„è™šæ‹Ÿæœºä¸­ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡<code>process</code>æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè·å¾—<code>value</code>æ‰€æŒ‡å‘çš„æ¥å£çš„æŠ½è±¡è¯­æ³•æ ‘ï¼Œå¹¶æ®æ­¤ç”Ÿæˆæºä»£ç ã€‚</p>\n<p>ç”Ÿæˆæºä»£ç çš„æ–¹å¼å®é™…ä¸Šéå¸¸å®¹æ˜“ç†è§£ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>Filer.createSourceFile</code>æ–¹æ³•è·å¾—ä¸€ä¸ªç±»ä¼¼äºæ–‡ä»¶çš„æ¦‚å¿µï¼Œå¹¶é€šè¿‡<code>PrintWriter</code>å°†å…·ä½“çš„å†…å®¹ä¸€ä¸€å†™å…¥å³å¯ã€‚</p>\n<p>å½“å°†è¯¥æ³¨è§£å¤„ç†å™¨ä½œä¸ºæ’ä»¶æ¥å…¥Javaç¼–è¯‘å™¨æ—¶ï¼Œç¼–è¯‘å‰é¢çš„<code>test/Bar.java</code>å°†ç”Ÿæˆä¸‹è¿°ä»£ç ï¼Œå¹¶ä¸”è§¦å‘æ–°ä¸€è½®çš„ç¼–è¯‘ã€‚</p>\n<pre><code>package test;\nimport java.util.function.IntBinaryOperator;\n\npublic class Bar_addAdapter implements IntBinaryOperator {\n  @Override\n  public int applyAsInt(int arg0, int arg1) {\n    return Bar.add(arg0, arg1);\n  }\n}\n</code></pre>\n<blockquote>\n<p>æ³¨æ„ï¼Œè¯¥æ³¨è§£å¤„ç†å™¨æ²¡æœ‰å¤„ç†æ‰€ç¼–è¯‘çš„ä»£ç åŒ…åä¸ºç©ºçš„æƒ…å†µã€‚</p>\n</blockquote>\n<h2>æ€»ç»“ä¸å®è·µ</h2>\n<p>ä»Šå¤©æˆ‘ä»‹ç»äº†Javaç¼–è¯‘å™¨çš„æ³¨è§£å¤„ç†å™¨ã€‚</p>\n<p>æ³¨è§£å¤„ç†å™¨ä¸»è¦æœ‰ä¸‰ä¸ªç”¨é€”ã€‚ä¸€æ˜¯å®šä¹‰ç¼–è¯‘è§„åˆ™ï¼Œå¹¶æ£€æŸ¥è¢«ç¼–è¯‘çš„æºæ–‡ä»¶ã€‚äºŒæ˜¯ä¿®æ”¹å·²æœ‰æºä»£ç ã€‚ä¸‰æ˜¯ç”Ÿæˆæ–°çš„æºä»£ç ã€‚å…¶ä¸­ï¼Œç¬¬äºŒç§æ¶‰åŠäº†Javaç¼–è¯‘å™¨çš„å†…éƒ¨APIï¼Œå› æ­¤å¹¶ä¸æ¨èã€‚ç¬¬ä¸‰ç§è¾ƒä¸ºå¸¸è§ï¼Œæ˜¯OpenJDKå·¥å…·jcstressï¼Œä»¥åŠJMHç”Ÿæˆæµ‹è¯•ä»£ç çš„æ–¹å¼ã€‚</p>\n<p>Javaæºä»£ç çš„ç¼–è¯‘è¿‡ç¨‹å¯åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼Œåˆ†åˆ«ä¸ºè§£ææºæ–‡ä»¶ç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘ï¼Œè°ƒç”¨å·²æ³¨å†Œçš„æ³¨è§£å¤„ç†å™¨ï¼Œå’Œç”Ÿæˆå­—èŠ‚ç ã€‚å¦‚æœåœ¨ç¬¬2æ­¥ä¸­ï¼Œæ³¨è§£å¤„ç†å™¨ç”Ÿæˆäº†æ–°çš„æºä»£ç ï¼Œé‚£ä¹ˆJavaç¼–è¯‘å™¨å°†é‡å¤ç¬¬1ã€2æ­¥ï¼Œç›´è‡³ä¸å†ç”Ÿæˆæ–°çš„æºä»£ç ã€‚</p>\n<hr />\n<p>ä»Šå¤©çš„å®è·µç¯èŠ‚ï¼Œè¯·å®ç°æœ¬æ–‡çš„æ¡ˆä¾‹<code>CheckGetterProcessor</code>ä¸­çš„TODOé¡¹ï¼Œå¤„ç†ç”±<code>@CheckGetter</code>æ³¨è§£çš„å­—æ®µã€‚</p>\n<p>[1] <a href=\"http://openjdk.java.net/groups/compiler/doc/compilation-overview/index.html\">http://openjdk.java.net/groups/compiler/doc/compilation-overview/index.html</a><br />\n[2] <a href=\"http://hannesdorfmann.com/annotation-processing/annotationprocessing101\">http://hannesdorfmann.com/annotation-processing/annotationprocessing101</a><br />\n[3] <a href=\"https://docs.oracle.com/javase/10/docs/api/javax/lang/model/element/package-summary.html\">https://docs.oracle.com/javase/10/docs/api/javax/lang/model/element/package-summary.html</a><br />\n[4] <a href=\"https://projectlombok.org/\">https://projectlombok.org/</a><br />\n[5] <a href=\"http://notatube.blogspot.com/2010/11/project-lombok-trick-explained.html\">http://notatube.blogspot.com/2010/11/project-lombok-trick-explained.html</a><br />\n[6] <a href=\"http://jnb.ociweb.com/jnb/jnbJan2010.html#controversy\">http://jnb.ociweb.com/jnb/jnbJan2010.html#controversy</a></p>\n<p></p>\n","comments":[{"had_liked":false,"id":26053,"user_name":"èšå˜","can_delete":false,"product_type":"c1","uid":1006040,"ip_address":"","ucode":"1068849263833F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/59/d8/baf0dea1.jpg","comment_is_top":false,"comment_ctime":1537493808,"is_pvip":false,"replies":[{"id":"9514","content":"Cglibç­‰å­—èŠ‚ç å·¥å…·ä¼šå½±å“å¯åŠ¨æ€§èƒ½ï¼Œå³°å€¼æ€§èƒ½ä¸Šæ²¡å•¥åŒºåˆ«ã€‚<br><br>å¦‚æœå¯¹å­—èŠ‚ç ä¸ç†Ÿçš„è¯ï¼Œç”¨æ³¨è§£å¤„ç†å™¨æ¯”è¾ƒå®¹æ˜“äº›ã€‚å¦ä¸€æ–¹é¢ï¼Œå­—èŠ‚ç å¤„ç†å·¥å…·æ›´å¼ºå¤§äº›ï¼Œèƒ½åšå¾ˆå¤šæºä»£ç ä¸èƒ½åšçš„ã€‚","user_name":"ä½œè€…å›å¤","comment_id":26053,"uid":"1176688","ip_address":"","utype":1,"ctime":1537512986,"user_name_real":"éƒ‘é›¨è¿ª"}],"discussion_count":1,"race_medal":0,"score":"70256970544","product_id":100010301,"comment_content":"ç¼–è¯‘æ—¶ç”Ÿæˆä¸ è¿è¡Œæ—¶ä½¿ç”¨cglibç­‰ç±»åº“ç”Ÿæˆçš„å­—èŠ‚ç ,åœ¨æ€§èƒ½å’Œä½¿ç”¨åœºæ™¯ä¸Šæœ‰ä»€ä¹ˆåŒºåˆ«å—??","like_count":17,"discussions":[{"author":{"id":1176688,"avatar":"https://static001.geekbang.org/account/avatar/00/11/f4/70/2f61fa20.jpg","nickname":"éƒ‘é›¨è¿ª","note":"","ucode":"F7CA1AE501EAFF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424507,"discussion_content":"Cglibç­‰å­—èŠ‚ç å·¥å…·ä¼šå½±å“å¯åŠ¨æ€§èƒ½ï¼Œå³°å€¼æ€§èƒ½ä¸Šæ²¡å•¥åŒºåˆ«ã€‚\n\nå¦‚æœå¯¹å­—èŠ‚ç ä¸ç†Ÿçš„è¯ï¼Œç”¨æ³¨è§£å¤„ç†å™¨æ¯”è¾ƒå®¹æ˜“äº›ã€‚å¦ä¸€æ–¹é¢ï¼Œå­—èŠ‚ç å¤„ç†å·¥å…·æ›´å¼ºå¤§äº›ï¼Œèƒ½åšå¾ˆå¤šæºä»£ç ä¸èƒ½åšçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537512986,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":26984,"user_name":"é’±","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1537790434,"is_pvip":false,"replies":[{"id":"10287","content":"æ³¨è§£ç›¸å½“äºç»™æŸäº›ä»£ç è´´äº†ä¸ªæ ‡ç­¾ã€‚æˆ‘ä»¬æ—¢å¯ä»¥é€šè¿‡æ³¨è§£å¤„ç†å™¨åœ¨ç¼–è¯‘æ—¶è§£æè¿™äº›æ ‡ç­¾ï¼Œä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡åå°„è§£æè¿™äº›æ ‡ç­¾ã€‚è§£æåéƒ½ä¼šæœ‰ä¸€ç³»åˆ—åŠ¨ä½œï¼Œè¿™äº›åŠ¨ä½œå°±æ˜¯å¯¹æ ‡ç­¾è¯­ä¹‰çš„è¯ é‡Šã€‚","user_name":"ä½œè€…å›å¤","comment_id":26984,"uid":"1176688","ip_address":"","utype":1,"ctime":1538115217,"user_name_real":"éƒ‘é›¨è¿ª"}],"discussion_count":1,"race_medal":0,"score":"48782430690","product_id":100010301,"comment_content":"å—¯ï¼Œä¹‹å‰å†™è¿‡æ³¨è§£æ–¹é¢çš„åŠŸèƒ½ï¼Œä¸è¿‡è™½ç„¶èƒ½è‡ªå®šä¹‰æ³¨è§£ï¼Œä¹Ÿèƒ½æ˜ç™½Javaè¯­è¨€å±‚é¢çš„æœ‰å…³æ³¨è§£ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œä½†æ˜¯å¾€ä¸‹æ€ä¹ˆæ ·å°±ä¸å¤ªæ¸…æ¥šäº†ï¼Ÿ<br>æ³¨è§£ä»£ç æœ¬è´¨ä¹Ÿæ˜¯ä»£ç ï¼Œä¹Ÿä¼šè¢«ç¼–è¯‘ä¸º.classæ–‡ä»¶ï¼Œç„¶ååœ¨JVMä¸Šé¢è¢«è½¬æ¢æˆæœºå™¨ç ï¼Œç„¶åè¢«è®¡ç®—æœºæ‰§è¡Œï¼Œä¸è¿‡æ„Ÿè§‰ä»–å¥½ç‰¹åˆ«ï¼Œä»–çš„å­˜åœ¨ä»…æ˜¯ä¸ºäº†æ˜¯ç¼–ç æ›´ç®€æ´å—ï¼Ÿ<br>è¯»ä¹‹å‰æˆ‘å°±åœ¨æƒ³ä¸Šé¢çš„é—®é¢˜ï¼Œæ–‡ä¸­è™½ç„¶æ²¡æœ‰ä»‹ç»è¿™äº›å†…å®¹ï¼Œä¸è¿‡ä»‹ç»äº†å…¶ä»–çš„å†…å®¹ä¹ŸæŒºå¥½ï¼<br><br>å°ç»“ä¸€ä¸‹ï¼š<br>1ï¼šæ³¨è§£å¤„ç†å™¨-æœ¬è´¨ä¹Ÿæ˜¯ä»£ç ï¼Œä»¥æ’ä»¶çš„å½¢å¼å­˜åœ¨ï¼Œä»¥æ’ä»¶çš„å½¢å¼æ¥å…¥Javaç¼–è¯‘å™¨ï¼Œè¿™äº›æ’ä»¶æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ<br><br>2ï¼šæ³¨è§£å¤„ç†å™¨çš„ä½œç”¨ï¼Ÿ<br>æ³¨è§£å¤„ç†å™¨æœ‰ä¸‰ä¸ªä½œç”¨<br>2-1ï¼šå¯ä»¥ä¸ºJavaç¼–è¯‘å™¨æ·»åŠ ä¸€äº›ç¼–è¯‘è§„åˆ™ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¼ è¯´ä¸­çš„è‡ªå®šä¹‰æ³¨è§£ï¼Œå®ƒå¯ä»¥å®šä¹‰ä¸€äº›ç¼–è¯‘è§„åˆ™ï¼Œè¿™äº›ç¼–è¯‘è§„åˆ™ä¼šä»¥æ’ä»¶çš„å½¢å¼æä¾›ç»™Javaç¼–è¯‘å™¨ã€‚<br>2-2ï¼šå¯ä»¥ä¿®æ”¹å·²æœ‰çš„JAVAæºæ–‡ä»¶ï¼ˆä¸æ¨èï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæœ¬è´¨ä¸Šæ³¨è§£å¤„ç†å™¨ä¸èƒ½ä¿®æ”¹å·²æœ‰çš„JAVAæºä»£ç ï¼Œä½†æ˜¯å®ƒå¯ä»¥ä¿®æ”¹æœ‰javaæºä»£ç ç”Ÿæˆçš„æŠ½è±¡è¯­æ³•æ ‘ï¼Œä»è€Œä½¿ç”Ÿæˆçš„å­—èŠ‚ç å‘ç”Ÿå˜åŒ–ï¼Œä¸è¿‡å¯¹æŠ½è±¡è¯­æ³•æ ‘çš„ä¿®æ”¹ä¿®æ”¹è®¾è®¡äº†javaç¼–è¯‘å™¨çš„å†…éƒ¨APIï¼Œè¿™éƒ¨åˆ†å¾ˆå¯èƒ½éšç€ç‰ˆæœ¬çš„å˜æ›´è€Œå¤±æ•ˆï¼Œæ‰€ä»¥ï¼Œæ‰ä¸æ¨èä½¿ç”¨çš„ï¼Œå­˜åœ¨åŸ‹æ·±å‘çš„éšæ‚£ã€‚ï¼‰<br>2-3ï¼šå¯ä»¥ç”Ÿæˆä¸€äº›æ–°çš„JAVAæºæ–‡ä»¶<br><br>3ï¼šå…ƒæ³¨è§£-ç»™æ³¨è§£ä½¿ç”¨çš„æ³¨è§£å°±æ˜¯å…ƒæ³¨è§£ï¼Œè¿™äº›æ³¨è§£æ˜¯JDKçš„å¼€å‘äººå‘˜æå‰å®šä¹‰äº†çš„ï¼Œä¹ŸåŒæ ·æ˜¯ä»¥æ’ä»¶çš„å½¢å¼æ¥å…¥Javaç¼–è¯‘å™¨çš„ã€‚æ³¨æ„ï¼šæ‰€æœ‰çš„æ³¨è§£å¤„ç†å™¨éƒ½å¿…é¡»å®ç°Processoræ¥å£ï¼Œè¿™ä¸ªæ¥å£ä¸­æœ‰å››ä¸ªæ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½æœ‰å…¶ç‰¹æ®Šçš„ä½œç”¨åœ¨ï¼Œè¯¦æƒ…éœ€è¦å›å¤´ç»†çœ‹ã€‚å¦å¤–ï¼ŒJDKæä¾›äº†ä¸€ä¸ªå®ç°Processoræ¥å£çš„æŠ½è±¡ç±»AbstractProcessorï¼Œè¿™ä¸ªæŠ½è±¡ç±»å®ç°äº†Processoræ¥å£çš„å…¶ä¸­ä¸‰ä¸ªæ–¹æ³•ã€‚<br><br>4ï¼šè‡ªå®šä¹‰çš„æ³¨è§£è¢«ç¼–è¯‘ä¸º.classæ–‡ä»¶åï¼Œä¾¿å¯ä»¥å°†å…¶æ³¨å†Œä¸ºJavaç¼–è¯‘å™¨çš„æ’ä»¶äº†ï¼Œæ³¨å†Œæ–¹æ³•æœ‰ä¸¤ç§ï¼Œç¥¥çœ‹ä¸“æ å†…å®¹å§ï¼<br><br>5ï¼šJavaæºä»£ç çš„ç¼–è¯‘è¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤<br>     5-1ï¼šè§£ææºæ–‡ä»¶ç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘<br>     5-2ï¼šè°ƒç”¨å·²æ³¨å†Œçš„æ³¨è§£å¤„ç†å™¨ï¼ˆæ³¨è§£å¤„ç†å™¨æœ‰ä¸¤ç§æ³¨å†Œåˆ°JAVAç¼–è¯‘å™¨çš„æ–¹å¼ï¼‰<br>     5-3ï¼šç”Ÿæˆå­—èŠ‚ç <br>     5-4ï¼šå¦‚æœ5-2æ­¥ä¸­ï¼Œæ³¨è§£å¤„ç†å™¨ç”Ÿæˆäº†æ–°çš„æºä»£ç ï¼Œé‚£ä¹ˆJAVAç¼–è¯‘å™¨å°†é‡å¤ç¬¬5-1&#47;5-2æ­¥ï¼Œç›´åˆ°ä¸å†ç”Ÿæˆæ–°çš„æºä»£ç ã€‚","like_count":12,"discussions":[{"author":{"id":1176688,"avatar":"https://static001.geekbang.org/account/avatar/00/11/f4/70/2f61fa20.jpg","nickname":"éƒ‘é›¨è¿ª","note":"","ucode":"F7CA1AE501EAFF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424779,"discussion_content":"æ³¨è§£ç›¸å½“äºç»™æŸäº›ä»£ç è´´äº†ä¸ªæ ‡ç­¾ã€‚æˆ‘ä»¬æ—¢å¯ä»¥é€šè¿‡æ³¨è§£å¤„ç†å™¨åœ¨ç¼–è¯‘æ—¶è§£æè¿™äº›æ ‡ç­¾ï¼Œä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡åå°„è§£æè¿™äº›æ ‡ç­¾ã€‚è§£æåéƒ½ä¼šæœ‰ä¸€ç³»åˆ—åŠ¨ä½œï¼Œè¿™äº›åŠ¨ä½œå°±æ˜¯å¯¹æ ‡ç­¾è¯­ä¹‰çš„è¯ é‡Šã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1538115217,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":28289,"user_name":"lovedebug","can_delete":false,"product_type":"c1","uid":1004115,"ip_address":"","ucode":"292FB1FD078AE8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/52/53/a9918d0b.jpg","comment_is_top":false,"comment_ctime":1538044191,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27307847967","product_id":100010301,"comment_content":"è®²çš„å¾ˆå¥½ï¼Œèµã€‚ç»“åˆjavaè¯­æ³•çœ‹å°è±¡æ›´æ·±","like_count":7},{"had_liked":false,"id":25958,"user_name":"è¡¥å¿ƒ","can_delete":false,"product_type":"c1","uid":1124789,"ip_address":"","ucode":"9DB51E8A6C4B62","user_header":"https://static001.geekbang.org/account/avatar/00/11/29/b5/2b477ed4.jpg","comment_is_top":false,"comment_ctime":1537488267,"is_pvip":false,"replies":[{"id":"9513","content":"æœ‰å¯èƒ½ï¼Œå› ä¸ºç”¨çš„æ˜¯internal APIã€‚","user_name":"ä½œè€…å›å¤","comment_id":25958,"uid":"1176688","ip_address":"","utype":1,"ctime":1537512434,"user_name_real":"éƒ‘é›¨è¿ª"}],"discussion_count":1,"race_medal":0,"score":"27307292043","product_id":100010301,"comment_content":"Lombokéšç€Javaç‰ˆæœ¬çš„é—®é¢˜ï¼Œæ˜¯ä¸æ˜¯æœ‰å¯èƒ½æ²¡æ³•ä½¿ç”¨ã€‚","like_count":6,"discussions":[{"author":{"id":1176688,"avatar":"https://static001.geekbang.org/account/avatar/00/11/f4/70/2f61fa20.jpg","nickname":"éƒ‘é›¨è¿ª","note":"","ucode":"F7CA1AE501EAFF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424474,"discussion_content":"æœ‰å¯èƒ½ï¼Œå› ä¸ºç”¨çš„æ˜¯internal APIã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537512434,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":76833,"user_name":"æ¾èŠ±çš®è›‹me","can_delete":false,"product_type":"c1","uid":1000054,"ip_address":"","ucode":"B0846CEEF6B0D1","user_header":"https://static001.geekbang.org/account/avatar/00/0f/42/76/256bbd43.jpg","comment_is_top":false,"comment_ctime":1552722355,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23027558835","product_id":100010301,"comment_content":"åå°„åœ¨è¿è¡Œæ—¶ï¼Œæ³¨è§£è§£é‡Šå™¨åœ¨ç¼–è¯‘æ—¶","like_count":5},{"had_liked":false,"id":28688,"user_name":"ç™½ä¸‰å²","can_delete":false,"product_type":"c1","uid":1109892,"ip_address":"","ucode":"39594C357FEA1B","user_header":"https://static001.geekbang.org/account/avatar/00/10/ef/84/a0ffbd8b.jpg","comment_is_top":false,"comment_ctime":1538127509,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"18717996693","product_id":100010301,"comment_content":"springä¸­çš„é‚£äº›æ³¨è§£ä¹Ÿæ˜¯é€šè¿‡æ³¨è§£å¤„ç†å™¨å®ç°çš„å—ã€‚æˆ‘ä»¬é¡¹ç›®ä¸­ä¸€èˆ¬å¥½åƒéƒ½æ˜¯é€šè¿‡springçš„aopæ¥å®ç°è‡ªå®šä¹‰æ³¨è§£çš„åŠŸèƒ½ã€‚","like_count":4,"discussions":[{"author":{"id":1625364,"avatar":"https://static001.geekbang.org/account/avatar/00/18/cd/14/fcf8545e.jpg","nickname":"Gray","note":"","ucode":"7C5DD6CE817E64","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":400751,"discussion_content":"Springä¸­çš„ä¸æ˜¯ï¼Œæ˜¯è¿è¡Œæ—¶é€šè¿‡CGLibå¢å¼ºå®ç°çš„ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1633409175,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":26536,"user_name":"èš‚èšå†…æ¨+v","can_delete":false,"product_type":"c1","uid":1050508,"ip_address":"","ucode":"24B10AEE54B3FD","user_header":"https://static001.geekbang.org/account/avatar/00/10/07/8c/0d886dcc.jpg","comment_is_top":false,"comment_ctime":1537644080,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10127578672","product_id":100010301,"comment_content":"éƒ‘è€å¸ˆ  æœ‰ä¸ªé—®é¢˜æˆ‘ä¸€ç›´æƒ³ä¸æ˜ç™½?java æºç ç”Ÿæˆè¯­æ³•æ ‘ java APT å¤„ç†å™¨å¤„ç†åç”Ÿæˆä»£ç ï¼Œ ä»æ–°èµ°é‚£ä¸ªè¿‡ç¨‹  æœ‰é‡å¤ç”Ÿæˆäº†  é‚£ä¸æ˜¯æ­»å¾ªç¯äº†å—ï¼Ÿå¯èƒ½æ˜¯è‡ªå·±çŸ¥è¯†æµ…è–„  éº»çƒ¦åœ¨è¿™ç‚¹ä¸Šæ­£è€å¸ˆèƒ½æŒ‡ç‚¹ä¸‹â˜ºï¸  è‡ªå·±æ°´å¹³æ¯”è¾ƒlow  æ¨¡ä»¿äº†å†™ä¸€ç›´æ²¡æˆåŠŸâ˜ºï¸ ä¸çŸ¥é“éƒ‘è€å¸ˆèƒ½å‘ä¸€ä¸ªdemo å·¥ç¨‹å—","like_count":2,"discussions":[{"author":{"id":1357311,"avatar":"https://static001.geekbang.org/account/avatar/00/14/b5/ff/d1f205b0.jpg","nickname":"L","note":"","ucode":"5B847B2378854E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294850,"discussion_content":"å¦‚æœ --> åœ¨ç¬¬ 2 æ­¥ä¸­ï¼Œæ³¨è§£å¤„ç†å™¨ç”Ÿæˆäº†æ–°çš„æºä»£ç ï¼Œé‚£ä¹ˆ Java ç¼–è¯‘å™¨å°†é‡å¤ç¬¬ 1ã€2 æ­¥ï¼Œç›´è‡³ä¸å†ç”Ÿæˆ  -->  æ–°çš„æºä»£ç ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596015076,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":198850,"user_name":"å°é™ˆ","can_delete":false,"product_type":"c1","uid":1009385,"ip_address":"","ucode":"A03A299310AD18","user_header":"https://static001.geekbang.org/account/avatar/00/0f/66/e9/814d057a.jpg","comment_is_top":false,"comment_ctime":1585470518,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5880437814","product_id":100010301,"comment_content":"è¿™ä¸ªæ¯”æ·±å…¥ç†è§£jvmé‚£éƒ¨åˆ†è¯¦ç»†","like_count":2},{"had_liked":false,"id":89434,"user_name":"å¥‡å¥‡","can_delete":false,"product_type":"c1","uid":1399097,"ip_address":"","ucode":"BC86B0CB55E35A","user_header":"","comment_is_top":false,"comment_ctime":1556173713,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5851141009","product_id":100010301,"comment_content":"è€å¸ˆï¼Œè¿™ä¸ª ExecutableElement targetAsKey = getExecutable(annotation, &quot;value&quot;); è¿™ä¸€å¥æ˜¯å¹²å˜›çš„ï¼Œæˆ‘çœ‹è¯­ä¹‰æ˜¯æ‰¾å‡ºæ‰€æœ‰åå­—æ˜¯valueçš„æ–¹æ³•ï¼Ÿéš¾é“ä¸åº”è¯¥æ‰¾çš„æ˜¯valueæ‰€æŒ‡å‘çš„ç±»å—ï¼Ÿ","like_count":1},{"had_liked":false,"id":45693,"user_name":"å±±é¡¶çš„æ´","can_delete":false,"product_type":"c1","uid":1246664,"ip_address":"","ucode":"D3E9E928A3FA62","user_header":"https://static001.geekbang.org/account/avatar/00/13/05/c8/2f849dfb.jpg","comment_is_top":false,"comment_ctime":1543752712,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5838720008","product_id":100010301,"comment_content":"è‡ªå®šä¹‰æ³¨è§£éƒ½æ˜¯aopå®ç°çš„å—ï¼Ÿå¥½åƒæ²¡çœ‹åˆ°è¿‡æ³¨è§£å¤„ç†å™¨ã€‚","like_count":1},{"had_liked":false,"id":26347,"user_name":"Egos","can_delete":false,"product_type":"c1","uid":1071143,"ip_address":"","ucode":"9F0055B140E935","user_header":"https://static001.geekbang.org/account/avatar/00/10/58/27/1188e017.jpg","comment_is_top":false,"comment_ctime":1537572208,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5832539504","product_id":100010301,"comment_content":"é—®ä¸€ä¸‹RetentionPolicy.CLASS çš„ä½¿ç”¨åœºæ™¯ã€‚æœ‰ä¸€äº›ç”¨æ¥ç”ŸæˆJava æ–‡ä»¶çš„æ³¨è§£æ˜¯å¯ä»¥ä½¿ç”¨SOURCEçš„ï¼Œä½†æ˜¯ç”¨äº†CLASSã€‚","like_count":1},{"had_liked":false,"id":339274,"user_name":"×›×Ÿ ×× ×™ ×××¨×™×§××™","can_delete":false,"product_type":"c1","uid":1527429,"ip_address":"","ucode":"56C5C2B369121B","user_header":"https://static001.geekbang.org/account/avatar/00/17/4e/85/ef0108cd.jpg","comment_is_top":false,"comment_ctime":1648018750,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1648018750","product_id":100010301,"comment_content":"æ·±å…¥æºç åˆ†ææ³¨è§£å¤„ç†å™¨æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œå¸¦ä½ æ‰‹æ’¸@Getteræ³¨è§£ï¼Œè®©ä½ ä½“ä¼šä¸€ä¸‹Lombokæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚æ¬¢è¿å¤§å®¶é˜…è¯»ï¼šhttps:&#47;&#47;juejin.cn&#47;post&#47;7077550257344610312","like_count":1},{"had_liked":false,"id":337555,"user_name":"cv0cv0","can_delete":false,"product_type":"c1","uid":1360093,"ip_address":"","ucode":"93FF9277F03FD0","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLEIsgI4ub1VOKWtVOfouAzSqx8Yt8ibQEsAnwNJsJHmuJzzpQqG79HullvYwpic8hgiclgON2GwXSjw/132","comment_is_top":false,"comment_ctime":1646892016,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646892016","product_id":100010301,"comment_content":"ä¸€ç›´ä¸çŸ¥é“ Lombok æœ‰å•¥ç”¨ï¼Œå®Œå…¨å¯ä»¥ç”¨ Kotlin ä»£æ›¿ã€‚","like_count":0},{"had_liked":false,"id":298313,"user_name":"godliness","can_delete":false,"product_type":"c1","uid":1341267,"ip_address":"","ucode":"1C1976C39DCFE6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIuUYcwKWUuib5mpdIbTwQzTGNWBmk0ktZSwm2vteUXf4TxWF2aVCv7Hvshcq0OaG7JRLj6rJyPLicA/132","comment_is_top":false,"comment_ctime":1624009492,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624009492","product_id":100010301,"comment_content":"è¯·æ•™ä¸ªé—®é¢˜ï¼šæˆ‘åœ¨åŒ¿åå†…éƒ¨ç±»ä¸­çš„æ–¹æ³•ä½¿ç”¨æ³¨è§£å£°æ˜åï¼Œåœ¨ç›¸åº”çš„æ³¨è§£å¤„ç†å™¨å´è·å–ä¸åˆ°ï¼Œå†…éƒ¨ç±»åœ¨ç¼–è¯‘é˜¶æ®µåº”è¯¥ä¼šè¢«ç¼–è¯‘ä¸ºè·Ÿå¤–éƒ¨ç±»ä¸€æ ·çš„é¡¶çº§ç±»ï¼Œä¸ºä»€ä¹ˆè·å–ä¸åˆ°å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":198437,"user_name":"å¦¥å","can_delete":false,"product_type":"c1","uid":1249656,"ip_address":"","ucode":"7201DFE9C12669","user_header":"https://static001.geekbang.org/account/avatar/00/13/11/78/4f0cd172.jpg","comment_is_top":false,"comment_ctime":1585451458,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585451458","product_id":100010301,"comment_content":"æ˜¯ä¸æ˜¯è¿è¡Œæ—¶ï¼Œå°±æ˜¯é€šè¿‡åå°„åˆ›å»ºä»£ç†å®ç°çš„","like_count":0},{"had_liked":false,"id":75426,"user_name":"å­œå­œ","can_delete":false,"product_type":"c1","uid":1018203,"ip_address":"","ucode":"7EF4FB644357CE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/89/5b/d8f78c1e.jpg","comment_is_top":false,"comment_ctime":1552396571,"is_pvip":true,"discussion_count":4,"race_medal":0,"score":"1552396571","product_id":100010301,"comment_content":"@Getter å’Œä¾‹å­è‡ªå·±å®šä¹‰çš„@CheckGetter ä¸€èµ·ä½¿ç”¨ï¼Œ@CheckGetterå…ˆç”Ÿæ•ˆã€‚æœ‰ç‚¹æä¸æ˜ç™½Lombokå’Œè‡ªå·±å®šä¹‰çš„æ‰§è¡Œé¡ºåºã€‚","like_count":0,"discussions":[{"author":{"id":1440912,"avatar":"https://static001.geekbang.org/account/avatar/00/15/fc/90/c9df0459.jpg","nickname":"ack","note":"","ucode":"69CA1233EEA8E2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":272629,"discussion_content":"ä½ å¥½ï¼Œè¯·é—®ä½ æ˜¯æ€ä¹ˆç¼–è¯‘ç”Ÿæ•ˆçš„å‘¢ï¼Ÿæˆ‘è¯•äº†cmdç¼–è¯‘ä»¥åŠideaéƒ½ç›´æ¥ç¼–è¯‘é€šè¿‡ï¼Œä½¿ç”¨çš„æ˜¯jdk8","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590329473,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1018203,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/89/5b/d8f78c1e.jpg","nickname":"å­œå­œ","note":"","ucode":"7EF4FB644357CE","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1440912,"avatar":"https://static001.geekbang.org/account/avatar/00/15/fc/90/c9df0459.jpg","nickname":"ack","note":"","ucode":"69CA1233EEA8E2","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":273079,"discussion_content":"ä½ æ˜¯æŒ‡@checkgetterï¼Œè¿™ä¸ªç”¨è€å¸ˆçš„ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥å¥½ç”¨å•Šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590408113,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":272629,"ip_address":""},"score":273079,"extra":""},{"author":{"id":1440912,"avatar":"https://static001.geekbang.org/account/avatar/00/15/fc/90/c9df0459.jpg","nickname":"ack","note":"","ucode":"69CA1233EEA8E2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1018203,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/89/5b/d8f78c1e.jpg","nickname":"å­œå­œ","note":"","ucode":"7EF4FB644357CE","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":273838,"discussion_content":"æˆ‘ä¸¤ç§éƒ½ä¸è¡ŒğŸ˜¢ï¼Œæƒ³é—®ä¸‹ä½ ç”¨çš„æ˜¯å“ªä¸ªjdkç‰ˆæœ¬å‘€ï¼Œç„¶åæˆ‘æ˜¯ç”¨ideaç¼–è¯‘è¿‡ç¨‹æ­£å¸¸ï¼Œä»¥åŠç”¨cmdæ‰§è¡Œç¼–è¯‘ä¹Ÿæ˜¯æ­£å¸¸","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590504018,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":273079,"ip_address":""},"score":273838,"extra":""},{"author":{"id":1018203,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/89/5b/d8f78c1e.jpg","nickname":"å­œå­œ","note":"","ucode":"7EF4FB644357CE","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1440912,"avatar":"https://static001.geekbang.org/account/avatar/00/15/fc/90/c9df0459.jpg","nickname":"ack","note":"","ucode":"69CA1233EEA8E2","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":274119,"discussion_content":"æˆ‘ä¹Ÿæ˜¯jdk8ï¼Œç¼–è¯‘é€šè¿‡å°±å¯ä»¥æŒ‰ç…§è€å¸ˆæä¾›çš„å‘½ä»¤è¿è¡Œäº†ï¼Œç„¶åå°±ä¼šçœ‹åˆ°æ²¡æœ‰getæ–¹æ³•çš„æé†’ã€‚æˆ–è€…ä½ å¯ä»¥ç»™ä¸ªgithublinkï¼Œæˆ‘çœ‹ä¸€çœ¼ä½ å¯¹æˆ‘codeã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590543354,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":273838,"ip_address":""},"score":274119,"extra":""}]}]},{"had_liked":false,"id":64274,"user_name":"é‡‘é¾Ÿ","can_delete":false,"product_type":"c1","uid":1228500,"ip_address":"","ucode":"1C7D35C8AE8D9D","user_header":"https://static001.geekbang.org/account/avatar/00/12/be/d4/ff1c1319.jpg","comment_is_top":false,"comment_ctime":1548731405,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1548731405","product_id":100010301,"comment_content":"CheckGetterProcessorè¿™ä¸ªæ˜¯æ€ä¹ˆç”¨çš„ï¼Ÿï¼Ÿæˆ‘æ„Ÿè§‰æˆ‘æ²¡æœ‰è¿è¡Œèµ·æ¥ä¸€ä¸ªç±»é‡Œæ²¡æœ‰getteræ–¹æ³•ï¼Œæˆ‘ä¸€æ ·èƒ½å¤Ÿç¼–è¯‘é€šè¿‡ã€‚","like_count":0},{"had_liked":false,"id":29991,"user_name":"lewis","can_delete":false,"product_type":"c1","uid":1253640,"ip_address":"","ucode":"128DA8287C180B","user_header":"https://static001.geekbang.org/account/avatar/00/13/21/08/94d145c1.jpg","comment_is_top":false,"comment_ctime":1538621093,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1538621093","product_id":100010301,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæˆ‘åœ¨ä½¿ç”¨Annotation Processorè¿‡ç¨‹ä¸­ï¼Œé‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚æŸä¸ªElementæ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œæˆ‘æƒ³è·å–è¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼ç±»å‹ï¼Œå½“è¿™ä¸ªè¿”å›å€¼æ˜¯æ³›å‹çš„æ—¶å€™ï¼Œæ— æ³•è·å–å…¨è·¯å¾„çš„ç±»å‹ï¼›æ¯”å¦‚è¿”å›å€¼æ˜¯è‡ªå®šä¹‰ç±»å‹com.xxx.module.domain.UserInfoè¿™ä¸ªç±»å‹ï¼Œé€šè¿‡ä¸‹é¢çš„è¯­å¥åªèƒ½çŸ¥é“è¿”å›å€¼æ˜¯å­—é¢é‡UserInfo,è€Œä¸æ˜¯com.xxx.module.domain.UserInfoè¿™ä¸ªå…¨è·¯å¾„ç±»å‹ ã€‚<br> ExecutableElement methodElement = ExecutableElement.class.cast(element);<br>            TypeMirror returnType = methodElement.getReturnType();<br>            TypeName returnTypeName = ClassName.get(returnType);<br>è¿™ä¸ªreturnTypeNameåªæ˜¯UserInfo,ä¸æ˜¯com.xxx.module.domain.UserInfoï¼Œæ‹¿ä¸åˆ°UserInfoçš„åŒ…è·¯å¾„ä¿¡æ¯ï¼Œé€šè¿‡messageræç¤ºè¯´æ˜¯æ‰¾ä¸åˆ°com.xxx.module.domainè¿™ä¸ªåŒ…ï¼Œè¯·è€å¸ˆæŒ‡å¯¼","like_count":0},{"had_liked":false,"id":26370,"user_name":"mtfelix","can_delete":false,"product_type":"c1","uid":1045809,"ip_address":"","ucode":"8C838BC0FC1F58","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f5/31/bbb513ba.jpg","comment_is_top":false,"comment_ctime":1537581030,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1537581030","product_id":100010301,"comment_content":"ä¸é”™å“¦","like_count":0,"discussions":[{"author":{"id":1168269,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d3/8d/f4ab1eab.jpg","nickname":"zero","note":"","ucode":"B5D2A838392DF2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":211261,"discussion_content":"ä¸é”™çš„å­¦ä¹ èµ„æ–™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584834218,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}