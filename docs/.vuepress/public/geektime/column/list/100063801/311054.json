{"id":311054,"title":"05ï½œå®¹å™¨CPUï¼ˆ1ï¼‰ï¼šæ€ä¹ˆé™åˆ¶å®¹å™¨çš„CPUä½¿ç”¨ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç¨‹è¿œã€‚ä»è¿™ä¸€è®²å¼€å§‹ï¼Œæˆ‘ä»¬è¿›å…¥å®¹å™¨CPUè¿™ä¸ªæ¨¡å—ã€‚</p><p>æˆ‘åœ¨ç¬¬ä¸€è®²ä¸­ç»™ä½ è®²è¿‡ï¼Œå®¹å™¨åœ¨Linuxç³»ç»Ÿä¸­æœ€æ ¸å¿ƒçš„ä¸¤ä¸ªæ¦‚å¿µæ˜¯Namespaceå’ŒCgroupsã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡CgroupsæŠ€æœ¯é™åˆ¶èµ„æºã€‚è¿™ä¸ªèµ„æºå¯ä»¥åˆ†ä¸ºå¾ˆå¤šç±»å‹ï¼Œæ¯”å¦‚CPUï¼ŒMemoryï¼ŒStorageï¼ŒNetworkç­‰ç­‰ã€‚è€Œè®¡ç®—èµ„æºæ˜¯æœ€åŸºæœ¬çš„ä¸€ç§èµ„æºï¼Œæ‰€æœ‰çš„å®¹å™¨éƒ½éœ€è¦è¿™ç§èµ„æºã€‚</p><p>é‚£ä¹ˆï¼Œä»Šå¤©æˆ‘ä»¬å°±å…ˆèŠä¸€èŠï¼Œæ€ä¹ˆé™åˆ¶å®¹å™¨çš„CPUä½¿ç”¨ï¼Ÿ</p><p>æˆ‘ä»¬æ‹¿Kuberneteså¹³å°åšä¾‹å­ï¼Œå…·ä½“æ¥çœ‹ä¸‹é¢è¿™ä¸ªpod/containeré‡Œçš„specå®šä¹‰ï¼Œåœ¨CPUèµ„æºç›¸å…³çš„å®šä¹‰ä¸­æœ‰ä¸¤é¡¹å†…å®¹ï¼Œåˆ†åˆ«æ˜¯ <strong>Request CPU</strong> å’Œ <strong>Limit CPU</strong>ã€‚</p><pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: frontend\nspec:\n  containers:\n  - name: app\n    image: images.my-company.example/app:v4\n    env:\n    resources:\n      requests:\n        memory: &quot;64Mi&quot;\n        cpu: &quot;1&quot;\n      limits:\n        memory: &quot;128Mi&quot;\n        cpu: &quot;2&quot;\nâ€¦\n</code></pre><p>å¾ˆå¤šåˆšåˆšä½¿ç”¨Kubernetesçš„åŒå­¦ï¼Œå¯èƒ½ä¸€å¼€å§‹å¹¶ä¸ç†è§£è¿™ä¸¤ä¸ªå‚æ•°æœ‰ä»€ä¹ˆä½œç”¨ã€‚</p><p>è¿™é‡Œæˆ‘å…ˆç»™ä½ è¯´ç»“è®ºï¼Œåœ¨Pod Specé‡Œçš„\"Request CPU\"å’Œ\"Limit CPU\"çš„å€¼ï¼Œæœ€åä¼šé€šè¿‡CPU Cgroupçš„é…ç½®ï¼Œæ¥å®ç°æ§åˆ¶å®¹å™¨CPUèµ„æºçš„ä½œç”¨ã€‚</p><p>é‚£æ¥ä¸‹æ¥æˆ‘ä¼šå…ˆä»è¿›ç¨‹çš„CPUä½¿ç”¨è®²èµ·ï¼Œç„¶åå¸¦ä½ åœ¨CPU Cgroupå­ç³»ç»Ÿä¸­å»ºç«‹å‡ ä¸ªæ§åˆ¶ç»„ï¼Œç”¨è¿™ä¸ªä¾‹å­ä¸ºä½ è®²è§£CPU Cgroupä¸­çš„ä¸‰ä¸ªæœ€é‡è¦çš„å‚æ•°\"cpu.cfs_quota_us\"\"cpu.cfs_period_us\"\"cpu.shares\"ã€‚</p><!-- [[[read_end]]] --><p>ç›¸ä¿¡ç†è§£äº†è¿™ä¸‰ä¸ªå‚æ•°åï¼Œä½ å°±ä¼šæ˜ç™½æˆ‘ä»¬è¦æ€æ ·é™åˆ¶å®¹å™¨CPUçš„ä½¿ç”¨äº†ã€‚</p><h2>å¦‚ä½•ç†è§£CPUä½¿ç”¨å’ŒCPU Cgroupï¼Ÿ</h2><p>æ—¢ç„¶æˆ‘ä»¬éœ€è¦ç†è§£CPU  Cgroupï¼Œé‚£ä¹ˆå°±æœ‰å¿…è¦å…ˆæ¥çœ‹ä¸€ä¸‹Linuxé‡Œçš„CPUä½¿ç”¨çš„æ¦‚å¿µï¼Œè¿™æ˜¯å› ä¸ºCPU Cgroupæœ€å¤§çš„ä½œç”¨å°±æ˜¯é™åˆ¶CPUä½¿ç”¨ã€‚</p><h3>CPUä½¿ç”¨çš„åˆ†ç±»</h3><p>å¦‚æœä½ æƒ³æŸ¥çœ‹Linuxç³»ç»Ÿçš„CPUä½¿ç”¨çš„è¯ï¼Œä¼šç”¨ä»€ä¹ˆæ–¹æ³•å‘¢ï¼Ÿæœ€å¸¸ç”¨çš„è‚¯å®šæ˜¯è¿è¡ŒTopäº†ã€‚</p><p>æˆ‘ä»¬å¯¹ç…§ä¸‹å›¾çš„Topè¿è¡Œç•Œé¢ï¼Œåœ¨æˆªå›¾ç¬¬ä¸‰è¡Œï¼Œ\"%Cpu(s)\"å¼€å¤´çš„è¿™ä¸€è¡Œï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸²æ•°å€¼ï¼Œä¹Ÿå°±æ˜¯\"0.0 us, 0.0 sy, 0.0 ni, 99.9 id, 0.0 wa, 0.0 hi, 0.0 si, 0.0 st\"ï¼Œé‚£ä¹ˆè¿™é‡Œçš„æ¯ä¸€é¡¹å€¼éƒ½æ˜¯ä»€ä¹ˆå«ä¹‰å‘¢ï¼Ÿ</p><p><img src=\"https://static001.geekbang.org/resource/image/a6/c2/a67fae56ce2f4e7078d552c58c9f9dc2.png?wh=1696*412\" alt=\"\"></p><p>ä¸‹é¢è¿™å¼ å›¾é‡Œæœ€é•¿çš„å¸¦ç®­å¤´æ¨ªè½´ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒçœ‹æˆä¸€ä¸ªæ—¶é—´è½´ã€‚åŒæ—¶ï¼Œå®ƒçš„ä¸ŠåŠéƒ¨åˆ†ä»£è¡¨Linuxç”¨æˆ·æ€ï¼ˆUser spaceï¼‰ï¼Œä¸‹åŠéƒ¨åˆ†ä»£è¡¨å†…æ ¸æ€ï¼ˆKernel spaceï¼‰ã€‚è¿™é‡Œä¸ºäº†æ–¹ä¾¿ä½ ç†è§£ï¼Œæˆ‘ä»¬å…ˆå‡è®¾åªæœ‰ä¸€ä¸ªCPUå§ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/7d/99/7dbd023628f5f4165abc23c1d67aca99.jpeg?wh=3200*1800\" alt=\"\"></p><p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸Šé¢è¿™å¼ å›¾ï¼ŒæŠŠè¿™äº›å€¼æŒ¨ä¸ªè§£é‡Šä¸€ä¸‹ã€‚</p><p>å‡è®¾ä¸€ä¸ªç”¨æˆ·ç¨‹åºå¼€å§‹è¿è¡Œäº†ï¼Œé‚£ä¹ˆå°±å¯¹åº”ç€ç¬¬ä¸€ä¸ª\"us\"æ¡†ï¼Œ\"us\"æ˜¯\"user\"çš„ç¼©å†™ï¼Œä»£è¡¨Linuxçš„ç”¨æˆ·æ€CPU Usageã€‚æ™®é€šç”¨æˆ·ç¨‹åºä»£ç ä¸­ï¼Œåªè¦ä¸æ˜¯è°ƒç”¨ç³»ç»Ÿè°ƒç”¨ï¼ˆSystem Callï¼‰ï¼Œè¿™äº›ä»£ç çš„æŒ‡ä»¤æ¶ˆè€—çš„CPUå°±éƒ½å±äº\"us\"ã€‚</p><p>å½“è¿™ä¸ªç”¨æˆ·ç¨‹åºä»£ç ä¸­è°ƒç”¨äº†ç³»ç»Ÿè°ƒç”¨ï¼Œæ¯”å¦‚è¯´read()å»è¯»å–ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™æ—¶å€™è¿™ä¸ªç”¨æˆ·è¿›ç¨‹å°±ä¼šä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ã€‚</p><p>å†…æ ¸æ€read()ç³»ç»Ÿè°ƒç”¨åœ¨è¯»åˆ°çœŸæ­£diskä¸Šçš„æ–‡ä»¶å‰ï¼Œå°±ä¼šè¿›è¡Œä¸€äº›æ–‡ä»¶ç³»ç»Ÿå±‚çš„æ“ä½œã€‚é‚£ä¹ˆè¿™äº›ä»£ç æŒ‡ä»¤çš„æ¶ˆè€—å°±å±äº\"sy\"ï¼Œè¿™é‡Œå°±å¯¹åº”ä¸Šé¢å›¾é‡Œçš„ç¬¬äºŒä¸ªæ¡†ã€‚\"sy\"æ˜¯ \"system\"çš„ç¼©å†™ï¼Œä»£è¡¨å†…æ ¸æ€CPUä½¿ç”¨ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œè¿™ä¸ªread()ç³»ç»Ÿè°ƒç”¨ä¼šå‘Linuxçš„Block Layerå‘å‡ºä¸€ä¸ªI/O Requestï¼Œè§¦å‘ä¸€ä¸ªçœŸæ­£çš„ç£ç›˜è¯»å–æ“ä½œã€‚</p><p>è¿™æ—¶å€™ï¼Œè¿™ä¸ªè¿›ç¨‹ä¸€èˆ¬ä¼šè¢«ç½®ä¸ºTASK_UNINTERRUPTIBLEã€‚è€ŒLinuxä¼šæŠŠè¿™æ®µæ—¶é—´æ ‡ç¤ºæˆ\"wa\"ï¼Œå¯¹åº”å›¾ä¸­çš„ç¬¬ä¸‰ä¸ªæ¡†ã€‚\"wa\"æ˜¯\"iowait\"çš„ç¼©å†™ï¼Œä»£è¡¨ç­‰å¾…I/Oçš„æ—¶é—´ï¼Œè¿™é‡Œçš„I/Oæ˜¯æŒ‡Disk I/Oã€‚</p><p>ç´§æ¥ç€ï¼Œå½“ç£ç›˜è¿”å›æ•°æ®æ—¶ï¼Œè¿›ç¨‹åœ¨å†…æ ¸æ€æ‹¿åˆ°æ•°æ®ï¼Œè¿™é‡Œä»æ—§æ˜¯å†…æ ¸æ€çš„CPUä½¿ç”¨ä¸­çš„\"sy\"ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„ç¬¬å››ä¸ªæ¡†ã€‚</p><p>ç„¶åï¼Œè¿›ç¨‹å†ä»å†…æ ¸æ€åˆ‡æ¢å›ç”¨æˆ·æ€ï¼Œåœ¨ç”¨æˆ·æ€å¾—åˆ°æ–‡ä»¶æ•°æ®ï¼Œè¿™é‡Œè¿›ç¨‹åˆå›åˆ°ç”¨æˆ·æ€çš„CPUä½¿ç”¨ï¼Œ\"us\"ï¼Œå¯¹åº”å›¾ä¸­ç¬¬äº”ä¸ªæ¡†ã€‚</p><p>å¥½ï¼Œè¿™é‡Œæˆ‘ä»¬å‡è®¾ä¸€ä¸‹ï¼Œè¿™ä¸ªç”¨æˆ·è¿›ç¨‹åœ¨è¯»å–æ•°æ®ä¹‹åï¼Œæ²¡äº‹å¯åšå°±ä¼‘çœ äº†ã€‚å¹¶ä¸”æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥å‡è®¾ï¼Œè¿™æ—¶åœ¨è¿™ä¸ªCPUä¸Šä¹Ÿæ²¡æœ‰å…¶ä»–éœ€è¦è¿è¡Œçš„è¿›ç¨‹äº†ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±ä¼šè¿›å…¥\"id\"è¿™ä¸ªæ­¥éª¤ï¼Œä¹Ÿå°±æ˜¯ç¬¬å…­ä¸ªæ¡†ã€‚\"id\"æ˜¯\"idle\"çš„ç¼©å†™ï¼Œä»£è¡¨ç³»ç»Ÿå¤„äºç©ºé—²çŠ¶æ€ã€‚</p><p>å¦‚æœè¿™æ—¶è¿™å°æœºå™¨åœ¨ç½‘ç»œæ”¶åˆ°ä¸€ä¸ªç½‘ç»œæ•°æ®åŒ…ï¼Œç½‘å¡å°±ä¼šå‘å‡ºä¸€ä¸ªä¸­æ–­ï¼ˆinterruptï¼‰ã€‚ç›¸åº”åœ°ï¼ŒCPUä¼šå“åº”ä¸­æ–­ï¼Œç„¶åè¿›å…¥ä¸­æ–­æœåŠ¡ç¨‹åºã€‚</p><p>è¿™æ—¶ï¼ŒCPUå°±ä¼šè¿›å…¥\"hi\"ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸ƒä¸ªæ¡†ã€‚\"hi\"æ˜¯\"hardware irq\"çš„ç¼©å†™ï¼Œä»£è¡¨CPUå¤„ç†ç¡¬ä¸­æ–­çš„å¼€é”€ã€‚ç”±äºæˆ‘ä»¬çš„ä¸­æ–­æœåŠ¡å¤„ç†éœ€è¦å…³é—­ä¸­æ–­ï¼Œæ‰€ä»¥è¿™ä¸ªç¡¬ä¸­æ–­çš„æ—¶é—´ä¸èƒ½å¤ªé•¿ã€‚</p><p>ä½†æ˜¯ï¼Œå‘ç”Ÿä¸­æ–­åçš„å·¥ä½œæ˜¯å¿…é¡»è¦å®Œæˆçš„ï¼Œå¦‚æœè¿™äº›å·¥ä½œæ¯”è¾ƒè€—æ—¶é‚£æ€ä¹ˆåŠå‘¢ï¼ŸLinuxä¸­æœ‰ä¸€ä¸ªè½¯ä¸­æ–­çš„æ¦‚å¿µï¼ˆsoftirqï¼‰ï¼Œå®ƒå¯ä»¥å®Œæˆè¿™äº›è€—æ—¶æ¯”è¾ƒé•¿çš„å·¥ä½œã€‚</p><p>ä½ å¯ä»¥è¿™æ ·ç†è§£è¿™ä¸ªè½¯ä¸­æ–­ï¼Œä»ç½‘å¡æ”¶åˆ°æ•°æ®åŒ…çš„å¤§éƒ¨åˆ†å·¥ä½œï¼Œéƒ½æ˜¯é€šè¿‡è½¯ä¸­æ–­æ¥å¤„ç†çš„ã€‚é‚£ä¹ˆï¼ŒCPUå°±ä¼šè¿›å…¥åˆ°ç¬¬å…«ä¸ªæ¡†ï¼Œ\"si\"ã€‚è¿™é‡Œ\"si\"æ˜¯\"softirq\"çš„ç¼©å†™ï¼Œä»£è¡¨CPUå¤„ç†è½¯ä¸­æ–­çš„å¼€é”€ã€‚</p><p>è¿™é‡Œä½ è¦æ³¨æ„ï¼Œæ— è®ºæ˜¯\"hi\"è¿˜æ˜¯\"si\"ï¼Œå®ƒä»¬çš„CPUæ—¶é—´éƒ½ä¸ä¼šè®¡å…¥è¿›ç¨‹çš„CPUæ—¶é—´ã€‚<strong>è¿™æ˜¯å› ä¸ºæœ¬èº«å®ƒä»¬åœ¨å¤„ç†çš„æ—¶å€™å°±ä¸å±äºä»»ä½•ä¸€ä¸ªè¿›ç¨‹ã€‚</strong></p><p>å¥½äº†ï¼Œé€šè¿‡è¿™ä¸ªåœºæ™¯å‡è®¾ï¼Œæˆ‘ä»¬ä»‹ç»äº†å¤§éƒ¨åˆ†çš„Linux CPUä½¿ç”¨ã€‚</p><p>ä¸è¿‡ï¼Œæˆ‘ä»¬è¿˜å‰©ä¸¤ä¸ªç±»å‹çš„CPUä½¿ç”¨æ²¡è®²åˆ°ï¼Œæˆ‘æƒ³ç»™ä½ åšä¸ªè¡¥å……ï¼Œä¸€æ¬¡æ€§å¸¦ä½ åšä¸ªå…¨é¢äº†è§£ã€‚è¿™æ ·ä»¥åä½ è§£å†³ç›¸å…³é—®é¢˜æ—¶ï¼Œå°±ä¸ä¼šå†çŠ¹è±«ï¼Œè¿™äº›å€¼åˆ°åº•å½±ä¸å½±å“CPU Cgroupä¸­çš„é™åˆ¶äº†ã€‚ä¸‹é¢æˆ‘ç»™ä½ å…·ä½“è®²ä¸€ä¸‹ã€‚</p><p>ä¸€ä¸ªæ˜¯\"ni\"ï¼Œæ˜¯\"nice\"çš„ç¼©å†™ï¼Œè¿™é‡Œè¡¨ç¤ºå¦‚æœè¿›ç¨‹çš„niceå€¼æ˜¯æ­£å€¼ï¼ˆ1-19ï¼‰ï¼Œä»£è¡¨ä¼˜å…ˆçº§æ¯”è¾ƒä½çš„è¿›ç¨‹è¿è¡Œæ—¶æ‰€å ç”¨çš„CPUã€‚</p><p>å¦å¤–ä¸€ä¸ªæ˜¯\"st\"ï¼Œ\"st\"æ˜¯\"steal\"çš„ç¼©å†™ï¼Œæ˜¯åœ¨è™šæ‹Ÿæœºé‡Œç”¨çš„ä¸€ä¸ªCPUä½¿ç”¨ç±»å‹ï¼Œè¡¨ç¤ºæœ‰å¤šå°‘æ—¶é—´æ˜¯è¢«åŒä¸€ä¸ªå®¿ä¸»æœºä¸Šçš„å…¶ä»–è™šæ‹ŸæœºæŠ¢èµ°çš„ã€‚</p><p>ç»¼åˆå‰é¢çš„å†…å®¹ï¼Œæˆ‘å†ç”¨è¡¨æ ¼ä¸ºä½ æ€»ç»“ä¸€ä¸‹ï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/a4/a3/a4f537187a16e872ebcc605d972672a3.jpeg?wh=3200*1800\" alt=\"\"></p><h3>CPU Cgroup</h3><p>åœ¨ç¬¬ä¸€è®²ä¸­ï¼Œæˆ‘ä»¬æåˆ°è¿‡Cgroupsæ˜¯å¯¹æŒ‡å®šè¿›ç¨‹åšè®¡ç®—æœºèµ„æºé™åˆ¶çš„ï¼ŒCPU  Cgroupæ˜¯Cgroupså…¶ä¸­çš„ä¸€ä¸ªCgroupså­ç³»ç»Ÿï¼Œå®ƒæ˜¯ç”¨æ¥é™åˆ¶è¿›ç¨‹çš„CPUä½¿ç”¨çš„ã€‚</p><p>å¯¹äºè¿›ç¨‹çš„CPUä½¿ç”¨, é€šè¿‡å‰é¢çš„Linux CPUä½¿ç”¨åˆ†ç±»çš„ä»‹ç»ï¼Œæˆ‘ä»¬çŸ¥é“å®ƒåªåŒ…å«ä¸¤éƒ¨åˆ†: ä¸€ä¸ªæ˜¯ç”¨æˆ·æ€ï¼Œè¿™é‡Œçš„ç”¨æˆ·æ€åŒ…å«äº†uså’Œniï¼›è¿˜æœ‰ä¸€éƒ¨åˆ†æ˜¯å†…æ ¸æ€ï¼Œä¹Ÿå°±æ˜¯syã€‚</p><p>è‡³äºwaã€hiã€siï¼Œè¿™äº›I/Oæˆ–è€…ä¸­æ–­ç›¸å…³çš„CPUä½¿ç”¨ï¼ŒCPU Cgroupä¸ä¼šå»åšé™åˆ¶ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥çœ‹çœ‹CPU  Cgoupæ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ</p><p>æ¯ä¸ªCgroupså­ç³»ç»Ÿéƒ½æ˜¯é€šè¿‡ä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹çš„æ–¹å¼ï¼ŒæŒ‚åˆ°ä¸€ä¸ªç¼ºçœçš„ç›®å½•ä¸‹ï¼ŒCPU  Cgroup ä¸€èˆ¬åœ¨Linux å‘è¡Œç‰ˆé‡Œä¼šæ”¾åœ¨ <code>/sys/fs/cgroup/cpu</code> è¿™ä¸ªç›®å½•ä¸‹ã€‚</p><p>åœ¨è¿™ä¸ªå­ç³»ç»Ÿçš„ç›®å½•ä¸‹ï¼Œæ¯ä¸ªæ§åˆ¶ç»„ï¼ˆControl Groupï¼‰ éƒ½æ˜¯ä¸€ä¸ªå­ç›®å½•ï¼Œå„ä¸ªæ§åˆ¶ç»„ä¹‹é—´çš„å…³ç³»å°±æ˜¯ä¸€ä¸ªæ ‘çŠ¶çš„å±‚çº§å…³ç³»ï¼ˆhierarchyï¼‰ã€‚</p><p>æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬åœ¨å­ç³»ç»Ÿçš„æœ€é¡¶å±‚å¼€å§‹å»ºç«‹ä¸¤ä¸ªæ§åˆ¶ç»„ï¼ˆä¹Ÿå°±æ˜¯å»ºç«‹ä¸¤ä¸ªç›®å½•ï¼‰group1 å’Œ group2ï¼Œç„¶åå†åœ¨group2çš„ä¸‹é¢å†å»ºç«‹ä¸¤ä¸ªæ§åˆ¶ç»„group3å’Œgroup4ã€‚</p><p>è¿™æ ·æ“ä½œä»¥åï¼Œæˆ‘ä»¬å°±å»ºç«‹äº†ä¸€ä¸ªæ ‘çŠ¶çš„æ§åˆ¶ç»„å±‚çº§ï¼Œä½ å¯ä»¥å‚è€ƒä¸‹é¢çš„ç¤ºæ„å›¾ã€‚<br>\n<img src=\"https://static001.geekbang.org/resource/image/8b/54/8b86bc86706b0bbfe8fe157ee21b6454.jpeg?wh=3200*1800\" alt=\"\"></p><p>é‚£ä¹ˆæˆ‘ä»¬çš„æ¯ä¸ªæ§åˆ¶ç»„é‡Œï¼Œéƒ½æœ‰å“ªäº›CPU  Cgroupç›¸å…³çš„æ§åˆ¶ä¿¡æ¯å‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬éœ€è¦çœ‹ä¸€ä¸‹æ¯ä¸ªæ§åˆ¶ç»„ç›®å½•ä¸­çš„å†…å®¹ï¼š</p><pre><code class=\"language-shell\"> # pwd\n/sys/fs/cgroup/cpu\n# mkdir group1 group2\n# cd group2\n# mkdir group3 group4\n# cd group3\n# ls cpu.*\ncpu.cfs_period_us  cpu.cfs_quota_us  cpu.rt_period_us  cpu.rt_runtime_us  cpu.shares  cpu.stat \n</code></pre><p>è€ƒè™‘åˆ°åœ¨äº‘å¹³å°é‡Œå‘¢ï¼Œå¤§éƒ¨åˆ†ç¨‹åºéƒ½ä¸æ˜¯å®æ—¶è°ƒåº¦çš„è¿›ç¨‹ï¼Œè€Œæ˜¯æ™®é€šè°ƒåº¦ï¼ˆSCHED_NORMALï¼‰ç±»å‹è¿›ç¨‹ï¼Œé‚£ä»€ä¹ˆæ˜¯æ™®é€šè°ƒåº¦ç±»å‹å‘¢ï¼Ÿ</p><p>å› ä¸ºæ™®é€šè°ƒåº¦çš„ç®—æ³•åœ¨Linuxä¸­ç›®å‰æ˜¯CFS ï¼ˆCompletely Fair Schedulerï¼Œå³å®Œå…¨å…¬å¹³è°ƒåº¦å™¨ï¼‰ã€‚ä¸ºäº†æ–¹ä¾¿ä½ ç†è§£ï¼Œæˆ‘ä»¬å°±ç›´æ¥æ¥çœ‹CPU Cgroupå’ŒCFSç›¸å…³çš„å‚æ•°ï¼Œä¸€å…±æœ‰ä¸‰ä¸ªã€‚</p><p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ <strong>cpu.cfs_period_us</strong>ï¼Œå®ƒæ˜¯CFSç®—æ³•çš„ä¸€ä¸ªè°ƒåº¦å‘¨æœŸï¼Œä¸€èˆ¬å®ƒçš„å€¼æ˜¯100000ï¼Œä»¥microsecondsä¸ºå•ä½ï¼Œä¹Ÿå°±100msã€‚</p><p>ç¬¬äºŒä¸ªå‚æ•°æ˜¯ <strong>cpu.cfs_quota_us</strong>ï¼Œå®ƒâ€œè¡¨ç¤ºCFSç®—æ³•ä¸­ï¼Œåœ¨ä¸€ä¸ªè°ƒåº¦å‘¨æœŸé‡Œè¿™ä¸ªæ§åˆ¶ç»„è¢«å…è®¸çš„è¿è¡Œæ—¶é—´ï¼Œæ¯”å¦‚è¿™ä¸ªå€¼ä¸º50000æ—¶ï¼Œå°±æ˜¯50msã€‚</p><p>å¦‚æœç”¨è¿™ä¸ªå€¼å»é™¤ä»¥è°ƒåº¦å‘¨æœŸï¼ˆä¹Ÿå°±æ˜¯cpu.cfs_period_usï¼‰ï¼Œ50ms/100ms = 0.5ï¼Œè¿™æ ·è¿™ä¸ªæ§åˆ¶ç»„è¢«å…è®¸ä½¿ç”¨çš„CPUæœ€å¤§é…é¢å°±æ˜¯0.5ä¸ªCPUã€‚</p><p>ä»è¿™é‡Œèƒ½å¤Ÿçœ‹å‡ºï¼Œcpu.cfs_quota_usæ˜¯ä¸€ä¸ªç»å¯¹å€¼ã€‚å¦‚æœè¿™ä¸ªå€¼æ˜¯200000ï¼Œä¹Ÿå°±æ˜¯200msï¼Œé‚£ä¹ˆå®ƒé™¤ä»¥periodï¼Œä¹Ÿå°±æ˜¯200ms/100ms=2ã€‚</p><p>ä½ çœ‹ï¼Œç»“æœè¶…è¿‡äº†1ä¸ªCPUï¼Œè¿™å°±æ„å‘³ç€è¿™æ—¶æ§åˆ¶ç»„éœ€è¦2ä¸ªCPUçš„èµ„æºé…é¢ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œ <strong>cpu.shares</strong>ã€‚è¿™ä¸ªå€¼æ˜¯CPU  Cgroupå¯¹äºæ§åˆ¶ç»„ä¹‹é—´çš„CPUåˆ†é…æ¯”ä¾‹ï¼Œå®ƒçš„ç¼ºçœå€¼æ˜¯1024ã€‚</p><p>å‡è®¾æˆ‘ä»¬å‰é¢åˆ›å»ºçš„group3ä¸­çš„cpu.sharesæ˜¯1024ï¼Œè€Œgroup4ä¸­çš„cpu.sharesæ˜¯3072ï¼Œé‚£ä¹ˆgroup3:group4=1:3ã€‚</p><p>è¿™ä¸ªæ¯”ä¾‹æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæˆ‘è¿˜æ˜¯ä¸¾ä¸ªå…·ä½“çš„ä¾‹å­æ¥è¯´æ˜å§ã€‚</p><p>åœ¨ä¸€å°4ä¸ªCPUçš„æœºå™¨ä¸Šï¼Œå½“group3å’Œgroup4éƒ½éœ€è¦4ä¸ªCPUçš„æ—¶å€™ï¼Œå®ƒä»¬å®é™…åˆ†é…åˆ°çš„CPUåˆ†åˆ«æ˜¯è¿™æ ·çš„ï¼šgroup3æ˜¯1ä¸ªï¼Œgroup4æ˜¯3ä¸ªã€‚</p><p>æˆ‘ä»¬åˆšæ‰è®²äº†CPU Cgroupé‡Œçš„ä¸‰ä¸ªå…³é”®å‚æ•°ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±é€šè¿‡å‡ ä¸ªä¾‹å­æ¥è¿›ä¸€æ­¥ç†è§£ä¸€ä¸‹ï¼Œä»£ç ä½ å¯ä»¥åœ¨<a href=\"https://github.com/chengyli/training/tree/master/cpu/cgroup_cpu\">è¿™é‡Œ</a>æ‰¾åˆ°ã€‚</p><p>ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªæ¶ˆè€—2ä¸ªCPUï¼ˆ200%ï¼‰çš„ç¨‹åºthreads-cpuï¼Œç„¶åæŠŠè¿™ä¸ªç¨‹åºçš„pidåŠ å…¥åˆ°group3çš„æ§åˆ¶ç»„é‡Œï¼š</p><pre><code>./threads-cpu/threads-cpu 2 &amp;\necho $! &gt; /sys/fs/cgroup/cpu/group2/group3/cgroup.procs \n</code></pre><p>åœ¨æˆ‘ä»¬æ²¡æœ‰ä¿®æ”¹cpu.cfs_quota_uså‰ï¼Œç”¨topå‘½ä»¤å¯ä»¥çœ‹åˆ°threads-cpuè¿™ä¸ªè¿›ç¨‹çš„CPU  ä½¿ç”¨æ˜¯199%ï¼Œè¿‘ä¼¼2ä¸ªCPUã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/1e/b8/1e95db3f15fc4cf1573f8ebe22db38b8.png?wh=1640*142\" alt=\"\"></p><p>ç„¶åï¼Œæˆ‘ä»¬æ›´æ–°è¿™ä¸ªæ§åˆ¶ç»„é‡Œçš„cpu.cfs_quota_usï¼ŒæŠŠå®ƒè®¾ç½®ä¸º150000ï¼ˆ150msï¼‰ã€‚æŠŠè¿™ä¸ªå€¼é™¤ä»¥cpu.cfs_period_usï¼Œè®¡ç®—è¿‡ç¨‹æ˜¯150ms/100ms=1.5, ä¹Ÿå°±æ˜¯1.5ä¸ªCPUï¼ŒåŒæ—¶æˆ‘ä»¬ä¹ŸæŠŠcpu.sharesè®¾ç½®ä¸º1024ã€‚</p><pre><code>echo 150000 &gt; /sys/fs/cgroup/cpu/group2/group3/cpu.cfs_quota_us\necho 1024 &gt; /sys/fs/cgroup/cpu/group2/group3/cpu.shares\n</code></pre><p>è¿™æ—¶å€™æˆ‘ä»¬å†è¿è¡Œtopï¼Œå°±ä¼šå‘ç°threads-cpuè¿›ç¨‹çš„CPUä½¿ç”¨å‡å°åˆ°äº†150%ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬è®¾ç½®çš„cpu.cfs_quota_usèµ·äº†ä½œç”¨ï¼Œé™åˆ¶äº†è¿›ç¨‹CPUçš„ç»å¯¹å€¼ã€‚</p><p>ä½†è¿™æ—¶å€™cpu.sharesçš„ä½œç”¨è¿˜æ²¡æœ‰å‘æŒ¥å‡ºæ¥ï¼Œå› ä¸ºcpu.sharesæ˜¯å‡ ä¸ªæ§åˆ¶ç»„ä¹‹é—´çš„CPUåˆ†é…æ¯”ä¾‹ï¼Œè€Œä¸”ä¸€å®šè¦åˆ°æ•´ä¸ªèŠ‚ç‚¹ä¸­æ‰€æœ‰çš„CPUéƒ½è·‘æ»¡çš„æ—¶å€™ï¼Œå®ƒæ‰èƒ½å‘æŒ¥ä½œç”¨ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/3c/7e/3c153bba9d7668c22048602d730d627e.png?wh=1670*142\" alt=\"\"></p><p>å¥½ï¼Œä¸‹é¢æˆ‘ä»¬å†æ¥è¿è¡Œç¬¬äºŒä¸ªä¾‹å­æ¥ç†è§£cpu.sharesã€‚æˆ‘ä»¬å…ˆæŠŠç¬¬ä¸€ä¸ªä¾‹å­é‡Œçš„ç¨‹åºå¯åŠ¨ï¼ŒåŒæ—¶æŒ‰å‰é¢çš„å†…å®¹ï¼Œä¸€æ­¥æ­¥è®¾ç½®å¥½group3é‡Œcpu.cfs_quota_us å’Œcpu.sharesã€‚</p><p>è®¾ç½®å®Œæˆåï¼Œæˆ‘ä»¬å†å¯åŠ¨ç¬¬äºŒä¸ªç¨‹åºï¼Œå¹¶ä¸”è®¾ç½®å¥½group4é‡Œçš„cpu.cfs_quota_us å’Œ cpu.sharesã€‚</p><p>group3ï¼š</p><pre><code>./threads-cpu/threads-cpu 2 &amp;  # å¯åŠ¨ä¸€ä¸ªæ¶ˆè€—2ä¸ªCPUçš„ç¨‹åº\necho $! &gt; /sys/fs/cgroup/cpu/group2/group3/cgroup.procs #æŠŠç¨‹åºçš„pidåŠ å…¥åˆ°æ§åˆ¶ç»„\necho 150000 &gt; /sys/fs/cgroup/cpu/group2/group3/cpu.cfs_quota_us #é™åˆ¶CPUä¸º1.5CPU\necho 1024 &gt; /sys/fs/cgroup/cpu/group2/group3/cpu.shares \n\n</code></pre><p>group4ï¼š</p><pre><code>./threads-cpu/threads-cpu 4 &amp;  # å¯åŠ¨ä¸€ä¸ªæ¶ˆè€—4ä¸ªCPUçš„ç¨‹åº\necho $! &gt; /sys/fs/cgroup/cpu/group2/group4/cgroup.procs #æŠŠç¨‹åºçš„pidåŠ å…¥åˆ°æ§åˆ¶ç»„\necho 350000 &gt; /sys/fs/cgroup/cpu/group2/group4/cpu.cfs_quota_us  #é™åˆ¶CPUä¸º3.5CPU\necho 3072 &gt; /sys/fs/cgroup/cpu/group2/group3/cpu.shares # shares æ¯”ä¾‹ group4: group3 = 3:1\n</code></pre><p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬çš„èŠ‚ç‚¹ä¸Šæ€»å…±æœ‰4ä¸ªCPUï¼Œè€Œgroup3çš„ç¨‹åºéœ€è¦æ¶ˆè€—2ä¸ªCPUï¼Œgroup4é‡Œçš„ç¨‹åºè¦æ¶ˆè€—4ä¸ªCPUã€‚</p><p>å³ä½¿cpu.cfs_quota_uså·²ç»é™åˆ¶äº†è¿›ç¨‹CPUä½¿ç”¨çš„ç»å¯¹å€¼ï¼Œgroup3çš„é™åˆ¶æ˜¯1.5CPUï¼Œgroup4æ˜¯3.5CPUï¼Œ1.5+3.5=5ï¼Œè¿™ä¸ªç»“æœè¿˜æ˜¯è¶…è¿‡äº†èŠ‚ç‚¹ä¸Šçš„4ä¸ªCPUã€‚</p><p>å¥½äº†ï¼Œè¯´åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å‘ç°åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œcpu.sharesç»ˆäºå¼€å§‹èµ·ä½œç”¨äº†ã€‚</p><p>åœ¨è¿™é‡Œsharesæ¯”ä¾‹æ˜¯group4:group3=3:1ï¼Œåœ¨æ€»å…±4ä¸ªCPUçš„èŠ‚ç‚¹ä¸Šï¼ŒæŒ‰ç…§æ¯”ä¾‹ï¼Œgroup4é‡Œçš„è¿›ç¨‹åº”è¯¥åˆ†é…åˆ°3ä¸ªCPUï¼Œè€Œgroup3é‡Œçš„è¿›ç¨‹ä¼šåˆ†é…åˆ°1ä¸ªCPUã€‚</p><p>æˆ‘ä»¬ç”¨topå¯ä»¥çœ‹ä¸€ä¸‹ï¼Œç»“æœå’Œæˆ‘ä»¬é¢„æœŸçš„ä¸€æ ·ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/84/a3/8424b7fb4c84679412f75774060fcca3.png?wh=1630*152\" alt=\"\"></p><p>å¥½äº†ï¼Œæˆ‘ä»¬å¯¹CPU Cgroupçš„å‚æ•°åšä¸€ä¸ªæ¢³ç†ã€‚</p><p>ç¬¬ä¸€ç‚¹ï¼Œcpu.cfs_quota_uså’Œcpu.cfs_period_usè¿™ä¸¤ä¸ªå€¼å†³å®šäº†<strong>æ¯ä¸ªæ§åˆ¶ç»„ä¸­æ‰€æœ‰è¿›ç¨‹çš„å¯ä½¿ç”¨CPUèµ„æºçš„æœ€å¤§å€¼ã€‚</strong></p><p>ç¬¬äºŒç‚¹ï¼Œcpu.sharesè¿™ä¸ªå€¼å†³å®šäº†<strong>CPU Cgroupå­ç³»ç»Ÿä¸‹æ§åˆ¶ç»„å¯ç”¨CPUçš„ç›¸å¯¹æ¯”ä¾‹</strong>ï¼Œä¸è¿‡åªæœ‰å½“ç³»ç»Ÿä¸ŠCPUå®Œå…¨è¢«å æ»¡çš„æ—¶å€™ï¼Œè¿™ä¸ªæ¯”ä¾‹æ‰ä¼šåœ¨å„ä¸ªæ§åˆ¶ç»„é—´èµ·ä½œç”¨ã€‚</p><h2>ç°è±¡è§£é‡Š</h2><p>åœ¨è§£é‡Šäº†Linux CPU Usageå’ŒCPU Cgroupè¿™ä¸¤ä¸ªåŸºæœ¬æ¦‚å¿µä¹‹åï¼Œæˆ‘ä»¬å†å›åˆ°æˆ‘ä»¬æœ€åˆçš„é—®é¢˜ â€œæ€ä¹ˆé™åˆ¶å®¹å™¨çš„CPUä½¿ç”¨â€ã€‚æœ‰äº†åŸºç¡€çŸ¥è¯†çš„é“ºå«ï¼Œè¿™ä¸ªé—®é¢˜å°±æ¯”è¾ƒå¥½è§£é‡Šäº†ã€‚</p><p>é¦–å…ˆï¼ŒKubernetesä¼šä¸ºæ¯ä¸ªå®¹å™¨éƒ½åœ¨CPUCgroupçš„å­ç³»ç»Ÿä¸­å»ºç«‹ä¸€ä¸ªæ§åˆ¶ç»„ï¼Œç„¶åæŠŠå®¹å™¨ä¸­è¿›ç¨‹å†™å…¥åˆ°è¿™ä¸ªæ§åˆ¶ç»„é‡Œã€‚</p><p>è¿™æ—¶å€™\"Limit CPU\"å°±éœ€è¦ä¸ºå®¹å™¨è®¾ç½®å¯ç”¨CPUçš„ä¸Šé™ã€‚ç»“åˆå‰é¢æˆ‘ä»¬è®²çš„å‡ ä¸ªå‚æ•°ä¹ˆï¼Œæˆ‘ä»¬å°±èƒ½çŸ¥é“å®¹å™¨çš„CPUä¸Šé™å…·ä½“å¦‚ä½•è®¡ç®—äº†ã€‚</p><p>å®¹å™¨CPUçš„ä¸Šé™ç”±cpu.cfs_quota_usé™¤ä»¥cpu.cfs_period_uså¾—å‡ºçš„å€¼æ¥å†³å®šçš„ã€‚è€Œä¸”ï¼Œåœ¨æ“ä½œç³»ç»Ÿé‡Œï¼Œcpu.cfs_period_usçš„å€¼ä¸€èˆ¬æ˜¯ä¸ªå›ºå®šå€¼ï¼ŒKubernetesä¸ä¼šå»ä¿®æ”¹å®ƒï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æ˜¯åªä¿®æ”¹cpu.cfs_quota_usã€‚</p><p>è€Œ\"Request CPU\"å°±æ˜¯æ— è®ºå…¶ä»–å®¹å™¨ç”³è¯·å¤šå°‘CPUèµ„æºï¼Œå³ä½¿è¿è¡Œæ—¶æ•´ä¸ªèŠ‚ç‚¹çš„CPUéƒ½è¢«å æ»¡çš„æƒ…å†µä¸‹ï¼Œæˆ‘çš„è¿™ä¸ªå®¹å™¨è¿˜æ˜¯å¯ä»¥ä¿è¯è·å¾—éœ€è¦çš„CPUæ•°ç›®ï¼Œé‚£ä¹ˆè¿™ä¸ªè®¾ç½®å…·ä½“è¦æ€ä¹ˆå®ç°å‘¢ï¼Ÿ</p><p>æ˜¾ç„¶æˆ‘ä»¬éœ€è¦è®¾ç½®cpu.sharesè¿™ä¸ªå‚æ•°ï¼š<strong>åœ¨CPU Cgroupä¸­cpu.shares == 1024è¡¨ç¤º1ä¸ªCPUçš„æ¯”ä¾‹ï¼Œé‚£ä¹ˆRequest CPUçš„å€¼å°±æ˜¯nï¼Œç»™cpu.sharesçš„èµ‹å€¼å¯¹åº”å°±æ˜¯n*1024ã€‚</strong></p><h2>é‡ç‚¹æ€»ç»“</h2><p>é¦–å…ˆï¼Œæˆ‘å¸¦ä½ äº†è§£äº†Linuxä¸‹CPU Usageçš„ç§ç±».</p><p>è¿™é‡Œä½ è¦æ³¨æ„çš„æ˜¯<strong>æ¯ä¸ªè¿›ç¨‹çš„CPU UsageåªåŒ…å«ç”¨æˆ·æ€ï¼ˆusæˆ–niï¼‰å’Œå†…æ ¸æ€ï¼ˆsyï¼‰ä¸¤éƒ¨åˆ†ï¼Œå…¶ä»–çš„ç³»ç»ŸCPUå¼€é”€å¹¶ä¸åŒ…å«åœ¨è¿›ç¨‹çš„CPUä½¿ç”¨ä¸­ï¼Œè€ŒCPU Cgroupåªæ˜¯å¯¹è¿›ç¨‹çš„CPUä½¿ç”¨åšäº†é™åˆ¶ã€‚</strong></p><p>å…¶å®è¿™ä¸€è®²æˆ‘ä»¬å¼€ç¯‡çš„é—®é¢˜â€œæ€ä¹ˆé™åˆ¶å®¹å™¨çš„CPUä½¿ç”¨â€ï¼Œè¿™ä¸ªé—®é¢˜èƒŒåéšè—äº†å¦ä¸€ä¸ªé—®é¢˜ï¼Œä¹Ÿå°±æ˜¯å®¹å™¨æ˜¯å¦‚ä½•è®¾ç½®å®ƒçš„CPU Cgroupä¸­å‚æ•°å€¼çš„ï¼Ÿæƒ³è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±è¦å…ˆçŸ¥é“CPU Cgroupéƒ½æœ‰å“ªäº›å‚æ•°ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘è¯¦ç»†ç»™ä½ ä»‹ç»äº†CPU Cgroupä¸­çš„ä¸»è¦å‚æ•°ï¼ŒåŒ…æ‹¬è¿™ä¸‰ä¸ªï¼š<strong>cpu.cfs_quota_usï¼Œcpu.cfs_period_us è¿˜æœ‰cpu.sharesã€‚</strong></p><p>å…¶ä¸­ï¼Œcpu.cfs_quota_usï¼ˆä¸€ä¸ªè°ƒåº¦å‘¨æœŸé‡Œè¿™ä¸ªæ§åˆ¶ç»„è¢«å…è®¸çš„è¿è¡Œæ—¶é—´ï¼‰é™¤ä»¥cpu.cfs_period_usï¼ˆç”¨äºè®¾ç½®è°ƒåº¦å‘¨æœŸï¼‰å¾—åˆ°çš„è¿™ä¸ªå€¼å†³å®šäº†CPU  Cgroupæ¯ä¸ªæ§åˆ¶ç»„ä¸­CPUä½¿ç”¨çš„ä¸Šé™å€¼ã€‚</p><p>ä½ è¿˜éœ€è¦æŒæ¡ä¸€ä¸ªcpu.shareså‚æ•°ï¼Œæ­£æ˜¯è¿™ä¸ªå€¼å†³å®šäº†CPU  Cgroupå­ç³»ç»Ÿä¸‹æ§åˆ¶ç»„å¯ç”¨CPUçš„ç›¸å¯¹æ¯”ä¾‹ï¼Œå½“ç³»ç»Ÿä¸ŠCPUå®Œå…¨è¢«å æ»¡çš„æ—¶å€™ï¼Œè¿™ä¸ªæ¯”ä¾‹æ‰ä¼šåœ¨å„ä¸ªæ§åˆ¶ç»„é—´èµ·æ•ˆã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬æ˜ç™½äº†CPU Cgroupå…³é”®å‚æ•°æ˜¯ä»€ä¹ˆå«ä¹‰åï¼ŒKubernetesä¸­\"Limit CPU\"å’Œ \"Request CPU\"ä¹Ÿå°±å¾ˆå¥½è§£é‡Šäº†:</p><p><strong> Limit CPUå°±æ˜¯å®¹å™¨æ‰€åœ¨Cgroupæ§åˆ¶ç»„ä¸­çš„CPUä¸Šé™å€¼ï¼ŒRequest CPUçš„å€¼å°±æ˜¯æ§åˆ¶ç»„ä¸­çš„cpu.sharesçš„å€¼ã€‚</strong></p><h2>æ€è€ƒé¢˜</h2><p>æˆ‘ä»¬è¿˜æ˜¯æŒ‰ç…§æ–‡æ¡£ä¸­å®šä¹‰çš„æ§åˆ¶ç»„ç›®å½•å±‚æ¬¡ç»“æ„å›¾ï¼Œç„¶åæŒ‰åºæ‰§è¡Œè¿™å‡ ä¸ªè„šæœ¬ï¼š</p><ul>\n<li><a href=\"https://github.com/chengyli/training/blob/main/cpu/cgroup_cpu/create_groups.sh\">create_groups.sh</a></li>\n<li><a href=\"https://github.com/chengyli/training/blob/main/cpu/cgroup_cpu/update_group1.sh\">update_group1.sh</a></li>\n<li><a href=\"https://github.com/chengyli/training/blob/main/cpu/cgroup_cpu/update_group4.sh\">update_group4.sh</a></li>\n<li><a href=\"https://github.com/chengyli/training/blob/main/cpu/cgroup_cpu/update_group3.sh\">update_group3.sh</a></li>\n</ul><p>é‚£ä¹ˆï¼Œåœ¨ä¸€ä¸ª4ä¸ªCPUçš„èŠ‚ç‚¹ä¸Šï¼Œgroup1/group3/group4é‡Œçš„è¿›ç¨‹ï¼Œåˆ†åˆ«ä¼šè¢«åˆ†é…åˆ°å¤šå°‘CPUå‘¢?</p><p>æ¬¢è¿ç•™è¨€å’Œæˆ‘åˆ†äº«ä½ çš„æ€è€ƒå’Œç–‘é—®ã€‚å¦‚æœä½ æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿæ¬¢è¿åˆ†äº«ç»™æœ‹å‹ï¼Œä¸€èµ·å­¦ä¹ å’Œäº¤æµã€‚</p>","neighbors":{"left":{"article_title":"04 | ç†è§£è¿›ç¨‹ï¼ˆ3ï¼‰ï¼šä¸ºä»€ä¹ˆæˆ‘åœ¨å®¹å™¨ä¸­çš„è¿›ç¨‹è¢«å¼ºåˆ¶æ€æ­»äº†ï¼Ÿ","id":310804},"right":{"article_title":"06 | å®¹å™¨CPUï¼ˆ2ï¼‰ï¼šå¦‚ä½•æ­£ç¡®åœ°æ‹¿åˆ°å®¹å™¨CPUçš„å¼€é”€ï¼Ÿ","id":313255}},"comments":[{"had_liked":false,"id":263759,"user_name":"è«å","can_delete":false,"product_type":"c1","uid":1007254,"ip_address":"","ucode":"E28F2602BA25DD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5e/96/a03175bc.jpg","comment_is_top":false,"comment_ctime":1606263668,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"139045217140","product_id":100063801,"comment_content":"CPU ä½¿ç”¨ç‡åˆ†è§£å›¾ç”»çš„æŒºæœ‰åˆ›æ„ğŸ‘","like_count":33,"discussions":[{"author":{"id":1248326,"avatar":"https://static001.geekbang.org/account/avatar/00/13/0c/46/dfe32cf4.jpg","nickname":"å¤šé€‰å‚æ•°","note":"","ucode":"B2294D80AB075F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387745,"discussion_content":"+1\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628395962,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2057406,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/64/be/546665e3.jpg","nickname":"å¿ƒéšç¼˜","note":"","ucode":"F7F5C49EA80E03","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":354824,"discussion_content":"+1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615346309,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":270023,"user_name":"Action","can_delete":false,"product_type":"c1","uid":1239234,"ip_address":"","ucode":"FFFD1537C6BB3C","user_header":"https://static001.geekbang.org/account/avatar/00/12/e8/c2/77a413a7.jpg","comment_is_top":false,"comment_ctime":1608880868,"is_pvip":false,"replies":[{"id":"98021","content":"è¿›ç¨‹å¦‚æœè®¾ç½®ä¸ºSCHED_FIFO æˆ–è€…SCHED_RRå®æ—¶è°ƒåº¦ç±»å‹ï¼Œé‚£ä¹ˆåªè¦è¿›ç¨‹ä»»åŠ¡ä¸ç»“æŸï¼Œå°±ä¸ä¼šæŠŠcpuèµ„æºè®©ç»™SCHED_NORMALè¿›ç¨‹ã€‚è¿™ç§å®æ—¶çš„è¿›ç¨‹ï¼Œåœ¨å®æ—¶æ€§è¦æ¯”è¾ƒé«˜çš„åµŒå…¥å¼ç³»ç»Ÿä¸­ä¼šç”¨åˆ°ï¼Œä½†æ˜¯äº‘å¹³å°ä¸­æä¾›äº’è”ç½‘æœåŠ¡çš„åº”ç”¨ä¸­ä¸å¤ªä¼šå»ç”¨å®æ—¶è°ƒåº¦ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1609082454,"ip_address":"","comment_id":270023,"utype":1}],"discussion_count":1,"race_medal":0,"score":"53148488420","product_id":100063801,"comment_content":"ä¸ºä»€ä¹ˆè¯´â€œäº‘å¹³å°é‡Œå‘¢ï¼Œå¤§éƒ¨åˆ†ç¨‹åºéƒ½ä¸æ˜¯å®æ—¶è°ƒåº¦çš„è¿›ç¨‹ï¼Œè€Œæ˜¯æ™®é€šè°ƒåº¦ï¼ˆSCHED_NORMALï¼‰ç±»å‹è¿›ç¨‹â€ï¼Ÿè¿™å—ä¸æ˜¯å¾ˆæ˜ç™½","like_count":12,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":512495,"discussion_content":"è¿›ç¨‹å¦‚æœè®¾ç½®ä¸ºSCHED_FIFO æˆ–è€…SCHED_RRå®æ—¶è°ƒåº¦ç±»å‹ï¼Œé‚£ä¹ˆåªè¦è¿›ç¨‹ä»»åŠ¡ä¸ç»“æŸï¼Œå°±ä¸ä¼šæŠŠcpuèµ„æºè®©ç»™SCHED_NORMALè¿›ç¨‹ã€‚è¿™ç§å®æ—¶çš„è¿›ç¨‹ï¼Œåœ¨å®æ—¶æ€§è¦æ¯”è¾ƒé«˜çš„åµŒå…¥å¼ç³»ç»Ÿä¸­ä¼šç”¨åˆ°ï¼Œä½†æ˜¯äº‘å¹³å°ä¸­æä¾›äº’è”ç½‘æœåŠ¡çš„åº”ç”¨ä¸­ä¸å¤ªä¼šå»ç”¨å®æ—¶è°ƒåº¦ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609082454,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":282642,"user_name":"å¿ƒéšç¼˜","can_delete":false,"product_type":"c1","uid":2057406,"ip_address":"","ucode":"F7F5C49EA80E03","user_header":"https://static001.geekbang.org/account/avatar/00/1f/64/be/546665e3.jpg","comment_is_top":false,"comment_ctime":1615346290,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"27385150066","product_id":100063801,"comment_content":"è€å¸ˆçš„æ—¶é—´è½´è®²è§£TOPéå¸¸æ£’ï¼CPU ä½¿ç”¨åˆ†è§£çš„å¾ˆåˆ°ä½~èµ!","like_count":6},{"had_liked":false,"id":263799,"user_name":"æµ·ç›—èˆ¹é•¿","can_delete":false,"product_type":"c1","uid":1363634,"ip_address":"","ucode":"ECB28BA21A4113","user_header":"https://static001.geekbang.org/account/avatar/00/14/ce/b2/1f914527.jpg","comment_is_top":false,"comment_ctime":1606269923,"is_pvip":false,"replies":[{"id":"95878","content":"é¦–å…ˆè¿™ä¸ªå®¹å™¨å·²ç»åœ¨èŠ‚ç‚¹ä¸Šè¿è¡Œäº†ï¼Œå¹¶ä¸”å…¶ä»–çš„å®¹å™¨ä¹Ÿéƒ½é…ç½®äº†cpu.sharesã€‚<br>æ¯”å¦‚sharesæ¯”ä¾‹ï¼Œ group4: group3=3:1ï¼Œ åœ¨ä¸€ä¸ª4ä¸ªCPUçš„èŠ‚ç‚¹ä¸Šï¼Œæˆ‘ä»¬å…ˆä¸ç”¨è€ƒè™‘limit, å¯¹äºgroup4,å¦‚æœæ²¡æœ‰group3çš„ç¨‹åºè¿è¡Œï¼Œé‚£ä¹ˆgroup4é‡Œçš„4ä¸ªçº¿ç¨‹è¿è¡Œçš„æ—¶å€™å¯ä»¥å ç”¨4ä¸ªCPUã€‚å½“group3é‡Œçš„2ä¸ªçº¿ç¨‹ä¹Ÿè¿è¡Œèµ·æ¥äº†ï¼Œå³ä½¿2ä¸ªçº¿ç¨‹æœ€å¤§å¯ä»¥æ¶ˆè€—2ä¸ªCPU,ä½†æ˜¯ç”±äºæœ‰äº†sharesæ¯”ä¾‹åˆ†é…ï¼Œé‚£ä¹ˆgroup4é‡Œçš„çº¿ç¨‹ä»ç„¶å¯ä»¥ä¿è¯æœ‰3ä¸ªCPU, è€Œåˆ†é…ç»™group3çš„åªæœ‰1ä¸ªCPUã€‚<br><br>cpu.sharesæ˜¯ä¸ªç›¸å¯¹å€¼ï¼Œä½†æ˜¯åœ¨LinuxèŠ‚ç‚¹ä¸Šä¸€èˆ¬çš„çº¦å®šæ˜¯ä»¥å€¼1024ä¸º1ä¸ªCPUçš„æ¯”ä¾‹ï¼Œå½“æ‰€æœ‰çš„é…ç½®éƒ½éµå®ˆè¿™ä¸ªçº¦å®šçš„æ—¶å€™ï¼Œé‚£ä¹ˆç»™å€¼N*1024, å°±è¡¨ç¤ºNä¸ªCPUçš„æ•°é‡äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1606477711,"ip_address":"","comment_id":263799,"utype":1}],"discussion_count":2,"race_medal":0,"score":"23081106403","product_id":100063801,"comment_content":"è€å¸ˆï¼Œä¸å¤ªæ˜ç™½  â€œRequest CPUå°±æ˜¯æ— è®ºå…¶ä»–å®¹å™¨ç”³è¯·å¤šå°‘ CPU èµ„æºï¼Œå³ä½¿è¿è¡Œæ—¶æ•´ä¸ªèŠ‚ç‚¹çš„ CPU éƒ½è¢«å æ»¡çš„æƒ…å†µä¸‹ï¼Œæˆ‘çš„è¿™ä¸ªå®¹å™¨è¿˜æ˜¯å¯ä»¥ä¿è¯è·å¾—éœ€è¦çš„ CPU æ•°ç›®â€ï¼Œè¿™å¥è¯æ”¹æ€ä¹ˆç†è§£å‘¢ï¼Ÿå½“èŠ‚ç‚¹cpuéƒ½è¢«å æ»¡çš„æƒ…å†µä¸‹ï¼Œæˆ‘çš„è¿™ä¸ªå®¹å™¨ä¼šå»æŠ¢å å—ï¼Ÿ å¦å¤–cpu.sharesæ˜¯ä¸ªæƒé‡ï¼Œå¦‚ä½•å»ä¿è¯Request CPUçš„æ•°é‡ï¼Ÿ","like_count":5,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510310,"discussion_content":"é¦–å…ˆè¿™ä¸ªå®¹å™¨å·²ç»åœ¨èŠ‚ç‚¹ä¸Šè¿è¡Œäº†ï¼Œå¹¶ä¸”å…¶ä»–çš„å®¹å™¨ä¹Ÿéƒ½é…ç½®äº†cpu.sharesã€‚\næ¯”å¦‚sharesæ¯”ä¾‹ï¼Œ group4: group3=3:1ï¼Œ åœ¨ä¸€ä¸ª4ä¸ªCPUçš„èŠ‚ç‚¹ä¸Šï¼Œæˆ‘ä»¬å…ˆä¸ç”¨è€ƒè™‘limit, å¯¹äºgroup4,å¦‚æœæ²¡æœ‰group3çš„ç¨‹åºè¿è¡Œï¼Œé‚£ä¹ˆgroup4é‡Œçš„4ä¸ªçº¿ç¨‹è¿è¡Œçš„æ—¶å€™å¯ä»¥å ç”¨4ä¸ªCPUã€‚å½“group3é‡Œçš„2ä¸ªçº¿ç¨‹ä¹Ÿè¿è¡Œèµ·æ¥äº†ï¼Œå³ä½¿2ä¸ªçº¿ç¨‹æœ€å¤§å¯ä»¥æ¶ˆè€—2ä¸ªCPU,ä½†æ˜¯ç”±äºæœ‰äº†sharesæ¯”ä¾‹åˆ†é…ï¼Œé‚£ä¹ˆgroup4é‡Œçš„çº¿ç¨‹ä»ç„¶å¯ä»¥ä¿è¯æœ‰3ä¸ªCPU, è€Œåˆ†é…ç»™group3çš„åªæœ‰1ä¸ªCPUã€‚\n\ncpu.sharesæ˜¯ä¸ªç›¸å¯¹å€¼ï¼Œä½†æ˜¯åœ¨LinuxèŠ‚ç‚¹ä¸Šä¸€èˆ¬çš„çº¦å®šæ˜¯ä»¥å€¼1024ä¸º1ä¸ªCPUçš„æ¯”ä¾‹ï¼Œå½“æ‰€æœ‰çš„é…ç½®éƒ½éµå®ˆè¿™ä¸ªçº¦å®šçš„æ—¶å€™ï¼Œé‚£ä¹ˆç»™å€¼N*1024, å°±è¡¨ç¤ºNä¸ªCPUçš„æ•°é‡äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606477711,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2028957,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/f5/9d/104bb8ea.jpg","nickname":"Geek2014","note":"","ucode":"9EB356D8DF287E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":329255,"discussion_content":"å°è¯•å›ç­”ä¸‹ï¼š\nRequestå’Œlimitæ˜¯ç«™åœ¨K8Sè§’åº¦ä¸Šæ‰æœ‰çš„æ¦‚å¿µï¼Œåœ¨K8Sä¸­ï¼Œå¦‚æœèŠ‚ç‚¹Açš„CPUè¢«å æ»¡ï¼Œæ–°podï¼ˆæœ¬è´¨ä¸Šæ˜¯å®¹å™¨ï¼‰æ˜¯ä¸èƒ½è°ƒåº¦åˆ°èŠ‚ç‚¹Açš„ã€‚\n\nå¦‚æœæŠ›å¼€K8Sæ¦‚å¿µï¼Œé‚£ä¹ˆä¹Ÿå°±æ²¡æœ‰Requestå’Œlimitçš„æ¦‚å¿µäº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå•çº¯çš„å®¹å™¨æ¦‚å¿µä¸­ï¼Œé€šè¿‡æ‰‹å·¥æ§åˆ¶quotaå’Œsharesï¼Œæ‰€æœ‰çš„groupéƒ½ä¸ä¼šè¶…è¿‡å®ƒè‡ªå·±è®¾ç½®çš„quotaå€¼ï¼ŒåŒæ—¶åœ¨ä¸èƒ½ä¿è¯æ‰€æœ‰çš„groupéƒ½èƒ½è·å–ä»–æƒ³è¦çš„èµ„æºï¼ˆæ¯”å¦‚è¯¾ç¨‹ä¸­æŒ‡å®šæ¶ˆè€—4CPUï¼‰æ—¶ï¼Œæ˜¯ä¼˜å…ˆæŒ‰ç…§sharesæ¥ç“œåˆ†CPUèµ„æºçš„ã€‚\n\nå›åˆ°é—®é¢˜ï¼Œâ€œå½“èŠ‚ç‚¹cpuéƒ½è¢«å æ»¡çš„æƒ…å†µä¸‹â€ï¼Œå¦‚æœåˆ›å»ºæ–°çš„å®¹å™¨ï¼Œé‚£ä¹ˆå¿…å®šä¼šæœ‰æ–°çš„cgroupï¼Œæœ‰cpu.sharesï¼Œä¼šå’Œä¹‹å‰å æ»¡cpuçš„cgroupä¸€èµ·æŒ‰æ¯”ä¾‹ä½¿ç”¨CPUèµ„æº","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1606354185,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":264263,"user_name":"è°¢å“ˆå“ˆ","can_delete":false,"product_type":"c1","uid":2326880,"ip_address":"","ucode":"5AADE70B5AFE27","user_header":"https://static001.geekbang.org/account/avatar/00/23/81/60/71ed6ac7.jpg","comment_is_top":false,"comment_ctime":1606395523,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18786264707","product_id":100063801,"comment_content":"group1:group2æ˜¯1æ¯”1ï¼Œç”±äºgroup1 limitæ˜¯3.5ï¼Œé‚£group1åˆ†åˆ°çš„åªèƒ½æ˜¯ä¸¤ä¸ªæ ¸ï¼Œå‰©ä½™çš„2ä¸ªæ ¸ç»™group3å’Œgroup4ï¼Œgroup4:group3æ˜¯3æ¯”1ï¼Œé‚£ä¹ˆå¾—å‡ºgroup4ä¸group3å„åˆ†é…çš„æ ¸å°±æ˜¯1.5æ ¸ä¸0.5æ ¸","like_count":4},{"had_liked":false,"id":270017,"user_name":"Action","can_delete":false,"product_type":"c1","uid":1239234,"ip_address":"","ucode":"FFFD1537C6BB3C","user_header":"https://static001.geekbang.org/account/avatar/00/12/e8/c2/77a413a7.jpg","comment_is_top":false,"comment_ctime":1608879707,"is_pvip":false,"replies":[{"id":"98016","content":"ä¸€ä¸ªpodåªèƒ½åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„cpuæ˜¯40ï¼Œ é‚£ä¹ˆlimit.cpuæœ€å¤§åªèƒ½æ˜¯40","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1609081274,"ip_address":"","comment_id":270017,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14493781595","product_id":100063801,"comment_content":"è€å¸ˆï¼Œå‡å¦‚æˆ‘æœ‰10ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„cpuæ ¸å¿ƒæ•°æ˜¯40ï¼Œåªæ˜¯è°ƒåº¦podï¼Œé‚£ä¹ˆlimit.cpu å¯ä»¥è®¾ç½®ä¸º400å§ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":512492,"discussion_content":"ä¸€ä¸ªpodåªèƒ½åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„cpuæ˜¯40ï¼Œ é‚£ä¹ˆlimit.cpuæœ€å¤§åªèƒ½æ˜¯40","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609081274,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":290622,"user_name":"è¨€å¸Œ","can_delete":false,"product_type":"c1","uid":1154218,"ip_address":"","ucode":"D7F80B86BCAF2E","user_header":"https://static001.geekbang.org/account/avatar/00/11/9c/aa/6f780187.jpg","comment_is_top":false,"comment_ctime":1619662106,"is_pvip":false,"replies":[{"id":"105510","content":"å¯¹çš„ï¼Œä¸é™åˆ¶ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1620199428,"ip_address":"","comment_id":290622,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10209596698","product_id":100063801,"comment_content":"è¯·é—®è€å¸ˆï¼Œæˆ‘åœ¨ç¯å¢ƒä¸Šé‡åˆ° cpu.cfs_quota_us å–å€¼ä¸º -1 çš„ï¼Œè¿™ç§æ˜¯ä¸æ˜¯ä»£è¡¨çš„ä¸é™åˆ¶CPUçš„ä½¿ç”¨ ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519247,"discussion_content":"å¯¹çš„ï¼Œä¸é™åˆ¶ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620199428,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":266352,"user_name":"è°¦å¯»","can_delete":false,"product_type":"c1","uid":1033639,"ip_address":"","ucode":"07160FAFAD08F7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c5/a7/e32dcfe7.jpg","comment_is_top":false,"comment_ctime":1607310313,"is_pvip":false,"replies":[{"id":"96764","content":"ä¸€èˆ¬å¯¹äºå®¹å™¨ï¼Œæ˜¯ä¸€ä¸ªcgroupæ§åˆ¶ç»„é‡Œé™åˆ¶å®¹å™¨ä¸­çš„æ‰€æœ‰è¿›ç¨‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1607356369,"ip_address":"","comment_id":266352,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10197244905","product_id":100063801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼Œå¦‚æœä¸€ä¸ªå®¹å™¨é‡Œé¢æœ‰å¤šä¸ªè¿›ç¨‹ï¼Œè¿™ä¸ªé™åˆ¶æ˜¯é’ˆå¯¹æ‰€æœ‰è¿›ç¨‹ï¼Œè¿˜æ˜¯åªæ˜¯pidæ˜¯1çš„è¿›ç¨‹ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511227,"discussion_content":"ä¸€èˆ¬å¯¹äºå®¹å™¨ï¼Œæ˜¯ä¸€ä¸ªcgroupæ§åˆ¶ç»„é‡Œé™åˆ¶å®¹å™¨ä¸­çš„æ‰€æœ‰è¿›ç¨‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607356369,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":264814,"user_name":"ç“œè›‹","can_delete":false,"product_type":"c1","uid":1297941,"ip_address":"","ucode":"9033348BEF5F5A","user_header":"https://static001.geekbang.org/account/avatar/00/13/ce/15/51187703.jpg","comment_is_top":false,"comment_ctime":1606659831,"is_pvip":true,"replies":[{"id":"96282","content":"ç½‘ç»œI&#47;O æ²¡æœ‰waçŠ¶æ€éƒ¨åˆ†ã€‚<br>hi&#47;si å¯¹äºç£ç›˜éƒ½æ˜¯æœ‰çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1606800842,"ip_address":"","comment_id":264814,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10196594423","product_id":100063801,"comment_content":"è¯·é—®ä¸‹å…³äºwaå’Œhi&#47;siçš„é—®é¢˜ï¼š<br>1. ä¾‹å­ä¸­ï¼Œwaæ˜¯ç­‰å¾…ç£ç›˜IOçš„çŠ¶æ€ï¼Œé‚£ç­‰å¾…ç½‘ç»œIOæ—¶ï¼Œæ˜¯ä¸æ˜¯waå‘¢ï¼Ÿ<br>2. ä¾‹å­ä¸­ï¼Œhi&#47;siæ˜¯æ”¶åˆ°ç½‘å¡ä¸­æ–­ï¼Œé‚£æ”¶åˆ°ç£ç›˜ä¸­æ–­æ—¶ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿæ˜¯hi&#47;siï¼Ÿ","like_count":3,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510691,"discussion_content":"ç½‘ç»œI/O æ²¡æœ‰waçŠ¶æ€éƒ¨åˆ†ã€‚\nhi/si å¯¹äºç£ç›˜éƒ½æ˜¯æœ‰çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606800842,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":264014,"user_name":"ä¸Šé‚ªå¿˜å·","can_delete":false,"product_type":"c1","uid":1276588,"ip_address":"","ucode":"1C4459917B038D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIz9dKN1C8rKQoaVtmEGdzObhlia6zAfTsPYOm4ibz39VjTbu7Aia1LyeedHR26b6nxUtcCufpichcYgw/132","comment_is_top":false,"comment_ctime":1606312102,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"10196246694","product_id":100063801,"comment_content":"åˆ†åˆ«ä¸º2,1.5,0.5<br>group1å’Œgroup2åˆ†é…çš„cpué…é¢å·²ç»è¶…è¿‡4ä¸ªæ€»cpuï¼Œé‚£ä¹ˆå°±ä¼šæŒ‰ç…§cpu.sharesçš„æ¯”ä¾‹å»åˆ†é…cpuã€‚å…¶ä¸­ï¼Œgroup1:group2=1:1ï¼Œgroup3:group4=1:3ï¼Œgroup2=group3+group4ï¼Œå¾—å‡ºgroup1:group3:group4=4:1:3","like_count":3,"discussions":[{"author":{"id":1036911,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/d2/6f/b7db9b07.jpg","nickname":"æˆ‘ä¸å«å°å­å¼¹ğŸ¤”","note":"","ucode":"4B0588AE6C849B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":358875,"discussion_content":"è¯·æ•™å¤§ä½¬ï¼šgroup2çš„sharesæ˜¯æ€ä¹ˆæ±‚å¾—çš„å‘€ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616069772,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2063014,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/7a/a6/e37fbbd8.jpg","nickname":"å°èƒ½","note":"","ucode":"39EAAC8443B83C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1036911,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/d2/6f/b7db9b07.jpg","nickname":"æˆ‘ä¸å«å°å­å¼¹ğŸ¤”","note":"","ucode":"4B0588AE6C849B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373796,"discussion_content":"group2çš„sharesé»˜è®¤ä¸º1024ï¼Œquotaè®¾ç½®ä¸º-1ï¼Œä¸å—é™åˆ¶ï¼Œ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1620876656,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":358875,"ip_address":""},"score":373796,"extra":""}]}]},{"had_liked":false,"id":326666,"user_name":"zero","can_delete":false,"product_type":"c1","uid":1684113,"ip_address":"","ucode":"27019747CA63FF","user_header":"https://static001.geekbang.org/account/avatar/00/19/b2/91/fbc34225.jpg","comment_is_top":false,"comment_ctime":1639624362,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5934591658","product_id":100063801,"comment_content":"è¿™èŠ‚çœŸå¿ƒä¸é”™","like_count":1},{"had_liked":false,"id":309442,"user_name":"å‚æ­»æŒ£æ‰çš„å’¸é±¼","can_delete":false,"product_type":"c1","uid":1194388,"ip_address":"","ucode":"79143A61A5599E","user_header":"","comment_is_top":false,"comment_ctime":1630136751,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5925104047","product_id":100063801,"comment_content":"è€å¸ˆï¼Œè¿™è¾¹æƒ³è¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼Œä¸¤ä¸ªå®¹å™¨a,bè¿›ç¨‹åˆ†åˆ«è®¾ç½®äº†cpusetä»¥åŠcpu.shareï¼Œå…¶ä¸­ä¸¤ä¸ªè¿›ç¨‹ç»‘å®šäº†ç›¸åŒçš„16æ ¸ï¼Œaè®¾ç½®è¾ƒå¤§çš„cpu.shareå€¼è€Œbè®¾ç½®è¾ƒå°çš„cpu.shareå€¼ï¼Œæ¯”ä¾‹ä¸º4æ¯”1ï¼ŒåŒæ—¶å°†è¿™ä¸¤ä¸ªè¿›ç¨‹å‹æµ‹åˆ°80%å·¦å³çš„cpuä½¿ç”¨ç‡ï¼Œå‘ç°ä»–ä¿©å„å ç”¨äº†8æ ¸å·¦å³çš„cpuå°±å¥½åƒcpu.shareå€¼æ²¡æœ‰ç”Ÿæ•ˆï¼Œå¯ä»¥è¯·æ•™ä¸€ä¸‹è€å¸ˆå¯èƒ½æ˜¯ä»€ä¹ˆåŸå› é€ æˆcpu.shareæ²¡æœ‰ç”Ÿæ•ˆ","like_count":1,"discussions":[{"author":{"id":1257843,"avatar":"https://static001.geekbang.org/account/avatar/00/13/31/73/4366f97d.jpg","nickname":"ç™½å°é»‘","note":"","ucode":"B83D69F765D60A","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":562849,"discussion_content":"80%è¿˜æ²¡æ»¡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649899306,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":277855,"user_name":"cyz","can_delete":false,"product_type":"c1","uid":1498145,"ip_address":"","ucode":"233B1FC28A45F1","user_header":"https://static001.geekbang.org/account/avatar/00/16/dc/21/34c72e67.jpg","comment_is_top":false,"comment_ctime":1612622685,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5907589981","product_id":100063801,"comment_content":"è¯„è®ºè§£ç­”ä¾ç„¶ç²¾å½©","like_count":1},{"had_liked":false,"id":273464,"user_name":"ä¸äºŒ","can_delete":false,"product_type":"c1","uid":1027123,"ip_address":"","ucode":"D0700609740FB5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ac/33/110437cc.jpg","comment_is_top":false,"comment_ctime":1610606163,"is_pvip":false,"replies":[{"id":"99536","content":"ä¸€äº›åµŒå…¥å¼å®æ—¶çš„ç¨‹åºéœ€è¦å®æ—¶è°ƒåº¦çš„","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1610930010,"ip_address":"","comment_id":273464,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5905573459","product_id":100063801,"comment_content":"è¯·é—®è€å¸ˆï¼Œcpu.rt_runtime_usä¸€èˆ¬æ˜¯ä¸æ˜¯ç”¨ä¸ä¸Šï¼ŒLinuxç³»ç»Ÿä¸­å“ªäº›ç¨‹åºä¼šè¢«é…ç½®ä¸ºå®æ—¶è°ƒåº¦ç¨‹åºå‘¢ï¼Ÿå¦‚æœæ²¡æœ‰å®æ—¶è°ƒåº¦ç¨‹åºè¿™ä¸ªå‚æ•°ä¹Ÿå°±æ²¡æœ‰äº†å­˜åœ¨çš„å¿…è¦å§","like_count":1,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513611,"discussion_content":"ä¸€äº›åµŒå…¥å¼å®æ—¶çš„ç¨‹åºéœ€è¦å®æ—¶è°ƒåº¦çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610930010,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":264129,"user_name":"Geek2014","can_delete":false,"product_type":"c1","uid":2028957,"ip_address":"","ucode":"9EB356D8DF287E","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f5/9d/104bb8ea.jpg","comment_is_top":false,"comment_ctime":1606359073,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5901326369","product_id":100063801,"comment_content":"å°è¯•èƒ¡ä¹±åˆ†æä¸‹ï¼š<br>group1 çš„sharesä¸º1024ï¼Œquota 3.5ï¼Œå°è¯•ä½¿ç”¨4ï¼Œ<br>group2çš„sharesé»˜è®¤ä¸º1024ï¼Œquotaè®¾ç½®ä¸º-1ï¼Œä¸å—é™åˆ¶ï¼Œä¹Ÿå³æ˜¯ï¼Œå¦‚æœCPUä¸Šåªæœ‰group2çš„è¯ï¼Œé‚£ä¹ˆgroup2å¯ä»¥ä½¿ç”¨å®Œæ‰€æœ‰çš„CPUï¼ˆå®é™…ä¸Šæ ¹æ®group3å’Œgroup4ï¼Œgroup2æœ€å¤šä¹Ÿå°±èƒ½ç”¨åˆ°1.5+3.5 coreï¼‰<br><br>æ•…è€Œï¼Œgroup1å’Œgroup2å„åˆ†é…åˆ°2<br><br>æŠŠgroup2åˆ†åˆ°çš„2CPUï¼Œçœ‹ä½œæ€»é‡ï¼Œå†æ¬¡åˆ†ægroup3å’Œgroup4<br>group3å’Œgroup3å°è¯•ä½¿ç”¨çš„æ€»é‡è¶…è¿‡2ï¼Œæ‰€ä»¥æŒ‰ç…§sharesæ¯”ä¾‹åˆ†é…ï¼Œgroup3ä½¿ç”¨1&#47;(1+3) * 2 = 0.5ï¼Œgroup4ä½¿ç”¨3&#47;(1+3) * 2 = 1.5","like_count":1},{"had_liked":false,"id":354931,"user_name":"äº‹å·²è‡³æ­¤å¼€å§‹æ’¤é€€","can_delete":false,"product_type":"c1","uid":2901316,"ip_address":"å¹¿ä¸œ","ucode":"1076FDF53DA81D","user_header":"https://static001.geekbang.org/account/avatar/00/2c/45/44/8df79d3c.jpg","comment_is_top":false,"comment_ctime":1660890777,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1660890777","product_id":100063801,"comment_content":"æ„Ÿè§‰ä¸Šé¢è®²çš„å’Œä¸‹é¢çš„æ²¡æœ‰å•¥è”ç³»å‘€ï¼Œç›´æ¥çœ‹ä¸‹é¢çš„ä¹Ÿå¯ä»¥è®¾ç½®å¥½CPUçš„cgroupï¼Œå³ä½¿å®Œæ•´çœ‹å®Œäº†ä¸Šé¢ï¼Œä¹Ÿå’Œå®ƒå®ç°çš„åº•å±‚é€»è¾‘æ²¡æœ‰ä»€ä¹ˆå…³è”ï¼Œè€å¸ˆå¯èƒ½ç¡®å®è‡ªå·±æ‡‚å¾ˆå¤šï¼Œä½†æ˜¯æ²¡æœ‰å¾ˆå¥½çš„å±•ç°å‡ºæ¥","like_count":0},{"had_liked":false,"id":340707,"user_name":"å†Œä¹¦ä¸€å¹•","can_delete":false,"product_type":"c1","uid":1281389,"ip_address":"","ucode":"75FA281B772DF6","user_header":"https://static001.geekbang.org/account/avatar/00/13/8d/6d/8c0a487b.jpg","comment_is_top":false,"comment_ctime":1649064368,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1649064368","product_id":100063801,"comment_content":"requeståªæœ‰æ»¡çš„æ—¶å€™æ‰æœ‰ç”¨ï¼Œæ˜¯å¦æ„å‘³ç€CPUä¸æ»¡çš„æ—¶å€™ï¼Œrequestå¯ä»¥ä»»æ„å®šä¹‰ï¼Œå®¹å™¨éƒ½èƒ½ä½¿ç”¨åˆ°è¶…å‡ºrequestå®šä¹‰çš„éƒ¨åˆ†","like_count":0},{"had_liked":false,"id":340706,"user_name":"å†Œä¹¦ä¸€å¹•","can_delete":false,"product_type":"c1","uid":1281389,"ip_address":"","ucode":"75FA281B772DF6","user_header":"https://static001.geekbang.org/account/avatar/00/13/8d/6d/8c0a487b.jpg","comment_is_top":false,"comment_ctime":1649064241,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1649064241","product_id":100063801,"comment_content":"è¿™ä¸€èŠ‚æœ‰äº›æ²¡æ³•ç†è§£ï¼šrequestæ˜¯shareæ§åˆ¶çš„ï¼Œlimitæ˜¯quotaå’Œperiodæ¯”ç‡æ¥æ§åˆ¶ã€‚å“ªrequestæ˜¯ä¸æ˜¯å¾—è¦CPUæ»¡çš„æ—¶å€™æ‰èƒ½ç”Ÿæ•ˆï¼Œä¿è¯å®¹å™¨CPUå§‹ç»ˆå ç”¨sharesæ¯”ç‡çš„é‡ã€‚é‚£è¿™ä¸ªlimitå­˜åœ¨çš„å¿…è¦æ€§æ˜¯ä»€ä¹ˆï¼Ÿå¯ä»¥ç†è§£æˆæ§åˆ¶å®¹å™¨ä¸èƒ½å ç”¨å®Œcpuæ‰€æœ‰æ—¶é—´ç‰‡å’Œperiodå‘¨æœŸå†…å¯ç”¨çš„æ—¶é—´ç‰‡é•¿åº¦å—ï¼Ÿ    CPUçš„æ§åˆ¶ä¼¼ä¹è·Ÿå†…å­˜æœ‰ç€å¾ˆå¤§åŒºåˆ«","like_count":0},{"had_liked":false,"id":339512,"user_name":"*","can_delete":false,"product_type":"c1","uid":2901446,"ip_address":"","ucode":"575AECA891950A","user_header":"https://static001.geekbang.org/account/avatar/00/2c/45/c6/28dfdbc9.jpg","comment_is_top":false,"comment_ctime":1648164769,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1648164769","product_id":100063801,"comment_content":"è€å¸ˆï¼ŒcgroupæŒ‚è½½æ‰äº†å¯ä»¥é‡æ–°æŒ‚è½½å—","like_count":0},{"had_liked":false,"id":336094,"user_name":"*","can_delete":false,"product_type":"c1","uid":2901446,"ip_address":"","ucode":"575AECA891950A","user_header":"https://static001.geekbang.org/account/avatar/00/2c/45/c6/28dfdbc9.jpg","comment_is_top":false,"comment_ctime":1645920559,"is_pvip":false,"replies":[{"id":"123842","content":"æ–‡ç¨¿é‡Œæœ‰é“¾æ¥çš„ã€‚<br>https:&#47;&#47;github.com&#47;chengyli&#47;training&#47;tree&#47;main&#47;cpu&#47;cgroup_cpu","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2070138","ctime":1647785513,"ip_address":"","comment_id":336094,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1645920559","product_id":100063801,"comment_content":"è€å¸ˆï¼Œ threads-cpuè¿™ä¸ªè„šæœ¬èƒ½æä¾›å—","like_count":0,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557393,"discussion_content":"æ–‡ç¨¿é‡Œæœ‰é“¾æ¥çš„ã€‚\nhttps://github.com/chengyli/training/tree/main/cpu/cgroup_cpu","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647785513,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1290469,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Um0fKCDsGBRStZBF1M4HLPSq8jiancnNoYKiaYyYldFX0NObkyUFmnVKTgjm6Y7wUiaCQ3Vm9Ic213l65kJfUzq4w/132","nickname":"Geek_c92584","note":"","ucode":"D9DA02DA718977","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556232,"discussion_content":"ç”¨stressåº”è¯¥å¯ä»¥ä»£æ›¿çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647256959,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332347,"user_name":"jiangb","can_delete":false,"product_type":"c1","uid":1030861,"ip_address":"","ucode":"A09415749CA88D","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJrqLEic7DVicYY1s9ldH0vGBialDoplVGpicZUJ0Fdaklw27Frv8Ac67eicb5LibhL74SUxAzlick2nfltA/132","comment_is_top":false,"comment_ctime":1643184374,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1643184374","product_id":100063801,"comment_content":"è€å¸ˆè®²çš„éå¸¸æ¸…æ¥šï¼Œæ˜ç™½äº†Topä¸­CPUå€¼çš„å«ä¹‰äº†ã€‚","like_count":0},{"had_liked":false,"id":330114,"user_name":"bearlu","can_delete":false,"product_type":"c1","uid":1030862,"ip_address":"","ucode":"14F260C8B24E27","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ba/ce/fd45714f.jpg","comment_is_top":false,"comment_ctime":1641801967,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1641801967","product_id":100063801,"comment_content":"è€å¸ˆï¼Œæœ‰ä¸ªé—®é¢˜æƒ³è¯·æ•™ï¼Œcpu.sharesä¸æ˜¯ä¸€ä¸ªæ¯”ä¾‹ï¼Ÿï¼Œæˆ‘è®¾ç½®äº†1å°±æ˜¯ä¸€ä¸ªcpuï¼Œä½†æ˜¯åœ¨è¿™é‡Œ shares æ¯”ä¾‹æ˜¯ group4:group3=3:1ï¼Œåœ¨æ€»å…± 2 ä¸ª CPU çš„èŠ‚ç‚¹ä¸Šï¼ŒæŒ‰ç…§æ¯”ä¾‹ï¼Œgroup4 é‡Œçš„è¿›ç¨‹åº”è¯¥åˆ†é…åˆ° 0.5 ä¸ª CPUï¼Œè€Œ group3 é‡Œçš„è¿›ç¨‹ä¼šåˆ†é…åˆ° 1.5 ä¸ª CPUã€‚é‚£æ ·group4ä¹Ÿä¸æ˜¯1ä¸ªCPUã€‚ä¸ä½ è¯´çš„ï¼Œåœ¨ CPU Cgroup ä¸­ cpu.shares == 1024 è¡¨ç¤º 1 ä¸ª CPU çš„æ¯”ä¾‹ï¼Œé‚£ä¹ˆ Request CPU çš„å€¼å°±æ˜¯ nï¼Œç»™ cpu.shares çš„èµ‹å€¼å¯¹åº”å°±æ˜¯ n*1024ä¸ç¬¦åˆã€‚èƒ½è§£ç­”ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼Ÿ","like_count":0},{"had_liked":false,"id":320684,"user_name":"å­¦ç”Ÿç›‘ç‹±","can_delete":false,"product_type":"c1","uid":1007240,"ip_address":"","ucode":"CA9510F6211FCF","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/AkcVibvqux0qrKFbV7skQvQfHsl96tu9HTSaromQyzf7OOSacoorSDreBNbwOdlBeOrKr3Alc1zle66wKkibrL5g/132","comment_is_top":false,"comment_ctime":1636449611,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1636449611","product_id":100063801,"comment_content":" Limit CPU å°±æ˜¯å®¹å™¨æ‰€åœ¨ Cgroup æ§åˆ¶ç»„ä¸­çš„ CPU ä¸Šé™å€¼ï¼ŒRequest CPU çš„å€¼å°±æ˜¯æ§åˆ¶ç»„ä¸­çš„ cpu.shares çš„å€¼.<br>åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å…¬å¸çš„ç”µå•†ä¸šåŠ¡ï¼ŒæŠ€æœ¯æ ˆæ˜¯Java+Dubboè¿™å¥—ï¼Œåº”ç”¨æ›´å¤šçš„æ˜¯åƒå†…å­˜ã€‚ç›®å‰è®¾ç½®åˆ†é…æ¯”å€¼å¤šå°‘æ˜¯æœ€ä½³å®è·µï¼Ÿ<br>Allocated resources:<br>  (Total limits may be over 100 percent, i.e., overcommitted.)<br>  Resource           Requests       Limits<br>  --------           --------       ------<br>  cpu                9750m (83%)    18700m (159%)<br>  memory             30352Mi (34%)  39344Mi (45%)<br>  ephemeral-storage  0 (0%)         0 (0%)<br><br>æˆ‘ä»¬çš„limitsç›®å‰è¾¾åˆ°äº†159%è¿™ä¸ªæ˜¯ä¸€ä¸ªåˆç†çš„å€¼å—ï¼Ÿè¿˜æ˜¯è¯´å¤ªå¤§äº†","like_count":0},{"had_liked":false,"id":309662,"user_name":"Geek_ce0af4","can_delete":false,"product_type":"c1","uid":1744601,"ip_address":"","ucode":"DE36ED16AD8101","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLvkQrAkQv9ibJ4XarXAkia2SLvavwxWYZH1GnrcibSY0AtBDeBVxh2Cw51WlyCwwr7icOCyPsj5u0pdg/132","comment_is_top":false,"comment_ctime":1630294096,"is_pvip":false,"replies":[{"id":"124479","content":"åé¢é«˜èƒ½æ›´å¤šï½åŠ æ²¹","user_name":"ç¼–è¾‘å›å¤","user_name_real":"ç¼–è¾‘","uid":"1501385","ctime":1648814194,"ip_address":"","comment_id":309662,"utype":2}],"discussion_count":1,"race_medal":0,"score":"1630294096","product_id":100063801,"comment_content":"è¯„è®ºåŒºå¤ªç²¾å½©","like_count":0,"discussions":[{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"å¬æ°´çš„æ¹–","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559552,"discussion_content":"åé¢é«˜èƒ½æ›´å¤šï½åŠ æ²¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648814195,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":8}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":303633,"user_name":"é©¬æˆ","can_delete":false,"product_type":"c1","uid":1486895,"ip_address":"","ucode":"664F2BAA2E0F0B","user_header":"https://static001.geekbang.org/account/avatar/00/16/b0/2f/e2096905.jpg","comment_is_top":false,"comment_ctime":1626895186,"is_pvip":true,"replies":[{"id":"111068","content":"softirq æŒ‡ bottom half of interrupt, æ˜¯ä¸­æ–­å¤„ç†çš„ä¸€éƒ¨åˆ†ï¼Œ å’Œç³»ç»Ÿè°ƒç”¨æ˜¯ä¸¤ä¸ªæ¦‚å¿µã€‚<br>å¯ä»¥æ‰¾ä¸€æœ¬Linux kernelçš„ä¹¦ç±çœ‹ä¸€ä¸‹ï¼Œæ¯”å¦‚Linux kernel development.<br>","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1628689002,"ip_address":"","comment_id":303633,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1626895186","product_id":100063801,"comment_content":"è½¯ä¸­æ–­æˆ‘ç†è§£å°±æ˜¯å†…éƒ¨ä¸­æ–­ï¼Œç³»ç»Ÿè°ƒç”¨æ˜¯å…¶ä¸­çš„ä¸€ç§ã€‚é‚£ä¹ˆsyå†…æ ¸æ—¶é—´æŒ‡çš„æ˜¯ç³»ç»Ÿè°ƒç”¨æ—¶é—´ä¹ˆï¼Ÿsiè½¯ä¸­æ–­æ—¶é—´åŒ…å«ç³»ç»Ÿè°ƒç”¨æ—¶é—´ä¹ˆï¼Ÿæˆ‘è¢«æç³Šæ¶‚äº†â€¦â€¦","like_count":0,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523768,"discussion_content":"softirq æŒ‡ bottom half of interrupt, æ˜¯ä¸­æ–­å¤„ç†çš„ä¸€éƒ¨åˆ†ï¼Œ å’Œç³»ç»Ÿè°ƒç”¨æ˜¯ä¸¤ä¸ªæ¦‚å¿µã€‚\nå¯ä»¥æ‰¾ä¸€æœ¬Linux kernelçš„ä¹¦ç±çœ‹ä¸€ä¸‹ï¼Œæ¯”å¦‚Linux kernel development.\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628689002,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1129668,"avatar":"https://static001.geekbang.org/account/avatar/00/11/3c/c4/7c2bf312.jpg","nickname":"è‰æ ¹","note":"","ucode":"7C97CB09A4D8F1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545802,"discussion_content":"ç³»ç»Ÿè°ƒç”¨é€šè¿‡ä¸­æ–­çš„æ–¹å¼åˆ‡æ¢åˆ°å†…æ ¸æ‰§è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642054089,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":303069,"user_name":"bearlu","can_delete":false,"product_type":"c1","uid":1030862,"ip_address":"","ucode":"14F260C8B24E27","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ba/ce/fd45714f.jpg","comment_is_top":false,"comment_ctime":1626577977,"is_pvip":true,"replies":[{"id":"111124","content":"wa (iowait)çš„cpu, è¡¨ç¤ºå½“å‰cpu å¤„äºç©ºé—²çŠ¶æ€ï¼ˆå¹¶æ²¡æœ‰å ç”¨cpuï¼‰åŒæ—¶è¿™æ—¶å€™æœ‰io requestè¿˜æ²¡æœ‰ç»“æŸã€‚<br><br>","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1628757943,"ip_address":"","comment_id":303069,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1626577977","product_id":100063801,"comment_content":"è€å¸ˆï¼Œæˆ‘æœ‰ä¸ªå›°æƒ‘ï¼Œåœ¨readçš„æ—¶å€™ï¼Œå½“è¿›ç¨‹åœ¨waçŠ¶æ€ï¼Œæ˜¯ä¸æ˜¯å ç”¨ç€CPUï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523543,"discussion_content":"wa (iowait)çš„cpu, è¡¨ç¤ºå½“å‰cpu å¤„äºç©ºé—²çŠ¶æ€ï¼ˆå¹¶æ²¡æœ‰å ç”¨cpuï¼‰åŒæ—¶è¿™æ—¶å€™æœ‰io requestè¿˜æ²¡æœ‰ç»“æŸã€‚\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628757943,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1129668,"avatar":"https://static001.geekbang.org/account/avatar/00/11/3c/c4/7c2bf312.jpg","nickname":"è‰æ ¹","note":"","ucode":"7C97CB09A4D8F1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545803,"discussion_content":"è¿™ä¸ªæ—¶å€™è¿™ä¸ªè¿›ç¨‹æ˜¯ä¸èƒ½è¢«ä¸­æ–­çš„ï¼Œè¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€åŒ…æ‹¬æ­£åœ¨è¿è¡Œå’Œä¸å¯ä¸­æ–­çŠ¶æ€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642054186,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":300246,"user_name":"Geek_è‹æ™—2","can_delete":false,"product_type":"c1","uid":2289589,"ip_address":"","ucode":"13B4983CF442AF","user_header":"","comment_is_top":false,"comment_ctime":1625062365,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1625062365","product_id":100063801,"comment_content":"echo 3072 &gt; &#47;sys&#47;fs&#47;cgroup&#47;cpu&#47;group2&#47;group3&#47;cpu.shares<br><br>è¿™ä¸ªåœ°æ–¹åº”è¯¥æ˜¯group4å§ã€‚","like_count":0,"discussions":[{"author":{"id":1059593,"avatar":"https://static001.geekbang.org/account/avatar/00/10/2b/09/2171f9a3.jpg","nickname":"å°ç™½å“¥å“¥","note":"","ucode":"A02A297C7688A4","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384980,"discussion_content":"æ˜¯çš„ï¼Œç¬”è¯¯äº†è¿™é‡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626838099,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":297567,"user_name":"å¼ºå­","can_delete":false,"product_type":"c1","uid":1752558,"ip_address":"","ucode":"AEC3CF413AADA6","user_header":"https://static001.geekbang.org/account/avatar/00/1a/bd/ee/89f20aaa.jpg","comment_is_top":false,"comment_ctime":1623639283,"is_pvip":false,"replies":[{"id":"111201","content":"å¯¹çš„ï¼Œåœ¨kube-scheduleré‡Œæ¥ä¿è¯request cpu, è€Œcpu.shareæ˜¯åœ¨cgroupè¿™ä¸€å±‚é¢çš„äº†ï¼Œåªæœ‰é€šè¿‡äº†kube-scheduleræ‰ä¼šé…ç½®åˆ° cgroup cpu.share.","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1628857787,"ip_address":"","comment_id":297567,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1623639283","product_id":100063801,"comment_content":"è€å¸ˆ å…³äºrequest cpuè¿˜æ˜¯ä¸å¤ªç†è§£ requestæ˜¯å¿…é¡»æ»¡è¶³çš„ ä½†æ˜¯é€šè¿‡cpu.shareæ— æ³•ä¿è¯ é‚£k8sæ˜¯å¦‚ä½•ä¿è¯çš„ï¼Ÿæ˜¯scheduleråœ¨è°ƒåº¦çš„æ—¶å€™è‡ªå·±è®¡ç®—çš„å— åŒ…æ‹¬å…è®¸è¶…å”®çš„æƒ…å†µï¼Œèƒ½å¦è§£é‡Šä¸€ä¸‹ æ„Ÿè°¢ğŸ™","like_count":0,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521858,"discussion_content":"å¯¹çš„ï¼Œåœ¨kube-scheduleré‡Œæ¥ä¿è¯request cpu, è€Œcpu.shareæ˜¯åœ¨cgroupè¿™ä¸€å±‚é¢çš„äº†ï¼Œåªæœ‰é€šè¿‡äº†kube-scheduleræ‰ä¼šé…ç½®åˆ° cgroup cpu.share.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628857787,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":272820,"user_name":"Joe Black","can_delete":false,"product_type":"c1","uid":1052528,"ip_address":"","ucode":"21FE222A286445","user_header":"https://static001.geekbang.org/account/avatar/00/10/0f/70/c8680841.jpg","comment_is_top":false,"comment_ctime":1610317484,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1610317484","product_id":100063801,"comment_content":"è€å¸ˆï¼Œå¯¹äºnfsè¿™æ ·çš„ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒåœ¨ioçš„æ—¶å€™cpuçš„ä½¿ç”¨ç®—ä»€ä¹ˆå‘¢ï¼Ÿè¿™ä¸ªå’Œç£ç›˜è¯»å†™è¿˜ä¸ä¸€æ ·å•Šï¼Œæ•°æ®éƒ½åœ¨è¿œç¨‹ï¼Œå®é™…èŠ±çš„æ˜¯ç½‘ç»œæ—¶é—´å§ï¼Ÿ","like_count":0},{"had_liked":false,"id":269852,"user_name":"ç»§ä¸š(Adrian)","can_delete":false,"product_type":"c1","uid":1021147,"ip_address":"","ucode":"D9BAF5F939A2B6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/94/db/4e658ce8.jpg","comment_is_top":false,"comment_ctime":1608810806,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1608810806","product_id":100063801,"comment_content":"CPUçš„ä½¿ç”¨ç‡åœ¨linuxé‡Œé¢æ˜¯æ ‘çŠ¶ç»“æ„ï¼ŒCPUçš„shareæ˜¯é’ˆå¯¹åŒç­‰æ·±åº¦æ¥åšåŒºåˆ†ã€‚ç”±äºä¸‰ä¸ªshellå‘½ä»¤éƒ½ä¼šæŠŠCPUå æ»¡ã€‚æ‰€ä»¥æœ€åCPUçš„åˆ†é…æ¯”ä¾‹æ˜¯ï¼šgroup1ï¼š4ï¼Œ group3ï¼š1ï¼Œ group4ï¼š3","like_count":0},{"had_liked":false,"id":266400,"user_name":"feihui","can_delete":false,"product_type":"c1","uid":1007294,"ip_address":"","ucode":"13F1D4A82BC650","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5e/be/9ea55f46.jpg","comment_is_top":false,"comment_ctime":1607324624,"is_pvip":true,"replies":[{"id":"96761","content":"æ˜¯çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªè°ƒåº¦æ—¶é—´çš„åˆ†é…ï¼Œè€Œä¸æ˜¯æŠŠç‰©ç†cpu åˆ†é…ç»™å®¹å™¨çš„è¿›ç¨‹ã€‚<br>å¯¹äºä½ è¯´çš„è¿™ç§æƒ…å†µï¼Œå°±æ˜¯ä¸é™åˆ¶cpuçš„ä½¿ç”¨æ—¶é—´äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1607355498,"ip_address":"","comment_id":266400,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1607324624","product_id":100063801,"comment_content":"æœ‰ä¸ªç–‘é—®ï¼šå‡è®¾ç»™å®¹å™¨é…ç½®äº† 1.5 çš„ CPUï¼Œè€Œå®¿ä¸»æœºä¸Šåªæœ‰ 1 ä¸ª CPUï¼Œå…¶å®ç°åœ¨æ¥è¯´é…ç½®å¤šå°‘ä¸ª CPU åº”è¯¥æŒ‡çš„ä½¿ç”¨å¤šå°‘çš„ CPU çš„æ—¶é—´å¯¹å—ï¼Ÿï¼ˆ è€Œéç®€å•åœ°åˆ†é…ç‰©ç† CPU ï¼‰","like_count":0,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511248,"discussion_content":"æ˜¯çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªè°ƒåº¦æ—¶é—´çš„åˆ†é…ï¼Œè€Œä¸æ˜¯æŠŠç‰©ç†cpu åˆ†é…ç»™å®¹å™¨çš„è¿›ç¨‹ã€‚\nå¯¹äºä½ è¯´çš„è¿™ç§æƒ…å†µï¼Œå°±æ˜¯ä¸é™åˆ¶cpuçš„ä½¿ç”¨æ—¶é—´äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607355498,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":264720,"user_name":"äº‰å…‰ Alan","can_delete":false,"product_type":"c1","uid":1336328,"ip_address":"","ucode":"338534F909AF03","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/08/0287f41f.jpg","comment_is_top":false,"comment_ctime":1606614929,"is_pvip":false,"replies":[{"id":"96013","content":"å“¦ï¼Œ åœ¨è¿™é‡Œçš„â€œç¨‹åºâ€ï¼Œ æˆ‘æŒ‡çš„æ˜¯ .&#47;threads-cpu&#47;threads-cpu","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1606642466,"ip_address":"","comment_id":264720,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1606614929","product_id":100063801,"comment_content":"å¥½ï¼Œä¸‹é¢æˆ‘ä»¬å†æ¥è¿è¡Œç¬¬äºŒä¸ªä¾‹å­æ¥ç†è§£ cpu.sharesã€‚æˆ‘ä»¬å…ˆæŠŠç¬¬ä¸€ä¸ªä¾‹å­é‡Œçš„ç¨‹åºå¯åŠ¨ï¼ŒåŒæ—¶æŒ‰å‰é¢çš„å†…å®¹ï¼Œä¸€æ­¥æ­¥è®¾ç½®å¥½ group3 é‡Œ cpu.cfs_quota_us å’Œ cpu.sharesã€‚<br><br>æ˜¯ä¸æ˜¯å†™é”™äº†ï¼Œ<br>ç¬¬ä¸€ä¸ªä¾‹å­çš„ç¨‹åºåœæ­¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510660,"discussion_content":"å“¦ï¼Œ åœ¨è¿™é‡Œçš„â€œç¨‹åºâ€ï¼Œ æˆ‘æŒ‡çš„æ˜¯ ./threads-cpu/threads-cpu","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606642466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":263953,"user_name":"max","can_delete":false,"product_type":"c1","uid":1003294,"ip_address":"","ucode":"9347A158EC04FA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4f/1e/9e69527e.jpg","comment_is_top":false,"comment_ctime":1606303212,"is_pvip":false,"replies":[{"id":"95820","content":"@max, ä½ é—®çš„æ˜¯å¦‚ä½•åˆ†é…åˆ°ç½‘ç»œå¸¦å®½ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1606400416,"ip_address":"","comment_id":263953,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1606303212","product_id":100063801,"comment_content":"è€å¸ˆï¼Œå®¹å™¨ä¸­çš„åº”ç”¨å¦‚ä½•è·å–æœ‰æ•ˆç½‘å¡","like_count":0,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510362,"discussion_content":"@max, ä½ é—®çš„æ˜¯å¦‚ä½•åˆ†é…åˆ°ç½‘ç»œå¸¦å®½ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606400416,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":263918,"user_name":"Geek2014","can_delete":false,"product_type":"c1","uid":2028957,"ip_address":"","ucode":"9EB356D8DF287E","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f5/9d/104bb8ea.jpg","comment_is_top":false,"comment_ctime":1606294216,"is_pvip":false,"replies":[{"id":"95714","content":"æ˜¯çš„ï¼Œä¸Šé¢çš„æƒ…å†µä¸å­˜åœ¨ã€‚<br>å‡å¦‚ç¬¬ä¸€ä¸ªpod (group1)å·²ç»è¢«è°ƒåº¦ä¸Šäº†ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªpod(group2)æ˜¯è°ƒåº¦ä¸åˆ°åŒä¸€ä¸ªnodeä¸Šçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1606307197,"ip_address":"","comment_id":263918,"utype":1}],"discussion_count":4,"race_medal":0,"score":"1606294216","product_id":100063801,"comment_content":"æœ‰ä¸€ç‚¹ä¸ç†è§£ï¼Œæƒ³è¯·æ•™ä¸‹è€å¸ˆï¼š<br>è€Œ&quot;Request CPU&quot;å°±æ˜¯æ— è®ºå…¶ä»–å®¹å™¨ç”³è¯·å¤šå°‘ CPU èµ„æºï¼Œå³ä½¿è¿è¡Œæ—¶æ•´ä¸ªèŠ‚ç‚¹çš„ CPU éƒ½è¢«å æ»¡çš„æƒ…å†µä¸‹ï¼Œæˆ‘çš„è¿™ä¸ªå®¹å™¨è¿˜æ˜¯å¯ä»¥ä¿è¯è·å¾—éœ€è¦çš„ CPU æ•°ç›®ï¼Œ<br><br><br>å‡è®¾ç³»ç»Ÿåªæœ‰2ä¸ªgroupå¹¶åˆ—ï¼Œgroup1å’Œgroup2ï¼Œç³»ç»Ÿæ€»å…±2CPU<br>group1 ï¼šrequest 2 cpuï¼Œlimit 3 cpu<br>group2 ï¼šrequest 2 cpuï¼Œlimit 3 cpu<br><br>ç”±äºç”³è¯·æ€»é‡å¤§äºæ€»é‡ï¼Œé‚£ä¹ˆæŒ‰ç…§K8Sçš„è°ƒåº¦åŸåˆ™ï¼Œæ˜¯æ²¡æ³•å¯åŠ¨å…¨éƒ¨å®¹å™¨çš„ã€‚ä¸Šé¢çš„å‡è®¾æƒ…å†µï¼ŒæŒ‰é“ç†æ˜¯ä¸å­˜åœ¨çš„ï¼Œå¯¹å§ã€‚","like_count":0,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510349,"discussion_content":"æ˜¯çš„ï¼Œä¸Šé¢çš„æƒ…å†µä¸å­˜åœ¨ã€‚\nå‡å¦‚ç¬¬ä¸€ä¸ªpod (group1)å·²ç»è¢«è°ƒåº¦ä¸Šäº†ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªpod(group2)æ˜¯è°ƒåº¦ä¸åˆ°åŒä¸€ä¸ªnodeä¸Šçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606307197,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2028957,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/f5/9d/104bb8ea.jpg","nickname":"Geek2014","note":"","ucode":"9EB356D8DF287E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":329280,"discussion_content":"è€å¸ˆçš„å‡è®¾å‰ææ˜¯ï¼šç³»ç»Ÿåªæœ‰å¤šä¸ªnode\n\nå‡è®¾æ¯ä¸ªnodeä¸Š2CPUï¼Œæ¯”å¦‚Aå’ŒBï¼Œå¦‚æœpod(group1)å·²ç»è°ƒåº¦åˆ°Aä¸Šï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªpod(group2)åªèƒ½è°ƒåº¦åˆ°Bä¸Šï¼ˆå¦‚æœBæ˜¯ç©ºé—²çš„è¯ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606359342,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1986969,"avatar":"","nickname":"å­Ÿä»¤æ³½","note":"","ucode":"F324FB4538A6E1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":329247,"discussion_content":"è¿˜æ˜¯æœ‰ç‚¹æ²¡æ˜ç™½ï¼Œç³»ç»Ÿæœ‰2ä¸ªï¼Œg1å·²ç»è¢«è°ƒåº¦å ç”¨äº†ï¼Œé‚£g2ä¸åº”è¯¥è¢«è°ƒåº¦å•Šï¼Œä¸æ˜¯å¾ˆæ˜ç™½è€å¸ˆè¯´çš„ä¸åœ¨åŒä¸€ä¸ªnodeæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿæ˜¯è¯´ä¾ç„¶ä¼šè¢«è°ƒåº¦ï¼Œåªæ˜¯ä¸åœ¨åŒä¸€ä¸ªnodeï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606353006,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2028957,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/f5/9d/104bb8ea.jpg","nickname":"Geek2014","note":"","ucode":"9EB356D8DF287E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1986969,"avatar":"","nickname":"å­Ÿä»¤æ³½","note":"","ucode":"F324FB4538A6E1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":329518,"discussion_content":"nodeï¼Œæ˜¯k8sä¸­çš„æŠ½è±¡æ¦‚å¿µï¼Œå³ç‰©ç†æœºå™¨\n\nä½ è¯´çš„g1å’Œg2ï¼Œåœ¨k8så…„æŠ½è±¡ä¸ºpodï¼ˆå®¹å™¨ï¼‰\n\ng1æ˜¯è¢«è°ƒåº¦åˆ°èŠ‚ç‚¹1ï¼Œå¦å¤–ä¸€ä¸ªèŠ‚ç‚¹è¿˜æ˜¯ç©ºé—²çš„ï¼Œå½“ç„¶å¯ä»¥è°ƒåº¦g2","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606396936,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":329247,"ip_address":""},"score":329518,"extra":""}]}]},{"had_liked":false,"id":263896,"user_name":"ç‹å°é£","can_delete":false,"product_type":"c1","uid":1275284,"ip_address":"","ucode":"D93B4C654526F2","user_header":"https://static001.geekbang.org/account/avatar/00/13/75/94/e785c2c8.jpg","comment_is_top":false,"comment_ctime":1606289735,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606289735","product_id":100063801,"comment_content":"å­¦åˆ°äº†ã€‚","like_count":0}]}