{"id":174558,"title":"18 | 设计模式集锦","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-mongodb-course\">https://gitee.com/geektime-geekbang/geektime-mongodb-course</a></p>","comments":[{"had_liked":false,"id":159033,"user_name":"许凯","can_delete":false,"product_type":"c3","uid":1604645,"ip_address":"","ucode":"4F11AD41CB0244","user_header":"https://static001.geekbang.org/account/avatar/00/18/7c/25/70134099.jpg","comment_is_top":false,"comment_ctime":1575517924,"is_pvip":false,"replies":[{"id":60889,"content":"我会在全部课程更新完后根据反馈适当补充。模式设计这边可以考虑增加些内容","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1575594027,"ip_address":"","comment_id":159033,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"模式设计老师能不能再多补充一些","like_count":11,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476923,"discussion_content":"我会在全部课程更新完后根据反馈适当补充。模式设计这边可以考虑增加些内容","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575594027,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1043702,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ec/f6/3bb40677.jpg","nickname":"szy0syz","note":"","ucode":"720F05ACB6DE69","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":75742,"discussion_content":"如果可以多加设计模式，我也希望多加点✌","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575773855,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":159475,"user_name":"夜空中最亮的星","can_delete":false,"product_type":"c3","uid":1267566,"ip_address":"","ucode":"ADC3E7B6789955","user_header":"https://static001.geekbang.org/account/avatar/00/13/57/6e/b6795c44.jpg","comment_is_top":false,"comment_ctime":1575633342,"is_pvip":false,"replies":[{"id":60996,"content":"太棒了！","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1575734234,"ip_address":"","comment_id":159475,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"越来越喜欢mongo了","like_count":4,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477072,"discussion_content":"太棒了！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575734234,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":159897,"user_name":"乘坐Tornado的线程魔法师","can_delete":false,"product_type":"c3","uid":1132661,"ip_address":"","ucode":"C4C9915866E769","user_header":"https://static001.geekbang.org/account/avatar/00/11/48/75/02b4366a.jpg","comment_is_top":false,"comment_ctime":1575820612,"is_pvip":false,"replies":[{"id":61197,"content":"通常这种就是典型的维度数据设计，在分析库里常用。如果你的数据分析类型没有达到数十数百，只是针对少数几个数据类型，那么可以采用这种方式，在文档里通过一个月统计数组，周统计数组，每个数组元素增加mongo_num字段的方式来做。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1575944066,"ip_address":"","comment_id":159897,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师，请问下预聚合场景下，提前设计好需要统计的字段这一部分我听懂了。但是针对于统计日销量、周销量和月销量，每一个文档是否需要时间戳，文档具体该如何划分，来配合业务逻辑，保证可以精准切分时间段，从而支持查询。比如说查询的时候经常是分为月份来查。那么是不是每个文档中还需要month_num这个字段。按照周来查，就是需要week_num这个字段？","like_count":3,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477203,"discussion_content":"通常这种就是典型的维度数据设计，在分析库里常用。如果你的数据分析类型没有达到数十数百，只是针对少数几个数据类型，那么可以采用这种方式，在文档里通过一个月统计数组，周统计数组，每个数组元素增加mongo_num字段的方式来做。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575944066,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1076081,"avatar":"https://static001.geekbang.org/account/avatar/00/10/6b/71/e833b14a.jpg","nickname":"李英权","note":"","ucode":"FECAC14A9C414B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":77843,"discussion_content":"文档顶层不需要时间戳属性，即便有也不需要去看它。只需要在更新顶层销量字段时 顺便查一下月销量数组 如果数组里面已经有当前月统计 就更新该月统计，如还没有 就插入","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1575946722,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":159349,"user_name":"长期规划","can_delete":false,"product_type":"c3","uid":1019332,"ip_address":"","ucode":"5EF65E9115834B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","comment_is_top":false,"comment_ctime":1575603232,"is_pvip":false,"replies":[{"id":67865,"content":"MongoDB用的是B+树。\n\nhttp:&#47;&#47;source.wiredtiger.com&#47;mongodb-3.4&#47;tune_page_size_and_comp.html\n\n","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1580282059,"ip_address":"","comment_id":159349,"utype":1}],"discussion_count":5,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师，提前问个索引相关的问题，为何Mongo的索引用B树而不是B+树呢，我理解B+树的最大优点是范围查找，MySQL用的B+树，Mongo也有这个需求啊","like_count":3,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477019,"discussion_content":"MongoDB用的是B+树。\n\nhttp://source.wiredtiger.com/mongodb-3.4/tune_page_size_and_comp.html\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580282059,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1200020,"avatar":"https://static001.geekbang.org/account/avatar/00/12/4f/94/05044c31.jpg","nickname":"踢车牛","note":"","ucode":"D6D793EF5314A0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":181904,"discussion_content":"https://developpaper.com/index-mongo-uses-b-tree-mysql-uses-b-tree/\n我看过不少文章说 mongod 使用 B 树索引。。。所以老师到底那边错了？？？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1582383853,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1264111,"avatar":"https://static001.geekbang.org/account/avatar/00/13/49/ef/02401473.jpg","nickname":"月迷津渡","note":"","ucode":"2B18B2FE3DAC3B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":79068,"discussion_content":"我之前看到一个说法是虽然B+树性能均衡，但是始终要经过特定次的磁盘读，而B树的特点是有些节点返回更快，这符合mongodb高效的宗旨，并且B树的结构是节点中既有索引又有数据，再一次和mongodb的高效达成一致。\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576052834,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1019332,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","nickname":"长期规划","note":"","ucode":"5EF65E9115834B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1264111,"avatar":"https://static001.geekbang.org/account/avatar/00/13/49/ef/02401473.jpg","nickname":"月迷津渡","note":"","ucode":"2B18B2FE3DAC3B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":79294,"discussion_content":"恩，有些道理。但是范围查找就低效了，而且这种查询很常见。当然，对于按Id查找速度要比B+树快","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576072625,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":79068,"ip_address":"","group_id":0},"score":79294,"extra":""}]},{"author":{"id":1132661,"avatar":"https://static001.geekbang.org/account/avatar/00/11/48/75/02b4366a.jpg","nickname":"乘坐Tornado的线程魔法师","note":"","ucode":"C4C9915866E769","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":76604,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575820419,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":161400,"user_name":"阿白","can_delete":false,"product_type":"c3","uid":1779678,"ip_address":"","ucode":"6C7F644D56DFFB","user_header":"https://static001.geekbang.org/account/avatar/00/1b/27/de/c6f296ee.jpg","comment_is_top":false,"comment_ctime":1576201662,"is_pvip":false,"replies":[{"id":61728,"content":"当然也可以，但是那要多一个模块和组件进行维护。管理开销会大不少","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1576479968,"ip_address":"","comment_id":161400,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"这个计数器功能可以用redis来做，然后隔一段时间就更新到MongoDB中吧","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477706,"discussion_content":"当然也可以，但是那要多一个模块和组件进行维护。管理开销会大不少","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576479968,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":178570,"user_name":"VINS","can_delete":false,"product_type":"c3","uid":1712028,"ip_address":"","ucode":"7ACA41D8AECE33","user_header":"https://static001.geekbang.org/account/avatar/00/1a/1f/9c/0c7a1b3b.jpg","comment_is_top":false,"comment_ctime":1581747810,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"笔记\n\n1. 列转行\n    1. 场景 多国家 多语言 多属性\n    2. 文档很多类似字段\n    3. 转化为数组，一个索引解决所有问题\n2. 版本字段\n    1. 场景 任何有多个衍生版本的数据库\n    2. 文档模型格式多 升级的时候需要更新多个文档\n    3. 增加一个版本号字段 快速过滤不需要升级的字段 升级的时候对不同版本的文档做不同的处理\n3. 近似计算\n    1. 网页计数 各种不需要精确计算的排名\n    2. 写入太频繁 消耗系统资源\n    3. 间隔写入 每次隔10次写入一次 可大量减少写入需求\n4. 预聚合\n    1. 场景 精确排名 排行榜\n    2. 统计时间消耗 时间长\n    3. 模型中添加统计字段 每次更新同时更新统计值\n","like_count":13},{"had_liked":false,"id":158962,"user_name":"朱仁欢","can_delete":false,"product_type":"c3","uid":1307047,"ip_address":"","ucode":"1FF64ED7A60B0F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/lUnAGTC1HOCZPicMibj9SWpT2WkGLCuGA5XuFlVEJoCic6Y9z1JianocKibTeApsY4HOWKQ7D0zGKmJttwD5sTQTG0w/132","comment_is_top":false,"comment_ctime":1575507320,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"模型设计的课程相信能给今后具体场景的应用提供更多指导，期待事务课程上线","like_count":6},{"had_liked":false,"id":245809,"user_name":"renee","can_delete":false,"product_type":"c3","uid":1805805,"ip_address":"","ucode":"3821D9296CD19F","user_header":"","comment_is_top":false,"comment_ctime":1599059935,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"预聚合模式，插入时更新对应字段，很多场景下不用关注插入并发，更新聚合字段时是否有并发问题？","like_count":2},{"had_liked":false,"id":158990,"user_name":"长期规划","can_delete":false,"product_type":"c3","uid":1019332,"ip_address":"","ucode":"5EF65E9115834B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","comment_is_top":false,"comment_ctime":1575511799,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"最后两节很实用👍👍","like_count":2},{"had_liked":false,"id":349097,"user_name":"高","can_delete":false,"product_type":"c3","uid":2863310,"ip_address":"","ucode":"31CD986015A812","user_header":"https://static001.geekbang.org/account/avatar/00/2b/b0/ce/50dee854.jpg","comment_is_top":false,"comment_ctime":1655726882,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"请问一下，用行转列方式，索引是建再数组的子项country上，还是数组的总节点releases上","like_count":0},{"had_liked":false,"id":329868,"user_name":"Geek_d8b3f5","can_delete":false,"product_type":"c3","uid":1644274,"ip_address":"","ucode":"783D66CED50905","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/12IMg2N9dfaygD3ibeuakbdm29fbMJZe8HCMhA6y0SHAxjL2PNBicb3C8juu7vTOs1Ustsjt9Td3iaicSAsaCeuL3Q/132","comment_is_top":false,"comment_ctime":1641613208,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"老师，期待更多设计模式的讲解","like_count":0},{"had_liked":false,"id":328938,"user_name":"孜孜","can_delete":false,"product_type":"c3","uid":1018203,"ip_address":"","ucode":"7EF4FB644357CE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/89/5b/d8f78c1e.jpg","comment_is_top":false,"comment_ctime":1640944792,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"感觉很多都是用冗于换时间。。","like_count":0},{"had_liked":false,"id":305724,"user_name":"家乐","can_delete":false,"product_type":"c3","uid":1301941,"ip_address":"","ucode":"94F8720B59F221","user_header":"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEJia90ErsTQtNDNeyTWNwWjicERicXj72b4xgbvru2IkUdrLxrgJb5lCrTaiaW2iaX3mOYiaV8vYo3voWlg/132","comment_is_top":false,"comment_ctime":1628134258,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"每隔十次，那么每一次的写入记录放在哪？工程上如何实现，可以详细说说嘛？","like_count":0},{"had_liked":false,"id":286655,"user_name":"makermade","can_delete":false,"product_type":"c3","uid":1133194,"ip_address":"","ucode":"03386B90CB8F20","user_header":"https://static001.geekbang.org/account/avatar/00/11/4a/8a/c1069412.jpg","comment_is_top":false,"comment_ctime":1617458684,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"1.列转行 解决索引太多问题 提高查询效率\n2.文档多版本，新增一个version字段标记\n3.近似计算\n4.精确统计：预聚合","like_count":0},{"had_liked":false,"id":232718,"user_name":"开心哥","can_delete":false,"product_type":"c3","uid":1705468,"ip_address":"","ucode":"D44C1F03B23C5A","user_header":"https://static001.geekbang.org/account/avatar/00/1a/05/fc/bceb3f2b.jpg","comment_is_top":false,"comment_ctime":1594100814,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"脑洞大开啊","like_count":0},{"had_liked":false,"id":194940,"user_name":"追忆似水年华","can_delete":false,"product_type":"c3","uid":1160192,"ip_address":"","ucode":"C1D7C0DD7E7411","user_header":"https://static001.geekbang.org/account/avatar/00/11/b4/00/661fb98d.jpg","comment_is_top":false,"comment_ctime":1585122362,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"列转行，感觉就是在分桶模式的基础上，再对目标字段进行索引","like_count":0},{"had_liked":false,"id":185961,"user_name":"多读书","can_delete":false,"product_type":"c3","uid":1151239,"ip_address":"","ucode":"A0F87F106C5BED","user_header":"https://static001.geekbang.org/account/avatar/00/11/91/07/f270f35f.jpg","comment_is_top":false,"comment_ctime":1583732176,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"mongodb对那种货币的字段，比如输入英镑转成美元有好方案吗","like_count":0},{"had_liked":false,"id":164337,"user_name":"kkgo","can_delete":false,"product_type":"c3","uid":1199356,"ip_address":"","ucode":"AFCCBFD96CFA21","user_header":"https://static001.geekbang.org/account/avatar/00/12/4c/fc/0e887697.jpg","comment_is_top":false,"comment_ctime":1576939497,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"列转行","like_count":0},{"had_liked":false,"id":164064,"user_name":"Keep","can_delete":false,"product_type":"c3","uid":1178075,"ip_address":"","ucode":"ADFD481F03AB84","user_header":"https://static001.geekbang.org/account/avatar/00/11/f9/db/51457469.jpg","comment_is_top":false,"comment_ctime":1576852827,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"计数功能可以采用延迟合并写入的方式，在程序中累加点击数，当计数达到100时触发写入mongodb。不需要每次都入库","like_count":0},{"had_liked":false,"id":162435,"user_name":"Vackine","can_delete":false,"product_type":"c3","uid":1139588,"ip_address":"","ucode":"8E412EE82D3B59","user_header":"https://static001.geekbang.org/account/avatar/00/11/63/84/f45c4af9.jpg","comment_is_top":false,"comment_ctime":1576519309,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"mongo的性能压测工具，老师有什么好的推荐的么？","like_count":0},{"had_liked":false,"id":162420,"user_name":"kid1412z","can_delete":false,"product_type":"c3","uid":1123310,"ip_address":"","ucode":"00652FFE1B1103","user_header":"https://static001.geekbang.org/account/avatar/00/11/23/ee/9a45407e.jpg","comment_is_top":false,"comment_ctime":1576512664,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"对于预聚合模式来说，周销量和月销量是当前月的吗？ 如果需要查多个月份的怎么办？如果每个周或者每个月都插入新的文档，那么当前的库存需要在多个文档上进行更新？\n所以是不是周和月的销量分成多个collection比较好？","like_count":0},{"had_liked":false,"id":160880,"user_name":"月迷津渡","can_delete":false,"product_type":"c3","uid":1264111,"ip_address":"","ucode":"2B18B2FE3DAC3B","user_header":"https://static001.geekbang.org/account/avatar/00/13/49/ef/02401473.jpg","comment_is_top":false,"comment_ctime":1576053029,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"老师有个问题请教，讲到记录version这个meta字段，这个版本是在模型修改的时候手动在代码+1，那么对于老数据模型更新一个新数据模型才有的字段这时候版本号要同时更新？感觉没太想明白 挺复杂的样子。求教。","like_count":0},{"had_liked":false,"id":159709,"user_name":"Demon.Lee","can_delete":false,"product_type":"c3","uid":1052859,"ip_address":"","ucode":"7F0E5493A8E345","user_header":"https://static001.geekbang.org/account/avatar/00/10/10/bb/f1061601.jpg","comment_is_top":false,"comment_ctime":1575733608,"is_pvip":false,"replies":null,"discussion_count":2,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"近似处理模式中的那个随机数没明白，求科普","like_count":0,"discussions":[{"author":{"id":1076081,"avatar":"https://static001.geekbang.org/account/avatar/00/10/6b/71/e833b14a.jpg","nickname":"李英权","note":"","ucode":"FECAC14A9C414B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":77838,"discussion_content":"取10以内随机整数 等于0的概率为10%，遇到了就加10，这样把写入频率降到10% 。\n其实不一定等于0，等于1 2 3 4都行","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1575946460,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1052859,"avatar":"https://static001.geekbang.org/account/avatar/00/10/10/bb/f1061601.jpg","nickname":"Demon.Lee","note":"","ucode":"7F0E5493A8E345","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1076081,"avatar":"https://static001.geekbang.org/account/avatar/00/10/6b/71/e833b14a.jpg","nickname":"李英权","note":"","ucode":"FECAC14A9C414B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":77865,"discussion_content":"感谢(•ˇ‿ˇ•)-→","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575949693,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":77838,"ip_address":"","group_id":0},"score":77865,"extra":""}]}]}]}