{"id":191491,"title":"13 | 配置绑定：使用强类型对象承载配置数据","content":"<p><strong>各位亲爱的学员：</strong><br>\n推荐大家阅读一下配置框架的源码，代码量虽然不多，但这里面有不少可以借鉴的设计方法和代码风格，另外其中有一个ChainedConfigurationProvider，是课程里没有提到的，可以思考一下这个提供程序的使用场景。<br>\n源码下载地址：<a href=\"https://github.com/dotnet/extensions\">https://github.com/dotnet/extensions</a><br>\n课程将在2月6日恢复更新。</p><p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/NET-Core\">https://gitee.com/geektime-geekbang/NET-Core</a></p>","comments":[{"had_liked":false,"id":180978,"user_name":"一起跑圈","can_delete":false,"product_type":"c3","uid":1876689,"ip_address":"","ucode":"22F42FAD38021B","user_header":"","comment_is_top":false,"comment_ctime":1582452094,"is_pvip":false,"replies":[{"id":70280,"content":"bind动作是一次性的，在onchange的处理中重新bind","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1582521583,"ip_address":"","comment_id":180978,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"你好，老师。这里有个问题请教一下。\n在将配置绑定到强类型时，当配置发生变化时，配置没有重新绑定到强类型对象上：\n关键代码：\nbuilder.AddJsonFile(&quot;appsettings.json&quot;, optional: true, reloadOnChange: true);\nconfigurationRoot.Bind(config)；\nChangeToken.OnChange(() =&gt; configurationRoot.GetReloadToken(), () =&gt;\n            {\n                Console.WriteLine($&quot;config.Key1:{config.Key1}&quot;);\n                Console.WriteLine($&quot;Key1:{configurationRoot[&quot;Key1&quot;]}&quot;);\n            });\n当配置发生变化时，这里的config.Key1 任然是旧的数据，请问如何处理","like_count":2,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484875,"discussion_content":"bind动作是一次性的，在onchange的处理中重新bind","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582521583,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":225911,"user_name":"雨天","can_delete":false,"product_type":"c3","uid":1056406,"ip_address":"","ucode":"FD9FB404ECA463","user_header":"https://static001.geekbang.org/account/avatar/00/10/1e/96/3162d51f.jpg","comment_is_top":false,"comment_ctime":1591887466,"is_pvip":false,"replies":[{"id":83292,"content":"不支持这种写法，可以考虑分层，类似这样：\n{\n   &quot;key1&quot;: {\n       &quot;key2&quot;:&quot;value12&quot;\n   }\n}","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1591951485,"ip_address":"","comment_id":225911,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"肖老师，你好;请问json配置可以有&quot;.&quot;怎么使用强类型;如&quot;key1.key2&quot;:&quot;value12&quot;;","like_count":1,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":498039,"discussion_content":"不支持这种写法，可以考虑分层，类似这样：\n{\n   &amp;quot;key1&amp;quot;: {\n       &amp;quot;key2&amp;quot;:&amp;quot;value12&amp;quot;\n   }\n}","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591951485,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":217616,"user_name":"EKko","can_delete":false,"product_type":"c3","uid":1808447,"ip_address":"","ucode":"5D042C671F0130","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ2Mbk53SAgib8hoZibpHM2WlBTgkRPvUAjicGZ8CZ0VU3s9M2QDyicRibibQ8uibCXZfkZvJicKFY2Y2WiaAg/132","comment_is_top":false,"comment_ctime":1589548801,"is_pvip":false,"replies":[{"id":80604,"content":"强类型和ioptions结合使用更灵活","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1589684846,"ip_address":"","comment_id":217616,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"肖老师，你好，请问这种绑定强类型对象的做法和使用IOptions区别大吗 都是将配置绑定到强类型","like_count":0,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495195,"discussion_content":"强类型和ioptions结合使用更灵活","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589684846,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":189787,"user_name":"💻蔡铭基","can_delete":false,"product_type":"c3","uid":1905150,"ip_address":"","ucode":"7CD5FCD73CC111","user_header":"https://static001.geekbang.org/account/avatar/00/1d/11/fe/572488c0.jpg","comment_is_top":false,"comment_ctime":1584549778,"is_pvip":false,"replies":[{"id":77435,"content":"感谢支持","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1587042703,"ip_address":"","comment_id":189787,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"不错。这节不错","like_count":0,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487793,"discussion_content":"感谢支持","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587042703,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":185806,"user_name":"小喵喵","can_delete":false,"product_type":"c3","uid":1062444,"ip_address":"","ucode":"FDBBB2A59DB8B6","user_header":"https://static001.geekbang.org/account/avatar/00/10/36/2c/8bd4be3a.jpg","comment_is_top":false,"comment_ctime":1583682358,"is_pvip":false,"replies":[{"id":72473,"content":"例如线上调整部分节点的输出日志级别定位问题","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1584243914,"ip_address":"","comment_id":185806,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"请问下那个配置变更的具体用在什么场景下呢？","like_count":0,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486509,"discussion_content":"例如线上调整部分节点的输出日志级别定位问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584243914,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":185805,"user_name":"🎖赵仁伟","can_delete":false,"product_type":"c3","uid":1259150,"ip_address":"","ucode":"06E1AD7BED980E","user_header":"https://static001.geekbang.org/account/avatar/00/13/36/8e/08bdcfe2.jpg","comment_is_top":false,"comment_ctime":1583682154,"is_pvip":false,"replies":[{"id":72466,"content":"感谢支持","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1584243459,"ip_address":"","comment_id":185805,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"讲的真好！","like_count":0,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486508,"discussion_content":"感谢支持","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584243459,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":175935,"user_name":"川杰","can_delete":false,"product_type":"c3","uid":1099750,"ip_address":"","ucode":"815211E1D698E6","user_header":"https://static001.geekbang.org/account/avatar/00/10/c7/e6/11f21cb4.jpg","comment_is_top":false,"comment_ctime":1580887900,"is_pvip":false,"replies":[{"id":68384,"content":"使用强类型绑定，可以对应json数组，数组中可以是值也可以是对象。\n{\n  &quot;json_array&quot;: {\n    &quot;arrKey&quot;: [\n      &quot;valueB&quot;,\n      &quot;valueC&quot;,\n      &quot;valueD&quot;\n    ]\n  }\n}","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1580892232,"ip_address":"","comment_id":175935,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"请问，如果要绑定的对象中包含List属性呢，是否可以绑定数据？比如，在微服务里，一个Account服务下有多个Node节点；类似这种情况，该怎么配置呢？","like_count":0,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482960,"discussion_content":"使用强类型绑定，可以对应json数组，数组中可以是值也可以是对象。\n{\n  &amp;quot;json_array&amp;quot;: {\n    &amp;quot;arrKey&amp;quot;: [\n      &amp;quot;valueB&amp;quot;,\n      &amp;quot;valueC&amp;quot;,\n      &amp;quot;valueD&amp;quot;\n    ]\n  }\n}","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580892232,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":311348,"user_name":"Hunter Gu","can_delete":false,"product_type":"c3","uid":2031301,"ip_address":"","ucode":"AE10D3B5233D13","user_header":"https://static001.geekbang.org/account/avatar/00/1e/fe/c5/95238b09.jpg","comment_is_top":false,"comment_ctime":1631181790,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"肖老师，我在网上开源项目上看到一种更方便的读取配置文件方式\nvar config = Configuration.GetSection(&quot;OrderService&quot;).Get&lt;Config&gt;()\nvar key1 = config.Key1;\nvar key5 = config.Key5;\n类似于这种的，也是用强类型读取配置文件的，是不是更方便一点","like_count":0}]}