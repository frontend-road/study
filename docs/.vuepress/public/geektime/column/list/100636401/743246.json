{"id":743246,"title":"16ï½œå¤§åŠŸå‘Šæˆï¼šå®ŒæˆMiniTomcat","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯éƒ­å±¹ã€‚ä»Šå¤©æˆ‘ä»¬ç»§ç»­æ‰‹å†™MiniTomcatã€‚</p><p>ä¸ŠèŠ‚è¯¾æˆ‘ä»¬å¼•å…¥äº†è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ï¼Œå…ˆå°è¯•äº†ç”¨ç³»ç»Ÿæä¾›çš„ClassLoaderåŠ è½½æŸä¸ªç±»ï¼Œå¦‚æœæ˜¯delegateæ¨¡å¼ï¼Œé‚£ä¹ˆçˆ¶çº§ç±»åŠ è½½å™¨å»åŠ è½½è¿™ä¸ªç±»ï¼Œä¹‹åå†è¯•ç€ç”±åŸæœ¬çš„ç±»åŠ è½½å™¨åŠ è½½ç±»ï¼›å¦‚æœä¸æ˜¯delegateæ¨¡å¼ï¼Œä½¿ç”¨çˆ¶çº§ç±»åŠ è½½å™¨åŠ è½½ï¼Œå¦‚æœçˆ¶çº§ç±»åŠ è½½å™¨ä¸ºç©ºï¼Œå°±ç”¨ç³»ç»Ÿçº§ç±»åŠ è½½å™¨åŠ è½½ã€‚</p><p>éšåæˆ‘ä»¬è¿˜è¿›ä¸€æ­¥åŒºåˆ†äº†Contextã€Hostï¼Œå¯¹MiniTomcatè¿›è¡Œäº†ä¸¤å±‚å®¹å™¨åŒ…è£…ï¼Œå®ç°è§£è€¦ã€‚</p><p>è€Œè¿™èŠ‚è¯¾æˆ‘ä»¬è®¡åˆ’åšè¿›ä¸€æ­¥çš„ä¼˜åŒ–è°ƒæ•´ï¼Œä¸€æ˜¯åœ¨è¿›å…¥Hostå±‚ä¹‹å‰ï¼Œé¢„å…ˆè£…è½½Contextï¼ŒäºŒæ˜¯å¯¹Servletè®¿é—®è·¯å¾„æ”¯æŒè‡ªå®šä¹‰ã€‚æœ€åé€šè¿‡é…ç½®æ–‡ä»¶æ¥é…ç½®æœåŠ¡å™¨ï¼Œè·ŸTomcatä¸€æ ·ã€‚</p><p>ç°åœ¨æˆ‘ä»¬ä¸€èµ·æ¥åŠ¨æ‰‹å®ç°ã€‚</p><h2>é¡¹ç›®ç»“æ„</h2><p>è¿™èŠ‚è¯¾æˆ‘ä»¬æŠŠæ‰€æœ‰çš„ClassLoaderç§»åˆ°/loaderç›®å½•é‡Œï¼Œéšåä½¿ç”¨server.xmlå’Œweb.xmlåˆ†åˆ«ç®¡ç†Hostå¯åŠ¨é…ç½®ä¸ServletåŠ è½½é…ç½®ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬è¿™èŠ‚è¯¾çš„é‡ç‚¹ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹ç°åœ¨çš„ç›®å½•ç»“æ„ã€‚</p><pre><code class=\"language-plain\">MiniTomcat\nâ”œâ”€ conf\nâ”‚  â”œâ”€ server.xml\nâ”œâ”€ src\nâ”‚  â”œâ”€ main\nâ”‚  â”‚  â”œâ”€ java\nâ”‚  â”‚  â”‚  â”œâ”€ com\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ minit\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ connector\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ http\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ DefaultHeaders.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpConnector.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpHeader.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpProcessor.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpRequestImpl.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpRequestLine.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpResponseImpl.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ ServletProcessor.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ SocketInputStream.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ StatisResourceProcessor.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpRequestFacade.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpResponseFacade.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ core\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ ApplicationFilterChain.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ ApplicationFilterConfig.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ ContainerBase.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ ContainerListenerDef.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ FilterDef.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ FilterMap.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ StandardContext.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ StandardContextValve.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ StandardHost.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ StandardHostValve.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ StandardPipeline.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ StandardWrapper.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ StandardWrapperValve.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ loader\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ CommonClassLoader.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ CommonLoader.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ WebappClassLoader.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ WebappLoader.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ logger\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ Constants.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ FileLogger.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ LoggerBase.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ SystemErrLogger.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ SystemOutLogger.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ session\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ StandardSession.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ StandardSessionFacade.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ startup\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ BootStrap.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ util\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ CookieTools.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ StringManager.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ URLDecoder.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ valves\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ AccessLogValve.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ ValveBase.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Connector.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Container.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ ContainerEvent.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ ContainerListener.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Context.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ InstanceEvent.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ InstanceListener.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Loader.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Logger.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Pipeline.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Request.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Response.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Session.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ SessionEvent.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ SessionListener.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Valve.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ ValveContext.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Wrapper.java\nâ”‚  â”‚  â”œâ”€ resources\nâ”‚  â”œâ”€ test\nâ”‚  â”‚  â”œâ”€ java\nâ”‚  â”‚  â”‚  â”œâ”€ test\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HelloServlet.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ TestFilter.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ TestListener.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ TestServlet.java\nâ”‚  â”‚  â”œâ”€ resources\nâ”œâ”€ webapps\nâ”‚  â”œâ”€ app1\nâ”‚  â”‚  â”œâ”€ WEB-INF\nâ”‚  â”‚  â”‚  â”œâ”€ classes\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ test\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ HelloServlet.class\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ TestFilter.class\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ TestListener.class\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ TestServlet.class\nâ”‚  â”‚  â”‚  â”œâ”€ web.xml\nâ”‚  â”‚  â”œâ”€ hello.txt\nâ”‚  â”œâ”€ app2\nâ”‚  â”‚  â”œâ”€ WEB-INF\nâ”‚  â”‚  â”‚  â”œâ”€ classes\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ test\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ HelloServlet.class\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ TestFilter.class\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ TestListener.class\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ TestServlet.class\nâ”‚  â”‚  â”‚  â”œâ”€ web.xml\nâ”‚  â”‚  â”œâ”€ hello.txt\nâ”œâ”€ pom.xml\n</code></pre><!-- [[[read_end]]] --><h2>é¢„è£…è½½Context</h2><p>å‰é¢æˆ‘ä»¬æåˆ°äº†ï¼Œå¦‚ä½•åœ¨è°ƒç”¨ä¸€ä¸ªHostä¹‹å‰çŸ¥é“æœ‰å“ªäº›Contextå‘¢ï¼Ÿä¹‹å‰æ˜¯åœ¨è®¿é—®Hostçš„æ—¶å€™ è°ƒç”¨getContext()æ–¹æ³•å®ç°çš„ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥æ”¹é€ ï¼Œåœ¨Hostå¯åŠ¨æ—¶å°±è¿›è¡Œè¯†åˆ«ï¼Œé¢„å…ˆè£…è½½Contextï¼Œä¸å¿…æ¯æ¬¡éƒ½å†è°ƒç”¨getContext()ã€‚</p><p>æˆ‘ä»¬åœ¨StandardHostç±»çš„start()æ–¹æ³•ä¸­æ·»åŠ ä¸€æ®µä»£ç ã€‚</p><pre><code class=\"language-java\">package com.minit.core;\npublic class StandardHost extends ContainerBase {\n\n    //å¯åŠ¨ Host\n    public void start(){\n        fireContainerEvent(\"Host Started\",this);\n        Logger logger = new FileLogger();\n        setLogger(logger);\n        ContainerListenerDef listenerDef = new ContainerListenerDef();\n        listenerDef.setListenerName(\"TestListener\");\n        listenerDef.setListenerClass(\"test.TestListener\");\n        addListenerDef(listenerDef);\n        listenerStart();\n        //åœ¨/webappsç›®å½•ä¸‹åŠ è½½æ‰€æœ‰ä¸Šä¸‹æ–‡\n        File classPath = new File(System.getProperty(\"minit.base\"));\n        String dirs[] = classPath.list();\n        for (int i=0; i &lt; dirs.length; i++) {\n            getContext(dirs[i]);\n        }\n    }\n}\n</code></pre><p>ç›¸æ¯”ä¹‹å‰ï¼Œæˆ‘ä»¬åœ¨start()æ–¹æ³•é‡Œæ–°å¢çš„å°±æ˜¯ä¸‹é¢è¿™ä¸€æ®µä»£ç ã€‚</p><pre><code class=\"language-java\">        //åœ¨/webappsç›®å½•ä¸‹åŠ è½½æ‰€æœ‰ä¸Šä¸‹æ–‡\n        File classPath = new File(System.getProperty(\"minit.base\"));\n        String dirs[] = classPath.list();\n        for (int i=0; i &lt; dirs.length; i++) {\n            getContext(dirs[i]);\n        }\n</code></pre><p>ä»£ç ä¸­æœ‰ä¸€ä¸ª minit.base å±æ€§ï¼Œå®ƒä»£è¡¨äº†åº”ç”¨çš„åŸºç¡€ç›®å½•ï¼Œæ¯”å¦‚webappsï¼Œæˆ‘ä»¬è®¤ä¸ºå®ƒä¸‹é¢çš„æ¯ä¸ªå­ç›®å½•éƒ½ä»£è¡¨äº†ä¸€ä¸ªä¸åŒçš„åº”ç”¨ã€‚è¿™ä¸ªå±æ€§æ˜¯åœ¨BootStrapé‡Œè®¾ç½®çš„ï¼Œæˆ‘ä»¬å°±å…ˆæ”¹é€ BootStrapã€‚</p><p>å‚è€ƒTomcatï¼Œè¿™èŠ‚è¯¾æˆ‘ä»¬ä¹Ÿè¦å®šä¹‰server.xmlï¼Œè™½ç„¶æˆ‘ä»¬å¯ä»¥è‡ªå·±ç¼–å†™å·¥å…·ç±»è¿›è¡ŒXMLè§£æï¼Œä½†è¿™ä¸æ˜¯æˆ‘ä»¬çš„é‡ç‚¹ï¼Œå› è€Œä¸å†é‡å¤é€ è½®å­äº†ï¼Œåœ¨å¼€å§‹æ”¹é€ BootStrapå‰ï¼Œæˆ‘ä»¬åœ¨pom.xmlé‡Œå¼•å…¥æ–°çš„ä¾èµ–ã€‚</p><pre><code class=\"language-xml\">&lt;dependency&gt;\n    &lt;groupId&gt;org.dom4j&lt;/groupId&gt;\n    &lt;artifactId&gt;dom4j&lt;/artifactId&gt;\n    &lt;version&gt;2.1.3&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre><p>Server.xmlæ–‡ä»¶ä»£è¡¨äº†Tomcatçš„æ€»ä½“ç»“æ„ï¼Œå¯åŠ¨é…ç½®éƒ½æ”¾åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚ä½ æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œçœ‹ä¸€ä¸‹å®ƒçš„ä¸»ä½“éƒ¨åˆ†ã€‚</p><pre><code class=\"language-plain\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;Server port=\"8005\" shutdown=\"SHUTDOWN\"&gt;\n&nbsp; &lt;Listener className=\"org.apache.catalina.startup.VersionLoggerListener\" /&gt;\n\n&nbsp; &lt;Service name=\"Catalina\"&gt;\n&nbsp; &nbsp; &lt;Executor name=\"tomcatThreadPool\" namePrefix=\"catalina-exec-\"\n&nbsp; &nbsp; &nbsp; &nbsp; maxThreads=\"150\" minSpareThreads=\"4\"/&gt;\n&nbsp; &nbsp; &lt;Connector executor=\"tomcatThreadPool\"\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;port=\"8080\" protocol=\"HTTP/1.1\"\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;connectionTimeout=\"20000\"\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;redirectPort=\"8443\" /&gt;\n\n&nbsp; &nbsp; &lt;Engine name=\"Catalina\" defaultHost=\"localhost\"&gt;\n&nbsp; &nbsp; &nbsp; &lt;Host name=\"localhost\"&nbsp; appBase=\"webapps\"\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unpackWARs=\"true\" autoDeploy=\"true\"&gt;\n\n&nbsp; &nbsp; &nbsp; &nbsp; &lt;Valve className=\"org.apache.catalina.valves.AccessLogValve\" directory=\"logs\"\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;prefix=\"localhost_access_log\" suffix=\".txt\"\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pattern=\"%h %l %u %t &amp;quot;%r&amp;quot; %s %b\" /&gt;\n\n&nbsp; &nbsp; &nbsp; &lt;/Host&gt;\n&nbsp; &nbsp; &lt;/Engine&gt;\n&nbsp; &lt;/Service&gt;\n&lt;/Server&gt;\n</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªServer.xmlå°±å¯¹åº”äº†æˆ‘ä»¬ç›®å‰æ¢è®¨çš„Tomcatå†…éƒ¨çš„æ¦‚å¿µï¼ŒServiceã€Engineã€Hostã€Connectorç­‰ç­‰ã€‚åœ¨Hostä¸­è¿˜å¯ä»¥å®šä¹‰Contextï¼Œä¸è¿‡å› ä¸ºç°åœ¨ä¸€èˆ¬éƒ½æ˜¯è‡ªåŠ¨éƒ¨ç½²åº”ç”¨ï¼Œæ‰€ä»¥å¹¶ä¸æ¨èå®ƒäº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/ba/1d/ba640f25690760576964889c2144911d.png?wh=1920x1093\" alt=\"å›¾ç‰‡\"></p><ul>\n<li>é¡¶å±‚ï¼š<code>&lt;Server&gt;</code> å’Œ <code>&lt;Service&gt;</code></li>\n</ul><p><code>&lt;Server&gt;</code> æ˜¯Server.xmlé…ç½®æ–‡ä»¶çš„æ ¹å…ƒç´ ï¼Œ<code>&lt;Service&gt;</code> åˆ™ä»£è¡¨ä¸€ä¸ªEngineä»¥åŠä¸€ç»„ä¸ä¹‹ç›¸è¿çš„Connectorã€‚</p><ul>\n<li>è¿æ¥å™¨ï¼š<code>&lt;Connector&gt;</code></li>\n</ul><p><code>&lt;Connector&gt;</code> ä»£è¡¨äº†å®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°ç‰¹å®šServiceçš„æ¥å£ï¼Œå¦‚é€šè¿‡8080ç«¯å£è®¿é—®ï¼›åè¿‡æ¥å®ƒä¹Ÿæ˜¯å¤–éƒ¨å®¢æˆ·ç«¯ä»ç‰¹å®šServiceæ¥æ”¶å“åº”çš„æ¥å£ã€‚</p><ul>\n<li>å®¹å™¨ï¼š<code>&lt;Engine&gt;</code>ã€<code>&lt;Host&gt;</code>ã€<code>&lt;Context&gt;</code></li>\n</ul><p>å®¹å™¨ç”¨æ¥å¤„ç†é€šè¿‡Connectorè¿›æ¥çš„è¯·æ±‚ï¼Œå¹¶è°ƒç”¨ç›¸å…³çš„Servletäº§ç”Ÿç›¸åº”çš„å“åº”ã€‚Engineã€Hostå’ŒContextéƒ½æ˜¯å®¹å™¨ï¼Œå®ƒä»¬æ˜¯ä¸Šä¸‹çº§å…³ç³»ï¼Œå±‚å±‚åŒ…å«ï¼šEngineåŒ…å«Hostï¼ŒHoståŒ…å«Contextã€‚ä¸€ä¸ªEngineç»„ä»¶å¯ä»¥å¤„ç†Serviceä¸­çš„æ‰€æœ‰è¯·æ±‚ï¼Œä¸€ä¸ªHostç»„ä»¶å¯ä»¥å¤„ç†å‘å‘ä¸€ä¸ªç‰¹å®šè™šæ‹Ÿä¸»æœºçš„æ‰€æœ‰è¯·æ±‚ï¼Œä¸€ä¸ªContextç»„ä»¶å¯ä»¥å¤„ç†ä¸€ä¸ªç‰¹å®šWebåº”ç”¨çš„æ‰€æœ‰è¯·æ±‚ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬è°ƒæ•´BootStrapç±»ï¼Œä¸»è¦æ¶‰åŠå¯åŠ¨æ–¹æ³•çš„è°ƒæ•´ã€‚</p><pre><code class=\"language-java\">package com.minit.startup;\npublic class BootStrap {\n    public static final String MINIT_HOME =\n            System.getProperty(\"user.dir\");\n    public static String WEB_ROOT =\n            System.getProperty(\"user.dir\");\n    public static int PORT = 8080;\n    private static int debug = 0;\n    public static void main(String[] args) {\n        if (debug &gt;= 1)\n            log(\".... startup ....\");\n        //scan server.xml\n        //scan web.xml\n        String file = MINIT_HOME + File.separator + \"conf\" + File.separator + \"server.xml\";\n        SAXReader reader = new SAXReader();\n        Document document;\n        try {\n            document = reader.read(file);\n            Element root = document.getRootElement();\n            Element connectorelement= root.element(\"Connector\");\n            Attribute portattribute = connectorelement.attribute(\"port\");\n            PORT = Integer.parseInt(portattribute.getText());\n            Element hostelement = root.element(\"Host\");\n            Attribute appbaseattribute = hostelement.attribute(\"appBase\");\n            WEB_ROOT =  WEB_ROOT + File.separator + appbaseattribute.getText();\n        }\n        catch(Exception e) {\n        }\n        System.setProperty(\"minit.home\", MINIT_HOME);\n        System.setProperty(\"minit.base\", WEB_ROOT);\n        HttpConnector connector = new HttpConnector();\n        StandardHost container = new StandardHost();\n        Loader loader = new CommonLoader();\n        container.setLoader(loader);\n        loader.start();\n        connector.setContainer(container);\n        container.setConnector(connector);\n        container.start();\n        connector.start();\n    }\n}\n</code></pre><p>ç›¸æ¯”ä¹‹å‰ï¼Œæ–°å¢äº†å¯¹server.xmlçš„è§£æï¼Œè€Œä¸”è§£æäº† <code>&lt;Connnector&gt;</code> æ ‡ç­¾é‡Œçš„portå‚æ•°ï¼Œä»¥åŠ <code>&lt;Host&gt;</code> æ ‡ç­¾é‡Œçš„appBaseå‚æ•°ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°å»º/confæ–‡ä»¶å¤¹ï¼Œå¹¶æ–°å¢server.xmlï¼Œå‚è€ƒé…ç½®å¦‚ä¸‹ï¼š</p><pre><code class=\"language-xml\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;Server&gt;\n    &lt;Connector port=\"8080\" /&gt;\n    &lt;Host name=\"localhost\"  appBase=\"webapps\"&gt;\n    &lt;/Host&gt;\n&lt;/Server&gt;\n\n</code></pre><p>åœ¨server.xmlé‡Œæˆ‘ä»¬å®šä¹‰æœåŠ¡å™¨ç«¯å£ä¸º8080ï¼Œåº”ç”¨çš„æ ¹ç›®å½•ä¸º/webappsï¼Œè¿™ä¹Ÿå’Œæˆ‘ä»¬ç›®å‰çš„é¡¹ç›®ç»“æ„å¯¹åº”ã€‚</p><p>è¿™ä¸€éƒ¨åˆ†è§£æä»£ç æˆ‘ä»¬ç®€åŒ–å¤„ç†äº†ï¼Œä½¿ç”¨Dom4jè¯»å–æ–‡ä»¶åœ¨å†…å­˜æ„é€ ä¸€æ£µDomæ ‘ã€‚Tomcatå®é™…ä¸Šç”¨çš„æ˜¯Digesterï¼Œè¿™æ˜¯ä¸€ç§åŸºäºSAXå®ç°çš„æ¨¡å‹ã€‚æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨Digesterï¼Œæ˜¯å› ä¸ºå®ƒæ¯”è¾ƒå¤æ‚ï¼Œä½¿ç”¨çš„äººä¹Ÿæ¯”è¾ƒå°‘ï¼Œè€Œä¸”å¹¶ä¸å…³ç³»Tomcatçš„æ ¸å¿ƒç»“æ„ã€‚</p><p>åœ¨BootStrapçš„mainæ–¹æ³•è§£æå®Œserver.xmlåï¼Œminit.baseçš„å€¼å·²ç»æŒ‡å‘äº†é¡¹ç›®ä¸­çš„/webappsç›®å½•ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªç›®å½•é‡Œæˆ‘ä»¬è¿›è¡Œéå†å·¥ä½œï¼Œä¾æ¬¡è°ƒç”¨getContextæ–¹æ³•ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•æ”¹é€ åçš„æ ·å­ã€‚</p><pre><code class=\"language-java\">public StandardContext getContext(String name){\n    StandardContext context = contextMap.get(name);\n    if ( context == null) {\n        System.out.println(\"loading context : \" + name);\n        context = new StandardContext();\n        context.setDocBase(name);\n        context.setConnector(connector);\n        Loader loader = new WebappLoader(name, this.loader.getClassLoader());\n        context.setLoader(loader);\n        loader.start();\n        context.start();\n        this.contextMap.put(name, context);\n    }\n    return context;\n}\n</code></pre><p>getContextæ–¹æ³•å’Œä¹‹å‰ä¸ä¸€æ ·çš„åœ°æ–¹åœ¨äºï¼Œæ–°å¢äº†context.start()è¿™ä¸€è¡Œä»£ç ï¼Œæ­£å› å¦‚æ­¤ï¼Œéå†/webappsç›®å½•åä¼šå¯åŠ¨æ‰€æœ‰çš„Contextï¼Œè¿™æ ·ä¹Ÿå°±å®ç°äº†åœ¨Hostè°ƒç”¨å‰é¢„è£…è½½Contextã€‚</p><h2>å¼•å…¥web.xml</h2><p>æˆ‘ä»¬æ€»æ˜¯ä¼šæœ‰è¿™æ ·çš„éœ€æ±‚ï¼šè®¿é—®çš„è·¯å¾„è¦ç®€å•æ˜“è®°ï¼Œå› ä¸ºè¿™æ˜¯é¢å‘ç”¨æˆ·çš„ï¼Œè€Œä»£ç ç¼–å†™æ—¶çš„ç±»ååˆ™æ¯”è¾ƒå®Œæ•´æ¯”è¾ƒå†—é•¿ï¼Œæ‰€ä»¥åœ¨è¿™äºŒè€…ä¹‹é—´æˆ‘ä»¬è¦å»ºç«‹æ˜ å°„å…³ç³»ã€‚å‚è€ƒTomcatï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä¹Ÿå¼•å…¥web.xmlæ–‡ä»¶ï¼Œé€šè¿‡è‡ªå®šä¹‰é…ç½®å»ºç«‹è®¿é—®è·¯å¾„ä¸ç±»åä¹‹é—´çš„è”ç³»ã€‚</p><p>web.xmlçš„å‚è€ƒé…ç½®å¦‚ä¸‹ï¼š</p><pre><code class=\"language-xml\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;web-app version=\"3.0\"\n         xmlns=\"http://java.sun.com/xml/ns/javaee\"\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://java.sun.com/xml/ns/javaee\n    http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd\"&gt;\n    &lt;filter&gt;\n        &lt;filter-name&gt;testfilter&lt;/filter-name&gt;\n        &lt;filter-class&gt;test.TestFilter&lt;/filter-class&gt;\n    &lt;/filter&gt;\n    &lt;filter-mapping&gt;\n        &lt;filter-name&gt;testfilter&lt;/filter-name&gt;\n        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;\n    &lt;/filter-mapping&gt;\n    &lt;servlet&gt;\n        &lt;servlet-name&gt;testservlet&lt;/servlet-name&gt;\n        &lt;servlet-class&gt;test.TestServlet&lt;/servlet-class&gt;\n        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;\n    &lt;/servlet&gt;\n    &lt;listener&gt;\n        &lt;listener-class&gt;test.TestListener&lt;/listener-class&gt;\n    &lt;/listener&gt;\n&lt;/web-app&gt;\n</code></pre><p>å…¶ä¸­ï¼Œ<code>&lt;filter&gt;</code> æ ‡ç­¾ç”¨æ¥é…ç½®è¿‡æ»¤å™¨çš„ä¿¡æ¯ï¼›<code>&lt;filter-mapping&gt;</code> åˆ™é…ç½®è¿‡æ»¤å™¨è¿‡æ»¤çš„URLï¼Œ<code>â€/*â€œ</code> è¡¨ç¤ºä¸è¿›è¡Œä»»ä½•è¿‡æ»¤æ“ä½œï¼›<code>&lt;servlet&gt;</code> æ ‡ç­¾ç”¨äºé…ç½®Servletçš„ä¿¡æ¯ï¼Œ<code>&lt;servlet-name&gt;</code> å°±æ˜¯æˆ‘ä»¬æåˆ°çš„ç»™Servleté…ç½®çš„åˆ«åï¼Œè€Œ <code>&lt;load-on-startup&gt;</code> åˆ™è¡¨ç¤ºServletåŠ è½½æ¬¡åºï¼Œå½“è¿™ä¸ªå€¼å¤§äºç­‰äº0æ—¶ï¼Œå¯åŠ¨æ—¶æŒ‰ç…§é¡ºåºä¾æ¬¡åŠ è½½Servletï¼Œè€Œå°äº0æˆ–è€…æœªå®šä¹‰æ—¶ï¼Œå°±åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨Servletæ—¶åŠ è½½ï¼›<code>&lt;listener&gt;</code> æ ‡ç­¾åˆ™ç”¨äºé…ç½®ç›‘å¬å™¨ä¿¡æ¯ã€‚</p><p>ä¸Šä¸€éƒ¨åˆ†ä¸­æˆ‘ä»¬åœ¨è°ƒç”¨çš„getContextæ–¹æ³•ä¸­ï¼Œè°ƒç”¨äº†context.start()æ–¹æ³•ï¼Œè€Œè§£æweb.xmlçš„å·¥ä½œå°±æ”¾åœ¨startæ–¹æ³•é‡Œã€‚ä½ å¯ä»¥çœ‹ä¸€ä¸‹å‚è€ƒä»£ç ã€‚</p><pre><code class=\"language-java\">package com.minit.core;\npublic class StandardContext extends ContainerBase implements Context{\n    public void start(){\n        fireContainerEvent(\"Container Started\",this);\n        Logger logger = new FileLogger();\n        setLogger(logger);\n        //æ‰«æ web.xml\n        String file = System.getProperty(\"minit.base\") + File.separator +\n                this.docbase + File.separator + \"WEB-INF\" + File.separator + \"web.xml\";\n        SAXReader reader = new SAXReader();\n        Document document;\n        try {\n            document = reader.read(file);\n            Element root = document.getRootElement();\n            //listeners\n            List&lt;Element&gt; listeners = root.elements(\"listener\");\n            for (Element listener : listeners) {\n                Element listenerclass = listener.element(\"listener-class\");\n                String listenerclassname = listenerclass.getText();\n                System.out.println(\"listenerclassname: \" + listenerclassname);\n                //åŠ è½½ listeners\n                ContainerListenerDef listenerDef = new ContainerListenerDef();\n                listenerDef.setListenerName(listenerclassname);\n                listenerDef.setListenerClass(listenerclassname);\n                addListenerDef(listenerDef);\n            }\n            listenerStart();\n            //filters\n            List&lt;Element&gt; filters = root.elements(\"filter\");\n            for (Element filter : filters) {\n                Element filetername = filter.element(\"filter-name\");\n                String fileternamestr = filetername.getText();\n                Element fileterclass = filter.element(\"filter-class\");\n                String fileterclassstr = fileterclass.getText();\n                System.out.println(\"filter \" + fileternamestr + fileterclassstr);\n                //åŠ è½½ filters\n                FilterDef filterDef = new FilterDef();\n                filterDef.setFilterName(fileternamestr);\n                filterDef.setFilterClass(fileterclassstr);\n                addFilterDef(filterDef);\n            }\n            //filter æ˜ å°„\n            List&lt;Element&gt; filtermaps = root.elements(\"filter-mapping\");\n            for (Element filtermap : filtermaps) {\n                Element filetername = filtermap.element(\"filter-name\");\n                String fileternamestr = filetername.getText();\n                Element urlpattern = filtermap.element(\"url-pattern\");\n                String urlpatternstr = urlpattern.getText();\n                System.out.println(\"filter mapping \" + fileternamestr + urlpatternstr);\n                FilterMap filterMap = new FilterMap();\n                filterMap.setFilterName(fileternamestr);\n                filterMap.setURLPattern(urlpatternstr);\n                addFilterMap(filterMap);\n            }\n            filterStart();\n            //servlet\n            List&lt;Element&gt; servlets = root.elements(\"servlet\");\n            for (Element servlet : servlets) {\n                Element servletname = servlet.element(\"servlet-name\");\n                String servletnamestr = servletname.getText();\n                Element servletclass = servlet.element(\"servlet-class\");\n                String servletclassstr = servletclass.getText();\n                Element loadonstartup = servlet.element(\"load-on-startup\");\n                String loadonstartupstr = null;\n                if (loadonstartup != null) {\n                    loadonstartupstr = loadonstartup.getText();\n                }\n                System.out.println(\"servlet \" + servletnamestr + servletclassstr);\n                this.servletClsMap.put(servletnamestr, servletclassstr);\n                if (loadonstartupstr != null) {\n                    getWrapper(servletnamestr);\n                }\n            }\n        } catch (DocumentException e) {\n            // TODO Auto-generated catch block\n            e.printStackTrace();\n        }\n        System.out.println(\"Context started.........\");\n    }\n}\n</code></pre><p>ä¸Šè¿°ä»£ç å’Œè§£æserver.xmlç±»ä¼¼ï¼Œå°±æ˜¯æŠŠXMLæ–‡ä»¶æŒ‰ç…§æ ‡ç­¾æ ¼å¼ï¼Œä¸€å±‚å±‚åœ°æŠ½ä¸å‰¥èŒ§ï¼Œæœ€ç»ˆå°†æˆ‘ä»¬è‡ªå®šä¹‰çš„Servletåˆ«åå’Œå®é™…Servletç±»å»ºç«‹æ˜ å°„å…³ç³»ï¼Œä»è€Œç®€åŒ–URLçš„è·¯å¾„è¯·æ±‚ã€‚</p><p>è¿™æ ·ï¼Œæˆ‘ä»¬æ„å»ºMiniTomcatçš„å·¥ä½œå°±å®Œæˆäº†ã€‚</p><h2>æµ‹è¯•</h2><p>æœ‰äº†Servletè‡ªå®šä¹‰çš„åˆ«åå’Œå®é™…Servletç±»çš„é…ç½®ï¼Œç”¨æˆ·ç°åœ¨åœ¨æµè§ˆå™¨åœ°å€æ ä¸Šè¾“å…¥ <code>http://localhost:8080/app1/servlet/testservlet?name=yale</code>ï¼ŒURI é‡Œå°±ä¸å†æ˜¯test.TestServletè¿™ä¸ªç±»åï¼Œè€Œæ˜¯testservletè¿™ä¸ªåˆ«åäº†ã€‚</p><h2>å°ç»“</h2><p>è¿™èŠ‚è¯¾æˆ‘ä»¬è¿›ä¸€æ­¥å®Œå–„äº†MiniTomcatï¼Œæ–°å¢Contextç±»çš„é¢„åŠ è½½ï¼Œåœ¨è°ƒç”¨Hostä¹‹å‰æå‰åŠ è½½Contextï¼Œä¸å†åƒä¹‹å‰é‚£æ ·ï¼Œæ¯æ¬¡è°ƒç”¨Hostçš„æ—¶å€™éƒ½ä¸´æ—¶åŠ è½½Contextï¼Œé¿å…äº†å¾ˆå¤šé‡å¤å·¥ä½œã€‚</p><p>å‚è€ƒTomcatï¼Œæˆ‘ä»¬è¿˜å¼•å…¥äº†server.xmlå’Œweb.xmlï¼Œåˆ†åˆ«å¯¹æœåŠ¡ç«¯å’ŒServletè¿›è¡Œè‡ªå®šä¹‰é…ç½®ï¼Œä»¥é…ç½®çš„æ–¹å¼å¯åŠ¨æœåŠ¡å™¨ï¼Œå¯¹ä¸šåŠ¡å¼€å‘ç¨‹åºå‘˜å’Œä½¿ç”¨æ–¹æ›´åŠ å‹å¥½ã€‚åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„MiniTomcatç°åœ¨å·²ç»æ˜¯ä¸€ä¸ªå®Œæ•´çš„å°å‹Tomcatäº†ã€‚</p><p>è¿™èŠ‚è¯¾å®Œæ•´ä»£ç å‚è§ï¼š<a href=\"https://gitee.com/yaleguo1/minit-learning-demo/tree/geek_chapter16\">https://gitee.com/yaleguo1/minit-learning-demo/tree/geek_chapter16</a></p><h2>æ€è€ƒé¢˜</h2><p>å­¦å®Œäº†è¿™èŠ‚è¯¾çš„å†…å®¹ï¼Œä½ æ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬çš„web.xmlé…ç½®æ–‡ä»¶ä¸­ï¼Œå¹¶æ²¡æœ‰Servletçš„mappingé…ç½®ï¼Œè¦æ€ä¹ˆæ”¹é€ ç¨‹åºæ‰èƒ½æ”¯æŒé…ç½®Servletçš„url-patternå‘¢ï¼Ÿ</p><p>æ¬¢è¿ä½ æŠŠä½ æ€è€ƒåçš„ç»“æœåˆ†äº«åˆ°è¯„è®ºåŒºï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾çš„å†…å®¹åˆ†äº«ç»™å…¶ä»–æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","neighbors":{"left":{"article_title":"15ï½œç±»åŠ è½½æœºåˆ¶çš„æ”¹å˜ï¼šå¦‚ä½•è‡ªå®šä¹‰ClassLoaderï¼Ÿ","id":742667},"right":{"article_title":"17ï½œæ›´å¤§çš„æ¡†æ¶ï¼šMiniSpringä¸MiniTomcaté›†æˆ","id":743474}},"comments":[{"had_liked":false,"id":386612,"user_name":"HHğŸ·ğŸ ","can_delete":false,"product_type":"c1","uid":1133678,"ip_address":"å¹¿ä¸œ","ucode":"C50172BDA604D5","user_header":"https://static001.geekbang.org/account/avatar/00/11/4c/6e/5435e214.jpg","comment_is_top":false,"comment_ctime":1705217365,"is_pvip":false,"replies":[{"id":140972,"content":"è¿˜æœ‰å‡ ä¸ªå¤§çš„ï¼Œåªæ”¯æŒhttp, ä¸èƒ½ä¸web serverç‹¬ç«‹è¿è¡Œï¼Œæ²¡æœ‰embedded","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1705401330,"ip_address":"æ¾³å¤§åˆ©äºš","comment_id":386612,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"ç›®å‰èƒ½æƒ³åˆ°çš„æ˜¯ Servlet æ³¨è§£æˆ–è€…ç›´æ¥å¢åŠ  mapping é…ç½®","like_count":0,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635955,"discussion_content":"è¿˜æœ‰å‡ ä¸ªå¤§çš„ï¼Œåªæ”¯æŒhttp, ä¸èƒ½ä¸web serverç‹¬ç«‹è¿è¡Œï¼Œæ²¡æœ‰embedded","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1705401330,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¾³å¤§åˆ©äºš","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":386551,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"åŒ—äº¬","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1705065259,"is_pvip":false,"replies":[{"id":140995,"content":"Q1ï¼Œ8005æ˜¯ä¸€ä¸ªç›‘å¬ç«¯å£ï¼Œä¸“é—¨ç”¨äºSHUTDOWNæ¥å…³é—­Tomcatçš„ï¼ŒMiniTomcatæ²¡æœ‰å®ç°å®ƒ\nQ2ï¼Œä¸æ˜¯Tomcatè¿˜ç”¨å®ƒï¼Œè€Œæ˜¯Tomcatä¸€å¼€å§‹å°±ç”¨å®ƒï¼Œä»æ¥æ²¡æœ‰å˜è¿‡ã€‚å¤æ‚ä½†æ˜¯çµæ´»æ‰©å±•ï¼Œå› ä¸ºå¤æ‚æ€§é«˜ä¸€äº›ï¼Œåé¢æ²¡ä»€ä¹ˆäººè·Ÿç€å­¦ã€‚å¤§å¸ˆä»¬çš„ä¸œè¥¿ç»å¸¸å¤æ‚ï¼Œå¤§éƒ¨åˆ†ç¨‹åºå‘˜å­¦ä¸ä¼šï¼Œå› æ­¤æ²¡ä»€ä¹ˆäººç”¨ï¼Œå¦ä¸€ä¸ªä¾‹å­å°±æ˜¯Springçš„webfluxã€‚\nQ3ï¼Œhostæ˜¯è™šæ‹Ÿä¸»æœºï¼Œserver.xmlæ–‡ä»¶ä¸­å¯ä»¥é…ç½®çš„ï¼Œurlä¸­server:portè¿™ä¸€æ®µå°±è¡¨ç¤ºçš„ä¸åŒçš„è™šæ‹Ÿä¸»æœºï¼Œä¸åŒçš„è™šæ‹Ÿä¸»æœºå†…éƒ¨å°±æ˜¯ä¸åŒçš„Hostå¯¹è±¡ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":1864890,"ctime":1705447693,"ip_address":"æ¾³å¤§åˆ©äºš","comment_id":386551,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"è¯·æ•™è€å¸ˆå‡ ä¸ªé—®é¢˜ï¼š\nQ1ï¼šserver.xmlä¸­ä¸ºä»€ä¹ˆé…ç½®ä¸¤ä¸ªç«¯å£ï¼Ÿ\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;Server port=&quot;8005&quot; shutdown=&quot;SHUTDOWN&quot;&gt;\n  &lt;Service name=&quot;Catalina&quot;&gt;\n    &lt;Connector executor=&quot;tomcatThreadPool&quot;\n               port=&quot;8080&quot; protocol=&quot;HTTP&#47;1.1&quot;\n               connectionTimeout=&quot;20000&quot;\n               redirectPort=&quot;8443&quot; &#47;&gt;\n    &lt;Engine name=&quot;Catalina&quot; defaultHost=&quot;localhost&quot;&gt;\n    &lt;&#47;Engine&gt;\n  &lt;&#47;Service&gt;\n&lt;&#47;Server&gt;\n\nä¸€ä¸ª8005ï¼Œå¦å¤–ä¸€ä¸ª8080ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿåˆ°åº•æœ‰å“ªä¸€ä¸ªï¼Ÿ\n\nQ2:Tomcatä¸ºä»€ä¹ˆç”¨Digesterï¼Ÿ\næ—¢ç„¶Digesteræ¯”è¾ƒå¤æ‚ï¼Œä½¿ç”¨çš„äººä¹Ÿæ¯”è¾ƒå°‘ï¼Œä¸ºä»€ä¹ˆTomcatè¿˜ç”¨å®ƒï¼Ÿ\n\nQ3ï¼šTomcatå†…éƒ¨æ€ä¹ˆè¡¨ç¤ºå¤šä¸ªHostï¼Ÿ\nä¸€ä¸ªä¸»æœºæœ‰ä¸€å¥—å¤„ç†å®ä¾‹å—ï¼Ÿç±»ä¼¼äºâ€œç±»â€ï¼Œä¸€æ ·çš„ä»£ç ï¼Œä½†ä¸€ä¸ªå…·ä½“çš„ä¸»æœºå°±æ˜¯ä¸€ä¸ªå®ä¾‹ï¼Œæ¯”å¦‚æœ‰3ä¸ªä¸»æœºï¼Œå°±æœ‰3ä¸ªå®ä¾‹ã€‚æ˜¯è¿™æ ·å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635992,"discussion_content":"Q1ï¼Œ8005æ˜¯ä¸€ä¸ªç›‘å¬ç«¯å£ï¼Œä¸“é—¨ç”¨äºSHUTDOWNæ¥å…³é—­Tomcatçš„ï¼ŒMiniTomcatæ²¡æœ‰å®ç°å®ƒ\nQ2ï¼Œä¸æ˜¯Tomcatè¿˜ç”¨å®ƒï¼Œè€Œæ˜¯Tomcatä¸€å¼€å§‹å°±ç”¨å®ƒï¼Œä»æ¥æ²¡æœ‰å˜è¿‡ã€‚å¤æ‚ä½†æ˜¯çµæ´»æ‰©å±•ï¼Œå› ä¸ºå¤æ‚æ€§é«˜ä¸€äº›ï¼Œåé¢æ²¡ä»€ä¹ˆäººè·Ÿç€å­¦ã€‚å¤§å¸ˆä»¬çš„ä¸œè¥¿ç»å¸¸å¤æ‚ï¼Œå¤§éƒ¨åˆ†ç¨‹åºå‘˜å­¦ä¸ä¼šï¼Œå› æ­¤æ²¡ä»€ä¹ˆäººç”¨ï¼Œå¦ä¸€ä¸ªä¾‹å­å°±æ˜¯Springçš„webfluxã€‚\nQ3ï¼Œhostæ˜¯è™šæ‹Ÿä¸»æœºï¼Œserver.xmlæ–‡ä»¶ä¸­å¯ä»¥é…ç½®çš„ï¼Œurlä¸­server:portè¿™ä¸€æ®µå°±è¡¨ç¤ºçš„ä¸åŒçš„è™šæ‹Ÿä¸»æœºï¼Œä¸åŒçš„è™šæ‹Ÿä¸»æœºå†…éƒ¨å°±æ˜¯ä¸åŒçš„Hostå¯¹è±¡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1705447693,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¾³å¤§åˆ©äºš","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":392917,"user_name":"Geek_f1f069","can_delete":false,"product_type":"c1","uid":1781434,"ip_address":"å¹¿ä¸œ","ucode":"8B553307AB107C","user_header":"","comment_is_top":false,"comment_ctime":1722155431,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"è¯¾ç¨‹å·²ç»å­¦çš„å·®ä¸å¤šäº†,è¯´ä¸€ä¸‹æ€»ä½“çš„å­¦ä¹ æ„Ÿå—ã€‚ä¸çŸ¥é“æ˜¯å› ä¸ºè€å¸ˆè®²çš„ä¸å¤Ÿé€å½»,\nè¿˜æ˜¯å› ä¸ºè‡ªå·±æœ¬èº«åŠŸåŠ›çš„ä¸è¶³ï¼Œç›®å‰æ„Ÿè§‰ç†è§£çš„ä¸å¤Ÿé€å½»ï¼Œæƒ³å¤šçœ‹ä»£ç æ¶ˆåŒ–ç†è§£,ä½†æ„Ÿè§‰ä»£ç å¾ˆå¤šåœ°æ–¹ç»„ç»‡æ··ä¹±,é€»è¾‘ä¸æ¸…æ™°æ˜äº†ã€‚","like_count":0}]}