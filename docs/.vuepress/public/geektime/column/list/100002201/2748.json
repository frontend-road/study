{"id":2748,"title":"37 | ç¼–ç¨‹èŒƒå¼æ¸¸è®°ï¼ˆ8ï¼‰- Go è¯­è¨€çš„å§”æ‰˜æ¨¡å¼","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯é™ˆçš“ï¼Œç½‘åå·¦è€³æœµè€—å­ã€‚</p>\n<p>æˆ‘ä»¬å†æ¥çœ‹Goè¯­è¨€è¿™ä¸ªæ¨¡å¼ï¼ŒGoè¯­è¨€çš„è¿™ä¸ªæ¨¡å¼æŒºå¥½ç©å„¿çš„ã€‚å£°æ˜ä¸€ä¸ªstructï¼Œè·ŸCå¾ˆä¸€æ ·ï¼Œç„¶åç›´æ¥æŠŠè¿™ä¸ªstructç±»å‹æ”¾åˆ°å¦ä¸€ä¸ªstructé‡Œã€‚</p>\n<h1>å§”æ‰˜çš„ç®€å•ç¤ºä¾‹</h1>\n<p>æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªç¤ºä¾‹ï¼š</p>\n<pre><code>type Widget struct {\n    X, Y int\n}\n\ntype Label struct {\n    Widget        // Embedding (delegation)\n    Text   string // Aggregation\n    X int         // Override \n}\n\nfunc (label Label) Paint() {\n\t// [0xc4200141e0] - Label.Paint(&quot;State&quot;)\n    fmt.Printf(&quot;[%p] - Label.Paint(%q)\\n&quot;, \n    \t&amp;label, label.Text)\n}\n</code></pre>\n<p>ç”±ä¸Šé¢å¯çŸ¥ï¼š</p>\n<ul>\n<li>\n<p>æˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ª <code>Widget</code>ï¼Œå…¶æœ‰ <code>X</code>å’Œ<code>Y</code>ï¼›</p>\n</li>\n<li>\n<p>ç„¶åç”¨å®ƒæ¥å£°æ˜ä¸€ä¸ª <code>Label</code>ï¼Œç›´æ¥æŠŠ <code>Widget</code> å§”æ‰˜è¿›å»ï¼›</p>\n</li>\n<li>\n<p>ç„¶åå†ç»™ <code>Label</code> å£°æ˜å¹¶å®ç°äº†ä¸€ä¸ª <code>Paint()</code> æ–¹æ³•ã€‚</p>\n</li>\n</ul>\n<p>äºæ˜¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿™æ ·ç¼–ç¨‹äº†ï¼š</p>\n<pre><code>label := Label{Widget{10, 10}, &quot;State&quot;, 100}\n\n// X=100, Y=10, Text=State, Widget.X=10\nfmt.Printf(&quot;X=%d, Y=%d, Text=%s Widget.X=%d\\n&quot;, \n\tlabel.X, label.Y, label.Text, \n\tlabel.Widget.X)\nfmt.Println()\n// {Widget:{X:10 Y:10} Text:State X:100} \n// {{10 10} State 100}\nfmt.Printf(&quot;%+v\\n%v\\n&quot;, label, label)\n\nlabel.Paint()\n</code></pre>\n<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæœ‰æˆå‘˜å˜é‡é‡åï¼Œåˆ™éœ€è¦æ‰‹åŠ¨åœ°è§£å†³å†²çªã€‚</p>\n<!-- [[[read_end]]] -->\n<p>æˆ‘ä»¬ç»§ç»­æ‰©å±•ä»£ç ã€‚</p>\n<p>å…ˆæ¥ä¸€ä¸ª <code>Button</code>ï¼š</p>\n<pre><code>type Button struct {\n    Label // Embedding (delegation)\n}\n \nfunc NewButton(x, y int, text string) Button {\n    return Button{Label{Widget{x, y}, text, x}}\n}\nfunc (button Button) Paint() { // Override\n    fmt.Printf(&quot;[%p] - Button.Paint(%q)\\n&quot;, \n    \t&amp;button, button.Text)\n}\nfunc (button Button) Click() {\n    fmt.Printf(&quot;[%p] - Button.Click()\\n&quot;, &amp;button)\n}\n</code></pre>\n<p>å†æ¥ä¸€ä¸ª <code>ListBox</code>ï¼š</p>\n<pre><code>type ListBox struct {\n    Widget          // Embedding (delegation)\n    Texts  []string // Aggregation\n    Index  int      // Aggregation\n}\nfunc (listBox ListBox) Paint() {\n    fmt.Printf(&quot;[%p] - ListBox.Paint(%q)\\n&quot;, \n    \t&amp;listBox, listBox.Texts)\n}\nfunc (listBox ListBox) Click() {\n    fmt.Printf(&quot;[%p] - ListBox.Click()\\n&quot;, &amp;listBox)\n}\n</code></pre>\n<p>ç„¶åï¼Œå£°æ˜ä¸¤ä¸ªæ¥å£ç”¨äºå¤šæ€ï¼š</p>\n<pre><code>type Painter interface {\n    Paint()\n}\n\ntype Clicker interface {\n    Click()\n}\n</code></pre>\n<p>äºæ˜¯æˆ‘ä»¬å°±å¯ä»¥è¿™æ ·æ³›å‹åœ°ä½¿ç”¨ï¼ˆæ³¨æ„å…¶ä¸­çš„ä¸¤ä¸ªforå¾ªç¯ï¼‰ï¼š</p>\n<pre><code>button1 := Button{Label{Widget{10, 70}, &quot;OK&quot;, 10}}\nbutton2 := NewButton(50, 70, &quot;Cancel&quot;)\nlistBox := ListBox{Widget{10, 40}, \n    []string{&quot;AL&quot;, &quot;AK&quot;, &quot;AZ&quot;, &quot;AR&quot;}, 0}\n\nfmt.Println()\n//[0xc4200142d0] - Label.Paint(&quot;State&quot;)\n//[0xc420014300] - ListBox.Paint([&quot;AL&quot; &quot;AK&quot; &quot;AZ&quot; &quot;AR&quot;])\n//[0xc420014330] - Button.Paint(&quot;OK&quot;)\n//[0xc420014360] - Button.Paint(&quot;Cancel&quot;)\nfor _, painter := range []Painter{label, listBox, button1, button2} {\n\tpainter.Paint()\n}\n\nfmt.Println()\n//[0xc420014450] - ListBox.Click()\n//[0xc420014480] - Button.Click()\n//[0xc4200144b0] - Button.Click()\nfor _, widget := range []interface{}{label, listBox, button1, button2} {\n    if clicker, ok := widget.(Clicker); ok {\n    \tclicker.Click()\n    }\n}\n</code></pre>\n<h1>ä¸€ä¸ª Undo çš„å§”æ‰˜é‡æ„</h1>\n<p>ä¸Šé¢è¿™ä¸ªæ˜¯ Go è¯­è¨€ä¸­çš„å§”æ‰˜å’Œæ¥å£å¤šæ€çš„ç¼–ç¨‹æ–¹å¼ï¼Œå…¶å®æ˜¯é¢å‘å¯¹è±¡å’ŒåŸå‹ç¼–ç¨‹ç»¼åˆçš„ç©æ³•ã€‚è¿™ä¸ªç©æ³•å¯ä¸å¯ä»¥ç©å¾—æ›´æœ‰æ„æ€å‘¢ï¼Ÿè¿™æ˜¯å¯ä»¥çš„ã€‚</p>\n<p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆå£°æ˜ä¸€ä¸ªæ•°æ®å®¹å™¨ï¼Œå…¶ä¸­æœ‰ <code>Add()</code>ã€ <code>Delete()</code> å’Œ <code>Contains()</code> æ–¹æ³•ã€‚è¿˜æœ‰ä¸€ä¸ªè½¬å­—ç¬¦ä¸²çš„æ–¹æ³•ã€‚</p>\n<pre><code>type IntSet struct {\n    data map[int]bool\n}\n\nfunc NewIntSet() IntSet {\n    return IntSet{make(map[int]bool)}\n}\n\nfunc (set *IntSet) Add(x int) {\n    set.data[x] = true\n}\n\nfunc (set *IntSet) Delete(x int) {\n    delete(set.data, x)\n}\n\nfunc (set *IntSet) Contains(x int) bool {\n    return set.data[x]\n}\n\nfunc (set *IntSet) String() string { // Satisfies fmt.Stringer interface\n    if len(set.data) == 0 {\n        return &quot;{}&quot;\n    }\n    ints := make([]int, 0, len(set.data))\n    for i := range set.data {\n        ints = append(ints, i)\n    }\n    sort.Ints(ints)\n    parts := make([]string, 0, len(ints))\n    for _, i := range ints {\n        parts = append(parts, fmt.Sprint(i))\n    }\n    return &quot;{&quot; + strings.Join(parts, &quot;,&quot;) + &quot;}&quot;\n}\n</code></pre>\n<p>æˆ‘ä»¬å¦‚ä¸‹ä½¿ç”¨è¿™ä¸ªæ•°æ®å®¹å™¨ï¼š</p>\n<pre><code>ints := NewIntSet()\nfor _, i := range []int{1, 3, 5, 7} {\n    ints.Add(i)\n    fmt.Println(ints)\n}\nfor _, i := range []int{1, 2, 3, 4, 5, 6, 7} {\n    fmt.Print(i, ints.Contains(i), &quot; &quot;)\n    ints.Delete(i)\n    fmt.Println(ints)\n}\n</code></pre>\n<p>è¿™ä¸ªæ•°æ®å®¹å™¨å¹³æ·¡æ— å¥‡ï¼Œæˆ‘ä»¬æƒ³ç»™å®ƒåŠ ä¸€ä¸ªUndoçš„åŠŸèƒ½ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥åšï¼š</p>\n<pre><code>type UndoableIntSet struct { // Poor style\n    IntSet    // Embedding (delegation)\n    functions []func()\n}\n\nfunc NewUndoableIntSet() UndoableIntSet {\n    return UndoableIntSet{NewIntSet(), nil}\n}\n\nfunc (set *UndoableIntSet) Add(x int) { // Override\n    if !set.Contains(x) {\n        set.data[x] = true\n        set.functions = append(set.functions, func() { set.Delete(x) })\n    } else {\n        set.functions = append(set.functions, nil)\n    }\n}\n\nfunc (set *UndoableIntSet) Delete(x int) { // Override\n    if set.Contains(x) {\n        delete(set.data, x)\n        set.functions = append(set.functions, func() { set.Add(x) })\n    } else {\n        set.functions = append(set.functions, nil)\n    }\n}\n\nfunc (set *UndoableIntSet) Undo() error {\n    if len(set.functions) == 0 {\n        return errors.New(&quot;No functions to undo&quot;)\n    }\n    index := len(set.functions) - 1\n    if function := set.functions[index]; function != nil {\n        function()\n        set.functions[index] = nil // Free closure for garbage collection\n    }\n    set.functions = set.functions[:index]\n    return nil\n}\n</code></pre>\n<p>äºæ˜¯å°±å¯ä»¥è¿™æ ·ä½¿ç”¨äº†ï¼š</p>\n<pre><code>ints := NewUndoableIntSet()\nfor _, i := range []int{1, 3, 5, 7} {\n    ints.Add(i)\n    fmt.Println(ints)\n}\nfor _, i := range []int{1, 2, 3, 4, 5, 6, 7} {\n    fmt.Println(i, ints.Contains(i), &quot; &quot;)\n    ints.Delete(i)\n    fmt.Println(ints)\n}\nfmt.Println()\nfor {\n    if err := ints.Undo(); err != nil {\n        break\n    }\n    fmt.Println(ints)\n}\n</code></pre>\n<p>ä½†æ˜¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ç”¨äº†ä¸€ä¸ªæ–°çš„ <code>UndoableIntSet</code> å‡ ä¹é‡å†™äº†æ‰€æœ‰çš„ <code>IntSet</code> å’Œ â€œå†™â€ ç›¸å…³çš„æ–¹æ³•ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠæ“ä½œè®°å½•ä¸‹æ¥ï¼Œç„¶å <strong>Undo</strong> äº†ã€‚</p>\n<p>ä½†æ˜¯ï¼Œå¯èƒ½åˆ«çš„ç±»ä¹Ÿéœ€è¦Undoçš„åŠŸèƒ½ï¼Œæˆ‘æ˜¯ä¸æ˜¯è¦é‡å†™æ‰€æœ‰çš„éœ€è¦è¿™ä¸ªåŠŸèƒ½çš„ç±»å•Šï¼Ÿè¿™æ ·çš„ä»£ç ç±»ä¼¼ï¼Œå°±æ˜¯å› ä¸ºæ•°æ®å®¹å™¨ä¸ä¸€æ ·ï¼Œæˆ‘å°±è¦å»é‡å†™å®ƒä»¬ï¼Œè¿™å¤ªäºŒäº†ã€‚</p>\n<p>æˆ‘ä»¬èƒ½ä¸èƒ½åˆ©ç”¨å‰é¢å­¦åˆ°çš„æ³›å‹ç¼–ç¨‹ã€å‡½æ•°å¼ç¼–ç¨‹ã€IoCç­‰èŒƒå¼æ¥æŠŠè¿™ä¸ªäº‹å¹²å¾—å¥½ä¸€äº›å‘¢ï¼Ÿå½“ç„¶æ˜¯å¯ä»¥çš„ã€‚</p>\n<p>å¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<ul>\n<li>\n<p>æˆ‘ä»¬å…ˆå£°æ˜ä¸€ä¸ª <code>Undo[]</code> çš„å‡½æ•°æ•°ç»„ï¼ˆå…¶å®æ˜¯ä¸€ä¸ªæ ˆï¼‰ï¼›</p>\n</li>\n<li>\n<p>å¹¶å®ç°ä¸€ä¸ªé€šç”¨ <code>Add()</code>ã€‚å…¶éœ€è¦ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œå¹¶æŠŠè¿™ä¸ªå‡½æ•°æŒ‡é’ˆå­˜æ”¾åˆ° <code>Undo[]</code> å‡½æ•°æ•°ç»„ä¸­ã€‚</p>\n</li>\n<li>\n<p>åœ¨ <code>Undo()</code> çš„å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä¼šéå†<code>Undo[]</code>å‡½æ•°æ•°ç»„ï¼Œå¹¶æ‰§è¡Œä¹‹ï¼Œæ‰§è¡Œå®Œåå°±å¼¹æ ˆã€‚</p>\n</li>\n</ul>\n<pre><code>type Undo []func()\n\nfunc (undo *Undo) Add(function func()) {\n    *undo = append(*undo, function)\n}\n\nfunc (undo *Undo) Undo() error {\n    functions := *undo\n    if len(functions) == 0 {\n        return errors.New(&quot;No functions to undo&quot;)\n    }\n    index := len(functions) - 1\n    if function := functions[index]; function != nil {\n        function()\n        functions[index] = nil // Free closure for garbage collection\n    }\n    *undo = functions[:index]\n    return nil\n}\n\n</code></pre>\n<p>é‚£ä¹ˆæˆ‘ä»¬çš„ <code>IntSet</code> å°±å¯ä»¥æ”¹å†™æˆå¦‚ä¸‹çš„å½¢å¼ï¼š</p>\n<pre><code>type IntSet struct {\n    data map[int]bool\n    undo Undo\n}\n\nfunc NewIntSet() IntSet {\n    return IntSet{data: make(map[int]bool)}\n}\n\n</code></pre>\n<p>ç„¶ååœ¨å…¶ä¸­çš„ <code>Add</code> å’Œ <code>Delete</code>ä¸­å®ç° Undo æ“ä½œã€‚</p>\n<ul>\n<li><code>Add</code> æ“ä½œæ—¶åŠ å…¥ <code>Delete</code> æ“ä½œçš„ Undoã€‚</li>\n<li><code>Delete</code> æ“ä½œæ—¶åŠ å…¥ <code>Add</code> æ“ä½œçš„ Undoã€‚</li>\n</ul>\n<pre><code>\nfunc (set *IntSet) Add(x int) {\n    if !set.Contains(x) {\n        set.data[x] = true\n        set.undo.Add(func() { set.Delete(x) })\n    } else {\n        set.undo.Add(nil)\n    }\n}\n\nfunc (set *IntSet) Delete(x int) {\n    if set.Contains(x) {\n        delete(set.data, x)\n        set.undo.Add(func() { set.Add(x) })\n    } else {\n        set.undo.Add(nil)\n    }\n}\n\nfunc (set *IntSet) Undo() error {\n    return set.undo.Undo()\n}\n\nfunc (set *IntSet) Contains(x int) bool {\n    return set.data[x]\n}\n\n</code></pre>\n<p>æˆ‘ä»¬å†æ¬¡çœ‹åˆ°ï¼ŒGoè¯­è¨€çš„Undoæ¥å£æŠŠUndoçš„æµç¨‹ç»™æŠ½è±¡å‡ºæ¥ï¼Œè€Œè¦æ€ä¹ˆUndoçš„äº‹äº¤ç»™äº†ä¸šåŠ¡ä»£ç æ¥ç»´æŠ¤ï¼ˆé€šè¿‡æ³¨å†Œä¸€ä¸ªUndoçš„æ–¹æ³•ï¼‰ã€‚è¿™æ ·åœ¨Undoçš„æ—¶å€™ï¼Œå°±å¯ä»¥å›è°ƒè¿™ä¸ªæ–¹æ³•æ¥åšä¸ä¸šåŠ¡ç›¸å…³çš„Undoæ“ä½œäº†ã€‚</p>\n<h1>å°ç»“</h1>\n<p>è¿™æ˜¯ä¸æ˜¯å’Œæœ€ä¸€å¼€å§‹çš„C++çš„æ³›å‹ç¼–ç¨‹å¾ˆåƒï¼Ÿä¹Ÿå’Œmapã€reduceã€filterè¿™æ ·çš„åªå…³å¿ƒæ§åˆ¶æµç¨‹ï¼Œä¸å…³å¿ƒä¸šåŠ¡é€»è¾‘çš„åšæ³•å¾ˆåƒï¼Ÿè€Œä¸”ï¼Œä¸€å¼€å§‹ç”¨ä¸€ä¸ªUndoableIntSetæ¥åŒ…è£…<code>IntSet</code>ç±»ï¼Œåˆ°åè¿‡æ¥åœ¨<code>IntSet</code>é‡Œä¾èµ–<code>Undo</code>ç±»ï¼Œè¿™å°±æ˜¯æ§åˆ¶åè½¬IoCã€‚</p>\n<p>ä»¥ä¸‹æ˜¯ã€Šç¼–ç¨‹èŒƒå¼æ¸¸è®°ã€‹ç³»åˆ—æ–‡ç« çš„ç›®å½•ï¼Œæ–¹ä¾¿ä½ äº†è§£è¿™ä¸€ç³»åˆ—å†…å®¹çš„å…¨è²Œã€‚</p>\n<ul>\n<li><a href=\"https://time.geekbang.org/column/article/301\">01 | ç¼–ç¨‹èŒƒå¼æ¸¸è®°ï¼šèµ·æº</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/303\">02 | ç¼–ç¨‹èŒƒå¼æ¸¸è®°ï¼šæ³›å‹ç¼–ç¨‹</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/2017\">03 | ç¼–ç¨‹èŒƒå¼æ¸¸è®°ï¼šç±»å‹ç³»ç»Ÿå’Œæ³›å‹çš„æœ¬è´¨</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/2711\">04 | ç¼–ç¨‹èŒƒå¼æ¸¸è®°ï¼šå‡½æ•°å¼ç¼–ç¨‹</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/2723\">05 | ç¼–ç¨‹èŒƒå¼æ¸¸è®°ï¼šä¿®é¥°å™¨æ¨¡å¼</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/2729\">06 | ç¼–ç¨‹èŒƒå¼æ¸¸è®°ï¼šé¢å‘å¯¹è±¡ç¼–ç¨‹</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/2741\">07 | ç¼–ç¨‹èŒƒå¼æ¸¸è®°ï¼šåŸºäºåŸå‹çš„ç¼–ç¨‹èŒƒå¼</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/2748\">08 | ç¼–ç¨‹èŒƒå¼æ¸¸è®°ï¼šGo è¯­è¨€çš„å§”æ‰˜æ¨¡å¼</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/2751\">09 | ç¼–ç¨‹èŒƒå¼æ¸¸è®°ï¼šç¼–ç¨‹çš„æœ¬è´¨</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/2752\">10 | ç¼–ç¨‹èŒƒå¼æ¸¸è®°ï¼šé€»è¾‘ç¼–ç¨‹èŒƒå¼</a></li>\n<li><a href=\"https://time.geekbang.org/column/article/2754\">11 | ç¼–ç¨‹èŒƒå¼æ¸¸è®°ï¼šç¨‹åºä¸–ç•Œé‡Œçš„ç¼–ç¨‹èŒƒå¼</a></li>\n</ul>\n","comments":[{"had_liked":false,"id":2582,"user_name":"milley","can_delete":false,"product_type":"c1","uid":1001175,"ip_address":"","ucode":"8C95F693644CDE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/46/d7/00e99ebb.jpg","comment_is_top":false,"comment_ctime":1517884061,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"130366902941","product_id":100002201,"comment_content":"è¿™æ ·çš„ä»£ç å’Œæ€ç»´åªèƒ½è¯´èµå¿ƒæ‚¦ç›®ï¼","like_count":31},{"had_liked":false,"id":258603,"user_name":"å°æ–‡åŒå­¦","can_delete":false,"product_type":"c1","uid":1001893,"ip_address":"","ucode":"48F2AEB989C12A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/49/a5/e4c1c2d4.jpg","comment_is_top":false,"comment_ctime":1604499698,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"35964238066","product_id":100002201,"comment_content":"1ã€æ–‡ç« è¯´äº†ä»€ä¹ˆï¼Ÿ<br>æ–‡ç« åˆ†äº†ä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†å…ˆç®€å•è¯´äº† Golang çš„å§”æ‰˜ç”¨æ³•ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯è®²ä¸€ä¸ª structA åµŒå¥—åˆ°å¦å¤–ä¸€ä¸ª structB ä¸­ï¼ŒstructB ä¼šè‡ªåŠ¨ç»§æ‰¿ structA çš„å­—æ®µã€‚å…¶åï¼Œé€šè¿‡ä¸€ä¸ªæ›´åŠ å¤æ‚çš„ä¾‹å­è¯´æ˜å§”æ‰˜çš„ç”¨æ³•ã€‚ï¼ˆä½œä¸ºä¸€ä¸ª Java ç¨‹åºå‘˜ï¼ŒGolang ä¸º struct å¢åŠ æ–¹æ³•ï¼Œå’Œå®šä¹‰æ¥å£çš„æ–¹æ³•è®©äººå°è±¡æ·±åˆ»ï¼‰<br><br>å¦ä¸€éƒ¨åˆ†ï¼Œä½œè€…ä¸¾äº†ä¸€ä¸ªæ›´åŠ å¤æ‚çš„ä¾‹å­è¯´æ˜ Go ä¸­å§”æ‰˜å’Œæ¥å£å¤šæ€æ˜¯å¦‚ä½•å®ç°ä¸€ä¸ªæ•°æ®å®¹å™¨çš„ Undo å®ç°çš„ã€‚ä¸ºäº†è¯´æ˜è¿™éƒ¨åˆ†ï¼Œä½œè€…é€šè¿‡ä»¥ä¸‹æ­¥éª¤ä¸€è¯´è¯´è¿›é˜¶è¯´æ˜ï¼š<br>1ã€æœ€ç®€å•çš„ä¸€ä¸ª IntSetï¼Œå¹¶å®šä¹‰äº† Add ï¼ŒDelete æ–¹æ³•ï¼›<br>2ã€é€šè¿‡ä¸€ä¸ªå§”æ‰˜çš„æ–¹æ³•ï¼Œå°† IntSet å§”æ‰˜ç»™ä¸€ä¸ªæ–°çš„ structï¼Œæ–° struct å†é‡å†™ä¸€æ¬¡ Addï¼ŒDelete æ–¹æ³•ä»¥è®°å½•æ­¥éª¤ï¼ˆä¿å­˜Undoå‡½æ•°å¯¹è±¡ï¼‰ï¼Œå®Œæˆ Undo åŠŸèƒ½ï¼›<br>3ã€æœ€åä½œè€…å¸Œæœ›å¯ä»¥è¿›ä¸€æ­¥æ”¹å†™ï¼Œç¼–å†™ä¸€ä¸ª Undo æ ˆï¼Œå§”æ‰˜ç»™ IntSet ï¼Œå¹¶åœ¨ IntSet ç¼–å†™ Addï¼ŒDelete çš„æ–¹æ³•ä¸­å°±å®Œæˆ Undo å‡½æ•°å¯¹è±¡çš„ä¿å­˜ã€‚è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå®ç°æ–¹æ³•ã€‚","like_count":9},{"had_liked":false,"id":260749,"user_name":"Jie","can_delete":false,"product_type":"c1","uid":1045078,"ip_address":"","ucode":"AB94041E548FEB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f2/56/c39046c0.jpg","comment_is_top":false,"comment_ctime":1605095012,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10195029604","product_id":100002201,"comment_content":"æ±‚æ•™ï¼Œæœ€åé‚£æ®µä»£ç æ‰§è¡Œundoçš„æ—¶å€™ä¼šç»§ç»­æ·»åŠ undoå‡½æ•°ï¼Œé‚£æ ·ä¸å°±å›ä¸åˆ°æœ€åˆçš„çŠ¶æ€äº†ï¼Ÿåç»­ä¸€ç›´åœ¨æ’¤é”€undoâ€”æ’¤é”€æ’¤é”€undoâ€¦â€¦","like_count":2},{"had_liked":false,"id":98829,"user_name":"æ‹‰æ¬§","can_delete":false,"product_type":"c1","uid":1206605,"ip_address":"","ucode":"40996A8093A95F","user_header":"https://static001.geekbang.org/account/avatar/00/12/69/4d/81c44f45.jpg","comment_is_top":false,"comment_ctime":1559101594,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10149036186","product_id":100002201,"comment_content":"goé‡Œé¢è¿™ä¸ªundoåŠŸèƒ½çš„å®ç°ç±»ä¼¼scalaé‡Œé¢çš„trait,ä¹Ÿæ˜¯æŠŠä¸€äº›åŠŸèƒ½æ¨¡å—ï¼ˆä»¥åŠå®ç°ï¼‰å•ç‹¬å°è£…èµ·æ¥ï¼Œç„¶åä»¥å§”æ‰˜æˆ–è€…ç»§æ‰¿çš„å½¢å¼ç»„è£…åˆ°ç±»é‡Œé¢ï¼Œè¿™ç§çµæ´»ç»„è£…çš„æ–¹å¼ç¡®å®æ¯”javaçš„interfaceè¦æ›´æ–¹ä¾¿ä½¿ç”¨ï¼Œä¸åŒè¯­è¨€ä¹‹é—´æ˜¯æœ‰å…±åŒç‚¹çš„","like_count":3},{"had_liked":false,"id":281842,"user_name":"Jacob.C","can_delete":false,"product_type":"c1","uid":1070253,"ip_address":"","ucode":"034998E7A7CCD1","user_header":"https://static001.geekbang.org/account/avatar/00/10/54/ad/6ee2b7cb.jpg","comment_is_top":false,"comment_ctime":1614921318,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5909888614","product_id":100002201,"comment_content":"å†åœ¨undoé‡ŒåŠ ä¸ªåæ’¤é”€çš„åŠŸèƒ½ï¼Œå°±æ›´ç§€äº†","like_count":1},{"had_liked":false,"id":70823,"user_name":"äº¢ï¼ˆçŸ¥è¡Œåˆä¸€çš„è·¯ä¸Šï¼‰","can_delete":false,"product_type":"c1","uid":1347013,"ip_address":"","ucode":"958AF7C96EB9E8","user_header":"https://static001.geekbang.org/account/avatar/00/14/8d/c5/898b13b4.jpg","comment_is_top":false,"comment_ctime":1551190705,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5846158001","product_id":100002201,"comment_content":"ä¾èµ–çš„ä¸œè¥¿è¦å¯é ã€ç¨³å®šï¼Œä¹Ÿå°±æ˜¯æ¥å£ã€‚<br>ä¸šåŠ¡ä¸æ§åˆ¶åˆ†ç¦»ï¼Œæ§åˆ¶å°±å¯ä»¥å¤ç”¨ã€‚<br>æŠŠå˜åŒ–é¢‘ç‡ä¸åŒçš„äº‹ç‰©åˆ†å¼€ã€‚","like_count":2},{"had_liked":false,"id":65517,"user_name":"å¯»æ‰¾çš„äººcs","can_delete":false,"product_type":"c1","uid":1293788,"ip_address":"","ucode":"CA12463D24A8E1","user_header":"https://static001.geekbang.org/account/avatar/00/13/bd/dc/1ea396d2.jpg","comment_is_top":false,"comment_ctime":1549424821,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5844392117","product_id":100002201,"comment_content":"webç«¯åŠŸèƒ½å¤šä¸€ç‚¹å°±å¥½äº†ï¼Œæ¯”å¦‚æ˜¾ç¤ºæ–‡ç« åˆ—è¡¨çš„æ—¶å€™æ„Ÿè§‰ä¸å¦‚appç«¯é‚£ä¹ˆæ¸…çˆ½","like_count":2},{"had_liked":false,"id":2583,"user_name":"Z3","can_delete":false,"product_type":"c1","uid":1000005,"ip_address":"","ucode":"CC1B59C7A53FB9","user_header":"https://static001.geekbang.org/account/avatar/00/0f/42/45/cdfe6842.jpg","comment_is_top":false,"comment_ctime":1517884453,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5812851749","product_id":100002201,"comment_content":"sort.Ints(ints) parts := make([]string, 0, len(ints)) for _, i := range ints {<br><br><br>è¿™å—è¦sortå—ï¼Ÿ  èƒ½å¦ç›´æ¥for ï¼ˆi=0ï¼›i&lt;lenï¼‰print ints[i]","like_count":1},{"had_liked":false,"id":2576,"user_name":"å°ç ´","can_delete":false,"product_type":"c1","uid":1049333,"ip_address":"","ucode":"E7980E15909E4D","user_header":"https://static001.geekbang.org/account/avatar/00/10/02/f5/3aaae06f.jpg","comment_is_top":false,"comment_ctime":1517872923,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5812840219","product_id":100002201,"comment_content":"å‡ ä¸ªæœˆå‰å¬åˆ°ä»£ç æ—¶é—´åšèŠ‚ç›®ï¼Œé™ˆè€å¸ˆè®²çš„å†…å®¹è®©æˆ‘æ„Ÿè§‰å¾ˆå®åœ¨ï¼Œä»Šå¤©ç»ˆäºè·Ÿè¿‡æ¥äº†ğŸ˜ƒ","like_count":1},{"had_liked":false,"id":317150,"user_name":"seedjyh","can_delete":false,"product_type":"c1","uid":2309641,"ip_address":"","ucode":"D590E526A9A1D7","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er4IPqj4H3jQHq4C1lgKh6ZroK3CVmGLiadic7S1rxbuy09JM9x8Aib6VkozPkO4lrUTHAhicX1z9Cg2w/132","comment_is_top":false,"comment_ctime":1634695852,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634695852","product_id":100002201,"comment_content":"å§”æ‰˜æ¨¡å¼å…¶å®å°±æ˜¯åˆ©ç”¨äº†goçš„ç»„åˆåŠŸèƒ½å®ç°äº†ç±»ä¼¼C++çš„ç»§æ‰¿åŠŸèƒ½ã€‚å°±undoæ•°ç»„è€Œè¨€ï¼Œç»§æ‰¿äº†åŸºç±»çš„æ ˆã€æ³¨å†Œundoçš„æ–¹æ³•å’Œæ‰§è¡Œundoçš„æ–¹æ³•ã€‚","like_count":0},{"had_liked":false,"id":317143,"user_name":"seedjyh","can_delete":false,"product_type":"c1","uid":2309641,"ip_address":"","ucode":"D590E526A9A1D7","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er4IPqj4H3jQHq4C1lgKh6ZroK3CVmGLiadic7S1rxbuy09JM9x8Aib6VkozPkO4lrUTHAhicX1z9Cg2w/132","comment_is_top":false,"comment_ctime":1634694721,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634694721","product_id":100002201,"comment_content":"æœ€åçš„undoæ•°ç»„å¾ˆæœ‰æ„æ€ã€‚<br>åœ¨C++é‡Œï¼Œä¸€èˆ¬æ˜¯åŸºç±»Undoableæœ‰ä¸€ä¸ªpublicçš„å®ä½“å‡½æ•°Undoå’Œä¸€ä¸ªprivateçš„çº¯è™šå‡½æ•°undoï¼Œå‰è€…è°ƒç”¨åæœ€åï¼›å„ä¸ªéœ€è¦undoçš„å­ç±»å®ç°è¿™ä¸ªçº¯è™šå‡½æ•°ã€‚ä½†è¿™æ ·å°±å¼•å…¥äº†å¼ºè€¦åˆï¼ˆç»§æ‰¿ï¼‰ã€‚<br>åœ¨goé‡Œæ˜¯æ³¨å†Œä¸€ä¸ªé—­åŒ…ï¼Œè®©Undoæ•°ç»„å›è°ƒã€‚","like_count":0},{"had_liked":false,"id":268136,"user_name":"Geek_bc461b","can_delete":false,"product_type":"c1","uid":1513600,"ip_address":"","ucode":"3F86688191CC3B","user_header":"https://static001.geekbang.org/account/avatar/00/17/18/80/741d9e98.jpg","comment_is_top":false,"comment_ctime":1608082915,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1608082915","product_id":100002201,"comment_content":"å•ä»undoåŠŸèƒ½æ¥è¯´ç”¨è£…é¥°å™¨æ¨¡å¼æ˜¯ä¸æ˜¯æ›´å¥½","like_count":0},{"had_liked":false,"id":248423,"user_name":"ä½ ä¸ºå•¥é‚£ä¹ˆç‰›","can_delete":false,"product_type":"c1","uid":1503506,"ip_address":"","ucode":"1ABC604A54A8F6","user_header":"https://static001.geekbang.org/account/avatar/00/16/f1/12/7dac30d6.jpg","comment_is_top":false,"comment_ctime":1600158452,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1600158452","product_id":100002201,"comment_content":"å†™äº†åŠå¹´çš„goè¯­è¨€äº†ï¼Œç»ˆäºä½“ä¼šåˆ°goè¯­è¨€çš„ç¾æ„Ÿäº†ã€‚é‚£ç§åªè¦ä¼šå˜å˜å«çš„ï¼Œæˆ‘å°±è®¤ä¸ºæ˜¯ä¸€åªğŸ¦†çš„å¢ƒç•Œã€‚ğŸ˜ƒ","like_count":1},{"had_liked":false,"id":211730,"user_name":"é«˜ç§‘","can_delete":false,"product_type":"c1","uid":1107568,"ip_address":"","ucode":"81A4DDF41D3C1C","user_header":"https://static001.geekbang.org/account/avatar/00/10/e6/70/b9907b0e.jpg","comment_is_top":false,"comment_ctime":1587999626,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587999626","product_id":100002201,"comment_content":"ä¸ä¹…å‰åˆšåˆšæŠŠgoçš„ç¯å¢ƒæ­å¥½ï¼Œéƒ¨ç½²äº†ä¸€ä¸ªå¼€æºåº”ç”¨ï¼Œå‡†å¤‡å­¦ä¹ èµ·æ¥","like_count":0},{"had_liked":false,"id":180964,"user_name":"whiledoing","can_delete":false,"product_type":"c1","uid":1049643,"ip_address":"","ucode":"1BEB769E13F47C","user_header":"https://static001.geekbang.org/account/avatar/00/10/04/2b/68d6ac0d.jpg","comment_is_top":false,"comment_ctime":1582449865,"is_pvip":true,"discussion_count":2,"race_medal":0,"score":"1582449865","product_id":100002201,"comment_content":"æœ‰ç‚¹ä¸ç†è§£ï¼Œä¸ºä»€ä¹ˆ Undo çš„å‡½æ•°ä¸æ˜¯ç›´æ¥ delete(set.data, x)ï¼Œè€Œæ˜¯ set.Delete(x)ï¼Œè¿™æ ·å­ä¼šä¸ä¼šå¯¼è‡´undo çš„é˜Ÿåˆ—ä¸€ç›´åœ¨é€’å½’","like_count":0,"discussions":[{"author":{"id":1164195,"avatar":"https://static001.geekbang.org/account/avatar/00/11/c3/a3/50aa836d.jpg","nickname":"ç‰¹ç«‹ç‹¬è¡Œçš„çŒª","note":"","ucode":"E96B277F45F60E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378135,"discussion_content":"//è·å–åˆ‡ç‰‡æœ€åä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•\nindex := len(functions) - 1\n//è¿™é‡Œæ‰§è¡Œçš„ä»£ç ï¼Œä¼šappendä¸€ä¸ªå…ƒç´ \n...\n//åˆ é™¤ç´¢å¼•ä¹‹åçš„æ‰€æœ‰å…ƒç´ ï¼ˆåŒ…å«å½“å‰ç´¢å¼•ï¼‰å¼¹æ ˆæ“ä½œ\n*undo = functions[:index]\nindexæ˜¯åœ¨functionsæ”¹å˜ä¹‹å‰è·å–çš„ï¼Œåé¢å†æ€ä¹ˆå˜éƒ½ä¸å½±å“","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623063976,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1045078,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f2/56/c39046c0.jpg","nickname":"Jie","note":"","ucode":"AB94041E548FEB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":324352,"discussion_content":"æˆ‘ä¹Ÿæœ‰è¿™ä¸ªç–‘æƒ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605094814,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":2619,"user_name":"xiaoè±ª","can_delete":false,"product_type":"c1","uid":1026417,"ip_address":"","ucode":"F7969A9785E37B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a9/71/78796fd5.jpg","comment_is_top":false,"comment_ctime":1518067301,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1518067301","product_id":100002201,"comment_content":"å£°æ˜ä¸ºtype Inset map[int]boolå°±ä¸ç”¨å†™æˆset.data[x]=trueè¿™æ ·äº†ï¼Œç›´æ¥set[x]=trueå°±å¯ä»¥äº†ã€‚","like_count":0},{"had_liked":false,"id":2592,"user_name":"å°è™¾ç±³","can_delete":false,"product_type":"c1","uid":1005528,"ip_address":"","ucode":"F543987A7FAB20","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/d8/425e1b0a.jpg","comment_is_top":false,"comment_ctime":1517915050,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1517915050","product_id":100002201,"comment_content":"è¿™æ ·å†™çš„undoåœ¨ç¬¬ä¸€æ¬¡æ’å…¥è¿‡åï¼Œå¯ä»¥æ— é™æ’¤é”€äº†å§","like_count":0}]}