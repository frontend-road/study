{"id":85425,"title":"聊聊Framework的学习方法","content":"<p>大家好，我是陆晓明，现在在一家互联网手机公司担任Android系统开发工程师。很高兴可以在极客时间Android开发高手课专栏里，分享一些我在手机行业9年的经验以及学习Android的方法。</p><p>今天我要跟你分享的是Framework的学习和调试的方法。</p><p>首先，Android是一种基于Linux的开放源代码软件栈，为广泛的设备和机型而创建。下图是Android平台的<a href=\"https://developer.android.google.cn/guide/platform\">主要组件</a>。</p><p><img src=\"https://static001.geekbang.org/resource/image/90/df/90763fd9662c8a75553dc92a78112ddf.png?wh=1384*2038\" alt=\"\"></p><p>从图中你可以看到主要有以下几部分组成：</p><ul>\n<li><strong>Linux内核</strong></li>\n<li><strong>Android Runtime</strong></li>\n<li><strong>原生C/C++库</strong></li>\n<li><span class=\"orange\">Java API框架（后面我称之为Framework框架层）</span></li>\n<li><strong>系统应用</strong></li>\n</ul><p>我们在各个应用市场看到的，大多是第三方应用，也就是安装在data区域的应用，它们可以卸载，并且权限也受到一些限制，比如不能直接设置时间日期，需要调用到系统应用设置里面再进行操作。</p><p>而我们在应用开发过程中使用的四大组件，便是在Framework框架层进行实现，应用通过约定俗成的规则，在AndroidMainfest.xml中进行配置，然后继承对应的基类进行复写。系统在启动过程中解析AndroidMainfest.xml，将应用的信息存储下来，随后根据用户的操作，或者系统的广播触发，启动对应的应用。</p><!-- [[[read_end]]] --><p>那么，我们先来看看Framework框架层都有哪些东西。</p><p>Framework框架层是应用开发过程中，调用的系统方法的内部实现，比如我们使用的TextView、Button控件，都是在这里实现的。再举几个例子，我们调用ActivityManager的getRunningAppProcesses方法查看当前运行的进程列表，还有我们使用NotificationManager的notify发送一个系统通知。</p><p>让我们来看看Framework相关的代码路径。</p><p><img src=\"https://static001.geekbang.org/resource/image/17/d4/178ef00a181a85e85a3b75d4c60abcd4.jpg?wh=1284*678\" alt=\"\"></p><p>如何快速地学习、梳理Framework知识体系呢？常见的学习方法有下面几种：</p><ul>\n<li>阅读书籍（方便梳理知识体系，但对于解决问题只能提供方向）。</li>\n<li>直接阅读源码（效率低，挑战难度大）。</li>\n<li>打Log和打堆栈 （效率有所提升，但需要反复编译，添加Log和堆栈代码）。</li>\n<li>直接联调，实时便捷（需要调试版本）。</li>\n</ul><p>首先可以通过购买相关的书籍进行学习，其中主要的知识体系有Linux操作系统，比如进程、线程、进程间通信、虚拟内存，建立起自己的软件架构。在此基础上学习Android的启动过程、服务进程SystemServer的创建、各个服务线程（AMS/PMS等）的创建过程，以及Launcher的启动过程。熟悉了这些之后，你还要了解ART虚拟机的主要工作原理，以及init和Zygote的主要工作原理。之后随着在工作和实践过程中你会发现，Framework主要是围绕应用启动、显示、广播消息、按键传递、添加服务等开展，这些代码的实现主要使用的是Java和C++这两种语言。</p><p>通过书籍或者网络资料学习一段时间后，你会发现很多问题都没有现成的解决方案，而此时就需要我们深入源码中进行挖掘和学习。但是除了阅读官方文档外，别忘了调试Framework也是一把利刃，可以让你游刃有余快速定位和分析源码。</p><p>下面我们来看看调试Framework的Java部分，关于C++的部分，需要使用GDB进行调试，你可以在课下实践一下，调试的过程可以参考<a href=\"https://mp.weixin.qq.com/s/VSVUbaEIfrmFZMB1k49fyA\">《深入Android源码系列（一）》</a>。</p><p>我们这里使用Android Studio进行调试，在调试前我们要先掌握一些知识。Java代码的调试，主要依据两个因素，一个是你要调试的进程；一个是调试的类对应的包名路径，同时还要保证你所运行的手机环境和你要调试的代码是匹配的。只要这两个信息匹配，编译不通过也是可以进行调试的。</p><p>我们调试的系统服务是在SystemServer进程中，可以使用下面的命令验证（我这里使用Genymotion上安装Android对应版本镜像的环境演示）。</p><pre><code>ps -A |grep system_server  查看系统服务进程pid\ncat /proc/pid/maps |grep services 通过cat查看此进程的内存映射，看看是否services映射到内存里面。\n</code></pre><p>这里我们看到信息：/system/framework/oat/x86/services.odex 。</p><p>odex是Android系统对于dex的进一步优化，目的是为了提升执行效率。从这个信息便可以确定，我们的services.jar确实是跑到这里了，也就是我们的系统服务相关联的代码，可以通过调试SystemServer进程进行跟踪。</p><p>下来我们来建立调试环境。</p><ul>\n<li>\n<p>打开Genymotion，选择下载好Android 9.0的镜像文件，启动模拟器。</p>\n</li>\n<li>\n<p>找到模拟器对应的ActivityManagerService.java代码。 我是从<a href=\"http://androidxref.com/\">http://androidxref.com/</a>下载Android 9.0对应的代码。</p>\n</li>\n<li>\n<p>打开Android Studio，File -&gt; New -&gt; New Project然后直接Next直到完成就行。</p>\n</li>\n<li>\n<p>新建一个包名，从ActivityManagerService.java文件中找到它，这里为<code>com.android.server.am</code>，然后把ActivityManagerService.java放到里面即可。</p>\n</li>\n<li>\n<p>在ActivityManagerService.java的startActivity方法上面设置断点，然后找到菜单的Run -&gt; Attach debugger to Android process勾选Show all process，选中SystemServer进程确定。</p>\n</li>\n</ul><p><img src=\"https://static001.geekbang.org/resource/image/ba/f0/ba1eb6bded9167f26ae48b34a6d792f0.png?wh=836*255\" alt=\"\"></p><p>这时候我们点击Genymotion模拟器中桌面的一个图标，启动新的界面。</p><p><img src=\"https://static001.geekbang.org/resource/image/c9/45/c92b62d1065f967696dbdd2851037b45.png?wh=295*212\" alt=\"\"></p><p>会发现这时候我们设定的断点已经生效。</p><p><img src=\"https://static001.geekbang.org/resource/image/76/05/763f222e01a30c969024d8cf77dd0705.png?wh=959*499\" alt=\"\"></p><p>你可以看到断下来的堆栈信息，以及一些变量值，然后我们可以一步步调试下去，跟踪启动的流程。</p><p>对于学习系统服务线程来讲，通过调试可以快速掌握流程，再结合阅读源码，便可以快速学习，掌握系统框架的整个逻辑，从而节省学习的时间成本。</p><p>以上我们验证了系统服务AMS服务代码的调试，其他服务调试方法也是一样，具体的线程信息，可以使用下面的命令查看。</p><pre><code>ps -T 353 \n这里353是使用ps -A |grep SystemServer查出 SystemServer的进程号\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/62/a8/62d0d79e490a14f19422486c5da85fa8.png?wh=705*216\" alt=\"\"></p><p>在上面图中，PID = TID的只有第一行这一行，如果PID = TID的话，也就是这个线程是主线程。下面是我们平时使用Logcat查看输出的信息。</p><pre><code>03-10 09:33:01.804   240   240 I hostapd : type=1400 audit(0.0:1123): avc: de\n03-10 09:33:37.320   353  1213 D WificondControl: Scan result ready event\n03-10 09:34:00.045   404   491 D hwcomposer: hw_composer sent 6 syncs in 60s\n</code></pre><p>这里我还框了一个ActivityManager的线程，这个是线程的名称，通过查看这行的TID（368）就知道下面的Log就是这个线程输出的。</p><pre><code>03-10 08:47:33.574   353   368 I ActivityManager: Force stopping com.android.providers\n</code></pre><p>学习完上面的知识，相信你应该学会了系统服务的调试。通过调试分析，我们便可以将系统服务框架进行庖丁解牛般的学习，面对大量庞杂的代码掌握起来也可以轻松一些。</p><p>我们回过头来，再次在终端中输入<code>ps -A</code>，看看下面这一段信息。</p><p><img src=\"https://static001.geekbang.org/resource/image/29/4e/298cadbc90a1f04d02e1e116f6db464e.png?wh=767*177\" alt=\"\"></p><p>你可以看到这里的第一列，代表的是当前的用户，这里有system root和u0_axx，不同的用户有不同的权限。我们当前关注的是第二列和第三列，第二列代表的是PID，也就是进程ID；第三列代表的是PPID，也就是父进程ID。</p><p>你发现我这里框住的都是同一个父进程，那么我们来找下这个323进程，看看它到底是谁。</p><pre><code>root 323 1 1089040 127540 poll_schedule_timeout f16fcbc9 S zygote\n</code></pre><p>这个名字在学习Android系统的时候，总被反复提及，因为它是我们Android世界的孵化器，每一个上层应用的创建，都是通过Zygote调用fork创建的子进程，而子进程可以快速继承父进程已经加载的资源库，这里主要指的是应用所需的JAR包，比如/system/framework/framework.jar，因为我们应用所需的基础控件都在这里，像View、TextView、ImageView。</p><p>接下来我来讲解下一个调试，也就是对TextView的调试（其他Button调试方式一样）。如前面所说，这个代码被编译到/system/framework/framework.jar，那么我们通过ps命令和cat /proc/pid/maps命令在Zygote中找到它，同时它能够被每一个由Zygote创建的子进程找到，比如我们当前要调试Gallery的主界面TextView。</p><p>我们验证下，使用<code>ps -A |grep gallery3d</code>查到Gallery对应的进程PID，使用cat /proc/pid/maps |grep framework.jar看到如下信息：</p><pre><code>efcd5000-efcd6000 r--s 00000000 08:06 684                                /system/framework/framework.jar\n</code></pre><p>这说明我们要调试的应用进程在内存映射中确实存在，那么我们就需要在gallery3d进程中下断点了。</p><p>下来我们建立调试环境：</p><ul>\n<li>\n<p>打开Genymotion，选择下载好Android 9.0的镜像文件，启动模拟器，然后在桌面上启动Gallery图库应用。</p>\n</li>\n<li>\n<p>找到模拟器对应的TextView.java代码。</p>\n</li>\n<li>\n<p>打开Android Studio，File -&gt; New -&gt; New Project然后直接Next直到完成就行。</p>\n</li>\n<li>\n<p>新建一个包名，从TextView.java文件中找到它的包名，这里为android.widget，然后把TextView.java放到里面即可。</p>\n</li>\n<li>\n<p>在TextView.java的onDraw方法上面设置断点，然后找到菜单的Run -&gt; Attach debugger to Android process勾选Show all process，选中com.android.gallery3d进程（我们已知这个主界面有TextView控件）确定。</p>\n</li>\n</ul><p>然后我们点击下这个界面左上角的菜单，随便选择一个点击，发现断点已生效，具体如下图所示。</p><p><img src=\"https://static001.geekbang.org/resource/image/c2/85/c2a9a5a71d4bd4a02b5bee113d866b85.png?wh=914*375\" alt=\"\"></p><p>然后我们可以使用界面上的调试按钮（或者快捷键）进行调试代码。</p><p><img src=\"https://static001.geekbang.org/resource/image/c3/f8/c395c9f16a7c057c1076b4619dd1b5f8.png?wh=428*30\" alt=\"\"></p><p>今天我讲解了如何调试Framework中的系统服务进程的AMS服务线程，其他PMS、WMS的调试方法跟AMS一样。并且我也讲解了如何调试一个应用里面的TextView控件，其他的比如Button、ImageView调试方法跟TextView也是一样的。</p><p>通过今天的学习，我希望能够给你一个学习系统框架最便捷的路径。在解决系统问题的时候，你可以方便的使用调试分析，从而快速定位、修复问题。</p><p></p>","comments":[{"had_liked":false,"id":75047,"user_name":"亮","can_delete":false,"product_type":"c1","uid":1238210,"ip_address":"","ucode":"33975BD95BF54A","user_header":"https://static001.geekbang.org/account/avatar/00/12/e4/c2/e8ac8b6d.jpg","comment_is_top":false,"comment_ctime":1552352256,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"91746665472","product_id":100021101,"comment_content":"以前总以为调试源码需要下载源代码，编译工程，今天才知道原来还可以这样，新技能get√","like_count":22},{"had_liked":false,"id":75053,"user_name":"品牌运营|陆晓明","can_delete":false,"product_type":"c1","uid":1096054,"ip_address":"","ucode":"8E04D0A90458C9","user_header":"https://static001.geekbang.org/account/avatar/00/10/b9/76/bc5f8468.jpg","comment_is_top":false,"comment_ctime":1552352549,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"44502025509","product_id":100021101,"comment_content":"如果调试某个具体的流程，就将关联的文件放到对应的包名下即可。找对你要调试的进程，就可以在这些文件的具体方法下断点，进行调试跟踪。<br><br>当发现没有调试上的时候，可以确定下是否源码不匹配？是否调试的进程不对（可以通过干掉你调试的进程，看看是否你调试的东西会挂掉，当然systemserver干掉手机就软重启啦。你想调试systemserver的启动过程，倒是可以这么干）在调试的过程中，使用源码阅读工具，将相关联的代码放入环境，在可疑地方，或者方法调用的地方设断点，做个简单判定即可，然后使用多个断点的设定，来卡住具体走到哪个流程，在断住之后，使用堆栈回溯，看看调用顺序，帮你梳理整个流程。","like_count":11},{"had_liked":false,"id":74996,"user_name":"程序员小跃","can_delete":false,"product_type":"c1","uid":1015483,"ip_address":"","ucode":"25BB96E0791A60","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7e/bb/947c329a.jpg","comment_is_top":false,"comment_ctime":1552349197,"is_pvip":true,"replies":[{"id":"30705","content":"很多时候是绕不过去的，或者不深入底层是找不到优化的方法","user_name":"作者回复","user_name_real":"张绍文","uid":"1009577","ctime":1555138142,"ip_address":"","comment_id":74996,"utype":1}],"discussion_count":1,"race_medal":0,"score":"31617120269","product_id":100021101,"comment_content":"我就是有个毛病，遇到难的，更底层的东西总想着绕过去，而不是迎头而上，所以很多时候不能很好的解决问题。惧怕看源码，调试，到现在不一样了，我也知道很多高手都是能轻松看源码和调试，所以我也试着改变自己了","like_count":8,"discussions":[{"author":{"id":1009577,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/a9/e251ace7.jpg","nickname":"张绍文","note":"","ucode":"94B49E5F80BFDE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442770,"discussion_content":"很多时候是绕不过去的，或者不深入底层是找不到优化的方法","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555138142,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":76454,"user_name":"bytecode","can_delete":false,"product_type":"c1","uid":1123335,"ip_address":"","ucode":"0BE585036E259F","user_header":"https://static001.geekbang.org/account/avatar/00/11/24/07/380666e3.jpg","comment_is_top":false,"comment_ctime":1552613331,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"27322417107","product_id":100021101,"comment_content":"调试Android Framework的Java部分代码，以调试源码android-28为例，需要一个API 28的模拟器配合使用。<br>1、下载源码<br>下载源码方式很多，由于调试Framework只需要java代码即可，这里使用Android Studio的SDK Manager下载android-28为例，sdk&#47;sources下看到android-28源码。<br>2、新建一个项目，包名cn.test.demo，避免com开头是因为源码有com，等下拷贝源码是避免重复。<br>3、拷贝源码到项目的java目录下。<br>4、新建一个与源码对应的模拟器。<br>5、启动模拟器，选择debug的进程。<br>6、选择某一个源码类进行调试。<br>更多查看：https:&#47;&#47;github.com&#47;libill&#47;DebugAndroidFramework","like_count":7,"discussions":[{"author":{"id":1120463,"avatar":"https://static001.geekbang.org/account/avatar/00/11/18/cf/787c7e37.jpg","nickname":"小昕😙","note":"","ucode":"DE823BC5D4A4E0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":342712,"discussion_content":"关联不到系统进程是为啥啊。。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610788187,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1441900,"avatar":"https://static001.geekbang.org/account/avatar/00/16/00/6c/fd4d6399.jpg","nickname":"Dev","note":"","ucode":"D065E2FC4D6A6D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":69236,"discussion_content":"我用android Q  和Genymotion，导入代码以后，关联到系统进程，但是：断点打不上啊。  ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575274313,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":75381,"user_name":"品牌运营|陆晓明","can_delete":false,"product_type":"c1","uid":1096054,"ip_address":"","ucode":"8E04D0A90458C9","user_header":"https://static001.geekbang.org/account/avatar/00/10/b9/76/bc5f8468.jpg","comment_is_top":false,"comment_ctime":1552385989,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"27322189765","product_id":100021101,"comment_content":"楼上说的官方是在8.1，需要自己切换分支，下载9.0的就行了。 国内的可以先使用清华镜像下载，下载好了切换到9.0的代码上。<br><br>有问题欢迎在官方安卓进阶开发微信群@ 我，随时等待大家的交流。","like_count":7,"discussions":[{"author":{"id":1267172,"avatar":"https://static001.geekbang.org/account/avatar/00/13/55/e4/7061abd5.jpg","nickname":"Mr.J","note":"","ucode":"372D8C614F6C3D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":51118,"discussion_content":"求群号","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573813156,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":75533,"user_name":"品牌运营|陆晓明","can_delete":false,"product_type":"c1","uid":1096054,"ip_address":"","ucode":"8E04D0A90458C9","user_header":"https://static001.geekbang.org/account/avatar/00/10/b9/76/bc5f8468.jpg","comment_is_top":false,"comment_ctime":1552410303,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14437312191","product_id":100021101,"comment_content":"看到很多朋友留言，让我感觉受宠若惊。不时在看着留言又有哪些问题，想给大家更好的解答。<br>极客没有专门针对一条留言回复的功能，导致回复的有些乱。<br>如果有机会，欢迎大家加我微信，帮你解答调试中的任何疑问。<br>再次感谢！<br>我的微信<br><br>code_gg_boy<br><br>","like_count":3,"discussions":[{"author":{"id":2763653,"avatar":"","nickname":"Geek_61de09","note":"","ucode":"56A95CB08C0B04","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545143,"discussion_content":"“找到模拟器对应的 ActivityManagerService.java 代码”大佬，文中的这句话是什么意思呀，怎么找这个东西呢？模拟器不是一个应用程序吗？怎么会让我们看到它的代码呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641864622,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":75192,"user_name":"tt716","can_delete":false,"product_type":"c1","uid":1022990,"ip_address":"","ucode":"16B3DCA5E18AC1","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9c/0e/0db41dda.jpg","comment_is_top":false,"comment_ctime":1552361751,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14437263639","product_id":100021101,"comment_content":"有一个问题，如何能下到与genymotion中镜像对应的源码呢？不然debug的时候有的行会对不上","like_count":3},{"had_liked":false,"id":75010,"user_name":"wang_acmilan","can_delete":false,"product_type":"c1","uid":1025858,"ip_address":"","ucode":"AE0E3A5005A108","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a7/42/f510bb91.jpg","comment_is_top":false,"comment_ctime":1552350737,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14437252625","product_id":100021101,"comment_content":"支持明哥，前排占座。调试framework是系统工程师必备技能。","like_count":3},{"had_liked":false,"id":305328,"user_name":"OF","can_delete":false,"product_type":"c1","uid":1329847,"ip_address":"","ucode":"1087485CFAB7A1","user_header":"https://static001.geekbang.org/account/avatar/00/14/4a/b7/a3468e61.jpg","comment_is_top":false,"comment_ctime":1627907629,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627907629","product_id":100021101,"comment_content":"我去，过了两年才看到这个，两年白瞎了","like_count":0},{"had_liked":false,"id":149087,"user_name":"河里的枇杷树、","can_delete":false,"product_type":"c1","uid":1083598,"ip_address":"","ucode":"05468530119B0E","user_header":"https://static001.geekbang.org/account/avatar/00/10/88/ce/e22e2cda.jpg","comment_is_top":false,"comment_ctime":1573139539,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573139539","product_id":100021101,"comment_content":"豁然开朗啊","like_count":0},{"had_liked":false,"id":133388,"user_name":"想不出名字","can_delete":false,"product_type":"c1","uid":1215581,"ip_address":"","ucode":"EE94A9643F791B","user_header":"https://static001.geekbang.org/account/avatar/00/12/8c/5d/a45f1e49.jpg","comment_is_top":false,"comment_ctime":1568542700,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568542700","product_id":100021101,"comment_content":"有什么好的framework的书介绍吗？framework的资源好难找","like_count":0},{"had_liked":false,"id":131155,"user_name":"邱","can_delete":false,"product_type":"c1","uid":1652565,"ip_address":"","ucode":"BC63782674CC82","user_header":"https://static001.geekbang.org/account/avatar/00/19/37/55/606bc5f7.jpg","comment_is_top":false,"comment_ctime":1567654610,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567654610","product_id":100021101,"comment_content":"以前一直以为只有对应源码，对应手机版本才能调试 framework。这时才恍然大悟，可以用 Genymotion，加官方代码","like_count":0},{"had_liked":false,"id":95831,"user_name":"Jiantao","can_delete":false,"product_type":"c1","uid":1163504,"ip_address":"","ucode":"444580EC5EF109","user_header":"https://static001.geekbang.org/account/avatar/00/11/c0/f0/1aabc056.jpg","comment_is_top":false,"comment_ctime":1558194359,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1558194359","product_id":100021101,"comment_content":"模拟器+对应sdk版本源码+调试进程 ，就可以debug了。感谢分享。","like_count":0,"discussions":[{"author":{"id":2763653,"avatar":"","nickname":"Geek_61de09","note":"","ucode":"56A95CB08C0B04","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545142,"discussion_content":"“找到模拟器对应的 ActivityManagerService.java 代码”大佬，文中的这句话是什么意思呀，怎么找这个东西呢？模拟器不是一个应用程序吗？怎么会让我们看到它的代码呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641864604,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":90473,"user_name":"abero","can_delete":false,"product_type":"c1","uid":1144779,"ip_address":"","ucode":"92F6BFB6BCFDB5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/B30fTWp3jZVV1UJP4Kwd0DXYDohhoN2IHB4YN3B09hmKvibentQYyr5p0AEsqfgEpGZ4czHPnphLJqtibmjTodibQ/132","comment_is_top":false,"comment_ctime":1556529695,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556529695","product_id":100021101,"comment_content":"真机可以调试源码吗","like_count":0},{"had_liked":false,"id":81029,"user_name":"h波","can_delete":false,"product_type":"c1","uid":1040889,"ip_address":"","ucode":"60DA3A83CF6024","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e1/f9/6e8203fe.jpg","comment_is_top":false,"comment_ctime":1553780360,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"1553780360","product_id":100021101,"comment_content":"我在实际操作中，在 Attach debugger to Android process 中找不到 system_process 这个进程，这是怎么回事呀","like_count":0,"discussions":[{"author":{"id":1120463,"avatar":"https://static001.geekbang.org/account/avatar/00/11/18/cf/787c7e37.jpg","nickname":"小昕😙","note":"","ucode":"DE823BC5D4A4E0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":341959,"discussion_content":"我也是，解决了吗？我是啥进程都没有。。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610549076,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1441900,"avatar":"https://static001.geekbang.org/account/avatar/00/16/00/6c/fd4d6399.jpg","nickname":"Dev","note":"","ucode":"D065E2FC4D6A6D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":69238,"discussion_content":"你看看最下面有吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575274513,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1748632,"avatar":"","nickname":"Geek_02edcc","note":"","ucode":"36E494CBF653B7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":62361,"discussion_content":"+1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574836975,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":80889,"user_name":"张曦","can_delete":false,"product_type":"c1","uid":1334417,"ip_address":"","ucode":"65BD84DA17B2E3","user_header":"https://static001.geekbang.org/account/avatar/00/14/5c/91/22b90232.jpg","comment_is_top":false,"comment_ctime":1553749647,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553749647","product_id":100021101,"comment_content":"涨姿势，支持明哥！","like_count":0},{"had_liked":false,"id":77148,"user_name":"一片羽毛","can_delete":false,"product_type":"c1","uid":1357749,"ip_address":"","ucode":"C6B6AA0294219E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTISkR0XDibLuwwl6PibTpQmDrnV7feN1YibqvrnpCE8fVk5cPPuUUxqvW4IZicrmTKXueTW6LpSNrxt4w/132","comment_is_top":false,"comment_ctime":1552871545,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552871545","product_id":100021101,"comment_content":"回去实验下","like_count":0},{"had_liked":false,"id":75879,"user_name":"seven","can_delete":false,"product_type":"c1","uid":1192785,"ip_address":"","ucode":"2E50D567420D65","user_header":"https://static001.geekbang.org/account/avatar/00/12/33/51/9073faa5.jpg","comment_is_top":false,"comment_ctime":1552486963,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552486963","product_id":100021101,"comment_content":"🐮🐮🐮<br>赞了收藏再说！","like_count":0},{"had_liked":false,"id":75516,"user_name":"HI","can_delete":false,"product_type":"c1","uid":1238921,"ip_address":"","ucode":"C65218113883E6","user_header":"https://static001.geekbang.org/account/avatar/00/12/e7/89/207cc841.jpg","comment_is_top":false,"comment_ctime":1552406156,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1552406156","product_id":100021101,"comment_content":"长见识了。。不过对于native的函数还是挺麻烦的，不知道是否有好的办法","like_count":0},{"had_liked":false,"id":75331,"user_name":"奚岩","can_delete":false,"product_type":"c1","uid":1107769,"ip_address":"","ucode":"E7D3A56216EE47","user_header":"https://static001.geekbang.org/account/avatar/00/10/e7/39/b47b1bc0.jpg","comment_is_top":false,"comment_ctime":1552380215,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552380215","product_id":100021101,"comment_content":"文中提到的到 androidxref 下载的源码，是一个个下载么，怎么全部下载呢？<br>官方的 aosp 网站（ https:&#47;&#47;source.android.com&#47;setup&#47;build-numbers.html#source-code-tags-and-builds ）最新的是 8.1 的。","like_count":0},{"had_liked":false,"id":75320,"user_name":"刘伟","can_delete":false,"product_type":"c1","uid":1317862,"ip_address":"","ucode":"B62EF9B5E0C8E1","user_header":"https://static001.geekbang.org/account/avatar/00/14/1b/e6/6a88c8a3.jpg","comment_is_top":false,"comment_ctime":1552378410,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552378410","product_id":100021101,"comment_content":"这两天遇到一个问题：<br>framework.jar 应该就是framework的源码，但是这两天我遇到一个崩溃，这个崩溃打印出来的线程调用栈 和 framework.jar 中反编译的源码不一样，这是为什么呢？<br><br>这个  framework.jar  是我从出现崩溃的手机上导出的<br><br><br><br><br><br><br><br>","like_count":0},{"had_liked":false,"id":75060,"user_name":"张乐","can_delete":false,"product_type":"c1","uid":1411973,"ip_address":"","ucode":"DEDD8B557BA470","user_header":"https://static001.geekbang.org/account/avatar/00/15/8b/85/e50b98f1.jpg","comment_is_top":false,"comment_ctime":1552352869,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552352869","product_id":100021101,"comment_content":"很好的介绍，可以再具体介绍单个模块的？","like_count":0},{"had_liked":false,"id":75020,"user_name":"再前进一点","can_delete":false,"product_type":"c1","uid":1015860,"ip_address":"","ucode":"1F4491037FEBA4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/80/34/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1552351321,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552351321","product_id":100021101,"comment_content":"您好，如果是看一个特定启动流程，是不是得把涉及到的类都copy到studio","like_count":0}]}