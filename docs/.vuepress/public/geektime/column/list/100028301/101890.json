{"id":101890,"title":"13 | [è§†é¢‘]å®æˆ˜ï¼šåŸºäºFFIå®ç°çš„lua-resty-lrucache","content":"<p><video poster=\"https://static001.geekbang.org/resource/image/6a/f7/6ada085b44eddf37506b25ad188541f7.jpg\" preload=\"none\" controls=\"\"><source src=\"https://media001.geekbang.org/customerTrans/fe4a99b62946f2c31c2095c167b26f9c/30d99c0d-16d14089303-0000-0000-01d-dbacd.mp4\" type=\"video/mp4\"><source src=\"https://media001.geekbang.org/2ce11b32e3e740ff9580185d8c972303/a01ad13390fe4afe8856df5fb5d284a2-f2f547049c69fa0d4502ab36d42ea2fa-sd.m3u8\" type=\"application/x-mpegURL\"><source src=\"https://media001.geekbang.org/2ce11b32e3e740ff9580185d8c972303/a01ad13390fe4afe8856df5fb5d284a2-2528b0077e78173fd8892de4d7b8c96d-hd.m3u8\" type=\"application/x-mpegURL\"></video></p><p>ä½ å¥½ï¼Œæˆ‘æ˜¯æ¸©é“­ã€‚</p><p>ä»Šå¤©çš„å†…å®¹ï¼Œæˆ‘åŒæ ·ä¼šä»¥è§†é¢‘çš„å½¢å¼æ¥è®²è§£ã€‚ä¸è¿‡ï¼Œåœ¨ä½ è¿›è¡Œè§†é¢‘å­¦ä¹ ä¹‹å‰ï¼Œæˆ‘æƒ³å…ˆé—®ä½ è¿™ä¹ˆå‡ ä¸ªé—®é¢˜ï¼š</p><ul>\n<li>lua-resty-lrucache å†…éƒ¨æœ€é‡è¦çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ</li>\n<li>lua-resty-lrucache æœ‰ä¸¤ç§ FFI çš„å®ç°ï¼Œæˆ‘ä»¬ä»Šå¤©è®²çš„è¿™ä¸€ç§æ›´é€‚åˆä»€ä¹ˆåœºæ™¯ï¼Ÿ</li>\n</ul><p>è¿™å‡ ä¸ªé—®é¢˜ï¼Œä¹Ÿæ˜¯ä»Šå¤©è§†é¢‘è¯¾è¦è§£å†³çš„æ ¸å¿ƒå†…å®¹ï¼Œå¸Œæœ›ä½ å¯ä»¥å…ˆè‡ªå·±æ€è€ƒä¸€ä¸‹ï¼Œå¹¶å¸¦ç€é—®é¢˜æ¥å­¦ä¹ ä»Šå¤©çš„è§†é¢‘å†…å®¹ã€‚</p><p>åŒæ—¶ï¼Œæˆ‘ä¼šç»™å‡ºç›¸åº”çš„æ–‡å­—ä»‹ç»ï¼Œæ–¹ä¾¿ä½ åœ¨å¬å®Œè§†é¢‘å†…å®¹åï¼ŒåŠæ—¶æ€»ç»“ä¸å¤ä¹ ã€‚ä¸‹é¢æ˜¯ä»Šå¤©è¿™èŠ‚è¯¾çš„æ–‡å­—ä»‹ç»éƒ¨åˆ†ã€‚</p><h2>ä»Šæ—¥æ ¸å¿ƒ</h2><p><a href=\"https://github.com/openresty/lua-resty-lrucache\">lua-resty-lrucache</a> æ˜¯ä¸€ä¸ªä½¿ç”¨ LuaJIT FFI å®ç°çš„ LRU ç¼“å­˜åº“ï¼Œå¯ä»¥åœ¨ worker å†…ç¼“å­˜å„ç§ç±»å‹çš„æ•°æ®ã€‚åŠŸèƒ½ä¸ä¹‹ç±»ä¼¼çš„æ˜¯ shared dictï¼Œä½† shared dict åªèƒ½å­˜å‚¨å­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®ã€‚åœ¨å¤§å¤šæ•°å®é™…æƒ…å†µä¸‹ï¼Œè¿™ä¸¤ç§ç¼“å­˜æ˜¯é…åˆåœ¨ä¸€èµ·ä½¿ç”¨çš„â€”â€”lrucache ä½œä¸ºä¸€çº§ç¼“å­˜ï¼Œshared dict ä½œä¸ºäºŒçº§ç¼“å­˜ã€‚</p><p>lrucache çš„å®ç°ï¼Œå¹¶æ²¡æœ‰æ¶‰åŠåˆ° OpenResty çš„ Lua APIã€‚æ‰€ä»¥ï¼Œå³ä½¿ä½ ä»¥å‰æ²¡æœ‰ç”¨è¿‡OpenRestyï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªé¡¹ç›®æ¥å­¦ä¹ å¦‚ä½•ä½¿ç”¨ LuaJIT çš„ FFIã€‚</p><p>lrucache ä»“åº“ä¸­åŒ…å«äº†ä¸¤ç§å®ç°æ–¹æ¡ˆï¼Œä¸€ç§æ˜¯ä½¿ç”¨ Lua table æ¥å®ç°ç¼“å­˜ï¼Œå¦å¤–ä¸€ç§åˆ™æ˜¯ä½¿ç”¨ hash è¡¨æ¥å®ç°ã€‚å‰è€…æ›´é€‚åˆå‘½ä¸­ç‡é«˜çš„æƒ…å†µï¼Œåè€…é€‚åˆå‘½ä¸­ç‡ä½çš„æƒ…å†µã€‚ä¸¤ä¸ªæ–¹æ¡ˆæ²¡æœ‰å“ªä¸ªæ›´å¥½ï¼Œè¦çœ‹ä½ çš„çº¿ä¸Šç¯å¢ƒæ›´é€‚åˆå“ªä¸€ä¸ªã€‚</p><!-- [[[read_end]]] --><p>é€šè¿‡ä»Šå¤©è¿™ä¸ªé¡¹ç›®ï¼Œä½ å¯ä»¥å¼„æ¸…æ¥šè¦å¦‚ä½•ä½¿ç”¨ FFIï¼Œå¹¶äº†è§£ä¸€ä¸ªå®Œæ•´çš„ lua-resty åº“åº”è¯¥åŒ…æ‹¬å“ªäº›å¿…è¦çš„å†…å®¹ã€‚å½“ç„¶ï¼Œæˆ‘é¡ºé“ä¹Ÿä¼šä»‹ç»ä¸‹ travis çš„ä½¿ç”¨ã€‚</p><p>æœ€åï¼Œè¿˜æ˜¯æƒ³å¼ºè°ƒä¸€ç‚¹ï¼Œåœ¨ä½ é¢å¯¹ä¸€ä¸ªé™Œç”Ÿçš„å¼€æºé¡¹ç›®æ—¶ï¼Œæ–‡æ¡£å’Œæµ‹è¯•æ¡ˆä¾‹æ°¸è¿œæ˜¯æœ€å¥½çš„ä¸Šæ‰‹æ–¹å¼ã€‚è€Œä½ åæœŸå¦‚æœè¦é˜…è¯»æºç ï¼Œä¹Ÿä¸è¦å…ˆå»æŠ ç»†èŠ‚ï¼Œè€Œæ˜¯åº”è¯¥å…ˆå»çœ‹ä¸»è¦çš„æ•°æ®ç»“æ„ï¼Œå›´ç»•é‡ç‚¹é€å±‚æ·±å…¥ã€‚</p><h2>è¯¾ä»¶å‚è€ƒ</h2><p>ä»Šå¤©çš„è¯¾ä»¶å·²ç»ä¸Šä¼ åˆ°äº†æˆ‘çš„GitHubä¸Šï¼Œä½ å¯ä»¥è‡ªå·±ä¸‹è½½å­¦ä¹ ã€‚</p><p>é“¾æ¥å¦‚ä¸‹ï¼š<a href=\"https://github.com/iresty/geektime-slides\">https://github.com/iresty/geektime-slides</a></p><p>å¦‚æœæœ‰ä¸æ¸…æ¥šçš„åœ°æ–¹ï¼Œä½ å¯ä»¥åœ¨ç•™è¨€åŒºæé—®ï¼Œå¦ä¹Ÿå¯ä»¥åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„å­¦ä¹ å¿ƒå¾—ã€‚æœŸå¾…ä¸ä½ çš„å¯¹è¯ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„åŒäº‹ã€æœ‹å‹ï¼Œæˆ‘ä»¬ä¸€èµ·äº¤æµã€ä¸€èµ·è¿›æ­¥ã€‚</p>","comments":[{"had_liked":false,"id":108677,"user_name":"LeonğŸ“·","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1561848567,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"35921586935","product_id":100028301,"comment_content":"ä¸“æ è®¢é˜…äººå¥½å°‘ï¼Œè·Ÿé™¶è¾‰è€å¸ˆçš„nginxä¸€æ ·ï¼Œåˆ°åé¢éƒ½æ²¡ä»€ä¹ˆäººç•™è¨€äº†ï¼Œæ›²é«˜å’Œå¯¡ï¼Œä¸è¿‡ç•™ä¸‹æ¥çš„éƒ½æ˜¯æœªæ¥çš„å¤§ç‰›ï¼Œå­¦å¥½äº†æœªæ¥åœ¨å·¥ä½œå’Œæ±‚èŒè¿‡ç¨‹ä¸­å¤šäº†ä¸€ä»½ç«äº‰åŠ›","like_count":9},{"had_liked":false,"id":106558,"user_name":"ä¸¢äº†ä¸ªä¸¢ä¸¢ä¸¢","can_delete":false,"product_type":"c1","uid":1165037,"ip_address":"","ucode":"BDD7E97E0E5E96","user_header":"https://static001.geekbang.org/account/avatar/00/11/c6/ed/89a2dc13.jpg","comment_is_top":false,"comment_ctime":1561344097,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14446245985","product_id":100028301,"comment_content":"è€å¸ˆè®²çš„å¥½å¥½å“¦ï¼ï¼ï¼","like_count":3,"discussions":[{"author":{"id":1165037,"avatar":"https://static001.geekbang.org/account/avatar/00/11/c6/ed/89a2dc13.jpg","nickname":"ä¸¢äº†ä¸ªä¸¢ä¸¢ä¸¢","note":"","ucode":"BDD7E97E0E5E96","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":229,"discussion_content":"ç»§ç»­æ”¯æŒè€å¸ˆï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561344132,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":107414,"user_name":"yswang","can_delete":false,"product_type":"c1","uid":1023688,"ip_address":"","ucode":"B9CB98838B215C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9e/c8/d261f700.jpg","comment_is_top":false,"comment_ctime":1561532396,"is_pvip":false,"replies":[{"id":"38893","content":"æœ‰ä¸€ä¸ª ffmpeg çš„åº“ï¼šhttps:&#47;&#47;github.com&#47;daurnimator&#47;ffmpeg-lua-ffiï¼Œä½ å¯ä»¥è¯•ä¸‹æ˜¯å¦æ»¡è¶³éœ€æ±‚","user_name":"ä½œè€…å›å¤","comment_id":107414,"uid":"1017955","ip_address":"","utype":1,"ctime":1561550044,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":2,"race_medal":0,"score":"10151466988","product_id":100028301,"comment_content":"æ¸©å¤§ï¼Œæˆ‘ä¹‹å‰ä½¿ç”¨ openresty + ffmpeg åšäº†ä¸€ä¸ªéŸ³é¢‘æ ¼å¼æ¢è¡ŒhttpæœåŠ¡ï¼Œæˆ‘ä½¿ç”¨å…ˆå†™ä¸€ä¸ª shell è½¬æ¢è„šæœ¬æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼šaudio_converter.sh (shæ–‡ä»¶ä¸­è°ƒç”¨ ffmepg -i è½¬æ¢å‘½ä»¤)ï¼Œç„¶åä½¿ç”¨ lua çš„ os.execute(&quot;&#47;bin&#47;sh audio_converter.sh  a.mp3  b.ogg&quot;) æ¥è°ƒç”¨ shell è„šæœ¬æ–‡ä»¶é—´æ¥è°ƒç”¨  ffmpeg æŒ‡ä»¤è¿›è¡Œè½¬æ¢ã€‚ ä»Šå¤©çœ‹åˆ°äº† ffi ï¼Œffi å¯ä»¥è°ƒç”¨ C å‡½æ•°ï¼Œè¯·é—®ï¼Œffi å¯ä»¥ç›´æ¥è°ƒç”¨ ffmpeg æŒ‡ä»¤å—ï¼Ÿå¦‚æœå¯ä»¥çš„è¯ï¼Œæˆ‘å°±å¯ä»¥çœå»å†™ä¸€ä¸ª shell æ–‡ä»¶æ¥é—´æ¥è°ƒç”¨äº†ã€‚","like_count":2,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455502,"discussion_content":"æœ‰ä¸€ä¸ª ffmpeg çš„åº“ï¼šhttps://github.com/daurnimator/ffmpeg-lua-ffiï¼Œä½ å¯ä»¥è¯•ä¸‹æ˜¯å¦æ»¡è¶³éœ€æ±‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1561550044,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1545484,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/jaOQZZRldayELmckBTq4VQHUgepwn8ibSLuEEB0NNwRnMyIqRRPj3ms38cjj3ySicEzkruV44lxDMdbdgUkn6ibTg/132","nickname":"Geek_e59303","note":"","ucode":"C136BDB95D8A95","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":48953,"discussion_content":"è¿™ä¸ªåº“8å¹´å‰äº†ï¼ŒORè¿˜æ²¡è¯ç”ŸæŠŠ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573539933,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":251855,"user_name":"æ²ˆåº·","can_delete":false,"product_type":"c1","uid":1611025,"ip_address":"","ucode":"02AFA50738AB8E","user_header":"https://static001.geekbang.org/account/avatar/00/18/95/11/eb431e52.jpg","comment_is_top":false,"comment_ctime":1601909632,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601909632","product_id":100028301,"comment_content":"HAHAï¼Œåˆšå­¦å®Œé™¶è¾‰è€å¸ˆçš„nginxï¼Œè·ƒè·ƒæ¬²è¯•å•Š","like_count":0},{"had_liked":false,"id":229168,"user_name":"dhf","can_delete":false,"product_type":"c1","uid":1113370,"ip_address":"","ucode":"E31FFCF9ED6BD9","user_header":"https://static001.geekbang.org/account/avatar/00/10/fd/1a/be30769f.jpg","comment_is_top":false,"comment_ctime":1592914343,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592914343","product_id":100028301,"comment_content":"getæ–¹æ³•é‡Œç»´æŠ¤lruçš„æ—¶å€™ï¼Œä¸éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨å—","like_count":0},{"had_liked":false,"id":135568,"user_name":"å¾®ä¼—_å»–å«å†›","can_delete":false,"product_type":"c1","uid":1253058,"ip_address":"","ucode":"F08868420CCE7C","user_header":"https://static001.geekbang.org/account/avatar/00/13/1e/c2/7e67107f.jpg","comment_is_top":false,"comment_ctime":1569215646,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569215646","product_id":100028301,"comment_content":"æ¸©é“­è€å¸ˆï¼Œæ‚¨å¥½ï¼ FFIè°ƒç”¨è‡ªå·±å°è£…çš„å‡½æ•°åº“ï¼Œffi.load(name[,global])ï¼Œæ˜¯å¦åªèƒ½æ˜¯åŠ¨æ€åº“ï¼Ÿä¸èƒ½è°ƒç”¨é™æ€åº“å—ï¼Ÿ  è°¢è°¢ï¼","like_count":0},{"had_liked":false,"id":113972,"user_name":"chrisforbt","can_delete":false,"product_type":"c1","uid":1600999,"ip_address":"","ucode":"CA000E8A615001","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/z5OUcd5RD7gMIevhHORHFcQsXNlZ4UxIU2jS6UwyUIM0w0nXI57nZKCXsibmN2o71WLtg5YXuJKeMNkItEzEaGg/132","comment_is_top":false,"comment_ctime":1563196925,"is_pvip":false,"replies":[{"id":"41587","content":"ä½ è¿™ç§æ˜¯ä¸»åŠ¨æ›´æ–°ï¼ŒMySQL æ•°æ®å˜åŒ–åä¸»åŠ¨é€šçŸ¥å‰é¢çš„ç¼“å­˜ã€‚ä¸»åŠ¨æ›´æ–°çš„è¯ï¼Œä¹Ÿä¸ç”¨ä¸»åŠ¨å»åˆ é™¤ç¼“å­˜ï¼Œè€Œæ˜¯åœ¨ key é‡Œé¢åŠ å…¥ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ•°æ®å˜åŒ–åç‰ˆæœ¬å·å˜äº†ï¼Œé‚£ä¹ˆåœ¨ç¼“å­˜ä¸­å°±æŸ¥æ‰¾ä¸åˆ°æ•°æ®ï¼Œè¿™æ—¶å€™å°±å›æºåˆ° MySQL äº†ã€‚<br>ä¹Ÿå¯ä»¥è¢«åŠ¨æ›´æ–°ï¼Œæ ¹æ®ä½ çš„ä¸šåŠ¡ç‰¹æ€§ï¼Œç»™ç¼“å­˜è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œå®šæœŸçš„å»æ•°æ®åº“æŸ¥è¯¢ã€‚<br>ç¬¬ä¸€ç§ç‰ˆæœ¬å·çš„æ–¹æ³•æ˜¯æ¯”è¾ƒåˆé€‚çš„ï¼Œå½“ç„¶å®ç°èµ·æ¥æ¯”è¢«åŠ¨æ›´æ–°å¤æ‚ä¸€äº›ã€‚","user_name":"ä½œè€…å›å¤","comment_id":113972,"uid":"1017955","ip_address":"","utype":1,"ctime":1563238530,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"1563196925","product_id":100028301,"comment_content":"è€å¸ˆï¼Œæˆ‘æƒ³é—®ä¸ªé—®é¢˜ã€‚æˆ‘è®¡åˆ’å°†ç”¨æˆ·è¯·æ±‚çš„å‚æ•°+è·¯å¾„+æ–¹å¼åšä¸ºkeyï¼ŒæŠŠæ•°æ®å­˜åœ¨lru-cacheã€share dictä»¥åŠredisä¸­ï¼Œmysqlæ•°æ®æºæ›´æ–°äº†ï¼Œæˆ‘å°±å¾—å°†ç¼“å­˜å…¨åˆ äº†ã€‚é‚£æˆ‘æ˜¯åº”è¯¥æŠŠmysqlçš„æ•°æ®æºå’Œå‰é¢ç”Ÿæˆçš„keyå…³è”èµ·æ¥ï¼Œä¸€æ—¦æ›´æ–°äº†æ•°æ®æºï¼Œå°±å»æ‰¾ç›¸å…³çš„keyï¼Œå°†å…¶åˆ é™¤å—ï¼Ÿè¿˜æœ‰æ›´ä½³çš„ç¼“å­˜æ›´æ–°æ–¹å¼å—ï¼ŒæœŸå¾…æ‚¨çš„å›å¤ã€‚","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458461,"discussion_content":"ä½ è¿™ç§æ˜¯ä¸»åŠ¨æ›´æ–°ï¼ŒMySQL æ•°æ®å˜åŒ–åä¸»åŠ¨é€šçŸ¥å‰é¢çš„ç¼“å­˜ã€‚ä¸»åŠ¨æ›´æ–°çš„è¯ï¼Œä¹Ÿä¸ç”¨ä¸»åŠ¨å»åˆ é™¤ç¼“å­˜ï¼Œè€Œæ˜¯åœ¨ key é‡Œé¢åŠ å…¥ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ•°æ®å˜åŒ–åç‰ˆæœ¬å·å˜äº†ï¼Œé‚£ä¹ˆåœ¨ç¼“å­˜ä¸­å°±æŸ¥æ‰¾ä¸åˆ°æ•°æ®ï¼Œè¿™æ—¶å€™å°±å›æºåˆ° MySQL äº†ã€‚\nä¹Ÿå¯ä»¥è¢«åŠ¨æ›´æ–°ï¼Œæ ¹æ®ä½ çš„ä¸šåŠ¡ç‰¹æ€§ï¼Œç»™ç¼“å­˜è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œå®šæœŸçš„å»æ•°æ®åº“æŸ¥è¯¢ã€‚\nç¬¬ä¸€ç§ç‰ˆæœ¬å·çš„æ–¹æ³•æ˜¯æ¯”è¾ƒåˆé€‚çš„ï¼Œå½“ç„¶å®ç°èµ·æ¥æ¯”è¢«åŠ¨æ›´æ–°å¤æ‚ä¸€äº›ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563238530,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112487,"user_name":"emen","can_delete":false,"product_type":"c1","uid":1106898,"ip_address":"","ucode":"A3C0A2BF95A272","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJrvZAOiahN7YnSviaDANNu1uHIvQEEE8icl9libuibhuIZgEOt28KG2jKYqu6uRNILicibb8jM6icHicUXj0A/132","comment_is_top":false,"comment_ctime":1562744881,"is_pvip":false,"replies":[{"id":"41188","content":"æ”¹ç”¨ shared dictï¼Œæˆ–è€…æ˜¯ä½¿ç”¨ lua-resty-worker-event è¿™æ ·çš„åº“","user_name":"ä½œè€…å›å¤","comment_id":112487,"uid":"1017955","ip_address":"","utype":1,"ctime":1562909913,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"1562744881","product_id":100028301,"comment_content":"æ¸©é“­è€å¸ˆæ‚¨å¥½ï¼Œå…³äºlrucacheåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­æœ‰ä¸ªç–‘æƒ‘çƒ¦è¯·è€å¸ˆçœ‹çœ‹ã€‚<br>openrestyç¯å¢ƒï¼š1ä¸ªmasterè¿›ç¨‹ã€Xä¸ªworkerè¿›ç¨‹<br>åœ¨init_workeré˜¶æ®µä¸­æ³¨å†Œäº†ç¼“å­˜ä¿¡æ¯å¦‚ï¼šcache.set(&quot;key1&quot;,&quot;val1&quot;)<br>åœ¨contenté˜¶æ®µä¿®æ”¹äº†ç¼“å­˜ä¿¡æ¯ï¼šcache.set(&quot;key1&quot;,&quot;val2&quot;)<br>æ­¤æ“ä½œæ˜¯å¦ä»…ä¸ºæ›´æ–°äº†å½“å‰workerçš„ç¼“å­˜ä¿¡æ¯ï¼Œè€Œæ— æ³•è·¨workeræ›´æ–°ã€‚<br>å¦‚éœ€å®Œæˆè·¨workeræ›´æ–°åº”å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457759,"discussion_content":"æ”¹ç”¨ shared dictï¼Œæˆ–è€…æ˜¯ä½¿ç”¨ lua-resty-worker-event è¿™æ ·çš„åº“","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562909913,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110236,"user_name":"æ˜Ÿäº¦è¾°","can_delete":false,"product_type":"c1","uid":1284592,"ip_address":"","ucode":"B0388FBFFDEE7E","user_header":"https://static001.geekbang.org/account/avatar/00/13/99/f0/d9343049.jpg","comment_is_top":false,"comment_ctime":1562212357,"is_pvip":true,"replies":[{"id":"40927","content":"OpenResty ä¸­çš„ worker æ˜¯äº’ç›¸ç‹¬ç«‹çš„ï¼Œå¦‚æœä½ åœ¨ worker ä¸­ä½¿ç”¨ ffi.load æ¥åŠ è½½ soï¼Œé‚£ä¹ˆæœ‰å‡ ä¸ª worker è¿›ç¨‹ï¼Œå°±ä¼šæœ‰å‡ ä¸ª so å®ä¾‹ã€‚","user_name":"ä½œè€…å›å¤","comment_id":110236,"uid":"1017955","ip_address":"","utype":1,"ctime":1562746370,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"1562212357","product_id":100028301,"comment_content":"è¯·æ•™è€å¸ˆä¸€ä¸ªé—®é¢˜ã€‚<br><br>æˆ‘ç”¨cè¯­è¨€å®ç°äº†è·¨å¹³å°çš„soç±»åº“ã€‚ ç”¨ffi.load æ¥åŠ è½½ã€‚ <br>é‚£ä¹ˆï¼Œåœ¨openrestry ä¸­ä¼šæœ‰å‡ ä¸ª so å‡½æ•°çš„å®ä¾‹å‘¢ï¼Ÿ <br>æŒ‰ç…§æ“ä½œç³»ç»Ÿçš„çŸ¥è¯†,å…±äº«åº“åœ¨ç³»ç»Ÿä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚<br><br>å¦‚æœåªæœ‰ä¸€ä¸ªï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨ä¸åŒçš„worker ä¸­è°ƒç”¨so é‡Œçš„å‡½æ•°ä¸­ï¼Œå¯¹äºä¸€ä¸ªso å†…çš„èµ„æºæ˜¯å¦å­˜åœ¨å†²çªå‘¢ï¼Ÿ ","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456784,"discussion_content":"OpenResty ä¸­çš„ worker æ˜¯äº’ç›¸ç‹¬ç«‹çš„ï¼Œå¦‚æœä½ åœ¨ worker ä¸­ä½¿ç”¨ ffi.load æ¥åŠ è½½ soï¼Œé‚£ä¹ˆæœ‰å‡ ä¸ª worker è¿›ç¨‹ï¼Œå°±ä¼šæœ‰å‡ ä¸ª so å®ä¾‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562746370,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109689,"user_name":"å°é£å“¥ â€è¶…ç´šæœƒå“¡","can_delete":false,"product_type":"c1","uid":1110049,"ip_address":"","ucode":"417F9563B3005B","user_header":"https://static001.geekbang.org/account/avatar/00/10/f0/21/104b9565.jpg","comment_is_top":false,"comment_ctime":1562077300,"is_pvip":false,"replies":[{"id":"40928","content":"æˆ‘çš„ç†è§£ï¼ŒOpenResty çš„å¤æ‚æ€§åœ¨äºå„ä¸ªå­é¡¹ç›®ä¹‹é—´çš„é…åˆï¼Œè¿˜æ˜¯éœ€è¦æœ‰ç‰¹å®šçš„åœºæ™¯å’Œä¸šåŠ¡éœ€æ±‚æ¥é©±åŠ¨ï¼Œæ‰ä¼šæ›´æœ‰æ„Ÿè§‰ã€‚ä½ å¯ä»¥å‚ä¸åˆ° OpenResty ç›¸å…³çš„å¼€æºé¡¹ç›®ä¸­æ¥ï¼Œåˆ‡èº«ä½“ä¼šä¸‹ã€‚","user_name":"ä½œè€…å›å¤","comment_id":109689,"uid":"1017955","ip_address":"","utype":1,"ctime":1562746479,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"1562077300","product_id":100028301,"comment_content":"éƒ½æœ‰è§†é¢‘äº†ï¼Œæ¸©è€å¸ˆï¼Œèƒ½å¦ç°åœºæ¼”ç¤ºä¸€ä¸‹ï¼Œ è®©æˆ‘ä»¬è§è¯† openresty çš„å¤æ‚æ€§ã€‚ ä¸€äº›æ–‡æ¡£åº“ å®˜ç½‘æè¿°ç­‰ï¼Œèƒ½å¦ç°åœºæ‰“å¼€äº†è§£ä¸‹ã€‚  æˆ‘ä»¬è‡ªå·±æ‰“å¼€åï¼Œå°±æ²¡æœ‰ç„¶åäº†ã€‚","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456516,"discussion_content":"æˆ‘çš„ç†è§£ï¼ŒOpenResty çš„å¤æ‚æ€§åœ¨äºå„ä¸ªå­é¡¹ç›®ä¹‹é—´çš„é…åˆï¼Œè¿˜æ˜¯éœ€è¦æœ‰ç‰¹å®šçš„åœºæ™¯å’Œä¸šåŠ¡éœ€æ±‚æ¥é©±åŠ¨ï¼Œæ‰ä¼šæ›´æœ‰æ„Ÿè§‰ã€‚ä½ å¯ä»¥å‚ä¸åˆ° OpenResty ç›¸å…³çš„å¼€æºé¡¹ç›®ä¸­æ¥ï¼Œåˆ‡èº«ä½“ä¼šä¸‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562746479,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":107237,"user_name":". ã€‚o O ã€‡","can_delete":false,"product_type":"c1","uid":1544980,"ip_address":"","ucode":"C1E75E940A0B02","user_header":"https://static001.geekbang.org/account/avatar/00/17/93/14/7e078b32.jpg","comment_is_top":false,"comment_ctime":1561507416,"is_pvip":false,"replies":[{"id":"38910","content":"è¿™ä¸ªæ²¡æœ‰é‡åˆ°è¿‡ã€‚æ˜¯å¦æ˜¯è¿™ä¸ª bugï¼šhttps:&#47;&#47;github.com&#47;openresty&#47;luajit2&#47;issues&#47;42ï¼Ÿ ç”¨æœ€æ–°çš„ OpenResty ç‰ˆæœ¬æ˜¯å¦å¯ä»¥é‡ç°å‘¢ï¼Ÿ<br>å¦‚æœè¿˜æ˜¯æœ‰é—®é¢˜ï¼Œæ¬¢è¿ç»™å®˜æ–¹æäº¤ issue","user_name":"ä½œè€…å›å¤","comment_id":107237,"uid":"1017955","ip_address":"","utype":1,"ctime":1561551745,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":2,"race_medal":0,"score":"1561507416","product_id":100028301,"comment_content":"è€å¸ˆå¥½ï¼Œæˆ‘ç¢°åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ç”¨çš„lrucacheï¼Œä¼šå¡åœ¨get seté‚£ï¼Œå¹¶ä¸”workerè¿›ç¨‹cpu100%ï¼Œæ•´ä¸ªworkerä¸å·¥ä½œã€‚æ¢æˆlrucache.pureffiå°±å¥½äº†ï¼Œä¸çŸ¥é“è€å¸ˆç¢°åˆ°è¿‡æ²¡","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455433,"discussion_content":"è¿™ä¸ªæ²¡æœ‰é‡åˆ°è¿‡ã€‚æ˜¯å¦æ˜¯è¿™ä¸ª bugï¼šhttps://github.com/openresty/luajit2/issues/42ï¼Ÿ ç”¨æœ€æ–°çš„ OpenResty ç‰ˆæœ¬æ˜¯å¦å¯ä»¥é‡ç°å‘¢ï¼Ÿ\nå¦‚æœè¿˜æ˜¯æœ‰é—®é¢˜ï¼Œæ¬¢è¿ç»™å®˜æ–¹æäº¤ issue","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561551745,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1544980,"avatar":"https://static001.geekbang.org/account/avatar/00/17/93/14/7e078b32.jpg","nickname":". ã€‚o O ã€‡","note":"","ucode":"C1E75E940A0B02","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":569,"discussion_content":"ä¸æ˜¯ï¼Œæ˜¯https://github.com/openresty/lua-resty-lrucache/issues/39è¿™ä¸ªï¼Œopenrestyç”¨çš„1.13.6.2","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561710638,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":106682,"user_name":"å†°æ²å®‡è¯º","can_delete":false,"product_type":"c1","uid":1104553,"ip_address":"","ucode":"77951251EE6D78","user_header":"https://static001.geekbang.org/account/avatar/00/10/da/a9/8fdfff70.jpg","comment_is_top":false,"comment_ctime":1561371612,"is_pvip":false,"replies":[{"id":"38908","content":"å¯ä»¥çš„ï¼Œåœ¨è¿™ä¸ªé˜¶æ®µå¯åŠ¨ä¸€ä¸ª timer å»è¯»å–æ•°æ®åº“ï¼Œç„¶åæ”¾åˆ° shared dict ä¸­ã€‚ä½†è¦æ³¨æ„ï¼Œè¿™ä¸ªæ•°æ®æ˜¯å¯ä»¥ä¸¢å¤±çš„ï¼Œä»£ç ä¸­è¦å¤„ç†è¿™ç§å¼‚å¸¸ã€‚","user_name":"ä½œè€…å›å¤","comment_id":106682,"uid":"1017955","ip_address":"","utype":1,"ctime":1561551509,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"1561371612","product_id":100028301,"comment_content":"è€å¸ˆï¼Œå¦‚æœæˆ‘æƒ³ä»æ•°æ®åº“ä¸­åˆå§‹åŒ–ä¸€äº›åŸºæœ¬ä¸å˜çš„æ•°æ®åˆ°shared_dictä¸­ï¼Œåº”è¯¥æ€ä¹ˆåšï¼Œinit_by_lua é˜¶æ®µå¯ä»¥å—","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455175,"discussion_content":"å¯ä»¥çš„ï¼Œåœ¨è¿™ä¸ªé˜¶æ®µå¯åŠ¨ä¸€ä¸ª timer å»è¯»å–æ•°æ®åº“ï¼Œç„¶åæ”¾åˆ° shared dict ä¸­ã€‚ä½†è¦æ³¨æ„ï¼Œè¿™ä¸ªæ•°æ®æ˜¯å¯ä»¥ä¸¢å¤±çš„ï¼Œä»£ç ä¸­è¦å¤„ç†è¿™ç§å¼‚å¸¸ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561551509,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}