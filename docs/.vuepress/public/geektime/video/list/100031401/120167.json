{"id":120167,"title":"61 | 手工服务部署和测试(下)","content":"<ul>\n<li>\n<p>代码：<a href=\"https://gitee.com/geektime-geekbang/staffjoy\">https://gitee.com/geektime-geekbang/staffjoy</a></p>\n</li>\n<li>\n<p>课件：<a href=\"https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ\">https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ</a> 提取码: 1aeh</p>\n</li>\n</ul>","comments":[{"had_liked":false,"id":149384,"user_name":"ZOU志伟","can_delete":false,"product_type":"c3","uid":1029179,"ip_address":"","ucode":"439779871CC992","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b4/3b/a1f7e3a4.jpg","comment_is_top":false,"comment_ctime":1573205973,"is_pvip":false,"replies":[{"id":57427,"content":"你好，Staffjoy的前端构建是要求Linux或者Mac环境的，Windows环境暂不支持。如果是Windows环境，有几个办法可以尝试：\n\n1. 安装Linux虚拟机(比如用Vagrant），在虚拟机里头构建。\n2. 有学员给出了一个在windows构建的修复方案(https:&#47;&#47;github.com&#47;spring2go&#47;staffjoy&#47;issues&#47;6)，可以尝试下\n3. 跳过构建，直接用波波已经打好的镜像(https:&#47;&#47;hub.docker.com&#47;u&#47;boboweike)，构建实际就是生成静态的html&#47;js文件，然后放在nginx目录下，打成镜像，这步骤理解即可，没必要完全动手操作。\n\n另外，如果在Linux或者Mac环境，也要求网络良好，github可以正常访问，因为Staffjoy的前端构建需要到github上下载sass编译库。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1573212648,"ip_address":"","comment_id":149384,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"运行app单页应用是报这个错： Error: Cannot resolve module &#39;npm-zepto&#39;，怎么破？","like_count":3,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473841,"discussion_content":"你好，Staffjoy的前端构建是要求Linux或者Mac环境的，Windows环境暂不支持。如果是Windows环境，有几个办法可以尝试：\n\n1. 安装Linux虚拟机(比如用Vagrant），在虚拟机里头构建。\n2. 有学员给出了一个在windows构建的修复方案(https://github.com/spring2go/staffjoy/issues/6)，可以尝试下\n3. 跳过构建，直接用波波已经打好的镜像(https://hub.docker.com/u/boboweike)，构建实际就是生成静态的html/js文件，然后放在nginx目录下，打成镜像，这步骤理解即可，没必要完全动手操作。\n\n另外，如果在Linux或者Mac环境，也要求网络良好，github可以正常访问，因为Staffjoy的前端构建需要到github上下载sass编译库。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573212648,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1115232,"avatar":"https://static001.geekbang.org/account/avatar/00/11/04/60/64d166b6.jpg","nickname":"Fan","note":"","ucode":"3BF28670FD9407","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":595859,"discussion_content":"在windows 上可以使用 webpack-zepto替换npm-zepto。\n\nhttps://github.com/Nytramr/npm-zepto/issues/4","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1670411894,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"中国香港","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1115232,"avatar":"https://static001.geekbang.org/account/avatar/00/11/04/60/64d166b6.jpg","nickname":"Fan","note":"","ucode":"3BF28670FD9407","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":595857,"discussion_content":"package.json中 &#34;npm-zepto&#34;: &#34;^1.1.7&#34;, 更新下版本。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1670410735,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"中国香港","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":131881,"user_name":"Nero","can_delete":false,"product_type":"c3","uid":1175079,"ip_address":"","ucode":"BEAE3A8AADDD67","user_header":"https://static001.geekbang.org/account/avatar/00/11/ee/27/5b15fa63.jpg","comment_is_top":false,"comment_ctime":1567948798,"is_pvip":false,"replies":[{"id":50477,"content":"你好，我尝试了一下发给我163的邮箱，用默认的FROM = &quot;staffjoy@dm.staffjoy.xyz&quot;，是可以收到的。\n\nStaffjoy发邮件用的是阿里云DirectMail服务，可能这个发信地址是和我的阿里云账户绑定的，如果你要改设自己的DirectMail的发信邮箱，有点麻烦，参考：https:&#47;&#47;help.aliyun.com&#47;document_detail&#47;29426.html?spm=a2c4g.11186623.6.557.54485748dBWkAp\n\n如果发不了邮件的话，有一个小技巧可以绕过，如果注册邮件发不成功，代码会抛和log一个异常(邮件发送失败都会发异常日志)，这个异常里头有激活邮件连接，把这个链接贴到浏览器就可以激活了。其它邮件信息都可以通过异常日志看。\n\n另外，非生产环境，邮件只能发给指定邮箱后缀的用户，这个在mail-api的MailConstant中可以改代码常量STAFFJOY_EMAIL_SUFFIX，默认发给STAFFJOY_EMAIL_SUFFIX = &quot;@jskillcloud.com&quot;","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1568028873,"ip_address":"","comment_id":131881,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"波波老师，我注册时候发邮件报下面的错误，目前没找到版本解决，能否帮忙看下。\n\ncom.aliyuncs.exceptions.ClientException: InvalidUser.NotFound : The specified user does not found.\nRequestId : E65185BE-15D8-4CAF-BE4D-81A20E9FE8F5\n\tat com.aliyuncs.DefaultAcsClient.parseAcsResponse(DefaultAcsClient.java:151)\n\tat com.aliyuncs.DefaultAcsClient.getAcsResponse(DefaultAcsClient.java:96)\n\tat xyz.staffjoy.mail.service.MailSendService.sendMailAsync(MailSendService.java:67)\n\tat xyz.staffjoy.mail.service.MailSendService$$FastClassBySpringCGLIB$$94ad016b.invoke(&lt;generated&gt;)\n\tat org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466662,"discussion_content":"你好，我尝试了一下发给我163的邮箱，用默认的FROM = &amp;quot;staffjoy@dm.staffjoy.xyz&amp;quot;，是可以收到的。\n\nStaffjoy发邮件用的是阿里云DirectMail服务，可能这个发信地址是和我的阿里云账户绑定的，如果你要改设自己的DirectMail的发信邮箱，有点麻烦，参考：https://help.aliyun.com/document_detail/29426.html?spm=a2c4g.11186623.6.557.54485748dBWkAp\n\n如果发不了邮件的话，有一个小技巧可以绕过，如果注册邮件发不成功，代码会抛和log一个异常(邮件发送失败都会发异常日志)，这个异常里头有激活邮件连接，把这个链接贴到浏览器就可以激活了。其它邮件信息都可以通过异常日志看。\n\n另外，非生产环境，邮件只能发给指定邮箱后缀的用户，这个在mail-api的MailConstant中可以改代码常量STAFFJOY_EMAIL_SUFFIX，默认发给STAFFJOY_EMAIL_SUFFIX = &amp;quot;@jskillcloud.com&amp;quot;","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568028873,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1115232,"avatar":"https://static001.geekbang.org/account/avatar/00/11/04/60/64d166b6.jpg","nickname":"Fan","note":"","ucode":"3BF28670FD9407","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":595781,"discussion_content":"老师，在log中没有看到激活邮件连接，请问具体位置在哪里呢？谢谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1670347589,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":466662,"ip_address":"广东","group_id":0},"score":595781,"extra":""}]},{"author":{"id":1147204,"avatar":"https://static001.geekbang.org/account/avatar/00/11/81/44/5ad8b927.jpg","nickname":"kook","note":"","ucode":"55FFE923785F72","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":8383,"discussion_content":"这是由于你项目里的MailConstant发信设置错误，建议先去了解如何授权和设置阿里云邮件推送","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567990633,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":175279,"user_name":"Geek_7pzisy","can_delete":false,"product_type":"c3","uid":1007405,"ip_address":"","ucode":"2CAE41EDB5C910","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5f/2d/d294a2d2.jpg","comment_is_top":false,"comment_ctime":1580640864,"is_pvip":false,"replies":[{"id":68190,"content":"错误提示：faraday网关转发到app单页应用(http:&#47;&#47;localhost:9001)时请求失败。请先确保app单页应用已经正常启动，可以用浏览器访问http:&#47;&#47;localhost:9001进行校验。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1580731470,"ip_address":"","comment_id":175279,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"跳转到http:&#47;&#47;app.staffjoy-v2.local&#47;报如下错误：\nERROR o.a.c.c.C.[.[.[.[dispatcherServlet].log - Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception\norg.springframework.web.client.ResourceAccessException: I&#47;O error on GET request for &quot;http:&#47;&#47;localhost:9001&#47;&quot;: Connect to localhost:9001 [localhost&#47;127.0.0.1, localhost&#47;0:0:0:0:0:0:0:1] failed: Connection refused (Connection refused); nested exception is org.apache.http.conn.HttpHostConnectException: Connect to localhost:9001 [localhost&#47;127.0.0.1, localhost&#47;0:0:0:0:0:0:0:1] failed: Connection refused (Connection refused)\n","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482675,"discussion_content":"错误提示：faraday网关转发到app单页应用(http://localhost:9001)时请求失败。请先确保app单页应用已经正常启动，可以用浏览器访问http://localhost:9001进行校验。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580731470,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":272512,"user_name":"草裡菌","can_delete":false,"product_type":"c3","uid":1241514,"ip_address":"","ucode":"E11C630ABA4370","user_header":"https://static001.geekbang.org/account/avatar/00/12/f1/aa/c29def94.jpg","comment_is_top":false,"comment_ctime":1610104918,"is_pvip":false,"replies":[{"id":98968,"content":"谢谢你的建议，后面的课程会考虑你的建议。\n\n“发现dev环境必须使用@jskillcloud.com”，这个是代码中设置的，可以自己调整代码(search一下就可以找到)。\n\n另外，课程建议Mac&#47;Linux环境，如果是windows，建议安装Linux虚拟机环境。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1610461034,"ip_address":"","comment_id":272512,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"首先，在 Windows 系统下，前端的app项目无法 npm install，但是看到两个前端目录里已经存在dist，遂用nginx配了俩server指向这两个dist文件夹，也算勉强用起来了。\n还有，发现dev环境下必须使用 @jskillcloud.com 邮箱后缀才能成功发出去邮件。\n最后，个人觉得这门课程的顺序，应该先进入这个手把手部署运行部分，再分步骤讲解各个微服务的内容。","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513298,"discussion_content":"谢谢你的建议，后面的课程会考虑你的建议。\n\n“发现dev环境必须使用@jskillcloud.com”，这个是代码中设置的，可以自己调整代码(search一下就可以找到)。\n\n另外，课程建议Mac/Linux环境，如果是windows，建议安装Linux虚拟机环境。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610461034,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":224006,"user_name":"Geek_da9deb","can_delete":false,"product_type":"c3","uid":1317517,"ip_address":"","ucode":"724968A3A34334","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJOVESb7PSBa7SHZX3PEvrt0iaSDnUaSCMqfdIl3icT4o1SJbSDh8S3hqmJKrx0V3pgDWPcp1icxeXog/132","comment_is_top":false,"comment_ctime":1591254887,"is_pvip":false,"replies":[{"id":82674,"content":"请看mail-svc项目中的MailSendServer.java里头有一段代码注释：\n&#47;&#47; In dev and uat - only send emails to @jskillcloud.com\n\n在dev和uat环境，邮件只能发送到@jskillcloud.com这个后缀的邮箱，这个后缀可以配置，在MailConstant.java中，你可以按需修改下。\n\n","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1591456455,"ip_address":"","comment_id":224006,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"开发环境部署后，在创建账号时,Mail服务打印如下日志：\nIntercepted sending due to non-production environment\n为什么老师可以收到邮件呢？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":497333,"discussion_content":"请看mail-svc项目中的MailSendServer.java里头有一段代码注释：\n// In dev and uat - only send emails to @jskillcloud.com\n\n在dev和uat环境，邮件只能发送到@jskillcloud.com这个后缀的邮箱，这个后缀可以配置，在MailConstant.java中，你可以按需修改下。\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591456455,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":223395,"user_name":"猩猩","can_delete":false,"product_type":"c3","uid":1193852,"ip_address":"","ucode":"102ADA39C145CF","user_header":"https://static001.geekbang.org/account/avatar/00/12/37/7c/ffa62584.jpg","comment_is_top":false,"comment_ctime":1591081014,"is_pvip":false,"replies":[{"id":82349,"content":"从错误看，像是单页应用没有正常启动。我本地校验下，再回复你。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1591113042,"ip_address":"","comment_id":223395,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"老师，我在登录成功后，页面显示为空白，faraday网关错误信息如下：\nERROR x.s.f.c.GlobalErrorController.log - {&quot;message&quot;:&quot;Global error handling&quot;,&quot;errorMessage&quot;:&quot;Premature end of Content-Length delimited message body (expected: 3055591; received: 2573835&quot;,&quot;env&quot;:&quot;dev&quot;,&quot;service&quot;:&quot;faraday-service&quot;}\norg.springframework.web.client.RestClientException: Error while extracting response for type [class [B] and content type [application&#47;javascript;charset=UTF-8]; nested exception is org.apache.http.ConnectionClosedException: Premature end of Content-Length delimited message body (expected: 3055591; received: 2573835","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":497119,"discussion_content":"从错误看，像是单页应用没有正常启动。我本地校验下，再回复你。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591113042,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":191327,"user_name":"钱","can_delete":false,"product_type":"c3","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1584763677,"is_pvip":false,"replies":[{"id":73451,"content":"学完课程，能把案例代码搞懂，然后能把案例独立跑通过，这门课程基本目标就达到了。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1584793260,"ip_address":"","comment_id":191327,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"哈哈，这个项目感觉挺实用的，还没跑起来，先看完，然后再跑一下，之前下载项目多次失败，移动的网络真的差100M下个软件要半天，甚至死活下载不了😁","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488150,"discussion_content":"学完课程，能把案例代码搞懂，然后能把案例独立跑通过，这门课程基本目标就达到了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584793260,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":139324,"user_name":"吃胖了再减肥再吃再健身之谜之不瘦","can_delete":false,"product_type":"c3","uid":1588087,"ip_address":"","ucode":"BDDB3BA9D23F3A","user_header":"","comment_is_top":false,"comment_ctime":1570610733,"is_pvip":false,"replies":[{"id":53729,"content":"通过浏览器(建议chrome)检查下，页面加载为何失败，是否有错误提示。frontend单页应用的编译目前仅支持Linux&#47;Mac环境， 如果是Win环境，建议在虚拟机(如VirtualBox&#47;Docker)环境中编译。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1570625357,"ip_address":"","comment_id":139324,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"bobo老师   frontend\\app 服务引用  &quot;npm-zepto&quot;: &quot;^1.1.7&quot;,\n无法通过编译，我用     &quot;zepto&quot;: &quot;^1.2.0&quot;\n代替后，登陆成功跳转 http:&#47;&#47;app.staffjoy-v2.local&#47; 无法显示界面","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469894,"discussion_content":"通过浏览器(建议chrome)检查下，页面加载为何失败，是否有错误提示。frontend单页应用的编译目前仅支持Linux/Mac环境， 如果是Win环境，建议在虚拟机(如VirtualBox/Docker)环境中编译。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570625357,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":138130,"user_name":"Geek_phsm0q","can_delete":false,"product_type":"c3","uid":1046270,"ip_address":"","ucode":"01AAB04C6816C0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f6/fe/8477c595.jpg","comment_is_top":false,"comment_ctime":1570050208,"is_pvip":false,"replies":[{"id":53184,"content":"错误提示Account-Svc没有正常启动，看Account-Svc控制台日志，看哪一步出错了。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1570114011,"ip_address":"","comment_id":138130,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"03-10-2019 04:55:03.305 [http-nio-8086-exec-4] ERROR x.s.web.controller.ResetController.log - {&quot;message&quot;:&quot;Failed password reset&quot;,&quot;errorMessage&quot;:&quot;status 404 reading AccountClient#requestPasswordReset(String,PasswordResetRequest)&quot;,&quot;env&quot;:&quot;dev&quot;,&quot;service&quot;:&quot;www-service&quot;}\nfeign.FeignException: status 404 reading AccountClient#requestPasswordReset(String,PasswordResetRequest)\n\n通过feign调用就会报错。。","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469399,"discussion_content":"错误提示Account-Svc没有正常启动，看Account-Svc控制台日志，看哪一步出错了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570114011,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1046270,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f6/fe/8477c595.jpg","nickname":"Geek_phsm0q","note":"","ucode":"01AAB04C6816C0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":24300,"discussion_content":"直接跑testcase也是报一样的错误，其他同学都没遇到这个问题吗？\n@FeignClient(name = AccountConstant.SERVICE_NAME, path = &#34;/v1/account&#34;, url = &#34;http://localhost:8081&#34;)\n// TODO Client side validation can be enabled as needed\n// @Validated\npublic interface AccountClient {\n\n    @RequestMapping(path = &#34;/create&#34;,method = RequestMethod.POST)\n    GenericAccountResponse createAccount(@RequestHeader(value = AuthConstant.AUTHORIZATION_HEADER) String authz, @RequestBody CreateAccountRequest request);\n\nfeign.FeignException: status 404 reading AccountClient#createAccount(String,CreateAccountRequest)\n\n\tat feign.FeignException.errorStatus(FeignException.java:78)\n\tat feign.codec.ErrorDecoder$Default.decode(ErrorDecoder.java:93)\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570084705,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":135607,"user_name":"亚林","can_delete":false,"product_type":"c3","uid":1018972,"ip_address":"","ucode":"4A5A6D24314B79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8c/5c/3f164f66.jpg","comment_is_top":false,"comment_ctime":1569227224,"is_pvip":false,"replies":[{"id":52032,"content":"不错！碰到问题，自己思考动手解决，这样的学习效果最好。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1569242857,"ip_address":"","comment_id":135607,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"用自己的阿里云邮件推送调用成功啦","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468267,"discussion_content":"不错！碰到问题，自己思考动手解决，这样的学习效果最好。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569242857,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130911,"user_name":"江厚宏","can_delete":false,"product_type":"c3","uid":1061214,"ip_address":"","ucode":"00A5A0995C6D75","user_header":"https://static001.geekbang.org/account/avatar/00/10/31/5e/d7cdc1d6.jpg","comment_is_top":false,"comment_ctime":1567571939,"is_pvip":true,"replies":[{"id":49106,"content":"staffjoy应用的单页和api都住在同一根域下，应该没有跨域。\n\n跨域的话，可以在网关上统一加支持跨域cors headers。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1567594563,"ip_address":"","comment_id":130911,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100031401,"comment_content":"老师，这个部署会遇到跨域问题吗？单页面应用解决跨域问题的最佳实践是什么","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466192,"discussion_content":"staffjoy应用的单页和api都住在同一根域下，应该没有跨域。\n\n跨域的话，可以在网关上统一加支持跨域cors headers。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567594563,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130187,"user_name":"chun1123","can_delete":false,"product_type":"c3","uid":1063307,"ip_address":"","ucode":"413C3A8722699F","user_header":"https://static001.geekbang.org/account/avatar/00/10/39/8b/af74591f.jpg","comment_is_top":false,"comment_ctime":1567398869,"is_pvip":false,"replies":[{"id":48648,"content":"很奇怪的做法，我没有试过，你为啥不都放在mac上呢？\n\n如果你确实要这么做，可以尝试(但不保证可行)，你在哪台机器的浏览器去访问的，就要在那台机器上配host映射，因为浏览器中的单页应用通过本机的域名映射去找到faraday网关ip地址，然后才能向后台发起api调用。如果有问题，可以在浏览器中调试js下，看看哪步骤出错了。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1567430764,"ip_address":"","comment_id":130187,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100031401,"comment_content":"波波老师，本地测试时，我把两个单页应用部署在mac上，所有的后端服务和网关部署在win上，修改host为\n# staffjoy_localhost_dev\n127.0.0.1 account.staffjoy-v2.local\n127.0.0.1 company.staffjoy-v2.local\n127.0.0.1 farady.staffjoy-v2.local\n127.0.0.1 whoami.staffjoy-v2.local\n127.0.0.1 www.staffjoy-v2.local\n127.0.0.1 ical.staffjoy-v2.local\n127.0.0.1 staffjoy-v2.local\n192.168.0.169 myaccount.staffjoy-v2.local\n192.168.0.169 app.staffjoy-v2.local\n其中169为mac的内网ip，但是最后访问\nmyaccount.staffjoy-v2.local和app.staffjoy-v2.local时不能正常打开，\nfarady网关的路由映射我也改了\n      name: myaccount_route\n      host: myaccount.staffjoy-v2.local\n      destinations: 192.168.0.169:9000\n    -\n      name: app_route\n      host: app.staffjoy-v2.local\n      destinations: 192.168.0.169:9001\n\n用ip+port可以访问两个单页应用，就是进去一直在刷新，想问下这种分开部署的话还有哪个地方要配的吗？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465849,"discussion_content":"很奇怪的做法，我没有试过，你为啥不都放在mac上呢？\n\n如果你确实要这么做，可以尝试(但不保证可行)，你在哪台机器的浏览器去访问的，就要在那台机器上配host映射，因为浏览器中的单页应用通过本机的域名映射去找到faraday网关ip地址，然后才能向后台发起api调用。如果有问题，可以在浏览器中调试js下，看看哪步骤出错了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567430764,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1529493,"avatar":"https://static001.geekbang.org/account/avatar/00/17/56/95/5df05070.jpg","nickname":"Geek_Jack","note":"","ucode":"80F5D4262E4774","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":39330,"discussion_content":"nodejs 不支持这样访问 只能用127或者localhost","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571913290,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":129270,"user_name":"王大伟","can_delete":false,"product_type":"c3","uid":1180955,"ip_address":"","ucode":"A3BDC4D7B94B0F","user_header":"https://static001.geekbang.org/account/avatar/00/12/05/1b/fc1aa0ac.jpg","comment_is_top":false,"comment_ctime":1567075345,"is_pvip":false,"replies":[{"id":48109,"content":"你这个是staffjoy的案例吗？\n\n光从描述看，我也看不出什么问题啊，看看content-type application&#47;json是否正确设置。或者把postman的request headers抓出来，和feign&#47;httpurlconnection的request headers进行比对。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1567084106,"ip_address":"","comment_id":129270,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100031401,"comment_content":"波波老师，我测试的时候发现feign做的远程调用都返回501 not implemented错误，自己手写httpurlconnection也是这个错误。用postman没问题。发生501时候在tomcat的connector里打断点也没见到触发断点。好奇怪的错误。波波老师提示下吧，给个继续分析问题的方向","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465373,"discussion_content":"你这个是staffjoy的案例吗？\n\n光从描述看，我也看不出什么问题啊，看看content-type application/json是否正确设置。或者把postman的request headers抓出来，和feign/httpurlconnection的request headers进行比对。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567084106,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126027,"user_name":"丁乐洪","can_delete":false,"product_type":"c3","uid":1264392,"ip_address":"","ucode":"549CE57AB20B49","user_header":"https://static001.geekbang.org/account/avatar/00/13/4b/08/52954cd7.jpg","comment_is_top":false,"comment_ctime":1566296073,"is_pvip":false,"replies":[{"id":46725,"content":"通过阿里云发送邮件需要合法有效的aliyun-access-key和aliyun-access-secret，这样才能正常调用阿里云api，你有阿里云账号？","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1566386833,"ip_address":"","comment_id":126027,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100031401,"comment_content":"波波老师，阿里云发邮件失败，这个有参考文档吗？我本地报错：\n&quot;message&quot;:&quot;Unable to send email &quot;,&quot;errorMessage&quot;:&quot;InvalidUser.NotFound : The specified user does not found","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463792,"discussion_content":"通过阿里云发送邮件需要合法有效的aliyun-access-key和aliyun-access-secret，这样才能正常调用阿里云api，你有阿里云账号？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566386833,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":343128,"user_name":"好运来","can_delete":false,"product_type":"c3","uid":1113937,"ip_address":"","ucode":"F469ED6CEFEF30","user_header":"https://static001.geekbang.org/account/avatar/00/10/ff/51/9d5cfadd.jpg","comment_is_top":false,"comment_ctime":1650642292,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100031401,"comment_content":"# staffjoy-local\n127.0.0.1 account.staffjoy-v2.local\n127.0.0.1 faraday.staffjoy-v2.local\n127.0.0.1 myaccount.staffjoy-v2.local\n127.0.0.1 whoami.staffjoy-v2.local\n127.0.0.1 ical.staffjoy-v2.local\n127.0.0.1 staffjoy-v2.local\n127.0.0.1 app.staffjoy-v2.local\n127.0.0.1 company.staffjoy-v2.local\n\n127.0.0.1 www.account.staffjoy-v2.local\n127.0.0.1 www.faraday.staffjoy-v2.local\n127.0.0.1 www.myaccount.staffjoy-v2.local\n127.0.0.1 www.whoami.staffjoy-v2.local\n127.0.0.1 www.ical.staffjoy-v2.local\n127.0.0.1 www.staffjoy-v2.local\n127.0.0.1 www.app.staffjoy-v2.local\n127.0.0.1 www.company.staffjoy-v2.local","like_count":0},{"had_liked":false,"id":315902,"user_name":"fanys001","can_delete":false,"product_type":"c3","uid":1058862,"ip_address":"","ucode":"4EBA79EC61A141","user_header":"https://static001.geekbang.org/account/avatar/00/10/28/2e/90970265.jpg","comment_is_top":false,"comment_ctime":1634039157,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100031401,"comment_content":"staff joy  login一直打转啊","like_count":0}]}