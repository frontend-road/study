{"id":73479,"title":"16 | â€œorder byâ€æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ","content":"<p>åœ¨ä½ å¼€å‘åº”ç”¨çš„æ—¶å€™ï¼Œä¸€å®šä¼šç»å¸¸ç¢°åˆ°éœ€è¦æ ¹æ®æŒ‡å®šçš„å­—æ®µæ’åºæ¥æ˜¾ç¤ºç»“æœçš„éœ€æ±‚ã€‚è¿˜æ˜¯ä»¥æˆ‘ä»¬å‰é¢ä¸¾ä¾‹ç”¨è¿‡çš„å¸‚æ°‘è¡¨ä¸ºä¾‹ï¼Œå‡è®¾ä½ è¦æŸ¥è¯¢åŸå¸‚æ˜¯â€œæ­å·â€çš„æ‰€æœ‰äººåå­—ï¼Œå¹¶ä¸”æŒ‰ç…§å§“åæ’åºè¿”å›å‰1000ä¸ªäººçš„å§“åã€å¹´é¾„ã€‚</p><p>å‡è®¾è¿™ä¸ªè¡¨çš„éƒ¨åˆ†å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š</p><pre><code>CREATE TABLE `t` (\n  `id` int(11) NOT NULL,\n  `city` varchar(16) NOT NULL,\n  `name` varchar(16) NOT NULL,\n  `age` int(11) NOT NULL,\n  `addr` varchar(128) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  KEY `city` (`city`)\n) ENGINE=InnoDB;\n</code></pre><p>è¿™æ—¶ï¼Œä½ çš„SQLè¯­å¥å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><pre><code>select city,name,age from t where city='æ­å·' order by name limit 1000  ;\n</code></pre><p>è¿™ä¸ªè¯­å¥çœ‹ä¸Šå»é€»è¾‘å¾ˆæ¸…æ™°ï¼Œä½†æ˜¯ä½ äº†è§£å®ƒçš„æ‰§è¡Œæµç¨‹å—ï¼Ÿä»Šå¤©ï¼Œæˆ‘å°±å’Œä½ èŠèŠè¿™ä¸ªè¯­å¥æ˜¯æ€ä¹ˆæ‰§è¡Œçš„ï¼Œä»¥åŠæœ‰ä»€ä¹ˆå‚æ•°ä¼šå½±å“æ‰§è¡Œçš„è¡Œä¸ºã€‚</p><h1>å…¨å­—æ®µæ’åº</h1><p>å‰é¢æˆ‘ä»¬ä»‹ç»è¿‡ç´¢å¼•ï¼Œæ‰€ä»¥ä½ ç°åœ¨å°±å¾ˆæ¸…æ¥šäº†ï¼Œä¸ºé¿å…å…¨è¡¨æ‰«æï¼Œæˆ‘ä»¬éœ€è¦åœ¨cityå­—æ®µåŠ ä¸Šç´¢å¼•ã€‚</p><p>åœ¨cityå­—æ®µä¸Šåˆ›å»ºç´¢å¼•ä¹‹åï¼Œæˆ‘ä»¬ç”¨explainå‘½ä»¤æ¥çœ‹çœ‹è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæƒ…å†µã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/82/03/826579b63225def812330ef6c344a303.png?wh=1470*126\" alt=\"\"></p><center><span class=\"reference\">å›¾1 ä½¿ç”¨explainå‘½ä»¤æŸ¥çœ‹è¯­å¥çš„æ‰§è¡Œæƒ…å†µ</span></center><p>Extraè¿™ä¸ªå­—æ®µä¸­çš„â€œUsing filesortâ€è¡¨ç¤ºçš„å°±æ˜¯éœ€è¦æ’åºï¼ŒMySQLä¼šç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€å—å†…å­˜ç”¨äºæ’åºï¼Œç§°ä¸ºsort_bufferã€‚</p><p>ä¸ºäº†è¯´æ˜è¿™ä¸ªSQLæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹cityè¿™ä¸ªç´¢å¼•çš„ç¤ºæ„å›¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/53/3e/5334cca9118be14bde95ec94b02f0a3e.png?wh=1142*856\" alt=\"\"></p><center><span class=\"reference\">å›¾2 cityå­—æ®µçš„ç´¢å¼•ç¤ºæ„å›¾</span></center><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ»¡è¶³city='æ­å·â€™æ¡ä»¶çš„è¡Œï¼Œæ˜¯ä»ID_Xåˆ°ID_(X+N)çš„è¿™äº›è®°å½•ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸ªè¯­å¥æ‰§è¡Œæµç¨‹å¦‚ä¸‹æ‰€ç¤º ï¼š</p><!-- [[[read_end]]] --><ol>\n<li>\n<p>åˆå§‹åŒ–sort_bufferï¼Œç¡®å®šæ”¾å…¥nameã€cityã€ageè¿™ä¸‰ä¸ªå­—æ®µï¼›</p>\n</li>\n<li>\n<p>ä»ç´¢å¼•cityæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³city='æ­å·â€™æ¡ä»¶çš„ä¸»é”®idï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„ID_Xï¼›</p>\n</li>\n<li>\n<p>åˆ°ä¸»é”®idç´¢å¼•å–å‡ºæ•´è¡Œï¼Œå–nameã€cityã€ageä¸‰ä¸ªå­—æ®µçš„å€¼ï¼Œå­˜å…¥sort_bufferä¸­ï¼›</p>\n</li>\n<li>\n<p>ä»ç´¢å¼•cityå–ä¸‹ä¸€ä¸ªè®°å½•çš„ä¸»é”®idï¼›</p>\n</li>\n<li>\n<p>é‡å¤æ­¥éª¤3ã€4ç›´åˆ°cityçš„å€¼ä¸æ»¡è¶³æŸ¥è¯¢æ¡ä»¶ä¸ºæ­¢ï¼Œå¯¹åº”çš„ä¸»é”®idä¹Ÿå°±æ˜¯å›¾ä¸­çš„ID_Yï¼›</p>\n</li>\n<li>\n<p>å¯¹sort_bufferä¸­çš„æ•°æ®æŒ‰ç…§å­—æ®µnameåšå¿«é€Ÿæ’åºï¼›</p>\n</li>\n<li>\n<p>æŒ‰ç…§æ’åºç»“æœå–å‰1000è¡Œè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>\n</li>\n</ol><p>æˆ‘ä»¬æš‚ä¸”æŠŠè¿™ä¸ªæ’åºè¿‡ç¨‹ï¼Œç§°ä¸ºå…¨å­—æ®µæ’åºï¼Œæ‰§è¡Œæµç¨‹çš„ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸‹ä¸€ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬è¿˜ä¼šç”¨åˆ°è¿™ä¸ªæ’åºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/6c/72/6c821828cddf46670f9d56e126e3e772.jpg?wh=1142*856\" alt=\"\"></p><center><span class=\"reference\">å›¾3 å…¨å­—æ®µæ’åº</span></center><p>å›¾ä¸­â€œæŒ‰nameæ’åºâ€è¿™ä¸ªåŠ¨ä½œï¼Œå¯èƒ½åœ¨å†…å­˜ä¸­å®Œæˆï¼Œä¹Ÿå¯èƒ½éœ€è¦ä½¿ç”¨å¤–éƒ¨æ’åºï¼Œè¿™å–å†³äºæ’åºæ‰€éœ€çš„å†…å­˜å’Œå‚æ•°sort_buffer_sizeã€‚</p><p>sort_buffer_sizeï¼Œå°±æ˜¯MySQLä¸ºæ’åºå¼€è¾Ÿçš„å†…å­˜ï¼ˆsort_bufferï¼‰çš„å¤§å°ã€‚å¦‚æœè¦æ’åºçš„æ•°æ®é‡å°äºsort_buffer_sizeï¼Œæ’åºå°±åœ¨å†…å­˜ä¸­å®Œæˆã€‚ä½†å¦‚æœæ’åºæ•°æ®é‡å¤ªå¤§ï¼Œå†…å­˜æ”¾ä¸ä¸‹ï¼Œåˆ™ä¸å¾—ä¸åˆ©ç”¨ç£ç›˜ä¸´æ—¶æ–‡ä»¶è¾…åŠ©æ’åºã€‚</p><p>ä½ å¯ä»¥ç”¨ä¸‹é¢ä»‹ç»çš„æ–¹æ³•ï¼Œæ¥ç¡®å®šä¸€ä¸ªæ’åºè¯­å¥æ˜¯å¦ä½¿ç”¨äº†ä¸´æ—¶æ–‡ä»¶ã€‚</p><pre><code>/* æ‰“å¼€optimizer_traceï¼Œåªå¯¹æœ¬çº¿ç¨‹æœ‰æ•ˆ */\nSET optimizer_trace='enabled=on'; \n\n/* @aä¿å­˜Innodb_rows_readçš„åˆå§‹å€¼ */\nselect VARIABLE_VALUE into @a from  performance_schema.session_status where variable_name = 'Innodb_rows_read';\n\n/* æ‰§è¡Œè¯­å¥ */\nselect city, name,age from t where city='æ­å·' order by name limit 1000; \n\n/* æŸ¥çœ‹ OPTIMIZER_TRACE è¾“å‡º */\nSELECT * FROM `information_schema`.`OPTIMIZER_TRACE`\\G\n\n/* @bä¿å­˜Innodb_rows_readçš„å½“å‰å€¼ */\nselect VARIABLE_VALUE into @b from performance_schema.session_status where variable_name = 'Innodb_rows_read';\n\n/* è®¡ç®—Innodb_rows_readå·®å€¼ */\nselect @b-@a;\n</code></pre><p>è¿™ä¸ªæ–¹æ³•æ˜¯é€šè¿‡æŸ¥çœ‹ OPTIMIZER_TRACE çš„ç»“æœæ¥ç¡®è®¤çš„ï¼Œä½ å¯ä»¥ä» number_of_tmp_filesä¸­çœ‹åˆ°æ˜¯å¦ä½¿ç”¨äº†ä¸´æ—¶æ–‡ä»¶ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/89/95/89baf99cdeefe90a22370e1d6f5e6495.png?wh=713*183\" alt=\"\"></p><center><span class=\"reference\">å›¾4 å…¨æ’åºçš„OPTIMIZER_TRACEéƒ¨åˆ†ç»“æœ</span></center><p>number_of_tmp_filesè¡¨ç¤ºçš„æ˜¯ï¼Œæ’åºè¿‡ç¨‹ä¸­ä½¿ç”¨çš„ä¸´æ—¶æ–‡ä»¶æ•°ã€‚ä½ ä¸€å®šå¥‡æ€ªï¼Œä¸ºä»€ä¹ˆéœ€è¦12ä¸ªæ–‡ä»¶ï¼Ÿå†…å­˜æ”¾ä¸ä¸‹æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨å¤–éƒ¨æ’åºï¼Œå¤–éƒ¨æ’åºä¸€èˆ¬ä½¿ç”¨å½’å¹¶æ’åºç®—æ³•ã€‚å¯ä»¥è¿™ä¹ˆç®€å•ç†è§£ï¼Œ<strong>MySQLå°†éœ€è¦æ’åºçš„æ•°æ®åˆ†æˆ12ä»½ï¼Œæ¯ä¸€ä»½å•ç‹¬æ’åºåå­˜åœ¨è¿™äº›ä¸´æ—¶æ–‡ä»¶ä¸­ã€‚ç„¶åæŠŠè¿™12ä¸ªæœ‰åºæ–‡ä»¶å†åˆå¹¶æˆä¸€ä¸ªæœ‰åºçš„å¤§æ–‡ä»¶ã€‚</strong></p><p>å¦‚æœsort_buffer_sizeè¶…è¿‡äº†éœ€è¦æ’åºçš„æ•°æ®é‡çš„å¤§å°ï¼Œnumber_of_tmp_fileså°±æ˜¯0ï¼Œè¡¨ç¤ºæ’åºå¯ä»¥ç›´æ¥åœ¨å†…å­˜ä¸­å®Œæˆã€‚</p><p>å¦åˆ™å°±éœ€è¦æ”¾åœ¨ä¸´æ—¶æ–‡ä»¶ä¸­æ’åºã€‚sort_buffer_sizeè¶Šå°ï¼Œéœ€è¦åˆ†æˆçš„ä»½æ•°è¶Šå¤šï¼Œnumber_of_tmp_filesçš„å€¼å°±è¶Šå¤§ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å†å’Œä½ è§£é‡Šä¸€ä¸‹å›¾4ä¸­å…¶ä»–ä¸¤ä¸ªå€¼çš„æ„æ€ã€‚</p><p>æˆ‘ä»¬çš„ç¤ºä¾‹è¡¨ä¸­æœ‰4000æ¡æ»¡è¶³city='æ­å·â€™çš„è®°å½•ï¼Œæ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ° examined_rows=4000ï¼Œè¡¨ç¤ºå‚ä¸æ’åºçš„è¡Œæ•°æ˜¯4000è¡Œã€‚</p><p>sort_mode é‡Œé¢çš„packed_additional_fieldsçš„æ„æ€æ˜¯ï¼Œæ’åºè¿‡ç¨‹å¯¹å­—ç¬¦ä¸²åšäº†â€œç´§å‡‘â€å¤„ç†ã€‚å³ä½¿nameå­—æ®µçš„å®šä¹‰æ˜¯varchar(16)ï¼Œåœ¨æ’åºè¿‡ç¨‹ä¸­è¿˜æ˜¯è¦æŒ‰ç…§å®é™…é•¿åº¦æ¥åˆ†é…ç©ºé—´çš„ã€‚</p><p>åŒæ—¶ï¼Œæœ€åä¸€ä¸ªæŸ¥è¯¢è¯­å¥select @b-@a çš„è¿”å›ç»“æœæ˜¯4000ï¼Œè¡¨ç¤ºæ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹åªæ‰«æäº†4000è¡Œã€‚</p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ºäº†é¿å…å¯¹ç»“è®ºé€ æˆå¹²æ‰°ï¼Œæˆ‘æŠŠinternal_tmp_disk_storage_engineè®¾ç½®æˆMyISAMã€‚å¦åˆ™ï¼Œselect @b-@açš„ç»“æœä¼šæ˜¾ç¤ºä¸º4001ã€‚</p><p>è¿™æ˜¯å› ä¸ºæŸ¥è¯¢OPTIMIZER_TRACEè¿™ä¸ªè¡¨æ—¶ï¼Œéœ€è¦ç”¨åˆ°ä¸´æ—¶è¡¨ï¼Œè€Œinternal_tmp_disk_storage_engineçš„é»˜è®¤å€¼æ˜¯InnoDBã€‚å¦‚æœä½¿ç”¨çš„æ˜¯InnoDBå¼•æ“çš„è¯ï¼ŒæŠŠæ•°æ®ä»ä¸´æ—¶è¡¨å–å‡ºæ¥çš„æ—¶å€™ï¼Œä¼šè®©Innodb_rows_readçš„å€¼åŠ 1ã€‚</p><h1>rowidæ’åº</h1><p>åœ¨ä¸Šé¢è¿™ä¸ªç®—æ³•è¿‡ç¨‹é‡Œé¢ï¼Œåªå¯¹åŸè¡¨çš„æ•°æ®è¯»äº†ä¸€éï¼Œå‰©ä¸‹çš„æ“ä½œéƒ½æ˜¯åœ¨sort_bufferå’Œä¸´æ—¶æ–‡ä»¶ä¸­æ‰§è¡Œçš„ã€‚ä½†è¿™ä¸ªç®—æ³•æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚æœæŸ¥è¯¢è¦è¿”å›çš„å­—æ®µå¾ˆå¤šçš„è¯ï¼Œé‚£ä¹ˆsort_bufferé‡Œé¢è¦æ”¾çš„å­—æ®µæ•°å¤ªå¤šï¼Œè¿™æ ·å†…å­˜é‡Œèƒ½å¤ŸåŒæ—¶æ”¾ä¸‹çš„è¡Œæ•°å¾ˆå°‘ï¼Œè¦åˆ†æˆå¾ˆå¤šä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œæ’åºçš„æ€§èƒ½ä¼šå¾ˆå·®ã€‚</p><p>æ‰€ä»¥å¦‚æœå•è¡Œå¾ˆå¤§ï¼Œè¿™ä¸ªæ–¹æ³•æ•ˆç‡ä¸å¤Ÿå¥½ã€‚</p><p>é‚£ä¹ˆï¼Œ<strong>å¦‚æœMySQLè®¤ä¸ºæ’åºçš„å•è¡Œé•¿åº¦å¤ªå¤§ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿ</strong></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘æ¥ä¿®æ”¹ä¸€ä¸ªå‚æ•°ï¼Œè®©MySQLé‡‡ç”¨å¦å¤–ä¸€ç§ç®—æ³•ã€‚</p><pre><code>SET max_length_for_sort_data = 16;\n</code></pre><p>max_length_for_sort_dataï¼Œæ˜¯MySQLä¸­ä¸“é—¨æ§åˆ¶ç”¨äºæ’åºçš„è¡Œæ•°æ®çš„é•¿åº¦çš„ä¸€ä¸ªå‚æ•°ã€‚å®ƒçš„æ„æ€æ˜¯ï¼Œå¦‚æœå•è¡Œçš„é•¿åº¦è¶…è¿‡è¿™ä¸ªå€¼ï¼ŒMySQLå°±è®¤ä¸ºå•è¡Œå¤ªå¤§ï¼Œè¦æ¢ä¸€ä¸ªç®—æ³•ã€‚</p><p>cityã€nameã€age è¿™ä¸‰ä¸ªå­—æ®µçš„å®šä¹‰æ€»é•¿åº¦æ˜¯36ï¼Œæˆ‘æŠŠmax_length_for_sort_dataè®¾ç½®ä¸º16ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹è®¡ç®—è¿‡ç¨‹æœ‰ä»€ä¹ˆæ”¹å˜ã€‚</p><p>æ–°çš„ç®—æ³•æ”¾å…¥sort_bufferçš„å­—æ®µï¼Œåªæœ‰è¦æ’åºçš„åˆ—ï¼ˆå³nameå­—æ®µï¼‰å’Œä¸»é”®idã€‚</p><p>ä½†è¿™æ—¶ï¼Œæ’åºçš„ç»“æœå°±å› ä¸ºå°‘äº†cityå’Œageå­—æ®µçš„å€¼ï¼Œä¸èƒ½ç›´æ¥è¿”å›äº†ï¼Œæ•´ä¸ªæ‰§è¡Œæµç¨‹å°±å˜æˆå¦‚ä¸‹æ‰€ç¤ºçš„æ ·å­ï¼š</p><ol>\n<li>\n<p>åˆå§‹åŒ–sort_bufferï¼Œç¡®å®šæ”¾å…¥ä¸¤ä¸ªå­—æ®µï¼Œå³nameå’Œidï¼›</p>\n</li>\n<li>\n<p>ä»ç´¢å¼•cityæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³city='æ­å·â€™æ¡ä»¶çš„ä¸»é”®idï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„ID_Xï¼›</p>\n</li>\n<li>\n<p>åˆ°ä¸»é”®idç´¢å¼•å–å‡ºæ•´è¡Œï¼Œå–nameã€idè¿™ä¸¤ä¸ªå­—æ®µï¼Œå­˜å…¥sort_bufferä¸­ï¼›</p>\n</li>\n<li>\n<p>ä»ç´¢å¼•cityå–ä¸‹ä¸€ä¸ªè®°å½•çš„ä¸»é”®idï¼›</p>\n</li>\n<li>\n<p>é‡å¤æ­¥éª¤3ã€4ç›´åˆ°ä¸æ»¡è¶³city='æ­å·â€™æ¡ä»¶ä¸ºæ­¢ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„ID_Yï¼›</p>\n</li>\n<li>\n<p>å¯¹sort_bufferä¸­çš„æ•°æ®æŒ‰ç…§å­—æ®µnameè¿›è¡Œæ’åºï¼›</p>\n</li>\n<li>\n<p>éå†æ’åºç»“æœï¼Œå–å‰1000è¡Œï¼Œå¹¶æŒ‰ç…§idçš„å€¼å›åˆ°åŸè¡¨ä¸­å–å‡ºcityã€nameå’Œageä¸‰ä¸ªå­—æ®µè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>\n</li>\n</ol><p>è¿™ä¸ªæ‰§è¡Œæµç¨‹çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼Œæˆ‘æŠŠå®ƒç§°ä¸ºrowidæ’åºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/dc/6d/dc92b67721171206a302eb679c83e86d.jpg?wh=1142*856\" alt=\"\"></p><center><span class=\"reference\">å›¾5 rowidæ’åº</span></center><p>å¯¹æ¯”å›¾3çš„å…¨å­—æ®µæ’åºæµç¨‹å›¾ä½ ä¼šå‘ç°ï¼Œrowidæ’åºå¤šè®¿é—®äº†ä¸€æ¬¡è¡¨tçš„ä¸»é”®ç´¢å¼•ï¼Œå°±æ˜¯æ­¥éª¤7ã€‚</p><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œæœ€åçš„â€œç»“æœé›†â€æ˜¯ä¸€ä¸ªé€»è¾‘æ¦‚å¿µï¼Œå®é™…ä¸ŠMySQLæœåŠ¡ç«¯ä»æ’åºåçš„sort_bufferä¸­ä¾æ¬¡å–å‡ºidï¼Œç„¶ååˆ°åŸè¡¨æŸ¥åˆ°cityã€nameå’Œageè¿™ä¸‰ä¸ªå­—æ®µçš„ç»“æœï¼Œä¸éœ€è¦åœ¨æœåŠ¡ç«¯å†è€—è´¹å†…å­˜å­˜å‚¨ç»“æœï¼Œæ˜¯ç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯çš„ã€‚</p><p>æ ¹æ®è¿™ä¸ªè¯´æ˜è¿‡ç¨‹å’Œå›¾ç¤ºï¼Œä½ å¯ä»¥æƒ³ä¸€ä¸‹ï¼Œè¿™ä¸ªæ—¶å€™æ‰§è¡Œselect @b-@aï¼Œç»“æœä¼šæ˜¯å¤šå°‘å‘¢ï¼Ÿ</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹ç»“æœæœ‰ä»€ä¹ˆä¸åŒã€‚</p><p>é¦–å…ˆï¼Œå›¾ä¸­çš„examined_rowsçš„å€¼è¿˜æ˜¯4000ï¼Œè¡¨ç¤ºç”¨äºæ’åºçš„æ•°æ®æ˜¯4000è¡Œã€‚ä½†æ˜¯select @b-@aè¿™ä¸ªè¯­å¥çš„å€¼å˜æˆ5000äº†ã€‚</p><p>å› ä¸ºè¿™æ—¶å€™é™¤äº†æ’åºè¿‡ç¨‹å¤–ï¼Œåœ¨æ’åºå®Œæˆåï¼Œè¿˜è¦æ ¹æ®idå»åŸè¡¨å–å€¼ã€‚ç”±äºè¯­å¥æ˜¯limit 1000ï¼Œå› æ­¤ä¼šå¤šè¯»1000è¡Œã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/27/9b/27f164804d1a4689718291be5d10f89b.png?wh=468*183\" alt=\"\"></p><center><span class=\"reference\">å›¾6 rowidæ’åºçš„OPTIMIZER_TRACEéƒ¨åˆ†è¾“å‡º</span></center><p>ä»OPTIMIZER_TRACEçš„ç»“æœä¸­ï¼Œä½ è¿˜èƒ½çœ‹åˆ°å¦å¤–ä¸¤ä¸ªä¿¡æ¯ä¹Ÿå˜äº†ã€‚</p><ul>\n<li>sort_modeå˜æˆäº†&lt;sort_key, rowid&gt;ï¼Œè¡¨ç¤ºå‚ä¸æ’åºçš„åªæœ‰nameå’Œidè¿™ä¸¤ä¸ªå­—æ®µã€‚</li>\n<li>number_of_tmp_fileså˜æˆ10äº†ï¼Œæ˜¯å› ä¸ºè¿™æ—¶å€™å‚ä¸æ’åºçš„è¡Œæ•°è™½ç„¶ä»ç„¶æ˜¯4000è¡Œï¼Œä½†æ˜¯æ¯ä¸€è¡Œéƒ½å˜å°äº†ï¼Œå› æ­¤éœ€è¦æ’åºçš„æ€»æ•°æ®é‡å°±å˜å°äº†ï¼Œéœ€è¦çš„ä¸´æ—¶æ–‡ä»¶ä¹Ÿç›¸åº”åœ°å˜å°‘äº†ã€‚</li>\n</ul><h1>å…¨å­—æ®µæ’åº VS rowidæ’åº</h1><p>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼Œä»è¿™ä¸¤ä¸ªæ‰§è¡Œæµç¨‹é‡Œï¼Œè¿˜èƒ½å¾—å‡ºä»€ä¹ˆç»“è®ºã€‚</p><p>å¦‚æœMySQLå®åœ¨æ˜¯æ‹…å¿ƒæ’åºå†…å­˜å¤ªå°ï¼Œä¼šå½±å“æ’åºæ•ˆç‡ï¼Œæ‰ä¼šé‡‡ç”¨rowidæ’åºç®—æ³•ï¼Œè¿™æ ·æ’åºè¿‡ç¨‹ä¸­ä¸€æ¬¡å¯ä»¥æ’åºæ›´å¤šè¡Œï¼Œä½†æ˜¯éœ€è¦å†å›åˆ°åŸè¡¨å»å–æ•°æ®ã€‚</p><p>å¦‚æœMySQLè®¤ä¸ºå†…å­˜è¶³å¤Ÿå¤§ï¼Œä¼šä¼˜å…ˆé€‰æ‹©å…¨å­—æ®µæ’åºï¼ŒæŠŠéœ€è¦çš„å­—æ®µéƒ½æ”¾åˆ°sort_bufferä¸­ï¼Œè¿™æ ·æ’åºåå°±ä¼šç›´æ¥ä»å†…å­˜é‡Œé¢è¿”å›æŸ¥è¯¢ç»“æœäº†ï¼Œä¸ç”¨å†å›åˆ°åŸè¡¨å»å–æ•°æ®ã€‚</p><p>è¿™ä¹Ÿå°±ä½“ç°äº†MySQLçš„ä¸€ä¸ªè®¾è®¡æ€æƒ³ï¼š<strong>å¦‚æœå†…å­˜å¤Ÿï¼Œå°±è¦å¤šåˆ©ç”¨å†…å­˜ï¼Œå°½é‡å‡å°‘ç£ç›˜è®¿é—®ã€‚</strong></p><p>å¯¹äºInnoDBè¡¨æ¥è¯´ï¼Œrowidæ’åºä¼šè¦æ±‚å›è¡¨å¤šé€ æˆç£ç›˜è¯»ï¼Œå› æ­¤ä¸ä¼šè¢«ä¼˜å…ˆé€‰æ‹©ã€‚</p><p>è¿™ä¸ªç»“è®ºçœ‹ä¸Šå»æœ‰ç‚¹åºŸè¯çš„æ„Ÿè§‰ï¼Œä½†æ˜¯ä½ è¦è®°ä½å®ƒï¼Œä¸‹ä¸€ç¯‡æ–‡ç« æˆ‘ä»¬å°±ä¼šç”¨åˆ°ã€‚</p><p>çœ‹åˆ°è¿™é‡Œï¼Œä½ å°±äº†è§£äº†ï¼ŒMySQLåšæ’åºæ˜¯ä¸€ä¸ªæˆæœ¬æ¯”è¾ƒé«˜çš„æ“ä½œã€‚é‚£ä¹ˆä½ ä¼šé—®ï¼Œæ˜¯ä¸æ˜¯æ‰€æœ‰çš„order byéƒ½éœ€è¦æ’åºæ“ä½œå‘¢ï¼Ÿå¦‚æœä¸æ’åºå°±èƒ½å¾—åˆ°æ­£ç¡®çš„ç»“æœï¼Œé‚£å¯¹ç³»ç»Ÿçš„æ¶ˆè€—ä¼šå°å¾ˆå¤šï¼Œè¯­å¥çš„æ‰§è¡Œæ—¶é—´ä¹Ÿä¼šå˜å¾—æ›´çŸ­ã€‚</p><p>å…¶å®ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„order byè¯­å¥ï¼Œéƒ½éœ€è¦æ’åºæ“ä½œçš„ã€‚ä»ä¸Šé¢åˆ†æçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒMySQLä¹‹æ‰€ä»¥éœ€è¦ç”Ÿæˆä¸´æ—¶è¡¨ï¼Œå¹¶ä¸”åœ¨ä¸´æ—¶è¡¨ä¸Šåšæ’åºæ“ä½œï¼Œ<strong>å…¶åŸå› æ˜¯åŸæ¥çš„æ•°æ®éƒ½æ˜¯æ— åºçš„ã€‚</strong></p><p>ä½ å¯ä»¥è®¾æƒ³ä¸‹ï¼Œå¦‚æœèƒ½å¤Ÿä¿è¯ä»cityè¿™ä¸ªç´¢å¼•ä¸Šå–å‡ºæ¥çš„è¡Œï¼Œå¤©ç„¶å°±æ˜¯æŒ‰ç…§nameé€’å¢æ’åºçš„è¯ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥ä¸ç”¨å†æ’åºäº†å‘¢ï¼Ÿ</p><p>ç¡®å®æ˜¯è¿™æ ·çš„ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªå¸‚æ°‘è¡¨ä¸Šåˆ›å»ºä¸€ä¸ªcityå’Œnameçš„è”åˆç´¢å¼•ï¼Œå¯¹åº”çš„SQLè¯­å¥æ˜¯ï¼š</p><pre><code>alter table t add index city_user(city, name);\n</code></pre><p>ä½œä¸ºä¸cityç´¢å¼•çš„å¯¹æ¯”ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªç´¢å¼•çš„ç¤ºæ„å›¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f9/bf/f980201372b676893647fb17fac4e2bf.png?wh=1142*856\" alt=\"\"></p><center><span class=\"reference\">å›¾7 cityå’Œnameè”åˆç´¢å¼•ç¤ºæ„å›¾</span></center><p>åœ¨è¿™ä¸ªç´¢å¼•é‡Œé¢ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥ç”¨æ ‘æœç´¢çš„æ–¹å¼å®šä½åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³city='æ­å·â€™çš„è®°å½•ï¼Œå¹¶ä¸”é¢å¤–ç¡®ä¿äº†ï¼Œæ¥ä¸‹æ¥æŒ‰é¡ºåºå–â€œä¸‹ä¸€æ¡è®°å½•â€çš„éå†è¿‡ç¨‹ä¸­ï¼Œåªè¦cityçš„å€¼æ˜¯æ­å·ï¼Œnameçš„å€¼å°±ä¸€å®šæ˜¯æœ‰åºçš„ã€‚</p><p>è¿™æ ·æ•´ä¸ªæŸ¥è¯¢è¿‡ç¨‹çš„æµç¨‹å°±å˜æˆäº†ï¼š</p><ol>\n<li>\n<p>ä»ç´¢å¼•(city,name)æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³city='æ­å·â€™æ¡ä»¶çš„ä¸»é”®idï¼›</p>\n</li>\n<li>\n<p>åˆ°ä¸»é”®idç´¢å¼•å–å‡ºæ•´è¡Œï¼Œå–nameã€cityã€ageä¸‰ä¸ªå­—æ®µçš„å€¼ï¼Œä½œä¸ºç»“æœé›†çš„ä¸€éƒ¨åˆ†ç›´æ¥è¿”å›ï¼›</p>\n</li>\n<li>\n<p>ä»ç´¢å¼•(city,name)å–ä¸‹ä¸€ä¸ªè®°å½•ä¸»é”®idï¼›</p>\n</li>\n<li>\n<p>é‡å¤æ­¥éª¤2ã€3ï¼Œç›´åˆ°æŸ¥åˆ°ç¬¬1000æ¡è®°å½•ï¼Œæˆ–è€…æ˜¯ä¸æ»¡è¶³city='æ­å·â€™æ¡ä»¶æ—¶å¾ªç¯ç»“æŸã€‚</p>\n</li>\n</ol><p><img src=\"https://static001.geekbang.org/resource/image/3f/92/3f590c3a14f9236f2d8e1e2cb9686692.jpg?wh=1142*856\" alt=\"\"></p><center><span class=\"reference\">å›¾8 å¼•å…¥(city,name)è”åˆç´¢å¼•åï¼ŒæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæŸ¥è¯¢è¿‡ç¨‹ä¸éœ€è¦ä¸´æ—¶è¡¨ï¼Œä¹Ÿä¸éœ€è¦æ’åºã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨explainçš„ç»“æœæ¥å°è¯ä¸€ä¸‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/fc/8a/fc53de303811ba3c46d344595743358a.png?wh=1382*127\" alt=\"\"></p><center><span class=\"reference\">å›¾9 å¼•å…¥(city,name)è”åˆç´¢å¼•åï¼ŒæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’</span></center><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒExtraå­—æ®µä¸­æ²¡æœ‰Using filesortäº†ï¼Œä¹Ÿå°±æ˜¯ä¸éœ€è¦æ’åºäº†ã€‚è€Œä¸”ç”±äº(city,name)è¿™ä¸ªè”åˆç´¢å¼•æœ¬èº«æœ‰åºï¼Œæ‰€ä»¥è¿™ä¸ªæŸ¥è¯¢ä¹Ÿä¸ç”¨æŠŠ4000è¡Œå…¨éƒ½è¯»ä¸€éï¼Œåªè¦æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„å‰1000æ¡è®°å½•å°±å¯ä»¥é€€å‡ºäº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æˆ‘ä»¬è¿™ä¸ªä¾‹å­é‡Œï¼Œåªéœ€è¦æ‰«æ1000æ¬¡ã€‚</p><p>æ—¢ç„¶è¯´åˆ°è¿™é‡Œäº†ï¼Œæˆ‘ä»¬å†å¾€å‰è®¨è®ºï¼Œ<strong>è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæµç¨‹æœ‰æ²¡æœ‰å¯èƒ½è¿›ä¸€æ­¥ç®€åŒ–å‘¢ï¼Ÿ</strong>ä¸çŸ¥é“ä½ è¿˜è®°ä¸è®°å¾—ï¼Œæˆ‘åœ¨ç¬¬5ç¯‡æ–‡ç« <a href=\"https://time.geekbang.org/column/article/69636\">ã€Š æ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸‹ï¼‰ã€‹</a>ä¸­ï¼Œå’Œä½ ä»‹ç»çš„è¦†ç›–ç´¢å¼•ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥å†ç¨å¾®å¤ä¹ ä¸€ä¸‹ã€‚<strong>è¦†ç›–ç´¢å¼•æ˜¯æŒ‡ï¼Œç´¢å¼•ä¸Šçš„ä¿¡æ¯è¶³å¤Ÿæ»¡è¶³æŸ¥è¯¢è¯·æ±‚ï¼Œä¸éœ€è¦å†å›åˆ°ä¸»é”®ç´¢å¼•ä¸Šå»å–æ•°æ®ã€‚</strong></p><p>æŒ‰ç…§è¦†ç›–ç´¢å¼•çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å¯ä»¥å†ä¼˜åŒ–ä¸€ä¸‹è¿™ä¸ªæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæµç¨‹ã€‚</p><p>é’ˆå¯¹è¿™ä¸ªæŸ¥è¯¢ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªcityã€nameå’Œageçš„è”åˆç´¢å¼•ï¼Œå¯¹åº”çš„SQLè¯­å¥å°±æ˜¯ï¼š</p><pre><code>alter table t add index city_user_age(city, name, age);\n</code></pre><p>è¿™æ—¶ï¼Œå¯¹äºcityå­—æ®µçš„å€¼ç›¸åŒçš„è¡Œæ¥è¯´ï¼Œè¿˜æ˜¯æŒ‰ç…§nameå­—æ®µçš„å€¼é€’å¢æ’åºçš„ï¼Œæ­¤æ—¶çš„æŸ¥è¯¢è¯­å¥ä¹Ÿå°±ä¸å†éœ€è¦æ’åºäº†ã€‚è¿™æ ·æ•´ä¸ªæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæµç¨‹å°±å˜æˆäº†ï¼š</p><ol>\n<li>\n<p>ä»ç´¢å¼•(city,name,age)æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³city='æ­å·â€™æ¡ä»¶çš„è®°å½•ï¼Œå–å‡ºå…¶ä¸­çš„cityã€nameå’Œageè¿™ä¸‰ä¸ªå­—æ®µçš„å€¼ï¼Œä½œä¸ºç»“æœé›†çš„ä¸€éƒ¨åˆ†ç›´æ¥è¿”å›ï¼›</p>\n</li>\n<li>\n<p>ä»ç´¢å¼•(city,name,age)å–ä¸‹ä¸€ä¸ªè®°å½•ï¼ŒåŒæ ·å–å‡ºè¿™ä¸‰ä¸ªå­—æ®µçš„å€¼ï¼Œä½œä¸ºç»“æœé›†çš„ä¸€éƒ¨åˆ†ç›´æ¥è¿”å›ï¼›</p>\n</li>\n<li>\n<p>é‡å¤æ‰§è¡Œæ­¥éª¤2ï¼Œç›´åˆ°æŸ¥åˆ°ç¬¬1000æ¡è®°å½•ï¼Œæˆ–è€…æ˜¯ä¸æ»¡è¶³city='æ­å·â€™æ¡ä»¶æ—¶å¾ªç¯ç»“æŸã€‚</p>\n</li>\n</ol><p><img src=\"https://static001.geekbang.org/resource/image/df/d6/df4b8e445a59c53df1f2e0f115f02cd6.jpg?wh=1142*856\" alt=\"\"></p><center><span class=\"reference\">å›¾10 å¼•å…¥(city,name,age)è”åˆç´¢å¼•åï¼ŒæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæµç¨‹</span></center><p>ç„¶åï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹explainçš„ç»“æœã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/9e/23/9e40b7b8f0e3f81126a9171cc22e3423.png?wh=1586*125\" alt=\"\"></p><center><span class=\"reference\">å›¾11 å¼•å…¥(city,name,age)è”åˆç´¢å¼•åï¼ŒæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’</span></center><p>å¯ä»¥çœ‹åˆ°ï¼ŒExtraå­—æ®µé‡Œé¢å¤šäº†â€œUsing indexâ€ï¼Œè¡¨ç¤ºçš„å°±æ˜¯ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œæ€§èƒ½ä¸Šä¼šå¿«å¾ˆå¤šã€‚</p><p>å½“ç„¶ï¼Œè¿™é‡Œå¹¶ä¸æ˜¯è¯´è¦ä¸ºäº†æ¯ä¸ªæŸ¥è¯¢èƒ½ç”¨ä¸Šè¦†ç›–ç´¢å¼•ï¼Œå°±è¦æŠŠè¯­å¥ä¸­æ¶‰åŠçš„å­—æ®µéƒ½å»ºä¸Šè”åˆç´¢å¼•ï¼Œæ¯•ç«Ÿç´¢å¼•è¿˜æ˜¯æœ‰ç»´æŠ¤ä»£ä»·çš„ã€‚è¿™æ˜¯ä¸€ä¸ªéœ€è¦æƒè¡¡çš„å†³å®šã€‚</p><h1>å°ç»“</h1><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å’Œä½ ä»‹ç»äº†MySQLé‡Œé¢order byè¯­å¥çš„å‡ ç§ç®—æ³•æµç¨‹ã€‚</p><p>åœ¨å¼€å‘ç³»ç»Ÿçš„æ—¶å€™ï¼Œä½ æ€»æ˜¯ä¸å¯é¿å…åœ°ä¼šä½¿ç”¨åˆ°order byè¯­å¥ã€‚ä½ å¿ƒé‡Œè¦æ¸…æ¥šæ¯ä¸ªè¯­å¥çš„æ’åºé€»è¾‘æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œè¿˜è¦èƒ½å¤Ÿåˆ†æå‡ºåœ¨æœ€åæƒ…å†µä¸‹ï¼Œæ¯ä¸ªè¯­å¥çš„æ‰§è¡Œå¯¹ç³»ç»Ÿèµ„æºçš„æ¶ˆè€—ï¼Œè¿™æ ·æ‰èƒ½åšåˆ°ä¸‹ç¬”å¦‚æœ‰ç¥ï¼Œä¸çŠ¯ä½çº§é”™è¯¯ã€‚</p><p>æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸‹ä¸€ä¸ªæ€è€ƒé¢˜å§ã€‚</p><p>å‡è®¾ä½ çš„è¡¨é‡Œé¢å·²ç»æœ‰äº†city_name(city, name)è¿™ä¸ªè”åˆç´¢å¼•ï¼Œç„¶åä½ è¦æŸ¥æ­å·å’Œè‹å·ä¸¤ä¸ªåŸå¸‚ä¸­æ‰€æœ‰çš„å¸‚æ°‘çš„å§“åï¼Œå¹¶ä¸”æŒ‰åå­—æ’åºï¼Œæ˜¾ç¤ºå‰100æ¡è®°å½•ã€‚å¦‚æœSQLæŸ¥è¯¢è¯­å¥æ˜¯è¿™ä¹ˆå†™çš„ ï¼š</p><pre><code>mysql&gt; select * from t where city in ('æ­å·',&quot;è‹å·&quot;) order by name limit 100;\n</code></pre><p>é‚£ä¹ˆï¼Œè¿™ä¸ªè¯­å¥æ‰§è¡Œçš„æ—¶å€™ä¼šæœ‰æ’åºè¿‡ç¨‹å—ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p><p>å¦‚æœä¸šåŠ¡ç«¯ä»£ç ç”±ä½ æ¥å¼€å‘ï¼Œéœ€è¦å®ç°ä¸€ä¸ªåœ¨æ•°æ®åº“ç«¯ä¸éœ€è¦æ’åºçš„æ–¹æ¡ˆï¼Œä½ ä¼šæ€ä¹ˆå®ç°å‘¢ï¼Ÿ</p><p>è¿›ä¸€æ­¥åœ°ï¼Œå¦‚æœæœ‰åˆ†é¡µéœ€æ±‚ï¼Œè¦æ˜¾ç¤ºç¬¬101é¡µï¼Œä¹Ÿå°±æ˜¯è¯´è¯­å¥æœ€åè¦æ”¹æˆ â€œlimit 10000,100â€ï¼Œ ä½ çš„å®ç°æ–¹æ³•åˆä¼šæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„æ€è€ƒå’Œè§‚ç‚¹å†™åœ¨ç•™è¨€åŒºé‡Œï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h1>ä¸ŠæœŸé—®é¢˜æ—¶é—´</h1><p>ä¸ŠæœŸçš„é—®é¢˜æ˜¯ï¼Œå½“MySQLå»æ›´æ–°ä¸€è¡Œï¼Œä½†æ˜¯è¦ä¿®æ”¹çš„å€¼è·ŸåŸæ¥çš„å€¼æ˜¯ç›¸åŒçš„ï¼Œè¿™æ—¶å€™MySQLä¼šçœŸçš„å»æ‰§è¡Œä¸€æ¬¡ä¿®æ”¹å—ï¼Ÿè¿˜æ˜¯çœ‹åˆ°å€¼ç›¸åŒå°±ç›´æ¥è¿”å›å‘¢ï¼Ÿ</p><p>è¿™æ˜¯ç¬¬ä¸€æ¬¡æˆ‘ä»¬è¯¾åé—®é¢˜çš„ä¸‰ä¸ªé€‰é¡¹éƒ½æœ‰åŒå­¦é€‰çš„ï¼Œæ‰€ä»¥æˆ‘è¦å’Œä½ éœ€è¦è¯¦ç»†è¯´æ˜ä¸€ä¸‹ã€‚</p><p>ç¬¬ä¸€ä¸ªé€‰é¡¹æ˜¯ï¼ŒMySQLè¯»å‡ºæ•°æ®ï¼Œå‘ç°å€¼ä¸åŸæ¥ç›¸åŒï¼Œä¸æ›´æ–°ï¼Œç›´æ¥è¿”å›ï¼Œæ‰§è¡Œç»“æŸã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªé”å®éªŒæ¥ç¡®è®¤ã€‚</p><p>å‡è®¾ï¼Œå½“å‰è¡¨té‡Œçš„å€¼æ˜¯(1,2)ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/6d/90/6d9d8837560d01b57d252c470157ea90.png?wh=935*203\" alt=\"\"></p><center><span class=\"reference\">å›¾12 é”éªŒè¯æ–¹å¼</span></center><p>session Bçš„update è¯­å¥è¢«blockedäº†ï¼ŒåŠ é”è¿™ä¸ªåŠ¨ä½œæ˜¯InnoDBæ‰èƒ½åšçš„ï¼Œæ‰€ä»¥æ’é™¤é€‰é¡¹1ã€‚</p><p>ç¬¬äºŒä¸ªé€‰é¡¹æ˜¯ï¼ŒMySQLè°ƒç”¨äº†InnoDBå¼•æ“æä¾›çš„æ¥å£ï¼Œä½†æ˜¯å¼•æ“å‘ç°å€¼ä¸åŸæ¥ç›¸åŒï¼Œä¸æ›´æ–°ï¼Œç›´æ¥è¿”å›ã€‚æœ‰æ²¡æœ‰è¿™ç§å¯èƒ½å‘¢ï¼Ÿè¿™é‡Œæˆ‘ç”¨ä¸€ä¸ªå¯è§æ€§å®éªŒæ¥ç¡®è®¤ã€‚</p><p>å‡è®¾å½“å‰è¡¨é‡Œçš„å€¼æ˜¯(1,2)ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/44/96/441682b64a3f5dd50f35b12ca4b87c96.png?wh=938*423\" alt=\"\"></p><center><span class=\"reference\">å›¾13 å¯è§æ€§éªŒè¯æ–¹å¼</span></center><p>session Açš„ç¬¬äºŒä¸ªselect è¯­å¥æ˜¯ä¸€è‡´æ€§è¯»ï¼ˆå¿«ç…§è¯»)ï¼Œå®ƒæ˜¯ä¸èƒ½çœ‹è§session Bçš„æ›´æ–°çš„ã€‚</p><p>ç°åœ¨å®ƒè¿”å›çš„æ˜¯(1,3)ï¼Œè¡¨ç¤ºå®ƒçœ‹è§äº†æŸä¸ªæ–°çš„ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬åªèƒ½æ˜¯session Aè‡ªå·±çš„updateè¯­å¥åšæ›´æ–°çš„æ—¶å€™ç”Ÿæˆã€‚ï¼ˆå¦‚æœä½ å¯¹è¿™ä¸ªé€»è¾‘æœ‰ç–‘æƒ‘çš„è¯ï¼Œå¯ä»¥å›é¡¾ä¸‹ç¬¬8ç¯‡æ–‡ç« <a href=\"https://time.geekbang.org/column/article/70562\">ã€Šäº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„ï¼Ÿã€‹</a>ä¸­çš„ç›¸å…³å†…å®¹ï¼‰</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸ŠæœŸæ€è€ƒé¢˜çš„ç­”æ¡ˆåº”è¯¥æ˜¯é€‰é¡¹3ï¼Œå³ï¼šInnoDBè®¤çœŸæ‰§è¡Œäº†â€œæŠŠè¿™ä¸ªå€¼ä¿®æ”¹æˆ(1,2)\"è¿™ä¸ªæ“ä½œï¼Œè¯¥åŠ é”çš„åŠ é”ï¼Œè¯¥æ›´æ–°çš„æ›´æ–°ã€‚</p><p>ç„¶åä½ ä¼šè¯´ï¼ŒMySQLæ€ä¹ˆè¿™ä¹ˆç¬¨ï¼Œå°±ä¸ä¼šæ›´æ–°å‰åˆ¤æ–­ä¸€ä¸‹å€¼æ˜¯ä¸æ˜¯ç›¸åŒå—ï¼Ÿå¦‚æœåˆ¤æ–­ä¸€ä¸‹ï¼Œä¸å°±ä¸ç”¨æµªè´¹InnoDBæ“ä½œï¼Œå¤šå»æ›´æ–°ä¸€æ¬¡äº†ï¼Ÿ</p><p>å…¶å®MySQLæ˜¯ç¡®è®¤äº†çš„ã€‚åªæ˜¯åœ¨è¿™ä¸ªè¯­å¥é‡Œé¢ï¼ŒMySQLè®¤ä¸ºè¯»å‡ºæ¥çš„å€¼ï¼Œåªæœ‰ä¸€ä¸ªç¡®å®šçš„ (id=1), è€Œè¦å†™çš„æ˜¯(a=3)ï¼Œåªä»è¿™ä¸¤ä¸ªä¿¡æ¯æ˜¯çœ‹ä¸å‡ºæ¥â€œä¸éœ€è¦ä¿®æ”¹â€çš„ã€‚</p><p>ä½œä¸ºéªŒè¯ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹ä¸‹é¢è¿™ä¸ªä¾‹å­ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/63/c1/63dd6df32dacdb827d256e5acb9837c1.png?wh=964*447\" alt=\"\"></p><center><span class=\"reference\">å›¾14 å¯è§æ€§éªŒè¯æ–¹å¼--å¯¹ç…§</span></center><p><strong>è¡¥å……è¯´æ˜ï¼š</strong></p><p>ä¸Šé¢æˆ‘ä»¬çš„éªŒè¯ç»“æœéƒ½æ˜¯åœ¨binlog_format=statementæ ¼å¼ä¸‹è¿›è¡Œçš„ã€‚</p><p>@didiren è¡¥å……äº†ä¸€ä¸ªcaseï¼Œ å¦‚æœæ˜¯binlog_format=row å¹¶ä¸”binlog_row_image=FULLçš„æ—¶å€™ï¼Œç”±äºMySQLéœ€è¦åœ¨binlogé‡Œé¢è®°å½•æ‰€æœ‰çš„å­—æ®µï¼Œæ‰€ä»¥åœ¨è¯»æ•°æ®çš„æ—¶å€™å°±ä¼šæŠŠæ‰€æœ‰æ•°æ®éƒ½è¯»å‡ºæ¥äº†ã€‚</p><p>æ ¹æ®ä¸Šé¢è¯´çš„è§„åˆ™ï¼Œâ€œæ—¢ç„¶è¯»äº†æ•°æ®ï¼Œå°±ä¼šåˆ¤æ–­â€ï¼Œ å› æ­¤åœ¨è¿™æ—¶å€™ï¼Œselect * from t where id=1ï¼Œç»“æœå°±æ˜¯â€œè¿”å› (1,2)â€ã€‚</p><p>åŒç†ï¼Œå¦‚æœæ˜¯binlog_row_image=NOBLOB, ä¼šè¯»å‡ºé™¤blob å¤–çš„æ‰€æœ‰å­—æ®µï¼Œåœ¨æˆ‘ä»¬è¿™ä¸ªä¾‹å­é‡Œï¼Œç»“æœè¿˜æ˜¯â€œè¿”å› (1,2)â€ã€‚</p><p>å¯¹åº”çš„ä»£ç å¦‚å›¾15æ‰€ç¤ºã€‚è¿™æ˜¯MySQL 5.6ç‰ˆæœ¬å¼•å…¥çš„ï¼Œåœ¨æ­¤ä¹‹å‰æˆ‘æ²¡æœ‰çœ‹è¿‡ã€‚æ‰€ä»¥ï¼Œç‰¹æ­¤è¯´æ˜ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/d4/89/d413b9235d56c62f9829750a68b06b89.png?wh=1040*160\" alt=\"\"></p><center><span class=\"reference\">å›¾15 binlog_row_image=FULLè¯»å­—æ®µé€»è¾‘</span></center><p>ç±»ä¼¼çš„ï¼Œ@mahonebags åŒå­¦æåˆ°äº†timestampå­—æ®µçš„é—®é¢˜ã€‚ç»“è®ºæ˜¯ï¼šå¦‚æœè¡¨ä¸­æœ‰timestampå­—æ®µè€Œä¸”è®¾ç½®äº†è‡ªåŠ¨æ›´æ–°çš„è¯ï¼Œé‚£ä¹ˆæ›´æ–°â€œåˆ«çš„å­—æ®µâ€çš„æ—¶å€™ï¼ŒMySQLä¼šè¯»å…¥æ‰€æœ‰æ¶‰åŠçš„å­—æ®µï¼Œè¿™æ ·é€šè¿‡åˆ¤æ–­ï¼Œå°±ä¼šå‘ç°ä¸éœ€è¦ä¿®æ”¹ã€‚</p><p>è¿™ä¸¤ä¸ªç‚¹æˆ‘ä¼šåœ¨åé¢è®²æ›´æ–°æ€§èƒ½çš„æ–‡ç« ä¸­å†å±•å¼€ã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote>\n<p>@Gavin ã€@melonã€@é˜¿å»º ç­‰åŒå­¦æåˆ°äº†é”éªŒè¯æ³•ï¼›<br>\n@éƒ­æ±Ÿä¼Ÿ åŒå­¦æåˆ°äº†ä¸¤ä¸ªç‚¹ï¼Œéƒ½éå¸¸å¥½ï¼Œæœ‰å»å®é™…éªŒè¯ã€‚ç»“è®ºæ˜¯è¿™æ ·çš„ï¼š<br>\nç¬¬ä¸€ï¼Œhexdumpçœ‹å‡ºæ¥æ²¡æ”¹åº”è¯¥æ˜¯WALæœºåˆ¶ç”Ÿæ•ˆäº†ï¼Œè¦è¿‡ä¸€ä¼šå„¿ï¼Œæˆ–è€…æŠŠåº“shutdownçœ‹çœ‹ã€‚<br>\nç¬¬äºŒï¼Œbinlogæ²¡å†™æ˜¯MySQL Serverå±‚çŸ¥é“è¡Œçš„å€¼æ²¡å˜ï¼Œæ‰€ä»¥æ•…æ„ä¸å†™çš„ï¼Œè¿™ä¸ªæ˜¯åœ¨rowæ ¼å¼ä¸‹çš„ç­–ç•¥ã€‚ä½ å¯ä»¥æŠŠbinlog_format æ”¹æˆstatementå†éªŒè¯ä¸‹ã€‚</p>\n</blockquote><p></p>","neighbors":{"left":{"article_title":"15 | ç­”ç–‘æ–‡ç« ï¼ˆä¸€ï¼‰ï¼šæ—¥å¿—å’Œç´¢å¼•ç›¸å…³é—®é¢˜","id":73161},"right":{"article_title":"17 | å¦‚ä½•æ­£ç¡®åœ°æ˜¾ç¤ºéšæœºæ¶ˆæ¯ï¼Ÿ","id":73795}},"comments":[{"had_liked":false,"id":52028,"user_name":"æŸã€äºº","can_delete":false,"product_type":"c1","uid":1308784,"ip_address":"","ucode":"ADB42AA12A11C1","user_header":"https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg","comment_is_top":true,"comment_ctime":1545297429,"is_pvip":false,"replies":[{"id":"18833","content":"å‘æ¡æ©™å­åŒå­¦çš„é—®é¢˜ï¼š<br>é—®é¢˜1:ä½ å›ç­”å¾—æ¯”æˆ‘å›å¤çš„ç­”æ¡ˆè¿˜å¥½ï¼ğŸ‘ğŸ¿<br>é—®é¢˜2:è¿™ä¸ªåé¢æˆ‘ä»¬å±•å¼€å“ˆï¼Œè¦é…å›¾æ‰èƒ½è¯´å¾—æ¸…ğŸ˜„<br>é—®é¢˜3:å›ç­”å¾—ä¹Ÿå¾ˆå¥½ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯255è¿™ä¸ªè¾¹ç•Œã€‚å°äº255éƒ½éœ€è¦ä¸€ä¸ªå­—èŠ‚è®°å½•é•¿åº¦ï¼Œè¶…è¿‡255å°±éœ€è¦ä¸¤ä¸ªå­—èŠ‚<br><br>ä½ çš„é—®é¢˜ï¼š#å¥½é—®é¢˜_#<br>1. æ’åºç›¸å…³çš„å†…å­˜åœ¨æ’åºåå°±freeæ‰è¿˜ç»™ç³»ç»Ÿäº†<br>2. è¯»çš„æ—¶å€™åŠ äº†å†™é”çš„<br>3. å †æ’åºè¦è¯»æ‰€æœ‰è¡Œçš„ï¼Œåªè¯»ä¸€æ¬¡ï¼Œæˆ‘ä¼°è®¡ä½ å·²ç»ç†è§£å¯¹äº†ğŸ˜„<br><br>","user_name":"ä½œè€…å›å¤","comment_id":52028,"uid":"1264162","ip_address":"","utype":1,"ctime":1545303123,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":18,"race_medal":0,"score":"9.2233728587388006e+18","product_id":100020801,"comment_content":"å›ç­”ä¸‹@å‘æ¡æ©™å­åŒå­¦çš„é—®é¢˜:<br>é—®é¢˜ä¸€ï¼š<br>1)æ— æ¡ä»¶æŸ¥è¯¢å¦‚æœåªæœ‰order by create_time,å³ä¾¿create_timeä¸Šæœ‰ç´¢å¼•,ä¹Ÿä¸ä¼šä½¿ç”¨åˆ°ã€‚<br>å› ä¸ºä¼˜åŒ–å™¨è®¤ä¸ºèµ°äºŒçº§ç´¢å¼•å†å»å›è¡¨æˆæœ¬æ¯”å…¨è¡¨æ‰«ææ’åºæ›´é«˜ã€‚<br>æ‰€ä»¥é€‰æ‹©èµ°å…¨è¡¨æ‰«æ,ç„¶åæ ¹æ®è€å¸ˆè®²çš„ä¸¤ç§æ–¹å¼é€‰æ‹©ä¸€ç§æ¥æ’åº<br>2)æ— æ¡ä»¶æŸ¥è¯¢ä½†æ˜¯æ˜¯order by create_time limit m.å¦‚æœmå€¼è¾ƒå°,æ˜¯å¯ä»¥èµ°ç´¢å¼•çš„.<br>å› ä¸ºä¼˜åŒ–å™¨è®¤ä¸ºæ ¹æ®ç´¢å¼•æœ‰åºæ€§å»å›è¡¨æŸ¥æ•°æ®,ç„¶åå¾—åˆ°mæ¡æ•°æ®,å°±å¯ä»¥ç»ˆæ­¢å¾ªç¯,é‚£ä¹ˆæˆæœ¬æ¯”å…¨è¡¨æ‰«æå°,åˆ™é€‰æ‹©èµ°äºŒçº§ç´¢å¼•ã€‚<br>å³ä¾¿æ²¡æœ‰äºŒçº§ç´¢å¼•,mysqlé’ˆå¯¹order by limitä¹Ÿåšäº†ä¼˜åŒ–,é‡‡ç”¨å †æ’åºã€‚è¿™éƒ¨åˆ†è€å¸ˆæ˜å¤©ä¼šè®²<br><br>é—®é¢˜äºŒ:<br>å¦‚æœæ˜¯group by a,aä¸Šä¸èƒ½ä½¿ç”¨ç´¢å¼•çš„æƒ…å†µ,æ˜¯èµ°rowidæ’åºã€‚<br>å¦‚æœæ˜¯group by limit,ä¸èƒ½ä½¿ç”¨ç´¢å¼•çš„æƒ…å†µ,æ˜¯èµ°å †æ’åº<br>å¦‚æœæ˜¯åªæœ‰group by a,aä¸Šæœ‰ç´¢å¼•çš„æƒ…å†µ,åˆæ ¹æ®é€‰å–å€¼ä¸åŒ,ç´¢å¼•çš„æ‰«ææ–¹å¼åˆæœ‰ä¸åŒ<br>select * from t group by a  --èµ°çš„æ˜¯ç´¢å¼•å…¨æ‰«æ,è‡³äºè¿™é‡Œä¸ºä»€ä¹ˆé€‰æ‹©èµ°ç´¢å¼•å…¨æ‰«æ,è¿˜éœ€è¦è€å¸ˆè§£æƒ‘ä¸‹<br>select a from t group by a  --èµ°çš„æ˜¯ç´¢å¼•æ¾æ•£æ‰«æ,ä¹Ÿå°±è¯´åªéœ€è¦æ‰«ææ¯ç»„çš„ç¬¬ä¸€è¡Œæ•°æ®å³å¯,ä¸ç”¨æ‰«ææ¯ä¸€è¡Œçš„å€¼<br><br>é—®é¢˜ä¸‰:<br>bigintå’ŒintåŠ æ•°å­—éƒ½ä¸å½±å“èƒ½å­˜å‚¨çš„å€¼ã€‚<br>bigint(1)å’Œbigint(19)éƒ½èƒ½å­˜å‚¨2^64-1èŒƒå›´å†…çš„å€¼,intæ˜¯2^32-1ã€‚åªæ˜¯æœ‰äº›å‰ç«¯ä¼šæ ¹æ®æ‹¬å·é‡Œæ¥æˆªå–æ˜¾ç¤ºè€Œå·²ã€‚å»ºè®®ä¸åŠ varchar()å°±å¿…é¡»å¸¦,å› ä¸ºvarchar()æ‹¬å·é‡Œçš„æ•°å­—ä»£è¡¨èƒ½å­˜å¤šå°‘å­—ç¬¦ã€‚å‡è®¾varchar(2),å°±åªèƒ½å­˜ä¸¤ä¸ªå­—ç¬¦,ä¸ç®¡æ˜¯ä¸­æ–‡è¿˜æ˜¯è‹±æ–‡ã€‚ç›®å‰æ¥çœ‹varchar()è¿™ä¸ªå€¼å¯ä»¥è®¾å¾—ç¨ç¨å¤§ç‚¹,å› ä¸ºå†…å­˜æ˜¯æŒ‰ç…§å®é™…çš„å¤§å°æ¥åˆ†é…å†…å­˜ç©ºé—´çš„,ä¸æ˜¯æŒ‰ç…§å€¼æ¥é¢„åˆ†é…çš„ã€‚<br><br>è€å¸ˆæˆ‘æœ‰å‡ ä¸ªé—®é¢˜:<br>1.æˆ‘è¿˜æ˜¯æƒ³åœ¨ç¡®è®¤ä¹‹å‰é—®çš„é—®é¢˜ã€‚ä¸€ä¸ªé•¿è¿æ¥,ä¸€æ¡sqlç”³è¯·äº†sort_buffer_sizeç­‰ä¸€ç³»åˆ—çš„ä¼šè¯çº§åˆ«çš„å†…å­˜,sqlæˆåŠŸæ‰§è¡Œå®Œ,è¯¥è¿æ¥å˜ä¸ºsleepçŠ¶æ€ã€‚è¿™äº›å†…å­˜åªæ˜¯å†…å®¹ä¼šè¢«æƒ…å†µ,ä½†æ˜¯å ç”¨çš„å†…å­˜ç©ºé—´ä¸ä¼šé‡Šæ”¾?<br>2.å‡è®¾è¦ç»™aå€¼åŠ 1,æ‰§è¡Œå™¨å…ˆæ‰¾å¼•æ“å–a=1çš„è¡Œ,ç„¶åæ‰§è¡Œå™¨ç»™a+1,åœ¨è°ƒç”¨æ¥å£å†™å…¥a+1äº†æ•°æ®ã€‚é‚£ä¹ˆåŠ é”ä¸åº”è¯¥æ˜¯åœ¨æ‰§è¡Œå™¨ç¬¬ä¸€æ¬¡å»å–æ•°æ®æ—¶ï¼Œå¼•æ“å±‚å°±åŠ è¯¥åŠ çš„é”ï¼Ÿä¸ºä»€ä¹ˆè¦ç­‰åˆ°ç¬¬äºŒæ¬¡è°ƒç”¨å†™å…¥æ•°æ®æ—¶,æ‰åŠ é”ã€‚ç¬¬ä¸€æ¬¡å’Œç¬¬äºŒæ¬¡ä¹‹é—´,éš¾é“ä¸ä¼šè¢«å…¶ä»–äº‹åŠ¡ä¿®æ”¹å—ï¼Ÿå¦‚æœæ²¡æœ‰é”ä¿è¯<br>3.å§‹ç»ˆæ²¡å¤ªæ˜ç™½å †æ’åºæ˜¯é‡‡ç”¨çš„ä»€ä¹ˆç®—æ³•ä½¿å¾—åªéœ€è¦å¯¹limitçš„æ•°æ®è¿›è¡Œæ’åºå°±å¯ä»¥,è€Œä¸æ˜¯æ’åºæ‰€æœ‰çš„æ•°æ®åœ¨å–å‰mæ¡ã€‚--ä¸è¿‡è¿™é‡ŒæœŸå¾…æ˜å¤©çš„æ–‡ç« ","like_count":192,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433709,"discussion_content":"å‘æ¡æ©™å­åŒå­¦çš„é—®é¢˜ï¼š\né—®é¢˜1:ä½ å›ç­”å¾—æ¯”æˆ‘å›å¤çš„ç­”æ¡ˆè¿˜å¥½ï¼ğŸ‘ğŸ¿\né—®é¢˜2:è¿™ä¸ªåé¢æˆ‘ä»¬å±•å¼€å“ˆï¼Œè¦é…å›¾æ‰èƒ½è¯´å¾—æ¸…ğŸ˜„\né—®é¢˜3:å›ç­”å¾—ä¹Ÿå¾ˆå¥½ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯255è¿™ä¸ªè¾¹ç•Œã€‚å°äº255éƒ½éœ€è¦ä¸€ä¸ªå­—èŠ‚è®°å½•é•¿åº¦ï¼Œè¶…è¿‡255å°±éœ€è¦ä¸¤ä¸ªå­—èŠ‚\n\nä½ çš„é—®é¢˜ï¼š#å¥½é—®é¢˜_#\n1. æ’åºç›¸å…³çš„å†…å­˜åœ¨æ’åºåå°±freeæ‰è¿˜ç»™ç³»ç»Ÿäº†\n2. è¯»çš„æ—¶å€™åŠ äº†å†™é”çš„\n3. å †æ’åºè¦è¯»æ‰€æœ‰è¡Œçš„ï¼Œåªè¯»ä¸€æ¬¡ï¼Œæˆ‘ä¼°è®¡ä½ å·²ç»ç†è§£å¯¹äº†ğŸ˜„\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545303123,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1336275,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/KibvgwBjrsVOiayuViaoQfyNts8xMsztwe0Fg24icicFW7YeJaPQhAGhdNZjWWhyxOian0SCdibhiaerLbhuefkiaP1EooQ/132","nickname":"å­¦æ–‡åŒ–çš„æµæ°“","note":"","ucode":"6D9412976EE8B0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":261162,"discussion_content":"å¤åˆ¶ä¸€ä¸‹@å‘æ¡æ©™å­åŒå­¦çš„é—®é¢˜ï¼Œçœçš„è¿˜å¾—å»æ‰¾\n\næ­£å¥½æœ‰ä¸ª order by ä½¿ç”¨åœºæ™¯ ï¼Œ æœ‰ä¸ªé¡µé¢ï¼Œéœ€è¦æŒ‰æ•°æ®æ’å…¥æ—¶é—´å€’åºæ¥æŸ¥çœ‹ä¸€å¼ è®°å½•è¡¨çš„ä¿¡æ¯ ï¼Œå› ä¸ºé™¤äº†åˆ†é¡µçš„å‚æ•° ï¼Œ æ²¡æœ‰å…¶ä»– where çš„æ¡ä»¶ ï¼Œæ‰€ä»¥é™¤äº†ä¸»é”®å¤–æ²¡æœ‰å…¶ä»–ç´¢å¼• ã€‚\n\nè¿™æ—¶å€™ DBA è®©æˆ‘ç»™ create_time åˆ›å»ºç´¢å¼•ï¼Œ è¯´æ˜¯æŒ‰ç…§é¡ºåºæ’åˆ— ï¼ŒæŸ¥è¯¢ä¼šå¢å¿« ã€‚è¿™ç¯‡æ–‡ç« çœ‹å®Œå ï¼Œ è®©æˆ‘æ„Ÿè§‰å®é™…ä¸Šåˆ›å»º create_time ç´¢å¼•æ˜¯æ²¡ç”¨çš„ ã€‚\n\nå› ä¸ºæŸ¥è¯¢æœ¬èº«å¹¶æ²¡æœ‰ç”¨åˆ° create_time ç´¢å¼• ï¼Œå®é™…ä¸ŠæŸ¥è¯¢çš„æ­¥éª¤æ˜¯ ï¼š\n\n1. åˆå§‹åŒ– sort_buffer å†…å­˜\n\n2. å› ä¸ºæ²¡ç´¢å¼• ï¼Œ æ‰€ä»¥æ‰«å‡ºå…¨è¡¨çš„æ•°æ®åˆ° sort_buffer ä¸­\n\n2. å¦‚æœå†…å­˜å¤Ÿåˆ™ç›´æ¥å†…å­˜æŒ‰æ—¶é—´æ’åº\n\n3. å¦‚æœå†…å­˜ä¸å¤Ÿåˆ™æŒ‰æ•°æ®é‡åˆ†æˆä¸åŒæ–‡ä»¶åˆ†åˆ«æŒ‰æ—¶é—´æ’åºåæ•´åˆ\n\n4. æ ¹æ®æ•°é‡åˆ†é¡µæŸ¥è¯¢æ•°é‡ å›èšé›†ç´¢å¼•ä¸­ç”¨ ID æŸ¥è¯¢æ•°æ®\n\n5. è¿”å›\n\næ‰€ä»¥æˆ‘åˆ†æcreate_timeç´¢å¼•åº”è¯¥ä¸éœ€è¦åˆ›å»ºã€‚åè€Œå¢åŠ äº†ç»´æŠ¤æˆæœ¬\n\n\né—®é¢˜ä¸€ ï¼šè¿™ç§æ— æ¡ä»¶æŸ¥åˆ—è¡¨é¡µé™¤äº†å…¨è¡¨æ‰«è¿˜æœ‰å…¶ä»–å»ºç«‹ç´¢å¼•çš„åŠæ³•ä¹ˆ\n\né—®é¢˜äºŒ : å¦‚æœåŠ å…¥ group by ï¼Œ æ•°æ®è¯¥å¦‚ä½•èµ°\n\né—®é¢˜ä¸‰ ï¼šè€å¸ˆä¹‹åçš„æ–‡ç« ä¼šæœ‰è®²è§£ bigInt(20) ã€ tinyint(2) ã€varchar(32) è¿™ç§åé¢å¸¦æ•°å­—ä¸ä¸å¸¦æ•°å­—æœ‰ä½•åŒºåˆ«çš„æ–‡ç« ä¹ˆ ã€‚ æ¯æ¬¡å»ºå­—æ®µéƒ½ä¼šè€ƒè™‘é•¿åº¦ ï¼Œä½†å®é™…å´ä¸çŸ¥é“ä»–æœ‰ä½•ä½œç”¨","likes_number":30,"is_delete":false,"is_hidden":false,"ctime":1588943894,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1166966,"avatar":"https://static001.geekbang.org/account/avatar/00/11/ce/76/a344ccad.jpg","nickname":"æ”¾ç¾Šçš„æ‘é•¿","note":"","ucode":"AF948FCE8079B4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1336275,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/KibvgwBjrsVOiayuViaoQfyNts8xMsztwe0Fg24icicFW7YeJaPQhAGhdNZjWWhyxOian0SCdibhiaerLbhuefkiaP1EooQ/132","nickname":"å­¦æ–‡åŒ–çš„æµæ°“","note":"","ucode":"6D9412976EE8B0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559712,"discussion_content":"å¦‚æœæ’å…¥æ—¶é—´æ˜¯æ’å…¥çš„æ—¶å€™è‡ªåŠ¨å¡«å…¥çš„ï¼Œidä¹Ÿæ˜¯é€’å¢çš„ï¼Œé‚£order by create_timeå’Œorder by idæ˜¯ä¸€æ ·çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648892749,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":261162,"ip_address":""},"score":559712,"extra":""},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1336275,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/KibvgwBjrsVOiayuViaoQfyNts8xMsztwe0Fg24icicFW7YeJaPQhAGhdNZjWWhyxOian0SCdibhiaerLbhuefkiaP1EooQ/132","nickname":"å­¦æ–‡åŒ–çš„æµæ°“","note":"","ucode":"6D9412976EE8B0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587482,"discussion_content":"æœ‰åˆ†é¡µå‚æ•°ç”¨è¿™ä¸ªç´¢å¼•ä¼šæ›´å¥½å§ã€‚ã€‚åªä¸è¿‡åˆ†é¡µåç§»é‡å¤§äº†ä¼šæœ‰æ€§èƒ½é—®é¢˜ï¼Œå¯ä»¥ä¼˜åŒ–æˆwhere create_time&gt;xxxå½¢å¼ï¼Œåªä¸è¿‡è¿™æ ·å°±ä¸å¯ç”¨è·³é¡µäº†ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡é¢„åŠ è½½æ‰‹åŠ¨å¤„ç†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663083211,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":261162,"ip_address":"å¹¿ä¸œ"},"score":587482,"extra":""}]},{"author":{"id":2056201,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/60/09/a8e7913b.jpg","nickname":"SandCarving","note":"","ucode":"6B97DB71613A46","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":321963,"discussion_content":"ä¸ºä»€ä¹ˆä½ ä»¬éƒ½é‚£ä¹ˆä¼˜ç§€","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1604654205,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1130927,"avatar":"https://static001.geekbang.org/account/avatar/00/11/41/af/abb7bfe3.jpg","nickname":"é›¨ä¸­æ¼«æ­¥","note":"","ucode":"022AFC716E3CAA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":256550,"discussion_content":"ç¬¬ä¸€ä¸ªé—®é¢˜ä¸å¤ªæ˜ç™½ï¼Œå¦‚æœcreate_time ä¸Šæœ‰ç´¢å¼•ï¼Œé‚£order by create_timeä¸åº”è¯¥é€šè¿‡ç´¢å¼•é¿å…æ’åºçš„è¿‡ç¨‹å—ï¼Ÿè¿™æ ·æ„Ÿè§‰ä¼šæ¯”å…¨è¡¨æ‰«ææ’åºæ›´å¿«å‘€","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1588494680,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1228424,"avatar":"https://static001.geekbang.org/account/avatar/00/12/be/88/8d15796f.jpg","nickname":"John","note":"","ucode":"A46AF2906C38C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1130927,"avatar":"https://static001.geekbang.org/account/avatar/00/11/41/af/abb7bfe3.jpg","nickname":"é›¨ä¸­æ¼«æ­¥","note":"","ucode":"022AFC716E3CAA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":310495,"discussion_content":"è™½ç„¶å¯ä»¥åœ¨é¿å…æ’åºï¼Œcreate_timeæ˜¯ä»–çš„dbaä¸ºäº†æ‰€è°“çš„åŠ é€Ÿæ‰åŠ çš„ï¼Œæ²¡æœ‰ä¸šåŠ¡æ„ä¹‰ï¼Œæ‰€ä»¥æŸ¥è¯¢å­å¥è‚¯å®šä¸å¯èƒ½åªæœ‰ create_timeï¼Œæ­¤æ—¶æ— æ¡ä»¶æŸ¥è¯¢å¿…ç„¶è¡¨ä¸­æ‰€æœ‰æ•°æ®å‡è¦å›è¡¨ï¼Œæ€»çš„æ¥è¯´åœ¨å…¨è¡¨å›è¡¨å’Œå…¨è¡¨æ’åºä¸Šåè€…åº”è¯¥æ¶ˆè€—æ›´ä½","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1601879353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":256550,"ip_address":""},"score":310495,"extra":""}]},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535903,"discussion_content":"å †æ’åºé¦–å…ˆéœ€è¦æ„å»ºå¤§é¡¶å †æˆ–è€…å°é¡¶å †ã€‚æ¯æ¬¡å–çš„æ—¶å€™è¦ä¹ˆæ˜¯æœ€å°å€¼è¦ä¹ˆæ˜¯æœ€å¤§å€¼","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1638601857,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2033168,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/06/10/77f6ccea.jpg","nickname":"å°˜ç¬","note":"","ucode":"553924A550B3BD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556659,"discussion_content":"è¿™é‡Œçš„255æ˜¯è¡¨ç¤ºçš„æ˜¯å­—èŠ‚ï¼›\næ¯”å¦‚ä¸€ä¸ªå­—ç¬¦é›†ä¸ºutf8mb4ï¼ˆä¸€ä¸ªå­—ç¬¦ä¸º4ä¸ªå­—èŠ‚),ä¸€ä¸ªå­—æ®µå®šä¹‰ä¸ºvarchar(M),Mä»£è¡¨å­—ç¬¦ä¸ªæ•°ã€‚\n1:å¦‚æœ4*Må°äºç­‰äº255ï¼Œé‚£å°±ç”¨ä¸€ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºçœŸå®æ•°æ®å ç”¨çš„å­—èŠ‚æ•°ã€‚\n2:å¦‚æœ4*Må¤§äº255ï¼Œé‚£å°±åˆ†ä¸¤ç§æƒ…å†µï¼Œç¬¬ä¸€ç§æ˜¯è¯¥å˜é•¿å­—æ®µçš„å®é™…å­˜å‚¨çš„å­—ç¬¦ä¸²å ç”¨çš„å­—èŠ‚æ•°å°äºç­‰äº127ï¼Œå°±ç”¨ä¸€ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºçœŸå®æ•°æ®å ç”¨çš„å­—èŠ‚é•¿åº¦ï¼Œè‹¥å¤§äºäº†127å°±ç”¨2ä¸ªå­—èŠ‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1647440871,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1451391,"avatar":"https://static001.geekbang.org/account/avatar/00/16/25/7f/473d5a77.jpg","nickname":"æ›¾è½¼éºŸ","note":"","ucode":"D418371AC11270","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":363836,"discussion_content":"å †æ’åºæœ¬èº«å°±æ˜¯topNï¼Œå¯ä»¥æŠŠå¤šä½™çš„æ•°æ®æŒ¤å‡ºå»ï¼Œå¾ˆé€‚åˆlimitçš„åœºæ™¯","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1617288586,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2287841,"avatar":"https://static001.geekbang.org/account/avatar/00/22/e8/e1/6045b299.jpg","nickname":"LPF","note":"","ucode":"036C552D7251E9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":328625,"discussion_content":"å¯¹aåŠ 1ä¸å°±ç›¸å½“äºa++çš„æ“ä½œ è¯»å–aï¼Œ a + 1ï¼Œå¯¹aå†™å…¥a+1ï¼Œè¿™æ˜¯ä¸‰ä¸ªæ­¥éª¤ï¼Œæ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œéœ€è¦åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œæ‰€ä»¥è¯»å–çš„æ—¶å€™å°±éœ€è¦åŠ é”äº†ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1606197586,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1102771,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d3/b3/4f5550c0.jpg","nickname":"å¤§å®","note":"","ucode":"224458E5D1A35A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464,"discussion_content":"è¯·é—®ä¸€ä¸‹ï¼Œvarcharçš„é•¿åº¦è®¾ç½®=255ï¼Œéœ€è¦å‡ ä¸ªå­—èŠ‚è®°å½•é•¿åº¦å‘¢ï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1561602437,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1179312,"avatar":"https://static001.geekbang.org/account/avatar/00/11/fe/b0/260f41f0.jpg","nickname":"loris","note":"","ucode":"00842745CF4B31","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1102771,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d3/b3/4f5550c0.jpg","nickname":"å¤§å®","note":"","ucode":"224458E5D1A35A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":156723,"discussion_content":"1ä¸ªå­—èŠ‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580393767,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":464,"ip_address":""},"score":156723,"extra":""},{"author":{"id":1236620,"avatar":"https://static001.geekbang.org/account/avatar/00/12/de/8c/bd9d1868.jpg","nickname":"ã€‚","note":"","ucode":"089148414D59D2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1102771,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d3/b3/4f5550c0.jpg","nickname":"å¤§å®","note":"","ucode":"224458E5D1A35A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290024,"discussion_content":"varchar,255ä»¥å†… éœ€è¦é¢å¤–ä¸€ä¸ªå­—èŠ‚ï¼Œå¤§äº255éœ€è¦é¢å¤–çš„2ä¸ªã€‚é«˜æ€§èƒ½MySQL æœ‰æåˆ°","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1594304494,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":464,"ip_address":""},"score":290024,"extra":""},{"author":{"id":1255337,"avatar":"https://static001.geekbang.org/account/avatar/00/13/27/a9/80468562.jpg","nickname":"æµæ²™","note":"","ucode":"64F12F181650B6","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1102771,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d3/b3/4f5550c0.jpg","nickname":"å¤§å®","note":"","ucode":"224458E5D1A35A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":392337,"discussion_content":"255æ˜¯å­—ç¬¦ï¼Œä½†å…·ä½“çš„å ç”¨ç©ºé—´å­—èŠ‚æ•°æ˜¯ä¸ç¡®å®šçš„ï¼Œæ¯”å¦‚utf8å­—ç¬¦é›†ä¸‹ï¼Œç„¶åè®°å½•å¤šå°‘è‡ªå·±è®°å½•é•¿åº¦çš„å€¼ä¹Ÿæ˜¯å­—èŠ‚ï¼Œæ‰€ä»¥è¦æƒ³å ç”¨ä¸€ä¸ªå­—èŠ‚é•¿åº¦ï¼Œéœ€è¦è®°å½•çš„å­—ç¬¦ä¸²å ç”¨å­—èŠ‚æ•°å°äºç­‰äº 127ï¼Œä¸€ä¸ªå­—èŠ‚æ˜¯8ä¸ªæ¯”ç‰¹ä½ï¼Œmysqlä¼šä½¿ç”¨ä¸€ä¸ªæ¯”ç‰¹ä½è®°å½•å­—æ®µå ç”¨ä¸€ä¸ªå­—èŠ‚è¿˜æ˜¯ä¸¤ä¸ªå­—èŠ‚è®°å½•é•¿åº¦ï¼Œæ‰€ä»¥è¦æ§åˆ¶å­—ç¬¦ä¸²åœ¨ 127ä¸ªå­—èŠ‚ä»¥å†…ï¼Œæ‰èƒ½ç”¨ä¸€ä¸ªå­—èŠ‚è®°å½•å­—æ®µé•¿åº¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630975410,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":464,"ip_address":""},"score":392337,"extra":""}]},{"author":{"id":1204353,"avatar":"https://static001.geekbang.org/account/avatar/00/12/60/81/eaf6d0ac.jpg","nickname":"æ‹‰å¸ƒæ‹‰å¤š","note":"","ucode":"637A88D9F29F57","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350382,"discussion_content":"è¿™ä¸ªç•™è¨€èµã€‚æœ‰éš¾åº¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613832379,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2407688,"avatar":"https://static001.geekbang.org/account/avatar/00/24/bd/08/4c0f9d3a.jpg","nickname":"Y-Meta","note":"","ucode":"08A4D621F1F1C0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":347094,"discussion_content":"å­¦ä¹ äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612151351,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70884,"user_name":"XD","can_delete":false,"product_type":"c1","uid":1079293,"ip_address":"","ucode":"DC9DCFB3841A4E","user_header":"https://static001.geekbang.org/account/avatar/00/10/77/fd/c6619535.jpg","comment_is_top":true,"comment_ctime":1551202074,"is_pvip":false,"replies":[{"id":"26078","content":"<br>ä¸ä»…å¯¹ï¼Œè€Œä¸”éå¸¸å¥½ï¼ğŸ‘ğŸ‘<br><br>æŠŠä¸¤ä¸ªçŸ¥è¯†ç‚¹è¿èµ·æ¥äº†ã€‚æ˜¯çš„ï¼š<br>1. rows_examinedå°±æ˜¯â€œserverå±‚è°ƒç”¨å¼•æ“å–ä¸€è¡Œçš„æ—¶å€™â€åŠ 1ï¼›<br>2. å¼•æ“å†…éƒ¨è‡ªå·±è°ƒç”¨ï¼Œè¯»å–è¡Œï¼Œä¸åŠ 1ï¼›<br><br>å†è¡¥å……ä¸€ä¸ªä¾‹å­ï¼š<br>åŠ ç´¢å¼•çš„æ—¶å€™ï¼Œä¹Ÿè¦æ‰«æå…¨è¡¨ï¼Œä½†å¦‚æœæ˜¯inplace DDLï¼ˆ@ç¬¬13ç¯‡ï¼‰ï¼Œä½ ä¼šçœ‹åˆ°æ‰«æè¡Œæ•°æ˜¯0ï¼Œä¹Ÿæ˜¯å› ä¸ºè¿™äº›æ‰«æåŠ¨ä½œéƒ½æ˜¯å¼•æ“å†…éƒ¨è‡ªå·±è°ƒç”¨çš„ã€‚<br><br>","user_name":"ä½œè€…å›å¤","comment_id":70884,"uid":"1264162","ip_address":"","utype":1,"ctime":1551510023,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":5,"race_medal":0,"score":"9.2233726010467e+18","product_id":100020801,"comment_content":"è€å¸ˆï¼ŒåŸºäºæ—©ä¸ŠçŸ¥é“çš„sort_bufferæ˜¯åœ¨serverå±‚ï¼Œæˆ‘é‡æ–°ç†è§£äº†ä¸‹rowidæ’åºçš„è¿‡ç¨‹ï¼Œ<br>1ï¼Œæ‰§è¡Œå™¨æŸ¥çœ‹è¡¨å®šä¹‰ï¼Œå‘ç°nameã€cityã€ageå­—æ®µçš„é•¿åº¦ä¹‹å’Œè¶…è¿‡max_length_for_sort_dataï¼Œæ‰€ä»¥åˆå§‹åŒ–sort_bufferçš„æ—¶å€™åªæ”¾å…¥idå’Œnameå­—æ®µã€‚<br>2ï¼Œæ‰§è¡Œå™¨è°ƒç”¨å­˜å‚¨å¼•æ“çš„è¯»æ•°æ®æ¥å£ï¼Œä¾æ¬¡è·å–æ»¡è¶³æ¡ä»¶çš„æ•°æ®çš„idå’Œnameï¼Œå­˜å…¥sort_bufferã€‚<br>3ï¼Œæ’åºã€‚<br>4ï¼Œæ‰§è¡Œå™¨æ ¹æ®limitæ¡ä»¶ç­›é€‰å‡ºidï¼Œå†æ¬¡è°ƒç”¨å¼•æ“è¯»æ•°æ®çš„æ¥å£è·å–ç›¸åº”çš„æ•°æ®ï¼Œè¿”å›å®¢æˆ·ç«¯ã€‚<br>æ•´ä¸ªè¿‡ç¨‹å®é™…ä¸Šæ˜¯è¢«æ‰§è¡Œå™¨æ‹†æˆäº†ä¸¤æ¬¡æŸ¥è¯¢ï¼Œå…±è°ƒç”¨ä¸¤æ¬¡å­˜å‚¨å±‚çš„è¯»æ•°æ®æ¥å£ï¼Œæ‰€ä»¥æ€»çš„æ‰«æè¡Œæ•°éœ€è¦ç›¸åŠ ã€‚ï¼ˆ@b-@a=5000ï¼‰<br><br>ä½†æ˜¯å¯¹äºusing index conditionçš„åœºæ™¯ï¼Œæ‰§è¡Œå™¨åªè°ƒç”¨äº†ä¸€æ¬¡æŸ¥è¯¢æ¥å£ï¼Œå›è¡¨æ˜¯ç”±å­˜å‚¨å±‚æ¥å®Œæˆçš„ï¼Œæ‰€ä»¥æ‰«æè¡Œæ•°åªç®—ä¸€æ¬¡ï¼Œå³åªç®—èµ°ç´¢å¼•æœç´¢çš„è¿‡ç¨‹ä¸­æ‰«æçš„è¡Œæ•°ã€‚ï¼ˆ@b-@aåªä¼šæ˜¯4000ï¼‰<br><br>ä¸çŸ¥é“è¿™ä¹ˆç†è§£å¯¹ä¸å¯¹ï¼Ÿ","like_count":132,"discussions":[{"author":{"id":1285652,"avatar":"","nickname":"mycat","note":"","ucode":"6878BD32D042F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308297,"discussion_content":"ç»“åˆæ–‡ç« ä¸­çš„sqlè¯­å¥ï¼Œå¯¹äºusing index conditionåº”è¯¥æ˜¯æŒ‡æ‰«æäº†1000è¡Œå§ï¼Ÿå› ä¸ºæœ‰limit 1000è¿™ä¸ªæ¡ä»¶ã€‚æ¥¼ä¸»è¯´çš„@b-@aæ˜¯æŒ‡æ²¡æœ‰limitè¯­å¥çš„æƒ…å†µä¸‹ï¼Œrowidæ’åºå’Œåœ¨cityã€nameä¸Šå»ºç«‹ç»„åˆç´¢å¼•çš„æƒ…å†µä¸‹æ’åºè¯­å¥çš„æ‰«æè¡Œæ•°å§ï¼Ÿ","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1600910517,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"ä¸€å…ƒ(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303047,"discussion_content":"æœ‰ä¸ªç–‘æƒ‘ï¼Œæ„Ÿè§‰æŒ‰ç…§å•è¡Œé•¿åº¦æ¥åˆ¤æ–­æ˜¯å¦ä½¿ç”¨rowidæ’åºä¸å‡†ç¡®å“ã€‚å¦‚æœæ˜¯å•è¡Œå¾ˆå¤§ï¼Œä½†æ²¡æœ‰å‡ è¡Œï¼Œæ€»å…±å ç”¨å†…å­˜å¤§å°å°äºsort_bufferå‘¢ï¼Ÿæœ¬è´¨ä¸Šä¸åº”è¯¥æ˜¯ç¬¦åˆæ¡ä»¶çš„ç»“æœå¤ªå¤šï¼Œå¯¼è‡´çš„sort_bufferæ— æ³•å®Œå…¨æ”¾ä¸‹ï¼Œå¿…é¡»åˆ†å‰²ä¸ºç£ç›˜çš„ä¸´æ—¶æ–‡ä»¶æ¥è¿›è¡Œå½’å¹¶æ’åºçš„é—®é¢˜å—ï¼Ÿ","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1599121251,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1110677,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f2/95/538d0348.jpg","nickname":"wrp000000","note":"","ucode":"4860119F2276FE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"ä¸€å…ƒ(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303595,"discussion_content":"ï¼ˆççŒœæµ‹ï¼‰å¦‚å±‚ä¸»æ‰€è¯´ï¼ŒServerå±‚åœ¨å¼€å§‹çš„æ—¶å€™æ˜¯ä¸çŸ¥é“ç©¶ç«Ÿæœ‰å¤šå°‘ç¬¦åˆæ¡ä»¶çš„ç»“æœçš„æ•°é‡çš„ï¼Œåªèƒ½æŒ‰ç…§å•è¡Œçš„é•¿åº¦åˆ¤è¯»å–nameå’Œidå¦‚æœæ‰«å®Œä¹‹åå‘ç°åªæœ‰ä¸‰å››è¡Œï¼Œå†å›è¡¨æŸ¥è¯¢ä¸»é”®ç´¢å¼•ï¼Œè¿™ä¸ªæ—¶å€™æ²¡æœ‰ç”¨åˆ°ç£ç›˜çš„ä¸´æ—¶æ–‡ä»¶ï¼Œåº”è¯¥å¢åŠ çš„åªæ˜¯å‡ æ¬¡æŸ¥è¯¢ä¸»é”®çš„å¼€é”€ã€‚å¦å¤–æˆ‘è®¤ä¸ºåˆ†å‰²æˆçš„ä¸´æ—¶æ–‡ä»¶çš„å¤§å°åº”è¯¥æ˜¯å’Œsort_buffer_sizeå¤§å°ç›¸å½“çš„å§","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1599309578,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":303047,"ip_address":""},"score":303595,"extra":""}]},{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440885,"discussion_content":"\nä¸ä»…å¯¹ï¼Œè€Œä¸”éå¸¸å¥½ï¼ğŸ‘ğŸ‘\n\næŠŠä¸¤ä¸ªçŸ¥è¯†ç‚¹è¿èµ·æ¥äº†ã€‚æ˜¯çš„ï¼š\n1. rows_examinedå°±æ˜¯â€œserverå±‚è°ƒç”¨å¼•æ“å–ä¸€è¡Œçš„æ—¶å€™â€åŠ 1ï¼›\n2. å¼•æ“å†…éƒ¨è‡ªå·±è°ƒç”¨ï¼Œè¯»å–è¡Œï¼Œä¸åŠ 1ï¼›\n\nå†è¡¥å……ä¸€ä¸ªä¾‹å­ï¼š\nåŠ ç´¢å¼•çš„æ—¶å€™ï¼Œä¹Ÿè¦æ‰«æå…¨è¡¨ï¼Œä½†å¦‚æœæ˜¯inplace DDLï¼ˆ@ç¬¬13ç¯‡ï¼‰ï¼Œä½ ä¼šçœ‹åˆ°æ‰«æè¡Œæ•°æ˜¯0ï¼Œä¹Ÿæ˜¯å› ä¸ºè¿™äº›æ‰«æåŠ¨ä½œéƒ½æ˜¯å¼•æ“å†…éƒ¨è‡ªå·±è°ƒç”¨çš„ã€‚\n\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1551510023,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"ä¸€å…ƒ(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303051,"discussion_content":"å¯¹äºè¯¾åä¹ é¢˜ï¼Œæˆ‘å€’æ˜¯æƒ³åˆ°äº†ä¸ç”¨æ’åºçš„æ–¹æ³•ï¼ŒæŒ‰ç…§ ï¼ˆnameï¼Œcityï¼‰å»ºç«‹å¤åˆç´¢å¼•ï¼Œç”±äºç´¢å¼•ä¸‹æ¨çš„æ”¯æŒï¼Œåœ¨ä¸å›è¡¨çš„æƒ…å†µä¸‹ä¹Ÿèƒ½è¿…é€Ÿæ·˜æ±°ä¸ç¬¦åˆæ¡ä»¶çš„å¶å­èŠ‚ç‚¹ï¼Œä½†è¿™ä¸ªæ—¶é—´å¤æ‚åº¦ä¸Šå°±æ˜¯ Oï¼ˆnï¼‰äº†ï¼Œå¦‚æœè¯¥è¡¨ä¸­çš„æ•°æ®é‡ç‰¹åˆ«å¤§ï¼Œæ˜¾ç„¶ä¹Ÿæ˜¯ä¸å¯å–çš„","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1599121794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51632,"user_name":"didiren","can_delete":false,"product_type":"c1","uid":1305376,"ip_address":"","ucode":"8341F02F2ABA60","user_header":"https://static001.geekbang.org/account/avatar/00/13/eb/20/a02c4f61.jpg","comment_is_top":true,"comment_ctime":1545211499,"is_pvip":false,"replies":[{"id":"18685","content":"æ˜¯çš„ã€‚<br><br>è¿™ä¸ªæˆ‘ä¹Ÿç›²ç‚¹äº†ã€‚<br><br>ä½†æ˜¯ç»†æƒ³MySQL é€‰æ‹©è¿™ä¸ªç­–ç•¥åˆæ˜¯åˆç†çš„ã€‚<br><br>æˆ‘éœ€è¦å†æ›´æ–°ä¸€ä¸‹ä¸“æ å†…å®¹","user_name":"ä½œè€…å›å¤","comment_id":51632,"uid":"1264162","ip_address":"","utype":1,"ctime":1545217439,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":7,"race_medal":0,"score":"9.2233722789181993e+18","product_id":100020801,"comment_content":"åˆšæ‰åˆæµ‹äº†ä¸€ä¸‹ï¼Œåœ¨binlog-row-image=fullçš„æƒ…å†µä¸‹ï¼Œç¬¬äºŒæ¬¡updateæ˜¯ä¸å†™redologçš„ï¼Œè¯´æ˜updateå¹¶æ²¡æœ‰å‘ç”Ÿ<br>è¿™æ ·æˆ‘å°±ç†è§£äº†ï¼Œå½“fullæ—¶ï¼Œmysqléœ€è¦è¯»åˆ°åœ¨æ›´æ–°æ—¶è¯»åˆ°aå€¼ï¼Œæ‰€ä»¥ä¼šåˆ¤æ–­aå€¼ä¸å˜ï¼Œä¸éœ€è¦æ›´æ–°ï¼Œä¸ä½ ç»™å‡ºçš„update t set a=3 where id=1 and a=3åŸç†ç›¸åŒï¼Œä½†binlog-row-imageä¼šå½±å“æŸ¥è¯¢ç»“æœè¿˜æ˜¯ä¼šè®©äººåƒä¸€æƒŠ","like_count":57,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433542,"discussion_content":"æ˜¯çš„ã€‚\n\nè¿™ä¸ªæˆ‘ä¹Ÿç›²ç‚¹äº†ã€‚\n\nä½†æ˜¯ç»†æƒ³MySQL é€‰æ‹©è¿™ä¸ªç­–ç•¥åˆæ˜¯åˆç†çš„ã€‚\n\næˆ‘éœ€è¦å†æ›´æ–°ä¸€ä¸‹ä¸“æ å†…å®¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545217439,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1149502,"avatar":"https://static001.geekbang.org/account/avatar/00/11/8a/3e/30c05bce.jpg","nickname":"aliang","note":"","ucode":"B36B94B362477F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":296022,"discussion_content":"ä½ å¥½ï¼Œæˆ‘è¿™è¾¹ç”¨mysql 5.7.22æµ‹è¯•ï¼Œç»“æœå’Œä½ çš„ä¸ä¸€æ ·ï¼Œå¥‡æ€ªå¾—å¾ˆã€‚binlog_format=rowï¼Œå¯é‡å¤è¯»éš”ç¦»çº§åˆ«ï¼š\nï¼ˆ1ï¼‰binlog_row_image=fullã€‚session A æ‰§è¡Œ update t set a=2 where id=1; å‘ç°binlogï¼ˆshow master statusï¼‰å’Œredoï¼ˆshow engine innodb statusï¼‰éƒ½æ²¡å†™ã€‚\nï¼ˆ2ï¼‰binlog_row_image=fullã€‚session A æ‰§è¡Œ update t set a=2 where id=1 and a=2; å‘ç°binlogæ²¡å†™ï¼Œredoå†™äº†ã€‚\nï¼ˆ3ï¼‰binlog_row_image=MINIMALã€‚session A æ‰§è¡Œ update t set a=2 where id=1; å‘ç°binlogæ²¡å†™ï¼Œredoå†™äº†ã€‚\nï¼ˆ4ï¼‰binlog_row_image=MINIMALã€‚session A æ‰§è¡Œ update t set a=2 where id=1 and a=2; å‘ç°binlogå’Œredoéƒ½æ²¡å†™ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1596430116,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1346267,"avatar":"https://static001.geekbang.org/account/avatar/00/14/8a/db/76ab84c6.jpg","nickname":"å°è±¹å­","note":"","ucode":"972F3E6BF0FDEA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":36507,"discussion_content":"binlog-row-image=minimalä¹Ÿè¡Œï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦binlog_format=rowå°±è¡Œ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1571386244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1732823,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/70/d7/d1049bae.jpg","nickname":"Geek_3004e0","note":"","ucode":"441D39BDC39E4A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":55901,"discussion_content":"binlogä¸æ˜¯åœ¨æ›´æ–°åˆ°preparedä¹‹åæ‰å†™binlogå—ï¼Œä¸ºä»€ä¹ˆæå‰è¯»binlogåˆ¤æ–­æ•°æ®æ˜¯å¦ä¸€è‡´ï¼Ÿæ›´ç³Šæ¶‚äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574410798,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1732823,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/70/d7/d1049bae.jpg","nickname":"Geek_3004e0","note":"","ucode":"441D39BDC39E4A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":159026,"discussion_content":"è¿™æ ·å°±å¯ä»¥å°‘å†™ä¸€æ¬¡binlog","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580649139,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":55901,"ip_address":""},"score":159026,"extra":""},{"author":{"id":2843604,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/63/d4/b63373c3.jpg","nickname":"é‡‘é‡‘","note":"","ucode":"807EDDCDB2E939","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1732823,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/70/d7/d1049bae.jpg","nickname":"Geek_3004e0","note":"","ucode":"441D39BDC39E4A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":581068,"discussion_content":"ä¸æ˜¯è¿™ä¸ªæ„æ€ï¼Œæ˜¯å› ä¸ºbinlogæ ¼å¼æ˜¯row+fullï¼Œæ‰€ä»¥mysqlæœåŠ¡å±‚é‚£é‡Œéœ€è¦è¯»å‡ºä¸€ä¸ªå…ƒç»„çš„æ‰€æœ‰æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™è¿˜æ²¡æœ‰å†™binlogå‘¢ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡è¿™ä¸ªæ•°æ®æ¥åˆ¤æ–­åˆ°åº•éœ€ä¸éœ€è¦è¿›è¡Œæ›´æ–°æ“ä½œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658482764,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":55901,"ip_address":""},"score":581068,"extra":""}]},{"author":{"id":1210699,"avatar":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","nickname":"-W.LI-","note":"","ucode":"3556786538664F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6965,"discussion_content":"ä¸ºä»€ä¹ˆå¤§ä½¬ä»¬éƒ½è¿™ä¹ˆä¼˜ç§€ã€‚è†œæ‹œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567229179,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52273,"user_name":"null","can_delete":false,"product_type":"c1","uid":1024294,"ip_address":"","ucode":"F9039EFED6B55D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","comment_is_top":true,"comment_ctime":1545356740,"is_pvip":false,"replies":[{"id":"18996","content":"æœ€æ€•çš„å›ç­”â€œå†å²åŸå› â€ã€â€œå¤§å®¶éƒ½è¿™ä¹ˆåšçš„æ‰€ä»¥â€¦â€ã€â€œåˆ«äººè¦æ±‚çš„â€ ğŸ˜„","user_name":"ä½œè€…å›å¤","comment_id":52273,"uid":"1264162","ip_address":"","utype":1,"ctime":1545360101,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":8,"race_medal":0,"score":"9.2233722402636001e+18","product_id":100020801,"comment_content":"re: é—®é¢˜3:å›ç­”å¾—ä¹Ÿå¾ˆå¥½ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯255è¿™ä¸ªè¾¹ç•Œã€‚å°äº255éƒ½éœ€è¦ä¸€ä¸ªå­—èŠ‚è®°å½•é•¿åº¦ï¼Œè¶…è¿‡255å°±éœ€è¦ä¸¤ä¸ªå­—èŠ‚<br><br>11 æœˆè¿‡æ•°æ®åº“è®¾è®¡æ–¹æ¡ˆï¼Œæ€»ç›‘ç°åœºæŠ›äº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å…³äº varchar 255 çš„ã€‚ç°åœ¨å›çœ‹ï¼Œæœ¨æœ‰äººå›ç­”åˆ°ç‚¹ä¸Šï¼Œéƒ½è¯´æ˜¯å†å²åŸå› ã€‚<br>ä¸‹å›å†é—®ï¼Œå°±å¯ä»¥åˆ†äº«è¿™ä¸€ç‚¹äº†ã€‚ê‰‚ à³­(ËµÂ¯Ì´Í’ê‡´Â¯Ì´Í’Ëµ)à±¨â€å“‡å“ˆå“ˆï½","like_count":47,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433815,"discussion_content":"æœ€æ€•çš„å›ç­”â€œå†å²åŸå› â€ã€â€œå¤§å®¶éƒ½è¿™ä¹ˆåšçš„æ‰€ä»¥â€¦â€ã€â€œåˆ«äººè¦æ±‚çš„â€ ğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545360101,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2080208,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/bd/d0/070824d1.jpg","nickname":"ç©ºåŸã€‚","note":"","ucode":"0F6F110D811C2E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":305247,"discussion_content":"ä¸€ä¸ª8ä½å­—èŠ‚èƒ½è¡¨ç¤ºçš„æœ€å¤§æ— ç¬¦å·æ•´æ•°æ˜¯255","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1599827639,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1221991,"avatar":"https://static001.geekbang.org/account/avatar/00/12/a5/67/bf286335.jpg","nickname":"AllenGFLiu","note":"","ucode":"90FA8A619A2629","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":310934,"discussion_content":"å‡å¦‚å»ºåˆ¶äº†ä¸€ä¸ªvarchar(255),ä»£è¡¨æ­¤å­—æ®µæœ€å¤šèƒ½ä¿å­˜255ä¸ªå­—ç¬¦(ä¸­è‹±æ–‡éƒ½åªå ä¸€ä¸ªï¼‰ï¼Œä¸€ä¸ªå­—ç¬¦æ˜¯ä¸€ä¸ªbyteï¼Œé‚£255ä¸ªå­—ç¬¦å°±æ˜¯255ä¸ªbyteäº†ï¼Ÿ\nè€å¸ˆçš„æ„æ€æ˜¯åªè¦255ä»¥å†…ï¼Œé‚£éƒ½å¯ä»¥åªç”¨ä¸€ä¸ªbyteå°±èƒ½å­˜å‚¨äº†ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602145836,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1562105,"avatar":"https://static001.geekbang.org/account/avatar/00/17/d5/f9/39ceecda.jpg","nickname":"é£é›¨ä¸€æ›´","note":"","ucode":"A1D71115ECCF9F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1221991,"avatar":"https://static001.geekbang.org/account/avatar/00/12/a5/67/bf286335.jpg","nickname":"AllenGFLiu","note":"","ucode":"90FA8A619A2629","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362783,"discussion_content":"1ä¸ªå­—èŠ‚8ä½ï¼Œæœ€å¤§å€¼æ˜¯ 255ï¼Œç”¨æ¥è®°å½• varchar çš„é•¿åº¦ã€‚å¦‚æœå¤§äº255ï¼Œ1ä¸ªå­—èŠ‚æ— æ³•å­˜å‚¨ï¼Œå› æ­¤éœ€è¦2ä¸ªå­—èŠ‚ï¼ˆ16ä½ï¼‰\n--å¤åˆ¶ä¸‹é¢çš„nullçš„å›å¤","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1617026950,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":310934,"ip_address":""},"score":362783,"extra":""}]},{"author":{"id":1673409,"avatar":"https://static001.geekbang.org/account/avatar/00/19/88/c1/d0136c63.jpg","nickname":"ç”œå…¬å­Timmy","note":"","ucode":"E6E90C518CDAC2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":249816,"discussion_content":"èƒ½å¦è¿›ä¸€æ­¥é˜è¿°ä¸€ä¸‹ï¼Œä¸æ˜¯å¾ˆæ˜ç™½è¿™é‡Œçš„é—®é¢˜æ˜¯ä»€ä¹ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587964760,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1024294,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","nickname":"null","note":"","ucode":"F9039EFED6B55D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1673409,"avatar":"https://static001.geekbang.org/account/avatar/00/19/88/c1/d0136c63.jpg","nickname":"ç”œå…¬å­Timmy","note":"","ucode":"E6E90C518CDAC2","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":250442,"discussion_content":"1ä¸ªå­—èŠ‚8ä½ï¼Œæœ€å¤§å€¼æ˜¯ 255ï¼Œç”¨æ¥è®°å½• varchar çš„é•¿åº¦ã€‚å¦‚æœå¤§äº255ï¼Œ1ä¸ªå­—èŠ‚æ— æ³•å­˜å‚¨ï¼Œå› æ­¤éœ€è¦2ä¸ªå­—èŠ‚ï¼ˆ16ä½ï¼‰","likes_number":8,"is_delete":false,"is_hidden":false,"ctime":1588002199,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":249816,"ip_address":""},"score":250442,"extra":""}]},{"author":{"id":1019332,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","nickname":"é•¿æœŸè§„åˆ’","note":"","ucode":"5EF65E9115834B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":53013,"discussion_content":"å­¦ä¹ äº†ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574124020,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1812970,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a9/ea/5bfce6c5.jpg","nickname":"mgs2002","note":"","ucode":"F5931108BD509B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1019332,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","nickname":"é•¿æœŸè§„åˆ’","note":"","ucode":"5EF65E9115834B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":282652,"discussion_content":"+1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592038067,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":53013,"ip_address":""},"score":282652,"extra":""}]}]},{"had_liked":false,"id":51456,"user_name":"è€æ¨åŒå¿—","can_delete":false,"product_type":"c1","uid":1246199,"ip_address":"","ucode":"3F334F0CFD3DE6","user_header":"https://static001.geekbang.org/account/avatar/00/13/03/f7/3a493bec.jpg","comment_is_top":false,"comment_ctime":1545185067,"is_pvip":false,"replies":[{"id":"18635","content":"ä»ä¸šåŠ¡ä¸Šç æ‰åŠŸèƒ½ï¼Œè¿™ä¸ªæ„è¯†å¾ˆå¥½ğŸ‘ŒğŸ‘ğŸ¿","user_name":"ä½œè€…å›å¤","comment_id":51456,"uid":"1264162","ip_address":"","utype":1,"ctime":1545193715,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":4,"race_medal":0,"score":"340847601451","product_id":100020801,"comment_content":"1)<br>mysql&gt; select * from t where city in (&#39;æ­å·&#39;,&quot; è‹å· &quot;) order by name limit 100;<br>éœ€è¦æ’åº<br>åŸå› æ˜¯ç´¢å¼•é¡ºåºåŸå¸‚ã€åç§° ä¸ å•ç‹¬æŒ‰nameæ’åºçš„é¡ºåºä¸ä¸€è‡´ã€‚<br><br>2ï¼‰å¦‚æœä¸æƒ³mysqlæ’åº<br>æ–¹æ¡ˆa<br>å¯ä»¥æ‰§è¡Œä¸¤æ¡è¯­å¥<br>select * from t where city = &#39;æ­å·&#39;  limit 100;<br>select * from t where city = &#39;è‹å·&#39;  limit 100;<br>ç„¶åæŠŠ200æ¡è®°å½•åœ¨javaä¸­æ’åºã€‚<br>æ–¹æ¡ˆb<br>åˆ†åˆ«å–å‰100ï¼Œç„¶ååœ¨æ•°æ®ç«¯å¯¹200æ¡æ•°æ®è¿›è¡Œæ’åºã€‚å¯ä»¥sort bufferå°±å¯ä»¥å®Œæˆæ’åºäº†ã€‚<br>å°‘äº†ä¸€æ¬¡åº”ç”¨ç¨‹åºä¸æ•°æ®åº“çš„ç½‘ç»œäº¤äº’<br>select * from (<br>\tselect * from t where city = &#39;æ­å·&#39;  limit 100<br>\tunion all<br>  select * from t where city = &#39;è‹å·&#39;  limit 100<br>) as tt order by name limit 100<br><br><br>3ï¼‰å¯¹åˆ†é¡µçš„ä¼˜åŒ–ã€‚<br>  æ²¡æœ‰ç‰¹åˆ«å¥½çš„åŠæ³•ã€‚å¦‚æœä¸šåŠ¡å…è®¸ä¸æä¾›æ’åºåŠŸèƒ½ï¼Œä¸æä¾›æŸ¥è¯¢æœ€åä¸€é¡µï¼Œåªèƒ½ä¸€é¡µä¸€é¡µçš„ç¿»ï¼ŒåŸºæœ¬ä¸Šå‰å‡ é¡µçš„æ•°æ®å·²ç»æ»¡è¶³å®¢æˆ·éœ€æ±‚ã€‚<br>  ä¸ºäº†æ„ä¹‰ä¸å¤§çš„åŠŸèƒ½ä¼˜åŒ–ï¼Œå¯èƒ½ä¼šå¾—ä¸å¿å¤±ã€‚<br>  å¦‚æœä¸€å®šè¦ä¼˜åŒ–å¯ä»¥ select id from t where city in (&#39;æ­å·&#39;,&quot; è‹å· &quot;) order by name limit 10000,100<br>  å› ä¸ºæœ‰city\\nameç´¢å¼•ï¼Œä¸Šé¢çš„è¯­å¥èµ°è¦†ç›–ç´¢å¼•å°±å¯ä»¥å®Œæˆï¼Œä¸ç”¨å›è¡¨ã€‚<br>  æœ€åä½¿ç”¨ select * from t where id in (); å–å¾—ç»“æœ<br>  å¯¹äºè¿™ä¸ªä¼˜åŒ–æ–¹æ³•ï¼Œæˆ‘ä¸å¥½ç¡®å®šçš„æ˜¯ä¸´ç•Œç‚¹ï¼Œå‰å‡ é¡µç›´æ¥æŸ¥è¯¢å°±å¯ä»¥ï¼Œæœ€åå‡ é¡µä½¿ç”¨è¿™ä¸ªä¼˜åŒ–æ–¹æ³•ã€‚<br>  ä½†æ˜¯ä¸­é—´çš„é¡µç åº”è¯¥æ€ä¹ˆé€‰æ‹©ä¸å¤ªæ¸…æ¥š<br>  ","like_count":80,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433461,"discussion_content":"ä»ä¸šåŠ¡ä¸Šç æ‰åŠŸèƒ½ï¼Œè¿™ä¸ªæ„è¯†å¾ˆå¥½ğŸ‘ŒğŸ‘ğŸ¿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545193715,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2086624,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/d6/e0/3ccaaa7b.jpg","nickname":"é¢†å­","note":"","ucode":"64AC4E6AB74E68","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294586,"discussion_content":"å¯¹äº2ï¼‰\n1 ã€å› ä¸ºè¦åˆ†é¡µï¼Œè¿™ç§å†™æ³•ï¼Œåœ¨ç¿»é¡µçš„è¿‡ç¨‹ä¸­å°±ä¼šä¸¢å¤±æ•°æ®ï¼Œä¸èƒ½ä¸€å‘³çš„é¿å…æ’åº\n2ã€ å¦‚æœcityå­—æ®µåŸºæ•°é«˜ï¼Œå¯ä»¥èˆå¼ƒé¿å…æ’åºï¼Œç›´æ¥ä»¥cityåšä¸ºç´¢å¼•å‰ç«¯åˆ—ï¼Œè¿™æ ·éœ€è¦å›è¡¨æŒ‰nameæ’åºå°±å°‘\n3ã€ å¦‚æœcityåŸºæ•°ä½ï¼Œé‚£ä¹ˆå°±åªèƒ½èˆå¼ƒè¿™ä¸ªinæŸ¥è¯¢ï¼Œæˆ–è€…è®¾è®¡ä¸ºå¿…é¡»åŠ ä¸€ä¸ªåŸºæ•°é«˜çš„æ¡ä»¶å­—æ®µï¼Œä»¥æ»¡è¶³ä¸Šé¢çš„2,é™ä½å›è¡¨æ’åºæ•°é‡\n4ã€å¯ä»¥å»ºä¸€ä¸ªå®½ç´¢å¼•(å…¨å­—æ®µ)ï¼Œè¿™æ ·å¯ä»¥é¿å…æ’åºçš„æ—¶å€™å›è¡¨ï¼Œæé«˜æ€§èƒ½","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1595933455,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1139384,"avatar":"https://static001.geekbang.org/account/avatar/00/11/62/b8/bb9657c6.jpg","nickname":"PromiseÂ°","note":"","ucode":"0BFDBDAD852D6D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":68161,"discussion_content":"å¯¹äºæ‚¨è¯´çš„ç¬¬ä¸‰æ¡ å¦‚æœä¸šåŠ¡æ–¹ä¸€æ¡æ¡å»ç¿»é¡µæŸ¥çœ‹çš„è¯ å¯ä»¥è€ƒè™‘å‰å°æŠŠå½“å‰é¡µçš„æœ€å¤§idä¼ è¿‡æ¥ sqlä¸Šå°±å¯ä»¥åŠ ä¸Š where idã€‹9999 å‡å°‘æ•°æ®æœç´¢çš„èŒƒå›´","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575204733,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1106464,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e2/20/1b5e8104.jpg","nickname":"String name=null;","note":"","ucode":"B9FE31B598C386","race_medal":4,"user_type":1,"is_pvip":false},"reply_author":{"id":1139384,"avatar":"https://static001.geekbang.org/account/avatar/00/11/62/b8/bb9657c6.jpg","nickname":"PromiseÂ°","note":"","ucode":"0BFDBDAD852D6D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":209980,"discussion_content":"ä½†æ˜¯æ˜¯æŒ‰ç…§nameæ’åºçš„ï¼Œé€šè¿‡è¿”å›ä¸Šä¸€é¡µæœ€å¤§idè¿›è¡Œæ¸¸æ ‡åˆ†é¡µæ˜¯é”™è¯¯çš„","likes_number":9,"is_delete":false,"is_hidden":false,"ctime":1584697007,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":68161,"ip_address":""},"score":209980,"extra":""}]}]},{"had_liked":false,"id":51547,"user_name":"æ³¢æ³¢","can_delete":false,"product_type":"c1","uid":1308565,"ip_address":"","ucode":"9C908575D0A8B5","user_header":"https://static001.geekbang.org/account/avatar/00/13/f7/95/3ebafd36.jpg","comment_is_top":false,"comment_ctime":1545197611,"is_pvip":false,"replies":[{"id":"19037","content":"ğŸ‘ğŸ¿","user_name":"ä½œè€…å›å¤","comment_id":51547,"uid":"1264162","ip_address":"","utype":1,"ctime":1545372688,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"293602973739","product_id":100020801,"comment_content":"ç¬”è®°:<br>1.MySQLä¼šä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ªå†…å­˜ï¼ˆsort_bufferï¼‰ç”¨äºæ’åºè¯¥å†…å­˜å¤§å°ä¸ºsort_buffer_size<br>  1&gt;å¦‚æœæ’åºçš„æ•°æ®é‡å°äºsort_buffer_sizeï¼Œæ’åºå°†ä¼šåœ¨å†…å­˜ä¸­å®Œæˆ<br>  2&gt;å¦‚æœæ’åºæ•°æ®é‡å¾ˆå¤§ï¼Œå†…å­˜ä¸­æ— æ³•å­˜ä¸‹è¿™ä¹ˆå¤šæ•°æ®ï¼Œåˆ™ä¼šä½¿ç”¨ç£ç›˜ä¸´æ—¶æ–‡ä»¶æ¥è¾…åŠ©æ’åºï¼Œä¹Ÿç§°å¤–éƒ¨æ’åº<br>  3&gt;åœ¨ä½¿ç”¨å¤–éƒ¨æ’åºæ—¶ï¼ŒMySQLä¼šåˆ†æˆå¥½å‡ ä»½å•ç‹¬çš„ä¸´æ—¶æ–‡ä»¶ç”¨æ¥å­˜æ”¾æ’åºåçš„æ•°æ®ï¼Œç„¶ååœ¨å°†è¿™äº›æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªå¤§æ–‡ä»¶<br><br><br>2.mysqlä¼šé€šè¿‡éå†ç´¢å¼•å°†æ»¡è¶³æ¡ä»¶çš„æ•°æ®è¯»å–åˆ°sort_bufferï¼Œå¹¶ä¸”æŒ‰ç…§æ’åºå­—æ®µè¿›è¡Œå¿«é€Ÿæ’åº<br>\t1&gt;å¦‚æœæŸ¥è¯¢çš„å­—æ®µä¸åŒ…å«åœ¨è¾…åŠ©ç´¢å¼•ä¸­ï¼Œéœ€è¦æŒ‰ç…§è¾…åŠ©ç´¢å¼•è®°å½•çš„ä¸»é”®è¿”å›èšé›†ç´¢å¼•å–å‡ºæ‰€éœ€å­—æ®µ<br>  \t2&gt;è¯¥æ–¹å¼ä¼šé€ æˆéšæœºIOï¼Œåœ¨MySQL5.6æä¾›äº†MRRçš„æœºåˆ¶ï¼Œä¼šå°†è¾…åŠ©ç´¢å¼•åŒ¹é…è®°å½•çš„ä¸»é”®å–å‡ºæ¥åœ¨å†…å­˜ä¸­è¿›è¡Œæ’åºï¼Œç„¶ååœ¨å›è¡¨<br> \t3&gt;æŒ‰ç…§æƒ…å†µå»ºç«‹è”åˆç´¢å¼•æ¥é¿å…æ’åºæ‰€å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Œå…è®¸çš„æƒ…å†µä¸‹ä¹Ÿå¯ä»¥å»ºç«‹è¦†ç›–ç´¢å¼•æ¥é¿å…å›è¡¨<br><br>å…¨å­—æ®µæ’åº<br>1.é€šè¿‡ç´¢å¼•å°†æ‰€éœ€çš„å­—æ®µå…¨éƒ¨è¯»å–åˆ°sort_bufferä¸­<br>2.æŒ‰ç…§æ’åºå­—æ®µè¿›è¡Œæ’åº<br>3.å°†ç»“æœé›†è¿”å›ç»™å®¢æˆ·ç«¯<br><br><br>ç¼ºç‚¹ï¼š<br>1.é€ æˆsort_bufferä¸­å­˜æ”¾ä¸ä¸‹å¾ˆå¤šæ•°æ®ï¼Œå› ä¸ºé™¤äº†æ’åºå­—æ®µè¿˜å­˜æ”¾å…¶ä»–å­—æ®µï¼Œå¯¹sort_bufferçš„åˆ©ç”¨æ•ˆç‡ä¸é«˜<br>2.å½“æ‰€éœ€æ’åºæ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œä¼šæœ‰å¾ˆå¤šçš„ä¸´æ—¶æ–‡ä»¶ï¼Œæ’åºæ€§èƒ½ä¹Ÿä¼šå¾ˆå·®<br><br>ä¼˜ç‚¹ï¼šMySQLè®¤ä¸ºå†…å­˜è¶³å¤Ÿå¤§æ—¶ä¼šä¼˜å…ˆé€‰æ‹©å…¨å­—æ®µæ’åºï¼Œå› ä¸ºè¿™ç§æ–¹å¼æ¯”rowid æ’åºé¿å…äº†ä¸€æ¬¡å›è¡¨æ“ä½œ<br><br><br>rowidæ’åº<br>1.é€šè¿‡æ§åˆ¶æ’åºçš„è¡Œæ•°æ®çš„é•¿åº¦æ¥è®©sort_bufferä¸­å°½å¯èƒ½å¤šçš„å­˜æ”¾æ•°æ®ï¼Œmax_length_for_sort_data<br>2.åªå°†éœ€è¦æ’åºçš„å­—æ®µå’Œä¸»é”®è¯»å–åˆ°sort_bufferä¸­ï¼Œå¹¶æŒ‰ç…§æ’åºå­—æ®µè¿›è¡Œæ’åº<br>3.æŒ‰ç…§æ’åºåçš„é¡ºåºï¼Œå–idè¿›è¡Œå›è¡¨å–å‡ºæƒ³è¦è·å–çš„æ•°æ®<br>4.å°†ç»“æœé›†è¿”å›ç»™å®¢æˆ·ç«¯<br><br>ä¼˜ç‚¹ï¼šæ›´å¥½çš„åˆ©ç”¨å†…å­˜çš„sort_bufferè¿›è¡Œæ’åºæ“ä½œï¼Œå°½é‡å‡å°‘å¯¹ç£ç›˜çš„è®¿é—®<br><br>ç¼ºç‚¹ï¼šå›è¡¨çš„æ“ä½œæ˜¯éšæœºIOï¼Œä¼šé€ æˆå¤§é‡çš„éšæœºè¯»ï¼Œä¸ä¸€å®šå°±æ¯”å…¨å­—æ®µæ’åºå‡å°‘å¯¹ç£ç›˜çš„è®¿é—®<br><br><br>3.æŒ‰ç…§æ’åºçš„ç»“æœè¿”å›å®¢æˆ·æ‰€å–è¡Œæ•°","like_count":69,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433508,"discussion_content":"ğŸ‘ğŸ¿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545372688,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65153,"user_name":"çœ‹ä¸åˆ°deé¢œè‰²","can_delete":false,"product_type":"c1","uid":1162714,"ip_address":"","ucode":"88348CCAE81931","user_header":"https://static001.geekbang.org/account/avatar/00/11/bd/da/3d76ea74.jpg","comment_is_top":false,"comment_ctime":1549078723,"is_pvip":false,"replies":[{"id":"23101","content":"ä½ æ˜¯è¯´å›¾14è¿™é‡Œå¯¹å§ï¼Œ <br>è¿™é‡Œupdateè¯­å¥è‡ªå·±æ˜¯å½“å‰è¯»ï¼Œä½†æ˜¯å®ƒæ²¡æœ‰æ›´æ–°æ•°æ®ï¼›<br>æ‰€ä»¥ä¹‹åçš„æŸ¥è¯¢è¿˜æ˜¯çœ‹ä¸åˆ°(1,3)è¿™ä¸ªç‰ˆæœ¬ã€‚<br><br>å¥½é—®é¢˜ğŸ‘<br>","user_name":"ä½œè€…å›å¤","comment_id":65153,"uid":"1264162","ip_address":"","utype":1,"ctime":1549102125,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":8,"race_medal":0,"score":"147577966787","product_id":100020801,"comment_content":"å…³äºä¸ŠæœŸé—®é¢˜é‡Œçš„æœ€åä¸€ä¸ªä¾‹å­ä¸å¤ªæ˜ç™½ï¼Œè¿˜è¯·è€å¸ˆæŒ‡ç‚¹ä¸€ä¸‹ã€‚æŒ‰è¯´åœ¨æ›´æ–°æ“ä½œçš„æ—¶å€™åº”è¯¥æ˜¯å½“å‰è¯»ï¼Œé‚£ä¹ˆåº”è¯¥èƒ½è¯»åˆ°id=1 and a = 3çš„è®°å½•å¹¶ä¿®æ”¹ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆå†selectè¿˜ä¼šæŸ¥åˆ°a = 2ã€‚éš¾é“æ˜¯å³ä¾¿updateä½†æ˜¯whereæ¡ä»¶ä¹Ÿæ˜¯å¿«ç…§è¯»ï¼Ÿä½†æ˜¯å¦‚æœè¿™æ ·é‚£ä¹ˆå¹»è¯»çš„é—®é¢˜ä¸å°±ä¸ä¼šå­˜åœ¨äº†å—ï¼Ÿï¼ˆB insertäº†ä¸€æ¡è®°å½•ï¼Œæ­¤æ—¶AèŒƒå›´updateåå†selectä¼šæŠŠB insertçš„è¯­å¥æŸ¥å‡ºæ¥ï¼‰","like_count":34,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438336,"discussion_content":"ä½ æ˜¯è¯´å›¾14è¿™é‡Œå¯¹å§ï¼Œ \nè¿™é‡Œupdateè¯­å¥è‡ªå·±æ˜¯å½“å‰è¯»ï¼Œä½†æ˜¯å®ƒæ²¡æœ‰æ›´æ–°æ•°æ®ï¼›\næ‰€ä»¥ä¹‹åçš„æŸ¥è¯¢è¿˜æ˜¯çœ‹ä¸åˆ°(1,3)è¿™ä¸ªç‰ˆæœ¬ã€‚\n\nå¥½é—®é¢˜ğŸ‘\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549102125,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1336951,"avatar":"https://static001.geekbang.org/account/avatar/00/14/66/77/194ba21d.jpg","nickname":"lzh","note":"","ucode":"C3D83DF4230109","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5651,"discussion_content":"é—®é¢˜å°±æ˜¯å‡ºåœ¨UPDATEè¯­å¥æœ¬èº«ï¼Œå›¾14çš„UPDATEï¼ŒWHEREé‡Œé¢æœ‰aå’ŒSETçš„aç›¸åŒï¼ŒUPDATEæ‰§è¡Œæ—¶å‘ç°äº†è¿™ç‚¹ï¼Œäºæ˜¯ç›´æ¥è¿”å›ï¼Œæ•…æ²¡æœ‰æ–°å¢ä»»ä½•ä¿®æ”¹è®°å½•ï¼ˆç”±SHOW ENGINE INNODB STATUSçš„LSNå¯ä»¥è¯æ˜å½“WHEREå’ŒSETç›¸åŒæ—¶ï¼ŒUPDATEä¸ä¼šæ‰§è¡Œï¼‰","likes_number":16,"is_delete":false,"is_hidden":false,"ctime":1566402069,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2403312,"avatar":"https://static001.geekbang.org/account/avatar/00/24/ab/f0/12b18bba.jpg","nickname":"Vincentæ®µ","note":"","ucode":"36A764BAEF53A4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1336951,"avatar":"https://static001.geekbang.org/account/avatar/00/14/66/77/194ba21d.jpg","nickname":"lzh","note":"","ucode":"C3D83DF4230109","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":562780,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649896188,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":5651,"ip_address":""},"score":562780,"extra":""}]},{"author":{"id":2876580,"avatar":"","nickname":"dxd_gk","note":"","ucode":"348705A4C631F0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552613,"discussion_content":"æ˜¯ä¸æ˜¯è¿™ä¹ˆ ç†è§£çš„ï¼Œupdateå½“å‰è¯»ï¼Œè¯»åˆ°äº†id=1 and a = 3çš„æ•°æ®ï¼Œåˆ¤æ–­äº†ä¸‹å°±æ²¡æœ‰è®¾ç½®a = 3çš„æ“ä½œäº†æ‰€ä»¥æœ€åçš„select æŸ¥è¯¢åˆ°çš„æ˜¯ ï¼ˆ1,2ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645525031,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2771089,"avatar":"","nickname":"Geek_126edf","note":"","ucode":"D5C8819DF40803","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394761,"discussion_content":"ç»ˆäºæ˜ç™½äº†ï¼Œè€å¸ˆè®¾ç½®è¿™ä¸ªä¾‹å­æ˜¯ä¸ºäº†å’Œå›¾13çš„æƒ…å†µå½¢æˆå¯¹æ¯”ï¼ŒMySQLä¸æ˜¯ä¸åˆ¤æ–­ï¼Œè€Œæ˜¯å¿…é¡»æ˜¯ç¡®å®šçš„æƒ…å†µäº†ï¼Œæ‰ä¸æ‰§è¡Œé‡å¤çš„æ›´æ–°ï¼Œæ­£æ˜¯å› ä¸ºå½“å‰è¯»ï¼Œè®©ä»–ç¡®å®šä¸ç”¨é‡å¤æ‰§è¡Œupdateè¯­å¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632037586,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1028768,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b2/a0/15f40838.jpg","nickname":"angelfish","note":"","ucode":"922D6025BD3640","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391341,"discussion_content":"åŸæ¥æ˜¯è¿™æ ·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630407464,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1210519,"avatar":"https://static001.geekbang.org/account/avatar/00/12/78/97/fa101174.jpg","nickname":"å¹´è½»äºº","note":"","ucode":"CDD4612BAE3247","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":282931,"discussion_content":"æ˜¯å› ä¸ºä»…é€šè¿‡SQLè¯­å¥å°±èƒ½è®©åˆ†æå™¨è¿˜æ˜¯ä¼˜åŒ–å™¨åˆ¤æ–­å‡ºæ¥ï¼Œå½“å‰çš„æ›´æ–°æ“ä½œæ˜¯ä¸éœ€è¦æ›´æ–°çš„ã€‚å› ä¸ºæ¡ä»¶å°±æ˜¯ a=3ï¼Œç»“æœæ›´æ–°æ“ä½œè¿˜æ˜¯ set a=3ï¼Œå°±ä¸æ‰§è¡Œäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592122309,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1135537,"avatar":"https://static001.geekbang.org/account/avatar/00/11/53/b1/3d6075cc.jpg","nickname":"ç‹å»º","note":"","ucode":"2289B282E18826","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1210519,"avatar":"https://static001.geekbang.org/account/avatar/00/12/78/97/fa101174.jpg","nickname":"å¹´è½»äºº","note":"","ucode":"CDD4612BAE3247","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":296399,"discussion_content":"æ˜¯InnoDBå¼•æ“åˆ¤æ–­çš„å§ï¼Œè™½ç„¶æ²¡æœ‰æ›´æ–°ä½†æ˜¯å·²ç»åŠ é”äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596532567,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":282931,"ip_address":""},"score":296399,"extra":""}]}]},{"had_liked":false,"id":69224,"user_name":"èƒ¡æ¥šåš","can_delete":false,"product_type":"c1","uid":1120212,"ip_address":"","ucode":"225883EDF35BED","user_header":"https://static001.geekbang.org/account/avatar/00/11/17/d4/d7a4e6f5.jpg","comment_is_top":false,"comment_ctime":1550679442,"is_pvip":false,"replies":[{"id":"24587","content":"1. éœ€è¦çš„å­—æ®µçš„å®šä¹‰å¤§å°çš„å’Œ<br>2. å¥½é—®é¢˜ã€‚é¦–å…ˆå–å†³äºä½¿ç”¨çš„ç®—æ³•ã€‚<br>  a) å¦‚æœæ˜¯å…¨å­—æ®µæ’åºå°±æ˜¯selectå­—æ®µ+whereå­—æ®µ+order byå­—æ®µ,<br>  b) å¦‚æœæ˜¯row_idæ’åºï¼Œå°±æ˜¯order byå­—æ®µ+row_id","user_name":"ä½œè€…å›å¤","comment_id":69224,"uid":"1264162","ip_address":"","utype":1,"ctime":1550711424,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":9,"race_medal":0,"score":"126104731026","product_id":100020801,"comment_content":"ä¸å¥½æ„æ€ï¼Œä¸Šä¸ªç•™è¨€æ²¡æ‰“å®Œã€‚<br>é—®é¢˜ä¸€ï¼Œåœ¨è·Ÿmax_length_for_sort_dataåæ¯”è¾ƒæ—¶ï¼Œmysqlæ˜¯æ€ä¹ˆåˆ¤æ–­ä¸€è¡Œæ•°æ®çš„å¤§å°çš„ï¼Ÿæ˜¯ç›´æ¥æ ¹æ®è¡¨å®šä¹‰å­—æ®µçš„å¤§å°å—ï¼Ÿ<br><br>é—®é¢˜äºŒï¼Œå¦å¤–è¿™â€˜ä¸€è¡Œâ€™çš„å«ä¹‰æ˜¯æ•´è¡Œæ•°æ®ï¼Œè¿˜æ˜¯å•å•æœ€ç»ˆå¼•æ“å±‚éœ€è¦è¿”å›çš„å­—æ®µ(å³selectå­—æ®µ+whereå­—æ®µ+order byå­—æ®µ)ï¼Ÿ<br><br>éº»çƒ¦è€å¸ˆæœ‰ç©ºè§£ç­”ä¸‹ï¼Œè°¢è°¢å“ˆ","like_count":29,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440010,"discussion_content":"1. éœ€è¦çš„å­—æ®µçš„å®šä¹‰å¤§å°çš„å’Œ\n2. å¥½é—®é¢˜ã€‚é¦–å…ˆå–å†³äºä½¿ç”¨çš„ç®—æ³•ã€‚\n  a) å¦‚æœæ˜¯å…¨å­—æ®µæ’åºå°±æ˜¯selectå­—æ®µ+whereå­—æ®µ+order byå­—æ®µ,\n  b) å¦‚æœæ˜¯row_idæ’åºï¼Œå°±æ˜¯order byå­—æ®µ+row_id","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550711424,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2031689,"avatar":"","nickname":"ä¸å‡¡","note":"","ucode":"28A3EC4C309C56","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393491,"discussion_content":"city,name,age ä¸‰ä¸ªå­—æ®µå®šä¹‰é•¿åº¦åŠ èµ·æ¥ä¸æ˜¯47å—ï¼Ÿ36æ˜¯æ€ä¹ˆç®—å‡ºæ¥çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631454347,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1302556,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e0/1c/aa50dc27.jpg","nickname":"icyricky","note":"","ucode":"D63C285165309D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2031689,"avatar":"","nickname":"ä¸å‡¡","note":"","ucode":"28A3EC4C309C56","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":406994,"discussion_content":"16+16+4=36ï¼Œintæ˜¯4å­—èŠ‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1634886002,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":393491,"ip_address":""},"score":406994,"extra":""}]},{"author":{"id":1649662,"avatar":"https://static001.geekbang.org/account/avatar/00/19/2b/fe/7925eb7e.jpg","nickname":"pdf","note":"","ucode":"A44250955878BB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306711,"discussion_content":"+1 ä¸ºä»€ä¹ˆåŒ…å«whereå­—æ®µ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600352374,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1285652,"avatar":"","nickname":"mycat","note":"","ucode":"6878BD32D042F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1649662,"avatar":"https://static001.geekbang.org/account/avatar/00/19/2b/fe/7925eb7e.jpg","nickname":"pdf","note":"","ucode":"A44250955878BB","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":308010,"discussion_content":"å› ä¸ºæ•°æ®éœ€è¦è¿‡æ»¤ï¼Œä¸æŸ¥è¯¢å‡ºæ¥è¿™ä¸ªwhereå­—æ®µï¼Œä½ æ€ä¹ˆçŸ¥é“æŸä¸€è¡Œçš„æ•°æ®æ˜¯å¦ç¬¦åˆæ¡ä»¶","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1600825788,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":306711,"ip_address":""},"score":308010,"extra":""},{"author":{"id":1185259,"avatar":"https://static001.geekbang.org/account/avatar/00/12/15/eb/a2955dd6.jpg","nickname":"5%","note":"","ucode":"66E71A77A00923","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1285652,"avatar":"","nickname":"mycat","note":"","ucode":"6878BD32D042F2","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318666,"discussion_content":"éš¾é“åˆ¤æ–­æ•°æ®æ˜¯å¦åœ¨wheteæ¡ä»¶å†…è¿˜è¦æ‹¿å‡ºæ¥å†åˆ¤æ–­ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603801959,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":308010,"ip_address":""},"score":318666,"extra":""},{"author":{"id":1124692,"avatar":"https://static001.geekbang.org/account/avatar/00/11/29/54/b9fec917.jpg","nickname":"èœé¸Ÿä¸€æš","note":"","ucode":"34052769B97FEC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1185259,"avatar":"https://static001.geekbang.org/account/avatar/00/12/15/eb/a2955dd6.jpg","nickname":"5%","note":"","ucode":"66E71A77A00923","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":343116,"discussion_content":"åº”è¯¥æ˜¯whereçš„éç´¢å¼•å­—æ®µã€‚æ¯”ageä»€ä¹ˆçš„ã€‚å¦å¤–ï¼Œå¼•æ“æ˜¯ä¸ä¼šåˆ¤æ–­æ¡ä»¶çš„ï¼ˆéäºŒçº§ç´¢å¼•å­—æ®µï¼ŒäºŒçº§å­—æ®µä¼šæœ‰ç´¢å¼•ä¸‹æ¨ï¼‰ã€‚å¼•æ“æŠŠæ•°æ®è¿”å›ï¼Œserverå±‚åˆ¤æ–­è¦ä¸è¦è¯¥æ•°æ®ï¼Œå¼•æ“åªè´Ÿè´£æ‹¿","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1610953796,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":318666,"ip_address":""},"score":343116,"extra":""}]},{"author":{"id":2052088,"avatar":"","nickname":"dyh_zero","note":"","ucode":"98029D72597EF2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306564,"discussion_content":"ä¸ºä»€ä¹ˆåŒ…å«where å­—æ®µ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600318288,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52098,"user_name":"å‘æ¡æ©™å­ ã€‚","can_delete":false,"product_type":"c1","uid":1259218,"ip_address":"","ucode":"ED076F4534FFED","user_header":"https://static001.geekbang.org/account/avatar/00/13/36/d2/c7357723.jpg","comment_is_top":false,"comment_ctime":1545309900,"is_pvip":false,"replies":[{"id":"18914","content":"å—¯ whereå’Œ orderéƒ½ä¼šå…±åŒå½±å“å“¦ï¼Œä»Šå¤©è¿™ç¯‡ä½ è¦å†çœ‹çœ‹æœ€ååŠ äº†è”åˆç´¢å¼•ä»¥åï¼Œè¯­å¥çš„æ‰§è¡Œé€»è¾‘<br><br><br>Analyze table ç«‹åŠŸå•¦ğŸ˜„","user_name":"ä½œè€…å›å¤","comment_id":52098,"uid":"1264162","ip_address":"","utype":1,"ctime":1545315291,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":3,"race_medal":0,"score":"113214459596","product_id":100020801,"comment_content":"è€å¸ˆ ï¼Œ æ¥å‰é¢ create_timeçš„å›ç­” ã€‚ è¯­å¥ç¡®å®æ˜¯ select * from t order by create_time desc ;<br><br>è€å¸ˆæ˜¯æŒ‡ ä¼˜åŒ–å™¨ä¼šæ ¹æ® order by create_time æ¥é€‰æ‹©ä½¿ç”¨ create_time ç´¢å¼•ä¹ˆ <br><br>æˆ‘ä¹‹å‰è¯¯ä»¥ä¸ºä¼˜åŒ–å™¨æ˜¯æ ¹æ® where åé¢çš„å­—æ®µæ¡ä»¶æ¥é€‰æ‹©ç´¢å¼• ï¼Œæ‰€ä»¥ä¸Šé¢é‚£æ¡è¯­å¥æ²¡æœ‰where çš„æ—¶å€™æˆ‘å°±æƒ³å½“ç„¶åœ°ä»¥ä¸ºä¸ä¼šèµ°ç´¢å¼• ã€‚ çœ‹æ¥æ˜¯è‡ªå·±è·³è¿›äº†ä¸€ä¸ªå¤§å‘é‡Œé¢ ğŸ˜…<br><br>å¦ ï¼š æˆ‘ä¹‹å‰åœ¨æœ¬åœ°å»ºäº†å¼ è¡¨åŠ äº†20wæ•°æ® ï¼Œç”¨explain æŸ¥äº†ä¸€æ¬¡ ï¼Œå‘ç°èµ°çš„æ˜¯å…¨è¡¨æ²¡æœ‰èµ°ç´¢å¼•ï¼Œ è€å¸ˆè¯´ä¼šèµ°ç´¢å¼•ã€‚æˆ‘æƒ³äº†ä¸€ä¸‹ï¼Œ å¯èƒ½æ˜¯ç»Ÿè®¡çš„æ•°æ®æœ‰è¯¯çš„ç¼˜æ•…ï¼Œç”¨ analyze tableé‡æ–°ç»Ÿè®¡ ï¼Œå†æ¬¡æŸ¥è¯¢æœç„¶èµ°äº†ç´¢å¼•  ã€‚ğŸ˜","like_count":25,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433739,"discussion_content":"å—¯ whereå’Œ orderéƒ½ä¼šå…±åŒå½±å“å“¦ï¼Œä»Šå¤©è¿™ç¯‡ä½ è¦å†çœ‹çœ‹æœ€ååŠ äº†è”åˆç´¢å¼•ä»¥åï¼Œè¯­å¥çš„æ‰§è¡Œé€»è¾‘\n\n\nAnalyze table ç«‹åŠŸå•¦ğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545315291,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1134266,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4e/ba/580ec429.jpg","nickname":"å°å…”å­ä¹–ä¹–","note":"","ucode":"E5CC0258CF8858","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385851,"discussion_content":"select * from t order by create_time desc ; æˆ‘æµ‹è¯•çš„ç»“æœæ˜¯ä¸èµ°ç´¢å¼•å‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627300319,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":159068,"discussion_content":"å…±åŒå½±å“çš„æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580651549,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52926,"user_name":"WL","can_delete":false,"product_type":"c1","uid":1173771,"ip_address":"","ucode":"6277DCD776B87E","user_header":"https://static001.geekbang.org/account/avatar/00/11/e9/0b/1171ac71.jpg","comment_is_top":false,"comment_ctime":1545552511,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"87444898431","product_id":100020801,"comment_content":"æŠŠè¯¥è®²å†…å®¹æ€»ç»“ä¸ºå‡ ä¸ªé—®é¢˜, å¤§å®¶å¤ä¹ çš„æ—¶å€™å¯ä»¥å…ˆå°è¯•å›ç­”è¿™äº›é—®é¢˜æ£€æŸ¥è‡ªå·±çš„æŒæ¡ç¨‹åº¦:<br>\t1. <br>å…¨å­—æ®µæ’åºçš„æµç¨‹æ˜¯æ€ä¹ˆæ ·çš„?<br>\t2. <br>sort_buffer_size, number_of_tmp_files, packed_additional_fields è¿™å‡ ä¸ªå‚æ•°å„æ˜¯ä»€ä¹ˆå«ä¹‰? <br>\t3. <br>rowidæ’åºçš„æµç¨‹æ˜¯æ€ä¹ˆæ ·çš„?<br>\t4. <br>é€šè¿‡ä»€ä¹ˆæ–¹å¼å¯ä»¥å‡å°‘æ’åºå¯¹äºç³»ç»Ÿçš„æ¶ˆè€—? <br><br>","like_count":21},{"had_liked":false,"id":51620,"user_name":"didiren","can_delete":false,"product_type":"c1","uid":1305376,"ip_address":"","ucode":"8341F02F2ABA60","user_header":"https://static001.geekbang.org/account/avatar/00/13/eb/20/a02c4f61.jpg","comment_is_top":false,"comment_ctime":1545210105,"is_pvip":false,"replies":[{"id":"18684","content":"ï¼ï¼ï¼<br><br>ä½ è¯´çš„å¯¹<br><br>æˆ‘éªŒè¯çš„æ˜¯statementæ ¼å¼ã€‚<br><br>MySQL çœ‹æ¥é€‰äº†ä¸é”™å§è·¯å¾„ã€‚<br><br>è¿™ä¸ªæˆ‘ä¹‹å‰çœŸä¸çŸ¥é“ğŸ˜“<br><br>å¤šè°¢<br><br><br>","user_name":"ä½œè€…å›å¤","comment_id":51620,"uid":"1264162","ip_address":"","utype":1,"ctime":1545217369,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"87444556025","product_id":100020801,"comment_content":"æ„Ÿè°¢ï¼é’ˆå¯¹æˆ‘ä¹‹å‰æå‡ºçš„ç–‘é—®ï¼Œæˆ‘åˆè¯¦ç»†çš„åšäº†å®éªŒï¼Œå‘ç°ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œæˆ‘æ„Ÿè§‰æ˜¯ä¸ªbugï¼Œå¸Œæœ›è§£ç­”<br># SessionA<br>mysql&gt; show variables like &#39;%binlog_row_image%&#39;;<br>| Variable_name    | Value |<br>| binlog_row_image | FULL  |<br>mysql&gt; create table t (id int not null primary key auto_increment,<br>    -&gt; a int default null)<br>    -&gt; engine=innodb;<br>mysql&gt; insert into t values(1,2);<br>mysql&gt; set tx_isolation = &#39;repeatable-read&#39;;<br>mysql&gt; begin;<br>mysql&gt; select * from t where id = 1;<br>| id | a    |<br>|  1 |    2 |<br>æ­¤æ—¶åœ¨å¦ä¸€ä¸ªSessionBæ‰§è¡Œupdate t set a=3 where id = 1;æˆåŠŸæ›´æ–°ä¸€æ¡è®°å½•ã€‚é€šè¿‡show engine innodb statusçœ‹ï¼ŒLog sequence number 2573458<br>ç„¶ååœ¨SessionAç»§ç»­ã€‚ã€‚<br>mysql&gt; update t set a=3 where id = 1;<br>Rows matched: 1  Changed: 0  Warnings: 0<br>Log sequence number 2573467<br>mysql&gt; select * from t where id = 1;<br>| id | a    |<br>|  1 |    2 |<br><br>è¿™é‡Œä¸ä½ ç»™å‡ºçš„ç­”æ¡ˆé‡Œçš„å®éªŒç»“æœä¸åŒ<br>å¯ä»¥çœ‹åˆ°redologæ˜¯è®°å½•äº†ç¬¬äºŒæ¬¡çš„updateçš„ï¼Œä½†æ˜¯selectå´æ²¡æœ‰çœ‹åˆ°æ›´æ–°åçš„å€¼ï¼Œäºæ˜¯æˆ‘åˆæ¢äº†ä¸€ä¸ªå¹³æ—¶æµ‹è¯•ç”¨çš„å®ä¾‹ï¼ŒåŒæ ·çš„æ­¥éª¤å´å¾—åˆ°äº†ä¸ä½ çš„ç­”æ¡ˆç›¸åŒçš„ç»“æœ<br>ç„¶åæˆ‘å¯¹æ¯”äº†2ä¸ªå®ä¾‹çš„å‚æ•°ï¼Œå‘ç°å½“binlog-row-image=minimalæ—¶ç¬¬äºŒæ¬¡æŸ¥è¯¢ç»“æœa=3ï¼Œå½“binlog-row-image=fullæ—¶ç¬¬äºŒæ¬¡æŸ¥è¯¢ç»“æœa=2ï¼Œè€Œä¸”ä¸è®ºå“ªä¸ªå‚æ•°ï¼Œredologéƒ½ä¼šå› ä¸ºSessionAçš„updateå¢é•¿ï¼Œè¯´æ˜redologéƒ½åšäº†è®°å½•ï¼Œupdateæ˜¯å‘ç”Ÿäº†çš„ï¼Œä½†æ˜¯binlog-row-imageå‚æ•°ä¼šå½±å“æŸ¥è¯¢ç»“æœï¼Œéš¾ä»¥ç†è§£ï¼Œæˆ‘ç”¨çš„mysqlç‰ˆæœ¬æ˜¯å®˜æ–¹çš„5.7.13<br><br>ä¸‹é¢æ˜¯binlog-row-image = minimalçš„å®éªŒç»“æœ<br>mysql&gt; set  binlog_row_image=MINIMAL;<br>mysql&gt; drop table t;<br>mysql&gt; create table t (id int not null primary key auto_increment,<br>    -&gt; a int default null)<br>    -&gt; engine=innodb;<br>insert into t values(1,2);<br>mysql&gt; insert into t values(1,2);<br>mysql&gt; set tx_isolation = &#39;repeatable-read&#39;;<br>mysql&gt; begin;<br>mysql&gt; select * from t where id = 1;<br>| id | a    |<br>|  1 |    2 |<br>æ­¤æ—¶åœ¨å¦ä¸€ä¸ªSessionBæ‰§è¡Œupdate t set a=3 where id = 1;æˆåŠŸæ›´æ–°ä¸€æ¡è®°å½•ã€‚<br>mysql&gt; update t set a=3 where id = 1;<br>Rows matched: 1  Changed: 0  Warnings: 0<br>mysql&gt; select * from t where id = 1; <br>| id | a    |<br>|  1 |    3 |","like_count":20,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433537,"discussion_content":"ï¼ï¼ï¼\n\nä½ è¯´çš„å¯¹\n\næˆ‘éªŒè¯çš„æ˜¯statementæ ¼å¼ã€‚\n\nMySQL çœ‹æ¥é€‰äº†ä¸é”™å§è·¯å¾„ã€‚\n\nè¿™ä¸ªæˆ‘ä¹‹å‰çœŸä¸çŸ¥é“ğŸ˜“\n\nå¤šè°¢\n\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545217369,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110112,"user_name":"é’±","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1562197898,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"48806838154","product_id":100020801,"comment_content":"  è¯¾å‰æ€è€ƒ<br><br>1ï¼šå¦‚æœæ’åºçš„å­—æ®µæœ‰ç´¢å¼•ï¼Œæ€ä¹ˆæ’ï¼Ÿ<br><br>ç”±äºB+æ ‘æ˜¯å¤©ç„¶æœ‰åºçš„ï¼Œæ‰€ä»¥ç›´æ¥å–å‡ºçš„æ•°æ®ä¹Ÿæ˜¯å¤©ç„¶æœ‰åºçš„ï¼Œå› æ­¤ä¾æ¬¡å–æ•°å°±è¡Œä¸ç”¨å†æ’åºäº†ã€‚è‹¥å–å‡ºçš„å­—æ®µæ˜¯è¦†ç›–ç´¢å¼•ï¼Œåˆ™è¿å›è¡¨çš„åŠ¨ä½œä¹Ÿä¸å¿…åšå•¦ï¼<br><br>2ï¼šå¦‚æœæ’åºçš„å­—æ®µæ²¡ç´¢å¼•ï¼Œæ€ä¹ˆæ’ï¼Ÿ<br><br>éç´¢å¼•å­—æ®µï¼Œå–å‡ºæ¥çš„æ—¶å€™æ˜¯æŒ‰ç´¢å¼•çš„é¡ºåºå–å‡ºçš„ï¼Œé’ˆå¯¹éç´¢å¼•å­—æ®µæ— åºï¼Œéœ€è¦åœ¨å†…å­˜ä¸­é€šè¿‡æ’åºç®—æ³•æ¥æ’åºã€‚<br><br>3ï¼šå¦‚æœæ•°æ®å¤§åˆ°å†…å­˜æ”¾ä¸ä¸‹ï¼Œæ€ä¹ˆæ’ï¼Ÿ<br><br>å–å‡ºçš„æ•°æ®æ— åºä¸”ä½“é‡è¾ƒå¤§ï¼Œåªèƒ½å…ˆæ”¾åˆ°ç£ç›˜ï¼Œç„¶åç”¨å¤–æ’åºçš„æ–¹æ³•æ’åºã€‚<br><br>4ï¼šå¦‚æœæ’åºçš„å­—æ®µæœ‰å¤šä¸ªï¼Œæ€ä¹ˆæ’ï¼Ÿ<br><br>æœ‰å¤šä¸ªè¿˜æ˜¯ä¸€ä¸ªå…¶å®æ€è·¯æ²¡å•¥å˜åŒ–ï¼Œå¦‚æœåŸæœ¬å°±æœ‰åºï¼Œåˆ™ç›´æ¥å–å‡ºï¼Œå¦åˆ™åªèƒ½è¿›è¡Œæ’åºï¼Œä½“é‡å°åœ¨å†…å­˜ä¸­æ’åºï¼Œä½“é‡å¤§åˆ™å¿…é¡»å€ŸåŠ©ç£ç›˜æ’åºã€‚<br><br>è¯¾åæ€è€ƒ<br><br>ç‰›é€¼çš„ç³»ç»Ÿå¯¹äºæ€§èƒ½çš„ä¼˜åŒ–éƒ½æœ‰ç€ä¸æ‡ˆçš„è¿½æ±‚ï¼Œæ•°æ®åº“æ›´æ˜¯å¦‚æ­¤ã€‚<br><br>æ€§èƒ½ä¼˜åŒ–çš„åŸåˆ™æ˜¯æ’å®šçš„ï¼Œå°±çœ‹å„å®¶æ€ä¹ˆå‘æŒ¥å•¦ï¼<br><br>1ï¼šå°±æ’åºè€Œè¨€ï¼Œå¦‚æœæ•°æ®å¤©ç„¶æœ‰åºï¼Œåˆ™ä¸ç”¨æ’åºï¼Œå¦‚æœæ˜¯è¦†ç›–ç´¢å¼•ï¼Œåˆ™ä¸ç”¨å›è¡¨ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µæ€§èƒ½åº”è¯¥æ˜¯æœ€ä½³çš„ã€‚<br><br>2ï¼šå¯¹äºè®¡ç®—æœºè€Œè¨€ï¼Œå†…å­˜æ¯”ç¡¬ç›˜å¿«å¤šäº†ï¼Œèƒ½åœ¨å†…å­˜åŠçš„äº‹è¦å°½é‡åœ¨å†…å­˜åŠã€‚ç´¢å¼•å½“MySQLè®¤ä¸ºæŸ¥è¯¢çš„å­—æ®µé•¿åº¦è¿‡å¤§æ—¶ä¼šè¿›è¡Œä¸€å®šçš„ä¼˜åŒ–ï¼Œä¼šåªæŸ¥å‡ºä¸»é”®idå’Œæ’åºçš„å­—æ®µï¼Œæ’åºå­—æ®µç”¨äºæ’åºï¼Œä¸»é”®idç”¨äºå›è¡¨æŸ¥è¯¢å…¶ä»–çš„å­—æ®µï¼Œè¿™æ ·é€Ÿåº¦å¯èƒ½ä¼šå¿«ä¸€äº›ã€‚<br><br>ç–‘é—®ï¼Ÿ<br><br>1ï¼šsort_bufferæ˜¯MySQLæŒ‰çº¿ç¨‹çš„ç»´åº¦åˆ†é…çš„ä¸“é—¨ç”¨äºæ’åºçš„å†…å­˜ç©ºé—´ï¼Œä¸”é€šè¿‡sort_buffer_sizeå¯ä»¥è°ƒæ•´å…¶å¤§å°ï¼Œé‚£ä¹ˆèµ°ä¸€ä¸‹æç«¯æƒ…å†µï¼Œè‹¥sort_buffer_size=0ï¼Œæ˜¯å¦æ‰€æœ‰çš„æ’åºéƒ½æ— æ³•è¿›è¡Œå•¦?è‹¥sort_buffer_size=+âˆï¼Œæ˜¯å¦åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨åŒä¸€æ—¶åˆ»èƒ½æ’åº?å¦å¤–ï¼Œsort_bufferè®¾ç½®åæ˜¯å¯¹æ‰€æœ‰çº¿ç¨‹éƒ½ä¸€æ ·é™åˆ¶å˜›ï¼Ÿå…¶å®é™…åˆ†é…ä¼šæ ¹æ®å®é™…æ•°æ®é‡å˜åŒ–å‘¢ï¼Ÿè¿˜æ˜¯å›ºå®šä¸å˜?æ¯”å¦‚ï¼šMySQLåˆ†é…ç»™å¯ç”¨äºåˆ’åˆ†sort_bufferçš„å†…å­˜æœ‰10mï¼Œæˆ‘è®¾ç½®ä¸º10mæ„å‘³ç€ä¸€ä¸ª5mçš„æ’åºä¼šå 5må¦å¤–5mç©ºç€ï¼Œè¿˜æ˜¯å¯ä»¥è·‘ä¸¤ä¸ª5mçš„æ’åºï¼Ÿ<br><br>2ï¼šå¤–éƒ¨æ’åºå½’å¹¶æ’åºï¼Œå…·ä½“æ€ä¹ˆæ’åºçš„ï¼Ÿ<br><br>1mçš„å†…å­˜æ’åº2mçš„æ•°æ®ï¼Œæ¯æ¬¡åªèƒ½åœ¨å†…å­˜ä¸­æ’åº1mçš„æ•°æ®ï¼Œæƒ³ç€æƒ³ç€æƒ³æ˜ç™½äº†ï¼Œè¿™åº”è¯¥æ˜¯ä¸ªé€šç”¨çš„æ–¹æ³•ï¼Œåªæœ‰å†…å­˜å°äºæ•°æ®é‡éƒ½å¯ä»¥è¿™ä¹ˆç©ã€‚<br><br>3ï¼šæ’åºçš„å†…å­˜åœ¨æŸçº¿ç¨‹æ’å®Œåºå°±é‡Šæ”¾äº†ï¼Œä¸´æ—¶æ–‡ä»¶çš„å›æ”¶ä¹Ÿæ˜¯ä¸€æ ·çš„å§ï¼Ÿå¦‚æœæ•°æ®é‡å¤§ï¼Œç£ç›˜ä¸å¤Ÿæ’åºä¹Ÿæ— æ³•è¿›è¡Œçš„ï¼Œç©ºé—´å¤Ÿä¸å¤Ÿè¿™ä¸ªåˆ¤æ–­æ—¶æœºæ˜¯å•¥æ—¶å€™ï¼Ÿ<br><br>4ï¼šå¼•æ“è¿”å›æ•°æ®ç»“æœæ˜¯ä¸€æ¡ä¸€æ¡ï¼ŒServerè¿”å›ç»™å®¢æˆ·ç«¯ä¹Ÿæ˜¯ä¸€æ¡ä¸€æ¡å˜›ï¼Ÿæ–‡ä¸­å›¾â€œç»“æœé›†â€æ˜¯åœ¨å“ªé‡Œç»„åˆçš„ï¼ŒServerå±‚ï¼Ÿè¿˜æ˜¯å®¢æˆ·ç«¯ï¼Ÿå¦‚æœæ˜¯Serverå±‚ä¹Ÿä¼šå­˜åœ¨ç©ºé—´ä¸å¤Ÿçš„å¯èƒ½å§ï¼Ÿæ­¤æ—¶æ˜¯å…ˆæ”¾å…¥ç£ç›˜ï¼Œç­‰æ•°æ®åˆ°é½ï¼Œå†ä¸€èµ·å‘é€ç»™å®¢æˆ·ç«¯å—ï¼Ÿ<br><br>éå¸¸æ„Ÿè°¢è€å¸ˆï¼Œæé«˜äº†ï¼Œæˆ‘çš„è®¤çŸ¥ï¼<br><br><br><br>","like_count":11,"discussions":[{"author":{"id":1285652,"avatar":"","nickname":"mycat","note":"","ucode":"6878BD32D042F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308316,"discussion_content":"sort_buffer_sizeæœ€å°å€¼ä¸ºï¼š32768ï¼Œ32KBï¼Œä¸èƒ½è®¾ç½®ä¸º0ï¼Œé»˜è®¤å€¼ä¸º262144ï¼Œ256KBã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1600913893,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1285652,"avatar":"","nickname":"mycat","note":"","ucode":"6878BD32D042F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308156,"discussion_content":"ä½ çš„ç–‘é—®1ï¼Œæˆ‘ä¹Ÿæœ‰è¿™ä¸ªç–‘é—®ã€‚\n\nä½ çš„ç–‘é—®2ï¼Œå½“sort_buffer_sizeä¸å¤Ÿçš„æ—¶å€™ï¼Œæ˜¯ä¸æ˜¯å°±å½»åº•ä¸ç”¨sort_buffer_sizeäº†ï¼Œç›´æ¥å…¨éƒ¨åœ¨ä¸´æ—¶æ–‡ä»¶æ’ï¼Ÿè¿˜æ˜¯æœ‰ä¸€äº›æ•°æ®åœ¨sort bufferé‡Œï¼Œä¸€äº›åœ¨ä¸´æ—¶æ–‡ä»¶ä¸­ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600857367,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2326134,"avatar":"https://static001.geekbang.org/account/avatar/00/23/7e/76/368394bf.jpg","nickname":"å“¦","note":"","ucode":"C776659DED9D79","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1285652,"avatar":"","nickname":"mycat","note":"","ucode":"6878BD32D042F2","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337089,"discussion_content":"å¤–éƒ¨æ’åºä¹Ÿæ˜¯éœ€è¦å°†æ•°æ®è¯»åˆ°å†…å­˜ä¸­æ¥æ’åºçš„ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯ä½¿ç”¨sort bufferçš„","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1608794314,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":308156,"ip_address":""},"score":337089,"extra":""}]}]},{"had_liked":false,"id":62186,"user_name":"coderbee","can_delete":false,"product_type":"c1","uid":1005530,"ip_address":"","ucode":"02339998217473","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/da/0adccef5.jpg","comment_is_top":false,"comment_ctime":1547973109,"is_pvip":false,"replies":[{"id":"22095","content":"Using where ç¡®å®æ˜¯ä¸€ä¸ªæœ‰æ—¶å€™è®©äººè¯¯è§£çš„Extraä¿¡æ¯ï¼Œæˆ‘åé¢çœ‹çœ‹æ‰¾ä¸ªæ–‡ç« å±•å¼€è¯´æ˜å“ˆ<br>ç®€å•è¯´å°±æ˜¯ï¼ŒUsing whereåŒ…å«äº†ä¸€ä¸ªâ€œå€¼æ¯”è¾ƒâ€çš„è¿‡ç¨‹ã€‚<br><br>å¥½é—®é¢˜","user_name":"ä½œè€…å›å¤","comment_id":62186,"uid":"1264162","ip_address":"","utype":1,"ctime":1548078382,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"35907711477","product_id":100020801,"comment_content":"è¯·æ•™ä¸‹æ—è€å¸ˆï¼š<br>ä»¥æ–‡ç« ä¸­çš„ t è¡¨ï¼Œç´¢å¼• city(city) å…¶å®ç­‰ä»·äº city(city, id) ï¼Œç¬¬2æ¡è¯­å¥åŠ äº† order by idï¼ŒExtra åˆ—å¤šäº† Using where ï¼Œä¸ºå•¥è¿˜è¦è¿™ä¸ªï¼Ÿï¼Ÿä¸¤ä¸ªéƒ½æ˜¯ç”¨åˆ°äº†è¦†ç›–ç´¢å¼•ã€‚<br><br>mysql&gt; explain select id from t where city = &#39;city102&#39; limit 1, 10;<br>+----+-------------+-------+------------+------+---------------+------+---------+-------+------+----------+-------------+<br>| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref   | rows | filtered | Extra       |<br>+----+-------------+-------+------------+------+---------------+------+---------+-------+------+----------+-------------+<br>|  1 | SIMPLE      | t     | NULL       | ref  | city          | city | 66      | const |    2 |   100.00 | Using index |<br>+----+-------------+-------+------------+------+---------------+------+---------+-------+------+----------+-------------+<br>1 row in set, 1 warning (0.00 sec)<br><br>mysql&gt; explain select id from t where city = &#39;city102&#39; order by id limit 1, 10;<br>+----+-------------+-------+------------+------+---------------+------+---------+-------+------+----------+--------------------------+<br>| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref   | rows | filtered | Extra                    |<br>+----+-------------+-------+------------+------+---------------+------+---------+-------+------+----------+--------------------------+<br>|  1 | SIMPLE      | t     | NULL       | ref  | city          | city | 66      | const |    2 |   100.00 | Using where; Using index |<br>+----+-------------+-------+------------+------+---------------+------+---------+-------+------+----------+--------------------------+<br>1 row in set, 1 warning (0.00 sec)<br><br>","like_count":8,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437128,"discussion_content":"Using where ç¡®å®æ˜¯ä¸€ä¸ªæœ‰æ—¶å€™è®©äººè¯¯è§£çš„Extraä¿¡æ¯ï¼Œæˆ‘åé¢çœ‹çœ‹æ‰¾ä¸ªæ–‡ç« å±•å¼€è¯´æ˜å“ˆ\nç®€å•è¯´å°±æ˜¯ï¼ŒUsing whereåŒ…å«äº†ä¸€ä¸ªâ€œå€¼æ¯”è¾ƒâ€çš„è¿‡ç¨‹ã€‚\n\nå¥½é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548078382,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51510,"user_name":"cyberbit","can_delete":false,"product_type":"c1","uid":1303197,"ip_address":"","ucode":"1BD53A25F5277F","user_header":"https://static001.geekbang.org/account/avatar/00/13/e2/9d/fbbd4611.jpg","comment_is_top":false,"comment_ctime":1545191652,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"35904930020","product_id":100020801,"comment_content":"<br>1.ä¸ä¼šæœ‰æ’åºï¼Œè¿™ç§æƒ…å†µå±äºã€Šé«˜æ€§èƒ½mysqlã€‹é‡Œæåˆ°çš„â€œinæŠ€æ³•â€ï¼Œç¬¦åˆç´¢å¼•çš„æœ€å·¦åŸåˆ™ï¼Œæ˜¯2ä¸ªç­‰å€¼æŸ¥è¯¢ï¼Œå¯ä»¥ç”¨åˆ°å³è¾¹çš„ç´¢å¼•åˆ—ã€‚<br>2.åˆ†é¡µæŸ¥è¯¢ï¼Œå¯ä»¥ç”¨å»¶è¿Ÿå…³è”æ¥ä¼˜åŒ–ï¼š<br>select * from t join <br>(select id from t where city in(&#39;æ­å·&#39;,&#39;è‹å·&#39;) order by name limit 10000,100) t_id<br>on t.id=t_id.id;<br><br>","like_count":8,"discussions":[{"author":{"id":2086624,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/d6/e0/3ccaaa7b.jpg","nickname":"é¢†å­","note":"","ucode":"64AC4E6AB74E68","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294580,"discussion_content":"æœ€å¤–å±‚å°‘å†™äº†æ’åº","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1595931261,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65514,"user_name":"çœ‹ä¸åˆ°deé¢œè‰²","can_delete":false,"product_type":"c1","uid":1162714,"ip_address":"","ucode":"88348CCAE81931","user_header":"https://static001.geekbang.org/account/avatar/00/11/bd/da/3d76ea74.jpg","comment_is_top":false,"comment_ctime":1549424001,"is_pvip":false,"replies":[{"id":"23216","content":"æ–°å¹´å¿«ä¹<br><br>1. ä¸å½±å“<br>2. å†å°ä¹Ÿç”¨rowid ï¼Œå¯¹ï¼Œä¼šè½¬æˆç£ç›˜æ’åº","user_name":"ä½œè€…å›å¤","comment_id":65514,"uid":"1264162","ip_address":"","utype":1,"ctime":1549443651,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":2,"race_medal":0,"score":"31614195073","product_id":100020801,"comment_content":"å›¾14é‚£ä¸ªç–‘é—®æ˜ç™½äº†ï¼Œæ˜¯å› ä¸ºwhereæ¡ä»¶ä¸­å­˜åœ¨updateçš„å€¼InnoDBè®¤ä¸ºå€¼ä¸€è‡´æ‰€ä»¥æ²¡æœ‰ä¿®æ”¹ï¼Œä»è€Œå¯¼è‡´Açš„ä¸€è‡´æ€§è§†å›¾ä¸­çœ‹ä¸åˆ°Bçš„ä¿®æ”¹ã€‚<br>è¿™ç¯‡åˆçœ‹äº†ä¸€éï¼Œè¿˜æœ‰ä¸ªç–‘é—®ï¼Œæƒ³è¯·è€å¸ˆè§£ç­”ä¸€ä¸‹ã€‚<br>1.ascå’Œdescä¼šå½±å“ä½¿ç”¨ç´¢å¼•æ’åºå—ï¼Ÿ<br>2.å¦‚æœé‡‡ç”¨rowidä¹Ÿæ— æ³•æ”¾å…¥æ’åºå­—æ®µè¿˜æ˜¯ä¼šè½¬ç”¨ç£ç›˜æ’åºå§ã€‚","like_count":7,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438483,"discussion_content":"æ–°å¹´å¿«ä¹\n\n1. ä¸å½±å“\n2. å†å°ä¹Ÿç”¨rowid ï¼Œå¯¹ï¼Œä¼šè½¬æˆç£ç›˜æ’åº","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549443651,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1285652,"avatar":"","nickname":"mycat","note":"","ucode":"6878BD32D042F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308317,"discussion_content":"sort_buffer_sizeæœ€å°å€¼ä¸ºï¼š32768ï¼Œ32KBï¼Œä¸èƒ½è®¾ç½®ä¸º0ï¼Œé»˜è®¤å€¼ä¸º262144ï¼Œ256KBã€‚æ‰€ä»¥ï¼Œä¸€èˆ¬æƒ…å†µä¸‹éƒ½ä¼šå®¹ä¸‹rowid+å…¶ä»–æ’åºå­—æ®µçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600913939,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51956,"user_name":"å‘æ¡æ©™å­ ã€‚","can_delete":false,"product_type":"c1","uid":1259218,"ip_address":"","ucode":"ED076F4534FFED","user_header":"https://static001.geekbang.org/account/avatar/00/13/36/d2/c7357723.jpg","comment_is_top":false,"comment_ctime":1545281613,"is_pvip":false,"replies":[{"id":"18825","content":"ä½ è¯´çš„è¿™æ ·åœºæ™¯ï¼ŒåŠ ä¸Šcreate_timeç´¢å¼•çš„è¯ï¼Œæ˜¯å¯ä»¥åŠ é€Ÿçš„å‘€ï¼Œ<br>è¯­å¥æ˜¯è¿™æ ·å—ï¼Ÿselect * from t order by create_time desk limit 100? å¦‚æœæ˜¯è¿™æ ·ï¼Œåˆ›å»ºç´¢å¼•æœ‰ç”¨çš„ã€‚<br><br>é—®é¢˜äºŒåé¢ä¼šæœ‰æ–‡ç« ä¼šè¯´å“ˆ<br>é—®é¢˜ä¸‰  å—¯ï¼Œè¿™ä¸ªä¹Ÿä¼šå®‰æ’æ–‡ç« è¯´åˆ°","user_name":"ä½œè€…å›å¤","comment_id":51956,"uid":"1264162","ip_address":"","utype":1,"ctime":1545293659,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":2,"race_medal":0,"score":"31610052685","product_id":100020801,"comment_content":"<br>æ­£å¥½æœ‰ä¸ª order by ä½¿ç”¨åœºæ™¯ ï¼Œ æœ‰ä¸ªé¡µé¢ï¼Œéœ€è¦æŒ‰æ•°æ®æ’å…¥æ—¶é—´å€’åºæ¥æŸ¥çœ‹ä¸€å¼ è®°å½•è¡¨çš„ä¿¡æ¯ ï¼Œå› ä¸ºé™¤äº†åˆ†é¡µçš„å‚æ•° ï¼Œ æ²¡æœ‰å…¶ä»– where çš„æ¡ä»¶ ï¼Œæ‰€ä»¥é™¤äº†ä¸»é”®å¤–æ²¡æœ‰å…¶ä»–ç´¢å¼• ã€‚ <br><br>è¿™æ—¶å€™ DBA è®©æˆ‘ç»™ create_time åˆ›å»ºç´¢å¼•ï¼Œ è¯´æ˜¯æŒ‰ç…§é¡ºåºæ’åˆ— ï¼ŒæŸ¥è¯¢ä¼šå¢å¿« ã€‚è¿™ç¯‡æ–‡ç« çœ‹å®Œå ï¼Œ è®©æˆ‘æ„Ÿè§‰å®é™…ä¸Šåˆ›å»º create_time ç´¢å¼•æ˜¯æ²¡ç”¨çš„ ã€‚ <br><br>å› ä¸ºæŸ¥è¯¢æœ¬èº«å¹¶æ²¡æœ‰ç”¨åˆ° create_time ç´¢å¼• ï¼Œå®é™…ä¸ŠæŸ¥è¯¢çš„æ­¥éª¤æ˜¯ ï¼š<br><br>1. åˆå§‹åŒ– sort_buffer å†…å­˜<br><br>2. å› ä¸ºæ²¡ç´¢å¼• ï¼Œ æ‰€ä»¥æ‰«å‡ºå…¨è¡¨çš„æ•°æ®åˆ° sort_buffer ä¸­<br><br>2. å¦‚æœå†…å­˜å¤Ÿåˆ™ç›´æ¥å†…å­˜æŒ‰æ—¶é—´æ’åº <br><br>3. å¦‚æœå†…å­˜ä¸å¤Ÿåˆ™æŒ‰æ•°æ®é‡åˆ†æˆä¸åŒæ–‡ä»¶åˆ†åˆ«æŒ‰æ—¶é—´æ’åºåæ•´åˆ<br><br>4. æ ¹æ®æ•°é‡åˆ†é¡µæŸ¥è¯¢æ•°é‡ å›èšé›†ç´¢å¼•ä¸­ç”¨ ID æŸ¥è¯¢æ•°æ®<br><br>5. è¿”å›<br><br>æ‰€ä»¥æˆ‘åˆ†æcreate_timeç´¢å¼•åº”è¯¥ä¸éœ€è¦åˆ›å»ºã€‚åè€Œå¢åŠ äº†ç»´æŠ¤æˆæœ¬<br><br><br>é—®é¢˜ä¸€ ï¼šè¿™ç§æ— æ¡ä»¶æŸ¥åˆ—è¡¨é¡µé™¤äº†å…¨è¡¨æ‰«è¿˜æœ‰å…¶ä»–å»ºç«‹ç´¢å¼•çš„åŠæ³•ä¹ˆ<br><br>é—®é¢˜äºŒ : å¦‚æœåŠ å…¥ group by ï¼Œ æ•°æ®è¯¥å¦‚ä½•èµ°<br><br>é—®é¢˜ä¸‰ ï¼šè€å¸ˆä¹‹åçš„æ–‡ç« ä¼šæœ‰è®²è§£ bigInt(20)  ã€ tinyint(2) ã€varchar(32) è¿™ç§åé¢å¸¦æ•°å­—ä¸ä¸å¸¦æ•°å­—æœ‰ä½•åŒºåˆ«çš„æ–‡ç« ä¹ˆ ã€‚ æ¯æ¬¡å»ºå­—æ®µéƒ½ä¼šè€ƒè™‘é•¿åº¦ ï¼Œä½†å®é™…å´ä¸çŸ¥é“ä»–æœ‰ä½•ä½œç”¨ <br><br><br>","like_count":8,"discussions":[{"author":{"id":1304762,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e8/ba/a6976395.jpg","nickname":"Stev","note":"","ucode":"AC16C3BF6D0E66","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":276183,"discussion_content":"å¦‚æœæ’åºå­—æ®µæœ‰ç´¢å¼•,é‚£ä¹ˆå®ƒçš„ä¸»é”®IDæœ¬èº«å°±æ˜¯æœ‰åºçš„,å°±ä¼šç›´æ¥æŒ‰ç´¢å¼•çš„ä¸»é”®IDå»åŸè¡¨å–æ•°,ç„¶åç›´æ¥è¿”å›åˆ°å®¢æˆ·ç«¯,é¿å…äº†æ’åº,æ˜¯å¯ä»¥åŠ é€Ÿçš„.","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1590836636,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433679,"discussion_content":"ä½ è¯´çš„è¿™æ ·åœºæ™¯ï¼ŒåŠ ä¸Šcreate_timeç´¢å¼•çš„è¯ï¼Œæ˜¯å¯ä»¥åŠ é€Ÿçš„å‘€ï¼Œ\nè¯­å¥æ˜¯è¿™æ ·å—ï¼Ÿselect * from t order by create_time desk limit 100? å¦‚æœæ˜¯è¿™æ ·ï¼Œåˆ›å»ºç´¢å¼•æœ‰ç”¨çš„ã€‚\n\né—®é¢˜äºŒåé¢ä¼šæœ‰æ–‡ç« ä¼šè¯´å“ˆ\né—®é¢˜ä¸‰  å—¯ï¼Œè¿™ä¸ªä¹Ÿä¼šå®‰æ’æ–‡ç« è¯´åˆ°","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1545293659,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58242,"user_name":"å”åä¹‹","can_delete":false,"product_type":"c1","uid":1004394,"ip_address":"","ucode":"F472C71E043E03","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/JKKWS6TzhncvAA0p0NDiaATPIvMicSM76vNAg9IG1ibibcJYPAiaicYjZfq4gAV8GRtcTpOibfRD8vzqHBtL0ibmhwQsbg/132","comment_is_top":false,"comment_ctime":1547016993,"is_pvip":false,"replies":[{"id":"21130","content":"1.  ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ<br>2. å¯¹çš„","user_name":"ä½œè€…å›å¤","comment_id":58242,"uid":"1264162","ip_address":"","utype":1,"ctime":1547119645,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":3,"race_medal":0,"score":"27316820769","product_id":100020801,"comment_content":"1ï¼šç”¨@cyberbit æä¾›çš„æ–¹å¼ï¼Œæ‰§è¡Œè®¡åˆ’æ˜¯ä¸ä¼šä½¿ç”¨åˆ°æ’åºï¼Œä½†æ‰§è¡Œæ—¶é—´æ¯”ä½¿ç”¨æ’åºæ¶ˆè€—çš„å¤šï¼›<br>2ï¼šåˆ†é¡µlimitè¿‡å¤§æ—¶ä¼šå¯¼è‡´å¤§é‡æ’åºï¼Œå¯ä»¥è®°å½•ä¸Šä¸€é¡µæœ€åçš„IDï¼Œä¸‹ä¸€é¡µæŸ¥è¯¢æ¡ä»¶å¸¦ä¸Š where  ID&gt;ä¸Šä¸€é¡µæœ€åID limit 100","like_count":6,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435968,"discussion_content":"1.  ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ\n2. å¯¹çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547119645,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1057311,"avatar":"https://static001.geekbang.org/account/avatar/00/10/22/1f/1c0a78cc.jpg","nickname":"fred ğŸ’","note":"","ucode":"442245FE43131D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":39283,"discussion_content":"æ’åºä¹‹åçš„idä¸æ˜¯åº”è¯¥æ˜¯éšæœºçš„å—ï¼Ÿé‚£where Id>ä¸Šä¸€é¡µæœ€åçš„id æ˜¯ä¸æ˜¯å°±æœ‰é—®é¢˜äº†ï¼Œå› ä¸ºä¸Šä¸€é¡µæœ€åçš„idå¯èƒ½å¾ˆå¤§ï¼Œä¹Ÿå¯èƒ½å¾ˆå°ï¼Œæ’åºæ˜¯æ ¹æ®nameæ’çš„ä¸æ˜¯æ ¹æ®idæ’çš„ã€‚ä¸å¤ªç†è§£ ä¸ºä»€ä¹ˆè¯´è¿™æ ·æ˜¯å¯¹çš„ï¼Ÿ","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1571910219,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1285652,"avatar":"","nickname":"mycat","note":"","ucode":"6878BD32D042F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1057311,"avatar":"https://static001.geekbang.org/account/avatar/00/10/22/1f/1c0a78cc.jpg","nickname":"fred ğŸ’","note":"","ucode":"442245FE43131D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308302,"discussion_content":"æˆ‘ä¹Ÿæœ‰è¿™ä¸ªç–‘é—®ï¼Œä¸»é”®IDåœ¨æ’åºååœ¨é¡µé¢å±•ç°çš„æ—¶å€™æ˜¯æ— åºçš„ï¼Œå› ä¸ºæ’åºæ˜¯æ ¹æ®nameæ¥çš„ã€‚ä¸èƒ½ä¿è¯IDæ˜¯æœ‰åºçš„å‘€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600911439,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":39283,"ip_address":""},"score":308302,"extra":""}]}]},{"had_liked":false,"id":73460,"user_name":"æ¯“æ®‡ç¬³","can_delete":false,"product_type":"c1","uid":1307422,"ip_address":"","ucode":"00C86902689D64","user_header":"https://static001.geekbang.org/account/avatar/00/13/f3/1e/8ea92c76.jpg","comment_is_top":false,"comment_ctime":1551888165,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"23026724645","product_id":100020801,"comment_content":"å›¾ 14 å¯è§æ€§éªŒè¯æ–¹å¼ -- å¯¹ç…§ä¸­<br><br>session A çš„ update t set a = 3  where id = 1 and a = 3 <br><br>ä¼šä¸ä¼šæœ‰å½“å‰è¯»ï¼Ÿå¦‚æœå½“å‰è¯»çš„è¯ï¼Œé‚£æ˜¯ä¸æ˜¯ä¼šè¯»åˆ°session Bçš„æ›´æ–°çš„å€¼ï¼Ÿ<br><br>è¯·è€å¸ˆå¸®å¿™åˆ†æä¸‹ã€‚","like_count":5,"discussions":[{"author":{"id":1210519,"avatar":"https://static001.geekbang.org/account/avatar/00/12/78/97/fa101174.jpg","nickname":"å¹´è½»äºº","note":"","ucode":"CDD4612BAE3247","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":282932,"discussion_content":"æ›´æ–°æ¡ä»¶æ˜¯åŒ¹é…çš„ã€‚ä½†æ˜¯ä»…é€šè¿‡SQLè¯­å¥å°±èƒ½è®©åˆ†æå™¨ï¼ˆæˆ–è€…æ˜¯ä¼˜åŒ–å™¨ï¼‰åˆ¤æ–­å‡ºæ¥ï¼Œå½“å‰çš„æ›´æ–°æ“ä½œæ˜¯ä¸éœ€è¦æ›´æ–°çš„ã€‚å› ä¸ºwhereä¸­çš„æ¡ä»¶æ˜¯ a=3ï¼Œæ›´æ–°æ“ä½œè¿˜æ˜¯ set a=3ï¼Œå°±ä¸æ‰§è¡Œæ›´æ–°äº†ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1592122477,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":159050,"discussion_content":"å½“å‰è¯»åªé€‚ç”¨äºupdateï¼Œå‰äºset a=3è‚¯å®šæ˜¯è¦å½“å‰è¯»çš„ï¼Œä½†æ˜¯whereä¸­çš„aå°±ä¸èƒ½ç”¨å½“å‰è¯»ï¼Œå› ä¸ºä¸€è‡´æ€§è§†å›¾ä¸­çš„aæ˜¯2ï¼Œæ‰€ä»¥æ›´æ–°æ¡ä»¶ä¸åŒ¹é…ï¼Œæ‰€ä»¥æ— æ³•æ›´æ–°ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1580650345,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"ä¸€æ­¥","note":"","ucode":"73CEA468CE70C3","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":60330,"discussion_content":"è¿™ä¸ªä¼šè¿›è¡Œå½“å‰è¯»ï¼Œä½†æ˜¯è¿›è¡Œå½“å‰è¯»çš„æ—¶å€™çš„ ï¼Œåˆ†æ update è¯­å¥å‘ç°ä¸éœ€è¦è¿›è¡Œæ›´æ–°ï¼Œä¹Ÿå°±æ²¡æœ‰æ‰§è¡Œæ›´æ–°çš„æ“ä½œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574727733,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1344431,"avatar":"https://static001.geekbang.org/account/avatar/00/14/83/af/1cb42cd3.jpg","nickname":"é©¬ä»¥","note":"","ucode":"3FEA06CA14DE28","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5484,"discussion_content":"å¦‚æœæ‚¨å·²ç»è§£å†³ï¼Œèƒ½ä¸èƒ½ç•™è¨€ç»™æˆ‘è§£ç­”ä¸‹å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566296107,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1344431,"avatar":"https://static001.geekbang.org/account/avatar/00/14/83/af/1cb42cd3.jpg","nickname":"é©¬ä»¥","note":"","ucode":"3FEA06CA14DE28","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5483,"discussion_content":"æˆ‘ä¹Ÿæœ‰è¿™ä¸ªç–‘é—®å•Šï¼Œä¸çŸ¥é“æ˜¯ä»€ä¹ˆé¬¼è¿™é‡Œçªç„¶å°±å¯¹sessionBæ„ŸçŸ¥ä¸åˆ°äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566296088,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77025,"user_name":"å•Šå•Šå•Šå“¦å“¦","can_delete":false,"product_type":"c1","uid":1309877,"ip_address":"","ucode":"68C7153ECAAC57","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/RNO4yZyBvic914hewmNNE8iblYDcfv5yGHZ9OnKuCuZXNmGR0F5qV3icKLT2xpMt66GyEpicZVvrmz8A6TIqt92MQg/132","comment_is_top":false,"comment_ctime":1552809281,"is_pvip":false,"replies":[{"id":"28917","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","comment_id":77025,"uid":"1264162","ip_address":"","utype":1,"ctime":1553419505,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":2,"race_medal":0,"score":"18732678465","product_id":100020801,"comment_content":"å‡è®¾è¶…è¿‡sort buffer  æ’åºæ˜¯ä¸€éƒ¨åˆ†åœ¨å†…å­˜ä¸­æ’åº è¶…å‡ºçš„éƒ¨åˆ† ç”¨ä¸´æ—¶æ–‡ä»¶å—ã€‚","like_count":4,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443550,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553419505,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2344609,"avatar":"https://static001.geekbang.org/account/avatar/00/23/c6/a1/3bdcde91.jpg","nickname":"å‘é™½èŠ±å¼€èŠ±å‘é™½ğŸŒ¸","note":"","ucode":"9FDD01BE0E42CD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":376390,"discussion_content":"æ‰¾åˆ°ç­”æ¡ˆäº†\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622107007,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51371,"user_name":"å³°","can_delete":false,"product_type":"c1","uid":1056019,"ip_address":"","ucode":"C53CB64E8E7D19","user_header":"https://static001.geekbang.org/account/avatar/00/10/1d/13/31ea1b0b.jpg","comment_is_top":false,"comment_ctime":1545179511,"is_pvip":true,"replies":[{"id":"18543","content":"åˆ†é¡µè¿™ä¸ªå†è€ƒè™‘è€ƒè™‘å“ˆğŸ˜„","user_name":"ä½œè€…å›å¤","comment_id":51371,"uid":"1264162","ip_address":"","utype":1,"ctime":1545183570,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"18725048695","product_id":100020801,"comment_content":"ç”±äºcityæœ‰ä¸¤ä¸ªå€¼ï¼Œç›¸å½“äºåŒ¹é…åˆ°äº†ç´¢å¼•æ ‘çš„ä¸¤æ®µåŒºåŸŸï¼Œè™½ç„¶å„è‡ªéƒ½æ˜¯æŒ‰nameæ’åºï¼Œä½†æ•´ä½“éœ€è¦åšä¸€æ¬¡å½’å¹¶ï¼Œå½“ç„¶åªæ˜¯limit100ï¼Œæ‰€ä»¥å¤Ÿæ•°å°±è¡Œã€‚å†ç„¶åå¦‚æœéœ€è¦ä¸åšæ’åºï¼Œä¸šåŠ¡ç«¯å°±æŒ‰cityä¸åŒçš„å–å€¼æŸ¥è¯¢ä¸¤æ¬¡ï¼Œæ¯æ¬¡éƒ½limit100ï¼Œç„¶åä¸šåŠ¡ç«¯åšå½’å¹¶å¤„ç†å–½ã€‚å†ç„¶åè¦åšåˆ†é¡µçš„è¯ï¼Œå¥½å§ï¼Œæˆ‘çš„æ€è·¯æ˜¯å…ˆæ•´å‡ºä¸€å¼ ä¸´æ—¶çš„ç»“æœè¡¨ï¼Œcreate table as select rownumber,* from t where city=x order by name(å†™çš„ä¸å¯¹å“ˆï¼Œåªæ˜¯è¡¨è¾¾æ„æ€ï¼Œrownumberä¸ºè¡Œæ•°,å¹¶ä¸ºä¸»é”®)ç„¶åç›´æ¥ä»è¿™å¼ è¡¨ä¸­æŒ‰rownumberè¿›è¡Œåˆ†é¡µæŸ¥è¯¢å°±å¥½ã€‚","like_count":4,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433427,"discussion_content":"åˆ†é¡µè¿™ä¸ªå†è€ƒè™‘è€ƒè™‘å“ˆğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545183570,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":184872,"user_name":"å¤©å¤©å‘ä¸Š","can_delete":false,"product_type":"c1","uid":1242455,"ip_address":"","ucode":"0CCCA6F4DCC480","user_header":"https://static001.geekbang.org/account/avatar/00/12/f5/57/ce10fb1b.jpg","comment_is_top":false,"comment_ctime":1583422175,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"14468324063","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå¦‚æœåŠ ç´¢å¼•çš„å‡ ä¸ªä¾‹å­ä¸­ï¼Œæ’åºæ˜¯ descï¼Œä¹Ÿå°±æ˜¯å€’åºï¼Œä¼šæ˜¯æ€ä¹ˆæ ·çš„è¿‡ç¨‹å‘¢ã€‚","like_count":3,"discussions":[{"author":{"id":1928368,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLCKzC0IPq9HSaMiaySKyviaBftvz2EjgqKNCwia9C0xIfYnuE7qntQ6fQ9oL2sEyJGWu0Mmj7EbWicrg/132","nickname":"FL","note":"","ucode":"C82D077D6C2277","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283842,"discussion_content":"åœ¨8.0ç‰ˆæœ¬ä¹‹å‰ åº”è¯¥ä»ç„¶æ—¶éœ€è¦è¿›è¡Œ file_sortçš„,ä½†æ˜¯åœ¨8.0ä¹‹å æä¾›äº†å€’å™æœç´¢çš„åŠŸèƒ½,ä¸éœ€è¦flie_sort  è™½ç„¶æ¯”æ­£åºä¼šæ…¢ä¸€ç‚¹,ä½†æ˜¯ä¹Ÿå¾ˆå¤§çš„æå‡äº†æœç´¢çš„æ•ˆç‡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592381541,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1513298,"avatar":"https://static001.geekbang.org/account/avatar/00/17/17/52/a891caa2.jpg","nickname":"é¡¶çº§æ½‡æ´’","note":"","ucode":"4B689B7DAD508D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1928368,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLCKzC0IPq9HSaMiaySKyviaBftvz2EjgqKNCwia9C0xIfYnuE7qntQ6fQ9oL2sEyJGWu0Mmj7EbWicrg/132","nickname":"FL","note":"","ucode":"C82D077D6C2277","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":351767,"discussion_content":"æ˜¯å› ä¸ºåŠ äº†åŒå‘é“¾è¡¨å—ï¼Ÿ\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614430933,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":283842,"ip_address":""},"score":351767,"extra":""}]}]},{"had_liked":false,"id":51663,"user_name":"çˆ±å­¦ä¹ çš„å¥½å­©å­","can_delete":false,"product_type":"c1","uid":1331195,"ip_address":"","ucode":"C51EA3E529BE0B","user_header":"https://static001.geekbang.org/account/avatar/00/14/4f/fb/3eb917f1.jpg","comment_is_top":false,"comment_ctime":1545219714,"is_pvip":false,"replies":[{"id":"18746","content":"å¥½é—®é¢˜ï¼Œæ˜å¤©è§ ğŸ˜<br>ï¼ˆæ˜å¤©çš„ä¸€ç¯‡ä¹Ÿæ˜¯è·Ÿæ’åºæœ‰å…³çš„å“¦ï¼‰","user_name":"ä½œè€…å›å¤","comment_id":51663,"uid":"1264162","ip_address":"","utype":1,"ctime":1545236941,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"14430121602","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œå…¨å­—æ®µæ’åºé‚£ä¸€èŠ‚ï¼Œæˆ‘åšäº†å®éªŒï¼Œæˆ‘çš„æ’åºç¼“å­˜å¤§å°æ˜¯1Mï¼Œ examined rows æ˜¯7715892ï¼ŒæŸ¥è¯¢çš„ä¸‰ä¸ªå­—æ®µéƒ½æœ‰æ•°æ®ï¼Œé‚£ä¹ˆå¦‚æœè¿™äº›æ•°æ®éƒ½æ”¾åˆ°ç¼“å­˜åº”è¯¥éœ€è¦ï¼ˆ4+8+11ï¼‰*7715892ç­‰äº160Mï¼Œä½†æ˜¯æˆ‘çœ‹äº†éƒ½æ²¡æœ‰ç”¨åˆ°ä¸´æ—¶è¡¨ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ<br><br>CREATE TABLE `phone_call_logs` (<br>  `id` int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;ä¸»é”®ID&#39;,<br>  `city_id` int(11) NOT NULL DEFAULT &#39;11&#39;,<br>  `call_sender` varchar(40) DEFAULT NULL COMMENT &#39;ç”µè¯ä¸»å«å·ç &#39;,<br>  `phone_id` bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;æ‰‹æœºid&#39;,<br>  PRIMARY KEY (`id`),<br>  KEY `idx_city` (`city_id`)<br>) ENGINE=InnoDB AUTO_INCREMENT=64551193;<br>----------------sort_buffer_size=1M----------------------------<br>root:(none)&gt; show variables like &#39;sort_buffer_size&#39;;<br>+------------------+---------+<br>| Variable_name    | Value   |<br>+------------------+---------+<br>| sort_buffer_size | 1048576 |<br>+------------------+---------+<br>1 row in set (0.00 sec)<br>---------------æŸ¥è¯¢sql---------------------<br> select city_id,phone_id,call_sender from phone_call_logs where city_id=11 order by phone_id desc limit 1000;<br><br><br>-----------------------æ‰§è¡Œè®¡åˆ’ç»“æœ---------------------------------------------<br><br>  &quot;filesort_priority_queue_optimization&quot;: {<br>              &quot;limit&quot;: 1000,<br>              &quot;rows_estimate&quot;: 146364461,<br>              &quot;row_size&quot;: 146,<br>              &quot;memory_available&quot;: 1048576,<br>              &quot;chosen&quot;: true<br>            },<br>            &quot;filesort_execution&quot;: [<br>            ],<br>            &quot;filesort_summary&quot;: {<br>              &quot;rows&quot;: 1001,<br>              &quot;examined_rows&quot;: 7715892,<br>              &quot;number_of_tmp_files&quot;: 0,<br>              &quot;sort_buffer_size&quot;: 154160,<br>              &quot;sort_mode&quot;: &quot;&lt;sort_key, additional_fields&gt;&quot;<br>","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433559,"discussion_content":"å¥½é—®é¢˜ï¼Œæ˜å¤©è§ ğŸ˜\nï¼ˆæ˜å¤©çš„ä¸€ç¯‡ä¹Ÿæ˜¯è·Ÿæ’åºæœ‰å…³çš„å“¦ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545236941,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51650,"user_name":"yy","can_delete":false,"product_type":"c1","uid":1307788,"ip_address":"","ucode":"4F6E10E2D1FE8C","user_header":"","comment_is_top":false,"comment_ctime":1545217445,"is_pvip":false,"replies":[{"id":"18747","content":"è¦çœ‹ä½¿ç”¨çš„ç´¢å¼•æœ‰æ²¡æœ‰å˜åŒ–ï¼Œ<br>æ˜¯æŒ‰ç…§ç´¢å¼•é¡ºåºçš„","user_name":"ä½œè€…å›å¤","comment_id":51650,"uid":"1264162","ip_address":"","utype":1,"ctime":1545236978,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":2,"race_medal":0,"score":"14430119333","product_id":100020801,"comment_content":"è€å¸ˆæˆ‘æƒ³é—®ä¸€ä¸‹  mysqlåœ¨åšæ²¡æœ‰æ’åºçš„æŸ¥è¯¢è¯­å¥çš„æ—¶å€™  æ¯æ¬¡æ‰«æè¿”å›çš„ç»“æœé›†é¡ºåºä¸€æ ·å—ï¼Ÿè¿˜æ˜¯æ¯æ¬¡æ‰«æçš„ç»“æœé›†é¡ºåºæ˜¯å˜åŒ–çš„ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433554,"discussion_content":"è¦çœ‹ä½¿ç”¨çš„ç´¢å¼•æœ‰æ²¡æœ‰å˜åŒ–ï¼Œ\næ˜¯æŒ‰ç…§ç´¢å¼•é¡ºåºçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545236978,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2344609,"avatar":"https://static001.geekbang.org/account/avatar/00/23/c6/a1/3bdcde91.jpg","nickname":"å‘é™½èŠ±å¼€èŠ±å‘é™½ğŸŒ¸","note":"","ucode":"9FDD01BE0E42CD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":376391,"discussion_content":"æŸ¥è¯¢è¿”å›çš„è®°å½•ï¼Œé»˜è®¤éƒ½æ˜¯æ ¹æ®ç´¢å¼•çš„é¡ºåºè¿”å›çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622107282,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":313413,"user_name":"çè´µçš„æ²¡å¤´è„‘","can_delete":false,"product_type":"c1","uid":2691055,"ip_address":"","ucode":"04C48D36442D35","user_header":"https://static001.geekbang.org/account/avatar/00/29/0f/ef/d7d1fab6.jpg","comment_is_top":false,"comment_ctime":1632413031,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10222347623","product_id":100020801,"comment_content":"è¿™æ˜¯æˆ‘çœ‹çš„â€œæœ€ç´¯â€çš„è¯¾ç¨‹ï¼Œä¸ä»…è¦çœ‹è¯¾ç¨‹ï¼Œè¿˜è¦è¯»è¯„è®ºã€‚ä¸ç„¶é”™å¤±å¤ªå¤šç²¾å½©ã€‚","like_count":2},{"had_liked":false,"id":88150,"user_name":"ææ€ªè€…ğŸ˜˜ ğŸ˜’ ğŸ˜ ğŸ‘¿","can_delete":false,"product_type":"c1","uid":1300678,"ip_address":"","ucode":"40DFF5D3E3B24C","user_header":"https://static001.geekbang.org/account/avatar/00/13/d8/c6/2b2a58cf.jpg","comment_is_top":false,"comment_ctime":1555859125,"is_pvip":false,"replies":[{"id":"34323","content":"left joinè·Ÿjoinçš„è¯­ä¹‰ä¸ä¸€æ ·çš„ï¼Œåé¢æˆ‘ä»¬æœ‰æ–‡ç« ä¼šè¯´åˆ°","user_name":"ä½œè€…å›å¤","comment_id":88150,"uid":"1264162","ip_address":"","utype":1,"ctime":1558261710,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"10145793717","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæˆ‘å‘ç°åˆšåˆšé—®çš„é—®é¢˜æ˜¯å› ä¸ºæˆ‘å°†joinå†™æˆäº†left joinï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆåŠ äº†ä¸€ä¸ªleftå°±ä¼šæœ‰è¿™ä¹ˆå¤§å˜åŒ–å‘¢ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447747,"discussion_content":"left joinè·Ÿjoinçš„è¯­ä¹‰ä¸ä¸€æ ·çš„ï¼Œåé¢æˆ‘ä»¬æœ‰æ–‡ç« ä¼šè¯´åˆ°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558261710,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61286,"user_name":"æ°ä¹‹7","can_delete":false,"product_type":"c1","uid":1297232,"ip_address":"","ucode":"F7DA2E21085332","user_header":"https://static001.geekbang.org/account/avatar/00/13/cb/50/66d0bd7f.jpg","comment_is_top":false,"comment_ctime":1547653035,"is_pvip":false,"replies":[{"id":"21820","content":"ğŸ‘å¾ˆå¥½çš„æ€»ç»“","user_name":"ä½œè€…å›å¤","comment_id":61286,"uid":"1264162","ip_address":"","utype":1,"ctime":1547690226,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"10137587627","product_id":100020801,"comment_content":"é€šè¿‡è¿™ä¸€èŠ‚çš„é˜…è¯»å­¦ä¹ ï¼ŒçŸ¥é“äº†ä¸€ä¸ªæœ‰Order byè¯­è¨€çš„æ’åºé€»è¾‘å’Œæ’åºå¯¹å†…å­˜çš„æ¶ˆè€—ã€‚<br><br>è€å¸ˆä»‹ç»äº†4ç§æƒ…å†µï¼ŒåŒºåˆ†äº†å…¨å­—æ®µæ’åºå’ŒRowidæ’åºçš„åŒºåˆ«ï¼Œå¦‚æœæœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œç”¨å…¨å­—æ®µæ’åºï¼Œå¦åˆ™ç”¨Rowidæ’åºï¼Œè¿™æ ·æ’åºçš„æ•ˆç‡ä¼šæ›´å¥½ã€‚<br><br>åœ¨ä¸Šè¿°ä¸¤ç§æ’åºçš„åŸºç¡€ä¹‹ä¸Šï¼Œè®²è¿°äº†è”åˆç´¢å¼•ï¼Œè”åˆç´¢å¼•è§£å†³äº†ä¸éœ€è¦æŒ‰ç…§å§“åè¿›è¡Œæ’åºï¼Œè¿™æ ·åªéœ€è¦æ‰«æ1000æ¬¡ã€‚è¿›ä¸€æ­¥æ˜¯è¦†ç›–ç´¢å¼•ï¼Œè¿å›åˆ°ä¸»é”®å–ç´¢å¼•éƒ½ä¸éœ€è¦äº†ã€‚<br><br>é€šè¿‡è¿™ä¸€èŠ‚çš„å­¦ä¹ ï¼ŒçŸ¥é“äº†ä¸€æ¡æœ‰Order by è¯­å¥çš„æ‰§è¡Œæµç¨‹å’Œå¯¹ç³»ç»Ÿèµ„æºçš„å½±å“ï¼Œè°¢è°¢è€å¸ˆå“ˆã€‚","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436819,"discussion_content":"ğŸ‘å¾ˆå¥½çš„æ€»ç»“","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547690226,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53948,"user_name":"å°å²­å“¥","can_delete":false,"product_type":"c1","uid":1209817,"ip_address":"","ucode":"C022D703B6D4E9","user_header":"https://static001.geekbang.org/account/avatar/00/12/75/d9/24786b20.jpg","comment_is_top":false,"comment_ctime":1545779695,"is_pvip":true,"replies":[{"id":"19556","content":"å› ä¸ºç´¢å¼•è¦æ±‚â€œæœ‰åºâ€","user_name":"ä½œè€…å›å¤","comment_id":53948,"uid":"1264162","ip_address":"","utype":1,"ctime":1545789402,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"10135714287","product_id":100020801,"comment_content":"ä¸ºä»€ä¹ˆå»ºç«‹ç»„åˆç´¢å¼•ä¹‹åä¼šå¤©ç„¶çš„æŒ‰ç…§nameé€’å¢æ’åºå‘¢","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434296,"discussion_content":"å› ä¸ºç´¢å¼•è¦æ±‚â€œæœ‰åºâ€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545789402,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52440,"user_name":"å¤å¨œæ‹‰é»‘æš—ä¹‹ç¥Â·å·´å•¦å•¦èƒ½é‡Â·å •è½è¾¾","can_delete":false,"product_type":"c1","uid":1185642,"ip_address":"","ucode":"080BBCEF7DE985","user_header":"https://static001.geekbang.org/account/avatar/00/12/17/6a/c979163e.jpg","comment_is_top":false,"comment_ctime":1545382644,"is_pvip":false,"replies":[{"id":"19106","content":"Explainæ²¡æœ‰è€ƒè™‘limitçš„ï¼Œè¿™ä¸ªä¸æ˜¯å®é™…æ‰§è¡Œæ•ˆæœã€‚ä½ çœ‹çœ‹slow logçš„è¾“å‡º","user_name":"ä½œè€…å›å¤","comment_id":52440,"uid":"1264162","ip_address":"","utype":1,"ctime":1545398208,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"10135317236","product_id":100020801,"comment_content":"å •è½å¤©ä½¿<br>è€å¸ˆï¼Œæ‚¨å¥½ã€‚<br>è¯·é—®ï¼šå»ºç«‹äº†cityã€nameã€ageçš„è”åˆç´¢å¼•ä¹‹åï¼Œæ‰§è¡Œ â€œselect city,name,age from t where city=&#39;æ­å·&#39; order by name limit 1000 ;â€ è¯­å¥ï¼Œæ˜¾ç¤ºçš„rowsï¼ˆå½±å“è¡Œæ•°ï¼‰ä¾æ—§æ˜¯4000å‘¢ï¼Ÿä¸åº”è¯¥æ˜¯1000å—ï¼Ÿ<br>2018-12-20<br>î˜ˆ ä½œè€…å›å¤<br>Explain å‘æ¥çœ‹çœ‹<br>æˆ‘ï¼š<br>å‘½ä»¤å¦‚ä¸‹ï¼š<br>mysql&gt; select count(*) from p where city = &#39;æ­å·&#39;;<br>+----------+<br>| count(*) |<br>+----------+<br>|     4000 |<br>+----------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; explain select city,name,age from p where city=&#39;æ­å·&#39; order by name limit 1000;<br>+----+-------------+-------+------------+------+---------------+---------------+---------+-------+------+----------+--------------------------+<br>| id | select_type | table | partitions | type | possible_keys | key           | key_len | ref   | rows | filtered | Extra                    |<br>+----+-------------+-------+------------+------+---------------+---------------+---------+-------+------+----------+--------------------------+<br>|  1 | SIMPLE      | p     | NULL       | ref  | city_name_age | city_name_age | 66      | const | 4000 |   100.00 | Using where; Using index |<br>+----+-------------+-------+------------+------+---------------+---------------+---------+-------+------+----------+--------------------------+<br>1 row in set, 1 warning (0.00 sec)<br>ç”±explainçš„ç»“æœå¯è§ï¼šä½¿ç”¨çš„ç´¢å¼•æ˜¯city_name_ageï¼Œæ‰«æçš„è¡Œæ•°ï¼ˆrowsï¼‰æ˜¯4000ã€‚è€Œä¸”æ‚¨æ–‡ç« ä¸­çš„ å›¾9 å’Œ å›¾11 ä¸­çš„rowså€¼ä¹Ÿæ˜¯4000ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ<br>","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433875,"discussion_content":"Explainæ²¡æœ‰è€ƒè™‘limitçš„ï¼Œè¿™ä¸ªä¸æ˜¯å®é™…æ‰§è¡Œæ•ˆæœã€‚ä½ çœ‹çœ‹slow logçš„è¾“å‡º","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545398208,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51978,"user_name":"ä¸€å¤§åªğŸ˜´","can_delete":false,"product_type":"c1","uid":1310960,"ip_address":"","ucode":"92F3D2B7F63568","user_header":"https://static001.geekbang.org/account/avatar/00/14/00/f0/08409e78.jpg","comment_is_top":false,"comment_ctime":1545287880,"is_pvip":false,"replies":[{"id":"18918","content":"å¯¹çš„ï¼Œä¸è¿‡æè¿°è¦ç²¾ç¡®äº›<br><br>èµ°äº†ç´¢å¼•çš„ï¼Œåˆ©ç”¨ç´¢å¼•å¿«é€Ÿå®šä½è®°å½•ï¼Œä½†æ˜¯æ’åºçš„æ—¶å€™æ²¡ç”¨ä¸Š","user_name":"ä½œè€…å›å¤","comment_id":51978,"uid":"1264162","ip_address":"","utype":1,"ctime":1545315739,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"10135222472","product_id":100020801,"comment_content":"è¯¾åæ€è€ƒé¢˜ï¼šè¿˜è¦ä½¿ç”¨æ’åºã€‚åœ¨è™šæ‹Ÿæœºä¸Šæµ‹è¯•äº†ï¼Œæ²¡åŠ order by nameæ—¶å€™ï¼Œcity in ä¸¤ä¸ªå€¼æ—¶å°±æ²¡æœ‰èµ°ç´¢å¼•ï¼Œæ‰€ä»¥è¿˜æ˜¯è¦æ’åºï¼Œcity in ä¿©å€¼ç›¸å½“äºoräº†","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433686,"discussion_content":"å¯¹çš„ï¼Œä¸è¿‡æè¿°è¦ç²¾ç¡®äº›\n\nèµ°äº†ç´¢å¼•çš„ï¼Œåˆ©ç”¨ç´¢å¼•å¿«é€Ÿå®šä½è®°å½•ï¼Œä½†æ˜¯æ’åºçš„æ—¶å€™æ²¡ç”¨ä¸Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545315739,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51358,"user_name":"æ˜äº®","can_delete":false,"product_type":"c1","uid":1303015,"ip_address":"","ucode":"DAFB3424C4C2D7","user_header":"https://static001.geekbang.org/account/avatar/00/13/e1/e7/d1b2e914.jpg","comment_is_top":false,"comment_ctime":1545178085,"is_pvip":false,"replies":[{"id":"18539","content":"è¿™æ ·ä¸å¤ªå¥½å“ˆï¼Œå˜æˆå…¨ç´¢å¼•æ‰«æäº†","user_name":"ä½œè€…å›å¤","comment_id":51358,"uid":"1264162","ip_address":"","utype":1,"ctime":1545183397,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"10135112677","product_id":100020801,"comment_content":"éœ€è¦æ’åºï¼Œå¯ä»¥å°†åŸæ¥çš„ç´¢å¼•ä¸­nameå­—æ®µæ”¾å‰é¢ï¼Œcityå­—æ®µæ”¾åé¢ï¼Œæ¥å»ºç´¢å¼•å°±å¯ä»¥äº†","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433423,"discussion_content":"è¿™æ ·ä¸å¤ªå¥½å“ˆï¼Œå˜æˆå…¨ç´¢å¼•æ‰«æäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545183397,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51315,"user_name":"å°˜å°","can_delete":false,"product_type":"c1","uid":1247006,"ip_address":"","ucode":"CEE0C006387A03","user_header":"https://static001.geekbang.org/account/avatar/00/13/07/1e/bdbe93f4.jpg","comment_is_top":false,"comment_ctime":1545154231,"is_pvip":false,"replies":[{"id":"18542","content":"è¦æ˜¯æ’åºå°±ç»“æœä¸ç¬¦åˆorder by çš„è¯­ä¹‰é€»è¾‘äº†â€¦","user_name":"ä½œè€…å›å¤","comment_id":51315,"uid":"1264162","ip_address":"","utype":1,"ctime":1545183546,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"10135088823","product_id":100020801,"comment_content":"è¯·é—®ï¼Œç¬¬7æ­¥ä¸­éå†æ’åºç»“æœï¼Œå–å‰ 1000 è¡Œï¼Œå¹¶æŒ‰ç…§ id çš„å€¼å›åˆ°åŸè¡¨ä¸­å–å‡º cityã€name å’Œ age ä¸‰ä¸ªå­—æ®µè¿”å›ç»™å®¢æˆ·ç«¯ï¼šè¿™é‡Œä¼šæŠŠidå†è¿›è¡Œæ’åºå—ï¼Ÿè½¬éšæœºioä¸ºé¡ºåºioï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433405,"discussion_content":"è¦æ˜¯æ’åºå°±ç»“æœä¸ç¬¦åˆorder by çš„è¯­ä¹‰é€»è¾‘äº†â€¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545183546,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":307393,"user_name":"Geek_71eb87","can_delete":false,"product_type":"c1","uid":1538835,"ip_address":"","ucode":"728A62EF2740BE","user_header":"","comment_is_top":false,"comment_ctime":1629080904,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5924048200","product_id":100020801,"comment_content":"è¯·æ•™ä¸€ä¸‹è€å¸ˆï¼Œæˆ‘ç°åœ¨æœ‰ä¸ªè¡¨A åŒ…å«pair å’Œblockä¸¤ä¸ªå­—æ®µï¼Œç°åœ¨æœ‰ä¸ªæŸ¥è¯¢è¯­å¥æ˜¯è¿™æ ·çš„<br> select * from A wher pair=&#39;x&#39; and block&lt;=y  order by block desc limit 1<br> limit 1çš„æ—¶å€™å¾ˆæ…¢<br><br>è€Œ select * from A wher pair=&#39;x&#39; and block&lt;=y  order by block desc limit 10<br>ä½¿ç”¨Limit 10çš„æ—¶å€™å¾ˆå¿« è¿™ä¸ªæ˜¯ä»€ä¹ˆåŸå› ","like_count":1,"discussions":[{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587510,"discussion_content":"è¡¨ç´¢å¼•è¿™äº›éƒ½æ²¡è´´å‡ºæ¥æ€ä¹ˆçœ‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663121691,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1324550,"avatar":"https://static001.geekbang.org/account/avatar/00/14/36/06/08c46bcd.jpg","nickname":"è‚åˆ©","note":"","ucode":"808E064089724D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586499,"discussion_content":"åº”è¯¥æ˜¯limit 1 å¯¼è‡´èµ°äº†ç´¢å¼• ï¼Œè€Œlimit 10èµ°ç´¢å¼•å›è¡¨å¤ªå¤šï¼Œé€‰æ‹©å…¨è¡¨æ‰«è¡¨ï¼Œæ›´æ…¢äº†ï¼Œå¯ä»¥é‡‡ç”¨å¼ºåˆ¶ç´¢å¼•çœ‹çœ‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662268665,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":306529,"user_name":"æ…Œå¼ è€Œé»‘ç³–","can_delete":false,"product_type":"c1","uid":1638878,"ip_address":"","ucode":"B4416885A301C8","user_header":"https://static001.geekbang.org/account/avatar/00/19/01/de/bf524817.jpg","comment_is_top":false,"comment_ctime":1628598292,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5923565588","product_id":100020801,"comment_content":"æœ€è¿‘ä¸€ç›´æœ‰ä¸ªlimitåˆ†é¡µä¼˜åŒ–çš„é—®é¢˜å›°æ‰°ç€æˆ‘ï¼Œä¸çŸ¥é“è€å¸ˆæ˜¯å¦èƒ½å¤Ÿè§£ç­”ä¸€ä¸‹ï¼Œæ¯”å¦‚ï¼šselect * from words where id &gt; (select id from words order by id limit 1000,1) limit 10ï¼ˆidä¸ºä¸»é”®ï¼‰è¿™ç§æ–¹å¼limitå¦‚ä½•è®¡ç®—è¡Œæ•°çš„ï¼Œæƒ³äº†è§£ä¸€ä¸‹è¿™æ¡è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œæˆ‘ä¸å¤ªæ¸…æ¥šå…·ä½“ä¼˜åŒ–åœ¨å“ªé‡Œï¼Œå¦‚æœè¯´æ˜¯ä½¿ç”¨äº†ç´¢å¼•ï¼Œä½†æ˜¯å®ƒæ˜¯å¦‚ä½•è®¡ç®—ç¬¬1000æ¡çš„ä½ç½®ï¼Ÿ","like_count":1},{"had_liked":false,"id":300292,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1625099778,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5920067074","product_id":100020801,"comment_content":"ä½¿ç”¨city_user_ageè¦†ç›–ç´¢å¼•ï¼Œæˆ‘å¯»æ€ç€åªèµ°äº†ç´¢å¼•ï¼Œæ²¡å›è¡¨ã€‚æ‰«æè¡Œæ•°åº”è¯¥ä¸º0ã€‚ä½†æ˜¯å®é™…æ˜¯1000ï¼Œè¿™å—ä¸æ‡‚å•Šã€‚ã€‚ã€‚<br><br>å¦‚æœæ‰«æç´¢å¼•ä¹Ÿå¾—è®¡ç®—æ‰«æè¡Œæ•°ï¼Œé‚£å‰é¢åªæœ‰city å•å­—æ®µç´¢å¼•æ—¶ï¼Œæ‰«æè¡Œæ•°å°±åº”è¯¥æ˜¯ç¿»ç•ªã€‚","like_count":1},{"had_liked":false,"id":300249,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1625063533,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5920030829","product_id":100020801,"comment_content":"æ ‡è®°ä¸‹ï¼š<br>https:&#47;&#47;dev.mysql.com&#47;doc&#47;refman&#47;5.7&#47;en&#47;explain-output.html#explain-extra-information ã€Using filesortã€‘ æœ¬æ¬¡æŸ¥è¯¢è¯­å¥ä¸­æœ‰order byï¼Œä¸”æ’åºä¾ç…§çš„å­—æ®µä¸åœ¨æœ¬æ¬¡ä½¿ç”¨çš„ç´¢å¼•ä¸­ï¼Œä¸èƒ½è‡ªç„¶æœ‰åºã€‚éœ€è¦è¿›è¡Œé¢å¤–çš„æ’åºå·¥ä½œã€‚ ã€Using indexã€‘ ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•â€”â€”å³æœ¬æ¬¡æŸ¥è¯¢æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯å­—æ®µéƒ½å¯ä»¥ä»åˆ©ç”¨çš„ç´¢å¼•ä¸Šå–å¾—ã€‚æ— éœ€å›è¡¨ï¼Œé¢å¤–å»ä¸»ç´¢å¼•ä¸Šå»æ•°æ®ã€‚ The column information is retrieved from the table using only information in the index tree without having to do an additional seek to read the actual row. This strategy can be used when the query uses only columns that are part of a single index. ã€Using index conditionã€‘ ä½¿ç”¨äº†ç´¢å¼•ä¸‹æ¨æŠ€æœ¯ICPã€‚ï¼ˆè™½ç„¶æœ¬æ¬¡æŸ¥è¯¢æ‰€éœ€çš„æ•°æ®ï¼Œä¸èƒ½ä»åˆ©ç”¨çš„ç´¢å¼•ä¸Šå®Œå…¨å–å¾—ï¼Œè¿˜æ˜¯éœ€è¦å›è¡¨å»ä¸»ç´¢å¼•è·å–ã€‚ä½†åœ¨å›è¡¨å‰ï¼Œå……åˆ†åˆ©ç”¨ç´¢å¼•ä¸­çš„å­—æ®µï¼Œæ ¹æ®whereæ¡ä»¶è¿›è¡Œè¿‡æ»¤ã€‚æå‰æ’é™¤äº†ä¸ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„åˆ—ã€‚è¿™æ ·å°±å‡å°‘äº†å›è¡¨çš„æ¬¡æ•°ï¼Œæé«˜äº†æ•ˆç‡ã€‚ï¼‰ Tables are read by accessing index tuples and testing them first to determine whether to read full table rows. In this way, index information is used to defer (â€œpush downâ€) reading full table rows unless it is necessary. See Section 8.2.1.5, â€œIndex Condition Pushdown Optimizationâ€. ã€Using whereã€‘ è¡¨ç¤ºæœ¬æ¬¡æŸ¥è¯¢è¦è¿›è¡Œç­›é€‰è¿‡æ»¤ã€‚","like_count":1},{"had_liked":false,"id":300236,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1625057789,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5920025085","product_id":100020801,"comment_content":"cityã€nameã€age è¿™ä¸‰ä¸ªå­—æ®µçš„å®šä¹‰æ€»é•¿åº¦æ˜¯ 36ã€‚<br>å½“è®¾ç½®186æ‰ä½¿ç”¨&lt;sort_key, additional_fields&gt;,<br>&lt;=185ä½¿ç”¨&lt;sort_key, rowid&gt;ï¼Œ<br>åˆ«é—®æˆ‘æ€ä¹ˆçŸ¥é“çš„ï¼Œæˆ‘ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•è¯•å‡ºæ¥ çš„ã€‚ä½†æ˜¯è¿˜å¾—æ‰¾åŸå› ï¼Œå› ä¸ºæˆ‘è®¡ç®—é•¿åº¦æ˜¯16*3+16*3+4=100ã€‚ã€‚ã€‚","like_count":1,"discussions":[{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587511,"discussion_content":"ä¸€æ ·ã€‚æ‰€ä»¥åˆ«çº ç»“è®¡ç®—äº†ï¼Œåªè¦ç›´åˆ°è¿™ä¸ªä¼šå½±å“æ’åºç®—æ³•é€‰æ‹©å°±è¡Œäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663121809,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":300233,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1625057096,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5920024392","product_id":100020801,"comment_content":"cityã€nameã€age è¿™ä¸‰ä¸ªå­—æ®µçš„å®šä¹‰æ€»é•¿åº¦æ˜¯ 36ã€‚<br>è¿™é‡Œé•¿åº¦æ˜¯æ€ä¹ˆè®¡åˆ’çš„ï¼Œ city:16+name:16+age:4=36ï¼Ÿå¦‚æœæ˜¯utf-8ï¼Œcityå’Œnameå…¨å­˜æ±‰å­—ï¼Œé‚£å°±æ˜¯16*3+16*3+4=100å•Š","like_count":1},{"had_liked":false,"id":246732,"user_name":"benxiong","can_delete":false,"product_type":"c1","uid":1624574,"ip_address":"","ucode":"F6498059D439D9","user_header":"https://static001.geekbang.org/account/avatar/00/18/c9/fe/874b172b.jpg","comment_is_top":false,"comment_ctime":1599467309,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5894434605","product_id":100020801,"comment_content":"è€å¸ˆèƒ½ä¸èƒ½è®²è§£ä¸€ä¸‹ Using index condition, Using index, Using where...... ä¹‹é—´çš„åŒºåˆ«ã€‚ç½‘ä¸Šæ‰¾çš„ç­”æ¡ˆä¸æ•¢å»ç›¸ä¿¡ã€‚ç°åœ¨æ‰æ¥ç•™è¨€ï¼Œæ˜¯ä¸æ˜¯å¾—ä¸åˆ°å›å¤äº†:(  çœ‹åˆ°çš„åŒå­¦å¸®å¿™è§£ç­”ä¸€ä¸‹ï¼Œæ„Ÿè°¢ï¼","like_count":1,"discussions":[{"author":{"id":1962621,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/f2/7d/24fc1423.jpg","nickname":"XRR","note":"","ucode":"5AEFA04C43C5B4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":401067,"discussion_content":"using index condiction ç´¢å¼•ä¸‹æ¨\nusing index ç´¢å¼•è¦†ç›–\nusing where ä»£è¡¨è¿‡æ»¤å…ƒç»„ å¯ä»¥ç†è§£ä¸ºä½¿ç”¨äº†where using where å’Œ using indexä¸€èµ·å‡ºç°ä»£è¡¨ä½¿ç”¨äº†ç´¢å¼•è¿‡æ»¤æ•°æ®","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1633532600,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":238204,"user_name":"Z","can_delete":false,"product_type":"c1","uid":1588016,"ip_address":"","ucode":"13BB106EABA035","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIz50ciaONXadCquPf8WDzKzyMYMeDSChgZcMR605sMfSibdw1vXbXvpAFkQxW70GkRtDqFu9lwPlFg/132","comment_is_top":false,"comment_ctime":1596095052,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5891062348","product_id":100020801,"comment_content":"æƒ³è¯·æ•™ä¸‹å¯¹äºvarcharç±»å‹æ’åºï¼Œæ’åºçš„ä¾æ®æ˜¯ä»€ä¹ˆå‘¢ï¼Œå¦‚æœæ˜¯rowidé‚£å¯¹nameæ’åºçš„æ—¶å€™è¿˜æ˜¯ä¼šä¾æ®idæ¥æ’ä¹ˆï¼Œä¸æ˜¯rowidçš„è¯æ’åºnameåˆæ˜¯æ€ä¹ˆç¡®å®šé¡ºåºçš„å‘¢","like_count":1},{"had_liked":false,"id":231462,"user_name":"ä¹ å…®ä¹ å…®","can_delete":false,"product_type":"c1","uid":1367043,"ip_address":"","ucode":"E616E924188CBA","user_header":"https://static001.geekbang.org/account/avatar/00/14/dc/03/ad9574b3.jpg","comment_is_top":false,"comment_ctime":1593680791,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"5888648087","product_id":100020801,"comment_content":"å…³äºä¸Šä¸€èŠ‚ï¼Œé€‰é¡¹äºŒçš„è§£é‡Šæ„Ÿè§‰è¿˜æ˜¯å­˜åœ¨é—®é¢˜ï¼š<br>å‡å¦‚æœ‰id, a, bä¸‰ä¸ªå­—æ®µï¼›<br>1. sessionAå¼€å¯äº‹åŠ¡ï¼Œæ‰§è¡ŒæŸ¥è¯¢select * ...;<br>2.sessionBä¿®æ”¹açš„å€¼ï¼Œcommitï¼›<br>3.sessionAä¿®æ”¹bçš„å€¼, é‡ç‚¹åœ¨è¿™é‡Œï¼ˆè¿™é‡Œä¼šè¿›è¡Œä¸€æ¬¡å½“å‰è¯»ï¼Œä¹Ÿå°±æ˜¯sessionBä¿®æ”¹çš„aå€¼ä¼šè¢«è¯»è¿›æ¥ï¼‰ï¼›<br>4.sessionAæ‰§è¡Œselect * ...,è¿™æ—¶ä¼šå‘ç°a,bçš„å€¼å‡è¢«ä¿®æ”¹äº†ï¼›<br>æ—¢ç„¶ç»“æœæ˜¯å‡è¢«ä¿®æ”¹ï¼Œé‚£ä¹ˆè€å¸ˆçš„ç¤ºä¾‹æ€ä¹ˆèƒ½è¯æ˜æ˜¯æ­£å¸¸å†™äº†ï¼Ÿè€Œä¸æ˜¯åœ¨updateçš„æ—¶å€™å®Œæˆäº†ä¸€æ¬¡å½“å‰è¯»çš„ç»“æœå‘¢ï¼Ÿå¦‚æœè€å¸ˆæˆ–å“ªä½å¤§ä½¬è¿˜èƒ½çœ‹åˆ°ï¼Œå¯ä»¥ç»™æˆ‘è§£æƒ‘ä¸€ä¸‹ä¹ˆï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1135537,"avatar":"https://static001.geekbang.org/account/avatar/00/11/53/b1/3d6075cc.jpg","nickname":"ç‹å»º","note":"","ucode":"2289B282E18826","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":296394,"discussion_content":"å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ ¹æ®MVCCç‰¹æ€§ï¼Œäº‹åŠ¡Aæ˜¯çœ‹ä¸åˆ°äº‹åŠ¡Bçš„ä¿®æ”¹çš„ã€‚äº‹åŠ¡A updateçš„æ—¶å€™ä¸ä»…è¦è¿›è¡Œå½“å‰è¯»ï¼Œæ•°æ®æ›´æ–°åè¿˜ä¼šä¿®æ”¹æ•°æ®è¡Œçš„äº‹åŠ¡idï¼ˆrow trx_idï¼‰ä¸ºäº‹åŠ¡Açš„ äº‹åŠ¡IDï¼Œè¿™æ ·äº‹åŠ¡Aå°±çœ‹åˆ°äº†äº‹åŠ¡Bçš„ä¿®æ”¹ï¼Œæ‰€ä»¥è€å¸ˆè¯´æ˜¯è¿›è¡Œäº†æ­£å¸¸å†™ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596531740,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":203827,"user_name":"å¦ææ³°æ¥","can_delete":false,"product_type":"c1","uid":1439355,"ip_address":"","ucode":"C249173266251A","user_header":"https://static001.geekbang.org/account/avatar/00/15/f6/7b/b6abcbbe.jpg","comment_is_top":false,"comment_ctime":1586270873,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5881238169","product_id":100020801,"comment_content":"è€å¸ˆè®²çš„æ˜¯æ­£åºæ’åº å¦‚æœdescå€’å™ä¹Ÿæ˜¯ç›¸åŒçš„å—ï¼Ÿ","like_count":1},{"had_liked":false,"id":195368,"user_name":"GalaxyCreater","can_delete":false,"product_type":"c1","uid":1508329,"ip_address":"","ucode":"C79E8A088D57CF","user_header":"https://static001.geekbang.org/account/avatar/00/17/03/e9/6358059c.jpg","comment_is_top":false,"comment_ctime":1585183946,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5880151242","product_id":100020801,"comment_content":"åœ¨mysql8.0ä¸­è¿˜æ˜¯ä¼šè¿”å›(1,2)ï¼Œè€Œmysql 5.6ä¸­è¿”å›çš„æ˜¯(1,3)ï¼Œ8.0çš„æœºåˆ¶æ”¹äº†ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1603078,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/zAZv4NyuS21Y1qk45j8JiaoEYdA5Zgc1PqpJsBokz5bZVmdkf6kNWvT4cUAAKAdH6TgN52DWZhiaH6wNFhw14nRg/132","nickname":"Geek_4e4ec2","note":"","ucode":"6DAD5EE4FFB195","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535681,"discussion_content":"åŒé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638515509,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1303954,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/1mOvT5fApeicXppMP3zADG6XIPicNt5D9dL6y46SF5UUcH0hicG21LM6xSgHJj5oAdzCyeGtLZYHYmlvaFwecrGOA/132","nickname":"è€ƒæ‹‰å‡ºå±±","note":"","ucode":"917E35FD7B2D06","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":300953,"discussion_content":"5.7.17 ä¹Ÿæ˜¯è¿™ä¸ªç»“æœ  ï¼ˆ1ï¼Œ2ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598340145,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":184870,"user_name":"å¤©å¤©å‘ä¸Š","can_delete":false,"product_type":"c1","uid":1242455,"ip_address":"","ucode":"0CCCA6F4DCC480","user_header":"https://static001.geekbang.org/account/avatar/00/12/f5/57/ce10fb1b.jpg","comment_is_top":false,"comment_ctime":1583421709,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5878389005","product_id":100020801,"comment_content":"æ–‡ç« ä¸­è®²çš„åŠ ç´¢å¼•æ’åºçš„ä¸¤ä¸ªä¾‹å­ä¸­ä¸æ˜¯åªæ‰«æ1000è¡Œå—ï¼Œä¸ºä»€ä¹ˆexplainæ˜¾ç¤ºrowséƒ½æ˜¯4000å‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":2326134,"avatar":"https://static001.geekbang.org/account/avatar/00/23/7e/76/368394bf.jpg","nickname":"å“¦","note":"","ucode":"C776659DED9D79","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337091,"discussion_content":"ä¸æ˜¯åªæ‰«æ1000è¡Œï¼Œæ˜¯å°†è¦ç¬¦åˆæ¡ä»¶çš„è¡Œæ£€ç´¢å‡ºæ¥ï¼ˆä¸€å…±4000è¡Œï¼‰ï¼Œç„¶ålimitè¿”å›1000è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608794441,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1152877,"avatar":"https://static001.geekbang.org/account/avatar/00/11/97/6d/ec8bb975.jpg","nickname":"å‡‰æœ¨","note":"","ucode":"F8344585965790","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":261882,"discussion_content":"åŒé—®\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589018196,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114335,"user_name":"ç§èŠ±å®¶çš„å…”å­","can_delete":false,"product_type":"c1","uid":1396594,"ip_address":"","ucode":"24221423485348","user_header":"https://static001.geekbang.org/account/avatar/00/15/4f/72/72923901.jpg","comment_is_top":false,"comment_ctime":1563276638,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5858243934","product_id":100020801,"comment_content":"å…³äºå¤§æ•°æ®é‡æ’åºå¹¶limitçš„æ—¶å€™offsetå¾ˆå¤§ï¼Œå³ä½¿order byçš„å­—æ®µä¸Šæœ‰ç´¢å¼•ï¼Œä¹Ÿä¼šå¯¼è‡´å…¨è¡¨æ‰«æçš„é—®é¢˜ï¼ŒæŸ¥äº†å¾ˆå¤šèµ„æ–™ï¼Œå¯ä»¥é€šè¿‡è¦†ç›–ç´¢å¼•è¾¾åˆ°å»¶è¿Ÿå…³è”çš„æ•ˆæœï¼Œä»è€Œé¿å…å…¨è¡¨æ‰«æï¼Œä½†æ˜¯ä¸ç†è§£ä¸ºä»€ä¹ˆmysqlä¸èƒ½é€šè¿‡order byå­—æ®µä¸Šçš„ç´¢å¼•æ¥è¯»å–éœ€è¦çš„è®°å½•ï¼Œè€Œä¸æ˜¯è¯»å–å¤§é‡æ•°æ®ç„¶åä¸¢å¼ƒå¤§éƒ¨åˆ†æ•°æ®ã€‚","like_count":1},{"had_liked":false,"id":87777,"user_name":"zws","can_delete":false,"product_type":"c1","uid":1240091,"ip_address":"","ucode":"18EC6E85F3431E","user_header":"https://static001.geekbang.org/account/avatar/00/12/ec/1b/650e3dbe.jpg","comment_is_top":false,"comment_ctime":1555689246,"is_pvip":false,"replies":[{"id":"31661","content":"å…¶å®è¿™ä¸€ç¯‡çš„å†…å®¹å…¶å®æ˜¯é¢å‘å¼€å‘å·¥ç¨‹å¸ˆçš„ğŸ˜…","user_name":"ä½œè€…å›å¤","comment_id":87777,"uid":"1264162","ip_address":"","utype":1,"ctime":1555826165,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"5850656542","product_id":100020801,"comment_content":"çœ‹åˆ°redolog  å’Œ binlog çš„å†…å®¹å°±ç›¸å½“å¤´ç–¼ã€‚ã€‚  è¿™ä¸€ç« è®²çš„æ’åºå†™çš„éå¸¸å¥½ï¼Œçœ‹åˆ°ç»“å°¾å…³äºä¸Šä¸€èŠ‚çš„æé—®å›ç­”æˆ‘åˆé™·å…¥çš„æ²‰æ€ã€‚ã€‚ã€‚æˆ‘ä¸æ˜¯dbaè¿™äº›å†…å®¹æœ‰è¿™ä¹ˆé‡è¦å—","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447596,"discussion_content":"å…¶å®è¿™ä¸€ç¯‡çš„å†…å®¹å…¶å®æ˜¯é¢å‘å¼€å‘å·¥ç¨‹å¸ˆçš„ğŸ˜…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555826165,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77027,"user_name":"å•Šå•Šå•Šå“¦å“¦","can_delete":false,"product_type":"c1","uid":1309877,"ip_address":"","ucode":"68C7153ECAAC57","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/RNO4yZyBvic914hewmNNE8iblYDcfv5yGHZ9OnKuCuZXNmGR0F5qV3icKLT2xpMt66GyEpicZVvrmz8A6TIqt92MQg/132","comment_is_top":false,"comment_ctime":1552809870,"is_pvip":false,"replies":[{"id":"28916","content":"ä½ ç†è§£çš„å¯¹ğŸ˜†","user_name":"ä½œè€…å›å¤","comment_id":77027,"uid":"1264162","ip_address":"","utype":1,"ctime":1553419497,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":4,"race_medal":0,"score":"5847777166","product_id":100020801,"comment_content":"æ–‡ç« è¯´çš„ç´§å‡‘æ’åºçš„æ„æ€æ˜¯ã€‚æˆ‘æœ‰ä¸€ä¸ªvarcharï¼ˆ16ï¼‰çš„å­—æ®µã€‚ä½†æ˜¯æˆ‘åªå­˜äº†8ä¸ªå­—ã€‚ æ’åºçš„æ—¶å€™æ˜¯æŒ‰å®é™…çš„8*3ä¸ªå­—èŠ‚æ¥ç®—å†…å­˜å—ã€‚  æˆ‘çœ‹é«˜æ€§èƒ½mysqlé‡Œé¢è¯´çš„æ˜¯ã€‚æŒ‰å­—æ®µé•¿åº¦æ¥ç®—ä¹Ÿå°±æ˜¯æŒ‰16æ¥ç®—çš„","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443552,"discussion_content":"ä½ ç†è§£çš„å¯¹ğŸ˜†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553419497,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1425377,"avatar":"https://static001.geekbang.org/account/avatar/00/15/bf/e1/ae6963bb.jpg","nickname":"è–„è·","note":"","ucode":"B394DB7AB4DC58","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394120,"discussion_content":"ä¸å¤ªæ˜ç™½ä¸ºä»€ä¹ˆrowidæ’åºåè€Œæ²¡æœ‰ç”¨packed_additional_fields","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631751655,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":159100,"discussion_content":"ä¸ºå•¥æ˜¯8*3ä¸ªå­—èŠ‚ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580652795,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1386818,"avatar":"https://static001.geekbang.org/account/avatar/00/15/29/42/43d4b1a8.jpg","nickname":"çƒ«çƒ«çƒ«","note":"","ucode":"C06018670DE76A","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":319111,"discussion_content":"utf8mb4ç¼–ç ä¸‹ï¼Œä¸€ä¸ªä¸­æ–‡ä¸€èˆ¬éƒ½æ˜¯3ä¸ªå­—èŠ‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603944501,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":159100,"ip_address":""},"score":319111,"extra":""}]}]},{"had_liked":false,"id":66825,"user_name":"Sinyo","can_delete":false,"product_type":"c1","uid":1307297,"ip_address":"","ucode":"57B243E7AB86A5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJAibnPX9jW8kqLcIfibjic8GbkQkEUYyFKJkc39hZhibVlNrqwTjdLozkqibI2IwACd5YzofYickNxFnZg/132","comment_is_top":false,"comment_ctime":1550026163,"is_pvip":false,"replies":[{"id":"23667","content":"æ˜¯çš„<br>","user_name":"ä½œè€…å›å¤","comment_id":66825,"uid":"1264162","ip_address":"","utype":1,"ctime":1550043560,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"5844993459","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå¦‚æœrow_idç®—æ³•çš„å¤§å°ä¹Ÿè¶…å‡ºäº†sort_buffer_sizeï¼Œé‚£ä¹ˆä¹Ÿä¼šç”¨åˆ°ç£ç›˜ä¸´æ—¶æ–‡ä»¶è¾…åŠ©ä¹ˆï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438932,"discussion_content":"æ˜¯çš„\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550043560,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":60568,"user_name":"fdconan","can_delete":false,"product_type":"c1","uid":1244596,"ip_address":"","ucode":"01C71C6E9FD1E4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLv9HJIW4OACkjlwOQJ9cU7HzvaDFYkACWCib2lzOMef9ZiaGDTVFqjPicpVK5KDRbBRVGGHrMHQO1Rw/132","comment_is_top":false,"comment_ctime":1547514050,"is_pvip":false,"replies":[{"id":"21572","content":"çœ‹è¯­å¥æ€ä¹ˆå†™ï¼Œå¦‚æœæ˜¯ where city=&#39;X&#39; order by name desc, é‚£å°±å»º(city, name)çš„è”åˆç´¢å¼•","user_name":"ä½œè€…å›å¤","comment_id":60568,"uid":"1264162","ip_address":"","utype":1,"ctime":1547518188,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"5842481346","product_id":100020801,"comment_content":"è€å¸ˆï¼Œè¯·æ•™ä¸‹ï¼Œå¦‚æœå¸Œæœ›é€šè¿‡cityæ‰¾å‡ºè®°å½•åï¼ŒæŒ‰ç…§nameå€’åº(order by name desc)è€Œåˆä¸æƒ³mysqlè¿›è¡Œæ’åº(æ‰§è¡Œè®¡åˆ’æ²¡æœ‰filesortå…³é”®å­—)ï¼Œåº”è¯¥å¦‚ä½•è®¾è®¡ç´¢å¼•å‘¢ï¼Ÿæœ‰ä»€ä¹ˆå¥½çš„å»ºè®®ä¹ˆï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436544,"discussion_content":"çœ‹è¯­å¥æ€ä¹ˆå†™ï¼Œå¦‚æœæ˜¯ where city=&amp;#39;X&amp;#39; order by name desc, é‚£å°±å»º(city, name)çš„è”åˆç´¢å¼•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547518188,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58929,"user_name":"sam3125C","can_delete":false,"product_type":"c1","uid":1193708,"ip_address":"","ucode":"D725AEF2A1F47C","user_header":"https://static001.geekbang.org/account/avatar/00/12/36/ec/ca162d6b.jpg","comment_is_top":false,"comment_ctime":1547256843,"is_pvip":false,"replies":[{"id":"21344","content":"åŸæ„æ˜¯è¦å®½çš„è¡¨ç¤ºæ•°æ®é¡¹ï¼Œçª„çš„è¡¨ç¤ºæŒ‡é’ˆ<br>æˆ‘ä»¬ä¿®æ”¹ä¸‹å›¾å“ˆï¼Œä¸å®¹æ˜“å¼•èµ·ç–‘é—®ã€‚<br>ğŸ‘ç»†è‡´","user_name":"ä½œè€…å›å¤","comment_id":58929,"uid":"1264162","ip_address":"","utype":1,"ctime":1547268801,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"5842224139","product_id":100020801,"comment_content":"ç±»å¦‚å›¾äºŒçš„ç´¢å¼•å›¾ï¼Œæˆ‘ä¸€ç›´æœ‰ä¸€ä¸ªå›°æƒ‘ã€‚cityçš„ç´¢å¼•å›¾ä¸Šï¼Œæœ‰å°ä¸€äº›çš„é•¿æ–¹å½¢å’Œå¤§ä¸€äº›çš„é•¿æ–¹å½¢ã€‚æœ‰æ—¶å€™ç®­å¤´æºè‡ªäºå°é•¿æ–¹å½¢ï¼Œæœ‰äº›ç®­å¤´åˆæºè‡ªäºå¤§é•¿æ–¹å½¢ã€‚è¿™ç©¶ç«Ÿæ˜¯ä»€ä¹ˆå«ä¹‰ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436252,"discussion_content":"åŸæ„æ˜¯è¦å®½çš„è¡¨ç¤ºæ•°æ®é¡¹ï¼Œçª„çš„è¡¨ç¤ºæŒ‡é’ˆ\næˆ‘ä»¬ä¿®æ”¹ä¸‹å›¾å“ˆï¼Œä¸å®¹æ˜“å¼•èµ·ç–‘é—®ã€‚\nğŸ‘ç»†è‡´","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547268801,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52161,"user_name":"Sinyo","can_delete":false,"product_type":"c1","uid":1307297,"ip_address":"","ucode":"57B243E7AB86A5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJAibnPX9jW8kqLcIfibjic8GbkQkEUYyFKJkc39hZhibVlNrqwTjdLozkqibI2IwACd5YzofYickNxFnZg/132","comment_is_top":false,"comment_ctime":1545321697,"is_pvip":false,"replies":[{"id":"19010","content":"ç¬¬äºŒä¸ªselectæ˜¯æ™®é€šæŸ¥è¯¢ï¼Œèµ°çš„è¿˜æ˜¯å¿«ç…§è¯»å‘€","user_name":"ä½œè€…å›å¤","comment_id":52161,"uid":"1264162","ip_address":"","utype":1,"ctime":1545362288,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"5840288993","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå›¾ 13 å¯è§æ€§éªŒè¯æ–¹å¼ï¼Œç¬¬äºŒä¸ªselectä¸åº”è¯¥æ˜¯â€œå½“å‰è¯»â€ä¹ˆï¼Ÿæ›´æ–°æ•°æ®ä¸æ˜¯å…ˆè¯»åå†™ä¹ˆï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433766,"discussion_content":"ç¬¬äºŒä¸ªselectæ˜¯æ™®é€šæŸ¥è¯¢ï¼Œèµ°çš„è¿˜æ˜¯å¿«ç…§è¯»å‘€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545362288,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52077,"user_name":"æµæµªåœ¨å¯‚å¯å¤åŸ","can_delete":false,"product_type":"c1","uid":1105678,"ip_address":"","ucode":"FE90DCD5DC3A20","user_header":"https://static001.geekbang.org/account/avatar/00/10/df/0e/4e2b06d5.jpg","comment_is_top":false,"comment_ctime":1545305943,"is_pvip":false,"replies":[{"id":"18917","content":"æ˜¯çš„ï¼Œéå¸¸å¯¹ã€‚<br><br>è¿™é‡Œè·Ÿæˆ‘ä»¬çš„ä¾‹å­æœ‰ç‚¹åƒï¼Œå¦‚æœä½ è¿™ä¸ªè¯­å¥ä¸­ä¸¤ä¸ªupdate_timeè¿™ä¹ˆæ¥è¿‘ï¼Œå¯ä»¥è€ƒè™‘ç”¨force_indexè¯•è¯•","user_name":"ä½œè€…å›å¤","comment_id":52077,"uid":"1264162","ip_address":"","utype":1,"ctime":1545315665,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"5840273239","product_id":100020801,"comment_content":"æ‚¨å¥½ï¼Œæœ€è¿‘çœ‹äº†ç´¢å¼•å’Œæ’åºçš„æ–‡ç« ï¼Œå­¦åˆ°å¾ˆå¤šã€‚æœ€è¿‘é‡åˆ°ä¸€ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªæ¯”è¾ƒå¤§çš„è¡¨ï¼Œä»¥ä¸‹è¯­å¥ï¼šselect ct.id, ct.title, ct.status, ct.content_type, ct.is_hot, ct.read_count, ct.share_count, ct.update_time, ct.publish_time, cxt.author_id from content as ct inner join content_ext cxt on (ct.id = cxt.id)  where update_time &gt;= &#39;2018-12-20 16:34:24&#39; and update_time &lt; &#39;2018-12-20 16:34:26&#39; and ct.id &gt; xxxx order by ct.id  limit 1;<br>åœ¨è¯­å¥ä¸­æ¶‰åŠåˆ°çš„å­—æ®µï¼Œéƒ½æœ‰ç´¢å¼•ã€‚å…¶ä¸­ct.idæ˜¯ä¸»è¡¨çš„è‡ªå¢ä¸»é”®ã€‚åœ¨è¿™ä¸ªæ—¶é—´æ®µå†…çš„æ•°æ®åªæœ‰å‡ åæ¡ã€‚<br>å¦‚æœct.id&gt;ä¸€ä¸ªæ¥è¿‘update_timeæ—¶é—´å†…çš„idï¼ŒæŸ¥è¯¢æ¯”è¾ƒå¿«ï¼Œå¦‚æœct.id&gt;0,é‚£ä¹ˆå°±æ˜¯ä¸€ä¸ªç¾éš¾ï¼Œæ ¹æœ¬æŸ¥ä¸åˆ°ç»“æœã€‚æˆ‘è‡ªå·±çŒœæµ‹ï¼Œä¹‹æ‰€ä»¥å˜äº†è¿™ä¹ˆæ…¢ï¼Œåº”è¯¥æ˜¯msyqlä¼˜åŒ–çš„æ—¶å€™é€‰æ‹©äº†å…ˆæŒ‰ç…§ä¸»é”®çš„ct.idç´¢å¼•è¿›è¡ŒæŸ¥è¯¢ï¼Œå› ä¸ºæ˜¯å¤§äº0ï¼Œæ‰€ä»¥ç›¸å½“äºä¸€ä¸ªæ‰«æå…¨è¡¨äº†ï¼Œå¯¼è‡´é€Ÿåº¦å¾ˆæ…¢ã€‚<br>è¿™æ ·ç†è§£çš„å¯¹å—ï¼Ÿè¯·æ±‚è€å¸ˆè§£ç­”","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433732,"discussion_content":"æ˜¯çš„ï¼Œéå¸¸å¯¹ã€‚\n\nè¿™é‡Œè·Ÿæˆ‘ä»¬çš„ä¾‹å­æœ‰ç‚¹åƒï¼Œå¦‚æœä½ è¿™ä¸ªè¯­å¥ä¸­ä¸¤ä¸ªupdate_timeè¿™ä¹ˆæ¥è¿‘ï¼Œå¯ä»¥è€ƒè™‘ç”¨force_indexè¯•è¯•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545315665,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51811,"user_name":"ä¸€å¤§åªğŸ˜´","can_delete":false,"product_type":"c1","uid":1310960,"ip_address":"","ucode":"92F3D2B7F63568","user_header":"https://static001.geekbang.org/account/avatar/00/14/00/f0/08409e78.jpg","comment_is_top":false,"comment_ctime":1545266184,"is_pvip":false,"replies":[{"id":"18959","content":"ç”¨åˆ°æ‰åˆ†é…","user_name":"ä½œè€…å›å¤","comment_id":51811,"uid":"1264162","ip_address":"","utype":1,"ctime":1545333001,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"5840233480","product_id":100020801,"comment_content":"è€å¸ˆè¯·æ•™ä¸‹ï¼Œsort-bufferæ˜¯çº¿ç¨‹åˆå§‹åŒ–æ—¶å€™å°±åˆ†é…è¿˜æ˜¯éœ€è¦æ’åºæ—¶æ‰åˆ†é…ï¼Ÿåˆå§‹åŒ–çº¿ç¨‹æ˜¯ä¸æ˜¯å°±æ˜¯é»˜è®¤çš„256kï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433630,"discussion_content":"ç”¨åˆ°æ‰åˆ†é…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545333001,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51722,"user_name":"å—å±±","can_delete":false,"product_type":"c1","uid":1119593,"ip_address":"","ucode":"94656FE4A6C378","user_header":"https://static001.geekbang.org/account/avatar/00/11/15/69/187b9968.jpg","comment_is_top":false,"comment_ctime":1545229376,"is_pvip":true,"replies":[{"id":"18744","content":"æ¯ä¸ªè¿æ¥æœ‰è‡ªå·±çš„å†…å­˜ç©ºé—´ï¼Œæ­£å¸¸ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªè¿æ¥ï¼Œ<br>çº¿ç¨‹æ˜¯å·¥ä½œå•ä½ï¼Œå†…å­˜éƒ½æ˜¯åœ¨è¿æ¥çš„å¯¹è±¡é‡Œé¢","user_name":"ä½œè€…å›å¤","comment_id":51722,"uid":"1264162","ip_address":"","utype":1,"ctime":1545233584,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"5840196672","product_id":100020801,"comment_content":"MySQLçš„ä¸€ä¸ªè¿æ¥æ˜¯ä¸€ä¸ªçº¿ç¨‹å—ï¼Ÿå‰é¢çœ‹åˆ°è¿‡MySQLä¸€ä¸ªè¿æ¥æ˜¯æœ‰è‡ªå·±çš„å†…å­˜ç©ºé—´çš„ï¼Œè¿™å—ä¸å¤ªç†è§£","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433598,"discussion_content":"æ¯ä¸ªè¿æ¥æœ‰è‡ªå·±çš„å†…å­˜ç©ºé—´ï¼Œæ­£å¸¸ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªè¿æ¥ï¼Œ\nçº¿ç¨‹æ˜¯å·¥ä½œå•ä½ï¼Œå†…å­˜éƒ½æ˜¯åœ¨è¿æ¥çš„å¯¹è±¡é‡Œé¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545233584,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51718,"user_name":"å—å±±","can_delete":false,"product_type":"c1","uid":1119593,"ip_address":"","ucode":"94656FE4A6C378","user_header":"https://static001.geekbang.org/account/avatar/00/11/15/69/187b9968.jpg","comment_is_top":false,"comment_ctime":1545229054,"is_pvip":true,"replies":[{"id":"18755","content":"è§£æã€æ‰§è¡Œã€æ’åºã€è¿”å›ç»“æœï¼Œéƒ½æ˜¯è¿™ä¸ªçº¿ç¨‹åšçš„","user_name":"ä½œè€…å›å¤","comment_id":51718,"uid":"1264162","ip_address":"","utype":1,"ctime":1545244917,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"5840196350","product_id":100020801,"comment_content":"è€å¸ˆï¼ŒMySQLä¼šç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ªsort_bufferç”¨äºæ’åºï¼Œé‚£ä¸€æ¡SQLçš„æ‰§è¡Œæ˜¯åªç”±ä¸€ä¸ªçº¿ç¨‹è´Ÿè´£å˜›ï¼Œè¿˜æ˜¯æ’åºç”±ä¸€ä¸ªçº¿ç¨‹è´Ÿè´£å‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433595,"discussion_content":"è§£æã€æ‰§è¡Œã€æ’åºã€è¿”å›ç»“æœï¼Œéƒ½æ˜¯è¿™ä¸ªçº¿ç¨‹åšçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545244917,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51408,"user_name":"å°æ–‡","can_delete":false,"product_type":"c1","uid":1198258,"ip_address":"","ucode":"4D6257B8D63FA4","user_header":"https://static001.geekbang.org/account/avatar/00/12/48/b2/cca85581.jpg","comment_is_top":false,"comment_ctime":1545181012,"is_pvip":false,"replies":[{"id":"18537","content":"2. è¿™æ ·å°±å¾—å…¨ç´¢å¼•æ‰«æäº†â€¦ æ€§èƒ½å¯èƒ½æ›´å·®å“¦ï¼Œä¸æ˜¯å¾ˆç†æƒ³çš„æ–¹æ³•å“ˆ","user_name":"ä½œè€…å›å¤","comment_id":51408,"uid":"1264162","ip_address":"","utype":1,"ctime":1545182783,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"5840148308","product_id":100020801,"comment_content":"1.éœ€è¦æ’åºï¼Œä»…ä»…æ˜¯æ¯ä¸ªcity_nameä¸‹nameæœ‰åº<br>2.å¯ä¸å¯ä»¥æŠŠnameè®¾ä¸ºä¸»é”®ï¼Œcity_nameè®¾ç´¢å¼•ï¼Œè¿™æ ·å°±ä¼šæœ‰åºå‘¢","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433445,"discussion_content":"2. è¿™æ ·å°±å¾—å…¨ç´¢å¼•æ‰«æäº†â€¦ æ€§èƒ½å¯èƒ½æ›´å·®å“¦ï¼Œä¸æ˜¯å¾ˆç†æƒ³çš„æ–¹æ³•å“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545182783,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355478,"user_name":"Ê˜á´—Ê˜å°ç™½å¸½Ê˜á´—Ê˜","can_delete":false,"product_type":"c1","uid":1304567,"ip_address":"ä¸Šæµ·","ucode":"3519C67C3B1533","user_header":"https://static001.geekbang.org/account/avatar/00/13/e7/f7/8427bb06.jpg","comment_is_top":false,"comment_ctime":1661414915,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1661414915","product_id":100020801,"comment_content":"å…³äºæ’åºç»“æœé—®é¢˜ï¼Œæœ‰ä¸€ç‚¹ç‚¹å°ç–‘é—®ï¼Œè¯·æ•™ä¸‹æ‚¨ï¼š<br><br>select address from t_user group by address asc; <br><br>æ’åºç»“æœæ˜¯ï¼š<br>å¹³åˆ©è·¯21å¼„10å·<br>å¹³åˆ©è·¯21å¼„1å·<br>å¹³åˆ©è·¯21å¼„2å·<br><br><br>select address from t_user group by CONVERT(address,SIGNED);<br><br>æ’åºç»“æœæ˜¯ï¼š<br>å¹³åˆ©è·¯21å¼„1å·<br>å¹³åˆ©è·¯21å¼„2å·<br>å¹³åˆ©è·¯21å¼„10å·<br><br><br>æ²¡ç†è§£è¿™ä¸ªæ˜¯ä»€ä¹ˆé“ç†<br><br><br>","like_count":0},{"had_liked":false,"id":353836,"user_name":"èµ·é£äº†","can_delete":false,"product_type":"c1","uid":1110574,"ip_address":"æµ™æ±Ÿ","ucode":"DEA3B47B7F3C3F","user_header":"https://static001.geekbang.org/account/avatar/00/10/f2/2e/cb647708.jpg","comment_is_top":false,"comment_ctime":1659855937,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1659855937","product_id":100020801,"comment_content":"è€å¸ˆ åˆå§‹åŒ– sort_bufferï¼Œç¡®å®šæ”¾å…¥ nameã€cityã€age è¿™ä¸‰ä¸ªå­—æ®µï¼› ç¬¬ä¸€ä¸ªæ­¥éª¤æ€ä¹ˆç†è§£","like_count":0},{"had_liked":false,"id":353635,"user_name":"SystemCaller","can_delete":false,"product_type":"c1","uid":3002347,"ip_address":"ä¸Šæµ·","ucode":"CECF6068EE3769","user_header":"","comment_is_top":false,"comment_ctime":1659623829,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1659623829","product_id":100020801,"comment_content":" å›¾ 14çš„ç†è§£: <br>sessionAä¹Ÿè§¦å‘äº†å½“å‰è¯», ä½†æ˜¯æ›´æ–°æ¡ä»¶å’Œæ›´æ–°å€¼ä¸€æ ·, ä¸éœ€è¦æ›´æ–°. è€Œä¸Šå›¾13ä¸­çš„æ›´æ–°æ¡ä»¶å’Œæ›´æ–°å€¼ä¸ä¸€æ ·,æ‰€ä»¥è¦è¿›è¡Œæ›´æ–°. å³ä½¿å½“å‰è¯»çš„ç»“æœå’Œæ›´æ–°å€¼ä¸€æ ·.  <br>ç”±äºäº‹åŠ¡Aæ²¡æœ‰è¿›è¡Œæ›´æ–°, åªå‘ç”Ÿäº†å½“å‰è¯» . æ‰€ä»¥è¿˜æ˜¯ä¸€è‡´æ€§è§†å›¾,ç»“æœè¿˜æ˜¯a=2<br><br>æˆ‘æœ‰ä¸€ä¸ªé—®é¢˜: å‡è®¾ï¼Œå½“å‰è¡¨ t é‡Œçš„å€¼æ˜¯ (1,2)ï¼Œ(2,3)ã€‚ä¸‹é¢çš„æ‰§è¡Œæ—¶åºå›¾ã€‚<br><br>           session A                                                                       session B<br>T1             begin<br>T2     select * from t where id=1<br>T3                                                                               uptate set a=3 where id =1 <br>T4      uptate set a=3 where id =2 <br>T5      select * from t where id=1<br><br>é—®é¢˜ï¼š <br>Q1ï¼š sessionAä¸­æ›´æ–°äº†id=2çš„æ•°æ®ï¼Œè§¦å‘äº†å½“å‰è¯»ï¼Œé‚£ä¹ˆid=1çš„æ•°æ®ä¼šæ”¶åˆ°å½±å“ä¹Ÿå˜ä¸ºsessionBä¸­æœ€æ–°å€¼çš„3ä¹ˆï¼Ÿ <br>Q2ï¼š æ›´æ–°è¯­å¥ä¸€å®šä¼šå…ˆè§¦å‘å½“å‰è¯»å—<br>Q3ï¼š è§¦å‘äº†å½“å‰è¯»ï¼Œä½†æ˜¯ä¸ä¸€å®šæ‰§è¡Œæ›´æ–°ï¼ˆå›¾13é‚£ç§æƒ…å†µï¼‰ï¼Œä¸æ‰§è¡Œæ›´æ–°æ‰€ä»¥å½“å‰è¯»å¯¹å½“å‰äº‹åŠ¡æ— æ•ˆï¼Œä»ç„¶æ˜¯äº‹åŠ¡åˆ›å»ºå¼€å§‹çš„æ—¶çš„å€¼æ˜¯å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":352927,"user_name":"allen","can_delete":false,"product_type":"c1","uid":1157861,"ip_address":"é™•è¥¿","ucode":"00BFF6D6FB6974","user_header":"https://static001.geekbang.org/account/avatar/00/11/aa/e5/60a405a6.jpg","comment_is_top":false,"comment_ctime":1659017423,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1659017423","product_id":100020801,"comment_content":"MySQL order by å­—æ®µï¼Œç»“åˆlimitä½¿ç”¨ï¼Œå½“æ’åºå­—æ®µå¤šä¸ªç›¸åŒå€¼çš„æ—¶å€™ï¼Œæ’åºåˆ†é¡µä¼šå‡ºç°é‡å¤æ•°æ®ï¼ŒMySQLåœ¨è¿™å—æ²¡æœ‰åšä¼˜åŒ–å—","like_count":0},{"had_liked":false,"id":351222,"user_name":"LF","can_delete":false,"product_type":"c1","uid":1275909,"ip_address":"","ucode":"9DE3EC98CAD590","user_header":"https://static001.geekbang.org/account/avatar/00/13/78/05/7bdba0ad.jpg","comment_is_top":false,"comment_ctime":1657617539,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1657617539","product_id":100020801,"comment_content":"&quot;å¦‚æœ MySQL å®åœ¨æ˜¯æ‹…å¿ƒæ’åºå†…å­˜å¤ªå°ï¼Œä¼šå½±å“æ’åºæ•ˆç‡ï¼Œæ‰ä¼šé‡‡ç”¨ rowid æ’åºç®—æ³•ï¼Œè¿™æ ·æ’åºè¿‡ç¨‹ä¸­ä¸€æ¬¡å¯ä»¥æ’åºæ›´å¤šè¡Œï¼Œä½†æ˜¯éœ€è¦å†å›åˆ°åŸè¡¨å»å–æ•°æ®&quot;<br>è€å¸ˆæ‚¨å¥½ï¼Œå¯¹ rowid æ’åºæœ‰ä¸€ä¸ªå°å°çš„ç–‘é—®ã€‚å°±æ˜¯æ ¹æ®äºŒçº§ç´¢å¼•æ‹¿åˆ°ä¸»é”®idåï¼Œå›è¡¨æŸ¥è¯¢æ•°æ®ï¼Œæ­¤æ—¶å·²ç»æŠŠæ•°æ®é¡µåŠ è½½åˆ°å†…å­˜ä¸­äº†å§ï¼Ÿè¿™æ ·æ’å®Œåºä¹‹åç¬¬äºŒæ¬¡æ ¹æ®ä¸»é”®idå›è¡¨ï¼Œæ˜¯å¦ä¸éœ€è¦å†æ¬¡è®¿é—®ç£ç›˜äº†ï¼Œå› ä¸ºæ•°æ®å·²ç»å·²ç»åœ¨å†…å­˜ä¸­äº†ï¼Ÿå¸Œæœ›è€å¸ˆè§£æƒ‘ï¼Œæ„Ÿè°¢ï½","like_count":0},{"had_liked":false,"id":345518,"user_name":"whyly","can_delete":false,"product_type":"c1","uid":1798882,"ip_address":"","ucode":"D34D6B7164C982","user_header":"https://static001.geekbang.org/account/avatar/00/1b/72/e2/95b0543c.jpg","comment_is_top":false,"comment_ctime":1652346564,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1652346564","product_id":100020801,"comment_content":"ç´¢å¼•æ˜¯å¦æ˜¯æŒ‰ç…§æ­£åºå­˜å‚¨çš„ï¼Œå¦‚æœæˆ‘æƒ³æŒ‰ç…§nameå€’åºæŸ¥è¯¢ï¼Œå¦‚ select city, name, age from T where city = &#39;æ­å·&#39; order by name desc limit 100; è¿™ç§æƒ…å†µæ˜¯ä¸æ˜¯è¿˜å¾—è¿›è¡Œæ’åºæ“ä½œåæ‰èƒ½è¿”å›å®¢æˆ·ç«¯å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":343096,"user_name":"æœåŠ¡ç«¯ç»„1","can_delete":false,"product_type":"c1","uid":2107930,"ip_address":"","ucode":"F432FCF470F69D","user_header":"","comment_is_top":false,"comment_ctime":1650625042,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1650625042","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼Œä¹¦ä¸Šè¯´innodbé¡µå†…æ•°æ®è¡Œä¸è¡Œä¹‹é—´æ˜¯å•å‘é“¾è¡¨ï¼Œæƒ³è¯·é—®ä¸‹é™åºæ“ä½œæ˜¯æ€ä¹ˆå®ç°çš„","like_count":0},{"had_liked":false,"id":342051,"user_name":"ç™½ä¸åƒ","can_delete":false,"product_type":"c1","uid":1033578,"ip_address":"","ucode":"F019914D8819C2","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c5/6a/7f858f1f.jpg","comment_is_top":false,"comment_ctime":1649992198,"is_pvip":true,"discussion_count":0,"race_medal":4,"score":"1649992198","product_id":100020801,"comment_content":"MySQL 8.0.25 ç‰ˆæœ¬æŸ¥è¯¢æ’åºæŠ¥é”™äº†ï¼ŒOut of sort memoryï¼Œåœ¨æŸ¥è¯¢ç¼“å­˜ä¸å¤Ÿçš„æ—¶å€™ï¼Œä¸ºå•¥å¹¶æ²¡æœ‰åˆ©ç”¨å…¶ä»–æ‰‹æ®µè¿›è¡Œæ’åºï¼Œè€Œç›´æ¥æŠ›å‡ºäº†é”™è¯¯ï¼Ÿ","like_count":0},{"had_liked":false,"id":340962,"user_name":"æé‡‘é¹","can_delete":false,"product_type":"c1","uid":1445362,"ip_address":"","ucode":"8FCCA5B8BD8DDD","user_header":"https://static001.geekbang.org/account/avatar/00/16/0d/f2/3865fe28.jpg","comment_is_top":false,"comment_ctime":1649247449,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1649247449","product_id":100020801,"comment_content":"ä¼šæœ‰æ’åºè¿‡ç¨‹","like_count":0},{"had_liked":false,"id":340546,"user_name":"å“²å­å…„","can_delete":false,"product_type":"c1","uid":1348819,"ip_address":"","ucode":"6D6B6FE1ED2583","user_header":"https://static001.geekbang.org/account/avatar/00/14/94/d3/1861fa96.jpg","comment_is_top":false,"comment_ctime":1648893442,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1648893442","product_id":100020801,"comment_content":"<br>1ã€æ’åºé—®é¢˜ï¼š<br>mysql&gt; select * from t where city in (&#39;æ­å·&#39;,&quot;è‹å·&quot;) order by name limit 100;<br>æ‰§è¡Œçš„æ—¶å€™ä¼šæœ‰æ’åºï¼Œå› ä¸º city_name(city, name) è¿™ä¸ªè”åˆç´¢å¼•å…ˆæŒ‰cityæ’åºï¼Œå†æŒ‰nameæ’åºï¼Œè¦å–å‰100æ¡ï¼Œéœ€è¦æŠŠæ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ•°æ®è¿›è¡Œæ’åºï¼Œå¯ä»¥æŠŠç´¢å¼•æ”¹æˆname_city(name,city) ,ä½†æ˜¯extra å˜æˆ using whereäº†ï¼Œä¸ç¡®å®šå“ªç§æ•ˆç‡æ›´é«˜ã€‚å¦‚æœæ˜¯ä¸šåŠ¡æ”¹é€ å¯ä»¥è‹å·ã€æ­å·åˆ†åˆ«æŸ¥100æ¡ï¼Œå†åˆå¹¶æ’åºã€‚<br>2ã€åˆ†é¡µéœ€æ±‚ï¼š<br>limit 10000,100ï¼Œä¼šæ‰«æ10000+100æ¡æ•°æ®ï¼Œå¦‚æœæ˜¯æŒ‰ç…§æ•°å€¼æ’åºçš„ï¼Œå¯ä»¥è®°å½•ä¸Šä¸€æ¬¡åç§»é‡çš„æ’åºå€¼ï¼Œå‡å°‘è¡Œæ•°çš„éå†ï¼Œå¦‚ where id &gt; 10000 order by id limit 0,100,nameä¸å¥½æ¯”è¾ƒï¼Œå¯ä»¥å¢åŠ ä¸€ä¸ªmd5_nameçš„å­—æ®µï¼Œwhere md5_name &gt; &#39;xxxxx&#39; order by md5_name limit 0,100ï¼Œä¸çŸ¥æ˜¯å¦å¯ä»¥æ»¡è¶³éœ€æ±‚","like_count":0},{"had_liked":false,"id":334373,"user_name":"Composer","can_delete":false,"product_type":"c1","uid":2474640,"ip_address":"","ucode":"70596903AFB2F7","user_header":"https://static001.geekbang.org/account/avatar/00/25/c2/90/3f24c094.jpg","comment_is_top":false,"comment_ctime":1644905309,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1644905309","product_id":100020801,"comment_content":"select * from tbl where classid = 11531 order by sort asc<br>select id from tbl where classid = 11531 order by sort asc<br>classidä¸Šæœ‰æ™®é€šç´¢å¼•ï¼Œè¿™ä¸ªclassidä¸‹sortå€¼éƒ½æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯å¾—åˆ°çš„ç»“æœé›†é¡ºåºå´ä¸ä¸€æ ·ï¼Œè¯­å¥ä¸€åœ¨sortå€¼ç›¸åŒçš„æƒ…å†µä¸‹ä¸çŸ¥é“æ˜¯æŒ‰ä»€ä¹ˆé¡ºåºæ’çš„ï¼Œè¯­å¥äºŒåœ¨sortå€¼éƒ½ç›¸åŒçš„æƒ…å†µä¸‹æ˜¯æŒ‰ä¸»é”®idä»å°åˆ°å¤§è¿™ä¸ªæ˜¯å¯¹çš„   æœ‰æ²¡æœ‰å¤§ä½¬å¸®å¿™ç»™è§£é‡Šä¸€ä¸‹è¿™ä¸ªé—®é¢˜ è°¢è°¢","like_count":0},{"had_liked":false,"id":329502,"user_name":"Shepherd","can_delete":false,"product_type":"c1","uid":2338746,"ip_address":"","ucode":"5C882BBA20C089","user_header":"https://static001.geekbang.org/account/avatar/00/23/af/ba/e2926a33.jpg","comment_is_top":false,"comment_ctime":1641376271,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1641376271","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæˆ‘å‘ç°å½“order byçš„å­—æ®µå€¼ç›¸åŒæ—¶ï¼Œæœ‰äº›æƒ…å†µä¼šæŒ‰ç…§idå‡åºè¿”å›ç»“æœï¼Œä½†æœ‰äº›æƒ…å†µæ˜¯éšæœºé¡ºåºè¿”å›ç»“æœï¼Œè¯·é—®è€å¸ˆmysqlè¿™æ—¶å€™çš„æ’åºç­–ç•¥æ˜¯æ€æ ·çš„","like_count":0},{"had_liked":false,"id":328021,"user_name":"å»ºå¼º","can_delete":false,"product_type":"c1","uid":1397126,"ip_address":"","ucode":"62B03D0E0C64EC","user_header":"https://static001.geekbang.org/account/avatar/00/15/51/86/b5fd8dd8.jpg","comment_is_top":false,"comment_ctime":1640485781,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1640485781","product_id":100020801,"comment_content":"æ€è€ƒé¢˜ï¼š<br>æˆ‘èƒ½æƒ³åˆ°çš„ä¸€ç§æ–¹æ¡ˆæ˜¯ï¼Œåœ¨Tè¡¨ä¸Šå†å»ºä¸€ä¸ªæŒ‰nameå­—æ®µçš„ç´¢å¼•ï¼Œç„¶ååœ¨è¯­å¥ä¸­å¼ºè¿«SQLç”¨è¿™ä¸ªç´¢å¼•ï¼š<br><br>create index idx_name on t(name);<br>select * from t force index(idx_name) where city in (&#39;æ­å·&#39;,&quot;è‹å·&quot;) order by name limit 100;<br><br>åšäº†ä¸€ä¸‹å®éªŒï¼Œè¿™æ ·ç¡®å®å¯ä»¥ä¸ç”¨æ’åºï¼Œä½†è¿™æ ·çš„è¯å°±æ— æ³•åˆ©ç”¨å·²æœ‰çš„ç´¢å¼•city_nameï¼Œä½†è¿™æ ·ä¼šä¸ä¼šé™ä½whereæ¡ä»¶çš„æŸ¥è¯¢æ€§èƒ½ï¼Œè¯·è€å¸ˆæŒ‡æ•™ã€‚","like_count":0},{"had_liked":false,"id":327361,"user_name":"æˆ‘è¦æ”¾å¤§ğŸ‚","can_delete":false,"product_type":"c1","uid":1451509,"ip_address":"","ucode":"B280A95E02E7C1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/P5EIPG3R01lW2MG1HfcPUDLKajMy7BGg8rKn5dKDbdrCreIwabwJ1RqWOJMVKqAusLaf7Y0Utomibp6ibxajflvQ/132","comment_is_top":false,"comment_ctime":1640082330,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1640082330","product_id":100020801,"comment_content":"æˆ‘æœ€è¿‘é‡åˆ°ä¸€ä¸ªé—®é¢˜çš„ï¼Œå°±æ˜¯æˆ‘ä¸€ä¸ªæ’åºå­—æ®µæ˜¯æ²¡æœ‰ç´¢å¼•å¹¶ä¸”æœ‰é‡å¤å€¼ï¼Œç„¶åæˆ‘åˆ†é¡µå’Œä¸åˆ†é¡µæŸ¥è¯¢å‡ºæ¥çš„æ•°æ®é¡ºåºæ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå•Šï¼Ÿ","like_count":0},{"had_liked":false,"id":318188,"user_name":"å­¦ä¹ å­¦ä¸ªå±","can_delete":false,"product_type":"c1","uid":1049017,"ip_address":"","ucode":"DF2D61E6FB2FCE","user_header":"https://static001.geekbang.org/account/avatar/00/10/01/b9/73435279.jpg","comment_is_top":false,"comment_ctime":1635177618,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1635177618","product_id":100020801,"comment_content":"è€å¸ˆæˆ‘å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘è¡¨88æ¡è®°å½•ï¼Œage &gt; 100  åº”è¯¥æ²¡æ•°æ®çš„ ï¼Œä½†æ˜¯æ‰§è¡Œè®¡åˆ’å‡ºç°äº†ç£ç›˜æ’åº<br>ä»¥ä¸‹æ˜¯æˆ‘çš„sql <br><br>explain SELECT name , age  FROM driver_info where age &gt; 100  ORDER BY name ASC  LIMIT 1<br><br>æˆ‘è€ƒè™‘äº†ä¸€ä¸‹ç»“åˆexplainè®¡ç®—çš„ä¸€ä¸ªå‡å€¼*æ€»é¡µæ•° æ˜¯ä¸æ˜¯è¿™ä¹ˆç†è§£ï¼Œexplain æ‰§è¡Œè®¡åˆ’æ˜¯rowæ˜¯ä¸ªå¤§æ¦‚å€¼ï¼Œæ ¹æ®æ‰«æå‡ é¡µï¼Œæ¯é¡µç¬¦åˆæ¡ä»¶çš„å‡å€¼è®¡ç®—ä¸€ä¸‹æ€»å ç”¨sort_buffer æ’åºå¤§å°ï¼Œå¤§äºsort_sizeï¼Œå¦‚æœæ’åºå­—æ®µæ²¡æœ‰ç´¢å¼• å°±æ˜¯ç”¨ç£ç›˜æ’åºï¼Œæœ‰å°±æ˜¯ç”¨ç´¢å¼•æ’åºã€‚","like_count":0},{"had_liked":false,"id":317632,"user_name":"Geek_7e3067","can_delete":false,"product_type":"c1","uid":2757402,"ip_address":"","ucode":"7313D3275C8BD3","user_header":"","comment_is_top":false,"comment_ctime":1634872584,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634872584","product_id":100020801,"comment_content":"mysql&gt; select *from c;<br>+----+------+<br>| id | a    |<br>+----+------+<br>|  1 |    2 |<br>+----+------+<br>1 row in set (0.01 sec)<br><br>mysql&gt; begin ;<br>Query OK, 0 rows affected (0.00 sec)<br><br>mysql&gt; select *from c where id = 1;<br>+----+------+<br>| id | a    |<br>+----+------+<br>|  1 |    2 |<br>+----+------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; update set a = 3 where id = 1;<br>ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;set a = 3 where id = 1&#39; at line 1<br>mysql&gt; update c set a = 3 where id = 1;<br>Query OK, 0 rows affected (0.00 sec)<br>Rows matched: 1  Changed: 0  Warnings: 0<br><br>mysql&gt; select *from c where id = 1;<br>+----+------+<br>| id | a    |<br>+----+------+<br>|  1 |    2 |<br>+----+------+<br>1 row in set (0.00 sec)ï¼›<br>å’Œæ–‡ä¸­çš„ä¸ä¸€æ ·<br>","like_count":0},{"had_liked":false,"id":316539,"user_name":"Geek_43013d","can_delete":false,"product_type":"c1","uid":2025657,"ip_address":"","ucode":"43742B19B6E407","user_header":"","comment_is_top":false,"comment_ctime":1634374949,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634374949","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæˆ‘å‘ç°ï¼Œå¦‚æœä¸€ä¸ªåˆ—å…¨éƒ¨æ˜¯0ï¼Œbigdecimal ç±»å‹çš„åˆ—ï¼Œdescæ¯”ascå¿«å¾ˆå¤šï¼Œè¿™ä¸ªæ˜¯ä¸ºä»€ä¹ˆ","like_count":0},{"had_liked":false,"id":316519,"user_name":"ç›˜èƒ§","can_delete":false,"product_type":"c1","uid":1650748,"ip_address":"","ucode":"5386CC4C92ECC2","user_header":"https://static001.geekbang.org/account/avatar/00/19/30/3c/0668d6ae.jpg","comment_is_top":false,"comment_ctime":1634368597,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634368597","product_id":100020801,"comment_content":"order by åœ¨8.0 çš„ä¼˜åŒ–å®˜æ–¹æ–‡æ¡£è¯´æ˜ï¼šhttps:&#47;&#47;dev.mysql.com&#47;doc&#47;refman&#47;8.0&#47;en&#47;order-by-optimization.html","like_count":0},{"had_liked":false,"id":315825,"user_name":"æˆ’é…’çš„æç™½","can_delete":false,"product_type":"c1","uid":2166073,"ip_address":"","ucode":"744E1A22761647","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","comment_is_top":false,"comment_ctime":1634010762,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1634010762","product_id":100020801,"comment_content":"éœ€è¦æ’åºçš„sqlè¯­å¥ï¼Œ å¦‚æœselectçš„å­—æ®µéƒ½åœ¨ç´¢å¼•ä¸­ï¼Œ å°±ä¼šèµ°using indexï¼Œæ­¤æ—¶ä¸ä¼šå‡ºç°using fileindexã€‚æ˜¯ä¸æ˜¯è¯´ï¼Œ èµ°è¦†ç›–ç´¢å¼•çš„è¯­å¥ï¼Œ éƒ½ä¸éœ€è¦è¿›è¡Œæ–‡ä»¶æ’åºï¼Ÿ","like_count":0},{"had_liked":false,"id":312504,"user_name":"Geek_26794c","can_delete":false,"product_type":"c1","uid":1944561,"ip_address":"","ucode":"BBF0B71B49472F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJx6YiaEictwmdCYibD0icNpSvgLkFXtbu1I4ER9icqXMkBMibtfvTNhEm1B1fuU1e4ico3nrCO20HwyncKA/132","comment_is_top":false,"comment_ctime":1631845410,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631845410","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæˆ‘æƒ³å°±å·¥ä½œä¸­ä¸€ä¸ªç‚¹è¯´ä¸€ä¸‹ï¼Œé¦–å…ˆmysql order byæ’åºï¼Œé‡åˆ°å¤šå­—æ®µæ’åºï¼Œå‡åºé™åºéƒ½æœ‰çš„æƒ…å†µä¸‹ï¼Œä¸€å®šä¼šè¿›è¡Œæ’åºã€‚æ‰€ä»¥æˆ‘ä»¬å¸¸è§æŒ‰ç…§æ—¥æœŸæ’åºï¼ŒæŒ‰ç…§æ¶ˆè´¹é‡‘é¢æ’åºç­‰ï¼Œéƒ½ä¼šè®¾ç½®ä¸€ä¸ªå†—ä½™å­—æ®µä½œç›¸åæ•°å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå¦‚æœæ˜¯é™åºçš„ä¸ä½¿ç”¨descï¼Œè€Œæ˜¯ä½¿ç”¨ç›¸åæ•°çš„ascæ–¹å¼è¿›è¡Œæ’åºã€‚","like_count":0},{"had_liked":false,"id":311753,"user_name":"Geek_b9fe21","can_delete":false,"product_type":"c1","uid":1297516,"ip_address":"","ucode":"7B6E74577FC5DB","user_header":"https://static001.geekbang.org/account/avatar/00/13/cc/6c/740cadef.jpg","comment_is_top":false,"comment_ctime":1631443074,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1631443074","product_id":100020801,"comment_content":"æ’åºæ˜¯åœ¨å¼•æ“å±‚æ‰§è¡Œè¿˜æ˜¯serverå±‚","like_count":0,"discussions":[{"author":{"id":2120690,"avatar":"","nickname":"é£é—´","note":"","ucode":"2DA14C209AD31F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":405562,"discussion_content":"server","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634603210,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":300740,"user_name":"Geek_457f47","can_delete":false,"product_type":"c1","uid":1443589,"ip_address":"","ucode":"B9EB1B46AA4D85","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/iamkqQRZFTAQgclRqskib3n860CStDuxq2aiaZO7EicDfLJwCdZ9gZiajhBoTNuFKH47DLKO5C4GHxukN5L1VOpcR6Q/132","comment_is_top":false,"comment_ctime":1625366217,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625366217","product_id":100020801,"comment_content":"è¡¨ç»“æ„<br>CREATE TABLE `tcb_user` (<br>  `id` int NOT NULL AUTO_INCREMENT,<br>  `name` varchar(255) DEFAULT NULL,<br>  `age` int DEFAULT NULL,<br>  `version` mediumtext,<br>  PRIMARY KEY (`id`),<br>  KEY `index_name` (`name`) USING BTREE<br>) ENGINE=InnoDB AUTO_INCREMENT=10004 DEFAULT CHARSET=utf8mb3;<br><br>1.explain select * from tcb_user where name = &#39;èµµå…­&#39; order by age;<br>è¿™ä¸ªæ˜¯ç”¨åˆ°äº†æ’åº<br>id  select_type table partitions  type  possible_keys key key_len ref rows  filtered  Extra<br>1 SIMPLE  tcb_user    ref index_name  index_name  768 const 5069  100.00  Using filesort<br><br><br>2.explain select * from tcb_user where name = &#39;èµµå…­&#39; order by id; ä¸­extraæ˜¯ç©ºï¼Œæ ¹æ®ä¸»é”®æ’åºï¼Œæ˜¯æœ‰ä»€ä¹ˆç‰¹æ®Šçš„ä¼˜åŒ–å—ï¼Ÿ<br>id  select_type table partitions  type  possible_keys key key_len ref rows  filtered  Extra<br>1 SIMPLE  tcb_user    ref index_name  index_name  768 const 5069  100.00  <br><br><br><br>3.è¿˜æœ‰è€å¸ˆï¼Œæˆ‘ç›®å‰å®‰è£…çš„mysqlæ˜¯8.0.25<br>æŸ¥çœ‹æ’åºç”¨åˆ°çš„ä¸´æ—¶æ–‡ä»¶æ—¶ï¼Œæ²¡æœ‰å¯¹åº”çš„è¾“å‡ºï¼Œä¸çŸ¥é“é—®ä»€ä¹ˆï¼Œ<br>QUERY TRACE MISSING_BYTES_BEYOND_MAX_MEM_SIZE INSUFFICIENT_PRIVILEGES<br>SET PROFILING = 1 {<br>  &quot;steps&quot;: [<br>  ]<br>} 0 0<br><br><br><br>é—®é¢˜ï¼Œ<br>1æ ¹æ®ä¸»é”®æ’åºï¼Œæ‰§è¡Œè®¡åˆ’ä¸­çš„extraä¸ºä»€ä¹ˆæ˜¯ç©ºï¼Ÿ<br><br>2è€å¸ˆæŸ¥çœ‹ä¸´æ—¶æ–‡ä»¶çš„è¯­å¥æ²¡æœ‰ç”Ÿæ•ˆ<br><br><br>","like_count":0},{"had_liked":false,"id":296743,"user_name":"Y-Meta","can_delete":false,"product_type":"c1","uid":2407688,"ip_address":"","ucode":"08A4D621F1F1C0","user_header":"https://static001.geekbang.org/account/avatar/00/24/bd/08/4c0f9d3a.jpg","comment_is_top":false,"comment_ctime":1623141949,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1623141949","product_id":100020801,"comment_content":"SELECT  id,sign,report_id,drill_json,enabled,gmt_create,gmt_modified,uid_modified  FROM compute_drill_data           ORDER BY gmt_create DESC LIMIT 10; <br>å…¶ä¸­drill_jsonçš„æ•°æ®ç±»å‹ä¸ºjsonç±»å‹ï¼Œextraä¸ºUsing filesortè¯¥è¯­å¥æŠ¥é”™[HY001][1038] Out of sort memory, consider increasing server sort buffer sizeï¼›å°†ç±»å‹æ¢æˆtextæˆ–ä¸æŸ¥drill_jsonæˆ–è€…gmt_createæ·»åŠ ç´¢å¼•æ’åºéƒ½ä¸ä¼šæŠ¥é”™,<br>æƒ³è¯·é—®ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆç”¨jsonç±»å‹æ’åºå°±ä¼šæŠ¥é”™ï¼Œmysqlç‰ˆæœ¬8.0.22","like_count":0},{"had_liked":false,"id":296071,"user_name":"æ²§æµ·è‹¥ä¸ºæ°´","can_delete":false,"product_type":"c1","uid":1593208,"ip_address":"","ucode":"A86A02CEACBFB7","user_header":"https://static001.geekbang.org/account/avatar/00/18/4f/78/d6369896.jpg","comment_is_top":false,"comment_ctime":1622730421,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1622730421","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå¦‚æœorder  byçš„å­—æ®µçš„å€¼æ˜¯ç›¸åŒçš„è¯ï¼Œä¸ºä»€ä¹ˆä¼šéšæœºæ˜¾ç¤ºå‘¢","like_count":0},{"had_liked":false,"id":290204,"user_name":"yezhizi","can_delete":false,"product_type":"c1","uid":1302047,"ip_address":"","ucode":"D179ED99286897","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ9oIRvWZARRmB2hNAmSKOQddHYBJr3QXoT8ibtFicfj46PBOTOwGib6WAA3ES2HzzqqXl4ccEEwrLXw/132","comment_is_top":false,"comment_ctime":1619428661,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1619428661","product_id":100020801,"comment_content":"@æ—è€å¸ˆ   ç”¨debug æ¨¡å¼çœ‹äº†ä¸€ä¸‹  ä¸¤æ¬¡çš„update è¿˜æ˜¯æœ‰åŒºåˆ«çš„ã€‚<br>ç¬¬äºŒæ¬¡çš„update  æ²¡æœ‰ row_upd_step <br>T@2: | | | | | | | | &gt;row_upd_step<br>T@2: | | | | | | | | | &gt;row_upd<br>T@2: | | | | | | | | | | row_upd: table: wxb&#47;test<br>T@2: | | | | | | | | | | row_upd: info bits in update vector: 0x0<br>T@2: | | | | | | | | | | row_upd: foreign_id: NULL<br>T@2: | | | | | | | | | | ib_cur: update PRIMARY (41) by 6408: COMPACT RECORD(info_bits=0, 4 fields): {[8]   <br>     (0x0000000000000004),[6]      (0x000000000504),[7]    $  (0x04000000040100),[17]12345678900000001(0x010<br>2030405060708090000000000000001)}<br>T@2: | | | | | | | | | | &gt;btr_cur_search_to_nth_level<br>T@2: | | | | | | | | | | &lt;btr_cur_search_to_nth_level 1963<br>T@2: | | | | | | | | | | ib_cur: update PRIMARY (41) by 6408: COMPACT RECORD(info_bits=0, 4 fields): {[8]   <br>     (0x0000000000000004),[6]      (0x000000000504),[7]    $  (0x04000000040100),[17]12345678900000001(0x010<br>2030405060708090000000000000001)}<br>T@2: | | | | | | | | | &lt;row_upd 3069<br>T@2: | | | | | | | | &lt;row_upd_step 3223<br>","like_count":0},{"had_liked":false,"id":289838,"user_name":"KK","can_delete":false,"product_type":"c1","uid":1096397,"ip_address":"","ucode":"14C0858C413E00","user_header":"https://static001.geekbang.org/account/avatar/00/10/ba/cd/1f91aa44.jpg","comment_is_top":false,"comment_ctime":1619222951,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1619222951","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼Œé—®é¢˜ï¼šæ–‡ä¸­è¡¨tï¼Œè¿½åŠ 30ä¸ªå­—æ®µï¼Œ<br>select æ—¶ï¼Œorderby å¤šåŠ è¿™30å­—æ®µï¼Œé€ æˆè¶…è¿‡max_length_for_sort_dataçš„å€¼ã€‚æŸ¥è¯¢è¯­å¥æµç¨‹å°±æ˜¯æ€æ ·ï¼Ÿ","like_count":0},{"had_liked":false,"id":287067,"user_name":"chengcl","can_delete":false,"product_type":"c1","uid":1703199,"ip_address":"","ucode":"741C3DA1358FEA","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/zd9lKwHQVM59F9UJLYkicichbpYsUAl5yH1IiaW6LHLX0SscYcHUxib0qFDNrQghbvxACk0bErHDVFECYMUEOr9icIw/132","comment_is_top":false,"comment_ctime":1617764966,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617764966","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½<br>å…³äºä¸Šä¸€ç« çš„è¯¾åé—®é¢˜è§£ç­”ä¸­ï¼Œ ä½ æåˆ°äº† â€œå¦‚æœæ˜¯ binlog_format=row å¹¶ä¸” binlog_row_image=FULL çš„æ—¶å€™ï¼Œç”±äº MySQL éœ€è¦åœ¨ binlog é‡Œé¢è®°å½•æ‰€æœ‰çš„å­—æ®µï¼Œæ‰€ä»¥åœ¨è¯»æ•°æ®çš„æ—¶å€™å°±ä¼šæŠŠæ‰€æœ‰æ•°æ®éƒ½è¯»å‡ºæ¥äº†ã€‚â€ <br>å‰é¢ä½ å°†change bufferçš„æ—¶å€™è¯´çš„æ˜¯æ•°æ®é¡µä¸åœ¨å†…å­˜ä¸­çš„æ—¶å€™ change bufferæœºåˆ¶ä¼šä»‹å…¥ï¼Œé‚£å¦‚æœbinlog æ¨¡å¼è®¾ç½®ä¸ºrowçš„æ—¶å€™ï¼Œæ¯æ¬¡æ›´æ–°çš„æ—¶å€™æ˜¯ä¸æ˜¯éƒ½ä¼šå°†éœ€è¦æ›´æ–°çš„æ•°æ®é¡µè¯»åˆ°å†…å­˜ä¸­ï¼Œè¿™ä¸ªæ—¶å€™ change buffer æ˜¯ä¸æ˜¯å¤±æ•ˆäº†å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":286384,"user_name":"Geek_55e386","can_delete":false,"product_type":"c1","uid":1795793,"ip_address":"","ucode":"5A727F1323C2D0","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/zxkns28cIAUZIt3WjDb8G26qiccT84d9GMr9ZpbYR60TU1ibqSj9NoYVHlJvGF1kOltkqNDmEfJCqPuYVkue3WHg/132","comment_is_top":false,"comment_ctime":1617275842,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617275842","product_id":100020801,"comment_content":"è€å¸ˆ,æˆ‘æƒ³çŸ¥é“ é€’å‡æ’åºæ€ä¹ˆåŠå‘¢","like_count":0},{"had_liked":false,"id":285017,"user_name":"é¾™æ™“","can_delete":false,"product_type":"c1","uid":1043325,"ip_address":"","ucode":"FAF34F1C65D103","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/c9xpiakQ3OC1AlfCeW03lLnnb7mj5v35Hib8YDs66zpnVib2n2qFichFmFp2Ec4QDPR0dKh38MkBBLyD3bE4NiaanZQ/132","comment_is_top":false,"comment_ctime":1616580012,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616580012","product_id":100020801,"comment_content":"è€å¸ˆåœ¨æ­¤ç¯‡ä¸­å¿½ç•¥äº†ç£ç›˜è¾…åŠ©æ’åºçš„è¯¦ç»†è¿‡ç¨‹ï¼Œåé¢åœ¨ç†è§£group byã€unionçš„ç« èŠ‚å­˜åœ¨è¾ƒå¤§å›°éš¾ï¼Œä¸çŸ¥é“è€å¸ˆæ˜¯å¦å¯ä»¥è¡¥å……æˆ–ç»™ä¸ä¸€äº›ç›¸å…³èµ„æ–™ï¼Œè°¢è°¢ï¼","like_count":0},{"had_liked":false,"id":280056,"user_name":"ä¸Šæ‰å¤é¦™","can_delete":false,"product_type":"c1","uid":1521568,"ip_address":"","ucode":"9FDDE0979BCC8C","user_header":"https://static001.geekbang.org/account/avatar/00/17/37/a0/032d0828.jpg","comment_is_top":false,"comment_ctime":1614067577,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1614067577","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå…³äºä¸Šä¸€æœŸçš„é—®é¢˜ï¼Œæˆ‘è¿›è¡Œè¯•éªŒä¹‹åï¼ˆå°±æ˜¯å›¾13çš„è¯•éªŒï¼‰ï¼Œå‘ç°æ™®é€šçš„selectè¯­å¥è¿”å›çš„ä¸ºï¼ˆ1ï¼Œ2ï¼‰ã€‚æˆ‘çš„ç†è§£ï¼ŒInnoDBå­˜å‚¨å¼•æ“å±‚ç¡®å®ä¼šåˆ¤æ–­æ›´æ–°æ˜¯å¦å’ŒåŸæ¥ä¸€æ ·ï¼Œå¦‚æœä¸€æ ·ï¼Œåˆ™ä¸è¿›è¡Œæ›´æ–°ã€‚æ‰€ä»¥sessionAçš„updateæ²¡æœ‰æ›´æ–°ï¼Œä¹Ÿå°±æ˜¯è¯´id=1çš„è®°å½•çš„trx_idæ²¡æœ‰æ›´æ–°ï¼ŒsessionAçš„æ™®é€šçš„selecté‡‡ç”¨MVCCï¼Œè¿”å›ï¼ˆ1ï¼Œ2ï¼‰ï¼Œå¦‚æœä¸ºselect ... for updateè¿”å›çš„ä¸ºï¼ˆ1ï¼Œ3ï¼‰è¿™ä¸ªæ˜¯å½“å‰è¯»æ²¡æœ‰é—®é¢˜ã€‚<br><br>å›¾14çš„è¯•éªŒï¼ŒsessionAçš„è¯•éªŒ update t set a = 3ä¸­ï¼Œupdateçš„é€»è¾‘æ˜¯å…ˆè¯»åå†™ï¼Œæ‰€ä»¥è¯»æ˜¯å½“å‰è¯»ï¼Œèƒ½å¤Ÿè¯»åˆ°sessionBçš„æ›´æ–°ï¼Œä½†æ˜¯InnoDBå‘ç°æ›´æ–°æ²¡æœ‰æ”¹å˜ï¼Œæ‰€ä»¥id=1çš„è®°å½•çš„trx_idæ²¡æœ‰æ›´æ–°ä¸ºsessionAçš„trx_idï¼Œæ‰€ä»¥æ™®é€šæŸ¥è¯¢è¿˜æ˜¯ï¼ˆ1ï¼Œ2ï¼‰<br><br>ä½†æ˜¯å¦‚æœåŒæ ·å›¾14çš„è¯•éªŒï¼Œåªä¸è¿‡å°†sessionAä¸­çš„updateè¯­å¥å˜ä¸º update t set a = 4 where id = 1 and a = 3;æ‰§è¡Œè¿™ä¸€è¯­å¥ï¼Œå‘ç°sessionAæ˜¯æ›´æ–°äº†çš„ï¼Œaå˜æˆäº†4ï¼›æ­¤æ—¶æ™®é€šselectä¼šè¯»åˆ°a=4ï¼ˆæ¯•ç«Ÿæ˜¯è‡ªå·±çš„äº‹åŠ¡ï¼Œè‡ªå·±äº‹åŠ¡åšçš„ä¿®æ”¹è‚¯å®šæ˜¯å¯è§çš„ï¼‰ã€‚","like_count":0},{"had_liked":false,"id":277078,"user_name":"zenk","can_delete":false,"product_type":"c1","uid":1013669,"ip_address":"","ucode":"B235D5EBCF49BC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/77/a5/c5ae871d.jpg","comment_is_top":false,"comment_ctime":1612254995,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1612254995","product_id":100020801,"comment_content":"select * from tableName limit 100<br><br>è¿™æ ·çš„æŸ¥è¯¢è¯­å¥,æ˜¯ä¸æ˜¯ä¸€å®šæŒ‰ç…§ä¸»é”®çš„é¡ºåºè¿”å›æ•°æ®å‘¢","like_count":0},{"had_liked":false,"id":262245,"user_name":"æ€•ä»€ä¹ˆï¼ŒæŠ±ç´§æˆ‘","can_delete":false,"product_type":"c1","uid":1318633,"ip_address":"","ucode":"CBCEA76E9EF33B","user_header":"https://static001.geekbang.org/account/avatar/00/14/1e/e9/dcc63d8f.jpg","comment_is_top":false,"comment_ctime":1605672385,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1605672385","product_id":100020801,"comment_content":"ç»“è®ºï¼šè”åˆç´¢å¼•èµ·ä¸åˆ°æ’åºä½œç”¨,ä¼šæœ‰é¢å¤–çš„æ’åºè¿‡ç¨‹;<br>åŸå› ï¼š<br>æ‰“ä¸ªæ¯”æ–¹ï¼šæœ‰sex,age(æ€§åˆ«,å¹´é¾„)ä¸¤ä¸ªå­—æ®µ,sex=1è¡¨ç¤ºç”·ç”Ÿ,sex=2è¡¨ç¤ºå¥³ç”Ÿï¼›<br>å¦‚æœå»ºç«‹(sex,age)è”åˆç´¢å¼•,å®ƒä¼šå…ˆæŒ‰ç…§sexæ’åº,ç„¶åæŒ‰ç…§ageæ’åº;<br>åˆå§‹æ•°æ®å’Œæ’åºç»“æœå¦‚ä¸‹:<br>sex,age |  è”åˆç´¢å¼•æ’åº |  ageæ’åº <br>  2,10    |       1,3             |  2,1<br>  1,9      |       1,9             |  1,3<br>  2,1      |       2,1             |  1,9 <br>  2,14    |       2,10           |  2,10<br>  1, 3     |       2,14           |  2,14<br>ä»è¿™é‡Œå¯ä»¥çœ‹å‡º,è”åˆç´¢å¼•å’Œå•ä¸ªå­—æ®µçš„æ’åºä¸ä¸€æ ·,ç´¢å¼•èµ·ä¸åˆ°æ’åºçš„ä½œç”¨;<br>å¦‚ä½•è§£å†³ï¼š<br>æ–¹æ³•ä¸€ï¼šç»™nameå­—æ®µå•ç‹¬çš„åŠ ä¸€ä¸ªç´¢å¼•;<br>æ–¹æ³•äºŒï¼šæ”¹å˜è”åˆç´¢å¼•çš„é¡ºåº,å³æŠŠcity_name(city,name)å˜æˆname_city(name,city);<br>æ‰“ä¸ªæ¯”æ–¹ï¼š<br>åˆå§‹æ•°æ®å¦‚ä¸‹:<br>è”åˆç´¢å¼•(age,sex)ä¼šå…ˆæŒ‰ç…§ageæ’åº,å†æŒ‰ç…§sexæ’åº;<br>sex,age |  è”åˆç´¢å¼•age,sexæ’åº |  ageæ’åº <br>  2,10    |       1,2                        |  2,1<br>  1,9      |       3,1                        |  1,3<br>  2,1      |       9,1                        |  1,9 <br>  2,14    |       10,2                      |  2,10<br>  1, 3     |       14,2                      |  2,14<br>é™¤äº†å­—æ®µçš„å‰åå‘ç”Ÿå˜åŒ–,è”åˆç´¢å¼•age,sexå’Œageæ’åºæ˜¯ä¸€æ¨¡ä¸€æ ·çš„;<br><br><br><br><br>","like_count":0,"discussions":[{"author":{"id":2343743,"avatar":"https://static001.geekbang.org/account/avatar/00/23/c3/3f/61d59727.jpg","nickname":"äºŒæœ¨æ—å«æ£®","note":"","ucode":"FC8BCDE689B4F8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":371390,"discussion_content":"è”åˆç´¢å¼•ä¹Ÿå¯ä»¥èµ·åˆ°æ’åºä½œç”¨å§ï¼Œæœ€ä¸è¿‡ä½¿ç”¨çš„æ—¶å€™è¦ç¬¦åˆæœ€å·¦å‰ç¼€åŸåˆ™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619753154,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":252240,"user_name":"å›¾çµæœº","can_delete":false,"product_type":"c1","uid":2034632,"ip_address":"","ucode":"EB02DB653AD591","user_header":"https://static001.geekbang.org/account/avatar/00/1f/0b/c8/15f055d3.jpg","comment_is_top":false,"comment_ctime":1602210743,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1602210743","product_id":100020801,"comment_content":"rowid æ’åºç¬¬äºŒæ¬¡å›è¡¨æŸ¥è¯¢ä¸ä¼šæŸ¥ç¼“å­˜å—ï¼Ÿæ¯•ç«Ÿç¬¬ä¸€æ¬¡åŠ è½½è¦æ’åºçš„å­—æ®µå·²ç»æŠŠè®°å½•éƒ½åŠ è½½åˆ°å†…å­˜äº†","like_count":0},{"had_liked":false,"id":250524,"user_name":"ç‰›æ°çš„æ–","can_delete":false,"product_type":"c1","uid":1337842,"ip_address":"","ucode":"A0265CCE3F4FC0","user_header":"https://static001.geekbang.org/account/avatar/00/14/69/f2/b17d73ff.jpg","comment_is_top":false,"comment_ctime":1601117108,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1601117108","product_id":100020801,"comment_content":"è®°å½•ä¸€ä¸‹ï¼Œå¦‚æœæ¡ä»¶å…è®¸ï¼ˆå°äºmax_length_for_sort_dataï¼‰ï¼Œåˆ™å…¨å­—æ®µæ’åºï¼Œå³æŠŠç¬¦åˆæ¡ä»¶çš„è¡Œè¯»åˆ°serverå±‚çš„sort_bufferä¸­ï¼ˆä¸å¤Ÿæ—¶å­˜åˆ°æ–‡ä»¶ï¼Œé€šè¿‡å½’å¹¶æ’åºï¼‰ï¼Œæ’åºï¼ˆå¿«é€Ÿæ’åºï¼‰åè¿”å›ï¼›å¦‚æœæ¡ä»¶ä¸å…è®¸ï¼Œåˆ™æ”¾å…¥æ’åºåˆ—å’Œä¸»é”®åˆ—ï¼Œæ’åºåé€šè¿‡ä¸»é”®å›è¡¨ã€‚<br><br>å½“ç„¶ï¼Œå¦‚æœæ’åºå­—æ®µæœ‰ç´¢å¼•ï¼Œåˆ™ä¸ç”¨è¿›è¡Œæ’åºï¼Œå¯ä»¥æŸ¥æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ç´¢å¼•åï¼Œéå†è·å–ä¹‹åçš„æ•°æ®ã€‚","like_count":0,"discussions":[{"author":{"id":1965699,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/fe/83/df562574.jpg","nickname":"æ…ç‹¬æ˜å¼º","note":"","ucode":"DC2F7F2C0C8F60","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":309465,"discussion_content":"æ˜¯çš„ï¼Œè¿™æ ·å°±æŠŠnameç´¢å¼•å…¨éƒ¨æ‰«æä¸€éå†å»è¿‡æ»¤city","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601296644,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":249043,"user_name":"Geek8819","can_delete":false,"product_type":"c1","uid":2028950,"ip_address":"","ucode":"521AEDAB2EED81","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f5/96/e963b41b.jpg","comment_is_top":false,"comment_ctime":1600412240,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1600412240","product_id":100020801,"comment_content":"æé—®ï¼Œå‡è®¾æŒ‰ç…§è¡¨T[è¡¨æœ‰cityç´¢å¼•]çš„æŸ¥è¯¢ select  id From where city=&#39;æ­å·&#39; order by  id desc ï¼Œè¿™ä¸ªæ—¶å€™ä¼šä¸ä¼šèµ°æ–‡ä»¶æ’åº","like_count":0,"discussions":[{"author":{"id":1970443,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIx1V1QAxC4NHaxYZGyuibBN8lcURJWc5nrnO4yic1kxnDemYV2FJGialf47kYX9qtDnZZOfe1SJeLicg/132","nickname":"lleft","note":"","ucode":"D573EB509455AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372793,"discussion_content":"è¿™ä¸ªä¸éœ€è¦æ’åºäº†ï¼Œèµ°è¦†ç›–ç´¢å¼•äº†ï¼Œå¤©ç„¶æœ‰åºçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620464305,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1788647,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/4a/e7/6c16af5d.jpg","nickname":"æ±‰æ±Ÿ","note":"","ucode":"01622D984B8F9B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":343251,"discussion_content":"è¿™ä¸ªè¦çœ‹æ‰©å±•ç´¢å¼•æœ‰æ²¡æœ‰æ‰“å¼€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610973749,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":245386,"user_name":"å¿ƒæ— æ­¢å¢ƒ","can_delete":false,"product_type":"c1","uid":1196962,"ip_address":"","ucode":"713ACD50EAABE0","user_header":"https://static001.geekbang.org/account/avatar/00/12/43/a2/551bc2de.jpg","comment_is_top":false,"comment_ctime":1598929179,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598929179","product_id":100020801,"comment_content":"è€å¸ˆåŠå„ä½åŒä»ï¼Œä½ ä»¬å¥½ï¼Œè¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœè¦å®ç°è¿™æ ·çš„éœ€æ±‚ï¼Œè¿”å›æ­å·å¸‚çš„å‰1000å¹´ç”¨æˆ·(æŒ‰åå­—è‡ªå¢)ï¼Œæ›´å¥½ç¬¬1000åç”¨æˆ·å’Œ1001åç”¨æˆ·çš„nameç›¸åŒï¼Œè¿™æ—¶å€™è¦æ±‚ç¬¬1000åº”è¿”å›å¹´é¾„å°çš„ã€‚å…¶å®å°±æ˜¯nameç›¸åŒæ—¶æŒ‰ç…§ageæ’åºï¼Œè„šæœ¬æ˜¯ select city,name,age from t where city = &#39;æ­å·&#39; order by name desc,age  limit 0 , 20ã€‚<br>å¯¹è¡¨ç´¢å¼•è¿›è¡Œäº†è°ƒæ•´ï¼Œç”±cityå’Œnameçš„è”åˆç´¢å¼•è°ƒæ•´ä¸ºäº†cityã€nameã€ageä¸‰ä¸ªå­—æ®µçš„è”åˆç´¢å¼•ã€‚<br>å†explainäº†è„šæœ¬ï¼Œå‘ç°Extraé‡Œé¢æ˜¯Using where; Using index; Using filesortã€‚<br><br>æ˜¯ä¸æ˜¯ä¸¤ä¸ªå­—æ®µçš„æ’åºå°±ä¸æ”¯æŒæ ¹æ®è”åˆç´¢å¼•è·å¾—æœ‰åºçš„æ•°æ®ï¼Ÿ<br><br>æœ‰æ²¡æœ‰å…¶ä»–æ–¹å¼èƒ½æ›´é«˜æ•ˆçš„å®ç°ä¸¤å­—æ®µæ’åºï¼Ÿ","like_count":0},{"had_liked":false,"id":243961,"user_name":"è€ƒæ‹‰å‡ºå±±","can_delete":false,"product_type":"c1","uid":1303954,"ip_address":"","ucode":"917E35FD7B2D06","user_header":"https://wx.qlogo.cn/mmopen/vi_32/1mOvT5fApeicXppMP3zADG6XIPicNt5D9dL6y46SF5UUcH0hicG21LM6xSgHJj5oAdzCyeGtLZYHYmlvaFwecrGOA/132","comment_is_top":false,"comment_ctime":1598341197,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598341197","product_id":100020801,"comment_content":"ç¬¬ä¸€ä¸ªé€‰é¡¹æ˜¯ï¼ŒMySQL è¯»å‡ºæ•°æ®ï¼Œå‘ç°å€¼ä¸åŸæ¥ç›¸åŒï¼Œä¸æ›´æ–°ï¼Œç›´æ¥è¿”å›ï¼Œæ‰§è¡Œç»“æŸã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªé”å®éªŒæ¥ç¡®è®¤ã€‚<br>ä¸ªäººç†è§£ä½œè€…éƒ½æ„æ€æ˜¯ï¼š<br><br>session A  ä¸ session B æ›´æ–°çš„å€¼éƒ½ä¸ æ•°æ®åº“ç›¸åŒ  a = 2 ï¼Œå¦‚æœsession B æ˜¯å…ˆè¯»å–ï¼Œå‘ç°ç›¸åŒå°±ç›´æ¥è¿”å›ã€‚<br>session B å°±ä¸ä¼šåŠ é”äº†ã€‚ <br>ä½†æ˜¯ update è¿›è¡Œçš„æ˜¯å½“å‰è¯»ï¼Œç±»ä¼¼ select for update ,å› ä¸º session A  é˜»å¡äº† session B è¿›è¡Œäº†å½“å‰è¯»ï¼Œ<br>å› æ­¤å¹¶ä¸èƒ½è¯´æ˜Session B ä¸æ˜¯å…ˆè¯»å–åå‘ç° ç›¸åŒå°±ç›´æ¥è¿”å›","like_count":0},{"had_liked":false,"id":242758,"user_name":"è€ƒæ‹‰å‡ºå±±","can_delete":false,"product_type":"c1","uid":1303954,"ip_address":"","ucode":"917E35FD7B2D06","user_header":"https://wx.qlogo.cn/mmopen/vi_32/1mOvT5fApeicXppMP3zADG6XIPicNt5D9dL6y46SF5UUcH0hicG21LM6xSgHJj5oAdzCyeGtLZYHYmlvaFwecrGOA/132","comment_is_top":false,"comment_ctime":1597834100,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597834100","product_id":100020801,"comment_content":"ç¬¬äºŒä¸ªé€‰é¡¹ï¼Œsession A. åœ¨updateçš„æ—¶å€™å°±å‘ç”Ÿäº†ä¸€è‡´æ€§è¯»ï¼Œè™½ç„¶åé¢selectçš„æ—¶å€™è¯»åˆ°çš„æ˜¯è‡ªå·±çš„ç‰ˆæœ¬ã€‚ä½†æ˜¯updateæ—¶å€™è¯»äº†session Bçš„ã€‚è¿™ä¸ªä¾‹å­ä¸æ˜¯å¾ˆå¥½ï¼Ÿ","like_count":0},{"had_liked":false,"id":240726,"user_name":"moonfox","can_delete":false,"product_type":"c1","uid":1526355,"ip_address":"","ucode":"902BFF40EFA9FA","user_header":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","comment_is_top":false,"comment_ctime":1597045868,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597045868","product_id":100020801,"comment_content":"è¯·é—®æµ‹è¯•ç”¨çš„mysql æ•°æ®å¯ä»¥ä»å“ªé‡Œä¸‹è½½å‘€","like_count":0},{"had_liked":false,"id":239859,"user_name":"ä¹–ï¼Œæ‘¸æ‘¸å¤´","can_delete":false,"product_type":"c1","uid":1611745,"ip_address":"","ucode":"BD92741A11D3CD","user_header":"https://static001.geekbang.org/account/avatar/00/18/97/e1/0f4d90ff.jpg","comment_is_top":false,"comment_ctime":1596678712,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1596678712","product_id":100020801,"comment_content":"CREATE TABLE `test`.`Untitled`  (<br>  `id` int(11) NOT NULL AUTO_INCREMENT,<br>  `type` tinyint(4) NOT NULL,<br>  `username` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,<br>  `s` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL,<br>  `utime` int(11) NOT NULL,<br>  PRIMARY KEY (`id`) USING BTREE,<br>  INDEX `idx_type_utime`(`type`, `utime`) USING BTREE,<br>  INDEX `idx_utime_type`(`utime`, `type`) USING BTREE<br>) ENGINE = InnoDB AUTO_INCREMENT = 20002 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci ROW_FORMAT = Dynamic;<br><br>mysql&gt; explain select * from demo where type in(1,2) order by utime limit 10;<br>+----+-------------+-------+------------+-------+----------------+----------------+---------+------+------+----------+-------------+<br>| id | select_type | table | partitions | type  | possible_keys  | key            | key_len | ref  | rows | filtered | Extra       |<br>+----+-------------+-------+------------+-------+----------------+----------------+---------+------+------+----------+-------------+<br>|  1 | SIMPLE      | demo  | NULL       | index | idx_type_utime | idx_utime_type | 5       | NULL |   30 |    32.81 | Using where |<br>+----+-------------+-------+------------+-------+----------------+----------------+---------+------+------+----------+-------------+<br>1 row in set, 1 warning (0.00 sec)<br><br>æ‰€ä»¥ å»ºä¸€ä¸ªè”åˆç´¢å¼•ç´¢å¼• idx_username_city  å°±èƒ½ä½¿ç”¨ç´¢å¼•äº†","like_count":0},{"had_liked":false,"id":238238,"user_name":"å·´è¨å·´è¨ï¼ï¼ï¼","can_delete":false,"product_type":"c1","uid":1556722,"ip_address":"","ucode":"C204AD44347738","user_header":"https://static001.geekbang.org/account/avatar/00/17/c0/f2/1b2ed786.jpg","comment_is_top":false,"comment_ctime":1596099841,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596099841","product_id":100020801,"comment_content":"æ€è€ƒé¢˜å›ç­”ï¼šè‚¯å®šæœ‰ï¼Œå¦‚æœæ˜¯order by cityå°±æ²¡æœ‰æ’åºçš„è¿‡ç¨‹äº†ï¼Œè·Ÿæœ€å·¦å‰ç¼€ç´¢å¼•é“ç†ä¸€æ ·","like_count":0},{"had_liked":false,"id":232746,"user_name":"Pså¤©èŠ±ä¹±å ","can_delete":false,"product_type":"c1","uid":2038714,"ip_address":"","ucode":"E95A5A2E3B5EA6","user_header":"https://static001.geekbang.org/account/avatar/00/1f/1b/ba/1a929eaf.jpg","comment_is_top":false,"comment_ctime":1594107413,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594107413","product_id":100020801,"comment_content":"æˆ‘çš„æƒ³æ³•æ˜¯ä¼šæ’åºï¼ŒçŒœæµ‹å› ä¸ºnameæ˜¯æ— åºçš„ï¼Œlimité‚£ä¸ªæ²¡æœ‰æƒ³æ³•ã€‚ã€‚","like_count":0},{"had_liked":false,"id":228548,"user_name":"KK","can_delete":false,"product_type":"c1","uid":1324863,"ip_address":"","ucode":"FFC31A3FE3A285","user_header":"https://static001.geekbang.org/account/avatar/00/14/37/3f/a9127a73.jpg","comment_is_top":false,"comment_ctime":1592732372,"is_pvip":false,"discussion_count":2,"race_medal":1,"score":"1592732372","product_id":100020801,"comment_content":"â€œåœ¨åˆ›å»ºï¼ˆcityï¼Œnameï¼‰è”åˆç´¢å¼•ï¼Œåªè¦ city çš„å€¼æ˜¯æ­å·ï¼Œname çš„å€¼å°±ä¸€å®šæ˜¯æœ‰åºçš„â€ï¼Œè¿™æ˜¯ä»€ä¹ˆåŸå› ï¼Œæ²¡æœ‰ç†è§£ï¼Œæœ›è€å¸ˆè§£ç­”ä¸€ä¸‹","like_count":0,"discussions":[{"author":{"id":2326134,"avatar":"https://static001.geekbang.org/account/avatar/00/23/7e/76/368394bf.jpg","nickname":"å“¦","note":"","ucode":"C776659DED9D79","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337092,"discussion_content":"å»ºç«‹ç´¢å¼•çš„æ—¶å€™ï¼Œcityä¸åŒæŒ‰cityæ’åºï¼Œcityç›¸åŒåˆ™æŒ‰nameæ’åºï¼Œæ‰€ä»¥è¯´cityç›¸åŒçš„æ—¶å€™nameæ˜¯æœ‰åºçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608794569,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1324863,"avatar":"https://static001.geekbang.org/account/avatar/00/14/37/3f/a9127a73.jpg","nickname":"KK","note":"","ucode":"FFC31A3FE3A285","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":2326134,"avatar":"https://static001.geekbang.org/account/avatar/00/23/7e/76/368394bf.jpg","nickname":"å“¦","note":"","ucode":"C776659DED9D79","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337653,"discussion_content":"å™¢ æ˜ç™½å•¦ è°¢è°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609019196,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":337092,"ip_address":""},"score":337653,"extra":""}]}]},{"had_liked":false,"id":223776,"user_name":"Geek","can_delete":false,"product_type":"c1","uid":2016657,"ip_address":"","ucode":"07AD2487087D17","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/AkS4rJAdkt5icChtbYGLLP2TficUDBHYCwUDHsP8wtfPeq6YUWYyvcKbZWV5p1hQuxQNaZf0G4axI5ibqPR7ia6ZCg/132","comment_is_top":false,"comment_ctime":1591178021,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1591178021","product_id":100020801,"comment_content":"ROWIDæ’åºä¸ºå•¥city name ageé•¿åº¦æ˜¯36å•Šï¼ŒæŒ‰å­—ç¬¦æˆ–å­—èŠ‚æ¥ç®—ä¹Ÿä¸æ˜¯36å•Š","like_count":0,"discussions":[{"author":{"id":1465412,"avatar":"https://static001.geekbang.org/account/avatar/00/16/5c/44/d07c0865.jpg","nickname":"Geek_d960af","note":"","ucode":"C59AEF44BD8691","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":298302,"discussion_content":"æ„Ÿè§‰åº”è¯¥æ˜¯  ä¿©varchar(16)æ˜¯32ï¼Œä¸€ä¸ªint 4ã€‚ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597241218,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":217925,"user_name":"shiziwen","can_delete":false,"product_type":"c1","uid":1016917,"ip_address":"","ucode":"ADADC770D82D66","user_header":"https://static001.geekbang.org/account/avatar/00/0f/84/55/1e40bd61.jpg","comment_is_top":false,"comment_ctime":1589657544,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1589657544","product_id":100020801,"comment_content":"å›¾14ä¸­ï¼Œupdateå¹¶æ²¡æœ‰æ”¹å˜dbçš„åŸå› ï¼Œæ˜¯å› ä¸ºupdateè¯­å¥è‡ªèº«åˆ¤æ–­äº†setçš„æ•°æ®å’Œwhereè¯­å¥ä¸­çš„å€¼ä¸€è‡´ï¼Œæ‰€ä»¥ä¸ä¼šæ”¹å˜ï¼Œå¹¶ä¸”ä¹Ÿä¸ä¼šè¯»dbï¼Œè¿˜æ˜¯å› ä¸ºupdateçš„å½“å‰è¯»ï¼Œè¯»åˆ°äº†session Bä¸­çš„ä¿®æ”¹ï¼Œå‘ç°aå¾—å€¼å·²ç»æ˜¯3äº†ï¼Œæ ¹æœ¬ä¸éœ€è¦ä¿®æ”¹ï¼Ÿ<br>æ˜¯ä»¥ä¸Šå“ªç§æ“ä½œå‘¢ï¼Ÿ<br>","like_count":0,"discussions":[{"author":{"id":1465412,"avatar":"https://static001.geekbang.org/account/avatar/00/16/5c/44/d07c0865.jpg","nickname":"Geek_d960af","note":"","ucode":"C59AEF44BD8691","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":298555,"discussion_content":"åŒé—®ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597325023,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":215989,"user_name":"BugBean","can_delete":false,"product_type":"c1","uid":1834181,"ip_address":"","ucode":"B51232281AD9BC","user_header":"https://static001.geekbang.org/account/avatar/00/1b/fc/c5/ff8b770e.jpg","comment_is_top":false,"comment_ctime":1589163950,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589163950","product_id":100020801,"comment_content":"æ€è€ƒé¢˜ï¼š<br>éœ€è¦æ’åºï¼Œå› ä¸ºæ ¹æ®æœ€å·¦å‰ç¼€åŸåˆ™ï¼Œcity=&#39;æ­å·&#39;çš„nameæ˜¯æœ‰åºçš„ï¼Œcity=&#39;è‹å·&#39;çš„nameä¹Ÿæ˜¯æœ‰åºçš„ï¼Œä½†è¿™ä¸¤ä¸ªé›†åˆä¹‹é—´æ˜¯æ— åºçš„ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°æ’åº","like_count":0},{"had_liked":false,"id":214312,"user_name":"æ˜ŸæœŸå…«","can_delete":false,"product_type":"c1","uid":1440429,"ip_address":"","ucode":"D8C66E7F61B0D1","user_header":"https://static001.geekbang.org/account/avatar/00/15/fa/ad/3fa02ac7.jpg","comment_is_top":false,"comment_ctime":1588721724,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588721724","product_id":100020801,"comment_content":"1 å…¨å­—æ®µæ’åº<br>ä¸èµ°sort_buufferå†…å­˜æ’åºï¼Œæœ‰ç£ç›˜æ’åº<br>2 rowidæ’åº<br>é™åˆ¶è¡Œå¤§å°ï¼Œèµ°å†…å­˜æ’åº<br> å›è¡¨<br>","like_count":0},{"had_liked":false,"id":213457,"user_name":"è¾°æ˜Ÿ","can_delete":false,"product_type":"c1","uid":1037406,"ip_address":"","ucode":"C05AF875B85718","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d4/5e/b8bfa75d.jpg","comment_is_top":false,"comment_ctime":1588419502,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588419502","product_id":100020801,"comment_content":"è€å¸ˆï¼Œè¡¨æ•°æ®å¯å¦å…±äº«ä¸‹ï¼Ÿ","like_count":0},{"had_liked":false,"id":212962,"user_name":"è¾¾è¾¾é˜Ÿé•¿","can_delete":false,"product_type":"c1","uid":1117597,"ip_address":"","ucode":"1C3F2E4F6B7637","user_header":"https://static001.geekbang.org/account/avatar/00/11/0d/9d/58d09086.jpg","comment_is_top":false,"comment_ctime":1588248895,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588248895","product_id":100020801,"comment_content":"è€å¸ˆæœ‰ä¸ªé—®é¢˜ï¼šå›¾5 row id æ’åºçš„æ—¶å€™ï¼Œæœ€åè·å–1000æ¡ç”Ÿæˆç»“æœé›†ï¼Œæ˜¯server æ‰¹é‡å‘å¼•æ“å±‚è·å–1000æ¡å—","like_count":0},{"had_liked":false,"id":211633,"user_name":"ç”œå®ä»™å¥³çš„ä¸“å±é¥²å…»å‘˜","can_delete":false,"product_type":"c1","uid":1443145,"ip_address":"","ucode":"6D2039BA22551F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eozpyAUaM6ra1hqeIsd4v0fulS4zVmxDM3LQyqGo0BFM141QpQnSib6oHdQricGrRxusp5rflGn54ew/132","comment_is_top":false,"comment_ctime":1587991305,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1587991305","product_id":100020801,"comment_content":"è¿™ä¸ªserverå±‚çš„ä¼˜åŒ–å™¨ç®—æ³•æ„Ÿè§‰å¾ˆåŠå•Šï¼Œä»–å‡ ä¹èƒ½æŒ‘é€‰å‡ºæœ€ä¼˜çš„æ–¹æ³•å»æ‰§è¡Œsqlï¼Œè¿™ä¸ªç®—æ³•å¾ˆç¥å¥‡ã€‚","like_count":0},{"had_liked":false,"id":205870,"user_name":"Khirye","can_delete":false,"product_type":"c1","uid":1080985,"ip_address":"","ucode":"6C54C126FA54B8","user_header":"https://static001.geekbang.org/account/avatar/00/10/7e/99/c4302030.jpg","comment_is_top":false,"comment_ctime":1586749391,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586749391","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæœ‰ä¸ªé—®é¢˜è¯·æ•™ã€‚å†…å­˜ä¸å¤Ÿæ—¶ä¼šä½¿ç”¨å¤–éƒ¨æ–‡ä»¶è¾…åŠ©æ’åºï¼Œä¸€èˆ¬ä¼šä½¿ç”¨å½’å¹¶æ’åºç®—æ³•ï¼Ÿå½’å¹¶æ’åºç®—æ³•çš„ç©ºé—´å¤æ‚åº¦ä¸æ˜¯O(n)å—ï¼Ÿç”¨å½’å¹¶æ’åºç®—æ³•ä¸æ˜¯æ›´åŠ è€—è´¹å†…å­˜å—ï¼Ÿæœ›è§£æƒ‘ğŸ™","like_count":0},{"had_liked":false,"id":205091,"user_name":"æ–‘æ–‘é©³é©³","can_delete":false,"product_type":"c1","uid":1122057,"ip_address":"","ucode":"ADFC607C549620","user_header":"https://static001.geekbang.org/account/avatar/00/11/1f/09/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1586526303,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586526303","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå›¾13å‡ºï¼ŒsessionB è¿›è¡Œäº†æ›´æ–°ï¼›è€Œæ­¤åsessionA æ‰§è¡Œupdateæ—¶ä¸åº”è¯¥æ˜¯å½“å‰è¯»å—ï¼Œä¸ºä»€ä¹ˆè¯´sessionAçš„ç¬¬äºŒä¸ªselectçš„ç»“æœåªèƒ½æ˜¯ä»–è‡ªå·±çš„å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":204799,"user_name":"å’•å°å’š","can_delete":false,"product_type":"c1","uid":1267621,"ip_address":"","ucode":"1B6AF9766AB081","user_header":"https://static001.geekbang.org/account/avatar/00/13/57/a5/4d8f6e7d.jpg","comment_is_top":false,"comment_ctime":1586476974,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586476974","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ–‡ä¸­çš„ä¾‹å­ç”¨äº†city,nameçš„è”åˆå¯¹æ’åºæœ‰åŠ é€Ÿï¼Œå¦‚æœæˆ‘æœ‰ä¸¤ä¸ªå•ç‹¬çš„ç´¢å¼•ï¼Œä¸€ä¸ªcity,ä¸€ä¸ªnameå‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":202152,"user_name":"éª‹","can_delete":false,"product_type":"c1","uid":1241618,"ip_address":"","ucode":"6FC534BA9FCE3C","user_header":"https://static001.geekbang.org/account/avatar/00/12/f2/12/50eff143.jpg","comment_is_top":false,"comment_ctime":1585911205,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585911205","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œè¯·é—®ä¸‹max_length_for_sort_dataè®¾ç½®æˆå¤šå°‘åˆé€‚ï¼Ÿ","like_count":0},{"had_liked":false,"id":200608,"user_name":"ä¹äº‘ä»˜","can_delete":false,"product_type":"c1","uid":1310652,"ip_address":"","ucode":"26BFEE1DA3ED59","user_header":"","comment_is_top":false,"comment_ctime":1585623817,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585623817","product_id":100020801,"comment_content":"è€å¸ˆï¼Œä½ å¥½ï¼Œå…¨å­—æ®µæ’åºæ—¶çš„ç¬¬ä¸€ä¸ªæ­¥éª¤ï¼šåˆå§‹åŒ– sort_bufferï¼Œç¡®å®šæ”¾å…¥ nameã€cityã€age è¿™ä¸‰ä¸ªå­—æ®µï¼›<br><br>è¿™é‡Œæ˜¯æ€ä¹ˆç¡®å®šæ”¾å…¥ä»€ä¹ˆå­—æ®µè¿›å…¥sort_bufferçš„å‘¢ï¼Ÿ<br>å¦‚æœæŸ¥è¯¢è¯­å¥ä¸ºselect city,age from t where city=&#39;æ­å·&#39; order by name limit 1000  ;<br>æ˜¯å¦ä¹Ÿæ˜¯æ”¾å…¥nameã€cityã€age è¿™ä¸‰ä¸ªå­—æ®µåˆ°sort_bufferå‘¢ï¼Ÿ<br>æˆ‘æ˜¯å¦å¯ä»¥è¿™æ ·ç†è§£ï¼šå…¨å­—æ®µæ’åºæ—¶ï¼Œsort_bufferæ˜¯æ”¾æŸ¥è¯¢æ¡ä»¶å­—æ®µå’Œorder byæ¡ä»¶å­—æ®µ","like_count":0},{"had_liked":false,"id":196356,"user_name":"T.Y","can_delete":false,"product_type":"c1","uid":1105354,"ip_address":"","ucode":"243C96604F1CAA","user_header":"https://static001.geekbang.org/account/avatar/00/10/dd/ca/fe3f7f0e.jpg","comment_is_top":false,"comment_ctime":1585275251,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1585275251","product_id":100020801,"comment_content":"æƒ³é—®ä¸€ä¸‹è€å¸ˆï¼Œå¦‚æœæŸ¥è¯¢sqlæ˜¯ &quot;select city,name,age from t where city=&#39;æ­å·&#39; order by name desc&quot;ï¼Œå³å€’åºæ’åºï¼Œåœ¨b+æ ‘å¶å­èŠ‚ç‚¹ï¼ŒæŒ‡é’ˆéœ€è¦ä»city=&#39;æ­å·&#39;çš„åœ°æ–¹å¼€å§‹é€†å‘éå†ï¼Œå¦‚å›¾2æ‰€ç¤ºï¼Œmysqlæ˜¯å¦‚ä½•å¿«é€Ÿå®šä½åˆ°è¯¥ä½ç½®çš„ï¼Ÿ","like_count":0},{"had_liked":false,"id":196098,"user_name":"Ryan","can_delete":false,"product_type":"c1","uid":1667987,"ip_address":"","ucode":"95BBBEE5B23878","user_header":"https://static001.geekbang.org/account/avatar/00/19/73/93/0a3a1e5b.jpg","comment_is_top":false,"comment_ctime":1585235211,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585235211","product_id":100020801,"comment_content":"å¦‚æœ è¯­å¥çš„æ’åºæ˜¯æŒ‰ç…§ name asc,age desc,é‚£æ‰§è¡Œçš„æµç¨‹æ˜¯æ€æ ·çš„ï¼Ÿåœ¨å…¨å­—æ®µæ’åºæ—¶ï¼Œæ’åºæ‰§è¡Œä¸€æ¬¡ï¼ˆä¸€æ¬¡æ€§æŒ‰ç…§ name ascï¼Œage descï¼‰è¿˜æ˜¯ä¸¤æ¬¡ï¼ˆå…ˆæŒ‰ç…§name ascæ’åºå¾—åˆ°ä¸€ä¸ªç»“æœé›†ï¼Œç„¶åå†æŒ‰ç…§age desc å†æ’ä¾ç¨€ï¼‰ï¼Ÿè¿˜æœ‰rowidæ’åºæ—¶çš„æµç¨‹å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":194751,"user_name":"å–»èŒ‚","can_delete":false,"product_type":"c1","uid":1318661,"ip_address":"","ucode":"C8BD8086A17365","user_header":"https://static001.geekbang.org/account/avatar/00/14/1f/05/8a06692e.jpg","comment_is_top":false,"comment_ctime":1585103020,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1585103020","product_id":100020801,"comment_content":"MariaDB [test]&gt; select * from information_schema.optimizer_trace;<br>ERROR 1109 (42S02): Unknown table &#39;optimizer_trace&#39; in information_schema<br><br>è€å¸ˆ MariaDBä¸­æ²¡æœ‰è¿™ä¸ªè¡¨ï¼Œå¯¹åº”æ—¶å“ªä¸ªè¡¨ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1731404,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/6b/4c/a86dc27b.jpg","nickname":"å‘¨æ˜Ÿæ˜Ÿ","note":"","ucode":"131C0D981DECAB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":213807,"discussion_content":"å“¥ä»¬ï¼Œä½ è·‘mysqlä¸“æ é‡Œæ¥é—®MariaDBã€‚ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585124058,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":190743,"user_name":"æ¢ç´¢æ— æ­¢å¢ƒ","can_delete":false,"product_type":"c1","uid":1044178,"ip_address":"","ucode":"91D2A9907DFA79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ee/d2/7024431c.jpg","comment_is_top":false,"comment_ctime":1584689233,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584689233","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæœ‰ä¸ªç–‘é—®ï¼Œæ–‡ä¸­æè¿°çš„ç¬¬ä¸€æ¬¡æ’åºæ—¶ï¼Œåªæœ‰cityå»ºç«‹äº†ç´¢å¼•ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬å–å€¼city,name,ageçš„æ—¶å€™ï¼Œnameæœ¬èº«è¿˜éœ€è¦æ’åºï¼Œæ‰€ä»¥æ‰§è¡Œè®¡åˆ’çœ‹åˆ°çš„ä¹Ÿæ˜¯éœ€è¦æ’åºã€‚å½“æˆ‘ä»¬å»ºç«‹äº†city,nameä½œä¸ºè”åˆç´¢å¼•ä¹‹åï¼Œå°±ä¸éœ€è¦æ’åºäº†ï¼Ÿä½†æ­¤æ—¶è¿˜æœ‰ä¸€ä¸ªageå­—æ®µï¼Œageå­—æ®µä¸éœ€è¦æ’åºå—ï¼Ÿè¿™ä¸ªæœ‰ç‚¹ä¸ç†è§£ï¼Œæœ›æŒ‡ç‚¹ï¼","like_count":0},{"had_liked":false,"id":188637,"user_name":"Geek_ccf628","can_delete":false,"product_type":"c1","uid":1908867,"ip_address":"","ucode":"8C0D5F7B912541","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/dJPntZMwxAEZJNNdjTCoGqPrRDPjz3sgwfo5Y9rSkPQKzjW8zFgsPYL2jxQQyW1icT9oAiar4Axu9S6Rw4p3c88Q/132","comment_is_top":false,"comment_ctime":1584380006,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584380006","product_id":100020801,"comment_content":"åœ¨ä¸ŠæœŸé—®ç­”ä¸­ï¼Œæ’é™¤ç¬¬äºŒä¸ªé€‰é¡¹çš„å¯è§æ€§å®éªŒè¯´æ˜äº†ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆè¯´â€œç°åœ¨å®ƒè¿”å›çš„æ˜¯ (1,3)ï¼Œè¡¨ç¤ºå®ƒçœ‹è§äº†æŸä¸ªæ–°çš„ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬åªèƒ½æ˜¯ session A è‡ªå·±çš„ update è¯­å¥åšæ›´æ–°çš„æ—¶å€™ç”Ÿæˆâ€è¿™ä¸ªæˆ‘ä¹Ÿçœ‹æ‡‚äº†ï¼Œä½†æ˜¯ç„¶åå°±æ–­å®šæ˜¯é€‰é¡¹3äº†ï¼Œæ˜¯ä¸æ˜¯é—æ¼è¯´æ˜äº†ä»€ä¹ˆï¼Œæ²¡æƒ³æ˜ç™½ï¼Œæœ›æœ‰äººç»™ç‚¹æç¤ºè§£é‡Šä¸‹","like_count":0},{"had_liked":false,"id":186950,"user_name":"fgdgtz","can_delete":false,"product_type":"c1","uid":1240401,"ip_address":"","ucode":"486CC4ACCC015C","user_header":"","comment_is_top":false,"comment_ctime":1583978392,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583978392","product_id":100020801,"comment_content":"ä½ å¥½è€å¸ˆï¼Œæˆ‘æƒ³é—®é—®å¦‚æœæ˜¯ order by å¤šä¸ªå­—æ®µæ’åºçš„æ‰§è¡Œæµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ<br>æ¯”å¦‚ æœ‰40000è¡Œ order by a desc,b desc limit 1000 ,aå­—æ®µæœ‰ç´¢å¼•ï¼Œbå­—æ®µæ— ç´¢å¼•ï¼Œaå­—æ®µä¿å­˜çš„æ˜¯æ—¶é—´æˆ³ï¼Œæœ‰å°‘éƒ¨åˆ†æ—¶é—´æˆ³æ˜¯åŒæ ·çš„ï¼Œæ­¤æ—¶explain ä¼šæœ‰ Using filesortï¼Œè¿™æ ·æ”¾å…¥sort_buffer æ˜¯40000è¡Œ è¿˜æ˜¯ å¤§äº1000è¡Œè€Œå°äº40000è¡Œå‘¢ï¼Ÿæˆ–æ˜¯æ‰«æäº†å¤šå°‘è¡Œï¼Ÿ","like_count":0},{"had_liked":false,"id":184551,"user_name":"ä¹”ä¸¹","can_delete":false,"product_type":"c1","uid":1217413,"ip_address":"","ucode":"D832A9F97A0C7E","user_header":"https://static001.geekbang.org/account/avatar/00/12/93/85/f5d9474c.jpg","comment_is_top":false,"comment_ctime":1583335663,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583335663","product_id":100020801,"comment_content":"1. order byå®ƒæœ‰ä»¥ä¸‹å‡ ç§æ’åºï¼š1. å…¨å­—æ®µæ’åºï¼Œæ ¹æ®å†…å­˜å¤§å°æ¥å†³å®šåœ¨å†…å­˜ï¼Œè¿˜æ˜¯åœ¨æ–‡ä»¶é‡Œé¢æ’åºã€‚ 2. rowid æ’åºï¼šæ‰€åŒ…å«çš„å­—ç¬¦å¤ªé•¿ï¼Œå®ƒå°±ä¼šå…ˆåªå–å‡ºidå’Œæ’åºå­—æ®µå…ˆè¿›è¡Œæ’åºã€‚ ç„¶åå†æ ¹æ®idå»è¡¨é‡Œé¢å–æ•°æ®ï¼Œç»„æˆç»“æœï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ã€‚3. å°†è¦å–çš„å­—æ®µå’Œæ’åºå­—æ®µæ”¾å…¥ç´¢å¼•ä¸­ï¼Œç»„æˆè”åˆç´¢å¼•ï¼Œæ¥æé«˜æ€§èƒ½ã€‚","like_count":0},{"had_liked":false,"id":179956,"user_name":"æ³Š","can_delete":false,"product_type":"c1","uid":1557092,"ip_address":"","ucode":"3E9275288F1B0D","user_header":"https://static001.geekbang.org/account/avatar/00/17/c2/64/5cd6efa0.jpg","comment_is_top":false,"comment_ctime":1582126703,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582126703","product_id":100020801,"comment_content":"ä¸Šä¸€èµ·æ›´æ–°çš„é—®é¢˜ä¸ºä»€ä¹ˆåŠ é”äº†ç¬¬ä¸€ç§å’Œç¬¬äºŒç§æ–¹å¼å°±ä¸æˆç«‹äº†å•Šï¼Œä¸€æ—¶é—´æ²¡æ˜ç™½å•Šï¼Ÿ","like_count":0},{"had_liked":false,"id":177730,"user_name":"æå¿ƒå®‡ğŸ¦‰","can_delete":false,"product_type":"c1","uid":1208306,"ip_address":"","ucode":"C381CA80170D5B","user_header":"https://static001.geekbang.org/account/avatar/00/12/6f/f2/1f77b0bd.jpg","comment_is_top":false,"comment_ctime":1581483856,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581483856","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼Œè¯·æ•™ä¸¤ä¸ªé—®é¢˜<br>extraå­—æ®µï¼šusing index - ç´¢å¼•è¦†ç›–ï¼Œusing index condition - æ²¡æœ‰ç´¢å¼•è¦†ç›–ï¼Œæ˜¯å¦æ­£ç¡®ã€‚<br>å‡è®¾æœ‰è”åˆç´¢å¼• c_d<br>select * from t where c = xxx order by d desc;<br>è¿™ä¸ªsqlæ˜¯ä¸éœ€è¦filesortçš„ï¼Œä½†æ˜¯ç”±äºæ˜¯descï¼Œextraå­—æ®µæ˜¾ç¤º Backward index scanï¼Œ å¯¹äºBackward index scanå¼•æ“çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ","like_count":0},{"had_liked":false,"id":176999,"user_name":"é™ˆå¤§å¤´","can_delete":false,"product_type":"c1","uid":1335400,"ip_address":"","ucode":"F1CA8837BF1E5C","user_header":"https://static001.geekbang.org/account/avatar/00/14/60/68/626cb455.jpg","comment_is_top":false,"comment_ctime":1581245553,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1581245553","product_id":100020801,"comment_content":"æˆ‘æƒ³é—®ä¸€ä¸ªé—®é¢˜ï¼šç”¨limit1000ï¼Œ10å’Œwhere ID&gt;ä¼ ç¬¬1000è¡Œçš„ID limit 1ï¼Œ10è¿™ä¸¤ä¸ªåšæ³•æ˜¯å“ªä¸ªæ›´å¥½ä¸€äº›ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1335400,"avatar":"https://static001.geekbang.org/account/avatar/00/14/60/68/626cb455.jpg","nickname":"é™ˆå¤§å¤´","note":"","ucode":"F1CA8837BF1E5C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":197848,"discussion_content":"çœ‹æ¥è·Ÿmongoçš„æ˜¯ä¸€æ ·çš„æ„æ€ï¼Œæˆ‘æ‡‚äº†ï¼Œè°¢è°¢ä½ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583453777,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1615539,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI6LXcIqb5K48nia8d4zmdsD1M9AZeyXoGrLzX5xvqfN0fqXOsYKUWLbZvZ8TtJCXWmYbCkCXg93dQ/132","nickname":"æ¼è„šè„–","note":"","ucode":"214AE52EC201E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":195703,"discussion_content":"åè€…å¥½ï¼Œé€šè¿‡ä¸»é”®ç´¢å¼•ç›´æ¥èƒ½å®šä½åˆ°idï¼Œç„¶åç›´æ¥å–10è¡Œ\nå‰è€…å°±æ˜¯æ‰«åˆ°äº†ç¬¬1000è¡Œï¼Œå†æ‰«10è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583299984,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":172877,"user_name":"Geek_55a272","can_delete":false,"product_type":"c1","uid":1674602,"ip_address":"","ucode":"7B12A9B322B3BF","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJPHfGiaByESiaHPWbfQicjgap3unxDsxlG6JuUCNvEFJNLibNjeX4CQYNtsvXBXqTpBERUIPyiagGBXbg/132","comment_is_top":false,"comment_ctime":1579346749,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579346749","product_id":100020801,"comment_content":"1)<br>mysql&gt; select * from t where city in (&#39;æ­å·&#39;,&quot; è‹å· &quot;) order by name limit 100;<br>éœ€è¦æ’åº<br>åŸå› æ˜¯ç´¢å¼•é¡ºåºåŸå¸‚ã€åç§° ä¸ å•ç‹¬æŒ‰nameæ’åºçš„é¡ºåºä¸ä¸€è‡´ã€‚<br><br>2ï¼‰å¦‚æœä¸æƒ³mysqlæ’åº<br>æ–¹æ¡ˆa<br>å¯ä»¥æ‰§è¡Œä¸¤æ¡è¯­å¥<br>select * from t where city = &#39;æ­å·&#39; limit 100;<br>select * from t where city = &#39;è‹å·&#39; limit 100;<br>ç„¶åæŠŠ200æ¡è®°å½•åœ¨javaä¸­æ’åºã€‚<br>æ–¹æ¡ˆb<br>åˆ†åˆ«å–å‰100ï¼Œç„¶ååœ¨æ•°æ®ç«¯å¯¹200æ¡æ•°æ®è¿›è¡Œæ’åºã€‚å¯ä»¥sort bufferå°±å¯ä»¥å®Œæˆæ’åºäº†ã€‚<br>å°‘äº†ä¸€æ¬¡åº”ç”¨ç¨‹åºä¸æ•°æ®åº“çš„ç½‘ç»œäº¤äº’<br>select * from (<br>select * from t where city = &#39;æ­å·&#39; limit 100<br>union all<br>  select * from t where city = &#39;è‹å·&#39; limit 100<br>) as tt order by name limit 100<br>å…³äºåˆ†é¡µä¼˜åŒ–<br>åˆ™éœ€è¦é€šè¿‡å»¶è¿Ÿå…³è”æ¥è¾¾åˆ°å‡å°å†…å­˜æ¶ˆè€—çš„ç›®çš„<br>ä¸šåŠ¡sqlå¦‚ä¸‹<br>select t.* from t inner join<br>(<br> select id from t where city in (&#39;æ­å·&#39;,&quot; è‹å· &quot;) order by name limit 100 )<br>t1<br>on t.id = t1.id ","like_count":0},{"had_liked":false,"id":172006,"user_name":"å¤©äº®å‰è¯´æ™šå®‰","can_delete":false,"product_type":"c1","uid":1541014,"ip_address":"","ucode":"1D82EE562A7C71","user_header":"https://static001.geekbang.org/account/avatar/00/17/83/96/73ff13a0.jpg","comment_is_top":false,"comment_ctime":1579069660,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579069660","product_id":100020801,"comment_content":"æ˜¯ä¸æ˜¯å¯ä»¥ç†è§£ä¸ºè°ƒæ•´max_length_for_sort_data å’Œ sort_buffer_size å‚æ•°æ˜¯å¯ä»¥è¿›è¡Œæ’åºè°ƒä¼˜çš„ï¼Ÿå› ä¸ºå †çš„æ•°é‡å¤ªå¤šï¼Œæ’åºå°±æ…¢ï¼Œåº”è¯¥ç»´æŒå †çš„æ•°é‡å’ŒCPUæ ¸æ•°ç›¸è¿‘æ•ˆç‡æœ€é«˜ã€‚èµ°Rowidæ’åºæ¨¡å¼æ¯æ¡æ•°æ®éœ€è¦å¤šå›è¡¨ä¸€æ¬¡ã€‚","like_count":0},{"had_liked":false,"id":172000,"user_name":"å¤©äº®å‰è¯´æ™šå®‰","can_delete":false,"product_type":"c1","uid":1541014,"ip_address":"","ucode":"1D82EE562A7C71","user_header":"https://static001.geekbang.org/account/avatar/00/17/83/96/73ff13a0.jpg","comment_is_top":false,"comment_ctime":1579068565,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579068565","product_id":100020801,"comment_content":"select * from T where city = &#39;æ­å·&#39; order by name desc limit 10,10 åœ¨index(city,name)çš„æƒ…å†µä¸‹ï¼Œé¦–å…ˆä»ç´¢å¼•æ ‘ç§æŸ¥è¯¢å‡ºæ»¡è¶³æ¡ä»¶çš„id å¹¶ä¸” åˆ¤æ–­ä½ç½®æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœæ»¡è¶³ä¸¤è€…å°±æ ¹æ®idå›è¡¨æŸ¥è¯¢æ•°æ®ï¼Œè¿”å›ç»“æœé›†ã€‚ä¸çŸ¥é“ç†è§£å¯¹ä¸å¯¹ï¼Ÿ<br>æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼šwhereåé¢çš„å­—æ®µå…¨ä¸­ç´¢å¼•å°±ä¸éœ€è¦è¦æ’åºï¼Œå¦åˆ™å°±éœ€è¦æ’åºï¼›","like_count":0},{"had_liked":false,"id":171118,"user_name":"æ³¢æ³¢","can_delete":false,"product_type":"c1","uid":1530378,"ip_address":"","ucode":"B47E725A54D1E7","user_header":"https://static001.geekbang.org/account/avatar/00/17/5a/0a/8cb68aff.jpg","comment_is_top":false,"comment_ctime":1578849052,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1578849052","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæˆ‘é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œä½¿ç”¨order byçš„æ—¶å€™æ²¡æœ‰èµ°ç´¢å¼• ï¼Œå¯ä»¥å¸®æˆ‘åˆ†æä¸‹åŸå› å—ï¼Ÿ<br><br>1ã€ç´¢å¼•æ²¡æœ‰ç”Ÿæ•ˆï¼š<br>CREATE TABLE `user_info` (<br>  `user_id` int(11) NOT NULL AUTO_INCREMENT,<br>  `user_name` varchar(225) DEFAULT NULL,<br>  `user_password` varchar(225) DEFAULT NULL,<br>  `state` varchar(1) DEFAULT NULL,<br>  PRIMARY KEY (`user_id`),<br>  KEY `index_name` (`user_name`(191))<br>) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4<br><br> è¡¨æœ‰ä¸€ç™¾å¤šä¸‡æ•°æ®ã€‚åœ¨ user_name ä¸Šå»ºç«‹äº†ç´¢å¼•ã€‚<br>é—®é¢˜ï¼šé€šè¿‡æ‰§è¡Œè®¡åˆ’ explain åˆ†æ <br>SELECT user_name from user_info ORDER BY user_name LIMIT 300; æ²¡æœ‰èµ°ç´¢å¼•ã€‚<br>æ˜¾ç¤º filesort","like_count":0,"discussions":[{"author":{"id":1135593,"avatar":"https://static001.geekbang.org/account/avatar/00/11/53/e9/f244988e.jpg","nickname":"NIRVANA","note":"","ucode":"F3A979679AA44E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":292013,"discussion_content":"æ˜¯èµ°äº†å…¨è¡¨æ‰«æå—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595051403,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":165191,"user_name":"æ¨æ¾","can_delete":false,"product_type":"c1","uid":1512517,"ip_address":"","ucode":"FB3C73BC44C94D","user_header":"https://static001.geekbang.org/account/avatar/00/17/14/45/adf079ae.jpg","comment_is_top":false,"comment_ctime":1577177910,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1577177910","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæˆ‘é‡åˆ°ä¸ªé—®é¢˜ï¼Œå’Œè¿™èŠ‚è¯¾æ²¡ä»€ä¹ˆå…³ç³»ï¼Œä½†å›°æ‰°å¾ˆä¹…ï¼Œä¸çŸ¥é“è€å¸ˆå’Œä¸€èµ·å­¦ä¹ çš„åŒå­¦ä»¬æ˜¯å¦æœ‰å¥½çš„å»ºè®®ã€‚é—®é¢˜å¦‚ä¸‹ï¼š<br>æˆ‘å•ä½æœ‰ä¿©ä¸ªç½‘æ®µï¼š132.XX.XX.XXå’Œ10.XX.XX.XXï¼Œæˆ‘ç°åœ¨æœ‰ä¸€å°centos7çš„æœåŠ¡å™¨ï¼Œé‡Œé¢éƒ¨ç½²ç€åŸºäºspringbootå¼€å‘çš„ä¸€ä¸ªå°ç³»ç»Ÿï¼Œæˆ‘ç°åœ¨æƒ³åœ¨è¯¥æœåŠ¡å™¨ä¸Šé…ç½®ä¿©å—ç½‘å¡ï¼Œ132.XX.XX.101å’Œ10.XX.XX.101ï¼Œæƒ³è®©ä¸¤ä¸ªç½‘æ®µçš„ç”¨æˆ·éƒ½å¯ä»¥è®¿é—®ï¼Œä½†é…ç½®è¿‡ç¨‹ä¸­å‘ç°æˆ‘åªèƒ½åœ¨ä¸€å—ç½‘å¡çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ç½‘å…³ï¼Œè¿™æ ·ç°åœ¨é€ æˆåªèƒ½æ˜¯ç½‘å…³çš„é‚£ä¸ªç½‘æ®µå¯ä»¥è®¿é—®ç³»ç»Ÿï¼Œå¦ä¸€ä¸ªç½‘æ®µçš„ç”¨æˆ·æ ¹æœ¬å¹³pingä¸é€šï¼Œè¯·é—®å¤§å®¶æœ‰ä»€ä¹ˆå¥½åŠæ³•å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"æ¸©æ•…è€ŒçŸ¥æ–°å¯ä»¥ä¸ºå¸ˆçŸ£","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":131078,"discussion_content":"https://www.jianshu.com/p/796c3411f8eb","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578824574,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":153135,"user_name":"ä¹˜é£","can_delete":false,"product_type":"c1","uid":1115724,"ip_address":"","ucode":"0420C5535DACB7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLwSoTjHPX5tm4whBSfoZLX6toZxrZGUaLABQywKNf4MDc9toK3QSV7Z99ATcGicFCysoleQ5ISzmw/132","comment_is_top":false,"comment_ctime":1574165526,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574165526","product_id":100020801,"comment_content":"è¿™ä¸ªè¯­å¥æ‰§è¡Œçš„æ—¶å€™ä¼šæœ‰æ’åºè¿‡ç¨‹å—ï¼Œä¸ºä»€ä¹ˆï¼Ÿ<br>  ä¼šæœ‰æ’åºçš„è¿‡ç¨‹ã€‚å› ä¸ºåœ¨æ„å»ºè¦†ç›–ç´¢å¼•æ ‘æ—¶ï¼Œé¦–å…ˆé€šè¿‡ç¬¬ä¸€ä¸ªå­—æ®µæ’åºï¼Œå†é€šè¿‡ç¬¬äºŒä¸ªå­—æ®µæ’åºï¼Œæ‰€ä»¥åœ¨ç¬¬ä¸€ä¸ªå­—æ®µé‡‡ç”¨oræŸ¥è¯¢æ—¶ï¼Œå°±æ— æ³•åˆ©ç”¨ç´¢å¼•æ ‘æœ¬èº«çš„é¡ºåºç‰¹æ€§ï¼Œæ‰€ä»¥éœ€è¦é¢å¤–çš„<br>æ’åºåŠ¨ä½œã€‚<br><br>å¦‚æœä¸šåŠ¡ç«¯ä»£ç ç”±ä½ æ¥å¼€å‘ï¼Œéœ€è¦å®ç°ä¸€ä¸ªåœ¨æ•°æ®åº“ç«¯ä¸éœ€è¦æ’åºçš„æ–¹æ¡ˆï¼Œä½ ä¼šæ€ä¹ˆå®ç°å‘¢ï¼Ÿ<br>  åˆ†ç±»å–å‡ºæ­å· ã€è‹å·å‰ä¸€ç™¾æ¡ï¼Œåœ¨ä¸šåŠ¡ä»£ç ä¸­æ’åºã€‚<br><br>å¦‚æœæœ‰åˆ†é¡µéœ€æ±‚ï¼Œè¦æ˜¾ç¤ºç¬¬ 101 é¡µï¼Œä¹Ÿå°±æ˜¯è¯´è¯­å¥æœ€åè¦æ”¹æˆ â€œlimit 10000,100â€ï¼Œ ä½ çš„å®ç°æ–¹æ³•åˆä¼šæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ<br>  é€šè¿‡è¾…åŠ©ç´¢å¼•æ ‘å®šä½ç¬¬100é¡µæœ«ä½ç½®çš„ä½ç½®ï¼Œä»è¯¥ä½ç½®å¼€å§‹å–100æ¡ï¼Œä»è€Œé¿å…å…¨æ’åºã€‚<br><br>","like_count":0},{"had_liked":false,"id":144390,"user_name":"fred ğŸ’","can_delete":false,"product_type":"c1","uid":1057311,"ip_address":"","ucode":"442245FE43131D","user_header":"https://static001.geekbang.org/account/avatar/00/10/22/1f/1c0a78cc.jpg","comment_is_top":false,"comment_ctime":1571909467,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571909467","product_id":100020801,"comment_content":"è€å¸ˆï¼Œåœ¨ä¸Šé¢çš„æè¿°å­—æåˆ°ï¼Œåˆ›å»ºalter table t add index city_user(city, name);<br>è”åˆç´¢å¼•åœ¨æ‰§è¡Œï¼šselect city,name,age from t where city=&#39;æ­å·&#39;  limit 3;<br>æ˜¯åœ¨ç´¢å¼•ä¸­å°±æ’åºå¥½çš„ã€‚<br>ä½†æ˜¯æˆ‘æµ‹è¯•ä¸‹æ¥å‘ç°ï¼š<br>2æ¡è¯­å¥ï¼š<br>1.select * from t where city=&#39;æ­å·&#39;  limit 3;<br>2.select city,name from t where city=&#39;æ­å·&#39;  limit 3;<br>åªæœ‰è¯­å¥2è¿”å›çš„ç»“æœæ˜¯æ ¹æ®nameæ’å¥½åºçš„ï¼Œ<br>è€Œè¯­å¥1select æ‰€æœ‰ï¼ˆæˆ–è€…selecté™¤äº†ç´¢å¼•åŒ…å«çš„å­—æ®µå¤–è¿˜æœ‰å…¶å®ƒå­—æ®µï¼‰ï¼Œå°±æ— æ³•è¾¾åˆ°ç»“æœæ˜¯æ’åºçš„æ•ˆæœ<br>è¿™ä¸ªæ˜¯ä¸ºä»€ä¹ˆï¼Ÿä¸æ˜¯å¾ˆç†è§£","like_count":0},{"had_liked":false,"id":142867,"user_name":"é›¶è½","can_delete":false,"product_type":"c1","uid":1152368,"ip_address":"","ucode":"BE085142D54AEB","user_header":"https://static001.geekbang.org/account/avatar/00/11/95/70/1fa01d6f.jpg","comment_is_top":false,"comment_ctime":1571569086,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1571569086","product_id":100020801,"comment_content":"ç”»å›¾å·¥å…·æ˜¯ä»€ä¹ˆ","like_count":0},{"had_liked":false,"id":142235,"user_name":"é»„é¹¤","can_delete":false,"product_type":"c1","uid":1029141,"ip_address":"","ucode":"2EFDA4DA2223DB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b4/15/47fe087a.jpg","comment_is_top":false,"comment_ctime":1571317352,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571317352","product_id":100020801,"comment_content":"è·‘äº†ä¸€éå¯è§æ€§å®éªŒï¼Œä¸¤ä¸ªå‘ç°<br><br>1. session Aä¸­çš„å½“å‰è¯»ï¼Œå¦‚æœæ²¡æœ‰å‘ç”Ÿä¿®æ”¹ï¼Œä¸å½±å“åé¢ä¸€è‡´è¯»çš„ select * ...<br>2.session Aä¸­æ‰§è¡Œäº†updateè¯­å¥åï¼Œå†æ¬¡selectï¼Œè¿”å›çš„æ˜¯ï¼ˆ1,2ï¼‰ï¼Œä¸æ˜¯ï¼ˆ1,3ï¼‰ï¼Œè·Ÿè€å¸ˆè·‘å‡ºæ¥çš„ç»“æœä¸åŒã€‚æ™•èœä¸­~<br>ç¯å¢ƒï¼ŒMySQLæœåŠ¡å™¨æ˜¯é˜¿é‡Œäº‘ä¸Šçš„RDSï¼Œversion: 5.7.20-log<br>å®¢æˆ·ç«¯æ˜¯ MySQL workbench 8.0.16 Communityç‰ˆ<br><br>å…·ä½“å¯è§æ€§è¯•éªŒï¼šï¼ˆA for session Aï¼‰<br><br>A: begin;<br>A: select * from t where id=1; (1,2)<br>      =&gt; æ­¤æ—¶session B æ‰§è¡Œ update t set a=3 where id=1;<br>A: select * from t where id=1; (1,2)<br>A: select * from t where id=1 for update; (1,3)<br>A: select * from t where id=1; (1,2)<br>A: update t set a=3 where id=1;<br>      =&gt; 0 row(s) affected Rows matched: 1  Changed: 0  Warnings: 0<br>A: select * from t where id=1; (1,2)<br>A: commit;<br>A: select * from t where id=1; (1,3)<br><br>psï¼šæˆ‘å‰é¢çš„ç•™è¨€åº”è¯¥æ˜¯åœ¨è¿™ä¸€ç¯‡åº•ä¸‹çš„ï¼Œçœ‹èµ·æ¥è¢«é€‰ä¸ºç²¾é€‰ç•™è¨€ä¹‹å‰è‡ªå·±æ˜¯çœ‹ä¸åˆ°çš„ã€‚","like_count":0},{"had_liked":false,"id":142198,"user_name":"é»„é¹¤","can_delete":false,"product_type":"c1","uid":1029141,"ip_address":"","ucode":"2EFDA4DA2223DB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b4/15/47fe087a.jpg","comment_is_top":false,"comment_ctime":1571308710,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1571308710","product_id":100020801,"comment_content":"è€å¸ˆï¼Œä¸ŠæœŸé—®é¢˜æ—¶é—´é‡Œé¢ï¼Œ<br><br>â€œsession A çš„ç¬¬äºŒä¸ª select è¯­å¥æ˜¯ä¸€è‡´æ€§è¯»ï¼ˆå¿«ç…§è¯»)ï¼Œå®ƒæ˜¯ä¸èƒ½çœ‹è§ session B çš„æ›´æ–°çš„ã€‚â€<br><br>è¿™å¥ï¼Œæˆ‘çš„ç†è§£æœ‰äº›ä¸åŒï¼šsession Aé‡Œé¢ï¼Œè™½ç„¶ç¬¬äºŒä¸ªselectæ˜¯ä¸€è‡´è¯»ï¼Œä½†åœ¨å®ƒä¹‹å‰çš„updateè¯­å¥ï¼Œæ˜¯å…ˆè¯»åå†™ï¼Œå½“å‰è¯»ï¼Œè¿™æ ·å°±çœ‹åˆ°äº†session Bçš„æ›´æ–°ï¼Œä»è€Œå½±å“äº†ä¹‹åçš„selectè¯»åˆ°çš„å†…å®¹ã€‚<br>æŒ‰ç…§è¿™ä¸ªç†è§£ï¼Œå¯è§æ€§å®éªŒä¸èƒ½è¯´æ˜å®é™…å‘ç”Ÿçš„æ˜¯ç¬¬ä¸‰ä¸ªé€‰é¡¹ã€‚éœ€è¦é€šè¿‡æŸ¥redo log&#47;bin logï¼Œæˆ–è€…æŸ¥æºç æ¥éªŒè¯ã€‚<br><br>å¦å¤–ï¼Œæˆ‘åœ¨è¡¨ä¸­å¢åŠ äº†ä¸€ä¸ª timestamp å­—æ®µï¼Œå‘ç°updateæ˜¯æ–°çš„å€¼å’Œç°æœ‰å€¼ç›¸ç­‰æ˜¯ï¼Œtimestamp å­—æ®µä¸ä¼šå˜åŒ–ã€‚å¦‚æœæ˜¯å‰é¢é—®é¢˜çš„ç­”æ¡ˆæ˜¯é€‰é¡¹ä¸‰çš„è¯ï¼Œé‚£æ„å‘³ç€timestampå­—æ®µçš„æ›´æ–°æ˜¯å¦ä¸€æ¬¡æ“ä½œã€‚è¿™ä¸ªç†è§£æ˜¯å¦æ­£ç¡®å‘¢ï¼Ÿ<br><br>è°¢è°¢æ—è€å¸ˆ~","like_count":0,"discussions":[{"author":{"id":1029141,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b4/15/47fe087a.jpg","nickname":"é»„é¹¤","note":"","ucode":"2EFDA4DA2223DB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":77053,"discussion_content":"æ›´æ–°ä¸€ä¸‹ã€‚\næ ¹æ®ä¸€è‡´æ€§è¯»çš„åŸç†ï¼Œæœ¬äº‹åŠ¡ä¸­åªè¦å‘ç”Ÿäº†updateï¼Œé‚£ä¹ˆå°±èƒ½çœ‹åˆ°æ–°çš„å€¼ã€‚\nå¦‚æœåªæ˜¯åšäº†å½“å‰è¯»ï¼Œä½†æ²¡æœ‰è¿›è¡Œä¿®æ”¹ï¼Œä¸å½±å“ä¸€è‡´æ€§è¯»è§†å›¾ã€‚\nupdateè¯­å¥æ˜¯å¦éœ€è¦å…ˆè¯»åå†™ï¼Œè¿™ä¸ªè¦æ ¹æ®å…·ä½“sqlæ¥åˆ¤æ–­ã€‚set k=k+1 è¿™ç§æ–¹å¼ï¼Œéœ€è¦å…ˆè¯»ï¼Œå½“å‰è¯»ã€‚ä½† set k=3 è¿™ç§æ–¹å¼ï¼Œåº”ä¸éœ€è¦å…ˆè¯»ï¼Œå¦åˆ™ change buffer æœºåˆ¶å°±æ— æ³•é€‚ç”¨äº†ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1575884504,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":138509,"user_name":"å¼ å¾·","can_delete":false,"product_type":"c1","uid":1101929,"ip_address":"","ucode":"31FE63E8725EFC","user_header":"https://static001.geekbang.org/account/avatar/00/10/d0/69/5dbdc245.jpg","comment_is_top":false,"comment_ctime":1570284952,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570284952","product_id":100020801,"comment_content":"æ˜¯åŸå…ˆçš„ç´¢å¼•ä¸èƒ½åˆ é™¤å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":138508,"user_name":"å¼ å¾·","can_delete":false,"product_type":"c1","uid":1101929,"ip_address":"","ucode":"31FE63E8725EFC","user_header":"https://static001.geekbang.org/account/avatar/00/10/d0/69/5dbdc245.jpg","comment_is_top":false,"comment_ctime":1570284913,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570284913","product_id":100020801,"comment_content":"alter table t add index city_user(city, name);<br> æˆ‘ä¸ºå•¥åŠ ä¸Šè¿™ä¸ªç´¢å¼•  çœ‹æ‰§è¡Œè®¡åˆ’  è¿˜æ˜¯ç”¨åˆ°äº†filesort","like_count":0},{"had_liked":false,"id":137722,"user_name":"å¸¸æ–‡é¾™","can_delete":false,"product_type":"c1","uid":1204525,"ip_address":"","ucode":"4A126159D24766","user_header":"https://static001.geekbang.org/account/avatar/00/12/61/2d/5ca0a3da.jpg","comment_is_top":false,"comment_ctime":1569830508,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569830508","product_id":100020801,"comment_content":"select * from t where city in (&#39;æ­å·&#39;,&quot; è‹å· &quot;) order by name limit 10000,100;<br>è¿™ä¸ªè¯­å¥åœ¨sqlå±‚é¢å’Œä¸šåŠ¡å±‚é¢éƒ½æ²¡æœ‰æƒ³åˆ°å¥½åŠæ³•<br>ä½†æ˜¯å¯ä»¥é€šè¿‡åŠ ä¸€ä¸ªå­—æ®µç”¨æ¥æ ‡è¯†cityä¸ºæ­å·æˆ–è‹å·æ¯”å¦‚unioncityï¼Œç„¶åå»ºç«‹unioncity,nameçš„è”åˆç´¢å¼•<br><br>","like_count":0},{"had_liked":false,"id":135126,"user_name":"Geek_8354ec","can_delete":false,"product_type":"c1","uid":1603270,"ip_address":"","ucode":"520DF9A874169D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/dgox0m94vr6w2Vxk0N665ibibenV2a5axmNXGg7cib5QaiatW1Sp25tfMniaD0scaibwZSNKiaOMX2Kpo7H5CIl7f4yyQ/132","comment_is_top":false,"comment_ctime":1569034135,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1569034135","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼Œæˆ‘ä¸æ¸…æ¥šä¸ºä»€ä¹ˆç»™cityã€nameåšäº†ä¸ªè”åˆç´¢å¼•ä¹‹åï¼Œcityå°±å˜æˆæœ‰åºçš„äº†ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1473358,"avatar":"https://static001.geekbang.org/account/avatar/00/16/7b/4e/73a9deec.jpg","nickname":"ä¸€åªç‹¬ç«‹ç‰¹è¡Œçš„çŒª","note":"","ucode":"52263607CCBE6F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":221041,"discussion_content":"æˆ‘ä¹Ÿæœ‰è¿™ä¸ªç–‘é—®ï¼Œè¯·é—®ä½ æƒ³æ˜ç™½äº†å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585967554,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"æ¸©æ•…è€ŒçŸ¥æ–°å¯ä»¥ä¸ºå¸ˆçŸ£","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":131079,"discussion_content":"city+nameæ•´ä½“æ’åºï¼Œä¹Ÿå°±æ˜¯éƒ½æœ‰åºå•Šï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578824724,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":134915,"user_name":"nicklos","can_delete":false,"product_type":"c1","uid":1198461,"ip_address":"","ucode":"2673D71077B946","user_header":"https://static001.geekbang.org/account/avatar/00/12/49/7d/6d9675da.jpg","comment_is_top":false,"comment_ctime":1568951515,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568951515","product_id":100020801,"comment_content":"è¯·é—®è€å¸ˆï¼Œä¸ŠæœŸé—®é¢˜è¿˜æœ‰ç‚¹ä¸å¤ªæ˜ç™½ï¼Ÿåœ¨binlog_format=rowçš„é…ç½®ä¸‹ï¼ŒsessionAæ— è®ºåœ¨ä»»ä½•æ—¶åˆ»å¾—åˆ°çš„éƒ½æ˜¯(1,1)çš„å€¼ã€‚å“ªæ€•sessionAè‡ªå·±ä¹Ÿæ‰§è¡Œupdateè¯­å¥å°†aè®¾ç½®æˆ3.å¾—åˆ°çš„ä¹Ÿæ˜¯(1,1)ã€‚è¿™è¯¥å¦‚ä½•ç†è§£å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":134462,"user_name":"ä¸ä¸å†é™©è®°","can_delete":false,"product_type":"c1","uid":1661704,"ip_address":"","ucode":"A43829E454C067","user_header":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","comment_is_top":false,"comment_ctime":1568851989,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568851989","product_id":100020801,"comment_content":"åŸºæœ¬åŠŸ  limit  1000000, 100 æ—¶  éœ€è¦æŠŠæŸ¥è¯¢è°ƒæ•´ä¸‹   inner join  (select id  from  xxx  where yy order z limit  1000000,100)  t2  on t.id =t2.id<br>","like_count":0},{"had_liked":false,"id":132568,"user_name":"é±¼ç­±é›¨","can_delete":false,"product_type":"c1","uid":1597257,"ip_address":"","ucode":"17B11B3CF81153","user_header":"https://static001.geekbang.org/account/avatar/00/18/5f/49/115a8f4c.jpg","comment_is_top":false,"comment_ctime":1568167265,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1568167265","product_id":100020801,"comment_content":"æ—è€å¸ˆï¼Œæˆ‘åœ¨ä½ çš„æ–‡ç« ä¸­ç»å¸¸æåˆ°äº†ç´¢å¼•è¿˜æ˜¯æœ‰ç»´æŠ¤ä»£ä»·çš„ã€‚å…³äºç´¢å¼•çš„ç»´æŠ¤ä»£ä»·ï¼Œæœ‰å“ªå‡ ä¸ªæ–¹é¢ï¼Ÿä»£ä»·æ˜¯ä»€ä¹ˆï¼Ÿä½ èƒ½è®²è§£ä¸‹å—","like_count":0,"discussions":[{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"æ¸©æ•…è€ŒçŸ¥æ–°å¯ä»¥ä¸ºå¸ˆçŸ£","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":131080,"discussion_content":"ç´¢å¼•å°±æ˜¯B+ğŸŒ²ï¼Œæ•°æ®æ›´æ–°ç»´æŠ¤B+ğŸŒ²çš„çŠ¶æ€ä¸å°±æ˜¯ç»´æŠ¤å—ï¼Œå¦å¤–ç´¢å¼•ä¹Ÿå ç”¨é¢å¤–ç£ç›˜ç©ºé—´ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578824835,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126026,"user_name":"é©¬ä»¥","can_delete":false,"product_type":"c1","uid":1344431,"ip_address":"","ucode":"3FEA06CA14DE28","user_header":"https://static001.geekbang.org/account/avatar/00/14/83/af/1cb42cd3.jpg","comment_is_top":false,"comment_ctime":1566296029,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566296029","product_id":100020801,"comment_content":"è¯¾åç–‘é—®è¿™éƒ¨åˆ†ï¼ŒsessionAåœ¨æ›´æ–°çš„æ—¶å€™ä¸æ˜¯å½“å‰è¯»å—ï¼ŸæŒ‰ç†è¯´å®ƒæ˜¯èƒ½å¤Ÿæ„ŸçŸ¥åˆ°sessionBçš„ä¿®æ”¹çš„å•Šï¼Œä¸ºä»€ä¹ˆupdate t set a=3 where id=1 and a=3ä¼šæ‰¾ä¸åˆ°è¿™æ¡æ›´æ–°æ•°æ®å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":123374,"user_name":"Jary","can_delete":false,"product_type":"c1","uid":1302829,"ip_address":"","ucode":"3D21F6EDDBBC6C","user_header":"https://static001.geekbang.org/account/avatar/00/13/e1/2d/cd7901da.jpg","comment_is_top":false,"comment_ctime":1565663928,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1565663928","product_id":100020801,"comment_content":"maxï¼ˆdateï¼‰å’Œorder by date desc limit æ‰§è¡Œé€»è¾‘ä¸€æ ·å—","like_count":0,"discussions":[{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"æ¸©æ•…è€ŒçŸ¥æ–°å¯ä»¥ä¸ºå¸ˆçŸ£","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":131081,"discussion_content":"å¦‚æœæœ‰ç´¢å¼•çš„è¯ï¼Œæˆ‘è§‰çš„max(data)åŸºæœ¬å°±æ˜¯order by date desc limit 1ï¼Œæ²¡æœ‰ç´¢å¼•çš„è¯éƒ½è¦å…¨è¡¨æ‰«æäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578824932,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":120309,"user_name":"Mq","can_delete":false,"product_type":"c1","uid":1178359,"ip_address":"","ucode":"041F572AFAB275","user_header":"https://static001.geekbang.org/account/avatar/00/11/fa/f7/91ac44c5.jpg","comment_is_top":false,"comment_ctime":1564824644,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1564824644","product_id":100020801,"comment_content":"ä¸è€å¸ˆå¥½ï¼Œè¯·æ•™ä¸ªé—®é¢˜ï¼Œæ’åºåä¸€æ¬¡å–ç¬¬50000-55000ï¼Œä¸€æ¬¡5000ï¼Œè¿˜æ˜¯åˆ†10æ¬¡æ¯æ¬¡å–500çš„æ•ˆç‡é«˜ã€‚æˆ‘ç†è§£çš„æ˜¯æ’åºè‚¯å®šæ˜¯è¦å¯¹æ»¡è¶³æ¡ä»¶çš„è¡Œåšä¸€æ¬¡æŸ¥æ‰¾ï¼Œæ•°æ®å¦‚æœåœ¨å†…å­˜äº†åº”è¯¥æ˜¯è¦æ¯”åš10æ¬¡æŸ¥è¯¢é«˜ï¼Œå¦‚æœæ•°æ®åœ¨ä¸´æ—¶è¡¨ç©ºé—´ä¹Ÿåº”è¯¥æ¯”åš10æ¬¡æŸ¥è¯¢é«˜ï¼Œä¸çŸ¥é“æˆ‘ç†è§£çš„å¯¹ä¸ã€‚å› ä¸ºæœ€è¿‘åœ¨åšä¸€ä¸ªå¤§è¡¨åŒæ­¥çš„åŠŸèƒ½ï¼Œè·ŸåŒäº‹æœ‰ç‚¹åˆ†æ­§ã€‚<br>        å¦å¤–å…³äºæ•°æ®åº“åˆ†é¡µè¶Šå¾€ååˆ†é¡µè¶Šæ…¢çš„é—®é¢˜ï¼Œæˆ‘çš„ç†è§£æ˜¯æœ‰æ’åºçš„åˆ†é¡µåº”è¯¥åŒºåˆ«ä¸å¤§ï¼Œæ²¡æ’åºçš„åˆ†é¡µå› ä¸ºåé¢æ‰«æçš„æ•°æ®å—è¶Šå¤šï¼Œæ‰€ä»¥è¶Šæ¥è¶Šæ…¢ï¼Œä¸çŸ¥é“æˆ‘ç†è§£çš„å¯¹ä¸ã€‚          å¸Œæœ›è€å¸ˆè¯´ä¸‹åŸç†ã€‚","like_count":0,"discussions":[{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"æ¸©æ•…è€ŒçŸ¥æ–°å¯ä»¥ä¸ºå¸ˆçŸ£","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":131083,"discussion_content":"è€ƒè™‘æœåŠ¡å†…å­˜å‹åŠ›æƒ…å†µæ•°æ®è‡ªç„¶æ˜¯å¤šå¤šç›Šå–„äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578825171,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":120284,"user_name":"David.cui","can_delete":false,"product_type":"c1","uid":1302228,"ip_address":"","ucode":"AB46F310403612","user_header":"https://static001.geekbang.org/account/avatar/00/13/de/d4/b83c4185.jpg","comment_is_top":false,"comment_ctime":1564820099,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564820099","product_id":100020801,"comment_content":"åˆ°ä¸»é”® id ç´¢å¼•å–å‡ºæ•´è¡Œï¼Œå–nameã€cityã€ageä¸‰ä¸ªå­—æ®µçš„å€¼ï¼Œå­˜å…¥ sort_buffer ä¸­ï¼›<br><br>æˆ‘çš„ç†è§£å’Œé—®é¢˜å¦‚ä¸‹ï¼š<br>1.åˆ°ä¸»é”® id ç´¢å¼•å–å‡ºæ•´è¡Œ~~~~æˆ‘çš„ç†è§£åº”è¯¥æ˜¯è¯»å…¥æ»¡è¶³æ¡ä»¶çš„ä¸»é”®IDæ‰€åœ¨çš„æ•°æ®é¡µï¼Œè€Œä¸æ˜¯åªè¯»å…¥æ»¡è¶³IDæ¡ä»¶çš„æŸè¡Œï¼›<br>2.è¿™äº›æ•°æ®é¡µè¯»å…¥innodb_buffer_poolåï¼Œæ‰èƒ½æŠŠç¬¦åˆæ¡ä»¶çš„è¡Œå–å‡ºæ¥ï¼Œæ”¾å…¥sort_bufferä¸­ï¼›<br>3.åœ¨sort_bufferä¸­æ’åºä¹‹åï¼Œæ‰èƒ½æ˜¾ç¤ºåˆ°å‰ç«¯<br>4ã€æˆ‘çš„é—®é¢˜æ˜¯ä»innodb_buffer_poolåˆ°sort_bufferä¸­å»çš„æ—¶å€™ï¼Œæ˜¯æ•´è¡Œå¤åˆ¶è¿‡å»ï¼Œè¿˜æ˜¯æŒ‡å¤åˆ¶nameã€cityã€ageä¸‰ä¸ªå­—æ®µï¼Ÿ<br>","like_count":0},{"had_liked":false,"id":119093,"user_name":"ä¸€è¢‹å¤§è™¾","can_delete":false,"product_type":"c1","uid":1469366,"ip_address":"","ucode":"8E4FED94405475","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/wwDhoIeIqMZiaLLCLmCsuiaeEt7rEQMqdTVjjTicic0Pz9HHpgzboaia1hxu3H0IHovqEa6pJ8e1UQn1gqeUr3ibIdrA/132","comment_is_top":false,"comment_ctime":1564502356,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1564502356","product_id":100020801,"comment_content":"æ—è€å¸ˆï¼Œè¯·æ•™æ‚¨ä¸€ä¸ªé—®é¢˜å•Šã€‚order by å­—æ®µå€¼ç›¸åŒçš„æ—¶å€™ï¼Œæ’åºç»“æœæ˜¯ä¸ç¡®å®šçš„ï¼Œå› è€Œå¯¼è‡´åˆ†é¡µæ•°æ®å‡ºé”™ã€‚æˆ‘æŸ¥äº†ä¸‹èµ„æ–™ï¼Œæ˜¯è¯´5.6ä»¥åæ’åºåšäº†ç‚¹ä¼˜åŒ–ï¼ŒåŠ äº†ä¸ªpriority queueï¼Œç„¶åä½¿ç”¨çš„æ˜¯å †æ’åºï¼Œå› ä¸ºå †æ’åºæ˜¯ä¸ç¨³å®šçš„ï¼Œæ‰€ä»¥æ‰æœ‰è¿™æ ·çš„é—®é¢˜ã€‚<br>1. å¯æ˜¯æˆ‘è¯•è¿‡å½“offsetå¢å¤§ä¹‹åï¼Œæ’åºçš„ç»“æœä¼¼ä¹æ˜¯ç¡®å®šçš„ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ<br>2. å½“order byå­—æ®µåŠ ä¸Šç´¢å¼•åï¼Œæ¯æ¬¡æ’åºçš„ç»“æœåˆå˜æˆç¡®å®šçš„ï¼Œè¿™ä¸ªä¸å¤ªç†è§£ã€‚æˆ‘çœ‹è§£æè®¡åˆ’ï¼Œç”¨çš„æ˜¯file sortå•Šï¼Œä¸æ˜¯ç›´æ¥æŒ‰é¡ºåºè¯»ç´¢å¼•ã€‚<br>mysql -version 5.7<br>create_table_sql:<br><br>\tCREATE TABLE learning.`people` (<br>  `id` int(10) NOT NULL AUTO_INCREMENT COMMENT &#39;ä¸»é”®&#39;,<br>  `age` int(11) DEFAULT NULL comment &#39;å¹´é¾„&#39;,<br>  `name` varchar(11)  COMMENT &#39;å§“å&#39;,<br>  PRIMARY KEY (`id`),<br>  KEY `idx_age` (`age`)<br>) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8","like_count":0,"discussions":[{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"æ¸©æ•…è€ŒçŸ¥æ–°å¯ä»¥ä¸ºå¸ˆçŸ£","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":131087,"discussion_content":"1ï¼šæ²¡ç´¢å¼•ï¼Œå› ä¸ºæ•°æ®ä¼šé€šè¿‡éç¨³å®šæ’åºç®—æ³•æ’åºï¼Œæ‰€ä»¥å¯¼è‡´ç»“æœä¸ç¡®å®š\n2ï¼šæœ‰ç´¢å¼•ï¼Œæ•°æ®å·²ç»æ˜¯åœ¨ç´¢å¼•æ ‘ä¸­ç¡®å®šï¼Œæ‰€ä»¥ç»“æœç¡®å®š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578825548,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114941,"user_name":"shinee_x_X","can_delete":false,"product_type":"c1","uid":1605962,"ip_address":"","ucode":"98529C77B052AC","user_header":"https://static001.geekbang.org/account/avatar/00/18/81/4a/dcc563fb.jpg","comment_is_top":false,"comment_ctime":1563436674,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563436674","product_id":100020801,"comment_content":"è€å¸ˆè¯´çš„ç¬¬ä¸‰ç§æƒ…å†µï¼Œæœ‰è”åˆç´¢å¼•å¹¶ä¸”å€’åºå–æ•°æ®çš„æƒ…å†µä¸‹è¿˜ä¼šèµ°ç´¢å¼•ç ","like_count":0},{"had_liked":false,"id":114546,"user_name":"baoxin","can_delete":false,"product_type":"c1","uid":1106343,"ip_address":"","ucode":"9CAE39985EF676","user_header":"https://static001.geekbang.org/account/avatar/00/10/e1/a7/86ea68a0.jpg","comment_is_top":false,"comment_ctime":1563332663,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1563332663","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼ŒB+æ ‘çš„å¶èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯é¡µï¼Œé¡µä¸­æœ‰å¤šè¡Œï¼Œè¿™å¤šè¡Œæœ¬èº«æ˜¯æ— åºçš„ï¼Œé’ˆå¯¹æŸä¸€å­—æ®µå»ºç´¢å¼•åï¼Œæ€ä¹ˆä¿è¯é¡µä¸­æ•°æ®ä¹Ÿæœ‰åºäº†å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1106343,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e1/a7/86ea68a0.jpg","nickname":"baoxin","note":"","ucode":"9CAE39985EF676","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":12670,"discussion_content":"b+æ ‘çš„å¹³è¡¡æ€§é’ˆå¯¹çš„å°±æ˜¯è¡Œäº†ï¼Œå»ºç´¢å¼•åï¼Œæœ‰åºæ€§æ˜¯é’ˆå¯¹è¡Œå˜åŠ¨çš„ï¼Œè¿™ä¸ªé¡µå¤§å°åªæ˜¯å½±å“äº†å•ä¸ªé¡µä¸­è¡Œæ•°çš„ä¸Šé™ï¼Œå°±æ˜¯b+æ ‘çš„å¹³è¡¡æ€§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568559979,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113555,"user_name":"çœ‹ä¸åˆ°deé¢œè‰²","can_delete":false,"product_type":"c1","uid":1162714,"ip_address":"","ucode":"88348CCAE81931","user_header":"https://static001.geekbang.org/account/avatar/00/11/bd/da/3d76ea74.jpg","comment_is_top":false,"comment_ctime":1563076055,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1563076055","product_id":100020801,"comment_content":"æœ‰ä¸ªç–‘é—®ï¼Œä¸çŸ¥é“è€å¸ˆèƒ½ä¸èƒ½çœ‹åˆ°äº†ğŸ˜…ã€‚åœ¨æœ€åç”¨è¦†ç›–ç´¢å¼•ä»£æ›¿æ’åºçš„è¯­å¥ä¸­ï¼Œæ—¢ç„¶ä¸éœ€è¦å†æ’åºï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆexplainä¸­rowsè¿˜æ˜¯4000ï¼Œä¸æ˜¯åªéœ€è¦å–1000æ¡å°±å¤Ÿäº†å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"æ¸©æ•…è€ŒçŸ¥æ–°å¯ä»¥ä¸ºå¸ˆçŸ£","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":131091,"discussion_content":"å¯èƒ½æ˜¯å…ˆwhereåœ¨limitçš„åŸå› å§ï¼Œæ„Ÿè§‰å¯ä»¥ä¼˜åŒ–ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578825816,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112738,"user_name":"é˜¿å§","can_delete":false,"product_type":"c1","uid":1229566,"ip_address":"","ucode":"68C0CC25E57707","user_header":"https://static001.geekbang.org/account/avatar/00/12/c2/fe/038a076e.jpg","comment_is_top":false,"comment_ctime":1562812148,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562812148","product_id":100020801,"comment_content":"è€å¸ˆï¼Œè¯·æ•™ä½ ä¸€ä¸ªé—®é¢˜ã€‚sale_typeå’Œtop_sortæ˜¯è”åˆç´¢å¼•ã€‚<br>æ‰§è¡Œè¯­å¥1<br>explain select sale_type,top_sort from auction_goods where sale_type = &#39;A&#39; order by top_sort<br>ç”¨åˆ°äº†å†…å­˜æ’åº<br>1\tSIMPLE\tauction_goods\tref\tidx_sort\tidx_sort\t43\tconst\t432\tUsing where; Using index<br>æ‰§è¡Œè¯­å¥2<br>explain select * from auction_goods where sale_type = &#39;A&#39; order by top_sort<br>ç”¨åˆ°æ–‡ä»¶æ’åº<br>1\tSIMPLE\tauction_goods\tALL\tidx_sort\tNULL\tNULL\tNULL\t467\tUsing where; Using filesort<br>è¿™ä¸ªæ˜¯ä»€ä¹ˆåŸå› å•Šï¼Ÿè¯¥å¦‚ä½•å»åˆ†æï¼Ÿ","like_count":0},{"had_liked":false,"id":112047,"user_name":"è§ï¼†ä¸è§","can_delete":false,"product_type":"c1","uid":1342533,"ip_address":"","ucode":"53C6167BB03424","user_header":"https://static001.geekbang.org/account/avatar/00/14/7c/45/19e24f98.jpg","comment_is_top":false,"comment_ctime":1562660045,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562660045","product_id":100020801,"comment_content":"è€å¸ˆ  SELECT `city`,`name`,`age` from t where city = &#39;æ­å·&#39; order by `city` limit 1000; SQLè¯­å¥æ”¹æˆè¿™æ ·çš„è¯ explain ä¸ºä»€ä¹ˆè¿˜æ˜¯éœ€è¦æ’åºå‘¢  cityä¸æ˜¯æœ¬æ¥å°±æ˜¯æœ‰åºçš„å—ï¼Ÿï¼Ÿè¿˜è¯·è€å¸ˆè§£ç­”ä¸‹ï¼","like_count":0},{"had_liked":false,"id":111409,"user_name":"æ®‹å¤©å™¬é­‚","can_delete":false,"product_type":"c1","uid":1506609,"ip_address":"","ucode":"A2AD8303A4518D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/q2HwchogzNiavKhIB4GfAxH6B88NhSoC7B7keVEUqiaP6JPokDUNJLYehocOyqYqrhA3iaxywyRXLYkYJjDUQESZw/132","comment_is_top":false,"comment_ctime":1562553821,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1562553821","product_id":100020801,"comment_content":"è¿™é‡Œåº”è¯¥æœ‰ä¸¤ç§æƒ…å†µï¼Œå¦‚æœæ­å·å’Œè‹å·ä¸¤ä¸ªåŸå¸‚çš„äººæ˜¯æ··æ’çš„ï¼Œé‚£åº”è¯¥æ˜¯éœ€è¦æ’åºçš„ï¼Œå¦‚æœä¸¤ä¸ªåŸå¸‚çš„äººæ˜¯åˆ†å¼€çš„ï¼Œæ¯”å¦‚ï¼Œå‰é¢æ”¾çš„æ˜¯æ­å·çš„ï¼Œæ­å·å®Œäº†æ˜¯è‹å·çš„ï¼Œè¿™æ ·çš„æ”¾ï¼Œæ˜¯ä¸éœ€è¦æ’åºçš„","like_count":0,"discussions":[{"author":{"id":1812970,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a9/ea/5bfce6c5.jpg","nickname":"mgs2002","note":"","ucode":"F5931108BD509B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":282664,"discussion_content":"å®æµ‹ï¼Œç¡®å®æ˜¯è¿™æ ·ï¼Œæ•°æ®æ··æ’æ‰§è¡Œè®¡åˆ’æœ‰ Using filesort ï¼Œè¯´æ˜è¿˜æ˜¯æœ‰æ’åº","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592040880,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109841,"user_name":"noone","can_delete":false,"product_type":"c1","uid":1171517,"ip_address":"","ucode":"21F0A795CA52A9","user_header":"https://static001.geekbang.org/account/avatar/00/11/e0/3d/c5795d68.jpg","comment_is_top":false,"comment_ctime":1562119161,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562119161","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå¸®å¿™è§£ç­”ä¸ªé—®é¢˜<br>personè¡¨åŒ…å«å­—æ®µusernameå’Œphoneï¼Œå…¶ä¸­usernameæœ‰æ™®é€šç´¢å¼•ï¼Œphoneå­—æ®µæ²¡æœ‰ç´¢å¼•ï¼ˆè¡¨æµ‹è¯•æ•°æ®é‡è¶…è¿‡1åƒä¸‡ï¼‰<br><br>é—®é¢˜:<br>explain select * from person order by username,phone limit 1ï¼›<br><br>æ²¡æœ‰ä½¿ç”¨usernameç´¢å¼•èµ°äº†å…¨è¡¨æ‰«æ<br><br>","like_count":0},{"had_liked":false,"id":104766,"user_name":"Aaron","can_delete":false,"product_type":"c1","uid":1066251,"ip_address":"","ucode":"B0C504A76297C7","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/0Qp9pxHBvgdZAveKzsvUFFUicCJfe7ONzhC7jSNFQDNFvg0jRMXuqqZOdxG1qKosylUYrpIHUR2Q76w5m4HtVkg/132","comment_is_top":false,"comment_ctime":1560829991,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1560829991","product_id":100020801,"comment_content":"å¦‚æœèƒ½å¤Ÿä¿è¯ä» city è¿™ä¸ªç´¢å¼•ä¸Šå–å‡ºæ¥çš„è¡Œï¼Œå¤©ç„¶å°±æ˜¯æŒ‰ç…§name é€’å¢æ’åºçš„è¯ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥ä¸ç”¨å†æ’åºäº†å‘¢ï¼Ÿ<br>alter table t add index city_user(city, name);<br>-------------------------------------------<br>ä¸ºä»€ä¹ˆcity_userè¿™ä¸ªè”åˆç´¢å¼•ï¼Œnameå°±æ˜¯æœ‰åºçš„å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":159072,"discussion_content":"å› ä¸ºB+æ ‘ç®—æ³•è¦æ±‚æ˜¯é€’å¢æœ‰åºçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580651831,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":101655,"user_name":"Hidden","can_delete":false,"product_type":"c1","uid":1114462,"ip_address":"","ucode":"6323E5D32A3190","user_header":"https://static001.geekbang.org/account/avatar/00/11/01/5e/95f7d928.jpg","comment_is_top":false,"comment_ctime":1559902186,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1559902186","product_id":100020801,"comment_content":"select * from t where a=? and b&gt;? order by c limit 0,100 å¦‚ä½•åŠ ç´¢å¼• æ•ˆç‡é«˜","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":159076,"discussion_content":"å¦‚æœå¯ä»¥ï¼Œææˆabè”åˆç´¢å¼•ï¼Œcå†å»ºç«‹ä¸€ä¸ªç´¢å¼•ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580652009,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":95408,"user_name":"jacy","can_delete":false,"product_type":"c1","uid":1103456,"ip_address":"","ucode":"0022A8759DDCE6","user_header":"https://static001.geekbang.org/account/avatar/00/10/d6/60/f21b2164.jpg","comment_is_top":false,"comment_ctime":1558053973,"is_pvip":false,"discussion_count":1,"race_medal":1,"score":"1558053973","product_id":100020801,"comment_content":"ä¸ºä»€ä¹ˆè¦†ç›–ç´¢å¼•çš„æ‰§è¡Œè®¡åˆ’æ˜¾ç¤ºçš„æ˜¯4000è¡Œï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":159077,"discussion_content":"å› ä¸ºå±äºæ­å·çš„æ•°æ®æœ‰4000è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580652102,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91243,"user_name":"Michael","can_delete":false,"product_type":"c1","uid":1118976,"ip_address":"","ucode":"35F4FFAC4A4B15","user_header":"https://static001.geekbang.org/account/avatar/00/11/13/00/a4a2065f.jpg","comment_is_top":false,"comment_ctime":1556945687,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1556945687","product_id":100020801,"comment_content":"è¿™èŠ‚è¯¾ç¨‹ä¸­ï¼Œé‡åˆ°çš„ explain æŸ¥è¯¢è®¡åˆ’ Extra å­—æ®µå‡ºç°äº†ä¸åŒå­—æ ·ï¼Ÿ<br><br>Using filesortï¼š è¡¨ç¤ºéœ€è¦æ’åºï¼›<br><br>Using indexï¼š è¡¨ç¤ºä½¿ç”¨äº†è¦†ç›–ç´¢å¼•;<br><br>Using where å’Œ Using index condition å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":159081,"discussion_content":"using index conditionè¯´æ˜ç”¨çš„æ˜¯ç´¢å¼•æ¡ä»¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580652258,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":90289,"user_name":"readme","can_delete":false,"product_type":"c1","uid":1099378,"ip_address":"","ucode":"750F692222DD8F","user_header":"https://static001.geekbang.org/account/avatar/00/10/c6/72/eb40011e.jpg","comment_is_top":false,"comment_ctime":1556467015,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1556467015","product_id":100020801,"comment_content":"å›¾ 14 å¯è§æ€§éªŒè¯æ–¹å¼ -- å¯¹ç…§ä¸­<br><br>session A çš„ update t set a = 3 where id = 1 and a = 3 <br><br>ä¼šä¸ä¼šæœ‰å½“å‰è¯»ï¼Ÿå¦‚æœå½“å‰è¯»çš„è¯ï¼Œé‚£æ˜¯ä¸æ˜¯ä¼šè¯»åˆ°session Bçš„æ›´æ–°çš„å€¼ï¼Ÿ<br><br>è¯·è€å¸ˆå¸®å¿™åˆ†æä¸‹ã€‚","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":159083,"discussion_content":"ä¼šæœ‰å½“å‰è¯»ï¼Œä½†æ˜¯å½“å‰è§†å›¾açš„å€¼æ˜¯2ï¼Œä¸æ˜¯3ï¼Œæ‰€ä»¥æ— æ³•æ‰§è¡Œæ›´æ–°è¯­å¥ã€‚å½“å‰è¯»æ˜¯é’ˆå¯¹çš„æ›´æ–°è¯­å¥ä¸­çš„setï¼Œä¸æ˜¯é’ˆå¯¹whereæ¡ä»¶ä¸­çš„aã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580652333,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86981,"user_name":"å¤šæ ¼","can_delete":false,"product_type":"c1","uid":1222021,"ip_address":"","ucode":"122195F3D90EA1","user_header":"https://static001.geekbang.org/account/avatar/00/12/a5/85/eeb5b42f.jpg","comment_is_top":false,"comment_ctime":1555491901,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555491901","product_id":100020801,"comment_content":"æ— åº-&gt;æœ‰åº<br>1ã€åˆ©ç”¨ç´¢å¼•ï¼ˆB+Treeï¼‰å°†æ’åºå·¥ä½œåˆ†æ•£åˆ°æ—¥å¸¸çš„ç»´æŠ¤é‡<br>2ã€åˆ©ç”¨å†…å­˜æ’ï¼ˆå…¨æ’ã€ç´¢å¼•æ’ç„¶åå›è¡¨ã€é€è¡Œæ’ï¼‰","like_count":0},{"had_liked":false,"id":85217,"user_name":"Arvin","can_delete":false,"product_type":"c1","uid":1197346,"ip_address":"","ucode":"F632FBBA1B0D32","user_header":"https://static001.geekbang.org/account/avatar/00/12/45/22/137874a6.jpg","comment_is_top":false,"comment_ctime":1555009223,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1555009223","product_id":100020801,"comment_content":"é—®é¢˜ï¼š<br>æˆ‘æƒ³äº†ä¸‹ã€‚å¦‚æœä¸æ’åºçš„è¯ï¼Œæœ‰æ²¡æœ‰å¯èƒ½åŠ ä¸€ä¸ª name,cityçš„ç´¢å¼•ã€‚<br>ä¼˜åŒ–å™¨ ä¼šé€‰æ‹©è¿™ä¸ªç´¢å¼•å—ï¼Ÿ<br>æˆ‘çš„æ€è·¯å°±æ˜¯ name æ’å¥½åºäº†ã€‚ç„¶å ä»name ä¸€ä¸ªä¸€ä¸ªå–ä¹‹åæ»¡è¶³çš„æƒ…å†µ<br>å¦‚æœå¯ä»¥çš„è¯ å¯ä»¥è€ƒè™‘åŠ ä¸Š è¦†ç›–ç´¢å¼•<br>ã€è¿™é‡Œä¸é’ˆå¯¹äº ç»´æŠ¤ä¸€ä¸ªç´¢å¼•çš„æˆæœ¬ã€‘<br>","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":159093,"discussion_content":"ä½ è¿™æ ·å°±å˜æˆå…¨ç´¢å¼•æ‰«æäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580652699,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77694,"user_name":"shawn","can_delete":false,"product_type":"c1","uid":1010221,"ip_address":"","ucode":"8F6A8C7920996E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6a/2d/ec4ed8ce.jpg","comment_is_top":false,"comment_ctime":1552982439,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552982439","product_id":100020801,"comment_content":"è€å¸ˆæˆ‘é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼š<br>SELECT<br>\t\t\t\t\tid,<br>          order_id,<br>          order_item_id,<br>          create_time,<br>          sign_status<br>\t\t\t\tFROM<br>\t\t\t\t\tt_contract<br>\t\t\t\tWHERE<br>\t\t\t\t\tcontract_type = 2 <br>\t\t\t\tAND sign_status &lt;&gt; 0 <br>\t\t\t\tORDER BY<br>\t\t\t\t\tcreate_time DESC<br><br>æˆ‘å»ºç«‹äº†å…³äº(`contract_type`,`sign_status`,`create_time`) ç´¢å¼•ï¼Œä½†æ˜¯å½“æˆ‘æ‰§è¡Œexplainçš„æ—¶å€™è¿˜æ˜¯æœ‰filesortï¼š<br>å¦‚ä¸‹æ˜¯explainçš„ç»“æœï¼š<br>extra :  Using index condition; Using where; Using filesort<br>","like_count":0},{"had_liked":false,"id":75313,"user_name":"omg_boy","can_delete":false,"product_type":"c1","uid":1302067,"ip_address":"","ucode":"A17EF75041A40A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ctI2ictkuicWkyLWNZWFrDyErzWyHZ2c8iaY3UgJSyIbWbsHT5iaBeWxvg75vZhTgAEBoiacQojN6PiaQMDMiaia29z1qQ/132","comment_is_top":false,"comment_ctime":1552377332,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552377332","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼Œåé¢è‡ªå·±åˆæµ‹è¯•äº†ä¸ŠæœŸé—®é¢˜åœ¨ä¸åŒæ¡ä»¶ä¸‹ã€‚å‘ç°è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼š<br>RRçº§åˆ«ï¼Œbinlog_format=row  &amp;&amp; binlog_row_image = minimalã€‚<br>1. å½“æµ‹è¯•çš„è¡¨å­˜åœ¨ä¸»é”®ã€‚æ— è®ºwhereæ¡ä»¶çš„åˆ—æ˜¯ä¸æ˜¯ä¸»é”®åˆ—ï¼Œç¬¬äºŒæ¬¡selectæ˜¯èƒ½å¤Ÿçœ‹åˆ°ä¿®æ”¹çš„ã€‚<br>2. å½“æµ‹è¯•çš„è¡¨ä¸å­˜åœ¨ä¸»é”®ã€‚ç¬¬äºŒæ¬¡selectçœ‹ä¸åˆ°ä¿®æ”¹ã€‚<br><br>è€å¸ˆèƒ½è§£é‡Šä¸‹ä»€ä¹ˆåŸå› å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":74902,"user_name":"omg_boy","can_delete":false,"product_type":"c1","uid":1302067,"ip_address":"","ucode":"A17EF75041A40A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ctI2ictkuicWkyLWNZWFrDyErzWyHZ2c8iaY3UgJSyIbWbsHT5iaBeWxvg75vZhTgAEBoiacQojN6PiaQMDMiaia29z1qQ/132","comment_is_top":false,"comment_ctime":1552311171,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552311171","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼Œèƒ½è§£é‡Šä¸€ä¸‹binlog-row-image=minimalå¹¶ä¸”å­—æ®µæœ‰timestampä¸ºä»€ä¹ˆç¬¬äºŒæ¬¡selectä¼šçœ‹ä¸åˆ°å˜æ›´å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":74682,"user_name":"Sam","can_delete":false,"product_type":"c1","uid":1309087,"ip_address":"","ucode":"AE9044BE8BD2B9","user_header":"https://static001.geekbang.org/account/avatar/00/13/f9/9f/515d1686.jpg","comment_is_top":false,"comment_ctime":1552281098,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1552281098","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå½“sort_bufferä¸å¤Ÿç”¨çš„æ—¶å€™ï¼Œæ˜¯ç”¨ç£ç›˜ä¸´æ—¶æ–‡ä»¶æ¥è¾…åŠ©æ’åºï¼Œè¿˜æ˜¯æ‰€æœ‰æ•°æ®éƒ½æ”¾åœ¨æ–‡ä»¶ä¸Šæ’åºï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":159107,"discussion_content":"ç£ç›˜ä¸´æ—¶æ–‡ä»¶è¾…åŠ©æ’åºã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580652880,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":73327,"user_name":"é£è§é›¨ç‘Ÿ","can_delete":false,"product_type":"c1","uid":1317323,"ip_address":"","ucode":"5E832ABE126393","user_header":"https://static001.geekbang.org/account/avatar/00/14/19/cb/70a2b47e.jpg","comment_is_top":false,"comment_ctime":1551861758,"is_pvip":false,"replies":[{"id":"28009","content":"1. å…¶å®å°±æ˜¯â€œè¦æ”¾åˆ°sort_bufferä¸­çš„å­—æ®µä»¬â€<br>2. å¯¹ï¼Œè¦*3<br>3. æŒ‰é¡ºåºçœ‹ã€‚ç¬¬ä¸€ä¸ªjionæ˜¯a.*, ç¬¬äºŒä¸ªjoinæ˜¯a.*+b.c1&#47;c2&#47;c3","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1552724313,"ip_address":"","comment_id":73327,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551861758","product_id":100020801,"comment_content":"è€å¸ˆï¼Œè¿™ä¸¤å¤©ç¢°åˆ°ä¸€ä¸ªæ…¢SQLï¼Œåœ¨ä¼˜åŒ–ä¸­å‘ç°å¯¹äºmax_length_for_sort_dataè¿™ä¸ªå€¼æœ‰ç‚¹ç–‘é—®ï¼Œåœ¨æ–‡ç« ä¸­æ˜¯è¯´æ‰€æœ‰selectå­—æ®µçš„é•¿åº¦ã€‚ä½†åœ¨å®˜æ–¹æ–‡æ¡£ä¸­çš„è¯´æ³•æ˜¯ï¼šThe cutoff on the size of index values that determines which filesort algorithm to useã€‚<br>1.è¿™é‡Œçš„index valuesä¸æ€ä¹ˆç†è§£ã€‚<br>2.åœ¨SQLä¸­ï¼Œæˆ‘é€šè¿‡è®¡ç®—selectä¸­çš„å­—æ®µé•¿åº¦ç´¯åŠ ç®—ä¸‹æ¥åªæœ‰4500å·¦å³(å­—æ®µä¸­çš„Intã€decimalã€timestampç±»å‹ä¸º4ï¼Œvarcharæ ¹æ®æ‹¬å·ä¸­å­—ç¬¦è®¡ç®—ï¼Œdatetimeç®—8)ã€‚ä½†æ˜¯ç›´åˆ°æˆ‘æŠŠmax_length_for_sort_dataè¿™ä¸ªå€¼è°ƒæ•´åˆ°16192åæ‰èƒ½èµ°packed_additional_fieldsç®—æ³•ã€‚ä¸ºä»€ä¹ˆéœ€è¦è®¾ç½®è¿™ä¹ˆå¤§ã€‚æ˜¯æˆ‘è®¡ç®—æœ‰é—®é¢˜å—ï¼Ÿvarcharçš„æ˜¯è®¡ç®—çš„æ—¶å€™æ˜¯ä¸æ˜¯éœ€è¦ä¹˜ä»¥3ï¼Ÿvarchar(16) utf8çš„è¯ï¼Œåº”è¯¥æ˜¯16*3<br>3.å¦‚æœæœ‰å¤šä¸ªLEFT JOINçš„æƒ…å†µä¸‹è®¡ç®—é•¿åº¦è¿˜æ˜¯æ ¹æ®selectä¸­çš„å­—æ®µæ¥è®¡ç®—å—ï¼Ÿ<br>sqlå¦‚ä¸‹ï¼š<br>select <br>       a.*<br>       b.c1<br>       b.c2<br>       b.c3<br>       c.c1<br>   from a<br>   LEFT JOIN b on a.id and b.id<br>   LEFT JOIN c on a.id and c.id<br>   where a.c1 !=0 and a.c2 =0 and a.c3=1 order by c4 desc,id limit 10;<br>aè¡¨éƒ¨åˆ†ddlå¦‚ä¸‹ï¼š<br>c1 decimal(10,2) NOT NULL DEFAULT &#39;0.00&#39;,<br>c2 int(11) NOT NULL DEFAULT &#39;0&#39;<br>c3 int(11) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;1,0&#39;<br>PRIMARY KEY (`id`)<br>key idx_c1(c1)<br>key idx_c4(c4)<br><br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442025,"discussion_content":"1. å…¶å®å°±æ˜¯â€œè¦æ”¾åˆ°sort_bufferä¸­çš„å­—æ®µä»¬â€\n2. å¯¹ï¼Œè¦*3\n3. æŒ‰é¡ºåºçœ‹ã€‚ç¬¬ä¸€ä¸ªjionæ˜¯a.*, ç¬¬äºŒä¸ªjoinæ˜¯a.*+b.c1/c2/c3","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552724313,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70838,"user_name":"é»„æ˜æ©","can_delete":false,"product_type":"c1","uid":1119409,"ip_address":"","ucode":"EF75C8BFA14D17","user_header":"https://static001.geekbang.org/account/avatar/00/11/14/b1/7d974f0a.jpg","comment_is_top":false,"comment_ctime":1551192411,"is_pvip":false,"replies":[{"id":"25336","content":"å› ä¸ºè¦æ”¹æˆ3ï¼Œè€Œä¸”å€¼åˆšå¥½ä¹Ÿæ˜¯3ï¼Œè®¤ä¸ºæ²¡æœ‰â€œæ”¹å˜â€å€¼","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1551194157,"ip_address":"","comment_id":70838,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551192411","product_id":100020801,"comment_content":"è€å¸ˆï¼Œä¸ºä»€ä¹ˆå›¾13é‡Œé¢çš„session aé‡Œæ‰§è¡Œäº†updateä¹‹åæ˜¾ç¤ºrow affectæ˜¯0å‘¢ï¼Œæ—¢ç„¶å®ƒåšäº†æ›´æ–°æ“ä½œï¼Œå½±å“è¡Œæ•°ä¸åº”è¯¥æ˜¯1å—","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440855,"discussion_content":"å› ä¸ºè¦æ”¹æˆ3ï¼Œè€Œä¸”å€¼åˆšå¥½ä¹Ÿæ˜¯3ï¼Œè®¤ä¸ºæ²¡æœ‰â€œæ”¹å˜â€å€¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551194157,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68523,"user_name":"å¤§ç¥ä»™","can_delete":false,"product_type":"c1","uid":1151944,"ip_address":"","ucode":"8179D170A97936","user_header":"https://static001.geekbang.org/account/avatar/00/11/93/c8/9eb6c644.jpg","comment_is_top":false,"comment_ctime":1550538749,"is_pvip":false,"replies":[{"id":"24403","content":"è¿™ä¸ªé—®é¢˜æˆ‘getä¸åˆ°ç‚¹ï¼Œè¦å…·ä½“ä¸€ç‚¹å“ˆ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1550580010,"ip_address":"","comment_id":68523,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550538749","product_id":100020801,"comment_content":"è€å¸ˆï¼Œmysql5.6åˆ†é¡µæ—¶ï¼Œå› å †æ’åºé—®é¢˜é€ æˆçš„æ•°æ®é‡å¤ã€‚æˆ‘çœ‹é˜¿é‡Œçš„mysqlæ•°æ®åº“å†…æ ¸æœˆæŠ¥é‡Œè®²è¦æŒ‰ç…§ç´¢å¼•æ’åºï¼Œé‚£ä¹ˆåªè¦åˆ†é¡µä»¥åéƒ½æ˜¯è¦åŠ order by indexä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439718,"discussion_content":"è¿™ä¸ªé—®é¢˜æˆ‘getä¸åˆ°ç‚¹ï¼Œè¦å…·ä½“ä¸€ç‚¹å“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550580010,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65273,"user_name":"frogman","can_delete":false,"product_type":"c1","uid":1217671,"ip_address":"","ucode":"7FD604453F3D80","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIMbD2JxmlwPeibyCJUu8AthDu8Ze7ABibWTBRya5qibLcqrfEWOpo7j8iclyIT9CqowribV8ewQ0XausQ/132","comment_is_top":false,"comment_ctime":1549182335,"is_pvip":false,"replies":[{"id":"23162","content":"ä½ çš„ç†è§£å¯¹çš„ã€‚<br><br>æˆ‘ä»¬åé¢æœ‰ä¸€ç¯‡ä¼šè®²åˆ°group by ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1549202650,"ip_address":"","comment_id":65273,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1549182335","product_id":100020801,"comment_content":"ä½ å¥½ï¼Œä¸çŸ¥é“å¯å¦è®²ä¸€ä¸‹ Group By æ€æ ·è¿ç”¨ç´¢å¼•æ¥ä¼˜åŒ–å‘¢ï¼Ÿæ–‡æ¡£è¯´åªæœ‰ MIN å’Œ MAX çš„æƒ…å†µä¸‹ç´¢å¼•æ‰èƒ½æé«˜æ•ˆç‡ï¼Œä½†æ˜¯æˆ‘è®¤ä¸º COUNT åº”è¯¥ä¹Ÿè¡Œå§ã€‚å¦‚ select name count(*) from table where name=$name group by address; å¦‚æœå»ºç«‹ id å’Œ name çš„è”åˆç´¢å¼•ï¼Œæ•ˆç‡ä¼šæé«˜å—ã€‚","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438382,"discussion_content":"ä½ çš„ç†è§£å¯¹çš„ã€‚\n\næˆ‘ä»¬åé¢æœ‰ä¸€ç¯‡ä¼šè®²åˆ°group by ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549202650,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":64597,"user_name":"Crayon","can_delete":false,"product_type":"c1","uid":1391055,"ip_address":"","ucode":"C15C899DF34B85","user_header":"","comment_is_top":false,"comment_ctime":1548832831,"is_pvip":false,"replies":[{"id":"22876","content":"è¯•ä¸‹ï¼Œæ˜¯ä¸æ˜¯å…¶å®ä½ ä¸åŠ limitåè€Œä¼šç”¨ç´¢å¼•","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1548834277,"ip_address":"","comment_id":64597,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548832831","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹å¯¹äºè¯„è®ºåŒºä¸­çš„æ— æ¡ä»¶æ’åºé—®é¢˜ï¼ŒçŸ¥é“äº†èµ°ç´¢å¼•å’Œä¸èµ°ç´¢å¼•çš„ä¸¤ç§æƒ…å†µã€‚<br><br>åœ¨æˆ‘çš„æµ‹è¯•ä¸­ï¼Œæ— æ¡ä»¶å¤šå­—æ®µæ’åºï¼Œå³ä½¿åŠ äº†LIMITï¼Œä¹Ÿä¼šèµ°å…¨è¡¨æ‰«æï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ã€‚æ’åºçš„å­—æ®µä»¬éƒ½åŠ äº†æ™®é€šç´¢å¼•","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438091,"discussion_content":"è¯•ä¸‹ï¼Œæ˜¯ä¸æ˜¯å…¶å®ä½ ä¸åŠ limitåè€Œä¼šç”¨ç´¢å¼•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548834277,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63925,"user_name":"è¿‡å»ã€ä»Šæ—¥","can_delete":false,"product_type":"c1","uid":1097197,"ip_address":"","ucode":"8E171203B06513","user_header":"https://static001.geekbang.org/account/avatar/00/10/bd/ed/95e8a314.jpg","comment_is_top":false,"comment_ctime":1548598466,"is_pvip":false,"replies":[{"id":"22625","content":"api_formç´¢å¼•ä¸ºapp_keyã€modified <br>æ˜¯è”åˆç´¢å¼•å—ï¼Œå¦‚æœæ˜¯å¯ä»¥forceä¸€ä¸‹è¿™ä¸ªç´¢å¼•<br><br>ä½ è¿˜æ˜¯ä¸¤ä¸ªè¡¨ï¼ˆè„±æ•åï¼‰å‘ä¸€ä¸‹è¡¨ç»“æ„ï¼Œè¿˜æœ‰è¿™ä¸ªè¯­å¥explainçš„ç»“æœ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1548636484,"ip_address":"","comment_id":63925,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548598466","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼å¤§æ¦‚æ˜¯è¿™æ ·å­çš„ï¼Œappè¡¨çš„æ•°æ®é‡æ˜¯10wï¼Œapi_formçš„æ•°æ®é‡å¤§æ¦‚50wä»¥åè¿˜æ˜¯å¢åŠ ï¼Œappè¡¨çš„ç´¢å¼•ä¸ºapp_key,api_formç´¢å¼•ä¸ºapp_keyã€modifiedã€‚ä½†æ˜¯ä»æ‰§è¡Œè®¡åˆ’ä¸Šçœ‹Extraçš„å€¼ä¸ºUsing where Using fileSort<br>    select * from app t1,api_form t2 where t1.app_key=t2.app_key and t2.status=1 order by t2.modified","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437764,"discussion_content":"api_formç´¢å¼•ä¸ºapp_keyã€modified \næ˜¯è”åˆç´¢å¼•å—ï¼Œå¦‚æœæ˜¯å¯ä»¥forceä¸€ä¸‹è¿™ä¸ªç´¢å¼•\n\nä½ è¿˜æ˜¯ä¸¤ä¸ªè¡¨ï¼ˆè„±æ•åï¼‰å‘ä¸€ä¸‹è¡¨ç»“æ„ï¼Œè¿˜æœ‰è¿™ä¸ªè¯­å¥explainçš„ç»“æœ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548636484,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63891,"user_name":"è¿‡å»ã€ä»Šæ—¥","can_delete":false,"product_type":"c1","uid":1097197,"ip_address":"","ucode":"8E171203B06513","user_header":"https://static001.geekbang.org/account/avatar/00/10/bd/ed/95e8a314.jpg","comment_is_top":false,"comment_ctime":1548580595,"is_pvip":false,"replies":[{"id":"22601","content":"è´´ä¸€ä¸‹ä½ è¿™ä¸¤ä¸ªè¡¨çš„è¡¨ç»“æ„ï¼Œå’Œexplainçš„ç»“æœã€‚<br>è¿™ä¸ªè¯­å¥è¦æ²¡æœ‰filesortçš„è¯ï¼Œéœ€è¦t1å½“é©±åŠ¨è¡¨ï¼Œå¹¶ä¸”t1 æœ‰ï¼ˆid, createdï¼‰è”åˆç´¢å¼•","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1548594016,"ip_address":"","comment_id":63891,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548580595","product_id":100020801,"comment_content":"è€å¸ˆæœ‰ä¸ªé—®é¢˜<br>select * from a t1,b t2 where t1.id = t2.id order by t1.created <br>å³æ—¶aè¡¨å’Œbè¡¨éƒ½åˆ›å»ºäº†ç´¢å¼•ï¼Œä½†æ˜¯é€šè¿‡æ‰§è¡Œè®¡åˆ’çœ‹éƒ½æ˜¯using filesort","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437751,"discussion_content":"è´´ä¸€ä¸‹ä½ è¿™ä¸¤ä¸ªè¡¨çš„è¡¨ç»“æ„ï¼Œå’Œexplainçš„ç»“æœã€‚\nè¿™ä¸ªè¯­å¥è¦æ²¡æœ‰filesortçš„è¯ï¼Œéœ€è¦t1å½“é©±åŠ¨è¡¨ï¼Œå¹¶ä¸”t1 æœ‰ï¼ˆid, createdï¼‰è”åˆç´¢å¼•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548594016,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62926,"user_name":"Wesley","can_delete":false,"product_type":"c1","uid":1359325,"ip_address":"","ucode":"187A0185A2D3FD","user_header":"https://static001.geekbang.org/account/avatar/00/14/bd/dd/4620ba79.jpg","comment_is_top":false,"comment_ctime":1548208402,"is_pvip":false,"replies":[{"id":"22259","content":"ç»™ä¸€ä¸‹ä½ çš„å¤ç°æ­¥éª¤å“ˆï¼Œä¸å¤ªå¯èƒ½â€œæ°¸è¿œä¸€æ ·çš„â€","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1548225185,"ip_address":"","comment_id":62926,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548208402","product_id":100020801,"comment_content":"è¡¨Tæœ‰id name city age ä¸‰åˆ—ï¼Œå¯¹nameï¼Œcityä¸¤åˆ—åšè”åˆç´¢å¼•ã€‚<br>æ‰§è¡Œexplain select nameï¼Œcity from T where name like â€˜%â€™ and city =â€˜BJâ€™ order by name limit 10ï¼›rowsçš„å€¼æ°¸è¿œéƒ½å’Œlimitçš„å€¼ä¸€æ ·ã€‚è™½ç„¶rowsæ˜¯é¢„ä¼°çš„å€¼ï¼Œä½†æ˜¯ä¹Ÿä¸ä¼šæ¯æ¬¡å’Œè¦limitçš„å€¼ä¸€æ ·å§","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437405,"discussion_content":"ç»™ä¸€ä¸‹ä½ çš„å¤ç°æ­¥éª¤å“ˆï¼Œä¸å¤ªå¯èƒ½â€œæ°¸è¿œä¸€æ ·çš„â€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548225185,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56818,"user_name":"felix","can_delete":false,"product_type":"c1","uid":1086157,"ip_address":"","ucode":"DF514D0BB9B508","user_header":"https://static001.geekbang.org/account/avatar/00/10/92/cd/d39e568c.jpg","comment_is_top":false,"comment_ctime":1546564163,"is_pvip":false,"replies":[{"id":"20478","content":"æ²¡æœ‰ä¸€å®šè¦é…åˆç´¢å¼•å“¦<br><br>ä¸‹ä¸€ç¯‡æœ‰è®²åˆ°ä¸€ä¸ªlimit æ’åºä¼˜åŒ–","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546565919,"ip_address":"","comment_id":56818,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546564163","product_id":100020801,"comment_content":"MySQLå¯¹limitæœ‰ä»€ä¹ˆä¼˜åŒ–å—ï¼Ÿæ˜¯åªèƒ½é…åˆç´¢å¼•ä½¿ç”¨å—ï¼Ÿè°¢è°¢","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435254,"discussion_content":"æ²¡æœ‰ä¸€å®šè¦é…åˆç´¢å¼•å“¦\n\nä¸‹ä¸€ç¯‡æœ‰è®²åˆ°ä¸€ä¸ªlimit æ’åºä¼˜åŒ–","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546565919,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56479,"user_name":"åˆ˜ä¼šä¿Š","can_delete":false,"product_type":"c1","uid":1065775,"ip_address":"","ucode":"DFC7B41EA6AF57","user_header":"https://static001.geekbang.org/account/avatar/00/10/43/2f/4ff46e78.jpg","comment_is_top":false,"comment_ctime":1546475900,"is_pvip":false,"replies":[{"id":"20363","content":"<br>æŠŠé—®é¢˜æè¿°æ¸…æ¥šå¤§å®¶å°±å…±åŒå­¦ä¹ åˆ°å•¦ğŸ˜„<br>ğŸ¤","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546481025,"ip_address":"","comment_id":56479,"utype":1}],"discussion_count":2,"race_medal":2,"score":"1546475900","product_id":100020801,"comment_content":"æ¥ä¸Šä¸€æ¬¡çš„ç•™è¨€ã€‚è°¢è°¢è€å¸ˆçš„å›å¤ï¼Œæ˜¨å¤©æ‰¾åˆ°åŸå› äº†ï¼Œå› ä¸ºæˆ‘é€ çš„æ€»æ•°æ®åªæœ‰6æ¡ï¼Œä½¿ç”¨select city,name,age from t where city=&#39;æ­å·&#39; order by name limit 1000çš„æ—¶å€™ï¼Œä½¿ç”¨explainåˆ†æçš„ç»“æœä¸­ï¼Œtypeä¸ºALLï¼Œä¼˜åŒ–å™¨è®¤ä¸º6æ¡æ•°æ®èµ°å…¨è¡¨æ‰«ææ¯”ç”¨cityç´¢å¼•å†å›è¡¨çš„æ–¹å¼å¿«ï¼Œæ‰€ä»¥æ²¡æœ‰èµ°cityç´¢å¼•ï¼Œçœ‹åˆ°çš„ç»“æœé‡Œexamined_rowså°±æ˜¯æ€»çš„6æ¡æ•°æ®äº†ï¼Œæˆ‘ç”¨äº†force index(city)ç»“æœå°±è·Ÿæ‚¨çš„ä¸€æ ·äº†ã€‚ä¸å¥½æ„æ€è€å¸ˆï¼Œæˆ‘æ˜¯ä¸ªå¼€å‘ï¼Œæ•°æ®åº“çš„ä¸€äº›å‚æ•°å’ŒçŸ¥è¯†ä¸å¤ªç†Ÿæ‚‰ï¼Œæäº†ä¸€äº›å¼±æ™ºé—®é¢˜è¯·æ‚¨è§è°…ã€‚","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435061,"discussion_content":"\næŠŠé—®é¢˜æè¿°æ¸…æ¥šå¤§å®¶å°±å…±åŒå­¦ä¹ åˆ°å•¦ğŸ˜„\nğŸ¤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546481025,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1386818,"avatar":"https://static001.geekbang.org/account/avatar/00/15/29/42/43d4b1a8.jpg","nickname":"çƒ«çƒ«çƒ«","note":"","ucode":"C06018670DE76A","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":319112,"discussion_content":"æ²¡äº‹ï¼Œå¤§å®¶éƒ½æ˜¯å¼±æ™ºï¿½ï¿½ï¿½ï¿½ï¿½ï¿½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603945103,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56289,"user_name":"åˆ˜ä¼šä¿Š","can_delete":false,"product_type":"c1","uid":1065775,"ip_address":"","ucode":"DFC7B41EA6AF57","user_header":"https://static001.geekbang.org/account/avatar/00/10/43/2f/4ff46e78.jpg","comment_is_top":false,"comment_ctime":1546416649,"is_pvip":false,"replies":[{"id":"20261","content":"å“ªä¸ªæŸ¥è¯¢è¯­å¥â€¦","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546421928,"ip_address":"","comment_id":56289,"utype":1}],"discussion_count":1,"race_medal":2,"score":"1546416649","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæˆ‘ä½¿ç”¨é‚£ä¸€æ¡å»ºè¡¨è¯­å¥å’ŒæŸ¥è¯¢è¯­å¥ï¼Œæœ€åä½¿ç”¨explainå¾—å‡ºçš„ç»“æœæ˜¯using whereï¼›using filesortï¼Œç„¶åæˆ‘å‘ç°select * from information_schema.optimizer_trace\\G;å¾—åˆ°çš„ç»“æœæ˜¯ <br>&quot;filesort_summary&quot;: {<br>              &quot;rows&quot;: 4,<br>              &quot;examined_rows&quot;: 6,<br>              &quot;number_of_tmp_files&quot;: 0,<br>              &quot;sort_buffer_size&quot;: 71880,<br>              &quot;sort_mode&quot;: &quot;&lt;sort_key, packed_additional_fields&gt;&quot;<br>            }<br>è¡¨é‡Œåªæœ‰4æ¡ç¬¦åˆçš„æ•°æ®ï¼Œæˆ‘æ²¡ææ‡‚ä¸ºä»€ä¹ˆexamined_rowsæ˜¯6ï¼Œå› ä¸º6æ˜¯æ€»æ•°æ®é‡ä¸º6æ¡ã€‚","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434976,"discussion_content":"å“ªä¸ªæŸ¥è¯¢è¯­å¥â€¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546421928,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55646,"user_name":"è¿‡å»ã€ä»Šæ—¥","can_delete":false,"product_type":"c1","uid":1097197,"ip_address":"","ucode":"8E171203B06513","user_header":"https://static001.geekbang.org/account/avatar/00/10/bd/ed/95e8a314.jpg","comment_is_top":false,"comment_ctime":1546251939,"is_pvip":false,"replies":[{"id":"20086","content":"å¥½é—®é¢˜<br><br>ä¸èƒ½å“¦ï¼Œå¹¶å‘èµ·æ¥çš„æ—¶å€™å†…å­˜å ç”¨è¿‡å¤§ï¼Œä¼šåˆ°è‡ªå·±ç³»ç»ŸOOMçš„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546259376,"ip_address":"","comment_id":55646,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546251939","product_id":100020801,"comment_content":"è¿›è¡Œæ’åºåçš„ä¸´æ—¶æ–‡ä»¶åˆ†æˆå‡ ä»½æ˜¯å’Œsort_buffer_sizeæœ‰å…³ï¼Œé‚£æ•°æ®åº“è®¾ç½®è¿™ä¸ªå€¼ä¼šä¸ä¼šè¶Šå¤§è¶Šå¥½ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434820,"discussion_content":"å¥½é—®é¢˜\n\nä¸èƒ½å“¦ï¼Œå¹¶å‘èµ·æ¥çš„æ—¶å€™å†…å­˜å ç”¨è¿‡å¤§ï¼Œä¼šåˆ°è‡ªå·±ç³»ç»ŸOOMçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546259376,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55032,"user_name":"å´é¸¿è¾¾","can_delete":false,"product_type":"c1","uid":1306185,"ip_address":"","ucode":"5C4C39C212103D","user_header":"https://static001.geekbang.org/account/avatar/00/13/ee/49/8c1e831f.jpg","comment_is_top":false,"comment_ctime":1546005731,"is_pvip":false,"replies":[{"id":"19960","content":"é¢æ„Ÿè§‰ä½ çŸ¥é“äº›ä»€ä¹ˆğŸ˜„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546008246,"ip_address":"","comment_id":55032,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546005731","product_id":100020801,"comment_content":"æ³¢æ³¢å¯æ˜¯ç™¾åº¦dbağŸ˜","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434655,"discussion_content":"é¢æ„Ÿè§‰ä½ çŸ¥é“äº›ä»€ä¹ˆğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546008246,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54621,"user_name":"J!","can_delete":false,"product_type":"c1","uid":1305003,"ip_address":"","ucode":"71C946119B59D1","user_header":"https://static001.geekbang.org/account/avatar/00/13/e9/ab/37903736.jpg","comment_is_top":false,"comment_ctime":1545916592,"is_pvip":false,"replies":[{"id":"19820","content":"ç´¢å¼•å…¨è¡¨æ˜¯ä»€ä¹ˆæ„æ€","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545919908,"ip_address":"","comment_id":54621,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545916592","product_id":100020801,"comment_content":"order by ä¸»é”® desc limit 1ä¹Ÿä¼šç´¢å¼•å…¨è¡¨ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434515,"discussion_content":"ç´¢å¼•å…¨è¡¨æ˜¯ä»€ä¹ˆæ„æ€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545919908,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52893,"user_name":"Ivan","can_delete":false,"product_type":"c1","uid":1302381,"ip_address":"","ucode":"57090A053A247F","user_header":"https://static001.geekbang.org/account/avatar/00/13/df/6d/44cf0de4.jpg","comment_is_top":false,"comment_ctime":1545548349,"is_pvip":false,"replies":[{"id":"19202","content":"å¯¹ï¼Œè¦æ”¹æˆriw","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545561245,"ip_address":"","comment_id":52893,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545548349","product_id":100020801,"comment_content":"è€å¸ˆï¼Œä½ çš„è§£ç­”ä¸ŠæœŸç–‘é—®çš„ä¾‹å­é‡Œï¼Œäº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘çš„æ˜¯ READ COMMITTEDï¼ŒBINLOG_FORMAT = STATEMENT è¿™æ ·è®¾ç½®åæŠ¥é”™ERROR 1665 ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433996,"discussion_content":"å¯¹ï¼Œè¦æ”¹æˆriw","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545561245,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52703,"user_name":"TiTi","can_delete":false,"product_type":"c1","uid":1127343,"ip_address":"","ucode":"58F19596A1EF4C","user_header":"https://static001.geekbang.org/account/avatar/00/11/33/af/dda311cf.jpg","comment_is_top":false,"comment_ctime":1545481705,"is_pvip":false,"replies":[{"id":"19170","content":"ç¬¬äºŒç§æ–¹æ³•ä¸€èˆ¬ç”¨å¾—å¾ˆå°‘ï¼Œé™¤éè¯´ä¸šåŠ¡æ˜ç¡®ï¼Œå°±æ˜¯è¿™ä¸ªè¯·æ±‚å°±æ˜¯ç‰¹åˆ«é«˜é¢‘","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545489797,"ip_address":"","comment_id":52703,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545481705","product_id":100020801,"comment_content":"ä¸ªäººæœ¬å°èŠ‚å­¦ä¹ æ€»ç»“ï¼š<br>å½“éœ€è¦æ’åºçš„å­—æ®µæ— æ³•é€šè¿‡ç´¢å¼•æŸ¥æ‰¾ç›´æ¥å®Œæˆæ—¶ï¼ŒMySQLä¼šä¸ºæ’åºåˆ†é…ä¸€å—å†…å­˜(sort buffer)ã€‚è¯¥bufferçš„å¤§å°å¯ä»¥é€šè¿‡å‚æ•°sort_buffer_sizeæ¥è®¾ç½®ã€‚MySQLéµå¾ªâ€œå¤šåˆ©ç”¨å†…å­˜ï¼Œå°½é‡å‡å°‘ç£ç›˜è®¿é—®â€çš„è®¾è®¡åŸåˆ™ã€‚å½“sort bufferä¸è¶³ä»¥å®Œæˆéœ€è¦çš„æ’åºæ—¶ï¼ŒMySQLä¼šåˆ©ç”¨ç£ç›˜ä¸´æ—¶æ–‡ä»¶æ¥è¾…åŠ©æ’åº(ä½¿ç”¨å½’å¹¶æ’åºç®—æ³•)ã€‚<br>é€šè¿‡è®¾ç½®max_length_for_sort_dataå‚æ•°å¯ä»¥è®©MySQLè°ƒæ•´æ’åºæ—¶æ‰€ç”¨çš„ç®—æ³•ï¼š<br><br>1ï¼‰ å½“éœ€è¦è¿”å›çš„å­—æ®µç»„çš„å¤§å°å°äºè®¾å®šçš„max_length_for_sort_dataå‚æ•°æ—¶ï¼ŒMySQLæ‰§è¡Œçš„æ˜¯å…¨å­—æ®µæ’åºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒMySQLä¼šå…ˆæ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„ã€åŒ…å«æ‰€æœ‰selectå­—æ®µçš„æ‰€æœ‰è®°å½•ï¼Œå°†å®ƒä»¬æ”¾åˆ°sort buffer(æˆ–æ˜¯ç£ç›˜ä¸´æ—¶è¾…åŠ©æ–‡ä»¶)ä¸­ï¼Œç„¶åæ‰§è¡Œæ’åºï¼Œå†è¿”å›æ’åºåçš„ç»“æœï¼›<br><br>2ï¼‰ å½“éœ€è¦è¿”å›çš„å­—æ®µç»„çš„å¤§å°å¤§äºè®¾å®šçš„max_length_for_sort_dataå‚æ•°æ—¶ï¼ŒMySQLæ‰§è¡Œçš„æ˜¯rowidæ’åºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ”¾åˆ°sort buffer(æˆ–ç£ç›˜ä¸´æ—¶è¾…åŠ©æ–‡ä»¶)ä¸­çš„æ•°æ®è®°å½•åªåŒ…å«row idå’Œéœ€è¦æ’åºçš„å­—æ®µï¼Œæ’å®Œåºåï¼Œå†æ ¹æ®æ’åºåçš„ç»“æœrow idå›åˆ°ä¸»è¡¨å–å‡ºç›¸åº”çš„å…¶å®ƒè¦æ±‚è¿”å›çš„å­—æ®µå€¼ï¼Œå†è¿”å›ç»™è°ƒç”¨æ–¹ã€‚è¿™ç§æƒ…å†µä¸‹ä¼šå¤šå‡ºå›ä¸»è¡¨æŸ¥å…¶å®ƒå­—æ®µæ•°æ®çš„è¿‡ç¨‹ã€‚<br><br>æ€è€ƒé¢˜çš„æƒ³æ³•ï¼š<br>1) å¯ä»¥åœ¨ä¸šåŠ¡ç«¯åˆ†åˆ«åšä¸¤æ¬¡æŸ¥è¯¢ï¼ŒæŸ¥å‡ºæ­å·å’Œè‹å·çš„å„100æ¡è®°å½•ï¼Œç„¶åå†åœ¨ä¸šåŠ¡ç«¯æ’åºï¼Œå¾—åˆ°è¿™200æ¡è®°å½•ä¸­çš„å‰100æ¡ï¼›<br>2) ç”±äºæœ‰åˆ†é¡µéœ€æ±‚ï¼ŒåŠ ä¸Šå¸‚æ°‘è¡¨ä¸ä¼šé¢‘ç¹æ›´æ–°ï¼Œæˆ‘ä¼šå•ç‹¬åˆ›ä¸€å¼ è¡¨å­˜æ”¾æ­å·å’Œè‹å·çš„å¸‚æ°‘ä¿¡æ¯ï¼Œç»™è¿™å¼ è¡¨å»ºç«‹nameåˆ—ä¸Šçš„ç´¢å¼•ï¼Œæ¥æ»¡è¶³åˆ†é¡µçš„ä¸šåŠ¡éœ€æ±‚ã€‚æ–¹æ³•ç¬¨æ˜¯ç¬¨äº†ç‚¹ï¼Œä½†æ˜¯ç®€å•ã€é«˜æ•ˆã€‚ä½†æ˜¯å¦‚æœä¸šåŠ¡ä¸Šè¿˜æœ‰å¾ˆå¤šç§å…¶å®ƒä¸åŒåŸå¸‚çš„ç»„åˆéœ€æ±‚æ—¶ï¼Œè¿™ç§æ–¹æ³•å°±ä¸å¤ªçµæ´»äº†ã€‚<br><br>æœ›è€å¸ˆèµæ•™!","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433952,"discussion_content":"ç¬¬äºŒç§æ–¹æ³•ä¸€èˆ¬ç”¨å¾—å¾ˆå°‘ï¼Œé™¤éè¯´ä¸šåŠ¡æ˜ç¡®ï¼Œå°±æ˜¯è¿™ä¸ªè¯·æ±‚å°±æ˜¯ç‰¹åˆ«é«˜é¢‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545489797,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52606,"user_name":"ä¸äºŒ","can_delete":false,"product_type":"c1","uid":1140951,"ip_address":"","ucode":"1E1527C71FD9DB","user_header":"https://static001.geekbang.org/account/avatar/00/11/68/d7/714c3d89.jpg","comment_is_top":false,"comment_ctime":1545451651,"is_pvip":false,"replies":[{"id":"19159","content":"ä¼°ç®—å€¼æ²¡è€ƒè™‘limit ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545459007,"ip_address":"","comment_id":52606,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545451651","product_id":100020801,"comment_content":"ä¸ºå•¥å›¾9å’Œå›¾10çš„rowsè¿˜æ˜¯4000ï¼Œä¸æ˜¯åªæ‰«æ1000è¡Œå—","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433919,"discussion_content":"ä¼°ç®—å€¼æ²¡è€ƒè™‘limit ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545459007,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52530,"user_name":"hlong0001","can_delete":false,"product_type":"c1","uid":1303016,"ip_address":"","ucode":"68834B187860EF","user_header":"https://static001.geekbang.org/account/avatar/00/13/e1/e8/b1f5675d.jpg","comment_is_top":false,"comment_ctime":1545407196,"is_pvip":false,"replies":[{"id":"19150","content":"å¥½ï¼Œè®°ä¸‹äº†ğŸ˜„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545410405,"ip_address":"","comment_id":52530,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545407196","product_id":100020801,"comment_content":"å¾ˆå¸Œæœ›è€å¸ˆè®²è®²group byåŸç†","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433901,"discussion_content":"å¥½ï¼Œè®°ä¸‹äº†ğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545410405,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52439,"user_name":"HuaMax","can_delete":false,"product_type":"c1","uid":1118488,"ip_address":"","ucode":"2E78DE1AF098AF","user_header":"https://static001.geekbang.org/account/avatar/00/11/11/18/8cee35f9.jpg","comment_is_top":false,"comment_ctime":1545382588,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545382588","product_id":100020801,"comment_content":"å‰ä¸¤ä¸ªé—®é¢˜æˆ‘å’Œå¤§å®¶çš„æ€è·¯å·®ä¸å¤šã€‚å¯¹äºåˆ†é¡µçš„æƒ…å†µï¼Œæˆ‘çš„ç†è§£æ˜¯ä»ä¸¤ä¸ªæœ‰åºçš„é•¿åº¦ä¸º10100çš„æ•°ç»„ä¸­å–å‡ºç¬¬10001ï½10100é¡ºåºä½çš„æ•°æ®ï¼Œå¼•æ“å±‚åœ¨å†…å­˜é‡Œåº”è¯¥å°±å¯ä»¥å®Œæˆï¼Œä»ç´¢å¼•æ ‘é‡Œåˆ†åˆ«å–å‡ºæ­å·å’Œè‹å·çš„å‰10100æ¡çš„nameå’Œidï¼Œæ¯”è¾ƒnameæ‰¾åˆ°ç¬¬10001ï½10100é¡ºåºä½çš„idå†å›è¡¨å³å¯","like_count":0},{"had_liked":false,"id":52432,"user_name":"HuaMax","can_delete":false,"product_type":"c1","uid":1118488,"ip_address":"","ucode":"2E78DE1AF098AF","user_header":"https://static001.geekbang.org/account/avatar/00/11/11/18/8cee35f9.jpg","comment_is_top":false,"comment_ctime":1545381655,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545381655","product_id":100020801,"comment_content":"@è€æ¨åŒå¿— ä½ çš„2bçš„æ–¹æ¡ˆæ„Ÿè§‰ä¸å¤ªå¯¹ï¼Œé‡Œé¢ä¸¤ä¸ªå­æŸ¥è¯¢limit 100å¹¶ä¸æ˜¯æŒ‰ç…§nameå­—æ®µæ’åºå–çš„å‰100æ¡å§","like_count":0},{"had_liked":false,"id":52403,"user_name":"åŠ›æŒ½ç‹‚æ¾œçˆ†ç‚¸è¾“å‡ºçš„è‡­è‡­å®","can_delete":false,"product_type":"c1","uid":1155904,"ip_address":"","ucode":"E8D26181129BCA","user_header":"https://static001.geekbang.org/account/avatar/00/11/a3/40/e0df3b84.jpg","comment_is_top":false,"comment_ctime":1545376171,"is_pvip":false,"replies":[{"id":"19063","content":"å—¯ï¼Œæœ‰é“ç†ï¼Œå¥½çš„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545380022,"ip_address":"","comment_id":52403,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545376171","product_id":100020801,"comment_content":"è€å¸ˆä¸‹æ¬¡å¯ä¸å¯ä»¥æŠŠæµ‹è¯•ç”¨çš„æ•°æ®ä¹Ÿå‘å‡ºæ¥ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨æœ¬åœ°éªŒè¯çš„æ—¶å€™ä¸éœ€è¦è‡ªå·±æ„é€ æ•°æ®äº†ï¼šï¼‰","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433861,"discussion_content":"å—¯ï¼Œæœ‰é“ç†ï¼Œå¥½çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545380022,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52305,"user_name":"LeonğŸ“·","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1545360589,"is_pvip":false,"replies":[{"id":"19019","content":"é¢ï¼Œè¿™ä¸ªrowsæ˜¯â€œæ»¡è¶³æ¡ä»¶çš„è¡Œâ€ï¼Œå®é™…æ‰§è¡Œå°±æ‰«åˆ°1000å°±åœäº†","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545364566,"ip_address":"","comment_id":52305,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545360589","product_id":100020801,"comment_content":"è€å¸ˆï¼ŒåŠ äº†ç´¢å¼•ä¸ºä»€ä¹ˆè¿˜è¦æ‰«æ4000è¡Œï¼Œä¸åº”è¯¥æ˜¯1000è¡Œå—<br>mysql&gt; alter table t add index city_user_age(city, name, age);<br>Query OK, 0 rows affected (1.60 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt; explain select city,name,age from t where city=&#39;æ­å·&#39; order by name limit 1000  ;<br>+----+-------------+-------+------------+------+------------------------------+---------------+---------+-------+------+----------+--------------------------+<br>| id | select_type | table | partitions | type | possible_keys                | key           | key_len | ref   | rows | filtered | Extra                    |<br>+----+-------------+-------+------------+------+------------------------------+---------------+---------+-------+------+----------+--------------------------+<br>|  1 | SIMPLE      | t     | NULL       | ref  | city,city_user,city_user_age | city_user_age | 50      | const | 4000 |   100.00 | Using where; Using index |<br>+----+-------------+-------+------------+------+------------------------------+---------------+---------+-------+------+----------+--------------------------+<br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433827,"discussion_content":"é¢ï¼Œè¿™ä¸ªrowsæ˜¯â€œæ»¡è¶³æ¡ä»¶çš„è¡Œâ€ï¼Œå®é™…æ‰§è¡Œå°±æ‰«åˆ°1000å°±åœäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545364566,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52108,"user_name":"å¤å¨œæ‹‰é»‘æš—ä¹‹ç¥Â·å·´å•¦å•¦èƒ½é‡Â·å •è½è¾¾","can_delete":false,"product_type":"c1","uid":1185642,"ip_address":"","ucode":"080BBCEF7DE985","user_header":"https://static001.geekbang.org/account/avatar/00/12/17/6a/c979163e.jpg","comment_is_top":false,"comment_ctime":1545310817,"is_pvip":false,"replies":[{"id":"18911","content":"Explain å‘æ¥çœ‹çœ‹<br><br>","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545314903,"ip_address":"","comment_id":52108,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545310817","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ã€‚<br>è¯·é—®ï¼šå»ºç«‹äº†cityã€nameã€ageçš„è”åˆç´¢å¼•ä¹‹åï¼Œæ‰§è¡Œ  â€œselect city,name,age from t where city=&#39;æ­å·&#39; order by name limit 1000  ;â€ è¯­å¥ï¼Œæ˜¾ç¤ºçš„rowsï¼ˆå½±å“è¡Œæ•°ï¼‰ä¾æ—§æ˜¯4000å‘¢ï¼Ÿä¸åº”è¯¥æ˜¯1000å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433744,"discussion_content":"Explain å‘æ¥çœ‹çœ‹\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545314903,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52043,"user_name":"Goal","can_delete":false,"product_type":"c1","uid":1307012,"ip_address":"","ucode":"C337CD4C7E07B0","user_header":"https://static001.geekbang.org/account/avatar/00/13/f1/84/7d21bd9e.jpg","comment_is_top":false,"comment_ctime":1545299184,"is_pvip":false,"replies":[{"id":"18828","content":"æ²¡æœ‰ï¼Œä½¿ç”¨change bufferçš„æ—¶å€™ï¼Œæ˜¯å®Œå…¨æ²¡æœ‰æ“ä½œåˆ°è¿™ä¸ªæ™®é€šç´¢å¼•çš„é¡µé¢çš„<br><br>æ“ä½œçš„åªæ˜¯change buffer .<br><br>å½“ç„¶ï¼Œå¦‚æœä½ æŒ‡çš„â€œä¸¤æ¬¡â€ä¸€æ¬¡æ˜¯ä¸»é”®ç´¢å¼•çš„æ›´æ–°ï¼Œä¸€æ¬¡æ˜¯æ™®é€šç´¢å¼•ï¼ˆè¿™é‡Œæ˜¯change buffer), é‚£è¿™ä¸ªæ˜¯æœ‰ä¸¤æ¬¡çš„ï¼Œä½†æ˜¯è¿™ä¸ç®—é‡å¤ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545299689,"ip_address":"","comment_id":52043,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545299184","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼š<br>è¯·é—®ä¸€ä¸ªï¼šå‰é¢ redo log å’Œ change bufferçš„é—®é¢˜<br>å¦‚æœæ˜¯æ›´æ–°ï¼šå¼•æ“å°†è¿™è¡Œæ–°æ•°æ®æ›´æ–°åˆ°å†…å­˜ä¸­ï¼ŒåŒæ—¶å°†è¿™ä¸ªæ›´æ–°æ“ä½œè®°å½•åˆ° redo log é‡Œé¢ï¼Œç„¶åè¿›å…¥prepare çŠ¶æ€ï¼Œåç»­å°±æ˜¯binlogï¼Œcommitå•¦ï¼›<br><br>è€Œï¼Œå¦‚æœæ˜¯æ™®é€šç´¢å¼•çš„æ›´æ–°â€œè™½ç„¶æ˜¯åªæ›´æ–°å†…å­˜ï¼Œä½†æ˜¯åœ¨äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œæˆ‘ä»¬æŠŠ change buffer çš„æ“ä½œä¹Ÿè®°å½•åˆ° redo log é‡Œäº†ï¼Œæ‰€ä»¥å´©æºƒæ¢å¤çš„æ—¶å€™ï¼Œchange buffer ä¹Ÿèƒ½æ‰¾å›æ¥ã€‚â€<br><br>é‚£ä¹ˆè¿™æ ·ï¼Œredo log ä¸å°±é‡å¤è®°å½•äº†åŒä¸€ä¸ªæ›´æ–°çš„ä¿©æ¬¡æ“ä½œå—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433718,"discussion_content":"æ²¡æœ‰ï¼Œä½¿ç”¨change bufferçš„æ—¶å€™ï¼Œæ˜¯å®Œå…¨æ²¡æœ‰æ“ä½œåˆ°è¿™ä¸ªæ™®é€šç´¢å¼•çš„é¡µé¢çš„\n\næ“ä½œçš„åªæ˜¯change buffer .\n\nå½“ç„¶ï¼Œå¦‚æœä½ æŒ‡çš„â€œä¸¤æ¬¡â€ä¸€æ¬¡æ˜¯ä¸»é”®ç´¢å¼•çš„æ›´æ–°ï¼Œä¸€æ¬¡æ˜¯æ™®é€šç´¢å¼•ï¼ˆè¿™é‡Œæ˜¯change buffer), é‚£è¿™ä¸ªæ˜¯æœ‰ä¸¤æ¬¡çš„ï¼Œä½†æ˜¯è¿™ä¸ç®—é‡å¤ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545299689,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52033,"user_name":"è¿˜ä¸€æ£µæ ‘","can_delete":false,"product_type":"c1","uid":1317709,"ip_address":"","ucode":"C187F2A141D60E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eop9WylZJicLQxlvXukXUgPp39zJHyyReK5s1C9VhA6rric7GiarbfQMuWhdCCDdxdfL610Hc4cNkn9Q/132","comment_is_top":false,"comment_ctime":1545298075,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545298075","product_id":100020801,"comment_content":"è¯¾åé—®é¢˜ï¼š<br>1ã€æ’åºæ˜¯è‚¯å®šè¦æ’åºçš„ï¼š<br>key:KEY `iii` (`tag_id`,`puid`)<br>explain select puid  from t where tag_id in(227,228) order by puid limit 5;<br>----&gt;&gt; Using where; Using index; Using filesort<br>2ã€æ‰§è¡Œçš„è¿‡ç¨‹æ˜¯æŠŠtag_id in(227,228)çš„å…¨éƒ¨æ•°æ®å–å‡ºæ¥ å†æ’åº ï¼Œå†limit<br><br>ä¸ºå•¥mysqlçš„æ‰§è¡Œè¿‡ç¨‹ä¸æ˜¯å„å– å‰100æ¡ï¼Œ ç„¶åå¯¹è¿™200æ¡ç»“æœé›† å†æ’åºå–å‰100ï¼Œæ±‚è€å¸ˆæŒ‡ç‚¹<br>","like_count":0},{"had_liked":false,"id":52018,"user_name":"è¿˜ä¸€æ£µæ ‘","can_delete":false,"product_type":"c1","uid":1317709,"ip_address":"","ucode":"C187F2A141D60E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eop9WylZJicLQxlvXukXUgPp39zJHyyReK5s1C9VhA6rric7GiarbfQMuWhdCCDdxdfL610Hc4cNkn9Q/132","comment_is_top":false,"comment_ctime":1545295380,"is_pvip":false,"replies":[{"id":"18843","content":"1. ç»™ä¸€ä¸‹ä½ çš„å¤ç°ä¾‹å­<br><br>2. æ–‡ä¸­ä¹Ÿæ˜¯è¿™ä¹ˆè¯´çš„å“¦","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545307180,"ip_address":"","comment_id":52018,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545295380","product_id":100020801,"comment_content":"1ï¼Œæ–‡æ¡£ä¸­â€œMySQL è°ƒç”¨äº† InnoDB å¼•æ“æä¾›çš„æ¥å£â€éªŒè¯è¿™ä¸ªç»“è®ºçš„å›¾ç‰‡æ˜¯è´´é”™äº†ï¼ˆREAD-COMMITTEDã€REPEATABLE-READåˆ†åˆ«åœ¨è¿™ä¸¤ä¸ªäº‹ç‰©éš”ç¦»çº§åˆ«ä¸‹éƒ½å¯¹ä¸ä¸Šå›¾ç‰‡çš„ç»“æœï¼‰<br>MySQL è°ƒç”¨äº† InnoDB å¼•æ“æä¾›çš„æ¥<br>2ã€select ... from ... for updateå’Œupdateä¸€æ ·ï¼Œéƒ½æ˜¯å½“å‰è¯»ã€‚è€Œselect ... from ...æ˜¯ä¸€è‡´æ€§è¯»ï¼Œè¿™ä¸ªä¸€è‡´æ€§è¯»è¯»åˆ°çš„å†…å®¹å–å†³äºäº‹ç‰©çš„éš”ç¦»çº§åˆ«ï¼Œä¸åŒçš„éš”ç¦»çº§åˆ«select ... from .çš„ç»“æœä¹Ÿæ˜¯ä¸ä¸€æ ·çš„","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433700,"discussion_content":"1. ç»™ä¸€ä¸‹ä½ çš„å¤ç°ä¾‹å­\n\n2. æ–‡ä¸­ä¹Ÿæ˜¯è¿™ä¹ˆè¯´çš„å“¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545307180,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52016,"user_name":"è‚–é¹","can_delete":false,"product_type":"c1","uid":1302602,"ip_address":"","ucode":"BE1B8BD7053B9A","user_header":"https://static001.geekbang.org/account/avatar/00/13/e0/4a/c0a3cb3f.jpg","comment_is_top":false,"comment_ctime":1545294245,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545294245","product_id":100020801,"comment_content":" select * from t where city in (&#39;æ­å·&#39;,&quot; è‹å· &quot;) order by name limit 100;<br>è¿™é‡Œinäº†ä¸¤ä¸ªåŸå¸‚ï¼Œæ˜¯ä¸€ä¸ªrangeæ“ä½œï¼Œè¿™ç§æƒ…å†µä¸‹order by nameï¼Œæ˜¯èµ°ä¸äº†city,nameçš„ç´¢å¼•çš„ã€‚å¯ä»¥æ‹†æˆunion allå°±å¯ä»¥åˆ©ç”¨ç´¢å¼•æ’åºã€‚","like_count":0},{"had_liked":false,"id":51893,"user_name":"çº¦ä¹¦äºš","can_delete":false,"product_type":"c1","uid":1046714,"ip_address":"","ucode":"81EA27ADD9EC1A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg","comment_is_top":false,"comment_ctime":1545274344,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545274344","product_id":100020801,"comment_content":"å›è€å¸ˆçš„ç•™è¨€ï¼Œè¿™ä¸ªç®—æ³•ä¹Ÿæ˜¯åˆ«å¤„çœ‹æ¥çš„ï¼Œæˆ‘çš„ç†è§£æ˜¯ï¼Œ å…ˆæŸ¥è¯¢limt N&#47;K, Må¹¶ä¸æ˜¯è¯´ç»“æœä¸€å®šåœ¨è¿™ä¸ªåŒºé—´é‡Œï¼Œåªæ˜¯ç”±äºå¤§æ¦‚ç‡æ˜¯å‡åŒ€åˆ†å¸ƒçš„ï¼Œæ‰€ä»¥è¿™æ ·å–åˆ°çš„Sï¼Œå¯èƒ½æ¯”è¾ƒæ¥è¿‘å®é™…å…¨å±€offsetæ˜¯N+1çš„é‚£ä¸ªæ•°ã€‚åé¢ç¬¬äºŒæ¬¡æŸ¥è¯¢ä¼šå¯¹Sçš„å®é™…offsetåšçº æ­£ã€‚<br>","like_count":0},{"had_liked":false,"id":51851,"user_name":"çº¦ä¹¦äºš","can_delete":false,"product_type":"c1","uid":1046714,"ip_address":"","ucode":"81EA27ADD9EC1A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg","comment_is_top":false,"comment_ctime":1545270390,"is_pvip":false,"replies":[{"id":"18793","content":"æˆ‘æ„Ÿè§‰ç¬¬ä¸€æ­¥å– limit N&#47;K,M å¥½åƒä¸å¤ªå¯¹â€¦","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545271825,"ip_address":"","comment_id":51851,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545270390","product_id":100020801,"comment_content":"è¯¾åé¢˜ç¬¬ä¸‰é—®ï¼Œè®©æˆ‘æ„Ÿè§‰æœ‰äº›åƒåˆ†åº“æ¨¡å¼ä¸‹çš„ç²¾ç¡®åˆ†é¡µæ–¹æ¡ˆã€‚å‡è®¾æŸ¥è¯¢limit N, Mã€‚æ­¥éª¤å¤§æ¦‚æ˜¯ï¼š<br>1. å…ˆæŒ‰ç…§åˆ†åº“æ•°é‡Kå‡åˆ†Nã€‚è®©æ¯ä¸ªåº“éƒ½æŸ¥è¯¢limt N&#47;K, Mã€‚ï¼ˆN&#47;Kä¸æ•´å°±å‘ä¸‹å–æ•´ï¼‰<br>2. æ‰¾åˆ°æ‰€æœ‰åˆ†åº“K * Mä¸ªç»“æœä¸­æœ€å°çš„é‚£ä¸ªå€¼Sï¼Œä»¥åŠæ¯ä¸ªåˆ†åº“å¯¹åº”çš„Mä¸ªç»“æœä¸­æœ€å¤§å€¼Lk, æ¯ä¸ªåˆ†åº“æ‰§è¡Œlimit S, Lkã€‚<br>3. å°†æ‰€æœ‰è¿™äº›å€¼æ±‡æ€»ï¼Œèƒ½å¾—åˆ°Lå€¼åœ¨æ•´ä½“æ’åºä¸­çš„offsetï¼Œè¿™ä¸ªä½ç½®ä¸€å®šå°äºç­‰äºè¦å…¨å±€æŸ¥è¯¢limit N, Mçš„ç¬¬ä¸€ä¸ªå€¼çš„offsetï¼Œæ ¹æ®è¿™ä¸ªoffsetç»“åˆç¬¬äºŒæ¬¡æŸ¥è¯¢çš„æ‰€æœ‰ç»“æœï¼Œè¿›è¡Œä¸€æ¬¡ç±»ä¼¼çš„å½’å¹¶æ’åºæ“ä½œç›´åˆ°æ‰¾åˆ°ç¬¬Mä¸ªçš„ç»“æœã€‚<br>è¿™ç§éœ€è¦ä¸¤æ¬¡(2 * Kæ¬¡)æŸ¥è¯¢ã€‚è€Œä¸”è¿‡ç¨‹å¦‚æ­¤å¤æ‚ï¼Œæƒ³æƒ³å°±ææ€–ï¼Œæ­¥éª¤2æç«¯æƒ…å†µå¯èƒ½ä¼šæŸ¥å‡ºæµ·é‡æ•°æ®ã€‚å¯èƒ½åœ¨ä¸€ä¸ªåº“é‡ŒæŸ¥è¯¢èƒ½ç®€åŒ–æŸå‡ æ­¥ï¼Ÿ<br>æœ€å¥½è¿˜æ˜¯ä¸šåŠ¡è§£å†³...","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433649,"discussion_content":"æˆ‘æ„Ÿè§‰ç¬¬ä¸€æ­¥å– limit N/K,M å¥½åƒä¸å¤ªå¯¹â€¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545271825,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51829,"user_name":"å¤©ç‹","can_delete":false,"product_type":"c1","uid":1239337,"ip_address":"","ucode":"C074B2F9A5F007","user_header":"https://static001.geekbang.org/account/avatar/00/12/e9/29/629d9bb0.jpg","comment_is_top":false,"comment_ctime":1545267881,"is_pvip":false,"replies":[{"id":"18778","content":"è¿™ä¸ªä¸æ˜¯innodbåˆ‡æ¢åˆ°ï¼Œæ˜¯ä¼˜åŒ–å™¨é€‰æ‹©çš„ï¼Œå°±æ˜¯æ ¹æ®max_length_for_sort_dataè·Ÿå•è¡Œå¤§å°åˆ¤æ–­çš„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545270981,"ip_address":"","comment_id":51829,"utype":1}],"discussion_count":0,"race_medal":0,"score":"1545267881","product_id":100020801,"comment_content":"è¯·æ•™ä¸ªé—®é¢˜ innodbä¼šè‡ªåŠ¨åˆ‡æ¢rowidå’Œå…¨å­—æ®µæ’åºå—ï¼Œå¦‚æœæœ‰ï¼Œä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘ï¼Ÿ","like_count":0},{"had_liked":false,"id":51813,"user_name":"å¤©ç‹","can_delete":false,"product_type":"c1","uid":1239337,"ip_address":"","ucode":"C074B2F9A5F007","user_header":"https://static001.geekbang.org/account/avatar/00/12/e9/29/629d9bb0.jpg","comment_is_top":false,"comment_ctime":1545266450,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545266450","product_id":100020801,"comment_content":"sortæ’åºæ‰§è¡Œè¿‡ç¨‹1åˆå§‹åŒ–sort_buffer ï¼Œç¡®å®šæŠŠå“ªå‡ ä¸ªå­—æ®µæ”¾å…¥2ä»éèšé›†ç´¢å¼•æ ‘ä¸Šæ‰¾åˆ°id 3 ä»idå»èšé›†ç´¢å¼•æ‰¾åˆ°è¡Œæ•°æ®ï¼Œæ”¾åˆ°sort_biffer 4é‡å¤æ“ä½œ2å’Œ3ï¼ŒæŠŠæŸ¥è¯¢åˆ°çš„ç»“æœæ”¾å…¥soft_buffer 5å¦‚æœå†…å­˜å¤Ÿå¤§ï¼Œå†…å­˜ä¸­å¿«é€Ÿæ’åºè¿”å›ï¼Œå¦‚æœå†…å­˜ä¸å¤Ÿå¤§ï¼Œå€ŸåŠ©ä¸´æ—¶æ–‡ä»¶ï¼Œå½’å¹¶æ’åºã€‚6å¦‚æœè¡Œæ•°æ®å¤ªå¤šï¼Œå¯ä»¥å¯ç”¨rowidæ’åºï¼Œç›¸å¯¹äºå…¨å­—æ®µæ’åºï¼Œrowidæ’åºï¼Œæœ‰å›è¡¨æ“ä½œï¼Œå¦‚æœå†…å­˜å¤Ÿå¤§ï¼Œå°½é‡ç”¨å…¨å­—æ®µæ’åºã€‚","like_count":0},{"had_liked":false,"id":51806,"user_name":"å¤©ç‹","can_delete":false,"product_type":"c1","uid":1239337,"ip_address":"","ucode":"C074B2F9A5F007","user_header":"https://static001.geekbang.org/account/avatar/00/12/e9/29/629d9bb0.jpg","comment_is_top":false,"comment_ctime":1545265769,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545265769","product_id":100020801,"comment_content":"order byæ’åºï¼Œå…ˆæŠŠæŸ¥åˆ°çš„å­—æ®µæ”¾åˆ°sort_bufferï¼Œ1 å¦‚æœå­—æ®µé•¿åº¦æ²¡æœ‰è¶…è¿‡sort_buffer_size,åœ¨å†…å­˜é‡Œé¢æ’åºï¼Œ2 å¦‚æœæ’åºçš„æ•°æ®é‡è¶…è¿‡äº†sort_buffer_size,éœ€è¦å€ŸåŠ©ä¸´æ—¶æ–‡ä»¶ï¼Œå¤–éƒ¨æ–‡ä»¶æ’åºç”¨çš„å½’å¹¶æ’åºï¼Œåˆ†æˆå¤šä¸ªå°æ–‡ä»¶ï¼Œå°æ–‡ä»¶æ’å®Œä¹‹åï¼Œåˆæˆä¸€ä¸ªå¤§æ–‡ä»¶ã€‚3å¦‚æœåœ¨å‘½ä¸­çš„ç´¢å¼•æ ‘ä¸Šæœ‰æ’åºï¼Œåˆ™ä¸éœ€è¦æ’åºï¼Œç›´æ¥è·å–åˆ°æ•°æ®ã€‚4 rowidæ’åºï¼Œä¼šé™åˆ¶æ’åºçš„å­—æ®µï¼Œå¦‚æœsort_buffer_sizeå°çš„æ—¶å€™å¯ç”¨ï¼Œè¶³å¤Ÿå¤§ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼Œå› ä¸ºæ¶‰åŠï¼Œæ’åºä»¥åæ•°æ®è¦å›è¡¨ã€‚","like_count":0},{"had_liked":false,"id":51753,"user_name":"ç‹å­é¹","can_delete":false,"product_type":"c1","uid":1296763,"ip_address":"","ucode":"2B0494362E68A8","user_header":"https://static001.geekbang.org/account/avatar/00/13/c9/7b/a89761ce.jpg","comment_is_top":false,"comment_ctime":1545231639,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1545231639","product_id":100020801,"comment_content":"è¯·é—®å¤šè¡¨å…³è”æ’åºï¼Œå¦‚æœç”¨rowidç®—æ³•æ’åºï¼Œorder by çš„å­—æ®µæ²¡æœ‰èµ°ç´¢å¼•ï¼Œä¹Ÿæ˜¯ä¸€æ ·çš„æµç¨‹å—ï¼Ÿå…ˆæ’å¥½åºå†å»å–è¦selectçš„æ‰€æœ‰å­—æ®µï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":159125,"discussion_content":"æ²¡èµ°ç´¢å¼•ï¼Œé‚£å°±æ˜¯å…¨è¡¨æ‰«æäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580653477,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51701,"user_name":"way","can_delete":false,"product_type":"c1","uid":1302713,"ip_address":"","ucode":"AD1CBEBA5FDBA9","user_header":"https://static001.geekbang.org/account/avatar/00/13/e0/b9/bca7ff9a.jpg","comment_is_top":false,"comment_ctime":1545225596,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545225596","product_id":100020801,"comment_content":"æˆ‘ä¹‹å‰æµ‹è¯•è¿‡ã€‚percona Server 5.7.18ä»¥ä¸‹updateä¹‹åå¦‚æœæ²¡æœ‰æ›´æ”¹ä¸æ›´æ–°read viewã€‚ä½†æ˜¯ä»¥ä¸Šç‰ˆæœ¬ä¼šæ›´æ–°ã€‚æ˜¯ä¸ªbugå§ã€‚","like_count":0},{"had_liked":false,"id":51700,"user_name":"way","can_delete":false,"product_type":"c1","uid":1302713,"ip_address":"","ucode":"AD1CBEBA5FDBA9","user_header":"https://static001.geekbang.org/account/avatar/00/13/e0/b9/bca7ff9a.jpg","comment_is_top":false,"comment_ctime":1545225395,"is_pvip":false,"replies":[{"id":"18717","content":"æ²¡åŠæ³•ï¼Œå®ƒè‡ªå·±æ²¡æ›´æ–°ï¼Œæœ€åä¸€ä¸ªè¯­å¥æ˜¯å¿«ç…§è¯»ï¼Œ<br>é‚£å°±åªèƒ½åˆ¤æ–­è§†å›¾åˆ›å»ºçš„æ—¶é—´å’Œæ•°æ®ç‰ˆæœ¬çš„å…³ç³»<br><br>è¿™æ—¶å€™çš„ï¼ˆ1ï¼Œ3ï¼‰æ˜¯session Bç”Ÿæˆçš„ï¼ŒsessionAçœ‹ä¸åˆ°ï¼Œåªèƒ½çœ‹ä¸Šä¸€ä¸ªï¼ˆ1ï¼Œ2ï¼‰","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545230042,"ip_address":"","comment_id":51700,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545225395","product_id":100020801,"comment_content":"è€å¸ˆå¥½ã€‚ä¸ŠæœŸé—®é¢˜ä¸­ã€‚session Açš„updateè™½ç„¶æ²¡æœ‰ä¿®æ”¹match 1change 0,ä½†æ˜¯åœ¨rrä¸‹ä¸åº”è¯¥æ˜¯åšä¸€æ¬¡å½“å‰è¯»æ›´æ–°read viewä¹ˆï¼Ÿæ­¤æ—¶è¿˜è¯»åˆ°å†å²å€¼ã€‚æ˜¯ä¸æ˜¯æœ‰é—®é¢˜ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433582,"discussion_content":"æ²¡åŠæ³•ï¼Œå®ƒè‡ªå·±æ²¡æ›´æ–°ï¼Œæœ€åä¸€ä¸ªè¯­å¥æ˜¯å¿«ç…§è¯»ï¼Œ\né‚£å°±åªèƒ½åˆ¤æ–­è§†å›¾åˆ›å»ºçš„æ—¶é—´å’Œæ•°æ®ç‰ˆæœ¬çš„å…³ç³»\n\nè¿™æ—¶å€™çš„ï¼ˆ1ï¼Œ3ï¼‰æ˜¯session Bç”Ÿæˆçš„ï¼ŒsessionAçœ‹ä¸åˆ°ï¼Œåªèƒ½çœ‹ä¸Šä¸€ä¸ªï¼ˆ1ï¼Œ2ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545230042,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51668,"user_name":"gether","can_delete":false,"product_type":"c1","uid":1015780,"ip_address":"","ucode":"224698C2C609EA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7f/e4/990dcd8e.jpg","comment_is_top":false,"comment_ctime":1545220936,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545220936","product_id":100020801,"comment_content":"ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œä¼šè¿›è¡Œæ’åºï¼Œå› ä¸ºè”åˆç´¢å¼•åªä¿è¯äº†cityå’Œnameè”åˆæœ‰åºï¼Œå¦‚æœæ”¹æˆorder by city,nameé‚£å°±ä¸éœ€è¦é¢å¤–çš„æ’åºï¼›<br><br>ç¬¬äºŒä¸ªé—®é¢˜ï¼Œå¯ä»¥åªæä¾›ä¸Šä¸€é¡µä¸‹ä¸€é¡µçš„åŠŸèƒ½ï¼Œè®©ä¸šåŠ¡å°†ä¸Šä¸€æ¬¡çš„åˆ†é¡µæœ€å¤§idä¼ å…¥ï¼Œç„¶åwhere id&gt;maxid and city in(&#39;æ­å·&#39;,&#39;è‹å·&#39;) order by name limit 100","like_count":0},{"had_liked":false,"id":51630,"user_name":"joseph","can_delete":false,"product_type":"c1","uid":1305358,"ip_address":"","ucode":"FE85D68678AB4E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/5C2aE3Lwhz7vpoUhuUa9MzmtEDH8O7oYslu7iabYIY3v5XxJEQJYyFiaXhjBXMpmDmW1AOGvFJ1cx26jqwQ9tKkQ/132","comment_is_top":false,"comment_ctime":1545211371,"is_pvip":false,"replies":[{"id":"18695","content":"æ‰€ä»¥è¿™é‡Œçš„ç»“è®ºæ˜¯ï¼Œå…¶å®ä¼šè¯1æ ¹æœ¬æ²¡å»ä¿®æ”¹â€¦","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545223216,"ip_address":"","comment_id":51630,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545211371","product_id":100020801,"comment_content":"è€å¸ˆï¼šå¯è§æ€§éªŒè¯æ–¹å¼è¿™é‡Œï¼Œæ²¡æ˜ç™½ï¼Œè™½ç„¶äº‹åŠ¡ç« èŠ‚çš„ç†è§£ï¼Œåº”è¯¥æ˜¯å¯ä»¥çœ‹åˆ°è‡ªå·±çš„æ›´æ–°ç‰ˆæœ¬æ‰å¯¹ï¼Œåœ¨5.6.28ä¸‹é¢å®éªŒæ²¡æœ‰å‡ºæ¥(1,3)ï¼Œè¿˜æ˜¯(1,2)ï¼Œéš”ç¦»çº§åˆ«rr<br>å¦‚ï¼š<br>ä¼šè¯ä¸€ï¼š<br>mysql&gt; show variables like &#39;tx_iso%&#39;;<br>+---------------+-----------------+<br>| Variable_name | Value           |<br>+---------------+-----------------+<br>| tx_isolation  | REPEATABLE-READ |<br>+---------------+-----------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; begin;<br>Query OK, 0 rows affected (0.00 sec)<br><br>mysql&gt; select * from t where id =1;<br>+----+------+<br>| id | a    |<br>+----+------+<br>|  1 |    2 |<br>+----+------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; <br>mysql&gt; <br>mysql&gt; update t set a =3 where id =1;<br>Query OK, 0 rows affected (0.00 sec)<br>Rows matched: 1  Changed: 0  Warnings: 0<br><br>mysql&gt; select * from t where id =1;<br>+----+------+<br>| id | a    |<br>+----+------+<br>|  1 |    2 |<br>+----+------+<br>1 row in set (0.00 sec)<br><br>ä¼šè¯äºŒï¼š<br>mysql&gt; show variables like &#39;tx_iso%&#39;;<br>+---------------+-----------------+<br>| Variable_name | Value           |<br>+---------------+-----------------+<br>| tx_isolation  | REPEATABLE-READ |<br>+---------------+-----------------+<br>1 row in set (0.01 sec)<br><br>mysql&gt; show create table t\\G;<br>*************************** 1. row ***************************<br>       Table: t<br>Create Table: CREATE TABLE `t` (<br>  `id` int(11) NOT NULL AUTO_INCREMENT,<br>  `a` int(11) DEFAULT NULL,<br>  PRIMARY KEY (`id`)<br>) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4<br>1 row in set (0.00 sec)<br><br>ERROR: <br>No query specified<br><br>mysql&gt; update t set a =3 where id =1;<br>Query OK, 1 row affected (0.01 sec)<br>Rows matched: 1  Changed: 1  Warnings: 0<br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433541,"discussion_content":"æ‰€ä»¥è¿™é‡Œçš„ç»“è®ºæ˜¯ï¼Œå…¶å®ä¼šè¯1æ ¹æœ¬æ²¡å»ä¿®æ”¹â€¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545223216,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51626,"user_name":"everyok22","can_delete":false,"product_type":"c1","uid":1213878,"ip_address":"","ucode":"3A3304CCDC5C5C","user_header":"","comment_is_top":false,"comment_ctime":1545210852,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545210852","product_id":100020801,"comment_content":"1ï¼š select * from t where city in (&#39;æ­å·&#39;,&quot; è‹å· &quot;) order by name limit 100; è¿™ä¸ªè¯­å¥æ‰§è¡Œçš„æ—¶å€™åº”è¯¥æ˜¯è¦æ’åºçš„ã€‚<br>2ï¼šæˆ‘æƒ³åˆ°çš„æ˜¯æ”¹æˆè¿™æ ·ï¼š<br>SELECT * FROM <br> (<br>\t(SELECT * FROM t WHERE city = &#39;æ­å·&#39; ORDER BY NAME LIMIT 100)  UNION ALL <br>\t(SELECT * FROM t WHERE city = &#39;è‹å·&#39; ORDER BY NAME LIMIT 100)<br> ) AS temp <br> ORDER BY NAME LIMIT 100; <br>3ï¼šlimitè¿™ä¸ªåˆ†é¡µæˆ‘å°±ä¸çŸ¥é“æ€ä¹ˆä¼˜åŒ–äº†<br><br>","like_count":0},{"had_liked":false,"id":51602,"user_name":"é“çš®","can_delete":false,"product_type":"c1","uid":1013200,"ip_address":"","ucode":"E20FB02D9ABD20","user_header":"https://static001.geekbang.org/account/avatar/00/0f/75/d0/0053c9ba.jpg","comment_is_top":false,"comment_ctime":1545206575,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545206575","product_id":100020801,"comment_content":"è¯¾åè§£ç­”ï¼š<br> select * from t where city in (&#39;æ­å·&#39;,&quot; è‹å· &quot;) order by name limit 100;<br>è¿™æ¡SQLè¯­å¥ä¼šæœ‰æ’åºã€‚<br><br>é¿å…æ’åºçš„è§£å†³æ–¹æ¡ˆï¼š<br>å°†SQLè¯­å¥æ‹†åˆ†æˆä¸¤æ¡SQLè¯­å¥<br>  1.select * from t where city = &#39;æ­å·&#39; order by name limit 100;<br>  2.select * from t where city = &#39;è‹å·&#39; order by name limit 100;<br>ç„¶åå¯¹è¿™ä¸¤ä¸ªç»“æœé›†è¿›è¡Œå½’å¹¶æ’åºï¼Œå–å‰100æ¡æ—¢å¯ã€‚ä¸å¤Ÿ100æ¡æœ‰å¤šå°‘å°±è¿”å›å¤šå°‘æ¡ã€‚<br><br>åˆ†é¡µéœ€æ±‚çš„å®ç°<br>  æ²¡æƒ³å‡ºæ¥ã€‚å¿…éœ€å¾—Using filesort, è€Œä¸”éœ€è¦joinã€‚æ€§èƒ½æ›´å·®ã€‚ã€‚ã€‚<br>select a.* from t a inner join (select id from t where city in (&#39;æ­å·&#39;,&quot; è‹å· &quot;) order by name limit 10000, 100) b on a.id = b.id;","like_count":0},{"had_liked":false,"id":51599,"user_name":"en","can_delete":false,"product_type":"c1","uid":1157417,"ip_address":"","ucode":"C14EDEED543AC8","user_header":"https://static001.geekbang.org/account/avatar/00/11/a9/29/dad1f942.jpg","comment_is_top":false,"comment_ctime":1545205952,"is_pvip":false,"replies":[{"id":"18682","content":"å‰é¢å¯ä»¥ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œmysqlè®¤ä¸ºé€‰è¿™ä¸ªå¥½ï¼Œ<br><br>åé¢çš„è¯­å¥æ˜¯ä¸è¡Œçš„äº†ï¼Œä¼˜åŒ–å™¨è®¤ä¸ºè¿˜ä¸å¦‚å…¨è¡¨æ‰«æğŸ˜“","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545215306,"ip_address":"","comment_id":51599,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545205952","product_id":100020801,"comment_content":"explain select  city,name from t  where city=&#39;æ­å·&#39; order by name;<br>+------+-------------+-------+------+----------------+-----------+---------+-------+------+--------------------------+<br>| id   | select_type | table | type | possible_keys  | key       | key_len | ref   | rows | Extra                    |<br>+------+-------------+-------+------+----------------+-----------+---------+-------+------+--------------------------+<br>|    1 | SIMPLE      | t     | ref  | city,city_user | city_user | 50      | const |    3 | Using where; Using index |<br>+------+-------------+-------+------+----------------+-----------+---------+-------+------+--------------------------+<br>è¯·é—®è€å¸ˆä¸ºä»€ä¹ˆæ£€ç´¢å­—æ®µçš„ä¸åŒï¼Œä¼šå½±å“ç´¢å¼•çš„ä½¿ç”¨ä¸å¦å‘¢ï¼Ÿ<br>explain select  age,city,name from t  where city=&#39;æ­å·&#39; order by name;<br>+------+-------------+-------+------+----------------+------+---------+------+------+-----------------------------+<br>| id   | select_type | table | type | possible_keys  | key  | key_len | ref  | rows | Extra                       |<br>+------+-------------+-------+------+----------------+------+---------+------+------+-----------------------------+<br>|    1 | SIMPLE      | t     | ALL  | city,city_user | NULL | NULL    | NULL |    3 | Using where; Using filesort |<br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433532,"discussion_content":"å‰é¢å¯ä»¥ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œmysqlè®¤ä¸ºé€‰è¿™ä¸ªå¥½ï¼Œ\n\nåé¢çš„è¯­å¥æ˜¯ä¸è¡Œçš„äº†ï¼Œä¼˜åŒ–å™¨è®¤ä¸ºè¿˜ä¸å¦‚å…¨è¡¨æ‰«æğŸ˜“","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545215306,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51598,"user_name":"çˆ±å­¦ä¹ çš„å¥½å­©å­","can_delete":false,"product_type":"c1","uid":1331195,"ip_address":"","ucode":"C51EA3E529BE0B","user_header":"https://static001.geekbang.org/account/avatar/00/14/4f/fb/3eb917f1.jpg","comment_is_top":false,"comment_ctime":1545205894,"is_pvip":false,"replies":[{"id":"18681","content":"è´´ä¸€ä¸‹ä½ çš„è¡¨ç»“æ„ï¼ŒSQLè¯­å¥ï¼Œoptimizer_traceæœ€åéƒ¨åˆ†çš„æˆªå›¾å“¦","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545215134,"ip_address":"","comment_id":51598,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545205894","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œå…¨å­—æ®µæ’åºé‚£ä¸€èŠ‚ï¼Œæˆ‘åšäº†å®éªŒï¼Œæˆ‘çš„æ’åºç¼“å­˜å¤§å°æ˜¯1Mï¼Œ examined rows æ˜¯800ä¸‡ï¼Œä¸‰ä¸ªå­—æ®µéƒ½æœ‰æ•°æ®ï¼Œä¸‰ä¸ªå­—æ®µåˆ†åˆ«æ˜¯  int.  bigint  biginté‚£ä¹ˆå¦‚æœè¿™äº›æ•°æ®éƒ½æ”¾åˆ°ç¼“å­˜åº”è¯¥éœ€è¦ï¼ˆ4+8+8ï¼‰*800ä¸‡ç­‰äº160Mï¼Œä½†æ˜¯æˆ‘çœ‹äº†éƒ½æ²¡æœ‰ç”¨åˆ°ä¸´æ—¶è¡¨ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433531,"discussion_content":"è´´ä¸€ä¸‹ä½ çš„è¡¨ç»“æ„ï¼ŒSQLè¯­å¥ï¼Œoptimizer_traceæœ€åéƒ¨åˆ†çš„æˆªå›¾å“¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545215134,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51575,"user_name":"â˜","can_delete":false,"product_type":"c1","uid":1302793,"ip_address":"","ucode":"6FAEF05F234D2A","user_header":"https://static001.geekbang.org/account/avatar/00/13/e1/09/9483f537.jpg","comment_is_top":false,"comment_ctime":1545202079,"is_pvip":false,"replies":[{"id":"18962","content":"å› ä¸ºè¦æ’åºçš„æ˜¯nameå­—æ®µå‘€ğŸ˜“","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545333162,"ip_address":"","comment_id":51575,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545202079","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼š<br>       æ¯è¡Œåˆ—æ•°æ®è¾ƒå¤šçš„æƒ…å†µï¼Œä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥ä»äºŒçº§ç´¢å¼•ä¸­æ‹¿cityå’Œidå»sort bufferè¿›è¡Œæ’åºï¼Œè€Œæ˜¯è¦å»ä¸»é”®ç´¢å¼•å†å»æ‹¿åˆ°è¿™ä¸¤ä¸ªåˆ—ï¼Œå†å»sort bufferæ’åºå‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433519,"discussion_content":"å› ä¸ºè¦æ’åºçš„æ˜¯nameå­—æ®µå‘€ğŸ˜“","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545333162,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51568,"user_name":"Realm","can_delete":false,"product_type":"c1","uid":1081299,"ip_address":"","ucode":"30CBEBE619D1A2","user_header":"https://static001.geekbang.org/account/avatar/00/10/7f/d3/b5896293.jpg","comment_is_top":false,"comment_ctime":1545201078,"is_pvip":true,"replies":[{"id":"19036","content":"å¯¹çš„ï¼Œä½ çœ‹çš„å¾ˆç»†è‡´ğŸ‘ğŸ¿<br><br><br>æˆ‘å‘ä¸€ä¸ªå ªè¯¯","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545372668,"ip_address":"","comment_id":51568,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545201078","product_id":100020801,"comment_content":"è€å¸ˆï¼š<br>alter table t add index city_user(city, name);<br>1ï¼Œ<br>2ï¼Œ<br>3ï¼Œä»ç´¢å¼• city å–ä¸‹ä¸€ä¸ªè®°å½•ä¸»é”® idï¼›<br>4ï¼Œ<br>è¿™é‡Œçš„3  æ˜¯ä¸æ˜¯ä»ç´¢å¼•(city,name)å–ä¸‹ä¸€ä¸ªè®°å½•ä¸»é”®id ?","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433516,"discussion_content":"å¯¹çš„ï¼Œä½ çœ‹çš„å¾ˆç»†è‡´ğŸ‘ğŸ¿\n\n\næˆ‘å‘ä¸€ä¸ªå ªè¯¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545372668,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51559,"user_name":"æŸšå­","can_delete":false,"product_type":"c1","uid":1002136,"ip_address":"","ucode":"7641A699DA0CFD","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/NhbRicjvf8v3K6D3v1FtOicxOciaPZQsCjCmuGCqea4vJeRVaLicKLpAcFQlcTgLvczBWY7SYDkeOtibxXj1PGl7Nug/132","comment_is_top":false,"comment_ctime":1545199852,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1545199852","product_id":100020801,"comment_content":"æ‚¨å¥½ï¼ŒåŸºäºrowidæ’åºçš„æ–¹å¼ï¼Œæ˜¯æ²¡æœ‰ä¸»é”®æˆ–è€…å¤åˆä¸»é”®çš„æ—¶å€™ç”¨çš„æ˜¯rowidï¼Œ å¦‚æœæœ‰å•å­—æ®µä¸»é”®çš„æ—¶å€™ä½¿ç”¨ä¸»é”®ä¹ˆï¼Ÿè¿˜æ˜¯å’Œä¸»é”®æ— å…³ï¼Œéƒ½æ˜¯ç”¨ç³»ç»Ÿåˆ†é…çš„rowidå‘¢","like_count":0},{"had_liked":false,"id":51529,"user_name":"Ryoma","can_delete":false,"product_type":"c1","uid":1130590,"ip_address":"","ucode":"7F692369239692","user_header":"https://static001.geekbang.org/account/avatar/00/11/40/5e/b8fada94.jpg","comment_is_top":false,"comment_ctime":1545194481,"is_pvip":true,"discussion_count":0,"race_medal":2,"score":"1545194481","product_id":100020801,"comment_content":"å…³äºè”åˆç´¢å¼•çš„é—®é¢˜ï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼š<br>æˆ‘ä½¿ç”¨col0 åŠ col1å­—æ®µå»ºç«‹è”åˆå”¯ä¸€ç´¢å¼•ï¼Œå¦‚æœåªæ˜¯ç®€å•æ‹¼æ¥çš„è¯ï¼Œæ¯”å¦‚æœ‰ä¸¤è¡Œæ•°æ®å¦‚ä¸‹æ‰€ç¤ºï¼š<br>col0  col1<br>1       11<br>11      1<br><br>æ‹¼æ¥åçš„æ•°æ®éƒ½æ˜¯111ï¼Œæ­¤æ—¶ä¸å°±ä¸å”¯ä¸€ç´¢å¼•çš„å‰æå†²çªäº†ä¹ˆ","like_count":0},{"had_liked":false,"id":51519,"user_name":"åŒ…åŒ…up","can_delete":false,"product_type":"c1","uid":1073495,"ip_address":"","ucode":"A6F51A62A8B362","user_header":"https://static001.geekbang.org/account/avatar/00/10/61/57/6f3c81dd.jpg","comment_is_top":false,"comment_ctime":1545193064,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545193064","product_id":100020801,"comment_content":"1.è¯­å¥æ‰§è¡Œçš„æ—¶å€™ä¼šæœ‰æ’åºè¿‡ç¨‹ï¼Œcity_name(city, name) è¿™ä¸ªè”åˆç´¢å¼•ï¼Œå› ä¸ºç´¢å¼•é‡Œçš„é¡ºåºæ˜¯å…ˆcityå†nameï¼Œå¤šä¸ªcityçš„æ—¶å€™å–å‡ºæ¥çš„é¡ºåºå°±è·Ÿnameæ²¡æœ‰å…³ç³»äº†ã€‚<br>è¿™é‡Œæƒ³ç¡®è®¤ä¸€ä¸ªé—®é¢˜ï¼Œwhere city in (&#39;æ­å·&#39;,&quot; è‹å· &quot;)è¿™ä¸ªæ“ä½œï¼Œmysqlä¼šæŒ‰ç…§iné‡Œé¢keyçš„å­—å…¸åºä¾æ¬¡å»ç´¢å¼•é‡Œæ‰¾å¯¹åº”çš„idå—ï¼Ÿ<br>2.ä¸ºäº†é¿å…mysqlåšæ’åºï¼Œå¯ä»¥é€šè¿‡ä¸¤ä¸ªsqlå»mysqlé‡Œå–æ•°æ®ã€‚<br>mysql&gt; select * from t where city = &quot;æ­å·&quot; order by name limit 100;<br>mysql&gt; select * from t where city = &quot;è‹å·&quot; order by name limit 100;<br>è¿™ä¸¤ä¸ªsqlï¼Œmysqléƒ½ä¸éœ€è¦è¿›è¡Œæ’åºï¼Œcity_name(city, name) è¿™ä¸ªè”åˆç´¢å¼•è¶³å¤Ÿæ»¡è¶³æŸ¥è¯¢è¦æ±‚çš„æ•°æ®äº†ã€‚æœ€åå†ç”±ä¸šåŠ¡ç¨‹åºå¯¹ä¸¤ä¸ªç»“æœåˆå¹¶å’Œæ’åºã€‚<br>3.æœ€åä¸€ä¸ªé—®é¢˜å°±ä¸å¤ªæ¸…æ¥šäº†ï¼Œæ„Ÿè§‰ä¸Šæ˜¯è¦å»ºç«‹nameå­—æ®µçš„ç´¢å¼•ã€‚<br><br>","like_count":0},{"had_liked":false,"id":51508,"user_name":"æ¢ä¸­å","can_delete":false,"product_type":"c1","uid":1006789,"ip_address":"","ucode":"52FE40242CBAD0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5c/c5/1231d633.jpg","comment_is_top":false,"comment_ctime":1545191259,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1545191259","product_id":100020801,"comment_content":"åº”è¯¥ä¸éœ€è¦å…¨æ’åºï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œåº”è¯¥æ˜¯ä¸¤ä¸ªç´¢å¼•ä¸‹å„å–1000æ¡ï¼Œç„¶åè¿™ä¸¤åƒå†æ’åºï¼Œä¸çŸ¥é“å¼•æ“æœ‰æ²¡æœ‰è¿™ä¹ˆæ™ºèƒ½","like_count":0},{"had_liked":false,"id":51507,"user_name":"æ¢ä¸­å","can_delete":false,"product_type":"c1","uid":1006789,"ip_address":"","ucode":"52FE40242CBAD0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5c/c5/1231d633.jpg","comment_is_top":false,"comment_ctime":1545191258,"is_pvip":true,"replies":[{"id":"18636","content":"ä¸æ™ºèƒ½ğŸ˜“","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545194646,"ip_address":"","comment_id":51507,"utype":1}],"discussion_count":2,"race_medal":1,"score":"1545191258","product_id":100020801,"comment_content":"åº”è¯¥ä¸éœ€è¦å…¨æ’åºï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œåº”è¯¥æ˜¯ä¸¤ä¸ªç´¢å¼•ä¸‹å„å–1000æ¡ï¼Œç„¶åè¿™ä¸¤åƒå†æ’åºï¼Œä¸çŸ¥é“å¼•æ“æœ‰æ²¡æœ‰è¿™ä¹ˆæ™ºèƒ½","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433486,"discussion_content":"ä¸æ™ºèƒ½ğŸ˜“","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545194646,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1186467,"avatar":"https://static001.geekbang.org/account/avatar/00/12/1a/a3/a7da014c.jpg","nickname":"Zp","note":"","ucode":"A15C8753F2D3AA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577803,"discussion_content":"è¿™é‡Œæ˜¯æŒ‡ä¼šæŠŠä¸¤ä¸ªåŸå¸‚çš„æ‰€æœ‰æ•°æ®å…¨éƒ¨å–å‡ºæ¥æ’åº ï¼Œå–å‰1000å— ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656342639,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51497,"user_name":"didiren","can_delete":false,"product_type":"c1","uid":1305376,"ip_address":"","ucode":"8341F02F2ABA60","user_header":"https://static001.geekbang.org/account/avatar/00/13/eb/20/a02c4f61.jpg","comment_is_top":false,"comment_ctime":1545189863,"is_pvip":false,"replies":[{"id":"18617","content":"è¡¨ç»“æ„å’ŒSQLè¯­å¥å‘å‡ºæ¥çœ‹ä¸‹","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545191245,"ip_address":"","comment_id":51497,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545189863","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå…³äºä¸Šä¸€èŠ‚çš„è¯¾åé—®é¢˜æˆ‘åˆåšäº†ä¸€æ¬¡å®éªŒï¼Œåœ¨RRéš”ç¦»çº§åˆ«ä¸‹ä¸ä½ è¯´çš„ç»“è®ºä¸åŒï¼ŒsessionAçš„ç¬¬äºŒæ¬¡æŸ¥è¯¢è¯»åˆ°çš„ä»ç„¶æ˜¯è€æ•°æ®ï¼Œè€Œä¸æ˜¯æ›´æ–°åçš„å€¼ï¼Œè¯´æ˜æ›´æ–°å¹¶æ²¡æœ‰å‘ç”Ÿåœ¨å¼•æ“å±‚ï¼ŒsessionAæ²¡æœ‰ç”Ÿæˆæ–°çš„æ•°æ®ç‰ˆæœ¬ã€‚<br>åªæœ‰åœ¨RCéš”ç¦»çº§åˆ«ä¸‹ç¬¬äºŒæ¬¡æŸ¥è¯¢æ‰å’Œä½ çš„å®éªŒç»“æœç›¸åŒï¼Œè¯»åˆ°æ›´æ–°åçš„æ•°æ®ï¼Œå› ä¸ºRCç”¨çš„æ˜¯å½“å‰è¯»<br>ä¸çŸ¥é“æˆ‘ç†è§£çš„å¯¹ä¸å¯¹ï¼Œèƒ½ä¸ºæˆ‘è§£ç­”ä¸€ä¸‹å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433482,"discussion_content":"è¡¨ç»“æ„å’ŒSQLè¯­å¥å‘å‡ºæ¥çœ‹ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545191245,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51488,"user_name":"Geek_02538c","can_delete":false,"product_type":"c1","uid":1336903,"ip_address":"","ucode":"26E208B5AB7D7F","user_header":"","comment_is_top":false,"comment_ctime":1545189279,"is_pvip":true,"replies":[{"id":"18630","content":"1. è¿™è¦çœ‹ä½ ä¸»åº“ä¸Šçš„è¯»å†™æ¨¡å¼<br>2. ä¸€èˆ¬çœ‹æ—¥å¿—ç›˜<br>3. å…¶å®ä»åº“å¦‚æœè€ƒè™‘åˆ‡æ¢ä»¥åæœ‰å¯èƒ½å½“ä¸»åº“ï¼Œä¸€èˆ¬å¤§å®¶ä¼šè®¾ç½®æˆä¸€æ ·çš„ã€‚ çº¯è¯»å¤‡åº“å¯ä»¥è€ƒè™‘å…³æ‰åƒtrx_commitã€sync_binlogè¿™æ ·çš„å‚æ•°","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545192848,"ip_address":"","comment_id":51488,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545189279","product_id":100020801,"comment_content":"è¯·æ•™3ä¸ªé—®é¢˜1.å°†æ—¥å¿—æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶åˆ†é…åˆ°å¤šä¸ªç£ç›˜ä¸Šæ˜¯å¦èƒ½æå‡æ€§èƒ½ï¼Œæå‡ç©ºé—´å¤šå¤§ï¼Ÿ2.å¦‚æœæ—¥å¿—æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶åˆ†é…åˆ°å¤šä¸ªç£ç›˜ä¸Šï¼Œç£ç›˜çš„æ€§èƒ½åˆä¸åŒï¼ŒMysql é‡Œçš„innodb_io_capacity è¯¥å¦‚ä½•è®¾ç½®ï¼Ÿ3ã€‚å¯¹äºä¸»ä»æ¶æ„ï¼Œå…¶åœºæ™¯æ˜æ˜¾ä¸åŒï¼ŒMysql çš„ç³»ç»Ÿå‚æ•°è¯¥å¦‚ä½•è°ƒæ•´ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433479,"discussion_content":"1. è¿™è¦çœ‹ä½ ä¸»åº“ä¸Šçš„è¯»å†™æ¨¡å¼\n2. ä¸€èˆ¬çœ‹æ—¥å¿—ç›˜\n3. å…¶å®ä»åº“å¦‚æœè€ƒè™‘åˆ‡æ¢ä»¥åæœ‰å¯èƒ½å½“ä¸»åº“ï¼Œä¸€èˆ¬å¤§å®¶ä¼šè®¾ç½®æˆä¸€æ ·çš„ã€‚ çº¯è¯»å¤‡åº“å¯ä»¥è€ƒè™‘å…³æ‰åƒtrx_commitã€sync_binlogè¿™æ ·çš„å‚æ•°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545192848,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51472,"user_name":"ä»¤ç‹å°‘ä¾ ","can_delete":false,"product_type":"c1","uid":1334516,"ip_address":"","ucode":"36390E67AF0779","user_header":"https://static001.geekbang.org/account/avatar/00/14/5c/f4/88f107d9.jpg","comment_is_top":false,"comment_ctime":1545186913,"is_pvip":false,"replies":[{"id":"18619","content":"ç¬¬20ç¯‡ä¼šæåˆ°è¿™ä¸ªï¼Œä½†æ˜¯æˆ‘ä¸ç¡®å®šèƒ½ä¸èƒ½å®Œå…¨è§£å†³ä½ çš„ç–‘æƒ‘ï¼Œçœ‹å®Œé‚£ç¯‡ï¼Œæœ‰é—®é¢˜ä½ å†ç•™è¨€å“ˆ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545191400,"ip_address":"","comment_id":51472,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545186913","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ¥ä¸Šä¸€ç¯‡å›ç­”ï¼Œä¸»è¦æƒ³äº†è§£å‡½æ•°æ‰§è¡ŒåŸç†ï¼Œä»¥åŠä¸ºä»€ä¹ˆæœ‰çš„å‡½æ•°ä¼šä½¿ç´¢å¼•å¤±æ•ˆ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433470,"discussion_content":"ç¬¬20ç¯‡ä¼šæåˆ°è¿™ä¸ªï¼Œä½†æ˜¯æˆ‘ä¸ç¡®å®šèƒ½ä¸èƒ½å®Œå…¨è§£å†³ä½ çš„ç–‘æƒ‘ï¼Œçœ‹å®Œé‚£ç¯‡ï¼Œæœ‰é—®é¢˜ä½ å†ç•™è¨€å“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545191400,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51470,"user_name":"å¸†å¸†å¸†å¸†å¸†å¸†å¸†å¸†","can_delete":false,"product_type":"c1","uid":1304645,"ip_address":"","ucode":"0CB732FFD07463","user_header":"https://static001.geekbang.org/account/avatar/00/13/e8/45/c58cb283.jpg","comment_is_top":false,"comment_ctime":1545186795,"is_pvip":false,"replies":[{"id":"18620","content":"å—¯ï¼Œ50ä¸å¤Ÿç”¨100çœ‹çœ‹ğŸ˜„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545191450,"ip_address":"","comment_id":51470,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545186795","product_id":100020801,"comment_content":"(name,city)ç´¢å¼•ä¸å¤ªå¥½ï¼Œè¿™æ ·ä¼šå…¨ç´¢å¼•æ‰«æã€‚<br>select * from t where city = &#39;æ­å·&#39; order by name limit 50<br>union<br>select * from  t where city = &#39; è‹å·&#39; order by name limit 50;<br>æœ€åå®¢æˆ·ç«¯æŠŠ100è®°å½•æŒ‰nameæ’åºã€‚è¿™ä¸ªæ–¹æ¡ˆä¹Ÿæœ‰ç‚¹é—®é¢˜ï¼Œå®ƒå’ŒåŸè¯­å¥çš„SQLå«ä¹‰å¹¶éå®Œå…¨ä¸€è‡´çš„ã€‚<br>æ˜¾ç¤ºæ¯ä¸€é¡µçš„æ—¶å€™ï¼ŒæŠŠå½“å‰é¡µçš„æœ€åä¸€æ¡è®°å½•çš„nameä¿å­˜ä¸‹æ¥ï¼Œç‚¹å‡»ä¸‹ä¸€é¡µçš„æ—¶å€™ï¼ŒæŠŠè¿™ä¸ªå€¼ä¼ ç»™sqlã€‚<br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433469,"discussion_content":"å—¯ï¼Œ50ä¸å¤Ÿç”¨100çœ‹çœ‹ğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545191450,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51464,"user_name":"å¸†å¸†å¸†å¸†å¸†å¸†å¸†å¸†","can_delete":false,"product_type":"c1","uid":1304645,"ip_address":"","ucode":"0CB732FFD07463","user_header":"https://static001.geekbang.org/account/avatar/00/13/e8/45/c58cb283.jpg","comment_is_top":false,"comment_ctime":1545186055,"is_pvip":false,"replies":[{"id":"18631","content":"é¢å›¾è´´é”™äº†ï¼Œæ›´æ–°äº†å“ˆ<br><br>æˆ‘ä»¬çš„ç»“è®ºæ˜¯ä¸€è‡´çš„å“¦ï¼Œéƒ½æ˜¯updateä»¥åèƒ½çœ‹åˆ°c=3äº†<br><br>","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545193137,"ip_address":"","comment_id":51464,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545186055","product_id":100020801,"comment_content":"ç­”æ¡ˆä¸­çš„å†…å®¹æˆ‘éªŒè¯çš„æƒ…å†µä¸ä¸€æ ·ã€‚<br>mysql&gt; begin;<br>Query OK, 0 rows affected (0.00 sec)<br><br>mysql&gt; <br>mysql&gt; select * from t where id=1;<br>+----+------+<br>| id | a    |<br>+----+------+<br>|  1 |    2 |<br>+----+------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; update t set a=3 where id=1;<br>Query OK, 0 rows affected (0.00 sec)<br>Rows matched: 1  Changed: 0  Warnings: 0<br><br>mysql&gt; select * from t where id=1;<br>+----+------+<br>| id | a    |<br>+----+------+<br>|  1 |    3 |<br>+----+------+<br>1 row in set (0.00 sec)<br>å¯ä»¥çœ‹åˆ°æˆ‘åœ¨æ‰§è¡Œupdateè¯­å¥çš„æ—¶å€™Changed: 0 ï¼Œè€Œä¸æ˜¯ä½œè€…æˆªå›¾ä¸­çš„Changed: 1 ï¼ˆè¿™é‡Œæˆ‘æ²¡æœ‰è´´å¦ä¸€ä¸ªä¼šè¯çš„updateï¼‰ã€‚å®éªŒä¸­mysqlç‰ˆæœ¬æ˜¯5.7.18ã€‚å¦å¤–ä½œè€…åœ¨â€æ—¥å¿—å’Œç´¢å¼•ç›¸å…³é—®é¢˜â€œçš„æ–‡ç« ä¸­ï¼Œæå‡ºè¿™ä¸ªé—®é¢˜çš„æˆªå›¾ä¹Ÿæ˜¯Changed: 0ï¼Œåªæ˜¯å½“æ—¶æ²¡æœ‰ç¬¬äºŒä¸ªä¼šè¯å»updateã€‚<br><br>select ... from ... for updateå’Œupdateä¸€æ ·ï¼Œéƒ½æ˜¯å½“å‰è¯»ã€‚è€Œselect ... from ...æ˜¯ä¸€è‡´æ€§è¯»ï¼Œæ•…ä¸¤ä¸ªè¯­å¥è¿”å›çš„ç»“æœä¸ä¸€æ ·ã€‚æ‰€ä»¥innodbåœ¨æ‰§è¡Œupdateçš„æ—¶å€™ï¼Œæ˜¯èƒ½å¤Ÿç¡®å®š(id=1)å’Œ(a=3)çš„ã€‚<br><br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433466,"discussion_content":"é¢å›¾è´´é”™äº†ï¼Œæ›´æ–°äº†å“ˆ\n\næˆ‘ä»¬çš„ç»“è®ºæ˜¯ä¸€è‡´çš„å“¦ï¼Œéƒ½æ˜¯updateä»¥åèƒ½çœ‹åˆ°c=3äº†\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545193137,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51453,"user_name":"æ³°æ ¼æ¨","can_delete":false,"product_type":"c1","uid":1182151,"ip_address":"","ucode":"DF23BD9D31B536","user_header":"https://static001.geekbang.org/account/avatar/00/12/09/c7/861b4a70.jpg","comment_is_top":false,"comment_ctime":1545184657,"is_pvip":false,"replies":[{"id":"18633","content":"å¤æ‚åº¦æ˜¯O(n)å“ˆ<br><br>å–IDè¿™ä¸ªæƒ³æ³•å¾ˆå¥½","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545193500,"ip_address":"","comment_id":51453,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545184657","product_id":100020801,"comment_content":"ä¼šæ’åºã€‚<br>å¯ä»¥ä¸šåŠ¡æ‹†æˆ2æ¡è¯­å¥æ‰§è¡Œï¼Œç„¶ååœ¨ä»£ç é‡Œåš2ä¸ªæœ‰åºé›†åˆçš„åˆå¹¶ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O1ã€‚<br>æœ‰limitçš„æƒ…å†µä¼šæ‹†æˆ2ä¸ªè¯­å¥æŸ¥å‡ºlimit 10100çš„idï¼Œç„¶åunionå¹¶æŸ¥å‡ºæ‰€éœ€çš„idï¼Œæœ€åjoinæŸ¥å‡ºæ‰€æœ‰çš„å­—æ®µã€‚","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433458,"discussion_content":"å¤æ‚åº¦æ˜¯O(n)å“ˆ\n\nå–IDè¿™ä¸ªæƒ³æ³•å¾ˆå¥½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545193500,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51447,"user_name":"Ryoma","can_delete":false,"product_type":"c1","uid":1130590,"ip_address":"","ucode":"7F692369239692","user_header":"https://static001.geekbang.org/account/avatar/00/11/40/5e/b8fada94.jpg","comment_is_top":false,"comment_ctime":1545183508,"is_pvip":true,"replies":[{"id":"18634","content":"å—¯ï¼Œcityå­—æ®µæ”¹äº†å“ˆ<br><br>0. æ˜¯ï¼Œæˆ‘ä»¬è¿™ä¸ªä¸»è¦æ˜¯ä¸¾ä¾‹ğŸ˜„<br>1. è¿˜æ˜¯rowidæ’åºï¼Œæ²¡åˆ«çš„ç®—æ³•å¯é€‰äº†ğŸ¤·â€â™‚ï¸<br>2.å°±æ˜¯æ‹¼æ¥ğŸ˜“<br><br>ğŸ‘ğŸ¿","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545193646,"ip_address":"","comment_id":51447,"utype":1}],"discussion_count":1,"race_medal":2,"score":"1545183508","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå»ºè¡¨è¯­å¥ä¸­cityæ˜¯intå‹æ˜¯ä¸æ˜¯å¼„é”™äº†ï¼Ÿå¦å¤–ï¼Œè¿˜æœ‰å‡ ä¸ªé—®é¢˜é—®è€å¸ˆï¼š<br><br>0ï¼šä¸€èˆ¬æ¥è¯´ï¼Œcityè¿™ä¸ªå­—æ®µåŒºåˆ†åº¦åº”è¯¥ä¸æ˜¯å¾ˆé«˜ï¼Œæ¯”å¦‚ç»Ÿè®¡ä¸€ä¸ªçœçš„å±…æ°‘æƒ…å†µæ—¶ï¼Œè¿™ä¸ªæ—¶å€™cityå­—æ®µæœ‰å¿…è¦å»ºç´¢å¼•ä¹ˆï¼Œæ¯”å¦‚ä¸€ä¸ªçœå‡ åƒä¸‡å±…æ°‘æ•°æ®ï¼Œä½†æ˜¯cityåªæœ‰å‡ åä¸ª<br>1ï¼šæ¯”å¦‚è®¾ç½®äº†sort_data ä¸º16ï¼Œä½†æ˜¯cityæˆ‘ä½¿ç”¨char(32)æ¥å­˜å‚¨ï¼Œæ­¤æ—¶æ’åºä¼šé‡‡ç”¨ä»€ä¹ˆç®—æ³•å‘¢<br>2ï¼šè”åˆç´¢å¼•æ˜¯æ€ä¹ˆå­˜å‚¨çš„ï¼Œåº”è¯¥ä¸æ˜¯ç®€å•å°†ä¸¤ä¸ªå­—æ®µæ‹¼æ¥èµ·æ¥çš„ï¼Œå¯èƒ½å†…éƒ¨ä½¿ç”¨ä¸€ä¸ªhashå­˜å‚¨ï¼Ÿ<br><br>è€å¸ˆèƒ½è®²è§£ä¸€ä¸‹ä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433455,"discussion_content":"å—¯ï¼Œcityå­—æ®µæ”¹äº†å“ˆ\n\n0. æ˜¯ï¼Œæˆ‘ä»¬è¿™ä¸ªä¸»è¦æ˜¯ä¸¾ä¾‹ğŸ˜„\n1. è¿˜æ˜¯rowidæ’åºï¼Œæ²¡åˆ«çš„ç®—æ³•å¯é€‰äº†ğŸ¤·â€â™‚ï¸\n2.å°±æ˜¯æ‹¼æ¥ğŸ˜“\n\nğŸ‘ğŸ¿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545193646,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51433,"user_name":"ç¨³","can_delete":false,"product_type":"c1","uid":1207298,"ip_address":"","ucode":"11D3604DADD31F","user_header":"https://static001.geekbang.org/account/avatar/00/12/6c/02/cdeeea90.jpg","comment_is_top":false,"comment_ctime":1545182803,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545182803","product_id":100020801,"comment_content":" select t1.* from t as t1 join(select id from t where city in(&#39;æ­å·&#39;,&#39;è‹å·&#39;) order by name limit 10,10) as t2 on t1.id=t2.id","like_count":0},{"had_liked":false,"id":51412,"user_name":"å¤©ç‹","can_delete":false,"product_type":"c1","uid":1239337,"ip_address":"","ucode":"C074B2F9A5F007","user_header":"https://static001.geekbang.org/account/avatar/00/12/e9/29/629d9bb0.jpg","comment_is_top":false,"comment_ctime":1545181194,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545181194","product_id":100020801,"comment_content":"ä¼šæœ‰æ’åºè¿‡ç¨‹ï¼Œè”åˆç´¢å¼•é‡Œé¢å§“ååœ¨åŒä¸€ä¸ªåŸå¸‚å†…éƒ¨æ˜¯æœ‰åºçš„ï¼Œä¸åŒåŸå¸‚ä¹‹é—´å§“åæ˜¯æ— åºçš„ï¼Œæ’åºè¦é‡æ–°æ’ã€‚","like_count":0},{"had_liked":false,"id":51382,"user_name":"booker","can_delete":false,"product_type":"c1","uid":1205865,"ip_address":"","ucode":"950860DD77413D","user_header":"https://static001.geekbang.org/account/avatar/00/12/66/69/110f35c1.jpg","comment_is_top":false,"comment_ctime":1545179925,"is_pvip":false,"replies":[{"id":"18538","content":"é»˜è®¤æ˜¯å‡åºçš„ï¼Œ<br><br>åœ¨è¿™ä¸ªå‰æä¸‹ä½ å†åˆ†æçœ‹çœ‹","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545182857,"ip_address":"","comment_id":51382,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545179925","product_id":100020801,"comment_content":"ä¼šæœ‰æ’åºè¿‡ç¨‹ï¼Œå› ä¸ºåœ¨åˆ›ç´¢å¼•æ˜¯æ²¡æœ‰æŒ‡å®šæ˜¯å‡åºè¿˜æ˜¯é™åºé»˜è®¤ä¸ºå‡åºï¼Œåœ¨åŸå¸‚å­—æ®µé‡Œä¼šæŒ‰æ­å·å’Œè‹å·å…ˆæ’åºï¼Œç„¶åå†æŒ‰å§“åæ’åºï¼Œæ”¾å…¥sort_bufferä¸­ï¼Œç„¶è€Œæœ€ç»ˆå–å‡ºçš„æ’åºåªæœ‰nameå­—æ®µï¼Œæ‰€ä»¥éœ€è¦é‡æ–°æ’åºï¼Œä¸çŸ¥ç†è§£æ˜¯å¦æ­£ç¡®ï¼Œè¿˜æœ›è€å¸ˆæŒ‡æ­£ï¼","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433436,"discussion_content":"é»˜è®¤æ˜¯å‡åºçš„ï¼Œ\n\nåœ¨è¿™ä¸ªå‰æä¸‹ä½ å†åˆ†æçœ‹çœ‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545182857,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51370,"user_name":"Survivor","can_delete":false,"product_type":"c1","uid":1016872,"ip_address":"","ucode":"06EF9BDBD90F32","user_header":"https://static001.geekbang.org/account/avatar/00/0f/84/28/1175240c.jpg","comment_is_top":false,"comment_ctime":1545179301,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545179301","product_id":100020801,"comment_content":"å› ä¸ºæ˜¯æ ¹æ® name å­—æ®µæ’åºçš„ï¼Œcity_name ç´¢å¼•åªä¼šä¿è¯åœ¨åŒä¸€ä¸ª city ä¸‹ name çš„é¡ºåºã€‚æ‰€ä»¥éœ€è¦å†…å­˜æ’åºã€‚æ–¹æ¡ˆçš„è¯ï¼Œå¯ä»¥ æ­å·ã€è‹å·å„æŸ¥ 100 æ¡ï¼Œåœ¨ä»£ç ä¸­æ’åºã€‚","like_count":0},{"had_liked":false,"id":51353,"user_name":"Richie","can_delete":false,"product_type":"c1","uid":1111377,"ip_address":"","ucode":"1426E1B2E82A43","user_header":"https://static001.geekbang.org/account/avatar/00/10/f5/51/60e91438.jpg","comment_is_top":false,"comment_ctime":1545177650,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545177650","product_id":100020801,"comment_content":"ä¼šæœ‰æ’åºæ“ä½œï¼Œä½†åªåšç´¢å¼•æ’åºï¼Œå¹¶å–å¾—å‰100ä¸ªidå›è¡¨å–æ•°æ®","like_count":0},{"had_liked":false,"id":51331,"user_name":"åŒ—å¤©é­”ç‹¼","can_delete":false,"product_type":"c1","uid":1188144,"ip_address":"","ucode":"C22623ECEB8DBA","user_header":"https://static001.geekbang.org/account/avatar/00/12/21/30/8ecce1e1.jpg","comment_is_top":false,"comment_ctime":1545174025,"is_pvip":true,"replies":[{"id":"18540","content":"è¿™ä¸ªè¿‡ç¨‹æ˜¯å¯¹çš„ã€‚<br><br>é—®é¢˜æ˜¯é—®ï¼Œæœ‰æ²¡æœ‰æ–¹æ¡ˆé¿å…æ•°æ®åº“ç«¯æ’åºï¼Œä¹Ÿèƒ½è¾¾åˆ°ç›¸åŒçš„ä¸šåŠ¡æ•ˆæœ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545183454,"ip_address":"","comment_id":51331,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545174025","product_id":100020801,"comment_content":"æˆ‘è®¤ä¸ºå› ä¸ºæœ‰select *ï¼Œæ˜¯å…ˆå­—æ®µæ’åºï¼Œå†æŒ‰ç…§æ’åºç»“æœå–å›æ•´æ¡æ•°æ®ã€‚è¿›ä¸€æ­¥é—®é¢˜æ²¡çœ‹æ‡‚","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433413,"discussion_content":"è¿™ä¸ªè¿‡ç¨‹æ˜¯å¯¹çš„ã€‚\n\né—®é¢˜æ˜¯é—®ï¼Œæœ‰æ²¡æœ‰æ–¹æ¡ˆé¿å…æ•°æ®åº“ç«¯æ’åºï¼Œä¹Ÿèƒ½è¾¾åˆ°ç›¸åŒçš„ä¸šåŠ¡æ•ˆæœ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545183454,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}