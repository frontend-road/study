{"id":80495,"title":"38 | éƒ½è¯´InnoDBå¥½ï¼Œé‚£è¿˜è¦ä¸è¦ä½¿ç”¨Memoryå¼•æ“ï¼Ÿ","content":"<p>æˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« æœ«å°¾ç•™ç»™ä½ çš„é—®é¢˜æ˜¯ï¼šä¸¤ä¸ªgroup by è¯­å¥éƒ½ç”¨äº†order by nullï¼Œä¸ºä»€ä¹ˆä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨å¾—åˆ°çš„è¯­å¥ç»“æœé‡Œï¼Œ0è¿™ä¸ªå€¼åœ¨æœ€åä¸€è¡Œï¼›è€Œä½¿ç”¨ç£ç›˜ä¸´æ—¶è¡¨å¾—åˆ°çš„ç»“æœé‡Œï¼Œ0è¿™ä¸ªå€¼åœ¨ç¬¬ä¸€è¡Œï¼Ÿ</p><p>ä»Šå¤©æˆ‘ä»¬å°±æ¥çœ‹çœ‹ï¼Œå‡ºç°è¿™ä¸ªé—®é¢˜çš„åŸå› å§ã€‚</p><h1>å†…å­˜è¡¨çš„æ•°æ®ç»„ç»‡ç»“æ„</h1><p>ä¸ºäº†ä¾¿äºåˆ†æï¼Œæˆ‘æ¥æŠŠè¿™ä¸ªé—®é¢˜ç®€åŒ–ä¸€ä¸‹ï¼Œå‡è®¾æœ‰ä»¥ä¸‹çš„ä¸¤å¼ è¡¨t1 å’Œ t2ï¼Œå…¶ä¸­è¡¨t1ä½¿ç”¨Memory å¼•æ“ï¼Œ è¡¨t2ä½¿ç”¨InnoDBå¼•æ“ã€‚</p><pre><code>create table t1(id int primary key, c int) engine=Memory;\ncreate table t2(id int primary key, c int) engine=innodb;\ninsert into t1 values(1,1),(2,2),(3,3),(4,4),(5,5),(6,6),(7,7),(8,8),(9,9),(0,0);\ninsert into t2 values(1,1),(2,2),(3,3),(4,4),(5,5),(6,6),(7,7),(8,8),(9,9),(0,0);\n</code></pre><p>ç„¶åï¼Œæˆ‘åˆ†åˆ«æ‰§è¡Œselect * from t1å’Œselect * from t2ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/3f/e6/3fb1100b6e3390357d4efff0ba4765e6.png?wh=599*330\" alt=\"\"></p><center><span class=\"reference\">å›¾1 ä¸¤ä¸ªæŸ¥è¯¢ç»“æœ-0çš„ä½ç½®</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œå†…å­˜è¡¨t1çš„è¿”å›ç»“æœé‡Œé¢0åœ¨æœ€åä¸€è¡Œï¼Œè€ŒInnoDBè¡¨t2çš„è¿”å›ç»“æœé‡Œ0åœ¨ç¬¬ä¸€è¡Œã€‚</p><p>å‡ºç°è¿™ä¸ªåŒºåˆ«çš„åŸå› ï¼Œè¦ä»è¿™ä¸¤ä¸ªå¼•æ“çš„ä¸»é”®ç´¢å¼•çš„ç»„ç»‡æ–¹å¼è¯´èµ·ã€‚</p><p>è¡¨t2ç”¨çš„æ˜¯InnoDBå¼•æ“ï¼Œå®ƒçš„ä¸»é”®ç´¢å¼•idçš„ç»„ç»‡æ–¹å¼ï¼Œä½ å·²ç»å¾ˆç†Ÿæ‚‰äº†ï¼šInnoDBè¡¨çš„æ•°æ®å°±æ”¾åœ¨ä¸»é”®ç´¢å¼•æ ‘ä¸Šï¼Œä¸»é”®ç´¢å¼•æ˜¯B+æ ‘ã€‚æ‰€ä»¥è¡¨t2çš„æ•°æ®ç»„ç»‡æ–¹å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/4e/8d/4e29e4f9db55ace6ab09161c68ad8c8d.jpg?wh=1142*880\" alt=\"\"></p><center><span class=\"reference\">å›¾2 è¡¨t2çš„æ•°æ®ç»„ç»‡</span></center><p>ä¸»é”®ç´¢å¼•ä¸Šçš„å€¼æ˜¯æœ‰åºå­˜å‚¨çš„ã€‚åœ¨æ‰§è¡Œselect *çš„æ—¶å€™ï¼Œå°±ä¼šæŒ‰ç…§å¶å­èŠ‚ç‚¹ä»å·¦åˆ°å³æ‰«æï¼Œæ‰€ä»¥å¾—åˆ°çš„ç»“æœé‡Œï¼Œ0å°±å‡ºç°åœ¨ç¬¬ä¸€è¡Œã€‚</p><p>ä¸InnoDBå¼•æ“ä¸åŒï¼ŒMemoryå¼•æ“çš„æ•°æ®å’Œç´¢å¼•æ˜¯åˆ†å¼€çš„ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¡¨t1ä¸­çš„æ•°æ®å†…å®¹ã€‚</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/dd/84/dde03e92074cecba4154d30cd16a9684.jpg?wh=1142*880\" alt=\"\"></p><center><span class=\"reference\">å›¾3 è¡¨t1 çš„æ•°æ®ç»„ç»‡</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œå†…å­˜è¡¨çš„æ•°æ®éƒ¨åˆ†ä»¥æ•°ç»„çš„æ–¹å¼å•ç‹¬å­˜æ”¾ï¼Œè€Œä¸»é”®idç´¢å¼•é‡Œï¼Œå­˜çš„æ˜¯æ¯ä¸ªæ•°æ®çš„ä½ç½®ã€‚ä¸»é”®idæ˜¯hashç´¢å¼•ï¼Œå¯ä»¥çœ‹åˆ°ç´¢å¼•ä¸Šçš„keyå¹¶ä¸æ˜¯æœ‰åºçš„ã€‚</p><p>åœ¨å†…å­˜è¡¨t1ä¸­ï¼Œå½“æˆ‘æ‰§è¡Œselect *çš„æ—¶å€™ï¼Œèµ°çš„æ˜¯å…¨è¡¨æ‰«æï¼Œä¹Ÿå°±æ˜¯é¡ºåºæ‰«æè¿™ä¸ªæ•°ç»„ã€‚å› æ­¤ï¼Œ0å°±æ˜¯æœ€åä¸€ä¸ªè¢«è¯»åˆ°ï¼Œå¹¶æ”¾å…¥ç»“æœé›†çš„æ•°æ®ã€‚</p><p>å¯è§ï¼ŒInnoDBå’ŒMemoryå¼•æ“çš„æ•°æ®ç»„ç»‡æ–¹å¼æ˜¯ä¸åŒçš„ï¼š</p><ul>\n<li>InnoDBå¼•æ“æŠŠæ•°æ®æ”¾åœ¨ä¸»é”®ç´¢å¼•ä¸Šï¼Œå…¶ä»–ç´¢å¼•ä¸Šä¿å­˜çš„æ˜¯ä¸»é”®idã€‚è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<strong>ç´¢å¼•ç»„ç»‡è¡¨</strong>ï¼ˆIndex Organizied Tableï¼‰ã€‚</li>\n<li>è€ŒMemoryå¼•æ“é‡‡ç”¨çš„æ˜¯æŠŠæ•°æ®å•ç‹¬å­˜æ”¾ï¼Œç´¢å¼•ä¸Šä¿å­˜æ•°æ®ä½ç½®çš„æ•°æ®ç»„ç»‡å½¢å¼ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<strong>å †ç»„ç»‡è¡¨</strong>ï¼ˆHeap Organizied Tableï¼‰ã€‚</li>\n</ul><p>ä»ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸¤ä¸ªå¼•æ“çš„ä¸€äº›å…¸å‹ä¸åŒï¼š</p><ol>\n<li>\n<p>InnoDBè¡¨çš„æ•°æ®æ€»æ˜¯æœ‰åºå­˜æ”¾çš„ï¼Œè€Œå†…å­˜è¡¨çš„æ•°æ®å°±æ˜¯æŒ‰ç…§å†™å…¥é¡ºåºå­˜æ”¾çš„ï¼›</p>\n</li>\n<li>\n<p>å½“æ•°æ®æ–‡ä»¶æœ‰ç©ºæ´çš„æ—¶å€™ï¼ŒInnoDBè¡¨åœ¨æ’å…¥æ–°æ•°æ®çš„æ—¶å€™ï¼Œä¸ºäº†ä¿è¯æ•°æ®æœ‰åºæ€§ï¼Œåªèƒ½åœ¨å›ºå®šçš„ä½ç½®å†™å…¥æ–°å€¼ï¼Œè€Œå†…å­˜è¡¨æ‰¾åˆ°ç©ºä½å°±å¯ä»¥æ’å…¥æ–°å€¼ï¼›</p>\n</li>\n<li>\n<p>æ•°æ®ä½ç½®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼ŒInnoDBè¡¨åªéœ€è¦ä¿®æ”¹ä¸»é”®ç´¢å¼•ï¼Œè€Œå†…å­˜è¡¨éœ€è¦ä¿®æ”¹æ‰€æœ‰ç´¢å¼•ï¼›</p>\n</li>\n<li>\n<p>InnoDBè¡¨ç”¨ä¸»é”®ç´¢å¼•æŸ¥è¯¢æ—¶éœ€è¦èµ°ä¸€æ¬¡ç´¢å¼•æŸ¥æ‰¾ï¼Œç”¨æ™®é€šç´¢å¼•æŸ¥è¯¢çš„æ—¶å€™ï¼Œéœ€è¦èµ°ä¸¤æ¬¡ç´¢å¼•æŸ¥æ‰¾ã€‚è€Œå†…å­˜è¡¨æ²¡æœ‰è¿™ä¸ªåŒºåˆ«ï¼Œæ‰€æœ‰ç´¢å¼•çš„â€œåœ°ä½â€éƒ½æ˜¯ç›¸åŒçš„ã€‚</p>\n</li>\n<li>\n<p>InnoDBæ”¯æŒå˜é•¿æ•°æ®ç±»å‹ï¼Œä¸åŒè®°å½•çš„é•¿åº¦å¯èƒ½ä¸åŒï¼›å†…å­˜è¡¨ä¸æ”¯æŒBlob å’Œ Textå­—æ®µï¼Œå¹¶ä¸”å³ä½¿å®šä¹‰äº†varchar(N)ï¼Œå®é™…ä¹Ÿå½“ä½œchar(N)ï¼Œä¹Ÿå°±æ˜¯å›ºå®šé•¿åº¦å­—ç¬¦ä¸²æ¥å­˜å‚¨ï¼Œå› æ­¤å†…å­˜è¡¨çš„æ¯è¡Œæ•°æ®é•¿åº¦ç›¸åŒã€‚</p>\n</li>\n</ol><p>ç”±äºå†…å­˜è¡¨çš„è¿™äº›ç‰¹æ€§ï¼Œæ¯ä¸ªæ•°æ®è¡Œè¢«åˆ é™¤ä»¥åï¼Œç©ºå‡ºçš„è¿™ä¸ªä½ç½®éƒ½å¯ä»¥è¢«æ¥ä¸‹æ¥è¦æ’å…¥çš„æ•°æ®å¤ç”¨ã€‚æ¯”å¦‚ï¼Œå¦‚æœè¦åœ¨è¡¨t1ä¸­æ‰§è¡Œï¼š</p><pre><code>delete from t1 where id=5;\ninsert into t1 values(10,10);\nselect * from t1;\n</code></pre><p>å°±ä¼šçœ‹åˆ°è¿”å›ç»“æœé‡Œï¼Œid=10è¿™ä¸€è¡Œå‡ºç°åœ¨id=4ä¹‹åï¼Œä¹Ÿå°±æ˜¯åŸæ¥id=5è¿™è¡Œæ•°æ®çš„ä½ç½®ã€‚</p><p>éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œè¡¨t1çš„è¿™ä¸ªä¸»é”®ç´¢å¼•æ˜¯å“ˆå¸Œç´¢å¼•ï¼Œå› æ­¤å¦‚æœæ‰§è¡ŒèŒƒå›´æŸ¥è¯¢ï¼Œæ¯”å¦‚</p><pre><code>select * from t1 where id&lt;5;\n</code></pre><p>æ˜¯ç”¨ä¸ä¸Šä¸»é”®ç´¢å¼•çš„ï¼Œéœ€è¦èµ°å…¨è¡¨æ‰«æã€‚ä½ å¯ä»¥å€Ÿæ­¤å†å›é¡¾ä¸‹<a href=\"https://time.geekbang.org/column/article/69236\">ç¬¬4ç¯‡æ–‡ç« </a>çš„å†…å®¹ã€‚é‚£å¦‚æœè¦è®©å†…å­˜è¡¨æ”¯æŒèŒƒå›´æ‰«æï¼Œåº”è¯¥æ€ä¹ˆåŠå‘¢ ï¼Ÿ</p><h1>hashç´¢å¼•å’ŒB-Treeç´¢å¼•</h1><p>å®é™…ä¸Šï¼Œå†…å­˜è¡¨ä¹Ÿæ˜¯æ”¯æŒB-Treeç´¢å¼•çš„ã€‚åœ¨idåˆ—ä¸Šåˆ›å»ºä¸€ä¸ªB-Treeç´¢å¼•ï¼ŒSQLè¯­å¥å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><pre><code>alter table t1 add index a_btree_index using btree (id);\n</code></pre><p>è¿™æ—¶ï¼Œè¡¨t1çš„æ•°æ®ç»„ç»‡å½¢å¼å°±å˜æˆäº†è¿™æ ·ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/17/e3/1788deca56cb83c114d8353c92e3bde3.jpg?wh=1142*880\" alt=\"\"></p><center><span class=\"reference\">å›¾4 è¡¨t1çš„æ•°æ®ç»„ç»‡--å¢åŠ B-Treeç´¢å¼•</span></center><p>æ–°å¢çš„è¿™ä¸ªB-Treeç´¢å¼•ä½ çœ‹ç€å°±çœ¼ç†Ÿäº†ï¼Œè¿™è·ŸInnoDBçš„b+æ ‘ç´¢å¼•ç»„ç»‡å½¢å¼ç±»ä¼¼ã€‚</p><p>ä½œä¸ºå¯¹æ¯”ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸‹é¢è¿™ä¸¤ä¸ªè¯­å¥çš„è¾“å‡ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/a8/8a/a85808fcccab24911d257d720550328a.png?wh=641*540\" alt=\"\"></p><center><span class=\"reference\">å›¾5 ä½¿ç”¨B-Treeå’Œhashç´¢å¼•æŸ¥è¯¢è¿”å›ç»“æœå¯¹æ¯”</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œæ‰§è¡Œselect * from t1 where id&lt;5çš„æ—¶å€™ï¼Œä¼˜åŒ–å™¨ä¼šé€‰æ‹©B-Treeç´¢å¼•ï¼Œæ‰€ä»¥è¿”å›ç»“æœæ˜¯0åˆ°4ã€‚ ä½¿ç”¨force indexå¼ºè¡Œä½¿ç”¨ä¸»é”®idè¿™ä¸ªç´¢å¼•ï¼Œid=0è¿™ä¸€è¡Œå°±åœ¨ç»“æœé›†çš„æœ€æœ«å°¾äº†ã€‚</p><p>å…¶å®ï¼Œä¸€èˆ¬åœ¨æˆ‘ä»¬çš„å°è±¡ä¸­ï¼Œå†…å­˜è¡¨çš„ä¼˜åŠ¿æ˜¯é€Ÿåº¦å¿«ï¼Œå…¶ä¸­çš„ä¸€ä¸ªåŸå› å°±æ˜¯Memoryå¼•æ“æ”¯æŒhashç´¢å¼•ã€‚å½“ç„¶ï¼Œæ›´é‡è¦çš„åŸå› æ˜¯ï¼Œå†…å­˜è¡¨çš„æ‰€æœ‰æ•°æ®éƒ½ä¿å­˜åœ¨å†…å­˜ï¼Œè€Œå†…å­˜çš„è¯»å†™é€Ÿåº¦æ€»æ˜¯æ¯”ç£ç›˜å¿«ã€‚</p><p>ä½†æ˜¯ï¼Œæ¥ä¸‹æ¥æˆ‘è¦è·Ÿä½ è¯´æ˜ï¼Œä¸ºä»€ä¹ˆæˆ‘ä¸å»ºè®®ä½ åœ¨ç”Ÿäº§ç¯å¢ƒä¸Šä½¿ç”¨å†…å­˜è¡¨ã€‚è¿™é‡Œçš„åŸå› ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªæ–¹é¢ï¼š</p><ol>\n<li>\n<p>é”ç²’åº¦é—®é¢˜ï¼›</p>\n</li>\n<li>\n<p>æ•°æ®æŒä¹…åŒ–é—®é¢˜ã€‚</p>\n</li>\n</ol><h1>å†…å­˜è¡¨çš„é”</h1><p>æˆ‘ä»¬å…ˆæ¥è¯´è¯´å†…å­˜è¡¨çš„é”ç²’åº¦é—®é¢˜ã€‚</p><p>å†…å­˜è¡¨ä¸æ”¯æŒè¡Œé”ï¼Œåªæ”¯æŒè¡¨é”ã€‚å› æ­¤ï¼Œä¸€å¼ è¡¨åªè¦æœ‰æ›´æ–°ï¼Œå°±ä¼šå µä½å…¶ä»–æ‰€æœ‰åœ¨è¿™ä¸ªè¡¨ä¸Šçš„è¯»å†™æ“ä½œã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„è¡¨é”è·Ÿä¹‹å‰æˆ‘ä»¬ä»‹ç»è¿‡çš„MDLé”ä¸åŒï¼Œä½†éƒ½æ˜¯è¡¨çº§çš„é”ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘é€šè¿‡ä¸‹é¢è¿™ä¸ªåœºæ™¯ï¼Œè·Ÿä½ æ¨¡æ‹Ÿä¸€ä¸‹å†…å­˜è¡¨çš„è¡¨çº§é”ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f2/29/f216e2d707559ed2ca98fbe21e509f29.png?wh=933*221\" alt=\"\"></p><center><span class=\"reference\">å›¾6 å†…å­˜è¡¨çš„è¡¨é”--å¤ç°æ­¥éª¤</span></center><p>åœ¨è¿™ä¸ªæ‰§è¡Œåºåˆ—é‡Œï¼Œsession Açš„updateè¯­å¥è¦æ‰§è¡Œ50ç§’ï¼Œåœ¨è¿™ä¸ªè¯­å¥æ‰§è¡ŒæœŸé—´session Bçš„æŸ¥è¯¢ä¼šè¿›å…¥é”ç­‰å¾…çŠ¶æ€ã€‚session Cçš„show processlist ç»“æœè¾“å‡ºå¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/14/16/14d88076dad6db573f0b66f2c17df916.png?wh=1273*172\" alt=\"\"></p><center><span class=\"reference\">å›¾7 å†…å­˜è¡¨çš„è¡¨é”--ç»“æœ</span></center><p>è·Ÿè¡Œé”æ¯”èµ·æ¥ï¼Œè¡¨é”å¯¹å¹¶å‘è®¿é—®çš„æ”¯æŒä¸å¤Ÿå¥½ã€‚æ‰€ä»¥ï¼Œå†…å­˜è¡¨çš„é”ç²’åº¦é—®é¢˜ï¼Œå†³å®šäº†å®ƒåœ¨å¤„ç†å¹¶å‘äº‹åŠ¡çš„æ—¶å€™ï¼Œæ€§èƒ½ä¹Ÿä¸ä¼šå¤ªå¥½ã€‚</p><h1>æ•°æ®æŒä¹…æ€§é—®é¢˜</h1><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†çœ‹çœ‹æ•°æ®æŒä¹…æ€§çš„é—®é¢˜ã€‚</p><p>æ•°æ®æ”¾åœ¨å†…å­˜ä¸­ï¼Œæ˜¯å†…å­˜è¡¨çš„ä¼˜åŠ¿ï¼Œä½†ä¹Ÿæ˜¯ä¸€ä¸ªåŠ£åŠ¿ã€‚å› ä¸ºï¼Œæ•°æ®åº“é‡å¯çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„å†…å­˜è¡¨éƒ½ä¼šè¢«æ¸…ç©ºã€‚</p><p>ä½ å¯èƒ½ä¼šè¯´ï¼Œå¦‚æœæ•°æ®åº“å¼‚å¸¸é‡å¯ï¼Œå†…å­˜è¡¨è¢«æ¸…ç©ºä¹Ÿå°±æ¸…ç©ºäº†ï¼Œä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜å•Šã€‚ä½†æ˜¯ï¼Œåœ¨é«˜å¯ç”¨æ¶æ„ä¸‹ï¼Œå†…å­˜è¡¨çš„è¿™ä¸ªç‰¹ç‚¹ç®€ç›´å¯ä»¥å½“åšbugæ¥çœ‹å¾…äº†ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ</p><p><strong>æˆ‘ä»¬å…ˆçœ‹çœ‹M-Sæ¶æ„ä¸‹ï¼Œä½¿ç”¨å†…å­˜è¡¨å­˜åœ¨çš„é—®é¢˜ã€‚</strong></p><p><img src=\"https://static001.geekbang.org/resource/image/5b/e9/5b910e4c0f1afa219aeecd1f291c95e9.jpg?wh=1142*880\" alt=\"\"></p><center><span class=\"reference\">å›¾8 M-SåŸºæœ¬æ¶æ„</span></center><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸‹é¢è¿™ä¸ªæ—¶åºï¼š</p><ol>\n<li>\n<p>ä¸šåŠ¡æ­£å¸¸è®¿é—®ä¸»åº“ï¼›</p>\n</li>\n<li>\n<p>å¤‡åº“ç¡¬ä»¶å‡çº§ï¼Œå¤‡åº“é‡å¯ï¼Œå†…å­˜è¡¨t1å†…å®¹è¢«æ¸…ç©ºï¼›</p>\n</li>\n<li>\n<p>å¤‡åº“é‡å¯åï¼Œå®¢æˆ·ç«¯å‘é€ä¸€æ¡updateè¯­å¥ï¼Œä¿®æ”¹è¡¨t1çš„æ•°æ®è¡Œï¼Œè¿™æ—¶å¤‡åº“åº”ç”¨çº¿ç¨‹å°±ä¼šæŠ¥é”™â€œæ‰¾ä¸åˆ°è¦æ›´æ–°çš„è¡Œâ€ã€‚</p>\n</li>\n</ol><p>è¿™æ ·å°±ä¼šå¯¼è‡´ä¸»å¤‡åŒæ­¥åœæ­¢ã€‚å½“ç„¶ï¼Œå¦‚æœè¿™æ—¶å€™å‘ç”Ÿä¸»å¤‡åˆ‡æ¢çš„è¯ï¼Œå®¢æˆ·ç«¯ä¼šçœ‹åˆ°ï¼Œè¡¨t1çš„æ•°æ®â€œä¸¢å¤±â€äº†ã€‚</p><p>åœ¨å›¾8ä¸­è¿™ç§æœ‰proxyçš„æ¶æ„é‡Œï¼Œå¤§å®¶é»˜è®¤ä¸»å¤‡åˆ‡æ¢çš„é€»è¾‘æ˜¯ç”±æ•°æ®åº“ç³»ç»Ÿè‡ªå·±ç»´æŠ¤çš„ã€‚è¿™æ ·å¯¹å®¢æˆ·ç«¯æ¥è¯´ï¼Œå°±æ˜¯â€œç½‘ç»œæ–­å¼€ï¼Œé‡è¿ä¹‹åï¼Œå‘ç°å†…å­˜è¡¨æ•°æ®ä¸¢å¤±äº†â€ã€‚</p><p>ä½ å¯èƒ½è¯´è¿™è¿˜å¥½å•Šï¼Œæ¯•ç«Ÿä¸»å¤‡å‘ç”Ÿåˆ‡æ¢ï¼Œè¿æ¥ä¼šæ–­å¼€ï¼Œä¸šåŠ¡ç«¯èƒ½å¤Ÿæ„ŸçŸ¥åˆ°å¼‚å¸¸ã€‚</p><p>ä½†æ˜¯ï¼Œæ¥ä¸‹æ¥å†…å­˜è¡¨çš„è¿™ä¸ªç‰¹æ€§å°±ä¼šè®©ä½¿ç”¨ç°è±¡æ˜¾å¾—æ›´â€œè¯¡å¼‚â€äº†ã€‚ç”±äºMySQLçŸ¥é“é‡å¯ä¹‹åï¼Œå†…å­˜è¡¨çš„æ•°æ®ä¼šä¸¢å¤±ã€‚æ‰€ä»¥ï¼Œæ‹…å¿ƒä¸»åº“é‡å¯ä¹‹åï¼Œå‡ºç°ä¸»å¤‡ä¸ä¸€è‡´ï¼ŒMySQLåœ¨å®ç°ä¸Šåšäº†è¿™æ ·ä¸€ä»¶äº‹å„¿ï¼šåœ¨æ•°æ®åº“é‡å¯ä¹‹åï¼Œå¾€binlogé‡Œé¢å†™å…¥ä¸€è¡ŒDELETE FROM t1ã€‚</p><p><strong>å¦‚æœä½ ä½¿ç”¨æ˜¯å¦‚å›¾9æ‰€ç¤ºçš„åŒMç»“æ„çš„è¯ï¼š</strong></p><p><img src=\"https://static001.geekbang.org/resource/image/40/57/4089c9c1f92ce61d2ed779fd0932ba57.jpg?wh=1142*880\" alt=\"\"></p><center><span class=\"reference\">å›¾9 åŒMç»“æ„</span></center><p>åœ¨å¤‡åº“é‡å¯çš„æ—¶å€™ï¼Œå¤‡åº“binlogé‡Œçš„deleteè¯­å¥å°±ä¼šä¼ åˆ°ä¸»åº“ï¼Œç„¶åæŠŠä¸»åº“å†…å­˜è¡¨çš„å†…å®¹åˆ é™¤ã€‚è¿™æ ·ä½ åœ¨ä½¿ç”¨çš„æ—¶å€™å°±ä¼šå‘ç°ï¼Œä¸»åº“çš„å†…å­˜è¡¨æ•°æ®çªç„¶è¢«æ¸…ç©ºäº†ã€‚</p><p>åŸºäºä¸Šé¢çš„åˆ†æï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼Œå†…å­˜è¡¨å¹¶ä¸é€‚åˆåœ¨ç”Ÿäº§ç¯å¢ƒä¸Šä½œä¸ºæ™®é€šæ•°æ®è¡¨ä½¿ç”¨ã€‚</p><p>æœ‰åŒå­¦ä¼šè¯´ï¼Œä½†æ˜¯å†…å­˜è¡¨æ‰§è¡Œé€Ÿåº¦å¿«å‘€ã€‚è¿™ä¸ªé—®é¢˜ï¼Œå…¶å®ä½ å¯ä»¥è¿™ä¹ˆåˆ†æï¼š</p><ol>\n<li>\n<p>å¦‚æœä½ çš„è¡¨æ›´æ–°é‡å¤§ï¼Œé‚£ä¹ˆå¹¶å‘åº¦æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„å‚è€ƒæŒ‡æ ‡ï¼ŒInnoDBæ”¯æŒè¡Œé”ï¼Œå¹¶å‘åº¦æ¯”å†…å­˜è¡¨å¥½ï¼›</p>\n</li>\n<li>\n<p>èƒ½æ”¾åˆ°å†…å­˜è¡¨çš„æ•°æ®é‡éƒ½ä¸å¤§ã€‚å¦‚æœä½ è€ƒè™‘çš„æ˜¯è¯»çš„æ€§èƒ½ï¼Œä¸€ä¸ªè¯»QPSå¾ˆé«˜å¹¶ä¸”æ•°æ®é‡ä¸å¤§çš„è¡¨ï¼Œå³ä½¿æ˜¯ä½¿ç”¨InnoDBï¼Œæ•°æ®ä¹Ÿæ˜¯éƒ½ä¼šç¼“å­˜åœ¨InnoDB Buffer Poolé‡Œçš„ã€‚å› æ­¤ï¼Œä½¿ç”¨InnoDBè¡¨çš„è¯»æ€§èƒ½ä¹Ÿä¸ä¼šå·®ã€‚</p>\n</li>\n</ol><p>æ‰€ä»¥ï¼Œ<strong>æˆ‘å»ºè®®ä½ æŠŠæ™®é€šå†…å­˜è¡¨éƒ½ç”¨InnoDBè¡¨æ¥ä»£æ›¿ã€‚</strong>ä½†æ˜¯ï¼Œæœ‰ä¸€ä¸ªåœºæ™¯å´æ˜¯ä¾‹å¤–çš„ã€‚</p><p>è¿™ä¸ªåœºæ™¯å°±æ˜¯ï¼Œæˆ‘ä»¬åœ¨ç¬¬35å’Œ36ç¯‡è¯´åˆ°çš„ç”¨æˆ·ä¸´æ—¶è¡¨ã€‚åœ¨æ•°æ®é‡å¯æ§ï¼Œä¸ä¼šè€—è´¹è¿‡å¤šå†…å­˜çš„æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥è€ƒè™‘ä½¿ç”¨å†…å­˜è¡¨ã€‚</p><p>å†…å­˜ä¸´æ—¶è¡¨åˆšå¥½å¯ä»¥æ— è§†å†…å­˜è¡¨çš„ä¸¤ä¸ªä¸è¶³ï¼Œä¸»è¦æ˜¯ä¸‹é¢çš„ä¸‰ä¸ªåŸå› ï¼š</p><ol>\n<li>\n<p>ä¸´æ—¶è¡¨ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹è®¿é—®ï¼Œæ²¡æœ‰å¹¶å‘æ€§çš„é—®é¢˜ï¼›</p>\n</li>\n<li>\n<p>ä¸´æ—¶è¡¨é‡å¯åä¹Ÿæ˜¯éœ€è¦åˆ é™¤çš„ï¼Œæ¸…ç©ºæ•°æ®è¿™ä¸ªé—®é¢˜ä¸å­˜åœ¨ï¼›</p>\n</li>\n<li>\n<p>å¤‡åº“çš„ä¸´æ—¶è¡¨ä¹Ÿä¸ä¼šå½±å“ä¸»åº“çš„ç”¨æˆ·çº¿ç¨‹ã€‚</p>\n</li>\n</ol><p>ç°åœ¨ï¼Œæˆ‘ä»¬å›è¿‡å¤´å†çœ‹ä¸€ä¸‹ç¬¬35ç¯‡joinè¯­å¥ä¼˜åŒ–çš„ä¾‹å­ï¼Œå½“æ—¶æˆ‘å»ºè®®çš„æ˜¯åˆ›å»ºä¸€ä¸ªInnoDBä¸´æ—¶è¡¨ï¼Œä½¿ç”¨çš„è¯­å¥åºåˆ—æ˜¯ï¼š</p><pre><code>create temporary table temp_t(id int primary key, a int, b int, index(b))engine=innodb;\ninsert into temp_t select * from t2 where b&gt;=1 and b&lt;=2000;\nselect * from t1 join temp_t on (t1.b=temp_t.b);\n</code></pre><p>äº†è§£äº†å†…å­˜è¡¨çš„ç‰¹æ€§ï¼Œä½ å°±çŸ¥é“äº†ï¼Œ å…¶å®è¿™é‡Œä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨çš„æ•ˆæœæ›´å¥½ï¼ŒåŸå› æœ‰ä¸‰ä¸ªï¼š</p><ol>\n<li>\n<p>ç›¸æ¯”äºInnoDBè¡¨ï¼Œä½¿ç”¨å†…å­˜è¡¨ä¸éœ€è¦å†™ç£ç›˜ï¼Œå¾€è¡¨temp_tçš„å†™æ•°æ®çš„é€Ÿåº¦æ›´å¿«ï¼›</p>\n</li>\n<li>\n<p>ç´¢å¼•bä½¿ç”¨hashç´¢å¼•ï¼ŒæŸ¥æ‰¾çš„é€Ÿåº¦æ¯”B-Treeç´¢å¼•å¿«ï¼›</p>\n</li>\n<li>\n<p>ä¸´æ—¶è¡¨æ•°æ®åªæœ‰2000è¡Œï¼Œå ç”¨çš„å†…å­˜æœ‰é™ã€‚</p>\n</li>\n</ol><p>å› æ­¤ï¼Œä½ å¯ä»¥å¯¹<a href=\"https://time.geekbang.org/column/article/80147\">ç¬¬35ç¯‡æ–‡ç« </a>çš„è¯­å¥åºåˆ—åšä¸€ä¸ªæ”¹å†™ï¼Œå°†ä¸´æ—¶è¡¨temp_tæ”¹æˆå†…å­˜ä¸´æ—¶è¡¨ï¼Œå¹¶ä¸”åœ¨å­—æ®µbä¸Šåˆ›å»ºä¸€ä¸ªhashç´¢å¼•ã€‚</p><pre><code>create temporary table temp_t(id int primary key, a int, b int, index (b))engine=memory;\ninsert into temp_t select * from t2 where b&gt;=1 and b&lt;=2000;\nselect * from t1 join temp_t on (t1.b=temp_t.b);\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/a4/92/a468ba6d14ea225623074b6255b99f92.png?wh=2132*906\" alt=\"\"></p><center><span class=\"reference\">å›¾10 ä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨çš„æ‰§è¡Œæ•ˆæœ</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸è®ºæ˜¯å¯¼å…¥æ•°æ®çš„æ—¶é—´ï¼Œè¿˜æ˜¯æ‰§è¡Œjoinçš„æ—¶é—´ï¼Œä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨çš„é€Ÿåº¦éƒ½æ¯”ä½¿ç”¨InnoDBä¸´æ—¶è¡¨è¦æ›´å¿«ä¸€äº›ã€‚</p><h1>å°ç»“</h1><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»â€œè¦ä¸è¦ä½¿ç”¨å†…å­˜è¡¨â€è¿™ä¸ªé—®é¢˜å±•å¼€ï¼Œå’Œä½ ä»‹ç»äº†Memoryå¼•æ“çš„å‡ ä¸ªç‰¹æ€§ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œç”±äºé‡å¯ä¼šä¸¢æ•°æ®ï¼Œå¦‚æœä¸€ä¸ªå¤‡åº“é‡å¯ï¼Œä¼šå¯¼è‡´ä¸»å¤‡åŒæ­¥çº¿ç¨‹åœæ­¢ï¼›å¦‚æœä¸»åº“è·Ÿè¿™ä¸ªå¤‡åº“æ˜¯åŒMæ¶æ„ï¼Œè¿˜å¯èƒ½å¯¼è‡´ä¸»åº“çš„å†…å­˜è¡¨æ•°æ®è¢«åˆ æ‰ã€‚</p><p>å› æ­¤ï¼Œåœ¨ç”Ÿäº§ä¸Šï¼Œæˆ‘ä¸å»ºè®®ä½ ä½¿ç”¨æ™®é€šå†…å­˜è¡¨ã€‚</p><p>å¦‚æœä½ æ˜¯DBAï¼Œå¯ä»¥åœ¨å»ºè¡¨çš„å®¡æ ¸ç³»ç»Ÿä¸­å¢åŠ è¿™ç±»è§„åˆ™ï¼Œè¦æ±‚ä¸šåŠ¡æ”¹ç”¨InnoDBè¡¨ã€‚æˆ‘ä»¬åœ¨æ–‡ä¸­ä¹Ÿåˆ†æäº†ï¼Œå…¶å®InnoDBè¡¨æ€§èƒ½è¿˜ä¸é”™ï¼Œè€Œä¸”æ•°æ®å®‰å…¨ä¹Ÿæœ‰ä¿éšœã€‚è€Œå†…å­˜è¡¨ç”±äºä¸æ”¯æŒè¡Œé”ï¼Œæ›´æ–°è¯­å¥ä¼šé˜»å¡æŸ¥è¯¢ï¼Œæ€§èƒ½ä¹Ÿæœªå¿…å°±å¦‚æƒ³è±¡ä¸­é‚£ä¹ˆå¥½ã€‚</p><p>åŸºäºå†…å­˜è¡¨çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬è¿˜åˆ†æäº†å®ƒçš„ä¸€ä¸ªé€‚ç”¨åœºæ™¯ï¼Œå°±æ˜¯å†…å­˜ä¸´æ—¶è¡¨ã€‚å†…å­˜è¡¨æ”¯æŒhashç´¢å¼•ï¼Œè¿™ä¸ªç‰¹æ€§åˆ©ç”¨èµ·æ¥ï¼Œå¯¹å¤æ‚æŸ¥è¯¢çš„åŠ é€Ÿæ•ˆæœè¿˜æ˜¯å¾ˆä¸é”™çš„ã€‚</p><p>æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸€ä¸ªé—®é¢˜å§ã€‚</p><p>å‡è®¾ä½ åˆšåˆšæ¥æ‰‹çš„ä¸€ä¸ªæ•°æ®åº“ä¸Šï¼ŒçœŸçš„å‘ç°äº†ä¸€ä¸ªå†…å­˜è¡¨ã€‚å¤‡åº“é‡å¯ä¹‹åè‚¯å®šæ˜¯ä¼šå¯¼è‡´å¤‡åº“çš„å†…å­˜è¡¨æ•°æ®è¢«æ¸…ç©ºï¼Œè¿›è€Œå¯¼è‡´ä¸»å¤‡åŒæ­¥åœæ­¢ã€‚è¿™æ—¶ï¼Œæœ€å¥½çš„åšæ³•æ˜¯å°†å®ƒä¿®æ”¹æˆInnoDBå¼•æ“è¡¨ã€‚</p><p>å‡è®¾å½“æ—¶çš„ä¸šåŠ¡åœºæ™¯æš‚æ—¶ä¸å…è®¸ä½ ä¿®æ”¹å¼•æ“ï¼Œä½ å¯ä»¥åŠ ä¸Šä»€ä¹ˆè‡ªåŠ¨åŒ–é€»è¾‘ï¼Œæ¥é¿å…ä¸»å¤‡åŒæ­¥åœæ­¢å‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„æ€è€ƒå’Œåˆ†æå†™åœ¨è¯„è®ºåŒºï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾è·Ÿä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h1>ä¸ŠæœŸé—®é¢˜æ—¶é—´</h1><p>ä»Šå¤©æ–‡ç« çš„æ­£æ–‡å†…å®¹ï¼Œå·²ç»å›ç­”äº†æˆ‘ä»¬ä¸ŠæœŸçš„é—®é¢˜ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote>\n<p>@è€æ¨åŒå¿—ã€@poppyã€@é•¿æ° è¿™ä¸‰ä½åŒå­¦ç»™å‡ºäº†æ­£ç¡®ç­”æ¡ˆï¼Œæ˜¥èŠ‚æœŸé—´è¿˜æŒç»­ä¿æŒè·Ÿè¿›å­¦ä¹ ï¼Œç»™ä½ ä»¬ç‚¹èµã€‚</p>\n</blockquote>","neighbors":{"left":{"article_title":"37 | ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨å†…éƒ¨ä¸´æ—¶è¡¨ï¼Ÿ","id":80477},"right":{"article_title":"39 | è‡ªå¢ä¸»é”®ä¸ºä»€ä¹ˆä¸æ˜¯è¿ç»­çš„ï¼Ÿ","id":80531}},"comments":[{"had_liked":false,"id":65778,"user_name":"æ”¾","can_delete":false,"product_type":"c1","uid":1178180,"ip_address":"","ucode":"F637FF0D2F63AB","user_header":"https://static001.geekbang.org/account/avatar/00/11/fa/44/aa19d1f6.jpg","comment_is_top":false,"comment_ctime":1549635232,"is_pvip":false,"replies":[{"id":"23257","content":"æ–°å¹´å¿«ä¹ğŸ¤","user_name":"ä½œè€…å›å¤","comment_id":65778,"uid":"1264162","ip_address":"","utype":1,"ctime":1549637556,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"100333883040","product_id":100020801,"comment_content":"è€å¸ˆæ–°å¹´å¿«ä¹ï¼è¿‡å¹´éƒ½ä¸å¿˜ç»™æˆ‘ä»¬ä¼ æˆçŸ¥è¯†ï¼","like_count":24,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438583,"discussion_content":"æ–°å¹´å¿«ä¹ğŸ¤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549637556,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65713,"user_name":"salt","can_delete":false,"product_type":"c1","uid":1056332,"ip_address":"","ucode":"A7D8D09E12353B","user_header":"https://static001.geekbang.org/account/avatar/00/10/1e/4c/d6416f57.jpg","comment_is_top":false,"comment_ctime":1549598752,"is_pvip":false,"replies":[{"id":"23239","content":"å³ä½¿æ˜¯SSDï¼Œé¡ºåºå†™ä¹Ÿæ¯”éšæœºå†™å¿«äº›çš„ã€‚ ä¸è¿‡ç¡®å®æ²¡æœ‰æœºæ¢°ç›˜é‚£ä¹ˆæ˜æ˜¾ã€‚<br>","user_name":"ä½œè€…å›å¤","comment_id":65713,"uid":"1264162","ip_address":"","utype":1,"ctime":1549604169,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":2,"race_medal":0,"score":"74564042784","product_id":100020801,"comment_content":"æ–°å¹´å¥½ï¼<br>è¯¾åä½œä¸šï¼šåœ¨å¤‡åº“é…ç½®è·³è¿‡è¯¥å†…å­˜è¡¨çš„ä¸»ä»åŒæ­¥ã€‚<br><br>æœ‰ä¸€ä¸ªé—®é¢˜ä¸€ç›´å›°æ‰°ç€æˆ‘ï¼šSSDä»¥åŠäº‘ä¸»æœºçš„å¹¿æ³›è¿ç”¨ï¼ŒåƒInnodbè¿™ç§ä½¿ç”¨WALæŠ€æœ¯ä¼¼ä¹å¹¶ä¸èƒ½å‘æŒ¥æœ€å¤§æ€§èƒ½ï¼ˆæˆ‘çš„ç†è§£ï¼šåŸºäºSSDçš„WALæ›´å¤šçš„åªæ˜¯èµ·åˆ°é˜Ÿåˆ—ä¸€æ ·å‰Šå³°å¡«è°·çš„ä½œç”¨ï¼‰ã€‚å¯¹äºä¸€äº›æ•°æ®é‡ä¸æ˜¯ç‰¹åˆ«å¤§ï¼Œä½†è¯»å†™é¢‘ç¹çš„åº”ç”¨ï¼ˆæ¯”å¦‚ç‚¹èµã€ç§¯åˆ†ï¼‰ï¼Œæœ‰æ²¡æœ‰æ›´å¥½çš„å¼•æ“æ¨èã€‚","like_count":18,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438560,"discussion_content":"å³ä½¿æ˜¯SSDï¼Œé¡ºåºå†™ä¹Ÿæ¯”éšæœºå†™å¿«äº›çš„ã€‚ ä¸è¿‡ç¡®å®æ²¡æœ‰æœºæ¢°ç›˜é‚£ä¹ˆæ˜æ˜¾ã€‚\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1549604169,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1508329,"avatar":"https://static001.geekbang.org/account/avatar/00/17/03/e9/6358059c.jpg","nickname":"GalaxyCreater","note":"","ucode":"C79E8A088D57CF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":274442,"discussion_content":"ä¸ºä»€ä¹ˆä½¿ç”¨memoryçš„ä»åº“å¼‚å¸¸é‡å¯åï¼Œä¸»åº“çš„è¡¨è¢«æ¸…ç©ºäº†ï¼Œä¸ºå•¥è¿™æ ·ä¼šå¯¼è‡´ä¸»å¤‡åŒæ­¥åœæ­¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590583227,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65819,"user_name":"å¾€äº‹éšé£ï¼Œé¡ºå…¶è‡ªç„¶","can_delete":false,"product_type":"c1","uid":1235692,"ip_address":"","ucode":"F266EC6B143E38","user_header":"https://static001.geekbang.org/account/avatar/00/12/da/ec/779c1a78.jpg","comment_is_top":false,"comment_ctime":1549684008,"is_pvip":false,"replies":[{"id":"23274","content":"è¿™å°±æ˜¯å †ç»„ç»‡è¡¨çš„æ•°æ®å­˜æ”¾æ–¹å¼","user_name":"ä½œè€…å›å¤","comment_id":65819,"uid":"1264162","ip_address":"","utype":1,"ctime":1549698578,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":3,"race_medal":0,"score":"65974193448","product_id":100020801,"comment_content":"ä¸ºä»€ä¹ˆmemory å¼•æ“ä¸­æ•°æ®æŒ‰ç…§æ•°ç»„å•ç‹¬å­˜å‚¨ï¼Œ0ç´¢å¼•å¯¹åº”çš„æ•°æ®æ€ä¹ˆæ”¾åˆ°æ•°ç»„çš„æœ€å","like_count":16,"discussions":[{"author":{"id":1030842,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ba/ba/83de3488.jpg","nickname":"Carter","note":"","ucode":"1FD476D8F2BE27","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394111,"discussion_content":"æŒ‰æ’å…¥é¡ºåº","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1631727395,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1144458,"avatar":"https://static001.geekbang.org/account/avatar/00/11/76/8a/74cf038a.jpg","nickname":"è€K","note":"","ucode":"B9ED8A82942D1D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336911,"discussion_content":"çœ‹åˆ°ä½ è¿™ä¸ªé—®é¢˜çš„æ—¶å€™æˆ‘ä¹ŸæŒæœ‰åŒæ ·çš„ç–‘é—®ï¼Œæƒ³äº†ä¸‹ï¼Œå› ä¸ºæ’å…¥çš„é¡ºåºå°±æ˜¯å¦‚æ­¤`insert into t1 values(1,1),(2,2),(3,3),(4,4),(5,5),(6,6),(7,7),(8,8),(9,9),(0,0);`ï¼Œå†åŠ å †ç»„ç»‡è¡¨çš„å­˜æ”¾æ–¹å¼.","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1608727852,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438601,"discussion_content":"è¿™å°±æ˜¯å †ç»„ç»‡è¡¨çš„æ•°æ®å­˜æ”¾æ–¹å¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549698578,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65747,"user_name":"Long","can_delete":false,"product_type":"c1","uid":1318970,"ip_address":"","ucode":"2417242560360A","user_header":"https://static001.geekbang.org/account/avatar/00/14/20/3a/90db6a24.jpg","comment_is_top":false,"comment_ctime":1549616851,"is_pvip":false,"replies":[{"id":"25699","content":"1&amp;2 æŸ¥è¯¢information_schema.tablesçš„æ—¶å€™ï¼Œä¼šæŠŠæ‰€æœ‰çš„è¡¨éƒ½è®¿é—®åˆ°ä¸€æ¬¡ï¼Œè¿™é‡Œä¸æ­¢æ˜¯4wä¸ªè¡¨ï¼Œè€Œæ˜¯è¿™ä¸ªå®ä¾‹ä¸Šæ‰€æœ‰çš„è¡¨ï¼Œä¹Ÿå°±æ˜¯10ä¸‡<br><br>3. å› ä¸ºç³»ç»Ÿä¸€èˆ¬è®¾ç½®çš„table_definition_cache éƒ½ä¸ä¼šå¤ªå¤§ï¼Œä½ è¦æ‰“å¼€10ä¸‡å¼ è¡¨ï¼Œå°±åªèƒ½è½®æµæ‰“å¼€ï¼Œç„¶åè½®æµä»table_definition_cacheé‡Œé¢æ·˜æ±°ã€‚è¿™æ ·å°±è·Ÿå…¶ä»–æŸ¥è¯¢åœ¨table_definition_cacheè¿™ä¸ªç»“æ„é‡Œå‡ºç°äº†äº’ç›¸ç­‰å¾…èµ„æºçš„æƒ…å†µã€‚<br><br>å—¯ï¼Œè¿™ä¸ªå…¶å®å°±æ˜¯æˆ‘ä¸å»ºè®®ç”¨ç•Œé¢å·¥å…·çš„åŸå› ä¹‹ä¸€<br><br>ä¸å¥½æ„æ€ï¼Œä½ è¿™ä¸ªé—®é¢˜è¿™ä¹ˆè¿Ÿæ‰å›å¤ä½ ğŸ˜†","user_name":"ä½œè€…å›å¤","comment_id":65747,"uid":"1264162","ip_address":"","utype":1,"ctime":1551376062,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"61679158995","product_id":100020801,"comment_content":"è€å¸ˆæ–°å¹´å¥½ :-)<br>åˆšå¥½é‡åˆ°ä¸€ä¸ªé—®é¢˜ã€‚ <br><br>æœ¬æ¥å‡†å¤‡æ›´æ–°åˆ°ï¼Œä¸€ä¸ªæŸ¥è¯¢æ˜¯æ€ä¹ˆè¿è¡Œçš„é‡Œé¢çš„ï¼Œçœ‹åˆ°è¿™ç¯‡æ›´æ–°æ–‡ç« ï¼Œå°±å†™åœ¨è¿™å§ï¼Œå¸Œæœ›è€å¸ˆå¸®å¿™è§£ç­”ã€‚<br><br>å…³äºè¿™ä¸ªç³»ç»Ÿmemoryå¼•æ“è¡¨ï¼šinformation_schema.tables<br>ç›¸å…³ä¿¡æ¯å¦‚ä¸‹<br>ï¼ˆ1ï¼‰Verison: MySQL 5.6.26<br>ï¼ˆ2ï¼‰æ•°æ®é‡table_schema = abcçš„æœ‰æ¥è¿‘4Wçš„è¡¨ï¼Œæ•´ä¸ªå®ä¾‹æœ‰æ¥è¿‘10Wçš„è¡¨ã€‚ï¼ˆé»˜è®¤innodbå¼•æ“ï¼‰<br>ï¼ˆ3ï¼‰mysql.userå’Œmysql.dbçš„æ•°æ®é‡éƒ½æ˜¯100-200çš„è¡Œæ•°ï¼ŒMyISAMå¼•æ“ã€‚<br>ï¼ˆ4ï¼‰é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«RC<br><br><br>åœ¨è¿è¡ŒæŸ¥è¯¢è¯­å¥1çš„æ—¶å€™ï¼šselect * from information_schema.tables where table_schema = &#39;abc&#39;;<br>çŠ¶æ€ä¸€ç›´æ˜¯check permissionï¼Œopening tablesï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦æ‰“å¼€çš„è¡¨åœ¨opend tablesé‡Œé¢è¢«åˆ·æ‰çš„ï¼Œä¼šæ˜¾ç¤ºåœ¨opening tablesï¼Œå¯èƒ½éœ€è¦å°å‡ ç§’ååŸºæœ¬æ¢å¤æ­£å¸¸ã€‚<br><br>ä½†æ˜¯å¦‚æœåœ¨è¿è¡ŒæŸ¥è¯¢è¯­å¥2ï¼šselect count(1) from information_schema.tables where table_schema = &#39;abc&#39;; è¿™ä¸ªæ—¶å€™è¯­å¥2æœ¬èº«åœ¨profilingçœ‹é•¿æœŸå¤„äºcheck permissionçŠ¶æ€ï¼Œå…¶ä»–çº¿ç¨‹å°±ä¼šå‡ºç°é˜»å¡ç°è±¡ï¼Œå¤§éƒ¨åˆ†å¡åœ¨äº†opening tablesï¼Œå°éƒ¨åˆ†closing tablesã€‚æˆ‘æµ‹è¯•ä¸‹äº†ï¼Œå½“ä¸ªè¡¨æŸ¥è¯¢çš„æ—¶å€™check permissionå¤§æ¦‚ä¹Ÿå°±æ˜¯0.0005så·¦å³çš„æ—¶é—´ï¼Œ4Wä¸ªè¡¨ç†è®ºè‰¯å¥½çŠ¶æ€åº”è¯¥æ˜¯å‡ åç§’çš„äº‹æƒ…ã€‚<br>ä½†æ˜¯è¯­å¥1å¯èƒ½éœ€è¦5-10åˆ†é’Ÿï¼Œè¯­å¥2éœ€è¦5åˆ†é’Ÿã€‚<br><br>3ä¸ªé—®é¢˜ï¼Œè¯·è€å¸ˆæŠ½ç©ºçœ‹ä¸‹ï¼š<br>ï¼ˆ1ï¼‰information_schema.tablesçš„ç»„æˆæ–¹å¼ï¼Œæ˜¯æˆ‘æ¯æ¬¡æŸ¥è¯¢çš„æ—¶å€™ä»æ•°æ®å­—å…¸ä»¥åŠdataç›®å½•ä¸‹çš„æ–‡ä»¶ä¸­å®æ—¶å»è¯»çš„å—ï¼Ÿ<br>ï¼ˆ2ï¼‰è¯­å¥1å’Œè¯­å¥2åœ¨è¿è¡Œçš„æ—¶å€™çš„è¿‡ç¨‹åˆ†åˆ«æ˜¯æ€æ ·çš„ï¼Œç‰¹åˆ«æ˜¯è¯­å¥2ã€‚<br>ï¼ˆ3ï¼‰è¯­å¥2ä¸ºä»€ä¹ˆä¼šå‡ºç°å¤§é‡é˜»å¡å…¶ä»–äº‹åŠ¡ï¼Œå…¶ä»–äº‹åŠ¡éƒ½å¡åœ¨opening tablesçš„çŠ¶æ€ã€‚<br><br><br>PS: æœ€åæ ¹æ®audit logåˆ†ææ¥çœ‹ï¼Œè¯­å¥å®é™…ä¸Šæ˜¯MySQLçš„ä¸€ä¸ªå®¢æˆ·ç«¯Toadå‘èµ·çš„ï¼Œå½“ä½¿ç”¨Toadçš„object explorerçš„ç•Œé¢æ¥æŸ¥è¯¢è¡¨ï¼Œæˆ–è€…è®¾ç½®connectionçš„æ—¶å€™æŒ‡å®šçš„çš„default schemaæ˜¯å¤§åŸŸçš„æ—¶å€™å°±ä¼šrunè¿™ä¸ªè¯­å¥ï¼šï¼ˆtable_schemaæ”¹æˆäº†abcï¼Œå…¶ä»–éƒ½æ˜¯åŸæ ·ï¼‰<br>SELECT COUNT(1) FROM information_schema.tables WHERE table_schema = &#39;abc&#39; AND table_type != &#39;VIEW&#39;;<br><br><br>å†æ¬¡æ„Ÿè°¢ï¼","like_count":15,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438573,"discussion_content":"1&amp;amp;2 æŸ¥è¯¢information_schema.tablesçš„æ—¶å€™ï¼Œä¼šæŠŠæ‰€æœ‰çš„è¡¨éƒ½è®¿é—®åˆ°ä¸€æ¬¡ï¼Œè¿™é‡Œä¸æ­¢æ˜¯4wä¸ªè¡¨ï¼Œè€Œæ˜¯è¿™ä¸ªå®ä¾‹ä¸Šæ‰€æœ‰çš„è¡¨ï¼Œä¹Ÿå°±æ˜¯10ä¸‡\n\n3. å› ä¸ºç³»ç»Ÿä¸€èˆ¬è®¾ç½®çš„table_definition_cache éƒ½ä¸ä¼šå¤ªå¤§ï¼Œä½ è¦æ‰“å¼€10ä¸‡å¼ è¡¨ï¼Œå°±åªèƒ½è½®æµæ‰“å¼€ï¼Œç„¶åè½®æµä»table_definition_cacheé‡Œé¢æ·˜æ±°ã€‚è¿™æ ·å°±è·Ÿå…¶ä»–æŸ¥è¯¢åœ¨table_definition_cacheè¿™ä¸ªç»“æ„é‡Œå‡ºç°äº†äº’ç›¸ç­‰å¾…èµ„æºçš„æƒ…å†µã€‚\n\nå—¯ï¼Œè¿™ä¸ªå…¶å®å°±æ˜¯æˆ‘ä¸å»ºè®®ç”¨ç•Œé¢å·¥å…·çš„åŸå› ä¹‹ä¸€\n\nä¸å¥½æ„æ€ï¼Œä½ è¿™ä¸ªé—®é¢˜è¿™ä¹ˆè¿Ÿæ‰å›å¤ä½ ğŸ˜†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551376062,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":66101,"user_name":"skyoo","can_delete":false,"product_type":"c1","uid":1302503,"ip_address":"","ucode":"EBC0528BA02DD7","user_header":"https://static001.geekbang.org/account/avatar/00/13/df/e7/4ce5ed27.jpg","comment_is_top":false,"comment_ctime":1549877317,"is_pvip":false,"replies":[{"id":"23416","content":"å—¯ï¼Œè¿™ä¸ªä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ä¸è¿‡ä¹Ÿä¼šæ”¾è¿‡å…¶ä»–å¼•æ“è¡¨çš„ä¸»å¤‡ä¸ä¸€è‡´çš„æŠ¥é”™å“ˆ","user_name":"ä½œè€…å›å¤","comment_id":66101,"uid":"1264162","ip_address":"","utype":1,"ctime":1549880137,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"57384452165","product_id":100020801,"comment_content":"é‡å¯å‰ my.cnf æ·»åŠ  skip-slave-errors å¿½ç•¥ å†…å­˜è¡¨å¼•èµ·çš„ä¸»ä»å¼‚å¸¸å¯¼è‡´å¤åˆ¶å¤±è´¥<br><br>","like_count":14,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438703,"discussion_content":"å—¯ï¼Œè¿™ä¸ªä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ä¸è¿‡ä¹Ÿä¼šæ”¾è¿‡å…¶ä»–å¼•æ“è¡¨çš„ä¸»å¤‡ä¸ä¸€è‡´çš„æŠ¥é”™å“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549880137,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":263817,"user_name":"Geek_da015d","can_delete":false,"product_type":"c1","uid":1982864,"ip_address":"","ucode":"E2F95CC01AE094","user_header":"","comment_is_top":false,"comment_ctime":1606273324,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"53145880876","product_id":100020801,"comment_content":"å¾ˆé‡è¦çš„ä¸€ç‚¹æ²¡è¯´å•Šï¼Œå†…å­˜è¡¨ä¸æ”¯æŒäº‹åŠ¡ã€‚æ€ªä¸å¾—å†™demoçš„æ—¶å€™æ€»é”ä¸ä½","like_count":13,"discussions":[{"author":{"id":2889981,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/18/fd/ccc7b563.jpg","nickname":"Vegeta","note":"","ucode":"1AE2D9337A728C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550216,"discussion_content":"æ•´ä¸ªMySQLæä¾›çš„å­˜å‚¨å¼•æ“ï¼Œåªæœ‰innoDBæ‰æ”¯æŒäº‹åŠ¡","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1644418298,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1745179,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/j0gBKF8EKfRMTnBOqXR3xcqquJdzYUibXOIb32HejppBPo644p6JB3Et08Su4TUaDRWt8DzPxYtm8iabEJN2uJKw/132","nickname":"ä¸€ä¸ªé¡¶ä¸‰","note":"","ucode":"165596847783D9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333283,"discussion_content":"æ˜¯çš„ï¼Œä½ è¿™ä¹ˆä¸€è¯´æˆ‘ä¹Ÿååº”è¿‡æ¥äº†ï¼Œshow enginesé‡Œé¢æ˜ç¡®æç¤ºmemoryä¸æ”¯æŒäº‹åŠ¡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607495463,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":66032,"user_name":"llx","can_delete":false,"product_type":"c1","uid":1153012,"ip_address":"","ucode":"95741E1BD74B26","user_header":"https://static001.geekbang.org/account/avatar/00/11/97/f4/6709b8cf.jpg","comment_is_top":false,"comment_ctime":1549854329,"is_pvip":false,"replies":[{"id":"23402","content":"1. å–å†³äºå¯¹ä¸´æ—¶è¡¨çš„è®¿é—®æ¨¡å¼å“¦ï¼Œå¦‚æœæ˜¯éœ€è¦ç”¨åˆ°ç´¢å¼•æŸ¥æ‰¾ï¼Œè¿˜æ˜¯è¦åˆ›å»ºçš„ã€‚å¦‚æœåˆ›å»ºçš„ä¸´æ—¶è¡¨åªæ˜¯ç”¨äºå…¨è¡¨æ‰«æï¼Œå°±å¯ä»¥ä¸åˆ›å»ºç´¢å¼•ï¼›<br>2. æ˜¯çš„ï¼Œå¦‚æœæ˜ç¡®è¦ç”¨èŒƒå›´æŸ¥æ‰¾ï¼Œå°±å¾—åˆ›å»ºb-treeç´¢å¼•","user_name":"ä½œè€…å›å¤","comment_id":66032,"uid":"1264162","ip_address":"","utype":1,"ctime":1549873663,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"48794494585","product_id":100020801,"comment_content":"1ã€å¦‚æœä¸´æ—¶è¡¨è¯»æ•°æ®çš„æ¬¡æ•°å¾ˆå°‘ï¼ˆæ¯”å¦‚åªè¯»ä¸€æ¬¡ï¼‰ï¼Œæ˜¯ä¸æ˜¯å»ºä¸´æ—¶è¡¨æ—¶ä¸åˆ›å»ºç´¢å¼•æ•ˆæœå¾ˆæ›´å¥½ï¼Ÿ<br>2ã€engine=memory å¦‚æœé‡åˆ°èŒƒå›´æŸ¥æ‰¾ï¼Œåœ¨ä½¿ç”¨å“ˆå¸Œç´¢å¼•æ—¶åº”è¯¥ä¸ä¼šä½¿ç”¨ç´¢å¼•å§","like_count":12,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438682,"discussion_content":"1. å–å†³äºå¯¹ä¸´æ—¶è¡¨çš„è®¿é—®æ¨¡å¼å“¦ï¼Œå¦‚æœæ˜¯éœ€è¦ç”¨åˆ°ç´¢å¼•æŸ¥æ‰¾ï¼Œè¿˜æ˜¯è¦åˆ›å»ºçš„ã€‚å¦‚æœåˆ›å»ºçš„ä¸´æ—¶è¡¨åªæ˜¯ç”¨äºå…¨è¡¨æ‰«æï¼Œå°±å¯ä»¥ä¸åˆ›å»ºç´¢å¼•ï¼›\n2. æ˜¯çš„ï¼Œå¦‚æœæ˜ç¡®è¦ç”¨èŒƒå›´æŸ¥æ‰¾ï¼Œå°±å¾—åˆ›å»ºb-treeç´¢å¼•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549873663,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65941,"user_name":"æœå˜‰å˜‰","can_delete":false,"product_type":"c1","uid":1306430,"ip_address":"","ucode":"C23DE27E7886BD","user_header":"https://static001.geekbang.org/account/avatar/00/13/ef/3e/9c3a8abc.jpg","comment_is_top":false,"comment_ctime":1549788509,"is_pvip":false,"replies":[{"id":"23307","content":"æ˜¯ï¼Œå¦‚æˆ‘ä»¬æ–‡ä¸­è¯´çš„ï¼Œä¸å»ºè®®ä½¿ç”¨æ™®é€šå†…å­˜è¡¨äº†å“ˆ","user_name":"ä½œè€…å›å¤","comment_id":65941,"uid":"1264162","ip_address":"","utype":1,"ctime":1549802988,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"40204494173","product_id":100020801,"comment_content":"æˆ‘çš„è®¤è¯†é‡Œï¼Œæœ‰ä¸€ç‚¹ä¸æ˜¯å¾ˆæ¸…æ¥šã€‚memoryè¿™ä¸ªå­˜å‚¨å¼•æ“ï¼Œæœ€å¤§çš„ç‰¹æ€§åº”è¯¥æ˜¯æŠŠæ•°æ®å­˜åˆ°å†…å­˜ã€‚ä½†æ˜¯innodbä¹Ÿå¯ä»¥æŠŠæ•°æ®å­˜åˆ°å†…å­˜ï¼Œä¸ä½†å¯ä»¥å­˜åˆ°å†…å­˜(innodb buffer size)ï¼Œè¿˜å¯ä»¥è¿›è¡ŒæŒä¹…åŒ–ã€‚è¿™æ ·ä¸€å¯¹æ¯”ï¼Œæˆ‘æ„Ÿè§‰memoryçš„ä¼˜åŠ¿æ›´æ²¡æœ‰äº†ã€‚ä¸çŸ¥é“æˆ‘è®²çš„å¯¹ä¸å¯¹","like_count":10,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438649,"discussion_content":"æ˜¯ï¼Œå¦‚æˆ‘ä»¬æ–‡ä¸­è¯´çš„ï¼Œä¸å»ºè®®ä½¿ç”¨æ™®é€šå†…å­˜è¡¨äº†å“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549802988,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":73258,"user_name":"é™ˆæ‰¬é¸¿","can_delete":false,"product_type":"c1","uid":1284708,"ip_address":"","ucode":"DDDA8493CDC83C","user_header":"https://static001.geekbang.org/account/avatar/00/13/9a/64/eea9aa33.jpg","comment_is_top":false,"comment_ctime":1551845996,"is_pvip":false,"replies":[{"id":"28007","content":"ä½ çœ‹çœ‹èƒ½ä¸èƒ½æŠŠçŸ­è¿æ¥æ”¹æˆé•¿è¿æ¥<br><br>è¿˜æœ‰ï¼Œè¿™ä¸ªè¯­å¥åº”è¯¥æ˜¯æ²¡ç”¨çš„ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½é€šè¿‡é…ç½®æ¡†æ¶å‚æ•°ï¼Œæ¥é¿å…æ‰§è¡Œè¿™ä¸ªè¯­å¥","user_name":"ä½œè€…å›å¤","comment_id":73258,"uid":"1264162","ip_address":"","utype":1,"ctime":1552723971,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":2,"race_medal":0,"score":"27321649772","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œä»Šå¤©ç”Ÿäº§ä¸Šå‡ºç¢°åˆ°ä¸€ä¸ªè§£å†³ä¸äº†çš„é—®é¢˜,phpçš„yiiæ¡†æ¶ï¼Œä½¿ç”¨show full processlist æŸ¥çœ‹ å…¨æ˜¯å¦‚ä¸‹è¯­å¥æœ‰100å¤šæ¡<br>SELECT<br>    kcu.constraint_name,<br>    kcu.column_name,<br>    kcu.referenced_table_name,<br>    kcu.referenced_column_name<br>FROM information_schema.referential_constraints AS rc<br>JOIN information_schema.key_column_usage AS kcu ON<br>    (<br>        kcu.constraint_catalog = rc.constraint_catalog OR<br>        (kcu.constraint_catalog IS NULL AND rc.constraint_catalog IS NULL)<br>    ) AND<br>    kcu.constraint_schema = rc.constraint_schema AND<br>    kcu.constraint_name = rc.constraint_name<br>WHERE rc.constraint_schema = database() AND kcu.table_schema = database()<br>AND rc.table_name = &#39;t1&#39; AND kcu.table_name = &#39;t1&#39; <br>è¿™ä¸ªå¯ä»¥ä¼˜åŒ–å— è¿™ä¸ªåº“æ˜¯æ•°æ®å­—å…¸çš„ ç°åœ¨æ•°æ®åº“æ— æ³•å¯¹å¤–æä¾›æœåŠ¡  è¯·è€å¸ˆæŒ‡æ•™ï¼","like_count":6,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441990,"discussion_content":"ä½ çœ‹çœ‹èƒ½ä¸èƒ½æŠŠçŸ­è¿æ¥æ”¹æˆé•¿è¿æ¥\n\nè¿˜æœ‰ï¼Œè¿™ä¸ªè¯­å¥åº”è¯¥æ˜¯æ²¡ç”¨çš„ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½é€šè¿‡é…ç½®æ¡†æ¶å‚æ•°ï¼Œæ¥é¿å…æ‰§è¡Œè¿™ä¸ªè¯­å¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552723971,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1672786,"avatar":"https://static001.geekbang.org/account/avatar/00/19/86/52/91c7d112.jpg","nickname":"Garen","note":"","ucode":"0608C88F83EF0C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":41848,"discussion_content":"Yii è¡¨ç¤ºæˆ‘ä¸è¢«è¿™ä¸ªé”…","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1572522360,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":172473,"user_name":"æ™šé£Â·å’Œç…¦","can_delete":false,"product_type":"c1","uid":1236047,"ip_address":"","ucode":"0B1DB8F437A4B2","user_header":"","comment_is_top":false,"comment_ctime":1579183942,"is_pvip":false,"replies":[{"id":"66901","content":"å¯¹","user_name":"ä½œè€…å›å¤","comment_id":172473,"uid":"1264162","ip_address":"","utype":1,"ctime":1579228367,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"23054020422","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå†…å­˜è¡¨å°±æ˜¯ä½¿ç”¨memoryå¼•æ“åˆ›å»ºçš„è¡¨å—ï¼ŸğŸ˜‚","like_count":6,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481750,"discussion_content":"å¯¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579228367,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":66050,"user_name":"å¤¹å¿ƒé¢åŒ…","can_delete":false,"product_type":"c1","uid":1301957,"ip_address":"","ucode":"002BBA49D83D17","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJCscgdVibmoPyRLRaicvk6rjTJxePZ6VFHvGjUQvtfhCS6kO4OZ1AVibbhNGKlWZmpEFf2yA6ptsqHw/132","comment_is_top":false,"comment_ctime":1549864041,"is_pvip":false,"replies":[{"id":"23398","content":"å—¯å—¯ï¼Œè”ç³»å¼€å‘æ”¹é€ æ˜¯å¯¹çš„ğŸ˜†","user_name":"ä½œè€…å›å¤","comment_id":66050,"uid":"1264162","ip_address":"","utype":1,"ctime":1549873353,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"14434765929","product_id":100020801,"comment_content":"æˆ‘ä»¬çº¿ä¸Šå°±æœ‰ä¸€ä¸ªå› ä¸ºå†…å­˜è¡¨å¯¼è‡´çš„ä¸»ä»åŒæ­¥å¼‚å¸¸çš„ä¾‹å­,æˆ‘çš„åšæ³•æ˜¯å…ˆè·³è¿‡è¿™ä¸ªè¡¨çš„åŒæ­¥,ç„¶åå¼€å‘è¿›è¡Œæ”¹é€ ,å–æ¶ˆè¿™å¼ è¡¨çš„ä½œç”¨","like_count":4,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438686,"discussion_content":"å—¯å—¯ï¼Œè”ç³»å¼€å‘æ”¹é€ æ˜¯å¯¹çš„ğŸ˜†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549873353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65833,"user_name":"é•¿æ°","can_delete":false,"product_type":"c1","uid":1312212,"ip_address":"","ucode":"DD52C9494005F7","user_header":"https://static001.geekbang.org/account/avatar/00/14/05/d4/e06bf86d.jpg","comment_is_top":false,"comment_ctime":1549692625,"is_pvip":false,"replies":[{"id":"23283","content":"å› ä¸ºé‡å¯çš„æ—¶å€™å·²ç»æ‰§è¡Œäº†deleteè¯­å¥ï¼Œæ‰€ä»¥å†å†™å…¥æ•°æ®çš„åŠ¨ä½œä¹Ÿå¯ä»¥ä¿ç•™binlogå“ˆ","user_name":"ä½œè€…å›å¤","comment_id":65833,"uid":"1264162","ip_address":"","utype":1,"ctime":1549789514,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"10139627217","product_id":100020801,"comment_content":"å†…å­˜è¡¨ä¸€èˆ¬æ•°æ®é‡ä¸å¤§ï¼Œå¹¶ä¸”æ›´æ–°ä¸é¢‘ç¹ï¼Œå¯ä»¥å†™ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œå®šæœŸæ£€æµ‹å†…å­˜è¡¨çš„æ•°æ®ï¼Œå¦‚æœæ•°æ®ä¸ç©ºï¼Œå°±å°†å®ƒæŒä¹…åŒ–åˆ°ä¸€ä¸ªinnodbåŒç»“æ„çš„è¡¨ä¸­ï¼Œå¦‚æœä¸ºç©ºï¼Œå°±åå‘å°†æ•°æ®å†™åˆ°å†…å­˜è¡¨ä¸­ï¼Œè¿™äº›æ“ä½œå¯è®¾ç½®ä¸ºä¸å†™å…¥binlogã€‚","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438605,"discussion_content":"å› ä¸ºé‡å¯çš„æ—¶å€™å·²ç»æ‰§è¡Œäº†deleteè¯­å¥ï¼Œæ‰€ä»¥å†å†™å…¥æ•°æ®çš„åŠ¨ä½œä¹Ÿå¯ä»¥ä¿ç•™binlogå“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549789514,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":298244,"user_name":"antz","can_delete":false,"product_type":"c1","uid":1005589,"ip_address":"","ucode":"BDFDED6D7F0BD2","user_header":"https://static001.geekbang.org/account/avatar/00/0f/58/15/56f4e62a.jpg","comment_is_top":false,"comment_ctime":1623979608,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5918946904","product_id":100020801,"comment_content":"é—®å¥ï¼šåœ¨çœŸå®ä¸šåŠ¡åœºæ™¯ä¸­çœŸçš„æœ‰åƒæ–‡ä¸­åŠ¨æ€åˆ›å»ºä¸´æ—¶è¡¨è¿™ä¹ˆç”¨çš„å—ï¼Ÿæ€ä¹ˆæ„Ÿè§‰è¿™ä¹ˆåäººç±»å•Š","like_count":2},{"had_liked":false,"id":71761,"user_name":"Long","can_delete":false,"product_type":"c1","uid":1318970,"ip_address":"","ucode":"2417242560360A","user_header":"https://static001.geekbang.org/account/avatar/00/14/20/3a/90db6a24.jpg","comment_is_top":false,"comment_ctime":1551428045,"is_pvip":false,"replies":[{"id":"26049","content":"è¿™ç§æƒ…å†µæœ€é€‚åˆæºç å…¥å‘ğŸ˜„<br><br>ä½ æœ‰ä¸¤ä¸ªå¯ä»¥ç¨³å®šå¤ç°çš„å¯¹æ¯”åœºæ™¯ï¼Œè€Œä¸”å•çº¿ç¨‹å°±èƒ½å¤ç°ã€‚<br><br>è¿™ä¸¤å¤©æˆ‘ç”¨ç”µè„‘ä¸æ–¹ä¾¿ï¼Œä¸‹å‘¨æœ«æ¥ç»™å‡ºç­”æ¡ˆå“ˆã€‚<br><br>ä½ å¯å¦æŠŠ5.6&#47;5.7è¿™ä¸ªå¯¹ç…§è¯•éªŒç»„ï¼ŒåŒ…æ‹¬å®éªŒè¿‡ç¨‹å’Œç»“æœå·®å¼‚ï¼Œå†å•ç‹¬å†™ä¸€ä¸ªé—®é¢˜ğŸ˜„","user_name":"ä½œè€…å›å¤","comment_id":71761,"uid":"1264162","ip_address":"","utype":1,"ctime":1551489810,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"5846395341","product_id":100020801,"comment_content":"è¿½é—®æ›´æ–°1: è°¢è°¢è€å¸ˆçš„ç­”å¤ï¼Œæˆ‘çœ‹äº†ä¸‹innodb_stats_on_metadataå°±æ˜¯OFFï¼Œä»Šå¤©åœ¨5.7ç¯å¢ƒéªŒè¯ï¼Œå‘ç°ç«Ÿç„¶ä¸æ˜¯å‡ ç™¾ç§’ï¼Œè€Œä¸”å‡ ç§’ï¼Œä¸çŸ¥é“è¿™ä¸ªæ˜¯ä»£ç çš„ä¼˜åŒ–ï¼Œè¿˜æ˜¯å‚æ•°ä¸ä¸€è‡´çš„åŸå› ï¼Œæœ‰å‡ åä¸ªå‚æ•°å·®å¼‚éœ€è¦æ’æŸ¥ã€‚   æ‰€ä»¥åœ¨ä¸çŸ¥é“æ˜¯å› ä¸ºå‚æ•°å˜åŒ–å¯¼è‡´ï¼Œè¿˜æ˜¯å†…éƒ¨æŸ¥è¯¢é€»è¾‘å˜åŒ–ã€‚å¦‚æœæ˜¯å‚æ•°ï¼Œæ‹…å¿ƒæœ‰ä¸€å¤©è¢«äººè®¾ç½®é”™ï¼Œåˆå›æ»šåˆ°ä¸å¥½çš„æƒ…å†µ. è€å¸ˆï¼Œæˆ‘æƒ³å…¥å‘æºç äº†â€¦ ","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441318,"discussion_content":"è¿™ç§æƒ…å†µæœ€é€‚åˆæºç å…¥å‘ğŸ˜„\n\nä½ æœ‰ä¸¤ä¸ªå¯ä»¥ç¨³å®šå¤ç°çš„å¯¹æ¯”åœºæ™¯ï¼Œè€Œä¸”å•çº¿ç¨‹å°±èƒ½å¤ç°ã€‚\n\nè¿™ä¸¤å¤©æˆ‘ç”¨ç”µè„‘ä¸æ–¹ä¾¿ï¼Œä¸‹å‘¨æœ«æ¥ç»™å‡ºç­”æ¡ˆå“ˆã€‚\n\nä½ å¯å¦æŠŠ5.6/5.7è¿™ä¸ªå¯¹ç…§è¯•éªŒç»„ï¼ŒåŒ…æ‹¬å®éªŒè¿‡ç¨‹å’Œç»“æœå·®å¼‚ï¼Œå†å•ç‹¬å†™ä¸€ä¸ªé—®é¢˜ğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551489810,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":71581,"user_name":"Long","can_delete":false,"product_type":"c1","uid":1318970,"ip_address":"","ucode":"2417242560360A","user_header":"https://static001.geekbang.org/account/avatar/00/14/20/3a/90db6a24.jpg","comment_is_top":false,"comment_ctime":1551387444,"is_pvip":false,"replies":[{"id":"25853","content":"ä½ å¦‚æœæ˜¯innodb_stats_on_metadataè®¾ç½®ä¸ºoffçš„è¯ï¼Œç¬¬äºŒä¸ªè¯­å¥æ˜¯ä¸ç”¨æ‰“å¼€è¡¨çš„ã€‚","user_name":"ä½œè€…å›å¤","comment_id":71581,"uid":"1264162","ip_address":"","utype":1,"ctime":1551427516,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"5846354740","product_id":100020801,"comment_content":"è¿½é—®ï¼šå¤šè°¢è€å¸ˆå›å¤ï¼Œåœ¨ä¸Šé¢å›å¤ä¸­ï¼Œä¸ºä»€ä¹ˆè¯­å¥2ä¼šé˜»å¡å…¶ä»–çš„çº¿ç¨‹æŠŠå…¶ä»–çº¿ç¨‹éƒ½å¡åœ¨opening tables å’Œclosing tablesï¼Œè€Œè¯­å¥1ä¸ä¼š.<br><br>çŒœæµ‹æ˜¯ä¸æ˜¯è¯­å¥2ç”¨äº†lock_opençš„æ–¹æ³•ï¼Ÿ<br>è€å¸ˆæœ‰ä»€ä¹ˆå¥½çš„å»ºè®®ï¼Œæˆ‘æ€ä¹ˆèƒ½é€šè¿‡æ—¥å¿—æˆ–è€…è°ƒè¯•æ¥çœ‹ï¼Ÿ<br>å·²ç»çœ‹äº†innodb status, processlist, profilingéƒ½çœ‹äº†ï¼Œæ²¡å‘ç°å¼‚å¸¸<br><br>è¯­å¥1: SELECT table_name, table_schema, data_length, index_length FROM information_schema.TABLES WHERE ENGINE in (&#39;MyISAM&#39;,&#39;InnoDB&#39;) and table_schema &lt;&gt; &#39;information_schema&#39;;<br><br>è¯­å¥2:select count(1) from information_schema.tables where table_schema = &#39;abc&#39;;","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441219,"discussion_content":"ä½ å¦‚æœæ˜¯innodb_stats_on_metadataè®¾ç½®ä¸ºoffçš„è¯ï¼Œç¬¬äºŒä¸ªè¯­å¥æ˜¯ä¸ç”¨æ‰“å¼€è¡¨çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551427516,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":307094,"user_name":"yangman","can_delete":false,"product_type":"c1","uid":2560936,"ip_address":"","ucode":"6793F5F429F7A2","user_header":"https://static001.geekbang.org/account/avatar/00/27/13/a8/38255467.jpg","comment_is_top":false,"comment_ctime":1628857974,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1628857974","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæœ‰ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆç›¸åŒçš„æ•°æ®ï¼Œt1å’Œt2çš„data_lengthä¼šç›¸å·®è¿™ä¹ˆå¤§ï¼Ÿ <br>Name |Engine|Rows |Data_length|<br>-----+------+-----+-----------+<br>t1   |MEMORY|   10|     126992|<br>t2   |InnoDB|   10|      16384|<br>","like_count":0},{"had_liked":false,"id":295854,"user_name":"bulingbuling","can_delete":false,"product_type":"c1","uid":2370543,"ip_address":"","ucode":"62698131C1E1CE","user_header":"https://static001.geekbang.org/account/avatar/00/24/2b/ef/7d650974.jpg","comment_is_top":false,"comment_ctime":1622620192,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622620192","product_id":100020801,"comment_content":"è€å¸ˆ:<br>memoryå’Œinnodbå¼•æ“çš„åŒºåˆ«ç¬¬3ç‚¹:æ•°æ®ä½ç½®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼ŒInnoDB è¡¨åªéœ€è¦ä¿®æ”¹ä¸»é”®ç´¢å¼•ï¼Œè€Œå†…å­˜è¡¨éœ€è¦ä¿®æ”¹æ‰€æœ‰ç´¢å¼•ã€‚è¿™å¥è¯æ²¡ç†è§£ï¼Œæ•°æ®ä½ç½®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œmemoryä¿®æ”¹æ‰€æœ‰ç´¢å¼•çš„åŸç†æ˜¯ä»€ä¹ˆ","like_count":0},{"had_liked":false,"id":261324,"user_name":"Geek_66dfcd","can_delete":false,"product_type":"c1","uid":1996833,"ip_address":"","ucode":"456EA0A9DBDAD2","user_header":"","comment_is_top":false,"comment_ctime":1605271948,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1605271948","product_id":100020801,"comment_content":"ä¸´æ—¶è¡¨æ˜¯ä¸´æ—¶è¡¨ï¼Œä¸´æ—¶è¡¨å­˜åœ¨ç£ç›˜ä¸Šï¼Œå†…å­˜è¡¨æ˜¯å†…å­˜è¡¨ï¼Œå†…å­˜è¡¨å­˜åœ¨å†…å­˜ä¸­ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œè¯´ç”¨æˆ·ä¸´æ—¶è¡¨æ˜¯æ™®é€šå†…å­˜è¡¨çš„ä¸€ä¸ªä¾‹å¤–å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1622022,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJia6zEsh2u119zJicmq7wApvnricZEKiawaZicice1cOzujWdFicFwPtavlHiaVpCNgCpxBtdl7ynd3y0wkQ/132","nickname":"james_xu","note":"","ucode":"12E50291F5BA89","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351729,"discussion_content":"ä¸´æ—¶è¡¨å¯ä»¥ä½¿ç”¨å„ç§å­˜å‚¨å¼•æ“ï¼Œå¹¶ä¸ä¸€å®šæ˜¯åœ¨ç£ç›˜ä¸Šçš„å“ˆï¼›å†…å­˜è¡¨æŒ‡çš„å°±æ˜¯ä½¿ç”¨äº†memoryå¼•æ“çš„è¡¨","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1614417658,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":259154,"user_name":"DavidJiang","can_delete":false,"product_type":"c1","uid":1643779,"ip_address":"","ucode":"92EBF337569A1B","user_header":"https://static001.geekbang.org/account/avatar/00/19/15/03/682bd618.jpg","comment_is_top":false,"comment_ctime":1604641959,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1604641959","product_id":100020801,"comment_content":"æŒ‰ç…§å…¨è¡¨æ‰«æåŸç†ï¼Œæ‰«æçš„è¡Œæ•°åº”è¯¥æ˜¯æ€»è¡Œæ•°ã€‚ä½†æ˜¯å¦‚ä¸‹å®éªŒå‘ç°å¹¶ä¸ç›¸åŒã€‚â€”todo list<br>               å¦å¤–ï¼Œå¢åŠ äº†listï¼ŒåŸåˆ™ä¸Šåº”è¯¥æ‰«æå‰åè¡Œå°±å¯ä»¥äº†ï¼Œä¸ºå•¥ä¹Ÿæ˜¯å…¨è¡¨æ‰«æ<br>mysql&gt; select count(*) from employees;<br>+----------+<br>| count(*) |<br>+----------+<br>|   300024 |<br>+----------+<br>1 row in set (0.09 sec)<br><br><br>mysql&gt; explain select * from employees ;<br>+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------+<br>| id | select_type | table     | partitions | type | possible_keys | key  | key_len | ref  | rows   | filtered | Extra |<br>+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------+<br>|  1 | SIMPLE      | employees | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 299202 |   100.00 | NULL  |<br>+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------+<br>1 row in set, 1 warning (0.02 sec)<br><br><br>mysql&gt; explain select * from employees limit 10;<br>+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------+<br>| id | select_type | table     | partitions | type | possible_keys | key  | key_len | ref  | rows   | filtered | Extra |<br>+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------+<br>|  1 | SIMPLE      | employees | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 299202 |   100.00 | NULL  |<br>+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------+<br>1 row in set, 1 warning (0.01 sec)<br>","like_count":0,"discussions":[{"author":{"id":2222614,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/1fXYkS0UlZUQQtzUpG2TZzVhVZHarfpWT5wjO7iajw959zysQks1vLFM2uQsKnYG3uQAhzenH9LP86goiciaCDNibQ/132","nickname":"Xingyi_Xie","note":"","ucode":"D1849DB8BFB1B2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":404101,"discussion_content":"è¯¾ç¨‹ç¬¬10ç« è®²äº†ï¼Œexplain çš„ rows æ˜¯é‡‡æ ·ç»Ÿè®¡å¾—åˆ°çš„ä¸€ä¸ªä¼°ç®—ï¼Œä¸çœŸå®çš„æ€»è¡Œæ•°æœ‰ä¸€å®šåå·®ã€‚é‚£ä¸ª limit 10 ä¸ºå•¥è¦å…¨è¡¨æ‰«æï¼Œæˆ‘ä¹Ÿä¸ä¼š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634222935,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":259151,"user_name":"DavidJiang","can_delete":false,"product_type":"c1","uid":1643779,"ip_address":"","ucode":"92EBF337569A1B","user_header":"https://static001.geekbang.org/account/avatar/00/19/15/03/682bd618.jpg","comment_is_top":false,"comment_ctime":1604641629,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1604641629","product_id":100020801,"comment_content":"     åšä¸»å¥½ï¼Œå¤§å®¶å¥½ï¼Œè¯·æ•™ä¸¤ä¸ªé—®é¢˜ã€‚<br>1ã€é—®é¢˜ä¸€ï¼šä¸æŒ‡å®šé¡ºåºæ˜¯å¦å°±æ˜¯æŒ‰ç…§ä¸»é”®ç´¢å¼•é¡ºåºè¾“å‡ºç»“æœã€‚ä¸‹é¢æ˜¯éªŒè¯éƒ¨åˆ†<br>mysql&gt; select * from employees limit 10;<br>mysql&gt; select emp_no from employees limit 10;<br>+--------+<br>| emp_no |<br>+--------+<br>|  10001 |<br>|  10002 |<br>|  10003 |<br>|  10004 |<br>|  10005 |<br>|  10006 |<br>|  10007 |<br>|  10008 |<br>|  10009 |<br>|  10010 |<br><br>mysql&gt; select first_name from employees limit 10;<br>+------------+<br>| first_name |<br>+------------+<br>| Georgi     |<br>| Bezalel    |<br>| Parto      |<br>| Chirstian  |<br>| Kyoichi    |<br>| Anneke     |<br>| Tzvetan    |<br>| Saniya     |<br>| Sumant     |<br>| Duangkaew  |<br><br>é—®é¢˜äºŒã€selectå¦‚æœå…¨è¡¨æ‰«æï¼ŒæŒ‰ç…§æ–‡ç« åˆ†æåº”è¯¥æ‰«æè¡Œæ•°å°±æ˜¯æ€»çš„rowsæ•°ï¼Œä½†æ˜¯éªŒè¯ç»“æœç¡®ä¸æ˜¯ï¼Œä¸ºå•¥ï¼Ÿå¦å¤–ï¼ŒåŠ limitä¸ºå•¥è¿˜æ˜¯å…¨è¡¨æ‰«æï¼Ÿ<br>mysql&gt; select count(*) from employees;<br>+----------+<br>| count(*) |<br>+----------+<br>|   300024 |<br>+----------+<br><br>mysql&gt; explain select * from employees ;<br>+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------+<br>| id | select_type | table     | partitions | type | possible_keys | key  | key_len | ref  | rows   | filtered | Extra |<br>+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------+<br>|  1 | SIMPLE      | employees | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 299202 |   100.00 | NULL  |<br><br><br>mysql&gt; explain select * from employees limit 10;<br>+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------+<br>| id | select_type | table     | partitions | type | possible_keys | key  | key_len | ref  | rows   | filtered | Extra |<br>+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------+<br>|  1 | SIMPLE      | employees | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 299202 |   100.00 | NULL  |<br>+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------+","like_count":0,"discussions":[{"author":{"id":1134574,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4f/ee/bd08cfab.jpg","nickname":"ä¸€é­„","note":"","ucode":"71541125D4AA5A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":409528,"discussion_content":"è¿™é‡Œä¸æ˜¯åšå®¢å•Šï¼Œè¿˜åšä¸»å‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635462116,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":219167,"user_name":"æ¹®æ±","can_delete":false,"product_type":"c1","uid":1106268,"ip_address":"","ucode":"FB6185621891E5","user_header":"https://static001.geekbang.org/account/avatar/00/10/e1/5c/86606d9c.jpg","comment_is_top":false,"comment_ctime":1589960029,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1589960029","product_id":100020801,"comment_content":"åˆ©ç”¨ä¸´æ—¶è¡¨å»è¿›è¡Œå…³è”æŸ¥è¯¢ï¼Œç‰¹åˆ«æ˜¯åœ¨å†™æŠ¥è¡¨çš„æ—¶å€™å»ç”¨ä¸´æ—¶è¡¨ï¼Œé‚£ä¹ˆé€Ÿåº¦ä¼šæ›´å¿«ï¼","like_count":0},{"had_liked":false,"id":174578,"user_name":"Zhaoyang","can_delete":false,"product_type":"c1","uid":1037190,"ip_address":"","ucode":"131D83AC2566D2","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d3/86/b5d72c87.jpg","comment_is_top":false,"comment_ctime":1580284312,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1580284312","product_id":100020801,"comment_content":"å†…å­˜è¡¨ï¼šé”ç²’åº¦æ¯”è¾ƒç²—ï¼Œè¿˜æœ‰å°±æ˜¯æ”¾åˆ°å†…å­˜é‡Œé¢é‡å¯ä¼šä¸¢æ•°æ®ã€‚","like_count":0},{"had_liked":false,"id":121325,"user_name":"é’±","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1565100181,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565100181","product_id":100020801,"comment_content":"è€å¸ˆ memory å¼•æ“ï¼Œåªæœ‰è¡¨é”ï¼Œè¿™ä¸ªè¡¨é”æ˜¯é”åœ¨å“ªé‡Œï¼Ÿ<br>â€œåœ¨å†…å­˜è¡¨ t1 ä¸­ï¼Œå½“æˆ‘æ‰§è¡Œ select * çš„æ—¶å€™ï¼Œèµ°çš„æ˜¯å…¨è¡¨æ‰«æï¼Œä¹Ÿå°±æ˜¯é¡ºåºæ‰«æè¿™ä¸ªæ•°ç»„ã€‚å› æ­¤ï¼Œ0 å°±æ˜¯æœ€åä¸€ä¸ªè¢«è¯»åˆ°ï¼Œå¹¶æ”¾å…¥ç»“æœé›†çš„æ•°æ®ã€‚â€<br>è¿™ä¸ªæ•°ç»„æ˜¯æŒ‡å­˜æ”¾æ•°æ®çš„æ•°ç»„ï¼Œè¿™æ¬¡(0,0)æ˜¯åœ¨æ•°æ®æ•°ç»„çš„æœ€åï¼Œéš¾é“æ¯æ¬¡éƒ½ä¼šæ”¾åœ¨æœ€åï¼Œæ²¡æ˜ç™½ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ<br>å¦å¤–ï¼Œçœ‹å›¾3å­˜æ”¾æ•°æ®çš„æ•°ç»„æ˜¯æœ‰åºçš„ï¼Œéš¾é“æ˜¯å…ˆä¾æ¬¡å­˜å¥½æ•°æ®ï¼Œç„¶åå¯¹ä¸»é”®å“ˆå¸Œå®šä½ä¸»é”®åº”è¯¥å­˜æ”¾çš„ä½ç½®ï¼Ÿ","like_count":0},{"had_liked":false,"id":111070,"user_name":"Geek_37984c","can_delete":false,"product_type":"c1","uid":1218347,"ip_address":"","ucode":"7A319AE28599B0","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLvdWoCic6ItzibF8ia8vrUTRuyj6AT3tg5f4QicIK0jTIFheJ6274ZkibuRLFP1NXG3jibv5TiaSKNoJpLw/132","comment_is_top":false,"comment_ctime":1562464629,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1562464629","product_id":100020801,"comment_content":"æ•°æ®ä½ç½®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼ŒInnoDB è¡¨åªéœ€è¦ä¿®æ”¹ä¸»é”®ç´¢å¼•ï¼Œè€Œå†…å­˜è¡¨éœ€è¦ä¿®æ”¹æ‰€æœ‰ç´¢å¼•ï¼Ÿ<br>--è€å¸ˆå†…å­˜è¡¨ä¸ºä»€ä¹ˆè¦ä¿®æ”¹æ‰€æœ‰ç´¢å¼•ï¼Œåˆ æ—§æ•°æ®ï¼Œå†æ–°å¢ä¸€æ¡æ˜¯å¦å°±å¯ä»¥è§£å†³<br><br>","like_count":0,"discussions":[{"author":{"id":2377275,"avatar":"https://static001.geekbang.org/account/avatar/00/24/46/3b/ac4b8ab0.jpg","nickname":"Streamä¸Šçš„å¸§","note":"","ucode":"325FBEFF80BD91","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337555,"discussion_content":"ç´¢å¼•ä¸Šå­˜çš„æ˜¯æ•°æ®çš„åœ°å€ï¼Œå½“æ•°æ®çš„ä½ç½®å‘ç”Ÿå˜åŒ–ï¼Œéœ€è¦ä¿®æ”¹æ‰€æœ‰çš„ç´¢å¼•ä¸Šæ•°æ®çš„åœ°å€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608972181,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104680,"user_name":"çº¸ç‰‡äºº","can_delete":false,"product_type":"c1","uid":1358508,"ip_address":"","ucode":"84490E7CEF59A4","user_header":"https://static001.geekbang.org/account/avatar/00/14/ba/ac/b44b256a.jpg","comment_is_top":false,"comment_ctime":1560817722,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560817722","product_id":100020801,"comment_content":"ç­‰ç­‰ï¼Œæˆ‘å¥½åƒæ˜ç™½äº†ã€‚ç»“åˆä¸‹æ–‡ï¼Œè¿™é‡Œè¯´çš„â€œè¯¡å¼‚â€ç°è±¡æ˜¯åœ¨åŒMæ¶æ„ä¸­ï¼Œç”¨æˆ·æ²¡æœ‰æ–­å¼€è¿æ¥æˆ–æ”¶åˆ°é”™è¯¯æŠ¥å‘Šçš„æƒ…å†µä¸‹ï¼Œçœ‹åˆ°è¡¨t1çš„æ•°æ®å…¨éƒ¨æ¶ˆå¤±äº†ï¼è¿™ä¸ç¬¦åˆéš”ç¦»æ€§ã€‚è¿™å°±ç›¸å½“äºï¼ŒMySQLä¸€è¾¹å‘Šè¯‰ä½ â€œä¸€åˆ‡æ­£å¸¸â€ï¼Œä¸€è¾¹å·å·åˆ é™¤äº†ä½ çš„æ•°æ®ã€‚","like_count":0},{"had_liked":false,"id":66956,"user_name":"å¤œç©ºä¸­æœ€äº®çš„æ˜Ÿ","can_delete":false,"product_type":"c1","uid":1267566,"ip_address":"","ucode":"ADC3E7B6789955","user_header":"https://static001.geekbang.org/account/avatar/00/13/57/6e/b6795c44.jpg","comment_is_top":false,"comment_ctime":1550047517,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1550047517","product_id":100020801,"comment_content":"è€å¸ˆï¼Œç»“åˆè¯¾ç¨‹ å’Œ  MySQL8 çš„æ–°æŠ€æœ¯ è€å¸ˆæœ‰å‡ºä¹¦çš„è®¡åˆ’å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":66902,"user_name":"Long","can_delete":false,"product_type":"c1","uid":1318970,"ip_address":"","ucode":"2417242560360A","user_header":"https://static001.geekbang.org/account/avatar/00/14/20/3a/90db6a24.jpg","comment_is_top":false,"comment_ctime":1550039412,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1550039412","product_id":100020801,"comment_content":"è€å¸ˆå¯èƒ½æ²¡çœ‹åˆ°ï¼Œå†å‘ä¸‹ã€‚<br><br>è€å¸ˆæ–°å¹´å¥½ :-)<br>åˆšå¥½é‡åˆ°ä¸€ä¸ªé—®é¢˜ã€‚ <br><br>æœ¬æ¥å‡†å¤‡æ›´æ–°åˆ°ï¼Œä¸€ä¸ªæŸ¥è¯¢æ˜¯æ€ä¹ˆè¿è¡Œçš„é‡Œé¢çš„ï¼Œçœ‹åˆ°è¿™ç¯‡æ›´æ–°æ–‡ç« ï¼Œå°±å†™åœ¨è¿™å§ï¼Œå¸Œæœ›è€å¸ˆå¸®å¿™è§£ç­”ã€‚<br><br>å…³äºè¿™ä¸ªç³»ç»Ÿmemoryå¼•æ“è¡¨ï¼šinformation_schema.tables<br>ç›¸å…³ä¿¡æ¯å¦‚ä¸‹<br>ï¼ˆ1ï¼‰Verison: MySQL 5.6.26<br>ï¼ˆ2ï¼‰æ•°æ®é‡table_schema = abcçš„æœ‰æ¥è¿‘4Wçš„è¡¨ï¼Œæ•´ä¸ªå®ä¾‹æœ‰æ¥è¿‘10Wçš„è¡¨ã€‚ï¼ˆé»˜è®¤innodbå¼•æ“ï¼‰<br>ï¼ˆ3ï¼‰mysql.userå’Œmysql.dbçš„æ•°æ®é‡éƒ½æ˜¯100-200çš„è¡Œæ•°ï¼ŒMyISAMå¼•æ“ã€‚<br>ï¼ˆ4ï¼‰é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«RC<br><br><br>åœ¨è¿è¡ŒæŸ¥è¯¢è¯­å¥1çš„æ—¶å€™ï¼šselect * from information_schema.tables where table_schema = &#39;abc&#39;;<br>çŠ¶æ€ä¸€ç›´æ˜¯check permissionï¼Œopening tablesï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦æ‰“å¼€çš„è¡¨åœ¨opend tablesé‡Œé¢è¢«åˆ·æ‰çš„ï¼Œä¼šæ˜¾ç¤ºåœ¨opening tablesï¼Œå¯èƒ½éœ€è¦å°å‡ ç§’åå…¶ä»–çº¿ç¨‹åŸºæœ¬æ¢å¤æ­£å¸¸ã€‚<br><br>ä½†æ˜¯å¦‚æœåœ¨è¿è¡ŒæŸ¥è¯¢è¯­å¥2ï¼šselect count(1) from information_schema.tables where table_schema = &#39;abc&#39;; è¿™ä¸ªæ—¶å€™è¯­å¥2æœ¬èº«åœ¨profilingçœ‹é•¿æœŸå¤„äºcheck permissionçŠ¶æ€ï¼Œå…¶ä»–çº¿ç¨‹å°±ä¼šå‡ºç°è¢«é˜»å¡ç°è±¡ï¼Œå¤§éƒ¨åˆ†å¡åœ¨äº†opening tablesï¼Œå°éƒ¨åˆ†closing tablesã€‚æˆ‘æµ‹è¯•ä¸‹äº†ï¼Œå•ä¸ªè¡¨æŸ¥è¯¢çš„æ—¶å€™check permissionå¤§æ¦‚ä¹Ÿå°±æ˜¯0.0005så·¦å³çš„æ—¶é—´ï¼Œ4Wä¸ªè¡¨ç†è®ºè‰¯å¥½çŠ¶æ€åº”è¯¥æ˜¯å‡ åç§’çš„äº‹æƒ…ã€‚<br>ä½†æ˜¯è¯­å¥1å¯èƒ½éœ€è¦5-10åˆ†é’Ÿï¼Œè¯­å¥2éœ€è¦5åˆ†é’Ÿã€‚<br><br>3ä¸ªé—®é¢˜ï¼Œè¯·è€å¸ˆæŠ½ç©ºçœ‹ä¸‹ï¼š<br>ï¼ˆ1ï¼‰information_schema.tablesçš„ç»„æˆæ–¹å¼ï¼Œæ˜¯æˆ‘æ¯æ¬¡æŸ¥è¯¢çš„æ—¶å€™ä»æ•°æ®å­—å…¸ä»¥åŠdataç›®å½•ä¸‹çš„æ–‡ä»¶ä¸­å®æ—¶å»è¯»çš„å—ï¼Ÿ<br>ï¼ˆ2ï¼‰è¯­å¥1å’Œè¯­å¥2åœ¨è¿è¡Œçš„æ—¶å€™çš„è¿‡ç¨‹åˆ†åˆ«æ˜¯æ€æ ·çš„ï¼Œç‰¹åˆ«æ˜¯è¯­å¥2ã€‚<br>ï¼ˆ3ï¼‰è¯­å¥2ä¸ºä»€ä¹ˆä¼šå‡ºç°å¤§é‡é˜»å¡å…¶ä»–äº‹åŠ¡ï¼Œå…¶ä»–äº‹åŠ¡éƒ½å¡åœ¨opening tablesçš„çŠ¶æ€ã€‚<br><br><br>PS: æœ€åæ ¹æ®audit logåˆ†ææ¥çœ‹ï¼Œè¯­å¥å®é™…ä¸Šæ˜¯MySQLçš„ä¸€ä¸ªå®¢æˆ·ç«¯Toadå‘èµ·çš„ï¼Œå½“ä½¿ç”¨Toadçš„object explorerçš„ç•Œé¢æ¥æŸ¥è¯¢è¡¨ï¼Œæˆ–è€…è®¾ç½®connectionçš„æ—¶å€™æŒ‡å®šçš„çš„default schemaæ˜¯å¤§åŸŸçš„æ—¶å€™å°±ä¼šrunè¿™ä¸ªè¯­å¥ï¼šï¼ˆtable_schemaæ”¹æˆäº†abcï¼Œå…¶ä»–éƒ½æ˜¯åŸæ ·ï¼‰<br>SELECT COUNT(1) FROM information_schema.tables WHERE table_schema = &#39;abc&#39; AND table_type != &#39;VIEW&#39;;<br><br><br>å†æ¬¡æ„Ÿè°¢ï¼","like_count":0},{"had_liked":false,"id":66550,"user_name":"æœ±é«˜å»º","can_delete":false,"product_type":"c1","uid":1198647,"ip_address":"","ucode":"CE0471603B6A58","user_header":"https://static001.geekbang.org/account/avatar/00/12/4a/37/2c45c5f5.jpg","comment_is_top":false,"comment_ctime":1549957647,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1549957647","product_id":100020801,"comment_content":"å¤‡åº“è¦é‡å¯ï¼Œé‚£ä¹ˆå¤‡åº“çš„è®¿é—®ä¸šåŠ¡æµé‡åº”è¯¥ä¼šè¢«æ‘˜é™¤ï¼Œé‚£ä¹ˆåœ¨å¤‡åº“æ‘˜é™¤è®¿é—®æµé‡ä¹‹åï¼Œé‡å¯ä¹‹å‰ï¼Œå°†å¤‡åº“çš„å†…å­˜è¡¨å¼•æ“æ”¹ä¸ºinnodbï¼Œå†é‡å¯å¤‡åº“ã€‚å¦‚æœä¸šåŠ¡å¿…é¡»ä½¿ç”¨memoryå¼•æ“ï¼Œå¯ä»¥åœ¨é‡å¯ä¹‹åæ”¹å›memoryå¼•æ“ã€‚","like_count":0},{"had_liked":false,"id":65806,"user_name":"HuaMax","can_delete":false,"product_type":"c1","uid":1118488,"ip_address":"","ucode":"2E78DE1AF098AF","user_header":"https://static001.geekbang.org/account/avatar/00/11/11/18/8cee35f9.jpg","comment_is_top":false,"comment_ctime":1549672814,"is_pvip":false,"replies":[{"id":"23284","content":"å—¯ï¼Œå¦‚æœå¯ä»¥æ”¹å¼•æ“ï¼Œä¹Ÿæ˜¯æå¥½çš„ğŸ˜„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1549789544,"ip_address":"","comment_id":65806,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1549672814","product_id":100020801,"comment_content":"è¯¾åé¢˜ã€‚æ˜¯ä¸æ˜¯å¯ä»¥åŠ ä¸Šåˆ›å»ºè¡¨çš„æ“ä½œï¼Œå¹¶ä¸”æ˜¯innodb ç±»å‹çš„ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438595,"discussion_content":"å—¯ï¼Œå¦‚æœå¯ä»¥æ”¹å¼•æ“ï¼Œä¹Ÿæ˜¯æå¥½çš„ğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549789544,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65783,"user_name":"è€æ¨åŒå¿—","can_delete":false,"product_type":"c1","uid":1246199,"ip_address":"","ucode":"3F334F0CFD3DE6","user_header":"https://static001.geekbang.org/account/avatar/00/13/03/f7/3a493bec.jpg","comment_is_top":false,"comment_ctime":1549637919,"is_pvip":false,"replies":[{"id":"23261","content":"é¢˜ç›®é‡Œè¯´çš„æ˜¯ â€œå¤‡åº“é‡å¯â€å“ˆ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1549668823,"ip_address":"","comment_id":65783,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1549637919","product_id":100020801,"comment_content":"å®‰è£…ä¹‹å‰å­¦çš„çŸ¥è¯†ï¼ŒæŠŠä¸»åº“deleteè¯­å¥çš„gtidï¼Œè®¾ç½®åˆ°ä»åº“ä¸­ï¼Œå°±å¯ä»¥è·³è¿‡è¿™æ¡è¯­å¥äº†å§ã€‚<br>ä½†æ˜¯ä¸»å¤‡ä¸ä¸€è‡´æ˜¯ä¸æ˜¯è¦ä¹Ÿå¤„ç†ä¸€ä¸‹ï¼Œå°†ä¸»åº“çš„å†…å­˜è¡¨æ•°æ®å¤‡ä»½ä¸€ä¸‹ã€‚ç„¶ådeleteæ•°æ®ï¼Œé‡æ–°æ’å…¥ã€‚<br>ç­‰å¤‡ä»¶æ‰§è¡Œè€…ä¸¤ä¸ªè¯­å¥åï¼Œä¸»å¤‡åº”è¯¥éƒ½æœ‰æ•°æ®äº†","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438586,"discussion_content":"é¢˜ç›®é‡Œè¯´çš„æ˜¯ â€œå¤‡åº“é‡å¯â€å“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549668823,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}