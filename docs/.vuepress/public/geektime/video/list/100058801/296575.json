{"id":296575,"title":"42 | BroadcastState介绍与使用","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-Flink\">https://gitee.com/geektime-geekbang/geektime-Flink</a></p>","comments":[{"had_liked":false,"id":254990,"user_name":"yang","can_delete":false,"product_type":"c3","uid":1074310,"ip_address":"","ucode":"1AA1497C5A293C","user_header":"https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg","comment_is_top":false,"comment_ctime":1603246161,"is_pvip":false,"replies":[{"id":93231,"content":"想象一下所有Task的状态数据恢复都要到一个实例里面取数据恢复，这样会对这个Task造成非常大的压力的，每个Task都要做快照这样就能从本地恢复。","user_name":"作者回复","user_name_real":"张利兵","uid":1119779,"ctime":1603525737,"ip_address":"","comment_id":254990,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"老师， 各个task都对bc做快照， 防止恢复的时候从一个task做恢复，造成热点压力， 这个该怎么理解？","like_count":0,"discussions":[{"author":{"id":1119779,"avatar":"https://static001.geekbang.org/account/avatar/00/11/16/23/99c7ede5.jpg","nickname":"张利兵","note":"","ucode":"DBAE17970AB143","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":507579,"discussion_content":"想象一下所有Task的状态数据恢复都要到一个实例里面取数据恢复，这样会对这个Task造成非常大的压力的，每个Task都要做快照这样就能从本地恢复。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603525737,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":288241,"user_name":"Geek9379","can_delete":false,"product_type":"c3","uid":2206775,"ip_address":"","ucode":"166CF28C2CE8F8","user_header":"","comment_is_top":false,"comment_ctime":1618376158,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"视频中给的例子，是不是可以理解为就是把配置数据进行广播？","like_count":2},{"had_liked":false,"id":275939,"user_name":"姜威","can_delete":false,"product_type":"c3","uid":1440140,"ip_address":"","ucode":"6E115C64FFB0EF","user_header":"https://static001.geekbang.org/account/avatar/00/15/f9/8c/e57f2060.jpg","comment_is_top":false,"comment_ctime":1611722451,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"老师，我在实践的过程中发现connect broadcast流会出现主流和广播流的顺序性问题，导致主流无法关联到广播流中的数据，我在网上找到了两种解决这个问题的方案：1.配置流通过jdbc获取，使用fromCollection，然后再union之前CDC获取的实时流，这样测出的结果是肯定能关联到，但是我想不通为什么union这种预先获取的数据肯定会在connect的时候先流进来... 2.使用ListState的方式，关联不到配置的数据都缓存起来，等配置流加载完毕再进行关联处理，但是这种方式我无法知道何时配置流已经加载完毕，而且在某些情况下会缓存大量数据，清理的时机也不好把控","like_count":2},{"had_liked":false,"id":380878,"user_name":"牛年榴莲","can_delete":false,"product_type":"c3","uid":1183703,"ip_address":"北京","ucode":"230C076193C6C0","user_header":"https://static001.geekbang.org/account/avatar/00/12/0f/d7/31d07471.jpg","comment_is_top":false,"comment_ctime":1694395286,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"单就这节课而言，保存Pattern使用 ValueState 就行了吧","like_count":0},{"had_liked":false,"id":363888,"user_name":"李新卫  ","can_delete":false,"product_type":"c3","uid":1948980,"ip_address":"北京","ucode":"AA3B138B3B49F8","user_header":"https://static001.geekbang.org/account/avatar/00/1d/bd/34/49ef96b2.jpg","comment_is_top":false,"comment_ctime":1670315891,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"“更新state是不能依赖元素到达的顺序”是什么意思？","like_count":0},{"had_liked":false,"id":311728,"user_name":"小乙哥","can_delete":false,"product_type":"c3","uid":1063308,"ip_address":"","ucode":"C77E79BEA0C325","user_header":"https://static001.geekbang.org/account/avatar/00/10/39/8c/ff48ece3.jpg","comment_is_top":false,"comment_ctime":1631429046,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"CEP的实现是基于BroadcastState吗？","like_count":0},{"had_liked":false,"id":310877,"user_name":"学无止境","can_delete":false,"product_type":"c3","uid":1645081,"ip_address":"","ucode":"BE6ADDF082AA69","user_header":"https://static001.geekbang.org/account/avatar/00/19/1a/19/440b0c7e.jpg","comment_is_top":false,"comment_ctime":1630942881,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"有个疑问，这里在外部定义的那个Map类型状态描述符是什么意义呢，实际是用的richfunction里面定义的键控状态","like_count":0},{"had_liked":false,"id":288894,"user_name":"Meow","can_delete":false,"product_type":"c3","uid":1126826,"ip_address":"","ucode":"4A3223C90A7360","user_header":"https://static001.geekbang.org/account/avatar/00/11/31/aa/7d937661.jpg","comment_is_top":false,"comment_ctime":1618755469,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"老师，我有一个场景。是定时从mysql获取数据作为广播流。这里遇到两个问题:1，任务运行的时候主数据流会比广播流先到。2，读取广播流这个任务每天0点状态就会变成state。\n问题一我在BroadcastProcessFunction中的open方法加了一个初始化加载数据的处理方法。\n问题2现在还是没有头绪，怎么能保持这个广播流一直处于running状态啊","like_count":0},{"had_liked":false,"id":283292,"user_name":"Allan","can_delete":false,"product_type":"c3","uid":1310388,"ip_address":"","ucode":"8DA4DBECC2C45C","user_header":"https://static001.geekbang.org/account/avatar/00/13/fe/b4/295338e7.jpg","comment_is_top":false,"comment_ctime":1615693273,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"通过接入广播流然后去匹配规则，符合规则则进行输出，不符合就等待下次符合输出？本次案例我产生如下疑点：1、我们的行为流是我们用户的实时的行为数据产生发送到我们的消息队列，那么我的规则流呢？规则流跟行为流是并行关系吗？这一点没搞明白，因为规则流消费消费完了kafka消费点更新完了就没了，那么这个规则是怎么触发产生呢？ 2、不符合的要一直等待吗？一直没有结束呢？如何处理？","like_count":0,"discussions":[{"author":{"id":1645081,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1a/19/440b0c7e.jpg","nickname":"学无止境","note":"","ucode":"BE6ADDF082AA69","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":392312,"discussion_content":"2. 没有新规则的话，就会用上一次保存的广播状态呀。来新的了就更新状态，状态不清除可以一直使用下去的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630941461,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}