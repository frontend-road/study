{"id":91253,"title":"47 | 性能分析工具","content":"<h1>课件及源代码地址</h1><p><a href=\"https://gitee.com/geektime-geekbang/go_learning\">https://gitee.com/geektime-geekbang/go_learning</a></p><h2>书目推荐</h2><p><a href=\"time://mall?url=https%3A%2F%2Fh5.youzan.com%2Fv2%2Fgoods%2F1ycmk3uob0ryw\">《计算机程序的构造和解释》</a></p>","comments":[{"had_liked":false,"id":115773,"user_name":"Jun","can_delete":false,"product_type":"c3","uid":1591805,"ip_address":"","ucode":"E63783D28EF3C7","user_header":"https://static001.geekbang.org/account/avatar/00/18/49/fd/3f8e75c0.jpg","comment_is_top":false,"comment_ctime":1563723660,"is_pvip":false,"replies":[{"id":42446,"content":"这个地址最好还是对外部屏蔽，通过防火墙设置","user_name":"作者回复","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1563798713,"ip_address":"","comment_id":115773,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"`&#47;debug&#47;pprof` 这样的url路径可以更改吗，不然被黑客获取到这些调试信息不是很不安全？","like_count":4,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"蔡超","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459284,"discussion_content":"这个地址最好还是对外部屏蔽，通过防火墙设置","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563798713,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1056807,"avatar":"https://static001.geekbang.org/account/avatar/00/10/20/27/a6932fbe.jpg","nickname":"虢國技醬","note":"","ucode":"5A192262AA037E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6099,"discussion_content":"可以的，不要用http包默认的defaultServeMux, 自己定义一个，然后把自己想要的路径路由到http/pprof包里的这几个方法：\nfunc Cmdline(w http.ResponseWriter, r *http.Request)\nfunc Handler(name string) http.Handler\nfunc Index(w http.ResponseWriter, r *http.Request)\nfunc Profile(w http.ResponseWriter, r *http.Request)\nfunc Symbol(w http.ResponseWriter, r *http.Request)\nfunc Trace(w http.ResponseWriter, r *http.Request)","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1566667245,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":157560,"user_name":"张sir","can_delete":false,"product_type":"c3","uid":1209431,"ip_address":"","ucode":"52958DF6705208","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJSmAhbvPia1msvk91m5rQLTpicY85f2moFMCcAibictL3OeiaaVREadpHN2O3FwicmylwiclTUJJa1peS1Q/132","comment_is_top":false,"comment_ctime":1575194178,"is_pvip":false,"replies":[{"id":61634,"content":"通常是wall time和cpu time。\nwall time指程序运行的总体时间，包含程序不耗用cpu，被阻塞时的时间\ncpu time，指程序占用cpu的时间","user_name":"作者回复","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1576379201,"ip_address":"","comment_id":157560,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"请问什么叫work_time, 跟cpu时间有什么关系？","like_count":3,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"蔡超","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476467,"discussion_content":"通常是wall time和cpu time。\nwall time指程序运行的总体时间，包含程序不耗用cpu，被阻塞时的时间\ncpu time，指程序占用cpu的时间","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576379201,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":194924,"user_name":"慕华","can_delete":false,"product_type":"c3","uid":1128579,"ip_address":"","ucode":"3026277274798B","user_header":"https://static001.geekbang.org/account/avatar/00/11/38/83/cf789e0e.jpg","comment_is_top":false,"comment_ctime":1585121133,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"OS X 10.15 已经将zsh作为默认shell了，编辑.zshrc即可","like_count":3},{"had_liked":false,"id":288155,"user_name":"escray","can_delete":false,"product_type":"c3","uid":1020525,"ip_address":"","ucode":"1F4204930E47C4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","comment_is_top":false,"comment_ctime":1618324450,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"在安装 graphviz 的时候折腾了很久，macOS Big Sur 11.2.3，主要是在折腾 \n\n```\n&gt; brew cleanup &amp;&amp; brew update\n&gt; brew upgrade\n&gt; xcode-select --install\n&gt; brew install graphviz\n&gt; brew upgrade graphviz\n```\n\n虽然也写过一些程序，但是正儿八经的性能分析工具却没怎么用过。\n\n另外一个问题出现在 flamegraph.pl，虽然下载了，但是去没有赋予执行权限\n\n```\n&gt; chmod 755 flamegraph.pl\n```\n\n看到火焰图的时候还是挺开心的。\n\n- 文件方式适合短时间批量运行的程序\n- HTTP 方式在运行中查看状态\n\n初始化一个 10000 × 10000 的二维数组居然需要 762 MB 的内存，GC 之后更可怕，只有 1.6 MB","like_count":1},{"had_liked":false,"id":243814,"user_name":"仗剑天涯","can_delete":false,"product_type":"c3","uid":1179327,"ip_address":"","ucode":"5EB9BD1132592C","user_header":"https://static001.geekbang.org/account/avatar/00/11/fe/bf/58a8aa1f.jpg","comment_is_top":false,"comment_ctime":1598281461,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"http:&#47;&#47;golang.org&#47;src&#47;runtime&#47;pprof&#47;pprof.go","like_count":1},{"had_liked":false,"id":373518,"user_name":"Nemo","can_delete":false,"product_type":"c3","uid":1657039,"ip_address":"广东","ucode":"2B11D18D6FA2AE","user_header":"https://static001.geekbang.org/account/avatar/00/19/48/cf/8c88e6c0.jpg","comment_is_top":false,"comment_ctime":1682593302,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"使用perf-FlameGraph监控系统性能\nhttps:&#47;&#47;nemo.cool&#47;838.html","like_count":0},{"had_liked":false,"id":337559,"user_name":"Geek_qh28g6","can_delete":false,"product_type":"c3","uid":1109270,"ip_address":"","ucode":"EE63FF6FC27F81","user_header":"https://static001.geekbang.org/account/avatar/00/10/ed/16/85f97327.jpg","comment_is_top":false,"comment_ctime":1646893650,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"root@vita-3:~&#47;go_learning&#47;code&#47;ch46&#47;tools&#47;file# go-torch cpu.prof \nINFO[14:25:10] Run pprof command: go tool pprof -raw -seconds 30 cpu.prof\nFATAL[14:25:10] Failed: could not generate flame graph: fork&#47;exec &#47;usr&#47;bin&#47;flamegraph.pl: exec format error","like_count":0},{"had_liked":false,"id":309153,"user_name":"罗俊聪","can_delete":false,"product_type":"c3","uid":2640817,"ip_address":"","ucode":"1B0E51A8AC8A70","user_header":"","comment_is_top":false,"comment_ctime":1629962855,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"go-torch 现在不建议使用了，go1.1之后pprof内置了火焰图","like_count":0},{"had_liked":false,"id":307019,"user_name":"噼里啪啦啪啦噼里噼里啪啦","can_delete":false,"product_type":"c3","uid":1109143,"ip_address":"","ucode":"2A4B86D38F7E11","user_header":"https://static001.geekbang.org/account/avatar/00/10/ec/97/58e7bc9a.jpg","comment_is_top":false,"comment_ctime":1628826828,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"老师请问我运行go-torch cpu.prof总是出现这种错误是怎么回事呢？我搜索了没有找到答案\n$ go-torch cpu.prof\nINFO[11:47:53] Run pprof command: go tool pprof -raw -seconds 30 cpu.prof\nFATAL[11:47:53] Failed: could not parse raw pprof output: strconv.ParseInt: parsing &quot;runtime.resetForSleep&quot;: invalid syntax\n","like_count":0},{"had_liked":false,"id":301967,"user_name":"Calvin","can_delete":false,"product_type":"c3","uid":1603004,"ip_address":"","ucode":"0EEF5B207623B5","user_header":"https://static001.geekbang.org/account/avatar/00/18/75/bc/89d88775.jpg","comment_is_top":false,"comment_ctime":1626000651,"is_pvip":false,"replies":null,"discussion_count":2,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"Windows 10 要看火焰图怎么搞？","like_count":0,"discussions":[{"author":{"id":1056053,"avatar":"https://static001.geekbang.org/account/avatar/00/10/1d/35/1c0e1a30.jpg","nickname":"Tardis","note":"","ucode":"945358C7420763","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540009,"discussion_content":"可以参考：https://learnku.com/articles/52126","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639918359,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2640817,"avatar":"","nickname":"罗俊聪","note":"","ucode":"1B0E51A8AC8A70","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390643,"discussion_content":"我也没找到，在centos上装了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629949363,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":207604,"user_name":"zhimin","can_delete":false,"product_type":"c3","uid":1312130,"ip_address":"","ucode":"DF6DFBEF6FA297","user_header":"https://static001.geekbang.org/account/avatar/00/14/05/82/51cd0a50.jpg","comment_is_top":false,"comment_ctime":1587116992,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":" 应该是GOROOT&#47;bin 加入$PATH  执行 go get -v github.com&#47;uber&#47;go-torch , 会在 GOROOT&#47;bin 下生成 go-torch 文件","like_count":0},{"had_liked":false,"id":175330,"user_name":"黑色幽默","can_delete":false,"product_type":"c3","uid":1377756,"ip_address":"","ucode":"8543E898BEA5A9","user_header":"https://static001.geekbang.org/account/avatar/00/15/05/dc/520d8a4d.jpg","comment_is_top":false,"comment_ctime":1580655650,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"good","like_count":0},{"had_liked":false,"id":171872,"user_name":"瓜瓜","can_delete":false,"product_type":"c3","uid":1108505,"ip_address":"","ucode":"F90A5135A9BB4B","user_header":"https://static001.geekbang.org/account/avatar/00/10/ea/19/14018371.jpg","comment_is_top":false,"comment_ctime":1579048452,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"可以了，配置环境变量后需要重启idea，因为我是在idea中敲的命令","like_count":0},{"had_liked":false,"id":171864,"user_name":"瓜瓜","can_delete":false,"product_type":"c3","uid":1108505,"ip_address":"","ucode":"F90A5135A9BB4B","user_header":"https://static001.geekbang.org/account/avatar/00/10/ea/19/14018371.jpg","comment_is_top":false,"comment_ctime":1579047906,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"(pprof) svg\nfailed to execute dot. Is Graphviz installed? Error: exec: &quot;dot&quot;: executable file not found in %PATH%\nwindows下为什么报这个错误，老师帮忙看下呢\ngraphviz也是配置的的\n\nC:\\Users\\&gt;dot -version\ndot - graphviz version 2.38.0 (20140413.2041)\nlibdir = &quot;D:\\graphviz\\release\\bin&quot;\nActivated plugin library: gvplugin_dot_layout.dll\nUsing layout: dot:dot_layout\nActivated plugin library: gvplugin_core.dll\nUsing render: dot:core\nUsing device: dot:dot:core\nThe plugin configuration file:\n        D:\\graphviz\\release\\bin\\config6\n                was successfully loaded.\n    render      :  cairo dot fig gd gdiplus map pic pov ps svg tk vm\n    layout      :  circo dot fdp neato nop nop1 nop2 osage patchwork\n    textlayout  :  textlayout\n    device      :  bmp canon cmap cmapx cmapx_np dot emf emfplus eps\n    loadimage   :  (lib) bmp eps gd gd2 gif jpe jpeg jpg png ps svg\n","like_count":0},{"had_liked":false,"id":160295,"user_name":"L心逸","can_delete":false,"product_type":"c3","uid":1559618,"ip_address":"","ucode":"A352B5AC8F21D6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL7Khxhp6YcsayqicjU6c6IBbxn2BZncxOFiasbAQl4ic7rX8fbWicbh9MkvVx3RomSq9icHS1XbMC3Ocw/132","comment_is_top":false,"comment_ctime":1575906586,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"get","like_count":0},{"had_liked":false,"id":157577,"user_name":"张sir","can_delete":false,"product_type":"c3","uid":1209431,"ip_address":"","ucode":"52958DF6705208","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJSmAhbvPia1msvk91m5rQLTpicY85f2moFMCcAibictL3OeiaaVREadpHN2O3FwicmylwiclTUJJa1peS1Q/132","comment_is_top":false,"comment_ctime":1575200348,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"你好，请问我的分析工具报这个错误，是因为返回包太大了吗\n\nFetching profile over HTTP from http:&#47;&#47;127.0.0.1:8081&#47;debug&#47;pprof&#47;heap\nhttp:&#47;&#47;127.0.0.1:8081&#47;debug&#47;pprof&#47;heap: decompressing profile: unexpected EOF\nfailed to fetch any source profiles\n","like_count":0}]}