{"id":803081,"title":"04ï½œMySQLä¸­ä¸åŒç±»å‹çš„å‚æ•°ä¸å‚æ•°é…ç½®","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ä¿Šè¾¾ã€‚</p><p>åœ¨ç¬¬ä¸€è®²ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªæç®€çš„é…ç½®æ–‡ä»¶ï¼ŒåªåŒ…å«äº†æœ€åŸºæœ¬çš„ä¸€äº›å‚æ•°ï¼Œä½¿MySQLèƒ½æ­£å¸¸è¿è¡Œèµ·æ¥ï¼Œä¾¿äºæˆ‘ä»¬è¿›è¡Œæµ‹è¯•ã€ç†Ÿæ‚‰MySQLã€‚ä½†æ˜¯ä¾›æ­£å¼ç¯å¢ƒä½¿ç”¨çš„MySQLå°±ä¸èƒ½ä»…ä»…ä¾èµ–è¿™ä¸ªåŸºç¡€çš„é…ç½®äº†ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®éƒ¨ç½²MySQLçš„ä¸»æœºé…ç½®ã€ä½¿ç”¨MySQLçš„ä¸šåŠ¡åœºæ™¯ç­‰å› ç´ ï¼Œè®¾ç½®åˆç†çš„å‚æ•°ï¼Œä½¿MySQLèƒ½ä»¥æ¯”è¾ƒé«˜çš„æ€§èƒ½è¿è¡Œï¼Œå¹¶æ»¡è¶³ä¸šåŠ¡å¯¹æ•°æ®ä¸€è‡´æ€§çš„è¦æ±‚ã€‚</p><p>è¿™ä¸€è®²ä¸­ï¼Œæˆ‘ä»¬ä¼šä»‹ç»MySQLå‚æ•°é…ç½®çš„åŸºæœ¬æœºåˆ¶ã€‚ç„¶åå†ä»‹ç»ä¸€äº›æ¯”è¾ƒé‡è¦çš„å‚æ•°ï¼Œè®²è§£è¿™äº›å‚æ•°çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•åˆç†åœ°è®¾ç½®è¿™äº›å‚æ•°ã€‚ä½ å¯ä»¥æ ¹æ®è¿™é‡Œæä¾›çš„åŸºæœ¬æ–¹æ³•ï¼Œä¸ºè‡ªå·±çš„MySQLè®¾ç½®ä¸€ä¸ªç›¸å¯¹åˆç†çš„é…ç½®ã€‚</p><h2>MySQLå‚æ•°è®¾ç½®æœºåˆ¶</h2><p>MySQL 8.0æ€»å…±æœ‰å…­ç™¾å¤šä¸ªé…ç½®å‚æ•°ã€‚æœ‰æ—¶å€™æˆ‘ä»¬ä¹Ÿå°†è¿™äº›å‚æ•°ç§°ä¸ºå˜é‡ï¼Œå› ä¸ºå®˜æ–¹æ–‡æ¡£ä¸­çš„æœ¯è¯­æ˜¯Variablesã€‚åŒæ—¶åœ¨MySQLä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å‘½ä»¤show variablesæŸ¥çœ‹å‚æ•°çš„å½“å‰å€¼ã€‚å› æ­¤åœ¨è¿™ä¸€ç³»åˆ—çš„è¯¾ç¨‹ä¸­ï¼Œâ€œå‚æ•°â€å’Œâ€œå˜é‡â€å¾ˆå¤šæ—¶å€™æŒ‡çš„éƒ½æ˜¯åŒä¸€ä¸ªæ¦‚å¿µã€‚</p><h3>è®¾ç½®å‚æ•°</h3><p>æœ‰å‡ ä¸ªæ–¹æ³•éƒ½å¯ä»¥ç”¨æ¥è®¾ç½®å‚æ•°ã€‚é¦–å…ˆmysqldè¿›ç¨‹å¯åŠ¨æ—¶ï¼Œå¯ä»¥æŒ‡å®šä¸€ç³»åˆ—çš„å‘½ä»¤è¡Œå‚æ•°ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªæ¯”è¾ƒå…¸å‹çš„ä¾‹å­ã€‚</p><pre><code class=\"language-go\">$ ps -elf | grep mysqld\n... /usr/local/mysql/bin/mysqld \\\n    --defaults-file=/data/mysql01/my.cnf \\\n    --basedir=/usr/local/mysql \\\n    --datadir=/data/mysql01/data \\\n    --plugin-dir=/usr/local/mysql/lib/plugin \\\n    --user=mysql \\\n    --log-error=/data/mysql01/log/alert.log \\\n    --open-files-limit=1024 \\\n    --pid-file=/data/mysql01/run/mysqld.pid \\\n    --socket=/data/mysql01/run/mysql.sock\n</code></pre><!-- [[[read_end]]] --><p>å½“ç„¶æ›´å¤šçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šæŠŠå‚æ•°å†™åˆ°é…ç½®æ–‡ä»¶ä¸­ã€‚MySQLé»˜è®¤ä¼šä»ä¸€äº›å›ºå®šä½ç½®è¯»å–é…ç½®ã€‚æ‰§è¡Œmysqld --verbose --helpå‘½ä»¤å¯ä»¥è§‚å¯Ÿåˆ°mysqldè¯»å–é»˜è®¤å‚æ•°æ–‡ä»¶çš„è·¯å¾„ã€‚</p><pre><code class=\"language-go\">/opt/mysql# ./bin/mysqld --verbose --help | head -30\n......\n\nDefault options are read from the following files in the given order:\n/etc/my.cnf /etc/mysql/my.cnf /usr/local/mysql/etc/my.cnf ~/.my.cnf\nThe following groups are read: mysql_cluster mysqld server mysqld-8.0\n</code></pre><p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œmysqldé»˜è®¤ä¼šä» <code>/etc/my.cnf</code>ã€<code>/etc/mysql/my.cnf</code>ã€<code>/usr/local/mysql/etc/my.cnf ~/.my.cnf</code> å¤šä¸ªæ–‡ä»¶ä¾æ¬¡è¯»å–é…ç½®ã€‚å¦‚æœæŸä¸ªå‚æ•°åœ¨å¤šä¸ªæ–‡ä»¶éƒ½æœ‰é…ç½®ï¼Œé‚£ä¹ˆå°±ä»¥æœ€åè¯»å–åˆ°çš„é‚£ä¸ªå‚æ•°å€¼ä¸ºå‡†ã€‚å½“ç„¶ï¼Œä¸ºäº†é¿å…å¼•èµ·æ··ä¹±ï¼Œæˆ‘å»ºè®®ä¸€ä¸ªMySQLå®ä¾‹åªä½¿ç”¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ã€‚åœ¨å¯åŠ¨MySQLæ—¶ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°defaults-fileæŒ‡å®šé…ç½®æ–‡ä»¶ï¼ŒæŒ‡å®šè¿™ä¸ªå‚æ•°åï¼ŒMySQLåªä¼šä»è¿™ä¸ªæ–‡ä»¶ä¸­è¯»å–é…ç½®é¡¹ã€‚éœ€è¦æ³¨æ„ï¼Œdefaults-fileåœ¨æ‰€æœ‰å‘½ä»¤è¡Œå‚æ•°ä¸­å¿…é¡»æ’åœ¨æœ€å‰é¢æ‰æœ‰æ•ˆã€‚</p><pre><code class=\"language-go\">mysqld --defaults-file=/data/mysql3306/my.cnf --datadir=......\n</code></pre><p>MySQLçš„å‚æ•°ä¸­ï¼Œæœ‰çš„æ˜¯åªè¯»çš„ï¼Œä½ ä¸èƒ½ä¿®æ”¹è¿™äº›å‚æ•°ã€‚æ¯”å¦‚å‚æ•°lower_case_file_systemåæ˜ äº†æ•°æ®ç›®å½•æ‰€åœ¨çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯å¦åŒºåˆ†æ–‡ä»¶åå¤§å°å†™ï¼Œå®ƒæ˜¯ç”±åº•å±‚æ“ä½œç³»ç»Ÿçš„ç‰¹æ€§å†³å®šçš„ï¼Œæ— æ³•é€šè¿‡å‚æ•°æ¥ä¿®æ”¹ã€‚ä¸€èˆ¬Linuxå’ŒmacOSæ–‡ä»¶ååŒºåˆ†å¤§å°å†™ï¼ŒWindowsä¸åŒºåˆ†æ–‡ä»¶åå¤§å°å†™ã€‚</p><p>æœ‰ä¸€äº›å‚æ•°ä¸èƒ½åŠ¨æ€ä¿®æ”¹ï¼Œä½ åªèƒ½å°†å‚æ•°åŠ åˆ°å‘½ä»¤è¡Œï¼Œæˆ–è€…å°†å‚æ•°å†™åˆ°é…ç½®æ–‡ä»¶ä¸­ã€‚MySQLåªæœ‰åœ¨å¯åŠ¨æ—¶æ‰ä¼šè¯»å–è¿™äº›å‚æ•°ã€‚æ¯”å¦‚å‚æ•°portæŒ‡å®šäº†æ•°æ®åº“çš„ç›‘å¬ç«¯å£ï¼Œè¦ä¿®æ”¹è¿™ä¸ªå‚æ•°ï¼Œåªèƒ½é‡å¯æ•°æ®åº“ã€‚</p><p>è¿˜æœ‰å¾ˆå¤šå‚æ•°å¯ä»¥åŠ¨æ€ä¿®æ”¹ï¼Œä½ å¯ä»¥é€šè¿‡SETå‘½ä»¤ä¿®æ”¹è¿™äº›å‚æ•°ã€‚</p><pre><code class=\"language-go\">mysql&gt; set global slow_query_log=ON;\nQuery OK, 0 rows affected (0.01 sec)\n</code></pre><p>é€šè¿‡SETå‘½ä»¤è®¾ç½®çš„å‚æ•°ï¼Œåªå¯¹å½“å‰è¿è¡Œä¸­çš„å®ä¾‹ç”Ÿæ•ˆï¼Œå®ä¾‹é‡å¯åï¼Œè¿™äº›è®¾ç½®å°±å¤±æ•ˆäº†ã€‚MySQL 8.0å¼€å§‹æ”¯æŒå‚æ•°ä¿®æ”¹æŒä¹…åŒ–ï¼Œé€šè¿‡SET PERSISTå‘½ä»¤æ¥è®¾ç½®ã€‚</p><pre><code class=\"language-go\">mysql&gt; set persist slow_query_log=ON;\nQuery OK, 0 rows affected (0.00 sec)\n</code></pre><p>set persistå‘½ä»¤ä¸ä»…ä¿®æ”¹äº†å‚æ•°çš„å½“å‰å€¼ï¼Œè¿˜ä¼šå°†å‚æ•°çš„è®¾ç½®ä¿å­˜åœ¨æ•°æ®ç›®å½•ï¼ˆdatadirï¼‰ä¸‹çš„mysqld-auto.cnfæ–‡ä»¶ä¸­ã€‚MySQLé‡å¯æ—¶ï¼Œä¼šåŠ è½½mysqld-auto.cnfæ–‡ä»¶ä¸­ä¿å­˜çš„å‚æ•°ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡reset persistå‘½ä»¤å°†å‚æ•°ä»mysqld-auto.cnfä¸­ç§»é™¤ã€‚reset persistä¸ä¼šä¿®æ”¹å˜é‡çš„å½“å‰å€¼ã€‚</p><pre><code class=\"language-go\">mysql&gt; reset persist slow_query_log;\nQuery OK, 0 rows affected (0.00 sec)\n</code></pre><p>æŒ‰å‚æ•°çš„ä½œç”¨èŒƒå›´æ¥çœ‹ï¼ŒMySQLçš„å‚æ•°åˆ†ä¸ºå…¨å±€å‚æ•°å’Œä¼šè¯å‚æ•°ã€‚å…¨å±€å‚æ•°å¯¹æ•´ä¸ªå®ä¾‹ç”Ÿæ•ˆï¼Œéœ€è¦ç”¨SET GLOBALå‘½ä»¤è®¾ç½®ï¼Œä½¿ç”¨SETå‘½ä»¤ä¼šæŠ¥é”™ã€‚</p><pre><code class=\"language-go\">mysql&gt; set innodb_flush_log_at_timeout=1;\nERROR 1229 (HY000): Variable 'innodb_flush_log_at_timeout' is a GLOBAL variable and should be set with SET GLOBAL\n\nmysql&gt; set global innodb_flush_log_at_timeout=1;\nQuery OK, 0 rows affected (0.00 sec)\n</code></pre><p>ä¼šè¯å‚æ•°åªå¯¹æŸä¸€ä¸ªä¼šè¯ç”Ÿæ•ˆï¼Œä½¿ç”¨SETå‘½ä»¤è®¾ç½®ï¼Œä¸èƒ½åŠ GLOBALå…³é”®å­—ã€‚</p><pre><code class=\"language-go\">mysql&gt; set global timestamp=0;\nERROR 1228 (HY000): Variable 'timestamp' is a SESSION variable and can't be used with SET GLOBAL\n\nmysql&gt; set timestamp=0;\nQuery OK, 0 rows affected (0.00 sec)\n</code></pre><p>MySQLä¸­å¾ˆå¤šä¼šè¯å‚æ•°åŒæ—¶æ‹¥æœ‰åŒåçš„å…¨å±€å‚æ•°ã€‚ä½¿ç”¨SET GLOBALå‘½ä»¤æ—¶ï¼Œè®¾ç½®çš„æ˜¯å…¨å±€å˜é‡çš„å€¼ï¼Œä¸å½±å“ç°æœ‰ä¼šè¯çš„Sessionå€¼ï¼ŒåŒ…æ‹¬æ‰§è¡ŒSET GLOBALå‘½ä»¤çš„é‚£ä¸ªä¼šè¯ã€‚ä¼šè¯çœŸæ­£ä½¿ç”¨çš„æ˜¯Sessionå˜é‡çš„å€¼ï¼Œä¼šè¯åˆ›å»ºæ—¶ï¼Œä¼šè¯å˜é‡ä¼šé»˜è®¤è®¾ç½®æˆå…¨å±€å˜é‡çš„å€¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨SETå‘½ä»¤ä¿®æ”¹ä¼šè¯å˜é‡ã€‚</p><pre><code class=\"language-go\">## æŸ¥çœ‹å‚æ•°å½“å‰å€¼\nmysql&gt; show variables like 'long_query_time';\n+-----------------+----------+\n| Variable_name   | Value    |\n+-----------------+----------+\n| long_query_time | 0.100000 |\n+-----------------+----------+\n1 row in set (0.00 sec)\n\n## è®¾ç½®å…¨å±€å€¼\nmysql&gt; set global long_query_time=10;\nQuery OK, 0 rows affected (0.00 sec)\n\n## å½“å‰å€¼æ²¡æœ‰å˜åŒ–\nmysql&gt; show variables like 'long_query_time';\n+-----------------+----------+\n| Variable_name   | Value    |\n+-----------------+----------+\n| long_query_time | 0.100000 |\n+-----------------+----------+\n1 row in set (0.00 sec)\n\n## å…¨å±€å€¼è¢«ä¿®æ”¹äº†\nmysql&gt; show global variables like 'long_query_time';\n+-----------------+-----------+\n| Variable_name   | Value     |\n+-----------------+-----------+\n| long_query_time | 10.000000 |\n+-----------------+-----------+\n1 row in set (0.00 sec)\n</code></pre><p>perconaçš„MySQLåˆ†æ”¯å¯¹å‚æ•°long_query_timeåšäº†ç‰¹æ®Šå¤„ç†ï¼Œä¿®æ”¹å…¨å±€å€¼æ—¶ï¼Œä¹Ÿä¼šä¿®æ”¹å½“å‰å·²ç»å­˜åœ¨çš„é‚£äº›ä¼šè¯çš„å‚æ•°å€¼ï¼Œè¿™æ ·æ›´ç¬¦åˆæˆ‘ä»¬åœ¨è¿™ä¸ªåœºæ™¯ä¸‹çš„éœ€æ±‚ã€‚<br>\nå¦‚æœæƒ³äº†è§£æŸä¸ªå‚æ•°çš„å…·ä½“å«ä¹‰ï¼Œæˆ‘çš„å»ºè®®æ˜¯æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ã€‚</p><ul>\n<li><a href=\"https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html\">Serverå‚æ•°</a></li>\n<li><a href=\"https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html\">InnoDBå‚æ•°</a></li>\n<li><a href=\"https://dev.mysql.com/doc/refman/8.0/en/replication-options-replica.html\">ä¸»å¤‡å¤åˆ¶ç›¸å…³å‚æ•°</a></li>\n</ul><h3>æŸ¥çœ‹å‚æ•°</h3><p>ä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨show variableså’Œshow global variableså‘½ä»¤æŸ¥çœ‹å‚æ•°çš„å½“å‰å€¼ã€‚show global variablesæ˜¾ç¤ºå…¨å±€å‚æ•°çš„é…ç½®å€¼ï¼Œshow variableså‘½ä»¤æ˜¾ç¤ºå½“å‰ä¼šè¯çš„æ‰€æœ‰å‚æ•°å€¼ã€‚</p><pre><code class=\"language-go\">mysql&gt; show variables like 'wait%';\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| wait_timeout  | 28800 |\n+---------------+-------+\n1 row in set (0.01 sec)\n\nmysql&gt; show global variables  like 'wait%';\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| wait_timeout  | 86400 |\n+---------------+-------+\n1 row in set (0.01 sec)\n</code></pre><p>åœ¨ä»¥å‰çš„MySQLç‰ˆæœ¬ä¸­ï¼Œå¦‚æœæƒ³æŸ¥çœ‹åˆ«çš„ä¼šè¯çš„æŸä¸ªå‚æ•°å€¼ï¼Œæ²¡æœ‰å¾ˆç®€ä¾¿çš„æ–¹æ³•ã€‚8.0ä¸­ï¼Œå¯ä»¥åˆ°performance_schema.variables_by_threadè¡¨æŸ¥çœ‹å…¶ä»–ä¼šè¯çš„å˜é‡å€¼ã€‚</p><pre><code class=\"language-go\">mysql&gt;  select * from performance_schema.variables_by_thread \n    where variable_name = 'wait_timeout';\n+-----------+---------------+----------------+\n| THREAD_ID | VARIABLE_NAME | VARIABLE_VALUE |\n+-----------+---------------+----------------+\n|        64 | wait_timeout  | 28800          |\n|        65 | wait_timeout  | 3600           |\n+-----------+---------------+----------------+\n</code></pre><p>è¿™ä¸ªè¡¨çš„THREAD_IDæ˜¯çº¿ç¨‹IDï¼Œä¸æ˜¯SHOW PROCESSLISTå‘½ä»¤è¾“å‡ºä¸­çš„IDã€‚PROCESSLIT_IDå’ŒTHREAD_IDçš„å…³ç³»å¯ä»¥åˆ°performance_schema.threadsè¡¨æŸ¥æ‰¾ã€‚</p><h3>å‚æ•°æ–‡ä»¶çš„æ ¼å¼</h3><p>MySQLå‚æ•°æ–‡ä»¶ä¸€èˆ¬å‘½åä¸ºmy.cnfï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶åï¼Œä½†éœ€è¦åœ¨å¯åŠ¨MySQLæ—¶ï¼Œé€šè¿‡defaults-fileå‚æ•°æŒ‡å®šé…ç½®æ–‡ä»¶çš„è·¯å¾„ã€‚å‚æ•°æ–‡ä»¶åˆ†ä¸ºå¤šä¸ªç»„ï¼Œç»„åç”¨ä¸­æ‹¬å·[]æ‹¬èµ·æ¥ã€‚ä¸€èˆ¬å°†MySQLæœåŠ¡ç«¯çš„å‚æ•°æ”¾åˆ°[mysqld]ä¸­ã€‚å‚æ•°è®¾ç½®çš„ä¸€èˆ¬æ ¼å¼ä¸ºvariable_name=variable_valueï¼Œä½†æ˜¯ä¹Ÿæœ‰çš„å‚æ•°å€¼éœ€è¦æä¾›å‚æ•°åï¼Œä¸éœ€è¦æä¾›å‚æ•°å€¼ï¼Œå¦‚skip_name_resolveã€‚</p><pre><code class=\"language-go\">[mysqld_safe]\npid-file=/data/mysql01/run/mysqld.pid\n\n\n[mysqld]\n\nbasedir=/opt/mysql\nlc_messages_dir=/opt/mysql/share\ndatadir=/data/mysql01/data\ntmpdir=/data/mysql01/tmp\nlog-error=/data/mysql01/log/alert.log\nslow_query_log_file=/data/mysql01/log/slow.log\ngeneral_log_file=/data/mysql01/log/general.log\n\nsocket=/data/mysql01/run/mysql.sock\nskip_name_resolve\n\n...\n</code></pre><h2>è®¾ç½®åˆç†çš„å‚æ•°</h2><h3>è®¾ç½®æ–‡ä»¶è·¯å¾„</h3><p>MySQLæœ‰ä¸€ç³»åˆ—ä¸æ–‡ä»¶è·¯å¾„ç›¸å…³çš„å‚æ•°ï¼Œç”¨æ¥æŒ‡å®šç¨‹åºæ–‡ä»¶çš„è·¯å¾„å’Œå…¶ä»–æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„ã€‚basediræŒ‡å®šMySQLç¨‹åºçš„å®‰è£…è·¯å¾„ï¼Œå¦‚æœMySQLç¨‹åºæ²¡æœ‰å®‰è£…åœ¨é»˜è®¤çš„è·¯å¾„ï¼Œéœ€è¦æŒ‡å®šbasedirã€‚</p><p>datadiræŒ‡å®šæ•°æ®æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„ï¼Œé»˜è®¤è·¯å¾„æ˜¯åœ¨æ„å»ºMySQLäºŒè¿›åˆ¶æ—¶ç¡®å®šçš„ã€‚æˆ‘å»ºè®®åœ¨é…ç½®æ–‡ä»¶ä¸­æ˜¾å¼æŒ‡å®šdatadirã€‚å¦‚æœå› ä¸ºå„ç§åŸå› éœ€è¦å°†æ•°æ®ç›®å½•ç§»åŠ¨åˆ°å…¶ä»–è·¯å¾„ä¸‹ï¼Œè¦åŒæ­¥ä¿®æ”¹datadirå‚æ•°ï¼Œå¦åˆ™æ•°æ®åº“ä¼šæ— æ³•å¯åŠ¨ã€‚datadiråŒæ—¶ä¹Ÿå†³å®šäº†å…¶ä»–å¾ˆå¤šæ–‡ä»¶çš„å­˜æ”¾è·¯å¾„ï¼Œå¦‚innodbç³»ç»Ÿè¡¨ç©ºé—´ã€innodb REDOæ—¥å¿—ã€binlogã€relaylogé»˜è®¤éƒ½å­˜æ”¾åœ¨datadirä¸‹ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›å‚æ•°ä¿®æ”¹è¿™äº›æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„ã€‚ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ€»ç»“äº†å¹³æ—¶æ¯”è¾ƒå¸¸ç”¨çš„æ–‡ä»¶è·¯å¾„ç›¸å…³çš„å‚æ•°ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/6a/28/6acb451c80c32a8cd25bbc6cbd57be28.jpg?wh=1920x1052\" alt=\"å›¾ç‰‡\"></p><h3>è®¾ç½®æ—¥å¿—æ–‡ä»¶</h3><p>MySQLçš„æ—¥å¿—æ–‡ä»¶åŒ…æ‹¬é”™è¯¯æ—¥å¿—ã€æ…¢SQLæ—¥å¿—ã€General Logã€‚å»ºè®®å¼€å¯æ…¢SQLæ—¥å¿—ï¼Œè¿™å¯¹SQLä¼˜åŒ–æœ‰æ¯”è¾ƒé‡è¦çš„ä½œç”¨ã€‚general logä¸€èˆ¬ä¸å¼€å¯ï¼Œåªæœ‰åœ¨ä¸€äº›æ’æŸ¥é—®é¢˜çš„åœºæ™¯ä¸‹çŸ­æš‚å¼€å¯ã€‚</p><pre><code class=\"language-go\">-- error\nlog_error=/data/mysql01/log/error.log\nslow_query_log_file=/data/mysql01/log/slow.log\ngeneral_log_file=/data/mysql01/log/general.log\n\n-- slow logï¼Œå»ºè®®å¼€å¯æ…¢SQLæ—¥å¿—\nslow_query_log=ON\nlong_query_time=1 ## (å•ä½ç§’ï¼Œå¯ä»¥ç²¾ç¡®åˆ°1å¾®ç§’)\nlog_queries_not_using_indexes=1\nlog_slow_admin_statements=1\n</code></pre><h3>è®¾ç½®èµ„æºé™åˆ¶å‚æ•°</h3><h4>open_files_limit</h4><p>å‚æ•°open_files_limité™åˆ¶äº†MySQLè¿›ç¨‹å…è®¸åŒæ—¶æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„æ•°ã€‚å¦‚æœMySQLè¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„æ•°è¾¾åˆ°open_files_limitï¼Œå°†æ— æ³•æ‰“å¼€æ–°çš„æ–‡ä»¶ï¼Œå°±ä¼šå¯¼è‡´æ•°æ®åº“è®¿é—®å¼‚å¸¸ã€‚ä»¥ä¸‹è¿™äº›æ“ä½œéƒ½éœ€è¦å ç”¨æ–‡ä»¶å¥æŸ„ï¼š</p><ul>\n<li>è®¿é—®innodbæ•°æ®æ–‡ä»¶</li>\n<li>è®¿é—®ä¸´æ—¶æ–‡ä»¶</li>\n<li>å»ºç«‹TCPè¿æ¥</li>\n<li>è®¿é—®å…¶ä»–æ–‡ä»¶ï¼ˆå¦‚æ—¥å¿—æ–‡ä»¶ï¼‰</li>\n</ul><p>open_files_limitæœ€ç»ˆçš„å–å€¼å—å‡ ä¸ªå› ç´ å½±å“ã€‚</p><ol>\n<li>open_files_limitå—å‚æ•°max_connectionså’Œtable_open_cacheçš„å½±å“ã€‚MySQLä¼šå°†open_files_limitè°ƒæ•´ä¸ºä»¥ä¸‹å‡ é¡¹çš„æœ€å¤§å€¼ï¼š</li>\n</ol><ul>\n<li>open_files_limitå‚æ•°çš„è®¾ç½®å€¼</li>\n<li>max_connections + 2 * table_open_cache + 10</li>\n<li>max_connections * 5</li>\n</ul><ol start=\"2\">\n<li>open_files_limitå—æ“ä½œç³»ç»Ÿopen filesé™åˆ¶ã€‚</li>\n</ol><p>å¯åŠ¨mysqldè¿›ç¨‹æ—¶ï¼Œå¦‚æœçˆ¶è¿›ç¨‹åœ¨æ“ä½œç³»ç»Ÿä¸­æœ‰open filesï¼ˆulimit -nï¼‰é™åˆ¶ï¼Œé‚£ä¹ˆopen_files_limitä¸èƒ½è¶…è¿‡çˆ¶è¿›ç¨‹çš„open filesé™åˆ¶ã€‚ ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å…ˆåœ¨æ“ä½œç³»ç»Ÿä¸­suåˆ°MySQLï¼Œulimit -nè®¾ç½®ä¸º1024ï¼Œç„¶åå†å¯åŠ¨MySQLæ•°æ®åº“ã€‚</p><pre><code class=\"language-go\"># su - mysql\n$ ulimit -n 1024\n$ ulimit -n\n1024\n\n$ /usr/local/mysql/bin/mysqld_safe --defaults-file=/data/mysql01/my.cnf &amp;\n</code></pre><p>åœ¨MySQLçš„é”™è¯¯æ—¥å¿—ä¸­ï¼Œå¯ä»¥çœ‹åˆ°max_open_filesè¢«ç¼©å°ä¸º1024ï¼Œè€Œä¸”å‚æ•°max_connectionså’Œtable_open_cacheä¹Ÿè¢«æ”¹å°äº†ã€‚</p><pre><code class=\"language-go\">[Server] Could not increase number of max_open_files to more than 1024 (request: 30000)\n[Server] Changed limits: max_connections: 214 (requested 1000)\n[Server] Changed limits: table_open_cache: 400 (requested 1000)\n</code></pre><p>ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦åœ¨æ“ä½œç³»ç»Ÿä¸­æé«˜ç”¨æˆ·çš„èµ„æºé™åˆ¶ã€‚</p><pre><code class=\"language-go\">### /etc/security/limits.conf\nmysql       -       nofile  1000000\nmysql       -       nproc   65535\n</code></pre><h4>max_connections</h4><p>max_connectionsé™åˆ¶äº†æ•°æ®åº“çš„æœ€å¤§è¿æ¥æ•°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯max_connectionså—å‚æ•°max_open_fileså½±å“ï¼Œå®ƒä¸èƒ½è¶…è¿‡max_open_files - 810ï¼Œå› æ­¤åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œè™½ç„¶max_connectioné…ç½®ä¸º1000ï¼Œä½†æœ€ç»ˆç”Ÿæ•ˆçš„å€¼ä¸º214ï¼ˆ1024 - 810ï¼‰ã€‚</p><p>MySQLçš„æ¯ä¸ªè¿æ¥éƒ½ä¼šå ç”¨ä¸€å®šçš„èµ„æºï¼Œmax_connectionså‚æ•°éœ€è¦æ ¹æ®ä¸šåŠ¡çš„å®é™…è¿æ¥éœ€æ±‚ä»¥åŠæœåŠ¡å™¨çš„å¯ç”¨èµ„æºæ¥ç»¼åˆè¯„ä¼°ã€‚</p><h4>table_open_cache</h4><p>table_open_cacheæ§åˆ¶æ•°æ®åº“ä¸­å…è®¸åŒæ—¶æ‰“å¼€çš„è¡¨çš„æ•°é‡ï¼Œè¿™ä¸ªå‚æ•°çš„æœ€ç»ˆå–å€¼ä¼šå—å‚æ•°max_open_fileså’Œmax_connectionså®é™…è¿è¡Œå€¼çš„å½±å“ã€‚table_open_cacheä¸Šé™ä¸º(max_open_files - max_connections - 10) / 2æˆ–400ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè™½ç„¶åœ¨å‚æ•°æ–‡ä»¶ä¸­table_open_cacheè®¾ç½®ä¸º1000ï¼Œä½†å®é™…è¿è¡Œæ—¶ï¼Œè¯¥å‚æ•°è¢«è°ƒæ•´ä¸º400ã€‚å½“æ•°æ®åº“ä¸­è¡¨çš„æ•°é‡æ¯”è¾ƒå¤§æ—¶ï¼Œå¯ä»¥é€‚å½“å¢åŠ table_open_cacheã€‚</p><h4>innodb_open_files</h4><p>innodb_open_filesæ§åˆ¶å…è®¸åŒæ—¶æ‰“å¼€çš„InnoDBæ–‡ä»¶çš„æ•°é‡ã€‚è¯¥å‚æ•°é»˜è®¤å–table_open_cacheçš„è¿è¡Œå€¼ã€‚</p><h4>table_definition_cache</h4><p>MySQLå°†è¡¨ç»“æ„å®šä¹‰ä¹Ÿç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œå‚æ•°table_definition_cacheè®¾ç½®äº†å…è®¸ç¼“å­˜çš„è¡¨ç»“æ„å®šä¹‰çš„æ•°é‡ã€‚å¦‚æœInnoDBè¡¨çš„æ•°é‡æ¯”è¾ƒå¤šï¼Œå¯ä»¥æŠŠè¿™ä¸ªå‚æ•°ä¹Ÿè®¾ç½®å¾—å¤§ä¸€äº›ã€‚</p><h3>è®¾ç½®ä¼šè¯çº§å†…å­˜å‚æ•°</h3><p>SQLæ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šéœ€è¦åˆ†é…ä¸€äº›ä¸´æ—¶çš„å†…å­˜ç©ºé—´ï¼Œä¼šè¯çº§å†…å­˜å‚æ•°æ§åˆ¶è¿™äº›ä¸´æ—¶å†…å­˜çš„å¤§å°ã€‚è¿™äº›å†…å­˜å‚æ•°ç”¨æ¥æ§åˆ¶å•ä¸ªä¼šè¯çš„å†…å­˜ï¼Œå½“å¤šä¸ªä¼šè¯åŒæ—¶æ‰§è¡Œæ—¶ï¼Œæ— æ³•é™åˆ¶è¿™äº›å†…å­˜çš„æ€»å¤§å°ã€‚</p><h4>sort_buffer_size</h4><p>SQLæ‰§è¡Œæ—¶å¦‚æœéœ€è¦æ’åºï¼Œä¼šå…ˆåœ¨å†…å­˜ä¸­æ’åºï¼Œsort_buffer_sizeæ§åˆ¶æ¯ä¸ªä¼šè¯å¯ç”¨äºæ’åºçš„å†…å­˜ç©ºé—´ã€‚8.0.12ç‰ˆæœ¬ä¹‹å‰ï¼Œå¦‚æœSQLéœ€è¦æ’åºï¼Œä¼šä¸€æ¬¡æ€§åˆ†é…sort_buffer_sizeæŒ‡å®šçš„å†…å­˜ï¼Œå³ä½¿éœ€è¦æ’åºçš„æ•°æ®å¾ˆå°‘ã€‚8.0.12ç‰ˆæœ¬è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä¼šæ ¹æ®å®é™…éœ€è¦çš„æ’åºçš„æ•°æ®æŒ‰éœ€åˆ†é…æ’åºå†…å­˜ï¼Œæœ€å¤šä¸è¶…è¿‡sort_buffer_sizeã€‚ä¸€èˆ¬sort_buffer_sizeå¯ä»¥è®¾ç½®ä¸º256K-2Mã€‚</p><h4>join_buffer_size</h4><p>æ‰§è¡Œè¡¨è¿æ¥çš„æ—¶å€™ï¼Œå¦‚æœè¢«é©±åŠ¨è¡¨ç¼ºå°‘ç´¢å¼•ï¼Œä¼šä½¿ç”¨BNLè¿æ¥æˆ–Hashè¿æ¥ç®—æ³•ï¼Œä¼˜åŒ–å™¨ä¼šæ ¹æ®å‚æ•°join_buffer_sizeçš„è®¾ç½®ï¼Œåˆ†é…è¿æ¥ç¼“å­˜ï¼Œç”¨æ¥ç¼“å­˜é©±åŠ¨è¡¨çš„è®°å½•ï¼Œä»¥æé«˜è¡¨è¿æ¥æ“ä½œçš„æ€§èƒ½ã€‚æ³¨æ„ä¸€ä¸ªSQLå¯èƒ½ä¼šä½¿ç”¨å¤šä¸ªJoin Bufferã€‚ä¸€èˆ¬join_buffer_sizeè®¾ç½®ä¸º256K-2Mã€‚ä¸å»ºè®®æŠŠå…¨å±€join_buffer_sizeè®¾ç½®å¾—å¾ˆå¤§ï¼Œå¦‚æœæœ‰å¤§æŸ¥è¯¢éœ€è¦ä½¿ç”¨æ›´å¤šçš„Join Bufferï¼Œå¯ä»¥åœ¨ä¼šè¯å±‚é¢è°ƒæ•´ã€‚</p><h4>read_rnd_buffer_size</h4><p>å‚æ•°read_rnd_buffer_sizeç”¨æ¥æ§åˆ¶MRRè®¿é—®è·¯å¾„èƒ½ä½¿ç”¨çš„bufferçš„å¤§å°ã€‚å…³äºMRRæ‰§è¡Œè®¡åˆ’çš„æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒåç»­SQLä¼˜åŒ–çš„ç›¸å…³æ–‡ç« ã€‚</p><h4>tmp_table_size</h4><p>tmp_table_sizeæ§åˆ¶å†…å­˜ä¸´æ—¶è¡¨çš„æœ€å¤§ç©ºé—´ï¼Œå½“å†…å­˜ä¸´æ—¶è¡¨å†…çš„æ•°æ®è¶…è¿‡tmp_table_sizeåï¼Œä¼šè½¬æ¢æˆç£ç›˜ä¸´æ—¶è¡¨ã€‚å¦‚æœæœ‰SQLéœ€è¦æ’åºå¤§é‡æ•°æ®ï¼Œå¯ä»¥åœ¨ä¼šè¯çº§åˆ«è°ƒæ•´è¿™ä¸ªå‚æ•°ã€‚</p><h3>è®¾ç½®InnoDBå­˜å‚¨å¼•æ“å‚æ•°</h3><p>InnoDBå­˜å‚¨å¼•æ“æ˜¯MySQLå®ç°äº‹åŠ¡ACIDå±æ€§çš„å…³é”®æ‰€åœ¨ï¼Œåˆç†åœ°è®¾ç½®InnoDBç›¸å…³å‚æ•°ï¼Œæ˜¯å®ç°MySQLé«˜æ€§èƒ½å’Œæ•°æ®å¼ºä¸€è‡´çš„ä¸€ä¸ªåŸºæœ¬å‰æã€‚InnoDBæ˜¯ä¸€ä¸ªå¤æ‚çš„ç³»ç»Ÿï¼ŒMySQL 8.0ä¸­InnoDBæœ‰ä¸€ç™¾å¤šä¸ªå‚æ•°ï¼Œå½“ç„¶è¿™é‡Œé¢å¾ˆå¤šå‚æ•°ä½¿ç”¨é»˜è®¤å€¼å°±å¯ä»¥äº†ï¼Œè¿™é‡Œå¯¹éœ€è¦é‡ç‚¹å…³æ³¨çš„éƒ¨åˆ†å‚æ•°åšä¸€ä¸ªä»‹ç»ã€‚æˆ‘ä»¬æŒ‰InnoDBçš„å†…éƒ¨ç»“æ„æ¥ä»‹ç»è¿™äº›å‚æ•°ã€‚</p><p>ä¸‹é¢è¿™ä¸ªå›¾ä¸­ï¼Œæˆ‘ä»¬å°†InnoDBåˆ†ä¸º4ä¸ªå¤§çš„ç»“æ„ï¼Œåˆ†åˆ«æ˜¯InnoDB Buffer Poolã€InnoDBæ•°æ®æ–‡ä»¶ã€Redo Log Bufferã€Redoæ—¥å¿—ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a2/8c/a274bc40b8fc151dcbe04fb6e7f7ea8c.jpg?wh=1723x1077\" alt=\"å›¾ç‰‡\"></p><h4>InnoDB Buffer Pool</h4><p>è®¿é—®InnoDBå­˜å‚¨å¼•æ“è¡¨æ—¶ï¼Œéœ€è¦å°†æ•°æ®å…ˆç¼“å­˜åˆ°Buffer Poolï¼Œç¼“å­˜çš„å•ä½æ˜¯ä¸€ä¸ªæ•°æ®é¡µã€‚æ•°æ®é¡µçš„å¤§å°é€šè¿‡å‚æ•°innodb_page_sizeæŒ‡å®šï¼Œé»˜è®¤ä¸º16Kï¼Œä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨é»˜è®¤å€¼å°±å¯ä»¥äº†ã€‚</p><p>Buffer Poolçš„å¤§å°é€šè¿‡å‚æ•°innodb_buffer_pool_sizeæŒ‡å®šï¼Œè¿™å¯èƒ½æ˜¯MySQLä¸­æœ€é‡è¦çš„ä¸€ä¸ªå‚æ•°ã€‚å¦‚æœinnodb_buffer_pool_sizeè®¾ç½®å¾—å¤ªå°ï¼Œæ— æ³•æŠŠå¤§éƒ¨åˆ†çƒ­ç‚¹æ•°æ®ç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œä¼šå½±å“æ•°æ®åº“çš„è¯»å†™æ€§èƒ½ã€‚ä½†å¦‚æœinnodb_buffer_pool_sizeè®¾ç½®å¾—å¤ªå¤§ï¼Œåˆä¼šå¯¼è‡´æœåŠ¡å™¨å†…å­˜èµ„æºè€—å°½ï¼Œå¯èƒ½ä¼šå‡ºç°SWAPï¼Œæˆ–è€…è§¦å‘OOM-Killerã€‚æˆ‘ä»¬éœ€è¦æ ¹æ®æœåŠ¡å™¨å’ŒMySQLä½¿ç”¨çš„å®é™…æƒ…å†µæ¥è®¾ç½®innodb_buffer_pool_sizeã€‚</p><p>è¿™é‡Œæä¾›ä¸€ä¸ªå†…å­˜è¯„ä¼°çš„æ–¹æ³•ï¼Œä¾›ä½ å‚è€ƒï¼š</p><ul>\n<li>ä¸ºæ“ä½œç³»ç»Ÿé¢„ç•™ä¸€å®šçš„å†…å­˜ï¼ˆmin_free_kbytesï¼ŒOSå†…æ ¸è¿è¡Œéœ€è¦çš„åŸºç¡€å†…å­˜ï¼‰ï¼Œæ¯”å¦‚5%ã€‚</li>\n<li>OSå…¶ä»–ç¨‹åºè¿è¡Œå ç”¨çš„å†…å­˜ï¼Œæ¯”å¦‚MySQLæ•°æ®åº“å¤‡ä»½ç¨‹åºå’Œå…¶ä»–ç¨‹åºã€‚</li>\n<li>æ–‡ä»¶ç³»ç»ŸCacheä¼šå ç”¨ä¸€å®šçš„å†…å­˜ï¼Œæ¯”å¦‚InnoDB REDOæ—¥å¿—ã€binlogæ–‡ä»¶ã€‚</li>\n<li>MySQLçº¿ç¨‹åˆ†é…çš„å†…å­˜ï¼ŒåŒ…æ‹¬è¿è¡Œæ—¶åˆ†é…çš„å†…å­˜ï¼ˆjoin buffer, sort buffer, net bufferç­‰ï¼‰å’Œthread_stackã€‚</li>\n<li>å¦‚æœå¤§é‡ä½¿ç”¨MyISAMï¼Œéœ€è¦åˆ†é…key bufferã€‚myisamæ•°æ®æ–‡ä»¶è¿˜ä¼šä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿcacheã€‚</li>\n<li>Inno DB buffer poolç®¡ç†éœ€è¦é¢å¤–å ç”¨ä¸€éƒ¨åˆ†å†…å­˜ï¼Œå¤§è‡´ä¸ºinnodb_buffer_pool_size * 5%ã€‚</li>\n</ul><p>é™¤å»ä¸Šè¿°å„ç±»å†…å­˜ï¼Œå°†å‰©ä½™çš„å†…å­˜åˆ†é…ç»™Buffer Poolã€‚å‡è®¾æˆ‘ä»¬çš„æœåŠ¡å™¨æ€»å…±æœ‰100Gå†…å­˜ï¼Œç³»ç»Ÿå†…å­˜æŒ‰ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ¥è¯„ä¼°ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/68/9b/68fee2a6efc97dfcfc6dcae45049719b.png?wh=1920x1094\" alt=\"å›¾ç‰‡\"></p><p>é‚£ä¹ˆï¼Œç•™ç»™InnoDB Buffer Poolçš„å†…å­˜ä¸º79Gï¼Œè€ƒè™‘åˆ°InnoDB Buffer Poolçš„ç®¡ç†å¼€é”€ï¼Œinnodb_buffer_pool_sizeå¯è®¾ç½®ä¸º75Gã€‚å½“ç„¶åœ¨çœŸå®çš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼ŒMySQLè¿æ¥çº¿ç¨‹ä¼šåŠ¨æ€åˆ†é…ã€é‡Šæ”¾å†…å­˜ï¼Œéœ€è¦æ ¹æ®çœŸå®çš„è¿è¡Œæƒ…å†µï¼Œé€‚å½“åœ°è°ƒæ•´å†…å­˜è®¾ç½®ã€‚</p><p>InnoDB Buffer Poolåˆ†ä¸ºå¤šä¸ªå†…å­˜å—ï¼ˆChunkï¼‰ï¼Œæ¯ä¸ªå†…å­˜å—çš„å¤§å°ç”±å‚æ•°innodb_buffer_pool_chunk_sizeæŒ‡å®šï¼Œé»˜è®¤ä¸º128Mã€‚å¯¹äºå¤§å†…å­˜çš„æœºå™¨ï¼Œå¯ä»¥é€‚å½“å¢åŠ innodb_buffer_pool_chunk_sizeï¼Œä¸€ä¸ªç»éªŒå€¼æ˜¯ä¿æŒæ€»çš„Chunkæ•°ä¸è¶…è¿‡1000ï¼Œæ¯”å¦‚Buffer Poolä¸º1Tï¼Œå¯ä»¥æŠŠinnodb_buffer_pool_chunk_sizeè®¾ç½®ä¸º1Gã€‚</p><p>InnoDB Buffer Poolä¸­å­˜åœ¨å¤§é‡é“¾è¡¨ç»“æ„ï¼Œå¹¶å‘è®¿é—®è¿™äº›é“¾è¡¨ç»“æ„æ—¶ï¼Œéœ€è¦é€šè¿‡ä¸€äº›äº’æ–¥é”ã€è¯»å†™é”æ¥ä¿è¯è¿™äº›æ•°æ®ç»“æ„çš„ä¸€è‡´æ€§ã€‚å½“æ•°æ®åº“çš„å¹¶å‘å¾ˆé«˜çš„æ—¶å€™ï¼Œåœ¨è¿™äº›é”ç»“æ„ä¸Šä¼šäº§ç”Ÿä¸¥é‡çš„äº‰ç”¨ã€‚å¯ä»¥è®¾ç½®innodb_buffer_pool_instancesï¼ŒæŠŠBuffer Poolåˆ’åˆ†æˆå¤šä¸ªåŒºå—ï¼Œå‡å°‘äº‰ç”¨ã€‚</p><p>MySQL 8.4ä¸­ï¼Œè¿™ä¸ªå‚æ•°é»˜è®¤å€¼å–ä»¥ä¸‹ä¸¤ä¸ªæ•°å­—ä¸­çš„è¾ƒå°å€¼ï¼š</p><ul>\n<li>é€»è¾‘CPUæ ¸æ•°/4</li>\n<li>innodb_buffer_pool_size / innodb_buffer_pool_chunk_size / 2</li>\n</ul><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å‚è€ƒè¿™ä¸ªæ–¹æ³•æ¥å¾—åˆ°innodb_buffer_pool_instancesçš„ä¸€ä¸ªåˆç†çš„è®¾ç½®ã€‚</p><p>æˆ‘ä»¬é€šè¿‡SQLè¯­å¥ä¿®æ”¹è¡¨ä¸­çš„æ•°æ®æ—¶ï¼Œå…ˆä¿®æ”¹ç¼“å­˜åœ¨Buffer Poolä¸­çš„é¡µé¢ã€‚é¡µé¢è¢«ä¿®æ”¹åç§°ä¸ºè„é¡µã€‚è„é¡µä¸­çš„æ•°æ®æœ€ç»ˆéœ€è¦å†™å›åˆ°æ•°æ®æ–‡ä»¶ä¸­ã€‚Page Cleanerçº¿ç¨‹å®šæœŸæ‰«æBuffer Poolä¸­çš„è„é¡µï¼Œå‘èµ·IOè¯·æ±‚ï¼Œå°†è„é¡µå†™å›ç£ç›˜ã€‚innodb_page_cleanersæ§åˆ¶Page Cleanerçº¿ç¨‹æ•°é‡ï¼Œå¯ä»¥å°†è¯¥å‚æ•°å’Œinnodb_buffer_pool_instancesè®¾ç½®æˆä¸€æ ·ã€‚</p><p>InnoDBäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¿˜ä¼šç”ŸæˆUndoæ—¥å¿—ã€‚äº‹åŠ¡æäº¤æ—¶ï¼Œå¹¶ä¸ä¼šç«‹åˆ»å°±æ¸…ç†Undoæ—¥å¿—ã€‚Purgeçº¿ç¨‹ä¼šåœ¨åˆé€‚çš„æ—¶æœºå›æ”¶Undoæ—¥å¿—ã€‚å‚æ•°innodb_purge_threadsæ§åˆ¶Purgeçº¿ç¨‹çš„æ•°é‡ã€‚</p><h4>InnoDBæ•°æ®æ–‡ä»¶</h4><p>InnoDB Buffer Poolä¸­çš„æ•°æ®ï¼Œæœ€ç»ˆä¼šæŒä¹…åŒ–åˆ°æ•°æ®æ–‡ä»¶ä¸­ã€‚InnoDBä½¿ç”¨IOçº¿ç¨‹æ¥è¿›è¡ŒIOæ“ä½œã€‚å‚æ•°innodb_read_io_threadsã€innodb_write_io_threadsåˆ†åˆ«æŒ‡å®šäº†è¯»IOå’Œå†™IOçš„çº¿ç¨‹æ•°ï¼Œé»˜è®¤å€¼éƒ½ä¸º4ï¼Œå¦‚æœæœåŠ¡å™¨ä¸ŠCPUæ ¸æ•°å¤šï¼Œå¯ä»¥é€‚å½“å¢åŠ è¿™2ä¸ªå‚æ•°ã€‚</p><h4>Redo Log Buffer</h4><p>ä¸ºäº†ä¿éšœæ•°æ®çš„æŒä¹…åŒ–ï¼Œä¿®æ”¹Buffer Poolä¸­çš„é¡µé¢æ—¶ï¼Œéœ€è¦ç”ŸæˆRedoæ—¥å¿—ã€‚å¦‚æœæ•°æ®åº“æˆ–æœåŠ¡å™¨å¼‚å¸¸å´©æºƒï¼Œå¯ä»¥ä½¿ç”¨Redoæ—¥å¿—æ¥æ¢å¤æ•°æ®ã€‚äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒRedoæ—¥å¿—ä¼šå…ˆå†™å…¥åˆ°Redo Log Bufferä¸­ï¼ŒBufferçš„å¤§å°ç”±å‚æ•°innodb_log_buffer_sizeæ§åˆ¶ã€‚ä¸€èˆ¬åˆ†é…å‡ åå…†å°±å¯ä»¥ï¼Œæ¯”å¦‚8.4ä¸­é»˜è®¤ä¸º64Mã€‚å¦‚æœä½ çš„æ•°æ®åº“å¹¶å‘å†™å…¥é‡é«˜ï¼Œå¯é€‚å½“æŠŠè¿™ä¸ªå‚æ•°å¢åŠ åˆ°å‡ ç™¾å…†ã€‚</p><p>äº‹åŠ¡æäº¤æ—¶ï¼Œéœ€è¦å°†äº‹åŠ¡äº§ç”Ÿçš„Redoæ—¥å¿—æŒä¹…åŒ–åˆ°Redoæ–‡ä»¶ä¸­ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯æ•°æ®ä¸ä¸¢ã€‚å‚æ•°innodb_flush_log_at_trx_commitæ§åˆ¶äº‹åŠ¡æäº¤æ—¶ï¼ŒRedoæ—¥å¿—çš„åˆ·ç›˜è¡Œä¸ºã€‚è®¾ç½®ä¸º1æ—¶ï¼Œæ¯ä¸ªäº‹åŠ¡æäº¤æ—¶éƒ½ä¼šç­‰å¾…Redoæ—¥å¿—åˆ·ç›˜å®Œæˆï¼Œè¿™æ˜¯æœ€å®‰å…¨çš„è®¾ç½®ã€‚ä½†ç”±äºè¦ç­‰å¾…Redoæ—¥å¿—åˆ·ç›˜å®Œæˆï¼Œæ€§èƒ½ä¸Šæœ‰ä¸€å®šçš„å¼€é”€ã€‚è¿™ä¸ªå‚æ•°è®¾ç½®ä¸º2æ—¶ï¼Œäº‹åŠ¡æäº¤æ—¶åªä¼šå°†Redoæ—¥å¿—å†™åˆ°Redoæ–‡ä»¶ä¸­ï¼Œç„¶åæ¯éš”1ç§’åˆ·æ–°ä¸€æ¬¡Redoæ–‡ä»¶ï¼Œå¦‚æœæœåŠ¡å™¨å¼‚å¸¸å´©æºƒï¼Œå¯èƒ½ä¼šå¯¼è‡´éƒ¨åˆ†æ•°æ®ä¸¢å¤±ã€‚</p><h4>Redoæ—¥å¿—</h4><p>æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œé€šè¿‡å‚æ•°innodb_log_file_sizeå’Œinnodb_log_files_in_groupæ§åˆ¶Redoæ—¥å¿—æ–‡ä»¶çš„å¤§å°å’Œæ•°é‡ã€‚8.0.30åï¼Œæ–°å¢äº†innodb_redo_log_capacityå‚æ•°ï¼Œå°±ä¸å†éœ€è¦å•ç‹¬è®¾ç½®innodb_log_file_sizeå’Œinnodb_log_files_in_groupäº†ã€‚Redoæ–‡ä»¶å¾ªç¯ä½¿ç”¨ï¼Œéšç€æ•°æ®åº“äº‹åŠ¡ä¸åœåœ°æ‰§è¡Œï¼Œæ–°çš„Redoæ—¥å¿—æœ€ç»ˆä¼šè¦†ç›–è€çš„Redoæ—¥å¿—ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/94/47/946a1fc95719d7b9999bb084eae13847.jpg?wh=858x374\" alt=\"å›¾ç‰‡\"></p><p>æ•°æ®åº“å´©æºƒæ¢å¤æ—¶ï¼Œéœ€è¦é€šè¿‡Redoæ—¥å¿—æ¥æ¢å¤æ•°æ®ï¼Œé‚£ä¹ˆè¦†ç›–è€çš„Redoæ–‡ä»¶ä¼šä¸ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±å‘¢ï¼Ÿæˆ–è€…MySQLå¦‚ä½•ä¿è¯è¦†ç›–Redoæ–‡ä»¶ä¸å½±å“æ•°æ®åº“æ¢å¤ï¼Ÿå…¶å®åªè¦ä¿è¯è¦†ç›–Redoæ–‡ä»¶æ—¶ï¼Œæ•°æ®åº“çš„Checkpoint LSNæ¯”Redoæ–‡ä»¶æœ€å¤§çš„LSNå·æ›´å¤§å°±è¡Œäº†ã€‚</p><pre><code class=\"language-go\">mysql&gt; select file_id, start_lsn, end_lsn from innodb_redo_log_files;\n+---------+------------+------------+\n| file_id | start_lsn  | end_lsn    |\n+---------+------------+------------+\n|     656 | 2168369664 | 2171644416 |\n+---------+------------+------------+\n\nmysql&gt; show global status like '%lsn%';\n+-------------------------------------+------------+\n| Variable_name                       | Value      |\n+-------------------------------------+------------+\n| Innodb_redo_log_checkpoint_lsn      | 2170307263 |\n| Innodb_redo_log_current_lsn         | 2170307263 |\n| Innodb_redo_log_flushed_to_disk_lsn | 2170307263 |\n+-------------------------------------+------------+\n</code></pre><p>å¦‚æœinnodb_redo_log_capacityè®¾ç½®å¾—å¤ªå°ï¼Œæ•°æ®åº“å†™å…¥é‡åˆæ¯”è¾ƒå¤§ï¼Œé‚£ä¹ˆè¦†ç›–Redoæ–‡ä»¶æ—¶ï¼Œå°±å¯èƒ½éœ€è¦ç­‰å¾…æ•°æ®åº“Checkpointï¼Œè¿™ä¼šä¸¥é‡å½±å“æ•°æ®åº“å†™å…¥çš„æ€§èƒ½ã€‚å¯¹äºBuffer Poolæ¯”è¾ƒå¤§ï¼Œå†™å…¥é¢‘ç¹çš„æ•°æ®åº“ï¼Œéœ€è¦æŠŠinnodb_redo_log_capacityè®¾ç½®å¾—å¤§ä¸€äº›ï¼Œè®¾ç½®æˆå‡ ä¸ªGåˆ°å‡ åGéƒ½æ˜¯å¯ä»¥çš„ã€‚</p><p>ä¸‹é¢ä»¥è¿™ä¸ªè¡¨æ ¼å¯¹InnoDBå‚æ•°çš„è®¾ç½®åšä¸€ä¸ªç®€å•çš„æ€»ç»“ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/c7/94/c793b53a1yy146d5621b4b9f7b85fb94.jpg?wh=1578x1550\" alt=\"å›¾ç‰‡\"></p><h3>å…¶å®ƒå‚æ•°è®¾ç½®</h3><p>å…³äºMySQLä¸»å¤‡å¤åˆ¶ç›¸å…³çš„å‚æ•°ï¼Œæˆ‘ä»¬åˆ°åç»­çš„è¯¾ç¨‹ä¸­å†å•ç‹¬è®¨è®ºã€‚æ­¤å¤–ï¼Œsql_modeä¹Ÿæ˜¯MySQLä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªå‚æ•°ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¿®æ”¹è¿™ä¸ªå‚æ•°å¯èƒ½ä¼šå¯¼è‡´åŸå…ˆèƒ½è¿è¡Œçš„SQLç›´æ¥æŠ¥é”™ï¼Œä¸‹ä¸€è®²ä¸­æˆ‘ä»¬ä¼šè¯¦ç»†è®¨è®ºsql_modeå‚æ•°çš„è®¾ç½®ã€‚</p><h2>æ€»ç»“</h2><p>è¿™ä¸€è®²ä¸­ï¼Œæˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†MySQLçš„å‚æ•°è®¾ç½®æœºåˆ¶ã€‚æˆ‘å»ºè®®å°†ä¸€ä¸ªæ•°æ®åº“å®ä¾‹çš„å‚æ•°éƒ½é…ç½®åœ¨åŒä¸€ä¸ªå‚æ•°æ–‡ä»¶ä¸­ã€‚ä¿®æ”¹å‚æ•°æ—¶ï¼Œåœ¨å‚æ•°æ–‡ä»¶ä¸­æ·»åŠ æ³¨é‡Šï¼Œç®€è¦è¯´æ˜å‚æ•°è¿™ä¹ˆè®¾ç½®çš„åŸå› ã€‚æœ‰å¯èƒ½çš„è¯ï¼Œä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶å·¥å…·æ¥ç®¡ç†å‚æ•°æ–‡ä»¶ã€‚</p><p>MySQLåªéœ€è¦é…ç½®æœ€åŸºæœ¬çš„å‚æ•°å°±èƒ½è¿è¡Œèµ·æ¥ã€‚ä½†å¦‚æœå¯¹æ€§èƒ½å’Œæ•°æ®ä¸€è‡´æ€§æœ‰è¦æ±‚ï¼Œå°±éœ€è¦è®¾ç½®ä¸€äº›é‡è¦çš„å‚æ•°ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨è¿™ä¸€è®²ä¸­è®¨è®ºåˆ°çš„èµ„æºé™åˆ¶å‚æ•°ã€InnoDBçš„ä¸€äº›å‚æ•°ã€‚æˆ‘ä»¬å¾ˆéš¾ç»™MySQLè®¾ç½®çœŸæ­£æ„ä¹‰ä¸Šæœ€ä¼˜çš„å‚æ•°ï¼Œè€Œä¸”åœ¨ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œæœ€ä¼˜çš„é…ç½®å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚æˆ‘çš„å»ºè®®æ˜¯å°†å‚æ•°è®¾ç½®å¾—å·®ä¸å¤šå¥½å°±è¡Œäº†ï¼Œå°†æ›´å¤šçš„æ—¶é—´èŠ±åœ¨ä¸šåŠ¡ä¼˜åŒ–ä¸Šã€‚</p><p>å¦‚æœä½ çš„ä¸šåŠ¡åœºæ™¯å¯¹æ€§èƒ½æœ‰æè‡´çš„è¦æ±‚ï¼Œå¯ä»¥ä½¿ç”¨çœŸå®ä¸šåŠ¡åœºæ™¯ï¼Œå¯¹æ•°æ®åº“æ€§èƒ½è¿›è¡Œæµ‹è¯„ï¼Œæµ‹è¯•åœ¨ä¸åŒçš„å‚æ•°é…ç½®ä¸‹ï¼Œæ•°æ®åº“çš„æ€§èƒ½è¡¨ç°ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æˆ‘ä»¬å†™SQLè¯­å¥æ—¶ï¼Œå…³é”®å­—ä¸€èˆ¬ä¸åŒºåˆ†å¤§å°ï¼Œä¸åŒçš„äººå¯èƒ½æœ‰ä¸åŒçš„ä¹ æƒ¯ã€‚å¯¹äºåº“åã€è¡¨åã€åˆ—åï¼Œä¸åŒçš„æ•°æ®åº“æœ‰ä¸åŒçš„å¤„ç†æ–¹æ³•ã€‚æ¯”å¦‚Oracleä¸­ï¼Œè¡¨åé»˜è®¤ä¸åŒºåˆ†å¤§å°å†™ã€‚åœ¨MySQLä¸­ï¼Œæ ¹æ®æ“ä½œç³»ç»Ÿçš„ä¸åŒï¼Œè¡¨åå°±å¯èƒ½ä¼šåŒºåˆ†å¤§å°å†™ã€‚</p><pre><code class=\"language-go\">mysql&gt; show tables;\n+----------------+\n| Tables_in_db01 |\n+----------------+\n| Ta             |\n| ta             |\n+----------------+\n2 rows in set (0.01 sec)\n\nmysql&gt; select * from ta;\nEmpty set (0.01 sec)\n\nmysql&gt; SELECT * From tA;\nERROR 1146 (42S02): Table 'db01.tA' doesn't exist\n</code></pre><p>å‚æ•°lower_case_table_nameså¯ç”¨æ¥æ§åˆ¶è¡¨åæ˜¯å¦åŒºåˆ†å¤§å°å†™ã€‚</p><pre><code class=\"language-go\">mysql&gt; show variables like '%lower%';\n+------------------------+-------+\n| Variable_name          | Value |\n+------------------------+-------+\n| lower_case_file_system | OFF   |\n| lower_case_table_names | 0     |\n+------------------------+-------+\n</code></pre><p>MySQL 8.0ä¸­ï¼Œè¿™ä¸ªå‚æ•°åªèƒ½åœ¨æ•°æ®åº“åˆå§‹åŒ–ä¹‹å‰è®¾ç½®ï¼Œä¹‹åå°±ä¸èƒ½å†ä¿®æ”¹äº†ï¼Œä¿®æ”¹åæ•°æ®åº“éƒ½æ— æ³•å¯åŠ¨ã€‚</p><pre><code class=\"language-go\">[ERROR] [MY-011087] [Server] Different lower_case_table_names settings for server ('1') and data dictionary ('0').\n[ERROR] [MY-010020] [Server] Data Dictionary initialization failed.\n</code></pre><p>ä½ è§‰å¾—è¿™ä¸ªå‚æ•°åº”è¯¥æ€æ ·è®¾ç½®ï¼ŸåŸå› æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>æœŸå¾…ä½ çš„æ€è€ƒï¼Œæ¬¢è¿åœ¨ç•™è¨€åŒºä¸­ä¸æˆ‘äº¤æµã€‚å¦‚æœä»Šå¤©çš„è¯¾ç¨‹è®©ä½ æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿæ¬¢è¿è½¬å‘ç»™æœ‰éœ€è¦çš„æœ‹å‹ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","comments":[{"had_liked":false,"id":394173,"user_name":"ç¬™ é¸¢","can_delete":false,"product_type":"c1","uid":3951358,"ip_address":"ä¸Šæµ·","ucode":"477AF524212C6D","user_header":"https://static001.geekbang.org/account/avatar/00/3c/4a/fe/7b6bd101.jpg","comment_is_top":false,"comment_ctime":1726041367,"is_pvip":false,"replies":[{"id":143096,"content":"æˆ‘çœ‹äº†ä¸‹æ–‡æ¡£ï¼Œè¿™ä¸ªè¡¨æ˜¯8.0.30æ‰å¼•å…¥çš„ã€‚\n\nThe innodb_redo_log_files table contains a row for each active InnoDB redo log file. This table was introduced in MySQL 8.0.30.\n\nä¹‹å‰ç‰ˆæœ¬è¦çœ‹redolog lsnçš„è¯ï¼Œä¼°è®¡å¾—ç›´æ¥åˆ°redoæ–‡ä»¶ä¸­æŸ¥çœ‹äº†ã€‚\n","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3898827,"ctime":1726105315,"ip_address":"æµ™æ±Ÿ","comment_id":394173,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100799401,"comment_content":"select file_id, start_lsn, end_lsn from innodb_redo_log_files;è€å¸ˆï¼Œè¿™æ¡å‘½ä»¤åœ¨æˆ‘çš„8.0ç‰ˆæœ¬æ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªè¡¨ï¼Œæˆ‘çœ‹ä¸€äº›æ–‡æ¡£è¯´æ˜æ˜¯åœ¨perfmance_schemaåº“ä¸‹ï¼Œä½†æ˜¯ä¸æ˜¯è·Ÿç‰ˆæœ¬æœ‰å…³ï¼Œ8.0.30æ‰æœ‰çš„è¿™ä¸ªè¡¨ï¼Ÿè‹¥æ˜¯ä¹‹å‰ç‰ˆæœ¬æ€ä¹ˆèƒ½æŸ¥çœ‹ç›¸å¯¹åº”çš„redolog lsnä¿¡æ¯å‘¢","like_count":1,"discussions":[{"author":{"id":3898827,"avatar":"https://static001.geekbang.org/account/avatar/00/3b/7d/cb/fa3dae58.jpg","nickname":"ä¿Šè¾¾","note":"","ucode":"F79BF9651AD086","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":651033,"discussion_content":"æˆ‘çœ‹äº†ä¸‹æ–‡æ¡£ï¼Œè¿™ä¸ªè¡¨æ˜¯8.0.30æ‰å¼•å…¥çš„ã€‚\n\nThe innodb_redo_log_files table contains a row for each active InnoDB redo log file. This table was introduced in MySQL 8.0.30.\n\nä¹‹å‰ç‰ˆæœ¬è¦çœ‹redolog lsnçš„è¯ï¼Œä¼°è®¡å¾—ç›´æ¥åˆ°redoæ–‡ä»¶ä¸­æŸ¥çœ‹äº†ã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1726105315,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3951358,"avatar":"https://static001.geekbang.org/account/avatar/00/3c/4a/fe/7b6bd101.jpg","nickname":"ç¬™ é¸¢","note":"","ucode":"477AF524212C6D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":651056,"discussion_content":"redo_logæ—¥å¿—å¥½åƒä¹Ÿæ²¡æœ‰å·¥å…·å¯ä»¥ç›´æ¥æŸ¥çœ‹å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1726136119,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":393713,"user_name":"èŒƒç‰¹è¥¿","can_delete":false,"product_type":"c1","uid":2642712,"ip_address":"æµ™æ±Ÿ","ucode":"1905108C050D6E","user_header":"https://static001.geekbang.org/account/avatar/00/28/53/18/de532447.jpg","comment_is_top":false,"comment_ctime":1724679340,"is_pvip":false,"replies":[{"id":142963,"content":"å¯¹çš„ã€‚\næˆ‘ä¹Ÿæ˜¯å»ºè®®lower_case_table_nameséƒ½è®¾ç½®ä¸º1ã€‚\nè¿™æ ·å³ä½¿æ˜¯è·¨æ“ä½œç³»ç»Ÿè¿ç§»æ•°æ®åº“ï¼Œä¹Ÿä¸ä¼šå‡ºç°è¡¨åå¤§å°å†™çš„é—®é¢˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3898827,"ctime":1724725138,"ip_address":"æµ™æ±Ÿ","comment_id":393713,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100799401,"comment_content":"åœ¨ linux ç³»ç»Ÿé‡Œé¢ lower_case_table_names åªæ”¯æŒè®¾ç½®ä¸º 0 æˆ–è€… 1ï¼Œè®¾ç½®ä¸º 0 è¡¨ç¤ºåŒºåˆ†å¤§å°å†™ï¼ŒæŒ‰ç…§ç”¨æˆ·è¾“å…¥å­˜å‚¨ï¼Œè®¾ç½®ä¸º 1 è¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™ï¼Œç”¨æˆ·åˆ›å»ºè¡¨åä¸ºå¤§å†™æ—¶ä¼šæŒ‰ç…§å°å†™å­˜å‚¨ï¼Œè®¾ç½®ä¸º 0 å¯èƒ½ä¼šå‡ºç°ä¸¤ç§å‘½åæ–¹å¼ï¼Œé©¼å³°æˆ–è€…ä¸‹åˆ’çº¿ï¼Œä»æ ‡å‡†åŒ–çš„è§’åº¦æƒ³ï¼Œå¸Œæœ›è¡¨å‘½åè§„åˆ™æ˜¯ç»Ÿä¸€çš„ï¼Œå¯è¯»æ€§é«˜ï¼Œè®¾ç½®ä¸º 1 æ—¶ï¼Œç›¸å½“äºæ•°æ®åº“è¡¨ååªèƒ½æœ‰ä¸‹åˆ’çº¿ä¸€ç§è§„åˆ™ï¼Œæ‰€ä»¥æ¨èä¸º 1","like_count":1,"discussions":[{"author":{"id":3898827,"avatar":"https://static001.geekbang.org/account/avatar/00/3b/7d/cb/fa3dae58.jpg","nickname":"ä¿Šè¾¾","note":"","ucode":"F79BF9651AD086","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":650287,"discussion_content":"å¯¹çš„ã€‚\næˆ‘ä¹Ÿæ˜¯å»ºè®®lower_case_table_nameséƒ½è®¾ç½®ä¸º1ã€‚\nè¿™æ ·å³ä½¿æ˜¯è·¨æ“ä½œç³»ç»Ÿè¿ç§»æ•°æ®åº“ï¼Œä¹Ÿä¸ä¼šå‡ºç°è¡¨åå¤§å°å†™çš„é—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1724725138,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":393704,"user_name":"Geek_0126","can_delete":false,"product_type":"c1","uid":3952196,"ip_address":"æµ™æ±Ÿ","ucode":"2916F7FB3F6D71","user_header":"https://static001.geekbang.org/account/avatar/00/3c/4e/44/49b29792.jpg","comment_is_top":false,"comment_ctime":1724658424,"is_pvip":false,"replies":[{"id":142964,"content":"æ˜¯çš„ã€‚\næˆ‘ä¹Ÿæ˜¯å»ºè®®lower_case_table_namesè®¾ç½®ä¸º1ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3898827,"ctime":1724725266,"ip_address":"æµ™æ±Ÿ","comment_id":393704,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100799401,"comment_content":"lower_case_table_nameså‚æ•°ä¸€èˆ¬æ¨èè®¾ç½®æˆ1ï¼Œè¿™æ ·åº“åè¡¨åä¸åŒºåˆ†å¤§å°å†™ã€‚","like_count":1,"discussions":[{"author":{"id":3898827,"avatar":"https://static001.geekbang.org/account/avatar/00/3b/7d/cb/fa3dae58.jpg","nickname":"ä¿Šè¾¾","note":"","ucode":"F79BF9651AD086","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":650288,"discussion_content":"æ˜¯çš„ã€‚\næˆ‘ä¹Ÿæ˜¯å»ºè®®lower_case_table_namesè®¾ç½®ä¸º1ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1724725266,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":393698,"user_name":"ls","can_delete":false,"product_type":"c1","uid":1001037,"ip_address":"ä¸Šæµ·","ucode":"C18E208B1DFDA7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/46/4d/161f3779.jpg","comment_is_top":false,"comment_ctime":1724642337,"is_pvip":true,"replies":[{"id":142965,"content":"å¯¹å‚æ•°lower_case_table_namesçš„ä½œç”¨è§£é‡Šå¾—å¾ˆå…¨é¢ï¼ŒğŸ‘ğŸ‘ã€‚\næˆ‘å€¾å‘äºåœ¨æ‰€æœ‰çš„ç¯å¢ƒä¸‹ï¼Œéƒ½å°†lower_case_table_namesè®¾ç½®ä¸º1ï¼Œä¿æŒä¸€è‡´ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3898827,"ctime":1724725483,"ip_address":"æµ™æ±Ÿ","comment_id":393698,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100799401,"comment_content":"åœ¨ Unix ä¸Šlower_case_table_namesçš„é»˜è®¤å€¼ä¸º 0ã€‚åœ¨Windowsä¸Šé»˜è®¤å€¼ä¸º 1ã€‚åœ¨macOS ä¸Šé»˜è®¤å€¼ä¸º 2\n0è¡¨ç¤ºï¼Œè¡¨åœ¨æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨çš„æ—¶å€™ï¼Œå¯¹åº”çš„æ–‡ä»¶åæ˜¯æŒ‰å»ºè¡¨æ—¶æŒ‡å®šçš„å¤§å°å†™å­˜çš„ï¼ŒMySQL å†…éƒ¨å¯¹è¡¨åçš„æ¯”è¾ƒä¹Ÿæ˜¯åŒºåˆ†å¤§å°å†™çš„ï¼›\n1è¡¨ç¤ºï¼Œè¡¨åœ¨æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨çš„æ—¶å€™ï¼Œå¯¹åº”çš„æ–‡ä»¶åéƒ½å°å†™çš„ï¼ŒMySQL å†…éƒ¨å¯¹è¡¨åçš„æ¯”è¾ƒæ˜¯è½¬æˆå°å†™çš„ï¼Œå³ä¸åŒºåˆ†å¤§å°å†™ï¼›\n2è¡¨ç¤ºï¼Œè¡¨åœ¨æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨çš„æ—¶å€™ï¼Œå¯¹åº”çš„æ–‡ä»¶åæ˜¯æŒ‰å»ºè¡¨æ—¶æŒ‡å®šçš„å¤§å°å†™å­˜çš„ï¼Œä½†æ˜¯ MySQL å†…éƒ¨å¯¹è¡¨åçš„æ¯”è¾ƒæ˜¯è½¬æˆå°å†™çš„ï¼Œå³ä¸åŒºåˆ†å¤§å°å†™ã€‚\n\n0é€‚ç”¨äºåŒºåˆ†å¤§å°å†™çš„ç³»ç»Ÿï¼Œ1éƒ½é€‚ç”¨ï¼Œ2é€‚ç”¨äºä¸åŒºåˆ†å¤§å°å†™çš„ç³»ç»Ÿã€‚","like_count":0,"discussions":[{"author":{"id":3898827,"avatar":"https://static001.geekbang.org/account/avatar/00/3b/7d/cb/fa3dae58.jpg","nickname":"ä¿Šè¾¾","note":"","ucode":"F79BF9651AD086","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":650289,"discussion_content":"å¯¹å‚æ•°lower_case_table_namesçš„ä½œç”¨è§£é‡Šå¾—å¾ˆå…¨é¢ï¼ŒğŸ‘ğŸ‘ã€‚\næˆ‘å€¾å‘äºåœ¨æ‰€æœ‰çš„ç¯å¢ƒä¸‹ï¼Œéƒ½å°†lower_case_table_namesè®¾ç½®ä¸º1ï¼Œä¿æŒä¸€è‡´ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1724725483,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]}]}