{"id":381157,"title":"12 | 设置工作模式与环境（下）：探查和收集信息","content":"<p>你好，我是LMOS。</p><p>上节课我们动手实现了自己的二级引导器。今天这节课我们将进入二级引导器，完成具体工作的环节。</p><p>在二级引导器中，我们要检查CPU是否支持64位的工作模式、收集内存布局信息，看看是不是合乎我们操作系统的最低运行要求，还要设置操作系统需要的MMU页表、设置显卡模式、释放中文字体文件。</p><p>今天课程的配套代码，你可以点击<a href=\"https://gitee.com/lmos/cosmos/tree/master/lesson12/Cosmos\">这里</a>，自行下载。</p><h2>检查与收集机器信息</h2><p>如果ldrkrl_entry()函数是总裁，那么init_bstartparm()函数则是经理，它负责管理检查CPU模式、收集内存信息，设置内核栈，设置内核字体、建立内核MMU页表数据。</p><p>为了使代码更加清晰，我们并不直接在ldrkrl_entry()函数中搞事情，而是准备在另一个bstartparm.c文件中实现一个init_bstartparm()。</p><p>下面我们就来动手实现它，如下所示。</p><pre><code>//初始化machbstart_t结构体，清0,并设置一个标志\nvoid machbstart_t_init(machbstart_t* initp)\n{\n    memset(initp,0,sizeof(machbstart_t));\n    initp-&gt;mb_migc=MBS_MIGC;\n    return;\n}\nvoid init_bstartparm()\n{\n    machbstart_t* mbsp = MBSPADR;//1MB的内存地址\n    machbstart_t_init(mbsp);\n    return;\n}\n</code></pre><p>目前我们的经理init_bstartparm()函数只是调用了一个machbstart_t_init()函数，在1MB内存地址处初始化了一个机器信息结构machbstart_t，后面随着干活越来越多，还会调用更多的函数的。</p><h3>检查CPU</h3><!-- [[[read_end]]] --><p>首先要检查我们的CPU，因为它是执行程序的关键。我们要搞清楚它能执行什么形式的代码，支持64位长模式吗？</p><p>这个工作我们交给init_chkcpu()函数来干，由于我们要CPUID指令来检查CPU是否支持64位长模式，所以这个函数中需要找两个帮工：<strong>chk_cpuid、chk_cpu_longmode</strong>来干两件事，一个是检查CPU否支持CPUID指令，然后另一个用CPUID指令检查CPU支持64位长模式。</p><p>下面我们去写好它们，如下所示。</p><pre><code>//通过改写Eflags寄存器的第21位，观察其位的变化判断是否支持CPUID\nint chk_cpuid()\n{\n    int rets = 0;\n    __asm__ __volatile__(\n        &quot;pushfl \\n\\t&quot;\n        &quot;popl %%eax \\n\\t&quot;\n        &quot;movl %%eax,%%ebx \\n\\t&quot;\n        &quot;xorl $0x0200000,%%eax \\n\\t&quot;\n        &quot;pushl %%eax \\n\\t&quot;\n        &quot;popfl \\n\\t&quot;\n        &quot;pushfl \\n\\t&quot;\n        &quot;popl %%eax \\n\\t&quot;\n        &quot;xorl %%ebx,%%eax \\n\\t&quot;\n        &quot;jz 1f \\n\\t&quot;\n        &quot;movl $1,%0 \\n\\t&quot;\n        &quot;jmp 2f \\n\\t&quot;\n        &quot;1: movl $0,%0 \\n\\t&quot;\n        &quot;2: \\n\\t&quot;\n        : &quot;=c&quot;(rets)\n        :\n        :);\n    return rets;\n}\n//检查CPU是否支持长模式\nint chk_cpu_longmode()\n{\n    int rets = 0;\n    __asm__ __volatile__(\n        &quot;movl $0x80000000,%%eax \\n\\t&quot;\n        &quot;cpuid \\n\\t&quot; //把eax中放入0x80000000调用CPUID指令\n        &quot;cmpl $0x80000001,%%eax \\n\\t&quot;//看eax中返回结果\n        &quot;setnb %%al \\n\\t&quot; //不为0x80000001,则不支持0x80000001号功能\n        &quot;jb 1f \\n\\t&quot;\n        &quot;movl $0x80000001,%%eax \\n\\t&quot;\n        &quot;cpuid \\n\\t&quot;//把eax中放入0x800000001调用CPUID指令，检查edx中的返回数据\n        &quot;bt $29,%%edx  \\n\\t&quot; //长模式 支持位  是否为1\n        &quot;setcb %%al \\n\\t&quot;\n        &quot;1: \\n\\t&quot;\n        &quot;movzx %%al,%%eax \\n\\t&quot;\n        : &quot;=a&quot;(rets)\n        :\n        :);\n    return rets;\n}\n//检查CPU主函数\nvoid init_chkcpu(machbstart_t *mbsp)\n{\n    if (!chk_cpuid())\n    {\n        kerror(&quot;Your CPU is not support CPUID sys is die!&quot;);\n        CLI_HALT();\n    }\n    if (!chk_cpu_longmode())\n    {\n        kerror(&quot;Your CPU is not support 64bits mode sys is die!&quot;);\n        CLI_HALT();\n    }\n    mbsp-&gt;mb_cpumode = 0x40;//如果成功则设置机器信息结构的cpu模式为64位\n    return;\n}\n</code></pre><p>上述代码中，检查CPU是否支持CPUID指令和检查CPU是否支持长模式，只要其中一步检查失败，我们就打印一条相应的提示信息，然后主动死机。<strong>这里需要你留意的是，最后设置机器信息结构中的mb_cpumode字段为64,mbsp正是传递进来的机器信息machbstart_t结构体的指针。</strong></p><h3>获取内存布局</h3><p>好了，CPU已经检查完成 ，合乎我们的要求。下面就要获取内存布局信息了，物理内存在物理地址空间中是一段一段的，描述一段内存有一个数据结构，如下所示。</p><pre><code>#define RAM_USABLE 1 //可用内存\n#define RAM_RESERV 2 //保留内存不可使用\n#define RAM_ACPIREC 3 //ACPI表相关的\n#define RAM_ACPINVS 4 //ACPI NVS空间\n#define RAM_AREACON 5 //包含坏内存\ntypedef struct s_e820{\n    u64_t saddr;    /* 内存开始地址 */\n    u64_t lsize;    /* 内存大小 */\n    u32_t type;    /* 内存类型 */\n}e820map_t;\n</code></pre><p>获取内存布局信息就是获取这个结构体的数组，这个工作我们交给init_mem函数来干，这个函数需要完成两件事：一是获取上述这个结构体数组，二是检查内存大小，因为我们的内核对内存容量有要求，不能太小。</p><p>下面我们来动手实现这个init_mem函数。</p><pre><code>#define ETYBAK_ADR 0x2000\n#define PM32_EIP_OFF (ETYBAK_ADR)\n#define PM32_ESP_OFF (ETYBAK_ADR+4)\n#define E80MAP_NR (ETYBAK_ADR+64)//保存e820map_t结构数组元素个数的地址\n#define E80MAP_ADRADR (ETYBAK_ADR+68) //保存e820map_t结构数组的开始地址\nvoid init_mem(machbstart_t *mbsp)\n{\n    e820map_t *retemp;\n    u32_t retemnr = 0;\n    mmap(&amp;retemp, &amp;retemnr);\n    if (retemnr == 0)\n    {\n        kerror(&quot;no e820map\\n&quot;);\n    }\n    //根据e820map_t结构数据检查内存大小\n    if (chk_memsize(retemp, retemnr, 0x100000, 0x8000000) == NULL)\n    {\n        kerror(&quot;Your computer is low on memory, the memory cannot be less than 128MB!&quot;);\n    }\n    mbsp-&gt;mb_e820padr = (u64_t)((u32_t)(retemp));//把e820map_t结构数组的首地址传给mbsp-&gt;mb_e820padr \n    mbsp-&gt;mb_e820nr = (u64_t)retemnr;//把e820map_t结构数组元素个数传给mbsp-&gt;mb_e820nr \n    mbsp-&gt;mb_e820sz = retemnr * (sizeof(e820map_t));//把e820map_t结构数组大小传给mbsp-&gt;mb_e820sz \n    mbsp-&gt;mb_memsz = get_memsize(retemp, retemnr);//根据e820map_t结构数据计算内存大小。\n    return;\n}\n</code></pre><p>上面最难写的是mmap函数。不过，我们还是有办法破解的。如果你理解了前面调用BIOS的机制，就会发现，<strong>只要调用了BIOS中断，就能获取e820map结构数组</strong>。</p><p>为了验证这个结论，我们来看一下mmap的函数调用关系：</p><pre><code>void mmap(e820map_t **retemp, u32_t *retemnr)\n{\n    realadr_call_entry(RLINTNR(0), 0, 0);\n    *retemnr = *((u32_t *)(E80MAP_NR));\n    *retemp = (e820map_t *)(*((u32_t *)(E80MAP_ADRADR)));\n    return;\n}\n</code></pre><p>可以看到，mmap函数正是通过前面讲的<strong>realadr_call_entry函数</strong>，来调用实模式下的_getmmap函数的，并且在_getmmap函数中调用BIOS中断的。</p><pre><code>_getmmap:\n\tpush ds\n\tpush es\n\tpush ss\n\tmov esi,0\n\tmov dword[E80MAP_NR],esi\n\tmov dword[E80MAP_ADRADR],E80MAP_ADR ;e820map结构体开始地址\n\txor ebx,ebx\n\tmov edi,E80MAP_ADR\nloop:\n\tmov eax,0e820h ;获取e820map结构参数\n\tmov ecx,20    ;e820map结构大小\n\tmov edx,0534d4150h ;获取e820map结构参数必须是这个数据\n\tint 15h  ;BIOS的15h中断\n\tjc .1\n\tadd edi,20\n\tcmp edi,E80MAP_ADR+0x1000\n\tjg .1\n\tinc esi\n\tcmp ebx,0\n\tjne loop ;循环获取e820map结构\n\tjmp .2\n.1:\n\tmov esi,0    ;出错处理，e820map结构数组元素个数为0\n.2:\n\tmov dword[E80MAP_NR],esi ;e820map结构数组元素个数\n\tpop ss\n\tpop es\n\tpop ds\n\tret\n</code></pre><p>如果你不明白上面代码的原理，请回到“Cache与内存：程序放在哪儿”<a href=\"https://time.geekbang.org/column/article/376711\">那节课</a>，看一下获取内存视图相关的知识点。</p><p>init_mem函数在调用mmap函数后，就会得到e820map结构数组，其首地址和数组元素个数由retemp，retemnr两个变量分别提供。</p><h3>初始化内核栈</h3><p>因为我们的操作系统是C语言写的，所以需要有栈，下面我们就来给即将运行的内核初始化一个栈。这个操作非常简单，就是在机器信息结构machbstart_t中，记录一下栈地址和栈大小，供内核在启动时使用。</p><p>不过，就算操作再简单，我们也要封装成函数来使用。让我们动手来写出这个函数吧，如下所示。</p><pre><code>#define IKSTACK_PHYADR (0x90000-0x10)\n#define IKSTACK_SIZE 0x1000\n//初始化内核栈\nvoid init_krlinitstack(machbstart_t *mbsp)\n{\n    if (1 &gt; move_krlimg(mbsp, (u64_t)(0x8f000), 0x1001))\n    {\n        kerror(&quot;iks_moveimg err&quot;);\n    }\n    mbsp-&gt;mb_krlinitstack = IKSTACK_PHYADR;//栈顶地址\n    mbsp-&gt;mb_krlitstacksz = IKSTACK_SIZE; //栈大小是4KB\n    return;\n}\n</code></pre><p>init_krlinitstack函数非常简单，但是其中调用了一个move_krlimg函数你要注意，这个我已经帮你写好啦，它主要负责判断一个地址空间是否和内存中存放的内容有冲突。</p><p>因为我们的内存中已经放置了机器信息结构、内存视图结构数组、二级引导器、内核映像文件，所以在处理内存空间时不能和内存中已经存在的他们冲突，否则就要覆盖他们的数据。0x8f000～（0x8f000+0x1001），正是我们的内核栈空间，我们需要检测它是否和其它空间有冲突。</p><h3>放置内核文件与字库文件</h3><p>放置内核文件和字库文件这一步，也非常简单，甚至放置其它文件也一样。</p><p>因为我们的内核已经编译成了一个独立的二进制程序，和其它文件一起被打包到映像文件中了。所以我们必须要从映像中把它解包出来，将其放在特定的物理内存空间中才可以，放置字库文件和放置内核文件的原理一样，所以我们来一起实现。</p><pre><code>//放置内核文件\nvoid init_krlfile(machbstart_t *mbsp)\n{\n//在映像中查找相应的文件，并复制到对应的地址，并返回文件的大小，这里是查找kernel.bin文件\n    u64_t sz = r_file_to_padr(mbsp, IMGKRNL_PHYADR, &quot;kernel.bin&quot;);\n    if (0 == sz)\n    {\n        kerror(&quot;r_file_to_padr err&quot;);\n    }\n    //放置完成后更新机器信息结构中的数据\n    mbsp-&gt;mb_krlimgpadr = IMGKRNL_PHYADR;\n    mbsp-&gt;mb_krlsz = sz;\n    //mbsp-&gt;mb_nextwtpadr始终要保持指向下一段空闲内存的首地址 \n    mbsp-&gt;mb_nextwtpadr = P4K_ALIGN(mbsp-&gt;mb_krlimgpadr + mbsp-&gt;mb_krlsz);\n    mbsp-&gt;mb_kalldendpadr = mbsp-&gt;mb_krlimgpadr + mbsp-&gt;mb_krlsz;\n    return;\n}\n//放置字库文件\nvoid init_defutfont(machbstart_t *mbsp)\n{\n    u64_t sz = 0;\n    //获取下一段空闲内存空间的首地址 \n    u32_t dfadr = (u32_t)mbsp-&gt;mb_nextwtpadr;\n//在映像中查找相应的文件，并复制到对应的地址，并返回文件的大小，这里是查找font.fnt文件\n    sz = r_file_to_padr(mbsp, dfadr, &quot;font.fnt&quot;);\n    if (0 == sz)\n    {\n        kerror(&quot;r_file_to_padr err&quot;);\n    }\n    //放置完成后更新机器信息结构中的数据\n    mbsp-&gt;mb_bfontpadr = (u64_t)(dfadr);\n    mbsp-&gt;mb_bfontsz = sz;\n    //更新机器信息结构中下一段空闲内存的首地址  \n    mbsp-&gt;mb_nextwtpadr = P4K_ALIGN((u32_t)(dfadr) + sz);\n    mbsp-&gt;mb_kalldendpadr = mbsp-&gt;mb_bfontpadr + mbsp-&gt;mb_bfontsz;\n    return;\n}\n</code></pre><p>以上代码的注释已经很清楚了，都是调用r_file_to_padr函数在映像中查找kernel.bin和font.fnt文件，并复制到对应的空闲内存空间中。</p><p>请注意，由于内核是代码数据，所以必须要复制到指定的内存空间中。r_file_to_padr函数我已经帮你写好了，其中的原理在前面的内容里已经做了说明，这里不再展开。</p><h3>建立MMU页表数据</h3><p>前面解决了文件放置问题，我们还要解决另一个问题——建立MMU页表。</p><p>我们在二级引导器中建立MMU页表数据，目的就是要在内核加载运行之初开启长模式时，MMU需要的页表数据已经准备好了。</p><p>由于我们的内核虚拟地址空间从0xffff800000000000开始，所以我们这个虚拟地址映射到从物理地址0开始，大小都是0x400000000即16GB，也就是说我们要虚拟地址空间：0xffff800000000000～0xffff800400000000 映射到物理地址空间0～0x400000000。</p><p>我们为了简化编程，使用<strong>长模式下的2MB分页方式</strong>，下面我们用代码实现它，如下所示。</p><pre><code>#define KINITPAGE_PHYADR 0x1000000\nvoid init_bstartpages(machbstart_t *mbsp)\n{\n    //顶级页目录\n    u64_t *p = (u64_t *)(KINITPAGE_PHYADR);//16MB地址处\n    //页目录指针\n    u64_t *pdpte = (u64_t *)(KINITPAGE_PHYADR + 0x1000);\n    //页目录\n    u64_t *pde = (u64_t *)(KINITPAGE_PHYADR + 0x2000);\n    //物理地址从0开始\n    u64_t adr = 0;\n    if (1 &gt; move_krlimg(mbsp, (u64_t)(KINITPAGE_PHYADR), (0x1000 * 16 + 0x2000)))\n    {\n        kerror(&quot;move_krlimg err&quot;);\n    }\n    //将顶级页目录、页目录指针的空间清0\n    for (uint_t mi = 0; mi &lt; PGENTY_SIZE; mi++)\n    {\n        p[mi] = 0;\n        pdpte[mi] = 0;\n    }\n    //映射\n    for (uint_t pdei = 0; pdei &lt; 16; pdei++)\n    {\n        pdpte[pdei] = (u64_t)((u32_t)pde | KPDPTE_RW | KPDPTE_P);\n        for (uint_t pdeii = 0; pdeii &lt; PGENTY_SIZE; pdeii++)\n        {//大页KPDE_PS 2MB，可读写KPDE_RW，存在KPDE_P\n            pde[pdeii] = 0 | adr | KPDE_PS | KPDE_RW | KPDE_P;\n            adr += 0x200000;\n        }\n        pde = (u64_t *)((u32_t)pde + 0x1000);\n    }\n    //让顶级页目录中第0项和第((KRNL_VIRTUAL_ADDRESS_START) &gt;&gt; KPML4_SHIFT) &amp; 0x1ff项，指向同一个页目录指针页  \n    p[((KRNL_VIRTUAL_ADDRESS_START) &gt;&gt; KPML4_SHIFT) &amp; 0x1ff] = (u64_t)((u32_t)pdpte | KPML4_RW | KPML4_P);\n    p[0] = (u64_t)((u32_t)pdpte | KPML4_RW | KPML4_P);\n    //把页表首地址保存在机器信息结构中\n    mbsp-&gt;mb_pml4padr = (u64_t)(KINITPAGE_PHYADR);\n    mbsp-&gt;mb_subpageslen = (u64_t)(0x1000 * 16 + 0x2000);\n    mbsp-&gt;mb_kpmapphymemsz = (u64_t)(0x400000000);\n    return;\n}\n</code></pre><p>这个函数的代码写得非常简单，<strong>映射的核心逻辑由两重循环控制</strong>，外层循环控制页目录指针顶，只有16项，其中每一项都指向一个页目录，每个页目录中有512个物理页地址。</p><p>物理地址每次增加2MB，这是由26～30行的内层循环控制，每执行一次外层循环就要执行512次内层循环。</p><p>最后，顶级页目录中第0项和第((KRNL_VIRTUAL_ADDRESS_START) &gt;&gt; KPML4_SHIFT) &amp; 0x1ff项，指向同一个页目录指针页，这样的话就能让虚拟地址：0xffff800000000000～0xffff800400000000和虚拟地址：0～0x400000000，访问到同一个物理地址空间0～0x400000000，这样做是有目的，<strong>内核在启动初期，虚拟地址和物理地址要保持相同。</strong></p><h3>设置图形模式</h3><p>在计算机加电启动时，计算机上显卡会自动进入文本模式，文本模式只能显示ASCII字符，不能显示汉字和图形，所以我们要让显卡切换到图形模式。</p><p>切换显卡模式依然要用BIOS中断，这个调用原理我们前面已经了如指掌。在实模式切换显卡模式的汇编代码，我已经帮你写好了，下面我们只要写个C函数调用它们就好了，代码如下所示。</p><pre><code>void init_graph(machbstart_t* mbsp)\n{\n    //初始化图形数据结构\n    graph_t_init(&amp;mbsp-&gt;mb_ghparm);\n    //获取VBE模式，通过BIOS中断\n    get_vbemode(mbsp);\n    //获取一个具体VBE模式的信息，通过BIOS中断\n    get_vbemodeinfo(mbsp);\n    //设置VBE模式，通过BIOS中断\n    set_vbemodeinfo();\n    return;\n}\n</code></pre><p>上面init_graph函数中的这些处理VBE模式的代码，我已经帮你写好，你可以自己在graph.c文件查看。</p><p>什么？你不懂VBE，其实我开始也不懂，后来通过搜寻资料才知道。</p><p>其实VBE是显卡的一个图形规范标准，它定义了显卡的几种图形模式，每个模式包括屏幕分辨率，像素格式与大小，显存大小。调用BIOS 10h中断可以返回这些数据结构。<a href=\"https://vesa.org/\">如果你实在对VBE感兴趣，可以自行阅读其规范</a> 。</p><p>这里我们选择使用了VBE的118h模式，该模式下屏幕分辨率为1024x768，显存大小是16.8MB。显存开始地址一般为0xe0000000。</p><p>屏幕分辨率为1024x768，即把屏幕分成768行，每行1024个像素点，但每个像素点占用显存的32位数据（4字节，红、绿、蓝、透明各占8位）。我们只要往对应的显存地址写入相应的像素数据，屏幕对应的位置就能显示了。</p><p>每个像素点，我们可以用如下数据结构表示：</p><pre><code>typedef struct s_PIXCL\n{\n    u8_t cl_b; //蓝\n    u8_t cl_g; //绿\n    u8_t cl_r; //红\n    u8_t cl_a; //透明\n}__attribute__((packed)) pixcl_t;\n\n#define BGRA(r,g,b) ((0|(r&lt;&lt;16)|(g&lt;&lt;8)|b))\n//通常情况下用pixl_t 和 BGRA宏\ntypedef u32_t pixl_t;\n</code></pre><p>我们再来看看屏幕像素点和显存位置对应的计算方式：</p><pre><code>u32_t* dispmem = (u32_t*)mbsp-&gt;mb_ghparm.gh_framphyadr;\ndispmem[x + (y * 1024)] = pix;\n//x，y是像素的位置\n</code></pre><h3>串联</h3><p>好了，所有的实施工作的函数已经完成了，现在我们需要在init_bstartparm()函数中把它们串联起来，即按照事情的先后顺序，依次调用它们完成相应的工作，实现检查、收集机器信息，设置工作环境。</p><pre><code>void init_bstartparm()\n{\n    machbstart_t *mbsp = MBSPADR;\n    machbstart_t_init(mbsp);\n    //检查CPU\n    init_chkcpu(mbsp);\n    //获取内存布局\n    init_mem(mbsp);\n    //初始化内核栈\n    init_krlinitstack(mbsp);\n    //放置内核文件\n    init_krlfile(mbsp);\n    //放置字库文件\n    init_defutfont(mbsp);\n    init_meme820(mbsp);\n    //建立MMU页表\n    init_bstartpages(mbsp);\n    //设置图形模式\n    init_graph(mbsp);\n    return;\n}\n</code></pre><p>到这里，init_bstartparm()函数就成功完成了它的使命。</p><h2>显示Logo</h2><p>前面我们已经设置了图形模式，也应该要展示一下了，检查一下工作成果。</p><p>我们来显示一下我们内核的logo。其实在二级引导器中，我已经帮你写好了显示logo函数，而logo文件是个<strong>24位的位图文件</strong>，目前为了简单起见，我们<strong>只支持这种格式的图片文件</strong>。下面我们去调用这个函数。</p><pre><code>void logo(machbstart_t* mbsp)\n{\n    u32_t retadr=0,sz=0;\n    //在映像文件中获取logo.bmp文件\n    get_file_rpadrandsz(&quot;logo.bmp&quot;,mbsp,&amp;retadr,&amp;sz);\n    if(0==retadr)\n    {\n        kerror(&quot;logo getfilerpadrsz err&quot;);\n    }\n    //显示logo文件中的图像数据\n    bmp_print((void*)retadr,mbsp);\n    return;\n}\nvoid init_graph(machbstart_t* mbsp)\n{    \n    //……前面代码省略\n    //显示\n    logo(mbsp);\n    return;\n}\n</code></pre><p>在图格式的文件中，除了文件头的数据就是图形像素点的数据，只不过24位的位图每个像素占用3字节，并且位置是倒排的，即第一个像素的数据是在文件的最后，依次类推。我们只要依次将位图文件的数据，按照倒排次序写入显存中，这样就可以显示了。</p><p>我们需要把二级引导器的文件和logo文件打包成映像文件，然后放在虚拟硬盘中。</p><p>复制文件到虚拟硬盘中得先mount，然后复制，最后转换成VDI格式的虚拟硬盘，再挂载到虚拟机上启动就行了。这也是为什么要手动建立硬盘的原因，打包命令如下。</p><pre><code>lmoskrlimg -m k -lhf initldrimh.bin -o Cosmos.eki -f initldrsve.bin initldrkrl.bin font.fnt logo.bmp\n</code></pre><p>如果手动打命令对你来说还是比较难，也别担心，我已经帮你写好了make脚本，你只需要进入代码目录中make vboxtest 就行了，运行结果如下 。</p><p><img src=\"https://static001.geekbang.org/resource/image/c3/y0/c3d4f0b072b837f208fbd52749913yy0.jpg?wh=1054*931\" alt=\"\" title=\"代码运行结果示意图\"></p><p>啊哈！终于显示了logo。是不是挺有成就感的？这至少证明我们辛苦写的代码是正确的。</p><p>但是目前我们的代码执行流还在二级引导器中，我们的目的是开发自己的操作系统，不，我们是要开发Cosmos。</p><p><strong>后面，我们正式用Cosmos命名我们的操作系统。</strong>Cosmos可以翻译成宇宙，尽管它刚刚诞生，但我对它充满期待，所以用了这样一个能够“包括万物，包罗万象”的名字。</p><h2>进入Cosmos</h2><p>我们在调用Cosmos第一个C函数之前，我们依然要写一小段汇编代码，切换CPU到长模式，初始化CPU寄存器和C语言要用的栈。因为目前代码执行流在二级引导器中，进入到Cosmos中这样在二级引导器中初始过的东西都不能用了。</p><p>因为CPU进入了长模式，寄存器的位宽都变了，所以需要重新初始化。让我们一起来写这段汇编代码吧，我们先在Cosmos/hal/x86/下建立一个init_entry.asm文件，写上后面这段代码。</p><pre><code>[section .start.text]\n[BITS 32]\n_start:\n    cli\n    mov ax,0x10\n    mov ds,ax\n    mov es,ax\n    mov ss,ax\n    mov fs,ax\n    mov gs,ax\n    lgdt [eGdtPtr]        \n    ;开启 PAE\n    mov eax, cr4\n    bts eax, 5                      ; CR4.PAE = 1\n    mov cr4, eax\n    mov eax, PML4T_BADR             ;加载MMU顶级页目录\n    mov cr3, eax\t\n    ;开启 64bits long-mode\n    mov ecx, IA32_EFER\n    rdmsr\n    bts eax, 8                      ; IA32_EFER.LME =1\n    wrmsr\n    ;开启 PE 和 paging\n    mov eax, cr0\n    bts eax, 0                      ; CR0.PE =1\n    bts eax, 31\n    ;开启 CACHE       \n    btr eax,29\t\t                ; CR0.NW=0\n    btr eax,30\t\t                ; CR0.CD=0  CACHE\n    mov cr0, eax                    ; IA32_EFER.LMA = 1\n    jmp 08:entry64\n[BITS 64]\nentry64:\n    mov ax,0x10\n    mov ds,ax\n    mov es,ax\n    mov ss,ax\n    mov fs,ax\n    mov gs,ax\n    xor rax,rax\n    xor rbx,rbx\n    xor rbp,rbp\n    xor rcx,rcx\n    xor rdx,rdx\n    xor rdi,rdi\n    xor rsi,rsi\n    xor r8,r8\n    xor r9,r9\n    xor r10,r10\n    xor r11,r11\n    xor r12,r12\n    xor r13,r13\n    xor r14,r14\n    xor r15,r15\n    mov rbx,MBSP_ADR\n    mov rax,KRLVIRADR\n    mov rcx,[rbx+KINITSTACK_OFF]\n    add rax,rcx\n    xor rcx,rcx\n    xor rbx,rbx\n    mov rsp,rax\n    push 0\n    push 0x8\n    mov rax,hal_start                 ;调用内核主函数\n    push rax\n    dw 0xcb48\n    jmp $\n[section .start.data]\n[BITS 32]\nx64_GDT:\nenull_x64_dsc:\tdq 0\t\nekrnl_c64_dsc:  dq 0x0020980000000000   ; 64-bit 内核代码段\nekrnl_d64_dsc:  dq 0x0000920000000000   ; 64-bit 内核数据段\neuser_c64_dsc:  dq 0x0020f80000000000   ; 64-bit 用户代码段\neuser_d64_dsc:  dq 0x0000f20000000000   ; 64-bit 用户数据段\neGdtLen\t\t\tequ\t$ - enull_x64_dsc   ; GDT长度\neGdtPtr:\t\tdw eGdtLen - 1\t\t\t; GDT界限\n\t\t\t\tdq ex64_GDT\n</code></pre><p>上述代码中，1～11行表示加载70～75行的GDT，13～17行是设置MMU并加载在二级引导器中准备好的MMU页表，19～30行是开启长模式并打开Cache，34～54行则是初始化长模式下的寄存器，55～61行是读取二级引导器准备的机器信息结构中的栈地址，并用这个数据设置RSP寄存器。</p><p>最关键的是63～66行，它开始把8和hal_start函数的地址压入栈中。dw 0xcb48是直接写一条指令的机器码——0xcb48，这是一条返回指令。这个返回指令有点特殊，它会把栈中的数据分别弹出到RIP，CS寄存器，这正是为了调用我们Cosmos的<strong>第一个C函数hal_start</strong>。</p><h2>重点回顾</h2><p>这是我们设置工作模式与环境的最后一课，到此为止我们的二级引导器已经建立起来了，成功从 GRUB手中接过了权柄，开始了它自己的一系列工作，二级引导器完成的工作不算少，我来帮你梳理一下，重点如下。</p><p>1.二级引导器彻底摆脱了GRUB的控制之后，就开始检查CPU，获取内存布局信息，确认是不是我们要求的CPU和内存大小，接着初始化内核栈、放置好内核文件和字库文件，建立MMU页表数据和设置好图形模式，为后面运行内核做好准备。</p><p>2.当二级引导器完成了上述功能后，就会显示我们操作系统的logo，这标志着二级引导器所有的工作一切正常。</p><p>3.进入Cosmos，我们的二级引导器通过跳转到Cosmos的入口，结束了自己光荣使命，Cosmos的入口是一小段汇编代码，主要是开启CPU的长模式，最后调用了Cosmos的第一个C函数hal_start。</p><p>你想过吗？我们的二级引导器还可以做更多的事情，其实还可以在二级引导器中获取ACPI表，进而获取CPU数量和其它设备信息，期待你的实现。</p><h2>思考题</h2><p>请你想一下，init_bstartparm()函数中的init_mem820()函数，这个函数到底干了什么？</p><p>欢迎你在留言区跟我互动。如果你身边有朋友对手写操作系统有热情，也欢迎你把这节课转发给他。</p>","neighbors":{"left":{"article_title":"11 | 设置工作模式与环境（中）：建造二级引导器","id":380507},"right":{"article_title":"13 | 第一个C函数：如何实现板级初始化？","id":381810}},"comments":[{"had_liked":false,"id":296235,"user_name":"neohope","can_delete":false,"product_type":"c1","uid":1043475,"ip_address":"","ucode":"C0268F6E7E2B6E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ec/13/49e98289.jpg","comment_is_top":true,"comment_ctime":1622831817,"is_pvip":false,"replies":[{"id":"107582","content":"因为有一段 地址是物理地址，二级引导器中，并没有切换到长模式，是没有办法使用高端的物理地址，只能从低端地址切换","user_name":"作者回复","comment_id":296235,"uid":"1345199","ip_address":"","utype":1,"ctime":1622988262,"user_name_real":"LMOS"}],"discussion_count":1,"race_medal":0,"score":"9.2233721071971e+18","product_id":100078401,"comment_content":"大体上整理了一下，有几处没弄清楚【下半部分】：<br>11、返回到bstartparm.c<br>调用了chkcpmm.c的init_bstartpages<br><br>12、然后调用到了fs.c的move_krlimg函数申请了内存，建立了MMU页表：<br>顶级页目录，开始于0x1000000<br>页目录指针目录，开始于0x1001000，，共16项 ，其中每一项都指向一个页目录<br>页目录，开始于0x1002000， 每页指向512 个物理页，每页2MB【 0x200000】<br><br>让物理地址p[0]和虚拟地址p[((KRNL_VIRTUAL_ADDRESS_START) &gt;&gt; KPML4_SHIFT) &amp; 0x1ff]，指向同一个页目录指针页，确保内核在启动初期，虚拟地址和物理地址要保持相同<br>没搞清楚为什么虚拟地址是这个，也暂时没搞清楚为何要指向(u64_t)((u32_t)pdpte | KPML4_RW | KPML4_P)<br><br>最后，把页表首地址保存在机器信息结构中<br><br>13、返回到bstartparm.c<br>调用了graph.c的init_graph<br>A、初始化了数据结构<br><br>B、调用init_bgadevice<br>首先获取GBA设备ID<br>检查设备最大分辨率<br>设置显示参数，并将参数保存到mbsp结构中<br><br>C、如果不是图形模式，要通过BIOS中断进行切换，设置显示参数，并将参数保存到mbsp结构中：<br>获取VBE模式，通过BIOS中断<br>获取一个具体VBE模式的信息，通过BIOS中断<br>设置VBE模式，通过BIOS中断<br>这三个方法同样用到了realadr_call_entry，调用路径与上面_getmmap类似，不再展开<br><br>D、初始化了一块儿内存<br>感觉会与物理地址与虚拟地址之间转换由一定关系<br><br>E、进行logo显示<br>调用get_file_rpadrandsz定位到位图文件<br>调用bmp_print，读入像素点，BGRA转换<br>最后调用write_pixcolor，写入到mbsp-&gt;mb_ghparm正确的位置，图像就显示出来了<br><br>14、然后一路返回<br>到bstartparm.c的init_bstartparm<br>到ldrkrlentry.c的ldrkrl_entry<br>到ldrkrl32.asm的call ldrkrl_entry<br>再往下是jmp 0x2000000<br>这个地址就是IMGKRNL_PHYADR，就是刚才放Cosmos.eki的位置<br><br>15、然后就接上了本节最后一部分内容了，不容易啊！哈哈哈！","like_count":16,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521373,"discussion_content":"因为有一段 地址是物理地址，二级引导器中，并没有切换到长模式，是没有办法使用高端的物理地址，只能从低端地址切换","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622988262,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296234,"user_name":"neohope","can_delete":false,"product_type":"c1","uid":1043475,"ip_address":"","ucode":"C0268F6E7E2B6E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ec/13/49e98289.jpg","comment_is_top":true,"comment_ctime":1622831678,"is_pvip":false,"replies":[{"id":"107583","content":"是的，你学的很透","user_name":"作者回复","comment_id":296234,"uid":"1345199","ip_address":"","utype":1,"ctime":1622988436,"user_name_real":"LMOS"}],"discussion_count":6,"race_medal":0,"score":"9.2233720943122002e+18","product_id":100078401,"comment_content":"大体上整理了一下，有几处没弄清楚【上半部分】：<br><br>1、bstartparm.c从init_bstartparm函数开始<br>A、初始化machbstart_t<br><br>2、跳转到chkcpmm.c的init_chkcpu函数，检查是否支持CPUID功能<br>A、init_chkcpu函数<br>CPU自带检查方式：无法反转 Eflags第21位，表示CPU支持CPUID功能<br>如果反转成功，说明不支持CPUID，打印内核错误并退出<br>B、然后调用CPUID功能，判断是否支持长模式<br>先通过通过0x80000000参数，调用cpuid命令，判断CPU是否支持扩展处理器信息【返回值比0x80000000大】<br>如果支持，通过0x80000001参数，调用cpuid命令，获取扩展处理器信息，然后检测第29位，判断是否支持长模式<br>如果不支持，打印内核错误并退出<br>C、设置mbsp中cpumode为64位<br><br>3、返回chkcpmm.c，继续检测内存信息<br>A、跳转到chkcpmm.c的init_mem函数<br>B、通过mmap调用realadr_call_entry(RLINTNR(0),0,0)<br>C、实际会执行ldrkrl32.asm的realadr_call_entry<br>D、跳转到save_eip_jmp<br>E、最后在cpmty_mode处，把 0x18：0x1000 [段描述索引：段内的偏移]，装入到 CS：EIP 寄存器中<br>F、而EIP这个地址恰恰是内存中initldrsve.bin的位置，因为之前write_realintsvefile把数据加载到了REALDRV_PHYADR  0x1000【而且在initldrsve.lds好像也指定了段内偏移0x1000】<br>同时CS中段描述符为k16cd_dsc，说明是16位代码段，可以执行，CPU继续从EIP地址执行<br>G、而initldrsve.bin是由realintsve.asm编译得到的，所以实际会继续执行realintsve.asm中代码<br>H、然后到real_entry这里，通过传入的参数ax，判断调用func_table哪个方法<br>当前参数位0，ax就是0，也就是调用了func_table的第一个函数_getmmap<br>I、_getmmap中，通过BIOS的15h中断，获取内存信息<br>J、检查内存信息，如果小于128M，打印内核错误并退出<br>K、设置machbstart_t内存相关参数<br>L、然后调用了init_acpi<br><br>4、在init_acpi中<br>通过“RSD PTR ”及校验，判断是否支持ACPI功能<br>不支持则 打印内核错误并退出<br><br>5、返回到bstartparm.c<br>好像是确认了一下initldrsve.bin的状态，获取了一下文件内存地址及大小<br><br>6、返回到bstartparm.c，继续调用到chkcpmm.c的init_krlinitstack函数<br><br>7、然后调用到了fs.c的move_krlimg函数<br>首先判断新申请的地址，是否可用<br>-》如果可用直接使用<br>-》如果不可用，则判断申请的内存大小是否超出设备物理大小<br>-》-》如果超出大小，系统打印内核错误并退出<br>-》-》如果不超出大小，系统会将内存对齐到0x1000后，将initldrsve.bin移动到新位置，并修正地址<br>整体来说move_krlimg更像是申请内存，但不知道为何要不断驱赶initldrsve.bin文件<br><br>8、返回到chkcpmm.c<br>初始化栈顶和栈大小<br><br>9、返回到bstartparm.c<br>调用fs.c的init_krlfile函数，将Cosmos.eki加载到了IMGKRNL_PHYADR<br>并填写了mbsp相关内容<br><br>10、返回到bstartparm.c<br>调用了chkcpmm.c的init_meme820函数<br>然后调用到了fs.c的move_krlimg函数申请了内存，拷贝了一份e820map_t到Cosmos.eki之后的地址，并修正mbsp指向新地址<br>感觉和内存保护 或 物理地址与虚拟地址之间转换有一定关系","like_count":13,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521372,"discussion_content":"是的，你学的很透","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622988436,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2616914,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ee/52/cda34b19.jpg","nickname":"Mike_Han","note":"","ucode":"C0E41AD4247A62","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380922,"discussion_content":"大佬们太厉害了，这没有一点嵌入式的经验啥都看不明白。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1624797977,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1927222,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/68/36/478194f3.jpg","nickname":"Shawn Duan","note":"","ucode":"628BAD6473FBCE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393547,"discussion_content":"是不是用两次xor来检查反转？我还不清楚  jz 1f 这句话，1f 这个跳转地址是怎么来的？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631494677,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1043475,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ec/13/49e98289.jpg","nickname":"neohope","note":"","ucode":"C0268F6E7E2B6E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377983,"discussion_content":"多谢！\n1、你是对的，应该是“无法反转 Eflags第21位，表示CPU不支持CPUID功能”。\n2、是写错了，但好像应该是“Cosmos.bin“，这个昨天就发现了。\n3、不知道哪里能编辑评论内容，有知道的小伙伴告诉一下。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622987481,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1474356,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI3F4IdQuDZrhN8ThibP85eCiaSWTYpTrcC6QB9EoAkw3IIj6otMibb1CgrS1uzITAnJmGLXQ2tgIkAQ/132","nickname":"cugphoenix","note":"","ucode":"80101AF04C00D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1043475,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ec/13/49e98289.jpg","nickname":"neohope","note":"","ucode":"C0268F6E7E2B6E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377991,"discussion_content":"哦对，是Cosmos.bin，我串台看成lesson11的代码了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622988876,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":377983,"ip_address":""},"score":377991,"extra":""}]},{"author":{"id":1474356,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI3F4IdQuDZrhN8ThibP85eCiaSWTYpTrcC6QB9EoAkw3IIj6otMibb1CgrS1uzITAnJmGLXQ2tgIkAQ/132","nickname":"cugphoenix","note":"","ucode":"80101AF04C00D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377860,"discussion_content":"有两个疑问：\n1. 检查CPUID是否可用，我的理解和你相反：应该是能够成功设置第21位，ret返回1，表示支持CPUID\n2. IMGKRNL_PHYADR处加载的是&#34;kernel.bin&#34;而不是Cosmos.eki。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622913994,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":316644,"user_name":"言C","can_delete":false,"product_type":"c1","uid":2416076,"ip_address":"","ucode":"D1BA5A8665ADC1","user_header":"https://static001.geekbang.org/account/avatar/00/24/dd/cc/9c926552.jpg","comment_is_top":true,"comment_ctime":1634472511,"is_pvip":false,"replies":[{"id":"114653","content":"厉害了 ","user_name":"作者回复","comment_id":316644,"uid":"1345199","ip_address":"","utype":1,"ctime":1634519995,"user_name_real":"LMOS"}],"discussion_count":1,"race_medal":0,"score":"9.2233720599641006e+18","product_id":100078401,"comment_content":"经过一段时间的摸索，今天终于成功显示了Cosmos的logo界面了，遇到了几个坑，特此来给大家填坑了：<br>1、出现无法找到Cosmos的错误提示，如下：<br>正在生成Cosmos内核映像文件，请稍后……<br>文件数：6<br>映像文件大小：4911104<br>Converting from raw image file=&quot;..&#47;hd.img&quot; to file=&quot;..&#47;exckrnl&#47;hd.vdi&quot;...<br>Creating dynamic image with size 104857600 bytes (100MB)...<br>VBoxManage: error: Could not find a registered machine named &#39;Cosmos&#39;<br>VBoxManage: error: Details: code VBOX_E_OBJECT_NOT_FOUND (0x80bb0001), component VirtualBoxWrap, interface IVirtualBox, callee nsISupports<br>VBoxManage: error: Context: &quot;FindMachine(Bstr(a-&gt;argv[0]).raw(), machine.asOutParam())&quot; at line 1044 of file VBoxManageStorageController.cpp<br>make[1]: *** [vbox.mkf:13：idectrnul] 错误 1<br>make: *** [Makefile:101：VBOXRUN] 错误 2<br><br>解决办法：需要自己建立一个虚拟机，命名为 Cosmos<br><br>2、运行 make  virtualtest 后，virtualbox启动后没有出现logo图片，而出现错误提示：INITKLDR DIE ERROR:S <br><br>解决办法：建立虚拟机时，需要选择为 64bit 的系统<br><br>3、这个问题是与第二个的关联问题，当你在建立虚拟机时，想选择64bit的系统，却发现只有 32bit 的<br><br>解决办法：<br>VirtualBox安装64位的系统需要满足以下条件：<br><br>1. 64位的cpu<br>2. cpu允许硬件虚拟化<br><br>先来看第一个条件，64位的CPU，这个嘛，现在的笔记本一般都是64位的了，所以不用担心，除非是好几年之间的电脑。如果你不清楚，可以打开命令行，输入systeminfo，在输出的信息中找到CPU这一行，如果是X86_64的，就是64位CPU；<br><br>第二条，是否开启CPU硬件虚拟化1，这个嘛，各大厂商的情况不大相同，有的电脑默认开启了（比如，我的HP），有的没有，所以需要自行开启，开启方法：开机时按某个键进入BIOS设置界面2。<br>然后，setup==&gt;security==&gt;cpu virtualization，将cpu virtualization这一项由Disable设置为Enable。保存，然后重启电脑，硬件虚拟化就开启成功了。<br><br>如果你是通过windows + vmware + virtualbox 的方式实现的，还需要设置 VMware，打开vmware，找到对应的虚拟机，虚拟机设置-&gt;硬件-&gt;处理器-&gt;虚拟化引擎，这里一般会有三个选项，全都勾上<br><br>然后在打开该虚拟机，去virtualbox中建立虚拟机时，就会发现有 64bit 的选项了<br> <br><br>","like_count":5,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528445,"discussion_content":"厉害了 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634519995,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296129,"user_name":"blentle","can_delete":false,"product_type":"c1","uid":1064679,"ip_address":"","ucode":"AC092609A4942A","user_header":"https://static001.geekbang.org/account/avatar/00/10/3e/e7/261711a5.jpg","comment_is_top":false,"comment_ctime":1622772981,"is_pvip":false,"replies":[{"id":"107590","content":"这个问题不重要啊 ","user_name":"作者回复","comment_id":296129,"uid":"1345199","ip_address":"","utype":1,"ctime":1622988806,"user_name_real":"LMOS"}],"discussion_count":7,"race_medal":0,"score":"53162380533","product_id":100078401,"comment_content":"首先，这个函数为啥这么命名，没整明白","like_count":13,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521333,"discussion_content":"这个问题不重要啊 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622988806,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2824732,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/1a/1c/d160d44b.jpg","nickname":"coder","note":"","ucode":"F85CD7A71EBA0C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":543390,"discussion_content":"命名给我看秃了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641116710,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":521333,"ip_address":""},"score":543390,"extra":""}]},{"author":{"id":2691941,"avatar":"https://static001.geekbang.org/account/avatar/00/29/13/65/c12d2187.jpg","nickname":"。","note":"","ucode":"BEDE830E8C28DC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383902,"discussion_content":"非常赞成命名非常重要，本身就缺少了很多注释，命名使用大量缩写和首字符，导致看名字根看天书一样不知道在干嘛","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1626276894,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1974893,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/P2wWic1IB46FQBLREjXgyibzzMsiaISW92KdqZhrxLrh8w0Tag1psWClZ9bzXibHKtZvADiaMRQLkSUwmM1z7jfQb2A/132","nickname":"lyc","note":"","ucode":"FB2CB580FA716E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378137,"discussion_content":"命名很重要啊，理解命名是理解设计思路的关键","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1623064391,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1064679,"avatar":"https://static001.geekbang.org/account/avatar/00/10/3e/e7/261711a5.jpg","nickname":"blentle","note":"","ucode":"AC092609A4942A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1974893,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/P2wWic1IB46FQBLREjXgyibzzMsiaISW92KdqZhrxLrh8w0Tag1psWClZ9bzXibHKtZvADiaMRQLkSUwmM1z7jfQb2A/132","nickname":"lyc","note":"","ucode":"FB2CB580FA716E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378165,"discussion_content":"赞成","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1623074731,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":378137,"ip_address":""},"score":378165,"extra":""},{"author":{"id":1736095,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/7d/9f/53dd1d94.jpg","nickname":"筱琲","note":"","ucode":"0896BD7CD8026C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1974893,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/P2wWic1IB46FQBLREjXgyibzzMsiaISW92KdqZhrxLrh8w0Tag1psWClZ9bzXibHKtZvADiaMRQLkSUwmM1z7jfQb2A/132","nickname":"lyc","note":"","ucode":"FB2CB580FA716E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":379722,"discussion_content":"赞成，不然跟看天书一样","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1624093406,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":378137,"ip_address":""},"score":379722,"extra":""}]},{"author":{"id":1927222,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/68/36/478194f3.jpg","nickname":"Shawn Duan","note":"","ucode":"628BAD6473FBCE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393531,"discussion_content":"命名常常可以代替注释，形成所谓自解释的代码。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1631491216,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296101,"user_name":"pedro","can_delete":false,"product_type":"c1","uid":1200704,"ip_address":"","ucode":"F40C839DDFD599","user_header":"https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg","comment_is_top":false,"comment_ctime":1622763019,"is_pvip":false,"replies":[{"id":"107591","content":"你猜的很对 看来我确实不用写注释","user_name":"作者回复","comment_id":296101,"uid":"1345199","ip_address":"","utype":1,"ctime":1622988908,"user_name_real":"LMOS"}],"discussion_count":1,"race_medal":0,"score":"44572435979","product_id":100078401,"comment_content":"思考题还是挺麻烦的，主要是没有注释啊，很多字段的含义都是靠猜，文章也没有介绍到这些。<br>首先是 init_mem820 这个函数本身：<br>```c<br>void init_meme820(machbstart_t *mbsp)<br>{<br>    e820map_t *semp = (e820map_t *)((u32_t)(mbsp-&gt;mb_e820padr)); &#47;&#47;  e820数组地址<br>    u64_t senr = mbsp-&gt;mb_e820nr; &#47;&#47; 个数<br>    e820map_t *demp = (e820map_t *)((u32_t)(mbsp-&gt;mb_nextwtpadr));<br>    if (1 &gt; move_krlimg(mbsp, (u64_t)((u32_t)demp), (senr * (sizeof(e820map_t)))))<br>    {<br>        kerror(&quot;move_krlimg err&quot;);<br>    }<br><br>    m2mcopy(semp, demp, (sint_t)(senr * (sizeof(e820map_t))));<br>    mbsp-&gt;mb_e820padr = (u64_t)((u32_t)(demp));<br>    mbsp-&gt;mb_e820sz = senr * (sizeof(e820map_t));<br>    mbsp-&gt;mb_nextwtpadr = P4K_ALIGN((u32_t)(demp) + (u32_t)(senr * (sizeof(e820map_t))));<br>    mbsp-&gt;mb_kalldendpadr = mbsp-&gt;mb_e820padr + mbsp-&gt;mb_e820sz;<br>    return;<br>}<br>```<br>我们发现这个函数实际上在拷贝内存，即将 semp 指针处的 senr * (sizeof(e820map_t) 内存大小拷贝到<br>demp 处，而 demp 的地址正是 mb_nextwtpadr，那么这个 mb_nextwtpadr 是怎么来的呢？在init_krlfile函数中可以大致猜测：<br><br>```c<br>void init_krlfile(machbstart_t *mbsp)<br>{<br>    u64_t sz = r_file_to_padr(mbsp, IMGKRNL_PHYADR, &quot;kernel.bin&quot;);<br>    if (0 == sz)<br>    {<br>        kerror(&quot;r_file_to_padr err&quot;);<br>    }<br>    mbsp-&gt;mb_krlimgpadr = IMGKRNL_PHYADR;<br>    mbsp-&gt;mb_krlsz = sz;<br>    &#47;&#47; 页对齐<br>    mbsp-&gt;mb_nextwtpadr = P4K_ALIGN(mbsp-&gt;mb_krlimgpadr + mbsp-&gt;mb_krlsz);<br>    mbsp-&gt;mb_kalldendpadr = mbsp-&gt;mb_krlimgpadr + mbsp-&gt;mb_krlsz;<br>    return;<br>}<br>```<br>没错，mb_nextwtpadr 正是跳过内核起始地址+内核大小后的第一个页地址，注意需要4k对齐。<br>那么刚才内存拷贝的意图也很明显，对于初始化后的内存，内核本身的内存映射是不可访问的，必须保护充分内核，所以 init_mem820 函数的作用是跳过内核初始化内存。<br>由于代码无注释，文中篇幅有限，如有错误，多多指正，望海涵~","like_count":10,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521327,"discussion_content":"你猜的很对 看来我确实不用写注释","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622988908,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296316,"user_name":"neohope","can_delete":false,"product_type":"c1","uid":1043475,"ip_address":"","ucode":"C0268F6E7E2B6E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ec/13/49e98289.jpg","comment_is_top":false,"comment_ctime":1622897252,"is_pvip":false,"replies":[{"id":"107579","content":"嗯 就是这样的","user_name":"作者回复","comment_id":296316,"uid":"1345199","ip_address":"","utype":1,"ctime":1622987768,"user_name_real":"LMOS"}],"discussion_count":1,"race_medal":0,"score":"31687668324","product_id":100078401,"comment_content":"大体上整理了一下，有几处没弄清楚【补充最后一段，发漏了】<br>15、然后就接上了本节最后一部分内容了，不容易啊！哈哈哈！<br>Cosmos.bin中【前面写错为Cosmos.eki了】，ld设置的程序入口为init_entry.asm的_start:<br><br>16、 init_entry.asm中_start:<br>A、关闭中断<br>B、通过LGDT命令，指定长度和初始位置，加载GDT<br>C、设置页表，开启PAE【CR4第五位设置为1】，将页表顶级目录放入CR3<br>D、读取EFER，将第八位设置为1，写回EFER，设置为长模式<br>E、开启保护模式【CR0第0位设置为1】，开启分页【CR0第31位设置为1】，开启CACHE【CR0第30位设置为0】，开启WriteThrough【CR0第29位设置为0】<br>F、初始化寄存器们<br>G、将之前复制到Cosmos.bin之后的mbsp地址，放入rsp<br>H、0入栈，0x8入栈， hal_start 函数地址入栈<br>I、调用机器指令“0xcb48”，做一个“返回”操作，同时从栈中弹出两个数据[0x8：hal_start 函数地址]，到[CS：RIP]<br>长模式下，指令寄存器为RIP，也就是说下一个指令为hal_start 函数地址<br>CS中为0x8，对应到ekrnl_c64_dsc，对应到内核代码段，可以执行，CPU继续冲RIP地址执行<br><br>17、hal_start.c<br>A、执行hal_start函数","like_count":7,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521392,"discussion_content":"嗯 就是这样的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622987768,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296158,"user_name":"嗣树","can_delete":false,"product_type":"c1","uid":1019334,"ip_address":"","ucode":"C6196E30F867D0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/c6/e648d118.jpg","comment_is_top":false,"comment_ctime":1622779014,"is_pvip":false,"replies":[{"id":"107587","content":"对 的 对的 就是这样的","user_name":"作者回复","comment_id":296158,"uid":"1345199","ip_address":"","utype":1,"ctime":1622988668,"user_name_real":"LMOS"}],"discussion_count":2,"race_medal":0,"score":"27392582790","product_id":100078401,"comment_content":"回答下思考题，init_mem820() 的作用？<br><br>先说结论，init_mem820 函数的作用是将 init_mem() 中获取到的内存信息转存到字体文件之后，其实就是为它找一个安稳的地方存放。<br><br>简单分析一下：<br>init_mem() -&gt; mmap() -&gt; realadr_call_entry()<br>然后进入实模式调用中断，实模式的访址能力是有限，我们为中断处理指定临时的地址(E80MAP_ADRADR) 存放内存信息数组<br>#define ETYBAK_ADR 0x2000<br>#define E80MAP_ADRADR (ETYBAK_ADR+68)<br><br>接下来在把内核文件加载到指定内存地址，字体文件紧随其后，然后就是我们收集到的信息，我们还要把放在临时位置的信息复制出来。<br>","like_count":6,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521342,"discussion_content":"对 的 对的 就是这样的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622988668,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2619032,"avatar":"https://static001.geekbang.org/account/avatar/00/27/f6/98/e9708792.jpg","nickname":"北极","note":"","ucode":"3FDF3F2A8DD2F8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386432,"discussion_content":"为什么你知道的这么多？？？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627571843,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296326,"user_name":"然","can_delete":false,"product_type":"c1","uid":2403940,"ip_address":"","ucode":"BC69AA16BCB20A","user_header":"https://static001.geekbang.org/account/avatar/00/24/ae/64/98ef557d.jpg","comment_is_top":false,"comment_ctime":1622901092,"is_pvip":false,"replies":[{"id":"107578","content":"对 对 对 你理解的很好","user_name":"作者回复","comment_id":296326,"uid":"1345199","ip_address":"","utype":1,"ctime":1622987683,"user_name_real":"LMOS"}],"discussion_count":4,"race_medal":0,"score":"18802770276","product_id":100078401,"comment_content":"init_mem820()函数作用是把e820map结构数组从低地址处（0x2068）搬到高地址处（0x2000000之上）。<br><br>问什么要搬？在实模式下能用的地址空间有限，只能访问低地址。所以e820map结构数组不能一直存在低地址处。","like_count":4,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521397,"discussion_content":"对 对 对 你理解的很好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622987683,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1182103,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/97/a13db556.jpg","nickname":"徐旭","note":"","ucode":"0B00D3C3070A43","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579275,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657273552,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1474356,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI3F4IdQuDZrhN8ThibP85eCiaSWTYpTrcC6QB9EoAkw3IIj6otMibb1CgrS1uzITAnJmGLXQ2tgIkAQ/132","nickname":"cugphoenix","note":"","ucode":"80101AF04C00D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377993,"discussion_content":"开始只能放在低地址可以理解，但为啥不能一直存放在低地址呢？\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622989152,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2694205,"avatar":"https://static001.geekbang.org/account/avatar/00/29/1c/3d/76465ee4.jpg","nickname":"摘星","note":"","ucode":"55D8CAFC938F91","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1474356,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI3F4IdQuDZrhN8ThibP85eCiaSWTYpTrcC6QB9EoAkw3IIj6otMibb1CgrS1uzITAnJmGLXQ2tgIkAQ/132","nickname":"cugphoenix","note":"","ucode":"80101AF04C00D3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577793,"discussion_content":"原因已经说了呀，如果运行在实模式下，内存只能访问1MB的范围，如果放在低位地址的话，实模式下内存就容易占满。要记住噢，我们是需要用到中断机制的，而中断机制只能在实模式下使用。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656336160,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":377993,"ip_address":""},"score":577793,"extra":""}]}]},{"had_liked":false,"id":335327,"user_name":"一叉树","can_delete":false,"product_type":"c1","uid":1623117,"ip_address":"","ucode":"BFC984403ACD1F","user_header":"https://static001.geekbang.org/account/avatar/00/18/c4/4d/85014aab.jpg","comment_is_top":false,"comment_ctime":1645452235,"is_pvip":true,"replies":[{"id":"122502","content":"66666","user_name":"作者回复","comment_id":335327,"uid":"1345199","ip_address":"","utype":1,"ctime":1645526118,"user_name_real":"编辑"}],"discussion_count":1,"race_medal":0,"score":"14530354123","product_id":100078401,"comment_content":"Mac 主机 + VBox。卡在了文中“你只需要进入代码目录中 make vboxtest 就行了，运行结果如下 。”这一步很久很久。<br><br>我是在 Ubuntu 虚拟机中执行 make vboxtest 的，会生成一个 hd.img，同时会有如下报错<br><br>恭喜我，系统编译构建完成！ ^_^<br>恭喜我，系统编译构建完成！ ^_^<br>正在生成Cosmos内核映像文件，请稍后……<br>文件数：6<br>映像文件大小：4911104<br>[sudo] password for mie: <br>make[1]: VBoxManage: Command not found<br>make[1]: *** [vbox.mkf:23: tranvdi] Error 127<br>make: *** [Makefile:101: VBOXRUN] Error 2<br><br>这时候需要自己<br>1. 把生成的 hd.img 搞到外面的 mac<br>2. 使用第 10 节课用到的命令转化为 vdi 文件：<br>VBoxManage convertfromraw .&#47;hd.img --format VDI .&#47;hd.vdi<br>3. 新建一个虚拟机，将这个生成的 hd.vdi 当硬盘挂上去<br>4. 成功运行 ^_^<br><br>曾经郁闷这一步怎么这么跳跃，文中省了这么多步骤。但仔细观察 cosmos&#47;lesson12&#47;Cosmos&#47;build&#47;vbox.mkf 这个文件你会发现，这一切老师早帮你写好了，只是我使用 mac主机 + Ubuntu虚拟机学习 + 另一虚拟机运行结果，用了两个虚拟机而非套娃，所以在 Ubuntu 中报错 VBoxManage: Command not found。老师写的自动拉起虚拟机运行的脚本没能自动运行。","like_count":3,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552617,"discussion_content":"66666","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645526118,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":307282,"user_name":"scutgj2010","can_delete":false,"product_type":"c1","uid":1055665,"ip_address":"","ucode":"7700A05D445CF9","user_header":"https://static001.geekbang.org/account/avatar/00/10/1b/b1/26955fb4.jpg","comment_is_top":false,"comment_ctime":1629003240,"is_pvip":true,"replies":[{"id":"111303","content":"必须要118 否则要改图形驱动的 ","user_name":"作者回复","comment_id":307282,"uid":"1345199","ip_address":"","utype":1,"ctime":1629085745,"user_name_real":"LMOS"}],"discussion_count":4,"race_medal":0,"score":"14513905128","product_id":100078401,"comment_content":"我是vmware虚拟机，不支持VBE的118模式，一直在报错vbe mode not 118，手动改成117或者120，还是继续报错，这个怎么解决呀？","like_count":3,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525103,"discussion_content":"必须要118 否则要改图形驱动的 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629085745,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2066864,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/89/b0/071ffc60.jpg","nickname":"四相物联","note":"","ucode":"A62E79A9BDA436","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":398096,"discussion_content":"同样有这个问题，有办法解决吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632734996,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"听水的湖","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391176,"discussion_content":"换成VBOX就好啦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630325082,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2732861,"avatar":"https://static001.geekbang.org/account/avatar/00/29/b3/3d/e027e747.jpg","nickname":"dodo","note":"","ucode":"50387ADA2DEA54","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389273,"discussion_content":"同样遇到了这个问题，请问解决了吗老哥？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629198553,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":298500,"user_name":"XF-薛峰","can_delete":false,"product_type":"c1","uid":2621994,"ip_address":"","ucode":"046F1E06D5CBD8","user_header":"https://static001.geekbang.org/account/avatar/00/28/02/2a/2b0018d3.jpg","comment_is_top":false,"comment_ctime":1624158715,"is_pvip":false,"replies":[{"id":"108289","content":"你好，你需要转换成 hd.vdi","user_name":"作者回复","comment_id":298500,"uid":"1345199","ip_address":"","utype":1,"ctime":1624181079,"user_name_real":"LMOS"}],"discussion_count":7,"race_medal":0,"score":"14509060603","product_id":100078401,"comment_content":"这一讲的实验，我的配置是Win10+Virtualbox+Ubuntu用来做make编译，使用make vboxtest命令编译，有关Vbox的报错不用理会（我没在虚拟机下的虚拟机里安装），只要找到hd.vdi文件就好了，退出Ubuntu，另新建虚拟机使用这个hd.vdi就行了。如果只使用make，没有转换成hd.vdi","like_count":3,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522159,"discussion_content":"你好，你需要转换成 hd.vdi","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624181079,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2637373,"avatar":"https://static001.geekbang.org/account/avatar/00/28/3e/3d/0ae2621e.jpg","nickname":"黎标松","note":"","ucode":"7466008F6307B6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386494,"discussion_content":"我找到了，找到那个编译后的cosmos.eki文件，然后按照之前的流程挂载硬盘，复制eki文件到hdisk/boot中，然后转换成VDI格式的文件就可以了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1627615176,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":2406655,"avatar":"https://static001.geekbang.org/account/avatar/00/24/b8/ff/d327274b.jpg","nickname":"wtafting","note":"","ucode":"3690C222F23C30","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2637373,"avatar":"https://static001.geekbang.org/account/avatar/00/28/3e/3d/0ae2621e.jpg","nickname":"黎标松","note":"","ucode":"7466008F6307B6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388893,"discussion_content":"感谢大佬，按这个方法记录了下操作的大致过程https://blog.nowcoder.net/n/9a592bf85fb04aa0b4cd8fbf969519b6","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629029292,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":386494,"ip_address":""},"score":388893,"extra":""},{"author":{"id":2805095,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/cd/67/8e8e65ce.jpg","nickname":"安之若素","note":"","ucode":"3B407E50680740","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2637373,"avatar":"https://static001.geekbang.org/account/avatar/00/28/3e/3d/0ae2621e.jpg","nickname":"黎标松","note":"","ucode":"7466008F6307B6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":414367,"discussion_content":"大佬，为啥我按照这个方法，重新挂载，cosmos启动还是没找到eki","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636728308,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":386494,"ip_address":""},"score":414367,"extra":""}]},{"author":{"id":2805095,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/cd/67/8e8e65ce.jpg","nickname":"安之若素","note":"","ucode":"3B407E50680740","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":414365,"discussion_content":"Cosmos.eki是放在hdisk/boot/目录下嘛？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636728209,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2637373,"avatar":"https://static001.geekbang.org/account/avatar/00/28/3e/3d/0ae2621e.jpg","nickname":"黎标松","note":"","ucode":"7466008F6307B6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385517,"discussion_content":"大佬，我也是和你一样的配置（windows宿主机，用了虚拟机跑ubuntu，又下了vituralBox跑helloOS）,这一讲的hd.vdi去哪找啊？我用make vboxtest就报错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627108490,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1527329,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoc8sReia18fc3LgNBcL1lQ1OfdcNvSNPichaiccDHxNG4Arx21CjgrZJG2y8KibniaLlbibtOo53qEEnAw/132","nickname":"Hezhen","note":"","ucode":"C8C0AAA23D3302","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2637373,"avatar":"https://static001.geekbang.org/account/avatar/00/28/3e/3d/0ae2621e.jpg","nickname":"黎标松","note":"","ucode":"7466008F6307B6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385692,"discussion_content":"我也不知道去哪找","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627210925,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":385517,"ip_address":""},"score":385692,"extra":""}]}]},{"had_liked":false,"id":296378,"user_name":"孙孙孙","can_delete":false,"product_type":"c1","uid":1019982,"ip_address":"","ucode":"B37A299B83C890","user_header":"https://static001.geekbang.org/account/avatar/00/0f/90/4e/0da9d4d2.jpg","comment_is_top":false,"comment_ctime":1622948215,"is_pvip":false,"replies":[{"id":"107573","content":"你好，你需要先建立一个虚拟机","user_name":"作者回复","comment_id":296378,"uid":"1345199","ip_address":"","utype":1,"ctime":1622987468,"user_name_real":"LMOS"}],"discussion_count":1,"race_medal":0,"score":"14507850103","product_id":100078401,"comment_content":"正在生成Cosmos内核映像文件，请稍后……<br>文件数：6<br>映像文件大小：4911104<br>Converting from raw image file=&quot;..&#47;hd.img&quot; to file=&quot;..&#47;exckrnl&#47;hd.vdi&quot;...<br>Creating dynamic image with size 104857600 bytes (100MB)...<br>VBoxManage: error: Could not find a registered machine named &#39;Cosmos&#39;<br>VBoxManage: error: Details: code VBOX_E_OBJECT_NOT_FOUND (0x80bb0001), component VirtualBoxWrap, interface IVirtualBox, callee nsISupports<br>VBoxManage: error: Context: &quot;FindMachine(Bstr(a-&gt;argv[0]).raw(), machine.asOutParam())&quot; at line 1044 of file VBoxManageStorageController.cpp<br>make[1]: *** [vbox.mkf:13：idectrnul] 错误 1<br>make: *** [Makefile:101：VBOXRUN] 错误 2<br> 有人知道这个是为什么吗?","like_count":3,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521418,"discussion_content":"你好，你需要先建立一个虚拟机","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622987468,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":313765,"user_name":"野欲","can_delete":false,"product_type":"c1","uid":2753023,"ip_address":"","ucode":"AE553494D3FC4F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/CN4AD6J2Kcgc4ywz1SSXXvVG2XBmdJQ1RC1mhVjyanmbyOOfWFo5vvIiaIXzVicrVgJ8pvBQC1YZkk6rYdZ9utVA/132","comment_is_top":false,"comment_ctime":1632654072,"is_pvip":false,"replies":[{"id":"113623","content":"那就再来一遍","user_name":"作者回复","comment_id":313765,"uid":"1345199","ip_address":"","utype":1,"ctime":1632705747,"user_name_real":"LMOS"}],"discussion_count":1,"race_medal":0,"score":"10222588664","product_id":100078401,"comment_content":"跟着写完了代码也不知道cosmos是怎么跑起来的,迷惑","like_count":2,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527465,"discussion_content":"那就再来一遍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632705747,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":297416,"user_name":"zhanghj","can_delete":false,"product_type":"c1","uid":1481839,"ip_address":"","ucode":"87BFD1F5D5F497","user_header":"https://static001.geekbang.org/account/avatar/00/16/9c/6f/f96bd546.jpg","comment_is_top":false,"comment_ctime":1623515268,"is_pvip":false,"replies":[{"id":"108067","content":"看看内存的布局 进行合理规划","user_name":"作者回复","comment_id":297416,"uid":"1345199","ip_address":"","utype":1,"ctime":1623723562,"user_name_real":"LMOS"}],"discussion_count":3,"race_medal":0,"score":"10213449860","product_id":100078401,"comment_content":"各种数据结构放的位置，比如内存视图，内核文件保存的位置，栈顶指针的地址，这些地址值是如何规划的？","like_count":2,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521822,"discussion_content":"看看内存的布局 进行合理规划","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623723562,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"听水的湖","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391178,"discussion_content":"后面讲内存的时候还会说","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630325104,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1077953,"avatar":"https://static001.geekbang.org/account/avatar/00/10/72/c1/59509397.jpg","nickname":"沈畅","note":"","ucode":"7404E41356B36B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389989,"discussion_content":"最好有一张内存布局图啊，要不然太不好理解了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629560071,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296358,"user_name":"熊光红","can_delete":false,"product_type":"c1","uid":2617636,"ip_address":"","ucode":"2216C008FAD248","user_header":"https://static001.geekbang.org/account/avatar/00/27/f1/24/07ce02a0.jpg","comment_is_top":false,"comment_ctime":1622937497,"is_pvip":false,"replies":[{"id":"107576","content":"你好，你需要给虚拟机配置更大的内存","user_name":"作者回复","comment_id":296358,"uid":"1345199","ip_address":"","utype":1,"ctime":1622987606,"user_name_real":"LMOS"}],"discussion_count":3,"race_medal":0,"score":"10212872089","product_id":100078401,"comment_content":"用lession12的hd.img制作了个hd.vdi，加载到虚拟机，运行出现out of memory错误，请问如何建立调试环境调试一下，看看哪儿出错了","like_count":2,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521410,"discussion_content":"你好，你需要给虚拟机配置更大的内存","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622987606,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1474356,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI3F4IdQuDZrhN8ThibP85eCiaSWTYpTrcC6QB9EoAkw3IIj6otMibb1CgrS1uzITAnJmGLXQ2tgIkAQ/132","nickname":"cugphoenix","note":"","ucode":"80101AF04C00D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377886,"discussion_content":"检查下虚拟机的内存配置","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622946719,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2617636,"avatar":"https://static001.geekbang.org/account/avatar/00/27/f1/24/07ce02a0.jpg","nickname":"熊光红","note":"","ucode":"2216C008FAD248","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1474356,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI3F4IdQuDZrhN8ThibP85eCiaSWTYpTrcC6QB9EoAkw3IIj6otMibb1CgrS1uzITAnJmGLXQ2tgIkAQ/132","nickname":"cugphoenix","note":"","ucode":"80101AF04C00D3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384435,"discussion_content":"确实内存不够，我把内存弄到1024就行了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626590265,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":377886,"ip_address":""},"score":384435,"extra":""}]}]},{"had_liked":false,"id":357345,"user_name":"didi迪迪","can_delete":false,"product_type":"c1","uid":1244282,"ip_address":"湖北","ucode":"0FF1C8A5162695","user_header":"https://static001.geekbang.org/account/avatar/00/12/fc/7a/f4dec0b9.jpg","comment_is_top":false,"comment_ctime":1663167744,"is_pvip":false,"replies":[{"id":"130132","content":"可以看MMU是如何转换地址的","user_name":"作者回复","comment_id":357345,"uid":"1345199","ip_address":"湖北","utype":1,"ctime":1663395758,"user_name_real":"编辑"}],"discussion_count":1,"race_medal":0,"score":"5958135040","product_id":100078401,"comment_content":"作者，您好，想请您解释下下面这段话：<br>顶级页目录中第 0 项和第 ((KRNL_VIRTUAL_ADDRESS_START) &gt;&gt; KPML4_SHIFT) &amp; 0x1ff 项，指向同一个页目录指针页，这样的话就能让虚拟地址：0xffff800000000000～0xffff800400000000 和虚拟地址：0～0x400000000，访问到同一个物理地址空间 0～0x400000000<br>通过计算，发现 ((KRNL_VIRTUAL_ADDRESS_START) &gt;&gt; KPML4_SHIFT) &amp; 0x1ff为100000000，也就是256，但是为什么第0项和第256项指向一个页目录指针页就可以实现访问同一个物理地址空间呢？","like_count":1,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587932,"discussion_content":"可以看MMU是如何转换地址的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663395758,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"湖北"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":322210,"user_name":"Geek_504185","can_delete":false,"product_type":"c1","uid":2723475,"ip_address":"","ucode":"1C13797BD0DCF4","user_header":"","comment_is_top":false,"comment_ctime":1637237559,"is_pvip":false,"replies":[{"id":"117024","content":"是的 ","user_name":"作者回复","comment_id":322210,"uid":"1345199","ip_address":"","utype":1,"ctime":1637307486,"user_name_real":"编辑"}],"discussion_count":1,"race_medal":0,"score":"5932204855","product_id":100078401,"comment_content":"7. 然后回到12课代码的根目录有Makefile的目录，利用命令make vboxtest，虚拟机启动了一直提示VT-x不支持。<br>8.查了资料，从BIOS里查看了已经开启虚拟化了，不知道为啥原因，有说Win10从10月后多Hyper-v需要关闭；<br>9.关闭了Hyper-V，再次实验还是提示不支持。<br>10.考虑是否是Virtualbox里没开启VT-x，查了虚拟机Cosmos，设置的system里确实没开启；<br>11.使用命令开启，开启后还是不行，完全懵了。<br>12.使用手工创建Cosmos虚拟机，发现Virtualbox就是没有64位系统的选项。<br>13.这时考虑到Virtualbox的宿主机是VMWare，所以VMWare也开启VT-x！！！！<br>14.再次运行，需修改Cosmos虚拟机内存，默认128M，改为1024M，实验成功。","like_count":1,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":531415,"discussion_content":"是的 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637307486,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":322208,"user_name":"Geek_504185","can_delete":false,"product_type":"c1","uid":2723475,"ip_address":"","ucode":"1C13797BD0DCF4","user_header":"","comment_is_top":false,"comment_ctime":1637237455,"is_pvip":false,"replies":[{"id":"117023","content":"哈哈","user_name":"作者回复","comment_id":322208,"uid":"1345199","ip_address":"","utype":1,"ctime":1637307478,"user_name_real":"编辑"}],"discussion_count":1,"race_medal":0,"score":"5932204751","product_id":100078401,"comment_content":"先说步骤吧：<br>第一步：开启硬件BIOS里的VT-x；<br>第二步： 如果和我一样有虚拟机开启虚拟机的VT-x；<br>第三步：检查Virtualbox创建虚拟机时出现了可以选择创建64位系统的选项就可以了；<br>第四步：lesson12代码，<br>\tcd build,<br> \tmake createvm -f vbox.mkf<br>\tmake crtidectr -f vbox.mkf<br>\t cd ..<br>\tmake vboxtest<br><br>其中这几天实验过程记录一下：<br>我的开始用的环境是：Win10+VMware12 （Ubuntu20.4 64位）<br><br>1. 开始从Ubuntu里创建hd.img，安装grub和编译Cosmos.eki放到&#47;boot&#47;目录下；<br>2. 然后利用StarWindConverter.exe转换成VMware识别的硬盘格式，运行；<br>3.运行程序提示INITKRL DIE ERROR：not find file ；<br>4.开始以为是VMWare虚拟机的问题（目前来看应该不是），转战使用Ubuntu20.4 里安装Virtualbox，开启套娃模式。<br>5.Ubuntu64位操作系统里使用sudo apt-get install virtualbox-6.1提示Package &#39;virtualbox-6.1&#39; has no installation candidate，<br>  就去官网下载64位virtualbox手动安装，最后提示安装失败，不支持，最后利用Ubuntu自带的App Store安装了Virtualbox6.1；<br>6.开始利用12课代码做实验，仔细看来makefi","like_count":1,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":531414,"discussion_content":"哈哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637307478,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":311341,"user_name":"余生","can_delete":false,"product_type":"c1","uid":2421369,"ip_address":"","ucode":"AEF6C96738F03B","user_header":"https://static001.geekbang.org/account/avatar/00/24/f2/79/b2012f53.jpg","comment_is_top":false,"comment_ctime":1631178510,"is_pvip":true,"replies":[{"id":"112833","content":"怎么会有这个错误的 ","user_name":"作者回复","comment_id":311341,"uid":"1345199","ip_address":"","utype":1,"ctime":1631195148,"user_name_real":"LMOS"}],"discussion_count":5,"race_medal":0,"score":"5926145806","product_id":100078401,"comment_content":"起动提示INITKLDR DIE ERROR:S ，建虚机时选64位，入坑了很久才爬出来","like_count":1,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526565,"discussion_content":"怎么会有这个错误的 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631195148,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1581509,"avatar":"https://static001.geekbang.org/account/avatar/00/18/21/c5/024e1ef1.jpg","nickname":"X","note":"","ucode":"BE05C1D25CE313","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582227,"discussion_content":"大佬，你们最后怎么解决的呀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659323631,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"上海"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2788783,"avatar":"","nickname":"Geek_ec5711","note":"","ucode":"7C00B60AD0F8E3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536105,"discussion_content":"为什么我选择的64为还是有这个错误呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638689894,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":2834597,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/40/a5/5552e56f.jpg","nickname":"猪","note":"","ucode":"2030961A18DBED","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":2788783,"avatar":"","nickname":"Geek_ec5711","note":"","ucode":"7C00B60AD0F8E3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550266,"discussion_content":"我是64也仍然有这个错误","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644461871,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":536105,"ip_address":""},"score":550266,"extra":""},{"author":{"id":1581509,"avatar":"https://static001.geekbang.org/account/avatar/00/18/21/c5/024e1ef1.jpg","nickname":"X","note":"","ucode":"BE05C1D25CE313","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2788783,"avatar":"","nickname":"Geek_ec5711","note":"","ucode":"7C00B60AD0F8E3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582225,"discussion_content":"我也是64的，也是这个错误，啊，好无语啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659323166,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":536105,"ip_address":"上海"},"score":582225,"extra":""}]}]},{"had_liked":false,"id":310265,"user_name":"李城","can_delete":false,"product_type":"c1","uid":1178352,"ip_address":"","ucode":"896A9C43CB62CD","user_header":"https://static001.geekbang.org/account/avatar/00/11/fa/f0/241294cd.jpg","comment_is_top":false,"comment_ctime":1630572651,"is_pvip":false,"replies":[{"id":"112432","content":"用gitee上课程目录中的代码构建  不要自己替换","user_name":"作者回复","comment_id":310265,"uid":"1345199","ip_address":"","utype":1,"ctime":1630631898,"user_name_real":"LMOS"}],"discussion_count":1,"race_medal":0,"score":"5925539947","product_id":100078401,"comment_content":"将Cosmos.eki 更名为HelloOS.eki, 放在.&#47;hdisk&#47;boot 目录下，打开虚拟机，报错 not find file, 不知如何下手","like_count":1,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526177,"discussion_content":"用gitee上课程目录中的代码构建  不要自己替换","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630631898,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296092,"user_name":"springXu","can_delete":false,"product_type":"c1","uid":2064750,"ip_address":"","ucode":"F5DB0B963C894F","user_header":"","comment_is_top":false,"comment_ctime":1622739485,"is_pvip":true,"replies":[{"id":"107501","content":"哈哈 是滴。","user_name":"编辑回复","user_name_real":"赵宇新","uid":"1501385","ctime":1622823662,"ip_address":"","comment_id":296092,"utype":2}],"discussion_count":1,"race_medal":0,"score":"5917706781","product_id":100078401,"comment_content":"还很奇怪mem820这个函数怎么没有细讲。原来是思考题。","like_count":1,"discussions":[{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"听水的湖","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521322,"discussion_content":"哈哈 是滴。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622823662,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360779,"user_name":"Lcz","can_delete":false,"product_type":"c1","uid":1700644,"ip_address":"湖北","ucode":"20D8BBE5298D1C","user_header":"https://static001.geekbang.org/account/avatar/00/19/f3/24/9fdbb5e6.jpg","comment_is_top":false,"comment_ctime":1666846598,"is_pvip":false,"replies":[{"id":"131298","content":"在虚拟硬盘中","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1667029897,"ip_address":"湖北","comment_id":360779,"utype":1}],"discussion_count":1,"race_medal":2,"score":"1666846598","product_id":100078401,"comment_content":"makefile文件中有执行sudo cp ..&#47;release&#47;Cosmos.eki  ..&#47;hdisk&#47;boot&#47;指令后，为什么..&#47;hdisk&#47;boot&#47;下不会有Cosmos.eki,但virtualbox启动成功？？？？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592011,"discussion_content":"在虚拟硬盘中","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667029897,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"湖北"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":359817,"user_name":"│．Sk","can_delete":false,"product_type":"c1","uid":2453415,"ip_address":"湖北","ucode":"A2EEB2E9585A77","user_header":"https://static001.geekbang.org/account/avatar/00/25/6f/a7/565214bc.jpg","comment_is_top":false,"comment_ctime":1665931943,"is_pvip":false,"replies":[{"id":"131055","content":"KINITPAGE_PHYADR  是在后面才用到的","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1666421123,"ip_address":"湖北","comment_id":359817,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1665931943","product_id":100078401,"comment_content":"老师好，请教一个问题：<br><br>1. hal&#47;x86&#47;init_entry.asm 中把 PML4T_BADR（0x20000）加载到 cr3 作为顶级页目录的基地址<br><br>2. 但是在 initldr&#47;ldrkrl&#47;chkcpmm.c 中 顶级页目录的基地址初始化为 KINITPAGE_PHYADR（0x1000000）<br><br>3. 感觉 hal&#47;x86&#47;init_entry.asm 是不是应该把 KINITPAGE_PHYADR 赋值给 cr3 才对<br><br>","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591251,"discussion_content":"KINITPAGE_PHYADR  是在后面才用到的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666421123,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"湖北"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358199,"user_name":"鹿 平平","can_delete":false,"product_type":"c1","uid":3177969,"ip_address":"湖北","ucode":"0F0F4BF7919C46","user_header":"https://static001.geekbang.org/account/avatar/00/30/7d/f1/ed792520.jpg","comment_is_top":false,"comment_ctime":1664030566,"is_pvip":false,"replies":[{"id":"130477","content":"你可能没写对  我代码中有写mutliboot header 的 ","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1664596622,"ip_address":"湖北","comment_id":358199,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1664030566","product_id":100078401,"comment_content":"请问作者出现<br>error:no mutliboot header found<br>error:you need to load kernel frist<br>这个是哪出现的问题，我是按照作者的思路写的。","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589260,"discussion_content":"你可能没写对  我代码中有写mutliboot header 的 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1664596622,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"湖北"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3175868,"avatar":"","nickname":"Geek_dc8ae9","note":"","ucode":"36A59C0344E110","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589010,"discussion_content":"解决没，我也出现这个问题了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1664333916,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"江苏"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356385,"user_name":"刘昊","can_delete":false,"product_type":"c1","uid":1067871,"ip_address":"湖北","ucode":"AA35454CA6D0BD","user_header":"https://static001.geekbang.org/account/avatar/00/10/4b/5f/791d0f5e.jpg","comment_is_top":false,"comment_ctime":1662252651,"is_pvip":false,"replies":[{"id":"129935","content":"你可以查看machstart 结构","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1662885411,"ip_address":"湖北","comment_id":356385,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1662252651","product_id":100078401,"comment_content":"彭东老师，看完您的10-12讲受益匪浅，首先讲的是非常清楚，整个流程在ubuntu没有任何阻碍地运行起来。但我发现我看完之后对现在内存的布局很模糊，步骤一多就不知道现在内存长啥样子了，可不可以在关键步骤后简单绘制一下当前内存的全局布局，例如什么东西在哪一块，这样也好帮助最后大家在自己做ACPI表获取的时候的布局规划","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587219,"discussion_content":"你可以查看machstart 结构","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662885412,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"湖北"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355666,"user_name":"滑稽主教","can_delete":false,"product_type":"c1","uid":3159952,"ip_address":"湖北","ucode":"AB5E91FEB428E2","user_header":"https://static001.geekbang.org/account/avatar/00/30/37/90/3dca97ce.jpg","comment_is_top":false,"comment_ctime":1661609304,"is_pvip":false,"replies":[{"id":"129745","content":"没有建立GRUB","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1662256390,"ip_address":"湖北","comment_id":355666,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1661609304","product_id":100078401,"comment_content":"使用了make vboxtest后生成了hd.vdi，结果从虚拟机拷贝出来后显示<br>FATAL:No bootable medium found! system halted<br>怎么办？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586490,"discussion_content":"没有建立GRUB","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662256390,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"湖北"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354181,"user_name":"Leibro","can_delete":false,"product_type":"c1","uid":1185602,"ip_address":"湖北","ucode":"E0C68345831C50","user_header":"https://static001.geekbang.org/account/avatar/00/12/17/42/71c9f8fd.jpg","comment_is_top":false,"comment_ctime":1660147536,"is_pvip":false,"replies":[{"id":"128895","content":"课程中有写啊","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1660318729,"ip_address":"湖北","comment_id":354181,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1660147536","product_id":100078401,"comment_content":"请问下老师，grub的安装是在哪里完成的呢？在makefile相关的地方没找到grub install相关的命令呢。grub是怎么被安装到mount的img里的呢？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583732,"discussion_content":"课程中有写啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660318730,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"湖北"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353550,"user_name":"彼岸","can_delete":false,"product_type":"c1","uid":2661969,"ip_address":"湖北","ucode":"E1153A340B206C","user_header":"https://static001.geekbang.org/account/avatar/00/28/9e/51/5c138622.jpg","comment_is_top":false,"comment_ctime":1659537492,"is_pvip":false,"replies":[{"id":"128673","content":"这个是VM不支持VBE118 （1024*768*32）的图形模式  换成  vbox<br>","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1659922694,"ip_address":"湖北","comment_id":353550,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1659537492","product_id":100078401,"comment_content":"使用Windows+VMware环境，非套娃模式，运行后出现“INITKLDR DIE ERROR:getvbemode not 118”是什么原因呢？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583098,"discussion_content":"这个是VM不支持VBE118 （1024*768*32）的图形模式  换成  vbox\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659922694,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"湖北"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353270,"user_name":"X","can_delete":false,"product_type":"c1","uid":1581509,"ip_address":"湖北","ucode":"BE05C1D25CE313","user_header":"https://static001.geekbang.org/account/avatar/00/18/21/c5/024e1ef1.jpg","comment_is_top":false,"comment_ctime":1659324596,"is_pvip":false,"replies":[{"id":"128495","content":"要看你的内存大小了 ","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1659433284,"ip_address":"湖北","comment_id":353270,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1659324596","product_id":100078401,"comment_content":"premature end of file &#47;boot&#47;Cosmos.eki<br>Cosmos.eki 这个文件过早的结束，啥子意思啊，我天","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582441,"discussion_content":"要看你的内存大小了 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659433284,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"湖北"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1581509,"avatar":"https://static001.geekbang.org/account/avatar/00/18/21/c5/024e1ef1.jpg","nickname":"X","note":"","ucode":"BE05C1D25CE313","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":582449,"discussion_content":"好的，谢谢老师","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659433657,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":582441,"ip_address":"上海"},"score":582449,"extra":""}]}]},{"had_liked":false,"id":353268,"user_name":"X","can_delete":false,"product_type":"c1","uid":1581509,"ip_address":"湖北","ucode":"BE05C1D25CE313","user_header":"https://static001.geekbang.org/account/avatar/00/18/21/c5/024e1ef1.jpg","comment_is_top":false,"comment_ctime":1659324059,"is_pvip":false,"replies":[{"id":"128494","content":"这是  正常的 继续第13课 就好了 ","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1659433230,"ip_address":"湖北","comment_id":353268,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1659324059","product_id":100078401,"comment_content":"所有东西都准备好了，运行cosmos的时候，如果是32系统则报错如下：<br>initkldr die error:S<br>看留言区有同学说将32位系统转变成64位成功解决，结果还是报错，如下所示：<br>initkldr die error:not find file<br>很奇怪，为什么报没找到文件，cosmos.eki文件是按照老师的步骤编译的，我不知道缺少什么文件……<br>纳闷的一批啊","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582440,"discussion_content":"这是  正常的 继续第13课 就好了 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659433230,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"湖北"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1581509,"avatar":"https://static001.geekbang.org/account/avatar/00/18/21/c5/024e1ef1.jpg","nickname":"X","note":"","ucode":"BE05C1D25CE313","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":582450,"discussion_content":"okk，谢谢老师，我疑惑了好久，哈哈哈，那我继续干13了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659433678,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":582440,"ip_address":"上海"},"score":582450,"extra":""}]}]},{"had_liked":false,"id":352797,"user_name":"X","can_delete":false,"product_type":"c1","uid":1581509,"ip_address":"","ucode":"BE05C1D25CE313","user_header":"https://static001.geekbang.org/account/avatar/00/18/21/c5/024e1ef1.jpg","comment_is_top":false,"comment_ctime":1658932627,"is_pvip":false,"replies":[{"id":"128345","content":"加油～","user_name":"编辑回复","user_name_real":"编辑","uid":"1501385","ctime":1659069534,"ip_address":"","comment_id":352797,"utype":2}],"discussion_count":1,"race_medal":0,"score":"1658932627","product_id":100078401,"comment_content":"哇嗷嗷，有点迷了，明天再仔细看看，冲冲冲~","like_count":0,"discussions":[{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"听水的湖","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":581923,"discussion_content":"加油～","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659069534,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":8}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":349108,"user_name":"小李飞刀","can_delete":false,"product_type":"c1","uid":3027260,"ip_address":"","ucode":"4CDF743FC51D15","user_header":"https://static001.geekbang.org/account/avatar/00/2e/31/3c/d23f3fa5.jpg","comment_is_top":false,"comment_ctime":1655731348,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1655731348","product_id":100078401,"comment_content":"我的操作是，在windows上安装了vbox，然后安装了一台ubuntu的虚拟机。取名为ubuntu。通过为ubuntu添加一块硬盘的方式，避开生成vdi文件。我在ubuntu上新加了一块硬盘，取名hd.vdi。然后在这台ubuntu的机器上，为hd.vdi挂在了一个目录，在其中编写了grub相关的东西，然后新建另一个虚拟机（newOS）使用hd.vdi启动。上一讲没有问题。<br>这一讲，我的本意是在ubuntu机器里面生成一个eki文件，丢到grub目录下。然后，让newOS还是在hd.vdi上启动，天然应该是可以的。<br>遇到的问题是：<br>编译第十二课代码的时候，make vboxtest和make release都遇到这个报错：<br>=========<br>......<br>CC -[M] 正在生成makefile... ..&#47;script&#47;link.S<br>.&#47;lmkfbuild: 1: .&#47;lmkfbuild: cannot create \u0001�@@�\u0017@@\u001f\u001c\u0006@@@@@�\u0001�\u0003\u0004\u0002\u0002@\u0002@\u001c\u001c\u0001\u0001@@�: Invalid argument<br>.&#47;lmkfbuild: 1: .&#47;lmkfbuild: ELF\u0002\u0001\u0001\u0002: not found<br>.&#47;lmkfbuild: 2: .&#47;lmkfbuild: �: not found<br>.&#47;lmkfbuild: 2: .&#47;lmkfbuild: Syntax error: Unterminated quoted string<br>pretreatment.mkf:41: recipe for target &#39;krnlobjs.mk&#39; failed<br>make[2]: *** [krnlobjs.mk] Error 2<br>Makefile.x86:28: recipe for target &#39;all&#39; failed<br>make[1]: *** [all] Error 2<br>Makefile:59: recipe for target &#39;all&#39; failed<br>make: *** [all] Error 2<br><br>看起来是环境没弄好，哪位大神指点一二。<br>","like_count":0,"discussions":[{"author":{"id":3027260,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/31/3c/d23f3fa5.jpg","nickname":"小李飞刀","note":"","ucode":"4CDF743FC51D15","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577180,"discussion_content":"我用的是Ubuntu的16.04版本，这个问题出现的根本原因是，asm的编译时用的32位，c的编译用的是64位，于是各种冲突。编译工具的时候，可以在lmoskrlimg编译的时候，加上-m64的指令，让lmoskrlimg可以正常编译出来。然后在第十二课代码中编译到lmkfbuild生成这一步，又会出错，于是把link.mk中的第三行，改成了i386:x86-64，让lmkfbuild正常生成，但，就是执行不了，提示可执行文件的格式不对。换了一台centos的机器，把ubuntu上编译的lmkfbuild拷贝过去居然就可以执行。。。。，绕了一圈，发现应该是汇编的32的编译，和C代码的64位编译，链接成可执行文件，在ubuntu系统上执行不了。果断在centos的机器上，生成了Comos.eki文件。\n用virtualbox在ubuntu的机器上新创一块hd.vdi硬盘，在ubuntu系统里面创建一个hdisk的目录，将boot下的grub安装好，将Cosmos.eki拷贝到boot目录下。再virtualbox中新建一个NewOS，使用hd.vdi（ubuntu机器要关机），就可以完成本节课的内容了。。。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655956823,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":349102,"user_name":"小李飞刀","can_delete":false,"product_type":"c1","uid":3027260,"ip_address":"","ucode":"4CDF743FC51D15","user_header":"https://static001.geekbang.org/account/avatar/00/2e/31/3c/d23f3fa5.jpg","comment_is_top":false,"comment_ctime":1655728106,"is_pvip":true,"replies":[{"id":"128071","content":"重新clone一下代码","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1658390903,"ip_address":"","comment_id":349102,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1655728106","product_id":100078401,"comment_content":"谁能告诉我，则是为啥~~~（在Ubuntu虚拟机上安装了vbox，在Ubuntu虚拟机上编译）<br>Initldr:清理全部已构建文件... ^_^<br>Cosmos:清理全部已构建文件... ^_^<br>CC -[M] 正在生成makefile... ..&#47;script&#47;krnlobjs.S<br>CC -[M] 正在生成makefile... ..&#47;script&#47;cosmoslink.S<br>CC -[M] 正在生成makefile... ..&#47;script&#47;krnlbuidcmd.S<br>CC -[M] 正在生成makefile... ..&#47;script&#47;krnlbuidrule.S<br>CC -[M] 正在生成makefile... ..&#47;script&#47;hal.S<br>CC -[M] 正在生成makefile... ..&#47;script&#47;krl.S<br>CC -[M] 正在生成makefile... ..&#47;script&#47;drv.S<br>CC -[M] 正在生成makefile... ..&#47;script&#47;lib.S<br>CC -[M] 正在生成makefile... ..&#47;script&#47;task.S<br>CC -[M] 正在生成makefile... ..&#47;script&#47;link.S<br>.&#47;lmkfbuild: 1: .&#47;lmkfbuild: cannot create \u0001�@@�\u0017@@\u001f\u001c\u0006@@@@@�\u0001�\u0003\u0004\u0002\u0002@\u0002@\u001c\u001c\u0001\u0001@@�: Invalid argument<br>.&#47;lmkfbuild: 1: .&#47;lmkfbuild: ELF\u0002\u0001\u0001\u0002: not found<br>.&#47;lmkfbuild: 2: .&#47;lmkfbuild: �: not found<br>.&#47;lmkfbuild: 2: .&#47;lmkfbuild: Syntax error: Unterminated quoted string<br>pretreatment.mkf:41: recipe for target &#39;krnlobjs.mk&#39; failed<br>make[2]: *** [krnlobjs.mk] Error 2<br>Makefile.x86:28: recipe for target &#39;all&#39; failed<br>make[1]: *** [all] Error 2<br>Makefile:59: recipe for target &#39;all&#39; failed<br>make: *** [all] Error 2","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580866,"discussion_content":"重新clone一下代码","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658390903,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":348996,"user_name":"│．Sk","can_delete":false,"product_type":"c1","uid":2453415,"ip_address":"","ucode":"A2EEB2E9585A77","user_header":"https://static001.geekbang.org/account/avatar/00/25/6f/a7/565214bc.jpg","comment_is_top":false,"comment_ctime":1655631110,"is_pvip":false,"replies":[{"id":"128072","content":"jmp 不更新cs","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1658390936,"ip_address":"","comment_id":348996,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1655631110","product_id":100078401,"comment_content":"请问老师为什么要要用 “dw 0xcb48” 属性 cs:rip，而不是直接使用 jmp 指令","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580867,"discussion_content":"jmp 不更新cs","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658390936,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":347255,"user_name":"花树","can_delete":false,"product_type":"c1","uid":1542107,"ip_address":"","ucode":"810A5B42EEE264","user_header":"https://static001.geekbang.org/account/avatar/00/17/87/db/c132ef37.jpg","comment_is_top":false,"comment_ctime":1653877677,"is_pvip":false,"replies":[{"id":"126879","content":"是的 BIOS会提供一个E820表","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1654911928,"ip_address":"","comment_id":347255,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1653877677","product_id":100078401,"comment_content":"老师，我们自己写的这个操作系统如何感知内存的？就调用BIOS中断就自动获取了，没我们什么事了吗？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575518,"discussion_content":"是的 BIOS会提供一个E820表","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654911928,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":346663,"user_name":"Qfeng","can_delete":false,"product_type":"c1","uid":1466121,"ip_address":"","ucode":"1248E70012BBA2","user_header":"https://static001.geekbang.org/account/avatar/00/16/5f/09/2ec44412.jpg","comment_is_top":false,"comment_ctime":1653329190,"is_pvip":false,"replies":[{"id":"126497","content":"可以任意选","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1653617657,"ip_address":"","comment_id":346663,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1653329190","product_id":100078401,"comment_content":"为什么内核虚拟地址空间从 0xffff800000000000 开始？任意选的吗？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573708,"discussion_content":"可以任意选","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653617657,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":346662,"user_name":"Qfeng","can_delete":false,"product_type":"c1","uid":1466121,"ip_address":"","ucode":"1248E70012BBA2","user_header":"https://static001.geekbang.org/account/avatar/00/16/5f/09/2ec44412.jpg","comment_is_top":false,"comment_ctime":1653327627,"is_pvip":false,"replies":[{"id":"126498","content":"是的 是的 ","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1653617714,"ip_address":"","comment_id":346662,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1653327627","product_id":100078401,"comment_content":"这节课信息量太大了，又建立在前面硬件课程的基础之上，翻来覆去又复习了几遍，总算摸个大概了。<br>目前关注点放在内存管理这块，梳理了一下本节的内存布局，根据函数init_bstartpages的实现结合第6课程序地址转换，画了一份创建之后的MMU页表和物理地址关系图。<br><br>整个MMU页表：<br>起始地址：0x100 0000<br>顶级目录页：0x100 0000 ~ 0x100 FFFF，这里只有第0个64位存放了有效数据，其页目录指针页的地址，剩余511个64位没用上。<br>页目录指针页：0x100 1000 ~ 0x100 1FFF，这里只有第0~15个64位存放了有效数据，每个64位中保存了一个页目录指针，通过他可以找到下一级的页目录地址；剩余的496个64位数据没用上。<br>页目录页：0x100 2000 ~ (0x100 2000 + 0x1000*16 - 1)，共16页，每页里面512项，每项保存着2MB物理内存的地址。<br><br>其他的暂不去深究了，后面回过头来再仔细看。<br><br>-----------------------------<br>思考题：init_meme820 这个函数的功能是，将内存信息从地址 0x2068 处拷贝到了内核映像文件 0x200 0000 和字体文件之后。至于为什么要这么拷贝还不清楚。<br><br>","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573709,"discussion_content":"是的 是的 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653617714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345451,"user_name":"～～","can_delete":false,"product_type":"c1","uid":1463768,"ip_address":"","ucode":"52797D415A538D","user_header":"https://static001.geekbang.org/account/avatar/00/16/55/d8/610fae56.jpg","comment_is_top":false,"comment_ctime":1652276508,"is_pvip":false,"replies":[{"id":"126514","content":"你试一下 就知道了","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1653618393,"ip_address":"","comment_id":345451,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1652276508","product_id":100078401,"comment_content":"还是没明白这里为什么要用“dw 0xcb48”这种方式，直接使用jmp指令不可以吗。","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573725,"discussion_content":"你试一下 就知道了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653618394,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345339,"user_name":"～～","can_delete":false,"product_type":"c1","uid":1463768,"ip_address":"","ucode":"52797D415A538D","user_header":"https://static001.geekbang.org/account/avatar/00/16/55/d8/610fae56.jpg","comment_is_top":false,"comment_ctime":1652197039,"is_pvip":false,"replies":[{"id":"126521","content":"嗯嗯","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1653618711,"ip_address":"","comment_id":345339,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1652197039","product_id":100078401,"comment_content":"“0xcb48”的“48（01001000）”应该是REX前缀中的W位，代表使用64bit operand size，因为ret（far）默认operand是32bit的<br>之后从栈中连续弹出两个8字节分别到RIP和CS","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573732,"discussion_content":"嗯嗯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653618711,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345333,"user_name":"～～","can_delete":false,"product_type":"c1","uid":1463768,"ip_address":"","ucode":"52797D415A538D","user_header":"https://static001.geekbang.org/account/avatar/00/16/55/d8/610fae56.jpg","comment_is_top":false,"comment_ctime":1652195225,"is_pvip":false,"replies":[{"id":"126520","content":"64位","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1653618696,"ip_address":"","comment_id":345333,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1652195225","product_id":100078401,"comment_content":"“cb”应该是ret指令的opcode，是far return，但是48如何理解呢？cb应该没有operand的","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573731,"discussion_content":"64位","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653618697,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345328,"user_name":"～～","can_delete":false,"product_type":"c1","uid":1463768,"ip_address":"","ucode":"52797D415A538D","user_header":"https://static001.geekbang.org/account/avatar/00/16/55/d8/610fae56.jpg","comment_is_top":false,"comment_ctime":1652193886,"is_pvip":false,"replies":[{"id":"126519","content":"有啊 intel文档","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1653618685,"ip_address":"","comment_id":345328,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1652193886","product_id":100078401,"comment_content":"“dw 0xcb48 是直接写一条指令的机器码——0xcb48”<br>这个0xcb48为什么是返回的指令码，有没有原始资料呢？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573730,"discussion_content":"有啊 intel文档","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653618685,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345326,"user_name":"～～","can_delete":false,"product_type":"c1","uid":1463768,"ip_address":"","ucode":"52797D415A538D","user_header":"https://static001.geekbang.org/account/avatar/00/16/55/d8/610fae56.jpg","comment_is_top":false,"comment_ctime":1652193747,"is_pvip":false,"replies":[{"id":"126518","content":"不是 ","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1653618627,"ip_address":"","comment_id":345326,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1652193747","product_id":100078401,"comment_content":"#define IKSTACK_PHYADR (0x90000-0x10)<br>IKSTACK_PHYADR的定义是0x90000-0x10，这里的0x10是不是hal_start返回的ret指令，要把栈指针增加16个字节，所以预留的？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573729,"discussion_content":"不是 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653618627,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345314,"user_name":"～～","can_delete":false,"product_type":"c1","uid":1463768,"ip_address":"","ucode":"52797D415A538D","user_header":"https://static001.geekbang.org/account/avatar/00/16/55/d8/610fae56.jpg","comment_is_top":false,"comment_ctime":1652189633,"is_pvip":false,"replies":[{"id":"126517","content":"你把它删除试一下 就知道了","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1653618604,"ip_address":"","comment_id":345314,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1652189633","product_id":100078401,"comment_content":"调用hal_start的时候有一个地方没弄明白，push0x8是对应代码段地址，放到CS，hal_start是函数地址，放到RIP，那push0x8之前的push 0有什么作用呢？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573728,"discussion_content":"你把它删除试一下 就知道了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653618605,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":340941,"user_name":"no-one","can_delete":false,"product_type":"c1","uid":1476425,"ip_address":"","ucode":"43D4C5450AAC83","user_header":"https://static001.geekbang.org/account/avatar/00/16/87/49/1796143f.jpg","comment_is_top":false,"comment_ctime":1649236872,"is_pvip":false,"replies":[{"id":"125083","content":"virtualbox 什么版本","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1650249978,"ip_address":"","comment_id":340941,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1649236872","product_id":100078401,"comment_content":"00:00:09.034403 VGA Graphics Controller (3CF): GR index 3CE:05<br>00:00:09.034403  GR00:00 GR01:00 GR02:00 GR03:00 GR04:00 GR05:10 GR06:0E GR07:0F GR08:FF<br>00:00:09.034406 !!<br>00:00:09.034407 !! {vgapl}<br>00:00:09.034407 !!<br>00:00:09.034407 read mode     : 0     write mode: 0<br>00:00:09.034408 set&#47;reset data: 00    S&#47;R enable: 00<br>00:00:09.034408 color compare : 00    read map  : 0<br>00:00:09.034409 rotate        : 0     function  : 0<br>00:00:09.034410 don&#39;t care    : 0F    bit mask  : FF<br>00:00:09.034410 seq plane mask: 03    chain-4   : off<br>00:00:09.034411 !!<br>00:00:09.034411 !! {vgasr}<br>00:00:09.034411 !!<br>00:00:09.034411 VGA Sequencer (3C5): SR index 3C4:03<br>00:00:09.034412  SR00:03 SR01:00 SR02:03 SR03:00 SR04:02 SR05:00 SR06:00 SR07:00<br>00:00:09.034414 !!<br>00:00:09.034415 !! {vgatext}<br>00:00:09.034415 !!<br>00:00:09.034416 ------------------------------------ 80x25 -----------------------------------<br>00:00:09.034617 !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<br>00:00:09.170939 GUI: Machine-window #0 deactivated<br>00:00:09.170973 GUI: Releasing mouse on focus out<br>00:00:09.175088 GUI: Releasing keyboard on focus out<br>00:00:09.175472 GUI: Machine-view #0 unfocused, reason=3<br>00:00:11.939217 GUI: Machine-window #0 activated<br>00:00:11.939267 GUI: Machine-view #0 focused, reason=3<br>00:00:11.940301 GUI: User request to power VM off on Guru Meditation.<br>00:00:11.940320 GUI: Passing request to power VM off from machine-logic to UI session.<br>00:00:11.940327 GUI: Powering VM down on UI session power off request...<br>00:00:11.940549 Console: Machine state changed to &#39;Stopping&#39;<br>00:00:11.941136 Console::powerDown(): A request to power off the VM has been issued (mMachineState=Stopping, InUninit=0)<br>00:00:11.941352 Changing the VM state from &#39;GURU_MEDITATION&#39; to &#39;POWERING_OFF&#39;<br><br><br>win11, virtualbox 使用的grub2，虚拟机启动后，选择cosmOS之后，操作系统启动后就提示崩溃了，有大佬遇到相同的问题了吗，日志比较长没有明显的报错信息","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":564460,"discussion_content":"virtualbox 什么版本","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650249978,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":340646,"user_name":"蚂蚁网络科技","can_delete":false,"product_type":"c1","uid":2780763,"ip_address":"","ucode":"79FBD8AB9D738C","user_header":"https://static001.geekbang.org/account/avatar/00/2a/6e/5b/12a10165.jpg","comment_is_top":false,"comment_ctime":1648990083,"is_pvip":false,"replies":[{"id":"124636","content":"第二季","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1649228465,"ip_address":"","comment_id":340646,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1648990083","product_id":100078401,"comment_content":"C 语言功底差了，到现在看不懂了","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560200,"discussion_content":"第二季","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649228466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":339794,"user_name":"happy","can_delete":false,"product_type":"c1","uid":2225487,"ip_address":"","ucode":"356ECB08C79998","user_header":"https://static001.geekbang.org/account/avatar/00/21/f5/4f/4deaab37.jpg","comment_is_top":false,"comment_ctime":1648388661,"is_pvip":false,"replies":[{"id":"124370","content":"6666","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1648606079,"ip_address":"","comment_id":339794,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1648388661","product_id":100078401,"comment_content":"太棒了 跑起来了 ","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559088,"discussion_content":"6666","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648606079,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332987,"user_name":"李圣悦","can_delete":false,"product_type":"c1","uid":1638427,"ip_address":"","ucode":"C1786C98824E50","user_header":"https://static001.geekbang.org/account/avatar/00/19/00/1b/eee13196.jpg","comment_is_top":false,"comment_ctime":1643942278,"is_pvip":false,"replies":[{"id":"121785","content":"加油","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1644285064,"ip_address":"","comment_id":332987,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1643942278","product_id":100078401,"comment_content":"在mac上建一个虚拟机，将得到的hd.img放到mac上执行如下脚本<br>VBoxManage convertfromraw .&#47;hd.img --format VDI .&#47;hd.vdi<br>VBoxManage storagectl HelloOS --name &quot;SATA&quot; --remove<br>VBoxManage storagectl HelloOS --name &quot;SATA&quot; --add sata --controller IntelAhci --portcount 1<br>VBoxManage closemedium disk .&#47;hd.vdi<br>VBoxManage storageattach HelloOS --storagectl &quot;SATA&quot; --port 1 --device 0 --type hdd --medium .&#47;hd.vdi<br><br>成功得到Cosmos页面","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549868,"discussion_content":"加油","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644285064,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":329007,"user_name":"ketchum","can_delete":false,"product_type":"c1","uid":2773755,"ip_address":"","ucode":"A966234585944B","user_header":"https://static001.geekbang.org/account/avatar/00/2a/52/fb/1f7df3db.jpg","comment_is_top":false,"comment_ctime":1641016491,"is_pvip":false,"replies":[{"id":"120032","content":"安装 了 vbox了吗 虚拟机套娃很麻烦的","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1641434746,"ip_address":"","comment_id":329007,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1641016491","product_id":100078401,"comment_content":"正在生成Cosmos内核映像文件，请稍后……<br>文件数：6<br>映像文件大小：4911104<br>[sudo] ketchum 的密码： <br>umount: &#47;home&#47;ketchum&#47;Dyfproject&#47;cosmos&#47;lesson12&#47;Cosmos&#47;hdisk: target is busy.<br>make[1]: *** [vbox.mkf:28：moutraw] 错误 32<br>make: *** [Makefile:101：VBOXRUN] 错误 2<br><br>我的主机是windows，用virtualbox装的unbuntu20.04. 在unbuntu里运行make vboxtest是遇到如上错误，请问有前辈指点一下为什么吗？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544170,"discussion_content":"安装 了 vbox了吗 虚拟机套娃很麻烦的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641434746,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":327737,"user_name":"哈哈哈","can_delete":false,"product_type":"c1","uid":1629779,"ip_address":"","ucode":"EE52B638F6782A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/4dQeR41wibHBHZesPCqVOGqlyTxqGdlevERYSmbSR4dPQo7ILjrmedpLPwZL7ZCI0aicq1Wgwth7ia776bV9QPfOg/132","comment_is_top":false,"comment_ctime":1640259255,"is_pvip":false,"replies":[{"id":"119367","content":"检查虚拟机配置","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1640329277,"ip_address":"","comment_id":327737,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1640259255","product_id":100078401,"comment_content":"正在生成Cosmos内核映像文件，请稍后……<br>文件数：6<br>映像文件大小：4911104<br>Converting from raw image file=&quot;..&#47;hd.img&quot; to file=&quot;..&#47;exckrnl&#47;hd.vdi&quot;...<br>Creating dynamic image with size 104857600 bytes (100MB)...<br>Waiting for VM &quot;Cosmos&quot; to power on...<br>VM &quot;Cosmos&quot; has been successfully started.<br><br><br>请问这代码没有报错为啥显示不出来图片<br>","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541313,"discussion_content":"检查虚拟机配置","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640329277,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324891,"user_name":"kocgockohgoh王裒","can_delete":false,"product_type":"c1","uid":2617112,"ip_address":"","ucode":"35EFABDE0D713D","user_header":"https://static001.geekbang.org/account/avatar/00/27/ef/18/6a620733.jpg","comment_is_top":false,"comment_ctime":1638705449,"is_pvip":false,"replies":[{"id":"117874","content":"64位下 一次压入8个字节","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1638753262,"ip_address":"","comment_id":324891,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1638705449","product_id":100078401,"comment_content":"最关键的是 63～66 行，它开始把 8 和 hal_start 函数的地址压入栈中  push 0  push 0x8   这个是64位的代码段  到底入栈了几个字节啊  段描述符不是16位么","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536282,"discussion_content":"64位下 一次压入8个字节","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638753262,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1463768,"avatar":"https://static001.geekbang.org/account/avatar/00/16/55/d8/610fae56.jpg","nickname":"～～","note":"","ucode":"52797D415A538D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571382,"discussion_content":"pop的时候高48位会被丢弃","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652190103,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324098,"user_name":"Neo Nengrong Qu","can_delete":false,"product_type":"c1","uid":2409916,"ip_address":"","ucode":"A8EB484EA1C06C","user_header":"https://static001.geekbang.org/account/avatar/00/24/c5/bc/ec3b0586.jpg","comment_is_top":false,"comment_ctime":1638288567,"is_pvip":false,"replies":[{"id":"117617","content":"哈哈 加油","user_name":"作者回复","user_name_real":"编辑","uid":"1345199","ctime":1638322817,"ip_address":"","comment_id":324098,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1638288567","product_id":100078401,"comment_content":"记录一下， 运行时报错：<br>Converting from raw image file=&quot;..&#47;hd.img&quot; to file=&quot;..&#47;exckrnl&#47;hd.vdi&quot;...<br>Creating dynamic image with size 104857600 bytes (100MB)...<br>VBoxManage: error: Could not find a registered machine named &#39;Cosmos&#39;<br>VBoxManage: error: Details: code VBOX_E_OBJECT_NOT_FOUND (0x80bb0001), component VirtualBoxWrap, interface IVirtualBox, callee nsISupports<br>VBoxManage: error: Context: &quot;FindMachine(Bstr(a-&gt;argv[0]).raw(), machine.asOutParam())&quot; at line 1044 of file VBoxManageStorageController.cpp<br>make[1]: *** [vbox.mkf:13: idectrnul] Error 1<br>make: *** [Makefile:101: VBOXRUN] Error 2<br><br>原来是我只有一个Hellos的虚拟机， 没有Cosmos的， 新创建一个64位的Linux虚拟机，再次执行测试， 就跑出了文中的图形界面， happy。","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534940,"discussion_content":"哈哈 加油","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638322817,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":321667,"user_name":"Geek_ee69a8","can_delete":false,"product_type":"c1","uid":2827869,"ip_address":"","ucode":"381523B1A9C0D7","user_header":"","comment_is_top":false,"comment_ctime":1636985483,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636985483","product_id":100078401,"comment_content":"There are many additional files in the code base which is not mentioned in this section. Like why do we need Cosmos.bin file and how to create it.","like_count":0},{"had_liked":false,"id":321279,"user_name":"不写出操作系统不改名","can_delete":false,"product_type":"c1","uid":2834444,"ip_address":"","ucode":"DD40D98250B688","user_header":"https://static001.geekbang.org/account/avatar/00/2b/40/0c/19b4224a.jpg","comment_is_top":false,"comment_ctime":1636734483,"is_pvip":false,"replies":[{"id":"116767","content":"是的 ","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1636940829,"ip_address":"","comment_id":321279,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1636734483","product_id":100078401,"comment_content":"在给MMU建立页表的时候，为什么映射的空间是16G呢？前面在创建虚拟机的时候给它配置的内存是1G的。这样的话在init_bstartpages()里面创建的页表项在超过1G的地址后是不存在实际物理空间的。是因为16G是按照2M一个页来划分时，可以建立页表的最小单位吗?","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530258,"discussion_content":"是的 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636940829,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":320772,"user_name":"小牧童","can_delete":false,"product_type":"c1","uid":2128971,"ip_address":"","ucode":"C8C70F7C341CAA","user_header":"","comment_is_top":false,"comment_ctime":1636508976,"is_pvip":false,"replies":[{"id":"116447","content":"0x8f000～0x90001 是另一个函数需要的","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1636597834,"ip_address":"","comment_id":320772,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1636508976","product_id":100078401,"comment_content":"感谢东哥解答，这个安全大概理解……只是不明白这里栈定为何不是0x90000呢，按照文章中说明，内核栈的地址空间是从0x8f000～0x90001，代码中的栈顶却是0x90000往下偏移16个字节，是我理解错了吗，望东哥解惑","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530106,"discussion_content":"0x8f000～0x90001 是另一个函数需要的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636597834,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1454709,"avatar":"https://static001.geekbang.org/account/avatar/00/16/32/75/37f1a9b8.jpg","nickname":"UJoy","note":"","ucode":"4275E5D927B439","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579150,"discussion_content":"另一函数是指 ？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657198106,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":320713,"user_name":"小牧童","can_delete":false,"product_type":"c1","uid":2128971,"ip_address":"","ucode":"C8C70F7C341CAA","user_header":"","comment_is_top":false,"comment_ctime":1636466423,"is_pvip":false,"replies":[{"id":"116315","content":"为了安全 栈寄存器是先写入再递减的","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1636506023,"ip_address":"","comment_id":320713,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1636466423","product_id":100078401,"comment_content":"这里IKSTACK_PHYADR为什么不是 0x8f000+0x1000呢，没看懂<br><br><br>#define IKSTACK_PHYADR (0x90000-0x10)<br>#define IKSTACK_SIZE 0x1000<br>&#47;&#47;初始化内核栈<br>void init_krlinitstack(machbstart_t *mbsp)<br>{<br>    if (1 &gt; move_krlimg(mbsp, (u64_t)(0x8f000), 0x1001))<br>    {<br>        kerror(&quot;iks_moveimg err&quot;);<br>    }<br>    mbsp-&gt;mb_krlinitstack = IKSTACK_PHYADR;&#47;&#47;栈顶地址<br>    mbsp-&gt;mb_krlitstacksz = IKSTACK_SIZE; &#47;&#47;栈大小是4KB<br>    return;<br>}","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530092,"discussion_content":"为了安全 栈寄存器是先写入再递减的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636506023,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":319897,"user_name":"张凡","can_delete":false,"product_type":"c1","uid":2760722,"ip_address":"","ucode":"962AAE775FB56A","user_header":"https://static001.geekbang.org/account/avatar/00/2a/20/12/f899cc04.jpg","comment_is_top":false,"comment_ctime":1636003468,"is_pvip":false,"replies":[{"id":"116088","content":"不会的","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1636140076,"ip_address":"","comment_id":319897,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1636003468","product_id":100078401,"comment_content":"提个入门级的小白问题，mmu 页表本身存在物理地址16M开始的地方， 内核虚拟地址0xffff800000000000～0xffff800400000000 ，也会被映射到物理地址空间 0～0x400000000 。 这样物理地址16M开始的这块，会有冲突么？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529806,"discussion_content":"不会的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636140076,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":318763,"user_name":"大汗","can_delete":false,"product_type":"c1","uid":1596108,"ip_address":"","ucode":"CCC14FCB03D5A3","user_header":"https://static001.geekbang.org/account/avatar/00/18/5a/cc/ea936dbe.jpg","comment_is_top":false,"comment_ctime":1635417624,"is_pvip":false,"replies":[{"id":"115583","content":"是的","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1635432274,"ip_address":"","comment_id":318763,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1635417624","product_id":100078401,"comment_content":"二级引导器和操作系统是grub装在到内存的是吗？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529373,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635432274,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":318643,"user_name":"日就月将","can_delete":false,"product_type":"c1","uid":2651148,"ip_address":"","ucode":"0F9BA55A2898FF","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/cabLXAUXiavXnEckAgo971o4l1CxP4L9wOV2eUGTyKBUicTib6gJyKV9iatM4GG1scz5Ym17GOzXWQEGzhE31tXUtQ/132","comment_is_top":false,"comment_ctime":1635382038,"is_pvip":false,"replies":[{"id":"115509","content":"没有内核文件","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1635383114,"ip_address":"","comment_id":318643,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1635382038","product_id":100078401,"comment_content":"老师 把.eki映像文件放到&#47;boot目录下后出现INITKLDR DIE ERROR：not find file可能是什么情况","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529326,"discussion_content":"没有内核文件","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635383114,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2617322,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ef/ea/ab7612da.jpg","nickname":"浮生尽歇","note":"","ucode":"3BA0FFF71E515C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":414524,"discussion_content":"我也遇到了 请问您解决 了吗 ？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636802966,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":315237,"user_name":"朱炜敏","can_delete":false,"product_type":"c1","uid":2753464,"ip_address":"","ucode":"1CD07468FA1D4B","user_header":"https://static001.geekbang.org/account/avatar/00/2a/03/b8/72294f1e.jpg","comment_is_top":false,"comment_ctime":1633762937,"is_pvip":false,"replies":[{"id":"114252","content":"开启EPT特性时 没有区别","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1633937783,"ip_address":"","comment_id":315237,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1633762937","product_id":100078401,"comment_content":"老师好，请教一个问题：当前在虚拟机环境下，CPU相当于时Host OS分配给咱们来用。那MMU也是如此么？ Host OS 使用MMU（物理内存）与咱们Gust OS使用的MMU有什么区别么？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527911,"discussion_content":"开启EPT特性时 没有区别","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633937783,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314861,"user_name":"李幸文","can_delete":false,"product_type":"c1","uid":2369656,"ip_address":"","ucode":"B12AC38A38DD61","user_header":"https://static001.geekbang.org/account/avatar/00/24/28/78/8dc30162.jpg","comment_is_top":false,"comment_ctime":1633509519,"is_pvip":false,"replies":[{"id":"114259","content":"没有","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1633937877,"ip_address":"","comment_id":314861,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1633509519","product_id":100078401,"comment_content":"为什么那些地址是那样安排的，这是什么约定吗<br>","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527815,"discussion_content":"没有","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633937877,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":313012,"user_name":"图吐兔","can_delete":false,"product_type":"c1","uid":1167662,"ip_address":"","ucode":"2395E9506CBE0E","user_header":"https://static001.geekbang.org/account/avatar/00/11/d1/2e/d531b29b.jpg","comment_is_top":false,"comment_ctime":1632200650,"is_pvip":false,"replies":[{"id":"113383","content":"是的","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1632215256,"ip_address":"","comment_id":313012,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1632200650","product_id":100078401,"comment_content":"INITKLDR DIE ERROR:not find file 出现这个错误的朋友，先检查cosmos&#47;lesson12&#47;Cosmos&#47;Makefile中LKIMG_INFILE中是否已包含$(KRNLEXCIMG)，目前gitee最新版本已包含。那么我们需要的Cosmos.eki是在cosmos&#47;lesson12&#47;Cosmos&#47;release下，而不是cosmos&#47;lesson12&#47;Cosmos&#47;initldr&#47;build下，接下来将cosmos&#47;lesson12&#47;Cosmos&#47;release&#47;Cosmos.eki拷贝到虚拟盘的&#47;boot下即可","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527197,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632215256,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2616644,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ed/44/4399a41a.jpg","nickname":"墨","note":"","ucode":"8198903D2029D2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":408845,"discussion_content":"这个目录下没有.eki文件啊，编译后也没有","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635332375,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2617322,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ef/ea/ab7612da.jpg","nickname":"浮生尽歇","note":"","ucode":"3BA0FFF71E515C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2616644,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ed/44/4399a41a.jpg","nickname":"墨","note":"","ucode":"8198903D2029D2","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":414563,"discussion_content":"我用编译后的  还是报这个错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636813971,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":408845,"ip_address":""},"score":414563,"extra":""}]}]},{"had_liked":false,"id":311821,"user_name":"Shawn Duan","can_delete":false,"product_type":"c1","uid":1927222,"ip_address":"","ucode":"628BAD6473FBCE","user_header":"https://static001.geekbang.org/account/avatar/00/1d/68/36/478194f3.jpg","comment_is_top":false,"comment_ctime":1631493969,"is_pvip":false,"replies":[{"id":"113156","content":" init  borad  start  parameter","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1631753370,"ip_address":"","comment_id":311821,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1631493969","product_id":100078401,"comment_content":"我理解init_bsartparm 的意思是 init  borad  satrt  parameter.","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526757,"discussion_content":" init  borad  start  parameter","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631753370,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":311817,"user_name":"Shawn Duan","can_delete":false,"product_type":"c1","uid":1927222,"ip_address":"","ucode":"628BAD6473FBCE","user_header":"https://static001.geekbang.org/account/avatar/00/1d/68/36/478194f3.jpg","comment_is_top":false,"comment_ctime":1631491755,"is_pvip":false,"replies":[{"id":"113157","content":"32位不行，Cosmos是纯64位的内核","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1631753397,"ip_address":"","comment_id":311817,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1631491755","product_id":100078401,"comment_content":"为啥需要CPU是64位， 32位不行吗？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526754,"discussion_content":"32位不行，Cosmos是纯64位的内核","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631753397,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":309982,"user_name":"Mandone","can_delete":false,"product_type":"c1","uid":1116017,"ip_address":"","ucode":"FE236389CEF200","user_header":"https://static001.geekbang.org/account/avatar/00/11/07/71/d3049207.jpg","comment_is_top":false,"comment_ctime":1630423923,"is_pvip":true,"replies":[{"id":"112438","content":"哈哈 欢迎回归","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1630632115,"ip_address":"","comment_id":309982,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1630423923","product_id":100078401,"comment_content":"只能看懂大概流程，但是代码细节完全看不太懂，是要再回去补基础还是继续跟着专栏学习呢","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526085,"discussion_content":"哈哈 欢迎回归","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630632115,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":309192,"user_name":"Forest🌲","can_delete":false,"product_type":"c1","uid":2444525,"ip_address":"","ucode":"78C25A0C17D7CC","user_header":"https://static001.geekbang.org/account/avatar/00/25/4c/ed/6f7208b5.jpg","comment_is_top":false,"comment_ctime":1629980034,"is_pvip":false,"replies":[{"id":"112127","content":"看看 grub.cfg","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1630286854,"ip_address":"","comment_id":309192,"utype":1}],"discussion_count":5,"race_medal":0,"score":"1629980034","product_id":100078401,"comment_content":"老师，我反复试了几次，虚拟机仍然报相同的错，似乎是生成的Cosmos.eki镜像存在未知问题，我尝试把Cosmos.eki替换为之前的HelloOS.bin可以正常引导，以上我反复试了很多次，确认替换掉Cosmos.eki可以正常引导。请问老师有可能是什么原因呢？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525777,"discussion_content":"看看 grub.cfg","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630286854,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2453415,"avatar":"https://static001.geekbang.org/account/avatar/00/25/6f/a7/565214bc.jpg","nickname":"│．Sk","note":"","ucode":"A2EEB2E9585A77","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572407,"discussion_content":"请问老哥最后是怎么解决的呀？ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652773618,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2444525,"avatar":"https://static001.geekbang.org/account/avatar/00/25/4c/ed/6f7208b5.jpg","nickname":"Forest🌲","note":"","ucode":"78C25A0C17D7CC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391223,"discussion_content":"应该是虚拟机有问题，后来从官网手动下载安装后的虚拟机可以正常显示Cosmos logo.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630336396,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1102422,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d2/56/62423b4c.jpg","nickname":"sharp","note":"","ucode":"7215CE28FFCBEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2444525,"avatar":"https://static001.geekbang.org/account/avatar/00/25/4c/ed/6f7208b5.jpg","nickname":"Forest🌲","note":"","ucode":"78C25A0C17D7CC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":407705,"discussion_content":"遇到相同问题，是官网下载最新virtualbox就可以？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635087148,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":391223,"ip_address":""},"score":407705,"extra":""},{"author":{"id":1102422,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d2/56/62423b4c.jpg","nickname":"sharp","note":"","ucode":"7215CE28FFCBEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2444525,"avatar":"https://static001.geekbang.org/account/avatar/00/25/4c/ed/6f7208b5.jpg","nickname":"Forest🌲","note":"","ucode":"78C25A0C17D7CC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":407713,"discussion_content":"确实是virtualbox问题，相同Cosmos.eki，使用Virtualbox有问题，而物理机可以正常展示logo","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635087982,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":391223,"ip_address":""},"score":407713,"extra":""}]}]},{"had_liked":false,"id":309064,"user_name":"Forest🌲","can_delete":false,"product_type":"c1","uid":2444525,"ip_address":"","ucode":"78C25A0C17D7CC","user_header":"https://static001.geekbang.org/account/avatar/00/25/4c/ed/6f7208b5.jpg","comment_is_top":false,"comment_ctime":1629910947,"is_pvip":false,"replies":[{"id":"111870","content":"是不是 虚拟机硬盘 相关的问题","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1629939710,"ip_address":"","comment_id":309064,"utype":1}],"discussion_count":4,"race_medal":0,"score":"1629910947","product_id":100078401,"comment_content":"老师，运行都挺正常，但最后虚拟机报错，错误信息如下：<br><br>运行虚拟电脑时发生严重错误, 应将其关闭.<br>要获取帮助, 请查看社区内容 http:&#47;&#47;www.virtualbox.org 或咨询你的支持部门. 请提供日志文件 VBox.log和图像文件 VBox.png, 位于 &#47;home&#47;xiang&#47;VirtualBox VMs&#47;Cosmos&#47;Logs 文件夹中, 并描述出错时的操作. 注意: 也可从管理器的主菜单 控制 中选择 日志.<br>点击 确定 关闭虚拟电脑.如果你想调试它. 请注意调试需要专业的知识和工具, 因此建议你按 确定 .<br><br>我的系统是ubuntu 20.04 LTS, virtrualbox 是6.1版本。不知道为什么会这样。","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525730,"discussion_content":"是不是 虚拟机硬盘 相关的问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629939710,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1102422,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d2/56/62423b4c.jpg","nickname":"sharp","note":"","ucode":"7215CE28FFCBEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":407704,"discussion_content":"遇到相同问题，不知道如何定位","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635087030,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2775595,"avatar":"","nickname":"Geek_18f022","note":"","ucode":"F1C784E9A39F01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":396657,"discussion_content":"同样问题 是否解决了兄弟","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632471297,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2444525,"avatar":"https://static001.geekbang.org/account/avatar/00/25/4c/ed/6f7208b5.jpg","nickname":"Forest🌲","note":"","ucode":"78C25A0C17D7CC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390700,"discussion_content":"似乎是生成的Cosmos.eki镜像存在未知问题，我尝试把Cosmos.eki替换为之前的HelloOS.bin可以正常引导。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629979588,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":309026,"user_name":"🐶","can_delete":false,"product_type":"c1","uid":2249619,"ip_address":"","ucode":"A91651C2C965DC","user_header":"https://static001.geekbang.org/account/avatar/00/22/53/93/c4af6b52.jpg","comment_is_top":false,"comment_ctime":1629898542,"is_pvip":false,"replies":[{"id":"111872","content":"你可以需要补C和汇编或者计算机组件","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1629939814,"ip_address":"","comment_id":309026,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1629898542","product_id":100078401,"comment_content":"🥲感觉有点跟不上咋办 是不是要补点c和操作系统的基础","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525720,"discussion_content":"你可以需要补C和汇编或者计算机组件","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629939814,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":308368,"user_name":"沈畅","can_delete":false,"product_type":"c1","uid":1077953,"ip_address":"","ucode":"7404E41356B36B","user_header":"https://static001.geekbang.org/account/avatar/00/10/72/c1/59509397.jpg","comment_is_top":false,"comment_ctime":1629557475,"is_pvip":true,"replies":[{"id":"111664","content":"当然 是编译代码生成的啊 ","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1629604398,"ip_address":"","comment_id":308368,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1629557475","product_id":100078401,"comment_content":"kernel.bin 这个文件怎么来的？代码里面没找到啊<br>另外上一节课通过mlosrddsc_t结构定位镜像中的文件，这节课通过machbstart_t结构定位内核文件和字库，位图，machbstart_t里面的文件位置信息从哪来的呢？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525473,"discussion_content":"当然 是编译代码生成的啊 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629604398,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1077953,"avatar":"https://static001.geekbang.org/account/avatar/00/10/72/c1/59509397.jpg","nickname":"沈畅","note":"","ucode":"7404E41356B36B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390323,"discussion_content":"代码里面好像是 Cosmos.bin\n u64_t sz = r_file_to_padr(mbsp, IMGKRNL_PHYADR, &#34;Cosmos.bin&#34;);","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629777092,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1050412,"avatar":"https://static001.geekbang.org/account/avatar/00/10/07/2c/180075e0.jpg","nickname":"小豪","note":"","ucode":"70C75B9E5BD19E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1077953,"avatar":"https://static001.geekbang.org/account/avatar/00/10/72/c1/59509397.jpg","nickname":"沈畅","note":"","ucode":"7404E41356B36B","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":571412,"discussion_content":"确实是跟课程源码有出入","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652195964,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":390323,"ip_address":""},"score":571412,"extra":""}]}]},{"had_liked":false,"id":307822,"user_name":"sakura","can_delete":false,"product_type":"c1","uid":1449550,"ip_address":"","ucode":"D382C3325F2F59","user_header":"https://static001.geekbang.org/account/avatar/00/16/1e/4e/56a0b904.jpg","comment_is_top":false,"comment_ctime":1629272548,"is_pvip":false,"replies":[{"id":"111498","content":"这是什么 环境 呢 ","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1629337704,"ip_address":"","comment_id":307822,"utype":1}],"discussion_count":7,"race_medal":0,"score":"1629272548","product_id":100078401,"comment_content":"请问，在使用make vboxtest之后，报错<br>.&#47;lmkfbuild:1: .&#47;lmkfbuild: ELF乱码 not found<br>.&#47;lmkfbuild:2: .&#47;lmkfbuild: 乱码. not found<br>.&#47;lmkfbuild:2: .&#47;lmkfbuild: Syntax error: Unterminated quoted string pretreatment .mkf:41: recipe for target &#39;krnlobjs.mk&#39; failed<br>make[2]: *** [krnlobjs.mk] Eroor 2<br>Makefile.x86:28: recipe for target &#39;all&#39; failed<br>make[1]: *** [all] Error 2<br>Makefile:59: recipe for target &#39;all&#39; failed<br>make: *** [all] Error 2<br>该从什么方面解决呢？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525304,"discussion_content":"这是什么 环境 呢 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629337704,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2778587,"avatar":"","nickname":"Geek_994899","note":"","ucode":"0D45E525D6C892","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":414467,"discussion_content":"1.得自己新建一个名为Cosmos的虚拟机\n2.有三个文件无权限，chmod +x +文件名加可执行权限\n3.nasm命令未找到：你必须安装 nasm，一个汇编编译器。sudo apt-get install nasm","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1636776907,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":3027260,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/31/3c/d23f3fa5.jpg","nickname":"小李飞刀","note":"","ucode":"4CDF743FC51D15","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":2778587,"avatar":"","nickname":"Geek_994899","note":"","ucode":"0D45E525D6C892","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576670,"discussion_content":"貌似还是不行呀。。。除了新建一个Cosmos的虚拟机。Cosmos的虚拟机应该是用生成的vdi文件吧。我把第二步，第三部执行完成后，报错依然。。。\n======\n./lmkfbuild: 1: ./lmkfbuild: cannot create \u0001�@@�\u0017@@\u001f\u001c\u0006@@@@@�\u0001�\u0003\u0004\u0002\u0002@\u0002@\u001c\u001c\u0001\u0001@@�: Invalid argument\n./lmkfbuild: 1: ./lmkfbuild: ELF\u0002\u0001\u0001\u0002: not found\n./lmkfbuild: 2: ./lmkfbuild: �: not found\n./lmkfbuild: 2: ./lmkfbuild: Syntax error: Unterminated quoted string","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655730371,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":414467,"ip_address":""},"score":576670,"extra":""}]},{"author":{"id":2519235,"avatar":"https://static001.geekbang.org/account/avatar/00/26/70/c3/cc46c55a.jpg","nickname":"MONKEYG","note":"","ucode":"81C780AA899A9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560955,"discussion_content":"我也报了这个错误，请问您是怎么处理的\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649499138,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2778587,"avatar":"","nickname":"Geek_994899","note":"","ucode":"0D45E525D6C892","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":414459,"discussion_content":"请问弄好了吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636774307,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":2683210,"avatar":"https://static001.geekbang.org/account/avatar/00/28/f1/4a/bcba0456.jpg","nickname":"康Geek","note":"","ucode":"D54F1CFDA9F2D5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2778587,"avatar":"","nickname":"Geek_994899","note":"","ucode":"0D45E525D6C892","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545909,"discussion_content":"我弄好了一模一样的问题，按照大佬你写的操作了，完全没有问题编译出Cosmos.eki了然后直接放到boot文件夹下，打包出hd.vdi 挂到虚拟机就可以了。谢谢谢谢大佬！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642080044,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":414459,"ip_address":""},"score":545909,"extra":""},{"author":{"id":2519235,"avatar":"https://static001.geekbang.org/account/avatar/00/26/70/c3/cc46c55a.jpg","nickname":"MONKEYG","note":"","ucode":"81C780AA899A9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2683210,"avatar":"https://static001.geekbang.org/account/avatar/00/28/f1/4a/bcba0456.jpg","nickname":"康Geek","note":"","ucode":"D54F1CFDA9F2D5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560956,"discussion_content":"您好，请问你是怎么处理上面错误的\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649499288,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":545909,"ip_address":""},"score":560956,"extra":""}]}]},{"had_liked":false,"id":307645,"user_name":"dodo","can_delete":false,"product_type":"c1","uid":2732861,"ip_address":"","ucode":"50387ADA2DEA54","user_header":"https://static001.geekbang.org/account/avatar/00/29/b3/3d/e027e747.jpg","comment_is_top":false,"comment_ctime":1629188570,"is_pvip":false,"replies":[{"id":"111432","content":"什么 错误 ","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1629251538,"ip_address":"","comment_id":307645,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1629188570","product_id":100078401,"comment_content":"打包映像文件的那个工具怎么使用？一直报错  没有这个命令","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525227,"discussion_content":"什么 错误 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629251538,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":298573,"user_name":"simon","can_delete":false,"product_type":"c1","uid":1829980,"ip_address":"","ucode":"81A1A1CD299C7A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eo7020l7kLf1JNSbNMkvpPaIsrkQ5op6qgWQEDdtZu3QyUc5zvC7yicVAJRUeI9fUgVc1ghliaGpRhQ/132","comment_is_top":false,"comment_ctime":1624201810,"is_pvip":false,"replies":[{"id":"108324","content":"virtualbox 是不是 配置有问题","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1624239802,"ip_address":"","comment_id":298573,"utype":1}],"discussion_count":4,"race_medal":0,"score":"1624201810","product_id":100078401,"comment_content":"老师您好，为什么我用window10的virtualbox启动后会出现 INITKLDR DIE ERROR:S 这个界面呢","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522175,"discussion_content":"virtualbox 是不是 配置有问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624239802,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1829980,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eo7020l7kLf1JNSbNMkvpPaIsrkQ5op6qgWQEDdtZu3QyUc5zvC7yicVAJRUeI9fUgVc1ghliaGpRhQ/132","nickname":"simon","note":"","ucode":"81A1A1CD299C7A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":379908,"discussion_content":"我后来发现选择64位的就好了，谢谢","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1624240035,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2064750,"avatar":"","nickname":"springXu","note":"","ucode":"F5DB0B963C894F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388613,"discussion_content":"具体原因，我正在分析，目前定位在cpuid这个内嵌汇编上。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628847746,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"听水的湖","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":379905,"discussion_content":"有其他同学也遇到类似问题的，转发下他的经验供参考：问题出在ostype选择上，要选other/unkown_64，我是vbox里套vbox，gui配置项里没有这个，只能选other_unkown。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624238834,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":297120,"user_name":"Freddy","can_delete":false,"product_type":"c1","uid":1708412,"ip_address":"","ucode":"5822B746265DB4","user_header":"https://static001.geekbang.org/account/avatar/00/1a/11/7c/bf5049b3.jpg","comment_is_top":false,"comment_ctime":1623317575,"is_pvip":false,"replies":[{"id":"108084","content":"没有 内核 文件","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1623726648,"ip_address":"","comment_id":297120,"utype":1}],"discussion_count":4,"race_medal":0,"score":"1623317575","product_id":100078401,"comment_content":"用给的代码make后，生成了Cosmos.eki文件<br>在grub命令行下也有该文件：<br>grub&gt; ls (hd0)&#47;boot<br>grub&#47; Cosmos.eki<br><br>但是启动后，报错<br>INITKLDR DIE ERROR:not find file<br><br>麻烦帮忙看下啥问题。。。。？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521724,"discussion_content":"没有 内核 文件","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623726648,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2137388,"avatar":"","nickname":"SecooHR","note":"","ucode":"01C559CBEE207A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386040,"discussion_content":"你没有把内核文件Cosmos.bin 打包进去\n\n./lmoskrlimg -m k -lhf initldrimh.bin -o Cosmos.eki -f initldrsve.bin initldrkrl.bin font.fnt logo.bmp  Cosmos.bin \n\n用这个命令.\n\n课程里面的命令少了 Cosmos.bin ","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1627386281,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1178352,"avatar":"https://static001.geekbang.org/account/avatar/00/11/fa/f0/241294cd.jpg","nickname":"李城","note":"","ucode":"896A9C43CB62CD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2137388,"avatar":"","nickname":"SecooHR","note":"","ucode":"01C559CBEE207A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391679,"discussion_content":" Cosmos.bin 怎么生成的呢，和第二节课的Hello.bin 一样的吗，请问你是如何生成的呢。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630573263,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":386040,"ip_address":""},"score":391679,"extra":""},{"author":{"id":2834597,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/40/a5/5552e56f.jpg","nickname":"猪","note":"","ucode":"2030961A18DBED","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":2137388,"avatar":"","nickname":"SecooHR","note":"","ucode":"01C559CBEE207A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550312,"discussion_content":"Sounds reasonable.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644482136,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":386040,"ip_address":""},"score":550312,"extra":""}]}]},{"had_liked":false,"id":296728,"user_name":"Fan","can_delete":false,"product_type":"c1","uid":1115232,"ip_address":"","ucode":"3BF28670FD9407","user_header":"https://static001.geekbang.org/account/avatar/00/11/04/60/64d166b6.jpg","comment_is_top":false,"comment_ctime":1623133904,"is_pvip":false,"replies":[{"id":"107862","content":"只有VBE标准了 ","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1623245593,"ip_address":"","comment_id":296728,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1623133904","product_id":100078401,"comment_content":"什么？你不懂 VBE，其实我开始也不懂，后来通过搜寻资料才知道。<br>VBE 这个还有一些简单的例子看看呢？","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521565,"discussion_content":"只有VBE标准了 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623245593,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296572,"user_name":"刘博昊","can_delete":false,"product_type":"c1","uid":2621577,"ip_address":"","ucode":"35EBABB0B574C0","user_header":"https://static001.geekbang.org/account/avatar/00/28/00/89/e5f1b3c3.jpg","comment_is_top":false,"comment_ctime":1623051063,"is_pvip":false,"replies":[{"id":"107727","content":"不会吧 我回头测试一下","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1623072135,"ip_address":"","comment_id":296572,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1623051063","product_id":100078401,"comment_content":"windows host (VirtualBox 6.0.6) 遇到grub之后黑屏问题，在虚拟机 settings -&gt; Display -&gt; Graphics Controller 中选择VBoxVGA, 问题解决","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521497,"discussion_content":"不会吧 我回头测试一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623072135,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2621577,"avatar":"https://static001.geekbang.org/account/avatar/00/28/00/89/e5f1b3c3.jpg","nickname":"刘博昊","note":"","ucode":"35EBABB0B574C0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378263,"discussion_content":"virtualbox 默认的Graphics Controller 选项是VMSVGA,导致了grub之后的黑屏问题\nhttps://superuser.com/questions/1403123/what-are-differences-between-vboxvga-vmsvga-and-vboxsvga-in-virtualbox","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623134097,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296565,"user_name":"刘博昊","can_delete":false,"product_type":"c1","uid":2621577,"ip_address":"","ucode":"35EBABB0B574C0","user_header":"https://static001.geekbang.org/account/avatar/00/28/00/89/e5f1b3c3.jpg","comment_is_top":false,"comment_ctime":1623049080,"is_pvip":false,"replies":[{"id":"107728","content":"vbox按照课程中设置了吗 ","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1623072211,"ip_address":"","comment_id":296565,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1623049080","product_id":100078401,"comment_content":"windows host, 新建虚拟机后加载生成在exckrnl 路径下的hd.vdi, 启动Cosmos 在grub选择Cosmos 以后进入黑屏。 请问有没有人在window 下的virtualbox成功启动Cosmos的，谢谢","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521492,"discussion_content":"vbox按照课程中设置了吗 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623072211,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296405,"user_name":"coconut","can_delete":false,"product_type":"c1","uid":2344081,"ip_address":"","ucode":"07B95C7A6AC2F7","user_header":"https://static001.geekbang.org/account/avatar/00/23/c4/91/a017bf72.jpg","comment_is_top":false,"comment_ctime":1622957894,"is_pvip":true,"replies":[{"id":"107570","content":"通常情况下能告诉你&quot;not find file&quot;就是不幸中的万幸，大部分情况是不明情况下机器就重启了 ","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1622986607,"ip_address":"","comment_id":296405,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1622957894","product_id":100078401,"comment_content":"感觉应该课程内容应该增加&quot;关于如何调试&quot;的内容。<br><br>grub加载映像文件后，内核代码总是打印&quot;not find file&quot;。如果能够调试，定位问题应该会快一些。","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521429,"discussion_content":"通常情况下能告诉你&amp;quot;not find file&amp;quot;就是不幸中的万幸，大部分情况是不明情况下机器就重启了 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622986607,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296357,"user_name":"Lampy","can_delete":false,"product_type":"c1","uid":1390484,"ip_address":"","ucode":"5E43B9A1E6F32E","user_header":"https://static001.geekbang.org/account/avatar/00/15/37/94/5eb2d3fb.jpg","comment_is_top":false,"comment_ctime":1622936506,"is_pvip":false,"replies":[{"id":"107577","content":"你随便啊 用自己喜欢的就可以","user_name":"作者回复","user_name_real":"LMOS","uid":"1345199","ctime":1622987641,"ip_address":"","comment_id":296357,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1622936506","product_id":100078401,"comment_content":"难受啊，至今不知道使用什么编辑器去写这代码。","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521409,"discussion_content":"你随便啊 用自己喜欢的就可以","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622987641,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1090075,"avatar":"https://static001.geekbang.org/account/avatar/00/10/a2/1b/7426e629.jpg","nickname":"178","note":"","ucode":"3B0266F6BD06AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":410996,"discussion_content":"编辑器的话，用限制比较少而且简单的vscode，或者vim？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635822617,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1646195,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1e/73/c015ec33.jpg","nickname":"羅廷中","note":"","ucode":"29A9D4B34800D5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391993,"discussion_content":"在这里　 ~/cosmos/lesson13/Cosmos$  ，make all \n报错\n前面省略\n.........\n../hal/x86/kernel.asm:6: fatal: unable to open include file `kernel.inc&#39;\nkrnlbuidrule.mk:14: recipe for target &#39;kernel.o&#39; failed\nmake[2]: *** [kernel.o] Error 1\n..............\n后面省略\n\nkernel.inc  在　~/cosmos/lesson13/Cosmos/include/halinc 里面，\n却参照不到。　\n\n%include &#34;kernel.inc&#34;\n　\n有其他人遇到吗？\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630751103,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}