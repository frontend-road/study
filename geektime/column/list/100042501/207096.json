{"id":207096,"title":"32ä¸¨å½“Postgresç£ç›˜è¯»å¼•èµ·I/Oé«˜çš„æ—¶å€™ï¼Œåº”è¯¥æ€ä¹ˆåŠï¼Ÿ","content":"<p>åœ¨æ€§èƒ½åˆ†æçš„äººçœ¼é‡Œï¼Œæ€§èƒ½ç“¶é¢ˆå°±æ˜¯æ€§èƒ½ç“¶é¢ˆã€‚æ— è®ºè¿™ä¸ªæ€§èƒ½ç“¶é¢ˆå‡ºç°åœ¨ä»£ç å±‚ã€æ“ä½œç³»ç»Ÿå±‚ã€æ•°æ®åº“å±‚è¿˜æ˜¯å…¶ä»–å±‚ï¼Œæœ€ç»ˆçš„ç›®çš„åªæœ‰ä¸€ä¸ªç»“æœï¼šè§£å†³æ‰ï¼</p><p>æœ‰äººå¯èƒ½ä¼šè§‰å¾—è¿™ç§è¯´æ³•è¿‡äºéœ¸é“ã€‚</p><p>äº‹å®ä¸Šï¼Œæˆ‘è¦å¼ºè°ƒçš„æ€§èƒ½åˆ†æèƒ½åŠ›ï¼Œæ˜¯ä¸€å¥—åˆ†æé€»è¾‘ã€‚åœ¨è¿™ä¸€å¥—åˆ†æé€»è¾‘ä¸­ï¼Œä¸ç®¡æ˜¯æ“ä½œç³»ç»Ÿã€ä»£ç è¿˜æ˜¯æ•°æ®åº“ç­‰ï¼Œæ‰€æ¶‰åŠåˆ°çš„éƒ½åªæ˜¯åŸºç¡€çŸ¥è¯†ã€‚å¦‚æœä¸€ä¸ªäººéƒ½æŒæ¡è¿™äº›å†…å®¹ï¼Œé‚£ç¡®å®ä¸ç°å®ï¼Œä½†å¦‚æœæ˜¯å¯¹ä¸€ä¸ªæ€§èƒ½å›¢é˜Ÿçš„è¦æ±‚ï¼Œæˆ‘è§‰å¾—ä¸€ç‚¹ä¹Ÿä¸é«˜ã€‚</p><p>åœ¨æ€§èƒ½æµ‹è¯•å’Œæ€§èƒ½åˆ†æçš„é¡¹ç›®ä¸­ï¼Œæ²¡æœ‰å‹åŠ›å‘èµ·ï¼Œå°±ä¸ä¼šæœ‰æ€§èƒ½ç“¶é¢ˆï¼Œä¹Ÿå°±è°ˆä¸ä¸Šæ€§èƒ½åˆ†æäº†ã€‚æ‰€ä»¥æ¯ä¸ªé—®é¢˜çš„å‰æï¼Œéƒ½æ˜¯è¦æœ‰å‹åŠ›ã€‚</p><p>ä½†ä¸æ˜¯æ‰€æœ‰çš„å‹åŠ›åœºæ™¯éƒ½åˆç†ï¼Œå†åŠ ä¸Šå³ä½¿å‹åŠ›åœºæ™¯ä¸åˆç†ï¼Œä¹Ÿèƒ½å‹å‡ºæ€§èƒ½ç“¶é¢ˆï¼Œè¿™å°±ä¼šäº§ç”Ÿä¸€ç§é”™è§‰ï¼šä¼¼ä¹ä¸€ä¸ªé”™è¯¯çš„å‹åŠ›åœºæ™¯ä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚</p><p>æˆ‘æ˜¯åœ¨ä»‹å…¥ä¸€ä¸ªé¡¹ç›®æ—¶ï¼Œé¦–å…ˆä¼šçœ‹åœºæ™¯æ˜¯å¦æœ‰æ•ˆã€‚å¦‚æœæ— æ•ˆï¼Œæˆ‘å°±ä¸ä¼šä¸‹æ‰‹å»è°ƒäº†ï¼Œå› ä¸ºå³ä½¿ä¼˜åŒ–å¥½äº†ï¼Œå¯èƒ½ä¹Ÿç»™ä¸å‡ºç”Ÿäº§ç¯å¢ƒåº”è¯¥å¦‚ä½•é…ç½®çš„ç»“è®ºï¼Œé‚£å·¥ä½œå°±ç™½åšäº†ã€‚</p><p>æ‰€ä»¥è¦å…ˆè°ƒåœºæ™¯ã€‚</p><p>æˆ‘ç»å¸¸ä¼šæŠŠä¸€ä¸ªæ€§èƒ½æµ‹è¯•é¡¹ç›®é‡Œçš„å·¥ä½œåˆ†æˆä¸¤å¤§é˜¶æ®µï¼š</p><h3>æ•´ç†é˜¶æ®µ</h3><p>åœ¨è¿™ä¸ªé˜¶æ®µä¸­ï¼Œè¦æŠŠä¹‹å‰é¡¹ç›®ä¸­åšé”™çš„å†…å®¹çº æ­£è¿‡æ¥ã€‚ä¸æ­¢æœ‰æŠ€æœ¯é‡Œçš„çº æ­£ï¼Œè¿˜æœ‰ä»ä¸Šåˆ°ä¸‹æ²Ÿé€šä¸Šçš„çº æ­£ã€‚</p><h3>è°ƒä¼˜é˜¶æ®µ</h3><p>è¿™æ‰çœŸæ˜¯å¹²æ´»çš„é˜¶æ®µã€‚</p><p>åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼ŒåŒæ ·ï¼Œæˆ‘è¿˜æ˜¯è¦è¡¨è¾¾ä¸€ä¸ªåˆ†æçš„æ€è·¯ã€‚</p><!-- [[[read_end]]] --><h2>æ¡ˆä¾‹é—®é¢˜æè¿°</h2><p>è¿™æ˜¯ä¸€ä¸ªæ€§èƒ½ä»ä¸šäººå‘˜é—®çš„é—®é¢˜ï¼šä¸ºä»€ä¹ˆè¿™ä¸ªåº”ç”¨çš„updateç”¨äº†è¿™ä¹ˆé•¿æ—¶é—´å‘¢ï¼Ÿä»–è¿˜ç»™äº†æˆ‘ä¸€ä¸ªæˆªå›¾ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/fe/ac/fe83f42fd8b130b561e2a8f79c7cabac.png?wh=1569*507\" alt=\"\"></p><p>ä»è¿™ä¸ªå›¾ä¸­å¯ä»¥çœ‹åˆ°æ—¶é—´åœ¨100æ¯«ç§’å·¦å³ã€‚æ ¹æ®æˆ‘çš„ç»éªŒï¼Œä¸€ä¸ªSQLæ‰§è¡Œ100msï¼Œå¯¹å®æ—¶ä¸šåŠ¡æ¥è¯´ï¼Œç¡®å®æœ‰ç‚¹é•¿äº†ã€‚</p><p>ä½†æ˜¯è¿™ä¸ªæ—¶é—´æ˜¯é•¿è¿˜æ˜¯çŸ­ï¼Œè¿˜ä¸èƒ½ä¸‹ç»“è®ºã€‚è¦æ˜¯ä¸šåŠ¡éœ€è¦å¿…é¡»å†™æˆè¿™ç§è€—æ—¶çš„SQLå‘¢ï¼Ÿ</p><p>æ¥ç€ä»–åˆç»™æˆ‘å‘äº†TPSå›¾ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/ee/24/ee0ec6e2a7038611ccb30d7b5bf66824.png?wh=1435*737\" alt=\"\"></p><p>è¿™ä¸ªTPSå›¾ç¡®å®â€¦â€¦æœ‰ç‚¹ä¹±ï¼è¿˜è®°å¾—å‰é¢æˆ‘å¯¹TPSçš„æè¿°å§ï¼Œåœ¨ä¸€ä¸ªåœºæ™¯ä¸­ï¼ŒTPSæ˜¯è¦æœ‰é˜¶æ¢¯çš„ã€‚</p><p>å¦‚æœä½ åœ¨é€’å¢çš„TPSåœºæ™¯ä¸­å‘ç°äº†é—®é¢˜ï¼Œç„¶åä¸ºäº†æ‰¾åˆ°è¿™ä¸ªé—®é¢˜ï¼Œç”¨åŒæ ·çš„TPSçº§åˆ«å¿«é€ŸåŠ èµ·æ¥å‹åŠ›ï¼Œè¿™ç§æ–¹å¼ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚åªæ˜¯è¿™ä¸ªç»“æœä¸åšä¸ºæµ‹è¯•æŠ¥å‘Šï¼Œè€Œæ˜¯åº”è¯¥è®°å½•åˆ°è°ƒä¼˜æŠ¥å‘Šå½“ä¸­ã€‚</p><p>è€Œç°åœ¨æˆ‘ä»¬çœ‹åˆ°çš„è¿™ä¸ªTPSè¶‹åŠ¿ï¼Œé‚£çœŸæ˜¯å“ªå“ªéƒ½æŒ¨ä¸ä¸Šå‘€ã€‚å¦‚æ­¤æ··ä¹±çš„TPSï¼Œé‚£å¿…ç„¶æ˜¯æ€§èƒ½æœ‰é—®é¢˜ã€‚</p><p>ä»–è¿˜å‘Šè¯‰äº†æˆ‘ä¸¤ä¸ªä¿¡æ¯ã€‚</p><ol>\n<li>æœ‰100ä¸‡æ¡å‚æ•°åŒ–æ•°æ®ï¼›</li>\n<li>GCæ­£å¸¸ï¼Œdumpæ–‡ä»¶ä¹Ÿæ²¡æœ‰æ­»é”çš„é—®é¢˜ã€‚</li>\n</ol><p>è¿™ä¸¤ä¸ªä¿¡æ¯åº”è¯¥è¯´åªèƒ½æ˜¯ä¿¡æ¯ï¼Œå¹¶ä¸èƒ½èµ·åˆ°ä»€ä¹ˆä½œç”¨ã€‚å¦å¤–ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ä»–è¯´çš„â€œGCæ­£å¸¸â€æ˜¯æ€ä¹ˆä¸ªæ­£å¸¸æ³•ï¼Œåªèƒ½ç›¸ä¿¡ä»–è¯´çš„ã€‚</p><p>ä»¥ä¸Šå°±æ˜¯åŸºæœ¬çš„ä¿¡æ¯äº†ã€‚</p><h2>åˆ†æè¿‡ç¨‹</h2><p>ç…§æ—§ï¼Œå…ˆç”»ä¸ªæ¶æ„å›¾å‡ºæ¥çœ‹çœ‹ã€‚</p><p>æ¯æ¬¡åšæ€§èƒ½åˆ†æçš„æ—¶å€™ï¼Œæˆ‘å‡ ä¹éƒ½ä¼šå…ˆå¹²è¿™ä¸ªäº‹æƒ…ã€‚åªæœ‰çœ‹äº†è¿™ä¸ªå›¾ï¼Œæˆ‘å¿ƒé‡Œæ‰è¸å®ã€‚æ‰èƒ½æ˜ç¡®çŸ¥é“è¦é¢å¯¹çš„ç³»ç»ŸèŒƒå›´æœ‰å¤šå¤§ï¼›æ‰èƒ½åœ¨ä¸€ä¸ªåœ°æ–¹å‡ºé—®é¢˜çš„æ—¶å€™ï¼Œå»è€ƒè™‘æ˜¯ä¸æ˜¯ç”±å…¶ä»–åœ°æ–¹å¼•èµ·çš„ï¼›æ‰èƒ½è·Ÿç€é—®é¢˜æ‰¾åˆ°ä¸€æ¡æ¡çš„åˆ†æè·¯å¾„â€¦â€¦</p><p>ä¸‹é¢æ˜¯ä¸€å¼ ç®€å•çš„æ¶æ„å›¾ï¼Œä»ä¸‹é¢è¿™å¼ æ¶æ„å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸æ˜¯ä¸ªå¤æ‚çš„åº”ç”¨ï¼Œæ˜¯ä¸ªéå¸¸å…¸å‹çš„å¾®æœåŠ¡ç»“æ„ï¼Œåªæ˜¯æ•°æ®åº“ç”¨äº†PostgreSQLè€Œå·²ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/21/3d/21e32cd936482c970abb2ef02007563d.jpg?wh=1069*423\" alt=\"\"></p><p>ç”±äºè¿™ä¸ªé—®é¢˜åé¦ˆçš„æ˜¯ä»æœåŠ¡é›†ç¾¤æ—¥å¿—ä¸­çœ‹åˆ°çš„updateæ…¢ï¼Œæ‰€ä»¥åé¢çš„åˆ†æè‚¯å®šæ˜¯ç›´æ¥å¯¹ç€æ•°æ®åº“å»äº†ã€‚</p><p>è¿™é‡Œè¦æé†’ä¸€å¥ï¼Œæˆ‘ä»¬çœ‹åˆ°ä»€ä¹ˆç°è±¡ï¼Œå°±è·Ÿç€ç°è±¡å»åˆ†æã€‚è¿™æ˜¯éå¸¸æ­£è§„çš„æ€è·¯å§ã€‚ä½†å°±æ˜¯æœ‰ä¸€äº›äººï¼Œæ˜æ˜çœ‹ç€æ•°æ®åº“æœ‰é—®é¢˜ï¼Œéè¦çªç€çœ¼ç›è·Ÿåº”ç”¨æœåŠ¡å™¨è¾ƒåŠ²ã€‚</p><p>å‰ä¸ä¹…å°±æœ‰ä¸€ä¸ªäººé—®äº†æˆ‘ä¸€ä¸ªæ€§èƒ½é—®é¢˜ï¼Œè¯´æ˜¯åœ¨å‹åŠ›è¿‡ç¨‹ä¸­ï¼Œå‘ç°æ•°æ®åº“CPUç”¨å®Œäº†ï¼Œåº”ç”¨æœåŠ¡å™¨çš„CPUè¿˜æœ‰ä½™é‡ï¼Œäºæ˜¯åŠ äº†ä¸¤ä¸ªæ•°æ®åº“CPUã€‚ä½†æ˜¯åŠ å®Œä¹‹åï¼Œå‘ç°æ•°æ®åº“CPUä½¿ç”¨ç‡æ²¡æœ‰ç”¨ä¸Šå»ï¼Œåè€Œåº”ç”¨æœåŠ¡å™¨çš„CPUç”¨å®Œäº†ã€‚æˆ‘ä¸€å¬ï¼Œè§‰å¾—æŒºåˆç†çš„å‘€ï¼Œä¸ºä»€ä¹ˆä»–åœ¨çº ç»“åº”ç”¨æœåŠ¡å™¨ç”¨å®Œäº†å‘¢ï¼Ÿäºæ˜¯æˆ‘å°±å‘Šè¯‰ä»–ï¼Œåˆ«çº ç»“è¿™ä¸ªï¼Œå…ˆçœ‹æ—¶é—´è€—åœ¨å“ªé‡Œã€‚ç»“æœå‘ç°åº”ç”¨çš„æ—¶é—´éƒ½è€—åœ¨è¯»å–æ•°æ®åº“ä¸Šäº†ï¼Œåªæ˜¯æ•°æ®åº“ç¡¬ä»¶å¥½äº†ä¸€äº›è€Œå·²ã€‚</p><p>å› ä¸ºè¿™æ˜¯ä¸ªåœ¨æ•°æ®åº“ä¸Šçš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ç›´æ¥æŸ¥äº†æ•°æ®åº“çš„èµ„æºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/dc/78/dcacb613ed1d09dfa56d500c10307e78.png?wh=1059*378\" alt=\"\"></p><p>æŸ¥çœ‹vmstatï¼Œä»è¿™ä¸ªç»“æœæ¥çœ‹ï¼Œç³»ç»Ÿèµ„æºç¡®å®æ²¡ç”¨ä¸Šã€‚ä¸è¿‡ï¼Œè¯·æ³¨æ„ï¼Œè¿™ä¸ªbiæŒºé«˜ï¼Œèƒ½è¾¾åˆ°30ä¸‡ä»¥ä¸Šã€‚é‚£è¿™ä¸ªå€¼è¯´æ˜äº†ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬æ¥ç®—ä¸€ç®—ã€‚</p><p>biæ˜¯æŒ‡æ¯ç§’è¯»ç£ç›˜çš„å—æ•°ã€‚æ‰€ä»¥è¦å…ˆçœ‹ä¸€ä¸‹ï¼Œä¸€å—æœ‰å¤šå¤§ã€‚</p><pre><code>[root@7dgroup1 ~]# tune2fs -l /dev/vda1 | grep &quot;Block size&quot;\nBlock size:               4096\n[root@7dgroup1 ~]#\n</code></pre><p>é‚£è®¡ç®—ä¸‹æ¥å¤§çº¦å°±æ˜¯ï¼š</p><p>$(300000*4096)/1024/1024=1172M$</p><p>1172Mçš„è¯»å–ï¼Œæ˜¾ç„¶è¿™ä¸ªå€¼æ˜¯ä¸ä½çš„ã€‚</p><p>æ¥ä¸‹æ¥æŸ¥çœ‹I/Oã€‚å†æ‰§è¡Œä¸‹iostatçœ‹çœ‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/59/74/59600c6b74472e8d8e3e9c785bb22674.png?wh=1590*537\" alt=\"\"></p><p>ä»è¿™ä¸ªç»“æœæ¥çœ‹ï¼Œ%utilå·²ç»è¾¾åˆ°äº†95%å·¦å³ï¼ŒåŒæ—¶çœ‹rkB/sé‚£ä¸€åˆ—ï¼Œåœ¨300Må·¦å³ã€‚</p><p>æ¥ç€åœ¨masterä¸Šé¢çš„æ‰§è¡Œiotopã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/8b/5a/8b4e86cc2835768bc7477e09a36c3a5a.png?wh=1503*711\" alt=\"\"></p><p>æˆ‘å‘ç°Walsender Postgresè¿›ç¨‹è¾¾åˆ°äº†56.07%çš„ä½¿ç”¨ç‡ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒçš„è¯»åœ¨300Må·¦å³ã€‚ä½†æ˜¯å†™çš„å¹¶ä¸å¤šï¼Œä»å›¾ä¸Šçœ‹åªæœ‰5.77M/sã€‚</p><p>ç»“åˆä¸Šé¢å‡ ä¸ªå›¾ï¼Œæˆ‘ä»¬åé¢çš„ä¼˜åŒ–æ–¹å‘å°±æ˜¯ï¼š<strong>é™ä½è¯»å–ï¼Œæé«˜å†™å…¥</strong>ã€‚</p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±å¾—è¯´é“è¯´é“äº†ã€‚è¿™ä¸ªWalsender Postgresè¿›ç¨‹æ˜¯å¹²å—çš„å‘¢ï¼Ÿ</p><p>æˆ‘æ ¹æ®ç†è§£ï¼Œç”»äº†ä¸€ä¸ªWalsenderçš„é€»è¾‘å›¾ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/a2/3b/a250bc12f25ded65ea6287912891dd3b.jpg?wh=1463*440\" alt=\"\"></p><p>ä»è¿™ä¸ªå›¾ä¸­å°±å¯ä»¥çœ‹å¾—å‡ºæ¥ï¼ŒWalsenderå’ŒWalreceiverå®ç°äº†PostgreSQLçš„Masterå’ŒSlaveä¹‹é—´çš„æµå¼å¤åˆ¶ã€‚Walsenderå–å½’æ¡£ç›®å½•ä¸­çš„å†…å®¹ï¼ˆæ•²é»‘æ¿äº†å‘€ï¼ï¼‰ï¼Œé€šè¿‡ç½‘ç»œå‘é€ç»™Walreceiverï¼ŒWalreceiveræ¥æ”¶ä¹‹ååœ¨slaveä¸Šè¿˜åŸå’Œmasteræ•°æ®åº“ä¸€æ ·çš„æ•°æ®ã€‚</p><p>è€Œç°åœ¨è¯»å–è¿™ä¹ˆé«˜ï¼Œé‚£æˆ‘ä»¬å°±æŠŠè¯»å–é™ä¸‹æ¥ã€‚</p><p>å…ˆæŸ¥çœ‹ä¸€ä¸‹å‡ ä¸ªå…³é”®å‚æ•°ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/e3/bf/e3313d522881096d711e77503e0454bf.png?wh=625*138\" alt=\"\"></p><p><img src=\"https://static001.geekbang.org/resource/image/93/b1/93441006fdb611b1b07beec5566129b1.png?wh=400*125\" alt=\"\"></p><p>è¿™ä¸¤ä¸ªå‚æ•°å¯¹PostgreSQLéå¸¸é‡è¦ã€‚checkpoint_completion_targetè¿™ä¸ªå€¼è¡¨ç¤ºè¿™æ¬¡checkpointå®Œæˆçš„æ—¶é—´å åˆ°ä¸‹ä¸€æ¬¡checkpointä¹‹é—´çš„æ—¶é—´çš„ç™¾åˆ†æ¯”ã€‚</p><p>è¿™æ ·è¯´ä¼¼ä¹ä¸å¤ªå¥½ç†è§£ã€‚ç”»å›¾è¯´æ˜ä¸€ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/e9/30/e9fccc9914c54e17e75d1c44baeb9b30.jpg?wh=466*116\" alt=\"\"></p><p>åœ¨è¿™ä¸ªå›¾ä¸­300så°±æ˜¯checkpoint_timeoutï¼Œå³ä¸¤æ¬¡checkpointä¹‹é—´çš„æ—¶é—´é•¿åº¦ã€‚è¿™æ—¶è‹¥å°†checkpoint_completion_targetè®¾ç½®ä¸º0.1ï¼Œé‚£å°±æ˜¯è¯´CheckPoint1å®Œæˆæ—¶é—´çš„ç›®æ ‡å°±æ˜¯åœ¨30sä»¥å†…ã€‚</p><p>åœ¨è¿™æ ·çš„é…ç½®ä¹‹ä¸‹ï¼Œä½ å°±ä¼šçŸ¥é“checkpoint_completion_targetè®¾ç½®å¾—è¶ŠçŸ­ï¼Œé›†ä¸­å†™çš„å†…å®¹å°±è¶Šå¤šï¼ŒI/Oå³°å€¼å°±ä¼šé«˜ï¼›checkpoint_completion_targetè®¾ç½®å¾—è¶Šé•¿ï¼Œå†™å…¥å°±ä¸ä¼šé‚£ä¹ˆé›†ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´checkpoint_completion_targetè®¾ç½®å¾—é•¿ï¼Œä¼šè®©å†™I/Oæœ‰ç¼“è§£ã€‚</p><p>åœ¨æˆ‘ä»¬è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œå†™å¹¶æ²¡æœ‰å¤šå°‘ã€‚æ‰€ä»¥è¿™ä¸ªä¸æ˜¯ä»€ä¹ˆé—®é¢˜ã€‚</p><p>ä½†æ˜¯è¯»å–çš„I/Oé‚£ä¹ˆå¤§ï¼Œåˆæ˜¯æµå¼ä¼ è¾“çš„ï¼Œé‚£å°±æ˜¯ä¼šä¸æ–­åœ°è¯»æ–‡ä»¶ï¼Œä¸ºäº†ä¿è¯æœ‰è¶³å¤Ÿçš„æ•°æ®å¯ä»¥æµå¼è¾“å‡ºï¼Œè¿™é‡Œæˆ‘æŠŠshared_bufferså¢åŠ ï¼Œä»¥ä¾¿å‡è½»æœ¬åœ°I/Oçš„çš„å‹åŠ›ã€‚</p><p>æ¥çœ‹ä¸€ä¸‹ä¼˜åŒ–åŠ¨ä½œï¼š</p><pre><code>checkpoint_completion_target = 0.1\ncheckpoint_timeout = 30min\nshared_buffers = 20G\nmin_wal_size = 1GB\nmax_wal_size = 4GB\n</code></pre><p>å…¶ä¸­çš„max_wal_sizeå’Œmin_wal_sizeå®˜æ–¹å«ä¹‰å¦‚ä¸‹æ‰€ç¤ºã€‚</p><p>max_wal_size (integer)ï¼š</p><blockquote>\n<p>Maximum size to let the WAL grow to between automatic WAL checkpoints. This is a soft limit; WAL size can exceed max_wal_size under special circumstances, like under heavy load, a failing archive_command, or a high wal_keep_segments setting. The default is 1 GB. Increasing this parameter can increase the amount of time needed for crash recovery. This parameter can only be set in the postgresql.conf file or on the server command line.</p>\n</blockquote><p>min_wal_size (integer)ï¼š</p><blockquote>\n<p>As long as WAL disk usage stays below this setting, old WAL files are always recycled for future use at a checkpoint, rather than removed. This can be used to ensure that enough WAL space is reserved to handle spikes in WAL usage, for example when running large batch jobs. The default is 80 MB. This parameter can only be set in the postgresql.conf file or on the server command line.</p>\n</blockquote><p>è¯·æ³¨æ„ï¼Œä¸Šé¢çš„shared_buffersæ˜¯æœ‰ç‚¹è¿‡å¤§çš„ï¼Œä¸è¿‡æˆ‘ä»¬å…ˆéªŒè¯ç»“æœå†è¯´ã€‚</p><h2>ä¼˜åŒ–ç»“æœ</h2><p>å†çœ‹iostatï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/23/45/23ab209aedc2282eee042f0c4b941645.png?wh=1370*737\" alt=\"\"></p><p>çœ‹èµ·æ¥æŒç»­çš„è¯»é™ä½äº†ä¸å°‘ã€‚æ•ˆæœæ˜¯æœ‰çš„ï¼Œæ–¹å‘æ²¡é”™ã€‚å†æ¥çœ‹çœ‹TPSï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/f1/bc/f12e8ba227c6a66e0dfb9d60794c46bc.png?wh=1490*637\" alt=\"\"></p><p>çœ‹è¿™é‡ŒTPSç¡®å®ç¨³å®šäº†å¾ˆå¤šï¼Œæ•ˆæœä¹Ÿæ¯”è¾ƒæ˜æ˜¾ã€‚</p><p>è¿™ä¹Ÿå°±è¾¾åˆ°æˆ‘ä»¬ä¼˜åŒ–çš„ç›®æ ‡äº†ã€‚å°±åƒåœ¨å‰é¢æ–‡ç« ä¸­æ‰€è¯´çš„ï¼Œåœ¨ä¼˜åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œå½“ä½ ç¢°åˆ°TPSéå¸¸ä¸è§„åˆ™æ—¶ï¼Œè¯·è®°ä½ï¼Œä¸€å®šè¦å…ˆæŠŠTPSè°ƒç¨³å®šï¼Œä¸è¦æŒ‡æœ›åœ¨ä¸€ä¸ªæ··ä¹±çš„TPSæ›²çº¿ä¸‹åšä¼˜åŒ–ï¼Œé‚£å°†ä½¿ä½ æ— çš„æ”¾çŸ¢ã€‚</p><h2>é—®é¢˜åˆæ¥äº†ï¼Ÿ</h2><p>åœ¨è§£å†³äº†ä¸Šä¸€ä¸ªé—®é¢˜ä¹‹åï¼Œæ²¡è¿‡å¤šä¹…ï¼Œå¦ä¸€ä¸ªé—®é¢˜åˆæŠ›åˆ°æˆ‘é¢å‰äº†ï¼Œè¿™æ˜¯å¦ä¸€ä¸ªæ¥å£ï¼Œå› ä¸ºæ˜¯åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸Šï¼Œæ‰€ä»¥å¯¹é—®é—®é¢˜çš„äººæ¥è¯´ï¼Œç–‘æƒ‘è¿˜æ˜¯æ•°æ®åº“æœ‰é—®é¢˜ã€‚</p><p>æ¥çœ‹ä¸€ä¸‹TPSï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/dc/97/dcd93f0218e4311de099404bba562297.png?wh=1589*562\" alt=\"\"></p><p>è¿™ä¸ªé—®é¢˜å¾ˆæ˜æ˜¾ï¼Œé‚£å°±æ˜¯åé¢çš„æˆåŠŸäº‹åŠ¡æ•°æ€ä¹ˆèƒ½è¾¾åˆ°8000ä»¥ä¸Šï¼Ÿå¦‚æœè®©ä½ è’™çš„è¯ï¼Œä½ è§‰å¾—ä¼šæ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ</p><p>åœ¨è¿™é‡Œï¼Œå‘Šè¯‰ä½ æˆ‘å¯¹TPSè¶‹åŠ¿çš„åˆ¤æ–­é€»è¾‘ï¼Œé‚£å°±æ˜¯<strong>TPSä¸èƒ½å‡ºç°æ„å¤–çš„è¶‹åŠ¿ã€‚</strong></p><p>ä»€ä¹ˆå«æ„å¤–çš„è¶‹åŠ¿ï¼Ÿå°±æ˜¯å½“åœ¨è¿è¡Œä¸€ä¸ªåœºæ™¯ä¹‹å‰å°±å·²ç»è€ƒè™‘åˆ°äº†è¿™ä¸ªTPSè¶‹åŠ¿åº”è¯¥æ˜¯ä¸ªä»€ä¹ˆæ ·å­ï¼ˆåšå°è¯•çš„åœºæ™¯é™¤å¤–ï¼‰ï¼Œå½“æ‹¿åˆ°è¿è¡Œçš„ç»“æœä¹‹åï¼ŒTPSè¶‹åŠ¿è¦å’Œé¢„æœŸä¸€è‡´ã€‚</p><p>å¦‚æœæ²¡æœ‰é¢„æœŸï¼Œå°±ä¸å…·æœ‰åˆ†æTPSçš„èƒ½åŠ›äº†ï¼Œæœ€å¤šä¹Ÿå°±æ˜¯å‹å‡ºæ›²çº¿ï¼Œä½†ä¸ä¼šæ‡‚æ›²çº¿çš„å«ä¹‰ã€‚</p><p>åƒä¸Šé¢çš„è¿™å¤„TPSå›¾ï¼Œæ˜¾ç„¶å°±å‡ºç°æ„å¤–äº†ï¼Œå¹¶ä¸”æ˜¯å¦‚æ­¤å¤§çš„æ„å¤–ã€‚å‰é¢åªæœ‰1300å·¦å³çš„TPSï¼Œåé¢æ€ä¹ˆå¯èƒ½è·‘åˆ°8000ä»¥ä¸Šï¼Œè¿˜å…¨æ˜¯å¯¹çš„å‘¢ï¼Ÿ</p><p>æ‰€ä»¥æˆ‘çœ‹åˆ°è¿™ä¸ªå›¾ä¹‹åï¼Œå°±é—®äº†ä¸€ä¸‹ï¼šæ˜¯ä¸æ˜¯æ²¡åŠ æ–­è¨€ï¼Ÿ</p><p>ç„¶åä»–æŸ¥äº†ä¸€ä¸‹ï¼Œæœç„¶æ²¡æœ‰åŠ æ–­è¨€ã€‚äºæ˜¯é‡è·‘åœºæ™¯ã€‚å¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/bc/a0/bc81f1c069d430d56786dd44e9e28ba0.png?wh=1458*644\" alt=\"\"><br>\nä»è¿™ä¸ªå›¾ä¸Šå¯ä»¥çœ‹åˆ°ï¼ŒåŠ äº†æ–­è¨€ä¹‹åï¼Œé”™è¯¯çš„äº‹åŠ¡éƒ½æ­£å¸¸æš´éœ²å‡ºæ¥äº†ã€‚åƒè¿™ç§åå°å¤„ç†äº†å¼‚å¸¸å¹¶è¿”å›äº†ä¿¡æ¯çš„æ—¶å€™ï¼Œå‰ç«¯ä¼šæ”¶åˆ°æ­£å¸¸çš„HTTP Codeï¼Œæ‰€ä»¥æ‰ä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜ã€‚</p><p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆé€šå¸¸æˆ‘ä»¬éƒ½è¦åŠ æ–­è¨€æ¥åˆ¤æ–­ä¸šåŠ¡æ˜¯å¦æ­£å¸¸ã€‚</p><h2>æ€»ç»“</h2><p>åœ¨æ€§èƒ½åˆ†æçš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¼šé‡åˆ°å„ç§æ‚ä¸ƒæ‚å…«çš„é—®é¢˜ã€‚å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬éƒ½æœŸå¾…ç€æ€§èƒ½æµ‹è¯•ä¸­çš„åˆ†æåƒç ´æ¡ˆä¸€æ ·ï¼Œå¹¶ä¸”æœ€å¥½å¯ä»¥ç ´ä¸€ä¸ªæƒŠå¤©åœ°æ³£é¬¼ç¥çš„å¤§æ¡ˆï¼Œä»¥æ‰¬åå››æµ·ã€‚</p><p>ç„¶è€Œåˆ†æåˆ°äº†æ ¹æœ¬åŸå› ä¹‹åï¼Œä½ ä¼šå‘ç°ä¼˜åŒ–çš„éƒ¨åˆ†æ˜¯å¦‚æ­¤ç®€å•ã€‚</p><p>å…¶å®å¯¹äºPostgreSQLæ•°æ®åº“æ¥è¯´ï¼Œåƒbufferã€logã€replicationç­‰å†…å®¹ï¼Œéƒ½æ˜¯éå¸¸é‡è¦çš„åˆ†æç‚¹ï¼Œåœ¨åšé¡¹ç›®ä¹‹å‰ï¼Œæˆ‘å»ºè®®å…ˆæŠŠè¿™æ ·çš„å‚æ•°ç»™æ”¶æ‹¾ä¸€éï¼Œä¸è¦è®©å‚æ•°é…ç½®æˆä¸ºæ€§èƒ½é—®é¢˜ï¼Œå¦åˆ™å¾—ä¸å¿å¤±ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æœ€åé—®ä½ ä¸¤ä¸ªé—®é¢˜å§ã€‚ä¸ºä»€ä¹ˆåŠ å¤§bufferå¯ä»¥å‡å°‘ç£ç›˜I/Oçš„å‹åŠ›ï¼Ÿä¸ºä»€ä¹ˆè¯´TPSè¶‹åŠ¿è¦åœ¨é¢„æœŸä¹‹å†…ï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨è¯„è®ºåŒºå†™ä¸‹ä½ çš„æ€è€ƒï¼Œæˆ‘ä¼šå’Œä½ ä¸€èµ·äº¤æµã€‚ä¹Ÿæ¬¢è¿æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–è€…åŒäº‹ï¼Œä¸€èµ·äº¤æµä¸€ä¸‹ã€‚</p>","comments":[{"had_liked":false,"id":184757,"user_name":"ç½—è¾‘æ€ç»´","can_delete":false,"product_type":"c1","uid":1318941,"ip_address":"","ucode":"D257A06EDE928E","user_header":"https://static001.geekbang.org/account/avatar/00/14/20/1d/0c1a184c.jpg","comment_is_top":false,"comment_ctime":1583396794,"is_pvip":false,"replies":[{"id":"71448","content":"è®¤çœŸçš„åŒå­¦ï¼Œå¿…é¡»èµï¼<br>","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1583413474,"ip_address":"","comment_id":184757,"utype":1}],"discussion_count":3,"race_medal":0,"score":"40238102458","product_id":100042501,"comment_content":"åˆ†äº«ä¸‹è‡ªå·±å­¦ä¹ ä½“ä¼šï¼š<br>ä¸ºä»€ä¹ˆç¼“å­˜å¯ä»¥åŠ é€ŸI&#47;Oçš„è®¿é—®é€Ÿåº¦ï¼Ÿ<br>è€å¸ˆè¯´çš„ç¼“å­˜åº”è¯¥æœ‰ä¸¤ä¸ªï¼šæ“ä½œç³»ç»Ÿçš„ç¼“å­˜å’ŒPostgreSQLçš„ç¼“å­˜ã€‚å®ƒä¿©ä½œç”¨éƒ½æ˜¯ä¸ºäº†æŠŠç»å¸¸è®¿é—®çš„æ•°æ®ï¼ˆä¹Ÿå°±æ˜¯çƒ­ç‚¹æ•°æ®ï¼‰ï¼Œæå‰è¯»å…¥åˆ°å†…å­˜ä¸­ã€‚è¿™æ ·ï¼Œä¸‹æ¬¡è®¿é—®æ—¶å°±å¯ä»¥ç›´æ¥ä»å†…å­˜è¯»å–æ•°æ®ï¼Œè€Œä¸éœ€è¦ç»è¿‡ç¡¬ç›˜ï¼Œä»è€ŒåŠ é€ŸI&#47;O çš„è®¿é—®é€Ÿåº¦ã€‚<br><br>å› ä¸ºæ²¡æ¥è§¦è¿‡PostgreSQL,åœ¨åšæ€è€ƒé¢˜æ—¶æ‰¾äº†äº›èµ„æ–™ï¼Œä¸‹é¢æ˜¯å»¶ä¼¸çš„å­¦ä¹ ã€‚<br>PostgreSQLç¼“å­˜è·Ÿæ“ä½œç³»ç»Ÿçš„ç¼“å­˜æœ‰å•¥è”ç³»ï¼Ÿ<br><br>1.åœ¨è®¿é—®æ•°æ®æ—¶ï¼Œæ•°æ®ä¼šå…ˆåŠ è½½åˆ°æ“ä½œç³»ç»Ÿç¼“å­˜ï¼Œç„¶åå†åŠ è½½åˆ°shared_buffersï¼Œè¿™ä¸ªåŠ è½½è¿‡ç¨‹å¯èƒ½æ˜¯ä¸€äº›æŸ¥è¯¢ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨pg_prewarmé¢„çƒ­ç¼“å­˜ã€‚<br>2.å½“ç„¶ä¹Ÿå¯èƒ½åŒæ—¶å­˜åœ¨æ“ä½œç³»ç»Ÿå’Œshared_buffersä¸¤ä»½ä¸€æ ·çš„ç¼“å­˜ï¼ˆåŒç¼“å­˜ï¼‰ã€‚<br>3.æŸ¥æ‰¾åˆ°çš„æ—¶å€™ä¼šå…ˆåœ¨shared_buffersæŸ¥æ‰¾æ˜¯å¦æœ‰ç¼“å­˜ï¼Œå¦‚æœæ²¡æœ‰å†åˆ°æ“ä½œç³»ç»Ÿç¼“å­˜æŸ¥æ‰¾ï¼Œæœ€åå†ä»ç£ç›˜è·å–ã€‚<br>4.æ“ä½œç³»ç»Ÿç¼“å­˜ä½¿ç”¨ç®€å•çš„LRUï¼ˆç§»é™¤æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„ç¼“å­˜ï¼‰ï¼Œè€ŒPostgreSQLé‡‡ç”¨çš„ä¼˜åŒ–çš„æ—¶é’Ÿæ‰«æï¼Œå³ç¼“å­˜ä½¿ç”¨é¢‘ç‡é«˜çš„ä¼šè¢«ä¿å­˜ï¼Œä½çš„è¢«ç§»é™¤ã€‚<br><br>PostgreSQLç¼“å­˜è¯»é¡ºåºshare_buffers -&gt; æ“ä½œç³»ç»Ÿç¼“å­˜ -&gt; ç¡¬ç›˜ã€‚é‚£ä¹ˆä¹Ÿå¯èƒ½æ˜¯æ“ä½œç³»ç»Ÿç¼“å­˜ä¸è¶³ï¼Œè€Œä¸å®šæ˜¯share_buffersã€‚é€šè¿‡æ–‡ç« ä¸­vmstatå‘½ä»¤çœ‹åˆ°cacheæœ‰260Gï¼Œfreeå€¼ä¹Ÿå¾ˆç¨³å®šï¼Œæ‰€ä»¥åº”è¯¥æ£€æŸ¥PostgreSQLçš„ç¼“å­˜ã€‚ï¼ˆè€å¸ˆæ‰§è¡Œvmstatæ˜¯ä¸æ˜¯åŸ‹äº†ä¸ªä¼ç¬”ï¼‰ã€‚<br><br>å‚è€ƒèµ„æ–™<br>https:&#47;&#47;www.cnblogs.com&#47;zhangfx01&#47;p&#47;postgresql_shared_buffer.html<br>https:&#47;&#47;blog.csdn.net&#47;kwame211&#47;article&#47;details&#47;78665999","like_count":10,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486121,"discussion_content":"è®¤çœŸçš„åŒå­¦ï¼Œå¿…é¡»èµï¼\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583413474,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1132906,"avatar":"https://static001.geekbang.org/account/avatar/00/11/49/6a/abd37654.jpg","nickname":"ä¸ƒå¹´R","note":"","ucode":"9A582240E90289","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344012,"discussion_content":"æˆ‘å°±è¯´è¿™æ®µçœ‹ç€æ€ä¹ˆè¿™ä¹ˆçœ¼ç†Ÿï¼ŒåŸæ¥æ˜¯æˆ‘çš„å¸–å­è¢«å¼•ç”¨äº†ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1611233953,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1318941,"avatar":"https://static001.geekbang.org/account/avatar/00/14/20/1d/0c1a184c.jpg","nickname":"ç½—è¾‘æ€ç»´","note":"","ucode":"D257A06EDE928E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1132906,"avatar":"https://static001.geekbang.org/account/avatar/00/11/49/6a/abd37654.jpg","nickname":"ä¸ƒå¹´R","note":"","ucode":"9A582240E90289","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344645,"discussion_content":"ä½ å†™å¾—çœŸè¯¦ç»†ï¼Œæˆ‘è¿™ä¸ªå¤–è¡Œä¹Ÿçœ‹å¾—æ‡‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611543307,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":344012,"ip_address":""},"score":344645,"extra":""}]}]},{"had_liked":false,"id":233234,"user_name":"Geek_7cf52a","can_delete":false,"product_type":"c1","uid":2058904,"ip_address":"","ucode":"C7A1D1CF429503","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJlkFFx4N8ice8UcQRu3AMP0QAXdib17lyFI8G6QLje9iaumOXhsNq50PyLowAwg0umho89o1amN2UGQ/132","comment_is_top":false,"comment_ctime":1594266157,"is_pvip":true,"replies":[{"id":"87970","content":"è¿™é‡Œå¹¶æ²¡æœ‰ç®—é”™ã€‚å› ä¸ºè¿™ä¸ª300000å¯¹åº”çš„å•ä½æ˜¯kB&#47;sã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1596071228,"ip_address":"","comment_id":233234,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10184200749","product_id":100042501,"comment_content":"bi æ˜¯æŒ‡æ¯ç§’è¯»ç£ç›˜çš„å—æ•°ã€‚æ‰€ä»¥è¦å…ˆçœ‹ä¸€ä¸‹ï¼Œä¸€å—æœ‰å¤šå¤§ã€‚<br><br>[root@7dgroup1 ~]# tune2fs -l &#47;dev&#47;vda1 | grep &quot;Block size&quot;<br>Block size: 4096<br>[root@7dgroup1 ~]#<br><br>(300000âˆ—1024)&#47;1024&#47;1024â‰ˆ293M<br><br>=====================================================<br>=====================================================<br>ä¸Šé¢ä¸ºåŸæ–‡<br>è¿™é‡ŒæŒ‡çš„æ˜¯å—ã€‚ä½†æ˜¯è€å¸ˆè¿™æ ·ç®—ä¹Ÿé”™äº†å§ï¼Œä¸€å—æ˜¯4096byte,é‚£300000å—çš„å¤§å°åº”è¯¥æ˜¯300000*4096&#47;1024&#47;1024=1172M","like_count":3,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500952,"discussion_content":"è¿™é‡Œå¹¶æ²¡æœ‰ç®—é”™ã€‚å› ä¸ºè¿™ä¸ª300000å¯¹åº”çš„å•ä½æ˜¯kB/sã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596071228,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":219157,"user_name":"jy","can_delete":false,"product_type":"c1","uid":1785172,"ip_address":"","ucode":"F4E179C435451B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJ6G2xZvNRmhyXBjmGbI5G8icGCCMPupr6yxZ1IcURwp7GTRHcpWGWpg9A0fLlyicmVdDwzqZqwiaOQ/132","comment_is_top":false,"comment_ctime":1589957131,"is_pvip":false,"replies":[{"id":"81904","content":"é—®é¢˜1ï¼Œ ä½ å¯ä»¥çœ‹ä¸€ä¸‹vmstatçš„å¸®åŠ©æ‰‹å†Œï¼Œé‡Œé¢æœ‰è¿™ä¹ˆä¸€å¥ã€‚<br> bi: Blocks received from a block device (blocks&#47;s).<br>æ‰€ä»¥è¿™ä¸ªæ˜¯å—ï¼Œè€Œä¸æ˜¯kbã€‚<br>é—®é¢˜2ï¼ŒæŸ¥block sizeå°±æ˜¯ä¸ºäº†çœ‹æŸ¥è¯¢äº†å¤šå°‘æ¬¡ï¼Œæ¯æ¬¡æŸ¥è¯¢äº†å¤šå°‘å—ï¼Œä»¥åˆ¤æ–­éšæœºè¯»å†™å¤šè¿˜æ˜¯é¡ºåºè¯»å†™å¤šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1590717191,"ip_address":"","comment_id":219157,"utype":1}],"discussion_count":5,"race_medal":0,"score":"10179891723","product_id":100042501,"comment_content":"bi æ˜¯æŒ‡æ¯ç§’è¯»ç£ç›˜çš„å—æ•°ã€‚æ‰€ä»¥è¦å…ˆçœ‹ä¸€ä¸‹ï¼Œä¸€å—æœ‰å¤šå¤§ã€‚<br><br>[root@7dgroup1 ~]# tune2fs -l &#47;dev&#47;vda1 | grep &quot;Block size&quot;<br>Block size:               4096<br>[root@7dgroup1 ~]#<br><br>(300000âˆ—1024)&#47;1024&#47;1024â‰ˆ293M<br><br>=====================================================<br>=====================================================<br>ä¸Šé¢ä¸ºåŸæ–‡<br><br>é—®é¢˜ä¸€ï¼š<br>è€å¸ˆï¼Œè¿™é‡Œæ˜¯ä¸æ˜¯æœ‰é—®é¢˜ï¼Ÿ<br>biè¡¨ç¤ºä»å—è®¾å¤‡è¯»å…¥æ•°æ®çš„æ€»é‡ï¼ˆå³è¯»ç£ç›˜ï¼‰ï¼ˆkb&#47;sï¼‰ï¼Œè€Œä¸æ˜¯æ¯ç§’è¯»ç£ç›˜çš„å—æ•°<br>å…¶å®ï¼Œè¿™æ ·ç®—å°±å¯ä»¥äº†ï¼š300000&#47;1024â‰ˆ293M<br><br><br>é—®é¢˜äºŒï¼šæŸ¥è¯¢Block sizeçš„ç›®çš„æ˜¯ï¼Ÿæˆ‘çœ‹è¿™ä¸ª4096å’Œiostatå›¾ä¸­r&#47;såˆ—çš„å€¼å·®ä¸å¤šï¼Œ<br>è€Œr&#47;sè¡¨ç¤ºæ¯ç§’å®Œæˆè¯»IOè®¾å¤‡çš„æ¬¡æ•°","like_count":2,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495699,"discussion_content":"é—®é¢˜1ï¼Œ ä½ å¯ä»¥çœ‹ä¸€ä¸‹vmstatçš„å¸®åŠ©æ‰‹å†Œï¼Œé‡Œé¢æœ‰è¿™ä¹ˆä¸€å¥ã€‚\n bi: Blocks received from a block device (blocks/s).\næ‰€ä»¥è¿™ä¸ªæ˜¯å—ï¼Œè€Œä¸æ˜¯kbã€‚\né—®é¢˜2ï¼ŒæŸ¥block sizeå°±æ˜¯ä¸ºäº†çœ‹æŸ¥è¯¢äº†å¤šå°‘æ¬¡ï¼Œæ¯æ¬¡æŸ¥è¯¢äº†å¤šå°‘å—ï¼Œä»¥åˆ¤æ–­éšæœºè¯»å†™å¤šè¿˜æ˜¯é¡ºåºè¯»å†™å¤šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590717191,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2058904,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJlkFFx4N8ice8UcQRu3AMP0QAXdib17lyFI8G6QLje9iaumOXhsNq50PyLowAwg0umho89o1amN2UGQ/132","nickname":"Geek_7cf52a","note":"","ucode":"C7A1D1CF429503","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":289909,"discussion_content":" è¿™é‡ŒæŒ‡çš„æ˜¯å—ã€‚ä½†æ˜¯è€å¸ˆè¿™æ ·ç®—ä¹Ÿé”™äº†å§ï¼Œä¸€å—æ˜¯4096byte,é‚£300000å—çš„å¤§å°åº”è¯¥æ˜¯300000*4096/1024/1024=1172M","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1594265552,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1163867,"avatar":"https://static001.geekbang.org/account/avatar/00/11/c2/5b/d49a5032.jpg","nickname":"å¤§ä¼ŸçœŸä¼Ÿå¤§","note":"","ucode":"94F250FB0AB935","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":370126,"discussion_content":"4096æ˜¯æ–‡ä»¶ç³»ç»Ÿçš„block sizeï¼Œè€Œé»˜è®¤çš„Linuxè®¡ç®—buffer cacheéƒ½æ˜¯è®¡ç®—block sizeä¸º1024çš„ï¼Œæ‰€ä»¥è¿™é‡Œè¦ä¹˜ä»¥1024è½¬æ¢ä¸ºå¤§å°ï¼Œå†é™¤ä»¥2ä¸ª1024ä»biteè½¬æ¢ä¸ºkbåå†è½¬æ¢æˆM","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619296261,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1133926,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4d/66/28742ad4.jpg","nickname":"æ°´æµ´æ¸…é£","note":"","ucode":"36EF5179E6F952","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288715,"discussion_content":"æŸ¥è¯¢å¤šæ¬¡ å¦‚ä½•èƒ½åˆ¤æ–­å‡ºæ˜¯éšæœºè¿˜æ˜¯é¡ºåºï¼Œé¡ºåºå†™æŸ¥è¯¢çš„æ¬¡æ•°å°‘ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593848263,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1942765,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/a4/ed/36fb05d1.jpg","nickname":"è·¯","note":"","ucode":"1C8E84C36040C3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":285551,"discussion_content":"ä¸ç”¨ä¹˜ä»¥4å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592877038,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":277307,"user_name":"Geek_6a9aeb","can_delete":false,"product_type":"c1","uid":2161228,"ip_address":"","ucode":"3CF1DDF2677FAC","user_header":"","comment_is_top":false,"comment_ctime":1612350732,"is_pvip":false,"replies":[{"id":"103273","content":"å—æ•°ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1616423371,"ip_address":"","comment_id":277307,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5907318028","product_id":100042501,"comment_content":"åŸæ–‡:è¿™ä¸ª bi æŒºé«˜ï¼Œèƒ½è¾¾åˆ° 30 ä¸‡ä»¥ä¸Šã€‚é‚£è¿™ä¸ªå€¼è¯´æ˜äº†ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬æ¥ç®—ä¸€ç®—ã€‚<br>bi æ˜¯æŒ‡æ¯ç§’è¯»ç£ç›˜çš„å—æ•°ã€‚ <br>-------------------------------------------<br>è€å¸ˆè¿™é‡Œï¼Œ30ä¸‡æ˜¯æŒ‡æœ‰30ä¸‡å—æ•°ï¼Œè¿˜æ˜¯30ä¸‡kbçš„æ•°æ®ï¼Œ å¦‚æœæ˜¯kbé‚£æ²¡æœ‰å¿…è¦æŸ¥ä¸€å—æ˜¯å¤šå¤§çš„å‘€ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514997,"discussion_content":"å—æ•°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616423371,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":210627,"user_name":"æœˆäº®å’Œå…­ä¾¿å£«","can_delete":false,"product_type":"c1","uid":1080894,"ip_address":"","ucode":"EFFCB9171D4B4E","user_header":"https://static001.geekbang.org/account/avatar/00/10/7e/3e/82202cc8.jpg","comment_is_top":false,"comment_ctime":1587799240,"is_pvip":false,"replies":[{"id":"82001","content":"è¿™è‚¯å®šæ˜¯åœ¨å‰–æä¸­å¯ä»¥çœ‹åˆ°çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1590754067,"ip_address":"","comment_id":210627,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5882766536","product_id":100042501,"comment_content":"è€å¸ˆå‡å¦‚ä¸€æ¡SQLè¯­å¥æ‰§è¡Œ100æ¯«ç§’ï¼Œæˆ‘ä»¬ä¸€èˆ¬è§‰å¾—éœ€è¦å»ä¼˜åŒ–SQLè¯­å¥ï¼Œä½†æ˜¯ä¹Ÿå¯èƒ½æ˜¯ç­‰åˆ°ç£ç›˜è¯»å–æ¶ˆè€—äº†å¤§éƒ¨åˆ†æ—¶é—´ï¼Œæˆ‘ä»¬å¦‚ä½•åŒºåˆ†è¿™ç§æƒ…å†µï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493070,"discussion_content":"è¿™è‚¯å®šæ˜¯åœ¨å‰–æä¸­å¯ä»¥çœ‹åˆ°çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590754067,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":202789,"user_name":"rainbowzhouj","can_delete":false,"product_type":"c1","uid":1786797,"ip_address":"","ucode":"F90723B1777EA4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Ce5DHQHpoeWBDMtibPAO9QKfRgRz9RvA3jgibMfJnyIXmOgZulVW02NYtn6ibF2fGNMQZ7z6LopHrknqB6MAzP1pw/132","comment_is_top":false,"comment_ctime":1586068992,"is_pvip":false,"replies":[{"id":"75859","content":"ç†è§£åˆç†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1586089741,"ip_address":"","comment_id":202789,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5881036288","product_id":100042501,"comment_content":"CPUçš„å¤„ç†é€Ÿåº¦ä¸ç£ç›˜çš„å¤„ç†é€Ÿåº¦ä¸åŒï¼ŒBufferèƒ½èµ·åˆ°åè°ƒå’Œç¼“å†²çš„ä½œç”¨ï¼Œå¢åŠ Bufferå¢åŠ äº†ç¼“å†²çš„ç©ºé—´ï¼Œæ•…ç£ç›˜I&#47;Oçš„å‹åŠ›å°±ä¼šå‡å°‘ã€‚","like_count":1,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490688,"discussion_content":"ç†è§£åˆç†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586089741,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":186990,"user_name":"ã€‚ã€‚ã€‚","can_delete":false,"product_type":"c1","uid":1803113,"ip_address":"","ucode":"F97D05D81A5803","user_header":"https://static001.geekbang.org/account/avatar/00/1b/83/69/a9201594.jpg","comment_is_top":false,"comment_ctime":1583984139,"is_pvip":false,"replies":[{"id":"72130","content":"åšæŒå­¦ä¹ æ˜¯å”¯ä¸€è¿›æ­¥çš„æ–¹å¼ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1583988584,"ip_address":"","comment_id":186990,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5878951435","product_id":100042501,"comment_content":"ç»§ç»­æ‰“å¡","like_count":1,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486947,"discussion_content":"åšæŒå­¦ä¹ æ˜¯å”¯ä¸€è¿›æ­¥çš„æ–¹å¼ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583988584,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":320054,"user_name":"BMB","can_delete":false,"product_type":"c1","uid":2556640,"ip_address":"","ucode":"91CC67459B6FBD","user_header":"https://static001.geekbang.org/account/avatar/00/27/02/e0/5e11188d.jpg","comment_is_top":false,"comment_ctime":1636070012,"is_pvip":false,"replies":[{"id":"116214","content":"ä»”ç»†çœ‹äº†ä¸€ä¸‹ï¼Œæ˜¯ç®—çš„ä¸å¯¹ã€‚è¿™é‡Œè¦ä¿®æ”¹ä¸€ä¸‹ã€‚å¤šè°¢ã€‚ ","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1636383175,"ip_address":"","comment_id":320054,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1636070012","product_id":100042501,"comment_content":"ä¸€å—æ˜¯4096ä¸ªå­—èŠ‚ï¼Œè¯»æ¯ç§’åˆ°äº†300000æ¬¡<br>ä¸ºå•¥æ˜¯ï¼š<br>ï¼ˆ300000*1024ï¼‰&#47;1024&#47;1024ï¼Ÿ<br>ä¸åº”è¯¥æ˜¯ï¼š<br>ï¼ˆ300000*4096ï¼‰&#47;1024ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529856,"discussion_content":"ä»”ç»†çœ‹äº†ä¸€ä¸‹ï¼Œæ˜¯ç®—çš„ä¸å¯¹ã€‚è¿™é‡Œè¦ä¿®æ”¹ä¸€ä¸‹ã€‚å¤šè°¢ã€‚ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636383175,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":320053,"user_name":"BMB","can_delete":false,"product_type":"c1","uid":2556640,"ip_address":"","ucode":"91CC67459B6FBD","user_header":"https://static001.geekbang.org/account/avatar/00/27/02/e0/5e11188d.jpg","comment_is_top":false,"comment_ctime":1636069697,"is_pvip":false,"replies":[{"id":"116215","content":"å·²ä¿®æ”¹ã€‚ ","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1636383184,"ip_address":"","comment_id":320053,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1636069697","product_id":100042501,"comment_content":"ç¡®å®æ²¡æœ‰çœ‹æ˜ç™½ï¼Œæ€ä¹ˆç­‰äº300Mçš„","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529855,"discussion_content":"å·²ä¿®æ”¹ã€‚ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636383184,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":277305,"user_name":"Geek_6a9aeb","can_delete":false,"product_type":"c1","uid":2161228,"ip_address":"","ucode":"3CF1DDF2677FAC","user_header":"","comment_is_top":false,"comment_ctime":1612350616,"is_pvip":false,"replies":[{"id":"103274","content":"æ˜¯çš„ï¼Œä¹‹å‰å¤ªå°ã€‚ ","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1616423403,"ip_address":"","comment_id":277305,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1612350616","product_id":100042501,"comment_content":"è€å¸ˆï¼Œçœ‹äº†ä¸€ä¸‹åˆå¤ªå›°æƒ‘äº†ï¼Œåé¢ä¸€ä¸‹å­å°±å†™åˆ°ä¼˜åŒ–çš„åŠ¨ä½œï¼Œçœ‹ shared_buffers æœ€åä¸€ä¸‹å­æ˜¯20g, æ²¡çœ‹åˆ°è°ƒä¼˜å‰è¿™äº›å€¼æ˜¯å¤šå¤§çš„ï¼Ÿ éš¾é“è°ƒä¼˜å‰æ˜¯ç‰¹åˆ«å°å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514995,"discussion_content":"æ˜¯çš„ï¼Œä¹‹å‰å¤ªå°ã€‚ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616423403,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":266376,"user_name":"David.cui","can_delete":false,"product_type":"c1","uid":1302228,"ip_address":"","ucode":"AB46F310403612","user_header":"https://static001.geekbang.org/account/avatar/00/13/de/d4/b83c4185.jpg","comment_is_top":false,"comment_ctime":1607318618,"is_pvip":false,"replies":[{"id":"96747","content":"é‚£è¦çœ‹ç›‘æ§æ•°æ®æ‰èƒ½åˆ†æäº†ã€‚ä½ å¯ä»¥è”ç³»æˆ‘å¾®ä¿¡ã€‚Zee_7D","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1607341728,"ip_address":"","comment_id":266376,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1607318618","product_id":100042501,"comment_content":"è€å¸ˆï¼Œæˆ‘é‡åˆ°ä¸€ä¸ªå›½äº§æ•°æ®åº“çš„çš„å‹æµ‹åœºæ™¯ã€‚æ•°æ®åº“+Loadrunnerã€‚loadrunnerå½•åˆ¶å¥½äº†è„šæœ¬ï¼Œé€šè¿‡å¢åŠ ç”¨æˆ·æ•°æ¥å¢åŠ å‹åŠ›ã€‚åˆšå¼€å§‹é€šè¿‡å¢åŠ ç”¨æˆ·æŠŠæ•°æ®åº“çš„CPUå‹æ»¡äº†ï¼ŒTPSè¿˜å¯ä»¥ã€‚<br>åæ¥æ•°æ®åº“åšäº†ä¸€ä¸ªè°ƒä¼˜ï¼ŒTPSä¸€ä¸‹å°±é«˜å‡ºæ¥å¾ˆå¤šï¼Œä½†æ˜¯CPUå†ä¹Ÿä¸Šä¸å»äº†ï¼ŒåŸºæœ¬ä¸Šå°±ç»´æŒåœ¨30-40%å·¦å³ã€‚æˆ‘æ€€ç–‘æ˜¯æ•°æ®åº“æµ‹ä½¿ç”¨äº†ç±»ä¼¼äºç»“æœé›†ç¼“å­˜çš„æŠ€æœ¯ï¼Œåªæ˜¯ç»™Loadrunnerè¿”å›ç»“æœï¼Œè‡³äºç»“æœçš„å‡†ç¡®æ€§å°±æ— ä»çŸ¥é“äº†ã€‚ä½†æ˜¯æ€ä¹ˆå»ç¡®è®¤å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511236,"discussion_content":"é‚£è¦çœ‹ç›‘æ§æ•°æ®æ‰èƒ½åˆ†æäº†ã€‚ä½ å¯ä»¥è”ç³»æˆ‘å¾®ä¿¡ã€‚Zee_7D","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607341728,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":202788,"user_name":"rainbowzhouj","can_delete":false,"product_type":"c1","uid":1786797,"ip_address":"","ucode":"F90723B1777EA4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Ce5DHQHpoeWBDMtibPAO9QKfRgRz9RvA3jgibMfJnyIXmOgZulVW02NYtn6ibF2fGNMQZ7z6LopHrknqB6MAzP1pw/132","comment_is_top":false,"comment_ctime":1586068951,"is_pvip":false,"replies":[{"id":"75860","content":"è¯·çœ‹å¦ä¸€ç•™è¨€ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1586089754,"ip_address":"","comment_id":202788,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1586068951","product_id":100042501,"comment_content":"ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆåŠ å¤§ Buffer å¯ä»¥å‡å°‘ç£ç›˜ I&#47;O çš„å‹åŠ›ï¼Ÿ<br>","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490687,"discussion_content":"è¯·çœ‹å¦ä¸€ç•™è¨€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586089754,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":202787,"user_name":"rainbowzhouj","can_delete":false,"product_type":"c1","uid":1786797,"ip_address":"","ucode":"F90723B1777EA4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Ce5DHQHpoeWBDMtibPAO9QKfRgRz9RvA3jgibMfJnyIXmOgZulVW02NYtn6ibF2fGNMQZ7z6LopHrknqB6MAzP1pw/132","comment_is_top":false,"comment_ctime":1586068876,"is_pvip":false,"replies":[{"id":"75861","content":"æ›´ä¸ºå…³é”®çš„æ˜¯å¯¹tpsçš„ç†è§£å’Œå¯¹ç³»ç»Ÿçš„æŠŠæ¡èƒ½åŠ›ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1586089780,"ip_address":"","comment_id":202787,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1586068876","product_id":100042501,"comment_content":"é«˜è€å¸ˆï¼Œæ‚¨å¥½ï¼Œä»¥ä¸‹æ˜¯æˆ‘å¯¹ä¸¤ä¸ªé—®é¢˜çš„æ€è€ƒï¼š<br><br>ç¬¬äºŒä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆè¯´ TPS è¶‹åŠ¿è¦åœ¨é¢„æœŸä¹‹å†…ï¼Ÿ<br>æ­¤é—®é¢˜ç±»æ¯”æµ‹è¯•äººå‘˜è®¾è®¡æµ‹è¯•ç”¨ä¾‹ï¼Œæ¯æ¡ç”¨ä¾‹ä½ è¦çŸ¥é“å®ƒå¯¹åº”çš„é¢„æœŸç»“æœæ˜¯ä»€ä¹ˆã€‚è‹¥æ‰§è¡Œåï¼Œé¢„æœŸç»“æœä¸å®é™…ç»“æœä¸€è‡´ï¼Œé‚£ä¹ˆå°±é€šè¿‡ï¼›åä¹‹ï¼Œå¼‚å¸¸åˆ™éœ€è¦æBugï¼Œåˆ†æå®šä½é—®é¢˜çš„åŸå› ï¼Œç„¶åè§£å†³ã€‚","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490686,"discussion_content":"æ›´ä¸ºå…³é”®çš„æ˜¯å¯¹tpsçš„ç†è§£å’Œå¯¹ç³»ç»Ÿçš„æŠŠæ¡èƒ½åŠ›ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586089780,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":194253,"user_name":"ä½ æ¯”æ˜¨å¤©å¿«ä¹ğŸŒ»","can_delete":false,"product_type":"c1","uid":1786677,"ip_address":"","ucode":"159FED712949CD","user_header":"https://static001.geekbang.org/account/avatar/00/1b/43/35/04f1ad16.jpg","comment_is_top":false,"comment_ctime":1585041995,"is_pvip":false,"replies":[{"id":"74058","content":"è¦çš„å°±æ˜¯è¿™ä»½éªšåŠ¨ã€‚ğŸ˜€ğŸ˜€","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1585061454,"ip_address":"","comment_id":194253,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1585041995","product_id":100042501,"comment_content":"é…£ç•…æ·‹æ¼“ï¼Œçœ‹å®Œäº†ï¼Œæœ‰ç§è·ƒè·ƒæ¬²è¯•çš„æ„Ÿè§‰ï¼Œéš¾é“æ˜¯å¹»æƒ³ï¼Œå“ˆå“ˆ","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488794,"discussion_content":"è¦çš„å°±æ˜¯è¿™ä»½éªšåŠ¨ã€‚ğŸ˜€ğŸ˜€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585061454,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":188222,"user_name":"kubxy","can_delete":false,"product_type":"c1","uid":1514411,"ip_address":"","ucode":"EDA317D303CC42","user_header":"https://static001.geekbang.org/account/avatar/00/17/1b/ab/a5f88914.jpg","comment_is_top":false,"comment_ctime":1584328750,"is_pvip":false,"replies":[{"id":"72711","content":"è¿™ä¸ªä¸æ˜¯30ä¸‡ä¸ªblockã€‚è€Œæ˜¯kBï¼Œä½ çœ‹ä¸Šé¢çš„æ ‡å¤´ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1584362010,"ip_address":"","comment_id":188222,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1584328750","product_id":100042501,"comment_content":"è€å¸ˆï¼Œåœ¨åˆ†æè¿‡ç¨‹ä¸­ï¼Œå¯¹æ•°æ®é‡çš„è®¡ç®—æ˜¯å¦ä¸å‡†ç¡®ï¼Ÿ<br>ç£ç›˜çš„å—å¤§å°ä¸º4096Bï¼Œé‚£ä¹ˆ30ä¸‡ä¸ªç£ç›˜å—çš„æ•°æ®é‡åº”è¯¥æ˜¯ï¼š<br>300,000 * 4096B &#47; 1024 &#47; 1024 = 1172M","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487357,"discussion_content":"è¿™ä¸ªä¸æ˜¯30ä¸‡ä¸ªblockã€‚è€Œæ˜¯kBï¼Œä½ çœ‹ä¸Šé¢çš„æ ‡å¤´ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584362010,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2058904,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJlkFFx4N8ice8UcQRu3AMP0QAXdib17lyFI8G6QLje9iaumOXhsNq50PyLowAwg0umho89o1amN2UGQ/132","nickname":"Geek_7cf52a","note":"","ucode":"C7A1D1CF429503","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":289911,"discussion_content":"è€å¸ˆä¹‹å‰çš„è¯„è®ºè¿˜è¯´æ˜¯å—ï¼Œæ€ä¹ˆåˆ°è¿™é‡Œåˆå˜æˆäº†kbäº†ï¼Œæˆ‘ä¹Ÿè§‰å¾—è¿™æ ·ç®—æ‰å¯¹ï¼Œ300,000 * 4096B / 1024 / 1024 = 1172M","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594265642,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1514411,"avatar":"https://static001.geekbang.org/account/avatar/00/17/1b/ab/a5f88914.jpg","nickname":"kubxy","note":"","ucode":"EDA317D303CC42","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":206426,"discussion_content":"bi: Blocks received from a block device (blocks/s).\næˆ‘è¿™é‡Œæåˆ°çš„biæ˜¯vmstatå‘½ä»¤ä¸­çš„è¾“å‡ºï¼Œæ‚¨åœ¨æ–‡ä¸­ç»™å‡ºçš„è®¡ç®—å…¬å¼æ˜¯ï¼š\nï¼ˆ300,000 * 1024ï¼‰ / 1024 / 1024 = 293M\nå…¶ä¸­ï¼Œä¸ºä»€ä¹ˆæ˜¯30ä¸‡ä¹˜ä»¥1024ï¼Ÿ\nç£ç›˜çš„å—å¤§å°ä¸º4096ï¼Œä¸æ˜¯åº”è¯¥ä¹˜ä»¥4096å—ï¼Ÿ\n\nvmstatçš„è¾“å‡ºæ˜¯å…¨å±€ç»Ÿè®¡å€¼ï¼Œå¦å¤–ï¼Œç£ç›˜æœ€å°çš„æ“ä½œå•ä½4Kï¼Œä¸è¶³4Kçš„æ–‡ä»¶ä¾ç„¶ä¼šæŒ‰4Kç®—ï¼Œå› æ­¤è¿™é‡Œè®¡ç®—å‡ºçš„åº”è¯¥æ˜¯ä¸€ä¸ªç†è®ºå€¼ï¼Œè€Œä¸æ˜¯å®é™…å€¼ã€‚æ‰€ä»¥å®ƒçš„è¾“å‡ºä¼šå’Œiostat/iotopæœ‰å·®è·ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584405122,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":184432,"user_name":"æœˆäº®å’Œå…­ä¾¿å£«","can_delete":false,"product_type":"c1","uid":1080894,"ip_address":"","ucode":"EFFCB9171D4B4E","user_header":"https://static001.geekbang.org/account/avatar/00/10/7e/3e/82202cc8.jpg","comment_is_top":false,"comment_ctime":1583313915,"is_pvip":false,"replies":[{"id":"71343","content":"ä½ è§‰å¾—å‹åŠ›ä¸å¤Ÿå°±å†åŠ å‹åŠ›çœ‹tpsèƒ½ä¸èƒ½å¢åŠ ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1583319962,"ip_address":"","comment_id":184432,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1583313915","product_id":100042501,"comment_content":"è€å¸ˆï¼Œ1jmeter  tpsæ˜¯150  2jmeter  tpsæ˜¯200èƒ½è¯´æ˜ä»€ä¹ˆï¼Ÿ åœ¨åœºæ™¯å¯¹æ¯”ä¸­å¢åŠ jmeteræ•°é‡æˆ‘æ€ä¹ˆè§‰å¾—æ˜¯å‹åŠ›ä¸å¤Ÿå‘¢ï¼Œæ€ä¹ˆèƒ½è¯´æ˜serverå“ªä¸ªèŠ‚ç‚¹æœ‰ç“¶é¢ˆ","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486012,"discussion_content":"ä½ è§‰å¾—å‹åŠ›ä¸å¤Ÿå°±å†åŠ å‹åŠ›çœ‹tpsèƒ½ä¸èƒ½å¢åŠ ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583319962,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":184312,"user_name":"Geek_65c0a2","can_delete":false,"product_type":"c1","uid":1785428,"ip_address":"","ucode":"3BA041930AAA78","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/ibaGFsFicWRKlUjhGsw4ibm9eGLQHrmlwxia1W28yqDUNbao2YD1icAQ07ux3mDZviaZACicsicoibrCndCV1kStN3PuPYw/132","comment_is_top":false,"comment_ctime":1583288086,"is_pvip":false,"replies":[{"id":"71330","content":"æ˜¯çš„ï¼Œiowaitåœ¨topä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œåªæ˜¯åœ¨è¿™ä¸ªä¾‹å­ä¸­æ²¡æœ‰ç”¨topè¿™ä¸ªå‘½ä»¤åˆ†æè€Œå·²ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1583310714,"ip_address":"","comment_id":184312,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1583288086","product_id":100042501,"comment_content":"åˆšå¼€å§‹åˆ†ææ—¶ä½¿ç”¨vmstatï¼Œå‘ç°bié«˜ã€‚<br>å¦‚æœè¿™æ—¶çœ‹topå‘½ä»¤çš„è¯ï¼Œiowaitåº”è¯¥ä¹Ÿé«˜å§ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485970,"discussion_content":"æ˜¯çš„ï¼Œiowaitåœ¨topä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œåªæ˜¯åœ¨è¿™ä¸ªä¾‹å­ä¸­æ²¡æœ‰ç”¨topè¿™ä¸ªå‘½ä»¤åˆ†æè€Œå·²ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583310714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}