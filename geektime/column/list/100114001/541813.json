{"id":541813,"title":"14 ï½œæ€§èƒ½ä¹‹é“ï¼šRocketMQä¸Kafkaé«˜æ€§èƒ½è®¾è®¡å¯¹æ¯”","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ä¸å¨ã€‚</p><p>RocketMQå’ŒKafkaæ˜¯å½“ä¸‹æœ€ä¸»æµçš„ä¸¤æ¬¾æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œæˆ‘ä»¬è¿™èŠ‚è¯¾å°±ä»æ–‡ä»¶å¸ƒå±€ã€æ•°æ®å†™å…¥æ–¹å¼ã€æ¶ˆæ¯å‘é€å®¢æˆ·ç«¯è¿™ä¸‰ä¸ªç»´åº¦å¯¹æ¯”ä¸€ä¸‹å®ç°kafkaå’ŒRocketMQçš„å·®å¼‚ï¼Œé€šè¿‡è¿™ç§æ–¹å¼å­¦ä¹ é«˜æ€§èƒ½ç¼–ç¨‹è®¾è®¡çš„ç›¸å…³çŸ¥è¯†ã€‚</p><h2>æ–‡ä»¶å¸ƒå±€</h2><p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸€ä¸‹Kafkaä¸RocketMQçš„æ–‡ä»¶å¸ƒå±€ã€‚</p><p>Kafka çš„æ–‡ä»¶å­˜å‚¨è®¾è®¡åœ¨å®è§‚ä¸Šçš„å¸ƒå±€å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/77/7e/77bd5812f5b3e056d407b38af75d197e.jpg?wh=1920x1026\" alt=\"å›¾ç‰‡\"></p><p>æˆ‘ä»¬è§£æä¸€ä¸‹å®ƒçš„ä¸»è¦ç‰¹å¾ã€‚</p><ul>\n<li>æ–‡ä»¶çš„ç»„ç»‡æ–¹å¼æ˜¯â€œ topic + åˆ†åŒºâ€ï¼Œæ¯ä¸€ä¸ª topic å¯ä»¥åˆ›å»ºå¤šä¸ªåˆ†åŒºï¼Œæ¯ä¸€ä¸ªåˆ†åŒºåŒ…å«å•ç‹¬çš„æ–‡ä»¶å¤¹ã€‚</li>\n<li>åˆ†åŒºæ”¯æŒå‰¯æœ¬æœºåˆ¶ï¼Œå³ä¸€ä¸ªåˆ†åŒºå¯ä»¥åœ¨å¤šå°æœºå™¨ä¸Šå¤åˆ¶æ•°æ®ã€‚topic ä¸­æ¯ä¸€ä¸ªåˆ†åŒºä¼šæœ‰ Leader ä¸ Followã€‚<strong>Kafkaçš„å†…éƒ¨æœºåˆ¶å¯ä»¥ä¿è¯ topic æŸä¸€ä¸ªåˆ†åŒºçš„ Leader ä¸Follow ä¸åœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œå¹¶ä¸”æ¯ä¸€å°Broker ä¼šå°½é‡å‡è¡¡åœ°æ‰¿æ‹…å„ä¸ªåˆ†åŒºçš„ Leadeã€‚</strong>å½“ç„¶ï¼Œåœ¨è¿è¡Œè¿‡ç¨‹ä¸­å¦‚æœLeaderä¸å‡è¡¡ï¼Œä¹Ÿå¯ä»¥æ‰§è¡Œå‘½ä»¤è¿›è¡Œæ‰‹åŠ¨å¹³è¡¡ã€‚</li>\n<li>Leader èŠ‚ç‚¹æ‰¿æ‹…ä¸€ä¸ªåˆ†åŒºçš„è¯»å†™ï¼ŒFollow èŠ‚ç‚¹åªè´Ÿè´£æ•°æ®å¤‡ä»½ã€‚</li>\n</ul><p>Kafka çš„è´Ÿè½½å‡è¡¡ä¸»è¦å–å†³äºåˆ†åŒº Leader èŠ‚ç‚¹çš„åˆ†å¸ƒæƒ…å†µã€‚åˆ†åŒºçš„ Leader èŠ‚ç‚¹è´Ÿè´£è¯»å†™ï¼Œè€Œä»èŠ‚ç‚¹è´Ÿè´£æ•°æ®åŒæ­¥ï¼Œå¦‚æœLeaderåˆ†åŒºæ‰€åœ¨çš„BrokerèŠ‚ç‚¹å®•æœºï¼Œä¼šè§¦å‘ä¸»ä»èŠ‚ç‚¹çš„åˆ‡æ¢ï¼Œåœ¨å‰©ä¸‹çš„ Follow èŠ‚ç‚¹ä¸­é€‰ä¸¾ä¸€ä¸ªæ–°çš„ Leader èŠ‚ç‚¹ã€‚è¿™æ—¶æ•°æ®çš„æµå…¥æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/09/e7/095318b1977c4a6139b0d82fbeafc8e7.jpg?wh=1592x709\" alt=\"å›¾ç‰‡\"></p><p>åˆ†åŒº Leader æ”¶åˆ°å®¢æˆ·ç«¯çš„æ¶ˆæ¯å‘é€è¯·æ±‚åï¼Œå¯ä»¥æœ‰ä¸¤ç§æ•°æ®è¿”å›ç­–ç•¥ã€‚ä¸€ç§æ˜¯å°†æ•°æ®å†™å…¥åˆ° Leader èŠ‚ç‚¹åå°±è¿”å›ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯ç­‰åˆ°å®ƒçš„ä»èŠ‚ç‚¹å…¨éƒ¨å†™å…¥å®Œæˆåå†è¿”å›ã€‚è¿™ä¸ªç­–ç•¥é€‰æ‹©éå¸¸å…³é”®ï¼Œä¼šç›´æ¥å½±å“æ¶ˆæ¯å‘é€ç«¯çš„æ—¶å»¶ï¼Œæ‰€ä»¥ Kafka æä¾›äº† ack è¿™ä¸ªå‚æ•°æ¥è¿›è¡Œç­–ç•¥é€‰æ‹©ï¼š</p><ul>\n<li>å½“ack = 0æ—¶ï¼Œä¸ç­‰Brokerç«¯ç¡®è®¤å°±ç›´æ¥è¿”å›ï¼Œå³å®¢æˆ·ç«¯å°†æ¶ˆæ¯å‘é€åˆ°ç½‘ç»œä¸­å°±è¿”å›â€œå‘é€æˆåŠŸâ€ï¼›</li>\n<li>å½“ack = 1æ—¶ï¼ŒLeader èŠ‚ç‚¹æ¥å—å¹¶å­˜å‚¨æ¶ˆæ¯åç«‹å³å‘å®¢æˆ·ç«¯è¿”å›â€œæˆåŠŸâ€ï¼›</li>\n<li>å½“ack = -1æ—¶ï¼ŒLeaderèŠ‚ç‚¹å’Œæ‰€æœ‰çš„FollowèŠ‚ç‚¹æ¥å—å¹¶æˆåŠŸå­˜å‚¨æ¶ˆæ¯ï¼Œå†å‘å®¢æˆ·ç«¯è¿”å›â€œæˆåŠŸâ€ã€‚</li>\n</ul><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹RocketMQ çš„æ–‡ä»¶å¸ƒå±€ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/9c/29/9c265dc5735c6fb6fd0c091c63341529.jpg?wh=1920x1027\" alt=\"å›¾ç‰‡\"></p><p>RocketMQ æ‰€æœ‰ä¸»é¢˜çš„æ¶ˆæ¯éƒ½ä¼šå†™å…¥åˆ° commitlog æ–‡ä»¶ä¸­ï¼Œç„¶ååŸºäº commitlog æ–‡ä»¶æ„å»ºæ¶ˆæ¯æ¶ˆè´¹é˜Ÿåˆ—æ–‡ä»¶ï¼ˆConsumequeueï¼‰ï¼Œæ¶ˆæ¯æ¶ˆè´¹é˜Ÿåˆ—çš„ç»„ç»‡ç»“æ„æŒ‰ç…§ /topic/{queue} æ¥ç»„ç»‡ã€‚ä»é›†ç¾¤çš„è§†è§’æ¥çœ‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/4c/7f/4c9d69883c7fb9af170f74bb8d5d537f.jpg?wh=1811x937\" alt=\"å›¾ç‰‡\"></p><p>RocketMQ é»˜è®¤é‡‡å–çš„æ˜¯ä¸»ä»åŒæ­¥æ¶æ„ï¼Œå³Master-Slaveæ–¹å¼ï¼Œå…¶ä¸­MasterèŠ‚ç‚¹è´Ÿè´£è¯»å†™ï¼ŒSlaveèŠ‚ç‚¹è´Ÿè´£æ•°æ®åŒæ­¥ä¸æ¶ˆè´¹ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒRocketMQ4.5å¼•å…¥äº†å¤šå‰¯æœ¬æœºåˆ¶ï¼ŒRocketMQçš„å‰¯æœ¬æœºåˆ¶ä¸kafkaçš„å¤šå‰¯æœ¬ä¸¤è€…ä¹‹é—´çš„ä¸åŒç‚¹æ˜¯RocketMQçš„å‰¯æœ¬ç»´åº¦æ˜¯Commitlogæ–‡ä»¶ï¼Œè€Œkafkaæ˜¯ä¸»é¢˜åˆ†åŒºçº§åˆ«ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹Kafkaå’ŒRocketMQåœ¨æ–‡ä»¶å¸ƒå±€ä¸Šçš„å¼‚åŒã€‚</p><p>Kafkaä¸­æ–‡ä»¶çš„å¸ƒå±€æ˜¯ä»¥ Topic/partitionä¸ºä¸» ï¼Œæ¯ä¸€ä¸ªåˆ†åŒºæ‹¥æœ‰ä¸€ä¸ªç‰©ç†æ–‡ä»¶å¤¹ï¼ŒKafkaåœ¨<strong>åˆ†åŒºçº§åˆ«å®ç°æ–‡ä»¶é¡ºåºå†™ã€‚</strong>å¦‚æœä¸€ä¸ªKafkaé›†ç¾¤ä¸­æœ‰æˆç™¾ä¸Šåƒä¸ªä¸»é¢˜ï¼Œæ¯ä¸€ä¸ªä¸»é¢˜åˆæœ‰ä¸Šç™¾ä¸ªåˆ†åŒºï¼Œæ¶ˆæ¯åœ¨é«˜å¹¶å‘å†™å…¥æ—¶ï¼ŒIOæ“ä½œå°±ä¼šæ˜¾å¾—å¾ˆé›¶æ•£ï¼Œæ•ˆæœç›¸å½“äºéšæœºIOã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>Kafka åœ¨æ¶ˆæ¯å†™å…¥æ—¶çš„IOæ€§èƒ½ï¼Œä¼šéšç€ topic ã€åˆ†åŒºæ•°é‡çš„å¢é•¿å…ˆä¸Šå‡ï¼Œåä¸‹é™</strong>ã€‚</p><p>è€Œ RocketMQ åœ¨æ¶ˆæ¯å†™å…¥æ—¶è¿½æ±‚æè‡´çš„é¡ºåºå†™ï¼Œæ‰€æœ‰çš„æ¶ˆæ¯ä¸åˆ†ä¸»é¢˜ä¸€å¾‹é¡ºåºå†™å…¥ commitlog æ–‡ä»¶ï¼Œ topic å’Œ åˆ†åŒºæ•°é‡çš„å¢åŠ ä¸ä¼šå½±å“å†™å…¥é¡ºåºã€‚</p><p><strong>æ ¹æ®æˆ‘çš„å®è·µç»éªŒï¼Œå½“ç£ç›˜æ˜¯SSDæ—¶ï¼Œé‡‡ç”¨åŒæ ·çš„é…ç½®ï¼ŒKafkaçš„ååé‡è¦è¶…è¿‡RocketMQï¼Œæˆ‘è®¤ä¸ºè¿™é‡Œçš„ä¸»è¦åŸå› æ˜¯å•æ–‡ä»¶é¡ºåºå†™å…¥å¾ˆéš¾å……åˆ†å‘æŒ¥ç£ç›˜IOçš„æ€§èƒ½ã€‚</strong></p><p>é™¤äº†åœ¨ç£ç›˜é¡ºåºå†™æ–¹é¢çš„å·®åˆ«ï¼ŒKafkaå’ŒRocketMQçš„è¿ç»´æˆæœ¬ä¹Ÿä¸åŒã€‚ç”±äºç²’åº¦çš„åŸå› ï¼ŒKafka çš„topicæ‰©å®¹åˆ†åŒºä¼šæ¶‰åŠåˆ†åŒºåœ¨å„ä¸ªBrokerçš„ç§»åŠ¨ï¼Œå®ƒçš„æ‰©å®¹æ“ä½œæ¯”è¾ƒé‡ã€‚è€ŒRocketMQ çš„æ•°æ®å­˜å‚¨ä¸»è¦åŸºäºcommitlogæ–‡ä»¶ï¼Œæ‰©å®¹æ—¶ä¸ä¼šäº§ç”Ÿæ•°æ®ç§»åŠ¨ï¼Œåªä¼šå¯¹æ–°çš„æ•°æ®äº§ç”Ÿå½±å“ã€‚å› æ­¤ï¼ŒRocketMQçš„è¿ç»´æˆæœ¬ç›¸å¯¹Kafkaæ›´ä½ã€‚</p><p>ä¸è¿‡ï¼ŒKafkaå’ŒRocketMQä¹Ÿæœ‰ä¸€äº›å…±åŒç‚¹ã€‚Kafkaçš„ackå‚æ•°å¯ä»¥ç±»æ¯”RocketMQçš„åŒæ­¥å¤åˆ¶ã€å¼‚æ­¥å¤åˆ¶ã€‚</p><ul>\n<li>Kafkaçš„â€œackå‚æ•°=1â€æ—¶ï¼Œå¯¹æ ‡RocketMQçš„å¼‚æ­¥å¤åˆ¶ï¼Œæœ‰æ•°æ®ä¸¢å¤±çš„é£é™©ï¼›</li>\n<li>kafkaçš„â€œackå‚æ•°=-1â€æ—¶ï¼Œå¯¹æ ‡RocketMQçš„åŒæ­¥å¤åˆ¶ï¼›</li>\n<li>Kafkaçš„â€œackå‚æ•°=0â€æ—¶ï¼Œå¯¹æ ‡RocketMQæ¶ˆæ¯å‘é€æ–¹å¼çš„ oneway æ¨¡å¼ï¼Œé€‚åˆæ—¥å¿—é‡‡é›†åœºæ™¯ã€‚</li>\n</ul><p>åœ¨ä¸šåŠ¡é¢†åŸŸé€šå¸¸æ˜¯ä¸å®¹è®¸æ•°æ®ä¸¢å¤±çš„ã€‚ä½†å¦‚æœè¿™äº›æ•°æ®å®¹æ˜“é‡æ¨ï¼Œå°±å¯ä»¥ä½¿ç”¨ack=1ï¼Œè€Œä¸ä½¿ç”¨ack=-1ï¼Œå› ä¸ºack=-1æ—¶çš„æ€§èƒ½è¾ƒä½ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨å…¬å¸å¼€å‘æ•°æ®åŒæ­¥ä¸­é—´ä»¶æ—¶ï¼Œéƒ½æ˜¯åŸºäºæ•°æ®åº“Binlogæ—¥å¿—åŒæ­¥åˆ°Esã€MySQLã€Oracleç­‰ç›®æ ‡ç«¯ï¼Œç”±äºåŒæ­¥ä»»åŠ¡æ”¯æŒå›æº¯ï¼Œæ•…é€šå¸¸å°†ackè®¾ç½®ä¸º1ã€‚</p><h2>æ•°æ®å†™å…¥æ–¹å¼</h2><p>èŠå®Œæ•°æ®æ–‡ä»¶å¸ƒå±€ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹Kafkaã€å’ŒRocketMQçš„æœåŠ¡ç«¯æ˜¯å¦‚ä½•å¤„ç†æ•°æ®å†™å…¥çš„ã€‚</p><p>æˆ‘ä»¬è¿˜æ˜¯å…ˆæ¥çœ‹Kafkaã€‚</p><p>KafkaæœåŠ¡ç«¯å¤„ç†æ¶ˆæ¯å†™å…¥çš„ä»£ç å®šä¹‰åœ¨MemoryRecordsçš„writeToæ–¹æ³•ä¸­ï¼Œå…·ä½“ä»£ç æˆªå›¾å¦‚ä¸‹ï¼ˆå…·ä½“æ˜¯è°ƒç”¨å…¥å£LogSegmentçš„appendæ–¹æ³•ï¼‰ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/42/3f/4273dc5c95f323c0e5d5db2e594b943f.png?wh=1632x932\" alt=\"å›¾ç‰‡\"></p><p>KafkaæœåŠ¡ç«¯å†™å…¥æ¶ˆæ¯æ—¶ï¼Œä¸»è¦æ˜¯è°ƒç”¨FileChannelçš„transferToæ–¹æ³•ï¼Œè¯¥æ–¹æ³•åº•å±‚ä½¿ç”¨äº†æ“ä½œç³»ç»Ÿçš„sendfileç³»ç»Ÿè°ƒç”¨ã€‚</p><p>è€ŒRocketMQçš„æ¶ˆæ¯å†™å…¥æ”¯æŒå†…å­˜æ˜ å°„ä¸FileChannelä¸¤ç§å†™å…¥æ–¹å¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/99/0e/9984b5e551aa6a186213aa3dcb36240e.jpg?wh=1920x952\" alt=\"å›¾ç‰‡\"></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå°†å‚æ•°tranisentStorePoolEnableè®¾ç½®ä¸ºfalseï¼Œé‚£å°±å…ˆå°†æ¶ˆæ¯å†™å…¥åˆ°é¡µç¼“å­˜ï¼Œç„¶åæ ¹æ®åˆ·ç›˜æœºåˆ¶æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­ã€‚å¦‚æœå°†å‚æ•°è®¾ç½®ä¸ºtrueï¼Œæ•°æ®ä¼šå…ˆå†™å…¥åˆ°å †å¤–å†…å­˜ï¼Œç„¶åæ‰¹é‡æäº¤åˆ°FileChannelï¼Œå¹¶æœ€ç»ˆæ ¹æ®åˆ·ç›˜ç­–ç•¥å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒRocketMQä¸Kafkaéƒ½æ”¯æŒé€šè¿‡FileChannelæ–¹å¼å†™å…¥ï¼Œä½†RocketMQåŸºäºFileChannelå†™å…¥æ—¶ï¼Œè°ƒç”¨çš„APIå¹¶ä¸æ˜¯transferToï¼Œè€Œæ˜¯å…ˆè°ƒç”¨writerï¼Œç„¶åå®šæ—¶flush åˆ·å†™åˆ°ç£ç›˜ï¼Œå…·ä½“è°ƒç”¨å…¥å£ä¸ºMappedFileã€‚ä»£ç æˆªå›¾å¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/70/d6/70a6ac8de5ab8dc626e13e6dc837bdd6.png?wh=1452x754\" alt=\"å›¾ç‰‡\"></p><p>ç›´æ¥è°ƒç”¨FileChannelçš„transferToæ–¹æ³•æ¯”writeæ–¹æ³•æ€§èƒ½æ›´ä¼˜ï¼Œå› ä¸ºtransferToåº•å±‚ä½¿ç”¨äº†æ“ä½œç³»ç»Ÿçš„sendfileç³»ç»Ÿè°ƒç”¨ï¼Œèƒ½å……åˆ†å‘æŒ¥å—è®¾å¤‡çš„ä¼˜åŠ¿ã€‚</p><p>æ ¹æ®æˆ‘çš„å®è·µç»éªŒï¼Œsendfile ç³»ç»Ÿè°ƒç”¨ç›¸æ¯”å†…å­˜æ˜ å°„å¤šäº†ä¸€ä¸ªä»ç”¨æˆ·ç¼“å­˜åŒºæ‹·è´åˆ°å†…æ ¸ç¼“å­˜åŒºçš„æ­¥éª¤ï¼Œä½†å½“å†…å­˜å†™å…¥è¶…è¿‡64Kæ—¶ï¼Œ sendfile çš„æ€§èƒ½å¾€å¾€æ›´é«˜ï¼Œæ•…Kafkaåœ¨æœåŠ¡ç«¯çš„å†™å…¥æ¯”RocketMQä¼šæœ‰æ›´å¥½çš„è¡¨ç°ã€‚</p><h2>æ¶ˆæ¯å‘é€</h2><p>æœ€åæˆ‘ä»¬å†ä»å®¢æˆ·ç«¯æ¶ˆæ¯å‘é€è¿™ä¸ªè§’åº¦çœ‹ä¸€ä¸‹ä¸¤æ¬¾ä¸­é—´ä»¶çš„å·®å¼‚ã€‚</p><p>Kafkaæ¶ˆæ¯å‘é€å®¢æˆ·ç«¯é‡‡ç”¨çš„æ˜¯åŒç«¯é˜Ÿåˆ—ï¼Œè¿˜å¼•å…¥äº†æ‰¹å¤„ç†æ€æƒ³ï¼Œå®ƒçš„æ¶ˆæ¯å‘é€æœºåˆ¶å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/8d/97/8d032bcc7cd9fd4e67383e81bc5d1597.jpg?wh=1647x708\" alt=\"å›¾ç‰‡\"></p><p>å½“å®¢æˆ·ç«¯æƒ³è¦è°ƒç”¨Kafkaçš„æ¶ˆæ¯å‘é€è€…å‘é€æ¶ˆæ¯æ—¶ï¼Œæ¶ˆæ¯ä¼šé¦–å…ˆå­˜å…¥åˆ°ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—ä¸­ï¼ŒåŒç«¯é˜Ÿåˆ—ä¸­å•ä¸ªå…ƒç´ ä¸º ProducerBatchï¼Œè¡¨ç¤ºä¸€ä¸ªå‘é€æ‰¹æ¬¡ï¼Œå…¶æœ€å¤§å€¼å—å‚æ•° batch.size æ§åˆ¶ï¼Œé»˜è®¤ä¸º 16Kã€‚</p><p>ç„¶åï¼ŒKafkaå®¢æˆ·ç«¯ä¼šå•ç‹¬å¼€ä¸€ä¸ª Send çº¿ç¨‹ï¼Œä»åŒç«¯é˜Ÿåˆ—ä¸­è·å–å‘é€æ‰¹æ¬¡ï¼Œå°†æ¶ˆæ¯æŒ‰æ‰¹å‘é€åˆ°Kafkaé›†ç¾¤ä¸­ã€‚Kafkaè¿˜å¼•å…¥äº†linger.mså‚æ•°æ¥æ§åˆ¶Sendçº¿ç¨‹çš„å‘é€è¡Œä¸ºï¼Œä»£è¡¨æ‰¹æ¬¡è¦åœ¨åŒç«¯é˜Ÿåˆ—ä¸­ç­‰å¾…çš„æœ€å°æ—¶é•¿ã€‚</p><p>å¦‚æœå°†linger.msè®¾ç½®ä¸º0ï¼Œè¡¨ç¤ºç«‹å³å‘é€æ¶ˆæ¯ï¼›å¦‚æœå°†å‚æ•°è®¾ç½®ä¸ºå¤§äº0ï¼Œé‚£ä¹ˆå‘é€çº¿ç¨‹åœ¨å‘é€æ¶ˆæ¯æ—¶åªä¼šä»åŒç«¯é˜Ÿåˆ—ä¸­è·å–ç­‰å¾…æ—¶é•¿å¤§äºè¯¥å€¼çš„æ‰¹æ¬¡ã€‚ <strong>æ³¨æ„ï¼Œlinger.ms å‚æ•°ä¼šå»¶é•¿å“åº”æ—¶é—´ï¼Œä½†æœ‰åˆ©äºå¢åŠ ååé‡ã€‚æœ‰ç‚¹ç±»ä¼¼äº TCP é¢†åŸŸçš„ Nagle ç®—æ³•</strong>ã€‚</p><p>Kafkaçš„æ¶ˆæ¯å‘é€ï¼Œåœ¨å†™å…¥ProducerBatchæ—¶ä¼šæŒ‰ç…§æ¶ˆæ¯å­˜å‚¨åè®®ç»„ç»‡æ•°æ®ï¼Œåœ¨æœåŠ¡ç«¯å¯ä»¥ç›´æ¥å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚</p><p>RocketMQçš„æ¶ˆæ¯å‘é€åœ¨å®¢æˆ·ç«¯ä¸»è¦æ˜¯æ ¹æ®è·¯ç”±é€‰æ‹©ç®—æ³•é€‰æ‹©ä¸€ä¸ªé˜Ÿåˆ—ï¼Œç„¶åå°†æ¶ˆæ¯å‘é€åˆ°æœåŠ¡ç«¯ã€‚æ¶ˆæ¯ä¼šåœ¨æœåŠ¡ç«¯æŒ‰ç…§æ¶ˆæ¯çš„å­˜å‚¨æ ¼å¼è¿›è¡Œç»„ç»‡ï¼Œç„¶åè¿›è¡ŒæŒä¹…åŒ–ç­‰æ“ä½œã€‚</p><p>Kafkaç›¸æ¯”RocketMQæœ‰ä¸€ä¸ªéå¸¸å¤§çš„ä¼˜åŠ¿ï¼Œé‚£å°±æ˜¯å®ƒçš„æ¶ˆæ¯æ ¼å¼æ˜¯åœ¨å®¢æˆ·ç«¯ç»„è£…çš„ï¼Œè¿™å°±èŠ‚çº¦äº† Brokerç«¯çš„CPUå‹åŠ›ï¼Œè¿™ä¸¤æ¬¾ä¸­é—´ä»¶åœ¨æ¶æ„æ–¹å¼ä¸Šçš„å·®å¼‚æœ‰ç‚¹ç±»ä¼¼ShardingJDBCä¸MyCatçš„åŒºåˆ«ã€‚</p><p>Kafkaåœ¨æ¶ˆæ¯å‘é€ç«¯çš„å¦å¤–ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯ï¼Œå¼•å…¥äº†åŒç«¯ç¼“å­˜é˜Ÿåˆ—ã€‚å¯ä»¥çœ‹å‡ºï¼ŒKafkaçš„è®¾è®¡å§‹ç»ˆåœ¨è¿½æ±‚æ‰¹å¤„ç†ï¼Œè¿™èƒ½å¤Ÿæé«˜æ¶ˆæ¯å‘é€çš„ååé‡ï¼Œä½†ä¸ä¹‹ç›¸å¯¹çš„é—®é¢˜æ˜¯ï¼Œæ¶ˆæ¯çš„å“åº”æ—¶é—´å»¶é•¿äº†ï¼Œæ¶ˆæ¯ä¸¢å¤±çš„å¯èƒ½æ€§ä¹ŸåŠ å¤§ï¼ˆå› ä¸ºKafkaè¿½åŠ åˆ°æ¶ˆæ¯ç¼“å­˜åä¼šè¿”å›â€œæˆåŠŸâ€ï¼Œä½†æ˜¯å¦‚æœæ¶ˆæ¯å‘é€æ–¹å¼‚å¸¸é€€å‡ºï¼Œä¼šå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼‰ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å°†Kafkaä¸­linger.ms=0çš„æƒ…å†µç±»æ¯”RocketMQæ¶ˆæ¯å‘é€çš„æ•ˆæœã€‚ä½†Kafkaé€šè¿‡è°ƒæ•´batch.sizeä¸linger.msä¸¤ä¸ªå‚æ•°æ¥é€‚åº”ä¸åŒåœºæ™¯ï¼Œè¿™ç§æ–¹å¼æ¯”RocketMQæ›´ä¸ºçµæ´»ã€‚ä¾‹å¦‚ï¼Œæ—¥å¿—é›†ç¾¤é€šå¸¸ä¼šè°ƒå¤§batch.sizeä¸linger.mså‚æ•°ï¼Œå……åˆ†å‘æŒ¥æ¶ˆæ¯æ‰¹é‡å‘é€å¸¦æ¥çš„ä¼˜åŠ¿ï¼Œæé«˜ååé‡ï¼›ä½†å¦‚æœæœ‰äº›åœºæ™¯å¯¹å“åº”æ—¶é—´æ¯”è¾ƒæ•æ„Ÿï¼Œå°±å¯ä»¥é€‚å½“è°ƒä½linger.msçš„å€¼ã€‚</p><h2>æ€»ç»“</h2><p>å¥½äº†ï¼Œè¿™èŠ‚è¯¾å°±è®²åˆ°è¿™é‡Œã€‚åˆšæ‰ï¼Œæˆ‘ä»¬ä»æ–‡ä»¶å¸ƒå±€ã€æœåŠ¡ç«¯æ•°æ®å†™å…¥æ–¹å¼ã€å®¢æˆ·ç«¯æ¶ˆæ¯å‘é€æ–¹å¼ä¸‰ä¸ªç»´åº¦ï¼Œå¯¹æ¯”äº†Kafkaå’ŒRocketMQå„è‡ªåœ¨è¿½æ±‚é«˜æ€§èƒ½æ—¶æ‰€é‡‡ç”¨çš„æŠ€æœ¯ã€‚ç»¼åˆå¯¹æ¯”æ¥çœ‹ï¼Œåœ¨åŒç­‰ç¡¬ä»¶é…ç½®ä¸€ä¸‹ï¼ŒKafkaçš„ç»¼åˆæ€§èƒ½è¦æ¯”RocketMQæ›´ä¸ºå¼ºåŠ²ã€‚</p><p>RocketMQå’ŒKafkaéƒ½ä½¿ç”¨äº†é¡ºåºå†™æœºåˆ¶ï¼Œä½†ç›¸æ¯”Kafkaï¼ŒRocketMQåœ¨æ¶ˆæ¯å†™å…¥æ—¶è¿½æ±‚æè‡´çš„é¡ºåºå†™ï¼Œä¼šåœ¨åŒä¸€æ—¶åˆ»å°†æ¶ˆæ¯å…¨éƒ¨å†™å…¥ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™æ˜¾ç„¶æ— æ³•å‹æ¦¨ç£ç›˜çš„æ€§èƒ½ã€‚è€ŒKafkaæ˜¯åˆ†åŒºçº§åˆ«é¡ºåºå†™ï¼Œåœ¨åˆ†åŒºæ•°é‡ä¸å¤šçš„æƒ…å†µä¸‹ï¼Œä»æ‰€æœ‰åˆ†åŒºçš„è§†è§’æ¥çœ‹æ˜¯éšæœºå†™ï¼Œä½†è¿™èƒ½é‡å¤å‘æŒ¥CPUçš„å¤šæ ¸ä¼˜åŠ¿ã€‚å› æ­¤ï¼Œåœ¨ç£ç›˜æ²¡æœ‰é‡åˆ°ç“¶é¢ˆæ—¶ï¼ŒKafkaçš„æ€§èƒ½è¦ä¼˜äºRocketMQã€‚</p><p>åŒæ—¶ï¼ŒKafkaåœ¨æœåŠ¡ç«¯å†™å…¥æ—¶ä½¿ç”¨äº†FileChannelçš„transferToæ–¹æ³•ï¼Œåº•å±‚ä½¿ç”¨sendfileç³»ç»Ÿè°ƒç”¨ï¼Œæ¯”æ™®é€šçš„FileChannelçš„writeæ–¹æ³•æ›´æœ‰ä¼˜åŠ¿ã€‚ç»“åˆå‹æµ‹æ•ˆæœæ¥çœ‹ï¼Œå¦‚æœå¾…å†™å…¥çš„æ¶ˆæ¯ä½“å¤§å°è¶…è¿‡64Kï¼Œä½¿ç”¨sendfileçš„å—å†™å…¥æ–¹å¼ç”šè‡³æ¯”å†…å­˜æ˜ å°„æ‹¥æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚</p><p>åœ¨æ¶ˆæ¯å‘é€æ–¹é¢ï¼ŒKafkaçš„å®¢æˆ·ç«¯åˆ™å……åˆ†åˆ©ç”¨äº†æ‰¹å¤„ç†æ€æƒ³ï¼Œæ¯”RocketMQæ‹¥æœ‰æ›´é«˜çš„ååç‡ã€‚</p><h2>è¯¾åé¢˜</h2><p>æœ€åï¼Œæˆ‘è¿˜æ˜¯ç»™ä½ ç•™ä¸€é“æ€è€ƒé¢˜ã€‚</p><p>é€šè¿‡äº†è§£RocketMQå’ŒKafkaçš„å®ç°æœºåˆ¶ï¼Œæˆ‘ä»¬çŸ¥é“RocketMQè¿˜æœ‰å¾ˆå¤§çš„è¿›æ­¥ç©ºé—´ã€‚ä½ è®¤ä¸ºåº”è¯¥å¦‚ä½•ä¼˜åŒ–RocketMQï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºä¸æˆ‘äº¤æµè®¨è®ºï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ï¼</p>","comments":[{"had_liked":false,"id":352892,"user_name":"Y a n g","can_delete":false,"product_type":"c1","uid":2106016,"ip_address":"ä¸Šæµ·","ucode":"A59C5958750550","user_header":"https://static001.geekbang.org/account/avatar/00/20/22/a0/d8631910.jpg","comment_is_top":false,"comment_ctime":1658996806,"is_pvip":false,"replies":[{"id":129403,"content":"æ€»ç»“çš„éå¸¸åˆ°ä½ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2348391,"ctime":1661574719,"ip_address":"ä¸Šæµ·","comment_id":352892,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100114001,"comment_content":"æ–‡ä»¶å¸ƒå±€ï¼šæ›´æ”¹commitlogå‰¯æœ¬ä¸ºåˆ†åŒºç»´åº¦,å……åˆ†åˆ©ç”¨ç£ç›˜æ€§èƒ½ã€‚\næ•°æ®å†™å…¥æ–¹å¼ï¼šFileChannelè°ƒç”¨transferToè€Œä¸æ˜¯wirteï¼Œå‘æŒ¥å—è®¾å¤‡ä¼˜åŠ¿\nå®¢æˆ·ç«¯æ¶ˆæ¯å‘é€ï¼šåŠ å…¥ç¼“å­˜é˜Ÿåˆ—ï¼Œå­˜å‚¨æ ¼å¼çš„æ•°æ®ç»„è£…æ”¾åœ¨å®¢æˆ·ç«¯ï¼Œå¼•å…¥æ‰¹å¤„ç†æ€æƒ³\n","like_count":2,"discussions":[{"author":{"id":2348391,"avatar":"https://static001.geekbang.org/account/avatar/00/23/d5/67/54efabd8.jpg","nickname":"ä¸­é—´ä»¶å…´è¶£åœˆ","note":"","ucode":"EFC2384D08600E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585449,"discussion_content":"æ€»ç»“çš„éå¸¸åˆ°ä½ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661574719,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":364511,"user_name":"xueerfei007","can_delete":false,"product_type":"c1","uid":1155062,"ip_address":"æµ™æ±Ÿ","ucode":"EF3FE821E5B54A","user_header":"https://static001.geekbang.org/account/avatar/00/11/9f/f6/7431e82e.jpg","comment_is_top":false,"comment_ctime":1671066214,"is_pvip":false,"replies":[{"id":134248,"content":"æ±‚çŸ¥æ¬²å¤ªå¼ºäº†ï¼Œæˆ‘ä»¬ä¸€èµ·åŠ æ²¹","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2348391,"ctime":1676475810,"ip_address":"ä¸Šæµ·","comment_id":364511,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100114001,"comment_content":"åˆæ¥å‚¬æ›´äº†","like_count":0,"discussions":[{"author":{"id":2348391,"avatar":"https://static001.geekbang.org/account/avatar/00/23/d5/67/54efabd8.jpg","nickname":"ä¸­é—´ä»¶å…´è¶£åœˆ","note":"","ucode":"EFC2384D08600E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":604908,"discussion_content":"æ±‚çŸ¥æ¬²å¤ªå¼ºäº†ï¼Œæˆ‘ä»¬ä¸€èµ·åŠ æ²¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1676475811,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":363469,"user_name":"åœ¨è·¯ä¸Š","can_delete":false,"product_type":"c1","uid":1205712,"ip_address":"åŒ—äº¬","ucode":"18337C6DD5E618","user_header":"https://static001.geekbang.org/account/avatar/00/12/65/d0/b5b00bc2.jpg","comment_is_top":false,"comment_ctime":1669711888,"is_pvip":false,"replies":[{"id":134277,"content":"æŠ±æ­‰ï¼Œkafkaçš„äº‹åŠ¡æ¶ˆæ¯æˆ‘è¿˜æ²¡æ·±å…¥ç ”ç©¶ï¼Œæ„Ÿè§‰å®ç°çš„éå¸¸å¤æ‚ï¼Œé‡Œé¢è¿˜æœ‰ç±»ä¼¼è¯»æœªæäº¤ç­‰ç±»ä¼¼mysqlé‚£ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚ä½†RocketMQçš„äº‹åŠ¡æ¶ˆæ¯ï¼Œæˆ‘æ¯”è¾ƒç†Ÿæ‚‰ï¼Œå»ºè®®çœ‹ä¸€ä¸‹æˆ‘å†™çš„æ–‡ç« ï¼šhttps:&#47;&#47;mp.weixin.qq.com&#47;s&#47;9sIjic10mTzdTLaAnd4ckA","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2348391,"ctime":1676562513,"ip_address":"ä¸Šæµ·","comment_id":363469,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100114001,"comment_content":"äº‹åŠ¡æ¶ˆæ¯æ–¹é¢ï¼Œè€å¸ˆå¯ä»¥è¡¥å……ä¸‹å—","like_count":0,"discussions":[{"author":{"id":2348391,"avatar":"https://static001.geekbang.org/account/avatar/00/23/d5/67/54efabd8.jpg","nickname":"ä¸­é—´ä»¶å…´è¶£åœˆ","note":"","ucode":"EFC2384D08600E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":605051,"discussion_content":"æŠ±æ­‰ï¼Œkafkaçš„äº‹åŠ¡æ¶ˆæ¯æˆ‘è¿˜æ²¡æ·±å…¥ç ”ç©¶ï¼Œæ„Ÿè§‰å®ç°çš„éå¸¸å¤æ‚ï¼Œé‡Œé¢è¿˜æœ‰ç±»ä¼¼è¯»æœªæäº¤ç­‰ç±»ä¼¼mysqlé‚£ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚ä½†RocketMQçš„äº‹åŠ¡æ¶ˆæ¯ï¼Œæˆ‘æ¯”è¾ƒç†Ÿæ‚‰ï¼Œå»ºè®®çœ‹ä¸€ä¸‹æˆ‘å†™çš„æ–‡ç« ï¼šhttps://mp.weixin.qq.com/s/9sIjic10mTzdTLaAnd4ckA","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1676562514,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353604,"user_name":"syz","can_delete":false,"product_type":"c1","uid":1174704,"ip_address":"ä¸Šæµ·","ucode":"54AF17ACD72645","user_header":"https://static001.geekbang.org/account/avatar/00/11/ec/b0/4e22819f.jpg","comment_is_top":false,"comment_ctime":1659597231,"is_pvip":false,"replies":[{"id":129397,"content":"ä½ å¥½ï¼Œè¿™ä¸ªé—®é¢˜æˆ‘æ— æ³•ç›´æ¥å›ç­”ä½ ï¼Œæˆ‘ç›®å‰çš„æ‰€æœ‰ç»éªŒéƒ½æ˜¯éƒ¨ç½²åœ¨centorsä¸­ã€‚ä½†æ—¢ç„¶å‘ç”Ÿäº†ï¼Œé‚£è¯´æ˜æŸä¸€ä¸ªç¯èŠ‚ä¸€å®šå­˜åœ¨é—®é¢˜ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬é¦–å…ˆè¦æ‹‰å–ç›¸å…³çš„æ—¥å¿—ã€‚\n\nrocketmqçš„æ—¥å¿—ï¼Œé»˜è®¤åœ¨ç”¨æˆ·çš„ä¸»ç›®å½•ä¸‹ã€‚{user_home}&#47;logs&#47;rocketmqlogsã€‚\n\nå¦‚æœæœ‰æ—¥å¿—ï¼Œéº»çƒ¦å‘æˆ‘ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ¢è®¨ä¸€ä¸‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2348391,"ctime":1661562779,"ip_address":"ä¸Šæµ·","comment_id":353604,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100114001,"comment_content":"è€å¸ˆæ±‚åŠ©ä¸ªé—®é¢˜ï¼Œ åœ¨window server 2012ä¸‹ä½¿ç”¨RocketMQï¼Œæ—¥å¿—æ¸…ç†æ—¶ä¼šå®•æœºå—ï¼Œè°¢è°¢\né—®é¢˜ï¼šå†å²é¡¹ç›®åœ¨winä¸‹è¿è¡Œï¼Œè¿è¡Œä¸€æ®µæ—¶é—´kafkaåæ—¥å¿—æ¸…ç†æ—¶å®•æœº\næ–¹æ¡ˆï¼šwinä¸­è£…centosã€ä½¿ç”¨ç½‘ä¸Škafkaè¡¥ä¸ç‰ˆæœ¬ã€æ¢RocketMQ\n","like_count":0,"discussions":[{"author":{"id":2348391,"avatar":"https://static001.geekbang.org/account/avatar/00/23/d5/67/54efabd8.jpg","nickname":"ä¸­é—´ä»¶å…´è¶£åœˆ","note":"","ucode":"EFC2384D08600E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585434,"discussion_content":"ä½ å¥½ï¼Œè¿™ä¸ªé—®é¢˜æˆ‘æ— æ³•ç›´æ¥å›ç­”ä½ ï¼Œæˆ‘ç›®å‰çš„æ‰€æœ‰ç»éªŒéƒ½æ˜¯éƒ¨ç½²åœ¨centorsä¸­ã€‚ä½†æ—¢ç„¶å‘ç”Ÿäº†ï¼Œé‚£è¯´æ˜æŸä¸€ä¸ªç¯èŠ‚ä¸€å®šå­˜åœ¨é—®é¢˜ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬é¦–å…ˆè¦æ‹‰å–ç›¸å…³çš„æ—¥å¿—ã€‚\n\nrocketmqçš„æ—¥å¿—ï¼Œé»˜è®¤åœ¨ç”¨æˆ·çš„ä¸»ç›®å½•ä¸‹ã€‚{user_home}/logs/rocketmqlogsã€‚\n\nå¦‚æœæœ‰æ—¥å¿—ï¼Œéº»çƒ¦å‘æˆ‘ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ¢è®¨ä¸€ä¸‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661562779,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":352299,"user_name":"éº»å©†è±†è…","can_delete":false,"product_type":"c1","uid":1731885,"ip_address":"ä¸Šæµ·","ucode":"F371FE05D081D6","user_header":"https://static001.geekbang.org/account/avatar/00/1a/6d/2d/de41f9cf.jpg","comment_is_top":false,"comment_ctime":1658526963,"is_pvip":false,"replies":[{"id":129411,"content":"å—¯ï¼Œå¯¹çš„ï¼Œæˆ‘ä¹Ÿæœ‰ä¸€ä¸ªæƒ³æ³•ï¼Œæˆ‘çš„æƒ³æ³•æ˜¯å¸Œæœ›å¯¹commitlogè¿›è¡Œåˆ†ç»„ï¼Œä¸åŒçš„åˆ†ç»„ï¼Œåœ°ä½å¹³ç­‰ï¼Œä¸€ä¸ªä¸»é¢˜ç”³è¯·åï¼Œå°±ä¼šå¯¹åº”ä¸€ä¸ªåˆ†ç»„ï¼Œè€Œä¸”ä¸å¯æ›´æ”¹ï¼Œè¿™æ ·å¯¹æ•´ä¸ªrockemqçš„å­˜å‚¨ä½“ç³»ä¸ä¼šæœ‰å¤§çš„æ”¹å˜ï¼Œåªéœ€è¦å¯¹å¤–é¢è¿›è¡ŒåŒ…ä¸€å±‚ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è°ƒæ•´åˆ†ç»„ï¼Œæ¥æé«˜commitlogçš„å¹¶å‘å†™å…¥ï¼Œé‡å¤å‘æŒ¥å‡ºç£ç›˜IOçš„ä¼˜åŠ¿ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2348391,"ctime":1661576224,"ip_address":"ä¸Šæµ·","comment_id":352299,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100114001,"comment_content":"é¦–å…ˆæ–‡ä»¶ç»„ç»‡æ–¹å¼å¯ä»¥è€ƒè™‘æ›´å¤šçš„åˆ©ç”¨ç£ç›˜çš„IOã€‚\næ•°æ®å†™å…¥é‡‡ç”¨é›¶æ‹·è´ã€‚\næ•°æ®å‘é€å¯ä»¥å®¢æˆ·ç«¯ç»„ç»‡æ•°æ®æ¥æé«˜ååã€‚","like_count":0,"discussions":[{"author":{"id":2348391,"avatar":"https://static001.geekbang.org/account/avatar/00/23/d5/67/54efabd8.jpg","nickname":"ä¸­é—´ä»¶å…´è¶£åœˆ","note":"","ucode":"EFC2384D08600E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585457,"discussion_content":"å—¯ï¼Œå¯¹çš„ï¼Œæˆ‘ä¹Ÿæœ‰ä¸€ä¸ªæƒ³æ³•ï¼Œæˆ‘çš„æƒ³æ³•æ˜¯å¸Œæœ›å¯¹commitlogè¿›è¡Œåˆ†ç»„ï¼Œä¸åŒçš„åˆ†ç»„ï¼Œåœ°ä½å¹³ç­‰ï¼Œä¸€ä¸ªä¸»é¢˜ç”³è¯·åï¼Œå°±ä¼šå¯¹åº”ä¸€ä¸ªåˆ†ç»„ï¼Œè€Œä¸”ä¸å¯æ›´æ”¹ï¼Œè¿™æ ·å¯¹æ•´ä¸ªrockemqçš„å­˜å‚¨ä½“ç³»ä¸ä¼šæœ‰å¤§çš„æ”¹å˜ï¼Œåªéœ€è¦å¯¹å¤–é¢è¿›è¡ŒåŒ…ä¸€å±‚ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è°ƒæ•´åˆ†ç»„ï¼Œæ¥æé«˜commitlogçš„å¹¶å‘å†™å…¥ï¼Œé‡å¤å‘æŒ¥å‡ºç£ç›˜IOçš„ä¼˜åŠ¿ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661576224,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1010192,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/6a/10/4d2d6e64.jpg","nickname":"åŠ³åŠ¨ç»´æƒ","note":"","ucode":"1D5CEB96618E01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2348391,"avatar":"https://static001.geekbang.org/account/avatar/00/23/d5/67/54efabd8.jpg","nickname":"ä¸­é—´ä»¶å…´è¶£åœˆ","note":"","ucode":"EFC2384D08600E","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":593923,"discussion_content":"rocketmqä¹‹æ‰€ä»¥åœ¨å‘é€æ¶ˆæ¯æ—¶é‡‡ç”¨sendfileæ˜¯å› ä¸ºsendfileéƒ½åœ¨å†…æ ¸æ€å®Œæˆäº†ï¼Œç”¨æˆ·æ€æ— æ³•å¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œè€Œrocketmqä¸­çš„å»¶è¿Ÿæ¶ˆæ¯ã€äº‹åŠ¡æ¶ˆæ¯çš„å¤„ç†éƒ½éœ€è¦åœ¨ç”¨æˆ·æ€å¤„ç†ï¼Œsendfileæ˜¾ç„¶æ²¡æœ‰æœºä¼šè®©åº”ç”¨è¿›ç¨‹æœ‰æœºä¼šå»å¤„ç†ï¼Œé™¤éè¿›è¡Œä¸€æ¬¡æ‹·è´","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1668657831,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":585457,"ip_address":"ä¸Šæµ·","group_id":0},"score":593923,"extra":""}]},{"author":{"id":1103091,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d4/f3/129d6dfe.jpg","nickname":"æäºŒæœ¨","note":"","ucode":"30E03BB84ADB27","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588675,"discussion_content":"ç£ç›˜çš„IOæ€ä¹ˆæ ·æ‰èƒ½å‘æŒ¥å‡ºæ¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663984775,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å››å·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":375321,"user_name":"èŠ‹å¤´","can_delete":false,"product_type":"c1","uid":1227492,"ip_address":"å¹¿ä¸œ","ucode":"A9C875548E4EE5","user_header":"https://static001.geekbang.org/account/avatar/00/12/ba/e4/6df89add.jpg","comment_is_top":false,"comment_ctime":1685334571,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100114001,"comment_content":"rocketmqå¦‚ä½•é€šè¿‡commitlogæ„å»ºé˜Ÿåˆ—æ–‡ä»¶çš„ï¼Ÿæœ¬æ–‡æ¼äº†å¯¹æ¯”æ¶ˆè´¹ç«¯çš„æƒ…å†µ","like_count":0}]}