{"id":384630,"title":"09ï½œå¼‚æ­¥å¤„ç†ï¼šå¦‚ä½•å‘æœåŠ¡å™¨ç«¯å‘é€è¯·æ±‚ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç‹æ²›ã€‚è¿™èŠ‚è¯¾æˆ‘ä»¬æ¥å­¦ä¹ å¦‚ä½•åœ¨ React Hooks ä¸­å¤„ç† Rest API è¯·æ±‚ã€‚</p><p>æˆ‘é‡åˆ°å¾ˆå¤š React çš„åˆå­¦è€…ï¼ŒåˆšæŠŠHello Worldè·‘èµ·æ¥ï¼Œé—®çš„ç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼šæˆ‘è¯¥æ€ä¹ˆå‘è¯·æ±‚æ‹¿æ•°æ®å‘¢ï¼Ÿ</p><p>å¯è§ï¼Œè¿™æ˜¯æœ€ä¸ºå¸¸è§ä¹Ÿæ˜¯æœ€ä¸ºé‡è¦çš„ä¸€ä¸ªéœ€æ±‚ã€‚æ¯•ç«Ÿ90%ä»¥ä¸Šçš„å‰ç«¯ App éƒ½æ˜¯å’ŒæœåŠ¡å™¨ç«¯æ‰“äº¤é“ï¼Œç„¶åé€šè¿‡å„ç§ API å®Œæˆå„ç§åŠŸèƒ½ã€‚</p><p><strong>è™½ç„¶å‘è¯·æ±‚æ‹¿æ•°æ®æœ‰å¾ˆå¤š<strong><strong>ç§</strong></strong>åšæ³•ï¼Œä½†åŸºæœ¬ä¸Šéƒ½ä¼šéµå¾ªä¸€å®šçš„è§„å¾‹</strong>ï¼Œè€Œè¿™æ­£æ˜¯å’±ä»¬è¿™èŠ‚è¯¾è¦ä»‹ç»çš„å†…å®¹ã€‚</p><p>å…¶å®åœ¨ç¬¬ä¸€è®²ï¼Œæˆ‘ä»¬å°±å·²ç»çœ‹åˆ°äº†å¼‚æ­¥è¯·æ±‚çš„ä¸€ä¸ªå®ä¾‹ï¼Œå½“æ—¶æˆ‘ä»¬åœ¨ä¸€ä¸ªç»„ä»¶å†…ç›´æ¥å‘èµ·äº†ä¸€ä¸ªè¯·æ±‚ï¼Œå¹¶å¤„ç†äº†è¿”å›ç»“æœã€‚ä½†è¿™ä¸ªç®€å•çš„ä¾‹å­åªæ˜¯æ¼”ç¤ºäº†ç»„ä»¶ä¸­å‘è¯·æ±‚çš„åŸºæœ¬æµç¨‹ï¼Œåœ¨å®é™…çš„é¡¹ç›®ä¸­æˆ‘ä»¬å¾ˆå°‘ä¼šç›´æ¥è¿™ä¹ˆå†™ï¼Œå› ä¸º<strong>è¿˜éœ€è¦è€ƒè™‘æ›´å¤šçš„é€»è¾‘</strong>ã€‚</p><p>æ¯”å¦‚è¯´ï¼Œå¦‚ä½•ç»™æ‰€æœ‰è¯·æ±‚éƒ½å¸¦ä¸Šä¸€ä¸ª Token ä¾›æœåŠ¡å™¨ç«¯éªŒè¯ï¼Ÿå¦‚ä½•å‘èµ·å¹¶å‘è¯·æ±‚ï¼Ÿç­‰ç­‰ã€‚æ­¤å¤–ï¼Œå’±ä»¬æ•´ä¸ªè¯¾ç¨‹éƒ½æ˜¯ä» Hooks è§’åº¦å»æ€è€ƒé—®é¢˜ï¼Œé‚£ä¹ˆ Hooks åˆèƒ½ç»™å¼‚æ­¥é€»è¾‘å¤„ç†å¸¦æ¥æ€æ ·çš„ä¼˜åŒ–ï¼Ÿè¿™äº›éƒ½æ˜¯æ¥ä¸‹æ¥è¦å…·ä½“ä»‹ç»çš„å†…å®¹ã€‚</p><h1>å®ç°è‡ªå·±çš„ API Client</h1><p>æ— è®ºå¤§å°é¡¹ç›®ï¼Œåœ¨å¼€å§‹å®ç°ç¬¬ä¸€ä¸ªè¯·æ±‚çš„æ—¶å€™ï¼Œé€šå¸¸æˆ‘ä»¬è¦åšçš„ç¬¬ä¸€ä»¶äº‹åº”è¯¥éƒ½æ˜¯<strong>åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„ API Clientï¼Œä¹‹åæ‰€æœ‰çš„è¯·æ±‚éƒ½<strong><strong>ä¼š</strong></strong>é€šè¿‡è¿™ä¸ª</strong> <strong>Client å‘å‡ºå»</strong>ã€‚è€Œä¸æ˜¯ä¸Šæ¥å°±ç”¨ fetch æˆ–è€…æ˜¯ <a href=\"https://github.com/axios/axios\">axios</a> å»ç›´æ¥å‘èµ·è¯·æ±‚ï¼Œå› ä¸ºé‚£ä¼šé€ æˆå¤§é‡çš„é‡å¤ä»£ç ã€‚</p><!-- [[[read_end]]] --><p>å®ç°è¿™æ ·ä¸€ä¸ª Client ä¹‹åï¼Œä½ å°±æœ‰äº†ä¸€ä¸ªç»Ÿä¸€çš„åœ°æ–¹ï¼Œå»å¯¹ä½ éœ€è¦è¿æ¥çš„æœåŠ¡ç«¯åšä¸€äº›é€šç”¨çš„é…ç½®å’Œå¤„ç†ï¼Œæ¯”å¦‚ Tokenã€URLã€é”™è¯¯å¤„ç†ç­‰ç­‰ã€‚</p><p>è¿™ä¸ªæ­¥éª¤å‘¢ï¼Œè™½ç„¶è·Ÿ React å’Œ Hooks æ²¡æœ‰ç›´æ¥çš„å…³ç³»ï¼Œä½†æ˜¯æˆ‘ç»å¸¸çœ‹åˆ°å¾ˆå¤šåŒå­¦æ˜¯åœ¨å¤šä¸ªç»„ä»¶å†…åˆ†åˆ«å®ç°äº†å¼‚æ­¥è¯·æ±‚å¤„ç†ï¼Œå†™äº†å¾ˆå¤šé‡å¤ä»£ç ä¹‹åï¼Œæ‰å¼€å§‹è€ƒè™‘æŠŠè¿™ä¸ªåŠŸèƒ½æå–å‡ºæ¥ï¼Œå¢åŠ äº†é¢å¤–å·¥ä½œé‡ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘å°±å…ˆç®€å•ä»‹ç»ä¸‹ï¼Œå®ç°è¿™æ ·ä¸€ä¸ª API Client éœ€è¦è€ƒè™‘å“ªäº›å› ç´ ã€‚</p><p>é€šå¸¸æ¥è¯´ï¼Œä¼šåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><ol>\n<li>ä¸€äº›é€šç”¨çš„ Headerã€‚æ¯”å¦‚ Authorization Tokenã€‚</li>\n<li>æœåŠ¡å™¨åœ°å€çš„é…ç½®ã€‚å‰ç«¯åœ¨å¼€å‘å’Œè¿è¡Œæ—¶å¯èƒ½ä¼šè¿æ¥ä¸åŒçš„æœåŠ¡å™¨ï¼Œæ¯”å¦‚æœ¬åœ°æœåŠ¡å™¨æˆ–è€…æµ‹è¯•æœåŠ¡å™¨ï¼Œæ­¤æ—¶è¿™ä¸ª API Client å†…éƒ¨å¯ä»¥æ ¹æ®å½“å‰ç¯å¢ƒåˆ¤æ–­è¯¥è¿æ¥å“ªä¸ª URLã€‚</li>\n<li>è¯·æ±‚æœªè®¤è¯çš„å¤„ç†ã€‚æ¯”å¦‚å¦‚æœ Token è¿‡æœŸäº†ï¼Œéœ€è¦æœ‰ä¸€ä¸ªç»Ÿä¸€çš„åœ°æ–¹è¿›è¡Œå¤„ç†ï¼Œè¿™æ—¶å°±ä¼šå¼¹å‡ºå¯¹è¯æ¡†æç¤ºç”¨æˆ·é‡æ–°ç™»å½•ã€‚</li>\n</ol><p>ä»æˆ‘çš„ç»éªŒæ¥çœ‹ï¼Œæˆ‘æ›´æ¨èæŠŠ axios ä½œä¸ºåŸºç¡€æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚åŸå› å°±åœ¨äºï¼Œaxios æ¯”èµ· fetchï¼Œæä¾›äº†æ›´ä¸ºæ–¹ä¾¿ï¼Œä¹Ÿæ›´åŠ è¯­ä¹‰åŒ–çš„ APIï¼Œæ¯”å¦‚è¯·æ±‚æ‹¦æˆªã€‚æ­¤å¤–ï¼Œè¿˜å¾ˆå®¹æ˜“åˆ›å»ºå¤šä¸ªå®ä¾‹ï¼Œè®©ä»£ç é€»è¾‘æ›´ç®€æ´ã€‚æ‰€ä»¥æˆ‘å°±ä»¥ axios ä¸ºä¾‹ï¼Œæä¾›ä¸€ä¸ªç¤ºä¾‹å®ç°ï¼š</p><pre><code>import axios from &quot;axios&quot;;\n\n// å®šä¹‰ç›¸å…³çš„ endpoint\nconst endPoints = {\n  test: &quot;https://60b2643d62ab150017ae21de.mockapi.io/&quot;,\n  prod: &quot;https://prod.myapi.io/&quot;,\n  staging: &quot;https://staging.myapi.io/&quot;\n};\n\n// åˆ›å»º axios çš„å®ä¾‹\nconst instance = axios.create({\n  // å®é™…é¡¹ç›®ä¸­æ ¹æ®å½“å‰ç¯å¢ƒè®¾ç½® baseURL\n  baseURL: endPoints.test,\n  timeout: 30000,\n  // ä¸ºæ‰€æœ‰è¯·æ±‚è®¾ç½®é€šç”¨çš„ header\n  headers: { Authorization: &quot;Bear mytoken&quot; }\n});\n\n// å¬è¿‡ axios å®šä¹‰æ‹¦æˆªå™¨é¢„å¤„ç†æ‰€æœ‰è¯·æ±‚\ninstance.interceptors.response.use(\n  (res) =&gt; {\n    // å¯ä»¥å‡å¦‚è¯·æ±‚æˆåŠŸçš„é€»è¾‘ï¼Œæ¯”å¦‚ log\n    return res;\n  },\n  (err) =&gt; {\n    if (err.response.status === 403) {\n      // ç»Ÿä¸€å¤„ç†æœªæˆæƒè¯·æ±‚ï¼Œè·³è½¬åˆ°ç™»å½•ç•Œé¢\n      document.location = '/login';\n    }\n    return Promise.reject(err);\n  }\n);\n\nexport default instance;\n</code></pre><p>è¿™æ ·æˆ‘ä»¬å°±å®šä¹‰äº†ä¸€ä¸ªç®€å•çš„ API Clientï¼Œä¹‹åæ‰€æœ‰çš„è¯·æ±‚éƒ½å¯ä»¥é€šè¿‡ Client è¿æ¥åˆ°æŒ‡å®šçš„æœåŠ¡å™¨ï¼Œä»è€Œä¸å†éœ€è¦å•ç‹¬è®¾ç½® Headerï¼Œæˆ–è€…å¤„ç†æœªæˆæƒçš„è¯·æ±‚äº†ã€‚å½“ç„¶ï¼Œè™½ç„¶ä¾‹å­ä¸­ç”¨çš„æ˜¯ axiosï¼Œä½†å¦‚æœä½ æ›´å€¾å‘äºåŸç”Ÿçš„ fetch APIï¼Œé‚£ä¹ˆä½¿ç”¨ fetch ä¹Ÿæ˜¯å®Œå…¨å¯ä»¥çš„ã€‚è¿™ä¸¤ç§æ–¹å¼æ²¡æœ‰ç»å¯¹çš„ä¼˜åŠ£ï¼Œä½ å¯ä»¥æŒ‰ç…§è‡ªå·±çš„å–œå¥½è¿›è¡Œé€‰æ‹©ã€‚</p><p>æœ‰äº†è¿™ä¸ª Clientï¼Œé‚£æ¥ä¸‹æ¥çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬éƒ½ä¼šä½¿ç”¨è¿™ä¸ª Client ï¼Œæ¥è¿æ¥æŒ‡å®šçš„ serverã€‚</p><h1>ä½¿ç”¨ Hooks æ€è€ƒå¼‚æ­¥è¯·æ±‚ï¼šå°è£…è¿œç¨‹èµ„æº</h1><p>åœ¨ç¬¬2è®²æˆ‘æ›¾ç»ä»‹ç»è¿‡ Hooks çš„ä¸€ä¸ªæœ¬è´¨ç‰¹æ€§ï¼Œé‚£å°±æ˜¯ä¸‡ç‰©çš†å¯é’©ï¼Œæ„æ€æ˜¯è¯´æˆ‘ä»¬å¯ä»¥æŠŠä»»ä½•ä¸€ä¸ªæ•°æ®æºå˜æˆ React ç»„ä»¶ä¸­å¯ä»¥ç»‘å®šçš„ä¸€ä¸ªæ•°æ®æºã€‚</p><p>è¿™ä¸ªç‰¹æ€§å¯¹äºè¿œç¨‹çš„ Get ç±»å‹çš„è¯·æ±‚éå¸¸æœ‰ç”¨ã€‚å› ä¸º Get è¯·æ±‚ï¼Œé€šå¸¸å°±æ˜¯ç”¨æ¥è·å–æ•°æ®çš„ã€‚æ‰€ä»¥ä» Hooks è§’åº¦æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºä¸€ä¸ª Get è¯·æ±‚å°±æ˜¯ä¸€ä¸ªè¿œç¨‹æ•°æ®æºã€‚é‚£ä¹ˆæŠŠè¿™ä¸ªæ•°æ®æºå°è£…æˆ Hooks åï¼Œä½¿ç”¨è¿œç¨‹ API å°†ä¼šéå¸¸æ–¹ä¾¿ã€‚</p><p>ä¸‹é¢è¿™å¼ å›¾å¯ä»¥æ¯”è¾ƒç›´è§‚åœ°æè¿°è¿™ç§æ¨¡å¼ã€‚å¯¹äºä¸€ä¸ª Get ç±»å‹çš„ APIï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥å°†å®ƒçœ‹æˆä¸€ä¸ªè¿œç¨‹çš„èµ„æºã€‚åªæ˜¯å’Œæœ¬åœ°æ•°æ®ä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œå®ƒæœ‰ä¸‰ä¸ªçŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ol>\n<li>Data: æŒ‡çš„æ˜¯è¯·æ±‚æˆåŠŸåæœåŠ¡å™¨è¿”å›çš„æ•°æ®ï¼›</li>\n<li>Error: è¯·æ±‚å¤±è´¥çš„è¯ï¼Œé”™è¯¯ä¿¡æ¯å°†æ”¾åˆ° Error çŠ¶æ€é‡Œï¼›</li>\n<li>Pending: è¯·æ±‚å‘å‡ºå»ï¼Œåœ¨è¿”å›ä¹‹å‰ä¼šå¤„äº Pending çŠ¶æ€ã€‚</li>\n</ol><p><img src=\"https://static001.geekbang.org/resource/image/22/28/225476cd373efff40fe11d796a1da228.png?wh=800x450\" alt=\"\"></p><p>æœ‰äº†è¿™ä¸‰ä¸ªçŠ¶æ€ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿåœ¨ UI ä¸Šå»æ˜¾ç¤º loadingï¼Œerror æˆ–è€…è·å–æˆåŠŸçš„æ•°æ®äº†ã€‚ä½¿ç”¨èµ·æ¥ä¼šéå¸¸æ–¹ä¾¿ã€‚</p><p>è¦å®ç°è¿™æ ·ä¸€ä¸ª Hook å…¶å®ä¹Ÿå¹¶ä¸éš¾ï¼Œæ¯”èµ·åœ¨ç»„ä»¶å†…éƒ¨ç›´æ¥å‘è¯·æ±‚ï¼Œæˆ‘ä»¬åªæ˜¯æŠŠä»£ç æ¢äº†ä¸ªåœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯å†™åˆ°äº† Hook é‡Œé¢ã€‚ä¸‹é¢æ˜¯ä»£ç çš„å®ç°ï¼š</p><pre><code>import { useState, useEffect } from &quot;react&quot;;\nimport apiClient from &quot;./apiClient&quot;;\n\n// å°†è·å–æ–‡ç« çš„ API å°è£…æˆä¸€ä¸ªè¿œç¨‹èµ„æº Hook\nconst useArticle = (id) =&gt; {\n  // è®¾ç½®ä¸‰ä¸ªçŠ¶æ€åˆ†åˆ«å­˜å‚¨ data, error, loading\n  const [data, setData] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  useEffect(() =&gt; {\n    // é‡æ–°è·å–æ•°æ®æ—¶é‡ç½®ä¸‰ä¸ªçŠ¶æ€\n    setLoading(true);\n    setData(null);\n    setError(null);\n    apiClient\n      .get(`/posts/${id}`)\n      .then((res) =&gt; {\n        // è¯·æ±‚æˆåŠŸæ—¶è®¾ç½®è¿”å›æ•°æ®åˆ°çŠ¶æ€\n        setLoading(false);\n        setData(res.data);\n      })\n      .catch((err) =&gt; {\n        // è¯·æ±‚å¤±è´¥æ—¶è®¾ç½®é”™è¯¯çŠ¶æ€\n        setLoading(false);\n        setError(err);\n      });\n  }, [id]); // å½“ id å˜åŒ–æ—¶é‡æ–°è·å–æ•°æ®\n\n  // å°†ä¸‰ä¸ªçŠ¶æ€ä½œä¸º Hook çš„è¿”å›å€¼\n  return {\n    loading,\n    error,\n    data\n  };\n};\n</code></pre><p>é‚£ä¹ˆè¦æ˜¾ç¤ºä¸€ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œä½ çš„è„‘å­é‡Œå°±ä¸å†æ˜¯ä¸€ä¸ªå…·ä½“çš„ API è°ƒç”¨ï¼Œè€Œå¯ä»¥æŠŠå®ƒçœ‹ä½œä¸€ä¸ªæ•°æ®ï¼Œåªä¸è¿‡æ˜¯ä¸ªè¿œç¨‹æ•°æ®ï¼Œäºæ˜¯å¾ˆè‡ªç„¶å°±æœ‰åŠ è½½çŠ¶æ€æˆ–è€…é”™è¯¯çŠ¶æ€è¿™äº›æ•°æ®äº†ã€‚ä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠç»„ä»¶çš„è¡¨ç°å±‚é€»è¾‘å†™å¾—éå¸¸ç®€æ´ï¼š</p><pre><code>import useArticle from &quot;./useArticle&quot;;\n\nconst ArticleView = ({ id }) =&gt; {\n  // å°† article çœ‹æˆä¸€ä¸ªè¿œç¨‹èµ„æºï¼Œæœ‰ data, loading, error ä¸‰ä¸ªçŠ¶æ€\n  const { data, loading, error } = useArticle(id);\n  if (error) return &quot;Failed.&quot;;\n  if (!data || loading) return &quot;Loading...&quot;;\n  return (\n    &lt;div className=&quot;exp-09-article-view&quot;&gt;\n      &lt;h1&gt;\n        {id}. {data.title}\n      &lt;/h1&gt;\n      &lt;p&gt;{data.content}&lt;/p&gt;\n    &lt;/div&gt;\n  );\n};\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œæœ‰äº†è¿™æ ·ä¸€ä¸ª Hookï¼ŒReact çš„å‡½æ•°ç»„ä»¶å‡ ä¹ä¸éœ€è¦æœ‰ä»»ä½•ä¸šåŠ¡çš„é€»è¾‘ï¼Œè€Œåªæ˜¯<strong>æŠŠæ•°æ®æ˜ å°„åˆ° JSXå¹¶æ˜¾ç¤ºå‡ºæ¥</strong>å°±å¯ä»¥äº†ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™éå¸¸æ–¹ä¾¿ã€‚</p><p>äº‹å®ä¸Šï¼Œåœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œå¯ä»¥æŠŠæ¯ä¸€ä¸ª Get è¯·æ±‚éƒ½åšæˆè¿™æ ·ä¸€ä¸ª Hookã€‚æ•°æ®è¯·æ±‚å’Œå¤„ç†é€»è¾‘éƒ½æ”¾åˆ° Hooks ä¸­ï¼Œä»è€Œå®ç° Model å’Œ View çš„éš”ç¦»ï¼Œä¸ä»…ä»£ç æ›´åŠ æ¨¡å—åŒ–ï¼Œè€Œä¸”æ›´æ˜“äºæµ‹è¯•å’Œç»´æŠ¤ã€‚</p><p>è¿™é‡Œæœ‰åŒå­¦å¯èƒ½ä¼šé—®ï¼Œä¸ºä»€ä¹ˆè¦ç»™æ¯ä¸ªè¯·æ±‚éƒ½å®šä¹‰ä¸€ä¸ª Hook å‘¢ï¼Ÿæˆ‘ä»¬ç›´æ¥æä¾›ä¸€ä¸ªé€šç”¨çš„ Hookï¼Œæ¯”å¦‚ useRemoteDataï¼Œç„¶åæŠŠ API åœ°å€ä¼ è¿›å»ï¼Œéš¾é“ä¸å¯ä»¥å—ï¼Ÿ</p><p>ä¸æ˜¯å®Œå…¨ä¸å¯ä»¥ï¼Œä½†è¿™å…¶å®æ˜¯<strong>ä¸ºäº†ä¿è¯æ¯ä¸ª Hook è‡ªèº«è¶³å¤Ÿç®€å•</strong>ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸ºäº†è®©æœåŠ¡å™¨çš„è¿”å›æ•°æ®æ»¡è¶³ UI ä¸Šçš„å±•ç°è¦æ±‚ï¼Œé€šå¸¸éœ€è¦è¿›ä¸€æ­¥å¤„ç†ã€‚è€Œè¿™ä¸ªå¯¹äºæ¯ä¸ªè¯·æ±‚çš„å¤„ç†é€»è¾‘å¯èƒ½éƒ½ä¸ä¸€æ ·ï¼Œé€šè¿‡ä¸€å®šçš„ä»£ç é‡å¤ï¼Œèƒ½å¤Ÿé¿å…äº§ç”Ÿå¤ªå¤æ‚çš„é€»è¾‘ã€‚</p><p>åŒæ—¶å‘¢ï¼ŒæŸä¸ªè¿œç¨‹èµ„æºæœ‰å¯èƒ½æ˜¯ç”±å¤šä¸ªè¯·æ±‚ç»„æˆçš„ï¼Œé‚£ä¹ˆ Hooks ä¸­çš„é€»è¾‘å°±ä¼šä¸ä¸€æ ·ï¼Œå› ä¸ºè¦åŒæ—¶å‘å‡ºå»å¤šä¸ªè¯·æ±‚ï¼Œç»„æˆ UI å±•ç°æ‰€éœ€è¦çš„æ•°æ®ã€‚æ‰€ä»¥ï¼Œå°†æ¯ä¸ª Get è¯·æ±‚éƒ½å°è£…æˆä¸€ä¸ª Hook ï¼Œä¹Ÿæ˜¯ä¸ºäº†è®©é€»è¾‘æ›´æ¸…æ¥šã€‚</p><p>å½“ç„¶ï¼Œè¿™ä¸ªæ¨¡å¼<strong>ä»…é€‚ç”¨äºGet è¯·æ±‚çš„é€»è¾‘</strong>ï¼Œå¯¹äºå…¶å®ƒç±»å‹ï¼Œæˆ‘åœ¨ç¬¬6è®²ä¸­æœ‰æåˆ°è¿‡ã€‚å½“æ—¶ä¸¾çš„ä¾‹å­æ˜¯ useAsync è¿™æ ·ä¸€ä¸ªè‡ªå®šä¹‰çš„ Hookï¼ŒåŒæ ·ä¹Ÿæ˜¯ç”¨ Hook çš„æ€æƒ³ï¼ŒæŠŠè¯·æ±‚çš„ä¸åŒçŠ¶æ€å°è£…æˆäº†ä¸€ä¸ªæ•°æ®æºä¾›ç»„ä»¶ä½¿ç”¨ã€‚</p><h1>å¤šä¸ª API è°ƒç”¨ï¼šå¦‚ä½•å¤„ç†å¹¶å‘æˆ–ä¸²è¡Œè¯·æ±‚ï¼Ÿ</h1><p>åœ¨åˆšæ‰è®²çš„æ–‡ç« æ˜¾ç¤ºçš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯ç®€å•æ˜¾ç¤ºäº†æ–‡ç« çš„å†…å®¹ï¼Œè¦çŸ¥é“ï¼Œå®é™…åœºæ™¯è‚¯å®šæ¯”è¿™ä¸ªæ›´å¤æ‚ã€‚æ¯”å¦‚ï¼Œè¿˜éœ€è¦æ˜¾ç¤ºä½œè€…ã€ä½œè€…å¤´åƒï¼Œä»¥åŠæ–‡ç« çš„è¯„è®ºåˆ—è¡¨ã€‚é‚£ä¹ˆï¼Œä½œä¸ºä¸€ä¸ªå®Œæ•´çš„é¡µé¢ï¼Œå°±éœ€è¦<strong>å‘é€ä¸‰ä¸ªè¯·æ±‚</strong>ï¼š</p><ol>\n<li>è·å–æ–‡ç« å†…å®¹ï¼›</li>\n<li>è·å–ä½œè€…ä¿¡æ¯ï¼ŒåŒ…æ‹¬åå­—å’Œå¤´åƒçš„åœ°å€ï¼›</li>\n<li>è·å–æ–‡ç« çš„è¯„è®ºåˆ—è¡¨ï¼›</li>\n</ol><p>è¿™ä¸‰ä¸ªè¯·æ±‚<strong>åŒæ—¶åŒ…å«äº†å¹¶å‘å’Œä¸²è¡Œçš„åœºæ™¯</strong>ï¼šæ–‡ç« å†…å®¹å’Œè¯„è®ºåˆ—è¡¨æ˜¯ä¸¤ä¸ªå¯ä»¥å¹¶å‘çš„è¯·æ±‚ï¼Œå®ƒä»¬éƒ½é€šè¿‡ Article ID æ¥è·å–ï¼›ç”¨æˆ·çš„ä¿¡æ¯éœ€è¦ç­‰æ–‡ç« å†…å®¹è¿”å›ï¼Œè¿™æ ·æ‰èƒ½çŸ¥é“ä½œè€…çš„ IDï¼Œä»è€Œæ ¹æ®ç”¨æˆ·çš„ ID è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸²è¡Œçš„åœºæ™¯ã€‚</p><p>å¦‚æœç”¨ä¼ ç»Ÿçš„æ€è·¯å»å®ç°ï¼Œå¯èƒ½ä¼šå†™ä¸‹è¿™æ ·ä¸€æ®µä»£ç ï¼Œæˆ–è€…ç±»ä¼¼çš„ä»£ç ï¼š</p><pre><code>// å¹¶å‘è·å–æ–‡ç« å’Œè¯„è®ºåˆ—è¡¨\nconst [article, comments] = await Promise.all([\n  fetchArticle(articleId),\n  fetchComments(articleId)\n]);\n// å¾—åˆ°æ–‡ç« ä¿¡æ¯åï¼Œé€šè¿‡ userId è·å–ç”¨æˆ·ä¿¡æ¯\nconst user = await fetchUser(article.userId);\n</code></pre><p>ä½†æ˜¯æˆ‘ä»¬çŸ¥é“ï¼Œ<strong>React å‡½æ•°ç»„ä»¶æ˜¯ä¸€ä¸ªåŒæ­¥çš„å‡½æ•°</strong>ï¼Œæ²¡æœ‰åŠæ³•ç›´æ¥ä½¿ç”¨ await è¿™æ ·çš„åŒæ­¥æ–¹æ³•ï¼Œè€Œæ˜¯<strong>è¦æŠŠè¯·æ±‚é€šè¿‡å‰¯ä½œç”¨å»è§¦å‘</strong>ã€‚å› æ­¤å¦‚æœæŒ‰ç…§ä¸Šé¢è¿™ç§ä¼ ç»Ÿçš„æ€ç»´ï¼Œæ˜¯å¾ˆéš¾æŠŠé€»è¾‘ç†é¡ºçš„ã€‚</p><p>è¿™æ—¶å€™æˆ‘ä»¬å°±è¦å›åˆ° React çš„æœ¬è´¨ï¼Œé‚£å°±æ˜¯çŠ¶æ€é©±åŠ¨ UIã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥<strong>ä»çŠ¶æ€å˜åŒ–çš„è§’åº¦å»ç»„ç»‡å¼‚æ­¥è°ƒç”¨</strong>ã€‚</p><p>å‡½æ•°ç»„ä»¶çš„æ¯ä¸€æ¬¡ renderï¼Œå…¶å®éƒ½æä¾›äº†æˆ‘ä»¬æ ¹æ®çŠ¶æ€å˜åŒ–æ‰§è¡Œä¸åŒæ“ä½œçš„æœºä¼šï¼Œæˆ‘ä»¬æ€è€ƒçš„è·¯å¾„ï¼Œå°±æ˜¯<strong>åˆ©ç”¨è¿™ä¸ªæœºåˆ¶ï¼Œé€šè¿‡ä¸åŒçš„çŠ¶æ€ç»„åˆï¼Œæ¥å®ç°å¼‚æ­¥è¯·æ±‚çš„é€»è¾‘</strong>ã€‚</p><p>é‚£ä¹ˆåˆšæ‰è¿™ä¸ªæ˜¾ç¤ºä½œè€…å’Œè¯„è®ºåˆ—è¡¨çš„ä¸šåŠ¡éœ€æ±‚ï¼Œä¸»è¦çš„å®ç°æ€è·¯å°±åŒ…æ‹¬ä¸‹é¢è¿™ä¹ˆå››ç‚¹ï¼š</p><ol>\n<li>ç»„ä»¶é¦–æ¬¡æ¸²æŸ“ï¼Œåªæœ‰æ–‡ç«  ID è¿™ä¸ªä¿¡æ¯ï¼Œäº§ç”Ÿä¸¤ä¸ªå‰¯ä½œç”¨å»è·å–æ–‡ç« å†…å®¹å’Œè¯„è®ºåˆ—è¡¨ï¼›</li>\n<li>ç»„ä»¶é¦–æ¬¡æ¸²æŸ“ï¼Œä½œè€… ID è¿˜ä¸å­˜åœ¨ï¼Œå› æ­¤ä¸å‘é€ä»»ä½•è¯·æ±‚ï¼›</li>\n<li>æ–‡ç« å†…å®¹è¯·æ±‚è¿”å›åï¼Œè·å¾—äº†ä½œè€… IDï¼Œç„¶åå‘é€è¯·æ±‚è·å–ç”¨æˆ·ä¿¡æ¯ï¼›</li>\n<li>å±•ç¤ºç”¨æˆ·ä¿¡æ¯ã€‚</li>\n</ol><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„ä»»ä½•ä¸€ä¸ªå‰¯ä½œç”¨ï¼Œä¹Ÿå°±æ˜¯<strong>å¼‚æ­¥è¯·æ±‚ï¼Œéƒ½æ˜¯åŸºäºæ•°æ®çš„çŠ¶æ€å»è¿›è¡Œçš„</strong>ã€‚åªæœ‰å½“æ–‡ç« çš„æ•°æ®è¿”å›ä¹‹åï¼Œæˆ‘ä»¬æ‰èƒ½å¾—åˆ°ä½œè€… IDï¼Œä»è€Œå†å‘é€å¦å¤–ä¸€ä¸ªè¯·æ±‚æ¥è·å–ä½œè€…ä¿¡æ¯ã€‚è¿™æ ·åŸºäºä¸€ä¸ªæ•°æ®çŠ¶æ€çš„å˜åŒ–ï¼Œæˆ‘ä»¬å°±å®ç°äº†ä¸²è¡Œå‘é€è¯·æ±‚è¿™ä¸ªåŠŸèƒ½ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨ä»£ç å±‚é¢ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å¯¹ useUser è¿™ä¸ª Hook åšä¸€ä¸ªæ”¹é€ ï¼Œä½¿å¾—å®ƒåœ¨æ²¡æœ‰ä¼ å…¥IDçš„æƒ…å†µä¸‹ï¼Œå°±ä¸å‘é€è¯·æ±‚ã€‚å¯¹æ¯”ä¸Šé¢çš„ useArticle è¿™ä¸ª Hookï¼Œå”¯ä¸€çš„å˜åŒ–å°±æ˜¯<strong>åœ¨ useEffect é‡ŒåŠ å…¥äº†<strong><strong>IDæ˜¯</strong></strong>å¦å­˜åœ¨çš„åˆ¤æ–­</strong>ï¼š</p><pre><code>import { useState, useEffect } from &quot;react&quot;;\nimport apiClient from &quot;./apiClient&quot;;\n\nexport default (id) =&gt; {\n  const [data, setData] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  useEffect(() =&gt; {\n    // å½“ id ä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å›ï¼Œä¸å‘é€è¯·æ±‚\n    if (!id) return;\n    setLoading(true);\n    setData(null);\n    setError(null);\n    apiClient\n      .get(`/users/${id}`)\n      .then((res) =&gt; {\n        setLoading(false);\n        setData(res.data);\n      })\n      .catch((err) =&gt; {\n        setLoading(false);\n        setError(err);\n      });\n  }, [id]);\n  return {\n    loading,\n    error,\n    data\n  };\n};\n\n</code></pre><p>é‚£ä¹ˆï¼Œåœ¨æ–‡ç« çš„å±•ç¤ºé¡µé¢ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç æ¥å®ç°ï¼š</p><pre><code>import { useState } from &quot;react&quot;;\nimport CommentList from &quot;./CommentList&quot;;\nimport useArticle from &quot;./useArticle&quot;;\nimport useUser from &quot;./useUser&quot;;\nimport useComments from &quot;./useComments&quot;;\n\nconst ArticleView = ({ id }) =&gt; {\n  const { data: article, loading, error } = useArticle(id);\n  const { data: comments } = useComments(id);\n  const { data: user } = useUser(article?.userId);\n  if (error) return &quot;Failed.&quot;;\n  if (!article || loading) return &quot;Loading...&quot;;\n  return (\n    &lt;div className=&quot;exp-09-article-view&quot;&gt;\n      &lt;h1&gt;\n        {id}. {article.title}\n      &lt;/h1&gt;\n      {user &amp;&amp; (\n        &lt;div className=&quot;user-info&quot;&gt;\n          &lt;img src={user.avatar} height=&quot;40px&quot; alt=&quot;user&quot; /&gt;\n          &lt;div&gt;{user.name}&lt;/div&gt;\n          &lt;div&gt;{article.createdAt}&lt;/div&gt;\n        &lt;/div&gt;\n      )}\n      &lt;p&gt;{article.content}&lt;/p&gt;\n      &lt;CommentList data={comments || []} /&gt;\n    &lt;/div&gt;\n  );\n};\n</code></pre><p>è¿™é‡Œï¼Œç»“åˆä»£ç æˆ‘ä»¬<strong>å†ç†ä¸€ä¸‹å…¶ä¸­å¹¶å‘å’Œä¸²è¡Œè¯·æ±‚çš„æ€</strong>è·¯ã€‚</p><p>å› ä¸ºæ–‡ç« çš„ ID å·²ç»ä¼ è¿›æ¥äº†ï¼Œå› æ­¤ useArticle å’Œ useComments è¿™ä¸¤ä¸ª Hooks ä¼šå‘å‡ºä¸¤ä¸ªå¹¶å‘çš„è¯·æ±‚ï¼Œæ¥åˆ†åˆ«è·å–ä¿¡æ¯ã€‚è€Œ userUser è¿™ä¸ª Hook åˆ™éœ€è¦ç­‰ article å†…å®¹è¿”å›åï¼Œæ‰èƒ½è·å¾— userId ä¿¡æ¯ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªä¸²è¡Œçš„è¯·æ±‚ï¼šéœ€è¦ç­‰æ–‡ç« å†…å®¹çš„è¯·æ±‚å®Œæˆä¹‹åæ‰èƒ½å‘èµ·ã€‚</p><p>é‚£ä¹ˆï¼Œæœ€ç»ˆå®Œæ•´çš„é¡µé¢æ˜¾ç¤ºçš„æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/c4/f5/c41951df887f8ef7b08066fcfde880f5.png?wh=1268x1164\" alt=\"\"></p><p>å®é™…çš„è¿è¡Œæ•ˆæœä½ ä¹Ÿå¯ä»¥é€šè¿‡æ–‡æœ«çš„ä»£ç é“¾æ¥æ¥æŸ¥çœ‹ã€‚</p><h1>å°ç»“</h1><p>åœ¨è¿™ä¸€è®²ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†æ€ä¹ˆä» Hooks çš„è§’åº¦å»ç»„ç»‡å¼‚æ­¥è¯·æ±‚ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬<strong>è¦å®šä¹‰ä¸€ä¸ªè‡ªå·±çš„ API Client</strong>ï¼Œå°è£…æ•´ä¸ªåº”ç”¨ä¸­å¼‚æ­¥è¯·æ±‚çš„ä¸€äº›é€šè¿‡è®¾ç½®ï¼Œä»¥åŠç»Ÿä¸€å¤„ç†ï¼Œæ–¹ä¾¿åœ¨ Hooks ä¸­ä½¿ç”¨ã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬éœ€è¦å……åˆ†åˆ©ç”¨ Hooks èƒ½è®©æ•°æ®æºå˜å¾—å¯ç»‘å®šçš„èƒ½åŠ›ï¼Œ<strong>è®©ä¸€ä¸ªè¿œç¨‹ API å¯¹åº”çš„æ•°æ®æˆä¸ºä¸€ä¸ªè¯­ä¹‰åŒ–çš„æ•°æ®æº</strong>ï¼Œæ—¢å¯ä»¥æŠŠä¸šåŠ¡é€»è¾‘å’ŒUI å±•ç°å¾ˆå¥½åœ°åˆ†å¼€ï¼Œä¹Ÿæœ‰åˆ©äºæµ‹è¯•å’Œç»´æŠ¤ã€‚</p><p>æœ€åå‘¢ï¼Œæˆ‘ä»¬å­¦ä¹ äº†é’ˆå¯¹å¤šè¯·æ±‚çš„å¤„ç†ï¼Œæ€ä¹ˆ<strong>åˆ©ç”¨çŠ¶æ€çš„ç»„åˆå˜åŒ–æ¥å®ç°å¹¶å‘å’Œä¸²è¡Œè¯·æ±‚</strong>ã€‚</p><p>å­¦åˆ°è¿™é‡Œï¼Œä½ ä¼šå‘ç°ï¼Œè¿™èŠ‚è¯¾çš„å†…å®¹å¯èƒ½å’Œä¼ ç»Ÿçš„æ€è€ƒæ–¹å¼æœ‰è¾ƒå¤§åŒºåˆ«ï¼Œæ‰€ä»¥ä½ ä¸€å®šè¦ç»“åˆè¯¾ç¨‹ä»£ç ï¼Œä»”ç»†æ€è€ƒå’Œä½“ä¼šï¼Œæ‰èƒ½å°†è¿™ç§æ€è€ƒæ–¹å¼ç†Ÿè®°äºå¿ƒï¼Œå¹¶ç†Ÿç»ƒè¿ç”¨åˆ°å®é™…çš„å¼€å‘å½“ä¸­ã€‚</p><p>è¯¾ç¨‹ä¸­çš„ä¾‹å­åœ°å€æ˜¯ï¼š<a href=\"https://codesandbox.io/s/react-hooks-course-20vzg\">https://codesandbox.io/s/react-hooks-course-20vzg</a>ã€‚ä½ å¯ä»¥åœ¨çº¿æŸ¥çœ‹ä»£ç å’Œè¿è¡Œæ•ˆæœã€‚</p><h1>æ€è€ƒé¢˜</h1><ol>\n<li>åœ¨è¯¾ç¨‹çš„ä¾‹å­ä¸­ï¼Œæ¯æ¬¡è°ƒç”¨ useArticle è¿™ä¸ª Hook çš„æ—¶å€™éƒ½ä¼šè§¦å‘å‰¯ä½œç”¨å»è·å–æ•°æ®ã€‚ä½†æ˜¯æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨æœ‰äº›ç»„ä»¶è‡ªåŠ¨è·å–ï¼Œä½†æœ‰çš„ç»„ä»¶ä¸­éœ€è¦ç‚¹å‡»æŸä¸ªæŒ‰é’®æ‰å»è·å–æ•°æ®ï¼Œé‚£ä¹ˆä½ ä¼šå¦‚ä½•è®¾è®¡è¿™ä¸ª Hookï¼Ÿï¼ˆå¯èƒ½è¿™é“é¢˜æœ‰ä¸€ç‚¹éš¾åº¦ã€‚ï¼‰</li>\n<li>è¯¾ç¨‹ä¸­çš„ Hook éƒ½æ˜¯ä½¿ç”¨çš„ useState ä¿å­˜äº†çŠ¶æ€æ•°æ®ï¼Œä¹Ÿå°±æ„å‘³ç€çŠ¶æ€çš„èŒƒå›´é™å®šåœ¨ç»„ä»¶å†…éƒ¨ï¼Œç»„ä»¶é”€æ¯åï¼Œæ•°æ®å°±æ²¡äº†ã€‚é‚£ä¹ˆå¦‚æœå¸Œæœ›æ•°æ®ç›´æ¥ç¼“å­˜åˆ°å…¨å±€çŠ¶æ€ï¼Œåº”è¯¥å¦‚ä½•åšå‘¢ï¼Ÿ</li>\n</ol><p>æ¬¢è¿æŠŠä½ çš„æ€è€ƒå’Œæƒ³æ³•åˆ†äº«åœ¨ç•™è¨€åŒºï¼Œæˆ‘ä¼šæŠŠå…¶ä¸­ä¸é”™çš„å›ç­”è¿›è¡Œç½®é¡¶ï¼Œä¾›åŒå­¦ä»¬äº¤æµè®¨è®ºã€‚æœŸå¾…ä½ çš„åˆ†äº«ï¼</p>","neighbors":{"left":{"article_title":"ç­”ç–‘è§£æƒ‘01ï½œå¦‚ä½•è½¬æ¢åº”ç”¨React Hooks çš„æ€è·¯ï¼Ÿ","id":384252},"right":{"article_title":"10ï½œå‡½æ•°ç»„ä»¶è®¾è®¡æ¨¡å¼ï¼šå¦‚ä½•åº”å¯¹å¤æ‚æ¡ä»¶æ¸²æŸ“åœºæ™¯ï¼Ÿ","id":385358}},"comments":[{"had_liked":false,"id":299639,"user_name":"çŸ¥è¡Œæ–¹","can_delete":false,"product_type":"c1","uid":1000353,"ip_address":"","ucode":"5828A930327E28","user_header":"https://static001.geekbang.org/account/avatar/00/0f/43/a1/abb7bfe3.jpg","comment_is_top":true,"comment_ctime":1624775592,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"9.2233720814292009e+18","product_id":100079901,"comment_content":"const useClick = (id) =&gt; {<br>    const [data, setData] = useState(null);<br>    const [loading, setLoading] = useState(null);<br>    const [error, setError] = useState(null);<br><br>    const exeFun = useCallback(() =&gt; {<br>        setLoading(true);<br>        setData(null);<br>        setError(null);<br>        apiClient<br>            .get(`&#47;posts&#47;${id}`)<br>            .then((res) =&gt; {<br>                setLoading(false)<br>                setData(res.data)<br>            })<br>            .catch((err) =&gt; {<br>                setLoading(false)<br>                setError(err);<br>            })<br>    }, []);<br><br>    return { exeFun, data, loading, error }<br>}<br><br>    const { exeFun, data:comm } = useClick(1);<br><br>&lt;button onClick={()=&gt;{exeFun(&quot;1&quot;)}}&gt;ç‚¹å‡»å‘é€è¯·æ±‚&lt;&#47;button&gt;<br>æŒ‰ç…§è€å¸ˆä¹‹å‰å†™çš„é€»è¾‘ï¼Œç”¨è¿™ç§æ–¹å¼ä¹Ÿå¯ä»¥ç‚¹å‡»æŒ‰é’®åå»å‘é€è¯·æ±‚è·å–æ•°æ®","like_count":10},{"had_liked":false,"id":297674,"user_name":"Isaac","can_delete":false,"product_type":"c1","uid":1110607,"ip_address":"","ucode":"038C349AB508AB","user_header":"https://static001.geekbang.org/account/avatar/00/10/f2/4f/59bd4141.jpg","comment_is_top":true,"comment_ctime":1623725478,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"9.2233720728381993e+18","product_id":100079901,"comment_content":"æ€è€ƒé¢˜ï¼š<br>1. useArticle Hook å¯ä»¥æä¾›ä¸€ä¸ªå‚æ•°ï¼Œç”¨æ¥æ ‡è®°æœ¬åœ°è°ƒç”¨æ˜¯å¦é»˜è®¤è§¦å‘å‰¯ä½œç”¨å»è·å–æ•°æ®ï¼›å¯¹äºç‚¹å‡»æŒ‰é’®æ‰è§¦å‘è¯·æ±‚çš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨ Hook ä¸­å°†è·å–æ•°æ®çš„æ–¹æ³• retrn å‡ºå»ï¼Œä¾›å¤–éƒ¨è‡ªç”±è°ƒç”¨ã€‚<br>2. å¯ä»¥å€ŸåŠ© reduxï¼Œé…åˆ useContext ç­‰ api ï¼Œå°†çŠ¶æ€æ•°æ®å­˜å‚¨è‡³å…¨å±€ä¸­ã€‚","like_count":8},{"had_liked":false,"id":298558,"user_name":"æ±Ÿè°¢æœ¨","can_delete":false,"product_type":"c1","uid":1563403,"ip_address":"","ucode":"E1B1B0F0F03D41","user_header":"https://static001.geekbang.org/account/avatar/00/17/db/0b/f0ded153.jpg","comment_is_top":false,"comment_ctime":1624194324,"is_pvip":false,"replies":[{"id":"108331","content":"è¿™æ˜¯æ–°çš„ js çš„æ ‡å‡† å«åš optional chainingï¼šhttps:&#47;&#47;github.com&#47;tc39&#47;proposal-optional-chaining ï¼Œç›®å‰å·²ç»åˆ° stage 4 å®ŒæˆçŠ¶æ€ã€‚<br>åœ¨å¤„ç† article å¯èƒ½æ˜¯ undefineçš„ çš„æƒ…å†µæ—¶ï¼Œä¸¤è€…æ˜¯ç­‰ä»·çš„ã€‚ä½†å¦‚æœ article è¿˜å¯èƒ½æ˜¯ 0ï¼Œfalseï¼Œnull è¿™æ ·çš„ falsy çš„å€¼æ—¶ï¼Œä¸¤è€…çš„è¿”å›å€¼ä¼šä¸ä¸€æ ·ã€‚article &amp;&amp; article.userId è¿”å› 0, false æˆ–è€… nullï¼Œè€Œ article?.userId è¿”å› undefinedã€‚<br><br>æ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ç”¨ ?. æ¥ç®€åŒ–ä¸€äº›æ¡ä»¶åˆ¤æ–­ã€‚","user_name":"ä½œè€…å›å¤","comment_id":298558,"uid":"1018676","ip_address":"","utype":1,"ctime":1624246606,"user_name_real":"Nate"}],"discussion_count":4,"race_medal":0,"score":"23099030804","product_id":100079901,"comment_content":"è€å¸ˆï¼Œarticle?.userIdå’Œarticle&amp;&amp;article.userIdçš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Ÿç¬¬ä¸€æ¬¡è§è¿™ç§å†™æ³•ï¼Œæ„Ÿè§‰å¥½ç®€æ´","like_count":5,"discussions":[{"author":{"id":1018676,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8b/34/61035278.jpg","nickname":"Nate","note":"","ucode":"844B4C20BB3D6E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522172,"discussion_content":"è¿™æ˜¯æ–°çš„ js çš„æ ‡å‡† å«åš optional chainingï¼šhttps://github.com/tc39/proposal-optional-chaining ï¼Œç›®å‰å·²ç»åˆ° stage 4 å®ŒæˆçŠ¶æ€ã€‚\nåœ¨å¤„ç† article å¯èƒ½æ˜¯ undefineçš„ çš„æƒ…å†µæ—¶ï¼Œä¸¤è€…æ˜¯ç­‰ä»·çš„ã€‚ä½†å¦‚æœ article è¿˜å¯èƒ½æ˜¯ 0ï¼Œfalseï¼Œnull è¿™æ ·çš„ falsy çš„å€¼æ—¶ï¼Œä¸¤è€…çš„è¿”å›å€¼ä¼šä¸ä¸€æ ·ã€‚article &amp;amp;&amp;amp; article.userId è¿”å› 0, false æˆ–è€… nullï¼Œè€Œ article?.userId è¿”å› undefinedã€‚\n\næ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ç”¨ ?. æ¥ç®€åŒ–ä¸€äº›æ¡ä»¶åˆ¤æ–­ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624246606,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1380860,"avatar":"https://static001.geekbang.org/account/avatar/00/15/11/fc/80256cc8.jpg","nickname":"å¿ƒè‹¥æ°´ï¼Œåˆ™é•¿å®‰","note":"","ucode":"4D7AE6552A65A4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386627,"discussion_content":"å¯é€‰é“¾ï¼Œè¿˜æœ‰??ï¼Œlet a = a?.b ?? &#39;123&#39;ï¼Œç”¨èµ·æ¥è´¼çˆ½ï¼Œå½“aæˆ–bä¸ºnullæˆ–è€…undefinedçš„æ—¶å€™ï¼Œä¼šè¿”å›??åé¢çš„å€¼ï¼Œå°‘å†™è®¸å¤šåˆ¤æ–­","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1627698996,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2632198,"avatar":"https://static001.geekbang.org/account/avatar/00/28/2a/06/da417908.jpg","nickname":"æ¸…é£æœˆæ˜","note":"","ucode":"54C98300A9F4DA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391331,"discussion_content":"çœ‹æ¥jsä¹ŸæŠŠtsçš„å¥½çš„ä¸œè¥¿ç»™å¸æ”¶è¿›æ¥äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630402648,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1563968,"avatar":"https://static001.geekbang.org/account/avatar/00/17/dd/40/7eca8b3d.jpg","nickname":"123231","note":"","ucode":"261F4048195F61","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":379907,"discussion_content":"ä¸€æ ·çš„å†™æ³•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624239621,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":297733,"user_name":"L","can_delete":false,"product_type":"c1","uid":1228268,"ip_address":"","ucode":"26BB686671F7D4","user_header":"https://static001.geekbang.org/account/avatar/00/12/bd/ec/cc7abf0b.jpg","comment_is_top":false,"comment_ctime":1623749600,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"18803618784","product_id":100079901,"comment_content":"1. hooksæä¾›ä¸€ä¸ªå‡½æ•°å‡ºæ¥ç”¨æ¥ä¸»åŠ¨è°ƒç”¨<br>2. reduxæˆ–è€…contextç­‰å†…å®¹ï¼Œå¯¹æ¥å£è°ƒç”¨è¿›è¡Œä¸€æ¬¡æ”¹é€ ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦æœ‰ç¼“å­˜ï¼Œå†æ¥å†³å®šæ˜¯å¦è°ƒç”¨æ¥å£","like_count":4},{"had_liked":false,"id":297989,"user_name":"ğŸŒµå°ç•…å™","can_delete":false,"product_type":"c1","uid":1921829,"ip_address":"","ucode":"049BA8404ADE96","user_header":"https://static001.geekbang.org/account/avatar/00/1d/53/25/30e025da.jpg","comment_is_top":false,"comment_ctime":1623861772,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14508763660","product_id":100079901,"comment_content":"è€å¸ˆï¼Œå¯¹äº loading å’Œé”™è¯¯å¤„ç†ï¼Œæˆ‘ä»¬é¡¹ç›®æ˜¯åœ¨å…¨å±€å¤„ç†çš„ï¼Œä¸” loading æ˜¯é€šè¿‡ redux ç®¡ç†çš„ï¼Œæƒ³å’¨è¯¢ä¸€ä¸‹ï¼Œè·Ÿæ‚¨çš„æ–¹æ³•ç›¸æ¯”ï¼Œåº”è¯¥ç”¨å“ªç§æ–¹æ³•å‘¢ï¼Ÿ","like_count":3},{"had_liked":false,"id":306030,"user_name":"èŠ±å„¿ä¸å°‘å¹´","can_delete":false,"product_type":"c1","uid":1046304,"ip_address":"","ucode":"E2D685737E4F1B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f7/20/e2dfa9c2.jpg","comment_is_top":false,"comment_ctime":1628307619,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10218242211","product_id":100079901,"comment_content":"è€å¸ˆèƒ½è®²è§£ä¸‹æ€è€ƒé¢˜å—","like_count":2},{"had_liked":false,"id":297759,"user_name":"Free fall","can_delete":false,"product_type":"c1","uid":2637054,"ip_address":"","ucode":"8DBF73CD0F423F","user_header":"","comment_is_top":false,"comment_ctime":1623764053,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10213698645","product_id":100079901,"comment_content":"const defaultResult = {<br>  error: null,<br>  data: null,<br>  loading: false,<br>}<br>const useArticle = ({ id, isAutoFetch = true }) =&gt; {<br>  const [result, setResult] = useState(defaultResult)<br><br>  const fetch = (id) =&gt; {<br>    apiClient<br>      .get(`&#47;posts&#47;${id}`)<br>      .then((res) =&gt; {<br>        setResult({ ...defaultResult, loading: false, data: res.data })<br>      })<br>      .catch((err) =&gt; {<br>        setResult({ ...defaultResult, loading: false, error: err })<br>      })<br>  }<br><br>  useEffect(() =&gt; {<br>    if (!id) return<br>    if (!isAutoFetch) return<br><br>    setResult({ ...defaultResult, loading: true })<br><br>    fetch(id)<br>  }, [id, isAutoFetch])<br><br>  return isAutoFetch ? result : { ...result, fetch }<br>}","like_count":2},{"had_liked":false,"id":298094,"user_name":"çªçª","can_delete":false,"product_type":"c1","uid":2462877,"ip_address":"","ucode":"FBD4EBA6ADB80C","user_header":"https://static001.geekbang.org/account/avatar/00/25/94/9d/0d8103ad.jpg","comment_is_top":false,"comment_ctime":1623909871,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5918877167","product_id":100079901,"comment_content":"è€å¸ˆï¼Œè¯·é—®éœ€è¦å°è£…ä¸€ä¸ªéœ€è¦å‘é€postè¯·æ±‚çš„è‡ªå®šä¹‰hooksåº”è¯¥å¦‚ä½•å°è£…å‘¢ï¼Ÿ","like_count":1},{"had_liked":false,"id":357366,"user_name":"tron","can_delete":false,"product_type":"c1","uid":1624821,"ip_address":"æµ™æ±Ÿ","ucode":"F94DB2BE804998","user_header":"https://static001.geekbang.org/account/avatar/00/18/ca/f5/3f95bf91.jpg","comment_is_top":false,"comment_ctime":1663205580,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1663205580","product_id":100079901,"comment_content":"çœ‹å®Œè¿™ä¸ªå¼‚æ­¥ä¸²è”çš„å¤šè¯·æ±‚ åªæƒ³è¯´ï¼šreact HooksçœŸæ¸…çˆ½ è€å¸ˆè®²çš„çœŸæ£’~","like_count":0},{"had_liked":false,"id":354935,"user_name":"Jeffrey Ma","can_delete":false,"product_type":"c1","uid":1374957,"ip_address":"å››å·","ucode":"0C5E2AB51E6A83","user_header":"https://static001.geekbang.org/account/avatar/00/14/fa/ed/0742b854.jpg","comment_is_top":false,"comment_ctime":1660894484,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1660894484","product_id":100079901,"comment_content":"1ã€å› ä¸º {excute, lodaing,error} = useAsync(()=&gt;promise),   è¿™é‡Œçš„excute å°±æ˜¯ç”¨æ¥æä¾›ç»™å¤–éƒ¨è§¦å‘çš„ï¼Œ æ‰€ä»¥ï¼Œåœ¨å°è£…ä¸šåŠ¡hook çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨å‰¯ä½œç”¨ useeffect (()=&gt; excute(),[])è°ƒç”¨ä¸€æ¬¡ã€‚ <br>å¦‚æœä¸éœ€è¦ï¼Œ å°±ç›´æ¥æŠŠexcute é€ä¼ å‡ºå»ã€‚<br>2ã€redux","like_count":0},{"had_liked":false,"id":337354,"user_name":"ä¸æƒ³è¯´ä»€ä¹ˆ","can_delete":false,"product_type":"c1","uid":1178833,"ip_address":"","ucode":"D6EC4588E8FC4A","user_header":"https://static001.geekbang.org/account/avatar/00/11/fc/d1/3aeba287.jpg","comment_is_top":false,"comment_ctime":1646788844,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646788844","product_id":100079901,"comment_content":"ä½¿ç”¨å¤šä¸ªhookè¯·æ±‚ä¼šé€ æˆç»„ä»¶å¤šæ¬¡æ¸²æŸ“å§ï¼Œå’Œåœ¨useEffectçš„<br>  useEffect(() =&gt; {<br>    const getData = async () =&gt; {<br>       &#47;&#47;è·å–apiæ•°æ®<br>       &#47;&#47; å¹¶å‘è·å–æ–‡ç« å’Œè¯„è®ºåˆ—è¡¨const [article, comments] = await Promise.all([ f <br>            etchArticle(articleId), fetchComments(articleId)]);&#47;&#47; å¾—åˆ°æ–‡ç« ä¿¡æ¯åï¼Œé€šè¿‡ userId è·å–ç”¨æˆ·ä¿¡æ¯<br>            const user = await fetchUser(article.userId);<br>           setUser(user);<br>           setComments(comments)<br>    }<br><br>    getData();<br>  }, [])<br><br>è¿™ä¸¤ç§æ–¹å¼çš„é‚£ä¸ªæ›´é€‚åˆä¸€ç‚¹","like_count":0},{"had_liked":false,"id":337137,"user_name":"å˜¿å¼","can_delete":false,"product_type":"c1","uid":2257919,"ip_address":"","ucode":"7E4C69C4CE99D0","user_header":"https://static001.geekbang.org/account/avatar/00/22/73/ff/3e30f1c6.jpg","comment_is_top":false,"comment_ctime":1646643008,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646643008","product_id":100079901,"comment_content":"1111","like_count":0},{"had_liked":false,"id":337136,"user_name":"å˜¿å¼","can_delete":false,"product_type":"c1","uid":2257919,"ip_address":"","ucode":"7E4C69C4CE99D0","user_header":"https://static001.geekbang.org/account/avatar/00/22/73/ff/3e30f1c6.jpg","comment_is_top":false,"comment_ctime":1646642981,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646642981","product_id":100079901,"comment_content":"&lt;button&gt;ceshi&lt;&#47;button&gt;","like_count":0},{"had_liked":false,"id":337134,"user_name":"å˜¿å¼","can_delete":false,"product_type":"c1","uid":2257919,"ip_address":"","ucode":"7E4C69C4CE99D0","user_header":"https://static001.geekbang.org/account/avatar/00/22/73/ff/3e30f1c6.jpg","comment_is_top":false,"comment_ctime":1646642828,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646642828","product_id":100079901,"comment_content":"&lt;button&gt;ceshi&lt;&#47;button&gt;","like_count":0},{"had_liked":false,"id":323182,"user_name":"æ","can_delete":false,"product_type":"c1","uid":1018884,"ip_address":"","ucode":"1EBACEC0C03F93","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8c/04/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1637754007,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637754007","product_id":100079901,"comment_content":"è€å¸ˆï¼Œè¿™ç§é€»è¾‘ä¸Šè¿ç»­çš„æŸ¥è¯¢è¯·æ±‚æ”¾åˆ°å¥½å‡ ä¸ªhooksé‡Œå»ï¼Œç”±äºæ¯ä¸ªhookséƒ½æœ‰è‡ªå·±çš„loading stateçŠ¶æ€å˜åŒ–ï¼Œæ‰€ä»¥æœ€ç»ˆä¼šå¯¼è‡´é¡µé¢å‡½æ•°å¤šé‡å¤æ‰§è¡Œå‡ æ¬¡æ¸²æŸ“ï¼Œ è¿™ç®—è´Ÿä¼˜åŒ–å—","like_count":0},{"had_liked":false,"id":321273,"user_name":"ğŸ","can_delete":false,"product_type":"c1","uid":1054094,"ip_address":"","ucode":"DD325A4DD40153","user_header":"https://static001.geekbang.org/account/avatar/00/10/15/8e/8fc00a53.jpg","comment_is_top":false,"comment_ctime":1636731071,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1636731071","product_id":100079901,"comment_content":"è€å¸ˆï¼Œæˆ‘å‘ç°è¿™ç§ä½¿ç”¨æ–¹å¼ä¼šè§¦å‘ç»„ä»¶å¤šæ¬¡æ¸²æŸ“ï¼Œä¼šæ‰“å°å¥½å‡ æ¬¡articleï¼Œå¦‚æœæ˜¯å±•ç¤ºé‚£æ²¡æœ‰é—®é¢˜ï¼Œå¯å¦‚æœæ˜¯å–åˆ°æ•°æ®å¼¹çª—å±•ç¤ºçš„è¯å°±ä¼šå¼¹å¾ˆå¤šæ¬¡ï¼Œè¿™æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":311290,"user_name":"é™ˆæ¯«æ°","can_delete":false,"product_type":"c1","uid":2753360,"ip_address":"","ucode":"6D7804E60AB20E","user_header":"","comment_is_top":false,"comment_ctime":1631156785,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631156785","product_id":100079901,"comment_content":"æˆ‘è§‰å¾—å¯ä»¥ä¸ºuseArticleå¤šæ·»åŠ ä¸€ä¸ªä¾èµ–ï¼Œå½“éœ€è¦è‡ªåŠ¨è·å–æ—¶ï¼Œå°±åˆå§‹åŒ–ç»™è¯¥ä¾èµ–è®¾ç½®ç‰¹å®šå€¼ã€‚å½“éœ€è¦äº‹ä»¶è°ƒç”¨æ—¶ï¼Œé€šè¿‡useStateçš„æ§åˆ¶å™¨è®¾ç½®è¯¥ä¾èµ–ä¸ºç‰¹å®šå€¼ï¼Œå†å»è°ƒç”¨ã€‚","like_count":0},{"had_liked":false,"id":304612,"user_name":"1830","can_delete":false,"product_type":"c1","uid":1374337,"ip_address":"","ucode":"246FEF7C97F39C","user_header":"https://static001.geekbang.org/account/avatar/00/14/f8/81/bff52f91.jpg","comment_is_top":false,"comment_ctime":1627522622,"is_pvip":false,"replies":[{"id":"110258","content":"è¿™é‡Œå€’æ²¡æœ‰â€œå¼ºè¡Œâ€ï¼Œä¾‹å­ä¸­çš„ article å’Œ user æ˜¯ä¸¤ä¸ªä¸åŒçš„æ•°æ®æºï¼Œæ‰€ä»¥æ ¹æ®çŠ¶æ€åˆ†åˆ«è·å–åº”è¯¥æ¯”è¾ƒå®¹æ˜“ç†è§£ã€‚å¦‚æœä¸¤ä¸ªè¯·æ±‚æ€»æ˜¯åœ¨ä¸€èµ·ä½¿ç”¨ï¼Œé‚£ä¹ˆå…¶å®å¯ä»¥å°è£…æˆä¸€ä¸ªæ–¹æ³•å»è·å–ä¸¤ä¸ªè¯·æ±‚ï¼Œè¿™æ ·åœ¨ä½¿ç”¨çš„æ—¶å€™å°±ç­‰ä»·äºä¸€ä¸ªå¼‚æ­¥è¯·æ±‚äº†ã€‚","user_name":"ä½œè€…å›å¤","comment_id":304612,"uid":"1018676","ip_address":"","utype":1,"ctime":1627634351,"user_name_real":"Nate"}],"discussion_count":1,"race_medal":0,"score":"1627522622","product_id":100079901,"comment_content":"è€å¸ˆï¼Œå…³äºä¸²è¡Œè¯·æ±‚æˆ‘æœ‰äº›æƒ³æ³•ï¼Œå¯¹äºå¤šä¸ªä¸²è¡Œè¯·æ±‚å®ƒä»¬åœ¨é€»è¾‘ä¸Šæœ¬èº«å…·æœ‰è¿ç»­æ€§ï¼Œè€Œæˆ‘ä»¬å¼ºè¡ŒæŠŠå®ƒä»¬åˆ†æ•£åˆ°å•ä¸ªçš„hookä¸­æ˜¯ä¸æ˜¯åŠ å¤§äº†ä»£ç å¤æ‚ç¨‹åº¦å’Œæ—¥åé€»è¾‘çš„ç†è§£éš¾åº¦ã€‚å°±æ˜¯æ„Ÿè§‰æœ‰ç‚¹é‡hookçš„è¯­æ³•å½¢å¼è€Œå¿½å¾‹äº†åŸæœ¬çš„å…³è”æ€§","like_count":0},{"had_liked":false,"id":298912,"user_name":"à¼ºç¨‹à¼»","can_delete":false,"product_type":"c1","uid":1442199,"ip_address":"","ucode":"05B0370E629E60","user_header":"https://static001.geekbang.org/account/avatar/00/16/01/97/16badf02.jpg","comment_is_top":false,"comment_ctime":1624368283,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1624368283","product_id":100079901,"comment_content":"apiClient<br>.get(`&#47;posts&#47;${id}`)<br>.then((res) =&gt; { <br> &#47;&#47; è¯·æ±‚æˆåŠŸæ—¶è®¾ç½®è¿”å›æ•°æ®åˆ°çŠ¶æ€<br>setLoading(false);<br>setData(res.data);<br> })<br><br>è¿”å›æ•°æ®ä¹‹åï¼Œå…ˆsetLoadingï¼Œå†setDataè¿™æ˜¯ä¸€ç§ä¸å®‰å…¨çš„å†™æ³•ã€‚<br>ç”±äºhookæœºåˆ¶ï¼Œä¸€ä¸ªhookä¼šäº§ç”Ÿä¸€æ¬¡æ›´æ–°ï¼Œåœ¨setLoadingä¹‹åï¼ŒsetDataä¹‹å‰ï¼Œè¿™ä¸ªé—´éš”ä¸­ä¼šäº§ç”Ÿä¸€ä¸ªloading  === false  dataä¸ºnullçš„çŠ¶æ€ï¼Œæ­¤æ—¶UIå±‚ä¼šè®¤ä¸ºdataæœ‰æ•°æ®ï¼ˆå› ä¸ºloading=falseï¼Œerror=nullï¼‰ï¼Œå°±å®¹æ˜“æŠ¥é”™ã€‚æ‰€ä»¥åº”è¯¥å…ˆsetDataå†setLoadingï¼Œä½†æ˜¯æœ€å¥½ç”¨ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«dataï¼Œloadingï¼Œerrorï¼Œè¿™æ ·ä¸€æ¬¡setDataè§£å†³é—®é¢˜ã€‚","like_count":0,"discussions":[{"author":{"id":1345253,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/e5/b391125d.jpg","nickname":"ç®€å•","note":"","ucode":"A087B6617F9CBE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551544,"discussion_content":"åœ¨ react çš„ event handler å†…éƒ¨åŒæ­¥çš„å¤šæ¬¡ setState ä¼šè¢« batch ä¸ºä¸€æ¬¡æ›´æ–°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645061364,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1404748,"avatar":"","nickname":"è‚–é¾™","note":"","ucode":"872D4C91B3DA69","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383510,"discussion_content":"å›å¤´æ‰“ä¸ªconsoleçœ‹ä¸€ä¸‹ï¼Œå¯èƒ½è¿™é‡Œçš„setæ˜¯åŒæ­¥çš„ï¼Œé‚£å¯èƒ½çš„ç¡®ä¸å®‰å…¨ï¼Œä¸è¿‡æµè§ˆå™¨æœ‰å¯èƒ½åœ¨è¿™ä¹‹é—´è§¦å‘æ¸²æŸ“å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626139018,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":297775,"user_name":"é—²é—²","can_delete":false,"product_type":"c1","uid":1637571,"ip_address":"","ucode":"B2099BDCFF6191","user_header":"https://static001.geekbang.org/account/avatar/00/18/fc/c3/0991edfc.jpg","comment_is_top":false,"comment_ctime":1623771074,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1623771074","product_id":100079901,"comment_content":"é—®é¢˜1. æ˜¯å¦å¯ä»¥ä¾‹å¦‚classç»„ä»¶reveiverPropsçš„æ€æƒ³ï¼Œåœ¨apiHooké‡Œé¢æ¥å—ä¸€ä¸ªå€¼å‡è®¾æ˜¯idï¼Œå¤–å±‚è°ƒç”¨çš„æ—¶å€™æ§åˆ¶è¿™ä¸ªidçš„å˜åŒ–ï¼Œå¦‚æœbtnç‚¹å‡»æƒ³è¦è§¦å‘ï¼Œå¯ä»¥å°†idè®¾ç½®ä¸ºæ—¶é—´æˆ³æ¯æ¬¡ç‚¹å‡»ä¼ çš„idä¸ä¸€æ ·å°±é©±åŠ¨å‰¯ä½œç”¨äº†<br>é—®é¢˜2. å¯ä»¥ä½¿ç”¨useRefè¿™ä¸ªhook","like_count":0},{"had_liked":false,"id":297756,"user_name":"Free fall","can_delete":false,"product_type":"c1","uid":2637054,"ip_address":"","ucode":"8DBF73CD0F423F","user_header":"","comment_is_top":false,"comment_ctime":1623762963,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1623762963","product_id":100079901,"comment_content":"useEffect(() =&gt; {<br>    if (!id) return<br>    if (!isAutoFetch) return<br><br>    setLoading(true)<br>    setError(null)<br>    setData(null)<br><br>    apiClient<br>      .get(`&#47;posts&#47;${id}`)<br>      .then((res) =&gt; {<br>        setLoading(false)<br>        setData(res.data)<br>      })<br>      .catch((err) =&gt; {<br>        setLoading(false)<br>        setError(err)<br>      })<br>  }, [id, isAutoFetch])<br><br>  return {<br>    loading,<br>    error,<br>    data,<br>    setIsAutoFetch,<br>  }<br>}","like_count":0},{"had_liked":false,"id":297748,"user_name":"Geek_71adef","can_delete":false,"product_type":"c1","uid":2643315,"ip_address":"","ucode":"E3CC6F6FBB1468","user_header":"","comment_is_top":false,"comment_ctime":1623758676,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1623758676","product_id":100079901,"comment_content":"1,ç‚¹å‡»äº‹ä»¶å¯ä»¥è€ƒè™‘åˆ°ä¸­é—´ä»¶ï¼Œè¿”å›ä¸€ä¸ªå‡½æ•°<br>2 å…¨å±€å¯ä»¥ç”¨reduxæˆ–è€…usecontext æˆä¸ºå…¨å±€å˜é‡<br> è¯·é—®è€å¸ˆ userReduceræ˜¯åŒæ­¥å§","like_count":0}]}