{"id":88573,"title":"10 | 包大小：如何从资源和代码层面实现全方位瘦身？","content":"<p>你好，我是戴铭。今天我来跟你说下如何对 App 包大小做优化。</p><p>对App包大小做优化的目的，就是节省用户流量，提高用户下载速度。当初，我在主持滴滴客户端的瘦身时，就是奔着对包大小进行最大化优化的目标，3个月内将包大小从106MB降到了最低64MB，半年内稳定在了70MB。当时业务还没有停，从106MB降到64MB的这3个月里如履薄冰，不同团队各显神威，几乎用到了所有手段，也做了很多创新，最终达成了目标。</p><p><img src=\"https://static001.geekbang.org/resource/image/f6/a2/f6764743beca921cb5dac4644ca092a2.png?wh=1024*768\" alt=\"\"></p><center><span class=\"reference\">图1 瘦身背景</span></center><p>上图就是当时主流 App 的大小，可以看到最大的百度和淘宝，分别是131MB和115MB，滴滴是106MB，最小的是微信87MB。</p><p><img src=\"https://static001.geekbang.org/resource/image/7b/ea/7b7cc940287d2bbb98b97bce38f5aaea.png?wh=1024*768\" alt=\"\"></p><center><span class=\"reference\">图2 主流App安装包半年内的大小变化</span></center><p>可以看到，经过半年的时间，除了滴滴外每个 App的安装包都增大了不少，先前最小的微信也从87MB增加到了116MB。</p><p>相信你的团队也曾遇到过或正在经历着对包大小进行优化的任务，特别是App Store 规定了安装包大小超过150MB的 App 不能使用 OTA（over-the-air）环境下载，也就是只能在WiFi 环境下下载。所以，150MB就成了 App 的生死线，一旦超越了这条线就很有可能会失去大量用户。</p><p>如果你的App要再兼容iOS7 和 iOS8 的话，苹果<a href=\"https://help.apple.com/app-store-connect/#/dev611e0a21f\">官方还规定</a>主二进制 text 段的大小不能超过60MB。如果没有达到这个标准，你甚至都没法提交 App Store。</p><!-- [[[read_end]]] --><p>而实际情况是，业务复杂的 App 轻轻松松就超过了60MB。虽然我们可以通过静态库转动态库的方式来快速避免这个限制，但是静态库转动态库后，动态库的大小差不多会增加一倍，这样150MB的限制就更难守住。</p><p>另外，App包体积过大，对用户更新升级率也会有很大影响。</p><p>综上所述，App 包过大既损害用户体验，影响升级率，还会导致无法提交 App Store 的情况和非WiFi环境无法下载这样可能影响到 App 生死的问题。那么，怎样对包大小进行瘦身和控制包大小的不合理增长就成了重中之重。</p><p>接下来，我就把我用过的包大小瘦身方法一个个地都说给你听。</p><h2>官方 App Thinning</h2><p>App Thinning 是由苹果公司推出的一项可以改善 App 下载进程的新技术，主要是为了解决用户下载 App 耗费过高流量的问题，同时还可以节省用户 iOS 设备的存储空间。</p><p>现在的 iOS 设备屏幕尺寸、分辨率越来越多样化，这样也就需要更多资源来匹配不同的尺寸和分辨率。 同时，App 也会有32位、64位不同芯片架构的优化版本。如果这些都在一个包里，那么用户下载包的大小势必就会变大。</p><p>App Thinning 会专门针对不同的设备来选择只适用于当前设备的内容以供下载。比如，iPhone 6 只会下载 2x 分辨率的图片资源，iPhone 6plus 则只会下载 3x 分辨率的图片资源。</p><p>在苹果公司使用 App Thinning 之前， 每个 App 包会包含多个芯片的指令集架构文件。以 Reveal.framework 为例，使用 du 命令查看到主文件在 Reveal.framework/Versions/A 目录下，大小有21MB。</p><pre><code>ming$ du -h Reveal.framework/*\n  0B  Reveal.framework/Headers\n  0B  Reveal.framework/Reveal\n 16K  Reveal.framework/Versions/A/Headers\n 21M  Reveal.framework/Versions/A\n 21M  Reveal.framework/Versions\n</code></pre><p>然后，我们可以再使用 file 命令，查看 Version 目录下的Reveal 文件：</p><pre><code>ming$ file Reveal.framework/Versions/A/Reveal \nReveal.framework/Versions/A/Reveal: Mach-O universal binary with 5 architectures: [i386:current ar archive] [arm64]\nReveal.framework/Versions/A/Reveal (for architecture i386): current ar archive\nReveal.framework/Versions/A/Reveal (for architecture armv7):  current ar archive\nReveal.framework/Versions/A/Reveal (for architecture armv7s): current ar archive\nReveal.framework/Versions/A/Reveal (for architecture x86_64): current ar archive\nReveal.framework/Versions/A/Reveal (for architecture arm64):  current ar archive\n</code></pre><p>可以看到， Reveal 文件里还有5个文件：</p><ul>\n<li>x86_64 和 i386，是用于模拟器的芯片指令集架构文件；</li>\n<li>arm64、armv7、armv7s ，是真机的芯片指令集架构文件。</li>\n</ul><p>下图来自<a href=\"http://iossupportmatrix.com/\">iOS Support Matrix</a>，列出来的是历来各个 iOS 设备的指令集详细矩阵分布。从中，我们可以一窥所有设备的芯片指令集以及支持的最高和最低 iOS 版本。</p><p><img src=\"https://static001.geekbang.org/resource/image/47/6b/4746f231258fb5875f72fa594463216b.png?wh=2500*1406\" alt=\"\"></p><center><span class=\"reference\">图3 各个 iOS 设备的指令集详细矩阵分布</span></center><p>使用 App Thinning 后，用户下载时就只会下载一个适合自己设备的芯片指令集架构文件。</p><p>App Thinning 有三种方式，包括：App Slicing、Bitcode、On-Demand Resources。</p><ul>\n<li>App Slicing，会在你向 iTunes Connect 上传App后，对 App 做切割，创建不同的变体，这样就可以适用到不同的设备。</li>\n<li>On-Demand Resources，主要是为游戏多关卡场景服务的。它会根据用户的关卡进度下载随后几个关卡的资源，并且已经过关的资源也会被删掉，这样就可以减少初装 App 的包大小。</li>\n<li>Bitcode ，是针对特定设备进行包大小优化，优化不明显。</li>\n</ul><p>那么，如何在你项目里使用 App Thinning 呢？</p><p>其实，这里的大部分工作都是由 Xcode 和 App Store 来帮你完成的，你只需要通过 Xcode 添加 xcassets 目录，然后将图片添加进来即可。</p><p>首先，新建一个文件选择 Asset Catalog 模板，如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/1e/27/1e0b0d270236842f0f1166e107965927.png?wh=1438*1038\" alt=\"\"></p><center><span class=\"reference\">图4 选择使用Asset Catalog 模板</span></center><p>然后，按照 Asset Catalog 的模板添加图片资源即可，添加的 2x 分辨率的图片和 3x分辨率的图片，会在上传到 App Store 后被创建成不同的变体以减小App安装包的大小。而芯片指令集架构文件只需要按照默认的设置， App Store 就会根据设备创建不同的变体，每个变体里只有当前设备需要的那个芯片指令集架构文件。</p><p>使用 App Thining 后，你可以将 2x 图和 3x 图区分开，从而达到减小App 安装包体积的目的。如果我们要进一步减小 App 包体积的话，还需要在图片和代码上继续做优化。接下来，我就跟你说说，为了减小 App 安装包的体积，我们还能在图片上做些什么？</p><h2>无用图片资源</h2><p>图片资源的优化空间，主要体现在删除无用图片和图片资源压缩这两方面。而删除无用图片，又是其中最容易、最应该先做的。像代码瘦身这样难啃的骨头，我们就留在后面吧。那么，我们是如何找到并删除这些无用图片资源的呢？</p><p>删除无用图片的过程，可以概括为下面这6大步。</p><ol>\n<li>\n<p>通过 find 命令获取App安装包中的所有资源文件，比如 find /Users/daiming/Project/ -name。</p>\n</li>\n<li>\n<p>设置用到的资源的类型，比如 jpg、gif、png、webp。</p>\n</li>\n<li>\n<p>使用正则匹配在源码中找出使用到的资源名，比如 pattern = @\"@\"(.+?)\"\"。</p>\n</li>\n<li>\n<p>使用find 命令找到的所有资源文件，再去掉代码中使用到的资源文件，剩下的就是无用资源了。</p>\n</li>\n<li>\n<p>对于按照规则设置的资源名，我们需要在匹配使用资源的正则表达式里添加相应的规则，比如 @“image_%d”。</p>\n</li>\n<li>\n<p>确认无用资源后，就可以对这些无用资源执行删除操作了。这个删除操作，你可以使用 NSFileManger 系统类提供的功能来完成。</p>\n</li>\n</ol><p>整个过程如下图：</p><p><img src=\"https://static001.geekbang.org/resource/image/40/fc/400835aa1573a15ed4dcbf678bad82fc.png?wh=1024*768\" alt=\"\"></p><center><span class=\"reference\">图5 删除无用图片资源的过程</span></center><p>如果你不想自己重新写一个工具的话，可以选择开源的工具直接使用。我觉得目前最好用的是 <a href=\"https://github.com/tinymind/LSUnusedResources\">LSUnusedResources</a>，特别是对于使用编号规则的图片来说，可以通过直接添加规则来处理。使用方式也很简单，你可以参看下面的动画演示：</p><p><img src=\"https://static001.geekbang.org/resource/image/4c/ee/4c0c466cc77f66b14547aaa50bff66ee.gif?wh=660*602\" alt=\"\"></p><center><span class=\"reference\">图6 LSUnusedResources使用示例</span></center><h2>图片资源压缩</h2><p>无用图片资源处理完了，那么有用的图片还有瘦身的空间吗？</p><p>答案是有的。</p><p>对于 App 来说，图片资源总会在安装包里占个大头儿。对它们最好的处理，就是在不损失图片质量的前提下尽可能地作压缩。目前比较好的压缩方案是，将图片转成 WebP。<a href=\"https://developers.google.com/speed/webp/\">WebP</a> 是 Google公司的一个开源项目。</p><p>首先，我们一起看看<strong>选择 WebP 的理由</strong>：</p><ul>\n<li>WebP压缩率高，而且肉眼看不出差异，同时支持有损和无损两种压缩模式。比如，将Gif 图转为Animated WebP ，有损压缩模式下可减少 64%大小，无损压缩模式下可减少 19%大小。</li>\n<li>WebP 支持 Alpha 透明和 24-bit 颜色数，不会像 PNG8 那样因为色彩不够而出现毛边。</li>\n</ul><p>接下来，我们再看看<strong>怎么把图片转成WebP</strong>？</p><p>Google公司在开源WebP的同时，还提供了一个图片压缩工具 <a href=\"https://developers.google.com/speed/webp/docs/precompiled\">cwebp</a>来将其他图片转成 WebP。cwebp 使用起来也很简单，只要根据图片情况设置好参数就行。</p><p>cwebp 语法如下：</p><pre><code>cwebp [options] input_file -o output_file.webp\n</code></pre><p>比如，你要选择无损压缩模式的话，可以使用如下所示的命令：</p><pre><code>cwebp -lossless original.png -o new.webp\n</code></pre><p>其中，-lossless表示的是，要对输入的png图像进行无损编码，转成WebP图片。不使用 -lossless ，则表示有损压缩。</p><p>在cwebp语法中，还有一个比较关键的参数-q float。</p><p>图片色值在不同情况下，可以选择用 -q 参数来进行设置，在不损失图片质量情况下进行最大化压缩：</p><ul>\n<li>小于256色适合无损压缩，压缩率高，参数使用 -lossless -q 100；</li>\n<li>大于256色使用75%有损压缩，参数使用 -q 75；</li>\n<li>远大于256色使用75%以下压缩率，参数 -q 50 -m 6。</li>\n</ul><p>除了cwebp工具外，你还可以选择由腾讯公司开发的<a href=\"http://isparta.github.io\">iSparta</a>。iSpart 是一个 GUI 工具，操作方便快捷，可以实现PNG格式转WebP，同时提供批量处理和记录操作配置的功能。如果是其他格式的图片要转成WebP格式的话，需要先将其转成 PNG格式，再转成WebP格式。它的GUI 界面如下图：</p><p><img src=\"https://static001.geekbang.org/resource/image/89/45/89d5abb7fdb69a391b75eeba141ecc45.png?wh=1024*768\" alt=\"\"></p><center><span class=\"reference\">图7 iSparta将PNG转WebP使用示例</span></center><p>图片压缩完了并不是结束，我们还需要在显示图片时使用 libwebp 进行解析。这里有一个iOS 工程使用 libwebp 的范例，你可以点击<a href=\"https://github.com/carsonmcdonald/WebP-iOS-example\">这个链接</a>查看。</p><p>不过，WebP 在 CPU 消耗和解码时间上会比 PNG 高两倍。所以，我们有时候还需要在性能和体积上做取舍。</p><p><strong>我的建议是，如果图片大小超过了100KB，你可以考虑使用 WebP；而小于100KB时，你可以使用网页工具 <a href=\"https://tinypng.com/\">TinyPng</a>或者GUI工具<a href=\"https://imageoptim.com/mac\">ImageOptim</a>进行图片压缩</strong>。这两个工具的压缩率没有 WebP 那么高，不会改变图片压缩方式，所以解析时对性能损耗也不会增加。</p><h2>代码瘦身</h2><p>App的安装包主要是由资源和可执行文件组成的，所以我们在掌握了对图片资源的处理方式后，需要再一起来看看对可执行文件的瘦身方法。</p><p>可执行文件就是 Mach-O 文件，其大小是由代码量决定的。通常情况下，<strong>对可执行文件进行瘦身，就是找到并删除无用代码的过程。</strong>而查找无用代码时，我们可以按照找无用图片的思路，即：</p><ul>\n<li>首先，找出方法和类的全集；</li>\n<li>然后，找到使用过的方法和类；</li>\n<li>接下来，取二者的差集得到无用代码；</li>\n<li>最后，由人工确认无用代码可删除后，进行删除即可。</li>\n</ul><p>接下来，我们就看看具体的代码瘦身方法吧。</p><h3>LinkMap 结合 Mach-O 找无用代码</h3><p>我先和你说下怎么快速找到方法和类的全集。</p><p><strong>我们可以通过分析 LinkMap 来获得所有的代码类和方法的信息。</strong>获取 LinkMap 可以通过将 Build Setting 里的 Write Link Map File 设置为 Yes，然后指定 Path to Link Map File 的路径就可以得到每次编译后的 LinkMap 文件了。设置选项如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/66/2e/660aebe887ebd20f1b18fc685920b82e.png?wh=1726*558\" alt=\"\"></p><center><span class=\"reference\">图8 LinkMap文件获取方法</span></center><p>LinkMap文件分为三部分：Object File、Section 和 Symbols。如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/21/07/21cf3a872d3693b1978601b7aa033607.png?wh=1024*768\" alt=\"\"></p><center><span class=\"reference\">图9 LinkMap文件主要组成</span></center><p>其中：</p><ul>\n<li>Object File 包含了代码工程的所有文件；</li>\n<li>Section 描述了代码段在生成的 Mach-O 里的偏移位置和大小；</li>\n<li>Symbols 会列出每个方法、类、block，以及它们的大小。</li>\n</ul><p>通过 LinkMap ，你不光可以统计出所有的方法和类，还能够清晰地看到代码所占包大小的具体分布，进而有针对性地进行代码优化。</p><p>得到了代码的全集信息以后，我们还需要找到已使用的方法和类，这样才能获取到差集，找出无用代码。所以接下来，我就先和你说说<strong>怎么通过 Mach-O 取到使用过的方法和类</strong>。</p><p>我在第2篇文章“<a href=\"https://time.geekbang.org/column/article/85331\">APP 启动速度怎么做优化与监控？</a>”中，和你提到过iOS 的方法都会通过 objc_msgSend 来调用。而，objc_msgSend 在 Mach-O文件里是通过 __objc_selrefs 这个 section 来获取 selector 这个参数的。</p><p>所以，__objc_selrefs 里的方法一定是被调用了的。__objc_classrefs 里是被调用过的类，__objc_superrefs 是调用过 super 的类。通过 __objc_classrefs 和 __objc_superrefs，我们就可以找出使用过的类和子类。</p><p>那么，Mach-O文件的 __objc_selrefs、__objc_classrefs和__objc_superrefs 怎么查看呢？</p><p>我们可以使用 <a href=\"https://sourceforge.net/projects/machoview/\">MachOView 这个软件</a>来查看Mach-O 文件里的信息。MachOView 同时也是一款开源软件，如果你对源码感兴趣的话，可以点击<a href=\"https://github.com/gdbinit/MachOView\">这个地址</a>查看。</p><p>具体的查看方法，我将通过一个案例和你展开。</p><ul>\n<li>首先，我们需要编译一个 App。在这里，我clone了<a href=\"https://github.com/ming1016/GCDFetchFeed\">一个GitHub上的示例</a> 下来编译。</li>\n<li>然后，将生成的 GCDFetchFeed.app 包解开，取出 GCDFetchFeed。</li>\n<li>最后，我们就可以使用 MachOView 来查看Mach-O 里的信息了。</li>\n</ul><p><img src=\"https://static001.geekbang.org/resource/image/0b/a4/0bc5431e0cd634296886ac457d4066a4.jpg?wh=2132*1328\" alt=\"\"></p><center><span class=\"reference\">图10 使用 MachOView 查看GCDFetchFeed</span></center><p>如图上所示，我们可以看到 __objc_selrefs、__objc_classrefs和、__objc_superrefs 这三个 section。</p><p>但是，这种查看方法并不是完美的，还会有些问题。原因在于， Objective-C 是门动态语言，方法调用可以写成在运行时动态调用，这样就无法收集全所有调用的方法和类。所以，我们通过这种方法找出的无用方法和类就只能作为参考，还需要二次确认。</p><h3>通过 AppCode 找出无用代码</h3><p>那么，有什么好的工具能够找出无用的代码吗？</p><p>我用过不少工具，但效果其实都不是很好，都卡在了各种运用运行时调用方法的写法上。即使是大名鼎鼎的 AppCode 在这方面也做得不是很好，当代码量过百万行时 AppCode 的静态分析会“歇菜”。</p><p>但是，<strong>如果工程量不是很大的话，我还是建议你直接使用 AppCode 来做分析。</strong>毕竟代码量达到百万行的工程并不多。而，那些代码量达到百万行的团队，则会自己通过 Clang 静态分析来开发工具，去检查无用的方法和类。</p><p>用 AppCode 做分析的方法很简单，直接在 AppCode 里选择 Code-&gt;Inspect Code 就可以进行静态分析。</p><p><img src=\"https://static001.geekbang.org/resource/image/a9/11/a935117790e7744069cf1bf58336b711.png?wh=1330*1272\" alt=\"\"></p><center><span class=\"reference\">图11 使用 AppCode 来做静态分析</span></center><p>静态分析完以后，我们可以在 Unused code 里看到所有的无用代码，如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/57/a4/57a96abafd30d5c15210300c2d1eaba4.png?wh=1632*1034\" alt=\"\"></p><center><span class=\"reference\">图12 Unused code 里看到所有无用代码</span></center><p>接下来，我和你说一下这些无用代码的主要类型。</p><ul>\n<li>无用类：Unused class 是无用类，Unused import statement 是无用类引入声明，Unused property 是无用的属性；</li>\n<li>无用方法：Unused method 是无用的方法，Unused parameter 是无用参数，Unused instance variable 是无用的实例变量，Unused local variable 是无用的局部变量，Unused value 是无用的值；</li>\n<li>无用宏：Unused macro 是无用的宏。</li>\n<li>无用全局：Unused global declaration 是无用全局声明。</li>\n</ul><p>看似AppCode 已经把所有工作都完成了，其实不然。下面，我再和你列举下 AppCode 静态检查的问题：</p><ul>\n<li>JSONModel 里定义了未使用的协议会被判定为无用协议；</li>\n<li>如果子类使用了父类的方法，父类的这个方法不会被认为使用了；</li>\n<li>通过点的方式使用属性，该属性会被认为没有使用；</li>\n<li>使用 performSelector 方式调用的方法也检查不出来，比如 self performSelector:@selector(arrivalRefreshTime)；</li>\n<li>运行时声明类的情况检查不出来。比如通过 NSClassFromString 方式调用的类会被查出为没有使用的类，比如 layerClass = NSClassFromString(@“SMFloatLayer”)。还有以[[self class] accessToken] 这样不指定类名的方式使用的类，会被认为该类没有被使用。像 UITableView 的自定义的 Cell 使用 registerClass，这样的情况也会认为这个 Cell 没有被使用。</li>\n</ul><p>基于以上种种原因，使用AppCode检查出来的无用代码，还需要人工二次确认才能够安全删除掉。</p><h3>运行时检查类是否真正被使用过</h3><p>即使你使用LinkMap 结合 Mach-O 或者 AppCode 的方式，通过静态检查已经找到并删除了无用的代码，那么就能说包里完全没有无用的代码了吗？</p><p>实际上，在 App 的不断迭代过程中，新人不断接手、业务功能需求不断替换，会留下很多无用代码。这些代码在执行静态检查时会被用到，但是线上可能连这些老功能的入口都没有了，更是没有机会被用户用到。也就是说，这些无用功能相关的代码也是可以删除的。</p><p>那么，<strong>我们要怎么检查出这些无用代码呢？</strong></p><p>通过 ObjC 的 runtime 源码，我们可以找到怎么判断一个类是否初始化过的函数，如下：</p><pre><code>#define RW_INITIALIZED (1&lt;&lt;29)\nbool isInitialized() {\n   return getMeta()-&gt;data()-&gt;flags &amp; RW_INITIALIZED;\n}\n</code></pre><p>isInitialized 的结果会保存到元类的 class_rw_t 结构体的 flags 信息里，flags 的1&lt;&lt;29 位记录的就是这个类是否初始化了的信息。而flags的其他位记录的信息，你可以参看 objc runtime 的源码，如下：</p><pre><code>// 类的方法列表已修复\n#define RW_METHODIZED         (1&lt;&lt;30)\n\n// 类已经初始化了\n#define RW_INITIALIZED        (1&lt;&lt;29)\n\n// 类在初始化过程中\n#define RW_INITIALIZING       (1&lt;&lt;28)\n\n// class_rw_t-&gt;ro 是 class_ro_t 的堆副本\n#define RW_COPIED_RO          (1&lt;&lt;27)\n\n// 类分配了内存，但没有注册\n#define RW_CONSTRUCTING       (1&lt;&lt;26)\n\n// 类分配了内存也注册了\n#define RW_CONSTRUCTED        (1&lt;&lt;25)\n\n// GC：class有不安全的finalize方法\n#define RW_FINALIZE_ON_MAIN_THREAD (1&lt;&lt;24)\n\n// 类的 +load 被调用了\n#define RW_LOADED             (1&lt;&lt;23)\n</code></pre><p>flags 采用位方式记录布尔值的方式，易于扩展、所用存储空间小、检索性能也好。所以，经常阅读优秀代码，特别有助于提高我们自己的代码质量。</p><p>这里，我插一句题外话。<strong>我面试应聘者的时候，常常会问他们“苹果公司为什么要设计元类”这样的开放问题。</strong>结果呢，就是我所见的大部分应聘者，都只能说出元类是什么。</p><p>因为很多人都只是奔着学习 runtime 这个知识点而学习，并没有在学习过程中多想想为什么。比如，为什么类结构要这么设计，为什么一个类要设计两个结构体等等类似的问题。在我看来，没有经过深入思考的学习是不够的，是学不到精髓的，很多优秀的代码可能就会被错过。</p><p>好了，现在继续回到我们的正文内容中。既然能够在运行中看到类是否初始化了，那么我们就能够找出有哪些类是没有初始化的，即找到在真实环境中没有用到的类并清理掉。</p><p>具体编写运行时无用类检查工具时，我们可以在线下测试环节去检查所有类，先查出哪些类没有初始化，然后上线后针对那些没有初始化的类进行多版本监测观察，看看哪些是在主流程外个别情况下会用到的，判断合理性后进行二次确认，最终得到真正没有用到的类并删掉。</p><h2>小结</h2><p>今天这篇文章，我主要和你分享的是App安装包的一些瘦身方案。</p><p>在我看来，可以把包瘦身方案根据App的代码量等因素，划分为两种。</p><p>对于上线时间不长的新 App 和那些代码量不大的 App来说，做些资源上的优化，再结合使用AppCode 就能够有很好的收益。而且把这些流程加入工作流后，日常工作量也不会太大。</p><p>但是，对于代码量大，而且业务需求迭代时间很长的 App来说，包大小的瘦身之路依然任道重远，这个领域的研究还有待继续完善。LinkMap 加 Mach-O 取差集的结果也只能作为参考，每次人工确认的成本是非常大的，只适合突击和应急清理时使用。最后日常采用的方案，可能还是用运行时检查类的方式，这种大粒度检查的方式精度虽然不高，但是人工工作量会小很多。</p><h2>课后小作业</h2><p>今天我提到了运行时检查类是否被使用的方案，那么你来写个使用这种方案的小工具来检查下你的 App 里有哪些类实际上是没有被初始化用到的吧。</p><p>感谢你的收听，欢迎你在评论区给我留言分享你的观点，也欢迎把它分享给更多的朋友一起阅读。</p><p></p>","neighbors":{"left":{"article_title":"09 | 无侵入的埋点方案如何实现？","id":87925},"right":{"article_title":"11 | 热点问题答疑（一）：基础模块问题答疑","id":88799}},"comments":[{"had_liked":false,"id":82595,"user_name":"Geek_97bcf5","can_delete":false,"product_type":"c1","uid":1452522,"ip_address":"","ucode":"76033700AF11AD","user_header":"","comment_is_top":false,"comment_ctime":1554256111,"is_pvip":false,"discussion_count":9,"race_medal":0,"score":"306496934127","product_id":100024501,"comment_content":"元类和类的数据结构是同一个，只是运行时使用的字段不一样。<br><br>实例方法调用是通过objc_msgSend来调用，它的第一个入参就是实例对象，其流程是查找实例对象的isa指针，找到类对象，然后找到method_t的IMP，bl直接跳转调用。<br><br>类方法的调用和实例方法调用一致，它的第一个入参对象是类对象，类对象的isa指向的是元类。<br><br>所以，没有元类的话，类方法是没有办法调用的。objc_msgSend的调用流程是一定要isa指针的。<br><br>如果实例方法和类方法都放在类对象上，那类对象的isa指针只能指向自己了，那一旦类方法和实例方法重名，就没法搞了！<br><br>所以，问这个问题的，都是objc_msgSend源码没看过的同学。","like_count":72,"discussions":[{"author":{"id":1453427,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2d/73/417544ee.jpg","nickname":"骑鹤下江南","note":"","ucode":"3358404E92B7CA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3605,"discussion_content":"问的问题是为什么设计元类，你这答的驴头不对马嘴的（你回答简而言之就是，因为苹果就是这样做的，所以要有元类，其实跟没回答一样），现在有元类，设计当然是这样，如果没有元类，类方法重名完全可以用另外一个method_t的数组去维护或者加上标志位，为什么不这么做呢？。。戴老师想问的是，为什么不那样设计，而设计成现在这个样，你这回答100分能拿30分就不错了。你具体看下面戴老师回的，要考察什么方向的能力。","likes_number":8,"is_delete":false,"is_hidden":false,"ctime":1564630056,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1452522,"avatar":"","nickname":"Geek_97bcf5","note":"","ucode":"76033700AF11AD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1453427,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2d/73/417544ee.jpg","nickname":"骑鹤下江南","note":"","ucode":"3358404E92B7CA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6112,"discussion_content":"其实我是在看了作者的回复，才评论的。\n\n作者的回复里面说：“比如元类和类的结构体非常类似，他有没有想过为什么不合在一起用一个结构体？”\n\n在代码层面，元类和类就是一个结构体，内存布局完全一致。所以，作者说的非常相似是怎么讲，我觉得在误导其他读者。\n\n所以，随便举了一个例子，说一下为什么要有元类，没有元类的话，类方法和实例方法重名都无法解决。\n\n为什么设计元类？元类不是我设计的，我也没法给出标准答案，如果非得咬文嚼字的话，作者也给不出答案。但是我解释了一下元类的作用，如果没有元类有些问题不好解决，不光是方法命名，还有方法缓存等一些问题。\n\n作者的答案是用另外一些问题来解答这个问题，我觉得有点敷衍读者的感觉，所以，评论了一下，语气有点重，这里道个歉，没有其他意思。\n\n","likes_number":8,"is_delete":false,"is_hidden":false,"ctime":1566709650,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":3605,"ip_address":""},"score":6112,"extra":""},{"author":{"id":1452522,"avatar":"","nickname":"Geek_97bcf5","note":"","ucode":"76033700AF11AD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1453427,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2d/73/417544ee.jpg","nickname":"骑鹤下江南","note":"","ucode":"3358404E92B7CA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6115,"discussion_content":"作者的原话是“我面试应聘者的时候，常常会问他们“苹果公司为什么要设计元类”这样的开放问题。”\n\n作者并没有说什么“为什么那样设计，而不这样设计？”\n\n这是不是你自己理解出来的啊？\n\n我只是从元类的作用上解释了一下，为什么设计元类。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566710294,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":3605,"ip_address":""},"score":6115,"extra":""},{"author":{"id":1456772,"avatar":"https://static001.geekbang.org/account/avatar/00/16/3a/84/1087bc47.jpg","nickname":"小怪兽","note":"","ucode":"B9451F48FF99CF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1453427,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2d/73/417544ee.jpg","nickname":"骑鹤下江南","note":"","ucode":"3358404E92B7CA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":314753,"discussion_content":"哈哈是的呀，他因果搞反了，没想到还有那么多赞呀","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1603193815,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":3605,"ip_address":""},"score":314753,"extra":""}]},{"author":{"id":1472981,"avatar":"https://static001.geekbang.org/account/avatar/00/16/79/d5/4dee8730.jpg","nickname":"波儿菜","note":"","ucode":"4084D02C277D40","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":42115,"discussion_content":"以我拙劣的语文水平来看戴老师的描述没啥毛病。。 元类的作用可以简单分析，比如职责单一，对象与类的信息独立；元类和类结构类似为了便于复用逻辑，比如 共用objc_msgSend；元类的独立让类的结构更简洁，实例所需内存空间更小......","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1572591108,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1472912,"avatar":"","nickname":"Geek_暮云","note":"","ucode":"6FDFE341A397D5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":9608,"discussion_content":"en...我能想到的是，假设类方法和实例方法不能重名的情况下，你把实例方法和类方法整合到一起，你的mehtod_list里面记录的方法试题就会大量的增加不是吗？就算有方法缓存也只是以方法名字为导向的，分开为两个的话，个人愚见是可以提升查询效率的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568195396,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1147205,"avatar":"https://static001.geekbang.org/account/avatar/00/11/81/45/9aa91b75.jpg","nickname":"矮个子先生😝","note":"","ucode":"2242A457B0E10D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2889,"discussion_content":"你是在说戴老师没看过源码吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564021285,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1452522,"avatar":"","nickname":"Geek_97bcf5","note":"","ucode":"76033700AF11AD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1147205,"avatar":"https://static001.geekbang.org/account/avatar/00/11/81/45/9aa91b75.jpg","nickname":"矮个子先生😝","note":"","ucode":"2242A457B0E10D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6116,"discussion_content":"当时评论是有这个意思，因为他回复的不严谨。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566710376,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":2889,"ip_address":""},"score":6116,"extra":""},{"author":{"id":1452522,"avatar":"","nickname":"Geek_97bcf5","note":"","ucode":"76033700AF11AD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1147205,"avatar":"https://static001.geekbang.org/account/avatar/00/11/81/45/9aa91b75.jpg","nickname":"矮个子先生😝","note":"","ucode":"2242A457B0E10D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6117,"discussion_content":"所以，我评论的第一句就纠正了他回复中不严谨的问题，防止误导其他读者。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566710450,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":2889,"ip_address":""},"score":6117,"extra":""}]}]},{"had_liked":false,"id":82178,"user_name":"元元","can_delete":false,"product_type":"c1","uid":1455337,"ip_address":"","ucode":"2BD85A37BBC2F2","user_header":"https://static001.geekbang.org/account/avatar/00/16/34/e9/238acb66.jpg","comment_is_top":false,"comment_ctime":1554136226,"is_pvip":false,"replies":[{"id":"29807","content":"其实这个问题是个开放性的问题。<br>不同阶段的解读也会不一样。因为这个知识点大家都会去学，主要是希望能够通过面试者的回答，加上追问方式来看他是不是会带着思考去学习。比如元类和类的结构体非常类似，他有没有想过为什么不合在一起用一个结构体？（结构体设计能力）元类和类创建的时机是不是一样的，为什么？（用过 runtime 接口开发没）元类的 flag 字段里记录了什么？（是否有深入探究的意识）","user_name":"作者回复","user_name_real":"戴铭","uid":"1140280","ctime":1554198443,"ip_address":"","comment_id":82178,"utype":1}],"discussion_count":2,"race_medal":0,"score":"121813220514","product_id":100024501,"comment_content":"老师ios为什么要设计元类？能讲一下吗","like_count":29,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"戴铭","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445500,"discussion_content":"其实这个问题是个开放性的问题。\n不同阶段的解读也会不一样。因为这个知识点大家都会去学，主要是希望能够通过面试者的回答，加上追问方式来看他是不是会带着思考去学习。比如元类和类的结构体非常类似，他有没有想过为什么不合在一起用一个结构体？（结构体设计能力）元类和类创建的时机是不是一样的，为什么？（用过 runtime 接口开发没）元类的 flag 字段里记录了什么？（是否有深入探究的意识）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554198443,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1263832,"avatar":"https://static001.geekbang.org/account/avatar/00/13/48/d8/51ab657d.jpg","nickname":"Sun0010","note":"","ucode":"92B35625DCEB9B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":45916,"discussion_content":"为什么不合在一起用一个结构体？ 我觉得，元类是是为了 new 对应的类，需要放在堆上，但是结构体的变量","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573099168,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128053,"user_name":"Mit","can_delete":false,"product_type":"c1","uid":1456131,"ip_address":"","ucode":"3F3FE40A7380DD","user_header":"https://static001.geekbang.org/account/avatar/00/16/38/03/71afa043.jpg","comment_is_top":false,"comment_ctime":1566825801,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23041662281","product_id":100024501,"comment_content":"重复图片与无用图片的检索工具 <br>https:&#47;&#47;github.com&#47;mitchell-dream&#47;MitImgChecker  可以尝试一下这个工具。","like_count":5},{"had_liked":false,"id":82913,"user_name":"leoliu","can_delete":false,"product_type":"c1","uid":1140991,"ip_address":"","ucode":"D20A026B3C1E2F","user_header":"https://static001.geekbang.org/account/avatar/00/11/68/ff/1832c048.jpg","comment_is_top":false,"comment_ctime":1554347793,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"23029184273","product_id":100024501,"comment_content":"本地的同一图片的2倍和3倍图被转换成相应的webp后，这样苹果就无法根据设备选择了相应的图片了，对瘦身的影响哪个比重会大一下","like_count":5,"discussions":[{"author":{"id":1635693,"avatar":"https://static001.geekbang.org/account/avatar/00/18/f5/6d/9cdebb65.jpg","nickname":"王齐","note":"","ucode":"3EAD86A3448E2E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":39651,"discussion_content":"这里说的图片应该是指大图（比如100KB）转成WebP格式","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571972353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":82207,"user_name":"codertiany","can_delete":false,"product_type":"c1","uid":1239772,"ip_address":"","ucode":"2F7A9A959505B4","user_header":"https://static001.geekbang.org/account/avatar/00/12/ea/dc/e813af86.jpg","comment_is_top":false,"comment_ctime":1554164200,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"23029000680","product_id":100024501,"comment_content":"我也不懂啥叫元类","like_count":5,"discussions":[{"author":{"id":1454334,"avatar":"https://static001.geekbang.org/account/avatar/00/16/30/fe/fc686f23.jpg","nickname":"李乾坤David","note":"","ucode":"295D0234582979","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3442,"discussion_content":"实例对象 类对象 元类对象","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1564480566,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":83560,"user_name":"drunkenMouse","can_delete":false,"product_type":"c1","uid":1454037,"ip_address":"","ucode":"AA8CEA703ECBE8","user_header":"","comment_is_top":false,"comment_ctime":1554651304,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"18734520488","product_id":100024501,"comment_content":"App Thinning原理：每个App包会包含多个芯片（如真机、模拟器）的指令集架构文件，App Thinning会使用户只下载一个适合自己设备的芯片指令架构文件。<br><br>简单说，使用App Thinning之后苹果会自动帮你把App包按照型号分割成不同变体，保证每个型号只下载自己所需要的资源。而自己所需要做的，就是通过Asset Catalog模板创建xcassets目录，将2x与3x图片放进去。<br><br>无用文件删除简单说：通过find命令与正则表达式找到所有代码中在使用的文件， 那么剩下的就是没有用的文件。关于没用文件的删除和有用文件的寻找，可以借助工具LSUnusedResources<br><br>objc_msgSend通过_objc_selrefs获取selector， __objc_classrefs获取被调用的类，__objc_supperrefs获取调用的父类<br><br>若有部分方法是运行时动态调用就会没执行到则没法收集。比如A类的B方法没有被我直接调用，但是在运行到某一代码块时，我通过runtime的objc_msgSend手动调用了这个方法，则不会被记录。<br><br>元类：每个类都是元类，通过元类调用类方法。通过元类创建实例对象，用实例对象来调用实例方法。可以防止类方法与实例方法重名时，声明和调用失败。而实例对象的isa指针指向的是元类，也就是之前说的：每个对象都会指向一个类，每个类都有一个方法列表，方法列表里的每个方法都是由SEL、IMP和metadata组成。元类的isa指针，指向父类的元类，而根类就是NSObject。<br><br>所以，为什么要设计元类？为了区分实例方法和类方法的声明与调用。但是方法列表保存在元类里，通过元类来找到父类。<br><br>最后问句：有人作业可以借我参考一下吗？？","like_count":4,"discussions":[{"author":{"id":2555047,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/9sicykHGaRicX5LsS0FOlP0rM6OG0HRKhbpCSyn3VbPicQLYVq9Fza5p2Kib5K2nYCHwWs0Trq9UATTmRfAPlIsGQQ/132","nickname":"Geek_43c928","note":"","ucode":"3C4644888F4C1E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391117,"discussion_content":"通过元类来找到父类?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630300674,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115263,"user_name":"lcp","can_delete":false,"product_type":"c1","uid":1147461,"ip_address":"","ucode":"3C9975BFF7654E","user_header":"https://static001.geekbang.org/account/avatar/00/11/82/45/981ac8ab.jpg","comment_is_top":false,"comment_ctime":1563520615,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14448422503","product_id":100024501,"comment_content":"运行时检查类，请问调用 isInitialized() 方法的时机是什么时候呢？<br>我理解只能通过hook msgSend的时候，判断方法是否为 +initialize 比 运行时通过isInitialized() 方案要来得简单一些。","like_count":3},{"had_liked":false,"id":92925,"user_name":"Geek_e1c05c","can_delete":false,"product_type":"c1","uid":1453907,"ip_address":"","ucode":"AF6679C2C352FF","user_header":"","comment_is_top":false,"comment_ctime":1557365137,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"14442267025","product_id":100024501,"comment_content":"您好，苹果不是禁止使用动态库的吗？把静态库换成动态库能上架成功吗？抱歉不是很懂","like_count":3,"discussions":[{"author":{"id":2321494,"avatar":"","nickname":"Mr甘","note":"","ucode":"337190EF6D3EFD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":327988,"discussion_content":"其实苹果的动态库就是一个阉割过的动态库，不是真正意义上的动态库","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606037173,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2046550,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLqxY3fx9Cs0BCxyuOqdlMY8UFZul9TEVp1rAKD16z3VHncBpfHAficsdHrxN6wUqH4xWFiby31iaZWA/132","nickname":"guoran","note":"","ucode":"D16D9F97219D9D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294442,"discussion_content":"iOS8之后可以有限的使用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595895067,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1393437,"avatar":"https://static001.geekbang.org/account/avatar/00/15/43/1d/0eb510c1.jpg","nickname":"XZZ","note":"","ucode":"67B60180C15855","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":269954,"discussion_content":"可以上架的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589968254,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":87263,"user_name":"鹏sir","can_delete":false,"product_type":"c1","uid":1487352,"ip_address":"","ucode":"6FC0A3DEBCA78B","user_header":"https://static001.geekbang.org/account/avatar/00/16/b1/f8/a270fc24.jpg","comment_is_top":false,"comment_ctime":1555555196,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14440457084","product_id":100024501,"comment_content":"老师，使用webp压缩图片后项目的包体积大概能减少多少呢？？我们项目的图片最多也就100kb出头的样子，好多都是几kb,而且使用webp压缩后的图片，加载图片方式也需要改变，代码改动量比较大。。。","like_count":2},{"had_liked":false,"id":82400,"user_name":"mαnajay","can_delete":false,"product_type":"c1","uid":1067450,"ip_address":"","ucode":"6DE9FBD1BEC8AD","user_header":"https://static001.geekbang.org/account/avatar/00/10/49/ba/23c9246a.jpg","comment_is_top":false,"comment_ctime":1554201189,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14439103077","product_id":100024501,"comment_content":"我觉得设计元类 ，主要思想是 处理代码 通用逻辑与 特有逻辑。有些作为模板可以复用代码逻辑甚至节省内存空间分配，有些则是要针对独立个体单独处理，就是常说的面向对象编程中处处皆对象","like_count":3},{"had_liked":false,"id":82286,"user_name":"小前端","can_delete":false,"product_type":"c1","uid":1271383,"ip_address":"","ucode":"F9C45FDF0E9084","user_header":"https://static001.geekbang.org/account/avatar/00/13/66/57/f76f20b6.jpg","comment_is_top":false,"comment_ctime":1554175383,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14439077271","product_id":100024501,"comment_content":"课后作业的官方答案啥时候同步？谢谢","like_count":4,"discussions":[{"author":{"id":1454334,"avatar":"https://static001.geekbang.org/account/avatar/00/16/30/fe/fc686f23.jpg","nickname":"李乾坤David","note":"","ucode":"295D0234582979","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3444,"discussion_content":"你找到作业答案没。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564481850,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":237604,"user_name":"guoran","can_delete":false,"product_type":"c1","uid":2046550,"ip_address":"","ucode":"D16D9F97219D9D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLqxY3fx9Cs0BCxyuOqdlMY8UFZul9TEVp1rAKD16z3VHncBpfHAficsdHrxN6wUqH4xWFiby31iaZWA/132","comment_is_top":false,"comment_ctime":1595898648,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10185833240","product_id":100024501,"comment_content":"有个疑问，想请教一下，app的瘦身中代码那部分，如果你用不到的接口或类，感觉在编译的时候编译器会自动优化吧，最迟也是在链接的时候会自动的把一些未使用到的优化掉，你这么做的目的感觉是在提升编译链接速度而不是在瘦身，因为用不到的代码本来编译链接成可执行文件后就不会包含这部分的内容，希望作者指教！我看很多人的问题作者都不回复，不知道是不是太忙了，盼回复！","like_count":2,"discussions":[{"author":{"id":1389506,"avatar":"https://static001.geekbang.org/account/avatar/00/15/33/c2/3a5b0d9f.jpg","nickname":"clownfish","note":"","ucode":"6838EE3D37BD54","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391658,"discussion_content":"OC代码是不会做优化的, c/c++可能会, OC还有运行时, 给你优化了你咋通过类名调用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630568526,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":118990,"user_name":"李乾坤David","can_delete":false,"product_type":"c1","uid":1454334,"ip_address":"","ucode":"295D0234582979","user_header":"https://static001.geekbang.org/account/avatar/00/16/30/fe/fc686f23.jpg","comment_is_top":false,"comment_ctime":1564480828,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10154415420","product_id":100024501,"comment_content":"看了之后并没有给出具体找到无用类的方法？","like_count":3},{"had_liked":false,"id":82898,"user_name":"leoliu","can_delete":false,"product_type":"c1","uid":1140991,"ip_address":"","ucode":"D20A026B3C1E2F","user_header":"https://static001.geekbang.org/account/avatar/00/11/68/ff/1832c048.jpg","comment_is_top":false,"comment_ctime":1554345942,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10144280534","product_id":100024501,"comment_content":"本地的@2x和@3x转成webp以后，调用的时候是否要判断设备分辨率，根据不同的设备分辨率调用不同倍数的webp","like_count":2},{"had_liked":false,"id":82678,"user_name":"Norman","can_delete":false,"product_type":"c1","uid":1005892,"ip_address":"","ucode":"433012A9090823","user_header":"","comment_is_top":false,"comment_ctime":1554274286,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10144208878","product_id":100024501,"comment_content":"“而实际情况是，业务复杂的 App 轻轻松松就超过了 60MB。虽然我们可以通过静态库转动态库的方式来快速避免这个限制，但是静态库转动态库后，动态库的大小差不多会增加一倍，这样 150MB 的限制就更难守住。”这几句我没有很明白，老师可以给解释一下吗？","like_count":2},{"had_liked":false,"id":82651,"user_name":"Norman","can_delete":false,"product_type":"c1","uid":1005892,"ip_address":"","ucode":"433012A9090823","user_header":"","comment_is_top":false,"comment_ctime":1554269850,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"10144204442","product_id":100024501,"comment_content":"老师好，有个问题。我使用imageOptim压缩图片之前的xcassets大小是8.7M，压缩之后是6.4M，但是打包出来的ipa大小并没有明显改变，请问这是为什么呢。","like_count":2,"discussions":[{"author":{"id":1005947,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/7b/ebe8451e.jpg","nickname":"德先生","note":"","ucode":"659061785DCF4C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":581359,"discussion_content":"需要有损压缩","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658738540,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2444450,"avatar":"https://static001.geekbang.org/account/avatar/00/25/4c/a2/dfc6d97b.jpg","nickname":"(void","note":"","ucode":"0B4790632AAB27","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350716,"discussion_content":"压缩没用的，打包的时候是根据位图重新编码的所以压缩有啥用呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613985701,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1458075,"avatar":"https://static001.geekbang.org/account/avatar/00/16/3f/9b/f626552c.jpg","nickname":"阳光黑1","note":"","ucode":"AE7C19422F565C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":328986,"discussion_content":"打包的时候又给解压了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606292090,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":246724,"user_name":"杂草","can_delete":false,"product_type":"c1","uid":2111582,"ip_address":"","ucode":"604C7A12256A14","user_header":"https://static001.geekbang.org/account/avatar/00/20/38/5e/6b71b213.jpg","comment_is_top":false,"comment_ctime":1599464829,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5894432125","product_id":100024501,"comment_content":"bool isInitialized()<br>运行时判断并不能确定就是一定没有使用，运行时就要求你必须跑到所有的业务代码，实际上这个很难确保每一行代码都跑到","like_count":1,"discussions":[{"author":{"id":1097911,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c0/b7/52ff7bc3.jpg","nickname":"蔡联庆","note":"","ucode":"51239D95A2F524","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571141,"discussion_content":"线上经过几个版本验证，就算是有用到估计也是个低UV的。那这种业务也可以考虑是否下线","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652085865,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1389506,"avatar":"https://static001.geekbang.org/account/avatar/00/15/33/c2/3a5b0d9f.jpg","nickname":"clownfish","note":"","ucode":"6838EE3D37BD54","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391659,"discussion_content":"我也这么考虑, 除非自动化测试做得好, 能全覆盖","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630568630,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":177284,"user_name":"flysky0527","can_delete":false,"product_type":"c1","uid":1008778,"ip_address":"","ucode":"800CA42C94C200","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqmMVfNjuWq7cWWjtKg3331wtTSGzbMVeHHPib5JN0rUrkhjecMibQ8IYrPQWAU4juXQGpiaMibDsKh3g/132","comment_is_top":false,"comment_ctime":1581341669,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5876308965","product_id":100024501,"comment_content":"如果使用pdf图标，是否也会有在不同分辨率手机下享受苹果自带的app shinning？","like_count":1},{"had_liked":false,"id":99347,"user_name":"大饼博士","can_delete":false,"product_type":"c1","uid":1461983,"ip_address":"","ucode":"8FEA34F5E22743","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIwGIaRex2lkDBYt0AnOAlFz5Ya9kSh6tfdFZH8nt3EYRVMpDqbUtEtbLibNh2m0gmssNkZQuvdsJg/132","comment_is_top":false,"comment_ctime":1559197886,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5854165182","product_id":100024501,"comment_content":"如果可以用class_rw_t的话，为什么不直接在initialize方法里面判断呢？这不一样的么？","like_count":1},{"had_liked":false,"id":94377,"user_name":"半城风雨半城沙","can_delete":false,"product_type":"c1","uid":1099636,"ip_address":"","ucode":"C9DBCCE812128E","user_header":"https://static001.geekbang.org/account/avatar/00/10/c7/74/2eed0e24.jpg","comment_is_top":false,"comment_ctime":1557797986,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5852765282","product_id":100024501,"comment_content":"戴老师，每次给的课后小作业，是否有自己的实现呢，或者有没有一些提供参考实现。","like_count":1},{"had_liked":false,"id":88036,"user_name":"Toon","can_delete":false,"product_type":"c1","uid":1256136,"ip_address":"","ucode":"16189FD3A4B03B","user_header":"","comment_is_top":false,"comment_ctime":1555821268,"is_pvip":false,"replies":[{"id":"31665","content":"矢量图片编译时会生成位图","user_name":"作者回复","user_name_real":"戴铭","uid":"1140280","ctime":1555841229,"ip_address":"","comment_id":88036,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5850788564","product_id":100024501,"comment_content":"矢量图呢？也可以减少大小吧","like_count":1,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"戴铭","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447693,"discussion_content":"矢量图片编译时会生成位图","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555841229,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2263862,"avatar":"https://static001.geekbang.org/account/avatar/00/22/8b/36/958d1837.jpg","nickname":"彩色石头","note":"","ucode":"9C205C5244D64D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":320954,"discussion_content":"iconfont","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604509143,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2031202,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKSibXL7TtUX026icqrU5MVjTGkUZRRgtytADThXA9wcfibu0jgzdjPV1l8ZicibOCicp24r7hjlcdd1aMA/132","nickname":"互动教程网","note":"","ucode":"2D17703B153563","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294354,"discussion_content":"如果矢量图片编译时变成了位图，那如果将app安装到手机上，当用户需要将该图片放大时，会不会变模糊？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595859839,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86933,"user_name":"一纸丶荒年","can_delete":false,"product_type":"c1","uid":1458078,"ip_address":"","ucode":"9A4C0364B97780","user_header":"https://static001.geekbang.org/account/avatar/00/16/3f/9e/7a6e6442.jpg","comment_is_top":false,"comment_ctime":1555481447,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5850448743","product_id":100024501,"comment_content":"您好 我想问一下 我们 是 swift的 storyboard的  如何 快速瘦身吖 .  每个storyboard 都有 3M ","like_count":1,"discussions":[{"author":{"id":2031202,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKSibXL7TtUX026icqrU5MVjTGkUZRRgtytADThXA9wcfibu0jgzdjPV1l8ZicibOCicp24r7hjlcdd1aMA/132","nickname":"互动教程网","note":"","ucode":"2D17703B153563","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294353,"discussion_content":"Storyboard其实是xml文件，在Storyboard点击鼠标右键，选择菜单中的[Open as > Source code]命令，就可以显示xml内容。然后拷贝这些xml内容，有很多xml在线压缩的网站，将xml拷贝到这些网站压缩一下，再将压缩后的xml拷贝粘贴到Storyboard的Source code中就可以了。我测试一下，14K的Storyboard可以压缩到10K~","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1595859440,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1456479,"avatar":"https://static001.geekbang.org/account/avatar/00/16/39/5f/fa6acea7.jpg","nickname":"Jason","note":"","ucode":"95FE70493775A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584117,"discussion_content":"不怕麻烦的话，改为代码布局","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660634623,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86188,"user_name":"一纸丶荒年","can_delete":false,"product_type":"c1","uid":1458078,"ip_address":"","ucode":"9A4C0364B97780","user_header":"https://static001.geekbang.org/account/avatar/00/16/3f/9e/7a6e6442.jpg","comment_is_top":false,"comment_ctime":1555320901,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5850288197","product_id":100024501,"comment_content":"您好.  我 用AppCode 的 Code-&gt;Inspect Code 但是接下路的那一步 在哪里吖 Unused code 这个我 没看到 在哪里 选项吖  ","like_count":1},{"had_liked":false,"id":85589,"user_name":"开发小能手","can_delete":false,"product_type":"c1","uid":1107899,"ip_address":"","ucode":"3ED813CBE77009","user_header":"https://static001.geekbang.org/account/avatar/00/10/e7/bb/18eb89fd.jpg","comment_is_top":false,"comment_ctime":1555135218,"is_pvip":false,"replies":[{"id":"30740","content":"元类结构体中的 flag 字段","user_name":"作者回复","user_name_real":"戴铭","uid":"1140280","ctime":1555146293,"ip_address":"","comment_id":85589,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5850102514","product_id":100024501,"comment_content":"请教老师，我在评论中看到老师有提到“元类的flag中记录了什么？”这里的 “flag” 是指isa是一个共用体中每段 “位域” 的含义么？还是指其它的概念？","like_count":1,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"戴铭","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446724,"discussion_content":"元类结构体中的 flag 字段","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555146293,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1147205,"avatar":"https://static001.geekbang.org/account/avatar/00/11/81/45/9aa91b75.jpg","nickname":"矮个子先生😝","note":"","ucode":"2242A457B0E10D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2891,"discussion_content":"如何才能取到flag字段呢,在objc中找了半天没找到","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564021861,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":85387,"user_name":"一纸丶荒年","can_delete":false,"product_type":"c1","uid":1458078,"ip_address":"","ucode":"9A4C0364B97780","user_header":"https://static001.geekbang.org/account/avatar/00/16/3f/9e/7a6e6442.jpg","comment_is_top":false,"comment_ctime":1555050342,"is_pvip":false,"replies":[{"id":"30672","content":"哪个工具？","user_name":"作者回复","user_name_real":"戴铭","uid":"1140280","ctime":1555123496,"ip_address":"","comment_id":85387,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5850017638","product_id":100024501,"comment_content":"您的这个 工具 对于 swfit  和 xib  不适用.  ","like_count":1,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"戴铭","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446652,"discussion_content":"哪个工具？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555123496,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":85356,"user_name":"卓小土","can_delete":false,"product_type":"c1","uid":1017192,"ip_address":"","ucode":"A9EF6BD4D9E961","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ermPNNQAxibOtBseXNLLpnSHica0qGkvyxrgxbAfDT8Y0LuS9yBqjzXksKQW35F3916HcTg9QcxfcOg/132","comment_is_top":false,"comment_ctime":1555043412,"is_pvip":false,"replies":[{"id":"30676","content":"clang 插件篇里会说下","user_name":"作者回复","user_name_real":"戴铭","uid":"1140280","ctime":1555123636,"ip_address":"","comment_id":85356,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5850010708","product_id":100024501,"comment_content":"戴老师为什么没有讲一下，用clang AST分析代码依赖关系，找出无用代码的方法。","like_count":1,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"戴铭","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446645,"discussion_content":"clang 插件篇里会说下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555123636,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":83326,"user_name":"Geek_45fc02","can_delete":false,"product_type":"c1","uid":1457447,"ip_address":"","ucode":"FE074A1594AC7E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJTOicFdCW2hgUwgfiaR9qSGabPvgLorp1Xcd7uLquXibWmKZxJibMsSeqibEpuHoSwusj2kOr86uLAzng/132","comment_is_top":false,"comment_ctime":1554533857,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5849501153","product_id":100024501,"comment_content":"webp作为非官方的图片格式，实用上不够方便，而且不兼容App thinning，看来只能等iOS13，让苹果把图片格式原生兼容HEIC，压缩比又大，解码效率又高！","like_count":1,"discussions":[{"author":{"id":2031202,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKSibXL7TtUX026icqrU5MVjTGkUZRRgtytADThXA9wcfibu0jgzdjPV1l8ZicibOCicp24r7hjlcdd1aMA/132","nickname":"互动教程网","note":"","ucode":"2D17703B153563","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294357,"discussion_content":"苹果设备有针对png图片的显示进行优化，所以并不建议将图片转换为webp，并且使用tinypng已经可以将Png图片很好的压缩了~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595859926,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":82883,"user_name":"邓斌","can_delete":false,"product_type":"c1","uid":1453918,"ip_address":"","ucode":"A516165B893666","user_header":"https://static001.geekbang.org/account/avatar/00/16/2f/5e/e1306e14.jpg","comment_is_top":false,"comment_ctime":1554343149,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5849310445","product_id":100024501,"comment_content":"元类的存在让类本身也相当于一个返利对象，也就是类方法存在的原理。毕竟万物皆对象不是白说的。<br>一种好的设计思想衍生出好的一种使用方法，元类的思路就很典型","like_count":1},{"had_liked":false,"id":82603,"user_name":"易若风云","can_delete":false,"product_type":"c1","uid":1040086,"ip_address":"","ucode":"6FB7B508301FED","user_header":"https://static001.geekbang.org/account/avatar/00/0f/de/d6/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1554257101,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5849224397","product_id":100024501,"comment_content":"一切皆对象，类描述了实例，元类描述了类，谁来描述元类呢？感觉都是设计上的哲学","like_count":1,"discussions":[{"author":{"id":2555047,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/9sicykHGaRicX5LsS0FOlP0rM6OG0HRKhbpCSyn3VbPicQLYVq9Fza5p2Kib5K2nYCHwWs0Trq9UATTmRfAPlIsGQQ/132","nickname":"Geek_43c928","note":"","ucode":"3C4644888F4C1E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391116,"discussion_content":"根元类描述元类呀，谁又描述了跟元类呢？他自己么？却是哲学问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630300132,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":82374,"user_name":"付海龙","can_delete":false,"product_type":"c1","uid":1458266,"ip_address":"","ucode":"3FF14DB91164B6","user_header":"https://static001.geekbang.org/account/avatar/00/16/40/5a/a6545666.jpg","comment_is_top":false,"comment_ctime":1554195118,"is_pvip":false,"replies":[{"id":"29819","content":"是支持矢量图的，矢量图编译后会生成2x、3x 图","user_name":"作者回复","user_name_real":"戴铭","uid":"1140280","ctime":1554201241,"ip_address":"","comment_id":82374,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5849162414","product_id":100024501,"comment_content":"相比于2x和3x两套资源，用矢量图一套资源搞定所有，这样会不会更好一点","like_count":1,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"戴铭","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445570,"discussion_content":"是支持矢量图的，矢量图编译后会生成2x、3x 图","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554201241,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":82289,"user_name":"西北旺车神","can_delete":false,"product_type":"c1","uid":1201365,"ip_address":"","ucode":"970E700813753F","user_header":"https://static001.geekbang.org/account/avatar/00/12/54/d5/aa49de6b.jpg","comment_is_top":false,"comment_ctime":1554176774,"is_pvip":false,"replies":[{"id":"29810","content":"对，也包括不用数据线连 iTunes 的情况","user_name":"作者回复","user_name_real":"戴铭","uid":"1140280","ctime":1554198673,"ip_address":"","comment_id":82289,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5849144070","product_id":100024501,"comment_content":"OTA并不是单指蜂窝网络吧，我觉得是指不用连电脑iTunes下载了","like_count":1,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"戴铭","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445538,"discussion_content":"对，也包括不用数据线连 iTunes 的情况","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554198673,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":323556,"user_name":"Geek6557","can_delete":false,"product_type":"c1","uid":2206800,"ip_address":"","ucode":"5C55E3EE71F234","user_header":"","comment_is_top":false,"comment_ctime":1637987652,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637987652","product_id":100024501,"comment_content":"现在已经没有150M的限制了。","like_count":0},{"had_liked":false,"id":294587,"user_name":"涂海生","can_delete":false,"product_type":"c1","uid":1015911,"ip_address":"","ucode":"E3DA62CF9A7745","user_header":"https://static001.geekbang.org/account/avatar/00/0f/80/67/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1622010226,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622010226","product_id":100024501,"comment_content":"SMCheckProject 这个库都运行不起来，能否及时修复下，这么好的库，这么好的想法","like_count":0},{"had_liked":false,"id":280676,"user_name":"yuec","can_delete":false,"product_type":"c1","uid":1535110,"ip_address":"","ucode":"A26FD0938BF71B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ZccFBM9wqKWZAicq7rN3tJChpznHB6lXW1ag8n9zPEJfApSjcoozoiappwah0617cCUFtzPbWm41eicPyztHa0TBg/132","comment_is_top":false,"comment_ctime":1614313104,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1614313104","product_id":100024501,"comment_content":"https:&#47;&#47;github.com&#47;xuezhulian&#47;classunref 检测无用类的脚本","like_count":0},{"had_liked":false,"id":238666,"user_name":"zhonglaoban","can_delete":false,"product_type":"c1","uid":1160792,"ip_address":"","ucode":"F570E9D65EC004","user_header":"https://static001.geekbang.org/account/avatar/00/11/b6/58/f0cb60be.jpg","comment_is_top":false,"comment_ctime":1596253740,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596253740","product_id":100024501,"comment_content":"如果项目里有单元测试，就可以通过覆盖率，来很好的找到无用代码。","like_count":0},{"had_liked":false,"id":202910,"user_name":"InfoQ_0eff9c065756","can_delete":false,"product_type":"c1","uid":1300013,"ip_address":"","ucode":"26282CA3D07F48","user_header":"","comment_is_top":false,"comment_ctime":1586083767,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586083767","product_id":100024501,"comment_content":"关于使用isInitialized运行时扫描检测iOS无用类，想请教下检测的时机应该放在什么位置好，因为自定义的所有类被分布在应用的各个模块，每个页面被加载时才能判断类时候被使用，如果按照这个逻辑，那就相当于每个ViewController开始生命周期时都需要检测判断未被使用的类，或者是我的思路是错误的，还望作者给予一些提示建议。","like_count":0},{"had_liked":false,"id":174224,"user_name":"@许还真","can_delete":false,"product_type":"c1","uid":1099324,"ip_address":"","ucode":"6D754D5AE44CEC","user_header":"https://static001.geekbang.org/account/avatar/00/10/c6/3c/8ab9deb0.jpg","comment_is_top":false,"comment_ctime":1580096943,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1580096943","product_id":100024501,"comment_content":"学习了 这种思考方式不是为了考试 而是探究过程。考察思考深度 ","like_count":0},{"had_liked":false,"id":153427,"user_name":"sacrifice","can_delete":false,"product_type":"c1","uid":1282844,"ip_address":"","ucode":"2DEEB2C0789837","user_header":"https://static001.geekbang.org/account/avatar/00/13/93/1c/c547b2b1.jpg","comment_is_top":false,"comment_ctime":1574234391,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"1574234391","product_id":100024501,"comment_content":"请问我的应用一共包含40M图片，ipa包大小196M，我把所有放在assets管理的图片都删了打包为80M左右，assets里全部换成wepb图片，最终打包110多M，我很困惑，这个瘦身过程是不是有问题？不知道最终放在APPstore上会有多大","like_count":0,"discussions":[{"author":{"id":1039568,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/dc/d0/2d53c369.jpg","nickname":"Three","note":"","ucode":"B42B4763DAB427","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":54963,"discussion_content":"我跟你遇到一样的问题了，我觉得作者这儿的具体操作讲的不是很明白，我是通过 adhoc 打出指定设备的 ipa 来对比的，将>100k 的图片资源替换为 webp 移出 assets 放到 bundle 里会增大 ipa 的大小 (我没有找到 assets 管理 webp 的方法)，因为享受不到编译时 xcode 对 assets 的压缩的好处了。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1574329689,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2031202,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKSibXL7TtUX026icqrU5MVjTGkUZRRgtytADThXA9wcfibu0jgzdjPV1l8ZicibOCicp24r7hjlcdd1aMA/132","nickname":"互动教程网","note":"","ucode":"2D17703B153563","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294358,"discussion_content":"苹果设备有针对png图片的显示进行优化，所以并不建议将图片转换为webp，并且使用tinypng工具已经可以将Png图片很好的压缩了~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595859966,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1039568,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/dc/d0/2d53c369.jpg","nickname":"Three","note":"","ucode":"B42B4763DAB427","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":54965,"discussion_content":" WWDC 有一节是针对 assets 做的压缩的讲解https://developer.apple.com/videos/play/wwdc2018/227/  ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574329746,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":146359,"user_name":"我很酷","can_delete":false,"product_type":"c1","uid":1457327,"ip_address":"","ucode":"56B27CAC3E1998","user_header":"https://static001.geekbang.org/account/avatar/00/16/3c/af/8e3baaf4.jpg","comment_is_top":false,"comment_ctime":1572505306,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1572505306","product_id":100024501,"comment_content":"为什么我获取的都是没有初始化的呢。。<br> Class cls = NSClassFromString(className);<br>        struct class_rw_t *rw = getClassBits(cls) &amp; FAST_DATA_MASK;<br>        if (!(rw-&gt;flags &amp; (RW_INITIALIZED | RW_INITIALIZING))) {<br>            [resultArray addObject:cls];<br>        }","like_count":0,"discussions":[{"author":{"id":1039568,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/dc/d0/2d53c369.jpg","nickname":"Three","note":"","ucode":"B42B4763DAB427","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":49601,"discussion_content":"运行时的这些类 struct class_rw_t * 你是怎么引入的？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573615829,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":144291,"user_name":"欢乐马","can_delete":false,"product_type":"c1","uid":1711961,"ip_address":"","ucode":"18970C8ADC41E8","user_header":"https://static001.geekbang.org/account/avatar/00/1a/1f/59/cd59fca8.jpg","comment_is_top":false,"comment_ctime":1571888338,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571888338","product_id":100024501,"comment_content":"iossupportmatrix.com 这个网站打不开了","like_count":0},{"had_liked":false,"id":128867,"user_name":"明星","can_delete":false,"product_type":"c1","uid":1131192,"ip_address":"","ucode":"2790C140198085","user_header":"https://static001.geekbang.org/account/avatar/00/11/42/b8/08a6d7d9.jpg","comment_is_top":false,"comment_ctime":1566978305,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566978305","product_id":100024501,"comment_content":"老师好，我尝试在运行时检测未使用的类时发现isInitialized并没有暴露给我们。请问您是如何实现的呢？","like_count":0},{"had_liked":false,"id":109536,"user_name":"Bill","can_delete":false,"product_type":"c1","uid":1273035,"ip_address":"","ucode":"DAF34E50CF3434","user_header":"https://static001.geekbang.org/account/avatar/00/13/6c/cb/8a41f8ce.jpg","comment_is_top":false,"comment_ctime":1562053236,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562053236","product_id":100024501,"comment_content":"是否可以在介绍下瘦身之后的后续监控方法，比如包大小和资源大小的分析和数据可视化","like_count":0},{"had_liked":false,"id":100342,"user_name":"李小草","can_delete":false,"product_type":"c1","uid":1240476,"ip_address":"","ucode":"83DAA0BFDC2068","user_header":"https://static001.geekbang.org/account/avatar/00/12/ed/9c/7afa883f.jpg","comment_is_top":false,"comment_ctime":1559531582,"is_pvip":false,"replies":[{"id":"38599","content":"可以删掉","user_name":"作者回复","user_name_real":"戴铭","uid":"1140280","ctime":1561387338,"ip_address":"","comment_id":100342,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1559531582","product_id":100024501,"comment_content":"之前开发遇到过提供三方sdk的公司提供了两个版本，一个版本带模拟器指令集（支持模拟器的），一个版本是不带模拟器的，只支持arm真机，上线时切换下，这样可以减小包得体积，请问老师这样对吗？如果这样真能减小包体积的话，那我是不是可以把所有三方sdk中模拟器指令集都剔除掉？","like_count":0,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"戴铭","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452507,"discussion_content":"可以删掉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561387338,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1209800,"avatar":"https://static001.geekbang.org/account/avatar/00/12/75/c8/e2bfb44c.jpg","nickname":"sunnyda","note":"","ucode":"BD941A4D2B83E4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":39904,"discussion_content":"我怎么记得打release包的时候苹果会自动去掉模拟器指令集的支持呢。。求证实","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572013853,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99650,"user_name":"GODV","can_delete":false,"product_type":"c1","uid":1454163,"ip_address":"","ucode":"DB311A5D9EE770","user_header":"https://static001.geekbang.org/account/avatar/00/16/30/53/01a6c4da.jpg","comment_is_top":false,"comment_ctime":1559273458,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1559273458","product_id":100024501,"comment_content":"MachOView下载好，运行不了","like_count":0,"discussions":[{"author":{"id":1409087,"avatar":"https://static001.geekbang.org/account/avatar/00/15/80/3f/bc65b009.jpg","nickname":"Yest","note":"","ucode":"1E82B6355890C0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":795,"discussion_content":"是啊，使用MachOView打开，界面开了几秒钟后崩溃了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562062078,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":95347,"user_name":"Geek_462d99","can_delete":false,"product_type":"c1","uid":1483085,"ip_address":"","ucode":"856996824B91C3","user_header":"https://static001.geekbang.org/account/avatar/00/16/a1/4d/107d8201.jpg","comment_is_top":false,"comment_ctime":1558024945,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558024945","product_id":100024501,"comment_content":"代码瘦身补充一条：删除工程中的野鸡开源代码，尽量自己造轮子或者使用系统提供的方法。我们的App 2.0版本优化，把非必需的开源代码和库删了自己造轮子，打包下来少了16M。","like_count":0},{"had_liked":false,"id":93108,"user_name":"Geek_fd2ec3","can_delete":false,"product_type":"c1","uid":1430042,"ip_address":"","ucode":"F61F9E228B4EFA","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL8bkxdc5LXXZJWia2EBD8kIM3ic9KiaVibqVGicHyeHCB8GXvLOaDNMxSVqMnnnFRrlf6BDuYtcoLUribw/132","comment_is_top":false,"comment_ctime":1557399153,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557399153","product_id":100024501,"comment_content":"你好， 请问怎么查看引入的每个第三方有多大","like_count":0},{"had_liked":false,"id":88472,"user_name":"不白吃飯","can_delete":false,"product_type":"c1","uid":1306368,"ip_address":"","ucode":"C9768FA5AA40CE","user_header":"https://static001.geekbang.org/account/avatar/00/13/ef/00/adc0188b.jpg","comment_is_top":false,"comment_ctime":1555926618,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555926618","product_id":100024501,"comment_content":"元类的flag，面试的时候提这些细节吗。这些两年前做某个topic研究透了，两年之后想必也忘了吧。","like_count":0},{"had_liked":false,"id":85998,"user_name":"一纸丶荒年","can_delete":false,"product_type":"c1","uid":1458078,"ip_address":"","ucode":"9A4C0364B97780","user_header":"https://static001.geekbang.org/account/avatar/00/16/3f/9e/7a6e6442.jpg","comment_is_top":false,"comment_ctime":1555301053,"is_pvip":false,"replies":[{"id":"32678","content":"https:&#47;&#47;www.jetbrains.com&#47;objc&#47;features&#47;code-analysis.html","user_name":"作者回复","user_name_real":"戴铭","uid":"1140280","ctime":1556893306,"ip_address":"","comment_id":85998,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1555301053","product_id":100024501,"comment_content":"你好 我下载了 AppCode 工具. 但是 我选择不了 code-&gt;inspectCode 吖 ","like_count":0,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"戴铭","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446878,"discussion_content":"https://www.jetbrains.com/objc/features/code-analysis.html","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556893306,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2583710,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLf83hK8eSmqia43jSftGNsZMBISQHl5BusCF2icXCs055z52sLjAkibUGViao8ibEMNNrQXHy9sTP2VoA/132","nickname":"Geek_193c78","note":"","ucode":"FDE63396C71891","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372783,"discussion_content":"跑一下工程就行了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620462481,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":85948,"user_name":"一纸丶荒年","can_delete":false,"product_type":"c1","uid":1458078,"ip_address":"","ucode":"9A4C0364B97780","user_header":"https://static001.geekbang.org/account/avatar/00/16/3f/9e/7a6e6442.jpg","comment_is_top":false,"comment_ctime":1555297939,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555297939","product_id":100024501,"comment_content":"LSUnuawseResources  这个工具 对于 xib 和swfit  是 不适用的","like_count":0},{"had_liked":false,"id":84199,"user_name":"chdo","can_delete":false,"product_type":"c1","uid":1456611,"ip_address":"","ucode":"A7E64890A00F60","user_header":"https://static001.geekbang.org/account/avatar/00/16/39/e3/66901f8a.jpg","comment_is_top":false,"comment_ctime":1554802308,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554802308","product_id":100024501,"comment_content":"老师， 我将动态库都换成静态库打包后，IPA的包大小反而比之前的更大，包在66M左右，增大了2M多，和您文章中关于静态库换动态库体积会变大这点不一样。<br>想请问。不知道是我理解错误还是有其他什么点需要注意吗？<br>另外，为什么，代码转为动态库和静态库的包大小是不一样的呢？","like_count":0},{"had_liked":false,"id":84177,"user_name":"毒手疯波","can_delete":false,"product_type":"c1","uid":1233103,"ip_address":"","ucode":"8A1FEFCB4F9E04","user_header":"https://static001.geekbang.org/account/avatar/00/12/d0/cf/de533406.jpg","comment_is_top":false,"comment_ctime":1554798157,"is_pvip":false,"replies":[{"id":"30732","content":"App Thinning 会去掉","user_name":"作者回复","user_name_real":"戴铭","uid":"1140280","ctime":1555145266,"ip_address":"","comment_id":84177,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1554798157","product_id":100024501,"comment_content":"framework中的i386和x86_64会打包进release app里么？","like_count":0,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"戴铭","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446269,"discussion_content":"App Thinning 会去掉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555145266,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":82904,"user_name":"Vicky","can_delete":false,"product_type":"c1","uid":1200641,"ip_address":"","ucode":"6F802C8AF8090E","user_header":"https://static001.geekbang.org/account/avatar/00/12/52/01/a8d3db35.jpg","comment_is_top":false,"comment_ctime":1554346606,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554346606","product_id":100024501,"comment_content":"@Normal, imageoptim里有个解释，不知道是不是你包变大的原因 可以参考一下<br>https:&#47;&#47;imageoptim.com&#47;xcode.html","like_count":0},{"had_liked":false,"id":82873,"user_name":"cc","can_delete":false,"product_type":"c1","uid":1002753,"ip_address":"","ucode":"E0ECBFD76DC43C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI34ZlT6HSOtMvxyyds7fNup6XWUU9NdgpGvrXmT7YkhL61HTZGmKtleSianjKVicxjTj5MrXmcc4Jg/132","comment_is_top":false,"comment_ctime":1554341832,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554341832","product_id":100024501,"comment_content":"老师，请问下我们通过Xcode archive 出来的不同机型的变体包（17M左右）跟AppStore上显示的包大小(38M左右)，为什么相差了一倍多。<br>我查了下，由于app提交至App Store 时会进行加密压缩等处理，在App Store上的二进制文件会比实际上传的二进制文件要大。<br><br>但对于相差一倍多这个还是有点过大，请问下老师还有其他解释原因吗","like_count":0},{"had_liked":false,"id":82611,"user_name":"hopestar90","can_delete":false,"product_type":"c1","uid":1457492,"ip_address":"","ucode":"99F2A5664FE1F0","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epVhRFBLPOic3kUju3dkpmwEeI1aBxy7WSGtq5smkicKz4bTbicsSElekSjnBhCQvibncVOHBHeY6pnuA/132","comment_is_top":false,"comment_ctime":1554259253,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554259253","product_id":100024501,"comment_content":"戴铭老师，仔细去看了下源码，其实没有特别想明白类要设计成两个结构体，是因为本身类也是对象，然后需要存储一些实例共有的信息吗？想听戴老师详细说说这里","like_count":0},{"had_liked":false,"id":82557,"user_name":"Taylor","can_delete":false,"product_type":"c1","uid":1142863,"ip_address":"","ucode":"A8CD1F86C64472","user_header":"https://static001.geekbang.org/account/avatar/00/11/70/4f/f657a5b6.jpg","comment_is_top":false,"comment_ctime":1554251677,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554251677","product_id":100024501,"comment_content":"swift代码怎么检查呢？ 用了一些工具都不是非常准确。非常希望Xcode自身能提供这样的功能。","like_count":0},{"had_liked":false,"id":82480,"user_name":"skywalker","can_delete":false,"product_type":"c1","uid":1453861,"ip_address":"","ucode":"2BBCC9D6562F5D","user_header":"https://static001.geekbang.org/account/avatar/00/16/2f/25/2d2cc1c5.jpg","comment_is_top":false,"comment_ctime":1554220690,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554220690","product_id":100024501,"comment_content":"元类那边我之前就只了解到isa指针找父类的作用，flag什么的都没了解到过。😢然后刚刚看了点学习视频，发现用位域来存储信息的想法实在是太厉害了，我的天。","like_count":0},{"had_liked":false,"id":82361,"user_name":"付海龙","can_delete":false,"product_type":"c1","uid":1458266,"ip_address":"","ucode":"3FF14DB91164B6","user_header":"https://static001.geekbang.org/account/avatar/00/16/40/5a/a6545666.jpg","comment_is_top":false,"comment_ctime":1554192934,"is_pvip":false,"replies":[{"id":"29809","content":"那效果会打折扣","user_name":"作者回复","user_name_real":"戴铭","uid":"1140280","ctime":1554198539,"ip_address":"","comment_id":82361,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1554192934","product_id":100024501,"comment_content":"在资源图片上，我都是直接用的2x图，像plus等机型也都是直接找的2x","like_count":0,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"戴铭","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445565,"discussion_content":"那效果会打折扣","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554198539,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":82338,"user_name":"学无止境","can_delete":false,"product_type":"c1","uid":1350473,"ip_address":"","ucode":"FC13803A5A3E9E","user_header":"https://static001.geekbang.org/account/avatar/00/14/9b/49/33b2da58.jpg","comment_is_top":false,"comment_ctime":1554187425,"is_pvip":false,"replies":[{"id":"29808","content":"也可以添加","user_name":"作者回复","user_name_real":"戴铭","uid":"1140280","ctime":1554198470,"ip_address":"","comment_id":82338,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1554187425","product_id":100024501,"comment_content":"添加 xcassets 目录?<br>Xcode不是自带的有Assets.xcassets吗？<br>","like_count":0,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"戴铭","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445558,"discussion_content":"也可以添加","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554198470,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":82310,"user_name":"lyp","can_delete":false,"product_type":"c1","uid":1254378,"ip_address":"","ucode":"F2BC8254786546","user_header":"https://static001.geekbang.org/account/avatar/00/13/23/ea/54623a8c.jpg","comment_is_top":false,"comment_ctime":1554183040,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1554183040","product_id":100024501,"comment_content":"TinyPng或ImageOptim压缩png后打包成ipa后包的大小好像不会变（自己测试的时候），请问你们的ipa包会有变化吗，怎么操作的。（记得头条有一片文章也说过打包后不会变化的）<br>","like_count":1,"discussions":[{"author":{"id":2031202,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKSibXL7TtUX026icqrU5MVjTGkUZRRgtytADThXA9wcfibu0jgzdjPV1l8ZicibOCicp24r7hjlcdd1aMA/132","nickname":"互动教程网","note":"","ucode":"2D17703B153563","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294360,"discussion_content":"如果你已经将图片进行了压缩，就需要将Build Settings中的Compress PNG Files的选项设置为NO。否则Xcode会对你已经压缩的图片再进行压缩，这样反而导致图片会变大~","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1595860155,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":82245,"user_name":"Geek_9ce039","can_delete":false,"product_type":"c1","uid":1457660,"ip_address":"","ucode":"288D9E4718B416","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqDKUpqREhNOz85DXxTX1OntEZPhoF4yCxkSKVUN4vKOvibZ3sfRoUg4rypd6nDbx2L5iabrFibVRolQ/132","comment_is_top":false,"comment_ctime":1554168651,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554168651","product_id":100024501,"comment_content":"我们 APP 处于 OC 转 Swift 的过程中, 包大小也是超标很多, 用的一些工具类也是双份的, 比如: AFNetwork -&gt; Alamofire, 优化空间还是很大的. 试试老师的文案","like_count":0},{"had_liked":false,"id":82206,"user_name":"棒棒彬👻","can_delete":false,"product_type":"c1","uid":1039012,"ip_address":"","ucode":"1FF0CDD12107EE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/da/a4/17a2d602.jpg","comment_is_top":false,"comment_ctime":1554164031,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554164031","product_id":100024501,"comment_content":"正好最近在讨论包大小的问题👍","like_count":0},{"had_liked":false,"id":82185,"user_name":"金子菇凉的铁粉小逗","can_delete":false,"product_type":"c1","uid":1000602,"ip_address":"","ucode":"6A2C601F6EEBB5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/44/9a/c03bea17.jpg","comment_is_top":false,"comment_ctime":1554140672,"is_pvip":false,"replies":[{"id":"29802","content":"都是资源大小","user_name":"作者回复","user_name_real":"戴铭","uid":"1140280","ctime":1554175963,"ip_address":"","comment_id":82185,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1554140672","product_id":100024501,"comment_content":"王者荣耀和吃鸡这样的游戏为啥可以几个GB","like_count":0,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"戴铭","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445501,"discussion_content":"都是资源大小","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554175963,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":82174,"user_name":"麟の🏸","can_delete":false,"product_type":"c1","uid":1456942,"ip_address":"","ucode":"6EA2A9D777AF6B","user_header":"https://static001.geekbang.org/account/avatar/00/16/3b/2e/b961e496.jpg","comment_is_top":false,"comment_ctime":1554134634,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554134634","product_id":100024501,"comment_content":"哇，刚过零点就更新了，厉害！","like_count":0}]}