{"id":597664,"title":"03ï½œTokenï¼šå¦‚ä½•é™ä½ç”¨æˆ·èº«ä»½é‰´æƒçš„æµé‡å‹åŠ›ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å¾é•¿é¾™ï¼Œè¿™èŠ‚è¯¾æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ç”¨tokenç®—æ³•é™ä½ç”¨æˆ·ä¸­å¿ƒçš„èº«ä»½é‰´æƒæµé‡å‹åŠ›ã€‚</p><p>å¾ˆå¤šç½‘ç«™åˆæœŸé€šå¸¸ä¼šç”¨Sessionæ–¹å¼å®ç°ç™»å½•ç”¨æˆ·çš„ç”¨æˆ·é‰´æƒï¼Œä¹Ÿå°±æ˜¯åœ¨ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œå°†è¿™ä¸ªç”¨æˆ·çš„å…·ä½“ä¿¡æ¯å†™åœ¨æœåŠ¡ç«¯çš„Sessionç¼“å­˜ä¸­ï¼Œå¹¶åˆ†é…ä¸€ä¸ªsession_idä¿å­˜åœ¨ç”¨æˆ·çš„Cookieä¸­ã€‚è¯¥ç”¨æˆ·çš„æ¯æ¬¡è¯·æ±‚æ—¶å€™éƒ½ä¼šå¸¦ä¸Šè¿™ä¸ªIDï¼Œé€šè¿‡IDå¯ä»¥è·å–åˆ°ç™»å½•æ—¶å†™å…¥æœåŠ¡ç«¯Sessionç¼“å­˜ä¸­çš„è®°å½•ã€‚</p><p>æµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/58/72/589d13f1d758a44a1af37efaf9dbdc72.jpg?wh=3330x2141\" alt=\"\" title=\"Session Cacheå®ç°çš„ç”¨æˆ·é‰´æƒ\"></p><p>è¿™ç§æ–¹å¼çš„å¥½å¤„åœ¨äºä¿¡æ¯éƒ½åœ¨æœåŠ¡ç«¯å‚¨å­˜ï¼Œå¯¹å®¢æˆ·ç«¯ä¸æš´éœ²ä»»ä½•ç”¨æˆ·æ•æ„Ÿçš„æ•°æ®ä¿¡æ¯ï¼Œå¹¶ä¸”æ¯ä¸ªç™»å½•ç”¨æˆ·éƒ½æœ‰å…±äº«çš„ç¼“å­˜ç©ºé—´ï¼ˆSession Cacheï¼‰ã€‚</p><p>ä½†æ˜¯éšç€æµé‡çš„å¢é•¿ï¼Œè¿™ä¸ªè®¾è®¡ä¹Ÿæš´éœ²å‡ºå¾ˆå¤§çš„é—®é¢˜â€”â€”ç”¨æˆ·ä¸­å¿ƒçš„èº«ä»½é‰´æƒåœ¨å¤§æµé‡ä¸‹å¾ˆä¸ç¨³å®šã€‚å› ä¸ºç”¨æˆ·ä¸­å¿ƒéœ€è¦ç»´æŠ¤çš„Session Cacheç©ºé—´å¾ˆå¤§ï¼Œå¹¶ä¸”è¢«å„ä¸ªä¸šåŠ¡é¢‘ç¹è®¿é—®ï¼Œé‚£ä¹ˆç¼“å­˜ä¸€æ—¦å‡ºç°æ•…éšœï¼Œå°±ä¼šå¯¼è‡´æ‰€æœ‰çš„å­ç³»ç»Ÿæ— æ³•ç¡®è®¤ç”¨æˆ·èº«ä»½ï¼Œè¿›è€Œæ— æ³•æ­£å¸¸å¯¹å¤–æœåŠ¡ã€‚</p><p>è¿™ä¸»è¦æ˜¯ç”±äºSession Cacheå’Œå„ä¸ªå­ç³»ç»Ÿçš„è€¦åˆæé«˜ï¼Œ<strong>å…¨ç«™çš„è¯·æ±‚éƒ½ä¼šå¯¹è¿™ä¸ªç¼“å­˜è‡³å°‘è®¿é—®ä¸€æ¬¡</strong>ï¼Œè¿™å°±å¯¼è‡´ç¼“å­˜çš„å†…å®¹é•¿åº¦å’Œå“åº”é€Ÿåº¦ï¼Œç›´æ¥å†³å®šäº†å…¨ç«™çš„QPSä¸Šé™ï¼Œè®©æ•´ä¸ªç³»ç»Ÿçš„éš”ç¦»æ€§å¾ˆå·®ï¼Œå„å­ç³»ç»Ÿé—´ææ˜“ç›¸äº’å½±å“ã€‚</p><p>é‚£ä¹ˆï¼Œå¦‚ä½•é™ä½ç”¨æˆ·ä¸­å¿ƒä¸å„ä¸ªå­ç³»ç»Ÿé—´çš„è€¦åˆåº¦ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½å‘¢ï¼Ÿæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ã€‚</p><!-- [[[read_end]]] --><h2>JWTç™»é™†å’Œtokenæ ¡éªŒ</h2><p>å¸¸è§æ–¹å¼æ˜¯é‡‡ç”¨ç­¾ååŠ å¯†çš„tokenï¼Œè¿™æ˜¯ç™»å½•çš„ä¸€ä¸ªè¡Œä¸šæ ‡å‡†ï¼Œå³JWTï¼ˆJSON Web Tokenï¼‰ï¼š<img src=\"https://static001.geekbang.org/resource/image/02/bf/02f2f3aff0f5db68ef952065da2721bf.jpg?wh=3330x2141\" alt=\"\" title=\"tokenæµç¨‹\"></p><p>ä¸Šå›¾å°±æ˜¯JWTçš„ç™»é™†æµç¨‹ï¼Œç”¨æˆ·ç™»å½•åä¼šå°†ç”¨æˆ·ä¿¡æ¯æ”¾åˆ°ä¸€ä¸ªåŠ å¯†ç­¾åçš„tokenä¸­ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½æŠŠè¿™ä¸ªä¸²æ”¾åˆ°headeræˆ–cookieå†…å¸¦åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ç›´æ¥å°†è¿™ä¸ªtokenè§£å¼€å³å¯ç›´æ¥è·å–åˆ°ç”¨æˆ·çš„ä¿¡æ¯ï¼Œæ— éœ€å’Œç”¨æˆ·ä¸­å¿ƒåšä»»ä½•äº¤äº’è¯·æ±‚ã€‚</p><p>tokenç”Ÿæˆä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-go\">import \"github.com/dgrijalva/jwt-go\"\n\n//ç­¾åæ‰€éœ€æ··æ·†å¯†é’¥ ä¸è¦å¤ªç®€å• å®¹æ˜“è¢«ç ´è§£\n//ä¹Ÿå¯ä»¥ä½¿ç”¨éå¯¹ç§°åŠ å¯†ï¼Œè¿™æ ·å¯ä»¥åœ¨å®¢æˆ·ç«¯ç”¨å…¬é’¥éªŒç­¾\nvar secretString = []byte(\"jwt secret string 137 rick\") \n\ntype TokenPayLoad struct {\n    UserId   uint64 `json:\"userId\"` //ç”¨æˆ·id\n    NickName string `json:\"nickname\"` //æ˜µç§°\n    jwt.StandardClaims //ç§æœ‰éƒ¨åˆ†\n}\n\n// ç”ŸæˆJWT token\nfunc GenToken(userId uint64, nickname string) (string, error) {\n    c := TokenPayLoad{\n        UserId: userId, //uid\n        NickName: nickname, //æ˜µç§°\n        //è¿™é‡Œå¯ä»¥è¿½åŠ ä¸€äº›å…¶ä»–åŠ å¯†çš„æ•°æ®è¿›æ¥\n        //ä¸è¦æ˜æ–‡æ”¾æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚æœéœ€è¦æ”¾ï¼Œå¿…é¡»å†åŠ å¯†\n        \n        //ç§æœ‰éƒ¨åˆ†\n        StandardClaims: jwt.StandardClaims{\n            //ä¸¤å°æ—¶åå¤±æ•ˆ\n            ExpiresAt: time.Now().Add(2 * time.Hour).Unix(),\n            //é¢å‘è€…\n            Issuer:    \"geekbang\",\n        },\n    }\n    //åˆ›å»ºç­¾å ä½¿ç”¨hs256\n    token := jwt.NewWithClaims(jwt.SigningMethodHS256, c)\n    // ç­¾åï¼Œè·å–tokenç»“æœ\n    return token.SignedString(secretString)\n}\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªtokenå†…éƒ¨åŒ…å«è¿‡æœŸæ—¶é—´ï¼Œå¿«è¿‡æœŸçš„tokenä¼šåœ¨å®¢æˆ·ç«¯è‡ªåŠ¨å’ŒæœåŠ¡ç«¯é€šè®¯æ›´æ¢ï¼Œè¿™ç§æ–¹å¼å¯ä»¥å¤§å¹…æé«˜æˆªå–å®¢æˆ·ç«¯tokenå¹¶ä¼ªé€ ç”¨æˆ·èº«ä»½çš„éš¾åº¦ã€‚</p><p>åŒæ—¶ï¼ŒæœåŠ¡ç«¯ä¹Ÿå¯ä»¥å’Œç”¨æˆ·ä¸­å¿ƒè§£è€¦ï¼Œä¸šåŠ¡æœåŠ¡ç«¯ç›´æ¥è§£æè¯·æ±‚å¸¦æ¥çš„tokenå³å¯è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œæ— éœ€æ¯æ¬¡è¯·æ±‚éƒ½å»ç”¨æˆ·ä¸­å¿ƒè·å–ã€‚è€Œtokençš„åˆ·æ–°å¯ä»¥å®Œå…¨ç”±Appå®¢æˆ·ç«¯ä¸»åŠ¨è¯·æ±‚ç”¨æˆ·ä¸­å¿ƒæ¥å®Œæˆï¼Œè€Œä¸å†éœ€è¦ä¸šåŠ¡æœåŠ¡ç«¯ä¸šåŠ¡è¯·æ±‚ç”¨æˆ·ä¸­å¿ƒå»æ›´æ¢ã€‚</p><p>JWTæ˜¯å¦‚ä½•ä¿è¯æ•°æ®ä¸ä¼šè¢«ç¯¡æ”¹ï¼Œå¹¶ä¸”ä¿è¯æ•°æ®çš„å®Œæ•´æ€§å‘¢ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹å®ƒçš„ç»„æˆã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/24/f6/240a6a36f0fbcd177e990411abbb8df6.jpg?wh=1920x501\" alt=\"å›¾ç‰‡\"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒåŠ å¯†ç­¾åçš„tokenåˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼Œå½¼æ­¤ä¹‹é—´ç”¨ç‚¹æ¥åˆ†å‰²ï¼Œå…¶ä¸­ï¼ŒHeaderç”¨æ¥ä¿å­˜åŠ å¯†ç®—æ³•ç±»å‹ï¼›PayLoadæ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„å†…å®¹ï¼›Signatureæ˜¯é˜²ç¯¡æ”¹ç­¾åã€‚</p><p>JWT tokenè§£å¯†åçš„æ•°æ®ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><pre><code class=\"language-json\">//header\n//åŠ å¯†å¤´\n{\n&nbsp; \"alg\": \"HS256\", // åŠ å¯†ç®—æ³•ï¼Œæ³¨æ„æ£€æµ‹ä¸ªåˆ«æ”»å‡»ä¼šåœ¨è¿™é‡Œè®¾ç½®ä¸ºnoneç»•è¿‡ç­¾å\n&nbsp; \"typ\": \"JWT\" //åè®®ç±»å‹\n}\n\n//PAYLOAD\n//è´Ÿè½½éƒ¨åˆ†ï¼Œå­˜åœ¨JWTæ ‡å‡†å­—æ®µåŠæˆ‘ä»¬è‡ªå®šä¹‰çš„æ•°æ®å­—æ®µ\n{\n&nbsp; \"userid\": \"9527\", //æˆ‘ä»¬æ”¾çš„ä¸€äº›æ˜æ–‡ä¿¡æ¯ï¼Œå¦‚æœæ¶‰åŠæ•æ„Ÿä¿¡æ¯ï¼Œå»ºè®®å†æ¬¡åŠ å¯†\n&nbsp; \"nickname\": \"Rick.Xu\", // æˆ‘ä»¬æ”¾çš„ä¸€äº›æ˜æ–‡ä¿¡æ¯ï¼Œå¦‚æœæ¶‰åŠéšç§ï¼Œå»ºè®®å†æ¬¡åŠ å¯†\n  \"iss\": \"geekbang\",\n&nbsp; \"iat\": 1516239022, //tokenå‘æ”¾æ—¶é—´\n  \"exp\": 1516246222, //tokenè¿‡æœŸæ—¶é—´\n}\n\n//ç­¾å\n//ç­¾åç”¨äºé‰´å®šä¸Šä¸¤æ®µå†…å®¹æ˜¯å¦è¢«ç¯¡æ”¹ï¼Œå¦‚æœç¯¡æ”¹é‚£ä¹ˆç­¾åä¼šå‘ç”Ÿå˜åŒ–\n//æ ¡éªŒæ—¶ä¼šå¯¹ä¸ä¸Š\n</code></pre><p>JWTå¦‚ä½•éªŒè¯tokenæ˜¯å¦æœ‰æ•ˆï¼Œè¿˜æœ‰tokenæ˜¯å¦è¿‡æœŸã€æ˜¯å¦åˆæ³•ï¼Œå…·ä½“æ–¹æ³•å¦‚ä¸‹ï¼š</p><pre><code class=\"language-go\">func DecodeToken(token string) (*TokenPayLoad, error) {\n    token, err := jwt.ParseWithClaims(token, &amp;TokenPayLoad{}, func(tk *jwt.Token) (interface{}, error) {\n        return secret, nil\n    })\n    if err != nil {\n        return nil, err\n    }\n    if decodeToken, ok := token.Claims.(*TokenPayLoad); ok &amp;&amp; token.Valid {\n        return decodeToken, nil\n    }\n    return nil, errors.New(\"token wrong\")\n}\n</code></pre><p>JWTçš„tokenè§£å¯†å¾ˆç®€å•ï¼Œç¬¬ä¸€æ®µå’Œç¬¬äºŒæ®µéƒ½æ˜¯é€šè¿‡base64ç¼–ç çš„ã€‚ç›´æ¥è§£å¼€è¿™ä¸¤æ®µæ•°æ®å°±å¯ä»¥æ‹¿åˆ°payloadä¸­æ‰€æœ‰çš„æ•°æ®ï¼Œå…¶ä¸­åŒ…æ‹¬ç”¨æˆ·æ˜µç§°ã€uidã€ç”¨æˆ·æƒé™å’Œtokenè¿‡æœŸæ—¶é—´ã€‚è¦éªŒè¯tokenæ˜¯å¦è¿‡æœŸï¼Œåªéœ€å°†å…¶ä¸­çš„è¿‡æœŸæ—¶é—´å’Œæœ¬åœ°æ—¶é—´å¯¹æ¯”ä¸€ä¸‹ï¼Œå°±èƒ½ç¡®è®¤å½“å‰tokenæ˜¯ä¸æ˜¯æœ‰æ•ˆã€‚</p><p>è€ŒéªŒè¯tokenæ˜¯å¦åˆæ³•åˆ™æ˜¯é€šè¿‡ç­¾åéªŒè¯å®Œæˆçš„ï¼Œä»»ä½•ä¿¡æ¯ä¿®æ”¹éƒ½ä¼šæ— æ³•é€šè¿‡ç­¾åéªŒè¯ã€‚è¦æ˜¯é€šè¿‡äº†ç­¾åéªŒè¯ï¼Œå°±è¡¨æ˜tokenæ²¡æœ‰è¢«ç¯¡æ”¹è¿‡ï¼Œæ˜¯ä¸€ä¸ªåˆæ³•çš„tokenï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p><p>è¿™ä¸ªè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/19/8a/19b6179e1ff8ef5a13f0cbf4527ce88a.jpg?wh=3330x2141\" alt=\"\"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡tokenæ–¹å¼ï¼Œç”¨æˆ·ä¸­å¿ƒå‹åŠ›æœ€å¤§çš„æ¥å£å¯ä»¥ä¸‹çº¿äº†ï¼Œæ¯ä¸ªä¸šåŠ¡çš„æœåŠ¡ç«¯åªè¦è§£å¼€tokenéªŒè¯å…¶åˆæ³•æ€§ï¼Œå°±å¯ä»¥æ‹¿åˆ°ç”¨æˆ·ä¿¡æ¯ã€‚ä¸è¿‡è¿™ç§æ–¹å¼ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œå°±æ˜¯ç”¨æˆ·å¦‚æœè¢«æ‹‰é»‘ï¼Œå®¢æˆ·ç«¯æœ€å¿«ä¹Ÿè¦åœ¨tokenè¿‡æœŸåæ‰èƒ½é€€å‡ºç™»é™†ï¼Œè¿™è®©æˆ‘ä»¬çš„ç®¡ç†å­˜åœ¨ä¸€å®šçš„å»¶è¿Ÿã€‚</p><p>å¦‚æœæˆ‘ä»¬å¸Œæœ›å¯¹ç”¨æˆ·è¿›è¡Œå®æ—¶ç®¡ç†ï¼Œå¯ä»¥æŠŠæ–°ç”Ÿæˆçš„tokenåœ¨æœåŠ¡ç«¯æš‚å­˜ä¸€ä»½ï¼Œæ¯æ¬¡ç”¨æˆ·è¯·æ±‚å°±å’Œç¼“å­˜ä¸­çš„tokenå¯¹æ¯”ä¸€ä¸‹ï¼Œä½†è¿™æ ·å¾ˆå½±å“æ€§èƒ½ï¼Œæå°‘æ•°å…¬å¸ä¼šè¿™ä¹ˆåšã€‚åŒæ—¶ï¼Œä¸ºäº†æé«˜JWTç³»ç»Ÿçš„å®‰å…¨æ€§ï¼Œtokenä¸€èˆ¬ä¼šè®¾ç½®è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼Œé€šå¸¸æ˜¯åäº”åˆ†é’Ÿå·¦å³ï¼Œè¿‡æœŸåå®¢æˆ·ç«¯ä¼šè‡ªåŠ¨æ›´æ¢tokenã€‚</p><h2>tokençš„æ›´æ¢å’Œç¦»çº¿</h2><p>é‚£ä¹ˆå¦‚ä½•å¯¹JWTçš„tokenè¿›è¡Œæ›´æ¢å’Œç¦»çº¿éªŒç­¾å‘¢ï¼Ÿ</p><p>å…·ä½“çš„æœåŠ¡ç«¯æ¢ç­¾å¾ˆç®€å•ï¼Œåªè¦å®¢æˆ·ç«¯æ£€æµ‹åˆ°å½“å‰çš„tokenå¿«è¿‡æœŸäº†ï¼Œå°±ä¸»åŠ¨è¯·æ±‚ç”¨æˆ·ä¸­å¿ƒæ›´æ¢tokenæ¥å£ï¼Œé‡æ–°ç”Ÿæˆä¸€ä¸ªç¦»å½“å‰è¿˜æœ‰åäº”åˆ†é’Ÿè¶…æ—¶çš„tokenã€‚</p><p>ä½†æ˜¯æœŸé—´å¦‚æœè¶…è¿‡åäº”åˆ†é’Ÿè¿˜æ²¡æ¢åˆ°ï¼Œå°±ä¼šå¯¼è‡´å®¢æˆ·ç«¯ç™»å½•å¤±è´¥ã€‚ä¸ºäº†å‡å°‘è¿™ç±»é—®é¢˜ï¼ŒåŒæ—¶ä¿è¯å®¢æˆ·ç«¯é•¿æ—¶é—´ç¦»çº¿ä»èƒ½æ­£å¸¸å·¥ä½œï¼Œè¡Œä¸šå†…æ™®éä½¿ç”¨åŒtokenæ–¹å¼ï¼Œå…·ä½“ä½ å¯ä»¥çœ‹çœ‹åé¢çš„æµç¨‹å›¾ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/de/7c/de29bd40ac360cb06ca6d3e75ac87a7c.jpg?wh=3330x2141\" alt=\"\"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ–¹æ¡ˆé‡Œæœ‰ä¸¤ç§tokenï¼š<strong>ä¸€ç§æ˜¯refresh_tokenï¼Œç”¨äºæ›´æ¢access_tokenï¼Œæœ‰æ•ˆæœŸæ˜¯30å¤©ï¼›å¦ä¸€ç§æ˜¯access_tokenï¼Œç”¨äºä¿å­˜å½“å‰ç”¨æˆ·ä¿¡æ¯å’Œæƒé™ä¿¡æ¯ï¼Œæ¯éš”15åˆ†é’Ÿæ›´æ¢ä¸€æ¬¡</strong>ã€‚å¦‚æœè¯·æ±‚ç”¨æˆ·ä¸­å¿ƒå¤±è´¥ï¼Œå¹¶ä¸”Appå¤„äºç¦»çº¿çŠ¶æ€ï¼Œåªè¦æ£€æµ‹åˆ°æœ¬åœ°refresh_tokenæ²¡æœ‰è¿‡æœŸï¼Œç³»ç»Ÿä»å¯ä»¥ç»§ç»­å·¥ä½œï¼Œç›´åˆ°refresh_tokenè¿‡æœŸä¸ºæ­¢ï¼Œç„¶åæç¤ºç”¨æˆ·é‡æ–°ç™»é™†ã€‚è¿™æ ·å³ä½¿ç”¨æˆ·ä¸­å¿ƒåæ‰äº†ï¼Œä¸šåŠ¡ä¹Ÿèƒ½æ­£å¸¸è¿è½¬ä¸€æ®µæ—¶é—´ã€‚</p><p>ç”¨æˆ·ä¸­å¿ƒæ£€æµ‹æ›´æ¢tokençš„å®ç°å¦‚ä¸‹ï¼š</p><pre><code class=\"language-go\">//å¦‚æœè¿˜æœ‰äº”åˆ†é’Ÿtokenè¦è¿‡æœŸï¼Œé‚£ä¹ˆæ¢token\nif decodeToken.StandardClaims.ExpiresAt &lt; TimestampNow() - 300 {\n  //è¯·æ±‚ä¸‹ç”¨æˆ·ä¸­å¿ƒï¼Œé—®é—®è¿™ä¸ªäººç¦ç™»é™†æ²¡\n  //....ç•¥å…·ä½“\n  \n  //é‡æ–°å‘æ”¾token\n  token, err := GenToken(.....)\n  if err != nil {\n        return nil, err\n  }\n  //æ›´æ–°è¿”å›cookieä¸­token\n  resp.setCookie(\"xxxx\", token)\n}\n</code></pre><p>è¿™æ®µä»£ç åªæ˜¯å¯¹å½“å‰çš„tokenåšäº†è¶…æ—¶æ›´æ¢ã€‚JWTå¯¹ç¦»çº¿Appç«¯ååˆ†å‹å¥½ï¼Œå› ä¸ºAppå¯ä»¥å°†å®ƒä¿å­˜åœ¨æœ¬åœ°ï¼Œåœ¨ä½¿ç”¨ç”¨æˆ·ä¿¡æ¯æ—¶ç›´æ¥ä»æœ¬åœ°è§£æå‡ºæ¥å³å¯ã€‚</p><h2>å®‰å…¨å»ºè®®</h2><p>æœ€åæˆ‘å†å•°å—¦å‡ å¥ï¼Œé™¤äº†ä¸Šè¿°ä»£ç ä¸­çš„æ³¨é‡Šå¤–ï¼Œåœ¨ä½¿ç”¨JWTæ–¹æ¡ˆçš„æ—¶å€™è¿˜æœ‰ä¸€äº›å…³é”®çš„æ³¨æ„äº‹é¡¹ï¼Œè¿™é‡Œåˆ†äº«ç»™ä½ ã€‚</p><p>ç¬¬ä¸€ï¼Œé€šè®¯è¿‡ç¨‹å¿…é¡»ä½¿ç”¨HTTPSåè®®ï¼Œè¿™æ ·æ‰å¯ä»¥é™ä½è¢«æ‹¦æˆªçš„å¯èƒ½ã€‚</p><p>ç¬¬äºŒï¼Œè¦æ³¨æ„é™åˆ¶tokençš„æ›´æ¢æ¬¡æ•°ï¼Œå¹¶å®šæœŸåˆ·æ–°tokenï¼Œæ¯”å¦‚ç”¨æˆ·çš„access_tokenæ¯å¤©åªèƒ½æ›´æ¢50æ¬¡ï¼Œè¶…è¿‡äº†å°±è¦æ±‚ç”¨æˆ·é‡æ–°ç™»é™†ï¼ŒåŒæ—¶tokenæ¯éš”15åˆ†é’Ÿæ›´æ¢ä¸€æ¬¡ã€‚è¿™æ ·å¯ä»¥é™ä½tokenè¢«ç›—å–åç»™ç”¨æˆ·å¸¦æ¥çš„å½±å“ã€‚</p><p>ç¬¬ä¸‰ï¼ŒWebç”¨æˆ·çš„tokenä¿å­˜åœ¨cookieä¸­æ—¶ï¼Œå»ºè®®åŠ ä¸Šhttponlyã€SameSite=Stricté™åˆ¶ï¼Œä»¥é˜²æ­¢cookieè¢«ä¸€äº›ç‰¹æ®Šè„šæœ¬å·èµ°ã€‚</p><h2>æ€»ç»“</h2><p>ä¼ ç»Ÿçš„Sessionæ–¹å¼æ˜¯æŠŠç”¨æˆ·çš„ç™»å½•ä¿¡æ¯é€šè¿‡SessionIDç»Ÿä¸€ç¼“å­˜åˆ°æœåŠ¡ç«¯ä¸­ï¼Œå®¢æˆ·ç«¯å’Œå­ç³»ç»Ÿæ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦åˆ°ç”¨æˆ·ä¸­å¿ƒå»â€œæå–â€ï¼Œè¿™å°±ä¼šå¯¼è‡´ç”¨æˆ·ä¸­å¿ƒçš„æµé‡å¾ˆå¤§ï¼Œæ‰€æœ‰ä¸šåŠ¡éƒ½å¾ˆä¾èµ–ç”¨æˆ·ä¸­å¿ƒã€‚</p><p>ä¸ºäº†é™ä½ç”¨æˆ·ä¸­å¿ƒçš„æµé‡å‹åŠ›ï¼ŒåŒæ—¶è®©å„ä¸ªå­ç³»ç»Ÿä¸ç”¨æˆ·ä¸­å¿ƒè„±è€¦ï¼Œæˆ‘ä»¬é‡‡ç”¨ä¿¡ä»»â€œç­¾åâ€çš„tokenï¼ŒæŠŠç”¨æˆ·ä¿¡æ¯åŠ å¯†å‘æ”¾åˆ°å®¢æˆ·ç«¯ï¼Œè®©å®¢æˆ·ç«¯æœ¬åœ°æ‹¥æœ‰è¿™äº›ä¿¡æ¯ã€‚è€Œå­ç³»ç»Ÿåªéœ€é€šè¿‡ç­¾åç®—æ³•å¯¹tokenè¿›è¡ŒéªŒè¯ï¼Œå°±èƒ½è·å–åˆ°ç”¨æˆ·ä¿¡æ¯ã€‚</p><p>è¿™ç§æ–¹å¼çš„æ ¸å¿ƒæ˜¯<strong>æŠŠç”¨æˆ·ä¿¡æ¯æ”¾åœ¨æœåŠ¡ç«¯å¤–åšä¼ é€’å’Œç»´æŠ¤ï¼Œä»¥æ­¤è§£å†³ç”¨æˆ·ä¸­å¿ƒçš„æµé‡æ€§èƒ½ç“¶é¢ˆ</strong>ã€‚æ­¤å¤–ï¼Œé€šè¿‡å®šæœŸæ›´æ¢tokenï¼Œç”¨æˆ·ä¸­å¿ƒè¿˜æ‹¥æœ‰ä¸€å®šçš„ç”¨æˆ·æ§åˆ¶èƒ½åŠ›ï¼Œä¹ŸåŠ å¤§äº†ç ´è§£éš¾åº¦ï¼Œå¯è°“ä¸€ä¸¾å¤šå¾—ã€‚</p><p>å…¶å®ï¼Œè¿˜æœ‰å¾ˆå¤šç±»ä¼¼çš„è®¾è®¡ç®€åŒ–ç³»ç»Ÿå‹åŠ›ï¼Œæ¯”å¦‚æ–‡ä»¶crc32æ ¡éªŒç­¾åå¯ä»¥å¸®æˆ‘ä»¬ç¡®è®¤æ–‡ä»¶åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦æŸåï¼›é€šè¿‡Bloom Filterå¯ä»¥ç¡®è®¤æŸä¸ªkeyæ˜¯å¦å­˜åœ¨äºæŸä¸ªæ•°æ®é›†åˆæ–‡ä»¶ä¸­ç­‰ç­‰ï¼Œè¿™äº›éƒ½å¯ä»¥å¤§å¤§æé«˜ç³»ç»Ÿçš„å·¥ä½œæ•ˆç‡ï¼Œå‡å°‘ç³»ç»Ÿçš„äº¤äº’å‹åŠ›ã€‚è¿™äº›æŠ€å·§åœ¨ç¡¬ä»¶èƒ½åŠ›è…¾é£çš„é˜¶æ®µï¼Œä»æ—§é€‚ç”¨ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>ç”¨æˆ·å¦‚æœæ›´æ¢äº†æ˜µç§°ï¼Œå¦‚ä½•å¿«é€Ÿæ›´æ¢tokenä¸­ä¿å­˜çš„ç”¨æˆ·æ˜µç§°å‘¢ï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºä¸æˆ‘äº¤æµè®¨è®ºï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ï¼</p>","neighbors":{"left":{"article_title":"02ï½œç¼“å­˜ä¸€è‡´ï¼šè¯»å¤šå†™å°‘æ—¶ï¼Œå¦‚ä½•è§£å†³æ•°æ®æ›´æ–°ç¼“å­˜ä¸åŒæ­¥ï¼Ÿ","id":596644},"right":{"article_title":"04ï½œåŒåŸåŒæ´»ï¼šå¦‚ä½•å®ç°æœºæˆ¿ä¹‹é—´çš„æ•°æ®åŒæ­¥ï¼Ÿ","id":598570}},"comments":[{"had_liked":false,"id":360874,"user_name":"å¾æ›™è¾‰","can_delete":false,"product_type":"c1","uid":1035885,"ip_address":"åŒ—äº¬","ucode":"D8FA8A64FB7E33","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ce/6d/0c15c18a.jpg","comment_is_top":true,"comment_ctime":1666929490,"is_pvip":true,"replies":[{"id":"131282","content":"ä½ å¥½ï¼Œå¾æ›™è¾‰ï¼Œå¾ˆé«˜å…´æ”¶åˆ°ä½ çš„å†æ¬¡ç•™è¨€<br>å¯¹äºsession æ–¹å¼æ¥è¯´ï¼Œç”±äºç”¨æˆ·æ¯æ¬¡è¯·æ±‚éƒ½ä¼šè¯»å–session cacheï¼Œå®¢æˆ·ç«¯æœ¬åœ°æ˜¯ä¸ä¼šä¿å­˜tokenï¼Œæ‰€ä»¥ä¸å­˜åœ¨tokenå†…ç”¨æˆ·å¤´åƒæ›´æ–°ä¸åŠæ—¶é—®é¢˜ã€‚å¯ä»¥è¯´åå°ç³»ç»Ÿç”¨sessionç®¡ç†ç”¨æˆ·å¾ˆæ–¹ä¾¿ï¼Œå› ä¸ºè¿™ä¸ªå¯ä»¥åšåˆ°ç”¨æˆ·å®æ—¶ç®¡ç†ï¼Œå½“æˆ‘ä»¬ç¦ç”¨ç”¨æˆ·çš„æ—¶å€™æŠŠsessionçš„ç¼“å­˜ç™»é™†æ ‡å¿—åˆ æ‰å³å¯ã€‚ä¸è¿‡è¿™ä¸ªæ–¹å¼é€‚åˆå°‘é‡ç”¨æˆ·ï¼Œå¯¹äºQPSè¶…è¿‡10w QPSè¯·æ±‚çš„APIåˆ™ä¸å¤ªé€‚åˆã€‚<br><br>æ‰€ä»¥ä½¿ç”¨tokenæ–¹å¼æ¥ç­¾åå‘ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯è¯·æ±‚å…¶ä»–å­ç³»ç»Ÿçš„æ—¶å€™ï¼Œä¼šå¸¦ä¸Šå®ƒï¼Œå­ç³»ç»Ÿåªè¦éªŒè¯è¿™ä¸ªtokençš„ç­¾åå°±ä¸éœ€è¦å†å»ç”¨æˆ·ä¸­å¿ƒé—®ä¸€å¥ã€‚æ‰€ä»¥tokenä½¿ç”¨åï¼Œç”¨æˆ·ä¸­å¿ƒä¸ä¼šè¢«å…¶ä»–å­ç³»ç»Ÿé¢‘ç¹è¯·æ±‚ï¼Œä½†æ˜¯ä¹Ÿå¯¼è‡´tokenå‘å‡ºå»æ²¡æ³•å†æ¬¡æ›´æ”¹ï¼Œå³ä½¿æˆ‘ä»¬ç”¨æˆ·ä¸­å¿ƒç»™ä»–æ‹‰é»‘äº†ï¼Œå…¶ä»–å­ç³»ç»Ÿåªè®¤å°ç« ï¼Œä¸ä¼šè¿‡æ¥é—®é—®ã€‚<br><br>åŒæ—¶ä¸ºäº†æ–¹ä¾¿tokenå†…ä¼šä¿å­˜å½“å‰ç”¨æˆ·ä¸€äº›åŸºç¡€ä¿¡æ¯ï¼Œå‡å°‘å…¶ä»–ç³»ç»Ÿè¿‡æ¥è¯¢é—®çš„æ¬¡æ•°ï¼Œè¿™å¯¼è‡´ï¼Œç”¨æˆ·æ›´æ–°å¤´åƒï¼Œtokenæ²¡æ›´æ¢ï¼Œæ˜¯ä¸ä¼šåŒæ­¥æ›´æ–°çš„<br>ç¬¬ä¸€ä¸ªå¾ˆæš´åŠ›ï¼Œä½†æ˜¯å¾ˆæœ‰è¶£ï½<br>ç¬¬äºŒä¸ªæ–¹å¼ä¹Ÿå¾ˆæœ‰è¶£ï¼ŒåŒæ—¶è¡¥ä¸€ä¸ªæŠ€å·§æˆ‘ä»¬å¯ä»¥é€šè¿‡ è®¾å®š å›ºå®šç½‘å€ user&#47;ç”¨æˆ·uid&#47;heaer.jpgæ–¹å¼ç›´æ¥è·å–ç”¨æˆ·å¤´åƒï¼Œè¿™æ ·ä¹Ÿä¸ç”¨è€ƒè™‘æ›´æ–°é—®é¢˜äº†<br><br>","user_name":"ä½œè€…å›å¤","comment_id":360874,"uid":"1004527","ip_address":"åŒ—äº¬","utype":1,"ctime":1666940850,"user_name_real":"ä½œè€…"}],"discussion_count":9,"race_medal":0,"score":"9.2233720385217004e+18","product_id":100309001,"comment_content":"Q1ï¼šåœ¨tokenè¿‡æœŸå¾ˆçŸ­çš„æ—¶å€™ï¼Œé€šè¿‡refresh_tokené¢‘ç¹æ›´æ–°tokenï¼Œæ€ä¹ˆå®ç°å¯¹ç”¨æˆ·å®æ—¶ç®¡ç†ï¼Ÿæ˜¯ä¸æ˜¯è¿˜æ˜¯è·Ÿç”¨æˆ·äººæ•°ç›¸å…³ï¼Œä¸€èˆ¬è¿™ç§åœºæ™¯æ˜¯åå°ç³»ç»Ÿï¼Œåˆ é™¤ä¸€ä¸ªç”¨æˆ·åè¯¥ç”¨æˆ·è´¦å·ç«‹åˆ»ä¸èƒ½ç™»å½•ï¼Œåå°äººæ•°æ¯”Cç«¯äººæ•°å°‘å¾ˆå¤šï¼Œæ‰€ä»¥ç®¡ç†èµ·æ¥ä»£ä»·æ¯”è¾ƒå°ï¼Œæ›´çœ‹é‡æƒé™å®‰å…¨ï¼Œæ”¾åœ¨ç¼“å­˜ä¸­è¿›è¡Œç®¡ç†ã€‚<br>A: å¦‚æœæˆ‘æ¥åšå¿«é€Ÿæ›´æ¢æ˜µç§°çš„åŠŸèƒ½ï¼Œä¸¤ç§æ–¹å¼ï¼Œ<br>a.åœ¨ç”¨æˆ·ä¿®æ”¹æ˜µç§°åï¼Œå†…å­˜ä¸­åŠ å…¥ä¸ªç”¨æˆ·æ ‡è¯†ï¼Œè§£ætokenåè¯»å–è¯¥æ ‡è¯†ï¼Œæœ‰åˆ™è¿”å›ç‰¹å®šcodeï¼Œè®©å®¢æˆ·ç«¯é‡æ–°æ‹¿tokenã€‚ç”šè‡³å¯ä»¥ä¸ç”¨å®¢æˆ·ç«¯å‚ä¸ï¼Œè¿”å›301é‡å®šå‘åˆ°è·å–æ–°tokençš„è·¯ç”±ã€‚<br>b. tokené‡Œé¢ä¸å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œåªå­˜ç”¨æˆ·IDï¼Œéœ€è¦ç”¨æˆ·ä¿¡æ¯çš„æ—¶å€™ä»ç¼“å­˜è¯»ã€‚<br>","like_count":0,"discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591932,"discussion_content":"ä½ å¥½ï¼Œå¾æ›™è¾‰ï¼Œå¾ˆé«˜å…´æ”¶åˆ°ä½ çš„å†æ¬¡ç•™è¨€\nå¯¹äºsession æ–¹å¼æ¥è¯´ï¼Œç”±äºç”¨æˆ·æ¯æ¬¡è¯·æ±‚éƒ½ä¼šè¯»å–session cacheï¼Œå®¢æˆ·ç«¯æœ¬åœ°æ˜¯ä¸ä¼šä¿å­˜tokenï¼Œæ‰€ä»¥ä¸å­˜åœ¨tokenå†…ç”¨æˆ·å¤´åƒæ›´æ–°ä¸åŠæ—¶é—®é¢˜ã€‚å¯ä»¥è¯´åå°ç³»ç»Ÿç”¨sessionç®¡ç†ç”¨æˆ·å¾ˆæ–¹ä¾¿ï¼Œå› ä¸ºè¿™ä¸ªå¯ä»¥åšåˆ°ç”¨æˆ·å®æ—¶ç®¡ç†ï¼Œå½“æˆ‘ä»¬ç¦ç”¨ç”¨æˆ·çš„æ—¶å€™æŠŠsessionçš„ç¼“å­˜ç™»é™†æ ‡å¿—åˆ æ‰å³å¯ã€‚ä¸è¿‡è¿™ä¸ªæ–¹å¼é€‚åˆå°‘é‡ç”¨æˆ·ï¼Œå¯¹äºQPSè¶…è¿‡10w QPSè¯·æ±‚çš„APIåˆ™ä¸å¤ªé€‚åˆã€‚\n\næ‰€ä»¥ä½¿ç”¨tokenæ–¹å¼æ¥ç­¾åå‘ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯è¯·æ±‚å…¶ä»–å­ç³»ç»Ÿçš„æ—¶å€™ï¼Œä¼šå¸¦ä¸Šå®ƒï¼Œå­ç³»ç»Ÿåªè¦éªŒè¯è¿™ä¸ªtokençš„ç­¾åå°±ä¸éœ€è¦å†å»ç”¨æˆ·ä¸­å¿ƒé—®ä¸€å¥ã€‚æ‰€ä»¥tokenä½¿ç”¨åï¼Œç”¨æˆ·ä¸­å¿ƒä¸ä¼šè¢«å…¶ä»–å­ç³»ç»Ÿé¢‘ç¹è¯·æ±‚ï¼Œä½†æ˜¯ä¹Ÿå¯¼è‡´tokenå‘å‡ºå»æ²¡æ³•å†æ¬¡æ›´æ”¹ï¼Œå³ä½¿æˆ‘ä»¬ç”¨æˆ·ä¸­å¿ƒç»™ä»–æ‹‰é»‘äº†ï¼Œå…¶ä»–å­ç³»ç»Ÿåªè®¤å°ç« ï¼Œä¸ä¼šè¿‡æ¥é—®é—®ã€‚\n\nåŒæ—¶ä¸ºäº†æ–¹ä¾¿tokenå†…ä¼šä¿å­˜å½“å‰ç”¨æˆ·ä¸€äº›åŸºç¡€ä¿¡æ¯ï¼Œå‡å°‘å…¶ä»–ç³»ç»Ÿè¿‡æ¥è¯¢é—®çš„æ¬¡æ•°ï¼Œè¿™å¯¼è‡´ï¼Œç”¨æˆ·æ›´æ–°å¤´åƒï¼Œtokenæ²¡æ›´æ¢ï¼Œæ˜¯ä¸ä¼šåŒæ­¥æ›´æ–°çš„\nç¬¬ä¸€ä¸ªå¾ˆæš´åŠ›ï¼Œä½†æ˜¯å¾ˆæœ‰è¶£ï½\nç¬¬äºŒä¸ªæ–¹å¼ä¹Ÿå¾ˆæœ‰è¶£ï¼ŒåŒæ—¶è¡¥ä¸€ä¸ªæŠ€å·§æˆ‘ä»¬å¯ä»¥é€šè¿‡ è®¾å®š å›ºå®šç½‘å€ user/ç”¨æˆ·uid/heaer.jpgæ–¹å¼ç›´æ¥è·å–ç”¨æˆ·å¤´åƒï¼Œè¿™æ ·ä¹Ÿä¸ç”¨è€ƒè™‘æ›´æ–°é—®é¢˜äº†\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666940850,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":5,"child_discussions":[{"author":{"id":2269341,"avatar":"","nickname":"ä¸åƒåŒ…å­","note":"","ucode":"5E0661EC355ED9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":591949,"discussion_content":"ä½ çš„æ„æ€æ˜¯,é’ˆå¯¹ä½ çš„æé—®,JWTä¸ä¿å­˜ç”¨æˆ·ä¿¡æ¯,åªä¿å­˜ç”¨æˆ·ID,ç”¨æˆ·ä¿¡æ¯å­˜å‚¨æ˜¯åˆ°ç¼“å­˜ä¸­,å•ç‹¬è¯»å–çš„?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666951037,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":591932,"ip_address":"å¹¿ä¸œ"},"score":591949,"extra":""},{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":2269341,"avatar":"","nickname":"ä¸åƒåŒ…å­","note":"","ucode":"5E0661EC355ED9","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591953,"discussion_content":"ç¬¬äºŒç§æ˜¯æŒ‡ï¼Œå°†å®¹æ˜“æ”¹å˜çš„å†…å®¹ï¼Œé€šè¿‡å…¶ä»–æ–¹å¼è·å–ï¼Œæ¯”å¦‚ç”¨æˆ·å¤´åƒï¼Œç”¨å›ºå®šç½‘å€æ¥è·å–ï¼Œå³ä½¿æ”¹äº†ç½‘å€ä¸ä¼šå˜ï¼Œåªæ˜¯æ”¹å˜äº†ç½‘å€é‡Œé¢çš„å†…å®¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666953490,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":591949,"ip_address":"åŒ—äº¬"},"score":591953,"extra":""},{"author":{"id":1035885,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ce/6d/0c15c18a.jpg","nickname":"å¾æ›™è¾‰","note":"","ucode":"D8FA8A64FB7E33","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":591972,"discussion_content":"å­¦åˆ°äº†ï¼Œä¹‹å‰æ²¡å¾€è¿™æ–¹é¢æƒ³è¿‡ï¼ŒæŒ‰è¿™æ ·åšï¼Œå¤´åƒå¯ä»¥http://xx.com/user/ç”¨æˆ·ID/header.jpgï¼Œé™æ€æ–‡ä»¶å¯ä»¥ï¼Œå› ä¸ºåæ­£éƒ½æ˜¯è¿œç¨‹httpæ¸²æŸ“ï¼Œä½†æ˜¯æ˜µç§°å’Œå…¶ä»–ä¿¡æ¯éƒ½è¿™æ ·å¤„ç†ï¼Œæ¯ä¸€é¡¹éƒ½æ”¾åˆ°è¿œç¨‹åœ°å€æ€§èƒ½ä¸æ˜¯å¾ˆå¥½ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥http://xxx.com/user/ç”¨æˆ·ID/info.jsonï¼Œå†ååºåˆ—åŒ–ï¼Œè¿™æ ·ç¡®å®šæ˜¯å äº†é¢å¤–çš„å­˜å‚¨ç©ºé—´ï¼Œä¼˜ç‚¹æ˜¯ä¸ç”¨æŸ¥DBå’Œç¼“å­˜ï¼Œå‡å°‘å¥¹ä»¬çš„å‹åŠ›ï¼Œåœ¨webåº”ç”¨ä¸­ï¼Œç”¨æˆ·ä¿¡æ¯è¯»å–æŒºé¢‘ç¹","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1666968192,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":591953,"ip_address":"æ¹–å—"},"score":591972,"extra":""}]},{"author":{"id":1392585,"avatar":"https://static001.geekbang.org/account/avatar/00/15/3f/c9/1ccefb9a.jpg","nickname":"Sky","note":"","ucode":"4C5A5AB73E8B90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591999,"discussion_content":"åŒæ—¶è¡¥ä¸€ä¸ªæŠ€å·§æˆ‘ä»¬å¯ä»¥é€šè¿‡ è®¾å®š å›ºå®šç½‘å€ user/ç”¨æˆ·uid/heaer.jpgæ–¹å¼ç›´æ¥è·å–ç”¨æˆ·å¤´åƒï¼Œè¿™æ ·ä¹Ÿä¸ç”¨è€ƒè™‘æ›´æ–°é—®é¢˜äº†","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1667023590,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3183263,"avatar":"https://static001.geekbang.org/account/avatar/00/30/92/9f/d5255fe8.jpg","nickname":"snake","note":"","ucode":"0C7398D3A68119","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592216,"discussion_content":"æ²¡æƒ³åˆ°è¿˜æœ‰è¿™æ ·çš„æ–¹å¼ï¼Œå­¦åˆ°äº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1667209809,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"é‡åº†"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1392585,"avatar":"https://static001.geekbang.org/account/avatar/00/15/3f/c9/1ccefb9a.jpg","nickname":"Sky","note":"","ucode":"4C5A5AB73E8B90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592000,"discussion_content":"è¿™ä¸ªæŠ€å·§å­¦åˆ°äº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1667023600,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360866,"user_name":"7S","can_delete":false,"product_type":"c1","uid":1199397,"ip_address":"åŒ—äº¬","ucode":"A08EEF49BFB076","user_header":"https://static001.geekbang.org/account/avatar/00/12/4d/25/0920057c.jpg","comment_is_top":false,"comment_ctime":1666925335,"is_pvip":false,"replies":[{"id":"131273","content":"ä½ å¥½ï¼Œ7Sï¼Œå¾ˆé«˜å…´æ”¶åˆ°ä½ çš„æ€è€ƒï¼Œå…³äºè¿™é‡Œæœ‰ä¸€äº›ç‰¹æ®Šçš„å°æŠ€å·§ï¼Œå¦‚è¯·æ±‚æ—¶å¸¦ä¸Šä¸€äº›å®¢æˆ·ç«¯ç‰¹å¾ï¼Œå¦‚ï¼šè¯·æ±‚æ›´æ¢access_tokenæ—¶ï¼Œå¸¦ä¸Šçš„refresh_tokençš„è¯·æ±‚ åŒæ—¶ éœ€è¦ç‰¹æ®Šçš„ç­¾åï¼Œå­˜å‚¨åœ¨æœ¬åœ°çš„tokenä¸ç”¨æ˜æ–‡ä¿å­˜ï¼Œä¸æœåŠ¡ç«¯é€šè®¯æ—¶ç”¨ç‰¹æ®Šåè®®åŠ å¯†ç­‰ï½","user_name":"ä½œè€…å›å¤","comment_id":360866,"uid":"1004527","ip_address":"åŒ—äº¬","utype":1,"ctime":1666927494,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"18846794519","product_id":100309001,"comment_content":"access_tokenç”±äºå®‰å…¨é—®é¢˜è®¾ç½®è¿‡æœŸçš„æ—¶é—´éå¸¸çŸ­ï¼Œä½†æ˜¯refresh_tokenæœ‰æ•ˆæ—¶é—´éå¸¸é•¿ï¼Œå¦‚æœrefresh_tokenè¢«æ³„æ¼æ‰ï¼Œæ˜¯ä¸æ˜¯èƒ½ä¸€ç›´åˆ·æ–°access_tokenå‘¢ã€‚ã€‚","like_count":4,"discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591908,"discussion_content":"ä½ å¥½ï¼Œ7Sï¼Œå¾ˆé«˜å…´æ”¶åˆ°ä½ çš„æ€è€ƒï¼Œå…³äºè¿™é‡Œæœ‰ä¸€äº›ç‰¹æ®Šçš„å°æŠ€å·§ï¼Œå¦‚è¯·æ±‚æ—¶å¸¦ä¸Šä¸€äº›å®¢æˆ·ç«¯ç‰¹å¾ï¼Œå¦‚ï¼šè¯·æ±‚æ›´æ¢access_tokenæ—¶ï¼Œå¸¦ä¸Šçš„refresh_tokençš„è¯·æ±‚ åŒæ—¶ éœ€è¦ç‰¹æ®Šçš„ç­¾åï¼Œå­˜å‚¨åœ¨æœ¬åœ°çš„tokenä¸ç”¨æ˜æ–‡ä¿å­˜ï¼Œä¸æœåŠ¡ç«¯é€šè®¯æ—¶ç”¨ç‰¹æ®Šåè®®åŠ å¯†ç­‰ï½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666927494,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360895,"user_name":"æå®¢","can_delete":false,"product_type":"c1","uid":1114999,"ip_address":"åŒ—äº¬","ucode":"A4AAA6B4F40E66","user_header":"https://static001.geekbang.org/account/avatar/00/11/03/77/3f6a76a9.jpg","comment_is_top":false,"comment_ctime":1666948549,"is_pvip":false,"replies":[{"id":"131287","content":"ä½ å¥½ï¼Œæå®¢ï¼Œæ„Ÿè°¢ä½ çš„ç•™è¨€ï¼Œè¿™ä¸ªæ€è·¯å¾ˆæœ‰æ„æ€ï¼Œæ˜¯ä¸ªæ–¹æ³•ï¼Œå°è±¡é‡Œè¿™ä¸ªæŠ€å·§å¯¹äºè¯»å¤šå†™å¤šçš„æœåŠ¡çš„å®¢æˆ·ç«¯ä¹Ÿä¼šåšç±»ä¼¼çš„äº‹æƒ…","user_name":"ä½œè€…å›å¤","comment_id":360895,"uid":"1004527","ip_address":"åŒ—äº¬","utype":1,"ctime":1666954168,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"14551850437","product_id":100309001,"comment_content":"å®¢æˆ·ç«¯å¯ä»¥ç¼“å­˜ä¿®æ”¹åçš„æ˜µç§°ï¼Œç›´åˆ°æ›´æ¢äº†access tokenå†æ¸…é™¤ç¼“å­˜ï¼Œç±»ä¼¼å¼¹å¹•æœ¬åœ°å…ˆå‘é€è®©ç”¨æˆ·è‡ªå·±è®¤ä¸ºå‘é€æˆåŠŸäº†","like_count":4,"discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591957,"discussion_content":"ä½ å¥½ï¼Œæå®¢ï¼Œæ„Ÿè°¢ä½ çš„ç•™è¨€ï¼Œè¿™ä¸ªæ€è·¯å¾ˆæœ‰æ„æ€ï¼Œæ˜¯ä¸ªæ–¹æ³•ï¼Œå°è±¡é‡Œè¿™ä¸ªæŠ€å·§å¯¹äºè¯»å¤šå†™å¤šçš„æœåŠ¡çš„å®¢æˆ·ç«¯ä¹Ÿä¼šåšç±»ä¼¼çš„äº‹æƒ…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666954168,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361197,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"åŒ—äº¬","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1667314169,"is_pvip":true,"replies":[{"id":"131372","content":"ä½ å¥½ï¼Œpeterï¼Œè¿™é‡Œæ›´æ¢æ˜¯å®¢æˆ·ç«¯å†™ä»£ç æ¥å®ç°è‡ªåŠ¨æ›´æ¢çš„ï¼Œå­ä¸šåŠ¡ç³»ç»Ÿæ— éœ€å…³æ³¨tokençš„æ›´æ¢ã€‚","user_name":"ä½œè€…å›å¤","comment_id":361197,"uid":"1004527","ip_address":"åŒ—äº¬","utype":1,"ctime":1667318267,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1667314169","product_id":100309001,"comment_content":"è¯·é—®ï¼šTokençš„è‡ªåŠ¨æ›´æ–°æ˜¯ç³»ç»Ÿè‡ªåŠ¨å®Œæˆçš„å—ï¼Ÿ<br>æ–‡ä¸­æœ‰â€œè¿‡æœŸåå®¢æˆ·ç«¯ä¼šè‡ªåŠ¨æ›´æ¢ tokenã€‚â€ï¼Œé‚£ä¹ˆï¼Œtokençš„æ›´æ–°éœ€è¦å¼€å‘äººå‘˜å†™ä»£ç å—ï¼Ÿï¼ˆå¦‚æœæ˜¯æ¡†æ¶è‡ªåŠ¨å®Œæˆï¼Œæˆ–è€…æ˜¯TCP&#47;UDPåè®®æ ˆå®Œæˆï¼Œå°±ä¸éœ€è¦ç”¨æˆ·å†™ä»£ç äº†ï¼‰<br>","like_count":0,"discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592347,"discussion_content":"ä½ å¥½ï¼Œpeterï¼Œè¿™é‡Œæ›´æ¢æ˜¯å®¢æˆ·ç«¯å†™ä»£ç æ¥å®ç°è‡ªåŠ¨æ›´æ¢çš„ï¼Œå­ä¸šåŠ¡ç³»ç»Ÿæ— éœ€å…³æ³¨tokençš„æ›´æ¢ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667318267,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361162,"user_name":"frag007","can_delete":false,"product_type":"c1","uid":1215185,"ip_address":"åŒ—äº¬","ucode":"94D7368F091908","user_header":"","comment_is_top":false,"comment_ctime":1667290274,"is_pvip":true,"replies":[{"id":"131363","content":"ä½ å¥½ï¼Œfrag007ï¼Œå¾ˆé«˜å…´æ”¶åˆ°ä½ çš„ç•™è¨€ï¼Œè¿™æ˜¯ä¸ªæœ€ç®€å•çš„å®ç°æ–¹å¼ï½å”¯ä¸€ç¼ºç‚¹å°±æ˜¯å¤šå®¢æˆ·ç«¯çš„æƒ…å†µä¸‹åŒæ­¥æœ‰äº›é—®é¢˜ï½","user_name":"ä½œè€…å›å¤","comment_id":361162,"uid":"1004527","ip_address":"åŒ—äº¬","utype":1,"ctime":1667297237,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1667290274","product_id":100309001,"comment_content":"æ›´æ–°æ˜µç§°ä¸€èˆ¬æ˜¯ç”¨æˆ·è‡ªå·±å‘èµ·çš„ï¼Œæ›´æ–°æ˜µç§°çš„åŒæ—¶ï¼Œä¸šåŠ¡åå°é‡æ–°ç”Ÿæˆtokenå°±å¯ä»¥äº†ã€‚","like_count":0,"discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592309,"discussion_content":"ä½ å¥½ï¼Œfrag007ï¼Œå¾ˆé«˜å…´æ”¶åˆ°ä½ çš„ç•™è¨€ï¼Œè¿™æ˜¯ä¸ªæœ€ç®€å•çš„å®ç°æ–¹å¼ï½å”¯ä¸€ç¼ºç‚¹å°±æ˜¯å¤šå®¢æˆ·ç«¯çš„æƒ…å†µä¸‹åŒæ­¥æœ‰äº›é—®é¢˜ï½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667297237,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361082,"user_name":"å´æ™¨è¾‰","can_delete":false,"product_type":"c1","uid":2312639,"ip_address":"åŒ—äº¬","ucode":"757E98E93AF6A3","user_header":"https://static001.geekbang.org/account/avatar/00/23/49/bf/4936c58b.jpg","comment_is_top":false,"comment_ctime":1667193240,"is_pvip":true,"replies":[{"id":"131352","content":"æœ€åä¸€å¥å¾ˆæ£’ï¼Œæ”¯æŒï¼Œç¬‘","user_name":"ä½œè€…å›å¤","comment_id":361082,"uid":"1004527","ip_address":"åŒ—äº¬","utype":1,"ctime":1667266703,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1667193240","product_id":100309001,"comment_content":"å¾ˆé«˜å…´ç¬¬äºŒæ¬¡å›ç­”é—®é¢˜<br>ä¼ ç»Ÿsessoionä¼šå¯¼è‡´ç”¨æˆ·ä¸­å¿ƒç¼“å­˜å¤§ï¼Œè€¦åˆåº¦é«˜ï¼Œä½†å®æ—¶æ€§å¼º<br>jwtåŠ å¯†ç­–ç•¥è€¦åˆåº¦ä½ï¼Œä½†æ˜¯å®æ—¶æ€§ä¸é«˜<br>é‚£ä¹ˆå¯ä»¥ç»“åˆä¸¤ä¸ªæ–¹å¼ï¼Œä¼˜å…ˆè¯»å–token åŠ å¯†å­—æ®µï¼Œç„¶ååˆ©ç”¨ç”¨æˆ·idå…³è”session cacheè¦†ç›–<br>è€ƒè™‘åˆ°sessionç¼“å­˜æˆæœ¬ï¼Œå¯ä»¥åªç¼“å­˜å®æ—¶æ€§å¼ºçš„å­—æ®µï¼Œæˆ–è€…ç”¨vipåˆ¶åº¦ï¼Œç”¨æˆ·å……é’±è¶Šå¤šï¼Œç¼“å­˜çš„ä¸œè¥¿è¶Šå¤š<br>æ ¸å¿ƒæ€æƒ³å°±æ˜¯æˆæœ¬å¢æ•ˆ","like_count":1,"discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592261,"discussion_content":"æœ€åä¸€å¥å¾ˆæ£’ï¼Œæ”¯æŒï¼Œç¬‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667266703,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361014,"user_name":"å¼ ç”³å‚²","can_delete":false,"product_type":"c1","uid":1182372,"ip_address":"åŒ—äº¬","ucode":"22D46BC529BA8A","user_header":"https://static001.geekbang.org/account/avatar/00/12/0a/a4/828a431f.jpg","comment_is_top":false,"comment_ctime":1667115555,"is_pvip":true,"replies":[{"id":"131318","content":"ä½ å¥½ï¼Œå¼ ç”³å‚²ï¼Œæ„Ÿè°¢ä½ çš„ç•™è¨€ï½","user_name":"ä½œè€…å›å¤","comment_id":361014,"uid":"1004527","ip_address":"åŒ—äº¬","utype":1,"ctime":1667142945,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1667115555","product_id":100309001,"comment_content":"è€å¸ˆå¯¹äº JWT çš„åŸç†å’Œæœ€ä½³å®è·µè®²å¾—å¾ˆæ¸…æ¥šğŸ‘ğŸ»","like_count":0,"discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592138,"discussion_content":"ä½ å¥½ï¼Œå¼ ç”³å‚²ï¼Œæ„Ÿè°¢ä½ çš„ç•™è¨€ï½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667142945,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360949,"user_name":"Sky","can_delete":false,"product_type":"c1","uid":1392585,"ip_address":"åŒ—äº¬","ucode":"4C5A5AB73E8B90","user_header":"https://static001.geekbang.org/account/avatar/00/15/3f/c9/1ccefb9a.jpg","comment_is_top":false,"comment_ctime":1667023544,"is_pvip":false,"replies":[{"id":"131314","content":"ä½ å¥½ï¼Œskyï¼Œå¾ˆé«˜å…´æ”¶åˆ°ä½ çš„ç•™è¨€ï¼Œè¸¢ä¸‹çº¿å¯ä»¥ç”¨ç½‘å…³é»‘åå•æ–¹å¼ï¼Œæ¯ä¸ªä¸šåŠ¡ç½‘å…³ä¼šè§£å¼€tokenï¼Œå‘ç°redisä¸­æœ‰è¿™ä¸ªuidä»¥åŠä½äºæŒ‡å®šç‰ˆæœ¬ï¼Œå°±ä¼šè¦æ±‚æ›´æ¢","user_name":"ä½œè€…å›å¤","comment_id":360949,"uid":"1004527","ip_address":"åŒ—äº¬","utype":1,"ctime":1667043890,"user_name_real":"ç¼–è¾‘"}],"discussion_count":4,"race_medal":0,"score":"1667023544","product_id":100309001,"comment_content":"tokençš„æ–¹å¼æ˜¯æ€ä¹ˆå¤„ç†å¤šç»ˆç«¯ç™»å½•ä»¥åŠâ€œè¸¢ä¸‹çº¿â€ç±»ä¼¼çš„åŠŸèƒ½çš„å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592044,"discussion_content":"ä½ å¥½ï¼Œskyï¼Œå¾ˆé«˜å…´æ”¶åˆ°ä½ çš„ç•™è¨€ï¼Œè¸¢ä¸‹çº¿å¯ä»¥ç”¨ç½‘å…³é»‘åå•æ–¹å¼ï¼Œæ¯ä¸ªä¸šåŠ¡ç½‘å…³ä¼šè§£å¼€tokenï¼Œå‘ç°redisä¸­æœ‰è¿™ä¸ªuidä»¥åŠä½äºæŒ‡å®šç‰ˆæœ¬ï¼Œå°±ä¼šè¦æ±‚æ›´æ¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667043890,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":3,"child_discussions":[{"author":{"id":1392585,"avatar":"https://static001.geekbang.org/account/avatar/00/15/3f/c9/1ccefb9a.jpg","nickname":"Sky","note":"","ucode":"4C5A5AB73E8B90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":592073,"discussion_content":"å¦‚æœè¿˜æ˜¯è¦è®¿é—®redisçš„è¯ï¼Œæ¯ä¸ªç”¨æˆ·ç™»å½•çš„æ—¶å€™éƒ½è¦checkä¸€ä¸‹redisï¼Œä¼¼ä¹ä¸sessionçš„æ¨¡å¼åŒºåˆ«ä¸å¤§ã€‚å¦å¤–å¦‚æœè¦åšå¤šç»ˆç«¯ç™»å½•ï¼Œä¸€ä¸ªè´¦å·å¯ä»¥åœ¨æ‰‹æœºå’Œç”µè„‘ç™»å½•ï¼Œå¹¶ä¸”ä¸€ä¸ªç»ˆç«¯åªèƒ½ä¿æŒä¸€ä¸ªç™»å½•ï¼Œå¦‚æœç”¨tokençš„æ–¹å¼ä¼¼ä¹æ²¡æœ‰åŠæ³•å®ç°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667062318,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":592044,"ip_address":"ä¸Šæµ·"},"score":592073,"extra":""},{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":1392585,"avatar":"https://static001.geekbang.org/account/avatar/00/15/3f/c9/1ccefb9a.jpg","nickname":"Sky","note":"","ucode":"4C5A5AB73E8B90","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592169,"discussion_content":"ä½ å¥½ï¼Œskyï¼Œå¾ˆé«˜å…´èƒ½å¤Ÿæ”¶åˆ°ä½ çš„æ·±åº¦æ€è€ƒï¼Œè¿™é‡Œçš„redisæ˜¯ç½‘å…³ä½¿ç”¨çš„rediså’Œç”¨æˆ·ä¸­å¿ƒé›†ä¸­ç®¡ç†æœ‰äº›ä¸ä¸€æ ·ï¼Œä»–å¯ä»¥å¹¶è¡Œå¤šä¸ªå®ä¾‹ï¼Œè‡³äºè¸¢å‡ºæ¶ˆæ¯å¦‚ä½•åŒæ­¥å¯ä»¥ç”¨kafkaå¹¿æ’­å‘æ”¾å³å¯ã€‚\n\nä½¿ç”¨tokenå¦‚æœéœ€è¦äº’æ–¥å¯ä»¥è®©ç½‘å…³çš„rediså…±åŒç»´æŠ¤ä¸€ä¸ªç”¨æˆ·ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬æ˜¯ç”¨æ¥åŒºåˆ†tokenæ˜¯å¦è¿‡æœŸï¼Œæ¯æ¬¡å®¢æˆ·ç«¯ç™»å½•çš„æ—¶å€™åˆ·æ–°è¿™ä¸ªç‰ˆæœ¬å°±å¯ä»¥è®©ç½‘å…³å‘ç°ä»–ä¸æ˜¯ä¸€å¥—è®¾å¤‡ã€‚æœ€åï¼Œè¿™ä¸ªæ–¹æ¡ˆæ ¸å¿ƒæ˜¯é™ä½ç”¨æˆ·ä¸­å¿ƒçš„ä¾èµ–å’Œé™ä½è¯·æ±‚å‹åŠ›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667183813,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":592073,"ip_address":"åŒ—äº¬"},"score":592169,"extra":""},{"author":{"id":1392585,"avatar":"https://static001.geekbang.org/account/avatar/00/15/3f/c9/1ccefb9a.jpg","nickname":"Sky","note":"","ucode":"4C5A5AB73E8B90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":592247,"discussion_content":"è°¢è°¢è§£ç­”","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1667236817,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":592169,"ip_address":"ä¸Šæµ·"},"score":592247,"extra":""}]}]},{"had_liked":false,"id":360930,"user_name":"Geek_00ä¹","can_delete":false,"product_type":"c1","uid":3012150,"ip_address":"åŒ—äº¬","ucode":"30D3202B6D25DE","user_header":"https://static001.geekbang.org/account/avatar/00/2d/f6/36/a71438d8.jpg","comment_is_top":false,"comment_ctime":1667008207,"is_pvip":true,"replies":[{"id":"131300","content":"ä½ å¥½ï¼ŒGeek_00ä¹ï¼Œå¾ˆé«˜å…´ä½ çš„å¿ƒå¾—åˆ†äº«ï¼ŒåŒæ—¶è¡¥å……ä¸€å¥ï½å­ç³»ç»Ÿä¸ä¼šæ¯æ¬¡éƒ½é—®è¯¢ç”¨æˆ·ä¸­å¿ƒï½å¯¼è‡´äº†è¿™ä¸ªé—®é¢˜","user_name":"ä½œè€…å›å¤","comment_id":360930,"uid":"1004527","ip_address":"åŒ—äº¬","utype":1,"ctime":1667031762,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1667008207","product_id":100309001,"comment_content":"ç”¨æˆ·å¦‚æœè¢«æ‹‰é»‘ï¼Œå®¢æˆ·ç«¯æœ€å¿«ä¹Ÿè¦åœ¨ token è¿‡æœŸåæ‰èƒ½é€€å‡ºç™»é™†ï¼Œè¿™è®©æˆ‘ä»¬çš„ç®¡ç†å­˜åœ¨ä¸€å®šçš„å»¶è¿Ÿã€‚","like_count":0,"discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592016,"discussion_content":"ä½ å¥½ï¼ŒGeek_00ä¹ï¼Œå¾ˆé«˜å…´ä½ çš„å¿ƒå¾—åˆ†äº«ï¼ŒåŒæ—¶è¡¥å……ä¸€å¥ï½å­ç³»ç»Ÿä¸ä¼šæ¯æ¬¡éƒ½é—®è¯¢ç”¨æˆ·ä¸­å¿ƒï½å¯¼è‡´äº†è¿™ä¸ªé—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667031762,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}