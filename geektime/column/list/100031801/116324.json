{"id":116324,"title":"12 | RTCPeerConnection：音视频实时通讯的核心","content":"<p>RTCPeerConnection 类是在浏览器下使用 WebRTC 实现1对1实时互动音视频系统最核心的类。你可以认为它是一个总的接口类或者称它为聚合类，而该类中实现的很多功能都是由其他类具体实现的。</p><p>像我前面讲的很多文章，都是 RTCPeerConnection 类的一部分功能，如 ：</p><ul>\n<li><a href=\"https://time.geekbang.org/column/article/109999\">《06 | WebRTC中的RTP及RTCP详解》</a>讲的是底层网络数据传输协议与其控制协议。</li>\n<li><a href=\"https://time.geekbang.org/column/article/111337\">《07 | 你竟然不知道SDP？它可是WebRTC的驱动核心！》</a>和<a href=\"https://time.geekbang.org/column/article/111675\">《08 | 有话好商量，论媒体协商》</a>讲的是 SDP 协议及使用SDP协议进行媒体协商的过程等。</li>\n<li><a href=\"https://time.geekbang.org/column/article/112325\">《09 | 让我们揭开WebRTC建立连接的神秘面纱》</a>讲的是 WebRTC 底层是如何建立连接的。</li>\n<li><a href=\"https://time.geekbang.org/column/article/113560\">《10 | WebRTC NAT穿越原理》</a>介绍了在 WebRTC 底层进行 NAT 穿越的过程。</li>\n</ul><p>以上这些内容都是 RTCPeerConnection 类的功能。除了上述讲的这些内容之外，RTCPeerConnection类还有许多其他的功能，我在后面的文章中还会向你逐一介绍。</p><p>RTPPeerConnection 这个知识点是你掌握 WebRTC 开发的重中之重，抓住它你就抓住了学习 WebRTC 的钥匙（这里你一定要清楚，<strong>SDP 是掌握WebRTC运行机制的钥匙，而RTCPeerConnection是使用 WebRTC 的钥匙</strong>），这样可以让你很快学会 WebRTC 的使用。</p><!-- [[[read_end]]] --><h2>在WebRTC处理过程中的位置</h2><p>还是老规矩，我们先来看一下本文在整个 WebRTC处理过程中的位置。</p><p><img src=\"https://static001.geekbang.org/resource/image/0b/c5/0b56e03ae1ba9bf71da6511e8ffe9bc5.png?wh=1142*481\" alt=\"\"></p><center><span class=\"reference\">WebRTC处理过程图</span></center><p>通过上面这张图，你可以看到本文所要讲述的内容就是两个端点之间是如何通过 RTCPeerConnection 创建连接的。</p><h2>传输要做哪些事儿</h2><p>可以想像一下，如果你自己要实现一套1对1的通话系统，你会怎么做呢？如果你有一些socket开发经验的话，我想你首先会想到在每一端创建一个 socket，然后通过该 socket 与对端相连。</p><p>当 socket 连接成功之后，你就可以通过 socket 向对端发送数据或者接收对端的数据了。这个过程是不是看起来还是蛮简单的呢？实际上，<strong>RTCPeerConnection 类的工作原理与socket 基本是一样的</strong>，不过它的功能更强大，实现也更为复杂。因为它有很多细节需要处理，这里我们从“提问题”的角度出发，反向分析，你就知道 RTCPeerConnection 要处理哪些细节了。</p><ul>\n<li>端与端之间要建立连接，但它们是如何知道彼此的外网地址呢？</li>\n<li>如果两台主机都是在 NAT 之后，它们又是如何穿越 NAT 进行连接的呢？</li>\n<li>如果 NAT 穿越不成功，又该如何保证双方之间的连通性呢？</li>\n<li>好不容易双方连通了，如果突然丢包了，该怎么办？</li>\n<li>如果传输过程中，传输的数据量过大，超过了网络带宽能够承受的负载，又该如何保障音视频的服务质量呢？</li>\n<li>传输的音视频要时刻保持同步，这又该如何做到呢？</li>\n<li>数据在传输之前要进行音视频编码，而在接收之后又要做音视频解码，但WebRTC支持那么多编解码器，如 H264､ H265､ VP8､ VP9等，它是如何选择的呢？</li>\n<li>……</li>\n</ul><p>如果不是篇幅有限，我可以一直问下去哈，从中你也可以看出RTCPeerConnection要处理多少事情了。通过这些描述，我想你也清楚，这就是原理与真正的实际工作之间还差着十万八千里的距离呢。不过原理的好处是可以帮你简化问题，方便发现问题的本质。</p><h2>什么是RTCPeerConnection</h2><p>了解了传输都要做哪些事之后，你再理解什么是 RTCPeerConnection 就比较容易了。实际上，RTCPeerConnection 就与普通的 socket 一样，在通话的每一端都至少有一个 RTCPeerConnection 对象。在 WebRTC 中它负责与各端建立连接，接收、发送音视频数据，并保障音视频的服务质量。</p><p>在操作时，你完全可以把它当作一个 socket 来用，而且还是一个具有超强能力的“<strong>SOCKET</strong>”。至于它是如何保障端与端之间的连通性，如何保证音视频的服务质量，又如何确定使用的是哪个编解码器等问题，作为应用者的你可以不必关心，因为所有的这些问题都已经在 RTCPeerConnection 对象的底层实现好了。</p><p>因此，如果有人问你什么是 RTCPeerConnection？你可以简要地回答说: “<strong>它就是一个功能超强的 socket</strong>！”这一下就点出了 RTCPeerConnection 的本质。</p><h2>实现通话</h2><p>今天我们要实现的例子是在同一个页面中，使两个RTCPeerConnection对象之间建立连接。它没有什么实际价值，但却能很好地证明RTCPeerConnection是如何工作的。</p><p>这里需要特别强调一点，在音视频通话中，每一方只需要有一个 RTCPeerConnection对象，用它来接收或发送音视频数据。然而在真实的场景中，为了实现端与端之间的通话，还需要利用信令服务器交换一些信息，比如交换双方的 IP 和 port 地址，这样通信的双方才能彼此建立连接（信令服务器的实现可以参考<a href=\"https://time.geekbang.org/column/article/114179\">上一篇文章</a>）。</p><p>而在本文的例子中，为了最大化地减少额外的工作量，所以我们选择在同一个页面中进行音视频的互通，这样就不需要开发、安装信令服务器了。不过这样也增加了一些理解的难度，所以在阅读下面的内容时，你一定要在脑子中想象：<strong>每一个 RTCPeerConnection 就是一个客户端</strong>，这样就比较容易理解后面的内容了。</p><p>接下来我们就实操起来，一步一步实现通话吧！</p><h3>1. 添加视频元素和控制按钮</h3><p>我们首先开发一个简单的显示界面，在该页面中有两个<code>&lt;video&gt;</code>标签，一个用于显示本地捕获的视频，另一个用于显示“远端”的视频。</p><p>除此之外，在该页面上还有三个<code>&lt;button&gt;</code>按钮：</p><ul>\n<li>start 按钮，用于打开本地视频；</li>\n<li>call 按钮，用于与对方建立连接；</li>\n<li>hangup 按钮，用于断开与对方的连接。</li>\n</ul><p>具体代码如下：</p><pre><code>&lt;video id=&quot;localVideo&quot; autoplay playsinline&gt;&lt;/video&gt;\n&lt;video id=&quot;remoteVideo&quot; autoplay playsinline&gt;&lt;/video&gt;\n\n&lt;div&gt;\n  &lt;button id=&quot;startButton&quot;&gt;start&lt;/button&gt;\n  &lt;button id=&quot;callButton&quot;&gt;call&lt;/button&gt;\n  &lt;button id=&quot;hangupButton&quot;&gt;hang up&lt;/button&gt;\n&lt;/div&gt;\n</code></pre><h3>2. 适配各种浏览器</h3><p>一般情况下，我都还会在显示页面中添加一个叫做 <strong>adapter.js</strong> 的脚本，它的作用是为各种浏览器都提供统一的、最新的 WebRTC API 接口。</p><p>在 WebRTC 1.0 规范没有发布之前，虽然各大浏览器厂商都在各自的浏览器上移植了 WebRTC，但你会发现它们最终实现的接口各不相同。这一问题直到 WebRTC 规范正式推出之后才有所改善，但很多用户依然使用老版本的浏览器，这就为使用 WebRTC 开发音视频应用增添了不少麻烦。</p><p>由于浏览器版本众多，而且用户基数大，可以预见各浏览器访问 WebRTC API 接口不统一的问题，在未来很长一段时间内会一直存在。但幸运的是，Google 很早之前就已经注意到了这个问题，因此开发了adapter.js 这个适配器脚本，以弥补各浏览器API 不统一的问题。</p><p>当然，你也可以自己做这件事儿，只不过适配各种浏览器版本真的是一件令人头疼的事儿，这会是一个不小的挑战。而 adapter.js 正好解决了这个痛点。随着adapter.js的发展，它为了解决各种各样复杂的问题，也从一小段很简单的JavaScript代码逐渐变得越来越庞大、复杂。但对于adapter.js这种即稳定、又成熟，且性能不错的库我一向是奉行“拿来主义”哈！</p><p>在页面中引入 adapter.js 的方法如下：</p><pre><code>...\n&lt;script src=&quot;https://webrtc.github.io/adapter/adapter-latest.js &lt;/script&gt;\n...\n</code></pre><p>修改后的 index.html 代码如下：</p><pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n\n&lt;head&gt;\n  &lt;title&gt;Realtime communication with WebRTC&lt;/title&gt;\n  &lt;link rel=&quot;stylesheet&quot; href=&quot;css/main.css&quot; /&gt;\n&lt;/head&gt;\n\n&lt;body&gt;\n  &lt;h1&gt;Realtime communication with WebRTC&lt;/h1&gt;\n\n  &lt;video id=&quot;localVideo&quot; autoplay playsinline&gt;&lt;/video&gt;\n  &lt;video id=&quot;remoteVideo&quot; autoplay playsinline&gt;&lt;/video&gt;\n\n  &lt;div&gt;\n    &lt;button id=&quot;startButton&quot;&gt;Start&lt;/button&gt;\n    &lt;button id=&quot;callButton&quot;&gt;Call&lt;/button&gt;\n    &lt;button id=&quot;hangupButton&quot;&gt;Hang Up&lt;/button&gt;\n  &lt;/div&gt;\n\n  &lt;script src=&quot;https://webrtc.github.io/adapter/adapter-latest.js&quot;&gt;&lt;/script&gt;\n  &lt;script src=&quot;js/client.js&quot;&gt;&lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre><p>通过上面的操作，界面显示及各浏览器之间适配的问题就全部完成了。接下来我们来看一下 RTCPeerConnection是如何工作的。</p><h3>3. RTCPeerConnection如何工作</h3><p>为了讲清楚RTCPeerConnection是如何工作的，我们还是看一个具体的例子吧。</p><p>假设 A 与 B 进行通信，那么对于每个端都要创建一个 RTCPeerConnection 对象，这样双方才可以通信，这个应该很好理解。但由于我们的例子中，通信双方是在同一个页面中（也就是说一个页面同时扮演 A 和 B 两个角色），所以在我们的JavaScript代码中会同时存在两个 RTCPeerConnection 对象，我们称它们为 pc1 和 pc2好啦！这里你一定要注意，虽然pc1 和 pc2 是在同一个页面中，但你一定要把 pc1 和 pc2 想像成两个端的连接对象，这样才便于对后面代码的理解。</p><p>在 WebRTC 端与端之间建立连接，包括三个任务：</p><ul>\n<li>为连接的每个端创建一个RTCPeerConnection对象，并且给 RTCPeerConnection 对象添加一个本地流，该流是从getUserMedia()获取的；</li>\n<li>获取本地媒体描述信息，即 SDP 信息，并与对端进行交换；</li>\n<li>获得网络信息，即 Candidate（IP地址和端口），并与远端进行交换。</li>\n</ul><p>下面我们就来详细看看代码是如何实现的。</p><p><strong>（1）获取本地音视频流</strong></p><p>你需要调用 getUserMedia() 获取到本地流，然后将它添加到对应的 RTCPeerConnecton对象中，代码如下：</p><pre><code>...\n//创建 RTCPeerConnection 对象\nlet localPeerConnection = new RTCPeerConnection(servers);\n...\n\n//调用 getUserMedia API 获取音视频流\nnavigator.mediaDevices.getUserMedia(mediaStreamConstraints).\n  then(gotLocalMediaStream).\n  catch(handleLocalMediaStreamError);\n  \n//如果 getUserMedia 获得流，则会回调该函数\n//在该函数中一方面要将获取的音视频流展示出来\n//另一方面是保存到 localSteam\nfunction gotLocalMediaStream(mediaStream) {\n  ...\n  localVideo.srcObject = mediaStream;\n  localStream = mediaStream;\n  ...\n\n}\n\n...\n\n//将音视频流添加到 RTCPeerConnection 对象中\nlocalPeerConnection.addStream(localStream);\n\n...\n</code></pre><p><strong>（2）交换媒体描述信息</strong></p><p>当 RTCPeerConnection 对象获得音视频流后，就可以开始与对端进行媒协体协商了。整个媒体协商的过程我已经在<a href=\"https://time.geekbang.org/column/article/111675\">《08 | 有话好商量，论媒体协商》</a>一文中做了详细介绍，若记不清了，可以回看下，我们下面的实践中要用到。</p><p>并且前面我们也说了，在真实的应用场景中，各端获取的 SDP 信息都要通过信令服务器进行交换，但在我们这个例子中为了减少代码的复杂度，直接在一个页面中实现了两个端，所以也就不需通过信令服务器交换信息了，只需要直接将一端获取的 offer 设置到另一端就好了，具体步骤可以大致描述为如下。</p><p>我们首先创建 offer 类型的 SDP信息。A 调用 RTCPeerConnection 的 createOffer() 方法，得到 A 的本地会话描述，即 offer 类型的 SDP 信息：</p><pre><code>...\nlocalPeerConnection.createOffer(offerOptions)\n  .then(createdOffer).catch(setSessionDescriptionError);\n...\n</code></pre><p>如果 createOffer 函数调用成功，会回调 createdOffer 方法，并在 createdOffer 方法中做以下几件事儿。</p><ul>\n<li>A 使用setLocalDescription()设置本地描述，然后将此会话描述发送给B。B 使用setRemoteDescription() 设置 A 给它的描述作为远端描述。</li>\n<li>之后，B 调用 RTCPeerConnection 的 createAnswer() 方法获得它本地的媒体描述。然后，再调用 setLocalDescription 方法设置本地描述并将该媒体信息描述发给A。</li>\n<li>A得到 B 的应答描述后，就调用 setRemoteDescription()设置远程描述。</li>\n</ul><p>整个媒体信息交换和协商至此就完成了。具体代码如下：</p><pre><code>//当创建 offer 成功后，会调用该函数\nfunction createdOffer(description) {\n  ...\n  //将 offer 保存到本地\n  localPeerConnection.setLocalDescription(description)\n    .then(() =&gt; {\n      setLocalDescriptionSuccess(localPeerConnection);\n    }).catch(setSessionDescriptionError);\n\n  ...\n  //远端 pc 将 offer 保存起来\n  remotePeerConnection.setRemoteDescription(description)\n    .then(() =&gt; {\n      setRemoteDescriptionSuccess(remotePeerConnection);\n    }).catch(setSessionDescriptionError);\n\n  ...\n  //远端 pc 创建 answer\n  remotePeerConnection.createAnswer()\n    .then(createdAnswer)\n    .catch(setSessionDescriptionError);\n}\n\n//当 answer 创建成功后，会回调该函数 \nfunction createdAnswer(description) {\n  ...\n  //远端保存 answer\n  remotePeerConnection.setLocalDescription(description)\n    .then(() =&gt; {\n      setLocalDescriptionSuccess(remotePeerConnection);\n    }).catch(setSessionDescriptionError);\n\n  //本端pc保存 answer\n  localPeerConnection.setRemoteDescription(description)\n    .then(() =&gt; {\n      setRemoteDescriptionSuccess(localPeerConnection);\n    }).catch(setSessionDescriptionError);\n}\n</code></pre><p><strong>（3）端与端建立连接</strong></p><p>在本地，当 A 调用 setLocalDescription 函数成功后，就开始收到网络信息了，即开始收集 ICE Candidate。</p><p>当 Candidate 被收集上来后，会触发 pc 的 <strong>icecandidate</strong> 事件，所以在代码中我们需要编写 icecandidate 事件的处理函数，即onicecandidate，以便对收集到的 Candidate 进行处理。</p><p>为 RTCPeerConnection 对象添加 icecandidate 事件的方法如下：</p><pre><code>...\nlocalPeerConnection.onicecandidate= handleConnection(event); \n...\n</code></pre><p>上面这段代码为 localPeerConnection 对象的 icecandidate 事件添加了一个处理函数，即 handleConnection。</p><p>当Candidate变为有效时，handleConnection 函数将被调用，具体代码如下：</p><pre><code>...\nfunction handleConnection(event) {\n  \n  //获取到触发 icecandidate 事件的 RTCPeerConnection 对象\n  //获取到具体的Candidate\n  const peerConnection = event.target;\n  const iceCandidate = event.candidate;\n\n  if (iceCandidate) {\n  \t //创建 RTCIceCandidate 对象\n    const newIceCandidate = new RTCIceCandidate(iceCandidate);\n    //得到对端的RTCPeerConnection\n    const otherPeer = getOtherPeer(peerConnection);\n\n\t//将本地获到的 Candidate 添加到远端的 RTCPeerConnection对象中\n    otherPeer.addIceCandidate(newIceCandidate)\n      .then(() =&gt; {\n        handleConnectionSuccess(peerConnection);\n      }).catch((error) =&gt; {\n        handleConnectionFailure(peerConnection, error);\n      });\n\n    ...\n  }\n  \n}\n...\n</code></pre><p>每次 handleConnection 函数被调用时，就说明 WebRTC 又收集到了一个新的 Candidate。在真实的场景中，每当获得一个新的 Candidate 后，就会通过信令服务器交换给对端，对端再调用 RTCPeerConnection 对象的 addIceCandidate()方法将收到的 Candidate 保存起来，然后按照Candidate的优先级进行连通性检测。</p><p>如果 Candidate 连通性检测完成，那么端与端之间就建立了物理连接，这时媒体数据就可能通这个物理连接源源不断地传输了。</p><h2>显示远端媒体流</h2><p>通过 RTCPeerConnection 对象A与B双方建立连接后，本地的多媒体数据就被源源不断地传送到了远端。不过，远端虽然接收到了媒体数据，但音视频并不会显示或播放出来。以视频为例，不显示视频的原因是<code>&lt;video&gt;</code>标签还没有与 RTCPeerConnection 对象进行绑定，也就是说数据虽然到了，但播放器还没有拿到它。</p><p>下面我们就来看一下如何让RTCPeerConnection对象获得的媒体数据与 H5 的<code>&lt;video&gt;</code>标签绑定到一起。具体代码如下所示：</p><pre><code>...\n\nlocalPeerConnection.onaddstream = handleRemoteStreamAdded;\n...\n\nfunction handleRemoteStreamAdded(event) {\n  console.log('Remote stream added.');\n  remoteStream = event.stream;\n  remoteVideo.srcObject = remoteStream;\n}\n\n...\n</code></pre><p>上面代码的关键点是 <strong>addstream</strong> 事件。 在创建好 RTCPeerConnection 对象后，我们需要给 RTCPeerConnection 的 addstream 事件添加回调处理函数，即\u000fonaddstream 函数。也就是说，当有数据流到来的时候，浏览器会回调它，在我们的代码中设置的回调处理函数就是 <strong>handleRemoteStreamAdded</strong> 。</p><p>当远端有数据到达时，WebRTC 底层就会调用 addstream 事件的回调函数，即handleRemoteStreamAdded。在 handleRemoteStreamAdded 函数的输入参数event中，包括了远端的音视频流，即 MediaStream 对象，此时将该对象赋值给 video 标签的 srcObject 字段，这样 video 就与 RTCPeerConnection 进行了绑定。</p><p>至此，video 就能从 RTCPeerConnection 获取到视频数据，并最终将其显示出来了。</p><h2>小结</h2><p>在文中我向你详细介绍了RTCPeerConnection类，当你从不同的角度去观察它时，你会对它有不同的认知：如果你从使用的角度看，会觉得RTCPeerConnection是一个接口类；如果你从功能的角度看，它又是一个功能聚合类。这就是真实的 RTCPeerConnection类。</p><p>在使用 RTCPeerConnection时，你可以把它当作一个功能超强的 socket 使用。在它的底层，它做了很多很细致的工作，而在应用层，你不必关心这些细节，只要学会如何使用它，就可以在浏览器上轻松实现你对音视频处理的想法。</p><p>在本文的后半段，我还通过一个具体的例子向你讲解了如何使用 RTCPeerConnection 对象。通过这个例子你就知道如何在一个页面内实现音视频流的发送与接收了。</p><h2>思考时间</h2><p>在<a href=\"https://time.geekbang.org/column/article/114179\">上一篇文章</a>中我向你讲解了如何通过 Node.js搭建一套信令服务器，今天我又向你讲解了如何使用 RTCPeerConnection 对象，那你是否可以将二者结合起来实现一个简单的 1对1 系统了呢？</p><p>欢迎在留言区与我分享你的想法，也欢迎你在留言区记录你的思考过程。感谢阅读，如果你觉得这篇文章对你有帮助的话，也欢迎把它分享给更多的朋友。</p><p><a href=\"https://github.com/avdance/webrtc_web/tree/master/12_peerconnection\">所做Demo的GitHub链接（有需要可以点这里）</a></p><p></p>","comments":[{"had_liked":false,"id":122758,"user_name":"许童童","can_delete":false,"product_type":"c1","uid":1003005,"ip_address":"","ucode":"4B799C0C6BC678","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg","comment_is_top":false,"comment_ctime":1565513760,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"31630284832","product_id":100031801,"comment_content":"读完这一讲，记住一句话就可以了。<br>RTCPeerConnection就是一个功能超强的 socket！","like_count":8,"discussions":[{"author":{"id":1629580,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLicMlfGiaCDv9k79AcjibpQBCs3gMJA3ZTTicU9rNGQuD2MDacSWdadDeErz2Fsn7jn1atU5fxbozChw/132","nickname":"Geek_ce4e69","note":"","ucode":"70487380D50BD3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":212299,"discussion_content":"这个比喻确实很像，PeerConnection也像socket一样完成了建连和数传两个功能，它是个编程概念，而不是个通信概念","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584957189,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":122547,"user_name":"forever","can_delete":false,"product_type":"c1","uid":1049967,"ip_address":"","ucode":"5B9409BED703BA","user_header":"https://static001.geekbang.org/account/avatar/00/10/05/6f/4f5e9789.jpg","comment_is_top":false,"comment_ctime":1565421388,"is_pvip":false,"replies":[{"id":"44998","content":"iOS端只能用 safari，其它的浏览器都不能用 webrtc，之所以这样是因为苹果不允许其它浏览器访问底层 API，只能通过 webview实现浏览器。因此你会发现在iOS上只有 safari才能访问专栏中讲解的那些API","user_name":"作者回复","comment_id":122547,"uid":"1507837","ip_address":"","utype":1,"ctime":1565455853,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"23040257868","product_id":100031801,"comment_content":"老师您好，我想请教一下如何解决webrtc 兼容性的问题，特别是在ios端使用腾讯x5内核的时候","like_count":6,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462304,"discussion_content":"iOS端只能用 safari，其它的浏览器都不能用 webrtc，之所以这样是因为苹果不允许其它浏览器访问底层 API，只能通过 webview实现浏览器。因此你会发现在iOS上只有 safari才能访问专栏中讲解的那些API","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565455853,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":178813,"user_name":"dayu","can_delete":false,"product_type":"c1","uid":1214458,"ip_address":"","ucode":"1C21338B85EADA","user_header":"https://static001.geekbang.org/account/avatar/00/12/87/fa/403e82ea.jpg","comment_is_top":false,"comment_ctime":1581833790,"is_pvip":false,"replies":[{"id":"70150","content":"可以，除非你们公司内部对 P2P 做了限制","user_name":"作者回复","comment_id":178813,"uid":"1507837","ip_address":"","utype":1,"ctime":1582429706,"user_name_real":"garrylee"}],"discussion_count":2,"race_medal":0,"score":"10171768382","product_id":100031801,"comment_content":"老师，请问一下，如果在局域网内进行一对一通话，是不是可以不搭建STUN\\TURN服务器？","like_count":2,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483975,"discussion_content":"可以，除非你们公司内部对 P2P 做了限制","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582429706,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2076242,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKcwxhdFicBaG4zozbxwNa1K5slcRP7ia3iacjWf5odJO4WtvFDJlztDRFKRddAAVHwlIS5CatQMD5wA/132","nickname":"Geek_7afbfc","note":"","ucode":"8DCC72A80687E1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":297075,"discussion_content":"老师，如果完全是内网，那new RTCPeerConnection(config)中的config又如何配置呢，iceServers又该如何配置呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596766840,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":257645,"user_name":"Bubbly","can_delete":false,"product_type":"c1","uid":1932887,"ip_address":"","ucode":"5AAAFDBCBC4CEB","user_header":"https://static001.geekbang.org/account/avatar/00/1d/7e/57/588337e9.jpg","comment_is_top":false,"comment_ctime":1604048506,"is_pvip":false,"replies":[{"id":"94537","content":"是的，原因在于WebRTC底层都是以 track 为单位的，而且使用track 更灵活，音频与视频可以随音组合","user_name":"作者回复","comment_id":257645,"uid":"1507837","ip_address":"","utype":1,"ctime":1605003232,"user_name_real":"音视频专家-李超"}],"discussion_count":1,"race_medal":0,"score":"5899015802","product_id":100031801,"comment_content":"addStream好像要被addTrack替代了。老师可以分析下使用addTrack来替代addStream的原因吗？","like_count":1,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":508402,"discussion_content":"是的，原因在于WebRTC底层都是以 track 为单位的，而且使用track 更灵活，音频与视频可以随音组合","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605003232,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":223876,"user_name":"Random","can_delete":false,"product_type":"c1","uid":1630111,"ip_address":"","ucode":"4E164C8CF487FA","user_header":"https://static001.geekbang.org/account/avatar/00/18/df/9f/6db75dff.jpg","comment_is_top":false,"comment_ctime":1591200370,"is_pvip":false,"replies":[{"id":"84443","content":"这个你要检测&quot;iceConnectionState&quot;的值了，其中我们感兴趣的是disconnected和failed两个状态，disconnected 表式断连了，failed表示经多次偿试仍无法恢复。所以当你检测到 failed时就可以重启 ICE 了","user_name":"作者回复","comment_id":223876,"uid":"1507837","ip_address":"","utype":1,"ctime":1592879320,"user_name_real":"音视频专家-李超"}],"discussion_count":2,"race_medal":0,"score":"5886167666","product_id":100031801,"comment_content":"老师你好，通话过程中的ice restart的触发时机选择什么时候比较好呢？","like_count":1,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":497277,"discussion_content":"这个你要检测&amp;quot;iceConnectionState&amp;quot;的值了，其中我们感兴趣的是disconnected和failed两个状态，disconnected 表式断连了，failed表示经多次偿试仍无法恢复。所以当你检测到 failed时就可以重启 ICE 了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592879320,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1591737,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqRISt77TSBaW0yEoqmoznG7ib6d2emEVUlbZsicnZcWXr15gWjQxE025uIviaaCmR61DLBEPftUH94Q/132","nickname":"产品平台开发部","note":"","ucode":"08986FE11A5376","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":575703,"discussion_content":"老师，什么情况会导致failed","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655040662,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":497277,"ip_address":""},"score":575703,"extra":""}]}]},{"had_liked":false,"id":162916,"user_name":"Jackson","can_delete":false,"product_type":"c1","uid":1061404,"ip_address":"","ucode":"FD22D39510CF8C","user_header":"https://static001.geekbang.org/account/avatar/00/10/32/1c/3e3cdad2.jpg","comment_is_top":false,"comment_ctime":1576631052,"is_pvip":false,"replies":[{"id":"62489","content":"是的！","user_name":"作者回复","comment_id":162916,"uid":"1507837","ip_address":"","utype":1,"ctime":1577025037,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"5871598348","product_id":100031801,"comment_content":"这个例子是webrtc官方的吧？","like_count":1,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478177,"discussion_content":"是的！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577025037,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":123775,"user_name":"xilie","can_delete":false,"product_type":"c1","uid":1013805,"ip_address":"","ucode":"AFCC4E157F7830","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJVegfjqa0gM4hcRrBhZkIf7Uc5oeTMYsg6o5pd76IQlUoIIh2ic6P22xVEFtRnAzjyLtiaPVstkKug/132","comment_is_top":false,"comment_ctime":1565754773,"is_pvip":false,"replies":[{"id":"45485","content":"😄，协议的内容相对来说稍难了一些，而知识的理解也需要一个时间过程","user_name":"作者回复","comment_id":123775,"uid":"1507837","ip_address":"","utype":1,"ctime":1565796098,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"5860722069","product_id":100031801,"comment_content":"前面看不懂，到这才有感觉，又得回头去看前面的协议，建议凡事先上能跑起来的代码，再逐步解剖协议，好一点","like_count":1,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462809,"discussion_content":"😄，协议的内容相对来说稍难了一些，而知识的理解也需要一个时间过程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565796098,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":288381,"user_name":"Her later","can_delete":false,"product_type":"c1","uid":2033044,"ip_address":"","ucode":"85BDB2DC93C0F2","user_header":"https://static001.geekbang.org/account/avatar/00/1f/05/94/e55abef3.jpg","comment_is_top":false,"comment_ctime":1618449677,"is_pvip":false,"replies":[{"id":"105427","content":"oncandidate是webrtc 底层收集到本机自己的Candidate 时通知上层应用的回调函数呀，你应该是还没看懂这快逻辑","user_name":"作者回复","comment_id":288381,"uid":"1507837","ip_address":"","utype":1,"ctime":1619871281,"user_name_real":"音视频专家-李超"}],"discussion_count":1,"race_medal":0,"score":"1618449677","product_id":100031801,"comment_content":"在真实的场景中，每当获得一个新的 Candidate 后，就会通过信令服务器交换给对端，对端再调用 RTCPeerConnection 对象的 addIceCandidate() 方法将收到的 Candidate 保存起来，然后按照 Candidate 的优先级进行连通性检测。<br><br>真实场景中，应该是candidate 都是通过信令服务器转发的吧，rtcpeerconnection并不会收到oncandidate 的回调，不知道我理解是否正确？","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518610,"discussion_content":"oncandidate是webrtc 底层收集到本机自己的Candidate 时通知上层应用的回调函数呀，你应该是还没看懂这快逻辑","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619871281,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":287322,"user_name":"Her later","can_delete":false,"product_type":"c1","uid":2033044,"ip_address":"","ucode":"85BDB2DC93C0F2","user_header":"https://static001.geekbang.org/account/avatar/00/1f/05/94/e55abef3.jpg","comment_is_top":false,"comment_ctime":1617881874,"is_pvip":false,"replies":[{"id":"104324","content":"多人订阅使用nginx+rtmp 的方式","user_name":"作者回复","comment_id":287322,"uid":"1507837","ip_address":"","utype":1,"ctime":1617899018,"user_name_real":"音视频专家-李超"}],"discussion_count":1,"race_medal":0,"score":"1617881874","product_id":100031801,"comment_content":"这篇文章解析了 如何端对端的推拉流 ，但是如果我要将流推到服务器 ，其他很多人订阅服务器的流老播放 ，又该怎样实现呢 ，有没有专门的文章介绍 ，有的话 ，我就买了 。","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518270,"discussion_content":"多人订阅使用nginx+rtmp 的方式","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617899018,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":281212,"user_name":"npersonal","can_delete":false,"product_type":"c1","uid":1337630,"ip_address":"","ucode":"060839D2BF5E33","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKOCkbWo7KTAUYkTk5sqgOSAdjS51ZH8bTxiaBNLVnIFUOMsicBHRJBoXSOX6sZp5uORE2waGyz3ysw/132","comment_is_top":false,"comment_ctime":1614647546,"is_pvip":false,"replies":[{"id":"103794","content":"那肯定是编码失败的","user_name":"作者回复","comment_id":281212,"uid":"1507837","ip_address":"","utype":1,"ctime":1617072415,"user_name_real":"音视频专家-李超"}],"discussion_count":1,"race_medal":0,"score":"1614647546","product_id":100031801,"comment_content":"老师，编解码没有讲解吗。我现在碰到个问题，使用h264编码，stream的width和height都为0，这是什么原因","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":516326,"discussion_content":"那肯定是编码失败的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617072415,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":274710,"user_name":"十斗簸箕","can_delete":false,"product_type":"c1","uid":1276938,"ip_address":"","ucode":"D661B1B42694FC","user_header":"https://static001.geekbang.org/account/avatar/00/13/7c/0a/8aa06f3f.jpg","comment_is_top":false,"comment_ctime":1611133888,"is_pvip":false,"replies":[{"id":"103798","content":"你说的是远程控制，目前没看到webrtc ，支持这个功能。","user_name":"作者回复","comment_id":274710,"uid":"1507837","ip_address":"","utype":1,"ctime":1617072919,"user_name_real":"音视频专家-李超"}],"discussion_count":1,"race_medal":0,"score":"1611133888","product_id":100031801,"comment_content":"有这样一个场景，主机（PC）采集音视频然后推送到客户端浏览器，类似vnc只不过客户端是通过浏览器来操作，请问老师这类的业务场景webrtc能支持吗？如果能方面讲一下框架流程吗？谢谢","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514093,"discussion_content":"你说的是远程控制，目前没看到webrtc ，支持这个功能。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617072919,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":255008,"user_name":"Zgjian","can_delete":false,"product_type":"c1","uid":1816890,"ip_address":"","ucode":"52C0506149D2C6","user_header":"https://static001.geekbang.org/account/avatar/00/1b/b9/3a/1f9308e6.jpg","comment_is_top":false,"comment_ctime":1603249102,"is_pvip":false,"replies":[{"id":"94543","content":"查一下replaceTrack这个API","user_name":"作者回复","comment_id":255008,"uid":"1507837","ip_address":"","utype":1,"ctime":1605003848,"user_name_real":"音视频专家-李超"}],"discussion_count":1,"race_medal":0,"score":"1603249102","product_id":100031801,"comment_content":"老师您好，请问下在通话过程中切换摄像头还有修改分辨率怎么做，有哪些关键接口？","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":507583,"discussion_content":"查一下replaceTrack这个API","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605003848,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":221952,"user_name":"gseng","can_delete":false,"product_type":"c1","uid":1322277,"ip_address":"","ucode":"2910E1D7B7F7A3","user_header":"https://static001.geekbang.org/account/avatar/00/14/2d/25/87eb82da.jpg","comment_is_top":false,"comment_ctime":1590640115,"is_pvip":false,"replies":[{"id":"84445","content":"一旦连接建立成功之后，就不再收集Candidate了","user_name":"作者回复","comment_id":221952,"uid":"1507837","ip_address":"","utype":1,"ctime":1592879479,"user_name_real":"音视频专家-李超"}],"discussion_count":1,"race_medal":0,"score":"1590640115","product_id":100031801,"comment_content":"Candidate会在直播的过程中一直有变化吗？ 还是说在直播建立之前两端交互完Candidate之后，就不再变化了？ ","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496624,"discussion_content":"一旦连接建立成功之后，就不再收集Candidate了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592879479,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":200901,"user_name":"吴国广","can_delete":false,"product_type":"c1","uid":1821870,"ip_address":"","ucode":"587591E5BFD088","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ohqW1PaxHqyeZFw0SDvQRUeeMDmbcKwicYOS1u5S3jA5jrfMwwnGITEf4UCF1oC8E0OJppeWZ8DvWS1843RI6BQ/132","comment_is_top":false,"comment_ctime":1585670341,"is_pvip":false,"replies":[{"id":"76544","content":"数据没过来吧","user_name":"作者回复","comment_id":200901,"uid":"1507837","ip_address":"","utype":1,"ctime":1586485115,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1585670341","product_id":100031801,"comment_content":"老师 在addstream事件获取到MediaStream  后  video  播放什么都没有  也没报错  可能是啥原因","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490171,"discussion_content":"数据没过来吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586485115,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":185988,"user_name":"zhushengtong","can_delete":false,"product_type":"c1","uid":1756223,"ip_address":"","ucode":"01D2220952B046","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKYZ3GU02RDb9oZpibyYS3KdUIfh6MpZ7K6Hgicib6zZcJG4vb71FaTkmvL9IltWtQP7tPWjOCulTZLg/132","comment_is_top":false,"comment_ctime":1583738413,"is_pvip":false,"replies":[{"id":"73331","content":"实际上这里最关键的是要有https证书。如果你没有的话可以要本机测试，这样就不用证书了。不过这种测试啥也干不了。","user_name":"作者回复","comment_id":185988,"uid":"1507837","ip_address":"","utype":1,"ctime":1584705641,"user_name_real":"garrylee"}],"discussion_count":2,"race_medal":0,"score":"1583738413","product_id":100031801,"comment_content":"老师，请问是不是可以使用虚拟机搭建服务器呢？谢谢！","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486570,"discussion_content":"实际上这里最关键的是要有https证书。如果你没有的话可以要本机测试，这样就不用证书了。不过这种测试啥也干不了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584705641,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1103540,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d6/b4/0808999d.jpg","nickname":"白马","note":"","ucode":"FD4DA715AC5984","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":310653,"discussion_content":"老师，使用http web服务不可以吗？必须使用https吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601973036,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":177056,"user_name":"Davie Li","can_delete":false,"product_type":"c1","uid":1081882,"ip_address":"","ucode":"E72126F9413C8A","user_header":"https://static001.geekbang.org/account/avatar/00/10/82/1a/8ac9bd45.jpg","comment_is_top":false,"comment_ctime":1581258061,"is_pvip":false,"replies":[{"id":"70155","content":"二进制数据","user_name":"作者回复","comment_id":177056,"uid":"1507837","ip_address":"","utype":1,"ctime":1582429893,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1581258061","product_id":100031801,"comment_content":"老师，音视频流是二进制数据吗，还是音视频专用的类型","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483289,"discussion_content":"二进制数据","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582429893,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":165619,"user_name":"tkly","can_delete":false,"product_type":"c1","uid":1619484,"ip_address":"","ucode":"DD22304298BB86","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/1hp9kzzuLUVHzmmddIPIO6F0lnSkIJYPcqFK4vmN1HeknaVNicJp7fHx44zP9MHTkiawnDAiaLdCbhmI8ib5LKx2wg/132","comment_is_top":false,"comment_ctime":1577269498,"is_pvip":false,"replies":[{"id":"66617","content":"肯定要编码，不然网络一定就爆了","user_name":"作者回复","comment_id":165619,"uid":"1507837","ip_address":"","utype":1,"ctime":1579014949,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1577269498","product_id":100031801,"comment_content":"getUserMedia() 获取到的本地流在发送到对端前有没有编码？对端收到视频流在绑定到H5的&lt;video&gt;标签前有没有解码？有的话，这个编解码过程是怎么样的？<br>","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":479230,"discussion_content":"肯定要编码，不然网络一定就爆了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579014949,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":165601,"user_name":"tkly","can_delete":false,"product_type":"c1","uid":1619484,"ip_address":"","ucode":"DD22304298BB86","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/1hp9kzzuLUVHzmmddIPIO6F0lnSkIJYPcqFK4vmN1HeknaVNicJp7fHx44zP9MHTkiawnDAiaLdCbhmI8ib5LKx2wg/132","comment_is_top":false,"comment_ctime":1577266971,"is_pvip":false,"replies":[{"id":"66418","content":"都是在本地解码进行播放呀！","user_name":"作者回复","comment_id":165601,"uid":"1507837","ip_address":"","utype":1,"ctime":1578898123,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1577266971","product_id":100031801,"comment_content":"我有个问题，既然发送前要进行编码，那是否可以使用webrtc在本地解码h264视频流进行播放呢？既然需要编码，是否可以直接发送h264编码的视频流，对端解码播放呢？","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":479220,"discussion_content":"都是在本地解码进行播放呀！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578898123,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":150207,"user_name":"LittleJi","can_delete":false,"product_type":"c1","uid":1216722,"ip_address":"","ucode":"111F0E2794BC17","user_header":"https://static001.geekbang.org/account/avatar/00/12/90/d2/a40d7e65.jpg","comment_is_top":false,"comment_ctime":1573478662,"is_pvip":false,"replies":[{"id":"58302","content":"这里只讲了在同一个浏览器两个不同页而的情况。对于两台不同的机子之间的通信过程与在同一台机子同一个浏览器中的两个不同页面之间的通信过程基本是一样的，后面都有讲到，继续往下看哈！","user_name":"作者回复","comment_id":150207,"uid":"1507837","ip_address":"","utype":1,"ctime":1573780502,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1573478662","product_id":100031801,"comment_content":"因为这是在同一个页面，所以不涉及到两个端之间怎么连接吗？比如不在同一内网的话，怎么进行连接，NAT穿越？因为是同一个端，所以ip相同、端口也相同，是吗？","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474094,"discussion_content":"这里只讲了在同一个浏览器两个不同页而的情况。对于两台不同的机子之间的通信过程与在同一台机子同一个浏览器中的两个不同页面之间的通信过程基本是一样的，后面都有讲到，继续往下看哈！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573780502,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":133249,"user_name":"编译缺陷","can_delete":false,"product_type":"c1","uid":1644015,"ip_address":"","ucode":"FC0D96DDA0C539","user_header":"https://static001.geekbang.org/account/avatar/00/19/15/ef/8906f082.jpg","comment_is_top":false,"comment_ctime":1568464201,"is_pvip":false,"replies":[{"id":"51073","content":"当然，RTCPeerConnection就是传输数据的，无论是哪个端都可以通过 RTCPeerConnection 进行数据的接收与发送，这应该上与它的参数 server没啥关系。","user_name":"作者回复","comment_id":133249,"uid":"1507837","ip_address":"","utype":1,"ctime":1568470421,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1568464201","product_id":100031801,"comment_content":"这里的RTCPeerConnection是实现了socket,但是如果要跨端的话. new RTCPeerConnection(server).这里server的配置可以支持跨端吗?对这里server的细节不是很清楚.怎么做到把steam通过RTCPeerConnection传给server服务端","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467318,"discussion_content":"当然，RTCPeerConnection就是传输数据的，无论是哪个端都可以通过 RTCPeerConnection 进行数据的接收与发送，这应该上与它的参数 server没啥关系。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568470421,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130805,"user_name":"Geek_leo长沙","can_delete":false,"product_type":"c1","uid":1617384,"ip_address":"","ucode":"2AEEAF499FBDC1","user_header":"","comment_is_top":false,"comment_ctime":1567555455,"is_pvip":false,"replies":[{"id":"49237","content":"这这专栏架不了了，移动端也有一打块知识，等后面的专栏再规划哈","user_name":"作者回复","comment_id":130805,"uid":"1507837","ip_address":"","utype":1,"ctime":1567605042,"user_name_real":"garrylee"}],"discussion_count":2,"race_medal":0,"score":"1567555455","product_id":100031801,"comment_content":"老师能不能增加移动端的案例讲解","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466138,"discussion_content":"这这专栏架不了了，移动端也有一打块知识，等后面的专栏再规划哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567605042,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1617384,"avatar":"","nickname":"Geek_leo长沙","note":"","ucode":"2AEEAF499FBDC1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7690,"discussion_content":"嗯嗯 期待大作","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567615052,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":122966,"user_name":"Ray-J","can_delete":false,"product_type":"c1","uid":1618642,"ip_address":"","ucode":"EDA67D6215B4D1","user_header":"https://static001.geekbang.org/account/avatar/00/18/b2/d2/01e70940.jpg","comment_is_top":false,"comment_ctime":1565580488,"is_pvip":false,"replies":[{"id":"45219","content":"就是 &lt;IP，端口&gt;对, 假设你的主机有两上网卡，都使用5678这个端口，那你就有两个候选者，它们分别是&lt;网卡1的IP，5679&gt;，&lt;网卡2IP, 5678&gt;","user_name":"作者回复","comment_id":122966,"uid":"1507837","ip_address":"","utype":1,"ctime":1565612147,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1565580488","product_id":100031801,"comment_content":"老师,Candidate的作用是用来做什么的呢?翻译过来 是候选人, 很难理解这个词,希望能得到老师的帮助加深理解","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462481,"discussion_content":"就是 &amp;lt;IP，端口&amp;gt;对, 假设你的主机有两上网卡，都使用5678这个端口，那你就有两个候选者，它们分别是&amp;lt;网卡1的IP，5679&amp;gt;，&amp;lt;网卡2IP, 5678&amp;gt;","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565612147,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":122469,"user_name":"Keep-Moving","can_delete":false,"product_type":"c1","uid":1182631,"ip_address":"","ucode":"76F33C06E07A27","user_header":"https://static001.geekbang.org/account/avatar/00/12/0b/a7/6ef32187.jpg","comment_is_top":false,"comment_ctime":1565400371,"is_pvip":false,"replies":[{"id":"44957","content":"有，今天晚上会上传上去","user_name":"作者回复","comment_id":122469,"uid":"1507837","ip_address":"","utype":1,"ctime":1565410010,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1565400371","product_id":100031801,"comment_content":"老师，本节完整的代码github有吗？","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462265,"discussion_content":"有，今天晚上会上传上去","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565410010,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}