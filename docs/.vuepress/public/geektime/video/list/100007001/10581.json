{"id":10581,"title":"53 | Zuul网关代码剖析(Code Review)","content":"无","comments":[{"had_liked":false,"id":24457,"user_name":"正是那朵玫瑰","can_delete":false,"product_type":"c3","uid":1048261,"ip_address":"","ucode":"73D630B654573F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fe/c5/3467cf94.jpg","comment_is_top":false,"comment_ctime":1537021345,"is_pvip":false,"replies":[{"id":9641,"content":"你好，你的问题回答如下：1），是原生zuul的简化定制版，不是spring cloud zuul。2)，当企业业务和团队到一定规模，zuul网关是要按场景(h5,无线,第三方开放平台等)分集群的，我之前和现在的公司都是这种管理模式，当然管理成本会大一点，一般需要研发一套统一网关治理系统。如果你业务和团队规模小，则没必要分那么细。3）我们做法是存数据库集中管理，zuul网关节点定期到数据库拉取(zuul节点本地有缓存和比对机制)。4)，我们在生产实践中发现，不启用AsyncServerlet，当访问量大时候连接数有限制（拒绝额外请求）；启用AsyncServerlet后，可以接受的连接数明显增加，当然这个只是前端异步，后端处理和请求还是由容器线程池同步处理的，总体吞吐量没有增加，只是可接受连接数增加了，所以我说优化了连接数。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1537680026,"ip_address":"","comment_id":24457,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"老师想问几个问题：\n1、老师实践的zuul是原生的zuul么？并没有使用Spring-cloud-zuul？\n2、每一个客户端如H5、手机、web都对应不同的zuul网关？这样管理是不是太麻烦？\n3、filter文件是怎么管理的，写在zuul项目里面还是直接储存在数据库里面？\n4、老师所说的异步servlet可以优化连接数，servlet是运行在容器里面的如tomcat，目前tomcat支持BIO和NIO，如果使用BIO的话，这种阻塞IO模型是一个连接一个线程，就算异步servlet意义也不大吧；如果是NIO，这种多路复用IO技术，本身就已经支持大量连接了，此时在tomcat里面servlet线程应该是IO线程吧，使用异步servlet，对一些处理慢的请求可以得到优化，但是并不是优化了连接数吧？这是我的理解，所以不太明白老师所说的异步servlet可以优化连接数？望老师可以解答下！","like_count":6,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":423992,"discussion_content":"你好，你的问题回答如下：1），是原生zuul的简化定制版，不是spring cloud zuul。2)，当企业业务和团队到一定规模，zuul网关是要按场景(h5,无线,第三方开放平台等)分集群的，我之前和现在的公司都是这种管理模式，当然管理成本会大一点，一般需要研发一套统一网关治理系统。如果你业务和团队规模小，则没必要分那么细。3）我们做法是存数据库集中管理，zuul网关节点定期到数据库拉取(zuul节点本地有缓存和比对机制)。4)，我们在生产实践中发现，不启用AsyncServerlet，当访问量大时候连接数有限制（拒绝额外请求）；启用AsyncServerlet后，可以接受的连接数明显增加，当然这个只是前端异步，后端处理和请求还是由容器线程池同步处理的，总体吞吐量没有增加，只是可接受连接数增加了，所以我说优化了连接数。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537680026,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":64967,"user_name":"DDs moving castle","can_delete":false,"product_type":"c3","uid":1066684,"ip_address":"","ucode":"08CA816F665E39","user_header":"https://static001.geekbang.org/account/avatar/00/10/46/bc/463cca3f.jpg","comment_is_top":false,"comment_ctime":1548987320,"is_pvip":false,"replies":[{"id":23566,"content":"你好，看得出你们已经花费很多功夫去禁用某个filter，实际生产中，我们还是需要评估成本和可靠性，首先，生产上禁用某个filter一般不会频繁发生(毕竟我们没有Netflix那么大规模)，所以需要评估这个成本是否值得，大部分情况下，能用apollo配置中心动态控制filter启停就足够了(我们之前就是这么干的)，没必要完全内存删除；其次，删除filter可能有潜在内存问题，是否会引入不可靠性？所以还是需要评估下是否一定要这样做，anyway，你已经深入研究了这个问题，也完全理解了这种机制的利弊，相信你已经有自己的答案了，也谢谢你提供的方案思路！","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1549973398,"ip_address":"","comment_id":64967,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"我司使用的是spring cloud封装的zuul，也想增加动态filter功能，故参考了波波老师的s2g-zuul，将使用数据库动态加载激活filter功能拿过来，期间也发现原本的deactivate通用功能只是将数据库的is_active、is_canary都置为false，并未做其它处理，filter并没有真正停用，还是会调用到，故对停用功能做如下调整：1、更新数据库记录状态保持不变；2、删除本地磁盘filter目录中的groovy文件（因为数据库管理filter也是先写到本地磁盘再加载到内存的，本地磁盘不删，怎么都会再加载进内存）；3、根据spring cloud的ZuulFilterInitializer中contextDestroyed()方法的逻辑（也通过dump分析过谁引用了动态加载的filter），将动态filter的实例从FilterRegistry和FilterLoader#hashFiltersByType中删除，想看看是否能够达到删除对动态filter的所有引用后，在下次gc时能被销毁；4、由于使用了apollo配置中心，也将filter的disable property置为true，以防止内存中不能被销毁或其它意外情况发生。经过如上步骤，filter真正是停用了，不会被调用到。但不会被调用到首先是因为已经从FilterLoader#hashFiltersByType中删除，想看看内存中是否被gc销毁，但目前的方法只能通过dump内存（但dump时确实是会触发一次full gc的），从dump数据查看filter实例，确实没有了，不知道这能不能算真正的协助成功？？请问有必要这样做吗？？\n（题外：本来想通过alibaba Arthas通过不dump的方式查看filter是否被卸载，结果反而发现使用Arthas后发生了内存泄露，在shutdown Arthas后，filter对象仍然被Arthas的Advice引用，而root在tomcat的TaskThread的threadlocal中，尝试很久始终无法卸载）","like_count":3,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438256,"discussion_content":"你好，看得出你们已经花费很多功夫去禁用某个filter，实际生产中，我们还是需要评估成本和可靠性，首先，生产上禁用某个filter一般不会频繁发生(毕竟我们没有Netflix那么大规模)，所以需要评估这个成本是否值得，大部分情况下，能用apollo配置中心动态控制filter启停就足够了(我们之前就是这么干的)，没必要完全内存删除；其次，删除filter可能有潜在内存问题，是否会引入不可靠性？所以还是需要评估下是否一定要这样做，anyway，你已经深入研究了这个问题，也完全理解了这种机制的利弊，相信你已经有自己的答案了，也谢谢你提供的方案思路！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549973398,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":37286,"user_name":"wyw","can_delete":false,"product_type":"c3","uid":1063522,"ip_address":"","ucode":"D93D4E78F283B6","user_header":"https://static001.geekbang.org/account/avatar/00/10/3a/62/375f91c6.jpg","comment_is_top":false,"comment_ctime":1541518334,"is_pvip":false,"replies":[{"id":13562,"content":"对的，netflix原生zuul这块还不完善，主要在filter本地加载那块，笨办法只能先删除本地filter临时目录，再重启zuul。或者需自己修复filter加载逻辑，下线的filter本地和内存都要删除。或者也可以用apollo开关控制filter的启用或禁用。groovy应该不在spring容器管理范围内，估计不能用注入。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1541684072,"ip_address":"","comment_id":37286,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"老师，filter从激活变为未激活将filter移除 是不是未实现？ groovy是不是不能注入spring容器中的bean？","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428277,"discussion_content":"对的，netflix原生zuul这块还不完善，主要在filter本地加载那块，笨办法只能先删除本地filter临时目录，再重启zuul。或者需自己修复filter加载逻辑，下线的filter本地和内存都要删除。或者也可以用apollo开关控制filter的启用或禁用。groovy应该不在spring容器管理范围内，估计不能用注入。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541684072,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":16175,"user_name":"🔰夏天的味道","can_delete":false,"product_type":"c3","uid":1069105,"ip_address":"","ucode":"3CA1DE1ADC95F0","user_header":"https://static001.geekbang.org/account/avatar/00/10/50/31/98e2c8e9.jpg","comment_is_top":false,"comment_ctime":1531814433,"is_pvip":false,"replies":[{"id":5712,"content":"总体是基于zuul源码，做了少量简化和调整，主要变化：过滤器管理数据访问层从cassandra改为mysql，增加CAT埋点，增加AsyncServlet支持","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1531972856,"ip_address":"","comment_id":16175,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"老师您好，能不能说下您的精简源码和Netflix原版源码之间的对应关系？自己尝试过，找不出老师的源码是从原来哪里精简过来的。","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420700,"discussion_content":"总体是基于zuul源码，做了少量简化和调整，主要变化：过滤器管理数据访问层从cassandra改为mysql，增加CAT埋点，增加AsyncServlet支持","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1531972856,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":269808,"user_name":"托尼斯威特","can_delete":false,"product_type":"c3","uid":1729060,"ip_address":"","ucode":"98A1035527292E","user_header":"https://static001.geekbang.org/account/avatar/00/1a/62/24/07e2507c.jpg","comment_is_top":false,"comment_ctime":1608792848,"is_pvip":false,"replies":[{"id":98342,"content":"建议阅读一下这篇文章&lt;理解AsyncServlet&gt;：\nhttps:&#47;&#47;ijunc2.github.io&#47;2018&#47;02&#47;01&#47;seventh.html\n\nAsyncServlet把线程的角色一分为二，分为主要处理连接和I&#47;O的Servlet线程和处理业务逻辑的Worker线程。这个优化对提升服务其处理效率还是有不小的帮助的，Servlet线程处理完IO就可以被回收到线程池，这样就可以处理更多的连接。如果不分的化，Servlet线程要同时处理I&#47;O连接和处理业务逻辑，容易阻塞消耗更多资源。\n\n就像一个由AB两个步骤组成的任务原来只有一个人干，B阻塞的时候这个人只能等着，现在把步骤拆分为二，有两个人分别专注干A和B，B阻塞的时候，第一个人可以继续可以干下一个A。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1609510268,"ip_address":"","comment_id":269808,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"用AsyncServlet并没有省线程, 那和直接增加Tomcat的线程池大小不是一样效果吗? 感觉servlet就解决不了这个问题. Zuul2.0的异步是Netty实现的, 不光前端异步, 向后端发请求也是Netty 异步client. 不知道我的理解有没有问题, 老师能评价一下吗? ","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":512399,"discussion_content":"建议阅读一下这篇文章&amp;lt;理解AsyncServlet&amp;gt;：\nhttps://ijunc2.github.io/2018/02/01/seventh.html\n\nAsyncServlet把线程的角色一分为二，分为主要处理连接和I/O的Servlet线程和处理业务逻辑的Worker线程。这个优化对提升服务其处理效率还是有不小的帮助的，Servlet线程处理完IO就可以被回收到线程池，这样就可以处理更多的连接。如果不分的化，Servlet线程要同时处理I/O连接和处理业务逻辑，容易阻塞消耗更多资源。\n\n就像一个由AB两个步骤组成的任务原来只有一个人干，B阻塞的时候这个人只能等着，现在把步骤拆分为二，有两个人分别专注干A和B，B阻塞的时候，第一个人可以继续可以干下一个A。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609510268,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":192611,"user_name":"Jason","can_delete":false,"product_type":"c3","uid":1085947,"ip_address":"","ucode":"6EECC0C25A9FCC","user_header":"https://static001.geekbang.org/account/avatar/00/10/91/fb/9b9d22a0.jpg","comment_is_top":false,"comment_ctime":1584863773,"is_pvip":false,"replies":[{"id":74023,"content":"如果讲绝对性能，zuul应该比不过nginx，但是网关无状态，可以水平扩，适当优化，zuul组成的网关性能完全是ok的(携程每日百亿API请求通过zuul网关，netflix比携程的量应该还要大)，而且zuul基于java，对开发人员扩展比较友好。相比nginx比较偏运维，开发人员能直接扩展nginx的不多。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1585055981,"ip_address":"","comment_id":192611,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"zuul 网管为什么能比 nginx 等网关性能高呢？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488430,"discussion_content":"如果讲绝对性能，zuul应该比不过nginx，但是网关无状态，可以水平扩，适当优化，zuul组成的网关性能完全是ok的(携程每日百亿API请求通过zuul网关，netflix比携程的量应该还要大)，而且zuul基于java，对开发人员扩展比较友好。相比nginx比较偏运维，开发人员能直接扩展nginx的不多。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585055981,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":178544,"user_name":"张晓永","can_delete":false,"product_type":"c3","uid":1529668,"ip_address":"","ucode":"C728459C061A13","user_header":"https://static001.geekbang.org/account/avatar/00/17/57/44/a0ed355d.jpg","comment_is_top":false,"comment_ctime":1581738246,"is_pvip":false,"replies":[{"id":69345,"content":"请确保网络良好，可以正常连接并下载官方maven仓库中的依赖jar包。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1581783444,"ip_address":"","comment_id":178544,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"波波老师  本地maven仓库也给提供一份吧，下载太费劲了","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483869,"discussion_content":"请确保网络良好，可以正常连接并下载官方maven仓库中的依赖jar包。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581783444,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":178390,"user_name":"张晓永","can_delete":false,"product_type":"c3","uid":1529668,"ip_address":"","ucode":"C728459C061A13","user_header":"https://static001.geekbang.org/account/avatar/00/17/57/44/a0ed355d.jpg","comment_is_top":false,"comment_ctime":1581676877,"is_pvip":false,"replies":[{"id":69344,"content":"请确保网络良好，可以正常连接并下载官方maven仓库中的依赖jar包。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1581783437,"ip_address":"","comment_id":178390,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"项目到不进 eclipes TST 里","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483792,"discussion_content":"请确保网络良好，可以正常连接并下载官方maven仓库中的依赖jar包。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581783437,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":139652,"user_name":"Ckiwis","can_delete":false,"product_type":"c3","uid":1038372,"ip_address":"","ucode":"E59B57FF70650B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d8/24/499e7c99.jpg","comment_is_top":false,"comment_ctime":1570698535,"is_pvip":false,"replies":[{"id":53920,"content":"源码就是定制版s2g-zuul和lab05中的项目\nhttps:&#47;&#47;github.com&#47;spring2go&#47;s2g-zuul","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1570712762,"ip_address":"","comment_id":139652,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"lab1-lab4的源码没有？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470036,"discussion_content":"源码就是定制版s2g-zuul和lab05中的项目\nhttps://github.com/spring2go/s2g-zuul","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570712762,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1038372,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/d8/24/499e7c99.jpg","nickname":"Ckiwis","note":"","ucode":"E59B57FF70650B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":28997,"discussion_content":"好的，谢谢老师","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570721905,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":134648,"user_name":"在路上","can_delete":false,"product_type":"c3","uid":1205712,"ip_address":"","ucode":"18337C6DD5E618","user_header":"https://static001.geekbang.org/account/avatar/00/12/65/d0/b5b00bc2.jpg","comment_is_top":false,"comment_ctime":1568886021,"is_pvip":false,"replies":[{"id":51652,"content":"理论上讲，Zuul能做的， Nginx都能做到，相反，Nginx能做的，Zuul也能做到(可以扩展)。实际上，Nginx是一种通用高性能的反向代理，常常作为网站的前置反向代理和负载均衡器用；而zuul则一般用在API网关场景。很多公司同时用Nginx + Zuul。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1568895620,"ip_address":"","comment_id":134648,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"老师好\n感觉Zuul和Nginx可以相互替代，是这样的吗？\n在选择时，不考虑公司历史原因，Zuul和Nginx分别适合于哪种场景呢？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467845,"discussion_content":"理论上讲，Zuul能做的， Nginx都能做到，相反，Nginx能做的，Zuul也能做到(可以扩展)。实际上，Nginx是一种通用高性能的反向代理，常常作为网站的前置反向代理和负载均衡器用；而zuul则一般用在API网关场景。很多公司同时用Nginx + Zuul。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568895620,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126867,"user_name":"飞翔","can_delete":false,"product_type":"c3","uid":1068571,"ip_address":"","ucode":"65AF6AF292DAD6","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/1b/f4b786b9.jpg","comment_is_top":false,"comment_ctime":1566500416,"is_pvip":false,"replies":[{"id":47030,"content":"同一逻辑盘的意思，只要data和s2g-zuul在同一个盘下，例如都在c盘或者d盘，不要分开在不同盘下就可以了，不需要把s2g-zuul放在data里面。\n\n你启动了cat服务器吗？\n\n从错误看，好像确实没找到client.xml，而且日志文件也找不到，你尝试下调整s2g-zuul到data目录之外。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1566565572,"ip_address":"","comment_id":126867,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100007001,"comment_content":"老师 求教 我启动s2g-zull 在intellij 遇到这个问题， 我觉得可能是找不到client.xml\n注意，上述目录和zuul在要在同一逻辑盘下。 这句话怎么理解呀\n我的目录是\n   data\n       temp\n       s2g-zuul-master\n       appdatas\n       applogs\n我用的是intellij和mac \n[08-22 14:56:32.735] [ERROR] [CatLogger] [08-22 14:56:32.731] [ERROR] [CatLogger] error when read url:http:&#47;&#47;org.cat&#47;cat&#47;s&#47;launch?ip=10.20.25.63&amp;env=unknown&amp;hostname=dw135-198-201-228.dhcpw.sest.att.com,exception is org.catjava.io.FileNotFoundException: &#47;data&#47;applogs&#47;cat&#47;cat_client_20190822.log (No such file or directory)\n2019-08-22 14:56:32,741 [ZuulFilterPoller] ERROR io.spring2go.zuul.filters.ZuulFilterPoller- ZuulFilterPoller run error!\njava.lang.ExceptionInInitializerError: null\n\tat com.dianping.cat.message.internal.DefaultMessageManager.&lt;init&gt;(DefaultMessageManager.java:45) ~[cat-client-3.0.0.jar:na]\n\tat com.dianping.cat.message.internal.DefaultMessageManager.&lt;clinit&gt;(DefaultMessageManager.java:52) ~[cat-client-3.0.0.jar:na]\n\tat com.dianping.cat.message.internal.DefaultMessageProducer.&lt;init&gt;(DefaultMessageProducer.java:33) ~[cat-client-3.0.0.jar:na]\n\tat com.dianping.cat.message.internal.DefaultMessageProducer.&lt;clinit&gt;(DefaultMessageProducer.java:37) ~[cat-client-3.0.0.jar:na]\n\tat com.dianping.cat.Cat.initializeInternal(Cat.java:311) ~[cat-client-3.0.0.jar:na]\n\tat com.dianping.cat.Cat.checkAndInitialize(Cat.java:72) ~[cat-client-3.0.0.jar:na]\n\tat com.dianping.cat.Cat.getProducer(Cat.java:211) ~[cat-client-3.0.0.jar:na]\n\tat io.spring2go.zuul.filters.ZuulFilterPoller$1.run(ZuulFilterPoller.java:94) ~[s2g-zuul-core-1.0.0.jar:na]\nCaused by: java.lang.RuntimeException: Error when get cat router service, please contact cat support team for help!\n\tat com.dianping.cat.configuration.ApplicationEnvironment.loadClientConfig(ApplicationEnvironment.java:151) ~[cat-client-3.0.0.jar:na]\n\tat com.dianping.cat.configuration.DefaultClientConfigService.&lt;init&gt;(DefaultClientConfigService.java:72) ~[cat-client-3.0.0.jar:na]\n\tat com.dianping.cat.configuration.DefaultClientConfigService.&lt;clinit&gt;\n","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464212,"discussion_content":"同一逻辑盘的意思，只要data和s2g-zuul在同一个盘下，例如都在c盘或者d盘，不要分开在不同盘下就可以了，不需要把s2g-zuul放在data里面。\n\n你启动了cat服务器吗？\n\n从错误看，好像确实没找到client.xml，而且日志文件也找不到，你尝试下调整s2g-zuul到data目录之外。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566565572,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1068571,"avatar":"https://static001.geekbang.org/account/avatar/00/10/4e/1b/f4b786b9.jpg","nickname":"飞翔","note":"","ucode":"65AF6AF292DAD6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6020,"discussion_content":"怎么启动cat服务器呀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566615799,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69892,"user_name":"tongmin_tsai","can_delete":false,"product_type":"c3","uid":1045090,"ip_address":"","ucode":"D9423E770D5846","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f2/62/f873cd8f.jpg","comment_is_top":false,"comment_ctime":1550897883,"is_pvip":false,"replies":[{"id":25120,"content":"你好，我提供的s2g-zuul，启用AsyncServlet是默认在web.xml中配置的，可以打成war包部署到tomcat，一般较新的tomcat(7以上)都支持async servlet。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1551100795,"ip_address":"","comment_id":69892,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100007001,"comment_content":"波波老师，你好，你提供的AsyncServerlet，要替换成这个servlet，是需要在源代码中修改，重新编译打包使用，还是可以有其他配置的方式使用？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440336,"discussion_content":"你好，我提供的s2g-zuul，启用AsyncServlet是默认在web.xml中配置的，可以打成war包部署到tomcat，一般较新的tomcat(7以上)都支持async servlet。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551100795,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}