{"id":40466,"title":"15 | 深入解析Pod对象（二）：使用进阶","content":"<p>你好，我是张磊。今天我和你分享的主题是：深入解析Pod对象之使用进阶。</p><p>在上一篇文章中，我深入解析了Pod的API对象，讲解了Pod和Container的关系。</p><p>作为Kubernetes项目里最核心的编排对象，Pod携带的信息非常丰富。其中，资源定义（比如CPU、内存等），以及调度相关的字段，我会在后面专门讲解调度器时再进行深入的分析。在本篇，我们就先从一种特殊的Volume开始，来帮助你更加深入地理解Pod对象各个重要字段的含义。</p><p>这种特殊的Volume，叫作Projected Volume，你可以把它翻译为“投射数据卷”。</p><blockquote>\n<p>备注：Projected Volume是Kubernetes v1.11之后的新特性</p>\n</blockquote><p>这是什么意思呢？</p><p>在Kubernetes中，有几种特殊的Volume，它们存在的意义不是为了存放容器里的数据，也不是用来进行容器和宿主机之间的数据交换。这些特殊Volume的作用，是为容器提供预先定义好的数据。所以，从容器的角度来看，这些Volume里的信息就是仿佛是<strong>被Kubernetes“投射”（Project）进入容器当中的</strong>。这正是Projected Volume的含义。</p><p>到目前为止，Kubernetes支持的Projected Volume一共有四种：</p><!-- [[[read_end]]] --><ol>\n<li>\n<p>Secret；</p>\n</li>\n<li>\n<p>ConfigMap；</p>\n</li>\n<li>\n<p>Downward API；</p>\n</li>\n<li>\n<p>ServiceAccountToken。</p>\n</li>\n</ol><p>在今天这篇文章中，<span class=\"orange\">我首先和你分享的是Secret</span>。它的作用，是帮你把Pod想要访问的加密数据，存放到Etcd中。然后，你就可以通过在Pod的容器里挂载Volume的方式，访问到这些Secret里保存的信息了。</p><p>Secret最典型的使用场景，莫过于存放数据库的Credential信息，比如下面这个例子：</p><pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: test-projected-volume \nspec:\n  containers:\n  - name: test-secret-volume\n    image: busybox\n    args:\n    - sleep\n    - &quot;86400&quot;\n    volumeMounts:\n    - name: mysql-cred\n      mountPath: &quot;/projected-volume&quot;\n      readOnly: true\n  volumes:\n  - name: mysql-cred\n    projected:\n      sources:\n      - secret:\n          name: user\n      - secret:\n          name: pass\n</code></pre><p>在这个Pod中，我定义了一个简单的容器。它声明挂载的Volume，并不是常见的emptyDir或者hostPath类型，而是projected类型。而这个 Volume的数据来源（sources），则是名为user和pass的Secret对象，分别对应的是数据库的用户名和密码。</p><p>这里用到的数据库的用户名、密码，正是以Secret对象的方式交给Kubernetes保存的。完成这个操作的指令，如下所示：</p><pre><code>$ cat ./username.txt\nadmin\n$ cat ./password.txt\nc1oudc0w!\n\n$ kubectl create secret generic user --from-file=./username.txt\n$ kubectl create secret generic pass --from-file=./password.txt\n</code></pre><p>其中，username.txt和password.txt文件里，存放的就是用户名和密码；而user和pass，则是我为Secret对象指定的名字。而我想要查看这些Secret对象的话，只要执行一条kubectl get命令就可以了：</p><pre><code>$ kubectl get secrets\nNAME           TYPE                                DATA      AGE\nuser          Opaque                                1         51s\npass          Opaque                                1         51s\n</code></pre><p>当然，除了使用kubectl create secret指令外，我也可以直接通过编写YAML文件的方式来创建这个Secret对象，比如：</p><pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: mysecret\ntype: Opaque\ndata:\n  user: YWRtaW4=\n  pass: MWYyZDFlMmU2N2Rm\n</code></pre><p>可以看到，通过编写YAML文件创建出来的Secret对象只有一个。但它的data字段，却以Key-Value的格式保存了两份Secret数据。其中，“user”就是第一份数据的Key，“pass”是第二份数据的Key。</p><p>需要注意的是，Secret对象要求这些数据必须是经过Base64转码的，以免出现明文密码的安全隐患。这个转码操作也很简单，比如：</p><pre><code>$ echo -n 'admin' | base64\nYWRtaW4=\n$ echo -n '1f2d1e2e67df' | base64\nMWYyZDFlMmU2N2Rm\n</code></pre><p>这里需要注意的是，像这样创建的Secret对象，它里面的内容仅仅是经过了转码，而并没有被加密。在真正的生产环境中，你需要在Kubernetes中开启Secret的加密插件，增强数据的安全性。关于开启Secret加密插件的内容，我会在后续专门讲解Secret的时候，再做进一步说明。</p><p>接下来，我们尝试一下创建这个Pod：</p><pre><code>$ kubectl create -f test-projected-volume.yaml\n</code></pre><p>当Pod变成Running状态之后，我们再验证一下这些Secret对象是不是已经在容器里了：</p><pre><code>$ kubectl exec -it test-projected-volume -- /bin/sh\n$ ls /projected-volume/\nuser\npass\n$ cat /projected-volume/user\nroot\n$ cat /projected-volume/pass\n1f2d1e2e67df\n</code></pre><p>从返回结果中，我们可以看到，保存在Etcd里的用户名和密码信息，已经以文件的形式出现在了容器的Volume目录里。而这个文件的名字，就是kubectl create secret指定的Key，或者说是Secret对象的data字段指定的Key。</p><p>更重要的是，像这样通过挂载方式进入到容器里的Secret，一旦其对应的Etcd里的数据被更新，这些Volume里的文件内容，同样也会被更新。其实，<strong>这是kubelet组件在定时维护这些Volume。</strong></p><p>需要注意的是，这个更新可能会有一定的延时。所以<strong>在编写应用程序时，在发起数据库连接的代码处写好重试和超时的逻辑，绝对是个好习惯。</strong></p><p><strong>与Secret类似的是ConfigMap</strong>，它与Secret的区别在于，ConfigMap保存的是不需要加密的、应用所需的配置信息。而ConfigMap的用法几乎与Secret完全相同：你可以使用kubectl create configmap从文件或者目录创建ConfigMap，也可以直接编写ConfigMap对象的YAML文件。</p><p>比如，一个Java应用所需的配置文件（.properties文件），就可以通过下面这样的方式保存在ConfigMap里：</p><pre><code># .properties文件的内容\n$ cat example/ui.properties\ncolor.good=purple\ncolor.bad=yellow\nallow.textmode=true\nhow.nice.to.look=fairlyNice\n\n# 从.properties文件创建ConfigMap\n$ kubectl create configmap ui-config --from-file=example/ui.properties\n\n# 查看这个ConfigMap里保存的信息(data)\n$ kubectl get configmaps ui-config -o yaml\napiVersion: v1\ndata:\n  ui.properties: |\n    color.good=purple\n    color.bad=yellow\n    allow.textmode=true\n    how.nice.to.look=fairlyNice\nkind: ConfigMap\nmetadata:\n  name: ui-config\n  ...\n</code></pre><blockquote>\n<p>备注：kubectl get -o yaml这样的参数，会将指定的Pod API对象以YAML的方式展示出来。</p>\n</blockquote><p><strong>接下来是Downward API</strong>，它的作用是：让Pod里的容器能够直接获取到这个Pod API对象本身的信息。</p><p>举个例子：</p><pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: test-downwardapi-volume\n  labels:\n    zone: us-est-coast\n    cluster: test-cluster1\n    rack: rack-22\nspec:\n  containers:\n    - name: client-container\n      image: k8s.gcr.io/busybox\n      command: [&quot;sh&quot;, &quot;-c&quot;]\n      args:\n      - while true; do\n          if [[ -e /etc/podinfo/labels ]]; then\n            echo -en '\\n\\n'; cat /etc/podinfo/labels; fi;\n          sleep 5;\n        done;\n      volumeMounts:\n        - name: podinfo\n          mountPath: /etc/podinfo\n          readOnly: false\n  volumes:\n    - name: podinfo\n      projected:\n        sources:\n        - downwardAPI:\n            items:\n              - path: &quot;labels&quot;\n                fieldRef:\n                  fieldPath: metadata.labels\n</code></pre><p>在这个Pod的YAML文件中，我定义了一个简单的容器，声明了一个projected类型的Volume。只不过这次Volume的数据来源，变成了Downward API。而这个Downward API Volume，则声明了要暴露Pod的metadata.labels信息给容器。</p><p>通过这样的声明方式，当前Pod的Labels字段的值，就会被Kubernetes自动挂载成为容器里的/etc/podinfo/labels文件。</p><p>而这个容器的启动命令，则是不断打印出/etc/podinfo/labels里的内容。所以，当我创建了这个Pod之后，就可以通过kubectl logs指令，查看到这些Labels字段被打印出来，如下所示：</p><pre><code>$ kubectl create -f dapi-volume.yaml\n$ kubectl logs test-downwardapi-volume\ncluster=&quot;test-cluster1&quot;\nrack=&quot;rack-22&quot;\nzone=&quot;us-est-coast&quot;\n</code></pre><p>目前，Downward API支持的字段已经非常丰富了，比如：</p><pre><code>1. 使用fieldRef可以声明使用:\nspec.nodeName - 宿主机名字\nstatus.hostIP - 宿主机IP\nmetadata.name - Pod的名字\nmetadata.namespace - Pod的Namespace\nstatus.podIP - Pod的IP\nspec.serviceAccountName - Pod的Service Account的名字\nmetadata.uid - Pod的UID\nmetadata.labels['&lt;KEY&gt;'] - 指定&lt;KEY&gt;的Label值\nmetadata.annotations['&lt;KEY&gt;'] - 指定&lt;KEY&gt;的Annotation值\nmetadata.labels - Pod的所有Label\nmetadata.annotations - Pod的所有Annotation\n\n2. 使用resourceFieldRef可以声明使用:\n容器的CPU limit\n容器的CPU request\n容器的memory limit\n容器的memory request\n</code></pre><p>上面这个列表的内容，随着Kubernetes项目的发展肯定还会不断增加。所以这里列出来的信息仅供参考，你在使用Downward API时，还是要记得去查阅一下官方文档。</p><p>不过，需要注意的是，Downward API能够获取到的信息，<strong>一定是Pod里的容器进程启动之前就能够确定下来的信息</strong>。而如果你想要获取Pod容器运行后才会出现的信息，比如，容器进程的PID，那就肯定不能使用Downward API了，而应该考虑在Pod里定义一个sidecar容器。</p><p>其实，Secret、ConfigMap，以及Downward API这三种Projected Volume定义的信息，大多还可以通过环境变量的方式出现在容器里。但是，通过环境变量获取这些信息的方式，不具备自动更新的能力。所以，一般情况下，我都建议你使用Volume文件的方式获取这些信息。</p><p>在明白了Secret之后，<span class=\"orange\">我再为你讲解Pod中一个与它密切相关的概念：Service Account</span>。</p><p>相信你一定有过这样的想法：我现在有了一个Pod，我能不能在这个Pod里安装一个Kubernetes的Client，这样就可以从容器里直接访问并且操作这个Kubernetes的API了呢？</p><p>这当然是可以的。</p><p>不过，你首先要解决API Server的授权问题。</p><p>Service Account对象的作用，就是Kubernetes系统内置的一种“服务账户”，它是Kubernetes进行权限分配的对象。比如，Service Account A，可以只被允许对Kubernetes API进行GET操作，而Service Account B，则可以有Kubernetes API的所有操作权限。</p><p>像这样的Service Account的授权信息和文件，实际上保存在它所绑定的一个特殊的Secret对象里的。这个特殊的Secret对象，就叫作<strong>ServiceAccountToken</strong>。任何运行在Kubernetes集群上的应用，都必须使用这个ServiceAccountToken里保存的授权信息，也就是Token，才可以合法地访问API Server。</p><p>所以说，Kubernetes项目的Projected Volume其实只有三种，因为第四种ServiceAccountToken，只是一种特殊的Secret而已。</p><p>另外，为了方便使用，Kubernetes已经为你提供了一个默认“服务账户”（default Service Account）。并且，任何一个运行在Kubernetes里的Pod，都可以直接使用这个默认的Service Account，而无需显示地声明挂载它。</p><p><strong>这是如何做到的呢？</strong></p><p>当然还是靠Projected Volume机制。</p><p>如果你查看一下任意一个运行在Kubernetes集群里的Pod，就会发现，每一个Pod，都已经自动声明一个类型是Secret、名为default-token-xxxx的Volume，然后 自动挂载在每个容器的一个固定目录上。比如：</p><pre><code>$ kubectl describe pod nginx-deployment-5c678cfb6d-lg9lw\nContainers:\n...\n  Mounts:\n    /var/run/secrets/kubernetes.io/serviceaccount from default-token-s8rbq (ro)\nVolumes:\n  default-token-s8rbq:\n  Type:       Secret (a volume populated by a Secret)\n  SecretName:  default-token-s8rbq\n  Optional:    false\n</code></pre><p>这个Secret类型的Volume，正是默认Service Account对应的ServiceAccountToken。所以说，Kubernetes其实在每个Pod创建的时候，自动在它的spec.volumes部分添加上了默认ServiceAccountToken的定义，然后自动给每个容器加上了对应的volumeMounts字段。这个过程对于用户来说是完全透明的。</p><p>这样，一旦Pod创建完成，容器里的应用就可以直接从这个默认ServiceAccountToken的挂载目录里访问到授权信息和文件。这个容器内的路径在Kubernetes里是固定的，即：/var/run/secrets/kubernetes.io/serviceaccount ，而这个Secret类型的Volume里面的内容如下所示：</p><pre><code>$ ls /var/run/secrets/kubernetes.io/serviceaccount \nca.crt namespace  token\n</code></pre><p>所以，你的应用程序只要直接加载这些授权文件，就可以访问并操作Kubernetes API了。而且，如果你使用的是Kubernetes官方的Client包（<code>k8s.io/client-go</code>）的话，它还可以自动加载这个目录下的文件，你不需要做任何配置或者编码操作。</p><p><strong>这种把Kubernetes客户端以容器的方式运行在集群里，然后使用default Service Account自动授权的方式，被称作“InClusterConfig”，也是我最推荐的进行Kubernetes API编程的授权方式。</strong></p><p>当然，考虑到自动挂载默认ServiceAccountToken的潜在风险，Kubernetes允许你设置默认不为Pod里的容器自动挂载这个Volume。</p><p>除了这个默认的Service Account外，我们很多时候还需要创建一些我们自己定义的Service Account，来对应不同的权限设置。这样，我们的Pod里的容器就可以通过挂载这些Service Account对应的ServiceAccountToken，来使用这些自定义的授权信息。在后面讲解为Kubernetes开发插件的时候，我们将会实践到这个操作。</p><p>接下来，我们<span class=\"orange\">再来看Pod的另一个重要的配置：容器健康检查和恢复机制。</span></p><p>在Kubernetes中，你可以为Pod里的容器定义一个健康检查“探针”（Probe）。这样，kubelet就会根据这个Probe的返回值决定这个容器的状态，而不是直接以容器镜像是否运行（来自Docker返回的信息）作为依据。这种机制，是生产环境中保证应用健康存活的重要手段。</p><p>我们一起来看一个Kubernetes文档中的例子。</p><pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  labels:\n    test: liveness\n  name: test-liveness-exec\nspec:\n  containers:\n  - name: liveness\n    image: busybox\n    args:\n    - /bin/sh\n    - -c\n    - touch /tmp/healthy; sleep 30; rm -rf /tmp/healthy; sleep 600\n    livenessProbe:\n      exec:\n        command:\n        - cat\n        - /tmp/healthy\n      initialDelaySeconds: 5\n      periodSeconds: 5\n</code></pre><p>在这个Pod中，我们定义了一个有趣的容器。它在启动之后做的第一件事，就是在/tmp目录下创建了一个healthy文件，以此作为自己已经正常运行的标志。而30 s过后，它会把这个文件删除掉。</p><p>与此同时，我们定义了一个这样的livenessProbe（健康检查）。它的类型是exec，这意味着，它会在容器启动后，在容器里面执行一条我们指定的命令，比如：“cat /tmp/healthy”。这时，如果这个文件存在，这条命令的返回值就是0，Pod就会认为这个容器不仅已经启动，而且是健康的。这个健康检查，在容器启动5 s后开始执行（initialDelaySeconds: 5），每5 s执行一次（periodSeconds: 5）。</p><p>现在，让我们来<strong>具体实践一下这个过程</strong>。</p><p>首先，创建这个Pod：</p><pre><code>$ kubectl create -f test-liveness-exec.yaml\n</code></pre><p>然后，查看这个Pod的状态：</p><pre><code>$ kubectl get pod\nNAME                READY     STATUS    RESTARTS   AGE\ntest-liveness-exec   1/1       Running   0          10s\n</code></pre><p>可以看到，由于已经通过了健康检查，这个Pod就进入了Running状态。</p><p>而30 s之后，我们再查看一下Pod的Events：</p><pre><code>$ kubectl describe pod test-liveness-exec\n</code></pre><p>你会发现，这个Pod在Events报告了一个异常：</p><pre><code>FirstSeen LastSeen    Count   From            SubobjectPath           Type        Reason      Message\n--------- --------    -----   ----            -------------           --------    ------      -------\n2s        2s      1   {kubelet worker0}   spec.containers{liveness}   Warning     Unhealthy   Liveness probe failed: cat: can't open '/tmp/healthy': No such file or directory\n</code></pre><p>显然，这个健康检查探查到/tmp/healthy已经不存在了，所以它报告容器是不健康的。那么接下来会发生什么呢？</p><p>我们不妨再次查看一下这个Pod的状态：</p><pre><code>$ kubectl get pod test-liveness-exec\nNAME           READY     STATUS    RESTARTS   AGE\nliveness-exec   1/1       Running   1          1m\n</code></pre><p>这时我们发现，Pod并没有进入Failed状态，而是保持了Running状态。这是为什么呢？</p><p>其实，如果你注意到RESTARTS字段从0到1的变化，就明白原因了：这个异常的容器已经被Kubernetes重启了。在这个过程中，Pod保持Running状态不变。</p><p>需要注意的是：Kubernetes中并没有Docker的Stop语义。所以虽然是Restart（重启），但实际却是重新创建了容器。</p><p>这个功能就是Kubernetes里的<strong>Pod恢复机制</strong>，也叫restartPolicy。它是Pod的Spec部分的一个标准字段（pod.spec.restartPolicy），默认值是Always，即：任何时候这个容器发生了异常，它一定会被重新创建。</p><p>但一定要强调的是，Pod的恢复过程，永远都是发生在当前节点上，而不会跑到别的节点上去。事实上，一旦一个Pod与一个节点（Node）绑定，除非这个绑定发生了变化（pod.spec.node字段被修改），否则它永远都不会离开这个节点。这也就意味着，如果这个宿主机宕机了，这个Pod也不会主动迁移到其他节点上去。</p><p>而如果你想让Pod出现在其他的可用节点上，就必须使用Deployment这样的“控制器”来管理Pod，哪怕你只需要一个Pod副本。这就是我在第12篇文章<a href=\"https://time.geekbang.org/column/article/40008\">《牛刀小试：我的第一个容器化应用》</a>最后给你留的思考题的答案，即一个单Pod的Deployment与一个Pod最主要的区别。</p><p>而作为用户，你还可以通过设置restartPolicy，改变Pod的恢复策略。除了Always，它还有OnFailure和Never两种情况：</p><ul>\n<li>Always：在任何情况下，只要容器不在运行状态，就自动重启容器；</li>\n<li>OnFailure: 只在容器 异常时才自动重启容器；</li>\n<li>Never: 从来不重启容器。</li>\n</ul><p>在实际使用时，我们需要根据应用运行的特性，合理设置这三种恢复策略。</p><p>比如，一个Pod，它只计算1+1=2，计算完成输出结果后退出，变成Succeeded状态。这时，你如果再用restartPolicy=Always强制重启这个Pod的容器，就没有任何意义了。</p><p>而如果你要关心这个容器退出后的上下文环境，比如容器退出后的日志、文件和目录，就需要将restartPolicy设置为Never。因为一旦容器被自动重新创建，这些内容就有可能丢失掉了（被垃圾回收了）。</p><p>值得一提的是，Kubernetes的官方文档，把restartPolicy和Pod里容器的状态，以及Pod状态的对应关系，<a href=\"https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#example-states\">总结了非常复杂的一大堆情况</a>。实际上，你根本不需要死记硬背这些对应关系，只要记住如下两个基本的设计原理即可：</p><ol>\n<li>\n<p><strong>只要Pod的restartPolicy指定的策略允许重启异常的容器（比如：Always），那么这个Pod就会保持Running状态，并进行容器重启</strong>。否则，Pod就会进入Failed状态 。</p>\n</li>\n<li>\n<p><strong>对于包含多个容器的Pod，只有它里面所有的容器都进入异常状态后，Pod才会进入Failed状态</strong>。在此之前，Pod都是Running状态。此时，Pod的READY字段会显示正常容器的个数，比如：</p>\n</li>\n</ol><pre><code>$ kubectl get pod test-liveness-exec\nNAME           READY     STATUS    RESTARTS   AGE\nliveness-exec   0/1       Running   1          1m\n</code></pre><p>所以，假如一个Pod里只有一个容器，然后这个容器异常退出了。那么，只有当restartPolicy=Never时，这个Pod才会进入Failed状态。而其他情况下，由于Kubernetes都可以重启这个容器，所以Pod的状态保持Running不变。</p><p>而如果这个Pod有多个容器，仅有一个容器异常退出，它就始终保持Running状态，哪怕即使restartPolicy=Never。只有当所有容器也异常退出之后，这个Pod才会进入Failed状态。</p><p>其他情况，都可以以此类推出来。</p><p>现在，我们一起回到前面提到的livenessProbe上来。</p><p>除了在容器中执行命令外，livenessProbe也可以定义为发起HTTP或者TCP请求的方式，定义格式如下：</p><pre><code>...\nlivenessProbe:\n     httpGet:\n       path: /healthz\n       port: 8080\n       httpHeaders:\n       - name: X-Custom-Header\n         value: Awesome\n       initialDelaySeconds: 3\n       periodSeconds: 3\n</code></pre><pre><code>    ...\n    livenessProbe:\n      tcpSocket:\n        port: 8080\n      initialDelaySeconds: 15\n      periodSeconds: 20\n</code></pre><p>所以，你的Pod其实可以暴露一个健康检查URL（比如/healthz），或者直接让健康检查去检测应用的监听端口。这两种配置方法，在Web服务类的应用中非常常用。</p><p>在Kubernetes的Pod中，还有一个叫readinessProbe的字段。虽然它的用法与livenessProbe类似，但作用却大不一样。readinessProbe检查结果的成功与否，决定的这个Pod是不是能被通过Service的方式访问到，而并不影响Pod的生命周期。这部分内容，我会在讲解Service时重点介绍。</p><p>在讲解了这么多字段之后，想必你对Pod对象的语义和描述能力，已经有了一个初步的感觉。</p><p>这时，你有没有产生这样一个想法：Pod的字段这么多，我又不可能全记住，<span class=\"orange\">Kubernetes能不能自动给Pod填充某些字段呢？</span></p><p>这个需求实际上非常实用。比如，开发人员只需要提交一个基本的、非常简单的Pod YAML，Kubernetes就可以自动给对应的Pod对象加上其他必要的信息，比如labels，annotations，volumes等等。而这些信息，可以是运维人员事先定义好的。</p><p>这么一来，开发人员编写Pod YAML的门槛，就被大大降低了。</p><p>所以，这个叫作PodPreset（Pod预设置）的功能 已经出现在了v1.11版本的Kubernetes中。</p><p>举个例子，现在开发人员编写了如下一个 pod.yaml文件：</p><pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: website\n  labels:\n    app: website\n    role: frontend\nspec:\n  containers:\n    - name: website\n      image: nginx\n      ports:\n        - containerPort: 80\n</code></pre><p>作为Kubernetes的初学者，你肯定眼前一亮：这不就是我最擅长编写的、最简单的Pod嘛。没错，这个YAML文件里的字段，想必你现在闭着眼睛也能写出来。</p><p>可是，如果运维人员看到了这个Pod，他一定会连连摇头：这种Pod在生产环境里根本不能用啊！</p><p>所以，这个时候，运维人员就可以定义一个PodPreset对象。在这个对象中，凡是他想在开发人员编写的Pod里追加的字段，都可以预先定义好。比如这个preset.yaml：</p><pre><code>apiVersion: settings.k8s.io/v1alpha1\nkind: PodPreset\nmetadata:\n  name: allow-database\nspec:\n  selector:\n    matchLabels:\n      role: frontend\n  env:\n    - name: DB_PORT\n      value: &quot;6379&quot;\n  volumeMounts:\n    - mountPath: /cache\n      name: cache-volume\n  volumes:\n    - name: cache-volume\n      emptyDir: {}\n</code></pre><p>在这个PodPreset的定义中，首先是一个selector。这就意味着后面这些追加的定义，只会作用于selector所定义的、带有“role: frontend”标签的Pod对象，这就可以防止“误伤”。</p><p>然后，我们定义了一组Pod的Spec里的标准字段，以及对应的值。比如，env里定义了DB_PORT这个环境变量，volumeMounts定义了容器Volume的挂载目录，volumes定义了一个emptyDir的Volume。</p><p>接下来，我们假定运维人员先创建了这个PodPreset，然后开发人员才创建Pod：</p><pre><code>$ kubectl create -f preset.yaml\n$ kubectl create -f pod.yaml\n</code></pre><p>这时，Pod运行起来之后，我们查看一下这个Pod的API对象：</p><pre><code>$ kubectl get pod website -o yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: website\n  labels:\n    app: website\n    role: frontend\n  annotations:\n    podpreset.admission.kubernetes.io/podpreset-allow-database: &quot;resource version&quot;\nspec:\n  containers:\n    - name: website\n      image: nginx\n      volumeMounts:\n        - mountPath: /cache\n          name: cache-volume\n      ports:\n        - containerPort: 80\n      env:\n        - name: DB_PORT\n          value: &quot;6379&quot;\n  volumes:\n    - name: cache-volume\n      emptyDir: {}\n</code></pre><p>这个时候，我们就可以清楚地看到，这个Pod里多了新添加的labels、env、volumes和volumeMount的定义，它们的配置跟PodPreset的内容一样。此外，这个Pod还被自动加上了一个annotation表示这个Pod对象被PodPreset改动过。</p><p>需要说明的是，<strong>PodPreset里定义的内容，只会在Pod API对象被创建之前追加在这个对象本身上，而不会影响任何Pod的控制器的定义。</strong></p><p>比如，我们现在提交的是一个nginx-deployment，那么这个Deployment对象本身是永远不会被PodPreset改变的，被修改的只是这个Deployment创建出来的所有Pod。这一点请务必区分清楚。</p><p>这里有一个问题：如果你定义了同时作用于一个Pod对象的多个PodPreset，会发生什么呢？</p><p>实际上，Kubernetes项目会帮你合并（Merge）这两个PodPreset要做的修改。而如果它们要做的修改有冲突的话，这些冲突字段就不会被修改。</p><h2>总结</h2><p>在今天这篇文章中，我和你详细介绍了Pod对象更高阶的使用方法，希望通过对这些实例的讲解，你可以更深入地理解Pod API对象的各个字段。</p><p>而在学习这些字段的同时，你还应该认真体会一下Kubernetes“一切皆对象”的设计思想：比如应用是Pod对象，应用的配置是ConfigMap对象，应用要访问的密码则是Secret对象。</p><p>所以，也就自然而然地有了PodPreset这样专门用来对Pod进行批量化、自动化修改的工具对象。在后面的内容中，我会为你讲解更多的这种对象，还会和你介绍Kubernetes项目如何围绕着这些对象进行容器编排。</p><p>在本专栏中，Pod对象相关的知识点非常重要，它是接下来Kubernetes能够描述和编排各种复杂应用的基石所在，希望你能够继续多实践、多体会。</p><h2>思考题</h2><p>在没有Kubernetes的时候，你是通过什么方法进行应用的健康检查的？Kubernetes的livenessProbe和readinessProbe提供的几种探测机制，是否能满足你的需求？</p><p>感谢你的收听，欢迎你给我留言，也欢迎分享给更多的朋友一起阅读。</p>","neighbors":{"left":{"article_title":"14 | 深入解析Pod对象（一）：基本概念","id":40366},"right":{"article_title":"16 | 编排其实很简单：谈谈“控制器”模型","id":40583}},"comments":[{"had_liked":false,"id":244047,"user_name":"ch_ort","can_delete":false,"product_type":"c1","uid":1580926,"ip_address":"","ucode":"B79746E687F29E","user_header":"","comment_is_top":false,"comment_ctime":1598366932,"is_pvip":false,"discussion_count":13,"race_medal":0,"score":"628663592148","product_id":100015201,"comment_content":"Kuberentes可以理解为操作系统，那么容器就是进程，而Pod就是进程组or虚拟机（几个进程关联在一起）。<br><br>Pod的设计之初有两个目的：<br>（1）为了处理容器之间的调度关系<br>（2） 实现容器设计模式： Pod会先启动Infra容器设置网络、Volume等namespace（如果Volume要共享的话），其他容器通过加入的方式共享这些Namespace。<br><br>如果对Pod中的容器启动有顺序要求，可以使用Init Contianer。所有Init Container定义的容器，都会比spec.containers定义的用户容器按顺序优先启动。Init Container容器会按顺序逐一启动，而直到它们都启动并且退出了，用户容器才会启动。<br><br>Pod使用过程中的重要字段：<br>（1）pod自定义&#47;etc&#47;hosts:  spec.hostAliases<br>（2）pod共享PID : spec.shareProcessNamespace <br>（3）容器启动后&#47;销毁前的钩子： spec.container.lifecycle.postStart&#47;preStop<br>（4）pod的状态：spec.status.phase<br>（5）pod特殊的volume（投射数据卷）:<br>   5.1) 密码信息获取：创建Secrete对象保存加密数据，存放到Etcd中。然后，你就可以通过在Pod的容器里挂载Volume的方式，访问到这些Secret里保存的信息<br>  5.2）配置信息获取：创建ConfigMap对象保存加密数据，存放到Etcd中。然后，通过挂载Volume的方式，访问到ConfigMap里保存的内容<br>  5.3）容器获取Pod中定义的静态信息：通过挂载DownwardAPI 这个特殊的Volume，访问到Pod中定义的静态信息<br>  5.4) Pod中要访问K8S的API：任何运行在Kubernetes集群上的应用，都必须使用这个ServiceAccountToken里保存的授权信息，也就是Token，才可以合法地访问API Server。因此，通过挂载Volume的方式，把对应权限的ServiceAccountToken这个特殊的Secrete挂载到Pod中即可<br>  （6）容器是否健康： spec.container.livenessProbe。若不健康，则Pod有可能被重启（可配置策略）<br>  （7）容器是否可用： spec.container.readinessProbe。若不健康，则service不会访问到该Pod<br>","like_count":147,"discussions":[{"author":{"id":2853149,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/89/1d/d1d8edcc.jpg","nickname":"梅斌","note":"","ucode":"DDE15A3FD12738","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545134,"discussion_content":"6错了，pod不会“重启”，是会杀掉失败的容器后再创建一个新容器","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1641861845,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1105161,"avatar":"https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg","nickname":"helloworld","note":"","ucode":"1EECCA0F43E278","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":325879,"discussion_content":"5.2有误","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1605451225,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2014285,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKNv880TlsNuKaWcKbxiaAZTQIBWfJAddC8wfOROnwRPRwJXaEGSTBH2sic4jK7IGpxZn79tTDcREjw/132","nickname":"Geek_7482f6","note":"","ucode":"F3565F78525D30","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1105161,"avatar":"https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg","nickname":"helloworld","note":"","ucode":"1EECCA0F43E278","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":400786,"discussion_content":"确实","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633427879,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":325879,"ip_address":""},"score":400786,"extra":""}]},{"author":{"id":1813643,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/ac/8b/5f02056a.jpg","nickname":"Mr.Wang","note":"","ucode":"2BBB013B26B2D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":321285,"discussion_content":"mk","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1604559448,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1156489,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a5/89/d3a2fed9.jpg","nickname":"lwy_Robb","note":"","ucode":"B18B82763EA2BF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":405953,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634661437,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1447739,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eou1BMETumU21ZI4yiaLenOMSibzkAgkw944npIpsJRicmdicxlVQcgibyoQ00rdGk9Htp1j0dM5CP2Fibw/132","nickname":"寥若晨星","note":"","ucode":"2E87E43687DE72","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394102,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631721311,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2689906,"avatar":"https://static001.geekbang.org/account/avatar/00/29/0b/72/5dc6f786.jpg","nickname":"Ts","note":"","ucode":"EC3ABE1A12AD66","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385155,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626922786,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2115127,"avatar":"","nickname":"siko","note":"","ucode":"2E04E37C6D29F4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384863,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626775508,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1837179,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/08/7b/7f086546.jpg","nickname":"Alex","note":"","ucode":"70806CEA9AB15E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381250,"discussion_content":"老🐎","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624970468,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2126468,"avatar":"https://static001.geekbang.org/account/avatar/00/20/72/84/079fa620.jpg","nickname":"hj24","note":"","ucode":"D7C31FF9BC0A81","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372480,"discussion_content":"m","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620351546,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1006424,"avatar":"","nickname":"门窗小二","note":"","ucode":"0BF3780C247F22","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":357205,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615766806,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2325365,"avatar":"https://static001.geekbang.org/account/avatar/00/23/7b/75/ad435499.jpg","nickname":"爱咋的咋的","note":"","ucode":"A416C4E8C12E78","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":330054,"discussion_content":"mk","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606513934,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1201471,"avatar":"https://static001.geekbang.org/account/avatar/00/12/55/3f/bfffaad7.jpg","nickname":"luke","note":"","ucode":"75758B3A52ED2F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311472,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602345773,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27740,"user_name":"huan","can_delete":false,"product_type":"c1","uid":1012286,"ip_address":"","ucode":"46CB95F6E4E5FF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/72/3e/534db55d.jpg","comment_is_top":false,"comment_ctime":1537935363,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"263530940419","product_id":100015201,"comment_content":"不实践，就无法理解为什么pod这么设计，这里给了我自己的实践的记录：<br><br>https:&#47;&#47;github.com&#47;huan9huan&#47;k8s-practice&#47;tree&#47;master&#47;15-pod-advanced<br><br>仅供参考。","like_count":61,"discussions":[{"author":{"id":1257338,"avatar":"https://static001.geekbang.org/account/avatar/00/13/2f/7a/741fb07b.jpg","nickname":"白菜","note":"","ucode":"EA051509DF4C09","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":69169,"discussion_content":"kubectl describe secrets/mysecret  你实践记录写的这里有误，应该是kubectl describe secrets/my-secret","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1575267222,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":28180,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1538016507,"is_pvip":false,"replies":[{"id":"10141","content":"对。新特性需要先启用。","user_name":"作者回复","comment_id":28180,"uid":"1218095","ip_address":"","utype":1,"ctime":1538023558,"user_name_real":"Geek_6ef93d"}],"discussion_count":15,"race_medal":0,"score":"173336708347","product_id":100015201,"comment_content":"在使用PodPreset对象时,发现并未生效,最终才知道是因为当初安装时未启用 Pod Preset.然后参考[https:&#47;&#47;kubernetes.io&#47;docs&#47;concepts&#47;workloads&#47;pods&#47;podpreset&#47;#enable-pod-preset] 修改  [&#47;etc&#47;kubernetes&#47;manifests&#47;kube-apiserver.yaml] 中的spec.containers.command:   修改原[ - --runtime-config=api&#47;all=true]为[- --runtime-config=api&#47;all=true,settings.k8s.io&#47;v1alpha1=true], 新加一行[- --enable-admission-plugins=PodPreset] 可以等自动生效也可以强制重启[systemctl restart kubelet]. 然后再重新创建,就可以在pod中看见spec.containers.env.name:DB_PORT等信息了.","like_count":41,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425169,"discussion_content":"对。新特性需要先启用。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538023558,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1296804,"avatar":"https://static001.geekbang.org/account/avatar/00/13/c9/a4/0710bbbd.jpg","nickname":"Geek_18858f","note":"","ucode":"391B5F20C2E860","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539421,"discussion_content":"Kubernetes v1.20 ChangeLog:\n\nThe v1alpha1 PodPreset API and admission plugin has been removed with no built-in replacement. Admission webhooks can be used to modify pods on creation. ","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1639711539,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1325816,"avatar":"https://static001.geekbang.org/account/avatar/00/14/3a/f8/c1a939e7.jpg","nickname":"君哥聊技术","note":"","ucode":"2C9A22BCE4C79E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288484,"discussion_content":"我的是v1.17.3版本，增加下面配置后就可以了\n\nvi /etc/kubernetes/manifests/kube-apiserver.yaml\n#增加这一行\n- --runtime-config=settings.k8s.io/v1alpha1=true\n#在下一行后面增加&#34;,PodPreset&#34;\n- --enable-admission-plugins=NodeRestriction","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1593759112,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2441261,"avatar":"https://static001.geekbang.org/account/avatar/00/25/40/2d/9a766753.jpg","nickname":"郭贻铖","note":"","ucode":"B14B1DB14031F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350771,"discussion_content":"v1.20.4直接搞死","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1614003219,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1205253,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","nickname":"我来也","note":"","ucode":"773D6104F56767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2441261,"avatar":"https://static001.geekbang.org/account/avatar/00/25/40/2d/9a766753.jpg","nickname":"郭贻铖","note":"","ucode":"B14B1DB14031F2","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350801,"discussion_content":"😄 这都经过好多个k8s的大版本啦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614010066,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":350771,"ip_address":""},"score":350801,"extra":""},{"author":{"id":1311001,"avatar":"https://static001.geekbang.org/account/avatar/00/14/01/19/f4da2829.jpg","nickname":"一秒","note":"","ucode":"F149B7F60620BD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2441261,"avatar":"https://static001.geekbang.org/account/avatar/00/25/40/2d/9a766753.jpg","nickname":"郭贻铖","note":"","ucode":"B14B1DB14031F2","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351280,"discussion_content":"老哥找到解决方法了吗","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1614225112,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":350771,"ip_address":""},"score":351280,"extra":""}]},{"author":{"id":1129632,"avatar":"https://static001.geekbang.org/account/avatar/00/11/3c/a0/8b9d5aca.jpg","nickname":"eagle","note":"","ucode":"D7601A2AFC1D17","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344130,"discussion_content":"2021年过来挖坟，发现 PodPreset 官方文档都 404 了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611301338,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1205253,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","nickname":"我来也","note":"","ucode":"773D6104F56767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1129632,"avatar":"https://static001.geekbang.org/account/avatar/00/11/3c/a0/8b9d5aca.jpg","nickname":"eagle","note":"","ucode":"D7601A2AFC1D17","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344185,"discussion_content":"哈哈，k8s变化太快了。好像现在有官方中文文档。😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611318220,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":344130,"ip_address":""},"score":344185,"extra":""}]},{"author":{"id":2399354,"avatar":"https://static001.geekbang.org/account/avatar/00/24/9c/7a/eecbdf22.jpg","nickname":"半 檐 疏 雨","note":"","ucode":"2FB6F652E62367","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":341843,"discussion_content":"我在 v1.20.1 中这样配置，集群重启会失败。在官方文档中找到关于PodPreset的资料，只有v1.18版本的文档资料。      \n然后我重新创建一个v1.18.3的Kubernetes集群。使用同样的方式开启PodPreset特性后，集群重启成功。创建pod也能成功创建。\n\n大佬指点一下！！！\n是不是PodPreset特性在v1.19开始，开启的方式发生了变化？还是PodPreset特性更换为别的了？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610536399,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1205253,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","nickname":"我来也","note":"","ucode":"773D6104F56767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2399354,"avatar":"https://static001.geekbang.org/account/avatar/00/24/9c/7a/eecbdf22.jpg","nickname":"半 檐 疏 雨","note":"","ucode":"2FB6F652E62367","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":341917,"discussion_content":"你这个太超前了，哈哈。我也没玩过。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610543048,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":341843,"ip_address":""},"score":341917,"extra":""}]},{"author":{"id":1069133,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/4d/db91e218.jpg","nickname":"sam700000","note":"","ucode":"C2ABDDC56B2D50","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":24817,"discussion_content":"多谢，我照着改，然后重启kubelet就行了，kubernetes版本1.5.2","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570274124,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1522995,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/HfnrQlGW842BmSeVG7iciazV7U2CaYbODPbQ144qG1pSgHjhCW3OziaoqKJISfoZlEBsWsuVZtkLdCvuNUoibnsUfw/132","nickname":"Geek_hander","note":"","ucode":"3147A30A34BC8F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":23005,"discussion_content":"应该是要重启apiserver：systemctl restart kube-apiserver","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569739111,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1227336,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ba/48/c892a35b.jpg","nickname":"csoulsi","note":"","ucode":"96C9BBE9097FB3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1522995,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/HfnrQlGW842BmSeVG7iciazV7U2CaYbODPbQ144qG1pSgHjhCW3OziaoqKJISfoZlEBsWsuVZtkLdCvuNUoibnsUfw/132","nickname":"Geek_hander","note":"","ucode":"3147A30A34BC8F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":79360,"discussion_content":"你的版本是多少啊？我的1.16的还是不行","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576074014,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":23005,"ip_address":""},"score":79360,"extra":""}]},{"author":{"id":1145939,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIO6eRuuA6V31MdFeKxghjK8SiaVUM5iaO8ibII4b2PYx7WCCmQ3yiaadaDibQft8hPtUqlScLian4PanSQ/132","nickname":"Geek_b59356","note":"","ucode":"0993804D49E73A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389,"discussion_content":"改了这两行配置还是不行，不知道什么原因。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561527744,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1227336,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ba/48/c892a35b.jpg","nickname":"csoulsi","note":"","ucode":"96C9BBE9097FB3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1145939,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIO6eRuuA6V31MdFeKxghjK8SiaVUM5iaO8ibII4b2PYx7WCCmQ3yiaadaDibQft8hPtUqlScLian4PanSQ/132","nickname":"Geek_b59356","note":"","ucode":"0993804D49E73A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":77048,"discussion_content":"我也是，你后来找到原因了吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575883581,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":389,"ip_address":""},"score":77048,"extra":""}]}]},{"had_liked":false,"id":27568,"user_name":"Geek_zz","can_delete":false,"product_type":"c1","uid":1130682,"ip_address":"","ucode":"A3AC7C2991B50D","user_header":"https://static001.geekbang.org/account/avatar/00/11/40/ba/2c8af305.jpg","comment_is_top":false,"comment_ctime":1537921910,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"117502038902","product_id":100015201,"comment_content":"信息量大，要多看两遍","like_count":27},{"had_liked":false,"id":28050,"user_name":"北卡","can_delete":false,"product_type":"c1","uid":1218128,"ip_address":"","ucode":"2D947A61689FC6","user_header":"https://static001.geekbang.org/account/avatar/00/12/96/50/bde525b1.jpg","comment_is_top":false,"comment_ctime":1537982440,"is_pvip":false,"replies":[{"id":"10123","content":"deployment确实是这么要求的啊。不过你可以想想为什么。","user_name":"作者回复","comment_id":28050,"uid":"1218095","ip_address":"","utype":1,"ctime":1538018308,"user_name_real":"Geek_6ef93d"}],"discussion_count":4,"race_medal":0,"score":"78847393768","product_id":100015201,"comment_content":"我记得deployment所创建的pod restart策略只支持aways。是我使用的版本太低了吗？","like_count":18,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425126,"discussion_content":"deployment确实是这么要求的啊。不过你可以想想为什么。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538018308,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1445106,"avatar":"https://static001.geekbang.org/account/avatar/00/16/0c/f2/eff644f9.jpg","nickname":"Geek_f04d81","note":"","ucode":"ECD9F1BE0B2186","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288520,"discussion_content":"为了最少有一个pod可用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593771128,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1043738,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ed/1a/ce7f7d54.jpg","nickname":"asdf100","note":"","ucode":"39D8D71453E575","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3569,"discussion_content":"理解的是为了pod的调度，不知道对不对？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564586902,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2009498,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/a9/9a/5df6cc22.jpg","nickname":"h","note":"","ucode":"47893B5F8913B4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1043738,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ed/1a/ce7f7d54.jpg","nickname":"asdf100","note":"","ucode":"39D8D71453E575","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":285652,"discussion_content":"因为deployment必须要维持一定量得副本数","likes_number":8,"is_delete":false,"is_hidden":false,"ctime":1592904505,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":3569,"ip_address":""},"score":285652,"extra":""}]}]},{"had_liked":false,"id":27597,"user_name":"snakorse","can_delete":false,"product_type":"c1","uid":1064887,"ip_address":"","ucode":"0AD727E1F16993","user_header":"https://static001.geekbang.org/account/avatar/00/10/3f/b7/0d8b5431.jpg","comment_is_top":false,"comment_ctime":1537923405,"is_pvip":false,"replies":[{"id":"9988","content":"不是的，exec","user_name":"作者回复","comment_id":27597,"uid":"1218095","ip_address":"","utype":1,"ctime":1537938092,"user_name_real":"Geek_6ef93d"}],"discussion_count":1,"race_medal":0,"score":"61667465549","product_id":100015201,"comment_content":"probe的原理是通过sidecar容器来实现的吗","like_count":14,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424960,"discussion_content":"不是的，exec","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537938092,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":88532,"user_name":"QQ怪","can_delete":false,"product_type":"c1","uid":1211223,"ip_address":"","ucode":"1A39B8433D9208","user_header":"https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg","comment_is_top":false,"comment_ctime":1555937140,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"53095544692","product_id":100015201,"comment_content":"我公司也在用livenessprobe和readinessprobe，第一个是就绪探针在确定容器是否已经就绪可以接受流量，而第二个是存活容器来确定容器是否假死，如果遇到假死则开始重启p","like_count":12,"discussions":[{"author":{"id":1326131,"avatar":"https://static001.geekbang.org/account/avatar/00/14/3c/33/15648d99.jpg","nickname":"あき","note":"","ucode":"2629502A07E3A0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":43748,"discussion_content":"反了","likes_number":14,"is_delete":false,"is_hidden":false,"ctime":1572890814,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1592298,"avatar":"https://static001.geekbang.org/account/avatar/00/18/4b/ea/a9e7bc50.jpg","nickname":"℡人见人爱浩然君゜","note":"","ucode":"D042A622533C72","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":566835,"discussion_content":"确实是反了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650772399,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":34131,"user_name":"章宇军","can_delete":false,"product_type":"c1","uid":1000796,"ip_address":"","ucode":"746F14150C8285","user_header":"https://static001.geekbang.org/account/avatar/00/0f/45/5c/d983c652.jpg","comment_is_top":false,"comment_ctime":1540014119,"is_pvip":false,"replies":[{"id":"12180","content":"没错。Secret里要保存的东西很可能是一个文件，所以它的类型是map[string][]byte。但从设计的角度来说，Secret也需要避免用户把credential string直接写在yaml里。","user_name":"作者回复","comment_id":34131,"uid":"1218095","ip_address":"","utype":1,"ctime":1540026268,"user_name_real":"Geek_6ef93d"}],"discussion_count":2,"race_medal":0,"score":"53079621671","product_id":100015201,"comment_content":"“需要注意的是，Secret 对象要求这些数据必须是经过 Base64 转码的，以免出现明文密码的安全隐患。” base64 等同于明文吧……我理解是主要是为了 binary 类型的数据。","like_count":12,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427126,"discussion_content":"没错。Secret里要保存的东西很可能是一个文件，所以它的类型是map[string][]byte。但从设计的角度来说，Secret也需要避免用户把credential string直接写在yaml里。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540026268,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2518763,"avatar":"https://static001.geekbang.org/account/avatar/00/26/6e/eb/a891e77f.jpg","nickname":"Jasper Wu","note":"","ucode":"D6F3D58731BC02","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":413932,"discussion_content":"secret可以有很多奇怪的字符 直接存储和传输可能会出错，所以通常都要base64","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636613721,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":33952,"user_name":"寞月","can_delete":false,"product_type":"c1","uid":1226786,"ip_address":"","ucode":"7243313ED73754","user_header":"https://static001.geekbang.org/account/avatar/00/12/b8/22/6d63d3fc.jpg","comment_is_top":false,"comment_ctime":1539928594,"is_pvip":false,"replies":[{"id":"12150","content":"嗯，代码实现目前就是这样的。有具体的影响吗？除了报错比较多之外。","user_name":"作者回复","comment_id":33952,"uid":"1218095","ip_address":"","utype":1,"ctime":1539935171,"user_name_real":"Geek_6ef93d"}],"discussion_count":2,"race_medal":0,"score":"44489601554","product_id":100015201,"comment_content":"老师好，probe我们在生产实际应用中，有个问题。就是，每次新部署的时候，旧容器要做graceful delete，这个会触发kubelet的delete逻辑。 只有在容器被kill以后，k8s才会remove 这个探针。即，容器已经收到kill信号在停服务了，但是探针还在检测于是一直报错。   不知道有没有配置可解决这个问题。","like_count":10,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427084,"discussion_content":"嗯，代码实现目前就是这样的。有具体的影响吗？除了报错比较多之外。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539935171,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1311001,"avatar":"https://static001.geekbang.org/account/avatar/00/14/01/19/f4da2829.jpg","nickname":"一秒","note":"","ucode":"F149B7F60620BD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351298,"discussion_content":"他应该是想加入一个维护的功能","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614235185,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":88777,"user_name":"驕莎","can_delete":false,"product_type":"c1","uid":1205656,"ip_address":"","ucode":"F8C9D60738499D","user_header":"https://static001.geekbang.org/account/avatar/00/12/65/98/02bea067.jpg","comment_is_top":false,"comment_ctime":1555998593,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"40210704257","product_id":100015201,"comment_content":"使用yaml文件创建secret对象部分的验证阶段有问题：<br>$ kubectl exec -it test-projected-volume -- &#47;bin&#47;sh<br>$ ls &#47;projected-volume&#47;<br>user<br>pass<br>$ cat &#47;projected-volume&#47;user<br>root<br>$ cat &#47;projected-volume&#47;pass<br>1f2d1e2e67df<br><br>上面&#47;projected-volume&#47;user里面的内容应该是admin，而非root<br><br>另外一个问题，之前课程建议使用kubectl apply的方式创建和更新对象，为什么这篇里面还是全用kubectl create的方式呢？","like_count":9,"discussions":[{"author":{"id":1086319,"avatar":"https://static001.geekbang.org/account/avatar/00/10/93/6f/5ab3da19.jpg","nickname":"慕容","note":"","ucode":"BEE694935853E1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":267642,"discussion_content":"这里的ConfigMap和Secret的创建，实践之后你就会发现，通过kubectl create XXX --from-file的方式更方便快捷，无需自己去处理复杂的yaml格式","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1589668601,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":28274,"user_name":"龙坤","can_delete":false,"product_type":"c1","uid":1233455,"ip_address":"","ucode":"D1724E68D6304D","user_header":"https://static001.geekbang.org/account/avatar/00/12/d2/2f/04882ff8.jpg","comment_is_top":false,"comment_ctime":1538039092,"is_pvip":false,"replies":[{"id":"10173","content":"client library，kubernetes 对外暴露的api","user_name":"作者回复","comment_id":28274,"uid":"1218095","ip_address":"","utype":1,"ctime":1538049699,"user_name_real":"Geek_6ef93d"}],"discussion_count":4,"race_medal":1,"score":"40192744756","product_id":100015201,"comment_content":"老师你好，有句话不太明白<br>原文：“相信你一定有过这样的想法：我现在有了一个 Pod，我能不能在这个 Pod 里安装一个 Kubernetes 的Client，这样就可以从容器里直接访问并且操作这个 Kubernetes 的 API 了呢？”<br><br>1. 这里可以举个简单例子吗？<br>2.“kubernetes的client”指的是什么？<br>3. 操作“kubernetes的API”这里的API由指什么？<br><br>小白问题，过不了这关，听得有点晕。见谅<br>","like_count":9,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425205,"discussion_content":"client library，kubernetes 对外暴露的api","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1538049699,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1691380,"avatar":"https://static001.geekbang.org/account/avatar/00/19/ce/f4/d68fa921.jpg","nickname":"jason","note":"","ucode":"5F01F0E913C16F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":345304,"discussion_content":"你可能是做运维的\n做开发的比较好理解，例如开发一个集群监控软件，通过容器部署，就需要一个访问集群的客户端","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611710450,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1311001,"avatar":"https://static001.geekbang.org/account/avatar/00/14/01/19/f4da2829.jpg","nickname":"一秒","note":"","ucode":"F149B7F60620BD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1691380,"avatar":"https://static001.geekbang.org/account/avatar/00/19/ce/f4/d68fa921.jpg","nickname":"jason","note":"","ucode":"5F01F0E913C16F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351303,"discussion_content":"我也没理解。你说的通过容器部署，访问集群的客户端是什么东东？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614235542,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":345304,"ip_address":""},"score":351303,"extra":""},{"author":{"id":2378009,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKicUgL8bc6EDj2w7GG8UjxRFYicmXlAdUHaSRdAT798ibpfOgF9OWFku5jad5ezWFGkCWXnoqFgSWlw/132","nickname":"iamcaptain","note":"","ucode":"868D95D47E033E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1311001,"avatar":"https://static001.geekbang.org/account/avatar/00/14/01/19/f4da2829.jpg","nickname":"一秒","note":"","ucode":"F149B7F60620BD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374910,"discussion_content":"简单点就是把访问集群的客户端程序以容器的方式部署而已，这个容器是在这个k8s器群上的。不知道这么解释有没有问题","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1621409477,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":351303,"ip_address":""},"score":374910,"extra":""}]}]},{"had_liked":false,"id":27595,"user_name":"Dale","can_delete":false,"product_type":"c1","uid":1010056,"ip_address":"","ucode":"DD4717C06E417D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/69/88/528442b0.jpg","comment_is_top":false,"comment_ctime":1537923258,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"35897661626","product_id":100015201,"comment_content":"Kubernetes 的 livenessProbe 和 readinessProbe 两个在项目中都用到了，最基本的是定时检测服务端口是否在，毕竟好的是请求服务，例如针对http服务，发起一个请求，查看服务是否正常，因为有时候端口在，服务不一定正常。","like_count":8},{"had_liked":false,"id":45571,"user_name":"Pixar","can_delete":false,"product_type":"c1","uid":1197659,"ip_address":"","ucode":"E653387BA8EA16","user_header":"https://static001.geekbang.org/account/avatar/00/12/46/5b/07858c33.jpg","comment_is_top":false,"comment_ctime":1543681365,"is_pvip":false,"replies":[{"id":"16258","content":"很简单。restart policy 要尊重 liveness probe","user_name":"作者回复","comment_id":45571,"uid":"1218095","ip_address":"","utype":1,"ctime":1543732897,"user_name_real":"Geek_6ef93d"}],"discussion_count":1,"race_medal":0,"score":"27313485141","product_id":100015201,"comment_content":"复习了下容器的检查探针, 有几个点还是没太明白, 还望老师能解答下:<br>1.  restartPolicy : 这个restartPolicy是重启的Pod的Container, 那么重启的时机是根据Container结束时返回的状态码吗? <br>2. restart 和 probe的关系:  Pod某个容器的livenessProbe 返回fail, 这个时候Container并没有结束, 只是状态检查是失败的, 那为什么Container也会重启呢?  这个重启动作是谁发起的呢?<br>3. readnessProbe:  如果某个Pod含多个Container, 且每个都有readnessProbe, 那是不是说只有全部Container的Probe返回success, 该Pod才会是 readness呢? ","like_count":6,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431099,"discussion_content":"很简单。restart policy 要尊重 liveness probe","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543732897,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27604,"user_name":"huan","can_delete":false,"product_type":"c1","uid":1012286,"ip_address":"","ucode":"46CB95F6E4E5FF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/72/3e/534db55d.jpg","comment_is_top":false,"comment_ctime":1537924082,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27307727858","product_id":100015201,"comment_content":"目前项目使用了forever之类的wrapper进程来管理工作进程，forever是根据工作进程的状态做重启操作（也可以使用forever的api接口做health检查）。另外，日志都是使用append的形式，而不是覆盖，这样可以不用掩盖错误的发生。","like_count":6},{"had_liked":false,"id":27685,"user_name":"微思","can_delete":false,"product_type":"c1","uid":1004349,"ip_address":"","ucode":"853C48AA183A7B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/53/3d/1189e48a.jpg","comment_is_top":false,"comment_ctime":1537929232,"is_pvip":true,"replies":[{"id":"9978","content":"对","user_name":"作者回复","comment_id":27685,"uid":"1218095","ip_address":"","utype":1,"ctime":1537937873,"user_name_real":"Geek_6ef93d"}],"discussion_count":1,"race_medal":4,"score":"23012765712","product_id":100015201,"comment_content":"在讲述livenessProbe的时候说到：虽然是 Restart（重启），但实际却是重新创建了容器；那之前那个还在运行的liveness容器被自动销毁了吗？<br>","like_count":5,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425004,"discussion_content":"对","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537937873,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":289245,"user_name":"Frank_Geek","can_delete":false,"product_type":"c1","uid":2542221,"ip_address":"","ucode":"7ACF68D4B6E014","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJNITTq63LcicPbBYC1iceRo9Op0aR7jLnnYGUF4fqRscNIMIuHHbnVNSWElsP5erlP57QbUe1mY8Dw/132","comment_is_top":false,"comment_ctime":1618931677,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18798800861","product_id":100015201,"comment_content":"PodPreset API 从k8s v1.20后被remove了： The v1alpha1 PodPreset API and admission plugin has been removed with no built-in replacement. Admission webhooks can be used to modify pods on creation.","like_count":4},{"had_liked":false,"id":243851,"user_name":"ch_ort","can_delete":false,"product_type":"c1","uid":1580926,"ip_address":"","ucode":"B79746E687F29E","user_header":"","comment_is_top":false,"comment_ctime":1598312088,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"18778181272","product_id":100015201,"comment_content":"Kuberentes可以理解为操作系统，那么容器就是进程，而Pod就是进程组or虚拟机（几个进程关联在一起）。<br><br>Pod的设计之初有两个目的：<br>（1）为了处理容器之间的调度关系<br>（2） 实现容器设计模式： Pod会先启动Infra容器设置网络、Volume等namespace（如果Volume要共享的话），其他容器通过加入的方式共享这些Namespace。<br><br>如果对Pod中的容器启动有顺序要求，可以使用Init Contianer。所有Init Container定义的容器，都会比spec.containers定义的用户容器按顺序优先启动。Init Container容器会按顺序逐一启动，而直到它们都启动并且退出了，用户容器才会启动。<br><br>Pod使用过程中的重要字段：<br>（1）pod自定义&#47;etc&#47;hosts:  spec.hostAliases<br>（2）pod共享PID : spec.shareProcessNamespace <br>（3）容器启动后&#47;销毁前的钩子： spec.container.lifecycle.postStart&#47;preStop<br>（4）pod的状态：spec.status.phase<br>（5）pod特殊的volume（投射数据卷）:<br>   5.1) 密码信息获取：创建Secrete对象保存加密数据，存放到Etcd中。然后，你就可以通过在Pod的容器里挂载Volume的方式，访问到这些Secret里保存的信息<br>  5.2）配置信息获取：创建ConfigMap对象保存加密数据，存放到Etcd中。然后，通过挂载Volume的方式，访问到ConfigMap里保存的内容<br>  5.3）容器获取Pod中定义的静态信息：通过挂载DownwardAPI 这个特殊的Volume，访问到Pod中定义的静态信息<br>  5.4) Pod中要访问K8S的API：任何运行在Kubernetes集群上的应用，都必须使用这个ServiceAccountToken里保存的授权信息，也就是Token，才可以合法地访问API Server。因此，通过挂载Volume的方式，把对应权限的ServiceAccountToken这个特殊的Secrete挂载到Pod中即可<br>  （6）容器是否健康： spec.container.livenessProbe。若不健康，则Pod有可能被重启（可配置策略）<br>  （7）容器是否可用： spec.container.readinessProbe。若不健康，则service不会访问到该Pod<br>","like_count":4,"discussions":[{"author":{"id":1426212,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEL5tqchv61Dk7EwNaDicoUCNaEgQJych0IZ9e0hGPXgZPqJXOmSJJaLvXxSoAf2ibKNe7sgs6R3g5Bw/132","nickname":"田寄远","note":"","ucode":"9C921737C7B54F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":321379,"discussion_content":"总结的非常棒","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604573318,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":32838,"user_name":"Vincent","can_delete":false,"product_type":"c1","uid":1223046,"ip_address":"","ucode":"61CFE863E8E6D1","user_header":"https://static001.geekbang.org/account/avatar/00/12/a9/86/8211935c.jpg","comment_is_top":false,"comment_ctime":1539701303,"is_pvip":false,"discussion_count":8,"race_medal":0,"score":"18719570487","product_id":100015201,"comment_content":"按照老师的操作执行这个命令报错了<br>[root@node1 k8s]# kubectl create -f preset.yaml <br>error: unable to recognize &quot;preset.yaml&quot;: no matches for kind &quot;PodPreset&quot; in version &quot;settings.k8s.io&#47;v1alpha1&quot;<br><br><br>求解","like_count":4,"discussions":[{"author":{"id":1325816,"avatar":"https://static001.geekbang.org/account/avatar/00/14/3a/f8/c1a939e7.jpg","nickname":"君哥聊技术","note":"","ucode":"2C9A22BCE4C79E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288486,"discussion_content":"我的是v1.17.3版本，增加下面配置后就可以了\n\nvi /etc/kubernetes/manifests/kube-apiserver.yaml\n#增加这一行\n- --runtime-config=settings.k8s.io/v1alpha1=true\n#在下一行后面增加&#34;,PodPreset&#34;\n- --enable-admission-plugins=NodeRestriction","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1593759149,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1082097,"avatar":"https://static001.geekbang.org/account/avatar/00/10/82/f1/c2cfbd2e.jpg","nickname":"积红","note":"","ucode":"A8ED0D66E7E723","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":672,"discussion_content":"需要启用PodPreset, 1. 修改/etc/kubernetes/manifests/kube-apiserver.yaml文件，添加--enable-admission-plugins=NodeRestriction,PodPreset 和--runtime-config=settings.k8s.io/v1alpha1=true ， 2. 重启kubelet:  systemctl restart kubelet","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1561952148,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1644983,"avatar":"","nickname":"weiwei.mo","note":"","ucode":"DA130336171AE8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1082097,"avatar":"https://static001.geekbang.org/account/avatar/00/10/82/f1/c2cfbd2e.jpg","nickname":"积红","note":"","ucode":"A8ED0D66E7E723","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":9545,"discussion_content":"搞完，kubelet挂了 坑啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568185549,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":672,"ip_address":""},"score":9545,"extra":""},{"author":{"id":1227336,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ba/48/c892a35b.jpg","nickname":"csoulsi","note":"","ucode":"96C9BBE9097FB3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1082097,"avatar":"https://static001.geekbang.org/account/avatar/00/10/82/f1/c2cfbd2e.jpg","nickname":"积红","note":"","ucode":"A8ED0D66E7E723","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":77039,"discussion_content":"我是实用kubeadm安装的，按照这个改后还不行，你是做过了对吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575882459,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":672,"ip_address":""},"score":77039,"extra":""},{"author":{"id":2441261,"avatar":"https://static001.geekbang.org/account/avatar/00/25/40/2d/9a766753.jpg","nickname":"郭贻铖","note":"","ucode":"B14B1DB14031F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1644983,"avatar":"","nickname":"weiwei.mo","note":"","ucode":"DA130336171AE8","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350776,"discussion_content":"我也是哈哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614003605,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":9545,"ip_address":""},"score":350776,"extra":""}]},{"author":{"id":1740780,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/8f/ec/7333c129.jpg","nickname":"付文达","note":"","ucode":"FBC2B62CB4DFB4","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554439,"discussion_content":"挂了直接\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646380666,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1298252,"avatar":"","nickname":"Geek_b52974","note":"","ucode":"59884399646620","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295935,"discussion_content":"我试没问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596383961,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27824,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1537949681,"is_pvip":false,"replies":[{"id":"10036","content":"请仔细看，我在文稿列出来的exec的输出，是第二种方法、也就是写YAML文件方法创建的Secret。而你列出来的是第一种方法创建的Secret。他俩本来就是不一样的。","user_name":"作者回复","comment_id":27824,"uid":"1218095","ip_address":"","utype":1,"ctime":1537953645,"user_name_real":"Geek_6ef93d"}],"discussion_count":2,"race_medal":0,"score":"18717818865","product_id":100015201,"comment_content":"文章中的代码 dapi-volume.yaml 格式不对,被取消了缩进,导致直接贴出来使用会报错.<br>还有按文章中的命令 kubectl create secret generic user --from-file=.&#47;username.txt ,在pod中[ kubectl exec -it test-projected-volume -- &#47;bin&#47;sh]展示的目录不是user,而是username.txt. 可以通过[kubectl edit secrets user]手动修改data:下的字段名.","like_count":4,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425043,"discussion_content":"请仔细看，我在文稿列出来的exec的输出，是第二种方法、也就是写YAML文件方法创建的Secret。而你列出来的是第一种方法创建的Secret。他俩本来就是不一样的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537953645,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1022886,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/9b/a6/1f485c48.jpg","nickname":"高远","note":"","ucode":"BC84D5A3EA37A6","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":315519,"discussion_content":"老师还是有笔误的。因为如果要用到第二种方法产生的secret的话，应该提示一下学生test-projected-volume.yaml文件的最后secret部分是需要更新一下的。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1603284553,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27525,"user_name":"假装乐","can_delete":false,"product_type":"c1","uid":1093437,"ip_address":"","ucode":"97A7D0A6D93865","user_header":"https://static001.geekbang.org/account/avatar/00/10/af/3d/28b61e6b.jpg","comment_is_top":false,"comment_ctime":1537918940,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18717788124","product_id":100015201,"comment_content":"讲的详细量又大哈","like_count":4},{"had_liked":false,"id":289244,"user_name":"Frank_Geek","can_delete":false,"product_type":"c1","uid":2542221,"ip_address":"","ucode":"7ACF68D4B6E014","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJNITTq63LcicPbBYC1iceRo9Op0aR7jLnnYGUF4fqRscNIMIuHHbnVNSWElsP5erlP57QbUe1mY8Dw/132","comment_is_top":false,"comment_ctime":1618931594,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14503833482","product_id":100015201,"comment_content":"PodPreset API从k8s v.20以后被remove了：","like_count":3},{"had_liked":false,"id":35288,"user_name":"Yao1931","can_delete":false,"product_type":"c1","uid":1219014,"ip_address":"","ucode":"FDF907E94C5574","user_header":"https://static001.geekbang.org/account/avatar/00/12/99/c6/fcb91141.jpg","comment_is_top":false,"comment_ctime":1540511667,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14425413555","product_id":100015201,"comment_content":"Deployment是控制器，有副本数要求，如果恢复策略不仅是always就与它的设计违背了。是这样吗？","like_count":3},{"had_liked":false,"id":27632,"user_name":"风行传说","can_delete":false,"product_type":"c1","uid":1228222,"ip_address":"","ucode":"3CFD8AB4975764","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTILhHQ6S5c2QEGNoiaL5LicibKah5wOZIh8iaWloM5XfDeW4aJwLicWlqceUVFEBicMzpqyFWDFEmVeibhFg/132","comment_is_top":false,"comment_ctime":1537925753,"is_pvip":false,"replies":[{"id":"9983","content":"很简单啦。projected volume 是新api，四个定义在一起。后者是老api，分开的。以后尽量用新api。","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1537938023,"ip_address":"","comment_id":27632,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14422827641","product_id":100015201,"comment_content":"老师，我想问一下，您文章里面讲到的pod.spec.volumes.projected.sources下的这四种对象中的configMap secret 和pod.spec.volumes下的configMap secret是否有区别，如果没有区别那为何相同的功能对象要设置在两个不同的对象下面呢？这点让我不是特别理解，希望您能给予一下解答，谢谢！","like_count":3,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424977,"discussion_content":"很简单啦。projected volume 是新api，四个定义在一起。后者是老api，分开的。以后尽量用新api。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537938023,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27617,"user_name":"abc","can_delete":false,"product_type":"c1","uid":1198332,"ip_address":"","ucode":"A4E989E85848D9","user_header":"https://static001.geekbang.org/account/avatar/00/12/48/fc/f46062b6.jpg","comment_is_top":false,"comment_ctime":1537924923,"is_pvip":false,"replies":[{"id":"9994","content":"projected是新api，把四种volume统一管理了","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1537938272,"ip_address":"","comment_id":27617,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14422826811","product_id":100015201,"comment_content":"更重要的是，像这样通过挂载方式进入到容器里的 Secret，一旦其对应的 Etcd 里的数据被更新，这些 Volume 里的文件内容，同样也会被更新。<br>———————<br>想问一下，secret是可以直接挂载使用的，加个projects volumes的方式有啥好处？是自动更新吗","like_count":3,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424966,"discussion_content":"projected是新api，把四种volume统一管理了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537938272,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":412798,"discussion_content":"Mark.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636292728,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27593,"user_name":"fhchina","can_delete":false,"product_type":"c1","uid":1057157,"ip_address":"","ucode":"CF9329FD16F6CE","user_header":"https://static001.geekbang.org/account/avatar/00/10/21/85/609a2e51.jpg","comment_is_top":false,"comment_ctime":1537922959,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14422824847","product_id":100015201,"comment_content":"是projected volume 1.11以后，不是persistent volume","like_count":3},{"had_liked":false,"id":90505,"user_name":"Destiny","can_delete":false,"product_type":"c1","uid":1320422,"ip_address":"","ucode":"0CB250BB32C822","user_header":"https://static001.geekbang.org/account/avatar/00/14/25/e6/67104dff.jpg","comment_is_top":false,"comment_ctime":1556539840,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10146474432","product_id":100015201,"comment_content":"和openshift哪个较好","like_count":2,"discussions":[{"author":{"id":1340672,"avatar":"https://static001.geekbang.org/account/avatar/00/14/75/00/836d9421.jpg","nickname":"Toby","note":"","ucode":"B90446C0F04E50","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":208622,"discussion_content":"两个东西应该说不一样的吧 openshift是在k8s的基础上加了一层wrapper","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584564157,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":28251,"user_name":"周娄子","can_delete":false,"product_type":"c1","uid":1228039,"ip_address":"","ucode":"18A1E6926C095A","user_header":"https://static001.geekbang.org/account/avatar/00/12/bd/07/bf8c31fb.jpg","comment_is_top":false,"comment_ctime":1538033423,"is_pvip":false,"replies":[{"id":"10183","content":"这是一个场景化的功能，要有批量操作的需求","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1538052388,"ip_address":"","comment_id":28251,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10127968015","product_id":100015201,"comment_content":"podpreset我觉得不要什么情况都用，还是坚持所见即所得。","like_count":2,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425197,"discussion_content":"这是一个场景化的功能，要有批量操作的需求","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538052388,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27653,"user_name":"小小笑儿","can_delete":false,"product_type":"c1","uid":1040354,"ip_address":"","ucode":"CA63CC50DC2091","user_header":"https://static001.geekbang.org/account/avatar/00/0f/df/e2/823a04b4.jpg","comment_is_top":false,"comment_ctime":1537927052,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10127861644","product_id":100015201,"comment_content":"一般都是http进行健康检查，k8s提供了http,tcp和exec的方式，对我们来说是够用了","like_count":2},{"had_liked":false,"id":27503,"user_name":"Tim Zhang","can_delete":false,"product_type":"c1","uid":1214499,"ip_address":"","ucode":"4956AC5FE45EE1","user_header":"https://static001.geekbang.org/account/avatar/00/12/88/23/a0966b4d.jpg","comment_is_top":false,"comment_ctime":1537912516,"is_pvip":false,"replies":[{"id":"9995","content":"再仔细看看……","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1537938294,"ip_address":"","comment_id":27503,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10127847108","product_id":100015201,"comment_content":"pv是1.11以后？","like_count":2,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424928,"discussion_content":"再仔细看看……","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537938294,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":304417,"user_name":"boss_pi","can_delete":false,"product_type":"c1","uid":1713744,"ip_address":"","ucode":"5EED6D9BA7F061","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/htzC3ImxibzOia06PkhxmHib8aXnFXqOSjbHiaveNkh26EtFDFxlAoXzyBdibDtGIIlmZhqumnAAaSGYGTPopY0kZicw/132","comment_is_top":false,"comment_ctime":1627395038,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5922362334","product_id":100015201,"comment_content":"这是我学过最长的一节专栏，干货很多","like_count":1},{"had_liked":false,"id":283090,"user_name":"types","can_delete":false,"product_type":"c1","uid":2449777,"ip_address":"","ucode":"8B50927EF1804F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLDUJyeq54fiaXAgF62tNeocO3lHsKT4mygEcNoZLnibg6ONKicMgCgUHSfgW8hrMUXlwpNSzR8MHZwg/132","comment_is_top":false,"comment_ctime":1615543503,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5910510799","product_id":100015201,"comment_content":"为什么要引入Deployment和ServiceAcoount？ 直接使用Replicaent和ServiceAcoount？ 直接使用Replicaset和Secret有什么缺陷？？","like_count":1,"discussions":[{"author":{"id":2378009,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKicUgL8bc6EDj2w7GG8UjxRFYicmXlAdUHaSRdAT798ibpfOgF9OWFku5jad5ezWFGkCWXnoqFgSWlw/132","nickname":"iamcaptain","note":"","ucode":"868D95D47E033E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374913,"discussion_content":"Deployment是Replicaset的升级版，能够用Deployment的情况下尽量用它，因为它支持滚动更新，Replicaset不支持，而且也推荐使用Deployment。 它们俩的最大区别就是是否支持滚动更新！","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1621410273,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":265547,"user_name":"Glowry","can_delete":false,"product_type":"c1","uid":1415527,"ip_address":"","ucode":"36046C0639A404","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/U1A1E7HXDTpbLjhickDHHuaRlRo6wFoRtSwl0zCSROJyTN2pVm5Bpia1cPPX5hZOzMf5zqJVXDGN2Q0FTH5c9vOQ/132","comment_is_top":false,"comment_ctime":1606926195,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5901893491","product_id":100015201,"comment_content":"<br>apiVersion: v1<br>kind: Secret<br>metadata:<br>  name: mysecret<br>type: Opaque<br>data:<br>  user: YWRtaW4=<br>  pass: MWYyZDFlMmU2N2Rm<br><br>使用这个配置文件创建secret: kubectl create -f ***<br><br>deployment配置需要调整为：<br><br>apiVersion: v1<br>kind: Pod<br>metadata:<br>  name: test-projected-volume <br>spec:<br>  containers:<br>  - name: test-secret-volume<br>    image: busybox<br>    args:<br>    - sleep<br>    - &quot;86400&quot;<br>    volumeMounts:<br>    - name: mysql-cred<br>      mountPath: &quot;&#47;projected-volume&quot;<br>      readOnly: true<br>  volumes:<br>  - name: mysql-cred<br>    projected:<br>      sources:<br>      - secret:<br>          name: mysecret<br><br>直接用user, pass会报找不到数据的异常，pod无法启动","like_count":1,"discussions":[{"author":{"id":1970516,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLK4NPyaFDl4rzrd4A9z42tQDibFLdCicbrAdyUa5P2B5u8UCUBenpHX7VgUCibvHvhpza4icMBKVnhmA/132","nickname":"学无止境","note":"","ucode":"2C28E8E54DAB4E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389246,"discussion_content":"厉害，解决了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1629190695,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2352309,"avatar":"https://static001.geekbang.org/account/avatar/00/23/e4/b5/8908e68e.jpg","nickname":"Tannin","note":"","ucode":"486B0924DD3DED","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332131,"discussion_content":"我也是一样的问题，求解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607071526,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":41956,"user_name":"Geek_6bab38","can_delete":false,"product_type":"c1","uid":1261301,"ip_address":"","ucode":"118ED65D80A6B5","user_header":"https://static001.geekbang.org/account/avatar/00/13/3e/f5/ba756775.jpg","comment_is_top":false,"comment_ctime":1542880698,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5837847994","product_id":100015201,"comment_content":"我创建了 podPreset  包含 redis  6379等 关联了role frontend<br>但是  我创建了Pod website <br>用kubectl get pod website -o yaml 查看，没有看到有文章中的<br>      env:<br>        - name: DB_PORT<br>          value: &quot;6379&quot;<br>信息，是我哪里操作不对？还是哪里有问题呢？期待老师的回复，感谢","like_count":1},{"had_liked":false,"id":34754,"user_name":"Racoon","can_delete":false,"product_type":"c1","uid":1040047,"ip_address":"","ucode":"20D9DBDDEB3B1E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/de/af/9379c7bd.jpg","comment_is_top":false,"comment_ctime":1540283804,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5835251100","product_id":100015201,"comment_content":"geektime&#47;sample:v2和geektime&#47;tomcat:7.0  麻烦给一下这两个镜像的公有地址。<br>","like_count":1},{"had_liked":false,"id":32760,"user_name":"星尘_StarDust","can_delete":false,"product_type":"c1","uid":1226876,"ip_address":"","ucode":"78A2B0B0745429","user_header":"https://static001.geekbang.org/account/avatar/00/12/b8/7c/dc6c1242.jpg","comment_is_top":false,"comment_ctime":1539690480,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5834657776","product_id":100015201,"comment_content":"--runtime-config 是deprecated， 以后会被移除。","like_count":1},{"had_liked":false,"id":28169,"user_name":"gogo","can_delete":false,"product_type":"c1","uid":1003104,"ip_address":"","ucode":"E8F0F3B000020A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4e/60/0d5aa340.jpg","comment_is_top":false,"comment_ctime":1538014375,"is_pvip":false,"replies":[{"id":"10142","content":"存在elastic search里","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1538023574,"ip_address":"","comment_id":28169,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5832981671","product_id":100015201,"comment_content":"老师好，请问java web项目的日志输出到分布式存储里面，怎么方便查看保存好的日志呢","like_count":1,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425163,"discussion_content":"存在elastic search里","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538023574,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27600,"user_name":"vx:jiancheng_goon","can_delete":false,"product_type":"c1","uid":1218615,"ip_address":"","ucode":"FD34901B061825","user_header":"https://static001.geekbang.org/account/avatar/00/12/98/37/7f575aec.jpg","comment_is_top":false,"comment_ctime":1537923692,"is_pvip":false,"replies":[{"id":"9986","content":"这就是probe用的脚本啊","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1537938079,"ip_address":"","comment_id":27600,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5832890988","product_id":100015201,"comment_content":"老师好，我们的平台要接入很多来自于不同团队的产品。他们的健康检查方式都类似于在容器里执行一个checkhealth的脚本，根据检查脚本的返回结果来判断。是否可以无缝接入到k8s呢？","like_count":1,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424962,"discussion_content":"这就是probe用的脚本啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537938079,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":359166,"user_name":"方振","can_delete":false,"product_type":"c1","uid":2917177,"ip_address":"上海","ucode":"7468D5C81D5BE8","user_header":"https://static001.geekbang.org/account/avatar/00/2c/83/39/5a11372b.jpg","comment_is_top":false,"comment_ctime":1665300182,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1665300182","product_id":100015201,"comment_content":"PodPreset 在 v1.20 版本已经删除，高版本的小伙伴不用尝试了<br>","like_count":0},{"had_liked":false,"id":350654,"user_name":"星期一的包子","can_delete":false,"product_type":"c1","uid":2914948,"ip_address":"","ucode":"A37C5310C0EB64","user_header":"https://static001.geekbang.org/account/avatar/00/2c/7a/84/07b4c263.jpg","comment_is_top":false,"comment_ctime":1657076143,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1657076143","product_id":100015201,"comment_content":"老师你好我使用 port-forward 后卡主没有输出一般是什么原因呢","like_count":0},{"had_liked":false,"id":344906,"user_name":"ryan","can_delete":false,"product_type":"c1","uid":1999269,"ip_address":"","ucode":"187157B8A25E7A","user_header":"https://static001.geekbang.org/account/avatar/00/1e/81/a5/c928b294.jpg","comment_is_top":false,"comment_ctime":1651846980,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1651846980","product_id":100015201,"comment_content":"podpreset 貌似已经被弃用并移除了，我也觉得它用处并不大","like_count":0},{"had_liked":false,"id":340251,"user_name":"路人甲","can_delete":false,"product_type":"c1","uid":1208024,"ip_address":"","ucode":"0B5D0AE087B68C","user_header":"https://static001.geekbang.org/account/avatar/00/12/6e/d8/42e516d8.jpg","comment_is_top":false,"comment_ctime":1648697763,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1648697763","product_id":100015201,"comment_content":"PodPreset已经在1.20删除，建议就算集群还在1.19或以下都不要用了","like_count":0},{"had_liked":false,"id":338873,"user_name":"一叶","can_delete":false,"product_type":"c1","uid":2053463,"ip_address":"","ucode":"912A097A918BE7","user_header":"https://static001.geekbang.org/account/avatar/00/1f/55/57/0eedfd08.jpg","comment_is_top":false,"comment_ctime":1647767961,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1647767961","product_id":100015201,"comment_content":"ExecAction：在容器内执行指定命令。如果命令退出时返回码为 0 则认为诊断成功。<br>TCPSocketAction：对指定端口上的容器的 IP 地址进行 TCP 检查。如果端口打开，则诊断被认为是成功的。<br>HTTPGetAction：对指定的端口和路径上的容器的 IP 地址执行 HTTP Get 请求。如果响应的状态码大于等于200 且小于 400，则诊断被认为是成功的。","like_count":0},{"had_liked":false,"id":323772,"user_name":"edward","can_delete":false,"product_type":"c1","uid":1942013,"ip_address":"","ucode":"5DAE754E7EC361","user_header":"","comment_is_top":false,"comment_ctime":1638155943,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638155943","product_id":100015201,"comment_content":"想请问一下livenessProbe暴露的健康检查接口，别人的pod中的服务，可以通过暴露健康检查的该pod的podIp来调用健康检查，以此来确定该pod是否已经被重启吗，因为重启之后，podIP会变，那么podIP：8080&#47;health就访问不到了","like_count":0},{"had_liked":false,"id":315023,"user_name":"Geek_515b9e","can_delete":false,"product_type":"c1","uid":1335734,"ip_address":"","ucode":"2D041B7679A2AF","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/dlj3u0jzg1gmCSxZ6daxUhhjtjmgqIwdOyalaEXYDYyQxibOsQdTrKFPPRs2I2XCHoehNaYUPrIffia9ZnR9efqQ/132","comment_is_top":false,"comment_ctime":1633661720,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1633661720","product_id":100015201,"comment_content":"我项目的配置文件要怎么去引用secret的用户名密码呢   ","like_count":0},{"had_liked":false,"id":314784,"user_name":"陈斯佳","can_delete":false,"product_type":"c1","uid":1259323,"ip_address":"","ucode":"C236F874FC767A","user_header":"https://static001.geekbang.org/account/avatar/00/13/37/3b/495e2ce6.jpg","comment_is_top":false,"comment_ctime":1633429355,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1633429355","product_id":100015201,"comment_content":"第十五课:深入理解Pod对象（二）:使用进阶<br><br>K8s支持四种Projected Volume: secret, configmap, downward api和一个特殊的secret ServiceTccountToken。以这种方式挂在的volume会到到kubelet定期更新维护，而如果是以环境变量方式挂载则不会。<br><br>liveness和readiness是保证容器正常运行的重要手段，我们称之为probe探针。<br><br>restartPolicy有三种形式:always,onfailure和never<br><br>PodPreset可以预定Pod模板，然后向符合label的Pod注入设置好的模板内容，这样在创建Pod的时候就可以不用定义所有值了","like_count":0},{"had_liked":false,"id":314587,"user_name":"凡俗","can_delete":false,"product_type":"c1","uid":1977570,"ip_address":"","ucode":"47FBCD66BE5AD4","user_header":"https://static001.geekbang.org/account/avatar/00/1e/2c/e2/afa3867c.jpg","comment_is_top":false,"comment_ctime":1633245451,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1633245451","product_id":100015201,"comment_content":"虚机时代，主要用zabbix-agent搭配命令实现健康检查","like_count":0},{"had_liked":false,"id":310869,"user_name":"言午木杉","can_delete":false,"product_type":"c1","uid":1201009,"ip_address":"","ucode":"300BEDC1B07DF1","user_header":"https://static001.geekbang.org/account/avatar/00/12/53/71/a4e9f20e.jpg","comment_is_top":false,"comment_ctime":1630940012,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630940012","product_id":100015201,"comment_content":"其实在看 Downward API 的时候，会一直有疑问，关于 pod 资源的元数据，在容器中可以获取运行环境的一些信息，可以通过环境变量的方式，来交换比如DNS和当前容器需要传递的信息，为什么还要弄一套比较复杂的 Downward API ？<br>这里随着深入了解，其实觉得元数据确实应该和 pod 对象进行分离，因为容器在感知 pod 的环境变量的时候，一但运行之后，如果要感知同一个 pod 下得其他容器的元数据变化是非常困难的，一个容器只能传递它自身资源申请和限制的信息。<br>而 Downward API 方式用卷的定义，面对的是 pod 级别的，而不是容器级别，可以传递一个容器的资源字段到另外一个容器。这就是为什么 Downward API 需要存在的理由。","like_count":0},{"had_liked":false,"id":309559,"user_name":"窝窝头","can_delete":false,"product_type":"c1","uid":1063866,"ip_address":"","ucode":"5C2635ED6484F8","user_header":"https://static001.geekbang.org/account/avatar/00/10/3b/ba/3b30dcde.jpg","comment_is_top":false,"comment_ctime":1630231026,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1630231026","product_id":100015201,"comment_content":"没有k8s的情况下可以通过服务定时心跳上报，约定接口或文件通过定时任务去调用读取，然后解析结果，k8s的探测机制不知道是否能满足对检查接口中返回的具体指标进行分析判定","like_count":0},{"had_liked":false,"id":307686,"user_name":"Leo","can_delete":false,"product_type":"c1","uid":1313963,"ip_address":"","ucode":"E0E655D048824A","user_header":"https://static001.geekbang.org/account/avatar/00/14/0c/ab/cfbf16e4.jpg","comment_is_top":false,"comment_ctime":1629201048,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629201048","product_id":100015201,"comment_content":"极客时间这个web版有问题啊，好多内容都没显示，以为一章就一点内容","like_count":0},{"had_liked":false,"id":299060,"user_name":"limix","can_delete":false,"product_type":"c1","uid":1166614,"ip_address":"","ucode":"76401FF54AE0D8","user_header":"https://static001.geekbang.org/account/avatar/00/11/cd/16/981cc4f8.jpg","comment_is_top":false,"comment_ctime":1624444909,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624444909","product_id":100015201,"comment_content":"非常感谢作者精彩的讲解，不过我有一个地方没有弄明白。容器的状态检测和恢复策略，通过yaml来进行配置，保存到etcd当中，这我理解。但具体的容器的状态检测和容器的恢复这些管理功能是谁来控制的？恢复我理解可能是由控制器控制的，状态检测应该是定时任务，我的理解基本是猜测的","like_count":0},{"had_liked":false,"id":294558,"user_name":"专栏用户","can_delete":false,"product_type":"c1","uid":1212523,"ip_address":"","ucode":"3BC8EDBB04A40F","user_header":"https://static001.geekbang.org/account/avatar/00/12/80/6b/04457413.jpg","comment_is_top":false,"comment_ctime":1621999614,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1621999614","product_id":100015201,"comment_content":"我一直没明白readiness探针设计原则，既然是当做启动的成功的标志，为什么还有定时检查（也就是说，我检查到readiness成功后，他的使命就应该是完成了的。），定时检查就应该是liveness所做的事情了。","like_count":0,"discussions":[{"author":{"id":1105387,"avatar":"https://static001.geekbang.org/account/avatar/00/10/dd/eb/80f9d212.jpg","nickname":"lttzzlll","note":"","ucode":"FA160F7C02ABAA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390779,"discussion_content":"是的。就是这样。readiness 没有定期检查吧。https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630045515,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":285623,"user_name":"单朋荣","can_delete":false,"product_type":"c1","uid":1272662,"ip_address":"","ucode":"8AD121BEDD9675","user_header":"https://static001.geekbang.org/account/avatar/00/13/6b/56/37a4cea7.jpg","comment_is_top":false,"comment_ctime":1616924267,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616924267","product_id":100015201,"comment_content":"Project volume的能力，和istio sidecar一样，是&quot;动态准入控制&quot;功能提供的吗，还是api server的某项能力？","like_count":0},{"had_liked":false,"id":255670,"user_name":"张小益","can_delete":false,"product_type":"c1","uid":1347798,"ip_address":"","ucode":"702BC860386C61","user_header":"https://static001.geekbang.org/account/avatar/00/14/90/d6/f806b648.jpg","comment_is_top":false,"comment_ctime":1603410515,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603410515","product_id":100015201,"comment_content":"没有startupProbe","like_count":0},{"had_liked":false,"id":253256,"user_name":"Action","can_delete":false,"product_type":"c1","uid":1239234,"ip_address":"","ucode":"FFFD1537C6BB3C","user_header":"https://static001.geekbang.org/account/avatar/00/12/e8/c2/77a413a7.jpg","comment_is_top":false,"comment_ctime":1602664137,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602664137","product_id":100015201,"comment_content":"老师我设置readinessProbe健康检查：<br>...<br>          - containerPort: 8050<br>          readinessProbe:<br>            httpGet:<br>              scheme: HTTP <br>              path: &#47;<br>              port: 8050<br>            initialDelaySeconds: 10<br>            periodSeconds: 3<br>.....<br>程序运行一段时间报错了，这个问题怎么解决呢？<br> Readiness probe failed: Get http:&#47;&#47;172.17.53.5:8050&#47;: net&#47;http: request canceled (Client.Timeout exceeded while awaiting headers)","like_count":0},{"had_liked":false,"id":248182,"user_name":"郭小菜","can_delete":false,"product_type":"c1","uid":1017297,"ip_address":"","ucode":"C4044C80BB331B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKYfcUOVhf3vhEBUNGHgtIcw8ujMZnkabicLzzjn3xwdeeic2PJSe7ibJgMx2UjF0d7L4B4gsRpaqe2A/132","comment_is_top":false,"comment_ctime":1600053414,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1600053414","product_id":100015201,"comment_content":"看了文章，稍微总结了下：<br>1. 一般配置信息文件会以什么形式加入到 pod 中，各自都有什么区别？<br>2. 创建 Secret 都有哪些方式？<br>3. Downward API 都能够获取哪些信息，是否能够获取容器进程的 PID？<br>4. 要如何限制 Pod 内 container 操作 k8s API？<br>   1. Service Account 是一个 特殊的 Secret<br>5. 简述 livenessProbe 和 readinessProbe 的作用和区别？<br>6. 一个 Pod 内的 container 如果发生异常会导致什么情况？<br>   1. 一个普通的 Pod 发生异常，会不会被 k8s 调度到其他节点，如果不行需要通过什么方式实现？","like_count":0},{"had_liked":false,"id":247498,"user_name":"杨","can_delete":false,"product_type":"c1","uid":1971269,"ip_address":"","ucode":"7EFEFE285975C6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/oltLEqTrmHm2aJP99BK6tHu5h7hp4aj08wR5Wt6H31iadFduDAVvjYKmhQ2nvGbLV3lkVdiat2GRasgWXoJeTibUg/132","comment_is_top":false,"comment_ctime":1599726772,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599726772","product_id":100015201,"comment_content":"结合老师这个课程去看kuboard里需要填写的内容  以及创建容器后的yaml现在知道里面绝大部分东西了<br>（自己搭建的1master2worker）","like_count":0},{"had_liked":false,"id":246764,"user_name":"Heaven","can_delete":false,"product_type":"c1","uid":1694207,"ip_address":"","ucode":"FA33FBCC66C911","user_header":"https://static001.geekbang.org/account/avatar/00/19/d9/ff/b23018a6.jpg","comment_is_top":false,"comment_ctime":1599471822,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599471822","product_id":100015201,"comment_content":"之前利用shell脚本来进行过探测,也是利用的健康监测接口,一旦返回值不是200,直接杀死进程,然后java -jar命令尝试重启<br>","like_count":0},{"had_liked":false,"id":242859,"user_name":"aoe","can_delete":false,"product_type":"c1","uid":1121758,"ip_address":"","ucode":"1C6201EDB4E954","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","comment_is_top":false,"comment_ctime":1597856460,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597856460","product_id":100015201,"comment_content":"有了这个功能K8S岂不是无敌了？只要宿主机不倒，Pod中的应用就能不倒！<br><br>在 Kubernetes 中，你可以为 Pod 里的容器定义一个健康检查“探针”（Probe）。这样，kubelet 就会根据这个 Probe 的返回值决定这个容器的状态，而不是直接以容器进行是否运行（来自 Docker 返回的信息）作为依据。这种机制，是生产环境中保证应用健康存活的重要手段。<br><br>Kubernetes 里的 Pod 恢复机制，也叫 restartPolicy。它是 Pod 的 Spec 部分的一个标准字段（pod.spec.restartPolicy），默认值是 Always，即：任何时候这个容器发生了异常，它一定会被重新创建。","like_count":0},{"had_liked":false,"id":241649,"user_name":"Geek_e0ee48","can_delete":false,"product_type":"c1","uid":1904256,"ip_address":"","ucode":"11D10A0F5892AB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIgDicRj9LAvWSejVc6v34R6dR1yRHzqBgEpABeRwDvNcpoFW6zmiavwV5cP1fCKJiaQPiafP9E7Puqnw/132","comment_is_top":false,"comment_ctime":1597378817,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597378817","product_id":100015201,"comment_content":"这个专栏的文章读起来有种久旱逢甘霖的感觉。毫不夸张的说，让人茅塞顿开，欲罢不能，浑身舒畅。非常感觉作者细致入微的讲解。","like_count":0},{"had_liked":false,"id":235151,"user_name":"ashen-one","can_delete":false,"product_type":"c1","uid":1123304,"ip_address":"","ucode":"F80F924DB220A1","user_header":"https://static001.geekbang.org/account/avatar/00/11/23/e8/abd99392.jpg","comment_is_top":false,"comment_ctime":1594908958,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594908958","product_id":100015201,"comment_content":"最后一段PodPreset里volumes和volumeMount不是同一层级的，volumeMount上有Containter，为什么PodPreset会把它们放在同一级","like_count":0},{"had_liked":false,"id":227766,"user_name":"LH","can_delete":false,"product_type":"c1","uid":1211178,"ip_address":"","ucode":"819B9B2409E834","user_header":"https://static001.geekbang.org/account/avatar/00/12/7b/2a/7d8b5943.jpg","comment_is_top":false,"comment_ctime":1592472889,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592472889","product_id":100015201,"comment_content":"看一遍 实践一段时间再看一遍 效果会很好","like_count":0},{"had_liked":false,"id":226747,"user_name":"晞月520","can_delete":false,"product_type":"c1","uid":1845394,"ip_address":"","ucode":"4F05E02A5C1608","user_header":"https://static001.geekbang.org/account/avatar/00/1c/28/92/436735f5.jpg","comment_is_top":false,"comment_ctime":1592194021,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592194021","product_id":100015201,"comment_content":"kubectl explain PodPreset<br>the server doesn&#39;t have a resource type &quot;PodPreset&quot;     这个是哪个版本的啊  1.15 后的没有这个了","like_count":0},{"had_liked":false,"id":224993,"user_name":"许臻","can_delete":false,"product_type":"c1","uid":2019255,"ip_address":"","ucode":"DEF743E0C7F1B0","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELuwZMDPDYbicYPBhib1fcNsMayPpXy5LfMzapALpyPyEFicLw1Ppf1sqlpiapIkPRVmVjRJwtfTjQuLg/132","comment_is_top":false,"comment_ctime":1591611189,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591611189","product_id":100015201,"comment_content":"老师 我用 kube-api的ymal 文件 apply - f 新建了一个 apiserver 的pod 为啥老的一直删不掉 会自己重建。我是minikube环境 也没有deployment 呀","like_count":0},{"had_liked":false,"id":219463,"user_name":"邋遢熊","can_delete":false,"product_type":"c1","uid":1000257,"ip_address":"","ucode":"9B4732F85904D5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/43/41/f7aa80e9.jpg","comment_is_top":false,"comment_ctime":1590028200,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590028200","product_id":100015201,"comment_content":"role: frontend这个在podpreset里是标签筛选器，也会在pod创建的时候添加到pod里么？","like_count":0},{"had_liked":false,"id":217930,"user_name":"慕容","can_delete":false,"product_type":"c1","uid":1086319,"ip_address":"","ucode":"BEE694935853E1","user_header":"https://static001.geekbang.org/account/avatar/00/10/93/6f/5ab3da19.jpg","comment_is_top":false,"comment_ctime":1589669259,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1589669259","product_id":100015201,"comment_content":"“这也就意味着，如果这个宿主机宕机了，这个 Pod 也不会主动迁移到其他节点上去。&quot;<br><br>老师，我没太理解这句话，如果宿主机宕机都不能触发Pod的迁移，那么它的副本数和可用性（假设就设置一个副本）如何保证呢？<br>","like_count":0,"discussions":[{"author":{"id":1994572,"avatar":"","nickname":"Geek_2b4a91","note":"","ucode":"242A32ED80C420","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":270654,"discussion_content":"所以生产环境要用deployment控制器来创建pod呀","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1590032799,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1086319,"avatar":"https://static001.geekbang.org/account/avatar/00/10/93/6f/5ab3da19.jpg","nickname":"慕容","note":"","ucode":"BEE694935853E1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1994572,"avatar":"","nickname":"Geek_2b4a91","note":"","ucode":"242A32ED80C420","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":279721,"discussion_content":"谢谢，后来看第二遍明白了。起初把这里的pod搞混成控制器了，囧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591404954,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":270654,"ip_address":""},"score":279721,"extra":""}]}]},{"had_liked":false,"id":211157,"user_name":"~尘曦~","can_delete":false,"product_type":"c1","uid":1175695,"ip_address":"","ucode":"BFA7E7DBD9047B","user_header":"https://static001.geekbang.org/account/avatar/00/11/f0/8f/ca9fded0.jpg","comment_is_top":false,"comment_ctime":1587906574,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587906574","product_id":100015201,"comment_content":"问一下在1.16版本后pod里添加的临时容器生命周期怎么管理？","like_count":0},{"had_liked":false,"id":210639,"user_name":"uni","can_delete":false,"product_type":"c1","uid":1643252,"ip_address":"","ucode":"38DFFAC10A7991","user_header":"https://static001.geekbang.org/account/avatar/00/19/12/f4/d1ed8885.jpg","comment_is_top":false,"comment_ctime":1587801184,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587801184","product_id":100015201,"comment_content":"如果pod中有多个容器，prepod 如何只给其中一个容器添加挂载点呢","like_count":0},{"had_liked":false,"id":205365,"user_name":"Andy","can_delete":false,"product_type":"c1","uid":1119133,"ip_address":"","ucode":"4BCA899B8E4E85","user_header":"https://static001.geekbang.org/account/avatar/00/11/13/9d/0ff43179.jpg","comment_is_top":false,"comment_ctime":1586598943,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586598943","product_id":100015201,"comment_content":"看两遍才理解的多一些。好教程，打卡。","like_count":0},{"had_liked":false,"id":202174,"user_name":"白巧克力","can_delete":false,"product_type":"c1","uid":1712018,"ip_address":"","ucode":"91628875D8C0F8","user_header":"https://static001.geekbang.org/account/avatar/00/1a/1f/92/4d56ff21.jpg","comment_is_top":false,"comment_ctime":1585917108,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585917108","product_id":100015201,"comment_content":"老师好 我在测试downwardapi的时候 发现提到的 status.hostIP 通过环境变量的方式获得没有问题 但是一旦写在 volumes部分 k8s 1.15就不认识它。这个是有什么限制么","like_count":0},{"had_liked":false,"id":189941,"user_name":"tk103331","can_delete":false,"product_type":"c1","uid":1060819,"ip_address":"","ucode":"221F935D7AF3BB","user_header":"https://static001.geekbang.org/account/avatar/00/10/2f/d3/d97c5993.jpg","comment_is_top":false,"comment_ctime":1584584412,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584584412","product_id":100015201,"comment_content":"当然，考虑到自动挂载默认 ServiceAccountToken 的潜在风险，Kubernetes 允许你设置默认不为 Pod 里的容器自动挂载这个 Volume。<br><br>这个在哪里改","like_count":0},{"had_liked":false,"id":189776,"user_name":"zackery","can_delete":false,"product_type":"c1","uid":1052282,"ip_address":"","ucode":"92D737D6773855","user_header":"https://static001.geekbang.org/account/avatar/00/10/0e/7a/ab527628.jpg","comment_is_top":false,"comment_ctime":1584547990,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584547990","product_id":100015201,"comment_content":"请问老师，Projected Volume 在容器层面是如何实现的呢？","like_count":0},{"had_liked":false,"id":171578,"user_name":"信了","can_delete":false,"product_type":"c1","uid":1368648,"ip_address":"","ucode":"EA188A1DD1D390","user_header":"https://static001.geekbang.org/account/avatar/00/14/e2/48/6c066714.jpg","comment_is_top":false,"comment_ctime":1578968062,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578968062","product_id":100015201,"comment_content":"老师，为什么kubernet 的YAML 文件的参数有的加了-，有的就没加，有什么讲究吗","like_count":0},{"had_liked":false,"id":136154,"user_name":"天若有情天亦老","can_delete":false,"product_type":"c1","uid":1172029,"ip_address":"","ucode":"57F0B7D524C0CF","user_header":"https://static001.geekbang.org/account/avatar/00/11/e2/3d/9a52946b.jpg","comment_is_top":false,"comment_ctime":1569374461,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569374461","product_id":100015201,"comment_content":"healthcheck接口","like_count":0},{"had_liked":false,"id":120546,"user_name":"溺水的鱼","can_delete":false,"product_type":"c1","uid":1019872,"ip_address":"","ucode":"B3FF29649B387C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8f/e0/54391c08.jpg","comment_is_top":false,"comment_ctime":1564926796,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564926796","product_id":100015201,"comment_content":"readiness failed不会引发pod重建吧？","like_count":0},{"had_liked":false,"id":119436,"user_name":"asdf100","can_delete":false,"product_type":"c1","uid":1043738,"ip_address":"","ucode":"39D8D71453E575","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ed/1a/ce7f7d54.jpg","comment_is_top":false,"comment_ctime":1564587163,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564587163","product_id":100015201,"comment_content":"deployment对象和Pod对象都可以创建pod，两者区别除了文中讲到的pod份数和调度外，还有哪些区别？实际生产中两者的场景划分是怎么定的？","like_count":0},{"had_liked":false,"id":112520,"user_name":"无情剃刀","can_delete":false,"product_type":"c1","uid":1436126,"ip_address":"","ucode":"7CA85164B797B4","user_header":"https://static001.geekbang.org/account/avatar/00/15/e9/de/0d632855.jpg","comment_is_top":false,"comment_ctime":1562750752,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562750752","product_id":100015201,"comment_content":"老师 kubectl create -f test-liveness-exec.yaml 没有重启是怎么回事<br>Events:<br>  Type     Reason     Age                            From                Message<br>  ----     ------     ----                           ----                -------<br>  Normal   Scheduled  12m                            default-scheduler   Successfully assigned default&#47;test-liveness-exec to k8s-node1<br>  Normal   Pulled     &lt;invalid&gt;                      kubelet, k8s-node1  Successfully pulled image &quot;busybox&quot;<br>  Normal   Created    &lt;invalid&gt;                      kubelet, k8s-node1  Created container liveness<br>  Normal   Started    &lt;invalid&gt;                      kubelet, k8s-node1  Started container liveness<br>  Warning  Unhealthy  &lt;invalid&gt; (x3 over &lt;invalid&gt;)  kubelet, k8s-node1  Liveness probe failed: cat: can&#39;t open &#39;&#47;tmp&#47;healthy&#39;: No such file or directory<br>  Normal   Killing    &lt;invalid&gt;                      kubelet, k8s-node1  Container liveness failed liveness probe, will be restarted<br>  Normal   Pulling    &lt;invalid&gt; (x2 over &lt;invalid&gt;)  kubelet, k8s-node1  Pulling image &quot;busybox&quot;<br>","like_count":0},{"had_liked":false,"id":112405,"user_name":"tangzc1","can_delete":false,"product_type":"c1","uid":1311254,"ip_address":"","ucode":"78CB596D2F33DC","user_header":"https://static001.geekbang.org/account/avatar/00/14/02/16/6fe3fe44.jpg","comment_is_top":false,"comment_ctime":1562729242,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562729242","product_id":100015201,"comment_content":"1.健康探测例子，当Container liveness failed之后pod状态是CrashLoopBackOff，查了下代表“Kubernetes 正在尽力启动这个 Pod，因为一个或多个容器已经挂了，或者正被删除”也不永远是runing。<br>2.kubectl exec [podname] -- &#47;bin&#47;sh   这个命令如果是多容器pod，究竟进入的是哪个容器的rootfs呢？","like_count":0},{"had_liked":false,"id":98038,"user_name":"二进制傻瓜","can_delete":false,"product_type":"c1","uid":1073261,"ip_address":"","ucode":"FA8E76339CF512","user_header":"https://static001.geekbang.org/account/avatar/00/10/60/6d/3c2a5143.jpg","comment_is_top":false,"comment_ctime":1558880976,"is_pvip":true,"replies":[{"id":"36304","content":"多看几遍","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1559619451,"ip_address":"","comment_id":98038,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1558880976","product_id":100015201,"comment_content":"信息量太大了。。。","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451528,"discussion_content":"多看几遍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559619451,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":95230,"user_name":"tuyu","can_delete":false,"product_type":"c1","uid":1448863,"ip_address":"","ucode":"B235325B541408","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/BIRpwViaN51yynIeFonD7QRlwDCVtKibrG956NTxzEqibOZZVjhMMgibOPmd3VicfYxpknZsic1oJq8KicZvXkmmiajuQg/132","comment_is_top":false,"comment_ctime":1557993378,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557993378","product_id":100015201,"comment_content":"老师,就是在讲liveness的时候,启动容器的args的前两个参数是 -&#47;bin&#47;sh 和 - -c。为啥不能执行touch &#47;tmp&#47;healthy。这个是什么原理呢","like_count":0},{"had_liked":false,"id":85578,"user_name":"҉","can_delete":false,"product_type":"c1","uid":1130004,"ip_address":"","ucode":"97EFF35344F754","user_header":"https://static001.geekbang.org/account/avatar/00/11/3e/14/f844ecca.jpg","comment_is_top":false,"comment_ctime":1555131146,"is_pvip":false,"replies":[{"id":"31576","content":"大量的修改，还是建议写admission hook","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1555697390,"ip_address":"","comment_id":85578,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555131146","product_id":100015201,"comment_content":"podpreset 支持的参数太少了。<br><br>nodeSelector 、affinity 这种好像都没有。。","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446720,"discussion_content":"大量的修改，还是建议写admission hook","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555697390,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":83667,"user_name":"春和景明","can_delete":false,"product_type":"c1","uid":1272482,"ip_address":"","ucode":"A27970A276ECD6","user_header":"https://static001.geekbang.org/account/avatar/00/13/6a/a2/f9efd9dc.jpg","comment_is_top":false,"comment_ctime":1554694287,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1554694287","product_id":100015201,"comment_content":"老师，我用下面的dockerfile制作出来的镜像启动pod。发现pod中的&#47;home&#47;jenkins下面没有.pip文件夹，而&#47;var中是有.pip文件夹的。<br><br>我的问题是在pod启动时，会对家目录有特别操作吗？<br><br>1 FROM jenkins&#47;jnlp-slave<br>  2<br>  3 LABEL maintainer=&quot;sqe&quot;<br>  4<br>  5 USER root<br>  6<br>  7 ENV PYTHON_VERSION 3.5<br>  8<br>  9 RUN apt-get update \\<br> 10     &amp;&amp; apt-get dist-upgrade -y \\<br> 11     &amp;&amp; apt-get -y install python${PYTHON_VERSION} \\<br> 12        libffi-dev \\<br> 13        libpq-dev \\<br> 14        libssl-dev \\<br> 15        python3-dev \\<br> 16        python3-pip \\<br> 17        python3-setuptools \\<br> 18        python3-venv \\<br> 19        python3-wheel \\<br> 20        build-essential \\<br> 21        docker \\<br> 22     &amp;&amp; rm -rf &#47;var&#47;lib&#47;apt&#47;lists&#47;* \\<br> 23     &amp;&amp; ln -nsf &#47;usr&#47;bin&#47;python${PYTHON_VERSION} &#47;usr&#47;bin&#47;python<br> 24 RUN pip3 install pipenv<br> 25<br> 26 ADD pip.conf &#47;home&#47;jenkins&#47;.pip&#47;pip.conf<br> 27 ADD pip.conf &#47;var&#47;.pip&#47;pip.conf<br> 28 RUN chown -R jenkins:jenkins &#47;home&#47;jenkins&#47;.pip&#47;<br> 29 RUN chown -R jenkins:jenkins &#47;var&#47;.pip&#47;<br> 30<br> 31 USER jenkins","like_count":0},{"had_liked":false,"id":80836,"user_name":"小猪","can_delete":false,"product_type":"c1","uid":1201662,"ip_address":"","ucode":"EAD6A4876CEF3B","user_header":"https://static001.geekbang.org/account/avatar/00/12/55/fe/ab541300.jpg","comment_is_top":false,"comment_ctime":1553740527,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553740527","product_id":100015201,"comment_content":"老师能讲解一下kubernetes的master节点的高可用部署吗？如何做到宕机一两台物理机，不影响kubernetes集群的运行？","like_count":0},{"had_liked":false,"id":77653,"user_name":"杰魁","can_delete":false,"product_type":"c1","uid":1169775,"ip_address":"","ucode":"D9E4AC416F793E","user_header":"https://static001.geekbang.org/account/avatar/00/11/d9/6f/553aeb40.jpg","comment_is_top":false,"comment_ctime":1552978677,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552978677","product_id":100015201,"comment_content":"哈哈，精彩","like_count":0},{"had_liked":false,"id":71782,"user_name":"彦","can_delete":false,"product_type":"c1","uid":1125048,"ip_address":"","ucode":"13EE4093C488A5","user_header":"https://static001.geekbang.org/account/avatar/00/11/2a/b8/edbafb82.jpg","comment_is_top":false,"comment_ctime":1551431354,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1551431354","product_id":100015201,"comment_content":"请问通过ServiceAccount授权的方式调用Kubernetes API，是不是就是调用master节点上kube-apiserver暴露的API?","like_count":0,"discussions":[{"author":{"id":2853149,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/89/1d/d1d8edcc.jpg","nickname":"梅斌","note":"","ucode":"DDE15A3FD12738","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545141,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641864446,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1311254,"avatar":"https://static001.geekbang.org/account/avatar/00/14/02/16/6fe3fe44.jpg","nickname":"tangzc1","note":"","ucode":"78CB596D2F33DC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1601,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562726290,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":59623,"user_name":"卢彦均","can_delete":false,"product_type":"c1","uid":1175402,"ip_address":"","ucode":"AD695652062B66","user_header":"https://static001.geekbang.org/account/avatar/00/11/ef/6a/fdb4e298.jpg","comment_is_top":false,"comment_ctime":1547393202,"is_pvip":false,"replies":[{"id":"22071","content":"容器的net namespace 是share的，一个pod一份","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1548054043,"ip_address":"","comment_id":59623,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547393202","product_id":100015201,"comment_content":"文中有个地方是否写错了？<br>“所以，你的 Pod 其实可以暴露一个健康检查 URL（比如 &#47;healthz）。。。”<br>应该是容器应用暴露一个url，而不是Pod吧？","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436370,"discussion_content":"容器的net namespace 是share的，一个pod一份","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548054043,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55584,"user_name":"柯察金","can_delete":false,"product_type":"c1","uid":1115149,"ip_address":"","ucode":"F722BF8FCD2C47","user_header":"https://static001.geekbang.org/account/avatar/00/11/04/0d/3dc5683a.jpg","comment_is_top":false,"comment_ctime":1546237050,"is_pvip":false,"replies":[{"id":"20145","content":"后面讲Job啊","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1546385202,"ip_address":"","comment_id":55584,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546237050","product_id":100015201,"comment_content":"能不能给一个一次性任务，执行完就退出的示例","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434805,"discussion_content":"后面讲Job啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546385202,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47061,"user_name":"丹清","can_delete":false,"product_type":"c1","uid":1178681,"ip_address":"","ucode":"9FA4CA3CBF2847","user_header":"https://static001.geekbang.org/account/avatar/00/11/fc/39/8ce41759.jpg","comment_is_top":false,"comment_ctime":1544027239,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544027239","product_id":100015201,"comment_content":"liveness probe是类似使用kubectl exec test-liveness-exec -- &#47;bin&#47;sh<br>进入容器后,执行相应的命令,cat dir ,根据返回值会判断容器是否正常运行吗<br><br>","like_count":0},{"had_liked":false,"id":40095,"user_name":"hpfish","can_delete":false,"product_type":"c1","uid":1217377,"ip_address":"","ucode":"86DB066E5B6D89","user_header":"https://static001.geekbang.org/account/avatar/00/12/93/61/3e4607c7.jpg","comment_is_top":false,"comment_ctime":1542476617,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1542476617","product_id":100015201,"comment_content":"要使用PodPreset还要先在kube-apiserver里开启<br>--admission-control=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,PodPreset<br><br>--runtime-config=rbac.authorization.k8s.io&#47;v1alpha1=true,settings.k8s.io&#47;v1alpha1=true","like_count":0,"discussions":[{"author":{"id":2019255,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELuwZMDPDYbicYPBhib1fcNsMayPpXy5LfMzapALpyPyEFicLw1Ppf1sqlpiapIkPRVmVjRJwtfTjQuLg/132","nickname":"许臻","note":"","ucode":"DEF743E0C7F1B0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":280718,"discussion_content":"如何设置","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591605153,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39614,"user_name":"诚信高效","can_delete":false,"product_type":"c1","uid":1219329,"ip_address":"","ucode":"003CD60A0D0BF7","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/01/f100d827.jpg","comment_is_top":false,"comment_ctime":1542328737,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542328737","product_id":100015201,"comment_content":"老师您好，请问单节点最多可部署多少个容器？除了和物理机资源有关，还和什么有关？","like_count":0},{"had_liked":false,"id":36771,"user_name":"小谢同学","can_delete":false,"product_type":"c1","uid":1032544,"ip_address":"","ucode":"E809E6BC470631","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c1/60/fc3689d0.jpg","comment_is_top":false,"comment_ctime":1541319407,"is_pvip":false,"replies":[{"id":"13030","content":"显然不能。后面会讲到。","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1541338446,"ip_address":"","comment_id":36771,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1541319407","product_id":100015201,"comment_content":"请问yaml文件开头的apiversion 是起什么作用的？可以随便写？","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428009,"discussion_content":"显然不能。后面会讲到。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541338446,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":35152,"user_name":"Frank","can_delete":false,"product_type":"c1","uid":1224388,"ip_address":"","ucode":"165B65317A7B3D","user_header":"https://static001.geekbang.org/account/avatar/00/12/ae/c4/806fd588.jpg","comment_is_top":false,"comment_ctime":1540438924,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1540438924","product_id":100015201,"comment_content":"老师你好，我这里还有一个问题：<br>secret和config-map如果要把文件加入到对象中，是否只能通过命令行方式以--from-file=参数来创建了？另外如何对一个已存在的secret和configmap对象追加配置或secret相关的文件进去呢？","like_count":0},{"had_liked":false,"id":35149,"user_name":"Frank","can_delete":false,"product_type":"c1","uid":1224388,"ip_address":"","ucode":"165B65317A7B3D","user_header":"https://static001.geekbang.org/account/avatar/00/12/ae/c4/806fd588.jpg","comment_is_top":false,"comment_ctime":1540437929,"is_pvip":false,"replies":[{"id":"12529","content":"没有这两个文件不正常","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1540439624,"ip_address":"","comment_id":35149,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1540437929","product_id":100015201,"comment_content":"老师您好，有两个小问题<br>1、我在实践的时候发现pod启动后，容器里挂载的只有serviceaccount的token,ca和cert文件并未有加载(集群版本是1.10，是手动一个个组件部署配置启动的，当前并未使用安全接口启动)，在这种情况下&#47;run&#47;secrets&#47;kubernetes.io&#47;serviceaccount不存在ca和cert文件是正常的吗？<br><br>2、由于#1，这使得在启动kubedns和dashboard时都只能指定master-url来连接，不然容器就会报错退出。这是因为kubedns和dashboard这些程序都是按您说的默认使用kubernetes 官方原生的client，所以默认自动启用安全连接读取&#47;run&#47;secrets&#47;kubernetes.io&#47;serviceaccount下的ca和cert文件吗？","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427463,"discussion_content":"没有这两个文件不正常","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540439624,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":33563,"user_name":"jimmy","can_delete":false,"product_type":"c1","uid":1112872,"ip_address":"","ucode":"43FC90AF9582DF","user_header":"https://static001.geekbang.org/account/avatar/00/10/fb/28/eec9220b.jpg","comment_is_top":false,"comment_ctime":1539825869,"is_pvip":false,"replies":[{"id":"12082","content":"加辅助容器啊","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1539850659,"ip_address":"","comment_id":33563,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1539825869","product_id":100015201,"comment_content":"获取 Pod 容器运行后才会出现的信息，使用sidecar，这个不太理解，在pod里增加一个辅助容器？怎么获取Pod 容器运行后才会出现的信息呢？","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426997,"discussion_content":"加辅助容器啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539850659,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":33284,"user_name":"多肉","can_delete":false,"product_type":"c1","uid":1228219,"ip_address":"","ucode":"EF0805E34339D6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJicBibF1UEOAhicickjCRXzVBDDyAMTw5C7EP3IPSKyTqWjvtmicB4AFu0B72BVyxFAVnNHrbx672p2Ow/132","comment_is_top":false,"comment_ctime":1539771229,"is_pvip":false,"replies":[{"id":"12037","content":"这没毛病啊，用文件创建就是这个效果","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1539783835,"ip_address":"","comment_id":33284,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1539771229","product_id":100015201,"comment_content":"请问个问题，为什么我的容器目录中得到得文件是 .txt文件，而不是文章中所说得user和pass呢？<br>root@test-projected-volume:&#47;# ls &#47;project-volume&#47;<br>password.txt username.txt<br>我secrets是安装根据username.txt文件创建得admin和pass secrets对象","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426961,"discussion_content":"这没毛病啊，用文件创建就是这个效果","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539783835,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1311254,"avatar":"https://static001.geekbang.org/account/avatar/00/14/02/16/6fe3fe44.jpg","nickname":"tangzc1","note":"","ucode":"78CB596D2F33DC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1606,"discussion_content":"用文件创建的就是abc.txt，用yaml创建的就是abc","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562727235,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1105387,"avatar":"https://static001.geekbang.org/account/avatar/00/10/dd/eb/80f9d212.jpg","nickname":"lttzzlll","note":"","ucode":"FA160F7C02ABAA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1311254,"avatar":"https://static001.geekbang.org/account/avatar/00/14/02/16/6fe3fe44.jpg","nickname":"tangzc1","note":"","ucode":"78CB596D2F33DC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390780,"discussion_content":"soga.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630045693,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":1606,"ip_address":""},"score":390780,"extra":""}]}]},{"had_liked":false,"id":32476,"user_name":"Vincent","can_delete":false,"product_type":"c1","uid":1223046,"ip_address":"","ucode":"61CFE863E8E6D1","user_header":"https://static001.geekbang.org/account/avatar/00/12/a9/86/8211935c.jpg","comment_is_top":false,"comment_ctime":1539585537,"is_pvip":false,"replies":[{"id":"11846","content":"缩进问题。麻烦编辑给改一下。","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1539591358,"ip_address":"","comment_id":32476,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1539585537","product_id":100015201,"comment_content":"文中Download api 的yml文件好像有问题，创建会报错<br>error: error validating &quot;downloadapi-volume.yaml&quot;: error validating data: ValidationError(Pod.spec.volumes[0].projected.sources[0]): unknown field &quot;items&quot; in io.k8s.api.core.v1.VolumeProjection; if you choose to ignore these errors, turn validation off with --validate=false<br><br>看了官档要这样才能创建成果<br>apiVersion: v1<br>kind: Pod<br>metadata:<br>  name: test-downwardapi-volume<br>  labels:<br>    zone: us-est-coast<br>    cluster: test-cluster1<br>    rack: rack-22<br>spec:<br>  containers:<br>    - name: client-container<br>      image: k8s.gcr.io&#47;busybox<br>      command: [&quot;sh&quot;, &quot;-c&quot;]<br>      args:<br>      - while true; do<br>          if [[ -e &#47;etc&#47;podinfo&#47;labels ]]; then<br>            echo -en &#39;\\n\\n&#39;; cat &#47;etc&#47;podinfo&#47;labels; fi;<br>          sleep 5;<br>        done;<br>      volumeMounts:<br>        - name: podinfo<br>          mountPath: &#47;etc&#47;podinfo<br>          readOnly: false<br>  volumes:<br>    - name: podinfo<br>      downwardAPI:<br>        items:<br>          - path: &quot;labels&quot;<br>            fieldRef:<br>              fieldPath: metadata.labels<br><br><br>不知道说的是不是对的？","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426786,"discussion_content":"缩进问题。麻烦编辑给改一下。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539591358,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":31959,"user_name":"Yiliu","can_delete":false,"product_type":"c1","uid":1068884,"ip_address":"","ucode":"2CF20B138244B7","user_header":"https://static001.geekbang.org/account/avatar/00/10/4f/54/552bde40.jpg","comment_is_top":false,"comment_ctime":1539342927,"is_pvip":false,"replies":[{"id":"11565","content":"不是，后面会讲。","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1539357109,"ip_address":"","comment_id":31959,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1539342927","product_id":100015201,"comment_content":"istio的自动添加sidecar是不是就是用的preset","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426582,"discussion_content":"不是，后面会讲。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539357109,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":28283,"user_name":"vx:jiancheng_goon","can_delete":false,"product_type":"c1","uid":1218615,"ip_address":"","ucode":"FD34901B061825","user_header":"https://static001.geekbang.org/account/avatar/00/12/98/37/7f575aec.jpg","comment_is_top":false,"comment_ctime":1538041316,"is_pvip":false,"replies":[{"id":"10172","content":"不是，kubernetes 的client library ","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1538049639,"ip_address":"","comment_id":28283,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1538041316","product_id":100015201,"comment_content":"k8s client指的是kubectl吗？","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425212,"discussion_content":"不是，kubernetes 的client library ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538049639,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":28222,"user_name":"Sun Fei","can_delete":false,"product_type":"c1","uid":1032631,"ip_address":"","ucode":"092EC0992050BB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c1/b7/57f153f6.jpg","comment_is_top":false,"comment_ctime":1538025474,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1538025474","product_id":100015201,"comment_content":"从开始到现在，收获很多，谢谢dalao","like_count":0},{"had_liked":false,"id":28219,"user_name":"北卡","can_delete":false,"product_type":"c1","uid":1218128,"ip_address":"","ucode":"2D947A61689FC6","user_header":"https://static001.geekbang.org/account/avatar/00/12/96/50/bde525b1.jpg","comment_is_top":false,"comment_ctime":1538024574,"is_pvip":false,"replies":[{"id":"10152","content":"对的。这篇文章的题目不就是深入解析pod对象嘛。","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1538041567,"ip_address":"","comment_id":28219,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1538024574","product_id":100015201,"comment_content":"deployment创建的pod只支持restart aways，是为了让pod保存始终出于预期运行状态的概念吗?<br>所有文章中写的pod的各种重启方式，是专门指单独创建pod的情况下?<br><br>极客时间不能直接回复作者的回复好麻烦啊哈哈哈，感觉交流会断掉。<br>谢谢张磊一直都在保持回复，教程太棒了。","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425183,"discussion_content":"对的。这篇文章的题目不就是深入解析pod对象嘛。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538041567,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27928,"user_name":"包子","can_delete":false,"product_type":"c1","uid":1089345,"ip_address":"","ucode":"6CC4EBB8CD3924","user_header":"https://static001.geekbang.org/account/avatar/00/10/9f/41/82306dfe.jpg","comment_is_top":false,"comment_ctime":1537967088,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1537967088","product_id":100015201,"comment_content":"健康性检查探针不建议开发测试环境使用吧，容器一重启，信息全没了。之前开启过，后来给关了😓","like_count":0},{"had_liked":false,"id":27925,"user_name":"包子","can_delete":false,"product_type":"c1","uid":1089345,"ip_address":"","ucode":"6CC4EBB8CD3924","user_header":"https://static001.geekbang.org/account/avatar/00/10/9f/41/82306dfe.jpg","comment_is_top":false,"comment_ctime":1537966920,"is_pvip":false,"replies":[{"id":"10126","content":"不是都说了可以关的……","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1538018519,"ip_address":"","comment_id":27925,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1537966920","product_id":100015201,"comment_content":"一般的容器在不访问server api时，Service account token挂载可以关掉吗老师，没什么影响吧？","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425087,"discussion_content":"不是都说了可以关的……","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538018519,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27837,"user_name":"小伟","can_delete":false,"product_type":"c1","uid":1229457,"ip_address":"","ucode":"4E20DFD3D4FF82","user_header":"https://static001.geekbang.org/account/avatar/00/12/c2/91/fba79b87.jpg","comment_is_top":false,"comment_ctime":1537952901,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1537952901","product_id":100015201,"comment_content":"我们生产环境健康检查是用keepalived或者haproxy.配合监控能满足基本的要求。","like_count":0}]}