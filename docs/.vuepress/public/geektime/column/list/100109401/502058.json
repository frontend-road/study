{"id":502058,"title":"13 ï½œDI Containerï¼ˆ1ï¼‰ï¼šå¦‚ä½•å®ç°åŸºæœ¬çš„DIå®¹å™¨ç»“æ„ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å¾æ˜Šã€‚ä»ä»Šå¤©å¼€å§‹ï¼Œæˆ‘ä»¬å°±æ¥ä½¿ç”¨TDDçš„æ–¹å¼å®ç°æ³¨å…¥ä¾èµ–å®¹å™¨ã€‚</p><p>åœ¨ä¸ŠèŠ‚è¯¾ï¼Œæˆ‘ä»¬å‚ç…§å…¶ä»–ä¾èµ–æ³¨å…¥å®¹å™¨ï¼Œä»‹ç»äº†ä¾èµ–æ³¨å…¥å®¹å™¨çš„å¤§è‡´åŠŸèƒ½ã€‚ç°åœ¨è¯·å›æƒ³ä¸€ä¸‹TDDçš„æµç¨‹ï¼ˆå‚çœ‹<a href=\"https://time.geekbang.org/column/article/496703\">ç¬¬11è®²</a>ï¼‰ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/a5/9c/a5a74d26cf9581064420d81cff7da89c.jpg?wh=2284x1285\" alt=\"\"><br>\nç°åœ¨æˆ‘ä»¬éœ€è¦å°†éœ€æ±‚åˆ†è§£ä¸ºåŠŸèƒ½ç‚¹ï¼Œå¹¶æ„æƒ³æ¶æ„æ„¿æ™¯ã€‚</p><h2>å°†éœ€æ±‚åˆ†è§£ä¸ºåŠŸèƒ½ç‚¹</h2><p>å¯¹äºç»„ä»¶æ„é€ éƒ¨åˆ†ï¼Œæˆ‘åˆ†è§£çš„ä»»åŠ¡å¦‚ä¸‹ï¼š</p><ul>\n<li>\n<p>æ— éœ€æ„é€ çš„ç»„ä»¶â€”â€”ç»„ä»¶å®ä¾‹</p>\n</li>\n<li>\n<p>å¦‚æœæ³¨å†Œçš„ç»„ä»¶ä¸å¯å®ä¾‹åŒ–ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</p>\n<ul>\n<li>æŠ½è±¡ç±»</li>\n<li>æ¥å£</li>\n</ul>\n</li>\n<li>\n<p>æ„é€ å‡½æ•°æ³¨å…¥</p>\n<ul>\n<li>æ— ä¾èµ–çš„ç»„ä»¶åº”è¯¥é€šè¿‡é»˜è®¤æ„é€ å‡½æ•°ç”Ÿæˆç»„ä»¶å®ä¾‹</li>\n<li>æœ‰ä¾èµ–çš„ç»„ä»¶ï¼Œé€šè¿‡Injectæ ‡æ³¨çš„æ„é€ å‡½æ•°ç”Ÿæˆç»„ä»¶å®ä¾‹</li>\n<li>å¦‚æœæ‰€ä¾èµ–çš„ç»„ä»¶ä¹Ÿå­˜åœ¨ä¾èµ–ï¼Œé‚£ä¹ˆéœ€è¦å¯¹æ‰€ä¾èµ–çš„ç»„ä»¶ä¹Ÿå®Œæˆä¾èµ–æ³¨å…¥</li>\n<li>å¦‚æœç»„ä»¶æœ‰å¤šäºä¸€ä¸ªInjectæ ‡æ³¨çš„æ„é€ å‡½æ•°ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</li>\n<li>å¦‚æœç»„ä»¶éœ€è¦çš„ä¾èµ–ä¸å­˜åœ¨ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</li>\n<li>å¦‚æœç»„ä»¶é—´å­˜åœ¨å¾ªç¯ä¾èµ–ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</li>\n</ul>\n</li>\n<li>\n<p>å­—æ®µæ³¨å…¥</p>\n<ul>\n<li>é€šè¿‡Injectæ ‡æ³¨å°†å­—æ®µå£°æ˜ä¸ºä¾èµ–ç»„ä»¶</li>\n<li>å¦‚æœç»„ä»¶éœ€è¦çš„ä¾èµ–ä¸å­˜åœ¨ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</li>\n<li>å¦‚æœå­—æ®µä¸ºfinalåˆ™æŠ›å‡ºå¼‚å¸¸</li>\n<li>å¦‚æœç»„ä»¶é—´å­˜åœ¨å¾ªç¯ä¾èµ–ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</li>\n</ul>\n</li>\n<li>\n<p>æ–¹æ³•æ³¨å…¥</p>\n<ul>\n<li>é€šè¿‡Injectæ ‡æ³¨çš„æ–¹æ³•ï¼Œå…¶å‚æ•°ä¸ºä¾èµ–ç»„ä»¶</li>\n<li>é€šè¿‡Injectæ ‡æ³¨çš„æ— å‚æ•°æ–¹æ³•ï¼Œä¼šè¢«è°ƒç”¨</li>\n<li>æŒ‰ç…§å­ç±»ä¸­çš„è§„åˆ™ï¼Œè¦†ç›–çˆ¶ç±»ä¸­çš„Injectæ–¹æ³•</li>\n<li>å¦‚æœç»„ä»¶éœ€è¦çš„ä¾èµ–ä¸å­˜åœ¨ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</li>\n<li>å¦‚æœæ–¹æ³•å®šä¹‰ç±»å‹å‚æ•°ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</li>\n<li>å¦‚æœç»„ä»¶é—´å­˜åœ¨å¾ªç¯ä¾èµ–ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</li>\n</ul>\n</li>\n</ul><!-- [[[read_end]]] --><p>å¯¹äºä¾èµ–é€‰æ‹©éƒ¨åˆ†ï¼Œæˆ‘åˆ†è§£çš„ä»»åŠ¡åˆ—è¡¨å¦‚ä¸‹ï¼š</p><ul>\n<li>\n<p>å¯¹Providerç±»å‹çš„ä¾èµ–</p>\n<ul>\n<li>æ³¨å…¥æ„é€ å‡½æ•°ä¸­å¯ä»¥å£°æ˜å¯¹äºProviderçš„ä¾èµ–</li>\n<li>æ³¨å…¥å­—æ®µä¸­å¯ä»¥å£°æ˜å¯¹äºProviderçš„ä¾èµ–</li>\n<li>æ³¨å…¥æ–¹æ³•ä¸­å¯å£°æ˜å¯¹äºProviderçš„ä¾èµ–</li>\n</ul>\n</li>\n<li>\n<p>è‡ªå®šä¹‰Qualifierçš„ä¾èµ–</p>\n<ul>\n<li>æ³¨å†Œç»„ä»¶æ—¶ï¼Œå¯é¢å¤–æŒ‡å®šQualifier</li>\n<li>æ³¨å†Œç»„ä»¶æ—¶ï¼Œå¯ä»ç±»å¯¹è±¡ä¸Šæå–Qualifier</li>\n<li>å¯»æ‰¾ä¾èµ–æ—¶ï¼Œéœ€åŒæ—¶æ»¡è¶³ç±»å‹ä¸è‡ªå®šä¹‰Qualifieræ ‡æ³¨</li>\n<li>æ”¯æŒé»˜è®¤Qualifierâ€”â€”Named</li>\n</ul>\n</li>\n</ul><p>å¯¹äºç”Ÿå‘½å‘¨æœŸç®¡ç†éƒ¨åˆ†ï¼Œæˆ‘åˆ†è§£çš„ä»»åŠ¡åˆ—è¡¨å¦‚ä¸‹ï¼š</p><ul>\n<li>\n<p>Singletonç”Ÿå‘½å‘¨æœŸ</p>\n<ul>\n<li>æ³¨å†Œç»„ä»¶æ—¶ï¼Œå¯é¢å¤–æŒ‡å®šæ˜¯å¦ä¸ºSingleton</li>\n<li>æ³¨å†Œç»„ä»¶æ—¶ï¼Œå¯ä»ç±»å¯¹è±¡ä¸Šæå–Singletonæ ‡æ³¨</li>\n<li>å¯¹äºåŒ…å«Singletonæ ‡æ³¨çš„ç»„ä»¶ï¼Œåœ¨å®¹å™¨èŒƒå›´å†…æä¾›å”¯ä¸€å®ä¾‹</li>\n<li>å®¹å™¨ç»„ä»¶é»˜è®¤ä¸æ˜¯Singleç”Ÿå‘½å‘¨æœŸ</li>\n</ul>\n</li>\n<li>\n<p>è‡ªå®šä¹‰Scopeæ ‡æ³¨</p>\n<ul>\n<li>å¯å‘å®¹å™¨æ³¨å†Œè‡ªå®šä¹‰Scopeæ ‡æ³¨çš„å›è°ƒ</li>\n</ul>\n</li>\n</ul><p>å¯¹äºæ¶æ„æ„æƒ³ï¼Œæˆ‘å€¾å‘äºä½¿ç”¨ç±»ä¼¼Guiceã€PicoContainerç­‰æ¡†æ¶ï¼Œä»¥ä»£ç æ–¹å¼æ¥é…ç½®å®¹å™¨ã€‚è€Œä¸æ˜¯åƒSpringä¸€æ ·ï¼Œä¸»è¦ä¾èµ–é…ç½®æ–‡ä»¶ã€‚</p><p>ç”±äºä¾èµ–æ³¨å…¥å®¹å™¨çš„é—®é¢˜è§„æ¨¡è¾ƒå°ï¼Œæˆ‘å°†é‡‡ç”¨ç»å…¸TDDæ¨¡å¼è¿›è¡Œå¼€å‘ï¼Œå› è€Œä¹Ÿä¸éœ€è¦å¯¹åŠŸèƒ½ç‚¹è¿›è¡Œè¿›ä¸€æ­¥çš„åˆ†è§£äº†ã€‚</p><p>åœ¨è¿›å…¥çº¢/ç»¿/é‡æ„å¾ªç¯ä¹‹å‰ï¼Œæˆ‘çš„build.gradle.ktsæ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>plugins {\n    `java-library`\n    &quot;jacoco&quot;\n}\nrepositories {\n    mavenCentral()\n}\ndependencies {\n    implementation(&quot;jakarta.inject:jakarta.inject-api:2.0.1&quot;)\n    testImplementation(&quot;org.junit.jupiter:junit-jupiter-api:5.8.2&quot;)\n    testImplementation(&quot;org.junit.jupiter:junit-jupiter-params:5.8.2&quot;)\n    testRuntimeOnly(&quot;org.junit.jupiter:junit-jupiter-engine:5.8.2&quot;)\n    testRuntimeOnly(&quot;org.junit.vintage:junit-vintage-engine:5.8.2&quot;)\n    testRuntimeOnly(&quot;org.junit.platform:junit-platform-runner:1.8.2&quot;)\n    testImplementation(&quot;org.mockito:mockito-core:4.3.1&quot;)\n    testImplementation(&quot;jakarta.inject:jakarta.inject-tck:2.0.1&quot;)\n}\ntasks.withType&lt;Test&gt;() {\n    useJUnitPlatform()\n}\njava {\n    sourceCompatibility = JavaVersion.VERSION_17\n    targetCompatibility = JavaVersion.VERSION_17\n}\n</code></pre><h2>è¿›å…¥çº¢/ç»¿/é‡æ„å¾ªç¯</h2><p>ä¸‹é¢è®©æˆ‘ä»¬è¿›å…¥TDDçš„çº¢/ç»¿/é‡æ„å¾ªç¯ï¼š</p><p><video poster=\"https://media001.geekbang.org/f659c14170b74b3abe8a5d9e7f7e6190/snapshots/a6670a01de8340fea4888aa4dbd15650-00005.jpg\" preload=\"none\" controls=\"\"><source src=\"https://media001.geekbang.org/customerTrans/7e27d07d27d407ebcc195a0e78395f55/41cbc02-18016ad7d04-0000-0000-01d-dbacd.mp4\" type=\"video/mp4\"><source src=\" https://media001.geekbang.org/dbf1a284629c4fb49fb25eef4c132f52/43c50f60dfbd4299adee249bb54c901f-cb82b162cdd2b54e8d1c1747fef54fad-sd.m3u8\" type=\"application/x-mpegURL\"></video></p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¼•å…¥äº†Providerè¿™æ ·ä¸€ä¸ªç±»ä¼¼äºFactoryå·¥å‚æ–¹æ³•çš„ç»“æ„ï¼Œå¾—åˆ°äº†æ•´ä¸ªä¾èµ–æ³¨å…¥å®¹å™¨çš„åŸºæœ¬ç»“æ„ã€‚</p><p>é‚£ä¹ˆå‰©ä¸‹çš„äº‹æƒ…å°±æ˜¯ï¼Œæˆ‘ä»¬è¦å›´ç»•DIå®¹å™¨çš„åŸºæœ¬ç»“æ„ï¼Œå¯¹å…¶è¿›è¡Œæ›´å¤šåŠŸèƒ½ä¸Šçš„å®Œå–„ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>åœ¨é‡æ„çš„æ—¶å€™ï¼Œæˆ‘é‡‡ç”¨çš„æ˜¯å¢åŠ ä¸€ä¸ªå¹³è¡Œå®ç°ï¼ˆParallel Implementationï¼‰ã€‚ç”¨å¹³è¡Œå®ç°æ›¿æ¢åŸæœ‰åŠŸèƒ½ï¼Œç„¶åå†åˆ é™¤åŸæœ‰å®ç°çš„åšæ³•ã€‚ä½ æœ‰æ²¡æœ‰ä¸ä¸€æ ·çš„åšæ³•ï¼Ÿ</p><p>æ¬¢è¿æŠŠä½ çš„æ€è€ƒå’Œæƒ³æ³•åˆ†äº«åœ¨ç•™è¨€åŒºï¼Œä¹Ÿæ¬¢è¿ä½ æ‰«æè¯¦æƒ…é¡µçš„äºŒç»´ç åŠ å…¥è¯»è€…äº¤æµç¾¤ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","neighbors":{"left":{"article_title":"12ï½œå®æˆ˜ä¸­çš„TDDï¼šRESTful APIçš„å¼€å‘æ¡†æ¶","id":502056},"right":{"article_title":"14ï½œDI Containerï¼ˆ2ï¼‰ï¼šå¦‚ä½•é€šè¿‡Sad Pathä¸ºå®¹å™¨å¢åŠ åŠŸèƒ½ï¼Ÿ","id":502584}},"comments":[{"had_liked":false,"id":343907,"user_name":"ğŸ‘","can_delete":false,"product_type":"c1","uid":2189689,"ip_address":"","ucode":"DE34B3B14287D1","user_header":"https://static001.geekbang.org/account/avatar/00/21/69/79/b4132042.jpg","comment_is_top":true,"comment_ctime":1651116035,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"9.2233720385059e+18","product_id":100109401,"comment_content":"TDDä¸“æ ç¦åˆ©å¤§åˆé›†ï¼š<br><br>1ã€æ‰“å¡èµ¢å¥½ç¤¼ï¼ˆ4æœˆ23æ—¥-5æœˆ10æ—¥ï¼‰ï¼šæ­£åœ¨è¿›è¡Œä¸­ï¼Œå­¦ä¹ ä¸“æ ç¬¬1-10è®²å¹¶åœ¨ç•™è¨€åŒºæ‰“å¡ï¼Œç»“æŸåå¥–åŠ±ï¼›<br><br>2ã€ä»£ç äº²æ‰‹è¯„ï¼ˆ5æœˆåº•ï¼‰ï¼šé¢„è®¡æ‰“å¡ç»“æŸåå¯åŠ¨ï¼Œå®Œæˆå‰10è®²çš„æ‰“å¡ï¼Œå³å¯æäº¤ä»£ç ç»ƒä¹ ä½œä¸šï¼Œå¾æ˜Šè€å¸ˆä¼šäº²è‡ªç‚¹è¯„ï¼›<br><br>3ã€çº¿ä¸Šå¸¦ä½ ç»ƒï¼šæ ¹æ®ä¸“æ æ›´æ–°èŠ‚å¥å’Œè€å¸ˆæ—¶é—´å®‰æ’ç¡®å®šï¼Œå¾æ˜Šè€å¸ˆä¼šçº¿ä¸Šå¸¦å››ä¸ªåŒå­¦æ‰‹æŠŠæ‰‹åœ°æ”¹ä»£ç ï¼Œæ•¬è¯·æœŸå¾…ï¼<br><br>å…·ä½“æ´»åŠ¨ä»‹ç»è§ ğŸ‘‰ http:&#47;&#47;gk.link&#47;a&#47;11jPi","like_count":0},{"had_liked":false,"id":358029,"user_name":"åŠªåŠ›åŠªåŠ›å†åŠªåŠ›","can_delete":false,"product_type":"c1","uid":1493907,"ip_address":"å¹¿ä¸œ","ucode":"0C6EEA28FCE8C7","user_header":"https://static001.geekbang.org/account/avatar/00/16/cb/93/4adea49a.jpg","comment_is_top":false,"comment_ctime":1663837261,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1663837261","product_id":100109401,"comment_content":"é—®é¢˜ï¼š åœ¨é‡æ„çš„æ—¶å€™ï¼Œæˆ‘é‡‡ç”¨çš„æ˜¯å¢åŠ ä¸€ä¸ªå¹³è¡Œå®ç°ï¼ˆParallel Implementationï¼‰ã€‚ç”¨å¹³è¡Œå®ç°æ›¿æ¢åŸæœ‰åŠŸèƒ½ï¼Œç„¶åå†åˆ é™¤åŸæœ‰å®ç°çš„åšæ³•ã€‚ä½ æœ‰æ²¡æœ‰ä¸ä¸€æ ·çš„åšæ³•ï¼Ÿ<br><br>1. å¯ä»¥å…ˆæ–°å¢ä¸€ä¸ªæ–°çš„æ–¹æ³• private static &lt;ComponentType&gt; void bind(Class&lt;ComponentType&gt; clazz, Provider&lt;ComponentType&gt; provider)<br>2. è°ƒæ•´åŸæœ‰çš„æ—§ bind æ–¹æ³•ï¼Œæ”¹æˆè°ƒç”¨ bind æ–¹æ³• -----&gt;  æ­¤æ—¶éœ€è¦é‡æ–°æ‰§è¡Œæµ‹è¯•ï¼ŒéªŒè¯é‡æ„æ˜¯å¦å½±å“æµ‹è¯•ç»“æœ<br>3. é€šè¿‡ inline methodï¼Œæ¶ˆé™¤ä¸Šæ–¹çš„privateæ–¹æ³•","like_count":1},{"had_liked":false,"id":343695,"user_name":"keep_curiosity","can_delete":false,"product_type":"c1","uid":1246273,"ip_address":"","ucode":"794DC1D3FB9214","user_header":"https://static001.geekbang.org/account/avatar/00/13/04/41/082e2706.jpg","comment_is_top":false,"comment_ctime":1650985545,"is_pvip":false,"replies":[{"id":"125433","content":"jsr330é‡Œæœ‰ä¸€ä¸ª provider å°±ç”¨äº†","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2537798","ctime":1650991650,"ip_address":"","comment_id":343695,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1650985545","product_id":100109401,"comment_content":"Java8ä¸æ˜¯å°±æä¾›äº†Supplierå‡½æ•°å¼æ¥å£ä¹ˆï¼Ÿä¸ºä»€ä¹ˆåˆæä¸€ä¸ªProviderå‘¢ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2537798,"avatar":"https://static001.geekbang.org/account/avatar/00/26/b9/46/758ecf4a.jpg","nickname":"å¾å…«å‰","note":"","ucode":"DA6D1EB08A7396","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":567800,"discussion_content":"jsr330é‡Œæœ‰ä¸€ä¸ª provider å°±ç”¨äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650991650,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":343575,"user_name":"lj","can_delete":false,"product_type":"c1","uid":2670731,"ip_address":"","ucode":"D4290EDA64CD73","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/JJuLc4x3zjuRHWI1bYDgCySL7bAKRjH9YCxgEXgicSVrQkZyyBFj1IF5SHxVgjqJQrXOoHaRU9FUp2Qsn45Lu3A/132","comment_is_top":false,"comment_ctime":1650938553,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1650938553","product_id":100109401,"comment_content":"è€å¸ˆï¼Œè¯·é—®ä¸ºå•¥åœ¨no argsè¿™ä¸ªä»»åŠ¡ï¼Œæµ‹çš„æ˜¯componentImplementä¼šæ„é€ å‡ºcomponentè¿™ä¸ªæ¥å£ç±»å‹ï¼Ÿæˆ‘åŸæœ¬ç†è§£è¿™ä¸ªä»»åŠ¡æ˜¯å¯¹æŸä¸ªç±»èƒ½æ”¯æŒä»¥é»˜è®¤æ„é€ å‡½æ•°æ„å»ºå°±å¯ä»¥äº†ï¼Œä¸ç†è§£çš„ç‚¹æ˜¯ä¸ºå•¥è¦æä¸ªinterfaceï¼Œæ„Ÿè§‰åº”è¯¥æ˜¯å¦å¤–çš„ä¸€ä¸ªä»»åŠ¡ã€‚","like_count":0},{"had_liked":false,"id":342070,"user_name":"Geek_7c0961","can_delete":false,"product_type":"c1","uid":2277181,"ip_address":"","ucode":"B1482E64FF9E4E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ8aLz0tWdsZuMiaNUAd0dicSD9M6A77seMGFdHgvsQwOzN8ztYPiaJSo53DcbjQWUQpw4pf4rI2f7vg/132","comment_is_top":false,"comment_ctime":1649998934,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1649998934","product_id":100109401,"comment_content":"è¿™èŠ‚è¯¾ç¡®å®å’Œjavaè¯­è¨€å…³ç³»ä¸ç®—å¤ªå¤§äº†.è¿˜æ˜¯å¸Œæœ›è€å¸ˆèƒ½å¤Ÿå†è®²è§£çš„è¿‡ç¨‹ä¸­æ·¡åŒ–è¯­è¨€æœ¬èº«çš„ç‰¹æ€§.","like_count":0}]}