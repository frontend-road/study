{"id":81497,"title":"36 | 套路篇：怎么评估系统的网络性能？","content":"<p>你好，我是倪朋飞。</p><p>上一节，我们回顾了经典的 C10K 和 C1000K 问题。简单回顾一下，C10K 是指如何单机同时处理 1 万个请求（并发连接1万）的问题，而 C1000K 则是单机支持处理 100 万个请求（并发连接100万）的问题。</p><p>I/O 模型的优化，是解决 C10K 问题的最佳良方。Linux 2.6 中引入的 epoll，完美解决了 C10K 的问题，并一直沿用至今。今天的很多高性能网络方案，仍都基于 epoll。</p><p>自然，随着互联网技术的普及，催生出更高的性能需求。从 C10K 到 C100K，我们只需要增加系统的物理资源，就可以满足要求；但从 C100K 到 C1000K ，光增加物理资源就不够了。</p><p>这时，就要对系统的软硬件进行统一优化，从硬件的中断处理，到网络协议栈的文件描述符数量、连接状态跟踪、缓存队列，再到应用程序的工作模型等的整个网络链路，都需要深入优化。</p><p>再进一步，要实现 C10M，就不是增加物理资源、调优内核和应用程序可以解决的问题了。这时内核中冗长的网络协议栈就成了最大的负担。</p><ul>\n<li>\n<p>需要用 XDP 方式，在内核协议栈之前，先处理网络包。</p>\n</li>\n<li>\n<p>或基于 DPDK ，直接跳过网络协议栈，在用户空间通过轮询的方式处理。</p>\n</li>\n</ul><p>其中，DPDK 是目前最主流的高性能网络方案，不过，这需要能支持 DPDK 的网卡配合使用。</p><!-- [[[read_end]]] --><p>当然，实际上，在大多数场景中，我们并不需要单机并发 1000 万请求。通过调整系统架构，把请求分发到多台服务器中并行处理，才是更简单、扩展性更好的方案。</p><p>不过，这种情况下，就需要我们评估系统的网络性能，以便考察系统的处理能力，并为容量规划提供基准数据。</p><p>那么，到底该怎么评估网络的性能呢？今天，我就带你一起来看看这个问题。</p><h2>性能指标回顾</h2><p>在评估网络性能前，我们先来回顾一下，衡量网络性能的指标。在 Linux 网络基础篇中，我们曾经说到，带宽、吞吐量、延时、PPS 等，都是最常用的网络性能指标。还记得它们的具体含义吗？你可以先思考一下，再继续下面的内容。</p><p>首先，<strong>带宽</strong>，表示链路的最大传输速率，单位是 b/s（比特/秒）。在你为服务器选购网卡时，带宽就是最核心的参考指标。常用的带宽有 1000M、10G、40G、100G 等。</p><p>第二，<strong>吞吐量</strong>，表示没有丢包时的最大数据传输速率，单位通常为 b/s （比特/秒）或者 B/s（字节/秒）。吞吐量受带宽的限制，吞吐量/带宽也就是该网络链路的使用率。</p><p>第三，<strong>延时</strong>，表示从网络请求发出后，一直到收到远端响应，所需要的时间延迟。这个指标在不同场景中可能会有不同的含义。它可以表示建立连接需要的时间（比如 TCP 握手延时），或者一个数据包往返所需时间（比如 RTT）。</p><p>最后，<strong>PPS</strong>，是 Packet Per Second（包/秒）的缩写，表示以网络包为单位的传输速率。PPS 通常用来评估网络的转发能力，而基于 Linux 服务器的转发，很容易受到网络包大小的影响（交换机通常不会受到太大影响，即交换机可以线性转发）。</p><p>这四个指标中，带宽跟物理网卡配置是直接关联的。一般来说，网卡确定后，带宽也就确定了（当然，实际带宽会受限于整个网络链路中最小的那个模块）。</p><p>另外，你可能在很多地方听说过“网络带宽测试”，这里测试的实际上不是带宽，而是网络吞吐量。Linux 服务器的网络吞吐量一般会比带宽小，而对交换机等专门的网络设备来说，吞吐量一般会接近带宽。</p><p>最后的 PPS，则是以网络包为单位的网络传输速率，通常用在需要大量转发的场景中。而对 TCP 或者 Web 服务来说，更多会用并发连接数和每秒请求数（QPS，Query per Second）等指标，它们更能反应实际应用程序的性能。</p><h2>网络基准测试</h2><p>熟悉了网络的性能指标后，接下来，我们再来看看，如何通过性能测试来确定这些指标的基准值。</p><p>你可以先思考一个问题。我们已经知道，Linux 网络基于 TCP/IP 协议栈，而不同协议层的行为显然不同。那么，测试之前，你应该弄清楚，你要评估的网络性能，究竟属于协议栈的哪一层？换句话说，你的应用程序基于协议栈的哪一层呢？</p><p>根据前面学过的 TCP/IP 协议栈的原理，这个问题应该不难回答。比如：</p><ul>\n<li>\n<p>基于 HTTP 或者 HTTPS 的 Web 应用程序，显然属于应用层，需要我们测试 HTTP/HTTPS 的性能；</p>\n</li>\n<li>\n<p>而对大多数游戏服务器来说，为了支持更大的同时在线人数，通常会基于 TCP 或 UDP ，与客户端进行交互，这时就需要我们测试 TCP/UDP 的性能；</p>\n</li>\n<li>\n<p>当然，还有一些场景，是把 Linux 作为一个软交换机或者路由器来用的。这种情况下，你更关注网络包的处理能力（即 PPS），重点关注网络层的转发性能。</p>\n</li>\n</ul><p>接下来，我就带你从下往上，了解不同协议层的网络性能测试方法。不过要注意，低层协议是其上的各层网络协议的基础。自然，低层协议的性能，也就决定了高层的网络性能。</p><p>注意，以下所有的测试方法，都需要两台 Linux 虚拟机。其中一台，可以当作待测试的目标机器；而另一台，则可以当作正在运行网络服务的客户端，用来运行测试工具。</p><h2>各协议层的性能测试</h2><h3>转发性能</h3><p>我们首先来看，网络接口层和网络层，它们主要负责网络包的封装、寻址、路由以及发送和接收。在这两个网络协议层中，每秒可处理的网络包数 PPS，就是最重要的性能指标。特别是 64B 小包的处理能力，值得我们特别关注。那么，如何来测试网络包的处理能力呢？</p><p>说到网络包相关的测试，你可能会觉得陌生。不过，其实在专栏开头的 CPU 性能篇中，我们就接触过一个相关工具，也就是软中断案例中的 hping3。</p><p>在那个案例中，hping3 作为一个 SYN 攻击的工具来使用。实际上， hping3 更多的用途，是作为一个测试网络包处理能力的性能工具。</p><p>今天我再来介绍另一个更常用的工具，Linux 内核自带的高性能网络测试工具 <a href=\"https://wiki.linuxfoundation.org/networking/pktgen\">pktgen</a>。pktgen 支持丰富的自定义选项，方便你根据实际需要构造所需网络包，从而更准确地测试出目标服务器的性能。</p><p>不过，在 Linux 系统中，你并不能直接找到 pktgen 命令。因为 pktgen 作为一个内核线程来运行，需要你加载 pktgen 内核模块后，再通过 /proc 文件系统来交互。下面就是 pktgen 启动的两个内核线程和 /proc 文件系统的交互文件：</p><pre><code>$ modprobe pktgen\n$ ps -ef | grep pktgen | grep -v grep\nroot     26384     2  0 06:17 ?        00:00:00 [kpktgend_0]\nroot     26385     2  0 06:17 ?        00:00:00 [kpktgend_1]\n$ ls /proc/net/pktgen/\nkpktgend_0  kpktgend_1  pgctrl\n</code></pre><p>pktgen 在每个 CPU 上启动一个内核线程，并可以通过 /proc/net/pktgen 下面的同名文件，跟这些线程交互；而 pgctrl 则主要用来控制这次测试的开启和停止。</p><blockquote>\n<p>如果 modprobe 命令执行失败，说明你的内核没有配置 CONFIG_NET_PKTGEN 选项。这就需要你配置 pktgen 内核模块（即 CONFIG_NET_PKTGEN=m）后，重新编译内核，才可以使用。</p>\n</blockquote><p>在使用 pktgen 测试网络性能时，需要先给每个内核线程 kpktgend_X 以及测试网卡，配置 pktgen 选项，然后再通过 pgctrl 启动测试。</p><p>以发包测试为例，假设发包机器使用的网卡是 eth0，而目标机器的 IP 地址为 192.168.0.30，MAC 地址为 11:11:11:11:11:11。</p><p><img src=\"https://static001.geekbang.org/resource/image/f0/09/f01dc79465e7f1d03b6fbdabbe4ad109.png?wh=1310*466\" alt=\"\"></p><p>接下来，就是一个发包测试的示例。</p><pre><code># 定义一个工具函数，方便后面配置各种测试选项\nfunction pgset() {\n    local result\n    echo $1 &gt; $PGDEV\n\n    result=`cat $PGDEV | fgrep &quot;Result: OK:&quot;`\n    if [ &quot;$result&quot; = &quot;&quot; ]; then\n         cat $PGDEV | fgrep Result:\n    fi\n}\n\n# 为0号线程绑定eth0网卡\nPGDEV=/proc/net/pktgen/kpktgend_0\npgset &quot;rem_device_all&quot;   # 清空网卡绑定\npgset &quot;add_device eth0&quot;  # 添加eth0网卡\n\n# 配置eth0网卡的测试选项\nPGDEV=/proc/net/pktgen/eth0\npgset &quot;count 1000000&quot;    # 总发包数量\npgset &quot;delay 5000&quot;       # 不同包之间的发送延迟(单位纳秒)\npgset &quot;clone_skb 0&quot;      # SKB包复制\npgset &quot;pkt_size 64&quot;      # 网络包大小\npgset &quot;dst 192.168.0.30&quot; # 目的IP\npgset &quot;dst_mac 11:11:11:11:11:11&quot;  # 目的MAC\n\n# 启动测试\nPGDEV=/proc/net/pktgen/pgctrl\npgset &quot;start&quot;\n</code></pre><p>稍等一会儿，测试完成后，结果可以从 /proc 文件系统中获取。通过下面代码段中的内容，我们可以查看刚才的测试报告：</p><pre><code>$ cat /proc/net/pktgen/eth0\nParams: count 1000000  min_pkt_size: 64  max_pkt_size: 64\n     frags: 0  delay: 0  clone_skb: 0  ifname: eth0\n     flows: 0 flowlen: 0\n...\nCurrent:\n     pkts-sofar: 1000000  errors: 0\n     started: 1534853256071us  stopped: 1534861576098us idle: 70673us\n...\nResult: OK: 8320027(c8249354+d70673) usec, 1000000 (64byte,0frags)\n  120191pps 61Mb/sec (61537792bps) errors: 0\n</code></pre><p>你可以看到，测试报告主要分为三个部分：</p><ul>\n<li>\n<p>第一部分的 Params 是测试选项；</p>\n</li>\n<li>\n<p>第二部分的 Current 是测试进度，其中， packts so far（pkts-sofar）表示已经发送了 100 万个包，也就表明测试已完成。</p>\n</li>\n<li>\n<p>第三部分的 Result 是测试结果，包含测试所用时间、网络包数量和分片、PPS、吞吐量以及错误数。</p>\n</li>\n</ul><p>根据上面的结果，我们发现，PPS 为 12 万，吞吐量为 61 Mb/s，没有发生错误。那么，12 万的 PPS 好不好呢？</p><p>作为对比，你可以计算一下千兆交换机的 PPS。交换机可以达到线速（满负载时，无差错转发），它的 PPS 就是 1000Mbit 除以以太网帧的大小，即 1000Mbps/((64+20)*8bit) = 1.5 Mpps（其中，20B 为以太网帧前导和帧间距的大小）。</p><p>你看，即使是千兆交换机的 PPS，也可以达到 150 万 PPS，比我们测试得到的 12 万大多了。所以，看到这个数值你并不用担心，现在的多核服务器和万兆网卡已经很普遍了，稍做优化就可以达到数百万的 PPS。而且，如果你用了上节课讲到的 DPDK 或 XDP ，还能达到千万数量级。</p><h3>TCP/UDP 性能</h3><p>掌握了 PPS 的测试方法，接下来，我们再来看TCP 和 UDP 的性能测试方法。说到 TCP 和 UDP 的测试，我想你已经很熟悉了，甚至可能一下子就能想到相应的测试工具，比如 iperf 或者 netperf。</p><p>特别是现在的云计算时代，在你刚拿到一批虚拟机时，首先要做的，应该就是用 iperf ，测试一下网络性能是否符合预期。</p><p>iperf 和 netperf 都是最常用的网络性能测试工具，测试 TCP 和 UDP 的吞吐量。它们都以客户端和服务器通信的方式，测试一段时间内的平均吞吐量。</p><p>接下来，我们就以 iperf 为例，看一下 TCP 性能的测试方法。目前，iperf 的最新版本为 iperf3，你可以运行下面的命令来安装：</p><pre><code># Ubuntu\napt-get install iperf3\n# CentOS\nyum install iperf3\n</code></pre><p>然后，在目标机器上启动 iperf 服务端：</p><pre><code># -s表示启动服务端，-i表示汇报间隔，-p表示监听端口\n$ iperf3 -s -i 1 -p 10000\n</code></pre><p>接着，在另一台机器上运行 iperf 客户端，运行测试：</p><pre><code># -c表示启动客户端，192.168.0.30为目标服务器的IP\n# -b表示目标带宽(单位是bits/s)\n# -t表示测试时间\n# -P表示并发数，-p表示目标服务器监听端口\n$ iperf3 -c 192.168.0.30 -b 1G -t 15 -P 2 -p 10000\n</code></pre><p>稍等一会儿（15秒）测试结束后，回到目标服务器，查看 iperf 的报告：</p><pre><code>[ ID] Interval           Transfer     Bandwidth\n...\n[SUM]   0.00-15.04  sec  0.00 Bytes  0.00 bits/sec                  sender\n[SUM]   0.00-15.04  sec  1.51 GBytes   860 Mbits/sec                  receiver\n</code></pre><p>最后的 SUM 行就是测试的汇总结果，包括测试时间、数据传输量以及带宽等。按照发送和接收，这一部分又分为了 sender 和 receiver 两行。</p><p>从测试结果你可以看到，这台机器 TCP 接收的带宽（吞吐量）为 860 Mb/s， 跟目标的 1Gb/s 相比，还是有些差距的。</p><h3>HTTP 性能</h3><p>从传输层再往上，到了应用层。有的应用程序，会直接基于 TCP 或 UDP 构建服务。当然，也有大量的应用，基于应用层的协议来构建服务，HTTP 就是最常用的一个应用层协议。比如，常用的 Apache、Nginx 等各种 Web 服务，都是基于 HTTP。</p><p>要测试 HTTP 的性能，也有大量的工具可以使用，比如 ab、webbench 等，都是常用的 HTTP 压力测试工具。其中，ab 是 Apache 自带的 HTTP 压测工具，主要测试 HTTP 服务的每秒请求数、请求延迟、吞吐量以及请求延迟的分布情况等。</p><p>运行下面的命令，你就可以安装 ab 工具：</p><pre><code># Ubuntu\n$ apt-get install -y apache2-utils\n# CentOS\n$ yum install -y httpd-tools\n</code></pre><p>接下来，在目标机器上，使用 Docker 启动一个 Nginx 服务，然后用 ab 来测试它的性能。首先，在目标机器上运行下面的命令：</p><pre><code>$ docker run -p 80:80 -itd nginx\n</code></pre><p>而在另一台机器上，运行 ab 命令，测试 Nginx 的性能：</p><pre><code># -c表示并发请求数为1000，-n表示总的请求数为10000\n$ ab -c 1000 -n 10000 http://192.168.0.30/\n...\nServer Software:        nginx/1.15.8\nServer Hostname:        192.168.0.30\nServer Port:            80\n\n...\n\nRequests per second:    1078.54 [#/sec] (mean)\nTime per request:       927.183 [ms] (mean)\nTime per request:       0.927 [ms] (mean, across all concurrent requests)\nTransfer rate:          890.00 [Kbytes/sec] received\n\nConnection Times (ms)\n              min  mean[+/-sd] median   max\nConnect:        0   27 152.1      1    1038\nProcessing:     9  207 843.0     22    9242\nWaiting:        8  207 843.0     22    9242\nTotal:         15  233 857.7     23    9268\n\nPercentage of the requests served within a certain time (ms)\n  50%     23\n  66%     24\n  75%     24\n  80%     26\n  90%    274\n  95%   1195\n  98%   2335\n  99%   4663\n 100%   9268 (longest request)\n</code></pre><p>可以看到，ab 的测试结果分为三个部分，分别是请求汇总、连接时间汇总还有请求延迟汇总。以上面的结果为例，我们具体来看。</p><p>在请求汇总部分，你可以看到：</p><ul>\n<li>\n<p>Requests per second 为 1074；</p>\n</li>\n<li>\n<p>每个请求的延迟（Time per request）分为两行，第一行的 927 ms 表示平均延迟，包括了线程运行的调度时间和网络请求响应时间，而下一行的 0.927ms ，则表示实际请求的响应时间；</p>\n</li>\n<li>\n<p>Transfer rate 表示吞吐量（BPS）为 890 KB/s。</p>\n</li>\n</ul><p>连接时间汇总部分，则是分别展示了建立连接、请求、等待以及汇总等的各类时间，包括最小、最大、平均以及中值处理时间。</p><p>最后的请求延迟汇总部分，则给出了不同时间段内处理请求的百分比，比如， 90% 的请求，都可以在 274ms 内完成。</p><h3>应用负载性能</h3><p>当你用 iperf 或者 ab 等测试工具，得到 TCP、HTTP 等的性能数据后，这些数据是否就能表示应用程序的实际性能呢？我想，你的答案应该是否定的。</p><p>比如，你的应用程序基于 HTTP 协议，为最终用户提供一个 Web 服务。这时，使用 ab 工具，可以得到某个页面的访问性能，但这个结果跟用户的实际请求，很可能不一致。因为用户请求往往会附带着各种各种的负载（payload），而这些负载会影响 Web 应用程序内部的处理逻辑，从而影响最终性能。</p><p>那么，为了得到应用程序的实际性能，就要求性能工具本身可以模拟用户的请求负载，而iperf、ab 这类工具就无能为力了。幸运的是，我们还可以用 wrk、TCPCopy、Jmeter 或者 LoadRunner 等实现这个目标。</p><p>以 <a href=\"https://github.com/wg/wrk\">wrk</a> 为例，它是一个 HTTP 性能测试工具，内置了 LuaJIT，方便你根据实际需求，生成所需的请求负载，或者自定义响应的处理方法。</p><p>wrk 工具本身不提供 yum 或 apt 的安装方法，需要通过源码编译来安装。比如，你可以运行下面的命令，来编译和安装 wrk：</p><pre><code>$ https://github.com/wg/wrk\n$ cd wrk\n$ apt-get install build-essential -y\n$ make\n$ sudo cp wrk /usr/local/bin/\n</code></pre><p>wrk 的命令行参数比较简单。比如，我们可以用 wrk ，来重新测一下前面已经启动的 Nginx 的性能。</p><pre><code># -c表示并发连接数1000，-t表示线程数为2\n$ wrk -c 1000 -t 2 http://192.168.0.30/\nRunning 10s test @ http://192.168.0.30/\n  2 threads and 1000 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency    65.83ms  174.06ms   1.99s    95.85%\n    Req/Sec     4.87k   628.73     6.78k    69.00%\n  96954 requests in 10.06s, 78.59MB read\n  Socket errors: connect 0, read 0, write 0, timeout 179\nRequests/sec:   9641.31\nTransfer/sec:      7.82MB\n</code></pre><p>这里使用 2 个线程、并发 1000 连接，重新测试了 Nginx 的性能。你可以看到，每秒请求数为 9641，吞吐量为 7.82MB，平均延迟为 65ms，比前面 ab 的测试结果要好很多。</p><p>这也说明，性能工具本身的性能，对性能测试也是至关重要的。不合适的性能工具，并不能准确测出应用程序的最佳性能。</p><p>当然，wrk 最大的优势，是其内置的 LuaJIT，可以用来实现复杂场景的性能测试。wrk 在调用 Lua 脚本时，可以将 HTTP 请求分为三个阶段，即 setup、running、done，如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/d0/82/d02b845aa308b7a38a5735f3db8d9682.png?wh=621*530\" alt=\"\"></p><p>（图片来自<a href=\"https://sq.163yun.com/blog/article/200008406328934400\">网易云博客</a>）</p><p>比如，你可以在 setup 阶段，为请求设置认证参数（来自于 wrk 官方<a href=\"https://github.com/wg/wrk/blob/master/scripts/auth.lua\">示例</a>）：</p><pre><code>-- example script that demonstrates response handling and\n-- retrieving an authentication token to set on all future\n-- requests\n\ntoken = nil\npath  = &quot;/authenticate&quot;\n\nrequest = function()\n   return wrk.format(&quot;GET&quot;, path)\nend\n\nresponse = function(status, headers, body)\n   if not token and status == 200 then\n      token = headers[&quot;X-Token&quot;]\n      path  = &quot;/resource&quot;\n      wrk.headers[&quot;X-Token&quot;] = token\n   end\nend\n</code></pre><p>而在执行测试时，通过 -s 选项，执行脚本的路径：</p><pre><code>$ wrk -c 1000 -t 2 -s auth.lua http://192.168.0.30/\n</code></pre><p>wrk 需要你用 Lua 脚本，来构造请求负载。这对于大部分场景来说，可能已经足够了 。不过，它的缺点也正是，所有东西都需要代码来构造，并且工具本身不提供 GUI 环境。</p><p>像 Jmeter 或者 LoadRunner（商业产品），则针对复杂场景提供了脚本录制、回放、GUI 等更丰富的功能，使用起来也更加方便。</p><h2>小结</h2><p>今天，我带你一起回顾了网络的性能指标，并学习了网络性能的评估方法。</p><p>性能评估是优化网络性能的前提，只有在你发现网络性能瓶颈时，才需要进行网络性能优化。根据 TCP/IP 协议栈的原理，不同协议层关注的性能重点不完全一样，也就对应不同的性能测试方法。比如，</p><ul>\n<li>\n<p>在应用层，你可以使用 wrk、Jmeter 等模拟用户的负载，测试应用程序的每秒请求数、处理延迟、错误数等；</p>\n</li>\n<li>\n<p>而在传输层，则可以使用 iperf 等工具，测试 TCP 的吞吐情况；</p>\n</li>\n<li>\n<p>再向下，你还可以用 Linux 内核自带的 pktgen ，测试服务器的 PPS。</p>\n</li>\n</ul><p>由于低层协议是高层协议的基础。所以，一般情况下，我们需要从上到下，对每个协议层进行性能测试，然后根据性能测试的结果，结合 Linux 网络协议栈的原理，找出导致性能瓶颈的根源，进而优化网络性能。</p><h2>思考</h2><p>最后，我想请你来聊一聊。</p><ul>\n<li>\n<p>你是如何评估网络性能的？</p>\n</li>\n<li>\n<p>在评估网络性能时，你会从哪个协议层、选择哪些指标，作为性能测试最核心的目标？</p>\n</li>\n<li>\n<p>你又会用哪些工具，测试并分析网络的性能呢？</p>\n</li>\n</ul><p>你可以结合今天学到的网络知识，总结自己的思路。</p><p>欢迎在留言区和我讨论，也欢迎你把这篇文章分享给你的同事、朋友。我们一起在实战中演练，在交流中进步。</p><p></p>","neighbors":{"left":{"article_title":"35 | 基础篇：C10K 和 C1000K 回顾","id":81268},"right":{"article_title":"37 | 案例篇：DNS 解析时快时慢，我该怎么办？","id":81850}},"comments":[{"had_liked":false,"id":123770,"user_name":"。。。。","can_delete":false,"product_type":"c1","uid":1370981,"ip_address":"","ucode":"E724186A3F957A","user_header":"https://static001.geekbang.org/account/avatar/00/14/eb/65/6c4fbdd9.jpg","comment_is_top":false,"comment_ctime":1565754207,"is_pvip":false,"replies":[{"id":"45970","content":"不要使用localhost测试网络，测试带宽要跨主机测试","user_name":"作者回复","comment_id":123770,"uid":"1001282","ip_address":"","utype":1,"ctime":1566133286,"user_name_real":"倪朋飞"}],"discussion_count":2,"race_medal":0,"score":"108939936607","product_id":100020901,"comment_content":"有个问题： 买到的  【服务器带宽】理论上 &gt;=吞吐量。<br>我现在 手上的腾讯云服务器 ：网络带宽是 1M<br>但是经，wrk测试，网络吞吐量达到了4M,这是怎么一回事儿呢？<br>[root@VM_0_2_centos wrk]# wrk -c 1000 -t 2 http:&#47;&#47;localhost&#47;<br>Running 10s test @ http:&#47;&#47;localhost&#47;<br>  2 threads and 1000 connections<br>  Thread Stats   Avg      Stdev     Max   +&#47;- Stdev<br>    Latency   108.23ms   80.21ms   1.95s    97.68%<br>    Req&#47;Sec     2.54k     1.77k    5.87k    66.15%<br>  49587 requests in 10.06s, 40.20MB read<br>  Socket errors: connect 0, read 0, write 0, timeout 78<br>Requests&#47;sec:   4929.91<br>Transfer&#47;sec:      4.00MB","like_count":25,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462808,"discussion_content":"不要使用localhost测试网络，测试带宽要跨主机测试","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1566133286,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1246785,"avatar":"https://static001.geekbang.org/account/avatar/00/13/06/41/abb7bfe3.jpg","nickname":"meow","note":"","ucode":"BB7FBD681B5EFC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576769,"discussion_content":"是的 10m是外网带宽，localhost 是内网网卡，","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655782324,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":66941,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1550044998,"is_pvip":false,"replies":[{"id":"23707","content":"嗯，网络抖动是很常见的现象。可以考虑更多的接入点、专线、CDN 等等都可以优化公网的链路延迟问题","user_name":"作者回复","comment_id":66941,"uid":"1001282","ip_address":"","utype":1,"ctime":1550068855,"user_name_real":"倪朋飞"}],"discussion_count":2,"race_medal":0,"score":"70269521734","product_id":100020901,"comment_content":"[D36打卡]<br>想不到网络篇这么快就开始&quot;套路&quot;了😁<br>由于现在客户端的网络环境复杂,经常会出现部分用户反馈卡顿的情况.<br>我这边能做的也有限.<br>只能在第一个网路出入口,记录每次收发消息的内容和具体的时间戳(精确到ms).<br>遇到玩家反馈时,再根据玩家的唯一编号,及发生的大致时间,在日志中查找玩家的响应时间,来推测是服务器响应慢了,还是客户端到服务器中间的路线慢了.<br>有时甚至会让客户端主动汇报,上次发送请求和收到请求的时间间隔. 来验证是不是客户本身的网络环境导致的.<br>其实服务器端都有处理消息的耗时记录,平常几乎都没什么太耗时的状况发生.<br>遇到客户网络原因导致的延迟,只能说是新加入口,让客户端选择一个最优入口了.","like_count":16,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438986,"discussion_content":"嗯，网络抖动是很常见的现象。可以考虑更多的接入点、专线、CDN 等等都可以优化公网的链路延迟问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550068855,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1000515,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/44/43/abb7bfe3.jpg","nickname":"123","note":"","ucode":"61ED60FFFEDCB2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":176127,"discussion_content":"客户端埋探针，可以搞起来了 ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1582025316,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":184639,"user_name":"罗辑思维","can_delete":false,"product_type":"c1","uid":1318941,"ip_address":"","ucode":"D257A06EDE928E","user_header":"https://static001.geekbang.org/account/avatar/00/14/20/1d/0c1a184c.jpg","comment_is_top":false,"comment_ctime":1583376088,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"66007885528","product_id":100020901,"comment_content":"wrk 工具本身不提供 yum 或 apt 的安装方法，需要通过源码编译来安装。比如，你可以运行下面的命令，来编译和安装 ：<br>1 $ https:&#47;&#47;github.com&#47;wg&#47;wrk<br>2 $ cd wrk<br>3 $ apt-get install build-essential -y<br>4 $ make<br>5 $ sudo cp wrk &#47;usr&#47;local&#47;bin&#47;<br>--------------------------------------------<br>第一句命令「https:&#47;&#47;github.com&#47;wg&#47;wrk」应该是「git clone https:&#47;&#47;github.com&#47;wg&#47;wrk」。不然执行不了。","like_count":15,"discussions":[{"author":{"id":1970516,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLK4NPyaFDl4rzrd4A9z42tQDibFLdCicbrAdyUa5P2B5u8UCUBenpHX7VgUCibvHvhpza4icMBKVnhmA/132","nickname":"学无止境","note":"","ucode":"2C28E8E54DAB4E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":413556,"discussion_content":"补充的很到位，对初学者很友好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636511623,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78868,"user_name":"Maxwell","can_delete":false,"product_type":"c1","uid":1086275,"ip_address":"","ucode":"720A00AD472616","user_header":"https://static001.geekbang.org/account/avatar/00/10/93/43/0e84492d.jpg","comment_is_top":false,"comment_ctime":1553264401,"is_pvip":false,"replies":[{"id":"28739","content":"不是的，这只是说明了系统的网络吞吐没问题，但不代表应用的吞吐就没问题了。应用程序的吞吐也还是要测试的","user_name":"作者回复","comment_id":78868,"uid":"1001282","ip_address":"","utype":1,"ctime":1553315977,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"31618035473","product_id":100020901,"comment_content":"目前在公司做性能测试，我会首先使用iperf测试网络吞吐量，在局域网下，我会先开启少数线程(2个)进行压测，在测试结果报告中，查看消耗的带宽，再使用iperf的测试结果吞吐量对比，如果网络吞吐量没有瓶颈，那应用程序的性能就与网络无关了，这样理解对么？","like_count":7,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444267,"discussion_content":"不是的，这只是说明了系统的网络吞吐没问题，但不代表应用的吞吐就没问题了。应用程序的吞吐也还是要测试的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553315977,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68511,"user_name":"ninuxer","can_delete":false,"product_type":"c1","uid":1243135,"ip_address":"","ucode":"5394ADAF2667D6","user_header":"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKQMM4m7NHuicr55aRiblTSEWIYe0QqbpyHweaoAbG7j2v7UUElqqeP3Ihrm3UfDPDRb1Hv8LvPwXqA/132","comment_is_top":false,"comment_ctime":1550536493,"is_pvip":false,"replies":[{"id":"24377","content":"嗯 越往上层场景越多","user_name":"作者回复","comment_id":68511,"uid":"1001282","ip_address":"","utype":1,"ctime":1550570441,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"18730405677","product_id":100020901,"comment_content":"打卡day38<br>之前对应用做压测的场景多点，通过学习，又get了底层的压测的方法👍","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439711,"discussion_content":"嗯 越往上层场景越多","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550570441,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":251964,"user_name":"Geek_a16bbc","can_delete":false,"product_type":"c1","uid":2008721,"ip_address":"","ucode":"6F12AFEF638413","user_header":"","comment_is_top":false,"comment_ctime":1602002301,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"14486904189","product_id":100020901,"comment_content":"為什麼 64B 小包的处理能力，值得我们特别关注？","like_count":3,"discussions":[{"author":{"id":1543040,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/80/8702bd5f.jpg","nickname":"evan","note":"","ucode":"491B073D5AFEDE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318072,"discussion_content":"因为网络层就是用来转发包的 小包更能体现pps的性能","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1603635583,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1499362,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e0/e2/6054de3f.jpg","nickname":"*回眸*·wdlcoke","note":"","ucode":"8D5ECCD274601F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":565740,"discussion_content":"怎么看是大包还是小包","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650532592,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1068361,"avatar":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","nickname":"明翼","note":"","ucode":"E77F86BEB3D5C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541634,"discussion_content":"包越小，包个数越多，中断越多，系统处理起来压力也更大","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640492628,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":221363,"user_name":"LindaWang","can_delete":false,"product_type":"c1","uid":1800128,"ip_address":"","ucode":"45368868C3980B","user_header":"https://static001.geekbang.org/account/avatar/00/1b/77/c0/22872965.jpg","comment_is_top":false,"comment_ctime":1590482823,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"10180417415","product_id":100020901,"comment_content":"倪老师，我现在在用wrk做压测，只是做简单的query，但问题是，随着threads和connections参数越来越大，QPS并没有提升，反而有一些timeout了。此时，服务端的cpu&#47;IO都远远没有达到负载，此时，我该怎么办呢？会不会wrk压测工具本身没法达到很大的压力呢？","like_count":2,"discussions":[{"author":{"id":1515149,"avatar":"https://static001.geekbang.org/account/avatar/00/17/1e/8d/5b242931.jpg","nickname":"Fish","note":"","ucode":"C20719F8B0F7C8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312417,"discussion_content":"thread和connections不是越大越好","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1602680344,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1610552,"avatar":"https://static001.geekbang.org/account/avatar/00/18/93/38/71615300.jpg","nickname":"DayDayUp","note":"","ucode":"9C53659518AB74","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":574248,"discussion_content":"说不定大量的CPU用于调度和管理这么多threads和connections的调度管理了，反而用于真正处理请求的时候，忙不过来了。我是这么想的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653923014,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":125997,"user_name":"世事不可强求-快乐长存","can_delete":false,"product_type":"c1","uid":1317168,"ip_address":"","ucode":"DC061A196221DD","user_header":"https://static001.geekbang.org/account/avatar/00/14/19/30/2a92e423.jpg","comment_is_top":false,"comment_ctime":1566291102,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10156225694","product_id":100020901,"comment_content":"在对nginx进行压测的时候，系统的内核参数有没有需要改变的？比如说syncookie等","like_count":2},{"had_liked":false,"id":79015,"user_name":"Xiaobai","can_delete":false,"product_type":"c1","uid":1440182,"ip_address":"","ucode":"659CE28C9B0206","user_header":"https://static001.geekbang.org/account/avatar/00/15/f9/b6/e1d1db4c.jpg","comment_is_top":false,"comment_ctime":1553323256,"is_pvip":false,"replies":[{"id":"29353","content":"最简单的就是做压力测试","user_name":"作者回复","comment_id":79015,"uid":"1001282","ip_address":"","utype":1,"ctime":1553699431,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"10143257848","product_id":100020901,"comment_content":"4核8G 5M带宽服务器 服务跑一些商城 ，微信小程序 ，如何评估能承受多大的并发量","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444326,"discussion_content":"最简单的就是做压力测试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553699431,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295678,"user_name":"LH","can_delete":false,"product_type":"c1","uid":1211178,"ip_address":"","ucode":"819B9B2409E834","user_header":"https://static001.geekbang.org/account/avatar/00/12/7b/2a/7d8b5943.jpg","comment_is_top":false,"comment_ctime":1622540994,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5917508290","product_id":100020901,"comment_content":"内容精彩，感谢分享","like_count":1},{"had_liked":false,"id":159315,"user_name":"v_peng","can_delete":false,"product_type":"c1","uid":1751411,"ip_address":"","ucode":"04249952E8B484","user_header":"https://static001.geekbang.org/account/avatar/00/1a/b9/73/8c281399.jpg","comment_is_top":false,"comment_ctime":1575597967,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5870565263","product_id":100020901,"comment_content":"老师好， 有个问题请教， 文中说 http 请求的负载会影响到应用程序内部的处理逻辑， 从而影响测试结果， 这个影响意思是会增加请求的处理时间么？还是会优化服务器应用的处理？ 另外 wrk 的测试结果明显好于 ab 的测试结果， 能简单解释一下原因么？","like_count":1,"discussions":[{"author":{"id":1252173,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1b/4d/2cc44d9a.jpg","nickname":"刘忽悠","note":"","ucode":"095DE3A8D3F450","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293695,"discussion_content":"这里确实不理解，感觉按照文中的说法应该wrk因为有服务器端的业务，测出来的应该差才对","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595644617,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1778000,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/ncicjtgbOgxk2V3VWYJQAia6VqrvHE23JVGtkQALgl6XScQmdqmKZ5RXicfw0CQ4uMplhMeeYoSZNPggBRTpQLR1Q/132","nickname":"0xkjAlbert","note":"","ucode":"B607DA1230321F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1252173,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1b/4d/2cc44d9a.jpg","nickname":"刘忽悠","note":"","ucode":"095DE3A8D3F450","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":338956,"discussion_content":"因为是ab本身的性能导致的，比如nginx并发支持一万，但是ab发起连接最高一千，那么测试结果只能是一千，受ab本身性能限制","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1609454302,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":293695,"ip_address":""},"score":338956,"extra":""}]}]},{"had_liked":false,"id":83019,"user_name":"梦回汉唐","can_delete":false,"product_type":"c1","uid":1321581,"ip_address":"","ucode":"9C66E35165F813","user_header":"https://static001.geekbang.org/account/avatar/00/14/2a/6d/0e436c1c.jpg","comment_is_top":false,"comment_ctime":1554374458,"is_pvip":false,"replies":[{"id":"30191","content":"请参考第43、44期","user_name":"作者回复","comment_id":83019,"uid":"1001282","ip_address":"","utype":1,"ctime":1554639122,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"5849341754","product_id":100020901,"comment_content":"我想查看目标服务器的收包的情况，这个怎么在目标服务器上操作呢","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445821,"discussion_content":"请参考第43、44期","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554639122,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81819,"user_name":"挺直腰板","can_delete":false,"product_type":"c1","uid":1178397,"ip_address":"","ucode":"B7DD679A3A4EEB","user_header":"https://static001.geekbang.org/account/avatar/00/11/fb/1d/12c7c021.jpg","comment_is_top":false,"comment_ctime":1554042718,"is_pvip":false,"replies":[{"id":"29842","content":"查一下网卡名，看看是不是eth0？换成正确的应该就可以了","user_name":"作者回复","comment_id":81819,"uid":"1001282","ip_address":"","utype":1,"ctime":1554210452,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"5849010014","product_id":100020901,"comment_content":"倪老师，你上面的脚本运行后，提示“cat: &#47;proc&#47;net&#47;pktgen&#47;eth0: 没有那个文件或目录”系统是cetnos7.0,请问如何处理。","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445358,"discussion_content":"查一下网卡名，看看是不是eth0？换成正确的应该就可以了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554210452,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353055,"user_name":"肥low","can_delete":false,"product_type":"c1","uid":1043480,"ip_address":"陕西","ucode":"A158AFAAB8C742","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ec/18/bf7254d3.jpg","comment_is_top":false,"comment_ctime":1659096227,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1659096227","product_id":100020901,"comment_content":"刚刚用到了wrk，主要是测试api 也就是测试web服务的性能 通过简单的lua脚本模拟不同用户的请求 其它没看…","like_count":0},{"had_liked":false,"id":336853,"user_name":"return","can_delete":false,"product_type":"c1","uid":1135528,"ip_address":"","ucode":"42B8A3380DF04B","user_header":"https://static001.geekbang.org/account/avatar/00/11/53/a8/abc96f70.jpg","comment_is_top":false,"comment_ctime":1646402037,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646402037","product_id":100020901,"comment_content":"“PPS 通常用来评估网络的转发能力，而基于 Linux 服务器的转发，很容易受到网络包大小的影响(交换机通常不会受到太大影响，即交换机可以线性转发)”<br>请教老师， 为什么 交换机的 pps 不会受到 包大小 太大影响。 按道理 转发速率是固定的，包大的化，自然每秒转发的包就少了。 <br>网上实在是查不到 交换机关于包大小这方面的资料。","like_count":0},{"had_liked":false,"id":325794,"user_name":"kubxy","can_delete":false,"product_type":"c1","uid":1514411,"ip_address":"","ucode":"EDA317D303CC42","user_header":"https://static001.geekbang.org/account/avatar/00/17/1b/ab/a5f88914.jpg","comment_is_top":false,"comment_ctime":1639132382,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1639132382","product_id":100020901,"comment_content":"“现在的多核服务器和万兆网卡已经很普遍了，稍做优化就可以达到数百万的 PPS”<br><br>老师，我按照您的方法，使用pktgen在线下物理机环境和线上云环境（阿里给出的性能是200万PPS）测试PPS，测试的结果都是20万。这是因为pktgen只用了一个内核线程（我尝试将eth0绑定到多个pktgen内核线程，但提示设备busy。）吗？还是说我的系统需要优化？","like_count":0},{"had_liked":false,"id":313820,"user_name":"简简单单就是幸福","can_delete":false,"product_type":"c1","uid":2740779,"ip_address":"","ucode":"A08080E6FD255F","user_header":"https://static001.geekbang.org/account/avatar/00/29/d2/2b/af13fcd6.jpg","comment_is_top":false,"comment_ctime":1632700159,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1632700159","product_id":100020901,"comment_content":"老师，请教下，“因为用户请求往往会附带着各种各种的负载（payload），而这些负载会影响 Web 应用程序内部的处理逻辑，从而影响最终性能“。     用户请求附带各种负载，可以形象一点吗，具体指哪些呢？","like_count":0,"discussions":[{"author":{"id":1081299,"avatar":"https://static001.geekbang.org/account/avatar/00/10/7f/d3/b5896293.jpg","nickname":"Realm","note":"","ucode":"30CBEBE619D1A2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550699,"discussion_content":"查数据库等","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644675666,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":304406,"user_name":"ghostwritten","can_delete":false,"product_type":"c1","uid":1308196,"ip_address":"","ucode":"AE512F2E24A1A0","user_header":"https://static001.geekbang.org/account/avatar/00/13/f6/24/5a9277f1.jpg","comment_is_top":false,"comment_ctime":1627391936,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627391936","product_id":100020901,"comment_content":"1.带宽，表示链路的最大传输速率，单位是 b&#47;s（比特 &#47; 秒）<br>2.吞吐量，表示没有丢包时的最大数据传输速率，单位通常为 b&#47;s （比特 &#47; 秒）或者 B&#47;s（字节 &#47;<br>   秒）<br>3.延时，表示从网络请求发出后，一直到收到远端响应，所需要的时间延迟<br>4.PPS，是 Packet Per Second（包 &#47; 秒）的缩写，表示以网络包为单位的传输速率<br>5.hping3 是SYN 攻击的工具，也是一个测试网络包处理能力的性能工具<br>6.pktgen 内核自带的高性能网络测试工具<br>modprobe pktgen<br>ls &#47;proc&#47;net&#47;pktgen&#47;<br>7.iperf 、netperf、iperf3 都是最常用的网络性能测试工具，测试 TCP 和 UDP 的吞吐量<br>server: iperf3 -s -i 1 -p 10000<br>client: iperf3 -c 192.168.0.30 -b 1G -t 15 -P 2 -p 10000<br>8.  ab -c 1000 -n 10000 http:&#47;&#47;192.168.0.30&#47;<br>9. wrk是一个 HTTP 性能测试工具<br>wrk -c 1000 -t 2 http:&#47;&#47;192.168.0.30&#47;","like_count":0},{"had_liked":false,"id":297281,"user_name":"coconut","can_delete":false,"product_type":"c1","uid":2344081,"ip_address":"","ucode":"07B95C7A6AC2F7","user_header":"https://static001.geekbang.org/account/avatar/00/23/c4/91/a017bf72.jpg","comment_is_top":false,"comment_ctime":1623403289,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1623403289","product_id":100020901,"comment_content":"pktgen 只能发udp包？","like_count":0},{"had_liked":false,"id":271306,"user_name":"学生监狱","can_delete":false,"product_type":"c1","uid":1007240,"ip_address":"","ucode":"CA9510F6211FCF","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/AkcVibvqux0qrKFbV7skQvQfHsl96tu9HTSaromQyzf7OOSacoorSDreBNbwOdlBeOrKr3Alc1zle66wKkibrL5g/132","comment_is_top":false,"comment_ctime":1609533414,"is_pvip":true,"discussion_count":2,"race_medal":0,"score":"1609533414","product_id":100020901,"comment_content":"PPS 就是 1000Mbit 除以以太网帧的大小，即 1000Mbps&#47;((64+20)*8bit) = 1.5 Mpps（其中，20B 为以太网帧前导和帧间距的大小）。 <br>这里是不是算错了，Result: OK: 8320027(c8249354+d70673) usec, 1000000 (64byte,0frags) 这里结果明明写的byte,怎么和20B直接相加了？","like_count":0,"discussions":[{"author":{"id":1499362,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e0/e2/6054de3f.jpg","nickname":"*回眸*·wdlcoke","note":"","ucode":"8D5ECCD274601F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":565741,"discussion_content":"20B 的B 就是byte 吧 20b b是bit 我是这么理解的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650532852,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1081299,"avatar":"https://static001.geekbang.org/account/avatar/00/10/7f/d3/b5896293.jpg","nickname":"Realm","note":"","ucode":"30CBEBE619D1A2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550700,"discussion_content":"64+20： 是按网络层最小包大小64B，链路层帧头+帧尾20B","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644675782,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":251113,"user_name":"baymax-me","can_delete":false,"product_type":"c1","uid":2192263,"ip_address":"","ucode":"989494AB215DE7","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ7Fd19uVrF8TbBxKrOMV18HwFGP0BxmrRdRW4WgORhagvqFeG49Cia2Jx9kiafZsLMXId8dg0aLhibQ/132","comment_is_top":false,"comment_ctime":1601367623,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601367623","product_id":100020901,"comment_content":"老师，使用Linux 内核自带的高性能网络测试工具pktgen，一台发包机器，一台目标机器；在发包机器上跑脚本，然后也是在发包机器上使用cat &#47;proc&#47;net&#47;pktgen&#47;eth0来查看proc文件。想请教老师的一个问题是： 该测试测的是发包机器的转发性能还是目标机器的转发性能呢？在线等！！！","like_count":0},{"had_liked":false,"id":241850,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1597466363,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597466363","product_id":100020901,"comment_content":"各种测试工具都用了一遍过瘾！","like_count":0},{"had_liked":false,"id":236976,"user_name":"幻之羽翼😀😁😆😅","can_delete":false,"product_type":"c1","uid":1109762,"ip_address":"","ucode":"4AAFF3B421713D","user_header":"https://static001.geekbang.org/account/avatar/00/10/ef/02/904aa83f.jpg","comment_is_top":false,"comment_ctime":1595635628,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595635628","product_id":100020901,"comment_content":"大佬 ，压力测试20台服务器到23万并发就上不去了，求调优参数","like_count":0},{"had_liked":false,"id":219688,"user_name":"Damoncui","can_delete":false,"product_type":"c1","uid":1566446,"ip_address":"","ucode":"5F09EB267F0572","user_header":"https://static001.geekbang.org/account/avatar/00/17/e6/ee/8fdbd5db.jpg","comment_is_top":false,"comment_ctime":1590064260,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590064260","product_id":100020901,"comment_content":"有点吃力啦~ 不过还是很淋漓尽致~<br>加油~ 打卡 D8~","like_count":0},{"had_liked":false,"id":199313,"user_name":"南山","can_delete":false,"product_type":"c1","uid":1119593,"ip_address":"","ucode":"94656FE4A6C378","user_header":"https://static001.geekbang.org/account/avatar/00/11/15/69/187b9968.jpg","comment_is_top":false,"comment_ctime":1585486554,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1585486554","product_id":100020901,"comment_content":"知道性能指标，知道要优化的目标，结合合适的工具来验证，接口性能调优的套路也类似~","like_count":0},{"had_liked":false,"id":188296,"user_name":"gg","can_delete":false,"product_type":"c1","uid":1225252,"ip_address":"","ucode":"363A9671D9469F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJUYHWnZz9BGSq0wduPwAULAT0ENpwibnTByqFHhZTcgUlicYr6bvUlo0no1icOmamoHu9oyniaYHaaqA/132","comment_is_top":false,"comment_ctime":1584336665,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584336665","product_id":100020901,"comment_content":"打卡：<br>虽然目前工作还用不到这些、但是通过学习可以将底层知识串联起来","like_count":0},{"had_liked":false,"id":180122,"user_name":"Ljian","can_delete":false,"product_type":"c1","uid":1079486,"ip_address":"","ucode":"481E4BAEAA666C","user_header":"https://static001.geekbang.org/account/avatar/00/10/78/be/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1582192047,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582192047","product_id":100020901,"comment_content":"问题1：做应用层的性能测试的时候，测试链路一般是怎样的？<br>* 测试工具 —&gt; 外网 —&gt; 负载均衡器 —&gt; 应用<br>* 测试工具 —&gt; 负载均衡器 —&gt; 应用<br>* 测试工具 —&gt; 应用<br><br>问题2：一般来说并发数和线程数，需要根据上面来定？","like_count":0},{"had_liked":false,"id":177441,"user_name":"soimage","can_delete":false,"product_type":"c1","uid":1011400,"ip_address":"","ucode":"82FC2D560616D2","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6e/c8/ed2926b5.jpg","comment_is_top":false,"comment_ctime":1581392900,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1581392900","product_id":100020901,"comment_content":"请问 C10K 中的单机，是什么配置的服务器？","like_count":0,"discussions":[{"author":{"id":1121758,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","nickname":"aoe","note":"","ucode":"1C6201EDB4E954","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312036,"discussion_content":"上世纪90年代的服务器配置，2G内存","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602569782,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":173124,"user_name":"小花","can_delete":false,"product_type":"c1","uid":1401483,"ip_address":"","ucode":"BFF0A1A59FD35D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/umxqic2CHGySYhT47Rz03ePCloIZ7X21dCLZMVo82m2gjhJdJVqYt3AOdZUXg1roTNSRibkj2g5eia76cbFdxjliag/132","comment_is_top":false,"comment_ctime":1579428505,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579428505","product_id":100020901,"comment_content":"客户端：<br>&gt;iperf3 -c 10.8.7.16  -b 1m -t 15 -p 8080<br>Connecting to host 10.8.7.16, port 8080<br>[  4] local 10.20.0.48 port 58029 connected to 10.8.7.16 port 8080<br>[ ID] Interval           Transfer     Bandwidth<br>[  4]   0.00-1.00   sec   256 KBytes  2.10 Mbits&#47;sec<br>[  4]   1.00-2.00   sec   768 KBytes  6.28 Mbits&#47;sec<br>...<br>[  4]  12.00-13.00  sec   896 KBytes  7.34 Mbits&#47;sec<br>[  4]  13.00-14.00  sec   896 KBytes  7.34 Mbits&#47;sec<br>[  4]  14.00-15.00  sec   768 KBytes  6.29 Mbits&#47;sec<br><br>[ ID] Interval           Transfer     Bandwidth<br>[  4]   0.00-15.00  sec  9.88 MBytes  5.52 Mbits&#47;sec                  sender<br>[  4]   0.00-15.00  sec  9.88 MBytes  5.52 Mbits&#47;sec                  receiver<br><br>iperf Done.<br><br>服务端：<br>[ ID] Interval           Transfer     Bandwidth<br>[ 10]   0.00-1.00   sec  91.3 KBytes   748 Kbits&#47;sec                  <br>[ 10]   1.00-2.00   sec   677 KBytes  5.54 Mbits&#47;sec                  <br>[ 10]   2.00-3.00   sec   768 KBytes  6.29 Mbits&#47;sec                  <br>[ 10]   3.00-4.00   sec   896 KBytes  7.34 Mbits&#47;sec                  <br>...              <br>[ 10]  12.00-13.00  sec   896 KBytes  7.34 Mbits&#47;sec                  <br>[ 10]  13.00-14.00  sec   896 KBytes  7.34 Mbits&#47;sec                  <br>[ 10]  14.00-15.00  sec   768 KBytes  6.29 Mbits&#47;sec                  <br>[ 10]  15.00-15.22  sec   256 KBytes  9.72 Mbits&#47;sec                  <br><br>[ ID] Interval           Transfer     Bandwidth<br>[ 10]   0.00-15.22  sec  0.00 Bytes  0.00 bits&#47;sec                  sender<br>[ 10]   0.00-15.22  sec  9.88 MBytes  5.44 Mbits&#47;sec                  receiver<br>-----------------------------------------------------------<br>Server listening on 8080<br>-----------------------------------------------------------<br><br>请问这个测试结果是看最后2行么？<br>客户端带宽是5.52 Mbits&#47;sec ,服务端是 5.44 Mbits&#47;sec?<br>这个是最大带宽么？<br><br>","like_count":0},{"had_liked":false,"id":166679,"user_name":"大土豆","can_delete":false,"product_type":"c1","uid":1121636,"ip_address":"","ucode":"67445DC3EC9DB0","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/64/52a5863b.jpg","comment_is_top":false,"comment_ctime":1577542574,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1577542574","product_id":100020901,"comment_content":"老师，5种网络I &#47; O 中，还有一个信号驱动I&#47; O ，可以说下使用场景吗？也是边缘触发","like_count":0},{"had_liked":false,"id":158473,"user_name":"tech1","can_delete":false,"product_type":"c1","uid":1659886,"ip_address":"","ucode":"95D3457819C68A","user_header":"https://static001.geekbang.org/account/avatar/00/19/53/ee/bad231da.jpg","comment_is_top":false,"comment_ctime":1575379459,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575379459","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":140580,"user_name":"懵懂的Java","can_delete":false,"product_type":"c1","uid":1312151,"ip_address":"","ucode":"19D3BE0AA1410B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELTaqicWVpIsOpha9icy6LLJrrd24lGlwsBYhBTkBUdGHIGFXRbyZicNbSafvhMATDBjX6NSGLam9bag/132","comment_is_top":false,"comment_ctime":1571011329,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1571011329","product_id":100020901,"comment_content":"老师你好，像tcp和http我理解最后的性能好坏不也得取决于用户和服务器之间的网络是否畅通吗。光钎和普通以太网肯定结果也不一样吧。","like_count":0,"discussions":[{"author":{"id":1778000,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/ncicjtgbOgxk2V3VWYJQAia6VqrvHE23JVGtkQALgl6XScQmdqmKZ5RXicfw0CQ4uMplhMeeYoSZNPggBRTpQLR1Q/132","nickname":"0xkjAlbert","note":"","ucode":"B607DA1230321F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":338957,"discussion_content":"肯定是默认畅通的情况的，如果不畅通，是客户端的问题的话请求到不了服务端，服务端的问题就需要跟机房，运营商沟通解决了。光纤和双绞线网线都可以保证畅通，只是带宽和延迟可能略有不同，而这个时间消耗占比一般比在运营商链路中小的多，所以默认是畅通的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609454743,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":137727,"user_name":"辉晖","can_delete":false,"product_type":"c1","uid":1574062,"ip_address":"","ucode":"E5EC033EE4952B","user_header":"https://static001.geekbang.org/account/avatar/00/18/04/ae/0118c132.jpg","comment_is_top":false,"comment_ctime":1569831540,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569831540","product_id":100020901,"comment_content":"底层协议是其上的各层网络协议的基础。可以理解成：越高层，性能测试的结果就越“差”?<br>按照老师的案例，如果HTTP层选用了合适的工具，那么测试结果就应该比使用wrk来的好？","like_count":0},{"had_liked":false,"id":136316,"user_name":"乖，摸摸头","can_delete":false,"product_type":"c1","uid":1611745,"ip_address":"","ucode":"BD92741A11D3CD","user_header":"https://static001.geekbang.org/account/avatar/00/18/97/e1/0f4d90ff.jpg","comment_is_top":false,"comment_ctime":1569407850,"is_pvip":true,"discussion_count":3,"race_medal":0,"score":"1569407850","product_id":100020901,"comment_content":"我云服务器15M的带宽，咋测试出来吞吐率这么低<br>[root@node1 ~]# wrk -c 1000 -t 2 http:&#47;&#47;m.xxxx.com<br>Running 10s test @ http:&#47;&#47;m.yupao.com<br>  2 threads and 1000 connections<br>  Thread Stats   Avg      Stdev     Max   +&#47;- Stdev<br>    Latency     1.27s   320.93ms   1.99s    62.96%<br>    Req&#47;Sec    42.03     58.53   290.00     87.69%<br>  313 requests in 10.05s, 8.82MB read<br>  Socket errors: connect 0, read 0, write 0, timeout 97<br>  Non-2xx or 3xx responses: 268<br>Requests&#47;sec:     31.15<br>Transfer&#47;sec:      0.88MB<br>只有0.88M","like_count":0,"discussions":[{"author":{"id":1290469,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Um0fKCDsGBRStZBF1M4HLPSq8jiancnNoYKiaYyYldFX0NObkyUFmnVKTgjm6Y7wUiaCQ3Vm9Ic213l65kJfUzq4w/132","nickname":"Geek_c92584","note":"","ucode":"D9DA02DA718977","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":205429,"discussion_content":"测试中逐步加并发量，如果增加并发量也没改观，就改为本地网络压测，看是否网络时延导致瓶颈","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584304391,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1611745,"avatar":"https://static001.geekbang.org/account/avatar/00/18/97/e1/0f4d90ff.jpg","nickname":"乖，摸摸头","note":"","ucode":"BD92741A11D3CD","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":21039,"discussion_content":"差距为啥会这么大","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569415362,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1611745,"avatar":"https://static001.geekbang.org/account/avatar/00/18/97/e1/0f4d90ff.jpg","nickname":"乖，摸摸头","note":"","ucode":"BD92741A11D3CD","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":21038,"discussion_content":"是不是该这样算    15*1024/8 =1920KB/s =1.875M这是理论值，0.88M为实际值？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569415342,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":123766,"user_name":"。。。。","can_delete":false,"product_type":"c1","uid":1370981,"ip_address":"","ucode":"E724186A3F957A","user_header":"https://static001.geekbang.org/account/avatar/00/14/eb/65/6c4fbdd9.jpg","comment_is_top":false,"comment_ctime":1565753975,"is_pvip":false,"replies":[{"id":"45971","content":"跨主机测试试试？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1566133305,"ip_address":"","comment_id":123766,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1565753975","product_id":100020901,"comment_content":"老师 ，没明白这里的吞吐量和实际的带宽大小有什么区别呢？<br>我的服务器带宽大小是1M，但是用wrk测试网络吞吐量达到了4M？为什么会超出实际的带宽大小呢？<br>[root@VM_0_2_centos wrk]# wrk -c 1000 -t 2 http:&#47;&#47;localhost&#47;<br>Running 10s test @ http:&#47;&#47;localhost&#47;<br>  2 threads and 1000 connections<br>  Thread Stats   Avg      Stdev     Max   +&#47;- Stdev<br>    Latency   108.23ms   80.21ms   1.95s    97.68%<br>    Req&#47;Sec     2.54k     1.77k    5.87k    66.15%<br>  49587 requests in 10.06s, 40.20MB read<br>  Socket errors: connect 0, read 0, write 0, timeout 78<br>Requests&#47;sec:   4929.91<br>Transfer&#47;sec:      4.00MB","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462806,"discussion_content":"跨主机测试试试？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566133305,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":123473,"user_name":"你认不出来我","can_delete":false,"product_type":"c1","uid":1315516,"ip_address":"","ucode":"81772397576E38","user_header":"https://static001.geekbang.org/account/avatar/00/14/12/bc/2f2e165a.jpg","comment_is_top":false,"comment_ctime":1565684052,"is_pvip":false,"replies":[{"id":"45973","content":"从客户端和服务器端同时抓包，就可以看出区别了。这里很肯能是从客户端到服务器的连接慢了","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1566133685,"ip_address":"","comment_id":123473,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1565684052","product_id":100020901,"comment_content":"老师，请教一下，我现在有个服务压测的时候从服务端看到服务端从接到网络请求到处理完成只用了 5ms； 但是从客户端看耗时 75 分位都有 400ms， 我用 iperf 测试吞吐量也没有问题，所以请教一下老师有没有什么查这个问题的思路呢？ ","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462690,"discussion_content":"从客户端和服务器端同时抓包，就可以看出区别了。这里很肯能是从客户端到服务器的连接慢了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566133685,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81231,"user_name":"null","can_delete":false,"product_type":"c1","uid":1462466,"ip_address":"","ucode":"67DE98FA6DAEBF","user_header":"","comment_is_top":false,"comment_ctime":1553836819,"is_pvip":false,"replies":[{"id":"29584","content":"目标机内部可以观测到的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1554003150,"ip_address":"","comment_id":81231,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553836819","product_id":100020901,"comment_content":"老师你好，有点疑问请老师解答一下，在用pktgen 的测试中，貌似只能测出发包机器的发包吞吐量吧？因为发包机没法感知到目标机是否真的处理了这个包，还是直接在网卡就被丢了。如果想测试目标机的吞吐量应该怎么弄呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445124,"discussion_content":"目标机内部可以观测到的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554003150,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":80475,"user_name":"如果","can_delete":false,"product_type":"c1","uid":1320638,"ip_address":"","ucode":"138A3EEEE50850","user_header":"","comment_is_top":false,"comment_ctime":1553665840,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553665840","product_id":100020901,"comment_content":"DAY36，打卡<br>","like_count":0},{"had_liked":false,"id":77999,"user_name":"💖李京潼💖","can_delete":false,"product_type":"c1","uid":1284775,"ip_address":"","ucode":"8337BC784D9674","user_header":"https://static001.geekbang.org/account/avatar/00/13/9a/a7/51cf1a9e.jpg","comment_is_top":false,"comment_ctime":1553051577,"is_pvip":false,"replies":[{"id":"29354","content":"这是纯应用的东西了，没有具体细节不好推荐","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553699566,"ip_address":"","comment_id":77999,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553051577","product_id":100020901,"comment_content":"老师我这有个问题想请教一下，基于webservice 接口，对于需要多session， 每个session有多个请求，并且这些请求按照先后顺序有依赖关系，上个请求响应结果作为下个请求包的内容，用哪种开源工具更合适呢？谢谢","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443930,"discussion_content":"这是纯应用的东西了，没有具体细节不好推荐","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553699566,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":75921,"user_name":"Griffin","can_delete":false,"product_type":"c1","uid":1087329,"ip_address":"","ucode":"CF766B92A65261","user_header":"https://static001.geekbang.org/account/avatar/00/10/97/61/34a0da09.jpg","comment_is_top":false,"comment_ctime":1552491794,"is_pvip":false,"replies":[{"id":"28054","content":"设置测试数据的吞吐量，也就是 iperf3 自己发出的测试包该用多大的带宽。在文档里还有更详细的介绍，你可以man看看","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1552750178,"ip_address":"","comment_id":75921,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1552491794","product_id":100020901,"comment_content":"请问用iperf3测试tcp&#47;udp时这个-b的目标带宽是指啥？ 是预估该网络有1G的带宽么？<br>iperf3 -c 192.168.0.30 -b 1G -t 15 -P 2 -p 10000","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443091,"discussion_content":"设置测试数据的吞吐量，也就是 iperf3 自己发出的测试包该用多大的带宽。在文档里还有更详细的介绍，你可以man看看","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552750178,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":75913,"user_name":"Griffin","can_delete":false,"product_type":"c1","uid":1087329,"ip_address":"","ucode":"CF766B92A65261","user_header":"https://static001.geekbang.org/account/avatar/00/10/97/61/34a0da09.jpg","comment_is_top":false,"comment_ctime":1552490804,"is_pvip":false,"replies":[{"id":"28053","content":"对的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1552750046,"ip_address":"","comment_id":75913,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1552490804","product_id":100020901,"comment_content":"老师， 请问在测试PPS的案例中， 我写错了IP和mac地址，但是pkts-sofar还是1000000 呢？ 这个是只测试发送不看返回值么？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443086,"discussion_content":"对的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552750046,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":75552,"user_name":"MJ","can_delete":false,"product_type":"c1","uid":1237145,"ip_address":"","ucode":"FCEC0C21444D2A","user_header":"https://static001.geekbang.org/account/avatar/00/12/e0/99/5d603697.jpg","comment_is_top":false,"comment_ctime":1552434250,"is_pvip":false,"replies":[{"id":"28040","content":"可以直接粘贴到SHELL运行，保存到脚本里也可以的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1552748754,"ip_address":"","comment_id":75552,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1552434250","product_id":100020901,"comment_content":"# 定义一个工具函数，方便后面配置各种测试选项<br>function pgset() {<br>    local result<br>    echo $1 &gt; $PGDEV<br><br>    result=`cat $PGDEV | fgrep &quot;Result: OK:&quot;`<br>    if [ &quot;$result&quot; = &quot;&quot; ]; then<br>         cat $PGDEV | fgrep Result:<br>    fi<br>}<br><br># 为 0 号线程绑定 eth0 网卡<br>PGDEV=&#47;proc&#47;net&#47;pktgen&#47;kpktgend_0<br>pgset &quot;rem_device_all&quot;   # 清空网卡绑定<br>pgset &quot;add_device eth0&quot;  # 添加 eth0 网卡<br><br># 配置 eth0 网卡的测试选项<br>PGDEV=&#47;proc&#47;net&#47;pktgen&#47;eth0<br>pgset &quot;count 1000000&quot;    # 总发包数量<br>pgset &quot;delay 5000&quot;       # 不同包之间的发送延迟 (单位纳秒)<br>pgset &quot;clone_skb 0&quot;      # SKB 包复制<br>pgset &quot;pkt_size 64&quot;      # 网络包大小<br>pgset &quot;dst 192.168.0.30&quot; # 目的 IP<br>pgset &quot;dst_mac 11:11:11:11:11:11&quot;  # 目的 MAC<br><br># 启动测试<br>PGDEV=&#47;proc&#47;net&#47;pktgen&#47;pgctrl<br>pgset &quot;start&quot;<br><br><br>老师，这段是vi一个文件保存成脚步吗？<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442937,"discussion_content":"可以直接粘贴到SHELL运行，保存到脚本里也可以的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552748754,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69302,"user_name":"划时代","can_delete":false,"product_type":"c1","uid":1061454,"ip_address":"","ucode":"9554CE2F83B77F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/2o1Izf2YyJSnnI0ErZ51pYRlnrmibqUTaia3tCU1PjMxuwyXSKOLUYiac2TQ5pd5gNGvS81fVqKWGvDsZLTM8zhWg/132","comment_is_top":false,"comment_ctime":1550714276,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1550714276","product_id":100020901,"comment_content":"打卡总结。","like_count":0},{"had_liked":false,"id":68017,"user_name":"🍀 🍀 🍀 🐼","can_delete":false,"product_type":"c1","uid":1252056,"ip_address":"","ucode":"1D22FEE1E50117","user_header":"https://static001.geekbang.org/account/avatar/00/13/1a/d8/4a051faa.jpg","comment_is_top":false,"comment_ctime":1550387897,"is_pvip":false,"replies":[{"id":"24367","content":"看场景的，没有统一的数值。并且跟语言其实没关系，如果架构合理的话，即便是py也可以做到很高的rps。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550569283,"ip_address":"","comment_id":68017,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550387897","product_id":100020901,"comment_content":"像老师文档里的例子 作为应用服务器 完成http请求的业务 rps一般来说多少算是合格呢？尤其是像py这种并发能力不算优秀的语言来说","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439472,"discussion_content":"看场景的，没有统一的数值。并且跟语言其实没关系，如果架构合理的话，即便是py也可以做到很高的rps。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550569283,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":67852,"user_name":"腾达","can_delete":false,"product_type":"c1","uid":1079876,"ip_address":"","ucode":"72F9CFBA44FDEE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL9hlAIKQ1sGDu16oWLOHyCSicr18XibygQSMLMjuDvKk73deDlH9aMphFsj41WYJh121aniaqBLiaMNg/132","comment_is_top":false,"comment_ctime":1550299838,"is_pvip":false,"replies":[{"id":"24052","content":"我们这里有一个简单的介绍了，再系统的话要去参考下它的官方文档 https:&#47;&#47;iperf.fr&#47;","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550326744,"ip_address":"","comment_id":67852,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550299838","product_id":100020901,"comment_content":"“特别是现在的云计算时代，在你刚拿到一批虚拟机时，首先要做的，应该就是用 iperf ，测试一下网络性能是否符合预期”  这个东西还有比较有系统的介绍吗？ 或者一些博客推荐？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439401,"discussion_content":"我们这里有一个简单的介绍了，再系统的话要去参考下它的官方文档 https://iperf.fr/","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550326744,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":67536,"user_name":"Leon📷","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1550194236,"is_pvip":false,"replies":[{"id":"24037","content":"你这里的 tcp_wmem 和  tcp_rmem 太小了，是不是设置错误？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550325667,"ip_address":"","comment_id":67536,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550194236","product_id":100020901,"comment_content":"老师。我前几天测试局域网三台机器高并发修改了参数<br>&#47;etc&#47;security&#47;limits.conf<br>* soft  nofile  102400<br>* hard  nofile  102400<br>&#47;etc&#47;sysctl.conf<br>net.ipv4.tcp_mem = 252144 524288 786432<br>net.ipv4.tcp_wmem = 2048 2048 4096<br>net.ipv4.tcp_rmem = 2048 2048 4096<br>fs.file-max = 1048576<br>测试结束后没有改回去，修改之前三台机器之间ping值是0.3ms左右，公网下载速度300KB&#47;s左右，<br>修改后公网下载速度是30KB&#47;s,请问这是缓冲区的锅吗","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439234,"discussion_content":"你这里的 tcp_wmem 和  tcp_rmem 太小了，是不是设置错误？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550325667,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":67441,"user_name":"王崧霁","can_delete":false,"product_type":"c1","uid":1317115,"ip_address":"","ucode":"4F3284634293A8","user_header":"https://static001.geekbang.org/account/avatar/00/14/18/fb/c1334976.jpg","comment_is_top":false,"comment_ctime":1550147578,"is_pvip":false,"replies":[{"id":"24033","content":"👍 全链路监控是个大话题","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550325249,"ip_address":"","comment_id":67441,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550147578","product_id":100020901,"comment_content":"做全链路监控","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439197,"discussion_content":"👍 全链路监控是个大话题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550325249,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":67146,"user_name":"black_mirror","can_delete":false,"product_type":"c1","uid":1320092,"ip_address":"","ucode":"2549C87298BF12","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM4z9WYWVvWDhMF0SicPE5ad56ME6DibyWGbRoQa0lH4U9icdsjNcv3ssRickcuRMDA01e6vMXnmOVSr9l5LVUefVxicn/132","comment_is_top":false,"comment_ctime":1550104107,"is_pvip":false,"replies":[{"id":"24025","content":"就是共享的呀，内存模块又该复习了😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550324388,"ip_address":"","comment_id":67146,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550104107","product_id":100020901,"comment_content":"倪老师 <br>请问linux系统下怎么查看进程的每个线程占用多少内存那？top -Hp 看到线程内存与进程一样，看起来它们是共享的","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439080,"discussion_content":"就是共享的呀，内存模块又该复习了😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550324388,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":66798,"user_name":"Enterprize","can_delete":false,"product_type":"c1","uid":1215130,"ip_address":"","ucode":"3C120E9023B6C5","user_header":"https://static001.geekbang.org/account/avatar/00/12/8a/9a/7270d764.jpg","comment_is_top":false,"comment_ctime":1550022898,"is_pvip":false,"replies":[{"id":"23708","content":"如果是现象还在的话，抓个包就可以看出来。不过，最好还是加上各层的延迟监控，这样可以看到历史的情况","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550068932,"ip_address":"","comment_id":66798,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550022898","product_id":100020901,"comment_content":"有时会遇到偶然性的api请求响应慢，这种问题排查的思路是怎样的呢，怎么确定是网络抖动还是服务器配置就有问题？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438916,"discussion_content":"如果是现象还在的话，抓个包就可以看出来。不过，最好还是加上各层的延迟监控，这样可以看到历史的情况","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550068932,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}