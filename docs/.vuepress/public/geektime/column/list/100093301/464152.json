{"id":464152,"title":"24 | æ–‡æœ¬åˆ†ç±»ï¼šå¦‚ä½•ä½¿ç”¨BERTæ„å»ºæ–‡æœ¬åˆ†ç±»æ¨¡å‹ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æ–¹è¿œã€‚</p><p>åœ¨ç¬¬22èŠ‚è¯¾æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†ä¸å°‘æ–‡æœ¬å¤„ç†æ–¹é¢çš„ç†è®ºï¼Œå…¶å®æ–‡æœ¬åˆ†ç±»åœ¨æœºå™¨å­¦ä¹ é¢†åŸŸçš„åº”ç”¨ä¹Ÿéå¸¸å¹¿æ³›ã€‚</p><p>æ¯”å¦‚è¯´ä½ ç°åœ¨æ˜¯ä¸€ä¸ªNLPç ”å‘å·¥ç¨‹å¸ˆï¼Œè€æ¿å•ªåœ°ä¸€ä¸‹ç”©ç»™ä½ ä¸€å¤§å †æ–°é—»æ–‡æœ¬æ•°æ®ï¼Œå®ƒä»¬å¯èƒ½æ¥æºäºä¸åŒçš„é¢†åŸŸï¼Œæ¯”å¦‚ä½“è‚²ã€æ”¿æ²»ã€ç»æµã€ç¤¾ä¼šç­‰ç±»å‹ã€‚è¿™æ—¶æˆ‘ä»¬å°±éœ€è¦å¯¹æ–‡æœ¬åˆ†ç±»å¤„ç†ï¼Œæ–¹ä¾¿ç”¨æˆ·å¿«é€ŸæŸ¥è¯¢è‡ªå·±æ„Ÿå…´è¶£çš„å†…å®¹ï¼Œç”šè‡³æŒ‰ç”¨æˆ·çš„éœ€è¦å®šå‘æ¨èæŸç±»å†…å®¹ã€‚</p><p>è¿™æ ·çš„éœ€æ±‚å°±éå¸¸é€‚åˆç”¨PyTorch + BERTå¤„ç†ã€‚ä¸ºä»€ä¹ˆä¼šé€‰æ‹©BERTå‘¢ï¼Ÿå› ä¸ºBERTæ˜¯æ¯”è¾ƒå…¸å‹çš„æ·±åº¦å­¦ä¹ NLPç®—æ³•æ¨¡å‹ï¼Œä¹Ÿæ˜¯ä¸šç•Œä½¿ç”¨æœ€å¹¿æ³›çš„æ¨¡å‹ä¹‹ä¸€ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä¸€èµ·æ¥æ­å»ºè¿™ä¸ªæ–‡æœ¬åˆ†ç±»æ¨¡å‹ï¼Œç›¸ä¿¡æˆ‘ï¼Œå®ƒçš„æ•ˆæœè¡¨ç°éå¸¸å¼ºæ‚ã€‚</p><h2>é—®é¢˜èƒŒæ™¯ä¸åˆ†æ</h2><p>æ­£å¼åŠ¨æ‰‹ä¹‹å‰ï¼Œæˆ‘ä»¬ä¸å¦¨å›é¡¾ä¸€ä¸‹å†å²ã€‚æ–‡æœ¬åˆ†ç±»é—®é¢˜æœ‰å¾ˆå¤šç»å…¸è§£å†³åŠæ³•ã€‚</p><p>å¼€å§‹æ—¶å°±æ˜¯æœ€ç®€å•ç²—æš´çš„å…³é”®è¯ç»Ÿè®¡æ–¹æ³•ã€‚ä¹‹ååˆæœ‰äº†åŸºäºè´å¶æ–¯æ¦‚ç‡çš„åˆ†ç±»æ–¹æ³•ï¼Œé€šè¿‡æŸäº›æ¡ä»¶å‘ç”Ÿçš„æ¦‚ç‡æ¨æ–­æŸä¸ªç±»åˆ«çš„æ¦‚ç‡å¤§å°ï¼Œå¹¶ä½œä¸ºæœ€ç»ˆåˆ†ç±»çš„å†³ç­–ä¾æ®ã€‚å°½ç®¡è¿™ä¸ªæ€æƒ³å¾ˆç®€å•ï¼Œä½†æ˜¯æ„ä¹‰é‡å¤§ï¼Œæ—¶è‡³ä»Šæ—¥ï¼Œè´å¶æ–¯æ–¹æ³•ä»æ—§æ˜¯éå¸¸å¤šåº”ç”¨åœºæ™¯ä¸‹çš„å¥½é€‰æ‹©ã€‚</p><p>ä¹‹åè¿˜æœ‰æ”¯æŒå‘é‡æœºï¼ˆSVMï¼‰ï¼Œå¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œå…¶å˜ä½“å’Œåº”ç”¨éƒ½åœ¨NLPç®—æ³•åº”ç”¨çš„é—®é¢˜åœºæ™¯ä¸‹å æ®ç»Ÿæ²»åœ°ä½ã€‚</p><p>éšç€è®¡ç®—è®¾å¤‡æ€§èƒ½çš„æå‡ã€æ–°çš„ç®—æ³•ç†è®ºçš„äº§ç”Ÿç­‰è¿›æ­¥ï¼Œä¸€å¤§æ‰¹çš„è¯¸å¦‚éšæœºæ£®æ—ã€LDAä¸»é¢˜æ¨¡å‹ã€ç¥ç»ç½‘ç»œç­‰æ–¹æ³•çº·çº·æ¶Œç°ï¼Œå¯è°“ç™¾å®¶äº‰é¸£ã€‚</p><!-- [[[read_end]]] --><p>æ—¢ç„¶æœ‰è¿™ä¹ˆå¤šæ–¹æ³•ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œæˆ‘ä»¬è¿™é‡Œæ¨èé€‰ç”¨BERTå‘¢ï¼Ÿ</p><p>å› ä¸ºåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå°¤å…¶æ˜¯ä¸€äº›å¤æ‚åœºæ™¯ä¸‹çš„æ–‡æœ¬ï¼ŒåƒBERTè¿™æ ·å…·æœ‰å¼ºå¤§å¤„ç†èƒ½åŠ›çš„å·¥å…·æ‰èƒ½åº”å¯¹ã€‚æ¯”å¦‚è¯´æ–°é—»æ–‡æœ¬å°±ä¸å¥½åˆ†ç±»ï¼Œå› ä¸ºå®ƒå­˜åœ¨åé¢è¿™äº›é—®é¢˜ã€‚</p><p>1.<strong>ç±»åˆ«å¤š</strong>ã€‚åœ¨æ–°é—»èµ„è®¯Appä¸­ï¼Œæ–°é—»çš„ç§ç±»æ˜¯éå¸¸å¤šçš„ï¼Œéœ€è¦äº§å“ç»ç†æŒ‰ç…§ç»Ÿè®¡ã€å®ç”¨çš„åŸåˆ™è¿›è¡Œæ–‡ç« åˆ†ç±»ä½“ç³»çš„è®¾è®¡ï¼Œä½¿å…¶ç±»åˆ«èƒ½å¤Ÿè¦†ç›–æ‰€æœ‰çš„æ–‡æœ¬ï¼Œä¸€èˆ¬æ¥è¯´éƒ½æœ‰50ç§ç”šè‡³ä»¥ä¸Šã€‚ä¸è¿‡ä¸ºäº†è®©ä½ æŠŠæ¡é‡ç‚¹ï¼Œå’±ä»¬å…ˆç®€åŒ–é—®é¢˜ï¼Œå‡å®šæ–‡æœ¬çš„åˆ†ç±»ä½“ç³»å·²ç»ç¡®å®šã€‚</p><p>2.<strong>æ•°æ®ä¸å¹³è¡¡</strong>ã€‚ä¸éš¾ç†è§£ï¼Œåœ¨æ–°é—»ä¸­ï¼Œç¤¾ä¼šã€ç»æµã€ä½“è‚²ã€å¨±ä¹ç­‰ç±»åˆ«çš„æ–‡ç« æ•°é‡ç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒå¤šçš„ï¼Œå æ®äº†å¾ˆå¤§çš„æ¯”ä¾‹ï¼›è€Œå°‘å„¿ã€åŒ»ç–—ç­‰ç±»åˆ«åˆ™ç›¸å¯¹è¾ƒå°‘ï¼Œæœ‰çš„æ—¶å€™ä¸€å¤©ä¹Ÿæ²¡æœ‰å‡ ç¯‡å¯¹åº”çš„æ–‡ç« ã€‚</p><p>3.<strong>å¤šè¯­è¨€ã€‚</strong>ä¸€èˆ¬æ¥è¯´ï¼Œå’±ä»¬ä¸»è¦çš„è¯­è¨€é™¤äº†ä¸­æ–‡ï¼Œåº”è¯¥æ˜¯å¤§å¤šæ•°äººåªä¼šè‹±è¯­äº†ï¼Œä¸è¿‡ä¸ºäº†è€ƒè™‘åˆ°æ–°é—»æ¥æºçš„å¹¿æ³›æ€§ï¼Œå’±ä»¬ä¹Ÿå‡å®šè¿™æ‰¹æ–‡æœ¬æ˜¯å¤šè¯­è¨€çš„ã€‚</p><p>åˆšæ‰æåˆ°äº†ï¼Œå› ä¸ºBertæ˜¯æ¯”è¾ƒå…¸å‹çš„æ·±åº¦å­¦ä¹ NLPç®—æ³•æ¨¡å‹ï¼Œä¹Ÿæ˜¯ä¸šç•Œä½¿ç”¨æœ€å¹¿æ³›çš„æ¨¡å‹ä¹‹ä¸€ã€‚å¦‚æœæ‹¿ä¸‹è¿™ä¹ˆæœ‰ä»£è¡¨æ€§çš„æ¨¡å‹ï¼Œä»¥åä½ å­¦ä¹ å’Œä½¿ç”¨åŸºäºAttentionçš„æ¨¡å‹ä½ ä¹Ÿèƒ½ä¸¾ä¸€åä¸‰ï¼Œæ¯”å¦‚GPTç­‰ã€‚</p><p>æƒ³è¦ç”¨å¥½BERTï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£å®ƒæœ‰å“ªäº›ç‰¹ç‚¹ã€‚</p><h2>BERTåŸç†ä¸ç‰¹ç‚¹åˆ†æ</h2><p>BERTçš„å…¨ç§°æ˜¯Bidirectional Encoder Representation from Transformersï¼Œå³åŒå‘Transformerçš„Encoderã€‚ä½œä¸ºä¸€ç§åŸºäºAttentionæ–¹æ³•çš„æ¨¡å‹ï¼Œå®ƒæœ€å¼€å§‹å‡ºç°çš„æ—¶å€™å¯ä»¥è¯´æ˜¯æŠ¢å°½äº†é£å¤´ï¼Œåœ¨æ–‡æœ¬åˆ†ç±»ã€è‡ªåŠ¨å¯¹è¯ã€è¯­ä¹‰ç†è§£ç­‰åå‡ é¡¹NLPä»»åŠ¡ä¸Šæ‹¿åˆ°äº†å†å²æœ€å¥½æˆç»©ã€‚</p><p>åœ¨<a href=\"https://time.geekbang.org/column/article/461691\">ç¬¬22èŠ‚è¯¾</a>ï¼ˆå¦‚æœä¸ç†Ÿæ‚‰å¯ä»¥å›çœ‹ï¼‰ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†Attentionçš„åŸºæœ¬åŸç†ï¼Œæœ‰äº†è¿™ä¸ªçŸ¥è¯†åšåŸºç¡€ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å°±èƒ½å¿«é€ŸæŒæ¡BERTçš„åŸç†ã€‚</p><p>è¿™é‡Œæˆ‘å†å¿«é€Ÿç»™ä½ å›é¡¾ä¸€ä¸‹ï¼ŒBERTçš„ç†è®ºæ¡†æ¶ä¸»è¦æ˜¯åŸºäºè®ºæ–‡ã€ŠAttention is all you needã€‹ä¸­æå‡ºçš„Transformerï¼Œè€Œåè€…çš„åŸç†åˆ™æ˜¯åˆšæ‰æåˆ°çš„Attentionã€‚<strong>å…¶æœ€ä¸ºæ˜æ˜¾çš„ç‰¹ç‚¹ï¼Œå°±æ˜¯æ‘’å¼ƒäº†ä¼ ç»Ÿçš„RNNå’ŒCNNé€»è¾‘ï¼Œæœ‰æ•ˆè§£å†³äº†NLPä¸­çš„é•¿æœŸä¾èµ–é—®é¢˜ã€‚</strong></p><p><img src=\"https://static001.geekbang.org/resource/image/57/e7/57129ea84051eaf5985535dcb97c1fe7.jpg?wh=1920x1269\" alt=\"å›¾ç‰‡\" title=\"å›¾ç‰‡æ¥æºï¼šhttps://arxiv.org/abs/1706.03762\"></p><p>åœ¨BERTä¸­ï¼Œå®ƒçš„è¾“å…¥éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯å›¾ç‰‡çš„å·¦è¾¹ï¼Œå…¶å®æ˜¯ç”±Nä¸ªå¤šå¤´Attentionç»„åˆè€Œæˆã€‚å¤šå¤´Attentionæ˜¯å°†æ¨¡å‹åˆ†ä¸ºå¤šä¸ªå¤´ï¼Œå½¢æˆå¤šä¸ªå­ç©ºé—´ï¼Œå¯ä»¥è®©æ¨¡å‹å»å…³æ³¨ä¸åŒæ–¹é¢çš„ä¿¡æ¯ï¼Œè¿™æœ‰åŠ©äºç½‘ç»œæ•æ‰åˆ°æ›´ä¸°å¯Œçš„ç‰¹å¾æˆ–è€…ä¿¡æ¯ã€‚ï¼ˆå…·ä½“åŸç†ï¼Œä¸€å®šè¦æŸ¥é˜…<a href=\"https://arxiv.org/abs/1706.03762\">ã€ŠAttention is all you needã€‹</a>å“¦ï¼‰ã€‚</p><p>ç»“åˆä¸Šå›¾æˆ‘ä»¬è¦æ³¨æ„çš„æ˜¯ï¼ŒBERTé‡‡ç”¨äº†åŸºäºMLMçš„æ¨¡å‹è®­ç»ƒæ–¹å¼ï¼Œå³Mask Language Modelã€‚å› ä¸ºBERTæ˜¯Transformerçš„ä¸€éƒ¨åˆ†ï¼Œå³encoderç¯èŠ‚ï¼Œæ‰€ä»¥æ²¡æœ‰decoderçš„éƒ¨åˆ†ï¼ˆå…¶å®å°±æ˜¯GPTï¼‰ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒMLMæ–¹å¼åº”è¿è€Œç”Ÿã€‚å®ƒçš„æ€æƒ³ä¹Ÿéå¸¸ç®€å•ï¼Œå°±æ˜¯åœ¨<strong>è®­ç»ƒä¹‹å‰ï¼Œéšæœºå°†æ–‡æœ¬ä¸­ä¸€éƒ¨åˆ†çš„è¯è¯­ï¼ˆtokenï¼‰è¿›è¡Œå±è”½ï¼ˆmaskï¼‰ï¼Œç„¶ååœ¨è®­ç»ƒçš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨å…¶ä»–æ²¡æœ‰è¢«å±è”½çš„tokenå¯¹è¢«å±è”½çš„tokenè¿›è¡Œé¢„æµ‹</strong>ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/ae/84/aeed42d94750436f1dyye31f92c96584.jpg?wh=1920x700\" alt=\"å›¾ç‰‡\"></p><p>ç”¨è¿‡Word2Vecçš„å°ä¼™ä¼´åº”è¯¥æ¯”è¾ƒæ¸…æ¥šï¼Œåœ¨Word2Vecä¸­ï¼Œå¯¹äºåŒä¸€ä¸ªè¯è¯­ï¼Œå®ƒçš„å‘é‡è¡¨ç¤ºæ˜¯å›ºå®šçš„ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆä¼šæœ‰é‚£ä¸ªç»å…¸çš„â€œ<em>å›½ç‹-ç”·äºº+å¥³äºº=çš‡å</em>â€è®¡ç®—å¼äº†ã€‚</p><p>ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œâ€œè‹¹æœâ€è¿™ä¸ªè¯ï¼Œæœ‰å¯èƒ½æ˜¯æ°´æœçš„è‹¹æœï¼Œä¹Ÿå¯èƒ½æ˜¯ç”µå­äº§å“çš„å“ç‰Œï¼Œå¦‚æœè¿˜æ˜¯ç”¨åŒä¸€ä¸ªå‘é‡è¡¨ç¤ºï¼Œè¿™æ ·å°±æœ‰å¯èƒ½äº§ç”Ÿåå·®ã€‚è€Œåœ¨BERTä¸­åˆ™ä¸ä¸€æ ·ï¼Œæ ¹æ®ä¸Šä¸‹æ–‡çš„ä¸åŒï¼Œå¯¹äºåŒä¸€ä¸ªtokenç»™å‡ºçš„è¯å‘é‡æ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œæ›´åŠ çµæ´»ã€‚</p><p>æ­¤å¤–ï¼ŒBERTè¿˜æœ‰å¤šè¯­è¨€çš„ä¼˜åŠ¿ã€‚åœ¨ä»¥å‰çš„ç®—æ³•ä¸­ï¼Œæ¯”å¦‚SVMï¼Œå¦‚æœè¦åšå¤šè¯­è¨€çš„æ¨¡å‹ï¼Œå°±è¦æ¶‰åŠåˆ†è¯ã€æå–å…³é”®è¯ç­‰æ“ä½œï¼Œè€Œè¿™äº›æ“ä½œè¦æ±‚ä½ å¯¹è¯¥è¯­è¨€æœ‰æ‰€äº†è§£ã€‚åƒé˜¿æ‹‰ä¼¯æ–‡ã€æ—¥è¯­ç­‰è¯­è¨€ï¼Œå’±ä»¬å¤§æ¦‚ç‡æ˜¯çœ‹ä¸æ‡‚çš„ï¼Œè¿™ä¼šå¯¹æˆ‘ä»¬æœ€åçš„æ¨¡å‹æ•ˆæœäº§ç”Ÿæå¤§å½±å“ã€‚</p><p>BERTåˆ™ä¸éœ€è¦æ‹…å¿ƒè¿™ä¸ªé—®é¢˜ï¼Œé€šè¿‡åŸºäºå­—ç¬¦ã€å­—ç¬¦ç‰‡æ®µã€å•è¯ç­‰ä¸åŒç²’åº¦çš„tokenè¦†ç›–å¹¶ä½œWordPieceï¼Œèƒ½å¤Ÿè¦†ç›–ä¸Šç™¾ç§è¯­è¨€ï¼Œç”šè‡³å¯ä»¥è¯´ï¼Œåªè¦ä½ èƒ½å¤Ÿå‘æ˜å‡ºä¸€ç§é€»è¾‘ä¸Šè‡ªæ´½çš„è¯­è¨€ï¼ŒBERTå°±èƒ½å¤Ÿå¤„ç†ã€‚æœ‰å…³WordPieceçš„ä»‹ç»ï¼Œä½ å¯ä»¥é€šè¿‡<a href=\"https://paperswithcode.com/method/wordpiece\">è¿™é‡Œ</a>åšæ‹“å±•é˜…è¯»ã€‚</p><p>å¥½ï¼Œè¯´äº†è¿™ä¹ˆå¤šï¼Œé›†é«˜æ•ˆã€å‡†ç¡®ã€çµæ´»å†åŠ ä¸Šç”¨é€”å¹¿æ³›äºä¸€ä½“çš„BERTï¼Œè‡ªç„¶è€Œç„¶å°±æˆä¸ºäº†å’±ä»¬çš„é¦–é€‰ï¼Œä¸‹é¢å’±ä»¬å¼€å§‹æ­£å¼æ„å»ºä¸€ä¸ªæ–‡æœ¬åˆ†ç±»æ¨¡å‹ã€‚</p><h2>å®‰è£…ä¸å‡†å¤‡</h2><p>å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ï¼Œåœ¨å¼€å§‹æ„å»ºæ¨¡å‹ä¹‹å‰ï¼Œæˆ‘ä»¬è¦å®‰è£…ç›¸åº”çš„å·¥å…·ï¼Œç„¶åä¸‹è½½å¯¹åº”çš„é¢„å…ˆè®­ç»ƒå¥½çš„æ¨¡å‹ï¼ŒåŒæ—¶è¿˜è¦äº†è§£æ•°æ®çš„æ ¼å¼ã€‚</p><h3>ç¯å¢ƒå‡†å¤‡</h3><p>å› ä¸ºå’±ä»¬è¦åšçš„æ˜¯ä¸€ä¸ªåŸºäºPyTorch çš„BERTæ¨¡å‹ï¼Œé‚£ä¹ˆå°±è¦å®‰è£…å¯¹åº”çš„pythonåŒ…ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©çš„æ˜¯hugging faceçš„PyTorchç‰ˆæœ¬çš„TransformersåŒ…ã€‚ä½ å¯ä»¥é€šè¿‡pipå‘½ä»¤ç›´æ¥å®‰è£…ã€‚</p><pre><code>pip install Transformers\n</code></pre><h3>æ¨¡å‹å‡†å¤‡</h3><p>å®‰è£…ä¹‹åï¼Œæˆ‘ä»¬æ‰“å¼€Transformersçš„<a href=\"https://github.com/huggingface/transformers\">gité¡µé¢</a>ï¼Œå¹¶æ‰¾åˆ°å¦‚ä¸‹çš„æ–‡ä»¶å¤¹ã€‚</p><pre><code class=\"language-plain\">src/Transformers/models/BERT\n</code></pre><p>ä»è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸¤ä¸ªå¾ˆé‡è¦çš„æ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯convert_BERT_original_tf2_checkpoint_to_PyTorch.pyå’Œmodeling_BERT.pyæ–‡ä»¶ã€‚</p><p>å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼Œä½ çœ‹çœ‹åå­—ï¼Œæ˜¯ä¸æ˜¯å°±èƒ½çŒœå‡ºæ¥ï¼Œå®ƒå¤§æ¦‚æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„äº†ï¼Ÿæ²¡é”™ï¼Œå°±æ˜¯ç”¨æ¥å°†åŸæ¥é€šè¿‡TensorfFlowé¢„è®­ç»ƒçš„æ¨¡å‹è½¬æ¢ä¸ºPyTorchçš„æ¨¡å‹ã€‚</p><p>ç„¶åæ˜¯modeling_BERT.pyæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å®é™…ä¸Šæ˜¯ç»™äº†ä½ ä¸€ä¸ªä½¿ç”¨BERTçš„èŒƒä¾‹ã€‚</p><p>ä¸‹é¢ï¼Œå’±ä»¬å¼€å§‹å‡†å¤‡æ¨¡å‹ï¼Œæ‰“å¼€<a href=\"https://github.com/tensorflow/models/tree/master/official/nlp/bert\">è¿™ä¸ªåœ°å€</a>ï¼Œä½ ä¼šå‘ç°åœ¨è¿™ä¸ªé¡µé¢ä¸­ï¼Œæœ‰å‡ ä¸ªé¢„è®­ç»ƒå¥½çš„æ¨¡å‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f7/a9/f7429816e9c736d99be4b55c67bac6a9.png?wh=1920x956\" alt=\"å›¾ç‰‡\"></p><p>å¯¹ç…§è¿™èŠ‚è¯¾çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬é€‰æ‹©çš„æ˜¯â€œBERT-Base, Multilingual Casedâ€çš„ç‰ˆæœ¬ã€‚ä»GitHubçš„ä»‹ç»å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªç‰ˆæœ¬çš„checkpointæ”¯æŒ104ç§è¯­è¨€ï¼Œæ˜¯ä¸æ˜¯å¾ˆå‰å®³ï¼Ÿå½“ç„¶ï¼Œå¦‚æœä½ æ²¡æœ‰å¤šè¯­è¨€çš„éœ€æ±‚ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–ç‰ˆæœ¬çš„ï¼Œå®ƒä»¬çš„åŒºåˆ«ä¸»è¦æ˜¯ç½‘ç»œçš„ä½“ç§¯ä¸åŒã€‚</p><p>è½¬æ¢å®Œæ¨¡å‹ä¹‹åï¼Œä½ ä¼šå‘ç°ä½ çš„æœ¬åœ°å¤šäº†ä¸‰ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯config.jsonã€pytorch_model.binå’Œvocab.txtã€‚æˆ‘æ¥åˆ†åˆ«ç»™ä½ è¯´ä¸€è¯´ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a8/00/a85bfecfb02108cf7e46d5bef74efe00.jpg?wh=1920x228\" alt=\"å›¾ç‰‡\"></p><p>1.config.jsonï¼šé¡¾åæ€ä¹‰ï¼Œè¯¥æ–‡ä»¶å°±æ˜¯BERTæ¨¡å‹çš„é…ç½®æ–‡ä»¶ï¼Œé‡Œé¢è®°å½•äº†æ‰€æœ‰ç”¨äºè®­ç»ƒçš„å‚æ•°è®¾ç½®ã€‚</p><p>2.PyTorch_model.binï¼šæ¨¡å‹æ–‡ä»¶æœ¬èº«ã€‚</p><p>3.vocab.txtï¼šè¯è¡¨æ–‡ä»¶ã€‚å°½ç®¡BERTå¯ä»¥å¤„ç†ä¸€ç™¾å¤šç§è¯­è¨€ï¼Œä½†æ˜¯å®ƒä»æ—§éœ€è¦è¯è¡¨æ–‡ä»¶ç”¨äºè¯†åˆ«æ‰€æ”¯æŒè¯­è¨€çš„å­—ç¬¦ã€å­—ç¬¦ä¸²æˆ–è€…å•è¯ã€‚</p><h3>æ ¼å¼å‡†å¤‡</h3><p>ç°åœ¨æ¨¡å‹å‡†å¤‡å¥½äº†ï¼Œæˆ‘ä»¬è¿˜è¦çœ‹çœ‹è·Ÿæ¨¡å‹åŒ¹é…çš„æ ¼å¼ã€‚BERTçš„è¾“å…¥ä¸ç®—å¤æ‚ï¼Œä½†æ˜¯ä¹Ÿéœ€è¦äº†è§£å…¶å½¢å¼ã€‚åœ¨è®­ç»ƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬è¾“å…¥çš„æ•°æ®ä¸èƒ½æ˜¯ç›´æ¥æŠŠè¯å¡åˆ°æ¨¡å‹é‡Œï¼Œè€Œæ˜¯è¦è½¬åŒ–æˆåé¢è¿™ä¸‰ç§å‘é‡ã€‚</p><p>1.<strong>Token embeddings</strong>ï¼šè¯å‘é‡ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒToken embeddingsçš„ç¬¬ä¸€ä¸ªå¼€å¤´çš„tokenä¸€å®šå¾—æ˜¯â€œ[CLS]â€ã€‚[CLS]ä½œä¸ºæ•´ç¯‡æ–‡æœ¬çš„è¯­ä¹‰è¡¨ç¤ºï¼Œç”¨äºæ–‡æœ¬åˆ†ç±»ç­‰ä»»åŠ¡ã€‚</p><p>2.<strong>Segment embeddings</strong>ã€‚è¿™ä¸ªå‘é‡ä¸»è¦æ˜¯ç”¨æ¥å°†ä¸¤å¥è¯è¿›è¡ŒåŒºåˆ†ï¼Œæ¯”å¦‚é—®ç­”ä»»åŠ¡ï¼Œä¼šæœ‰é—®å¥å’Œç­”å¥åŒæ—¶è¾“å…¥ï¼Œè¿™å°±éœ€è¦ä¸€ä¸ªèƒ½å¤ŸåŒºåˆ†ä¸¤å¥è¯çš„æ“ä½œã€‚ä¸è¿‡åœ¨å’±ä»¬æ­¤æ¬¡çš„åˆ†ç±»ä»»åŠ¡ä¸­ï¼Œåªæœ‰ä¸€ä¸ªå¥å­ã€‚</p><p>3.<strong>Position embeddings</strong>ã€‚è®°å½•äº†å•è¯çš„ä½ç½®ä¿¡æ¯ã€‚</p><h2>æ¨¡å‹æ„å»º</h2><p>å‡†å¤‡å·¥ä½œå·²ç»ä¸€åˆ‡å°±ç»ªï¼Œæˆ‘ä»¬è¿™å°±æ¥æ­å»ºä¸€ä¸ªåŸºäºBERTçš„æ–‡æœ¬åˆ†ç±»ç½‘ç»œæ¨¡å‹ã€‚è¿™åŒ…æ‹¬äº†<strong>ç½‘ç»œçš„è®¾è®¡ã€é…ç½®ã€ä»¥åŠæ•°æ®å‡†å¤‡ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿæ˜¯å’±ä»¬çš„æ ¸å¿ƒè¿‡ç¨‹</strong>ã€‚</p><h3>ç½‘ç»œè®¾è®¡</h3><p>ä»ä¸Šé¢æåˆ°çš„modeling_BERT.pyæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä½œè€…å®é™…ä¸Šå·²ç»ç»™æˆ‘ä»¬æä¾›äº†å¾ˆå¤šç§ç±»çš„NLPä»»åŠ¡çš„ç¤ºä¾‹ä»£ç ï¼Œå’±ä»¬æ‰¾åˆ°å…¶ä¸­çš„â€œBERTForSequenceClassificationâ€ï¼Œè¿™ä¸ªåˆ†ç±»ç½‘ç»œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œå®ƒä¹Ÿæ˜¯æœ€æœ€åŸºç¡€çš„BERTæ–‡æœ¬åˆ†ç±»çš„æµç¨‹ã€‚</p><p>è¿™ä¸ªè¿‡ç¨‹åŒ…æ‹¬äº†åˆ©ç”¨<strong>BERTå¾—åˆ°æ–‡æœ¬çš„embeddingè¡¨ç¤º</strong>ã€<strong>å°†embeddingæ”¾å…¥å…¨è¿æ¥å±‚å¾—åˆ°åˆ†ç±»ç»“æœ</strong>ä¸¤éƒ¨åˆ†ã€‚æˆ‘ä»¬å…·ä½“çœ‹ä¸€ä¸‹ä»£ç ã€‚</p><pre><code class=\"language-python\">class BERTForSequenceClassification(BERTPreTrainedModel):\n    def __init__(self, config):\n        super().__init__(config)\n        self.num_labels = config.num_labels//ç±»åˆ«æ ‡ç­¾æ•°é‡\n        self.bert = BertModel(config)\n        self.dropout = nn.Dropout(config.hidden_dropout_prob)//è¿˜è®°å¾—Dropoutæ˜¯ç”¨æ¥åšä»€ä¹ˆçš„å—ï¼Ÿå¯¹ï¼Œå¯ä»¥ä¸€å®šç¨‹åº¦é˜²æ­¢è¿‡æ‹Ÿåˆã€‚\n        self.classifier = nn.Linear(config.hidden_size, config.num_labels)//BERTè¾“å‡ºçš„embeddingä¼ å…¥ä¸€ä¸ªMLPå±‚åšåˆ†ç±»ã€‚\n        self.init_weights()\n\n    def forward(\n        self,\n        input_ids=None,\n        attention_mask=None,\n        token_type_ids=None,\n        position_ids=None,\n        head_mask=None,\n        inputs_embeds=None,\n        labels=None,\n        output_attentions=None,\n        output_hidden_states=None,\n        return_dict=None,\n    ):\n        outputs = self.bert(\n            input_ids,\n            attention_mask=attention_mask,\n            token_type_ids=token_type_ids,\n            position_ids=position_ids,\n            head_mask=head_mask,\n            inputs_embeds=inputs_embeds,\n            output_attentions=output_attentions,\n            output_hidden_states=output_hidden_states,\n            return_dict=return_dict,\n        )\n\n        pooled_output = outputs[1]//è¿™ä¸ªå°±æ˜¯ç»è¿‡BERTå¾—åˆ°çš„ä¸­é—´è¾“å‡ºã€‚\n\n        pooled_output = self.dropout(pooled_output)//å¯¹ï¼Œå°±æ˜¯ä¸ºäº†å‡å°‘è¿‡æ‹Ÿåˆå’Œå¢åŠ ç½‘ç»œçš„å¥å£®æ€§ã€‚\n        logits = self.classifier(pooled_output)//å¤šå±‚MLPè¾“å‡ºæœ€åçš„åˆ†ç±»ç»“æœã€‚\n\n</code></pre><p>å¯¹ç…§å‰é¢çš„ä»£ç ï¼Œå¯ä»¥å‘ç°ï¼Œæ¥æ”¶åˆ°è¾“å…¥ä¿¡æ¯ä¹‹åï¼ŒBERTè¿”å›äº†ä¸€ä¸ªoutputsï¼ŒoutputsåŒ…æ‹¬äº†æ¨¡å‹è®¡ç®—ä¹‹åçš„å…¨éƒ¨ç»“æœï¼Œä¸ä»…æœ‰æ¯ä¸ªtokençš„ä¿¡æ¯ï¼Œä¹Ÿæœ‰æ•´ä¸ªæ–‡æœ¬çš„ä¿¡æ¯ï¼Œè¿™ä¸ªè¾“å‡ºå…·ä½“åŒ…æ‹¬ä»¥ä¸‹ä¿¡æ¯ã€‚</p><p>last_hidden_stateæ˜¯æ¨¡å‹æœ€åä¸€å±‚è¾“å‡ºçš„éšè—å±‚çŠ¶æ€åºåˆ—ã€‚shapeæ˜¯(batch_size, sequence_length, hidden_size)ã€‚å…¶ä¸­hidden_size=768ï¼Œè¿™ä¸ªéƒ¨åˆ†çš„çŠ¶æ€ï¼Œå°±ç›¸å½“äºåˆ©ç”¨sequence_length * 768ç»´åº¦çš„çŸ©é˜µï¼Œè®°å½•äº†æ•´ä¸ªæ–‡æœ¬çš„è®¡ç®—ä¹‹åçš„æ¯ä¸€ä¸ªtokençš„ç»“æœä¿¡æ¯ã€‚</p><p>pooled_outputï¼Œä»£è¡¨åºåˆ—çš„ç¬¬ä¸€ä¸ªtokençš„æœ€åä¸€ä¸ªéšè—å±‚çš„çŠ¶æ€ã€‚shapeæ˜¯(batch_size, hidden_size)ã€‚æ‰€è°“çš„ç¬¬ä¸€ä¸ªtokenï¼Œå°±æ˜¯å’±ä»¬åˆšæ‰æåˆ°çš„[CLS]æ ‡ç­¾ã€‚</p><p>é™¤äº†ä¸Šé¢ä¸¤ä¸ªä¿¡æ¯ï¼Œè¿˜æœ‰hidden_statesã€attentionsã€cross attentionsã€‚æœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å»æŸ¥ä¸€ä¸‹ï¼Œå®ƒä»¬æœ‰ä½•ç”¨é€”ã€‚</p><p>é€šå¸¸çš„ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬ç”¨å¾—æ¯”è¾ƒå¤šçš„æ˜¯last_hidden_stateå¯¹åº”çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨pooled_output = outputs[1]æ¥è¿›è¡Œè·å–ã€‚</p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†ç»è¿‡BERTè®¡ç®—çš„æ–‡æœ¬å‘é‡è¡¨ç¤ºï¼Œç„¶åæˆ‘ä»¬å°†å…¶è¾“å…¥åˆ°ä¸€ä¸ªlinearå±‚ä¸­è¿›è¡Œåˆ†ç±»ï¼Œå°±å¯ä»¥å¾—åˆ°æœ€åçš„åˆ†ç±»ç»“æœäº†ã€‚<strong>ä¸ºäº†æé«˜æ¨¡å‹çš„è¡¨ç°ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šåœ¨linearå±‚ä¹‹å‰ï¼ŒåŠ å…¥ä¸€ä¸ªdropoutå±‚ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ç½‘ç»œçš„è¿‡æ‹Ÿåˆçš„å¯èƒ½æ€§ï¼ŒåŒæ—¶å¢å¼ºç¥ç»å…ƒçš„ç‹¬ç«‹æ€§</strong>ã€‚</p><h3>æ¨¡å‹é…ç½®</h3><p>è®¾è®¡å¥½ç½‘ç»œï¼Œæˆ‘ä»¬è¿˜è¦å¯¹æ¨¡å‹è¿›è¡Œé…ç½®ã€‚è¿˜è®°å¾—åˆšæ‰æåˆ°çš„config.jsonæ–‡ä»¶ä¹ˆï¼Ÿè¿™é‡Œé¢å°±è®°å½•äº†BERTæ¨¡å‹æ‰€éœ€çš„æ‰€æœ‰é…ç½®ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å…¶ä¸­çš„å‡ ä¸ªå†…å®¹è¿›è¡Œè°ƒæ•´ï¼Œè¿™æ ·æ¨¡å‹å°±èƒ½çŸ¥é“æˆ‘ä»¬åˆ°åº•æ˜¯è¦åšä»€ä¹ˆäº‹æƒ…äº†ã€‚</p><p>åé¢è¿™å‡ ä¸ªå­—æ®µæˆ‘ä¸“é—¨è¯´ä¸€ä¸‹ã€‚</p><ul>\n<li>id2labelï¼šè¿™ä¸ªå­—æ®µè®°å½•äº†ç±»åˆ«æ ‡ç­¾å’Œç±»åˆ«åç§°çš„æ˜ å°„å…³ç³»ã€‚</li>\n<li>label2idï¼šè¿™ä¸ªå­—æ®µè®°å½•äº†ç±»åˆ«åç§°å’Œç±»åˆ«æ ‡ç­¾çš„æ˜ å°„å…³ç³»ã€‚</li>\n<li>num_labels_cateï¼šç±»åˆ«çš„æ•°é‡ã€‚</li>\n</ul><h2>æ•°æ®å‡†å¤‡</h2><p>æ¨¡å‹ç½‘ç»œè®¾è®¡å¥½äº†ï¼Œé…ç½®æ–‡ä»¶ä¹Ÿæå®šäº†ï¼Œä¸‹é¢æˆ‘ä»¬å°±è¦å¼€å§‹æ•°æ®å‡†å¤‡è¿™ä¸€æ­¥äº†ã€‚è¿™é‡Œçš„æ•°æ®å‡†å¤‡æ˜¯æŒ‡å°†æ–‡æœ¬è½¬æ¢ä¸ºBERTèƒ½å¤Ÿè¯†åˆ«çš„å½¢å¼ï¼Œå³å‰é¢æåˆ°çš„ä¸‰ç§å‘é‡ï¼Œåœ¨ä»£ç ä¸­ï¼Œå¯¹åº”çš„å°±æ˜¯input_idsã€token_type_idsã€attention_maskã€‚</p><p>ä¸ºäº†ç”Ÿæˆè¿™äº›æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦åœ¨gitä¸­æ‰¾åˆ°â€œsrc/Transformers/data/processors/utils.pyâ€æ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬è¦ç”¨åˆ°ä»¥ä¸‹å‡ ä¸ªå†…å®¹ã€‚</p><p>1.InputExampleï¼šå®ƒç”¨äºè®°å½•å•ä¸ªè®­ç»ƒæ•°æ®çš„æ–‡æœ¬å†…å®¹çš„ç»“æ„ã€‚</p><p>2.DataProcessorï¼šé€šè¿‡è¿™ä¸ªç±»ä¸­çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°†è®­ç»ƒæ•°æ®é›†çš„æ–‡æœ¬ï¼Œè¡¨ç¤ºä¸ºå¤šä¸ªInputExampleç»„æˆçš„æ•°æ®é›†åˆã€‚</p><p>3.get_featuresï¼šç”¨äºæŠŠInputExampleæ•°æ®è½¬æ¢æˆBERTèƒ½å¤Ÿç†è§£çš„æ•°æ®ç»“æ„çš„å…³é”®å‡½æ•°ã€‚æˆ‘ä»¬å…·ä½“æ¥çœ‹ä¸€ä¸‹å„ä¸ªæ•°æ®éƒ½æ€ä¹ˆç”Ÿæˆçš„ã€‚</p><p>input_idsè®°å½•äº†è¾“å…¥tokenå¯¹åº”åœ¨vocab.txtçš„idåºå·ï¼Œå®ƒæ˜¯é€šè¿‡å¦‚ä¸‹çš„ä»£ç å¾—åˆ°çš„ã€‚</p><pre><code class=\"language-python\">input_ids = tokenizer.encode(\n\t                example.text_a,\n\t                add_special_tokens=True,\n\t                max_length=min(max_length, tokenizer.max_len),\n\t            )\n</code></pre><p>è€Œattention_maskè®°å½•äº†å±äºç¬¬ä¸€ä¸ªå¥å­çš„tokenä¿¡æ¯ï¼Œé€šè¿‡å¦‚ä¸‹ä»£ç å¾—åˆ°ã€‚</p><pre><code class=\"language-python\">attention_mask = [1 if mask_padding_with_zero else 0] * len(input_ids)\nattention_mask = attention_mask + ([0 if mask_padding_with_zero else 1] * padding_length)\n</code></pre><p>å¦å¤–ï¼Œä¸è¦å¿˜è®°è®°å½•æ–‡æœ¬ç±»åˆ«çš„ä¿¡æ¯ï¼ˆlabelï¼‰ã€‚ä½ å¯ä»¥è‡ªå·±æƒ³æƒ³çœ‹ï¼Œèƒ½å¦æŒ‰ç…§utils.pyæ–‡ä»¶ä¸­çš„å£°æ˜æ–¹å¼ï¼Œæ„å»ºå‡ºå¯¹åº”çš„labelä¿¡æ¯å‘¢ï¼Ÿ</p><h2>æ¨¡å‹è®­ç»ƒ</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æœ‰äº†ç½‘ç»œç»“æ„å®šä¹‰ï¼ˆBERTForSequenceClassificationï¼‰ã€æ•°æ®é›†åˆï¼ˆget_featuresï¼‰ï¼Œç°åœ¨å°±å¯ä»¥å¼€å§‹ç¼–å†™å®ç°è®­ç»ƒè¿‡ç¨‹çš„ä»£ç äº†ã€‚</p><h3>é€‰æ‹©ä¼˜åŒ–å™¨</h3><p>é¦–å…ˆæˆ‘ä»¬æ¥é€‰æ‹©ä¼˜åŒ–å™¨ï¼Œä»£ç å¦‚ä¸‹ã€‚æˆ‘ä»¬è¦å¯¹ç½‘ç»œä¸­çš„æ‰€æœ‰æƒé‡å‚æ•°è¿›è¡Œè®¾ç½®ï¼Œè¿™æ ·ä¼˜åŒ–å™¨å°±å¯ä»¥çŸ¥é“å“ªäº›å‚æ•°æ˜¯è¦è¿›è¡Œä¼˜åŒ–çš„ã€‚ç„¶åæˆ‘ä»¬å°†å‚æ•°listæ”¾åˆ°ä¼˜åŒ–å™¨ä¸­ï¼ŒBERTä½¿ç”¨çš„æ˜¯AdamWä¼˜åŒ–å™¨ã€‚</p><pre><code class=\"language-plain\">param_optimizer = list(model.named_parameters())\nno_decay = ['bias', 'LayerNorm.bias', 'LayerNorm.weight']\noptimizer_grouped_parameters = [\n            {'params': [p for n, p in param_optimizer if not any(nd in n for nd in no_decay)], 'weight_decay': 0.01},\n            {'params': [p for n, p in param_optimizer if any(nd in n for nd in no_decay)], 'weight_decay': 0.0}\n        ]\noptimizer = AdamW(optimizer_grouped_parameters, lr=args.learning_rate, eps=args.adam_epsilon)\n</code></pre><p>è¿™éƒ¨åˆ†çš„ä»£ç ï¼Œä¸»è¦æ˜¯ä¸ºäº†é€‰æ‹©ä¸€ä¸ªåˆé€‚å’±ä»¬æ¨¡å‹ä»»åŠ¡çš„ä¼˜åŒ–å™¨ï¼Œå¹¶å°†ç½‘ç»œä¸­çš„å‚æ•°è®¾å®šå¥½å­¦ä¹ ç‡ã€‚</p><h3>æ„å»ºè®­ç»ƒè¿‡ç¨‹é€»è¾‘</h3><p>è®­ç»ƒçš„è¿‡ç¨‹é€»è¾‘æ˜¯éå¸¸ç®€å•çš„ï¼Œåªéœ€è¦ä¸¤ä¸ªforå¾ªç¯ï¼Œåˆ†åˆ«ä»£è¡¨epochå’Œbatchï¼Œç„¶ååœ¨æœ€å†…éƒ¨å¢åŠ <strong>ä¸€ä¸ªè®­ç»ƒæ ¸å¿ƒè¯­å¥ï¼Œ<strong>ä»¥åŠ</strong>ä¸€ä¸ªæ¢¯åº¦æ›´æ–°è¯­å¥</strong>ï¼Œè¿™å°±è¶³å¤Ÿäº†ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒPyTorchåœ¨å·¥ç¨‹ä»£ç çš„å®ç°ä¸Šï¼Œå°è£…å¾—éå¸¸å®Œå–„å’Œç®€ç»ƒã€‚</p><pre><code class=\"language-plain\">for epoch in trange(0, args.num_train_epochs):\n  model.train()//ä¸€å®šåˆ«å¿˜äº†è¦æŠŠæ¨¡å‹è®¾ç½®ä¸ºè®­ç»ƒçŠ¶æ€ã€‚\n  for step, batch in enumerate(tqdm(train_dataLoader, desc='Iteration')):\n    step_loss = training_step(batch)//è®­ç»ƒçš„æ ¸å¿ƒç¯èŠ‚\n    tr_loss += step_loss[0]\n    optimizer.step()\n    optimizer.zero_grad()\n</code></pre><h3>è®­ç»ƒçš„æ ¸å¿ƒç¯èŠ‚</h3><p>è®­ç»ƒçš„æ ¸å¿ƒç¯èŠ‚ï¼Œä½ éœ€è¦å…³æ³¨ä¸¤ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯<strong>é€šè¿‡ç½‘ç»œå¾—åˆ°é¢„æµ‹è¾“å‡º</strong>ï¼Œä¹Ÿå°±æ˜¯logitsï¼Œä»¥åŠ<strong>åŸºäºlogitsè®¡ç®—å¾—åˆ°çš„loss</strong>ï¼Œlossæ˜¯æ•´ä¸ªæ¨¡å‹ä½¿ç”¨æ¢¯åº¦æ›´æ–°éœ€è¦ç”¨åˆ°çš„æ•°æ®ã€‚</p><pre><code class=\"language-plain\">def training_step(batch):\n  input_ids, token_type_ids, attention_mask, labels = batch\n  input_ids = input_ids.to(device)//å°†æ•°æ®å‘é€åˆ°GPU\n  token_type_ids = token_type_ids.to(device)\n  attention_mask = attention_mask.to(device)\n  labels = labels_voc.to(device)\n&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;\n  logits = model(input_ids,\n        token_type_ids=token_type_ids,&nbsp;\n        attention_mask=attention_mask,&nbsp;\n        labels=labels)\n  loss_fct = BCEWithLogitsLoss()\n  loss = loss_fct(logits.view(-1, num_labels_cate), labels.view(-1, num_labels_cate).float())\n  loss.backward()\n</code></pre><p>è‡³æ­¤ï¼Œå’±ä»¬å·²ç»å¿«é€Ÿæ„å»ºå‡ºäº†ä¸€ä¸ªBERTåˆ†ç±»å™¨æ‰€éœ€çš„æ‰€æœ‰å…³é”®ä»£ç ã€‚ä½†æ˜¯ä»æ—§æœ‰ä¸€äº›å°å°çš„ç¯èŠ‚éœ€è¦ä½ æ¥å®Œå–„ï¼Œæ¯”å¦‚training_stepä»£ç å—ä¸­çš„deviceï¼Œæ˜¯æ€ä¹ˆå¾—åˆ°çš„å‘¢ï¼Ÿå›é¡¾ä¸€ä¸‹å’±ä»¬ä¹‹å‰å­¦ä¹ çš„å†…å®¹ï¼Œç›¸ä¿¡ä½ ä¸€å®šå¯ä»¥åšå¾—åˆ°ã€‚</p><h2>å°ç»“</h2><p>æ­å–œä½ å®Œæˆäº†è¿™èŠ‚è¯¾çš„å­¦ä¹ ï¼Œå°½ç®¡ç°åœ¨GitHubä¸Šå·²ç»æœ‰äº†å¾ˆå¤šå·²ç»å°è£…å¾—éå¸¸å®Œå–„çš„BERTä»£ç ï¼Œä½ ä¹Ÿå¯ä»¥å¾ˆå¿«å®ç°ä¸€ä¸ªæœ€åŸºæœ¬çš„NLPç®—æ³•æµç¨‹ï¼Œä½†æ˜¯æˆ‘ä»å¸Œæœ›ä½ èƒ½å¤ŸæŠ½å‡ºæ—¶é—´ï¼Œå¥½å¥½çœ‹ä¸€ä¸‹Transformerä¸­çš„æ¨¡å‹ä»£ç ï¼Œè¿™ä¼šå¯¹ä½ çš„æŠ€æœ¯æå‡æœ‰éå¸¸å¤§çš„åŠ©ç›Šã€‚</p><p>è¿™èŠ‚è¯¾æˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•ç”¨PyTorchå¿«é€Ÿæ„å»ºä¸€ä¸ªåŸºæœ¬çš„æ–‡æœ¬åˆ†ç±»æ¨¡å‹ï¼Œæƒ³è¦å®ç°è¿™ä¸ªè¿‡ç¨‹ï¼Œä½ éœ€è¦äº†è§£BERTçš„é¢„è®­ç»ƒæ¨¡å‹çš„è·å–ä»¥åŠè½¬åŒ–ã€åˆ†ç±»ç½‘ç»œçš„è®¾è®¡æ–¹æ³•ã€è®­ç»ƒè¿‡ç¨‹çš„ç¼–å†™ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸éš¾ï¼Œä½†æ˜¯å´å¯ä»¥è®©ä½ å¿«é€Ÿä¸Šæ‰‹ï¼Œäº†è§£PyTorchåœ¨NLPæ–¹é¢å¦‚ä½•åº”ç”¨ã€‚</p><p>é™¤äº†æŠ€æœ¯æœ¬èº«ï¼Œä¸šåŠ¡æ–¹é¢çš„è€ƒè™‘æˆ‘ä»¬ä¹Ÿè¦æ³¨æ„ã€‚æ¯”å¦‚æ–°é—»æ–‡æœ¬çš„å¤šè¯­è¨€ã€æ•°æ®ä¸å¹³è¡¡ç­‰é—®é¢˜ï¼Œæ¨¡å‹æœ‰æ—¶ä¸èƒ½è§£å†³æ‰€æœ‰çš„é—®é¢˜ï¼Œå› æ­¤ä½ è¿˜éœ€è¦å­¦ä¹ ä¸€äº›<strong>æ•°æ®é¢„å¤„ç†çš„æŠ€å·§</strong>ï¼Œè¿™åŒ…æ‹¬å¾ˆå¤šæŠ€æœ¯å’Œç®—æ³•æ–¹é¢çš„å†…å®¹ã€‚</p><p>å³ä½¿æˆ‘åˆ—å‡ºä¸€ä»½é•¿é•¿çš„å­¦ä¹ æ¸…å•ï¼Œä¹Ÿå¯èƒ½ä¼šæŒ‚ä¸€æ¼ä¸‡ï¼Œæ‰€ä»¥æ•°æ®é¢„å¤„ç†æ–¹é¢çš„çŸ¥è¯†æˆ‘å»ºè®®ä½ é‡ç‚¹å…³æ³¨ä»¥ä¸‹å†…å®¹ï¼šå»ºè®®ä½ éœ€è¦èŠ±ä¸€äº›æ—¶é—´å»å­¦ä¹ NumPyå’ŒPandasçš„ä½¿ç”¨ï¼Œè¿™æ ·æ‰èƒ½æ›´åŠ å¾—å¿ƒåº”æ‰‹åœ°å¤„ç†æ•°æ®ï¼›ä½ è¿˜å¯ä»¥å¤šå­¦ä¹ ä¸€äº›å¸¸è§çš„æ•°æ®æŒ–æ˜ç®—æ³•ï¼ˆæ¯”å¦‚å†³ç­–æ ‘ã€KNNã€æ”¯æŒå‘é‡æœºç­‰ï¼‰ï¼›å¦å¤–ï¼Œæ·±åº¦å­¦ä¹ çš„å¹¿æ³›ä½¿ç”¨ï¼Œå…¶å®ä»æ—§éå¸¸éœ€è¦ä¼ ç»Ÿæœºå™¨å­¦ä¹ ç®—æ³•çš„èƒŒåæ”¯æ’‘ï¼Œä¹Ÿå»ºè®®ä½ å¤šå¤šäº†è§£ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>BERTå¤„ç†æ–‡æœ¬æ˜¯æœ‰æœ€å¤§é•¿åº¦è¦æ±‚çš„ï¼ˆ512ï¼‰ï¼Œé‚£ä¹ˆé‡åˆ°é•¿æ–‡æœ¬ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>ä¹Ÿæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºè®°å½•ä½ çš„ç–‘é—®æˆ–è€…æ”¶è·ï¼Œä¹Ÿæ¨èä½ æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚</p>","neighbors":{"left":{"article_title":"23 | æƒ…æ„Ÿåˆ†æï¼šå¦‚ä½•ä½¿ç”¨LSTMè¿›è¡Œæƒ…æ„Ÿåˆ†æï¼Ÿ","id":462524},"right":{"article_title":"25 | æ‘˜è¦ï¼šå¦‚ä½•å¿«é€Ÿå®ç°è‡ªåŠ¨æ–‡æ‘˜ç”Ÿæˆï¼Ÿ","id":464870}},"comments":[{"had_liked":false,"id":325578,"user_name":"vcjmhg","can_delete":false,"product_type":"c1","uid":1526461,"ip_address":"","ucode":"B508D1E9B3F974","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/j24oyxHcpB5AMR9pMO6fITqnOFVOncnk2T1vdu1rYLfq1cN6Sj7xVrBVbCvHXUad2MpfyBcE4neBguxmjIxyiaQ/132","comment_is_top":false,"comment_ctime":1639028873,"is_pvip":false,"replies":[{"id":"118159","content":"ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»^^","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2802608","ctime":1639105932,"ip_address":"","comment_id":325578,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14523930761","product_id":100093301,"comment_content":"1.æˆªæ–­æ³•<br>æˆªæ–­æ³•æ˜¯éå¸¸å¸¸ç”¨åŠæ³•ï¼Œå¤§è‡´åˆ†ä¸ºä¸‰ç§ï¼Œheadæˆªæ–­ï¼Œtailæˆªæ–­ï¼Œhead+tail æˆªæ–­ã€‚<br>headæˆªæ–­å³ä»æ–‡æœ¬å¼€å¤´ç›´åˆ°é™åˆ¶çš„å­—æ•°ã€‚<br>tailæˆªæ–­æ˜¯ä»ç»“å°¾å¼€å§‹å¾€å‰æˆªæ–­ã€‚<br>head+tail æˆªæ–­ï¼Œå¼€å¤´å’Œç»“å°¾å„ä¿ç•™ä¸€éƒ¨åˆ†ï¼Œæ¯”ä¾‹å‚æ•°æ˜¯ä¸€ä¸ªå¯ä»¥è°ƒèŠ‚è¶…å‚æ•°ã€‚<br>ç¼ºç‚¹:å¤„ç†æ–¹æ³•è¾ƒä¸ºæš´åŠ›ï¼Œä¸æ˜¯å¤ªé•¿çš„æ–‡æœ¬<br>2.Poolingæ³•ï¼Œç¼ºç‚¹æ€§èƒ½è¾ƒå·®<br>3.å‹ç¼©æ³•ï¼Œæå–æ–‡æœ¬ä¸­æœ‰é™segmentï¼Œä½†å‹ç¼©æ•ˆæœå¯èƒ½ä¼šå¾ˆæœ‰é™ã€‚","like_count":3,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537569,"discussion_content":"ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»^^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639105932,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356814,"user_name":"Qwen","can_delete":false,"product_type":"c1","uid":1078910,"ip_address":"åŒ—äº¬","ucode":"6C1D76C76D8ADE","user_header":"https://static001.geekbang.org/account/avatar/00/10/76/7e/3afb669f.jpg","comment_is_top":false,"comment_ctime":1662607784,"is_pvip":false,"replies":[{"id":"129858","content":"ä½ å¥½ï¼Œæ„Ÿè°¢ä½ çš„ç•™è¨€ã€‚å›¾åƒçš„è¯¾ç¨‹æœ‰æ•´ç†å¥½çš„ä»£ç ã€‚é“¾æ¥åœ¨æ–‡ç« é‡Œã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2802608","ctime":1662624958,"ip_address":"åŒ—äº¬","comment_id":356814,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5957575080","product_id":100093301,"comment_content":"æ‰å…¥è¡Œæ–°äººï¼Œæ–‡ç« è¯»äº†å¥½å‡ éï¼Œè¿˜æœ‰å¾ˆå¤šé—®é¢˜ç‚¹ä¸èƒ½ç†è§£ã€‚<br>å¸Œæœ›å¤§ä½¬èƒ½å¦è€ƒè™‘æ•´ç†ä¸€ä»½å®Œæ•´çš„è®­ç»ƒä»£ç ï¼Œåœ¨å‚ç…§æ‚¨çš„æ–‡æ¡£å»ç†è§£ï¼Œåº”è¯¥èƒ½å¸®åŠ©åˆ°å¾ˆå¤šåƒæˆ‘è¿™æ ·çš„æ–°äººã€‚","like_count":1,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586950,"discussion_content":"ä½ å¥½ï¼Œæ„Ÿè°¢ä½ çš„ç•™è¨€ã€‚å›¾åƒçš„è¯¾ç¨‹æœ‰æ•´ç†å¥½çš„ä»£ç ã€‚é“¾æ¥åœ¨æ–‡ç« é‡Œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662624958,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":339691,"user_name":"(â—â€”â—)","can_delete":false,"product_type":"c1","uid":2525707,"ip_address":"","ucode":"0392EB99829648","user_header":"https://static001.geekbang.org/account/avatar/00/26/8a/0b/ac84669e.jpg","comment_is_top":false,"comment_ctime":1648295127,"is_pvip":false,"replies":[{"id":"124326","content":"ä½ å¥½ï¼Œä¸å¥½æ„æ€ï¼Œæ²¡å¤ªçœ‹æ˜ç™½ã€‚<br>è½¬ä»€ä¹ˆæ¨¡å‹ï¼Ÿä»å“ªé‡Œè½¬ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2802608","ctime":1648540259,"ip_address":"","comment_id":339691,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5943262423","product_id":100093301,"comment_content":"è¯·é—®æ€ä¹ˆè½¬æ¢æ¨¡å‹ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558980,"discussion_content":"ä½ å¥½ï¼Œä¸å¥½æ„æ€ï¼Œæ²¡å¤ªçœ‹æ˜ç™½ã€‚\nè½¬ä»€ä¹ˆæ¨¡å‹ï¼Ÿä»å“ªé‡Œè½¬ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648540259,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":2,"child_discussions":[{"author":{"id":2525707,"avatar":"https://static001.geekbang.org/account/avatar/00/26/8a/0b/ac84669e.jpg","nickname":"(â—â€”â—)","note":"","ucode":"0392EB99829648","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":558984,"discussion_content":"å¯¹ç…§è¿™èŠ‚è¯¾çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬é€‰æ‹©çš„æ˜¯â€œBERT-Base, Multilingual Casedâ€çš„ç‰ˆæœ¬ã€‚ä» GitHub çš„ä»‹ç»å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªç‰ˆæœ¬çš„ checkpoint æ”¯æŒ 104 ç§è¯­è¨€ï¼Œæ˜¯ä¸æ˜¯å¾ˆå‰å®³ï¼Ÿå½“ç„¶ï¼Œå¦‚æœä½ æ²¡æœ‰å¤šè¯­è¨€çš„éœ€æ±‚ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–ç‰ˆæœ¬çš„ï¼Œå®ƒä»¬çš„åŒºåˆ«ä¸»è¦æ˜¯ç½‘ç»œçš„ä½“ç§¯ä¸åŒã€‚\nè½¬æ¢å®Œæ¨¡å‹ä¹‹åï¼Œ\n\nè¿™å¥è¯çš„è½¬æ¢å®Œæ¨¡å‹ä¹‹åï¼Œæˆ‘ä¹Ÿæ²¡å¤ªæ˜ç™½ï½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648541772,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":558980,"ip_address":""},"score":558984,"extra":""},{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":2525707,"avatar":"https://static001.geekbang.org/account/avatar/00/26/8a/0b/ac84669e.jpg","nickname":"(â—â€”â—)","note":"","ucode":"0392EB99829648","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560386,"discussion_content":"hiï¼Œä¸‡åˆ†æŠ±æ­‰ï¼Œå›å¤æ™šäº†ã€‚\n\nè¿™ä¸ªè½¬æ¢æ˜¯å°†tensorflowé¢„è®­ç»ƒå¥½çš„æ¨¡å‹è½¬æ¢ä¸ºpytorchç‰ˆæœ¬çš„ï¼Œå…·ä½“ä½ å¯ä»¥åœ¨è¿™ä¸ªé“¾æ¥ä¸­çœ‹åˆ°å¯¹åº”çš„ä»£ç ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œéšç€ç‰ˆæœ¬çš„æ›´æ–°ï¼Œè¾“å‡ºçš„æ–‡ä»¶å¯èƒ½å·²ç»ç•¥æœ‰ä¸åŒäº†ã€‚\n\nhttps://github.com/huggingface/transformers/blob/main/src/transformers/models/bert/convert_bert_original_tf_checkpoint_to_pytorch.py","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649308532,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":558984,"ip_address":""},"score":560386,"extra":""}]}]},{"had_liked":false,"id":347942,"user_name":"äºšæ—","can_delete":false,"product_type":"c1","uid":1018972,"ip_address":"","ucode":"4A5A6D24314B79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8c/5c/3f164f66.jpg","comment_is_top":false,"comment_ctime":1654595119,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1654595119","product_id":100093301,"comment_content":"æˆ‘è§‰å¾—è¿™ç¯‡çš„ä¸»è§’æ˜¯huggingface","like_count":0},{"had_liked":false,"id":347903,"user_name":"äºšæ—","can_delete":false,"product_type":"c1","uid":1018972,"ip_address":"","ucode":"4A5A6D24314B79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8c/5c/3f164f66.jpg","comment_is_top":false,"comment_ctime":1654569994,"is_pvip":false,"replies":[{"id":"126846","content":"hiï¼Œæ²¡æœ‰å¤±æ•ˆï¼Œå¯èƒ½æ˜¯ä½ çš„ç½‘ç»œé—®é¢˜","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2802608","ctime":1654759016,"ip_address":"","comment_id":347903,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1654569994","product_id":100093301,"comment_content":"é¢„è®­ç»ƒæ¨¡å‹åœ°å€å¤±æ•ˆäº†ï¼š<br>https:&#47;&#47;github.com&#47;google-research&#47;bert&#47;blob&#47;master&#47;multilingual.md","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575335,"discussion_content":"hiï¼Œæ²¡æœ‰å¤±æ•ˆï¼Œå¯èƒ½æ˜¯ä½ çš„ç½‘ç»œé—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654759016,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":347554,"user_name":"äºšæ—","can_delete":false,"product_type":"c1","uid":1018972,"ip_address":"","ucode":"4A5A6D24314B79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8c/5c/3f164f66.jpg","comment_is_top":false,"comment_ctime":1654150800,"is_pvip":false,"replies":[{"id":"126845","content":"hello pipelinesä¸æ˜¯è§£å†³é•¿æ–‡æœ¬é—®é¢˜çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2802608","ctime":1654758798,"ip_address":"","comment_id":347554,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1654150800","product_id":100093301,"comment_content":"ä¸Šä¸€èŠ‚æåˆ°çš„pipelinesèƒ½å¦è§£å†³é•¿æ–‡æœ¬çš„åŠæ³•","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575334,"discussion_content":"hello pipelinesä¸æ˜¯è§£å†³é•¿æ–‡æœ¬é—®é¢˜çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654758798,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":342050,"user_name":"Geek_709f77","can_delete":false,"product_type":"c1","uid":2843530,"ip_address":"","ucode":"25F56EFCD3795F","user_header":"","comment_is_top":false,"comment_ctime":1649992045,"is_pvip":true,"replies":[{"id":"125012","content":"ä½ å¥½ï¼Œæ„Ÿè°¢ä½ çš„ç•™è¨€ã€‚<br>æ¨¡å‹çš„è½¬æ¢éœ€è¦transformersä¸­æä¾›çš„convert_tf_checkpoint_to_pytorch.py æ–‡ä»¶çš„å¸®å¿™ï¼Œå…·ä½“çš„ä½¿ç”¨æ–¹æ³•ä¼šéšç€ç‰ˆæœ¬çš„æ›´æ–°è€Œæœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯å¥½åœ¨ç”¨æ³•éƒ½åœ¨è¯¥æ–‡ä»¶çš„mainå‡½æ•°ä¸­è¿›è¡Œäº†ä»‹ç»ã€‚ä½ å¯ä»¥çœ‹ä¸€ä¸‹ã€‚<br>é“¾æ¥ä¸æ–‡ç« ä¸­å†…å®¹ä¸ä¸€æ ·çš„é—®é¢˜ï¼Œæˆ‘åˆšæ‰çœ‹äº†ä¸€ä¸‹gitä¸­çš„ä»£ç ï¼Œä»–ä¸‰å¤©å‰æ›´æ–°äº†ã€‚<br>æŒ‰ç…§æ–‡ç« ä¸­çš„æµç¨‹ï¼Œä»£ç åŸºæœ¬éƒ½æ˜¯å¯ä»¥å®ç°çš„^^ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2802608","ctime":1650004952,"ip_address":"","comment_id":342050,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1649992045","product_id":100093301,"comment_content":"â€œè½¬æ¢å®Œæ¨¡å‹ä¹‹åï¼Œä½ ä¼šå‘ç°ä½ çš„æœ¬åœ°å¤šäº†ä¸‰ä¸ªæ–‡ä»¶â€è¿™ä¸ªè½¬æ¢å®Œæˆæ¨¡å‹æ˜¯æ€ä¹ˆåšçš„ï¼Ÿå¦å¤–ï¼Œè€å¸ˆç»™çš„é“¾æ¥æœ‰çš„æ‰“å¼€åè·Ÿæ–‡ç« ä¸­å†…å®¹ä¸ä¸€æ ·ï¼Œä»£ç ä¸‹è½½ä¹Ÿä¸å¯¹ï¼Œèƒ½ä¸èƒ½æŠŠæ‰€æœ‰ä»£ç æ”¾åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œè®©æˆ‘ä»¬ä¸‹è½½è¿è¡Œï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":563480,"discussion_content":"ä½ å¥½ï¼Œæ„Ÿè°¢ä½ çš„ç•™è¨€ã€‚\næ¨¡å‹çš„è½¬æ¢éœ€è¦transformersä¸­æä¾›çš„convert_tf_checkpoint_to_pytorch.py æ–‡ä»¶çš„å¸®å¿™ï¼Œå…·ä½“çš„ä½¿ç”¨æ–¹æ³•ä¼šéšç€ç‰ˆæœ¬çš„æ›´æ–°è€Œæœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯å¥½åœ¨ç”¨æ³•éƒ½åœ¨è¯¥æ–‡ä»¶çš„mainå‡½æ•°ä¸­è¿›è¡Œäº†ä»‹ç»ã€‚ä½ å¯ä»¥çœ‹ä¸€ä¸‹ã€‚\né“¾æ¥ä¸æ–‡ç« ä¸­å†…å®¹ä¸ä¸€æ ·çš„é—®é¢˜ï¼Œæˆ‘åˆšæ‰çœ‹äº†ä¸€ä¸‹gitä¸­çš„ä»£ç ï¼Œä»–ä¸‰å¤©å‰æ›´æ–°äº†ã€‚\næŒ‰ç…§æ–‡ç« ä¸­çš„æµç¨‹ï¼Œä»£ç åŸºæœ¬éƒ½æ˜¯å¯ä»¥å®ç°çš„^^ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650004952,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":341818,"user_name":"å‘å¤","can_delete":false,"product_type":"c1","uid":2958860,"ip_address":"","ucode":"2426D5DC28CA46","user_header":"","comment_is_top":false,"comment_ctime":1649842433,"is_pvip":false,"replies":[{"id":"124915","content":"ä½ å¥½ï¼Œå‘å¤ï¼Œæ„Ÿè°¢ä½ çš„ç•™è¨€ã€‚<br>æŒ‰ç…§æ–‡ç« é‡Œçš„ä¸€æ­¥æ­¥æ¥å°±æ˜¯å¯ä»¥è¿è¡Œçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2802608","ctime":1649916830,"ip_address":"","comment_id":341818,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1649842433","product_id":100093301,"comment_content":"è¯·é—®æœ‰å®Œæ•´çš„è®­ç»ƒä»£ç é“¾æ¥å—","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":562969,"discussion_content":"ä½ å¥½ï¼Œå‘å¤ï¼Œæ„Ÿè°¢ä½ çš„ç•™è¨€ã€‚\næŒ‰ç…§æ–‡ç« é‡Œçš„ä¸€æ­¥æ­¥æ¥å°±æ˜¯å¯ä»¥è¿è¡Œçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649916830,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332137,"user_name":"xiaolan","can_delete":false,"product_type":"c1","uid":1004981,"ip_address":"","ucode":"CA62933484CEC0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/55/b5/12c67a82.jpg","comment_is_top":false,"comment_ctime":1643037133,"is_pvip":false,"replies":[{"id":"121366","content":"helloï¼Œæ„Ÿè°¢ç•™è¨€ã€‚<br>ä»–ä»¬ä¸ä¸€æ ·ã€‚å¯ä»¥ä¸€æ ·ç”¨ï¼Œä½†æ˜¯bertæ›´å¼ºå¤§ï¼Œè¿˜æœ‰åˆ«çš„åŠŸèƒ½ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2802608","ctime":1643088547,"ip_address":"","comment_id":332137,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1643037133","product_id":100093301,"comment_content":"è¯·é—®bertæ¨¡å‹çš„ç”¨å¤„æ˜¯ä¸æ˜¯è·Ÿword2vecä¸€æ ·ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548214,"discussion_content":"helloï¼Œæ„Ÿè°¢ç•™è¨€ã€‚\nä»–ä»¬ä¸ä¸€æ ·ã€‚å¯ä»¥ä¸€æ ·ç”¨ï¼Œä½†æ˜¯bertæ›´å¼ºå¤§ï¼Œè¿˜æœ‰åˆ«çš„åŠŸèƒ½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643088547,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}