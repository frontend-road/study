{"id":327107,"title":"20 | å®¹å™¨å®‰å…¨ï¼ˆ2ï¼‰ï¼šåœ¨å®¹å™¨ä¸­ï¼Œæˆ‘ä¸ä»¥rootç”¨æˆ·æ¥è¿è¡Œç¨‹åºå¯ä»¥å—ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç¨‹è¿œã€‚</p><p>åœ¨<a href=\"https://time.geekbang.org/column/article/326253\">ä¸Šä¸€è®²</a>é‡Œï¼Œæˆ‘ä»¬å­¦ä¹ äº†Linux capabilitiesçš„æ¦‚å¿µï¼Œä¹ŸçŸ¥é“äº†å¯¹äºéprivilegedçš„å®¹å™¨ï¼Œå®¹å™¨ä¸­rootç”¨æˆ·çš„capabilitiesæ˜¯æœ‰é™åˆ¶çš„ï¼Œå› æ­¤å®¹å™¨ä¸­çš„rootç”¨æˆ·æ— æ³•åƒå®¿ä¸»æœºä¸Šçš„rootç”¨æˆ·ä¸€æ ·ï¼Œæ‹¿åˆ°å®Œå…¨æŒæ§ç³»ç»Ÿçš„ç‰¹æƒã€‚</p><p>é‚£ä¹ˆæ˜¯ä¸æ˜¯è®©éprivilegedçš„å®¹å™¨ä»¥rootç”¨æˆ·æ¥è¿è¡Œç¨‹åºï¼Œè¿™æ ·å°±èƒ½ä¿è¯å®‰å…¨äº†å‘¢ï¼Ÿè¿™ä¸€è®²ï¼Œæˆ‘ä»¬å°±æ¥èŠä¸€èŠå®¹å™¨ä¸­çš„rootç”¨æˆ·ä¸å®‰å…¨ç›¸å…³çš„é—®é¢˜ã€‚</p><h2>é—®é¢˜å†ç°</h2><p>è¯´åˆ°å®¹å™¨ä¸­çš„ç”¨æˆ·ï¼ˆuserï¼‰ï¼Œä½ å¯èƒ½ä¼šæƒ³åˆ°ï¼Œåœ¨Linux Namespaceä¸­æœ‰ä¸€é¡¹éš”ç¦»æŠ€æœ¯ï¼Œä¹Ÿå°±æ˜¯User Namespaceã€‚</p><p>ä¸è¿‡åœ¨å®¹å™¨äº‘å¹³å°Kubernetesä¸Šç›®å‰è¿˜ä¸æ”¯æŒUser Namespaceï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹åœ¨æ²¡æœ‰User Namespaceçš„æƒ…å†µä¸‹ï¼Œå®¹å™¨ä¸­ç”¨rootç”¨æˆ·è¿è¡Œï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æŠŠå®¿ä¸»æœºä¸Š/etcç›®å½•ä»¥volumeçš„å½¢å¼æŒ‚è½½åˆ°äº†å®¹å™¨ä¸­çš„/mntç›®å½•ä¸‹é¢ã€‚</p><pre><code class=\"language-shell\"># docker run -d --name root_example -v /etc:/mnt  centos sleep 3600\n</code></pre><p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹å®¹å™¨ä¸­çš„è¿›ç¨‹\"sleep 3600\"ï¼Œå®ƒåœ¨å®¹å™¨ä¸­å’Œå®¿ä¸»æœºä¸Šçš„ç”¨æˆ·éƒ½æ˜¯rootï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®¹å™¨ä¸­ç”¨æˆ·çš„uid/gidå’Œå®¿ä¸»æœºä¸Šçš„å®Œå…¨ä¸€æ ·ã€‚</p><!-- [[[read_end]]] --><pre><code class=\"language-shell\"># docker exec -it root_example bash -c \"ps -ef | grep sleep\"\nroot         1     0  0 01:14 ?        00:00:00 /usr/bin/coreutils --coreutils-prog-shebang=sleep /usr/bin/sleep 3600\n \n# ps -ef | grep sleep\nroot      5473  5443  0 18:14 ?        00:00:00 /usr/bin/coreutils --coreutils-prog-shebang=sleep /usr/bin/sleep 3600\n</code></pre><p>è™½ç„¶å®¹å™¨é‡Œrootç”¨æˆ·çš„capabilitiesè¢«é™åˆ¶äº†ä¸€äº›ï¼Œä½†æ˜¯åœ¨å®¹å™¨ä¸­ï¼Œå¯¹äºè¢«æŒ‚è½½ä¸Šæ¥çš„/etcç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œæ¯”å¦‚è¯´shadowæ–‡ä»¶ï¼Œä»¥è¿™ä¸ªrootç”¨æˆ·çš„æƒé™è¿˜æ˜¯å¯ä»¥åšä¿®æ”¹çš„ã€‚</p><pre><code class=\"language-shell\"># docker exec -it root_example bash\n[root@9c7b76232c19 /]# ls /mnt/shadow -l\n---------- 1 root root 586 Nov 26 13:47 /mnt/shadow\n[root@9c7b76232c19 /]# echo \"hello\" &gt;&gt; /mnt/shadow\n</code></pre><p>æ¥ç€æˆ‘ä»¬çœ‹çœ‹åé¢è¿™æ®µå‘½ä»¤è¾“å‡ºï¼Œå¯ä»¥ç¡®è®¤åœ¨å®¿ä¸»æœºä¸Šæ–‡ä»¶è¢«ä¿®æ”¹äº†ã€‚</p><pre><code class=\"language-shell\"># tail -n 3 /etc/shadow\ngrafana:!!:18437::::::\ntcpdump:!!:18592::::::\nhello\n</code></pre><p>è¿™ä¸ªä¾‹å­è¯´æ˜å®¹å™¨ä¸­çš„rootç”¨æˆ·ä¹Ÿæœ‰æƒé™ä¿®æ”¹å®¿ä¸»æœºä¸Šçš„å…³é”®æ–‡ä»¶ã€‚</p><p>å½“ç„¶åœ¨äº‘å¹³å°ä¸Šï¼Œæ¯”å¦‚è¯´åœ¨Kubernetesé‡Œï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥é™åˆ¶å®¹å™¨å»æŒ‚è½½å®¿ä¸»æœºçš„ç›®å½•çš„ã€‚</p><p>ä¸è¿‡ï¼Œç”±äºå®¹å™¨å’Œå®¿ä¸»æœºæ˜¯å…±äº«Linuxå†…æ ¸çš„ï¼Œä¸€æ—¦è½¯ä»¶æœ‰æ¼æ´ï¼Œé‚£ä¹ˆå®¹å™¨ä¸­ä»¥rootç”¨æˆ·è¿è¡Œçš„è¿›ç¨‹å°±æœ‰æœºä¼šå»ä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶äº†ã€‚æ¯”å¦‚2019å¹´å‘ç°çš„ä¸€ä¸ªRunCçš„æ¼æ´ <a href=\"https://nvd.nist.gov/vuln/detail/CVE-2019-5736\">CVE-2019-5736</a>ï¼Œ è¿™å¯¼è‡´å®¹å™¨ä¸­rootç”¨æˆ·æœ‰æœºä¼šä¿®æ”¹å®¿ä¸»æœºä¸Šçš„RunCç¨‹åºï¼Œå¹¶ä¸”å®¹å™¨ä¸­çš„rootç”¨æˆ·è¿˜ä¼šå¾—åˆ°å®¿ä¸»æœºä¸Šçš„è¿è¡Œæƒé™ã€‚</p><h2>é—®é¢˜åˆ†æ</h2><p>å¯¹äºå‰é¢çš„é—®é¢˜ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥è®¨è®ºä¸€ä¸‹<strong>è§£å†³åŠæ³•</strong>ï¼Œåœ¨è®¨è®ºé—®é¢˜çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šæ¶‰åŠä¸€äº›æ–°çš„æ¦‚å¿µï¼Œä¸»è¦æœ‰ä¸‰ä¸ªã€‚</p><h3>æ–¹æ³•ä¸€ï¼šRun as non-root userï¼ˆç»™å®¹å™¨æŒ‡å®šä¸€ä¸ªæ™®é€šç”¨æˆ·ï¼‰</h3><p>æˆ‘ä»¬å¦‚æœä¸æƒ³è®©å®¹å™¨ä»¥rootç”¨æˆ·è¿è¡Œï¼Œæœ€ç›´æ¥çš„åŠæ³•å°±æ˜¯ç»™å®¹å™¨æŒ‡å®šä¸€ä¸ªæ™®é€šç”¨æˆ·uidã€‚è¿™ä¸ªæ–¹æ³•å¾ˆç®€å•ï¼Œæ¯”å¦‚å¯ä»¥åœ¨dockerå¯åŠ¨å®¹å™¨çš„æ—¶å€™åŠ ä¸Š\"-u\"å‚æ•°ï¼Œåœ¨å‚æ•°ä¸­æŒ‡å®šuid/gidã€‚</p><p>å…·ä½“çš„æ“ä½œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-shell\"># docker run -ti --name root_example -u 6667:6667 -v /etc:/mnt  centos bash\nbash-4.4$ id\nuid=6667 gid=6667 groups=6667\nbash-4.4$ ps -ef\nUID        PID  PPID  C STIME TTY          TIME CMD\n6667         1     0  1 01:27 pts/0    00:00:00 bash\n6667         8     1  0 01:27 pts/0    00:00:00 ps -ef\n</code></pre><p>è¿˜æœ‰å¦å¤–ä¸€ä¸ªåŠæ³•ï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨åˆ›å»ºå®¹å™¨é•œåƒçš„æ—¶å€™ï¼Œç”¨Dockerfileä¸ºå®¹å™¨é•œåƒé‡Œå»ºç«‹ä¸€ä¸ªç”¨æˆ·ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿ä½ ç†è§£ï¼Œæˆ‘è¿˜æ˜¯ä¸¾ä¾‹è¯´æ˜ã€‚å°±åƒä¸‹é¢ä¾‹å­ä¸­çš„nonrootï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨æˆ·åï¼Œæˆ‘ä»¬ç”¨USERå…³é”®å­—æ¥æŒ‡å®šè¿™ä¸ªnonrootç”¨æˆ·ï¼Œè¿™æ ·æ“ä½œä»¥åï¼Œå®¹å™¨é‡Œç¼ºçœçš„è¿›ç¨‹éƒ½ä¼šä»¥è¿™ä¸ªç”¨æˆ·å¯åŠ¨ã€‚</p><p>è¿™æ ·åœ¨è¿è¡ŒDockerå‘½ä»¤çš„æ—¶å€™å°±ä¸ç”¨åŠ \"-u\"å‚æ•°æ¥æŒ‡å®šç”¨æˆ·äº†ã€‚</p><pre><code class=\"language-shell\"># cat Dockerfile\nFROM centos\n \nRUN adduser -u 6667 nonroot\nUSER nonroot\n \n# docker build -t registry/nonroot:v1 .\nâ€¦\n \n# docker run -d --name root_example -v /etc:/mnt registry/nonroot:v1 sleep 3600\n050809a716ab0a9481a6dfe711b332f74800eff5fea8b4c483fa370b62b4b9b3\n \n# docker exec -it root_example bash\n[nonroot@050809a716ab /]$ id\nuid=6667(nonroot) gid=6667(nonroot) groups=6667(nonroot)\n[nonroot@050809a716ab /]$ ps -ef\nUID        PID  PPID  C STIME TTY          TIME CMD\nnonroot      1     0  0 01:43 ?        00:00:00 /usr/bin/coreutils --coreutils-prog-shebang=sleep /usr/bin/sleep 3600\n</code></pre><p>å¥½ï¼Œåœ¨å®¹å™¨ä¸­ä½¿ç”¨æ™®é€šç”¨æˆ·è¿è¡Œä¹‹åï¼Œæˆ‘ä»¬å†çœ‹çœ‹ï¼Œç°åœ¨èƒ½å¦ä¿®æ”¹è¢«æŒ‚è½½ä¸Šæ¥çš„/etcç›®å½•ä¸‹çš„æ–‡ä»¶? æ˜¾ç„¶ï¼Œç°åœ¨ä¸å¯ä»¥ä¿®æ”¹äº†ã€‚</p><pre><code class=\"language-shell\">[nonroot@050809a716ab /]$ echo \"hello\" &gt;&gt; /mnt/shadow\nbash: /mnt/shadow: Permission denied\n</code></pre><p>é‚£ä¹ˆæ˜¯ä¸æ˜¯åªè¦ç»™å®¹å™¨ä¸­æŒ‡å®šäº†ä¸€ä¸ªæ™®é€šç”¨æˆ·ï¼Œè¿™ä¸ªé—®é¢˜å°±åœ†æ»¡è§£å†³äº†å‘¢ï¼Ÿå…¶å®åœ¨äº‘å¹³å°ä¸Šï¼Œè¿™ä¹ˆåšè¿˜æ˜¯ä¼šå¸¦æ¥åˆ«çš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ã€‚</p><p>ç”±äºç”¨æˆ·uidæ˜¯æ•´ä¸ªèŠ‚ç‚¹ä¸­å…±äº«çš„ï¼Œé‚£ä¹ˆåœ¨å®¹å™¨ä¸­å®šä¹‰çš„uidï¼Œä¹Ÿå°±æ˜¯å®¿ä¸»æœºä¸Šçš„uidï¼Œè¿™æ ·å°±å¾ˆå®¹æ˜“å¼•èµ·uidçš„å†²çªã€‚</p><p>æ¯”å¦‚è¯´ï¼Œå¤šä¸ªå®¢æˆ·åœ¨å»ºç«‹è‡ªå·±çš„å®¹å™¨é•œåƒçš„æ—¶å€™éƒ½é€‰æ‹©äº†åŒä¸€ä¸ªuid 6667ã€‚é‚£ä¹ˆå½“å¤šä¸ªå®¢æˆ·çš„å®¹å™¨åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„æ—¶å€™ï¼Œå…¶å®å°±éƒ½ä½¿ç”¨äº†å®¿ä¸»æœºä¸Šuid 6667ã€‚</p><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œåœ¨ä¸€å°Linuxç³»ç»Ÿä¸Šï¼Œæ¯ä¸ªç”¨æˆ·ä¸‹çš„èµ„æºæ˜¯æœ‰é™åˆ¶çš„ï¼Œæ¯”å¦‚æ‰“å¼€æ–‡ä»¶æ•°ç›®ï¼ˆopen filesï¼‰ã€æœ€å¤§è¿›ç¨‹æ•°ç›®ï¼ˆmax user processesï¼‰ç­‰ç­‰ã€‚ä¸€æ—¦æœ‰å¾ˆå¤šä¸ªå®¹å™¨å…±äº«ä¸€ä¸ªuidï¼Œè¿™äº›å®¹å™¨å°±å¾ˆå¯èƒ½å¾ˆå¿«æ¶ˆè€—æ‰è¿™ä¸ªuidä¸‹çš„èµ„æºï¼Œè¿™æ ·å¾ˆå®¹æ˜“å¯¼è‡´è¿™äº›å®¹å™¨éƒ½ä¸èƒ½å†æ­£å¸¸å·¥ä½œã€‚</p><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¿…é¡»è¦æœ‰ä¸€ä¸ªäº‘å¹³å°çº§åˆ«çš„uidç®¡ç†å’Œåˆ†é…ï¼Œä½†é€‰æ‹©è¿™ä¸ªæ–¹æ³•ä¹Ÿè¦ä»˜å‡ºä»£ä»·ã€‚å› ä¸ºè¿™æ ·åšæ˜¯å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†æ˜¯ç”¨æˆ·åœ¨å®šä¹‰è‡ªå·±å®¹å™¨ä¸­çš„uidçš„æ—¶å€™ï¼Œä»–ä»¬å°±éœ€è¦æœ‰é¢å¤–çš„æ“ä½œï¼Œè€Œä¸”å¹³å°ä¹Ÿéœ€è¦æ–°å¼€å‘å¯¹uidå¹³å°çº§åˆ«çš„ç®¡ç†æ¨¡å—ï¼Œå®Œæˆè¿™äº›äº‹æƒ…éœ€è¦çš„å·¥ä½œé‡ä¹Ÿä¸å°‘ã€‚</p><h3>æ–¹æ³•äºŒï¼šUser Namespaceï¼ˆç”¨æˆ·éš”ç¦»æŠ€æœ¯çš„æ”¯æŒï¼‰</h3><p>é‚£ä¹ˆåœ¨æ²¡æœ‰ä½¿ç”¨User Namespaceçš„æƒ…å†µï¼Œå¯¹äºå®¹å™¨å¹³å°ä¸Šçš„ç”¨æˆ·ç®¡ç†è¿˜æ˜¯å­˜åœ¨é—®é¢˜ã€‚ä½ å¯èƒ½ä¼šæƒ³åˆ°ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯åº”è¯¥å»å°è¯•ä¸€ä¸‹User Namespace?</p><p>å¥½çš„ï¼Œæˆ‘ä»¬å°±ä¸€èµ·æ¥çœ‹çœ‹ä½¿ç”¨User Namespaceå¯¹è§£å†³ç”¨æˆ·ç®¡ç†é—®é¢˜æœ‰æ²¡æœ‰å¸®åŠ©ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ç®€å•äº†è§£ä¸€ä¸‹<a href=\"https://man7.org/linux/man-pages/man7/user_namespaces.7.html\">User Namespace</a>çš„æ¦‚å¿µã€‚</p><p>User Namespaceéš”ç¦»äº†ä¸€å°LinuxèŠ‚ç‚¹ä¸Šçš„User IDï¼ˆuidï¼‰å’ŒGroup IDï¼ˆgidï¼‰ï¼Œå®ƒç»™Namespaceä¸­çš„uid/gidçš„å€¼ä¸å®¿ä¸»æœºä¸Šçš„uid/gidå€¼å»ºç«‹äº†ä¸€ä¸ªæ˜ å°„å…³ç³»ã€‚ç»è¿‡User Namespaceçš„éš”ç¦»ï¼Œæˆ‘ä»¬åœ¨Namespaceä¸­çœ‹åˆ°çš„è¿›ç¨‹çš„uid/gidï¼Œå°±å’Œå®¿ä¸»æœºNamespaceä¸­çœ‹åˆ°çš„uidå’Œgidä¸ä¸€æ ·äº†ã€‚</p><p>ä½ å¯ä»¥çœ‹ä¸‹é¢çš„è¿™å¼ ç¤ºæ„å›¾ï¼Œåº”è¯¥å°±èƒ½å¾ˆå¿«çŸ¥é“User Namespaceå¤§æ¦‚æ˜¯ä»€ä¹ˆæ„æ€äº†ã€‚æ¯”å¦‚namespace_1é‡Œçš„uidå€¼æ˜¯0åˆ°999ï¼Œä½†å…¶å®å®ƒåœ¨å®¿ä¸»æœºä¸Šå¯¹åº”çš„uidå€¼æ˜¯1000åˆ°1999ã€‚</p><p>è¿˜æœ‰ä¸€ç‚¹ä½ è¦æ³¨æ„çš„æ˜¯ï¼ŒUser Namespaceæ˜¯å¯ä»¥åµŒå¥—çš„ï¼Œæ¯”å¦‚ä¸‹é¢å›¾é‡Œçš„namespace_2é‡Œå¯ä»¥å†å»ºç«‹ä¸€ä¸ªnamespace_3ï¼Œè¿™ä¸ªåµŒå¥—çš„ç‰¹æ€§æ˜¯å…¶ä»–Namespaceæ²¡æœ‰çš„ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/64/9c/647a11a38498128e0b00a48931e2f09c.jpg?wh=1920*1080\" alt=\"\"></p><p>æˆ‘ä»¬å¯ä»¥å¯åŠ¨ä¸€ä¸ªå¸¦User Namespaceçš„å®¹å™¨æ¥æ„Ÿå—ä¸€ä¸‹ã€‚è¿™æ¬¡å¯åŠ¨å®¹å™¨ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸‹<a href=\"https://podman.io/\">podman</a>è¿™ä¸ªå·¥å…·ï¼Œè€Œä¸æ˜¯Dockerã€‚</p><p>è·ŸDockerç›¸æ¯”ï¼Œpodmanä¸å†æœ‰å®ˆæŠ¤è¿›ç¨‹dockerdï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡fork/execveçš„æ–¹å¼æ¥å¯åŠ¨ä¸€ä¸ªæ–°çš„å®¹å™¨ã€‚è¿™ç§æ–¹å¼å¯åŠ¨å®¹å™¨æ›´åŠ ç®€å•ï¼Œä¹Ÿæ›´å®¹æ˜“ç»´æŠ¤ã€‚</p><p>Podmançš„å‘½ä»¤å‚æ•°å…¼å®¹äº†ç»å¤§éƒ¨åˆ†çš„dockerå‘½ä»¤è¡Œå‚æ•°ï¼Œç”¨è¿‡Dockerçš„åŒå­¦ä¹Ÿå¾ˆå®¹æ˜“ä¸Šæ‰‹podmanã€‚ä½ æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥è·Ÿç€è¿™ä¸ª<a href=\"https://podman.io/getting-started/installation\">æ‰‹å†Œ</a>åœ¨ä½ è‡ªå·±çš„Linuxç³»ç»Ÿä¸Šè£…ä¸€ä¸‹podmanã€‚</p><p>é‚£æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼š</p><pre><code class=\"language-shell\"># podman run -ti  -v /etc:/mnt --uidmap 0:2000:1000 centos bash\n</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå…¶ä»–å‚æ•°å’Œå‰é¢çš„Dockerå‘½ä»¤æ˜¯ä¸€æ ·çš„ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬åœ¨å‘½ä»¤é‡Œå¢åŠ ä¸€ä¸ªå‚æ•°ï¼Œ\"--uidmap 0:2000:1000\"ï¼Œè¿™ä¸ªæ˜¯æ ‡å‡†çš„User Namespaceä¸­uidçš„æ˜ å°„æ ¼å¼ï¼š\"ns_uid:host_uid:amount\"ã€‚</p><p>é‚£è¿™ä¸ªä¾‹å­é‡Œçš„\"0:2000:1000\"æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæˆ‘ç»™ä½ è§£é‡Šä¸€ä¸‹ã€‚</p><p>ç¬¬ä¸€ä¸ª0æ˜¯æŒ‡åœ¨æ–°çš„Namespaceé‡Œuidä»0å¼€å§‹ï¼Œä¸­é—´çš„é‚£ä¸ª2000æŒ‡çš„æ˜¯Host Namespaceé‡Œè¢«æ˜ å°„çš„uidä»2000å¼€å§‹ï¼Œæœ€åä¸€ä¸ª1000æ˜¯æŒ‡æ€»å…±éœ€è¦è¿ç»­æ˜ å°„1000ä¸ªuidã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼Œ<strong>è¿™ä¸ªå®¹å™¨é‡Œçš„uid 0æ˜¯è¢«æ˜ å°„åˆ°å®¿ä¸»æœºä¸Šçš„uid 2000çš„ã€‚</strong>è¿™ä¸€ç‚¹æˆ‘ä»¬å¯ä»¥éªŒè¯ä¸€ä¸‹ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆåœ¨å®¹å™¨ä¸­ä»¥ç”¨æˆ·uid 0è¿è¡Œä¸€ä¸‹ <code>sleep</code> è¿™ä¸ªå‘½ä»¤ï¼š</p><pre><code class=\"language-shell\"># id\nuid=0(root) gid=0(root) groups=0(root)\n# sleep 3600\n</code></pre><p>ç„¶åå°±æ˜¯ç¬¬äºŒæ­¥ï¼Œåˆ°å®¿ä¸»æœºä¸ŠæŸ¥çœ‹ä¸€ä¸‹è¿™ä¸ªè¿›ç¨‹çš„uidã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿›ç¨‹uidçš„ç¡®æ˜¯2000äº†ã€‚</p><pre><code class=\"language-shell\"># ps -ef |grep sleep\n2000     27021 26957  0 01:32 pts/0    00:00:00 /usr/bin/coreutils --coreutils-prog-shebang=sleep /usr/bin/sleep 3600\n</code></pre><p>ç¬¬ä¸‰æ­¥ï¼Œæˆ‘ä»¬å¯ä»¥å†å›åˆ°å®¹å™¨ä¸­ï¼Œä»ç„¶ä»¥å®¹å™¨ä¸­çš„rootå¯¹è¢«æŒ‚è½½ä¸Šæ¥çš„/etcç›®å½•ä¸‹çš„æ–‡ä»¶åšæ“ä½œï¼Œè¿™æ—¶å¯ä»¥çœ‹åˆ°æ“ä½œæ˜¯ä¸è¢«å…è®¸çš„ã€‚</p><pre><code class=\"language-shell\"># echo \"hello\" &gt;&gt; /mnt/shadow\nbash: /mnt/shadow: Permission denied\n# id\nuid=0(root) gid=0(root) groups=0(root)\n</code></pre><p>å¥½äº†ï¼Œé€šè¿‡è¿™äº›æ“ä½œä»¥åŠå’Œå‰é¢User Namespaceçš„æ¦‚å¿µçš„è§£é‡Šï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºå®¹å™¨ä½¿ç”¨User Namespaceæœ‰ä¸¤ä¸ªå¥½å¤„ã€‚</p><p><strong>ç¬¬ä¸€ï¼Œå®ƒæŠŠå®¹å™¨ä¸­rootç”¨æˆ·ï¼ˆuid 0ï¼‰æ˜ å°„æˆå®¿ä¸»æœºä¸Šçš„æ™®é€šç”¨æˆ·ã€‚</strong></p><p>ä½œä¸ºå®¹å™¨ä¸­çš„rootï¼Œå®ƒè¿˜æ˜¯å¯ä»¥æœ‰ä¸€äº›Linux capabilitiesï¼Œé‚£ä¹ˆåœ¨å®¹å™¨ä¸­è¿˜æ˜¯å¯ä»¥æ‰§è¡Œä¸€äº›ç‰¹æƒçš„æ“ä½œã€‚è€Œåœ¨å®¿ä¸»æœºä¸Šuidæ˜¯æ™®é€šç”¨æˆ·ï¼Œé‚£ä¹ˆå³ä½¿è¿™ä¸ªç”¨æˆ·é€ƒé€¸å‡ºå®¹å™¨Namespaceï¼Œå®ƒçš„æ‰§è¡Œæƒé™è¿˜æ˜¯æœ‰é™çš„ã€‚</p><p><strong>ç¬¬äºŒï¼Œå¯¹äºç”¨æˆ·åœ¨å®¹å™¨ä¸­è‡ªå·±å®šä¹‰æ™®é€šç”¨æˆ·uidçš„æƒ…å†µï¼Œæˆ‘ä»¬åªè¦ä¸ºæ¯ä¸ªå®¹å™¨åœ¨èŠ‚ç‚¹ä¸Šåˆ†é…ä¸€ä¸ªuidèŒƒå›´ï¼Œå°±ä¸ä¼šå‡ºç°åœ¨å®¿ä¸»æœºä¸Šuidå†²çªçš„é—®é¢˜äº†ã€‚</strong></p><p>å› ä¸ºåœ¨è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬åªè¦åœ¨èŠ‚ç‚¹ä¸Šåˆ†é…å®¹å™¨çš„uidèŒƒå›´å°±å¯ä»¥äº†ï¼Œæ‰€ä»¥ä»å®ç°ä¸Šè¯´ï¼Œç›¸æ¯”åœ¨æ•´ä¸ªå¹³å°å±‚é¢ç»™å®¹å™¨åˆ†é…uidï¼Œä½¿ç”¨User Namespaceè¿™ä¸ªåŠæ³•è¦æ–¹ä¾¿å¾—å¤šã€‚</p><p>è¿™é‡Œæˆ‘é¢å¤–è¡¥å……ä¸€ä¸‹ï¼Œå‰é¢æˆ‘ä»¬è¯´äº†Kubernetesç›®å‰è¿˜ä¸æ”¯æŒUser Namespaceï¼Œå¦‚æœä½ æƒ³äº†è§£ç›¸å…³å·¥ä½œçš„è¿›å±•ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ç¤¾åŒºçš„è¿™ä¸ª<a href=\"https://github.com/kubernetes/enhancements/pull/2101\">PR</a>ã€‚</p><h3>æ–¹æ³•ä¸‰ï¼šrootless containerï¼ˆä»¥érootç”¨æˆ·å¯åŠ¨å’Œç®¡ç†å®¹å™¨ï¼‰</h3><p>å‰é¢æˆ‘ä»¬å·²ç»è®¨è®ºäº†ï¼Œåœ¨å®¹å™¨ä¸­ä»¥érootç”¨æˆ·è¿è¡Œè¿›ç¨‹å¯ä»¥é™ä½å®¹å™¨çš„å®‰å…¨é£é™©ã€‚é™¤äº†åœ¨å®¹å™¨ä¸­ä½¿ç”¨érootç”¨æˆ·ï¼Œç¤¾åŒºè¿˜æœ‰ä¸€ä¸ªrootless containerçš„æ¦‚å¿µã€‚</p><p>è¿™é‡Œrootless containerä¸­çš„\"rootless\"ä¸ä»…ä»…æŒ‡å®¹å™¨ä¸­ä»¥érootç”¨æˆ·æ¥è¿è¡Œè¿›ç¨‹ï¼Œè¿˜æŒ‡ä»¥érootç”¨æˆ·æ¥åˆ›å»ºå®¹å™¨ï¼Œç®¡ç†å®¹å™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯åŠ¨å®¹å™¨çš„æ—¶å€™ï¼ŒDockeræˆ–è€…podmanæ˜¯ä»¥érootç”¨æˆ·æ¥æ‰§è¡Œçš„ã€‚</p><p>è¿™æ ·ä¸€æ¥ï¼Œå°±èƒ½è¿›ä¸€æ­¥æå‡å®¹å™¨ä¸­çš„å®‰å…¨æ€§ï¼Œæˆ‘ä»¬ä¸ç”¨å†æ‹…å¿ƒå› ä¸ºcontainerdæˆ–è€…RunCé‡Œçš„ä»£ç æ¼æ´ï¼Œå¯¼è‡´å®¹å™¨è·å¾—å®¿ä¸»æœºä¸Šçš„æƒé™ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å‚è€ƒredhat blogé‡Œçš„è¿™ç¯‡<a href=\"https://developers.redhat.com/blog/2020/09/25/rootless-containers-with-podman-the-basics/\">æ–‡æ¡£</a>ï¼Œ åœ¨å®¿ä¸»æœºä¸Šç”¨redhatè¿™ä¸ªç”¨æˆ·é€šè¿‡podmanæ¥å¯åŠ¨ä¸€ä¸ªå®¹å™¨ã€‚åœ¨è¿™ä¸ªå®¹å™¨ä¸­ä¹Ÿä½¿ç”¨äº†User Namespaceï¼Œå¹¶ä¸”æŠŠå®¹å™¨ä¸­çš„uid 0æ˜ å°„ä¸ºå®¿ä¸»æœºä¸Šçš„redhatç”¨æˆ·äº†ã€‚</p><pre><code class=\"language-shell\">$ id\nuid=1001(redhat) gid=1001(redhat) groups=1001(redhat)\n$ podman run -it  ubi7/ubi bash   ### åœ¨å®¿ä¸»æœºä¸Šä»¥redhatç”¨æˆ·å¯åŠ¨å®¹å™¨\n[root@206f6d5cb033 /]# id     ### å®¹å™¨ä¸­çš„ç”¨æˆ·æ˜¯root\nuid=0(root) gid=0(root) groups=0(root)\n[root@206f6d5cb033 /]# sleep 3600   ### åœ¨å®¹å™¨ä¸­å¯åŠ¨ä¸€ä¸ªsleep è¿›ç¨‹\n</code></pre><pre><code class=\"language-shell\"># ps -ef |grep sleep   ###åœ¨å®¿ä¸»æœºä¸ŠæŸ¥çœ‹å®¹å™¨sleepè¿›ç¨‹å¯¹åº”çš„ç”¨æˆ·\nredhat   29433 29410  0 05:14 pts/0    00:00:00 sleep 3600\n</code></pre><p>ç›®å‰Dockerå’Œpodmanéƒ½æ”¯æŒäº†rootless containerï¼ŒKuberneteså¯¹<a href=\"https://github.com/kubernetes/enhancements/issues/2033\">rootless containeræ”¯æŒ</a>çš„å·¥ä½œä¹Ÿåœ¨è¿›è¡Œä¸­ã€‚</p><h2>é‡ç‚¹å°ç»“</h2><p>æˆ‘ä»¬ä»Šå¤©è®¨è®ºçš„å†…å®¹æ˜¯rootç”¨æˆ·ä¸å®¹å™¨å®‰å…¨çš„é—®é¢˜ã€‚</p><p>å°½ç®¡å®¹å™¨ä¸­rootç”¨æˆ·çš„Linux capabilitieså·²ç»å‡å°‘äº†å¾ˆå¤šï¼Œä½†æ˜¯åœ¨æ²¡æœ‰User Namespaceçš„æƒ…å†µä¸‹ï¼Œå®¹å™¨ä¸­rootç”¨æˆ·å’Œå®¿ä¸»æœºä¸Šçš„rootç”¨æˆ·çš„uidæ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œä¸€æ—¦æœ‰è½¯ä»¶çš„æ¼æ´ï¼Œå®¹å™¨ä¸­çš„rootç”¨æˆ·å°±å¯ä»¥æ“æ§æ•´ä¸ªå®¿ä¸»æœºã€‚</p><p><strong>ä¸ºäº†å‡å°‘å®‰å…¨é£é™©ï¼Œä¸šç•Œéƒ½æ˜¯å»ºè®®åœ¨å®¹å™¨ä¸­ä»¥érootç”¨æˆ·æ¥è¿è¡Œè¿›ç¨‹ã€‚</strong>ä¸è¿‡åœ¨æ²¡æœ‰User Namespaceçš„æƒ…å†µä¸‹ï¼Œåœ¨å®¹å™¨ä¸­ä½¿ç”¨érootç”¨æˆ·ï¼Œå¯¹äºå®¹å™¨äº‘å¹³å°æ¥è¯´ï¼Œå¯¹uidçš„ç®¡ç†ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦åˆ†æä¸€ä¸‹User Namespaceï¼Œå®ƒå¸¦æ¥çš„å¥½å¤„æœ‰ä¸¤ä¸ªã€‚ä¸€ä¸ªæ˜¯æŠŠå®¹å™¨ä¸­rootç”¨æˆ·ï¼ˆuid 0ï¼‰æ˜ å°„æˆå®¿ä¸»æœºä¸Šçš„æ™®é€šç”¨æˆ·ï¼Œå¦å¤–ä¸€ä¸ªå¥½å¤„æ˜¯åœ¨äº‘å¹³å°é‡Œå¯¹äºå®¹å™¨uidçš„åˆ†é…è¦å®¹æ˜“äº›ã€‚</p><p>é™¤äº†åœ¨å®¹å™¨ä¸­ä»¥érootç”¨æˆ·æ¥è¿è¡Œè¿›ç¨‹å¤–ï¼ŒDockerå’Œpodmanéƒ½æ”¯æŒäº†rootless containerï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬éƒ½å¯ä»¥ä»¥érootç”¨æˆ·æ¥å¯åŠ¨å’Œç®¡ç†å®¹å™¨ï¼Œè¿™æ ·å°±è¿›ä¸€æ­¥é™ä½äº†å®¹å™¨çš„å®‰å…¨é£é™©ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æˆ‘åœ¨è¿™ä¸€è®²é‡Œæåˆ°äº†rootless containerï¼Œä¸è¿‡å¯¹äºrootless containerçš„æ”¯æŒï¼Œè¿˜å­˜åœ¨ç€ä¸å°‘çš„éš¾ç‚¹ï¼Œæ¯”å¦‚å®¹å™¨ç½‘ç»œçš„é…ç½®ã€Cgroupçš„é…ç½®ï¼Œä½ å¯ä»¥å»æŸ¥é˜…ä¸€äº›èµ„æ–™ï¼Œçœ‹çœ‹podmanæ˜¯æ€ä¹ˆè§£å†³è¿™äº›é—®é¢˜çš„ã€‚</p><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºæå‡ºä½ çš„æ€è€ƒå’Œç–‘é—®ã€‚å¦‚æœè¿™ä¸€è®²å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä¹Ÿæ¬¢è¿è½¬å‘ç»™ä½ çš„åŒäº‹ã€æœ‹å‹ï¼Œä¸€èµ·äº¤æµå­¦ä¹ ã€‚</p>","comments":[{"had_liked":false,"id":271028,"user_name":"æˆ‘æ¥ä¹Ÿ","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1609376919,"is_pvip":false,"replies":[{"id":"98377","content":"@æˆ‘æ¥ä¹Ÿ<br>å¾ˆå¥½çš„é—®é¢˜ã€‚æˆ‘ä»¬åœ¨æœ€å¼€å§‹ä¹Ÿè€ƒè™‘è¿‡ä½¿ç”¨lxcfs, å½“æ—¶ç¢°åˆ°çš„é—®é¢˜ä¹Ÿæ˜¯å½“ä¸€æ‰¹javaåº”ç”¨ä»è™šæ‹Ÿæœºè¿ç§»åˆ°å®¹å™¨å¹³å°ä¹‹åï¼Œå‘ç°jvmçœ‹åˆ°çš„æ˜¯æ•´ä¸ªå®¿ä¸»æœºçš„èµ„æºã€‚<br><br>ä¸è¿‡åæ¥ï¼Œå‘ç°å¤§éƒ¨åˆ†è¯­è¨€å’Œåº”ç”¨éƒ½æ˜¯å¯ä»¥åŠ å‚æ•°æˆ–è€…åšä¿®æ”¹æ¥é€‚é…å®¹å™¨åŒ–çš„ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬çš„æ–¹å‘æ˜¯è®©åº”ç”¨ä¹Ÿå¿…é¡»è€ƒè™‘å®¹å™¨å’Œäº‘åŸç”Ÿçš„è®¾è®¡ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯å¤§çš„è¶‹åŠ¿ï¼Œåº”ç”¨è¿™è¾¹ä¹Ÿæ˜¯æ„¿æ„æ¥å—è¿™ä¸ªæ”¹å˜çš„ã€‚<br><br>è¿˜æœ‰ä¸€ç‚¹ï¼Œå½“æ—¶æˆ‘ä»¬åœ¨è¯•lxcfsçš„æ—¶å€™å‘ç°ï¼Œå¦‚æœå®¹å™¨éœ€è¦çš„cpuä¸æ˜¯æ•´æ•°ï¼Œä¼¼ä¹lxcfsä¹Ÿä¸èƒ½æ”¯æŒï¼ˆä¸çŸ¥é“æœ€æ–°çš„lxcfsæ˜¯ä¸æ˜¯æœ‰æ‰€æ”¹å˜ï¼‰ï¼ŒåŒæ—¶åœ¨hostä¸Šéœ€è¦é¢å¤–ç»´æŠ¤è¿™ä¸ªlxcfsçš„å¯é æ€§ã€‚ è¿™æ ·åœ¨å¤§éƒ¨åˆ†ä¸»è¦åº”ç”¨éƒ½æ„¿æ„å¾€å®¹å™¨åŒ–æ–¹å‘èµ°çš„å¤§ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬å°±ä¸å†è€ƒè™‘lxcfsäº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1609596270,"ip_address":"","comment_id":271028,"utype":1}],"discussion_count":8,"race_medal":0,"score":"57443951767","product_id":100063801,"comment_content":"æœ€è¿‘åœ¨ä½¿ç”¨Helméƒ¨ç½²gitlabæœåŠ¡çš„è¿‡ç¨‹ä¸­,å°±å‘ç°äº† postgresql å’Œ redis ç»„ä»¶é»˜è®¤æ˜¯ä¸ä»¥rootç”¨æˆ·æ‰§è¡Œçš„,è€Œæ˜¯ä¸€ä¸ª User ID ä¸º1001çš„ç”¨æˆ·åœ¨æ‰§è¡Œ.<br>è¿™æ ·åš,å°±éœ€è¦æœ‰ä¸ªk8sçš„ initContainer å®¹å™¨å…ˆä»¥rootç”¨æˆ·æƒé™å»ä¿®æ”¹å­˜å‚¨ç›®å½•çš„æƒé™. å¦åˆ™åé¢æœåŠ¡çš„1001å·ç”¨æˆ·å¯èƒ½å°±æ²¡æœ‰æƒé™å»å†™æ–‡ä»¶äº†.<br>------------------<br><br>æœ€è¿‘é‡åˆ°ä¸€ä¸ªé—®é¢˜,æƒ³å’¨è¯¢ä¸€ä¸‹è€å¸ˆ:<br>ä½ ä»¬æœ‰ä½¿ç”¨è¿‡ å®¹å™¨èµ„æºå¯è§†åŒ–éš”ç¦»æ–¹æ¡ˆ(lxcfs) ä¹ˆ, æœ‰æ²¡æœ‰ä»€ä¹ˆå‘?<br>é€šä¿—ç‚¹å°±æ˜¯:è®©å®¹å™¨ä¸­çš„free, topç­‰å‘½ä»¤çœ‹åˆ°å®¹å™¨çš„æ•°æ®ï¼Œè€Œä¸æ˜¯ç‰©ç†æœºçš„æ•°æ®ã€‚<br>------------------<br><br>æˆ‘é‡åˆ°çš„é—®é¢˜æ˜¯åœ¨å®¹å™¨å†…æ‰§è¡Œç±»ä¼¼`go build&#47;test`å‘½ä»¤æ—¶,é»˜è®¤æ˜¯æ ¹æ®å½“å‰CPUæ ¸æ•°æ¥è°ƒæ•´æ„å»ºçš„å¹¶å‘æ•°.<br>è¿™å°±å¯¼è‡´äº†å®é™…åªç»™å®¹å™¨åˆ†é…äº†1ä¸ªæ ¸,ä½†æ˜¯å®ƒä»¥ä¸ºè‡ªå·±æœ‰16ä¸ªæ ¸.<br>ç„¶åå°±å¼€16ä¸ªlinkè¿›ç¨‹,äº’ç›¸ä¹‹é—´é™¤äº†æœ‰ç«äº‰,å¯¼è‡´CPUä¸Šä¸‹æ–‡åˆ‡æ¢é¢‘ç¹,æ›´è¦å‘½çš„æ˜¯æŠŠç£ç›˜IOç»™å¼„æ»¡äº†.å½±å“äº†æ•´å°å®¿ä¸»æœºçš„æ€§èƒ½.<br>(ç”±äºé¡¹ç›®æ¯”è¾ƒå¤§,éœ€è¦æ„å»ºçš„æ–‡ä»¶æ¯”è¾ƒå¤š,æ‰€ä»¥å¾ˆå®¹å™¨å°±è®©å®¿ä¸»æœºçš„IOè¾¾åˆ°äº†äº‘æœåŠ¡å™¨SSDç£ç›˜çš„é™åˆ¶ 160MB&#47;s)<br><br>æˆ‘çŸ¥é“åœ¨æˆ‘è¿™ä¸ªåœºæ™¯ä¸‹,å¯ä»¥é€šè¿‡æŒ‡å®šæ„å»ºå‘½ä»¤`-p`æ¥æ§åˆ¶æ„å»ºçš„å¹¶å‘æ•°.<br>(https:&#47;&#47;golang.org&#47;cmd&#47;go&#47;#hdr-Compile_packages_and_dependencies)<br>å®é™…ä¹Ÿè¿™ä¹ˆå°è¯•è¿‡,æ•ˆæœä¹Ÿä¸é”™.<br>ä½†é—®é¢˜æ˜¯,æˆ‘çš„é¡¹ç›®ä¼šå¾ˆå¤š,æ¯ä¸ªäººæ„å»ºå‘½ä»¤çš„å†™æ³•éƒ½å®Œå…¨ä¸ä¸€æ ·,å¦‚æœæ¯ä¸ªåœ°æ–¹éƒ½å»æŒ‡å®šå‚æ•°,å°±ä¼šæ¯”è¾ƒç¹ç,ä¸”å®¹æ˜“é—æ¼.<br><br>------------------<br>åæ¥,æˆ‘çœ‹åˆ°ä¸€ç¯‡æ–‡ç« : å®¹å™¨èµ„æºå¯è§†åŒ–éš”ç¦»çš„å®ç°æ–¹æ³•<br>(https:&#47;&#47;mp.weixin.qq.com&#47;s&#47;SCxD4OiDYsmoIyN5XMk4YA)<br><br>ä¹‹å‰ä¹Ÿåœ¨å…¶ä»–ä¸“æ ä¸­çœ‹è€å¸ˆæåˆ°è¿‡ lxcfs.<br>æˆ‘åœ¨æƒ³,è€å¸ˆåœ¨è¿ç§»ä¸Šk8sçš„è¿‡ç¨‹ä¸­,è‚¯å®šä¹Ÿé‡åˆ°è¿‡ç±»ä¼¼çš„é—®é¢˜,ä¸çŸ¥é“è€å¸ˆæ˜¯å¦‚ä½•è§£å†³çš„å‘¢?<br><br>","like_count":14,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":512822,"discussion_content":"@æˆ‘æ¥ä¹Ÿ\nå¾ˆå¥½çš„é—®é¢˜ã€‚æˆ‘ä»¬åœ¨æœ€å¼€å§‹ä¹Ÿè€ƒè™‘è¿‡ä½¿ç”¨lxcfs, å½“æ—¶ç¢°åˆ°çš„é—®é¢˜ä¹Ÿæ˜¯å½“ä¸€æ‰¹javaåº”ç”¨ä»è™šæ‹Ÿæœºè¿ç§»åˆ°å®¹å™¨å¹³å°ä¹‹åï¼Œå‘ç°jvmçœ‹åˆ°çš„æ˜¯æ•´ä¸ªå®¿ä¸»æœºçš„èµ„æºã€‚\n\nä¸è¿‡åæ¥ï¼Œå‘ç°å¤§éƒ¨åˆ†è¯­è¨€å’Œåº”ç”¨éƒ½æ˜¯å¯ä»¥åŠ å‚æ•°æˆ–è€…åšä¿®æ”¹æ¥é€‚é…å®¹å™¨åŒ–çš„ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬çš„æ–¹å‘æ˜¯è®©åº”ç”¨ä¹Ÿå¿…é¡»è€ƒè™‘å®¹å™¨å’Œäº‘åŸç”Ÿçš„è®¾è®¡ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯å¤§çš„è¶‹åŠ¿ï¼Œåº”ç”¨è¿™è¾¹ä¹Ÿæ˜¯æ„¿æ„æ¥å—è¿™ä¸ªæ”¹å˜çš„ã€‚\n\nè¿˜æœ‰ä¸€ç‚¹ï¼Œå½“æ—¶æˆ‘ä»¬åœ¨è¯•lxcfsçš„æ—¶å€™å‘ç°ï¼Œå¦‚æœå®¹å™¨éœ€è¦çš„cpuä¸æ˜¯æ•´æ•°ï¼Œä¼¼ä¹lxcfsä¹Ÿä¸èƒ½æ”¯æŒï¼ˆä¸çŸ¥é“æœ€æ–°çš„lxcfsæ˜¯ä¸æ˜¯æœ‰æ‰€æ”¹å˜ï¼‰ï¼ŒåŒæ—¶åœ¨hostä¸Šéœ€è¦é¢å¤–ç»´æŠ¤è¿™ä¸ªlxcfsçš„å¯é æ€§ã€‚ è¿™æ ·åœ¨å¤§éƒ¨åˆ†ä¸»è¦åº”ç”¨éƒ½æ„¿æ„å¾€å®¹å™¨åŒ–æ–¹å‘èµ°çš„å¤§ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬å°±ä¸å†è€ƒè™‘lxcfsäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609596270,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1205253,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","nickname":"æˆ‘æ¥ä¹Ÿ","note":"","ucode":"773D6104F56767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":346502,"discussion_content":"å†æ¥æ›´æ–°ä¸€ä¸‹ï¼Œgolangæœ‰ä¸€ä¸ªå…¨å±€çš„ç¯å¢ƒå˜é‡GOFLAGSï¼Œå¯ä»¥åœ¨è¿™ä¸ªé‡Œé¢æŒ‡å®šæ„å»ºå‚æ•°ï¼Œæ¯”å¦‚-p=1ï¼Œè¿™æ ·ï¼Œgo buildä¼šä»ç¯å¢ƒå˜é‡ä¸­è·å–åˆ°è¯¥ä¿¡æ¯ï¼Œä»è€Œå½±å“æ„å»ºè¿‡ç¨‹ã€‚ä¸éœ€è¦åœ¨æ¯ä¸ªgo buildåé¢æŒ‡å®š-på‚æ•°äº†","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1611975507,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1109273,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ed/19/4e6347ce.jpg","nickname":"è½¦ferrari","note":"","ucode":"4CA6634DA7B66C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573416,"discussion_content":"å¯ä»¥è¯•è¯•Uberçš„automaxprocs","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1653401282,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1205253,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","nickname":"æˆ‘æ¥ä¹Ÿ","note":"","ucode":"773D6104F56767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":341484,"discussion_content":"æˆ‘æ¥æ›´æ–°ä¸‹:\n\næˆ‘æŒ‰ç…§é“¾æ¥ä¸­çš„æ–¹æ³•,éƒ¨ç½²äº†lxcfså’Œå¯¹åº”çš„k8s admission,åˆ›å»ºçš„podç”¨topå‘½ä»¤çœ‹,cpuå’Œå†…å­˜ä¹Ÿç¡®å®æ˜¯å®¹å™¨çš„,è€Œä¸å†æ˜¯å®¿ä¸»æœºçš„äº†.\nä½†æ˜¯,è¿™ä¸ªæ“ä½œéª—ä¸äº†golangç¨‹åº.\n\nè¿™æ˜¯å› ä¸º è™½ç„¶ lxcfs æˆåŠŸæŒ‚è½½äº†å¿…è¦ä¿¡æ¯åˆ° /proc/cpuinfo é‡Œï¼Œä½†æ˜¯golang è¿è¡Œæ—¶é€šè¿‡ [sched_getaffinity](https://golang.google.cn/src/runtime/os_linux.go#L82) ç³»ç»Ÿè°ƒç”¨æ¥è·å– cpu æ•°é‡ï¼Œæ‰€ä»¥ lxcfs è¿˜æ˜¯ä¸èƒ½å½»åº•è§£å†³é—®é¢˜ã€‚\n\nè¯¦è§è¿™é‡Œ:\nhttps://github.com/islishude/blog/issues/216\n\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1610432873,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1294897,"avatar":"https://static001.geekbang.org/account/avatar/00/13/c2/31/d381fbd6.jpg","nickname":"yangs","note":"","ucode":"25D11BE2505953","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":567466,"discussion_content":"https://github.com/uber-go/automaxprocs åœ¨å®¹å™¨ä¸­éƒ¨ç½²goçš„åº”ç”¨å¯ä»¥ä½¿ç”¨è¿™ä¸ªåŒ…æ¥è·å–å®¹å™¨åˆ†é…çš„æ ¸æ•°ï¼Œé˜²æ­¢å‡ºç°ä½ è¯´çš„goèµ„æºé¢‘ç¹åˆ‡æ¢çš„é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650931289,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1025641,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a6/69/cf2eb6be.jpg","nickname":"æ™¯b","note":"","ucode":"70E04E6B30432C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368504,"discussion_content":"inité‡Œå†™å®Œå†chownå‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618736260,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1205253,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","nickname":"æˆ‘æ¥ä¹Ÿ","note":"","ucode":"773D6104F56767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1025641,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a6/69/cf2eb6be.jpg","nickname":"æ™¯b","note":"","ucode":"70E04E6B30432C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368509,"discussion_content":"æ²¡å¤ªç†è§£æ˜¯ä»€ä¹ˆæ„æ€ğŸ˜‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618737578,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":368504,"ip_address":""},"score":368509,"extra":""}]},{"author":{"id":1205253,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","nickname":"æˆ‘æ¥ä¹Ÿ","note":"","ucode":"773D6104F56767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339306,"discussion_content":"éå¸¸æ„Ÿè°¢è€å¸ˆçš„å›å¤ã€‚\n\néœ€è¦åœ¨hostä¸Šé¢å¤–ç»´æŠ¤lxcfsçš„å¯é æ€§ï¼Œç¡®å®šä¹Ÿæ˜¯æœ‰æˆæœ¬çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609597735,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":272680,"user_name":"æœ±æ–°å¨","can_delete":false,"product_type":"c1","uid":2326208,"ip_address":"","ucode":"50E7A6D0873853","user_header":"https://static001.geekbang.org/account/avatar/00/23/7e/c0/1c3fd7dd.jpg","comment_is_top":false,"comment_ctime":1610200561,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"14495102449","product_id":100063801,"comment_content":"è€å¸ˆï¼Œæˆ‘å‘ç°ä¸€ä¸ªå¾ˆæœ‰è¶£çš„ç°è±¡ï¼Œæœ‰ç‚¹å›°æƒ‘ï¼›<br><br>åœ¨å®¿ä¸»æœºä¸Šï¼š<br>ä»¥rootç”¨æˆ·è¿è¡Œcapsh --print<br>å‘ç°Currentå­—æ®µåŒ…å«è®¸å¤šcapabilities<br><br>ä»¥érootç”¨æˆ·è¿è¡Œcapsh --print<br>å‘ç°Current å­—æ®µåŒ…å«é›¶ä¸ªcapabilitiesï¼Œè¯´æ˜érootç”¨æˆ·å¯åŠ¨çš„è¿›ç¨‹ç¼ºçœæ²¡æœ‰ä»»ä½•capabilities<br><br>dockerå®¹å™¨å†…ï¼š<br>rootç”¨æˆ·è¿è¡Œcapsh --print<br>å‘ç°Current å­—æ®µåŒ…å«14ä¸ªcapabilitiesï¼Œæ¯”å®¿ä¸»æœºä¸Šå°‘äº†ä¸€äº›ï¼Œå¯¹å®¿ä¸»æœºçš„&#47;etc&#47;shadowæœ‰è¯»å†™æƒé™<br><br>érootç”¨æˆ·è¿è¡Œcapsh --print<br>å‘ç°Currentå­—æ®µä»ç„¶åŒ…å«14ä¸ªcapabilitiesï¼Œå¯¹å®¿ä¸»æœºçš„&#47;etc&#47;shadowæ²¡æœ‰è¯»å†™æƒé™<br><br>è¿™å°±è®©æˆ‘æ„Ÿè§‰æœ‰ç‚¹å›°æƒ‘äº†ï¼ŒåŸæœ¬é¢„æœŸå®¹å™¨å†…érootç”¨æˆ·è¿è¡Œcapsh  --printçš„capabilitiesåº”è¯¥ä¸ºç©ºå‘€ï¼Œæˆ–è€…çŸ¥é“å°‘äºrootç”¨æˆ·çš„capabilitieså§ï¼Ÿ","like_count":3},{"had_liked":false,"id":272198,"user_name":"Sun","can_delete":false,"product_type":"c1","uid":1013638,"ip_address":"","ucode":"092D74311B8651","user_header":"https://static001.geekbang.org/account/avatar/00/0f/77/86/4ff2a872.jpg","comment_is_top":false,"comment_ctime":1609986835,"is_pvip":false,"replies":[{"id":"98824","content":"@Sun å¾ˆå¥½çš„é—®é¢˜ï¼<br>æˆ‘åœ¨è¿™é‡ŒæŒ‡çš„æ˜¯pam_limitsï¼Œ åœ¨&#47;etc&#47;security&#47;limits.confä¸­é™åˆ¶æŸä¸ªç”¨æˆ·èµ„æºä¹‹åï¼Œç„¶ååœ¨pam *_auth å’Œ runuserä¸­enable pam_limits ä¹‹åï¼Œé‚£ä¹ˆåŒä¸€ä¸ªç”¨æˆ·å³ä½¿åœ¨ä¸åŒçš„sessioné‡Œï¼Œèµ„æºçš„é™åˆ¶ä¹Ÿæ˜¯ç´¯è®¡äº†ã€‚<br>ä½ å¯ä»¥åœ¨CentOSçš„ç³»ç»Ÿé‡Œè¯•è¯•ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1610197093,"ip_address":"","comment_id":272198,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10199921427","product_id":100063801,"comment_content":"<br>user limit æ˜¯sessionçš„ï¼Ÿæ¯ä¸ªå®¹å™¨åŠæ—¶ä½¿ç”¨ç›¸åŒçš„user id ï¼Œä¹Ÿä¸ä¼šå½“åšç´¯è®¡ï¼Ÿ<br><br>User resource limits dictate the amount of resources that can be used for a particular session. The resources that can be controled are:<br><br>maximum size of core files<br>maximum size of a process&#39;s data segment<br>maximum size of files created<br>maximum size that may be locked into memory<br>maximum size of resident memory<br>maximum number of file descriptors open at one time<br>maximum size of the stack<br>maximum amount of cpu time used<br>maximum number of processes allowed<br>maximum size of virtual memory available<br>It is important to note that these settings are per-session. This means that they are only effective for the time that the user is logged in (and for any processes that they run during that period). They are not global settings. In other words, they are only active for the duration of the session and the settings are not cumulative. For example, if you set the maximum number of processes to 11, the user may only have 11 processes running per session. They are not limited to 11 total processes on the machine as they may initiate another session. Each of the settings are per process settings during the session, with the exception of the maximum number of processes.<br>","like_count":2,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513197,"discussion_content":"@Sun å¾ˆå¥½çš„é—®é¢˜ï¼\næˆ‘åœ¨è¿™é‡ŒæŒ‡çš„æ˜¯pam_limitsï¼Œ åœ¨/etc/security/limits.confä¸­é™åˆ¶æŸä¸ªç”¨æˆ·èµ„æºä¹‹åï¼Œç„¶ååœ¨pam *_auth å’Œ runuserä¸­enable pam_limits ä¹‹åï¼Œé‚£ä¹ˆåŒä¸€ä¸ªç”¨æˆ·å³ä½¿åœ¨ä¸åŒçš„sessioné‡Œï¼Œèµ„æºçš„é™åˆ¶ä¹Ÿæ˜¯ç´¯è®¡äº†ã€‚\nä½ å¯ä»¥åœ¨CentOSçš„ç³»ç»Ÿé‡Œè¯•è¯•ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610197093,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1025641,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a6/69/cf2eb6be.jpg","nickname":"æ™¯b","note":"","ucode":"70E04E6B30432C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":371872,"discussion_content":"è®¾ç½®äº†å®¿ä¸»æœºæ–‡ä»¶/etc/pam.d/login  session required /lib/security/pam_limits.so\nè·‘äº†ä¸ªpod\napiVersion: v1\nkind: Pod\nmetadata:\n  name: req-tencent\n  namespace: default\nspec:\n  securityContext:\n    runAsUser: 6667\n    runAsGroup: 6667\n    fsGroup: 6667\n    runAsNonRoot: true\n\nå®¿ä¸»æœºè®¾ç½®äº†\n/etc/security/limits.conf  \nnonroot hard nofile 2\nnonroot soft nofile 2\n\nid nonroot\nuid=6667(nonroot) gid=6667(nonroot) groups=6667(nonroot)\n\npodè·‘èµ·æ¥å  è¿˜æ˜¯æ²¡æœ‰ç”Ÿæ•ˆ \nkubectl exec req-tencent -- ulimit -n\n65536\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620030106,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":281614,"user_name":"Action","can_delete":false,"product_type":"c1","uid":1239234,"ip_address":"","ucode":"FFFD1537C6BB3C","user_header":"https://static001.geekbang.org/account/avatar/00/12/e8/c2/77a413a7.jpg","comment_is_top":false,"comment_ctime":1614828576,"is_pvip":false,"replies":[{"id":"102400","content":"-u åªæ˜¯æŒ‡å®šäº†åœ¨å®¹å™¨å¯åŠ¨çš„æ—¶å€™ç¼ºçœç”¨çš„uid&#47;gid, è¿™é‡Œçš„uid&#47;gidå’Œå®¿ä¸»æœºä¸Šçš„æ˜¯ä¸€æ ·çš„ï¼Œå¹¶æ²¡æœ‰å»ºç«‹å‡ºæ–°çš„user namespace.","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1615039414,"ip_address":"","comment_id":281614,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5909795872","product_id":100063801,"comment_content":"è€å¸ˆ docker -u å‚æ•° æ˜¯ä¸æ˜¯å°±æ˜¯ é€šè¿‡user namespace è¿›è¡Œéš”ç¦»","like_count":1,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":516455,"discussion_content":"-u åªæ˜¯æŒ‡å®šäº†åœ¨å®¹å™¨å¯åŠ¨çš„æ—¶å€™ç¼ºçœç”¨çš„uid/gid, è¿™é‡Œçš„uid/gidå’Œå®¿ä¸»æœºä¸Šçš„æ˜¯ä¸€æ ·çš„ï¼Œå¹¶æ²¡æœ‰å»ºç«‹å‡ºæ–°çš„user namespace.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615039414,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2608728,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ce/58/71ed845f.jpg","nickname":"Dexter","note":"","ucode":"909CABC4AC4AC9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544705,"discussion_content":"dockeråº”è¯¥æ”¯æŒuser namespaceå§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641649332,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356861,"user_name":"JianXu","can_delete":false,"product_type":"c1","uid":1033219,"ip_address":"ä¸Šæµ·","ucode":"2A61BDBB573BDC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c4/03/f753fda7.jpg","comment_is_top":false,"comment_ctime":1662647450,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1662647450","product_id":100063801,"comment_content":"install slirp4netns and Podman on your machine by entering the following command:<br><br>$ yum install slirp4netns podman -y<br>We will use slirp4netns to connect a network namespace to the internet in a completely rootless (or unprivileged) way.","like_count":0},{"had_liked":false,"id":352270,"user_name":"è‡ªç„¶","can_delete":false,"product_type":"c1","uid":1181887,"ip_address":"","ucode":"EDFC3EFAB0B88E","user_header":"https://static001.geekbang.org/account/avatar/00/12/08/bf/cd6bfc22.jpg","comment_is_top":false,"comment_ctime":1658489571,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1658489571","product_id":100063801,"comment_content":"æœ‰ä¸ªåœºæ™¯ï¼šç”¨jenkins  åœ¨ openjdké•œåƒé‡Œ maven ç¼–è¯‘javaé¡¹ç›®, ä¸€ä¸ª mavenç›®å½•ï¼ˆåœ¨ä¸»æœºä¸Šï¼Œè€Œä¸”è¿˜æœ‰å…¶ä»–å¾ˆå¤šå·¥å…·ï¼‰ï¼Œä¸€ä¸ªé¡¹ç›®æºç ç›®å½•  éœ€è¦æ˜ å°„åˆ°  openjdké•œåƒé‡Œï¼ˆæ™®é€šç”¨æˆ·å¯åŠ¨dockerï¼‰ï¼Œjenkins é‡Œçš„pipline æ˜¯å¤§å®¶éƒ½å¯ä»¥å†™çš„ã€‚ å¦‚ä½•é˜²æ­¢ åŠ è½½ä¸»æœºä¸Šç›®å½• åœ¨dockeré•œåƒé‡Œ rootç”¨æˆ· éšæ„ä¿®æ”¹å‘¢ï¼ˆ æ¯”å¦‚ æˆ‘ä¸æƒ³ä»–åˆ é™¤ ä¸»æœºä¸Šçš„mavenï¼‰ï¼Ÿ","like_count":0},{"had_liked":false,"id":343300,"user_name":"sunnoy","can_delete":false,"product_type":"c1","uid":1641271,"ip_address":"","ucode":"CB7F33F364B669","user_header":"https://static001.geekbang.org/account/avatar/00/19/0b/37/20ac0432.jpg","comment_is_top":false,"comment_ctime":1650771586,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1650771586","product_id":100063801,"comment_content":"å¦‚æœå®¹å™¨å†…çš„ç”¨æˆ·uidåœ¨å®¿ä¸»æœºä¸Šä¸å­˜åœ¨å‘¢ï¼Œè¿™ä¸ªæ—¶å€™æè¿°ç¬¦çš„åˆ†é…æ˜¯æ€ä¹ˆæ ·çš„å‘¢","like_count":0},{"had_liked":false,"id":281641,"user_name":"Action","can_delete":false,"product_type":"c1","uid":1239234,"ip_address":"","ucode":"FFFD1537C6BB3C","user_header":"https://static001.geekbang.org/account/avatar/00/12/e8/c2/77a413a7.jpg","comment_is_top":false,"comment_ctime":1614838311,"is_pvip":false,"replies":[{"id":"102401","content":"å½“å®¹å™¨æ²¡æœ‰ä½¿ç”¨user namespaceï¼Œ é‚£ä¹ˆå®¹å™¨ä¸­è¿›ç¨‹æ‰€å±çš„uid&#47;gid, å°±æ˜¯å®¿ä¸»æœºé‡Œuid&#47;gidã€‚ä½ å¯ä»¥è¿è¡Œä¸€ä¸‹è¯¾ç¨‹ä¸­çš„ä¾‹å­ï¼Œä»å®¿ä¸»æœºä¸Šçœ‹çœ‹å®¹å™¨è¿›ç¨‹çš„uidã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1615039777,"ip_address":"","comment_id":281641,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1614838311","product_id":100063801,"comment_content":"&quot;ç”±äºç”¨æˆ· uid æ˜¯æ•´ä¸ªèŠ‚ç‚¹ä¸­å…±äº«çš„ï¼Œé‚£ä¹ˆåœ¨å®¹å™¨ä¸­å®šä¹‰çš„ uidï¼Œä¹Ÿå°±æ˜¯å®¿ä¸»æœºä¸Šçš„ uidï¼Œè¿™æ ·å°±å¾ˆå®¹æ˜“å¼•èµ· uid çš„å†²çªã€‚&quot;è€å¸ˆè¿™å¥è¯æ€ä¹ˆç†è§£ï¼Œå®¹å™¨å†…uidä¸å®¿ä¸»æœºuidæ˜¯æ€ä¹ˆæ ·çš„å…³ç³»å‘¢","like_count":0,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":516460,"discussion_content":"å½“å®¹å™¨æ²¡æœ‰ä½¿ç”¨user namespaceï¼Œ é‚£ä¹ˆå®¹å™¨ä¸­è¿›ç¨‹æ‰€å±çš„uid/gid, å°±æ˜¯å®¿ä¸»æœºé‡Œuid/gidã€‚ä½ å¯ä»¥è¿è¡Œä¸€ä¸‹è¯¾ç¨‹ä¸­çš„ä¾‹å­ï¼Œä»å®¿ä¸»æœºä¸Šçœ‹çœ‹å®¹å™¨è¿›ç¨‹çš„uidã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615039777,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":279632,"user_name":"äº‰å…‰ Alan","can_delete":false,"product_type":"c1","uid":1336328,"ip_address":"","ucode":"338534F909AF03","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/08/0287f41f.jpg","comment_is_top":false,"comment_ctime":1613881918,"is_pvip":false,"replies":[{"id":"101964","content":"@äº‰å…‰ Alanï¼Œ æˆ‘è¿˜æ˜¯ä¼šå®šæœŸå›ç­”è¿™ä¸ªä¸“æ ä¸­çš„å¤§å®¶çš„æé—®çš„ã€‚å¦‚æœä½ æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œè¿˜æ˜¯åœ¨å¯ä»¥åœ¨è¿™é‡Œæé—®çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1614435727,"ip_address":"","comment_id":279632,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1613881918","product_id":100063801,"comment_content":"è€å¸ˆï¼Œæ„Ÿè°¢æ‚¨çš„åˆ†äº«ï¼Œå­¦åˆ°äº†å¾ˆå¤šçŸ¥è¯†ï¼Œä¹Ÿæ„Ÿè°¢è§£ç­”äº†å¾ˆå¤šç–‘é—®ï¼Œæœ‰ä¸ªå°å°çš„è¯·æ±‚ï¼šèƒ½å…¬å¸ƒä¸ªå¾®ä¿¡ç¾¤ä¹‹ç±»çš„å—ï¼ŸæŠŠå­¦å‘˜åŠ ä¸€èµ·ç›¸äº’è®¨è®ºé—®é¢˜ï¼Œäº¤æµå¿ƒå¾—","like_count":0,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":515806,"discussion_content":"@äº‰å…‰ Alanï¼Œ æˆ‘è¿˜æ˜¯ä¼šå®šæœŸå›ç­”è¿™ä¸ªä¸“æ ä¸­çš„å¤§å®¶çš„æé—®çš„ã€‚å¦‚æœä½ æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œè¿˜æ˜¯åœ¨å¯ä»¥åœ¨è¿™é‡Œæé—®çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614435727,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}