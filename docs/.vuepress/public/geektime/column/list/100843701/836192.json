{"id":836192,"title":"08ï½œå¹¶å‘mapï¼šç™¾ä¸‡æ•°æ®æœ¬åœ°ç¼“å­˜ï¼Œå¦‚ä½•é™å»¶æ—¶å‡æ¯›åˆºï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å¾é€¸ã€‚</p><p>åœ¨ä¸ŠèŠ‚è¯¾çš„å†…å®¹ä¸­ï¼Œæˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†é”å’Œæ— é”ç¼–ç¨‹æŠ€æœ¯ï¼Œè¿˜ä½¿ç”¨åˆ†æ®µé”å’Œmapç±»å‹ï¼Œå®ç°äº†ä¸€ä¸ªç¼“å­˜ç»“æ„ã€‚ä¸è¿‡ï¼Œå€¼å¾—ç•™æ„çš„æ˜¯ï¼Œå…¶å® Go è¯­è¨€çš„ sync åŒ…å·²ç»æä¾›äº†ä¸€ç§å¹¶å‘å®‰å…¨çš„ Map ç±»å‹ã€‚</p><p>ä»Šå¤©ï¼Œæˆ‘å°±ä»¥å¤§è§„æ¨¡æ•°æ®ç¼“å­˜çš„æ•°æ®ç»“æ„è®¾è®¡è¦ç‚¹ä¸ºä¾‹ï¼Œå¸¦ä½ æŒæ¡sync.Mapç±»å‹ä»¥åŠé’ˆå¯¹mapçš„GCä¼˜åŒ–æŠ€å·§ã€‚</p><p>å‡å¦‚æˆ‘ä»¬ç°åœ¨éœ€è¦å®ç°ä¸€ä¸ªkey-valueç±»å‹çš„æœ¬åœ°ç¼“å­˜ï¼Œä¸”ç¼“å­˜çš„keyç‰¹åˆ«å¤šï¼Œè¾¾åˆ°ç™¾ä¸‡ç”šè‡³åƒä¸‡çº§åˆ«ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯¥æ€ä¹ˆè®¾è®¡ï¼Œæ‰èƒ½åœ¨å¹¶å‘ç¯å¢ƒä¸‹é«˜æ€§èƒ½ã€å®‰å…¨åœ°è®¿é—®è¿™ä¸ªç¼“å­˜å‘¢ï¼Ÿ</p><p>é’ˆå¯¹å¤§è§„æ¨¡æ•°æ®ç¼“å­˜çš„åœºæ™¯ï¼Œæˆ‘ä»¬åœ¨æ•°æ®ç»“æ„è®¾è®¡ä¸Šè¦è€ƒè™‘çš„æŠ€æœ¯ç‚¹æœ‰ä¸¤ä¸ªã€‚</p><ol>\n<li>å¦‚ä½•å®ç°å¹¶å‘å®‰å…¨çš„mapç±»å‹ã€‚</li>\n<li>å¦‚ä½•å‡å°‘ç”šè‡³é¿å…å› å¤§è§„æ¨¡æ•°æ®ç¼“å­˜å¯¼è‡´çš„GCå¼€é”€ã€‚</li>\n</ol><h2>å¹¶å‘mapé€‰æ‹©</h2><p>å®é™…ä¸Šï¼Œå¤§è§„æ¨¡ä¸”æœ‰è¯»å†™æ“ä½œçš„æ•°æ®ç¼“å­˜ï¼Œå’±ä»¬å¯ä»¥è€ƒè™‘çš„mapç±»å‹æœ‰ä¸¤ç§ï¼Œä¸€ä¸ªæ˜¯åˆ†æ®µé”å®ç°çš„mapç±»å‹ï¼Œå¦ä¸€ä¸ªæ˜¯syncåŒ…æä¾›çš„Mapç±»å‹ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬åˆ°åº•è¯¥é€‰æ‹©å“ªä¸ªå‘¢ï¼Ÿ</p><p>åœ¨é€‰å‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæŒæ¡sync.Mapç±»å‹çš„åŸºç¡€çŸ¥è¯†å’ŒåŸç†ã€‚</p><p>sync.Mapæ˜¯ Go è¯­è¨€syncåŒ…ä¸­æä¾›çš„ä¸€ä¸ªå†…ç½®çš„å¹¶å‘å®‰å…¨çš„mapç±»å‹ã€‚å®ƒåœ¨è®¾è®¡ä¸Šè€ƒè™‘äº†é«˜å¹¶å‘åœºæ™¯ï¼Œå°½é‡é¿å…åŠ é”æ“ä½œä»è€Œæå‡è¯»å†™æ€§èƒ½ã€‚</p><p>sync.Mapè¯¥å¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿä¸‹é¢æˆ‘ç»™äº†ä¸€æ®µç®€å•çš„ä»£ç ï¼Œè¿™æ®µä»£ç ä½¿ç”¨äº†sync.Mapæä¾›çš„Storeã€Loadå’ŒDeleteæ–¹æ³•ï¼Œåˆ†åˆ«ç”¨äºå†™ã€è¯»å’Œåˆ é™¤æ“ä½œã€‚</p><!-- [[[read_end]]] --><pre><code class=\"language-go\">package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    var m sync.Map\n    m.Store(\"key1\", \"value1\")\n    m.Store(\"key2\", 2)\n    value, ok := m.Load(\"key1\")\n    if ok {\n        fmt.Println(\"Value:\", value)\n    }\n    m.Delete(\"key1\")\n    value, ok = m.Load(\"key1\")\n    if ok {\n        fmt.Println(\"Value:\", value)\n    } else {\n        fmt.Println(\"Key not found\")\n    }\n}\n</code></pre><p>sync.Mapæ˜¯å¦‚ä½•å®ç°å¹¶å‘é«˜æ€§èƒ½æ“ä½œçš„å‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹sync.Mapçš„åº•å±‚æ•°æ®ç»“æ„ï¼Œå®ƒçš„æ ¸å¿ƒæ˜¯readå’Œdirtyä¸¤ä¸ªmapç»“æ„ã€‚readå­˜å‚¨äº†éƒ¨åˆ†å†™å…¥Mapçš„å†…å®¹ï¼Œç”¨æ¥åŠ é€Ÿè¯»æ“ä½œã€‚è€Œdirtyå­˜å‚¨äº†å…¨é‡å†…å®¹ï¼Œéœ€è¦åŠ é”æ‰èƒ½è¯»å†™æ•°æ®ã€‚</p><pre><code class=\"language-go\">type Map struct {\n    mu Mutex\n    read atomic.Pointer[readOnly] // æ— é”è¯»map\n    dirty map[any]*entry // åŠ é”è¯»å†™map\n    misses int\n}\n\n// readOnly is an immutable struct stored atomically in the Map.read field.\ntype readOnly struct {\n    m       map[any]*entry\n    amended bool // true if the dirty map contains some key not in m.\n}\n</code></pre><p>æ¥ç€ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸‹å†™å…¥æ“ä½œã€‚å½“æœ‰key-valueå€¼å†™å…¥æ—¶ï¼Œå¦‚æœè¿™ä¸ªkeyåœ¨readä¸­ä¸å­˜åœ¨ï¼Œæ¥ä¸‹æ¥å°±è¦åšæ–°å¢æ“ä½œï¼Œå®ƒä¼šåŠ é”å†™å…¥dirty mapä¸­ï¼Œå¹¶ä¸”å°†amendedæ ‡è®°è®¾ç½®ä¸ºtrueã€‚è€Œamendedæ ‡è®°ç”¨äºè¡¨ç¤ºdirtyä¸­æ˜¯å¦æœ‰ä¸åœ¨readä¸­çš„key-valueå€¼ã€‚</p><p>è¿™ä¸ªæ“ä½œè¿‡ç¨‹ä½ å¯ä»¥ç»“åˆåé¢çš„ç¤ºæ„å›¾çœ‹ä¸€ä¸‹ï¼Œè¿™æ ·ç†è§£èµ·æ¥æ›´ç›´è§‚ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/ey/7d/eyybed76bbdd94d0d86057dd02ab3b7d.jpg?wh=2900x1683\" alt=\"\" title=\"å›¾1 key-value å†™å…¥\"></p><p>å¦‚æœè¿™ä¸ªkeyåœ¨readä¸­å­˜åœ¨ï¼Œåˆ™ä¼šè¿›è¡Œæ›´æ–°æ“ä½œï¼Œç”±äºread mapå’Œdirty mapé‡Œé¢å­˜å‚¨çš„å€¼æ˜¯entryç±»å‹çš„æŒ‡é’ˆï¼Œä¸”entryç±»å‹çš„æˆå‘˜å˜é‡ä¹Ÿæ˜¯atomic.Pointerç±»å‹ï¼ˆå¦‚åé¢ä»£ç æ‰€ç¤ºï¼‰ã€‚</p><pre><code class=\"language-go\">// An entry is a slot in the map corresponding to a particular key.\ntype entry struct {\n    p atomic.Pointer[any]\n}\n</code></pre><p>å› æ­¤åœ¨æ›´æ–°æ—¶å°±åƒä¸‹é¢çš„å›¾é‚£æ ·ï¼Œå¯ä»¥ç›´æ¥ç”¨CASæ— é”æ“ä½œæ›¿æ¢æŒ‡é’ˆpæŒ‡å‘çš„å˜é‡ï¼Œè€Œæ— éœ€åšåŠ é”æ“ä½œã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/28/6b/2818fca6cdc5aeeb89111640a52c616b.jpg?wh=2800x1239\" alt=\"\" title=\"å›¾2 value æ›´æ–°\"></p><p>ç„¶åï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹è¯»å–æ“ä½œï¼Œæˆ‘ä»¬è¿˜æ˜¯ç»“åˆå…·ä½“ä»£ç æ¥ç†è§£ã€‚</p><pre><code class=\"language-go\">// Load returns the value stored in the map for a key, or nil if no\n// value is present.\n// The ok result indicates whether value was found in the map.\nfunc (m *Map) Load(key any) (value any, ok bool) {\n    read := m.loadReadOnly()\n    e, ok := read.m[key]\n    if !ok &amp;&amp; read.amended {\n        m.mu.Lock()\n        // Avoid reporting a spurious miss if m.dirty got promoted while we were\n        // blocked on m.mu. (If further loads of the same key will not miss, it's\n        // not worth copying the dirty map for this key.)\n        read = m.loadReadOnly()\n        e, ok = read.m[key]\n        if !ok &amp;&amp; read.amended {\n            e, ok = m.dirty[key]\n            // Regardless of whether the entry was present, record a miss: this key\n            // will take the slow path until the dirty map is promoted to the read\n            // map.\n            m.missLocked()\n        }\n        m.mu.Unlock()\n    }\n    if !ok {\n        return nil, false\n    }\n    return e.load()\n}\n</code></pre><p>å½“è¯»å–keyå¯¹åº”çš„å€¼æ—¶ï¼Œä¼šå…ˆä»readä¸­è¯»å–ï¼Œå½“readä¸­è¯»ä¸åˆ°ï¼Œå¹¶ä¸”amendedä¸ºtrueæ—¶ï¼Œåˆ™ä¼šåŠ é”ä»dirty mapä¸­è¯»ã€‚<strong>è¿™é‡Œå¯èƒ½å¯¼è‡´ä»sync.Mapè¯»å–çš„æ€§èƒ½åŠ£åŒ–ï¼Œå› ä¸ºå®ƒæ—¢è¦ä»readä¸­è¯»ä¸€éï¼Œåˆè¦åŠ é”ä»dirty mapä¸­è¯»ä¸€éã€‚</strong></p><p><img src=\"https://static001.geekbang.org/resource/image/2f/f5/2f59ace16127a243ebc620d9b4d78cf5.jpg?wh=2900x1857\" alt=\"\" title=\"å›¾3 è¯» Key æ•°æ®\"></p><p>åŒæ—¶ï¼Œæ¯æ¬¡readè¯»ä¸åˆ°ï¼Œä»dirty mapä¸­è¯»æ—¶ï¼Œå®ƒä¼šè°ƒç”¨missLockedæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºå°†mapçš„misseså­—æ®µåŠ 1ï¼Œmisseså­—æ®µç”¨äºè¡¨ç¤ºreadè¯»æœªå‘½ä¸­æ¬¡æ•°ï¼Œå¦‚æœmisseså€¼æ¯”è¾ƒå¤§ï¼Œè¯´æ˜read mapçš„æ•°æ®å¯èƒ½æ¯”dirty mapå°‘äº†å¾ˆå¤šã€‚ä¸ºäº†æå‡è¯»æ€§èƒ½ï¼ŒmissLockedæ–¹æ³•é‡Œä¼šå°†dirty mapå˜æˆæ–°çš„read mapï¼Œä»£ç å¦‚ä¸‹ã€‚</p><pre><code class=\"language-go\">func (m *Map) missLocked() {\n    m.misses++\n    if m.misses &lt; len(m.dirty) {\n        return\n    }\n    m.read.Store(&amp;readOnly{m: m.dirty})\n    m.dirty = nil\n    m.misses = 0\n}\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/3b/fe/3bd3484c3532bfa5e7108280b23e52fe.jpg?wh=2653x1688\" alt=\"\" title=\"å›¾4 dirty åˆ‡æ¢ä¸º read\"></p><p>æœ€åï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦ä¸€ä¸ªå¯èƒ½å¯¼è‡´å†™å…¥sync.Mapçš„æ€§èƒ½åŠ£åŒ–çš„ç‚¹ã€‚ä¸Šé¢çš„missLockedæ–¹æ³•ï¼Œä¼šå°†dirty mapç½®ä¸ºnilï¼Œå½“æœ‰æ–°çš„key-valueå€¼å†™å…¥æ—¶ï¼Œä¸ºäº†èƒ½ä¿æŒdirty mapæœ‰å…¨é‡æ•°æ®ï¼Œå°±åƒä¸‹é¢ä»£ç çš„swapæ–¹æ³•ï¼Œå®ƒä¼šåŠ é”å¹¶ä¸”è°ƒç”¨dirtyLockedæ–¹æ³•ï¼Œéå†read mapå¹¶å…¨é‡èµ‹å€¼æ‹·è´ç»™dirty mapã€‚</p><p>ä½ å¯ä»¥çœ‹çœ‹åé¢çš„ä»£ç ï¼Œå†æƒ³æƒ³è¿™æ ·å†™ä¼šä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><pre><code class=\"language-go\">// Swap swaps the value for a key and returns the previous value if any.\n// The loaded result reports whether the key was present.\nfunc (m *Map) Swap(key, value any) (previous any, loaded bool) {\n    ...\n    m.mu.Lock()\n    if !read.amended {\n        // We're adding the first new key to the dirty map.\n        // Make sure it is allocated and mark the read-only map as incomplete.\n        m.dirtyLocked()\n        m.read.Store(&amp;readOnly{m: read.m, amended: true})\n    }\n    m.dirty[key] = newEntry(value)\n    m.mu.Unlock()\n    return previous, loaded\n}\n\nfunc (m *Map) dirtyLocked() {\n    if m.dirty != nil {\n        return\n    }\n    // read mapå…¨é‡å¤åˆ¶åˆ°dirty\n    read := m.loadReadOnly()\n    m.dirty = make(map[any]*entry, len(read.m))\n    for k, e := range read.m {\n        if !e.tryExpungeLocked() {\n            m.dirty[k] = e\n        }\n    }\n}\n</code></pre><p>ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰å‘ç°ï¼Ÿå½“æ•°æ®é‡æ¯”è¾ƒå¤§æ—¶ï¼Œè¿™æ ·ä¼šå¯¼è‡´å¤§é‡æ•°æ®çš„æ‹·è´ï¼Œæ€§èƒ½ä¼šåŠ£åŒ–ä¸¥é‡ã€‚æ¯”å¦‚æˆ‘ä»¬ç¼“å­˜å‡ ç™¾ä¸‡æ¡æ•°æ®ï¼Œå°±å­˜åœ¨å‡ ç™¾ä¸‡æ¡æ•°æ®çš„èµ‹å€¼æ‹·è´ã€‚</p><p>é€šè¿‡ä¸Šé¢sync.Mapçš„åŸç†åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œsync.Mapæ˜¯é€šè¿‡ä¸¤ä¸ªmapæ¥å®ç°è¯»å†™åˆ†ç¦»ï¼Œä»è€Œè¾¾åˆ°é«˜æ€§èƒ½è¯»çš„ç›®çš„ã€‚ä¸è¿‡å®ƒå­˜åœ¨ä¸‹é¢å‡ ä¸ªç¼ºç‚¹ã€‚</p><ol>\n<li>ç”±äºæœ‰ä¸¤ä¸ªmapï¼Œå› æ­¤å ç”¨å†…å­˜ä¼šæ¯”è¾ƒé«˜ã€‚</li>\n<li>æ›´é€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œå½“ç”±äºå†™æ¯”è¾ƒå¤šæˆ–è€…æœ¬åœ°ç¼“å­˜æ²¡æœ‰å…¨é‡æ•°æ®æ—¶ï¼Œä¼šå¯¼è‡´è¯»mapç»å¸¸è¯»ä¸åˆ°æ•°æ®ï¼Œè€Œéœ€è¦åŠ é”å†è¯»ä¸€æ¬¡ï¼Œä»è€Œå¯¼è‡´è¯»æ€§èƒ½é€€åŒ–ã€‚</li>\n<li>å½“æ•°æ®é‡æ¯”è¾ƒå¤§æ—¶ï¼Œå¦‚æœå†™å…¥è§¦å‘è¯»mapå‘å†™mapæ‹·è´ï¼Œä¼šå¯¼è‡´è¾ƒå¤§çš„æ€§èƒ½å¼€é”€ã€‚</li>\n</ol><p>å¯ä»¥çœ‹å‡ºæ¥ï¼Œsync.Mapçš„ä½¿ç”¨åœºæ™¯è¿˜æ˜¯æ¯”è¾ƒè‹›åˆ»çš„ã€‚</p><p>é‚£å›åˆ°åˆšå¼€å§‹çš„é—®é¢˜ï¼Œåœ¨å¤§è§„æ¨¡æ•°æ®ç¼“å­˜æ—¶ï¼Œæˆ‘ä»¬æ˜¯è¯¥é€‰æ‹©åˆ†æ®µé”å®ç°çš„mapè¿˜æ˜¯sync.Mapç±»å‹æ¥ç¼“å­˜æ•°æ®å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯åˆ†æ®µé”mapã€‚åŸå› æ˜¯æˆ‘ä»¬å¾ˆéš¾å‡†ç¡®åœ°é¢„ä¼°è¯»å†™æ¯”ä¾‹ï¼Œè€Œä¸”è¯»å†™æ¯”ä¾‹ä¹Ÿä¼šéšç€ä¸šåŠ¡çš„å‘å±•å˜åŒ–ã€‚æ­¤å¤–ï¼Œåœ¨å¤§è§„æ¨¡æ•°æ®ç¼“å­˜æ—¶ï¼Œä¸¤ä¸ªmapçš„å†…å­˜å’Œæ‹·è´å¼€é”€ä¹Ÿæ˜¯ä¸å¾—ä¸è€ƒè™‘çš„ç¨³å®šæ€§é£é™©ç‚¹ï¼Œå› æ­¤åœ¨å¤§è§„æ¨¡æ•°æ®ç¼“å­˜æ—¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨åˆ†æ®µé”å®ç°çš„mapæ¥ç¼“å­˜æ•°æ®ã€‚</p><h2>map gcä¼˜åŒ–</h2><p>åœ¨åšäº†å¹¶å‘mapçš„é€‰å‹ä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘çš„ä¸€ç‚¹æ˜¯åœ¨ç¼“å­˜å¤§é‡æ•°æ®æ—¶ï¼Œå¦‚ä½•é¿å…GCå¯¼è‡´çš„æ€§èƒ½å¼€é”€ã€‚</p><p>æˆ‘ä»¥ä¸‹é¢çš„ä»£ç ä¸ºä¾‹ï¼Œåˆ†åˆ«æµ‹è¯•keyã€valueä¸ºstringç±»å‹çš„mapåœ¨ä¸åŒæ•°æ®è§„æ¨¡ä¸‹çš„GCå¼€é”€ã€‚</p><pre><code class=\"language-go\">import (\n    \"fmt\"\n    \"runtime\"\n    \"testing\"\n    \"time\"\n)\n\n// Test1kGCDuration æµ‹è¯•å°è§„æ¨¡æ•°æ®gcæ—¶é•¿\nfunc Test1kGCDuration(t *testing.T) {\n    size := 1000\n    m := GenerateStringMap(size)\n    runtime.GC()\n    gcCost := timeGC()\n    t.Logf(\"size %d GC duration: %v\\n\", size, gcCost)\n    _ = m[\"1\"]\n}\n\n// æµ‹è¯•å¤§è§„æ¨¡æ•°æ®gcæ—¶é•¿\nfunc Test500wGCDuration(t *testing.T) {\n    size := 5000000\n    m := GenerateStringMap(size)\n    runtime.GC()\n    gcCost := timeGC()\n    t.Logf(\"size %d GC duration: %v\\n\", size, gcCost)\n    _ = m[\"1\"]\n}\nfunc GenerateStringMap(size int) map[string]string {\n    // åœ¨è¿™é‡Œæ‰§è¡Œä¸€äº›å¯èƒ½ä¼šè§¦å‘GCçš„æ“ä½œï¼Œä¾‹å¦‚åˆ›å»ºå¤§é‡å¯¹è±¡ç­‰\n    // ä»¥ä¸‹ç¤ºä¾‹åˆ›å»ºä¸€ä¸ªè¾ƒå¤§çš„mapå¹¶å¡«å……æ•°æ®\n    m := make(map[string]string)\n    for i := 0; i &lt; size; i++ {\n        key := fmt.Sprintf(\"key_%d\", i)\n        value := fmt.Sprintf(\"val_%d\", i)\n        m[key] = value\n\n    }\n    return m\n}\n\nfunc timeGC() time.Duration {\n    // è®°å½•GCå¼€å§‹æ—¶é—´\n    gcStartTime := time.Now()\n    // æ‰‹åŠ¨è§¦å‘GCï¼Œä»¥ä¾¿æ›´å‡†ç¡®åœ°æµ‹é‡æ­¤æ¬¡æ“ä½œç›¸å…³çš„GCæ—¶é•¿\n    runtime.GC()\n\n    // è®¡ç®—æ€»çš„GCæ—¶é•¿\n    gcCost := time.Since(gcStartTime)\n    return gcCost\n}\n</code></pre><p>æµ‹è¯•ç»“æœå‡ºæ¥äº†ï¼Œ<strong>mapä¸­å‚¨å­˜1kæ¡æ•°æ®å’Œ500wæ¡æ•°æ®çš„GCè€—æ—¶å·®å¼‚å·¨å¤§</strong>ã€‚500wæ¡æ•°æ®ï¼ŒGCè€—æ—¶290msï¼Œè€Œ1kæ¡æ•°æ®è€—æ—¶åªéœ€è¦480Âµsï¼Œæœ‰600å€çš„æ€§èƒ½å·®å¼‚ã€‚</p><pre><code class=\"language-shell\">killianxu@KILLIANXU-MB0 8 % go test -gcflags=all=-l gc_size_test.go -v\n=== RUN   Test1kGCDuration\n    gc_size_test.go:16: size 1000 GC duration: 480.718Âµs\n--- PASS: Test1kGCDuration (0.00s)\n=== RUN   Test500wGCDuration\n    gc_size_test.go:26: size 5000000 GC duration: 290.422382ms\n--- PASS: Test500wGCDuration (5.12s)\n</code></pre><p>é‚£ä¹ˆåœ¨å¤§è§„æ¨¡æ•°æ®ç¼“å­˜ä¸‹ï¼ŒGCä¸ºä»€ä¹ˆè€—æ—¶ä¼šè¿™ä¹ˆé•¿å‘¢ï¼Ÿ</p><p>è¿™æ˜¯å› ä¸ºGCåœ¨åšå¯¹è±¡æ‰«ææ ‡è®°æ—¶ï¼Œéœ€è¦æ‰«ææ ‡è®°mapé‡Œé¢çš„å…¨é‡key-valueå¯¹è±¡ï¼Œæ•°æ®è¶Šå¤šï¼Œéœ€è¦æ‰«æçš„å¯¹è±¡è¶Šå¤šï¼ŒGCæ—¶é—´ä¹Ÿå°±è¶Šé•¿ã€‚</p><p>æ‰«ææ ‡è®°çš„è€—æ—¶è¿‡é•¿ï¼Œä¼šå¼•å‘ä¸€ç³»åˆ—ä¸è‰¯å½±å“ã€‚å®ƒä¸ä»…ä¼šå¤§é‡æ¶ˆè€— CPU èµ„æºï¼Œé™ä½æœåŠ¡ååï¼Œè€Œä¸”åœ¨æ ‡è®°å·¥ä½œæœªèƒ½åŠæ—¶å®Œæˆçš„æƒ…å†µä¸‹ï¼ŒGC ä¼šè¦æ±‚å¤„ç†è¯·æ±‚çš„åç¨‹æš‚åœæ‰‹å¤´çš„ä¸šåŠ¡é€»è¾‘å¤„ç†æµç¨‹ï¼Œè½¬è€ŒååŠ© GC å¼€å±•æ ‡è®°ä»»åŠ¡ã€‚è¿™æ ·ä¸€æ¥ï¼Œéƒ¨åˆ†è¯·æ±‚çš„å“åº”å»¶æ—¶å°†ä¼šä¸å¯é¿å…åœ°å¤§å¹…å‡é«˜ï¼Œä¸¥é‡å½±å“ç³»ç»Ÿçš„å“åº”æ•ˆç‡ä¸æ€§èƒ½è¡¨ç°ã€‚</p><p>ä¸ºäº†é¿å…GCå¯¹ç¨‹åºæ€§èƒ½é€ æˆå½±å“ï¼Œå¯¹äºmapç±»å‹ï¼ŒGolangåœ¨ <a href=\"https://go-review.googlesource.com/c/go/+/3288\">1.5ç‰ˆæœ¬</a>æä¾›äº†ä¸€ç§ç»•è¿‡GCæ‰«æçš„æ–¹æ³•ã€‚ç»•è¿‡GCè¦æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶ã€‚</p><p><strong>ç¬¬ä¸€ï¼Œmapçš„key-valueç±»å‹ä¸èƒ½æ˜¯æŒ‡é’ˆç±»å‹ä¸”å†…éƒ¨ä¸èƒ½åŒ…å«æŒ‡é’ˆ</strong>ã€‚æ¯”å¦‚stringç±»å‹ï¼Œå®ƒçš„åº•å±‚æ•°æ®ç»“æ„ä¸­æœ‰æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼Œå› æ­¤ä¸æ»¡è¶³è¿™ä¸ªæ¡ä»¶ã€‚</p><pre><code class=\"language-go\">// å­—ç¬¦ä¸²æ•°æ®ç»“æ„\ntype stringStruct struct {\n    str unsafe.Pointer //æŒ‡é’ˆç±»å‹ï¼ŒæŒ‡å‘å­—èŠ‚æ•°ç»„\n    len int\n}\n</code></pre><p>é‚£åˆ°åº•ä¸å«æŒ‡é’ˆç±»å‹ï¼Œèƒ½ä¸èƒ½ç¼©çŸ­GCå¼€é”€å‘¢ï¼Ÿå’±ä»¬å°†ä»£ç é‡Œmapçš„key-valueç±»å‹æ¢æˆintç±»å‹å†è¯•ä¸€ä¸‹ã€‚</p><pre><code class=\"language-go\">// æµ‹è¯•key-valueéæŒ‡é’ˆç±»å‹,intçš„gcå¼€é”€\nfunc Test500wIntGCDuration(t *testing.T) {\n    size := 5000000\n    m := GenerateIntMap(size)\n    runtime.GC()\n    gcCost := timeGC()\n    t.Logf(\"size %d GC duration: %v\\n\", size, gcCost)\n    _ = m[1]\n}\nfunc GenerateIntMap(size int) map[int]int {\n    // åœ¨è¿™é‡Œæ‰§è¡Œä¸€äº›å¯èƒ½ä¼šè§¦å‘GCçš„æ“ä½œï¼Œä¾‹å¦‚åˆ›å»ºå¤§é‡å¯¹è±¡ç­‰\n    // ä»¥ä¸‹ç¤ºä¾‹åˆ›å»ºä¸€ä¸ªè¾ƒå¤§çš„mapå¹¶å¡«å……æ•°æ®\n    m := make(map[int]int)\n    for i := 0; i &lt; size; i++ {\n        m[i] = i\n\n    }\n    return m\n}\n</code></pre><p><strong>ä½ ä¼šå‘ç°ï¼Œkey-valueæ¢æˆintç±»å‹çš„mapï¼Œgcæ€§èƒ½æå‡éå¸¸æ˜æ˜¾</strong>ï¼Œgcæ—¶é—´ä»290mså˜æˆäº†2.3msï¼Œæå‡äº†å‡ ç™¾å€ã€‚</p><pre><code class=\"language-plain\">killianxu@KILLIANXU-MB0 8 % go test -gcflags=all=-l -run Test500wIntGCDuration -v\n=== RUN   Test500wIntGCDuration\n    gc_type_test.go:14: size 5000000 GC duration: 2.29631ms\n--- PASS: Test500wIntGCDuration (1.33s)\n</code></pre><p><strong>ç¬¬äºŒï¼Œkey-valueé™¤äº†éœ€è¦æ»¡è¶³éæŒ‡é’ˆè¿™ä¸ªæ¡ä»¶ï¼Œkey/valueçš„å¤§å°ä¹Ÿä¸èƒ½è¶…è¿‡ 128 å­—èŠ‚ï¼Œå¦‚æœè¶…è¿‡128å­—èŠ‚ï¼Œkey-valueå°±ä¼šé€€åŒ–æˆæŒ‡é’ˆï¼Œå¯¼è‡´è¢«GCæ‰«æã€‚</strong></p><p>æˆ‘ä»¬ç”¨valueå¤§å°åˆ†åˆ«æ˜¯128ã€129å­—èŠ‚çš„ç»“æ„ä½“æµ‹è¯•ä¸€ä¸‹ï¼Œæµ‹è¯•ä»£ç å¦‚ä¸‹ã€‚</p><pre><code class=\"language-go\">func TestSmallStruct(t *testing.T) {\n    type SmallStruct struct {\n        data [128]byte\n    }\n    m := make(map[int]SmallStruct)\n    size := 5000000\n    for i := 0; i &lt; size; i++ {\n        m[i] = SmallStruct{}\n    }\n    runtime.GC()\n    gcCost := timeGC()\n    t.Logf(\"size %d GC duration: %v\\n\", size, gcCost)\n    _ = m[1]\n}\nfunc TestBigStruct(t *testing.T) {\n    type BigStruct struct {\n        data [129]byte\n    }\n    m := make(map[int]BigStruct)\n    size := 5000000\n    for i := 0; i &lt; size; i++ {\n        m[i] = BigStruct{}\n    }\n    runtime.GC()\n    gcCost := timeGC()\n    t.Logf(\"size %d GC duration: %v\\n\", size, gcCost)\n    _ = m[1]\n}\n</code></pre><p><strong>æœç„¶ï¼Œkey-valueçš„å¤§å°è¶…è¿‡128å­—èŠ‚ä¼šå¯¼è‡´GCæ€§èƒ½å¼€é”€å˜å¤§ã€‚</strong>å¯¹äº129å­—èŠ‚çš„ç»“æ„ä½“ï¼ŒGCè€—æ—¶264msï¼Œè€Œ128å­—èŠ‚ï¼Œåªéœ€è¦2.4msï¼Œæ€§èƒ½å·®è·é«˜è¾¾ç™¾å€ã€‚</p><pre><code class=\"language-shell\">killianxu@KILLIANXU-MB0 8 % go test -gcflags=all=-l -run \"TestSmallStruct|TestBigStruct\" -v\n=== RUN   TestSmallStruct\n    gc_type_test.go:39: size 5000000 GC duration: 2.444276ms\n--- PASS: TestSmallStruct (4.13s)\n=== RUN   TestBigStruct\n    gc_type_test.go:53: size 5000000 GC duration: 264.834283ms\n--- PASS: TestBigStruct (2.07s)\n</code></pre><p>é€šè¿‡å‰é¢çš„æµ‹è¯•ï¼Œæˆ‘ä»¬çŸ¥é“äº†ï¼Œ<strong>åœ¨ç¼“å­˜å¤§è§„æ¨¡æ•°æ®æ—¶ï¼Œä¸ºäº†é¿å…GCå¼€é”€ï¼Œkey-valueä¸èƒ½å«æŒ‡é’ˆç±»å‹ä¸”key-valueçš„å¤§å°ä¸èƒ½è¶…è¿‡128å­—èŠ‚ã€‚</strong></p><p>å®é™…ä¸Šï¼Œå’±ä»¬åœ¨ç¼“å­˜å¤§è§„æ¨¡æ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æˆç†Ÿçš„å¼€æºåº“æ¥å®ç°ï¼Œæ¯”å¦‚ <a href=\"https://github.com/allegro/bigcache/tree/main\">bigcache</a>ã€<a href=\"https://github.com/coocood/freecache\">freecache</a> ç­‰ã€‚å®ƒä»¬çš„åº•å±‚å°±æ˜¯ä½¿ç”¨åˆ†æ®µé”åŠ mapç±»å‹æ¥å®ç°æ•°æ®å­˜å‚¨çš„ï¼ŒåŒæ—¶ï¼Œå®ƒä»¬ä¹Ÿåˆ©ç”¨äº†åˆšåˆšè®²è¿‡çš„mapçš„key-valueç‰¹æ€§ï¼Œæ¥é¿å…GCæ‰«æã€‚</p><p>ä»¥bigcacheä¸ºä¾‹ï¼Œå®ƒçš„ä½¿ç”¨æ¯”è¾ƒç®€å•ã€‚é€šè¿‡Getå’ŒSetæ–¹æ³•å°±å¯ä»¥å®ç°è¯»å†™æ“ä½œã€‚</p><pre><code class=\"language-go\">import (\n     \"fmt\"\"context\"\"github.com/allegro/bigcache/v3\"\n)\n\ncache, _ := bigcache.New(context.Background(), bigcache.DefaultConfig(10 * time.Minute))\n\ncache.Set(\"my-unique-key\", []byte(\"value\"))\n\nentry, _ := cache.Get(\"my-unique-key\")\nfmt.Println(string(entry))\n</code></pre><h2>å°ç»“</h2><p>ä»Šå¤©è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¥å¤§è§„æ¨¡æ•°æ®ç¼“å­˜çš„åœºæ™¯ä¸ºä¾‹ï¼Œå¸¦ä½ å­¦ä¹ äº†golang syncåŒ…çš„Mapç±»å‹ä»¥åŠmapçš„gcä¼˜åŒ–æŠ€å·§ã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹sync.Mapçš„çŸ¥è¯†ä»¥åŠmapçš„zero gcç‰¹æ€§ã€‚</p><p>sync.Map åœ¨åº•å±‚å·§å¦™åœ°å€ŸåŠ©ä¸¤ä¸ª map æ¥è¾¾æˆè¯»å†™åˆ†ç¦»çš„è®¾è®¡æ¶æ„ï¼Œä»¥æ­¤å®ç°é«˜æ€§èƒ½çš„è¯»å–æ“ä½œã€‚ç„¶è€Œï¼Œè¿™ç§è®¾è®¡å¹¶éæ¯«æ— ç‘•ç–µï¼Œå®ƒå­˜åœ¨ç€ä¸€äº›ä¸å®¹å¿½è§†çš„é—®é¢˜ã€‚</p><p>ä¸€æ–¹é¢ï¼Œå…¶å†…å­˜å ç”¨ç›¸å¯¹è¾ƒé«˜ï¼›å¦ä¸€æ–¹é¢ï¼Œå½“å†™å…¥æ“ä½œè¾ƒä¸ºé¢‘ç¹æ—¶ï¼Œè¯»å–æ€§èƒ½ä¼šå‡ºç°æ˜æ˜¾çš„é€€åŒ–ç°è±¡ã€‚</p><p>æ­¤å¤–ï¼Œç”±äºå…¶åŸºäºä¸¤ä¸ª map çš„æ¶æ„ç‰¹æ€§ï¼Œåœ¨æ•°æ®å¤„ç†è¿‡ç¨‹ä¸­è¿˜ä¼šäº§ç”Ÿä¸¤ä¸ª map ä¹‹é—´çš„æ•°æ®æ‹·è´å¼€é”€ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šå½±å“äº†æ•´ä½“çš„æ€§èƒ½è¡¨ç°ä¸èµ„æºåˆ©ç”¨æ•ˆç‡ã€‚æ­£å› ä¸º sync.Map çš„ä½¿ç”¨åœºæ™¯è¾ƒä¸ºä¸¥è‹›ï¼Œåœ¨å®é™…çš„ç¼–ç¨‹å®è·µä¸­ï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•çš„é¢‘ç‡åå€’æ¯”è¾ƒä½ã€‚</p><p>å½“mapä¸­ç¼“å­˜çš„æ•°æ®æ¯”è¾ƒå¤šæ—¶ï¼Œä¸ºäº†é¿å…GCå¼€é”€ï¼Œæˆ‘ä»¬å¯ä»¥å°†mapä¸­çš„key-valueç±»å‹è®¾è®¡æˆéæŒ‡é’ˆç±»å‹ä¸”å¤§å°ä¸è¶…è¿‡128å­—èŠ‚ï¼Œä»è€Œé¿å…GCæ‰«æã€‚</p><p>å¸Œæœ›ä½ èƒ½å¤Ÿç”¨å¿ƒå»ä½“ä¼šmap gcçš„ä¼˜åŒ–æŠ€å·§ã€‚åœ¨ä»Šåé‡åˆ°å¤§è§„æ¨¡æ•°æ®ç¼“å­˜çš„åœºæ™¯ï¼Œåˆ«å¿˜äº†ç”¨ä¸Šå­¦åˆ°çš„æŠ€å·§å»åšGCä¼˜åŒ–ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>åœ¨å¤§è§„æ¨¡æ•°æ®ç¼“å­˜æ—¶ï¼Œæˆ‘ä»¬è™½ç„¶å¯ä»¥ç”¨bigcacheæ¥é¿å…gcï¼Œä½†æ˜¯å´ä¼šå¼•èµ·å…¶å®ƒå¼€é”€ï¼Œé‚£ä¹ˆæ˜¯å“ªäº›å¼€é”€å‘¢ï¼Ÿ</p><p>æ¬¢è¿ä½ æŠŠä½ çš„ç­”æ¡ˆåˆ†äº«åœ¨è¯„è®ºåŒºï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾çš„å†…å®¹åˆ†äº«ç»™éœ€è¦çš„æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","neighbors":{"left":{"article_title":"07ï½œå¹¶å‘å®‰å…¨ï¼šå¦‚ä½•ä¸ºä¸åŒå¹¶å‘åœºæ™¯é€‰æ‹©åˆé€‚çš„é”ï¼Ÿ","id":835226},"right":[]},"comments":[{"had_liked":false,"id":396620,"user_name":"lJ","can_delete":false,"product_type":"c1","uid":2562558,"ip_address":"æ±Ÿè‹","ucode":"CC29D06A16FF93","user_header":"https://static001.geekbang.org/account/avatar/00/27/19/fe/d31344db.jpg","comment_is_top":false,"comment_ctime":1735109890,"is_pvip":false,"replies":[{"id":143966,"content":"ğŸ‘ğŸ‘åºåˆ—åŒ–ååºåˆ—åŒ–æœ¬èº«ï¼Œä¹Ÿä¼šå¯¼è‡´æ€§èƒ½å˜å·®ã€‚æ¯”å¦‚æˆ‘ä»¬åšè¯·æ±‚å¤„ç†ï¼Œå¦‚æœä¸€æ¬¡è¦ä»ç¼“å­˜é‡Œè·å–å¾ˆå¤šæ¡æ•°æ®å¹¶ååºåˆ—åŒ–å‡ºæ¥åšä¸€äº›é€»è¾‘å¤„ç†ï¼Œè¿™æ—¶å€™å¤§é‡çš„ååºåˆ—åŒ–ï¼Œä¹Ÿä¼šå¯¼è‡´æ¥å£å»¶æ—¶ä¹Ÿä¼šä¸Šæ¶¨ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1313417,"ctime":1735136988,"ip_address":"å¹¿ä¸œ","comment_id":396620,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100843701,"comment_content":"1. åªæ”¯æŒ []byte ç±»å‹çš„æ•°æ®å­˜å‚¨ï¼Œä¸æ”¯æŒå¤æ‚çš„æ•°æ®ç»“æ„ï¼Œéœ€è¦è‡ªè¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–æ•°æ®ï¼Œå¢åŠ äº†å¼€å‘å¤æ‚åº¦ã€‚\n2. ä½¿ç”¨ç¯å½¢ç¼“å†²åŒºå­˜å‚¨æ•°æ®ï¼Œæ•°æ®å†™å…¥æ—¶æ˜¯è¿ç»­åˆ†é…çš„ï¼Œä½†åˆ é™¤æ—¶åªæ ‡è®°ä¸ºæ— æ•ˆï¼Œä¸å›æ”¶ç©ºé—´ã€‚å¯¼è‡´å†…å­˜åˆ©ç”¨ç‡é™ä½ã€‚","like_count":0,"discussions":[{"author":{"id":1313417,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0a/89/eb8c28a4.jpg","nickname":"å¾é€¸","note":"","ucode":"DCFDEE08FD263A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":655525,"discussion_content":"ğŸ‘ğŸ‘åºåˆ—åŒ–ååºåˆ—åŒ–æœ¬èº«ï¼Œä¹Ÿä¼šå¯¼è‡´æ€§èƒ½å˜å·®ã€‚æ¯”å¦‚æˆ‘ä»¬åšè¯·æ±‚å¤„ç†ï¼Œå¦‚æœä¸€æ¬¡è¦ä»ç¼“å­˜é‡Œè·å–å¾ˆå¤šæ¡æ•°æ®å¹¶ååºåˆ—åŒ–å‡ºæ¥åšä¸€äº›é€»è¾‘å¤„ç†ï¼Œè¿™æ—¶å€™å¤§é‡çš„ååºåˆ—åŒ–ï¼Œä¹Ÿä¼šå¯¼è‡´æ¥å£å»¶æ—¶ä¹Ÿä¼šä¸Šæ¶¨ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1735136988,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":396614,"user_name":"å¿«å«æˆ‘å°ç™½","can_delete":false,"product_type":"c1","uid":3571201,"ip_address":"ä¸Šæµ·","ucode":"7CAD65E36601A2","user_header":"https://static001.geekbang.org/account/avatar/00/36/7e/01/1660e1e8.jpg","comment_is_top":false,"comment_ctime":1735103706,"is_pvip":false,"replies":[{"id":143967,"content":"ç¬¬ä¸€æ¬¡è°ƒç”¨æ˜¯ä¸ºäº†è®©GCæ¸…ç†æ‰æˆ‘ä»¬å› ä¸ºç”Ÿæˆè¿™ä¸ªmapè€Œåˆ†é…çš„ä¸€äº›ä¸´æ—¶å˜é‡ã€‚ç¬¬äºŒæ¬¡è°ƒç”¨åŸºæœ¬å°±æ˜¯GCæ‰«ææ ‡è®°mapçš„æ—¶é—´ã€‚è¿™ä¸ªçš„ç›®çš„ç¡®å®æ˜¯æµ‹è¯•GCåœ¨mapä¸ŠèŠ±è´¹çš„æ—¶é—´ã€‚å› ä¸ºæˆ‘ä»¬åšæœ¬åœ°ç¼“å­˜ï¼Œmapæ˜¯ä¸ªå…¨å±€å˜é‡ï¼Œè™½ç„¶ä¸ä¼šå›æ”¶è¿™ä¸ªmapï¼Œä½†æ˜¯æ¯æ¬¡GCéƒ½ä¼šæ‰«æ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1313417,"ctime":1735137266,"ip_address":"å¹¿ä¸œ","comment_id":396614,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100843701,"comment_content":"runtime.GC è¿™ä¸ªå‡½æ•°ä¸ºä½•åœ¨å‡½æ•°å†…å¤–éƒ½è°ƒç”¨ä¸€æ¬¡å‘€ï¼Ÿè€Œä¸”æµ‹è¯•å‡½æ•°ä¼¼ä¹æ²¡äº§ç”Ÿéœ€è¦å›æ”¶çš„ä¸´æ—¶ç»“æ„ä½“ï¼Œæˆ‘ä»¬è°ƒç”¨GCå‡½æ•°ä»…ä»…æ˜¯ä¸ºäº†è§‚å¯Ÿåƒåœ¾å›æ”¶çš„æ‰«ææ—¶é—´å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1313417,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0a/89/eb8c28a4.jpg","nickname":"å¾é€¸","note":"","ucode":"DCFDEE08FD263A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":655526,"discussion_content":"ç¬¬ä¸€æ¬¡è°ƒç”¨æ˜¯ä¸ºäº†è®©GCæ¸…ç†æ‰æˆ‘ä»¬å› ä¸ºç”Ÿæˆè¿™ä¸ªmapè€Œåˆ†é…çš„ä¸€äº›ä¸´æ—¶å˜é‡ã€‚ç¬¬äºŒæ¬¡è°ƒç”¨åŸºæœ¬å°±æ˜¯GCæ‰«ææ ‡è®°mapçš„æ—¶é—´ã€‚è¿™ä¸ªçš„ç›®çš„ç¡®å®æ˜¯æµ‹è¯•GCåœ¨mapä¸ŠèŠ±è´¹çš„æ—¶é—´ã€‚å› ä¸ºæˆ‘ä»¬åšæœ¬åœ°ç¼“å­˜ï¼Œmapæ˜¯ä¸ªå…¨å±€å˜é‡ï¼Œè™½ç„¶ä¸ä¼šå›æ”¶è¿™ä¸ªmapï¼Œä½†æ˜¯æ¯æ¬¡GCéƒ½ä¼šæ‰«æ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1735137266,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]}]}