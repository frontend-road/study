{"id":165253,"title":"04 | MongoDB特色及优势","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-mongodb-course\">https://gitee.com/geektime-geekbang/geektime-mongodb-course</a></p>","comments":[{"had_liked":false,"id":151535,"user_name":"Victor","can_delete":false,"product_type":"c3","uid":1301853,"ip_address":"","ucode":"FE02A97FF9A007","user_header":"https://static001.geekbang.org/account/avatar/00/13/dd/5d/ea2e41d0.jpg","comment_is_top":false,"comment_ctime":1573737523,"is_pvip":false,"replies":[{"id":58386,"content":"MongoDB复制集在从节点故障时候是不会影响到可用性。\n在主节点故障，进行选举的时候需要数秒到十几秒，这期间会影响写入。一年有365天x86640秒 ~=  3000多万秒。假设你每个月发生一次主节点故障或者其他问题导致选举，每次影响15秒，那么可用率就是：就是（3000w-12x15） &#47; 3000w ~= 99.9994%","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1573791320,"ip_address":"","comment_id":151535,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"为什么副本集说是5个9的高可用？","like_count":22,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474520,"discussion_content":"MongoDB复制集在从节点故障时候是不会影响到可用性。\n在主节点故障，进行选举的时候需要数秒到十几秒，这期间会影响写入。一年有365天x86640秒 ~=  3000多万秒。假设你每个月发生一次主节点故障或者其他问题导致选举，每次影响15秒，那么可用率就是：就是（3000w-12x15） / 3000w ~= 99.9994%","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573791320,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":151554,"user_name":"旺旺","can_delete":false,"product_type":"c3","uid":1159196,"ip_address":"","ucode":"FE2CF90F446BFB","user_header":"https://static001.geekbang.org/account/avatar/00/11/b0/1c/2e30eeb8.jpg","comment_is_top":false,"comment_ctime":1573739637,"is_pvip":false,"replies":[{"id":58385,"content":"在多中心部署的时候要考虑网络延迟，所以一般多活中心只是建议能够接受一定数据延迟的情况下才建议。\n\n分片有3个触发条件：数据量，并发量，以及热数据大小（内存需求）。理论上，任意一个都会触发分片需求。如果只看数据量，单分片一般可以到1-2TB。 ","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1573791050,"ip_address":"","comment_id":151554,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师，MongoDB这种复制集模式，在不同的数据中心，这中间的网络延迟比较严重吧，不会影响做复制集的效果吗？\n\n另外一个，数据规模达到多大级别需要使用分片机制？\n我们现在数据有200多G，是不是复制集已经足以应对了？\n谢谢老师！","like_count":7,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474530,"discussion_content":"在多中心部署的时候要考虑网络延迟，所以一般多活中心只是建议能够接受一定数据延迟的情况下才建议。\n\n分片有3个触发条件：数据量，并发量，以及热数据大小（内存需求）。理论上，任意一个都会触发分片需求。如果只看数据量，单分片一般可以到1-2TB。 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573791050,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":151502,"user_name":"Jack Wei","can_delete":false,"product_type":"c3","uid":1306836,"ip_address":"","ucode":"69081CE689F189","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJlgy0OxSZOQCbctqtibaicgkKKqUNSicZjQ81ZXwgKYoZ7tt03yhuJWA6ibS0UhVdHElsEicL6tJOVD9w/132","comment_is_top":false,"comment_ctime":1573731827,"is_pvip":false,"replies":[{"id":58394,"content":"恩恩MySQL是支持，虽然真正线上使用的不算多。 另外大部分关系型数据库还是不支持。 \n\n机械硬盘在服务器市场还是占据大多数，特别是数据中心。可能还需要相当一段时间才会慢慢淘汰。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1573792163,"ip_address":"","comment_id":151502,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"你好，关于加字段应用下线，现在mysql等关系型数据库也可以在线加字段，不需要应用下线；针对数据扫描的这块，我觉得应该从SSD的磁盘角度来说，机械硬盘已经不是主流了！","like_count":6,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474505,"discussion_content":"恩恩MySQL是支持，虽然真正线上使用的不算多。 另外大部分关系型数据库还是不支持。 \n\n机械硬盘在服务器市场还是占据大多数，特别是数据中心。可能还需要相当一段时间才会慢慢淘汰。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573792163,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":194254,"user_name":"红豆成香","can_delete":false,"product_type":"c3","uid":1488601,"ip_address":"","ucode":"FB8FBB639B4BA6","user_header":"https://static001.geekbang.org/account/avatar/00/16/b6/d9/4d8a4d4c.jpg","comment_is_top":false,"comment_ctime":1585042076,"is_pvip":false,"replies":[{"id":74323,"content":"GridFS 了解一下。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1585221377,"ip_address":"","comment_id":194254,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师，遇到一个对我来说的难题，找了很久，要是想缓存文件，如pdf或者word应该怎么办，看到mongodb的文件是json，内心凉凉","like_count":4,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488795,"discussion_content":"GridFS 了解一下。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585221377,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":153008,"user_name":"james","can_delete":false,"product_type":"c3","uid":1049208,"ip_address":"","ucode":"5701899403917C","user_header":"https://static001.geekbang.org/account/avatar/00/10/02/78/23c56bce.jpg","comment_is_top":false,"comment_ctime":1574139502,"is_pvip":false,"replies":[{"id":67853,"content":"按照我个人经验是有明显的优势的。有好几家大厂的兄弟，包括百度，网易，字节都有分享类似的经验。 稍微网络搜一下，都有十倍或者更多的数字。原因：\n1）MongoDB默认的事务级别比MySQL低\n2）MongoDB支持的batch 写入模式可以大幅度提升写入速度\n3）MongoDB默认写到内存就返回，不等落盘","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1580279518,"ip_address":"","comment_id":153008,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"在于和mysql比写入性能方面优势大吗","like_count":4,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475020,"discussion_content":"按照我个人经验是有明显的优势的。有好几家大厂的兄弟，包括百度，网易，字节都有分享类似的经验。 稍微网络搜一下，都有十倍或者更多的数字。原因：\n1）MongoDB默认的事务级别比MySQL低\n2）MongoDB支持的batch 写入模式可以大幅度提升写入速度\n3）MongoDB默认写到内存就返回，不等落盘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580279518,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":53203,"discussion_content":"写入上会有不小的优势，因为对事务处理模式不一样。MongoDB采用的MVCC机制是乐观锁，并发处理上有优势。\n\n","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1574144497,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1227492,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ba/e4/6df89add.jpg","nickname":"芋头","note":"","ucode":"A9C875548E4EE5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":607011,"discussion_content":"mysql也是mvcc","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677553473,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":53203,"ip_address":"广东","group_id":0},"score":607011,"extra":""},{"author":{"id":1070287,"avatar":"https://static001.geekbang.org/account/avatar/00/10/54/cf/fddcf843.jpg","nickname":"芋头","note":"","ucode":"390438CFF71F0A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1227492,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ba/e4/6df89add.jpg","nickname":"芋头","note":"","ucode":"A9C875548E4EE5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":633308,"discussion_content":"吓到我，我还以为这评论是我写的，mysql\n的mvcc本身不加锁，只有在涉及到写入的时候加间隙锁，并且是悲观锁，确实性能上没有乐观锁好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1701995666,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":607011,"ip_address":"广东","group_id":0},"score":633308,"extra":""}]}]},{"had_liked":false,"id":151975,"user_name":"奕","can_delete":false,"product_type":"c3","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1573825792,"is_pvip":false,"replies":[{"id":58427,"content":"BSON 是一个物理层的概念：在存储到硬盘，和传输到网络上的时候所用。通常仅仅存储引擎或者mongodb驱动的开发者才需要关注。大部分MongoDB使用者还是基于JSON。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1573829727,"ip_address":"","comment_id":151975,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"MongoDB 也有说是基于 BSON 模型， 这个BSON模型怎么理解呢？ 只是JSON二进制存储吗？","like_count":3,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474676,"discussion_content":"BSON 是一个物理层的概念：在存储到硬盘，和传输到网络上的时候所用。通常仅仅存储引擎或者mongodb驱动的开发者才需要关注。大部分MongoDB使用者还是基于JSON。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573829727,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":233649,"user_name":"heyucool","can_delete":false,"product_type":"c3","uid":1042214,"ip_address":"","ucode":"9C3406FC8E9C0B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e7/26/1b773620.jpg","comment_is_top":false,"comment_ctime":1594375415,"is_pvip":false,"replies":[{"id":88165,"content":"实际情况是，很多同学在学校里学习的只是SQL。很多开发团队，特别是有项目压力的，没有时间让团队来学习，就会选择大家比较熟悉的方式。 \n\n如果有额外的时间的话，我的几个创业公司的朋友都说，想从MySQL 切换到MongoDB。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1596278241,"ip_address":"","comment_id":233649,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"mongodb是不是完爆mysql呢？什么情况下该选用mysql而不是MongoDB呢？","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501120,"discussion_content":"实际情况是，很多同学在学校里学习的只是SQL。很多开发团队，特别是有项目压力的，没有时间让团队来学习，就会选择大家比较熟悉的方式。 \n\n如果有额外的时间的话，我的几个创业公司的朋友都说，想从MySQL 切换到MongoDB。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596278241,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2055554,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/5d/82/81b2ba91.jpg","nickname":"keep_it_real","note":"","ucode":"F5057CAF752FF3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295082,"discussion_content":"那你就该去了解一下B树和B＋树的区别，innodb是基于B＋树的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596083816,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":195781,"user_name":"梦想","can_delete":false,"product_type":"c3","uid":1046939,"ip_address":"","ucode":"F1E8C08813F2E0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f9/9b/3d056492.jpg","comment_is_top":false,"comment_ctime":1585215193,"is_pvip":false,"replies":[{"id":74310,"content":"mongodump &#47; mongorestore的方式可以跨版本，但是跨这么多也要试试才行。\n","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1585215801,"ip_address":"","comment_id":195781,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"MongoDB支持跨版本升级吗 例如2.x升级到4.x\n","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489157,"discussion_content":"mongodump / mongorestore的方式可以跨版本，但是跨这么多也要试试才行。\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585215801,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":179974,"user_name":"xydsdsr","can_delete":false,"product_type":"c3","uid":1103260,"ip_address":"","ucode":"7C85E1A95F738C","user_header":"https://static001.geekbang.org/account/avatar/00/10/d5/9c/3e40808d.jpg","comment_is_top":false,"comment_ctime":1582132314,"is_pvip":false,"replies":[{"id":70110,"content":"如果你大部分的操作是基于脚本和关卡直接操作，那如果用组合的方法不一定是最优的。虽然，MongoDB对嵌套数组的操作支持还是很给力，你可以直接取出关卡或脚本，通过使用projection 过滤字段及不匹配的数组元素。对内嵌数组操作也是可以用到索引的，所以效率也不会太糟糕。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1582380602,"ip_address":"","comment_id":179974,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师，请教一下，目前我们游戏中存储的章节数据。一个章节包含多个关卡，一个关卡包含多个脚本数据。 现在的做法是建立三个表来存储章节、关卡和脚本，每个表都有多个字段，通过id建立关联。思考过怎么组合使用，但是存在单独访问某一个脚本或某一个关卡信息的情况，感觉如果组合使用获取这种信息会很麻烦，请问下老师是否应该组合使用？还是用多个表通过id关联更好用呢？","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484471,"discussion_content":"如果你大部分的操作是基于脚本和关卡直接操作，那如果用组合的方法不一定是最优的。虽然，MongoDB对嵌套数组的操作支持还是很给力，你可以直接取出关卡或脚本，通过使用projection 过滤字段及不匹配的数组元素。对内嵌数组操作也是可以用到索引的，所以效率也不会太糟糕。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582380602,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":156130,"user_name":"袭","can_delete":false,"product_type":"c3","uid":1077573,"ip_address":"","ucode":"D5B8609CDFB145","user_header":"https://static001.geekbang.org/account/avatar/00/10/71/45/126cd913.jpg","comment_is_top":false,"comment_ctime":1574822499,"is_pvip":false,"replies":[{"id":60156,"content":"wiredtiger可以充分利用多核做并行处理。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1574943878,"ip_address":"","comment_id":156130,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"单机多核的计算行服务器，mongodb针对多核有没有优势？","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475998,"discussion_content":"wiredtiger可以充分利用多核做并行处理。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574943878,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":151488,"user_name":"cofesun","can_delete":false,"product_type":"c3","uid":1211753,"ip_address":"","ucode":"28F6EA88AE62B4","user_header":"https://static001.geekbang.org/account/avatar/00/12/7d/69/10691922.jpg","comment_is_top":false,"comment_ctime":1573729928,"is_pvip":false,"replies":[{"id":58397,"content":"你是一次性查询多条记录做分析汇总吗？那必须是去多个地方找。一条记录的话肯定是在一个地方。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1573792319,"ip_address":"","comment_id":151488,"utype":1}],"discussion_count":3,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"如果需要的数字存在多张表中，还是要定位多次吧","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474495,"discussion_content":"你是一次性查询多条记录做分析汇总吗？那必须是去多个地方找。一条记录的话肯定是在一个地方。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573792319,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1148351,"avatar":"https://static001.geekbang.org/account/avatar/00/11/85/bf/36b01d36.jpg","nickname":"德斯儿","note":"","ucode":"C4EE9BAD859EED","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":51437,"discussion_content":"比如部门信息和员工信息两张表，要修改某个部门名称，\nMySQL的话，只需要修改部门表就可以；mongodb就需要修改部门信息后，再把员工信息中部门信息字段再修改。类似这样的修改场景，用mongodb是不是麻烦了一些","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573872976,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1035090,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/cb/52/d3c95e6c.jpg","nickname":"阿兵","note":"","ucode":"E5A4EC72023DC7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1148351,"avatar":"https://static001.geekbang.org/account/avatar/00/11/85/bf/36b01d36.jpg","nickname":"德斯儿","note":"","ucode":"C4EE9BAD859EED","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303502,"discussion_content":"使用mongodb，部门信息和员工信息是两个集合（表），员工信息中可以用一个字段存储部门信息的主键（_id）字段，这样修改部门名称只需要改部门信息集合就可以了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599285155,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":51437,"ip_address":"","group_id":0},"score":303502,"extra":""}]}]},{"had_liked":false,"id":168042,"user_name":"book尾汁","can_delete":false,"product_type":"c3","uid":1446375,"ip_address":"","ucode":"AE2B8DFC643ACC","user_header":"https://static001.geekbang.org/account/avatar/00/16/11/e7/044a9a6c.jpg","comment_is_top":false,"comment_ctime":1577985536,"is_pvip":false,"replies":[{"id":65260,"content":"mysql 一张表没法做到一对多的关系，只能拆分表来做。当然，mysql现在也支持json了，但是那个是非主流用法。对JSON的支持也是相对较弱，所以使用人并不多。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1578009749,"ip_address":"","comment_id":168042,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"小白问个比较低级的问题，这个例子中为什么mysql不用一张表多个字段呢，而是拆分成几个表","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480115,"discussion_content":"mysql 一张表没法做到一对多的关系，只能拆分表来做。当然，mysql现在也支持json了，但是那个是非主流用法。对JSON的支持也是相对较弱，所以使用人并不多。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578009749,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":154157,"user_name":"qbit","can_delete":false,"product_type":"c3","uid":1262927,"ip_address":"","ucode":"96C70A1E47B93D","user_header":"https://static001.geekbang.org/account/avatar/00/13/45/4f/f94caf47.jpg","comment_is_top":false,"comment_ctime":1574385829,"is_pvip":false,"replies":[{"id":59281,"content":"在一个复制集群里没有multi-master，但是一个分片集群可以有多个master (primary), 每个分片一个primary这种方式。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1574429373,"ip_address":"","comment_id":154157,"utype":1}],"discussion_count":3,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"MongoDB 支持multi-master，所有节点可以同时读写数据库吗？","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475390,"discussion_content":"在一个复制集群里没有multi-master，但是一个分片集群可以有多个master (primary), 每个分片一个primary这种方式。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574429373,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1262927,"avatar":"https://static001.geekbang.org/account/avatar/00/13/45/4f/f94caf47.jpg","nickname":"qbit","note":"","ucode":"96C70A1E47B93D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":56743,"discussion_content":"如果只有3台机器，配置3台机器的单实例分片集群，相对于3台机器的副本集优势劣势怎么说？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574513841,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1262927,"avatar":"https://static001.geekbang.org/account/avatar/00/13/45/4f/f94caf47.jpg","nickname":"qbit","note":"","ucode":"96C70A1E47B93D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":217370,"discussion_content":"应该还是一个主，两个从吧。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585550489,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":56743,"ip_address":"","group_id":0},"score":217370,"extra":""}]}]},{"had_liked":false,"id":152180,"user_name":"陈靖","can_delete":false,"product_type":"c3","uid":1147418,"ip_address":"","ucode":"8C9596A54DB5C8","user_header":"https://static001.geekbang.org/account/avatar/00/11/82/1a/64ec25ff.jpg","comment_is_top":false,"comment_ctime":1573902905,"is_pvip":false,"replies":[{"id":58803,"content":"如果不说单节点性能比较，MongoDB最少是分布式架构，可以通过横向扩容来克服性能瓶颈。这个和同样是用来作为应用程序数据库的RDBMS来比还是有很明显的优势的。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1574143251,"ip_address":"","comment_id":152180,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"性能优势大不大呢？","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474740,"discussion_content":"如果不说单节点性能比较，MongoDB最少是分布式架构，可以通过横向扩容来克服性能瓶颈。这个和同样是用来作为应用程序数据库的RDBMS来比还是有很明显的优势的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574143251,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":151044,"user_name":"旺旺","can_delete":false,"product_type":"c3","uid":1159196,"ip_address":"","ucode":"FE2CF90F446BFB","user_header":"https://static001.geekbang.org/account/avatar/00/11/b0/1c/2e30eeb8.jpg","comment_is_top":false,"comment_ctime":1573647061,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"老师，MongoDB与Elasticsearch相比，各有什么特长和侧重呢？\n公司现在两个都在用，区别在哪里呢？","like_count":33,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":50277,"discussion_content":"MongoDB是一个全功能的数据库，主要应用于增删改查类型的实时交互场景。有非常多的系统只用MongoDB作为唯一的后端数据库，但是你几乎找不出来一个应用是完全用Elastic作为后端的。\n\nElastic最强的是全文搜索场景，后面实现基于Lucene。它最大的问题就是索引更新有延迟，默认是一分钟。所以一般不能用来作为交互应用如手机端或者PC端应用。通常大家都是用一个DB+Elastic组合来使用。 \n\nMongoDB的全文搜索功能虽然有，但是很多时候达不到业务要求。所以很多人也会用MongoDB + Elastic 的组合方式。\n\n简单来说，如果你的场景是只读，并且能够接受一定的数据延迟（非最新的数据），那么可以考虑Elastic。如果你的场景有实时写入实时更新，通常MongoDB会是更好的选择。","likes_number":23,"is_delete":false,"is_hidden":false,"ctime":1573698581,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":283020,"user_name":"。","can_delete":false,"product_type":"c3","uid":1222200,"ip_address":"","ucode":"75B163F01F20F3","user_header":"https://static001.geekbang.org/account/avatar/00/12/a6/38/55483b8c.jpg","comment_is_top":false,"comment_ctime":1615520660,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"唐老师好，不知道是否还能得到回复。\n\n我现在有一个使用场景，不知道采用mongodb是否适用：前台传过来一个大的json数组（20MB左右）由5000个左右的小json数据组成。\n\n1.我想把这个大json数组拆分成小json来存储，那就是5000个左右的json文档，批量插入的性能怎么样？\n2.前台需要查询上一步插入的大json数组，我拆分成5000个文档后，一次查询这么多数据或者分几次查询之后通过业务代码拼装。这个性能怎么样？\n\n以上两个问题，麻烦唐老师解惑：）","like_count":2},{"had_liked":false,"id":385052,"user_name":"芋头","can_delete":false,"product_type":"c3","uid":1070287,"ip_address":"广东","ucode":"390438CFF71F0A","user_header":"https://static001.geekbang.org/account/avatar/00/10/54/cf/fddcf843.jpg","comment_is_top":false,"comment_ctime":1701995732,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"增加分片的时候是否存在数据迁移？","like_count":0},{"had_liked":false,"id":351627,"user_name":"王周敬","can_delete":false,"product_type":"c3","uid":1989737,"ip_address":"","ucode":"ABAC941339CBED","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/qUHuge7oea6mA4bUTyJ4ro9RYsGNOrXe6XccO7fV90xyaC5HgjG2DwJvauQiavcuS0KQFq5U1JUFLHtH6gZULag/132","comment_is_top":false,"comment_ctime":1658024153,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"老师可以讲一下时序数据集吗","like_count":0},{"had_liked":false,"id":351626,"user_name":"王周敬","can_delete":false,"product_type":"c3","uid":1989737,"ip_address":"","ucode":"ABAC941339CBED","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/qUHuge7oea6mA4bUTyJ4ro9RYsGNOrXe6XccO7fV90xyaC5HgjG2DwJvauQiavcuS0KQFq5U1JUFLHtH6gZULag/132","comment_is_top":false,"comment_ctime":1658024083,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"ppt可以给我们下吗","like_count":0},{"had_liked":false,"id":347059,"user_name":"颜海航","can_delete":false,"product_type":"c3","uid":1308159,"ip_address":"","ucode":"5644F6328BF901","user_header":"https://static001.geekbang.org/account/avatar/00/13/f5/ff/523fb378.jpg","comment_is_top":false,"comment_ctime":1653651555,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"社区版的MongoDB与 percona 的MongoDB主要区别是什么呀  老师","like_count":0},{"had_liked":false,"id":304089,"user_name":"马国勇","can_delete":false,"product_type":"c3","uid":2208098,"ip_address":"","ucode":"714D022D6E9D69","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/aASwvdUOQZccCfpyzhMG0RPPYMF04nlL2fSsqoSmKia5A11dYe2Ba7u3cgxsE35mhlPAQ79NpFHAEM36orpFibhQ/132","comment_is_top":false,"comment_ctime":1627227744,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"老师，我有大约10个字段自由组合查询条件，包含模糊查询，这样的场景适合使用mongodb吗","like_count":0},{"had_liked":false,"id":281333,"user_name":"SandCarving","can_delete":false,"product_type":"c3","uid":2056201,"ip_address":"","ucode":"6B97DB71613A46","user_header":"https://static001.geekbang.org/account/avatar/00/1f/60/09/a8e7913b.jpg","comment_is_top":false,"comment_ctime":1614694054,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"用过Sequoiadb，好像两个差不多","like_count":0},{"had_liked":false,"id":263722,"user_name":"小兵","can_delete":false,"product_type":"c3","uid":1261674,"ip_address":"","ucode":"AA3BA727C25179","user_header":"https://static001.geekbang.org/account/avatar/00/13/40/6a/ab1cf396.jpg","comment_is_top":false,"comment_ctime":1606231886,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"直接存对象的话会不会有很多的数据冗余，比如关系型是数据库里的多对一的场景，每条记录里面都会保存一份了。","like_count":0},{"had_liked":false,"id":241837,"user_name":"一天","can_delete":false,"product_type":"c3","uid":1078410,"ip_address":"","ucode":"2BE0596D23E4F7","user_header":"https://static001.geekbang.org/account/avatar/00/10/74/8a/88474b8e.jpg","comment_is_top":false,"comment_ctime":1597462712,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"老师您好，海量的数据要实时从mongoDB同步es，除了logstash还有没其他更高效的方式？","like_count":0}]}