{"id":2270,"title":"10 | 微服务 API 服务网关（一）原理","content":"<p>无</p>\n","comments":[{"had_liked":false,"id":2379,"user_name":"LMD","can_delete":false,"product_type":"c3","uid":1013443,"ip_address":"","ucode":"7626FBB7A4E771","user_header":"","comment_is_top":true,"comment_ctime":1516964820,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"关于《微服务架构核心20讲》课程讲义（PDF 文件），学员可复制下面链接到浏览器下载获取。 http:&#47;&#47;t.cn&#47;RQs9iTw","like_count":10,"discussions":[{"author":{"id":1254863,"avatar":"https://static001.geekbang.org/account/avatar/00/13/25/cf/1366dfc8.jpg","nickname":"冷雨","note":"","ucode":"04182E3808BEC6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592773,"discussion_content":"这个链接失效了,请问下最新的下载在上面地方?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667701094,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"湖南","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":98040,"user_name":"thinkcat","can_delete":false,"product_type":"c3","uid":1546829,"ip_address":"","ucode":"5D94C4F26DE1CB","user_header":"","comment_is_top":false,"comment_ctime":1558881067,"is_pvip":false,"replies":[{"id":35176,"content":"你好，反向路由或者代理(reverse proxy)，主要针对前向路由和代理(forward proxy)来讲的，都是技术术语。\n\n举例，如果我们X要访问国外的一个网站Z，但是被墙了，这可以时候可以通过找代理Y来翻墙访问，这个代理就是前向代理，它帮助我们去访问目标服务（这个目标服务我们是知道的，只是被墙了），X-&gt;Y-&gt;Z。\n\n对于企业内部的服务，一般躲在如nginx这样的反向代理后面，当我们X去访问企业的服务Z时候，我们并不知道具体服务部署在那里，反向代理Y知道并且会反向帮我们去转发，X-&gt;Y-&gt;Z这就是反向代理的作用，屏蔽内部服务的部署和实现细节。\n\n两者的地位有点类似，但是具体作用不同。可以进一步参考stackoverflow上的详细解释：https:&#47;&#47;stackoverflow.com&#47;questions&#47;224664&#47;difference-between-proxy-server-and-reverse-proxy-server","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1558961664,"ip_address":"","comment_id":98040,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"老师，您好。我想问一下，反向路由还没有理解透，为什么叫反向路由这个名字？谢谢","like_count":6,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451530,"discussion_content":"你好，反向路由或者代理(reverse proxy)，主要针对前向路由和代理(forward proxy)来讲的，都是技术术语。\n\n举例，如果我们X要访问国外的一个网站Z，但是被墙了，这可以时候可以通过找代理Y来翻墙访问，这个代理就是前向代理，它帮助我们去访问目标服务（这个目标服务我们是知道的，只是被墙了），X-&amp;gt;Y-&amp;gt;Z。\n\n对于企业内部的服务，一般躲在如nginx这样的反向代理后面，当我们X去访问企业的服务Z时候，我们并不知道具体服务部署在那里，反向代理Y知道并且会反向帮我们去转发，X-&amp;gt;Y-&amp;gt;Z这就是反向代理的作用，屏蔽内部服务的部署和实现细节。\n\n两者的地位有点类似，但是具体作用不同。可以进一步参考stackoverflow上的详细解释：https://stackoverflow.com/questions/224664/difference-between-proxy-server-and-reverse-proxy-server","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1558961664,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":3565,"user_name":"Zihoo","can_delete":false,"product_type":"c3","uid":1056976,"ip_address":"","ucode":"2136F706BF83A1","user_header":"https://static001.geekbang.org/account/avatar/00/10/20/d0/8c960ff9.jpg","comment_is_top":false,"comment_ctime":1519906515,"is_pvip":false,"replies":[{"id":1364,"content":"对后端微服务做负载均衡可以是网关的一个主要功能（也有不靠网关做负载均衡的做法）网关一般无状态布部署多个，且可横向扩展，网关本身靠前置LB做负载均衡。","user_name":"作者回复","user_name_real":"晨晖","uid":1000463,"ctime":1522812207,"ip_address":"","comment_id":3565,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"网关上面放负载均衡是为了网关可以横向扩展，那么我看图上的负载均衡只画了一个，实际上负载均衡也应该是多个可横向扩展的吧？","like_count":4,"discussions":[{"author":{"id":1000463,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/44/0f/abb7bfe3.jpg","nickname":"Geek_4zi01v","note":"","ucode":"6A485218B87E38","race_medal":0,"user_type":4,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":415942,"discussion_content":"对后端微服务做负载均衡可以是网关的一个主要功能（也有不靠网关做负载均衡的做法）网关一般无状态布部署多个，且可横向扩展，网关本身靠前置LB做负载均衡。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1522812207,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":122706,"user_name":"飞舟","can_delete":false,"product_type":"c3","uid":1625832,"ip_address":"","ucode":"FE4C612A00B9F4","user_header":"https://static001.geekbang.org/account/avatar/00/18/ce/e8/abd8f0c6.jpg","comment_is_top":false,"comment_ctime":1565494263,"is_pvip":false,"replies":[{"id":45041,"content":"有状态分为两种，一种是全局状态，一种是局部状态，局部状态相当于每个节点有一份自己的状态，这个不影响横向扩展。比方说，zuul gateway + ribbon + eureka 实现负载均衡，每个zuul有一个ribbon配合实现负载均衡，微服务启动时注册到eureka，之后每一个zuul上的ribbon会同步eureka中的服务实例列表，然后基于这个服务实例列表实现负载均衡和调用，这个服务实例列表就是局部状态，zuul仍然可以横向扩展，全局状态则在eureka中，eureka有自己的状态复制机制实现集群和HA。zuul前置可以有硬件负载均衡器(LB)，这样可以实现对zuul的负载均衡访问，硬件LB一般采用主备，或者DNS roundrobi机制实现HA和扩展。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1565531502,"ip_address":"","comment_id":122706,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"请问，如果负载均衡做在API gateway里，API gateway就有状态了，不能横向扩展了？只能主备，或者通过DNS roundrobin？谢谢！","like_count":3,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462366,"discussion_content":"有状态分为两种，一种是全局状态，一种是局部状态，局部状态相当于每个节点有一份自己的状态，这个不影响横向扩展。比方说，zuul gateway + ribbon + eureka 实现负载均衡，每个zuul有一个ribbon配合实现负载均衡，微服务启动时注册到eureka，之后每一个zuul上的ribbon会同步eureka中的服务实例列表，然后基于这个服务实例列表实现负载均衡和调用，这个服务实例列表就是局部状态，zuul仍然可以横向扩展，全局状态则在eureka中，eureka有自己的状态复制机制实现集群和HA。zuul前置可以有硬件负载均衡器(LB)，这样可以实现对zuul的负载均衡访问，硬件LB一般采用主备，或者DNS roundrobi机制实现HA和扩展。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565531502,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":8105,"user_name":"Ethan","can_delete":false,"product_type":"c3","uid":1047835,"ip_address":"","ucode":"DB4EF73FA57590","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fd/1b/7ff2bb2f.jpg","comment_is_top":false,"comment_ctime":1525912990,"is_pvip":false,"replies":[{"id":2426,"content":"1，haproxy可以做成网关，但是门槛比较高，需要深度定制，你有没有研发资源可以hold住？\n2，haproxy -&gt; GW -&gt; Service，中间再加一层网关也可以，haproxy相当于只做四层转发，对GW做负载均衡，现在不少是这样做的\n3，聚合层一般是一种前端service，对后端服务进行聚合的，haproxy -&gt; GW -&gt; aggregator service -&gt; backend service，这种模式用得也挺多\n4, http绝对性能应该比不上tcp，但是要看场景，大部分互联网应用（比如电商）http足够\n5，如果你求绝对性能，可以直接haproxy（tcp）-&gt; service，开销最小，haproxy上可以扩展网关功能，需要定制自研能力，有研发资源能hold住","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1526044458,"ip_address":"","comment_id":8105,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"杨老师，api 统一网关我可以用hapoxy 做吗，HAPoxy可以做到分流熔断，但是好像做不了安全检验，难道应用程序层面还要再做一次统一网关，然后在去掉聚合层吗，那聚合层在去掉用服务，这样中间走了2几次socket 了，另外服务的调用我现在用的自定义tcp 协议，有人说用http 就好了，但是http 协议不是还要多走一次7层的nginx 吗，效率不是更慢吗","like_count":3,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":417582,"discussion_content":"1，haproxy可以做成网关，但是门槛比较高，需要深度定制，你有没有研发资源可以hold住？\n2，haproxy -&amp;gt; GW -&amp;gt; Service，中间再加一层网关也可以，haproxy相当于只做四层转发，对GW做负载均衡，现在不少是这样做的\n3，聚合层一般是一种前端service，对后端服务进行聚合的，haproxy -&amp;gt; GW -&amp;gt; aggregator service -&amp;gt; backend service，这种模式用得也挺多\n4, http绝对性能应该比不上tcp，但是要看场景，大部分互联网应用（比如电商）http足够\n5，如果你求绝对性能，可以直接haproxy（tcp）-&amp;gt; service，开销最小，haproxy上可以扩展网关功能，需要定制自研能力，有研发资源能hold住","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1526044458,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":200858,"user_name":"郭新鹏","can_delete":false,"product_type":"c3","uid":1154281,"ip_address":"","ucode":"F9D76691B335FC","user_header":"https://static001.geekbang.org/account/avatar/00/11/9c/e9/5ba8b1a3.jpg","comment_is_top":false,"comment_ctime":1585663106,"is_pvip":false,"replies":[{"id":75439,"content":"可以，术语没有明确规范，各家叫法可能不同，方便理解和沟通即可。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1585839358,"ip_address":"","comment_id":200858,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"网关是否也可称为接入层","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490156,"discussion_content":"可以，术语没有明确规范，各家叫法可能不同，方便理解和沟通即可。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585839358,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108801,"user_name":"小黄鸡","can_delete":false,"product_type":"c3","uid":1052618,"ip_address":"","ucode":"9497430EB4CDAA","user_header":"https://static001.geekbang.org/account/avatar/00/10/0f/ca/532d8e8e.jpg","comment_is_top":false,"comment_ctime":1561885637,"is_pvip":false,"replies":[{"id":39537,"content":"网关有路由表(服务名 or id &lt;&gt; 后台服务地址的映射)和路由逻辑，路由逻辑和业务逻辑不同，前者偏技术，后者偏业务。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1561982716,"ip_address":"","comment_id":108801,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"杨波老师，想问下如果网关不参与业务逻辑，那网关怎么知道路由到后端服务呢？\n我目前设计的网关都是后端服务新增对外提供服务的api后，都需要更新网关","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456121,"discussion_content":"网关有路由表(服务名 or id &amp;lt;&amp;gt; 后台服务地址的映射)和路由逻辑，路由逻辑和业务逻辑不同，前者偏技术，后者偏业务。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561982716,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":60483,"user_name":"Jed","can_delete":false,"product_type":"c3","uid":1204911,"ip_address":"","ucode":"6021AF7FC03AF6","user_header":"https://static001.geekbang.org/account/avatar/00/12/62/af/d2d0312d.jpg","comment_is_top":false,"comment_ctime":1547477854,"is_pvip":false,"replies":[{"id":21754,"content":"不是说接了负载均衡以后就保证了网关无状态，而是说网关本身需要无状态多份部署，这样一方面可以按需水平扩容，另一方面可以保证高可用。无状态多份部署以后，就需要前置负载均衡设备，将流量按一定的负载均衡策略分发到不同的网关实例上。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1547620322,"ip_address":"","comment_id":60483,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"为什么接入负载均衡以后就保证了网关无状态？关联在哪里，有点不太明白","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436523,"discussion_content":"不是说接了负载均衡以后就保证了网关无状态，而是说网关本身需要无状态多份部署，这样一方面可以按需水平扩容，另一方面可以保证高可用。无状态多份部署以后，就需要前置负载均衡设备，将流量按一定的负载均衡策略分发到不同的网关实例上。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547620322,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57740,"user_name":"lucky star","can_delete":false,"product_type":"c3","uid":1311928,"ip_address":"","ucode":"C61FC9CA1C8A60","user_header":"https://static001.geekbang.org/account/avatar/00/14/04/b8/3fd2f448.jpg","comment_is_top":false,"comment_ctime":1546878338,"is_pvip":false,"replies":[{"id":21536,"content":"1，一种部署方式为：硬件LB(或云端SLB)-&gt;nginx-&gt;gateway-&gt;app services，硬件LB(或云端SLB)对nginx做负载均衡，nginx对gateway做负载均衡，gateway对app services做负载均衡，上述是一个简化模式，实际使用中还有很多变体。\n2，gateway是无状态部署，但是它可以连有状态服务，例如，gateway可以连redis进行登录态校验。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1547452990,"ip_address":"","comment_id":57740,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"请教老师几个问题：\n     1， 因为gateway不能存在单点问题， 所以可以使用nginx做负载均衡。 而应用服务如果做集群的话， 同样需要gateway做负载均衡， gateway怎么做负载均衡呢？还是要再用nginx呢？\n     2， 老师说gateway是要无状态的， 那登录之类的拦截是在哪一层完成？\n     3， gateway建不建议直接连接redis？  我还是没具体太明白gateway的在微服务中的地位\n\n期待老师解答\n","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435731,"discussion_content":"1，一种部署方式为：硬件LB(或云端SLB)-&amp;gt;nginx-&amp;gt;gateway-&amp;gt;app services，硬件LB(或云端SLB)对nginx做负载均衡，nginx对gateway做负载均衡，gateway对app services做负载均衡，上述是一个简化模式，实际使用中还有很多变体。\n2，gateway是无状态部署，但是它可以连有状态服务，例如，gateway可以连redis进行登录态校验。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547452990,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":23001,"user_name":"在路上","can_delete":false,"product_type":"c3","uid":1216042,"ip_address":"","ucode":"170DA8D9E88726","user_header":"https://static001.geekbang.org/account/avatar/00/12/8e/2a/22423d8b.jpg","comment_is_top":false,"comment_ctime":1536108388,"is_pvip":false,"replies":[{"id":8665,"content":"网关上面的LB可以是硬件LB，比如F5，也可以是如nginx这样的软件LB，还可以是硬件+软件两层结构，LB一般做成高可用（比如主丛+故障自动切换），不会随便挂，LB要真挂了服务肯定都访问不了了","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1536641744,"ip_address":"","comment_id":23001,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"杨老师，网关上面的负载均衡一般是指nginx这种软件负载均衡吗？可以横向扩展吗？如果是集中式的，负载均衡器挂了，整个服务是不是也访问不了了？请指教！","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":423364,"discussion_content":"网关上面的LB可以是硬件LB，比如F5，也可以是如nginx这样的软件LB，还可以是硬件+软件两层结构，LB一般做成高可用（比如主丛+故障自动切换），不会随便挂，LB要真挂了服务肯定都访问不了了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1536641744,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":15552,"user_name":"dingwood","can_delete":false,"product_type":"c3","uid":1153828,"ip_address":"","ucode":"460EB0C6E8C611","user_header":"https://static001.geekbang.org/account/avatar/00/11/9b/24/1e4883c6.jpg","comment_is_top":false,"comment_ctime":1531284854,"is_pvip":false,"replies":[{"id":5398,"content":"没有限制说网关不能直接访问基础服务，上述划分是逻辑性的，不是物理性的","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1531405801,"ip_address":"","comment_id":15552,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100003901,"comment_content":"杨老师，想确认一下，即便采用客户端-网关-聚合服务-基础服务这样的服务层次，网关层面也依然可以访问基础服务吧。聚合服务不会完全隔离网关对基础服务的访问吧？企业实际落地情况如何","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420438,"discussion_content":"没有限制说网关不能直接访问基础服务，上述划分是逻辑性的，不是物理性的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1531405801,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":15392,"user_name":"krugle","can_delete":false,"product_type":"c3","uid":1045770,"ip_address":"","ucode":"60A7D9189C01BE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f5/0a/077b9922.jpg","comment_is_top":false,"comment_ctime":1531154982,"is_pvip":false,"replies":[{"id":5400,"content":"两个概念，api网关是微服务体系中的基础服务，mvc控制器是mvc框架中的一个层次","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1531406399,"ip_address":"","comment_id":15392,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100003901,"comment_content":"api网关与mvc控制器什么区别 ","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420368,"discussion_content":"两个概念，api网关是微服务体系中的基础服务，mvc控制器是mvc框架中的一个层次","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1531406399,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":15298,"user_name":"meijing0114","can_delete":false,"product_type":"c3","uid":1012416,"ip_address":"","ucode":"B349D33E2F3ECC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/72/c0/b09911a0.jpg","comment_is_top":false,"comment_ctime":1531097715,"is_pvip":false,"replies":[{"id":5403,"content":"filter或aop也是一种简单做法，规模不大可以","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1531407060,"ip_address":"","comment_id":15298,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100003901,"comment_content":"个人理解，好处就是少了一层，复杂度减少了。坏处就是复杂度增加了，并且结构没有那么清晰。但其实可以使用filter或者aop的方式,让开发聚合逻辑的同学 不要关心网关本身承担的四项功能。","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420326,"discussion_content":"filter或aop也是一种简单做法，规模不大可以","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1531407060,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":14752,"user_name":"meijing0114","can_delete":false,"product_type":"c3","uid":1012416,"ip_address":"","ucode":"B349D33E2F3ECC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/72/c0/b09911a0.jpg","comment_is_top":false,"comment_ctime":1530631529,"is_pvip":false,"replies":[{"id":5084,"content":"👍经验丰富","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1530894142,"ip_address":"","comment_id":14752,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100003901,"comment_content":"放在前置的filter中，通过判断请求的user-agent，识别是否是爬虫请求，如果是的话，就直接返回默认数据。或为了搜索引擎优化的话，返回特定优化过的数据。这样不会给主线的服务造成不必要的压力。另外针对ua混淆过的请求，可以通过记录ip的方式，一分钟限制固定请求频率，超过频率即可丢弃，也是放在前置filter中进行处理。","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420121,"discussion_content":"👍经验丰富","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1530894142,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":7010,"user_name":"Ethan","can_delete":false,"product_type":"c3","uid":1047835,"ip_address":"","ucode":"DB4EF73FA57590","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fd/1b/7ff2bb2f.jpg","comment_is_top":false,"comment_ctime":1525225287,"is_pvip":false,"replies":[{"id":2341,"content":"路由，安全，监控，限流熔断，审计等跨横切面功能","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1525879328,"ip_address":"","comment_id":7010,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100003901,"comment_content":"请问杨老师，网关一般用什么做","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":417204,"discussion_content":"路由，安全，监控，限流熔断，审计等跨横切面功能","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1525879328,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":3375,"user_name":"self-discipline","can_delete":false,"product_type":"c3","uid":1024457,"ip_address":"","ucode":"A5AEDCA9ACC68A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a1/c9/501a1d02.jpg","comment_is_top":false,"comment_ctime":1519269589,"is_pvip":false,"replies":[{"id":1376,"content":"网关适合放跨横切面（cross-cutting concerns）的逻辑，统计限流属于跨横切面逻辑，放网关比较合适的。","user_name":"作者回复","user_name_real":"晨晖","uid":1000463,"ctime":1522822505,"ip_address":"","comment_id":3375,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100003901,"comment_content":"咨询下杨老师,网关放安全限制,比如api的id,ip调用次数限制,应该可以吧.我就是这么处理,感觉安全性的,放在这里没有问题","like_count":2,"discussions":[{"author":{"id":1000463,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/44/0f/abb7bfe3.jpg","nickname":"Geek_4zi01v","note":"","ucode":"6A485218B87E38","race_medal":0,"user_type":4,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":415884,"discussion_content":"网关适合放跨横切面（cross-cutting concerns）的逻辑，统计限流属于跨横切面逻辑，放网关比较合适的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1522822505,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":215797,"user_name":"jun","can_delete":false,"product_type":"c3","uid":1899314,"ip_address":"","ucode":"3A9633CA1FE72E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/LalJD9ruYQI5zVM1GOCe4PjunIbbeeMiacFHC4TAj0DBVeialKt3vRCLs9dxn1vYXvfp8pgcyaeEQkh1nde1JoBQ/132","comment_is_top":false,"comment_ctime":1589104752,"is_pvip":false,"replies":[{"id":79981,"content":"聚合服务也是一种微服务。逻辑上我们把聚合服务和后台基础微服务分为两层，这样职责更清晰。\n\n整个层次可以这样理解：\n用户端 -&gt; 网关GW -&gt; 聚合服务-&gt; 基础服务 -&gt;数据库。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1589204814,"ip_address":"","comment_id":215797,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100003901,"comment_content":"杨老师你好，网关主要负责安全认证、路由转发到需要调用的业务接口（包括各微服务的通用接口），和聚合业务接口。聚合服务和微服务应该是在一个层面上，不知道这样理解对不对；","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494560,"discussion_content":"聚合服务也是一种微服务。逻辑上我们把聚合服务和后台基础微服务分为两层，这样职责更清晰。\n\n整个层次可以这样理解：\n用户端 -&amp;gt; 网关GW -&amp;gt; 聚合服务-&amp;gt; 基础服务 -&amp;gt;数据库。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589204814,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":181000,"user_name":"钱","can_delete":false,"product_type":"c3","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1582456952,"is_pvip":false,"replies":[{"id":74745,"content":"爬楼梯吧，上面有前向(forward)和反向(reverse)代理的解释","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1585483205,"ip_address":"","comment_id":181000,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100003901,"comment_content":"网关，没做过相关的开发，老师讲的大概明白。从老师的讲解中看，网关是一个软件系统，类似小区门口的门卫，起到了屏蔽内部服务实现细节，对外提供统一接口的作用，另外还负责反向路由、安全认证、限流、熔断、日志监控等作用，当然他也可以对服务进行负载均衡。\n一个请求从PC或移动设备上发出，会经过许多的环节，域名解析——多级负载均衡——网关——服务。\n\n反向路由，看到有同学问了这个问题，我感觉也没理解透。路由是容易理解的，关键在于反向是怎么体现的，请求到网关时网关需要把请求和对应的服务对接上，服务的响应应该也是通过网关，然后再返回到原请求的客户端，这里有两个方向上的路由，反向路由强调的是哪个呢？还是两个都是？\n老师举得例子，感觉没啥方向性，貌似再说x知道z，但不能访问通过y能访问y就是正向代理。当x不知道z时通过y能访问z，此时y就是反向代理了。\n哈哈，有点乱，先写到这，回头看一下老师给的链接，虽然，没完全明白，不过我相信就是一个路由方向性的角度描述。","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484883,"discussion_content":"爬楼梯吧，上面有前向(forward)和反向(reverse)代理的解释","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585483205,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56963,"user_name":"王盛武","can_delete":false,"product_type":"c3","uid":1182516,"ip_address":"","ucode":"DE7EF246D3DCE8","user_header":"https://static001.geekbang.org/account/avatar/00/12/0b/34/f41d73a4.jpg","comment_is_top":false,"comment_ctime":1546587864,"is_pvip":false,"replies":[{"id":21540,"content":"视情况，如果你团队小资源少，可以暂时合在一起，如果业务和团队大，就要考虑单一职责，拆分部署。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1547453773,"ip_address":"","comment_id":56963,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100003901,"comment_content":"H5和PC的网关Zuul，  一般是合并部署还是分开部署？","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435333,"discussion_content":"视情况，如果你团队小资源少，可以暂时合在一起，如果业务和团队大，就要考虑单一职责，拆分部署。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547453773,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56934,"user_name":"王盛武","can_delete":false,"product_type":"c3","uid":1182516,"ip_address":"","ucode":"DE7EF246D3DCE8","user_header":"https://static001.geekbang.org/account/avatar/00/12/0b/34/f41d73a4.jpg","comment_is_top":false,"comment_ctime":1546583384,"is_pvip":false,"replies":[{"id":21541,"content":"对，课程中这个图是简化表示，netflix术语edge service + middle layer service统称微服务msx","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1547453959,"ip_address":"","comment_id":56934,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100003901,"comment_content":"GW1和GW1之间，  按照netflik的架构图，好像少了  Edge Service这个聚合层次哦；","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435319,"discussion_content":"对，课程中这个图是简化表示，netflix术语edge service + middle layer service统称微服务msx","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547453959,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56723,"user_name":"lorancechen","can_delete":false,"product_type":"c3","uid":1114303,"ip_address":"","ucode":"2A16CFA4726AE7","user_header":"https://static001.geekbang.org/account/avatar/00/11/00/bf/a44cde46.jpg","comment_is_top":false,"comment_ctime":1546528668,"is_pvip":false,"replies":[{"id":21748,"content":"最前面的LB如果有多个，如需要做负载均衡的话，可以采用DNS round robin轮转。一个LB通常也做成Master&#47;Standby模式高可用。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1547617874,"ip_address":"","comment_id":56723,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100003901,"comment_content":"请问LB自身如何做负载均衡呢？","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435196,"discussion_content":"最前面的LB如果有多个，如需要做负载均衡的话，可以采用DNS round robin轮转。一个LB通常也做成Master/Standby模式高可用。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547617874,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":36575,"user_name":"func","can_delete":false,"product_type":"c3","uid":1254534,"ip_address":"","ucode":"481018617F42D8","user_header":"https://static001.geekbang.org/account/avatar/00/13/24/86/6069f169.jpg","comment_is_top":false,"comment_ctime":1541155942,"is_pvip":false,"replies":[{"id":12991,"content":"网关可以支持负载均衡，比如zuul启用ribbon配合eureka，就在zuul网关上就具有负载均衡能力","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1541160372,"ip_address":"","comment_id":36575,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100003901,"comment_content":"杨老师，网关有没有负载均衡的作用？","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427918,"discussion_content":"网关可以支持负载均衡，比如zuul启用ribbon配合eureka，就在zuul网关上就具有负载均衡能力","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541160372,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":218923,"user_name":"zhou","can_delete":false,"product_type":"c3","uid":1087243,"ip_address":"","ucode":"E1CE8575B3F106","user_header":"https://static001.geekbang.org/account/avatar/00/10/97/0b/a943bcb3.jpg","comment_is_top":false,"comment_ctime":1589898750,"is_pvip":false,"replies":[{"id":81347,"content":"这个具体要问阿里云的开发者才能知道细节。\n\n我所知道的，业界有些计费系统是通过网关集中做billing的，比方说一些可以通过统计API调用进行计费的云服务。还有一些是通过先记录资源使用日志或者事件，再通过后台聚合这些日志，计算出费用。\n\n","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1590244094,"ip_address":"","comment_id":218923,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100003901,"comment_content":"杨老师，阿里云的后台管理首页，各个服务的使用情况以及消费的金额，会是通过网关做的吗？还是说通过埋点做的","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495627,"discussion_content":"这个具体要问阿里云的开发者才能知道细节。\n\n我所知道的，业界有些计费系统是通过网关集中做billing的，比方说一些可以通过统计API调用进行计费的云服务。还有一些是通过先记录资源使用日志或者事件，再通过后台聚合这些日志，计算出费用。\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590244094,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":2687,"user_name":"杨波","can_delete":false,"product_type":"c3","uid":1030344,"ip_address":"","ucode":"FA3418BB703BCA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","comment_is_top":false,"comment_ctime":1518355036,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100003901,"comment_content":"聚合服务逻辑尽量别放网关上，关注分离(separation of concerns)是一种重要微服务架构理念，网关只关注路由，安全，限流等跨横切面逻辑，聚合服务逻辑单独一层","like_count":27},{"had_liked":false,"id":2466,"user_name":"algery","can_delete":false,"product_type":"c3","uid":1042619,"ip_address":"","ucode":"C2EBEE61887DF6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e8/bb/1bfe92c9.jpg","comment_is_top":false,"comment_ctime":1517328437,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100003901,"comment_content":"我们就是把网关和前面说的聚合服务放在了一起。但是看完感觉不应该这么来，有些聚合服务可以在多个网关使用。还在摸索重构中。。。路漫漫","like_count":3},{"had_liked":false,"id":39304,"user_name":"张闯","can_delete":false,"product_type":"c3","uid":1090513,"ip_address":"","ucode":"D5AD46A8DD6FB7","user_header":"https://static001.geekbang.org/account/avatar/00/10/a3/d1/a30a4d06.jpg","comment_is_top":false,"comment_ctime":1542245221,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100003901,"comment_content":"网关内的逻辑与边界服务内的逻辑有什么不同？\n感觉如果已经存在边界服务，网关内就不要再有业务逻辑。","like_count":0}]}