{"id":725815,"title":"12ï½œæ™ºèƒ½æŒ‡é’ˆï¼šä»æ‰€æœ‰æƒçœ‹æ™ºèƒ½æŒ‡é’ˆ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯Mikeã€‚ä»ä»Šå¤©å¼€å§‹ï¼Œæˆ‘ä»¬è¿›å…¥Rustè¿›é˜¶ç¯‡ã€‚</p><p>ç›¸å¯¹äºåŸºç¡€ç¯‡ï¼Œè¿›é˜¶ç¯‡æ›´åƒå¤–åŠŸæ‹›å¼ï¼Œä¸»è¦æ˜¯æŒæ¡ä¸€äº›å®ç”¨çš„åŸºç¡€è®¾æ–½ï¼Œæé«˜ç¼–ç¨‹æ•ˆç‡ã€‚è¿™èŠ‚è¯¾æˆ‘ä»¬å°±åœ¨æ‰€æœ‰æƒè§†è§’ä¸‹æ¥å­¦ä¹ Rustä¸­çš„æ™ºèƒ½æŒ‡é’ˆã€‚</p><h2>æ™ºèƒ½æŒ‡é’ˆ</h2><p>å­¦ä¹ æ™ºèƒ½æŒ‡é’ˆä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹æŒ‡é’ˆæ˜¯ä»€ä¹ˆã€‚</p><h3>æŒ‡é’ˆå’ŒæŒ‡é’ˆçš„ç±»å‹</h3><p>å¦‚æœä¸€ä¸ªå˜é‡ï¼Œé‡Œé¢å­˜çš„æ˜¯å¦ä¸€ä¸ªå˜é‡åœ¨å†…å­˜é‡Œçš„åœ°å€å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡å°±è¢«å«åš<strong>æŒ‡é’ˆ</strong>ã€‚è€Œæˆ‘ä»¬å‰é¢è®²åˆ°çš„å¼•ç”¨ï¼ˆç”¨&amp;å·è¡¨ç¤ºï¼‰å°±æ˜¯ä¸€ç§æŒ‡é’ˆã€‚</p><p><strong>å¼•ç”¨æ˜¯å¿…å®šæœ‰æ•ˆçš„æŒ‡é’ˆ</strong>ï¼Œå®ƒä¸€å®šæŒ‡å‘ä¸€ä¸ªç›®å‰æœ‰æ•ˆï¼ˆæ¯”å¦‚æ²¡æœ‰è¢«é‡Šæ”¾æ‰ï¼‰çš„ç±»å‹å®ä¾‹ã€‚è€ŒæŒ‡é’ˆä¸ä¸€å®šæ˜¯å¼•ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨Rustä¸­ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–ç±»å‹çš„æŒ‡é’ˆå­˜åœ¨ï¼Œæˆ‘ä»¬è¿™èŠ‚è¯¾å°±æ¥å­¦ä¹ å…¶ä¸­ä¸€äº›ã€‚</p><p>æˆ‘ä»¬è¿™é‡Œè¦å†æ¬¡æ˜æ™°ä¸€ä¸‹<strong>å¼•ç”¨çš„ç±»å‹</strong>ã€‚å¼•ç”¨åˆ†ä¸ºä¸åŒçš„ç±»å‹ï¼Œå•ç‹¬çš„&amp;ç¬¦å·æœ¬èº«æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œä½†æ˜¯å®ƒå’Œå…¶ä»–ç±»å‹ç»„åˆèµ·æ¥å°±èƒ½å½¢æˆå„ç§å„æ ·çš„å¼•ç”¨ç±»å‹ã€‚æ¯”å¦‚ï¼š</p><ul>\n<li>&amp;str æ˜¯å­—ç¬¦ä¸²åˆ‡ç‰‡å¼•ç”¨ç±»å‹ã€‚</li>\n<li>&amp;String æ˜¯æ‰€æœ‰æƒå­—ç¬¦ä¸²çš„å¼•ç”¨ç±»å‹ã€‚</li>\n<li>&amp;u32 æ˜¯u32çš„å¼•ç”¨ç±»å‹ã€‚</li>\n</ul><p><span class=\"reference\">æ³¨ï¼š&amp;strã€&amp;Stringã€&amp;u32éƒ½æ˜¯ä¸€ä¸ªæ•´ä½“ã€‚</span></p><p>è¿™ä¸‰ç§éƒ½æ˜¯å¼•ç”¨ç±»å‹ï¼Œä½œä¸ºå¼•ç”¨ç±»å‹ï¼Œå®ƒä»¬ä¹‹é—´æ˜¯ä¸åŒçš„ã€‚ä½†æ˜¯åŒä¸€ç§å¼•ç”¨ç±»å‹çš„å®ä¾‹ï¼Œæ¯”å¦‚ &amp;10u32å’Œ&amp;20u32ï¼Œå®ƒä»¬çš„ç±»å‹æ˜¯ç›¸åŒçš„ã€‚</p><p>é‚£ä¹ˆï¼ŒæŒ‡é’ˆå…¶å®ä¹Ÿç±»ä¼¼ï¼ŒæŒ‡å‘ä¸åŒç±»å‹å®ä¾‹çš„æŒ‡é’ˆï¼Œå®ƒçš„ç±»å‹ä¹Ÿæ˜¯æœ‰åŒºåˆ«çš„ï¼Œè¿™å«åš<strong>æŒ‡é’ˆçš„ç±»å‹</strong>ã€‚</p><!-- [[[read_end]]] --><h3>æ™ºèƒ½æŒ‡é’ˆ</h3><p>Rustä¸­æŒ‡é’ˆçš„æ¦‚å¿µéå¸¸çµæ´»ï¼Œæ¯”å¦‚ï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªç»“æ„ä½“ç±»å‹ï¼Œåªè¦å…¶ä¸­çš„ä¸€ä¸ªå­—æ®µå­˜å‚¨å…¶ä»–ç±»å‹å®ä¾‹çš„åœ°å€ï¼Œç„¶åå¯¹è¿™ä¸ªç»“æ„ä½“å®ç°ä¸€äº›Rustæ ‡å‡†åº“é‡Œæä¾›çš„traitï¼Œå°±å¯ä»¥æŠŠå®ƒå˜æˆæŒ‡é’ˆç±»å‹ã€‚è¿™ç§æŒ‡é’ˆå¯ä»¥åœ¨ä¼ ç»ŸæŒ‡é’ˆçš„åŸºç¡€ä¸Šæ·»åŠ ä¸€äº›é¢å¤–ä¿¡æ¯ï¼Œæ¯”å¦‚æ”¾åœ¨é¢å¤–çš„ä¸€äº›å­—æ®µä¸­ï¼›ä¹Ÿå¯ä»¥åšä¸€äº›é¢å¤–æ“ä½œï¼Œæ¯”å¦‚ç®¡ç†å¼•ç”¨è®¡æ•°ï¼Œèµ„æºè‡ªåŠ¨å›æ”¶ç­‰ã€‚ä»è€Œæ˜¾å¾—æ›´åŠ æ™ºèƒ½ï¼Œæ‰€ä»¥è¢«å«åš<strong>æ™ºèƒ½æŒ‡é’ˆ</strong>ã€‚</p><p>å…¶å®ï¼Œæˆ‘ä»¬å‰é¢ç¢°åˆ°çš„ String å’Œ <code>Vec&lt;T&gt;</code> å°±æ˜¯ä¸€ç§æ™ºèƒ½æŒ‡é’ˆã€‚æˆ‘ä»¬æ¥çœ‹æ ‡å‡†åº“ä»£ç ä¸­ <a href=\"https://doc.rust-lang.org/src/alloc/string.rs.html#365\">String</a>  çš„å®šä¹‰å’Œ <a href=\"https://doc.rust-lang.org/src/alloc/vec/mod.rs.html#396\"><code>Vec&lt;T&gt;</code></a> çš„å®šä¹‰ã€‚</p><pre><code class=\"language-plain\">pub struct String {\n    vec: Vec&lt;u8&gt;,\n}\n</code></pre><pre><code class=\"language-plain\">pub struct Vec&lt;T, #[unstable(feature = \"allocator_api\", issue = \"32838\")] A: Allocator = Global&gt; {\n    buf: RawVec&lt;T, A&gt;,\n    len: usize,\n}\n</code></pre><p>é€šè¿‡ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒStringå’Œ <code>Vec&lt;T&gt;</code> å®é™…éƒ½å®šä¹‰ä¸ºç»“æ„ä½“ã€‚</p><p><span class=\"reference\">æ³¨ï¼šRustä¸­æ™ºèƒ½æŒ‡é’ˆçš„æ¦‚å¿µä¹Ÿç›´æ¥æ¥è‡ªäºC++ã€‚C++é‡Œé¢æœ‰</span><a href=\"https://en.cppreference.com/w/cpp/memory/unique_ptr\">unique_ptr</a><span class=\"reference\">ã€</span><a href=\"https://en.cppreference.com/w/cpp/memory/shared_ptr\">shared_ptr</a><span class=\"reference\">ã€‚</span></p><p>æ™ºèƒ½æŒ‡é’ˆå¯ä»¥è®©ä»£ç çš„å¼€å‘ç›¸å¯¹æ¥è¯´å®¹æ˜“ä¸€äº›ã€‚ç»è¿‡å‰é¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“RuståŸºäºæ‰€æœ‰æƒå‡ºå‘ï¼Œå®šä¹‰äº†ä¸€å¥—å®Œæ•´çš„æ‰€æœ‰æƒå’Œå€Ÿç”¨è§„åˆ™ã€‚å¾ˆå¤šæˆ‘ä»¬ä¹ ä»¥ä¸ºå¸¸çš„ä»£ç å†™æ³•ï¼Œåœ¨Rustä¸­å˜æˆäº†â€œè¿æ³•â€ï¼Œè¿™å¯¼è‡´å¾ˆå¤šäººè§‰å¾—å­¦ä¹ Rustçš„é—¨æ§›å¾ˆé«˜ã€‚è€Œæ™ºèƒ½æŒ‡é’ˆå¯ä»¥åœ¨æŸäº›æ–¹é¢é™ä½è¿™ç§é—¨æ§›ã€‚</p><p>å®ƒå¦‚ä½•èƒ½åšåˆ°å‘¢ï¼Ÿæˆ‘ä»¬ç¨åæ­ç§˜ã€‚</p><p>å‰é¢æˆ‘ä»¬çœ‹åˆ°è¿‡è¿™ç§ä»£ç ï¼š</p><pre><code class=\"language-plain\">fn foo() -&gt; u32 {\n&nbsp; &nbsp; let i = 100u32;\n&nbsp; &nbsp; i\n}\nfn main() {\n&nbsp; &nbsp; let _i = foo();\n}\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œ<code>foo()</code> å‡½æ•°å°†iè¿”å›ç”¨çš„ä¸æ˜¯moveè¡Œä¸ºï¼Œè€Œæ˜¯copyè¡Œä¸ºï¼Œå°†100u32è¿™ä¸ªå€¼å¤åˆ¶äº†ä¸€ä»½ï¼Œè¿”å›ç»™å¤–é¢çš„_iã€‚<code>foo()</code> å‡½æ•°è°ƒç”¨ç»“æŸåï¼Œ<code>foo()</code> é‡Œçš„å±€éƒ¨å˜é‡iè¢«é”€æ¯ã€‚</p><p>æˆ‘ä»¬å†å›å¿†ä¸€ä¸‹å¦ä¸€æ®µä»£ç ã€‚</p><pre><code class=\"language-plain\">fn foo() -&gt; String {\n&nbsp; &nbsp; let s = \"abc\".to_string();\n&nbsp; &nbsp; s\n}\nfn main() {\n&nbsp; &nbsp; let _s = foo();\n}\n</code></pre><p>ä¸Šè¿°ä»£ç å¯ä»¥åœ¨å‡½æ•° <code>foo()</code> é‡Œç”Ÿæˆä¸€ä¸ªå­—ç¬¦ä¸²å®ä¾‹ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å®ä¾‹èµ„æºåœ¨å †å†…å­˜ä¸­åˆ†é…ï¼Œsæ˜¯fooå‡½æ•°é‡Œçš„å±€éƒ¨å˜é‡ï¼Œæ‹¥æœ‰å­—ç¬¦ä¸²èµ„æºçš„æ‰€æœ‰æƒã€‚åœ¨ä»£ç çš„æœ€åä¸€è¡Œï¼ŒsæŠŠæ‰€æœ‰æƒè¿”å›ç»™å¤–éƒ¨è°ƒç”¨è€…å¹¶ä¼ é€’ç»™_sã€‚<code>foo()</code> è°ƒç”¨å®Œæˆåï¼Œæ ˆä¸Šçš„å±€éƒ¨å˜é‡sè¢«é”€æ¯ã€‚</p><p>è¿™ç§å†™æ³•å¯è¡Œæ˜¯å› ä¸ºè¿”å›äº†èµ„æºçš„æ‰€æœ‰æƒã€‚å¦‚æœæˆ‘ä»¬æŠŠä»£ç é‡Œçš„Stringæ¢æˆ&amp;Stringï¼ŒæŠŠsæ¢æˆ&amp;så°±ä¸è¡Œäº†ã€‚</p><pre><code class=\"language-plain\">fn foo() -&gt; &amp;String {\n&nbsp; &nbsp; let s = \"abc\".to_string();\n&nbsp; &nbsp; &amp;s\n}\nfn main() {\n&nbsp; &nbsp; let _s = foo();\n}\n</code></pre><p>ä½ å¯èƒ½ä¼šé—®ï¼Œæ—¢ç„¶Stringèµ„æºæœ¬èº«æ˜¯åœ¨å †ä¸­ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½æ‹¿åˆ°è¿™ä¸ªèµ„æºçš„å¼•ç”¨è€Œè¿”å›å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆä¸è¡Œã€‚åœ¨ <code>foo()</code> å‡½æ•°é‡Œï¼Œå…¶å®æˆ‘ä»¬è¿”å›çš„å¹¶ä¸æ˜¯é‚£ä¸ªå †é‡Œå­—ç¬¦ä¸²èµ„æºçš„å¼•ç”¨ï¼Œè€Œæ˜¯æ ˆä¸Šå±€éƒ¨å˜é‡sçš„å¼•ç”¨ã€‚å †é‡Œçš„å­—ç¬¦ä¸²èµ„æºç”±æ ˆä¸Šçš„å˜é‡sç®¡ç†ï¼Œè€Œsåœ¨ <code>foo()</code> å‡½æ•°è°ƒç”¨å®Œæˆåï¼Œå°±è¢«é”€æ¯äº†ï¼Œå †é‡Œçš„å­—ç¬¦ä¸²èµ„æºä¹Ÿä¸€å¹¶è¢«å›æ”¶äº†ï¼Œæ‰€ä»¥åˆšåˆšé‚£æ®µä»£ç å½“ç„¶è¡Œä¸é€šäº†ã€‚</p><p>åŒæ ·çš„ï¼Œä¸‹é¢è¿™æ®µä»£ç ä¹Ÿæ˜¯ä¸å…è®¸çš„ã€‚</p><pre><code class=\"language-plain\">fn foo() -&gt; &amp;u32 {\n&nbsp; &nbsp; let i = 100u32;\n&nbsp; &nbsp; &amp;i\n}\nfn main() {\n&nbsp; &nbsp; let _i = foo();\n}\n</code></pre><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬æœ‰ä»€ä¹ˆåŠæ³•èƒ½è®©è¿™ç§æ„å›¾å˜å¾—å¯è¡Œå‘¢ï¼Ÿå…¶å®æ˜¯æœ‰çš„ï¼Œæ¯”å¦‚ä½¿ç”¨ <code>Box&lt;T&gt;</code> æ™ºèƒ½æŒ‡é’ˆã€‚</p><h2><code>Box&lt;T&gt;</code></h2><p><code>Box&lt;T&gt;</code> æ˜¯ä¸€ä¸ªç±»å‹æ•´ä½“ï¼Œä½œä¸ºæ™ºèƒ½æŒ‡é’ˆ <code>Box&lt;T&gt;</code> å¯ä»¥æŠŠèµ„æºå¼ºè¡Œåˆ›å»ºåœ¨å †ä¸Šï¼Œå¹¶è·å¾—èµ„æºçš„æ‰€æœ‰æƒï¼Œè®©èµ„æºçš„ç”Ÿå‘½æœŸå¾—ä»¥è¢«ç¨‹åºå‘˜ç²¾ç¡®åœ°æ§åˆ¶ã€‚</p><p><span class=\"reference\">æ³¨ï¼šå †ä¸Šçš„èµ„æºï¼Œé»˜è®¤ä¸æ•´ä¸ªç¨‹åºè¿›ç¨‹çš„å­˜åœ¨æ—¶é—´ä¸€æ ·ä¹…ã€‚</span></p><p>æˆ‘ä»¬æ¥çœ‹ä½¿ç”¨ <code>Box&lt;T&gt;</code> å¦‚ä½•å¤„ç†å‰é¢é‚£ä¸ªç¤ºä¾‹ã€‚</p><pre><code class=\"language-plain\">fn foo() -&gt; Box&lt;u32&gt; {\n&nbsp; &nbsp; let i = 100u32;\n&nbsp; &nbsp; Box::new(i)\n}\nfn main() {\n&nbsp; &nbsp; let _i = foo();\n}\n</code></pre><p>é€šè¿‡Boxï¼Œæˆ‘ä»¬æŠŠæ ˆä¸Š i çš„å€¼ï¼Œå¼ºè¡Œcopyäº†ä¸€ä»½å¹¶æ”¾åœ¨å †ä¸ŠæŸä¸ªåœ°å€ï¼Œç„¶åBoxæŒ‡é’ˆæŒ‡å‘è¿™ä¸ªåœ°å€ã€‚</p><p>è¿”å›ä¸€ä¸ªæ•´æ•° i çš„æŒ‡é’ˆç¡®å®æ²¡å¤šå¤§ç”¨ï¼Œå¦‚æœæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç»“æ„ä½“ï¼Œå¯ä»¥é‡‡ç”¨ç±»ä¼¼çš„åŠæ³•ä»å‡½æ•°ä¸­è¿”å›ç»“æ„ä½“çš„BoxæŒ‡é’ˆã€‚</p><pre><code class=\"language-plain\">struct Point {\n&nbsp; &nbsp; x: u32,\n&nbsp; &nbsp; y: u32\n}\n\nfn foo() -&gt; Box&lt;Point&gt; {\n&nbsp; &nbsp; let p = Point {x: 10, y: 20};  // è¿™ä¸ªç»“æ„ä½“çš„å®ä¾‹åˆ›å»ºåœ¨æ ˆä¸Š\n&nbsp; &nbsp; Box::new(p)\n}\nfn main() {\n&nbsp; &nbsp; let _p = foo();\n}\n</code></pre><p>è¿™å°±å¾ˆæœ‰ç”¨äº†ã€‚</p><p>æˆ‘ä»¬çœ‹ç¤ºä¾‹çš„ç¬¬7è¡Œï¼ŒPoint çš„å®ä¾‹ p å®é™…æ˜¯åˆ›å»ºåœ¨æ ˆä¸Šçš„ã€‚é€šè¿‡ <code>Box::new(p)</code>ï¼ŒæŠŠpå®ä¾‹å¼ºè¡ŒæŒ‰ä½å¤åˆ¶äº†ä¸€ä»½ï¼Œå¹¶ä¸”æ”¾åˆ°äº†å †ä¸Šï¼Œæˆ‘ä»¬è®°ä¸º pâ€™ã€‚ç„¶å <code>foo()</code> å‡½æ•°è¿”å›ï¼ŒæŠŠBoxæŒ‡é’ˆå®ä¾‹moveç»™äº†_pã€‚ä¹‹åï¼Œ_pæ‹¥æœ‰äº†å¯¹ pâ€™ çš„æ‰€æœ‰æƒã€‚</p><h3><code>Box&lt;T&gt;</code> ä¸­çš„æ‰€æœ‰æƒåˆ†æ</h3><p>æˆ‘ä»¬ç»§ç»­æ·±å…¥ï¼Œå›é¡¾ä¸€ä¸‹ä¸Šé¢ç¤ºä¾‹é‡Œè®²åˆ°çš„ï¼Œç¼–è¯‘æœŸé—´å·²çŸ¥å°ºå¯¸çš„ç±»å‹å®ä¾‹ä¼šé»˜è®¤åˆ›å»ºåœ¨æ ˆä¸Šã€‚Pointæœ‰ä¸¤ä¸ªå­—æ®µï¼šxã€yï¼Œå®ƒä»¬çš„å°ºå¯¸æ˜¯å›ºå®šçš„ï¼Œéƒ½æ˜¯4ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥Pointçš„å°ºå¯¸å°±æ˜¯8ä¸ªå­—èŠ‚ï¼Œå®ƒçš„å°ºå¯¸ä¹Ÿæ˜¯å›ºå®šçš„ã€‚æ‰€ä»¥å®ƒçš„å®ä¾‹ä¼šè¢«åˆ›å»ºåœ¨æ ˆä¸Šã€‚ç¬¬7è¡Œçš„ p æ‹¥æœ‰è¿™ä¸ªPointå®ä¾‹çš„æ‰€æœ‰æƒã€‚æ³¨æ„Pointå¹¶æ²¡æœ‰é»˜è®¤å®ç°Copyï¼Œè™½ç„¶å®ƒçš„å°ºå¯¸æ˜¯å›ºå®šçš„ã€‚</p><p>åœ¨åˆ›å»º <code>Box&lt;Point&gt;</code> å®ä¾‹çš„æ—¶å€™ä¼šå‘ç”Ÿæ‰€æœ‰æƒè½¬ç§»ï¼šèµ„æºä»æ ˆä¸Šmoveåˆ°äº†å †ä¸Šï¼ŒåŸæ¥æ ˆä¸Šçš„é‚£ç‰‡èµ„æºè¢«ç½®ä¸ºæ— æ•ˆçŠ¶æ€ï¼Œå› æ­¤ä¸‹é¢çš„ä»£ç ç¼–è¯‘ä¸ä¼šé€šè¿‡ã€‚</p><pre><code class=\"language-plain\">struct Point {\n&nbsp; &nbsp; x: u32,\n&nbsp; &nbsp; y: u32\n}\n\nfn foo() -&gt; Box&lt;Point&gt; {\n&nbsp; &nbsp; let p = Point {x: 10, y: 20};&nbsp; &nbsp; \n&nbsp; &nbsp; let boxed = Box::new(p);  // åˆ›å»ºBoxå®ä¾‹\n    let q = p;                // è¿™ä¸€å¥ç”¨æ¥æ£€æŸ¥pæœ‰æ²¡æœ‰è¢«moveèµ°\n    boxed\n}\nfn main() {\n&nbsp; &nbsp; let _p = foo();\n}\n</code></pre><p>ç¼–è¯‘æç¤ºï¼š</p><pre><code class=\"language-plain\">error[E0382]: use of moved value: `p`\n&nbsp;--&gt; src/main.rs:9:13\n&nbsp; |\n7 |&nbsp; &nbsp; &nbsp;let p = Point {x: 10, y: 20};&nbsp; &nbsp;&nbsp;\n&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- move occurs because `p` has type `Point`, which does not implement the `Copy` trait\n8 |&nbsp; &nbsp; &nbsp;let boxed = Box::new(p);&nbsp; &nbsp; &nbsp;// åˆ›å»ºBoxå®ä¾‹\n&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - value moved here\n9 |&nbsp; &nbsp; &nbsp;let q = p;&nbsp; &nbsp; &nbsp; &nbsp; // è¿™ä¸€å¥ç”¨æ¥æ£€æŸ¥pæœ‰æ²¡æœ‰è¢«moveèµ°\n&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;^ value used here after move\n</code></pre><p>ä¹‹æ‰€ä»¥ä¼šå‘ç”Ÿæ‰€æœ‰æƒè¿™æ ·çš„è½¬ç§»ï¼Œæ˜¯å› ä¸º Point ç±»å‹æœ¬èº«å°±æ˜¯ move è¯­ä¹‰çš„ã€‚ä½œä¸ºå¯¹ç…§ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç¤ºä¾‹ã€‚</p><pre><code class=\"language-plain\">fn foo() -&gt; Box&lt;u8&gt; {\n&nbsp; &nbsp; let i = 5;\n&nbsp; &nbsp; let boxed = Box::new(i);&nbsp; // åˆ›å»ºBoxå®ä¾‹\n&nbsp; &nbsp; let q = i;&nbsp; &nbsp; &nbsp; &nbsp;         // è¿™ä¸€å¥ç”¨æ¥æ£€æŸ¥iæœ‰æ²¡æœ‰è¢«moveèµ°\n&nbsp; &nbsp; boxed\n}\n\nfn main() {\n&nbsp; &nbsp; let _i = foo();\n}\n</code></pre><p>è¿™ä¸ªç¤ºä¾‹å°±å¯ä»¥ç¼–è¯‘é€šè¿‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ‰§è¡Œ <code>Box::new()</code> åˆ›å»º Box å®ä¾‹æ—¶ï¼Œå…·æœ‰copyè¯­ä¹‰çš„æ•´æ•°ç±»å‹å’Œå…·æœ‰moveè¯­ä¹‰çš„Pointç±»å‹è¡Œä¸ºä¸ä¸€æ ·ã€‚æ•´æ•°ä¼šcopyä¸€ä»½è‡ªå·±ï¼ŒPointå®ä¾‹ä¼šæŠŠè‡ªå·±moveåˆ°Boxé‡Œé¢å»ã€‚</p><p>ä¸€æ—¦åˆ›å»ºå¥½Boxå®ä¾‹åï¼Œè¿™ä¸ªå®ä¾‹å°±å…·æœ‰äº†å¯¹é‡Œé¢èµ„æºçš„æ‰€æœ‰æƒäº†ï¼Œå®ƒæ˜¯moveè¯­ä¹‰çš„ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹ç¤ºä¾‹ã€‚</p><pre><code class=\"language-plain\">fn foo() -&gt; Box&lt;u8&gt; {\n&nbsp; &nbsp; let i = 5;\n&nbsp; &nbsp; let boxed = Box::new(i);&nbsp; &nbsp; // åˆ›å»ºBoxå®ä¾‹\n&nbsp; &nbsp; let q = i;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // è¿™ä¸€å¥ç”¨æ¥æ£€æŸ¥iæœ‰æ²¡æœ‰è¢«moveèµ°\n&nbsp; &nbsp; let boxed2 = boxed;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// è¿™ä¸€å¥æ£€æŸ¥boxedå®ä¾‹æ˜¯ä¸æ˜¯moveè¯­ä¹‰\n&nbsp; &nbsp; boxed\n}\n\nfn main() {\n&nbsp; &nbsp; let _i = foo();\n}\n</code></pre><p>ä¸èƒ½ç¼–è¯‘é€šè¿‡ï¼Œæç¤ºï¼š</p><pre><code class=\"language-plain\">error[E0382]: use of moved value: `boxed`\n&nbsp;--&gt; src/main.rs:6:5\n&nbsp; |\n3 |&nbsp; &nbsp; &nbsp;let boxed = Box::new(i);&nbsp; &nbsp; // åˆ›å»ºBoxå®ä¾‹\n&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;----- move occurs because `boxed` has type `Box&lt;u8&gt;`, which does not implement the `Copy` trait\n4 |&nbsp; &nbsp; &nbsp;let q = i;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // è¿™ä¸€å¥ç”¨æ¥æ£€æŸ¥iæœ‰æ²¡æœ‰è¢«moveèµ°\n5 |&nbsp; &nbsp; &nbsp;let boxed2 = boxed;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// è¿™ä¸€å¥æ£€æŸ¥boxedå®ä¾‹æ˜¯ä¸æ˜¯moveè¯­ä¹‰\n&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ----- value moved here\n6 |&nbsp; &nbsp; &nbsp;boxed\n&nbsp; |&nbsp; &nbsp; &nbsp;^^^^^ value used here after move\n</code></pre><p>è¿™ä¸ªç¤ºä¾‹å°±éªŒè¯äº†æˆ‘ä»¬åˆšæ‰çš„è¯´æ³•ã€‚</p><h3><code>Box&lt;T&gt;</code> çš„è§£å¼•ç”¨</h3><p>å‰é¢æˆ‘ä»¬è®²è¿‡ï¼Œåˆ›å»ºä¸€ä¸ªBoxå®ä¾‹æŠŠæ ˆä¸Šçš„å†…å®¹åŒ…èµ·æ¥ï¼Œå¯ä»¥æŠŠæ ˆä¸Šçš„å€¼ç§»åŠ¨åˆ°å †ä¸Šï¼Œæ¯”å¦‚ï¼š</p><pre><code class=\"language-plain\">let val: u8 = 5;\nlet boxed: Box&lt;u8&gt; = Box::new(val); // è¿™é‡Œ boxed é‡Œé¢é‚£ä¸ªu8å°±æ˜¯å †ä¸Šçš„å€¼ \n</code></pre><p>è¿˜å¯ä»¥åœ¨Boxå®ä¾‹ä¸Šä½¿ç”¨<strong>è§£å¼•ç”¨ç¬¦å· </strong>*ï¼ŒæŠŠé‡Œé¢çš„å †ä¸Šçš„å€¼å†æ¬¡ç§»åŠ¨å›æ ˆä¸Šï¼Œæ¯”å¦‚ï¼š</p><pre><code class=\"language-plain\">let boxed: Box&lt;u8&gt; = Box::new(5);\nlet val: u8 = *boxed;    // è¿™é‡Œè¿™ä¸ªvalæ•´æ•°å®ä¾‹å°±æ˜¯åœ¨æ ˆä¸Šçš„å€¼\n</code></pre><p>è§£å¼•ç”¨æ˜¯ <code>Box::new()</code> çš„<strong>é€†æ“ä½œ</strong>ï¼Œå¯ä»¥çœ‹åˆ°æ•´ä¸ªè¿‡ç¨‹æ˜¯ç›¸åçš„ã€‚</p><p>å¯¹äºå…·æœ‰copyè¯­ä¹‰çš„u8ç±»å‹æ¥è¯´ï¼Œè§£å¼•ç”¨å›æ¥åï¼Œboxedè¿˜èƒ½ä½¿ç”¨ï¼Œæˆ‘ä»¬çœ‹ä¸‹ç¤ºä¾‹ã€‚</p><pre><code class=\"language-plain\">fn main() {\n&nbsp; &nbsp; let boxed: Box&lt;u8&gt; = Box::new(5);\n&nbsp; &nbsp; let val: u8 = *boxed;\n&nbsp; &nbsp;&nbsp;\n&nbsp; &nbsp; println!(\"{:?}\", val);\n&nbsp; &nbsp; println!(\"{:?}\", boxed);  // ç”¨äºu8ç±»å‹ï¼Œè§£å¼•ç”¨åï¼Œboxedå®ä¾‹è¿˜èƒ½ç”¨\n}\n// è¾“å‡º\n5\n5\n</code></pre><p>è€Œå¯¹äºå…·æœ‰moveè¯­ä¹‰çš„ç±»å‹æ¥è¯´ï¼Œæƒ…å†µå°±ä¸ä¸€æ ·äº†ï¼Œä¼šå‘ç”Ÿæ‰€æœ‰æƒçš„è½¬ç§»ã€‚æ¯”å¦‚ï¼š</p><pre><code class=\"language-plain\">#[derive(Debug)]\nstruct Point {\n&nbsp; &nbsp; x: u32,\n&nbsp; &nbsp; y: u32\n}\n\nfn main() {\n&nbsp; &nbsp; let p = Point {x: 10, y: 20};\n&nbsp; &nbsp; let boxed: Box&lt;Point&gt; = Box::new(p);\n&nbsp; &nbsp; let val: Point = *boxed;  // è¿™é‡Œåšäº†è§£å¼•ç”¨ï¼ŒPointå®ä¾‹å›åˆ°æ ˆä¸Š\n&nbsp; &nbsp;&nbsp;\n&nbsp; &nbsp; println!(\"{:?}\", val);\n&nbsp; &nbsp; println!(\"{:?}\", boxed);  // è§£å¼•ç”¨åæƒ³æŠŠboxedå†æ‰“å°å‡ºæ¥\n}\n</code></pre><p>ç¼–è¯‘å‡ºé”™ï¼Œæç¤º <code>*boxed</code> å·²ç» moveäº†ã€‚</p><pre><code class=\"language-plain\">error[E0382]: borrow of moved value: `boxed`\n&nbsp; --&gt; src/main.rs:13:22\n&nbsp; &nbsp;|\n10 |&nbsp; &nbsp; &nbsp;let val: Point = *boxed;\n&nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ------ value moved here\n...\n13 |&nbsp; &nbsp; &nbsp;println!(\"{:?}\", boxed);\n&nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^^^^^ value borrowed here after move\n</code></pre><p>å› æ­¤ boxed ä¸èƒ½å†ä½¿ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ <code>Box&lt;T&gt;</code> çš„ T æ˜¯ move è¯­ä¹‰çš„ï¼Œé‚£ä¹ˆå¯¹è¿™ä¸ªBoxå®ä¾‹åšè§£å¼•ç”¨æ“ä½œï¼Œä¼šæŠŠè¿™ä¸ªBoxå®ä¾‹çš„æ‰€æœ‰æƒé‡Šæ”¾ã€‚</p><p>å…³äºè¿™äº›ç»†èŠ‚ï¼Œå…¶å®ä½ ä¸ç”¨å¤ªæ‹…å¿ƒèƒ½ä¸èƒ½ä¸€æ¬¡æ€§æŒæ¡å¥½ï¼Œå› ä¸ºä½ ç”¨é”™çš„æ—¶å€™ï¼ŒRustcå°åŠ©æ‰‹ä¼šè´´å¿ƒåœ°å‡†ç¡®æç¤ºä½ ï¼Œæ‰€ä»¥ä¸è¦æœ‰å¿ƒç†è´Ÿæ‹…ã€‚</p><h3><code>Box&lt;T&gt;</code> å®ç°äº†trait</h3><p><code>Box&lt;T&gt;</code> çš„å¥½å¤„åœ¨äºå®ƒçš„æ˜ç¡®æ€§ï¼Œå®ƒé‡Œé¢çš„èµ„æºä¸€å®šåœ¨å †ä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä¸ç”¨å†å»å…³å¿ƒèµ„æºæ˜¯åœ¨æ ˆä¸Šè¿˜æ˜¯å †ä¸Šè¿™ç§ç»†èŠ‚é—®é¢˜äº†ã€‚ä¸€ç§ç±»å‹ï¼Œè¢« <code>Box&lt;&gt;</code> åŒ…èµ·æ¥çš„è¿‡ç¨‹å°±å«ä½œè¿™ä¸ªç±»å‹çš„<strong>ç›’åŒ–</strong>ï¼ˆboxedï¼‰ã€‚</p><p>Ruståœ¨æ ‡å‡†åº“é‡Œä¸º <code>Box&lt;T&gt;</code> å®ç°äº† <code>Deref</code>ã€<code>Drop</code>ã€<code>AsRef&lt;T&gt;</code> ç­‰traitï¼Œæ‰€ä»¥ <code>Box&lt;T&gt;</code> å¯ä»¥ç›´æ¥è°ƒç”¨Tå®ä¾‹çš„æ–¹æ³•ï¼Œè®¿é—®Tå®ä¾‹çš„å€¼ã€‚</p><pre><code class=\"language-plain\">#[derive(Debug)]\nstruct Point {\n&nbsp; &nbsp; x: u32,\n&nbsp; &nbsp; y: u32,\n}\n\nimpl Point {\n&nbsp; &nbsp; fn play(&amp;self) {\n&nbsp; &nbsp; &nbsp; &nbsp; println!(\"I'am a method of Point.\");\n&nbsp; &nbsp; }\n}\n\nfn main() {\n&nbsp; &nbsp; let boxed: Box&lt;Point&gt; = Box::new(Point{x: 10, y: 20});\n&nbsp; &nbsp; boxed.play();    // ç‚¹æ“ä½œç¬¦è§¦å‘deref\n&nbsp; &nbsp; println!(\"{:?}\", boxed);\n}\n// è¾“å‡º\nI'am a method of Point.\nPoint { x: 10, y: 20 }\n</code></pre><p><code>Box&lt;T&gt;</code> æ‹¥æœ‰å¯¹Tå®ä¾‹çš„æ‰€æœ‰æƒï¼Œæ‰€ä»¥å¯ä»¥å¯¹Tå®ä¾‹è¿›è¡Œå†™æ“ä½œã€‚</p><pre><code class=\"language-plain\">#[derive(Debug)]\nstruct Point {\n&nbsp; &nbsp; x: u32,\n&nbsp; &nbsp; y: u32,\n}\n\nfn main() {\n&nbsp; &nbsp; let mut boxed: Box&lt;Point&gt; = Box::new(Point{x: 10, y: 20});\n&nbsp; &nbsp; *boxed = Point {    // è¿™ä¸€è¡Œï¼Œä½¿ç”¨è§£å¼•ç”¨æ“ä½œæ›´æ–°å€¼ \n&nbsp; &nbsp; &nbsp; &nbsp; x: 100,\n&nbsp; &nbsp; &nbsp; &nbsp; y: 200\n&nbsp; &nbsp; };\n&nbsp; &nbsp; println!(\"{:?}\", boxed);\n}\n// è¾“å‡º\nPoint { x: 100, y: 200 }\n</code></pre><h3><code>Box&lt;T&gt;</code> çš„Clone</h3><p><code>Box&lt;T&gt;</code> èƒ½å¦Cloneï¼Œéœ€è¦çœ‹ T æ˜¯å¦å®ç°äº† Cloneï¼Œå› ä¸ºæˆ‘ä»¬ä¹Ÿéœ€è¦æŠŠ T çš„èµ„æºå…‹éš†ä¸€ä»½ã€‚ä½ å¯ä»¥çœ‹ä¸€ä¸‹æˆ‘ç»™å‡ºçš„ç¤ºä¾‹ã€‚</p><pre><code class=\"language-plain\">#[derive(Debug, Clone)]\nstruct Point {\n&nbsp; &nbsp; x: u32,\n&nbsp; &nbsp; y: u32,\n}\n\nimpl Point {\n&nbsp; &nbsp; fn play(&amp;self) {\n&nbsp; &nbsp; &nbsp; &nbsp; println!(\"I'am a method of Point.\");\n&nbsp; &nbsp; }\n}\n\nfn main() {\n&nbsp; &nbsp; let mut boxed: Box&lt;Point&gt; = Box::new(Point{x: 10, y: 20});\n&nbsp; &nbsp; let mut another_boxed = boxed.clone();   // å…‹éš†\n&nbsp; &nbsp; *another_boxed = Point{x: 100, y: 200};  // ä¿®æ”¹æ–°çš„ä¸€ä»½å€¼\n&nbsp; &nbsp; println!(\"{:?}\", boxed);                 // æ‰“å°åŸæ¥ä¸€ä»½å€¼\n&nbsp; &nbsp; println!(\"{:?}\", another_boxed);         // æ‰“å°æ–°çš„ä¸€ä»½å€¼\n}\n// è¾“å‡º\nPoint { x: 10, y: 20 }\nPoint { x: 100, y: 200 }\n</code></pre><h3><code>Box&lt;T&gt;</code> ä½œä¸ºå‡½æ•°å‚æ•°</h3><p>æˆ‘ä»¬å¯ä»¥æŠŠ <code>Box&lt;T&gt;</code> ä½œä¸ºå‚æ•°ä¼ å…¥å‡½æ•°ï¼Œè¿™ä¸ªæˆ‘ä»¬å‰é¢å·²ç»è§è¿‡äº†ã€‚</p><pre><code class=\"language-plain\">#[derive(Debug)]\nstruct Point {\n&nbsp; &nbsp; x: u32,\n&nbsp; &nbsp; y: u32,\n}\n\nfn foo(p: Box&lt;Point&gt;) {    // è¿™é‡Œå‚æ•°ç±»å‹æ˜¯ Box&lt;Point&gt;\n&nbsp; &nbsp; println!(\"{:?}\", p);\n}\n\nfn main() {\n&nbsp; &nbsp; foo(Box::new(Point {x: 10, y: 20}));\n}\n// è¾“å‡º \nPoint { x: 10, y: 20 }\n</code></pre><h3><code>&amp;Box&lt;T&gt;</code></h3><p><code>Box&lt;T&gt;</code> æœ¬èº«ä½œä¸ºä¸€ç§ç±»å‹ï¼Œå¯¹å®ƒåšå¼•ç”¨æ“ä½œå½“ç„¶æ˜¯å¯ä»¥çš„ã€‚</p><pre><code class=\"language-plain\">#[derive(Debug)]\nstruct Point {\n&nbsp; &nbsp; x: u32,\n&nbsp; &nbsp; y: u32,\n}\n\nimpl Point {\n&nbsp; &nbsp; fn play(&amp;self) {\n&nbsp; &nbsp; &nbsp; &nbsp; println!(\"I'am a method of Point.\");\n&nbsp; &nbsp; }\n}\n\nfn main() {\n&nbsp; &nbsp; let boxed: Box&lt;Point&gt; = Box::new(Point{x: 10, y: 20});\n&nbsp; &nbsp; boxed.play();        // è°ƒç”¨ç±»å‹æ–¹æ³•\n&nbsp; &nbsp; let y = &amp;boxed;      // å–boxedå®ä¾‹çš„å¼•ç”¨\n&nbsp; &nbsp; y.play();            // è°ƒç”¨ç±»å‹æ–¹æ³•\n&nbsp; &nbsp; println!(\"{:?}\", y);\n}\n// è¾“å‡º \nI'am a method of Point.\nI'am a method of Point.\nPoint { x: 10, y: 20 }\n</code></pre><p>åœ¨ç¤ºä¾‹ä¸­ï¼Œboxedæ˜¯ä¸€ä¸ªæ‰€æœ‰æƒå‹å˜é‡ï¼Œyæ˜¯ä¸€ä¸ªå¼•ç”¨å‹å˜é‡ã€‚å®ƒä»¬éƒ½èƒ½è°ƒç”¨åˆ°Pointç±»å‹ä¸Šçš„æ–¹æ³•ã€‚</p><p>å¯¹Boxå®ä¾‹åšå¯å˜å¼•ç”¨ï¼ˆ&amp;mutï¼‰ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹ç¤ºä¾‹ã€‚</p><pre><code class=\"language-plain\">#[derive(Debug)]\nstruct Point {\n&nbsp; &nbsp; x: u32,\n&nbsp; &nbsp; y: u32,\n}\n\nimpl Point {\n&nbsp; &nbsp; fn play(&amp;self) {\n&nbsp; &nbsp; &nbsp; &nbsp; println!(\"I'am a method of Point.\");\n&nbsp; &nbsp; }\n}\n\nfn main() {\n&nbsp; &nbsp; let mut boxed: Box&lt;Point&gt; = Box::new(Point{x: 10, y: 20});\n&nbsp; &nbsp; let y = &amp;mut boxed;     // è¿™é‡Œ&amp;mut Box&lt;Point&gt;\n&nbsp; &nbsp; y.play();               // è°ƒç”¨ç±»å‹æ–¹æ³•\n&nbsp; &nbsp; println!(\"{:?}\", y);    // ä¿®æ”¹å‰çš„å€¼\n&nbsp; &nbsp; **y = Point {x: 100, y: 200};  // æ³¨æ„è¿™é‡Œç”¨äº†äºŒçº§è§£å¼•ç”¨\n&nbsp; &nbsp; println!(\"{:?}\", y);    // ä¿®æ”¹åçš„å€¼\n}\n// è¾“å‡º \nI'am a method of Point.\nPoint { x: 10, y: 20 }\nPoint { x: 100, y: 200 }\n</code></pre><p>è¿™ä¸ªç¤ºä¾‹é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯ç¬¬18è¡Œï¼Œåšäº†ä¸¤æ¬¡è§£å¼•ç”¨ï¼Œç¬¬ä¸€æ¬¡æ˜¯å¯¹&amp;mut åšçš„ï¼Œç¬¬äºŒæ¬¡æ˜¯å¯¹ <code>Box&lt;T&gt;</code> åšçš„ã€‚</p><h3><code>Box&lt;Self&gt;</code></h3><p>å‰é¢æˆ‘ä»¬è®²è¿‡ï¼Œç±»å‹çš„æ–¹æ³•å¯ä»¥ç”¨ selfã€&amp;selfã€&amp;mut self ä¸‰ç§å½¢æ€ä¼ å…¥Selfå‚æ•°ã€‚å…¶ä¸­ç¬¬ä¸€ç§selfå½¢æ€è¿˜æœ‰ä¸€ç§å˜ä½“ <code>Box&lt;Self&gt;</code>ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹ç¤ºä¾‹ã€‚</p><pre><code class=\"language-plain\">#[derive(Debug)]\nstruct Point {\n&nbsp; &nbsp; x: u32,\n&nbsp; &nbsp; y: u32,\n}\n\nimpl Point {\n&nbsp; &nbsp; fn play_ref(&amp;self) {\n&nbsp; &nbsp; &nbsp; &nbsp; println!(\"I'am play_ref of Point.\");\n&nbsp; &nbsp; }\n&nbsp; &nbsp; fn play_mutref(&amp;mut self) {\n&nbsp; &nbsp; &nbsp; &nbsp; println!(\"I'am play_mutref of Point.\");\n&nbsp; &nbsp; }\n&nbsp; &nbsp; fn play_own(self) {\n&nbsp; &nbsp; &nbsp; &nbsp; println!(\"I'am play_own of Point.\");\n&nbsp; &nbsp; }\n&nbsp; &nbsp; fn play_boxown(self: Box&lt;Self&gt;) {    // æ³¨æ„è¿™é‡Œ\n&nbsp; &nbsp; &nbsp; &nbsp; println!(\"I'am play_boxown of Point.\");\n&nbsp; &nbsp; }\n}\n\nfn main() {\n&nbsp; &nbsp; let mut boxed: Box&lt;Point&gt; = Box::new(Point{x: 10, y: 20});\n&nbsp; &nbsp; boxed.play_ref();\n&nbsp; &nbsp; boxed.play_mutref();\n&nbsp; &nbsp; boxed.play_boxown();\n&nbsp; &nbsp; // boxed.play_own();  // play_boxown()å’Œ play_own() åªèƒ½åŒæ—¶æ‰“å¼€ä¸€ä¸ª\n}\n</code></pre><p>æ³¨æ„ç¤ºä¾‹ä¸­ï¼Œ<code>play_boxown()</code> å’Œ <code>play_own()</code> åªèƒ½åŒæ—¶æ‰“å¼€ä¸€ä¸ªï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿä½ æ€è€ƒä¸€ä¸‹ã€‚</p><h3>ç»“æ„ä½“ä¸­çš„Box<t></t></h3><p><code>Box&lt;T&gt;</code> ä½œä¸ºç±»å‹ï¼Œå½“ç„¶æ˜¯å¯ä»¥å‡ºç°åœ¨structé‡Œçš„ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹ç¤ºä¾‹ã€‚</p><pre><code class=\"language-plain\">struct Point {\n&nbsp; &nbsp; x: u32,\n&nbsp; &nbsp; y: u32,\n}\nstruct Triangle {\n&nbsp; &nbsp; one: Box&lt;Point&gt;,    // ä¸‰ä¸ªå­—æ®µç±»å‹éƒ½æ˜¯ Box&lt;Point&gt;\n&nbsp; &nbsp; two: Box&lt;Point&gt;,\n&nbsp; &nbsp; three: Box&lt;Point&gt;,\n}\nfn main() {\n&nbsp; &nbsp; let t = Triangle {\n&nbsp; &nbsp; &nbsp; &nbsp; one: Box::new(Point {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x: 10,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; y: 10,\n&nbsp; &nbsp; &nbsp; &nbsp; }),\n&nbsp; &nbsp; &nbsp; &nbsp; two: Box::new(Point {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x: 20,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; y: 20,\n&nbsp; &nbsp; &nbsp; &nbsp; }),\n&nbsp; &nbsp; &nbsp; &nbsp; three: Box::new(Point {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x: 10,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; y: 20,\n&nbsp; &nbsp; &nbsp; &nbsp; }),\n&nbsp; &nbsp; };\n}\n</code></pre><h3><code>Box&lt;dyn trait&gt;</code></h3><p>å›å¿†<a href=\"https://time.geekbang.org/column/article/724776\">ç¬¬ 10 è®²</a>çš„trait objectï¼Œå®ƒä»£è¡¨ä¸€ç§ç±»å‹ï¼Œè¿™ç§ç±»å‹å¯ä»¥ä»£ç†ä¸€æ‰¹å…¶ä»–çš„ç±»å‹ã€‚ä½†æ˜¯ dyn trait æœ¬èº«çš„å°ºå¯¸åœ¨ç¼–è¯‘æœŸæ˜¯æœªçŸ¥çš„ï¼Œæ‰€ä»¥ dyn trait çš„å‡ºç°æ€»æ˜¯è¦å€ŸåŠ©äºå¼•ç”¨æˆ–æ™ºèƒ½æŒ‡é’ˆã€‚è€Œ <code>Box&lt;dyn trait&gt;</code> æ˜¯æœ€å¸¸è§çš„ï¼Œç”šè‡³æ¯” <code>&dyn trait</code> æ›´å¸¸è§ã€‚åŸå› å°±æ˜¯ <code>Box&lt;dyn Trait&gt;</code> æ‹¥æœ‰æ‰€æœ‰æƒï¼Œè¿™å°±æ˜¯ <code>Box&lt;T&gt;</code> æ–¹ä¾¿çš„åœ°æ–¹ï¼Œè€Œ <code>&dyn Trait</code>  ä¸æ‹¥æœ‰æ‰€æœ‰æƒï¼Œæœ‰çš„æ—¶å€™å°±æ²¡é‚£ä¹ˆæ–¹ä¾¿ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä½¿ç”¨ <code>Box&lt;dyn trait&gt;</code> åšå‡½æ•°å‚æ•°çš„ä¸€ä¸ªç¤ºä¾‹ã€‚</p><pre><code class=\"language-plain\">struct Atype;\nstruct Btype;\nstruct Ctype;\n\ntrait TraitA {}\n\nimpl TraitA for Atype {}\nimpl TraitA for Btype {}\nimpl TraitA for Ctype {}\n\nfn doit(x: Box&lt;dyn TraitA&gt;) {}\n\nfn main() {\n&nbsp; &nbsp; let a = Atype;\n&nbsp; &nbsp; doit(Box::new(a));\n&nbsp; &nbsp; let b = Btype;\n&nbsp; &nbsp; doit(Box::new(b));\n&nbsp; &nbsp; let c = Ctype;\n&nbsp; &nbsp; doit(Box::new(c));\n}\n</code></pre><p>è¿™ä¸ªç¤ºä¾‹é‡Œçš„ <code>doit()</code> å‡½æ•°èƒ½æ¥æ”¶ Atypeã€Btypeã€Ctype ä¸‰ç§ä¸åŒç±»å‹çš„å®ä¾‹ã€‚</p><p>å¦‚æœ dyn trait å‡ºç°åœ¨ç»“æ„ä½“é‡Œï¼Œé‚£ä¹ˆ <code>Box&lt;dyn trait&gt;</code> å½¢å¼å°±æ¯” <code>&amp;dyn trait</code> å½¢å¼è¦æ–¹ä¾¿å¾—å¤šã€‚æ¯”å¦‚ï¼Œä¸‹é¢ç¤ºä¾‹é‡Œçš„ç»“æ„ä½“å­—æ®µç±»å‹æ˜¯ <code>Box&lt;dyn TraitA&gt;</code>ï¼Œèƒ½æ­£å¸¸ç¼–è¯‘ã€‚</p><pre><code class=\"language-plain\">struct Atype;\nstruct Btype;\nstruct Ctype;\n\ntrait TraitA {}\n\nimpl TraitA for Atype {}\nimpl TraitA for Btype {}\nimpl TraitA for Ctype {}\n\nstruct MyStruct {\n&nbsp; &nbsp; x: Box&lt;dyn TraitA&gt;  // ç»“æ„ä½“çš„å­—æ®µç±»å‹æ˜¯ Box&lt;dyn TraitA&gt;\n}\n\nfn main() {\n&nbsp; &nbsp; let a = Atype;\n&nbsp; &nbsp; let t1 = MyStruct {x: Box::new(a)};\n&nbsp; &nbsp; let b = Btype;\n&nbsp; &nbsp; let t2 = MyStruct {x: Box::new(b)};\n&nbsp; &nbsp; let c = Ctype;\n&nbsp; &nbsp; let t3 = MyStruct {x: Box::new(c)};\n}\n</code></pre><p>è€Œä¸‹é¢è¿™ä¸ªç¤ºä¾‹ï¼Œç»“æ„ä½“å­—æ®µç±»å‹æ˜¯ <code>&amp;dyn TraitA</code>ï¼Œå°±æ²¡åŠæ³•é€šè¿‡ç¼–è¯‘ã€‚</p><pre><code class=\"language-plain\">struct Atype;\nstruct Btype;\nstruct Ctype;\n\ntrait TraitA {}\n\nimpl TraitA for Atype {}\nimpl TraitA for Btype {}\nimpl TraitA for Ctype {}\n\nstruct MyStruct {\n&nbsp; &nbsp; x: &amp;dyn TraitA    // ç»“æ„ä½“å­—æ®µç±»å‹æ˜¯ &amp;dyn TraitA \n}\n</code></pre><p>æŠ¥é”™å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">error[E0106]: missing lifetime specifier\n  --&gt; src/lib.rs:12:8\n   |\n12 |     x: &amp;dyn TraitA\n   |        ^ expected named lifetime parameter\n   |\nhelp: consider introducing a named lifetime parameter\n   |\n11 ~ struct MyStruct&lt;'a&gt; {\n12 ~     x: &amp;'a dyn TraitA\n   |\n</code></pre><p>è¿™ä¸ªé”™è¯¯æ¶‰åŠåˆ°ç¬¬20è®²å¼•ç”¨çš„ç”Ÿå‘½æœŸçš„æ¦‚å¿µï¼Œç°åœ¨æˆ‘ä»¬ä¸å»æ·±ç©¶ã€‚</p><p><code>Box&lt;T&gt;</code> æ™ºèƒ½æŒ‡é’ˆçš„å†…å®¹å°±è®²åˆ°è¿™é‡Œï¼Œä¸‹é¢æˆ‘ä»¬çœ‹å¦ä¸€ç§æ™ºèƒ½æŒ‡é’ˆ <code>Arc&lt;T&gt;</code>ã€‚</p><h2><code>Arc&lt;T&gt;</code></h2><p><code>Box&lt;T&gt;</code> æ˜¯å•æ‰€æœ‰æƒæˆ–ç‹¬å æ‰€æœ‰æƒæ¨¡å‹çš„æ™ºèƒ½æŒ‡é’ˆï¼Œè€Œ <code>Arc&lt;T&gt;</code> æ˜¯å…±äº«æ‰€æœ‰æƒæ¨¡å‹çš„æ™ºèƒ½æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯å¤šä¸ªå˜é‡å¯ä»¥åŒæ—¶æ‹¥æœ‰ä¸€ä¸ªèµ„æºçš„æ‰€æœ‰æƒã€‚å’Œ <code>Box&lt;T&gt;</code> ä¸€æ ·ï¼Œ<code>Arc&lt;T&gt;</code> ä¹Ÿä¼šä¿è¯è¢«åŒ…è£…çš„å†…å®¹è¢«åˆ†é…åœ¨å †ä¸Šã€‚</p><h3>clone</h3><p>Arcçš„ä¸»è¦åŠŸèƒ½æ˜¯å’Œ <code>clone()</code> é…åˆä½¿ç”¨ã€‚åœ¨Arcå®ä¾‹ä¸Šæ¯ä¸€æ¬¡æ–°çš„ <code>clone()</code> æ“ä½œï¼Œæ€»æ˜¯ä¼šå°†èµ„æºçš„å¼•ç”¨æ•°+1ï¼Œè€Œä¿æŒåŸæ¥é‚£ä¸€ä»½èµ„æºä¸åŠ¨ï¼Œè¿™ä¸ªä¿¡æ¯è®°å½•åœ¨Arcå®ä¾‹é‡Œé¢ã€‚æ¯ä¸€ä¸ªæŒ‡å‘åŒä¸€ä¸ªèµ„æºçš„Arcå®ä¾‹èµ°å‡ºä½œç”¨åŸŸï¼Œå°±ä¼šç»™è¿™ä¸ªå¼•ç”¨è®¡æ•°-1ã€‚ç›´åˆ°æœ€åä¸€ä¸ªArcå®ä¾‹æ¶ˆå¤±ï¼Œç›®æ ‡èµ„æºæ‰ä¼šè¢«é”€æ¯é‡Šæ”¾ã€‚ä½ å¯ä»¥çœ‹ä¸€ä¸‹ç¤ºä¾‹ã€‚</p><pre><code class=\"language-plain\">use std::sync::Arc;\n\n#[derive(Debug)]    // è¿™é‡Œä¸éœ€è¦ç›®æ ‡typeå®ç°Clone trait\nstruct Point {\n&nbsp; &nbsp; x: u32,\n&nbsp; &nbsp; y: u32,\n}\n\nimpl Point {\n&nbsp; &nbsp; fn play(&amp;self) {\n&nbsp; &nbsp; &nbsp; &nbsp; println!(\"I'am a method of Point.\");\n&nbsp; &nbsp; }\n}\n\nfn main() {\n&nbsp; &nbsp; let arced: Arc&lt;Point&gt; = Arc::new(Point{x: 10, y: 20});\n&nbsp; &nbsp; let another_arced = arced.clone();&nbsp; &nbsp; &nbsp; // å…‹éš†å¼•ç”¨\n&nbsp; &nbsp; println!(\"{:?}\", arced);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // æ‰“å°ä¸€ä»½å€¼\n&nbsp; &nbsp; println!(\"{:?}\", another_arced);&nbsp; &nbsp; &nbsp; &nbsp; // æ‰“å°åŒä¸€ä»½å€¼\n&nbsp; &nbsp; arced.play();\n&nbsp; &nbsp; another_arced.play();\n    let arc3_ref = &amp;another_arced;\n    arc3_ref.play();\n}\n// è¾“å‡º\nPoint { x: 10, y: 20 }\nPoint { x: 10, y: 20 }\nI'am a method of Point.\nI'am a method of Point.\nI'am a method of Point.\n</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç›¸æ¯”äº <code>Box&lt;T&gt;</code>ï¼Œ<code>Arc&lt;T&gt;</code> çš„cloneä¸è¦æ±‚Tå®ç°äº†Clone traitã€‚<code>Arc&lt;T&gt;</code> çš„å…‹éš†è¡Œä¸ºåªä¼šæ”¹å˜Arcçš„å¼•ç”¨è®¡æ•°ï¼Œè€Œä¸ä¼šå…‹éš†é‡Œé¢çš„å†…å®¹ã€‚ç”±äºä¸éœ€è¦å…‹éš†åŸå§‹èµ„æºï¼Œæ‰€ä»¥æ€§èƒ½æ˜¯å¾ˆé«˜çš„ã€‚</p><p>ç±»ä¼¼äº <code>Box&lt;T&gt;</code>ï¼Œ<code>Arc&lt;T&gt;</code> ä¹Ÿå®ç°äº†Derefã€Dropã€Cloneç­‰traitã€‚å› æ­¤ï¼Œ<code>Arc&lt;T&gt;</code> ä¹Ÿå¯ä»¥ç¬¦åˆäººç±»çš„ä¹ æƒ¯ï¼Œè®¿é—®åˆ°é‡Œé¢ç±»å‹Tçš„æ–¹æ³•ã€‚<code>Arc&lt;T&gt;</code> çš„ä¸å¯å˜å¼•ç”¨ <code>&amp;Arc&lt;&gt;</code> ä¹Ÿå¯ä»¥é¡ºåˆ©è°ƒç”¨åˆ°Tä¸Šçš„æ–¹æ³•ã€‚</p><h3>Arc<self></self></h3><p>å’Œ <code>Box&lt;T&gt;</code> ä¸€æ ·ï¼ŒArcä¹Ÿå¯ä»¥ç”¨åœ¨æ–¹æ³•ä¸­çš„selfå‚æ•°ä¸Šé¢ï¼Œä½œä¸ºæ‰€æœ‰æƒselfçš„ä¸€ä¸ªå˜ä½“å½¢å¼ã€‚</p><p>æˆ‘ä»¬ç»§ç»­æ‰©å±•ä¸Šé¢çš„ä»£ç ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹æ‰©å±•åçš„æ ·å­ã€‚</p><pre><code class=\"language-plain\">use std::sync::Arc;\n\n#[derive(Debug)]\nstruct Point {\n&nbsp; &nbsp; x: u32,\n&nbsp; &nbsp; y: u32,\n}\n\nimpl Point {\n&nbsp; &nbsp; fn play_ref(&amp;self) {\n&nbsp; &nbsp; &nbsp; &nbsp; println!(\"I'am play_ref of Point.\");\n&nbsp; &nbsp; }\n&nbsp; &nbsp; fn play_mutref(&amp;mut self) {\n&nbsp; &nbsp; &nbsp; &nbsp; println!(\"I'am play_mutref of Point.\");\n&nbsp; &nbsp; }\n&nbsp; &nbsp; fn play_own(self) {\n&nbsp; &nbsp; &nbsp; &nbsp; println!(\"I'am play_own of Point.\");\n&nbsp; &nbsp; }\n&nbsp; &nbsp; fn play_boxown(self: Box&lt;Self&gt;) {&nbsp; &nbsp; // æ³¨æ„è¿™é‡Œ\n&nbsp; &nbsp; &nbsp; &nbsp; println!(\"I'am play_boxown of Point.\");\n&nbsp; &nbsp; }\n&nbsp; &nbsp; fn play_arcown(self: Arc&lt;Self&gt;) {&nbsp; &nbsp; // æ³¨æ„è¿™é‡Œ\n&nbsp; &nbsp; &nbsp; &nbsp; println!(\"I'am play_arcown of Point.\");\n&nbsp; &nbsp; }\n}\n\nfn main() {\n&nbsp; &nbsp; let mut boxed: Box&lt;Point&gt; = Box::new(Point{x: 10, y: 20});\n&nbsp; &nbsp; boxed.play_ref();\n&nbsp; &nbsp; boxed.play_mutref();\n&nbsp; &nbsp; boxed.play_boxown();\n&nbsp; &nbsp; // boxed.play_own();&nbsp; // play_boxown()å’Œ play_own() åªèƒ½åŒæ—¶æ‰“å¼€ä¸€ä¸ª\n&nbsp; &nbsp; \n    let arced: Arc&lt;Point&gt; = Arc::new(Point{x: 10, y: 20});\n&nbsp; &nbsp; arced.play_ref();\n&nbsp; &nbsp; // arced.play_mutref();&nbsp; // ä¸èƒ½ç”¨\n&nbsp; &nbsp; // arced.play_own();&nbsp; &nbsp; &nbsp;// ä¸èƒ½ç”¨ï¼ŒArc&lt;T&gt; ä¸­çš„Tæ— æ³•è¢«ç§»å‡º\n&nbsp; &nbsp; arced.play_arcown();&nbsp;\n}\n// è¾“å‡º\nI'am play_ref of Point.\nI'am play_mutref of Point.\nI'am play_boxown of Point.\nI'am play_ref of Point.\nI'am play_arcown of Point.\n</code></pre><p>é€šè¿‡è¿™ä¸ªç¤ºä¾‹æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸èƒ½é€šè¿‡ <code>Arc&lt;&gt;</code> ç›´æ¥ä¿®æ”¹é‡Œé¢ç±»å‹çš„å€¼ï¼Œä¹Ÿä¸èƒ½åƒ <code>Box&lt;&gt;</code> çš„è§£å¼•ç”¨æ“ä½œé‚£æ ·ï¼ŒæŠŠé‡Œé¢çš„å†…å®¹ä» <code>Arc&lt;&gt;</code> ä¸­ç§»åŠ¨å‡ºæ¥ã€‚ä½ å¯ä»¥è¯•ç€æ‰“å¼€ç¤ºä¾‹é‡Œæ³¨é‡Šæ‰çš„å‡ è¡Œçœ‹çœ‹Rustcå°åŠ©æ‰‹çš„æç¤ºä¿¡æ¯ã€‚</p><h3><code>Arc&lt;dyn trait&gt;</code></h3><p>æˆ‘ä»¬è¿˜å¯ä»¥æŠŠå‰é¢ <code>Box&lt;dyn trait&gt;</code> çš„ç¤ºä¾‹æ”¹ç¼–æˆ <code>Arc&lt;T&gt;</code> çš„ã€‚</p><pre><code class=\"language-plain\">use std::sync::Arc;\n\nstruct Atype;\nstruct Btype;\nstruct Ctype;\n\ntrait TraitA {}\n\nimpl TraitA for Atype {}\nimpl TraitA for Btype {}\nimpl TraitA for Ctype {}\n\nstruct MyStruct {\n&nbsp; &nbsp; x: Arc&lt;dyn TraitA&gt;\n}\n\nfn main() {\n&nbsp; &nbsp; let a = Atype;\n&nbsp; &nbsp; let t1 = MyStruct {x: Arc::new(a)};\n&nbsp; &nbsp; let b = Btype;\n&nbsp; &nbsp; let t2 = MyStruct {x: Arc::new(b)};\n&nbsp; &nbsp; let c = Ctype;\n&nbsp; &nbsp; let t3 = MyStruct {x: Arc::new(c)};\n}\n</code></pre><h3>å€¼çš„ä¿®æ”¹</h3><p>å¤šæ‰€æœ‰æƒæ¡ä»¶ä¸‹ï¼Œæ€ä¹ˆä¿®æ”¹Arcé‡Œé¢çš„å€¼å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¸èƒ½ä¿®æ”¹ã€‚è™½ç„¶ <code>Arc&lt;T&gt;</code> æ˜¯æ‹¥æœ‰æ‰€æœ‰æƒçš„ï¼Œä½† <code>Arc&lt;T&gt;</code> ä¸æä¾›ä¿®æ”¹Tçš„èƒ½åŠ›ï¼Œè¿™ä¹Ÿæ˜¯ <code>Arc&lt;T&gt;</code> å’Œ <code>Box&lt;T&gt;</code> ä¸ä¸€æ ·çš„åœ°æ–¹ã€‚åé¢æˆ‘ä»¬åœ¨å¹¶å‘ç¼–ç¨‹éƒ¨åˆ†ä¼šè®²åˆ°Mutexã€RwLockç­‰é”ã€‚æƒ³è¦ä¿®æ”¹Arcé‡Œé¢çš„å†…å®¹ï¼Œå¿…é¡»é…åˆè¿™äº›é”æ‰èƒ½å®Œæˆï¼Œæ¯”å¦‚ <code>Arc&lt;Mutex&lt;T&gt;&gt;</code>ã€‚</p><p>å…¶å®å¾ˆå¥½ç†è§£ï¼Œå…±äº«æ‰€æœ‰æƒçš„åœºæ™¯ä¸‹ï¼Œå¦‚æœä»»æ„ä¸€æ–¹èƒ½éšæ„ä¿®æ”¹è¢«åŒ…è£¹çš„å€¼ï¼Œé‚£å°±ä¼šå½±å“å…¶ä»–æ‰€æœ‰æƒçš„æŒæœ‰è€…ï¼Œæ•´ä¸ªå°±ä¹±å¥—äº†ã€‚æ‰€ä»¥è¦ä¿®æ”¹çš„è¯å¿…é¡»å¼•å…¥é”çš„æœºåˆ¶ã€‚</p><h3><code>Arc&lt;T&gt;</code> ä¸ä¸å¯å˜å¼•ç”¨&amp;çš„åŒºåˆ«</h3><p>é¦–å…ˆï¼Œå®ƒä»¬éƒ½æ˜¯å…±äº«å¯¹è±¡çš„è¡Œä¸ºï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯æŒ‡é’ˆã€‚ä½† <code>Arc&lt;T&gt;</code> æ˜¯å…±äº«äº†æ‰€æœ‰æƒæ¨¡å‹ï¼Œè€Œ&amp;åªæ˜¯å…±äº«å€Ÿç”¨æ¨¡å‹ã€‚å…±äº«å€Ÿç”¨æ¨¡å‹å°±å¾—éµå¾ªå€Ÿç”¨æ£€æŸ¥å™¨çš„è§„åˆ™â€”â€”å€Ÿç”¨çš„æœ‰æ•ˆæ€§ä¾èµ–äºè¢«å€Ÿç”¨èµ„æºçš„scopeã€‚å¯¹äºè¿™ä¸ªçš„åˆ†ææ˜¯éå¸¸å¤æ‚çš„ã€‚è€Œæ‰€æœ‰æƒæ¨¡å‹æ˜¯ç”±è‡ªå·±æ¥ç®¡ç†èµ„æºçš„scopeï¼Œæ‰€ä»¥å¤„ç†èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿ã€‚</p><h2>å°ç»“</h2><p>è¿™èŠ‚è¯¾æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†æœ€å¸¸ç”¨çš„ä¸¤ä¸ªæ™ºèƒ½æŒ‡é’ˆï¼š<code>Box&lt;T&gt;</code> å’Œ <code>Arc&lt;T&gt;</code>ã€‚å…¶å®Rusté‡Œè¿˜æœ‰å¾ˆå¤šæ™ºèƒ½æŒ‡é’ˆï¼Œæ¯”å¦‚ Rcã€Cellã€RefCell ç­‰ç­‰ï¼Œæ¯ä¸€ç§æ™ºèƒ½æŒ‡é’ˆç±»å‹éƒ½æœ‰è‡ªå·±çš„ç‰¹ç‚¹ã€‚ä½†æ˜¯ä¸ç®¡æ€æ ·ï¼Œå­¦ä¹ çš„æ–¹æ³•éƒ½æ˜¯ä¸€æ ·çš„ï¼Œé‚£å°±æ˜¯ä»æ‰€æœ‰æƒçš„è§†è§’å»åˆ†æç ”ç©¶ã€‚ä½ å¯ä»¥åœ¨åé¢é‡åˆ°é‚£äº›ç±»å‹çš„æ—¶å€™ï¼Œå†æ ¹æ®è¿™èŠ‚è¯¾æä¾›çš„æ–¹æ³•å»ç ”ç©¶å®ƒä»¬ã€‚</p><p>åé¢æˆ‘ä»¬ä¼šçœ‹åˆ°ï¼Œåœ¨æ™ºèƒ½æŒ‡é’ˆçš„åŠ æŒä¸‹ï¼ŒRustä»£ç å†™èµ·æ¥ä¼šéå¸¸æµç•…ï¼Œå¯ä»¥å’ŒJavaä¸ç›¸ä¸Šä¸‹ã€‚å†ç»“åˆRustå¼ºå¤§çš„ç±»å‹ç³»ç»Ÿå»ºæ¨¡èƒ½åŠ›ï¼Œç­‰ä½ å†™å¾—ç†Ÿç»ƒä¹‹åï¼Œåœ¨ä¸­å¤§é¡¹ç›®ä¸­ï¼Œä½¿ç”¨Rustç”šè‡³ä¼šæœ‰è¶…è¶ŠPythonçš„å¼€å‘æ•ˆç‡ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/86/a9/86yy7a1095414ed7c2e479a5af42cfa9.jpg?wh=1270x1752\" alt=\"\"></p><h2>æ€è€ƒé¢˜</h2><p>ä½ è¯•ç€æ‰“å¼€ç¤ºä¾‹ä¸­çš„è¿™ä¸¤å¥ï¼Œçœ‹çœ‹æŠ¥é”™ä¿¡æ¯ï¼Œç„¶ååˆ†æä¸€ä¸‹æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ</p><pre><code class=\"language-plain\">&nbsp; &nbsp; // arced.play_mutref();&nbsp; // ä¸èƒ½ç”¨\n&nbsp; &nbsp; // arced.play_own();&nbsp; &nbsp; &nbsp;// ä¸èƒ½ç”¨\n</code></pre><p>æ¬¢è¿ä½ æŠŠè‡ªå·±çš„åˆ†æåˆ†äº«åˆ°è¯„è®ºåŒºï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾çš„å†…å®¹åˆ†äº«ç»™å…¶ä»–æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","neighbors":{"left":{"article_title":"11ï½œå¸¸è§traitè§£æï¼šæ ‡å‡†åº“ä¸­çš„å¸¸è§traitåº”è¯¥æ€ä¹ˆç”¨ï¼Ÿ","id":724942},"right":{"article_title":"13ï½œç‹¬ç«‹ç‹å›½ï¼šåˆæ­¥äº†è§£Rustå¼‚æ­¥å¹¶å‘ç¼–ç¨‹","id":725837}},"comments":[{"had_liked":false,"id":384668,"user_name":"cfanbo","can_delete":false,"product_type":"c1","uid":1043738,"ip_address":"æ¾³å¤§åˆ©äºš","ucode":"39D8D71453E575","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ed/1a/269eb3d6.jpg","comment_is_top":false,"comment_ctime":1701316685,"is_pvip":false,"replies":[{"id":140296,"content":"å¯¹çš„","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1701357309,"ip_address":"é‡åº†","comment_id":384668,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"åœ¨æ‰§è¡Œ Box::new() åˆ›å»º Box å®ä¾‹æ—¶ï¼Œå…·æœ‰ copy è¯­ä¹‰çš„æ•´æ•°ç±»å‹å’Œå…·æœ‰ move è¯­ä¹‰çš„ Point ç±»å‹è¡Œä¸ºä¸ä¸€æ ·ã€‚æ•´æ•°ä¼š copy ä¸€ä»½è‡ªå·±ï¼ŒPoint å®ä¾‹ä¼šæŠŠè‡ªå·± move åˆ° Box é‡Œé¢å»ã€‚\n------\næ˜¯å¦å¯ä»¥ç†è§£ä¸ºå¦‚æœåˆ›å»ºçš„å¯¹è±¡æœ‰copyè¯­ä¹‰çš„è¯ï¼Œåˆ™è¿›è¡Œcopyï¼›å¦åˆ™è¿›è¡Œmoveæ“ä½œï¼Ÿ","like_count":4,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632804,"discussion_content":"å¯¹çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1701357309,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383947,"user_name":"åˆ˜ä¸¹","can_delete":false,"product_type":"c1","uid":1081922,"ip_address":"å¹¿ä¸œ","ucode":"66594D1C957E15","user_header":"https://static001.geekbang.org/account/avatar/00/10/82/42/8b04d489.jpg","comment_is_top":false,"comment_ctime":1700006083,"is_pvip":false,"replies":[{"id":140092,"content":"å¯¹çš„ï¼Œpyä»£ç é‡ä¸Šæ¥åï¼Œå¯ç»´æŠ¤æ€§å’Œå¯é‡æ„æ€§æ¯”rustå·®å¾—å¤ªè¿œã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1700015083,"ip_address":"é‡åº†","comment_id":383947,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"åœ¨ä¸­å¤§é¡¹ç›®ä¸­ï¼Œä½¿ç”¨ Rust ç”šè‡³ä¼šæœ‰è¶…è¶Š Python çš„å¼€å‘æ•ˆç‡ã€‚","like_count":4,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631826,"discussion_content":"å¯¹çš„ï¼Œpyä»£ç é‡ä¸Šæ¥åï¼Œå¯ç»´æŠ¤æ€§å’Œå¯é‡æ„æ€§æ¯”rustå·®å¾—å¤ªè¿œã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1700015083,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1120153,"avatar":"https://static001.geekbang.org/account/avatar/00/11/17/99/d2e2ba19.jpg","nickname":"ç®€","note":"","ucode":"48300AD332D244","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635512,"discussion_content":"çœ‹èµ·æ¥æ‚¨Pythonå†™çš„è¿˜æ˜¯ä¸å¤Ÿå¥½ã€‚è¿™ä¸ªç»“è®ºå¾ˆæ­¦æ–­","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1704899832,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ²³åŒ—","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383969,"user_name":"Taozi","can_delete":false,"product_type":"c1","uid":1021926,"ip_address":"ä¸Šæµ·","ucode":"DD6567A31B3E33","user_header":"","comment_is_top":false,"comment_ctime":1700032103,"is_pvip":false,"replies":[{"id":140105,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1700192056,"ip_address":"é‡åº†","comment_id":383969,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"Arcæœ¬è´¨ä¸Šæ˜¯ä¸ªå¼•ç”¨ï¼Œæ‰€ä»¥ä¸å…è®¸åŒæ—¶å­˜åœ¨å¯å˜å¼•ç”¨æˆ–è€…ç§»åŠ¨ã€‚","like_count":3,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631951,"discussion_content":"ğŸ‘","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1700192056,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1603004,"avatar":"https://static001.geekbang.org/account/avatar/00/18/75/bc/89d88775.jpg","nickname":"Calvin","note":"","ucode":"0EEF5B207623B5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":641549,"discussion_content":"è¿™æ„Ÿè§‰ä¸èƒ½è¿™ä¹ˆç†è§£ï¼Œé‚£ Box å‘¢ï¼Ÿä¸ä¸€æ ·æ˜¯ä¸€ä¸ªå¼•ç”¨ã€‚\nè¿˜æ˜¯è¦ä»â€œå…±äº«â€èµ„æºçš„è§’åº¦å»ç†è§£ï¼ŒåŒä¸€ä»½èµ„æºï¼ˆæ‰€æœ‰æƒï¼‰ä¸èƒ½ç›´æ¥è¿›è¡Œä¿®æ”¹ï¼Œéœ€è¦å…ˆè·å–åˆ°å†™æƒé™ï¼ˆé”æ§åˆ¶ï¼‰ã€‚\nç±»ä¼¼äº let x å’Œ let mut x çš„åŒºåˆ«ï¼ŒArc çš„è¿™ç§å†™é™åˆ¶åº”è¯¥åªæ˜¯åœ¨è¯­è¨€è®¾è®¡å±‚é¢ä¸Šçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1712754550,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385859,"user_name":"$ä¾¯","can_delete":false,"product_type":"c1","uid":1019939,"ip_address":"æµ™æ±Ÿ","ucode":"488B1BD3924E7E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/90/23/5c74e9b7.jpg","comment_is_top":false,"comment_ctime":1703519241,"is_pvip":false,"replies":[{"id":140626,"content":"è¿™æ­£æ˜¯ä¸€ä¸ªéšå«çš„çŸ¥è¯†ç‚¹ï¼Œå›ºå®šå°ºå¯¸çš„ç»“æ„ä½“å´é»˜è®¤ä¸æ˜¯å¯copyçš„ã€‚ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢ä¸å°å¿ƒçš„äº§ç”Ÿé¢å¤–å¤åˆ¶è´Ÿæ‹…ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1703577398,"ip_address":"é‡åº†","comment_id":385859,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"Box&lt;T&gt;Â ä¸­çš„æ‰€æœ‰æƒåˆ†æ é‚£é‡Œ\n\nè¯´â€œPoint ç±»å‹æœ¬èº«å°±æ˜¯ move è¯­ä¹‰çš„â€\n\nè¿™é‡Œçš„Pointä¸­çš„å…ƒç´ ä¸éƒ½æ˜¯copyè¯­ä¹‰çš„å—ï¼Œæ‰€ä»¥è¿™ä¸ªPointä¸æ˜¯åº”è¯¥æ˜¯copyè¯­ä¹‰çš„å—ï¼Œä¸ºä»€ä¹ˆè¯´æ˜¯moveè¯­ä¹‰çš„\n","like_count":1,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634492,"discussion_content":"è¿™æ­£æ˜¯ä¸€ä¸ªéšå«çš„çŸ¥è¯†ç‚¹ï¼Œå›ºå®šå°ºå¯¸çš„ç»“æ„ä½“å´é»˜è®¤ä¸æ˜¯å¯copyçš„ã€‚ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢ä¸å°å¿ƒçš„äº§ç”Ÿé¢å¤–å¤åˆ¶è´Ÿæ‹…ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1703577398,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":1,"child_discussions":[{"author":{"id":1603004,"avatar":"https://static001.geekbang.org/account/avatar/00/18/75/bc/89d88775.jpg","nickname":"Calvin","note":"","ucode":"0EEF5B207623B5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":641554,"discussion_content":"è€å¸ˆæˆ‘æƒ³è¯·é—®ä¸‹ï¼Œè¿™é‡Œè¯´ Box&lt;Point&gt; è§£å¼•ç”¨è¢«ä»å †ä¸Šâ€œç§»åŠ¨â€åˆ°äº†æ ˆä¸Šï¼Œæ˜¯æŒ‡ Point çš„å€¼ä»¥åŠå®ƒçš„æ‰€æœ‰æƒéƒ½è¢«ç§»åŠ¨äº†å—ï¼Ÿ\n\n1: let p1 = Point {x: 10, y: 20};       // è¿™ä¸ªç»“æ„ä½“çš„å®ä¾‹ p1 åˆ›å»ºåœ¨æ ˆä¸Š\n2: let boxed: Box = Box::new(p1);  // é€šè¿‡ Box::new(p1)ï¼ŒæŠŠ p1 å®ä¾‹å¼ºè¡ŒæŒ‰ä½å¤åˆ¶äº†ä¸€ä»½ï¼Œå¹¶ä¸”æ”¾åˆ°äº†å †ä¸Šï¼ˆè®°ä¸º p1&#39;ï¼‰\n3: let p2: Point = *boxed;            // è¿™é‡Œåšäº†è§£å¼•ç”¨ï¼ŒPoint å®ä¾‹ p1&#39; å›åˆ°æ ˆä¸Š\n\nQ1ï¼šä»¥ä¸Šç¬¬ 2 è¡Œä»£ç ï¼Œboxed é‡Œé¢æŒ‡å‘çš„åº”è¯¥æ˜¯ p1&#39; è€Œä¸æ˜¯ p1ï¼ˆå› ä¸º p1 åœ¨æ ˆä¸Šï¼Œp1&#39; åœ¨å †ä¸Šï¼‰ï¼Œå®ƒä¸ºä»€ä¹ˆè¯´æ˜¯â€œå¤åˆ¶â€ï¼Ÿp1 åº”è¯¥ç§»åŠ¨äº†æ‰€æœ‰æƒï¼\nQ2ï¼šä»¥ä¸Šç¬¬ 3 è¡Œä»£ç ï¼Œp2 å®ä¾‹å›åˆ°æ ˆä¸Šï¼Œä¸ºä»€ä¹ˆåˆè¯´æ˜¯â€œç§»åŠ¨â€ï¼Ÿå®é™…çš„æ“ä½œæ˜¯ä¸æ˜¯æŠŠ p1&#39; å†æŒ‰ä½å¤åˆ¶ä¸€ä»½åˆ°æ ˆä¸Šï¼ˆè®°ä¸º p2ï¼‰ï¼Œç„¶åå †ä¸Šçš„ p1&#39; å°±ç›´æ¥å›æ”¶äº†ï¼ˆæ˜¯è§£å¼•ç”¨åå°±å›æ”¶äº†ï¼Œè¿˜æ˜¯ç­‰åˆ°é€€å‡ºå‡½æ•°ï¼ˆæ‰€æœ‰æƒä½œç”¨åŸŸï¼‰åï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1712755538,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":634492,"ip_address":"å¹¿ä¸œ","group_id":0},"score":641554,"extra":""}]}]},{"had_liked":false,"id":383971,"user_name":"Michael","can_delete":false,"product_type":"c1","uid":1118976,"ip_address":"ä¸­å›½é¦™æ¸¯","ucode":"35F4FFAC4A4B15","user_header":"https://static001.geekbang.org/account/avatar/00/11/13/00/a4a2065f.jpg","comment_is_top":false,"comment_ctime":1700033546,"is_pvip":false,"replies":[{"id":140107,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1700192066,"ip_address":"é‡åº†","comment_id":383971,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"play_boxown() å’Œ play_own() åªèƒ½åŒæ—¶æ‰“å¼€ä¸€ä¸ªï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•è°ƒç”¨éƒ½ä¼šæ¶ˆè€—æ‰€æœ‰æƒï¼Œå¯¼è‡´æ²¡æ³•è°ƒç”¨å¦å¤–ä¸€ä¸ªã€‚","like_count":1,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631953,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1700192066,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383957,"user_name":"duwoodly","can_delete":false,"product_type":"c1","uid":2020398,"ip_address":"é‡åº†","ucode":"12F7BFCB78DB0E","user_header":"https://static001.geekbang.org/account/avatar/00/1e/d4/2e/d478a412.jpg","comment_is_top":false,"comment_ctime":1700018910,"is_pvip":false,"replies":[{"id":140101,"content":"å¯¹çš„ï¼Œè‡ªå·±åŠ¨æ‰‹è¯•éªŒï¼Œå¾—åˆ°æœ€å‡†ç¡®æœ€å…¨é¢çš„ä¿¡æ¯ã€‚ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1700191183,"ip_address":"é‡åº†","comment_id":383957,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100626901,"comment_content":" arced.play_mutref(); &#47;&#47;  Arc&lt;T&gt;æ²¡æœ‰å®ç°æ™ºèƒ½æŒ‡é’ˆçš„DerefMut  trait\narced.play_own(); &#47;&#47;  ä¸èƒ½ä»Arc&lt;T&gt; ä¸­ç§»å‡ºå€¼ï¼Œé™¤éTå®ç°äº†Copy","like_count":1,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631947,"discussion_content":"å¯¹çš„ï¼Œè‡ªå·±åŠ¨æ‰‹è¯•éªŒï¼Œå¾—åˆ°æœ€å‡†ç¡®æœ€å…¨é¢çš„ä¿¡æ¯ã€‚ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1700191183,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1603004,"avatar":"https://static001.geekbang.org/account/avatar/00/18/75/bc/89d88775.jpg","nickname":"Calvin","note":"","ucode":"0EEF5B207623B5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":641555,"discussion_content":"666ï¼Œè¿™ä¸ªæ‰æ˜¯æ ¹æœ¬åŸå› ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1712755596,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385608,"user_name":"superggn","can_delete":false,"product_type":"c1","uid":3623568,"ip_address":"åŒ—äº¬","ucode":"831CCD98B393FE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/7Q403U68Oy4lXG5sFBPVKLrfwaRzBqpBZibpEBXcPf9UOO3qrnh7RELoByTLzBZLkN9Nukfsj7DibynbZjKAKgag/132","comment_is_top":false,"comment_ctime":1702968944,"is_pvip":false,"replies":[{"id":140566,"content":"åˆ†æå¾—éå¸¸æ£’ï¼æ€è·¯ä¹Ÿå¾ˆæ£’ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1703123543,"ip_address":"é‡åº†","comment_id":385608,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"arced.play_mutref() =&gt; è¿™ä¸ªä¸èƒ½ç”¨æ˜¯å› ä¸º Arc è¿™ç§æä¾›å¤šä¸ªå¼•ç”¨çš„ç±»å‹ä¸æ”¯æŒå¯å˜å¼•ç”¨\narced.play_own() =&gt; è¿™ä¸ªä¸èƒ½ç”¨æ˜¯å› ä¸º Arc è¿™ç§æä¾›å¤šä¸ªå¼•ç”¨çš„ç±»å‹ä¸æ”¯æŒè½¬ç§»å†…éƒ¨å€¼çš„æ‰€æœ‰æƒ\n\nä¸€å¼€å§‹æˆ‘å¯»æ€è¿™é‡Œä¼šä¸ä¼šæ˜¯ç›´æ¥æŠ›å‡º mismatched type, çœ‹ rustc çš„æç¤ºå‘ç°ä¸å¯¹ï¼Œ åæ¥æƒ³äº†æƒ³ï¼Œ å¯èƒ½æ˜¯å› ä¸º rust æ‰¾ä¸åˆ°ç±»å‹ä¼šå…ˆè·‘ deref coercion, deref coercion åŒ¹é…åˆ°äº†å°±ä¸ä¼šæŠ¥ mismatched typeï¼Œ æŠ¥é”™æ˜¯åœ¨ deref coercion è¿‡ç¨‹ä¸­è·å–æ‰€æœ‰æƒçš„æ—¶å€™æ‰å‡ºç°ï¼Ÿ\n\næ€»ç»“ä¸‹ï¼š Box&lt;T&gt;, Arc&lt;T&gt;, Rc&lt;T&gt; è°ƒç”¨ T çš„æ–¹æ³•ï¼Œ æœºåˆ¶éƒ½æ˜¯ deref coercion\n\nBox è¿˜å¥½ï¼Œ æ‰€æœ‰æƒæ‹¿èµ°å°±æ‹¿å§ï¼Œ ä½† Arc &#47; Rc è¿™ä¿©éƒ½å¯èƒ½ä¼šæœ‰ä¸åŒçš„æ‰€æœ‰è€…ï¼Œ é‡Œå¤´çš„ T ä¸èƒ½æ˜¯ mut çš„ï¼Œ æ‰€æœ‰æƒä¹Ÿä¸èƒ½æ”¾å‡ºå»ï¼Œ æ‰€ä»¥ä¼šé”™","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634242,"discussion_content":"åˆ†æå¾—éå¸¸æ£’ï¼æ€è·¯ä¹Ÿå¾ˆæ£’ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1703123543,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":384013,"user_name":"é¸ æ‘©æ™º","can_delete":false,"product_type":"c1","uid":1106201,"ip_address":"æ±Ÿè‹","ucode":"853E584FC4CD64","user_header":"https://static001.geekbang.org/account/avatar/00/10/e1/19/c756aaed.jpg","comment_is_top":false,"comment_ctime":1700103732,"is_pvip":true,"replies":[{"id":140100,"content":"å¯¹çš„ï¼ŒğŸ‘ã€‚è‡ªåŠ¨è§£å¼€æ˜¯å› ä¸º Box&lt;T&gt; å®ç°äº†åˆ° T çš„ Derefï¼šhttps:&#47;&#47;doc.rust-lang.org&#47;std&#47;boxed&#47;struct.Box.html#impl-Deref-for-Box%3CT,+A%3E","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1700191058,"ip_address":"é‡åº†","comment_id":384013,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"     å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå‡½æ•°çš„å…¥å‚æ˜¯self:Box&lt;Self&gt;æ—¶ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°çš„åªèƒ½æ˜¯BoxåŒ…èµ·æ¥çš„ç±»å‹ï¼Œæ¯”å¦‚è¿™é‡Œçš„Pointã€‚\n     let p = Point{x:1,y:2};\n     p.play_boxown();\n     ä¼šç¼–è¯‘æŠ¥é”™method `play_boxown` not found for this struct Point\n     the method is available for `Box&lt;Point&gt;` here\n    consider wrapping the receiver expression with the appropriate type\n    Box::new(p).play_boxown();\nç‚¹æ“ä½œç¬¦ä¸ä¼šè‡ªåŠ¨ç”¨BoxåŒ…èµ·æ¥ï¼Œä½†æ˜¯ä¼šè§£å¼€Boxã€‚","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631946,"discussion_content":"å¯¹çš„ï¼ŒğŸ‘ã€‚è‡ªåŠ¨è§£å¼€æ˜¯å› ä¸º Box&lt;T&gt; å®ç°äº†åˆ° T çš„ Derefï¼šhttps://doc.rust-lang.org/std/boxed/struct.Box.html#impl-Deref-for-Box%3CT,+A%3E","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1700191058,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383990,"user_name":"ä¸‹é›¨å¤©","can_delete":false,"product_type":"c1","uid":1008315,"ip_address":"æ¹–åŒ—","ucode":"816B3792ECC50A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/62/bb/323a3133.jpg","comment_is_top":false,"comment_ctime":1700046921,"is_pvip":false,"replies":[{"id":140099,"content":"ğŸ‘ã€‚æ˜¯çš„ï¼Œé‡Œé¢çš„Tæ— æ³•è¢«ç§»å‡ºArcï¼Œè¿™ç‚¹ä¸Boxä¸åŒã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1700190956,"ip_address":"é‡åº†","comment_id":383990,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"let  arced: Arc&lt;Point&gt; = Arc::new(Point{x: 10, y: 20});\n1. arced.play_mutref(); \nacedåªæä¾›ä¸å¯å˜å¼•ç”¨ï¼Œplay_mutrefå‚æ•°æ˜¯å¯å˜å¼•ç”¨ã€‚æ‰“å¼€å°±ä¼šæŠ¥é”™\n\n\n2. arced.play_own();     &#47;&#47; ä¸èƒ½ç”¨\nplay_ownçš„å‚æ•°selfè¡¨ç¤º Point , è€Œarcedç±»å‹æ˜¯Arc&lt;Point&gt;  ä¸èƒ½å¼ºåˆ¶è½¬æ¢ã€‚\n\n","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631945,"discussion_content":"ğŸ‘ã€‚æ˜¯çš„ï¼Œé‡Œé¢çš„Tæ— æ³•è¢«ç§»å‡ºArcï¼Œè¿™ç‚¹ä¸Boxä¸åŒã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1700190957,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383962,"user_name":"-","can_delete":false,"product_type":"c1","uid":1546505,"ip_address":"åŒ—äº¬","ucode":"7B34258D346793","user_header":"https://static001.geekbang.org/account/avatar/00/17/99/09/29c46a7b.jpg","comment_is_top":false,"comment_ctime":1700022959,"is_pvip":false,"replies":[{"id":140103,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1700191976,"ip_address":"é‡åº†","comment_id":383962,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"play_boxown() å’Œ play_own() åªèƒ½åŒæ—¶æ‰“å¼€ä¸€ä¸ª,ä¸¤ä¸ªéƒ½æ˜¯æ‰€æœ‰æƒè½¬ç§»äº†ï¼Œæ‰€ä»¥å°±åªèƒ½è°ƒç”¨ä¸€æ¬¡ã€‚","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631949,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1700191976,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383951,"user_name":"å“„å“„","can_delete":false,"product_type":"c1","uid":3779530,"ip_address":"åŒ—äº¬","ucode":"F75FB23BEDC60A","user_header":"https://static001.geekbang.org/account/avatar/00/39/ab/ca/32d6c05d.jpg","comment_is_top":false,"comment_ctime":1700014924,"is_pvip":false,"replies":[{"id":140097,"content":"ä½ è®²çš„æ²¡é—®é¢˜ï¼Œæˆ‘ä¼šæŠŠRcæ”¾è¿›é˜¶éƒ¨åˆ†å»è®²ï¼Œä¸»è¦æ˜¯è¦ç…§é¡¾ä»jsï¼Œpyï¼Œphpç­‰è¯­è¨€è¿‡æ¥çš„åŒå­¦ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1700019650,"ip_address":"é‡åº†","comment_id":383951,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100626901,"comment_content":"Arcå¼€é”€è¾ƒå¤§ï¼Œå¦‚æœä¸æ˜¯ä¸ºäº†å¤šçº¿ç¨‹ï¼Œå°±åº”è¯¥ç”¨Rc","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631837,"discussion_content":"ä½ è®²çš„æ²¡é—®é¢˜ï¼Œæˆ‘ä¼šæŠŠRcæ”¾è¿›é˜¶éƒ¨åˆ†å»è®²ï¼Œä¸»è¦æ˜¯è¦ç…§é¡¾ä»jsï¼Œpyï¼Œphpç­‰è¯­è¨€è¿‡æ¥çš„åŒå­¦ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1700019650,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}