{"id":772007,"title":"10ï½œèµ„æºå’Œè„šæœ¬å¼‚å¸¸æŒ‡æ ‡ï¼šç›‘å¬èµ„æºå’Œè„šæœ¬çŠ¶æ€ï¼Œæ”¶é›†å¼‚å¸¸æ•°æ®","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ä¸‰æ¡¥ã€‚</p><p>å‰ä¸¤èŠ‚è¯¾ï¼Œæˆ‘ä»¬å­¦ä¹ äº†è¯»å–ç½‘é¡µæŒ‡æ ‡å’Œå°è£…æ¥å£çŠ¶æ€çš„æ–¹æ³•ï¼ŒåŒæ—¶é€šè¿‡å®æˆ˜æŠŠæœ‰æ•ˆä¿¡æ¯è½¬åŒ–ä¸ºæ•°æ®æŒ‡æ ‡æ¨¡å‹ï¼Œå¹¶ä¸”å°è£…åˆ°äº†å‰ç«¯å…¨é“¾è·¯SDKé‡Œé¢ã€‚</p><p>ä»Šå¤©ï¼Œæˆ‘ä»¬ç»§ç»­è®¾è®¡å¦ä¸€ä¸ªæ•°æ®æŒ‡æ ‡ï¼šå‰ç«¯èµ„æºçŠ¶æ€ã€‚</p><h2>å‰ç«¯èµ„æºæ˜¯ç”¨æˆ·ä½“éªŒçš„é‡è¦èµ„äº§</h2><p>æ›¾ç»æœ‰ä¸€ä¸ªå‰ç«¯é¡¹ç›®æˆ‘å°è±¡ç‰¹åˆ«æ·±åˆ»ï¼Œä¸»è¦æ˜¯åšH5è¥é”€æ´»åŠ¨çš„å‰ç«¯å·¥ç¨‹ã€‚</p><p>æˆ‘è¯„ä¼°å®Œè¿™ä¸ªå‰ç«¯å·¥ç¨‹åï¼Œå‘ç°ä¸¤ä¸ªæœ‰è¶£çš„é—®é¢˜ã€‚</p><p>é¦–å…ˆï¼Œè¿™ä¸ªé¡¹ç›®æ˜¯åŸºäºVueæŠ€æœ¯æ ˆå®ç°çš„ï¼Œsrcç›®å½•ä¸‹æœ‰è¶…è¿‡200ä¸ªç›®å½•ï¼Œæ¯ä¸ªç›®å½•å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¥é”€æ´»åŠ¨ã€‚ç›®å½•å†…ä¸ä»…åŒ…å«äº†JavaScriptä»£ç å’ŒCSSä»£ç ï¼Œè¿˜åŒ…æ‹¬å›¾ç‰‡å’Œè§†é¢‘ã€‚</p><p>ç¬¬äºŒï¼Œä½¿ç”¨æœ¬åœ°å’Œç”Ÿäº§ç¯å¢ƒæ‰“åŒ…åè¿è¡Œé¡¹ç›®å‘ç°ï¼Œæ¯ä¸ªæ´»åŠ¨é¡µé¢åŠ è½½çš„å‰ç«¯JavaScriptæ–‡ä»¶è¶…è¿‡300ä¸ªï¼Œè€Œä¸”æ¯ä¸ªé¡µé¢åŠ è½½æ—¶é—´æ¥è¿‘5ç§’ä»¥ä¸Šã€‚</p><p>æˆ‘å°±å¥½å¥‡ï¼Œéš¾é“è¿™ä¸ªé¡¹ç›®ä¸€ç›´æ²¡æœ‰ç”¨æˆ·åé¦ˆåŠ è½½æ…¢çš„é—®é¢˜å—ï¼Ÿæˆ‘è®¤ä¸ºè‚¯å®šæœ‰çš„ã€‚é‚£ä¸ºä»€ä¹ˆæ²¡æœ‰å‰ç«¯åŒå­¦å»ä¼˜åŒ–è¿™ä¸ªé¡¹ç›®å‘¢ï¼Ÿæˆ‘çŒœï¼Œè¦ä¹ˆæ˜¯èƒ½åŠ›æœ‰é™ï¼Œè¦ä¹ˆæ˜¯æ”¹é€ å·¥ç¨‹é‡å¤§ã€‚</p><p>åƒè¿™ç§å‰ç«¯é¡¹ç›®ï¼Œä¸å½±å“ä¸šåŠ¡ä½¿ç”¨å’Œç”¨æˆ·ä½“éªŒå€’è¿˜å¥½ï¼Œä½†å¦‚æœå› ä¸ºåŠ è½½é€Ÿåº¦æ…¢å¯¼è‡´ç”¨æˆ·ç•™å­˜ç‡ä½ï¼Œé‚£çœŸçš„åªèƒ½æ€ªå‰ç«¯åŒå­¦äº†ã€‚</p><p>ç±»ä¼¼åŠ è½½è¶…è¿‡300ä¸ªJavaScriptæ–‡ä»¶è¿™æ ·çš„é—®é¢˜ï¼Œå…¶å®æ˜¯ç”±äºå‰ç«¯å·¥ç¨‹çš„æ‰“åŒ…å·¥å…·æ²¡å¤„ç†å¥½ï¼Œå¯¼è‡´æ‰€æœ‰ç›®å½•çš„JSé€»è¾‘éƒ½è¢«æ‰“åŒ…è¿›æ¥äº†ï¼Œå¹¶ä¸”æ˜¯ä¸€æ¬¡æ€§ç»Ÿä¸€åŠ è½½çš„ã€‚</p><!-- [[[read_end]]] --><p>æˆ‘ä»è¿™ä¸ªé¡¹ç›®æ€»ç»“å‡ºä¸€ä¸ªç»“è®ºï¼Œé‚£å°±æ˜¯å‰ç«¯èµ„æºæ˜¯Webåº”ç”¨åœ¨ç”¨æˆ·ä½“éªŒä¸Šçš„é‡è¦èµ„äº§ï¼Œå¦‚æœæˆ‘ä»¬ä¸èƒ½æå‰å‘ç°è¯·æ±‚èµ„æºçš„é—®é¢˜ï¼Œè¿Ÿæ—©éƒ½ä¼šå½±å“æˆ‘ä»¬çš„ç”¨æˆ·ï¼Œç”šè‡³äº§å“çš„ä½“éªŒã€‚</p><p>é‚£é—®é¢˜æ¥äº†ï¼Œåœ¨å‰ç«¯å…¨é“¾è·¯çš„è§£å†³æ–¹æ¡ˆä¸­ï¼Œæˆ‘ä»¬åº”è¯¥é‡ç‚¹å…³æ³¨å‰ç«¯å“ªäº›èµ„æºçš„å“ªäº›é—®é¢˜å‘¢ï¼Ÿ</p><p>æˆ‘è®¤ä¸ºæœ‰3ä¸ªåœ°æ–¹éœ€è¦é‡ç‚¹ç›‘å¬èµ„æºçš„çŠ¶æ€ï¼Œç›‘å¬å‰ç«¯èµ„æºä¸‹è½½çŠ¶æ€ã€è®°å½•å‰ç«¯èµ„æºåŠ è½½è€—æ—¶ä»¥åŠç›‘å¬å‰ç«¯è„šæœ¬å¼‚å¸¸æŠ¥é”™ã€‚</p><h2>æ€æ ·å…¨å±€ç›‘å¬å‰ç«¯èµ„æºçŠ¶æ€</h2><p>æˆ‘é˜…è¯»è¿‡ä¸å°‘å‰ç«¯å·¥ç¨‹é¡¹ç›®ä»£ç ï¼Œå…¶ä¸­æœ‰ä¸å°‘è¿˜æ˜¯ä¼šä½¿ç”¨ <code>onerror</code> æ¥æ•è·å›¾ç‰‡ä¸‹è½½å¤±è´¥äº‹ä»¶ï¼Œç„¶åæ‰§è¡Œ <code>onerror</code> å‡½æ•°ã€‚ä¸‹é¢å°±æ˜¯ä¸€æ®µä½¿ç”¨ <code>onerror</code> äº‹ä»¶çš„ç¤ºä¾‹ä»£ç ã€‚</p><pre><code class=\"language-xml\">&lt;html&gt;\n\t&lt;img&nbsp;\n\t\tid=\"errorImage\"\n\t\tsrc=\"https://static001.geekbang.org/resource/image/66/b1/66c84d9eff5102e8a79c81fbc4b061b1.jpg\"&nbsp;\n\t/&gt;\n\t&lt;script&gt;\n\t\tconst img = document.getElementById('errorImage')\n\t\timg.onerror = function() {\n\t\t\t// åœ¨è¿™é‡Œå¤„ç†å½“å›¾ç‰‡ä¸‹è½½æˆ–æ¸²æŸ“å¼‚å¸¸æ—¶çš„é€»è¾‘\n\t\t}\n\t&lt;/script&gt;\n&lt;/html&gt;\n</code></pre><p>äº‹å®ä¸Šï¼Œä¸€ä¸ªå‰ç«¯å·¥ç¨‹é¡¹ç›®é‡Œä¸æ­¢ä¸€å¼ å›¾ç‰‡ï¼Œä¸å¯èƒ½å¯¹æ¯å¼ å›¾ç‰‡éƒ½å®ç°ä¸€é <code>onerror</code> äº‹ä»¶ï¼Œæ‰€ä»¥ä¸Šè¿°çš„å®ç°æ–¹æ¡ˆå¹¶ä¸èƒ½ç›´æ¥åº”ç”¨åœ¨é¡¹ç›®ä¸­ã€‚</p><p>æ­£ç¡®çš„åšæ³•æ˜¯ç»‘å®šå…¨å±€ <code>error</code> äº‹ä»¶æ¥ç›‘å¬èµ„æºåŠ è½½æƒ…å†µã€‚ä¾‹å¦‚å¯ä»¥é€šè¿‡ä¸‹é¢è¿™ç§ä»£ç æ ¼å¼æ¥åˆå§‹åŒ– <code>error</code> äº‹ä»¶ã€‚</p><pre><code class=\"language-javascript\">window.addEventListener('error', handlerError, true)\n</code></pre><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šè¿°ä»£ç çš„ <code>error</code> äº‹ä»¶æ˜¯å…¨å±€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒèƒ½ç›‘å¬åˆ°å‰ç«¯é¡µé¢è¿è¡Œæ—¶æŠ¥é”™çš„äº‹ä»¶ï¼ŒåŒ…æ‹¬ <code>&lt;script&gt;</code> å’Œ <code>&lt;link&gt;</code> å¼•å…¥çš„JavaScriptå’ŒCSSæ–‡ä»¶ã€‚æˆ‘ä»¬ç»Ÿä¸€ç›‘å¬çš„ï¼Œæ˜¯JSå’ŒCSSæ–‡ä»¶ã€å›¾ç‰‡ä»¥åŠéŸ³è§†é¢‘ç­‰æœ€åŸºæœ¬çš„å‰ç«¯èµ„æºã€‚</p><p>å…·ä½“å®ç°çš„é€»è¾‘å¦‚ä¸‹ä»£ç ã€‚</p><pre><code class=\"language-javascript\">window.addEventListener('error', (event) =&gt; {\n  let target = event.target || event.srcElement;\n  let isResTarget = isResourceTarget(target as HTMLElement);\n  if (isResTarget) {\n\t// å¤„ç†å…¨é“¾è·¯å…³æ³¨çš„å‰ç«¯èµ„æº\n    saveResourceError(event)\n&nbsp; }\n})\n</code></pre><p>ä»ä¸Šè¿°ä»£ç å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæ–°çš„å‡½æ•° <code>isResourceTarget</code> ï¼Œå®ƒæ˜¯ä¸€ä¸ªå…ƒç´ è¿‡æ»¤å™¨ï¼Œå¯ä»¥ç­›é€‰å‰ç«¯é¡µé¢é‡ç‚¹å…³æ³¨çš„èµ„æºæ–‡ä»¶ã€‚å…·ä½“çš„å®ç°é€»è¾‘å‚è€ƒå¦‚ä¸‹ä»£ç ã€‚</p><pre><code class=\"language-javascript\">export const isResourceTarget = (target: HTMLElement) =&gt;\n&nbsp; target instanceof HTMLScriptElement ||\n&nbsp; target instanceof HTMLLinkElement ||\n&nbsp; target instanceof HTMLImageElement ||\n&nbsp; target instanceof HTMLVideoElement ||\n&nbsp; target instanceof HTMLAudioElement\n</code></pre><p>å½“ç„¶äº†ï¼Œ <code>isResourceTarget</code> å‡½æ•°åªåˆ¤æ–­åŒ¹é…äº†è„šæœ¬ã€é“¾æ¥ã€å›¾ç‰‡ã€éŸ³é¢‘å’Œè§†é¢‘è¿™5ç§å¸¸è§çš„å…ƒç´ èµ„æºã€‚å¦‚æœéœ€è¦ç›‘æ§æ›´å¤šçš„å‰ç«¯èµ„æºï¼Œä½ å¯ä»¥æ ¹æ®é¡¹ç›®çš„å®é™…æƒ…å†µæ‰©å±•è¯¥å‡½æ•°ã€‚</p><p>ç¬¬äºŒä¸ªå‡½æ•°æ˜¯ <code>saveResourceError</code> ã€‚åœ¨åŒ¹é…åˆ°é”™è¯¯çš„èµ„æºç±»å‹åï¼Œè¿™ä¸ªå‡½æ•°ä¼šæŠŠåŒ¹é…åˆ°çš„å†…å®¹è½¬æ¢æˆå…¨é“¾è·¯éœ€è¦çš„ä¿¡æ¯ï¼Œå¹¶å­˜å‚¨åˆ° <code>resources</code> æ•°ç»„å†…ã€‚å…·ä½“çš„å®ç°é€»è¾‘ä»£ç å‚è€ƒå¦‚ä¸‹ã€‚</p><pre><code class=\"language-javascript\">public saveError(event: ErrorEvent) {\n&nbsp; const target = event.target || event.srcElement;\n&nbsp; \n  const nodeName = (target as HTMLElement).nodeName\n&nbsp; \n  const url = (target as HTMLElement).getAttribute('src') || (target as HTMLElement).getAttribute('href')\n&nbsp; \n  const dataId = hashCode(`${nodeName}${event.message}${url}`)\n\n&nbsp; const traceDataResource: TraceDataResource = {\n&nbsp; &nbsp; dataId,\n&nbsp; &nbsp; name: 'resource-load-error',\n&nbsp; &nbsp; level: TraceDataSeverity.Error,\n&nbsp; &nbsp; message: event.message,\n&nbsp; &nbsp; time: getTimestamp(),\n&nbsp; &nbsp; type: TraceDataTypes.RESOURCE\n&nbsp; }\n&nbsp; this.resources.push(traceDataResource)\n}\n</code></pre><p>æœ‰ç‚¹ç»†å¿ƒçš„å‰ç«¯åŒå­¦ä¼šå‘ç°åœ¨ä¸Šè¿°ä»£ç é‡Œæœ‰2ä¸ªæœ‰è¶£çš„åœ°æ–¹ã€‚</p><p>ç¬¬ä¸€åœ°æ–¹æ˜¯ <code>dataId</code> çš„ç”Ÿæˆã€‚æˆ‘ä»¬å¸Œæœ›é€šè¿‡ä¸€äº›å…³é”®çš„ä¿¡æ¯ç»„åˆï¼Œå†é…åˆ <code>hashCode</code> çš„ç®—æ³•ï¼Œå¾—å‡ºä¸€ä¸²å­—ç¬¦ä¸²ã€‚</p><p>ä¸ºä»€ä¹ˆæ˜¯è¿™æ ·çš„ç®—æ³•é€»è¾‘å‘¢ï¼Ÿæˆ‘ä»¬è¯•æƒ³æƒ³ï¼Œå¦‚æœ <code>nodeName</code> ã€ <code>message</code> ä»¥åŠ <code>url</code> ä¸‰ä¸ªå­—æ®µå€¼éƒ½ç›¸åŒï¼Œé‚£æœ€ç»ˆçš„ <code>dataId</code> ä¸€å®šæ˜¯ç›¸åŒçš„ã€‚å‡è®¾åœ¨æŸä¸ªæ—¶é—´ï¼Œå…¨é“¾è·¯ç›‘æ§å‘ç°äº†å¤§é‡ç›¸åŒçš„ <code>dataId</code> ï¼Œé‚£æˆ‘ä»¬å°±æœ‰ç†ç”±ç›¸ä¿¡å‰ç«¯åº”ç”¨å‡ºç°äº†ä¸€äº›å…±æ€§çš„é—®é¢˜ï¼Œä¾‹å¦‚æŸä¸€å¼ å›¾ä¸€ç›´åŠ è½½å¤±è´¥ã€‚</p><p>ç¬¬äºŒä¸ªåœ°æ–¹æ˜¯æˆ‘ç”¨äº† <code>this.resources.push</code> å­˜å‚¨ä¸€ä»½é”™è¯¯çš„èµ„æºä¿¡æ¯ã€‚ä¸ºä»€ä¹ˆæ˜¯å­˜å‚¨è€Œä¸æ˜¯ç›´æ¥å‘èµ·ä¸ŠæŠ¥è¯·æ±‚å‘¢ï¼Ÿå› ä¸ºå¦‚æœå‡ºç°å¤§é‡çš„èµ„æºè®¿é—®å¼‚å¸¸ï¼Œé‚£ä¹ˆ <code>error</code> äº‹ä»¶å°±ä¼šæ•è·åˆ°å¤§é‡çš„é”™è¯¯èµ„æºï¼Œå¦‚æœæˆ‘ä»¬çš„å®ç°æ˜¯ç«‹åˆ»å‘èµ·ä¸€æ¬¡ä¸ŠæŠ¥è¡Œä¸ºï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½å‘ç”Ÿæ´ªæ°´èˆ¬çš„è¯·æ±‚ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚</p><p>æ€»å¾—æ¥è¯´ï¼Œæˆ‘ä»¬å®ç°å…¨é“¾è·¯çš„ç›®æ ‡å°±æ˜¯æŠŠæœ‰é—®é¢˜çš„èµ„æºæ”¶é›†å›æ¥ã€‚</p><h2>æ˜¯å¦å¯ä»¥å‘ç°åŠ è½½æ…¢çš„èµ„æºï¼Ÿ</h2><p>åœ¨å‰ç«¯å·¥ç¨‹é¡¹ç›®é‡Œï¼ŒJavaScriptæ˜¯è´Ÿè´£é¡µé¢åŠŸèƒ½å’Œäº¤äº’çš„ï¼ŒCSSæ˜¯è´Ÿè´£é¡µé¢å¸ƒå±€çš„ã€‚è¿™ä¸¤ç§èµ„æºåŠ è½½é€Ÿåº¦çš„å¿«æ…¢ï¼Œéƒ½ä¼šå½±å“åˆ°ç”¨æˆ·è®¿é—®å‰ç«¯é¡µé¢çš„é¦–å±åŠ è½½é€Ÿåº¦ã€‚</p><p>å¦å¤–ï¼Œæœ‰äº›å‰ç«¯é¡¹ç›®ç»è¿‡é•¿æœŸçš„éœ€æ±‚è¿­ä»£åï¼ŒJavaScriptæ–‡ä»¶çš„æ•°é‡è¶Šæ¥è¶Šå¤šï¼Œä½“ç§¯ä¼šè¶Šæ¥è¶Šå¤§ï¼ŒåŒæ ·ä¹Ÿä¼šè®©ç”¨æˆ·è®¿é—®é¡µé¢çš„åŠ è½½æ—¶é—´æ›´é•¿ã€‚</p><p>é‚£æ€æ ·åšæ‰èƒ½è·å–åˆ°å‰ç«¯èµ„æºçš„åŠ è½½è€—æ—¶å‘¢ï¼Ÿ</p><p>åœ¨WebæŠ€æœ¯æ ‡å‡†é‡Œï¼Œ<code>PerformanceObserver</code> å¯¹è±¡æ˜¯ä¸€ä¸ªæ€§èƒ½ç›‘æµ‹å¯¹è±¡ï¼Œå¯ä»¥ç”Ÿæˆä¸€ä¸ªè§‚å¯Ÿè€…å›è°ƒå‡½æ•°ï¼Œç„¶åä½¿ç”¨  <code>observe()</code>  æ–¹æ³•ç›‘è§†å®ä½“å¯¹è±¡ä¸º <code>resource</code> çš„èµ„æºï¼Œå¹¶è°ƒç”¨è¯¥è§‚å¯Ÿè€…çš„å›è°ƒå‡½æ•°ã€‚</p><p>å¥½äº†ï¼Œæˆ‘ä»¬ç°åœ¨å°±é€šè¿‡ <code>PerformanceObserver</code> å¯¹è±¡å®ç°å‰ç«¯èµ„æºåŠ è½½é€Ÿåº¦çš„å®æ—¶ç›‘å¬ã€‚</p><p>ç”±äºæˆ‘ä»¬çš„å…¨é“¾è·¯SDKæ˜¯åŸºäºClassç±»å°è£…ï¼Œæ‰€ä»¥é¦–å…ˆéœ€è¦åœ¨SDKçš„ä»£ç åŸºç¡€ä¸Šå¢åŠ  <code>PerformanceObserver</code> è§‚å¯Ÿè€…å¯¹è±¡ï¼Œå…·ä½“å®ç°ä»£ç é€»è¾‘å¦‚ä¸‹ã€‚</p><pre><code class=\"language-typescript\">export class BaseTrace implements BaseTraceInterface {\n\n  public observer = null\n\n  public constructor(options: TraceOptions) {\n    // å¿½ç•¥å…¶å®ƒä¸šåŠ¡é€»è¾‘\n    \n    this.observer = new PerformanceObserver((list, observer) =&gt; {\n      list.getEntries().forEach((entry) =&gt; {\n        if (entry.entryType === 'resource') {\n          this.handleObserverResource(entry as PerformanceResourceTiming)\n        }\n      });\n    });\n  }\n}\n</code></pre><p>åœ¨ä¸Šè¿°ä»£ç é‡Œï¼Œæˆ‘ä»¬åœ¨BaseTraceç±»çš„æ„é€ å‡½æ•°ä¸­åˆ›å»ºäº†è§‚å¯Ÿè€…å‡½æ•°ï¼Œå¹¶åœ¨å›è°ƒå‡½æ•°å†…åˆ¤æ–­ã€‚å¦‚æœå½“å‰å®ä½“èµ„æºæ˜¯resourceç±»å‹ï¼Œé‚£å°±è¦è¿›å…¥ <code>handleObserverResource</code> å‡½æ•°å¤„ç†é€»è¾‘ã€‚</p><p>æ¥ç€è¯´è¯´ <code>handleObserverResource</code> å‡½æ•°å†…éƒ¨ã€‚é¦–å…ˆæ˜¯é€šè¿‡å®ä½“èµ„æºå¯¹è±¡çš„durationå±æ€§å€¼åˆ¤æ–­è€—æ—¶æ—¶é•¿ã€‚æˆ‘ä»¬è®¾å®šäº†æ¯ä¸ªèµ„æºåŠ è½½æ—¶é•¿è¶…è¿‡1ç§’æ—¶ï¼Œå°±ä¼šä¸ŠæŠ¥å…¨é“¾è·¯ç›‘æ§ã€‚å…·ä½“çš„å®ç°é€»è¾‘å¦‚ä¸‹ä»£ç ã€‚</p><pre><code class=\"language-typescript\">export class BaseTrace implements BaseTraceInterface {\n  \n  public resources: TraceDataResource[] = []\n  public observer = null\n\n  public handleObserverResource(entry: PerformanceResourceTiming) {\n    if (entry.entryType === 'resource') {\n      let level = TraceDataSeverity.Info\n      if (entry.duration &gt; 1000 &amp;&amp; entry.duration &lt; 1500) {\n        level = TraceDataSeverity.Warning\n      } else  if (entry.duration &gt; 1500) {\n        level = TraceDataSeverity.Error\n      }\n      entry.duration &gt; 1000 &amp;&amp; this.resources.push({\n        url: entry.name,\n        name: `${entry.entryType}-duration-${entry.initiatorType}`,\n        type: TraceDataTypes.PERF,\n        level,\n        message: `duration:${Math.round(entry.duration)}`,\n        time: getTimestamp(),\n        dataId: hashCode(`${entry.entryType}-${entry.name}`),\n      })\n    }\n  }\n}\n</code></pre><p>æˆ‘ä»¬æ˜¯é€šè¿‡ <code>entry.duration</code> å±æ€§å€¼å¾—åˆ°çš„æ—¶é—´ï¼Œä»¥1000æ¯«ç§’è‡³1500æ¯«ç§’ä¹‹é—´å’Œè¶…è¿‡1500æ¯«ç§’ä¸¤ç§æƒ…å†µæ¥åˆ¤æ–­èµ„æºæ€§èƒ½é—®é¢˜çš„ä¸¥é‡çº§åˆ«ã€‚å¦‚æœå‘½ä¸­äº†æˆ‘ä»¬é¢„è®¾çš„æ€§èƒ½é—®é¢˜ï¼Œå°±æŠŠç›¸å…³å®ä½“èµ„æºè®°å½•åˆ° <code>resources</code> å±æ€§å†…ã€‚</p><p>æœ€åï¼Œåœ¨SDKåˆå§‹åŒ–åï¼Œå†è°ƒç”¨ <code>observe()</code> æ¥è§¦å‘resourceèµ„æºçš„ç›‘æ§äº‹ä»¶ã€‚å…·ä½“çš„å®ç°ä»£ç å¦‚ä¸‹ã€‚</p><pre><code class=\"language-typescript\">export class BaseTrace implements BaseTraceInterface {\n\n&nbsp; public observer = null\n\n&nbsp; public constructor(options: TraceOptions) {\n&nbsp; &nbsp; // å¿½ç•¥å…¶å®ƒä¸šåŠ¡é€»è¾‘\n&nbsp; }\n\n  public static init(options: TraceOptions): BaseTrace {\n    const traceSdk = new BaseTrace(options)\n    \n    traceSdk.observer.observe({\n      entryTypes: [\"resource\"],\n    });\n    \n    // å¿½ç•¥éƒ¨åˆ†é€»è¾‘\n    window.traceSdk = traceSdk\n    return traceSdk\n  }\n}\n</code></pre><p>å°±è¿™æ ·ï¼Œæˆ‘ä»¬å®Œæ•´åœ°å®ç°äº†ç›‘å¬è€—æ—¶è¾ƒé•¿çš„å‰ç«¯èµ„æºçš„é€»è¾‘ã€‚</p><p>å®é™…ä¸Šï¼Œå‰ç«¯èµ„æºåŠ è½½é€Ÿåº¦çš„å¿«æ…¢ï¼Œåœ¨ç½‘é¡µæŒ‡æ ‡é‡Œçš„FCPå’ŒLCPé‡Œéƒ½èƒ½å¤Ÿä½“ç°å‡ºæ¥ã€‚ä½†è¿™é‡Œçš„å®ç°æ–¹æ¡ˆï¼Œå°±æ˜¯ç»†åŒ–FCPå’ŒLCPé‡Œé¢çš„èµ„æºåŠ è½½éƒ¨åˆ†çš„æ—¶é—´ç»†èŠ‚ï¼Œé€šè¿‡èµ„æºåŠ è½½æ—¶é—´ï¼Œæˆ‘ä»¬èƒ½å¾ˆè½»æ¾åœ°åˆ¤æ–­FCPå’ŒLCPä¼˜åŒ–çš„æ–¹å‘ã€‚</p><p>æˆ‘ä»¬å†æ¬¡å¼ºè°ƒä¸€ç‚¹ï¼Œåœ¨å‰ç«¯å…¨é“¾è·¯çš„ç›‘æ§ç»´åº¦é‡Œï¼ŒJavaScriptå’ŒCSSæ˜¯ç”¨æˆ·ä½“éªŒæœ€é‡è¦çš„æ ¸å¿ƒèµ„æºï¼Œå¿…é¡»é‡ç‚¹å…³æ³¨å®ƒä»¬çš„åŠ è½½æˆåŠŸç‡å’Œæ€§èƒ½ã€‚</p><h2>å¦‚ä½•æœ‰æ•ˆç›‘å¬è„šæœ¬å¼‚å¸¸</h2><p>åªè¦å­¦è¿‡å‰ç«¯æŠ€æœ¯çš„åŒå­¦éƒ½çŸ¥é“ï¼ŒJavaScriptæ˜¯ä¸€é—¨å¼±ç±»å‹çš„è¯­è¨€ï¼Œæ— è®ºæˆ‘ä»¬æŠŠä»£ç å†™å¾—å¦‚ä½•å®Œç¾ï¼Œéƒ½è‚¯å®šå­˜åœ¨ç€è¿è¡ŒæŠ¥é”™çš„é—®é¢˜ã€‚</p><p>é‚£ä¹ˆï¼Œåœ¨å‰ç«¯å…¨é“¾è·¯çš„è®¾è®¡é‡Œï¼Œåº”è¯¥å¦‚ä½•æŠŠè„šæœ¬é”™è¯¯å’Œå…¨é“¾è·¯ç»“åˆèµ·æ¥å‘¢ï¼Ÿæˆ‘ä»¬ä»¥å‰é¢è¯¾ç¨‹å·²å®ç°çš„ä»£ç ä½œä¸ºåŸºç¡€è¿›è¡Œé€‚é…æ”¹é€ ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨å…¨å±€ç›‘å¬ <code>error</code> äº‹ä»¶çš„ç›´æ¥è°ƒç”¨ <code>saveError</code> å‡½æ•°ï¼Œä¸å†åˆ¤æ–­æ˜¯å¦å‰ç«¯èµ„æºã€‚ä¾‹å¦‚ä¸‹é¢ä»£ç ã€‚</p><pre><code class=\"language-javascript\">public onGlobalError() {\n  const _t = this\n&nbsp; window.addEventListener('error', (event) =&gt; {\n&nbsp; &nbsp; _t.saveError(event)\n&nbsp; })\n}\n</code></pre><p>æ¥ç€ï¼ŒæŠŠæ˜¯å¦å‰ç«¯èµ„æºçš„åˆ¤æ–­é€»è¾‘æ”¾åœ¨ <code>saveError</code> å‡½æ•°å†…ã€‚</p><pre><code class=\"language-javascript\">public saveError(event: ErrorEvent) {\n  const target = event.target || event.srcElement;\n  const isResTarget = isResourceTarget(target as HTMLElement);\n  const nodeName = (target as HTMLElement).nodeName\n\n  if (!isResTarget) {\n    const traceData: TraceTypeData = {\n      dataId: 0,\n      name: 'script-error',\n      level: TraceDataSeverity.Error,\n      message: event.message,\n      time: getTimestamp(),\n      type: TraceDataTypes.JAVASCRIPT,\n      stack: event.error.stack\n    }\n    this.resources.push(traceData)\n  } else {\n    const url = (target as HTMLElement).getAttribute('src') || (target as HTMLElement).getAttribute('href')\n    const traceData: TraceTypeData = {\n      dataId: hashCode(`${nodeName}${event.message}${url}`),\n      name: 'resource-load-error',\n      level: TraceDataSeverity.Warning,\n      message: event.message,\n      time: getTimestamp(),\n      type: TraceDataTypes.RESOURCE,\n      stack: null\n    }\n    this.resources.push(traceData)\n  }\n}\n</code></pre><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦æŠŠ <code>isResourceTarget</code> çš„åˆ¤æ–­æ”¾åœ¨ <code>saveError</code> å†…å‘¢ï¼Ÿä¸»è¦åŸå› æœ‰2ä¸ªã€‚ç¬¬ä¸€ï¼Œæ— è®ºèµ„æºåŠ è½½å¤±è´¥è¿˜æ˜¯è„šæœ¬å¤±è´¥ï¼Œéƒ½ä¼šè§¦å‘å…¨å±€ <code>error</code> äº‹ä»¶ã€‚ç¬¬äºŒï¼Œç”±äºæˆ‘ä»¬å·²ç»è®¾è®¡å¥½å…¨é“¾è·¯çš„æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥æ— è®ºæ˜¯å“ªç§é”™è¯¯ï¼Œæ•°æ®å­—æ®µå’Œå†…å®¹å‡ ä¹æ²¡æœ‰å·®å¼‚ã€‚</p><p>å› æ­¤ï¼Œ <code>saveError</code> å‡½æ•°æ˜¯å¯ä»¥å½“ä½œä¸€ä¸ªé€šç”¨errorä¿¡æ¯å­˜å‚¨å™¨ã€‚</p><p>å¥½äº†ï¼Œç»è¿‡ <code>isResTarget</code> å­—æ®µåˆ¤æ–­æ˜¯å¦ä¸ºå‰ç«¯èµ„æºåï¼Œæˆ‘ä»¬å°±å¯ä»¥å†åˆ›å»ºä¸€ä»½é”™è¯¯ä¿¡æ¯å¯¹è±¡ã€‚</p><p>ç”±äºæœ¬èŠ‚è¯¾æˆ‘ä»¬åªé‡ç‚¹å­¦ä¹ å‰ç«¯èµ„æºå’Œè„šæœ¬é”™è¯¯ä¸¤ç§é”™è¯¯äº‹ä»¶ï¼Œæ‰€ä»¥ï¼Œå¯¹äºé“¾è·¯æ—¥å¿—ä¸­çš„ <code>name</code> ã€ <code>level</code> ã€ <code>type</code> ä¸‰ä¸ªå­—æ®µï¼Œæˆ‘ä¼šæ ¹æ®å®é™…çš„æƒ…å†µé‡‡ç”¨ä¸åŒçš„å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå½“å‰æ˜¯å‰ç«¯èµ„æºï¼Œ <code>name</code> å°±ç”¨ <code>resource-load-error</code> å›ºå®šå€¼ï¼Œ <code>level</code> å°±ä½¿ç”¨è­¦å‘Š <code>Warning</code> ï¼Œ <code>type</code> å±æ€§é‡‡ç”¨èµ„æº <code>RESOURCE</code>   ã€‚</p><h3>Vueçš„ç‰¹æ®Šæ€§</h3><p>å¦å¤–ï¼Œç°åœ¨å¾ˆå¤šå‰ç«¯é¡¹ç›®éƒ½æ˜¯åŸºäºVueæŠ€æœ¯æ ˆæ„å»ºçš„ï¼Œé™¤äº†JavaScriptçš„å…¨å±€erroräº‹ä»¶ï¼ŒVueæ¡†æ¶ä¹Ÿæä¾›äº†Vueç»„ä»¶å†…éƒ¨å¼‚å¸¸æ•è·çš„å…¨å±€äº‹ä»¶errorHandlerã€‚</p><p>errorHandleräº‹ä»¶å®˜æ–¹çš„å®šä¹‰æ˜¯ï¼Œä¸ºåº”ç”¨å†…æŠ›å‡ºçš„æœªæ•è·é”™è¯¯æŒ‡å®šä¸€ä¸ªå…¨å±€å¤„ç†å‡½æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒVueåº”ç”¨ç»„ä»¶å†…å¦‚æœå‡ºè¡Œè¿è¡Œæ—¶é”™è¯¯çš„é€»è¾‘ï¼Œåˆæ²¡åšæ•è·å¤„ç†ï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘errorHandleräº‹ä»¶ã€‚</p><p>æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨Vueè¿™ç±»æ¡†æ¶åšé¡¹ç›®æ—¶ï¼Œä¸ºäº†ç¡®ä¿è¦†ç›–æ›´å®Œæ•´çš„ä¸šåŠ¡é“¾è·¯å’Œé”™è¯¯é—®é¢˜ï¼Œè¿˜éœ€è¦åœ¨è¯¥äº‹ä»¶ä¸‹è®°å½•å…¨é“¾è·¯çš„ç›¸å…³æ—¥å¿—ã€‚å‚è€ƒä»£ç å¦‚ä¸‹ã€‚</p><pre><code class=\"language-javascript\">app.config.errorHandler = (err, instance, info) =&gt; {\n&nbsp; // å¤„ç†é”™è¯¯ï¼Œä¾‹å¦‚ï¼šæŠ¥å‘Šç»™ä¸€ä¸ªæœåŠ¡\n&nbsp; const dataId = hashCode(`${err.name}${event.message}${url}`)&nbsp;&nbsp;\n&nbsp; const traceTypeData = {\n&nbsp; &nbsp; dataId,\n&nbsp; &nbsp; name: 'Vue-error',\n&nbsp; &nbsp; level: TraceDataSeverity.Warning,\n&nbsp; &nbsp; message: `${event.toString()}(${info})`,\n&nbsp; &nbsp; time: getTimestamp(),\n&nbsp; &nbsp; type: TraceDataTypes.VUE,\n&nbsp; &nbsp; stack: err.stack\n&nbsp; }\n}\n</code></pre><h2>æ€»ç»“</h2><p>å‰ç«¯èµ„æºæ˜¯Webåº”ç”¨çš„é‡è¦èµ„äº§ï¼Œå› ä¸ºæœ‰äº†å®ƒä»¬ï¼ŒWebæ‰èƒ½ç»™ç”¨æˆ·æä¾›å®Œæ•´çš„WebåŠŸèƒ½ã€‚</p><p>åœ¨å‰ç«¯å…¨é“¾è·¯çš„ç›‘æ§èŒƒå›´é‡Œï¼Œå…¨é“¾è·¯åº”è¯¥é‡ç‚¹å…³å¿ƒæœ‰3ç§èµ„æºç±»çš„é€šç”¨é—®é¢˜ã€‚å®ƒä»¬åˆ†åˆ«æ˜¯èµ„æºæ–‡ä»¶åŠ è½½çŠ¶æ€ã€èµ„æºå“åº”æ—¶é•¿ä»¥åŠè„šæœ¬è¿è¡Œæ—¶æŠ¥é”™ã€‚</p><p>å½“ç„¶äº†ï¼Œè¿™3ç§äº‹ä»¶éƒ½æ˜¯æœ€å¸¸è§çš„é—®é¢˜ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¿˜ä¸æ­¢è¿™äº›ã€‚ä¾‹å¦‚ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡æ˜¯å¦æˆåŠŸï¼ŸéŸ³è§†é¢‘æ˜¯å¦èƒ½æ’­æ”¾ï¼Ÿé¡µé¢è¡¨å•èƒ½å¦æŒ‰æ­£å¸¸æµç¨‹æäº¤ç­‰ç­‰ã€‚</p><p>å‰ç«¯é¡µé¢çš„æ¯ä¸€æ­¥äº¤äº’åŠ¨ä½œï¼Œéƒ½ä¼šç»™ç”¨æˆ·å¸¦æ¥æœ€çœŸå®çš„æ„Ÿå—ã€‚æŠŠæœ€åŸºç¡€çš„å‰ç«¯èµ„æºåŠ è½½çš„ç¨³å®šæ€§ã€èµ„æºçš„åŠ è½½é€Ÿåº¦ä»¥åŠä¸šåŠ¡é€»è¾‘çš„å…¼å®¹æ€§åšåˆ°æè‡´ï¼Œæ˜¯æ¯ä¸€ä¸ªå‰ç«¯åŒå­¦éœ€è¦æé«˜çš„æŠ€èƒ½ã€‚</p><p>ä¸‹èŠ‚è¯¾ï¼Œæˆ‘ä»¬ä¼šå­¦ä¹ å¦å¤–ä¸€ç§ç‰¹æ®Šæ—¥å¿—ï¼Œè¡Œä¸ºæ—¥å¿—ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>åœ¨è¿™èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬ä¸€å…±å­¦ä¹ äº†ç›‘å¬ä¸‰ç§é€šç”¨æ€§é—®é¢˜çš„å®ç°æ–¹æ³•ã€‚é‚£ä¹ˆé™¤äº†è¿™äº›é€šç”¨é—®é¢˜ï¼Œä¸å¦¨æ€è€ƒä¸€ä¸‹ï¼Œåœ¨ä½ è´Ÿè´£çš„å‰ç«¯é¡¹ç›®é‡Œï¼Œè¿˜æœ‰å“ªäº›éœ€è¦æˆ‘ä»¬é‡ç‚¹å…³æ³¨çš„èµ„æºç±»é—®é¢˜ï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºå’Œæˆ‘äº¤æµã€‚å¦‚æœè§‰å¾—æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿå¯ä»¥æŠŠè¯¾ç¨‹åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·å­¦ä¹ ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ï¼</p>","neighbors":{"left":{"article_title":"09ï½œæ¥å£æŒ‡æ ‡ï¼šç›‘å¬æ¥å£çŠ¶æ€ï¼Œæ”¶é›†é¡µé¢æ¥å£å¼‚å¸¸æ•°æ®","id":771719},"right":{"article_title":"11ï½œç”¨æˆ·è¡Œä¸ºæŒ‡æ ‡ï¼šå¦‚ä½•æœ‰æ•ˆç›‘å¬ç”¨æˆ·äº¤äº’è¡Œä¸ºï¼Ÿ","id":772186}},"comments":[{"had_liked":false,"id":392577,"user_name":"è‹æœæœ","can_delete":false,"product_type":"c1","uid":2852467,"ip_address":"åŒ—äº¬","ucode":"12A62ED032F345","user_header":"https://static001.geekbang.org/account/avatar/00/2b/86/73/5190bbde.jpg","comment_is_top":true,"comment_ctime":1721270734,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100759401,"comment_content":"å®Œæ•´æºç å…¥å£ï¼š\nhttps:&#47;&#47;github.com&#47;sankyutang&#47;fontend-trace-geekbang-course","like_count":0},{"had_liked":false,"id":390432,"user_name":"ç‰¹ä¼¦é…¥","can_delete":false,"product_type":"c1","uid":2882267,"ip_address":"æµ™æ±Ÿ","ucode":"4D9F000D504F83","user_header":"https://static001.geekbang.org/account/avatar/00/2b/fa/db/8c1fc63b.jpg","comment_is_top":false,"comment_ctime":1715326976,"is_pvip":false,"replies":[{"id":142582,"content":"ä»£ç å·²å‘å¸ƒã€‚é“¾æ¥å¦‚ä¸‹ï¼š\nhttps:&#47;&#47;github.com&#47;sankyutang&#47;fontend-trace-geekbang-course","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":1327155,"ctime":1720406232,"ip_address":"å¹¿ä¸œ","comment_id":390432,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100759401,"comment_content":"è¯·é—®è€å¸ˆï¼Œè¯¾ç¨‹ä¸­çš„ç¤ºä¾‹ä»£ç ä»“åº“åœ¨å“ªé‡Œå‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1327155,"avatar":"https://static001.geekbang.org/account/avatar/00/14/40/33/11e434ba.jpg","nickname":"ä¸‰æ©‹sankyu ğŸ©","note":"","ucode":"2129405EA8D3D7","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":647662,"discussion_content":"ä»£ç å·²å‘å¸ƒã€‚é“¾æ¥å¦‚ä¸‹ï¼š\nhttps://github.com/sankyutang/fontend-trace-geekbang-course","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1720406232,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":390617,"user_name":"å‘ä¸œæ˜¯å¤§æµ·","can_delete":false,"product_type":"c1","uid":2046992,"ip_address":"å¹¿ä¸œ","ucode":"A9FE1049D0D144","user_header":"https://static001.geekbang.org/account/avatar/00/1f/3c/10/61efe672.jpg","comment_is_top":false,"comment_ctime":1715779083,"is_pvip":false,"replies":[{"id":142666,"content":"æ˜¯è‡ªå®šä¹‰çš„ã€‚åˆå¹¶ä¸‰ä¸ªå­—æ®µå†…å®¹å¹¶è½¬ç ï¼Œç›®çš„æ˜¯å‡†ç¡®ç”ŸæˆåŒä¸€ä¸ªé—®é¢˜éƒ½èƒ½ç”Ÿæˆç›¸åŒdataIdã€‚\ndataIdç”Ÿæˆé€»è¾‘ç®—æ³•å¹¶éå”¯ä¸€ã€‚dataIdæ˜¯ç”¨äºç¡®è®¤åŒä¸€ä¸ªé—®é¢˜ï¼Œä¾‹å¦‚100ä¸ªç”¨æˆ·è®¿é—®è¯»å–ä¸ªäººä¿¡æ¯æ¥å£ï¼Œå¦‚æœæ¥å£å‡ºç°å¼‚å¸¸ï¼Œé‚£ä¹ˆ100ä¸ªç”¨æˆ·100æ¬¡è¯·æ±‚ï¼ŒdataIdæ˜¯ç›¸åŒçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1327155,"ctime":1721205162,"ip_address":"å¹¿ä¸œ","comment_id":390617,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100759401,"comment_content":"è€å¸ˆï¼Œconst dataId = hashCode(`${err.name}${event.message}${url}`) ã€‚è¿™é‡Œçš„ hashCode() æ˜¯è‡ªå®šä¹‰å‡½æ•°å—ï¼Ÿæ˜¯æ€ä¹ˆçš„ç®—æ³•ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1327155,"avatar":"https://static001.geekbang.org/account/avatar/00/14/40/33/11e434ba.jpg","nickname":"ä¸‰æ©‹sankyu ğŸ©","note":"","ucode":"2129405EA8D3D7","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":648202,"discussion_content":"æ˜¯è‡ªå®šä¹‰çš„ã€‚åˆå¹¶ä¸‰ä¸ªå­—æ®µå†…å®¹å¹¶è½¬ç ï¼Œç›®çš„æ˜¯å‡†ç¡®ç”ŸæˆåŒä¸€ä¸ªé—®é¢˜éƒ½èƒ½ç”Ÿæˆç›¸åŒdataIdã€‚\ndataIdç”Ÿæˆé€»è¾‘ç®—æ³•å¹¶éå”¯ä¸€ã€‚dataIdæ˜¯ç”¨äºç¡®è®¤åŒä¸€ä¸ªé—®é¢˜ï¼Œä¾‹å¦‚100ä¸ªç”¨æˆ·è®¿é—®è¯»å–ä¸ªäººä¿¡æ¯æ¥å£ï¼Œå¦‚æœæ¥å£å‡ºç°å¼‚å¸¸ï¼Œé‚£ä¹ˆ100ä¸ªç”¨æˆ·100æ¬¡è¯·æ±‚ï¼ŒdataIdæ˜¯ç›¸åŒçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1721205163,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]}]}