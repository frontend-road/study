{"id":447503,"title":"18 | 图像分类（下）：如何构建一个图像分类模型?","content":"<p>你好，我是方远。欢迎来到第18节课的学习。</p><p>我相信经过上节课的学习，你已经了解了图像分类的原理，还初步认识了一些经典的卷积神经网络。</p><p>正所谓“纸上得来终觉浅，绝知此事要躬行”，今天就让我们把上节课的理论知识应用起来，一起从数据的准备、模型训练以及模型评估，从头至尾一起来完成一个完整的图像分类项目实践。</p><p>课程代码你可以从<a href=\"https://github.com/syuu1987/geekTime-image-classification\">这里</a>下载。</p><h2>问题回顾</h2><p>我们先来回顾一下问题背景，我们要解决的问题是，在众多图片中自动识别出极客时间Logo的图片。想要实现自动识别，首先需要分析数据集里的图片是啥样子的。</p><p>那我们先来看一张包含极客时间Logo的图片，如下所示。</p><p><img src=\"https://static001.geekbang.org/resource/image/1d/2c/1d221d4d170c54625dc8d124bcc6df2c.jpeg?wh=1242x2209\" alt=\"图片\"></p><p>你可以看到，Logo占整张图片的比例还是比较小的，所以说，如果这个项目是真实存在的，目标检测其实更加合适。不过，我们可以将问题稍微修改一下，修改成自动识别极客时间宣传海报，这其实就很适合图像分类任务了。</p><h2>数据准备</h2><p>相比目标检测与图像分割来说，图像分类的数据准备还是比较简单的。在图像分类中，我们只需要将每个类别的图片放到指定的文件夹里就行了。</p><p>下图是我的图片组织方式，文件夹就是图片所属的类别。</p><p><img src=\"https://static001.geekbang.org/resource/image/cf/8e/cf664db8d071979583a7cec69a45168e.png?wh=922x334\" alt=\"图片\"></p><p>logo文件夹中存放的是10张极客时间海报的图片。</p><p><img src=\"https://static001.geekbang.org/resource/image/46/27/460af80104ec4550ff1b745a1f9f6627.png?wh=1516x704\" alt=\"图片\"></p><p>而others中，理论上应该是各种其它类型的图片，但这里为了简化问题，我这个文件夹中存放的都是小猫的图片。</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/e6/b0/e6275aac026ce5d626c1e6ebb1fde9b0.png?wh=1494x480\" alt=\"图片\"></p><h2>模型训练</h2><p>好啦，数据准备就绪，我们现在进入模型训练阶段。</p><p>今天我想向你介绍一个在最近2年非常受欢迎的一个网络——EfficientNet。它为我们提供了B0～B7，一共8个不同版本的模型，这8个版本有着不同的参数量，在同等参数量的模型中，它的精度都是首屈一指的。因此，这8个版本的模型可以解决你的大多数问题。</p><h3>EfficientNet</h3><p>我先给你解读一下<a href=\"https://arxiv.org/pdf/1905.11946.pdf\">EfficientNet</a>的这篇论文，这里我着重分享论文的核心思路还有我的理解，学有余力的同学可以在课后自行阅读原文。</p><p>EfficientNet一共有B0到B7，8个模型，参数量由少到多，精度也越来越高，具体你可以看看后面的评价指标。</p><p>在之前的那些网络，要么从网络的深度出发，要么从网络的宽度出发来优化网络的性能，但从来没有人将这些方向结合在一起考虑。<strong>而EfficientNet就做了这样的尝试，它探索了网络深度、网络宽度、图像分辨率之间的最优组合</strong>。</p><p>EfficientNet利用一种复合的缩放手段，对网络的深度depth、宽度width和分辨率resolution同时进行缩放（按照一定的缩放规律），来达到精度和运算复杂度FLOPS的权衡。</p><p>但即使只探索这三个维度，搜索空间仍然很大，所以作者规定只在B0（作者提出的EfficientNet的一个Baseline）上进行放大。</p><p>首先，作者比较了单独放大这三个维度中的任意一个维度效果如何。得出结论是放大网络深度或网络宽度或图像分辨率，均可提升模型精度，但是越放大，精度增加越缓慢，如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/7f/64/7ff4750599323623bb148ed8b2222b64.png?wh=1920x591\" alt=\"图片\"></p><p>然后，作者做了第二个实验，尝试在不同的r（分辨率），d（深度）组合下变动w（宽度），得到下图：</p><p><img src=\"https://static001.geekbang.org/resource/image/de/46/dec67f3868ddcc44e503yy13a09c1e46.png?wh=1734x1310\" alt=\"图片\"></p><p>结论是，得到更高的精度以及效率的关键是平衡网络宽度，网络深度，图像分辨率三个维度的缩放倍率(d, r, w)。</p><p>因此，作者提出了混合维度放大法，该方法使用一个$\\phi$（混合稀疏）来决定三个维度的放大倍率。</p><p>深度depth：$d = \\alpha ^{\\phi}$</p><p>宽度width：$w = \\beta ^{\\phi}$</p><p>分辨率resolution: $r = \\gamma ^{\\phi}$</p><p>$$s.t. \\space \\alpha\\cdot\\beta^2\\cdot\\gamma^2 \\approx2 \\space \\space \\alpha \\geq1,\\beta \\geq1,\\gamma \\geq1$$</p><p>第一步，固定$\\phi$为1，也就是计算量为2倍，使用网格搜索，得到了最佳的组合，也就是$\\alpha=1.2, \\beta = 1.1, \\gamma = 1.15$。</p><p>第二步，固定$\\alpha=1.2, \\beta = 1.1, \\gamma = 1.15$，使用不同的混合稀疏$\\phi$，得到了B1~B7。</p><p>整体评估效果如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/03/14/037cd03be0995f97caa71ba079078814.png?wh=1682x1324\" alt=\"图片\"></p><p>从评估结果上可以看到，EfficientNet的各个版本均超过了之前的一些经典卷积神经网络。</p><p>EfficientNet v2也已经被提出来了，有时间的话你可以自己去看看。</p><p>我们不妨借助一下EfficientNet的<a href=\"https://github.com/lukemelas/EfficientNet-PyTorch\">GitHub</a>，它里面有训练ImageNet的demo(demo/imagenet/main.py)，接下来我们一起看看它的核心代码，然后精简一下代码，把它运行起来(Torchvision也提供了EfficientNet的模型，课后你也可以自己试一试)。</p><p>这里我们再回顾一下，之前说的机器学习3件套：</p><p>1.数据处理<br>\n2.模型训练（构建模型、损失函数与优化方法）<br>\n3.模型评估</p><p>接下来我们就挨个看看这些步骤。你需要先把<a href=\"https://github.com/lukemelas/EfficientNet-PyTorch\">https://github.com/lukemelas/EfficientNet-PyTorch</a>给克隆下来，我们只使用efficientnet_pytorch中的内容，它包含着模型的网络结构。</p><p>之后我们来创建一个叫做geektime的项目文件夹，然后把efficientnet_pytorch放进去。</p><p>在开始之前，我先把程序需要的参数给你列一下，在下面的讲解中，我们就直接使用这些参数了。当你在实现今天代码的时候，需要将这些参数补充到代码中（可以使用argparsem模块）。</p><p><img src=\"https://static001.geekbang.org/resource/image/df/7a/df24d6aa865b645f1d2aa50716e7d17a.jpg?wh=1739x1027\" alt=\"图片\"></p><p>好，下面让我们正式开始动手。</p><h3>加载数据</h3><p>首先是数据加载的环节，我们创建一个dataset.py文件，用来存储与数据有关的内容。dataset.py如下（我省略了模块的引入）。</p><pre><code class=\"language-python\">\n# 作者给出的标准化方法\ndef _norm_advprop(img):\n&nbsp; &nbsp; return img * 2.0 - 1.0\n\ndef build_transform(dest_image_size):\n&nbsp; &nbsp; normalize = transforms.Lambda(_norm_advprop)\n\n&nbsp; &nbsp; if not isinstance(dest_image_size, tuple):\n&nbsp; &nbsp; &nbsp; &nbsp; dest_image_size = (dest_image_size, dest_image_size)\n&nbsp; &nbsp; else:\n&nbsp; &nbsp; &nbsp; &nbsp; dest_image_size = dest_image_size\n\n&nbsp; &nbsp; transform = transforms.Compose([\n&nbsp; &nbsp; &nbsp; &nbsp; transforms.RandomResizedCrop(dest_image_size),\n&nbsp; &nbsp; &nbsp; &nbsp; transforms.RandomHorizontalFlip(),\n&nbsp; &nbsp; &nbsp; &nbsp; transforms.ToTensor(),\n&nbsp; &nbsp; &nbsp; &nbsp; normalize\n&nbsp; &nbsp; ])\n\n&nbsp; &nbsp; return transform\n\ndef build_data_set(dest_image_size, data):\n&nbsp; &nbsp; transform = build_transform(dest_image_size)&nbsp;\n&nbsp; &nbsp; dataset=datasets.ImageFolder(data, transform=transform, target_transform=None)&nbsp;\n\n&nbsp; &nbsp; return dataset\n\n</code></pre><p>这部分代码完成的工作是，通过build_data_set构建数据集。这里我们使用了torchvision.datasets.ImageFolder来创建Dataset。ImageFolder能将按文件夹形式的组织数据生成到一个Dataset。</p><p>在这个例子中，我传入的训练集路径为’./data/train’，你可以看看开篇的截图。</p><p>ImageFolder会自动的将同一文件夹内的数据打上一个标签，也就是说logo文件夹的数据，ImageFolder会认为是来自同一类别，others文件夹的数据，ImageFolder会认为是来自另外一个类别。</p><p>我们这个精简版只构建了训练集的Dataset，当你看Efficient官方代码的时候，在验证集的构建过程中，你需要留意一下验证集的<a href=\"https://github.com/lukemelas/EfficientNet-PyTorch/blob/master/examples/imagenet/main.py#L240-L245\">transforms</a>。</p><p>我认为，这里这么做是有点问题的，原因是Resize中size参数如果是个tuple类型，则直接按照size的尺寸进行resize。如果是一个int的时候，如果图片的height大于width，则按照(size * height/width, size)进行resize。</p><p>在作者的原始程序中，imag_size是个int，而不是tuple。所以按照这种先resize再crop的方式处理一下，对长宽比比较大的图片来说，效果不是很好。</p><p>让我们实际验证一下这个想法，我将开篇的例子（也就是那张海报图）的image_size设定为224后，用上述的方式进行处理后，获得下图。</p><p><img src=\"https://static001.geekbang.org/resource/image/a9/e2/a93417ee476234249d0e69fb5c5f04e2.jpg?wh=224x224\" alt=\"图片\"></p><p>你看，是不是缺少了很多信息？</p><p>所以，如果在我们的例子中使用作者的程序，就需要做一下修改。把这里的代码逻辑修改为如果image_size不是tuple，先将image_size转换为tuple，并且也不需要crop了。代码如下所示：</p><pre><code class=\"language-python\">if not isinstance(image_size, tuple):\n&nbsp; &nbsp; image_size = (image_size, image_size)\nelse:\n&nbsp; &nbsp; image_size = image_size\n\ntransform = transforms.Compose([\n&nbsp; &nbsp; transforms.Resize(image_size, interpolation=Image.BICUBIC),\n&nbsp; &nbsp; transforms.ToTensor(),\n&nbsp; &nbsp; normalize,\n])\n</code></pre><p>训练的主程序我们定义在main.py中，在main.py中的main()中，进行数据的加载，如下所示。</p><p>然后，我们通过for循环一个一个Epoch的调用train方法进行训练就可以了。</p><pre><code class=\"language-python\"># 省略了一些模块的引入\nfrom efficientnet import EfficientNet\nfrom dataset import build_data_set\n\ndef main():\n    # part1: 模型加载 (稍后补充)\n    # part2: 损失函数、优化方法(稍后补充)&nbsp; &nbsp; \n    train_dataset = build_data_set(args.image_size, args.train_data)\n\n&nbsp; &nbsp; train_loader = torch.utils.data.DataLoader(\n&nbsp; &nbsp; &nbsp; &nbsp; train_dataset,&nbsp;\n&nbsp; &nbsp; &nbsp; &nbsp; batch_size=args.batch_size,\n&nbsp; &nbsp; &nbsp; &nbsp; shuffle=True,\n&nbsp; &nbsp; &nbsp; &nbsp; num_workers=args.workers,\n&nbsp; &nbsp; &nbsp; &nbsp; )\n\n&nbsp; &nbsp; for epoch in range(args.epochs):\n&nbsp; &nbsp; &nbsp; &nbsp; # 调用train函数进行训练，稍后补充\n&nbsp; &nbsp; &nbsp; &nbsp; train(train_loader, model, criterion, optimizer, epoch, args)\n        # 模型保存&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;\n&nbsp; &nbsp; &nbsp; &nbsp; if epoch % args.save_interval == 0:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if not os.path.exists(args.checkpoint_dir):\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; os.mkdir(args.checkpoint_dir)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; torch.save(model.state_dict(), os.path.join(args.checkpoint_dir,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'checkpoint.pth.tar.epoch_%s' % epoch))\n</code></pre><h3>创建模型</h3><p>接下来，我们来看看如何创建模型，这一步我们直接使用作者给出的Efficient模型。在上面代码注释中的part1部分，用下述代码即可加载EfficientNet模型。</p><pre><code class=\"language-python\">&nbsp; &nbsp; args.classes_num = 2\n    if args.pretrained:\n&nbsp; &nbsp; &nbsp; &nbsp; model = EfficientNet.from_pretrained(args.arch, num_classes=args.classes_num,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; advprop=args.advprop)\n&nbsp; &nbsp; &nbsp; &nbsp; print(\"=&gt; using pre-trained model '{}'\".format(args.arch))\n&nbsp; &nbsp; else:\n&nbsp; &nbsp; &nbsp; &nbsp; print(\"=&gt; creating model '{}'\".format(args.arch))\n&nbsp; &nbsp; &nbsp; &nbsp; model = EfficientNet.from_name(args.arch, override_params={'num_classes': args.classes_num})\n    # 有GPU的话，加上cuda()\n    #mode.cuda()\n</code></pre><p>这段代码是说，如果pretrained model参数为True，则自动下载并加载pretrained model后进行训练，否则是使用随机数初始化网络。<br>\nfrom_pretrained与from_name中，都需要修改一下num_classes，将EfficientNet的全连接层修改我们项目对应的类别数，这里的args.classes_num为2（logo类与others类）。</p><h4>模型微调</h4><p>模型微调在<a href=\"https://time.geekbang.org/column/article/431420\">第8节课</a>和<a href=\"https://time.geekbang.org/column/article/442442\">第14节课</a>时说过，这个概念比较重要，我们一起再复习一下。</p><p>Pretrained model一般是在ImageNet（也有可能是COCO或VOC，都是公开数据集）上训练过的模型，我们可以直接把它在ImageNet上训练好的模型参数直接拿过来，在其基础上训练我们自己的模型，这就是模型微调。</p><p>所以说，<strong>如果有Pretrained model，我们一定会使用Pretrained model进行训练，收敛速度会快</strong>。</p><p>使用Pretrained model的时候要注意一点，在ImageNet上训练后的全连接层一共有1000个节点，所以使用Pretrained model的时候只使用全连接层以外的参数。</p><p>在上述代码的EfficientNet.from_pretrained中，会<s>通</s>调用load_pretrained_weights函数，调用之前num_classes已经被修改为2（logo与others），所以说传入load_pretrained_weights的load_fc参数为False，也就是说不会加载全连接层的参数。load_pretrained_weights的调用如下所示：</p><pre><code class=\"language-python\">load_pretrained_weights(model, model_name, load_fc=(num_classes == 1000), advprop=advprop)\n</code></pre><p>load_pretrained_weights函数中包含下面这段代码，就像刚才所说，如果不加载全连接层，则删除_fc的weight与bias：</p><pre><code class=\"language-python\">if load_fc:\n    ret = model.load_state_dict(state_dict, strict=False)\n    assert not ret.missing_keys, 'Missing keys when loading pretrained weights: {}'.format(ret.missing_keys)\nelse:\n&nbsp; &nbsp; state_dict.pop('_fc.weight')\n&nbsp; &nbsp; state_dict.pop('_fc.bias')\n&nbsp; &nbsp; ret = model.load_state_dict(state_dict, strict=False)\n</code></pre><h3>设定损失函数与优化方法</h3><p>最后要做的就是设定损失函数与优化方法了，我们将下面的代码补充到part2部分：</p><pre><code class=\"language-python\">criterion = nn.CrossEntropyLoss() # 有GPU的话加上.cuda()\n\noptimizer = torch.optim.SGD(model.parameters(), args.lr,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; momentum=args.momentum,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; weight_decay=args.weight_decay)\n</code></pre><p>到这里，我们就完成训练的所有准备了，只要再补充好train函数就可以了，代码如下。下面的代码的原理我们在<a href=\"https://time.geekbang.org/column/article/438639\">第13节课</a>中已经讲过了，记不清的可以去回顾一下。</p><pre><code class=\"language-python\">def train(train_loader, model, criterion, optimizer, epoch, args):\n&nbsp; &nbsp; # switch to train mode\n&nbsp; &nbsp; model.train()\n\n&nbsp; &nbsp; for i, (images, target) in enumerate(train_loader):\n&nbsp; &nbsp; &nbsp; &nbsp; # compute output\n&nbsp; &nbsp; &nbsp; &nbsp; output = model(images)\n&nbsp; &nbsp; &nbsp; &nbsp; loss = criterion(output, target)\n&nbsp; &nbsp; &nbsp; &nbsp; print('Epoch ', epoch, loss)\n\n&nbsp; &nbsp; &nbsp; &nbsp; # compute gradient and do SGD step\n&nbsp; &nbsp; &nbsp; &nbsp; optimizer.zero_grad()\n&nbsp; &nbsp; &nbsp; &nbsp; loss.backward()\n&nbsp; &nbsp; &nbsp; &nbsp; optimizer.step()\n</code></pre><p>不过在我的程序里，保存了若干个Epoch的模型，我们应该怎么选择呢？这就要说到模型的评估环节。</p><h2>模型评估</h2><p>对于分类模型的评估来说，有很多评价指标，例如准确率、精确率、召回率、F1-Score等。其中，<strong>我认为最直观、最有说服力的就是精确率与召回率</strong>，这也是我在项目中观察的主要是指标。下面我们依次来看看。</p><h3>混淆矩阵</h3><p>在讲解精确率与召回率之前，我们先看看混淆矩阵这个概念。其实精确率与召回率就是通过它计算出来的。下表就是一个混淆矩阵，正例就是logo类，负例就是others类。</p><p><img src=\"https://static001.geekbang.org/resource/image/57/8b/5756d1fe45493d69ayy534da3d20088b.jpg?wh=1920x847\" alt=\"图片\"></p><p>根据预测结果和真实类别的组合，一共有四种情况：</p><p>1.TP是说真实类别为Logo，模型也预测为Logo；<br>\n2.FP是说真实类别为Others，但模型预测为Logo；<br>\n3.FN是说真实类别为Logo，但模型预测为Others；<br>\n4.TN是说真实类别为Others，模型也预测为Others；</p><p>精确率的计算方法为：</p><p>$$precision = \\frac{TP}{ (TP + FP)}$$</p><p>召回率的计算方式为：</p><p>$$recall = \\frac{TP}{(TP + FN)}$$</p><p>精确率与召回率分别衡量了模型的不同表现，精确率说的是，如果模型认为一张图片是Logo类，那有多大概率是Logo类。而召回率衡量的是，在整个验证集中，模型能找到多少Logo图片。</p><p>那问题来了，怎样根据这两个指标来选择模型呢？业务需求不同，我们侧重的指标就不一样。</p><p>比如在我们的这个项目中，如果老板允许一部分Logo图片没有被识别，但是模型必须非常准，模型说一张图片是Logo类，那图片真实类别就有非常大的概率是Logo类图片，那应该侧重的就是精确率；如果老板希望把线上Logo类尽可能地识别出来，允许一部分图片被误识别，那应该侧重的就是召回率。</p><p>在计算精确率与召回率的时候，给你分享一下我的经验。在实际项目中，我习惯把模型对每张图片的预测结果保存到一个txt中，这样可以比较直观地筛选一些模型的badcase，并且验证集如果非常大，又需要调整的时候，直接更改txt就可以了，不需要再次让模型预测整个验证集。</p><p>下面是txt文件的一部分，分别记录了logo类的概率、others类的概率、真实类别是否为logo、真实类别是否为others、预测类别是否为logo、预测类别是否为ohters、图片名。</p><p>14.jpeg是开篇例子的那张图片，模型认为它是Logo的概率是0.58476，others类的概率是0.41524。</p><pre><code class=\"language-python\">...\n0.64460 0.35540 1 0 1 0 ./data/val/logo/13.jpeg\n0.58476 0.41524 1 0 1 0 ./data/val/logo/14.jpeg\n...\n</code></pre><p>下图是我训练了10个Epoch的B0模型，在验证集(这里我用训练集充当了一下验证集)上的评价效果。<br>\n<img src=\"https://static001.geekbang.org/resource/image/95/00/95a4b9f3e9eddb32b3bc30e85dfa2500.png?wh=966x730\" alt=\"图片\"></p><p>通过混淆矩阵可以看到，整个验证集一共有8+0张图片被预测为logo类，所以logo类的精确率为8 / (8 + 0 ) = 1；logo类一共有8+2张图片，有两张预测错了，所以召回率为8 / (8 +2) = 0.8。</p><p>others类别的计算类似，你可以自己算算看。</p><h2>小结</h2><p>恭喜你，完成了今天的学习任务。今天我们一起完成了一个图像分类项目的实践。虽然项目规模较小，但是在真实项目中的每一个环节都包含在内了，可以说是麻雀虽小，五脏俱全。</p><p>下面我们回顾一下每个环节上的关键要点和实操经验。</p><p><strong>数据准备其实是最关键的一步，数据的质量直接决定了模型好坏</strong>。所以，在开始训练之前你应该对你的数据集有十足的了解才可以。例如，验证集还是否可以反映出训练集、数据中有没有脏数据、数据分布有没有偏等等。</p><p>完成数据准备之后就到了模型训练，图像分类任务其实基本上都是采用主流的卷积神经网络了，很少对模型结构做一些更改。</p><p>最后的模型评估环节要侧重业务场景，看业务上需要高精确还是高召回，然后再对你的模型做调整。</p><h2>思考题</h2><p>老板希望你的模型能尽可能的把线上所有极客时间的海报都找到，允许一些误召回。训练模型的时候你应该侧重精确率还是召回率？</p><p>推荐你动手实现一下今天的Demo，也欢迎你把这节课分享给更多的同事、朋友，跟他一起学习进步。</p>","comments":[{"had_liked":false,"id":323128,"user_name":"vcjmhg","can_delete":false,"product_type":"c1","uid":1526461,"ip_address":"","ucode":"B508D1E9B3F974","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/j24oyxHcpB5AMR9pMO6fITqnOFVOncnk2T1vdu1rYLfq1cN6Sj7xVrBVbCvHXUad2MpfyBcE4neBguxmjIxyiaQ/132","comment_is_top":false,"comment_ctime":1637737823,"is_pvip":false,"replies":[{"id":"117279","content":"👍🏻👍🏻^^","user_name":"作者回复","user_name_real":"编辑","uid":"2802608","ctime":1637801350,"ip_address":"","comment_id":323128,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10227672415","product_id":100093301,"comment_content":"思考题：<br>召回率衡量的是，在整个验证集中，模型能找到多少 Logo 图片。因此在尽可能的把线上所有极客时间的海报都找到，允许一些误召回的情况下，训练的的模型应该更侧重召回率。","like_count":2,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":533125,"discussion_content":"👍🏻👍🏻^^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637801350,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":338012,"user_name":"Geek_be7ab2","can_delete":false,"product_type":"c1","uid":2938365,"ip_address":"","ucode":"9E57D5541B7F11","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/8MTplMt8gSz0ZoazK9R24DdTaBZN2CNibWSNyFLF0CAgOJRvXgHOeoXgFyzhdQXgwHC3XJgY25RT3ONQY2ty80A/132","comment_is_top":false,"comment_ctime":1647234844,"is_pvip":false,"replies":[{"id":"123637","content":"你好，感谢留言。<br>因为我给出的predict只能对一张图片预测啊。<br>https:&#47;&#47;github.com&#47;syuu1987&#47;geekTime-image-classification&#47;blob&#47;main&#47;predict.py#L19<br>想预测多张图片的话，可以自己手动改一下。","user_name":"作者回复","user_name_real":"编辑","uid":"2802608","ctime":1647398646,"ip_address":"","comment_id":338012,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5942202140","product_id":100093301,"comment_content":"老师好，我通过nohup python train.py &gt; myout.log 2&gt;&amp;1 &amp; 方式运行train.py文件没有仍何问题，但是使用predict.py时发现只能对一张图片进行预测。代码如下：<br>python predict.py --path .&#47;data&#47;val&#47;logo&#47;14.jpeg<br>这是为什么？","like_count":1,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556481,"discussion_content":"你好，感谢留言。\n因为我给出的predict只能对一张图片预测啊。\nhttps://github.com/syuu1987/geekTime-image-classification/blob/main/predict.py#L19\n想预测多张图片的话，可以自己手动改一下。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647398646,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":323173,"user_name":"narsil的梦","can_delete":false,"product_type":"c1","uid":1185187,"ip_address":"","ucode":"67110C673BD951","user_header":"https://static001.geekbang.org/account/avatar/00/12/15/a3/e67d6039.jpg","comment_is_top":false,"comment_ctime":1637748567,"is_pvip":false,"replies":[{"id":"117280","content":"你好，narsil的梦，感谢你的留言。<br>forward接受的也是一个batch的数据。<br>forward的输入即为网络的输入，它是一个shape为（batch_size, 通道数，高，宽）的tensor。<br>output的输出也是一个batch_size的输出，而不是平均值。<br>当预测一张图片的时候，输入应该为(1, 通道数，高，宽)的tensor。","user_name":"作者回复","user_name_real":"编辑","uid":"2802608","ctime":1637801637,"ip_address":"","comment_id":323173,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5932715863","product_id":100093301,"comment_content":"老师好，请问下面这段代码里为什么调用 model 的时候一次传入了一个 batch 的图片数量而不是一张一张传入并计算 output？如果一次传入多张图片输入，是不是输出的 output 是平均值？但我看 EfficientNet 的 forward 函数确实一次只接受一张图片输入<br><br>    for i, (images, target) in enumerate(train_loader):<br>        # compute output<br>        output = model(images)<br>        loss = criterion(output, target)<br>        print(&#39;Epoch &#39;, epoch, loss)","like_count":1,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":533127,"discussion_content":"你好，narsil的梦，感谢你的留言。\nforward接受的也是一个batch的数据。\nforward的输入即为网络的输入，它是一个shape为（batch_size, 通道数，高，宽）的tensor。\noutput的输出也是一个batch_size的输出，而不是平均值。\n当预测一张图片的时候，输入应该为(1, 通道数，高，宽)的tensor。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637801637,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":2,"child_discussions":[{"author":{"id":1185187,"avatar":"https://static001.geekbang.org/account/avatar/00/12/15/a3/e67d6039.jpg","nickname":"narsil的梦","note":"","ucode":"67110C673BD951","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":533183,"discussion_content":"感谢老师回复，不过还有一些不明白的。output 是一个 batch 的，那么计算出来 loss 也是一个 batch？把一个 batch 的 loss 反向传播然后用 sgd 优化器优化，那么这里的 sgd 如何体现出来是随机取一个样本就更新一次网络呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637808906,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":533127,"ip_address":""},"score":533183,"extra":"{\"user_type\":1}"},{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":1185187,"avatar":"https://static001.geekbang.org/account/avatar/00/12/15/a3/e67d6039.jpg","nickname":"narsil的梦","note":"","ucode":"67110C673BD951","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536638,"discussion_content":"output是一个batch的。loss也是一个batch的，但是loss的输出是将这个batch的损失取均值。CrossEntropyLoss中reduction参数的默认值是Mean，就是对一个batch中的loss取均值再输出。\nhttps://pytorch.org/docs/stable/generated/torch.nn.CrossEntropyLoss.html\n咱们的程序是取一个batch的数据更新一次网络的参数。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638840405,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":533183,"ip_address":""},"score":536638,"extra":""}]}]},{"had_liked":false,"id":322741,"user_name":"zhaobk","can_delete":false,"product_type":"c1","uid":1291596,"ip_address":"","ucode":"30BEE12D2CF020","user_header":"https://static001.geekbang.org/account/avatar/00/13/b5/4c/6b9528f8.jpg","comment_is_top":false,"comment_ctime":1637572171,"is_pvip":false,"replies":[{"id":"117182","content":"你好，zhaobk，谢谢留言。你说的验证是指如何评估吗？<br>评估的话可以按照文稿中的精确与召回对每个模型进行评估，然后选择合适的模型。<br> 代码的话，sklearn中提供了混淆矩阵、精确和召回的方法。","user_name":"作者回复","user_name_real":"编辑","uid":"2802608","ctime":1637576289,"ip_address":"","comment_id":322741,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5932539467","product_id":100093301,"comment_content":"老师好。可以说说练完以后，要这么进行验证吗？","like_count":1,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":532322,"discussion_content":"你好，zhaobk，谢谢留言。你说的验证是指如何评估吗？\n评估的话可以按照文稿中的精确与召回对每个模型进行评估，然后选择合适的模型。\n 代码的话，sklearn中提供了混淆矩阵、精确和召回的方法。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637576289,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":359613,"user_name":"Amaplan","can_delete":false,"product_type":"c1","uid":2765794,"ip_address":"上海","ucode":"FF7AD4404EC462","user_header":"","comment_is_top":false,"comment_ctime":1665678447,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1665678447","product_id":100093301,"comment_content":"作者你好使用你git上的代码出现一下问题:<br>TypeError                                 Traceback (most recent call last)<br>Cell In [2], line 72<br>     70 parser.add_argument(&#39;--advprop&#39;, default=False, help=&#39;advprop&#39;)<br>     71 args, unknown = parser.parse_known_args()<br>---&gt; 72 main(args)<br>...<br>TypeError: object of type &#39;NoneType&#39; has no len()","like_count":0},{"had_liked":false,"id":359606,"user_name":"Amaplan","can_delete":false,"product_type":"c1","uid":2765794,"ip_address":"上海","ucode":"FF7AD4404EC462","user_header":"","comment_is_top":false,"comment_ctime":1665673733,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1665673733","product_id":100093301,"comment_content":"运行main()函数后报错:AttributeError: &#39;Namespace&#39; object has no attribute &#39;advprop&#39;<br>请问这个advprop是哪里来的<br>","like_count":0},{"had_liked":false,"id":358760,"user_name":"Zeurd","can_delete":false,"product_type":"c1","uid":2919792,"ip_address":"北京","ucode":"7CE1E0F76C3313","user_header":"https://static001.geekbang.org/account/avatar/00/2c/8d/70/b0047299.jpg","comment_is_top":false,"comment_ctime":1664704353,"is_pvip":true,"replies":[{"id":"130555","content":"你好，<br>&gt;&gt;”AttributeError: &#39;NoneType&#39; object has no attribute &#39;read&#39;“<br>这个问题一般都是路径的问题，数据没有正确读取到。<br>&gt;&gt;还有就是我在尝试别的数据集的时候，那是个4分类任务，我对标签tosenor之后，标签size为啥是[1,1]啊<br>类别是1，2，3，4这样的吧。one-hot之后会变成4维","user_name":"作者回复","user_name_real":"编辑","uid":"2802608","ctime":1665190426,"ip_address":"北京","comment_id":358760,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1664704353","product_id":100093301,"comment_content":"老师想问一下，运行的话会报AttributeError: &#39;NoneType&#39; object has no attribute &#39;read&#39;的错，是因为predict文件里test路径的问题么？<br>还有就是我在尝试别的数据集的时候，那是个4分类任务，我对标签tosenor之后，标签size为啥是[1,1]啊，4个文件夹4种标签不应该是[1,4]么，但是这样模型的liner层我的class只能设1，怎么预测都是100%正确率，我知道应该是4的，但不知道标签那个target_transform应该怎么改","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589601,"discussion_content":"你好，\n&gt;&gt;”AttributeError: &#39;NoneType&#39; object has no attribute &#39;read&#39;“\n这个问题一般都是路径的问题，数据没有正确读取到。\n&gt;&gt;还有就是我在尝试别的数据集的时候，那是个4分类任务，我对标签tosenor之后，标签size为啥是[1,1]啊\n类别是1，2，3，4这样的吧。one-hot之后会变成4维","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665190426,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":357109,"user_name":"gavin","can_delete":false,"product_type":"c1","uid":1099142,"ip_address":"北京","ucode":"3D99ADC89699FE","user_header":"https://static001.geekbang.org/account/avatar/00/10/c5/86/1134c2f1.jpg","comment_is_top":false,"comment_ctime":1662966704,"is_pvip":false,"replies":[{"id":"129994","content":"你好，感谢留言。<br>1. 属于Python语法的问题。_norm_advprop 是个函数 https:&#47;&#47;github.com&#47;syuu1987&#47;geekTime-image-classification&#47;blob&#47;main&#47;dataset.py#L6<br>2. https:&#47;&#47;github.com&#47;syuu1987&#47;geekTime-image-classification&#47;blob&#47;main&#47;train.py#L16与https:&#47;&#47;github.com&#47;syuu1987&#47;geekTime-image-classification&#47;blob&#47;main&#47;predict.py#L18<br>是配合使用的。<br>但是model.train(mode=True)默认是True，一般来说不写也可以。<br>它的作用是会启动模型中的BN层与dropout层。<br>而model.eval（）则是关闭BN与dropout，进行预测。<br>","user_name":"作者回复","user_name_real":"编辑","uid":"2802608","ctime":1663055842,"ip_address":"北京","comment_id":357109,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1662966704","product_id":100093301,"comment_content":"两个问题没弄明白:<br>1.transforms.Lambda(_norm_advprop)中不用传img参数进去的吗？ 函数定义时不是有个img参数吗<br>2.train.py中，model.train()是什么用?如果是模型内部就定义了训练，后面那段训练还有什么用","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587438,"discussion_content":"你好，感谢留言。\n1. 属于Python语法的问题。_norm_advprop 是个函数 https://github.com/syuu1987/geekTime-image-classification/blob/main/dataset.py#L6\n2. https://github.com/syuu1987/geekTime-image-classification/blob/main/train.py#L16与https://github.com/syuu1987/geekTime-image-classification/blob/main/predict.py#L18\n是配合使用的。\n但是model.train(mode=True)默认是True，一般来说不写也可以。\n它的作用是会启动模型中的BN层与dropout层。\n而model.eval（）则是关闭BN与dropout，进行预测。\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663055842,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355002,"user_name":"赵启明","can_delete":false,"product_type":"c1","uid":3012204,"ip_address":"北京","ucode":"96AFD073DCF129","user_header":"","comment_is_top":false,"comment_ctime":1660965412,"is_pvip":false,"replies":[{"id":"129294","content":"抱歉，回复迟了。<br>感觉是版本的问题，你看看你的pytorch版本跟课程的一不一样？","user_name":"作者回复","user_name_real":"编辑","uid":"2802608","ctime":1661320678,"ip_address":"北京","comment_id":355002,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1660965412","product_id":100093301,"comment_content":"老师好，如下代码执行后：<br>  model = EfficientNet.from_name(&#39;efficientnet-b0&#39;)<br>    num_ftrs = model._fc.in_features<br>    model._fc = nn.Linear(num_ftrs, 2)<br>    model.load_state_dict(torch.load(&#39;.&#47;data&#47;checkpoint&#47;checkpoint.pth.tar.epoch_9&#39;))<br>会报这个错误：<br>lib\\site-packages\\torch\\nn\\modules\\module.py&quot;, line 1379, in load_state_dict<br>    state_dict = state_dict.copy()<br>AttributeError: &#39;_IncompatibleKeys&#39; object has no attribute &#39;copy&#39;<br>是什么原因？","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585072,"discussion_content":"抱歉，回复迟了。\n感觉是版本的问题，你看看你的pytorch版本跟课程的一不一样？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661320679,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354934,"user_name":"wongxinjie","can_delete":false,"product_type":"c1","uid":1128363,"ip_address":"广东","ucode":"021104851E91C4","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep0PCjmt5dXpgGt4yDWm6FiaffwQkxgD6sSXVricmvN4pg7ZdOLlAoFAHKTSvG3E8G3YI0RV4ar27cQ/132","comment_is_top":false,"comment_ctime":1660894115,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1660894115","product_id":100093301,"comment_content":"老师的项目要是能把你用的依赖导到 requirements.txt 就更好了","like_count":0},{"had_liked":false,"id":354069,"user_name":"John(易筋)","can_delete":false,"product_type":"c1","uid":1180202,"ip_address":"广东","ucode":"BB4E58DD4B8F15","user_header":"https://static001.geekbang.org/account/avatar/00/12/02/2a/90e38b94.jpg","comment_is_top":false,"comment_ctime":1660056327,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1660056327","product_id":100093301,"comment_content":"还没吃透，明天再来，已经star。 谢谢方老师<br>git clone git@github.com:syuu1987&#47;geekTime-image-classification.git<br><br>python train.py<br>python predict.py --path .&#47;data&#47;val&#47;logo&#47;14.jpeg<br>prediction: tensor([[ 0.4379, -0.2296]], grad_fn=&lt;AddmmBackward0&gt;)","like_count":0},{"had_liked":false,"id":354068,"user_name":"John(易筋)","can_delete":false,"product_type":"c1","uid":1180202,"ip_address":"北京","ucode":"BB4E58DD4B8F15","user_header":"https://static001.geekbang.org/account/avatar/00/12/02/2a/90e38b94.jpg","comment_is_top":false,"comment_ctime":1660056105,"is_pvip":true,"replies":[{"id":"129290","content":"抱歉，回复迟了。<br>这个似乎是没有找到图片啊。","user_name":"作者回复","user_name_real":"编辑","uid":"2802608","ctime":1661319548,"ip_address":"北京","comment_id":354068,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1660056105","product_id":100093301,"comment_content":"方老师，请教 python train.py能成功，predict 失败 , 最后log如下：<br>Epoch  9 tensor(0.3476, grad_fn=&lt;NllLossBackward0&gt;)<br>torch.Size([9, 3, 224, 224])<br>Epoch  9 tensor(0.3354, grad_fn=&lt;NllLossBackward0&gt;)<br><br>python predict.py<br>Traceback (most recent call last):<br>  File &quot;&#47;Library&#47;Frameworks&#47;Python.framework&#47;Versions&#47;3.10&#47;lib&#47;python3.10&#47;site-packages&#47;PIL&#47;Image.py&quot;, line 3072, in open<br>    fp.seek(0)<br>AttributeError: &#39;NoneType&#39; object has no attribute &#39;seek&#39;<br><br>During handling of the above exception, another exception occurred:<br><br>Traceback (most recent call last):<br>  File &quot;&#47;Users&#47;zgpeace&#47;Workspace&#47;AI&#47;geekTime-image-classification&#47;predict.py&quot;, line 19, in &lt;module&gt;<br>    image = Image.open(args.path)<br>  File &quot;&#47;Library&#47;Frameworks&#47;Python.framework&#47;Versions&#47;3.10&#47;lib&#47;python3.10&#47;site-packages&#47;PIL&#47;Image.py&quot;, line 3074, in open<br>    fp = io.BytesIO(fp.read())<br>AttributeError: &#39;NoneType&#39; object has no attribute &#39;read&#39;","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585067,"discussion_content":"抱歉，回复迟了。\n这个似乎是没有找到图片啊。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661319549,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354063,"user_name":"John(易筋)","can_delete":false,"product_type":"c1","uid":1180202,"ip_address":"广东","ucode":"BB4E58DD4B8F15","user_header":"https://static001.geekbang.org/account/avatar/00/12/02/2a/90e38b94.jpg","comment_is_top":false,"comment_ctime":1660053333,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1660053333","product_id":100093301,"comment_content":"每秒浮点运算次数，亦称每秒峰值速度，（英语：Floating-point operations per second；缩写：FLOPS），即每秒所执行的浮点运算次数。浮点（floating-point）指的是带有小数的数值，浮点运算即是小数的四则运算，常用来测量电脑运算速度或被用来估算电脑性能，尤其是在使用到大量浮点运算的科学计算领域中。因为FLOPS后缀的那个S代表秒，而不是复数，所以不能够省略。在多数情况下，测算FLOPS比测算每秒指令数（IPS）要准确。<br><br>浮点运算实际上包括了所有涉及浮点数的运算，在某类应用软件中常常出现，比较整数运算更用时间。现今大部分的处理器中都有浮点运算器。因此每秒浮点运算次数所量测的实际上就是浮点运算器的执行速度。常用来测量每秒浮点运算次数的基准程序（benchmark）之一，是Linpack。","like_count":0},{"had_liked":false,"id":354022,"user_name":"Geek_827444","can_delete":false,"product_type":"c1","uid":3091330,"ip_address":"北京","ucode":"B205EFB4F6DC01","user_header":"","comment_is_top":false,"comment_ctime":1660025380,"is_pvip":false,"replies":[{"id":"128776","content":"你好，同学。<br>这是python的内容。你可以查一下argparse模块的使用。<br>需要pip install一下","user_name":"作者回复","user_name_real":"作者","uid":"2802608","ctime":1660026980,"ip_address":"北京","comment_id":354022,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1660025380","product_id":100093301,"comment_content":"老师好，我想请教一下args.xxxx这个到底该怎么用那？之前看了您和另外一位同学发的说调用argpasem模块，可是我看我的pycharm里没有这个文件啊，这又是怎么回事那？谢谢老师","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583310,"discussion_content":"你好，同学。\n这是python的内容。你可以查一下argparse模块的使用。\n需要pip install一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660026980,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353726,"user_name":"言不由衷","can_delete":false,"product_type":"c1","uid":3075767,"ip_address":"北京","ucode":"7154B6233C2B4C","user_header":"https://static001.geekbang.org/account/avatar/00/2e/ee/b7/eb7854f8.jpg","comment_is_top":false,"comment_ctime":1659698942,"is_pvip":false,"replies":[{"id":"128746","content":"你好，具体是哪里报错呢？<br>logo里一共就9张图片。","user_name":"作者回复","user_name_real":"编辑","uid":"2802608","ctime":1660005534,"ip_address":"北京","comment_id":353726,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1659698942","product_id":100093301,"comment_content":"老师好，为什么我运行predict文件之后，会一直出现AttributeError: &#39;NoneType&#39; object has no attribute &#39;read&#39;的错误，而且train文件最多只能下载出9个文件<br>","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583260,"discussion_content":"你好，具体是哪里报错呢？\nlogo里一共就9张图片。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660005534,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":346694,"user_name":"亚林","can_delete":false,"product_type":"c1","uid":1018972,"ip_address":"","ucode":"4A5A6D24314B79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8c/5c/3f164f66.jpg","comment_is_top":false,"comment_ctime":1653362984,"is_pvip":false,"replies":[{"id":"126469","content":"使用prettytable ^^","user_name":"作者回复","user_name_real":"编辑","uid":"2802608","ctime":1653456604,"ip_address":"","comment_id":346694,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1653362984","product_id":100093301,"comment_content":"这个混淆矩阵没弄出来","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573473,"discussion_content":"使用prettytable ^^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653456605,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":346677,"user_name":"亚林","can_delete":false,"product_type":"c1","uid":1018972,"ip_address":"","ucode":"4A5A6D24314B79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8c/5c/3f164f66.jpg","comment_is_top":false,"comment_ctime":1653356694,"is_pvip":false,"replies":[{"id":"126470","content":"👍🏻👍🏻👍🏻👍🏻 ^^","user_name":"作者回复","user_name_real":"编辑","uid":"2802608","ctime":1653456692,"ip_address":"","comment_id":346677,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1653356694","product_id":100093301,"comment_content":"召回率","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573474,"discussion_content":"👍🏻👍🏻👍🏻👍🏻 ^^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653456692,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":346030,"user_name":"橙紫英","can_delete":false,"product_type":"c1","uid":2978511,"ip_address":"","ucode":"E1CB7DDD0461C9","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/AhaSicobIfA85ZUYjOZ26AYHr4jejU9y6KwwXnytqWKMehiaWDOo6q6ejyuIs5UGpBial8zj9tTQWcrzDJjHvGTWg/132","comment_is_top":false,"comment_ctime":1652778282,"is_pvip":false,"replies":[{"id":"126278","content":"正常，加上sigmoid或者softmax就会转换为概率形式","user_name":"作者回复","user_name_real":"编辑","uid":"2802608","ctime":1652862880,"ip_address":"","comment_id":346030,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1652778282","product_id":100093301,"comment_content":"老师，您好，请问预测的结果中有负数，这正常吗<br>prediction: tensor([[ 0.3588, -0.4015]], grad_fn=&lt;AddmmBackward0&gt;)","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572578,"discussion_content":"正常，加上sigmoid或者softmax就会转换为概率形式","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652862881,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1212044,"avatar":"https://static001.geekbang.org/account/avatar/00/12/7e/8c/f029535a.jpg","nickname":"hallo128","note":"","ucode":"3921D6E11CFCB1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582685,"discussion_content":"在predict.py最后再加上以下代码即可输出概率:\n# 概率转换\nprob = torch.softmax(pred, dim=1)\nprint(&#34;prediction prop:&#34;, prob)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659596853,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"云南"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":346023,"user_name":"zhangting","can_delete":false,"product_type":"c1","uid":2950861,"ip_address":"","ucode":"565BB6CEE694E0","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/ajNVdqHZLLDm5eHbw1fuicJiaXercgBI48O0Idt2mHUElmZyBM4o119NkndU1SNpsv8rZzKFibj8z1FibFAdNEO3zw/132","comment_is_top":false,"comment_ctime":1652773898,"is_pvip":false,"replies":[{"id":"126277","content":"你好，因为没有加sigmoid或者softmax。","user_name":"作者回复","user_name_real":"编辑","uid":"2802608","ctime":1652862861,"ip_address":"","comment_id":346023,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1652773898","product_id":100093301,"comment_content":"老师，问一下，为什么预测结果打出来会是负的？<br>prediction: tensor([[-0.3866,  0.3760]])<br>","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572577,"discussion_content":"你好，因为没有加sigmoid或者softmax。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652862861,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345202,"user_name":"..................","can_delete":false,"product_type":"c1","uid":2980638,"ip_address":"","ucode":"3203CA634FC3A7","user_header":"https://static001.geekbang.org/account/avatar/00/2d/7b/1e/8bb7c7fe.jpg","comment_is_top":false,"comment_ctime":1652104506,"is_pvip":false,"replies":[{"id":"126005","content":"你好，感谢留言。<br>有时间，有能力可以尝试复现几个。<br>另外复现在ImageNet上的CNN的话，需要从0开始在ImageNet上训练。<br>不知道你有没有相应的硬件设备(GPU)。<br>复现的目的是加深理解，如果觉得理解的不错的话，不复现也是ok的。","user_name":"作者回复","user_name_real":"编辑","uid":"2802608","ctime":1652163157,"ip_address":"","comment_id":345202,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1652104506","product_id":100093301,"comment_content":"老师，我看到这个章节中是直接用的现有的模型，其实我一直有一个疑问，我一直有想着复现模型，拿CNN来说吧，cnn的模型有这么多，每个模型都有必要复现一遍吗，我有点不知道怎么学习这些经典模型，求解答。。。","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571266,"discussion_content":"你好，感谢留言。\n有时间，有能力可以尝试复现几个。\n另外复现在ImageNet上的CNN的话，需要从0开始在ImageNet上训练。\n不知道你有没有相应的硬件设备(GPU)。\n复现的目的是加深理解，如果觉得理解的不错的话，不复现也是ok的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652163157,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2980638,"avatar":"https://static001.geekbang.org/account/avatar/00/2d/7b/1e/8bb7c7fe.jpg","nickname":"..................","note":"","ucode":"3203CA634FC3A7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":571292,"discussion_content":"明白了，我会有取舍的复现的，感谢老师的回答！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652170092,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":571266,"ip_address":""},"score":571292,"extra":""}]}]},{"had_liked":false,"id":344956,"user_name":"阿白","can_delete":false,"product_type":"c1","uid":2673506,"ip_address":"","ucode":"880EA22777100E","user_header":"https://static001.geekbang.org/account/avatar/00/28/cb/62/dc590615.jpg","comment_is_top":false,"comment_ctime":1651895691,"is_pvip":false,"replies":[{"id":"126083","content":"你好，感谢你的留言。<br>就是作者给出的一种数据预处理方式。<br>EfficientNet的作者是对图像做了这样的处理之后再训练的。","user_name":"作者回复","user_name_real":"编辑","uid":"2802608","ctime":1652250122,"ip_address":"","comment_id":344956,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1651895691","product_id":100093301,"comment_content":"老师好，数据加载环节中：<br># 作者给出的标准化方法<br>def _norm_advprop(img):<br>    return img * 2.0 - 1.0<br><br>这段是什么意思啊？","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571511,"discussion_content":"你好，感谢你的留言。\n就是作者给出的一种数据预处理方式。\nEfficientNet的作者是对图像做了这样的处理之后再训练的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652250122,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":344944,"user_name":"InfoQ_b30d6bb7f3d4","can_delete":false,"product_type":"c1","uid":1362181,"ip_address":"","ucode":"0FE17DE5D0E4E4","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/sNb8G3xGoibbo6dUcngBYsG2DZmLjd2jlmAGUkaNLb3ImCyZh5035aXaibnJdMIHeEtSuLFTcKraAZibhGpoIMo1w/132","comment_is_top":false,"comment_ctime":1651889794,"is_pvip":true,"replies":[{"id":"126112","content":"你好，感谢留言。不好意思回复的晚了。<br>你是说与“14.jpeg 是开篇例子的那张图片，模型认为它是 Logo 的概率是 0.58476，others 类的概率是 0.41524。”这段话的预测结果不一致吗？<br>可能有很多原因了，输入的数据是否一致？模型是否一致？数据的预处理是否一致这样的。","user_name":"作者回复","user_name_real":"编辑","uid":"2802608","ctime":1652409769,"ip_address":"","comment_id":344944,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1651889794","product_id":100093301,"comment_content":"为什么我预测以后的<br>prediction: tensor([[ 0.4958, -0.2352]], grad_fn=&lt;AddmmBackward0&gt;)","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571785,"discussion_content":"你好，感谢留言。不好意思回复的晚了。\n你是说与“14.jpeg 是开篇例子的那张图片，模型认为它是 Logo 的概率是 0.58476，others 类的概率是 0.41524。”这段话的预测结果不一致吗？\n可能有很多原因了，输入的数据是否一致？模型是否一致？数据的预处理是否一致这样的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652409769,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":344041,"user_name":"坚持","can_delete":false,"product_type":"c1","uid":1509619,"ip_address":"","ucode":"7385D8E981CC95","user_header":"http://thirdwx.qlogo.cn/mmopen/uqaRIfRCAhJ6t1z92XYEzadRGelHJUZ5mXrausmIK72hVYYYFeQaOWmhmWt3e5863fOavRcibM5mREpObRUT0gH94QcnWoaYq/132","comment_is_top":false,"comment_ctime":1651205799,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1651205799","product_id":100093301,"comment_content":"老师，能不能介绍下对抗训练的知识。advprop看了好会才知道是对抗训练相关知识","like_count":0,"discussions":[{"author":{"id":1509619,"avatar":"http://thirdwx.qlogo.cn/mmopen/uqaRIfRCAhJ6t1z92XYEzadRGelHJUZ5mXrausmIK72hVYYYFeQaOWmhmWt3e5863fOavRcibM5mREpObRUT0gH94QcnWoaYq/132","nickname":"坚持","note":"","ucode":"7385D8E981CC95","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":568735,"discussion_content":"# switch to train mode    \nmodel.train()\n还有请问老师，这句话这里是什么用途，跟踪代码也未跟踪到是调用哪里的代码","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651215202,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":343505,"user_name":"Zeurd","can_delete":false,"product_type":"c1","uid":2919792,"ip_address":"","ucode":"7CE1E0F76C3313","user_header":"https://static001.geekbang.org/account/avatar/00/2c/8d/70/b0047299.jpg","comment_is_top":false,"comment_ctime":1650881302,"is_pvip":true,"replies":[{"id":"125407","content":"你好，感谢留言。<br>from_pretrained在这里https:&#47;&#47;github.com&#47;syuu1987&#47;geekTime-image-classification&#47;blob&#47;main&#47;efficientnet&#47;model.py#L349<br>会根据参数自动下载pretrained模型。<br><br>predict.py是用来预测的。<br><br>&gt;&gt;train和predict有两个__name的调用，这个是个废的文件么？<br>没太看懂","user_name":"作者回复","user_name_real":"编辑","uid":"2802608","ctime":1650940218,"ip_address":"","comment_id":343505,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1650881302","product_id":100093301,"comment_content":"老师好，我想请问下，这个from_pretrained函数是efficientnet网络自带的嘛，这个网络也是用之前的models.efficientnet_b0(pretrained=True)下载的么?<br>以及，文件夹中的predict.py是做什么的？train和predict有两个__name的调用，这个是个废的文件么？","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":567628,"discussion_content":"你好，感谢留言。\nfrom_pretrained在这里https://github.com/syuu1987/geekTime-image-classification/blob/main/efficientnet/model.py#L349\n会根据参数自动下载pretrained模型。\n\npredict.py是用来预测的。\n\n&gt;&gt;train和predict有两个__name的调用，这个是个废的文件么？\nSorry. 没太明白,具体指哪里?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650961881,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":335439,"user_name":"爱码士_秃头兔子","can_delete":false,"product_type":"c1","uid":2823228,"ip_address":"","ucode":"D5AAC4E91D5A90","user_header":"https://static001.geekbang.org/account/avatar/00/2b/14/3c/e2ccea45.jpg","comment_is_top":false,"comment_ctime":1645519189,"is_pvip":false,"replies":[{"id":"122889","content":"hello，你这个是下载pretrain模型时报的错误吧。这应该是你网络的问题。","user_name":"作者回复","user_name_real":"编辑","uid":"2802608","ctime":1646036843,"ip_address":"","comment_id":335439,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1645519189","product_id":100093301,"comment_content":"老师您好， 按照readme里面的运行方法报请求错误.....<br> http.client.RemoteDisconnected: Remote end closed connection without response<br>","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553706,"discussion_content":"hello，你这个是下载pretrain模型时报的错误吧。这应该是你网络的问题。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646036843,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":327855,"user_name":"dndidoflbup","can_delete":false,"product_type":"c1","uid":1201908,"ip_address":"","ucode":"69B726F947065F","user_header":"https://static001.geekbang.org/account/avatar/00/12/56/f4/6c57f148.jpg","comment_is_top":false,"comment_ctime":1640329331,"is_pvip":false,"replies":[{"id":"119378","content":"这个文件供参考，直接 python train.py就可以运行。<br><br>https:&#47;&#47;github.com&#47;syuu1987&#47;geekTime-image-classification","user_name":"编辑回复","user_name_real":"编辑","uid":"1501385","ctime":1640336353,"ip_address":"","comment_id":327855,"utype":2}],"discussion_count":1,"race_medal":0,"score":"1640329331","product_id":100093301,"comment_content":"老师好，图片在哪呢","like_count":0,"discussions":[{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"听水的湖","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541345,"discussion_content":"这个文件供参考，直接 python train.py就可以运行。\n\nhttps://github.com/syuu1987/geekTime-image-classification","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640336353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":325747,"user_name":"Jason张","can_delete":false,"product_type":"c1","uid":2806125,"ip_address":"","ucode":"FB9257940D7CCF","user_header":"https://static001.geekbang.org/account/avatar/00/2a/d1/6d/4a0eafc4.jpg","comment_is_top":false,"comment_ctime":1639115694,"is_pvip":false,"replies":[{"id":"118266","content":"hi，你好，Jason。感谢留言。<br>看起来是有数据在cpu上。<br>具体是哪里报的错误呢？<br>模型、损失、模型输入的数据（原始图片与真实值）都要在gpu上，你可以检查一下看看。","user_name":"作者回复","user_name_real":"编辑","uid":"2802608","ctime":1639358585,"ip_address":"","comment_id":325747,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1639115694","product_id":100093301,"comment_content":"老师好，我能成功使用GPU加速，在文稿中需要加cuda() 的地方都加入了.cuda()但是报出了以下错误：Expected all tensors to be on the same device, but found at least two devices, cuda:0 and cpu!，我是单机单卡，数据集采用的是我自己的医学数据集，但是好像出了一些问题。还望老师赐教","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538165,"discussion_content":"hi，你好，Jason。感谢留言。\n看起来是有数据在cpu上。\n具体是哪里报的错误呢？\n模型、损失、模型输入的数据（原始图片与真实值）都要在gpu上，你可以检查一下看看。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639358585,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":325635,"user_name":"clee","can_delete":false,"product_type":"c1","uid":1467446,"ip_address":"","ucode":"122875102B23A8","user_header":"","comment_is_top":false,"comment_ctime":1639054354,"is_pvip":false,"replies":[{"id":"118151","content":"你好，收到，我看看然后给你留言哈。<br>有微信群，我让编辑加你。","user_name":"作者回复","user_name_real":"编辑","uid":"2802608","ctime":1639102025,"ip_address":"","comment_id":325635,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1639054354","product_id":100093301,"comment_content":"你好老师，经过一些测试，还是无法正常预测分类，没有找到原因，方便帮忙看下代码吗，代码已贴到colab上：https:&#47;&#47;colab.research.google.com&#47;drive&#47;1IIw0BLlQb5lDXK7IMPx_KTzGaYQktiwV?usp=sharing#scrollTo=OJc9wArhKsnR<br>已经尝试过的方法：<br>1、调整学习率0.01, 0.001<br>2、调整epoch，10, 20, 50（loss从0.662-&gt;0.0013）<br>3、调整训练数据集，logo数据集没有您的丰富，但是也都有Logo，other数据集尝试了只有猫和包含其他动物两种情况，如果Other训练集只包含猫的话，模型训练后，预测都为Other，否则其他都预测为了Logo<br>另外，有微信群可以讨论吗？","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537553,"discussion_content":"你好，收到，我看看然后给你留言哈。\n有微信群，我让编辑加你。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639102025,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537568,"discussion_content":"我用你的代码，在我的数据上训练了一次。结果没有问题。我的参数设置是这样的。\nparser = argparse.ArgumentParser(description=u&#34;[+]----------------- 图像分类Sample -----------------[+]&#34;)\n parser.add_argument(&#39;--train-data&#39;, default=&#39;./data/train&#39;, dest=&#39;train_data&#39;, help=&#39;location of train data&#39;)\n parser.add_argument(&#39;--image-size&#39;, default=224, dest=&#39;image_size&#39;, type=int, help=&#39;size of input image&#39;)\n parser.add_argument(&#39;--batch-size&#39;, default=10, dest=&#39;batch_size&#39;, type=int, help=&#39;batch size&#39;)\n parser.add_argument(&#39;--workers&#39;, default=4, dest=&#39;num_workers&#39;, type=int, help=&#39;worders number of Dataloader&#39;)\n parser.add_argument(&#39;--epochs&#39;, default=10, type=int, help=&#39;epochs&#39;)\n parser.add_argument(&#39;--lr&#39;,  default=0.001,type=float, help=&#39;learning rate&#39;)\n parser.add_argument(&#39;--checkpoint-dir&#39;, default=&#39;./ckpts/&#39;, dest=&#39;checkpoint_dir&#39;, help=&#39;location of checkpoint&#39;)\n parser.add_argument(&#39;--save-interval&#39;, default=1, dest=&#39;save_interval&#39;, type=int, help=&#39;save interval&#39;)\n parser.add_argument(&#39;--momentum&#39;, default=0.9, type=float, help=&#39;momentum&#39;)\n parser.add_argument(&#39;--weight-decay&#39;, default=1e-4, type=float, dest=&#39;weight_decay&#39;, help=&#39;weight decay&#39;)\n parser.add_argument(&#39;--arch&#39;, default=&#39;efficientnet-b0&#39;, help=&#39;arch type of EfficientNet&#39;)\n\n我推测可能是数据的问题。\n你可以先在训练集上评估一下，看看模型 有没有学到。\n进入微信群之后，也可以艾特我一下，我把我的数据发给你，你再试试。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1639105893,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538162,"discussion_content":"hi，不好意思。\n之前就用你的训练代码测试了一下。\n今天想到可能是预测代码有问题。\n你的预测代码中没有加model.eval(），加上这句就就不会有问题了。\nmodel.eval的作用在第14节课中讲过。\n\nif __name__ == &#39;__main__&#39;:\n    parser = argparse.ArgumentParser()\n    parser.add_argument(&#39;--path&#39;, dest=&#39;path&#39;)\n    args = parser.parse_args()\n    model = EfficientNet.from_name(&#39;efficientnet-b0&#39;)\n    num_ftrs = model._fc.in_features\n    model._fc = nn.Linear(num_ftrs, 2)\n    model.load_state_dict(torch.load(&#39;./ckpts/checkpoint.pth.tar.epoch_9&#39;))\n    model.eval()\n    image = Image.open(args.path)\n    image = image.convert(&#39;RGB&#39;)\n    transform = build_transform(224)\n    input_tensor = transform(image).unsqueeze(0)\n    pred = model(input_tensor)\n    # pred = model(input_tensor).argmax()\n    print(&#34;prediction:&#34;, pred)\n\n微信我再让他们加一下。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639358304,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":325500,"user_name":"马克图布","can_delete":false,"product_type":"c1","uid":1019274,"ip_address":"","ucode":"9E3879D6A55244","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/8a/ec29ca4a.jpg","comment_is_top":false,"comment_ctime":1639007828,"is_pvip":false,"replies":[{"id":"118098","content":"hello，我用的PrettyTable。<br>Python里专门弄表格的。^^","user_name":"作者回复","user_name_real":"编辑","uid":"2802608","ctime":1639015614,"ip_address":"","comment_id":325500,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1639007828","product_id":100093301,"comment_content":"老师的评价效果那张图好棒，是有什么函数可以直接生成这样的打印结果吗？","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537260,"discussion_content":"hello，我用的PrettyTable。\nPython里专门弄表格的。^^","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1639015614,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1019274,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8d/8a/ec29ca4a.jpg","nickname":"马克图布","note":"","ucode":"9E3879D6A55244","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":537336,"discussion_content":"好嘞，这就去学！😆","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639035795,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":537260,"ip_address":""},"score":537336,"extra":""}]}]},{"had_liked":false,"id":325165,"user_name":"徐洲更","can_delete":false,"product_type":"c1","uid":1314643,"ip_address":"","ucode":"F8A323CB732D05","user_header":"https://static001.geekbang.org/account/avatar/00/14/0f/53/92a50f01.jpg","comment_is_top":false,"comment_ctime":1638847001,"is_pvip":true,"replies":[{"id":"118004","content":"hello，应该不行。<br>卷积学习不到这么细微的特征。能不能孵化出小鸡，从外表上看鸡蛋应该都是一样的吧。<br>不过思路是对的，如果能不能孵化小鸡的鸡蛋有些什么独特的特征的话，是可以做到的。","user_name":"作者回复","user_name_real":"作者","uid":"2802608","ctime":1638856622,"ip_address":"","comment_id":325165,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1638847001","product_id":100093301,"comment_content":"老师您好，假设存在一个场景，就是手里有一批鸡蛋，专业人士能通过肉眼观察鸡蛋的形态（相当于看照片）来推测出鸡蛋能不能孵化出小鸡，并且有很高的的准确率，那么我们能否对 这些鸡蛋分别拍照，根据实际的孵化情况来打标签，最后通过卷积网络进行分类呢？","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536725,"discussion_content":"hello，应该不行。\n卷积学习不到这么细微的特征。能不能孵化出小鸡，从外表上看鸡蛋应该都是一样的吧。\n不过思路是对的，如果能不能孵化小鸡的鸡蛋有些什么独特的特征的话，是可以做到的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638856622,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1314643,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0f/53/92a50f01.jpg","nickname":"徐洲更","note":"","ucode":"F8A323CB732D05","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":536881,"discussion_content":"谢谢方远老师","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638887201,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":536725,"ip_address":""},"score":536881,"extra":""}]}]},{"had_liked":false,"id":324916,"user_name":"Geek_a95f0e","can_delete":false,"product_type":"c1","uid":2824511,"ip_address":"","ucode":"C0B7418FD1D2B5","user_header":"","comment_is_top":false,"comment_ctime":1638715486,"is_pvip":false,"replies":[{"id":"117894","content":"hi，你好。args.xxx是程序需要的参数，是文章里那个表格。<br>可以在文章中找这段话。<br>------<br>在开始之前，我先把程序需要的参数给你列一下，在下面的讲解中，我们就直接使用这些参数了。当你在实现今天代码的时候，需要将这些参数补充到代码中（可以使用 argparsem 模块）。","user_name":"作者回复","user_name_real":"作者","uid":"2802608","ctime":1638769034,"ip_address":"","comment_id":324916,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1638715486","product_id":100093301,"comment_content":" 方老师，请问main()函数里的各种args.xxx是什么意思？ 能猜到是类似字典的东西，但是在哪里输入呢？ 这次课程的代码在jupyter上报错&#39;NameError: name &#39;args&#39; is not defined&#39;","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536362,"discussion_content":"hi，你好。args.xxx是程序需要的参数，是文章里那个表格。\n可以在文章中找这段话。\n------\n在开始之前，我先把程序需要的参数给你列一下，在下面的讲解中，我们就直接使用这些参数了。当你在实现今天代码的时候，需要将这些参数补充到代码中（可以使用 argparsem 模块）。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638769034,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":2,"child_discussions":[{"author":{"id":2824511,"avatar":"","nickname":"Geek_a95f0e","note":"","ucode":"C0B7418FD1D2B5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":536380,"discussion_content":"好的，明白了，谢谢。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638774343,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":536362,"ip_address":""},"score":536380,"extra":""},{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"听水的湖","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":2824511,"avatar":"","nickname":"Geek_a95f0e","note":"","ucode":"C0B7418FD1D2B5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536513,"discussion_content":"解决就好，继续加油。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638800621,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":536380,"ip_address":""},"score":536513,"extra":""}]}]},{"had_liked":false,"id":323842,"user_name":"clee","can_delete":false,"product_type":"c1","uid":1467446,"ip_address":"","ucode":"122875102B23A8","user_header":"","comment_is_top":false,"comment_ctime":1638178677,"is_pvip":false,"replies":[{"id":"117539","content":"你好，代码看起来没有问题。可以看看数据分布是否平衡么、训练时是否使用pretrain model了以及模型是否收敛了。<br><br>Tensorboard中的loss你是说是一条直线吗？直线的数值等于最后一个epoch的loss？","user_name":"作者回复","user_name_real":"作者","uid":"2802608","ctime":1638235116,"ip_address":"","comment_id":323842,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1638178677","product_id":100093301,"comment_content":"你好，训练好的模型进行评估，从结果来看，好像都是都被分类为了Logo，可能哪儿出现了问题呢？以下是测试代码，另外有个问题是从tensorboard进行Loss数据分析发现，只展示最后一个epoch的Loss点？<br>    model = EfficientNet.from_name(&#39;efficientnet-b0&#39;)<br>    num_ftrs = model._fc.in_features<br>    model._fc = nn.Linear(num_ftrs, 2)<br>    model.load_state_dict(torch.load(&#39;.&#47;checkpoints&#47;checkpoint.pth.tar.epoch_19&#39;))<br>    image = Image.open(&#39;.&#47;data&#47;train&#47;logo&#47;09.jpg&#39;)<br>    transform = build_transform(224)<br>    input_tensor = transform(image).unsqueeze(0)<br>    pred = model(input_tensor)<br>    print(&quot;prediction:&quot;, pred)","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534574,"discussion_content":"你好，代码看起来没有问题。可以看看数据分布是否平衡么、训练时是否使用pretrain model了以及模型是否收敛了。\n\nTensorboard中的loss你是说是一条直线吗？直线的数值等于最后一个epoch的loss？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638235116,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":322990,"user_name":"Geek_8cfc4c","can_delete":false,"product_type":"c1","uid":2156103,"ip_address":"","ucode":"83EF0B576530E2","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM7uYZvwhrLHsJICstGXaOvUNZnyq0aO7gF0OLicMyZAZFnRiaDyvM1lGxnEDP2VUMV3m6UjiazMmSNGQ/132","comment_is_top":false,"comment_ctime":1637680034,"is_pvip":false,"replies":[{"id":"117268","content":"你好，感谢你的留言和认可。<br>model = EfficientNet.from_name(）之后需要修改一下全连接层的神经元的数目。<br>可以用下面的代码试试。<br>（应该是这个问题，如果不是的话，可以进微信群，把你的代码发给我看看，或者新开一个留言让我再看看提示什么信息。^^）<br><br>from efficientnet import EfficientNet<br>model = EfficientNet.from_name(&#39;efficientnet-b0&#39;)<br>num_ftrs = model._fc.in_features<br>model._fc = nn.Linear(num_ftrs, args.classes_num)<br><br>model.load_state_dict(torch.load(&#39;checkpoints&amp;#47;checkpoint.pth.tar.epoch_19&#39;)) <br><br>","user_name":"作者回复","user_name_real":"编辑","uid":"2802608","ctime":1637733210,"ip_address":"","comment_id":322990,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1637680034","product_id":100093301,"comment_content":"您好：<br><br>训练完成后，我尝试加载checkpoint里面模型进行推断，代码如下<br>```<br>from efficientnet import EfficientNet<br>model = EfficientNet.from_name(&#39;efficientnet-b0&#39;)<br>model.load_state_dict(torch.load(&#39;checkpoints&#47;checkpoint.pth.tar.epoch_19&#39;))<br>```<br><br>但是得到了如下错误:<br>```<br>RuntimeError: Error(s) in loading state_dict for EfficientNet:<br>\tsize mismatch for _fc.weight: copying a param with shape torch.Size([2, 1280]) from checkpoint, the shape in current model is torch.Size([1000, 1280]).<br>\tsize mismatch for _fc.bias: copying a param with shape torch.Size([2]) from checkpoint, the shape in current model is torch.Size([1000]).<br>```<br><br>在查看了网络结构后，计划修改weight和bias，但是这么搞也不对……<br>```model._fc.weight = torch.tensor(np.zeros((2,1280)))```<br><br>还望赐教<br>感谢您精彩的教程","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":532919,"discussion_content":"你好，感谢你的留言和认可。\nmodel = EfficientNet.from_name(）之后需要修改一下全连接层的神经元的数目。\n可以用下面的代码试试。\n（应该是这个问题，如果不是的话，可以进微信群，把你的代码发给我看看，或者新开一个留言让我再看看提示什么信息。^^）\n\nfrom efficientnet import EfficientNet\nmodel = EfficientNet.from_name(&#39;efficientnet-b0&#39;)\nnum_ftrs = model._fc.in_features\nmodel._fc = nn.Linear(num_ftrs, args.classes_num)\n\nmodel.load_state_dict(torch.load(&#39;checkpoints&amp;#47;checkpoint.pth.tar.epoch_19&#39;)) \n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637733210,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":322880,"user_name":"王珎","can_delete":false,"product_type":"c1","uid":2822974,"ip_address":"","ucode":"5074BA9DD3DE88","user_header":"https://static001.geekbang.org/account/avatar/00/2b/13/3e/d028cddd.jpg","comment_is_top":false,"comment_ctime":1637641896,"is_pvip":false,"replies":[{"id":"117235","content":"👍👍^^","user_name":"作者回复","user_name_real":"编辑","uid":"2802608","ctime":1637669327,"ip_address":"","comment_id":322880,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1637641896","product_id":100093301,"comment_content":"模型能尽可能的把线上所有极客时间的海报都找到，则应该侧重召回率，召回率越高越好。","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":532699,"discussion_content":"👍👍^^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637669327,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":322725,"user_name":"Geek_a26208","can_delete":false,"product_type":"c1","uid":2813268,"ip_address":"","ucode":"19B96AC127BF8B","user_header":"","comment_is_top":false,"comment_ctime":1637567806,"is_pvip":false,"replies":[{"id":"117183","content":"你好，感谢你的留言。看起来似乎日志打印有点问题。一个epoch打印了多次。<br>如果没解决的话，需要提供再详细一点的信息。","user_name":"作者回复","user_name_real":"编辑","uid":"2802608","ctime":1637576412,"ip_address":"","comment_id":322725,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1637567806","product_id":100093301,"comment_content":"Epoch  18 tensor(0.5764, grad_fn=&lt;NllLossBackward&gt;)<br>Epoch  18 tensor(0.8147, grad_fn=&lt;NllLossBackward&gt;)<br>Epoch  19 tensor(0.3332, grad_fn=&lt;NllLossBackward&gt;)<br>Epoch  19 tensor(0.1257, grad_fn=&lt;NllLossBackward&gt;)<br>Epoch  19 tensor(0.2692, grad_fn=&lt;NllLossBackward&gt;)<br>Epoch  19 tensor(0.2975, grad_fn=&lt;NllLossBackward&gt;)<br>Epoch  19 tensor(0.1212, grad_fn=&lt;NllLossBackward&gt;)<br><br>这结果是什么情况、、、","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"方远","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":532323,"discussion_content":"你好，感谢你的留言。看起来似乎日志打印有点问题。一个epoch打印了多次。\n如果没解决的话，需要提供再详细一点的信息。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637576412,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2823414,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM5RJskfTOqjCBNJ7dH0Th9L4yPsC8bXSpEpnJTtIfIMx0ia6icOt6UluD0rxBh2vF4xibQKfxRGfr9EA/132","nickname":"Geek_8a391d","note":"","ucode":"7A56B872B72D9F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537607,"discussion_content":"上面表格中的参数是用-连接的，代码里添加参数时要改成下划线_","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639117305,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2220867,"avatar":"https://static001.geekbang.org/account/avatar/00/21/e3/43/c37cccbe.jpg","nickname":"田丹丹","note":"","ucode":"50E2D6811C8651","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534456,"discussion_content":"精确率","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638194653,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}