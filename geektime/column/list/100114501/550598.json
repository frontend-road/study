{"id":550598,"title":"30ï½œç³»ç»Ÿç›‘æ§ï¼šå¦‚ä½•ä½¿ç”¨Metrics Serverå’ŒPrometheusï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯Chronoã€‚</p><p>åœ¨å‰é¢çš„ä¸¤èŠ‚è¯¾é‡Œï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¯¹Podå’Œå¯¹é›†ç¾¤çš„ä¸€äº›ç®¡ç†æ–¹æ³•ï¼Œå…¶ä¸­çš„è¦ç‚¹å°±æ˜¯è®¾ç½®èµ„æºé…é¢ï¼Œè®©Kubernetesç”¨æˆ·èƒ½å…¬å¹³åˆç†åœ°åˆ©ç”¨ç³»ç»Ÿèµ„æºã€‚</p><p>è™½ç„¶æœ‰äº†è¿™äº›æ–¹æ³•ï¼Œä½†è·ç¦»æˆ‘ä»¬æŠŠPodå’Œé›†ç¾¤ç®¡å¥½ç”¨å¥½è¿˜ç¼ºå°‘ä¸€ä¸ªå¾ˆé‡è¦çš„æ–¹é¢â€”â€”é›†ç¾¤çš„å¯è§‚æµ‹æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›ç»™é›†ç¾¤ä¹Ÿå®‰è£…ä¸Šâ€œæ£€æŸ¥æ¢é’ˆâ€ï¼Œè§‚å¯Ÿåˆ°é›†ç¾¤çš„èµ„æºåˆ©ç”¨ç‡å’Œå…¶ä»–æŒ‡æ ‡ï¼Œè®©é›†ç¾¤çš„æ•´ä½“è¿è¡ŒçŠ¶å†µå¯¹æˆ‘ä»¬â€œé€æ˜å¯è§â€ï¼Œè¿™æ ·æ‰èƒ½æ›´å‡†ç¡®æ›´æ–¹ä¾¿åœ°åšå¥½é›†ç¾¤çš„è¿ç»´å·¥ä½œã€‚</p><p>ä½†æ˜¯è§‚æµ‹é›†ç¾¤æ˜¯ä¸èƒ½ç”¨â€œæ¢é’ˆâ€è¿™ç§ç®€å•çš„æ–¹å¼çš„ï¼Œæ‰€ä»¥ä»Šå¤©æˆ‘å°±å¸¦ä½ ä¸€èµ·æ¥çœ‹çœ‹Kubernetesä¸ºé›†ç¾¤æä¾›çš„ä¸¤ç§ç³»ç»Ÿçº§åˆ«çš„ç›‘æ§é¡¹ç›®ï¼šMetrics Serverå’ŒPrometheusï¼Œä»¥åŠåŸºäºå®ƒä»¬çš„æ°´å¹³è‡ªåŠ¨ä¼¸ç¼©å¯¹è±¡HorizontalPodAutoscalerã€‚</p><h2>Metrics Server</h2><p>å¦‚æœä½ å¯¹Linuxç³»ç»Ÿæœ‰æ‰€äº†è§£çš„è¯ï¼Œä¹Ÿè®¸çŸ¥é“æœ‰ä¸€ä¸ªå‘½ä»¤ <code>top</code> èƒ½å¤Ÿå®æ—¶æ˜¾ç¤ºå½“å‰ç³»ç»Ÿçš„CPUå’Œå†…å­˜åˆ©ç”¨ç‡ï¼Œå®ƒæ˜¯æ€§èƒ½åˆ†æå’Œè°ƒä¼˜çš„åŸºæœ¬å·¥å…·ï¼Œéå¸¸æœ‰ç”¨ã€‚<strong>Kubernetesä¹Ÿæä¾›äº†ç±»ä¼¼çš„å‘½ä»¤ï¼Œå°±æ˜¯ <code>kubectl top</code>ï¼Œä¸è¿‡é»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªå‘½ä»¤ä¸ä¼šç”Ÿæ•ˆï¼Œå¿…é¡»è¦å®‰è£…ä¸€ä¸ªæ’ä»¶Metrics Serveræ‰å¯ä»¥ã€‚</strong></p><p>Metrics Serveræ˜¯ä¸€ä¸ªä¸“é—¨ç”¨æ¥æ”¶é›†Kubernetesæ ¸å¿ƒèµ„æºæŒ‡æ ‡ï¼ˆmetricsï¼‰çš„å·¥å…·ï¼Œå®ƒå®šæ—¶ä»æ‰€æœ‰èŠ‚ç‚¹çš„kubeleté‡Œé‡‡é›†ä¿¡æ¯ï¼Œä½†æ˜¯å¯¹é›†ç¾¤çš„æ•´ä½“æ€§èƒ½å½±å“æå°ï¼Œæ¯ä¸ªèŠ‚ç‚¹åªå¤§çº¦ä¼šå ç”¨1mçš„CPUå’Œ2MBçš„å†…å­˜ï¼Œæ‰€ä»¥æ€§ä»·æ¯”éå¸¸é«˜ã€‚</p><!-- [[[read_end]]] --><p>ä¸‹é¢çš„<a href=\"https://kubernetes.io/zh-cn/docs/tasks/debug/debug-cluster/resource-metrics-pipeline/#metrics-server\">è¿™å¼ å›¾</a>æ¥è‡ªKuberneteså®˜ç½‘ï¼Œä½ å¯ä»¥å¯¹Metrics Serverçš„å·¥ä½œæ–¹å¼æœ‰ä¸ªå¤§æ¦‚äº†è§£ï¼šå®ƒè°ƒç”¨kubeletçš„APIæ‹¿åˆ°èŠ‚ç‚¹å’ŒPodçš„æŒ‡æ ‡ï¼Œå†æŠŠè¿™äº›ä¿¡æ¯äº¤ç»™apiserverï¼Œè¿™æ ·kubectlã€HPAå°±å¯ä»¥åˆ©ç”¨apiserveræ¥è¯»å–æŒ‡æ ‡äº†ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/8f/9e/8f4a22788c03b06377cabe791c67989e.png?wh=1562x572\" alt=\"å›¾ç‰‡\"></p><p>åœ¨Metrics Serverçš„é¡¹ç›®ç½‘å€ï¼ˆ<a href=\"https://github.com/kubernetes-sigs/metrics-server\">https://github.com/kubernetes-sigs/metrics-server</a>ï¼‰å¯ä»¥çœ‹åˆ°å®ƒçš„è¯´æ˜æ–‡æ¡£å’Œå®‰è£…æ­¥éª¤ï¼Œä¸è¿‡å¦‚æœä½ å·²ç»æŒ‰ç…§<a href=\"https://time.geekbang.org/column/article/534762\">ç¬¬17è®²</a>ç”¨kubeadmæ­å»ºäº†Kubernetesé›†ç¾¤ï¼Œå°±å·²ç»å…·å¤‡äº†å…¨éƒ¨å‰ææ¡ä»¶ï¼Œæ¥ä¸‹æ¥åªéœ€è¦å‡ ä¸ªç®€å•çš„æ“ä½œå°±å¯ä»¥å®Œæˆå®‰è£…ã€‚</p><p>Metrics Serverçš„æ‰€æœ‰ä¾èµ–éƒ½æ”¾åœ¨äº†ä¸€ä¸ªYAMLæè¿°æ–‡ä»¶é‡Œï¼Œä½ å¯ä»¥ä½¿ç”¨wgetæˆ–è€…curlä¸‹è½½ï¼š</p><pre><code class=\"language-plain\">wget https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml\n</code></pre><p>ä½†æ˜¯åœ¨ <code>kubectl apply</code> åˆ›å»ºå¯¹è±¡ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸¤ä¸ªå‡†å¤‡å·¥ä½œè¦åšã€‚</p><p><strong>ç¬¬ä¸€ä¸ªå·¥ä½œï¼Œæ˜¯ä¿®æ”¹YAMLæ–‡ä»¶</strong>ã€‚ä½ éœ€è¦åœ¨Metrics Serverçš„Deploymentå¯¹è±¡é‡Œï¼ŒåŠ ä¸Šä¸€ä¸ªé¢å¤–çš„è¿è¡Œå‚æ•° <code>--kubelet-insecure-tls</code>ï¼Œä¹Ÿå°±æ˜¯è¿™æ ·ï¼š</p><pre><code class=\"language-yaml\">apiVersion: apps/v1\nkind: Deployment\nmetadata:\n&nbsp; name: metrics-server\n&nbsp; namespace: kube-system\nspec:\n  ... ... \n&nbsp; template:\n&nbsp; &nbsp; spec:\n&nbsp; &nbsp; &nbsp; containers:\n&nbsp; &nbsp; &nbsp; - args:\n&nbsp; &nbsp; &nbsp; &nbsp; - --kubelet-insecure-tls\n        ... ... \n</code></pre><p>è¿™æ˜¯å› ä¸ºMetrics Serveré»˜è®¤ä½¿ç”¨TLSåè®®ï¼Œè¦éªŒè¯è¯ä¹¦æ‰èƒ½ä¸kubeletå®ç°å®‰å…¨é€šä¿¡ï¼Œè€Œæˆ‘ä»¬çš„å®éªŒç¯å¢ƒé‡Œæ²¡æœ‰è¿™ä¸ªå¿…è¦ï¼ŒåŠ ä¸Šè¿™ä¸ªå‚æ•°å¯ä»¥è®©æˆ‘ä»¬çš„éƒ¨ç½²å·¥ä½œç®€å•å¾ˆå¤šï¼ˆç”Ÿäº§ç¯å¢ƒé‡Œå°±è¦æ…ç”¨ï¼‰ã€‚</p><p><strong>ç¬¬äºŒä¸ªå·¥ä½œï¼Œæ˜¯é¢„å…ˆä¸‹è½½Metrics Serverçš„é•œåƒã€‚</strong>çœ‹è¿™ä¸ªYAMLæ–‡ä»¶ï¼Œä½ ä¼šå‘ç°Metrics Serverçš„é•œåƒä»“åº“ç”¨çš„æ˜¯gcr.ioï¼Œä¸‹è½½å¾ˆå›°éš¾ã€‚å¥½åœ¨å®ƒä¹Ÿæœ‰å›½å†…çš„é•œåƒç½‘ç«™ï¼Œä½ å¯ä»¥ç”¨<a href=\"https://time.geekbang.org/column/article/534762\">ç¬¬17è®²</a>é‡Œçš„åŠæ³•ï¼Œä¸‹è½½åå†æ”¹åï¼Œç„¶åæŠŠé•œåƒåŠ è½½åˆ°é›†ç¾¤é‡Œçš„èŠ‚ç‚¹ä¸Šã€‚</p><p>è¿™é‡Œæˆ‘ç»™å‡ºä¸€æ®µShellè„šæœ¬ä»£ç ï¼Œä¾›ä½ å‚è€ƒï¼š</p><pre><code class=\"language-plain\">repo=registry.aliyuncs.com/google_containers\n\nname=k8s.gcr.io/metrics-server/metrics-server:v0.6.1\nsrc_name=metrics-server:v0.6.1\n\ndocker pull $repo/$src_name\n\ndocker tag $repo/$src_name $name\ndocker rmi $repo/$src_name\n</code></pre><p>ä¸¤ä¸ªå‡†å¤‡å·¥ä½œéƒ½å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨YAMLéƒ¨ç½²Metrics Serveräº†ï¼š</p><pre><code class=\"language-plain\">kubectl apply -f components.yaml\n</code></pre><p>Metrics Serverå±äºåå­—ç©ºé—´â€œkube-systemâ€ï¼Œå¯ä»¥ç”¨ <code>kubectl get pod</code> åŠ ä¸Š <code>-n</code> å‚æ•°æŸ¥çœ‹å®ƒæ˜¯å¦æ­£å¸¸è¿è¡Œï¼š</p><pre><code class=\"language-plain\">kubectl get pod -n kube-system\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/b9/93/b93124cbc1b7d98b7c4f055f0723bf93.png?wh=1506x822\" alt=\"å›¾ç‰‡\"></p><p>ç°åœ¨æœ‰äº†Metrics Serveræ’ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å‘½ä»¤ <code>kubectl top</code> æ¥æŸ¥çœ‹Kubernetesé›†ç¾¤å½“å‰çš„èµ„æºçŠ¶æ€äº†ã€‚å®ƒæœ‰<strong>ä¸¤ä¸ªå­å‘½ä»¤ï¼Œ<code>node</code> æŸ¥çœ‹èŠ‚ç‚¹çš„èµ„æºä½¿ç”¨ç‡ï¼Œ<code>pod</code> æŸ¥çœ‹Podçš„èµ„æºä½¿ç”¨ç‡</strong>ã€‚</p><p>ç”±äºMetrics Serveræ”¶é›†ä¿¡æ¯éœ€è¦æ—¶é—´ï¼Œæˆ‘ä»¬å¿…é¡»ç­‰ä¸€å°ä¼šå„¿æ‰èƒ½æ‰§è¡Œå‘½ä»¤ï¼ŒæŸ¥çœ‹é›†ç¾¤é‡ŒèŠ‚ç‚¹å’ŒPodçŠ¶æ€ï¼š</p><pre><code class=\"language-plain\">kubectl top node\nkubectl top pod -n kube-system\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/d4/61/d450b7e01f5f47ac56335f6c69707e61.png?wh=1800x1052\" alt=\"å›¾ç‰‡\"></p><p>ä»è¿™ä¸ªæˆªå›¾é‡Œä½ å¯ä»¥çœ‹åˆ°ï¼š</p><ul>\n<li>é›†ç¾¤é‡Œä¸¤ä¸ªèŠ‚ç‚¹CPUä½¿ç”¨ç‡éƒ½ä¸é«˜ï¼Œåˆ†åˆ«æ˜¯8%å’Œ4%ï¼Œä½†å†…å­˜ç”¨çš„å¾ˆå¤šï¼ŒmasterèŠ‚ç‚¹ç”¨äº†å·®ä¸å¤šä¸€åŠï¼ˆ48%ï¼‰ï¼Œè€ŒworkerèŠ‚ç‚¹å‡ ä¹ç”¨æ»¡äº†ï¼ˆ89%ï¼‰ã€‚</li>\n<li>åå­—ç©ºé—´â€œkube-systemâ€é‡Œæœ‰å¾ˆå¤šPodï¼Œå…¶ä¸­apiserveræœ€æ¶ˆè€—èµ„æºï¼Œä½¿ç”¨äº†75mçš„CPUå’Œ363MBçš„å†…å­˜ã€‚</li>\n</ul><h2>HorizontalPodAutoscaler</h2><p>æœ‰äº†Metrics Serverï¼Œæˆ‘ä»¬å°±å¯ä»¥è½»æ¾åœ°æŸ¥çœ‹é›†ç¾¤çš„èµ„æºä½¿ç”¨çŠ¶å†µäº†ï¼Œä¸è¿‡å®ƒå¦å¤–ä¸€ä¸ªæ›´é‡è¦çš„åŠŸèƒ½æ˜¯è¾…åŠ©å®ç°åº”ç”¨çš„â€œ<strong>æ°´å¹³è‡ªåŠ¨ä¼¸ç¼©</strong>â€ã€‚</p><p>åœ¨<a href=\"https://time.geekbang.org/column/article/535209\">ç¬¬18è®²</a>é‡Œæˆ‘ä»¬æåˆ°æœ‰ä¸€ä¸ªå‘½ä»¤ <code>kubectl scale</code>ï¼Œå¯ä»¥ä»»æ„å¢å‡Deploymentéƒ¨ç½²çš„Podæ•°é‡ï¼Œä¹Ÿå°±æ˜¯æ°´å¹³æ–¹å‘çš„â€œæ‰©å®¹â€å’Œâ€œç¼©å®¹â€ã€‚ä½†æ˜¯æ‰‹åŠ¨è°ƒæ•´åº”ç”¨å®ä¾‹æ•°é‡è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œéœ€è¦äººå·¥å‚ä¸ï¼Œä¹Ÿå¾ˆéš¾å‡†ç¡®æŠŠæ¡æ—¶æœºï¼Œéš¾ä»¥åŠæ—¶åº”å¯¹ç”Ÿäº§ç¯å¢ƒä¸­çªå‘çš„å¤§æµé‡ï¼Œæ‰€ä»¥æœ€å¥½èƒ½æŠŠè¿™ä¸ªâ€œæ‰©å®¹â€â€œç¼©å®¹â€ä¹Ÿå˜æˆè‡ªåŠ¨åŒ–çš„æ“ä½œã€‚</p><p>Kubernetesä¸ºæ­¤å°±å®šä¹‰äº†ä¸€ä¸ªæ–°çš„APIå¯¹è±¡ï¼Œå«åšâ€œ<strong>HorizontalPodAutoscaler</strong>â€ï¼Œç®€ç§°æ˜¯â€œ<strong>hpa</strong>â€ã€‚é¡¾åæ€ä¹‰ï¼Œå®ƒæ˜¯ä¸“é—¨ç”¨æ¥è‡ªåŠ¨ä¼¸ç¼©Podæ•°é‡çš„å¯¹è±¡ï¼Œé€‚ç”¨äºDeploymentå’ŒStatefulSetï¼Œä½†ä¸èƒ½ç”¨äºDaemonSetï¼ˆåŸå› å¾ˆæ˜æ˜¾å§ï¼‰ã€‚</p><p>HorizontalPodAutoscalerçš„èƒ½åŠ›å®Œå…¨åŸºäºMetrics Serverï¼Œå®ƒä»Metrics Serverè·å–å½“å‰åº”ç”¨çš„è¿è¡ŒæŒ‡æ ‡ï¼Œä¸»è¦æ˜¯CPUä½¿ç”¨ç‡ï¼Œå†ä¾æ®é¢„å®šçš„ç­–ç•¥å¢åŠ æˆ–è€…å‡å°‘Podçš„æ•°é‡ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹è¯¥æ€ä¹ˆä½¿ç”¨HorizontalPodAutoscalerï¼Œé¦–å…ˆè¦å®šä¹‰Deploymentå’ŒServiceï¼Œåˆ›å»ºä¸€ä¸ªNginxåº”ç”¨ï¼Œä½œä¸ºè‡ªåŠ¨ä¼¸ç¼©çš„ç›®æ ‡å¯¹è±¡ï¼š</p><pre><code class=\"language-yaml\">apiVersion: apps/v1\nkind: Deployment\nmetadata:\n&nbsp; name: ngx-hpa-dep\n\nspec:\n&nbsp; replicas: 1\n&nbsp; selector:\n&nbsp; &nbsp; matchLabels:\n&nbsp; &nbsp; &nbsp; app: ngx-hpa-dep\n\n&nbsp; template:\n&nbsp; &nbsp; metadata:\n&nbsp; &nbsp; &nbsp; labels:\n&nbsp; &nbsp; &nbsp; &nbsp; app: ngx-hpa-dep\n&nbsp; &nbsp; spec:\n&nbsp; &nbsp; &nbsp; containers:\n&nbsp; &nbsp; &nbsp; - image: nginx:alpine\n&nbsp; &nbsp; &nbsp; &nbsp; name: nginx\n&nbsp; &nbsp; &nbsp; &nbsp; ports:\n&nbsp; &nbsp; &nbsp; &nbsp; - containerPort: 80\n\n&nbsp; &nbsp; &nbsp; &nbsp; resources:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; requests:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cpu: 50m\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; memory: 10Mi\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; limits:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cpu: 100m\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; memory: 20Mi\n---\n\napiVersion: v1\nkind: Service\nmetadata:\n&nbsp; name: ngx-hpa-svc\nspec:\n&nbsp; ports:\n&nbsp; - port: 80\n&nbsp; &nbsp; protocol: TCP\n&nbsp; &nbsp; targetPort: 80\n&nbsp; selector:\n&nbsp; &nbsp; app: ngx-hpa-dep\n</code></pre><p>åœ¨è¿™ä¸ªYAMLé‡Œæˆ‘åªéƒ¨ç½²äº†ä¸€ä¸ªNginxå®ä¾‹ï¼Œåå­—æ˜¯ <code>ngx-hpa-dep</code>ã€‚<strong>æ³¨æ„åœ¨å®ƒçš„</strong> <code>spec</code> <strong>é‡Œä¸€å®šè¦ç”¨ <code>resources</code> å­—æ®µå†™æ¸…æ¥šèµ„æºé…é¢</strong>ï¼Œå¦åˆ™HorizontalPodAutoscalerä¼šæ— æ³•è·å–Podçš„æŒ‡æ ‡ï¼Œä¹Ÿå°±æ— æ³•å®ç°è‡ªåŠ¨åŒ–æ‰©ç¼©å®¹ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¦ç”¨å‘½ä»¤ <code>kubectl autoscale</code> åˆ›å»ºä¸€ä¸ªHorizontalPodAutoscalerçš„æ ·æ¿YAMLæ–‡ä»¶ï¼Œå®ƒæœ‰ä¸‰ä¸ªå‚æ•°ï¼š</p><ul>\n<li>minï¼ŒPodæ•°é‡çš„æœ€å°å€¼ï¼Œä¹Ÿå°±æ˜¯ç¼©å®¹çš„ä¸‹é™ã€‚</li>\n<li>maxï¼ŒPodæ•°é‡çš„æœ€å¤§å€¼ï¼Œä¹Ÿå°±æ˜¯æ‰©å®¹çš„ä¸Šé™ã€‚</li>\n<li>cpu-percentï¼ŒCPUä½¿ç”¨ç‡æŒ‡æ ‡ï¼Œå½“å¤§äºè¿™ä¸ªå€¼æ—¶æ‰©å®¹ï¼Œå°äºè¿™ä¸ªå€¼æ—¶ç¼©å®¹ã€‚</li>\n</ul><p>å¥½ï¼Œç°åœ¨æˆ‘ä»¬å°±æ¥ä¸ºåˆšæ‰çš„Nginxåº”ç”¨åˆ›å»ºHorizontalPodAutoscalerï¼ŒæŒ‡å®šPodæ•°é‡æœ€å°‘2ä¸ªï¼Œæœ€å¤š10ä¸ªï¼ŒCPUä½¿ç”¨ç‡æŒ‡æ ‡è®¾ç½®çš„å°ä¸€ç‚¹ï¼Œ5%ï¼Œæ–¹ä¾¿æˆ‘ä»¬è§‚å¯Ÿæ‰©å®¹ç°è±¡ï¼š</p><pre><code class=\"language-plain\">export out=\"--dry-run=client -o yaml\"              # å®šä¹‰Shellå˜é‡\nkubectl autoscale deploy ngx-hpa-dep --min=2 --max=10 --cpu-percent=5 $out\n</code></pre><p>å¾—åˆ°çš„YAMLæè¿°æ–‡ä»¶å°±æ˜¯è¿™æ ·ï¼š</p><pre><code class=\"language-yaml\">apiVersion: autoscaling/v1\nkind: HorizontalPodAutoscaler\nmetadata:\n&nbsp; name: ngx-hpa\n\nspec:\n&nbsp; maxReplicas: 10\n&nbsp; minReplicas: 2\n&nbsp; scaleTargetRef:\n&nbsp; &nbsp; apiVersion: apps/v1\n&nbsp; &nbsp; kind: Deployment\n&nbsp; &nbsp; name: ngx-hpa-dep\n&nbsp; targetCPUUtilizationPercentage: 5\n</code></pre><p>æˆ‘ä»¬å†ä½¿ç”¨å‘½ä»¤ <code>kubectl apply</code> åˆ›å»ºè¿™ä¸ªHorizontalPodAutoscaleråï¼Œå®ƒä¼šå‘ç°Deploymenté‡Œçš„å®ä¾‹åªæœ‰1ä¸ªï¼Œä¸ç¬¦åˆminå®šä¹‰çš„ä¸‹é™çš„è¦æ±‚ï¼Œå°±å…ˆæ‰©å®¹åˆ°2ä¸ªï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/3e/6c/3ec01a9746274ac28b10d612f1512a6c.png?wh=1630x704\" alt=\"å›¾ç‰‡\"></p><p>ä»è¿™å¼ æˆªå›¾é‡Œä½ å¯ä»¥çœ‹åˆ°ï¼ŒHorizontalPodAutoscalerä¼šæ ¹æ®YAMLé‡Œçš„æè¿°ï¼Œæ‰¾åˆ°è¦ç®¡ç†çš„Deploymentï¼ŒæŠŠPodæ•°é‡è°ƒæ•´æˆ2ä¸ªï¼Œå†é€šè¿‡Metrics Serverä¸æ–­åœ°ç›‘æµ‹Podçš„CPUä½¿ç”¨ç‡ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æ¥ç»™NginxåŠ ä¸Šå‹åŠ›æµé‡ï¼Œè¿è¡Œä¸€ä¸ªæµ‹è¯•Podï¼Œä½¿ç”¨çš„é•œåƒæ˜¯â€œ<strong>httpd:alpine</strong>â€ï¼Œå®ƒé‡Œé¢æœ‰HTTPæ€§èƒ½æµ‹è¯•å·¥å…·abï¼ˆApache Benchï¼‰ï¼š</p><pre><code class=\"language-plain\">kubectl run test -it --image=httpd:alpine -- sh\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/d0/bd/d058182500cb83ac3e3c9cc01a42c9bd.png?wh=1896x354\" alt=\"å›¾ç‰‡\"></p><p>ç„¶åæˆ‘ä»¬å‘Nginxå‘é€ä¸€ç™¾ä¸‡ä¸ªè¯·æ±‚ï¼ŒæŒç»­1åˆ†é’Ÿï¼Œå†ç”¨ <code>kubectl get hpa</code> æ¥è§‚å¯ŸHorizontalPodAutoscalerçš„è¿è¡ŒçŠ¶å†µï¼š</p><pre><code class=\"language-plain\">ab -c 10 -t 60 -n 1000000 'http://ngx-hpa-svc/'\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/65/b4/6538ecd78118fabeb8d7c8f4fbabdbb4.png?wh=1920x794\" alt=\"å›¾ç‰‡\"></p><p>å› ä¸ºMetrics Serverå¤§çº¦æ¯15ç§’é‡‡é›†ä¸€æ¬¡æ•°æ®ï¼Œæ‰€ä»¥HorizontalPodAutoscalerçš„è‡ªåŠ¨åŒ–æ‰©å®¹å’Œç¼©å®¹ä¹Ÿæ˜¯æŒ‰ç…§è¿™ä¸ªæ—¶é—´ç‚¹æ¥é€æ­¥å¤„ç†çš„ã€‚</p><p>å½“å®ƒå‘ç°ç›®æ ‡çš„CPUä½¿ç”¨ç‡è¶…è¿‡äº†é¢„å®šçš„5%åï¼Œå°±ä¼šä»¥2çš„å€æ•°å¼€å§‹æ‰©å®¹ï¼Œä¸€ç›´åˆ°æ•°é‡ä¸Šé™ï¼Œç„¶åæŒç»­ç›‘æ§ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœCPUä½¿ç”¨ç‡å›è½ï¼Œå°±ä¼šå†ç¼©å®¹åˆ°æœ€å°å€¼ã€‚</p><h2>Prometheus</h2><p>æ˜¾ç„¶ï¼Œæœ‰äº†Metrics Serverå’ŒHorizontalPodAutoscalerçš„å¸®åŠ©ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç®¡ç†å·¥ä½œåˆè½»æ¾äº†ä¸€äº›ã€‚ä¸è¿‡ï¼ŒMetrics Serverèƒ½å¤Ÿè·å–çš„æŒ‡æ ‡è¿˜æ˜¯å¤ªå°‘äº†ï¼Œåªæœ‰CPUå’Œå†…å­˜ï¼Œæƒ³è¦ç›‘æ§åˆ°æ›´å¤šæ›´å…¨é¢çš„åº”ç”¨è¿è¡ŒçŠ¶å†µï¼Œè¿˜å¾—è¯·å‡ºè¿™æ–¹é¢çš„æƒå¨é¡¹ç›®â€œ<strong>Prometheus</strong>â€ã€‚</p><p>å…¶å®ï¼ŒPrometheusçš„å†å²æ¯”Kubernetesè¿˜è¦æ—©ä¸€äº›ï¼Œå®ƒæœ€åˆæ˜¯ç”±Googleçš„ç¦»èŒå‘˜å·¥åœ¨2012å¹´åˆ›å»ºçš„å¼€æºé¡¹ç›®ï¼Œçµæ„Ÿæ¥æºäºBorgé…å¥—çš„BorgMonç›‘æ§ç³»ç»Ÿã€‚åæ¥åœ¨2016å¹´ï¼ŒPrometheusä½œä¸ºç¬¬äºŒä¸ªé¡¹ç›®åŠ å…¥äº†CNCFï¼Œå¹¶åœ¨2018å¹´ç»§Kubernetesä¹‹åé¡ºåˆ©æ¯•ä¸šï¼Œæˆä¸ºäº†CNCFçš„ä¸æŠ˜ä¸æ‰£çš„â€œäºŒå½“å®¶â€ï¼Œä¹Ÿæ˜¯äº‘åŸç”Ÿç›‘æ§é¢†åŸŸçš„â€œäº‹å®æ ‡å‡†â€ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/69/58/69f4b76ca7323433cyy28574f1ee9358.png?wh=1200x600\" alt=\"å›¾ç‰‡\"></p><p>å’ŒKubernetesä¸€æ ·ï¼ŒPrometheusä¹Ÿæ˜¯ä¸€ä¸ªåºå¤§çš„ç³»ç»Ÿï¼Œæˆ‘ä»¬è¿™é‡Œå°±åªåšä¸€ä¸ªç®€ç•¥çš„ä»‹ç»ã€‚</p><p>ä¸‹é¢çš„<a href=\"https://prometheus.io/docs/introduction/overview/\">è¿™å¼ å›¾</a>æ˜¯Prometheuså®˜æ–¹çš„æ¶æ„å›¾ï¼Œå‡ ä¹æ‰€æœ‰æ–‡ç« åœ¨è®²Prometheusçš„æ—¶å€™å¿…ç„¶è¦æ‹¿å‡ºæ¥ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿæ²¡åŠæ³•â€œå…ä¿—â€ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/e6/64/e62cebb3acc995246f203d698dfdc964.png?wh=1351x811\" alt=\"å›¾ç‰‡\"></p><p>Prometheusç³»ç»Ÿçš„æ ¸å¿ƒæ˜¯å®ƒçš„Serverï¼Œé‡Œé¢æœ‰ä¸€ä¸ªæ—¶åºæ•°æ®åº“TSDBï¼Œç”¨æ¥å­˜å‚¨ç›‘æ§æ•°æ®ï¼Œå¦ä¸€ä¸ªç»„ä»¶Retrievalä½¿ç”¨æ‹‰å–ï¼ˆPullï¼‰çš„æ–¹å¼ä»å„ä¸ªç›®æ ‡æ”¶é›†æ•°æ®ï¼Œå†é€šè¿‡HTTP ServeræŠŠè¿™äº›æ•°æ®äº¤ç»™å¤–ç•Œä½¿ç”¨ã€‚</p><p>åœ¨Prometheus Serverä¹‹å¤–è¿˜æœ‰ä¸‰ä¸ªé‡è¦çš„ç»„ä»¶ï¼š</p><ul>\n<li>Push Gatewayï¼Œç”¨æ¥é€‚é…ä¸€äº›ç‰¹æ®Šçš„ç›‘æ§ç›®æ ‡ï¼ŒæŠŠé»˜è®¤çš„Pullæ¨¡å¼è½¬å˜ä¸ºPushæ¨¡å¼ã€‚</li>\n<li>Alert Managerï¼Œå‘Šè­¦ä¸­å¿ƒï¼Œé¢„å…ˆè®¾å®šè§„åˆ™ï¼Œå‘ç°é—®é¢˜æ—¶å°±é€šè¿‡é‚®ä»¶ç­‰æ–¹å¼å‘Šè­¦ã€‚</li>\n<li>Grafanaæ˜¯å›¾å½¢åŒ–ç•Œé¢ï¼Œå¯ä»¥å®šåˆ¶å¤§é‡ç›´è§‚çš„ç›‘æ§ä»ªè¡¨ç›˜ã€‚</li>\n</ul><p>ç”±äºåŒå±äºCNCFï¼Œæ‰€ä»¥Prometheusè‡ªç„¶å°±æ˜¯â€œäº‘åŸç”Ÿâ€ï¼Œåœ¨Kubernetesé‡Œè¿è¡Œæ˜¯é¡ºç†æˆç« çš„äº‹æƒ…ã€‚ä¸è¿‡å®ƒåŒ…å«çš„ç»„ä»¶å®åœ¨æ˜¯å¤ªå¤šï¼Œéƒ¨ç½²èµ·æ¥æœ‰ç‚¹éº»çƒ¦ï¼Œè¿™é‡Œæˆ‘é€‰ç”¨äº†â€œ<strong>kube-prometheus</strong>â€é¡¹ç›®ï¼ˆ<a href=\"https://github.com/prometheus-operator/kube-prometheus/\">https://github.com/prometheus-operator/kube-prometheus/</a>ï¼‰ï¼Œæ„Ÿè§‰æ“ä½œèµ·æ¥æ¯”è¾ƒå®¹æ˜“äº›ã€‚</p><p>ä¸‹é¢å°±è·Ÿç€æˆ‘æ¥åœ¨Kuberneteså®éªŒç¯å¢ƒé‡Œä½“éªŒä¸€ä¸‹Prometheuså§ã€‚</p><p>æˆ‘ä»¬å…ˆè¦ä¸‹è½½kube-prometheusçš„æºç åŒ…ï¼Œå½“å‰çš„æœ€æ–°ç‰ˆæœ¬æ˜¯0.11ï¼š</p><pre><code class=\"language-plain\">wget https://github.com/prometheus-operator/kube-prometheus/archive/refs/tags/v0.11.0.tar.gz\n</code></pre><p>è§£å‹ç¼©åï¼ŒPrometheuséƒ¨ç½²ç›¸å…³çš„YAMLæ–‡ä»¶éƒ½åœ¨ <code>manifests</code> ç›®å½•é‡Œï¼Œæœ‰è¿‘100ä¸ªï¼Œä½ å¯ä»¥å…ˆå¤§æ¦‚çœ‹ä¸€ä¸‹ã€‚</p><p>å’ŒMetrics Serverä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¿…é¡»è¦åšä¸€äº›å‡†å¤‡å·¥ä½œï¼Œæ‰èƒ½å¤Ÿå®‰è£…Prometheusã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œæ˜¯ä¿®æ”¹ <code>prometheus-service.yaml</code>ã€<code>grafana-service.yaml</code>ã€‚</p><p>è¿™ä¸¤ä¸ªæ–‡ä»¶å®šä¹‰äº†Prometheuså’ŒGrafanaæœåŠ¡å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥ç»™å®ƒä»¬æ·»åŠ  <code>type: NodePort</code>ï¼ˆå‚è€ƒ<a href=\"https://time.geekbang.org/column/article/536829\">ç¬¬20è®²</a>ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥é€šè¿‡èŠ‚ç‚¹çš„IPåœ°å€è®¿é—®ï¼ˆå½“ç„¶ä½ ä¹Ÿå¯ä»¥é…ç½®æˆIngressï¼‰ã€‚</p><p><strong>ç¬¬äºŒæ­¥ï¼Œæ˜¯ä¿®æ”¹ <code>kubeStateMetrics-deployment.yaml</code>ã€<code>prometheusAdapter-deployment.yaml</code>ï¼Œå› ä¸ºå®ƒä»¬é‡Œé¢æœ‰ä¸¤ä¸ªå­˜æ”¾åœ¨gcr.ioçš„é•œåƒï¼Œå¿…é¡»è§£å†³ä¸‹è½½é•œåƒçš„é—®é¢˜ã€‚</strong></p><p>ä½†å¾ˆé—æ†¾ï¼Œæˆ‘æ²¡æœ‰åœ¨å›½å†…ç½‘ç«™ä¸Šæ‰¾åˆ°å®ƒä»¬çš„ä¸‹è½½æ–¹å¼ï¼Œä¸ºäº†èƒ½å¤Ÿé¡ºåˆ©å®‰è£…ï¼Œåªèƒ½æŠŠå®ƒä»¬ä¸‹è½½åå†ä¸Šä¼ åˆ°Docker Hubä¸Šã€‚æ‰€ä»¥ä½ éœ€è¦ä¿®æ”¹é•œåƒåå­—ï¼ŒæŠŠå‰ç¼€éƒ½æ”¹æˆ <code>chronolaw</code>ï¼š</p><pre><code class=\"language-plain\">image: k8s.gcr.io/kube-state-metrics/kube-state-metrics:v2.5.0\nimage: k8s.gcr.io/prometheus-adapter/prometheus-adapter:v0.9.1\n\nimage: chronolaw/kube-state-metrics:v2.5.0\nimage: chronolaw/prometheus-adapter:v0.9.1\n</code></pre><p>è¿™ä¸¤ä¸ªå‡†å¤‡å·¥ä½œå®Œæˆä¹‹åï¼Œæˆ‘ä»¬è¦æ‰§è¡Œä¸¤ä¸ª <code>kubectl create</code> å‘½ä»¤æ¥éƒ¨ç½²Prometheusï¼Œå…ˆæ˜¯ <code>manifests/setup</code> ç›®å½•ï¼Œåˆ›å»ºåå­—ç©ºé—´ç­‰åŸºæœ¬å¯¹è±¡ï¼Œç„¶åæ‰æ˜¯ <code>manifests</code> ç›®å½•ï¼š</p><pre><code class=\"language-plain\">kubectl create -f manifests/setup\nkubectl create -f manifests\n</code></pre><p>Prometheusçš„å¯¹è±¡éƒ½åœ¨åå­—ç©ºé—´â€œ<strong>monitoring</strong>â€é‡Œï¼Œåˆ›å»ºä¹‹åå¯ä»¥ç”¨ <code>kubectl get</code> æ¥æŸ¥çœ‹çŠ¶æ€ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/1b/09/1b4a1a1313ede9058b348c13a1020c09.png?wh=1894x878\" alt=\"å›¾ç‰‡\"></p><p>ç¡®å®šè¿™äº›Podéƒ½è¿è¡Œæ­£å¸¸ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹å®ƒå¯¹å¤–çš„æœåŠ¡ç«¯å£ï¼š</p><pre><code class=\"language-plain\">kubectl get svc -n monitoring\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/4c/59/4c423a203a688271d9d08b15a6782d59.png?wh=1920x531\" alt=\"å›¾ç‰‡\"></p><p>å‰é¢ä¿®æ”¹äº†Grafanaå’ŒPrometheusçš„Serviceå¯¹è±¡ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªæœåŠ¡å°±åœ¨èŠ‚ç‚¹ä¸Šå¼€äº†ç«¯å£ï¼ŒGrafanaæ˜¯â€œ30358â€ï¼ŒPrometheusæœ‰ä¸¤ä¸ªç«¯å£ï¼Œå…¶ä¸­â€œ9090â€å¯¹åº”çš„â€œ30827â€æ˜¯Webç«¯å£ã€‚</p><p>åœ¨æµè§ˆå™¨é‡Œè¾“å…¥èŠ‚ç‚¹çš„IPåœ°å€ï¼ˆæˆ‘è¿™é‡Œæ˜¯â€œ<a href=\"http://192.168.10.210\">http://192.168.10.210</a>â€ï¼‰ï¼Œå†åŠ ä¸Šç«¯å£å·â€œ30827â€ï¼Œæˆ‘ä»¬å°±èƒ½çœ‹åˆ°Prometheusè‡ªå¸¦çš„Webç•Œé¢ï¼Œï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/1b/dc/1b73040e258dfa8776c2a0a657a885dc.png?wh=1906x1934\" alt=\"å›¾ç‰‡\"></p><p>Webç•Œé¢ä¸Šæœ‰ä¸€ä¸ªæŸ¥è¯¢æ¡†ï¼Œå¯ä»¥ä½¿ç”¨PromQLæ¥æŸ¥è¯¢æŒ‡æ ‡ï¼Œç”Ÿæˆå¯è§†åŒ–å›¾è¡¨ï¼Œæ¯”å¦‚åœ¨è¿™ä¸ªæˆªå›¾é‡Œæˆ‘å°±é€‰æ‹©äº†â€œnode_memory_Active_bytesâ€è¿™ä¸ªæŒ‡æ ‡ï¼Œæ„æ€æ˜¯å½“å‰æ­£åœ¨ä½¿ç”¨çš„å†…å­˜å®¹é‡ã€‚</p><p>Prometheusçš„Webç•Œé¢æ¯”è¾ƒç®€å•ï¼Œé€šå¸¸åªç”¨æ¥è°ƒè¯•ã€æµ‹è¯•ï¼Œä¸é€‚åˆå®é™…ç›‘æ§ã€‚æˆ‘ä»¬å†æ¥çœ‹Grafanaï¼Œè®¿é—®èŠ‚ç‚¹çš„ç«¯å£â€œ30358â€ï¼ˆæˆ‘è¿™é‡Œæ˜¯â€œ<a href=\"http://192.168.10.210:30358\">http://192.168.10.210:30358</a>â€ï¼‰ï¼Œå®ƒä¼šè¦æ±‚ä½ å…ˆç™»å½•ï¼Œé»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯â€œ<strong>admin</strong>â€ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/a2/31/a2614b09347b3436c317644374c36e31.png?wh=1906x1934\" alt=\"å›¾ç‰‡\"></p><p>Grafanaå†…éƒ¨å·²ç»é¢„ç½®äº†å¾ˆå¤šå¼ºå¤§æ˜“ç”¨çš„ä»ªè¡¨ç›˜ï¼Œä½ å¯ä»¥åœ¨å·¦ä¾§èœå•æ çš„â€œDashboards - Browseâ€é‡Œä»»æ„æŒ‘é€‰ä¸€ä¸ªï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/23/5a/23ddb3db05e36c2da4a8f8067366f55a.png?wh=1906x1934\" alt=\"å›¾ç‰‡\"></p><p>æ¯”å¦‚æˆ‘é€‰æ‹©äº†â€œKubernetes / Compute Resources / Namespace (Pods)â€è¿™ä¸ªä»ªè¡¨ç›˜ï¼Œå°±ä¼šå‡ºæ¥ä¸€ä¸ªéå¸¸æ¼‚äº®å›¾è¡¨ï¼Œæ¯”Metrics Serverçš„ <code>kubectl top</code> å‘½ä»¤è¦å¥½çœ‹å¾—å¤šï¼Œå„ç§æ•°æ®ä¸€ç›®äº†ç„¶ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/1f/bd/1f6ccc0b6d358c29419276fbf74e38bd.png?wh=1920x1696\" alt=\"å›¾ç‰‡\"></p><p>å…³äºPrometheuså°±æš‚æ—¶ä»‹ç»åˆ°è¿™é‡Œï¼Œå†å¾€ä¸‹è®²å¯èƒ½å°±è¦åç¦»æˆ‘ä»¬çš„Kubernetesä¸»é¢˜äº†ï¼Œå¦‚æœä½ å¯¹å®ƒæ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥è¯¾åå†å»å®ƒçš„<a href=\"https://prometheus.io/\">å®˜ç½‘</a>ä¸Šçœ‹æ–‡æ¡£ï¼Œæˆ–è€…å‚è€ƒå…¶ä»–çš„å­¦ä¹ èµ„æ–™ã€‚</p><h2>å°ç»“</h2><p>åœ¨äº‘åŸç”Ÿæ—¶ä»£ï¼Œç³»ç»Ÿçš„é€æ˜æ€§å’Œå¯è§‚æµ‹æ€§æ˜¯éå¸¸é‡è¦çš„ã€‚ä»Šå¤©æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†Kubernetesé‡Œçš„ä¸¤ä¸ªç³»ç»Ÿç›‘æ§é¡¹ç›®ï¼šå‘½ä»¤è¡Œæ–¹å¼çš„Metrics Serverã€å›¾å½¢åŒ–ç•Œé¢çš„Prometheusï¼Œåˆ©ç”¨å¥½å®ƒä»¬å°±å¯ä»¥è®©æˆ‘ä»¬éšæ—¶æŒæ¡Kubernetesé›†ç¾¤çš„è¿è¡ŒçŠ¶æ€ï¼Œåšåˆ°â€œæ˜å¯Ÿç§‹æ¯«â€ã€‚</p><p>å†ç®€å•å°ç»“ä¸€ä¸‹ä»Šå¤©çš„å†…å®¹ï¼š</p><ol>\n<li>Metrics Serveræ˜¯ä¸€ä¸ªKubernetesæ’ä»¶ï¼Œèƒ½å¤Ÿæ”¶é›†ç³»ç»Ÿçš„æ ¸å¿ƒèµ„æºæŒ‡æ ‡ï¼Œç›¸å…³çš„å‘½ä»¤æ˜¯ <code>kubectl top</code>ã€‚</li>\n<li>Prometheusæ˜¯äº‘åŸç”Ÿç›‘æ§é¢†åŸŸçš„â€œäº‹å®æ ‡å‡†â€ï¼Œç”¨PromQLè¯­è¨€æ¥æŸ¥è¯¢æ•°æ®ï¼Œé…åˆGrafanaå¯ä»¥å±•ç¤ºç›´è§‚çš„å›¾å½¢ç•Œé¢ï¼Œæ–¹ä¾¿ç›‘æ§ã€‚</li>\n<li>HorizontalPodAutoscalerå®ç°äº†åº”ç”¨çš„è‡ªåŠ¨æ°´å¹³ä¼¸ç¼©åŠŸèƒ½ï¼Œå®ƒä»Metrics Serverè·å–åº”ç”¨çš„è¿è¡ŒæŒ‡æ ‡ï¼Œå†å®æ—¶è°ƒæ•´Podæ•°é‡ï¼Œå¯ä»¥å¾ˆå¥½åœ°åº”å¯¹çªå‘æµé‡ã€‚</li>\n</ol><h2>è¯¾ä¸‹ä½œä¸š</h2><p>æœ€åæ˜¯è¯¾ä¸‹ä½œä¸šæ—¶é—´ï¼Œç»™ä½ ç•™ä¸¤ä¸ªæ€è€ƒé¢˜ï¼š</p><ol>\n<li>éƒ¨ç½²äº†HorizontalPodAutoscalerä¹‹åï¼Œå¦‚æœå†æ‰§è¡Œ <code>kubectl scale</code> æ‰‹åŠ¨æ‰©å®¹ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</li>\n<li>ä½ æœ‰è¿‡åº”ç”¨ç›‘æ§çš„ç»éªŒå—ï¼Ÿåº”è¯¥å…³æ³¨å“ªäº›é‡è¦çš„æŒ‡æ ‡å‘¢ï¼Ÿ</li>\n</ol><p>éå¸¸æœŸå¾…åœ¨ç•™è¨€åŒºçœ‹åˆ°ä½ çš„å‘è¨€ï¼ŒåŒæˆ‘åŒå…¶ä»–åŒå­¦ä¸€èµ·è®¨è®ºã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/ff/01/ff8b9d4fdcd5d227a58391f215761601.jpg?wh=1920x2985\" alt=\"å›¾ç‰‡\"></p>","comments":[{"had_liked":false,"id":356557,"user_name":"é©¬ä»¥","can_delete":false,"product_type":"c1","uid":1344431,"ip_address":"åŒ—äº¬","ucode":"3FEA06CA14DE28","user_header":"https://static001.geekbang.org/account/avatar/00/14/83/af/1cb42cd3.jpg","comment_is_top":false,"comment_ctime":1662398064,"is_pvip":false,"replies":[{"id":129805,"content":"æ„Ÿè°¢åˆ†äº«ã€‚\n\nä¸çŸ¥é“ä¸ºä»€ä¹ˆprometheus-adapter:v0.9.1æœ‰é—®é¢˜ï¼Œå¯èƒ½æˆ‘ä¸Šä¼ çš„æ˜¯arm64ç‰ˆæœ¬çš„ï¼Œæœ‰ç©ºå†æ£€æŸ¥ä¸€ä¸‹ã€‚\n\nä¸‹è½½çœ‹äº†çœ‹ï¼Œsha256æ˜¯ä¸€æ ·çš„ï¼Œä¸çŸ¥é“å“ªé‡Œæœ‰é—®é¢˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":1181974,"ctime":1662436183,"ip_address":"åŒ—äº¬","comment_id":356557,"utype":1}],"discussion_count":9,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"æ“ä½œä¸­é‡åˆ°çš„é—®é¢˜ä»¥åŠè§£å†³åŠæ³•\n1: metris-serverå¦‚æœå‡ºç°æ‰§è¡Œå‘½ä»¤ kubectl top ä¸ç”Ÿæ•ˆå¯ä»¥åŠ å¦‚ä¸‹é…ç½®\n\tapiVersion: apps&#47;v1\n\tkind: Deployment\n\tmetadata:\n\t ...\n\t  \n\t  template:\n\t    ....\n\t    spec:\n\t      nodeName: k8s-master #ä½ è‡ªå·±çš„èŠ‚ç‚¹åç§°\n\n2: prometheus é•œåƒé—®é¢˜\n   è¿™é‡Œæˆ‘å·æ‡’ï¼Œä¸ç”¨éª‘é©´æ‰¾é©´äº†ï¼Œç›´æ¥ç”¨è€å¸ˆçš„\n\n   è¿™é‡Œæˆ‘å»ºè®®æ‚¨pushåˆ°docker hub (å› ä¸ºé›†ç¾¤æœ‰å¤šä¸ªèŠ‚ç‚¹ï¼Œpushåˆ°docker hubä¸Šï¼Œè¿™æ ·podè°ƒåº¦åˆ°ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥æ–¹ä¾¿ä¸‹è½½)\n\n   docker pull chronolaw&#47;kube-state-metrics:v2.5.0\n   docker tag chronolaw&#47;kube-state-metrics:v2.5.0 k8s.gcr.io&#47;kube-state-metrics&#47;kube-state-metrics:v2.5.0\n   docker rmi chronolaw&#47;kube-state-metrics:v2.5.0\n   docker push k8s.gcr.io&#47;kube-state-metrics&#47;kube-state-metrics:v2.5.0\n\n\n   prometheus-adapter è€å¸ˆçš„ç‰ˆæœ¬è¿è¡Œä¸èµ·æ¥ï¼Œæˆ‘åœ¨docker hubä¸Š æ‰¾äº†ä¸€ä¸ªå¯ä»¥ç”¨çš„\n\n   docker pull pengyc2019&#47;prometheus-adapter:v0.9.1\n   docker tag pengyc2019&#47;prometheus-adapter:v0.9.1 k8s.gcr.io&#47;prometheus-adapter&#47;prometheus-adapter:v0.9.1\n   docker rmi pengyc2019&#47;prometheus-adapter:v0.9.1\n   docker push k8s.gcr.io&#47;prometheus-adapter&#47;prometheus-adapter:v0.9.1\n\nç„¶åæ‰§è¡Œï¼š\n\tkubectl create -f manifests&#47;setup\n\tkubectl create -f manifests\n\n åˆ°æ­¤ï¼Œè¿è¡ŒæˆåŠŸ\n","like_count":14,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586689,"discussion_content":"æ„Ÿè°¢åˆ†äº«ã€‚\n\nä¸çŸ¥é“ä¸ºä»€ä¹ˆprometheus-adapter:v0.9.1æœ‰é—®é¢˜ï¼Œå¯èƒ½æˆ‘ä¸Šä¼ çš„æ˜¯arm64ç‰ˆæœ¬çš„ï¼Œæœ‰ç©ºå†æ£€æŸ¥ä¸€ä¸‹ã€‚\n\nä¸‹è½½çœ‹äº†çœ‹ï¼Œsha256æ˜¯ä¸€æ ·çš„ï¼Œä¸çŸ¥é“å“ªé‡Œæœ‰é—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662436183,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":2,"child_discussions":[{"author":{"id":1305810,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/prLO6VIcvsXMibOichyNgeMmgDlh8nS7q4F9a0PCkrL0OypFj0dQicDMRH0El7sdOF6srhJyKsfRNQJe10IJwHhoQ/132","nickname":"ä¸€è¡Œ","note":"","ucode":"849B58C31455DC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":598281,"discussion_content":"æˆ‘ä¹Ÿè¿è¡Œä¸èµ·æ¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672731963,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":586689,"ip_address":"æ²³å—","group_id":0},"score":598281,"extra":""},{"author":{"id":1899599,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/fc/4f/0a452c94.jpg","nickname":"å¤§æ¯›","note":"","ucode":"93B18287F06706","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":622020,"discussion_content":"chronolaw/prometheus-adapter                       v0.9.1          6cac3f74e9ca   20 months ago   64.4MB\npengyc2019/prometheus-adapter                      v0.9.1          179df2737843   20 months ago   68.2MB\n\nä»¥ä¸Šæ˜¯ä¸¤ä¸ªé•œåƒçš„ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°å“ˆå¸Œå€¼ä¸ä¸€æ ·ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯ç‰ˆæœ¬çš„é—®é¢˜ğŸ¤”\nå»ºè®®ä½¿ç”¨pengyc2019/prometheus-adapterçš„é•œåƒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1687854994,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":586689,"ip_address":"åŒ—äº¬","group_id":0},"score":622020,"extra":""}]},{"author":{"id":1066409,"avatar":"https://static001.geekbang.org/account/avatar/00/10/45/a9/3d48d6a2.jpg","nickname":"Lorry","note":"","ucode":"BD4754D0F1D786","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":602989,"discussion_content":"æ„Ÿè°¢åˆ†äº«ï¼Œæˆ‘ä¹Ÿæ˜¯å¡åœ¨äº†prometheus-adapterè¿™ä¸ªåœ°æ–¹å¥½ä¹…ï¼Œæ¢äº†ä¸€ä¸ªé•œåƒå¥½ç”¨äº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1675896603,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2161558,"avatar":"https://static001.geekbang.org/account/avatar/00/20/fb/96/791d0f5e.jpg","nickname":"å°ä¼™å„¿","note":"","ucode":"470DEA71CDD4F0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":594765,"discussion_content":"æ„Ÿè°¢åˆ†äº«ï¼ŒåŠ ä¸ŠnodeNameå°±å¯ä»¥ç”¨äº†ï¼","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1669358718,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1244730,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/InZgCgEZVcBWf3mWicd9LyyicZ31VzVYrCnP07DzV7eRIxfHZ4VeeGWaC8a0B1f5ibXxXt5SFgXzfMtgKPyE3FFWw/132","nickname":"å¥¹å’Œå¥¹çš„çŒ«","note":"","ucode":"8DF99F117B945E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":629765,"discussion_content":"è€å¸ˆçš„ prometheus-adapter é•œåƒæ˜¯ arm çš„ï¼Œå¦‚æœåœ¨ intel ä¸Šè¿è¡Œå°±ä¼šæŠ¥ exec format error é”™è¯¯ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1697614163,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1598417,"avatar":"https://static001.geekbang.org/account/avatar/00/18/63/d1/20e8389a.jpg","nickname":"é™ˆå°å¼º","note":"","ucode":"EA68B1E44455D0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":607151,"discussion_content":"è€å“¥ç‰›é€¼ï¼Œæ„Ÿè°¢åˆ†äº«ï¼Œæˆ‘ä¹Ÿæ˜¯åŠ ä¸ŠnodeNameå°±å¯ç”¨äº†ï¼›å¯ä»¥ç»†è¯´ä¸‹åŸå› ä¸","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677641972,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1394115,"avatar":"https://static001.geekbang.org/account/avatar/00/15/45/c3/775fe460.jpg","nickname":"rubys_","note":"","ucode":"931AD02864126A","race_medal":2,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591660,"discussion_content":"æˆ‘ä¹Ÿæ˜¯åŠ ä¸Š nodeName å°±å¥½äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666752308,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1155646,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKotsBr2icbYNYlRSlicGUD1H7lulSTQUAiclsEz9gnG5kCW9qeDwdYtlRMXic3V6sj9UrfKLPJnQojag/132","nickname":"ppd0705","note":"","ucode":"EB63D4E3FD1E9A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588493,"discussion_content":"æ„Ÿè°¢åˆ†äº« ï¼Œ åŠ ä¸Š nodeName å°±å¥½äº† ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663806260,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ¹–å—","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361163,"user_name":"é‚µæ¶µ","can_delete":false,"product_type":"c1","uid":1069135,"ip_address":"ä¸Šæµ·","ucode":"43A16551A82F2F","user_header":"","comment_is_top":false,"comment_ctime":1667290542,"is_pvip":false,"replies":[{"id":131367,"content":"greatï¼","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1667308366,"ip_address":"ä¸Šæµ·","comment_id":361163,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"åœ¨ä½¿ç”¨hpaåšè‡ªåŠ¨æ‰©å®¹&#47;ç¼©å®¹æ—¶ï¼Œé‡åˆ°äº†åªæ‰©å®¹ä¸ç¼©å®¹çš„é—®é¢˜ï¼Œå…·ä½“æƒ…å†µå¦‚ä¸‹ï¼š\n1. æŒ‰æ–‡ä¸­çš„æ­¥éª¤ï¼Œä½¿ç”¨abåŠ å‹ï¼Œå¯ä»¥çœ‹åˆ°podå¢åŠ åˆ°äº†10ä¸ª\n[shaohan@k8s4 ~]$ kubectl get hpa ngx-hpa -w\nNAME      REFERENCE                TARGETS   MINPODS   MAXPODS   REPLICAS   AGE\nngx-hpa   Deployment&#47;ngx-hpa-dep   150%&#47;5%   2         10        2          90s\nngx-hpa   Deployment&#47;ngx-hpa-dep   129%&#47;5%   2         10        4          105s\nngx-hpa   Deployment&#47;ngx-hpa-dep   93%&#47;5%    2         10        8          2m\nngx-hpa   Deployment&#47;ngx-hpa-dep   57%&#47;5%    2         10        10         2m15s\n2. åœ¨abåœæ­¢è¿è¡Œä¹‹åè¿‡äº†å‡ åˆ†é’Ÿï¼Œkubectl get hpa ngx-hpa -wçš„è¾“å‡ºä¸­æ‰å‡ºç°äº†ä¸€è¡Œæ–°æ•°æ®ï¼Œå¦‚ä¸‹\nngx-hpa   Deployment&#47;ngx-hpa-dep   0%&#47;5%     2         10        10         7m31s\nä»ç„¶æ˜¯10ä¸ªpodï¼Œå¹¶æ²¡æœ‰è‡ªåŠ¨ç¼©å®¹\n3. æŸ¥çœ‹pod\n[shaohan@k8s4 ~]$ kubectl get pod\nNAME                           READY   STATUS    RESTARTS     AGE\nngx-hpa-dep-86f66c75f5-d82rh   0&#47;1     Pending   0            63s\nngx-hpa-dep-86f66c75f5-dtc88   0&#47;1     Pending   0            63s\nï¼ˆå…¶ä»–ngx-hpa-dep-xxxçœç•¥ï¼Œå› ä¸ºè¯„è®ºå­—æ•°é™åˆ¶â€¦â€¦ï¼‰\ntest                           1&#47;1     Running   1 (6s ago)   2m5s\nå¯ä»¥çœ‹åˆ°ï¼Œæœ‰ä¸¤ä¸ªpodæ˜¯pendingçŠ¶æ€çš„ï¼Œkubectl describeè¿™ä¸¤ä¸ªpending podä¸­çš„ä¸€ä¸ªï¼Œå¯ä»¥çœ‹åˆ°\nWarning  FailedScheduling  18s (x2 over 85s)  default-scheduler  0&#47;2 nodes are available: 1 Insufficient cpu, 1 node(s) had taint {node-role.kubernetes.io&#47;master: }, that the pod didn&#39;t tolerate.\næ˜¯å› ä¸ºworkerèŠ‚ç‚¹èµ„æºä¸è¶³ï¼ŒmasterèŠ‚ç‚¹æ²¡æœ‰å¼€æ”¾ç»™podè°ƒåº¦ï¼Œé€ æˆæ‰©å®¹æ—¶æœ‰ä¸¤ä¸ªpodè™½ç„¶åˆ›å»ºäº†ï¼Œä½†ä¸€ç›´åœ¨ç­‰å¾…èµ„æºè€Œæ²¡æœ‰è¿›å…¥runningçŠ¶æ€\n4. æ‰‹åŠ¨åˆ é™¤äº†ç”¨äºæ‰§è¡Œabçš„apache podï¼Œé‡Šæ”¾èµ„æºï¼Œç„¶åç«‹åˆ»æŸ¥çœ‹podï¼Œå°±åªæœ‰ä¸¤ä¸ªäº†\nkubectl get hpa ngx-hpa -wçš„è¾“å‡ºä¸­ä¹Ÿå‡ºç°äº†ä¸€è¡Œæ–°æ•°æ®\nngx-hpa   Deployment&#47;ngx-hpa-dep   0%&#47;5%     2         10        2          7m46s\nè‡ªåŠ¨ç¼©å®¹æˆåŠŸæ‰§è¡Œäº†\n\næ‰€ä»¥ï¼Œçœ‹èµ·æ¥ï¼Œhpaæ˜¯â€œä¸¥æ ¼æŒ‰é¡ºåºæ‰§è¡Œçš„â€ï¼Œå®ƒæŒ‰ç…§è§„åˆ™è®¾å®šçš„æ¡ä»¶ï¼Œè¦æ‰©å®¹åˆ°10ä¸ªpodï¼Œåœ¨10ä¸ªpodå…¨éƒ½runningä¹‹å‰ï¼Œå³ä½¿å·²ç»ç¬¦åˆç¼©å®¹çš„æ¡ä»¶äº†ï¼Œå®ƒä¹Ÿä¸æ‰§è¡Œç¼©å®¹ï¼Œè€Œæ˜¯è¦ç­‰åˆ°ä¹‹å‰æ‰©å®¹çš„æ“ä½œå½»åº•å®Œæˆï¼Œä¹Ÿå°±æ˜¯10ä¸ªpodå…¨éƒ½runningäº†ï¼Œæ‰ä¼šæ‰§è¡Œç¼©å®¹","like_count":8,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592326,"discussion_content":"greatï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667308366,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356054,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"åŒ—äº¬","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1661937470,"is_pvip":false,"replies":[{"id":129583,"content":"\n1. æ˜¯çš„ã€‚Grafanaæ˜¯ç‹¬ç«‹çš„é¡¹ç›®ï¼Œå›¾çœäº‹å°±å’ŒPrometheusåœ¨ä¸€èµ·è¯´äº†ï¼Œå¯èƒ½é€ æˆäº†è¯¯è§£ï¼ŒæŠ±æ­‰ã€‚\n\n2.é•œåƒæ‹‰å–å¤±è´¥å’Œtlsæ²¡å…³ç³»ï¼Œå¯ä»¥è‡ªå·±ç”¨docker pullå‘½ä»¤å†å°è¯•ä¸€ä¸‹ã€‚\n\n3.create æ¢æˆdeleteï¼Œå…ˆæ˜¯manifestsï¼Œç„¶åæ˜¯setupï¼Œä½ çš„ç†è§£æ­£ç¡®ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1661941259,"ip_address":"åŒ—äº¬","comment_id":356054,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"è¯·æ•™è€å¸ˆå‡ ä¸ªé—®é¢˜ï¼š\nQ1ï¼šGrafana ä¸æ˜¯Prometheusçš„ç»„ä»¶å§\næ¶æ„å›¾ä¸­æ ‡çº¢è‰²çš„æ˜¯å±äºPrometheusï¼Œåœ¨UIæ–¹é¢ï¼Œæ¶æ„å›¾ä¸­çš„â€prometheus web uiâ€åº”è¯¥æ˜¯Prometheusçš„ç»„ä»¶å§ã€‚Grafanaå¥½åƒæ˜¯ä¸€ä¸ªå…¬å…±ç»„ä»¶ï¼Œä¸æ˜¯Prometheusç‹¬æœ‰çš„ã€‚\n\nQ2: Prometheuséƒ¨ç½²åæœ‰å››ä¸ªPODçš„çŠ¶æ€ä¸æ˜¯RUNNING\nblackbox-exporter-746c64fd88-ts299ï¼šçŠ¶æ€æ˜¯ImagePullBackOff\nprometheus-adapter-8547d6666f-6npn6ï¼šçŠ¶æ€æ˜¯CrashLoopBackOffï¼Œ\né”™è¯¯ä¿¡æ¯ï¼š\nsc = Get &quot;https:&#47;&#47;registry-1.docker.io&#47;v2&#47;jimmidyson&#47;configmap-reload&#47;manifests&#47;sha256:91467ba755a0c41199a63fe80a2c321c06edc4d3affb4f0ab6b3d20a49ed88d1&quot;: net&#47;http: TLS handshake timeout\nå¥½åƒå’ŒTLSæœ‰å…³ï¼Œéœ€è¦å’ŒMetrics Serverä¸€æ ·åŠ â€œkubelet-insecure-tlsâ€å—ï¼Ÿåœ¨å“ªä¸ªYAMLæ–‡ä»¶ä¸­ä¿®æ”¹ï¼Ÿ\n\nQ3ï¼šPrometheuséƒ¨ç½²çš„é€†å‘æ“ä½œæ˜¯ä»€ä¹ˆï¼Ÿ\nç”¨è¿™ä¸¤ä¸ªå‘½ä»¤æ¥éƒ¨ç½²ï¼š\nkubectl create -f manifests&#47;setup\nkubectl create -f manifests\n\néƒ¨ç½²åï¼Œå¦‚æœæƒ³é‡æ–°éƒ¨ç½²ï¼Œéœ€è¦æ¸…ç†ç¯å¢ƒï¼Œé‚£ä¹ˆï¼Œæ€ä¹ˆæ¸…ç†æ‰ä»¥å‰éƒ¨ç½²çš„ä¸œè¥¿ï¼Ÿ\nå’Œkubectl create -f manifests&#47;setupç›¸åçš„æ“ä½œæ˜¯â€œkubectl delete -f manifests&#47;setupâ€å—ï¼Ÿ","like_count":8,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586031,"discussion_content":"\n1. æ˜¯çš„ã€‚Grafanaæ˜¯ç‹¬ç«‹çš„é¡¹ç›®ï¼Œå›¾çœäº‹å°±å’ŒPrometheusåœ¨ä¸€èµ·è¯´äº†ï¼Œå¯èƒ½é€ æˆäº†è¯¯è§£ï¼ŒæŠ±æ­‰ã€‚\n\n2.é•œåƒæ‹‰å–å¤±è´¥å’Œtlsæ²¡å…³ç³»ï¼Œå¯ä»¥è‡ªå·±ç”¨docker pullå‘½ä»¤å†å°è¯•ä¸€ä¸‹ã€‚\n\n3.create æ¢æˆdeleteï¼Œå…ˆæ˜¯manifestsï¼Œç„¶åæ˜¯setupï¼Œä½ çš„ç†è§£æ­£ç¡®ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661941259,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356226,"user_name":"ningfei","can_delete":false,"product_type":"c1","uid":2034586,"ip_address":"ä¸Šæµ·","ucode":"2C070E174A34CA","user_header":"https://static001.geekbang.org/account/avatar/00/1f/0b/9a/8ff51c91.jpg","comment_is_top":false,"comment_ctime":1662054015,"is_pvip":false,"replies":[{"id":129670,"content":"good","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1662086746,"ip_address":"ä¸Šæµ·","comment_id":356226,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"prometheus-adapteré‡Œä½¿ç”¨è¿™ä¸ªwilldockerhub&#47;prometheus-adapter:v0.9.1é•œåƒ,å¯ä»¥å¯åŠ¨æˆåŠŸ","like_count":3,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586275,"discussion_content":"good","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662086746,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":363572,"user_name":"XXG","can_delete":false,"product_type":"c1","uid":1219238,"ip_address":"ä¸Šæµ·","ucode":"55258F95874BF4","user_header":"https://static001.geekbang.org/account/avatar/00/12/9a/a6/29ac6f6a.jpg","comment_is_top":false,"comment_ctime":1669819726,"is_pvip":false,"replies":[{"id":132135,"content":"goodï¼Œå¤šå®è·µï¼Œé›†ç¾¤ç®¡ç†å’Œæœ¬æœºç®¡ç†çš„å·®è·è¾ƒå¤§ï¼Œå¾ˆå¤šæ—¶å€™ä¼šå¼„æ··ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1669863239,"ip_address":"ä¸Šæµ·","comment_id":363572,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"metrics-server-85bc76798b-hr56n           0&#47;1     ImagePullBackOff åŸå› ï¼š\n\n&lt;1&gt; æ³¨æ„metrics-serverç‰ˆæœ¬ï¼Œæˆ‘æ‹‰ä¸‹æ¥çš„ymlæ–‡ä»¶ç‰ˆæœ¬å˜æˆäº†v0.6.2ï¼Œæ‰€ä»¥è¦æ ¹æ®æœ€æ–°çš„components.yamlæ–‡ä»¶ä¸­çš„metrics-serverç‰ˆæœ¬å¯¹åº”æ”¹ä¸€ä¸‹è€å¸ˆçš„è„šæœ¬ï¼›\n&lt;2&gt; æ³¨æ„è¦åœ¨WorkerèŠ‚ç‚¹æ‰§è¡Œè„šæœ¬ï¼Œæˆ‘å°±åœ¨masterèŠ‚ç‚¹ä¸Šæ‰§è¡Œäº†å¥½å‡ éã€‚ã€‚ã€‚","like_count":2,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":595228,"discussion_content":"goodï¼Œå¤šå®è·µï¼Œé›†ç¾¤ç®¡ç†å’Œæœ¬æœºç®¡ç†çš„å·®è·è¾ƒå¤§ï¼Œå¾ˆå¤šæ—¶å€™ä¼šå¼„æ··ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1669863239,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358750,"user_name":"dao","can_delete":false,"product_type":"c1","uid":1087879,"ip_address":"åŒ—äº¬","ucode":"4181FB270462CF","user_header":"https://static001.geekbang.org/account/avatar/00/10/99/87/5066026c.jpg","comment_is_top":false,"comment_ctime":1664683401,"is_pvip":false,"replies":[{"id":130520,"content":"awesome!","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1664754971,"ip_address":"åŒ—äº¬","comment_id":358750,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"ç®€å•çš„å›ç­”ä¸€ä¸‹æ€è€ƒé¢˜ï¼Œ\n\n1ï¼Œä¼šæ ¹æ®è®¾ç½®è¿›è¡Œæ‰©å®¹ï¼ˆscale outï¼‰ï¼Œä½†æ˜¯å¦‚æœä¸æ»¡è¶³ HPA çš„æŒ‡æ ‡æ¡ä»¶ï¼Œæ¥ç€ä¼šç«‹å³è¿›è¡Œç¼©å®¹ï¼ˆscale inï¼‰ï¼Œä¸‹é¢æ˜¯æˆ‘çš„æ“ä½œè§‚å¯Ÿåˆ°çš„æ—¥å¿—\n---\nNormal  SuccessfulCreate  3s    replicaset-controller  Created pod: ngx-hpa-dep-86f66c75f5-z2gjk\nNormal  SuccessfulCreate  3s    replicaset-controller  Created pod: ngx-hpa-dep-86f66c75f5-p46lr\nNormal  SuccessfulDelete  3s    replicaset-controller  Deleted pod: ngx-hpa-dep-86f66c75f5-z2gjk\nNormal  SuccessfulDelete  3s    replicaset-controller  Deleted pod: ngx-hpa-dep-86f66c75f5-p46lr\n---\n\n2ï¼Œæˆ‘ç°æœ‰çš„ç»éªŒå¾ˆæœ‰é™ï¼Œä¸»è¦é›†ä¸­åœ¨å•æœº&#47;é›†ç¾¤æœºå™¨æŒ‡æ ‡çš„ç›‘æ§ï¼Œä»¥åŠå¯¹äºåº”ç”¨åŠäº§å“çš„ç›‘æ§ï¼ˆé€šè¿‡ç›‘æ§æ—¥å¿—å®ç°çš„ï¼‰ï¼ŒåŒæ—¶ç»“åˆä¸€äº›å‘Šè­¦ç³»ç»Ÿï¼ˆalertï¼‰ï¼Œä»¥ä¾¿å¿«é€Ÿå‘ç°æ•…éšœåŠè§£å†³ã€‚\nå…³æ³¨çš„æŒ‡æ ‡æœ‰ CPUã€å†…å­˜ã€ç½‘å¡ã€ç£ç›˜è¯»å†™ï¼Œåº”ç”¨çš„æ€§èƒ½ç›‘æ§å’Œé”™è¯¯ç‡ï¼ˆå¯ç”¨æ€§ï¼‰ç›‘æ§ã€‚æ€§èƒ½ç›‘æ§æŒ‡æ ‡ä¸»è¦æ˜¯å“åº”æ—¶é—´ï¼ˆRTï¼‰ã€å„ç§ååé‡ï¼ˆæ¯”å¦‚QPSï¼‰ç­‰ã€‚é”™è¯¯ç‡æŒ‡æ ‡ä¸»è¦æ˜¯æŒ‡åº”ç”¨é”™è¯¯åŠå¼‚å¸¸ã€HTTPé”™è¯¯å“åº”ä»£ç ç­‰ã€‚","like_count":2,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589357,"discussion_content":"awesome!","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1664754971,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356210,"user_name":"æ”¾ä¸ä¸‹è£åå¯Œè´µ","can_delete":false,"product_type":"c1","uid":2053679,"ip_address":"ä¸Šæµ·","ucode":"9FE29C22B9ABE3","user_header":"https://static001.geekbang.org/account/avatar/00/1f/56/2f/4518f8e1.jpg","comment_is_top":false,"comment_ctime":1662043308,"is_pvip":false,"replies":[{"id":129668,"content":"è¿˜å¯ä»¥åŸºäºå…¶ä»–çš„ä¸€äº›è‡ªå®šä¹‰æŒ‡æ ‡ï¼ŒKubernetesåœ¨è¿™é‡Œæä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„å¯æ‰©å±•çš„æ¡†æ¶ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1662086685,"ip_address":"ä¸Šæµ·","comment_id":356210,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"è‡ªåŠ¨æ‰©å®¹çš„è¯ï¼Œé€šå¸¸ç”Ÿäº§ç¯å¢ƒå¸¸ç”¨çš„æŒ‡æ ‡æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ\n\næ–‡ä¸­é‡‡ç”¨cpuå ç”¨ç‡ï¼Œæ¯”å¦‚md5sumæ˜¯éå¸¸åå‘äºcpuè¿ç®—çš„å·¥ä½œï¼Œä½†æ‰©å®¹å¯èƒ½å¹¶ä¸èƒ½è¾¾åˆ°é¢„æœŸçš„æ•ˆæœï¼ˆå·¥ä½œå æ»¡äº†ä¸€ä¸ªæ ¸ä½†æ˜¯å†å¤šä¸€ä¸ªæ ¸å´ä¸èƒ½åˆ†æ‘Šè¿™ä¸ªå·¥ä½œï¼‰ã€‚\næ‰€ä»¥çœ‹èµ·æ¥ç³»ç»Ÿè´Ÿè½½è€Œéå ç”¨ç‡åº”è¯¥æ˜¯æ›´å¥½çš„æ‰©å®¹æŒ‡æ ‡ï¼Œä¸çŸ¥é“æˆ‘è¿™ä¹ˆç†è§£æ˜¯å¦æ­£ç¡®ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586273,"discussion_content":"è¿˜å¯ä»¥åŸºäºå…¶ä»–çš„ä¸€äº›è‡ªå®šä¹‰æŒ‡æ ‡ï¼ŒKubernetesåœ¨è¿™é‡Œæä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„å¯æ‰©å±•çš„æ¡†æ¶ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662086685,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":368658,"user_name":"è¿ç»´èµµå®ä¸š","can_delete":false,"product_type":"c1","uid":1292802,"ip_address":"åŒ—äº¬","ucode":"A7002175B4403A","user_header":"https://static001.geekbang.org/account/avatar/00/13/ba/02/78e0d4ac.jpg","comment_is_top":false,"comment_ctime":1676534427,"is_pvip":false,"replies":[{"id":134271,"content":"è¿™ä¸ªä¸æ˜¯å¤ªç¡®å®šï¼Œå¯èƒ½è¦å¯¹è¿ç»´æ¯”è¾ƒç†Ÿæ‚‰çš„åŒå­¦æ¥è§£ç­”äº†ï¼Œæˆ‘ç†è§£åº”è¯¥æ˜¯è¿™æ ·ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1676554008,"ip_address":"ä¸Šæµ·","comment_id":368658,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œè¯·æ•™ä¸‹ï¼Œå¤šk8sé›†ç¾¤çš„åœºæ™¯ä¸‹ï¼Œæ¯ä¸ªé›†ç¾¤å†…éƒ½è¦éƒ¨ç½²ä¸€å¥—kube-prometheuså—ï¼Ÿæ„Ÿè°¢","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":605027,"discussion_content":"è¿™ä¸ªä¸æ˜¯å¤ªç¡®å®šï¼Œå¯èƒ½è¦å¯¹è¿ç»´æ¯”è¾ƒç†Ÿæ‚‰çš„åŒå­¦æ¥è§£ç­”äº†ï¼Œæˆ‘ç†è§£åº”è¯¥æ˜¯è¿™æ ·ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1676554008,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":367748,"user_name":"Lorry","can_delete":false,"product_type":"c1","uid":1066409,"ip_address":"å››å·","ucode":"BD4754D0F1D786","user_header":"https://static001.geekbang.org/account/avatar/00/10/45/a9/3d48d6a2.jpg","comment_is_top":false,"comment_ctime":1675557369,"is_pvip":false,"replies":[{"id":133943,"content":"å¯ä»¥çš„ï¼Œæœ‰ä¸ªhostNetworkå±æ€§ï¼ŒæŸ¥ä¸€ä¸‹èµ„æ–™ï¼Œæˆ‘ä»¬çš„è¯¾ç¨‹é‡Œä¹Ÿç”¨è¿‡ä¸€æ¬¡ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":1181974,"ctime":1675639399,"ip_address":"åŒ—äº¬","comment_id":367748,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"è€å¸ˆï¼Œæœ‰æ²¡æœ‰åŠæ³•èƒ½å¤Ÿè®©k8sè®¿é—®å®¿ä¸»æœºç½‘ç»œï¼Ÿç‰©ç†æœºå®‰è£…prometus+grafanaæ¯”è¾ƒéº»çƒ¦ï¼Œå¦‚æœèƒ½å¤Ÿç›´æ¥é€šè¿‡docker&#47;k8sè£…å¥½å°±æ–¹ä¾¿å¾ˆå¤šï¼›ä½†æ˜¯ç°åœ¨ç”Ÿäº§&#47;æµ‹è¯•ç¯å¢ƒéƒ½æ˜¯ç‰©ç†æœºç¯å¢ƒï¼Œæ‰€ä»¥æƒ³è¦åå‘é€šè¿‡k8sçš„åº”ç”¨ç›‘æ§å®¿ä¸»æœºæ‰€åœ¨ç½‘ç»œçš„æœåŠ¡ã€‚\n\nåº”è¯¥æ€ä¹ˆé…ç½®å‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":602037,"discussion_content":"å¯ä»¥çš„ï¼Œæœ‰ä¸ªhostNetworkå±æ€§ï¼ŒæŸ¥ä¸€ä¸‹èµ„æ–™ï¼Œæˆ‘ä»¬çš„è¯¾ç¨‹é‡Œä¹Ÿç”¨è¿‡ä¸€æ¬¡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1675639399,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361178,"user_name":"é‚µæ¶µ","can_delete":false,"product_type":"c1","uid":1069135,"ip_address":"ä¸Šæµ·","ucode":"43A16551A82F2F","user_header":"","comment_is_top":false,"comment_ctime":1667293241,"is_pvip":false,"replies":[{"id":131369,"content":"æ„Ÿè§‰è¿™ä¸ªä¸æ˜¯å¤ªå¥½çš„åŠæ³•ï¼Œå°½é‡ä¸è¦ç”¨hostNetwork: trueã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1667308495,"ip_address":"ä¸Šæµ·","comment_id":361178,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"å®‰è£…metrics serverä¹‹åï¼Œkubectl topæ‰§è¡Œå¤±è´¥ï¼Œå¦‚ä¸‹\n[shaohan@k8s4 ~]$ kubectl top node\nError from server (ServiceUnavailable): the server is currently unable to handle the request (get nodes.metrics.k8s.io)\n\næ‰§è¡Œkubectl get apiservice v1beta1.metrics.k8s.io -o yamlçœ‹åˆ°\nstatus:\n  conditions:\n  - lastTransitionTime: &quot;2022-10-29T09:57:08Z&quot;\n    message: &#39;failing or missing response from https:&#47;&#47;10.98.115.140:443&#47;apis&#47;metrics.k8s.io&#47;v1beta1:\n      Get &quot;https:&#47;&#47;10.98.115.140:443&#47;apis&#47;metrics.k8s.io&#47;v1beta1&quot;: dial tcp 10.98.115.140:443:\n      i&#47;o timeout&#39;\n    reason: FailedDiscoveryCheck\n    status: &quot;False&quot;\n    type: Available\nåœ¨components.yamlä¸­ç»™deploymentå¯¹è±¡æ·»åŠ hostNetwork: trueï¼ˆåœ¨spec-&gt;template-&gt;specä¸‹ï¼‰å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592328,"discussion_content":"æ„Ÿè§‰è¿™ä¸ªä¸æ˜¯å¤ªå¥½çš„åŠæ³•ï¼Œå°½é‡ä¸è¦ç”¨hostNetwork: trueã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667308495,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1244730,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/InZgCgEZVcBWf3mWicd9LyyicZ31VzVYrCnP07DzV7eRIxfHZ4VeeGWaC8a0B1f5ibXxXt5SFgXzfMtgKPyE3FFWw/132","nickname":"å¥¹å’Œå¥¹çš„çŒ«","note":"","ucode":"8DF99F117B945E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":629719,"discussion_content":"è¿™ä¸ªå¸®åŠ©æˆ‘è§£å†³äº†é—®é¢˜ï¼Œæˆ‘çŒœæµ‹æ˜¯ master ä¸ worker ä¸åœ¨åŒä¸€ä¸ªå†…ç½‘ç½‘æ®µï¼Œæ‰€ä»¥ä¸èƒ½ ping é€šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1697550040,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1069135,"avatar":"","nickname":"é‚µæ¶µ","note":"","ucode":"43A16551A82F2F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592371,"discussion_content":"ç¡®å®ä¸æ˜¯ä»€ä¹ˆå¥½åŠæ³•ï¼Œåªæ˜¯åœ¨æ²¡æ‰¾åˆ°æ ¹æœ¬è§£å†³æ–¹å¼ä¹‹å‰ä¸ºäº†èƒ½ç”¨kubectl topçš„ä¸´æ—¶è§£å†³æ–¹å¼â€¦â€¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667359457,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358752,"user_name":"dao","can_delete":false,"product_type":"c1","uid":1087879,"ip_address":"åŒ—äº¬","ucode":"4181FB270462CF","user_header":"https://static001.geekbang.org/account/avatar/00/10/99/87/5066026c.jpg","comment_is_top":false,"comment_ctime":1664683765,"is_pvip":false,"replies":[{"id":130519,"content":"great!","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1664754948,"ip_address":"åŒ—äº¬","comment_id":358752,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"åˆ†äº«ä¸€ä¸‹æˆ‘çš„æœ¬è¯¾å®è·µç»éªŒã€‚å½“æ‰€æœ‰éƒ¨ç½²ç»“æŸåï¼Œæ£€æŸ¥å‘ç°æœ‰ Pod æ— æ³•æ­£å¸¸è¿è¡Œï¼ˆä¹Ÿå°±æ˜¯å‡ ä¸ª Web UI æ— æ³•æ­£å¸¸æ‰“å¼€çš„ï¼‰\n\n```bash\n# æŸ¥çœ‹ Pod çŠ¶æ€ï¼Œå‘ç° prometheus-operator æ— æ³•æ­£å¸¸å¯åŠ¨\nkubectl get pod -n monitoring\nNAME                                  READY   STATUS    RESTARTS   AGE\nblackbox-exporter-746c64fd88-wmnd5    3&#47;3     Running   0          68s\ngrafana-5fc7f9f55d-qqt77              1&#47;1     Running   0          68s\nkube-state-metrics-6c8846558c-w66x9   3&#47;3     Running   0          67s\nnode-exporter-68l4p                   2&#47;2     Running   0          67s\nnode-exporter-vs55z                   2&#47;2     Running   0          67s\nprometheus-adapter-6455646bdc-4lz5l   1&#47;1     Running   0          66s\nprometheus-adapter-6455646bdc-gxbrl   1&#47;1     Running   0          66s\nprometheus-operator-f59c8b954-btxtw   0&#47;2     Pending   0          66s\n\n# è°ƒæŸ¥ Pod prometheus-operator\nkubectl describe pod prometheus-operator-f59c8b954-btxtw -n monitoring\nEvents:\nType     Reason            Age   From               Message\n----     ------            ----  ----               -------\nWarning  FailedScheduling  82s   default-scheduler  0&#47;2 nodes are available: 1 Insufficient memory, 1 node(s) had taint {node-role.kubernetes.io&#47;master: }, that the pod didn&#39;t tolerate.\nWarning  FailedScheduling  20s   default-scheduler  0&#47;2 nodes are available: 1 Insufficient memory, 1 node(s) had taint {node-role.kubernetes.io&#47;master: }, that the pod didn&#39;t tolerate.\n\n# å»é™¤ node çš„æ±¡ç‚¹ node-role.kubernetes.io&#47;master\nkubectl taint nodes --all node-role.kubernetes.io&#47;master-\n```","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589356,"discussion_content":"great!","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1664754949,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356042,"user_name":"romance","can_delete":false,"product_type":"c1","uid":1029768,"ip_address":"åŒ—äº¬","ucode":"393DC641CCE86E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b6/88/e8deccbc.jpg","comment_is_top":false,"comment_ctime":1661931674,"is_pvip":false,"replies":[{"id":129576,"content":"å¯ä»¥å†ç”¨logsã€describeçœ‹å…·ä½“çš„çŠ¶æ€ï¼Œæœ‰é—®é¢˜å°±é‡å¯podã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1661935193,"ip_address":"åŒ—äº¬","comment_id":356042,"utype":1}],"discussion_count":8,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"metrics-serveræˆåŠŸéƒ¨ç½²äº†ï¼Œkubectl get pod -n kube-system æŸ¥çœ‹æ­£å¸¸è¿è¡Œäº†ï¼Œä½†ç”¨kubectl top node æ—¶æ˜¾ç¤º  Error from server (ServiceUnavailable): the server is currently unable to handle the request (get nodes.metrics.k8s.io)","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586009,"discussion_content":"å¯ä»¥å†ç”¨logsã€describeçœ‹å…·ä½“çš„çŠ¶æ€ï¼Œæœ‰é—®é¢˜å°±é‡å¯podã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661935193,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3238292,"avatar":"https://static001.geekbang.org/account/avatar/00/31/69/94/4025b79e.jpg","nickname":"è´°","note":"","ucode":"F5AC8A33168051","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":616510,"discussion_content":"æ¥¼ä¸»è§£å†³äº†å—ï¼Ÿæˆ‘æ’æŸ¥åˆ°æˆ‘çš„æ˜¯æ²¡æœ‰å¼€å¯èšåˆç„¶åä¿®æ”¹å®Œèšåˆå°±ç›´æ¥å´©äº†åªèƒ½å›æ»š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1682875055,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¤©æ´¥","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1139878,"avatar":"https://static001.geekbang.org/account/avatar/00/11/64/a6/e5f674a9.jpg","nickname":"mh","note":"","ucode":"9179BBA1792CD2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586171,"discussion_content":"æ‰¾åˆ°é—®é¢˜äº†ï¼Œçœ‹api-serverçš„æ—¥å¿—å‘ç°æ˜¯metrics-serverçš„ç«¯å£4443æ²¡æœ‰å¼€æ”¾çš„åŸå› ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662017681,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1139878,"avatar":"https://static001.geekbang.org/account/avatar/00/11/64/a6/e5f674a9.jpg","nickname":"mh","note":"","ucode":"9179BBA1792CD2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586145,"discussion_content":"çœ‹æ—¥å¿—å¯åŠ¨æ˜¯æ­£å¸¸çš„ï¼Œä½†è¿˜æ˜¯è°ƒç”¨å¤±è´¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662002197,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1139878,"avatar":"https://static001.geekbang.org/account/avatar/00/11/64/a6/e5f674a9.jpg","nickname":"mh","note":"","ucode":"9179BBA1792CD2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586144,"discussion_content":" kubectl logs metrics-server-85b475cf99-bp96b -n kube-system\nI0901 02:56:55.468479       1 serving.go:342] Generated self-signed cert (/tmp/apiserver.crt, /tmp/apiserver.key)\nI0901 02:56:55.821949       1 requestheader_controller.go:169] Starting RequestHeaderAuthRequestController\nI0901 02:56:55.821952       1 configmap_cafile_content.go:201] &#34;Starting controller&#34; name=&#34;client-ca::kube-system::extension-apiserver-authentication::client-ca-file&#34;\nI0901 02:56:55.821959       1 configmap_cafile_content.go:201] &#34;Starting controller&#34; name=&#34;client-ca::kube-system::extension-apiserver-authentication::requestheader-client-ca-file&#34;\nI0901 02:56:55.821962       1 shared_informer.go:240] Waiting for caches to sync for RequestHeaderAuthRequestController\nI0901 02:56:55.821966       1 shared_informer.go:240] Waiting for caches to sync for client-ca::kube-system::extension-apiserver-authentication::requestheader-client-ca-file\nI0901 02:56:55.821963       1 shared_informer.go:240] Waiting for caches to sync for client-ca::kube-system::extension-apiserver-authentication::client-ca-file\nI0901 02:56:55.822112       1 dynamic_serving_content.go:131] &#34;Starting controller&#34; name=&#34;serving-cert::/tmp/apiserver.crt::/tmp/apiserver.key&#34;\nI0901 02:56:55.822192       1 secure_serving.go:266] Serving securely on [::]:4443\nI0901 02:56:55.822214       1 tlsconfig.go:240] &#34;Starting DynamicServingCertificateController&#34;\nW0901 02:56:55.822275       1 shared_informer.go:372] The sharedIndexInformer has started, run more than once is not allowed\nI0901 02:56:55.922872       1 shared_informer.go:247] Caches are synced for client-ca::kube-system::extension-apiserver-authentication::client-ca-file \nI0901 02:56:55.922874       1 shared_informer.go:247] Caches are synced for client-ca::kube-system::extension-apiserver-authentication::requestheader-client-ca-file \nI0901 02:56:55.922884       1 shared_informer.go:247] Caches are synced for RequestHeaderAuthRequestController","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662002145,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1139878,"avatar":"https://static001.geekbang.org/account/avatar/00/11/64/a6/e5f674a9.jpg","nickname":"mh","note":"","ucode":"9179BBA1792CD2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586142,"discussion_content":"[lxf@cluster09 ~]$ kubectl top node -v=6\nI0901 11:12:02.709901  364898 loader.go:372] Config loaded from file:  /home/lxf/.kube/config\nI0901 11:12:02.719477  364898 round_trippers.go:553] GET https://192.168.10.5:6443/api 200 OK in 9 milliseconds\nI0901 11:12:02.719910  364898 round_trippers.go:553] GET https://192.168.10.5:6443/apis 200 OK in 0 milliseconds\nI0901 11:12:02.720562  364898 round_trippers.go:553] GET https://192.168.10.5:6443/apis/metrics.k8s.io/v1beta1/nodes 503 Service Unavailable in 0 milliseconds\nI0901 11:12:02.720659  364898 helpers.go:219] server response object: [{\n  &#34;metadata&#34;: {},\n  &#34;status&#34;: &#34;Failure&#34;,\n  &#34;message&#34;: &#34;the server is currently unable to handle the request (get nodes.metrics.k8s.io)&#34;,\n  &#34;reason&#34;: &#34;ServiceUnavailable&#34;,\n  &#34;details&#34;: {\n    &#34;group&#34;: &#34;metrics.k8s.io&#34;,\n    &#34;kind&#34;: &#34;nodes&#34;,\n    &#34;causes&#34;: [\n      {\n        &#34;reason&#34;: &#34;UnexpectedServerResponse&#34;,\n        &#34;message&#34;: &#34;service unavailable&#34;\n      }\n    ]\n  },\n  &#34;code&#34;: 503\n}]\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662002017,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1139878,"avatar":"https://static001.geekbang.org/account/avatar/00/11/64/a6/e5f674a9.jpg","nickname":"mh","note":"","ucode":"9179BBA1792CD2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586141,"discussion_content":"è¿™ä¸ªæ±¡ç‚¹æ˜¯å•¥æ„æ€ï¼Ÿ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662001979,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1029768,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b6/88/e8deccbc.jpg","nickname":"romance","note":"","ucode":"393DC641CCE86E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586117,"discussion_content":"æŠŠmasteræ±¡ç‚¹å»æ‰åå°±èƒ½æŸ¥çœ‹äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661995055,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355994,"user_name":"Sports","can_delete":false,"product_type":"c1","uid":1757265,"ip_address":"åŒ—äº¬","ucode":"1AC6035DFA4ECB","user_header":"https://static001.geekbang.org/account/avatar/00/1a/d0/51/f1c9ae2d.jpg","comment_is_top":false,"comment_ctime":1661910868,"is_pvip":false,"replies":[{"id":129560,"content":"ç”¨describeå‘½ä»¤çœ‹ä¸€ä¸‹å®ƒçš„çŠ¶æ€ï¼Œçœ‹æ ·å­åƒæ˜¯é•œåƒä¸å¯¹ï¼Œæ˜¯ä¸æ˜¯amd64&#47;arm64çš„é—®é¢˜ï¼Œå¯ä»¥ç”¨docker inspectçœ‹çœ‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1661912722,"ip_address":"åŒ—äº¬","comment_id":355994,"utype":1}],"discussion_count":5,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"prometheus-adapterçš„podä¸€ç›´æ˜¯CrashLoopBackOffï¼Œæ—¥å¿—æ˜¾ç¤ºexec &#47;adapter: exec format erroræ˜¯å•¥æƒ…å†µï¼Ÿgrafanaå’ŒPrometheusçš„webç«¯å€’æ˜¯å¯ä»¥æ­£å¸¸æ‰“å¼€æ­£å¸¸æ˜¾ç¤ºçš„","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585937,"discussion_content":"ç”¨describeå‘½ä»¤çœ‹ä¸€ä¸‹å®ƒçš„çŠ¶æ€ï¼Œçœ‹æ ·å­åƒæ˜¯é•œåƒä¸å¯¹ï¼Œæ˜¯ä¸æ˜¯amd64/arm64çš„é—®é¢˜ï¼Œå¯ä»¥ç”¨docker inspectçœ‹çœ‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661912722,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":2,"child_discussions":[{"author":{"id":1757265,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/d0/51/f1c9ae2d.jpg","nickname":"Sports","note":"","ucode":"1AC6035DFA4ECB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":585982,"discussion_content":"è¿˜æ˜¯é•œåƒçš„é—®é¢˜çš„ï¼Œç”¨çš„selina5288/prometheus-adapter:v0.9.1è·‘èµ·æ¥äº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1661927171,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":585937,"ip_address":"æ±Ÿè‹","group_id":0},"score":585982,"extra":""},{"author":{"id":2780736,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/6e/40/88b24990.jpg","nickname":"æ¾é¥¼","note":"","ucode":"86286F3D329483","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1757265,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/d0/51/f1c9ae2d.jpg","nickname":"Sports","note":"","ucode":"1AC6035DFA4ECB","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":629491,"discussion_content":"å’Œä½ ä¸€æ ·çš„é—®é¢˜ï¼Œç”¨çš„selina5288/prometheus-adapter:v0.9.1è·‘èµ·æ¥äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1697113990,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":585982,"ip_address":"åŒ—äº¬","group_id":0},"score":629491,"extra":""}]},{"author":{"id":1126593,"avatar":"https://static001.geekbang.org/account/avatar/00/11/30/c1/2dde6700.jpg","nickname":"å¯†ç 123456","note":"","ucode":"9889463CC0EA71","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585976,"discussion_content":"æˆ‘ç”¨çš„ï¼Œè¿™ä¸ªè·‘èµ·æ¥çš„ã€‚ directxman12/k8s-prometheus-adapter-amd64:v0.7.0","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661923181,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ±Ÿè‹","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1757265,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/d0/51/f1c9ae2d.jpg","nickname":"Sports","note":"","ucode":"1AC6035DFA4ECB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1126593,"avatar":"https://static001.geekbang.org/account/avatar/00/11/30/c1/2dde6700.jpg","nickname":"å¯†ç 123456","note":"","ucode":"9889463CC0EA71","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585983,"discussion_content":"ç”¨çš„selina5288/prometheus-adapter:v0.9.1è·‘èµ·æ¥äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661927184,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":585976,"ip_address":"æ±Ÿè‹","group_id":0},"score":585983,"extra":""}]}]},{"had_liked":false,"id":355976,"user_name":"æˆ’è´ªå—”ç—´","can_delete":false,"product_type":"c1","uid":3017168,"ip_address":"åŒ—äº¬","ucode":"D53EA3525DBD71","user_header":"https://static001.geekbang.org/account/avatar/00/2e/09/d0/8609bddc.jpg","comment_is_top":false,"comment_ctime":1661904474,"is_pvip":false,"replies":[{"id":129557,"content":"è¿˜æ˜¯çœ‹masterèŠ‚ç‚¹çš„æ±¡ç‚¹ï¼Œæ˜¯å¦æœ‰NoScheduleï¼Œå› ä¸ºé»˜è®¤masteræ˜¯ä¸è¿è¡Œä¸šåŠ¡çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1661912495,"ip_address":"åŒ—äº¬","comment_id":355976,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"è€å¸ˆ å¥½ï¼Œæˆ‘è¿™è¾¹è£…äº†metrics- serveråä¸çŸ¥é“ä¸ºä»€ä¹ˆåªèƒ½çœ‹åˆ°workerèŠ‚ç‚¹çš„æŒ‡æ ‡ï¼Œçœ‹ä¸åˆ°masterçš„æŒ‡æ ‡ï¼Œå…¨éƒ¨æ˜¾ç¤ºä¸ºnoneã€‚ç½‘ä¸Šæ‰¾äº†å¥½ä¹…ï¼Œæ²¡æ‰¾åˆ°ç­”æ¡ˆï¼Œè¿˜æœ›è€å¸ˆæŒ‡ç‚¹ä¸‹ã€‚","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585934,"discussion_content":"è¿˜æ˜¯çœ‹masterèŠ‚ç‚¹çš„æ±¡ç‚¹ï¼Œæ˜¯å¦æœ‰NoScheduleï¼Œå› ä¸ºé»˜è®¤masteræ˜¯ä¸è¿è¡Œä¸šåŠ¡çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661912495,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":3017168,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/09/d0/8609bddc.jpg","nickname":"æˆ’è´ªå—”ç—´","note":"","ucode":"D53EA3525DBD71","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":586594,"discussion_content":"å¥½çš„ï¼Œæˆ‘ç…ç…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662366598,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":585934,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":586594,"extra":""}]}]},{"had_liked":false,"id":393937,"user_name":"sgcls","can_delete":false,"product_type":"c1","uid":1255198,"ip_address":"å¹¿ä¸œ","ucode":"F359E943BF6D14","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erRCf8vWbWibajdSaMtCM1OzPQ6uPhblgL4zXJvKoaQYVmialqFqr0NIdD6Dlm1F5icOBxiaXvUcQs4BA/132","comment_is_top":false,"comment_ctime":1725384740,"is_pvip":false,"replies":[{"id":143071,"content":"nice","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1725863353,"ip_address":"ä¸Šæµ·","comment_id":393937,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"metrics-server æŠ˜è…¾äº†ä¸¤å¤©ï¼Œç»ˆäºå¥½äº†ï¼Œè¿‡ç¨‹è®°å½•ä¸€ä¸‹ï¼š\n\n$ kubectl top node æç¤ºå‡ºé”™\nError from server (ServiceUnavailable): the server is currently unable to handle the request (get nodes.metrics.k8s.io)\n\næœŸé—´å°è¯•ï¼š\n- spec -&gt; template -&gt; spec ä¸‹æ·»åŠ  hostNetwork: true\n\né”™è¯¯ä¾æ—§ï¼ŒæŸ¥çœ‹ apiserver æ—¥å¿—ï¼š\n$ kubectl logs -n kube-system kube-apiserver-master\nE0902 17:28:30.885994       1 available_controller.go:524] v1beta1.metrics.k8s.io failed with: failing or missing response from https:&#47;&#47;10.101.216.86:443&#47;apis&#47;metrics.k8s.io&#47;v1beta1: Get &quot;https:&#47;&#47;10.101.216.86:443&#47;apis&#47;metrics.k8s.io&#47;v1beta1&quot;: net&#47;http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)\n\nçœ‹äº†ä¸‹ kubectl describe -n kube-system pod metrics-server-6dc55579bb-qv98v å‘ç° metrics-server éƒ¨ç½²åœ¨ worker èŠ‚ç‚¹\nNode: worker&#47;192.168.10.130\n\nçœ‹é«˜èµè¯„è®ºï¼Œå°è¯•ä¸‹æŒ‡å®šéƒ¨ç½²åˆ° master çœ‹èƒ½ä¸èƒ½è¡Œï¼Œæ“ä½œï¼š\nå»æ‰ hostNetwork: trueï¼ŒåŒæ—¶ spec -&gt; template -&gt; spec ä¸‹æ·»åŠ  nodeName: masterï¼Œè¿™å›æ­£å¸¸æ˜¾ç¤º master èŠ‚ç‚¹çš„ç”¨é‡äº†ï¼Œä½†æ˜¯ worker èŠ‚ç‚¹æ‰€æœ‰å­—æ®µéƒ½æ˜¾ç¤º &lt;Unknown&gt;\n\næŸ¥çœ‹ metrics-server æ—¥å¿—\n$ kubectl logs -n kube-system metrics-server-6dc55579bb-qv98v\nE0903 15:50:56.622351       1 scraper.go:140] &quot;Failed to scrape node&quot; err=&quot;Get \\&quot;https:&#47;&#47;192.168.10.130:10250&#47;metrics&#47;resource\\&quot;: context deadline exceeded&quot; node=&quot;worker&quot;\n\næŸ¥çœ‹äº† worker çš„é˜²ç«å¢™ã€VPN ä¹Ÿéƒ½æ²¡é—®é¢˜ï¼Œè®¿é—® worker èŠ‚ç‚¹çš„ 10250 ç«¯å£(kubelet)ä¹Ÿæ­£å¸¸ï¼šcurl -k &#39;https:&#47;&#47;192.168.10.130:10250&#47;metrics&#47;resource&#39;\n\næ²¡è¾™äº†ï¼Œå¯¹æ¯”äº†ä¸‹è€å¸ˆçš„ components.yaml(k8s_study&#47;metrics&#47;components.yaml)å’Œæˆ‘çš„ï¼Œæœ€åä½œäº†å¦‚ä¸‹ä¿®æ”¹ï¼Œkubectl top node è¾“å‡ºæ‰ç»ˆäºæ­£å¸¸..\n\n1. spec -&gt; template -&gt; spec ä¸‹æ·»åŠ  hostNetwork: true\n2. spec -&gt; template -&gt; spec ä¸‹æ·»åŠ  nodeName: master\n3. containers -&gt; secure-port=10250 æ”¹ä¸º secure-port=4443\n4. containerPort: 10250 æ”¹ä¸º secure-port=4443\n5. metrics-server deployment çš„é•œåƒ(image)æ”¹ä¸º k8s.gcr.io&#47;metrics-server&#47;metrics-server:v0.6.1","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":650912,"discussion_content":"nice","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1725863353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":386015,"user_name":"okkkkk","can_delete":false,"product_type":"c1","uid":1958092,"ip_address":"æ±Ÿè‹","ucode":"FEA6F454376F6D","user_header":"https://static001.geekbang.org/account/avatar/00/1d/e0/cc/a8c26fb2.jpg","comment_is_top":false,"comment_ctime":1703839148,"is_pvip":false,"replies":[{"id":140723,"content":"good.","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1704162347,"ip_address":"ä¸Šæµ·","comment_id":386015,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"prometheusé‡åˆ°äº†ä¸¤ä¸ªé—®é¢˜ï¼Œæ•´ç†ä¸‹\n1. å‘ç°adapterè¿è¡Œä¸èµ·æ¥çš„è¯ï¼Œå¦‚\nprometheus-adapter-8547d6666f-9wj9j   0&#47;1     CrashLoopBackOff\næ˜¯è€å¸ˆçš„prometheus-adapter:v0.9.1é•œåƒæœ‰é—®é¢˜ï¼Œæˆ‘ä¹Ÿæ‰“äº†ä¸€ä¸ªé•œåƒoiouou&#47;prometheus-adapter:v0.9.1ï¼Œå®æµ‹æ­£å¸¸èƒ½ç”¨\n2. prometheus-k8s-0 ä¸€ç›´å¤„äºPendingçŠ¶æ€ï¼Œæˆ‘è¿™é‡Œæ˜¯å†…å­˜ä¸è¶³äº†ï¼Œmasterå’Œworkeræˆ‘éƒ½åˆ†é…äº†2Gå†…å­˜ï¼Œä¹‹åæŠŠworkerå‡åˆ°4Gï¼Œpodéƒ½æ­£å¸¸äº†","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634871,"discussion_content":"good.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1704162347,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":382660,"user_name":"GeekNeo","can_delete":false,"product_type":"c1","uid":1146405,"ip_address":"æµ™æ±Ÿ","ucode":"1D355A9BEB8BEA","user_header":"https://static001.geekbang.org/account/avatar/00/11/7e/25/3932dafd.jpg","comment_is_top":false,"comment_ctime":1697767935,"is_pvip":false,"replies":[{"id":139376,"content":"great","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1697780683,"ip_address":"ä¸Šæµ·","comment_id":382660,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"æœ€æ–°ç‰ˆæœ¬ï¼š\nrepo=registry.aliyuncs.com&#47;google_containers\n\nname=registry.k8s.io&#47;metrics-server&#47;metrics-server:v0.6.4\nsrc_name=metrics-server:v0.6.4\n\nsudo docker pull $repo&#47;$src_name\n\nsudo docker tag $repo&#47;$src_name $name\nsudo docker rmi $repo&#47;$src_name","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":629901,"discussion_content":"great","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1697780683,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":378960,"user_name":"huanrong","can_delete":false,"product_type":"c1","uid":2256935,"ip_address":"å¹¿ä¸œ","ucode":"0F522FF7371E12","user_header":"https://static001.geekbang.org/account/avatar/00/22/70/27/4498ce51.jpg","comment_is_top":false,"comment_ctime":1691050296,"is_pvip":false,"replies":[{"id":138117,"content":"good","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1691135086,"ip_address":"ä¸Šæµ·","comment_id":378960,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"å½“éƒ¨ç½²äº† HorizontalPodAutoscaler åï¼Œå¦‚æœå†æ‰§è¡Œ kubectl scale å‘½ä»¤æ‰‹åŠ¨æ‰©å®¹ï¼ŒHorizontalPodAutoscaler ä¼šæ ¹æ®å®šä¹‰çš„è‡ªåŠ¨ä¼¸ç¼©ç­–ç•¥æ¥è°ƒæ•´ Pod çš„æ•°é‡ã€‚å…·ä½“è€Œè¨€ï¼Œå¦‚æœæ‰‹åŠ¨æ‰©å®¹çš„æ•°é‡è¶…è¿‡äº† HorizontalPodAutoscaler çš„ä¸Šé™ï¼Œåˆ™ HorizontalPodAutoscaler ä¼šå°† Pod çš„æ•°é‡ç¼©å›ä¸Šé™ï¼›å¦‚æœæ‰‹åŠ¨æ‰©å®¹çš„æ•°é‡ä½äº HorizontalPodAutoscaler çš„ä¸‹é™ï¼Œåˆ™ HorizontalPodAutoscaler ä¼šå°† Pod çš„æ•°é‡æ‰©å±•åˆ°ä¸‹é™ä»¥ä¸Šã€‚\n\nè¿™æ˜¯å› ä¸º HorizontalPodAutoscaler æ˜¯æ ¹æ® Metrics Server æä¾›çš„æŒ‡æ ‡æ¥è‡ªåŠ¨ä¼¸ç¼© Pod çš„æ•°é‡çš„ã€‚å½“æ‰‹åŠ¨æ‰§è¡Œ kubectl scale å‘½ä»¤æ—¶ï¼Œè™½ç„¶å¯ä»¥ç›´æ¥æ”¹å˜ Pod çš„æ•°é‡ï¼Œä½†æ˜¯ HorizontalPodAutoscaler ä¼šç»§ç»­ç›‘æ§ Metrics Server æä¾›çš„æŒ‡æ ‡ï¼Œå¹¶æ ¹æ®è‡ªåŠ¨ä¼¸ç¼©ç­–ç•¥å¯¹ Pod çš„æ•°é‡è¿›è¡Œè°ƒæ•´ï¼Œä»¥ç¡®ä¿ Pod çš„æ•°é‡ç¬¦åˆé¢„å®šçš„èŒƒå›´ã€‚\n\næ€»ç»“èµ·æ¥ï¼Œå½“éƒ¨ç½²äº† HorizontalPodAutoscaler åï¼Œå»ºè®®ä½¿ç”¨ HorizontalPodAutoscaler æ¥è‡ªåŠ¨ä¼¸ç¼© Pod çš„æ•°é‡ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ kubectl scale å‘½ä»¤è¿›è¡Œæ‰‹åŠ¨æ‰©å®¹ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿è‡ªåŠ¨ä¼¸ç¼©ç­–ç•¥çš„ç”Ÿæ•ˆï¼Œä»¥åŠé¿å…æ‰‹åŠ¨æ‰©å®¹å’Œè‡ªåŠ¨ä¼¸ç¼©ç­–ç•¥ä¹‹é—´çš„å†²çªã€‚","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":624985,"discussion_content":"good","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1691135086,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":378103,"user_name":"Geek_0e379d","can_delete":false,"product_type":"c1","uid":1092078,"ip_address":"å¹¿ä¸œ","ucode":"68DA7CE34D997B","user_header":"https://static001.geekbang.org/account/avatar/00/10/a9/ee/2b57ba4e.jpg","comment_is_top":false,"comment_ctime":1689757842,"is_pvip":false,"replies":[{"id":137785,"content":"å¯ä»¥å…ˆç”¨å‘½ä»¤è¡Œå·¥å…·æµ‹è¯•ï¼Œæ¯”å¦‚curlã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1689763647,"ip_address":"åŒ—äº¬","comment_id":378103,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"ä¸€åˆ‡éƒ¨ç½²æ­£å¸¸ï¼Œå°±ä¸çŸ¥é“ä¸ºä»€ä¹ˆæµè§ˆå™¨æ‰“ä¸å¼€","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":623709,"discussion_content":"å¯ä»¥å…ˆç”¨å‘½ä»¤è¡Œå·¥å…·æµ‹è¯•ï¼Œæ¯”å¦‚curlã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1689763647,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":373818,"user_name":"æå®¢é›·","can_delete":false,"product_type":"c1","uid":1041465,"ip_address":"å¹¿ä¸œ","ucode":"0DBAC4CB9C7BCD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e4/39/a06ade33.jpg","comment_is_top":false,"comment_ctime":1683200373,"is_pvip":false,"replies":[{"id":136578,"content":"great","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1683205512,"ip_address":"ä¸Šæµ·","comment_id":373818,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"Kubernetes é¡¹ç›®è¿è¡Œä¸€ä¸ªåä¸º registry.k8s.ioã€ç”±ç¤¾åŒºç®¡ç†çš„é•œåƒä»“åº“æ¥æ‰˜ç®¡å…¶å®¹å™¨é•œåƒã€‚ 2023 å¹´ 4 æœˆ 3 æ—¥ï¼Œæ—§ä»“åº“ k8s.gcr.io å°†è¢«å†»ç»“ï¼ŒKubernetes åŠå…¶ç›¸å…³å­é¡¹ç›®çš„é•œåƒå°†ä¸å†æ¨é€åˆ°è¿™ä¸ªæ—§ä»“åº“ã€‚","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":616940,"discussion_content":"great","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1683205512,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":372736,"user_name":"Jacob.C","can_delete":false,"product_type":"c1","uid":1070253,"ip_address":"å¹¿ä¸œ","ucode":"034998E7A7CCD1","user_header":"https://static001.geekbang.org/account/avatar/00/10/54/ad/6ee2b7cb.jpg","comment_is_top":false,"comment_ctime":1681530620,"is_pvip":false,"replies":[{"id":136083,"content":"è¿™ä¸¤ä¸ªæ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œå®Œå…¨å¯ä»¥ç‹¬ç«‹å®‰è£…ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1681565104,"ip_address":"åŒ—äº¬","comment_id":372736,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"è¯·é—®è£…æ™®ç½—ç±³ä¿®æ–¯ä¹‹å‰å¿…é¡»è£… mertrics å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":613881,"discussion_content":"è¿™ä¸¤ä¸ªæ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œå®Œå…¨å¯ä»¥ç‹¬ç«‹å®‰è£…ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1681565104,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":367800,"user_name":"Lorry","can_delete":false,"product_type":"c1","uid":1066409,"ip_address":"å››å·","ucode":"BD4754D0F1D786","user_header":"https://static001.geekbang.org/account/avatar/00/10/45/a9/3d48d6a2.jpg","comment_is_top":false,"comment_ctime":1675640893,"is_pvip":false,"replies":[{"id":133959,"content":"nice","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1675649273,"ip_address":"ä¸Šæµ·","comment_id":367800,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"åˆ†äº«ä¸€ç‚¹ï¼šæ‹‰å»metric-serveré•œåƒçš„æ—¶å€™ï¼Œä¸€å®šè¦ç¡®ä¿k8sé›†ç¾¤æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½é€šè¿‡dockerè¿›è¡Œæ‹‰å–ï¼ˆæ‰§è¡Œæ–‡ä¸­æä¾›çš„æ‹‰å–è„šæœ¬ï¼‰ã€‚\næˆ‘ç¢°åˆ°çš„é—®é¢˜æ˜¯åªæ˜¯åœ¨masteræ‹‰å»æ¥çš„ï¼Œä½†æ˜¯ä»»åŠ¡æ‰“åˆ°workèŠ‚ç‚¹åï¼Œæ€»æ˜¯å‡ºç°æ‹‰å»å¤±è´¥çš„å¼‚å¸¸ã€‚\n\nkubectl decribeåœ¨å®šä½é—®é¢˜çš„æ—¶å€™ï¼ŒçœŸé¦™","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":602061,"discussion_content":"nice","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1675649274,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":366733,"user_name":"aLong","can_delete":false,"product_type":"c1","uid":2409553,"ip_address":"åŒ—äº¬","ucode":"11DB1B9C579811","user_header":"https://static001.geekbang.org/account/avatar/00/24/c4/51/5bca1604.jpg","comment_is_top":false,"comment_ctime":1674121456,"is_pvip":false,"replies":[{"id":133618,"content":"æ­£å¸¸ï¼Œåº”è¯¥æ˜¯å®éªŒé›†ç¾¤å¤ªå°ï¼Œæ²¡æœ‰è¶³å¤Ÿçš„worker nodeæ¥è¿è¡Œå®ƒä»¬ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1674172969,"ip_address":"åŒ—äº¬","comment_id":366733,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"alertmanager-main-2,prometheus-k8s-0&amp;1, è¿™ä¸‰ä¸ªéƒ½ä¼šæç¤ºæ±¡ç‚¹é—®é¢˜å¯¼è‡´pendingã€‚å»é™¤æ‰æ±¡ç‚¹ä¼šæ­£å¸¸å¯åŠ¨ã€‚ è¿™æ˜¯å¦æ˜¯å¸¸è§„æ“ä½œï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600274,"discussion_content":"æ­£å¸¸ï¼Œåº”è¯¥æ˜¯å®éªŒé›†ç¾¤å¤ªå°ï¼Œæ²¡æœ‰è¶³å¤Ÿçš„worker nodeæ¥è¿è¡Œå®ƒä»¬ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1674172969,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":363635,"user_name":"LiL","can_delete":false,"product_type":"c1","uid":2923131,"ip_address":"åŒ—äº¬","ucode":"23BE4E0181E80D","user_header":"https://static001.geekbang.org/account/avatar/00/2c/9a/7b/aa937172.jpg","comment_is_top":false,"comment_ctime":1669901365,"is_pvip":false,"replies":[{"id":132156,"content":"æ²¡é‡åˆ°è¿™æ ·çš„é—®é¢˜ï¼Œå…ˆçœ‹çœ‹Prometheusçš„ç‰ˆæœ¬æ˜¯å¦ä¸è¯¾ç¨‹é‡Œçš„ä¸€è‡´ï¼Œå†å‚è€ƒä¸€ä¸‹åé¢çš„è§†é¢‘ï¼Œæ˜¯å¦æœ‰å“ªæ­¥é”™äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1669937377,"ip_address":"åŒ—äº¬","comment_id":363635,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"æŒ‰ç…§è€å¸ˆçš„æ“ä½œï¼Œæ­£å¸¸å®‰è£…promethuså’Œgrafana,ä½†æ˜¯grafanaç•Œé¢æ‰“ä¸å¼€ï¼Œæç¤ºå¦‚ä¸‹ï¼Œè¿˜è¯·è€å¸ˆè§£ç­”ä¸‹å‘¢ï¼Œç½‘ä¸Šæœäº†ä¸€åœˆä¹Ÿæ²¡å‘ç°å¯è¡Œçš„è§£å†³æ–¹æ¡ˆï¼š\nIf you&#39;re seeing this Grafana has failed to load its application files\n\n1. This could be caused by your reverse proxy settings.\n\n2. If you host grafana under subpath make sure your grafana.ini root_url setting includes subpath. If not using a reverse proxy make sure to set serve_from_sub_path to true.\n\n3. If you have a local dev build make sure you build frontend using: yarn start, yarn start:hot, or yarn build\n\n4. Sometimes restarting grafana-server can help\n\n5. Check if you are using a non-supported browser. For more information, refer to the list of supported browsers.","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":595311,"discussion_content":"æ²¡é‡åˆ°è¿™æ ·çš„é—®é¢˜ï¼Œå…ˆçœ‹çœ‹Prometheusçš„ç‰ˆæœ¬æ˜¯å¦ä¸è¯¾ç¨‹é‡Œçš„ä¸€è‡´ï¼Œå†å‚è€ƒä¸€ä¸‹åé¢çš„è§†é¢‘ï¼Œæ˜¯å¦æœ‰å“ªæ­¥é”™äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1669937377,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361867,"user_name":"ybc","can_delete":false,"product_type":"c1","uid":2685834,"ip_address":"åŒ—äº¬","ucode":"F3CD0B857B1524","user_header":"https://static001.geekbang.org/account/avatar/00/28/fb/8a/3e8f42f1.jpg","comment_is_top":false,"comment_ctime":1667935296,"is_pvip":false,"replies":[{"id":131635,"content":"çœ‹Ingressåº”è¯¥æ˜¯æ²¡é—®é¢˜ï¼Œå¯ä»¥å†çœ‹çœ‹Nginxçš„æ—¥å¿—ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆä¿¡æ¯ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1667959939,"ip_address":"åŒ—äº¬","comment_id":361867,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"é‡åˆ°ä¸ªé—®é¢˜æƒ³è¯·æ•™ä¸‹è€å¸ˆå’ŒåŒå­¦ä»¬ï¼š åœ¨prometheusã€grafanaéƒ¨ç½²æˆåŠŸåï¼Œæˆ‘é‡‡ç”¨äº†ingressçš„æ–¹å¼æ¥è¿›è¡Œè®¿é—®ï¼Œä½†å‘ç°prometheusçš„webå¯ä»¥æ­£å¸¸è®¿é—®ï¼Œä½†grafanaçš„ç•Œé¢è®¿é—®ä¸åˆ°ï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼Œè®¿é—®æˆåŠŸåˆ°äº†ingress controllerçš„podï¼Œä½†æ²¡èƒ½è½¬å‘åˆ°grafanaçš„podï¼ŒæŸ¥è¯ingressçš„è½¬å‘è§„åˆ™æ²¡é—®é¢˜ï¼Œè¯•ç€åœ¨ingress controllerçš„podä¸­ping grafanaèŠ‚ç‚¹çš„ipï¼Œå‘ç°pingä¸é€šï¼Œå‘ç°åŒä¸€nodeçš„æŸäº›podå¯ä»¥pingé€šï¼Œæœ‰äº›åˆ™ä¸è¡Œã€‚ ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰çŸ¥é“åŸå› æˆ–æ’æŸ¥æ€è·¯çš„ï¼Ÿ\n\nè´´ä¸‹æˆ‘çš„ingressè§„åˆ™ï¼š\n  rules:\n  - host: prome.test\n    http:\n      paths:\n      - path: &#47;\n        pathType: Prefix\n        backend:\n          service:\n            name: prometheus-k8s\n            port:\n              number: 9090\n  - host: grafana.test\n    http:\n      paths:\n      - path: &#47;\n        pathType: Prefix\n        backend:\n          service:\n            name: grafana\n            port:\n              number: 3000\n","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593112,"discussion_content":"çœ‹Ingressåº”è¯¥æ˜¯æ²¡é—®é¢˜ï¼Œå¯ä»¥å†çœ‹çœ‹Nginxçš„æ—¥å¿—ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆä¿¡æ¯ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667959939,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361170,"user_name":"é‚µæ¶µ","can_delete":false,"product_type":"c1","uid":1069135,"ip_address":"ä¸Šæµ·","ucode":"43A16551A82F2F","user_header":"","comment_is_top":false,"comment_ctime":1667291840,"is_pvip":false,"replies":[{"id":131370,"content":"çœ‹æ ·å­åƒæ˜¯corednsçš„é—®é¢˜ï¼Œçœ‹çœ‹å®ƒçš„çŠ¶æ€ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1667308535,"ip_address":"ä¸Šæµ·","comment_id":361170,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"é‡åˆ°äº†ä¸€ä¸ªgrafanaçš„é—®é¢˜ï¼šä»ªè¡¨ç›˜ï¼Œæ¯”å¦‚æ–‡ä¸­å±•ç¤ºçš„â€œKubernetes &#47; Compute Resources &#47; Namespace (Pods)â€ï¼Œé¡µé¢ä¸­å›¾å½¢æŠ¥è¡¨æ²¡æœ‰æ•°æ®å±•ç¤ºï¼Œæ•°å­—éƒ¨åˆ†ï¼Œæ¯”å¦‚èµ„æºä½¿ç”¨ç‡ç™¾åˆ†æ¯”ï¼Œå±•ç¤ºçš„æ˜¯NO DATA\n\nè¿™ä¸ªçœ‹èµ·æ¥æ˜¯grafanaè°ƒç”¨prometheusè·å–æ•°æ®å¤±è´¥äº†\nå®‰è£…çš„grafanaä¸­çš„é»˜è®¤æ•°æ®æºä¸­é…ç½®çš„prometheus urlæ˜¯http:&#47;&#47;prometheus-k8s.monitoring.svc:9090ï¼Œserviceå¯¹è±¡prometheus-k8sçš„åŸŸåâ€œprometheus-k8s.monitoring.svcâ€æ­¤æ—¶åœ¨é›†ç¾¤ä¸­è®¿é—®å¤±è´¥ï¼ˆé€šè¿‡kubectl execè¿›å…¥æŸæµ‹è¯•ç”¨çš„podå»è®¿é—®è¯¥åŸŸåï¼Œå¾—åˆ°çš„æ˜¯Could not resolve host: prometheus-k8s.monitoring.svcï¼‰ï¼Œæ­¤æ—¶ï¼Œåœ¨default namespaceä¸‹åˆ›å»ºæ–°çš„deployment+serviceï¼Œæ–°çš„serviceå¯¹è±¡çš„åŸŸåä¹Ÿæ˜¯ä¸€æ ·è®¿é—®å¤±è´¥çš„\né‡å¯corednsä¹Ÿä¸èµ·ä½œç”¨ï¼Œæ˜¯åœ¨é‡å¯äº†k8sé›†ç¾¤çš„è™šæ‹Ÿæœºå‡ æ¬¡ä¹‹åï¼Œè¿™ä¸ªé—®é¢˜æ‰è‡ªå·±å¥½äº†ï¼Œserviceçš„åŸŸåéƒ½å¯ä»¥è®¿é—®äº†ï¼Œgrafanaä¸­çš„ä»ªè¡¨ç›˜é¡µé¢ä¹Ÿæœ‰æ•°æ®äº†\n\nå¦ï¼Œåœ¨å‘ç”Ÿä¸Šè¿°é—®é¢˜æ—¶ï¼Œprometheusçš„alertmanager podä¹Ÿæ˜¯å¯åŠ¨å¤±è´¥çš„\n[shaohan@k8s4 ~]$ kubectl get pod -n monitoring\nNAME                                  READY   STATUS    RESTARTS     AGE\nalertmanager-main-0                   1&#47;2     Running   2 (9s ago)   3m29s\nalertmanager-main-1                   1&#47;2     Running   2 (9s ago)   3m29s\nalertmanager-main-2                   1&#47;2     Running   2 (9s ago)   3m29s\né€šè¿‡kubectl describeå¯ä»¥çœ‹åˆ°\n  Warning  Unhealthy  4m34s (x6 over 5m24s)  kubelet            Liveness probe failed: Get &quot;http:&#47;&#47;10.10.1.12:9093&#47;-&#47;healthy&quot;: dial tcp 10.10.1.12:9093: connect: connection refused\n  Warning  Unhealthy  30s (x68 over 5m27s)   kubelet            Readiness probe failed: Get &quot;http:&#47;&#47;10.10.1.12:9093&#47;-&#47;ready&quot;: dial tcp 10.10.1.12:9093: connect: connection refused\nä¹Ÿæ˜¯ç½‘ç»œé—®é¢˜ï¼Œå½“ä¸Šè¾¹æåˆ°çš„serviceåŸŸåé—®é¢˜ç»è¿‡è™šæ‹Ÿæœºé‡å¯è§£å†³äº†ä¹‹åï¼Œè¿™ä¸ªalertmanager podæ¢é’ˆå¤±è´¥çš„é—®é¢˜ï¼Œä¹ŸåŒæ—¶æ¶ˆå¤±äº†ï¼ŒpodæˆåŠŸè¿è¡Œ","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592329,"discussion_content":"çœ‹æ ·å­åƒæ˜¯corednsçš„é—®é¢˜ï¼Œçœ‹çœ‹å®ƒçš„çŠ¶æ€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667308535,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361168,"user_name":"alexgreenbar","can_delete":false,"product_type":"c1","uid":1003655,"ip_address":"ä¸Šæµ·","ucode":"87ED7233E2767C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/50/87/dde718fa.jpg","comment_is_top":false,"comment_ctime":1667291585,"is_pvip":false,"replies":[{"id":131368,"content":"æ˜¯çš„ï¼Œè¿™é‡Œå¿…é¡»ç”¨createï¼Œä¸èƒ½ç”¨applyã€‚\n\nä¸€èˆ¬æ¥è¯´createå’Œapplyå¯ä»¥äº’æ¢ï¼Œä½†Prometheusæœ‰ç‚¹ç‰¹æ®Šï¼Œå…·ä½“çš„åŸå› è¿˜æ²¡æœ‰æ·±ç©¶ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1667308443,"ip_address":"ä¸Šæµ·","comment_id":361168,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"kubectl create -f manifests&#47;setup\n\nç”¨createæ²¡æœ‰é—®é¢˜ï¼Œä½†ç”¨applyä¼šæŠ¥é”™ï¼Œä¹‹å‰ä¸€ç›´ç”¨applyï¼Œè¿™é‡Œæ˜¯æœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Ÿ\n\n**********\nkubectl apply -f manifests&#47;setup\ncustomresourcedefinition.apiextensions.k8s.io&#47;alertmanagerconfigs.monitoring.coreos.com created\ncustomresourcedefinition.apiextensions.k8s.io&#47;alertmanagers.monitoring.coreos.com created\ncustomresourcedefinition.apiextensions.k8s.io&#47;podmonitors.monitoring.coreos.com created\ncustomresourcedefinition.apiextensions.k8s.io&#47;probes.monitoring.coreos.com created\ncustomresourcedefinition.apiextensions.k8s.io&#47;prometheusrules.monitoring.coreos.com created\ncustomresourcedefinition.apiextensions.k8s.io&#47;servicemonitors.monitoring.coreos.com created\ncustomresourcedefinition.apiextensions.k8s.io&#47;thanosrulers.monitoring.coreos.com created\nnamespace&#47;monitoring created\nThe CustomResourceDefinition &quot;prometheuses.monitoring.coreos.com&quot; is invalid: metadata.annotations: Too long: must have at most 262144 bytes\n**********","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592327,"discussion_content":"æ˜¯çš„ï¼Œè¿™é‡Œå¿…é¡»ç”¨createï¼Œä¸èƒ½ç”¨applyã€‚\n\nä¸€èˆ¬æ¥è¯´createå’Œapplyå¯ä»¥äº’æ¢ï¼Œä½†Prometheusæœ‰ç‚¹ç‰¹æ®Šï¼Œå…·ä½“çš„åŸå› è¿˜æ²¡æœ‰æ·±ç©¶ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667308443,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360695,"user_name":"rubys_","can_delete":false,"product_type":"c1","uid":1394115,"ip_address":"ä¸Šæµ·","ucode":"931AD02864126A","user_header":"https://static001.geekbang.org/account/avatar/00/15/45/c3/775fe460.jpg","comment_is_top":false,"comment_ctime":1666765663,"is_pvip":false,"replies":[{"id":131228,"content":"Serviceæ˜¯è™šipï¼Œåªç”¨æ¥è´Ÿè½½å‡è¡¡ï¼Œä¸èƒ½pingï¼Œå¯ä»¥å†å›çœ‹é‚£ä¸€è®²ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1666774786,"ip_address":"ä¸Šæµ·","comment_id":360695,"utype":1}],"discussion_count":2,"race_medal":2,"score":4,"product_id":100114501,"comment_content":"è€å¸ˆï¼Œæˆ‘æ‰§è¡Œäº† \nkubectl run test -it --image=httpd:alpine -- sh ä¹‹åï¼Œåœ¨é‡Œé¢ ping ä¸äº† ngx-hpa-svc æ˜¯ä¸ºä½•ï¼Ÿåœ¨ httpd pod é‡Œé¢çš„ ifconfig æ˜¾ç¤º ip æ˜¯ 10.10.1.6ï¼Œç„¶å kubectl get svc æ˜¾ç¤ºçš„ ngx-hpa-svc çš„ IP ä¸º 10.96.32.144","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591714,"discussion_content":"Serviceæ˜¯è™šipï¼Œåªç”¨æ¥è´Ÿè½½å‡è¡¡ï¼Œä¸èƒ½pingï¼Œå¯ä»¥å†å›çœ‹é‚£ä¸€è®²ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666774787,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1394115,"avatar":"https://static001.geekbang.org/account/avatar/00/15/45/c3/775fe460.jpg","nickname":"rubys_","note":"","ucode":"931AD02864126A","race_medal":2,"user_type":1,"is_pvip":false},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":591716,"discussion_content":"ä¸»è¦æ˜¯ ab ä¸äº†ã€‚æœ€åæ”¾å¼ƒäº†è™šæ‹Ÿæœºï¼Œç”¨é˜¿é‡Œäº‘æŒ‰é‡ä»˜è´¹çš„ä¸¤å°æœºï¼Œæ²¡æœ‰é‚£ä¹ˆå¤šé—®é¢˜ï¼Œç›´æ¥å°±è¡Œäº†ï¼Œæ„Ÿè§‰å¾ˆå¤šé—®é¢˜æ˜¯æˆ‘çš„è™šæ‹Ÿæœºæœ¬èº«çš„é—®é¢˜ï¼Œæœ‰æ—¶å€™åœ¨è™šæ‹Ÿæœºé‡Œé¢é•œåƒéƒ½æ‹‰å–ä¸äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666775574,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":591714,"ip_address":"å¹¿ä¸œ","group_id":0},"score":591716,"extra":""}]}]},{"had_liked":false,"id":359511,"user_name":"æœ±é›¯","can_delete":false,"product_type":"c1","uid":1035744,"ip_address":"åŒ—äº¬","ucode":"064C45FBF6B51F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/cd/e0/c85bb948.jpg","comment_is_top":false,"comment_ctime":1665588009,"is_pvip":false,"replies":[{"id":130738,"content":"åº”è¯¥æ˜¯Prometheusé‡Œçš„crdèµ„æºèµ·ä½œç”¨äº†å§ï¼Œå’Œdumpæ— å…³ï¼Œå¯ä»¥é‡æ–°å®‰è£…è¯•è¯•ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1665629766,"ip_address":"åŒ—äº¬","comment_id":359511,"utype":1}],"discussion_count":2,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"kubectl get pods -n monitoring \nalertmanager-main-0                   1&#47;2     CrashLoopBackOff   9 (8s ago)   24m\nalertmanager-main-1                   2&#47;2     Running            0            24m\nalertmanager-main-2                   1&#47;2     CrashLoopBackOff   9 (7s ago)   24m\nblackbox-exporter-746c64fd88-tlxm4    3&#47;3     Running            0            25m\ngrafana-5fc7f9f55d-tvmzb              1&#47;1     Running            0            24m\n\n\n\n\nkubectl describe pod alertmanager-main-0 -n monitoring\n Normal   Scheduled  25m                    default-scheduler  Successfully assigned monitoring&#47;alertmanager-main-0 to worker\n  Normal   Pulled     24m                    kubelet            Container image &quot;quay.io&#47;prometheus&#47;alertmanager:v0.24.0&quot; already present on machine\n  Normal   Created    24m                    kubelet            Created container alertmanager\n  Normal   Pulled     24m                    kubelet            Container image &quot;quay.io&#47;prometheus-operator&#47;prometheus-config-reloader:v0.57.0&quot; already present on machine\n  Normal   Created    24m                    kubelet            Created container config-reloader\n  Normal   Started    24m                    kubelet            Started container config-reloader\n  Warning  Unhealthy  23m (x6 over 24m)      kubelet            Liveness probe failed: Get &quot;http:&#47;&#47;10.10.171.67:9093&#47;-&#47;healthy&quot;: dial tcp 10.10.171.67:9093: connect: connection refused\n  Normal   Started    14m (x7 over 24m)      kubelet            Started container alertmanager\n  Warning  Unhealthy  9m54s (x169 over 24m)  kubelet            Readiness probe failed: Get &quot;http:&#47;&#47;10.10.171.67:9093&#47;-&#47;ready&quot;: dial tcp 10.10.171.67:9093: connect: connection refused\n\n\næ ¹æ®è¿™ç¯‡æ–‡ç« https:&#47;&#47;blog.csdn.net&#47;Entity_G&#47;article&#47;details&#47;117461725è¿›è¡Œæ“ä½œï¼Œç»“æœå‘ç°ä¸¤ä»¶äº‹ï¼Œç¬¬ä¸€stsæ— æ³•åˆ é™¤ï¼Œåˆ é™¤stsç›´æ¥0&#47;3åˆå¼€å§‹å¯åŠ¨ï¼Œè¯·é—®stsæ˜¯è¿˜æœ‰æ›´ä¸Šä¸€çº§åˆ«å¾—æœåŠ¡å—ï¼Œç¬¬äºŒä¸ªå°±æ˜¯dumpæ‰§è¡Œè¿˜æ˜¯æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·é—®æœ‰è€å¸ˆçŸ¥é“å•¥æƒ…å†µå—ï¼Œ\n","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590226,"discussion_content":"åº”è¯¥æ˜¯Prometheusé‡Œçš„crdèµ„æºèµ·ä½œç”¨äº†å§ï¼Œå’Œdumpæ— å…³ï¼Œå¯ä»¥é‡æ–°å®‰è£…è¯•è¯•ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665629766,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1035744,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/cd/e0/c85bb948.jpg","nickname":"æœ±é›¯","note":"","ucode":"064C45FBF6B51F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":590465,"discussion_content":"å¤šæ¬¡é‡æ–°å®‰è£…å å‘ç°åªè¦ä½¿ç”¨çš„æ˜¯flannelæ’ä»¶å°±æ²¡äº‹ ä½†æˆ‘ä¹‹å‰è£…è¿‡calicoæ’ä»¶ æ‰€ä»¥ä¸è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665773364,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":590226,"ip_address":"åŒ—äº¬","group_id":0},"score":590465,"extra":""}]}]},{"had_liked":false,"id":356313,"user_name":"å¤§å¸ƒä¸","can_delete":false,"product_type":"c1","uid":1389744,"ip_address":"åŒ—äº¬","ucode":"3C655AA79A538C","user_header":"https://static001.geekbang.org/account/avatar/00/15/34/b0/8d14a2a1.jpg","comment_is_top":false,"comment_ctime":1662131119,"is_pvip":false,"replies":[{"id":129689,"content":"good","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1662169917,"ip_address":"åŒ—äº¬","comment_id":356313,"utype":1}],"discussion_count":3,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"ç›‘æ§ç³»ç»Ÿä¸€èˆ¬éƒ½æ˜¯GPEä¸‰ä¸ªç»„ä»¶ä¸€èµ·ç”¨çš„","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586370,"discussion_content":"good","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662169917,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2103320,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/YQBwClu5f6pibYCNxoEgKkM2uvgytevWp1FBVnec3ialmFDsftEvjvRShYKn2cTicmK8M9az6ribcz65zPpGq3X3QA/132","nickname":"Geek_a68e6d","note":"","ucode":"F7AD54784E79A6","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588053,"discussion_content":"Grafana, Prometheus, Exporter","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663507347,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1202047,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/oib0a89lqtOhJL1UvfUp4uTsRLrDbhoGk9jLiciazxMu0COibJsFCZDypK1ZFcHEJc9d9qgbjvgR41ImL6FNPoVlWA/132","nickname":"stefen","note":"","ucode":"7C9AAE829E7802","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587327,"discussion_content":"GPEåˆ†åˆ«ä»£è¡¨å•¥å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662978091,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å››å·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356131,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"ä¸Šæµ·","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1662001514,"is_pvip":false,"replies":[{"id":129633,"content":"â€œexec format errorâ€è¿™æ ·çš„æ„Ÿè§‰éƒ½æ˜¯é•œåƒçš„æ ¼å¼ä¸å¯¹ï¼Œæ¯”å¦‚amd64&#47;arm64ï¼Œæ¢ä¸ªé•œåƒè¯•è¯•ï¼Œå¥½åƒæœ‰åŒå­¦åœ¨å›å¤é‡Œç”¨å…¶ä»–çš„é•œåƒæºã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1662002914,"ip_address":"ä¸Šæµ·","comment_id":356131,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"æ„Ÿè°¢è€å¸ˆåŠæ—¶ã€å‡†ç¡®çš„å›ç­”ï¼Œæœ‰ä¸€ä¸ªæ–°é—®é¢˜ï¼š\nQ4: prometheus-adapterçš„çŠ¶æ€æ˜¯CrashLoopBackOff\næ˜¨å¤©(å‘¨ä¸‰ï¼Œ8æœˆ31å·)ï¼Œå››ä¸ªPODä¸æ­£å¸¸ã€‚ä»Šå¤©(9æœˆ1å·)ï¼Œé‡æ–°å¯åŠ¨è™šæ‹Ÿæœºåï¼ŒåŸæ¥å¤„äºâ€œImagePullBackOffâ€çš„ä¸¤ä¸ªâ€œblackbox-exporterâ€ï¼Œéƒ½æ˜¯RUNNINGäº†ã€‚ä½†æ˜¯ï¼Œä¸¤ä¸ªprometheus-adapterçš„çŠ¶æ€æ˜¯CrashLoopBackOffã€‚\næ‰§è¡Œkubectl create -f manifests&#47;setupã€kubectl create -f manifestsåï¼Œ\næŸ¥çœ‹ podï¼Œ å…¶ä¸­æœ‰ä¸¤ä¸ªprometheus-adapterçš„çŠ¶æ€æ˜¯CrashLoopBackOff\nprometheus-adapter-8547d6666f-rhrc8ï¼š CrashLoopBackOff\nç”¨describeæŸ¥çœ‹ï¼Œå…¶ä¸­æœ‰è¿™æ ·çš„ä¿¡æ¯ï¼škube-api-access-5d9js:\n    Type:        Projected (a volume that contains injected data from multiple sources)\nå¥½åƒè¿™ä¸ªæ˜¯å¯¼è‡´é”™è¯¯äº†ï¼Œæ˜¯èµ„æºé™åˆ¶å—ï¼Ÿ\n\nå¦å¤–ï¼ŒæŸ¥çœ‹logsï¼Œæ˜¾ç¤ºä¿¡æ¯å¦‚ä¸‹ï¼šexec &#47;adapter: exec format error\n\næˆ‘æä¾›çš„ä¿¡æ¯ä¸å…¨é¢ï¼Œè€å¸ˆä¸å®¹æ˜“åˆ¤æ–­å…·ä½“åŸå› ï¼Œè€å¸ˆåªè¦ç»™ä¸ªå¤§è‡´æ–¹å‘å³å¯ã€‚\nå¦å¤–ï¼Œè€å¸ˆå¯ä»¥ç»™å‡ºæ’æŸ¥çš„æ€è·¯ï¼Œæ¯”å¦‚å…ˆæŸ¥XXXï¼ŒåæŸ¥YYYç­‰ã€‚","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586149,"discussion_content":"â€œexec format errorâ€è¿™æ ·çš„æ„Ÿè§‰éƒ½æ˜¯é•œåƒçš„æ ¼å¼ä¸å¯¹ï¼Œæ¯”å¦‚amd64/arm64ï¼Œæ¢ä¸ªé•œåƒè¯•è¯•ï¼Œå¥½åƒæœ‰åŒå­¦åœ¨å›å¤é‡Œç”¨å…¶ä»–çš„é•œåƒæºã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662002914,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356063,"user_name":"Dexter","can_delete":false,"product_type":"c1","uid":2608728,"ip_address":"åŒ—äº¬","ucode":"909CABC4AC4AC9","user_header":"https://static001.geekbang.org/account/avatar/00/27/ce/58/71ed845f.jpg","comment_is_top":false,"comment_ctime":1661942220,"is_pvip":true,"replies":[{"id":129628,"content":"çœ‹ä¸€ä¸‹ç›¸å…³çš„serviceæ˜¯å¦å·¥ä½œæ­£å¸¸ï¼Œæ˜¯å¦æ­£ç¡®é…ç½®äº†NodePortã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1661997388,"ip_address":"åŒ—äº¬","comment_id":356063,"utype":1}],"discussion_count":3,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"prometheus éƒ½éƒ¨ç½²æˆåŠŸäº†ï¼Œå°±æ˜¯ç”¨nodeport çš„æ–¹å¼æ‰“ä¸å¼€UIçš„ç•Œé¢ï¼Œgrafana prometheus éƒ½è¿™æ ·ã€‚æµè§ˆå™¨éœ€è¦ä»€ä¹ˆç‰¹æ®Šé…ç½®å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586128,"discussion_content":"çœ‹ä¸€ä¸‹ç›¸å…³çš„serviceæ˜¯å¦å·¥ä½œæ­£å¸¸ï¼Œæ˜¯å¦æ­£ç¡®é…ç½®äº†NodePortã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661997388,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3031731,"avatar":"","nickname":"Geek_9d0de4","note":"","ucode":"6692B89D125E9B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587168,"discussion_content":"æˆ‘ä¹Ÿæ˜¯è¿™æ ·ï¼Œè¯·é—®è§£å†³äº†å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662863479,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1055478,"avatar":"https://static001.geekbang.org/account/avatar/00/10/1a/f6/5de02496.jpg","nickname":"Shadow","note":"","ucode":"1DA38D105F88F9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586353,"discussion_content":"@ Dexterï¼Œä½ å¥½ï¼Œä½ çš„é—®é¢˜è§£å†³äº†å—ï¼Œæˆ‘ä¹Ÿé‡åˆ°åŒæ ·çš„é—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662128330,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å®‰å¾½","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356015,"user_name":"Dexter","can_delete":false,"product_type":"c1","uid":2608728,"ip_address":"åŒ—äº¬","ucode":"909CABC4AC4AC9","user_header":"https://static001.geekbang.org/account/avatar/00/27/ce/58/71ed845f.jpg","comment_is_top":false,"comment_ctime":1661919658,"is_pvip":true,"replies":[{"id":129579,"content":"ç”¨describeçœ‹çœ‹serviceçš„çŠ¶å†µã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1661935267,"ip_address":"åŒ—äº¬","comment_id":356015,"utype":1}],"discussion_count":2,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"æˆåŠŸå®‰è£…äº†æ™®ç½—ç±³ä¿®æ–¯ï¼Œä½†æ˜¯node portä¸€ç›´æ‰“ä¸å¼€ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯å®éªŒå®¤çš„ç½‘ç»œé—®é¢˜ï¼Œæ¯”å¦‚é˜²ç«å¢™â€¦","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586012,"discussion_content":"ç”¨describeçœ‹çœ‹serviceçš„çŠ¶å†µã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661935268,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1055478,"avatar":"https://static001.geekbang.org/account/avatar/00/10/1a/f6/5de02496.jpg","nickname":"Shadow","note":"","ucode":"1DA38D105F88F9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586358,"discussion_content":"@ Dexterï¼Œä½ å¥½ï¼Œä½ çš„é—®é¢˜è§£å†³äº†å—ï¼Œæˆ‘ä¹Ÿé‡åˆ°åŒæ ·çš„é—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662129779,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å®‰å¾½","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355974,"user_name":"Hale","can_delete":false,"product_type":"c1","uid":1129731,"ip_address":"åŒ—äº¬","ucode":"1925955343FE94","user_header":"https://static001.geekbang.org/account/avatar/00/11/3d/03/b2d9a084.jpg","comment_is_top":false,"comment_ctime":1661903489,"is_pvip":false,"replies":[{"id":129556,"content":"ä¸æ˜¯ï¼Œå®ƒè¦æ±‚podå¿…é¡»è¦æœ‰èµ„æºç”³è¯·ï¼Œå¦åˆ™å°±ä¸ä¼šå·¥ä½œã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1181974,"ctime":1661912454,"ip_address":"åŒ—äº¬","comment_id":355974,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"Hpa æŸ¥å‡ºæ¥çš„cpuä½¿ç”¨ç‡æ˜¯æŠŠpodå†…çš„request cpuä½œä¸ºç”¨çš„cpuå—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585933,"discussion_content":"ä¸æ˜¯ï¼Œå®ƒè¦æ±‚podå¿…é¡»è¦æœ‰èµ„æºç”³è¯·ï¼Œå¦åˆ™å°±ä¸ä¼šå·¥ä½œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661912454,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}