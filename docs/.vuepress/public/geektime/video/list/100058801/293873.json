{"id":293873,"title":"37 | 项目实战：基于DataStream API实现PV，UV统计","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-Flink\">https://gitee.com/geektime-geekbang/geektime-Flink</a></p>","comments":[{"had_liked":false,"id":257813,"user_name":"danhanhan","can_delete":false,"product_type":"c3","uid":1701969,"ip_address":"","ucode":"5B63B9C391004F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEJEZvOtmicOtvd4twKCFakedsTjYX1icC6BEMYV1rceqdFHN6DcozxO9FB3ArrktBzh4QLqWibqlqibXQ/132","comment_is_top":false,"comment_ctime":1604138128,"is_pvip":false,"replies":[{"id":94044,"content":"谢谢","user_name":"作者回复","user_name_real":"张利兵","uid":1119779,"ctime":1604335174,"ip_address":"","comment_id":257813,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"老师讲得很好，学习了","like_count":1,"discussions":[{"author":{"id":1119779,"avatar":"https://static001.geekbang.org/account/avatar/00/11/16/23/99c7ede5.jpg","nickname":"张利兵","note":"","ucode":"DBAE17970AB143","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":508459,"discussion_content":"谢谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604335174,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":266851,"user_name":"高志强","can_delete":false,"product_type":"c3","uid":1276563,"ip_address":"","ucode":"68737002043752","user_header":"https://static001.geekbang.org/account/avatar/00/13/7a/93/c9302518.jpg","comment_is_top":false,"comment_ctime":1607506105,"is_pvip":false,"replies":[{"id":98228,"content":"Gitee上就可以下载到","user_name":"作者回复","user_name_real":"张利兵","uid":1119779,"ctime":1609242524,"ip_address":"","comment_id":266851,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"老师您好，我想问一下这节课的项目实战源码在哪里，想看看学习一下，谢谢","like_count":0,"discussions":[{"author":{"id":1119779,"avatar":"https://static001.geekbang.org/account/avatar/00/11/16/23/99c7ede5.jpg","nickname":"张利兵","note":"","ucode":"DBAE17970AB143","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511411,"discussion_content":"Gitee上就可以下载到","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609242524,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1817975,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/bd/77/52f54d7f.jpg","nickname":"开心D小鹏","note":"","ucode":"95775CDDF36E69","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":338853,"discussion_content":"还是找不到，gitee只有ppt","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609403399,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":280540,"user_name":"南山古月","can_delete":false,"product_type":"c3","uid":2415578,"ip_address":"","ucode":"600C7781C4078A","user_header":"https://static001.geekbang.org/account/avatar/00/24/db/da/bc7c71e5.jpg","comment_is_top":false,"comment_ctime":1614244602,"is_pvip":false,"replies":null,"discussion_count":2,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"看完这个实战有点疑惑，似乎完全不需要前两章讲到的flink部署，只需要将依赖的jar包下载下来就能完成flink的窗口计算了，与前面讲的提交作业到Client以及JobGraph的转换和提交是不是没有关系？","like_count":2,"discussions":[{"author":{"id":3532766,"avatar":"","nickname":"Geek_bad486","note":"","ucode":"52C97ECA91B1CF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":606441,"discussion_content":"这个是单机的 local环境","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677135406,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"湖北","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2830418,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/30/52/9ff0a0e7.jpg","nickname":"cong🐶","note":"","ucode":"00E913053C5F29","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530891,"discussion_content":"生产环境需要yarn或着k8s管理集群。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637162320,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":273088,"user_name":"碧雪天虹","can_delete":false,"product_type":"c3","uid":1258359,"ip_address":"","ucode":"313CC048C7E341","user_header":"https://static001.geekbang.org/account/avatar/00/13/33/77/0c593044.jpg","comment_is_top":false,"comment_ctime":1610434562,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"没有ElasticSearch环境, 相关Sink代码注释掉了.\nWebSocket提示找不到类, 引入 javax.websocket:javax.websocket-client-api:1.1 提示找不到实现, 上课20分钟配环境2小时.","like_count":2},{"had_liked":false,"id":392973,"user_name":"随遇而安丶","can_delete":false,"product_type":"c3","uid":1358656,"ip_address":"上海","ucode":"57E175E4FF7E3A","user_header":"https://static001.geekbang.org/account/avatar/00/14/bb/40/5ba38cfa.jpg","comment_is_top":false,"comment_ctime":1722350374,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"使用docker快速安装es，新建docker-es.yml：\nversion: &#39;3.8&#39;\nservices:\n  elasticsearch:\n    image: docker.elastic.co&#47;elasticsearch&#47;elasticsearch:7.17.3\n    container_name: elasticsearch\n    environment:\n      - node.name=es-node-1\n      - cluster.name=es-cluster\n      - network.host=0.0.0.0\n      - discovery.type=single-node\n      - ES_JAVA_OPTS=-Xms512m -Xmx512m\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n    ports:\n      - &quot;9200:9200&quot;\n      - &quot;9300:9300&quot;\n    volumes:\n      - esdata:&#47;usr&#47;share&#47;elasticsearch&#47;data\n    networks:\n      - es-network\n  kibana:\n    image: docker.elastic.co&#47;kibana&#47;kibana:7.17.3\n    container_name: kibana\n    environment:\n      - SERVER_NAME=kibana\n      - ELASTICSEARCH_HOSTS=http:&#47;&#47;elasticsearch:9200\n    ports:\n      - &quot;5601:5601&quot;\n    networks:\n      - es-network\n\n\nvolumes:\n  esdata:\n    driver: local\n\nnetworks:\n  es-network:\n    driver: bridge\n\n\n执行docker-compose -f docker-es.yml up -d","like_count":0},{"had_liked":false,"id":392972,"user_name":"随遇而安丶","can_delete":false,"product_type":"c3","uid":1358656,"ip_address":"上海","ucode":"57E175E4FF7E3A","user_header":"https://static001.geekbang.org/account/avatar/00/14/bb/40/5ba38cfa.jpg","comment_is_top":false,"comment_ctime":1722350322,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"使用docker快速安装kafka，新建文件docker-kafka.yml:\nversion: &#39;3&#39;\nservices:\n  zookeeper:\n    image: confluentinc&#47;cp-zookeeper:latest\n    ports:\n      - &quot;2181:2181&quot;\n    environment:\n      ZOOKEEPER_CLIENT_PORT: 2181\n      ZOOKEEPER_TICK_TIME: 2000\n\n  kafka:\n    image: confluentinc&#47;cp-kafka:latest\n    ports:\n      - &quot;9092:9092&quot;\n    environment:\n      KAFKA_BROKER_ID: 1\n      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181\n      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT:&#47;&#47;localhost:9092\n      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1\n\n\n执行命令docker-compose -f docker-kafka.yml up -d","like_count":0},{"had_liked":false,"id":380203,"user_name":"牛年榴莲","can_delete":false,"product_type":"c3","uid":1183703,"ip_address":"北京","ucode":"230C076193C6C0","user_header":"https://static001.geekbang.org/account/avatar/00/12/0f/d7/31d07471.jpg","comment_is_top":false,"comment_ctime":1693205200,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"这节课，貌似跟Flink的Server没有关系","like_count":0},{"had_liked":false,"id":350885,"user_name":"彭腾辉","can_delete":false,"product_type":"c3","uid":2182122,"ip_address":"","ucode":"BD15DF88F4CAE2","user_header":"https://static001.geekbang.org/account/avatar/00/21/4b/ea/f710a451.jpg","comment_is_top":false,"comment_ctime":1657279235,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"flink里面有做哪些数据处理，怎么做的好像没有讲到","like_count":0},{"had_liked":false,"id":334582,"user_name":"福","can_delete":false,"product_type":"c3","uid":2455712,"ip_address":"","ucode":"F2FC7AF5D433C6","user_header":"https://static001.geekbang.org/account/avatar/00/25/78/a0/7a248ddc.jpg","comment_is_top":false,"comment_ctime":1645005373,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"不是说windowall要添加触发器的嘛，，，我怎么没有看到触发器，然后窗口自己就触发了","like_count":0},{"had_liked":false,"id":310569,"user_name":"学无止境","can_delete":false,"product_type":"c3","uid":1645081,"ip_address":"","ucode":"BE6ADDF082AA69","user_header":"https://static001.geekbang.org/account/avatar/00/19/1a/19/440b0c7e.jpg","comment_is_top":false,"comment_ctime":1630748998,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"请教一下老师和各位同学，因为process()方法没有设置为1个并行度，这样求出来的uv,pv是不是每个节点的本地值的呢？","like_count":0,"discussions":[{"author":{"id":1645081,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1a/19/440b0c7e.jpg","nickname":"学无止境","note":"","ucode":"BE6ADDF082AA69","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":392004,"discussion_content":"测试了一下，是汇总的值。。看来窗口后的操作都是在一个并行度里操作的。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630761827,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":287620,"user_name":"wenjun00","can_delete":false,"product_type":"c3","uid":1263877,"ip_address":"","ucode":"2069D689BD5CBE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/5icX68uUNNsxLSfNTUhyicIhkaxTDXqqe5icyd24GPD8WPMUfexVMM15RPrviaWLc7HiabG3t4ib86GcVLopUDjpWllQ/132","comment_is_top":false,"comment_ctime":1618051808,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100058801,"comment_content":"Exception in thread &quot;main&quot; java.lang.RuntimeException: No data for required key &#39;index&#39;\n\tat org.apache.flink.api.java.utils.AbstractParameterTool.getRequired(AbstractParameterTool.java:82)\n\tat com.geekbang.flink.project.PVAndUVExample.main(PVAndUVExample.java:99)\n这个错误是什么啊，老师，我没看懂这块代码，还有我的es是带用户密码的，我添加一下这块代码：\n        Header[] defaultHeaders = new Header[]{new BasicHeader(&quot;elastic&quot;, &quot;elastic@admin&quot;)};\n        esSinkBuilder.setRestClientFactory(\n                restClientBuilder -&gt; { restClientBuilder.setDefaultHeaders(defaultHeaders);\n                }\n        );\n","like_count":0,"discussions":[{"author":{"id":1488243,"avatar":"https://static001.geekbang.org/account/avatar/00/16/b5/73/15a8006a.jpg","nickname":"goxdev","note":"","ucode":"7374587CD08BEE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391133,"discussion_content":"这里的index是elasticsearch中的index，可以是任一字符串，比如&#34;my-index&#34;。示例给的程序需要程序启动时传一个index参数。当然可以代码中写死，然后去掉parameterTool.getRequired(&#34;index&#34;)。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630310656,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":264683,"user_name":"小学生🍭","can_delete":false,"product_type":"c3","uid":2267592,"ip_address":"","ucode":"5F34627185DA5C","user_header":"https://static001.geekbang.org/account/avatar/00/22/99/c8/12fb3cac.jpg","comment_is_top":false,"comment_ctime":1606575491,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100058801,"comment_content":"真实工程会开发时，往往会和spring集成，利用spring的特性方便开发，老师可以讲一下如何集成spring吗","like_count":0,"discussions":[{"author":{"id":1213147,"avatar":"https://static001.geekbang.org/account/avatar/00/12/82/db/6df4d3d2.jpg","nickname":"sunsum","note":"","ucode":"380BB3A7DC030C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631553,"discussion_content":"+1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1699720402,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}