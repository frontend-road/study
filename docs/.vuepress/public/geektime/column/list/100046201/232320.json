{"id":232320,"title":"åŠ é¤ | RPCæ¡†æ¶ä»£ç å®ä¾‹è¯¦è§£","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ä½•å°é”‹ï¼Œå¥½ä¹…ä¸è§ï¼å’±ä»¬ä¸“æ ç»“è¯¾æœ‰æ®µæ—¶é—´äº†ï¼Œè¿™æœŸé—´æˆ‘å’Œç¼–è¾‘å†¬é’ä¸€èµ·å¯¹æ•´ä¸ªè¯¾ç¨‹åšäº†å¤ç›˜ï¼Œä¹Ÿè®¤çœŸæŒ¨ä¸ªé€å­—çœ‹äº†ç»“è¯¾é—®å·ä¸­çš„åé¦ˆï¼Œå…¶ä¸­å‘¼å£°æœ€é«˜çš„æ˜¯â€œæƒ³çœ‹RPCä»£ç å®ä¾‹â€ï¼Œä»Šå¤©æˆ‘å°±å¸¦ç€ä½ çš„æœŸå¾…æ¥äº†ã€‚</p><p>è¿˜è®°å¾—æˆ‘åœ¨<a href=\"https://time.geekbang.org/column/article/226573\">[ç»“æŸè¯­]</a>æåˆ°è¿‡ï¼Œæˆ‘åœ¨å†™è¿™ä¸ªä¸“æ ä¹‹å‰ï¼ŒæŠŠå…¬å¸å†…éƒ¨æˆ‘è´Ÿè´£çš„RPCæ¡†æ¶é‡æ–°å†™äº†ä¸€éã€‚å£è¯´æ— å‡­ï¼Œç°åœ¨è¿™ä¸ªRPCæ¡†æ¶å·²ç»<a href=\"https://github.com/joyrpc/joyrpc\">å¼€æº</a>ï¼Œæ¥å—ä½ çš„æ£€é˜…ã€‚</p><p>ä¸‹é¢æˆ‘å°±é’ˆå¯¹è¿™å¥—ä»£ç åšä¸€ä¸ªè¯¦ç»†çš„è§£æï¼Œå¸Œæœ›èƒ½å¸®ä½ ä¸²è”å·²å­¦çš„çŸ¥è¯†ç‚¹ï¼Œå®æˆ˜æ¼”ç»ƒï¼Œæœ‰æ‰€æ”¶è·ã€‚</p><h2>RPCæ¡†æ¶æ•´ä½“ç»“æ„</h2><p>é¦–å…ˆè¯´æˆ‘ä»¬RPCæ¡†æ¶çš„æ•´ä½“æ¶æ„ï¼Œè¿™é‡Œè¯·ä½ å›æƒ³ä¸‹<a href=\"https://time.geekbang.org/column/article/207137\">[ç¬¬ 07 è®²]</a>ï¼Œåœ¨è¿™ä¸€è®²ä¸­æˆ‘è®²è§£äº†å¦‚ä½•è®¾è®¡ä¸€ä¸ªçµæ´»çš„RPCæ¡†æ¶ï¼Œå…¶å…³é”®ç‚¹å°±æ˜¯æ’ä»¶åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ’ä»¶ä½“ç³»æ¥æé«˜RPCçš„æ‰©å±•æ€§ï¼Œä½¿å…¶æˆä¸ºä¸€ä¸ªå¾®å†…æ ¸æ¶æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/a3/a6/a3688580dccd3053fac8c0178cef4ba6.jpg?wh=3084*2183\" alt=\"\" title=\"æ’ä»¶åŒ–RPC\"></p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å°†RPCæ¡†æ¶å¤§ä½“åˆ†ä¸ºäº†å››å±‚ï¼Œåˆ†åˆ«æ˜¯å…¥å£å±‚ã€é›†ç¾¤å±‚ã€åè®®å±‚å’Œä¼ è¾“å±‚ï¼Œè€Œè¿™å››å±‚ä¸­åˆ†åˆ«åŒ…å«äº†ä¸€ç³»åˆ—çš„æ’ä»¶ï¼Œè€Œåœ¨å®é™…çš„RPCæ¡†æ¶ä¸­æ’ä»¶ä¼šæ›´å¤šã€‚åœ¨æˆ‘æ‰€å¼€æºçš„RPCæ¡†æ¶ä¸­å°±è¶…è¿‡äº†50ä¸ªæ’ä»¶ï¼Œå…¶ä¸­æ¶‰åŠåˆ°çš„ä»£ç é‡ä¹Ÿæ˜¯ç›¸å½“å¤§çš„ï¼Œä¸‹é¢æˆ‘å°±é€šè¿‡<strong>æœåŠ¡ç«¯å¯åŠ¨æµç¨‹ã€è°ƒç”¨ç«¯å¯åŠ¨æµç¨‹ã€RPCè°ƒç”¨æµç¨‹</strong>è¿™ä¸‰å¤§æµç¨‹æ¥å°†RPCæ¡†æ¶çš„æ ¸å¿ƒæ¨¡å—ä»¥åŠæ ¸å¿ƒç±»ä¸²è”èµ·æ¥ï¼Œç†è§£äº†è¿™ä¸‰å¤§æµç¨‹ä¼šå¯¹ä½ é˜…è¯»ä»£ç æœ‰éå¸¸å¤§çš„å¸®åŠ©ã€‚</p><!-- [[[read_end]]] --><h2>æœåŠ¡ç«¯å¯åŠ¨æµç¨‹</h2><p>åœ¨è®²è§£æœåŠ¡å¯åŠ¨æµç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹æœåŠ¡ç«¯å¯åŠ¨çš„ä»£ç ç¤ºä¾‹ï¼Œå¦‚ä¸‹ï¼š</p><pre><code>public static void main(String[] args) throws Exception {\n\n    DemoService demoService = new DemoServiceImpl(); //æœåŠ¡æä¾›è€…è®¾ç½®\n    ProviderConfig&lt;DemoService&gt; providerConfig = new ProviderConfig&lt;&gt;();\n    providerConfig.setServerConfig(new ServerConfig());\n    providerConfig.setInterfaceClazz(DemoService.class.getName());\n    providerConfig.setRef(demoService);\n    providerConfig.setAlias(&quot;joyrpc-demo&quot;);\n    providerConfig.setRegistry(new RegistryConfig(&quot;broadcast&quot;));\n\n    providerConfig.exportAndOpen().whenComplete((v, t) -&gt; {\n        if (t != null) {\n            logger.error(t.getMessage(), t);\n            System.exit(1);\n        }\n    });\n\n    System.in.read();\n\n}\n</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒproviderConfigæ˜¯é€šè¿‡è°ƒç”¨exportAndOpen()æ–¹æ³•æ¥å¯åŠ¨æœåŠ¡ç«¯çš„ï¼Œé‚£ä¹ˆä¸ºä½•è¿™ä¸ªæ–¹æ³•è¦å¦‚æ­¤å‘½åå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹ exportAndOpen æ–¹æ³•çš„ä»£ç å®ç°ï¼š</p><pre><code>public CompletableFuture&lt;Void&gt; exportAndOpen() {\n\n    CompletableFuture&lt;Void&gt; future = new CompletableFuture&lt;&gt;();\n    export().whenComplete((v, t) -&gt; {\n        if (t != null) {\n            future.completeExceptionally(t);\n        } else {\n            Futures.chain(open(), future);\n        }\n    });\n\n    return future;\n\n}\n</code></pre><p>è¿™é‡ŒæœåŠ¡çš„å¯åŠ¨æµç¨‹è¢«åˆ†ä¸ºäº†ä¸¤ä¸ªéƒ¨åˆ†ï¼Œexportï¼ˆåˆ›å»ºExportå¯¹è±¡ï¼‰ä»¥åŠopenï¼ˆæ‰“å¼€æœåŠ¡ï¼‰ã€‚è€ŒæœåŠ¡ç«¯çš„å¯åŠ¨æµç¨‹ä¹Ÿè¢«åˆ†ä¸ºäº†ä¸¤éƒ¨åˆ†ï¼šæœåŠ¡ç«¯çš„åˆ›å»ºæµç¨‹ä¸æœåŠ¡ç«¯çš„å¼€å¯æµç¨‹ã€‚</p><h3>æœåŠ¡ç«¯åˆ›å»ºæµç¨‹</h3><p><img src=\"https://static001.geekbang.org/resource/image/f4/5b/f411bc3b3dbfbfaefe08671b25a5f65b.jpg?wh=4051*3290\" alt=\"\" title=\"æœåŠ¡ç«¯åˆ›å»ºæµç¨‹å›¾\"></p><p>è¿™é‡Œçš„ProviderConfigæ˜¯æœåŠ¡ç«¯çš„é…ç½®å¯¹è±¡ï¼Œå…¶ä¸­æ¥å£ã€åˆ†ç»„ã€æ³¨å†Œä¸­å¿ƒé…ç½®ç­‰ç­‰çš„ç›¸å…³ä¿¡æ¯éƒ½åœ¨è¿™ä¸ªé…ç½®ç±»ä¸­é…ç½®ï¼Œæµç¨‹çš„å…¥å£æ˜¯è°ƒç”¨ProviderConfigçš„exportæ–¹æ³•ï¼Œæ•´ä¸ªæµç¨‹å¦‚ä¸‹ï¼š</p><ol>\n<li>æ ¹æ®ProviderConfigçš„é…ç½®ä¿¡æ¯ç”ŸæˆregistryUrlï¼ˆæ³¨å†Œä¸­å¿ƒURLå¯¹è±¡ï¼‰ä¸serviceUrlï¼ˆæœåŠ¡URLå¯¹è±¡ï¼‰ï¼›</li>\n<li>æ ¹æ®registryUrlï¼Œè°ƒç”¨Registryæ’ä»¶ï¼Œåˆ›å»ºRegistryå¯¹è±¡ï¼ŒRegistryå¯¹è±¡ä¸ºæ³¨å†Œä¸­å¿ƒå¯¹è±¡ï¼Œä¸æ³¨å†Œä¸­å¿ƒè¿›è¡Œäº¤äº’ï¼›</li>\n<li>è°ƒç”¨Registryå¯¹è±¡çš„openæ–¹æ³•ï¼Œå¼€å¯æ³¨å†Œä¸­å¿ƒå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ä¸æ³¨å†Œä¸­å¿ƒå»ºç«‹è¿æ¥ï¼›</li>\n<li>è°ƒç”¨Registryå¯¹è±¡çš„subscribeæ–¹æ³•ï¼Œè®¢é˜…æ¥å£çš„é…ç½®ä¿¡æ¯ä¸å…¨å±€é…ç½®ä¿¡æ¯ï¼›</li>\n<li>è°ƒç”¨InvokerManagerï¼Œåˆ›å»ºExporterå¯¹è±¡ï¼›</li>\n<li>InvokerManagerè¿”å›Exporterå¯¹è±¡ã€‚</li>\n</ol><p>æœåŠ¡ç«¯çš„åˆ›å»ºæµç¨‹å®é™…ä¸Šå°±æ˜¯Exporterå¯¹è±¡ï¼ŒExporterå¯¹è±¡æ˜¯è°ƒç”¨å™¨Invokeræ¥å£çš„å­ç±»ï¼ŒInvokeræ¥å£æœ‰ä¸¤ä¸ªå­ç±»ï¼Œåˆ†åˆ«æ˜¯Exporterä¸Referï¼ŒExporterç”¨æ¥å¤„ç†æœåŠ¡ç«¯æ¥æ”¶çš„è¯·æ±‚ï¼Œè€ŒReferç”¨æ¥å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼Œè¿™ä¸¤ä¸ªç±»å¯ä»¥è¯´æ˜¯å…¥å£å±‚æœ€ä¸ºæ ¸å¿ƒçš„ä¸¤ä¸ªç±»ã€‚</p><p>åœ¨InvokerManageråˆ›å»ºExporterå¯¹è±¡æ—¶å®é™…ä¸Šä¼šæœ‰ä¸€ç³»åˆ—çš„æ“ä½œï¼Œè€Œåˆå§‹åŒ–Exporterä¹Ÿä¼šæœ‰ä¸€ç³»åˆ—çš„æ“ä½œï¼Œå¦‚åˆ›å»ºFilteré“¾ã€åˆ›å»ºè®¤è¯ä¿¡æ¯ç­‰ç­‰ã€‚è¿™é‡Œä¸å†è¯¦ç»†å™è¿°ï¼Œä½ å¯ä»¥é˜…è¯»ä¸‹æºç ã€‚</p><h3>æœåŠ¡ç«¯å¼€å¯æµç¨‹</h3><p><img src=\"https://static001.geekbang.org/resource/image/70/cf/706ce659565164d457efc040c93976cf.jpg?wh=5608*3002\" alt=\"\" title=\"æœåŠ¡ç«¯å¼€å¯æµç¨‹å›¾\"></p><p>åˆ›å»ºå®ŒæœåŠ¡ç«¯çš„Exporterå¯¹è±¡ä¹‹åï¼Œæˆ‘ä»¬å°±è¦å¼€å¯Exporterå¯¹è±¡ï¼Œå¼€å¯Exporterå¯¹è±¡æœ€é‡è¦çš„ä¸¤ä¸ªæ“ä½œå°±æ˜¯å¼€å¯ä¼ è¾“å±‚ä¸­Serverçš„ç«¯å£ï¼Œç”¨æ¥æ¥æ”¶è°ƒç”¨ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚ï¼Œä»¥åŠå°†æœåŠ¡ç«¯èŠ‚ç‚¹æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒä¸Šï¼Œè®©è°ƒç”¨ç«¯å¯ä»¥å‘ç°åˆ°è¿™ä¸ªæœåŠ¡èŠ‚ç‚¹ï¼Œæ•´ä¸ªæµç¨‹å¦‚ä¸‹ï¼š</p><ol>\n<li>è°ƒç”¨Exporterå¯¹è±¡çš„openæ–¹æ³•ï¼Œå¼€å¯æœåŠ¡ç«¯ï¼›</li>\n<li>Exporterå¯¹è±¡è°ƒç”¨æ¥å£é¢„çƒ­æ’ä»¶ï¼Œè¿›è¡Œæ¥å£é¢„çƒ­ï¼›</li>\n<li>Exporterå¯¹è±¡è°ƒç”¨ä¼ è¾“å±‚ä¸­çš„EndpointFactroyæ’ä»¶ï¼Œåˆ›å»ºä¸€ä¸ªServerå¯¹è±¡ï¼Œä¸€ä¸ªServerå¯¹è±¡å°±ä»£è¡¨ä¸€ä¸ªç«¯å£äº†ï¼›</li>\n<li>è°ƒç”¨Serverå¯¹è±¡çš„openæ–¹æ³•ï¼Œå¼€å¯ç«¯å£ï¼Œç«¯å£å¼€å¯ä¹‹åï¼ŒæœåŠ¡ç«¯å°±å¯ä»¥æä¾›è¿œç¨‹æœåŠ¡äº†ï¼›</li>\n<li>Exporterå¯¹è±¡è°ƒç”¨Registryå¯¹è±¡çš„registeræ–¹æ³•ï¼Œå°†è¿™ä¸ªè°ƒç”¨ç«¯èŠ‚ç‚¹æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒä¸­ã€‚</li>\n</ol><p>è¿™é‡Œæ— è®ºæ˜¯Exporterçš„openæ–¹æ³•ã€Serverçš„openè¿˜æ˜¯Registryçš„registeræ–¹æ³•ï¼Œéƒ½æ˜¯å¼‚æ­¥æ–¹æ³•ï¼Œè¿”å›å€¼ä¸ºCompletableFutureå¯¹è±¡ï¼Œè¿™ä¸ªæµç¨‹çš„æ¯ä¸ªç¯èŠ‚ä¹Ÿéƒ½æ˜¯å¼‚æ­¥çš„ã€‚</p><p>Serverçš„openæ“ä½œå®é™…ä¸Šæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„æ“ä½œï¼Œè¦ç»‘å®šåè®®é€‚é…å™¨ã€åˆå§‹åŒ–sessionç®¡ç†å™¨ã€æ·»åŠ eventbusäº‹ä»¶ç›‘å¬ç­‰ç­‰çš„æ“ä½œï¼Œè€Œä¸”æ•´ä¸ªæµç¨‹å®Œå…¨å¼‚æ­¥ï¼Œå¹¶ä¸”æ˜¯æ’ä»¶åŒ–çš„ã€‚</p><h2>è°ƒç”¨ç«¯å¯åŠ¨æµç¨‹</h2><p>åœ¨è®²è§£è°ƒç”¨ç«¯å¯åŠ¨æµç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜æ˜¯å…ˆçœ‹ä¸‹ä»£ç ç¤ºä¾‹ï¼Œè°ƒç”¨ç«¯å¯åŠ¨ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code>public static void main(String[] args) {\n\n    ConsumerConfig&lt;DemoService&gt; consumerConfig = new ConsumerConfig&lt;&gt;(); //consumerè®¾ç½®\n    consumerConfig.setInterfaceClazz(DemoService.class.getName());\n    consumerConfig.setAlias(&quot;joyrpc-demo&quot;);\n    consumerConfig.setRegistry(new RegistryConfig(&quot;broadcast&quot;));\n\n    try {\n        CompletableFuture&lt;DemoService&gt; future = consumerConfig.refer();\n        DemoService service = future.get();\n\n        String echo = service.sayHello(&quot;hello&quot;); //å‘èµ·æœåŠ¡è°ƒç”¨\n        logger.info(&quot;Get msg: {} &quot;, echo);\n    } catch (Throwable e) {\n        logger.error(e.getMessage(), e);\n    }\n\n    System.in.read();\n\n}\n</code></pre><p>è°ƒç”¨ç«¯æµç¨‹çš„å¯åŠ¨å…¥å£å°±æ˜¯ConsumerConfigå¯¹è±¡çš„referæ–¹æ³•ï¼ŒConsumerConfigå¯¹è±¡å°±æ˜¯è°ƒç”¨ç«¯çš„é…ç½®å¯¹è±¡ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°referæ–¹æ³•çš„è¿”å›å€¼æ˜¯CompletableFutureï¼Œä¸æœåŠ¡ç«¯ç›¸åŒï¼Œè°ƒç”¨ç«¯çš„å¯åŠ¨æµç¨‹ä¹Ÿå®Œå…¨æ˜¯å¼‚æ­¥çš„ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹è°ƒç”¨ç«¯çš„å¯åŠ¨æµç¨‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/01/f3/01ab5a2288cfe1d0aadbe7a38da8c9f3.jpg?wh=5904*4500\" alt=\"\" title=\"è°ƒç”¨ç«¯å¯åŠ¨æµç¨‹\"></p><p>è°ƒç”¨ç«¯å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><ol>\n<li>æ ¹æ®ConsumerConfigçš„é…ç½®ä¿¡æ¯ç”ŸæˆregistryUrlï¼ˆæ³¨å†Œä¸­å¿ƒURLå¯¹è±¡ï¼‰ä¸serviceUrlï¼ˆæœåŠ¡URLå¯¹è±¡ï¼‰ï¼›</li>\n<li>æ ¹æ®registryUrlï¼Œè°ƒç”¨Registryæ’ä»¶ï¼Œåˆ›å»ºRegistryå¯¹è±¡ï¼ŒRegistryå¯¹è±¡ä¸ºæ³¨å†Œä¸­å¿ƒå¯¹è±¡ï¼Œä¸æ³¨å†Œä¸­å¿ƒè¿›è¡Œäº¤äº’ï¼›</li>\n<li>åˆ›å»ºåŠ¨æ€ä»£ç†å¯¹è±¡ï¼›</li>\n<li>è°ƒç”¨Registryå¯¹è±¡çš„Openæ–¹æ³•ï¼Œå¼€å¯æ³¨å†Œä¸­å¿ƒå¯¹è±¡ï¼›</li>\n<li>è°ƒç”¨Registryå¯¹è±¡subscribeæ–¹æ³•ï¼Œè®¢é˜…æ¥å£çš„é…ç½®ä¿¡æ¯ä¸å…¨å±€é…ç½®ä¿¡æ¯ï¼›</li>\n<li>è°ƒç”¨InvokeManagerçš„referæ–¹æ³•ï¼Œç”¨æ¥åˆ›å»ºReferå¯¹è±¡ï¼›</li>\n<li>InvokeManageråœ¨åˆ›å»ºReferå¯¹è±¡ä¹‹å‰ä¼šå…ˆåˆ›å»ºClusterå¯¹è±¡ï¼ŒCluserå¯¹è±¡æ˜¯é›†ç¾¤å±‚çš„æ ¸å¿ƒå¯¹è±¡ï¼ŒClusterä¼šç»´æŠ¤è¯¥è°ƒç”¨ç«¯ä¸æœåŠ¡ç«¯èŠ‚ç‚¹çš„è¿æ¥çŠ¶æ€ï¼›</li>\n<li>InvokeManageråˆ›å»ºReferå¯¹è±¡ï¼›</li>\n<li>Referå¯¹è±¡åˆå§‹åŒ–ï¼Œå…¶ä¸­ä¸»è¦åŒ…æ‹¬åˆ›å»ºè·¯ç”±ç­–ç•¥ã€æ¶ˆæ¯åˆ†å‘ç­–ç•¥ã€åˆ›å»ºè´Ÿè½½å‡è¡¡ã€è°ƒç”¨é“¾ã€æ·»åŠ eventbusäº‹ä»¶ç›‘å¬ç­‰ç­‰ï¼›</li>\n<li>ConsumerConfigè°ƒç”¨Referçš„openæ–¹æ³•ï¼Œå¼€å¯è°ƒç”¨ç«¯ï¼›</li>\n<li>Referå¯¹è±¡è°ƒç”¨Clusterå¯¹è±¡çš„openæ–¹æ³•ï¼Œå¼€å¯é›†ç¾¤ï¼›</li>\n<li>Clusterå¯¹è±¡è°ƒç”¨Registryå¯¹è±¡çš„subcribeæ–¹æ³•ï¼Œè®¢é˜…æœåŠ¡ç«¯èŠ‚ç‚¹å˜åŒ–ï¼Œæ”¶åˆ°æœåŠ¡ç«¯èŠ‚ç‚¹å˜åŒ–æ—¶ï¼ŒClusterä¼šè°ƒç”¨ä¼ è¾“å±‚EndpointFactroyæ’ä»¶ï¼Œåˆ›å»ºClientå¯¹è±¡ï¼Œä¸è¿™äº›æœåŠ¡èŠ‚ç‚¹å»ºç«‹è¿æ¥ï¼ŒClusterä¼šç»´æŠ¤è¿™äº›è¿æ¥ï¼›</li>\n<li>ConsumerConfigè°ƒç”¨Referå¯¹è±¡å°è£…åˆ°ConsumerInvokerHandlerä¸­ï¼Œå°†ConsumerInvokerHandlerå¯¹è±¡æ³¨å…¥ç»™åŠ¨æ€ä»£ç†å¯¹è±¡ã€‚</li>\n</ol><p>åœ¨è°ƒç”¨ç«¯çš„å¼€å¯æµç¨‹ä¸­ï¼Œæœ€å¤æ‚çš„æ“ä½œå°±æ˜¯Clusterå¯¹è±¡çš„openæ“ä½œä»¥åŠClientå¯¹è±¡çš„openæ“ä½œã€‚</p><p>Clusterå¯¹è±¡æ˜¯é›†ç¾¤å±‚çš„æ ¸å¿ƒå¯¹è±¡ï¼Œä¹Ÿæ˜¯è¿™ä¸ªRPCæ¡†æ¶ä¸­å¤„ç†é€»è¾‘æœ€ä¸ºå¤æ‚çš„å¯¹è±¡ï¼ŒClusterå¯¹è±¡è´Ÿè´£ç»´æŠ¤è¯¥è°ƒç”¨ç«¯èŠ‚ç‚¹é›†ç¾¤ä¿¡æ¯ï¼Œç›‘å¬æ³¨å†Œä¸­å¿ƒæ¨é€çš„æœåŠ¡èŠ‚ç‚¹æ›´æ–°äº‹ä»¶ï¼Œè°ƒç”¨ä¼ è¾“å±‚ä¸­çš„EndpointFactroyæ’ä»¶ï¼Œåˆ›å»ºClientå¯¹è±¡ï¼Œå¹¶ä¸”ä¼šé€šè¿‡Clientä¸æœåŠ¡ç«¯èŠ‚ç‚¹å»ºç«‹è¿æ¥ï¼Œå‘é€åå•†ä¿¡æ¯ã€å®‰å…¨éªŒè¯ä¿¡æ¯ã€å¿ƒè·³ä¿¡æ¯ï¼Œé€šè¿‡å¿ƒè·³æœºåˆ¶ç»´æŠ¤ä¸æœåŠ¡èŠ‚ç‚¹çš„è¿æ¥çŠ¶æ€ã€‚</p><p>Clientå¯¹è±¡çš„openæ“ä½œä¹Ÿæ˜¯æœ‰ç€ä¸€ç³»åˆ—çš„æ“ä½œï¼Œæ¯”å¦‚åˆ›å»ºTransportå¯¹è±¡ï¼Œåˆ›å»ºChannelå¯¹è±¡ï¼Œç”Ÿæˆå¹¶è®°å½•sessionä¿¡æ¯ç­‰ç­‰ã€‚</p><p>Referå¯¹è±¡åœ¨æ„é€ è°ƒç”¨é“¾çš„æ—¶å€™ï¼Œå…¶æœ€åä¸€ä¸ªè°ƒç”¨é“¾å°±æ˜¯Referå¯¹è±¡çš„distributeæ–¹æ³•ï¼Œç”¨æ¥å‘é€è¿œç¨‹è¯·æ±‚ã€‚</p><p>åŠ¨æ€ä»£ç†å¯¹è±¡å†…éƒ¨çš„æ ¸å¿ƒé€»è¾‘å°±æ˜¯è°ƒç”¨ConsumerInvokerHandlerå¯¹è±¡çš„Invokeæ–¹æ³•ï¼Œæœ€ç»ˆå°±æ˜¯è°ƒç”¨Referå¯¹è±¡ï¼Œæˆ‘ä¼šåœ¨ä¸‹é¢çš„RPCè°ƒç”¨æµç¨‹ä¸­è¯¦ç»†è®²ä¸‹ã€‚</p><h2>RPCè°ƒç”¨æµç¨‹</h2><p>è®²è§£å®Œäº†æœåŠ¡ç«¯çš„å¯åŠ¨æµç¨‹ä¸è°ƒç”¨ç«¯çš„å¯åŠ¨æµç¨‹ï¼Œä¸‹é¢æˆ‘å¼€å§‹è®²è§£RPCçš„è°ƒç”¨æµç¨‹ã€‚RPCçš„æ•´ä¸ªè°ƒç”¨æµç¨‹å°±æ˜¯è°ƒç”¨ç«¯å‘é€è¯·æ±‚æ¶ˆæ¯ä»¥åŠæœåŠ¡ç«¯æ¥æ”¶è¯·æ±‚æ¶ˆæ¯å¹¶å¤„ç†ï¼Œä¹‹åå“åº”ç»™è°ƒç”¨ç«¯çš„æµç¨‹ã€‚</p><p>ä¸‹é¢æˆ‘å°±è®²è§£ä¸‹è°ƒç”¨ç«¯çš„å‘é€æµç¨‹ä¸æœåŠ¡ç«¯çš„æ¥æ”¶æµç¨‹ã€‚</p><h3>è°ƒç”¨ç«¯å‘é€æµç¨‹</h3><p><img src=\"https://static001.geekbang.org/resource/image/f8/aa/f875674fd3959193202abb38fdb956aa.jpg?wh=6188*3506\" alt=\"\" title=\"è°ƒç”¨ç«¯å‘é€æµç¨‹\"></p><p>è°ƒç”¨ç«¯å‘é€æµç¨‹å¦‚ä¸‹ï¼š</p><ol>\n<li>åŠ¨æ€ä»£ç†å¯¹è±¡è°ƒç”¨ConsumerInvokerHandlerå¯¹è±¡çš„Invokeæ–¹æ³•ï¼›</li>\n<li>ConsumerInvokerHandlerå¯¹è±¡ç”Ÿæˆè¯·æ±‚æ¶ˆæ¯å¯¹è±¡ï¼›</li>\n<li>ConsumerInvokerHandlerå¯¹è±¡è°ƒç”¨Referå¯¹è±¡çš„Invokeæ–¹æ³•ï¼›</li>\n<li>Referå¯¹è±¡å¯¹è¯·æ±‚æ¶ˆæ¯å¯¹è±¡è¿›è¡Œå¤„ç†ï¼Œå¦‚è®¾ç½®æ¥å£ä¿¡æ¯ã€åˆ†ç»„ä¿¡æ¯ç­‰ç­‰ï¼›</li>\n<li>Referå¯¹è±¡è°ƒç”¨æ¶ˆæ¯é€ä¼ æ’ä»¶ï¼Œå¤„ç†é€ä¼ ä¿¡æ¯ï¼Œå…¶ä¸­å°±åŒ…æ‹¬éšå¼å‚æ•°ä¿¡æ¯ï¼›</li>\n<li>Referå¯¹è±¡è°ƒç”¨FilterChainå¯¹è±¡çš„Invokeræ–¹æ³•ï¼Œæ‰§è¡Œè°ƒç”¨é“¾ï¼›</li>\n<li>FilterChainå¯¹è±¡è°ƒç”¨æ¯ä¸ªFilterï¼›</li>\n<li>Referå¯¹è±¡çš„distributeæ–¹æ³•ä½œä¸ºæœ€åä¸€ä¸ªFilterï¼Œè¢«è°ƒç”¨é“¾æœ€åä¸€ä¸ªæ‰§è¡Œã€‚</li>\n<li>è°ƒç”¨NodeSelecterå¯¹è±¡çš„selectæ–¹æ³•ï¼ŒNodeSelecteræ˜¯é›†ç¾¤å±‚çš„è·¯ç”±è§„åˆ™èŠ‚ç‚¹é€‰æ‹©å™¨ï¼Œå…¶selectæ–¹æ³•ç”¨æ¥é€‰æ‹©å‡ºç¬¦åˆè·¯ç”±è§„åˆ™çš„æœåŠ¡èŠ‚ç‚¹ï¼›</li>\n<li>è°ƒç”¨Routeå¯¹è±¡çš„routeæ–¹æ³•ï¼ŒRouteå¯¹è±¡ä¸ºè·¯ç”±åˆ†å‘å™¨ï¼Œä¹Ÿæ˜¯é›†ç¾¤å±‚ä¸­çš„å¯¹è±¡ï¼Œé»˜è®¤ä¸ºè·¯ç”±åˆ†å‘ç­–ç•¥ä¸ºFailoverï¼Œå³è¯·æ±‚å¤±è´¥åå¯ä»¥é‡è¯•è¯·æ±‚ï¼Œè¿™é‡Œä½ å¯ä»¥å›é¡¾ä¸‹<a href=\"https://time.geekbang.org/column/article/211261\">[ç¬¬ 12 è®²]</a>ï¼Œåœ¨è¿™ä¸€è®²çš„æ€è€ƒé¢˜ä¸­æˆ‘å°±é—®è¿‡å¼‚å¸¸é‡è¯•å‘é€åœ¨RPCè°ƒç”¨ä¸­çš„å“ªä¸ªç¯èŠ‚ï¼Œå…¶å®å°±åœ¨æ­¤ç¯èŠ‚ï¼›</li>\n<li>Routeå¯¹è±¡è°ƒç”¨LoadBalanceå¯¹è±¡çš„selectæ–¹æ³•ï¼Œé€šè¿‡è´Ÿè½½å‡è¡¡é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ï¼›</li>\n<li>Routeå¯¹è±¡å›è°ƒReferå¯¹è±¡çš„invokeRemoteæ–¹æ³•ï¼›</li>\n<li>Referå¯¹è±¡çš„invokeRemoteæ–¹æ³•è°ƒç”¨ä¼ è¾“å±‚ä¸­Clientå¯¹è±¡ï¼Œå‘æœåŠ¡ç«¯èŠ‚ç‚¹å‘é€æ¶ˆæ¯ã€‚</li>\n</ol><p>åœ¨è°ƒç”¨ç«¯å‘é€æµç¨‹ä¸­ï¼Œæœ€ç»ˆä¼šé€šè¿‡ä¼ è¾“å±‚å°†æ¶ˆæ¯å‘é€ç»™æœåŠ¡ç«¯ï¼Œè¿™é‡Œå¯¹ä¼ è¾“å±‚çš„æ“ä½œæ²¡æœ‰è¯¦ç»†çš„è®²è§£ï¼Œå…¶å®ä¼ è¾“å±‚å†…éƒ¨çš„æµç¨‹è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œä¹Ÿä¼šæœ‰ä¸€ç³»åˆ—çš„æ“ä½œï¼Œæ¯”å¦‚åˆ›å»ºFutureå¯¹è±¡ã€è°ƒç”¨FutureManagerç®¡ç†Futureå¯¹è±¡ã€è¯·æ±‚æ¶ˆæ¯åè®®è½¬æ¢å¤„ç†ã€ç¼–è§£ç ã€è¶…æ—¶å¤„ç†ç­‰ç­‰çš„æ“ä½œã€‚</p><p>å½“è°ƒç”¨ç«¯å‘é€å®Œè¯·æ±‚æ¶ˆæ¯ä¹‹åï¼ŒæœåŠ¡ç«¯å°±ä¼šæ¥æ”¶åˆ°è¯·æ±‚æ¶ˆæ¯å¹¶å¯¹è¯·æ±‚æ¶ˆæ¯è¿›è¡Œå¤„ç†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹æœåŠ¡ç«¯çš„æ¥æ”¶æµç¨‹ã€‚</p><h3>æœåŠ¡ç«¯æ¥æ”¶æµç¨‹</h3><p><img src=\"https://static001.geekbang.org/resource/image/65/cb/65b25a2b06f6223e19adaddd992542cb.jpg?wh=4955*4481\" alt=\"\" title=\"æœåŠ¡ç«¯æ¥æ”¶æµç¨‹\"></p><p>æœåŠ¡ç«¯çš„ä¼ è¾“å±‚ä¼šæ¥æ”¶åˆ°è¯·æ±‚æ¶ˆæ¯ï¼Œå¹¶å¯¹è¯·æ±‚æ¶ˆæ¯è¿›è¡Œç¼–è§£ç ä»¥åŠååºåˆ—åŒ–ï¼Œä¹‹åè°ƒç”¨Exporterå¯¹è±¡çš„invokeæ–¹æ³•ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><ol>\n<li>ä¼ è¾“å±‚æ¥æ”¶åˆ°è¯·æ±‚ï¼Œè§¦å‘åè®®é€‚é…å™¨ProtocolAdapterï¼›</li>\n<li>ProtocolAdapterå¯¹è±¡éå†Protocolæ’ä»¶çš„å®ç°ç±»ï¼ŒåŒ¹é…åè®®ï¼›</li>\n<li>åŒ¹é…åè®®ä¹‹åï¼Œæ ¹æ®Protocolå¯¹è±¡ï¼Œä¼ è¾“å±‚çš„Serverå¯¹è±¡ç»‘å®šè¯¥åè®®çš„ç¼–è§£ç å™¨ï¼ˆCodecå¯¹è±¡ï¼‰ã€Channelå¤„ç†é“¾ï¼ˆChainChannelHandlerå¯¹è±¡ï¼‰ï¼›</li>\n<li>å¯¹æ¥æ”¶çš„æ¶ˆæ¯è¿›è¡Œè§£ç ä¸ååºåˆ—åŒ–ï¼›</li>\n<li>æ‰§è¡ŒChannelå¤„ç†é“¾ï¼›</li>\n<li>åœ¨ä¸šåŠ¡çº¿ç¨‹æ± ä¸­è°ƒç”¨æ¶ˆæ¯å¤„ç†é“¾ï¼ˆMessageHandleæ’ä»¶ï¼‰ï¼›</li>\n<li>è°ƒç”¨BizReqHandleå¯¹è±¡çš„handleæ–¹æ³•ï¼Œå¤„ç†è¯·æ±‚æ¶ˆæ¯ï¼›</li>\n<li>BizReqHandleå¯¹è±¡è°ƒç”¨restoreæ–¹æ³•ï¼Œæ ¹æ®è¿æ¥Sessionä¿¡æ¯ï¼Œå¤„ç†è¯·æ±‚æ¶ˆæ¯æ•°æ®ï¼Œå¹¶æ ¹æ®è¯·æ±‚çš„æ¥å£åã€åˆ†ç»„åä¸æ–¹æ³•åï¼Œè·å–Exporterå¯¹è±¡ï¼›</li>\n<li>è°ƒç”¨Exporterå¯¹è±¡çš„invokeæ–¹æ³•ï¼ŒExporterå¯¹è±¡è¿”å›CompletableFutureå¯¹è±¡ï¼›</li>\n<li>Exporterå¯¹è±¡è°ƒç”¨FilterChainçš„invokeæ–¹æ³•ï¼›</li>\n<li>FilterChainæ‰§è¡Œæ‰€æœ‰Filterå¯¹è±¡ï¼›</li>\n<li>Exporterå¯¹è±¡çš„invokeMethodæ–¹æ³•ä½œä¸ºæœ€åä¸€ä¸ªFilterï¼Œæœ€åè¢«è°ƒç”¨ï¼›</li>\n<li>Exporterå¯¹è±¡çš„invokeMethodæ–¹æ³•å¤„ç†è¯·æ±‚ä¸Šä¸‹æ–‡ï¼Œæ‰§è¡Œåå°„ï¼›</li>\n<li>Exporterå¯¹è±¡å°†æ‰§è¡Œåå°„ä¹‹åå¾—åˆ°çš„è¯·æ±‚ç»“æœå¼‚æ­¥é€šçŸ¥ç»™BizReqHandleå¯¹è±¡ï¼›</li>\n<li>BizReqHandleè°ƒç”¨ä¼ è¾“å±‚çš„Channelå¯¹è±¡ï¼Œå‘é€å“åº”ç»“æœï¼›</li>\n<li>ä¼ è¾“å±‚å¯¹å“åº”æ¶ˆæ¯è¿›è¡Œåè®®è½¬æ¢ã€åºåˆ—åŒ–ã€ç¼–ç ï¼Œæœ€åé€šè¿‡ç½‘ç»œä¼ è¾“å“åº”ç»™è°ƒç”¨ç«¯ã€‚</li>\n</ol><h2>æ€»ç»“</h2><p>ä»Šå¤©æˆ‘ä»¬å‰–æäº†ä¸€æ¬¾å¼€æºçš„RPCæ¡†æ¶çš„ä»£ç ï¼Œä¸»è¦é€šè¿‡<strong>æœåŠ¡ç«¯å¯åŠ¨æµç¨‹ã€è°ƒç”¨ç«¯å¯åŠ¨æµç¨‹ã€RPCè°ƒç”¨æµç¨‹</strong>è¿™ä¸‰å¤§æµç¨‹æ¥å°†RPCæ¡†æ¶çš„æ ¸å¿ƒæ¨¡å—ä»¥åŠæ ¸å¿ƒç±»ä¸²è”èµ·æ¥ã€‚</p><p>åœ¨æœåŠ¡ç«¯çš„å¯åŠ¨æµç¨‹ä¸­ï¼Œæ ¸å¿ƒå·¥ä½œå°±æ˜¯åˆ›å»ºå’Œå¼€å¯Exporterå¯¹è±¡ã€‚ProviderConfigåœ¨åˆ›å»ºExporterå¯¹è±¡ä¹‹å‰ä¼šå…ˆåˆ›å»ºRegistryå¯¹è±¡ï¼Œä»æ³¨å†Œä¸­å¿ƒä¸­è®¢é˜…æ¥å£é…ç½®ä¸å…¨å±€é…ç½®ï¼Œä¹‹åæ‰ä¼šåˆ›å»ºExporterå¯¹è±¡ï¼Œåœ¨Exporterå¼€å¯æ—¶ï¼Œä¼šå¯åŠ¨ä¸€ä¸ªServerå¯¹è±¡æ¥å¼€å¯ä¸€ä¸ªç«¯å£ï¼ŒExporterå¼€å¯æˆåŠŸä¹‹åï¼Œæ‰ä¼šé€šè¿‡Registryå¯¹è±¡å‘æ³¨å†Œä¸­å¿ƒå‘èµ·æ³¨å†Œã€‚</p><p>åœ¨è°ƒç”¨ç«¯çš„å¯åŠ¨æµç¨‹ä¸­ï¼Œæ ¸å¿ƒå·¥ä½œå°±æ˜¯åˆ›å»ºå’Œå¼€å¯Referå¯¹è±¡ï¼Œå¼€å¯Referå¯¹è±¡ä¸­å¤„ç†é€»è¾‘æœ€ä¸ºå¤æ‚çš„å°±æ˜¯å¯¹Clusterçš„openæ“ä½œï¼ŒClusterè´Ÿè´£äº†è°ƒç”¨ç«¯çš„é›†ç¾¤ç®¡ç†æ“ä½œï¼Œå…¶ä¸­æœ‰æ³¨å†Œä¸­å¿ƒæœåŠ¡èŠ‚ç‚¹å˜æ›´äº‹ä»¶çš„ç›‘å¬ã€ä¸æœåŠ¡ç«¯èŠ‚ç‚¹å»ºç«‹è¿æ¥ä»¥åŠæœåŠ¡ç«¯èŠ‚ç‚¹è¿æ¥çŠ¶æ€çš„ç®¡ç†ç­‰ç­‰ã€‚</p><p>è°ƒç”¨ç«¯å‘æœåŠ¡ç«¯å‘èµ·è°ƒç”¨æ—¶ï¼Œä¼šå…ˆç»è¿‡åŠ¨æ€ä»£ç†ï¼Œä¹‹åä¼šè°ƒç”¨Referå¯¹è±¡çš„invokeæ–¹æ³•ï¼ŒReferå¯¹è±¡ä¼šå…ˆå¯¹è¦é€ä¼ çš„æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œå†æ‰§è¡ŒFilteré“¾ï¼Œè°ƒç”¨ç«¯æœ€åä¸€ä¸ªFilterä¼šæ ¹æ®é…ç½®çš„è·¯ç”±è§„åˆ™é€‰æ‹©å‡ºç¬¦åˆæ¡ä»¶çš„ä¸€ç»„æœåŠ¡ç«¯èŠ‚ç‚¹ï¼Œä¹‹åè°ƒç”¨Routeå¯¹è±¡çš„routeæ–¹æ³•ï¼Œrouteæ–¹æ³•çš„å†…éƒ¨é€»è¾‘ä¼šæ ¹æ®é…ç½®çš„è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰æ‹©ä¸€ä¸ªæœåŠ¡ç«¯èŠ‚ç‚¹ï¼Œæœ€åå‘è¿™ä¸ªæœåŠ¡ç«¯èŠ‚ç‚¹å‘é€è¯·æ±‚æ¶ˆæ¯ã€‚</p><p>æœåŠ¡ç«¯çš„ä¼ è¾“å±‚æ”¶åˆ°è°ƒç”¨ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚æ¶ˆæ¯ï¼Œåœ¨å¯¹è¯·æ±‚æ¶ˆæ¯è¿›è¡Œä¸€ç³»åˆ—å¤„ç†ä¹‹åï¼ˆå¦‚è§£ç ã€ååºåˆ—åŒ–ã€åè®®è½¬æ¢ç­‰ç­‰ï¼‰ï¼Œä¼šåœ¨ä¸šåŠ¡çº¿ç¨‹æ± ä¸­å¤„ç†æ¶ˆæ¯ï¼Œå…³é”®çš„é€»è¾‘å°±æ˜¯è°ƒç”¨Exporterå¯¹è±¡çš„invokeæ–¹æ³•ï¼ŒExporterå¯¹è±¡çš„invokeæ–¹æ³•ä¼šæ‰§è¡ŒæœåŠ¡ç«¯é…ç½®çš„Filteré“¾ï¼Œæœ€ç»ˆé€šè¿‡åå°„æˆ–é¢„ç¼–è¯‘å¯¹è±¡æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œå†å°†æœ€ç»ˆç»“æœå°è£…æˆå“åº”æ¶ˆæ¯ï¼Œé€šè¿‡ä¼ è¾“å±‚å“åº”ç»™è°ƒç”¨ç«¯ã€‚</p><p>æœ¬è®²åœ¨è°ƒç”¨ç«¯å‘æœåŠ¡ç«¯å‘èµ·è°ƒç”¨æ—¶ï¼Œæ²¡æœ‰è®²åˆ°å¼‚æ­¥è°ƒç”¨ï¼Œå®é™…ä¸ŠReferå¯¹è±¡çš„invokeæ–¹æ³•çš„å®ç°é€»è¾‘å®Œå…¨æ˜¯å¼‚æ­¥çš„ï¼ŒåŒæ ·Exporterå¯¹è±¡çš„invokeæ–¹æ³•ä¹Ÿæ˜¯å¼‚æ­¥çš„ï¼ŒReferç±»ä¸Exporterç±»éƒ½æ˜¯è°ƒç”¨ç«¯Invokeræ¥å£çš„å®ç°ç±»ï¼Œå¯ä»¥çœ‹ä¸‹Invokeræ¥å£ä¸­invokeæ–¹æ³•çš„å®šä¹‰:</p><pre><code> /**\n  * è°ƒç”¨\n  *\n  * @param request è¯·æ±‚\n  * @return\n  */\n\n CompletableFuture&lt;Result&gt; invoke(RequestMessage&lt;Invocation&gt; request);\n</code></pre><p>JoyRPCæ¡†æ¶æ˜¯ä¸€ä¸ªçº¯å¼‚æ­¥çš„RPCæ¡†æ¶ï¼Œæ‰€è°“çš„åŒæ­¥åªä¸è¿‡æ˜¯å¯¹å¼‚æ­¥è¿›è¡Œäº†ç­‰å¾…ã€‚</p><p>å…¥å£å±‚çš„æ ¸å¿ƒå¯¹è±¡å°±æ˜¯Exporterå¯¹è±¡ä¸Referå¯¹è±¡ï¼Œè¿™ä¸¤ä¸ªç±»æ‰¿æ‹…äº†å…¥å£å±‚çš„å¤§å¤šæ•°æ ¸å¿ƒé€»è¾‘ã€‚</p><p>é›†ç¾¤å±‚çš„æ ¸å¿ƒå¯¹è±¡å°±æ˜¯Clusterå¯¹è±¡ä¸Registryå¯¹è±¡ï¼ŒCluserå¯¹è±¡çš„å†…éƒ¨é€»è¾‘è¿˜æ˜¯éå¸¸å¤æ‚çš„ï¼Œæ ¸å¿ƒé€»è¾‘å°±æ˜¯ä¸Registryäº¤äº’ï¼Œè®¢é˜…æœåŠ¡ç«¯èŠ‚ç‚¹å˜æ›´äº‹ä»¶ï¼Œä»¥åŠå¯¹ä¸æœåŠ¡ç«¯èŠ‚ç‚¹å»ºç«‹çš„è¿æ¥çš„ç®¡ç†ï¼Œè¿™é‡Œæˆ‘ä»¬å¯¹Cluserå¯¹è±¡æ²¡æœ‰è¿›è¡Œè¿‡å¤šä»‹ç»ï¼Œä½ å¯ä»¥å»æŸ¥çœ‹ä»£ç ã€‚</p><p>åè®®å±‚çš„æ ¸å¿ƒå¯¹è±¡å°±æ˜¯Protocolæ¥å£çš„å„ä¸ªå­ç±»äº†ã€‚</p><p>æ¥ä¸‹æ¥å°±æ˜¯ä¼ è¾“å±‚äº†ï¼Œä¼ è¾“å±‚çš„å…·ä½“å®ç°æˆ‘ä»¬åœ¨æœ¬è®²ä¹Ÿæ²¡æœ‰è¿‡å¤šä»‹ç»ï¼Œå› ä¸ºå¾ˆéš¾é€šè¿‡æœ‰é™çš„å†…å®¹æŠŠå®ƒè®²è§£å®Œæ•´ï¼Œè¿˜æ˜¯å»ºè®®ä½ å»æŸ¥çœ‹ä¸‹æºç ï¼Œä¸€ç›®äº†ç„¶ã€‚ä¼ è¾“å±‚æ˜¯çº¯å¼‚æ­¥çš„å¹¶ä¸”æ˜¯å®Œå…¨æ’ä»¶åŒ–çš„ï¼Œå…¶å…¥å£å°±æ˜¯EndpointFactroyæ’ä»¶ï¼Œé€šè¿‡EndpointFactroyæ’ä»¶è·å–ä¸€ä¸ªEndpointFactroyå¯¹è±¡ï¼ŒEndpointFactroyå¯¹è±¡æ˜¯ä¸€ä¸ªå·¥å‚ç±»ï¼Œç”¨æ¥åˆ›å»ºClientå¯¹è±¡ä¸Serverå¯¹è±¡ã€‚</p><p>å¯¹äºä¸€ä¸ªå®Œå–„çš„RPCæ¡†æ¶ï¼Œä»Šå¤©æˆ‘ä»¬ä»…æ˜¯é’ˆå¯¹æœåŠ¡ç«¯å¯åŠ¨æµç¨‹ã€è°ƒç”¨ç«¯å¯åŠ¨æµç¨‹ã€RPCè°ƒç”¨æµç¨‹è¿™ä¸‰ä¸ªä¸»æµç¨‹åšäº†ä¸€ä¸ªå¤§è‡´çš„è®²è§£ï¼ŒçœŸæ­£å®ç°èµ·æ¥è¿˜æ˜¯è¦å¤æ‚è®¸å¤šï¼Œå› ä¸ºæ¶‰åŠåˆ°äº†å¾ˆå¤šç»†èŠ‚ä¸Šçš„é—®é¢˜ï¼Œä½†ä¸»è¦è„‰ç»œå‡ºæ¥ä»¥åï¼Œç›¸ä¿¡ä¹Ÿä¼šå¯¹ä½ æœ‰å¾ˆå¤§å¸®åŠ©ï¼Œæ›´å¤šçš„ç»†èŠ‚å°±è¿˜æ˜¯è¦é ä½ è‡ªå·±å»é˜…è¯»æºç å•¦ï¼</p><p>ä»Šå¤©çš„åŠ é¤åˆ†äº«å°±åˆ°è¿™é‡Œï¼Œæœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºä¸æˆ‘äº¤æµï¼</p>","neighbors":{"left":{"article_title":"åŠ é¤ | è°ˆè°ˆæˆ‘æ‰€ç»å†è¿‡çš„RPC","id":225573},"right":[]},"comments":[{"had_liked":false,"id":214173,"user_name":"æœ‰ç±³","can_delete":false,"product_type":"c1","uid":1005042,"ip_address":"","ucode":"C9A10B7A67BC12","user_header":"https://static001.geekbang.org/account/avatar/00/0f/55/f2/ba68d931.jpg","comment_is_top":false,"comment_ctime":1588670610,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"48833310866","product_id":100046201,"comment_content":" å¥½æ—©ä»¥å‰å°±è´­ä¹°è¯¾ç¨‹äº†ï¼Œä½†å½“æ—¶æ²¡æœ‰æ›´å®Œã€‚æ‰€ä»¥å°±æ²¡è¿½ï¼Œå…¶å®æˆ‘çš„å­¦ä¹ æ–¹å¼è·Ÿè¿½å‰§æ˜¯ä¸€æ ·çš„ã€‚æ›´å®Œååœ¨ä¸€æ®µæ—¶é—´å†…çœ‹å®Œï¼Œæ€è·¯ä¼šæ¯”è¾ƒå®Œæ•´ã€‚åˆ©ç”¨äº”ä¸€å‡æœŸæŠŠæ•´ä¸ªè¯¾ç¨‹çœ‹å®Œäº†ï¼Œé‡æ–°ç†è§£äº†rpcæ¡†æ¶å„ä¸ªç»„ä»¶çš„è®¾è®¡åŸç†ï¼Œæ”¶è·å¾ˆå¤§ã€‚åç»­æ ¹æ®è¿™äº›åŸç†å†å»çœ‹ä¸€édubboçš„æºç ï¼Œä¼šæœ‰æ›´æ·±çš„è®¤è¯†ã€‚æ„Ÿè°¢è€å¸ˆğŸ‘¨â€ğŸ«","like_count":12},{"had_liked":false,"id":213910,"user_name":"æ¯å¤©æ™’ç™½ç‰™","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1588588681,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23063425161","product_id":100046201,"comment_content":"æ„Ÿè°¢è€å¸ˆçš„åŠ é¤ï¼ŒæŠŠä¸“æ çš„å†…å®¹æ ¹æ®é¡¹ç›®ç»“åˆèµ·æ¥ï¼Œä¸€èµ·çœ‹ï¼Œæ”¶è·è‚¯å®šä¼šæ›´å¤§","like_count":5},{"had_liked":false,"id":217995,"user_name":"é’±","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1589688769,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14474590657","product_id":100046201,"comment_content":"å–œæ¬¢è¿™ä¸ªåŠ é¤ï¼ŒJSFä¹Ÿç»ˆäºå¼€æºäº†ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯è¿˜æ˜¯ç†Ÿæ‚‰äº†å‘³é“ğŸ˜„","like_count":4,"discussions":[{"author":{"id":1155463,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a1/87/259ab5a3.jpg","nickname":"æ¡‚å† è¿œèˆª","note":"","ucode":"5959E1A1DAA05D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":273332,"discussion_content":"å•¥æ—¶å€™å¼€æºçš„ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590449093,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":213784,"user_name":"å¥½è¿æ¥","can_delete":false,"product_type":"c1","uid":1113937,"ip_address":"","ucode":"F469ED6CEFEF30","user_header":"https://static001.geekbang.org/account/avatar/00/10/ff/51/9d5cfadd.jpg","comment_is_top":false,"comment_ctime":1588560802,"is_pvip":true,"replies":[{"id":"80435","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ä½•å°é”‹","uid":"1541007","ctime":1589499987,"ip_address":"","comment_id":213784,"utype":1}],"discussion_count":1,"race_medal":1,"score":"14473462690","product_id":100046201,"comment_content":"å¤ªå¹²è´§äº†ï¼Œå‡†å¤‡ä»¥é¡¹ç›®ä¸ºä¸­å¿ƒï¼Œé‡æ–°è¿‡ä¸€éå‰é¢çš„æ–‡ç« ã€‚","like_count":4,"discussions":[{"author":{"id":1541007,"avatar":"https://static001.geekbang.org/account/avatar/00/17/83/8f/8471d633.jpg","nickname":"ä½•å°é”‹","note":"","ucode":"E9B3B4A1B75D8B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493871,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589499987,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":213882,"user_name":"å±±é¡¶çš„æ´","can_delete":false,"product_type":"c1","uid":1246664,"ip_address":"","ucode":"D3E9E928A3FA62","user_header":"https://static001.geekbang.org/account/avatar/00/13/05/c8/2f849dfb.jpg","comment_is_top":false,"comment_ctime":1588583759,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10178518351","product_id":100046201,"comment_content":"å‡æœŸä¹Ÿå‡ºè´§ï¼Œèµ","like_count":2},{"had_liked":false,"id":262633,"user_name":"Geek_09d497","can_delete":false,"product_type":"c1","uid":2309573,"ip_address":"","ucode":"DF68A83396972E","user_header":"","comment_is_top":false,"comment_ctime":1605787902,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5900755198","product_id":100046201,"comment_content":"èŠ±äº†5ä¸ªå°æ—¶ï¼Œç»ˆäºçœ‹å®Œäº†ã€‚å¯¹rpcå’Œå¾®æœåŠ¡æœ‰äº†ä¸€ä¸ªå®è§‚çš„è®¤è¯†ï¼Œåé¢çš„è·¯å°±æ˜¯çœ‹å…·ä½“çš„æºç äº†ã€‚","like_count":2},{"had_liked":false,"id":321030,"user_name":"èµµå­˜é‡‘","can_delete":false,"product_type":"c1","uid":1118952,"ip_address":"","ucode":"89D69F8D2DF269","user_header":"https://static001.geekbang.org/account/avatar/00/11/12/e8/aa60f7f1.jpg","comment_is_top":false,"comment_ctime":1636625216,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636625216","product_id":100046201,"comment_content":"å¹²è´§æ»¡æ»¡ã€‚","like_count":0},{"had_liked":false,"id":277094,"user_name":"æƒ˜ é—»","can_delete":false,"product_type":"c1","uid":1181650,"ip_address":"","ucode":"C5909F034BF072","user_header":"https://static001.geekbang.org/account/avatar/00/12/07/d2/0d7ee298.jpg","comment_is_top":false,"comment_ctime":1612258096,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612258096","product_id":100046201,"comment_content":"æ„Ÿè°¢è€å¸ˆçš„åŠ é¤","like_count":0},{"had_liked":false,"id":214664,"user_name":"HIYO","can_delete":false,"product_type":"c1","uid":1016672,"ip_address":"","ucode":"357E923E8E300E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/83/60/4888d3dc.jpg","comment_is_top":false,"comment_ctime":1588777750,"is_pvip":false,"replies":[{"id":"80438","content":"æ‰©å¼ æ€§å’Œååé‡","user_name":"ä½œè€…å›å¤","user_name_real":"ä½•å°é”‹","uid":"1541007","ctime":1589500187,"ip_address":"","comment_id":214664,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1588777750","product_id":100046201,"comment_content":"èµï¼ŒæœŸå¾…ç»“åˆJoyRPCè®²è§£å¯¹ä¹‹å‰æŠ€æœ¯ç‚¹æŠ€æœ¯é€‰å‹çš„æ€è€ƒï¼Œæ¯”å¦‚è¯´å’±ä»¬çš„æµé‡éš”ç¦»å®ç°æ–¹å¼æ˜¯ä»€ä¹ˆï¼Œåˆ†ç»„ä¸ç»Ÿä¸€å…¥å£æ˜¯å¦‚ä½•å¹³è¡¡çš„ï¼Ÿæˆ‘äº†è§£åˆ°nettyæœ‰è¿‡å›é€€ç‰ˆæœ¬çš„è¿‡ç¨‹ï¼Œæ˜¯å› ä¸ºAIOåœ¨æ€§èƒ½ä¸Šå¹¶æ²¡æœ‰æ¯”NIOæœ‰æ˜æ˜¾çš„æé«˜ï¼Œè¿˜å¯¼è‡´ä»£ç è¿‡äºå¤æ‚ã€‚é‚£å’±ä»¬é€‰æ‹©çº¯å¼‚æ­¥å’Œçº¯æ’ä»¶åŒ–åˆæ˜¯åŸºäºä»€ä¹ˆæ ·çš„è€ƒè™‘å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1541007,"avatar":"https://static001.geekbang.org/account/avatar/00/17/83/8f/8471d633.jpg","nickname":"ä½•å°é”‹","note":"","ucode":"E9B3B4A1B75D8B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494160,"discussion_content":"æ‰©å¼ æ€§å’Œååé‡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589500187,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}