{"id":108907,"title":"17丨如何使用Python操作MySQL？","content":"<p>我们之前都是直接在DBMS里面进行SQL的操作，实际上我们还可以通过后端语言对DBMS进行访问以及进行相应的操作，这样更具有灵活性，可以实现一些较为复杂的操作。作为一个后端开发人员，掌握一些SQL技术是必须的；作为一个数据库管理人员，了解后端语言如何开发和管理数据库也是很有必要的。</p><p>今天我以Python为例，讲解下如何对MySQL数据库进行操作。你需要掌握以下几个方面的内容：</p><ol>\n<li>Python的DB API规范是什么，遵守这个规范有什么用？</li>\n<li>基于DB API，MySQL官方提供了驱动器mysql-connector，如何使用它来完成对数据库管理系统的操作？</li>\n<li>CRUD是最常见的数据库的操作，分别对应数据的增加、读取、修改和删除。在掌握了mysql-connector的使用方法之后，如何完成对数据表的CRUD操作？</li>\n</ol><h2>Python DB API规范</h2><p>Python可以支持非常多的数据库管理系统，比如MySQL、Oracle、SQL Server和PostgreSQL等。为了实现对这些DBMS的统一访问，Python需要遵守一个规范，这就是DB API规范。我在下图中列出了DB API规范的作用，这个规范给我们提供了数据库对象连接、对象交互和异常处理的方式，为各种DBMS提供了统一的访问接口。这样做的好处就是如果项目需要切换数据库，Python层的代码移植会比较简单。</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/5d/7f/5d8113fc1637d1fe951e985b22e0287f.png?wh=1729*839\" alt=\"\"><br>\n我们在使用Python对DBMS进行操作的时候，需要经过下面的几个步骤：</p><ol>\n<li>引入API模块；</li>\n<li>与数据库建立连接；</li>\n<li>执行SQL语句；</li>\n<li>关闭数据库连接。</li>\n</ol><h2>如何使用mysql-connector</h2><p>使用Python对数据库进行访问需要基于DB API规范，这里有不少库供我们选择，比如MySQLdb、mysqlclient、PyMySQL、peewee和SQLAIchemy等。今天我讲解的是mysql-connector，它是MySQL 官方提供的驱动器，用来给后端语言，比如Python提供连接。</p><p>下面我们看下如何用Python使用mysql-connector，以完成数据库的连接和使用。</p><p>首先安装mysql-connector。在使用前，你需要先使用下面这句命令进行安装：</p><pre><code>pip install mysql-connector\n</code></pre><p>在安装之后，你可以创建数据库连接，然后查看下数据库的版本号，来验证下数据库是否连接成功。代码如下：</p><pre><code># -*- coding: UTF-8 -*-\nimport mysql.connector\n# 打开数据库连接\ndb = mysql.connector.connect(\n       host=&quot;localhost&quot;,\n       user=&quot;root&quot;,\n       passwd=&quot;XXX&quot;, # 写上你的数据库密码\n       database='wucai', \n       auth_plugin='mysql_native_password'\n)\n# 获取操作游标 \ncursor = db.cursor()\n# 执行SQL语句\ncursor.execute(&quot;SELECT VERSION()&quot;)\n# 获取一条数据\ndata = cursor.fetchone()\nprint(&quot;MySQL版本: %s &quot; % data)\n# 关闭游标&amp;数据库连接\ncursor.close()\ndb.close()\n</code></pre><p>运行结果：</p><pre><code>MySQL版本: 8.0.13 \n</code></pre><p>上面这段代码中有两个重要的对象你需要了解下，分别是Connection和Cursor。</p><p>Connection就是对数据库的当前连接进行管理，我们可以通过它来进行以下操作：</p><ol>\n<li>通过指定host、user、passwd和port等参数来创建数据库连接，这些参数分别对应着数据库IP地址、用户名、密码和端口号；</li>\n<li>使用db.close()关闭数据库连接；</li>\n<li>使用db.cursor()创建游标，操作数据库中的数据；</li>\n<li>使用db.begin()开启事务；</li>\n<li>使用db.commit()和db.rollback()，对事务进行提交以及回滚。</li>\n</ol><p>当我们通过<code>cursor = db.cursor()</code>创建游标后，就可以通过面向过程的编程方式对数据库中的数据进行操作：</p><ol>\n<li>使用<code>cursor.execute(query_sql)</code>，执行数据库查询；</li>\n<li>使用<code>cursor.fetchone()</code>，读取数据集中的一条数据；</li>\n<li>使用<code>cursor.fetchall()</code>，取出数据集中的所有行，返回一个元组tuples类型；</li>\n<li>使用<code>cursor.fetchmany(n)</code>，取出数据集中的多条数据，同样返回一个元组tuples；</li>\n<li>使用<code>cursor.rowcount</code>，返回查询结果集中的行数。如果没有查询到数据或者还没有查询，则结果为-1，否则会返回查询得到的数据行数；</li>\n<li>使用<code>cursor.close()</code>，关闭游标。</li>\n</ol><h2>对数据表进行增删改查</h2><p>了解了Connection和Cursor的使用方式之后，我们来看下如何来对heros数据表进行CRUD的操作，即增加、读取、更新和删除。</p><p>首先是增加数据。</p><p>假设我们想在player表中增加一名新球员，姓名为“约翰·科林斯”，球队ID为1003（即亚特兰大老鹰），身高为2.08m。代码如下：</p><pre><code># 插入新球员\nsql = &quot;INSERT INTO player (team_id, player_name, height) VALUES (%s, %s, %s)&quot;\nval = (1003, &quot;约翰-科林斯&quot;, 2.08)\ncursor.execute(sql, val)\ndb.commit()\nprint(cursor.rowcount, &quot;记录插入成功。&quot;)\n</code></pre><p>我们使用cursor.execute来执行相应的SQL语句，val为SQL语句中的参数，SQL执行后使用db.commit()进行提交。需要说明的是，我们在使用SQL语句的时候，可以向SQL语句传递参数，这时SQL语句里要统一用（%s）进行占位，否则就会报错。不论插入的数值为整数类型，还是浮点类型，都需要统一用（%s）进行占位。</p><p>另外在用游标进行SQL操作之后，还需要使用db.commit()进行提交，否则数据不会被插入。</p><p>然后是读取数据。我们来看下数据是否被插入成功，这里我们查询下身高大于等于2.08m的球员都有哪些，代码如下：</p><pre><code># 查询身高大于等于2.08的球员\nsql = 'SELECT player_id, player_name, height FROM player WHERE height&gt;=2.08'\ncursor.execute(sql)\ndata = cursor.fetchall()\nfor each_player in data:\n  print(each_player)\n</code></pre><p>运行结果：</p><pre><code>(10003, '安德烈-德拉蒙德', 2.11)\n(10004, '索恩-马克', 2.16)\n(10009, '扎扎-帕楚里亚', 2.11)\n(10010, '乔恩-洛伊尔', 2.08)\n(10011, '布雷克-格里芬', 2.08)\n(10015, '亨利-埃伦森', 2.11)\n(10023, '多曼塔斯-萨博尼斯', 2.11)\n(10024, '迈尔斯-特纳', 2.11)\n(10032, 'TJ-利夫', 2.08)\n(10033, '凯尔-奥奎因', 2.08)\n(10037, '伊凯·阿尼博古', 2.08)\n(10038, '约翰-科林斯', 2.08)\n</code></pre><p>你能看到球员约翰·科林斯被正确插入。</p><p>那么如何修改数据呢？</p><p>假如我想修改刚才插入的球员约翰·科林斯的身高，将身高修改成2.09，代码如下：</p><pre><code># 修改球员约翰-科林斯\nsql = 'UPDATE player SET height = %s WHERE player_name = %s'\nval = (2.09, &quot;约翰-科林斯&quot;)\ncursor.execute(sql, val)\ndb.commit()\nprint(cursor.rowcount, &quot;记录被修改。&quot;)\n</code></pre><p>最后我们看下如何删除约翰·科林斯这个球员的数据，代码如下：</p><pre><code>sql = 'DELETE FROM player WHERE player_name = %s'\nval = (&quot;约翰-科林斯&quot;,)\ncursor.execute(sql, val)\ndb.commit()\nprint(cursor.rowcount, &quot;记录删除成功。&quot;)\n</code></pre><p>最后都执行完了，我们来关闭游标和数据库的连接，使用以下代码即可：</p><pre><code>cursor.close()\ndb.close()\n</code></pre><p>针对上面的操作过程，你可以模拟下数据的CRUD操作，但有几点你需要注意。</p><p>1.打开数据库连接以后，如果不再使用，则需要关闭数据库连接，以免造成资源浪费。<br>\n2.在对数据进行增加、删除和修改的时候，可能会出现异常，这时就需要用<code>try...except</code>捕获异常信息。比如针对插入球员约翰·科林斯这个操作，你可以写成下面这样：</p><pre><code>import traceback\ntry:\n  sql = &quot;INSERT INTO player (team_id, player_name, height) VALUES (%s, %s, %s)&quot;\n  val = (1003, &quot;约翰-科林斯&quot;, 2.08)\n  cursor.execute(sql, val)\n  db.commit()\n  print(cursor.rowcount, &quot;记录插入成功。&quot;)\nexcept Exception as e:\n  # 打印异常信息\n  traceback.print_exc()\n  # 回滚  \n  db.rollback()\nfinally:\n  # 关闭数据库连接\n  db.close()\n</code></pre><p>运行结果告诉我们记录插入成功。</p><p>3.如果你在使用mysql-connector连接的时候，系统报的错误为<code>authentication plugin caching_sha2</code>，这时你需要下载最新的版本更新来解决，点击<a href=\"https://dev.mysql.com/downloads/connector/python/\">这里</a>进行更新。</p><h2>总结</h2><p>我今天讲解了如何使用Python来操作MySQL，这里我们使用的是官方提供的mysql-connector，当然除了它之外，还有很多库可以进行选择。</p><p>在使用基于DB API规范的协议时，重点需要掌握Connection和Cursor这两个对象，Connection就是对数据库的连接进行管理，而Cursor是对数据库的游标进行管理，通过它们，我们可以执行具体的SQL语句，以及处理复杂的数据。</p><p>用Python操作MySQL，还有很多种姿势，mysql-connector只是其中一种，实际上还有另外一种方式，就是采用ORM框架。ORM的英文是Object Relational Mapping，也就是采用对象关系映射的模式，使用这种模式可以将数据库中各种数据表之间的关系映射到程序中的对象。这种模式可以屏蔽底层的数据库的细节，不需要我们与复杂的SQL语句打交道，直接采用操作对象的形式操作就可以。</p><p>不过如果应用数据实体少，其实没有必要使用ORM框架，针对少量对象的管理，自己实现起来也很简单，比如本篇文章中我讲到的采用官方提供的mysql-connector驱动的方式来实现CRUD。引入一个框架的学习成本很高，代码膨胀也很厉害，所以如果是相对简单的操作，完全可以自己动手来实现。</p><p><img src=\"https://static001.geekbang.org/resource/image/96/d2/96cf0463992b9843ba02bb7f65cb4ed2.jpg?wh=3341*1512\" alt=\"\"><br>\n使用Python对数据库进行操作，关键在于实战，所以这里我出一个练习题。请你使用Python对heros表中最大生命值大于6000的英雄进行查询，并且输出相应的属性值。</p><p>欢迎在评论区写下你的答案，我会与你一起交流。也欢迎把这篇文章分享给你的朋友或者同事，与它们一起交流一下。</p>","neighbors":{"left":{"article_title":"16丨游标：当我们需要逐条处理数据时，该怎么做？","id":108342},"right":{"article_title":"18丨SQLAlchemy：如何使用Python ORM框架来操作MySQL？","id":109227}},"comments":[{"had_liked":false,"id":115387,"user_name":"JustDoDT","can_delete":false,"product_type":"c1","uid":1127175,"ip_address":"","ucode":"6AF0B80F00EAEF","user_header":"https://static001.geekbang.org/account/avatar/00/11/33/07/8f351609.jpg","comment_is_top":false,"comment_ctime":1563550708,"is_pvip":false,"replies":[{"id":"63668","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577527802,"ip_address":"","comment_id":115387,"utype":1}],"discussion_count":3,"race_medal":0,"score":"177657209844","product_id":100029501,"comment_content":"import json<br>import traceback<br>import mysql.connector<br><br># 读取数据库链接配置文件<br>with open(&#39;mysql.json&#39;, encoding=&#39;utf-8&#39;) as con_json:<br>    con_dict = json.load(con_json)<br><br># 打开数据库链接<br>db = mysql.connector.connect(<br>    host=con_dict[&#39;host&#39;],<br>    user=con_dict[&#39;user&#39;],<br>    passwd=con_dict[&#39;passwd&#39;],<br>    database=con_dict[&#39;database&#39;],<br>    auth_plugin=con_dict[&#39;auth_plugin&#39;],<br>)<br><br># 获取操作游标<br>cursor = db.cursor()<br>try:<br>    sql = &#39;SELECT id, name, hp_max FROM heros WHERE hp_max&gt;6000&#39;<br>    cursor.execute(sql)<br>    data = cursor.fetchall()<br>    print(cursor.rowcount, &#39;查询成功。&#39;)<br>    for each_hero in data:<br>        print(each_hero)<br>except Exception as e:<br>    # 打印异常信息<br>    traceback.print_exc()<br>finally:<br>    cursor.close()<br>    db.close()<br># 建议吧数据库链接信息写到配置文件里，防止密码泄露。","like_count":41,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459083,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577527802,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1854657,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKVIjh4T1akib5iav5IIGjXB9x98p9Y80STRcwpMDqxfGLrMvHamxlxEqLMTpiayWFWSNpBcbGwkRjRw/132","nickname":"马吉辉","note":"","ucode":"4265EFBD2BB7BD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":200239,"discussion_content":"同学，可以发一下，mysql.json 这个文件的格式是什么样子的吗，谢谢\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1583671505,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1077127,"avatar":"https://static001.geekbang.org/account/avatar/00/10/6f/87/669263b4.jpg","nickname":"陈金鑫","note":"","ucode":"609A24832CA80C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1854657,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKVIjh4T1akib5iav5IIGjXB9x98p9Y80STRcwpMDqxfGLrMvHamxlxEqLMTpiayWFWSNpBcbGwkRjRw/132","nickname":"马吉辉","note":"","ucode":"4265EFBD2BB7BD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":210808,"discussion_content":"{\n  &#34;host&#34;:&#34;xxx&#34;,\n  &#34;user&#34;:&#34;xxx&#34;,\n  &#34;passwd&#34;:&#34;xxx&#34;,\n  &#34;database&#34;:&#34;xxx&#34;,\n  &#34;auth_plugin&#34;:&#34;mysql_native_password&#34;\n}","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1584777405,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":200239,"ip_address":""},"score":210808,"extra":""}]}]},{"had_liked":false,"id":115239,"user_name":"一叶知秋","can_delete":false,"product_type":"c1","uid":1445189,"ip_address":"","ucode":"15A95FA86B7AE4","user_header":"https://static001.geekbang.org/account/avatar/00/16/0d/45/b88a1794.jpg","comment_is_top":false,"comment_ctime":1563516515,"is_pvip":false,"replies":[{"id":"63675","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577527923,"ip_address":"","comment_id":115239,"utype":1}],"discussion_count":1,"race_medal":0,"score":"35923254883","product_id":100029501,"comment_content":"sqlalchemy用习惯了。。。献丑来一段Python代码吧<br>```Python<br># -*- coding:utf-8 -*-<br>from sqlalchemy import and_<br>from sqlalchemy import Column, INT, FLOAT, VARCHAR<br>from sqlalchemy import create_engine<br>from sqlalchemy.orm import sessionmaker<br>from sqlalchemy.ext.declarative import declarative_base<br>Base = declarative_base()<br><br><br>class Test_db:<br>    def __init__(self):<br>        &quot;&quot;&quot;此处填上自己的连接配置&quot;&quot;&quot;<br>        self.engine = create_engine(<br>            &#39;mysql+pymysql:&#47;&#47;username:password@host:port&#47;db_name?charset=utf8&#39;)<br>        db_session = sessionmaker(bind=self.engine)<br>        self.session = db_session()<br><br>    def query_all(self, target_class, query_filter):<br>        result_list = self.session.query(target_class).filter(query_filter).all()<br>        self.session.close()<br>        return result_list<br><br><br>class Heros(Base):<br>    &quot;&quot;&quot;定义表结构&quot;&quot;&quot;<br>    __tablename__ = &#39;heros&#39;<br>    id = Column(INT(), primary_key=True)<br>    name = Column(VARCHAR(255))<br>    hp_max = Column(FLOAT())<br>    mp_max = Column(FLOAT())<br><br>    def __init__(self, id, name, hp_max, mp_max):<br>        self.id = id<br>        self.name = name<br>        self.hp_max = hp_max<br>        self.mp_max = mp_max<br><br><br>if __name__ == &#39;__main__&#39;:<br>    db_obj = Test_db()<br>    query_filter = and_(Heros.hp_max &gt; 6000)<br>    heros = db_obj.query_all(Heros, query_filter)<br>    for hero_info in heros:<br>        print(&quot;id:{}, name:{}, hp_max:{}, mp_max:{}&quot;.format(hero_info.id, hero_info.name,<br>                                                            hero_info.hp_max, hero_info.mp_max))<br>```<br>id:10000, name:夏侯惇, hp_max:7350.0, mp_max:1746.0<br>id:10046, name:钟馗, hp_max:6280.0, mp_max:1988.0<br>id:10048, name:鬼谷子, hp_max:7107.0, mp_max:1808.0<br>id:10051, name:赵云, hp_max:6732.0, mp_max:1760.0<br>id:10052, name:橘石京, hp_max:7000.0, mp_max:0.0<br>id:10055, name:杨戬, hp_max:7420.0, mp_max:1694.0<br>id:10056, name:达摩, hp_max:7140.0, mp_max:1694.0<br>id:10057, name:孙悟空, hp_max:6585.0, mp_max:1760.0<br>id:10058, name:刘备, hp_max:6900.0, mp_max:1742.0<br>.....执行结果有点多字数限制了<br>Process finished with exit code 0","like_count":8,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459022,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577527923,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115167,"user_name":"mickey","can_delete":false,"product_type":"c1","uid":1051663,"ip_address":"","ucode":"8B490C2DDE4010","user_header":"https://static001.geekbang.org/account/avatar/00/10/0c/0f/93d1c8eb.jpg","comment_is_top":false,"comment_ctime":1563502328,"is_pvip":false,"replies":[{"id":"63679","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577528027,"ip_address":"","comment_id":115167,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27333306104","product_id":100029501,"comment_content":"# -*- coding: UTF-8 -*-<br>import mysql.connector<br>import traceback<br><br># 打开数据库连接<br>db = mysql.connector.connect(<br>    host=&quot;localhost&quot;,<br>    user=&quot;root&quot;,<br>    passwd=&quot;123456&quot;,  # 写上你的数据库密码<br>    database=&#39;nba&#39;,<br>    auth_plugin=&#39;mysql_native_password&#39;<br>)<br><br># 获取操作游标<br>cursor = db.cursor()<br><br>try:<br><br>    # 查询heros 表中最大生命值大于 6000 的英雄进行查询，并且输出相应的属性值。<br>    sql = &#39;SELECT name, hp_max FROM heros WHERE hp_max &gt; %s ORDER BY hp_max DESC&#39;<br>    val = (6000,)<br>    cursor.execute(sql, val)<br>    data = cursor.fetchall()<br>    for each_player in data:<br>        print(each_player)<br>except Exception as e:<br>  # 打印异常信息<br>  traceback.print_exc()<br>  # 回滚<br>  db.rollback()<br>finally:<br>  # 关闭游标 &amp; 数据库连接<br>  cursor.close()<br>  db.close()<br><br>输出：<br><br>(&#39;廉颇&#39;, 9328.0)<br>(&#39;白起&#39;, 8638.0)<br>(&#39;程咬金&#39;, 8611.0)<br>(&#39;刘禅&#39;, 8581.0)<br>(&#39;牛魔&#39;, 8476.0)<br>(&#39;张飞&#39;, 8341.0)<br>(&#39;庄周&#39;, 8149.0)<br>(&#39;刘邦&#39;, 8073.0)<br>(&#39;项羽&#39;, 8057.0)<br>(&#39;亚瑟&#39;, 8050.0)<br>(&#39;东皇太一&#39;, 7669.0)<br>(&#39;典韦&#39;, 7516.0)<br>(&#39;曹操&#39;, 7473.0)<br>(&#39;杨戬&#39;, 7420.0)<br>(&#39;夏侯惇&#39;, 7350.0)<br>(&#39;吕布&#39;, 7344.0)<br>(&#39;哪吒&#39;, 7268.0)<br>(&#39;墨子&#39;, 7176.0)<br>(&#39;老夫子&#39;, 7155.0)<br>(&#39;达摩&#39;, 7140.0)<br>(&#39;鬼谷子&#39;, 7107.0)<br>(&#39;关羽&#39;, 7107.0)<br>(&#39;钟无艳&#39;, 7000.0)<br>(&#39;橘石京&#39;, 7000.0)<br>(&#39;刘备&#39;, 6900.0)<br>(&#39;太乙真人&#39;, 6835.0)<br>(&#39;孙膑&#39;, 6811.0)<br>(&#39;赵云&#39;, 6732.0)<br>(&#39;扁鹊&#39;, 6703.0)<br>(&#39;铠&#39;, 6700.0)<br>(&#39;露娜&#39;, 6612.0)<br>(&#39;孙悟空&#39;, 6585.0)<br>(&#39;钟馗&#39;, 6280.0)<br>(&#39;雅典娜&#39;, 6264.0)<br>(&#39;兰陵王&#39;, 6232.0)<br>(&#39;宫本武藏&#39;, 6210.0)<br>(&#39;娜可露露&#39;, 6205.0)<br>(&#39;高渐离&#39;, 6165.0)<br>(&#39;芈月&#39;, 6164.0)<br>(&#39;不知火舞&#39;, 6014.0)<br>(&#39;孙尚香&#39;, 6014.0)<br><br>Process finished with exit code 0","like_count":6,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458996,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577528027,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115172,"user_name":"夜路破晓","can_delete":false,"product_type":"c1","uid":1353577,"ip_address":"","ucode":"9B875F94B759B9","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/3hZfficKPGCq2kjFBu9SgaMjibJTEl7iaW1ta6pZNyiaWP8XEsNpunlnsiaOtBpWTXfT5BvRP3qNByml6p9rtBvqewg/132","comment_is_top":false,"comment_ctime":1563503300,"is_pvip":false,"replies":[{"id":"63678","content":"密码验证方式，采用明文","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577528020,"ip_address":"","comment_id":115172,"utype":1}],"discussion_count":2,"race_medal":0,"score":"23038339780","product_id":100029501,"comment_content":"auth_plugin=&#39;mysql_native_password&#39;<br>哪位亲给解释下这个参数","like_count":5,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459000,"discussion_content":"密码验证方式，采用明文","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577528020,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2640790,"avatar":"","nickname":"张静","note":"","ucode":"C3586FA4E0FD4A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377543,"discussion_content":"如果你的 MySQL 是 8.0 版本，密码插件验证方式发生了变化，早期版本为 mysql_native_password，8.0 版本为 caching_sha2_password\nhttps://www.runoob.com/note/45833","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1622704765,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":true,"id":116285,"user_name":"大斌","can_delete":false,"product_type":"c1","uid":1002183,"ip_address":"","ucode":"1434C2B0A29135","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4a/c7/ec18673b.jpg","comment_is_top":false,"comment_ctime":1563815820,"is_pvip":false,"replies":[{"id":"63645","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577526326,"ip_address":"","comment_id":116285,"utype":1}],"discussion_count":3,"race_medal":0,"score":"18743685004","product_id":100029501,"comment_content":"核心代码：<br>cursor = db.cursor()<br><br>sql = &quot;select name,hp_max from heros where hp_max &gt; %s&quot;<br>val = (6000,)<br>cursor.execute(sql,val)<br>data = cursor.fetchall()<br>注意：val里面的元素后面必须要加英文逗号，不加或者中文逗号都会报错","like_count":4,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459463,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577526326,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2565173,"avatar":"https://static001.geekbang.org/account/avatar/00/27/24/35/03603e95.jpg","nickname":"牛哥","note":"","ucode":"27D8619DC2B946","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385368,"discussion_content":"注意：val里面的元素后面必须要加英文逗号，不加或者中文逗号都会报错---真是这样，道理为何却百思不得其解！！！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627018113,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1868570,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/83/1a/f9d9225f.jpg","nickname":"欧阳啊","note":"","ucode":"CF1D0F0802713B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":189333,"discussion_content":"谢谢提醒","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582870572,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115193,"user_name":"TKbook","can_delete":false,"product_type":"c1","uid":1073829,"ip_address":"","ucode":"F6E0E99CC79059","user_header":"https://static001.geekbang.org/account/avatar/00/10/62/a5/43aa0c27.jpg","comment_is_top":false,"comment_ctime":1563505353,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"18743374537","product_id":100029501,"comment_content":"sql = &#39;DELETE FROM player WHERE name = %s&#39;<br>val = (&quot; 约翰 - 科林斯 &quot;)<br>cursor.execute(sql)<br>db.commit()<br>print(cursor.rowcount, &quot; 记录删除成功。&quot;)<br>这里写错了哇，这样写才不会报错：<br>sql = &#39;DELETE FROM player WHERE player_name = %s&#39;<br>val = (&quot; 约翰 - 科林斯 &quot;, )<br>cursor.execute(sql, val)<br>db.commit()<br>print(cursor.rowcount, &quot; 记录删除成功。&quot;)<br><br>","like_count":4,"discussions":[{"author":{"id":1474214,"avatar":"https://static001.geekbang.org/account/avatar/00/16/7e/a6/4e331ef4.jpg","nickname":"骑行的掌柜J","note":"","ucode":"3163102651C653","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7999,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567751699,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1057326,"avatar":"https://static001.geekbang.org/account/avatar/00/10/22/2e/c201ac90.jpg","nickname":"大道","note":"","ucode":"0939FA2589F45C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2376,"discussion_content":"成功了耶~ 感谢\n请教一下 val = (&#34; 约翰 - 科林斯 &#34;, ) 为什么这里末尾要加一个 ，(逗号)呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563526257,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1524154,"avatar":"https://static001.geekbang.org/account/avatar/00/17/41/ba/ae028565.jpg","nickname":"YqY","note":"","ucode":"73FB936045DCB9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1057326,"avatar":"https://static001.geekbang.org/account/avatar/00/10/22/2e/c201ac90.jpg","nickname":"大道","note":"","ucode":"0939FA2589F45C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":205843,"discussion_content":"加逗号才是元组","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584349702,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":2376,"ip_address":""},"score":205843,"extra":""},{"author":{"id":1706074,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/08/5a/4d709cf5.jpg","nickname":"Pray、PF","note":"","ucode":"1E3E4073763490","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1057326,"avatar":"https://static001.geekbang.org/account/avatar/00/10/22/2e/c201ac90.jpg","nickname":"大道","note":"","ucode":"0939FA2589F45C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":282825,"discussion_content":"逗号才是元组类型的标配","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1592100361,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":2376,"ip_address":""},"score":282825,"extra":""}]}]},{"had_liked":false,"id":192775,"user_name":"victor666","can_delete":false,"product_type":"c1","uid":1073136,"ip_address":"","ucode":"20C9BE10E07D55","user_header":"https://static001.geekbang.org/account/avatar/00/10/5f/f0/a73607b3.jpg","comment_is_top":false,"comment_ctime":1584872476,"is_pvip":false,"replies":[{"id":"82655","content":"哈哈 是的 Python代码更简洁","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1591443554,"ip_address":"","comment_id":192775,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10174807068","product_id":100029501,"comment_content":"Python直接写SQL比Java方便多了","like_count":2,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488457,"discussion_content":"哈哈 是的 Python代码更简洁","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591443554,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":151809,"user_name":"丁丁历险记","can_delete":false,"product_type":"c1","uid":1661704,"ip_address":"","ucode":"A43829E454C067","user_header":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","comment_is_top":false,"comment_ctime":1573795259,"is_pvip":false,"replies":[{"id":"59730","content":"这种信息论的内容在机器学习中用的还是挺多的","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1574738432,"ip_address":"","comment_id":151809,"utype":1}],"discussion_count":3,"race_medal":0,"score":"10163729851","product_id":100029501,"comment_content":"当一些听着很虚的理论用于实战时，其威力是巨大的，例如信息的正交性。","like_count":2,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474620,"discussion_content":"这种信息论的内容在机器学习中用的还是挺多的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574738432,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1661704,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","nickname":"丁丁历险记","note":"","ucode":"A43829E454C067","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":51147,"discussion_content":"不好意思，评论串频道了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1573817408,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1576240,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLlibCGekRp9bxJ3dGfOWghhNVdF771ejzwqKnicKFBpmGuutwNGF3HGZz7KEEz2mdvPckibReRsVtDw/132","nickname":"Geek_e6159b","note":"","ucode":"0684569F9B114D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337949,"discussion_content":"你不是设计模式的同学吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609133591,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115115,"user_name":"林彦","can_delete":false,"product_type":"c1","uid":1032615,"ip_address":"","ucode":"5094CC6ED7B40C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c1/a7/5e66d331.jpg","comment_is_top":false,"comment_ctime":1563497528,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10153432120","product_id":100029501,"comment_content":"try...except...那部分代码没有关闭游标的语句。关闭数据库连接的语句执行时一般都会先隐式关闭并释放当前的游标吗？","like_count":2},{"had_liked":false,"id":115103,"user_name":"一步","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1563495803,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"10153430395","product_id":100029501,"comment_content":"看目录，我以为到 SQL刷题了。。。","like_count":2},{"had_liked":false,"id":256346,"user_name":"bahao","can_delete":false,"product_type":"c1","uid":2061470,"ip_address":"","ucode":"3D99BE6BA2F3AF","user_header":"https://static001.geekbang.org/account/avatar/00/1f/74/9e/31872e2c.jpg","comment_is_top":false,"comment_ctime":1603605444,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5898572740","product_id":100029501,"comment_content":"看来要补习python了 执行sql太方便了","like_count":1},{"had_liked":false,"id":163662,"user_name":"taoist","can_delete":false,"product_type":"c1","uid":1195004,"ip_address":"","ucode":"D70AFE25CD8F10","user_header":"https://static001.geekbang.org/account/avatar/00/12/3b/fc/04a75cd0.jpg","comment_is_top":false,"comment_ctime":1576762875,"is_pvip":true,"replies":[{"id":"62649","content":"正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577081117,"ip_address":"","comment_id":163662,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5871730171","product_id":100029501,"comment_content":"import pymysql<br>import pymysql.cursors<br><br><br>cfg = {<br>    &quot;host&quot;: &quot;127.0.0.1&quot;,<br>    &quot;user&quot;: &quot;root&quot;,<br>    &quot;passwd&quot;: &quot;toor&quot;,<br>    &quot;database&quot;: &quot;test&quot;,<br>    &quot;charset&quot;: &quot;utf8mb4&quot;,<br>    &quot;autocommit&quot;: True,<br>    &#39;cursorclass&#39;:pymysql.cursors.DictCursor<br>}<br><br>db_con = pymysql.connect(**cfg)<br><br>try:<br>    with db_con.cursor() as cur:<br>        cur.execute(&quot;SELECT id,name,hp_max FROM heros WHERE hp_max &gt; 6000 &quot;)<br>        res = cur.fetchall()<br><br>    for i in res:<br>        print(i)<br>finally:<br>    db_con.close()<br><br>","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478494,"discussion_content":"正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577081117,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":116112,"user_name":"大斌","can_delete":false,"product_type":"c1","uid":1002183,"ip_address":"","ucode":"1434C2B0A29135","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4a/c7/ec18673b.jpg","comment_is_top":false,"comment_ctime":1563787654,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5858754950","product_id":100029501,"comment_content":"python连接mysql时报错【mysql.connector.errors.NotSupportedError: Authentication plugin &#39;caching_sha2_password&#39; is not support】。<br>原因是：mysql8.0.11使用了Use Strong Password Encryption for Authentication即强密码加密。<br>通常的处理方法是：重装mysql【装更低版本的或者将Use Strong Password Encryption for Authentication改为Use Legacy Authentication Method(在Authentication Method中改)】<br>还有一种更好的方案，那就是使用【pymysql】库来连接，代码如下：<br>    db_host = &quot;localhost&quot;<br>    db_username = &quot;root&quot;<br>    db_password = &quot;123456&quot;<br>    db_name = &quot;database_name&quot;<br>    conn = pymysql.connect(<br>        host=db_host,<br>        user=db_username,<br>        passwd=db_password,<br>        database=db_name,<br>    )","like_count":1},{"had_liked":false,"id":115154,"user_name":"mickey","can_delete":false,"product_type":"c1","uid":1051663,"ip_address":"","ucode":"8B490C2DDE4010","user_header":"https://static001.geekbang.org/account/avatar/00/10/0c/0f/93d1c8eb.jpg","comment_is_top":false,"comment_ctime":1563501247,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5858468543","product_id":100029501,"comment_content":"sql = &#39;DELETE FROM player WHERE player_name = &quot; 约翰-科林斯 &quot;&#39;","like_count":1},{"had_liked":false,"id":115120,"user_name":"极客酱","can_delete":false,"product_type":"c1","uid":1553524,"ip_address":"","ucode":"A1206B584604C1","user_header":"","comment_is_top":false,"comment_ctime":1563497786,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5858465082","product_id":100029501,"comment_content":"删除约翰·科林斯这个球员的数据代码里面，excute那个函数缺少了val的参数吧？","like_count":1},{"had_liked":false,"id":356934,"user_name":"年少挽滑稽世无双","can_delete":false,"product_type":"c1","uid":2962599,"ip_address":"四川","ucode":"793DCBDE25A07B","user_header":"https://static001.geekbang.org/account/avatar/00/2d/34/a7/52c4ea60.jpg","comment_is_top":false,"comment_ctime":1662709424,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1662709424","product_id":100029501,"comment_content":"# 请你使用 Python 对 heros 表中最大生命值大于 6000 的英雄进行查询，并且输出相应的属性值。<br># -*- coding: UTF-8 -*-<br>import mysql.connector<br><br># 打开数据库连接<br>db = mysql.connector.connect(<br>    port=3308,<br>    host=&quot;localhost&quot;,<br>    user=&quot;root&quot;,<br>    passwd=&quot;password&quot;,  # 写上你的数据库密码<br>    database=&#39;honor_of_kings&#39;,<br>    auth_plugin=&#39;mysql_native_password&#39;<br>)<br># 获取操作游标<br>cursor = db.cursor()<br><br>sql = &#39;SELECT name, hp_max FROM heros WHERE hp_max&gt;6000&#39;<br>cursor.execute(sql)<br>data = cursor.fetchall()<br>for each_player in data:<br>    print(each_player)<br><br># 关闭游标&amp;数据库连接<br>cursor.close()<br>db.close()<br>","like_count":0},{"had_liked":false,"id":345477,"user_name":"Geek_dc1862","can_delete":false,"product_type":"c1","uid":1888016,"ip_address":"","ucode":"DC3B41D6BC89D4","user_header":"","comment_is_top":false,"comment_ctime":1652320220,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1652320220","product_id":100029501,"comment_content":"如果MySQL版本过高，比如8.0.29<br>连接时会报错，可以采用以下语句解决:<br>查看全局参数的值:<br>show global variables like &#39;authentication_policy&#39;;<br>show global variables like &#39;default_authentication_plugin&#39;;<br>切换全局参数的值：<br>set global authentication_policy=&#39;*,,&#39;;<br>修改root用户的加密方式：<br>ALTER USER &#39;root&#39;@&#39;%&#39; IDENTIFIED WITH mysql_native_password BY &#39;your_pwd&#39;;<br>查询加密方式：<br>SELECT user,host,plugin from mysql.user;","like_count":0},{"had_liked":false,"id":322057,"user_name":"小柒·代购","can_delete":false,"product_type":"c1","uid":2762791,"ip_address":"","ucode":"94C67F0203BAF2","user_header":"https://static001.geekbang.org/account/avatar/00/2a/28/27/6246dc0d.jpg","comment_is_top":false,"comment_ctime":1637150187,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637150187","product_id":100029501,"comment_content":"import mysql.connector<br><br>db = mysql.connector.connect(<br>    host=&quot;localhost&quot;,<br>    user=&quot;root&quot;,<br>    passwd=&quot;&quot;,<br>    database=&quot;&quot;,<br>    auth_plugin=&quot;mysql_native_password&quot;<br>)<br>cursor = db.cursor()<br><br>sql = &quot;SELECT * FROM heros WHERE hp_max &gt; 6000&quot;<br><br>cursor.execute(sql)<br>data = cursor.fetchall()<br>for each_heros in data:<br>    print(each_heros)<br>cursor.close()<br>db.close()","like_count":0},{"had_liked":false,"id":303829,"user_name":"牛哥","can_delete":false,"product_type":"c1","uid":2565173,"ip_address":"","ucode":"27D8619DC2B946","user_header":"https://static001.geekbang.org/account/avatar/00/27/24/35/03603e95.jpg","comment_is_top":false,"comment_ctime":1627015373,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627015373","product_id":100029501,"comment_content":"<br>sql = &#39;DELETE FROM player WHERE player_name = %s&#39;<br>val = (&quot;约翰-科林斯&quot;,)<br>cursor.execute(sql, val)<br>db.commit()<br>print(cursor.rowcount, &quot;记录删除成功。&quot;)<br>val那里“约翰-科林斯”后边为何接逗号？测试了不加逗号就报语法错误。","like_count":0},{"had_liked":false,"id":296013,"user_name":"张静","can_delete":false,"product_type":"c1","uid":2640790,"ip_address":"","ucode":"C3586FA4E0FD4A","user_header":"","comment_is_top":false,"comment_ctime":1622705190,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622705190","product_id":100029501,"comment_content":"import mysql.connector<br># 打开数据库连接<br>db = mysql.connector.connect(<br>    host=&quot;xx.xx.xx.xx&quot;, port=&quot;3306&quot;,<br>    user=&quot;xx&quot;,<br>    passwd=&quot;xx&quot;,<br>    database=&#39;xx&#39;,<br>    auth_plugin=&#39;mysql_native_password&#39;)<br># 获取操作游标<br>cursor = db.cursor()<br>SQL=&quot;SELECT 列名 FROM 表名 where 条件&quot;<br># 执行SQL语句<br>cursor.execute(SQL)<br># 获取一条数据<br>data = cursor.fetchone()<br>print(data)<br># 关闭游标&amp;数据库连接<br>cursor.close()<br>db.close()<br><br>为什么会报Unread result found ，fetchone（）需要参数吗指定返回哪一行？","like_count":0},{"had_liked":false,"id":201074,"user_name":"Venn_p","can_delete":false,"product_type":"c1","uid":1341400,"ip_address":"","ucode":"8AB530B8EEE4CF","user_header":"https://static001.geekbang.org/account/avatar/00/14/77/d8/0e64251b.jpg","comment_is_top":false,"comment_ctime":1585712222,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585712222","product_id":100029501,"comment_content":"老师您好 有个问题请教下。执行删除后，再执行删除为什么没有报错。是要自己加代码判断吗","like_count":0},{"had_liked":false,"id":185730,"user_name":"马吉辉","can_delete":false,"product_type":"c1","uid":1854657,"ip_address":"","ucode":"4265EFBD2BB7BD","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKVIjh4T1akib5iav5IIGjXB9x98p9Y80STRcwpMDqxfGLrMvHamxlxEqLMTpiayWFWSNpBcbGwkRjRw/132","comment_is_top":false,"comment_ctime":1583672381,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583672381","product_id":100029501,"comment_content":"# 建议吧数据库链接信息写到配置文件里，防止密码泄露。<br>老师，这个 json文件应该怎么写？","like_count":0},{"had_liked":false,"id":169304,"user_name":"🤪HappyJoo","can_delete":false,"product_type":"c1","uid":1234591,"ip_address":"","ucode":"96E1858F06BABA","user_header":"https://static001.geekbang.org/account/avatar/00/12/d6/9f/0213e8a0.jpg","comment_is_top":false,"comment_ctime":1578311172,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1578311172","product_id":100029501,"comment_content":"还是想知道，为什么不直接用数据库管理工具呢？好像省了很多步骤，简单的update 一条数据，为什么要用python写那么多行代码呢？","like_count":0,"discussions":[{"author":{"id":2815900,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/f7/9c/69c5c5dc.jpg","nickname":"越锋利","note":"","ucode":"63E9E3F3C7D53D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":409384,"discussion_content":"写代码当然是为了自动化啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635428637,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130968,"user_name":"xcoder","can_delete":false,"product_type":"c1","uid":1207135,"ip_address":"","ucode":"2C70ED36B4AC8E","user_header":"https://static001.geekbang.org/account/avatar/00/12/6b/5f/cec1e980.jpg","comment_is_top":false,"comment_ctime":1567585765,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1567585765","product_id":100029501,"comment_content":"请问各路在线英雄，安装mysql-connector-python-8.0.17,那么对应的还是重新安装一个8.0.17的mysql了？这个有对老版本，比如5.6的mysql的支持吗？找了半天找不到，只有8.0版本的mysql才有的mysql-connector-python安装包吗?","like_count":0,"discussions":[{"author":{"id":1474214,"avatar":"https://static001.geekbang.org/account/avatar/00/16/7e/a6/4e331ef4.jpg","nickname":"骑行的掌柜J","note":"","ucode":"3163102651C653","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7744,"discussion_content":"我搜到有说是支持MySQL以下版本的：\n8.0, 5.7, 5.6, 5.5","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567658488,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126462,"user_name":"胡","can_delete":false,"product_type":"c1","uid":1353712,"ip_address":"","ucode":"3917AFED7701CA","user_header":"https://static001.geekbang.org/account/avatar/00/14/a7/f0/e3212f18.jpg","comment_is_top":false,"comment_ctime":1566388860,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566388860","product_id":100029501,"comment_content":"-- &gt;=2.08 插入的数据显示不出来<br><br>__author__ = &#39;Administrator&#39;<br><br># -*- coding: UTF-8 -*-<br>import traceback<br>import json<br>import mysql.connector<br># 打开数据库连接<br>db = mysql.connector.connect(<br>       host=&quot;localhost&quot;,<br>       user=&quot;root&quot;,<br>       passwd=&quot;hjf@2019&quot;, # 写上你的数据库密码<br>       database=&#39;nba&#39;,<br>       auth_plugin=&#39;mysql_native_password&#39;<br>)<br># 获取操作游标<br>cursor = db.cursor()<br># 执行 SQL 语句<br>#cursor.execute(&quot;SELECT VERSION()&quot;)<br># 获取一条数据<br>#data = cursor.fetchone()<br>#print(&quot;MySQL 版本: %s &quot; % data)<br># 关闭游标 &amp; 数据库连接<br><br><br><br># 插入新球员<br><br>#sql = &quot;INSERT INTO player (team_id,player_id,player_name,height) VALUES (%s, %s, %s,%s)&quot;<br>#val = (1003, 10038,&quot; 约翰 - 科林斯 &quot;, 2.08)<br>#cursor.execute(sql,val)<br>#db.commit()<br>#print(cursor.rowcount, &quot; 记录插入成功。&quot;)<br><br><br># 查询身高大于等于 2.08 的球员<br>sql = &#39;SELECT team_id, player_id, player_name, height FROM player WHERE height &gt;=2.08&#39;<br>cursor.execute(sql)<br>data = cursor.fetchall()<br>for each_player in data:<br>  print(each_player)<br><br><br><br>cursor.close()<br>db.close()","like_count":0},{"had_liked":false,"id":126449,"user_name":"胡","can_delete":false,"product_type":"c1","uid":1353712,"ip_address":"","ucode":"3917AFED7701CA","user_header":"https://static001.geekbang.org/account/avatar/00/14/a7/f0/e3212f18.jpg","comment_is_top":false,"comment_ctime":1566387468,"is_pvip":false,"replies":[{"id":"63787","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577541900,"ip_address":"","comment_id":126449,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1566387468","product_id":100029501,"comment_content":"__author__ = &#39;Administrator&#39;<br><br># -*- coding: UTF-8 -*-<br>import traceback<br>import json<br>import mysql.connector<br># 打开数据库连接<br>db = mysql.connector.connect(<br>       host=&quot;localhost&quot;,<br>       user=&quot;root&quot;,<br>       passwd=&quot;hjf@2019&quot;, # 写上你的数据库密码<br>       database=&#39;nba&#39;,<br>       auth_plugin=&#39;mysql_native_password&#39;<br>)<br># 获取操作游标<br>cursor = db.cursor()<br># 执行 SQL 语句<br>#cursor.execute(&quot;SELECT VERSION()&quot;)<br># 获取一条数据<br>#data = cursor.fetchone()<br>#print(&quot;MySQL 版本: %s &quot; % data)<br># 关闭游标 &amp; 数据库连接<br><br><br><br># 插入新球员<br><br>sql = &quot;INSERT INTO player (team_id,player_id,player_name,height) VALUES (%s, %s, %s,%s)&quot;<br>val = (1003, 10038,&quot; 约翰 - 科林斯 &quot;, 2.08)<br>cursor.execute(sql,val)<br>db.commit()<br>print(cursor.rowcount, &quot; 记录插入成功。&quot;)<br><br>cursor.close()<br>db.close()","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463990,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577541900,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126443,"user_name":"胡","can_delete":false,"product_type":"c1","uid":1353712,"ip_address":"","ucode":"3917AFED7701CA","user_header":"https://static001.geekbang.org/account/avatar/00/14/a7/f0/e3212f18.jpg","comment_is_top":false,"comment_ctime":1566386943,"is_pvip":false,"replies":[{"id":"62754","content":"默认设置的是递增的，就不需要指定player_id","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577089404,"ip_address":"","comment_id":126443,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1566386943","product_id":100029501,"comment_content":"老师在插入数据的时候，漏掉了 player_id ?","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463988,"discussion_content":"默认设置的是递增的，就不需要指定player_id","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577089404,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117690,"user_name":"发条","can_delete":false,"product_type":"c1","uid":1084458,"ip_address":"","ucode":"75853E7B13D8D4","user_header":"https://static001.geekbang.org/account/avatar/00/10/8c/2a/49e0547d.jpg","comment_is_top":false,"comment_ctime":1564111885,"is_pvip":false,"replies":[{"id":"63799","content":"感谢分享","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577542199,"ip_address":"","comment_id":117690,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1564111885","product_id":100029501,"comment_content":"使用8.0以上版本mysql的同学，在连接数据库的时候可能会受到quth_plugin不支持mysql_native_password的报错，<br>可以用ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED WITH mysql_native_password BY &#39;root&#39;;语句把auth_plugin改掉","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460085,"discussion_content":"感谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577542199,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":116075,"user_name":"Geek_5d805b","can_delete":false,"product_type":"c1","uid":1585504,"ip_address":"","ucode":"23A0EAC120EA9C","user_header":"","comment_is_top":false,"comment_ctime":1563782191,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563782191","product_id":100029501,"comment_content":"请问老师关于sql语句中的%s占位问题，如果我要修改多项值可否用变量替代呢？","like_count":0},{"had_liked":false,"id":115896,"user_name":"cricket1981","can_delete":false,"product_type":"c1","uid":1001715,"ip_address":"","ucode":"758262F5958DA4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/48/f3/f1034ffd.jpg","comment_is_top":false,"comment_ctime":1563763058,"is_pvip":false,"replies":[{"id":"63651","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577526455,"ip_address":"","comment_id":115896,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563763058","product_id":100029501,"comment_content":"# -*- coding: UTF-8 -*-<br><br>import mysql.connector<br># 打开数据库连接<br>db = mysql.connector.connect(<br>       host=&quot;localhost&quot;,<br>       user=&quot;root&quot;,<br>       passwd=&quot;root&quot;, # 写上你的数据库密码<br>       database=&#39;test&#39;, <br>       auth_plugin=&#39;mysql_native_password&#39;<br>)<br># 获取操作游标 <br>cursor = db.cursor()<br>sql = &#39;SELECT * FROM heros WHERE hp_max&gt;=6000&#39;<br>cursor.execute(sql)<br>data = cursor.fetchall()<br>for each_hero in data:<br>  print(each_hero)<br>cursor.close()<br>db.close()","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459336,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577526455,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115892,"user_name":"cricket1981","can_delete":false,"product_type":"c1","uid":1001715,"ip_address":"","ucode":"758262F5958DA4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/48/f3/f1034ffd.jpg","comment_is_top":false,"comment_ctime":1563762877,"is_pvip":false,"replies":[{"id":"63652","content":"可以查看下系统的编码设置 sys.getdefaultencoding","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577526654,"ip_address":"","comment_id":115892,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563762877","product_id":100029501,"comment_content":"python print语句出来的中文是乱码要怎么处理？python程序第一行加过 # -*- coding: UTF-8 -*-<br>(10003, u&#39;\\u5b89\\u5fb7\\u70c8-\\u5fb7\\u62c9\\u8499\\u5fb7&#39;, 2.11)","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459335,"discussion_content":"可以查看下系统的编码设置 sys.getdefaultencoding","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577526654,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115519,"user_name":"华夏","can_delete":false,"product_type":"c1","uid":1449474,"ip_address":"","ucode":"4D627CFA5A4B82","user_header":"https://static001.geekbang.org/account/avatar/00/16/1e/02/2864e0f2.jpg","comment_is_top":false,"comment_ctime":1563610805,"is_pvip":false,"replies":[{"id":"63663","content":"嗯 可以pip install mysql-connector-python","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577527356,"ip_address":"","comment_id":115519,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563610805","product_id":100029501,"comment_content":"pip install mysql-connector之后连接数据库会报错，更新到最新版还是一样报错，pip install mysql-connector-python之后可以正常运行。大家如果有遇到这个问题的可以参考@林彦-广州-数据分析师 这个办法。","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459142,"discussion_content":"嗯 可以pip install mysql-connector-python","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577527356,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115406,"user_name":"lmingzhi","can_delete":false,"product_type":"c1","uid":1014489,"ip_address":"","ucode":"72DBAF4FD184AF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7a/d9/4feb4006.jpg","comment_is_top":false,"comment_ctime":1563581379,"is_pvip":false,"replies":[{"id":"63667","content":"不用的资源，可以释放掉","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577527785,"ip_address":"","comment_id":115406,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563581379","product_id":100029501,"comment_content":"老师，你好，我一般使用SQLAlchemy连接数据库:<br>from sqlalchemy import create_engine<br>db = create_engine(&#39;mysql:&#47;&#47;root@localhost&#47;test_database&#39;)<br>一般如你在文中提到的话如果使用结束后，不想再浪费资源，需要执行什么操作？","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459092,"discussion_content":"不用的资源，可以释放掉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577527785,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115374,"user_name":"ABC","can_delete":false,"product_type":"c1","uid":1054958,"ip_address":"","ucode":"7501AD9C0C4A70","user_header":"https://static001.geekbang.org/account/avatar/00/10/18/ee/a1ed60d1.jpg","comment_is_top":false,"comment_ctime":1563546477,"is_pvip":false,"replies":[{"id":"63669","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577527810,"ip_address":"","comment_id":115374,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563546477","product_id":100029501,"comment_content":"执行结果:<br><br><br>(&#39;夏侯&#39;, 7350.0)<br>(&#39;钟无艳&#39;, 7000.0)<br>(&#39;张飞&#39;, 8341.0)<br>(&#39;牛魔&#39;, 8476.0)<br>(&#39;吕布&#39;, 7344.0)<br>(&#39;亚瑟&#39;, 8050.0)<br>(&#39;芈月&#39;, 6164.0)<br>(&#39;程咬金&#39;, 8611.0)<br>(&#39;廉颇&#39;, 9328.0)<br>(&#39;东皇太一&#39;, 7669.0)<br>(&#39;庄周&#39;, 8149.0)<br>(&#39;太乙真人&#39;, 6835.0)<br>(&#39;白起&#39;, 8638.0)<br>(&#39;雅典娜&#39;, 6264.0)<br>(&#39;刘邦&#39;, 8073.0)<br>(&#39;刘禅&#39;, 8581.0)<br>(&#39;墨子&#39;, 7176.0)<br>(&#39;项羽&#39;, 8057.0)<br>(&#39;关羽&#39;, 7107.0)<br>(&#39;孙尚香&#39;, 6014.0)<br>(&#39;露娜&#39;, 6612.0)<br>(&#39;不知火舞&#39;, 6014.0)<br>(&#39;孙膑&#39;, 6811.0)<br>(&#39;高渐离&#39;, 6165.0)<br>(&#39;扁鹊&#39;, 6703.0)<br>(&#39;钟馗&#39;, 6280.0)<br>(&#39;鬼谷子&#39;, 7107.0)<br>(&#39;赵云&#39;, 6732.0)<br>(&#39;橘石京&#39;, 7000.0)<br>(&#39;杨戬&#39;, 7420.0)<br>(&#39;达摩&#39;, 7140.0)<br>(&#39;孙悟空&#39;, 6585.0)<br>(&#39;刘备&#39;, 6900.0)<br>(&#39;曹操&#39;, 7473.0)<br>(&#39;典韦&#39;, 7516.0)<br>(&#39;宫本武藏&#39;, 6210.0)<br>(&#39;老夫子&#39;, 7155.0)<br>(&#39;哪吒&#39;, 7268.0)<br>(&#39;娜可露露&#39;, 6205.0)<br>(&#39;兰陵王&#39;, 6232.0)<br>(&#39;铠&#39;, 6700.0)","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459080,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577527810,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115373,"user_name":"ABC","can_delete":false,"product_type":"c1","uid":1054958,"ip_address":"","ucode":"7501AD9C0C4A70","user_header":"https://static001.geekbang.org/account/avatar/00/10/18/ee/a1ed60d1.jpg","comment_is_top":false,"comment_ctime":1563546437,"is_pvip":false,"replies":[{"id":"63670","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577527821,"ip_address":"","comment_id":115373,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563546437","product_id":100029501,"comment_content":"练习答案:<br><br><br># -*- coding: UTF-8 -*-<br>import mysql.connector<br><br>db = mysql.connector.connect(<br>       host=&quot;localhost&quot;,<br>       user=&quot;root&quot;,<br>       passwd=&quot;123456&quot;, <br>       database=&#39;geektime-sql&#39;, <br>       auth_plugin=&#39;mysql_native_password&#39;<br>)<br><br>cursor = db.cursor()<br>try:<br>  sql = &#39;SELECT  name,hp_max from heros where hp_max&gt;6000;&#39;<br>  cursor.execute(sql)<br>  data = cursor.fetchall()<br>  for each_player in data:<br>    print(each_player)<br>finally:<br>  cursor.close()<br>  db.close()","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459079,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577527821,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115369,"user_name":"谷径","can_delete":false,"product_type":"c1","uid":1019965,"ip_address":"","ucode":"D3462BF93E7A1B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/90/3d/7f5c1b37.jpg","comment_is_top":false,"comment_ctime":1563545279,"is_pvip":false,"replies":[{"id":"63671","content":"MySQL密码验证方式问题","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577527863,"ip_address":"","comment_id":115369,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563545279","product_id":100029501,"comment_content":"auth_plugin=&#39;mysql_native_password&#39; 这句报错，是什么意思呢？","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459077,"discussion_content":"MySQL密码验证方式问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577527863,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115313,"user_name":"华夏","can_delete":false,"product_type":"c1","uid":1449474,"ip_address":"","ucode":"4D627CFA5A4B82","user_header":"https://static001.geekbang.org/account/avatar/00/16/1e/02/2864e0f2.jpg","comment_is_top":false,"comment_ctime":1563529567,"is_pvip":false,"replies":[{"id":"63673","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577527900,"ip_address":"","comment_id":115313,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563529567","product_id":100029501,"comment_content":"(&#39;夏侯惇&#39;, 7350.0, 1746.0, 321.0, 397.0)<br>(&#39;钟无艳&#39;, 7000.0, 1760.0, 318.0, 409.0)<br>(&#39;张飞&#39;, 8341.0, 100.0, 301.0, 504.0)<br>(&#39;牛魔&#39;, 8476.0, 1926.0, 273.0, 394.0)<br>(&#39;吕布&#39;, 7344.0, 0.0, 343.0, 390.0)<br>(&#39;亚瑟&#39;, 8050.0, 0.0, 346.0, 400.0)<br>(&#39;芈月&#39;, 6164.0, 100.0, 289.0, 361.0)<br>(&#39;程咬金&#39;, 8611.0, 0.0, 316.0, 504.0)<br>(&#39;廉颇&#39;, 9328.0, 1708.0, 286.0, 514.0)<br>(&#39;东皇太一&#39;, 7669.0, 1926.0, 286.0, 360.0)<br>(&#39;庄周&#39;, 8149.0, 1694.0, 297.0, 497.0)<br>(&#39;太乙真人&#39;, 6835.0, 1680.0, 284.0, 396.0)<br>(&#39;白起&#39;, 8638.0, 1666.0, 288.0, 430.0)<br>(&#39;雅典娜&#39;, 6264.0, 1732.0, 327.0, 418.0)<br>(&#39;刘邦&#39;, 8073.0, 1940.0, 302.0, 504.0)<br>(&#39;刘禅&#39;, 8581.0, 1694.0, 295.0, 459.0)<br>(&#39;墨子&#39;, 7176.0, 1722.0, 328.0, 475.0)<br>(&#39;项羽&#39;, 8057.0, 1694.0, 306.0, 494.0)<br>(&#39;关羽&#39;, 7107.0, 10.0, 343.0, 386.0)<br>(&#39;孙尚香&#39;, 6014.0, 1756.0, 411.0, 346.0)<br>(&#39;露娜&#39;, 6612.0, 1836.0, 335.0, 375.0)<br>(&#39;不知火舞&#39;, 6014.0, 200.0, 293.0, 336.0)<br>(&#39;孙膑&#39;, 6811.0, 1926.0, 328.0, 413.0)<br>(&#39;高渐离&#39;, 6165.0, 1988.0, 290.0, 343.0)<br>(&#39;扁鹊&#39;, 6703.0, 2016.0, 309.0, 374.0)<br>(&#39;钟馗&#39;, 6280.0, 1988.0, 278.0, 390.0)<br>(&#39;鬼谷子&#39;, 7107.0, 1808.0, 297.0, 394.0)<br>(&#39;赵云&#39;, 6732.0, 1760.0, 380.0, 394.0)<br>(&#39;橘石京&#39;, 7000.0, 0.0, 347.0, 392.0)<br>(&#39;杨戬&#39;, 7420.0, 1694.0, 325.0, 428.0)<br>(&#39;达摩&#39;, 7140.0, 1694.0, 355.0, 415.0)<br>(&#39;孙悟空&#39;, 6585.0, 1760.0, 349.0, 385.0)<br>(&#39;刘备&#39;, 6900.0, 1742.0, 363.0, 381.0)<br>(&#39;曹操&#39;, 7473.0, 0.0, 361.0, 371.0)<br>(&#39;典韦&#39;, 7516.0, 1774.0, 345.0, 402.0)<br>(&#39;宫本武藏&#39;, 6210.0, 0.0, 330.0, 391.0)<br>(&#39;老夫子&#39;, 7155.0, 5.0, 329.0, 409.0)<br>(&#39;哪吒&#39;, 7268.0, 1808.0, 320.0, 408.0)<br>(&#39;娜可露露&#39;, 6205.0, 1808.0, 385.0, 359.0)<br>(&#39;兰陵王&#39;, 6232.0, 1822.0, 388.0, 342.0)<br>(&#39;铠&#39;, 6700.0, 1784.0, 328.0, 388.0)<br>41  查询成功。","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459052,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577527900,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115312,"user_name":"华夏","can_delete":false,"product_type":"c1","uid":1449474,"ip_address":"","ucode":"4D627CFA5A4B82","user_header":"https://static001.geekbang.org/account/avatar/00/16/1e/02/2864e0f2.jpg","comment_is_top":false,"comment_ctime":1563529556,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563529556","product_id":100029501,"comment_content":"用mysql-connector一直报错，更新了也不行，不知道为什么。然后就用了pymysql，代码大同小异。<br>import pymysql<br>import traceback<br>conn = pymysql.connect(host=&#39;localhost&#39;,user=&#39;root&#39;,passwd=&#39;123456789&#39;,db=&#39;db_mysql_2019&#39;,port=3306,charset=&#39;utf8&#39;)<br>cursor = conn.cursor()<br>try:<br>    sql = &quot;SELECT name, hp_max, mp_max, attack_max, defense_max FROM heros WHERE hp_max &gt; 6000&quot;<br>    cursor.execute(sql)<br>    data = cursor.fetchall()<br>    for each_hero in data:<br>        print(each_hero)<br>    conn.commit()<br>    print(cursor.rowcount, &quot; 查询成功。&quot;)<br>except Exception as e:<br>    traceback.print_exc()<br>    conn.rollback()<br>finally:<br>    cursor.close()<br>    conn.close()","like_count":0},{"had_liked":false,"id":115289,"user_name":"华夏","can_delete":false,"product_type":"c1","uid":1449474,"ip_address":"","ucode":"4D627CFA5A4B82","user_header":"https://static001.geekbang.org/account/avatar/00/16/1e/02/2864e0f2.jpg","comment_is_top":false,"comment_ctime":1563525087,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563525087","product_id":100029501,"comment_content":"安装了更新还是会报同样的错。mac，jupyter。","like_count":0},{"had_liked":false,"id":115200,"user_name":"许童童","can_delete":false,"product_type":"c1","uid":1003005,"ip_address":"","ucode":"4B799C0C6BC678","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg","comment_is_top":false,"comment_ctime":1563506469,"is_pvip":false,"replies":[{"id":"63677","content":"哈哈 赞下都理解的同学","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577527956,"ip_address":"","comment_id":115200,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1563506469","product_id":100029501,"comment_content":"老师你好，我觉得这一节讲得有点太浅了。","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459006,"discussion_content":"哈哈 赞下都理解的同学","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577527956,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1136904,"avatar":"https://static001.geekbang.org/account/avatar/00/11/59/08/e33bfa11.jpg","nickname":"91、洲先生","note":"","ucode":"285C552078E192","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2360,"discussion_content":"理解一下，水点钱不容易哈，\nsql就写sql，还写事务隔离级别，还朋友操作mysql，写就写呗，为什么写出来一种没东西写百度粘贴过来凑数的感觉，搞不懂","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1563516097,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115133,"user_name":"giteebravo","can_delete":false,"product_type":"c1","uid":1005290,"ip_address":"","ucode":"C087E8D6B5A98B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/56/ea/32608c44.jpg","comment_is_top":false,"comment_ctime":1563498615,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1563498615","product_id":100029501,"comment_content":"1、每次修改数据库（插入、更新、删除）都要 commit 太麻烦了；<br>2、导入的 traceback 包有什么用呢？","like_count":0},{"had_liked":false,"id":115107,"user_name":"ack","can_delete":false,"product_type":"c1","uid":1440912,"ip_address":"","ucode":"69CA1233EEA8E2","user_header":"https://static001.geekbang.org/account/avatar/00/15/fc/90/c9df0459.jpg","comment_is_top":false,"comment_ctime":1563496227,"is_pvip":false,"replies":[{"id":"63887","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577603419,"ip_address":"","comment_id":115107,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563496227","product_id":100029501,"comment_content":"# -*- coding: UTF-8 -*-<br>import mysql.connector<br><br># 打开数据库连接<br>db = mysql.connector.connect(<br>    host=&quot;localhost&quot;,<br>    user=&quot;user&quot;,<br>    passwd=&quot;12345&quot;,<br>    database=&#39;test&#39;,<br>    auth_plugin=&#39;mysql_native_password&#39;<br>)<br># 获取操作游标<br>cursor = db.cursor()<br># 执行 SQL 语句<br>cursor.execute(&quot;SELECT * FROM heros WHERE hp_max&gt;6000&quot;)<br>attr = cursor.description<br>attrNum = len(attr)<br>for i in range(attrNum):<br>    print attr[i][0],<br>print  &quot;\\n&quot;<br># 获取数据<br>data = cursor.fetchall()<br>for row in data:<br>    for col in row:<br>        print col,<br>    print &quot;\\n&quot;<br># 关闭游标 &amp; 数据库连接<br>cursor.close()<br>db.close()","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458968,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577603419,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}