{"id":688563,"title":"01ï½œé‡è¯†JVMï¼šJVMçš„èµ·æºã€ç‰¹æ€§ä¸ç³»ç»Ÿæ„æˆ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯åº·æ¨ã€‚æ¬¢è¿ä½ åŠ å…¥å­¦ä¹ ï¼Œå’Œæˆ‘ä¸€èµ·å¼€å¯JVMçš„æ¢ç´¢ä¹‹æ—…ã€‚</p><p>ä½œä¸ºè¿™é—¨è¯¾ç¨‹çš„ç¬¬ä¸€è®²ï¼Œæˆ‘å¸Œæœ›é€šè¿‡æˆ‘çš„ä»‹ç»ï¼Œèƒ½è®©ä½ å¯¹JVMæœ‰ä¸€ä¸ªæ•´ä½“çš„è®¤çŸ¥ã€‚æˆ‘å°†ä»JVMçš„èµ·æºã€å®ƒçš„åŸºæœ¬ç‰¹æ€§ã€å†…éƒ¨æ„æˆï¼Œä»¥åŠå®ƒä¸æˆ‘ä»¬å¸¸è¯´çš„JDKã€JREçš„å…³ç³»ç­‰å¤šä¸ªç»´åº¦å±•å¼€ï¼Œè®©ä½ çŸ¥å…¶ç„¶å¹¶çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚</p><h2>JVMçš„èµ·æº</h2><p>åŒºåˆ«äºå¾ˆå¤šè¯¾ç¨‹ä»¥â€œhello worldâ€&nbsp;å¼€ç¯‡ï¼Œæˆ‘ä»¬ä»Šå¤©ä»ä¸€ä¸ªå®é™…çš„éœ€æ±‚å¼€å§‹ã€‚å‡è®¾ä½ æ˜¯ä¸€å®¶é¤å…çš„è€æ¿ï¼Œéœ€è¦è®¡ç®—è¿‡å»ä¸€å‘¨çš„è¥æ”¶æ€»å’Œï¼Œè¿‡å»ä¸€å‘¨æ¯å¤©çš„è¥æ”¶åˆ†åˆ«æ˜¯ 102ã€230ã€320ã€431ã€130ã€‚å‡å¦‚ä½ ç”Ÿæ´»åœ¨å…¬å…ƒå‰ï¼Œè¿™æ—¶å€™ä½ å¯èƒ½å°±éœ€è¦ç”¨ç»“ç»³è®°äº‹çš„æ–¹å¼æ¥è¿›è¡Œè®¡ç®—ã€‚</p><p>è€Œå¦‚æœä½ ç”Ÿæ´»åœ¨19ä¸–çºª50å¹´ä»£ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œä½ å¯ä»¥ç”¨è®¡ç®—æœºå¸®ä½ è®¡ç®—äº†ã€‚å¹¸äºæœ‰äº†è®¡ç®—æœºï¼Œä¸ç„¶ï¼Œå¦‚æœè¦ç®—ä¸€å¹´çš„è¥æ”¶ï¼Œä¸çŸ¥é“è¦ç”¨æ‰å¤šå°‘æ ¹ç»³å­ï¼Œç®—å¤šé•¿æ—¶é—´å‘¢ã€‚</p><p>å½“ç„¶ï¼Œç°åœ¨çš„ä½ ï¼Œæ˜¾ç„¶ä¼šç”¨æ›´ç®€å•çš„æ–¹å¼å¾—åˆ°ç»“æœï¼Œé€šè¿‡ä¸‹é¢è¿™æ®µä»£ç ï¼ŒJVMå°±ä¼šå¸®ä½ å®Œæˆè¿ç®—ï¼Œä½ ç”šè‡³ä¸ç”¨è€ƒè™‘æ˜¯åœ¨Windowsä¸Šè¿è¡Œï¼Œè¿˜æ˜¯åœ¨è‹¹æœç”µè„‘ä¸Šè¿è¡Œï¼Œå› ä¸ºJVMä¼šå¸®ä½ æå®šã€‚</p><pre><code class=\"language-java\">int[] arr = {&nbsp;102ï¼Œ230ï¼Œ320ï¼Œ431ï¼Œ130};\nint sum = 0;   \nfor(int i: arr){   \n   sum += i;\n}\nSystem.out.println(\"Sum is: \" + sum);\n</code></pre><!-- [[[read_end]]] --><p>æˆ‘ä»¬è¦è§£å†³çš„é—®é¢˜æœ¬èº«ï¼Œå…¶å®ä»æœªå‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯è§£å†³é—®é¢˜çš„å·¥å…·ä»ç»“ç»³è®°äº‹ï¼Œåˆ°è®¡ç®—æœºå†åˆ°è™šæ‹Ÿæœºä¸€ç›´åœ¨æ¼”è¿›ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/31/03/31bdac0e85275e0a09527b2b6be88303.jpg?wh=1920x572\" alt=\"å›¾ç‰‡\"></p><p>å…¶å®ç»“ç»³è®°äº‹ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯æœ€æ—©çš„â€œè®¡ç®—æœºâ€ï¼Œè™½ç„¶å®ƒçœ‹ä¸Šå»ä¸æˆ‘ä»¬ç°åœ¨æ‰€ä½¿ç”¨çš„è®¡ç®—æœºå¤§ä¸ç›¸åŒï¼Œä½†å…¶èƒŒåçš„åŸç†ï¼Œä¹Ÿå°±æ˜¯ä¿¡æ¯çš„å‚¨å­˜ã€å¤„ç†ä¸ä¼ é€’ï¼Œå´ä¸æˆ‘ä»¬ç°åœ¨æ‰€ä½¿ç”¨çš„è®¡ç®—æœºå¦‚å‡ºä¸€è¾™ã€‚</p><p>äººç±»çš„æ™ºæ…§ä»è¿™é‡Œå¼€å§‹ï¼Œä¹Ÿç”±æ­¤å¼•é¢†æˆ‘ä»¬èµ°å‘äº†è®¡ç®—æœºçš„æ—¶ä»£ã€‚ç„¶åï¼Œäººç±»å‘æ˜äº†ç®—ç›˜ã€ç”µå­ç®¡è®¡ç®—æœºï¼Œå†åˆ°æ™¶ä½“ç®¡è®¡ç®—æœºã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œäººä»¬é€æ¸å‘ç°ï¼Œç”¨ç¡¬ä»¶å®ç°ä¸åŒçš„è®¡ç®—æœºç³»ç»Ÿæ—¢æ˜‚è´µåˆä½æ•ˆã€‚äºæ˜¯ï¼Œè½¯ä»¶çš„æ¦‚å¿µåº”è¿è€Œç”Ÿï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œè½¯ä»¶çš„é¢†åŸŸä¸æ–­æ‹“å±•å’ŒåŠ æ·±ï¼Œè®¡ç®—æœºçš„èƒ½åŠ›ä¹Ÿç›¸åº”åœ°æé«˜äº†ã€‚<strong>æ•´ä¸ªè®¡ç®—æœºç³»ç»Ÿç”±å±‚å±‚æŠ½è±¡æ„å»ºè€Œæˆï¼Œç¡¬ä»¶æ˜¯åŸºç¡€ï¼Œåº”ç”¨æ˜¯è¡¨å±‚ï¼Œä¸­é—´åˆ™æ˜¯æ“ä½œç³»ç»Ÿå’Œå„ç§å„æ ·çš„ç¼–ç¨‹è¯­è¨€ã€‚</strong></p><h3>è®¡ç®—æœºçš„æœºå™¨æœ¬è´¨</h3><p>ç°ä»£çš„è®¡ç®—æœºåŸºæœ¬æ˜¯ä»¥å›¾çµæœºä¸ºç†è®ºåŸºç¡€çš„ï¼Œé‡‡ç”¨äº†å†¯Â·è¯ºä¾æ›¼ä½“ç³»æ¶æ„ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/9c/c6/9cdb7c0247ae7c5799898f4d43eb5ec6.png?wh=1920x1125\" alt=\"å›¾ç‰‡\"></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œå†¯Â·è¯ºä¾æ›¼ä½“ç³»æ˜¯è®¡ç®—æœºä½“ç³»ç»“æ„çš„åŸºæœ¬æ¡†æ¶ï¼Œå®ƒç”±å­˜å‚¨å™¨ã€è¿ç®—å™¨ã€æ§åˆ¶å™¨å’ŒI/Oè®¾å¤‡ç»„æˆã€‚å­˜å‚¨å™¨ç”¨æ¥å­˜æ”¾æŒ‡ä»¤å’Œæ•°æ®ï¼Œè¿ç®—å™¨è´Ÿè´£æ‰§è¡Œç®—æœ¯å’Œé€»è¾‘è¿ç®—ï¼Œæ§åˆ¶å™¨æŒ‡å¯¼æŒ‡ä»¤çš„æ‰§è¡Œæµç¨‹ï¼Œè€ŒI/Oè®¾å¤‡ç”¨äºä¸å¤–éƒ¨ä¸–ç•Œè¿›è¡Œæ•°æ®äº¤äº’ã€‚</p><p>0/1æœºå™¨ç æ˜¯è®¡ç®—æœºèƒ½å¤Ÿç›´æ¥æ‰§è¡Œçš„æœ€åº•å±‚çš„æŒ‡ä»¤å½¢å¼ï¼Œå®ƒç”±0å’Œ1æ„æˆï¼Œå¯¹åº”ç€ä¸åŒçš„æ“ä½œå’Œæ•°æ®ä¼ è¾“ã€‚è®¡ç®—æœºé€šè¿‡å°†0/1æœºå™¨ç åŠ è½½åˆ°å­˜å‚¨å™¨ä¸­ï¼Œå¹¶ç”±æ§åˆ¶å™¨è§£æã€æ‰§è¡Œè¿™äº›æŒ‡ä»¤ï¼Œå®ç°äº†å¤æ‚çš„è®¡ç®—å’Œæ•°æ®å¤„ç†ä»»åŠ¡ã€‚</p><p>è¿™ç§åŸºäºå†¯Â·è¯ºä¾æ›¼ä½“ç³»å’Œ0/1æœºå™¨ç çš„è®¡ç®—æœºè¿è¡Œæ–¹å¼ä¸ä»…å…·æœ‰æ™®é€‚æ€§å’Œå¯ç¼–ç¨‹æ€§ï¼Œè¿˜ä¸ºè®¡ç®—æœºç§‘å­¦å’ŒæŠ€æœ¯çš„å‘å±•æä¾›äº†å¼ºå¤§çš„åŸºçŸ³ã€‚æ·±å…¥ç†è§£å’ŒæŒæ¡è¿™äº›æœºå™¨æœ¬è´¨çš„æ¦‚å¿µï¼Œèƒ½å¤Ÿæ›´å¥½åœ°è§£æå’Œæ§åˆ¶è®¡ç®—æœºç³»ç»Ÿã€‚è€Œå†¯Â·è¯ºä¾æ›¼ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰çš„æœ¬æºå’Œé›å½¢ã€‚</p><h3>Java è™šæ‹Ÿæœºçš„æœ¬è´¨</h3><p>JVMæ˜¯ä¸€ç§è™šæ‹Ÿè®¡ç®—æœºï¼Œå®ƒæ¥æ”¶å­—èŠ‚ç ï¼Œå¹¶æŠŠå®ƒè½¬åŒ–ä¸ºæœºå™¨å¯ä»¥è¯»å–å’Œæ‰§è¡Œçš„ä»£ç ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/c5/yy/c5def0b8811755a27cbc917dcffe4dyy.png?wh=2302x666\" alt=\"\"></p><p>è¿™æ ·Javaç¨‹åºå°±èƒ½åœ¨JVMä¸­è¿è¡Œï¼Œä¸ç”¨è€ƒè™‘åº•å±‚çš„ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿï¼Œè¿™å°±æ˜¯<strong>JVMçš„å¹³å°æ— å…³æ€§</strong>ã€‚ç®€å•æ¥è¯´ï¼ŒJVMå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªæŠ½è±¡çš„è®¡ç®—æœºï¼Œå®ƒæœ‰è‡ªå·±çš„æŒ‡ä»¤ç³»ç»Ÿã€å†…å­˜ã€æ³¨å†Œå™¨ç­‰ã€‚ç¼–è¯‘å™¨æŠŠæºç¨‹åºç¿»è¯‘æˆå­—èŠ‚ç ï¼Œè¿™äº›å­—èŠ‚ç éšååœ¨JVMä¸­æ‰§è¡Œã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/4d/9e/4dc0517dd71130cd14552c208540d09e.jpg?wh=1920x619\" alt=\"å›¾ç‰‡\"></p><p>æ€»çš„æ¥è¯´å°±æ˜¯Javaè™šæ‹Ÿæœºåœ¨è®¡ç®—æœºç¡¬ä»¶å’ŒJavaç¨‹åºä¹‹é—´å»ºç«‹äº†ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œä½¿Javaç¨‹åºä¸å¿…å…³å¿ƒåº•å±‚çš„ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„æƒ…å†µï¼Œä»è€Œå®ç°äº†Javaâ€œ<strong>ä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œ</strong>â€çš„æ•ˆæœã€‚è¿™ä¹Ÿæ˜¯Javaè¯­è¨€ç›¸æ¯”å…¶ä»–è¯­è¨€çš„ä¸€å¤§ä¼˜åŠ¿ã€‚</p><h3><strong>æœºå™¨ä¸è¯­è¨€</strong></h3><p><img src=\"https://static001.geekbang.org/resource/image/fb/4f/fbac890fbdd8407441df8243f6a8854f.jpg?wh=2732x1192\" alt=\"\"></p><p>é€šè¿‡åˆšåˆšçš„ä»‹ç»ï¼Œä¹Ÿè®¸ä½ ä¼šå‘ç°ï¼Œå…¶å®é—®é¢˜æœ¬èº«ä»æ¥æ²¡æœ‰å˜åŒ–è¿‡ï¼Œåªæ˜¯éšç€æ¯ä¸€ä¸ªæ–°çš„æœºå™¨çš„è¯ç”Ÿï¼Œæˆ‘ä»¬ä½¿ç”¨æœºå™¨çš„æˆæœ¬å¿«é€Ÿé™ä½äº†ã€‚æ¯ç§æœºå™¨éƒ½æä¾›äº†ä¸€ç§è¯­è¨€ä½œä¸ºæˆ‘ä»¬å’Œå®ƒä»¬äº¤äº’çš„æ–¹å¼ï¼Œåœ¨æœ€æ—©çš„è®¡ç®—æœºæ—¶ä»£ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡0/1æ¥å’Œè®¡ç®—æœºäº¤äº’ï¼Œè€ŒJVMé‡‡ç”¨å­—èŠ‚ç ä½œä¸ºäº¤äº’çš„è¯­è¨€ã€‚ä½†æ˜¯ç°åœ¨æˆ‘ä»¬å¯ä»¥ç”¨æ›´æ¥è¿‘äººç±»è¯­è¨€çš„Javaæˆ–è€…Groovyè¯­è¨€å’Œæœºå™¨äº¤äº’ï¼Œè®©å®ƒä»¬å®Œæˆæˆ‘ä»¬æœŸæœ›çš„ç›®æ ‡ã€‚</p><p>è¿™å°±åƒä¸€ä¸ªæ— é™çš„é€’å½’ï¼Œé€šè¿‡å°è£…åŸæœ‰çš„æœºå™¨ï¼Œæˆ‘ä»¬å€ŸåŠ©åŸæœ‰çš„æœºå™¨çš„èƒ½åŠ›ï¼Œæ‰“é€ ä¸€ä¸ªæ–°çš„æœºå™¨ï¼Œå¹¶æä¾›ä¸€é—¨æ–°çš„æ›´ç®€åŒ–çš„è¯­è¨€ã€‚è¿™ä¹Ÿæ˜¯äº‘æ—¶ä»£å½“æœºå™¨çš„æ¦‚å¿µè¶Šæ¥è¶Šå¼±åŒ–FaaSé€æ­¥æˆä¸ºä¸»æµçš„åŸå› ã€‚æ‰€ä»¥æ·±åˆ»åœ°ç†è§£JVMçš„æœ¬è´¨ï¼Œä¸å…‰èƒ½å¸®æˆ‘ä»¬å†™å‡ºä¼˜ç§€çš„Javaä»£ç ï¼Œä¹Ÿèƒ½å¸®åŠ©æˆ‘ä»¬çœ‹æ¸…æ¥šæŠ€æœ¯æ¼”è¿›çš„è¶‹åŠ¿ã€‚</p><h2>JVMåŸºæœ¬ç‰¹æ€§</h2><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹JVMæœ‰å“ªäº›ç‰¹æ€§ã€‚ä½œä¸ºä¸€ç§è®¡ç®—æœºæŠ½è±¡è®¾å¤‡ï¼ŒJVMç”¨äºç®¡ç†å’Œä¼˜åŒ–æ‰§è¡ŒJavaç¨‹åºã€‚åŒºåˆ«äºCPUé‡‡ç”¨çš„å¯„å­˜å™¨æ¶æ„ï¼ŒJVMæ˜¯åŸºäºæ ˆæŠ€æœ¯å®ç°çš„ã€‚å› ä¸ºå¯„å­˜å™¨å’Œç¡¬ä»¶æ¯æ¯ç›¸å…³ï¼Œç¨‹åºå¦‚æœé‡‡ç”¨å¯„å­˜å™¨å°±ä¼šå¤±å»ç§»æ¤æ€§ï¼Œè€ŒåŸºäºæ ˆæœ€ä¸»è¦çš„ä¼˜ç‚¹å°±æ˜¯ä¸æœºå™¨æ— å…³ã€‚</p><p>è¿™ä¹Ÿä½¿å¾—JVMå…·å¤‡å¦‚ä¸‹ç‰¹æ€§ï¼š</p><ol>\n<li>å¹³å°ç‹¬ç«‹æ€§ï¼šJavaä»£ç å¯ä»¥åœ¨ä»»ä½•å®‰è£…äº†JVMçš„æœºå™¨ä¸Šè¿è¡Œï¼Œä¸ç”¨ä¸ºæ¯ç§å¹³å°ç¼–å†™ä¸åŒçš„ç‰ˆæœ¬ã€‚</li>\n<li>è‡ªåŠ¨å†…å­˜ç®¡ç† ï¼šJVMæä¾›äº†åƒåœ¾æ”¶é›†æœºåˆ¶ï¼Œè‡ªåŠ¨å›æ”¶ä¸å†ä½¿ç”¨çš„å†…å­˜ï¼Œé™ä½å†…å­˜æ³„æ¼çš„é£é™©ã€‚</li>\n<li>é«˜æ•ˆçš„å³æ—¶ç¼–è¯‘ï¼šJVMè¿è¡Œæ—¶å³æ—¶ç¼–è¯‘å¯¹çƒ­ç‚¹ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œæå‡ç¨‹åºæ‰§è¡Œæ•ˆç‡ã€‚</li>\n<li>å¼ºå¤§çš„ç›‘æ§å’Œè°ƒè¯•å·¥å…·ï¼šJVMä¸ºå¼€å‘è€…æä¾›äº†è¯¦ç»†çš„æ€§èƒ½æ•°æ®å’Œè°ƒè¯•å·¥å…·ï¼Œå¸®åŠ©å¼€å‘è€…æå‡ç¨‹åºæ€§èƒ½ï¼Œè§£å†³é—®é¢˜ã€‚</li>\n</ol><p>æ‰€ä»¥JVMä¸ä»…èƒ½é™ä½å¼€å‘æˆæœ¬ï¼Œä½¿å¼€å‘è€…ä¸ç”¨å†å»è§£å†³ä¸€å¥—ä»£ç åœ¨å¤šå¹³å°è¿è¡Œå’Œç»´æŠ¤çš„é—®é¢˜ã€‚åŒæ—¶ä¹Ÿèƒ½é€šè¿‡å³æ—¶ç¼–è¯‘å’Œå†…å­˜ç®¡ç†ä½¿Javaåº”ç”¨å¯ä»¥è¿è¡Œå¾—æ›´å¿«ã€æ›´ç¨³å®šã€‚å„ç§è°ƒè¯•å’Œç›‘æ§å·¥å…·ä¹Ÿä¼šå¸®åŠ©æˆ‘ä»¬æ›´å¿«åœ°å‘ç°å’Œè§£å†³é—®é¢˜ï¼Œä»è€Œæå‡å¼€å‘æ•ˆç‡ã€‚</p><p>JVMå›ºç„¶å¾ˆå¼ºå¤§ï¼Œä½†æ˜¯è¿™å¹¶ä¸æ„å‘³ç€æˆ‘ä»¬å¯ä»¥éšå¿ƒæ‰€æ¬²åœ°å¼€å‘ç¨‹åºã€‚åªæœ‰æ·±å…¥åœ°äº†è§£JVMï¼Œæ‰èƒ½çœŸæ­£ç”¨å¥½JVMã€‚å¦åˆ™ä½ ä¼šå‘ç°ç¨‹åºè¿è¡Œçš„ç»“æœå’Œä½ è®¾æƒ³çš„å¹¶ä¸ä¸€æ ·ã€‚æ¯”å¦‚ä¸äº†è§£GCæœºåˆ¶ï¼Œéšæ„åˆ›å»ºå¯¹è±¡ï¼Œä¸è€ƒè™‘å¯¹è±¡çš„å¤§å°å’Œç”Ÿå‘½å‘¨æœŸï¼Œä¸è€ƒè™‘GCå’Œåº”ç”¨ç¨‹åºä¹‹é—´å…³ç³»ï¼Œä»è€Œå¯¼è‡´FULL GCå’ŒOOMçš„é—®é¢˜ã€‚</p><p>æ¯”å¦‚ä¸‹é¢è¿™æ®µä»£ç ï¼Œå¦‚æœæ²¡æœ‰è®¤è¯†åˆ°ä¸€æ®µä»£ç ä»æˆ‘ä»¬å¼€å‘åˆ°çœŸæ­£æ‰§è¡Œå¯èƒ½ç»è¿‡çš„ç¼–è¯‘å™¨é‡æ’ã€å†…å­˜é‡æ’ã€æŒ‡ä»¤é‡æ’ç­‰è¯¸å¤šè¿‡ç¨‹ï¼Œå¾ˆå¯èƒ½å¯¼è‡´ä»£ç çš„æ‰§è¡Œç»“æœä¸ç¨³å®šï¼Œç”šè‡³æ˜¯å‡ºé”™ã€‚</p><pre><code class=\"language-java\">public class Demo {\n    private int a = 0;\n    private  boolean flag = false;\n    public void writer() {\n        a = 1;                  \n        flag = true;            \n    }\n\n    public void reader() {\n        if (flag) {             \n            int i = a * a;      \n            System.out.println(i);\n        }\n    }\n    public static void main(String[] args) throws InterruptedException {\n        final   Demo example = new  Demo();\n        Thread thread1 = new Thread(() -&gt; example.writer());\n        Thread thread2 = new Thread(() -&gt; example.reader());\n        thread1.start();\n        thread2.start();\n        thread1.join();\n        thread2.join();\n    }\n }\n</code></pre><p>é‚£æ€ä¹ˆä¼˜åŒ–è¿™æ®µä»£ç å‘¢ï¼Ÿä½ å¯ä»¥å…ˆè‡ªå·±å°è¯•ä¼˜åŒ–ä¸€ä¸‹ã€‚</p><h2>JVMå†…éƒ¨æ„æˆ</h2><p>äº†è§£äº†è¿™ä¹ˆå¤šJVMçš„ç‰¹æ€§ï¼Œä¸‹é¢å°±è®©æˆ‘ä»¬æ·±å…¥åˆ°JVMçš„å†…éƒ¨ä¸€æ¢ç©¶ç«Ÿã€‚å¦‚å›¾æ‰€ç¤ºï¼ŒJVMç”±ä¸‰å¤§å­ç³»ç»Ÿæ„æˆï¼Œåˆ†åˆ«æ˜¯ç±»åŠ è½½å­ç³»ç»Ÿã€å­—èŠ‚ç æ‰§è¡Œå¼•æ“ä»¥åŠè¿è¡Œæ—¶æ•°æ®åŒºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/d2/f4/d280d8637642253797815bfb6738d8f4.jpg?wh=7069x5669\" alt=\"å›¾ç‰‡\"></p><h3>ç±»åŠ è½½å­ç³»ç»Ÿ</h3><p>ç±»åŠ è½½å­ç³»ç»Ÿï¼ˆ&nbsp;Class Loader Subsystemï¼‰è´Ÿè´£æŠŠå­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°å†…å­˜é‡Œï¼Œå¹¶åœ¨è¿è¡Œæ—¶è§£æå’ŒéªŒè¯ç±»æ–‡ä»¶çš„æ­£ç¡®æ€§ï¼Œä»¥æ­¤å®ç°Javaçš„åŠ¨æ€æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p><h3>å­—èŠ‚ç æ‰§è¡Œå¼•æ“</h3><p>å­—èŠ‚ç æ‰§è¡Œå¼•æ“ï¼ˆExecution Engineï¼‰æ˜¯JVMçš„æ ¸å¿ƒï¼Œç±»ä¼¼äºå†¯.è¯ºä¾æ›¼æœºçš„ä¸­å¤®å¤„ç†å™¨ï¼Œè´Ÿè´£æ‰§è¡Œå­—èŠ‚ç æŒ‡ä»¤ï¼ŒæŠŠå­—èŠ‚ç ç¿»è¯‘æˆæœºå™¨ä»£ç ï¼Œå®ç°ç¨‹åºçš„å®é™…è¿è¡Œä»¥åŠè·¨å¹³å°æ€§å’Œé«˜æ€§èƒ½çš„ç‰¹æ€§ã€‚</p><p>JVM åŒæ—¶æ”¯æŒ<strong>è§£é‡Šæ‰§è¡Œå’Œç¼–è¯‘æ‰§è¡Œ</strong>ä¸¤ç§æ–¹å¼ï¼ŒJVMçš„ä¼˜åŒ–é‡ç‚¹æ”¾åˆ°äº†è¿™ä¸ªéƒ¨åˆ†ï¼Œå®ƒä¼šè‡ªåŠ¨ç›‘è§†ä»£ç çš„æ‰§è¡Œæƒ…å†µï¼Œå¯¹äºä¸€èˆ¬çš„ä»£ç é‡‡ç”¨è§£é‡Šæ‰§è¡Œçš„æ–¹å¼ï¼Œè€Œå¯¹äºç»å¸¸è°ƒç”¨çš„æ–¹æ³•å¯åŠ¨ä¸€ä¸ªåå°çº¿ç¨‹ï¼ŒæŠŠå®ƒä»¬ç¼–è¯‘æˆæœ¬åœ°ä»£ç å¹¶è¿›è¡Œä¼˜åŒ–ï¼Œè¿™ä¹Ÿæ˜¯JVMèƒ½å®ç°é«˜æ€§èƒ½ä¸€ä¸ªéå¸¸é‡è¦çš„å› ç´ ã€‚</p><h3>è¿è¡Œæ—¶æ•°æ®åŒº</h3><p>è¿è¡Œæ—¶æ•°æ®åŒºï¼ˆRuntime Data Areaï¼‰ç”¨æ¥å­˜å‚¨ç¨‹åºæ‰§è¡ŒæœŸé—´çš„æ•°æ®ã€‚æä¾›ç¨‹åºè¿è¡Œæ—¶çš„å†…å­˜ç©ºé—´ï¼Œä¸ºç¨‹åºçš„æ‰§è¡Œæä¾›åŸºç¡€æ”¯æŒã€‚</p><p>è¿™ä¸ªåŒºåŸŸå¯ä»¥ä»çº¿ç¨‹çš„è§†è§’åˆ†æˆçº¿ç¨‹å…±äº«åŒºåŸŸå’Œçº¿ç¨‹ç‹¬äº«åŒºåŸŸã€‚çº¿ç¨‹ç‹¬äº«åŒºåŸŸä¸»è¦æœ‰ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆä¸‰ä¸ªéƒ¨åˆ†ï¼Œè¿™ä¸‰ä¸ªéƒ¨åˆ†ä¸çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸç›¸åŒï¼Œæ‰€ä»¥å’Œçº¿ç¨‹åŒç”Ÿç­ï¼Œä¸ç”¨è€ƒè™‘åƒåœ¾å›æ”¶çš„é—®é¢˜ã€‚çº¿ç¨‹å…±äº«åŒºåŸŸåŒ…æ‹¬å †å’Œæ–¹æ³•åŒºï¼Œæ–¹æ³•åŒºç”¨æ¥å­˜å‚¨ç±»çš„ç»“æ„ä¿¡æ¯ã€å †ç”¨æ¥å­˜å‚¨å¯¹è±¡å®ä¾‹ç­‰ã€‚</p><h2>JVMã€JDKä¸JRE</h2><p>æˆ‘ä»¬å¯ä»¥æŠŠJVMæ¯”ä½œæ±½è½¦çš„å‘åŠ¨æœºï¼Œè™½ç„¶å®ƒæ˜¯æ•´ä¸ªæ±½è½¦ä¸­éå¸¸æ ¸å¿ƒçš„éƒ¨ä»¶ï¼Œä½†æ˜¯æ˜¾ç„¶æˆ‘ä»¬ä¸èƒ½åªæ˜¯æŠŠä¸€å°å‘åŠ¨æœºäº¤ä»˜ç»™å®¢æˆ·ï¼Œç”¨æˆ·ä¸å…‰å…³å¿ƒå‘åŠ¨æœºçš„æ€§èƒ½ã€ç™¾å…¬é‡ŒåŠ é€Ÿçš„æ—¶é—´ï¼Œä¹Ÿå…³æ³¨ä½ çš„åº§æ¤…æ˜¯å¦æ˜¯çœŸçš®çš„ã€æ˜¯å¦æœ‰å…¨æ™¯å¤©çª—ç­‰ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥ä»‹ç»ä¸€ä¸‹JVMæœ€ç»ˆäº¤ä»˜ç»™ç”¨æˆ·çš„ä¸‰ä¸ªæ¦‚å¿µJDKã€JREã€JVMã€‚</p><p>JVMæˆ‘ä»¬å‰é¢å·²ç»è¯´è¿‡äº†ï¼Œè¿™é‡Œæˆ‘ä»¬é‡ç‚¹çœ‹ä¸€ä¸‹JDKå’ŒJREã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/eb/5c/ebf3432f388fc20d6d1eab56c571385c.png?wh=1920x1023\" alt=\"å›¾ç‰‡\"></p><h3>JRE</h3><p>JRE æ˜¯ Java Runtime Environment çš„ç¼©å†™ï¼Œ ä»åå­—å°±èƒ½çœ‹å‡ºæ¥ï¼ŒJRE å…³æ³¨Javaçš„è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒä¸»è¦ç”±ä¸‰ä¸ªéƒ¨åˆ†æ„æˆï¼Œåˆ†åˆ«æ˜¯æ ¸å¿ƒç±»åº“ã€æ”¯æŒæ–‡ä»¶ä»¥åŠ&nbsp;JVMã€‚JREç”±Java APIå’ŒJVMç»„æˆï¼ŒJVMé€šè¿‡ç±»åŠ è½½å™¨åŠ è½½Javaåº”ç”¨ï¼Œå¹¶é€šè¿‡Java APIæ¥æ‰§è¡Œã€‚</p><h3>JDK</h3><p>JDKæ˜¯ Java Development Kitï¼ˆ Javaå¼€å‘å·¥å…·å¥—ä»¶ ï¼‰çš„ç¼©å†™ï¼Œçœ‹åå­—ä¼°è®¡ä½ å°±çŒœåˆ°äº†ï¼Œå®ƒæ‰æ˜¯æˆ‘ä»¬äº¤ä»˜ç»™ç”¨æˆ·çš„é‚£å°æ±½è½¦ã€‚äº‹å®ä¸ŠJDK æ˜¯ä¸€ä¸ªå®Œæ•´çš„è½¯ä»¶å¼€å‘ç¯å¢ƒï¼Œèƒ½å¤Ÿå¸®åŠ©ç”¨æˆ·æ›´å¥½åœ°å¼€å‘Java Applet ä»¥åŠ Java æœåŠ¡å™¨ç«¯ç¨‹åºã€‚</p><p>JDK æ•´ä½“ä¸ŠåŒ…æ‹¬JREï¼ˆJava è¿è¡Œæ—¶ç¯å¢ƒï¼‰ã€Javacï¼ˆç¼–è¯‘å™¨ï¼‰ã€Javadocï¼ˆæ–‡æ¡£ç”Ÿæˆå™¨ï¼‰ã€å„ç§å·¥å…·ç­‰ï¼Œæä¾›äº†ä»åŠ è½½ä»£ç åˆ°éªŒè¯ä»£ç å†åˆ°æ‰§è¡Œä»£ç çš„å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</p><h2>é‡ç‚¹å›é¡¾</h2><p>è¿™èŠ‚è¯¾æˆ‘é€šè¿‡ä»‹ç»æ”¯æ’‘ç€Javaè¯­è¨€çš„JVMä¸ºä½ æ­ç¤ºäº†Javaç¼–ç¨‹èƒŒåçš„ç§˜å¯†ã€‚</p><p>æˆ‘ä»¬ä»åº•å±‚å®ç°å¼€å§‹äº†è§£äº†JVMçš„èµ·æºï¼Œå®ƒå…¶å®å°±æ˜¯ä¸€å°å†¯.è¯ºä¾æ›¼æœºå™¨ï¼Œå’Œæ‰€æœ‰çš„è®¡ç®—æœºä¸€æ ·èƒ½ååŠ©ä½ å®Œæˆè®¡ç®—çš„ä»»åŠ¡ã€‚ä½†æ˜¯ç›¸å¯¹äºæ™®é€šè®¡ç®—æœºåŸºäºå¯„å­˜å™¨çš„æ¶æ„ï¼ŒJVMæ˜¯åŸºäºæ ˆçš„è™šæ‹Ÿæœºï¼Œæ­£æ˜¯å› ä¸ºåŸºäºæ ˆçš„ç‰¹æ€§ï¼Œä½¿JVMå…·å¤‡äº†å¹³å°æ— å…³æ€§ã€‚å’Œæ‰€æœ‰çš„è¯­è¨€ä¸€æ ·ï¼ŒJVMæä¾›äº†è‡ªå·±çš„è¯­è¨€å­—èŠ‚ç ä»¥åŠå­—èŠ‚ç çš„è¿è¡Œæ—¶ç¯å¢ƒã€‚</p><p>è™½ç„¶JVMæ˜¯ä¸€å°æœºå™¨ï¼Œä½†æ˜¯å®ƒä¹Ÿæ˜¯è™šæ‹Ÿçš„ï¼Œå®ƒçš„èƒ½åŠ›æ¥æºäºåº•å±‚çœŸå®çš„ç‰©ç†æœºï¼Œæ‰€ä»¥äº†è§£åº•å±‚CPUå’Œæ“ä½œç³»ç»Ÿå¯¹ä½ ç”¨å¥½JVMå¤§æœ‰è£¨ç›Šï¼Œå› ä¸ºå®ƒä»¬æ˜¯JVMçš„èƒ½åŠ›ä¹‹æºã€‚å½“ç„¶é¢è¯•çš„å¿…è€ƒç‚¹JVMçš„å†…éƒ¨æ„é€ æˆ‘ä¹Ÿç€é‡ä»‹ç»äº†ä¸‹ï¼Œè¿™äº›éƒ½æ˜¯éœ€è¦ä½ ç‰¢è®°äºå¿ƒçš„ã€‚</p><h2>æ€è€ƒé¢˜</h2><pre><code>public class Demo {\n    private int a = 0;\n    private  boolean flag = false;\n    public void writer() {\n        a = 1;                  \n        flag = true;            \n    }\n\n    public void reader() {\n        if (flag) {             \n            int i = a * a;      \n            System.out.println(i);\n        }\n    }\n    public static void main(String[] args) throws InterruptedException {\n        final   Demo example = new  Demo();\n        Thread thread1 = new Thread(() -&gt; example.writer());\n        Thread thread2 = new Thread(() -&gt; example.reader());\n        thread1.start();\n        thread2.start();\n        thread1.join();\n        thread2.join();\n    }\n }\n</code></pre><ol>\n<li>å¯¹äºæˆ‘ç»™å‡ºçš„è¿™æ®µä»£ç ï¼Œä½ ä¼šå¦‚ä½•ä¼˜åŒ–å‘¢ï¼Ÿè¯·ä½ æŠŠä½ ä¼˜åŒ–åçš„ä»£ç åˆ†äº«åˆ°è¯„è®ºåŒºã€‚</li>\n<li>JVMå’Œæ™®é€šè®¡ç®—æœºçš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿè¯·è¯´ä¸€è¯´ä½ çš„ç†è§£ã€‚</li>\n</ol><p>æ¬¢è¿ä½ æŠŠä½ çš„ç­”æ¡ˆåˆ†äº«åˆ°è¯„è®ºåŒºï¼Œå’Œæˆ‘ä¸€èµ·è®¨è®ºï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™éœ€è¦çš„æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p><h2>ğŸ’¡ç‚¹äº®ä½ çš„çŸ¥è¯†æ¡†æ¶å›¾</h2><p><img src=\"https://static001.geekbang.org/resource/image/46/c5/462b4c3e2b1033bca75fb62d56fc8bc5.jpg?wh=6666x4923\" alt=\"å›¾ç‰‡\"></p>","neighbors":{"left":{"article_title":"å¼€ç¯‡è¯ï½œäº‘æ—¶ä»£æ¥ä¸´ï¼Œå¦‚ä½•å­¦å¥½JVMåº”å¯¹æœªæ¥çš„æŒ‘æˆ˜ï¼Ÿ","id":688761},"right":{"article_title":"02ï½œæŒ‘æˆ˜ä¸è¶‹åŠ¿ï¼šäº‘åŸç”Ÿæ—¶ä»£JVMçš„æ¼”è¿›ä¹‹è·¯","id":688784}},"comments":[{"had_liked":false,"id":379945,"user_name":"å–†","can_delete":false,"product_type":"c1","uid":1021657,"ip_address":"è¾½å®","ucode":"542E4D8FF40EEF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/96/d9/a252585b.jpg","comment_is_top":false,"comment_ctime":1692751064,"is_pvip":false,"replies":[{"id":138438,"content":" åŸºäºæ ˆçš„ç‰¹æ€§æŒ‡çš„æ˜¯JVMä½¿ç”¨æ ˆæ¥è¿›è¡Œè®¡ç®—å’Œå†…å­˜ç®¡ç†ã€‚åœ¨JVMä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç§æœ‰çš„æ ˆï¼Œç”¨æ¥å­˜å‚¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€æ–¹æ³•çš„å‚æ•°ã€è¿”å›å€¼ä»¥åŠæ–¹æ³•è°ƒç”¨æ—¶çš„ä¸´æ—¶æ•°æ®ã€‚æ¯å½“çº¿ç¨‹è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ï¼ŒJVMä¼šä¸ºè¯¥æ–¹æ³•åˆ†é…ä¸€ä¸ªæ ˆå¸§ï¼Œæ ˆå¸§åŒ…å«äº†æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆç­‰ä¿¡æ¯ã€‚ä¸ä¹‹ç›¸å¯¹ï¼ŒåŸºäºå¯„å­˜å™¨çš„æ¶æ„ï¼ˆå¦‚æ™®é€šè®¡ç®—æœºï¼‰ä½¿ç”¨å¯„å­˜å™¨æ¥å­˜å‚¨æ•°æ®ã€‚å¯„å­˜å™¨æ˜¯ä½äºå¤„ç†å™¨å†…éƒ¨çš„é«˜é€Ÿå­˜å‚¨å™¨ï¼Œç”¨äºå­˜æ”¾æŒ‡ä»¤æ“ä½œæ•°å’Œä¸­é—´ç»“æœã€‚åŸºäºå¯„å­˜å™¨çš„æ¶æ„ç›´æ¥åˆ©ç”¨å¤„ç†å™¨çš„å¯„å­˜å™¨è¿›è¡Œè®¡ç®—ï¼Œé€Ÿåº¦è¾ƒå¿«ã€‚\nåŸºäºæ ˆçš„ç‰¹æ€§ä½¿JVMå…·å¤‡äº†å¹³å°æ— å…³æ€§ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹åŸå› ï¼š\n1. æ ˆçš„æ“ä½œæ˜¯åœ¨å†…å­˜ä¸­è¿›è¡Œçš„ï¼Œå¹¶ä¸ä¾èµ–äºç‰¹å®šçš„ç¡¬ä»¶æ¶æ„ã€‚JVMé€šè¿‡ä½¿ç”¨æ ˆæ¥è¿›è¡Œè®¡ç®—ï¼ŒæŠ½è±¡äº†åº•å±‚çš„ç¡¬ä»¶ç»†èŠ‚ï¼Œä½¿å¾—Javaç¨‹åºå¯ä»¥åœ¨ä¸åŒçš„ç¡¬ä»¶å¹³å°ä¸Šè¿è¡Œï¼Œè€Œä¸éœ€è¦ä¿®æ”¹æºä»£ç ã€‚\n2. Javaçš„å­—èŠ‚ç æ˜¯é¢å‘æ ˆçš„æŒ‡ä»¤é›†ã€‚Javaæºç åœ¨ç»è¿‡ç¼–è¯‘åä¼šç”Ÿæˆå­—èŠ‚ç ï¼Œå­—èŠ‚ç æ˜¯ä¸€ç§ä¸­é—´ä»£ç ï¼Œä½¿ç”¨æ ˆæ¥è¿›è¡Œæ“ä½œã€‚è¿™äº›å­—èŠ‚ç å¯ä»¥è¢«JVMè§£é‡Šæ‰§è¡Œæˆ–è€…ç¼–è¯‘æˆç‰¹å®šç¡¬ä»¶æ¶æ„çš„æœºå™¨ç ï¼Œå®ç°äº†å¹³å°æ— å…³æ€§ã€‚\n3. JVMçš„å†…å­˜ç®¡ç†ä¹Ÿæ˜¯åŸºäºæ ˆçš„ã€‚JVMä½¿ç”¨æ ˆæ¥è¿›è¡Œæ–¹æ³•è°ƒç”¨å’Œå±€éƒ¨å˜é‡çš„ç®¡ç†ï¼ŒåŒæ—¶ä¹Ÿä½¿ç”¨æ ˆæ¥è¿›è¡Œå†…å­˜çš„åˆ†é…å’Œé”€æ¯ã€‚è¿™ç§åŸºäºæ ˆçš„å†…å­˜ç®¡ç†æ–¹å¼ï¼Œç®€åŒ–äº†å¼€å‘è€…çš„å†…å­˜ç®¡ç†å·¥ä½œï¼Œæä¾›äº†è·¨å¹³å°çš„å†…å­˜ç®¡ç†æœºåˆ¶ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1366588,"ctime":1693116479,"ip_address":"åŒ—äº¬","comment_id":379945,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100613601,"comment_content":"â€œç›¸å¯¹äºæ™®é€šè®¡ç®—æœºåŸºäºå¯„å­˜å™¨çš„æ¶æ„ï¼ŒJVM æ˜¯åŸºäºæ ˆçš„è™šæ‹Ÿæœºï¼Œæ­£æ˜¯å› ä¸ºåŸºäºæ ˆçš„ç‰¹æ€§ï¼Œä½¿ JVM å…·å¤‡äº†å¹³å°æ— å…³æ€§â€ï¼ŒåŸºäºæ ˆçš„ç‰¹æ€§æ˜¯ä»€ä¹ˆæ„æ€ï¼Œä»€ä¹ˆå«åŸºäºæ ˆï¼Ÿå¯ä»¥å±•å¼€è¯´ä¸€ä¸‹å—ï¼Ÿä¸ºä»€ä¹ˆåŸºäºæ ˆçš„ç‰¹æ€§å°±èƒ½å¹³å°æ— å…³äº†ï¼Ÿ","like_count":10,"discussions":[{"author":{"id":1020644,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/92/e4/abb7bfe3.jpg","nickname":"TerryGoForIt","note":"","ucode":"701B0E72F15AB5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":626536,"discussion_content":"JVMä¸ç”¨å¯„å­˜å™¨ï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1693097921,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1366588,"avatar":"https://static001.geekbang.org/account/avatar/00/14/da/3c/6ca50139.jpg","nickname":"Arthur king å¾®ä¿¡è¶…ç´šæœƒå“¡","note":"","ucode":"79637F55F0ED85","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":626552,"discussion_content":" åŸºäºæ ˆçš„ç‰¹æ€§æŒ‡çš„æ˜¯JVMä½¿ç”¨æ ˆæ¥è¿›è¡Œè®¡ç®—å’Œå†…å­˜ç®¡ç†ã€‚åœ¨JVMä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç§æœ‰çš„æ ˆï¼Œç”¨æ¥å­˜å‚¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€æ–¹æ³•çš„å‚æ•°ã€è¿”å›å€¼ä»¥åŠæ–¹æ³•è°ƒç”¨æ—¶çš„ä¸´æ—¶æ•°æ®ã€‚æ¯å½“çº¿ç¨‹è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ï¼ŒJVMä¼šä¸ºè¯¥æ–¹æ³•åˆ†é…ä¸€ä¸ªæ ˆå¸§ï¼Œæ ˆå¸§åŒ…å«äº†æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆç­‰ä¿¡æ¯ã€‚ä¸ä¹‹ç›¸å¯¹ï¼ŒåŸºäºå¯„å­˜å™¨çš„æ¶æ„ï¼ˆå¦‚æ™®é€šè®¡ç®—æœºï¼‰ä½¿ç”¨å¯„å­˜å™¨æ¥å­˜å‚¨æ•°æ®ã€‚å¯„å­˜å™¨æ˜¯ä½äºå¤„ç†å™¨å†…éƒ¨çš„é«˜é€Ÿå­˜å‚¨å™¨ï¼Œç”¨äºå­˜æ”¾æŒ‡ä»¤æ“ä½œæ•°å’Œä¸­é—´ç»“æœã€‚åŸºäºå¯„å­˜å™¨çš„æ¶æ„ç›´æ¥åˆ©ç”¨å¤„ç†å™¨çš„å¯„å­˜å™¨è¿›è¡Œè®¡ç®—ï¼Œé€Ÿåº¦è¾ƒå¿«ã€‚\nåŸºäºæ ˆçš„ç‰¹æ€§ä½¿JVMå…·å¤‡äº†å¹³å°æ— å…³æ€§ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹åŸå› ï¼š\n1. æ ˆçš„æ“ä½œæ˜¯åœ¨å†…å­˜ä¸­è¿›è¡Œçš„ï¼Œå¹¶ä¸ä¾èµ–äºç‰¹å®šçš„ç¡¬ä»¶æ¶æ„ã€‚JVMé€šè¿‡ä½¿ç”¨æ ˆæ¥è¿›è¡Œè®¡ç®—ï¼ŒæŠ½è±¡äº†åº•å±‚çš„ç¡¬ä»¶ç»†èŠ‚ï¼Œä½¿å¾—Javaç¨‹åºå¯ä»¥åœ¨ä¸åŒçš„ç¡¬ä»¶å¹³å°ä¸Šè¿è¡Œï¼Œè€Œä¸éœ€è¦ä¿®æ”¹æºä»£ç ã€‚\n2. Javaçš„å­—èŠ‚ç æ˜¯é¢å‘æ ˆçš„æŒ‡ä»¤é›†ã€‚Javaæºç åœ¨ç»è¿‡ç¼–è¯‘åä¼šç”Ÿæˆå­—èŠ‚ç ï¼Œå­—èŠ‚ç æ˜¯ä¸€ç§ä¸­é—´ä»£ç ï¼Œä½¿ç”¨æ ˆæ¥è¿›è¡Œæ“ä½œã€‚è¿™äº›å­—èŠ‚ç å¯ä»¥è¢«JVMè§£é‡Šæ‰§è¡Œæˆ–è€…ç¼–è¯‘æˆç‰¹å®šç¡¬ä»¶æ¶æ„çš„æœºå™¨ç ï¼Œå®ç°äº†å¹³å°æ— å…³æ€§ã€‚\n3. JVMçš„å†…å­˜ç®¡ç†ä¹Ÿæ˜¯åŸºäºæ ˆçš„ã€‚JVMä½¿ç”¨æ ˆæ¥è¿›è¡Œæ–¹æ³•è°ƒç”¨å’Œå±€éƒ¨å˜é‡çš„ç®¡ç†ï¼ŒåŒæ—¶ä¹Ÿä½¿ç”¨æ ˆæ¥è¿›è¡Œå†…å­˜çš„åˆ†é…å’Œé”€æ¯ã€‚è¿™ç§åŸºäºæ ˆçš„å†…å­˜ç®¡ç†æ–¹å¼ï¼Œç®€åŒ–äº†å¼€å‘è€…çš„å†…å­˜ç®¡ç†å·¥ä½œï¼Œæä¾›äº†è·¨å¹³å°çš„å†…å­˜ç®¡ç†æœºåˆ¶ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1693116479,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1220497,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIgObalcm8lIIX69bTo2uYq8erQ9l5wyBibqgorgSsA3QdfOibzeM2V2LbfolwNsLJPMmrdhbHYNsSQ/132","nickname":"Volatile","note":"","ucode":"020769E374988C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635751,"discussion_content":"è¿™é‡Œä½œè€…çš„è§‚ç‚¹ï¼Œæˆ‘ä¸æ•¢è‹ŸåŒã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1705123083,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1174199,"avatar":"https://static001.geekbang.org/account/avatar/00/11/ea/b7/1a18a39d.jpg","nickname":"5-åˆ˜æ–°æ³¢(Arvin)","note":"","ucode":"DBD135D2587A93","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":627324,"discussion_content":"ç›¸å½“äºç”¨å†…å­˜ä»£æ›¿ç‰©ç†å¯„å­˜å™¨è¿›è¡Œè®¡ç®—ï¼Œå­˜å‚¨ã€‚è‡³äºå…¶ä»–èƒ½åŠ›å¦‚åˆ›å»ºçº¿ç¨‹ç­‰è¿˜æ˜¯å¾—å€ŸåŠ©ç‰©ç†æœº","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1693988469,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"é™•è¥¿","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":379860,"user_name":"Johar","can_delete":false,"product_type":"c1","uid":1101969,"ip_address":"é‡åº†","ucode":"834136A6F64CDC","user_header":"https://static001.geekbang.org/account/avatar/00/10/d0/91/89123507.jpg","comment_is_top":false,"comment_ctime":1692624078,"is_pvip":false,"replies":[{"id":138441,"content":" åœ¨Javaä¸­ï¼Œclassæ–‡ä»¶çš„å¸è½½æ˜¯ç”±Javaè™šæ‹Ÿæœºçš„åƒåœ¾å›æ”¶æœºåˆ¶å†³å®šçš„ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå½“ä¸€ä¸ªç±»ä¸å†è¢«ä»»ä½•æ´»åŠ¨çš„çº¿ç¨‹æ‰€å¼•ç”¨æ—¶ï¼Œå®ƒå°±å˜å¾—å¯è¢«å¸è½½çš„ã€‚\nå…·ä½“è€Œè¨€ï¼Œä¸‹é¢æ˜¯å¯¼è‡´classæ–‡ä»¶å¸è½½çš„ä¸€äº›å¸¸è§æƒ…å†µï¼š\n1. ç±»çš„å®ä¾‹è¢«åƒåœ¾å›æ”¶ï¼šå½“ä¸€ä¸ªç±»çš„æ‰€æœ‰å®ä¾‹éƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶æ—¶ï¼Œè¯¥ç±»å°±å˜å¾—æ²¡æœ‰è¢«å¼•ç”¨ï¼Œå¯ä»¥è¢«å¸è½½ã€‚\n2. ç±»çš„ClassLoaderè¢«å›æ”¶ï¼šå½“ä¸€ä¸ªç±»çš„ClassLoaderè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶æ—¶ï¼Œè¯¥ç±»åŠå…¶ç›¸å…³çš„ç±»ä¹Ÿä¼šè¢«å¸è½½ã€‚\n3. ç±»çš„å¼•ç”¨è¢«è§£é™¤ï¼šå½“ä¸€ä¸ªç±»çš„æ‰€æœ‰å¼•ç”¨è¢«è§£é™¤ï¼Œä¾‹å¦‚é€šè¿‡åå°„è°ƒç”¨`Class.forName()`åŠ è½½çš„ç±»ï¼Œåœ¨ä¸å†éœ€è¦æ—¶å¯ä»¥æ‰‹åŠ¨è°ƒç”¨`Class.forName(&quot;className&quot;).getClassLoader().clearAssertionStatus()`æ¥è§£é™¤å¯¹ç±»çš„å¼•ç”¨ï¼Œä»è€Œä½¿å¾—è¯¥ç±»å¯ä»¥è¢«å¸è½½ã€‚\nä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„classæ–‡ä»¶éƒ½å¯ä»¥è¢«å¸è½½ã€‚å› ä¸ºåœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­ï¼Œå¹¶æ²¡æœ‰æ˜ç¡®è¦æ±‚è™šæ‹Ÿæœºå¿…é¡»å¸è½½ç±»ï¼Œç±»çš„å¸è½½æ˜¯å¯é€‰çš„ã€‚ä¸€äº›Javaè™šæ‹Ÿæœºå®ç°å¯èƒ½ä¼šé€‰æ‹©ä¸è¿›è¡Œç±»çš„å¸è½½ï¼Œæˆ–è€…ä»…åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰è¿›è¡Œå¸è½½ã€‚å› æ­¤ï¼Œclassæ–‡ä»¶çš„å¸è½½è¡Œä¸ºå¯èƒ½ä¼šå› ä¸åŒçš„Javaè™šæ‹Ÿæœºå®ç°è€Œæœ‰æ‰€ä¸åŒã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1366588,"ctime":1693116844,"ip_address":"åŒ—äº¬","comment_id":379860,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100613601,"comment_content":"è¯·æ•™ä¸€ä¸‹åŠ è½½çš„classæ–‡ä»¶ä»€ä¹ˆæ—¶å€™ä¼šå¸è½½ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1366588,"avatar":"https://static001.geekbang.org/account/avatar/00/14/da/3c/6ca50139.jpg","nickname":"Arthur king å¾®ä¿¡è¶…ç´šæœƒå“¡","note":"","ucode":"79637F55F0ED85","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":626555,"discussion_content":" åœ¨Javaä¸­ï¼Œclassæ–‡ä»¶çš„å¸è½½æ˜¯ç”±Javaè™šæ‹Ÿæœºçš„åƒåœ¾å›æ”¶æœºåˆ¶å†³å®šçš„ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå½“ä¸€ä¸ªç±»ä¸å†è¢«ä»»ä½•æ´»åŠ¨çš„çº¿ç¨‹æ‰€å¼•ç”¨æ—¶ï¼Œå®ƒå°±å˜å¾—å¯è¢«å¸è½½çš„ã€‚\nå…·ä½“è€Œè¨€ï¼Œä¸‹é¢æ˜¯å¯¼è‡´classæ–‡ä»¶å¸è½½çš„ä¸€äº›å¸¸è§æƒ…å†µï¼š\n1. ç±»çš„å®ä¾‹è¢«åƒåœ¾å›æ”¶ï¼šå½“ä¸€ä¸ªç±»çš„æ‰€æœ‰å®ä¾‹éƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶æ—¶ï¼Œè¯¥ç±»å°±å˜å¾—æ²¡æœ‰è¢«å¼•ç”¨ï¼Œå¯ä»¥è¢«å¸è½½ã€‚\n2. ç±»çš„ClassLoaderè¢«å›æ”¶ï¼šå½“ä¸€ä¸ªç±»çš„ClassLoaderè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶æ—¶ï¼Œè¯¥ç±»åŠå…¶ç›¸å…³çš„ç±»ä¹Ÿä¼šè¢«å¸è½½ã€‚\n3. ç±»çš„å¼•ç”¨è¢«è§£é™¤ï¼šå½“ä¸€ä¸ªç±»çš„æ‰€æœ‰å¼•ç”¨è¢«è§£é™¤ï¼Œä¾‹å¦‚é€šè¿‡åå°„è°ƒç”¨`Class.forName()`åŠ è½½çš„ç±»ï¼Œåœ¨ä¸å†éœ€è¦æ—¶å¯ä»¥æ‰‹åŠ¨è°ƒç”¨`Class.forName(&#34;className&#34;).getClassLoader().clearAssertionStatus()`æ¥è§£é™¤å¯¹ç±»çš„å¼•ç”¨ï¼Œä»è€Œä½¿å¾—è¯¥ç±»å¯ä»¥è¢«å¸è½½ã€‚\nä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„classæ–‡ä»¶éƒ½å¯ä»¥è¢«å¸è½½ã€‚å› ä¸ºåœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­ï¼Œå¹¶æ²¡æœ‰æ˜ç¡®è¦æ±‚è™šæ‹Ÿæœºå¿…é¡»å¸è½½ç±»ï¼Œç±»çš„å¸è½½æ˜¯å¯é€‰çš„ã€‚ä¸€äº›Javaè™šæ‹Ÿæœºå®ç°å¯èƒ½ä¼šé€‰æ‹©ä¸è¿›è¡Œç±»çš„å¸è½½ï¼Œæˆ–è€…ä»…åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰è¿›è¡Œå¸è½½ã€‚å› æ­¤ï¼Œclassæ–‡ä»¶çš„å¸è½½è¡Œä¸ºå¯èƒ½ä¼šå› ä¸åŒçš„Javaè™šæ‹Ÿæœºå®ç°è€Œæœ‰æ‰€ä¸åŒã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1693116844,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":380102,"user_name":"seker","can_delete":false,"product_type":"c1","uid":1122034,"ip_address":"å¹¿ä¸œ","ucode":"9B705F91355873","user_header":"https://static001.geekbang.org/account/avatar/00/11/1e/f2/453d5f88.jpg","comment_is_top":false,"comment_ctime":1692964111,"is_pvip":false,"replies":[{"id":138447,"content":"å¾ˆå¥½çš„é—®é¢˜ï¼Œé€šè¿‡è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å¹¶ä¸æ˜¯å¸Œæœ›ä½ èƒ½é©¬ä¸Šå¾—åˆ°ä¸€ä¸ªç­”æ¡ˆï¼Œè€Œæ˜¯å¸Œæœ›å¼•å¯¼å¤§å®¶å»æ€è€ƒï¼Œä¸€æ®µä»£ç ä»æˆ‘ä»¬å†™å‡ºæ¥ï¼Œåˆ°çœŸæ­£æ‰§è¡Œç¯èŠ‚ï¼Œè¿˜æœ‰è°æ¥è°æ¥å‚ä¸ï¼Œå¹¶å¸¦æ¥äº†é‚£äº›å½±å“ï¼Œæ¯”å¦‚ç¼–è¯‘å™¨é‡æ’ã€å†…å­˜é‡æ’ã€æŒ‡ä»¤é‡æ’è¿™äº›ï¼Œç­”æ¡ˆæœ¬èº«å¹¶ä¸é‡è¦ï¼Œå¼•å¯¼å¤§å®¶å»æ€è€ƒèƒŒåçš„åŸå› ï¼Œæˆ‘ç†è§£æ‰æ˜¯æ›´é‡è¦çš„","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1366588,"ctime":1693119206,"ip_address":"åŒ—äº¬","comment_id":380102,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100613601,"comment_content":"æ–‡ç¨¿ä¸­çš„ä»£ç ï¼Œå¦‚æœthread1å…ˆæ‰§è¡Œå®Œï¼Œé‚£ä¹ˆç¨‹åºä¼šæ­£å¸¸è¾“å‡º1ã€‚å¦‚æœæ˜¯thread2å…ˆæ‰§è¡Œå®Œï¼Œé‚£ä¹ˆç¨‹åºæ²¡æœ‰ä»»ä½•è¾“å‡ºã€‚ç”±äºå¼•å…¥å¤šçº¿ç¨‹ï¼Œå¯¼è‡´çº¿ç¨‹æ‰§è¡Œå…ˆåé¡ºåºä¸ç¡®å®šå‡ºç°ä¸Šè¿°é—®é¢˜ã€‚\n\nä»ç¨‹åºçš„æ„å›¾çœ‹æ˜¯æƒ³thread1å…ˆå†™ï¼Œthread2å†è¯»ï¼Œé‚£ä¹ˆä¿®æ”¹start()ã€join()é¡ºåºå°±å¯ä»¥é¿å…é—®é¢˜ã€‚å³ä¿®æ”¹ä¸ºï¼š\nthread1.start(); \nthread1.join();\nthread2.start();\nthread2.join();\n\nä½†å¦‚æœæ˜¯writer()å’Œreader()éƒ½æœ‰å¤šä¸ªçº¿ç¨‹è¿›å…¥ï¼Œé‚£å°±æ˜¯å¦å¤–çš„è§£å†³æ–¹æ¡ˆäº†ã€‚\n\næ‰€ä»¥è¿˜æ˜¯æƒ³é—®è€å¸ˆé‚£æ®µä»£ç çš„æ„å›¾æ˜¯ä»€ä¹ˆï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1366588,"avatar":"https://static001.geekbang.org/account/avatar/00/14/da/3c/6ca50139.jpg","nickname":"Arthur king å¾®ä¿¡è¶…ç´šæœƒå“¡","note":"","ucode":"79637F55F0ED85","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":626563,"discussion_content":"å¾ˆå¥½çš„é—®é¢˜ï¼Œé€šè¿‡è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å¹¶ä¸æ˜¯å¸Œæœ›ä½ èƒ½é©¬ä¸Šå¾—åˆ°ä¸€ä¸ªç­”æ¡ˆï¼Œè€Œæ˜¯å¸Œæœ›å¼•å¯¼å¤§å®¶å»æ€è€ƒï¼Œä¸€æ®µä»£ç ä»æˆ‘ä»¬å†™å‡ºæ¥ï¼Œåˆ°çœŸæ­£æ‰§è¡Œç¯èŠ‚ï¼Œè¿˜æœ‰è°æ¥è°æ¥å‚ä¸ï¼Œå¹¶å¸¦æ¥äº†é‚£äº›å½±å“ï¼Œæ¯”å¦‚ç¼–è¯‘å™¨é‡æ’ã€å†…å­˜é‡æ’ã€æŒ‡ä»¤é‡æ’è¿™äº›ï¼Œç­”æ¡ˆæœ¬èº«å¹¶ä¸é‡è¦ï¼Œå¼•å¯¼å¤§å®¶å»æ€è€ƒèƒŒåçš„åŸå› ï¼Œæˆ‘ç†è§£æ‰æ˜¯æ›´é‡è¦çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1693119206,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":380104,"user_name":"seker","can_delete":false,"product_type":"c1","uid":1122034,"ip_address":"å¹¿ä¸œ","ucode":"9B705F91355873","user_header":"https://static001.geekbang.org/account/avatar/00/11/1e/f2/453d5f88.jpg","comment_is_top":false,"comment_ctime":1692965536,"is_pvip":false,"replies":[{"id":138436,"content":"è¿™æ ·ç†è§£æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯æ•´ç¯‡æ•™ç¨‹æˆ‘æƒ³è¡¨è¾¾çš„æ˜¯å¦å¤–ä¸€ç§æ€è€ƒã€‚å»ºè®®å†ä»”ç»†å“å‘³ä¸‹ç¬¬ä¸€ç¯‡ï¼Œå»æ€è€ƒä¸‹è®¡ç®—æœºåˆæ˜¯ä»€ä¹ˆï¼Œä»–çš„å›¾çµæœºæœ¬è´¨ï¼Œæ¢ä¸ªè§†è§’æ¥çœ‹å¾…è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ä¸ªå°æç¤ºï¼Œä¸€åˆ‡çš„æœ¬æºæ˜¯ä¸ºäº†è§£å†³è®¡ç®—çš„é—®é¢˜ï¼Œè€Œè§£å†³è¿™ä¸ªé—®é¢˜æœ‰ä¸¤ä¸ªæ–¹å‘ï¼Œä¸€ä¸ªåé‡äºæ˜¯ä»€ä¹ˆï¼Œå°±æ˜¯é˜¿éš†ä½.é‚±å¥‡çš„lambdaï¼ˆÎ»ï¼‰ï¼Œä¸€ä¸ªæ˜¯å›¾çµçš„å›¾çµæœºï¼Œæ¨èè¯»ä¸€ä¸‹http:&#47;&#47;www.yinwang.org&#47;blog-cn&#47;2013&#47;07&#47;13&#47;church-turingï¼Œæ·±åˆ»ç†è§£è¿™ä¸ªé—®é¢˜ï¼Œä¼šå¯¹ä½ ç†è§£å‡½æ•°å¼ç¼–ç¨‹ï¼Œå¹¶å‘çš„æœ¬è´¨ï¼Œjavaå’Œgoçš„åŒºåˆ«éƒ½å¾ˆæœ‰åŠ©ç›Šçš„ï¼Œæˆ‘ä¹Ÿä¼šåœ¨åé¢ç¬¬å››ç¯‡é‡ç‚¹ä»‹ç»ä¸‹è¿™éƒ¨åˆ†","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1366588,"ctime":1693116225,"ip_address":"åŒ—äº¬","comment_id":380104,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100613601,"comment_content":"JVM å’Œæ™®é€šè®¡ç®—æœºçš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ\n\nè¿™é‡Œçš„æ™®é€šè®¡ç®—æœºæˆ‘ç†è§£å°±æ˜¯ç‰©ç†æœºï¼Œæ˜¯ä¸€ç§ç¡¬ä»¶ã€‚JVMç»ˆç©¶æ˜¯ä¸€ä¸ªè½¯ä»¶ï¼Œä¸è¿‡å¯ä»¥è¿›è¡Œå†…å­˜ç®¡ç†ã€çº¿ç¨‹ç®¡ç†ã€‚åœ¨JVMä¹‹ä¸Šå¯ä»¥è¿è¡ŒJavaåº”ç”¨ç¨‹åºï¼Œä»¥åŠå…¶å®ƒå¯ä»¥ç¼–è¯‘ä¸ºå­—èŠ‚ç çš„ç¼–ç¨‹è¯­è¨€ã€‚å› æ­¤æˆ‘è§‰å¾—JVMæ›´åƒæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„æ“ä½œç³»ç»Ÿï¼Œè€ŒJavaåº”ç”¨ç¨‹åºåˆ™è¿è¡Œåœ¨è¿™ä¸ªè™šæ‹Ÿçš„æ“ä½œç³»ç»Ÿä¹‹ä¸Šã€‚\n\næ²¡æœ‰ç¡¬ä»¶ä½œä¸ºæ”¯æ’‘ï¼Œé‚£ä¹ˆè½¯ä»¶å°†æ— æ³•è¿è¡Œã€‚å› æ­¤è½¯ä»¶å¯¹ç¡¬ä»¶æ˜¯æœ‰ä¾èµ–å…³ç³»çš„ã€‚","like_count":0,"discussions":[{"author":{"id":1366588,"avatar":"https://static001.geekbang.org/account/avatar/00/14/da/3c/6ca50139.jpg","nickname":"Arthur king å¾®ä¿¡è¶…ç´šæœƒå“¡","note":"","ucode":"79637F55F0ED85","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":626550,"discussion_content":"è¿™æ ·ç†è§£æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯æ•´ç¯‡æ•™ç¨‹æˆ‘æƒ³è¡¨è¾¾çš„æ˜¯å¦å¤–ä¸€ç§æ€è€ƒã€‚å»ºè®®å†ä»”ç»†å“å‘³ä¸‹ç¬¬ä¸€ç¯‡ï¼Œå»æ€è€ƒä¸‹è®¡ç®—æœºåˆæ˜¯ä»€ä¹ˆï¼Œä»–çš„å›¾çµæœºæœ¬è´¨ï¼Œæ¢ä¸ªè§†è§’æ¥çœ‹å¾…è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ä¸ªå°æç¤ºï¼Œä¸€åˆ‡çš„æœ¬æºæ˜¯ä¸ºäº†è§£å†³è®¡ç®—çš„é—®é¢˜ï¼Œè€Œè§£å†³è¿™ä¸ªé—®é¢˜æœ‰ä¸¤ä¸ªæ–¹å‘ï¼Œä¸€ä¸ªåé‡äºæ˜¯ä»€ä¹ˆï¼Œå°±æ˜¯é˜¿éš†ä½.é‚±å¥‡çš„lambdaï¼ˆÎ»ï¼‰ï¼Œä¸€ä¸ªæ˜¯å›¾çµçš„å›¾çµæœºï¼Œæ¨èè¯»ä¸€ä¸‹http://www.yinwang.org/blog-cn/2013/07/13/church-turingï¼Œæ·±åˆ»ç†è§£è¿™ä¸ªé—®é¢˜ï¼Œä¼šå¯¹ä½ ç†è§£å‡½æ•°å¼ç¼–ç¨‹ï¼Œå¹¶å‘çš„æœ¬è´¨ï¼Œjavaå’Œgoçš„åŒºåˆ«éƒ½å¾ˆæœ‰åŠ©ç›Šçš„ï¼Œæˆ‘ä¹Ÿä¼šåœ¨åé¢ç¬¬å››ç¯‡é‡ç‚¹ä»‹ç»ä¸‹è¿™éƒ¨åˆ†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1693116226,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":379926,"user_name":"ä¸´é£","can_delete":false,"product_type":"c1","uid":1145430,"ip_address":"å¹¿ä¸œ","ucode":"59A7F3DDD94D76","user_header":"https://static001.geekbang.org/account/avatar/00/11/7a/56/29877cb9.jpg","comment_is_top":false,"comment_ctime":1692721175,"is_pvip":true,"replies":[{"id":138448,"content":"ä½ çš„æ€è€ƒå¾ˆèµï¼Œå…¶å®é€šè¿‡è¿™ä¸ªä¾‹å­æˆ‘æ˜¯æƒ³è®©å¤§å®¶å»æ€è€ƒæˆ‘ä»¬å†™çš„ä»£ç ï¼Œåœ¨çœŸæ­£æ‰§è¡Œçš„æ—¶å€™è¿˜æœ‰è°å‚ä¸ï¼Œå¦‚ä½•å‚ä¸ï¼ŒèƒŒååŸç†æ˜¯ä»€ä¹ˆï¼Œå»æœ‰æ•´ä½“åŒ–çš„æ€è€ƒï¼Œè¿™æ ·æ‰èƒ½æ›´å¥½åœ°çœ‹æ¸…æ¥šæœªæ¥çš„å˜åŒ–","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1366588,"ctime":1693119522,"ip_address":"åŒ—äº¬","comment_id":379926,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100613601,"comment_content":"é—®é¢˜1ï¼šå¯¹äºè¿™æ®µä»£ç ï¼Œå­˜åœ¨ä¸¤ä¸ªé—®é¢˜ã€‚\n1.joinçš„ä½œç”¨æ˜¯ç­‰å¾…çº¿ç¨‹æ‰§è¡Œç»“æŸï¼Œå†ç»§ç»­å¾€åæ‰§è¡Œï¼Œä½†thread2å·²ç»startäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬æ²¡åŠæ³•ä¿è¯thread1å’Œthread2è°å…ˆæ‰§è¡Œï¼Œflagæ˜¾ç„¶æ˜¯ä¸èƒ½ä¿è¯ä»£ç æ‰§è¡Œçš„å…ˆåé¡ºåºçš„ï¼Œå¯ä»¥é€šè¿‡ä¿¡å·é‡æˆ–è€…CountDownLatchæ¥è§£å†³ï¼ˆæš‚æ—¶åªæƒ³åˆ°äº†è¿™ä¸¤ä¸ªï¼Œä¸çŸ¥é“è¿˜æœ‰æ²¡ç”¨åˆ«çš„æ›´å¥½çš„æ–¹å¼ï¼‰ã€‚\n2.å˜é‡aç¼ºä¹volatileä¿®é¥°ï¼Œä¸¤ä¸ªå¯èƒ½çº¿ç¨‹ä¼šè¯»å–å„è‡ªçº¿ç¨‹ä¸­çš„å€¼ï¼Œå¯¼è‡´readeræ‰§è¡Œçš„æ—¶å€™å–çš„è¿˜æ˜¯0ã€‚\n\né—®é¢˜2ï¼š\njvmå°±æ˜¯å¯¹æ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶èµ„æºçš„æŠ½è±¡å°è£…ï¼Œè®©ä½ æ— éœ€è€ƒè™‘æ˜¯x86è¿˜æ˜¯armçš„CPUï¼Œä¹Ÿä¸ç”¨ç®¡æ˜¯windowæ˜¯è¿˜æ˜¯Linuxçš„æ“ä½œç³»ç»Ÿï¼Œå®ç°äº†ä¸€æ¬¡ç¼–è¯‘åˆ°å¤„è¿è¡Œã€‚æœ¬è´¨å°±æ˜¯è®©ä½ åªå…³æ³¨è‡ªå·±çš„ä»£ç é€»è¾‘ï¼Œè€Œä¸ç”¨è€ƒè™‘åº•å±‚ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„åŒºåˆ«ï¼Œä½†å®é™…ä¸Šè¿™äº›äº‹æƒ…è¿˜æ˜¯å¾—æœ‰äººåšçš„ï¼Œåªä¸è¿‡æ˜¯jvmæ›¿ä½ åšäº†ï¼Œè¿™ä¹Ÿå°±å¯¼è‡´äº†ä¸€å®šç¨‹åº¦ä¸Šçš„æ€§èƒ½æŸè€—ã€‚ä½†äº‘åŸç”Ÿæ—¶ä»£çš„åˆ°äº†ï¼Œdockerçš„æ™®åŠï¼Œå› ä¸ºå·²ç»å¯¹è¿è¡Œç¯å¢ƒåšäº†ä¸€å±‚å°è£…ï¼Œå¤§å®¶éƒ½æ˜¯æ‰§è¡Œé•œåƒï¼Œå¯¼è‡´Javaçš„ä¼˜åŠ¿ä¹Ÿå°±è¡ç„¶æ— å­˜äº†ï¼Œåè€Œå› ä¸ºå…¶éœ€è¦æ”¯æŒè¿è¡Œæ—¶çš„é—®é¢˜ï¼Œå¯åŠ¨æœåŠ¡ç¼“æ…¢ï¼Œæ— æ³•å®ç°ç§’çº§çš„æ‰©ç¼©å®¹è€Œä¸¾æ­¥ç»´è‰°ã€‚è¿™äº›å°±æ˜¯æˆ‘çš„ä¸€äº›æµ…è–„çš„è®¤è¯†ï¼Œå¸Œæœ›ä¹‹åè·Ÿç€è€å¸ˆèƒ½åŠ æ·±å¯¹äº‘åŸç”Ÿæ—¶ä»£Javaçš„ç†è§£ã€‚\n\né™„é—®é¢˜1çš„ä»£ç ï¼š\npublic class Demo {\n    private volatile int a = 0;\n    private final Semaphore semaphore = new Semaphore(1);\n\n    public void writer() {\n        a = 1;\n        semaphore.release();\n    }\n\n    public void reader() {\n        try {\n            semaphore.acquire();\n        } catch (InterruptedException e) {\n            throw new RuntimeException(e);\n        }\n        int i = a * a;\n        System.out.println(i);\n    }\n\n    public static void main(String[] args) throws InterruptedException {\n        final Demo example = new Demo();\n        Thread thread1 = new Thread(() -&gt; example.writer());\n        Thread thread2 = new Thread(() -&gt; example.reader());\n        thread1.start();\n        thread2.start();\n        thread1.join();\n        thread2.join();\n    }\n}","like_count":0,"discussions":[{"author":{"id":1366588,"avatar":"https://static001.geekbang.org/account/avatar/00/14/da/3c/6ca50139.jpg","nickname":"Arthur king å¾®ä¿¡è¶…ç´šæœƒå“¡","note":"","ucode":"79637F55F0ED85","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":626564,"discussion_content":"ä½ çš„æ€è€ƒå¾ˆèµï¼Œå…¶å®é€šè¿‡è¿™ä¸ªä¾‹å­æˆ‘æ˜¯æƒ³è®©å¤§å®¶å»æ€è€ƒæˆ‘ä»¬å†™çš„ä»£ç ï¼Œåœ¨çœŸæ­£æ‰§è¡Œçš„æ—¶å€™è¿˜æœ‰è°å‚ä¸ï¼Œå¦‚ä½•å‚ä¸ï¼ŒèƒŒååŸç†æ˜¯ä»€ä¹ˆï¼Œå»æœ‰æ•´ä½“åŒ–çš„æ€è€ƒï¼Œè¿™æ ·æ‰èƒ½æ›´å¥½åœ°çœ‹æ¸…æ¥šæœªæ¥çš„å˜åŒ–","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1693119523,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":379880,"user_name":"edward","can_delete":false,"product_type":"c1","uid":1604798,"ip_address":"æ¹–å—","ucode":"09F7A5B8D2E7BD","user_header":"","comment_is_top":false,"comment_ctime":1692662600,"is_pvip":false,"replies":[{"id":138423,"content":"è°¢è°¢å¤¸å¥–ï¼Œå¸Œæœ›æœ€åä½ ä¹Ÿå¯ä»¥ç»˜åˆ¶å‡ºè‡ªå·±çš„çŸ¥è¯†åœ°å›¾\n","user_name":"ç¼–è¾‘å›å¤","user_name_real":"ç¼–è¾‘","uid":2843479,"ctime":1692929198,"ip_address":"åŒ—äº¬","comment_id":379880,"utype":2}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100613601,"comment_content":"æœ€åè¿™å¼ å›¾å¾ˆèµğŸ‘","like_count":0,"discussions":[{"author":{"id":2843479,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/63/57/cba4c68b.jpg","nickname":"å°è™å­ğŸ¯","note":"","ucode":"4C9530B3FB407B","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":626450,"discussion_content":"è°¢è°¢å¤¸å¥–ï¼Œå¸Œæœ›æœ€åä½ ä¹Ÿå¯ä»¥ç»˜åˆ¶å‡ºè‡ªå·±çš„çŸ¥è¯†åœ°å›¾\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1692929198,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":8}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":379873,"user_name":"ç å°å‘†","can_delete":false,"product_type":"c1","uid":2055809,"ip_address":"å¹¿ä¸œ","ucode":"44532D6ABF9340","user_header":"https://static001.geekbang.org/account/avatar/00/1f/5e/81/82709d6e.jpg","comment_is_top":false,"comment_ctime":1692631113,"is_pvip":false,"replies":[{"id":138424,"content":"æ˜¯çš„ï¼Œå®ƒçš„æœ¬è´¨å°±æ˜¯å·¥å…·ï¼Œä¸è¿‡å¦‚ä½•ç”¨å¥½è¿™ä¸ªå·¥å…·å¯æ˜¯æœ‰å¤§å­¦é—®å“¦ï½æ¬¢è¿äº¤æµï¼","user_name":"ç¼–è¾‘å›å¤","user_name_real":"ç¼–è¾‘","uid":2843479,"ctime":1692929274,"ip_address":"åŒ—äº¬","comment_id":379873,"utype":2}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100613601,"comment_content":"jvm å¯¹äºè®¡ç®—æœºæ¥è¯´,åªèƒ½ç®—æ˜¯ä¸€ä¸ªä¸­é—´ä»¶å·¥å…·,ç”¨äºæŠŠå­—èŠ‚ç ç¿»è¯‘æˆè®¡ç®—æœºèƒ½è¯†åˆ«çš„æœºå™¨ç è€Œå·²!","like_count":0,"discussions":[{"author":{"id":2843479,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/63/57/cba4c68b.jpg","nickname":"å°è™å­ğŸ¯","note":"","ucode":"4C9530B3FB407B","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":626451,"discussion_content":"æ˜¯çš„ï¼Œå®ƒçš„æœ¬è´¨å°±æ˜¯å·¥å…·ï¼Œä¸è¿‡å¦‚ä½•ç”¨å¥½è¿™ä¸ªå·¥å…·å¯æ˜¯æœ‰å¤§å­¦é—®å“¦ï½æ¬¢è¿äº¤æµï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1692929274,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":8}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":379859,"user_name":"Calvin","can_delete":false,"product_type":"c1","uid":1603004,"ip_address":"å¹¿ä¸œ","ucode":"0EEF5B207623B5","user_header":"https://static001.geekbang.org/account/avatar/00/18/75/bc/89d88775.jpg","comment_is_top":false,"comment_ctime":1692623184,"is_pvip":false,"replies":[{"id":138442,"content":"æ²¡é—®é¢˜ï¼Œæƒ³äº†è§£ä»€ä¹ˆï¼Œéƒ½å¯ä»¥ç¾¤é‡Œæå‡ºæ¥ï¼Œå¸Œæœ›èƒ½è®©ä½ æœ‰çœŸæ­£çš„æ”¶è·","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1366588,"ctime":1693116936,"ip_address":"åŒ—äº¬","comment_id":379859,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100613601,"comment_content":"ç»™å¤§ä½¬ç‚¹èµ666ï¼ŒæœŸå¾…åŠæ¡¶æ°´çš„è‡ªå·±å­¦ä¹ è¿™ä¸ªè¯¾ç¨‹åèƒ½æŸ¥æ¼è¡¥ç¼ºåº•å±‚çŸ¥è¯†æ›´ç²¾è¿›ä¸€äº›ï¼ŒPSï¼šJVM è™šæ‹Ÿæœºç±»æ¯”çœŸå®çš„è®¡ç®—æœºä¹‹å‰æˆ‘æ€ä¹ˆæ²¡æƒ³åˆ°å‘¢ï¼ŸğŸ˜‚\n\nå¦å¤–æˆ‘çœ‹æ€è€ƒé¢˜æœ‰æåˆ°Threadçº¿ç¨‹ï¼Œè€Œ JDK 21 ä¸‹ä¸ªæœˆå°±è¦ GA äº†ï¼Œåˆ°æ—¶â€œè™šæ‹Ÿçº¿ç¨‹â€ï¼ˆåç¨‹ï¼‰å°±æ­£å¼å¯ç”¨äº†ï¼Œä¸çŸ¥é“åˆ©ç”¨å…¶ç»“æ„åŒ–ç¼–ç¨‹èƒ½åŠ›èƒ½å¦å®ç°ä¼˜åŒ–å®ƒçš„ç›®çš„ï¼Ÿ\n\nä»¥åŠå¤§ä½¬ä¼šå¦è€ƒè™‘åœ¨åé¢çš„ç« èŠ‚ä¸­æ·»åŠ ç›¸å…³çš„çŸ¥è¯†ç‚¹æˆ–è€…åŠ é¤ä»‹ç»ä¸€ä¸‹è¿™ä¸ªæ–°ç‰¹æ€§å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1366588,"avatar":"https://static001.geekbang.org/account/avatar/00/14/da/3c/6ca50139.jpg","nickname":"Arthur king å¾®ä¿¡è¶…ç´šæœƒå“¡","note":"","ucode":"79637F55F0ED85","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":626556,"discussion_content":"æ²¡é—®é¢˜ï¼Œæƒ³äº†è§£ä»€ä¹ˆï¼Œéƒ½å¯ä»¥ç¾¤é‡Œæå‡ºæ¥ï¼Œå¸Œæœ›èƒ½è®©ä½ æœ‰çœŸæ­£çš„æ”¶è·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1693116936,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":379855,"user_name":"è½»é£æ‚ æ‰¬","can_delete":false,"product_type":"c1","uid":1319215,"ip_address":"æ¾³å¤§åˆ©äºš","ucode":"F2276CE113BED1","user_header":"https://static001.geekbang.org/account/avatar/00/14/21/2f/b29e8af8.jpg","comment_is_top":false,"comment_ctime":1692619508,"is_pvip":false,"replies":[{"id":138444,"content":"æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯volatileçš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Œä»–æ˜¯å¦‚ä½•åšåˆ°çš„ï¼Œvolatileå’Œraftåè®®æœ‰ä»€ä¹ˆå…³ç³»ï¼Œå…¶å®ä¹Ÿæ˜¯å¯ä»¥å»æ€è€ƒä¸€ä¸‹çš„","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1366588,"ctime":1693117062,"ip_address":"åŒ—äº¬","comment_id":379855,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100613601,"comment_content":"flagåº”è¯¥ç”¨volatileæ¥ä¿®é¥°ä»¥ç¡®ä¿å¯¹å…¶ä»–çº¿ç¨‹å¯è§ã€‚","like_count":0,"discussions":[{"author":{"id":1366588,"avatar":"https://static001.geekbang.org/account/avatar/00/14/da/3c/6ca50139.jpg","nickname":"Arthur king å¾®ä¿¡è¶…ç´šæœƒå“¡","note":"","ucode":"79637F55F0ED85","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":626558,"discussion_content":"æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯volatileçš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Œä»–æ˜¯å¦‚ä½•åšåˆ°çš„ï¼Œvolatileå’Œraftåè®®æœ‰ä»€ä¹ˆå…³ç³»ï¼Œå…¶å®ä¹Ÿæ˜¯å¯ä»¥å»æ€è€ƒä¸€ä¸‹çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1693117063,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":379864,"user_name":"è€è¡²","can_delete":false,"product_type":"c1","uid":1433290,"ip_address":"å¹¿ä¸œ","ucode":"B02BB107DB51BE","user_header":"https://static001.geekbang.org/account/avatar/00/15/de/ca/73f15fe7.jpg","comment_is_top":false,"comment_ctime":1692626990,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100613601,"comment_content":"public class Demo {\n    private AtomicInteger a = new AtomicInteger(0);\n    private volatile boolean flag = false;\n\n    public void writer() {\n        a = new AtomicInteger(1);\n        flag = true;\n    }\n\n    public void reader() {\n        if (flag) {\n            int i = a.get() * a.get();\n            System.out.println(i);\n        }\n    }\n\n    public static void main(String[] args) throws InterruptedException {\n        final Demo example = new Demo();\n        Thread thread1 = new Thread(example::writer);\n        Thread thread2 = new Thread(example::reader);\n        thread1.start();\n        thread2.start();\n        thread1.join();\n        thread2.join();\n    }\n}","like_count":1,"discussions":[{"author":{"id":1122034,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1e/f2/453d5f88.jpg","nickname":"seker","note":"","ucode":"9B705F91355873","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":626481,"discussion_content":"æ„Ÿè°¢åˆ†äº«ï¼Œä¸è¿‡éªŒè¯äº†ä¸‹ä½ çš„ä»£ç ï¼Œå¤šæ‰§è¡Œå‡ æ¬¡çš„æƒ…å†µä¸‹è¿˜æ˜¯ä¼šå‡ºç°é—®é¢˜ã€‚\n\nå¯åŠ¨thread1å’Œthread2ï¼Œä½†æ‰§è¡Œå…ˆåé¡ºåºæ˜¯æ²¡æœ‰åŠæ³•ä¿éšœçš„ï¼Œä¸€æ—¦thread2å…ˆæ‰§è¡Œï¼Œè™½ç„¶flagæœ‰volatileä¿®é¥°ï¼Œä½†æ˜¯ç”±äºthread1è¿˜æ²¡å¼€å§‹å†™ï¼Œæ­¤æ—¶thread2è¯»åˆ°çš„flagå€¼ä¾ç„¶æ˜¯falseï¼Œä¼šå¯¼è‡´æ²¡æœ‰ä»»ä½•è¾“å‡ºã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1692964277,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":381534,"user_name":"ZYJ","can_delete":false,"product_type":"c1","uid":2130546,"ip_address":"æ¹–åŒ—","ucode":"9B4F2A03754D0A","user_header":"https://static001.geekbang.org/account/avatar/00/20/82/72/e6a56c30.jpg","comment_is_top":false,"comment_ctime":1695352587,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100613601,"comment_content":"æ€è€ƒé¢˜:\n1,å¦‚æœæƒ³è®©ç¨‹åºè¾“å‡º1,åªéœ€è¦è°ƒæ•´thread1.join()çš„é¡ºåº,è®©ä¸»çº¿ç¨‹ç­‰å¾…thread1æ‰§è¡Œå®Œå†start t2çº¿ç¨‹\n2,joinçš„åŸç†æ˜¯,ä¸»çº¿ç¨‹è°ƒç”¨thread1.join()æ—¶,joiné‡Œä¼šè°ƒç”¨waitæ–¹æ³•ä½¿ä¸»çº¿ç¨‹ç­‰å¾…, ç­‰thread1æ‰§è¡Œå®Œåæ‰ä¼šå”¤é†’ä¸»çº¿ç¨‹(runæ–¹æ³•é‡Œ,æœ€ç»ˆä¼šnotifyAllå”¤é†’ä¸»çº¿ç¨‹)\n3,æ­¤æ—¶ä¸¤ä¸ªçº¿ç¨‹å…¶å®æ˜¯ä¸²è”æ‰§è¡Œ,æ²¡æœ‰å¹¶å‘é—®é¢˜, ä½†æ˜¯å¦‚æœæ˜¯å¤šä¸ªçº¿ç¨‹çš„è¯, éœ€è¦ç»™å…±äº«å˜é‡åŠ ä¸Švolatileä¿è¯å¯è§æ€§(åŸç†:å˜é‡è¯»å–å’Œå†™å…¥å‰ååŠ å…¥å†…å­˜å±éšœ,ä¿è¯åˆ·æ–°åˆ°ä¸»å†…å­˜)\nç–‘é—®:\nè€å¸ˆåœ¨ä¸‹é¢è¯„è®ºé‡Œæåˆ°çš„volatileå’ŒRaftåè®®çš„å…³ç³»å…·ä½“æŒ‡çš„æ˜¯ä»€ä¹ˆ?\n\nfinal Demo example = new Demo();\n Thread thread1 = new Thread(() -&gt; example.writer()); \nThread thread2 = new Thread(() -&gt; example.reader()); \nthread1.start(); \nthread1.join(); \nthread2.start(); \nthread2.join();","like_count":0},{"had_liked":false,"id":380712,"user_name":"on","can_delete":false,"product_type":"c1","uid":2869085,"ip_address":"ä¸Šæµ·","ucode":"D0B59D9F0FC209","user_header":"https://static001.geekbang.org/account/avatar/00/2b/c7/5d/40bdba38.jpg","comment_is_top":false,"comment_ctime":1694045438,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100613601,"comment_content":"æ–‡ä¸­æŒ‡å‡ºçš„é‡æ’çš„ä¾‹å­ä¸æ˜¯å¾ˆå¥½å§ã€‚ä»–å®é™…å’Œcpuçº¿ç¨‹è°ƒåº¦å…³ç³»æ›´å¤§ç‚¹ï¼ŒæŒ‡ä»¤é‡æ’ä½“ç°ä¸å‡ºæ¥","like_count":0},{"had_liked":false,"id":380039,"user_name":"é›·å°é¸¿","can_delete":false,"product_type":"c1","uid":1368897,"ip_address":"é™•è¥¿","ucode":"424DC9A532FFD7","user_header":"https://static001.geekbang.org/account/avatar/00/14/e3/41/bd0e3a04.jpg","comment_is_top":false,"comment_ctime":1692872568,"is_pvip":true,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100613601,"comment_content":"å…¶å® æˆ‘çœ‹åˆ°è¿™æ®µä»£ç ï¼Œæ²¡æƒ³è¦æ€ä¹ˆå»æ”¹ï¼Œæˆ‘å†æƒ³ä»€ä¹ˆæƒ…å†µä¸‹ï¼Œä»€ä¹ˆä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œä¼šè¿™æ ·å†™ä»£ç ï¼Œæˆ‘è‡ªå·±åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä¼šè¿™æ ·å†™ï¼Œå¯¹äºæˆ‘ä»¬è¿™ç§ä¸šåŠ¡å°çš„å…¬å¸å¾ˆéš¾å†å®é™…å¼€å‘ä¸­è¿™æ ·å»å†™ã€‚","like_count":0,"discussions":[{"author":{"id":1366588,"avatar":"https://static001.geekbang.org/account/avatar/00/14/da/3c/6ca50139.jpg","nickname":"Arthur king å¾®ä¿¡è¶…ç´šæœƒå“¡","note":"","ucode":"79637F55F0ED85","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":626562,"discussion_content":"å…¶å®æˆ‘ç†è§£ç°å®ä¸šåŠ¡åœºæ™¯æ˜¯å¦æœ‰è¿™ç§éœ€è¦å¹¶ä¸é‡è¦ï¼Œå› ä¸ºæˆ‘ä»¬æœ¬èº«å°±æ˜¯ä¸æ–­æˆé•¿ä¸æ–­å»æŒ‘æˆ˜æ›´é«˜çš„éš¾åº¦ï¼Œå»æ›´å¤§çš„å¹³å°çš„è¿‡ç¨‹ï¼Œå°±åƒå…ˆæœ‰é¸¡è¿˜æ˜¯å…ˆæœ‰è›‹ä¸€æ ·ï¼Œå€ŸåŠ©è¿™ä¸ªé—®é¢˜å»æ€è€ƒä»–èƒŒåçš„æœ¬è´¨å½¢æˆè‡ªå·±çš„çŸ¥è¯†ä½“ç³»æ‰æ˜¯æœ€é‡è¦çš„ï¼Œè€Œä¸æ˜¯ä¸€æ®µä»£ç æ˜¯å¦å†™çš„ä¼˜é›…ï¼Œæœ‰ç‚¹å€Ÿå‡ä¿®çœŸçš„å‘³é“","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1693117891,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}