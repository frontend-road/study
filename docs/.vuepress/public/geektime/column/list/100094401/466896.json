{"id":466896,"title":"23 | 弹窗：如何设计一个弹窗组件？","content":"<p>你好，我是大圣。</p><p>上一讲我们剖析了表单组件的实现模式，相信学完之后，你已经掌握了表单类型组件设计的细节，表单组件的主要功能就是在页面上获取用户的输入。</p><p>不过，用户在交互完成之后，还需要知道交互的结果状态，这就需要我们提供专门用来反馈操作状态的组件。这类组件根据反馈的级别不同，也分成了很多种类型，比如全屏灰色遮罩、居中显示的对话框Dialog，在交互按钮侧面显示、用来做简单提示的tooltip，以及右上角显示信息的通知组件Notification等，这类组件的交互体验你都可以在<a href=\"https://e3.shengxinjing.cn/#\">Element3官网</a>感受。</p><p>今天的代码也会用Element3的Dialog组件和Notification进行举例，在动手写代码实现之前，我们先从这个弹窗组件的需求开始说起。</p><h2>组件需求分析</h2><p>我们先来设计一下要做的组件，通过这部分内容，还可以帮你继续加深一下对单元测试Jest框架的使用熟练度。我建议你在设计一个新的组件的时候，也试试采用这种方式，先把组件所有的功能都罗列出来，分析清楚需求再具体实现，这样能够让你后面的工作事半功倍。</p><p>首先无论是对话框Dialog，还是消息弹窗Notification，它们都由一个弹窗的标题，以及具体的弹窗的内容组成的。我们希望弹窗有一个关闭的按钮，点击之后就可以关闭弹窗，弹窗关闭之后还可以设置回调函数。</p><!-- [[[read_end]]] --><p>下面这段代码演示了dialog组件的使用方法，通过title显示标题，通过slot显示文本内容和交互按钮，而通过v-model就能控制显示状态。</p><pre><code class=\"language-typescript\">&lt;el-dialog\n  title=\"提示\"\n  :visible.sync=\"dialogVisible\"\n  width=\"30%\"\n  v-model:visible=\"dialogVisible\"\n&gt;\n  &lt;span&gt;这是一段信息&lt;/span&gt;\n  &lt;template #footer&gt;\n    &lt;span class=\"dialog-footer\"&gt;\n      &lt;el-button @click=\"dialogVisible = false\"&gt;取 消&lt;/el-button&gt;\n      &lt;el-button type=\"primary\" @click=\"dialogVisible = false\"&gt;确 定&lt;/el-button&gt;\n    &lt;/span&gt;\n  &lt;/template&gt;\n&lt;/el-dialog&gt;\n</code></pre><p>这类组件实现起来和表单类组件区别不是特别大，我们首先需要做的就是<strong>控制好组件的数据传递</strong>，并且使用Teleport渲染到页面顶层的body标签。</p><p>像Dialog和Notification类的组件，我们只是单纯想显示一个提示或者报错信息，过几秒就删除，如果在每个组件内部都需要写一个&lt;Dialog v-if&gt;，并且使用v-if绑定变量的方式控制显示就会显得很冗余。</p><p>所以，这里就要用到一种调用Vue组件的新方式：我们可以使用JavaScript的API动态地创建和渲染Vue的组件。具体如何实现呢？我们以Notification组件为例一起看一下。</p><p>下面的代码是Element3的Notification演示代码。组件内部只有两个button，我们不需要书写额外的组件标签，只需要在&lt;script setup&gt;中使用Notification.success\b函数，就会在页面动态创建Notification组件，并且显示在页面右上角。</p><pre><code class=\"language-xml\">&lt;template&gt;\n  &lt;el-button plain @click=\"open1\"&gt; 成功 &lt;/el-button&gt;\n  &lt;el-button plain @click=\"open2\"&gt; 警告 &lt;/el-button&gt;\n&lt;/template&gt;\n&lt;script setup&gt;\n  import { Notification } from 'element3'\n\n  function open1() {\n    Notification.success({\n      title: '成功',\n      message: '这是一条成功的提示消息',\n      type: 'success'\n    })\n  }\n  function open2() {\n    Notification.warning({\n      title: '警告',\n      message: '这是一条警告的提示消息',\n      type: 'warning'\n    })\n  }\n\n\n&lt;/script&gt;\n</code></pre><h2>弹窗组件实现</h2><p>分析完需求之后，我们借助单元测试的方法来实现这个弹窗组件（单元测试的内容如果记不清了，你可以回顾<a href=\"https://time.geekbang.org/column/article/464098\">第20讲</a>）。</p><p>我们依次来分析Notification的代码，相比于写Demo逻辑的代码，这次我们体验一下实际的组件和演示组件的区别。我们来到element3下面的src/components/Notification/notifucation.vue代码中，下面的代码构成了组件的主体框架，我们不去直接写组件的逻辑，而是先从测试代码来梳理组件的功能。</p><pre><code class=\"language-xml\">&lt;template&gt;\n  &lt;div class=\"el-nofication\"&gt;\n    &lt;slot /&gt;\n  &lt;/div&gt;\n&lt;/template&gt;\n\n&lt;script&gt;\n\n&lt;/script&gt;\n\n&lt;style lang=\"scss\"&gt;\n@import '../styles/mixin';\n\n&lt;/style&gt;\n</code></pre><p>结合下面的代码可以看到，我们进入到了内部文件Notification.spec.js中。下面的测试代码中，我们期待Notification组件能够渲染el-notification\b样式类，并且内部能够通过属性title渲染标题；message属性用来渲染消息主体；position用来渲染组件的位置，让我们的弹窗组件可以显示在浏览器四个角。</p><pre><code class=\"language-xml\">import Notification from \"./Notification.vue\"\nimport { mount } from \"@vue/test-utils\"\n\ndescribe(\"Notification\", () =&gt; { \n  \n  it('渲染标题title', () =&gt; {\n    const title = 'this is a title'\n    const wrapper = mount(Notification, {\n      props: {\n        title\n      }\n    })\n    expect(wrapper.get('.el-notification__title').text()).toContain(title)\n  })\n\n  it('信息message渲染', () =&gt; {\n    const message = 'this is a message'\n    const wrapper = mount(Notification, {\n      props: {\n        message\n      }\n    })\n    expect(wrapper.get('.el-notification__content').text()).toContain(message)\n  })\n\n  it('位置渲染', () =&gt; {\n    const position = 'bottom-right'\n    const wrapper = mount(Notification, {\n      props: {\n        position\n      }\n    })\n    expect(wrapper.find('.el-notification').classes()).toContain('right')\n    expect(wrapper.vm.verticalProperty).toBe('bottom')\n    expect(wrapper.find('.el-notification').element.style.bottom).toBe('0px')\n  })\n\n  it('位置偏移', () =&gt; {\n    const verticalOffset = 50\n    const wrapper = mount(Notification, {\n      props: {\n        verticalOffset\n      }\n    })\n    expect(wrapper.vm.verticalProperty).toBe('top')\n    expect(wrapper.find('.el-notification').element.style.top).toBe(\n      `${verticalOffset}px`\n    )\n  })\n\n})\n\n</code></pre><p>这时候毫无疑问，测试窗口会报错。我们需要进入notificatin.vue中实现代码逻辑。<br>\n下面的代码中，我们在代码中接收title、message和position，使用notification__title和notification__message渲染标题和消息。</p><pre><code class=\"language-xml\">&lt;template&gt;\n  &lt;div class=\"el-notification\" :style=\"positionStyle\" @click=\"onClickHandler\"&gt;\n    &lt;div class=\"el-notification__title\"&gt;\n      {{ title }}\n    &lt;/div&gt;\n\n    &lt;div class=\"el-notification__message\"&gt;\n      {{ message }}\n    &lt;/div&gt;\n\n    &lt;button\n      v-if=\"showClose\"\n      class=\"el-notification__close-button\"\n      @click=\"onCloseHandler\"\n    &gt;&lt;/button&gt;\n  &lt;/div&gt;\n&lt;/template&gt;\n&lt;script setup&gt;\nconst instance = getCurrentInstance()\nconst visible = ref(true)\nconst verticalOffsetVal = ref(props.verticalOffset)\n\nconst typeClass = computed(() =&gt; {\n  return props.type ? `el-icon-${props.type}` : ''\n})\n\nconst horizontalClass = computed(() =&gt; {\n  return props.position.endsWith('right') ? 'right' : 'left'\n})\n\nconst verticalProperty = computed(() =&gt; {\n  return props.position.startsWith('top') ? 'top' : 'bottom'\n})\n\nconst positionStyle = computed(() =&gt; {\n  return {\n    [verticalProperty.value]: `${verticalOffsetVal.value}px`\n  }\n})\n&lt;/script&gt;\n\n&lt;style lang=\"scss\"&gt;\n.el-notification {\n  position: fixed;\n  right: 10px;\n  top: 50px;\n  width: 330px;\n  padding: 14px 26px 14px 13px;\n  border-radius: 8px;\n  border: 1px solid #ebeef5;\n  background-color: #fff;\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\n  overflow: hidden;\n}\n&lt;/style&gt;\n</code></pre><p>然后我们新增测试代码，设置弹窗是否显示关闭按钮以及关闭弹窗之后的回调函数。我们希望点击关闭按钮之后，就能够正确执行传入的onClose函数。</p><pre><code class=\"language-javascript\">it('set the showClose ', () =&gt; {\n    const showClose = true\n    const wrapper = mount(Notification, {\n      props: {\n        showClose\n      }\n    })\n    expect(wrapper.find('.el-notification__closeBtn').exists()).toBe(true)\n    expect(wrapper.find('.el-icon-close').exists()).toBe(true)\n  })\n\n  it('点击关闭按钮', async () =&gt; {\n    const showClose = true\n    const wrapper = mount(Notification, {\n      props: {\n        showClose\n      }\n    })\n    const closeBtn = wrapper.get('.el-notification__closeBtn')\n    await closeBtn.trigger('click')\n    expect(wrapper.get('.el-notification').isVisible()).toBe(false)\n  })\n\n  it('持续时间之后自动管理', async () =&gt; {\n    jest.useFakeTimers()\n\n    const wrapper = mount(Notification, {\n      props: {\n        duration: 1000\n      }\n    })\n    jest.runTimersToTime(1000)\n    await flushPromises()\n    expect(wrapper.get('.el-notification').isVisible()).toBe(false)\n     })\n</code></pre><p>到这里，Notification组件测试的主体逻辑就实现完毕了，我们拥有了一个能够显示在右上角的组件，具体效果你可以参考后面这张截图。</p><p><img src=\"https://static001.geekbang.org/resource/image/aa/04/aa1506d30d0b4d641aa7175c2a4a5004.jpg?wh=1920x972\" alt=\"图片\"></p><p>进行到这里，距离完成整体设计我们还差两个步骤。</p><p>首先，弹窗类的组件都需要直接渲染在body标签下面，弹窗类组件由于布局都是绝对定位，如果在组件内部渲染，组件的css属性（比如Transform）会影响弹窗组件的渲染样式，为了避免这种问题重复出现，弹窗组件Dialog、Notification都需要渲染在body内部。</p><p>Dialog组件可以直接使用Vue3自带的Teleport，很方便地渲染到body之上。在下面的代码中, 我们用teleport组件把dialog组件包裹之后，通过to属性把dialog渲染到body标签内部。</p><pre><code class=\"language-javascript\">  &lt;teleport\n    :disabled=\"!appendToBody\"\n    to=\"body\"\n  &gt;\n    &lt;div class=\"el-dialog\"&gt;\n      &lt;div class=\"el-dialog__content\"&gt;\n        &lt;slot /&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n  &lt;/teleport&gt;\n</code></pre><p>这时我们使用浏览器调试窗口，就可以看到Dialog标签已经从当前组件移动到了body标签内部，如下图所示。</p><p><img src=\"https://static001.geekbang.org/resource/image/d9/61/d9199199590871f811309f4c78963761.jpg?wh=1920x902\" alt=\"图片\"></p><p>但是Notification组件并不会在当前组件以组件的形式直接调用，我们需要像Element3一样，能够使用js函数动态创建Notification组件，<strong>给Vue的组件提供Javascript的动态渲染方法，这是弹窗类组件的特殊需求</strong>。</p><h2>组件渲染优化</h2><p>我们先把测试代码写好，具体如下。代码中分别测试函数创建组件，以及不同配置和样式的通知组件。</p><pre><code class=\"language-xml\">it('函数会创建组件', () =&gt; {\n  const instanceProxy = Notification('foo')\n  expect(instanceProxy.close).toBeTruthy()\n})\n\nit('默认配置 ', () =&gt; {\n  const instanceProxy = Notification('foo')\n\n  expect(instanceProxy.$props.position).toBe('top-right')\n  expect(instanceProxy.$props.message).toBe('foo')\n  expect(instanceProxy.$props.duration).toBe(4500)\n  expect(instanceProxy.$props.verticalOffset).toBe(16)\n})\ntest('字符串信息', () =&gt; {\n  const instanceProxy = Notification.info('foo')\n\n  expect(instanceProxy.$props.type).toBe('info')\n  expect(instanceProxy.$props.message).toBe('foo')\n})\ntest('成功信息', () =&gt; {\n  const instanceProxy = Notification.success('foo')\n\n  expect(instanceProxy.$props.type).toBe('success')\n  expect(instanceProxy.$props.message).toBe('foo')\n})\n</code></pre><p>现在测试写完后还是会报错，因为现在Notification函数还没有定义，我们要能通过Notification函数动态地创建Vue的组件，而不是在template中使用组件。</p><p>在<a href=\"https://time.geekbang.org/column/article/444283\">JSX那一讲</a>中我们讲过，template的本质就是使用h函数创建虚拟Dom，如果我们自己想动态创建组件时，使用相同的方式即可。</p><p>在下面的代码中我们使用Notification函数去执行createComponent函数，使用h函数动态创建组件，实现了动态组件的创建。</p><pre><code class=\"language-javascript\">function createComponent(Component, props, children) {\n  const vnode = h(Component, { ...props, ref: MOUNT_COMPONENT_REF }, children)\n  const container = document.createElement('div')\n  vnode[COMPONENT_CONTAINER_SYMBOL] = container\n  render(vnode, container)\n  return vnode.component\n}\nexport function Notification(options) {\n  return createNotification(mergeProps(options))\n}\n\nfunction createNotification(options) {\n  const instance = createNotificationByOpts(options)\n  setZIndex(instance)\n  addToBody(instance)\n  return instance.proxy\n}\n</code></pre><p>创建组件后，由于Notification组件同时可能会出现多个弹窗，所以我们需要使用数组来管理通知组件的每一个实例，每一个弹窗的实例都存储在数组中进行管理。</p><p>下面的代码里，我演示了怎样用数组管理弹窗的实例。Notification函数最终会暴露给用户使用，在Notification函数内部我们通过createComponent函数创建渲染的容器，然后通过createNotification创建弹窗组件的实例，并且维护在instanceList中。</p><pre><code class=\"language-javascript\">const instanceList = []\nfunction createNotification(options) {\n  ...\n  addInstance(instance)\n  return instance.proxy\n}  \nfunction addInstance(instance) {\n  instanceList.push(instance)\n}\n;['success', 'warning', 'info', 'error'].forEach((type) =&gt; {\n  Notification[type] = (options) =&gt; {\n    if (typeof options === 'string' || isVNode(options)) {\n      options = {\n        message: options\n      }\n    }\n    options.type = type\n    return Notification(options)\n  }\n})\n\n// 有了instanceList， 可以很方便的关闭所有信息弹窗\nNotification.closeAll = () =&gt; {\n  instanceList.forEach((instance) =&gt; {\n    instance.proxy.close()\n    removeInstance(instance)\n  })\n}\n</code></pre><p>最后，我带你简单回顾下我们都做了什么。在正式动手实现弹窗组件前，我们分析了弹窗类组件的风格。弹窗类组件主要负责用户交互的反馈。根据显示的级别不同，它可以划分成不同的种类：既有覆盖全屏的弹窗Dialog，也有负责提示消息的Notification。</p><p>这些组件除了负责渲染传递的数据和方法之外，还需要能够脱离当前组件进行渲染，<strong>防止当前组件的css样式影响布局</strong>。因此Notification组件需要渲染到body标签内部，而Vue提供了Teleport组件来完成这个任务，我们通过Teleport组件就能把内部的组件渲染到指定的dom标签。</p><p>之后，我们需要给组件提供JavaScript调用的方法。我们可以使用Notification()\b的方式动态创建组件，利用createNotification即可动态创建Vue组件的实例。</p><p>对于弹窗组件来说可以这样操作：首先通过createNotification函数创建弹窗的实例，并且给每个弹窗设置好唯一的id属性，然后存储在数组中进行管理。接着，我们通过对createNotification函数返回值的管理，即可实现弹窗动态的渲染、更新和删除功能。</p><h2>总结</h2><p>正文里已经详细讲解和演示了弹窗组件的设计，所以今天的总结我想变个花样，再给你说说TDD的事儿。</p><p>很多同学会觉得写测试代码要花一定成本，有畏难心理，觉得自己不太会写测试，这些“假想”给我们造成了“TDD很难实施”的错觉。实际上入门TDD并没有这么难。按照我的实践经验来看，先学会怎么写测试，再学习怎么重构，基本上就可以入门写TDD了。</p><p>就拿我们这讲的实践来说，我们再次应用了<strong>测试驱动开发</strong>这个方式来实现弹窗组件，把整体需求拆分成一个个子任务，逐个击破。根据设计的需求写好测试代码之后，测试代码就会检查我们的业务逻辑有没有实现，指导我们做相应的修改。</p><p>咱们的实践过程抽象出来，一共包括四个步骤：写测试 -&gt; 运行测试(报错) -&gt; 写代码让测试通过 -&gt; 重构的方式。这样的开发模式，今后你在设计组件库时也可以借鉴，不但有助于提高代码的质量和可维护性，还能让代码有比较高的代码测试覆盖率。</p><h2>思考题</h2><p>最后留一个思考题，现在我们设计的Notification组件的message只能支持文本消息，如果想支持传入其他组件，应该如何实现？</p><p>欢迎你在评论去分享你的答案，也欢迎你把这一讲的内容分享给你的同事和朋友们，我们下一讲再见。</p>","neighbors":{"left":{"article_title":"22｜表单：如何设计一个表单组件？","id":465677},"right":{"article_title":"24｜树：如何设计一个树形组件？","id":468036}},"comments":[{"had_liked":false,"id":326400,"user_name":"pzz","can_delete":false,"product_type":"c1","uid":2840605,"ip_address":"","ucode":"1D12B9BE03D95E","user_header":"https://static001.geekbang.org/account/avatar/00/2b/58/1d/4d4623c2.jpg","comment_is_top":false,"comment_ctime":1639496261,"is_pvip":false,"replies":[{"id":"118526","content":"有啥疑问可以留言讨论哦~","user_name":"编辑回复","comment_id":326400,"uid":"1501385","ip_address":"","utype":2,"ctime":1639500092,"user_name_real":"编辑"}],"discussion_count":3,"race_medal":0,"score":"53179103813","product_id":100094401,"comment_content":"这几节课直接垮了","like_count":13,"discussions":[{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"听水的湖","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538777,"discussion_content":"有啥疑问可以留言讨论哦~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639500092,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1546271,"avatar":"https://static001.geekbang.org/account/avatar/00/17/98/1f/f3861f1f.jpg","nickname":"周贺","note":"","ucode":"89781CB99E21F6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554061,"discussion_content":"无从下手~~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646203749,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2364822,"avatar":"https://static001.geekbang.org/account/avatar/00/24/15/96/478b5ecf.jpg","nickname":"荣","note":"","ucode":"1E103C388B6C47","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549843,"discussion_content":"这几节看得我也是懵","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644255021,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326540,"user_name":"关关君","can_delete":false,"product_type":"c1","uid":1562774,"ip_address":"","ucode":"98EAD61438860A","user_header":"https://static001.geekbang.org/account/avatar/00/17/d8/96/dcf52430.jpg","comment_is_top":false,"comment_ctime":1639556468,"is_pvip":false,"replies":[{"id":"118634","content":"你好，这一讲主要是演示和剖析element3源码，后面会有ts手把手写一个mini弹窗的加餐的","user_name":"作者回复","comment_id":326540,"uid":"1003715","ip_address":"","utype":1,"ctime":1639578467,"user_name_real":"编辑"}],"discussion_count":5,"race_medal":0,"score":"35999294836","product_id":100094401,"comment_content":"测试代码和实现代码有的地方都没对应上，代码有的也没帖全，我估计我们新手跟着这篇文章一个字一个字抄都运行不出来","like_count":8,"discussions":[{"author":{"id":1003715,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/50/c3/0aa50246.jpg","nickname":"花果山大圣","note":"","ucode":"25C0A36D628037","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539025,"discussion_content":"你好，这一讲主要是演示和剖析element3源码，后面会有ts手把手写一个mini弹窗的加餐的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639578467,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2840605,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/58/1d/4d4623c2.jpg","nickname":"pzz","note":"","ucode":"1D12B9BE03D95E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1003715,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/50/c3/0aa50246.jpg","nickname":"花果山大圣","note":"","ucode":"25C0A36D628037","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":550883,"discussion_content":"Mini 弹窗在哪里呀？","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1644774195,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":539025,"ip_address":""},"score":550883,"extra":""}]},{"author":{"id":1198158,"avatar":"https://static001.geekbang.org/account/avatar/00/12/48/4e/51896855.jpg","nickname":"落风","note":"","ucode":"D70B221D22A439","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":562547,"discussion_content":"感觉还行啊，多理解理解思路，然后慢慢 debug 自己弄出来，比抄来的可好太多了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649849259,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1095513,"avatar":"https://static001.geekbang.org/account/avatar/00/10/b7/59/9a0cad96.jpg","nickname":"不负韶华","note":"","ucode":"ED5A7A1C56E134","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555465,"discussion_content":"\n\nMini 弹窗在哪里呀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646919214,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1546271,"avatar":"https://static001.geekbang.org/account/avatar/00/17/98/1f/f3861f1f.jpg","nickname":"周贺","note":"","ucode":"89781CB99E21F6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554062,"discussion_content":"有点无从下手的感觉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646203768,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":327664,"user_name":"勤奋的樂","can_delete":false,"product_type":"c1","uid":1798640,"ip_address":"","ucode":"BF341C5378097F","user_header":"https://static001.geekbang.org/account/avatar/00/1b/71/f0/07c72ca6.jpg","comment_is_top":false,"comment_ctime":1640226149,"is_pvip":false,"replies":[{"id":"119364","content":"你好，这一讲主要是讲解element3的notification组件源码 , 代码可以在这里看到<br>https:&#47;&#47;github.com&#47;hug-sun&#47;element3&#47;tree&#47;master&#47;packages&#47;element3&#47;src&#47;components&#47;Notification","user_name":"作者回复","comment_id":327664,"uid":"1003715","ip_address":"","utype":1,"ctime":1640328475,"user_name_real":"编辑"}],"discussion_count":2,"race_medal":0,"score":"14525128037","product_id":100094401,"comment_content":"看的脑壳疼，照着代码敲也运行不起来，而且github代码和课程代码还有不一样的地方。。。","like_count":3,"discussions":[{"author":{"id":1003715,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/50/c3/0aa50246.jpg","nickname":"花果山大圣","note":"","ucode":"25C0A36D628037","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541310,"discussion_content":"你好，这一讲主要是讲解element3的notification组件源码 , 代码可以在这里看到\nhttps://github.com/hug-sun/element3/tree/master/packages/element3/src/components/Notification","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640328475,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1546271,"avatar":"https://static001.geekbang.org/account/avatar/00/17/98/1f/f3861f1f.jpg","nickname":"周贺","note":"","ucode":"89781CB99E21F6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554063,"discussion_content":"确实脑壳疼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646203786,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":336527,"user_name":"周贺","can_delete":false,"product_type":"c1","uid":1546271,"ip_address":"","ucode":"89781CB99E21F6","user_header":"https://static001.geekbang.org/account/avatar/00/17/98/1f/f3861f1f.jpg","comment_is_top":false,"comment_ctime":1646203688,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5941170984","product_id":100094401,"comment_content":"可能是我太菜了，无从下手~~","like_count":1},{"had_liked":false,"id":330293,"user_name":"ll","can_delete":false,"product_type":"c1","uid":1296458,"ip_address":"","ucode":"57C5DAC5B51036","user_header":"https://static001.geekbang.org/account/avatar/00/13/c8/4a/3a322856.jpg","comment_is_top":false,"comment_ctime":1641895453,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5936862749","product_id":100094401,"comment_content":"关于思考题：<br>文章中实现默认message是在options里，调用关系大致是 createNotification(options) --&gt; createNotificationByOpts(options) --&gt; createComponent(options), 这里的createComponent是默认调用的，结果就是产生一个Component，如果要实现思考题的效果，可以在creteNotificationByOpts里判断message 类型，如果message是 Vue.component 就直接挂载，不需要调用 createComponent，我猜是这么个过程。<br>然后我看了下element3中Notification的源码，发现，实现是在 createComponent(options) 函数中，就是判断了options.message 的类型，怎么判断的？isNode，如果是就 h(...,...,children),这里的children就是options.message就当children。如果类型是 string，就调用 h(...,...), 不传 children。","like_count":1},{"had_liked":false,"id":326190,"user_name":"费城的二鹏","can_delete":false,"product_type":"c1","uid":1101293,"ip_address":"","ucode":"DE768A0CC3053D","user_header":"https://static001.geekbang.org/account/avatar/00/10/cd/ed/825d84ee.jpg","comment_is_top":false,"comment_ctime":1639407751,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5934375047","product_id":100094401,"comment_content":"思考题的实现方案，可以采用 slot 的方式吗？","like_count":1},{"had_liked":false,"id":356803,"user_name":"周序猿","can_delete":false,"product_type":"c1","uid":1374169,"ip_address":"浙江","ucode":"C6D09DBAA22F94","user_header":"https://static001.geekbang.org/account/avatar/00/14/f7/d9/3014889f.jpg","comment_is_top":false,"comment_ctime":1662603781,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1662603781","product_id":100094401,"comment_content":"<br>function createComponent(Component, props, children) {<br>  const vnode = h(Component, { ...props, ref: MOUNT_COMPONENT_REF }, children)<br>  const container = document.createElement(&#39;div&#39;)<br>  vnode[COMPONENT_CONTAINER_SYMBOL] = container<br>  render(vnode, container)<br>  return vnode.component<br>}<br><br>你好老师，这个函数看得不是很懂，问下里面的 render函数是怎么来的啊<br>","like_count":0,"discussions":[{"author":{"id":3167662,"avatar":"https://static001.geekbang.org/account/avatar/00/30/55/ae/de8cf97c.jpg","nickname":"Soffio","note":"","ucode":"386C0963A7D356","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588061,"discussion_content":"vue里面引入的，没写全。。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663510381,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":343936,"user_name":"贾烨超","can_delete":false,"product_type":"c1","uid":1931253,"ip_address":"","ucode":"3F58C89D376573","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/ww9BprMJWfKIaxjQqOToMzl2VL9du9aqcPQ5K02xwl669mFzGWdqVcHYkQYtT2Wbq0aWuQS3ia09DQ4xLkZZsOg/132","comment_is_top":false,"comment_ctime":1651128040,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1651128040","product_id":100094401,"comment_content":"功能还好，主要是用的ts，一大堆报错，没处找答案","like_count":0},{"had_liked":false,"id":335432,"user_name":"加勒比海带","can_delete":false,"product_type":"c1","uid":1509728,"ip_address":"","ucode":"5E2678A3B2EEB6","user_header":"https://static001.geekbang.org/account/avatar/00/17/09/60/c5b11e91.jpg","comment_is_top":false,"comment_ctime":1645516881,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1645516881","product_id":100094401,"comment_content":"宝,怎么实现title既可以用prop也可以用slot啊","like_count":0},{"had_liked":false,"id":333066,"user_name":"任小西","can_delete":false,"product_type":"c1","uid":1624909,"ip_address":"","ucode":"45987E1A96DE2E","user_header":"https://static001.geekbang.org/account/avatar/00/18/cb/4d/b9bb17ab.jpg","comment_is_top":false,"comment_ctime":1644044034,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1644044034","product_id":100094401,"comment_content":"“在下面的代码中我们使用 Notification 函数去执行 createComponent 函数，使用 h 函数动态创建组件，实现了动态组件的创建。”<br>哪里执行了createComponent ？","like_count":0,"discussions":[{"author":{"id":2818001,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/ff/d1/7a4a6f4f.jpg","nickname":"风一样","note":"","ucode":"5EA5129D487E43","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549722,"discussion_content":"他的代码不全，看着吃力，为什么不把代码写全了？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644219429,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326403,"user_name":"pzz","can_delete":false,"product_type":"c1","uid":2840605,"ip_address":"","ucode":"1D12B9BE03D95E","user_header":"https://static001.geekbang.org/account/avatar/00/2b/58/1d/4d4623c2.jpg","comment_is_top":false,"comment_ctime":1639497498,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1639497498","product_id":100094401,"comment_content":"烧脑","like_count":0},{"had_liked":false,"id":326226,"user_name":"小毛","can_delete":false,"product_type":"c1","uid":1296882,"ip_address":"","ucode":"E033183A46528C","user_header":"https://static001.geekbang.org/account/avatar/00/13/c9/f2/548a7ba7.jpg","comment_is_top":false,"comment_ctime":1639445791,"is_pvip":true,"replies":[{"id":"118480","content":"源码用的是element3作为演示代码，https:&#47;&#47;github.com&#47;hug-sun&#47;element3&#47;blob&#47;master&#47;packages&#47;element3&#47;src&#47;components&#47;Notification&#47;src&#47;Notification.js","user_name":"作者回复","comment_id":326226,"uid":"1003715","ip_address":"","utype":1,"ctime":1639463138,"user_name_real":"编辑"}],"discussion_count":1,"race_medal":0,"score":"1639445791","product_id":100094401,"comment_content":"git上有组件的完整源码么","like_count":0,"discussions":[{"author":{"id":1003715,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/50/c3/0aa50246.jpg","nickname":"花果山大圣","note":"","ucode":"25C0A36D628037","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538633,"discussion_content":"源码用的是element3作为演示代码，https://github.com/hug-sun/element3/blob/master/packages/element3/src/components/Notification/src/Notification.js","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639463138,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326214,"user_name":"link","can_delete":false,"product_type":"c1","uid":1373877,"ip_address":"","ucode":"4ACAA724F86EFE","user_header":"https://static001.geekbang.org/account/avatar/00/14/f6/b5/300b4e26.jpg","comment_is_top":false,"comment_ctime":1639439849,"is_pvip":false,"replies":[{"id":"118479","content":"后面的三个组件倾向于演示实际的组件要考虑的因素，就用的是element3的代码作为案例了","user_name":"作者回复","comment_id":326214,"uid":"1003715","ip_address":"","utype":1,"ctime":1639463095,"user_name_real":"编辑"}],"discussion_count":1,"race_medal":0,"score":"1639439849","product_id":100094401,"comment_content":"怎么又不上ts了","like_count":0,"discussions":[{"author":{"id":1003715,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/50/c3/0aa50246.jpg","nickname":"花果山大圣","note":"","ucode":"25C0A36D628037","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538632,"discussion_content":"后面的三个组件倾向于演示实际的组件要考虑的因素，就用的是element3的代码作为案例了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639463095,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326126,"user_name":"T1M","can_delete":false,"product_type":"c1","uid":1089929,"ip_address":"","ucode":"0F152FE9A2BC10","user_header":"https://static001.geekbang.org/account/avatar/00/10/a1/89/3c865bd0.jpg","comment_is_top":false,"comment_ctime":1639387551,"is_pvip":false,"replies":[{"id":"118303","content":"慢慢理解哈，不同类型的组件需要的知识点也不太一样","user_name":"作者回复","comment_id":326126,"uid":"1003715","ip_address":"","utype":1,"ctime":1639395177,"user_name_real":"编辑"}],"discussion_count":1,"race_medal":0,"score":"1639387551","product_id":100094401,"comment_content":"最近4讲信息量都好大啊！头疼中……","like_count":0,"discussions":[{"author":{"id":1003715,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/50/c3/0aa50246.jpg","nickname":"花果山大圣","note":"","ucode":"25C0A36D628037","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538284,"discussion_content":"慢慢理解哈，不同类型的组件需要的知识点也不太一样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639395177,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}