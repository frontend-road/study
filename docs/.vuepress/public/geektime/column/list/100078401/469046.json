{"id":469046,"title":"ç”¨æˆ·æ•…äº‹ | ç”¨å¥½åŠ¨æ€è°ƒè¯•ï¼ŒåŠ©åŠ›è¯¾ç¨‹å­¦ä¹ ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯leverydã€‚</p><p>å…ˆåšä¸ªè‡ªæˆ‘ä»‹ç»ï¼Œæˆ‘åœ¨ç½‘ç»œå®‰å…¨è¡Œä¸šä»äº‹æŠ€æœ¯å·¥ä½œï¼Œç›®å‰åœ¨è´Ÿè´£å®‰å…¨äº§å“çš„ç ”å‘å·¥ä½œï¼Œå·¥ä½œå…­å¹´ã€‚</p><p>è™½ç„¶åœ¨ç ”å‘å·¥ä½œä¸­ï¼Œæˆ‘ä»¬é€šå¸¸æ˜¯é‡åˆ°ä»€ä¹ˆé—®é¢˜å°±å»æŸ¥ï¼Œè¾¹æŸ¥è¾¹å­¦ã€‚è™½ç„¶è¿™æ ·çš„å­¦ä¹ æ–¹å¼èƒ½å¿«é€Ÿè§£å†³é—®é¢˜ï¼Œä½†æœ‰æ—¶å€™è¿™ç§æ–¹æ³•ä¹Ÿä¸çµï¼Œæ¯”æ–¹è¯´å­¦ä¹ è¯­ä¹‰åˆ†ææ—¶ï¼Œå°±å¿…é¡»è¦æŠŠè¯æ³•åˆ†æã€è¯­æ³•åˆ†æå…ˆå­¦äº†ï¼Œä¸€é€šæœç´¢ã€æŸ¥é˜…ã€æ±‡æ€»å’Œå­¦ä¹ ï¼Œå›å¤´ä¸€çœ‹ï¼Œéœ€è¦èŠ±è´¹çš„æ—¶é—´å’Œç²¾åŠ›è¿˜æ˜¯ä¸å°‘çš„ã€‚</p><p>æ˜¾ç„¶ï¼Œåªé è‡ªå·±åœ¨ç½‘ä¸Šæœç´¢ï¼Œå­¦åˆ°çš„å¸¸å¸¸æ˜¯é›¶é›¶æ•£æ•£ï¼Œæ•ˆç‡å¤ªä½ã€‚å°¤å…¶æ˜¯å’Œå·¥ä½œçš„å…³è”ç¨‹åº¦å¾ˆé«˜çš„å¿…ä¿®çŸ¥è¯†ï¼Œæˆ‘è§‰å¾—ä¸å¤ªé€‚åˆè¾¹æŸ¥è¾¹å­¦ï¼Œæ›´éœ€è¦ç³»ç»Ÿå­¦ä¹ ã€‚ç»“åˆè‡ªå·±çš„å·¥ä½œéœ€è¦ï¼Œä»Šå¹´å¹´åˆçš„æ—¶å€™ï¼Œæˆ‘ç»™è‡ªå·±å®‰æ’äº†è¿‘æœŸå­¦ä¹ è®¡åˆ’ï¼Œå®šä¸‹äº†ç›¸åº”çš„å­¦ä¹ çš„ä¼˜å…ˆçº§ã€‚</p><p>å…¶ä¸­ï¼Œè¡¥å……æ“ä½œç³»ç»Ÿçš„ä¸“ä¸šçŸ¥è¯†å°±æ˜¯é«˜ä¼˜å…ˆçº§çš„ä¸€é¡¹ã€‚è¿‘æœŸå­¦ä¹ ã€Šæ“ä½œç³»ç»Ÿå®æˆ˜45è®²ã€‹çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¹Ÿè·Ÿç€è¯¾ç¨‹å†…å®¹å¼€å§‹åŠ¨æ‰‹å®è·µï¼Œè¿˜åœ¨è¯¾ç¨‹ç¾¤é‡Œåˆ†äº«äº†è‡ªå·±çš„è°ƒè¯•ç»éªŒã€‚æ¥åˆ°LMOSè€å¸ˆçš„é‚€è¯·ï¼Œä»Šå¤©æˆ‘å°±å’Œä½ èŠèŠæˆ‘æ˜¯æ€æ ·å­¦ä¹ è¿™é—¨è¯¾ç¨‹ï¼Œä»¥åŠæˆ‘æ˜¯å¦‚ä½•è°ƒè¯•è¯¾ç¨‹ä»£ç çš„ã€‚</p><h2>æˆ‘æ˜¯æ€ä¹ˆå­¦ä¹ ã€Šæ“ä½œç³»ç»Ÿå®æˆ˜45è®²ã€‹çš„</h2><p>æ ¹æ®æˆ‘çš„å­¦ä¹ éœ€æ±‚ï¼Œæˆ‘ç»™è‡ªå·±ç«‹ä¸‹äº†ä¸¤ä¸ªå­¦ä¹ ç›®æ ‡ï¼š</p><p>ç¬¬ä¸€ï¼Œç†è§£ç¬¬åä¸‰è¯¾çš„ä»£ç ï¼šç¬¬åä¸‰è¯¾ä¹‹å‰çš„å†…å®¹åŒ…æ‹¬äº†æ•´ä¸ªæœºå™¨åˆå§‹åŒ–è¿‡ç¨‹ï¼›</p><p>ç¬¬äºŒï¼Œç†è§£ç¬¬äºŒåå…­è¯¾çš„ä»£ç ï¼šæ¯”ç¬¬åä¸‰è¯¾å†…å®¹å¤šäº†â€œå†…å­˜â€å’Œâ€œè¿›ç¨‹â€ã€‚</p><!-- [[[read_end]]] --><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼Œæˆ‘æŠŠè§£å†³è¿™äº›é—®é¢˜çš„å®è·µç»éªŒå†™åˆ°<a href=\"https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzkyMDIxMjE5MA==&amp;action=getalbum&amp;album_id=2147374170542833668&amp;scene=173&amp;from_msgid=2247484665&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect\">å…¬ä¼—å·</a>ï¼ˆå…¬ä¼—å·ä¸Šæˆ‘è®°å½•äº†è¿™é—¨è¯¾çš„å­¦ä¹ å®éªŒç¬”è®°ï¼Œä»¥åŠå…³äºå®‰å…¨ä¸šåŠ¡å’ŒæŠ€æœ¯çš„ä¸€äº›æ¡ˆä¾‹ï¼‰ä¸Šï¼Œä»¥æ­¤åŠ æ·±è‡ªå·±çš„ç†è§£ã€‚</p><p>å°±ç›®å‰æˆ‘è‡ªå·±çš„å­¦ä¹ ç»éªŒæ¥çœ‹ï¼Œâ€œå†…æ ¸å®éªŒâ€æ¯”è¾ƒå¤æ‚ã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºå†…æ ¸æ¶‰åŠçš„çŸ¥è¯†è¾ƒå¤šï¼Œæ¯”å¦‚Cè¯­è¨€ã€æ±‡ç¼–ã€ç¡¬ä»¶çŸ¥è¯†ï¼›è€Œä¸”è¿™æ–¹é¢å†…å®¹æ¯”è¾ƒåº•å±‚ï¼ŒæŸäº›æ¦‚å¿µæˆ‘ä»¬å¹³æ—¶æ¥è§¦å¾—æ¯”è¾ƒå°‘ï¼Œæ¯”å¦‚æ±‡ç¼–å±‚é¢çš„å‡½æ•°è°ƒç”¨ç»†èŠ‚ã€‚</p><p>å¦å¤–ï¼Œéƒ¨åˆ†ç®—æ³•ä¹ä¸€çœ‹ç¡®å®æœ‰ç‚¹éš¾ç†è§£ï¼Œæ¯”å¦‚<a href=\"https://time.geekbang.org/column/article/391222\">ç¬¬äºŒåäº”è¯¾</a>ä¸­è¿›ç¨‹çš„åˆ‡æ¢æ˜¯åˆ©ç”¨â€œæ ˆä¸Šçš„å‡½æ•°è¿”å›åœ°å€â€ï¼Œè€Œâ€œè¿”å›åœ°å€â€åŒ…æ‹¬åˆå§‹åŒ–å’Œåé¢è¢«è¿›ç¨‹è°ƒåº¦å™¨æ›´æ–°è¿™ä¸¤ç§åœºæ™¯ã€‚æˆ‘ä»¬éœ€è¦å¼„æ¸…æ¥šè¿™ä¸¤ä¸ªåœºæ™¯éƒ½æ˜¯æ€ä¹ˆæ›´æ–°çš„ï¼Œæ‰èƒ½æ›´å¥½ç†è§£è¿›ç¨‹æ˜¯å¦‚ä½•åˆ‡æ¢è¿è¡Œçš„ã€‚</p><h2>Cosmosè°ƒè¯•æ€è·¯</h2><p>å› ä¸ºåˆšæ‰è¯´çš„è¿™äº›åŸå› ï¼Œå½“æˆ‘ä»¬é‡åˆ°ç–‘é—®æ—¶ï¼Œå¾€å¾€æ— æ³•ä»ç½‘ç»œä¸Šç›´æ¥æœåˆ°ç­”æ¡ˆã€‚è¿™ä¸ªæ—¶å€™ï¼Œå°±å¯ä»¥é€šè¿‡è°ƒè¯•æ¥è¾…åŠ©æˆ‘ä»¬åˆ†æé—®é¢˜ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°±è¯´ä¸€è¯´æˆ‘æ˜¯æ€ä¹ˆè°ƒè¯•è¯¾ç¨‹ä»£ç çš„ï¼Œåé¢è¿˜ä¼šå†åˆ†äº«ä¸€ä¸‹æˆ‘é€šè¿‡åŠ¨æ€è°ƒè¯•è§£å†³ç–‘é—®çš„ä¾‹å­ã€‚</p><p>è™½ç„¶æˆ‘ä»¬å¯ä»¥åœ¨ä»£ç ä¸­æ‰“å°æ—¥å¿—ï¼Œä½†è¿™ç§æ–¹å¼æ•ˆç‡ä¸é«˜ï¼Œå› ä¸ºæ¯æ¬¡éƒ½éœ€è¦ç¼–å†™ä»£ç ã€é‡æ–°ç¼–è¯‘è¿è¡Œã€‚æˆ‘æ›´å–œæ¬¢ç”¨GDBå’ŒQEMUåŠ¨æ€è°ƒè¯•Cosmosã€‚</p><p>ç»“åˆä¸‹å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼šä½¿ç”¨GDBåœ¨Cosmoså†…æ ¸å‡½æ•°ä¸‹äº†æ–­ç‚¹ï¼Œå¹¶ä¸”æ–­ç‚¹ç”Ÿæ•ˆã€‚å¦‚æœæˆ‘æƒ³è§‚å¯Ÿcopy_pages_dataçš„é€»è¾‘ï¼Œå°±åªéœ€è¦åœ¨<strong>å•æ­¥è°ƒè¯•</strong>è¿‡ç¨‹ä¸­è§‚å¯Ÿå†…å­˜çš„å˜åŒ–ï¼Œè¿™æ ·å°±èƒ½çŸ¥é“copy_pages_dataå»ºç«‹çš„<strong>é¡µè¡¨æ•°æ®</strong>é•¿ä»€ä¹ˆæ ·å­ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/90/36/90370d43yyb1aa458ef5a0e323f17536.png?wh=1744x696\" alt=\"å›¾ç‰‡\"></p><p>æ€»çš„æ¥è¯´ï¼Œæƒ³è¦åŠ¨æ€è°ƒè¯•ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç¼–è¯‘ä¸€ä¸ªå¸¦è°ƒè¯•ç¬¦å·çš„elfæ–‡ä»¶å‡ºæ¥ï¼Œç„¶åæ›´æ–°hd.imgé•œåƒæ–‡ä»¶ã€‚</p><p>æ¥ç€æˆ‘ä»¬ç”¨QEMUå¯åŠ¨å†…æ ¸ï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code class=\"language-bash\">  âœ  myos qemu-system-x86_64 -drive format=raw,file=hd.img -m 512M -cpu kvm64,smep,smap -s    // ä¸€å®šè¦åŠ -så‚æ•°ï¼Œæ­¤å‚æ•°å¯ä»¥æ‰“å¼€è°ƒè¯•æœåŠ¡ã€‚\n</code></pre><p>æœ€åï¼Œæˆ‘ä»¬ç”¨GDBåŠ è½½è°ƒè¯•ç¬¦å·å¹¶è°ƒè¯•ï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">  (gdb) symbol-file ./initldr/build/initldrkrl.elf    // åŠ è½½è°ƒè¯•ç¬¦å·ï¼Œè¿™æ ·æ‰èƒ½åœ¨æ˜¾ç¤ºæºç ã€å¯ä»¥ç”¨å‡½æ•°åä¸‹æ–­ç‚¹\n  Reading symbols from /root/cosmos/lesson13/Cosmos/initldr/build/initldrkrl.elf...done.\n  (gdb) target remote :1234   // è¿æ¥qemu-system-x86_64 -sé€‰é¡¹æ‰“å¼€çš„1234ç«¯å£è¿›è¡Œè°ƒè¯•\n  Remote debugging using :1234\n  0x000000000000e82e in ?? ()\n</code></pre><p>æˆ‘å·²ç»å°†ç¼–è¯‘å¥½çš„å¸¦è°ƒè¯•ç¬¦å·çš„elfæ–‡ä»¶ï¼Œä»¥åŠå¯¹åº”çš„hd.imgé•œåƒæ–‡ä»¶æ”¾åœ¨äº†<a href=\"https://github.com/leveryd/cosmos-debug-file\">GitHub</a>ä¸Šï¼Œä½ å¯ä»¥ç›´æ¥ç”¨è¿™äº›æ–‡ä»¶å’Œä¸Šé¢çš„å‘½ä»¤æ¥è°ƒè¯•ã€‚ä»“åº“ä¸­ç›®å‰æˆ‘åªæ”¾äº†å¯¹åº”ç¬¬åä¸‰è¯¾å’Œç¬¬äºŒåå…­è¯¾çš„è°ƒè¯•æ–‡ä»¶ï¼Œå¦‚æœä½ æƒ³è¦è°ƒè¯•å…¶ä»–è¯¾çš„ä»£ç ï¼Œä¸å¦¨ç»§ç»­å¾€ä¸‹çœ‹ã€‚</p><h2>åˆ¶ä½œâ€œå¸¦è°ƒè¯•ç¬¦å·çš„elfæ–‡ä»¶\"çš„è¯¦ç»†æ­¥éª¤</h2><p>å¦‚æœä½ è°ƒè¯•è¿‡Linuxå†…æ ¸ï¼Œåº”è¯¥æ¯”è¾ƒç†Ÿæ‚‰ä¸Šé¢çš„æµç¨‹ã€‚ä¸è¿‡åœ¨åˆ¶ä½œâ€œå¸¦è°ƒè¯•ç¬¦å·çš„elfæ–‡ä»¶â€æ—¶ï¼ŒCosmoså’ŒLinuxå†…æ ¸æœ‰äº›ä¸åŒï¼Œä¸‹é¢æˆ‘å°±è¯¦ç»†è¯´æ˜ä¸€ä¸‹ã€‚</p><p>å…ˆè¯´è¯´æ•´ä½“æ€è·¯ï¼šé€šè¿‡ä¿®æ”¹ç¼–è¯‘é€‰é¡¹ï¼Œå³å¯ç”Ÿæˆâ€œå¸¦è°ƒè¯•ç¬¦å·çš„elfæ–‡ä»¶â€ã€‚ç„¶åå†ç”ŸæˆCosmos.ekiå†…æ ¸æ–‡ä»¶ï¼Œæœ€åæ›¿æ¢hd.imgé•œåƒæ–‡ä»¶ä¸­çš„Cosmos.ekiæ–‡ä»¶ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨â€œå¸¦è°ƒè¯•ç¬¦å·çš„elfæ–‡ä»¶â€å’Œhd.imgæ¥è°ƒè¯•ä»£ç äº†ã€‚</p><h3>ä¿®å¤ä¸¤ä¸ªbug</h3><p>åªæœ‰å…ˆä¿®å¤åé¢è¿™ä¸¤ä¸ªbugï¼Œæ‰èƒ½æˆåŠŸç¼–è¯‘ï¼Œå¹¶ä¸”è¿è¡ŒCosmoså†…æ ¸ä»£ç ã€‚</p><p>ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šç¼–è¯‘ç¬¬åä¸‰è¯¾çš„ä»£ç æ—¶é‡åˆ°ä¸€ä¸ªæŠ¥é”™ï¼ŒæŠ¥é”™æˆªå›¾å¦‚ä¸‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/56/8a/5607fba7372a2a546fc3550d9830ce8a.png?wh=1894x1788\" alt=\"å›¾ç‰‡\"></p><p>è§£å†³åŠæ³•å¾ˆç®€å•ï¼šå°†kernel.asmæ–‡ä»¶ä¸­çš„â€œkernel.incâ€ä¿®æ”¹æˆâ€œ/kernel.incâ€ï¼Œä½ å¯ä»¥å¯¹ç…§åé¢çš„æˆªå›¾çœ‹ä¸€ä¸‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/de/96/de8f78757363850f1920ffcb2922a096.png?wh=997x261\" alt=\"å›¾ç‰‡\"></p><p>ç¬¬äºŒä¸ªé—®é¢˜æ˜¯ç¬¬äºŒåå…­è¯¾é‡åˆ°çš„è¿è¡Œæ—¶æŠ¥é”™ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a3/fb/a3364f1907b44a99c198f42e8a11e1fb.png?wh=1440x844\" alt=\"å›¾ç‰‡\"></p><p>å› ä¸ºacpiæ˜¯å’Œâ€œç”µæºç®¡ç†â€ç›¸å…³çš„æ¨¡å—ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰ç”¨åˆ°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ³¨é‡Šæ‰ initldr/ldrkrl/chkcpmm.c æ–‡ä»¶ä¸­çš„init_acpi å‡½æ•°è°ƒç”¨ã€‚</p><p>è§£å†³æ‰è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œå°±å¯ä»¥æˆåŠŸç¼–è¯‘ç¬¬åä¸‰è¯¾å’Œç¬¬äºŒåå…­è¯¾çš„ä»£ç äº†ã€‚</p><h3>ä¿®æ”¹â€œç¼–è¯‘é€‰é¡¹\"</h3><p>ä¿®å¤bugåï¼Œæˆ‘ä»¬è™½ç„¶èƒ½å¤ŸæˆåŠŸç¼–è¯‘è¿è¡Œï¼Œä½†æ˜¯å› ä¸ºæ–‡ä»¶æ²¡æœ‰è°ƒè¯•ç¬¦å·ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨GDBè°ƒè¯•æ—¶æ— æ³•å¯¹åº”åˆ°cæºç ï¼Œä¹Ÿæ— æ³•ç”¨å‡½æ•°åä¸‹æ–­ç‚¹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡<strong>ä¿®æ”¹ç¼–è¯‘é€‰é¡¹</strong>æ¥ç”Ÿæˆå¸¦è°ƒè¯•ç¬¦å·çš„elfæ–‡ä»¶ã€‚</p><p>ä¸ºäº†ç¼–è¯‘å‡ºå¸¦è°ƒè¯•ç¬¦å·çš„æ‰§è¡Œæ–‡ä»¶ï¼Œéœ€è¦å¯¹ç¼–è¯‘è„šæœ¬åšä¸¤å¤„ä¿®æ”¹ã€‚</p><p>ç¬¬ä¸€å¤„ä¿®æ”¹ï¼ŒGCCçš„<code>-O2</code>å‚æ•°è¦ä¿®æ”¹æˆ<code>O0 -g</code>å‚æ•°ï¼š<code>-O0</code>æ˜¯å‘Šè¯‰GCCç¼–è¯‘å™¨ï¼Œåœ¨ç¼–è¯‘æ—¶ä¸è¦å¯¹ä»£ç åšä¼˜åŒ–ï¼Œè¿™ä¹ˆåšçš„åŸå› æ˜¯é¿å…åœ¨GDBè°ƒè¯•æ—¶æºç å’Œå®é™…ç¨‹åºå¯¹åº”ä¸ä¸Šçš„æƒ…å†µï¼›<code>-g</code>å‚æ•°æ˜¯ä¸ºäº†å‘Šè¯‰ç¼–è¯‘å™¨å¸¦ä¸Š<strong>è°ƒè¯•ç¬¦å·</strong>ã€‚</p><p>ç¬¬äºŒå¤„ä¿®æ”¹ï¼Œå»æ‰ldçš„<code>-s</code>å‚æ•°ï¼š<code>-s</code>æ˜¯å‘Šè¯‰ldç¨‹åºé“¾æ¥æ—¶å»æ‰æ‰€æœ‰ç¬¦å·ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…æ‹¬äº†<strong>è°ƒè¯•ç¬¦å·</strong>ã€‚</p><p>éœ€è¦æ›¿æ¢å’Œä¿®æ”¹çš„æ–‡ä»¶ä½ç½®å¦‚ä¸‹å›¾ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/4c/d8/4c0418816c6f65d09ee4825086482fd8.png?wh=1916x196\" alt=\"å›¾ç‰‡\"></p><p><img src=\"https://static001.geekbang.org/resource/image/a5/5a/a58776949362811af4a8d9251fec3b5a.png?wh=1368x230\" alt=\"å›¾ç‰‡\"></p><p>ä½¿ç”¨sedå‘½ä»¤ï¼Œå³å¯æ‰¹é‡å°†<code>-O2</code> å‚æ•°ä¿®æ”¹æˆ<code>-O0-g</code> ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-bash\">  [root@instance-fj5pftdp Cosmos]# sed -i 's/-O2/-O0 -g/' ./initldr/build/krnlbuidcmd.mh ./script/krnlbuidcmd.S ./build/krnlbuidcmd.mki ./build/krnlbuidcmd.mk\n  [root@instance-fj5pftdp Cosmos]# sed -i 's/-Os/-O0 -g/' ./initldr/build/krnlbuidcmd.mh ./script/krnlbuidcmd.S ./build/krnlbuidcmd.mki ./build/krnlbuidcmd.mk\n  [root@instance-fj5pftdp Cosmos]# grep -i '\\-O2' -r .\n  [root@instance-fj5pftdp Cosmos]#\n</code></pre><p>ä½¿ç”¨sedå‘½ä»¤æ‰¹é‡å»æ‰ldçš„<code>-s</code>å‚æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-bash\">  [root@instance-fj5pftdp Cosmos]# sed -i 's/-s / /g' ./initldr/build/krnlbuidcmd.mh ./script/krnlbuidcmd.S ./build/krnlbuidcmd.mki ./build/krnlbuidcmd.mk\n  [root@instance-fj5pftdp Cosmos]# grep '\\-s ' -r .\n</code></pre><p>å®Œæˆä¸Šé¢çš„æ“ä½œä»¥åï¼Œç¼–è¯‘é€‰é¡¹å°±ä¿®æ”¹å¥½äº†ã€‚</p><h3>ç¼–è¯‘ç”Ÿæˆâ€œå¸¦è°ƒè¯•ç¬¦å·çš„elfæ–‡ä»¶\"</h3><p>æˆ‘ä»¬ä¿®å¤bugå’Œä¿®æ”¹ç¼–è¯‘é€‰é¡¹åï¼Œæ‰§è¡Œ<code>make</code>å°±å¯ä»¥ç¼–è¯‘å‡ºå¸¦æœ‰è°ƒè¯•ç¬¦å·çš„elfæ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾ï¼šè¿™é‡Œçš„â€œnot strippedâ€å°±è¡¨ç¤ºæ–‡ä»¶å¸¦æœ‰è°ƒè¯•ç¬¦å·ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/bf/14/bfd6156949406c0ayy682753389b4114.png?wh=1147x226\" alt=\"å›¾ç‰‡\"></p><p>è¿™é‡Œæœ‰ä¸¤ä¸ªè¦ç‚¹ï¼Œæˆ‘ç‰¹åˆ«è¯´æ˜ä¸€ä¸‹ã€‚</p><p>1.Cosmos.elfï¼šå½“éœ€è¦è°ƒè¯•â€œå†…æ ¸ä»£ç â€æ—¶ï¼Œå¯ä»¥åœ¨GDBä¸­æ‰§è¡Œ<code>symbol-file ./initldr/build/Cosmos.elf</code>åŠ è½½è°ƒè¯•ç¬¦å·ã€‚</p><p>2.initldrkrl.elfï¼šå½“éœ€è¦è°ƒè¯•â€œäºŒçº§åŠ è½½å™¨ä»£ç â€æ—¶ï¼Œå¯ä»¥åœ¨GDBä¸­æ‰§è¡Œ<code>symbol-file ./initldr/build/initldrkrl.elf</code>åŠ è½½è°ƒè¯•ç¬¦å·ã€‚</p><h3>é‡æ–°åˆ¶ä½œhd.img</h3><p>æœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°åˆ¶ä½œhd.imgï¼Œè¿™æ ·VBoxæˆ–è€…QEMUå°±èƒ½è¿è¡Œæˆ‘ä»¬é‡æ–°ç”Ÿæˆçš„Cosmoså†…æ ¸ã€‚</p><p>æ•´ä¸ªè¿‡ç¨‹å¾ˆç®€å•ï¼Œåˆ†ä¸¤æ­¥ã€‚é¦–å…ˆç”ŸæˆCosmos.ekiï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œfont.fntç­‰èµ„æºæ–‡ä»¶è¦æ‹·è´è¿‡æ¥ã€‚</p><pre><code class=\"language-bash\">  [root@instance-fj5pftdp build]# pwd\n  /root/cosmos/lesson25~26/Cosmos/initldr/build\n  [root@instance-fj5pftdp build]# cp ../../build/Cosmos.bin ./\n  [root@instance-fj5pftdp build]# cp ../../release/font.fnt ../../release/logo.bmp ../../release/background.bmp ./\n  [root@instance-fj5pftdp build]# ./lmoskrlimg -m k -lhf initldrimh.bin -o Cosmos.eki -f initldrkrl.bin initldrsve.bin Cosmos.bin background.bmp font.fnt logo.bmp\n  æ–‡ä»¶æ•°ï¼š6\n  æ˜ åƒæ–‡ä»¶å¤§å°ï¼š5169152\n</code></pre><p>ç„¶åæ›´æ–°hd.imgï¼Œæ›¿æ¢å…¶ä¸­çš„Cosmos.ekiã€‚</p><pre><code class=\"language-bash\">  [root@instance-fj5pftdp build]# pwd\n  /root/cosmos/lesson25~26/Cosmos/initldr/build\n  [root@instance-fj5pftdp build]# mount ../../hd.img /tmp/\n  [root@instance-fj5pftdp build]# cp Cosmos.eki /tmp/boot/\n  cpï¼šæ˜¯å¦è¦†ç›–\"/tmp/boot/Cosmos.eki\"ï¼Ÿ y\n  [root@instance-fj5pftdp build]# umount /tmp/\n  [root@instance-fj5pftdp build]#\n</code></pre><p>å®Œæˆä¸Šé¢çš„æ“ä½œä»¥åï¼Œhd.imgå°±åˆ¶ä½œå¥½äº†ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥ç”¨hd.imgå’Œä¹‹å‰ç”Ÿæˆçš„elfæ–‡ä»¶æ¥è°ƒè¯•ä»£ç ã€‚</p><h3>æ‰“åŒ…ä¼ è¾“hd.imgåˆ°mac</h3><p>å› ä¸ºæˆ‘æ˜¯åœ¨äº‘ä¸Šè´­ä¹°çš„Linuxè™šæ‹Ÿæœºä¸Šè°ƒè¯•Macä¸ŠQEMUè¿è¡Œçš„Cosmoså†…æ ¸ï¼Œæ‰€ä»¥æˆ‘éœ€è¦æŠŠLinuxä¸Šåˆ¶ä½œçš„hd.imgä¼ è¾“åˆ°Macã€‚ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µè®¾ç½®ä¼ è¾“åœ°å€ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/be/f1/be17d89e3a927ae0e4a4b70252c043f1.png?wh=1518x206\" alt=\"å›¾ç‰‡\"></p><h2>å¦‚ä½•é€šè¿‡åŠ¨æ€è°ƒè¯•éªŒè¯grubé•œåƒæ–‡ä»¶çš„åŠ è½½è¿‡ç¨‹</h2><p>åŠ¨æ€è°ƒè¯•ä¹Ÿå¥½ï¼Œæ±‡ç¼–ä»£ç ä¹Ÿç½¢ï¼Œå…¶å®éƒ½æ˜¯ä¸ºæˆ‘ä»¬åˆ†æé—®é¢˜å’Œè§£å†³é—®é¢˜æœåŠ¡çš„ã€‚å¯¹äºè°ƒè¯•ä¸å¤ªç†Ÿæ‚‰çš„å°ä¼™ä¼´ä¹Ÿåˆ«æœ‰å¤ªå¤§å¿ƒç†è´Ÿæ‹…ï¼Œä¸€å›ç”Ÿã€äºŒå›ç†Ÿå˜›ï¼Œå’±ä»¬å¤šè¯•è¯•å°±æœ‰æ‰‹æ„Ÿäº†ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°±ç»™ä½ åˆ†äº«ä¸ªæ¯”è¾ƒç®€å•çš„æ¡ˆä¾‹ï¼Œä½ åªéœ€è¦çœ‹åˆ°å‡ è¡Œæ±‡ç¼–ä»£ç ï¼Œå°±èƒ½è§£å†³ä¸€äº›å­¦ä¹ ä¸­çš„å°ç–‘é—®ã€‚</p><p>åœ¨æ­£å¼è®²è§£è¿™ä¸ªè°ƒè¯•æ¡ˆä¾‹ä¹‹å‰ï¼Œæˆ‘å…ˆäº¤ä»£ä¸‹é—®é¢˜èƒŒæ™¯ã€‚åœ¨å­¦ä¹ è¯¾ç¨‹ä¸­çš„â€œåˆå§‹åŒ–â€éƒ¨åˆ†æ—¶ï¼Œæˆ‘æœ‰ä¸¤ä¸ªç–‘é—®ï¼š</p><p>1.ä»£ç ä»grubåˆ°Cosmosé¡¹ç›®æ—¶ï¼Œç¬¬ä¸€æ¡æŒ‡ä»¤æ˜¯ä»€ä¹ˆï¼Ÿè¿™æ¡æŒ‡ä»¤è¢«åŠ è½½åˆ°å“ªé‡Œæ‰§è¡Œï¼Ÿ</p><p>2.æ­¤æ—¶CPUæ˜¯å®æ¨¡å¼è¿˜æ˜¯ä¿æŠ¤æ¨¡å¼ï¼Ÿ</p><p>ä¸ºäº†è§£å†³è¿™ä¸¤ä¸ªç–‘é—®ï¼Œæˆ‘å¼€å§‹äº†è‡ªå·±çš„æ¢ç´¢ä¹‹æ—…ã€‚</p><h3>åˆ†æè¿‡ç¨‹</h3><pre><code class=\"language-bash\">  [root@instance-fj5pftdp Cosmos]# od -tx4 ./initldr/build/Cosmos.eki | head -3\n  0000000 909066eb 1badb002 00010003 e4514ffb\n  0000020 04000004 04000000 00000000 00000000\n  0000040 04000068 90909090 e85250d6 00000000\n</code></pre><p>æ ¹æ® <a href=\"https://time.geekbang.org/column/article/380507\">11 | è®¾ç½®å·¥ä½œæ¨¡å¼ä¸ç¯å¢ƒï¼ˆä¸­ï¼‰ï¼šå»ºé€ äºŒçº§å¼•å¯¼å™¨</a>è¯¾ç¨‹ä¸­è¯´çš„GRUBå¤´ç»“æ„ï¼Œç»“åˆä¸Šé¢çš„Cosmos.ekiæ–‡ä»¶å¤´ä¿¡æ¯ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å°±èƒ½çŸ¥é“ï¼Œ<code>_start</code>ç¬¦å·åœ°å€æ˜¯<code>0x04000000</code>,<code>_entry</code>ç¬¦å·åœ°å€æ˜¯<code>0x04000068</code>ã€‚</p><p>æ‰€ä»¥ï¼Œå¯ä»¥çŒœæµ‹ï¼šgrubç¨‹åºä¼šåŠ è½½cosmos.ekiåˆ°<code>0x04000000</code>ä½ç½®ï¼Œç„¶åè·³åˆ°<code>0x04000000</code>æ‰§è¡Œï¼Œå†ä»<code>0x04000000</code> jmp åˆ°<code>0x04000068</code>ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨GDBè°ƒè¯•éªŒè¯æ˜¯å¦ç¬¦åˆè¿™ä¸ªçŒœæµ‹ï¼Œè°ƒè¯•ä»£ç å¦‚ä¸‹:</p><pre><code class=\"language-bash\">  [root@instance-fj5pftdp Cosmos]# gdb -silent\n  (gdb) target remote :1234\n  Remote debugging using :1234\n  0x0000000000008851 in ?? ()\n  (gdb) b *0x04000000\n  Breakpoint 1 at 0x4000000\n  (gdb) b *0x04000068\n  Breakpoint 2 at 0x4000068\n  (gdb) c\n  Continuing.\n\n  Breakpoint 1, 0x0000000004000068 in ?? ()\n  (gdb) x /3i $rip    // å’Œimginithead.asmæ–‡ä»¶å†…å®¹å¯ä»¥å¯¹åº”ä¸Š\n  =&gt; 0x4000068:    cli\n     0x4000069:    in     al,0x70\n     0x400006b:    or     al,0x80\n  (gdb) x /10x 0x4000000  // å’Œcosmos.ekiæ–‡ä»¶å¤´å¯ä»¥å¯¹åº”ä¸Š\n  0x4000000:    0x909066eb  0x1badb002  0x00010003  0xe4514ffb\n  0x4000010:    0x04000004  0x04000000  0x00000000  0x00000000\n  0x4000020:    0x04000068  0x90909090  0xe85250d6  0x00000000\n  (gdb) info r cr0\n  cr0            0x11    [ PE ET ]\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/43/bb/43dbcfee9357075722330b464125b1bb.png?wh=1920x807\" alt=\"å›¾ç‰‡\"></p><p>é€šè¿‡GDBå¯ä»¥çœ‹åˆ°ï¼Œç¨‹åºä¸æ˜¯åœ¨<code>0x04000000</code>æ–­ç‚¹æš‚åœï¼Œè€Œæ˜¯ç›´æ¥åœ¨<code>0x04000068</code> æ–­ç‚¹æš‚åœï¼Œè¯´æ˜ç¬¬ä¸€æ¡æŒ‡ä»¤ä¸æ˜¯_startç¬¦å·ä½ç½®è€Œæ˜¯_entryç¬¦å·ä½ç½®ã€‚åˆ°_entryæ—¶ï¼Œcr0çš„pe=1ï¼Œè¿™è¡¨æ˜æ­¤æ—¶ä¿æŠ¤æ¨¡å¼å·²ç»æ‰“å¼€äº†ã€‚æ€ä¹ˆæ ·ï¼Ÿæ˜¯ä¸æ˜¯æŒºæ–¹ä¾¿çš„ï¼Ÿ</p><p>ç»è¿‡å‰é¢çš„è°ƒè¯•ï¼Œæˆ‘å¾—åˆ°äº†æœ€åçš„ç»“è®ºï¼šç¬¬ä¸€æ¡æŒ‡ä»¤æ˜¯_entryç¬¦å·ä½ç½®ï¼Œåœ°å€æ˜¯<code>0x04000068</code>ã€‚åˆ°<code>0x04000068</code>è¿™ä¸€æ¡æŒ‡ä»¤æ—¶ï¼ŒCPUå·²ç»æ˜¯ä¿æŠ¤æ¨¡å¼äº†ã€‚</p><p>æˆ‘çš„åˆ†äº«åˆ°è¿™é‡Œå°±å‘Šä¸€æ®µè½å•¦ã€‚ä¸ºäº†ç…§é¡¾åˆšå…¥é—¨çš„åŒå­¦ï¼Œæˆ‘å†æä¾›ä¸¤ä¸ªå‚è€ƒèµ„æ–™ã€‚å…³äºGDBçš„ä½¿ç”¨ï¼Œä½ å¯ä»¥å‚è€ƒ <a href=\"https://wizardforcel.gitbooks.io/100-gdb-tips/content/index.html\">100ä¸ªGDBå°æŠ€å·§</a>ã€‚å…³äºQEMUã€GCCã€ldç­‰å‘½ä»¤å‚æ•°çš„å«ä¹‰ï¼Œä½ å¯ä»¥å‚è€ƒ <a href=\"https://www.mankier.com/1/qemu\">manæ‰‹å†Œ</a>ã€‚</p><p>å¸Œæœ›è¿™ç¯‡åŠ é¤å¯¹ä½ æœ‰æ‰€å¯å‘ï¼Œå¦‚æœä½ æœ‰ä»€ä¹ˆå¥½çš„å­¦ä¹ æ–¹æ³•ï¼Œä¸å¦¨ä¹Ÿåœ¨ç•™è¨€åŒºå¤šå¤šåˆ†äº«ï¼Œè®©æˆ‘ä»¬ä¸€èµ·å­¦ä¹ è¿›æ­¥ã€‚</p>","neighbors":{"left":{"article_title":"ç”¨æˆ·æ•…äº‹ | æŠ€æœ¯äººå¦‚ä½•åšé€‰æ‹©ï¼Œè·¯æ‰è¶Šèµ°è¶Šå®½ï¼Ÿ","id":415861},"right":{"article_title":"ç”¨æˆ·æ•…äº‹ | yiyangï¼šæˆ‘çš„ä¸Šæœºå®éªŒâ€œçˆ¬å‘æŒ‡å—â€","id":471872}},"comments":[{"had_liked":false,"id":328725,"user_name":"Geek_504185","can_delete":false,"product_type":"c1","uid":2723475,"ip_address":"","ucode":"1C13797BD0DCF4","user_header":"","comment_is_top":true,"comment_ctime":1640853189,"is_pvip":false,"replies":[{"id":"120035","content":"æ˜¯çš„ï¼Œæ„Ÿè°¢åˆ†äº«","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1345199","ctime":1641434944,"ip_address":"","comment_id":328725,"utype":1}],"discussion_count":1,"race_medal":0,"score":"9.2233720427906007e+18","product_id":100078401,"comment_content":"éœ€è¦æ·»åŠ -g çš„åœ°æ–¹å¦‚ä¸‹ï¼š<br><br>1:initldr&#47;build&#47;krnlbuildcmd.mhæ–‡ä»¶ä¸­<br>BTCFLGS ,CFLAGS,CPPFLGSLDSä¸‰å¤„éœ€è¦æ·»åŠ -O0 -g<br><br>2:å¤–å±‚buildæ–‡ä»¶å¤¹é‡Œçš„pretreatment.mkfçš„CPPFLGSLDSåé¢ä¹Ÿæ·»åŠ -O0 -g<br><br>ç¼–è¯‘è¦å°±å¯ä»¥å®‰è£…æ–‡ç« ä¸­æ“ä½œè¾¹è°ƒè¯•è¾¹æ˜¾ç¤ºä»£ç äº†","like_count":1,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544175,"discussion_content":"æ˜¯çš„ï¼Œæ„Ÿè°¢åˆ†äº«","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641434944,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326828,"user_name":"æœˆé¸Ÿ","can_delete":false,"product_type":"c1","uid":2622908,"ip_address":"","ucode":"A5BE34A78CD509","user_header":"https://static001.geekbang.org/account/avatar/00/28/05/bc/52fd87f6.jpg","comment_is_top":false,"comment_ctime":1639711974,"is_pvip":false,"replies":[{"id":"118991","content":"å“ˆå“ˆ èµ¶ç´§è¯•è¯•","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1345199","ctime":1639964549,"ip_address":"","comment_id":326828,"utype":1}],"discussion_count":2,"race_medal":0,"score":"23114548454","product_id":100078401,"comment_content":"æˆ‘æ˜¯æ¿å‡³!<br>åƒå‘¼ä¸‡å”¤å§‹å‡ºæ¥ï¼Œç­‰è¿™ç¯‡è°ƒè¯•ç­‰äº†3ä¸ªæ˜ŸæœŸäº†!<br>æ„Ÿè°¢ä½ !","like_count":5,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540117,"discussion_content":"å“ˆå“ˆ èµ¶ç´§è¯•è¯•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639964549,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2344081,"avatar":"https://static001.geekbang.org/account/avatar/00/23/c4/91/a017bf72.jpg","nickname":"coconut","note":"","ucode":"07B95C7A6AC2F7","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539436,"discussion_content":"æ¡çˆª","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639715453,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326801,"user_name":"è‹æµéƒå®“","can_delete":false,"product_type":"c1","uid":2729645,"ip_address":"","ucode":"AD07BD9CE03047","user_header":"https://static001.geekbang.org/account/avatar/00/29/a6/ad/e65aec4c.jpg","comment_is_top":false,"comment_ctime":1639704954,"is_pvip":false,"replies":[{"id":"118757","content":"åŠ æ²¹","user_name":"ç¼–è¾‘å›å¤","user_name_real":"ç¼–è¾‘","uid":"1501385","ctime":1639747968,"ip_address":"","comment_id":326801,"utype":2}],"discussion_count":2,"race_medal":0,"score":"14524606842","product_id":100078401,"comment_content":"å¾ˆå—ç”¨","like_count":3,"discussions":[{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"å¬æ°´çš„æ¹–","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539547,"discussion_content":"åŠ æ²¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639747968,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2344081,"avatar":"https://static001.geekbang.org/account/avatar/00/23/c4/91/a017bf72.jpg","nickname":"coconut","note":"","ucode":"07B95C7A6AC2F7","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539402,"discussion_content":"ğŸ˜„ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639708309,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326944,"user_name":"æœˆé¸Ÿ","can_delete":false,"product_type":"c1","uid":2622908,"ip_address":"","ucode":"A5BE34A78CD509","user_header":"https://static001.geekbang.org/account/avatar/00/28/05/bc/52fd87f6.jpg","comment_is_top":false,"comment_ctime":1639789933,"is_pvip":false,"replies":[{"id":"118986","content":"6666","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1345199","ctime":1639964422,"ip_address":"","comment_id":326944,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10229724525","product_id":100078401,"comment_content":"å¦‚æœå¤§å®¶æŒ‰ç…§ä½œè€…çš„è¯¦ç»†æ­¥éª¤æ“ä½œæ—¶å‡ºç°å¦‚ä¸‹ä¹‹ç±»çš„é—®é¢˜ï¼š<br>warning: No executable has been specified and target does not support<br>determining executable automatically.  Try using the &quot;file&quot; command.<br>&#47;etc&#47;gdb&#47;gdbinit:3: Error in sourced command file:<br>Remote &#39;g&#39; packet reply is too long (expected 308 bytes, got 608 bytes): 0000000000000000685301020080ffff0000000000000000ac2d00020080fffffe000000000000000000000000000000b0ff08000080ffff88ff08000080ffffff0000000000000000000000000000000000000000000000b025010000000000000000000000000000000000000000000000000000000000685301020080ffffe52d00020080ffff4600200008000000100000001000<br>è¿™ä¸ªé—®é¢˜æ˜¯GDBè°ƒè¯•64ä½Kernelæ—¶æ‰æœ‰çš„ï¼Œè§£å†³çš„æ–¹æ³•æ˜¯åœ¨è¿›è¡Œgdbæ“ä½œå‰å…ˆåœ¨(gdb)åé¢æ‰§è¡Œå¦‚ä¸‹è¯­å¥ï¼š<br>(gdb) set architecture i386:x86-64:intel<br>(gdb) target remote:1234<br>Remote debugging using :1234<br>(gdb) symbol-file Cosmos&#47;build&#47;Cosmos.elf <br>Reading symbols from Cosmos&#47;build&#47;Cosmos.elf...<br>(gdb) b *0x04000000<br>Breakpoint 1 at 0x4000000<br>(gdb) b *0x04000068<br>Breakpoint 3 at 0x4000068<br>(gdb) c<br>Continuing.<br><br>ç©å§ï¼<br><br>","like_count":2,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540112,"discussion_content":"6666","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639964422,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":348032,"user_name":"æ‘˜æ˜Ÿ","can_delete":false,"product_type":"c1","uid":2694205,"ip_address":"","ucode":"55D8CAFC938F91","user_header":"https://static001.geekbang.org/account/avatar/00/29/1c/3d/76465ee4.jpg","comment_is_top":false,"comment_ctime":1654677006,"is_pvip":false,"replies":[{"id":"126874","content":"å¯èƒ½æ˜¯æ²¡åšå¯¹","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1345199","ctime":1654911671,"ip_address":"","comment_id":348032,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1654677006","product_id":100078401,"comment_content":"åšå®Œä¸Šé¢æµç¨‹å æœ€åä½¿ç”¨ qemu-system-x86_64 -drive format=raw,file=hd.img -m 512M -cpu kvm64,smep,smap -s è¿™ä¸ªå‘½ä»¤ï¼Œqemuå¯åŠ¨äº†ï¼Œåˆ°grubèœå•å‡ ç§’å ä¾ç„¶å¼¹å‡º é”™è¯¯æç¤ºï¼š&quot;My computer is not support ACPI&quot; å•Šï¼Ÿ æˆ‘å·²ç»ç¡®å®šé‚£ä¸ªinit_acpidå‡½æ•°å·²ç»æ³¨é‡Šäº†ï¼Œä¹ŸæŒ‰ç…§æ­¥éª¤ å°†hd.imgæ›´æ–°äº†ã€‚","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575513,"discussion_content":"å¯èƒ½æ˜¯æ²¡åšå¯¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654911671,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":339751,"user_name":"ç£Š","can_delete":false,"product_type":"c1","uid":2624931,"ip_address":"","ucode":"5C047DFEAF7F2E","user_header":"https://static001.geekbang.org/account/avatar/00/28/0d/a3/9757c66c.jpg","comment_is_top":false,"comment_ctime":1648354830,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1648354830","product_id":100078401,"comment_content":"info all registers æ€ä¹ˆçœ‹ä¸åˆ°cr0å¯„å­˜å™¨ï¼Œæœç´¢äº†ä¸€åœˆï¼Œä¹Ÿæ²¡æ‰¾åˆ°gdbèƒ½æ˜¾ç¤ºcr0è¿™ä¸€ç±»æ§åˆ¶å¯„å­˜å™¨çš„ï¼Œè¯·æ•™ä¸‹ä¸Šå›¾gdbè¿™ä¸ªæ€ä¹ˆå‡ºæ¥çš„ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2624931,"avatar":"https://static001.geekbang.org/account/avatar/00/28/0d/a3/9757c66c.jpg","nickname":"ç£Š","note":"","ucode":"5C047DFEAF7F2E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558963,"discussion_content":"è¡¥å……ä¸‹ï¼šéœ€è¦ä½¿ç”¨qemué«˜ç‰ˆæœ¬æ‰è¡Œï¼Œä¹‹å‰ç”¨2.0ä¸è¡Œï¼Œç°åœ¨ç”¨5.0å¯ä»¥çœ‹åˆ°cr0å¯„å­˜å™¨ä¿¡æ¯ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648532705,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}