{"id":143277,"title":"16 | APNsï¼šèŠä¸€èŠç¬¬ä¸‰æ–¹ç³»ç»Ÿçº§æ¶ˆæ¯é€šé“çš„äº‹","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯è¢æ­¦æ—ã€‚</p><p>å‰é¢å‡ èŠ‚è¯¾é‡Œï¼Œæˆ‘è®²åˆ°åœ¨å³æ—¶æ¶ˆæ¯åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ä¼šä¾èµ–æœåŠ¡ç«¯æ¨é€æŠ€æœ¯æ¥æå‡æ¶ˆæ¯åˆ°è¾¾çš„å®æ—¶æ€§ï¼Œä»¥åŠé€šè¿‡å„ç§æ‰‹æ®µæ¥ä¿è¯æ¶ˆæ¯æ”¶å‘é€šé“çš„å¯ç”¨æ€§ï¼Œä»è€Œè®©æ¶ˆæ¯èƒ½å°½é‡å®æ—¶ã€ç¨³å®šåœ°ç»™åˆ°æ¥æ”¶äººã€‚</p><p>ä½†åœ¨å®é™…æƒ…å†µä¸­ï¼Œå‡ºäºå„ç§åŸå› ï¼ŒAppä¸æœåŠ¡ç«¯çš„é•¿è¿æ¥ä¼šç»å¸¸æ–­å¼€ã€‚æ¯”å¦‚ï¼Œç”¨æˆ·å½»åº•å…³é—­äº†Appï¼Œæˆ–è€…Appåˆ‡æ¢åˆ°åå°ä¸€æ®µæ—¶é—´åï¼Œæ‰‹æœºæ“ä½œç³»ç»Ÿä¸ºäº†èŠ‚çœèµ„æºï¼Œä¼šæ€æ‰è¿›ç¨‹æˆ–è€…ç¦æ­¢è¿›ç¨‹çš„ç½‘ç»œåŠŸèƒ½ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯æ¥æ”¶æ–¹å°±æ²¡æœ‰åŠæ³•é€šè¿‡Appå’ŒIMæœåŠ¡ç«¯çš„é•¿è¿æ¥æ¥è¿›è¡Œæ¶ˆæ¯æ¥æ”¶äº†ã€‚</p><p>é‚£æœ‰æ²¡æœ‰åŠæ³•ï¼Œèƒ½è®©æ¶ˆæ¯åœ¨Appè¢«å…³é—­æˆ–è€…ç½‘ç»œåŠŸèƒ½è¢«é™åˆ¶çš„æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½å‘é€åˆ°æ¥æ”¶äººçš„è®¾å¤‡å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šæœ‰ã€‚</p><p>ç°åœ¨æ‰‹æœºå¸¸ç”¨çš„iOSå’ŒAndroidç³»ç»Ÿï¼Œéƒ½æä¾›äº†æ ‡å‡†çš„ç³»ç»Ÿçº§ä¸‹å‘é€šé“ï¼Œè¿™ä¸ªé€šé“æ˜¯ç³»ç»Ÿæä¾›å•†ç»´æŠ¤çš„ä¸è®¾å¤‡çš„å…¬å…±é•¿è¿æ¥ï¼Œå¯ä»¥ä¿è¯åœ¨Appå…³é—­çš„æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½é€šè¿‡æ‰‹æœºçš„é€šçŸ¥æ æ¥ä¸‹å‘æ¶ˆæ¯ç»™å¯¹åº”çš„æ¥æ”¶äººè®¾å¤‡ã€‚è€Œä¸”ï¼Œå½“ç”¨æˆ·ç‚¹å‡»è¿™äº›é€šçŸ¥æ—¶ï¼Œè¿˜èƒ½é‡æ–°å”¤é†’æˆ‘ä»¬çš„Appï¼Œä¸ä»…èƒ½æå‡æ¶ˆæ¯çš„åˆ°è¾¾ç‡ï¼Œè¿˜å¢åŠ äº†ç”¨æˆ·çš„æ´»è·ƒåº¦ã€‚</p><h2>ç¬¬ä¸‰æ–¹ç³»ç»Ÿä¸‹å‘é€šé“</h2><p>å¸¸è§çš„ç¬¬ä¸‰æ–¹ç³»ç»Ÿä¸‹å‘é€šé“ï¼Œæœ‰iOSç«¯çš„APNsï¼Œä»¥åŠAndroidç«¯çš„GCMå’Œå‚å•†ç³»ç»Ÿé€šé“ã€‚</p><ul>\n<li>iOSç«¯çš„APNsï¼ˆApple Push Notification serviceï¼Œè‹¹æœæ¨é€é€šçŸ¥æœåŠ¡ï¼‰ï¼Œæ˜¯ç‹¬ç«‹äºåº”ç”¨ä¹‹å¤–ï¼Œä¾æ‰˜ç³»ç»Ÿå¸¸é©»è¿›ç¨‹æ¥ç»´æŠ¤å’Œè‹¹æœæœåŠ¡å™¨çš„å…¬å…±é•¿è¿æ¥ï¼Œè´Ÿè´£å…¨å±€çš„ç³»ç»Ÿæ¨é€æœåŠ¡ã€‚</li>\n<li>åœ¨Androidç«¯ä¸Šï¼Œæœ‰Googleçš„GCMï¼ˆGoogle Cloud Messageï¼ŒGoogleäº‘æ¶ˆæ¯ä¼ é€’ï¼‰ã€‚ä½†GCMç”±äºæŸäº›æŠ€æœ¯åŸå› ï¼ˆå¦‚NATè¶…æ—¶å¤ªé•¿ã€æš´éœ²çš„5228ç«¯å£è¿é€šæ€§å·®ç­‰ï¼‰å’ŒæŸäº›éæŠ€æœ¯åŸå› ï¼ˆéœ€è¦å’ŒGoogleæœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼‰ï¼ŒAndroidç«¯çš„GCMåœ¨å›½å†…è¢«å¤§éƒ¨åˆ†æ‰‹æœºå‚å•†å®šåˆ¶åŒ–åç›´æ¥å»æ‰ï¼Œå¹¶æ›¿æ¢æˆäº†å„è‡ªçš„ç³»ç»Ÿé€šé“ã€‚ç›®å‰å›½å†…Androidçš„ç³»ç»Ÿçº§ä¸‹å‘é€šé“åŸºæœ¬éƒ½æ˜¯å‚å•†é€šé“ï¼Œç›®å‰å·²çŸ¥çš„æœ‰5å®¶ï¼šå°ç±³ã€åä¸ºã€vivoã€OPPOã€é­…æ—ã€‚</li>\n</ul><!-- [[[read_end]]] --><h3>APNs</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥äº†è§£ä¸€ä¸‹iOSç«¯çš„ç³»ç»Ÿæ¨é€æœåŠ¡APNsã€‚</p><p>ä¸‹é¢å€Ÿç”¨è‹¹æœå®˜ç½‘çš„ä¸€å¼ å›¾æ¥ç®€å•è¯´æ˜ä¸€ä¸‹ï¼Œå½“Appåœ¨æ²¡æœ‰æ‰“å¼€çš„æƒ…å†µä¸‹ï¼Œ<a href=\"https://developer.apple.com/library/archive/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/APNSOverview.html#//apple_ref/doc/uid/TP40008194-CH8-SW1\">æ¶ˆæ¯é€šè¿‡APNsä¸‹å‘åˆ°è®¾å¤‡</a>çš„è¿‡ç¨‹ï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/16/d6/16268357f80806572fe74f589b2d18d6.png?wh=1142*440\" alt=\"\"></p><ul>\n<li>é¦–å…ˆï¼ŒProviderï¼ˆä¹Ÿå°±æ˜¯IMæœåŠ¡å™¨ï¼‰æŠŠæ¶ˆæ¯é€šè¿‡é•¿è¿æ¥å‘é€åˆ°APNsä¸Šï¼›</li>\n<li>ç´§æ¥ç€ï¼ŒAPNsæŠŠæ¶ˆæ¯æ¨é€åˆ°æ¥æ”¶æ–¹ç”¨æˆ·çš„iOSè®¾å¤‡ç«¯ï¼Œå¹¶åœ¨è®¾å¤‡çš„é€šçŸ¥æ è¿›è¡Œå±•ç¤ºï¼›</li>\n<li>æœ€åï¼Œç”¨æˆ·é€šè¿‡ç‚¹å‡»é€šçŸ¥ç­‰æ“ä½œå¯ä»¥å”¤é†’Appï¼Œæ¥è¿›è¡Œä¸€ç³»åˆ—çš„äº¤äº’æ´»åŠ¨ã€‚</li>\n</ul><p>æ•´ä¸ªæµç¨‹çœ‹èµ·æ¥æ¯”è¾ƒç®€å•ã€‚ä½†ä»”ç»†æ€è€ƒåï¼Œä½ å¯èƒ½ä¼šå¯¹å…¶ä¸­çš„å‡ ä¸ªåœ°æ–¹äº§ç”Ÿç–‘æƒ‘ï¼Œæ¯”å¦‚ï¼ŒAPNsæ˜¯å¦‚ä½•è¯†åˆ«Appçš„ç”¨æˆ·åœ¨å“ªå°è®¾å¤‡ä¸Šï¼Ÿè¿˜æœ‰IMæœåŠ¡å™¨æ˜¯å¦‚ä½•å‘ŠçŸ¥APNsï¼Œåº”è¯¥æŠŠæ¶ˆæ¯æ¨é€ç»™å“ªä¸ªè®¾å¤‡çš„å“ªä¸ªAppå‘¢ï¼Ÿ</p><p>åˆ«ç€æ€¥ï¼Œä¸‹é¢æˆ‘å°±å¸¦ä½ æ¥äº†è§£ä¸€ä¸‹ï¼Œè¿™ä¸¤ä¸ªé—®é¢˜åœ¨æŠ€æœ¯ä¸Šæ˜¯æ€ä¹ˆè§£å†³çš„ã€‚</p><p>å…ˆäº†è§£ä¸€ä¸ªæ¦‚å¿µå§ï¼šDeviceTokenã€‚</p><p><strong>ä»€ä¹ˆæ˜¯DeviceTokenï¼Ÿ</strong>DeviceTokenæ˜¯APNsç”¨äºåŒºåˆ†è¯†åˆ«ä¸åŒiOSè®¾å¤‡åŒä¸€ä¸ªAppçš„å”¯ä¸€æ ‡è¯†ï¼ŒAPNsçš„ç½‘å…³å’Œè®¾å¤‡é€šä¿¡æ—¶ï¼Œé€šè¿‡ç³»ç»Ÿé»˜è®¤è‡ªå¸¦çš„é•¿è¿æ¥è¿›è¡Œè¿æ¥ï¼Œå¹¶é€šè¿‡DeviceTokenä½œä¸ºå½“å‰è¿æ¥è®¾å¤‡çš„å”¯ä¸€æ ‡è¯†è¿›è¡Œç³»ç»Ÿæ¶ˆæ¯çš„æ¨é€ã€‚</p><p>è¦é€šè¿‡APNså®ç°ç³»ç»Ÿæ¨é€ï¼Œæˆ‘ä»¬çš„æ¨é€æœåŠ¡ï¼ˆProviderï¼‰éœ€è¦å…ˆå’ŒAPNså»ºç«‹é•¿è¿ï¼Œå»ºè¿æ—¶æºå¸¦çš„è¯ä¹¦åŒ…å«â€œå‡†å¤‡æ¥æ”¶â€ç³»ç»Ÿæ¶ˆæ¯æ¨é€çš„Appçš„Bundle Identifierï¼ˆBundle Identifieræ˜¯ä¸€æ¬¾Appçš„å”¯ä¸€æ ‡è¯†ï¼‰ã€‚</p><p>æ¯å½“æˆ‘ä»¬æœ‰æ¶ˆæ¯éœ€è¦æ¨é€æ—¶ï¼Œéƒ½å¿…é¡»è¿åŒæ¶ˆæ¯ï¼Œå†æºå¸¦å¾…æ¥æ”¶ç³»ç»Ÿè®¾å¤‡çš„DeviceTokenç»™åˆ°APNsã€‚APNsé€šè¿‡è¿™ä¸ªDeviceTokenï¼Œå°±èƒ½æ‰¾åˆ°å¯¹åº”çš„è¿æ¥è®¾å¤‡ï¼Œä»è€Œå°±å¯ä»¥æŠŠæ¶ˆæ¯é€šè¿‡APNså’Œè®¾å¤‡é—´çš„é•¿è¿æ¥ï¼Œæ¨é€ç»™è¿™å°è®¾å¤‡ä¸Šçš„Appäº†ã€‚å…·ä½“çš„æµç¨‹ä½ å¯ä»¥å‚è€ƒä¸‹é¢è¿™å¼ <a href=\"https://developer.apple.com/library/archive/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/APNSOverview.html#//apple_ref/doc/uid/TP40008194-CH8-SW1\">å®˜ç½‘å›¾</a>ã€‚<br>\n<img src=\"https://static001.geekbang.org/resource/image/11/98/11f10590d6455e22e2f04d098be42c98.png?wh=1024*768\" alt=\"\"></p><p><strong>é‚£ä¹ˆï¼ŒDeviceTokenæ˜¯å›ºå®šä¸å˜çš„å—ï¼Ÿ</strong></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨åŒä¸€å°è®¾å¤‡ä¸Šï¼Œè®¾å¤‡çš„DeviceTokenæ˜¯ä¸ä¼šå‘ç”Ÿå˜åŒ–çš„ï¼Œé™¤äº†ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p><ul>\n<li>iOSç³»ç»Ÿå‡çº§åï¼›</li>\n<li>APNså‡ºäºå®‰å…¨ç­‰åŸå› ï¼Œç¦ç”¨äº†è¿™ä¸ªDeviceTokenã€‚</li>\n</ul><p>å› æ­¤ï¼Œå¦‚æœDeviceTokenç”±äºæŸç§åŸå› å‘ç”Ÿå˜åŒ–ï¼Œä½†IMæœåŠ¡ç«¯å¹¶ä¸çŸ¥é“ï¼Œå°±ä¼šå¯¼è‡´IMæœåŠ¡ç«¯æºå¸¦å¤±æ•ˆçš„DeviceTokenç»™åˆ°APNsï¼Œæœ€ç»ˆå¯¼è‡´è¿™æ¬¡ç³»ç»Ÿæ¨é€æ¶ˆæ¯å¤±è´¥ã€‚</p><p>æ‰€ä»¥ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„IMæœåŠ¡ç«¯å¯ä»¥åœ¨æ¯æ¬¡å¯åŠ¨Appæ—¶ï¼Œéƒ½å»è¯·æ±‚APNsæœåŠ¡å™¨è¿›è¡Œæ³¨å†Œï¼Œæ¥è·å–DeviceTokenã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯æ¯æ¬¡è·å–åˆ°çš„DeviceTokenéƒ½ä¸ä¼šå˜ï¼Œé€Ÿåº¦ä¹Ÿæ¯”è¾ƒå¿«ã€‚å®¢æˆ·ç«¯åœ¨é¦–æ¬¡è·å–åˆ°DeviceTokenä¹‹åï¼Œä¼šå…ˆç¼“å­˜åˆ°æœ¬åœ°ï¼Œå¦‚æœä¸‹æ¬¡è·å–åˆ°DeviceTokenåï¼Œå®ƒæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦æˆ‘ä»¬å†è°ƒç”¨IMæœåŠ¡ç«¯è¿›è¡Œæ›´æ–°äº†ã€‚è¿™ä¹Ÿç®—æ˜¯ä¸ªå°æŠ€å·§ï¼Œä½ å¯ä»¥è¯•è¯•çœ‹ã€‚</p><p><strong>é‚£ä¹ˆï¼Œå¦‚æœAppæ²¡æ¥å¾—åŠæ›´æ–°åˆ°IMæœåŠ¡ç«¯ï¼Œä½†DeviceTokenå·²ç»è¿‡æœŸäº†ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</strong></p><p>æœ€æ–°çš„APNsåè®®æ˜¯åŸºäºHTTP/2å®ç°çš„ï¼Œé’ˆå¯¹æ¯æ¡æ¶ˆæ¯çš„æ¨é€ï¼ŒAPNséƒ½ä¼šè¿”å›å¯¹åº”çš„çŠ¶æ€ç æ¥æ˜ç¡®å‘ŠçŸ¥IMæœåŠ¡ç«¯æ­¤æ¬¡çš„æ¶ˆæ¯æ¨é€æˆåŠŸä¸å¦ã€‚</p><p>å½“IMæœåŠ¡ç«¯æŠŠå¾…æ¨é€çš„æ¶ˆæ¯å’ŒDeviceTokenç»™åˆ°APNsæ—¶ï¼ŒAPNsä¼šå…ˆæ£€æŸ¥è¿™ä¸ªDeviceTokenæ˜¯å¦å¤±æ•ˆï¼Œå¦‚æœå·²ç»å¤±æ•ˆï¼Œé‚£ä¹ˆAPNsä¼šè¿”å›ä¸€ä¸ª400çš„HTTPçŠ¶æ€ç ï¼Œæ ¹æ®è¿™ä¸ªçŠ¶æ€ç ï¼ŒIMæœåŠ¡ç«¯å°±å¯ä»¥å¯¹ç»´æŠ¤çš„è¿™ä¸ªå¤±æ•ˆDeviceTokenè¿›è¡Œæ›´æ–°åˆ é™¤ã€‚</p><p>å½“ç„¶ï¼Œè¿™é‡Œæˆ‘æœ‰å¿…è¦è¯´ä¸€ä¸‹ï¼šå½“æˆ‘ä»¬åœ¨ä½¿ç”¨æ—§ç‰ˆçš„APNsåè®®æ—¶ï¼Œå¯èƒ½ä¼šæ¯”è¾ƒéº»çƒ¦ä¸€ç‚¹ï¼Œå› ä¸ºæ—§ç‰ˆçš„APNsåè®®åœ¨åˆ¤æ–­DeviceTokenå¤±æ•ˆæ—¶ï¼Œä¼šæ–­å¼€è¿æ¥ï¼Œè¿™æ—¶å°±éœ€è¦IMæœåŠ¡ç«¯å†é€šè¿‡APNsæä¾›çš„å¦ä¸€ä¸ªFeedbackæ¥å£ï¼Œæ¥å®šæ—¶è·å–è¿™äº›å¤±æ•ˆçš„DeviceTokenï¼Œç„¶ååˆ é™¤æ‰ï¼Œè¿™æ ·ä¸‹æ¬¡æ¨é€æ‰ä¸ä¼šå†ç”¨åˆ°ã€‚</p><h3>APNséƒ½èƒ½å‘å•¥æ¶ˆæ¯ï¼Ÿ</h3><p>äº†è§£äº†DeviceTokençš„ä½œç”¨åï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ï¼Œé€šè¿‡APNséƒ½èƒ½ä¸‹å‘ä»€ä¹ˆæ ·ç±»å‹çš„æ¶ˆæ¯ã€‚</p><p>ä»IMæœåŠ¡ç«¯å‘é€åˆ°APNsçš„æ¯ä¸€æ¡æ¶ˆæ¯ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªPayloadï¼ˆè´Ÿè½½ï¼‰çš„æ•°æ®ç»“æ„ï¼Œè¿™ä¸ªPayloadåŒ…æ‹¬æˆ‘ä»¬è¦å‘é€çš„æ¶ˆæ¯å†…å®¹å’Œä¸€äº›æ¨é€ç›¸å…³çš„æ–¹å¼ç­‰æ•°æ®ä¿¡æ¯ï¼Œä¸€èˆ¬æ˜¯ä¸€ä¸ªJSONæ ¼å¼çš„å­—ç¬¦ä¸²ã€‚</p><p>è¿™ä¸ªå­—ç¬¦ä¸²å¯èƒ½ä¼šåŒ…æ‹¬ï¼šæ¥æ”¶æ—¶é€šçŸ¥çš„æ ‡é¢˜ã€å­æ ‡é¢˜ã€å…·ä½“é€šçŸ¥çš„å†…å®¹ï¼Œä»¥åŠAppçš„è§’æ ‡æ•°æ˜¯å¤šå°‘ã€æ¥æ”¶æ—¶æ’­æ”¾çš„å£°éŸ³ï¼Œç­‰ç­‰ã€‚åŒæ—¶ä¹ŸåŒ…æ‹¬ä¸€äº›è‡ªå®šä¹‰çš„å†…å®¹å­—æ®µï¼Œæ¯”å¦‚ï¼Œç¾¤æ¶ˆæ¯ä¸€èˆ¬è¿˜ä¼šæºå¸¦ç¾¤IDå’Œå…·ä½“çš„è¿™æ¡æ¶ˆæ¯IDï¼Œä¾¿äºç”¨æˆ·ç‚¹å‡»å”¤é†’Appæ—¶èƒ½å¤Ÿè·³è½¬åˆ°ç›¸åº”çš„ç¾¤èŠä¼šè¯ã€‚ä½ å¯ä»¥å‚è€ƒä¸‹é¢è¿™ä¸ªä»£ç è®¾è®¡ï¼š</p><pre><code>{\n   &quot;aps&quot;: {\n       &quot;alert : {\n  \t  &quot;title&quot;: â€œæ–°æ¶ˆæ¯â€,           //æ ‡é¢˜\n          &quot;subtitle&quot;: â€œæ¥è‡ªï¼š å¼ ä¸‰â€,   //å‰¯æ ‡é¢˜\n  \t  &quot;body&quot;: â€œä½ å¥½â€              //æ­£æ–‡å†…å®¹  \n       },\n       &quot;badge&quot;: 1,                   //è§’æ ‡æ•°å­—\n       &quot;sound&quot;: &quot;default&quot;            //æ”¶åˆ°é€šçŸ¥æ—¶æ’­æ”¾çš„å£°éŸ³\n    },\n    &quot;groupID&quot;: â€œ123â€,\n    &quot;mid&quot;: &quot;1001&quot;\n}\n</code></pre><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šPayloadçš„å¤§å°æ˜¯æœ‰é™åˆ¶çš„ï¼ŒiOS 8ä¹‹å‰æ˜¯256Bï¼ŒiOS 8ä¹‹åæ˜¯2KBã€‚åœ¨iOS 10ä»¥åï¼Œæ¨é€çš„æ¶ˆæ¯Payloadå¤§å°è°ƒæ•´ä¸ºäº†4KBã€‚å¦å¤–ï¼ŒiOS 10ä¹‹å‰åªèƒ½æ¨é€æ–‡å­—ï¼Œè€Œåœ¨å®ƒä¹‹åå¯ä»¥æ”¯æŒä¸»æ ‡é¢˜ã€å‰¯æ ‡é¢˜ï¼Œè¿˜èƒ½æ”¯æŒé™„ä»¶ã€‚</p><h3>é™é»˜æ¨é€</h3><p>é™¤äº†å‘é€å„è‡ªé€šçŸ¥æ å¼¹çª—çš„å¼ºæé†’æ¨é€å¤–ï¼ŒAPNsè¿˜æ”¯æŒâ€œé™é»˜æ¨é€â€ã€‚</p><p>â€œé™é»˜æ¨é€â€æ˜¯iOS 7ä¹‹åæ¨å‡ºçš„ä¸€ç§è¿œç¨‹ç³»ç»Ÿæ¨é€ç±»å‹ï¼Œå®ƒçš„ç‰¹è‰²å°±æ˜¯æ²¡æœ‰æ–‡å­—å¼¹çª—ï¼Œæ²¡æœ‰å£°éŸ³ï¼Œä¹Ÿæ²¡æœ‰è§’æ ‡ï¼Œå¯ä»¥åœ¨ä¸æ‰“æ‰°ç”¨æˆ·çš„æƒ…å†µä¸‹ï¼Œæ‚„æ— å£°æ¯åœ°å”¤é†’Appæ¥è¿›è¡Œä¸€äº›æ›´æ–°æ“ä½œã€‚</p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€œé™é»˜æ¨é€â€æ¥æ¯å¤©å®šç‚¹æ¨é€æ¶ˆæ¯ï¼Œè®©æŸäº›Appåœ¨åå°é™é»˜åœ°å»æ›´æ–°è®¢é˜…å·çš„æ–‡ç« å†…å®¹ï¼Œè¿™æ ·ç”¨æˆ·æ‰“å¼€Appæ—¶å°±èƒ½ç›´æ¥çœ‹åˆ°ï¼Œä¸éœ€è¦å†å»æœåŠ¡ç«¯æ‹‰å–æˆ–è€…ç­‰å¾…æœåŠ¡ç«¯çš„ç¦»çº¿æ¨é€äº†ã€‚</p><h2>APNsçš„ç¼ºé™·</h2><p>äº†è§£äº†APNsçš„å®ç°æœºåˆ¶å’Œèƒ½åŠ›ï¼Œä½ å¯èƒ½ä¼šæ¯”è¾ƒå›°æƒ‘ï¼šæ—¢ç„¶APNsèƒ½å¤Ÿåšåˆ°Appæ‰“å¼€æˆ–è€…å…³é—­çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡ç³»ç»Ÿé€šçŸ¥æŠŠæ¶ˆæ¯æ¨é€ç»™ç”¨æˆ·ï¼Œé‚£å¥½åƒä¹Ÿä¸éœ€è¦æˆ‘ä»¬å†å»å®ç°è‡ªå·±ç»´æŠ¤ä¸€æ¡Appå’ŒIMæœåŠ¡å™¨çš„é•¿è¿æ¥äº†ï¼Ÿé€šè¿‡APNsçš„ç³»ç»Ÿé€šçŸ¥çš„è·³è½¬ï¼Œå»å”¤é†’Appåï¼Œå†æ ¹æ®æœªè¯»æ•°ä»æœåŠ¡ç«¯æ‹‰å–æœªè¯»æ¶ˆæ¯ï¼Œå¥½åƒä¹Ÿæ²¡é—®é¢˜å•Šï¼Ÿ</p><p>æ—¢ç„¶å¦‚æ­¤ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆå¤§éƒ¨åˆ†å³æ—¶æ¶ˆæ¯ç³»ç»Ÿè¿˜æ˜¯è¦è‡ªå·±ç»´æŠ¤ä¸€æ¡é•¿è¿é€šé“å‘¢ï¼Ÿä¸»è¦åŸå› æ˜¯ç”±äºAPNsæœ¬èº«è¿˜å­˜åœ¨ä¸€äº›ç¼ºé™·ã€‚</p><h3>å¯é æ€§ä½</h3><p>APNsçš„ç¬¬ä¸€ä¸ªç¼ºé™·å°±æ˜¯å¯é æ€§æ²¡æœ‰ä¿éšœã€‚è¿™åº”è¯¥æ˜¯è‹¹æœå®˜æ–¹å‡ºäºç»´æŠ¤æˆæœ¬çš„è€ƒè™‘ï¼ŒAPNså¹¶ä¸èƒ½ä¿è¯æ¨é€æ¶ˆæ¯çš„åˆ°è¾¾ç‡ï¼Œä¹Ÿä¸èƒ½ä¿è¯æ¶ˆæ¯ä¸å‘ç”Ÿå»¶è¿Ÿã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ è¦æ¨é€çš„æ¶ˆæ¯ç»™åˆ°äº†APNsï¼Œä½†APNså¹¶ä¸èƒ½ä¿è¯è¿™æ¡æ¶ˆæ¯èƒ½çœŸæ­£æ¨é€åˆ°ç”¨æˆ·è®¾å¤‡ä¸Šï¼Œè€Œä¸”ä¹Ÿæ— æ³•ä¿éšœæ¶ˆæ¯ä¸å‘ç”Ÿå»¶è¿Ÿï¼Œå¯èƒ½ä½ ç»™åˆ°APNsçš„æ¶ˆæ¯éœ€è¦å‡ åˆ†é’Ÿåç”¨æˆ·æ‰æ”¶åˆ°ï¼Œè¿™ä¸ªç°è±¡ç”¨è¿‡iPhoneçš„ç”¨æˆ·ä¼°è®¡åº”è¯¥éƒ½ç¢°åˆ°è¿‡ã€‚</p><h3>ç¦»çº¿æ¶ˆæ¯çš„æ”¯æŒå·®</h3><p>é™¤äº†å¯èƒ½ä¸¢æ¶ˆæ¯å’Œå»¶è¿Ÿé«˜çš„é£é™©å¤–ï¼ŒAPNsçš„å¦ä¸€ä¸ªç¼ºé™·å°±æ˜¯æ— æ³•ä¿éšœç¦»çº¿æ¶ˆæ¯çš„å­˜å‚¨ã€‚å½“ç”¨æˆ·çš„è®¾å¤‡ç¦»çº¿æˆ–è€…å…³æœºæ—¶ï¼ŒAPNså°±æ²¡æœ‰åŠæ³•é©¬ä¸ŠæŠŠæ¶ˆæ¯é€è¾¾ç»™ç”¨æˆ·ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœAPNséœ€è¦å‘ä½ è¿™å°è®¾å¤‡å‘é€å¤šæ¡æ¨é€æ—¶ï¼Œå°±ä¼šå¯åŠ¨å®ƒçš„QoSï¼ˆQuality of Serviceï¼ŒæœåŠ¡è´¨é‡ï¼‰æœºåˆ¶ï¼Œåªä¿ç•™ç»™ä½ æœ€æ–°çš„ä¸€æ¡æ¶ˆæ¯ï¼Œåœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œå°±ä¼šå­˜åœ¨ä¸¢å¤±ç¦»çº¿æ¶ˆæ¯çš„é—®é¢˜ã€‚</p><p>å‡ºç°è¿™ç§é—®é¢˜çš„ä¸»è¦åŸå› åº”è¯¥ä¹Ÿæ˜¯å‡ºäºå­˜å‚¨æˆæœ¬æ–¹é¢çš„è€ƒè™‘ï¼Œç”±äºAPNsçš„æ¶ˆæ¯æ¥æ”¶é‡æ•´ä½“åŸºæ•°å¤ªå¤§ï¼Œå¤§é‡çš„å­˜å‚¨å’Œè½¬å‘å¯¹æœåŠ¡å™¨çš„èµ„æºæ¶ˆè€—éå¸¸å¤§ï¼Œå‡ºäºæˆæœ¬è€ƒè™‘ï¼ŒAPNså°±ä¼šä¸¢æ‰ä¸€éƒ¨åˆ†ç¦»çº¿æ¶ˆæ¯ã€‚</p><h3>è§’æ ‡ç´¯åŠ é—®é¢˜</h3><p>é™¤æ­¤ä¹‹å¤–ï¼ŒAPNsè¿˜æœ‰ä¸€ä¸ªå°åæ§½ç‚¹æ˜¯ï¼šå¯¹äºè§’æ ‡çš„æœªè¯»æ•°ï¼ŒAPNsä¸æ”¯æŒç´¯è®¡+1æ“ä½œï¼Œåªæ”¯æŒè¦†ç›–åŸæ¥çš„è§’æ ‡æœªè¯»æ•°ã€‚æ‰€ä»¥åœ¨æ¯æ¡æ¶ˆæ¯ä¸‹æ¨æ—¶ï¼ŒAPNsè¿˜éœ€è¦æŠŠè¿™ä¸ªç”¨æˆ·çš„æ€»æœªè¯»æ¶ˆæ¯æ•°ä¸€èµ·å¸¦ä¸‹å»ï¼Œå¯¹åç«¯æœªè¯»æ•°æœåŠ¡æ¥è¯´ä¼šå¢åŠ é¢å¤–çš„è°ƒç”¨å‹åŠ›ï¼Œè€ŒAndroidç«¯çš„å‚å•†é€šé“å°±ç›¸å¯¹æ›´å‹å¥½ä¸€äº›ï¼Œå¾ˆå¤šå‚å•†çš„è§’æ ‡æœªè¯»æ”¯æŒæ ¹æ®æ¥æ”¶åˆ°çš„é€šçŸ¥æ¶ˆæ¯è‡ªåŠ¨ç´¯åŠ çš„ç‰¹æ€§ã€‚</p><h2>Androidçš„å‚å•†é€šé“</h2><p>å¯¹äºAndroidç«¯æ¥è¯´ï¼Œåº”ç”¨çš„åå°ä¿æ´»ä¸€ç›´æ˜¯æå‡æ¶ˆæ¯åœ¨çº¿æ¨é€åˆ°è¾¾ç‡çš„é‡è¦æ‰‹æ®µï¼Œå¾ˆå¤šæ“ä½œç³»ç»Ÿé»˜è®¤çš„é…ç½®æ˜¯ï¼šåˆ‡åˆ°åå°ä¸€æ®µæ—¶é—´åï¼Œä¼šç›´æ¥æ€æ‰è¿›ç¨‹æˆ–è€…è®©è¿›ç¨‹æ–­ç½‘ã€‚</p><p>è™½ç„¶Appé—´æœ‰äº’ç›¸æ‹‰èµ·è¿›ç¨‹çš„å–å·§æ–¹å¼ï¼Œä»¥åŠç³»ç»Ÿå‚å•†ç»™æŸäº›è¶…çº§Appï¼ˆæ¯”å¦‚å¾®ä¿¡ï¼‰çš„ä¿æ´»ç™½åå•æœºåˆ¶ï¼Œä½†å¯¹äºå¤§éƒ¨åˆ†Appæ¥è¯´ï¼Œè¿˜æ˜¯éœ€è¦åœ¨Appè¢«æ€æ­»æˆ–è€…è¢«é™åˆ¶çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡å‚å•†çš„ç³»ç»Ÿé€šé“æ¨é€æ¶ˆæ¯ï¼Œä»¥æ­¤æå‡æ•´ä½“çš„æ¶ˆæ¯åˆ°è¾¾ç‡ã€‚</p><p>å¯¹äºå¼€å¤´æˆ‘æåˆ°çš„5å®¶å‚å•†é€šé“çš„æ¥å…¥ï¼Œå®ƒä»¬éƒ½æä¾›äº†ä¸“é—¨çš„SDKï¼ˆSoftware Development Kitï¼Œè½¯ä»¶å¼€å‘å·¥å…·åŒ…ï¼‰ï¼Œè¿™äº›å‚å•†SDKèƒ½å¤Ÿæ”¯æŒçš„åŠŸèƒ½ï¼Œå¤§è‡´ä¸Šå’ŒAPNsæ¯”è¾ƒç±»ä¼¼ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†å±•å¼€äº†ï¼Œä½ å¯ä»¥è‡ªè¡Œäº†è§£ä¸€ä¸‹ã€‚</p><p>ä¸è¿‡å€¼å¾—è¯´ä¸€ä¸‹çš„æ˜¯ï¼Œç”±äºå„å®¶SDKä½¿ç”¨ä¸Šå„å¼‚ï¼Œå¼€å‘æ¥å…¥æˆæœ¬ä¼šç›¸å¯¹è¾ƒé«˜ï¼Œå› æ­¤å¸‚é¢ä¸Šè¿˜æœ‰å¾ˆå¤šç¬¬ä¸‰æ–¹çš„PushæœåŠ¡ï¼Œè¿™äº›ç¬¬ä¸‰æ–¹çš„PushæœåŠ¡æ•´åˆäº†å¤šå®¶å‚å•†çš„SDKï¼Œå¯¹å¤–æä¾›ç»Ÿä¸€çš„æ¥å…¥ï¼Œé™ä½äº†å¯¹æ¥é—¨æ§›ï¼Œæ¯”å¦‚ä¸ªæ¨ã€ä¿¡é¸½ã€æå…‰ã€å‹ç›Ÿç­‰ã€‚</p><h2>å›½å†…ç»Ÿä¸€æ¨é€è”ç›Ÿ</h2><p>ç”±äºå›½å†…å„ä¸ªå‚å•†ç³»ç»Ÿæ¨é€é€šé“çš„å·®å¼‚æ€§ï¼Œé€ æˆAndroidç«¯ç³»ç»Ÿæ¨é€æ•´ä½“ä¸Šçš„æ··ä¹±å’Œå¤æ‚æ€§ã€‚ä¸ºæ­¤åœ¨2017å¹´ï¼Œä¸­åäººæ°‘å…±å’Œå›½å·¥ä¸šå’Œä¿¡æ¯åŒ–éƒ¨ï¼ˆç®€ç§°å·¥ä¿¡éƒ¨ï¼‰ä¸»å¯¼æˆç«‹äº†å®‰å“ç»Ÿä¸€æ¨é€è”ç›Ÿï¼Œè”åˆå„å¤§æ‰‹æœºå‚å•†å’Œè¿è¥å•†å…±åŒæ¨å‡ºäº†â€œæ¨å¿…è¾¾â€äº§å“ï¼Œå¯¹æ ‡çš„æ˜¯è‹¹æœçš„APNså’ŒGoogleçš„GCMã€‚</p><p>æ ¹æ®å®˜ç½‘çš„ä»‹ç»ï¼Œâ€œæ¨å¿…è¾¾â€é™¤äº†é€šè¿‡ä¼ ç»Ÿçš„TCPé•¿è¿ç½‘ç»œæ¥è¿›è¡Œç³»ç»Ÿæ¶ˆæ¯çš„ä¸‹æ¨å¤–ï¼Œè¿˜ä¼šå’Œè¿è¥å•†åˆä½œï¼Œæ”¯æŒé€šè¿‡è¿è¥å•†çš„ä¿¡ä»¤é€šé“æ¥è¿›è¡Œæ¶ˆæ¯ä¸‹æ¨ã€‚å› æ­¤åœ¨æ²¡æœ‰WiFiå’Œç§»åŠ¨ç½‘ç»œçš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬åªè¦æœ‰æ‰‹æœºä¿¡å·ï¼Œä¹Ÿèƒ½æ¥æ”¶åˆ°ç³»ç»Ÿæ¨é€ã€‚</p><p>ä¸‹é¢æ˜¯<a href=\"http://chinaupa.com/\">â€œæ¨å¿…è¾¾â€å®˜ç½‘æä¾›çš„æŠ€æœ¯æ¶æ„å›¾</a>ã€‚ä½ å¯ä»¥çœ‹åˆ°ï¼Œâ€œæ¨å¿…è¾¾â€æä¾›äº†ä¸“é—¨çš„SDKç»™åˆ°å®¢æˆ·ç«¯ï¼Œå½“å„ä¸ªIMæœåŠ¡ç«¯æœ‰æ¶ˆæ¯éœ€è¦é€šè¿‡ç³»ç»Ÿæ¨é€è§¦è¾¾ç”¨æˆ·æ—¶ï¼Œä¼šæŠŠæ¶ˆæ¯ç›´æ¥æˆ–é€šè¿‡ç¬¬ä¸‰æ–¹æ¨é€æœåŠ¡äº¤ç»™å„ä¸ªå‚å•†éƒ¨ç½²çš„UPSæœåŠ¡å™¨ï¼ŒUPSæœåŠ¡å™¨å†é€šè¿‡å’Œå®¢æˆ·ç«¯SDKç»´æŠ¤çš„é•¿è¿æ¥ï¼ŒæŠŠæ¶ˆæ¯æ¨é€ä¸‹å»ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/8b/34/8b7d9c8b9b59d8b9ff56a38d67292f34.jpeg?wh=1319*751\" alt=\"\"></p><p>ç”±äºå…¶æ”¯æŒå¤šç§æ¶ˆæ¯çš„è§¦è¾¾é€”å¾„ï¼Œâ€œæ¨å¿…è¾¾â€çš„æ¶ˆæ¯åˆ°è¾¾ç‡æ®å®˜ç½‘åé¦ˆï¼šåœ¨å…¨å›½34ä¸ªçœå¸‚çš„æµ‹è¯•ï¼Œæ¶ˆæ¯åˆ°è¾¾ç‡ä¸º99.999%ã€‚ç›®å‰ï¼Œå›½å†…ä¸»è¦çš„æ‰‹æœºå‚å•†å¦‚åä¸ºã€å°ç±³ã€OPPOã€vivoç­‰ï¼Œéƒ½å·²ç»åŠ å…¥åˆ°è¿™ä¸ªè”ç›Ÿä¸­ã€‚å¦å¤–ï¼Œå·¥ä¿¡éƒ¨è¦æ±‚åˆ°2019å¹´12æœˆ31æ—¥ï¼Œç°æœ‰çš„å„æ¨é€é€šé“éœ€è¦å…¼å®¹ç»Ÿä¸€æ¨é€æ ‡å‡†ã€‚</p><p>å› æ­¤ï¼Œæˆ‘è®¤ä¸ºå¯¹äºAndroidç«¯çš„ç³»ç»Ÿæ¨é€æ¥è¯´ï¼Œâ€œæ¨å¿…è¾¾â€äº§å“å¦‚æœèƒ½å¤ŸæˆåŠŸè½åœ°ï¼Œåº”è¯¥æ˜¯æœªæ¥ç³»ç»Ÿæ¨é€çš„è¶‹åŠ¿ã€‚</p><h2>å°ç»“</h2><p>å¥½ï¼Œç®€å•å›é¡¾ä¸€ä¸‹ä»Šå¤©è¯¾ç¨‹çš„å†…å®¹ã€‚è¿™ä¸€è®²ï¼Œæˆ‘ä¸»è¦è®²åˆ°äº†æå‡æ¶ˆæ¯æ•´ä½“åˆ°è¾¾ç‡çš„åˆ©å™¨ï¼šç¬¬ä¸‰æ–¹ç³»ç»Ÿæ¨é€ã€‚é€šè¿‡æ‰‹æœºå‚å•†æä¾›çš„ç³»ç»Ÿçº§é•¿è¿æ¨é€æœåŠ¡ï¼Œå¯ä»¥è®©Appåœ¨æ²¡è¢«æ‰“å¼€æˆ–åå°ç½‘ç»œåŠŸèƒ½è¢«ç³»ç»Ÿé™åˆ¶çš„æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½å¤Ÿé€šè¿‡å‚å•†é€šé“å°†æ¶ˆæ¯è§¦è¾¾åˆ°ç”¨æˆ·ã€‚</p><p>åœ¨iOSç«¯ï¼Œæ˜¯ç”±è‹¹æœæä¾›çš„APNsæœåŠ¡æ¥æä¾›ç³»ç»Ÿæ¨é€çš„èƒ½åŠ›ã€‚IMæœåŠ¡å™¨æŠŠå¾…æ¨é€çš„æ¶ˆæ¯è¿åŒå”¯ä¸€æ ‡è¯†æŸå°è®¾å¤‡çš„DeviceTokenï¼Œä¸€èµ·ç»™åˆ°APNsæœåŠ¡å™¨ï¼Œå†ç”±APNsæœåŠ¡å™¨é€šè¿‡ç³»ç»Ÿçº§çš„ä¸ä»»ä½•Appæ— å…³çš„é•¿è¿æ¥ï¼Œæ¥æ¨é€ç»™ç”¨æˆ·è®¾å¤‡å¹¶å±•ç¤ºã€‚æ–°ç‰ˆæœ¬çš„APNsæœåŠ¡æ”¯æŒæ–‡æœ¬ã€éŸ³é¢‘ã€å›¾ç‰‡ç­‰å¤šåª’ä½“æ¶ˆæ¯çš„æ¨é€ï¼Œä»¥åŠæ— ä»»ä½•å¼¹çª—é€šçŸ¥çš„é™é»˜æ¨é€ã€‚</p><p>ä½†æ˜¯APNså¹¶ä¸ä¿è¯æ¶ˆæ¯æ¨é€ä¸å‘ç”Ÿå»¶è¿Ÿï¼Œä¹Ÿä¸ä¿è¯æ¶ˆæ¯èƒ½çœŸæ­£åˆ°è¾¾è®¾å¤‡ï¼Œå¯¹æ¶ˆæ¯å¤§å°ä¹Ÿæœ‰é™åˆ¶ã€‚å› æ­¤ï¼Œåœ¨å¯é æ€§ä¸Šï¼ŒAPNsæ¯”Appè‡ªå»ºçš„é•¿è¿æ¥ä¼šå·®ä¸€äº›ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¹Ÿåªæ˜¯ä½œä¸ºè‡ªå»ºé•¿è¿æ¥ä¸å¯ç”¨æ—¶çš„å¤‡é€‰é€šé“ã€‚</p><p>Androidç«¯ä¸‹ï¼Œç›®å‰å›½å†…ä¸»è¦æ˜¯ç”±å„ä¸ªæ‰‹æœºå‚å•†å„è‡ªç»´æŠ¤çš„å‚å•†é€šé“æ¥æä¾›ç³»ç»Ÿæ¨é€æœåŠ¡ã€‚ç›®å‰å·²çŸ¥æ”¯æŒå‚å•†é€šé“çš„ä¹Ÿåªæœ‰5å®¶ï¼Œè€Œä¸”å„å®¶SDKéƒ½æ²¡æœ‰ç»Ÿä¸€ï¼Œæ‰€ä»¥æ•´ä½“ä¸Šçœ‹ï¼ŒAndroidç«¯çš„æ¨é€æ¥å…¥æ¯”è¾ƒå¤æ‚å’Œæ··ä¹±ã€‚</p><p>ç›®å‰å·¥ä¿¡éƒ¨ä¸»å¯¼çš„â€œç»Ÿä¸€æ¨é€è”ç›Ÿâ€ï¼Œå®ƒçš„ç›®çš„å°±åœ¨äºé€šè¿‡æä¾›ç»Ÿä¸€çš„æ¥å…¥æ–¹å¼ï¼Œä»¥æ­¤è§£å†³è¿™ç§æ··ä¹±çŠ¶å†µã€‚å…¶æ¨å‡ºçš„äº§å“â€œæ¨å¿…è¾¾â€æ”¯æŒåœ¨ç§»åŠ¨ç½‘ç»œä¸å¯ç”¨çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡ç”µä¿¡ä¿¡ä»¤é€šé“æ¥è§¦è¾¾ç”¨æˆ·ï¼Œèƒ½è¿›ä¸€æ­¥æå‡æ¶ˆæ¯çš„åˆ°è¾¾ç‡ï¼Œæ˜¯æˆ‘ä»¬å€¼å¾—æœŸå¾…çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>ç³»ç»Ÿæ¨é€ä½œä¸ºä¸€ç§å¸¸ç”¨çš„è§¦è¾¾ç”¨æˆ·çš„æ–¹å¼ï¼Œå¯¹äºå³æ—¶æ¶ˆæ¯åœºæ™¯æ¥è¯´æ˜¯æå‡æ¶ˆæ¯åˆ°è¾¾ç‡çš„ä¸€æ¡éå¸¸é‡è¦çš„é€”å¾„ã€‚ä½†è¿™äº›ç³»ç»Ÿæ¨é€é€šé“ç›®å‰è¿˜å­˜åœ¨å¯é æ€§ä½ã€åŠŸèƒ½ä¸å®Œå–„ã€ç”Ÿæ€æ··ä¹±ç­‰é—®é¢˜ï¼Œå› æ­¤ï¼Œå¯¹æ¶ˆæ¯å¯é æ€§è¦æ±‚è¾ƒé«˜çš„åœºæ™¯æ¥è¯´ï¼Œç³»ç»Ÿæ¨é€é€šé“åŸºæœ¬ä¸Šåªèƒ½ä½œä¸ºå¯¹è‡ªå»ºé•¿è¿æ¥æ¨é€é€šé“çš„ä¸€ä¸ªè¡¥å……ã€‚ç³»ç»Ÿæ¨é€ä¹Ÿæ˜¯ä¸€é—¨æ™®é€‚æ€§å¾ˆå¼ºçš„æŠ€æœ¯ï¼Œäº†è§£å½“å‰ç³»ç»Ÿæ¨é€çš„ä¸šç•Œç°çŠ¶å’Œè¿›å±•ï¼Œå¯¹äºä½ çš„å‰åç«¯çŸ¥è¯†ä½“ç³»ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è¡¥å……å’Œæ‹“å±•ã€‚</p><p>æœ€åç»™å¤§å®¶ç•™ä¸€ä¸ªæ€è€ƒé¢˜ï¼š<strong>é™é»˜æ¨é€æ”¯æŒçš„â€œå”¤é†’Appåœ¨åå°è¿è¡Œâ€åŠŸèƒ½ï¼Œä½ è§‰å¾—éƒ½æœ‰å“ªäº›åº”ç”¨åœºæ™¯å‘¢ï¼Ÿ</strong></p><p>ä»¥ä¸Šå°±æ˜¯ä»Šå¤©è¯¾ç¨‹çš„å†…å®¹ï¼Œæ¬¢è¿ä½ ç»™æˆ‘ç•™è¨€ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç•™è¨€åŒºä¸€èµ·è®¨è®ºã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæˆ‘ä»¬ä¸‹æœŸå†è§ã€‚</p>","comments":[{"had_liked":false,"id":150166,"user_name":"GeekAmI","can_delete":false,"product_type":"c1","uid":1005030,"ip_address":"","ucode":"232C0B6DFB9F56","user_header":"https://static001.geekbang.org/account/avatar/00/0f/55/e6/87197b10.jpg","comment_is_top":false,"comment_ctime":1573471785,"is_pvip":false,"replies":[{"id":"57911","content":"appå»APNsè·å–devicetokenï¼Œå¦‚æœå‘ç”Ÿäº†å˜åŒ–å†ç”±appä¸ŠæŠ¥ç»™imæœåŠ¡å™¨è¿›è¡Œè®°å½•ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1573563655,"ip_address":"","comment_id":150166,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23048308265","product_id":100034901,"comment_content":"â€œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ IM æœåŠ¡ç«¯å¯ä»¥åœ¨æ¯æ¬¡å¯åŠ¨ App æ—¶ï¼Œéƒ½å»è¯·æ±‚ APNs æœåŠ¡å™¨è¿›è¡Œæ³¨å†Œï¼Œæ¥è·å– DeviceTokenã€‚â€ <br>è€å¸ˆï¼Œè¿™å¥è¯ä¸å¤ªç†è§£ï¼Œåˆ°åº•æ˜¯Appå»APNsè·å–DeviceTokenï¼Œè¿˜æ˜¯IMæœåŠ¡ç«¯è·å–å‘¢ï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474079,"discussion_content":"appå»APNsè·å–devicetokenï¼Œå¦‚æœå‘ç”Ÿäº†å˜åŒ–å†ç”±appä¸ŠæŠ¥ç»™imæœåŠ¡å™¨è¿›è¡Œè®°å½•ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573563655,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":138209,"user_name":"clip","can_delete":false,"product_type":"c1","uid":1019244,"ip_address":"","ucode":"D0E142605A5BD5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/6c/0c2a26c7.jpg","comment_is_top":false,"comment_ctime":1570097350,"is_pvip":true,"replies":[{"id":"53274","content":"devicetokenåªæ˜¯è¯†åˆ«è®¾å¤‡çš„å“ˆï¼Œæ¯å°è®¾å¤‡çš„devicetokenéƒ½ä¸ä¸€æ ·ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1570274723,"ip_address":"","comment_id":138209,"utype":1}],"discussion_count":4,"race_medal":0,"score":"10160031942","product_id":100034901,"comment_content":"â€œDeviceToken æ˜¯ APNs ç”¨äºåŒºåˆ†è¯†åˆ«ä¸åŒ iOS è®¾å¤‡åŒä¸€ä¸ª App çš„å”¯ä¸€æ ‡è¯†â€<br>æ˜¯â€œä¸åŒ iOS è®¾å¤‡ä¸åŒ Appâ€å—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469436,"discussion_content":"devicetokenåªæ˜¯è¯†åˆ«è®¾å¤‡çš„å“ˆï¼Œæ¯å°è®¾å¤‡çš„devicetokenéƒ½ä¸ä¸€æ ·ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570274723,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1024294,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","nickname":"null","note":"","ucode":"F9039EFED6B55D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":46144,"discussion_content":"è€å¸ˆï¼Œdevice token åº”è¯¥ä¸ app æ— å…³å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573125251,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1019244,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8d/6c/0c2a26c7.jpg","nickname":"clip","note":"","ucode":"D0E142605A5BD5","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1024294,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","nickname":"null","note":"","ucode":"F9039EFED6B55D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":46176,"discussion_content":"å½“ç„¶æœ‰å…³ï¼ŒåŒä¸€è®¾å¤‡ä¸Šä¸åŒ app å¾—åˆ°çš„æ˜¯ä¸ä¸€æ ·çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573127925,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":46144,"ip_address":""},"score":46176,"extra":""},{"author":{"id":1024294,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","nickname":"null","note":"","ucode":"F9039EFED6B55D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1019244,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8d/6c/0c2a26c7.jpg","nickname":"clip","note":"","ucode":"D0E142605A5BD5","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":46398,"discussion_content":"å—¯ï¼Œè¿˜æ˜¯æ²¡å¤ªç†è§£è€å¸ˆæ‰€è¯´çš„ï¼š\n1. device token æ˜¯ APNs ç”¨äºåŒºåˆ†è¯†åˆ«ä¸åŒ iOS è®¾å¤‡ã€åŒä¸€ä¸ª Appã€ çš„å”¯ä¸€æ ‡è¯†â€\n2. device tokenåªæ˜¯è¯†åˆ«è®¾å¤‡çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573146563,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":46176,"ip_address":""},"score":46398,"extra":""}]}]},{"had_liked":false,"id":153615,"user_name":"å†¬","can_delete":false,"product_type":"c1","uid":1505572,"ip_address":"","ucode":"86363020AAB7D5","user_header":"https://static001.geekbang.org/account/avatar/00/16/f9/24/c920101e.jpg","comment_is_top":false,"comment_ctime":1574270045,"is_pvip":false,"replies":[{"id":"59884","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1574771763,"ip_address":"","comment_id":153615,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5869237341","product_id":100034901,"comment_content":"è€å¸ˆï¼ŒAppleé™¤äº†é™é»˜æ¨é€ï¼Œè¿˜æœ‰æ›´å¯é çš„Voip æ¨é€å“¦","like_count":1,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475228,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574771763,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":151916,"user_name":"è°¢ç‚³è¾‰","can_delete":false,"product_type":"c1","uid":1268793,"ip_address":"","ucode":"03A43467914D2E","user_header":"https://static001.geekbang.org/account/avatar/00/13/5c/39/6b542136.jpg","comment_is_top":false,"comment_ctime":1573812435,"is_pvip":false,"replies":[{"id":"58815","content":"è¿™é‡Œè¯´çš„æ˜¯æŸäº›åœºæ™¯ä¸‹æ‰‹æœºæ²¡æœ‰ç½‘ç»œä¿¡å·ï¼Œåªæœ‰é€šä¿¡ä¿¡å·ï¼Œä¹Ÿå°±æ˜¯èƒ½æ‰“ç”µè¯èƒ½æ”¶çŸ­ä¿¡ä½†æ˜¯ä¸Šä¸äº†ç½‘ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1574149990,"ip_address":"","comment_id":151916,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5868779731","product_id":100034901,"comment_content":"æ€ä¹ˆç†è§£<br>å› æ­¤åœ¨æ²¡æœ‰ WiFi å’Œç§»åŠ¨ç½‘ç»œçš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬åªè¦æœ‰æ‰‹æœºä¿¡å·å°±èƒ½æ¨é€<br>ä¸æ˜¯æœ‰ä¿¡å·å°±æœ‰ç½‘ç»œäº†å—","like_count":1,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474652,"discussion_content":"è¿™é‡Œè¯´çš„æ˜¯æŸäº›åœºæ™¯ä¸‹æ‰‹æœºæ²¡æœ‰ç½‘ç»œä¿¡å·ï¼Œåªæœ‰é€šä¿¡ä¿¡å·ï¼Œä¹Ÿå°±æ˜¯èƒ½æ‰“ç”µè¯èƒ½æ”¶çŸ­ä¿¡ä½†æ˜¯ä¸Šä¸äº†ç½‘ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574149990,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":150164,"user_name":"GeekAmI","can_delete":false,"product_type":"c1","uid":1005030,"ip_address":"","ucode":"232C0B6DFB9F56","user_header":"https://static001.geekbang.org/account/avatar/00/0f/55/e6/87197b10.jpg","comment_is_top":false,"comment_ctime":1573471699,"is_pvip":false,"replies":[{"id":"57910","content":"appåœ¨åå°è¢«é™é»˜æ¨é€å”¤é†’ååªæœ‰30sçš„åå°è¿è¡Œæ—¶é—´ï¼Œæ‰€ä»¥å»ºç«‹é•¿è¿åå¯èƒ½ä¹Ÿä¼šå¾ˆå¿«å†è¢«ææ–­ã€‚å¯ä»¥è€ƒè™‘ç”¨æ¥è¿›è¡Œä¸€äº›å¤šåª’ä½“æ¶ˆæ¯çš„åå°é¢„æ‹‰å–ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1573563576,"ip_address":"","comment_id":150164,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5868438995","product_id":100034901,"comment_content":"é™é»˜æ¨é€æ˜¯ä¸æ˜¯å¯ä»¥è¿™æ ·æï¼Ÿ<br>é™é»˜æ¨é€-&gt;å”¤èµ·app-&gt;é‡æ–°å»ºç«‹é•¿è¿æ¥é€šé“-&gt;æœåŠ¡ç«¯é€šé“é•¿è¿æ¥é€šé“ä¸‹è¾¾æ¶ˆæ¯ã€‚","like_count":1,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474078,"discussion_content":"appåœ¨åå°è¢«é™é»˜æ¨é€å”¤é†’ååªæœ‰30sçš„åå°è¿è¡Œæ—¶é—´ï¼Œæ‰€ä»¥å»ºç«‹é•¿è¿åå¯èƒ½ä¹Ÿä¼šå¾ˆå¿«å†è¢«ææ–­ã€‚å¯ä»¥è€ƒè™‘ç”¨æ¥è¿›è¡Œä¸€äº›å¤šåª’ä½“æ¶ˆæ¯çš„åå°é¢„æ‹‰å–ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573563576,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":138004,"user_name":"å°å¯","can_delete":false,"product_type":"c1","uid":1006735,"ip_address":"","ucode":"8834AF621FA67D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5c/8f/551b5624.jpg","comment_is_top":false,"comment_ctime":1569977662,"is_pvip":false,"replies":[{"id":"53264","content":"å—¯ï¼Œè¿™ä¸ªåº”è¯¥æ˜¯å¯è¡Œçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1570270581,"ip_address":"","comment_id":138004,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5864944958","product_id":100034901,"comment_content":"appåå°è‡ªåŠ¨å‡çº§(å¦‚æœè®¾ç½®è‡ªåŠ¨æ›´æ–°å‡çº§)","like_count":1,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469348,"discussion_content":"å—¯ï¼Œè¿™ä¸ªåº”è¯¥æ˜¯å¯è¡Œçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570270581,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":357706,"user_name":"è¿½é£ç­çš„äºº","can_delete":false,"product_type":"c1","uid":1488020,"ip_address":"é™•è¥¿","ucode":"2993D60F94C396","user_header":"https://static001.geekbang.org/account/avatar/00/16/b4/94/2796de72.jpg","comment_is_top":false,"comment_ctime":1663575643,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1663575643","product_id":100034901,"comment_content":"æ¨å¿…è¾¾äº§å“è¿˜æ²¡åšå‡ºæ¥ å‡‰äº†åº”è¯¥ï¼ŒåŸŸåä¹Ÿä¸èƒ½è®¿é—®äº†chinaupa.com","like_count":0},{"had_liked":false,"id":351851,"user_name":"è–›å»ºè¾‰","can_delete":false,"product_type":"c1","uid":1165917,"ip_address":"","ucode":"17928DD8497E9C","user_header":"https://static001.geekbang.org/account/avatar/00/11/ca/5d/c35b117c.jpg","comment_is_top":false,"comment_ctime":1658228593,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1658228593","product_id":100034901,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæˆ‘å®é™…å·¥ä½œä¸­é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•æé«˜è‡ªå»ºé•¿è¿æ¥çš„åœ¨çº¿æ¨é€æˆåŠŸç‡ã€‚<br><br>åŸæœ¬å›½å†…çº¿ä¸Šå•æ¬¡æ¨é€æˆåŠŸç‡åœ¨70%å·¦å³ï¼Œæˆ‘å°†ä¸šåŠ¡å¿ƒè·³ä»30ç§’æ”¹æˆ5ç§’ä¹‹åï¼Œçº¿ä¸Šç¯å¢ƒæˆåŠŸç‡æå‡åˆ°90%ï¼Œå†…æµ‹ç¯å¢ƒæˆåŠŸç‡è¾¾åˆ°98%ï¼Œå°†è¿‘10%çš„å·®è·ã€‚è¯·è€å¸ˆç»™äº›ä¸‹ä¸€æ­¥æ”¹é€ å»ºè®®ã€‚<br><br>æˆ‘æƒ³åˆ°çš„ä¸‹ä¸€æ­¥æ”¹é€ æªæ–½æ˜¯ï¼šä»åŸæœ¬å•æ¬¡æ¨é€ï¼Œæ”¹æˆ5ç§’å†…å¤šæ¬¡é‡æ¨çš„æ–¹å¼ã€‚è¯·é—®è€å¸ˆæ˜¯å¦é è°±ï¼Ÿ<br><br>å¦å¤–ï¼Œè¯·æ•™ä¸‹è€å¸ˆä½ æ˜¯æ€ä¹ˆæé«˜è‡ªå»ºé•¿è¿æ¥æ¨é€æˆåŠŸç‡çš„ï¼Ÿ","like_count":0},{"had_liked":false,"id":350237,"user_name":"ä¸å·æ€ä¹ˆæé’±","can_delete":false,"product_type":"c1","uid":2206043,"ip_address":"","ucode":"F01CA83CF99047","user_header":"https://static001.geekbang.org/account/avatar/00/21/a9/5b/791d0f5e.jpg","comment_is_top":false,"comment_ctime":1656676098,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1656676098","product_id":100034901,"comment_content":"è€å¸ˆï¼Œæˆ‘æƒ³é—®ä¸‹ï¼ŒDeviceTokenå­˜çš„è¯æ€ä¹ˆå­˜å¥½ç‚¹å‘¢ï¼Ÿå› ä¸ºå½“å¤§æ‰¹é‡å‘pushçš„æ—¶å€™ï¼Œå¯èƒ½è¦æŸ¥å‡ ç™¾ä¸‡çš„DeviceTokenå»å‘pushï¼Œå¯¹äºå¾ªç¯æŸ¥mysqlæ¥è¯´ï¼Œè‚¯å®šæ˜¯æ²¡é‚£ä¹ˆå‹å¥½ï¼Œreidsçš„è¯ä¹Ÿä¸åˆé€‚ï¼Œå› ä¸ºå¯èƒ½æœ‰çš„ç”¨æˆ·æ¯å¤©å°±åªä¼šæ”¶åˆ°ä¸€æ¡pushï¼Œredisçš„æˆæœ¬ä¹Ÿé«˜ã€‚","like_count":0},{"had_liked":false,"id":339918,"user_name":"laolinshi","can_delete":false,"product_type":"c1","uid":1024994,"ip_address":"","ucode":"269B879389D7D5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a3/e2/5cb4f43f.jpg","comment_is_top":false,"comment_ctime":1648461634,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1648461634","product_id":100034901,"comment_content":"è€å¸ˆï¼Œæƒ³é—®ä¸ªé—®é¢˜ï¼Œæ¯æ¬¡è°ƒç”¨APNSé€šé“æ—¶éœ€è¦ä¼ äººdeviceToken, å‡å¦‚ä¸€æ¬¡éœ€è¦æ¨é€å‡ åƒä¸‡çš„ç”¨æˆ·ï¼Œé‚£ä¼ äººAPNSæ¥å£çš„deviceTokenå°±ä¼šè¾¾åˆ°å‡ åƒä¸‡è¿™ä¸ªé‡çº§ï¼Ÿ","like_count":0},{"had_liked":false,"id":334837,"user_name":"Geek_fa166f","can_delete":false,"product_type":"c1","uid":2916808,"ip_address":"","ucode":"73CD572D9D2C2D","user_header":"","comment_is_top":false,"comment_ctime":1645151104,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1645151104","product_id":100034901,"comment_content":"è¯·æ•™ä¸‹è€å¸ˆï¼šæµ·å¤–APPæ¨é€ï¼Œä½¿ç”¨ä»€ä¹ˆç¬¬ä¸‰æ–¹çš„æœåŠ¡æ¯”è¾ƒå¥½å‘¢ï¼ˆåŒ…å«IOSä»¥åŠå®‰å“ï¼‰?","like_count":0},{"had_liked":false,"id":333502,"user_name":"æè¿›","can_delete":false,"product_type":"c1","uid":1180709,"ip_address":"","ucode":"B7F4F7807BC0C8","user_header":"https://static001.geekbang.org/account/avatar/00/12/04/25/a384ee7a.jpg","comment_is_top":false,"comment_ctime":1644388993,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1644388993","product_id":100034901,"comment_content":"ä¹‹å‰åšè¿‡IPadçš„mdmï¼Œæœ‰ç”¨åˆ°APNSï¼Œåº”è¯¥æ˜¯é™é»˜æ¨é€ã€‚","like_count":0},{"had_liked":false,"id":221949,"user_name":"ç©ºç™½","can_delete":false,"product_type":"c1","uid":1147753,"ip_address":"","ucode":"65DA67B52A16B9","user_header":"https://static001.geekbang.org/account/avatar/00/11/83/69/77256c74.jpg","comment_is_top":false,"comment_ctime":1590639576,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590639576","product_id":100034901,"comment_content":"è¯·æ•™ä¸‹ ç»Ÿä¸€æ¨é€è”ç›Ÿä¸ä¼šå‡ºç»Ÿä¸€çš„sdkå˜›ï¼Ÿç›®å‰å’Œç¬¬ä¸‰æ–¹å‚å•†äº†è§£åˆ° å¹¶æ²¡æœ‰æä¾›ï¼Œå¯¹äºå¼€å‘è€…æ¥å…¥çš„æˆæœ¬è¿˜æ˜¯å¾ˆå¤§","like_count":0},{"had_liked":false,"id":188225,"user_name":"ğŸŒğŸŒğŸŒ","can_delete":false,"product_type":"c1","uid":1442513,"ip_address":"","ucode":"0A7943AEBFA296","user_header":"https://static001.geekbang.org/account/avatar/00/16/02/d1/36285394.jpg","comment_is_top":false,"comment_ctime":1584328939,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1584328939","product_id":100034901,"comment_content":"imä¸­appç«¯å¦‚ä½•å®ç°åœ¨çº¿ç”µè¯å’Œåœ¨çº¿è§†é¢‘ï¼Œç°åœ¨æµè¡Œä¸€èˆ¬é‡‡ç”¨ä½•ç§æŠ€æœ¯å®ç°ï¼Œåœ¨çº¿è§†é¢‘å’Œç”µè¯åœ¨æœåŠ¡ç«¯è¯´ä¸€èˆ¬åšå½•éŸ³å­˜å‚¨æ–‡ä»¶å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1691181,"avatar":"https://static001.geekbang.org/account/avatar/00/19/ce/2d/33fdd230.jpg","nickname":"Sophia","note":"","ucode":"069868B84FBF40","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":547414,"discussion_content":"ä¸€èˆ¬æ˜¯é€šè¿‡RTPæµåª’ä½“+ä¿¡ä»¤ æ¥å®ç°ï¼› ä¿¡ä»¤å°±æ”¾åœ¨æ™®é€šçš„é•¿è¿æ¥é‡Œå°±å¯ä»¥ï¼Œ åŒ…æ‹¬å‘¼å«ï¼Œåº”ç­”ç­‰ï¼› æ•°æ®é€šè¿‡æµåª’ä½“é•¿è¿æ¥æ¥å®ç°ã€‚ æœåŠ¡ç«¯éœ€è¦å­˜å‚¨æ•°æ®~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642662978,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":146402,"user_name":"ç™½æ³—å°æ—","can_delete":false,"product_type":"c1","uid":1228471,"ip_address":"","ucode":"CEF6A23B70947D","user_header":"https://static001.geekbang.org/account/avatar/00/12/be/b7/638b5d30.jpg","comment_is_top":false,"comment_ctime":1572514125,"is_pvip":false,"replies":[{"id":"57184","content":"APNsæœ¬èº«å¹¶ä¸ä¿è¯æ¶ˆæ¯ä¸é‡ä¸ä¸¢ï¼Œæ‰€ä»¥å®é™…ä¸Šå¾ˆéš¾æ§åˆ¶ï¼Œåº”ç”¨å±‚é¢èƒ½åšçš„åªæ˜¯å°½é‡é¿å…ä¸šåŠ¡å±‚é¢é‡å¤å‘é€ç»™APNså¯¼è‡´é‡å¤ä¸‹æ¨çš„é—®é¢˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1573029758,"ip_address":"","comment_id":146402,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1572514125","product_id":100034901,"comment_content":"apns çš„æ¶ˆæ¯å»é‡ä¸€èˆ¬æ€ä¹ˆåšçš„ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472845,"discussion_content":"APNsæœ¬èº«å¹¶ä¸ä¿è¯æ¶ˆæ¯ä¸é‡ä¸ä¸¢ï¼Œæ‰€ä»¥å®é™…ä¸Šå¾ˆéš¾æ§åˆ¶ï¼Œåº”ç”¨å±‚é¢èƒ½åšçš„åªæ˜¯å°½é‡é¿å…ä¸šåŠ¡å±‚é¢é‡å¤å‘é€ç»™APNså¯¼è‡´é‡å¤ä¸‹æ¨çš„é—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573029758,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":142806,"user_name":"Michael","can_delete":false,"product_type":"c1","uid":1274787,"ip_address":"","ucode":"C233DF1D224EC1","user_header":"https://static001.geekbang.org/account/avatar/00/13/73/a3/2b077607.jpg","comment_is_top":false,"comment_ctime":1571540324,"is_pvip":true,"replies":[{"id":"55334","content":"è¯¾ç¨‹ä¸­æœ‰è®²åˆ°å“ˆï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ IM æœåŠ¡ç«¯å¯ä»¥åœ¨æ¯æ¬¡å¯åŠ¨ App æ—¶ï¼Œéƒ½å»è¯·æ±‚ APNs æœåŠ¡å™¨è¿›è¡Œæ³¨å†Œï¼Œæ¥è·å– DeviceTokenã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯æ¯æ¬¡è·å–åˆ°çš„ DeviceToken éƒ½ä¸ä¼šå˜ï¼Œé€Ÿåº¦ä¹Ÿæ¯”è¾ƒå¿«ã€‚å®¢æˆ·ç«¯åœ¨é¦–æ¬¡è·å–åˆ° DeviceToken ä¹‹åï¼Œä¼šå…ˆç¼“å­˜åˆ°æœ¬åœ°ï¼Œå¦‚æœä¸‹æ¬¡è·å–åˆ° DeviceToken åï¼Œå®ƒæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦æˆ‘ä»¬å†è°ƒç”¨ IM æœåŠ¡ç«¯è¿›è¡Œæ›´æ–°äº†ã€‚è¿™ä¹Ÿç®—æ˜¯ä¸ªå°æŠ€å·§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1571661214,"ip_address":"","comment_id":142806,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1571540324","product_id":100034901,"comment_content":"æ¯å°iPhoneè®¾å¤‡çš„çš„deviceTokenéƒ½ä¸ä¸€æ ·ï¼ŒIMæœåŠ¡å™¨ç»™APNsæ¨é€æ¶ˆæ¯æ•°æ®éœ€è¦å¸¦ä¸ŠdeviceToken,ä½†æ˜¯IM Serveræ˜¯å¦‚ä½•è·å–åˆ°è®¾å¤‡çš„deviceTokençš„å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471278,"discussion_content":"è¯¾ç¨‹ä¸­æœ‰è®²åˆ°å“ˆï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ IM æœåŠ¡ç«¯å¯ä»¥åœ¨æ¯æ¬¡å¯åŠ¨ App æ—¶ï¼Œéƒ½å»è¯·æ±‚ APNs æœåŠ¡å™¨è¿›è¡Œæ³¨å†Œï¼Œæ¥è·å– DeviceTokenã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯æ¯æ¬¡è·å–åˆ°çš„ DeviceToken éƒ½ä¸ä¼šå˜ï¼Œé€Ÿåº¦ä¹Ÿæ¯”è¾ƒå¿«ã€‚å®¢æˆ·ç«¯åœ¨é¦–æ¬¡è·å–åˆ° DeviceToken ä¹‹åï¼Œä¼šå…ˆç¼“å­˜åˆ°æœ¬åœ°ï¼Œå¦‚æœä¸‹æ¬¡è·å–åˆ° DeviceToken åï¼Œå®ƒæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦æˆ‘ä»¬å†è°ƒç”¨ IM æœåŠ¡ç«¯è¿›è¡Œæ›´æ–°äº†ã€‚è¿™ä¹Ÿç®—æ˜¯ä¸ªå°æŠ€å·§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571661214,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1024294,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","nickname":"null","note":"","ucode":"F9039EFED6B55D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":46147,"discussion_content":"è€å¸ˆï¼Œapp æ¯æ¬¡å¯åŠ¨éƒ½è¯·æ±‚ im æœåŠ¡å™¨æ¥å£æ¥è·å– device tokenï¼ˆæœåŠ¡å™¨è¯·æ±‚ APNs æœåŠ¡è·å¾— device tokenï¼Œç„¶åæœåŠ¡ç«¯è¿”å›ç»™ appï¼‰ã€‚å®¢æˆ·ç«¯ä¸ºä»€ä¹ˆæ›´ç¼“å­˜ï¼Œå‘ç°ä¸åŒåå°±æ›´æ–°ï¼Ÿ\næ¯æ¬¡é€šè¿‡ im æœåŠ¡ç«¯çš„æ¥å£å» APNs è·å¾—çš„ device token éƒ½æ˜¯å¯ç”¨çš„å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573125526,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":138341,"user_name":"Michael","can_delete":false,"product_type":"c1","uid":1676713,"ip_address":"","ucode":"9140B30F643638","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKsBRgibKxD2M0ibmgPqfcoaZOxmUrwCCGlex8xehyYeeTOEN2ibtQ5S6t30LoOKFvMR5KDm5gnU99PQ/132","comment_is_top":false,"comment_ctime":1570172308,"is_pvip":false,"replies":[{"id":"53281","content":"å—¯ï¼Œè¿™ä¸ªæ˜¯æ¯”è¾ƒå¸¸è§çš„ç”¨æ³•ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1570276251,"ip_address":"","comment_id":138341,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1570172308","product_id":100034901,"comment_content":"æ€è€ƒé¢˜ï¼šå¯ä»¥å”¤èµ·appï¼Œé‡æ–°å»ºç«‹é•¿è¿æ¥ã€‚","like_count":0,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469493,"discussion_content":"å—¯ï¼Œè¿™ä¸ªæ˜¯æ¯”è¾ƒå¸¸è§çš„ç”¨æ³•ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570276251,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":138019,"user_name":"åˆ˜ä¸¹","can_delete":false,"product_type":"c1","uid":1081922,"ip_address":"","ucode":"66594D1C957E15","user_header":"https://static001.geekbang.org/account/avatar/00/10/82/42/8b04d489.jpg","comment_is_top":false,"comment_ctime":1569982570,"is_pvip":false,"replies":[{"id":"53263","content":"ä¸€èˆ¬è¿™äº›æ¨é€æœåŠ¡æ˜¯å·²sdkçš„æ–¹å¼é›†æˆåˆ°ä½ è‡ªå·±çš„appé‡Œï¼Œæ¨é€ä¸æ˜¯ç‹¬ç«‹å­˜åœ¨çš„ä¸€ä¸ªappã€‚å¦å¤–ï¼Œè¿™ä¸ªå¾—çœ‹ä¸‹å°ç±³çš„æ¨é€æœåŠ¡æ˜¯å¦æœ‰é›†æˆæ¥æ”¶æ–¹æ‰‹æœºçš„å‚å•†sdkï¼Œå¦‚æœæœ‰ï¼Œé‚£åº”è¯¥æ˜¯æ²¡é—®é¢˜çš„ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä¼°è®¡å‚å•†å¾ˆéš¾è®©ç¬¬ä¸‰æ–¹æ¨é€æœåŠ¡çš„é•¿è¿æ¥è¿è¡Œã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1570270422,"ip_address":"","comment_id":138019,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1569982570","product_id":100034901,"comment_content":"è¯·é—®å¦‚æœå‘é€æ–¹ä½¿ç”¨å°ç±³çš„æ¨é€æœåŠ¡ï¼Œé‚£ä¹ˆéå°ç±³æ‰‹æœºæ€æ ·æ¥æ”¶åˆ°æ¶ˆæ¯å‘¢ï¼Ÿç«äº‰å“ç‰Œå¯èƒ½ä¸å…è®¸åœ¨æ‰‹æœºé‡Œå®‰è£…å°ç±³çš„æ‹‰å–è½¯ä»¶ã€‚","like_count":0,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469354,"discussion_content":"ä¸€èˆ¬è¿™äº›æ¨é€æœåŠ¡æ˜¯å·²sdkçš„æ–¹å¼é›†æˆåˆ°ä½ è‡ªå·±çš„appé‡Œï¼Œæ¨é€ä¸æ˜¯ç‹¬ç«‹å­˜åœ¨çš„ä¸€ä¸ªappã€‚å¦å¤–ï¼Œè¿™ä¸ªå¾—çœ‹ä¸‹å°ç±³çš„æ¨é€æœåŠ¡æ˜¯å¦æœ‰é›†æˆæ¥æ”¶æ–¹æ‰‹æœºçš„å‚å•†sdkï¼Œå¦‚æœæœ‰ï¼Œé‚£åº”è¯¥æ˜¯æ²¡é—®é¢˜çš„ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä¼°è®¡å‚å•†å¾ˆéš¾è®©ç¬¬ä¸‰æ–¹æ¨é€æœåŠ¡çš„é•¿è¿æ¥è¿è¡Œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570270422,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}