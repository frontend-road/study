{"id":98372,"title":"45 | 实现列表数据加载、解析和展示的完整流程","content":"<p><strong>PDF 课件和源代码下载地址：</strong></p><p><a href=\"https://gitee.com/geektime-geekbang/geektime-ios-course\">https://gitee.com/geektime-geekbang/geektime-ios-course</a></p>","comments":[{"had_liked":false,"id":138517,"user_name":"Jay","can_delete":false,"product_type":"c3","uid":1134195,"ip_address":"","ucode":"33C605663F98D6","user_header":"https://static001.geekbang.org/account/avatar/00/11/4e/73/011548ac.jpg","comment_is_top":false,"comment_ctime":1570288501,"is_pvip":false,"replies":[{"id":54386,"content":"对于block，我们可以先忽略各种定义，简单的理解，block 就是一段代码，然后Copy到另外一个文件中来执行。当然这个不是特别严谨的定义哈。那么为什么我们要用这种方式执行代码呢？ 比如B有一个block，在A中赋值，然后B再执行这段代码，直接讲代码写在B中不是也可以么？那么就要看Block为我们带来了哪些方便，Block是可以包含上下文的，比如上面的例子，block中可以直接引用A，或者A的property。如果这段代码直接写在B中，B就要import 对应类，然后相应的property都需要暴露出来。如果使用Block，就使得A中包含很多上下文的代码，直接Copy出来，在B中可以执行了。以上是我感觉通俗的理解，那么具体严谨的，以及深入的使用和对应注意事项，循环引用等等，也可以具体的在网上搜索，或者留言具体的问题哈","user_name":"作者回复","user_name_real":"zzz","uid":1041455,"ctime":1571033635,"ip_address":"","comment_id":138517,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"老师可能我视频听得很快，忘记了block是啥意思，能简单说一下吗？","like_count":5,"discussions":[{"author":{"id":1041455,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJ3dLlYr6tznfnZXJNsD7Jw48BVnFSib3RO3VWEN0pgebRY1jaR8YXLQ6iaAjTsFiamOWSA3UPAa37A/132","nickname":"Geek_e7jq8k","note":"","ucode":"352964E5D793DA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469552,"discussion_content":"对于block，我们可以先忽略各种定义，简单的理解，block 就是一段代码，然后Copy到另外一个文件中来执行。当然这个不是特别严谨的定义哈。那么为什么我们要用这种方式执行代码呢？ 比如B有一个block，在A中赋值，然后B再执行这段代码，直接讲代码写在B中不是也可以么？那么就要看Block为我们带来了哪些方便，Block是可以包含上下文的，比如上面的例子，block中可以直接引用A，或者A的property。如果这段代码直接写在B中，B就要import 对应类，然后相应的property都需要暴露出来。如果使用Block，就使得A中包含很多上下文的代码，直接Copy出来，在B中可以执行了。以上是我感觉通俗的理解，那么具体严谨的，以及深入的使用和对应注意事项，循环引用等等，也可以具体的在网上搜索，或者留言具体的问题哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571033635,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1013281,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/21/abb7bfe3.jpg","nickname":"Damon","note":"","ucode":"E07522227DE1E4","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283225,"discussion_content":"能不能理解为js中回调函数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592215340,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":215958,"user_name":"siberiawolf","can_delete":false,"product_type":"c3","uid":1984456,"ip_address":"","ucode":"86078BCBFDBE71","user_header":"","comment_is_top":false,"comment_ctime":1589159678,"is_pvip":false,"replies":[{"id":81224,"content":"NSDate - NSData 拼写错了","user_name":"作者回复","user_name_real":"zzz","uid":1041455,"ctime":1590151317,"ip_address":"","comment_id":215958,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"UIImage *image = [UIImage imageWithData:[NSDate dataWithContentsOfURL:[NSURL URLWithString:item.picUrl]]];\n\nNo known class method for selector &#39;dataWithContentsOfURL:&#39;\n\n老师，我怎么没有这个函数啊？我的Xcode版本是：Version 11.4.1 (11E503a)","like_count":1,"discussions":[{"author":{"id":1041455,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJ3dLlYr6tznfnZXJNsD7Jw48BVnFSib3RO3VWEN0pgebRY1jaR8YXLQ6iaAjTsFiamOWSA3UPAa37A/132","nickname":"Geek_e7jq8k","note":"","ucode":"352964E5D793DA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494622,"discussion_content":"NSDate - NSData 拼写错了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590151317,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1586175,"avatar":"https://static001.geekbang.org/account/avatar/00/18/33/ff/ac79e58a.jpg","nickname":"ME进哥哥","note":"","ucode":"B893EFD71C5C5A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":263834,"discussion_content":"NSData不是NSDate","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1589251865,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1984456,"avatar":"","nickname":"siberiawolf","note":"","ucode":"86078BCBFDBE71","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1586175,"avatar":"https://static001.geekbang.org/account/avatar/00/18/33/ff/ac79e58a.jpg","nickname":"ME进哥哥","note":"","ucode":"B893EFD71C5C5A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":264014,"discussion_content":"多谢，我后来发现错误了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589280453,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":263834,"ip_address":"","group_id":0},"score":264014,"extra":""}]}]},{"had_liked":false,"id":237875,"user_name":"也许明天","can_delete":false,"product_type":"c3","uid":2042502,"ip_address":"","ucode":"B2A8B4306E117E","user_header":"https://static001.geekbang.org/account/avatar/00/1f/2a/86/87711313.jpg","comment_is_top":false,"comment_ctime":1595993372,"is_pvip":false,"replies":[{"id":90493,"content":"使用 URLSessionTask 的话，系统内部会在非 UI 线程进行异步的处理请求，从这个维度上，我们是不需要开辟一个子线程的。但是当请求处理结束，回调到我们的completion handlers之后，我们就需要判断之后的数据处理是否在 UI 线程以及其他线程了，最常见的就是当接收到数据需要进行磁盘存储，就尽量不要在 UI 线程进行操作。","user_name":"作者回复","user_name_real":"zzz","uid":1041455,"ctime":1599219434,"ip_address":"","comment_id":237875,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"老师下载数据的时候用不用专门开辟一个子线程在里边进行数据下载呢","like_count":0,"discussions":[{"author":{"id":1041455,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJ3dLlYr6tznfnZXJNsD7Jw48BVnFSib3RO3VWEN0pgebRY1jaR8YXLQ6iaAjTsFiamOWSA3UPAa37A/132","nickname":"Geek_e7jq8k","note":"","ucode":"352964E5D793DA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":502576,"discussion_content":"使用 URLSessionTask 的话，系统内部会在非 UI 线程进行异步的处理请求，从这个维度上，我们是不需要开辟一个子线程的。但是当请求处理结束，回调到我们的completion handlers之后，我们就需要判断之后的数据处理是否在 UI 线程以及其他线程了，最常见的就是当接收到数据需要进行磁盘存储，就尽量不要在 UI 线程进行操作。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599219434,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":116204,"user_name":"LINBE","can_delete":false,"product_type":"c3","uid":1598489,"ip_address":"","ucode":"DC74D647538356","user_header":"https://static001.geekbang.org/account/avatar/00/18/64/19/9bf8d7ae.jpg","comment_is_top":false,"comment_ctime":1563801645,"is_pvip":false,"replies":[{"id":42778,"content":"已经更新了代码  fork如果没有及时的更新就看下这里哈 https:&#47;&#47;github.com&#47;dequan1331&#47;geektime-ios-course","user_name":"作者回复","user_name_real":"dequanzhu","uid":1041455,"ctime":1563952661,"ip_address":"","comment_id":116204,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"老师好，能不能提供一个稳定一点的接口，以供练习？视频中链接一天才用几次就超过次数，代码敲到一半都进行不下去","like_count":0,"discussions":[{"author":{"id":1041455,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJ3dLlYr6tznfnZXJNsD7Jw48BVnFSib3RO3VWEN0pgebRY1jaR8YXLQ6iaAjTsFiamOWSA3UPAa37A/132","nickname":"Geek_e7jq8k","note":"","ucode":"352964E5D793DA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459433,"discussion_content":"已经更新了代码  fork如果没有及时的更新就看下这里哈 https://github.com/dequan1331/geektime-ios-course","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563952661,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104812,"user_name":"少女的避风港","can_delete":false,"product_type":"c3","uid":1136980,"ip_address":"","ucode":"6F2F5706C7B316","user_header":"https://static001.geekbang.org/account/avatar/00/11/59/54/b9b9b712.jpg","comment_is_top":false,"comment_ctime":1560845826,"is_pvip":false,"replies":[{"id":37935,"content":"这个为了避免版权的问题，没有抓包，用的接口。这个免费的接口每天有次数的限制....过一天应该就好了。自己可以申请类似的，或者抓下主流App的列表请求作为练习，都是明文的。","user_name":"作者回复","user_name_real":"dequanzhu","uid":1041455,"ctime":1560853352,"ip_address":"","comment_id":104812,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"你好，在课程中用的 http:&#47;&#47;v.juhe.cn&#47;toutiao&#47;index?type=top&amp;key=97ad001bfcc2082e2eeaf798bad3d54e  这个请求地址好像返回的数据有问题了。","like_count":0,"discussions":[{"author":{"id":1041455,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJ3dLlYr6tznfnZXJNsD7Jw48BVnFSib3RO3VWEN0pgebRY1jaR8YXLQ6iaAjTsFiamOWSA3UPAa37A/132","nickname":"Geek_e7jq8k","note":"","ucode":"352964E5D793DA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454433,"discussion_content":"这个为了避免版权的问题，没有抓包，用的接口。这个免费的接口每天有次数的限制....过一天应该就好了。自己可以申请类似的，或者抓下主流App的列表请求作为练习，都是明文的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560853352,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1684031,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLLZwYsExPIhpse1CLQHiaqYTDxzdqVDH2GXqofdljYONe89AJWZoxsqpPJF18ViaVMeObA1HkbkMWA/132","nickname":"Geek_bb4a8b","note":"","ucode":"0D08290EF02AAF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":40123,"discussion_content":"还有可能是xcode默认http不能解析（只能解析https），需要改一下plist：\n在plist中添加App Transport Security Settings，然后在它的下面添加Allow Arbitrary Loads并让值为YES","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572083190,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":336682,"user_name":"陈俊焕","can_delete":false,"product_type":"c3","uid":1338915,"ip_address":"","ucode":"64EE6ED20C159A","user_header":"https://static001.geekbang.org/account/avatar/00/14/6e/23/f6d773f5.jpg","comment_is_top":false,"comment_ctime":1646290143,"is_pvip":false,"replies":null,"discussion_count":2,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"老师，这个image怎么加载不出来啊，地址都传进去了","like_count":3,"discussions":[{"author":{"id":3874442,"avatar":"https://static001.geekbang.org/account/avatar/00/3b/1e/8a/2ea1543a.jpg","nickname":"wishlr","note":"","ucode":"87028B59B62A5D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":647679,"discussion_content":"应该是网址失效了，所以看不到图片","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1720439231,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3874442,"avatar":"https://static001.geekbang.org/account/avatar/00/3b/1e/8a/2ea1543a.jpg","nickname":"wishlr","note":"","ucode":"87028B59B62A5D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":647678,"discussion_content":"我也是","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1720438954,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110645,"user_name":"起风了001","can_delete":false,"product_type":"c3","uid":1529929,"ip_address":"","ucode":"8DCDBA40B8CC9F","user_header":"","comment_is_top":false,"comment_ctime":1562309900,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"哈哈, 这个block的格式真的不好记, 像外星语言, 一段时间没看就忘了. 这里有一个非常专业的网站介绍给大家, 上面只有一个功能, 就是写了block的各种语法😂, 够专业\nhttp:&#47;&#47;fuckingblocksyntax.com&#47;","like_count":2,"discussions":[{"author":{"id":3599357,"avatar":"https://static001.geekbang.org/account/avatar/00/36/eb/fd/64b80893.jpg","nickname":"HarrisonXn","note":"","ucode":"ECAF973151D574","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":618111,"discussion_content":"网站名笑死我了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1684119178,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110669,"user_name":"起风了001","can_delete":false,"product_type":"c3","uid":1529929,"ip_address":"","ucode":"8DCDBA40B8CC9F","user_header":"","comment_is_top":false,"comment_ctime":1562312254,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"老师finishBlock不需要处理block的引用循环问题. 因为传入的finishBlock是NSStackBlock类型, 方法执行结束block会被回收, block内对self的引用会被释放, 也就不存在引用循环问题了.","like_count":1},{"had_liked":false,"id":301937,"user_name":"Geek_317a52","can_delete":false,"product_type":"c3","uid":1611007,"ip_address":"","ucode":"7B275FD937C747","user_header":"","comment_is_top":false,"comment_ctime":1625985241,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"能否讲一下上划加载更多这个功能。一般这种列表都不会一次性把所有数据都取出来，都是随着用户的上划分批加载的，老师能否讲一下这部分怎么实现？","like_count":0,"discussions":[{"author":{"id":2076600,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/af/b8/458866d3.jpg","nickname":"Bo","note":"","ucode":"D5DD3300310C02","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":403263,"discussion_content":"可以了解一下MJRefresh库","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634041930,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":300212,"user_name":"hahahahan","can_delete":false,"product_type":"c3","uid":1387868,"ip_address":"","ucode":"1AAFF9998429ED","user_header":"https://static001.geekbang.org/account/avatar/00/15/2d/5c/563a155b.jpg","comment_is_top":false,"comment_ctime":1625047719,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"老师，处理self防止循环应用哪里不太明白，可以解释一下吗","like_count":0},{"had_liked":false,"id":297528,"user_name":"挥手自兹去，萧萧班马鸣","can_delete":false,"product_type":"c3","uid":1751818,"ip_address":"","ucode":"AE3A2187AC1A30","user_header":"https://static001.geekbang.org/account/avatar/00/1a/bb/0a/f9d81f3e.jpg","comment_is_top":false,"comment_ctime":1623599171,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100025901,"comment_content":"老师能问下，那个Uitl文件夹下的GTSScreen.h&#47;.m是什么时候加上去的？","like_count":0}]}