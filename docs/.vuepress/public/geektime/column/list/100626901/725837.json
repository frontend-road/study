{"id":725837,"title":"13ï½œç‹¬ç«‹ç‹å›½ï¼šåˆæ­¥äº†è§£Rustå¼‚æ­¥å¹¶å‘ç¼–ç¨‹","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯Mikeã€‚ä»ä»Šå¤©å¼€å§‹ï¼Œæˆ‘ä»¬ä¼šç”¨å‡ èŠ‚è¯¾çš„æ—¶é—´ç³»ç»Ÿå­¦ä¹ Rustå¼‚æ­¥å¹¶å‘ç¼–ç¨‹ã€‚</p><p>å’Œå…¶ä»–è¯­è¨€ä¸å¤§ä¸€æ ·çš„æ˜¯ï¼Œå¼‚æ­¥ Rustï¼ˆasync Rustï¼‰ç›¸å½“äºRustä¸–ç•Œé‡Œçš„ä¸€å—å„¿æ–°çš„ç‹å›½ï¼Œè¿™ä¸ªç‹å›½æœ‰ä¸€å®šçš„ç‹¬ç«‹æ€§ï¼Œæœ‰å®ƒçªå‡ºçš„ç‰¹ç‚¹ã€‚å½“ç„¶ï¼Œç‹¬ç«‹å¹¶ä¸ä»£è¡¨å°é—­ï¼Œæˆ‘ä»¬å‰é¢æ‰€æœ‰çš„çŸ¥è¯†å’Œç»éªŒä»ç„¶èƒ½é¡ºåˆ©åœ°åœ¨è¿™ä¸ªç‹å›½é‡Œå‘æŒ¥ä½œç”¨ã€‚</p><h2>async rust</h2><p>ä»Rust v1.39ç‰ˆæœ¬ä»¥åï¼ŒRustå¼•å…¥äº†asyncå…³é”®å­—ï¼Œç”¨äºæ”¯æŒå¼‚æ­¥ç¼–ç¨‹çš„å·¥ç¨‹å­¦ä½“éªŒï¼Œä½¿ç¨‹åºå‘˜å¯ä»¥ç”¨å·²ç»ä¹ æƒ¯äº†çš„åŒæ­¥ä»£ç ä¹¦å†™æ–¹å¼æ¥ç¼–å†™å¼‚æ­¥ä»£ç ã€‚</p><p>å¦‚æœä½ äº†è§£è¿‡æ—©æœŸçš„JavaScriptè¯­è¨€ï¼Œä½ å¯èƒ½ä¼šå¯¹å›è°ƒæ¨¡å¼ä»¥åŠâ€œå›è°ƒåœ°ç‹±â€æœ‰æ‰€äº†è§£ã€‚æ„Ÿå…´è¶£çš„è¯ï¼Œä½ å¯ä»¥æœç´¢â€œå›è°ƒåœ°ç‹±â€è¿™ä¸ªå…³é”®è¯ï¼Œçœ‹çœ‹å®ƒæ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Œä»¥åŠå¯ä»¥ç”¨ä»€ä¹ˆæ–¹å¼å»è§£å†³ã€‚</p><p>JavaScriptåœ¨ECMAScript 2017ç‰ˆæœ¬ä¸­å¼•å…¥äº† <code>async/await</code> å…³é”®å­—ç»„åˆï¼Œç”¨äºæ”¹è¿›JavaScriptä¸­å¼‚æ­¥ç¼–ç¨‹ä½“éªŒï¼Œä»æ­¤ä»¥åç¨‹åºå‘˜å¯ä»¥ç”¨é¡ºåºçš„é€»è¾‘ä¹¦å†™æ–¹å¼æ¥å†™å‡ºå¼‚æ­¥æ‰§è¡Œçš„ä»£ç ï¼Œè€Œä¸æ˜¯é‚£ç§ç”¨å›è°ƒæ–¹å¼æŠŠä¸€æ®µè¿ç»­çš„é€»è¾‘åˆ‡å‰²æˆä¸€å°å—ä¸€å°å—çš„ã€‚</p><p>Rustå…¶å®ä¹Ÿå·®ä¸å¤šï¼Œå®ƒç”¨ç±»ä¼¼çš„æ–¹å¼å¼•å…¥äº† <code>async/.await</code> å…³é”®å­—å¯¹ã€‚å¦‚æœä½ å¯¹Mozillaå…¬å¸æœ‰æ‰€äº†è§£çš„è¯ï¼Œå°±ä¸ä¼šæ„Ÿè§‰å¥‡æ€ªäº†ï¼ŒMozillaæ˜¯äº’è”ç½‘æ ‡å‡†ç»„ç»‡çš„é‡è¦æˆå‘˜ï¼ŒJavaScriptä¹‹çˆ¶å°±åœ¨Mozillaå…¬å¸ï¼Œå‚ä¸äº†JavaScriptæ ‡å‡†åˆ¶å®šçš„å…¨è¿‡ç¨‹ã€‚åŒæ—¶ï¼ŒMozillaè¿˜æ¨å‡ºäº†Rustè¯­è¨€ä»¥åŠWebAssemblyå­—èŠ‚ç è§„èŒƒã€‚</p><!-- [[[read_end]]] --><h3>async å‡½æ•°å’Œå—ï¼ˆä»£ç ç‰‡æ®µï¼‰</h3><p>åœ¨Rustä¸­ï¼Œç”¨ä¸Šasyncçš„å‡½æ•°é•¿è¿™æ ·ï¼š</p><pre><code class=\"language-plain\">async fn foo() {\n  \n}\n</code></pre><p>ä¹Ÿå°±æ˜¯åœ¨åŸæ¥çš„fnå‰åŠ ä¸Š async ä¿®é¥°ã€‚å¦å¤–ï¼Œè¿˜æœ‰æ‰€è°“çš„ async å—ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥åœ¨ async åé¢åŠ èŠ±æ‹¬å·ã€‚</p><pre><code class=\"language-plain\">fn foo() {\n    async {\n      // è¿™å°±æ˜¯asyncå—\n    };\n}\n\nfn foo() {\n    async move { \n      // åŠ moveï¼Œç±»ä¼¼é—­åŒ…ï¼Œæ˜ç¡®æ ‡è¯†æŠŠç”¨åˆ°çš„ç¯å¢ƒå˜é‡ç§»åŠ¨è¿›æ¥\n    };\n}\n</code></pre><p>ä¸Šé¢çš„å‡½æ•°æ˜¯å¯ä»¥ç¼–è¯‘é€šè¿‡çš„ï¼Œä½†æ˜¯è¿™æ ·å†™æœ¬èº«ä¼šæœ‰ä¸€äº›é—®é¢˜ã€‚</p><p>æç¤ºï¼š</p><pre><code class=\"language-plain\">futures do nothing unless you `.await` or poll them\n</code></pre><p>ç¿»è¯‘å‡ºæ¥å°±æ˜¯ï¼šfuturesä¸åšä»»ä½•äº‹æƒ…ï¼Œé™¤éä½ ç”¨ <code>.await</code> æˆ–è½®è¯¢å®ƒä»¬ã€‚</p><p>Rustä¸­ï¼Œasyncå‡½æ•°æˆ–å—ä¼šè¢«è§†ä½œä¸€ä¸ªFutureå¯¹è±¡ï¼Œç±»ä¼¼äºJSé‡Œçš„Promiseï¼Œasync å…³é”®å­—åªæ˜¯ç”¨æ¥å®šä¹‰è¿™ä¸ªFutureå¯¹è±¡ï¼Œå®šä¹‰å¥½çš„è¿™ç‰‡å¼‚æ­¥ä»£ç å¹¶ä¸ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œè€Œæ˜¯éœ€è¦å’Œasyncé…å¯¹çš„ <code>.await</code> å»é©±åŠ¨å®ƒæ‰ä¼šæ‰§è¡Œã€‚</p><p>æ¯”å¦‚åƒä¸‹é¢è¿™æ ·ï¼š</p><pre><code class=\"language-plain\">fn foo() {\n&nbsp; &nbsp; let a = async {};\n&nbsp; &nbsp; a.await;            // ç”¨.awaité©±åŠ¨å¼‚æ­¥å—\n}\n// æˆ–è€…æ›´ç´§å‡‘çš„å†™æ³•\nfn foo() {\n    async {}.await;\n}\n</code></pre><p>ä½†æ˜¯ï¼Œä¸Šè¿°ä»£ç æ˜¯æ²¡åŠæ³•é€šè¿‡ç¼–è¯‘çš„ï¼Œä¼šæŠ¥è¿™ä¸ªé”™ã€‚</p><pre><code class=\"language-plain\">error[E0728]: `await` is only allowed inside `async` functions and blocks\n</code></pre><p>å®ƒæç¤ºè¯´ï¼Œ<code>await</code> å…³é”®å­—åªèƒ½åœ¨asyncå—æˆ–å‡½æ•°é‡Œä½¿ç”¨ã€‚</p><p>äºæ˜¯å¾—æ”¹æˆè¿™æ ·æ‰è¡Œï¼š</p><pre><code class=\"language-plain\">async fn foo() {\n    let a = async {};\n    a.await;\n}\n</code></pre><p>è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°ä¸¤æ¡è§„åˆ™ã€‚</p><ol>\n<li>ç”¨asyncå®šä¹‰å¼‚æ­¥ä»£ç ï¼Œç”¨ <code>.await</code> é©±åŠ¨æ‰§è¡Œã€‚</li>\n<li>ä½†æ˜¯ <code>.await</code> åˆåªèƒ½åœ¨asyncå—ä¸­è°ƒç”¨ã€‚</li>\n</ol><p>ç»†å¿ƒçš„ä½ å¯èƒ½ä¸€ä¸‹å­å°±æ¨ç†å‡ºæ¥äº†ï¼Œè¿™ä¸å°±æ˜¯é¸¡å’Œè›‹çš„é—®é¢˜å—ï¼Ÿé‚£ä¹ˆç¬¬ä¸€ä¸ªæœ€å¤–å±‚çš„ async ä»£ç å—æˆ–å‡½æ•°å¦‚ä½•è¢«è°ƒç”¨å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬çŸ¥é“ï¼ŒRustçš„ç¨‹åºéƒ½æ˜¯ä»mainå‡½æ•°å¼€å§‹æ‰§è¡Œçš„ã€‚</p><pre><code class=\"language-plain\">fn main() {\n}\n</code></pre><p>å³ä½¿æ˜¯å¼‚æ­¥ä»£ç ï¼Œä¹Ÿä¸èƒ½ç ´åè¿™ä¸ªè§„åˆ™ã€‚<br>\næˆ‘ä»¬è¯•ç€è¿™æ ·å†™ï¼š</p><pre><code class=\"language-plain\">async fn main() {      // åœ¨mainå‡½æ•°å‰åŠ ä¸€ä¸ªasyncä¿®é¥°\n    let a = async {};\n    a.await;\n}\n</code></pre><p>ä¼šæŠ¥é”™ï¼š</p><pre><code class=\"language-plain\">error[E0752]: `main` function is not allowed to be `async`\n</code></pre><p>Rust æ˜ç¡®è§„å®šäº†ï¼Œmainå‡½æ•°å‰ä¸èƒ½åŠ asyncä¿®é¥°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªèƒ½å†™æˆè¿™ç§å½¢å¼ã€‚</p><pre><code class=\"language-plain\">fn main() {\n    let a = async {};\n    a.await;\n}\n</code></pre><p>ä½†æ˜¯å‰é¢åˆè¯´è¿‡äº†ï¼Œ<code>.await</code> åªèƒ½å†™åœ¨asyncä»£ç å—æˆ–å‡½æ•°é‡Œã€‚æˆ‘ä»¬è¿›å…¥äº†ä¸€ä¸ªä¸¤éš¾çš„å¢ƒåœ°ã€‚å¦‚æœå°±åœ¨ç›®å‰è¿™ä¸ªä½“ç³»é‡Œé¢å¯»æ‰¾è§£å†³æ–¹æ¡ˆçš„è¯ï¼Œé‚£åªèƒ½åŸåœ°æ‰“è½¬ã€‚</p><p><strong>è¿™é‡Œå¿…ç„¶è¦å¼•å…¥ä¸€ç§å¤–éƒ¨é©±åŠ¨æœºåˆ¶</strong>ã€‚æ¯”å¦‚ï¼Œæœ‰ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œå®ƒå¯ä»¥æ¥æ”¶Futureï¼Œå¹¶é©±åŠ¨å®ƒï¼Œè€Œä¸éœ€è¦ä½¿ç”¨ <code>.await</code>ã€‚åƒä¸‹é¢è¿™æ ·å°±è¡Œäº†ã€‚</p><pre><code class=\"language-plain\">fn main() {\n    let a = async {};\n    block_on(a);  // è¾…åŠ©é©±åŠ¨å‡½æ•° block_on\n}\n</code></pre><p>é‚£ä¹ˆï¼Œè¿™ä¸ª <code>block_on()</code> åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ<br>\n<strong>è¿™ä¸ª <code>block_on()</code> å¯ä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„å‡½æ•°ï¼Œå®ƒå¿…é¡»æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶ï¼ˆRuntimeï¼‰çš„å…¥å£ã€‚åœ¨å®ƒä¸‹é¢ï¼Œè•´è—ç€ä¸€æ•´å¥—è¿è¡Œæ—¶æœºåˆ¶ã€‚</strong></p><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œä»…ä»…åˆ©ç”¨æˆ‘ä»¬ä¹‹å‰å­¦åˆ°çš„RustçŸ¥è¯†ï¼Œè¿˜é©±åŠ¨ä¸äº†å¼‚æ­¥ä»£ç ï¼Œå¿…é¡»è¦å€ŸåŠ©äºä¸€ç§æ–°çš„å«åšè¿è¡Œæ—¶ï¼ˆRuntimeï¼‰çš„æœºåˆ¶æ‰èƒ½å¤„ç†ã€‚</p><p>ç›®å‰Rustæ ‡å‡†åº“ä¸­è¿˜æ²¡æœ‰å†…ç½®ä¸€ä¸ªå®˜æ–¹çš„å¼‚æ­¥Runtimeï¼Œä¸è¿‡Rustç”Ÿæ€ä¸­æœ‰å¾ˆå¤šç¬¬ä¸‰æ–¹çš„Runtimeå®ç°åº“ï¼Œæ¯”å¦‚tokioã€async-stdç­‰ã€‚è€Œå…¶ä¸­tokioåº”ç”¨æœ€ä¸ºå¹¿æ³›ã€‚<strong>é€šè¿‡å‡ å¹´çš„æ—¶é—´ï¼Œtokioåœ¨ç¬¬ä¸‰æ–¹å¼‚æ­¥Runtimeçš„æ¿€çƒˆç«äº‰ä¸­èƒœå‡ºï¼Œå¯ä»¥è¯´å®ƒç°åœ¨å·²ç»æˆä¸ºäº†Rustç”Ÿæ€ä¸­å¼‚æ­¥è¿è¡Œæ—¶äº‹å®ä¸Šçš„æ ‡å‡†ã€‚</strong></p><p>æˆ‘ä»¬ä¸‹é¢å°±å¼€å§‹è®²è§£è¿™ä¸ªè¿è¡Œæ—¶æœºåˆ¶ã€‚</p><h3>å¼‚æ­¥è¿è¡Œæ—¶æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>å¼‚æ­¥è¿è¡Œæ—¶æ˜¯ä¸€ä¸ªåº“ï¼Œè¿™ä¸ªåº“åŒ…å«ä¸€ä¸ªå“åº”å™¨ï¼ˆreactorï¼‰å’Œä¸€ä¸ªæˆ–å¤šä¸ªæ‰§è¡Œå™¨ï¼ˆexecutorï¼‰ã€‚å®ƒéœ€è¦å¤„ç†å“ªäº›äº‹æƒ…å‘¢ï¼Ÿ</p><ol>\n<li>æ‰§è¡Œå¼‚æ­¥ä»£ç ã€‚</li>\n<li>é‡åˆ° <code>.await</code> çš„æ—¶å€™ï¼Œåˆ¤æ–­èƒ½ä¸èƒ½è·å–åˆ°ç»“æœã€‚å¦‚æœä¸èƒ½ï¼ŒCPUä¸ä¼šä¸€ç›´é˜»å¡ç­‰ï¼Œè€Œæ˜¯ç¼“å­˜å½“å‰ä»»åŠ¡çš„çŠ¶æ€ï¼Œç„¶åå°†å½“å‰ä»»åŠ¡æŒ‚èµ·ï¼Œæ”¾åˆ°å†…éƒ¨ä¸€ä¸ªä»»åŠ¡æ± ä¸­ï¼ŒåŒæ—¶å‘OSæ³¨å†Œè¦ç›‘å¬ç­‰å¾…çš„å¤–éƒ¨äº‹ä»¶ã€‚</li>\n<li>è¯¢é—®æˆ–æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚å¦‚æœæ‰€æœ‰ä»»åŠ¡éƒ½æš‚æ—¶æ²¡æœ‰è¿›å±•ï¼Œå°±ä¼šè¿›å…¥ä¸€ä¸ªç©ºé—²ï¼ˆidleï¼‰çŠ¶æ€ï¼Œä¸ä¼šä½¿CPUå¿™ç­‰å¾…ã€‚</li>\n<li>åªè¦æŸä¸ªä»»åŠ¡å¯¹åº”æ‰€ç›‘å¬åˆ°çš„ä¿¡å·æ¥äº†ï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰ç»“æœè¿”å›äº†ï¼Œå°±ä¼šæŠŠå¯¹åº”çš„ä»»åŠ¡é‡æ–°æ¡èµ·æ¥ï¼Œå¹¶ä»ç¼“å­˜ä¸­æ¢å¤æš‚åœå‰çš„çŠ¶æ€ï¼Œç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚ä»ä»£ç ä¸Šçœ‹ï¼Œå°±æ˜¯ä»ä¸Šä¸€ä¸ª <code>.await</code> åé¢çš„ä»£ç ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚</li>\n<li>é‡åˆ°ä¸‹ä¸€ä¸ª <code>.await</code>ï¼Œå°±é‡å¤ç¬¬1æ­¥ï½ç¬¬4æ­¥ã€‚</li>\n<li>ç›´åˆ°è¿™ä¸ªå¼‚æ­¥ä»£ç ï¼ˆå‡½æ•°ï¼‰æ‰§è¡Œå®Œæ¯•ï¼Œå®Œæˆæ“ä½œæˆ–è¿”å›ç»“æœã€‚</li>\n</ol><p>æ€»ç»“èµ·æ¥ï¼Œå°±æ˜¯è¿™6é¡¹ä»»åŠ¡ã€‚</p><ol>\n<li>å¼‚æ­¥ä»£ç çš„æ‰§è¡Œï¼›</li>\n<li>ä»»åŠ¡çš„æš‚åœï¼›</li>\n<li>çŠ¶æ€çš„ç¼“å­˜ï¼›</li>\n<li>å¤–éƒ¨äº‹ä»¶çš„ç›‘å¬æ³¨å†Œï¼›</li>\n<li>å¤–éƒ¨ä¿¡å·æ¥äº†åï¼Œå”¤é†’å¯¹åº”çš„ä»»åŠ¡ï¼Œæ¢å¤ä»»åŠ¡çŠ¶æ€ï¼›</li>\n<li>å¤šä¸ªä»»åŠ¡é—´çš„è°ƒåº¦ã€‚</li>\n</ol><p>æ€»ä¹‹ï¼ŒRustå¼‚æ­¥è¿è¡Œæ—¶è¦å¹²çš„äº‹æƒ…è¿˜ä¸å°‘ã€‚è¦è®¾è®¡ä¸€ä¸ªé«˜æ•ˆçš„å¼‚æ­¥è¿è¡Œæ—¶æ˜¯ä¸€ä»¶ç›¸å½“æœ‰æŠ€æœ¯æŒ‘æˆ˜çš„å·¥ä½œã€‚åé¢æˆ‘ä»¬ä¼šä»¥tokioä¸ºä¾‹æ¥ä»‹ç»Rustä¸­çš„å¼‚æ­¥ç¼–ç¨‹ã€‚</p><h2>tokioå¼‚æ­¥ç¼–ç¨‹</h2><p>ä¸‹é¢æˆ‘ä»¬æ¥ç†Ÿæ‚‰ä¸€ä¸‹åŸºäºtokio runtimeçš„ä»£ç èŒƒä¾‹ã€‚</p><h3>å¼•å…¥ä¾èµ–</h3><p>é¦–å…ˆï¼Œä½ å¾—åœ¨Cargo.tomlä¸­å¼•å…¥tokioä¾èµ–ã€‚</p><pre><code class=\"language-plain\">tokio = { version = \"1\", features = [\"full\"] }\n</code></pre><h3>mainå‡½æ•°</h3><p>ç„¶åï¼Œæˆ‘ä»¬æŠŠtokioæä¾›çš„ä¸€ä¸ªå±æ€§å®æ ‡æ³¨åœ¨mainå‡½æ•°ä¸Šé¢ï¼Œè¿™æ ·mainå‡½æ•°å‰å°±å¯ä»¥åŠ asyncä¿®é¥°äº†ã€‚</p><p>åƒä¸‹é¢è¿™æ ·ï¼š</p><pre><code class=\"language-plain\">#[tokio::main]      // è¿™ä¸ªæ˜¯tokioåº“é‡Œé¢æä¾›çš„ä¸€ä¸ªå±æ€§å®æ ‡æ³¨\nasync fn main() {   // æ³¨æ„ main å‡½æ•°å‰é¢æœ‰ async \n    println!(\"Hello world\");\n}\n</code></pre><p>è¿™ä¸ª <code>#[tokio::main]</code> åšçš„äº‹æƒ…å…¶å®å°±æ˜¯æŠŠç”¨ async ä¿®é¥°çš„ main å‡½æ•°å±•å¼€ï¼Œå±•å¼€ä¼šç±»ä¼¼ä¸‹é¢è¿™ä¸ªæ ·å­ï¼š</p><pre><code class=\"language-plain\">fn main() {\n    tokio::runtime::Builder::new_multi_thread()\n        .enable_all()\n        .build()\n        .unwrap()\n        .block_on(async {              // æ³¨æ„è¿™é‡Œblock_onï¼Œé‡Œé¢æ˜¯å¼‚æ­¥ä»£ç \n            println!(\"Hello world\");\n        })\n}\n</code></pre><p>ä¹Ÿå°±æ˜¯åœ¨mainå‡½æ•°é‡Œæ„å»ºä¸€ä¸ªRuntimeå®ä¾‹ï¼Œç¬¬äºŒè¡Œä»£ç çš„æ„æ€æ˜¯ tokio åº“ä¸‹ Runtime æ¨¡å—çš„ Builder ç±»å‹é‡Œçš„ <code>new_multi_thread()</code> å‡½æ•°ï¼Œæ•´ä¸ªè·¯å¾„ç”¨ <code>::</code> å·è¿æ¥ï¼Œ<code>::</code> ä¹Ÿå«è·¯å¾„ç¬¦ã€‚è¿™ä¸ªå‡½æ•°åˆ›å»ºçš„æ˜¯å¤šçº¿ç¨‹ç‰ˆæœ¬çš„ Runtime å®ä¾‹ã€‚</p><p><code>.enable_all()</code> ç”¨äºæ‰“å¼€é»˜è®¤æ‰€æœ‰é…ç½®ï¼Œ<code>.build()</code> ç”¨äºçœŸæ­£åˆ›å»ºå®ä¾‹ï¼Œå®ƒè¿”å›ä¸€ä¸ªç”¨ResultåŒ…èµ·æ¥çš„ç»“æœï¼Œ<code>.unwrap()</code> æŠŠè¿™ä¸ª Result è§£å¼€ï¼ŒæŠŠRuntimeå®ä¾‹æ‹¿å‡ºæ¥ï¼Œç„¶ååœ¨è¿™ä¸ªå®ä¾‹ä¸Šè°ƒç”¨ <code>.block_on()</code> å‡½æ•°ã€‚æ•´ä¸ªè¿‡ç¨‹ç”¨çš„æ˜¯<strong>é“¾å¼è°ƒç”¨é£æ ¼</strong>ï¼Œè¿™ä¸ªé£æ ¼åœ¨å…¶ä»–è¯­è¨€ä¸­ä¹Ÿå¾ˆæ™®éï¼Œåªè¦éµå¾ªå‰ä¸€ä¸ªå‡½æ•°è°ƒç”¨è¿”å›è‡ªèº«æˆ–è€…æ–°çš„å¯¹è±¡å³å¯ã€‚</p><p><code>block_on()</code> ä¼šæ‰§è¡Œå¼‚æ­¥ä»£ç ï¼Œè¿™æ ·å°±æŠŠå¼‚æ­¥ä»£ç ç»™åŠ è½½åˆ°è¿™ä¸ªRuntimeå®ä¾‹ä¸Šå¹¶é©±åŠ¨èµ·æ¥äº†ã€‚</p><p>tokioè¿˜å¯ä»¥åŸºäºå½“å‰ç³»ç»Ÿçº¿ç¨‹åˆ›å»ºå•çº¿ç¨‹çš„Runtimeï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹ç¤ºä¾‹ã€‚</p><pre><code class=\"language-plain\">#[tokio::main(flavor = \"current_thread\")]  // å±æ€§æ ‡æ³¨é‡Œé¢é…ç½®å‚æ•°\nasync fn main() {\n    println!(\"Hello world\");\n}\n</code></pre><p>å±•å¼€åï¼Œæ˜¯è¿™ä¸ªæ ·å­çš„ï¼š</p><pre><code class=\"language-plain\">fn main() {\n    tokio::runtime::Builder::new_current_thread()  // æ³¨æ„è¿™ä¸€å¥\n        .enable_all()\n        .build()\n        .unwrap()\n        .block_on(async {\n            println!(\"Hello world\");\n        })\n}\n</code></pre><p>å•çº¿ç¨‹çš„Runtimeç”± <code>Builder::new_current_thread()</code>&nbsp;å‡½æ•°åˆ›å»ºï¼Œä»£ç çš„å…¶ä»–éƒ¨åˆ†å’Œå¤šçº¿ç¨‹Runtimeéƒ½ä¸€æ ·ã€‚</p><h3>ä»£ç ç¤ºä¾‹</h3><p>è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆçœ‹å‡ ä¸ªä¾‹å­ï¼Œæ¥äº†è§£ä¸€ä¸‹åŸºäºtokioçš„ä»£ç é•¿ä»€ä¹ˆæ ·å­ã€‚</p><h4>æ–‡ä»¶å†™</h4><p>ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åŸºäºtokioåšæ–‡ä»¶çš„å†™æ“ä½œã€‚</p><pre><code class=\"language-plain\">use tokio::fs::File;\nuse tokio::io::AsyncWriteExt;&nbsp;    // å¼•å…¥AsyncWriteExt trait\n\nasync fn doit() -&gt; std::io::Result&lt;()&gt; {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\n&nbsp; &nbsp; let mut file = File::create(\"foo.txt\").await.unwrap();&nbsp; // åˆ›å»ºæ–‡ä»¶\n&nbsp; &nbsp; file.write_all(b\"hello, world!\").await.unwrap();&nbsp; &nbsp; &nbsp; &nbsp; // å†™å…¥å†…å®¹\n&nbsp; &nbsp; Ok(())\n}\n\n#[tokio::main]\nasync fn main() {\n&nbsp; &nbsp; let result = doit().await;&nbsp;  //&nbsp;æ³¨æ„è¿™é‡Œçš„.await\n}\n</code></pre><h4>æ–‡ä»¶è¯»</h4><p>ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åŸºäºtokioåšæ–‡ä»¶çš„è¯»æ“ä½œã€‚</p><pre><code class=\"language-plain\">use tokio::fs::File;\nuse tokio::io::AsyncReadExt;&nbsp; &nbsp;// å¼•å…¥AsyncReadExt trait\n\nasync fn doit() -&gt; std::io::Result&lt;()&gt; {\n&nbsp; &nbsp; let mut file = File::open(\"foo.txt\").await.unwrap();  // æ‰“å¼€æ–‡ä»¶\n&nbsp; &nbsp; let mut contents = vec![];\n    // å°†æ–‡ä»¶å†…å®¹è¯»åˆ°contentsåŠ¨æ€æ•°ç»„é‡Œé¢ï¼Œæ³¨æ„ä¼ å…¥çš„æ˜¯å¯å˜å¼•ç”¨\n&nbsp; &nbsp; file.read_to_end(&amp;mut contents).await.unwrap();  \n&nbsp; &nbsp; println!(\"len = {}\", contents.len());\n&nbsp; &nbsp; Ok(())\n}\n\n#[tokio::main]\nasync fn main() {\n&nbsp; &nbsp; let result = doit().await;  //&nbsp;æ³¨æ„è¿™é‡Œçš„.await\n&nbsp; &nbsp; // process\n}\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼ŒRustçš„å¼‚æ­¥ä»£ç å’ŒJavaScriptçš„å¼‚æ­¥ä»£ç éå¸¸ç±»ä¼¼ï¼Œåªä¸è¿‡JavaScriptçš„ await å…³é”®å­—æ˜¯æ”¾åœ¨è¯­å¥å‰é¢çš„ã€‚</p><h4>å®šæ—¶å™¨æ“ä½œ</h4><p>ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åŸºäºtokioåšå®šæ—¶å™¨æ“ä½œã€‚</p><pre><code class=\"language-plain\">use tokio::time;\nuse std::time::Duration;\n\n#[tokio::main]\nasync fn main() {\n    // åˆ›å»ºIntervalå®ä¾‹\n    let mut interval = time::interval(Duration::from_millis(10));\n    // æ»´ç­”ï¼Œç«‹å³æ‰§è¡Œ\n    interval.tick().await;\n    // æ»´ç­”ï¼Œè¿™ä¸ªæ»´ç­”å®Œæˆåï¼Œ10msè¿‡å»äº†\n    interval.tick().await;\n    // æ»´ç­”ï¼Œè¿™ä¸ªæ»´ç­”å®Œæˆåï¼Œ20msè¿‡å»äº†\n    interval.tick().await;\n}\n</code></pre><p>ä¸Šé¢ç¤ºä¾‹é‡Œçš„æ—¶é—´æ®µï¼Œ<code>Duration::from_millis(10)</code> è¡¨ç¤ºåˆ›å»ºä¸€ä¸ª10msçš„æ—¶é—´æ®µï¼Œæˆ‘ä»¬åœ¨å…¶ä»–è¯­è¨€ä¸­æ›´å¤šæ˜¯ä¹ æƒ¯ç›´æ¥ä¼ å…¥ä¸€ä¸ªæ•°å­—ï¼Œæ¯”å¦‚ä¼  10000 è¿›å»ï¼Œé»˜è®¤å•ä½æ˜¯ usã€‚ä½†æ˜¯å‰é¢æˆ‘ä»¬è¯´è¿‡ï¼ŒRustä¸­ä¼šå°½å¯èƒ½åœ°ç±»å‹åŒ–ï¼Œå› æ­¤è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªDurationç±»å‹ï¼Œå®ƒå¯ä»¥æ¥æ”¶æ¥è‡ªsã€msã€usç­‰å•ä½çš„æ•°å€¼æ¥æ„é€ æ—¶é—´æ®µã€‚åœ¨è¿™ç‚¹ä¸Šï¼ŒJavaå’ŒRustæ˜¯æ¯”è¾ƒåƒçš„ã€‚</p><h3>tokioç»„ä»¶</h3><p>tokioå‘å±•åˆ°ç°åœ¨ï¼Œå·²ç»æ˜¯ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œã€æœºåˆ¶å®Œå–„çš„Runtimeæ¡†æ¶äº†ã€‚å®ƒé’ˆå¯¹å¼‚æ­¥åœºæ™¯æŠŠRustæ ‡å‡†åº“é‡Œå¯¹åº”çš„ç±»å‹å’Œè®¾æ–½éƒ½é‡æ–°å®ç°äº†ä¸€éã€‚å…·ä½“åŒ…å«6ä¸ªéƒ¨åˆ†ã€‚</p><ul>\n<li>Runtimeè®¾æ–½ç»„ä»¶ï¼šä½ å¯ä»¥è‡ªç”±åœ°é…ç½®åˆ›å»ºåŸºäºç³»ç»Ÿå•çº¿ç¨‹çš„Runtimeå’Œå¤šçº¿ç¨‹çš„Runtimeã€‚</li>\n<li>è½»é‡çº§ä»»åŠ¡ taskï¼šä½ å¯ä»¥æŠŠå®ƒç†è§£æˆç±»ä¼¼Goè¯­è¨€ä¸­çš„Goroutineè¿™ç§è½»é‡çº§çº¿ç¨‹ï¼Œè€Œä¸æ˜¯æ“ä½œç³»ç»Ÿå±‚é¢çš„çº¿ç¨‹ã€‚</li>\n<li>å¼‚æ­¥è¾“å…¥è¾“å‡ºï¼ˆI/Oï¼‰ï¼šç½‘ç»œæ¨¡å—netã€æ–‡ä»¶æ“ä½œæ¨¡å—fsã€signalæ¨¡å—ã€processæ¨¡å—ç­‰ã€‚</li>\n<li>æ—¶é—´æ¨¡å—ï¼šå®šæ—¶å™¨Intervalç­‰ã€‚</li>\n<li>å¼‚æ­¥åœºæ™¯ä¸‹çš„åŒæ­¥åŸè¯­ï¼šchannelã€Mutexé”ç­‰ç­‰ã€‚</li>\n<li>åœ¨å¼‚æ­¥ç¯å¢ƒä¸‹æ‰§è¡Œè®¡ç®—å¯†é›†å‹ä»»åŠ¡çš„æ–¹æ¡ˆ<code>spawn_blocking</code>ç­‰ç­‰ã€‚</li>\n</ul><p>é€šè¿‡å¯¹è¿™äº›åŸºç¡€è®¾æ–½çš„é‡æ–°å®ç°ï¼Œtokioä¸ºRustå¼‚æ­¥ç¼–ç¨‹çš„ç”Ÿæ€æ‰“ä¸‹äº†åšå®çš„åŸºç¡€ï¼Œé€šè¿‡å‡ å¹´çš„å‘å±•ï¼Œä¸€äº›ä¸Šå±‚å»ºç­‘è“¬å‹ƒå‘å±•èµ·æ¥äº†ã€‚æ¯”å¦‚ï¼š</p><ul>\n<li>Hyperï¼šHTTP åè®®Serverå’ŒClientçš„å®ç°</li>\n<li>Axumï¼šWebå¼€å‘æ¡†æ¶</li>\n<li>async-graphqlï¼šGraphQLå¼€å‘æ¡†æ¶</li>\n<li>tonicï¼šgRPCæ¡†æ¶çš„Rustå®ç°</li>\n<li>â€¦â€¦</li>\n</ul><h3>tokioåº•å±‚æœºåˆ¶</h3><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹tokioçš„åº•å±‚é­”æ³•åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</p><p><img src=\"https://static001.geekbang.org/resource/image/cb/68/cb7a4be8f0ae2f99f99967e2b8398b68.png?wh=2008x1328\" alt=\"\"></p><p>æœ€åº•å±‚æ˜¯ç¡¬ä»¶ã€CPUç­‰ã€‚åœ¨å…¶ä¸Šæ˜¯æ“ä½œç³»ç»Ÿï¼ŒLinuxã€Windowsã€macOS ç­‰ã€‚ä¸åŒçš„æ“ä½œç³»ç»Ÿä¼šæä¾›ä¸åŒçš„å¼‚æ­¥æŠ½è±¡æœºåˆ¶ï¼Œæ¯”å¦‚ Linux ä¸‹æœ‰ epollï¼ŒmacOSä¸‹æœ‰kqueueã€‚</p><p>Tokioçš„å¼‚æ­¥Runtimeèƒ½åŠ›å®é™…æ­£æ˜¯å»ºç«‹åœ¨æ“ä½œç³»ç»Ÿçš„è¿™äº›å¼‚æ­¥æœºåˆ¶ä¸Šçš„ã€‚Tokioçš„reactorç”¨æ¥æ¥æ”¶ä»æ“ä½œç³»ç»Ÿçš„å¼‚æ­¥æ¡†æ¶ä¸­ä¼ å›çš„æ¶ˆæ¯äº‹ä»¶ï¼Œç„¶åé€šçŸ¥ tokio waker æŠŠå¯¹åº”çš„ä»»åŠ¡å”¤é†’ï¼Œæ”¾å› tokio executor ä¸­æ‰§è¡Œã€‚æ¯ä¸€ä¸ªä»»åŠ¡ä¼šè¢«æŠ½è±¡æˆä¸€ä¸ªFutureæ¥ç‹¬ç«‹å¤„ç†ï¼Œè€Œæ¯ä¸€ä¸ªFutureåœ¨Rustä¸­ä¼šè¢«å¤„ç†æˆä¸€ä¸ªç»“æ„ä½“ï¼Œç”¨çŠ¶æ€æœºçš„æ–¹å¼æ¥ç®¡ç†ã€‚Tokioä¸­è¿˜å®ç°äº†å¯¹è¿™äº›ä»»åŠ¡çš„å®‰æ’è°ƒåº¦æœºåˆ¶ã€‚</p><p><span class=\"reference\">æ³¨ï¼šå®˜æ–¹çš„ <a href=\"https://rust-lang.github.io/async-book/\">async book</a> æœ‰å¯¹è¿™ä¸ªä¸“é¢˜æ›´æ·±å…¥çš„è®²è§£ï¼šä¸è¿‡è¿™æœ¬å¼‚æ­¥ä¹¦å†™å¾—åéš¾ï¼Œå¹¶ä¸é€‚åˆæ–°æ‰‹ï¼Œæœ‰å…´è¶£çš„è¯å¯ä»¥ç¿»é˜…ä¸€ä¸‹ã€‚</span></p><h3>taskï¼šè½»é‡çº§çº¿ç¨‹</h3><p>tokioæä¾›äº†ä¸€ç§åˆä½œå¼ï¼ˆè€ŒéæŠ¢å å¼ï¼‰çš„ä»»åŠ¡æ¨¡å‹ï¼šæ¯ä¸ªä»»åŠ¡taskéƒ½å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªè½»é‡çº§çš„çº¿ç¨‹ï¼Œä¸æ“ä½œç³»ç»Ÿçº¿ç¨‹ç›¸å¯¹ã€‚æ“ä½œç³»ç»Ÿé»˜è®¤çš„çº¿ç¨‹æœºåˆ¶éœ€è¦æ¶ˆè€—æ¯”è¾ƒå¤šçš„èµ„æºï¼Œä¸€å°æ™®é€šæœåŠ¡å™¨ä¸Šèƒ½å¯åŠ¨çš„æ€»çº¿ç¨‹æ•°ä¸€èˆ¬æœ€å¤šä¹Ÿå°±å‡ åƒä¸ªã€‚è€Œtokioçš„è½»é‡çº§çº¿ç¨‹å¯ä»¥åœ¨ä¸€å°æ™®é€šæœåŠ¡å™¨ä¸Šåˆ›å»ºä¸Šç™¾ä¸‡ä¸ªã€‚</p><h4>Mï¼šNæ¨¡å‹</h4><p>tokioçš„è¿™ä¸ªæ¨¡å‹æ˜¯ä¸€ç§Mï¼šNæ¨¡å‹ï¼ŒMè¡¨ç¤ºè½»é‡çº§çº¿ç¨‹çš„æ•°é‡ï¼ŒNè¡¨ç¤ºæ“ä½œç³»ç»Ÿçº¿ç¨‹çš„æ•°é‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå®é™…æ˜¯å°†æ‰€æœ‰çš„è½»é‡çº§çº¿ç¨‹æ˜ å°„åˆ°å…·ä½“çš„Nä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹ä¸Šæ¥æ‰§è¡Œï¼Œç›¸å½“äºåœ¨æ“ä½œç³»ç»Ÿçº¿ç¨‹ä¹‹ä¸ŠæŠ½è±¡äº†ä¸€å±‚ï¼Œè¿™å±‚æŠ½è±¡æ˜¯å¦é«˜æ•ˆæ­£æ˜¯è¡¡é‡ä¸€ä¸ªRuntimeå¥½åçš„æ ¸å¿ƒæ ‡å‡†ã€‚å…¶ä¸­ï¼Œæ“ä½œç³»ç»Ÿçº¿ç¨‹æ•°é‡Næ˜¯å¯ä»¥ç”±å¼€å‘è€…è‡ªè¡Œé…ç½®çš„ï¼Œæœ€å¸¸ç”¨çš„é»˜è®¤é…ç½®æ˜¯ä¸€ä¸ªæœºå™¨ä¸Šæœ‰å¤šå°‘CPUé€»è¾‘å¤„ç†å™¨æ ¸ï¼ŒNå°±ç­‰äºå¤šå°‘ã€‚</p><h4>åˆä½œå¼</h4><p>åŒæ—¶ï¼Œtokioçš„è½»é‡çº§çº¿ç¨‹ä¹‹é—´çš„å…³ç³»æ˜¯ä¸€ç§åˆä½œå¼çš„ã€‚åˆä½œå¼çš„æ„æ€å°±æ˜¯åŒä¸€ä¸ªCPUæ ¸ä¸Šçš„ä»»åŠ¡å¤§å®¶æ˜¯é…åˆç€æ‰§è¡Œï¼ˆä¸åŒCPUæ ¸ä¸Šçš„ä»»åŠ¡æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼‰ã€‚æˆ‘ä»¬å¯ä»¥è®¾æƒ³ä¸€ä¸ªç®€å•çš„åœºæ™¯ï¼ŒAå’ŒBä¸¤ä¸ªä»»åŠ¡è¢«åˆ†é…åˆ°äº†åŒä¸€ä¸ªCPUæ ¸ä¸Šï¼ŒAå…ˆæ‰§è¡Œï¼Œé‚£ä¹ˆï¼Œåªæœ‰åœ¨Aå¼‚æ­¥ä»£ç ä¸­ç¢°åˆ° <code>.await</code> è€Œä¸”ä¸èƒ½ç«‹å³å¾—åˆ°è¿”å›å€¼çš„æ—¶å€™ï¼Œæ‰ä¼šè§¦å‘æŒ‚èµ·ï¼Œè¿›è€Œåˆ‡æ¢åˆ°ä»»åŠ¡Bæ‰§è¡Œã€‚</p><p>å½“ä»»åŠ¡Bç¢°åˆ° <code>.await</code> æ—¶ï¼Œåˆä¼šå›å»æ£€æŸ¥ä¸€ä¸‹ä»»åŠ¡Aæ‰€awaitçš„é‚£ä¸ªå€¼å›æ¥æ²¡æœ‰ï¼Œå¦‚æœå›æ¥äº†å°±å”¤é†’ä»»åŠ¡Aï¼Œä»ä¹‹å‰é‚£ä¸ª <code>.await</code> åé¢çš„è¯­å¥ç»§ç»­æ‰§è¡Œï¼›å¦‚æœæ²¡å›æ¥å°±ç»§ç»­ç­‰å¾…ï¼Œæˆ–è€…çœ‹çœ‹èƒ½ä¸èƒ½ä»å…¶ä»–æ ¸ä¸Šæ‹¿ç‚¹ä»»åŠ¡è¿‡æ¥æ‰§è¡Œï¼Œå› ä¸ºæ­¤æ—¶ä»»åŠ¡Aå’Œä»»åŠ¡Béƒ½åœ¨ç­‰å¾…awaitçš„å€¼å›æ¥ã€‚ä»»ä½•ä¸€ä¸ªtaské‡Œawaitçš„å€¼å›æ¥åï¼ˆä¼šç”±æ“ä½œç³»ç»Ÿå‘tokioé€šçŸ¥ä¸€ä¸ªäº‹ä»¶ï¼‰ï¼Œtokioå°±ä¼šå”¤é†’å¯¹åº”çš„taskç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸€ä¸ªtaskæ²¡æœ‰é‡åˆ° <code>.await</code> ä¹‹å‰ï¼Œå®ƒæ˜¯ä¸ä¼šä¸»åŠ¨äº¤å‡ºè¿™ä¸ªCPUæ ¸çš„ï¼Œå…¶ä»–taskä¹Ÿä¸èƒ½ä¸»åŠ¨æ¥æŠ¢å è¿™ä¸ªCPUæ ¸ã€‚æ‰€ä»¥tokioå®ç°çš„è¿™ä¸ªæ¨¡å‹å«åšåˆä½œå¼çš„ã€‚å’Œå®ƒç›¸å¯¹çš„ï¼ŒGoè¯­è¨€è‡ªå¸¦çš„Runtimeå®ç°çš„Goroutineæ˜¯ä¸€ç§æŠ¢å å¼çš„è½»é‡çº§çº¿ç¨‹ã€‚</p><h4>éé˜»å¡</h4><p>ä»å‰é¢ä»£ç çš„ç¤ºèŒƒåŠè®²è§£å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ç¨‹åºå‘˜è¿™ä¸ªè§†è§’çœ‹æ¥ï¼Œä»£ç å±‚é¢çš„æ•ˆæœæ˜¯ä¸€ä¸ªtaskï¼ˆä¸€æ®µå¼‚æ­¥ä»£ç ï¼‰é‡åˆ° <code>.await</code> æ—¶ï¼Œçœ‹èµ·æ¥å°±å¥½åƒæ˜¯è¢«é˜»å¡ä½äº†ï¼Œä¼šç­‰å¾…è¯·æ±‚ç»“æœçš„è¿”å›ã€‚è€Œä»tokioåº•å±‚çš„è¿è¡Œå’Œè°ƒåº¦æœºåˆ¶æ¥çœ‹ï¼Œå®ƒåˆæ˜¯éé˜»å¡çš„ã€‚éé˜»å¡çš„æ„æ€æ˜¯ï¼Œä¸€ä¸ªè½»é‡çº§çº¿ç¨‹taskçš„â€œå¡ä½â€ï¼Œä¸ä¼šæŠŠç”¨æ¥æ‰¿è½½å®ƒçš„æ“ä½œç³»ç»Ÿçº¿ç¨‹ç»™çœŸæ­£åœ°å¡ä½ï¼ŒOSçº¿ç¨‹è¢«è°ƒåº¦äº†æ–°çš„ä»»åŠ¡æ‰§è¡Œã€‚è¿™æ ·ï¼ŒCPUèµ„æºå°±æ²¡æœ‰è¢«æµªè´¹ã€‚</p><p>è¿™ä¸ªtaskä¹‹é—´çš„è°ƒåº¦å·¥ä½œæ˜¯åœ¨tokioå†…éƒ¨è‡ªåŠ¨å®Œæˆçš„ï¼Œå¯¹ç¨‹åºå‘˜æ¥è¯´æ˜¯ä¸å¯è§çš„ã€‚è¿™æ ·å°±å¸¦æ¥äº†å·¨å¤§çš„å¥½å¤„ï¼Œç¨‹åºå‘˜å†™å¼‚æ­¥å¹¶å‘ä»£ç ï¼Œå°±è·Ÿä¹‹å‰å†™åŒæ­¥ä»£ç åŸºæœ¬ä¸€æ ·ï¼Œé¡ºç€å°†é€»è¾‘å†™ä¸‹å»å°±è¡Œäº†ã€‚è€Œä¸ä¼šå› ä¸ºå»é€‚åº”å¼‚æ­¥å›è°ƒè€ŒæŠŠä»£ç é€»è¾‘æ‰“ç¢åˆ†æ•£åˆ°æ–‡ä»¶çš„å„ä¸ªåœ°æ–¹ã€‚æ‰€ä»¥ï¼Œtokioçš„taskåœ¨çœŸæ­£æ‰§è¡Œçš„æ—¶å€™æ˜¯éé˜»å¡çš„ï¼Œä¸ä¼šå¯¹ç³»ç»Ÿèµ„æºé€ æˆæµªè´¹ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•åˆ›å»ºtokio taskï¼Œè¿™éœ€è¦ä½¿ç”¨ <code>task::spawn()</code> å‡½æ•°ã€‚</p><pre><code class=\"language-plain\">use tokio::task;\n\n#[tokio::main]\nasync fn main() {\n&nbsp; &nbsp; task::spawn(async {\n&nbsp; &nbsp; &nbsp; &nbsp; // åœ¨è¿™é‡Œæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡\n&nbsp; &nbsp; });\n}\n</code></pre><p>åœ¨è¿™ä¸ªç¤ºä¾‹é‡Œï¼Œmainå‡½æ•°é‡Œé¢åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„taskï¼Œç”¨æ¥æ‰§è¡Œå…·ä½“çš„ä»»åŠ¡ã€‚æˆ‘ä»¬éœ€è¦çŸ¥é“ï¼Œtokioç®¡ç†ä¸‹çš„ <code>async fn main() {}</code> æœ¬èº«å°±æ˜¯ä¸€ä¸ªtaskï¼Œç›¸å½“äºåœ¨main taskä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„taskæ¥æ‰§è¡Œã€‚è¿™é‡Œï¼Œmain taskå°±æ˜¯çˆ¶taskï¼Œæ–°åˆ›å»ºçš„è¿™ä¸ªtaskæ˜¯å­taskã€‚</p><p>é‚£èªæ˜çš„ä½ å¯èƒ½è¦é—®äº†ï¼Œè¿™ä¸¤ä¸ªtaskä¹‹é—´çš„ç”Ÿå­˜å…³ç³»æ˜¯æ€æ ·çš„å‘¢ï¼Ÿå®ƒä»¬å…¶å®æ˜¯æ²¡æœ‰å…³ç³»çš„ã€‚åœ¨tokioä¸­ï¼Œå­taskçš„ç”Ÿå­˜æœŸæœ‰å¯èƒ½è¶…è¿‡çˆ¶taskçš„ç”Ÿå­˜æœŸï¼Œä¹Ÿå°±æ˜¯çˆ¶taskæ‰§è¡Œç»“æŸäº†ï¼Œä½†å­taskè¿˜åœ¨æ‰§è¡Œã€‚å¦‚æœåœ¨çˆ¶taské‡Œè¦ç­‰å¾…å­taskæ‰§è¡Œå®Œï¼Œå†ç»“æŸè‡ªå·±ï¼Œä¿é™©çš„åšæ³•æ˜¯ç”¨ JoinHandlerã€‚</p><p><span class=\"reference\">æ³¨ï¼šåœ¨mainå‡½æ•°ä¸­æœ‰æ›´å¤šç»†èŠ‚ï¼Œå¦‚æœmainå‡½æ•°æ‰€åœ¨çš„taskå…ˆç»“æŸäº†ï¼Œä¼šå¯¼è‡´æ•´ä¸ªç¨‹åºè¿›ç¨‹é€€å‡ºï¼Œæœ‰å¯èƒ½ä¼šå¼ºåˆ¶æ€æ‰é‚£äº›æ–°åˆ›å»ºçš„å­taskã€‚</span></p><pre><code class=\"language-plain\">use tokio::task;\n\n#[tokio::main]\nasync fn main() {\n    // åœ¨è¿™é‡Œæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡\n    let task_a = task::spawn(async {    \n        \"hello world!\"\n    });\n    // ...\n    // ç­‰å¾…å­ä»»åŠ¡ç»“æŸï¼Œè¿”å›ç»“æœ\n    let result = task_a.await.unwrap();\n    assert_eq!(result, \"hello world!\");\n}\n</code></pre><p>JoinHandleræ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿè¿™ä¸ªæ–°æ¦‚å¿µè·Ÿtaskçš„ç®¡ç†ç›¸å…³ã€‚æˆ‘ä»¬åœ¨main taskä¸­é‡Œåˆ›å»ºä¸€ä¸ªæ–°taskåï¼Œ<code>task::spawn()</code> å‡½æ•°å®é™…æœ‰ä¸€ä¸ªè¿”å›å€¼ï¼Œå®ƒè¿”å›ä¸€ä¸ªhandlerï¼Œè¿™ä¸ªhandlerå¯ä»¥è®©æˆ‘ä»¬åœ¨main taské‡Œç®¡ç†æ–°åˆ›å»ºçš„taskã€‚è¿™ä¸ªhandlerä¹Ÿå¯ä»¥ç”¨æ¥æŒ‡ä»£è¿™ä¸ªæ–°çš„taskï¼Œç›¸å½“äºç»™è¿™ä¸ªtaskå–äº†ä¸€ä¸ªåå­—ã€‚æ¯”å¦‚ç¤ºä¾‹é‡Œï¼Œæˆ‘ä»¬å°±æŠŠè¿™ä¸ªæ–°çš„ä»»åŠ¡å‘½åä¸ºtask_aï¼Œå®ƒçš„ç±»å‹æ˜¯ JoinHandlerã€‚åœ¨ç”¨ <code>spawn()</code> åˆ›å»ºtask_aåï¼Œè¿™ä¸ªæ–°ä»»åŠ¡å°±<strong>ç«‹å³æ‰§è¡Œ</strong>ã€‚</p><p><code>task_a.await</code> ä¼šè¿”å›ä¸€ä¸ªResultï¼Œæ‰€ä»¥ä¸Šé¢ä»£ç ä¸­ï¼Œéœ€è¦åŠ ä¸€ä¸ª <code>unwrap()</code> æŠŠtask_açœŸæ­£çš„è¿”å›å†…å®¹è§£åŒ…å‡ºæ¥ã€‚è‡³äºå¯¹taskçš„ <code>.await</code> ä¸ºä»€ä¹ˆä¼šè¿”å›ä¸€ä¸ªResultï¼Œè€Œä¸æ˜¯ç›´æ¥è¿”å›å¼‚æ­¥ä»»åŠ¡çš„è¿”å›å€¼æœ¬èº«ï¼Œæ˜¯å› ä¸ºtaské‡Œæœ‰å¯èƒ½ä¼šå‘ç”Ÿpanicã€‚ä½ å¯ä»¥çœ‹ä¸€ä¸‹ä¾‹å­ã€‚</p><pre><code class=\"language-plain\">use tokio::task;\n\n#[tokio::main]\nasync fn main() {\n    let task_a = task::spawn(async {\n        panic!(\"something bad happened!\")\n    });\n    // å½“task_aé‡Œé¢panicæ—¶ï¼Œå¯¹task handlerè¿›è¡Œ.awaitï¼Œä¼šå¾—åˆ°Err\n    assert!(task_a.await.is_err());\n}\n</code></pre><p>ç”±äºtaskå¯èƒ½ä¼španicï¼Œæ‰€ä»¥å°±å¾—å¯¹taskçš„è¿”å›å€¼ç”¨ResultåŒ…ä¸€å±‚ï¼Œè¿™æ ·æ–¹ä¾¿åœ¨ä¸Šä¸€å±‚çš„taské‡Œå¤„ç†è¿™ç§é”™è¯¯ã€‚<strong>åœ¨Rustä¸­ï¼Œåªè¦è¿‡ç¨‹ä¸­æœ‰å¯èƒ½è¿”å›é”™è¯¯ï¼Œé‚£å°±æœæ–­ç”¨ResultåŒ…ä¸€å±‚ä½œä¸ºè¿”å›å€¼ï¼Œè¿™æ˜¯å…¸å‹åšæ³•ã€‚</strong></p><p>æœ‰äº† JoinHandlerï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°åˆ›å»ºä¸€æ‰¹æ–°ä»»åŠ¡ï¼Œå¹¶ç­‰å¾…å®ƒä»¬çš„è¿”å›å€¼ã€‚ä½ å¯ä»¥çœ‹ä¸€ä¸‹ç¤ºä¾‹ã€‚</p><pre><code class=\"language-plain\">use tokio::task;\n\nasync fn my_background_op(id: i32) -&gt; String {\n    let s = format!(\"Starting background task {}.\", id);\n    println!(\"{}\", s);\n    s\n}\n\n#[tokio::main]\nasync fn main() {\n    let ops = vec![1, 2, 3];\n    let mut tasks = Vec::with_capacity(ops.len());\n    for op in ops {\n        // ä»»åŠ¡åˆ›å»ºåï¼Œç«‹å³å¼€å§‹è¿è¡Œï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªVecæ¥æŒæœ‰å„ä¸ªä»»åŠ¡çš„handler\n        tasks.push(tokio::spawn(my_background_op(op)));\n    }\n    let mut outputs = Vec::with_capacity(tasks.len());\n    for task in tasks {\n        outputs.push(task.await.unwrap());\n    }\n    println!(\"{:?}\", outputs);\n}\n// è¾“å‡º\nStarting background task 1.\nStarting background task 2.\nStarting background task 3.\n</code></pre><p>ä¸Šé¢ç¤ºä¾‹é‡Œï¼Œæˆ‘ä»¬ç”¨ tasks è¿™ä¸ªåŠ¨æ€æ•°ç»„æŒæœ‰3ä¸ªå¼‚æ­¥ä»»åŠ¡çš„handlerï¼Œ<strong>å®ƒä»¬æ˜¯å¹¶å‘æ‰§è¡Œçš„</strong>ã€‚ç„¶åå¯¹ tasks è¿›è¡Œè¿­ä»£ï¼Œç­‰å¾…æ¯ä¸ªtaskæ‰§è¡Œå®Œæˆï¼Œå¹¶ä¸”æœé›†ä»»åŠ¡çš„ç»“æœæ”¾åˆ° outputs åŠ¨æ€æ•°ç»„é‡Œã€‚æœ€åæ‰“å°å‡ºæ¥ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨tokioä¸­åˆ›å»ºä¸€æ‰¹ä»»åŠ¡å¹¶å‘æ‰§è¡Œéå¸¸ç®€å•ï¼Œå¾ªç¯è°ƒç”¨ <code>task::spawn()</code> å°±è¡Œäº†ï¼Œå¹¶ä¸”è¿˜èƒ½å¯¹åˆ›å»ºçš„ä»»åŠ¡è¿›è¡Œç®¡ç†ã€‚</p><h3>å“ªäº›æ“ä½œè¦åŠ  <code>.await</code>ï¼Ÿ</h3><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»åˆæ­¥æ„ŸçŸ¥åˆ°äº†tokioçš„å¼ºå¤§èƒ½åŠ›ï¼Œç¡®å®å¾ˆå¥½ç”¨ï¼Œä¹Ÿå¾ˆç›´è§‚ã€‚ä½†æ˜¯æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªç–‘æƒ‘ï¼Œåœ¨å†™å¼‚æ­¥ä»£ç çš„æ—¶å€™ï¼Œæˆ‘æ€ä¹ˆçŸ¥é“å“ªäº›åœ°æ–¹è¯¥åŠ  <code>.await</code>ï¼Œå“ªäº›åœ°æ–¹ä¸è¯¥åŠ å‘¢ï¼Ÿ</p><p>ä¸€ä¸ªæ€»ä½“çš„åŸåˆ™æ˜¯ï¼Œ<strong>æ¶‰åŠåˆ°I/Oæ“ä½œçš„ï¼Œéƒ½å¯ä»¥åŠ </strong>ï¼Œå› ä¸ºtokioå·²ç»å¸®æˆ‘ä»¬å®ç°äº†ä¸€ä»½å¼‚æ­¥çš„å¯¹åº”äºRustæ ‡å‡†åº“çš„I/Oå®ç°ã€‚æœ€å¸¸è§çš„I/Oæ“ä½œå°±æ˜¯ç½‘ç»œI/Oã€ç£ç›˜I/Oç­‰ç­‰ã€‚å…·ä½“æ¥è¯´ï¼Œæœ‰å‡ å¤§æ¨¡å—ã€‚</p><ul>\n<li>netæ¨¡å—ï¼šç½‘ç»œæ“ä½œï¼›</li>\n<li>fsæ¨¡å—ï¼šæ–‡ä»¶æ“ä½œï¼›</li>\n<li>å®šæ—¶å™¨æ“ä½œï¼šIntervalã€sleepç­‰å‡½æ•°ï¼›</li>\n<li>channelï¼šå››ç§ç®¡é“ oneshotã€mpscã€watchã€broadcastï¼›</li>\n<li>signalæ¨¡å—ï¼šç³»ç»Ÿä¿¡å·å¤„ç†ï¼›</li>\n<li>processæ¨¡å—ï¼šè°ƒç”¨ç³»ç»Ÿå‘½ä»¤ç­‰ã€‚</li>\n</ul><p>å…·ä½“å¯ä»¥æŸ¥çœ‹ <a href=\"https://docs.rs/tokio/1.32.0/tokio/index.html\">tokio API</a>ã€‚åœ¨æŸ¥çœ‹APIæ–‡æ¡£çš„æ—¶å€™ï¼Œåªè¦é‚£ä¸ªæ¥å£å‰é¢æœ‰ async å…³é”®å­—ä¿®é¥°ï¼Œé‚£ä¹ˆä½¿ç”¨çš„æ—¶å€™å°±éœ€è¦åŠ  <code>.await</code>ã€‚æ¯”å¦‚ï¼Œ<code>tokio::fs::read()</code> çš„å®šä¹‰å°±æ˜¯è¿™æ ·çš„ï¼š</p><pre><code class=\"language-plain\">pub async fn read(path: impl AsRef&lt;Path&gt;) -&gt; Result&lt;Vec&lt;u8&gt;&gt;\n</code></pre><p>è€Œåƒå…¶ä»–çš„ä¸€äº›æ•°æ®ç»“æ„çš„åŸºæœ¬æ“ä½œï¼Œæ¯”å¦‚ <code>Vec&lt;T&gt;</code>ã€<code>HashMap&lt;K, V&gt;</code> çš„æ“ä½œç­‰ï¼Œç”±äºå®ƒä»¬éƒ½æ˜¯åœ¨å†…å­˜é‡Œæ‰§è¡Œï¼Œå®ƒä»¬çš„æ¥å£å‰é¢ä¹Ÿæ²¡æœ‰ async å…³é”®å­—ä¿®é¥°ï¼Œæ‰€ä»¥ä¸éœ€è¦ä¹Ÿä¸èƒ½åŠ  <code>.await</code>ã€‚</p><h2>å°ç»“</h2><p>è¿™èŠ‚è¯¾æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†Async Rustå’Œtokioç›¸å…³çš„åŸºæœ¬æ¦‚å¿µã€‚Async Ruståœ¨æ•´ä¸ªRustçš„ä½“ç³»ä¸­ï¼Œç›¸å¯¹äºstd Rustæ¥è®²æ˜¯ä¸€ç‰‡æ–°çš„é¢†åœ°ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/8d/11/8d8befc6fc1fb09b5f496489b3bb3611.jpg?wh=1428x1344\" alt=\"\"></p><p>Rustä¸­çš„ async ä»£ç å…·æœ‰<strong>ä¼ æŸ“æ€§</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªå‡½æ•°å¦‚æœè¦è°ƒç”¨ä¸€ä¸ªasyncå‡½æ•°çš„è¯ï¼Œå®ƒæœ¬èº«ä¹Ÿéœ€è¦æ˜¯asyncå‡½æ•°ã€‚Ruståœ¨è¯­è¨€å±‚é¢æä¾›äº† <code>async/.await</code> è¯­æ³•çš„æ”¯æŒï¼Œä½†æ˜¯å…¶å¹¶æ²¡æœ‰æä¾›ä¸€ä¸ªå®˜æ–¹çš„å¼‚æ­¥è¿è¡Œæ—¶ï¼Œæ¥å¯¹å¼‚æ­¥ä»£ç çš„æ‰§è¡Œè¿›è¡Œé©±åŠ¨ã€‚è€Œtokioæ˜¯æ•´ä¸ªRustç”Ÿæ€ä¸­ç»å†è¿‡æ¿€çƒˆç«äº‰åçš„å¼‚æ­¥è¿è¡Œæ—¶èƒœå‡ºè€…ï¼Œå…·æœ‰å¼ºå¤§çš„åŠŸèƒ½ã€ä¸°å¯Œçš„ç‰¹æ€§å’Œå¹¿æ³›çš„ä½¿ç”¨åº¦ã€‚</p><p>tokioæä¾›äº†ä¸€å¥—è½»é‡çº§çº¿ç¨‹æ¨¡å‹ï¼Œæ–¹ä¾¿ç¨‹åºå‘˜ä½¿ç”¨Rustè¿›è¡Œå¤§è§„æ¨¡å¹¶å‘ç¨‹åºå¼€å‘ï¼Œç‰¹åˆ«é€‚åˆé«˜æ€§èƒ½WebæœåŠ¡å™¨é¢†åŸŸï¼Œä¹Ÿé€‚åˆå¤„ç†ä¸€èˆ¬çš„å¼‚æ­¥ä¸šåŠ¡ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦æŠŠasync Rustå«åšâ€œç‹¬ç«‹ç‹å›½â€å‘¢ï¼Ÿæ¬¢è¿ä½ æŠŠè‡ªå·±çš„æ€è€ƒåˆ†äº«åˆ°è¯„è®ºåŒºï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾çš„å†…å®¹åˆ†äº«ç»™å…¶ä»–æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","neighbors":{"left":{"article_title":"12ï½œæ™ºèƒ½æŒ‡é’ˆï¼šä»æ‰€æœ‰æƒçœ‹æ™ºèƒ½æŒ‡é’ˆ","id":725815},"right":{"article_title":"14ï½œtokioå®æˆ˜ï¼šç¼–å†™ä¸€ä¸ªç½‘ç»œå‘½ä»¤è¡Œç¨‹åº","id":726207}},"comments":[{"had_liked":false,"id":384450,"user_name":"Geek_e72251","can_delete":false,"product_type":"c1","uid":3733050,"ip_address":"å¹¿ä¸œ","ucode":"894904DE2E6AC0","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/VF71Gcf2C2bjYPFCRv0TPfwhkJmT5WhtusltuaXQM0KMDibdallNFypqWV6v2FJ4bqNwzujiaF5LEDeia7JMZTTtw/132","comment_is_top":false,"comment_ctime":1700929691,"is_pvip":false,"replies":[{"id":140270,"content":"1ã€‚ä»ç¨‹åºå‘˜äººä½“å·¥å­¦è§†è§’çœ‹ï¼Œasync&#47;await è®©æˆ‘ä»¬å¥½åƒåœ¨å†™é¡ºåºåŒæ­¥ä»£ç ã€‚\n2ã€‚ä»cpuæ‰§è¡Œè§†è§’æ¥çœ‹ï¼Œawaitç­‰å¾…é‚£ä¸ªtaskè¿›å±•çš„æ—¶å€™ï¼Œcpuè·‘å»æ‰§è¡Œå…¶ä»–taskäº†ã€‚\n\nè¿™ä¸ªåœ¨æ–‡ç« ä¸­æœ‰å¤§æ®µæ®µè½è®²è§£ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1701052199,"ip_address":"é‡åº†","comment_id":384450,"utype":1}],"discussion_count":5,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"å¼‚æ­¥å‡½æ•°å¿…é¡»è¦.awaitå¾—åˆ°è¿”å›ç»“æœæ‰èƒ½å¤Ÿæ¥ç€å¾€ä¸‹æ‰§è¡Œå—ï¼Ÿé‚£å’ŒåŒæ­¥å‡½æ•°æœ‰ä»€ä¹ˆåŒºåˆ«","like_count":6,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632596,"discussion_content":"1ã€‚ä»ç¨‹åºå‘˜äººä½“å·¥å­¦è§†è§’çœ‹ï¼Œasync/await è®©æˆ‘ä»¬å¥½åƒåœ¨å†™é¡ºåºåŒæ­¥ä»£ç ã€‚\n2ã€‚ä»cpuæ‰§è¡Œè§†è§’æ¥çœ‹ï¼Œawaitç­‰å¾…é‚£ä¸ªtaskè¿›å±•çš„æ—¶å€™ï¼Œcpuè·‘å»æ‰§è¡Œå…¶ä»–taskäº†ã€‚\n\nè¿™ä¸ªåœ¨æ–‡ç« ä¸­æœ‰å¤§æ®µæ®µè½è®²è§£ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1701052199,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2557688,"avatar":"https://static001.geekbang.org/account/avatar/00/27/06/f8/09ad484b.jpg","nickname":"å­¦æ°´","note":"","ucode":"F8B27FD11187EC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":632859,"discussion_content":"é‚£æˆ‘ç†è§£ï¼Œ.awaitå’Œjavaçš„futureçš„.get()å…¶å®ä¹Ÿä¸€æ ·ï¼ŒåŒæ ·å µå¡åä¼šå»æ‰§è¡Œåˆ«çš„ä»»åŠ¡ï¼Œåªæ˜¯tokioåœ¨åç¨‹å±‚é¢ä¸Šçš„ï¼Œè¯­è¨€runtimeä¸­çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¯”javdè¿™ç§kernel threadåœ¨ç³»ç»Ÿå†…æ ¸æ€ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æˆæœ¬è¦å°å¾—å¤š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1701471597,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":632596,"ip_address":"åŠ æ‹¿å¤§","group_id":0},"score":632859,"extra":""}]},{"author":{"id":2867445,"avatar":"","nickname":"WiHceeg","note":"","ucode":"5AA0BD044E3939","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":642503,"discussion_content":"æˆ‘ç†è§£æ˜¯è¿™æ ·çš„ï¼Œ.awaitç¡®å®æ˜¯å¾—åˆ°è¿”å›ç»“æœæ‰èƒ½å¤Ÿæ¥ç€å¾€ä¸‹æ‰§è¡Œåé¢çš„ä»£ç ï¼Œå¦‚æœä¸æ˜¯è¦é©¬ä¸Šç”¨åˆ°è¿™ä¸ªç»“æœï¼Œspawn åå°±å…ˆä¸è¦åŠ .await ï¼Œå®ƒä¹Ÿä¼šåœ¨åå°è·‘ç€ï¼Œç­‰è¦ç”¨åˆ°è¿”å›ç»“æœä¹‹å‰å†ç»™ spawn å‡ºæ¥çš„ JoinHandle åŠ  .await","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1713619145,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ±Ÿè¥¿","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1019939,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/90/23/5c74e9b7.jpg","nickname":"$ä¾¯","note":"","ucode":"488B1BD3924E7E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634564,"discussion_content":"å¦‚æœä½ æœ‰é™ˆå¤©è€å¸ˆçš„è¯¾ï¼Œå¯ä»¥å»çœ‹38èŠ‚ï¼Œæœ‰è¯¦ç»†çš„è§£é‡Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1703663946,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":3733050,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/VF71Gcf2C2bjYPFCRv0TPfwhkJmT5WhtusltuaXQM0KMDibdallNFypqWV6v2FJ4bqNwzujiaF5LEDeia7JMZTTtw/132","nickname":"Geek_e72251","note":"","ucode":"894904DE2E6AC0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1019939,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/90/23/5c74e9b7.jpg","nickname":"$ä¾¯","note":"","ucode":"488B1BD3924E7E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634590,"discussion_content":"è°¢è°¢ï¼Œçœ‹äº†å¾ˆæœ‰æ”¶è·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1703685750,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":634564,"ip_address":"å¹¿ä¸œ","group_id":0},"score":634590,"extra":""}]}]},{"had_liked":false,"id":385995,"user_name":"Joe Black","can_delete":false,"product_type":"c1","uid":1052528,"ip_address":"åŒ—äº¬","ucode":"21FE222A286445","user_header":"https://static001.geekbang.org/account/avatar/00/10/0f/70/cdef7a3d.jpg","comment_is_top":false,"comment_ctime":1703815373,"is_pvip":false,"replies":[{"id":140676,"content":"å¥½æ€è€ƒï¼Œåé¢ä¼šè®²åˆ°è¿™ä¸ª","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1703842143,"ip_address":"é‡åº†","comment_id":385995,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"å¦‚æœå¯åŠ¨äº†å¤šä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œä¸æƒ³æŒ¨ç€é¡ºåºawaitï¼ˆå› ä¸ºæœ‰å¯èƒ½åé¢å¯åŠ¨çš„æå‰ç»“æŸï¼‰ï¼Œæœ‰æ²¡æœ‰åŠæ³•å®ç°ç­‰å¾…ä¸€æ‰¹ä»»åŠ¡å¹¶ä¸”å…¶ä¸­ä¸€ä¸ªä»»åŠ¡å®Œæˆå°±è¿”å›å¤„ç†å‘¢ï¼Ÿå¤„ç†åå†å»ç­‰å¾…å…¶å®ƒæœªå®Œæˆçš„ä»»åŠ¡ã€‚","like_count":2,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634729,"discussion_content":"å¥½æ€è€ƒï¼Œåé¢ä¼šè®²åˆ°è¿™ä¸ª","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1703842143,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":384378,"user_name":"cfanbo","can_delete":false,"product_type":"c1","uid":1043738,"ip_address":"ä¸Šæµ·","ucode":"39D8D71453E575","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ed/1a/269eb3d6.jpg","comment_is_top":false,"comment_ctime":1700738346,"is_pvip":false,"replies":[{"id":140245,"content":"æ˜¯çš„ï¼Œæ‰€ä»¥tokioè¿˜æœ‰spawn_blockingè¿™ä¸ªä¸œè¥¿ï¼Œä¸“é—¨ç”¨äºè¿™ç§é˜»å¡å¼çš„ä»»åŠ¡ã€‚goæ˜¯å› ä¸ºè¦ç»Ÿä¸€ä¸€å¥—æœºåˆ¶ï¼Œæ²¡åŠæ³•ï¼Œåªèƒ½è®¾è®¡æˆæŠ¢å å¼ï¼Œç„¶è€Œå…¶å®ä½ å¯¹ä½ è¦å¤„ç†çš„ä¸šåŠ¡ä¸€èˆ¬æ˜¯è¦é¢„æœŸçš„ï¼Œrustè¿™æ ·æ›´çµæ´»ã€‚å…³äºtokioçš„æŠ¢å å¼è°ƒåº¦ï¼Œä¹Ÿåœ¨æ„æ€ä¸­ï¼šhttps:&#47;&#47;docs.rs&#47;tokio&#47;latest&#47;tokio&#47;task&#47;index.html#unconstrained","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1700793486,"ip_address":"é‡åº†","comment_id":384378,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸€ä¸ª task æ²¡æœ‰é‡åˆ° .await ä¹‹å‰ï¼Œå®ƒæ˜¯ä¸ä¼šä¸»åŠ¨äº¤å‡ºè¿™ä¸ª CPU æ ¸çš„ï¼Œå…¶ä»– task ä¹Ÿä¸èƒ½ä¸»åŠ¨æ¥æŠ¢å è¿™ä¸ª CPU æ ¸ã€‚æ‰€ä»¥ tokio å®ç°çš„è¿™ä¸ªæ¨¡å‹å«åšåˆä½œå¼çš„ã€‚å’Œå®ƒç›¸å¯¹çš„ï¼ŒGo è¯­è¨€è‡ªå¸¦çš„ Runtime å®ç°çš„ Goroutine æ˜¯ä¸€ç§æŠ¢å å¼çš„è½»é‡çº§çº¿ç¨‹ã€‚\n---\nè¿™æ ·å¦‚æœä¸€ä¸ªtaské•¿æœŸè¢«æ‰§è¡Œï¼ŒåŒä¸€ä¸ªcpu ä¸Šçš„å…¶å®ƒ taskå°†é•¿æœŸå¾—ä¸åˆ°æ‰§è¡Œï¼Œæœ‰å¤±å…¬å¹³æ€§çš„å—ï¼Ÿgoçš„æŠ¢å å°è±¡ä¸­å°±æ˜¯è§£å†³è¿™ä¸ªä¸å…¬å¹³çš„é—®é¢˜","like_count":2,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632458,"discussion_content":"æ˜¯çš„ï¼Œæ‰€ä»¥tokioè¿˜æœ‰spawn_blockingè¿™ä¸ªä¸œè¥¿ï¼Œä¸“é—¨ç”¨äºè¿™ç§é˜»å¡å¼çš„ä»»åŠ¡ã€‚goæ˜¯å› ä¸ºè¦ç»Ÿä¸€ä¸€å¥—æœºåˆ¶ï¼Œæ²¡åŠæ³•ï¼Œåªèƒ½è®¾è®¡æˆæŠ¢å å¼ï¼Œç„¶è€Œå…¶å®ä½ å¯¹ä½ è¦å¤„ç†çš„ä¸šåŠ¡ä¸€èˆ¬æ˜¯è¦é¢„æœŸçš„ï¼Œrustè¿™æ ·æ›´çµæ´»ã€‚å…³äºtokioçš„æŠ¢å å¼è°ƒåº¦ï¼Œä¹Ÿåœ¨æ„æ€ä¸­ï¼šhttps://docs.rs/tokio/latest/tokio/task/index.html#unconstrained","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1700793486,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":389488,"user_name":"é’é¸Ÿé£é±¼","can_delete":false,"product_type":"c1","uid":1807943,"ip_address":"å››å·","ucode":"8C64517DA556FE","user_header":"https://static001.geekbang.org/account/avatar/00/1b/96/47/93838ff7.jpg","comment_is_top":false,"comment_ctime":1712728909,"is_pvip":false,"replies":[{"id":141736,"content":"æ­»å¾ªç¯ä¼šå æ‰ä¸€ä¸ªcpu é€»è¾‘coreï¼Œä¹Ÿå°±æ˜¯é‚£ä¸ªcoreä¼šä¸€ç›´100% running","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1713027569,"ip_address":"åŠ æ‹¿å¤§","comment_id":389488,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"å¦‚æœæˆ‘å†™ä¸€ä¸ªæ­»å¾ªç¯ï¼Œä¼šä¸ä¼šæœ‰é—®é¢˜","like_count":1,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":641815,"discussion_content":"æ­»å¾ªç¯ä¼šå æ‰ä¸€ä¸ªcpu é€»è¾‘coreï¼Œä¹Ÿå°±æ˜¯é‚£ä¸ªcoreä¼šä¸€ç›´100% running","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1713027569,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŠ æ‹¿å¤§","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":386497,"user_name":"ä¸‰è¿‡rusté—¨è€Œä¸å…¥","can_delete":false,"product_type":"c1","uid":3537445,"ip_address":"å¹¿ä¸œ","ucode":"88ECCC99AB2672","user_header":"https://static001.geekbang.org/account/avatar/00/35/fa/25/e40eeb9c.jpg","comment_is_top":false,"comment_ctime":1704962839,"is_pvip":false,"replies":[{"id":140901,"content":"æ„Ÿè°¢åé¦ˆï¼ï¼å·²ç»å¼€å§‹å¤„ç†äº†ğŸŒ¹","user_name":"ç¼–è¾‘å›å¤","user_name_real":"ç¼–è¾‘","uid":2843479,"ctime":1705046987,"ip_address":"åŒ—äº¬","comment_id":386497,"utype":2}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"https:&#47;&#47;zhuanlan.zhihu.com&#47;p&#47;667313965#:~:text=Rust%20%E5%88%9D%E6%AD%A5%E4%BA%86%E8%A7%A3Rust%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%201%20async%20rust%20%E4%BB%8E%20Rust%20v1.39,%E5%87%BD%E6%95%B0%E5%89%8D%E5%B0%B1%E5%8F%AF%E4%BB%A5%E5%8A%A0%20async%20%E4%BF%AE%E9%A5%B0%E4%BA%86%E3%80%82%20...%207%20%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B%20...%20%E6%9B%B4%E5%A4%9A%E9%A1%B9%E7%9B%AE\nè¢«è½¬è½½äº†å”è€å¸ˆï¼Œå¾ˆå¤šæ–‡ç« éƒ½è½¬äº†","like_count":1,"discussions":[{"author":{"id":2843479,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/63/57/cba4c68b.jpg","nickname":"å°è™å­ğŸ¯","note":"","ucode":"4C9530B3FB407B","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635688,"discussion_content":"æ„Ÿè°¢åé¦ˆï¼ï¼å·²ç»å¼€å§‹å¤„ç†äº†ğŸŒ¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1705046987,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":8,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":384047,"user_name":"å“„å“„","can_delete":false,"product_type":"c1","uid":3779530,"ip_address":"åŒ—äº¬","ucode":"F75FB23BEDC60A","user_header":"https://static001.geekbang.org/account/avatar/00/39/ab/ca/32d6c05d.jpg","comment_is_top":false,"comment_ctime":1700170861,"is_pvip":false,"replies":[{"id":140112,"content":"å¯¹ï¼Œè¿™å—å„¿æ²¡åšåŒºåˆ†ï¼Œæœ‰æ—¶ä¼šææ··ï¼Œä¸çŸ¥é“ä¸€ä¸ªç¬¦å·æ˜¯structè¿˜æ˜¯traitã€‚è¿™å—å„¿å¯ä»¥åœ¨è‡ªå·±é¡¹ç›®ä¸­çº¦å®šï¼Œæ¯”å¦‚ trait éƒ½ä»¥Trç»“å°¾ã€‚trait çš„scopeæœºåˆ¶å¤§å®¶åœ¨å¼€å§‹æ—¶éƒ½ä¸é€‚åº”ï¼Œåé¢åº”è¯¥ideèƒ½å¸®åŠ©æç¤ºã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1700216021,"ip_address":"é‡åº†","comment_id":384047,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"rustçš„å‘½åå…¶ä»–éƒ½æŒºå¥½ï¼Œå°±æ˜¯æœ‰æ—¶å€™éš¾ä»¥ä¸€çœ¼åˆ†æ¸…å¼•å…¥çš„æ˜¯structè¿˜æ˜¯traitã€‚ä»–ä»¬éƒ½æ˜¯é¦–å­—æ¯å¤§å†™é©¼å³°å‘½åï¼Œè€Œä¸”ï¼Œç¨‹åºç”¨åˆ°ä»€ä¹ˆtraitå°±éœ€è¦å¼•ç”¨ä»€ä¹ˆtraitï¼Œä¸åƒpythoné‡Œå¼•ç”¨ç±»å°±è¡Œäº†ã€‚","like_count":1,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631973,"discussion_content":"å¯¹ï¼Œè¿™å—å„¿æ²¡åšåŒºåˆ†ï¼Œæœ‰æ—¶ä¼šææ··ï¼Œä¸çŸ¥é“ä¸€ä¸ªç¬¦å·æ˜¯structè¿˜æ˜¯traitã€‚è¿™å—å„¿å¯ä»¥åœ¨è‡ªå·±é¡¹ç›®ä¸­çº¦å®šï¼Œæ¯”å¦‚ trait éƒ½ä»¥Trç»“å°¾ã€‚trait çš„scopeæœºåˆ¶å¤§å®¶åœ¨å¼€å§‹æ—¶éƒ½ä¸é€‚åº”ï¼Œåé¢åº”è¯¥ideèƒ½å¸®åŠ©æç¤ºã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1700216021,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2826132,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIyhbzdkFM64Npva5ZKf4IPwhy6rDAX0L77QNESbalnXhnGKibcTbwtSaNC0hO6z0icO8DYI9Nf4xwg/132","nickname":"eriklee","note":"","ucode":"6F755DB7C29DD6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632020,"discussion_content":"ä½ è¿™é—®é¢˜å•¥è¯­è¨€éƒ½æœ‰å§ï¼ŒIDEéƒ½æœ‰å¾ˆå¥½çš„æç¤ºå•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1700318858,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":386559,"user_name":"Geek_3b58b9","can_delete":false,"product_type":"c1","uid":3196265,"ip_address":"æ±Ÿè‹","ucode":"E9DE52FD0B5E29","user_header":"","comment_is_top":false,"comment_ctime":1705072658,"is_pvip":false,"replies":[{"id":140941,"content":"è¿è¡Œæ—¶ä¹Ÿå¯ä»¥è£¸æœºå®ç°ã€‚ æ ‡å‡†çš„æ¡Œé¢å’Œserveréƒ½æ˜¯åŸºäºosçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1705326533,"ip_address":"é‡åº†","comment_id":386559,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"åµŒå…¥å¼ç³»ç»Ÿä¸­å¥½åƒæ˜¯ç”¨Embassyè¿™ä¸ªè¿è¡Œæ—¶çš„ï¼Œæ—¢ç„¶è¿è¡Œæ—¶æ˜¯ä¾èµ–åº•å±‚æ“ä½œç³»ç»Ÿçš„ï¼Œé‚£åµŒå…¥å¼ä¸Šç”¨çš„è¿™ä¸ªè¿è¡Œæ—¶æ˜¯åŸºäºä»€ä¹ˆçš„å•Šï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635882,"discussion_content":"è¿è¡Œæ—¶ä¹Ÿå¯ä»¥è£¸æœºå®ç°ã€‚ æ ‡å‡†çš„æ¡Œé¢å’Œserveréƒ½æ˜¯åŸºäºosçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1705326533,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385613,"user_name":"superggn","can_delete":false,"product_type":"c1","uid":3623568,"ip_address":"åŒ—äº¬","ucode":"831CCD98B393FE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/7Q403U68Oy4lXG5sFBPVKLrfwaRzBqpBZibpEBXcPf9UOO3qrnh7RELoByTLzBZLkN9Nukfsj7DibynbZjKAKgag/132","comment_is_top":false,"comment_ctime":1702974571,"is_pvip":false,"replies":[{"id":140567,"content":"å°±æ˜¯è¿™ä¸ªæ€è·¯ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1703123579,"ip_address":"é‡åº†","comment_id":385613,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"ç¬”è®°ï¼š\n\nasync runtime &#47; å¼‚æ­¥è¿è¡Œæ—¶\n\n- async fn &#47; async block å¿…é¡»ç”¨ await æ‰èƒ½è·‘\n- await å¿…é¡»å†™åœ¨ async block &#47; async fn é‡Œ\n- main ä¸èƒ½æ˜¯ async çš„ =&gt; main é‡Œå¤´ä¸èƒ½æœ‰ await =&gt; é‚£ main é‡Œå†™å•¥æ¥é©±åŠ¨ async fn &#47; async block?\n- è¿™æ—¶å°±éœ€è¦ä¸€ä¸ª async runtime &#47; å¼‚æ­¥è¿è¡Œæ—¶\n- ç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ªå¯ä»¥å†™åœ¨ main é‡Œçš„ await\n","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634243,"discussion_content":"å°±æ˜¯è¿™ä¸ªæ€è·¯ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1703123579,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":384785,"user_name":"å“„å“„","can_delete":false,"product_type":"c1","uid":3779530,"ip_address":"åŒ—äº¬","ucode":"F75FB23BEDC60A","user_header":"https://static001.geekbang.org/account/avatar/00/39/ab/ca/32d6c05d.jpg","comment_is_top":false,"comment_ctime":1701517099,"is_pvip":false,"replies":[{"id":140318,"content":"ä¸€æ ·çš„ï¼Œpub useè€Œå·²","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1701740510,"ip_address":"é‡åº†","comment_id":384785,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"è¯·é—®ï¼Œtokio::task::spawnå’Œtokio::spawnçš„åŒºåˆ«","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632988,"discussion_content":"ä¸€æ ·çš„ï¼Œpub useè€Œå·²","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1701740510,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":384076,"user_name":"Geek_72807e","can_delete":false,"product_type":"c1","uid":3570665,"ip_address":"å±±è¥¿","ucode":"9E9A6277605048","user_header":"","comment_is_top":false,"comment_ctime":1700227915,"is_pvip":false,"replies":[{"id":140163,"content":"å…ˆå›ç­”ç¬¬äºŒä¸ªé—®é¢˜ï¼Œå¾—éƒ½use åˆ°å½“å‰ crateä¸­æ¥ã€‚\n\nç¬¬ä¸€ä¸ªé—®é¢˜æ²¡æ‡‚ä»€ä¹ˆæ„æ€å“ˆã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1700540978,"ip_address":"é‡åº†","comment_id":384076,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"è¯·é—®è€å¸ˆï¼Œå¦‚æœcrateAä¸ºcrateB1.1ç‰ˆæœ¬å®ç°äº†ä¸€ä¸ªtraitï¼Œè€Œæˆ‘çš„é¡¹ç›®ä¸­ä¾èµ–äº†crateB1.0ç‰ˆæœ¬ï¼Œé‚£ä¹ˆè¿™ä¸ªtraitä¼šå¤±æ•ˆå—ï¼Ÿè¿˜æœ‰ï¼Œæˆ‘å¥‡æ€ªçš„æ˜¯å¦‚æœä¸€ä¸ªstructçš„traitåˆ†æ•£åœ¨å„ä¸ªcrateä¸­ï¼Œæ€ä¹ˆèƒ½è®©è¿™äº›traitéƒ½ç”Ÿæ•ˆå‘¢â€¦â€¦","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632178,"discussion_content":"å…ˆå›ç­”ç¬¬äºŒä¸ªé—®é¢˜ï¼Œå¾—éƒ½use åˆ°å½“å‰ crateä¸­æ¥ã€‚\n\nç¬¬ä¸€ä¸ªé—®é¢˜æ²¡æ‡‚ä»€ä¹ˆæ„æ€å“ˆã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1700540978,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":3570665,"avatar":"","nickname":"Geek_72807e","note":"","ucode":"9E9A6277605048","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":632258,"discussion_content":"å¥½çš„ï¼Œè€å¸ˆï¼Œé‚£ç¬¬ä¸€ä¸ªå…ˆå¿½ç•¥äº†ï¼Œæˆ‘å†è¯•è¯•ã€‚ä»Šå¤©åå¤è°ƒè¯•ï¼Œä¼¼ä¹æ˜¯å’Œç‰ˆæœ¬æœ‰å…³ç³»ï¼Œç‰ˆæœ¬ä¸å¯¹ç¼–è¯‘ä¸é€šè¿‡ã€‚\n\nç¬¬äºŒä¸ªé—®é¢˜è¿˜æœ‰ä¸€ç‚¹ç–‘é—®ï¼Œå¦‚æœæ˜¯åœ¨ä¸€ä¸ªcrateä¸­ä¸ºå¦ä¸€ä¸ªcrateä¸­çš„è‡ªå®šä¹‰Errorå®ç°äº†ä¸€ä¸ªFrom&lt;T=sth&gt;çš„æ³›å‹traitã€‚è¿™ä¸ªæƒ…å†µæƒ³åœ¨ç¬¬ä¸‰ä¸ªcrateä¸­ä½¿ç”¨è¯¥Errorï¼Œæ€ä¹ˆä¿è¯è¿™ä¸ªFromä¸€å®šç”Ÿæ•ˆå‘¢â€¦â€¦ï¼Œå› ä¸ºFromä¸éœ€è¦å¼•å…¥ï¼Œæˆ‘ç¼–è¯‘å¤±è´¥äº†ï¼Œä¸å¾—ä¸æ”¹åº“æºç â€¦â€¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1700584611,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":632178,"ip_address":"å±±è¥¿","group_id":0},"score":632258,"extra":""}]}]},{"had_liked":false,"id":384060,"user_name":"Apaç¦","can_delete":false,"product_type":"c1","uid":3710982,"ip_address":"ä¸Šæµ·","ucode":"A4A76A4D7364EA","user_header":"https://static001.geekbang.org/account/avatar/00/38/a0/06/f0ca94ca.jpg","comment_is_top":false,"comment_ctime":1700199160,"is_pvip":false,"replies":[{"id":140110,"content":"å¯¹çš„ï¼Œrustæ²¡æœ‰å†…ç½®async runtime","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1700215852,"ip_address":"é‡åº†","comment_id":384060,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100626901,"comment_content":"tokioæ˜¯å®Œå…¨ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„apiå®ç°çš„å¼‚æ­¥ï¼Œé‚£ruståº•å±‚å°±æ²¡æœ‰æä¾›å¼‚æ­¥çš„æ–¹æ³•ä¹ˆã€‚","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631971,"discussion_content":"å¯¹çš„ï¼Œrustæ²¡æœ‰å†…ç½®async runtime","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1700215852,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":384052,"user_name":"åˆ˜ä¸¹","can_delete":false,"product_type":"c1","uid":1081922,"ip_address":"å¹¿ä¸œ","ucode":"66594D1C957E15","user_header":"https://static001.geekbang.org/account/avatar/00/10/82/42/8b04d489.jpg","comment_is_top":false,"comment_ctime":1700181594,"is_pvip":false,"replies":[{"id":140109,"content":"08é‡Œé¢æœ‰è®²ï¼Œ18é‡Œé¢ä¹Ÿè¦è®²å…³äºè¿™ä¸ªçš„å¤„ç†æ–¹æ³•ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1700215833,"ip_address":"é‡åº†","comment_id":384052,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100626901,"comment_content":"è¯·é—®è€å¸ˆï¼Œå¦‚æœå¼‚æ­¥å‡½æ•°è¿”å›çš„æ˜¯ Resultï¼Œé‚£ä¹ˆå°±å¿…é¡»åœ¨ .await åé¢ç»§ç»­è°ƒç”¨ .unwrap() ï¼Ÿåœ¨å®é™…é¡¹ç›®é‡Œï¼Œæœ‰æ²¡æœ‰ä¸ä½¿ç”¨ unwrap() çš„å†™æ³•å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631970,"discussion_content":"08é‡Œé¢æœ‰è®²ï¼Œ18é‡Œé¢ä¹Ÿè¦è®²å…³äºè¿™ä¸ªçš„å¤„ç†æ–¹æ³•ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1700215833,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":389583,"user_name":"Calvin","can_delete":false,"product_type":"c1","uid":1603004,"ip_address":"å¹¿ä¸œ","ucode":"0EEF5B207623B5","user_header":"https://static001.geekbang.org/account/avatar/00/18/75/bc/89d88775.jpg","comment_is_top":false,"comment_ctime":1712925595,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100626901,"comment_content":"è€å¸ˆï¼Œæ˜¯ JoinHandle è€Œä¸æ˜¯ JoinHandler!","like_count":1},{"had_liked":false,"id":396116,"user_name":"chai","can_delete":false,"product_type":"c1","uid":1202222,"ip_address":"å¤©æ´¥","ucode":"C686EB1B1EBAB6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep66fdwo3ebSicKjf0iacAx4C2tZOthDDD4bSJqib1iauFBK6EoMSWUBp4UbbN2BQlib7mFR3hQD6MUwew/132","comment_is_top":false,"comment_ctime":1733154898,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100626901,"comment_content":"&quot;ç‹¬ç«‹ç‹å›½â€œæ˜¯ç›¸å¯¹äºruståŒæ­¥æœºåˆ¶æ¥è¯´çš„ï¼Œåœ¨å¼‚æ­¥æœºåˆ¶ä¸­ï¼Œå¯¹å…¶å¯¹åº”çš„åŒæ­¥æœºåˆ¶ï¼Œéƒ½é‡æ–°å®ç°äº†ä¸€éï¼Œä¾‹å¦‚æ–‡ä»¶ioã€ç½‘ç»œioç­‰","like_count":0},{"had_liked":false,"id":391763,"user_name":"ç‹¬é’“å¯’æ±Ÿ","can_delete":false,"product_type":"c1","uid":1203049,"ip_address":"ä¸­å›½é¦™æ¸¯","ucode":"2C81906FD88C8C","user_header":"https://static001.geekbang.org/account/avatar/00/12/5b/69/7ace1ddb.jpg","comment_is_top":false,"comment_ctime":1719046266,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100626901,"comment_content":"æ¯”å¦‚ç¤ºä¾‹é‡Œï¼Œæˆ‘ä»¬å°±æŠŠè¿™ä¸ªæ–°çš„ä»»åŠ¡å‘½åä¸º task_aï¼Œå®ƒçš„ç±»å‹æ˜¯ JoinHandlerã€‚åœ¨ç”¨ spawn() åˆ›å»º task_a åï¼Œè¿™ä¸ªæ–°ä»»åŠ¡å°±ç«‹å³æ‰§è¡Œã€‚--&gt; ä¸æ˜¯åº”è¯¥ç¢°åˆ°awaitæ‰æ‰§è¡Œå—ï¼Ÿ","like_count":0},{"had_liked":false,"id":390433,"user_name":"Aioria","can_delete":false,"product_type":"c1","uid":1161407,"ip_address":"å¹¿ä¸œ","ucode":"E7158D2E1C1B72","user_header":"https://static001.geekbang.org/account/avatar/00/11/b8/bf/3a6e8773.jpg","comment_is_top":false,"comment_ctime":1715327653,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100626901,"comment_content":"è€å¸ˆï¼Œè¿™é—¨è¯¾ç¨‹ä¸­æ²¡æœ‰ä»‹ç»çº¿ç¨‹æ–¹é¢çš„å†…å®¹ï¼Œæ˜¯ä¸æ˜¯åœ¨å®é™…å¼€å‘ä¸­ç”¨å¼‚æ­¥ç¼–ç¨‹å°±è¡Œäº†ï¼Œé™¤éç‰¹æ®Šåœºæ™¯å¦åˆ™æ ¹æœ¬ä¸éœ€è¦ç”¨åˆ°çº¿ç¨‹ç›¸å…³æ“ä½œå‘¢ï¼Ÿç±»ä¼¼goè¯­è¨€ä¸­ï¼Œåªè¦ä½¿ç”¨åç¨‹å°±å¯ä»¥äº†ã€‚","like_count":0}]}