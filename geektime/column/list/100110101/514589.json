{"id":514589,"title":"15ï½œGestureï¼ˆä¸Šï¼‰ï¼šå¦‚ä½•å®ç°ä¸€ä¸ªæ‹–æ‹½åŠ¨æ•ˆï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯è’‹å®ä¼Ÿã€‚</p><p>æˆ‘åˆšå¼€å§‹åš React Native å¼€å‘çš„æ—¶å€™ï¼Œæ›¾ç»è¢«æ‰‹åŠ¿é—®é¢˜å›°æ‰°è¿‡å¥½å‡ æ¬¡ã€‚</p><p>ç¬¬ä¸€æ¬¡ï¼Œæˆ‘æƒ³åœ¨ Android ä¸Šå®ç°ç±»ä¼¼ iOS çš„ä¸‹æ‹‰åˆ·æ–°æ•ˆæœã€‚ä½ å¯èƒ½çŸ¥é“ï¼ŒiOS çš„ ScrollView ç»„ä»¶æ˜¯æœ‰å›å¼¹å±æ€§ <a href=\"https://reactnative.cn/docs/scrollview\">bounces</a> çš„ã€‚å½“å¼€å¯å›å¼¹æ•ˆæœæ—¶ï¼ŒScrollView çš„å†…å®¹åŒºé¡¶åˆ°å¤´è¿˜å¯ä»¥ç»§ç»­å¾€ä¸‹æ‹‰ï¼Œä½† Android çš„ ScrollView ç»„ä»¶å°±æ²¡æœ‰ bounces å±æ€§ï¼Œå®ç°ä¸äº†è¿™ç§å¸¦å›å¼¹çš„ä¸‹æ‹‰åˆ·æ–°æ•ˆæœã€‚</p><p>ç¬¬äºŒæ¬¡ï¼Œæˆ‘æ˜¯æƒ³å®ç°ç±»ä¼¼æŠ–éŸ³è¯„è®ºåŒºçš„æ‰‹åŠ¿åŠ¨æ•ˆã€‚è¿™ä¸ªæ‰‹åŠ¿åŠ¨æ•ˆåœ¨ä¸Šä¸‹æ–¹å‘å­˜åœ¨ä¸‰ä¸ªæ‰‹åŠ¿ï¼Œåˆ†åˆ«æ˜¯æœ€å¤–å±‚è§†é¢‘åŒºåŸŸçš„ä¸Šä¸‹åˆ‡æ¢åŠ¨ç”»ã€è¯„è®ºæ¡†çš„ä¸Šä¸‹æ‹–æ‹½åŠ¨ç”»å’Œè¯„è®ºå†…å®¹çš„ä¸Šä¸‹æ»šåŠ¨åŠ¨ç”»ã€‚è¿™ç§å¤šè§†å›¾ã€å¤šæ‰‹åŠ¿çš„åŠ¨æ•ˆï¼Œæœ¬èº«å°±éå¸¸å¤æ‚ï¼Œè€Œä¸”å½“æ—¶ React Native æ¡†æ¶è‡ªå¸¦çš„æ‰‹åŠ¿åŠ¨ç”»æ¨¡å—çš„èƒ½åŠ›å¤ªå¼±ï¼Œä¹Ÿå®ç°ä¸äº†ã€‚</p><p>ç¬¬ä¸‰æ¬¡ï¼Œæˆ‘æƒ³å®ç°ç±»ä¼¼æ·˜å®é¦–é¡µçš„æ‰‹åŠ¿åŠ¨æ•ˆã€‚æ·˜å®é¦–é¡µå¤´éƒ¨åŒºåŸŸæ˜¯ç”±è½®æ’­å›¾ã€é‡‘åˆšåŒºç­‰ç»„æˆçš„å›ºå®šå†…å®¹åŒºåŸŸï¼Œåº•éƒ¨åŒºåŸŸæ˜¯ç”±å¤š Tab ã€å¤šé•¿åˆ—è¡¨ç»„æˆçš„å¯å·¦å³åˆ‡æ¢ã€å¯ä¸Šä¸‹æ»šåŠ¨çš„åŒºåŸŸï¼Œå®ç°éš¾åº¦éå¸¸é«˜ã€‚</p><p>æˆ‘æåˆ°çš„è¿™ä¸‰ä¸ªæ‰‹åŠ¿åŠ¨æ•ˆçš„éœ€æ±‚ï¼Œéƒ½éœ€è¦æ‰‹åŠ¿å’ŒåŠ¨ç”»æ­é…åœ¨ä¸€èµ·æ‰èƒ½å®ç°ã€‚</p><p>ä½†å½“åˆæˆ‘ç”¨çš„æ˜¯ React Native çš„ 0.44 ç‰ˆæœ¬ï¼Œå› ä¸ºç¤¾åŒºçš„Gesture æ‰‹åŠ¿åº“ <a href=\"https://docs.swmansion.com/react-native-gesture-handler/\">react-native-gesture-handler</a> å’ŒReanimated åŠ¨ç”»åº“ <a href=\"https://docs.swmansion.com/\">react-native-reanimated</a> éƒ½è¿˜ä¸å¤ªæˆç†Ÿï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©äº† React  Native æ¡†æ¶è‡ªå¸¦çš„æ‰‹åŠ¿æ¨¡å— <a href=\"https://reactnative.cn/docs/panresponder\">PanResponder</a> å’ŒåŠ¨ç”»æ¨¡å— <a href=\"https://reactnative.cn/docs/animated\">Animated</a> è¿›è¡Œå¼€å‘ã€‚ä½†æ˜¯ä»…ä»…åªæ˜¯å¦‚ä½•è§£å†³æ‰‹åŠ¿å†²çªè¿™ä¸ªé—®é¢˜ï¼Œå°±æŠŠæˆ‘æ‹¦ä½äº†ï¼Œåªèƒ½é™çº§å¤„ç†ã€‚</p><!-- [[[read_end]]] --><p>ä½†ä»Šæ—¶ä¸å¦‚å¾€æ—¥ï¼Œåœ¨ç°åœ¨çš„React Native çš„ 0.68 ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯æ–°æ¶æ„é¢„è§ˆç‰ˆä¸­ï¼Œç¤¾åŒºçš„ Gesture v2 æ‰‹åŠ¿åº“å’Œ Reanimated v2 åŠ¨ç”»åº“éƒ½å·²æå‰é€‚é…ï¼Œè¿™å‡ ä¸ªæ›¾ç»å›°æ‰°æˆ‘çš„éš¾é¢˜éƒ½å¯ä»¥å®ç°å‡ºæ¥äº†ã€‚</p><p>è¦è§£å†³è¿™ä¸‰ä¸ªé—®é¢˜ï¼Œæœ€é‡è¦çš„å°±æ˜¯è¦<strong>è§£å†³æ‰‹åŠ¿å†²çªçš„é—®é¢˜</strong>ã€‚è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬å°±å›´ç»•ç€è¿™ä¸ªæ ¸å¿ƒï¼Œå¸¦ä½ ç”±æµ…åˆ°æ·±ï¼Œåƒé€æ‰‹åŠ¿çš„ä½¿ç”¨åŠå…¶åŸç†ï¼Œæ—¥åä½ å†é‡åˆ°è¿™äº›å¤æ‚çš„éœ€æ±‚å°±éƒ½èƒ½è¿åˆƒè€Œè§£äº†ã€‚</p><p>ä¸è¿‡ï¼Œç”±äºè¦è®²çš„å†…å®¹æ¯”è¾ƒå¤šï¼Œæˆ‘ä¼šåˆ†æˆä¸‰è®²ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ä¸‰ä¸ªå…³å¡å¸¦ä½ é€çº§çªç ´æ‰‹åŠ¿éš¾é¢˜ã€‚ä»Šå¤©çš„ç¬¬ä¸€å…³å°±æ˜¯ï¼šæ‰‹åŠ¿çš„åŸºç¡€åŸç†ä»¥åŠå¦‚ä½•è¿›è¡ŒåŸºæœ¬æ‰‹åŠ¿ï¼Œæ¯”å¦‚æ‹–æ‹½åŠ¨æ•ˆçš„å¼€å‘ã€‚</p><h2>æ‰‹åŠ¿åŸºç¡€</h2><p>å­¦ä¹ æ‰‹åŠ¿ï¼Œæˆ‘ä»¬å½“ç„¶è¦å…ˆäº†è§£æ‰‹åŠ¿çš„åŸºæœ¬åŸç†ã€‚</p><p>Pressable ç‚¹æŒ‰æ‰‹åŠ¿å°±æ˜¯æœ€åŸºç¡€çš„æ‰‹åŠ¿ã€‚è¿˜è®°å¾—æˆ‘åœ¨ Pressable ä¸€è®²ä¸­ï¼Œå’Œä½ æåˆ°çš„ç‚¹æŒ‰æ‰‹åŠ¿çš„åŸºæœ¬åŸç†å—ï¼Ÿå“åº” Pressable æ‰‹åŠ¿è¦ç»è¿‡å¦‚ä¸‹è¿‡ç¨‹ï¼š</p><blockquote>\n<p>æ•´ä¸ªç‚¹æŒ‰äº‹ä»¶çš„å“åº”è¿‡ç¨‹æ˜¯ç¡¬ä»¶å’Œè½¯ä»¶ç›¸äº’é…åˆçš„è¿‡ç¨‹ã€‚ Pressable ç»„ä»¶å“åº”çš„æ•´ä½“æµç¨‹ï¼Œæ˜¯ä»è§¦æ‘¸å±è¯†åˆ«ç‰©ç†æ‰‹åŠ¿å¼€å§‹ï¼Œåˆ°ç³»ç»Ÿå’Œæ¡†æ¶ Native éƒ¨åˆ†æŠŠç‰©ç†æ‰‹åŠ¿è½¬æ¢ä¸º JavaScript æ‰‹åŠ¿äº‹ä»¶ï¼Œå†åˆ°æ¡†æ¶ JavaScript éƒ¨åˆ†ç¡®å®šå“åº”æ‰‹åŠ¿çš„ç»„ä»¶ï¼Œæœ€ååˆ° Pressable ç»„ä»¶ç¡®å®šæ˜¯ç‚¹å‡»è¿˜æ˜¯é•¿æŒ‰ã€‚</p>\n</blockquote><p>è¿™é‡Œï¼Œæ¡†æ¶çš„ JavaScript éƒ¨åˆ†æŒ‡çš„å°±æ˜¯ React Native è‡ªå¸¦çš„ PanResponder æ‰‹åŠ¿ç³»ç»Ÿï¼Œå®ƒæ˜¯è¿è¡Œåœ¨ JavaScript çº¿ç¨‹çš„ã€‚</p><p>è€Œä»Šå¤©æˆ‘è¦å’Œä½ ä»‹ç»çš„æ‰‹åŠ¿åº“ Gestureï¼Œè™½ç„¶åœ¨å£°æ˜çš„åˆå§‹åŒ–è¿‡ç¨‹æ˜¯è¿è¡Œåœ¨ JavaScript çº¿ç¨‹ä¸­çš„ï¼Œä½†å£°æ˜ä¹‹åçš„æ‰‹åŠ¿å›è°ƒå‡½æ•°çš„æ‰§è¡Œéƒ½æ˜¯é»˜è®¤è¿è¡Œåœ¨ UI çº¿ç¨‹çš„ï¼Œå¹¶ä¸”å®ƒå’Œ Reanimated å¯ä»¥å¾ˆå¥½åœ°ç»“åˆèµ·æ¥ï¼Œä¸€èµ·ä½¿ç”¨ã€‚å› æ­¤æ‰‹åŠ¿åŠ¨æ•ˆçš„å…¨è¿‡ç¨‹éƒ½æ˜¯å¯ä»¥è¿è¡Œåœ¨ UI çº¿ç¨‹çš„ï¼Œä¸å— JavaScript çº¿ç¨‹æ€§èƒ½ç“¶é¢ˆçš„çº¦æŸã€‚</p><p>Gesture æ‰‹åŠ¿åº“å®ç°äººæœºäº¤äº’çš„åŸç†å›¾å¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/5a/3a/5a3187dea427914627cac18b10880b3a.png?wh=1920x1270\" alt=\"å›¾ç‰‡\" title=\"å›¾æ ‡æ¥æºäº www.flaticon.com\"></p><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨ <strong>Gesture æ‰‹åŠ¿åº“è¿›è¡Œäººæœºäº¤äº’çš„åŸºç¡€æµç¨‹</strong>ä¸€å…±åˆ†ä¸º 4 æ­¥ï¼š</p><ol>\n<li>Gesture æ‰‹åŠ¿åº“æ”¶åˆ°ç³»ç»Ÿæ‰‹åŠ¿äº‹ä»¶ï¼›</li>\n<li>Gesture æ‰‹åŠ¿åº“ç¡®å®šéœ€è¦å“åº”å“ªäº›ç»„ä»¶ï¼›</li>\n<li>Gesture æ‰‹åŠ¿åº“è§¦å‘ç›¸å…³æ‰‹åŠ¿å›è°ƒå‡½æ•°ï¼›</li>\n<li>é€šè¿‡ Gesture å›è°ƒå‡½æ•°è¿”å› event å‚æ•°ï¼Œä½¿ç”¨å›è°ƒè¿”å›å€¼ event å¯ä»¥æ›´æ–°å…±äº«å€¼æˆ–çŠ¶æ€ï¼Œæ‰§è¡ŒåŠ¨ç”»æˆ–æ¸²æŸ“ã€‚</li>\n</ol><p>åŸç†è®²èµ·æ¥å¯èƒ½ä¼šæ¯”è¾ƒæŠ½è±¡ï¼Œä¸‹é¢æˆ‘æŠŠåŸç†å’Œæœ€åŸºç¡€çš„è½»æŒ‰æ‰‹åŠ¿ç»“åˆèµ·æ¥ï¼Œç”¨å®é™…æ¡ˆä¾‹å¸®ä½ å¼„æ˜ç™½å®ƒçš„åŸç†ã€‚</p><h2>è½»æŒ‰æ‰‹åŠ¿</h2><p>åœ¨ Gesture æ‰‹åŠ¿åº“æ¥æ”¶åˆ°ç³»ç»Ÿçš„æ‰‹åŠ¿åï¼Œå®ƒéœ€è¦åˆ¤æ–­é¡µé¢ä¸­æœ‰æ²¡æœ‰å“ªä¸ªè§†å›¾éœ€è¦å“åº”è¯¥æ‰‹åŠ¿ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•ç»„è§†å›¾éœ€è¦å“åº”è¯¥æ‰‹åŠ¿ï¼Œé‚£ä¹ˆä»€ä¹ˆéƒ½ä¸ä¼šå‘ç”Ÿã€‚</p><p>å› æ­¤ï¼Œä½ éœ€è¦å…ˆå‘Šè¯‰ Gesture æ‰‹åŠ¿åº“ï¼Œä½ æœ‰ä¸ªè§†å›¾éœ€è¦å“åº”æ‰‹åŠ¿ã€‚è¿™ä¸€æ­¥æ˜¯é€šè¿‡ GestureDetector ç»„ä»¶æ¥å®ç°çš„ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">import { GestureDetector } from 'react-native-gesture-handler';\n\n&lt;GestureDetector gesture={singleTap}&gt;\n  &lt;View /&gt;\n&lt;/GestureDetector&gt;\n</code></pre><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼ŒGestureDetector ç»„ä»¶çš„ä½œç”¨æ˜¯å°†å•å‡»æ‰‹åŠ¿ singleTap ç»‘å®šåˆ° View è§†å›¾ä¸Šã€‚</p><p>GestureDetector ç»„ä»¶æ˜¯ä» react-native-gesture-handler åº“ä¸­å¯¼å‡ºçš„å¤åˆç»„ä»¶ã€‚<strong>GestureDetector å¤åˆç»„ä»¶å¹¶ä¸ä¼šçœŸæ­£æ¸²æŸ“åˆ°å±å¹•ä¸Šï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†é…ç½®å¥½çš„æ‰‹åŠ¿ç»‘å®šå®¿ä¸»ç»„ä»¶è§†å›¾ä¸Š</strong>ï¼Œè¿™ä¸ªå®¿ä¸»ç»„ä»¶æ˜¯ GestureDetector ç»„ä»¶å†…éƒ¨ç¬¬ä¸€ä¸ªä¼šçœŸæ­£æ¸²æŸ“åˆ°å±å¹•ä¸Šçš„è§†å›¾ã€‚</p><p>é‚£ç¤ºä¾‹ä¸­çš„ singleTap æ‰‹åŠ¿æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿåˆ›å»º singleTap æ‰‹åŠ¿çš„ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">import { Gesture } from 'react-native-gesture-handler';\n\nconst singleTap = Gesture.Tap()\n  .onStart(() =&gt; console.log('å¼€å§‹è§¦å‘è½»æŒ‰äº‹ä»¶'))\n</code></pre><p>å¦‚ä»£ç æ‰€ç¤ºï¼Œ<strong>Gesture å¯¹è±¡æ˜¯ react-native-gesture-handler æ‰‹åŠ¿åº“æä¾›çš„æ‰‹åŠ¿å¯¹è±¡</strong>ï¼Œåœ¨ Gesture å¯¹è±¡ä¸‹ï¼Œæœ‰ä¸€ä¸ª Tap æ–¹æ³•ï¼Œè°ƒç”¨è¯¥æ–¹æ³•å°±å¯ä»¥ç”Ÿæˆä¸€ä¸ªè½»æŒ‰æ‰‹åŠ¿ singleTapã€‚</p><p>å¹¶ä¸”å®ƒè¿˜æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œä½ å¯ä»¥ç”¨ .onStart  æŠŠè§¦å‘è½»æŒ‰å›è°ƒå‡½æ•°ç»‘å®šä¸Šå»ï¼Œå¹¶åœ¨è¯¥å›è°ƒä¸­æ‰“å°ç›¸å…³æ—¥å¿—ã€‚ä½ å¯¹å±å¹•ä¸­ View è§†å›¾ç‚¹å‡»ä¸€æ¬¡ï¼Œå°±ä¼šè§¦å‘ onStart çš„å›è°ƒå‡½æ•°ï¼Œå¹¶æ‰“å°â€œå¼€å§‹è§¦å‘è½»æŒ‰äº‹ä»¶â€çš„æ—¥å¿—ã€‚</p><p>ä½†æ˜¯ï¼Œå‰é¢æˆ‘ä»¬è¯´è¿‡ï¼ŒGesture æ‰‹åŠ¿åº“æ˜¯è·‘åœ¨ UI çº¿ç¨‹ä¸­çš„ï¼Œå› æ­¤ console.log å®é™…ä¸Šæ˜¯åœ¨ Reanimated åˆ›å»ºçš„ JavaScript è™šæ‹Ÿæœºä¸­æ‰§è¡Œçš„ï¼Œæ—¥å¿—æ˜¯ä» UI çº¿ç¨‹ä¸­æ‰“å°å‡ºæ¥çš„ã€‚</p><p>è™½ç„¶æˆ‘ä»¬å¯ä»¥åœ¨ UI çº¿ç¨‹ä¸­æ‰“å° console æ—¥å¿—ï¼Œä½†æ˜¯å¹¶ä¸èƒ½åœ¨ UI çº¿ç¨‹è°ƒç”¨ setState çš„æ¸²æŸ“æ–¹æ³•ï¼Œå¦‚æœè°ƒç”¨å°±ä¼šæŠ¥é”™ã€‚è§¦å‘æŠ¥é”™çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">const [logs, setLogs] = useState&lt;string[]&gt;([]);\n\nconst singleTap = Gesture.Tap()\n  .onStart(() =&gt; setLogs(logs.concat('å¼€å§‹è§¦å‘è½»æŒ‰äº‹ä»¶')))\n\n// æŠ¥é”™\nTried to synchronously call function {setLogs} from a different thread.\n</code></pre><p>è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰äº†æ—¥å¿—çŠ¶æ€ logs åŠå…¶æ›´æ–°å‡½æ•° setLogsï¼Œç„¶ååœ¨ onStart çš„å›è°ƒå‡½æ•°ä¸­è°ƒç”¨äº† setLogs æ›´æ–°æ—¥å¿—çŠ¶æ€ã€‚å½“ä½ ç‚¹å‡»è§¦å‘ onStart çš„å›è°ƒå‡½æ•°åï¼Œå°±ä¼šå‡ºç°ä¸€ä¸ªæŠ¥é”™ï¼ŒæŠ¥é”™çš„å†…å®¹æ˜¯ä½ å°è¯•åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯ UI çº¿ç¨‹ï¼ŒåŒæ­¥è°ƒç”¨ setLogs æ›´æ–°å‡½æ•°ã€‚</p><p>è¿™æ˜¯å› ä¸ºï¼Œæ¸²æŸ“è¿‡ç¨‹æ˜¯è·‘åœ¨ JavaScript çº¿ç¨‹ä¸­çš„ï¼Œè€Œ UI çº¿ç¨‹çš„ JavaScript è™šæ‹Ÿæœºå’Œ JavaScript çº¿ç¨‹çš„ JavaScript è™šæ‹Ÿæœºçš„ä¸Šä¸‹æ–‡æ˜¯éš”ç¦»çš„ï¼ŒUI çº¿ç¨‹æ‹¿ä¸åˆ°æ¸²æŸ“ç›¸å…³çš„ä¸Šä¸‹æ–‡ã€‚å› æ­¤ï¼Œå¦‚æœä½ åœ¨ onStart çš„å›è°ƒå‡½æ•°ä¸­è°ƒç”¨ setState ï¼Œå°±ä¼šæŠ¥é”™ã€‚</p><p>æ—¢ç„¶ setState ç›¸å…³å‡½æ•°æ”¾åˆ° UI çº¿ç¨‹æ‰§è¡Œä¼šæŠ¥é”™ï¼Œé‚£æˆ‘ä»¬å°±æ”¾å› JavaScript çº¿ç¨‹æ‰§è¡Œå‘—ï¼Ÿ</p><p>ç¡®å®å¯ä»¥ã€‚ä¿®æ”¹åçš„æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><pre><code class=\"language-javascript\">import {runOnJS} from 'react-native-reanimated';\n\nconst [logs, setLogs] = useState&lt;string[]&gt;([]);\nconst singleTap = Gesture.Tap()\n  .onStart(() =&gt; runOnJS(setLogs)(logs.concat('å¼€å§‹è§¦å‘è½»æŒ‰äº‹ä»¶')))\n</code></pre><p>åœ¨è¯¥æ–¹æ¡ˆä¸­ï¼ŒonStart çš„å›è°ƒå‡½æ•°ä¾æ—§æ˜¯åœ¨ UI çº¿ç¨‹æ‰§è¡Œçš„ï¼Œä½†æ˜¯ä» react-native-reanimated åŠ¨ç”»åº“ä¸­å¼•å…¥çš„ runOnJS æ–¹æ³•ï¼Œå¯ä»¥æŠŠ setLogs æ–¹æ³•æ”¾å› JavaScript çº¿ç¨‹æ‰§è¡Œã€‚</p><p>å…·ä½“æ–¹æ³•æ˜¯è¿™æ ·çš„ï¼šrunOnJS æ˜¯ä¸€ä¸ª<a href=\"https://zh.wikipedia.org/wiki/%E6%9F%AF%E9%87%8C%E5%8C%96\">æŸ¯é‡ŒåŒ–çš„</a>å‡½æ•°ï¼Œå®ƒæ¥æ”¶çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦æ”¾å› JavaScript çº¿ç¨‹è°ƒç”¨çš„å‡½æ•°ï¼Œè¿™é‡Œæ˜¯ setLogs å‡½æ•°ï¼›å®ƒæ¥æ”¶åˆ°çš„ç¬¬äºŒä¸ªå…¥å‚æ˜¯ <code>logs.concat('å¼€å§‹è§¦å‘è½»æŒ‰äº‹ä»¶')</code> æ‰§è¡Œåçš„è¿”å›å€¼ï¼Œè¿™ä¸ªè¿”å›å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒæŠŠç›¸å…³å‡½æ•°åŠå…¶å…¥å‚æ”¾å› JavaScript çº¿ç¨‹åï¼Œæ¥ç€å°±ä¼šåœ¨ JavaScript çº¿ç¨‹æ‰§è¡Œè°ƒç”¨ã€‚</p><p>å› æ­¤ï¼Œ<strong>åœ¨å­¦ä¹  Gesture æ‰‹åŠ¿åº“çš„æ—¶å€™ï¼Œä½ éœ€è¦æ³¨æ„åŒºåˆ† UI çº¿ç¨‹å’Œ JavaScript çº¿ç¨‹ã€‚</strong>Gesture æ‰‹åŠ¿åº“å’Œ Reanimated åŠ¨ç”»åº“æ­é…ä½¿ç”¨æ—¶ï¼ŒGesture çš„æ‰‹åŠ¿å›è°ƒå‡½æ•°æ˜¯åœ¨ Reanimated åŠ¨ç”»åº“åˆ›å»ºçš„ UI çº¿ç¨‹çš„ JavaScript è™šæ‹Ÿæœºä¸­æ‰§è¡Œçš„ã€‚</p><p>ä½† UI çº¿ç¨‹çš„ JavaScript è™šæ‹Ÿæœºå’Œ JavaScript çº¿ç¨‹çš„ JavaScript è™šæ‹Ÿæœºæ˜¯ä¸¤ä¸ªä¸åŒçš„è™šæ‹Ÿæœºã€‚UI çº¿ç¨‹çš„ JavaScript è™šæ‹Ÿæœºåªæœ‰æ‰§è¡Œç›¸å…³åŠ¨ç”»ã€æ‰‹åŠ¿å›è°ƒå‡½æ•°çš„ä¸Šä¸‹æ–‡ï¼Œè€Œ JavaScript çº¿ç¨‹çš„ JavaScript è™šæ‹Ÿæœºæ‹¥æœ‰çš„æ˜¯æ‰§è¡Œé¡µé¢æ¸²æŸ“çš„ä¸Šä¸‹æ–‡ï¼Œå› æ­¤æ‰‹åŠ¿å›è°ƒå‡½æ•°å¿…é¡»è°ƒç”¨  runOnJS å›åˆ° JavaScript çº¿ç¨‹çš„ JavaScript è™šæ‹Ÿæœºä¸­æ‰§è¡Œ setState æ¸²æŸ“é¡µé¢ã€‚</p><p>æˆ‘æŠŠä½¿ç”¨ Gesture æ‰‹åŠ¿åº“å®ç°è½»æŒ‰æ‰‹åŠ¿çš„å®Œæ•´ç¤ºä¾‹ä»£ç æ”¾åœ¨è¿™é‡Œäº†ï¼Œä½ å¯ä»¥ä»”ç»†çœ‹ä¸‹ï¼š</p><pre><code class=\"language-plain\">import React, {useState} from 'react';\nimport { Text, View,  SafeAreaView} from 'react-native';\nimport {runOnJS} from 'react-native-reanimated';\nimport {Gesture, GestureDetector} from 'react-native-gesture-handler';\n\nexport default function App() {\n  const [logs, setLogs] = useState&lt;string[]&gt;([]);\n\n  const singleTap = Gesture.Tap()\n    // æ¸²æŸ“\n    .onStart(() =&gt; runOnJS(setLogs)(logs.concat('å¼€å§‹è§¦å‘è½»æŒ‰äº‹ä»¶')));\n    // åŠ¨ç”»æˆ–æ—¥å¿—\n    // .onStart(() =&gt; console.log('å¼€å§‹è§¦å‘è½»æŒ‰äº‹ä»¶'));\n\n  return (\n    &lt;SafeAreaView&gt;\n      &lt;GestureDetector gesture={singleTap}&gt;\n        &lt;View style={[{width: 100,height: 100,backgroundColor: 'red'}]} /&gt;\n      &lt;/GestureDetector&gt;\n      {logs.map((log, index) =&gt; (\n          &lt;Text key={index}&gt;{log}&lt;/Text&gt;\n        ))}\n    &lt;/SafeAreaView&gt;\n  );\n}\n</code></pre><h2>æ‹–æ‹½åŠ¨æ•ˆ</h2><p>åˆšæ‰çš„è½»æŒ‰æ‰‹åŠ¿åªæ˜¯å°è¯•ç‰›åˆ€ï¼Œå…¶å®è¿™ç§åŸºç¡€çš„è½»æŒ‰æ‰‹åŠ¿ï¼Œæˆ‘ä»¬ä½¿ç”¨ Pressable ç»„ä»¶ä¹Ÿå¯ä»¥å®ç°ã€‚Gesture æ‰‹åŠ¿åº“çœŸæ­£å‰å®³çš„åœ°æ–¹ï¼Œåœ¨äºèƒ½å’Œ Reanimated åŠ¨ç”»åº“é…åˆç€ä¸€èµ·ä½¿ç”¨ï¼Œå®ƒä»¬äºŒè€…ä¸€ç»“åˆï¼Œå°±èƒ½ç©å‡º React Native è€ç‰ˆæœ¬ç©ä¸å‡ºæ¥çš„æ‰‹åŠ¿åŠ¨ç”»æ•ˆæœã€‚</p><p>æ¥ç€ï¼Œæˆ‘ä»¬å†æ¥çœ‹ç¬¬äºŒä¸ªæ¡ˆä¾‹ï¼Œæ‹–æ‹½åŠ¨æ•ˆã€‚é€šè¿‡æ‹–æ‹½æ¡ˆä¾‹ï¼Œä½ å¯ä»¥å­¦ä¼šå¦‚ä½•å°† Gesture å’Œ Reanimated æ­é…åœ¨ä¸€èµ·ä½¿ç”¨ã€‚</p><p>ç°åœ¨ï¼Œä½ è¦å®ç°çš„æ‹–æ‹½åŠ¨æ•ˆæ˜¯è¿™æ ·çš„ï¼šä½ å¯ä»¥æ‹–åŠ¨å±å¹•ä¸Šçš„ä¸€ä¸ªåœ†å½¢è§†å›¾ï¼Œè®©è·Ÿéšä½ çš„æ‰‹æŒ‡ä¸€èµ·ç§»åŠ¨ã€‚å¹¶ä¸”ï¼Œåœ¨ä½ è§¦ç¢°åˆ°è¯¥åœ†å½¢è§†å›¾æ—¶ï¼Œåœ†å½¢è§†å›¾æ˜¯è“è‰²çš„ï¼Œå½“ä½ æ‰‹æŒ‡ç¦»å¼€è¯¥åœ†å½¢è§†å›¾æ—¶ï¼Œåœ†å½¢è§†å›¾æ˜¯ç°è‰²çš„ã€‚</p><p>æ‹–æ‹½åŠ¨æ•ˆçš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/ef/12/efa8ffd8aefffd4416c4b913873f5d12.png?wh=1920x961\" alt=\"å›¾ç‰‡\" title=\"å›¾æ ‡æ¥æºäº www.flaticon.com\"></p><p><strong>é‚£æˆ‘ä»¬åº”è¯¥å¦‚ä½•å®ç°è¿™æ ·çš„æ‹–æ‹½åŠ¨æ•ˆå‘¢ï¼Ÿ</strong></p><p>é€šè¿‡Gesture æ‰‹åŠ¿åº“è¿›è¡Œäººæœºäº¤äº’ä¸€å…±åˆ†ä¸º 4 æ­¥ï¼Œé™¤äº†ç¬¬ 1 æ­¥åªéœ€ Gesture æ‰‹åŠ¿åº“åº•å±‚å‚ä¸å¤–ï¼Œå…¶ä»– 3 æ­¥éƒ½æ¶‰åŠä»£ç ï¼Œé‚£æˆ‘å°±åˆ† 3 æ­¥æ¥å®ç°æ‹–æ‹½åŠ¨æ•ˆã€‚</p><p><strong>ç¬¬ä¸€æ­¥æ˜¯ï¼Œå°†æ‹–æ‹½æ‰‹åŠ¿ç»‘å®šåˆ°åŠ¨ç”»ç»„ä»¶ä¸Šï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</strong></p><pre><code class=\"language-plain\">import Animated from 'react-native-reanimated';\nimport {Gesture, GestureDetector} from 'react-native-gesture-handler';\n\nconst dragGesture = Gesture.Pan()\n\n&lt;GestureDetector gesture={dragGesture}&gt;\n  &lt;Animated.View style={[{\n    width: 100,\n    height: 100,\n    borderRadius: 100,\n  }, animatedStyles]}/&gt;\n&lt;/GestureDetector&gt;\n</code></pre><p>å› ä¸ºæ¶‰åŠåŠ¨ç”»ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨åŠ¨ç”»è§†å›¾ï¼Œä¹Ÿå°±æ˜¯ Animated.View è§†å›¾ã€‚è¯¥ View è§†å›¾çš„æ ·å¼å±æ€§ï¼ŒåŒ…æ‹¬ä¸€ä¸ªå›ºå®šçš„åœ†å½¢æ ·å¼å’Œä¸€ä¸ªåŠ¨ç”»æ ·å¼ animatedStylesã€‚</p><p>å…¶ä¸­ï¼ŒanimatedStyles çš„å…·ä½“å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">const isPressed = useSharedValue(false);\nconst offset = useSharedValue({ x: 0, y: 0 });\n\nconst animatedStyles = useAnimatedStyle(() =&gt; {\n  return {\n    transform: [\n      { translateX: offset.value.x },\n      { translateY: offset.value.y },\n    ],\n    backgroundColor: isPressed.value ? 'blue' : '#ccc',\n  };\n});\n</code></pre><p>è¿™æ®µä»£ç ä¸­ä¸»è¦ç”¨åˆ°äº†ä¸¤ä¸ªå…±äº«å€¼ï¼šä¸€ä¸ªæ˜¯ isPressedï¼Œå®ƒç”¨æ¥åˆ¤æ–­åœ†å½¢è§†å›¾æ˜¯å¦è¢«ç‚¹å‡»äº†ï¼›å¦ä¸€ä¸ªæ˜¯ offset ï¼Œç”¨æ¥ç¡®å®šåœ†å½¢è§†å›¾çš„ x/y åæ ‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ†å½¢è§†å›¾æœªè¢«ç‚¹å‡»ï¼Œåˆ™ isPressed ä¸º falseï¼Œä¸”åœ¨ x=0 y=0 çš„åæ ‡ç‚¹ä¸Šã€‚</p><p>è€Œå…·ä½“çš„åŠ¨ç”»æ ·å¼ animatedStyles æ˜¯ä½¿ç”¨ isPressed å’Œ offset è¡ç”Ÿå¾—åˆ°çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒçš„ translateX=0 translateY=0ï¼Œä¸” backgroundColor ä¸º #ccc ç°è‰²ã€‚</p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ç¬¬ä¸€æ­¥ï¼Œä¹Ÿå°±æ˜¯å°†æ‹–æ‹½æ‰‹åŠ¿ç»‘å®šåˆ°åŠ¨ç”»ç»„ä»¶ä¸Šã€‚</p><p><strong>æ¥ä¸‹æ¥çš„ç¬¬äºŒæ­¥æ˜¯ï¼Œå®ç°æ‹–æ‹½æ‰‹åŠ¿ dragGesture å’Œå…¶æ‰‹åŠ¿å›è°ƒã€‚</strong></p><p>å‰é¢æˆ‘å’Œä½ ä»‹ç»äº†è½»æŒ‰æ‰‹åŠ¿ Gesture.Tap å’Œç›¸å…³çš„ onStart å›è°ƒã€‚ç°åœ¨ï¼Œæˆ‘è¦ç”¨åˆ°çš„æ˜¯æ‹–æ‹½æ‰‹åŠ¿ Gesture.Pan åŠå…¶ç›¸å…³çš„ä¸‰ä¸ªå›è°ƒ onBeginã€onChange å’Œ onFinalizeã€‚</p><p>ä½ å¯èƒ½ä¼šé—®ï¼šè½»æŒ‰æ‰‹åŠ¿æ˜¯ Gesture.Tapï¼Œæ‹–æ‹½æ‰‹åŠ¿ Gesture.Pan ï¼Œä½† onStartã€ onBeginã€onChange å’Œ onFinalize è¿™ 4 ä¸ªæ‰‹åŠ¿å›è°ƒä¹‹é—´æœ‰ä»€ä¹ˆå…³ç³»å•Šï¼Ÿä¸ºä»€ä¹ˆå®ç°æ‹–æ‹½åŠ¨æ•ˆéœ€è¦çš„æ˜¯ onBeginã€onChange å’Œ onFinalize è¿™ä¸‰ä¸ªæ‰‹åŠ¿å›è°ƒå‘¢ï¼Ÿé™¤äº†è¿™ 4 ä¸ªæ‰‹åŠ¿å›è°ƒï¼Œè¿˜æœ‰ä»€ä¹ˆå…¶ä»–æ‰‹åŠ¿å›è°ƒå—ï¼Ÿ</p><p>è¿™äº›é—®é¢˜å¾ˆæœ‰ä»·å€¼ï¼Œè½»æŒ‰æ‰‹åŠ¿å’Œæ‹–æ‹½æ‰‹åŠ¿è™½ç„¶æœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯å¯¹åº”çš„æ‰‹åŠ¿å›è°ƒå¤§ä½“ä¸Šéƒ½æ˜¯ç›¸åŒçš„ï¼Œå› æ­¤æˆ‘ç”¨æ‹–æ‹½æ‰‹åŠ¿å›è°ƒè¿›è¡Œè®²è§£ï¼Œå…¶ä¸­ç»†èŠ‚å·®å¼‚ä½ å¯ä»¥æŸ¥ä¸€ä¸‹<a href=\"https://docs.swmansion.com/react-native-gesture-handler/docs/api/gestures/pan-gesture\">ç›¸å…³æ–‡æ¡£</a>ã€‚</p><p>æ‹–æ‹½æ‰‹åŠ¿ç›¸å…³çš„å›è°ƒä¸€å…± 10 ä¸ªï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">const dragGesture = Gesture.Pan()\n    .onBegin(() =&gt; console.log('onBegin'))\n    .onTouchesDown(() =&gt; console.log('onTouchesDown'))\n    .onTouchesMove(() =&gt; console.log('onTouchesMove'))\n    .onStart(() =&gt; console.log('onStart'))\n    .onUpdate(() =&gt; console.log('onUpdate'))\n    .onChange(() =&gt; console.log('onChange'))\n    .onTouchesUp(() =&gt; console.log('onTouchesUp'))\n    .onEnd(() =&gt; console.log('onEnd'))\n    .onTouchesCancelled(() =&gt; console.log('onTouchesCancelled'))\n    .onFinalize(() =&gt; console.log('onFinalize'))\n</code></pre><p>è¿™äº›æ‰‹åŠ¿å›è°ƒæ˜¯æŒ‰é¡ºåºä»ä¸Šåˆ°ä¸‹ä¾æ¬¡è§¦å‘çš„ï¼š</p><ul>\n<li>onBeginï¼šå¼€å§‹è¯†åˆ«åˆ°æ‰‹åŠ¿ï¼Œä½†æ­¤æ—¶æ‹–æ‹½å¹¶æœªå‘ç”Ÿã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ—¶ä½ çš„æ‰‹æŒ‡æ˜¯è§¦ç¢°åˆ° View è§†å›¾ï¼Œä¸è¿‡æ‰‹æŒ‡å¹¶æœªç§»åŠ¨ï¼›</li>\n<li>onTouchesDownï¼šæ‰‹æŒ‡æŒ‰ä¸‹è§¦æ‘¸åˆ°è§†å›¾æ—¶ä¼šè§¦å‘ã€‚ä½ å¯ä»¥ç†è§£ä¸ºåœ¨æ‰‹æŒ‡è§¦æ‘¸åˆ°è§†å›¾æ—¶ï¼Œå…ˆè§¦å‘äº† onBegin ï¼Œç´§æ¥ç€å°±è§¦å‘äº† onTouchesDownï¼›</li>\n<li>onTouchesMoveï¼šæ‰‹æŒ‡ç§»åŠ¨åä¼šè§¦å‘ï¼›</li>\n<li>onStartï¼šå½“æ‰‹æŒ‡ç§»åŠ¨è·ç¦»è¶…è¿‡ Float.MIN_VALUE çš„é˜ˆå€¼æ—¶ï¼Œä¹Ÿå°±æ˜¯ç²¾åº¦ä¸º 0.000000 çš„è·ç¦»æ—¶ï¼Œå°±ä¼šè§¦å‘è¯¥å›è°ƒï¼Œæ­¤æ—¶<strong>æ‹–æ‹½äº‹ä»¶æ­£å¼è§¦å‘</strong>ï¼›</li>\n<li>onUpdateï¼šåœ¨æ‰‹æŒ‡ç§»åŠ¨çš„è¿‡ç¨‹ä¸­ x/y åæ ‡ç³»ç­‰å‚æ•°ä¼šæ›´æ–°ï¼Œå‚æ•°æ›´æ–°å onUpdate å›è°ƒå°±ä¼šè§¦å‘ï¼›</li>\n<li>onChangeï¼šåœ¨æ‰‹æŒ‡ç§»åŠ¨çš„è¿‡ç¨‹ä¸­ x/y åæ ‡ç³»ç­‰å‚æ•°ä¼šæ›´æ–°ï¼Œå‚æ•°æ›´æ–°å onChange å›è°ƒä¼šç´§æ¥ç€ onUpdate è§¦å‘ã€‚onChange å’Œ onUpdate çš„åŒºåˆ«æ˜¯ï¼ŒonChange çš„å‚æ•°æ˜¯ä»¥ä¸Šä¸€æ¬¡å›è°ƒçš„å‚æ•°ä½œä¸ºåŸºå‡†è¿›è¡Œæ›´æ–°çš„ï¼Œè€Œ onUpdate æ˜¯ä»¥æ‰‹åŠ¿è§¦å‘ onStart æ—¶çš„å‚æ•°ä¸ºåŸºå‡†è¿›è¡Œæ›´æ–°çš„ï¼›</li>\n<li>onTouchesUpï¼šå½“æ‰‹æŒ‡ç¦»å¼€å±å¹•æ—¶ï¼Œè§¦å‘ onTouchesUp å›è°ƒï¼›</li>\n<li>onEndï¼šå½“æ‰‹æŒ‡ç¦»å¼€å±å¹•æ—¶ï¼Œä¼šå…ˆè§¦å‘ onTouchesUp å›è°ƒï¼Œç„¶åç´§æ¥ç€è§¦å‘ onEnd å›è°ƒã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ onEnd å›è°ƒæ˜¯å’Œ onStart é…å¥—å‡ºç°çš„ï¼Œå¦‚æœæ²¡æœ‰è§¦å‘ onStart å›è°ƒï¼Œé‚£ä¹Ÿä¸ä¼šè§¦å‘ onEnd å›è°ƒï¼›</li>\n<li>onTouchesCancelledï¼šä¸€èˆ¬æ˜¯åœ¨ç³»ç»Ÿå¼¹çª—ä¸­æ–­æ‰‹åŠ¿çš„æƒ…å†µä¸‹è§¦å‘ï¼Œè¾ƒä¸ºå°‘è§ï¼›</li>\n<li>onFinalizeï¼šåªè¦æ‰‹åŠ¿ç»“æŸï¼Œæœ€ç»ˆéƒ½ä¼šè§¦å‘ onFinalize å›è°ƒã€‚</li>\n</ul><p>è¿™ 10 ä¸ªæ‰‹åŠ¿å›è°ƒï¼Œå¯èƒ½ç¨å¾®æœ‰ç‚¹éš¾è®°ï¼Œæˆ‘å»ºè®®ä½ è‡ªå·±äº²è‡ªåŠ¨æ‰‹è¯•è¯•ï¼Œæˆ‘ä¹Ÿç»™ä½ ç”»äº†ä¸€å¼ ç¤ºæ„å›¾ï¼Œå¸®ä½ åŠ æ·±ç†è§£ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/57/7f/57be0b86600a6827f5a9ab66760e607f.png?wh=1920x933\" alt=\"å›¾ç‰‡\" title=\"å›¾æ ‡æ¥æºäº www.flaticon.com\"></p><p>å›åˆ°æˆ‘ä»¬è¦å®ç°çš„æ‹–æ‹½åŠ¨æ•ˆï¼Œå®ƒçš„ä¸€ä¸ªåŠŸèƒ½æ˜¯æ‰‹æŒ‡è§¦ç¢°åˆ°è§†å›¾ï¼Œè§†å›¾å˜è“ï¼Œæ‰‹æŒ‡ç¦»å¼€è§†å›¾ï¼Œè§†å›¾å˜ç°ï¼Œå¦ä¸€ä¸ªåŠŸèƒ½æ˜¯æ‰‹æŒ‡ç§»åŠ¨æ—¶è§†å›¾è·Ÿéšç€æ‰‹æŒ‡ä¸€èµ·ç§»åŠ¨ã€‚</p><p>æ‰‹æŒ‡è§¦ç¢°å’Œç¦»å¼€è§†å›¾æ—¶æ˜¯ä¸ä¼šè§¦å‘ onStart å’Œ onEnd å›è°ƒçš„ï¼Œåªä¼šè§¦å‘ onBegin å’Œ onFinalize å›è°ƒï¼Œå› æ­¤æˆ‘é€‰æ‹©äº† onBegin å’Œ onFinalize æ¥å¤„ç†æ‰‹æŒ‡è§¦ç¢°å’Œæ‰‹æŒ‡ç¦»å¼€è¿™ä¸¤ä¸ªäº‹ä»¶ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹è§†å›¾è·Ÿéšæ‰‹æŒ‡ç§»åŠ¨çš„åŠŸèƒ½ã€‚onUpdate è¿”å›çš„æ˜¯ä»¥ onStart è§¦å‘ä½ç½®ä¸ºåŸºå‡†çš„å‚æ•°ï¼Œè€Œ onChange è¿”å›çš„å‚æ•°ä¸ä»…åŒ…æ‹¬ onUpdate å‚æ•°ï¼Œè¿˜å¤šäº†ä»¥ä¸Šä¸€æ¬¡ onChange è§¦å‘ä½ç½®ä¸ºåŸºå‡†çš„åç§»é‡ <code>changeX</code> å’Œ <code>changeY</code>ï¼Œæˆ‘éœ€è¦æ ¹æ®ä¸Šä¸€æ¬¡æ‰‹åŠ¿çš„åç§»é‡ <code>changeX</code> å’Œ <code>changeY</code>æ¥è®¡ç®—è§†å›¾æ–°çš„åç§»é‡ï¼Œå› æ­¤æˆ‘é€‰æ‹©ä½¿ç”¨ onChange è€Œä¸æ˜¯ onUpdate ã€‚</p><p><strong>å®ç°æ‹–æ‹½åŠ¨æ•ˆçš„æœ€åä¸€æ­¥æ˜¯ï¼Œæ›´æ–°åŠ¨ç”»çš„å…±äº«å€¼ã€‚</strong></p><p>å› ä¸ºï¼ŒAnimated.View è§†å›¾çš„è¡ç”Ÿæ ·å¼å€¼å·²ç»è®¾ç½®å¥½äº†ï¼Œåªè¦åŠ¨ç”»çš„å…±äº«å€¼ä¸€æ›´æ–°ï¼Œè¡ç”Ÿæ ·å¼å€¼å°±ä¼šæ›´æ–°ï¼ŒAnimated.View å°±ä¼šè·Ÿç€æ‰‹æŒ‡åŠ¨èµ·æ¥ã€‚</p><p>æ›´æ–°åŠ¨ç”»å…±äº«å€¼çš„ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">  const dragGesture = Gesture.Pan()\n    .onBegin(() =&gt; {\n      isPressed.value = true;\n    })\n    .onChange((e) =&gt; {\n      offset.value = {\n        x: e.changeX + offset.value.x,\n        y: e.changeY + offset.value.y,\n      };\n    })\n    .onFinalize(() =&gt; {\n      isPressed.value = false;\n    });\n</code></pre><p>è¿™æ®µä»£ç æ¯”è¾ƒç®€å•ï¼Œåœ¨ onBegin å›è°ƒä¸­å°† isPressed.value æ ‡è®°ä¸º trueï¼Œåœ¨ onFinalize å›è°ƒä¸­å°† isPressed.value æ ‡è®°ä¸º falseï¼Œè¿™å°±å®ç°äº†æ‰‹æŒ‡è§¦ç¢°è§†å›¾ç½®è“ï¼Œç¦»å¼€è§†å›¾ç½®ç°çš„æ•ˆæœã€‚<br>\nç„¶ååœ¨ onChange å›è°ƒä¸­ï¼Œè·å–ä¸Šä¸€æ¬¡ Animated.View è§†å›¾çš„åç§»ä½ç½® offset.value.x å’Œ offset.value.yï¼Œå¹¶å°†å…¶åˆ†åˆ«å’Œç›¸å¯¹ä¸Šä¸€æ¬¡ä½ç½®çš„åç§»é‡ e.changeX å’Œ e.changeY è¿›è¡Œç›¸åŠ ï¼Œå°±èƒ½è®¡ç®—å‡ºå½“å‰ Animated.View çš„åç§»ä½ç½® offset.valueã€‚å½“ offset.value å…±äº«å€¼æ›´æ–°æ—¶ï¼ŒAnimated.View çš„è¡ç”Ÿæ ·å¼å€¼  <code>translateX</code> å’Œ <code>translateY</code>ä¹Ÿä¼šéšä¹‹æ›´æ–°ï¼Œè¯¥è§†å›¾åœ¨å±å¹•ä¸Šçš„ä½ç½®ä¹Ÿä¼šå‘ç”Ÿç›¸åº”åœ°ç§»åŠ¨ã€‚</p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±æŠŠæ‹–æ‹½åŠ¨æ•ˆå®ç°äº†ã€‚è¿™é‡Œæˆ‘ä»¬å†æ•´åˆä¸‹å®ç°æ‹–æ‹½åŠ¨æ•ˆçš„ä¸»è¦ä»£ç ï¼Œä½ å¯ä»¥ä»”ç»†çœ‹çœ‹ä»¥åŠ æ·±å°è±¡ï¼š</p><pre><code class=\"language-plain\">function Ball() {\n  const isPressed = useSharedValue(false);\n  const offset = useSharedValue({ x: 0, y: 0 });\n\n  const animatedStyles = useAnimatedStyle(() =&gt; {\n    return {\n      transform: [\n        { translateX: offset.value.x },\n        { translateY: offset.value.y },\n      ],\n      backgroundColor: isPressed.value ? 'blue' : '#ccc',\n    };\n  });\n\n  const dragGesture = Gesture.Pan()\n    .onBegin(() =&gt; {\n      isPressed.value = true;\n    })\n    .onChange((e) =&gt; {\n      offset.value = {\n        x: e.changeX + offset.value.x,\n        y: e.changeY + offset.value.y,\n      };\n    })\n    .onFinalize(() =&gt; {\n      isPressed.value = false;\n    });\n\n  return (\n    &lt;GestureDetector gesture={dragGesture}&gt;\n      &lt;Animated.View style={[styles.ball, animatedStyles]} /&gt;\n    &lt;/GestureDetector&gt;\n  );\n}\n\nexport default function Example() {\n  return (\n    &lt;View style={styles.container}&gt;\n      &lt;Ball /&gt;\n    &lt;/View&gt;\n  );\n}\n</code></pre><h2>æ€»ç»“</h2><p>ä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å°† Gesture æ‰‹åŠ¿åº“å’Œ Reanimated åŠ¨ç”»åº“æ­é…ä¸€èµ·ä½¿ç”¨ï¼Œå®ç°ä¸€ä¸ªæœ€åŸºç¡€çš„æ‹–æ‹½åŠ¨æ•ˆã€‚</p><p>å®ç°ä¸€ä¸ªæ‹–æ‹½åŠ¨æ•ˆä¸»è¦åˆ†ä¸ºä¸‰æ­¥ï¼š</p><ul>\n<li>ç¬¬ä¸€æ­¥ï¼Œåˆ›å»º Gesture.Pan æ‰‹åŠ¿å¹¶å°†æ‹–æ‹½æ‰‹åŠ¿ç»‘å®šåˆ°åŠ¨ç”»ç»„ä»¶ä¸Šï¼›</li>\n<li>ç¬¬äºŒæ­¥ï¼Œåœ¨ Gesture.Pan æ‹–æ‹½æ‰‹åŠ¿çš„ 10 ä¸ªæ‰‹åŠ¿å›è°ƒä¸­ï¼Œé€‰æ‹© onBegin å’Œ onFinalize æ‰‹åŠ¿å›è°ƒå“åº”æ‹–æ‹½å¼€å§‹å’Œæ‹–æ‹½å®Œæˆï¼Œé€‰æ‹© onChange å“åº”æ‹–æ‹½ç§»åŠ¨ï¼›</li>\n<li>ç¬¬ä¸‰æ­¥ï¼Œåœ¨ç›¸åº”çš„æ‹–æ‹½å›è°ƒä¸­åŒæ­¥æ›´æ–°åŠ¨ç”»ç»„ä»¶çš„å…±äº«å€¼ï¼Œä¹Ÿå°±æ˜¯  xã€y è½´åæ ‡ï¼Œå®ç°åŸºç¡€çš„æ‹–æ‹½åŠ¨æ•ˆã€‚</li>\n</ul><p>æ‰‹åŠ¿ç›¸å…³çš„é—®é¢˜æ˜¯æˆ‘ä»¬å¾ˆå®¹æ˜“é‡åˆ°çš„ï¼Œè€Œä¸”å­¦ä¹ æ›²çº¿å¾ˆé™¡å³­ï¼Œæ‰€ä»¥æˆ‘æŠŠæ‰‹åŠ¿åˆ†ä¸ºäº†ä¸Šä¸­ä¸‹ä¸‰ç¯‡ã€‚ä»Šå¤©çš„å†…å®¹è¿˜æ˜¯ç›¸å¯¹åŸºç¡€çš„ï¼Œåœ¨äº†è§£äº†æ‰‹åŠ¿åŸºç¡€çš„åŸç†å’Œä½¿ç”¨åï¼Œä¸‹ä¸€è®²æˆ‘ä»¬å°†åœ¨æ­¤åŸºç¡€ä¸Šï¼Œç»§ç»­è®²è§£æ‰‹åŠ¿è¿›é˜¶çš„å†…å®¹ï¼Œç‰¹åˆ«æ˜¯å¦‚ä½•è§£å†³æ‰‹åŠ¿å†²çªçš„é—®é¢˜ã€‚</p><h2>ä½œä¸š</h2><ol>\n<li>è¯·ä½ å®ç°ä¸€ä¸ªç±»ä¼¼å¾®ä¿¡æ¶ˆæ¯çš„å·¦æ»‘åˆ é™¤çš„åŠŸèƒ½ï¼›</li>\n<li>è¯·ä½ èŠä¸€ä¸‹ï¼Œä½ é‡åˆ°è¿‡å“ªäº›éœ€è¦æ‰‹åŠ¿å’ŒåŠ¨ç”»é…åˆæ‰èƒ½å®ç°çš„åŠŸèƒ½ï¼Œä½ æ˜¯åŸæ¥éƒ½æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</li>\n</ol><p>æ¬¢è¿åœ¨è¯„è®ºåŒºå’Œæˆ‘æ¢è®¨ã€‚æˆ‘æ˜¯è’‹å®ä¼Ÿï¼Œå’±ä»¬ä¸‹èŠ‚è¯¾è§ã€‚</p>","comments":[{"had_liked":false,"id":344848,"user_name":"Hadwz","can_delete":false,"product_type":"c1","uid":1082194,"ip_address":"","ucode":"D75B31EF77F4E0","user_header":"https://static001.geekbang.org/account/avatar/00/10/83/52/e6d46fb3.jpg","comment_is_top":false,"comment_ctime":1651823144,"is_pvip":false,"replies":[{"id":125865,"content":"ä½ é‡åˆ°çš„é—®é¢˜ï¼Œå¤§å®¶ä¹Ÿç»å¸¸é‡åˆ°ï¼Œå°±æ˜¯æ‰‹åŠ¿å†²çªçš„é—®é¢˜ï¼Œåœ¨ Gesture ä¸­ä¸‹ä¸¤è®²ä¸­æœ‰å›ç­”ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1088541,"ctime":1651838126,"ip_address":"","comment_id":344848,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100110101,"comment_content":"è€å¸ˆï¼Œç”¨Gesture æ‰‹åŠ¿åº“å’Œ Reanimatedï¼Œå®ç°åœ¨ScrollViewé‡Œä¸Šä¸‹æ‹–æ‹½ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶åœ¨å…ƒç´ åˆ°è¾¾åˆ—è¡¨çš„é¡¶éƒ¨&#47;åº•éƒ¨çš„æ—¶å€™ï¼Œæ»šåŠ¨ScrollViewï¼Œè®©åˆ—è¡¨å’Œå…ƒç´ åŒæ—¶ç§»åŠ¨ï¼Œæœ‰ä»€ä¹ˆå®ç°æ€è·¯å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1088541,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9c/1d/f0f10198.jpg","nickname":"è’‹å®ä¼Ÿ","note":"","ucode":"02226CABD5ECE7","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":570622,"discussion_content":"ä½ é‡åˆ°çš„é—®é¢˜ï¼Œå¤§å®¶ä¹Ÿç»å¸¸é‡åˆ°ï¼Œå°±æ˜¯æ‰‹åŠ¿å†²çªçš„é—®é¢˜ï¼Œåœ¨ Gesture ä¸­ä¸‹ä¸¤è®²ä¸­æœ‰å›ç­”ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651838127,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":344347,"user_name":"ZouLe","can_delete":false,"product_type":"c1","uid":1494564,"ip_address":"","ucode":"5C8AD10C3A0C78","user_header":"https://static001.geekbang.org/account/avatar/00/16/ce/24/bfd04641.jpg","comment_is_top":false,"comment_ctime":1651484637,"is_pvip":false,"replies":[{"id":125824,"content":"æ˜¯çš„ã€‚ä¸»è¦è¿˜æ˜¯å› ä¸º JSI å’Œ Hermes çš„åŸå› ã€‚å…¶å® Flipper åŠŸèƒ½æ›´å¼ºå¤§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1088541,"ctime":1651743314,"ip_address":"","comment_id":344347,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100110101,"comment_content":"ä¸Š Reanimated v2 å’Œ Gesture v2 å°±ä¸èƒ½ç”¨åŸæ¥çš„æµè§ˆå™¨debugæ¨¡å¼å¼€å‘äº†ï¼Œè¿™ä¸ªè½¬æ¢è·¨åº¦è¿˜æ˜¯è›®å¤§çš„ ğŸ˜„","like_count":0,"discussions":[{"author":{"id":1088541,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9c/1d/f0f10198.jpg","nickname":"è’‹å®ä¼Ÿ","note":"","ucode":"02226CABD5ECE7","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":570360,"discussion_content":"æ˜¯çš„ã€‚ä¸»è¦è¿˜æ˜¯å› ä¸º JSI å’Œ Hermes çš„åŸå› ã€‚å…¶å® Flipper åŠŸèƒ½æ›´å¼ºå¤§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651743315,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":344748,"user_name":"é£ä¹‹åŒ–èº«","can_delete":false,"product_type":"c1","uid":1162030,"ip_address":"","ucode":"90BF1B9FF802CF","user_header":"https://static001.geekbang.org/account/avatar/00/11/bb/2e/70d25615.jpg","comment_is_top":false,"comment_ctime":1651748271,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100110101,"comment_content":"è®²çš„è›®å¥½ï¼Œå»ºè®®å½•ä¸ªå°è§†é¢‘çœ‹ä¸‹æœ€ç»ˆæ•ˆæœä¼šæ›´ç›´è§‚ç‚¹ï½","like_count":3},{"had_liked":false,"id":388410,"user_name":"*****","can_delete":false,"product_type":"c1","uid":2548515,"ip_address":"ç¦å»º","ucode":"73EDAFD23B80E1","user_header":"https://static001.geekbang.org/account/avatar/00/26/e3/23/b190b05d.jpg","comment_is_top":false,"comment_ctime":1710146010,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100110101,"comment_content":"Gesture.Pan æ‰‹æŒ‡ç¦»å¼€å±å¹•åï¼Œä¸‹æ¬¡åœ¨æ‹–åŠ¨å°±æ— æ•ˆäº†","like_count":0},{"had_liked":false,"id":349971,"user_name":"dao","can_delete":false,"product_type":"c1","uid":1087879,"ip_address":"","ucode":"4181FB270462CF","user_header":"https://static001.geekbang.org/account/avatar/00/10/99/87/5066026c.jpg","comment_is_top":false,"comment_ctime":1656475491,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100110101,"comment_content":"æ‰‹åŠ¿è¿™ä¸‰èŠ‚è¯¾ï¼Œå­¦ä¹ äº†å¥½å‡ å‘¨ ğŸ’¦\nè¯•ç€åšäº†ä½œä¸šä¸€ https:&#47;&#47;bit.ly&#47;3HXMCae ï¼Œä½¿ç”¨äº† react-native-gesture-handler çš„ Swipeable ç»„ä»¶å®Œæˆçš„ã€‚å°è¯•ç€è‡ªå·±ç”¨ Reanimated å†™ï¼Œå‘ç°å¯¹æˆ‘è¿™æ–°æ‰‹éš¾åº¦å¤§äº†å†™ ğŸ˜‚","like_count":0}]}