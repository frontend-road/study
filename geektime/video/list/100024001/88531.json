{"id":88531,"title":"39 | ä¸‡èƒ½ç¨‹åº","content":"<h1>è¯¾ä»¶åŠæºä»£ç åœ°å€</h1><p><a href=\"https://gitee.com/geektime-geekbang/go_learning\">https://gitee.com/geektime-geekbang/go_learning</a></p><h2>ä¹¦ç›®æ¨è</h2><p><a href=\"time://mall?url=https%3A%2F%2Fh5.youzan.com%2Fv2%2Fgoods%2F1ycmk3uob0ryw\">ã€Šè®¡ç®—æœºç¨‹åºçš„æ„é€ å’Œè§£é‡Šã€‹</a></p>","comments":[{"had_liked":false,"id":85436,"user_name":"èŠå£«è€çˆ¹","can_delete":false,"product_type":"c3","uid":1071316,"ip_address":"","ucode":"5F2935967574D0","user_header":"https://static001.geekbang.org/account/avatar/00/10/58/d4/c52f9f6d.jpg","comment_is_top":false,"comment_ctime":1555060037,"is_pvip":false,"replies":[{"id":30760,"content":"éå¸¸æ„Ÿè°¢æŒ‡å‡ºè¿™ä¸ªé—®é¢˜ã€‚ä½ å­¦å¾—éå¸¸ç»†è‡´ï¼Œæ­£ç¡®çš„ä»£ç å¦‚ä¸‹ï¼Œgithubä¸Šçš„ä»£ç ä¹Ÿä¼šä¿®æ­£ã€‚\n\n\tif reflect.TypeOf(st).Kind() != reflect.Ptr {\n\t\treturn errors.New(&quot;the first param should be a pointer to the struct type.&quot;)\n\t}\n\t&#47;&#47; Elem() è·å–æŒ‡é’ˆæŒ‡å‘çš„å€¼\n\tif reflect.TypeOf(st).Elem().Kind() != reflect.Struct {\n\t\treturn errors.New(&quot;the first param should be a pointer to the struct type.&quot;)\n\t}","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1555158256,"ip_address":"","comment_id":85436,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"è¯¾ç¨‹æºç ï¼š\nif reflect.TypeOf(st).Kind() != reflect.Ptr { \n\t\t&#47;&#47; Elem() è·å–æŒ‡é’ˆæŒ‡å‘çš„å€¼\n\t\tif reflect.TypeOf(st).Elem().Kind() != reflect.Struct {\n\t\t\treturn errors.New(&quot;the first param should be a pointer to the struct type.&quot;)\n\t\t}\n\t}\nè¿™ä¸€æ®µçš„åˆ¤æ–­æœ‰äº›ç–‘é—®ã€‚\nç¬¬ä¸€è¡Œifå…ˆåˆ¤æ–­æ˜¯å¦ä¸ºæŒ‡é’ˆï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™æ‰§è¡Œç¬¬äºŒè¡Œifã€‚\nä½†æ˜¯ç¬¬äºŒè¡Œifé‡Œé¢ç”¨åˆ°äº†Elem()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸æ˜¯æŒ‡é’ˆæ˜¯ä¸èƒ½è°ƒç”¨çš„ã€‚\næ‰€ä»¥è¿™é‡Œæ˜¯ä¸æ˜¯æœ‰äº›é—®é¢˜ï¼Ÿ\næ”¹æˆå¦‚ä¸‹è¿™æ ·å‘¢ï¼Ÿ\n\tif reflect.TypeOf(st).Kind() != reflect.Ptr {\n\t\treturn errors.New(&quot;the first param should be a pointer&quot;)\n\t}\n\t&#47;&#47; Elem() è·å–æŒ‡é’ˆæŒ‡å‘çš„å€¼\n\tif reflect.TypeOf(st).Elem().Kind() != reflect.Struct {\n\t\treturn errors.New(&quot;the first param should be a pointer to the struct type&quot;)\n\t}\nè¯·è§£æƒ‘ã€æŒ‡æ­£ã€‚","like_count":9,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446667,"discussion_content":"éå¸¸æ„Ÿè°¢æŒ‡å‡ºè¿™ä¸ªé—®é¢˜ã€‚ä½ å­¦å¾—éå¸¸ç»†è‡´ï¼Œæ­£ç¡®çš„ä»£ç å¦‚ä¸‹ï¼Œgithubä¸Šçš„ä»£ç ä¹Ÿä¼šä¿®æ­£ã€‚\n\n\tif reflect.TypeOf(st).Kind() != reflect.Ptr {\n\t\treturn errors.New(&amp;quot;the first param should be a pointer to the struct type.&amp;quot;)\n\t}\n\t// Elem() è·å–æŒ‡é’ˆæŒ‡å‘çš„å€¼\n\tif reflect.TypeOf(st).Elem().Kind() != reflect.Struct {\n\t\treturn errors.New(&amp;quot;the first param should be a pointer to the struct type.&amp;quot;)\n\t}","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555158256,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":85102,"user_name":"è¥¿é–€ç†±","can_delete":false,"product_type":"c3","uid":1151033,"ip_address":"","ucode":"89DAEEBC83714C","user_header":"https://static001.geekbang.org/account/avatar/00/11/90/39/0f4c8f71.jpg","comment_is_top":false,"comment_ctime":1554980949,"is_pvip":false,"replies":[{"id":30616,"content":"å¯ä»¥å•Šã€‚ä½ è¿˜å¯ä»¥åˆ©ç”¨æˆ‘ä»¬æ¥å…ˆæ¥è¯¾ç¨‹ä¸­æ¶‰åŠçš„æ€§èƒ½åˆ†ææ–¹æ³•æ¥åˆ†æä¸€ä¸‹å½±å“ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1555049123,"ip_address":"","comment_id":85102,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"è€å¸ˆæ‚¨å¥½ã€‚\næˆ‘çœ‹æ¼”ç¤ºä»£ç ä¸­å¤šæ¬¡å‡ºç°reflect.TypeOf(st)å’Œreflect.ValueOf(st)ï¼Œè€ƒè™‘åˆ°å¤šæ¬¡è°ƒç”¨å‡½æ•°æ˜¯å¦ä¼šå­˜åœ¨æ€§èƒ½é—®é¢˜ï¼Œèƒ½å¦åˆ†åˆ«èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼ˆæ–°å¢å˜é‡å ç”¨å†…å­˜ï¼Ÿï¼‰ï¼Œä¾‹å¦‚ï¼š\n        rt := reflect.TypeOf(st)\n\trv := reflect.ValueOf(st)\nç„¶ååœ¨ä¸‹é¢rt.Kind()ï¼Œrt.Elem().Kind()è¿™æ ·è°ƒç”¨ã€‚","like_count":7,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446559,"discussion_content":"å¯ä»¥å•Šã€‚ä½ è¿˜å¯ä»¥åˆ©ç”¨æˆ‘ä»¬æ¥å…ˆæ¥è¯¾ç¨‹ä¸­æ¶‰åŠçš„æ€§èƒ½åˆ†ææ–¹æ³•æ¥åˆ†æä¸€ä¸‹å½±å“ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555049123,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":135385,"user_name":"Geek_338030","can_delete":false,"product_type":"c3","uid":1614014,"ip_address":"","ucode":"6F2ACB3C528BAA","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/1ZcgbSZ1Q0eARic4sFq9PRO0rT55MAYUAcBVNK3dE6ficOQViblBlzUTnMJyK2bZbU3IsewnDxKD5Wtrq01DeHnWQ/132","comment_is_top":false,"comment_ctime":1569143254,"is_pvip":false,"replies":[{"id":52937,"content":"Elem()è¿”å›çš„æ˜¯å€¼Valueï¼Œè€ŒType()ä¹‹åè¿”å›çš„æ˜¯ç±»å‹ã€‚\nä½ è¿è¡Œä»¥ä¸‹ä¸¤è¡Œä»£ç å°±ä¼šæ¸…æ¥šäº†ï¼š\nfmt.Println(&quot;--&quot;, (reflect.ValueOf(st)).Elem())\nfmt.Println(&quot;**&quot;, (reflect.ValueOf(st)).Elem().Type())","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1569835723,"ip_address":"","comment_id":135385,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"å¥½åƒæœ‰ç‚¹æ‡‚è€å¸ˆçš„æ„æ€äº†ï¼Œæˆ‘è¿™æ ·ç†è§£æ˜¯å¦æ­£ç¡®å‘¢ï¼Ÿ\n(reflect.ValueOf(st)).Elem().FieldByName(k)\nè¿”å›çš„æ˜¯ä¸€ä¸ªstruct filedç±»å‹çš„å€¼\n(reflect.ValueOf(st)).Elem().Type().FieldByName(k)\nç”±äºåŠ ä¸Šäº†Typeï¼Œæ‰€ä»¥å°±è¿”å›äº†struct filedè¿™ä¸ªç±»å‹","like_count":1,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468168,"discussion_content":"Elem()è¿”å›çš„æ˜¯å€¼Valueï¼Œè€ŒType()ä¹‹åè¿”å›çš„æ˜¯ç±»å‹ã€‚\nä½ è¿è¡Œä»¥ä¸‹ä¸¤è¡Œä»£ç å°±ä¼šæ¸…æ¥šäº†ï¼š\nfmt.Println(&amp;quot;--&amp;quot;, (reflect.ValueOf(st)).Elem())\nfmt.Println(&amp;quot;**&amp;quot;, (reflect.ValueOf(st)).Elem().Type())","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569835723,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1199670,"avatar":"https://static001.geekbang.org/account/avatar/00/12/4e/36/de029ebf.jpg","nickname":"ğŸ¬Innocence","note":"","ucode":"7CBAB4976FACE0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":247831,"discussion_content":"(reflect.ValueOf(st)).Elem().FieldByName(k) è¿™ä¸ªæ‰§è¡Œæ˜¯ä¼šæœ‰æŠ¥é”™çš„ã€‚å› ä¸ºä½ å®šä¹‰äº†field æ˜¯StructFieldç±»å‹ï¼Œè€Œè¿™ä¸ª(reflect.ValueOf(st)).Elem().FieldByName(k)è¿”å›çš„æ˜¯ä¸€ä¸ªå…·ä½“çš„å€¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587825971,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":135060,"user_name":"Geek_338030","can_delete":false,"product_type":"c3","uid":1614014,"ip_address":"","ucode":"6F2ACB3C528BAA","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/1ZcgbSZ1Q0eARic4sFq9PRO0rT55MAYUAcBVNK3dE6ficOQViblBlzUTnMJyK2bZbU3IsewnDxKD5Wtrq01DeHnWQ/132","comment_is_top":false,"comment_ctime":1568992485,"is_pvip":false,"replies":[{"id":51909,"content":"ä»¥ä¸‹æ˜¯FieldByNameçš„å®šä¹‰ï¼Œå¯è§è¿”å›å€¼æ˜¯StructFieldç±»å‹ã€‚\n&#47;&#47; FieldByName returns the struct field with the given name\n\t&#47;&#47; and a boolean indicating if the field was found.\n\tFieldByName(name string) (StructField, bool)\n\n&#47;&#47; A StructField describes a single field in a struct.\ntype StructField struct {\n\t&#47;&#47; Name is the field name.\n\tName string\n\t&#47;&#47; PkgPath is the package path that qualifies a lower case (unexported)\n\t&#47;&#47; field name. It is empty for upper case (exported) field names.\n\t&#47;&#47; See https:&#47;&#47;golang.org&#47;ref&#47;spec#Uniqueness_of_identifiers\n\tPkgPath string\n\n\tType      Type      &#47;&#47; field type\n\tTag       StructTag &#47;&#47; field tag string\n\tOffset    uintptr   &#47;&#47; offset within struct, in bytes\n\tIndex     []int     &#47;&#47; index sequence for Type.FieldByIndex\n\tAnonymous bool      &#47;&#47; is an embedded field\n}","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1569139687,"ip_address":"","comment_id":135060,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"(reflect.ValueOf(st)).Elem().Type().FieldByName(k)\n(reflect.ValueOf(st)).Elem().Type()æ‰“å°å‡ºæ¥çš„ç»“æœæ˜¯flexible_reflect.Employeeï¼Œè€ŒFieldByNameè¿™ä¸ªå‡½æ•°è¿”å›çš„ä¸æ˜¯kå¯¹åº”çš„å€¼å—ï¼Ÿä¸ºä»€ä¹ˆè¿”å›çš„å´æ˜¯{Name  string format:&quot;normal&quot; 16 [1] false} true","like_count":1,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468025,"discussion_content":"ä»¥ä¸‹æ˜¯FieldByNameçš„å®šä¹‰ï¼Œå¯è§è¿”å›å€¼æ˜¯StructFieldç±»å‹ã€‚\n// FieldByName returns the struct field with the given name\n\t// and a boolean indicating if the field was found.\n\tFieldByName(name string) (StructField, bool)\n\n// A StructField describes a single field in a struct.\ntype StructField struct {\n\t// Name is the field name.\n\tName string\n\t// PkgPath is the package path that qualifies a lower case (unexported)\n\t// field name. It is empty for upper case (exported) field names.\n\t// See https://golang.org/ref/spec#Uniqueness_of_identifiers\n\tPkgPath string\n\n\tType      Type      // field type\n\tTag       StructTag // field tag string\n\tOffset    uintptr   // offset within struct, in bytes\n\tIndex     []int     // index sequence for Type.FieldByIndex\n\tAnonymous bool      // is an embedded field\n}","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569139687,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":135056,"user_name":"Geek_338030","can_delete":false,"product_type":"c3","uid":1614014,"ip_address":"","ucode":"6F2ACB3C528BAA","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/1ZcgbSZ1Q0eARic4sFq9PRO0rT55MAYUAcBVNK3dE6ficOQViblBlzUTnMJyK2bZbU3IsewnDxKD5Wtrq01DeHnWQ/132","comment_is_top":false,"comment_ctime":1568991602,"is_pvip":false,"replies":[{"id":51905,"content":"å› ä¸ºä¼ å…¥çš„ç»“æ„çš„å®ä¾‹é‡Œé¢åŒ…å«ä¸¤ä¸ªfield ï¼ˆNameå’ŒAgeï¼‰æ‰€ä»¥é‡å¤äº†ä¸¤éï¼Œ\nç¬¬ä¸€ä¸ªè¾“å‡ºæ˜¯ç”±äº Nameå’ŒAgeéƒ½è¿˜æ²¡æœ‰è¢«èµ‹å€¼ï¼ˆNameä½ç©ºå­—ç¬¦ä¸²ï¼ŒAgeä¸º0ï¼Œéƒ½æ˜¯ç¼ºçœå€¼ï¼‰\nç¬¬äºŒä¸ªè¾“å‡ºæ˜¯ç”±äºNameå·²ç»è¢«èµ‹å€¼äº†â€œMikeâ€","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1569139370,"ip_address":"","comment_id":135056,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"\n\t\tif field.Type == reflect.TypeOf(v) {\n\t\t\tvstr := reflect.ValueOf(st)\n\t\t\tvstr = vstr.Elem()\n                        &#47;&#47;ä¸ºä»€ä¹ˆè¿™é‡ŒæŸ¥çœ‹æˆ‘è¦ä¿®æ”¹çš„stçš„æ—¶å€™ï¼Œä¼šå‘ç°æ‰“å°å‡ºä¸¤ä¸ªå€¼å‘¢ï¼Ÿ\n                        fmt.Println(st)\n\t\t\tvstr.FieldByName(k).Set(reflect.ValueOf(v))\n\t\t}\næ˜¾ç¤ºç»“æœå¦‚ä¸‹ï¼š\n&amp;{  0}\n&amp;{ Mike 0}\n\n","like_count":1,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468023,"discussion_content":"å› ä¸ºä¼ å…¥çš„ç»“æ„çš„å®ä¾‹é‡Œé¢åŒ…å«ä¸¤ä¸ªfield ï¼ˆNameå’ŒAgeï¼‰æ‰€ä»¥é‡å¤äº†ä¸¤éï¼Œ\nç¬¬ä¸€ä¸ªè¾“å‡ºæ˜¯ç”±äº Nameå’ŒAgeéƒ½è¿˜æ²¡æœ‰è¢«èµ‹å€¼ï¼ˆNameä½ç©ºå­—ç¬¦ä¸²ï¼ŒAgeä¸º0ï¼Œéƒ½æ˜¯ç¼ºçœå€¼ï¼‰\nç¬¬äºŒä¸ªè¾“å‡ºæ˜¯ç”±äºNameå·²ç»è¢«èµ‹å€¼äº†â€œMikeâ€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569139370,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":379978,"user_name":"è‰åŸfan","can_delete":false,"product_type":"c3","uid":2082341,"ip_address":"åŒ—äº¬","ucode":"8F24B531252411","user_header":"https://static001.geekbang.org/account/avatar/00/1f/c6/25/38653ad1.jpg","comment_is_top":false,"comment_ctime":1692779899,"is_pvip":false,"replies":[{"id":139265,"content":"å¾ˆå¥½çš„å‘ç°ï¼æ²¡é”™å¯ä»¥çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1008262,"ctime":1697111657,"ip_address":"åŒ—äº¬","comment_id":379978,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"è¯·æ•™è€å¸ˆï¼š\n\tvStr := reflect.ValueOf(st)\n\tvStr = vStr.Elem()\nè¿™ä¸ªæ“ä½œæˆ‘çœ‹è¯¾ç¨‹æ˜¯æ”¾åœ¨forå¾ªç¯é‡Œçš„ï¼Œè¿™ä¸ªæ˜¯ä¸æ˜¯å¯ä»¥æ”¾åœ¨forå¾ªç¯ä¹‹å‰ï¼Œå› ä¸ºè·å–å®ä¾‹å¯¹è±¡åªéœ€è¦ä¸€æ¬¡å°±å¯ä»¥äº†ï¼Œåœ¨forå¾ªç¯é‡Œåªéœ€æ‰§è¡ŒvStr.FieldByName(k).Set(reflect.ValueOf(v))å°±è¡Œäº†","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":629488,"discussion_content":"å¾ˆå¥½çš„å‘ç°ï¼æ²¡é”™å¯ä»¥çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1697111658,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":333134,"user_name":"Redamancy","can_delete":false,"product_type":"c3","uid":2327655,"ip_address":"","ucode":"856412C42A7F1A","user_header":"https://static001.geekbang.org/account/avatar/00/23/84/67/1dacc4b3.jpg","comment_is_top":false,"comment_ctime":1644123099,"is_pvip":false,"replies":[{"id":127020,"content":"ä½ çš„Fieldçš„nameæ˜¯æ€æ ·çš„ï¼Œé¦–å­—æ¯å¤§å†™äº†å—","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1008262,"ctime":1655601041,"ip_address":"","comment_id":333134,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"vstr.FieldByName(k).Set(reflect.ValueOf(v))\næˆ‘åœ¨æ‰§è¡Œè¿™è¡Œè¯­å¥æŠ¥äº†panic\npanic: reflect: reflect.Value.Set using value obtained using unexported field\nè€å¸ˆåŒå­¦ä»¬èƒ½å¸®å¿™çœ‹ä¸‹è¿™ä¸ªæ˜¯ä¸ºå•¥å—","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576489,"discussion_content":"ä½ çš„Fieldçš„nameæ˜¯æ€æ ·çš„ï¼Œé¦–å­—æ¯å¤§å†™äº†å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655601041,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":287669,"user_name":"escray","can_delete":false,"product_type":"c3","uid":1020525,"ip_address":"","ucode":"1F4204930E47C4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","comment_is_top":false,"comment_ctime":1618099950,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"ä¸é…ç½®æœ‰å…³çš„ç¨‹åºï¼Œå¾ˆå¤šéƒ½å¯ä»¥ä½¿ç”¨åå°„æ¥å†™ï¼Œå…¶ä»–è¯­è¨€æˆ–è€…æ¡†æ¶ä¹Ÿç¡®å®æ˜¯è¿™ä¹ˆåšçš„ã€‚\n\nåœ¨æ€§èƒ½è¦æ±‚æ¯”è¾ƒé«˜çš„æ—¶å€™ï¼Œè¦æ³¨æ„åå°„çš„æ€§èƒ½ã€‚\n\nåå°„ä»£ç çš„å¯è¯»æ€§ä¹Ÿæ¯”è¾ƒå·®ï¼Œä»£ç çš„ debug éš¾åº¦ä¹Ÿä¼šå¢åŠ ã€‚\n\nçœ‹äº†ä¸€ä¸‹ç•™è¨€é‡Œé¢ @Geek_338030 å’Œè€å¸ˆå…³äº FieldByName çš„è®¨è®ºï¼Œä¸æ˜è§‰å‰ï¼Œå…ˆç•™ä¸ªå°è±¡ï¼Œä»¥åçœ‹åˆ°ç›¸å…³ä»£ç å†å›æ¥ã€‚","like_count":1},{"had_liked":false,"id":372933,"user_name":"Nemo","can_delete":false,"product_type":"c3","uid":1657039,"ip_address":"å¹¿ä¸œ","ucode":"2B11D18D6FA2AE","user_header":"https://static001.geekbang.org/account/avatar/00/19/48/cf/8c88e6c0.jpg","comment_is_top":false,"comment_ctime":1681820661,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"`reflect.DeepEqual`æ˜¯Goè¯­è¨€æ ‡å‡†åº“`reflect`åŒ…ä¸­æä¾›çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºæ·±åº¦æ¯”è¾ƒä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ã€‚åœ¨ä½¿ç”¨`DeepEqual`è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œå¦‚æœä¸¤ä¸ªå€¼çš„ç±»å‹ç›¸åŒï¼Œå°±ä¼šæ¯”è¾ƒå®ƒä»¬çš„å€¼ï¼›å¦‚æœç±»å‹ä¸åŒï¼Œåˆ™ç›´æ¥è¿”å›falseã€‚`DeepEqual`æ”¯æŒæ¯”è¾ƒå¤šç§ç±»å‹çš„å€¼ï¼ŒåŒ…æ‹¬å€¼ç±»å‹ã€ç»“æ„ä½“ã€åˆ‡ç‰‡ã€æ˜ å°„ã€æ¥å£ç­‰ã€‚`DeepEqual`ä¼šé€’å½’æ¯”è¾ƒæ¯ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ç›¸ç­‰çš„å€¼æˆ–è€…æ¯”è¾ƒå®Œæ‰€æœ‰çš„å€¼ä¸ºæ­¢ã€‚å¦‚æœæ¯”è¾ƒå®Œæ‰€æœ‰çš„å€¼éƒ½ç›¸ç­‰ï¼Œåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨`DeepEqual`è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œåº”è¯¥å°½å¯èƒ½ä½¿ç”¨ç›¸åŒç±»å‹çš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦åˆ™å¯èƒ½ä¼šå¾—åˆ°æ„æƒ³ä¸åˆ°çš„ç»“æœã€‚æ­¤å¤–ï¼Œ`DeepEqual`æ¯”è¾ƒå€¼æ—¶ï¼Œä¼šæ¯”è¾ƒæ‰€æœ‰çš„æˆå‘˜ï¼ŒåŒ…æ‹¬ç§æœ‰æˆå‘˜ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨`DeepEqual`è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œåº”è¯¥å°½é‡ä½¿ç”¨å…¬æœ‰æˆå‘˜ï¼Œæˆ–è€…è‡ªå®šä¹‰`Equal`æ–¹æ³•æ¥è¿›è¡Œæ¯”è¾ƒã€‚\n\nåœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†`DeepEqual`å‡½æ•°è¿›è¡Œäº†ä¸‰ç»„ä¸åŒç±»å‹çš„å€¼çš„æ¯”è¾ƒï¼Œåˆ†åˆ«æ˜¯ï¼š\n\n1. ä¸¤ä¸ªmapï¼Œå®ƒä»¬çš„é”®å’Œå€¼éƒ½æ˜¯intå’Œstringç±»å‹ï¼Œå†…å®¹ç›¸åŒï¼Œæ‰€ä»¥æ¯”è¾ƒç»“æœä¸ºtrueï¼›\n2. ä¸¤ä¸ªåˆ‡ç‰‡ï¼Œå®ƒä»¬çš„å…ƒç´ ç±»å‹éƒ½æ˜¯intï¼Œé•¿åº¦å’Œå†…å®¹éƒ½ç›¸åŒï¼Œæ‰€ä»¥æ¯”è¾ƒç»“æœä¸ºtrueï¼›\n3. ä¸¤ä¸ªè‡ªå®šä¹‰çš„Customerç»“æ„ä½“ï¼Œå®ƒä»¬çš„æˆå‘˜å˜é‡éƒ½ç›¸åŒï¼Œæ‰€ä»¥æ¯”è¾ƒç»“æœä¸ºtrueã€‚\n\næœ€åï¼Œæˆ‘ä»¬åœ¨è¿™æ®µä»£ç ä¸­ä¹Ÿå¯¹æ¯”è¾ƒæ“ä½œç¬¦`==`è¿›è¡Œäº†ä½¿ç”¨ï¼Œç”¨äºæ¯”è¾ƒä¸¤ä¸ªCustomerç»“æ„ä½“çš„å†…å®¹æ˜¯å¦ç›¸ç­‰ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå¯¹äºç»“æ„ä½“ç±»å‹ï¼Œä½¿ç”¨`==`è¿›è¡Œæ¯”è¾ƒæ—¶åªæœ‰æ‰€æœ‰æˆå‘˜éƒ½ç›¸ç­‰æ—¶æ‰ç›¸ç­‰ã€‚å¦‚æœç»“æ„ä½“ä¸­åŒ…å«æŒ‡é’ˆç±»å‹çš„æˆå‘˜å˜é‡ï¼Œé‚£ä¹ˆæ¯”è¾ƒæ—¶éœ€è¦ä¿è¯æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹ä¹Ÿç›¸ç­‰ã€‚å› æ­¤ï¼Œä½¿ç”¨`DeepEqual`å‡½æ•°è¿›è¡Œæ¯”è¾ƒæ›´ä¸ºä¿é™©å’Œå‡†ç¡®ã€‚","like_count":0},{"had_liked":false,"id":347239,"user_name":"Geek_a4cca6","can_delete":false,"product_type":"c3","uid":2136813,"ip_address":"","ucode":"68B3E4FDECFFF0","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/5GQZCecntmOibVjWkMWVnibqXEZhAYnFiaRkgfAUGdrQBWzfXjqsYteLee6afDEjvBLBVa5uvtWYTTicwO2jKia0zOw/132","comment_is_top":false,"comment_ctime":1653838512,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"è€å¸ˆï¼Œåå°„èƒ½åŠ¨æ€ç»™å®ä¾‹å¯¹è±¡æ·»åŠ å±æ€§å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":302609,"user_name":"Roy","can_delete":false,"product_type":"c3","uid":2633127,"ip_address":"","ucode":"2B1675B084D3A6","user_header":"https://static001.geekbang.org/account/avatar/00/28/2d/a7/c7b0c34e.jpg","comment_is_top":false,"comment_ctime":1626280632,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"è€å¸ˆï¼Œæˆ‘çœ‹ç€ä¸¤ä¸ªæ˜¯ç­‰ä»·çš„å†™æ³•ï¼Œæ‚¨çœ‹æ˜¯å—ï¼Ÿ\n\nreflect.ValueOf(st).Elem().Type.FieldByName(key)\nç­‰ä»·äº\nreflect.TypeOf(st).Elem().FieldByName(key)","like_count":0},{"had_liked":false,"id":302595,"user_name":"Roy","can_delete":false,"product_type":"c3","uid":2633127,"ip_address":"","ucode":"2B1675B084D3A6","user_header":"https://static001.geekbang.org/account/avatar/00/28/2d/a7/c7b0c34e.jpg","comment_is_top":false,"comment_ctime":1626274969,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"è®°å½•ä¸€ä¸‹è¾¹å­¦ç¼–å†™çš„ä»£ç ï¼š\npackage flexible_reflect\n\nimport (\n\t&quot;errors&quot;\n\t&quot;fmt&quot;\n\t&quot;reflect&quot;\n\t&quot;testing&quot;\n)\n\ntype Employee struct {\n\tEmployeeId int\n\tName string\n\tAge int\n}\n\ntype Customer struct {\n\tCustomerId int\n\tName string\n\tAge int\n}\n\n&#47;&#47;ç”¨åŒä¸€ä¸ªæ•°æ®å¡«å……ä¸åŒçš„ç»“æ„ä½“\n&#47;&#47;æ€è·¯ï¼šæ—¢ç„¶æ˜¯ä¸åŒçš„ç»“æ„ä½“ï¼Œé‚£ä¹ˆè¦æƒ³é€šç”¨ï¼Œæ‰€ä»¥å‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªç©ºæ¥å£æ‰è¡Œã€‚\n&#47;&#47;å› ä¸ºæ˜¯ç©ºæ¥å£ï¼Œæ‰€æœ‰æˆ‘ä»¬éœ€è¦å¯¹å‚æ•°ç±»å‹å†™æ–­è¨€\nfunc fillDifferentStructByData(st interface{}, data map[string]interface{}) error {\n\t&#47;&#47;å…ˆåˆ¤æ–­ä¼ è¿‡æ¥çš„ç±»å‹æ˜¯ä¸æ˜¯æŒ‡é’ˆ\n\tif reflect.TypeOf(st).Kind() != reflect.Ptr {\n\t\treturn errors.New(&quot;ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»ä¼ ä¸€ä¸ªæŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆ&quot;)\n\t}\n\t&#47;&#47;Elem() ç”¨æ¥è·å–æŒ‡é’ˆæŒ‡å‘çš„å€¼\n\t&#47;&#47;å¦‚æœå‚æ•°ä¸æ˜¯æŒ‡é’ˆï¼Œä¼šæŠ¥ panic é”™è¯¯\n\t&#47;&#47;å¦‚æœå‚æ•°å€¼æ˜¯ nil, è·å–çš„å€¼ä¸º 0\n\tif reflect.TypeOf(st).Elem().Kind() != reflect.Struct {\n\t\treturn errors.New(&quot;ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªç»“æ„ä½“ç±»å‹&quot;)\n\t}\n\n\tif data == nil {\n\t\treturn errors.New(&quot;å¡«å……ç”¨çš„æ•°æ®ä¸èƒ½ä¸ºnil&quot;)\n\t}\n\n\tvar (\n\t\tfield reflect.StructField\n\t\tok bool\n\t)\n\n\tfor key, val := range data  {\n\t\t&#47;&#47;å¦‚æœç»“æ„ä½“é‡Œé¢æ²¡æœ‰ key è¿™ä¸ªå­—æ®µï¼Œåˆ™è·³è¿‡\n\t\t&#47;&#47;reflect.ValueOf(st)).Elem().Type() è¿”å›çš„æ˜¯å­—æ®µç±»å‹\n\t\tif field, ok = reflect.ValueOf(st).Elem().Type().FieldByName(key); !ok {\n\t\t\tcontinue\n\t\t}\n\n\t\t&#47;&#47;å¦‚æœå­—æ®µçš„ç±»å‹ç›¸åŒï¼Œåˆ™ç”¨ data çš„æ•°æ®å¡«å……è¿™ä¸ªå­—æ®µçš„å€¼\n\t\tif field.Type == reflect.TypeOf(val) {\n\t\t\t&#47;&#47;reflect.ValueOf(st)).Elem() è¿”å›çš„æ˜¯å­—æ®µçš„å€¼\n\t\t\treflect.ValueOf(st).Elem().FieldByName(key).Set(reflect.ValueOf(val))\n\t\t}\n\t}\n\n\treturn nil\n}\n\n&#47;&#47;å¡«å……å§“åå’Œå¹´é¾„\nfunc TestFillNameAndAge(t *testing.T) {\n\t&#47;&#47;å£°æ˜ä¸€ä¸ª mapï¼Œç”¨æ¥å­˜æ”¾æ•°æ®ï¼Œè¿™äº›æ•°æ®å°†ä¼šå¡«å……åˆ° Employee å’Œ Customer è¿™ä¸¤ä¸ªç»“æ„ä½“ä¸­\n\tdata := map[string]interface{}{&quot;Name&quot;:&quot;Jane&quot;, &quot;Age&quot;:18}\n\n\te := Employee{}\n\tif err := fillDifferentStructByData(&amp;e, data); err != nil {\n\t\tt.Fatal(err)\n\t}\n\n\tc := Customer{}\n\tif err := fillDifferentStructByData(&amp;c, data); err != nil {\n\t\tt.Fatal(err)\n\t}\n\n\tfmt.Println(e, &quot;\\n&quot;, c)\n}\n&#47;*\n=== RUN   TestFillNameAndAge\n{0 Jane 18}\n{0 Jane 18}\n--- PASS: TestFillNameAndAge (0.00s)\nPASS\n*&#47;","like_count":0},{"had_liked":false,"id":135384,"user_name":"Geek_338030","can_delete":false,"product_type":"c3","uid":1614014,"ip_address":"","ucode":"6F2ACB3C528BAA","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/1ZcgbSZ1Q0eARic4sFq9PRO0rT55MAYUAcBVNK3dE6ficOQViblBlzUTnMJyK2bZbU3IsewnDxKD5Wtrq01DeHnWQ/132","comment_is_top":false,"comment_ctime":1569142998,"is_pvip":false,"replies":null,"discussion_count":2,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"éº»çƒ¦è€å¸ˆäº†ï¼Œä½†è¿˜æ˜¯æ²¡å¤ªæ‡‚è€å¸ˆå›å¤çš„ï¼Œæ—¢ç„¶fieldByName returnçš„æ˜¯struct fieldå’Œboolï¼Œé‚£ä¸ºä»€ä¹ˆä»¥ä¸‹çš„è¿™ä¸€è¡Œä»£ç è¿”å›çš„æ˜¯ä¸€ä¸ªkå¯¹åº”çš„å€¼å‘¢ï¼Ÿ \n(reflect.ValueOf(st)).Elem().FieldByName(k)\nè€ŒåŠ ä¸Šäº†Type,å³ï¼š(reflect.ValueOf(st)).Elem().Type().FieldByName(k) \nè¿”å›çš„å°±å˜æˆäº†æ˜¯struct field å’Œbooläº†\nè¿™æ˜¯ä¸ºä»€ä¹ˆ?\n\n","like_count":0,"discussions":[{"author":{"id":1199670,"avatar":"https://static001.geekbang.org/account/avatar/00/12/4e/36/de029ebf.jpg","nickname":"ğŸ¬Innocence","note":"","ucode":"7CBAB4976FACE0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":247839,"discussion_content":"è¿™ä¸¤ä¸ªç¨‹åºæ˜¯ç­‰ä»·çš„\n(reflect.TypeOf(st)).Elem().FieldByName(k) == (reflect.ValueOf(st)).Elem().FieldByName(k)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587826143,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1182219,"avatar":"https://static001.geekbang.org/account/avatar/00/12/0a/0b/985d3800.jpg","nickname":"éƒ­æ˜Ÿ","note":"","ucode":"8A0F5DF80E0C61","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1199670,"avatar":"https://static001.geekbang.org/account/avatar/00/12/4e/36/de029ebf.jpg","nickname":"ğŸ¬Innocence","note":"","ucode":"7CBAB4976FACE0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":292658,"discussion_content":"reflect.TypeOf å’Œ reflect.ValueOfé¦–å…ˆè¿™ä¸¤ä¸ªçš„å«ä¹‰å°±ä¸ç›¸åŒ, \nåœ¨æŒ‡é’ˆç»“æ„ä½“ä¸­åŒ…å«Typeå’ŒValue\nreflect.TypeOf å®é™…æ˜¯è·å–æŒ‡é’ˆç»“æ„ä¸­çš„Type,å› æ­¤(reflect.TypeOf(st)).Elem().FieldByName(k) è¿™é‡Œæ˜¯å¯¹å½“å‰æŒ‡é’ˆçš„Typeè¿›è¡Œæ“ä½œ\nreflect.ValueOfå®é™…æ˜¯è·å–æŒ‡é’ˆç»“æ„ä¸­çš„Value\n(reflect.TypeOf(st)).Elem().FieldByName(k) å’Œ (reflect.ValueOf(st)).Elem().FieldByName(k) è¿™ä¸¤è€…çš„è¿”å›å€¼æ˜¯ä¸åŒçš„,å› æ­¤ä¸æ˜¯ç­‰ä»·æ“ä½œ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1595298010,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":247839,"ip_address":"","group_id":0},"score":292658,"extra":""}]}]}]}