{"id":148188,"title":"42 | DHE/ECDHE算法的原理","content":"<p>你好，我是Chrono。</p><p>在<a href=\"https://time.geekbang.org/column/article/110354\">第26讲</a>里，我介绍了TLS 1.2的握手过程，在Client Hello和Server Hello里用到了ECDHE算法做密钥交换，参数完全公开，但却能够防止黑客攻击，算出只有通信双方才能知道的秘密Pre-Master。</p><p>这是TLS握手的关键步骤，也让很多同学不太理解，“为什么数据都是不保密的，但中间人却无法破解呢？”</p><p>解答这个问题必须要涉及密码学，我原本觉得有点太深了，不想展开细讲，但后来发现大家都对这个很关心，有点“打破砂锅问到底”的精神。所以，这次我就试着从底层来解释一下。不过你要有点心理准备，这不是那么好懂的。</p><p>先从ECDHE算法的名字说起。ECDHE就是“短暂-椭圆曲线-迪菲-赫尔曼”算法（ephemeral Elliptic Curve Diffie–Hellman），里面的关键字是“短暂”“椭圆曲线”和“迪菲-赫尔曼”，我先来讲“迪菲-赫尔曼”，也就是DH算法。</p><h2>离散对数</h2><p>DH算法是一种非对称加密算法，只能用于密钥交换，它的数学基础是“<strong>离散对数</strong>”（Discrete logarithm）。</p><p>那么，什么是离散对数呢？</p><p>上中学的时候我们都学过初等代数，知道指数和对数，指数就是幂运算，对数是指数的逆运算，是已知底数和真数（幂结果），反推出指数。</p><!-- [[[read_end]]] --><p>例如，如果以10作为底数，那么指数运算是y=10^x，对数运算是y=logx，100的对数是2（10^2=100，log100=2），2的对数是0.301（log2≈0.301）。</p><p>对数运算的域是实数，取值是连续的，而“离散对数”顾名思义，取值是不连续的，数值都是整数，但运算具有与实数对数相似的性质。</p><p>离散对数里的一个核心操作是模运算，也就是取余数（mod，在C、Java、Lua等语言里的操作符是“%”）。</p><p>假设有模数17，底数5，那么“5的3次方再对17取余数得6”（5 ^ 3 % 17 = 6）就是在离散整数域上的一次指数运算（5 ^ 3 (mod 17) = 6）。反过来，以5为底，17为模数，6的离散对数就是3（Ind(5, 6) = 3 ( mod 17)）。</p><p>这里的（17，5）是离散对数的公共参数，6是真数，3是对数。知道了对数，就可以用幂运算很容易地得到真数，但反过来，知道真数却很难推断出对数，于是就形成了一个“<strong>单向函数</strong>”。</p><p>在这个例子里，选择的模数17很小，使用穷举法从1到17暴力破解也能够计算得到6的离散对数是3。</p><p>但如果我们选择的是一个非常非常大的数，比如说是有1024位的超大素数，那么暴力破解的成本就非常高了，几乎没有什么有效的方法能够快速计算出离散对数，这就是DH算法的数学基础。</p><h2>DH算法</h2><p>知道了离散对数，我们来看DH算法，假设Alice和Bob约定使用DH算法来交换密钥。</p><p>基于离散对数，Alice和Bob需要首先确定模数和底数作为算法的参数，这两个参数是公开的，用P和G来代称，简单起见我们还是用17和5（P=17，G=5）。</p><p>然后Alice和Bob各自选择一个随机整数作为<strong>私钥</strong>（必须在1和P-2之间），严格保密。比如Alice选择a=10，Bob选择b=5。</p><p>有了DH的私钥，Alice和Bob再计算幂作为<strong>公钥</strong>，也就是A = (G ^ a % P) = 9，B = (G ^ b % P) = 14，这里的A和B完全可以公开，因为根据离散对数的原理，从真数反向计算对数a和b是非常困难的。</p><p>交换DH公钥之后，Alice手里有五个数：P=17，G=5，a=10，A=9，B=14，然后执行一个运算：(B ^ a % P)= 8。</p><p>因为离散对数的幂运算有交换律，B ^ a = (G ^ b ) ^ a = (G ^ a) ^ b = A ^ b，所以Bob计算A ^ b % P也会得到同样的结果8，这个就是Alice和Bob之间的共享秘密，可以作为会话密钥使用，也就是TLS里的Pre-Master。</p><p><img src=\"https://static001.geekbang.org/resource/image/4f/ef/4fd1b613d46334827b53a1f31fa4b3ef.png?wh=3875*2230\" alt=\"\"></p><p>那么黑客在这个密钥交换的通信过程中能否实现攻击呢？</p><p>整个通信过程中，Alice和Bob公开了4个信息：P、G、A、B，其中P、G是算法的参数，A和B是公钥，而a、b是各自秘密保管的私钥，无法获取，所以黑客只能从已知的P、G、A、B下手，计算9或14的离散对数。</p><p>由离散对数的性质就可以知道，如果P非常大，那么他很难在短时间里破解出私钥a、b，所以Alice和Bob的通信是安全的（但在本例中数字小，计算难度很低）。</p><p>实验环境的URI“/42-1”演示了这个简单DH密钥交换过程，可以用浏览器直接访问，命令行下也可以用“resty www/lua/42-1.lua”直接运行。</p><h2>DHE算法</h2><p>DH算法有两种实现形式，一种是已经被废弃的DH算法，也叫static DH算法，另一种是现在常用的DHE算法（有时候也叫EDH）。</p><p>static DH算法里有一方的私钥是静态的，通常是服务器方固定，即a不变。而另一方（也就是客户端）随机选择私钥，即b采用随机数。</p><p>于是DH交换密钥时就只有客户端的公钥会变，而服务器公钥不变，在长期通信时就增加了被破解的风险，使得拥有海量计算资源的攻击者获得了足够的时间，最终能够暴力破解出服务器私钥，然后计算得到所有的共享秘密Pre-Master，不具有“前向安全”。</p><p>而DHE算法的关键在于“E”表示的临时性上（ephemeral），每次交换密钥时双方的私钥都是随机选择、临时生成的，用完就扔掉，下次通信不会再使用，相当于“一次一密”。</p><p>所以，即使攻击者破解了某一次的私钥，其他通信过程的私钥仍然是安全的，不会被解密，实现了“前向安全”。</p><h2>ECDHE算法</h2><p>现在如果你理解了DHE，那么理解ECDHE也就不那么困难了。</p><p>ECDHE算法，就是把DHE算法里整数域的离散对数，替换成了椭圆曲线上的离散对数。</p><p><img src=\"https://static001.geekbang.org/resource/image/b4/ba/b452ceb3cbfc5c644a3053f2054b1aba.jpg?wh=1643*1493\" alt=\"\"></p><p>原来DHE算法里的是任意整数，而ECDHE则是把连续的椭圆曲线给“离散化”成整数，用椭圆曲线上的“<strong>倍运算</strong>”替换了DHE里的幂运算。</p><p>在ECDHE里，算法的公开参数是椭圆曲线C、基点G和模数P，私钥是倍数x，公钥是倍点xG，已知倍点xG要想计算出离散对数x是非常困难的。</p><p>在通信时Alice和Bob各自随机选择两个数字a和b作为私钥，计算A=aG、B=bG作为公钥，然后互相交换，用与DHE相同的算法，计算得到aB=abG=Ab，就是共享秘密Pre-Master。</p><p>因为椭圆曲线离散对数的计算难度比普通的离散对数更大，所以ECDHE的安全性比DHE还要高，更能够抵御黑客的攻击。</p><h2>思考题</h2><p>最后留一个思考题吧：为什么DH算法只能用于密钥交换，不能用于数字签名，如果你理解了DH算法的原理应该不难回答出来。</p><p><img src=\"https://static001.geekbang.org/resource/image/07/af/0773f7b9a098a64cdbe1bf2a666f87af.png?wh=1769*3085\" alt=\"\"></p><p></p>","comments":[{"had_liked":false,"id":194794,"user_name":"djfhchdh","can_delete":false,"product_type":"c1","uid":1484184,"ip_address":"","ucode":"E71D75328CE398","user_header":"https://static001.geekbang.org/account/avatar/00/16/a5/98/a65ff31a.jpg","comment_is_top":false,"comment_ctime":1585106653,"is_pvip":false,"replies":[{"id":"74109","content":"good。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1585115830,"ip_address":"","comment_id":194794,"utype":1}],"discussion_count":1,"race_medal":0,"score":"31649877725","product_id":100029001,"comment_content":"DH算法只能用于密钥的交换，没有原文、摘要这些参数，无法生成数字签名。","like_count":8,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488903,"discussion_content":"good。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585115830,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":140451,"user_name":"许童童","can_delete":false,"product_type":"c1","uid":1003005,"ip_address":"","ucode":"4B799C0C6BC678","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg","comment_is_top":false,"comment_ctime":1570947106,"is_pvip":false,"replies":[{"id":"54336","content":"有部分不太准确。<br><br>数字签名与证书没有直接关系。数字签名是对原文摘要的私钥加密，用对应的公钥解密后可以比对摘要，验证确实是私钥持有者做的加密，也就是签名。<br><br>证书是为了保证公钥不被伪造和有效性。<br><br>DH算法里没有原文、摘要这些参与者，所以无法生成签名。也就是说，给出一份文件或者摘要，dh算法无法对它进行任何操作。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1571015493,"ip_address":"","comment_id":140451,"utype":1}],"discussion_count":2,"race_medal":0,"score":"27340750882","product_id":100029001,"comment_content":"回答一下思考题：我觉得原因是,根据DH算法的原理，只能算出一个新的值出来用于交换密钥，而数字签名是需要解密数字证书得到数字签名，从而判断数字证书是否真实有效。DH是基于现有数据算出一个新值，公钥私钥算出的结果并不相同，RSA是对数据进行加解密。","like_count":6,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470395,"discussion_content":"有部分不太准确。\n\n数字签名与证书没有直接关系。数字签名是对原文摘要的私钥加密，用对应的公钥解密后可以比对摘要，验证确实是私钥持有者做的加密，也就是签名。\n\n证书是为了保证公钥不被伪造和有效性。\n\nDH算法里没有原文、摘要这些参与者，所以无法生成签名。也就是说，给出一份文件或者摘要，dh算法无法对它进行任何操作。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571015493,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1332557,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erbY9UsqHZhhVoI69yXNibBBg0TRdUVsKLMg2UZ1R3NJxXdMicqceI5yhdKZ5Ad6CJYO0XpFHlJzIYQ/132","nickname":"饭团","note":"","ucode":"E24F240CC91BE8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":32212,"discussion_content":"哈哈，确实是！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571016798,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":249919,"user_name":"Geek_78044b","can_delete":false,"product_type":"c1","uid":2172245,"ip_address":"","ucode":"28DA345B0C5D43","user_header":"","comment_is_top":false,"comment_ctime":1600852407,"is_pvip":false,"replies":[{"id":"91583","content":"如果用rsa算法，公钥加密pre-master，当然也是可以的，但这个不具有前向安全。国家级别的计算能力是有可能算出私钥的，这就会导致公钥加密的所有pre-master被解密，从而所有历史消息都被破解。可以参考安全篇对前向安全的解释。<br><br>而dhe和ecdhe不仅难以破解，而且密钥都是随机生成的，所以即使破解了也不影响其他消息的安全。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1600863382,"ip_address":"","comment_id":249919,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5895819703","product_id":100029001,"comment_content":"老师你好，有个疑问。握手过程中的第三个参数，pre-master为何要用用那么复杂的算法去避免破解呢？<br><br>我的理解是，第三个随机数是通过服务端的公钥加密后传输的，传递到服务端后，用服务端的私钥才能解密出来这个随机数。<br><br>黑客没有服务端的私钥，完全不可能破解pre-master的啊，为何要那么复杂的加密算法去生成这个pre-master？？？","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506061,"discussion_content":"如果用rsa算法，公钥加密pre-master，当然也是可以的，但这个不具有前向安全。国家级别的计算能力是有可能算出私钥的，这就会导致公钥加密的所有pre-master被解密，从而所有历史消息都被破解。可以参考安全篇对前向安全的解释。\n\n而dhe和ecdhe不仅难以破解，而且密钥都是随机生成的，所以即使破解了也不影响其他消息的安全。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600863382,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":176809,"user_name":"猫头鹰波波","can_delete":false,"product_type":"c1","uid":1019787,"ip_address":"","ucode":"573AC477FA869C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8f/8b/9080f1fa.jpg","comment_is_top":false,"comment_ctime":1581171718,"is_pvip":false,"replies":[{"id":"68624","content":"这是由椭圆曲线的特性决定的，具体的数学理论我也不是很了解，无法解释的更细。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1581206893,"ip_address":"","comment_id":176809,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5876139014","product_id":100029001,"comment_content":"老师，为什么ECDHE更难破解么，是因为离散的点选取更具备随机性吗","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483217,"discussion_content":"这是由椭圆曲线的特性决定的，具体的数学理论我也不是很了解，无法解释的更细。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581206893,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":176753,"user_name":"fxs007","can_delete":false,"product_type":"c1","uid":1346554,"ip_address":"","ucode":"78847ED5C33E9B","user_header":"https://static001.geekbang.org/account/avatar/00/14/8b/fa/90126961.jpg","comment_is_top":false,"comment_ctime":1581155076,"is_pvip":false,"replies":[{"id":"68626","content":"嗯，如果用变通的方法也是可以做到的，但意义不大，属于“曲线救国”。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1581207006,"ip_address":"","comment_id":176753,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5876122372","product_id":100029001,"comment_content":"刚才看了下RSA验证签名的过程(https:&#47;&#47;crypto.stackexchange.com&#47;questions&#47;12768&#47;why-hash-the-message-before-signing-it-with-rsa)，我觉得DH算法本身是可以用来验证数字签名。比如双方已经完成了DH秘钥交换过程，<br>签名方发送 text + DH-enc(sha256(text))，其中DH-enc(sha256(text))是对text进行hash算法然后DH加密<br>验证方 用DH-dec解密签名，然后和sha256(text)比较，相等就说明验证通过<br>只是DH一般用在双方确定身份以前，验证没有身份的签名并没有什么意义。","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483200,"discussion_content":"嗯，如果用变通的方法也是可以做到的，但意义不大，属于“曲线救国”。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581207006,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":351231,"user_name":"Geek_91cf3b","can_delete":false,"product_type":"c1","uid":2558989,"ip_address":"","ucode":"8B91B44AA99841","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83errj9iaMOHaUFf2XkdkMFU7kNnOiarW6bU8yggOzkJj4ncoqHXiaFwc8nosCdeSvfdeMfBpoVibO724ow/132","comment_is_top":false,"comment_ctime":1657624554,"is_pvip":false,"replies":[{"id":"127759","content":"PFS是什么？任何加密算法，理论上没有密钥都是不能解密的，但随着算力的提升，有的算法已经可以被破解了。","user_name":"作者回复","user_name_real":"编辑","uid":"1181974","ctime":1657675456,"ip_address":"","comment_id":351231,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1657624554","product_id":100029001,"comment_content":"老师，PFS报文能解密码？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579755,"discussion_content":"PFS是什么？任何加密算法，理论上没有密钥都是不能解密的，但随着算力的提升，有的算法已经可以被破解了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657675456,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":347222,"user_name":"GeekCoder","can_delete":false,"product_type":"c1","uid":1523315,"ip_address":"","ucode":"14BB73CBE28545","user_header":"","comment_is_top":false,"comment_ctime":1653826550,"is_pvip":false,"replies":[{"id":"126660","content":"DH是非对称算法，当然会有公钥和私钥的区别。","user_name":"作者回复","user_name_real":"编辑","uid":"1181974","ctime":1654061471,"ip_address":"","comment_id":347222,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1653826550","product_id":100029001,"comment_content":"也就是说DH算法中，也是有私钥的(私密部分)，而外部并不知道私钥。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":574431,"discussion_content":"DH是非对称算法，当然会有公钥和私钥的区别。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654061471,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":301736,"user_name":"Jasmine","can_delete":false,"product_type":"c1","uid":1585145,"ip_address":"","ucode":"E54999CC612A7C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIuTjCibv0afd7SSdLicfNk0f7KO5ga9VMleD1hc2DtQfianK20ht06SekClKV7M8UXLRHqQLm9hJ3ow/132","comment_is_top":false,"comment_ctime":1625824737,"is_pvip":false,"replies":[{"id":"109237","content":"这个是离散指数、对数在整数域的运算，不是普通的实数运算，可以照着正文里的例子再算一下。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1625889592,"ip_address":"","comment_id":301736,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1625824737","product_id":100029001,"comment_content":"老师，等式B ^ a = (G ^ b ) ^ a = (G ^ a) ^ b = A ^ b左右两边就算忽略mod17值也不相等啊，为什么说经过运算都等于8呢？实际应用计算的底数超级大，给定了算法，数字运算的结果还是固定的呀，哪怕差0.00001那pre-master也不相同啊。困惑ing","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523076,"discussion_content":"这个是离散指数、对数在整数域的运算，不是普通的实数运算，可以照着正文里的例子再算一下。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625889592,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":288156,"user_name":"张欣","can_delete":false,"product_type":"c1","uid":2448960,"ip_address":"","ucode":"557C42848C77E6","user_header":"https://static001.geekbang.org/account/avatar/00/25/5e/40/dee7906c.jpg","comment_is_top":false,"comment_ctime":1618324867,"is_pvip":false,"replies":[{"id":"104608","content":"理解有点偏差。<br><br>DH算法主要是用于密钥交换，生成的pre-master用来加密会话，一般不做签名验签。<br><br>签名算法常用的是RSA和ECDSA。<br><br>建议再回顾一下之前的课程，有不明白的或者我没说清楚的这问。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1618361874,"ip_address":"","comment_id":288156,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1618324867","product_id":100029001,"comment_content":"老师，不知道我理解的对不对：<br>根据文中以及之前tls文章的讲解，DH算法的主要目的就生成不可逆操作的公钥和私钥，然后再次执行算法生成两端相同的pre-master。这里面生成的公钥和私钥是可以拿来再次对文件摘要进行签名和验证，但是DH算法本身并没有这个作用。假设参数可以是文件摘要，就算算法能够算出，之后拿到证书的人也破解不开，根本没有意义。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518530,"discussion_content":"理解有点偏差。\n\nDH算法主要是用于密钥交换，生成的pre-master用来加密会话，一般不做签名验签。\n\n签名算法常用的是RSA和ECDSA。\n\n建议再回顾一下之前的课程，有不明白的或者我没说清楚的这问。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618361874,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2448960,"avatar":"https://static001.geekbang.org/account/avatar/00/25/5e/40/dee7906c.jpg","nickname":"张欣","note":"","ucode":"557C42848C77E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367633,"discussion_content":"多谢老师，我再回头看看。可能理解错了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618410758,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":272121,"user_name":"Ball","can_delete":false,"product_type":"c1","uid":1521451,"ip_address":"","ucode":"1EE949E68D84CA","user_header":"https://static001.geekbang.org/account/avatar/00/17/37/2b/b32f1d66.jpg","comment_is_top":false,"comment_ctime":1609940157,"is_pvip":false,"replies":[{"id":"98671","content":"先把dh理解了，然后dhe和ecdhe就好懂了。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1609981789,"ip_address":"","comment_id":272121,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1609940157","product_id":100029001,"comment_content":"原理完全没看懂，得花点时间消化一下了。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513164,"discussion_content":"先把dh理解了，然后dhe和ecdhe就好懂了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609981789,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":253422,"user_name":"久念","can_delete":false,"product_type":"c1","uid":1258101,"ip_address":"","ucode":"0C9D3C44D08493","user_header":"https://static001.geekbang.org/account/avatar/00/13/32/75/abbc6810.jpg","comment_is_top":false,"comment_ctime":1602733354,"is_pvip":false,"replies":[{"id":"92570","content":"是的，但这个的难度非常大。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1602745015,"ip_address":"","comment_id":253422,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1602733354","product_id":100029001,"comment_content":"老师好，”国家级别的计算能力是有可能算出私钥的“ -- 如果私钥是可以被算出来的，那 Root CA 对应的私钥也有可能被破解，这样的话 黑客是不是就可以随意的颁发证书","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":507066,"discussion_content":"是的，但这个的难度非常大。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602745015,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":194325,"user_name":"djfhchdh","can_delete":false,"product_type":"c1","uid":1484184,"ip_address":"","ucode":"E71D75328CE398","user_header":"https://static001.geekbang.org/account/avatar/00/16/a5/98/a65ff31a.jpg","comment_is_top":false,"comment_ctime":1585050568,"is_pvip":false,"replies":[{"id":"74075","content":"回答的不是太对，可参考其他同学的答案。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1585098158,"ip_address":"","comment_id":194325,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1585050568","product_id":100029001,"comment_content":"因为DH算法，由公钥反向计算私钥是非常难的。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488812,"discussion_content":"回答的不是太对，可参考其他同学的答案。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585098158,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":180976,"user_name":"子杨","can_delete":false,"product_type":"c1","uid":1236803,"ip_address":"","ucode":"EA7555EEE6DECE","user_header":"https://static001.geekbang.org/account/avatar/00/12/df/43/1aa8708a.jpg","comment_is_top":false,"comment_ctime":1582451777,"is_pvip":false,"replies":[{"id":"70241","content":"基本正确。<br><br>首先要理解公钥体系，理解签名。证书是为了安全可信地发布公钥。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1582507576,"ip_address":"","comment_id":180976,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1582451777","product_id":100029001,"comment_content":"对证书这块还是有点晕。证书应该只是用来证明站点的身份的吧？使用证书颁发机构的公钥对证书中的 hash 值进行解密，同时对 data 做 hash，如果相等就说明身份可信。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484873,"discussion_content":"基本正确。\n\n首先要理解公钥体系，理解签名。证书是为了安全可信地发布公钥。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582507576,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":180117,"user_name":"Hills录","can_delete":false,"product_type":"c1","uid":1000004,"ip_address":"","ucode":"779020947ACABA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/42/44/d3d67640.jpg","comment_is_top":false,"comment_ctime":1582191306,"is_pvip":false,"replies":[{"id":"69960","content":"注意DHE和DH还是有区别的，DHE里的公私钥对都是临时产生的，显然无法签名，因为私钥用完就丢弃了，不会被任何人持有。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1582197912,"ip_address":"","comment_id":180117,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1582191306","product_id":100029001,"comment_content":"DHE不能用于数字签名，是因为无法使用公钥验证私钥有效性","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484533,"discussion_content":"注意DHE和DH还是有区别的，DHE里的公私钥对都是临时产生的，显然无法签名，因为私钥用完就丢弃了，不会被任何人持有。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582197912,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1000004,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/44/d3d67640.jpg","nickname":"Hills录","note":"","ucode":"779020947ACABA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":187214,"discussion_content":"嗯，感谢老师","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582727927,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":143212,"user_name":"mark","can_delete":false,"product_type":"c1","uid":1566124,"ip_address":"","ucode":"59EE6EED0F06DD","user_header":"https://static001.geekbang.org/account/avatar/00/17/e5/ac/6c87d5ee.jpg","comment_is_top":false,"comment_ctime":1571649562,"is_pvip":false,"replies":[{"id":"55380","content":"DH算法只能用于密钥交换，这种思路有点接近DSA算法。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1571707110,"ip_address":"","comment_id":143212,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1571649562","product_id":100029001,"comment_content":"DH算法是选择一个数字作为私钥，hash好像不可逆，如果类似hash这样的算法，生成一个整数，是不是就可以用DH算法加密文本了。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471423,"discussion_content":"DH算法只能用于密钥交换，这种思路有点接近DSA算法。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571707110,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":140070,"user_name":"饭团","can_delete":false,"product_type":"c1","uid":1332557,"ip_address":"","ucode":"E24F240CC91BE8","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erbY9UsqHZhhVoI69yXNibBBg0TRdUVsKLMg2UZ1R3NJxXdMicqceI5yhdKZ5Ad6CJYO0XpFHlJzIYQ/132","comment_is_top":false,"comment_ctime":1570802053,"is_pvip":false,"replies":[{"id":"54186","content":"不是，可以再看一下dh算法的过程，它不能对一段文本的摘要做加密，无法生成签名，只能双方交换得到共享秘密。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1570841627,"ip_address":"","comment_id":140070,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1570802053","product_id":100029001,"comment_content":"老师问题是不是是因为DH算法是动态的！即2个参数是相辅相成的，而数字签名中，公钥是不变的！","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470231,"discussion_content":"不是，可以再看一下dh算法的过程，它不能对一段文本的摘要做加密，无法生成签名，只能双方交换得到共享秘密。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570841627,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":30812,"discussion_content":"理解还有点偏差，所有的rsa、dh、ecc都是算法，但dh算法的特性决定了它不能生成签名。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570860951,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1332557,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erbY9UsqHZhhVoI69yXNibBBg0TRdUVsKLMg2UZ1R3NJxXdMicqceI5yhdKZ5Ad6CJYO0XpFHlJzIYQ/132","nickname":"饭团","note":"","ucode":"E24F240CC91BE8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":30533,"discussion_content":"对哦！他是一个算法！不是用来做加密的！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570841725,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":140068,"user_name":"饭团","can_delete":false,"product_type":"c1","uid":1332557,"ip_address":"","ucode":"E24F240CC91BE8","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erbY9UsqHZhhVoI69yXNibBBg0TRdUVsKLMg2UZ1R3NJxXdMicqceI5yhdKZ5Ad6CJYO0XpFHlJzIYQ/132","comment_is_top":false,"comment_ctime":1570801427,"is_pvip":false,"replies":[{"id":"54185","content":"是啊，好像缺少这个更新通知的功能。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1570841555,"ip_address":"","comment_id":140068,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1570801427","product_id":100029001,"comment_content":"真棒老师，估计好多同学都不知道您更新了！谢谢您了！","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470229,"discussion_content":"是啊，好像缺少这个更新通知的功能。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570841555,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1008348,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/dc/8876c73b.jpg","nickname":"moooofly","note":"","ucode":"4A20795C281B6F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":32302,"discussion_content":"会有更新推送通知的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571023060,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}