{"id":292899,"title":"国庆策划 | 深度学习推荐系统基础，你掌握了多少？","content":"<p>你好，我是王喆。</p><p>今天是国庆假期的第二天，我在基础架构篇的基础上，设计了一套测试题，希望你能在假期里试做一下，温故知新，巩固所学。</p><p>在这套测试题中，有 10 道选择题，每道题 10 分，满分为 100。这些内容全部来自我们之前专栏所讲的内容，都是基础知识，希望能帮助你查缺补漏。</p><p>最后呢，我还为你准备了两道实践题，这两道题为选做。如果你对自己有更高的要求，我希望你可以show me the code！当然，在答题和实践中遇到任何问题，都可以在留言区评论，我们一起来探讨。还等什么，点击下面的按钮开始测试吧！</p><h2>选择题</h2><p><a href=\"http://time.geekbang.org/quiz/intro?act_id=216&exam_id=666\"><img src=\"https://static001.geekbang.org/resource/image/28/a4/28d1be62669b4f3cc01c36466bf811a4.png?wh=1142*201\" alt=\"\"></a></p><h2>问答题</h2><p>第一题：通过阅读SparrowRecSys的代码，你能找到首页中每行内部的电影都是按照什么排序的吗？</p><p>第二道题：如果你已经发现了排序的规则，你能在推荐服务器的代码里添加一个叫“热度”（popularity）的排序规则，然后让首页按照“热度”排序吗（💡补充：热度的定义是“这个电影被评价的次数”）？</p><p>我相信这是熟悉movielens数据、推荐服务器代码的一个非常好的机会，那在实现过程中的任何问题，都欢迎你留言和我交流！我们10月9日再见！</p><!-- [[[read_end]]] -->","comments":[{"had_liked":false,"id":263702,"user_name":"神经蛙","can_delete":false,"product_type":"c1","uid":2242137,"ip_address":"","ucode":"9375BA98E03A8D","user_header":"https://static001.geekbang.org/account/avatar/00/22/36/59/010b3e60.jpg","comment_is_top":false,"comment_ctime":1606223394,"is_pvip":false,"replies":[{"id":"95680","content":"非常好。前端展示代码不用修改，修改js就可以了。","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1606246195,"ip_address":"","comment_id":263702,"utype":1}],"discussion_count":2,"race_medal":0,"score":"100390471202","product_id":100060801,"comment_content":"课后题：<br>1.排序依据：<br>\t根据影片历史平均评分，降序排列。详细调用过程：<br>\ta.index.html里面的js代码，调用在头部加载的recsys.js 的addGenreRow, 传入参数(页面ID,影片类别名称,rowId, 每行放置影片个数,baseUrl)<br>\tb.在addGenreRow调用已注册的 getrecommendation 服务，传参的排序依据为rating.<br>\tc.服务getrecommendation绑定类RecommendationService, GET请求数据<br>\td.RecommendationService.doGet 中 调用 online.datamanager.DataManager#getMoviesByGenre,根据每个影片的历史平均rating,降序排列.<br>2.根据popularity排序:<br>\ta.recsys.js<br>\t\tfunction addGenreRow(pageId, rowName, rowId, size, baseUrl) {<br>\t\t    addRowFrame(pageId, rowName, rowId, baseUrl);<br>\t\t    $.getJSON(baseUrl + &quot;getrecommendation?genre=&quot;+rowName+&quot;&amp;size=&quot;+size+&quot;&amp;sortby=popularity&quot;, function(result){<br>\t\t        $.each(result, function(i, movie){<br>\t\t          appendMovie2Row(rowId, movie.title, movie.movieId, movie.releaseYear, movie.averageRating.toPrecision(2), movie.ratingNumber, movie.genres,baseUrl);<br>\t\t        });<br>\t\t    });<br>\t\t};<br>\tb.com.wzhe.sparrowrecsys.online.datamanager.DataManager#getMoviesByGenre:<br>\t\t添加一行：<br>\t\tcase &quot;popularity&quot;: movies.sort((m1, m2) -&gt; Integer.compare(m2.getRatingNumber(), m1.getRatingNumber()));break;<br><br>\t\t用mmovie.getRatings.size() 也行，但应该效率比上面的低。<br>\tc.改改前端的展示代码<br>\t\t不太擅长","like_count":24,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510275,"discussion_content":"非常好。前端展示代码不用修改，修改js就可以了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606246195,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2871311,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/d0/0f/734237b0.jpg","nickname":"Ramona","note":"","ucode":"C81B8CA448E1A4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557187,"discussion_content":"请问照着修改以后，为什么首页的推荐顺序没有改变呀？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647683769,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":290507,"user_name":"Sean","can_delete":false,"product_type":"c1","uid":2598647,"ip_address":"","ucode":"E35C2300971FA2","user_header":"https://static001.geekbang.org/account/avatar/00/27/a6/f7/e434c375.jpg","comment_is_top":false,"comment_ctime":1619596368,"is_pvip":false,"replies":[{"id":"105354","content":"赞","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1619729695,"ip_address":"","comment_id":290507,"utype":1}],"discussion_count":2,"race_medal":0,"score":"35979334736","product_id":100060801,"comment_content":"第一题<br>是根据电影的分数(rating)排序的<br><br>第二题<br>1. 先从RecSysServer.java进入，找到68行的RecommendationService<br>2. 再看到getMoviesByGenre.java第35行的getMoviesByGenre()<br>3. 在switch中新增: case &quot;popularity&quot;: movies.sort((m1, m2) -&gt; Integer.compare(m2.getRatingNumber(), m1.getRatingNumber()));break; 就是按照热度排序了<br>4. 再回到RecommendationService的33行， String sortby = request.getParameter(&quot;sortby&quot;); 代表排序依据的参数是由某个api传入的<br>5. 找到recsys.js第102行，把sortby=rating修改为sortby=popularity即可：$.getJSON(baseUrl + &quot;getrecommendation?genre=&quot;+rowName+&quot;&amp;size=&quot;+size+&quot;&amp;sortby=popularity&quot;, function(result)","like_count":9,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519221,"discussion_content":"赞","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619729695,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2735741,"avatar":"https://static001.geekbang.org/account/avatar/00/29/be/7d/33f732f3.jpg","nickname":"Lennon.Lau","note":"","ucode":"515CD55F5E37D2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582079,"discussion_content":"棒！mark一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659183564,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":252057,"user_name":"朱月俊","can_delete":false,"product_type":"c1","uid":1017707,"ip_address":"","ucode":"4DA0728B862FBD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/6b/0b6cd39a.jpg","comment_is_top":false,"comment_ctime":1602081408,"is_pvip":false,"replies":[{"id":"92247","content":"关注一下addGenereRow方法中的sortby参数<br>$.getJSON(baseUrl + &quot;getrecommendation?genre=&quot;+rowName+&quot;&amp;size=&quot;+size+&quot;&amp;sortby=rating&quot;","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1602399613,"ip_address":"","comment_id":252057,"utype":1}],"discussion_count":1,"race_medal":0,"score":"35961819776","product_id":100060801,"comment_content":"先说一下每一种类型的电影是如何排名的：<br>默认是按照打分平均分数以及发布时间排名，在recsys.js中的addGenereRow处指定排名的方式。<br>如何新增排名算法，比如增加热度这个指标？<br>需要在DataManager中照葫芦画瓢增加ratingNumber，然后在js中指定一下即可。<br><br>还在研究的问题：首页是如何调用getrecommendation接口以及如何传入参数的。麻烦老师指教一下。","like_count":8,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506702,"discussion_content":"关注一下addGenereRow方法中的sortby参数\n$.getJSON(baseUrl + &amp;quot;getrecommendation?genre=&amp;quot;+rowName+&amp;quot;&amp;amp;size=&amp;quot;+size+&amp;quot;&amp;amp;sortby=rating&amp;quot;","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602399613,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":251814,"user_name":"ALAN","can_delete":false,"product_type":"c1","uid":1240164,"ip_address":"","ucode":"70E3B1C730E63F","user_header":"https://static001.geekbang.org/account/avatar/00/12/ec/64/7403c694.jpg","comment_is_top":false,"comment_ctime":1601886506,"is_pvip":false,"replies":[{"id":"92249","content":"是的，如果需要看到效果的话，还需要修改一些recsys.js中相关的js代码","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1602399721,"ip_address":"","comment_id":251814,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14486788394","product_id":100060801,"comment_content":"问题一：按电影的平均打分从高到低排序<br>问题二：修改DataManager.java中221行代码。将compara函数中参数getAverageRating函数改成getRatingNumber函数","like_count":3,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506623,"discussion_content":"是的，如果需要看到效果的话，还需要修改一些recsys.js中相关的js代码","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602399721,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":277238,"user_name":"Kepler","can_delete":false,"product_type":"c1","uid":1877078,"ip_address":"","ucode":"C69A3248FB1AF6","user_header":"https://static001.geekbang.org/account/avatar/00/1c/a4/56/29a05cb2.jpg","comment_is_top":false,"comment_ctime":1612325798,"is_pvip":false,"replies":[{"id":"100614","content":"非常好 改js版本可是避免很多缓存问题","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1612361233,"ip_address":"","comment_id":277238,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10202260390","product_id":100060801,"comment_content":"问题：如果修改js及对应的RecommendationService后，主页仍未显示排序效果<br>解决：<br>方式1. 拉新github（推荐，避免后续有什么其他问题）<br>方式2. 修改index.html的&lt;script src=&quot;.&#47;js&#47;recsys.js&quot;&gt;&lt;&#47;script&gt;，原加载js文件为recsys.js?v=1.19","like_count":3,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514968,"discussion_content":"非常好 改js版本可是避免很多缓存问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612361233,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":252933,"user_name":"大钰儿","can_delete":false,"product_type":"c1","uid":1193551,"ip_address":"","ucode":"3E632100FAC52B","user_header":"https://static001.geekbang.org/account/avatar/00/12/36/4f/455ec47f.jpg","comment_is_top":false,"comment_ctime":1602518814,"is_pvip":false,"replies":[{"id":"92473","content":"good point，已经改回了默认从file load数据","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1602634024,"ip_address":"","comment_id":252933,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10192453406","product_id":100060801,"comment_content":"今天拉的主干代码，默认用了redis载入embedding导致无法启动，是不是需要改一下😅","like_count":2,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506920,"discussion_content":"good point，已经改回了默认从file load数据","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602634024,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":251535,"user_name":"金鹏","can_delete":false,"product_type":"c1","uid":1019485,"ip_address":"","ucode":"916180E1699264","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8e/5d/562e90d6.jpg","comment_is_top":false,"comment_ctime":1601648246,"is_pvip":false,"replies":[{"id":"91979","content":"赞。<br><br>要真正更改排序的方法，还需要修改一下前端js的一些条件。","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1601678922,"ip_address":"","comment_id":251535,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10191582838","product_id":100060801,"comment_content":"问题一：<br>首页每行（一个类别）按电影的AverageRating平均打分从高到低做为排序依据；<br><br>问题二：<br>public List&lt;Movie&gt; getMoviesByGenre(String genre, int size, String sortBy){<br>        if (null != genre){<br>            List&lt;Movie&gt; movies = new ArrayList&lt;&gt;(this.genreReverseIndexMap.get(genre));<br>            switch (sortBy){<br>                case &quot;rating&quot;:movies.sort((m1, m2) -&gt; Double.compare(m2.getAverageRating(), m1.getAverageRating()));break;<br>                case &quot;releaseYear&quot;: movies.sort((m1, m2) -&gt; Integer.compare(m2.getReleaseYear(), m1.getReleaseYear()));break;<br>                case &quot;popularity&quot;:movies.sort((m1, m2) -&gt; Integer.compare(m2.getRatingNumber(), m1.getRatingNumber()));break;<br>                default:<br>            }<br>........","like_count":2,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506534,"discussion_content":"赞。\n\n要真正更改排序的方法，还需要修改一下前端js的一些条件。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601678922,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2207948,"avatar":"","nickname":"Geek_songjian","note":"","ucode":"4A07D79B6D885F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":310831,"discussion_content":"前端的话，给function addGenreRow(pageId, rowName, rowId, size, baseUrl,sortBy) 增加一个sortBy参数，为了配合html上可能增加的排序按钮：\n $.getJSON(baseUrl + &#34;getrecommendation?genre=&#34;+rowName+&#34;&amp;size=&#34;+size+&#34;&amp;sortby=&#34;+sortBy,\n ...","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1602069233,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314657,"user_name":"闫阿佳需要学习","can_delete":false,"product_type":"c1","uid":1521723,"ip_address":"","ucode":"4993DCDE9B7CE4","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epb9FCKSLYGUXxkYv4o1JMzES9Uia8rjbwwbR942y1lU2kKU3PGEaUmQ9icgl6lU8qZRb9yhic3DpZrQ/132","comment_is_top":false,"comment_ctime":1633307036,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5928274332","product_id":100060801,"comment_content":"修改index.html的&lt;script src=&quot;.&#47;js&#47;recsys.js&quot;&gt;&lt;&#47;script&gt; 没有起作用，最后还是清楚缓存重新加载后显示的<br>步骤：（chrome）F12-&gt;勾选&quot; Disable cache&quot; -&gt; 刷新","like_count":1},{"had_liked":false,"id":272010,"user_name":"轩","can_delete":false,"product_type":"c1","uid":2405529,"ip_address":"","ucode":"454CC1A0734A4C","user_header":"https://static001.geekbang.org/account/avatar/00/24/b4/99/79a21147.jpg","comment_is_top":false,"comment_ctime":1609909222,"is_pvip":false,"replies":[{"id":"98660","content":"这样理解也没有错。原题选项D是<br>“推荐系统可利用的特征发生了根本性的变化”，我的本意是推荐系统可利用的特征原数据其实没有变化，只是处理特征的方式发生了根本性的改变。<br><br>只是一道选择题，大家理解知识就好，不用解决于说法。","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1609956630,"ip_address":"","comment_id":272010,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5904876518","product_id":100060801,"comment_content":"课后选择题习题第二题：感觉选项D其实也是深度学习带来的重要变革。<br>推荐系统是连接人与物的，那么如何表示和编码人与物就是非常重要的，毕竟只有更好的认知，才能带来更好的连接，深度学习带来的表示学习我觉的能算是重要变革吧？虽然非深度学习时代的矩阵分解等得到的latent vector也算是embedding吧，但和如今万物皆可embedding，应该算是个重要变革？","like_count":1,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513118,"discussion_content":"这样理解也没有错。原题选项D是\n“推荐系统可利用的特征发生了根本性的变化”，我的本意是推荐系统可利用的特征原数据其实没有变化，只是处理特征的方式发生了根本性的改变。\n\n只是一道选择题，大家理解知识就好，不用解决于说法。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609956630,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":335680,"user_name":"yangchao","can_delete":false,"product_type":"c1","uid":1009560,"ip_address":"","ucode":"41843ED0856819","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/98/d5e08eb7.jpg","comment_is_top":false,"comment_ctime":1645624077,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1645624077","product_id":100060801,"comment_content":"思考题<br>1.首页中每行内部的电影都是按照rating即评分进行排序的<br><br>2.首先修改DataManager类下的getMoviesByGenre:<br>case &quot;popularity&quot;: movies.sort((m1, m2) -&gt; Integer.compare(m2.getRatingNumber(), m1.getRatingNumber()));break;<br><br>然后在recsys.js里新增方法：<br>function addGenreRowByPopularitySort(pageId, rowName, rowId, size, baseUrl) {<br>     addRowFrame(pageId, rowName, rowId, baseUrl);<br>     $.getJSON(baseUrl + &quot;getrecommendation?genre=&quot;+rowName+&quot;&amp;size=&quot;+size+&quot;&amp;sortby=popularity&quot;, function(result){<br>         $.each(result, function(i, movie){<br>             appendMovie2Row(rowId, movie.title, movie.movieId, movie.releaseYear, movie.averageRating.toPrecision(2), movie.ratingNumber, movie.genres,baseUrl);<br>         });<br>     });<br> };<br><br>最后在index.html里 将所有 addGenreRow替换为addGenreRowByPopularitySort<br><br>最后重新编译重启go即可<br>","like_count":0},{"had_liked":false,"id":335644,"user_name":"yangchao","can_delete":false,"product_type":"c1","uid":1009560,"ip_address":"","ucode":"41843ED0856819","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/98/d5e08eb7.jpg","comment_is_top":false,"comment_ctime":1645611628,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1645611628","product_id":100060801,"comment_content":"考试结果：<br>https:&#47;&#47;time.geekbang.org&#47;quiz&#47;?act_id=216&amp;exam_id=666&amp;source=1009560","like_count":0},{"had_liked":false,"id":332013,"user_name":"Geek_0ea2ff","can_delete":false,"product_type":"c1","uid":2350339,"ip_address":"","ucode":"1490D985225CF5","user_header":"","comment_is_top":false,"comment_ctime":1642983082,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1642983082","product_id":100060801,"comment_content":"第二题，修改成按Popularity排序，跑出来的结果不对，同类型电影没有按ratingNumber降序展示。","like_count":0},{"had_liked":false,"id":323759,"user_name":"VICTOR","can_delete":false,"product_type":"c1","uid":2735716,"ip_address":"","ucode":"2EB9D8E02F2ED8","user_header":"https://static001.geekbang.org/account/avatar/00/29/be/64/f01a091c.jpg","comment_is_top":false,"comment_ctime":1638153388,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638153388","product_id":100060801,"comment_content":"针对修改完后前端没有现实的原因，可能是因为js缓存的原因，尝试Win: Ctrl+Shift+R &#47; Mac OS: Cmd+Shft+R 强制刷新缓存进行刷新","like_count":1},{"had_liked":false,"id":321324,"user_name":"土豆是天使","can_delete":false,"product_type":"c1","uid":2829519,"ip_address":"","ucode":"ADB871E256F540","user_header":"https://static001.geekbang.org/account/avatar/00/2b/2c/cf/9e727fa2.jpg","comment_is_top":false,"comment_ctime":1636792666,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636792666","product_id":100060801,"comment_content":"老师，按照别的同学说的改了代码，也按照不能显示的方法试了，排序结果还是和之前一样","like_count":0},{"had_liked":false,"id":305764,"user_name":"Geek_8a732a","can_delete":false,"product_type":"c1","uid":2723806,"ip_address":"","ucode":"97A312D97F7B91","user_header":"","comment_is_top":false,"comment_ctime":1628152406,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1628152406","product_id":100060801,"comment_content":"1、按照电影平均历史评分进行排序<br><br>2、RecSysServer.java的68行找到RecommendationService()，进入后找到35行getMoviesByGenre，再进入后，在switch里新增 case &quot;popularity&quot;: movies.sort((m1,m2) -&gt; Integer.compare(m2.getRatingNumber(),m1.getRatingNumber()));break;<br><br>3、回到RecommendationService.java中找到 <br>&#47;&#47;ranking algorithm<br>String sortby = request.getParameter(&quot;sortby&quot;);<br>选中sortby，右键find in files，<br>找到<br>$.getJSON(baseUrl + &quot;getrecommendation?genre=&quot;+rowName+&quot;&amp;size=&quot;+size+&quot;&amp;sortby=rating&quot;, function(result)<br>将其中的sortby=rating，改成sortby=popularity<br><br>4、为看显示效果，参考了Kelper的“ 修改index.html的&lt;script src=&quot;.&#47;js&#47;recsys.js&quot;&gt;&lt;&#47;script&gt;，原加载js文件为recsys.js?v=1.19”，然后重新run RecSysServer.java就可以了","like_count":0},{"had_liked":false,"id":305278,"user_name":"me_hu","can_delete":false,"product_type":"c1","uid":1029258,"ip_address":"","ucode":"0D23A362D1A4B1","user_header":"","comment_is_top":false,"comment_ctime":1627900614,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627900614","product_id":100060801,"comment_content":"1. 按照电影评分排序<br>2. a. 修改recsys.js, sortby=rating 改为 sortby=popularity<br>    b. DataManager.getMoviesByGenre方法增加 case popularity, 按照 ratingNumber排序","like_count":0},{"had_liked":false,"id":302299,"user_name":"82","can_delete":false,"product_type":"c1","uid":1716424,"ip_address":"","ucode":"C729C422DFE462","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqHa1TniaV1VibauX4iayvICUiclCibKCt9DwCM0jr3FE73mOMfHfAT5250c9JE6YBQbYnnib7dv1d52bpQ/132","comment_is_top":false,"comment_ctime":1626159185,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1626159185","product_id":100060801,"comment_content":"还有跟中代码的main启动方法 没看到，深度学习的引擎起起来啊？这块代码在哪里起的？","like_count":0},{"had_liked":false,"id":302244,"user_name":"82","can_delete":false,"product_type":"c1","uid":1716424,"ip_address":"","ucode":"C729C422DFE462","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqHa1TniaV1VibauX4iayvICUiclCibKCt9DwCM0jr3FE73mOMfHfAT5250c9JE6YBQbYnnib7dv1d52bpQ/132","comment_is_top":false,"comment_ctime":1626145224,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1626145224","product_id":100060801,"comment_content":"public static double calculateSimilarScore(Movie movie, Movie candidate){<br>        int sameGenreCount = 0;<br>        for (String genre : movie.getGenres()){<br>            if (candidate.getGenres().contains(genre)){<br>                sameGenreCount++;<br>            }<br>        }<br>        double genreSimilarity = (double)sameGenreCount &#47; (movie.getGenres().size() + candidate.getGenres().size()) &#47; 2;<br>        double ratingScore = candidate.getAverageRating() &#47; 5;<br><br>        double similarityWeight = 0.7;<br>        double ratingScoreWeight = 0.3;<br><br>        return genreSimilarity * similarityWeight + ratingScore * ratingScoreWeight;<br>    }<br><br>上面这个是干嘛的啊？","like_count":0},{"had_liked":false,"id":295409,"user_name":"老叔叔安森","can_delete":false,"product_type":"c1","uid":1461122,"ip_address":"","ucode":"EF61ACAC9A44FE","user_header":"https://static001.geekbang.org/account/avatar/00/16/4b/82/5be29abf.jpg","comment_is_top":false,"comment_ctime":1622420946,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622420946","product_id":100060801,"comment_content":"1、默认是按照每个类别的影片的历史平均评分，在类别内排序。<br>2、在DataManager类的GetMovieByGenre中增加多一个判断：case &quot;popularity&quot;:movies.sort((m1, m2) -&gt; Integer.compare(m2.getRatingNumber(), m1.getRatingNumber()));break;<br>并修改index.html源码中js的sortby传参为popularity","like_count":0}]}