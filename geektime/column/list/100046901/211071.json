{"id":211071,"title":"06 | 云上虚拟网络：开合有度，编织无形之网","content":"<p>你好，我是何恺铎。</p><p>我们对于IaaS的介绍已经渐入佳境了。前面，我们主要涉及了与云虚拟机相关的计算和存储方面的内容。今天这一讲，我想要和你讨论的，则是“计算/存储/网络”三要素中的最后一项：<strong>网络</strong>。</p><p>在互联网时代，网络的重要性不言而喻，我们必须好好掌握。通过合理的网络拓扑设置，既能够帮助我们实现架构上的隔离性和安全性，又能够让各组件互联互通、有序配合。</p><p>不过网络对于许多开发者而言，有时会让人感觉是一个挺困难的话题。它复杂的设置、晦涩的术语，尤其是各种连而不通的场景，可能让你望而生畏。</p><p>请你不要担心，云上的网络经过了一定程度的抽象以后，已经为我们屏蔽了一定的复杂度。只要宏观的思路梳理得足够清晰，你很快就能够理解云上的网络组件，并让它们听你指挥、投入使用。</p><h2>什么是虚拟私有网络？</h2><p>虚拟私有网络（Virtual Private Cloud，简称VPC），是云计算网络端最重要的概念之一，它是指构建在云上的、相互隔离的、用户可以自主控制的私有网络环境。虚拟私有网络有时也称为专有网络（阿里云）或虚拟网络（Virtual Network或VNet，Azure的叫法）。</p><p>上面的概念解释也许不太好理解，其实用通俗的话来讲，<strong>私有网络就是一张属于你自己的内网。</strong>内网之内的服务器和设备，可以比较自由地互相通信，与外界默认是隔离的。如果外部互联网，或者其他虚拟网络需要连接，则需要额外的配置。</p><!-- [[[read_end]]] --><p>所以说，虚拟私有网络，就是你在云上的保护网，能够有效地保护网内的各种设施。有的时候，你可能还要同时创建多个虚拟网络，让它们各司其职，实现更精细的隔离。</p><p><span class=\"reference\">小提示：在一些云上，除了私有网络，你可能还会看到“经典网络”的选项。这是上一代的云上内网基础设施，虽然它配置起来相对简单，但在隔离性、可配置性上有许多局限。现在已不推荐使用了。</span></p><p>虚拟私有网络麻雀虽小，但五脏俱全。在传统数据中心里，经典网络架构中的概念和组件，在虚拟网络中你几乎都能找到对应。这里比较重要的一些概念包括：</p><ul>\n<li><strong>网段</strong>，私有网络的内部IP区段，通常用CIDR形式来表达，如192.168.0.0/16。</li>\n<li><strong>子网</strong>，私有网络的下级网络结构，一个私有网络可以划分多个子网，这和通常意义上的子网也是对应和一致的。阿里云中把子网形象地称为“交换机”。</li>\n<li><strong>路由表</strong>，用于定义私有网络内流量的路由规则，决定着数据包的“下一跳”去向何方。每个子网都必须有一张关联的路由表，通常情况下，系统会自动帮你创建一个默认的路由表。</li>\n<li><strong>网关</strong>，是对进出私有网络的流量进行把守和分发的重要节点，根据用途的不同，有多种类型，后面我们还会讲到。</li>\n<li><strong>安全组</strong>，私有网络里虚拟机进出流量的通行或拦截规则，可以起到虚拟机网络防火墙的作用，我们曾经在<a href=\"https://time.geekbang.org/column/article/206296\">第2讲</a>中提到过它。</li>\n</ul><p>所以在创建虚拟网络时，你就需要对上面这些重要属性进行按需设定。</p><p>下面，我就以<strong>阿里云VPC</strong>为例，来带你实际操作体验一下。</p><p>首先，我们来到阿里云的专有网络管理控制台，选择新建一个VPC，这里的<strong>网段</strong>我们选择<strong>192.168.0.0/16</strong>：</p><p><img src=\"https://static001.geekbang.org/resource/image/2d/87/2d755b5f2574da9c9608c20091680187.jpg?wh=476*488\" alt=\"\"></p><p><span class=\"reference\">注意：VPC属于局域网，按照RFC规范，能够使用的IPv4区段必须为192.168.0.0/16、172.16.0.0/12、10.0.0.0/8这三个或它们的子集。</span></p><p>同时，我们还<strong>至少要创建一个子网</strong>，也就是交换机。我们选择一个子IP段192.168.0.0/24，并且设置所属可用区为“<strong>可用区D</strong>”：</p><p><img src=\"https://static001.geekbang.org/resource/image/f8/fd/f8dc763e2e83bda0d7b4e670cd56d0fd.jpg?wh=469*489\" alt=\"\"></p><p>我们再来创建另外一个交换机，网段设置为192.168.1.0/24。<strong>这里的关键在于，我们可以让第二个交换机位于另外一个可用区E：</strong></p><p><img src=\"https://static001.geekbang.org/resource/image/ec/4e/ec26ce81aa6b28314cdd38df9011414e.jpg?wh=494*686\" alt=\"\"></p><p>这就说明，<strong>我们可以建立跨可用区，也就是跨同区域内不同数据中心的私有网络。</strong>这是VPC的一个强大的特性，能够为我们私有网络的高可用性提供保障。比如，你可以让主力集群在一个可用区工作，备用集群在另一个可用区随时待命，需要时迅速切换；你也可以把流量同时分发到不同的可用区，动态控制分发策略。</p><p>就这样，我们收获了一个包含两个交换机的VPC。</p><p><img src=\"https://static001.geekbang.org/resource/image/35/39/357ccf28ed22b1e0630f8deb626ac339.jpg?wh=791*121\" alt=\"\"></p><p><img src=\"https://static001.geekbang.org/resource/image/06/1a/0693033babfe8fde3681876ce64f5a1a.jpg?wh=839*208\" alt=\"\"></p><p>查看一下它的路由表，你可以发现，它自动为我们包含了两个子网的路由信息：</p><p><img src=\"https://static001.geekbang.org/resource/image/ed/56/ed182d9478e414b6cb6d98601f110456.jpg?wh=597*268\" alt=\"\"></p><p>你看，创建VPC其实并不困难。这里的关键还是要规划好VPC和各子网的网段，需要让它们既有足够的地址空间以供资源拓展，又不要安排得范围过大，以免和其他VPC或公司内部网络产生地址冲突，为后续的网间互联带来不必要的麻烦。</p><p>如果你在没有VPC的情况下直接创建虚拟机，公有云一般都会为你自动生成VPC。在生产环境中，我强烈地建议你<strong><span class=\"orange\">不要让系统自动建立VPC</span></strong>，而是像我们上面的做法，先自行建立好VPC，配置好子网和网段等重要参数，然后再创建云虚拟机“入住”。<strong>因为这样，你会事先让自己有一个明确的网络规划，对整个VPC的把控和理解也会更强。</strong></p><h2>私有网络中的虚拟机</h2><p>让我们回到虚拟机的视角。当一个虚拟网络已经存在时，我们就可以将新创建的虚拟机放置在这个虚拟网络中。</p><p><strong>那么，这个所谓的“放置”是怎么真正产生的呢？虚拟机和专有网络的连接点是哪里呢？</strong></p><p>答案就在于虚拟机的<strong><span class=\"orange\">网卡</span></strong>，又称弹性网卡（Elastic Network Interface， 简称ENI）。虚拟机的网卡一方面是和虚拟机的本体进行绑定，另一方面则嵌入某个私有网络的子网，也会拥有至少一个私网IP。</p><p>云上的网卡，之所以被称为“弹性”网卡，是因为它具备以下特征：</p><ol>\n<li>一个虚拟机可以绑定多块网卡，有主网卡和辅助网卡之分；</li>\n<li>一块网卡隶属于一个子网，可以配置同一子网内的多个私有IP；</li>\n<li>辅助网卡可以动态解绑，还能够绑定到另一台虚拟机上。</li>\n</ol><p>这再次体现了云计算的解耦特征，在某些场景下是非常有用的。比如，有一台服务线上流量的机器，而且线上流量导向的是它的辅助网卡，那么当这台机器因故无法正常工作时，你在排查问题的同时可以考虑这样一个应急的办法：将这台机器的辅助网卡迅速解绑，并重新绑定到待命的备用机上。这样就能够比较快地先恢复对外服务。</p><p>当你在创建虚拟机的时候，向导会询问你，这台虚拟机属于哪个VPC，以及VPC下的哪个子网？现在你就理解了，<strong>这个选项的实质性结果，就是新虚拟机自动生成的主网卡，接入了所选VPC的所选子网。</strong></p><p>好了，网卡和私有IP的部分你应该已经比较清楚了。那么你可能会问，<strong>公有IP呢？</strong>这正是我想说的另一个比较关键的部分。</p><p>在绝大多数的云上，创建虚拟机时都会有一个选项，问你“是否同时为虚拟机分配一个公网IP地址”。如果你选择“是”，这样机器启动后，就会拥有一个自动分配的公网地址，便于你从自己的电脑连接到这个实例。这在很多时候都是最方便的选择。</p><p><img src=\"https://static001.geekbang.org/resource/image/c3/06/c33e5833b3b355812748b56242809f06.jpg?wh=623*87\" alt=\"\"></p><p>但对于生产环境，我的推荐是，<strong>尽量不要使用和依赖这个自动生成的公有IP</strong>。因为它本质上是一个从公有云的IP池中<strong>临时租用</strong>给你的IP。如果你的机器关闭或重启，下次获得的IP可能就完全不同了。</p><p>这时，我们真正应该用到的是<strong><span class=\"orange\">弹性IP</span></strong>（Elastic IP），有些云称为eIP。弹性IP一旦生成，它所对应的IP是固定、不会变化的，而且完全属于你所有。这非常适合需要稳定IP的生产环境。</p><p>请不要被它的名字迷惑，它所谓的弹性，其实是指可以<strong>非常自由地解绑和再次绑定到任意目标</strong>。你本质上是买下了这个IP的所有权，将这个IP赋予谁，是你的权利，而且你还可以动态按需切换。</p><p>所以，当你有一个域名，需要让DNS服务解析到某个外部IP，你就应该建立一个弹性IP，绑定到相关资源后，让域名解析到这个弹性IP，而不应该使用虚拟机自动匹配的公有IP。因为后者是不稳定的。</p><p>好，让我们继续进入实验的部分。我们在刚才的VPC内来建立一台虚拟机，起名为vm1-in-vpc1，把它放置到位于可用区E的第二个交换机中，并且选择<strong>不自动生成公有IP</strong>。</p><p><img src=\"https://static001.geekbang.org/resource/image/0d/31/0df182dd6112814c5b37ad0f72990431.jpg?wh=918*88\" alt=\"\"></p><p>注意，<strong>这时它只有私有IP，我们怎么连接它呢？</strong>我们可以创建一个弹性IP，然后绑定到这台实例：</p><p><img src=\"https://static001.geekbang.org/resource/image/1e/41/1eaba10ea37d7cfe051c928b7661b041.jpg?wh=956*117\" alt=\"\"></p><p><img src=\"https://static001.geekbang.org/resource/image/af/03/af47832030593a7eec58c206e28b8003.jpg?wh=491*438\" alt=\"\"></p><p>绑定之后，就自然可以连上刚才的这台虚拟机了。<strong>注意VM列表界面会有相应的显示：</strong></p><p><img src=\"https://static001.geekbang.org/resource/image/23/63/23caf3f25c45fda580b90b7a437c6a63.jpg?wh=450*87\" alt=\"\"></p><p>尝试SSH连接一下，一切正常：</p><pre><code>client@clientVM:~$ ssh root@47.102.139.39\nroot@47.102.139.39's password:\nWelcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-72-generic x86_64)\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/advantage\nWelcome to Alibaba Cloud Elastic Compute Service !\nroot@vm1-in-vpc1:~#\n</code></pre><h2>如何让私有网络对外“开口子”？</h2><p>在阿里云上，如果一台云虚拟机没有被赋予公有IP，默认情况下它就失去了访问外网的能力，只能进行内网通信，这在很多时候，的确是我们想要的安全控制。但也有一些情况，<strong>我们希望内网的机器和外界并不完全隔离，一些互联网流量需要有序地引进来，一些内网机器也需要访问外网。</strong></p><p><strong>这就是一个如何在VPC上“开口子”的问题了。</strong></p><p>当然，你可以使用前面提到的弹性IP，绑定到相关虚拟机上。不过，如果我们需要访问外网的虚拟机数量有很多，这种办法就需要很多弹性IP，管理上就太麻烦了，成本也不划算。还有一个问题是，弹性IP带来的是双向的开放，有时我们只想允许单向的连接。</p><p>这就是<strong><span class=\"orange\">网关</span></strong>可以大显身手的场景了，它正是用来统一协调管理私有网络与外部通信的组件。随着各个公有云的发展，云上也延伸出了许多不同形式、解决不同目的的网关产品。</p><p>我们这里讨论一个常见的场景，即<strong>如何允许多台没有公有IP的虚拟机访问外网</strong>。这时需要使用到的网关叫做<strong>NAT</strong>（Network Address Translation）网关，是一种常见的用来给VPC开口的手段。</p><p>我们继续以阿里云为例，来看下<strong>如何通过NAT网关让虚拟机访问外网</strong>。</p><p>我们可以事先把弹性IP从刚才那台虚拟机解绑，这下它现在又无法访问外网了：</p><pre><code>root@vm1-in-vpc1:~# curl myip.ipip.net\ncurl: (7) Failed to connect to myip.ipip.net port 80: Connection timed out\n</code></pre><p>接着我们创建一个NAT网关实例，并选择它对应的VPC，然后把刚才解绑的弹性IP(47.102.139.39)绑定到NAT网关上：</p><p><img src=\"https://static001.geekbang.org/resource/image/56/a1/5689212f374b81d6737e156dc50d9ca1.jpg?wh=1117*121\" alt=\"\"></p><p>这里的关键之处在于<strong>接下来我们要添加的SNAT条目</strong>。</p><p>SNAT是“源地址转换”的意思，它非常适合让私有网络的主机共享某个公网IP地址接入Internet。注意，<strong>这是一种从内向外的、单向的连通形式</strong>。</p><p><img src=\"https://static001.geekbang.org/resource/image/7d/5f/7dd66c1b4495261b579f2c06a201a65f.jpg?wh=591*767\" alt=\"\"></p><p>上面我们添加了一个SNAT条目，让整个交换机“test-vpc1-vsw2”下的网段都共享一个出口公网IP。你要注意，<strong>我们的虚拟机是位于这个网段内的</strong>。</p><p>接着再回到这台虚拟机内，我们通过curl命令，尝试对外访问：</p><pre><code>root@vm1-in-vpc1:~# curl myip.ipip.net\n当前 IP：47.102.139.39  来自于：中国 上海 上海  阿里云/电信/联通/移动/铁通/教育网\n</code></pre><p>很棒，这回成功地连通了。而且外部网站也显示，我们正在使用的外网IP正是那个弹性IP(47.102.139.39)。这就是对于NAT网关的一个小小实验了。</p><p>还有一种网关被称为<strong>VPN网关</strong>，也可以帮助外界连接到VPC，它本质上是基于你所熟知的VPN技术。由于VPN能够基于互联网提供私有加密的通信，因此非常适合用来从任意其他私有设施安全地连接到VPC。这些私有设施可以小到一台个人电脑或手机终端，也可以大到是你本地的数据中心，还可以是另一个VPC。</p><h2>多网连接有哪些方式？</h2><p>前面我们主要是从单个VPC的角度来进行讨论的，那么最后，我们再来讨论一下多VPC的场景。<strong>公有云上是允许你同时使用多个VPC的，这样你可以构建更加复杂的网络架构，实现模块隔离和跨区域扩展等高级需求。</strong></p><p>如果是云端VPC和VPC的互联，我首先推荐的就是<strong><span class=\"orange\">对等连接</span></strong>（VPC Peering）的方式。它能够在不添加额外设备的情况下，让两个VPC无缝地互联起来，而且操作非常简单，对等连接甚至还能够支持跨区域的私有网络互联。当然，对等连接的实施前提，是这两个VPC的网段没有交集，不存在冲突。</p><p><strong>这里你需要注意对等连接的一个特点，就是它不具备传递性。</strong>也就是说，如果A和B建立了对等连接，B和C建立了对等连接，那么A和C是不相通的。这是对等连接的一个局限。</p><p>如果你真的需要多个VPC间任意路径的互联互通，那么可以考虑使用比对等连接更为复杂和强大的<strong>专用网络设施</strong>，比如AWS的Transit Gateway，和阿里云的云企业网，它们能够帮助搭建更为复杂的多VPC网络拓扑结构，也允许进行更精细的路由设置。如有需要，建议你仔细阅读厂商的文档进行学习和研究。</p><p>公有云中的私有网络，还可以和企业本地数据中心进行互联，形成<strong>混合云架构</strong>。你可以先考虑使用VPN这种轻量的方式，通过公网线路为两边建立连接渠道。但如果应用场景要求保证延迟和带宽，一般就需要专线进行连接了。绝大多数的云厂商，都提供了云端区域和本地数据中心进行高速互联的服务和解决方案，比如AWS的Direct  Connect、Azure的ExpressRoute和阿里云的“高速通道”（云下IDC专线接入）等等。一般专线还会和VPN一起组合使用，来保证通道的高可用性。</p><p><span class=\"reference\">小提示：与较为易用的VPC互联相比，混合云的构建是一项较为复杂的工程，通常需要由本地机房、云厂商、电信运营商三方配合进行，也牵涉到本地数据中心端的网络规划和路由设备适配。这超出了我们开发者课程的范畴。如需实施，建议你仔细咨询云厂商工作人员。</span></p><h2>课堂总结与思考</h2><p>今天，我主要为你介绍了云上虚拟网络，包括它的具体组成、使用场景和连接性问题。我还给你推荐了一些在生产环境下的最佳实践。</p><p>从某种程度上来说，虚拟私有网络的“仿真度”非常高，在软件定义网络（SDN）技术的加持下，甚至比物理网络还要更加灵活高效，更易于扩展。所以，<strong>通过合理的规划和设置，云端的网络基础设施能够让我们拥有一个健壮而强大的网络拓扑结构，对于流量的引导和控制，也完全能够做到因势利导、开合有度。</strong></p><p>需要特别说明的是，在主体理念保持一致的情况下，各个云厂商在具体实现上，其实是各显神通的，会有一些细节存在差异。这是正常的现象，请你在实践时注意。比如说，和阿里云不同，AWS的VPC中访问外网，需要经由专门的Internet Gateway来通行流量，路由表中也需要进行相应的设置。</p><p><strong>好了，今天我给你留下的思考题是：</strong></p><ul>\n<li>在虚拟私有网络的内部，两机互联的带宽有多大呢？可能受到哪些因素的影响？</li>\n<li>在今天的实验中，我们通过NAT网关实现了流量“出网”的目的。那么，如果是反过来需要引导外界流量进入VPC，应该使用什么方式呢？</li>\n</ul><p>欢迎你在留言区和我互动，我会一起参与讨论。如果觉得有收获，也欢迎你把这篇文章分享给你的朋友。感谢阅读，我们下期再见。</p>","comments":[{"had_liked":false,"id":207920,"user_name":"何恺铎","can_delete":false,"product_type":"c1","uid":1011765,"ip_address":"","ucode":"D7EDA2A7A8978E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/70/35/28758547.jpg","comment_is_top":true,"comment_ctime":1587215838,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"9.2233720728016998e+18","product_id":100046901,"comment_content":"[上讲问题参考回答]<br>1. 在一些云平台上，已经能够支持云硬盘的在线扩容了，所属VM可以不用停机。但需要注意，扩容操作不会直接改变文件系统和分区等设置，扩容后一般需要在操作系统内进行分区的扩展或新增。<br>2. EFS&#47;NAS类云产品也能够以磁盘形式挂载到云虚拟机。这类存储产品的特点，在于虚拟出的磁盘可以跨多个虚拟机进行文件共享，同时容量上限很高，可以轻松突破原来的单盘极限。","like_count":8,"discussions":[{"author":{"id":1762252,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/e3/cc/0947ff0b.jpg","nickname":"nestle","note":"","ucode":"469800BED81B54","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":257305,"discussion_content":"在线扩容用的是lvm吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588557848,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":188924,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":true,"comment_ctime":1584434465,"is_pvip":false,"replies":[{"id":"72942","content":"赞！","user_name":"作者回复","comment_id":188924,"uid":"1011765","ip_address":"","utype":1,"ctime":1584454940,"user_name_real":"何恺铎"}],"discussion_count":3,"race_medal":0,"score":"9.2233720685040005e+18","product_id":100046901,"comment_content":"我把弹性网卡和辅助私网IP用起来了.可以解决我工作中的一个实际问题.<br><br>我测试用的k8s工作节点,由于都是抢占付费模式按需购买,所以IP经常会发生变动.<br>如果k8s中的部分服务要对外暴露, 就会遇到IP地址经常发生变动的情况.<br>之前我的解决方案是给k8s中的Service配置为LoadBalancer的方式,这样服务对外暴露的IP地址就不会变化了.<br>但是一个阿里云账户,默认创建的上限是50个负载均衡.<br>而我测试的服务,完全没有必要用这种额度.<br><br>我现在就用辅助私网IP, 实现了每次新建k8s工作节点时,都可以用同一个IP访问到k8s集群服务.<br>这样我就可以指定k8s中的Service配置为NodePort的方式.不用再占负载均衡的额度.<br>k8s集群外一样可以用固定的IP和端口,访问k8s里面的服务了.<br>","like_count":8,"discussions":[{"author":{"id":1011765,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/70/35/28758547.jpg","nickname":"何恺铎","note":"","ucode":"D7EDA2A7A8978E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487566,"discussion_content":"赞！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584454940,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1195204,"avatar":"https://static001.geekbang.org/account/avatar/00/12/3c/c4/4ee2968a.jpg","nickname":"艾利特-G","note":"","ucode":"8C4DA0ABE77CDC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":218074,"discussion_content":"我觉得可以这样，用辅助网卡创建一个固定的内网IP，将一个EIP绑定到这个辅助网卡。然后k8s中部署Ingress Controller，其Service使用辅助网卡的IP作为固定ClusterIP，然后就形成了一个公网可访问的边缘节点服务了。可以这样做的前提是，k8s的pod网络和节点网络的IP是互通的。这种功能在公有云应该都有各自的CNI可以实现，据我所知阿里云和AWS的k8s服务在创建时默认也是使用这样的CNI插件的。如果不用Ingress Controller而用load balancer的Service的话，恐怕光一个辅助网卡固定的IP不够用，因为不管怎么样得有一个承担一个集群内外Gateway的角色。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585617784,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1205253,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","nickname":"我来也","note":"","ucode":"773D6104F56767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1195204,"avatar":"https://static001.geekbang.org/account/avatar/00/12/3c/c4/4ee2968a.jpg","nickname":"艾利特-G","note":"","ucode":"8C4DA0ABE77CDC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":218524,"discussion_content":"恩, 我现在也是在k8s中弄了一个Ingress Controller,k8s内的服务全部通过这个入口对外提供服务.\n其实一个集群只建一个slb,还是可以接受的.\n之前不会用,一个service就搞一个slb,确实比较浪费.\n\n如果有些基础服务(比如redis)想在集群外访问,我就是使用externalIPs的方式,让集群外的机器通过这个IP连上来.\n我更推荐用 kubectl port-forward 的方式访问k8s内的这些服务.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585664083,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":218074,"ip_address":""},"score":218524,"extra":""}]}]},{"had_liked":false,"id":188035,"user_name":"leslie","can_delete":false,"product_type":"c1","uid":1324255,"ip_address":"","ucode":"798E7C1CC98CC2","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/df/64e3d533.jpg","comment_is_top":true,"comment_ctime":1584316441,"is_pvip":false,"replies":[{"id":"72944","content":"影响的因素在于机器的配置，一般来说机器配置越高，其内网带宽也越大。你可以仔细留心，很多云都会给出机型的内网带宽。<br><br>第二个问题主要依靠负载均衡等手段，下一讲我们会涉及。高速通道等主要用于私网连通，和外网没有关系。","user_name":"作者回复","comment_id":188035,"uid":"1011765","ip_address":"","utype":1,"ctime":1584455697,"user_name_real":"何恺铎"}],"discussion_count":1,"race_medal":0,"score":"9.2233720427341005e+18","product_id":100046901,"comment_content":"目前云计算的很多概念确实让我们在使用的过程中会难以弄清，通过课程的学习梳理应当可以达到与私有云思维的对比和学习，课程听到现在觉得不少核心的思路与原理还是有相似之处。<br>两机互联的带宽应当很大-相当于两台设备之间拉了一根网线。影响的因素应当在网卡，虚拟交换机。<br><br>至于第二个问题在课程中有&quot;AWS 的 Direct Connect、Azure 的 ExpressRoute 和阿里云的“高速通道”不知道是否是相应的答案，这块自己还待更多的实践去摸索提升。<br>谢谢老师今天的分享，期待后续课程的学习。<br>","like_count":1,"discussions":[{"author":{"id":1011765,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/70/35/28758547.jpg","nickname":"何恺铎","note":"","ucode":"D7EDA2A7A8978E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487323,"discussion_content":"影响的因素在于机器的配置，一般来说机器配置越高，其内网带宽也越大。你可以仔细留心，很多云都会给出机型的内网带宽。\n\n第二个问题主要依靠负载均衡等手段，下一讲我们会涉及。高速通道等主要用于私网连通，和外网没有关系。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584455697,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":188013,"user_name":"怀朔","can_delete":false,"product_type":"c1","uid":1006865,"ip_address":"","ucode":"52FAC1C2FD37B6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5d/11/e1f36640.jpg","comment_is_top":false,"comment_ctime":1584298182,"is_pvip":false,"replies":[{"id":"72924","content":"堪称完美的回答！","user_name":"作者回复","comment_id":188013,"uid":"1011765","ip_address":"","utype":1,"ctime":1584453238,"user_name_real":"何恺铎"}],"discussion_count":2,"race_medal":0,"score":"44533971142","product_id":100046901,"comment_content":"1、<br>     1.1 两机之间 小的那台机器带宽情况 <br>     1.2 其影响因素： <br>         两台机器同时发送和接收情况<br>         不同可用区网络抖动？<br>2、“入网”方式<br>      2.1 通过dnat进来 <br>      2.2 文中介绍绑定eip （弹性ip）<br>      2.3 通过slb 引流<br>      ","like_count":11,"discussions":[{"author":{"id":1011765,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/70/35/28758547.jpg","nickname":"何恺铎","note":"","ucode":"D7EDA2A7A8978E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487315,"discussion_content":"堪称完美的回答！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584453238,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1006865,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5d/11/e1f36640.jpg","nickname":"怀朔","note":"","ucode":"52FAC1C2FD37B6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":206907,"discussion_content":"谢谢老师认可 向老师学习","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584453293,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":188061,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1584319421,"is_pvip":false,"replies":[{"id":"72937","content":"回答得非常好，赞一个！<br><br>关于你的场景，跨账号的VPC互联，在阿里云上是能够通过“云企业网”实现的，参见 https:&#47;&#47;help.aliyun.com&#47;document_detail&#47;65901.html 。但如果想复用NAT网关，可能还需要额外的转发或路由设置。你可以实操一下，必要时可以联系阿里云客服确认。","user_name":"作者回复","comment_id":188061,"uid":"1011765","ip_address":"","utype":1,"ctime":1584453954,"user_name_real":"何恺铎"}],"discussion_count":2,"race_medal":0,"score":"35944057789","product_id":100046901,"comment_content":"刚才在手机上编辑的一大段,因为提示有敏感词,大部分都丢失了,现在在电脑上再手敲一下.😭<br><br>自从本专栏出来后，每天都是盼着更新！😄<br><br># vpc内两机互联，带宽和影响的因素。<br>## 首先的瓶颈在购买的云主机可支持的最大网络带宽。<br>（我看到的云主机网络上限有0.8G、1G、1.5G这些规格。）<br>## 其次看两机所处的网络位置。<br>如果两机处在同区域的同可用区，那爽歪歪，很容易达到网卡上限，scp速度可以到100MB&#47;s+。（这里是大写的B）<br>如果是同区域不同可用区，网络速度也还行，能不能到机器上限还不确定，收不收费也不确定。<br>如果是不同可用区，可能带宽和速度又会降低些。好像还收费。<br>## 再次看&quot;邻居&quot;<br>在云上,毕竟是共享的.<br>如果同网络设备(如交换机)中的其他用户也是大量的占用带宽,也可能会影响你的速度.<br><br># 导入流量到vpc，应该就是靠nat网关的dnat功能了。<br><br># 关于阿里的nat网关我有话说<br>阿里云的nat网关，我也是最近两三天才有所了解，原因是他对个人不太友好。最低规格的按量付费都是每天12元，个人平常尝试的少。<br>但是它的功能确实强大，可以跨可用区，单IP的带宽可以达到200Mb&#47;s。<br>还可以很方便的添加和绑定弹性ip。<br><br>现在云厂商的文档是真的详细，还都是中文的，哈哈。<br><br># 个人疑问<br>## 虚拟弹性网卡<br>之前只见有些虚拟机可以绑定数十张辅助网卡,不知有何用.<br>看了老师的文章,发现这里原来还可以这么用.我再去研究系按官方的文档.<br><br>## 不同用户的vpc互联<br>之前只见阿里有提到,不同用户的vpc也可以互联,没实操过.<br>看了老师的文章,说还可以用VPX代理的方式打通不同vpc.<br>那就说明这个打通还真是可行的了.<br><br>我的场景是这样的,老师先来帮忙分析下整体的可行性.只需要最终的结果,不需要分析过程.<br>我想自己账户下的vpc,与公司的vpc能互联.如果能复用公司的nat网关就更好了.<br><br>我的应用场景是:<br>自己购买云主机,加入到企业的k8s测试集群中.以便在不需要的时候可以随时释放.<br>用企业的子账号购买云主机,需要有相关的权限,怕BOSS不放心.<br>自己搭建的k8s测试集群,除了需要支付nat网关的费用,还无法与其他依赖服务互相通讯,没有实际的意义.<br><br>看了老师的文章,才去尝试云主机的抢占付费模式,真的是爽歪歪.<br>阿里云4CPU32G的配置,0.2元&#47;小时不到的价格,持续用了周末的两个白天.<br>","like_count":8,"discussions":[{"author":{"id":1011765,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/70/35/28758547.jpg","nickname":"何恺铎","note":"","ucode":"D7EDA2A7A8978E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487331,"discussion_content":"回答得非常好，赞一个！\n\n关于你的场景，跨账号的VPC互联，在阿里云上是能够通过“云企业网”实现的，参见 https://help.aliyun.com/document_detail/65901.html 。但如果想复用NAT网关，可能还需要额外的转发或路由设置。你可以实操一下，必要时可以联系阿里云客服确认。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584453954,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1205253,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","nickname":"我来也","note":"","ucode":"773D6104F56767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":207044,"discussion_content":"之前也看到了阿里云的&#34;云企业网&#34;,可惜不敢下手.\n毕竟是&#34;对方网络将会打通到您的网络&#34;,这个口子一开,太不可控了.\n\n另外VPN网关服务也没开,不敢尝试.\n不过理论上是通过公网的方式连接到内网,也会有流量的费用.\n\n还是自己充点钱,用抢占付费模式的示例,更具有可行性.\n谢谢老师的回复.甚至还贴上了链接地址.\n\n最近几天就尽在折腾阿里云的各种东西了.nat网关的snat dnat都试了.\n确实太方便了.\n\n感谢老师让我见识到了另外一片有趣的地方.哈哈.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584458083,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":197550,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1585384816,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23060221296","product_id":100046901,"comment_content":"今天周末,趁机在阿里云上体验了一把&lt;云企业网&gt;,确实方便和强大.<br>可以跨账号私网互通.<br>本身不收费,同地区还免流量费!<br><br>确实可以实现之前的愿望:<br>自己账号下的实例加入到企业账户下的k8s集群.<br>由于涉及企业账户,所以小试了一把后就移除了&lt;云企业网&gt;.<br><br>有了它,可玩的方式确实多起来了.<br>还可以异地跨账号互通.就是要购买流量包了.<br>","like_count":5},{"had_liked":false,"id":194546,"user_name":"一天到晚游泳的鱼","can_delete":false,"product_type":"c1","uid":1020028,"ip_address":"","ucode":"645C9442DF3811","user_header":"https://static001.geekbang.org/account/avatar/00/0f/90/7c/99806536.jpg","comment_is_top":false,"comment_ctime":1585065787,"is_pvip":false,"replies":[{"id":"74487","content":"不同云的公有IP调度策略细节可能有不同，当然一般来说如果只是重启，换IP的可能性还是相当小的。但大多数云如果是机器关机一段时间再启动，就很有可能换IP了。是否更换IP还可能会和你的机器是包年包月，还是按量付费有关系。<br><br>腾讯云的具体行为可以再咨询一下客服，以官方回复为准。但无论如何，依赖弹性IP一定是最安全的。可以考虑把你们公司环境中最关键的几个IP转化为弹性IP。","user_name":"作者回复","comment_id":194546,"uid":"1011765","ip_address":"","utype":1,"ctime":1585324668,"user_name_real":"何恺铎"}],"discussion_count":4,"race_medal":0,"score":"10175000379","product_id":100046901,"comment_content":"看到ip，会变吓了我一跳，第一次注意这个问题，我们公司现在用腾讯云有十几台云主机，没有用弹性ip,只用买的时候固定分配的，三年来，重启了几十次，ip并没有有变化过，查了下资料，也说不会主动释放，您说的这个包括腾讯云吗","like_count":2,"discussions":[{"author":{"id":1011765,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/70/35/28758547.jpg","nickname":"何恺铎","note":"","ucode":"D7EDA2A7A8978E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488840,"discussion_content":"不同云的公有IP调度策略细节可能有不同，当然一般来说如果只是重启，换IP的可能性还是相当小的。但大多数云如果是机器关机一段时间再启动，就很有可能换IP了。是否更换IP还可能会和你的机器是包年包月，还是按量付费有关系。\n\n腾讯云的具体行为可以再咨询一下客服，以官方回复为准。但无论如何，依赖弹性IP一定是最安全的。可以考虑把你们公司环境中最关键的几个IP转化为弹性IP。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585324668,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1031677,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/bd/fd/3f5d5db5.jpg","nickname":"scorpiozj","note":"","ucode":"C66EA76809F9BF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":228931,"discussion_content":"阿里云包年重启后ip不变","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586591510,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1020028,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/90/7c/99806536.jpg","nickname":"一天到晚游泳的鱼","note":"","ucode":"645C9442DF3811","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1031677,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/bd/fd/3f5d5db5.jpg","nickname":"scorpiozj","note":"","ucode":"C66EA76809F9BF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":236120,"discussion_content":"是的，包年包月的都不会，但是，按流量使用时间的关机会","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587055018,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":228931,"ip_address":""},"score":236120,"extra":""}]},{"author":{"id":1020028,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/90/7c/99806536.jpg","nickname":"一天到晚游泳的鱼","note":"","ucode":"645C9442DF3811","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":215832,"discussion_content":"嗯，我查阅了腾讯云的文档，上面写的很清楚，只有销毁的时候才会换ip，所以，应该是安全的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585388932,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":189382,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1584508733,"is_pvip":false,"replies":[{"id":"73202","content":"“上面的东西”一般丢不了的，即便机器无法启动或无法连接，可以把云盘卸下来，挂载到其他正常机器来挽救。","user_name":"作者回复","comment_id":189382,"uid":"1011765","ip_address":"","utype":1,"ctime":1584630504,"user_name_real":"何恺铎"}],"discussion_count":2,"race_medal":0,"score":"10174443325","product_id":100046901,"comment_content":"说个糗事.<br><br>今天测试辅助私网IP, 换了个系统, 之前是在CentOS上弄的,今天是在Ubuntu 18.04上弄的.<br>官方的文档只支持Ubuntu 14&#47;16.<br>结果我自己折腾时,可能配置配错了.<br>重启网卡后,与服务器就失去了相应, <br>重启了也无法恢复. 最后只能重置服务器.<br><br>幸好这个服务器在昨天晚上把上面的东西弄走了,要不然就悲剧了.哈哈.","like_count":2,"discussions":[{"author":{"id":1011765,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/70/35/28758547.jpg","nickname":"何恺铎","note":"","ucode":"D7EDA2A7A8978E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487683,"discussion_content":"“上面的东西”一般丢不了的，即便机器无法启动或无法连接，可以把云盘卸下来，挂载到其他正常机器来挽救。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584630504,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1205253,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","nickname":"我来也","note":"","ucode":"773D6104F56767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":209468,"discussion_content":"老师这也是个办法，把硬盘挂载在其他主机上。\n之前完全没想到还有这种骚操作。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584632088,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":188524,"user_name":"Helios","can_delete":false,"product_type":"c1","uid":1380758,"ip_address":"","ucode":"BE6B98EE8F0D09","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJrOl63enWXCRxN0SoucliclBme0qrRb19ATrWIOIvibKIz8UAuVgicBMibIVUznerHnjotI4dm6ibODA/132","comment_is_top":false,"comment_ctime":1584364470,"is_pvip":false,"replies":[{"id":"73351","content":"几个点都说得很对，除了内网带宽并没有独占共享之说。","user_name":"作者回复","comment_id":188524,"uid":"1011765","ip_address":"","utype":1,"ctime":1584720151,"user_name_real":"何恺铎"}],"discussion_count":1,"race_medal":0,"score":"10174299062","product_id":100046901,"comment_content":"1. 申请虚拟机的时候能指定需要多少带宽的虚拟机（1 Gbps、1 .5Gbps...10Gbps），影响的因素个人觉得主要有两个：一、云虚拟机的带宽是独占的还是共享的，明显独占的是更快的；二、虚拟机之间的距离，是同可用区 &gt; 同区域不同可用区 &gt; 不同区域<br>2. 可以使用DNAT网关，也可以找一台有公网ip的虚拟机作为堡垒机，通过这台机器去进去VPC，还有直接给绑定个eip算么🤦‍♂️","like_count":2,"discussions":[{"author":{"id":1011765,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/70/35/28758547.jpg","nickname":"何恺铎","note":"","ucode":"D7EDA2A7A8978E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487440,"discussion_content":"几个点都说得很对，除了内网带宽并没有独占共享之说。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584720151,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":188407,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1584350901,"is_pvip":false,"replies":[{"id":"72941","content":"是的，实操之后印象会更加深刻。","user_name":"作者回复","comment_id":188407,"uid":"1011765","ip_address":"","utype":1,"ctime":1584454526,"user_name_real":"何恺铎"}],"discussion_count":1,"race_medal":0,"score":"10174285493","product_id":100046901,"comment_content":"今天在阿里云上实操了下弹性网卡和辅助私网IP, 确实方便和强大.<br>辅助网卡可以随便切换绑定的实例.<br>辅助私网IP也是可以随便的增删.<br>绑定或增加后,只需要在实例中执行简单的几个命令或配置, 就可以生效了.<br><br>也就是说,某一台实例的网络出状况时,可以先把网卡指向到备用实例,继续提供服务.原先的现场还能保留.","like_count":2,"discussions":[{"author":{"id":1011765,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/70/35/28758547.jpg","nickname":"何恺铎","note":"","ucode":"D7EDA2A7A8978E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487399,"discussion_content":"是的，实操之后印象会更加深刻。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584454526,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":190406,"user_name":"戴斌","can_delete":false,"product_type":"c1","uid":1119385,"ip_address":"","ucode":"7DC53BEA432217","user_header":"https://static001.geekbang.org/account/avatar/00/11/14/99/5b1ed92b.jpg","comment_is_top":false,"comment_ctime":1584640329,"is_pvip":false,"replies":[{"id":"73348","content":"没错，配置越强悍，内网带宽越高。","user_name":"作者回复","comment_id":190406,"uid":"1011765","ip_address":"","utype":1,"ctime":1584719619,"user_name_real":"何恺铎"}],"discussion_count":1,"race_medal":0,"score":"5879607625","product_id":100046901,"comment_content":"内网带宽受机器配置影响","like_count":1,"discussions":[{"author":{"id":1011765,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/70/35/28758547.jpg","nickname":"何恺铎","note":"","ucode":"D7EDA2A7A8978E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487974,"discussion_content":"没错，配置越强悍，内网带宽越高。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584719619,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":188774,"user_name":"上山砍柴","can_delete":false,"product_type":"c1","uid":1059766,"ip_address":"","ucode":"F85D250C11ED70","user_header":"https://wx.qlogo.cn/mmopen/vi_32/4pFDynicvRnrTTRavia64UAknQjyX3KFfm67W4AZG52wm2TgwL1FWNX1zhIlIVgicPw2jzPqKASAib5nI1QfY6pc2Q/132","comment_is_top":false,"comment_ctime":1584414474,"is_pvip":false,"replies":[{"id":"72953","content":"你可以参考一下极客时间上另一门课程刘超老师《趣谈网络协议》中的相关章节。","user_name":"作者回复","comment_id":188774,"uid":"1011765","ip_address":"","utype":1,"ctime":1584456420,"user_name_real":"何恺铎"}],"discussion_count":1,"race_medal":0,"score":"5879381770","product_id":100046901,"comment_content":"老师，能不能讲一下，云计算网络他们是怎么构造的，深层次的原理。或者推介一下资料也是好的","like_count":1,"discussions":[{"author":{"id":1011765,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/70/35/28758547.jpg","nickname":"何恺铎","note":"","ucode":"D7EDA2A7A8978E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487517,"discussion_content":"你可以参考一下极客时间上另一门课程刘超老师《趣谈网络协议》中的相关章节。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584456420,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":188058,"user_name":"安排","can_delete":false,"product_type":"c1","uid":1260026,"ip_address":"","ucode":"F78CFA9624CAEF","user_header":"https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg","comment_is_top":false,"comment_ctime":1584319383,"is_pvip":false,"replies":[{"id":"72928","content":"虚拟机的流量进入公网，的确会经过数据中心的路由层，但这里面实际牵涉到的设备和算法，会比通常意义上的“路由器”要复杂精密得多。<br><br>跳板机可以是一台普通虚拟机，通过公共ip对外暴露部分端口，外界可以直接连接（一般会限制连接ip）。因为它位于内网中，所以能通过它访问内网其他机器。另外，云上跳板机在不需要使用的时候，也可以关机下线。","user_name":"作者回复","comment_id":188058,"uid":"1011765","ip_address":"","utype":1,"ctime":1584453612,"user_name_real":"何恺铎"}],"discussion_count":1,"race_medal":0,"score":"5879286679","product_id":100046901,"comment_content":"云提供商这一块的vpc是不是通过路由器接入公网的？一台云上虚拟机接入公网，这之间还有哪些设备呢？ 如果我们申请的云上虚拟机不配置公网ip和弹性ip，那控制这台虚拟机只能通过阿里云的网页来控制吗？网上有说通过ssh连到跳板机可以控制的？跳板机的原理是啥？如何申请呢","like_count":1,"discussions":[{"author":{"id":1011765,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/70/35/28758547.jpg","nickname":"何恺铎","note":"","ucode":"D7EDA2A7A8978E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487330,"discussion_content":"虚拟机的流量进入公网，的确会经过数据中心的路由层，但这里面实际牵涉到的设备和算法，会比通常意义上的“路由器”要复杂精密得多。\n\n跳板机可以是一台普通虚拟机，通过公共ip对外暴露部分端口，外界可以直接连接（一般会限制连接ip）。因为它位于内网中，所以能通过它访问内网其他机器。另外，云上跳板机在不需要使用的时候，也可以关机下线。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584453612,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":188011,"user_name":"潘政宇","can_delete":false,"product_type":"c1","uid":1254758,"ip_address":"","ucode":"9A6658EE862D95","user_header":"https://static001.geekbang.org/account/avatar/00/13/25/66/4835d92e.jpg","comment_is_top":false,"comment_ctime":1584296728,"is_pvip":true,"replies":[{"id":"72946","content":"注意虚拟网卡本身没有性能级别，一般是取决于虚拟机本身的配置档次。","user_name":"作者回复","comment_id":188011,"uid":"1011765","ip_address":"","utype":1,"ctime":1584455768,"user_name_real":"何恺铎"}],"discussion_count":1,"race_medal":0,"score":"5879264024","product_id":100046901,"comment_content":"1.VPC两机器互联的带宽，主要受虚拟网卡限制吧<br>2.需要DNAT","like_count":1,"discussions":[{"author":{"id":1011765,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/70/35/28758547.jpg","nickname":"何恺铎","note":"","ucode":"D7EDA2A7A8978E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487314,"discussion_content":"注意虚拟网卡本身没有性能级别，一般是取决于虚拟机本身的配置档次。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584455768,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":316955,"user_name":"Nothing Is Impossible","can_delete":false,"product_type":"c1","uid":1173056,"ip_address":"","ucode":"7053324F96B1F0","user_header":"https://static001.geekbang.org/account/avatar/00/11/e6/40/df5238f5.jpg","comment_is_top":false,"comment_ctime":1634627908,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634627908","product_id":100046901,"comment_content":"这样子是不是就没有mac的概念了？看起来好像都是用IP在通信","like_count":0},{"had_liked":false,"id":299545,"user_name":"熊猫","can_delete":false,"product_type":"c1","uid":1080238,"ip_address":"","ucode":"23C85117A16BEF","user_header":"https://static001.geekbang.org/account/avatar/00/10/7b/ae/66ae403d.jpg","comment_is_top":false,"comment_ctime":1624699526,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624699526","product_id":100046901,"comment_content":"老师，弹性IP会和公网上的IP会重吗？","like_count":0},{"had_liked":false,"id":228621,"user_name":"lifebread","can_delete":false,"product_type":"c1","uid":1396397,"ip_address":"","ucode":"AB1824B27C241F","user_header":"","comment_is_top":false,"comment_ctime":1592754300,"is_pvip":false,"replies":[{"id":"84393","content":"谢谢你的问题，这里的确可以说得更清楚些：NAT网关是一个实例，SNAT条目本质上是NAT网关实例上的一种配置或者说导流规则。我们是在NAT网关界面中创建SNAT条目的，所以它们天生是关联的，不需要额外“绑定”。","user_name":"作者回复","comment_id":228621,"uid":"1011765","ip_address":"","utype":1,"ctime":1592838677,"user_name_real":"何恺铎"}],"discussion_count":2,"race_medal":0,"score":"1592754300","product_id":100046901,"comment_content":"老师，没有完全读懂SNAT和NAT之间的关系，为什么要先创建一个NAT再创建SNAT呢？从文中只看到了SNAT绑定在了EIP上，并没有看到比如说SNAT绑定在了特定的NAT上","like_count":0,"discussions":[{"author":{"id":1011765,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/70/35/28758547.jpg","nickname":"何恺铎","note":"","ucode":"D7EDA2A7A8978E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499108,"discussion_content":"谢谢你的问题，这里的确可以说得更清楚些：NAT网关是一个实例，SNAT条目本质上是NAT网关实例上的一种配置或者说导流规则。我们是在NAT网关界面中创建SNAT条目的，所以它们天生是关联的，不需要额外“绑定”。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592838677,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1396397,"avatar":"","nickname":"lifebread","note":"","ucode":"AB1824B27C241F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":285872,"discussion_content":"明白了，非常感谢！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592981028,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":216505,"user_name":"分清云淡","can_delete":false,"product_type":"c1","uid":1269873,"ip_address":"","ucode":"7045AE6BF72D31","user_header":"https://static001.geekbang.org/account/avatar/00/13/60/71/895ee6cf.jpg","comment_is_top":false,"comment_ctime":1589273285,"is_pvip":false,"replies":[{"id":"80134","content":"嗯，跨地域场景，可以使用阿里云的云企业网，进行多个vpc间的互联，参见 https:&#47;&#47;help.aliyun.com&#47;product&#47;59006.html","user_name":"作者回复","comment_id":216505,"uid":"1011765","ip_address":"","utype":1,"ctime":1589297792,"user_name_real":"何恺铎"}],"discussion_count":1,"race_medal":0,"score":"1589273285","product_id":100046901,"comment_content":"请教老师：<br>1） 阿里云的vpc跨城的话就没法多个ecs重用一个vpc了吧？<br>2） 阿里云上多个vpc怎么打通好呢？","like_count":0,"discussions":[{"author":{"id":1011765,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/70/35/28758547.jpg","nickname":"何恺铎","note":"","ucode":"D7EDA2A7A8978E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494845,"discussion_content":"嗯，跨地域场景，可以使用阿里云的云企业网，进行多个vpc间的互联，参见 https://help.aliyun.com/product/59006.html","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589297792,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":205248,"user_name":"胖子","can_delete":false,"product_type":"c1","uid":1037760,"ip_address":"","ucode":"E6371346288A87","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLIuRQaZX70dsBg6khub2VPM1eQAP9IWRWxgOFed3ia4kXyNJInFRicWJ0ibf2YmLsOvJa1sGygGpmJg/132","comment_is_top":false,"comment_ctime":1586576036,"is_pvip":false,"replies":[{"id":"76960","content":"只要身处网络之中，为了知道下一跳往何处去，就要有路由表的指引。云上这样设计子网和路由表的对应关系，是为了在某些情况下，允许子网级别的细粒度路由控制，是有意义和价值的。<br><br>另外，注意文中说子网是和路由表进行“关联”，意味着路由表实例是可以共享的，并非指每个子网一定要有自己独立的路由表。","user_name":"作者回复","comment_id":205248,"uid":"1011765","ip_address":"","utype":1,"ctime":1586789763,"user_name_real":"何恺铎"}],"discussion_count":1,"race_medal":0,"score":"1586576036","product_id":100046901,"comment_content":"每个子网都有路由表怎么理解呢？VPC下的子网属于同一局域网何需路由器层级的路由功能。","like_count":0,"discussions":[{"author":{"id":1011765,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/70/35/28758547.jpg","nickname":"何恺铎","note":"","ucode":"D7EDA2A7A8978E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491433,"discussion_content":"只要身处网络之中，为了知道下一跳往何处去，就要有路由表的指引。云上这样设计子网和路由表的对应关系，是为了在某些情况下，允许子网级别的细粒度路由控制，是有意义和价值的。\n\n另外，注意文中说子网是和路由表进行“关联”，意味着路由表实例是可以共享的，并非指每个子网一定要有自己独立的路由表。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586789763,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":205245,"user_name":"胖子","can_delete":false,"product_type":"c1","uid":1037760,"ip_address":"","ucode":"E6371346288A87","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLIuRQaZX70dsBg6khub2VPM1eQAP9IWRWxgOFed3ia4kXyNJInFRicWJ0ibf2YmLsOvJa1sGygGpmJg/132","comment_is_top":false,"comment_ctime":1586575840,"is_pvip":false,"replies":[{"id":"76962","content":"网段就是IP区段，是VPC或者子网的地址段属性。同一个VPC一般只能限定在一个区域，如果要跨区域内部通信，就需要用到文中提到的多VPC互联了。","user_name":"作者回复","comment_id":205245,"uid":"1011765","ip_address":"","utype":1,"ctime":1586790129,"user_name_real":"何恺铎"}],"discussion_count":1,"race_medal":0,"score":"1586575840","product_id":100046901,"comment_content":"请老师解惑1、网段与子网的关系与区别？2、同一VPC可以跨区域设置吗？","like_count":0,"discussions":[{"author":{"id":1011765,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/70/35/28758547.jpg","nickname":"何恺铎","note":"","ucode":"D7EDA2A7A8978E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491432,"discussion_content":"网段就是IP区段，是VPC或者子网的地址段属性。同一个VPC一般只能限定在一个区域，如果要跨区域内部通信，就需要用到文中提到的多VPC互联了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586790129,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":200539,"user_name":"艾利特-G","can_delete":false,"product_type":"c1","uid":1195204,"ip_address":"","ucode":"8C4DA0ABE77CDC","user_header":"https://static001.geekbang.org/account/avatar/00/12/3c/c4/4ee2968a.jpg","comment_is_top":false,"comment_ctime":1585617195,"is_pvip":false,"replies":[{"id":"75167","content":"建议从整体架构安全性角度来考虑这个问题，要看你两个内网的应用性质了。<br><br>如果公有云VPC和自家内网的安全等级要求一致，两边应用网络互通不会有潜在安全问题的话，我会推荐直接site-to-site VPN，因为这是最简明的全内网架构。否则就走代理，让两边尽量隔离，只开专门的小口子。","user_name":"作者回复","user_name_real":"何恺铎","uid":"1011765","ctime":1585665574,"ip_address":"","comment_id":200539,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1585617195","product_id":100046901,"comment_content":"关于第二个问题，我确实有点疑问。目前我所在的组织的应用通过内网的Jenkins来构建，推送到公有云的服务器上来部署。如果公有云上的机器是NAT上网的，就推不倒，我试过使用SSH转发应该也是不行的。如果用VPN来连接，感觉是要Jenkins所在的内网网络和公有云进行site-to-site VPN，或者Jenkins主机上安装VPN客户端，但是不管哪种感觉都会比较慢。所以我想是否能在公有云的public subnet上搭建一个正向代理的server，配置用户认证，提供给Jenkins来使用。<br>虽然从CICD的架构上来讲，我个人认为生产环境的应用构建应该放在生产环境内执行，内网仅仅和公有云的代码仓库同步代码即可……想听听老师的意见。","like_count":0,"discussions":[{"author":{"id":1011765,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/70/35/28758547.jpg","nickname":"何恺铎","note":"","ucode":"D7EDA2A7A8978E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490059,"discussion_content":"建议从整体架构安全性角度来考虑这个问题，要看你两个内网的应用性质了。\n\n如果公有云VPC和自家内网的安全等级要求一致，两边应用网络互通不会有潜在安全问题的话，我会推荐直接site-to-site VPN，因为这是最简明的全内网架构。否则就走代理，让两边尽量隔离，只开专门的小口子。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585665574,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":189391,"user_name":"可可","can_delete":false,"product_type":"c1","uid":1219666,"ip_address":"","ucode":"FD9516F133E134","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM7lTQQeIDIXrU4u1wsydv5tWaaz4JDwVmHeibOWpw05QDSk57rBJFEQRPiavywZjiafSdYTjk0hFWUGw/132","comment_is_top":false,"comment_ctime":1584509999,"is_pvip":false,"replies":[{"id":"73201","content":"如果把虚拟机“设为网关”，你这相当于是作为代理了，对其他机器的代码或者设置有侵入性。而且这台虚机有单点风险，高可用性也难以保证。","user_name":"作者回复","user_name_real":"何恺铎","uid":"1011765","ctime":1584630394,"ip_address":"","comment_id":189391,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1584509999","product_id":100046901,"comment_content":"NAT网关也是要单独收费的啊，另外绑定EIP的时候也需要费用，等于2笔费用了。<br>能不能将子网中某台机器设为网关，让其他不能访问外网的同一子网内的机器通过这台网关机器访问外网呢？","like_count":0,"discussions":[{"author":{"id":1011765,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/70/35/28758547.jpg","nickname":"何恺铎","note":"","ucode":"D7EDA2A7A8978E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487685,"discussion_content":"如果把虚拟机“设为网关”，你这相当于是作为代理了，对其他机器的代码或者设置有侵入性。而且这台虚机有单点风险，高可用性也难以保证。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584630394,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":189343,"user_name":"吴小智","can_delete":false,"product_type":"c1","uid":1310798,"ip_address":"","ucode":"C7C9F58B5C9F7B","user_header":"https://static001.geekbang.org/account/avatar/00/14/00/4e/be2b206b.jpg","comment_is_top":false,"comment_ctime":1584502877,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584502877","product_id":100046901,"comment_content":"网络这一块有点难理解，多看几遍。","like_count":0},{"had_liked":false,"id":188443,"user_name":"北卡","can_delete":false,"product_type":"c1","uid":1218128,"ip_address":"","ucode":"2D947A61689FC6","user_header":"https://static001.geekbang.org/account/avatar/00/12/96/50/bde525b1.jpg","comment_is_top":false,"comment_ctime":1584354316,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584354316","product_id":100046901,"comment_content":"老师的课程渐入佳境，很棒","like_count":0},{"had_liked":false,"id":188079,"user_name":"夜空中最亮的星","can_delete":false,"product_type":"c1","uid":1267566,"ip_address":"","ucode":"ADC3E7B6789955","user_header":"https://static001.geekbang.org/account/avatar/00/13/57/6e/b6795c44.jpg","comment_is_top":false,"comment_ctime":1584320470,"is_pvip":false,"replies":[{"id":"72947","content":"内网带宽取决于机型，参见我对其他问题的回答。dnat&#47;slb回答正确~","user_name":"作者回复","user_name_real":"何恺铎","uid":"1011765","ctime":1584455831,"ip_address":"","comment_id":188079,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1584320470","product_id":100046901,"comment_content":"vpc内部是万M吧，dnet slb 等引入","like_count":0,"discussions":[{"author":{"id":1011765,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/70/35/28758547.jpg","nickname":"何恺铎","note":"","ucode":"D7EDA2A7A8978E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487334,"discussion_content":"内网带宽取决于机型，参见我对其他问题的回答。dnat/slb回答正确~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584455831,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}