{"id":103944,"title":"09丨子查询：子查询的种类都有哪些，如何提高子查询的性能？","content":"<p>上节课我讲到了聚集函数，以及如何对数据进行分组统计，可以说我们之前讲的内容都是围绕单个表的SELECT查询展开的，实际上SQL还允许我们进行子查询，也就是嵌套在查询中的查询。这样做的好处是可以让我们进行更复杂的查询，同时更加容易理解查询的过程。因为很多时候，我们无法直接从数据表中得到查询结果，需要从查询结果集中再次进行查询，才能得到想要的结果。这个“查询结果集”就是今天我们要讲的子查询。</p><p>通过今天的文章，我希望你可以掌握以下的内容：</p><ol>\n<li>子查询可以分为关联子查询和非关联子查询。我会举一个NBA数据库查询的例子，告诉你什么是关联子查询，什么是非关联子查询；</li>\n<li>子查询中有一些关键词，可以方便我们对子查询的结果进行比较。比如存在性检测子查询，也就是EXISTS子查询，以及集合比较子查询，其中集合比较子查询关键词有IN、SOME、 ANY和ALL，这些关键词在子查询中的作用是什么；</li>\n<li>子查询也可以作为主查询的列，我们如何使用子查询作为计算字段出现在SELECT查询中呢？</li>\n</ol><h2>什么是关联子查询，什么是非关联子查询</h2><p>子查询虽然是一种嵌套查询的形式，不过我们依然可以依据子查询是否执行多次，从而将子查询划分为关联子查询和非关联子查询。</p><!-- [[[read_end]]] --><p>子查询从数据表中查询了数据结果，如果这个数据结果只执行一次，然后这个数据结果作为主查询的条件进行执行，那么这样的子查询叫做非关联子查询。</p><p>同样，如果子查询需要执行多次，即采用循环的方式，先从外部查询开始，每次都传入子查询进行查询，然后再将结果反馈给外部，这种嵌套的执行方式就称为关联子查询。</p><p>单说概念有点抽象，我们用数据表举例说明一下。这里我创建了NBA球员数据库，SQL文件你可以从<a href=\"https://github.com/cystanford/sql_nba_data\">GitHub</a>上下载。</p><p>文件中一共包括了5张表，player表为球员表，team为球队表，team_score为球队比赛表，player_score为球员比赛成绩表，height_grades为球员身高对应的等级表。</p><p>其中player表，也就是球员表，一共有37个球员，如下所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/ba/ef/ba91ef95f95bca52a83682a4310918ef.png?wh=993*548\" alt=\"\"><br>\nteam表为球队表，一共有3支球队，如下所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/a6/e9/a65d5b04d416bf35f1ea16da5f05cee9.png?wh=772*296\" alt=\"\"></p><p>team_score表为球队比赛成绩表，一共记录了两场比赛的成绩，如下所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/11/93/1156804730d29e0c1367fbf31002d693.png?wh=1217*194\" alt=\"\"><br>\nplayer_score表为球员比赛成绩表，记录了一场比赛中球员的表现。这张表一共包括19个字段，代表的含义如下：</p><p><img src=\"https://static001.geekbang.org/resource/image/af/3a/afc5c950c6fdf9b9c399748bf340843a.png?wh=1198*437\" alt=\"\"><br>\n其中shoot_attempts代表总出手的次数，它等于二分球出手和三分球出手次数的总和。比如2019年4月1日，韦恩·艾灵顿在底特律活塞和印第安纳步行者的比赛中，总出手次数为19，总命中10，三分球13投4中，罚球4罚2中，因此总分score=(10-4)×2+4×3+2=26，也就是二分球得分12+三分球得分12+罚球得分2=26。</p><p>需要说明的是，通常在工作中，数据表的字段比较多，一开始创建的时候会知道每个字段的定义，过了一段时间再回过头来看，对当初的定义就不那么确定了，容易混淆字段，解决这一问题最好的方式就是做个说明文档，用实例举例。</p><p>比如shoot_attempts是总出手次数（这里的总出手次数=二分球出手次数+三分球出手次数，不包括罚球的次数），用上面提到的韦恩·艾灵顿的例子做补充说明，再回过头来看这张表的时候，就可以很容易理解每个字段的定义了。</p><p>我们以NBA球员数据表为例，假设我们想要知道哪个球员的身高最高，最高身高是多少，就可以采用子查询的方式：</p><pre><code>SQL: SELECT player_name, height FROM player WHERE height = (SELECT max(height) FROM player)\n</code></pre><p>运行结果：（1条记录）</p><p><img src=\"https://static001.geekbang.org/resource/image/13/b2/133c583fe0317081d13ae99ec17123b2.png?wh=910*140\" alt=\"\"><br>\n你能看到，通过<code>SELECT max(height) FROM player</code>可以得到最高身高这个数值，结果为2.16，然后我们再通过player这个表，看谁具有这个身高，再进行输出，这样的子查询就是非关联子查询。</p><p>如果子查询的执行依赖于外部查询，通常情况下都是因为子查询中的表用到了外部的表，并进行了条件关联，因此每执行一次外部查询，子查询都要重新计算一次，这样的子查询就称之为关联子查询。比如我们想要查找每个球队中大于平均身高的球员有哪些，并显示他们的球员姓名、身高以及所在球队ID。</p><p>首先我们需要统计球队的平均身高，即<code>SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id</code>，然后筛选身高大于这个数值的球员姓名、身高和球队ID，即：</p><pre><code>SELECT player_name, height, team_id FROM player AS a WHERE height &gt; (SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id)\n</code></pre><p>运行结果：（18条记录）</p><p><img src=\"https://static001.geekbang.org/resource/image/a5/ac/a53fc11e20a44453176bea25d3e789ac.png?wh=941*384\" alt=\"\"></p><p>这里我们将player表复制成了表a和表b，每次计算的时候，需要将表a中的team_id传入从句，作为已知值。因为每次表a中的team_id可能是不同的，所以是关联子查询。如果是非关联子查询，那么从句计算的结果是固定的才可以。</p><h2>EXISTS子查询</h2><p>关联子查询通常也会和EXISTS一起来使用，EXISTS子查询用来判断条件是否满足，满足的话为True，不满足为False。</p><p>比如我们想要看出场过的球员都有哪些，并且显示他们的姓名、球员ID和球队ID。在这个统计中，是否出场是通过player_score这张表中的球员出场表现来统计的，如果某个球员在player_score中有出场记录则代表他出场过，这里就使用到了EXISTS子查询，即<code>EXISTS (SELECT player_id FROM player_score WHERE player.player_id = player_score.player_id)</code>，然后将它作为筛选的条件，实际上也是关联子查询，即：</p><pre><code>SQL：SELECT player_id, team_id, player_name FROM player WHERE EXISTS (SELECT player_id FROM player_score WHERE player.player_id = player_score.player_id)\n</code></pre><p>运行结果：（19条记录）</p><p><img src=\"https://static001.geekbang.org/resource/image/a6/d3/a6a447a53b9cc158db5f4ffb905aaed3.png?wh=935*379\" alt=\"\"><br>\n同样，NOT EXISTS就是不存在的意思，我们也可以通过NOT EXISTS查询不存在于player_score表中的球员信息，比如主表中的player_id不在子表player_score中，判断语句为<code>NOT EXISTS (SELECT player_id FROM player_score WHERE player.player_id = player_score.player_id)</code>。整体的SQL语句为：</p><pre><code>SQL: SELECT player_id, team_id, player_name FROM player WHERE NOT EXISTS (SELECT player_id FROM player_score WHERE player.player_id = player_score.player_id)\n</code></pre><p>运行结果：（18条记录）</p><p><img src=\"https://static001.geekbang.org/resource/image/fb/e0/fb0a34e0144a6c0ba9a48d1da4dfade0.png?wh=933*376\" alt=\"\"></p><h2>集合比较子查询</h2><p>集合比较子查询的作用是与另一个查询结果集进行比较，我们可以在子查询中使用IN、ANY、ALL和SOME操作符，它们的含义和英文意义一样：</p><p><img src=\"https://static001.geekbang.org/resource/image/d3/2c/d3867c22616cbdf88ed83865604e8e2c.png?wh=1207*254\" alt=\"\"></p><p>还是通过上面那个例子，假设我们想要看出场过的球员都有哪些，可以采用IN子查询来进行操作：</p><pre><code>SELECT player_id, team_id, player_name FROM player WHERE player_id in (SELECT player_id FROM player_score WHERE player.player_id = player_score.player_id)\n</code></pre><p>你会发现运行结果和上面的是一样的，那么问题来了，既然IN和EXISTS都可以得到相同的结果，那么我们该使用IN还是EXISTS呢？</p><p>我们可以把这个模式抽象为：</p><pre><code>SELECT * FROM A WHERE cc IN (SELECT cc FROM B)\n</code></pre><pre><code>SELECT * FROM A WHERE EXIST (SELECT cc FROM B WHERE B.cc=A.cc)\n</code></pre><p>实际上在查询过程中，在我们对cc列建立索引的情况下，我们还需要判断表A和表B的大小。在这里例子当中，表A指的是player表，表B指的是player_score表。如果表A比表B大，那么IN子查询的效率要比EXIST子查询效率高，因为这时B表中如果对cc列进行了索引，那么IN子查询的效率就会比较高。</p><p>同样，如果表A比表B小，那么使用EXISTS子查询效率会更高，因为我们可以使用到A表中对cc列的索引，而不用从B中进行cc列的查询。</p><p>了解了IN查询后，我们来看下ANY和ALL子查询。刚才讲到了ANY和ALL都需要使用比较符，比较符包括了（&gt;）（=）（&lt;）（&gt;=）（&lt;=）和（&lt;&gt;）等。</p><p>如果我们想要查询球员表中，比印第安纳步行者（对应的team_id为1002）中任意一个球员身高高的球员信息，并且输出他们的球员ID、球员姓名和球员身高，该怎么写呢？首先我们需要找出所有印第安纳步行者队中的球员身高，即<code>SELECT height FROM player WHERE team_id = 1002</code>，然后使用ANY子查询即：</p><pre><code>SQL: SELECT player_id, player_name, height FROM player WHERE height &gt; ANY (SELECT height FROM player WHERE team_id = 1002)\n</code></pre><p>运行结果：（35条记录）</p><p><img src=\"https://static001.geekbang.org/resource/image/45/da/4547b4671d2727eb5075e0c050eac4da.png?wh=940*377\" alt=\"\"><br>\n运行结果为35条，你发现有2个人的身高是不如印第安纳步行者的所有球员的。</p><p>同样，如果我们想要知道比印第安纳步行者（对应的team_id为1002）中所有球员身高都高的球员的信息，并且输出球员ID、球员姓名和球员身高，该怎么写呢？</p><pre><code>SQL: SELECT player_id, player_name, height FROM player WHERE height &gt; ALL (SELECT height FROM player WHERE team_id = 1002)\n</code></pre><p>运行结果：（1条记录）</p><p><img src=\"https://static001.geekbang.org/resource/image/b9/b5/b910c7a40a8cfbde7d47409afe5171b5.png?wh=933*134\" alt=\"\"><br>\n我们能看到比印第安纳步行者所有球员都高的球员，在player这张表（一共37个球员）中只有索恩·马克。</p><p>需要强调的是ANY、ALL关键字必须与一个比较操作符一起使用。因为如果你不使用比较操作符，就起不到集合比较的作用，那么使用ANY和ALL就没有任何意义。</p><h2>将子查询作为计算字段</h2><p>我刚才讲了子查询的几种用法，实际上子查询也可以作为主查询的计算字段。比如我想查询每个球队的球员数，也就是对应team这张表，我需要查询相同的team_id在player这张表中所有的球员数量是多少。</p><pre><code>SQL: SELECT team_name, (SELECT count(*) FROM player WHERE player.team_id = team.team_id) AS player_num FROM team\n</code></pre><p>运行结果：（3条记录）</p><p><img src=\"https://static001.geekbang.org/resource/image/b3/ae/b39cee43eb0545592e54c5ce533cd8ae.png?wh=899*255\" alt=\"\"><br>\n你能看到，在player表中只有底特律活塞和印第安纳步行者的球员数据，所以它们的player_num不为0，而亚特兰大老鹰的player_num等于0。在查询的时候，我将子查询<code>SELECT count(*) FROM player WHERE player.team_id = team.team_id</code>作为了计算字段，通常我们需要给这个计算字段起一个别名，这里我用的是player_num，因为子查询的语句比较长，使用别名更容易理解。</p><h2>总结</h2><p>今天我讲解了子查询的使用，按照子查询执行的次数，我们可以将子查询分成关联子查询和非关联子查询，其中非关联子查询与主查询的执行无关，只需要执行一次即可，而关联子查询，则需要将主查询的字段值传入子查询中进行关联查询。</p><p>同时，在子查询中你可能会使用到EXISTS、IN、ANY、ALL和SOME等关键字。在某些情况下使用EXISTS和IN可以得到相同的效果，具体使用哪个执行效率更高，则需要看字段的索引情况以及表A和表B哪个表更大。同样，IN、ANY、ALL、SOME这些关键字是用于集合比较的，SOME是ANY的别名，当我们使用ANY或ALL的时候，一定要使用比较操作符。</p><p>最后，我讲解了如何使用子查询作为计算字段，把子查询的结果作为主查询的列。</p><p>SQL中，子查询的使用大大增强了SELECT查询的能力，因为很多时候查询需要从结果集中获取数据，或者需要从同一个表中先计算得出一个数据结果，然后与这个数据结果（可能是某个标量，也可能是某个集合）进行比较。</p><p><img src=\"\" alt=\"\"></p><p>我今天讲解了子查询的使用，其中讲到了EXISTS和IN子查询效率的比较，当查询字段进行了索引时，主表A大于从表B，使用IN子查询效率更高，相反主表A小于从表B时，使用EXISTS子查询效率更高，同样，如果使用NOT IN子查询和NOT EXISTS子查询，在什么情况下，哪个效率更高呢？</p><p>最后请你使用子查询，编写SQL语句，得到场均得分大于20的球员。场均得分从player_score表中获取，同时你需要输出球员的ID、球员姓名以及所在球队的ID信息。</p><p>欢迎在评论区写下你的思考，也欢迎点击请朋友读把这篇文章分享给你的朋友或者同事。</p>","comments":[{"had_liked":true,"id":109055,"user_name":"看，有只猪","can_delete":false,"product_type":"c1","uid":1137727,"ip_address":"","ucode":"F9BB302BC71CE8","user_header":"https://static001.geekbang.org/account/avatar/00/11/5c/3f/34e5c750.jpg","comment_is_top":false,"comment_ctime":1561953055,"is_pvip":true,"replies":[{"id":"78630","content":"总结的不错","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587992936,"ip_address":"","comment_id":109055,"utype":1}],"discussion_count":11,"race_medal":0,"score":"714526524191","product_id":100029501,"comment_content":"IN表是外边和内表进行hash连接，是先执行子查询。<br>EXISTS是对外表进行循环，然后在内表进行查询。<br>因此如果外表数据量大，则用IN，如果外表数据量小，也用EXISTS。<br>IN有一个缺陷是不能判断NULL，因此如果字段存在NULL值，则会出现返回，因为最好使用NOT EXISTS。<br>","like_count":166,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456228,"discussion_content":"总结的不错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587992936,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1044202,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ee/ea/c8136dfd.jpg","nickname":"草戊","note":"","ucode":"F1B0CB0A4FA762","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377913,"discussion_content":"学生比老师讲的明白，这课有点水","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1622961875,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1661704,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","nickname":"丁丁历险记","note":"","ucode":"A43829E454C067","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374375,"discussion_content":"还是你讲的到位。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1621155890,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1307012,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f1/84/7d21bd9e.jpg","nickname":"Goal","note":"","ucode":"C337CD4C7E07B0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":732,"discussion_content":"in\t\t# 自动忽略空值","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1561990674,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1118111,"avatar":"https://static001.geekbang.org/account/avatar/00/11/0f/9f/f4b06bd5.jpg","nickname":"见南山","note":"","ucode":"6A8BB82B7573CA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":358520,"discussion_content":"就需要这样简单明了的评论，牛逼","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1615991081,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2527979,"avatar":"https://static001.geekbang.org/account/avatar/00/26/92/eb/e530c2d0.jpg","nickname":"姬遇","note":"","ucode":"4A1617750FC3A9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577988,"discussion_content":"你才是真的讲明白了，讲师说的一堆隔靴搔痒","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656462955,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1365206,"avatar":"https://static001.geekbang.org/account/avatar/00/14/d4/d6/1d4543ac.jpg","nickname":"云海","note":"","ucode":"0C6CA0BE58EA21","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388941,"discussion_content":"技术的问题可以从业务层面解决。目前很多互联网公司的DB建表规范都是不允许字段为null的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629075803,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1362563,"avatar":"https://static001.geekbang.org/account/avatar/00/14/ca/83/684361be.jpg","nickname":"永降不息之雨","note":"","ucode":"087A934F68E445","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":132148,"discussion_content":"前提是不是必须有索引？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578883821,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1340120,"avatar":"https://static001.geekbang.org/account/avatar/00/14/72/d8/9eedbc5e.jpg","nickname":"FreeMason","note":"","ucode":"3D58AC2F9AB345","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":36542,"discussion_content":"IN 不能判断 NULL ，确定吗？是什么数据库及数据库版本","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571391247,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1186807,"avatar":"https://static001.geekbang.org/account/avatar/00/12/1b/f7/45e8b64a.jpg","nickname":"Fire","note":"","ucode":"4A2C50B77EDB2C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1340120,"avatar":"https://static001.geekbang.org/account/avatar/00/14/72/d8/9eedbc5e.jpg","nickname":"FreeMason","note":"","ucode":"3D58AC2F9AB345","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":299188,"discussion_content":"用上几节说的那个王者荣耀的例子来试验下，就能明白in忽略null的意思了：\nSELECT * FROM heros WHERE role_assist IN (SELECT role_assist FROM heros GROUP BY role_assist);\nSELECT * FROM heros WHERE EXISTS (SELECT role_assist FROM heros GROUP BY role_assist);\nSELECT role_assist FROM heros GROUP BY role_assist这个子查询里存在null，使用in的查询会忽略role_assist为null的记录，而exists就会把role_assist为null的记录也一并查出来。","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1597589051,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":36542,"ip_address":""},"score":299188,"extra":""}]},{"author":{"id":1087726,"avatar":"https://static001.geekbang.org/account/avatar/00/10/98/ee/9d162043.jpg","nickname":"文艺科技青年","note":"","ucode":"4801899BC41B13","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6409,"discussion_content":"膜拜一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566890806,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109872,"user_name":"humor","can_delete":false,"product_type":"c1","uid":1181867,"ip_address":"","ucode":"9B48C4C7BEC92C","user_header":"https://static001.geekbang.org/account/avatar/00/12/08/ab/caec7bca.jpg","comment_is_top":false,"comment_ctime":1562123488,"is_pvip":false,"replies":[{"id":"39991","content":"索引是个前提，其实和选择与否 还是要看表的大小。选择的标准，你可以理解为： 小表驱动大表。这种方式下效率是最高的。比如<br>SELECT * FROM A WHERE cc IN (SELECT cc FROM B)<br>SELECT * FROM A WHERE EXIST (SELECT cc FROM B WHERE B.cc=A.cc)<br>当A小于B时，用EXIST。因为EXIST的实现，相当于外表循环，实现的逻辑类似于：<br>for i in A<br>    for j in B<br>        if j.cc == i.cc then ...<br><br>当B小于A时，用IN，因为实现的逻辑类似于：<br>for i in B<br>    for j in A<br>        if j.cc == i.cc then ...<br>所以哪个表小就用哪个表来驱动，A表小 就用EXIST，B表小 就用IN","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1562211643,"ip_address":"","comment_id":109872,"utype":1}],"discussion_count":19,"race_medal":0,"score":"375224278240","product_id":100029501,"comment_content":"exist和in的区别这一块，感觉没有讲清楚呀，我听下来还是不太明白哪种情况应该用in，哪种情况应该用exists。选择的标准是看能否使用表的索引吗？","like_count":88,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456617,"discussion_content":"索引是个前提，其实和选择与否 还是要看表的大小。选择的标准，你可以理解为： 小表驱动大表。这种方式下效率是最高的。比如\nSELECT * FROM A WHERE cc IN (SELECT cc FROM B)\nSELECT * FROM A WHERE EXIST (SELECT cc FROM B WHERE B.cc=A.cc)\n当A小于B时，用EXIST。因为EXIST的实现，相当于外表循环，实现的逻辑类似于：\nfor i in A\n    for j in B\n        if j.cc == i.cc then ...\n\n当B小于A时，用IN，因为实现的逻辑类似于：\nfor i in B\n    for j in A\n        if j.cc == i.cc then ...\n所以哪个表小就用哪个表来驱动，A表小 就用EXIST，B表小 就用IN","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562211643,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1246178,"avatar":"https://static001.geekbang.org/account/avatar/00/13/03/e2/5768d26e.jpg","nickname":"inrtyx","note":"","ucode":"81CD18FF34ABAB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":158714,"discussion_content":"由于索引的缘故，里层不用循环！所以才是外层决定效率","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1580617072,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1239546,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKWiaZb7a2JAcIVlXYuZ3iaPfSF6vBbg3yUps6LKpsZarftyXufMHYKJmMKzH3bIpVkDAVNXE9q0oOw/132","nickname":"Mr_scx","note":"","ucode":"28B5CE68A5A339","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1246178,"avatar":"https://static001.geekbang.org/account/avatar/00/13/03/e2/5768d26e.jpg","nickname":"inrtyx","note":"","ucode":"81CD18FF34ABAB","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":298123,"discussion_content":"请问能在具体解释一下吗？为什么内层不用循环？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597198104,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":158714,"ip_address":""},"score":298123,"extra":""},{"author":{"id":1690807,"avatar":"https://static001.geekbang.org/account/avatar/00/19/cc/b7/af6ef83d.jpg","nickname":"抢小孩子糖吃","note":"","ucode":"09F302FC76582A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1239546,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKWiaZb7a2JAcIVlXYuZ3iaPfSF6vBbg3yUps6LKpsZarftyXufMHYKJmMKzH3bIpVkDAVNXE9q0oOw/132","nickname":"Mr_scx","note":"","ucode":"28B5CE68A5A339","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311542,"discussion_content":"外层需要循环是因为里面还有一个for ，所以需要循环，\n内层的for不用循环是因为\n        if j.cc == i.cc then ...\n这个语句只需要用索引就能很快找到j.cc ==i.cc 不需要一遍一遍的循环遍历整个表","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1602391215,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":298123,"ip_address":""},"score":311542,"extra":""},{"author":{"id":2962599,"avatar":"https://static001.geekbang.org/account/avatar/00/2d/34/a7/52c4ea60.jpg","nickname":"年少挽滑稽世无双","note":"","ucode":"793DCBDE25A07B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1246178,"avatar":"https://static001.geekbang.org/account/avatar/00/13/03/e2/5768d26e.jpg","nickname":"inrtyx","note":"","ucode":"81CD18FF34ABAB","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":586708,"discussion_content":"醍醐灌顶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662449522,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":158714,"ip_address":"四川"},"score":586708,"extra":""}]},{"author":{"id":1919541,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/4a/35/66caeed9.jpg","nickname":"完美坚持","note":"","ucode":"AE0261D8DDEF64","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375768,"discussion_content":"SELECT * FROM A WHERE cc IN (SELECT cc FROM B)\nSELECT * FROM A WHERE EXIST (SELECT cc FROM B WHERE B.cc=A.cc)\nIN 那里是可以利用表A的索引，\nEXISTS实现则是用到 B 中对cc 的索引，\n后者更好理解，因为其中子查询的语句是 (SELECT cc FROM B WHERE B.cc=A.cc) 这里面可以认为 A.cc 是给定的，每次计算子查询的时候，就会利用到B中对cc的索引。\n所以 B 更大的时候用 EXISTS 会效率更高。\n前者理解的话，可以这样理解 把 WHERE cc IN (SELECT cc FROM B) 理解为对 A 中的cc进行一个筛选，我们知道 \nSELECT * FROM A WHERE cc = 某个给定值\nSELECT * FROM A WHERE cc IN (SELECT cc FROM B)\n也是类似的，可以利用到A中的索引，所以表A更大的时候，用IN效率更高。\n-----------------------------\n哪个表大，就对哪个表利用索引来提高效率\n有一个关键点，就是要理解，为什么\nIN实现是利用了表A对cc的索引；而EXISTS的实现则是利用了表B对cc的索引——可以利用子查询中是否有 WHERE 来判断是否利用表B中对cc的索引，只有EXISTS实现的时候，子查询内部有WHERE B.cc=A.cc\nSELECT * FROM A WHERE EXIST (SELECT cc FROM B WHERE B.cc=A.cc)\n\n还有一个点，听老师的意思，比如“因为EXIST的实现，相当于外表循环”，似乎是一个表循环，一个表可以利用索引。\n比如对EXISTS，子查询直接就会返回T/F，这样对表A就只需要循环因此就好了（所以外表是表A?）\n而IN:\nSELECT * FROM A WHERE cc IN (SELECT cc FROM B)\n注意这里子查询可是要对B进行循环的\n\n循环又比索引要费时，因此我们尽可能对小表循环，而大表进行索引。\nIN 实现：表A索引，表B循环 适合表A>B\nEXIST : 表A循环，表B索引  适合 表A<B","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1621845518,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1012325,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/72/65/68bd8177.jpg","nickname":"雪飞鸿","note":"","ucode":"65D7B030828809","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2332,"discussion_content":"for i in A\n    for j in B\n与\nfor i in B\n    for j in A\n的时间复杂度不都是O(nm)吗","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1563494785,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":7,"child_discussions":[{"author":{"id":1488280,"avatar":"https://static001.geekbang.org/account/avatar/00/16/b5/98/ffaf2aca.jpg","nickname":"Ronnyz","note":"","ucode":"9F34527B1D343D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1012325,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/72/65/68bd8177.jpg","nickname":"雪飞鸿","note":"","ucode":"65D7B030828809","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":2505,"discussion_content":"应该是指遍历顺序不一样，对单次查询来说就时间不一样","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1563731583,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":2332,"ip_address":""},"score":2505,"extra":""},{"author":{"id":1573288,"avatar":"https://static001.geekbang.org/account/avatar/00/18/01/a8/2662a8d1.jpg","nickname":"小白鼠丶","note":"","ucode":"76EFABC5DF8AEB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1012325,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/72/65/68bd8177.jpg","nickname":"雪飞鸿","note":"","ucode":"65D7B030828809","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":7545,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567561642,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":2332,"ip_address":""},"score":7545,"extra":""},{"author":{"id":1336951,"avatar":"https://static001.geekbang.org/account/avatar/00/14/66/77/194ba21d.jpg","nickname":"lzh","note":"","ucode":"C3D83DF4230109","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1012325,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/72/65/68bd8177.jpg","nickname":"雪飞鸿","note":"","ucode":"65D7B030828809","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":37715,"discussion_content":"文章的例子，小表都是没有用上索引的，如“SELECT cc FROM B”和“FROM A WHERE EXIST”，那就走全表扫描，这样应该在小表上走全表扫描，然后作为WHERE条件在大表中查，大表中是可以用上索引的。要是反过来，在大表中全表扫描，虽然到时候小表上也能用到索引，但是大表全表扫描时间长了...也就是所谓的小表驱动大表","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1571660110,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":2332,"ip_address":""},"score":37715,"extra":""}]},{"author":{"id":1463474,"avatar":"https://static001.geekbang.org/account/avatar/00/16/54/b2/5ea0b709.jpg","nickname":"Danpier","note":"","ucode":"11E208FDE34961","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2482,"discussion_content":"if j.cc == i.cc then 之后是不是应该有个 break，不然实际执行时间复杂度完全没区别","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1563702228,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1115465,"avatar":"https://static001.geekbang.org/account/avatar/00/11/05/49/11b69b1f.jpg","nickname":"GeXeLr","note":"","ucode":"9FE5463B240C35","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1463474,"avatar":"https://static001.geekbang.org/account/avatar/00/16/54/b2/5ea0b709.jpg","nickname":"Danpier","note":"","ucode":"11E208FDE34961","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":276283,"discussion_content":"加了break有多个相等怎么办？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590849168,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":2482,"ip_address":""},"score":276283,"extra":""}]},{"author":{"id":1919541,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/4a/35/66caeed9.jpg","nickname":"完美坚持","note":"","ucode":"AE0261D8DDEF64","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375765,"discussion_content":"表A和表B哪个是内表，哪个是外表","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621844597,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1688372,"avatar":"","nickname":"你的代码有灵魂吗？","note":"","ucode":"0A276F30307965","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364923,"discussion_content":"依然没有明白老师关于 in 和 exists的解释，主要有以下几个疑点：\n（1）怎么去断定执行in 或者 exists时，哪张表是外部循环的表，哪张又是内部循环的表？\n（2）哪张表小就用哪张表驱动，这个是一个结论，但其中的缘由依然无从知晓；","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617665246,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1246178,"avatar":"https://static001.geekbang.org/account/avatar/00/13/03/e2/5768d26e.jpg","nickname":"inrtyx","note":"","ucode":"81CD18FF34ABAB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":158716,"discussion_content":"没有索引的话，两个的效率应该是一样的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580617101,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":true,"id":109118,"user_name":"Sam","can_delete":false,"product_type":"c1","uid":1309087,"ip_address":"","ucode":"AE9044BE8BD2B9","user_header":"https://static001.geekbang.org/account/avatar/00/13/f9/9f/515d1686.jpg","comment_is_top":false,"comment_ctime":1561965850,"is_pvip":false,"replies":[{"id":"78623","content":"总结的不错","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587992070,"ip_address":"","comment_id":109118,"utype":1}],"discussion_count":2,"race_medal":0,"score":"229195232538","product_id":100029501,"comment_content":"not in是先执行子查询，得到一个结果集，将结果集代入外层谓词条件执行主查询，子查询只需要执行一次；<br>not exists是先从主查询中取得一条数据，再代入到子查询中，执行一次子查询，判断子查询是否能返回结果，主查询有多少条数据，子查询就要执行多少次。<br>         ","like_count":54,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456251,"discussion_content":"总结的不错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587992070,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1172090,"avatar":"https://static001.geekbang.org/account/avatar/00/11/e2/7a/38a27e47.jpg","nickname":"蓦然回首","note":"","ucode":"B17658DCFE6402","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348089,"discussion_content":"这是不是说NOT IN比NOT EXIST效率要高？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612424635,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":true,"id":137529,"user_name":"hsj","can_delete":false,"product_type":"c1","uid":1210969,"ip_address":"","ucode":"C0A6EB8F3A36A1","user_header":"https://static001.geekbang.org/account/avatar/00/12/7a/59/422bacf5.jpg","comment_is_top":false,"comment_ctime":1569766870,"is_pvip":false,"replies":[{"id":"63774","content":"总结的不错！","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577541049,"ip_address":"","comment_id":137529,"utype":1}],"discussion_count":7,"race_medal":0,"score":"151893622230","product_id":100029501,"comment_content":"SELECT * FROM A WHERE cc IN (SELECT cc FROM B)<br>SELECT * FROM A WHERE EXIST (SELECT cc FROM B WHERE B.cc=A.cc)<br>A 表有 n 条数据，B 表有 m 条数据<br>两条语句的执行效率（假设都用 btree 索引）<br>用 in ：m * log (n)<br>用 exists： n * log (m)<br>所以小表驱动大表能够大幅度提高执行速度","like_count":35,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469138,"discussion_content":"总结的不错！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577541049,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2962599,"avatar":"https://static001.geekbang.org/account/avatar/00/2d/34/a7/52c4ea60.jpg","nickname":"年少挽滑稽世无双","note":"","ucode":"793DCBDE25A07B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586711,"discussion_content":"666","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662450663,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"四川"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2475057,"avatar":"https://static001.geekbang.org/account/avatar/00/25/c4/31/65e5e59b.jpg","nickname":"Jin","note":"","ucode":"FDEC57C4A03005","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":399014,"discussion_content":"简单明了，牛逼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632886368,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1995515,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/72/fb/e918f97f.jpg","nickname":"coder67","note":"","ucode":"21EB2FAD7952D6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391132,"discussion_content":"索引底层是B+树，查找复杂度log(n)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630310611,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1397351,"avatar":"https://static001.geekbang.org/account/avatar/00/15/52/67/fcba0967.jpg","nickname":"zapup","note":"","ucode":"388D6BB5D7B137","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288932,"discussion_content":"秀秀秀，一语道破","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593935485,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1542987,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/4b/fa52d222.jpg","nickname":"行则将至","note":"","ucode":"DB972F2DF059C4","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":110752,"discussion_content":"这个log(n)是啥意思啊?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577754683,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1968721,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/unkzY52hVDjTmZJGNkrBR75tFs4XTGBoYYcOYkIcPvHlQrLibwc94aBfj1uWiawoKeEMwHbkvgThXZarfoP8Dzag/132","nickname":"她","note":"","ucode":"FAC6851866C9C7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1542987,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/4b/fa52d222.jpg","nickname":"行则将至","note":"","ucode":"DB972F2DF059C4","race_medal":1,"user_type":1,"is_pvip":false},"discussion":{"id":254226,"discussion_content":"应该是复杂度的意思。数据结构与算法中的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588301409,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":110752,"ip_address":""},"score":254226,"extra":""}]}]},{"had_liked":true,"id":109095,"user_name":"Hero","can_delete":false,"product_type":"c1","uid":1012030,"ip_address":"","ucode":"14DD4A09C4FF8F","user_header":"","comment_is_top":false,"comment_ctime":1561960717,"is_pvip":true,"replies":[{"id":"63950","content":"Good Job 总结的不错","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577605717,"ip_address":"","comment_id":109095,"utype":1}],"discussion_count":9,"race_medal":0,"score":"130410979597","product_id":100029501,"comment_content":"1.\tSELECT<br>\tplayer_id,<br>\tteam_id,<br>\tplayer_name <br>FROM<br>\tplayer a <br>WHERE<br>\tEXISTS ( SELECT b.player_id FROM player_score b GROUP BY b.player_id HAVING AVG( b.score ) &gt; 20 and a.player_id = b.player_id);<br>2.SELECT<br>\tplayer_id,<br>\tteam_id,<br>\tplayer_name <br>FROM<br>\tplayer a <br>WHERE<br>\tEXISTS ( SELECT b.player_id FROM player_score b WHERE a.player_id = b.player_id GROUP BY b.player_id HAVING AVG( b.score ) &gt; 20);<br>3.SELECT<br>\tplayer_id,<br>\tteam_id,<br>\tplayer_name <br>FROM<br>\tplayer <br>WHERE<br>\tplayer_id IN ( SELECT player_id FROM player_score GROUP BY player_id HAVING AVG( score ) &gt; 20 );<br>推荐3，因为子查询只会执行一次。2比1好，因为where会先过滤数据行，然后分组，然后对分组过滤。","like_count":31,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456241,"discussion_content":"Good Job 总结的不错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577605717,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1172090,"avatar":"https://static001.geekbang.org/account/avatar/00/11/e2/7a/38a27e47.jpg","nickname":"蓦然回首","note":"","ucode":"B17658DCFE6402","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348077,"discussion_content":"这里WHERE字句的条件和GROUP BY的字段是一样的，WHERE字句后，肯定只剩下指定player_id的记录，完全没必要再GROUP BY，直接写HAVING字句就可以了，测试也是行的通，语法上也没有问题！","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1612422845,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1406527,"avatar":"https://static001.geekbang.org/account/avatar/00/15/76/3f/67096f9c.jpg","nickname":"newTime","note":"","ucode":"658C113B9CE659","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":107576,"discussion_content":"球员的场均分，没有得出。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1577589788,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1172090,"avatar":"https://static001.geekbang.org/account/avatar/00/11/e2/7a/38a27e47.jpg","nickname":"蓦然回首","note":"","ucode":"B17658DCFE6402","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348078,"discussion_content":"目前只在Mysql上面测试过。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612422877,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1103971,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d8/63/e4c28138.jpg","nickname":"春风","note":"","ucode":"76947E35A76C67","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":71654,"discussion_content":"没有看明白为什么你还有group by player_id  ,已经是唯一属性了啊？是想用后面的having？\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575444878,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1406527,"avatar":"https://static001.geekbang.org/account/avatar/00/15/76/3f/67096f9c.jpg","nickname":"newTime","note":"","ucode":"658C113B9CE659","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1103971,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d8/63/e4c28138.jpg","nickname":"春风","note":"","ucode":"76947E35A76C67","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":107578,"discussion_content":"分组过滤掉筛选均分大于20的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577589839,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":71654,"ip_address":""},"score":107578,"extra":""},{"author":{"id":1172090,"avatar":"https://static001.geekbang.org/account/avatar/00/11/e2/7a/38a27e47.jpg","nickname":"蓦然回首","note":"","ucode":"B17658DCFE6402","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1103971,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d8/63/e4c28138.jpg","nickname":"春风","note":"","ucode":"76947E35A76C67","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348075,"discussion_content":"感觉是的，如果直接用原文来的场均得分作为条件来判断，也可以这样写:\nSELECT player_id, player_name, team_id \nFROM player a\nWHERE  \n   (SELECT AVG(score) FROM player_score b WHERE a.player_id = b.player_id) > 20;","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1612422447,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":71654,"ip_address":""},"score":348075,"extra":""},{"author":{"id":1172090,"avatar":"https://static001.geekbang.org/account/avatar/00/11/e2/7a/38a27e47.jpg","nickname":"蓦然回首","note":"","ucode":"B17658DCFE6402","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1103971,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d8/63/e4c28138.jpg","nickname":"春风","note":"","ucode":"76947E35A76C67","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348076,"discussion_content":"聚合函数本来就只有一个结果","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612422479,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":71654,"ip_address":""},"score":348076,"extra":""}]}]},{"had_liked":false,"id":129881,"user_name":"Serendipity","can_delete":false,"product_type":"c1","uid":1370694,"ip_address":"","ucode":"E9C7B39BD8DCCD","user_header":"https://static001.geekbang.org/account/avatar/00/14/ea/46/9c9808a9.jpg","comment_is_top":false,"comment_ctime":1567313299,"is_pvip":false,"replies":[{"id":"63785","content":"后面有些内容是和SQL优化相关的，前面相对基础","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577541848,"ip_address":"","comment_id":129881,"utype":1}],"discussion_count":5,"race_medal":0,"score":"117531430291","product_id":100029501,"comment_content":"我怎么感觉简单的地方讲的比较多，难的地方一笔带过了？看的好懵逼。","like_count":27,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465692,"discussion_content":"后面有些内容是和SQL优化相关的，前面相对基础","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577541848,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2150339,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/45FrSezibbp2L7v0aE8fgL8dyy7bqib5CyTZd9GFG1jhOJOmYibJPRLtorclNia3eFVdHVlta7UgmnZl1ZNjLicYDpw/132","nickname":"进击的小菊","note":"","ucode":"CE86504EBC3C0C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344699,"discussion_content":"我也觉得，感觉没有讲透彻","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1611562370,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1234591,"avatar":"https://static001.geekbang.org/account/avatar/00/12/d6/9f/0213e8a0.jpg","nickname":"🤪HappyJoo","note":"","ucode":"96E1858F06BABA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":101908,"discussion_content":"我也是一直这么觉得的，一度很后悔自己买了这门课。现在想通了，毕竟是一门面对初学者的课程，不能太复杂。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1577317545,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1048028,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/fd/dc/245fee32.jpg","nickname":"张驰皓","note":"","ucode":"448CAA944097E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":93019,"discussion_content":"可能课程的定位比较基础吧，而且也是靠前的基础章节，后面还有更多内容","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576899821,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1069292,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/ec/2d4e9ef8.jpg","nickname":"Dijkstra","note":"","ucode":"BBD6EE65D2FE2B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":73432,"discussion_content":"终于有个明白人了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575559460,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":true,"id":146491,"user_name":"Chuan","can_delete":false,"product_type":"c1","uid":1438352,"ip_address":"","ucode":"FACEC5DAC36A7A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI4akcIyIOXB2OqibTe7FF90hwsBicxkjdicUNTMorGeIictdr3OoMxhc20yznmZWwAvQVThKPFWgOyMw/132","comment_is_top":false,"comment_ctime":1572537973,"is_pvip":false,"replies":[{"id":"78724","content":"IN子查询，是从表计算出来作为已知值，而EXISTS子查询是主表作为已知值传递给从表。<br>基于小表驱动大表的原则，主表A小 就用EXIST，从表B表小 就用IN<br>这里主要看能否用到索引，假设主表A有n条数据，从表B有m条数据，表A和表B中的查询字段采用B+树进行索引，那么两个子查询的执行效率：<br>使用 in ：log (n) * m<br>使用 exists： n * log (m)<br>对于IN子查询，计算出来的结果作为已知值，就可以使得表A（n条数据）可以使用到索引，从而提升检索效率<br>对于EXISTS子查询，外表A作为已知值，传递给从表，可以利用从表B（m条数据）中的索引，从而提升检索效率。<br>（说明log 代表以2为底的对数，即B+树的深度）","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1588039492,"ip_address":"","comment_id":146491,"utype":1}],"discussion_count":2,"race_medal":0,"score":"57407112821","product_id":100029501,"comment_content":"老师，听完这节课，有几个问题，烦请解惑：<br>1. in和子查询结合使用时，子查询中列的索引是否能使用？exist子查询呢？<br>2. 如果针对某个字段（列）添加索引，那么在查询这个字段及内容时，时间复杂度是否从O(n)变为O(1)或者O(logn)？<br>3. 回复中，您关于in和exist的解释，还是有点不理解。查询资料说： 两者除了驱动关系不同，in会缓存结果，但是没法使用索引；而exist不会缓存结果，每次会查数据库，但是不关心内容，只关心是否存在行记录。不知道您看法如何？<br>4. 您回复中，两个都是两层for循环，使得读者理解起来很困难。我觉得是不是可以这么理解：<br>in的子查询中不能使用索引，在获得结果时耗时较久，接近O(n)，所以适合内表小的场景，因为外表大但可以使用索引；exist子查询可以使用索引，同时外表都需要全遍历，所以适合内表大的场景。不过这个理解好像建立在问题1，2的答案之上。<br><br>感觉读者中不理解的蛮多的，网上资料基本上也说得不清不楚，望老师解惑。","like_count":13,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472883,"discussion_content":"IN子查询，是从表计算出来作为已知值，而EXISTS子查询是主表作为已知值传递给从表。\n基于小表驱动大表的原则，主表A小 就用EXIST，从表B表小 就用IN\n这里主要看能否用到索引，假设主表A有n条数据，从表B有m条数据，表A和表B中的查询字段采用B+树进行索引，那么两个子查询的执行效率：\n使用 in ：log (n) * m\n使用 exists： n * log (m)\n对于IN子查询，计算出来的结果作为已知值，就可以使得表A（n条数据）可以使用到索引，从而提升检索效率\n对于EXISTS子查询，外表A作为已知值，传递给从表，可以利用从表B（m条数据）中的索引，从而提升检索效率。\n（说明log 代表以2为底的对数，即B+树的深度）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588039492,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1007753,"avatar":"","nickname":"suke","note":"","ucode":"C0287C31A4F45B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":254006,"discussion_content":"老师你给的例子里面in的语句 关联了外部表，请问如何先去计算内部表结果作为已知值","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588268229,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":111131,"user_name":"OperaX","can_delete":false,"product_type":"c1","uid":1510551,"ip_address":"","ucode":"66947CD04E3B3E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI8mFt5wSkia3yumk409E65JIlGoreva1Q25icTks0XB0EDC7WJ5V0z6zuvgGkI2Zrh5cBXGS5Hea8A/132","comment_is_top":false,"comment_ctime":1562485226,"is_pvip":true,"replies":[{"id":"40484","content":"正确，而且SQL代码结构清晰","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1562541089,"ip_address":"","comment_id":111131,"utype":1}],"discussion_count":2,"race_medal":0,"score":"53102092778","product_id":100029501,"comment_content":"SELECT<br>\tt1.player_id,<br>\tt1.player_name,<br>\tt1.team_id <br>FROM<br>\tplayer t1 <br>WHERE<br>\tt1.player_id IN (<br>\t\tSELECT<br>\t\t\tt2.player_id <br>\t\tFROM<br>\t\t\tplayer_score t2 <br>\t\tGROUP BY<br>\t\t\tt2.player_id <br>\t\tHAVING<br>\t\t( AVG( t2.score ) &gt; 20 ) <br>\t)","like_count":12,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457242,"discussion_content":"正确，而且SQL代码结构清晰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562541089,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3175551,"avatar":"","nickname":"张兴","note":"","ucode":"6BE80A3C026E36","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588096,"discussion_content":"t1 &gt; t2，用 in 没毛病","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663553532,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"上海"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109266,"user_name":"Goal","can_delete":false,"product_type":"c1","uid":1307012,"ip_address":"","ucode":"C337CD4C7E07B0","user_header":"https://static001.geekbang.org/account/avatar/00/13/f1/84/7d21bd9e.jpg","comment_is_top":false,"comment_ctime":1561990478,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"44511663438","product_id":100029501,"comment_content":"# 使用exists<br>SELECT player_name,player_id,team_id from player WHERE EXISTS (SELECT player_id FROM player_score WHERE player.player_id = player_score.player_id and score &gt;20)<br><br># 使用 in<br>SELECT player_name,player_id,team_id from player WHERE player_id IN (SELECT player_id FROM player_score WHERE score &gt;20)<br><br>使用：join 语句<br>SELECT p.player_name,p.player_id,p.team_id,t.score from player AS p JOIN player_score as t WHERE p.player_id = t.player_id\tand t.score &gt;20","like_count":10,"discussions":[{"author":{"id":1111183,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f4/8f/06bd9544.jpg","nickname":"AlphaGao","note":"","ucode":"862000415389FE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":298473,"discussion_content":"看得出来理解的很透彻，如果能把题意理解正确就牛逼了，题目是平均得分超过 20 哦","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1597306508,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1524154,"avatar":"https://static001.geekbang.org/account/avatar/00/17/41/ba/ae028565.jpg","nickname":"YqY","note":"","ucode":"73FB936045DCB9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":202684,"discussion_content":"场均分好像不对吧  你这只是得分啊 ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1583939657,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1172090,"avatar":"https://static001.geekbang.org/account/avatar/00/11/e2/7a/38a27e47.jpg","nickname":"蓦然回首","note":"","ucode":"B17658DCFE6402","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348092,"discussion_content":"哈哈！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612424993,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1316454,"avatar":"https://static001.geekbang.org/account/avatar/00/14/16/66/083e7f7e.jpg","nickname":"silent","note":"","ucode":"325D31F0608249","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":262117,"discussion_content":"你这是只要有得分超过20的，就返回了……","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589036959,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":111995,"user_name":"小星星","can_delete":false,"product_type":"c1","uid":1163671,"ip_address":"","ucode":"94D24B1A37B63C","user_header":"https://static001.geekbang.org/account/avatar/00/11/c1/97/3c54731e.jpg","comment_is_top":false,"comment_ctime":1562650152,"is_pvip":false,"replies":[{"id":"63735","content":"第一个SQL 18条记录<br>第二个SQL 19条记录","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577530826,"ip_address":"","comment_id":111995,"utype":1}],"discussion_count":3,"race_medal":0,"score":"35922388520","product_id":100029501,"comment_content":"SELECT player_name, height, team_id FROM player AS a <br>WHERE height &gt; (SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id);<br><br>SELECT player_name, height, team_id FROM player WHERE height &gt; (SELECT avg(height) FROM player as b);<br>这两句执行的结果一样的；请问为什么需要加上a.team_id = b.team_id 有什么区别吗？","like_count":8,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457533,"discussion_content":"第一个SQL 18条记录\n第二个SQL 19条记录","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577530826,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1018928,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8c/30/d642e01a.jpg","nickname":"zhengnachuan","note":"","ucode":"FC6CD65906BE6B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":21198,"discussion_content":"我的理解是，加了a.team_id = b.team_id后，取外层a的height，avg(height)是对应的team下的球员均值，而不是所有team下的球员均值。","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1569431830,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1266467,"avatar":"https://static001.geekbang.org/account/avatar/00/13/53/23/f657268b.jpg","nickname":"天舒李","note":"","ucode":"F23D2E73B5D93E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334727,"discussion_content":"我这两个sql跑出来的结果是一样的。。都是18行。。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1607952715,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109143,"user_name":"华夏","can_delete":false,"product_type":"c1","uid":1449474,"ip_address":"","ucode":"4D627CFA5A4B82","user_header":"https://static001.geekbang.org/account/avatar/00/16/1e/02/2864e0f2.jpg","comment_is_top":false,"comment_ctime":1561970966,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27331774742","product_id":100029501,"comment_content":"SELECT player_id, team_id, player_name FROM player WHERE player_id in (SELECT player_id FROM player_score WHERE player.player_id = player_score.player_id);<br>老师，文稿中这句的WHERE player.player_id = player_score.player_id可以不要了哈。<br>","like_count":6},{"had_liked":false,"id":108978,"user_name":"佚花","can_delete":false,"product_type":"c1","uid":1246853,"ip_address":"","ucode":"B84288F748780A","user_header":"https://static001.geekbang.org/account/avatar/00/13/06/85/f1b4d5c4.jpg","comment_is_top":false,"comment_ctime":1561943522,"is_pvip":false,"replies":[{"id":"63956","content":"佚花同学很好的分享","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577605893,"ip_address":"","comment_id":108978,"utype":1}],"discussion_count":2,"race_medal":0,"score":"27331747298","product_id":100029501,"comment_content":"这么说吧，我在银行遇到过两张表1700w的表，我要对比他们的差值。用in没查出来，就是查很久还报错了，用了exsit用了40s<br>一张1700w，一张100个值，in是一分钟，exsit是0.1s","like_count":6,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456190,"discussion_content":"佚花同学很好的分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577605893,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1270262,"avatar":"https://static001.geekbang.org/account/avatar/00/13/61/f6/1d6b548a.jpg","nickname":"wang","note":"","ucode":"C1A3BCACCB188E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":745,"discussion_content":"这也是要看你把哪张表作为主表吧？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562034816,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108940,"user_name":"Liam","can_delete":false,"product_type":"c1","uid":1094597,"ip_address":"","ucode":"1D15D3B64F2606","user_header":"https://static001.geekbang.org/account/avatar/00/10/b3/c5/7fc124e2.jpg","comment_is_top":false,"comment_ctime":1561940530,"is_pvip":false,"replies":[{"id":"78627","content":"当主表A大于从表B时，是使用IN子查询更好","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587992516,"ip_address":"","comment_id":108940,"utype":1}],"discussion_count":5,"race_medal":0,"score":"27331744306","product_id":100029501,"comment_content":"老师您好，关于exist和in的差别，总结和举例的不符吧？主表大于从表不应该是使用in更好吗","like_count":6,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456175,"discussion_content":"当主表A大于从表B时，是使用IN子查询更好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587992516,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2429501,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DsAticIYHpO0gEkOgB8miaUdFpv7gOpRccy5qc3GkSZQUjBCBQOOhRfSAN064ib93zUhvJy4zA0QiarESbu77Ae6Jw/132","nickname":"Geek_dab181","note":"","ucode":"07513ABEAE2C0E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541818,"discussion_content":"总结那里音频与文本是相反的，听懵了回退确认了好几次，就是反着的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640574754,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1272482,"avatar":"https://static001.geekbang.org/account/avatar/00/13/6a/a2/f9efd9dc.jpg","nickname":"春和景明","note":"","ucode":"A27970A276ECD6","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4681,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565660666,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1508654,"avatar":"https://static001.geekbang.org/account/avatar/00/17/05/2e/5a6b6b6e.jpg","nickname":"Fortune","note":"","ucode":"6B9465AC996523","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":883,"discussion_content":"还是没讲明白exist和in在执行上的区别呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562136607,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1196475,"avatar":"https://static001.geekbang.org/account/avatar/00/12/41/bb/21ce60d2.jpg","nickname":"安静的boy","note":"","ucode":"F5F44B75228A85","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":668,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561943089,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":111126,"user_name":"OperaX","can_delete":false,"product_type":"c1","uid":1510551,"ip_address":"","ucode":"66947CD04E3B3E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI8mFt5wSkia3yumk409E65JIlGoreva1Q25icTks0XB0EDC7WJ5V0z6zuvgGkI2Zrh5cBXGS5Hea8A/132","comment_is_top":false,"comment_ctime":1562483983,"is_pvip":true,"replies":[{"id":"78658","content":"any all 通常是可以比较最大值或者最小值，两种不同的写法","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587995739,"ip_address":"","comment_id":111126,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23037320463","product_id":100029501,"comment_content":"实际工作中没用到果any all。什么样的情况下会可能用到呢？老师举的例子的话，直接比较最大值或者最小值就好了吧","like_count":5,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457240,"discussion_content":"any all 通常是可以比较最大值或者最小值，两种不同的写法","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587995739,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108938,"user_name":"Mr.H","can_delete":false,"product_type":"c1","uid":1562855,"ip_address":"","ucode":"035F78476138C0","user_header":"https://static001.geekbang.org/account/avatar/00/17/d8/e7/21a4cbb1.jpg","comment_is_top":false,"comment_ctime":1561940280,"is_pvip":true,"replies":[{"id":"78628","content":"当主表A大于从表B时，使用IN子查询效率更高，相反主表A小于从表B时，使用EXISTS子查询效率更高","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587992562,"ip_address":"","comment_id":108938,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23036776760","product_id":100029501,"comment_content":"最后的总结in和exist写反了吧","like_count":5,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456174,"discussion_content":"当主表A大于从表B时，使用IN子查询效率更高，相反主表A小于从表B时，使用EXISTS子查询效率更高","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587992562,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":164155,"user_name":"张驰皓","can_delete":false,"product_type":"c1","uid":1048028,"ip_address":"","ucode":"448CAA944097E6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fd/dc/245fee32.jpg","comment_is_top":false,"comment_ctime":1576896666,"is_pvip":false,"replies":[{"id":"62589","content":"是因为这些player在player_score中都有记录，player这张表的数据量有些少，如果数据量大的话，没有在player_score（即没有打过比赛的球员）是不会显示出来的","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577071730,"ip_address":"","comment_id":164155,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18756765850","product_id":100029501,"comment_content":"SELECT player_id, team_id, player_name <br>FROM player <br>WHERE player_id in (SELECT player_id FROM player_score WHERE player.player_id = player_score.player_id)<br><br>这段代码里，子查询里 where 部分删去后运行结果与此前一致，是否说明此 where 语句是无意义的？","like_count":4,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478661,"discussion_content":"是因为这些player在player_score中都有记录，player这张表的数据量有些少，如果数据量大的话，没有在player_score（即没有打过比赛的球员）是不会显示出来的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577071730,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130411,"user_name":"峻铭","can_delete":false,"product_type":"c1","uid":1106202,"ip_address":"","ucode":"63AB23BADACA88","user_header":"https://static001.geekbang.org/account/avatar/00/10/e1/1a/20977779.jpg","comment_is_top":false,"comment_ctime":1567445452,"is_pvip":false,"replies":[{"id":"62731","content":"整理和分析的不错","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577087264,"ip_address":"","comment_id":130411,"utype":1}],"discussion_count":3,"race_medal":0,"score":"14452347340","product_id":100029501,"comment_content":"前提条件：<br>1、我理解的场均得分大于20，第一场得了40分，第二场得了2分，场均为21分满足条件<br>2、一场比赛中，球员可以出现多次<br>解析思路，先得出球员在每场比赛中的总分数，然后对球员分组，计算球员在所参加比赛中的平均数<br>SELECT<br>\tt2.player_id,<br>\tt2.player_name,<br>\tt2.team_id,<br>\tt3.v <br>FROM<br>\tplayer AS t2<br>\tJOIN (<br>\tSELECT<br>\t\tt1.player_id,<br>\t\tavg( t1.total ) AS v <br>\tFROM<br>\t\t(<br>\t\tSELECT<br>\t\t\tplayer_id,<br>\t\t\tsum( score ) AS total <br>\t\tFROM<br>\t\t\tplayer_score <br>\t\tWHERE<br>\t\t\tgame_id IN ( SELECT game_id FROM player_score GROUP BY game_id ) <br>\t\tGROUP BY<br>\t\t\tplayer_id   #对球员分组，计算在每场比赛中的总分数<br>\t\t) AS t1 <br>\tGROUP BY<br>\t\tt1.player_id  #对球员分组，计算所参加比赛的平均数<br>\tHAVING<br>\tv &gt; 20          #场均得分大于20<br>\t) AS t3 ON t2.player_id = t3.player_id;<br><br>+-----------+------------------+---------+---------+<br>| player_id | player_name      | team_id | v       |<br>+-----------+------------------+---------+---------+<br>|     10001 | 韦恩-艾灵顿      |    1001 | 26.0000 |<br>|     10002 | 雷吉-杰克逊      |    1001 | 22.0000 |<br>+-----------+------------------+---------+---------+<br><br>","like_count":3,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465943,"discussion_content":"整理和分析的不错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577087264,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1633308,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIDFo5d0p9V2D2XyPjJYU3CcFROe0YeBMN8BTelJ4NwTznb5ezqibUr1paKL68CKQwiboVOtrcZHPIg/132","nickname":"子铭","note":"","ucode":"EE4447076A4DB2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":163246,"discussion_content":"我个人认为你的脚本有错误的地方，我对我的判断进行了验证，增加数据库记录后，当同一名球员有两场比赛的比赛记录时，你的脚本执行的就出现了错误，场均得分的计算就不对了，您可以试验一下，如果我的结论有错误，也欢迎您的指正。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581064502,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1320916,"avatar":"https://static001.geekbang.org/account/avatar/00/14/27/d4/50c8ff0e.jpg","nickname":"626","note":"","ucode":"AC5D185D33FC11","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":48824,"discussion_content":"思路清晰 但太冗长了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573530659,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109141,"user_name":"华夏","can_delete":false,"product_type":"c1","uid":1449474,"ip_address":"","ucode":"4D627CFA5A4B82","user_header":"https://static001.geekbang.org/account/avatar/00/16/1e/02/2864e0f2.jpg","comment_is_top":false,"comment_ctime":1561970707,"is_pvip":false,"replies":[{"id":"78622","content":"需要注意下是场均得分&gt;20","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587992033,"ip_address":"","comment_id":109141,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14446872595","product_id":100029501,"comment_content":"SELECT player_id, player_name, team_id FROM player AS a WHERE  (SELECT score FROM player_score AS b WHERE a.player_id = b.player_id) &gt; 20;<br>+-----------+------------------+---------+<br>| player_id | player_name      | team_id |<br>+-----------+------------------+---------+<br>|     10001 | 韦恩-艾灵顿      |    1001 |<br>|     10002 | 雷吉-杰克逊      |    1001 |<br>+-----------+------------------+---------+<br>2 rows in set (0.01 sec)<br>","like_count":3,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456263,"discussion_content":"需要注意下是场均得分&amp;gt;20","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587992033,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108933,"user_name":"Cary","can_delete":false,"product_type":"c1","uid":1066991,"ip_address":"","ucode":"1B85272C1E03CF","user_header":"https://static001.geekbang.org/account/avatar/00/10/47/ef/3c657df8.jpg","comment_is_top":false,"comment_ctime":1561939828,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14446841716","product_id":100029501,"comment_content":"in 和 exist 上面和最后总结的好像不一致","like_count":3},{"had_liked":false,"id":109577,"user_name":"苏籍","can_delete":false,"product_type":"c1","uid":1396252,"ip_address":"","ucode":"4FA289E084B789","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erYNBIwAj3KdIXaXbeMBUjTMz31zAToHIJSdo7oQk8bfsibwViaLobVQ8miatwBlC5spLS9kVCzHMjUA/132","comment_is_top":false,"comment_ctime":1562060593,"is_pvip":false,"replies":[{"id":"78748","content":"for player1 in a表<br>   for player2 in b表<br>     根据player2.team_id=player1.team_id 进行筛选，然后求解avg(player2.height)","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1588041899,"ip_address":"","comment_id":109577,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10151995185","product_id":100029501,"comment_content":" WHERE a.team_id = b.team_id <br>想确定一下这个条件 是在两个相同的表做笛卡尔积后  做了啥操作，能帮梳理一下思路吗<br>","like_count":2,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456473,"discussion_content":"for player1 in a表\n   for player2 in b表\n     根据player2.team_id=player1.team_id 进行筛选，然后求解avg(player2.height)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588041899,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1474214,"avatar":"https://static001.geekbang.org/account/avatar/00/16/7e/a6/4e331ef4.jpg","nickname":"骑行的掌柜J","note":"","ucode":"3163102651C653","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5984,"discussion_content":"是连结两个表 他们的关系 因为都有team_id 这个字段 就作为中间的连接点 桥梁的意思 个人理解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566567928,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109442,"user_name":"wang","can_delete":false,"product_type":"c1","uid":1270262,"ip_address":"","ucode":"C1A3BCACCB188E","user_header":"https://static001.geekbang.org/account/avatar/00/13/61/f6/1d6b548a.jpg","comment_is_top":false,"comment_ctime":1562033021,"is_pvip":false,"replies":[{"id":"78756","content":"这种情况下是OK，将any和all转化为 非关联子查询","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1588042167,"ip_address":"","comment_id":109442,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10151967613","product_id":100029501,"comment_content":"老师，讲道理，关于any 和 all 的例子应该可以变成<br>select player_name, team_id, player_id, height from player where height &gt; (select min(height) from player where team_id = 1002) ==&gt; 与any结果一致<br>select player_name, team_id, player_id, height from player where height &gt; (select max(height) from player where team_id = 1002) ==&gt; 与all 结果一致<br>那么是否说关于any 和 all 这种极限值集合的查询可以将关联查询变成非关联查询呢？效率会比较高？<br>","like_count":3,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456411,"discussion_content":"这种情况下是OK，将any和all转化为 非关联子查询","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588042167,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1543236,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8c/44/c50d62b2.jpg","nickname":"粗茶","note":"","ucode":"B7EF050090A1A6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4570,"discussion_content":"我一直没看懂“任何”和“所有”例子的区别","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1565569707,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109251,"user_name":"Fred","can_delete":false,"product_type":"c1","uid":1585721,"ip_address":"","ucode":"DBA8999FE43E4F","user_header":"","comment_is_top":false,"comment_ctime":1561987999,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10151922591","product_id":100029501,"comment_content":"SELECT player_id , player_name, team_id FROM player AS a WHERE a.player_id IN (SELECT player_id FROM play_score AS b WHERE a.player_id=b.player_id AND AVG(b.score)&gt;20)","like_count":2,"discussions":[{"author":{"id":1524154,"avatar":"https://static001.geekbang.org/account/avatar/00/17/41/ba/ae028565.jpg","nickname":"YqY","note":"","ucode":"73FB936045DCB9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":202714,"discussion_content":"不对 执行出错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583940600,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109062,"user_name":"太精","can_delete":false,"product_type":"c1","uid":1419939,"ip_address":"","ucode":"7B0F1B090ECF0F","user_header":"https://static001.geekbang.org/account/avatar/00/15/aa/a3/0b7f0334.jpg","comment_is_top":false,"comment_ctime":1561954443,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10151889035","product_id":100029501,"comment_content":"SELECT player_id, player_name, team_id FROM player WHERE player_id IN (SELECT player_id FROM player_score WHERE score &gt; 20);<br>+-----------+------------------+---------+<br>| player_id | player_name      | team_id |<br>+-----------+------------------+---------+<br>|     10001 | 韦恩-艾灵顿      |    1001 |<br>|     10002 | 雷吉-杰克逊      |    1001 |<br>+-----------+------------------+---------+<br>","like_count":2,"discussions":[{"author":{"id":1524154,"avatar":"https://static001.geekbang.org/account/avatar/00/17/41/ba/ae028565.jpg","nickname":"YqY","note":"","ucode":"73FB936045DCB9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":202718,"discussion_content":"场均分？？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583940642,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":294230,"user_name":"完美坚持","can_delete":false,"product_type":"c1","uid":1919541,"ip_address":"","ucode":"AE0261D8DDEF64","user_header":"https://static001.geekbang.org/account/avatar/00/1d/4a/35/66caeed9.jpg","comment_is_top":false,"comment_ctime":1621842345,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5916809641","product_id":100029501,"comment_content":"自己第一次做是这样么写的，不知道对不对<br>SELECT player_id, player_name, team_id<br>    -&gt; FROM player AS a<br>    -&gt; WHERE (SELECT AVG(score) FROM player_score AS b WHERE b.player_id = a.player_id) &gt; 20;<br>+-----------+------------------+---------+<br>| player_id | player_name      | team_id |<br>+-----------+------------------+---------+<br>|     10001 | 韦恩-艾灵顿      |    1001 |<br>|     10002 | 雷吉-杰克逊      |    1001 |<br>+-----------+------------------+---------+","like_count":1,"discussions":[{"author":{"id":1025029,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a4/05/69ce0c0f.jpg","nickname":"木叶","note":"","ucode":"D500859FD8DC9F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":399356,"discussion_content":"我也是这样写的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632940978,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":241745,"user_name":"谢庭恩","can_delete":false,"product_type":"c1","uid":1898214,"ip_address":"","ucode":"7AC11237E5A3B2","user_header":"https://static001.geekbang.org/account/avatar/00/1c/f6/e6/fc4d0ee3.jpg","comment_is_top":false,"comment_ctime":1597407881,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5892375177","product_id":100029501,"comment_content":"IN是先执行外表子查询，所以外表小一些性能更加优化；<br>而EXISTS是先执行内表进行循环查询，所以内表小时用它更好。","like_count":1},{"had_liked":false,"id":237339,"user_name":"wayne","can_delete":false,"product_type":"c1","uid":1811813,"ip_address":"","ucode":"988E1F2F0B419A","user_header":"https://static001.geekbang.org/account/avatar/00/1b/a5/65/898bc6c5.jpg","comment_is_top":false,"comment_ctime":1595785269,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5890752565","product_id":100029501,"comment_content":"老师：（将子查询作为主查询作为子查询计算字段）可以这样理解吗？<br>比如从team表里取出队名：底特律活塞的team_id——去子查询中player表中计算此team_id有多少个——循环这个过程","like_count":1},{"had_liked":false,"id":237337,"user_name":"wayne","can_delete":false,"product_type":"c1","uid":1811813,"ip_address":"","ucode":"988E1F2F0B419A","user_header":"https://static001.geekbang.org/account/avatar/00/1b/a5/65/898bc6c5.jpg","comment_is_top":false,"comment_ctime":1595783605,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5890750901","product_id":100029501,"comment_content":"老师，我这样说对吗？<br>非关联型子查询：从句先执行<br>关联型子查询：主句先执行","like_count":1},{"had_liked":false,"id":225623,"user_name":"知了","can_delete":false,"product_type":"c1","uid":1576700,"ip_address":"","ucode":"6324B1D0528260","user_header":"https://static001.geekbang.org/account/avatar/00/18/0e/fc/f5a74c2f.jpg","comment_is_top":false,"comment_ctime":1591801219,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5886768515","product_id":100029501,"comment_content":"老师，表复制和传入从句的原理和过程可以详细的解释一下吗，这里卡住了，不是很理解。<br>引用‘’‘SELECT player_name, height, team_id FROM player AS a WHERE height &gt; (SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id)<br>里我们将 player 表复制成了表 a 和表 b，每次计算的时候，需要将表 a 中的 team_id 传入从句，作为已知值。因为每次表 a 中的 team_id 可能是不同的，所以是关联子查询。如果是非关联子查询，那么从句计算的结果是固定的才可以。’‘","like_count":1},{"had_liked":false,"id":213036,"user_name":"suke","can_delete":false,"product_type":"c1","uid":1007753,"ip_address":"","ucode":"C0287C31A4F45B","user_header":"","comment_is_top":false,"comment_ctime":1588268105,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5883235401","product_id":100029501,"comment_content":"文中对in和exist 抽象后的语句总结的也不合理吧？你那个球队的例子 无论in还是exist 都是内外表都关联了，属于关联子查询，怎么抽象后的语句 in就是非关联子查询，exist是关联子查询，有点生搬硬套，完全没讲明白in和exist到底是怎么查的","like_count":1,"discussions":[{"author":{"id":1316454,"avatar":"https://static001.geekbang.org/account/avatar/00/14/16/66/083e7f7e.jpg","nickname":"silent","note":"","ucode":"325D31F0608249","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":262431,"discussion_content":"我也是这么觉得，例子里的in查询是关联子查询，抽象之后就变成非关联的……","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589096732,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":134554,"user_name":"petra","can_delete":false,"product_type":"c1","uid":1573522,"ip_address":"","ucode":"6E687932DAC651","user_header":"https://static001.geekbang.org/account/avatar/00/18/02/92/04e8098d.jpg","comment_is_top":false,"comment_ctime":1568864431,"is_pvip":false,"replies":[{"id":"62724","content":"很好的问题，你可以观察下player数据表，其中 team_id=1003的球员只有一个，那么这种情况下，他是否比 team_id=1003的平均身高要高呢？ 实际上，team_id=1003的平均身高就是这个球员本身，所以不会被选出来<br>然后再看下两个SQL：<br>SQL1（18条记录）: SELECT player_name, height, team_id FROM player AS a WHERE height &gt; (SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id)<br><br>SQL2（19条记录）: SELECT player_name, height, team_id FROM player WHERE height &gt; (SELECT avg(height) FROM player )","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577087042,"ip_address":"","comment_id":134554,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5863831727","product_id":100029501,"comment_content":"SELECT player_name, height, team_id FROM player AS a WHERE height &gt; (SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id)<br>这个语句为什么要加联合查询？直接查就可以了，SELECT player_name, height, team_id FROM player WHERE height &gt; (SELECT avg(height) FROM player )，这样的例子太不合适了吧？请老师解答一下。<br>","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467803,"discussion_content":"很好的问题，你可以观察下player数据表，其中 team_id=1003的球员只有一个，那么这种情况下，他是否比 team_id=1003的平均身高要高呢？ 实际上，team_id=1003的平均身高就是这个球员本身，所以不会被选出来\n然后再看下两个SQL：\nSQL1（18条记录）: SELECT player_name, height, team_id FROM player AS a WHERE height &amp;gt; (SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id)\n\nSQL2（19条记录）: SELECT player_name, height, team_id FROM player WHERE height &amp;gt; (SELECT avg(height) FROM player )","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577087042,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":131195,"user_name":"番茄","can_delete":false,"product_type":"c1","uid":1583667,"ip_address":"","ucode":"7354EEB2D8A43D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTICAILuSqtnAfl1zcgRWIULia2nbjzlybTEQJUMT68KPj80BicwQyibAK3Icxp4qwC03LqrtvfX0fbZg/132","comment_is_top":false,"comment_ctime":1567668545,"is_pvip":false,"replies":[{"id":"62791","content":"select avg(height) from `player` 这个对比的是整体的平均身高，不是team的平均身高","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577092738,"ip_address":"","comment_id":131195,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5862635841","product_id":100029501,"comment_content":"第二个例子，照这意思，对比的是整体平均身高，非关联不是就能出来了吗，为什么要用a.team_id=b.team_id<br><br>select player_name,team_id,height<br>from `player` <br>where height &gt; (select avg(height) from `player`)","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466330,"discussion_content":"select avg(height) from `player` 这个对比的是整体的平均身高，不是team的平均身高","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577092738,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1184743,"avatar":"https://static001.geekbang.org/account/avatar/00/12/13/e7/202ac86f.jpg","nickname":"Geek-fans","note":"","ucode":"56518D2121E884","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":45376,"discussion_content":"如果子查询的执行依赖于外部查询，通常情况下都是因为子查询中的表用到了外部的表，并进行了条件关联.\n感觉是为了凑这个关联关系。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573030886,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1573522,"avatar":"https://static001.geekbang.org/account/avatar/00/18/02/92/04e8098d.jpg","nickname":"petra","note":"","ucode":"6E687932DAC651","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":16472,"discussion_content":"我也是这个想法，不知道为什么没有人解释一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568894722,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":129885,"user_name":"Serendipity","can_delete":false,"product_type":"c1","uid":1370694,"ip_address":"","ucode":"E9C7B39BD8DCCD","user_header":"https://static001.geekbang.org/account/avatar/00/14/ea/46/9c9808a9.jpg","comment_is_top":false,"comment_ctime":1567314138,"is_pvip":false,"replies":[{"id":"63784","content":"因为我们检索的是不是全体成员的平均身高，而是整个球员所在球队的平均身高，所以是WHERE a.team_id = b.team_id<br>","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577541802,"ip_address":"","comment_id":129885,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5862281434","product_id":100029501,"comment_content":"SELECT player_name, height, team_id FROM player AS a WHERE height &gt; (SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id)<br>没弄明白，都是从 player 表里面取数据，为什么前面是 player AS a，后面是 player AS b，最后还要有一个 a.team_id = b.team_id","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465695,"discussion_content":"因为我们检索的是不是全体成员的平均身高，而是整个球员所在球队的平均身高，所以是WHERE a.team_id = b.team_id\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577541802,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110673,"user_name":"一叶知秋","can_delete":false,"product_type":"c1","uid":1445189,"ip_address":"","ucode":"15A95FA86B7AE4","user_header":"https://static001.geekbang.org/account/avatar/00/16/0d/45/b88a1794.jpg","comment_is_top":false,"comment_ctime":1562312457,"is_pvip":false,"replies":[{"id":"63748","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577531035,"ip_address":"","comment_id":110673,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5857279753","product_id":100029501,"comment_content":"MySQL：<br>SELECT player_id, player_name, team_id FROM player WHERE player_id IN (SELECT player_id FROM player_score WHERE score&gt;20);<br>执行结果：<br>+-----------+------------------+---------+<br>| player_id | player_name      | team_id |<br>+-----------+------------------+---------+<br>|     10001 | 韦恩-艾灵顿      |    1001 |<br>|     10002 | 雷吉-杰克逊      |    1001 |<br>+-----------+------------------+---------+<br>2 rows in set (0.01 sec)<br><br>一开始我还在算场均得分。。三分*3 发球*2 .....不得不说注释害人啊 哈哈哈 ```score 比分```","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456999,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577531035,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109707,"user_name":"🄽🄸🅇🅄🅂","can_delete":false,"product_type":"c1","uid":1000060,"ip_address":"","ucode":"853763C229A5AA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/42/7c/8ef14715.jpg","comment_is_top":false,"comment_ctime":1562080466,"is_pvip":false,"replies":[{"id":"63925","content":"《MySQL 8 CookBook》<br>《SQL学习指南》（第2版）<br>这两本可以看看","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577605104,"ip_address":"","comment_id":109707,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5857047762","product_id":100029501,"comment_content":"看第二遍后, 又看了下评论, 突然觉得, 第二题中, 场均, 这个意思, 是不是  每场比赛每位队员的平均分大于20分的球员呢?  如果是, 感觉只用一个group by player_score.game_id, player_score.player_id不能满足条件, 如果分别group by player_score.game_id, group by player_score.player_id, 用多个子查询, 反而又变成了 每场比赛的分数, 每位球员的分数, 不知道该怎么做了...<br><br>另外, 看到评论中很多同学的回复, 觉得掌握 [NOT] IN 和 [NOT] EXISTS 在SQL中的执行顺序, 太有必要了. 请问老师有没有值得推荐的好书, 作为课外补充呢? <br><br>谢谢!","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456527,"discussion_content":"《MySQL 8 CookBook》\n《SQL学习指南》（第2版）\n这两本可以看看","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577605104,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1000060,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/7c/8ef14715.jpg","nickname":"🄽🄸🅇🅄🅂","note":"","ucode":"853763C229A5AA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":835,"discussion_content":"这条SQL可以实现场均球员得分大于20分的查询, 但是感觉这么写, 太繁琐了, 不够简练, 希望有更优的SQL, 期待老师能够指点一下\nselect * from (\n\tselect s1.player_id player_id,sum(score) total from player_score s1 where s1.player_id in (\n\t\tselect s2.player_id from player_score s2 where s1.game_id=s2.game_id\n\t) group by s1.player_id\n) as ss group by ss.player_id having avg(ss.total)>20","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562108986,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109435,"user_name":"六维","can_delete":false,"product_type":"c1","uid":1022887,"ip_address":"","ucode":"EB1C15AC06A8DF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9b/a7/440aff07.jpg","comment_is_top":false,"comment_ctime":1562032416,"is_pvip":false,"replies":[{"id":"78757","content":"结果正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1588042198,"ip_address":"","comment_id":109435,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5856999712","product_id":100029501,"comment_content":"SELECT player_id,player_name,team_id FROM player AS p WHERE p.player_id IN (SELECT player_id FROM player_score s GROUP BY s.player_id HAVING AVG(score) &gt; 20);<br><br><br>","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456409,"discussion_content":"结果正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588042198,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109018,"user_name":"圆子蛋","can_delete":false,"product_type":"c1","uid":1585794,"ip_address":"","ucode":"9E8FE5D4DAC79E","user_header":"https://static001.geekbang.org/account/avatar/00/18/32/82/273a44cd.jpg","comment_is_top":false,"comment_ctime":1561949585,"is_pvip":false,"replies":[{"id":"63952","content":"这条SQL有Bug，再Check下","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577605832,"ip_address":"","comment_id":109018,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5856916881","product_id":100029501,"comment_content":"SELECT player_id，player_name，team_id FROM player WHERE player_id IN（SELECT player_id FROM player_score WHERE score &gt; AVG（score） ）","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456213,"discussion_content":"这条SQL有Bug，再Check下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577605832,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":357671,"user_name":"张兴","can_delete":false,"product_type":"c1","uid":3175551,"ip_address":"上海","ucode":"6BE80A3C026E36","user_header":"","comment_is_top":false,"comment_ctime":1663553733,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1663553733","product_id":100029501,"comment_content":"<br>player数据量大于player_score，用IN<br>SELECT p.player_id, p.player_name, p.team_id<br>FROM player AS p<br>WHERE p.player_id IN<br>(<br>\tSELECT p2.player_id<br>\tFROM player_score as p2<br>\tWHERE p.player_id = p2.player_id<br>\tGROUP BY p2.player_id<br>\tHAVING AVG(p2.score) &gt; 20<br>);","like_count":0},{"had_liked":false,"id":356616,"user_name":"年少挽滑稽世无双","can_delete":false,"product_type":"c1","uid":2962599,"ip_address":"四川","ucode":"793DCBDE25A07B","user_header":"https://static001.geekbang.org/account/avatar/00/2d/34/a7/52c4ea60.jpg","comment_is_top":false,"comment_ctime":1662451099,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1662451099","product_id":100029501,"comment_content":"# 请你使用子查询，编写 SQL 语句，得到场均得分大于 20 的球员。场均得分从 player_score 表中获取，同时你需要输出球员的 ID、球员姓名以及所在球队的 ID 信息。<br>SELECT player_id, player_name, team_id <br>FROM player<br>WHERE player_id IN (SELECT player_id FROM player_score WHERE score &gt; 20)<br><br>SELECT player_id, player_name, team_id <br>FROM player<br>WHERE EXISTS (SELECT player_id FROM player_score WHERE player.player_id = player_score.player_id AND score &gt; 20)","like_count":0},{"had_liked":false,"id":351326,"user_name":"fengsaica","can_delete":false,"product_type":"c1","uid":1931309,"ip_address":"","ucode":"DFE51AD72EF829","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqh1ib2sIOhN6AiaHf5jfYYZh4f4GK7K4Kcv3QjDXj5dwF9vN4ChcfNz1wQ7deicQKHH3Bcyb6lDcpYw/132","comment_is_top":false,"comment_ctime":1657701614,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1657701614","product_id":100029501,"comment_content":"select *<br>  from player<br> where exists (select player_id, score<br>          from player_score<br>         where player_score.player_id = player.player_id<br>        and score&gt;20)","like_count":0},{"had_liked":false,"id":337598,"user_name":"火车日记","can_delete":false,"product_type":"c1","uid":1480419,"ip_address":"","ucode":"62C57DFA6CDF74","user_header":"https://static001.geekbang.org/account/avatar/00/16/96/e3/dd40ec58.jpg","comment_is_top":false,"comment_ctime":1646909047,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646909047","product_id":100029501,"comment_content":"对于from中和select 中出现的子查询是怎样的执行逻辑","like_count":0},{"had_liked":false,"id":325629,"user_name":"Geek_292884","can_delete":false,"product_type":"c1","uid":1731428,"ip_address":"","ucode":"DF87973BD95C91","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/OHbDdelsu57BYPr2Nak32u1rYuqDkdsOiaibYFKdxk3gicrvN6Isem6w1BuFu3sUvl1zhEM43wjoxLzFoWl1225UQ/132","comment_is_top":false,"comment_ctime":1639050314,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1639050314","product_id":100029501,"comment_content":"SELECT player_id, player_name, team_id  FROM player as a WHERE player_id IN (SELECT player_id FROM player_score WHERE score &gt; 20)","like_count":0},{"had_liked":false,"id":317216,"user_name":"Geek_28670d","can_delete":false,"product_type":"c1","uid":2814926,"ip_address":"","ucode":"7BA10C23E56F1E","user_header":"","comment_is_top":false,"comment_ctime":1634712410,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634712410","product_id":100029501,"comment_content":"练习题思路<br>1.先查出场平均分&gt;20的球员id，再求出球员的信息：<br>SELECT <br>\tplayer_id,player_name,team_id<br>FROM <br>\t`player`<br>WHERE<br>\tplayer_id <br>IN<br>(<br>SELECT <br>\tplayer_id <br>FROM <br>\t`player_score` <br>GROUP BY <br>\tplayer_id <br>HAVING <br>\tAVG(score)&gt;20<br>)<br>2.挨个查询每个球员的平均分，满足&gt;20返回<br>SELECT <br>\tt1.player_id,t1.player_name,t1.team_id<br>FROM <br>\t`player` t1<br>WHERE<br>EXISTS<br>(<br>SELECT <br>\tt2.player_id <br>FROM <br>\t`player_score` t2<br>WHERE <br>\tt2.player_id=t1.player_id<br>GROUP BY <br>\tt2.player_id <br>HAVING <br>\tAVG(t2.score)&gt;20<br>)<br><br>","like_count":0},{"had_liked":false,"id":316105,"user_name":"盛世半月","can_delete":false,"product_type":"c1","uid":1521691,"ip_address":"","ucode":"D4B9ED91189BB4","user_header":"https://static001.geekbang.org/account/avatar/00/17/38/1b/5c1fefd9.jpg","comment_is_top":false,"comment_ctime":1634137516,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634137516","product_id":100029501,"comment_content":"SELECT player_id, player_name, team_id FROM player WHERE EXISTS (SELECT player_id FROM player_score WHERE player_score.player_id = player.player_id GROUP BY player_id HAVING AVG(score) &gt; 20)","like_count":0},{"had_liked":false,"id":314018,"user_name":"Rebirth°","can_delete":false,"product_type":"c1","uid":2500861,"ip_address":"","ucode":"0EE239A83BC307","user_header":"https://static001.geekbang.org/account/avatar/00/26/28/fd/26435d41.jpg","comment_is_top":false,"comment_ctime":1632803354,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632803354","product_id":100029501,"comment_content":"SELECT player_id,player_name,team_id<br>FROM player<br>WHERE player_id IN (<br>                                          SELECT player_id FROM player_score <br>                                          WHERE player_id = player_score.player_id <br>                                          GROUP BY player_id <br>                                          HAVING AVG(score)&gt;20 ORDER BY<br>                                          AVG(score) DESC) ","like_count":0},{"had_liked":false,"id":302975,"user_name":"朱家华","can_delete":false,"product_type":"c1","uid":1335296,"ip_address":"","ucode":"A669272C4C249D","user_header":"https://static001.geekbang.org/account/avatar/00/14/60/00/cede375b.jpg","comment_is_top":false,"comment_ctime":1626489730,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1626489730","product_id":100029501,"comment_content":"老师想问一下关联子查询的SQL执行顺序是怎样的，下面是我的理解不知道对不对？<br>对于：SELECT player_name, height, team_id FROM player AS a WHERE height &gt; (SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id)<br><br>该条SQL执行顺序的理解：<br>本来我们觉得，SQL的执行顺序就是FROM-&gt;WHERE-&gt;SELECT，但是在关联子查询中，我们要用到外部查询的值，因此需要用SELECT把某条数据a的team_id值先查出来，比如ret_team_id，然后把该值传入子查询，子查询执行计算得到AVG(height)并返回给外部WHERE子句，之后WHERE子句再把数据a的height和AVG(height)进行比较，如果满足WHERE条件就查出来，如果不满足就过滤掉。<br>上述是表中一条数据的查询过程，而其余数据则是上述过程的重复。","like_count":0},{"had_liked":false,"id":302132,"user_name":"牛哥","can_delete":false,"product_type":"c1","uid":2565173,"ip_address":"","ucode":"27D8619DC2B946","user_header":"https://static001.geekbang.org/account/avatar/00/27/24/35/03603e95.jpg","comment_is_top":false,"comment_ctime":1626094533,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1626094533","product_id":100029501,"comment_content":"在EXISTS那里，子查询SELECT player_id FROM player_score WHERE player.player_id = player_score.player_id 运行报错，1054 - Unknown column &#39;player.player_id&#39; in &#39;where clause&#39;。请老师解惑答疑。","like_count":0},{"had_liked":false,"id":301504,"user_name":"Cy23","can_delete":false,"product_type":"c1","uid":1591293,"ip_address":"","ucode":"8DC561C5151758","user_header":"https://static001.geekbang.org/account/avatar/00/18/47/fd/895f0c27.jpg","comment_is_top":false,"comment_ctime":1625721688,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625721688","product_id":100029501,"comment_content":"SELECT player_id, player_name, team_id  FROM player WHERE EXISTS (SELECT AVG(score) FROM player_score WHERE player.player_id = player_score.player_id GROUP BY player_score.player_id HAVING AVG(score) &gt; 20)","like_count":0},{"had_liked":false,"id":297900,"user_name":"一只半","can_delete":false,"product_type":"c1","uid":1475167,"ip_address":"","ucode":"9E3F1FF369D82C","user_header":"https://static001.geekbang.org/account/avatar/00/16/82/5f/8c6ae297.jpg","comment_is_top":false,"comment_ctime":1623835427,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1623835427","product_id":100029501,"comment_content":"<br>SELECT player_name, height, team_id FROM player AS a WHERE height &gt; (SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id)      这里为何用到 WHERE a.team_id = b.team_id，实操去掉该语句得到的结果相同","like_count":0},{"had_liked":false,"id":296762,"user_name":"-Destroyall","can_delete":false,"product_type":"c1","uid":1364281,"ip_address":"","ucode":"182DE1018A3236","user_header":"https://static001.geekbang.org/account/avatar/00/14/d1/39/9feb690e.jpg","comment_is_top":false,"comment_ctime":1623150157,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1623150157","product_id":100029501,"comment_content":"select a.player_id,a.player_name,a.team_id<br>from player a where a.player_id in (select player_id from player_score GROUP BY player_id having avg(score)&gt;20)    <br>第二种版本","like_count":0},{"had_liked":false,"id":296297,"user_name":"ss","can_delete":false,"product_type":"c1","uid":1073156,"ip_address":"","ucode":"C1926C165FB8C5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqibj1G9GJGMXkNAia83ESAqbCTgcIA5UyqUJN27yvXhAgpIeL9UyEkwY1jwsQlnqcv4iasoLdZkBbeA/132","comment_is_top":false,"comment_ctime":1622888622,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622888622","product_id":100029501,"comment_content":"交作业：<br>SELECT t1.player_id,t1.player_name,t1.team_id FROM player as t1 WHERE    EXISTS (SELECT t2.player_id from player_score as t2 where t1.player_id=t2.player_id  group by t2.player_id HAVING avg(t2.score)&gt;20)<br><br>SELECT t1.player_id,t1.player_name,t1.team_id FROM player as t1 WHERE t1.player_id in (SELECT t2.player_id from player_score as t2  group by t2.player_id HAVING avg(t2.score)&gt;20)<br>","like_count":0},{"had_liked":false,"id":296086,"user_name":"jarryLee","can_delete":false,"product_type":"c1","uid":1631921,"ip_address":"","ucode":"1392ED306DA5F2","user_header":"","comment_is_top":false,"comment_ctime":1622735968,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622735968","product_id":100029501,"comment_content":"SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id,查询这块没看明白，直接写 select player_name,height,team_id from player as a where a.height &gt; (select avg(height) from player);不是也能得到结果吗，也是18条记录，为什么要复制两个表呢？","like_count":0},{"had_liked":false,"id":294238,"user_name":"完美坚持","can_delete":false,"product_type":"c1","uid":1919541,"ip_address":"","ucode":"AE0261D8DDEF64","user_header":"https://static001.geekbang.org/account/avatar/00/1d/4a/35/66caeed9.jpg","comment_is_top":false,"comment_ctime":1621845506,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621845506","product_id":100029501,"comment_content":"SELECT * FROM A WHERE cc IN (SELECT cc FROM B)<br>SELECT * FROM A WHERE EXIST (SELECT cc FROM B WHERE B.cc=A.cc)<br>IN 那里是可以利用表A的索引，<br>EXISTS实现则是用到 B 中对cc 的索引，<br>后者更好理解，因为其中子查询的语句是 (SELECT cc FROM B WHERE B.cc=A.cc) 这里面可以认为 A.cc 是给定的，每次计算子查询的时候，就会利用到B中对cc的索引。<br>所以 B 更大的时候用 EXISTS 会效率更高。<br>前者理解的话，可以这样理解 把 WHERE cc IN (SELECT cc FROM B) 理解为对 A 中的cc进行一个筛选，我们知道 <br>SELECT * FROM A WHERE cc = 某个给定值<br>SELECT * FROM A WHERE cc IN (SELECT cc FROM B)<br>也是类似的，可以利用到A中的索引，所以表A更大的时候，用IN效率更高。<br>-----------------------------<br>哪个表大，就对哪个表利用索引来提高效率<br>有一个关键点，就是要理解，为什么<br>IN实现是利用了表A对cc的索引；而EXISTS的实现则是利用了表B对cc的索引——可以利用子查询中是否有 WHERE 来判断是否利用表B中对cc的索引，只有EXISTS实现的时候，子查询内部有WHERE B.cc=A.cc<br>SELECT * FROM A WHERE EXIST (SELECT cc FROM B WHERE B.cc=A.cc)<br><br>还有一个点，听老师的意思，比如“因为EXIST的实现，相当于外表循环”，似乎是一个表循环，一个表可以利用索引。<br>比如对EXISTS，子查询直接就会返回T&#47;F，这样对表A就只需要循环因此就好了（所以外表是表A?）<br>而IN:<br>SELECT * FROM A WHERE cc IN (SELECT cc FROM B)<br>注意这里子查询可是要对B进行循环的<br><br>循环又比索引要费时，因此我们尽可能对小表循环，而大表进行索引。<br>IN 实现：表A索引，表B循环 适合表A&gt;B<br>EXIST : 表A循环，表B索引  适合 表A&lt;B","like_count":0},{"had_liked":false,"id":294236,"user_name":"完美坚持","can_delete":false,"product_type":"c1","uid":1919541,"ip_address":"","ucode":"AE0261D8DDEF64","user_header":"https://static001.geekbang.org/account/avatar/00/1d/4a/35/66caeed9.jpg","comment_is_top":false,"comment_ctime":1621844603,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621844603","product_id":100029501,"comment_content":"表A和表B哪个是内表，哪个是外表","like_count":0},{"had_liked":false,"id":294233,"user_name":"完美坚持","can_delete":false,"product_type":"c1","uid":1919541,"ip_address":"","ucode":"AE0261D8DDEF64","user_header":"https://static001.geekbang.org/account/avatar/00/1d/4a/35/66caeed9.jpg","comment_is_top":false,"comment_ctime":1621843338,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621843338","product_id":100029501,"comment_content":"(SELECT player_id, AVG(score) AS mean FROM player_score GROUP BY player_id HAVING mean &gt; 20);<br>+-----------+---------+<br>| player_id | mean    |<br>+-----------+---------+<br>|     10001 | 26.0000 |<br>|     10002 | 22.0000 |<br>+-----------+---------+","like_count":0},{"had_liked":false,"id":294225,"user_name":"完美坚持","can_delete":false,"product_type":"c1","uid":1919541,"ip_address":"","ucode":"AE0261D8DDEF64","user_header":"https://static001.geekbang.org/account/avatar/00/1d/4a/35/66caeed9.jpg","comment_is_top":false,"comment_ctime":1621841586,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621841586","product_id":100029501,"comment_content":"还没有解决的问题<br>将子查询作为计算字段 那一节的第一段代码中的错误问题在哪里？<br>EXISTS IN 效率比较如何理解原因？<br>","like_count":0},{"had_liked":false,"id":294003,"user_name":"用户","can_delete":false,"product_type":"c1","uid":2266972,"ip_address":"","ucode":"52D639FB1ABCE7","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er6XOX1f5g3RJFznbPQdO4j1iaRISEVR6Xn4BviaehPOoqAjfrDswIIsaKPA5DNs9iaHeG3tCGd1icbNQ/132","comment_is_top":false,"comment_ctime":1621674723,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621674723","product_id":100029501,"comment_content":"SELECT player_id, player_name, team_id FROM player WHERE (SELECT AVG(score) FROM player_score WHERE player.player_id = player_score.player_id) &gt; 20;","like_count":0},{"had_liked":false,"id":293992,"user_name":"用户","can_delete":false,"product_type":"c1","uid":2266972,"ip_address":"","ucode":"52D639FB1ABCE7","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er6XOX1f5g3RJFznbPQdO4j1iaRISEVR6Xn4BviaehPOoqAjfrDswIIsaKPA5DNs9iaHeG3tCGd1icbNQ/132","comment_is_top":false,"comment_ctime":1621672835,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621672835","product_id":100029501,"comment_content":"SELECT player_name FROM player WHERE (SELECT score FROM player_score WHERE player.player_id = player_score.player_id) &gt; 20;","like_count":0},{"had_liked":false,"id":281396,"user_name":"Geek_157522","can_delete":false,"product_type":"c1","uid":1989454,"ip_address":"","ucode":"B10B4A4226C66A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLIZpAiabrHDmPye39vFLPibWtlkcEVlOeufJ14uYACPamfZh0urvsumJvkalFUkDodqTescgj4j7tw/132","comment_is_top":false,"comment_ctime":1614737420,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1614737420","product_id":100029501,"comment_content":"SELECT player_id, player_name，team_ID FROM player WHERE player_id IN (SELECT player_id FROM player_score&gt; 20 )<br>","like_count":0},{"had_liked":false,"id":278626,"user_name":"Believer(入陣)","can_delete":false,"product_type":"c1","uid":1127667,"ip_address":"","ucode":"A57EFA4E534019","user_header":"https://static001.geekbang.org/account/avatar/00/11/34/f3/465e90d0.jpg","comment_is_top":false,"comment_ctime":1613138946,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1613138946","product_id":100029501,"comment_content":"SELECT player_id, player_name, team_id FROM player WHERE player_id IN (SELECT player_id FROM player_score GROUP BY player_id HAVING AVG(score) &gt; 20);<br>SELECT player_id, player_name, team_id FROM player WHERE (SELECT AVG(score) FROM player_score WHERE player_score.player_id = player.player_id) &gt; 20;","like_count":0},{"had_liked":false,"id":277841,"user_name":"Fine","can_delete":false,"product_type":"c1","uid":1603813,"ip_address":"","ucode":"C4CF830EBD2BA3","user_header":"https://static001.geekbang.org/account/avatar/00/18/78/e5/9ded99a5.jpg","comment_is_top":false,"comment_ctime":1612618068,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612618068","product_id":100029501,"comment_content":"第二个例子，对比那个id不就是脱裤子放屁多番手续么 ，直接找平均身高即可啊，player表就有team_id的啊","like_count":0},{"had_liked":false,"id":277484,"user_name":"蓦然回首","can_delete":false,"product_type":"c1","uid":1172090,"ip_address":"","ucode":"B17658DCFE6402","user_header":"https://static001.geekbang.org/account/avatar/00/11/e2/7a/38a27e47.jpg","comment_is_top":false,"comment_ctime":1612429298,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1612429298","product_id":100029501,"comment_content":"在《SQL学习指南(第二版)》上面发现了EXISTS别的写法:<br>SELECT player_id, player_name, team_id <br>FROM player a<br>WHERE EXISTS<br>   (SELECT * FROM player_score b WHERE a.player_id=b.player_id GROUP BY player_id HAVING AVG(score) &gt; 20);<br>其中SELECT *也可以将*改成1，经过测试，发现结果都正确！<br>但就是不能把WHERE a.player_id=b.player_id这个WHERE字句给去掉，还是之前的疑惑，为啥这里一定要加上这个条件？<br>","like_count":0},{"had_liked":false,"id":277482,"user_name":"蓦然回首","can_delete":false,"product_type":"c1","uid":1172090,"ip_address":"","ucode":"B17658DCFE6402","user_header":"https://static001.geekbang.org/account/avatar/00/11/e2/7a/38a27e47.jpg","comment_is_top":false,"comment_ctime":1612428486,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1612428486","product_id":100029501,"comment_content":"为什么不加条件判断，EXISTS就得不到正确结果？外表循环，不应该拿外表的每一条记录和内表查询出来的结果作对比吗？为什么还要加个条件判断呢？那不判断，直接查询过滤出来的结果好像没起作用一样。","like_count":0},{"had_liked":false,"id":277480,"user_name":"蓦然回首","can_delete":false,"product_type":"c1","uid":1172090,"ip_address":"","ucode":"B17658DCFE6402","user_header":"https://static001.geekbang.org/account/avatar/00/11/e2/7a/38a27e47.jpg","comment_is_top":false,"comment_ctime":1612427978,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1612427978","product_id":100029501,"comment_content":"老师，EXISTS和IN这个语法上的区别没搞明白，请教一下：<br>下面三个SQL语句，为什么有的正确，有的不正确？<br>语句一：(不加WHERE a.player_id=b.player_id)的EXISTS<br>SELECT player_id, player_name, team_id <br>FROM player a<br>WHERE EXISTS<br>   (SELECT player_id FROM player_score b GROUP BY player_id HAVING AVG(score) &gt; 20);<br><br>语句二：(加了WHERE a.player_id=b.player_id)的EXISTS<br>SELECT player_id, player_name, team_id <br>FROM player a<br>WHERE EXISTS<br>   (SELECT player_id FROM player_score b WHERE a.player_id=b.player_id GROUP BY player_id HAVING AVG(score) &gt; 20);<br><br>语句三：(不加WHERE a.player_id=b.player_id)的IN<br>SELECT player_id, player_name, team_id <br>FROM player a<br>WHERE player_id IN<br>   (SELECT player_id FROM player_score b GROUP BY player_id HAVING AVG(score) &gt; 20);<br><br>为什么语句一是错误的，而语句二和语句三是正确的？","like_count":0},{"had_liked":false,"id":274493,"user_name":"Flychen","can_delete":false,"product_type":"c1","uid":1880782,"ip_address":"","ucode":"4029A8F1D3C361","user_header":"https://static001.geekbang.org/account/avatar/00/1c/b2/ce/5638be2b.jpg","comment_is_top":false,"comment_ctime":1611038082,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1611038082","product_id":100029501,"comment_content":"-- 编写 SQL 语句，得到场均得分大于 20 的球员。<br>-- 场均得分从 player_score 表中获取，同时你需要输出球员的 ID、球员姓名以及所在球队的 ID 信息。<br><br>-- ------------------------------------------------------------------------------------------------<br><br>select <br><br>pl.player_id 球员ID,<br>pl.player_name 球员姓名,<br>pl.team_id 球队id,<br>t.team_name<br><br><br><br>from player pl join team t on pl.team_id = t.team_id<br><br>where pl.player_id in (select p.player_id from player_score p where p.score &gt; 20)<br><br><br>通过本讲学会了exixts、any、all使用场景，有收获！","like_count":0},{"had_liked":false,"id":274482,"user_name":"Flychen","can_delete":false,"product_type":"c1","uid":1880782,"ip_address":"","ucode":"4029A8F1D3C361","user_header":"https://static001.geekbang.org/account/avatar/00/1c/b2/ce/5638be2b.jpg","comment_is_top":false,"comment_ctime":1611035216,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1611035216","product_id":100029501,"comment_content":"<br>SELECT player.* from player where exist (select team.team_id from team where team.team_id = player.team_id)<br><br>我这个sql这样写有什么问题吗？为啥执行不了","like_count":0},{"had_liked":false,"id":269765,"user_name":"max","can_delete":false,"product_type":"c1","uid":1003294,"ip_address":"","ucode":"9347A158EC04FA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4f/1e/9e69527e.jpg","comment_is_top":false,"comment_ctime":1608779626,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608779626","product_id":100029501,"comment_content":"SELECT <br>  player_name,<br>  height,<br>  team_id <br>FROM<br>  player a<br>WHERE height &gt; <br>  (SELECT <br>    AVG(height) <br>  FROM<br>    player AS b <br>  WHERE a.team_id = b.team_id) <br> a中每一个行的team_id 放到子查询, 取到身高平均值, 然后回到主查询去判断a表的height字段是否大于平均身高,<br> 这样a表的team.id会有多个重复的team_id 查出来的记录不应该也会有多个重复数据吗, 我有点理解不了子查询的过程<br> 能麻烦老师解答下吗","like_count":0},{"had_liked":false,"id":264725,"user_name":"let_me_go","can_delete":false,"product_type":"c1","uid":1510177,"ip_address":"","ucode":"A5936F5C5E3D65","user_header":"https://static001.geekbang.org/account/avatar/00/17/0b/21/f1aea35b.jpg","comment_is_top":false,"comment_ctime":1606617325,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606617325","product_id":100029501,"comment_content":"SELECT player_name, height, team_id FROM player AS a WHERE height &gt; (SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id)<br>老师：上文中的这一句SQL语句我不太明白其执行流程，能麻烦你分析下吗。<br>是先执行外表的FROM player AS a，然后执行内表的FROM player AS b，然后使用AVG计算出相同id的平均身高，然后再执行外表的WHERE height &gt; xxx吗，由于内表中有WHERE  a.team_id = b.team_id，所以heigth的比较范围还限定在了相同id之间。","like_count":0},{"had_liked":false,"id":256401,"user_name":"追风筝的人","can_delete":false,"product_type":"c1","uid":1488020,"ip_address":"","ucode":"2993D60F94C396","user_header":"https://static001.geekbang.org/account/avatar/00/16/b4/94/2796de72.jpg","comment_is_top":false,"comment_ctime":1603617618,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603617618","product_id":100029501,"comment_content":"EXISTS 和 IN 子查询效率的比较，当查询字段进行了索引时，主表 A 大于从表 B，使用 IN 子查询效率更高，相反主表 A 小于从表 B 时，使用 EXISTS 子查询效率更高","like_count":0},{"had_liked":false,"id":253001,"user_name":"盛艳明","can_delete":false,"product_type":"c1","uid":1132347,"ip_address":"","ucode":"E4C1C699572C44","user_header":"https://static001.geekbang.org/account/avatar/00/11/47/3b/15e4490f.jpg","comment_is_top":false,"comment_ctime":1602558761,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602558761","product_id":100029501,"comment_content":"SELECT player_id,<br>       player_name,<br>       team_id,<br>       (SELECT team_name FROM team WHERE team.team_id = player.team_id)                 as team_name,<br>       (SELECT score FROM player_score WHERE player_score.player_id = player.player_id) as score<br>FROM player<br>WHERE player_id IN (SELECT player_id FROM player_score WHERE score &gt; 20);","like_count":0},{"had_liked":false,"id":251504,"user_name":"心诚泽霖","can_delete":false,"product_type":"c1","uid":2047663,"ip_address":"","ucode":"4A22A4F4066254","user_header":"https://static001.geekbang.org/account/avatar/00/1f/3e/af/c3d3c167.jpg","comment_is_top":false,"comment_ctime":1601621795,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601621795","product_id":100029501,"comment_content":"SELECT player_name,player_id,team_id FROM player<br>WHERE player_id IN (SELECT player_id FROM player_score)<br><br>查询出场过的球员这样写可以吗？好像结果是一样的","like_count":0},{"had_liked":false,"id":249766,"user_name":"Serendipity","can_delete":false,"product_type":"c1","uid":1370694,"ip_address":"","ucode":"E9C7B39BD8DCCD","user_header":"https://static001.geekbang.org/account/avatar/00/14/ea/46/9c9808a9.jpg","comment_is_top":false,"comment_ctime":1600783169,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1600783169","product_id":100029501,"comment_content":"我是一个纯外行人，但能看出来问题挺多的：<br><br>1、一会儿是exist一会儿是exists<br>2、作者说函数要用大写，但是我看到他给的示例avg是小写","like_count":0},{"had_liked":false,"id":249059,"user_name":"杯莫停","can_delete":false,"product_type":"c1","uid":1759325,"ip_address":"","ucode":"4FA1D5CBBEF702","user_header":"https://static001.geekbang.org/account/avatar/00/1a/d8/5d/07dfb3b5.jpg","comment_is_top":false,"comment_ctime":1600417156,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1600417156","product_id":100029501,"comment_content":"验证IN和EXIST的效率：<br><br>#player作为主表 player_score作为子表<br>EXPLAIN SELECT player_id, team_id, player_name FROM player WHERE EXISTS (<br>\tSELECT player_id FROM player_score WHERE player.player_id = player_score.player_id<br>);<br>EXPLAIN SELECT player_id, team_id, player_name FROM player WHERE player_id in (SELECT player_id FROM player_score WHERE player.player_id = player_score.player_id)<br><br># player_score作为主表player作为子表<br>EXPLAIN SELECT player_id, score FROM player_score WHERE EXISTS (<br>\tSELECT player_id, team_id, player_name FROM player WHERE player.player_id = player_score.player_id<br>);<br><br>EXPLAIN SELECT player_id, score FROM player_score WHERE player_id in (SELECT player_id，team_id, player_name FROM player WHERE player_score.player_id = player.player_id)","like_count":0},{"had_liked":false,"id":247916,"user_name":"苏龙飞","can_delete":false,"product_type":"c1","uid":1033492,"ip_address":"","ucode":"A8D73115B67CF9","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c5/14/4a3ff99d.jpg","comment_is_top":false,"comment_ctime":1599916519,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1599916519","product_id":100029501,"comment_content":"<br>SELECT player_name, height, team_id FROM player AS a WHERE height &gt; (SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id)<br><br>老师好，这个语句里b表不是没有team_id字段吗？为啥还能用a.team_id = b.team_id的?<br><br>我使用下面的语句查询出来的结果是一样的，不是很明白其中的原理，如能解答一下，万分感谢：）<br>SELECT <br>    player_name, height, team_id<br>FROM<br>    player<br>WHERE<br>    height &gt; (SELECT <br>            AVG(height)<br>        FROM<br>            player)<br>","like_count":0},{"had_liked":false,"id":243951,"user_name":"欧阳洲","can_delete":false,"product_type":"c1","uid":1986708,"ip_address":"","ucode":"94606A6315F2BA","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKT9Tk01eiaQ9aAhszthzGm6lwruRWPXia1YYFozctrdRvKg0Usp8NbwuKBApwD0D6Fty2tib3RdtFJg/132","comment_is_top":false,"comment_ctime":1598338521,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598338521","product_id":100029501,"comment_content":"老师…实验结果不符合，<br>做了一上午实验，都是IN比EXISTS快…<br>两种情况都是IN比较快。<br>A&gt;B时，IN快很多。<br>A&lt;B时，IN快了一点点。","like_count":0},{"had_liked":false,"id":241577,"user_name":"夏天呀","can_delete":false,"product_type":"c1","uid":1673679,"ip_address":"","ucode":"1C5C060C05923B","user_header":"https://static001.geekbang.org/account/avatar/00/19/89/cf/1c7703b1.jpg","comment_is_top":false,"comment_ctime":1597361340,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597361340","product_id":100029501,"comment_content":"mysql&gt; SELECT player_id, player_name, team_id FROM player  WHERE player_id IN (SELECT player_id FROM player_score GROUP BY player_id HAVING AVG(score)&gt;20);<br>+-----------+------------------+---------+<br>| player_id | player_name      | team_id |<br>+-----------+------------------+---------+<br>|     10001 | 韦恩-艾灵顿      |    1001 |<br>|     10002 | 雷吉-杰克逊      |    1001 |<br>+-----------+------------------+---------+<br><br><br>参考了别的同学的作业，光学不练真的不行，学了后面的忘了前面的，刷题走起！","like_count":0},{"had_liked":false,"id":241041,"user_name":"Will","can_delete":false,"product_type":"c1","uid":1076913,"ip_address":"","ucode":"5D86AA5A43A4C8","user_header":"https://static001.geekbang.org/account/avatar/00/10/6e/b1/d59cb5e0.jpg","comment_is_top":false,"comment_ctime":1597158095,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597158095","product_id":100029501,"comment_content":"举例：SELECT * FROM (子查询) AS 表的别名;<br>这里的表的别名代表的是把“子查询”的结果作为一个别名还是把整个“SELECT * FROM (子查询) ”作为一个别名？<br>另外上面这个例子，已经不是别名那么简单了，而是把查询结果作为一张表，不知道我的理解对不对？","like_count":0},{"had_liked":false,"id":240502,"user_name":"Maske","can_delete":false,"product_type":"c1","uid":1696847,"ip_address":"","ucode":"A19BB41A47E852","user_header":"https://static001.geekbang.org/account/avatar/00/19/e4/4f/df6d810d.jpg","comment_is_top":false,"comment_ctime":1596951521,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1596951521","product_id":100029501,"comment_content":"SELECT * FROM player WHERE player_id IN (SELECT player_id FROM player_score WHERE score &gt; 20);","like_count":0},{"had_liked":false,"id":239335,"user_name":"Geek_gong1zu","can_delete":false,"product_type":"c1","uid":2086659,"ip_address":"","ucode":"D629A6652AB8E2","user_header":"https://static001.geekbang.org/account/avatar/00/1f/d7/03/db060811.jpg","comment_is_top":false,"comment_ctime":1596505387,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1596505387","product_id":100029501,"comment_content":"SELECT player_id,team_id,player_name <br>FROM player a<br>WHERE EXIST(SELECT player_id FROM player_score b WHERE a.player_id=b.player_id AND AVG(b.score)&gt;20);","like_count":0},{"had_liked":false,"id":234757,"user_name":"Ethan","can_delete":false,"product_type":"c1","uid":1276373,"ip_address":"","ucode":"016F1DEBA895B8","user_header":"https://static001.geekbang.org/account/avatar/00/13/79/d5/4a7971fc.jpg","comment_is_top":false,"comment_ctime":1594788411,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1594788411","product_id":100029501,"comment_content":"子查询的问题，以及如何优化，提到的太少了，对于大多数人来说，都需要自己去找答案。","like_count":0},{"had_liked":false,"id":232811,"user_name":"℡ㄨ和尚ふ","can_delete":false,"product_type":"c1","uid":2027690,"ip_address":"","ucode":"E26B2BC7D8E4FC","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f0/aa/6ba4a1ab.jpg","comment_is_top":false,"comment_ctime":1594122642,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594122642","product_id":100029501,"comment_content":"SELECT<br>\tplayer_id,<br>\tplayer_name,<br>\tteam_id<br>FROM<br>\tplayer<br>WHERE<br>\tEXISTS (<br>\t\tSELECT<br>\t\t\tplayer_id<br>\t\tFROM<br>\t\t\tplayer_score<br>\t\tWHERE<br>\t\t\tplayer.player_id = player_score.player_id<br>\t\tGROUP BY<br>\t\t\tplayer_id<br>\t\tHAVING<br>\t\t\tAVG(score) &gt; 20<br>\t)","like_count":0},{"had_liked":false,"id":232737,"user_name":"爱一兮堞鹿","can_delete":false,"product_type":"c1","uid":2001592,"ip_address":"","ucode":"3929BDCA949B75","user_header":"https://static001.geekbang.org/account/avatar/00/1e/8a/b8/fb8f3a42.jpg","comment_is_top":false,"comment_ctime":1594104963,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594104963","product_id":100029501,"comment_content":"原来是所有球员的平均身高。。我还以为是单独的某个球队的平均身高","like_count":0},{"had_liked":false,"id":232733,"user_name":"爱一兮堞鹿","can_delete":false,"product_type":"c1","uid":2001592,"ip_address":"","ucode":"3929BDCA949B75","user_header":"https://static001.geekbang.org/account/avatar/00/1e/8a/b8/fb8f3a42.jpg","comment_is_top":false,"comment_ctime":1594104601,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594104601","product_id":100029501,"comment_content":"统计球队的平均身高，即SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id<br>这句没看懂啊，这咋就计算出球队的平均身高了","like_count":0},{"had_liked":false,"id":229939,"user_name":"宁悦","can_delete":false,"product_type":"c1","uid":1901403,"ip_address":"","ucode":"68844C314FEEF8","user_header":"https://static001.geekbang.org/account/avatar/00/1d/03/5b/3cdbc9fa.jpg","comment_is_top":false,"comment_ctime":1593222676,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593222676","product_id":100029501,"comment_content":"SELECT player_id,player_name,team_id FROM player AS a WHERE EXISTS (SELECT player_id from player_score AS b  WHERE a.player_id = b.player_id GROUP BY player_id HAVING avg(score) &gt;20 );","like_count":0},{"had_liked":false,"id":229676,"user_name":"Vincent","can_delete":false,"product_type":"c1","uid":2015982,"ip_address":"","ucode":"F2CDC708F30997","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep8YUnk8Z9LAaLINgWWnt8HXu8ZlyD7vLpHrJaExGeZ5YyWIrI4SYcX3joOpibAWIyuqGibqVNwq8XQ/132","comment_is_top":false,"comment_ctime":1593096645,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1593096645","product_id":100029501,"comment_content":"看了半天终于搞懂了，作者有点自相矛盾。<br>简单来说就是n*log(m),然后利用索引把大表丢进log里面<br>------------------------------------------------------------------------------------<br>同样，如果表 A 比表 B 小，那么使用 EXISTS 子查询效率会更高，因为我们可以使用到 A 表中对 cc 列的索引，而不用从 B 中进行 cc 列的查询。<br>------------------------------------------------------------------------------------<br>作者回复: IN子查询，是从表计算出来作为已知值，而EXISTS子查询是主表作为已知值传递给从表。<br>基于小表驱动大表的原则，主表A小 就用EXIST，从表B表小 就用IN<br>这里主要看能否用到索引，假设主表A有n条数据，从表B有m条数据，表A和表B中的查询字段采用B+树进行索引，那么两个子查询的执行效率：<br>使用 in ：log (n) * m<br>使用 exists： n * log (m)<br>对于IN子查询，计算出来的结果作为已知值，就可以使得表A（n条数据）可以使用到索引，从而提升检索效率<br>对于EXISTS子查询，外表A作为已知值，传递给从表，可以利用从表B（m条数据）中的索引，从而提升检索效率。<br>（说明log 代表以2为底的对数，即B+树的深度）","like_count":0,"discussions":[{"author":{"id":1688372,"avatar":"","nickname":"你的代码有灵魂吗？","note":"","ucode":"0A276F30307965","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364926,"discussion_content":"这句话我也一直觉得有问题，但是这么久了竟然都没有纠错；\n------------------------------------------------------------------------------------\n同样，如果表 A 比表 B 小，那么使用 EXISTS 子查询效率会更高，因为我们可以使用到 A 表中对 cc 列的索引，而不用从 B 中进行 cc 列的查询。\n------------------------------------------------------------------------------------\n而且 in 和 exists问题，很多人都没明白，但是老师也没有进一步讲清楚，有些点该进一步讲清楚的也一直在抛结论，而没有讲清楚为什么","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617666560,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":227520,"user_name":"PHP菜鸟","can_delete":false,"product_type":"c1","uid":1899397,"ip_address":"","ucode":"77B7DC81B5AA1F","user_header":"https://static001.geekbang.org/account/avatar/00/1c/fb/85/f3fd1724.jpg","comment_is_top":false,"comment_ctime":1592399142,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592399142","product_id":100029501,"comment_content":"子查询和关联查询哪个效率高呢?","like_count":0},{"had_liked":false,"id":227510,"user_name":"PHP菜鸟","can_delete":false,"product_type":"c1","uid":1899397,"ip_address":"","ucode":"77B7DC81B5AA1F","user_header":"https://static001.geekbang.org/account/avatar/00/1c/fb/85/f3fd1724.jpg","comment_is_top":false,"comment_ctime":1592396737,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592396737","product_id":100029501,"comment_content":"SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id,b是player表,a是那个?","like_count":0},{"had_liked":false,"id":224747,"user_name":"Geek_Song","can_delete":false,"product_type":"c1","uid":1535217,"ip_address":"","ucode":"DCC90A6683D024","user_header":"https://static001.geekbang.org/account/avatar/00/17/6c/f1/9ab33f89.jpg","comment_is_top":false,"comment_ctime":1591527200,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591527200","product_id":100029501,"comment_content":"作业：SELECT<br>\tp.player_id,<br>\tp.player_name,<br>\tp.team_id <br>FROM<br>\tplayer p <br>WHERE<br>\tEXISTS (<br>\tSELECT<br>\t\ts.player_id,<br>\t\tAVG( s.score ) avg_score <br>\tFROM<br>\t\tplayer_score s <br>\tWHERE<br>\t\ts.player_id = p.player_id <br>\tGROUP BY<br>\t\ts.player_id <br>\tHAVING<br>\tavg_score &gt; 20 <br>\t)","like_count":0},{"had_liked":false,"id":224295,"user_name":"Fan","can_delete":false,"product_type":"c1","uid":1168774,"ip_address":"","ucode":"9A5B148A7E453A","user_header":"https://static001.geekbang.org/account/avatar/00/11/d5/86/5b1ff7d9.jpg","comment_is_top":false,"comment_ctime":1591338580,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591338580","product_id":100029501,"comment_content":"#使用子查询，编写 SQL 语句，得到场均得分大于 20 的球员。场均得分从 player_score 表中获取，<br>#同时你需要输出球员的 ID、球员姓名以及所在球队的 ID 信息<br><br><br>SELECT t1.player_id, t1.player_name, t1.team_id FROM player AS t1<br>WHERE t1.player_id IN (SELECT t2.player_id FROM player_score AS t2 WHERE t2.score &gt; 20 );<br><br><br>SELECT t1.player_id, t1.player_name, t1.team_id FROM player AS t1<br>WHERE EXISTS (SELECT t2.player_id FROM player_SCORE AS t2 WHERE t2.score &gt; 20 and t1.player_id = t2.player_id);","like_count":0},{"had_liked":false,"id":224117,"user_name":"Fan","can_delete":false,"product_type":"c1","uid":1168774,"ip_address":"","ucode":"9A5B148A7E453A","user_header":"https://static001.geekbang.org/account/avatar/00/11/d5/86/5b1ff7d9.jpg","comment_is_top":false,"comment_ctime":1591278420,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591278420","product_id":100029501,"comment_content":"SELECT<br>t1.player_id,<br>t1.player_name,<br>t1.team_id <br>FROM<br>player AS t1 <br>WHERE<br>\tt1.player_id IN (<br>\t\tSELECT<br>\t\tt2.player_id <br>\t\tFROM<br>\t\tplayer_score AS t2 <br>\t\tGROUP BY t2.player_id HAVING( AVG( t2.score ) &gt; 20 ) <br>\t)","like_count":0},{"had_liked":false,"id":222996,"user_name":"大飞","can_delete":false,"product_type":"c1","uid":1187523,"ip_address":"","ucode":"DA641A3C6ECCFC","user_header":"https://static001.geekbang.org/account/avatar/00/12/1e/c3/c9399b2e.jpg","comment_is_top":false,"comment_ctime":1590978595,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590978595","product_id":100029501,"comment_content":"SELECT player_id,player_name,team_id FROM player  WHERE player_id IN (SELECT player_id FROM player_score GROUP BY player_id HAVING AVG(score) &gt;20 )","like_count":0},{"had_liked":false,"id":220805,"user_name":"Edward","can_delete":false,"product_type":"c1","uid":1008343,"ip_address":"","ucode":"4ABF119D75C46F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/62/d7/48a7fb45.jpg","comment_is_top":false,"comment_ctime":1590325482,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590325482","product_id":100029501,"comment_content":"SELECT p.player_id, p.player_name, p.team_id FROM player p<br>WHERE p.player_id IN (SELECT ps.player_id FROM player_score ps GROUP BY ps.player_id HAVING AVG(ps.score) &gt; 20)","like_count":0},{"had_liked":false,"id":220751,"user_name":"彤彤","can_delete":false,"product_type":"c1","uid":1866382,"ip_address":"","ucode":"6058FC822EF649","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/0bexhQ6hllSYOM9GoRaR0Rq99aZqOAIfBblqfNbD5YXDcWRdWcDLpaTp4R8LbSfQTaCmRhcibehHMLzTb3yQ53Q/132","comment_is_top":false,"comment_ctime":1590318393,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1590318393","product_id":100029501,"comment_content":"用下面这条语句查询出来的结果和文中给出的一样，为什么还要复制两张表呢<br>SELECT player_name, height, team_id FROM h_nba.player <br>WHERE height &gt; (SELECT avg(height) FROM h_nba.player )<br><br>文中给出语句：<br>-- 查找每个球队中大于平均身高的球员有哪些，并显示他们的球员姓名、身高以及所在球队 ID。<br>SELECT player_name, height, team_id FROM h_nba.player AS a <br>WHERE height &gt; (SELECT avg(height) FROM h_nba.player AS b WHERE a.team_id = b.team_id)","like_count":0,"discussions":[{"author":{"id":1914002,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/jlNyhkIrVagxxnLT3Znm0Rwia2CiapODiaibJ1LGjicbV6QqRFfb3vTI4G58nKNNg9PACBAz52jKhzZhs3Kbj9sZ45g/132","nickname":"跨域刀","note":"","ucode":"236752722BA026","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":272982,"discussion_content":"上面老师回复的：  因为我们检索的是不是全体成员的平均身高，而是整个球员所在球队的平均身高，所以是WHERE a.team_id = b.team_id。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590386758,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":208729,"user_name":"keep it simple","can_delete":false,"product_type":"c1","uid":1574739,"ip_address":"","ucode":"72B8DC00247C9E","user_header":"https://static001.geekbang.org/account/avatar/00/18/07/53/05aa9573.jpg","comment_is_top":false,"comment_ctime":1587429747,"is_pvip":false,"replies":[{"id":"78633","content":"可以在命令行中设置下编码类型<br>Step1, use database_name; <br>Step2, set names utf8; <br>Step3, source player.sql (sql文件存放路径) ","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587993543,"ip_address":"","comment_id":208729,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1587429747","product_id":100029501,"comment_content":"请教老师，把github上的.sql文件source到本地数据库后，player_name字段变成了乱码，如何恢复呢","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492595,"discussion_content":"可以在命令行中设置下编码类型\nStep1, use database_name; \nStep2, set names utf8; \nStep3, source player.sql (sql文件存放路径) ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587993543,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":207658,"user_name":"Joker","can_delete":false,"product_type":"c1","uid":1156592,"ip_address":"","ucode":"126AF848001A1E","user_header":"https://static001.geekbang.org/account/avatar/00/11/a5/f0/8648c464.jpg","comment_is_top":false,"comment_ctime":1587130317,"is_pvip":false,"replies":[{"id":"78631","content":"这样写也是对的","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587992981,"ip_address":"","comment_id":207658,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1587130317","product_id":100029501,"comment_content":"如果我们想要查询球员表中，比印第安纳步行者（对应的 team_id 为 1002）中任何一个球员身高高的球员的信息，并且输出他们的球员 ID、球员姓名和球员身高，该怎么写呢？<br>---<br>任何一个，那不就成了select   max(height) from player where team_id = 1002","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492194,"discussion_content":"这样写也是对的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587992981,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":207657,"user_name":"Joker","can_delete":false,"product_type":"c1","uid":1156592,"ip_address":"","ucode":"126AF848001A1E","user_header":"https://static001.geekbang.org/account/avatar/00/11/a5/f0/8648c464.jpg","comment_is_top":false,"comment_ctime":1587130179,"is_pvip":false,"replies":[{"id":"78632","content":"嗯 任意一个","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587993101,"ip_address":"","comment_id":207657,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1587130179","product_id":100029501,"comment_content":"如果我们想要查询球员表中，比印第安纳步行者（对应的 team_id 为 1002）中任何一个球员身高高的球员的信息，并且输出他们的球员 ID、球员姓名和球员身高，该怎么写呢？<br>---<br>任何一个是不是表达有误，应该是任意一个吧？","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492193,"discussion_content":"嗯 任意一个","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587993101,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":206729,"user_name":"han","can_delete":false,"product_type":"c1","uid":1707024,"ip_address":"","ucode":"1B9B3473BF64FD","user_header":"https://static001.geekbang.org/account/avatar/00/1a/0c/10/42673e15.jpg","comment_is_top":false,"comment_ctime":1586922654,"is_pvip":false,"replies":[{"id":"78634","content":"问题1，player AS b之后，就需要使用b<br>问题2，因为你前面求的是 avg(b.height)，你可以试试：<br>SELECT b.height FROM player AS b<br>join player as a<br>WHERE a.team_id = b.team_id","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587993694,"ip_address":"","comment_id":206729,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1586922654","product_id":100029501,"comment_content":"请教两个问题，<br>1、为什么 在mysql中，以下选择球队平均身高的语句<br>SELECT avg(b.height) FROM player AS b WHERE b.team_id = player.team_id会报错？<br>嵌套在子查询中却不会<br><br>SELECT player_name, height, team_id FROM player AS a WHERE height &gt; (SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id)<br><br>2、如果我用join的话，需要加上group by才能得到正确的结果，否则只显示一个数值。<br>SELECT avg(b.height) FROM player AS b<br>join player as a<br>WHERE a.team_id = b.team_id<br>group by b.team_id<br><br><br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491882,"discussion_content":"问题1，player AS b之后，就需要使用b\n问题2，因为你前面求的是 avg(b.height)，你可以试试：\nSELECT b.height FROM player AS b\njoin player as a\nWHERE a.team_id = b.team_id","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587993694,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1914002,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/jlNyhkIrVagxxnLT3Znm0Rwia2CiapODiaibJ1LGjicbV6QqRFfb3vTI4G58nKNNg9PACBAz52jKhzZhs3Kbj9sZ45g/132","nickname":"跨域刀","note":"","ucode":"236752722BA026","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":272985,"discussion_content":"问题1个人感觉是和查询顺序有关，先from，发现from 后只有一个player表并用别名b 替代。也就是from后面只有一个 player表且别名为b。不存在其他player表。对于player.team_id中的player表，系统认为其存在不合理。Oracle上测试报player.team_id 标识符无效。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590387252,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":205592,"user_name":"庄小P","can_delete":false,"product_type":"c1","uid":1489063,"ip_address":"","ucode":"A71FA01F713790","user_header":"","comment_is_top":false,"comment_ctime":1586680455,"is_pvip":false,"replies":[{"id":"78635","content":"首先我们需要统计球队的平均身高，即SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id，<br>这里表a的定义，在外表已经定义了<br>然后筛选身高大于这个数值的球员，所以是SELECT player_name, height, team_id FROM player AS a WHERE height &gt;...","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587993820,"ip_address":"","comment_id":205592,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1586680455","product_id":100029501,"comment_content":"<br>SELECT player_name, height, team_id FROM player AS a WHERE height &gt; (SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id) 看不懂为什么这里要写成这样子，也没有解释","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491522,"discussion_content":"首先我们需要统计球队的平均身高，即SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id，\n这里表a的定义，在外表已经定义了\n然后筛选身高大于这个数值的球员，所以是SELECT player_name, height, team_id FROM player AS a WHERE height &amp;gt;...","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587993820,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":204087,"user_name":"凌空飞起的剪刀腿","can_delete":false,"product_type":"c1","uid":1243680,"ip_address":"","ucode":"16FBBF4A3B54C6","user_header":"https://static001.geekbang.org/account/avatar/00/12/fa/20/0f06b080.jpg","comment_is_top":false,"comment_ctime":1586331074,"is_pvip":false,"replies":[{"id":"78636","content":"Good Question, 如果使用SELECT avg(height) FROM player，这里求解的是 全联盟的平均身高。而我们想要求解的是 这个球员所在球队的平均身高","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587993893,"ip_address":"","comment_id":204087,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1586331074","product_id":100029501,"comment_content":"老师您好：<br>    不太理解<br>如果子查询的执行依赖于外部查询，通常情况下都是因为子查询中的表用到了外部的表，并进行了条件关联，因此每执行一次外部查询，子查询都要重新计算一次，这样的子查询就称之为关联子查询。比如我们想要查找每个球队中大于平均身高的球员有哪些，并显示他们的球员姓名、身高以及所在球队 ID。<br><br>SELECT player_name, height, team_id FROM player AS a WHERE height &gt; (SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id)<br>我觉得这样也可以得出答案<br>SELECT player_name, height, team_id FROM player AS a WHERE height &gt; (SELECT avg(height) FROM player)","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491074,"discussion_content":"Good Question, 如果使用SELECT avg(height) FROM player，这里求解的是 全联盟的平均身高。而我们想要求解的是 这个球员所在球队的平均身高","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587993893,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":204073,"user_name":"ClaireToffler","can_delete":false,"product_type":"c1","uid":1738030,"ip_address":"","ucode":"0C537F129F4EAF","user_header":"https://static001.geekbang.org/account/avatar/00/1a/85/2e/92c506ce.jpg","comment_is_top":false,"comment_ctime":1586329368,"is_pvip":false,"replies":[{"id":"78637","content":"是的 和英文一样","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587993912,"ip_address":"","comment_id":204073,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1586329368","product_id":100029501,"comment_content":"那个any  和all 就是任何和所有的区别吗?<br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491069,"discussion_content":"是的 和英文一样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587993912,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":202679,"user_name":"王加武","can_delete":false,"product_type":"c1","uid":1665471,"ip_address":"","ucode":"DDCFE578C6C428","user_header":"https://static001.geekbang.org/account/avatar/00/19/69/bf/50a824a4.jpg","comment_is_top":false,"comment_ctime":1586052816,"is_pvip":false,"replies":[{"id":"78638","content":"多谢分享，如果in和or所在列有索引或者主键的时候，or和in的执行时间没什么差别。<br>如果in和or所在列没有索引，就是你分析的情况","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587994117,"ip_address":"","comment_id":202679,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1586052816","product_id":100029501,"comment_content":"IN和OR的区别<br>一、操作不同<br><br>1、in：in是把父查询表和子查询表作hash连接。<br><br>2、or：or是对父查询表作loop循环，每次loop循环再对子查询表进行查询。<br><br>二、适用场景不同<br><br>1、in：in适合用于子查询表数据比父查询表数据多的情况。<br><br>2、or：or适合用于子查询表数据比父查询表数据少的情况。<br><br>三、效率不同<br><br>1、in：在没有索引的情况下，随着in后面的数据量越多，in的执行效率不会有太大的下降。<br><br>2、or：在没有索引的情况下，随着or后面的数据量越多，or的执行效率会有明显的下降。<br><br><br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490653,"discussion_content":"多谢分享，如果in和or所在列有索引或者主键的时候，or和in的执行时间没什么差别。\n如果in和or所在列没有索引，就是你分析的情况","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587994117,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":200551,"user_name":"Cookie123456","can_delete":false,"product_type":"c1","uid":1913261,"ip_address":"","ucode":"F9EF63C38F8976","user_header":"","comment_is_top":false,"comment_ctime":1585618004,"is_pvip":false,"replies":[{"id":"78640","content":"EXISTS前面应该没有player_id<br>此外我们想要求解的是场均得分&gt;20的球员","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587994271,"ip_address":"","comment_id":200551,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1585618004","product_id":100029501,"comment_content":"SELECT<br>\tplayer_id,<br>\tplayer_name,<br>\tteam_id <br>FROM<br>\tplayer <br>WHERE<br>\tplayer_id EXISTS ( SELECT player_id FROM player_score WHERE score &gt; 20 )","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490064,"discussion_content":"EXISTS前面应该没有player_id\n此外我们想要求解的是场均得分&amp;gt;20的球员","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587994271,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":200549,"user_name":"Cookie123456","can_delete":false,"product_type":"c1","uid":1913261,"ip_address":"","ucode":"F9EF63C38F8976","user_header":"","comment_is_top":false,"comment_ctime":1585617978,"is_pvip":false,"replies":[{"id":"78641","content":"EXISTS前面应该没有player_id<br>此外我们想要求解的是场均得分&gt;20的球员","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587994334,"ip_address":"","comment_id":200549,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1585617978","product_id":100029501,"comment_content":"SELECT player_id, player_name,team_id from player WHERE player_id exists(SELECT player_id from player_score WHERE score&gt;20 )<br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490063,"discussion_content":"EXISTS前面应该没有player_id\n此外我们想要求解的是场均得分&amp;gt;20的球员","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587994334,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":195298,"user_name":"Geek_be6c96","can_delete":false,"product_type":"c1","uid":1914110,"ip_address":"","ucode":"6BA52A8FD44E83","user_header":"https://static001.geekbang.org/account/avatar/00/1d/34/fe/64adaacd.jpg","comment_is_top":false,"comment_ctime":1585155836,"is_pvip":false,"replies":[{"id":"78645","content":"加油~","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587994380,"ip_address":"","comment_id":195298,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1585155836","product_id":100029501,"comment_content":"学习了，还需要再思考下","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489020,"discussion_content":"加油~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587994380,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":194514,"user_name":"track6688","can_delete":false,"product_type":"c1","uid":1088040,"ip_address":"","ucode":"0A9E893F8FD379","user_header":"https://static001.geekbang.org/account/avatar/00/10/9a/28/03613c22.jpg","comment_is_top":false,"comment_ctime":1585064184,"is_pvip":false,"replies":[{"id":"78647","content":"通过AVG(score) 进行求解也可以，另外结果少了一位球员，你可以check下","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587994677,"ip_address":"","comment_id":194514,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1585064184","product_id":100029501,"comment_content":"不知道我有没有理解错。。。。<br>SELECT<br>\tp.player_id,<br>\tp.player_name,<br>\tp.team_id<br>FROM<br>\tplayer p<br>WHERE<br>\tp.player_id IN (<br>\tSELECT<br>\t\tgame_sum.player_id<br>\tFROM<br>\t\t(<br>\t\tSELECT<br>\t\t\tps.player_id,<br>\t\t\tps.game_id,<br>\t\t\tSUM(shoot_hits) AS shoot_hits_sum,<br>\t\t\tSUM(shoot_3_hits) AS shoot_3_hits_sum,<br>\t\t\tSUM(shoot_p_hits) AS shoot_p_hits_sum<br>\t\tFROM<br>\t\t\tplayer_score ps<br>\t\tGROUP BY<br>\t\t\tps.game_id,<br>\t\t\tps.player_id ) game_sum<br>\tGROUP BY<br>\t\tgame_sum.player_id<br>\tHAVING<br>\t\tAVG((shoot_hits_sum - shoot_3_hits_sum - shoot_p_hits_sum) * 2 + shoot_3_hits_sum * 3 + shoot_p_hits_sum) &gt; 20 );","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488834,"discussion_content":"通过AVG(score) 进行求解也可以，另外结果少了一位球员，你可以check下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587994677,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":191554,"user_name":"慌张而黑糖","can_delete":false,"product_type":"c1","uid":1638878,"ip_address":"","ucode":"B4416885A301C8","user_header":"https://static001.geekbang.org/account/avatar/00/19/01/de/bf524817.jpg","comment_is_top":false,"comment_ctime":1584780736,"is_pvip":false,"replies":[{"id":"78648","content":"可以这么理解","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587994744,"ip_address":"","comment_id":191554,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1584780736","product_id":100029501,"comment_content":"对于exists和in这两个，是不是说exists后执行子查询，而in是先执行子查询，这样就对应了老师分析的那两个for循环","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488204,"discussion_content":"可以这么理解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587994744,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":188330,"user_name":"Geek_e6159b","can_delete":false,"product_type":"c1","uid":1576240,"ip_address":"","ucode":"0684569F9B114D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLlibCGekRp9bxJ3dGfOWghhNVdF771ejzwqKnicKFBpmGuutwNGF3HGZz7KEEz2mdvPckibReRsVtDw/132","comment_is_top":false,"comment_ctime":1584341508,"is_pvip":false,"replies":[{"id":"78650","content":"子查询中有没有where，结果不同，代表的含义也不同。如果没有WHERE，代表的是全联盟的平均身高","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587994824,"ip_address":"","comment_id":188330,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1584341508","product_id":100029501,"comment_content":"<br>SELECT player_name, height, team_id FROM player AS a WHERE height &gt; (SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id)<br>这个 子查询中的where条件有没有都 行，只是为了体现是关联子查询吗？","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487380,"discussion_content":"子查询中有没有where，结果不同，代表的含义也不同。如果没有WHERE，代表的是全联盟的平均身高","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587994824,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":180951,"user_name":"-阿春","can_delete":false,"product_type":"c1","uid":1589451,"ip_address":"","ucode":"34FDB4FFFD5371","user_header":"https://static001.geekbang.org/account/avatar/00/18/40/cb/f7651436.jpg","comment_is_top":false,"comment_ctime":1582448427,"is_pvip":false,"replies":[{"id":"78651","content":"一般子查询效率会好一些，尤其是多表进行连接查询，这时会严重影响速度，可以使用子查询来代替","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587995052,"ip_address":"","comment_id":180951,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1582448427","product_id":100029501,"comment_content":"陈老师我有个问题 两表联查的时候是子查询快呢还是用连接表查询快呢","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484861,"discussion_content":"一般子查询效率会好一些，尤其是多表进行连接查询，这时会严重影响速度，可以使用子查询来代替","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587995052,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1735723,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/7c/2b/08242e40.jpg","nickname":"dean","note":"","ucode":"155E4F7F6A069D","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":282582,"discussion_content":"连查时要是用到多表的字段，比如说查询10个字段，3表联查，a表为主表，查四个字段，b c各查3个，这样的话，也是用子查询嘛？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592020553,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":176464,"user_name":"子铭","can_delete":false,"product_type":"c1","uid":1633308,"ip_address":"","ucode":"EE4447076A4DB2","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIDFo5d0p9V2D2XyPjJYU3CcFROe0YeBMN8BTelJ4NwTznb5ezqibUr1paKL68CKQwiboVOtrcZHPIg/132","comment_is_top":false,"comment_ctime":1581064868,"is_pvip":false,"replies":[{"id":"78652","content":"赞 其中第3步，可以用 AVG(score)","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587995115,"ip_address":"","comment_id":176464,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1581064868","product_id":100029501,"comment_content":"脚本我需要在考虑下，但是我先把我的思路写下来<br>\t1.以球员id分组，获取所有得分纪录，比赛场次<br>\t2.根据球员id获取队伍id，并获取有队伍id的比赛id的数量。<br>\t3.球员总得分&#47;比赛数量获取场均（该情况暂不考虑球员不上场等边界情况）<br>\t4.输出条件约束的相关球员信息<br>\t<br>评论区的部分朋友写的脚本的查询结果虽然正确但是有部分朋友的脚本我都一一进行了验证，当同一球员多条比赛得分纪录时，结果就会出错，我的建议是，查询结果正确并不代表脚本就是正确的，也欢迎大家指正我的错误。","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483117,"discussion_content":"赞 其中第3步，可以用 AVG(score)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587995115,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":174587,"user_name":"springmonster","can_delete":false,"product_type":"c1","uid":1239619,"ip_address":"","ucode":"9DC90DCE4F2365","user_header":"https://static001.geekbang.org/account/avatar/00/12/ea/43/dc05b2c6.jpg","comment_is_top":false,"comment_ctime":1580286648,"is_pvip":false,"replies":[{"id":"78653","content":"结果正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587995133,"ip_address":"","comment_id":174587,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1580286648","product_id":100029501,"comment_content":"SELECT<br>\tp.player_id,<br>\tp.player_name,<br>\tt.team_id,<br>\tt.team_name <br>FROM<br>\tplayer p<br>\tJOIN team t ON p.team_id = t.team_id <br>WHERE<br>\tEXISTS (<br>\tSELECT<br>\t\tp2.player_id <br>\tFROM<br>\t\tplayer_score p2 <br>\tWHERE<br>\t\tp.player_id = p2.player_id <br>\tGROUP BY<br>\t\tp2.player_id <br>\tHAVING<br>\tAVG( p2.score ) &gt; 20 <br>\t)","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482454,"discussion_content":"结果正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587995133,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":171225,"user_name":"永降不息之雨","can_delete":false,"product_type":"c1","uid":1362563,"ip_address":"","ucode":"087A934F68E445","user_header":"https://static001.geekbang.org/account/avatar/00/14/ca/83/684361be.jpg","comment_is_top":false,"comment_ctime":1578884006,"is_pvip":false,"replies":[{"id":"78654","content":"主要看WHERE之后的字段，是否可以进行索引。如果是SELECT后面的 不一定要增加索引","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587995216,"ip_address":"","comment_id":171225,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1578884006","product_id":100029501,"comment_content":"如果索引只有一个字段，但是返回多个字段怎么办","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481267,"discussion_content":"主要看WHERE之后的字段，是否可以进行索引。如果是SELECT后面的 不一定要增加索引","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587995216,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":168845,"user_name":"稻草人","can_delete":false,"product_type":"c1","uid":1332946,"ip_address":"","ucode":"B50BEC01C4D65B","user_header":"https://static001.geekbang.org/account/avatar/00/14/56/d2/65db8cc6.jpg","comment_is_top":false,"comment_ctime":1578197811,"is_pvip":false,"replies":[{"id":"78655","content":"for player in a表<br>   for player in b表<br>     根据a表的team_id 对b表进行筛选，然后求解avg(height)","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587995375,"ip_address":"","comment_id":168845,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1578197811","product_id":100029501,"comment_content":"<br>SELECT player_name, height, team_id FROM player AS a WHERE height &gt; (SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id)<br>请问老师，这样的SQL的执行顺序逻辑是什么？先执行什么后执行什么。主要对后面一个select语句和前面一个select语句执行顺序不理解","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480351,"discussion_content":"for player in a表\n   for player in b表\n     根据a表的team_id 对b表进行筛选，然后求解avg(height)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587995375,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":165973,"user_name":"小文同学","can_delete":false,"product_type":"c1","uid":1001893,"ip_address":"","ucode":"48F2AEB989C12A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/49/a5/e4c1c2d4.jpg","comment_is_top":false,"comment_ctime":1577353213,"is_pvip":false,"replies":[{"id":"63472","content":"加油qpm同学","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577503736,"ip_address":"","comment_id":165973,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1577353213","product_id":100029501,"comment_content":"一遍读专栏，一遍刷leetcode sql部分。非常有益","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":479336,"discussion_content":"加油qpm同学","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577503736,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":165892,"user_name":"慕城暖阳","can_delete":false,"product_type":"c1","uid":1490699,"ip_address":"","ucode":"F6B58F377325DB","user_header":"https://static001.geekbang.org/account/avatar/00/16/bf/0b/173b87bb.jpg","comment_is_top":false,"comment_ctime":1577341523,"is_pvip":false,"replies":[{"id":"78718","content":"我举个例子，比如SELECT player_name, height, team_id FROM player AS a WHERE height &gt; (SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id)<br>这里相当于：<br>for player1 in 表a<br>    for player2 in 表b<br>       筛选player2.team_id = player1.team_id，然后求avg(player2.height)","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1588038896,"ip_address":"","comment_id":165892,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1577341523","product_id":100029501,"comment_content":"老师您好，我想问下，您在讲关联子查询时候用了内表和外表嵌套循环作为例子，先是外表循环，然后是内表循环，但是第一次执行主查询的时候，where后面的子查询是没有执行结果的，没有where的主查询是怎么能查出结果传给子查询呢呢？还有就是关联子查询中内外查询是按照逐行匹配的吗","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":479309,"discussion_content":"我举个例子，比如SELECT player_name, height, team_id FROM player AS a WHERE height &amp;gt; (SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id)\n这里相当于：\nfor player1 in 表a\n    for player2 in 表b\n       筛选player2.team_id = player1.team_id，然后求avg(player2.height)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588038896,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":163751,"user_name":"YiFān.W","can_delete":false,"product_type":"c1","uid":1339594,"ip_address":"","ucode":"CBC3233CE2FA44","user_header":"https://static001.geekbang.org/account/avatar/00/14/70/ca/deb1a067.jpg","comment_is_top":false,"comment_ctime":1576799552,"is_pvip":false,"replies":[{"id":"62648","content":"因为是比印第安纳步行者（对应的 team_id 为 1002）中任何一个球员身高高的球员的信息，所以是 &gt; ANY","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577081062,"ip_address":"","comment_id":163751,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1576799552","product_id":100029501,"comment_content":"<br>SQL: SELECT player_id, player_name, height FROM player WHERE height &gt; ANY (SELECT height FROM player WHERE team_id = 1002)<br><br>这里为什么使用大于号而不是等于号？ 要查的不是所有记录吗。。。话说这种需求没必要用子查询吧","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478526,"discussion_content":"因为是比印第安纳步行者（对应的 team_id 为 1002）中任何一个球员身高高的球员的信息，所以是 &amp;gt; ANY","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577081062,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1339594,"avatar":"https://static001.geekbang.org/account/avatar/00/14/70/ca/deb1a067.jpg","nickname":"YiFān.W","note":"","ucode":"CBC3233CE2FA44","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":107487,"discussion_content":"第一次没看清楚 抱歉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577584012,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":162522,"user_name":"高泽林","can_delete":false,"product_type":"c1","uid":1764725,"ip_address":"","ucode":"DE54EBFFF11265","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/AGicQgKibwja1SxkQ7oXQE8hYH7yCpiaicNHw3qZRuNB81aVDOQm9P1zd5F75Jbtv66G15D6ZjbbqfnoETR4321Zdw/132","comment_is_top":false,"comment_ctime":1576549234,"is_pvip":false,"replies":[{"id":"62568","content":"加油泽林同学~","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577068242,"ip_address":"","comment_id":162522,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1576549234","product_id":100029501,"comment_content":"一直不知道该怎么查询关联查询，终于明白了！","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478075,"discussion_content":"加油泽林同学~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577068242,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":162309,"user_name":"taoist","can_delete":false,"product_type":"c1","uid":1195004,"ip_address":"","ucode":"D70AFE25CD8F10","user_header":"https://static001.geekbang.org/account/avatar/00/12/3b/fc/04a75cd0.jpg","comment_is_top":false,"comment_ctime":1576498201,"is_pvip":true,"replies":[{"id":"62653","content":"正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577081327,"ip_address":"","comment_id":162309,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1576498201","product_id":100029501,"comment_content":"-- Mariadb<br>SELECT<br>\tplayer_id,\tplayer_name ,\tteam_id FROM  player WHERE \tplayer_id IN (<br>\tSELECT  player_id\tFROM player_score  GROUP BY player_id \tHAVING\tAVG(score) &gt; 20)","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478010,"discussion_content":"正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577081327,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":147121,"user_name":"Geek_0c1732","can_delete":false,"product_type":"c1","uid":1721278,"ip_address":"","ucode":"6276D0412CCE51","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ajNVdqHZLLAhj2fB8NI2TPI1SNicgiciczuMUHyAb9HHBkkKJHrgtR162fsicaTqdAneHfuVX7icDXaVibDHstM9L47g/132","comment_is_top":false,"comment_ctime":1572799417,"is_pvip":false,"replies":[{"id":"78721","content":"这里主要看能否用到索引，假设主表A有n条数据，从表B有m条数据，表A和表B中的查询字段采用B+树进行索引，那么两个子查询的执行效率：<br>使用 in ：log (n) * m<br>使用 exists： n * log (m)<br>对于IN子查询，计算出来的结果作为已知值，就可以使得表A（n条数据）可以使用到索引，从而提升检索效率<br>对于EXISTS子查询，外表A作为已知值，传递给从表，可以利用从表B（m条数据）中的索引，从而提升检索效率。<br>（说明log 代表以2为底的对数，即B+树的深度）","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1588039296,"ip_address":"","comment_id":147121,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1572799417","product_id":100029501,"comment_content":"老师，关于in查询与exists查询是否可以理解为in查询是非关联查询，因此先查内表再查外表，这样如果内表数据较少，则可以直接读入缓存中，这时只要遍历外表索引即可。对于exists查寻，先查外表，如果外表数据较少，则可直接写入缓存中，再遍历内表索引即可。<br>反过来，如果内表数据较大外表数据较小使用in查询，由于内表数据无法全部写入缓存中，导致每遍历一条外表数据必须重新读取一次内表未写入缓存的数据，导致查询效率不高，对于exists查询也是如此。","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473157,"discussion_content":"这里主要看能否用到索引，假设主表A有n条数据，从表B有m条数据，表A和表B中的查询字段采用B+树进行索引，那么两个子查询的执行效率：\n使用 in ：log (n) * m\n使用 exists： n * log (m)\n对于IN子查询，计算出来的结果作为已知值，就可以使得表A（n条数据）可以使用到索引，从而提升检索效率\n对于EXISTS子查询，外表A作为已知值，传递给从表，可以利用从表B（m条数据）中的索引，从而提升检索效率。\n（说明log 代表以2为底的对数，即B+树的深度）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588039296,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":147033,"user_name":"ballgod","can_delete":false,"product_type":"c1","uid":1584098,"ip_address":"","ucode":"C20E95E98EAC43","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIR9QrAn9TZOrJMSYMyN96PAuAjETVrN5SPp3hMbfUAGIWtHceWPEoQtPdXeuBn7VB7dagtxynAIA/132","comment_is_top":false,"comment_ctime":1572769444,"is_pvip":false,"replies":[{"id":"63484","content":"WHERE条件后面不能有聚合函数(SUM&#47;AVG&#47;MIN&#47;MAX等)，如果想要用的话，可以在HAVING后面写上条件，或者在前面进行重命名<br>","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577514059,"ip_address":"","comment_id":147033,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1572769444","product_id":100029501,"comment_content":"SELECT a.player_id,a.player_name,a.height FROM player as a,player as b WHERE a.height &gt; AVG(b.height);<br>老师能给讲一下这个查询错误在哪吗？ 或者如何用自联结查询而非子查询确定高于球队平均身高的球员信息。","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473105,"discussion_content":"WHERE条件后面不能有聚合函数(SUM/AVG/MIN/MAX等)，如果想要用的话，可以在HAVING后面写上条件，或者在前面进行重命名\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577514059,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":146594,"user_name":"不似旧日","can_delete":false,"product_type":"c1","uid":1161271,"ip_address":"","ucode":"DF4C5E3AB9570C","user_header":"https://static001.geekbang.org/account/avatar/00/11/b8/37/98991aeb.jpg","comment_is_top":false,"comment_ctime":1572577726,"is_pvip":false,"replies":[{"id":"59753","content":"也是一本不错的书","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1574739749,"ip_address":"","comment_id":146594,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1572577726","product_id":100029501,"comment_content":"推荐看MySQL从入门到精通，简单易懂","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472932,"discussion_content":"也是一本不错的书","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574739749,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":146410,"user_name":"美美","can_delete":false,"product_type":"c1","uid":1148422,"ip_address":"","ucode":"44CC95C45AF345","user_header":"https://static001.geekbang.org/account/avatar/00/11/86/06/72b01bb7.jpg","comment_is_top":false,"comment_ctime":1572514809,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572514809","product_id":100029501,"comment_content":"--IN(sr &lt; s)\r<br>SELECT *\r<br>\tFROM SYS_RESOURCE S\r<br> WHERE S.SUPER_RES_ID IN\r<br>\t\t\t (SELECT SR.RES_ID FROM SYS_RESOURCE SR WHERE SR.SYS_ID = &#39;33&#39;);\r<br>--EXISTS((sr &gt; s))\r<br>SELECT *\r<br>\tFROM SYS_RESOURCE S\r<br> WHERE EXISTS (SELECT 1\r<br>\t\t\t\t\tFROM SYS_RESOURCE SR\r<br>\t\t\t\t WHERE S.SUPER_RES_ID = SR.RES_ID\r<br>\t\t\t\t\t AND SR.SYS_ID = &#39;33&#39;);\r<br>--RIGHT JOIN \r<br>SELECT *\r<br>\tFROM SYS_RESOURCE S\r<br>\tRIGHT JOIN SYS_RESOURCE SR\r<br>\t\tON S.SUPER_RES_ID = SR.RES_ID\r<br> WHERE SR.SYS_ID = &#39;33&#39;;<br>这三种写法在以后应用当中应该选着那种！","like_count":0},{"had_liked":false,"id":144974,"user_name":"扶幽","can_delete":false,"product_type":"c1","uid":1322612,"ip_address":"","ucode":"1400EDFF8970D3","user_header":"https://static001.geekbang.org/account/avatar/00/14/2e/74/88c613e0.jpg","comment_is_top":false,"comment_ctime":1572146092,"is_pvip":false,"replies":[{"id":"62690","content":" b.score&gt;20","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577084611,"ip_address":"","comment_id":144974,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1572146092","product_id":100029501,"comment_content":"练习：<br>SELECT player_id, player_name, team_id FROM player AS a WHERE player_id in (SELECT player_id FROM player_score AS b WHERE b.socre&gt;20);","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472194,"discussion_content":" b.score&amp;gt;20","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577084611,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":144967,"user_name":"Lee","can_delete":false,"product_type":"c1","uid":1508515,"ip_address":"","ucode":"9EB234C45E7470","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLPiaj14cVKiaicbic6OiajyQ2Wcxn73PVKJXzBg7Rb7fqk0BEbCQ2a5L1icfxoaPAAuc8TAxcRF2y4AwBQ/132","comment_is_top":false,"comment_ctime":1572143384,"is_pvip":false,"replies":[{"id":"62691","content":"SELECT player_id, player_name, team_id<br>FROM player<br>WHERE player_id<br>IN (SELECT player_id FROM player_score GROUP BY player_id HAVING AVG(score) &gt; 20);","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577084649,"ip_address":"","comment_id":144967,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1572143384","product_id":100029501,"comment_content":"SELECT play_id, play_name, team_id<br>FROM player<br>WHERE player_id<br>IN (SELECT player_id FROM play_score GROUP BY play_id HAVING AVG(score) &gt; 20);","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472190,"discussion_content":"SELECT player_id, player_name, team_id\nFROM player\nWHERE player_id\nIN (SELECT player_id FROM player_score GROUP BY player_id HAVING AVG(score) &amp;gt; 20);","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577084649,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":143884,"user_name":"半瓶醋","can_delete":false,"product_type":"c1","uid":1282746,"ip_address":"","ucode":"8C898E244D0417","user_header":"https://static001.geekbang.org/account/avatar/00/13/92/ba/9833f06f.jpg","comment_is_top":false,"comment_ctime":1571803205,"is_pvip":true,"replies":[{"id":"59824","content":"哈哈 抓到耗子就是好猫","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1574757720,"ip_address":"","comment_id":143884,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1571803205","product_id":100029501,"comment_content":"刚提交完自己的SQL，看了下留言区的大佬们的答案，果然100个人有一百种SQL不是盖的！","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471740,"discussion_content":"哈哈 抓到耗子就是好猫","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574757720,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":143879,"user_name":"半瓶醋","can_delete":false,"product_type":"c1","uid":1282746,"ip_address":"","ucode":"8C898E244D0417","user_header":"https://static001.geekbang.org/account/avatar/00/13/92/ba/9833f06f.jpg","comment_is_top":false,"comment_ctime":1571802568,"is_pvip":true,"replies":[{"id":"62774","content":"正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577090940,"ip_address":"","comment_id":143879,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1571802568","product_id":100029501,"comment_content":"# 查询场均大于20的球员<br><br>SELECT * FROM <br>(<br>SELECT <br>    player_name,<br>    player_id,<br>    team_id,<br>    (<br>        SELECT <br>            sum((shoot_hits-shoot_3_hits)*2+(shoot_3_hits*3) +shoot_p_hits)<br>        FROM <br>            player_score<br>        WHERE player.player_id = player_score.player_id<br>        ) AS score_avg<br>FROM<br>    player<br>    ) as t1<br>WHERE t1.score_avg &gt;20","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471736,"discussion_content":"正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577090940,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":143084,"user_name":"Coool","can_delete":false,"product_type":"c1","uid":1701702,"ip_address":"","ucode":"1D1AB3270B02B9","user_header":"https://static001.geekbang.org/account/avatar/00/19/f7/46/209ca424.jpg","comment_is_top":false,"comment_ctime":1571627861,"is_pvip":false,"replies":[{"id":"62702","content":"正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577085465,"ip_address":"","comment_id":143084,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1571627861","product_id":100029501,"comment_content":"SELECT <br>    player_id, player_name, team_id<br>FROM<br>    player<br>WHERE<br>    player_id IN (SELECT <br>            player_id<br>        FROM<br>            player_score<br>        WHERE<br>            player.player_id = player_score.player_id<br>        GROUP BY player_id<br>        HAVING AVG(score) &gt; 20);<br>               <br><br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471381,"discussion_content":"正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577085465,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":143051,"user_name":"Coool","can_delete":false,"product_type":"c1","uid":1701702,"ip_address":"","ucode":"1D1AB3270B02B9","user_header":"https://static001.geekbang.org/account/avatar/00/19/f7/46/209ca424.jpg","comment_is_top":false,"comment_ctime":1571624377,"is_pvip":false,"replies":[{"id":"62699","content":"你看下SQL表是不是最新的，player表中有一个team_id=1003的球员","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577085148,"ip_address":"","comment_id":143051,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1571624377","product_id":100029501,"comment_content":"player表中没有team_id=1003的亚特兰大老鹰队，为什么在计算结果中会有？<br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471360,"discussion_content":"你看下SQL表是不是最新的，player表中有一个team_id=1003的球员","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577085148,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":143045,"user_name":"Coool","can_delete":false,"product_type":"c1","uid":1701702,"ip_address":"","ucode":"1D1AB3270B02B9","user_header":"https://static001.geekbang.org/account/avatar/00/19/f7/46/209ca424.jpg","comment_is_top":false,"comment_ctime":1571623893,"is_pvip":false,"replies":[{"id":"62700","content":"可以","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577085410,"ip_address":"","comment_id":143045,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1571623893","product_id":100029501,"comment_content":"有个问题~查询每个球队的球员数<br>直接在player表中用group by分组统计不是也可以吗？","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471359,"discussion_content":"可以","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577085410,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132678,"user_name":"陈小渣👻","can_delete":false,"product_type":"c1","uid":1374445,"ip_address":"","ucode":"6B968B06C76C63","user_header":"https://static001.geekbang.org/account/avatar/00/14/f8/ed/60fb8fba.jpg","comment_is_top":false,"comment_ctime":1568190622,"is_pvip":false,"replies":[{"id":"62787","content":"不一样，你可以测试下，18条记录和19条记录","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577092519,"ip_address":"","comment_id":132678,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1568190622","product_id":100029501,"comment_content":"SELECT player_name, height, team_id FROM player AS a WHERE height &gt; (SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id)<br>这段代码后面的WHERE a.team_id = b.team_id条件加不加是不是一样的（sql小白）","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467064,"discussion_content":"不一样，你可以测试下，18条记录和19条记录","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577092519,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1702255,"avatar":"https://static001.geekbang.org/account/avatar/00/19/f9/6f/9c008ceb.jpg","nickname":"stanleyjobson","note":"","ucode":"4CA84795F59339","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":253524,"discussion_content":"和给的数据运行完 确实是一样的...老师自己不验证一下么","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588240616,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":131202,"user_name":"番茄","can_delete":false,"product_type":"c1","uid":1583667,"ip_address":"","ucode":"7354EEB2D8A43D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTICAILuSqtnAfl1zcgRWIULia2nbjzlybTEQJUMT68KPj80BicwQyibAK3Icxp4qwC03LqrtvfX0fbZg/132","comment_is_top":false,"comment_ctime":1567670081,"is_pvip":false,"replies":[{"id":"62790","content":"平均值比较应该是 avg(height)","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577092700,"ip_address":"","comment_id":131202,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1567670081","product_id":100029501,"comment_content":"第二个例子，按照每个team平均值去比较，我下意识会这样写，原来可以直接用a.team_id = b.team_id啊<br><br>SELECT<br>\tplayer_name,<br>\tteam_id,<br>\theight<br>FROM<br>\t`player` AS a<br>WHERE<br>\theight &gt; (<br>\t\tSELECT<br>\t\t\tb.height<br>\t\tFROM<br>\t\t\t(<br>\t\t\t\tSELECT<br>\t\t\t\t\tteam_id,<br>\t\t\t\t\tmax(height) AS height<br>\t\t\t\tFROM<br>\t\t\t\t\t`player`<br>\t\t\t\tGROUP BY<br>\t\t\t\t\tteam_id<br>\t\t\t) as b<br>\t\tWHERE<br>\t\t\ta.team_id = b.team_id<br>\t) ","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466334,"discussion_content":"平均值比较应该是 avg(height)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577092700,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130501,"user_name":"张小倔","can_delete":false,"product_type":"c1","uid":1574088,"ip_address":"","ucode":"6C1B2C4D8CE4C8","user_header":"https://static001.geekbang.org/account/avatar/00/18/04/c8/c75f4f2d.jpg","comment_is_top":false,"comment_ctime":1567474085,"is_pvip":false,"replies":[{"id":"78656","content":"utf8mb4是4个字节的utf编码，我创建数据表的时候使用的是utf-8，3个字节的utf编码","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587995563,"ip_address":"","comment_id":130501,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1567474085","product_id":100029501,"comment_content":"老师，发现mysql5.7版本中的编码问题，为啥设置为 SET NAMES utf8mb4; 插入中文字符出现错误，或者查看中文字符就是乱码；<br> 设置回 utf-8 就不会了<br>可以帮忙解释一下吗","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465980,"discussion_content":"utf8mb4是4个字节的utf编码，我创建数据表的时候使用的是utf-8，3个字节的utf编码","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587995563,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130365,"user_name":"文晟","can_delete":false,"product_type":"c1","uid":1098714,"ip_address":"","ucode":"2CD9A626CB354C","user_header":"https://static001.geekbang.org/account/avatar/00/10/c3/da/44b9273b.jpg","comment_is_top":false,"comment_ctime":1567435220,"is_pvip":false,"replies":[{"id":"62792","content":"WHERE a.team_id = b.team_id 对比的是这个队伍里的平均身高，如果去掉就是 全部球员的平均身高","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577092780,"ip_address":"","comment_id":130365,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1567435220","product_id":100029501,"comment_content":"SELECT player_name, height, team_id FROM player AS a WHERE height &gt; (SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id)<br>自查询中有没有这个都无所谓吧，准确来说是不是不应该有a.team_id = b.team_id？","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465923,"discussion_content":"WHERE a.team_id = b.team_id 对比的是这个队伍里的平均身高，如果去掉就是 全部球员的平均身高","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577092780,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":129888,"user_name":"Serendipity","can_delete":false,"product_type":"c1","uid":1370694,"ip_address":"","ucode":"E9C7B39BD8DCCD","user_header":"https://static001.geekbang.org/account/avatar/00/14/ea/46/9c9808a9.jpg","comment_is_top":false,"comment_ctime":1567315463,"is_pvip":false,"replies":[{"id":"63783","content":"你可以这样看：<br>SELECT team_name, (SELECT count(*) FROM player WHERE player.team_id = team.team_id) AS player_num <br>FROM team<br><br>实际上是从team表中SELECT<br>","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577541503,"ip_address":"","comment_id":129888,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1567315463","product_id":100029501,"comment_content":"SQL: SELECT team_name, (SELECT count(*) FROM player WHERE player.team_id = team.team_id) AS player_num FROM team<br><br>team_name 不存在表 player 中，为什么可直接 SELECT team_name FROM player???","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465697,"discussion_content":"你可以这样看：\nSELECT team_name, (SELECT count(*) FROM player WHERE player.team_id = team.team_id) AS player_num \nFROM team\n\n实际上是从team表中SELECT\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577541503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126772,"user_name":"大王叫我来巡山","can_delete":false,"product_type":"c1","uid":1099513,"ip_address":"","ucode":"1B8D0C701BC95E","user_header":"https://static001.geekbang.org/account/avatar/00/10/c6/f9/caf27bd3.jpg","comment_is_top":false,"comment_ctime":1566470202,"is_pvip":false,"replies":[{"id":"78725","content":"如果是多表联查的时候，采用子查询可能会提升效率","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1588039553,"ip_address":"","comment_id":126772,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1566470202","product_id":100029501,"comment_content":"我感觉关联子查询的效率是极低的，完全没有必要，可以使用其他的查询方式来代替，不仅效率低，也不够直观","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464161,"discussion_content":"如果是多表联查的时候，采用子查询可能会提升效率","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588039553,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":123129,"user_name":"海洋","can_delete":false,"product_type":"c1","uid":1369704,"ip_address":"","ucode":"F82635CDB2FB93","user_header":"https://static001.geekbang.org/account/avatar/00/14/e6/68/1871d6ba.jpg","comment_is_top":false,"comment_ctime":1565611976,"is_pvip":false,"replies":[{"id":"63529","content":"正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577517011,"ip_address":"","comment_id":123129,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1565611976","product_id":100029501,"comment_content":"SELECT player_id, player_name, team_id FROM player a<br>WHERE (SELECT AVG(score) FROM player_score b WHERE a.player_id = b.player_id) &gt; 20;<br>+-----------+-------------+---------+<br>| player_id | player_name | team_id |<br>+-----------+-------------+---------+<br>|     10001 | 韦恩-艾灵顿 |    1001 |<br>|     10002 | 雷吉-杰克逊 |    1001 |<br>+-----------+-------------+---------+<br>2 rows in set (0.05 sec)","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462549,"discussion_content":"正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577517011,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":123036,"user_name":"。","can_delete":false,"product_type":"c1","uid":1599023,"ip_address":"","ucode":"774C7EAF21FFFB","user_header":"https://static001.geekbang.org/account/avatar/00/18/66/2f/72a54b70.jpg","comment_is_top":false,"comment_ctime":1565595596,"is_pvip":false,"replies":[{"id":"63530","content":"两个SQL的记录数不同，第一个19条，第二个18条","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577517047,"ip_address":"","comment_id":123036,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1565595596","product_id":100029501,"comment_content":"SELECT player_name,height,team_id from player where height &gt; (SELECT avg(height) FROM player);<br>跟这句<br>SELECT player_name, height, team_id FROM player AS a WHERE height &gt; (SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id)<br>有什么区别呀，查询结果都是一样的呢.<br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462510,"discussion_content":"两个SQL的记录数不同，第一个19条，第二个18条","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577517047,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":121125,"user_name":"sandy","can_delete":false,"product_type":"c1","uid":1011471,"ip_address":"","ucode":"917F2E93D6CD7E","user_header":"","comment_is_top":false,"comment_ctime":1565061675,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565061675","product_id":100029501,"comment_content":"可能是理解问题，我认为第 1 个关联查询的例子举的不够到位，因为这个例子中的  WHERE a.team_id = b.team_id 这个关联写不写，查询到的结果和非关联查询都是一样的。如果再加一个查询条件，比如身高大于 2.10 米以内的球员平均身高，更能体现关联子查询，例如：<br><br>SELECT player_name, height, team_id FROM player AS a WHERE  a.height &gt; (SELECT avg(height) FROM player  AS b  WHERE a.team_id = b.team_id and a.height &lt; 2.10 );","like_count":0},{"had_liked":false,"id":121010,"user_name":"Reiser","can_delete":false,"product_type":"c1","uid":1078669,"ip_address":"","ucode":"E5DBBBA2F86FCE","user_header":"https://static001.geekbang.org/account/avatar/00/10/75/8d/c6a2a048.jpg","comment_is_top":false,"comment_ctime":1565050007,"is_pvip":true,"replies":[{"id":"63581","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577519004,"ip_address":"","comment_id":121010,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1565050007","product_id":100029501,"comment_content":"SQL:<br>1、SELECT player_id,player_name,team_id FROM player WHERE player_id IN (SELECT player_id  FROM player_score  GROUP BY player_id HAVING AVG(score) &gt; 20);<br> <br>2、SELECT player_id,player_name,team_id FROM player WHERE  EXISTS (SELECT player_id  FROM player_score WHERE  player.player_id= player_score.player_id GROUP BY player_id HAVING AVG(score) &gt; 20);","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461573,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577519004,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":119791,"user_name":"pepezzzz","can_delete":false,"product_type":"c1","uid":1143169,"ip_address":"","ucode":"414AD2DFD4BA1A","user_header":"https://static001.geekbang.org/account/avatar/00/11/71/81/4e47560f.jpg","comment_is_top":false,"comment_ctime":1564703636,"is_pvip":false,"replies":[{"id":"63881","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577603295,"ip_address":"","comment_id":119791,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1564703636","product_id":100029501,"comment_content":"得分的计算逻辑上面已经给出 ，三分球得3分，两分球（总命中-三分球）得2分，罚球得1分。<br>总出手次数为 19，总命中 10，三分球 13 投 4 中，罚球 4 罚 2 中，因此总分 score=(10-4)×2+4×3+2=26，也就是二分球得分 12+ 三分球得分 12+ 罚球得分 2=26。<br><br>得到每场得分<br>select (shoot_hits - shoot_3_hits) * 2 + shoot_3_hits * 3 + shoot_p_hits * 1  from player_score as b;<br><br>得到球员的每场平均得分<br>select avg((shoot_hits - shoot_3_hits) * 2 + shoot_3_hits * 3 + shoot_p_hits * 1 ) from player_score as b group by player_id;<br><br>输出球员的 ID、球员姓名以及所在球队的 ID 信息。<br>select play_id,team_id,player_name from player as a where (select avg((shoot_hits - shoot_3_hits) * 2 + shoot_3_hits * 3 + shoot_p_hits * 1 ) from player_score as b where a.player_id = b.player_id) &gt; 20;","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461073,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577603295,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117425,"user_name":"Crush","can_delete":false,"product_type":"c1","uid":1586771,"ip_address":"","ucode":"5E6D4EE02525D8","user_header":"https://static001.geekbang.org/account/avatar/00/18/36/53/1e797289.jpg","comment_is_top":false,"comment_ctime":1564045232,"is_pvip":false,"replies":[{"id":"63626","content":"正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577525333,"ip_address":"","comment_id":117425,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1564045232","product_id":100029501,"comment_content":"SELECT<br>\tplayer_id,<br>\tplayer_name,<br>\tteam_id<br>FROM<br>\tplayer<br>WHERE<br>\tEXISTS (<br>\t\tSELECT<br>\t\t\tplayer_id<br>\t\tFROM<br>\t\t\tplayer_score<br>\t\tWHERE<br>\t\t\tplayer_score.player_id = player.player_id<br>\t\tGROUP BY<br>\t\t\tplayer_id<br>\t\tHAVING<br>\t\t\tAVG(score) &gt; 20<br>\t)","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459963,"discussion_content":"正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577525333,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":116196,"user_name":"18923814485","can_delete":false,"product_type":"c1","uid":1367070,"ip_address":"","ucode":"12C6A79B360EB5","user_header":"","comment_is_top":false,"comment_ctime":1563800820,"is_pvip":false,"replies":[{"id":"63648","content":"正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577526400,"ip_address":"","comment_id":116196,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563800820","product_id":100029501,"comment_content":"SELECT p.player_id, p.team_id, p.player_name from player p where EXISTS <br>(SELECT\tAVG(score) as avg_score,player_id FROM player_score where player_id = p.player_id group by game_id,player_id HAVING avg_score &gt; 20);","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459429,"discussion_content":"正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577526400,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115788,"user_name":"Ronnyz","can_delete":false,"product_type":"c1","uid":1488280,"ip_address":"","ucode":"9F34527B1D343D","user_header":"https://static001.geekbang.org/account/avatar/00/16/b5/98/ffaf2aca.jpg","comment_is_top":false,"comment_ctime":1563732487,"is_pvip":false,"replies":[{"id":"63805","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577542284,"ip_address":"","comment_id":115788,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563732487","product_id":100029501,"comment_content":"作业：player_score表小一些，那就选IN<br>SELECT player_id, team_id, player_name FROM player<br>WHERE player_id IN<br>(SELECT player_id FROM player_score GROUP BY player_id HAVING AVG(score)&gt;20);","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459288,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577542284,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115716,"user_name":"Danpier","can_delete":false,"product_type":"c1","uid":1463474,"ip_address":"","ucode":"11E208FDE34961","user_header":"https://static001.geekbang.org/account/avatar/00/16/54/b2/5ea0b709.jpg","comment_is_top":false,"comment_ctime":1563703947,"is_pvip":false,"replies":[{"id":"63655","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577526721,"ip_address":"","comment_id":115716,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563703947","product_id":100029501,"comment_content":"-- ----------------------------<br>-- 显示场均得分<br>-- ----------------------------<br>SELECT player_id, player_name, team_id, (<br>  SELECT avg(score) <br>  from player_score AS t2<br>  WHERE t1.player_id = t2.player_id<br>  ) avg_score<br>From player AS t1<br>Having avg_score &gt;20;<br><br>-- ----------------------------<br>-- 不显示场均得分<br>-- ----------------------------  <br>SELECT player_id, player_name, team_id <br>FROM player AS t1<br>WHERE (<br>  SELECT avg(score)<br>  FROM player_score AS t2<br>  WHERE t1.player_id = t2.player_id<br>  ) &gt; 20;<br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459250,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577526721,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114059,"user_name":"ballgod","can_delete":false,"product_type":"c1","uid":1584098,"ip_address":"","ucode":"C20E95E98EAC43","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIR9QrAn9TZOrJMSYMyN96PAuAjETVrN5SPp3hMbfUAGIWtHceWPEoQtPdXeuBn7VB7dagtxynAIA/132","comment_is_top":false,"comment_ctime":1563234869,"is_pvip":false,"replies":[{"id":"78726","content":"as a 和as b，实际上已经复制成为了两张表","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1588039606,"ip_address":"","comment_id":114059,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563234869","product_id":100029501,"comment_content":"老师好，文中举例的关联查询实际都是从player这个表得出来的，这个好像不是外部的表啊，难道两次查询as a 和as b 可以看做不同的表吗？","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458499,"discussion_content":"as a 和as b，实际上已经复制成为了两张表","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588039606,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113196,"user_name":"stormsc","can_delete":false,"product_type":"c1","uid":1583642,"ip_address":"","ucode":"C58EAAA88C993A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epGMibYc0m7cDGC8CyCIwXynpzicpeAo6pJ8mLWxI3LxTLyaj2QLMg9Ea1M7KMWw4B9wbMfRJIs3vbg/132","comment_is_top":false,"comment_ctime":1562912748,"is_pvip":false,"replies":[{"id":"63703","content":"正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577529582,"ip_address":"","comment_id":113196,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562912748","product_id":100029501,"comment_content":"select player_id,player_name,team_id from player where player_id in <br>(select player_id from player_score  GROUP BY player_id HAVING AVG(score)&gt;20)","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458106,"discussion_content":"正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577529582,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112899,"user_name":"不似旧日","can_delete":false,"product_type":"c1","uid":1161271,"ip_address":"","ucode":"DF4C5E3AB9570C","user_header":"https://static001.geekbang.org/account/avatar/00/11/b8/37/98991aeb.jpg","comment_is_top":false,"comment_ctime":1562839223,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562839223","product_id":100029501,"comment_content":"简单的问题搞复杂了, 简单的问题怎搞那么复杂","like_count":0},{"had_liked":false,"id":112846,"user_name":"Geek_70747e","can_delete":false,"product_type":"c1","uid":1309814,"ip_address":"","ucode":"A832E20E951A00","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKdzXiawss5gGmlPicx9IiblxOTf4oSW16MWd696fue60zDA9NJTrGWenuLxS0COZZSzekV8QZGicyJOQ/132","comment_is_top":false,"comment_ctime":1562831134,"is_pvip":true,"replies":[{"id":"63711","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577530023,"ip_address":"","comment_id":112846,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562831134","product_id":100029501,"comment_content":"作业：<br>SELECT<br>\ta.player_id,<br>\ta.player_name,<br>\ta.team_id<br>FROM<br>\tplayer AS a,<br>\t(<br>\t\tSELECT<br>\t\t\tplayer_id,<br>\t\t\tavg(score) AS avg_score<br>\t\tFROM<br>\t\t\tplayer_score<br>\t\tGROUP BY<br>\t\t\tplayer_id<br>\t\tHAVING<br>\t\t\tavg_score &gt; 20<br>\t) AS b<br>WHERE<br>\ta.player_id = b.player_id;","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457926,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577530023,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112592,"user_name":"NO.9","can_delete":false,"product_type":"c1","uid":1336970,"ip_address":"","ucode":"B92F14B493406F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/fUDCLLob6DFS8kZcMUfxOc4qQHeQfW4rIMK5Ty2u2AqLemcdhVRw7byx85HrVicSvy5AiabE0YGMj5gVt8ibgrusA/132","comment_is_top":false,"comment_ctime":1562767407,"is_pvip":false,"replies":[{"id":"63716","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577530284,"ip_address":"","comment_id":112592,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562767407","product_id":100029501,"comment_content":"求场均 需要用AVG(player_score.score),答案如下：<br>SELECT player_id,player_name,team_id FROM HERO2019.player as p WHERE <br>    EXISTS (select player_id FROM HERO2019.player_score as ps WHERE <br>        p.player_id = ps.player_id AND (select AVG(ps2.score) from HERO2019.player_score as ps2 WHere ps.player_id = ps2.player_id GROUP BY ps2.player_id) &gt; 20);<br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457808,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577530284,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112482,"user_name":"2525","can_delete":false,"product_type":"c1","uid":1180247,"ip_address":"","ucode":"2426488C258203","user_header":"https://static001.geekbang.org/account/avatar/00/12/02/57/9b235866.jpg","comment_is_top":false,"comment_ctime":1562743873,"is_pvip":false,"replies":[{"id":"63722","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577530585,"ip_address":"","comment_id":112482,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562743873","product_id":100029501,"comment_content":"作业：mysql<br>select player_name,player_id,team_id from player where player_id in (select player_id from player_score where score&gt;20)","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457756,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577530585,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112345,"user_name":"不似旧日","can_delete":false,"product_type":"c1","uid":1161271,"ip_address":"","ucode":"DF4C5E3AB9570C","user_header":"https://static001.geekbang.org/account/avatar/00/11/b8/37/98991aeb.jpg","comment_is_top":false,"comment_ctime":1562722530,"is_pvip":false,"replies":[{"id":"78729","content":"连接查询可以合并两个或多个表中的数据，而带子查询的SELECT语句的结果只能来自一个表","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1588039749,"ip_address":"","comment_id":112345,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562722530","product_id":100029501,"comment_content":"能不能讲一下子查询与连接查询的区别","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457690,"discussion_content":"连接查询可以合并两个或多个表中的数据，而带子查询的SELECT语句的结果只能来自一个表","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588039749,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":111079,"user_name":"supermouse","can_delete":false,"product_type":"c1","uid":1321860,"ip_address":"","ucode":"88072D5F881827","user_header":"https://static001.geekbang.org/account/avatar/00/14/2b/84/07f0c0d6.jpg","comment_is_top":false,"comment_ctime":1562467249,"is_pvip":false,"replies":[{"id":"40486","content":"正确，这也是一种写法","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1562541313,"ip_address":"","comment_id":111079,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562467249","product_id":100029501,"comment_content":"SELECT <br>    p.player_id, p.player_name, p.team_id<br>FROM<br>    player_score AS ps1,<br>    player AS p<br>WHERE<br>    (SELECT <br>            AVG(score)<br>        FROM<br>            player_score AS ps2<br>        WHERE<br>            ps1.player_id = ps2.player_id) &gt; 20<br>        AND p.player_id = ps1.player_id;","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457217,"discussion_content":"正确，这也是一种写法","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562541313,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":111023,"user_name":"算盘Man","can_delete":false,"product_type":"c1","uid":1580662,"ip_address":"","ucode":"F26211FEEC18B7","user_header":"https://static001.geekbang.org/account/avatar/00/18/1e/76/7ccbbe83.jpg","comment_is_top":false,"comment_ctime":1562424364,"is_pvip":false,"replies":[{"id":"78659","content":"Good Question，单独执行的时候，你是from player_score，这时是没有player.player_id （因为你没有from player表）","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587995812,"ip_address":"","comment_id":111023,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562424364","product_id":100029501,"comment_content":"请教陈老师，exists子查询中括号内的 select player.player_id from player_score where player.player_id = player_score.player_id，为什么单独查这句会报错呢，当球员表的ID与得分表的ID相等时，查询球员ID的正确sql语句该怎么写啊，谢谢<br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457182,"discussion_content":"Good Question，单独执行的时候，你是from player_score，这时是没有player.player_id （因为你没有from player表）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587995812,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110994,"user_name":"mj4ever","can_delete":false,"product_type":"c1","uid":1005549,"ip_address":"","ucode":"73028E537099CC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/ed/d50de13c.jpg","comment_is_top":false,"comment_ctime":1562414020,"is_pvip":true,"replies":[{"id":"63743","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577530953,"ip_address":"","comment_id":110994,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562414020","product_id":100029501,"comment_content":"SELECT player_id,team_id,player_name FROM player WHERE player.player_id IN (SELECT player_id FROM player_score WHERE score &gt; 20)","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457163,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577530953,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110339,"user_name":"mumu","can_delete":false,"product_type":"c1","uid":1371095,"ip_address":"","ucode":"E409BDA36091A3","user_header":"https://static001.geekbang.org/account/avatar/00/14/eb/d7/712912a7.jpg","comment_is_top":false,"comment_ctime":1562233261,"is_pvip":false,"replies":[{"id":"63820","content":"正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577542809,"ip_address":"","comment_id":110339,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562233261","product_id":100029501,"comment_content":"SELECT a.player_name,a.team_id,a.player_id FROM player a ,(SELECT AVG(b.score) as sco,b.player_id FROM player_score b GROUP BY b.player_id HAVING sco&gt;20) c WHERE a.player_id = c.player_id  ;","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456826,"discussion_content":"正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577542809,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110002,"user_name":"Middleware","can_delete":false,"product_type":"c1","uid":1072015,"ip_address":"","ucode":"C0028293ECDD47","user_header":"https://static001.geekbang.org/account/avatar/00/10/5b/8f/4b0ab5db.jpg","comment_is_top":false,"comment_ctime":1562148348,"is_pvip":true,"replies":[{"id":"39932","content":"需要注意的是场均得分，也就是不是只要有一场比赛得分&gt;20","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1562206979,"ip_address":"","comment_id":110002,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1562148348","product_id":100029501,"comment_content":" SELECT player_id,team_id,player_name FROM player where player_id in(SELECT player_id FROM `player_score` WHERE score &gt; 20);","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456677,"discussion_content":"需要注意的是场均得分，也就是不是只要有一场比赛得分&amp;gt;20","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562206979,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109931,"user_name":"Fortune","can_delete":false,"product_type":"c1","uid":1508654,"ip_address":"","ucode":"6B9465AC996523","user_header":"https://static001.geekbang.org/account/avatar/00/17/05/2e/5a6b6b6e.jpg","comment_is_top":false,"comment_ctime":1562136409,"is_pvip":false,"replies":[{"id":"78730","content":"已经将player表复制成了表a和表b，就相当于是两张表","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1588039787,"ip_address":"","comment_id":109931,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1562136409","product_id":100029501,"comment_content":"SELECT player_name, height, team_id FROM player AS a WHERE height &gt; (SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id)<br>有点不理解这个为什么是关联子查询哈，不是都只在player表中查找吗？","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456646,"discussion_content":"已经将player表复制成了表a和表b，就相当于是两张表","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588039787,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1321836,"avatar":"https://static001.geekbang.org/account/avatar/00/14/2b/6c/a2d3fe36.jpg","nickname":"夏尔","note":"","ucode":"64BCEADCF5EE61","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3417,"discussion_content":"哈哈，不理解+1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564470283,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1513966,"avatar":"https://static001.geekbang.org/account/avatar/00/17/19/ee/6154cfd8.jpg","nickname":"🌜","note":"","ucode":"190C308B747FF8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2833,"discussion_content":"我也是很不理解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563960829,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109894,"user_name":"陈洁","can_delete":false,"product_type":"c1","uid":1570514,"ip_address":"","ucode":"8DBDF7A85DB4BC","user_header":"https://static001.geekbang.org/account/avatar/00/17/f6/d2/dcf628d3.jpg","comment_is_top":false,"comment_ctime":1562126301,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562126301","product_id":100029501,"comment_content":"作业：<br>SELECT player_id ,player_name,team_id<br>FROM player<br>WHERE player_id IN<br>(SELECT player_id FROM player_score GROUP BY player_id ,team_id HAVING AVG(score)&gt;20)","like_count":0},{"had_liked":false,"id":109885,"user_name":"aderm","can_delete":false,"product_type":"c1","uid":1068825,"ip_address":"","ucode":"1C8FCBA02AEA34","user_header":"https://static001.geekbang.org/account/avatar/00/10/4f/19/05834ca2.jpg","comment_is_top":false,"comment_ctime":1562124949,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562124949","product_id":100029501,"comment_content":"select player_id,player_name,team_id<br>from player<br>where exist (select game_id,avg(score) as avg_score <br>from player_score<br>where player.player_id=player_score.player_id<br>group by game_id<br>having(avg_score)&gt;20);","like_count":0},{"had_liked":false,"id":109746,"user_name":"Andywu","can_delete":false,"product_type":"c1","uid":1578457,"ip_address":"","ucode":"29D95287086BA1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/mVtGLzdgB7pKFgaQdYUoAaNDic1xCqLqATcuVYPGCBuCy4tTwEBhicaZ70tvSbMaGAEEia7cJwcjfmdfTffFlAsSw/132","comment_is_top":false,"comment_ctime":1562087144,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562087144","product_id":100029501,"comment_content":"mysql&gt;  select player_id,team_id,player_name from player where player_id in (select player_id from player_score group by player_id having avg(shoot_hits*2+shoot_3_hits+shoot_p_attempts&gt;20));<br>+-----------+---------+------------------------+<br>| player_id | team_id | player_name            |<br>+-----------+---------+------------------------+<br>|     10001 |    1001 | 韦恩-艾灵顿            |<br>|     10002 |    1001 | 雷吉-杰克逊            |<br>|     10003 |    1001 | 安德烈-德拉蒙德        |<br>+-----------+---------+------------------------+<br>3 rows in set (0.00 sec)","like_count":0},{"had_liked":false,"id":109745,"user_name":"Andywu","can_delete":false,"product_type":"c1","uid":1578457,"ip_address":"","ucode":"29D95287086BA1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/mVtGLzdgB7pKFgaQdYUoAaNDic1xCqLqATcuVYPGCBuCy4tTwEBhicaZ70tvSbMaGAEEia7cJwcjfmdfTffFlAsSw/132","comment_is_top":false,"comment_ctime":1562086999,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562086999","product_id":100029501,"comment_content":"感觉player_score表中的score字段的值计算有误，请看下面的查询语句。我的计算方法是：单场得分 game_score = shoot_hits*2+shoot_3_hits+shoot_p_attempts。<br>mysql&gt; select score,shoot_hits*2+shoot_3_hits+shoot_p_attempts as game_score,shoot_hits,shoot_3_hits,shoot_p_attempts from player_score;     <br>+-------+------------+------------+--------------+------------------+<br>| score | game_score | shoot_hits | shoot_3_hits | shoot_p_attempts |<br>+-------+------------+------------+--------------+------------------+<br>|    26 |         28 |         10 |            4 |                4 |<br>|    22 |         22 |          8 |            1 |                5 |<br>|    18 |         21 |          8 |            0 |                5 |<br>|    14 |         14 |          4 |            4 |                2 |<br>|     0 |          0 |          0 |            0 |                0 |<br>|     9 |          9 |          3 |            2 |                1 |<br>|     7 |          7 |          2 |            1 |                2 |<br>|     6 |          6 |          3 |            0 |                0 |<br>|     0 |          0 |          0 |            0 |                0 |<br>|     0 |          0 |          0 |            0 |                0 |<br>|    19 |         19 |          7 |            1 |                4 |<br>|    19 |         20 |          8 |            0 |                4 |<br>|    17 |         18 |          5 |            2 |                6 |<br>|    13 |         14 |          4 |            4 |                2 |<br>|     4 |          4 |          2 |            0 |                0 |<br>|    18 |         18 |          8 |            0 |                2 |<br>|    11 |         11 |          5 |            1 |                0 |<br>|    10 |         12 |          3 |            2 |                4 |<br>|     0 |          0 |          0 |            0 |                0 |<br>+-------+------------+------------+--------------+------------------+<br>19 rows in set (0.01 sec)","like_count":0},{"had_liked":false,"id":109588,"user_name":"xcoder","can_delete":false,"product_type":"c1","uid":1207135,"ip_address":"","ucode":"2C70ED36B4AC8E","user_header":"https://static001.geekbang.org/account/avatar/00/12/6b/5f/cec1e980.jpg","comment_is_top":false,"comment_ctime":1562062468,"is_pvip":false,"replies":[{"id":"78731","content":"SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id<br>这里有没有 a.team_id=b.team_id的条件过滤，虽然都可以得到结果，但是结果是不同的：<br>如果没有这个条件过滤，代表的是 全联盟的平均身高<br>如果有这个条件过滤，代表的是 该球队中的平均身高","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1588039850,"ip_address":"","comment_id":109588,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562062468","product_id":100029501,"comment_content":"关于第一个关联查询的演示，SELECT player_name, height, team_id FROM player AS a WHERE height &gt; (SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id)；如果我不做最后a.team_id=b.team_id的条件过滤，用SELECT player_name,height,team_id FROM player WHERE height &gt; (SELECT AVG(height) FROM player); 也能查出同样的结果啊，难道这个只是作为关联查询的一个演示吗？还是一定要查询才对?<br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456479,"discussion_content":"SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id\n这里有没有 a.team_id=b.team_id的条件过滤，虽然都可以得到结果，但是结果是不同的：\n如果没有这个条件过滤，代表的是 全联盟的平均身高\n如果有这个条件过滤，代表的是 该球队中的平均身高","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588039850,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109583,"user_name":"苏籍","can_delete":false,"product_type":"c1","uid":1396252,"ip_address":"","ucode":"4FA289E084B789","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erYNBIwAj3KdIXaXbeMBUjTMz31zAToHIJSdo7oQk8bfsibwViaLobVQ8miatwBlC5spLS9kVCzHMjUA/132","comment_is_top":false,"comment_ctime":1562061638,"is_pvip":false,"replies":[{"id":"78746","content":"这个a.team_id=b.team_id 是怎么做到类似分组的，又能每次只处理一组，是外面的team_id是一个一个传进来吗。<br>-----------------<br>是的","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1588041827,"ip_address":"","comment_id":109583,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562061638","product_id":100029501,"comment_content":"您好老师，请教一个问题<br>SELECT player_name,height,team_id FROM player a WHERE height &gt; (SELECT AVG(height) FROM player b WHERE a.team_id=b.team_id);<br>这个语句的运行原理是什么呀，我用group by team_id 替换掉a.team_id=b.team_id后提示 返回的结果报错，提示超过1 rows<br>这个a.team_id=b.team_id 是怎么做到类似分组的，又能每次只处理一组，是外面的team_id是一个一个传进来吗。","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456476,"discussion_content":"这个a.team_id=b.team_id 是怎么做到类似分组的，又能每次只处理一组，是外面的team_id是一个一个传进来吗。\n-----------------\n是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588041827,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109493,"user_name":"ABC","can_delete":false,"product_type":"c1","uid":1054958,"ip_address":"","ucode":"7501AD9C0C4A70","user_header":"https://static001.geekbang.org/account/avatar/00/10/18/ee/a1ed60d1.jpg","comment_is_top":false,"comment_ctime":1562043696,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1562043696","product_id":100029501,"comment_content":"SQL语句:<br><br>select player_id,player_name,team_id from player where player_id in (select player_id from player_score where SCORE&gt;20);<br><br>返回结果:<br><br>player_id|player_name|team_id|<br>---------|-----------|-------|<br>    10001|韦恩-艾灵顿     |   1001|<br>    10002|雷吉-杰克逊     |   1001|","like_count":0,"discussions":[{"author":{"id":1508654,"avatar":"https://static001.geekbang.org/account/avatar/00/17/05/2e/5a6b6b6e.jpg","nickname":"Fortune","note":"","ucode":"6B9465AC996523","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":884,"discussion_content":"哇啊，又见到你了，跟我报的课程一样哈，雪丰老师还是夸你哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562136714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109461,"user_name":"wang","can_delete":false,"product_type":"c1","uid":1270262,"ip_address":"","ucode":"C1A3BCACCB188E","user_header":"https://static001.geekbang.org/account/avatar/00/13/61/f6/1d6b548a.jpg","comment_is_top":false,"comment_ctime":1562036762,"is_pvip":false,"replies":[{"id":"78753","content":"select player_id from player_score where player.player_id = player_score.player_id<br>这个查找过程，将外表的player.player_id传入，作为已知值，这样就可以利用player_score表中的player_id字段作为索引进行查找。通过索引进行查找，要比 全行搜索快很多","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1588042120,"ip_address":"","comment_id":109461,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562036762","product_id":100029501,"comment_content":"老师，问一个问题，为什么exists 查询的内查询是不计算时间的？<br>select player_name, team_id, player_id from player where EXISTS (select player_id from player_score where player.player_id = player_score.player_id) ==》 o(t) = player.length","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456421,"discussion_content":"select player_id from player_score where player.player_id = player_score.player_id\n这个查找过程，将外表的player.player_id传入，作为已知值，这样就可以利用player_score表中的player_id字段作为索引进行查找。通过索引进行查找，要比 全行搜索快很多","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588042120,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109455,"user_name":"leol","can_delete":false,"product_type":"c1","uid":1303229,"ip_address":"","ucode":"7FA42EAAFBAEB5","user_header":"https://static001.geekbang.org/account/avatar/00/13/e2/bd/b65420ae.jpg","comment_is_top":false,"comment_ctime":1562035569,"is_pvip":false,"replies":[{"id":"63929","content":"Good Job 正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577605235,"ip_address":"","comment_id":109455,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562035569","product_id":100029501,"comment_content":"select player_id,team_id,player_name from player where player_id in (select player_id from player_score group by player_id having  avg(score&gt;20));","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456419,"discussion_content":"Good Job 正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577605235,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109446,"user_name":"tomlelouch","can_delete":false,"product_type":"c1","uid":1519432,"ip_address":"","ucode":"437110E172F697","user_header":"https://static001.geekbang.org/account/avatar/00/17/2f/48/1bd41ace.jpg","comment_is_top":false,"comment_ctime":1562034484,"is_pvip":false,"replies":[{"id":"63930","content":"正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577605252,"ip_address":"","comment_id":109446,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562034484","product_id":100029501,"comment_content":"SELECT player_name, player_id, team_id FROM player WHERE player_id IN (SELECT player_id FROM player_score GROUP BY player_id, game_id HAVING (avg(score) &gt; 20))；","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456414,"discussion_content":"正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577605252,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109317,"user_name":"🄽🄸🅇🅄🅂","can_delete":false,"product_type":"c1","uid":1000060,"ip_address":"","ucode":"853763C229A5AA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/42/7c/8ef14715.jpg","comment_is_top":false,"comment_ctime":1561998734,"is_pvip":false,"replies":[{"id":"78624","content":"对 这种情况下进行了关联","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587992233,"ip_address":"","comment_id":109317,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561998734","product_id":100029501,"comment_content":"老师, 您好! 请教个问题:<br>1. 如果非关联子查询中加入了group by, 是不是可以变成关联子查询? 比如要查每个球队中身高最高的球员:<br>SELECT * FROM player AS a WHERE a.height IN (SELECT MAX(b.height) FROM player AS b WHERE a.team_id=b.team_id GROUP BY b.team_id) <br>这样, 非关联子查询, 会变成关联子查询吗?","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456350,"discussion_content":"对 这种情况下进行了关联","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587992233,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109304,"user_name":"Yt","can_delete":false,"product_type":"c1","uid":1508210,"ip_address":"","ucode":"E094E3666A1440","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Pk7HVX99cBlSOicLoa8KN8yCKx1pWIyYuy7zxL2ibXicYRFq2ic7LMYiaXMajuQNRZzL4QyuJX6ToRoficsBPlT3Meog/132","comment_is_top":false,"comment_ctime":1561996481,"is_pvip":false,"replies":[{"id":"63979","content":"加油~","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577606664,"ip_address":"","comment_id":109304,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561996481","product_id":100029501,"comment_content":"IN语法：<br>SELECT player_id,player_name,team_id<br>    -&gt; FROM player<br>    -&gt; WHERE player_id  IN (SELECT player_score.player_id FROM player_score<br>    -&gt;                  WHERE player_score.score &gt;20);<br><br>EXISTS语法：<br>SELECT player_name,player_id,team_id<br>    -&gt; FROM player<br>    -&gt; WHERE EXISTS (SELECT player_score.player_id FROM player_score<br>    -&gt;                  WHERE (player.player_id = player_score.player_id) AND player_score.score &gt; 20);<br>+-------------+-----------+---------+<br>| player_name | player_id | team_id |<br>+-------------+-----------+---------+<br>| 韦恩-艾灵顿 |     10001 |    1001 |<br>| 雷吉-杰克逊 |     10002 |    1001 |<br>+-------------+-----------+---------+<br>2 rows in set (0.00 sec)<br><br>EXISTS语法用的不太熟练，存在即合理即筛选出来，和我通常在使用SQL时的检索的想法不太同，后续好好研究。","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456346,"discussion_content":"加油~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577606664,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109286,"user_name":"崔礼堂","can_delete":false,"product_type":"c1","uid":1075312,"ip_address":"","ucode":"CB5F16A3774EF4","user_header":"https://static001.geekbang.org/account/avatar/00/10/68/70/10e07705.jpg","comment_is_top":false,"comment_ctime":1561992985,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561992985","product_id":100029501,"comment_content":"Oracle为什么没有对分页这种常见需求进行用户友好设计呢，需要用子查询实现，真是比limit的体验差远了。","like_count":0},{"had_liked":false,"id":109241,"user_name":"Dave","can_delete":false,"product_type":"c1","uid":1501982,"ip_address":"","ucode":"BF683DAB4DEF02","user_header":"https://static001.geekbang.org/account/avatar/00/16/eb/1e/28c5557f.jpg","comment_is_top":false,"comment_ctime":1561986722,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1561986722","product_id":100029501,"comment_content":"最后一个字段统计效率count(1)&gt;count(xxfield)&gt;count(*)","like_count":0},{"had_liked":false,"id":109193,"user_name":"捞鱼的搬砖奇","can_delete":false,"product_type":"c1","uid":1021539,"ip_address":"","ucode":"2FD194C4DA26E5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/96/63/7eb32c9b.jpg","comment_is_top":false,"comment_ctime":1561977775,"is_pvip":false,"replies":[{"id":"78619","content":"不错的分享","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587991716,"ip_address":"","comment_id":109193,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561977775","product_id":100029501,"comment_content":"想到一点<br>EXISTS算是断言，结果只能是TRUE或FALSE。<br>IN是三阶的，它可以返回TRUE,FLASE 或者NULL、<br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456291,"discussion_content":"不错的分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587991716,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109178,"user_name":"时间是最真的答案","can_delete":false,"product_type":"c1","uid":1183601,"ip_address":"","ucode":"B90F3EF769F865","user_header":"https://static001.geekbang.org/account/avatar/00/12/0f/71/9273e8a4.jpg","comment_is_top":false,"comment_ctime":1561975996,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561975996","product_id":100029501,"comment_content":"数据量太小，in 和 exists 区别不大<br>一、in 方式<br>SELECT player_id,player_name,team_id FROM player WHERE player_id IN (SELECT player_id FROM player_score WHERE score &gt; 20);<br>二、exists 方式<br>SELECT p.player_id,p.player_name,p.team_id FROM player AS p WHERE EXISTS (SELECT player_id FROM player_score AS s WHERE p.player_id = s.player_id AND s.score &gt; 20);","like_count":0},{"had_liked":false,"id":109172,"user_name":"gaoliming","can_delete":false,"product_type":"c1","uid":1480705,"ip_address":"","ucode":"6C5A7D1C4F97AC","user_header":"https://static001.geekbang.org/account/avatar/00/16/98/01/a102bfb9.jpg","comment_is_top":false,"comment_ctime":1561974385,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561974385","product_id":100029501,"comment_content":"SELECT a.player_id,a.player_name,a.team_id from player as a WHERE a.player_id in (SELECT b.player_id from player_score as b where b.score &gt; 20 AND a.player_id = b.player_id)<br>","like_count":0},{"had_liked":false,"id":109152,"user_name":"华夏","can_delete":false,"product_type":"c1","uid":1449474,"ip_address":"","ucode":"4D627CFA5A4B82","user_header":"https://static001.geekbang.org/account/avatar/00/16/1e/02/2864e0f2.jpg","comment_is_top":false,"comment_ctime":1561971555,"is_pvip":false,"replies":[{"id":"63933","content":"是的，不过最好还是要用AVG，虽然数据集里只有一个","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577605451,"ip_address":"","comment_id":109152,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561971555","product_id":100029501,"comment_content":"这道题用AVG(score）和score 结果一样，因为socore只有一个。","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456269,"discussion_content":"是的，不过最好还是要用AVG，虽然数据集里只有一个","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577605451,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109138,"user_name":"Andre","can_delete":false,"product_type":"c1","uid":1563047,"ip_address":"","ucode":"2713749A29A4E0","user_header":"https://static001.geekbang.org/account/avatar/00/17/d9/a7/a794afb1.jpg","comment_is_top":false,"comment_ctime":1561969519,"is_pvip":false,"replies":[{"id":"63980","content":"哈哈~ 加油","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577606677,"ip_address":"","comment_id":109138,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561969519","product_id":100029501,"comment_content":"终于等到了子查询，小本本记下来","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456261,"discussion_content":"哈哈~ 加油","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577606677,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109091,"user_name":"飞机","can_delete":false,"product_type":"c1","uid":1585659,"ip_address":"","ucode":"D0CA3AE2B50686","user_header":"https://static001.geekbang.org/account/avatar/00/18/31/fb/e5918d39.jpg","comment_is_top":false,"comment_ctime":1561959577,"is_pvip":false,"replies":[{"id":"63938","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577605541,"ip_address":"","comment_id":109091,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561959577","product_id":100029501,"comment_content":"SELECT p.player_id, p.player_name, p.team_id FROM nba.player p where (SELECT AVG(s.score) FROM nba.player_score s where p.player_id = s.player_id) &gt; 20<br><br>nba是数据库名字","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456239,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577605541,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109052,"user_name":"白了少年头","can_delete":false,"product_type":"c1","uid":1053084,"ip_address":"","ucode":"A65E00E05B23BA","user_header":"https://static001.geekbang.org/account/avatar/00/10/11/9c/4fd6ebe0.jpg","comment_is_top":false,"comment_ctime":1561952838,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561952838","product_id":100029501,"comment_content":"NOT EXIST 应该是主表A小于从表B的情况，效率更高吧<br>NOT IN不太清楚，感觉还是主表A小于从表B的情况效率高<br><br>select player_id, player_name, team_id from player where (select avg(score) from player_score where player.player_id = player_score.player_id) &gt; 20;<br>+-----------+------------------+---------+<br>| player_id | player_name      | team_id |<br>+-----------+------------------+---------+<br>|     10001 | 韦恩-艾灵顿      |    1001 |<br>|     10002 | 雷吉-杰克逊      |    1001 |<br>+-----------+------------------+---------+<br>2 rows in set (0.01 sec)","like_count":0},{"had_liked":false,"id":109050,"user_name":"孟崔广","can_delete":false,"product_type":"c1","uid":1583844,"ip_address":"","ucode":"16ED1AA0C03C0E","user_header":"https://static001.geekbang.org/account/avatar/00/18/2a/e4/adac68a0.jpg","comment_is_top":false,"comment_ctime":1561952768,"is_pvip":false,"replies":[{"id":"63947","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577605679,"ip_address":"","comment_id":109050,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561952768","product_id":100029501,"comment_content":"作业：<br>SELECT<br>\tp.player_name,<br>\tp.player_id,<br>\tp.team_id<br>FROM<br>\tplayer p<br>WHERE<br>\tp.player_id IN (<br>\t\tSELECT<br>\t\t\ts.player_id<br>\t\tFROM<br>\t\t\tplayer_score s<br>\t\tGROUP BY<br>\t\t\ts.player_id<br>\t\tHAVING<br>\t\t\tAVG(s.score) &gt; 20<br>\t);<br><br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456226,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577605679,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109048,"user_name":"大斌","can_delete":false,"product_type":"c1","uid":1002183,"ip_address":"","ucode":"1434C2B0A29135","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4a/c7/ec18673b.jpg","comment_is_top":false,"comment_ctime":1561952408,"is_pvip":false,"replies":[{"id":"63946","content":"你写的这个SQL的本质是：<br>select player_id,player_name,team_id, (...) as score <br>from player<br>所以第三个字段，只有2个是有效的，其余都为NULL","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577605673,"ip_address":"","comment_id":109048,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561952408","product_id":100029501,"comment_content":"select player_id,player_name,team_id,(select score from player_score where player.player_id=player_score.player_id and score&gt;20) as score from player;<br><br>为什么设置了条件，输出里面还有很多个NULL。","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456224,"discussion_content":"你写的这个SQL的本质是：\nselect player_id,player_name,team_id, (...) as score \nfrom player\n所以第三个字段，只有2个是有效的，其余都为NULL","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577605673,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109040,"user_name":"mickey","can_delete":false,"product_type":"c1","uid":1051663,"ip_address":"","ucode":"8B490C2DDE4010","user_header":"https://static001.geekbang.org/account/avatar/00/10/0c/0f/93d1c8eb.jpg","comment_is_top":false,"comment_ctime":1561951810,"is_pvip":false,"replies":[{"id":"63943","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577605580,"ip_address":"","comment_id":109040,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561951810","product_id":100029501,"comment_content":"SELECT player_id,player_name,team_id FROM player WHERE player_id IN (SELECT player_id FROM player_score GROUP BY player_id HAVING AVG(score)&gt;20);","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456222,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577605580,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109036,"user_name":"cricket1981","can_delete":false,"product_type":"c1","uid":1001715,"ip_address":"","ucode":"758262F5958DA4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/48/f3/f1034ffd.jpg","comment_is_top":false,"comment_ctime":1561951421,"is_pvip":false,"replies":[{"id":"63939","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577605553,"ip_address":"","comment_id":109036,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561951421","product_id":100029501,"comment_content":"老师最后的总结IN&#47;Exist用法和正文描述的不一致。IN子查询一般都有长度大小限制的。<br>mysql&gt; SELECT player_id, player_name, team_id FROM player WHERE player_id in (SELECT player_id FROM player_score GROUP BY player_id HAVING avg(score) &gt; 20);<br>+-----------+------------------+---------+<br>| player_id | player_name      | team_id |<br>+-----------+------------------+---------+<br>|     10001 | 韦恩-艾灵顿      |    1001 |<br>|     10002 | 雷吉-杰克逊      |    1001 |<br>+-----------+------------------+---------+<br>2 rows in set (0.00 sec)<br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456221,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577605553,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109028,"user_name":"zjajxzg","can_delete":false,"product_type":"c1","uid":1441304,"ip_address":"","ucode":"EF2FBD463F266B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKuLsA1AAjUSO7oPHIqbA8f8slVIUw7nhdiaOI4nBYH6RxlyxXyFNe2Bc0g7yMoMHxnlh2mf43aVXw/132","comment_is_top":false,"comment_ctime":1561950731,"is_pvip":false,"replies":[{"id":"63940","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577605559,"ip_address":"","comment_id":109028,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561950731","product_id":100029501,"comment_content":"SELECT<br>\tplayer_id,<br>\tplayer_name,<br>\tteam_id <br>FROM<br>\tplayer <br>WHERE<br>\tplayer_id IN ( SELECT player_id FROM player_score GROUP BY player_id HAVING AVG( score ) &gt; 20 )","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456218,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577605559,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109022,"user_name":"沉静如海","can_delete":false,"product_type":"c1","uid":1573408,"ip_address":"","ucode":"0AA474AACDD18D","user_header":"https://static001.geekbang.org/account/avatar/00/18/02/20/e14adb28.jpg","comment_is_top":false,"comment_ctime":1561950148,"is_pvip":false,"replies":[{"id":"63958","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577605928,"ip_address":"","comment_id":109022,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561950148","product_id":100029501,"comment_content":"SELECT player_id, player_name, team_id<br>FROM player<br>WHERE player_id IN (SELECT player_id<br>FROM player_score<br>GROUP BY player_id<br>HAVING AVG(score) &gt; 20)","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456215,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577605928,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109019,"user_name":"空知","can_delete":false,"product_type":"c1","uid":1013283,"ip_address":"","ucode":"C448E98238DD36","user_header":"https://static001.geekbang.org/account/avatar/00/0f/76/23/31e5e984.jpg","comment_is_top":false,"comment_ctime":1561949619,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1561949619","product_id":100029501,"comment_content":"最后问题 多表关联获取结果不是更快嘛~~建子查询需要建好几次!<br>SELECT player.player_name,score.score,team.team_name<br>FROM player,<br>team,<br>player_score AS score<br>WHERE score.player_id = player.player_id AND player.team_id = team.team_id <br>AND score.score &gt; 20","like_count":0,"discussions":[{"author":{"id":1012030,"avatar":"","nickname":"Hero","note":"","ucode":"14DD4A09C4FF8F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":687,"discussion_content":"因为这一节讲的是子查询啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561960832,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109015,"user_name":"TKbook","can_delete":false,"product_type":"c1","uid":1073829,"ip_address":"","ucode":"F6E0E99CC79059","user_header":"https://static001.geekbang.org/account/avatar/00/10/62/a5/43aa0c27.jpg","comment_is_top":false,"comment_ctime":1561949140,"is_pvip":false,"replies":[{"id":"63953","content":"Good Job 把Score的计算过程也写出来了","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577605850,"ip_address":"","comment_id":109015,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561949140","product_id":100029501,"comment_content":"select player_id, player_name, team_id from player where player_id in (select player_id from player_score group by player_id having avg((shoot_hits-shoot_3_hits)*2+shoot_3_hits*3+shoot_p_hits) &gt; 20);","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456211,"discussion_content":"Good Job 把Score的计算过程也写出来了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577605850,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109011,"user_name":"Zh","can_delete":false,"product_type":"c1","uid":1388911,"ip_address":"","ucode":"8B0032EC876B6B","user_header":"","comment_is_top":false,"comment_ctime":1561948512,"is_pvip":false,"replies":[{"id":"63954","content":"正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577605857,"ip_address":"","comment_id":109011,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561948512","product_id":100029501,"comment_content":"SELECT<br>\tplayer_id,<br>\tplayer_name,<br>\tteam_id <br>FROM<br>\tplayer <br>WHERE<br>\tplayer_id IN (<br>\tSELECT<br>\t\tplayer_id <br>\tFROM<br>\t\tplayer_score <br>\tGROUP BY<br>\t\tplayer_id <br>HAVING<br>\tAVG( score &gt; 20 ))","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456209,"discussion_content":"正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577605857,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109006,"user_name":"Abyssknight","can_delete":false,"product_type":"c1","uid":1336361,"ip_address":"","ucode":"08E8D68E4B76BB","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/29/da537902.jpg","comment_is_top":false,"comment_ctime":1561947209,"is_pvip":false,"replies":[{"id":"63955","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577605866,"ip_address":"","comment_id":109006,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561947209","product_id":100029501,"comment_content":"select player_id, player_name, team_id, (select score from player_score where player.player_id = player_score.player_id) as score<br>from player<br>where player_id in (select player_id from player_score where player_score.score &gt; 20);","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456205,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577605866,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108986,"user_name":"ack","can_delete":false,"product_type":"c1","uid":1440912,"ip_address":"","ucode":"69CA1233EEA8E2","user_header":"https://static001.geekbang.org/account/avatar/00/15/fc/90/c9df0459.jpg","comment_is_top":false,"comment_ctime":1561943915,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1561943915","product_id":100029501,"comment_content":"练习：<br>1.not in对内外表都进行全表扫描，没有用到索引；而not exists的子查询依然能用到表上的索引。所以无论哪个表大，用not exists都比not in 要快。<br>2.SELECT player_id,player_name,team_id FROM player WHERE player_id IN (SELECT player_id as t FROM player_score GROUP BY player_id HAVING AVG(score) &gt; 20);","like_count":0,"discussions":[{"author":{"id":1144692,"avatar":"https://static001.geekbang.org/account/avatar/00/11/77/74/c1f0aa46.jpg","nickname":"习惯沉淀","note":"","ucode":"9C590226330AD3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":877,"discussion_content":"ctrl+c ctrl+v挺溜","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1562135377,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108952,"user_name":"mocobk","can_delete":false,"product_type":"c1","uid":1444632,"ip_address":"","ucode":"E82B6DF738BCBB","user_header":"https://static001.geekbang.org/account/avatar/00/16/0b/18/b82d4617.jpg","comment_is_top":false,"comment_ctime":1561941732,"is_pvip":false,"replies":[{"id":"78626","content":"首先我们需要统计球队的平均身高，即SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id，这样就可以得出球队的平均身高。<br>然后你要筛选的是身高大于这个数值的球员，所以需要使用WHERE进行过滤","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587992440,"ip_address":"","comment_id":108952,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1561941732","product_id":100029501,"comment_content":"老师你好，请问这个的子查询语句为什么还要加上后面的where条件？<br>SELECT player_name, height, team_id FROM player AS a WHERE height &gt; (SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id)<br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456179,"discussion_content":"首先我们需要统计球队的平均身高，即SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id，这样就可以得出球队的平均身高。\n然后你要筛选的是身高大于这个数值的球员，所以需要使用WHERE进行过滤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587992440,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1440912,"avatar":"https://static001.geekbang.org/account/avatar/00/15/fc/90/c9df0459.jpg","nickname":"ack","note":"","ucode":"69CA1233EEA8E2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":670,"discussion_content":"同学你好，题目是需要统计球队的平均身高，然后筛选身高大于这个数值的球员姓名、身高和球队 ID。\n前面SELECT player_name, height, team_id 获取到的是还没符合条件的行，\nSELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id是选出了球队的平均身高\n需要加上WHERE 条件进行筛选，得到最终结果。\n======================\n而子查询SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id中WHERE a.team_id = b.team_id是进行等值连接，如果不使用这个，得到的笛卡尔积结果就不会是同个球队的平均身高。\n比如下面两个表：\nR\nA  B\na1 b1\na2 b2\n---------\nS\nB   D\nb1  d1\nb2  d2\n看看不加的情况会是\nA B1 B2 D\na1 b1 b1 d1\na1 b1 b2 d2\na2 b2 b1 d1\na2 b2 b2 d2\n但如果按照等值，其实我们只需要b1=b2的行：\nA B1 B2 D\na1 b1 b1 d1\na2 b2 b2 d2\n","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1561944931,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108918,"user_name":"大科爱吃肉","can_delete":false,"product_type":"c1","uid":1125885,"ip_address":"","ucode":"4C243A5729A848","user_header":"https://static001.geekbang.org/account/avatar/00/11/2d/fd/cfc952f5.jpg","comment_is_top":false,"comment_ctime":1561937170,"is_pvip":false,"replies":[{"id":"63981","content":"哈哈 好","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577606698,"ip_address":"","comment_id":108918,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561937170","product_id":100029501,"comment_content":"支持字段名加注释。<br><br>另:这些英文名字让我懵……","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456167,"discussion_content":"哈哈 好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577606698,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108907,"user_name":"LJK","can_delete":false,"product_type":"c1","uid":1199213,"ip_address":"","ucode":"12B2441099FF1D","user_header":"https://static001.geekbang.org/account/avatar/00/12/4c/6d/c20f2d5a.jpg","comment_is_top":false,"comment_ctime":1561922860,"is_pvip":false,"replies":[{"id":"78629","content":"这个例子中，如果子查询中不加入WHERE也是可以的。那么这个子查询就是非关联子查询","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1587992848,"ip_address":"","comment_id":108907,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1561922860","product_id":100029501,"comment_content":"老师好，请问在集合比较子查询的例子中，使用IN查找上场队员：`SELECT player_id, team_id, player_name FROM player WHERE player_id in (SELECT player_id FROM player_score WHERE player.player_id = player_score.player_id)`<br><br>为什么在子查询中需要加入WHERE的判断呢？","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456162,"discussion_content":"这个例子中，如果子查询中不加入WHERE也是可以的。那么这个子查询就是非关联子查询","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587992848,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1004869,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/55/45/e4314bc6.jpg","nickname":"magicnum","note":"","ucode":"96B3696961F654","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":678,"discussion_content":"应该是为了利用player表的索引，而且不加的话子查询有重复也会加重性能消耗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561953246,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108904,"user_name":"捞鱼的搬砖奇","can_delete":false,"product_type":"c1","uid":1021539,"ip_address":"","ucode":"2FD194C4DA26E5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/96/63/7eb32c9b.jpg","comment_is_top":false,"comment_ctime":1561916550,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561916550","product_id":100029501,"comment_content":"SELECT <br>    player_id, team_id, player_name<br>FROM<br>    player<br>WHERE<br>    player_id IN (SELECT <br>            a.player_id<br>        FROM<br>            (SELECT <br>                player_id, AVG(score) AS s<br>            FROM<br>                player_score<br>            GROUP BY player_id<br>            HAVING s &gt; 20) a)","like_count":0},{"had_liked":false,"id":108903,"user_name":"捞鱼的搬砖奇","can_delete":false,"product_type":"c1","uid":1021539,"ip_address":"","ucode":"2FD194C4DA26E5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/96/63/7eb32c9b.jpg","comment_is_top":false,"comment_ctime":1561915862,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1561915862","product_id":100029501,"comment_content":"提个建议，建表语句中字段名能加上注释吗","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":250822,"discussion_content":"已经更新github中的SQL，添加上注释了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588042300,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}