{"id":75242,"title":"17 | 案例篇：如何利用系统缓存优化程序的运行效率？","content":"<p>你好，我是倪朋飞。</p><p>上一节，我们学习了内存性能中 Buffer 和 Cache 的概念。简单复习一下，Buffer 和 Cache 的设计目的，是为了提升系统的 I/O 性能。它们利用内存，充当起慢速磁盘与快速 CPU 之间的桥梁，可以加速 I/O 的访问速度。</p><p>Buffer和Cache分别缓存的是对磁盘和文件系统的读写数据。</p><ul>\n<li>\n<p>从写的角度来说，不仅可以优化磁盘和文件的写入，对应用程序也有好处，应用程序可以在数据真正落盘前，就返回去做其他工作。</p>\n</li>\n<li>\n<p>从读的角度来说，不仅可以提高那些频繁访问数据的读取速度，也降低了频繁 I/O 对磁盘的压力。</p>\n</li>\n</ul><p>既然 Buffer 和 Cache 对系统性能有很大影响，那我们在软件开发的过程中，能不能利用这一点，来优化 I/O 性能，提升应用程序的运行效率呢？</p><p>答案自然是肯定的。今天，我就用几个案例帮助你更好地理解缓存的作用，并学习如何充分利用这些缓存来提高程序效率。</p><p>为了方便你理解，Buffer和Cache我仍然用英文表示，避免跟“缓存”一词混淆。而文中的“缓存”，通指数据在内存中的临时存储。</p><h2>缓存命中率</h2><p>在案例开始前，你应该习惯性地先问自己一个问题，你想要做成某件事情，结果应该怎么评估？比如说，我们想利用缓存来提升程序的运行效率，应该怎么评估这个效果呢？换句话说，有没有哪个指标可以衡量缓存使用的好坏呢？</p><!-- [[[read_end]]] --><p>我估计你已经想到了，<strong>缓存的命中率</strong>。所谓缓存命中率，是指直接通过缓存获取数据的请求次数，占所有数据请求次数的百分比。</p><p><strong>命中率越高，表示使用缓存带来的收益越高，应用程序的性能也就越好。</strong></p><p>实际上，缓存是现在所有高并发系统必需的核心模块，主要作用就是把经常访问的数据（也就是热点数据），提前读入到内存中。这样，下次访问时就可以直接从内存读取数据，而不需要经过硬盘，从而加快应用程序的响应速度。</p><p>这些独立的缓存模块通常会提供查询接口，方便我们随时查看缓存的命中情况。不过 Linux 系统中并没有直接提供这些接口，所以这里我要介绍一下，cachestat 和 cachetop  ，它们正是查看系统缓存命中情况的工具。</p><ul>\n<li>\n<p>cachestat 提供了整个操作系统缓存的读写命中情况。</p>\n</li>\n<li>\n<p>cachetop 提供了每个进程的缓存命中情况。</p>\n</li>\n</ul><p>这两个工具都是 <a href=\"https://github.com/iovisor/bcc\">bcc</a> 软件包的一部分，它们基于 Linux 内核的 eBPF（extended Berkeley Packet Filters）机制，来跟踪内核中管理的缓存，并输出缓存的使用和命中情况。</p><p>这里注意，eBPF 的工作原理不是我们今天的重点，记住这个名字即可，后面文章中我们会详细学习。今天要掌握的重点，是这两个工具的使用方法。</p><p>使用 cachestat 和 cachetop 前，我们首先要安装 bcc 软件包。比如，在 Ubuntu 系统中，你可以运行下面的命令来安装：</p><pre><code>sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 4052245BD4284CDD\necho &quot;deb https://repo.iovisor.org/apt/xenial xenial main&quot; | sudo tee /etc/apt/sources.list.d/iovisor.list\nsudo apt-get update\nsudo apt-get install -y bcc-tools libbcc-examples linux-headers-$(uname -r)\n</code></pre><blockquote>\n<p>注意：bcc-tools需要内核版本为4.1或者更新的版本，如果你用的是CentOS，那就需要手动<a href=\"https://github.com/iovisor/bcc/issues/462\">升级内核版本后再安装</a>。</p>\n</blockquote><p>操作完这些步骤，bcc 提供的所有工具就都安装到 /usr/share/bcc/tools 这个目录中了。不过这里提醒你，bcc 软件包默认不会把这些工具配置到系统的 PATH 路径中，所以你得自己手动配置：</p><pre><code>$ export PATH=$PATH:/usr/share/bcc/tools\n</code></pre><p>配置完，你就可以运行 cachestat 和 cachetop 命令了。比如，下面就是一个 cachestat 的运行界面，它以1秒的时间间隔，输出了3组缓存统计数据：</p><pre><code>$ cachestat 1 3\n   TOTAL   MISSES     HITS  DIRTIES   BUFFERS_MB  CACHED_MB\n       2        0        2        1           17        279\n       2        0        2        1           17        279\n       2        0        2        1           17        279 \n</code></pre><p>你可以看到，cachestat 的输出其实是一个表格。每行代表一组数据，而每一列代表不同的缓存统计指标。这些指标从左到右依次表示：</p><ul>\n<li>\n<p>TOTAL ，表示总的 I/O 次数；</p>\n</li>\n<li>\n<p>MISSES ，表示缓存未命中的次数；</p>\n</li>\n<li>\n<p>HITS ，表示缓存命中的次数；</p>\n</li>\n<li>\n<p>DIRTIES， 表示新增到缓存中的脏页数；</p>\n</li>\n<li>\n<p>BUFFERS_MB 表示 Buffers 的大小，以 MB 为单位；</p>\n</li>\n<li>\n<p>CACHED_MB 表示 Cache 的大小，以 MB 为单位。</p>\n</li>\n</ul><p>接下来我们再来看一个 cachetop 的运行界面：</p><pre><code>$ cachetop\n11:58:50 Buffers MB: 258 / Cached MB: 347 / Sort: HITS / Order: ascending\nPID      UID      CMD              HITS     MISSES   DIRTIES  READ_HIT%  WRITE_HIT%\n   13029 root     python                  1        0        0     100.0%       0.0%\n</code></pre><p>它的输出跟 top 类似，默认按照缓存的命中次数（HITS）排序，展示了每个进程的缓存命中情况。具体到每一个指标，这里的 HITS、MISSES和DIRTIES ，跟 cachestat 里的含义一样，分别代表间隔时间内的缓存命中次数、未命中次数以及新增到缓存中的脏页数。</p><p>而 READ_HIT 和 WRITE_HIT ，分别表示读和写的缓存命中率。</p><h2>指定文件的缓存大小</h2><p>除了缓存的命中率外，还有一个指标你可能也会很感兴趣，那就是指定文件在内存中的缓存大小。你可以使用 <a href=\"https://github.com/tobert/pcstat\">pcstat</a> 这个工具，来查看文件在内存中的缓存大小以及缓存比例。</p><p>pcstat 是一个基于 Go 语言开发的工具，所以安装它之前，你首先应该安装 Go 语言，你可以点击<a href=\"https://golang.org/dl/\">这里</a>下载安装。</p><p>安装完 Go 语言，再运行下面的命令安装 pcstat：</p><pre><code>$ export GOPATH=~/go\n$ export PATH=~/go/bin:$PATH\n$ go get golang.org/x/sys/unix\n$ go get github.com/tobert/pcstat/pcstat\n</code></pre><p>全部安装完成后，你就可以运行 pcstat 来查看文件的缓存情况了。比如，下面就是一个 pcstat 运行的示例，它展示了 /bin/ls 这个文件的缓存情况：</p><pre><code>$ pcstat /bin/ls\n+---------+----------------+------------+-----------+---------+\n| Name    | Size (bytes)   | Pages      | Cached    | Percent |\n|---------+----------------+------------+-----------+---------|\n| /bin/ls | 133792         | 33         | 0         | 000.000 |\n+---------+----------------+------------+-----------+---------+\n</code></pre><p>这个输出中，Cached 就是 /bin/ls 在缓存中的大小，而 Percent 则是缓存的百分比。你看到它们都是 0，这说明 /bin/ls 并不在缓存中。</p><p>接着，如果你执行一下 ls 命令，再运行相同的命令来查看的话，就会发现 /bin/ls 都在缓存中了：</p><pre><code>$ ls\n$ pcstat /bin/ls\n+---------+----------------+------------+-----------+---------+\n| Name    | Size (bytes)   | Pages      | Cached    | Percent |\n|---------+----------------+------------+-----------+---------|\n| /bin/ls | 133792         | 33         | 33        | 100.000 |\n+---------+----------------+------------+-----------+---------+\n</code></pre><p>知道了缓存相应的指标和查看系统缓存的方法后，接下来，我们就进入今天的正式案例。</p><p>跟前面的案例一样，今天的案例也是基于 Ubuntu 18.04，当然同样适用于其他的 Linux 系统。</p><ul>\n<li>\n<p>机器配置：2 CPU，8GB 内存。</p>\n</li>\n<li>\n<p>预先按照上面的步骤安装 bcc 和 pcstat 软件包，并把这些工具的安装路径添加到到 PATH 环境变量中。</p>\n</li>\n<li>\n<p>预先安装 Docker 软件包，比如 apt-get install <a href=\"http://docker.io\">docker.io</a></p>\n</li>\n</ul><h2>案例一</h2><p>第一个案例，我们先来看一下上一节提到的 dd 命令。</p><p>dd 作为一个磁盘和文件的拷贝工具，经常被拿来测试磁盘或者文件系统的读写性能。不过，既然缓存会影响到性能，如果用dd对同一个文件进行多次读取测试，测试的结果会怎么样呢？</p><p>我们来动手试试。首先，打开两个终端，连接到 Ubuntu 机器上，确保 bcc 已经安装配置成功。</p><p>然后，使用 dd 命令生成一个临时文件，用于后面的文件读取测试：</p><pre><code># 生成一个512MB的临时文件\n$ dd if=/dev/sda1 of=file bs=1M count=512\n# 清理缓存\n$ echo 3 &gt; /proc/sys/vm/drop_caches\n</code></pre><p>继续在第一个终端，运行 pcstat 命令，确认刚刚生成的文件不在缓存中。如果一切正常，你会看到 Cached 和 Percent 都是0:</p><pre><code>$ pcstat file\n+-------+----------------+------------+-----------+---------+\n| Name  | Size (bytes)   | Pages      | Cached    | Percent |\n|-------+----------------+------------+-----------+---------|\n| file  | 536870912      | 131072     | 0         | 000.000 |\n+-------+----------------+------------+-----------+---------+\n</code></pre><p>还是在第一个终端中，现在运行 cachetop 命令：</p><pre><code># 每隔5秒刷新一次数据\n$ cachetop 5\n</code></pre><p>这次是第二个终端，运行 dd 命令测试文件的读取速度：</p><pre><code>$ dd if=file of=/dev/null bs=1M\n512+0 records in\n512+0 records out\n536870912 bytes (537 MB, 512 MiB) copied, 16.0509 s, 33.4 MB/s\n</code></pre><p>从 dd 的结果可以看出，这个文件的读性能是 33.4 MB/s。由于在 dd 命令运行前我们已经清理了缓存，所以 dd 命令读取数据时，肯定要通过文件系统从磁盘中读取。</p><p>不过，这是不是意味着， dd 所有的读请求都能直接发送到磁盘呢？</p><p>我们再回到第一个终端， 查看 cachetop 界面的缓存命中情况：</p><pre><code>PID      UID      CMD              HITS     MISSES   DIRTIES  READ_HIT%  WRITE_HIT%\n\\.\\.\\.\n    3264 root     dd                  37077    37330        0      49.8%      50.2%\n</code></pre><p>从 cachetop 的结果可以发现，并不是所有的读都落到了磁盘上，事实上读请求的缓存命中率只有 50% 。</p><p>接下来，我们继续尝试相同的测试命令。先切换到第二个终端，再次执行刚才的 dd 命令：</p><pre><code>$ dd if=file of=/dev/null bs=1M\n512+0 records in\n512+0 records out\n536870912 bytes (537 MB, 512 MiB) copied, 0.118415 s, 4.5 GB/s\n</code></pre><p>看到这次的结果，有没有点小惊讶？磁盘的读性能居然变成了 4.5 GB/s，比第一次的结果明显高了太多。为什么这次的结果这么好呢？</p><p>不妨再回到第一个终端，看看 cachetop 的情况：</p><pre><code>10:45:22 Buffers MB: 4 / Cached MB: 719 / Sort: HITS / Order: ascending\nPID      UID      CMD              HITS     MISSES   DIRTIES  READ_HIT%  WRITE_HIT%\n\\.\\.\\.\n   32642 root     dd                 131637        0        0     100.0%       0.0%\n</code></pre><p>显然，cachetop也有了不小的变化。你可以发现，这次的读的缓存命中率是100.0%，也就是说这次的 dd 命令全部命中了缓存，所以才会看到那么高的性能。</p><p>然后，回到第二个终端，再次执行 pcstat 查看文件 file 的缓存情况：</p><pre><code>$ pcstat file\n+-------+----------------+------------+-----------+---------+\n| Name  | Size (bytes)   | Pages      | Cached    | Percent |\n|-------+----------------+------------+-----------+---------|\n| file  | 536870912      | 131072     | 131072    | 100.000 |\n+-------+----------------+------------+-----------+---------+\n</code></pre><p>从 pcstat 的结果你可以发现，测试文件 file 已经被全部缓存了起来，这跟刚才观察到的缓存命中率 100% 是一致的。</p><p>这两次结果说明，系统缓存对第二次 dd 操作有明显的加速效果，可以大大提高文件读取的性能。</p><p>但同时也要注意，如果我们把 dd 当成测试文件系统性能的工具，由于缓存的存在，就会导致测试结果严重失真。</p><h2>案例二</h2><p>接下来，我们再来看一个文件读写的案例。这个案例类似于前面学过的不可中断状态进程的例子。它的基本功能比较简单，也就是每秒从磁盘分区 /dev/sda1 中读取 32MB 的数据，并打印出读取数据花费的时间。</p><p>为了方便你运行案例，我把它打包成了一个 <a href=\"https://github.com/feiskyer/linux-perf-examples/tree/master/io-cached\">Docker 镜像</a>。 跟前面案例类似，我提供了下面两个选项，你可以根据系统配置，自行调整磁盘分区的路径以及 I/O 的大小。</p><ul>\n<li>\n<p>-d 选项，设置要读取的磁盘或分区路径，默认是查找前缀为 /dev/sd 或者 /dev/xvd 的磁盘。</p>\n</li>\n<li>\n<p>-s 选项，设置每次读取的数据量大小，单位为字节，默认为 33554432（也就是 32MB）。</p>\n</li>\n</ul><p>这个案例同样需要你开启两个终端。分别 SSH 登录到机器上后，先在第一个终端中运行 cachetop 命令：</p><pre><code># 每隔5秒刷新一次数据\n$ cachetop 5 \n</code></pre><p>接着，再到第二个终端，执行下面的命令运行案例：</p><pre><code>$ docker run --privileged --name=app -itd feisky/app:io-direct\n</code></pre><p>案例运行后，我们还需要运行下面这个命令，来确认案例已经正常启动。如果一切正常，你应该可以看到类似下面的输出：</p><pre><code>$ docker logs app\nReading data from disk /dev/sdb1 with buffer size 33554432\nTime used: 0.929935 s to read 33554432 bytes\nTime used: 0.949625 s to read 33554432 bytes\n</code></pre><p>从这里你可以看到，每读取 32 MB 的数据，就需要花 0.9 秒。这个时间合理吗？我想你第一反应就是，太慢了吧。那这是不是没用系统缓存导致的呢？</p><p>我们再来检查一下。回到第一个终端，先看看 cachetop 的输出，在这里，我们找到案例进程 app 的缓存使用情况：</p><pre><code>16:39:18 Buffers MB: 73 / Cached MB: 281 / Sort: HITS / Order: ascending\nPID      UID      CMD              HITS     MISSES   DIRTIES  READ_HIT%  WRITE_HIT%\n   21881 root     app                  1024        0        0     100.0%       0.0% \n</code></pre><p>这个输出似乎有点意思了。1024 次缓存全部命中，读的命中率是 100%，看起来全部的读请求都经过了系统缓存。但是问题又来了，如果真的都是缓存 I/O，读取速度不应该这么慢。</p><p>不过，话说回来，我们似乎忽略了另一个重要因素，每秒实际读取的数据大小。HITS 代表缓存的命中次数，那么每次命中能读取多少数据呢？自然是一页。</p><p>前面讲过，内存以页为单位进行管理，而每个页的大小是 4KB。所以，在5秒的时间间隔里，命中的缓存为 1024*4K/1024 = 4MB，再除以5 秒，可以得到每秒读的缓存是 0.8MB，显然跟案例应用的32 MB/s 相差太多。</p><p>至于为什么只能看到 0.8 MB 的 HITS，我们后面再解释，这里你先知道怎么根据结果来分析就可以了。</p><p>这也进一步验证了我们的猜想，这个案例估计没有充分利用系统缓存。其实前面我们遇到过类似的问题，如果为系统调用设置直接 I/O 的标志，就可以绕过系统缓存。</p><p>那么，要判断应用程序是否用了直接I/O，最简单的方法当然是观察它的系统调用，查找应用程序在调用它们时的选项。使用什么工具来观察系统调用呢？自然还是 strace。</p><p>继续在终端二中运行下面的 strace 命令，观察案例应用的系统调用情况。注意，这里使用了 pgrep 命令来查找案例进程的 PID 号：</p><pre><code># strace -p $(pgrep app)\nstrace: Process 4988 attached\nrestart_syscall(&lt;\\.\\.\\. resuming interrupted nanosleep \\.\\.\\.&gt;) = 0\nopenat(AT_FDCWD, &quot;/dev/sdb1&quot;, O_RDONLY|O_DIRECT) = 4\nmmap(NULL, 33558528, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f448d240000\nread(4, &quot;8vq\\213\\314\\264u\\373\\4\\336K\\224\\25@\\371\\1\\252\\2\\262\\252q\\221\\n0\\30\\225bD\\252\\266@J&quot;\\.\\.\\., 33554432) = 33554432\nwrite(1, &quot;Time used: 0.948897 s to read 33&quot;\\.\\.\\., 45) = 45\nclose(4)                                = 0\n</code></pre><p>从 strace 的结果可以看到，案例应用调用了 openat 来打开磁盘分区 /dev/sdb1，并且传入的参数为 O_RDONLY|O_DIRECT（中间的竖线表示或）。</p><p>O_RDONLY 表示以只读方式打开，而 O_DIRECT 则表示以直接读取的方式打开，这会绕过系统的缓存。</p><p>验证了这一点，就很容易理解为什么读 32 MB的数据就都要那么久了。直接从磁盘读写的速度，自然远慢于对缓存的读写。这也是缓存存在的最大意义了。</p><p>找出问题后，我们还可以在再看看案例应用的<a href=\"https://github.com/feiskyer/linux-perf-examples/blob/master/io-cached/app.c\">源代码</a>，再次验证一下：</p><pre><code>int flags = O_RDONLY | O_LARGEFILE | O_DIRECT; \nint fd = open(disk, flags, 0755);\n</code></pre><p>上面的代码，很清楚地告诉我们：它果然用了直接 I/O。</p><p>找出了磁盘读取缓慢的原因，优化磁盘读的性能自然不在话下。修改源代码，删除 O_DIRECT 选项，让应用程序使用缓存 I/O ，而不是直接 I/O，就可以加速磁盘读取速度。</p><p><a href=\"https://github.com/feiskyer/linux-perf-examples/blob/master/io-cached/app-cached.c\">app-cached.c</a> 就是修复后的源码，我也把它打包成了一个容器镜像。在第二个终端中，按 Ctrl+C 停止刚才的 strace 命令，运行下面的命令，你就可以启动它：</p><pre><code># 删除上述案例应用\n$ docker rm -f app\n\n# 运行修复后的应用\n$ docker run --privileged --name=app -itd feisky/app:io-cached\n</code></pre><p>还是第二个终端，再来运行下面的命令查看新应用的日志，你应该能看到下面这个输出：</p><pre><code>$ docker logs app\nReading data from disk /dev/sdb1 with buffer size 33554432\nTime used: 0.037342 s s to read 33554432 bytes\nTime used: 0.029676 s to read 33554432 bytes\n</code></pre><p>现在，每次只需要 0.03秒，就可以读取 32MB 数据，明显比之前的 0.9 秒快多了。所以，这次应该用了系统缓存。</p><p>我们再回到第一个终端，查看 cachetop 的输出来确认一下：</p><pre><code>16:40:08 Buffers MB: 73 / Cached MB: 281 / Sort: HITS / Order: ascending\nPID      UID      CMD              HITS     MISSES   DIRTIES  READ_HIT%  WRITE_HIT%\n   22106 root     app                 40960        0        0     100.0%       0.0%\n</code></pre><p>果然，读的命中率还是 100%，HITS （即命中数）却变成了 40960，同样的方法计算一下，换算成每秒字节数正好是 32 MB（即 40960*4k/5/1024=32M）。</p><p>这个案例说明，在进行 I/O 操作时，充分利用系统缓存可以极大地提升性能。 但在观察缓存命中率时，还要注意结合应用程序实际的 I/O 大小，综合分析缓存的使用情况。</p><p>案例的最后，再回到开始的问题，为什么优化前，通过 cachetop 只能看到很少一部分数据的全部命中，而没有观察到大量数据的未命中情况呢？这是因为，cachetop 工具并不把直接 I/O 算进来。这也又一次说明了，了解工具原理的重要。</p><blockquote>\n<p>cachetop 的计算方法涉及到 I/O 的原理以及一些内核的知识，如果你想了解它的原理的话，可以点击<a href=\"https://github.com/iovisor/bcc/blob/master/tools/cachetop.py\">这里</a>查看它的源代码。</p>\n</blockquote><h2>总结</h2><p>Buffers 和 Cache 可以极大提升系统的 I/O 性能。通常，我们用缓存命中率，来衡量缓存的使用效率。命中率越高，表示缓存被利用得越充分，应用程序的性能也就越好。</p><p>你可以用 cachestat 和 cachetop 这两个工具，观察系统和进程的缓存命中情况。其中，</p><ul>\n<li>\n<p>cachestat 提供了整个系统缓存的读写命中情况。</p>\n</li>\n<li>\n<p>cachetop 提供了每个进程的缓存命中情况。</p>\n</li>\n</ul><p>不过要注意，Buffers 和 Cache 都是操作系统来管理的，应用程序并不能直接控制这些缓存的内容和生命周期。所以，在应用程序开发中，一般要用专门的缓存组件，来进一步提升性能。</p><p>比如，程序内部可以使用堆或者栈明确声明内存空间，来存储需要缓存的数据。再或者，使用 Redis 这类外部缓存服务，优化数据的访问效率。</p><h2>思考</h2><p>最后，我想给你留下一道思考题，帮你更进一步了解缓存的原理。</p><p>今天的第二个案例你应该很眼熟，因为前面不可中断进程的文章用的也是直接I/O的例子，不过那次，我们是从CPU使用率和进程状态的角度来分析的。对比CPU和缓存这两个不同角度的分析思路，你有什么样的发现呢？</p><p>欢迎在留言区和我讨论，写下你的答案和收获，也欢迎你把这篇文章分享给你的同事、朋友。我们一起在实战中演练，在交流中进步。</p><p></p>","neighbors":{"left":{"article_title":"16 | 基础篇：怎么理解内存中的Buffer和Cache？","id":74633},"right":{"article_title":"18 | 案例篇：内存泄漏了，我该如何定位和处理？","id":75670}},"comments":[{"had_liked":false,"id":54850,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1545969873,"is_pvip":false,"replies":[{"id":"19927","content":"总结的很好，其实两个思路都可以，不过具体实践时可能会受限于可用的性能工具","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546003563,"ip_address":"","comment_id":54850,"utype":1}],"discussion_count":3,"race_medal":0,"score":"323668517073","product_id":100020901,"comment_content":"[D17打卡]<br>想不到Buffer 和 Cache还有专门的工具分析, 长见识了!<br>暂时只能在自己的机器上玩玩, 生产环境连root权限都没有,更别提升级CentOS内核版本了.<br>-----------------<br>关于思考题,我是这样想的:<br>出现性能问题时的症状可能并不是单一的. <br>比如这次同一个案例,从CPU和缓存两个不同的角度, 都是定位到了代码中的open.<br>cpu角度分析的流程是:<br>1.top 看到了%iowait升高<br>2.dstat 看到了wait升高时 read同步升高. 说明跟磁盘相关<br>3.$ perf record -g   ;   $ perf report  定位到了跟磁盘相关的系统调用 sys_read(). new_sync_read 和 blkdev_direct_IO 定位到了跟直接读有关系.<br>4.查看代码 找到了跟磁盘相关的系统调用 open.<br>缓存角度分析的流程是:<br>1.进程5秒缓存命中率100%,但是只命中了1024次,推算使用缓存4MB.实际每秒0.8MB<br>2.看日志知道每次读取的是32MB.[实际也可以通过dstat vmstat等工具粗略推算出该值]<br>3.预期的32M与实际的0.8M相差甚远. 来找原因.<br>4.strace 查看系统调用 定位到了openat 及 直接给出了调用参数 O_DIRECT<br>5.查看代码 找到了跟磁盘相关的系统调用 open.<br>-----------------<br>个人总结:<br>顺藤摸瓜, 根据现像找本质原因. <br>磁盘io导致性能问题 -&gt; 查看系统调用  -&gt; 定位大致原因 -&gt; 查看源码  -&gt; 确定问题<br>还居然在完全不知道程序具体实现的基础上,定位到了引起性能问题的系统调用. 有的甚至还直接给出了参数,太牛了.","like_count":75,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434584,"discussion_content":"总结的很好，其实两个思路都可以，不过具体实践时可能会受限于可用的性能工具","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546003563,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1340589,"avatar":"https://static001.geekbang.org/account/avatar/00/14/74/ad/771d2646.jpg","nickname":"赵奇彬","note":"","ucode":"74B0FF5C558F89","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":310703,"discussion_content":"用docker, 默认就是root，随便搞","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602000016,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1205253,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","nickname":"我来也","note":"","ucode":"773D6104F56767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1340589,"avatar":"https://static001.geekbang.org/account/avatar/00/14/74/ad/771d2646.jpg","nickname":"赵奇彬","note":"","ucode":"74B0FF5C558F89","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":310754,"discussion_content":"那也得把当前用户添加到docker用户组了才能随便执行docker命令哦。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602034369,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":310703,"ip_address":""},"score":310754,"extra":""}]}]},{"had_liked":false,"id":68039,"user_name":"Richard","can_delete":false,"product_type":"c1","uid":1316758,"ip_address":"","ucode":"893F958B9DD161","user_header":"https://static001.geekbang.org/account/avatar/00/14/17/96/846fc11b.jpg","comment_is_top":false,"comment_ctime":1550394891,"is_pvip":false,"replies":[{"id":"24368","content":"不是的，直接IO是跳过Buffer，裸IO是跳过文件系统（还是有buffer的）","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550569612,"ip_address":"","comment_id":68039,"utype":1}],"discussion_count":6,"race_medal":0,"score":"143284315659","product_id":100020901,"comment_content":"这里的direct i&#47;o是不是上一节课里的直接操作磁盘的“裸i&#47;o”呢？如果是的话是不是应该从buffer的角度分析实验二呢?","like_count":34,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439484,"discussion_content":"不是的，直接IO是跳过Buffer，裸IO是跳过文件系统（还是有buffer的）","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1550569612,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1414395,"avatar":"https://static001.geekbang.org/account/avatar/00/15/94/fb/5afdcdae.jpg","nickname":"陈旭","note":"","ucode":"858E2C06391B59","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":33185,"discussion_content":"老师有个疑问，直接IO不是直接跟文件系统交互的吗，文件系统下面还有BUFFER，为什么说直接IO跳过了buffer？","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1571106086,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1316758,"avatar":"https://static001.geekbang.org/account/avatar/00/14/17/96/846fc11b.jpg","nickname":"Richard","note":"","ucode":"893F958B9DD161","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1414395,"avatar":"https://static001.geekbang.org/account/avatar/00/15/94/fb/5afdcdae.jpg","nickname":"陈旭","note":"","ucode":"858E2C06391B59","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306306,"discussion_content":"最近研究io的问题，又来看了下老师的这个回答，认识又清晰了些，我试着来回答一下你。首先你说文件系统下有buffer，这个观点不对，你可以深入研究一下Linux的io栈，文件系统是没有buffer的，buffer是内核组件vfs的，也就是页高速缓存page cache(Linux2.5之后page。cache和buffer cache已经基本融合，buffer cache只在裸io时有独立的buffer)。基于上述结论我们再看一下老师的回答，直接io是跳过页高速缓存，其操作的依然是文件，也就是没有跳过文件系统，io的发起者只是跳过了缓存，不使用vfs缓存，常见的例子就是数据库，数据库一般都会跳过page cache，建立自己的缓存，例如oracle的sga。而裸io跳过了文件系统，还是有buffer的，前面说页高速缓存是针对文件的，如果应用程序直接访问磁盘数据则属于裸io，其自然不经过page cache，但是会有特殊的buffer cache来缓存磁盘数据，也就说磁盘上的同一份数据有可能即在page cache中也在buffer cache中。","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1600242187,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":33185,"ip_address":""},"score":306306,"extra":""},{"author":{"id":1543040,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/80/8702bd5f.jpg","nickname":"evan","note":"","ucode":"491B073D5AFEDE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1316758,"avatar":"https://static001.geekbang.org/account/avatar/00/14/17/96/846fc11b.jpg","nickname":"Richard","note":"","ucode":"893F958B9DD161","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":317718,"discussion_content":"大佬请教几个问题..主要是第一个..\n1. 在上一讲语境中(cache &amp; buffer), 页高速缓存page cache等同于cache吗? 也就是page cache = cache, buffer cache = buffer ?\n2. 如果1成立, 那么内核2.5+已经融合了cache和buffer, 大多数情况下使用page cache(也就是cache)这一概念, 而buffer cache(buffer)只在裸io下使用...?\n3. page cache是页高速缓存页, 也就是说不仅适用于文件系统/文件, 而是一切经过page映射的读写..好像也只能经过页..?\n4. 感觉os处理数据总是绕不开page:\n裸io下:首先构造buffer_head或者bio结构的时候还是要经过page, 后续数据可能就直接经过buffer cache处理了..? \n直接io下: 跳过了page cache(cache), 使用app自己在内存中构建的缓存(比如mysql buffer pool), 但自己的缓存还是内存, 要访问内存, 就要经过页, 经过页就要经过page cache..好像又绕回来了...哈哈哈?\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1603592723,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":306306,"ip_address":""},"score":317718,"extra":""},{"author":{"id":1316758,"avatar":"https://static001.geekbang.org/account/avatar/00/14/17/96/846fc11b.jpg","nickname":"Richard","note":"","ucode":"893F958B9DD161","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1543040,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/80/8702bd5f.jpg","nickname":"evan","note":"","ucode":"491B073D5AFEDE","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":319904,"discussion_content":"1，2我认为是对的，我想说一点就是cache这个词单独拿出来没有意义，我们一般都会说什么什么的cache，比如页缓存就是page的cache，是Linux为了优化慢速的io而在内核地址空间开辟的一块内存，buffer确实只在裸io上用，但我也只是停留在概念上，没有遇到过应用场景也没有深入研究，因此我对buffer的态度是仅了解概念即可。\n3和4我不太明白你的意思，访问页就要经过page cache?我认为不一定，页缓存中有2种类型的页，有文件背景的和匿名文件的，也就是有文件背景比如平时访问的文件，可执行文件的代码段，内存映射文件等这些都有cache并且发生交换时和文件进行交换。还有一种匿名文件的比如stack，heap，内存映射的匿名页等这些内存，如果你配置了swap那么就有对应的swapcache，这块也在pagecache里，发生交换时就会在cache和swap file或者swap分区之间进行交换。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1604186145,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":317718,"ip_address":""},"score":319904,"extra":""}]}]},{"had_liked":false,"id":56418,"user_name":"noma","can_delete":false,"product_type":"c1","uid":1334774,"ip_address":"","ucode":"ADB9D589B9A798","user_header":"","comment_is_top":false,"comment_ctime":1546440836,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"138985394308","product_id":100020901,"comment_content":"pcstat 不使用代理安装：<br>if [ $(uname -m) == &quot;x86_64&quot; ] ; then<br>    curl -L -o pcstat https:&#47;&#47;github.com&#47;tobert&#47;pcstat&#47;raw&#47;2014-05-02-01&#47;pcstat.x86_64<br>else<br>    curl -L -o pcstat https:&#47;&#47;github.com&#47;tobert&#47;pcstat&#47;raw&#47;2014-05-02-01&#47;pcstat.x86_32<br>fi<br>chmod 755 pcstat<br>.&#47;pcstat 即可使用","like_count":32,"discussions":[{"author":{"id":2066801,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/W0VEO7Hxzd61mia6Ls2EpBmaZ0l9q7SFUAErbu4XKIjWLmlALr4ybpicDoI8SoXY8XJNKmk04Ep1ibTCuFvfCF8GQ/132","nickname":"Chen","note":"","ucode":"5D0F3DF807706E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":330555,"discussion_content":"curl: (7) Failed connect to raw.githubusercontent.com:443; 拒绝连接","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606646770,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1986708,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKT9Tk01eiaQ9aAhszthzGm6lwruRWPXia1YYFozctrdRvKg0Usp8NbwuKBApwD0D6Fty2tib3RdtFJg/132","nickname":"欧阳洲","note":"","ucode":"94606A6315F2BA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":305327,"discussion_content":"请教一下：\ncurl会报错Connection refused，\n https://github.com/tobert/pcstat/下面没有 raw/目录","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599879087,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1564869,"avatar":"https://static001.geekbang.org/account/avatar/00/17/e0/c5/c324a7de.jpg","nickname":"jorin@zou","note":"","ucode":"A8CEF7CCF33570","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":279374,"discussion_content":"为什么评论区的内容不能复制，要一个一个敲","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591334870,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1170843,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/9b/0bc44a78.jpg","nickname":"yyl","note":"","ucode":"1741DACDFCA9AF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1564869,"avatar":"https://static001.geekbang.org/account/avatar/00/17/e0/c5/c324a7de.jpg","nickname":"jorin@zou","note":"","ucode":"A8CEF7CCF33570","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295104,"discussion_content":"ctrl + c 也可以","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596091299,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":279374,"ip_address":""},"score":295104,"extra":""}]},{"author":{"id":1298046,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKZicicibGibtR5zAia782Ajc5I5BN3F3tjAdlibATIknHv67gbxeH21N7B6vbgwLjYb1miaLKhqicptB5ibYw/132","nickname":"阿飞","note":"","ucode":"F8B1FC8521264D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":279328,"discussion_content":"感谢老铁","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591324978,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55150,"user_name":"白华","can_delete":false,"product_type":"c1","uid":1315666,"ip_address":"","ucode":"FC9BACFCA6E8C1","user_header":"https://static001.geekbang.org/account/avatar/00/14/13/52/db1b01fc.jpg","comment_is_top":false,"comment_ctime":1546052960,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"121805137248","product_id":100020901,"comment_content":"centos7系统安装bcc-tools的教程我写在了简书上：https:&#47;&#47;www.jianshu.com&#47;p&#47;997e0a6d8e09大家如果有安装不下来的可以看看","like_count":28,"discussions":[{"author":{"id":1298046,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKZicicibGibtR5zAia782Ajc5I5BN3F3tjAdlibATIknHv67gbxeH21N7B6vbgwLjYb1miaLKhqicptB5ibYw/132","nickname":"阿飞","note":"","ucode":"F8B1FC8521264D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":279333,"discussion_content":"我安装你升级内核的步骤操作，没有升级成功，经过查询，特输出下面的文章\nhttps://lg.dongxc.cn/2020/06/01/centos7-%E5%8D%87%E7%BA%A7%E5%86%85%E6%A0%B8%EF%BC%88%E5%A4%A7%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7%EF%BC%89/","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591325201,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56957,"user_name":"念你如昔","can_delete":false,"product_type":"c1","uid":1323531,"ip_address":"","ucode":"FCAD88AB57D084","user_header":"https://static001.geekbang.org/account/avatar/00/14/32/0b/981b4e93.jpg","comment_is_top":false,"comment_ctime":1546586761,"is_pvip":false,"replies":[{"id":"22280","content":"1. 预读，2. 还有元数据缓存","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548246070,"ip_address":"","comment_id":56957,"utype":1}],"discussion_count":2,"race_medal":0,"score":"104625801865","product_id":100020901,"comment_content":"（我是小白）<br>1.dd命令前清理了缓存，为什么缓存命中率是百分之49.8呢？（都已经没有缓存了，按理说是0）<br>2.绕过了系统缓存，为什么缓存命中率还百分之百？","like_count":24,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435330,"discussion_content":"1. 预读，2. 还有元数据缓存","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1548246070,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1446494,"avatar":"https://static001.geekbang.org/account/avatar/00/16/12/5e/77b67a85.jpg","nickname":"飘云","note":"","ucode":"C6FE0310D6853C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":163013,"discussion_content":"2. 元数据缓存能占100%？ 如果这样的话， 1中的缓存命中率为什么不是100%？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581042288,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55530,"user_name":"Tech","can_delete":false,"product_type":"c1","uid":1018736,"ip_address":"","ucode":"83D3C69B0AA03F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8b/70/ab68020f.jpg","comment_is_top":false,"comment_ctime":1546224197,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"65970733637","product_id":100020901,"comment_content":"有个疑问，既然app那个案例是直接i&#47;o，那为什么还是有缓存了4MB呢？","like_count":15,"discussions":[{"author":{"id":1170843,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/9b/0bc44a78.jpg","nickname":"yyl","note":"","ucode":"1741DACDFCA9AF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295106,"discussion_content":"见上面的问答：元数据缓存","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1596091481,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54858,"user_name":"Johnson","can_delete":false,"product_type":"c1","uid":1225037,"ip_address":"","ucode":"55B582953E49F3","user_header":"https://static001.geekbang.org/account/avatar/00/12/b1/4d/10c75b34.jpg","comment_is_top":false,"comment_ctime":1545972136,"is_pvip":false,"replies":[{"id":"19925","content":"👍对的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546003378,"ip_address":"","comment_id":54858,"utype":1}],"discussion_count":1,"race_medal":0,"score":"65970481576","product_id":100020901,"comment_content":"dd命令也支持直接IO的 有选项oflag和iflag 所以dd也可以用来绕过cache buff做测试","like_count":15,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434587,"discussion_content":"👍对的","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1546003378,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55788,"user_name":"渡渡鸟_linux","can_delete":false,"product_type":"c1","uid":1227772,"ip_address":"","ucode":"099BB11A3201D3","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ernR4NKI5tejJAV3HMTF3gszBBUAjkjLO2QYic2gx5dMGelFv4LWibib7CUGexmMcMp5HiaaibmOH3dyHg/132","comment_is_top":false,"comment_ctime":1546309122,"is_pvip":false,"discussion_count":6,"race_medal":0,"score":"48790949378","product_id":100020901,"comment_content":"补充下centos7使用yum 安装bcc-tools:<br>[root@centos-80 ~]# yum update<br>[root@centos-80 ~]# rpm --import https:&#47;&#47;www.elrepo.org&#47;RPM-GPG-KEY-elrepo.org &amp;&amp; rpm -Uvh http:&#47;&#47;www.elrepo.org&#47;elrepo-release-7.0-2.el7.elrepo.noarch.rpm<br>[root@centos-80 ~]# uname -r ## <br>3.10.0-862.el7.x86_64<br>[root@centos-80 ~]# yum remove kernel-headers kernel-tools kernel-tools-libs<br>[root@centos-80 ~]# yum --disablerepo=&quot;*&quot; --enablerepo=&quot;elrepo-kernel&quot; install kernel-ml kernel-ml-devel kernel-ml-headers kernel-ml-tools kernel-ml-tools-libs kernel-ml-tools-libs-devel <br>[root@centos-80 ~]# sed -i &#39;&#47;GRUB_DEFAULT&#47;s&#47;=.*&#47;=0&#47;&#39; &#47;etc&#47;default&#47;grub<br>[root@centos-80 ~]# grub2-mkconfig -o &#47;boot&#47;grub2&#47;grub.cfg<br>[root@centos-80 ~]# reboot<br>[root@centos-80 ~]# uname -r ## 升级成功<br>4.20.0-1.el7.elrepo.x86_64<br>[root@centos-80 ~]# yum install -y bcc-tools<br>[root@centos-80 ~]# echo &#39;export PATH=$PATH:&#47;usr&#47;share&#47;bcc&#47;tools&#39; &gt; &#47;etc&#47;profile.d&#47;bcc-tools.sh<br>[root@centos-80 ~]# . &#47;etc&#47;profile.d&#47;bcc-tools.sh<br>[root@centos-80 ~]# cachestat 1 1 ## 测试安装是否成功<br>   TOTAL   MISSES     HITS  DIRTIES   BUFFERS_MB  CACHED_MB<br>       0        0        0        0            2        287","like_count":11,"discussions":[{"author":{"id":1705468,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/05/fc/bceb3f2b.jpg","nickname":"开心哥","note":"","ucode":"D44C1F03B23C5A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":331141,"discussion_content":"我放弃centos了, 老老实实搞一个18.04， 后面肯定还会有更多的坑等着。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606796674,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1170843,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/9b/0bc44a78.jpg","nickname":"yyl","note":"","ucode":"1741DACDFCA9AF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295284,"discussion_content":"虚拟机之前安装过k8s，内核升级至4.4，但是现在开机时进入4.4，bcc工具都无法使用；默认进入内核3.10，bcc工具却是可以使用的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596156539,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1564869,"avatar":"https://static001.geekbang.org/account/avatar/00/17/e0/c5/c324a7de.jpg","nickname":"jorin@zou","note":"","ucode":"A8CEF7CCF33570","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":279351,"discussion_content":"为什么评论区的内容复制不了？郁闷","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591329131,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1308196,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f6/24/5a9277f1.jpg","nickname":"ghostwritten","note":"","ucode":"AE512F2E24A1A0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1564869,"avatar":"https://static001.geekbang.org/account/avatar/00/17/e0/c5/c324a7de.jpg","nickname":"jorin@zou","note":"","ucode":"A8CEF7CCF33570","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381737,"discussion_content":"ctrl + c","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625196012,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":279351,"ip_address":""},"score":381737,"extra":""}]},{"author":{"id":1908948,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/20/d4/df7f27e8.jpg","nickname":"冰红茶","note":"","ucode":"705E0FA80DFCA3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":271285,"discussion_content":"docker 启动的centos7 可以么？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590112982,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1616114,"avatar":"https://static001.geekbang.org/account/avatar/00/18/a8/f2/91a7a3b4.jpg","nickname":"🤔","note":"","ucode":"5A80E3F01DE216","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":39820,"discussion_content":"点赞","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571993425,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55807,"user_name":"lvvp","can_delete":false,"product_type":"c1","uid":1097298,"ip_address":"","ucode":"D36C7B186C56DC","user_header":"https://static001.geekbang.org/account/avatar/00/10/be/52/568e8c06.jpg","comment_is_top":false,"comment_ctime":1546312908,"is_pvip":false,"discussion_count":7,"race_medal":0,"score":"35906051276","product_id":100020901,"comment_content":"1024*4K&#47;1024=4m这是怎么算的<br><br>","like_count":8,"discussions":[{"author":{"id":1786819,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/43/c3/2c53acd7.jpg","nickname":"雄鹰","note":"","ucode":"67E0C4BDE7F6F2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":228657,"discussion_content":"K除以1024就是M了，1024次，每次1页（大小是4K），总的大小就是 1024*4K/1024=4m ，若写成1024*（4K/1024）=4m可能就更容易看懂了","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1586568390,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1971295,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/14/5f/6a2af829.jpg","nickname":"悟明","note":"","ucode":"082FB4AAC5B69C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1786819,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/43/c3/2c53acd7.jpg","nickname":"雄鹰","note":"","ucode":"67E0C4BDE7F6F2","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":250007,"discussion_content":"直接1024*4kbit就是4M","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1587983037,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":228657,"ip_address":""},"score":250007,"extra":""},{"author":{"id":1290245,"avatar":"https://static001.geekbang.org/account/avatar/00/13/b0/05/48e3f940.jpg","nickname":"无心","note":"","ucode":"2AD84413DB4A72","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1971295,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/14/5f/6a2af829.jpg","nickname":"悟明","note":"","ucode":"082FB4AAC5B69C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301720,"discussion_content":"是的，看的时候迷糊了半天，后面才反应过来","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598619874,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":250007,"ip_address":""},"score":301720,"extra":""}]},{"author":{"id":2066801,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/W0VEO7Hxzd61mia6Ls2EpBmaZ0l9q7SFUAErbu4XKIjWLmlALr4ybpicDoI8SoXY8XJNKmk04Ep1ibTCuFvfCF8GQ/132","nickname":"Chen","note":"","ucode":"5D0F3DF807706E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":330557,"discussion_content":"1024*4k=4098k，换算成M的单位除以1024即是4098k/1024=4M","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606647096,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1806819,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoWvxMZkwG0Vo3WLBUSbwqticNdqbGhm5x4viauOibAdJdfJBup7oHa9K8yxACWf3e2b2aZdlNZN524g/132","nickname":"Geek_0391c1","note":"","ucode":"E6A4CA022321FA","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312368,"discussion_content":"K是单位（KB），1024*4 KB = (1024*4/1024) MB = 4MB","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602670961,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1971295,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/14/5f/6a2af829.jpg","nickname":"悟明","note":"","ucode":"082FB4AAC5B69C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":250003,"discussion_content":"笔误。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587982895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1246017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/03/41/ba59e1ee.jpg","nickname":"Ethan","note":"","ucode":"6856180D7B2525","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":9577,"discussion_content":"这是笔误吧?\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568191574,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54706,"user_name":"春暖花开","can_delete":false,"product_type":"c1","uid":1215253,"ip_address":"","ucode":"8B7D3BA1C1DD1B","user_header":"https://static001.geekbang.org/account/avatar/00/12/8b/15/5278f52a.jpg","comment_is_top":false,"comment_ctime":1545955622,"is_pvip":false,"replies":[{"id":"19941","content":"😊谢谢","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546005199,"ip_address":"","comment_id":54706,"utype":1}],"discussion_count":1,"race_medal":0,"score":"35905693990","product_id":100020901,"comment_content":"非常有价值，是我阅读的极客课程里面最棒的。","like_count":8,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434539,"discussion_content":"😊谢谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546005199,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58614,"user_name":"xfan","can_delete":false,"product_type":"c1","uid":1315147,"ip_address":"","ucode":"48ED8D498D7F56","user_header":"https://static001.geekbang.org/account/avatar/00/14/11/4b/fa64f061.jpg","comment_is_top":false,"comment_ctime":1547136855,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"27316940631","product_id":100020901,"comment_content":"我没有遇到老师的情况，我的hits为40960而不是1024，刚好是32M，我可能是固态？","like_count":6,"discussions":[{"author":{"id":1082187,"avatar":"https://static001.geekbang.org/account/avatar/00/10/83/4b/0e96fcae.jpg","nickname":"sky","note":"","ucode":"FC323371453C97","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541491,"discussion_content":"我把 32M 改成了 512M，这样直接与非直接IO差距会很大，缓存命中也会很大","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640405201,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2147290,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ2xl6icicu1c9mJibk4VZuiaHCFYTQYCbtiav9Hm1Mm9JzYIy1Q3IztsdNwHic30ByHWrNZib8zUial5hktw/132","nickname":"narous","note":"","ucode":"9FE22164FB6BA9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":397685,"discussion_content":"我的腾讯云主机，同样也是40960","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632660797,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1805809,"avatar":"","nickname":"ccz 开发(谢不邀)","note":"","ucode":"B8803B050AAC68","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387244,"discussion_content":"ubuntu 18.04, 内核版本5.4.0-80-generic，两个镜像都hit了40960，我在虚拟机跑的，虚拟机的磁盘是非固态，物理机的系统是固态硬盘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628067958,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2131606,"avatar":"","nickname":"Geek_da4cfb","note":"","ucode":"DB59B24A249713","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306210,"discussion_content":"我测出来也是这样 第一个读取慢一些，后面就和缓存差不多","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600218988,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56846,"user_name":"jssfy","can_delete":false,"product_type":"c1","uid":1137238,"ip_address":"","ucode":"F16353CFE607B7","user_header":"https://static001.geekbang.org/account/avatar/00/11/5a/56/115c6433.jpg","comment_is_top":false,"comment_ctime":1546566965,"is_pvip":false,"replies":[{"id":"22279","content":"预读","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548246030,"ip_address":"","comment_id":56846,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27316370741","product_id":100020901,"comment_content":"请问第一次读50%的命中率如何解释呢？","like_count":6,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435274,"discussion_content":"预读","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548246030,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54719,"user_name":"往事随风，顺其自然","can_delete":false,"product_type":"c1","uid":1235692,"ip_address":"","ucode":"F266EC6B143E38","user_header":"https://static001.geekbang.org/account/avatar/00/12/da/ec/779c1a78.jpg","comment_is_top":false,"comment_ctime":1545957161,"is_pvip":false,"replies":[{"id":"19936","content":"大部分案例我都在centos7验证了，不过文章中有些地方没有列出来详细的步骤，比如安装或者升级软件包的步骤，这些其实都是些基本功了。如果碰到实在无法解决的问题，请具体描述下。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546004956,"ip_address":"","comment_id":54719,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27315760937","product_id":100020901,"comment_content":"要是centos验证一下就好了，不同系统很多问题不一样，操作上遇到问题很奇怪","like_count":6,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434544,"discussion_content":"大部分案例我都在centos7验证了，不过文章中有些地方没有列出来详细的步骤，比如安装或者升级软件包的步骤，这些其实都是些基本功了。如果碰到实在无法解决的问题，请具体描述下。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1546004956,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55623,"user_name":"mj4ever","can_delete":false,"product_type":"c1","uid":1005549,"ip_address":"","ucode":"73028E537099CC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/ed/d50de13c.jpg","comment_is_top":false,"comment_ctime":1546244576,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"23021081056","product_id":100020901,"comment_content":"老师：<br>1、不知道是不是固态硬盘的原因，调整了参数至320MB<br>docker run --privileged --name=app -itd feisky&#47;app:io-direct &#47;app -d &#47;dev&#47;sdb -s 335544320<br>2、用命令观察，cachestat 5，可以达到409600，409600*4&#47;1024=320MB<br>3、另外，想再调大些参数，会报错：<br>Reading data from disk &#47;dev&#47;sda1 with buffer size 335544321<br>failed to read contents: Invalid argument","like_count":5,"discussions":[{"author":{"id":1588770,"avatar":"https://static001.geekbang.org/account/avatar/00/18/3e/22/f91219a8.jpg","nickname":"wanlinwang","note":"","ucode":"C74C3CF0B5BF64","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3382,"discussion_content":"这个问题解决了吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564448881,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112722,"user_name":"辉晖","can_delete":false,"product_type":"c1","uid":1574062,"ip_address":"","ucode":"E5EC033EE4952B","user_header":"https://static001.geekbang.org/account/avatar/00/18/04/ae/0118c132.jpg","comment_is_top":false,"comment_ctime":1562809975,"is_pvip":false,"replies":[{"id":"41991","content":"嗯嗯，也可以试试 systemtap","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1563458149,"ip_address":"","comment_id":112722,"utype":1}],"discussion_count":2,"race_medal":0,"score":"18742679159","product_id":100020901,"comment_content":"很遗憾，实际生产环境都是用centos，没法为了安装bcc-tools而去升级内核。","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457878,"discussion_content":"嗯嗯，也可以试试 systemtap","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563458149,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1110039,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f0/17/796a3d20.jpg","nickname":"言十年","note":"","ucode":"67B8B49C3A3B17","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":392313,"discussion_content":"我也是","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630941594,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54879,"user_name":"ninuxer","can_delete":false,"product_type":"c1","uid":1243135,"ip_address":"","ucode":"5394ADAF2667D6","user_header":"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKQMM4m7NHuicr55aRiblTSEWIYe0QqbpyHweaoAbG7j2v7UUElqqeP3Ihrm3UfDPDRb1Hv8LvPwXqA/132","comment_is_top":false,"comment_ctime":1545975573,"is_pvip":false,"replies":[{"id":"19922","content":"👍加油","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546003257,"ip_address":"","comment_id":54879,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18725844757","product_id":100020901,"comment_content":"打卡day18<br>年终忙着各种总结，各种文字性东西，已经连着一礼拜12点之后下班了，再忙也要坚持跟着实践～💪💪💪","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434597,"discussion_content":"👍加油","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546003257,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54852,"user_name":"许山山","can_delete":false,"product_type":"c1","uid":1241643,"ip_address":"","ucode":"2A5168DEB58F19","user_header":"https://static001.geekbang.org/account/avatar/00/12/f2/2b/7d9751bb.jpg","comment_is_top":false,"comment_ctime":1545969911,"is_pvip":false,"replies":[{"id":"19926","content":"谢谢👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546003390,"ip_address":"","comment_id":54852,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18725839095","product_id":100020901,"comment_content":"我也觉得这门课超级棒了，原理加时间，学到很多！","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434585,"discussion_content":"谢谢👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546003390,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":252904,"user_name":"aoe","can_delete":false,"product_type":"c1","uid":1121758,"ip_address":"","ucode":"1C6201EDB4E954","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","comment_is_top":false,"comment_ctime":1602512051,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"14487413939","product_id":100020901,"comment_content":"Ubuntu 20.04 <br>使用 apt 安装 bcc失败，各种办法搜了半天，没搞定<br><br>换 Snap 安装，轻松成功<br>https:&#47;&#47;snapcraft.io&#47;install&#47;bcc&#47;ubuntu<br><br>才知道 Snap 安装软件也是那么方便<br><br>安装后进入 &#47;snap&#47;bin<br><br>```cmd<br>$ cd &#47;snap&#47;bin<br><br># 运行时例如<br>$ .&#47;bcc.filetop -C<br>```","like_count":3,"discussions":[{"author":{"id":1349823,"avatar":"https://static001.geekbang.org/account/avatar/00/14/98/bf/d526db50.jpg","nickname":"范林杰","note":"","ucode":"DE08C8846FFD9F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":581250,"discussion_content":"太有用了，我20.04装了半天各种失败。。。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658666498,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1121758,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","nickname":"aoe","note":"","ucode":"1C6201EDB4E954","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1349823,"avatar":"https://static001.geekbang.org/account/avatar/00/14/98/bf/d526db50.jpg","nickname":"范林杰","note":"","ucode":"DE08C8846FFD9F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":581304,"discussion_content":"基础不好，说起来都是泪","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658718354,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":581250,"ip_address":""},"score":581304,"extra":""}]},{"author":{"id":1013424,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/b0/14fec62f.jpg","nickname":"不了峰","note":"","ucode":"E23B96D6A3D4EC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550334,"discussion_content":"赞！赞！赞！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644486053,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":235298,"user_name":"Zyj-Sxy","can_delete":false,"product_type":"c1","uid":1628304,"ip_address":"","ucode":"F9E5B142B45624","user_header":"https://static001.geekbang.org/account/avatar/00/18/d8/90/1cc506ad.jpg","comment_is_top":false,"comment_ctime":1594966610,"is_pvip":false,"replies":[{"id":"87272","content":"👍 谢谢分享详细的步骤","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1595344320,"ip_address":"","comment_id":235298,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14479868498","product_id":100020901,"comment_content":"#go get方式安装pcstat可能会有问题直接下载github仓库就不用挂代理什么的了<br>#安装go<br>yum install -y go<br>#添加环境变量<br>cat &lt;&lt; EOF &gt;&gt; &#47;etc&#47;profile<br>export GOROOT=&#47;usr&#47;lib&#47;golang<br>export GOPATH=&#47;root&#47;go<br>export GOBIN=$GOPATH&#47;bin<br>export PATH=$PATH:$GOBIN<br>EOF<br>#加载环境变量<br>source &#47;etc&#47;profile<br><br>#使用git方式拉取<br>mkdir -p $GOPATH&#47;src&#47;golang.org&#47;x &amp;&amp; cd $GOPATH&#47;src&#47;golang.org&#47;x &amp;&amp; git clone https:&#47;&#47;github.com&#47;golang&#47;sys.git<br><br>#使用git拉取pcstat，<br>mkdir -p $GOPATH&#47;src&#47;github.com&#47;tobert &amp;&amp; cd $GOPATH&#47;src&#47;github.com&#47;tobert &amp;&amp; git clone https:&#47;&#47;github.com&#47;tobert&#47;pcstat.git<br><br>#编译pcstat<br>go install $GOPATH&#47;src&#47;github.com&#47;tobert&#47;pcstat&#47;pcstat<br><br>#安装完成就可以直接使用pcstat<br>pcstat &#47;bin&#47;ls","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501679,"discussion_content":"👍 谢谢分享详细的步骤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595344320,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2830902,"avatar":"","nickname":"Geek6703","note":"","ucode":"8F71AAD9C355CC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":531483,"discussion_content":"应该是go install $GOPATH/src/github.com/tobert/pcstat吧，多写了一个pcstat","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637323114,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":118524,"user_name":"sam700000","can_delete":false,"product_type":"c1","uid":1069133,"ip_address":"","ucode":"C2ABDDC56B2D50","user_header":"https://static001.geekbang.org/account/avatar/00/10/50/4d/db91e218.jpg","comment_is_top":false,"comment_ctime":1564380635,"is_pvip":true,"discussion_count":3,"race_medal":0,"score":"14449282523","product_id":100020901,"comment_content":"使用用vmware workstation跑的Ubuntu18.04 2C 8G<br>在案例二中，跑第一个镜像feisky&#47;app:io-direct时<br>用命令cachetop 5 观察结果是<br><br>14:04:45 Buffers MB: 40 &#47; Cached MB: 1182 &#47; Sort: HITS &#47; Order: ascending<br>PID      UID      CMD HITS     MISSES   DIRTIES  READ_HIT%  WRITE_HIT%<br>    1443 root     dockerd                 4        0        1      75.0%       0.0%<br>     366 root     jbd2&#47;sda1-8             4        3        2      28.6%      28.6%<br>    4251 root     cachetop                6        0        0     100.0%       0.0%<br>    2496 root     dockerd                12        0        3      75.0%       0.0%<br>    4129 root     app                 40959        0        0     100.0%       0.0%<br><br>就是说已经是32MB读数据全部缓存了<br>而且docker logs app看到，除了第一次之外，读取速度都很快，肯定是用缓存的数据了<br>Time used: 0.057187 s to read 33554432 bytes<br>Time used: 0.055884 s to read 33554432 bytes<br>Time used: 0.063654 s to read 33554432 bytes<br>Time used: 0.017619 s to read 33554432 bytes<br><br>但是strace -p $(pgrep app)看到明明是系统调用使用了O_DIRECT选项，但是为什么还是用了缓存呢？和老师这里的结果不同","like_count":3,"discussions":[{"author":{"id":1170843,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/9b/0bc44a78.jpg","nickname":"yyl","note":"","ucode":"1741DACDFCA9AF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295108,"discussion_content":"元数据缓存","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596091873,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1047043,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/fa/03/619e3e48.jpg","nickname":"风清扬","note":"","ucode":"651F1390B64953","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":8371,"discussion_content":"不知道是不是跟固态盘有关系，第二个例子运行io-direct时读32MB数据0.01s","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567952365,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1047043,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/fa/03/619e3e48.jpg","nickname":"风清扬","note":"","ucode":"651F1390B64953","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":8370,"discussion_content":"我刚学到这里，不知道你解决没，我也是虚拟机里运行的ubuntu，然后盘的话是固态盘。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567952304,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":98712,"user_name":"小周","can_delete":false,"product_type":"c1","uid":1404839,"ip_address":"","ucode":"859210BD669B8C","user_header":"https://static001.geekbang.org/account/avatar/00/15/6f/a7/303c1a6b.jpg","comment_is_top":false,"comment_ctime":1559065241,"is_pvip":false,"replies":[{"id":"35817","content":"公式写的有问题，最后&#47;1024要表达的是单位转换的意思","user_name":"作者回复","comment_id":98712,"uid":"1001282","ip_address":"","utype":1,"ctime":1559280837,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"14443967129","product_id":100020901,"comment_content":"1024*4K&#47;1024 = 4MB 不是等于 4K吗！？ ","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451803,"discussion_content":"公式写的有问题，最后/1024要表达的是单位转换的意思","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559280837,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":288981,"user_name":"Rachel","can_delete":false,"product_type":"c1","uid":1314902,"ip_address":"","ucode":"826A0DC0794765","user_header":"https://static001.geekbang.org/account/avatar/00/14/10/56/c6487f8e.jpg","comment_is_top":false,"comment_ctime":1618807975,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10208742567","product_id":100020901,"comment_content":"could not open bpf map: counts, error: Operation not permitted<br>Traceback (most recent call last):<br>  File &quot;&#47;usr&#47;share&#47;bcc&#47;tools&#47;cachestat&quot;, line 96, in &lt;module&gt;<br>    b = BPF(text=bpf_text)<br>  File &quot;&#47;usr&#47;lib&#47;python2.7&#47;dist-packages&#47;bcc&#47;__init__.py&quot;, line 325, in __init__<br>    raise Exception(&quot;Failed to compile BPF text&quot;)<br>Exception: Failed to compile BPF text<br><br>老师，我ubuntu14系统安装后执行cachestat 命令后报错信息如上，是什么原因呢","like_count":2},{"had_liked":false,"id":55127,"user_name":"2xshu","can_delete":false,"product_type":"c1","uid":1188473,"ip_address":"","ucode":"71584CB9676EDF","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKsz8j0bAayjSne9iakvjzUmvUdxWEbsM9iasQ74spGFayIgbSE232sH2LOWmaKtx1WqAFDiaYgVPwIQ/132","comment_is_top":false,"comment_ctime":1546048242,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10135982834","product_id":100020901,"comment_content":"老师你好，第一个案列我有不太明白的地方。希望能得到老师的指教。<br>既然执行了 echo 3 &gt; &#47;proc&#47;sys&#47;vm&#47;drop_cacches，为什么在dd if=file of=&#47;dev&#47;null bs=1M 的时候，还有缓存能命中呢？我得理解是这些数据应该都没有在缓存啊。<br>","like_count":2},{"had_liked":false,"id":55053,"user_name":"末班车","can_delete":false,"product_type":"c1","uid":1335855,"ip_address":"","ucode":"FC7A7AB51A9C8C","user_header":"https://static001.geekbang.org/account/avatar/00/14/62/2f/bb04ae52.jpg","comment_is_top":false,"comment_ctime":1546011282,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10135945874","product_id":100020901,"comment_content":"老师太厉害了，这个课程的价值远远高于这个价！！","like_count":2},{"had_liked":false,"id":54991,"user_name":"夜空中最亮的星","can_delete":false,"product_type":"c1","uid":1267566,"ip_address":"","ucode":"ADC3E7B6789955","user_header":"https://static001.geekbang.org/account/avatar/00/13/57/6e/b6795c44.jpg","comment_is_top":false,"comment_ctime":1545995610,"is_pvip":false,"replies":[{"id":"19910","content":"是的，下载 golang.org 的包需要使用代理，设置方法是：<br><br>git config [--global] http.proxy http:&#47;&#47;proxy.example.com:port","user_name":"作者回复","comment_id":54991,"uid":"1001282","ip_address":"","utype":1,"ctime":1546001628,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"10135930202","product_id":100020901,"comment_content":"老师 ：<br>这个 go get golang.org&#47;x&#47;sys&#47;unix   访问不了国内下载不了，<br>老师您有什么方法吗？指点下 谢谢<br>[root@bogon ~]# go get golang.org&#47;x&#47;sys&#47;unix <br>package golang.org&#47;x&#47;sys&#47;unix: unrecognized import path &quot;golang.org&#47;x&#47;sys&#47;unix&quot; (https fetch: Get https:&#47;&#47;golang.org&#47;x&#47;sys&#47;unix?go-get=1: dial tcp 216.239.37.1:443: connect: connection refused)<br>[root@bogon ~]# <br><br>导致下面的也安装不上<br>go get github.com&#47;tobert&#47;pcstat&#47;pcstat<br><br>[root@bogon ~]# go get github.com&#47;tobert&#47;pcstat&#47;pcstat<br>package golang.org&#47;x&#47;sys&#47;unix: unrecognized import path &quot;golang.org&#47;x&#47;sys&#47;unix&quot; (https fetch: Get https:&#47;&#47;golang.org&#47;x&#47;sys&#47;unix?go-get=1: dial tcp 216.239.37.1:443: connect: connection refused)<br>[root@bogon ~]# ","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434641,"discussion_content":"是的，下载 golang.org 的包需要使用代理，设置方法是：\n\ngit config [--global] http.proxy http://proxy.example.com:port","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546001628,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54833,"user_name":"饼子","can_delete":false,"product_type":"c1","uid":1085953,"ip_address":"","ucode":"981A44836A5216","user_header":"https://static001.geekbang.org/account/avatar/00/10/92/01/c723d180.jpg","comment_is_top":false,"comment_ctime":1545967471,"is_pvip":false,"replies":[{"id":"19928","content":"对对，用缓存优化慢速I&#47;O","user_name":"作者回复","comment_id":54833,"uid":"1001282","ip_address":"","utype":1,"ctime":1546003624,"user_name_real":"倪朋飞"}],"discussion_count":2,"race_medal":0,"score":"10135902063","product_id":100020901,"comment_content":"我的理解是，要高效运行和使用cpu，并让cpu持续工作，减少等待时间，就需要在物理io上面做优化，减少不可中断，在加入缓存是可以优化io次数的！","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434576,"discussion_content":"对对，用缓存优化慢速I/O","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546003624,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1803259,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/83/fb/621adceb.jpg","nickname":"linker","note":"","ucode":"6C5799F2FC2C82","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":210472,"discussion_content":"在繁忙的系统上，缓存有时候是有害的，我遇到一个情况，缓存占满，内核来不及清理，导致网络连接失败。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584723642,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358110,"user_name":"Geek_f93234","can_delete":false,"product_type":"c1","uid":1769504,"ip_address":"北京","ucode":"1E5DC903A5429E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJGXndj5N66z9BL1ic9GibZzWWgoVeWaWTL2XUnCYic7iba2kAEvN9WfjmlXELD5lqt8IJ1P023N5ZWicg/132","comment_is_top":false,"comment_ctime":1663915055,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"5958882351","product_id":100020901,"comment_content":"安装pcstat:<br>1、安装golang<br>wget https:&#47;&#47;golang.google.cn&#47;dl&#47;go1.19.1.linux-amd64.tar.gz<br>tar zxvf go1.19.1.linux-amd64.tar.gz<br>cd go&#47;bin&#47;<br> .&#47;go version<br>2、配置环境变量<br>[root@localhost bin]# vim &#47;etc&#47;profile<br>export GO_HOME=&#47;usr&#47;local&#47;go<br>export PATH=$PATH:$GO_HOME&#47;bin<br>[root@localhost pcstat]# source &#47;etc&#47;profile<br>3、GOPROXY 环境变量（很重要，不然被墙无法下载）<br>go env -w GOPROXY=https:&#47;&#47;goproxy.cn<br>export GO111MODULE=on <br>4、安装pcstat<br>git clone https:&#47;&#47;github.com&#47;tobert&#47;pcstat.git<br>cd pcstat<br>go build<br>sudo cp -a pcstat &#47;usr&#47;local&#47;bin<br>pcstat &#47;usr&#47;local&#47;bin&#47;pcstat","like_count":1},{"had_liked":false,"id":310440,"user_name":"chaoxifuchen","can_delete":false,"product_type":"c1","uid":1292330,"ip_address":"","ucode":"95DCC5C4994F68","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/VX0ib4CV0m7fwxB2xFcIJaYYWXXpfxxYbfBErqBej9395hgZszqS3dz9bThCxOuFfJ8Xibx9HbdNmZJwL5m33wIw/132","comment_is_top":false,"comment_ctime":1630656537,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5925623833","product_id":100020901,"comment_content":"vmtouch这个工具，不但可以查看文件缓存，还可以操作对特定文件缓存进行驱逐，感觉功能更强大","like_count":1,"discussions":[{"author":{"id":1013424,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/b0/14fec62f.jpg","nickname":"不了峰","note":"","ucode":"E23B96D6A3D4EC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550321,"discussion_content":"赞！赞！赞！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644484041,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":245215,"user_name":"此号用来看新闻","can_delete":false,"product_type":"c1","uid":2152758,"ip_address":"","ucode":"D74C189B6922C0","user_header":"","comment_is_top":false,"comment_ctime":1598866112,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5893833408","product_id":100020901,"comment_content":"cachetop对内核版本是否有要求，我装了4.4的和5.8的都用不了，原来4.4的能用cachetop和cachestat但是用不了memleak，我换成5.8，三个都用不了","like_count":1,"discussions":[{"author":{"id":2411665,"avatar":"","nickname":"Geek_ea821e","note":"","ucode":"9C70C74393A184","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344263,"discussion_content":"https://blog.csdn.net/weixin_44395686/article/details/102595552?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromBaidu-1.control&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromBaidu-1.control   我内核版本5.10  安装bcc的时候参考这篇博客安装成功","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611374608,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1970516,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLK4NPyaFDl4rzrd4A9z42tQDibFLdCicbrAdyUa5P2B5u8UCUBenpHX7VgUCibvHvhpza4icMBKVnhmA/132","nickname":"学无止境","note":"","ucode":"2C28E8E54DAB4E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303229,"discussion_content":"5.0以上内核确实运行报错，原因未知","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599196238,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":235120,"user_name":"LindaWang","can_delete":false,"product_type":"c1","uid":1800128,"ip_address":"","ucode":"45368868C3980B","user_header":"https://static001.geekbang.org/account/avatar/00/1b/77/c0/22872965.jpg","comment_is_top":false,"comment_ctime":1594897793,"is_pvip":false,"replies":[{"id":"86797","content":"这一块我们的专栏没有展开，你可以使用 perf 工具来查看 CPU 缓存的统计信息。<br><br>也可以参考陶辉的这篇专栏 https:&#47;&#47;time.geekbang.org&#47;column&#47;article&#47;230194","user_name":"作者回复","comment_id":235120,"uid":"1001282","ip_address":"","utype":1,"ctime":1594905503,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"5889865089","product_id":100020901,"comment_content":"老师，可不可以讲下CPU Cache（L1&#47;L2&#47;L3）如何查看和优化？感觉这里的cachestat&#47;cachetop&#47;pcstat查看的都是文件io之类的，操作系统层面的cache","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501607,"discussion_content":"这一块我们的专栏没有展开，你可以使用 perf 工具来查看 CPU 缓存的统计信息。\n\n也可以参考陶辉的这篇专栏 https://time.geekbang.org/column/article/230194","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594905503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":211081,"user_name":"涉蓝","can_delete":false,"product_type":"c1","uid":1134619,"ip_address":"","ucode":"C1321E29E01625","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLh8ubWQtDRa6exJtloSwibLliaejpF7434ficyggzukmXE63UlSPvbykoiaVDZo4CbDIIOQsCkicibyn9A/132","comment_is_top":false,"comment_ctime":1587892499,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5882859795","product_id":100020901,"comment_content":"我使用的是 mac 下装的 ubtuntu 的虚拟机  然后那个直接IO 的例子 我这里 cachetop 的 HITS 直接就是 40960  ","like_count":1},{"had_liked":false,"id":120277,"user_name":"tinyfool","can_delete":false,"product_type":"c1","uid":1604827,"ip_address":"","ucode":"8B93B6A9FBEA12","user_header":"","comment_is_top":false,"comment_ctime":1564818526,"is_pvip":false,"replies":[{"id":"44399","content":"0.03s是IO调用的时间，每次IO调用还有一个1s的间隔时间","user_name":"作者回复","comment_id":120277,"uid":"1001282","ip_address":"","utype":1,"ctime":1565015121,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"5859785822","product_id":100020901,"comment_content":"docker日志显示0.03s读取了32MB数据；<br>根据cachetop输出计算1s从缓存中读取了32MB数据；<br>这两个时间差异很大，老师是否可以解释下了？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461266,"discussion_content":"0.03s是IO调用的时间，每次IO调用还有一个1s的间隔时间","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565015121,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":85669,"user_name":"小松松","can_delete":false,"product_type":"c1","uid":1298152,"ip_address":"","ucode":"B9B5FFE7CAA548","user_header":"https://static001.geekbang.org/account/avatar/00/13/ce/e8/12cb8e99.jpg","comment_is_top":false,"comment_ctime":1555168655,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5850135951","product_id":100020901,"comment_content":"23:16:27 Buffers MB: 14 &#47; Cached MB: 284 &#47; Sort: HITS &#47; Order: ascending<br>PID      UID      CMD              HITS     MISSES   DIRTIES  READ_HIT%  WRITE_HIT%<br>    2049 root     dockerd                 3        0        1      66.7%       0.0%<br>    2064 root     dockerd                 3        0        1      66.7%       0.0%<br>     422 root     jbd2&#47;sda2-8             3        3        1      33.3%      33.3%<br>    2065 root     dockerd                 9        0        3      66.7%       0.0%<br>    3522 root     cachetop               13        0        0     100.0%       0.0%<br>    3268 root     app                 40960    42560        0      49.0%      51.0%<br>有没有遇到我这个情况？  请老师解惑一下。 ","like_count":1},{"had_liked":false,"id":66058,"user_name":"18646333118","can_delete":false,"product_type":"c1","uid":1202411,"ip_address":"","ucode":"35576AC4E5ADDD","user_header":"https://static001.geekbang.org/account/avatar/00/12/58/eb/cf3608bd.jpg","comment_is_top":false,"comment_ctime":1549866513,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5844833809","product_id":100020901,"comment_content":"[root@bogon ~]# cat &#47;etc&#47;redhat-release<br>CentOS Linux release 7.3.1611 (Core)<br><br><br>[root@bogon ~]# docker ps<br>CONTAINER ID        IMAGE                  COMMAND             CREATED             STATUS              PORTS               NAMES<br>47ec1fe18e4d        feisky&#47;app:io-cached   &quot;&#47;app&quot;              18 minutes ago      Up 11 minutes                           app<br><br>更换正常镜像后发下命中率提升到50%  并非100%<br>01:25:44 Buffers MB: 0 &#47; Cached MB: 474 &#47; Sort: HITS &#47; Order: ascending<br>PID      UID      CMD              HITS     MISSES   DIRTIES  READ_HIT%  WRITE_HIT%<br>   27471 root     app                 32768    36864        0      47.1%      52.9%<br><br><br><br>[root@bogon ~]# docker logs app<br>Reading data from disk &#47;dev&#47;sdb1 with buffer size 33554432<br>Time used: 0.241105 s to read 33554432 bytes<br>Time used: 0.197409 s to read 33554432 bytes<br>Time used: 0.183848 s to read 33554432 bytes<br>Time used: 0.181268 s to read 33554432 bytes<br>Time used: 0.189861 s to read 33554432 bytes<br>Time used: 0.212937 s to read 33554432 bytes<br>Time used: 0.223062 s to read 33554432 bytes<br>Time used: 0.167487 s to read 33554432 bytes","like_count":1},{"had_liked":false,"id":55341,"user_name":"9527","can_delete":false,"product_type":"c1","uid":1032735,"ip_address":"","ucode":"04B51C09E3C7B8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c2/1f/343f2dec.jpg","comment_is_top":false,"comment_ctime":1546138519,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5841105815","product_id":100020901,"comment_content":"老师好，我在网上找了各种教程，安装依赖包升级内核，到安装bcc的时候还是卡主了<br>CMake Error: The following variables are used in this project, but they are set to NOTFOUND.<br>Please set them or make sure they are set and tested correctly in the CMake files:<br>libclangAnalysis<br>    linked by target &quot;bcc-shared&quot; in directory &#47;root&#47;bcc&#47;src&#47;cc<br>    linked by target &quot;bcc-static&quot; in directory &#47;root&#47;bcc&#47;src&#47;cc<br><br>-- Configuring incomplete, errors occurred!<br>See also &quot;&#47;root&#47;bcc-build&#47;CMakeFiles&#47;CMakeOutput.log&quot;.<br>See also &quot;&#47;root&#47;bcc-build&#47;CMakeFiles&#47;CMakeError.log&quot;.<br><br><br>看错误日志是这样的：<br>Performing C++ SOURCE FILE Test HAVE_NO_PIE_FLAG failed with the following output:<br>Change Dir: &#47;root&#47;bcc-build&#47;CMakeFiles&#47;CMakeTmp<br><br>Run Build Command:&quot;&#47;usr&#47;bin&#47;gmake&quot; &quot;cmTC_7c05d&#47;fast&quot;<br>&#47;usr&#47;bin&#47;gmake -f CMakeFiles&#47;cmTC_7c05d.dir&#47;build.make CMakeFiles&#47;cmTC_7c05d.dir&#47;build<br>gmake[1]: Entering directory `&#47;root&#47;bcc-build&#47;CMakeFiles&#47;CMakeTmp&#39;<br>Building CXX object CMakeFiles&#47;cmTC_7c05d.dir&#47;src.cxx.o<br>&#47;usr&#47;bin&#47;c++     -DHAVE_NO_PIE_FLAG -no-pie   -o CMakeFiles&#47;cmTC_7c05d.dir&#47;src.cxx.o -c &#47;root&#47;bcc-build&#47;CMakeFiles&#47;CMakeTmp&#47;src.cxx<br>c++: error: unrecognized command line option ‘-no-pie’<br>gmake[1]: *** [CMakeFiles&#47;cmTC_7c05d.dir&#47;src.cxx.o] Error 1<br>gmake[1]: Leaving directory `&#47;root&#47;bcc-build&#47;CMakeFiles&#47;CMakeTmp&#39;<br>gmake: *** [cmTC_7c05d&#47;fast] Error 2<br><br>Source file was:<br>int main() {return 0;}<br><br><br><br><br>这个软件好难装啊，没法做实验了😅😅","like_count":1},{"had_liked":false,"id":54743,"user_name":"付盼星","can_delete":false,"product_type":"c1","uid":1055542,"ip_address":"","ucode":"E0E4B74E8B361F","user_header":"https://static001.geekbang.org/account/avatar/00/10/1b/36/abe6d066.jpg","comment_is_top":false,"comment_ctime":1545958769,"is_pvip":false,"replies":[{"id":"19933","content":"这是正常的，实际上繁忙的系统中缓存可能还会更多。<br><br>据我所知，还没有可以按文件缓存大小排序的工具。很多缓存都是可回收的，所以并不代表就容易OOM。真的容易发生OOM时，说明缓存正在被使用，这其实就可以从进程角度来分析了","user_name":"作者回复","comment_id":54743,"uid":"1001282","ip_address":"","utype":1,"ctime":1546004390,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"5840926065","product_id":100020901,"comment_content":"老师好，我有个问题，公司服务器是4核8g，但是我看到普遍的cache使用量都在3g左右，这个是否正常，有没有命令可以查看哪些大文件被缓存了，按照占总量排序，能不能清理，因为free就剩下不到1g，很容易就oom了，非常感谢老师，期待老师解答。","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434548,"discussion_content":"这是正常的，实际上繁忙的系统中缓存可能还会更多。\n\n据我所知，还没有可以按文件缓存大小排序的工具。很多缓存都是可回收的，所以并不代表就容易OOM。真的容易发生OOM时，说明缓存正在被使用，这其实就可以从进程角度来分析了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546004390,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54695,"user_name":"solar","can_delete":false,"product_type":"c1","uid":1316091,"ip_address":"","ucode":"D5BE087E264401","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/dwehJHP4ycAfDb9MoudXb4QSt7YgmISqwwsa928XZ6aTWqwWh0kx0iatjocSibLa7iajXmbGlJ5svegY3P6LfKJ0w/132","comment_is_top":false,"comment_ctime":1545954334,"is_pvip":true,"replies":[{"id":"19942","content":"👍","user_name":"作者回复","comment_id":54695,"uid":"1001282","ip_address":"","utype":1,"ctime":1546005205,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"5840921630","product_id":100020901,"comment_content":"打卡，终于到内存篇了，工作中确实遇到很多与内存有关的问题，急需更多的检测方法。","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434537,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546005205,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358373,"user_name":"Geek_f93234","can_delete":false,"product_type":"c1","uid":1769504,"ip_address":"北京","ucode":"1E5DC903A5429E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJGXndj5N66z9BL1ic9GibZzWWgoVeWaWTL2XUnCYic7iba2kAEvN9WfjmlXELD5lqt8IJ1P023N5ZWicg/132","comment_is_top":false,"comment_ctime":1664256538,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1664256538","product_id":100020901,"comment_content":"老师，这台机器上实验，直接io和缓存io性能的差别不大<br>缓存io<br>root@pc:~# docker run --privileged --name=app -itd feisky&#47;app:io-direct &#47;app -d &#47;dev&#47;sda2 -s 1006632960<br>abe78aa7a13e4f045e146cf769b6046dfbd96cd954e1900c02c2e0bba31c922a<br>root@pc:~# docker logs app<br>Reading data from disk &#47;dev&#47;sda2 with buffer size 1006632960<br>Time used: 0.616233 s to read 1006632960 bytes<br>Time used: 0.519209 s to read 1006632960 bytes<br>Time used: 0.512982 s to read 1006632960 bytes<br>Time used: 0.480577 s to read 1006632960 bytes<br><br>io走缓存<br>root@pc:~# docker run --privileged --name=app -itd feisky&#47;app:io-cached &#47;app -d &#47;dev&#47;sda2 -s 1006632960<br>ad0eacc543ce81965194b52591c9e36effae1de30cd0829862e587e01e7af33d<br>root@pc:~# docker logs app<br>Reading data from disk &#47;dev&#47;sda2 with buffer size 1006632960<br>Time used: 0.593904 s to read 1006632960 bytes<br>Time used: 0.523631 s to read 1006632960 bytes<br>Time used: 0.517901 s to read 1006632960 bytes<br>Time used: 0.514386 s to read 1006632960 bytes<br>Time used: 0.485319 s to read 1006632960 bytes<br>Time used: 0.574565 s to read 1006632960 bytes","like_count":0},{"had_liked":false,"id":343146,"user_name":"漠博嵩","can_delete":false,"product_type":"c1","uid":2660316,"ip_address":"","ucode":"33704880E9790F","user_header":"https://static001.geekbang.org/account/avatar/00/28/97/dc/8eacc8f1.jpg","comment_is_top":false,"comment_ctime":1650677460,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1650677460","product_id":100020901,"comment_content":"各种环境问题 bcc 就是安装不了<br>","like_count":0},{"had_liked":false,"id":342276,"user_name":"Peter","can_delete":false,"product_type":"c1","uid":2425556,"ip_address":"","ucode":"5E57A0FE948966","user_header":"https://static001.geekbang.org/account/avatar/00/25/02/d4/1e0bb504.jpg","comment_is_top":false,"comment_ctime":1650166387,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1650166387","product_id":100020901,"comment_content":"老师，您好，我想问一个场景，比如说线程绑核都是为了解决cache missing的情况，那我怎么能测试在实际业务场景中线程绑核能带来性能优化呢？1、 是不是可以用你这个课程中的思路， 线程绑核前和线程绑核后都去查看下 cachestat 和 cachetop的结果，最终对比下命中结果吗？ 2、还有我觉得这两个工具是不是一般用于针对cache missing优化之后，用来测试是否真的起到了优化","like_count":0},{"had_liked":false,"id":336347,"user_name":"Shelly","can_delete":false,"product_type":"c1","uid":2422713,"ip_address":"","ucode":"75BA35C2737EA6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/BwmyakclnY1ZauxxQ7TbdJY4ZfNpJDxJ1CiaygyyJ1yOhPcmE8CFxy4JzfHzUkGe0bSh7DxcTD3cicxMWcltWs3Q/132","comment_is_top":false,"comment_ctime":1646104552,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646104552","product_id":100020901,"comment_content":"操作系统版本Ubuntu 18.04.1，按照老师的提供的步骤安装cachestat和cachetop,报错了。有人知道怎么解决么？报错如下所示：<br>E: The repository &#39;https:&#47;&#47;repo.iovisor.org&#47;apt&#47;xenial xenial Release&#39; does not have a Release file.<br>N: Updating from such a repository can&#39;t be done securely, and is therefore disabled by default.<br>N: See apt-secure(8) manpage for repository creation and user configuration details.<br>","like_count":0},{"had_liked":false,"id":322444,"user_name":"Issac慜","can_delete":false,"product_type":"c1","uid":1793361,"ip_address":"","ucode":"690B69FC1C0BB2","user_header":"https://static001.geekbang.org/account/avatar/00/1b/5d/51/87fc7ef9.jpg","comment_is_top":false,"comment_ctime":1637389859,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637389859","product_id":100020901,"comment_content":"那如果需要访问的数据不在缓存中，是不是使用直接I&#47;O会更快呢？或者效率是差不多的？<br>因为当访问不存在缓存中的数据时，系统的缺页中断会进入内核更新缓存。","like_count":0},{"had_liked":false,"id":321002,"user_name":"🎉晶晶🎉😄","can_delete":false,"product_type":"c1","uid":1169422,"ip_address":"","ucode":"76B608C42E06A8","user_header":"https://static001.geekbang.org/account/avatar/00/11/d8/0e/1bf7f57a.jpg","comment_is_top":false,"comment_ctime":1636615181,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636615181","product_id":100020901,"comment_content":"运行构建的app容易会报错：standard_init_linux.go:228: exec user process caused: exec format error<br>有没有遇到同类问题的？","like_count":0},{"had_liked":false,"id":317769,"user_name":"1242079399","can_delete":false,"product_type":"c1","uid":2251690,"ip_address":"","ucode":"308D3AB99BE8C9","user_header":"https://static001.geekbang.org/account/avatar/00/22/5b/aa/c324a7de.jpg","comment_is_top":false,"comment_ctime":1634955814,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1634955814","product_id":100020901,"comment_content":"3 warnings and 1 error generated.<br>Traceback (most recent call last):<br>  File &quot;&#47;usr&#47;share&#47;bcc&#47;tools&#47;cachestat&quot;, line 96, in &lt;module&gt;<br>    b = BPF(text=bpf_text)<br>  File &quot;&#47;usr&#47;lib&#47;python2.7&#47;site-packages&#47;bcc&#47;__init__.py&quot;, line 325, in __init__<br>    raise Exception(&quot;Failed to compile BPF text&quot;)<br>Exception: Failed to compile BPF text<br> 执行cachestat 1 1 报错 绝了，我内核都升级到Linux localhost.localdomain 5.14.14-1.el7.elrepo.x86_64 了","like_count":0,"discussions":[{"author":{"id":2593667,"avatar":"https://static001.geekbang.org/account/avatar/00/27/93/83/cb37c46e.jpg","nickname":"cshzet","note":"","ucode":"A343CCB6E5D519","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":569988,"discussion_content":"我也是类似问题，解决了吗，兄弟","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651632296,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2818041,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/ff/f9/cb24284a.jpg","nickname":"gt","note":"","ucode":"DA747875F64C15","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":411006,"discussion_content":"今天遇到一样的问题了，兄弟，问题解决了吗?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635827066,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":305874,"user_name":"Geek_aef4be","can_delete":false,"product_type":"c1","uid":2723576,"ip_address":"","ucode":"F1C3F2AE3CCA0F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epxppZUun6eqepI5hGHjU3fP8yVIicUq7gYRZfR3PoDCMQqd2ia8CmCSa1mIIf6OYGFjbW28RCXmrJQ/132","comment_is_top":false,"comment_ctime":1628216538,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1628216538","product_id":100020901,"comment_content":"OS：CentOS 7<br>很奇怪，我用直接读取的方式是0.2秒，320M，如果用缓存读的话，就是0.49秒，320M，怎么用缓存反而速度慢了呢","like_count":0,"discussions":[{"author":{"id":2660316,"avatar":"https://static001.geekbang.org/account/avatar/00/28/97/dc/8eacc8f1.jpg","nickname":"漠博嵩","note":"","ucode":"33704880E9790F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558539,"discussion_content":"大佬 怎么在centos7上安装","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648372304,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2003869,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/93/9d/1c9d2cd3.jpg","nickname":"一切随遇而安","note":"","ucode":"3C2BE1192FA608","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542852,"discussion_content":"我 Ubuntu 20.4 也是这样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640863425,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":305604,"user_name":"ccz 开发(谢不邀)","can_delete":false,"product_type":"c1","uid":1805809,"ip_address":"","ucode":"B8803B050AAC68","user_header":"","comment_is_top":false,"comment_ctime":1628067791,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1628067791","product_id":100020901,"comment_content":"ubuntu 18.04, 内核版本5.4.0-80-generic，直接apt install的bcc有bug，得使用源码编译的方式安装","like_count":0},{"had_liked":false,"id":299871,"user_name":"Geek_a55bf0","can_delete":false,"product_type":"c1","uid":1463944,"ip_address":"","ucode":"96FCD7B9120CA6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Nv7iaxevWVukvxaZf6TjbcNicgatCUpUcp7hTah0JQxvr7ZjMlLbopEaveichKRLQJjKXR6geB5LBntf7XCP8F4kQ/132","comment_is_top":false,"comment_ctime":1624891009,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624891009","product_id":100020901,"comment_content":"老师，案例二中是磁盘读，用的是buffer吧？","like_count":0},{"had_liked":false,"id":293847,"user_name":"ck","can_delete":false,"product_type":"c1","uid":2070335,"ip_address":"","ucode":"2A0555A3AE862D","user_header":"https://static001.geekbang.org/account/avatar/00/1f/97/3f/761e8b6e.jpg","comment_is_top":false,"comment_ctime":1621575946,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621575946","product_id":100020901,"comment_content":"老师， 本文教了我们一些缓存利用率的指标查看方法，但是实际测试中， 还需要分析如何提高缓存命中的方法。老师可以写一个补充文，介绍一下如何提高吗？","like_count":0},{"had_liked":false,"id":293442,"user_name":"imsorry","can_delete":false,"product_type":"c1","uid":1316930,"ip_address":"","ucode":"7686DACC7B3356","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqSpE7I3EqGFuvHCGFa0YTOpPW9lWSm0qmcheJ4KwkLHUK5X2O13RBDPtEoYQe0WMialuSQAwQIichg/132","comment_is_top":false,"comment_ctime":1621390783,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1621390783","product_id":100020901,"comment_content":"直接IO跳过Buffer那它还会再使用Cache吗。","like_count":0,"discussions":[{"author":{"id":1013424,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/b0/14fec62f.jpg","nickname":"不了峰","note":"","ucode":"E23B96D6A3D4EC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550325,"discussion_content":"不会","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644485353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1924030,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/5b/be/631f41e8.jpg","nickname":"青柠二锅头","note":"","ucode":"5F77053D30B757","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":414258,"discussion_content":"我理解是不会，因为，cache 是文件系统读写数据缓存；buffer 是磁盘读写数据缓存。磁盘读写在文件系统读写之后。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636703809,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":288553,"user_name":"David.cui","can_delete":false,"product_type":"c1","uid":1302228,"ip_address":"","ucode":"AB46F310403612","user_header":"https://static001.geekbang.org/account/avatar/00/13/de/d4/b83c4185.jpg","comment_is_top":false,"comment_ctime":1618537215,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1618537215","product_id":100020901,"comment_content":"O_DIRECT我理解应该是操作系统里面所说的KAIO吧，这个到底是性能增加还是损失呢？数据库上都说是直接IO因为绕过了操作系统的缓存，性能是提升的啊，怎么老师这里测试的是性能降低","like_count":0,"discussions":[{"author":{"id":1013424,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/b0/14fec62f.jpg","nickname":"不了峰","note":"","ucode":"E23B96D6A3D4EC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550327,"discussion_content":"数据库系统有自己的cache 。 比如 oracle  的 buffer cache ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644485391,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1129668,"avatar":"https://static001.geekbang.org/account/avatar/00/11/3c/c4/7c2bf312.jpg","nickname":"草根","note":"","ucode":"7C97CB09A4D8F1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540680,"discussion_content":"操作系统的缓存是内存，比直接读磁盘速度要快。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640136929,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":278734,"user_name":"张婉怡","can_delete":false,"product_type":"c1","uid":1517163,"ip_address":"","ucode":"22CFB6C8940C04","user_header":"","comment_is_top":false,"comment_ctime":1613275550,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1613275550","product_id":100020901,"comment_content":"我们遇到过一个磁盘导致的接口响应时间变长的问题<br>图片按天写入应用本地磁盘，每天30万+图片小文件<br><br>这个当时没有特别详细的分析，通过将写文件操作异步写入obs系统后解决问题，老师是否可以基于这个案例分析一波","like_count":0},{"had_liked":false,"id":275241,"user_name":"Geek_ea821e","can_delete":false,"product_type":"c1","uid":2411665,"ip_address":"","ucode":"9C70C74393A184","user_header":"","comment_is_top":false,"comment_ctime":1611405362,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1611405362","product_id":100020901,"comment_content":"(个人linux小白)centos 安装的bcc, 安装是成功了，但是每一次开机使用时必须先执行source scl_source enable devtoolset-7 llvm-toolset-7    如何把这个语句设置到配置文件里面","like_count":0},{"had_liked":false,"id":268097,"user_name":"Front","can_delete":false,"product_type":"c1","uid":1565396,"ip_address":"","ucode":"35593EA52F2EA6","user_header":"https://static001.geekbang.org/account/avatar/00/17/e2/d4/ef86ea64.jpg","comment_is_top":false,"comment_ctime":1608056201,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1608056201","product_id":100020901,"comment_content":"花了好长时间才解决ubuntu18.04的安装bcc的问题：参考这里https:&#47;&#47;blog.csdn.net&#47;weixin_44395686&#47;article&#47;details&#47;106712543，注意是bcc release 0.14.0。","like_count":0},{"had_liked":false,"id":266387,"user_name":"Kevin关大大","can_delete":false,"product_type":"c1","uid":1371294,"ip_address":"","ucode":"A5CFE39C155CB6","user_header":"https://static001.geekbang.org/account/avatar/00/14/ec/9e/612f2051.jpg","comment_is_top":false,"comment_ctime":1607321545,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607321545","product_id":100020901,"comment_content":"老师，请问下有没有在RHEL、CENTOS上可以使用的工具？我这边公司里机器内核都比较旧，用不了bcc工具。","like_count":0},{"had_liked":false,"id":266140,"user_name":"englefly","can_delete":false,"product_type":"c1","uid":1145907,"ip_address":"","ucode":"E3FCF19E618718","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep2gRIticwS6CiatsCiaU4QRjAODKibQevrhSciatrmd90lNIZFxywE9yyZgAxKTmWiaBSH4zZUcRIV46qQ/132","comment_is_top":false,"comment_ctime":1607182922,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607182922","product_id":100020901,"comment_content":"老师，我使用的ubuntu 18.04，但好像 drop_caches 没有生效，请帮忙看看<br>root@rateup01:&#47;home&#47;server# echo 3 &gt; &#47;proc&#47;sys&#47;vm&#47;drop_caches<br>root@rateup01:&#47;home&#47;server# dd if=file2 of=&#47;dev&#47;null bs=1M <br>7879+0 records in<br>7879+0 records out<br>8261730304 bytes (8.3 GB, 7.7 GiB) copied, 4.36951 s, 1.9 GB&#47;s<br>root@rateup01:&#47;home&#47;server# echo 3 &gt; &#47;proc&#47;sys&#47;vm&#47;drop_caches<br>root@rateup01:&#47;home&#47;server# dd if=file2 of=&#47;dev&#47;null bs=1M <br>7879+0 records in<br>7879+0 records out<br>8261730304 bytes (8.3 GB, 7.7 GiB) copied, 4.33542 s, 1.9 GB&#47;s","like_count":0},{"had_liked":false,"id":265030,"user_name":"道长","can_delete":false,"product_type":"c1","uid":2330999,"ip_address":"","ucode":"15B2E9CEF84634","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/KhQRc8hIxHHyPV3Og2Fc5l8w2y7ibGwGn6odmzl3wTt6fPrNv589uHmia1rgiaZhRiaLVHv9ibhzkxFx1zo42uNIS9A/132","comment_is_top":false,"comment_ctime":1606739344,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1606739344","product_id":100020901,"comment_content":"我这centos 7内核升级为5.9.11后<br>[root@HW_server ~]#  cachestat 1 3<br>In file included from &#47;virtual&#47;main.c:2:<br>In file included from &#47;lib&#47;modules&#47;5.9.11-1.el7.elrepo.x86_64&#47;build&#47;include&#47;uapi&#47;linux&#47;ptrace.h:142:<br>In file included from &#47;lib&#47;modules&#47;5.9.11-1.el7.elrepo.x86_64&#47;build&#47;arch&#47;x86&#47;include&#47;asm&#47;ptrace.h:5:<br>&#47;lib&#47;modules&#47;5.9.11-1.el7.elrepo.x86_64&#47;build&#47;arch&#47;x86&#47;include&#47;asm&#47;segment.h:266:2: error: <br>      expected &#39;(&#39; after &#39;asm&#39;<br>        alternative_io (&quot;lsl %[seg],%[p]&quot;,<br>……<br>Traceback (most recent call last):<br>  File &quot;&#47;usr&#47;share&#47;bcc&#47;tools&#47;cachestat&quot;, line 96, in &lt;module&gt;<br>    b = BPF(text=bpf_text)<br>  File &quot;&#47;usr&#47;lib&#47;python2.7&#47;site-packages&#47;bcc&#47;__init__.py&quot;, line 325, in __init__<br>    raise Exception(&quot;Failed to compile BPF text&quot;)<br>Exception: Failed to compile BPF text<br>","like_count":0,"discussions":[{"author":{"id":2411665,"avatar":"","nickname":"Geek_ea821e","note":"","ucode":"9C70C74393A184","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344261,"discussion_content":"我本地内核升级到5.10.9   按照之前评论的升级内核，安装bcc的时候采用的是编译安装看这篇博客 https://blog.csdn.net/weixin_44395686/article/details/102595552?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromBaidu-1.control&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromBaidu-1.control      我的cmake3.1.8  python2.7   cachetop命令可以","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611374513,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":259092,"user_name":"Geek_c6f05c","can_delete":false,"product_type":"c1","uid":2287203,"ip_address":"","ucode":"C55782050E76F3","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK6Nic6V6iawbbKm3Q8nQoDF5xwZE6ZRV6daDnsoZXFr3ypfETP6CyaC1zmkYiaIcT4FFKBUFDjf3Ngw/132","comment_is_top":false,"comment_ctime":1604629402,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1604629402","product_id":100020901,"comment_content":"请教个问题，这里案例已知app应用一次io读取32M的数据，然后根据缓存命中的大小与之比较，但是在实际的生产过程中如何知道某个应用一次io操作的数据大小呢？","like_count":0,"discussions":[{"author":{"id":1013424,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/b0/14fec62f.jpg","nickname":"不了峰","note":"","ucode":"E23B96D6A3D4EC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550328,"discussion_content":"上面的 stress 可以跟踪到  mmap(NULL, 33558528, ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644485477,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":250107,"user_name":"baymax-me","can_delete":false,"product_type":"c1","uid":2192263,"ip_address":"","ucode":"989494AB215DE7","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ7Fd19uVrF8TbBxKrOMV18HwFGP0BxmrRdRW4WgORhagvqFeG49Cia2Jx9kiafZsLMXId8dg0aLhibQ/132","comment_is_top":false,"comment_ctime":1600937608,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1600937608","product_id":100020901,"comment_content":"[root@localhost unix]# go get github.com&#47;tobert&#47;pcstat&#47;pcstat<br>go: found github.com&#47;tobert&#47;pcstat&#47;pcstat in github.com&#47;tobert&#47;pcstat v0.0.0-20200823205024-32b9e8fbb531<br>[root@localhost unix]# pcstat &#47;bin&#47;ls<br>bash: pcstat: command not found...<br>[root@localhost unix]# <br><br><br>倪老师好，想请教一下您，我在centos7安装了go、pcstat。然后使用pcstat的时候命令行提示：找不到这个command，请问这个是要怎么解决呢？","like_count":0,"discussions":[{"author":{"id":1013424,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/b0/14fec62f.jpg","nickname":"不了峰","note":"","ucode":"E23B96D6A3D4EC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550336,"discussion_content":"tar -zxvf   pcstat-0.0.1-Linux-x86_64.tar.gz\ntar -zxvf   go1.17.6.linux-amd64.tar.gz \ncp pcstat /usr/bin\n\n##就可以直接用了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644486152,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":247846,"user_name":"欧阳洲","can_delete":false,"product_type":"c1","uid":1986708,"ip_address":"","ucode":"94606A6315F2BA","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKT9Tk01eiaQ9aAhszthzGm6lwruRWPXia1YYFozctrdRvKg0Usp8NbwuKBApwD0D6Fty2tib3RdtFJg/132","comment_is_top":false,"comment_ctime":1599890166,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599890166","product_id":100020901,"comment_content":"老师，您好，请教一下：<br>我用的虚拟机Ubuntu18，直接 gcc 编译的 app.c，<br>open的时候不管有没有 O_DIRECT，速度相同，都使用了缓存，<br>是虚拟机不支持O_DIRECT吗，还是。。。","like_count":0},{"had_liked":false,"id":247717,"user_name":"欧阳洲","can_delete":false,"product_type":"c1","uid":1986708,"ip_address":"","ucode":"94606A6315F2BA","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKT9Tk01eiaQ9aAhszthzGm6lwruRWPXia1YYFozctrdRvKg0Usp8NbwuKBApwD0D6Fty2tib3RdtFJg/132","comment_is_top":false,"comment_ctime":1599806412,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599806412","product_id":100020901,"comment_content":"老师，请教一下<br>cachestat和cachetop的命中率数据是仅包含 cache 吗，还是 cache+buffer一起统计的呢，<br>因为下面打印的 MISSES 和 HITS 也没有分cache与buffer。<br>那buffer有命中率的工具吗？<br>","like_count":0},{"had_liked":false,"id":244292,"user_name":"蒋什么奇","can_delete":false,"product_type":"c1","uid":1983316,"ip_address":"","ucode":"6F571617A3BBB4","user_header":"https://static001.geekbang.org/account/avatar/00/1e/43/54/326dbf62.jpg","comment_is_top":false,"comment_ctime":1598452032,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598452032","product_id":100020901,"comment_content":"老师，实际环境中是不可能升级内核的，有没有什么办法从&#47;proc文件中读取到相关数据，然后自己计算Buffer和Cache命中率呢？","like_count":0},{"had_liked":false,"id":236099,"user_name":"生活不如诗","can_delete":false,"product_type":"c1","uid":1139515,"ip_address":"","ucode":"FD48EABEEC52B7","user_header":"https://static001.geekbang.org/account/avatar/00/11/63/3b/c5cd68ab.jpg","comment_is_top":false,"comment_ctime":1595316048,"is_pvip":false,"replies":[{"id":"87247","content":"👍加油","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1595342588,"ip_address":"","comment_id":236099,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1595316048","product_id":100020901,"comment_content":"查看缓存命中率可以使用以下两个工具<br>\t1. cachestat：提供整个系统的缓存读写命中情况；<br>\t2. cachetop：提供了各个进程的系统缓存读写命中情况；<br>\t<br>进程读写速度慢-关于缓存使用的排查思路：<br>\t1. uptime或者top发现负载升高；<br>\t2. top发现%iowait过高，怀疑是磁盘读写缓慢导致进程持续等待数据导致；<br>\t3. 通过dstat或者iostat，iotop等命令查看磁盘读写速率和io占用过高进程；<br>\t4. 通过cachestat查看系统缓存命中率情况，查看是否缓存命中率过低；<br>\t5. 通过cachetop分析指定进程缓存命中率情况，查看是否缓存命中率过低；<br>\t6. 通过strace -p pid追踪进程调用，排查是否是绕过缓存直接读写磁盘导致问题；<br>\t7. 分析程序代码，找到问题；<br><br>\t以上问题同时也可以通过perf工具抓取函数调用来分析问题；<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501943,"discussion_content":"👍加油","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595342588,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":235023,"user_name":"LindaWang","can_delete":false,"product_type":"c1","uid":1800128,"ip_address":"","ucode":"45368868C3980B","user_header":"https://static001.geekbang.org/account/avatar/00/1b/77/c0/22872965.jpg","comment_is_top":false,"comment_ctime":1594871110,"is_pvip":false,"replies":[{"id":"86798","content":"是文件在page cache中的统计信息","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1594905711,"ip_address":"","comment_id":235023,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1594871110","product_id":100020901,"comment_content":"倪老师，pcstat 是查看*指定文件在CPU中的高速缓存的大小*吗？还是只是查看**指定文件在内存中的缓存大小**？内存中也有缓存吗？晕乎了。。求解答","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501582,"discussion_content":"是文件在page cache中的统计信息","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594905711,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":232805,"user_name":"LindaWang","can_delete":false,"product_type":"c1","uid":1800128,"ip_address":"","ucode":"45368868C3980B","user_header":"https://static001.geekbang.org/account/avatar/00/1b/77/c0/22872965.jpg","comment_is_top":false,"comment_ctime":1594121548,"is_pvip":false,"replies":[{"id":"86946","content":"perf 或者生成的火焰图展示的都是函数级的统计，但是要想知道某个函数是不是影响Cache很难，可能需要你自己去实现相应的metrics","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1594995158,"ip_address":"","comment_id":232805,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1594121548","product_id":100020901,"comment_content":"倪老师，请教下：您了解有没有流程级（函数级）Cache行为诊断机制呢？perf测的是进程级别的，粒度太大了","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500774,"discussion_content":"perf 或者生成的火焰图展示的都是函数级的统计，但是要想知道某个函数是不是影响Cache很难，可能需要你自己去实现相应的metrics","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594995158,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":224937,"user_name":"yinghui","can_delete":false,"product_type":"c1","uid":1049545,"ip_address":"","ucode":"57D0064655482F","user_header":"https://static001.geekbang.org/account/avatar/00/10/03/c9/99e14e06.jpg","comment_is_top":false,"comment_ctime":1591597738,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591597738","product_id":100020901,"comment_content":"请问Java程序是否可以直接做裸IO操作。","like_count":0},{"had_liked":false,"id":224671,"user_name":"Roy","can_delete":false,"product_type":"c1","uid":1930723,"ip_address":"","ucode":"909B8B605C317A","user_header":"https://static001.geekbang.org/account/avatar/00/1d/75/e3/ef489d57.jpg","comment_is_top":false,"comment_ctime":1591502378,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591502378","product_id":100020901,"comment_content":"直接I&#47;O读写的目的是什么？如果不使用直接I&#47;O，改为cached读取，会不会存在某些应用场景在安全性或者哪些方面有问题？","like_count":0},{"had_liked":false,"id":224297,"user_name":"jorin@zou","can_delete":false,"product_type":"c1","uid":1564869,"ip_address":"","ucode":"A8CEF7CCF33570","user_header":"https://static001.geekbang.org/account/avatar/00/17/e0/c5/c324a7de.jpg","comment_is_top":false,"comment_ctime":1591339131,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591339131","product_id":100020901,"comment_content":"centos下,配置环境，安装工具花了好多时间，最后还是成功做了实验，学习了不少东西","like_count":0},{"had_liked":false,"id":224296,"user_name":"jorin@zou","can_delete":false,"product_type":"c1","uid":1564869,"ip_address":"","ucode":"A8CEF7CCF33570","user_header":"https://static001.geekbang.org/account/avatar/00/17/e0/c5/c324a7de.jpg","comment_is_top":false,"comment_ctime":1591338610,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1591338610","product_id":100020901,"comment_content":"不懂就问：案例二中，直接IO为什么还会有缓存命中，直接IO的数据，不是直接到磁盘了么？","like_count":0,"discussions":[{"author":{"id":1170843,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/9b/0bc44a78.jpg","nickname":"yyl","note":"","ucode":"1741DACDFCA9AF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295137,"discussion_content":"1. 存在元数据缓存\n2. 直接IO的数据，是绕过缓存，没有绕过文件系统的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596100866,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":220648,"user_name":"普罗米修斯","can_delete":false,"product_type":"c1","uid":1394030,"ip_address":"","ucode":"DDA7DE4DE371FC","user_header":"https://static001.geekbang.org/account/avatar/00/15/45/6e/11cf22de.jpg","comment_is_top":false,"comment_ctime":1590303701,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590303701","product_id":100020901,"comment_content":"涨姿势了，原来内存情况也可以一目了然","like_count":0},{"had_liked":false,"id":213623,"user_name":"ray","can_delete":false,"product_type":"c1","uid":1717235,"ip_address":"","ucode":"10962C711CBC11","user_header":"","comment_is_top":false,"comment_ctime":1588493633,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588493633","product_id":100020901,"comment_content":"老师您好，<br>优化过后的程序cachetop分析，每秒读32M。可是实际用docker logs看到的读取速率是约每0.03秒读取32M，这是不是表示cachetop采样的数据其实比实际使用cache读取到的数据还要更少？<br><br>谢谢老师的解答！","like_count":0},{"had_liked":false,"id":205189,"user_name":"雄鹰","can_delete":false,"product_type":"c1","uid":1786819,"ip_address":"","ucode":"67E0C4BDE7F6F2","user_header":"https://static001.geekbang.org/account/avatar/00/1b/43/c3/2c53acd7.jpg","comment_is_top":false,"comment_ctime":1586568697,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1586568697","product_id":100020901,"comment_content":"这门课程讲的太好了，感觉相见恨晚，要反复认真学，同时多实践，学完该课程，就会为专职性能测试的加分了（我刚入性能测试），可以写辞职报告，找下家了😂😂😂","like_count":0},{"had_liked":false,"id":202367,"user_name":"聪","can_delete":false,"product_type":"c1","uid":1009831,"ip_address":"","ucode":"9D672A8580A945","user_header":"https://static001.geekbang.org/account/avatar/00/0f/68/a7/c3fd1fd9.jpg","comment_is_top":false,"comment_ctime":1585977523,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585977523","product_id":100020901,"comment_content":"我是dev，这章就是纯知识了，知道就可以了。整个教程真的很赞，让我这个dev大开眼界，哈哈哈哈哈","like_count":0},{"had_liked":false,"id":192594,"user_name":"linker","can_delete":false,"product_type":"c1","uid":1803259,"ip_address":"","ucode":"6C5799F2FC2C82","user_header":"https://static001.geekbang.org/account/avatar/00/1b/83/fb/621adceb.jpg","comment_is_top":false,"comment_ctime":1584862447,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584862447","product_id":100020901,"comment_content":"我觉得cpu的平均负载与内存，缓存，都是互相影响的，只有综合考虑才能设计出更优的系统","like_count":0},{"had_liked":false,"id":187042,"user_name":"刘友淙","can_delete":false,"product_type":"c1","uid":1620058,"ip_address":"","ucode":"97F3A69A308313","user_header":"","comment_is_top":false,"comment_ctime":1583998767,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583998767","product_id":100020901,"comment_content":"D8打卡","like_count":0},{"had_liked":false,"id":168311,"user_name":"多弗哥","can_delete":false,"product_type":"c1","uid":1004299,"ip_address":"","ucode":"6E85B33424BFE7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/53/0b/133c0955.jpg","comment_is_top":false,"comment_ctime":1578045288,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1578045288","product_id":100020901,"comment_content":"安装bcc-tools失败，症结在于最后几步编译bcc-tools时克隆libbpf卡死，ctrl+z后make失败","like_count":0,"discussions":[{"author":{"id":1004299,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/0b/133c0955.jpg","nickname":"多弗哥","note":"","ucode":"6E85B33424BFE7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":116100,"discussion_content":"即使直接 yum -y install bcc-tools跑成功，软件包，里的工具也使用不了，还是报错：\nFailed to compile BPD text","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578053557,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1122150,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1f/66/59e0647a.jpg","nickname":"万历十五年","note":"","ucode":"3D8CF5DF847AE8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1004299,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/0b/133c0955.jpg","nickname":"多弗哥","note":"","ucode":"6E85B33424BFE7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":221307,"discussion_content":"centos升级内核后遇到这个问题可能是升级内核时包装的不全，参考前边网友安装bcc的步骤，可以装全所需包","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586001697,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":116100,"ip_address":""},"score":221307,"extra":""}]}]},{"had_liked":false,"id":165583,"user_name":"王圣军","can_delete":false,"product_type":"c1","uid":1395602,"ip_address":"","ucode":"1E13CF683137D1","user_header":"https://static001.geekbang.org/account/avatar/00/15/4b/92/03338a22.jpg","comment_is_top":false,"comment_ctime":1577263873,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577263873","product_id":100020901,"comment_content":"都是直接i&#47;o，怎么还有缓存命中率呢？","like_count":0},{"had_liked":false,"id":157244,"user_name":"ouyangsheng","can_delete":false,"product_type":"c1","uid":1000623,"ip_address":"","ucode":"4D16DA1493453B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/44/af/79cb724c.jpg","comment_is_top":false,"comment_ctime":1575096175,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575096175","product_id":100020901,"comment_content":"缓存命中率用bcc中cachetop，cachestat。pcstat，strace。<br><br>用DIRECT_IO访问是不用缓存。","like_count":0},{"had_liked":false,"id":156797,"user_name":"airmy丶","can_delete":false,"product_type":"c1","uid":1299673,"ip_address":"","ucode":"41959C9F5B4B65","user_header":"https://static001.geekbang.org/account/avatar/00/13/d4/d9/c3296187.jpg","comment_is_top":false,"comment_ctime":1574959133,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1574959133","product_id":100020901,"comment_content":"老师有个疑问，即使是一般的HDD机械硬盘，在随机读写的时候也有100左右的IOPS，按照4K页的大小，5s内应该有 5*100*4&#47;1024 约等于 2M 了，与 0.8M相差了一倍了。不知道是不是这样理解的？","like_count":0},{"had_liked":false,"id":151801,"user_name":"一笔一画","can_delete":false,"product_type":"c1","uid":1495254,"ip_address":"","ucode":"2B9BC8ADF97106","user_header":"https://static001.geekbang.org/account/avatar/00/16/d0/d6/f335954b.jpg","comment_is_top":false,"comment_ctime":1573794381,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573794381","product_id":100020901,"comment_content":"既然缓存I&#47;O这么好，那什么时候该用直接I&#47;O呢？","like_count":0},{"had_liked":false,"id":138578,"user_name":"Geek_e986e3","can_delete":false,"product_type":"c1","uid":1642716,"ip_address":"","ucode":"EF53D2DEA59A8F","user_header":"","comment_is_top":false,"comment_ctime":1570347020,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570347020","product_id":100020901,"comment_content":"老师想问问 我的环境是在vmware里面的ubuntu，宿主机为windows。测试第二个案例的时候发现fix的版本和之前的版本表现的是一样的。这是因为vmware的原因吗？","like_count":0},{"had_liked":false,"id":127722,"user_name":"GaelYang","can_delete":false,"product_type":"c1","uid":1463730,"ip_address":"","ucode":"B8E0B2402A7DCC","user_header":"https://static001.geekbang.org/account/avatar/00/16/55/b2/d70deacf.jpg","comment_is_top":false,"comment_ctime":1566784373,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566784373","product_id":100020901,"comment_content":"有没有什么工具 在内核2.6 或者3.1 能方便的看到 缓存信息","like_count":0},{"had_liked":false,"id":126284,"user_name":"丁小疯","can_delete":false,"product_type":"c1","uid":1631373,"ip_address":"","ucode":"8FD320587FB63C","user_header":"https://static001.geekbang.org/account/avatar/00/18/e4/8d/1c49755d.jpg","comment_is_top":false,"comment_ctime":1566357021,"is_pvip":false,"replies":[{"id":"47202","content":"都是写，但写文件要经过文件系统","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1566743124,"ip_address":"","comment_id":126284,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1566357021","product_id":100020901,"comment_content":"老师，看完后，我有个疑问，写磁盘和写文件有什么区别呢？ 不都是写吗","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463923,"discussion_content":"都是写，但写文件要经过文件系统","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566743124,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":123779,"user_name":"龙小宝","can_delete":false,"product_type":"c1","uid":1321192,"ip_address":"","ucode":"39A3FBD4040508","user_header":"https://static001.geekbang.org/account/avatar/00/14/28/e8/a0936291.jpg","comment_is_top":false,"comment_ctime":1565755246,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565755246","product_id":100020901,"comment_content":"实验最后一步，拉下来您优化后的那个app  最终显示的毒命中不是100%  读写各占50%","like_count":0},{"had_liked":false,"id":120242,"user_name":"乖，摸摸头","can_delete":false,"product_type":"c1","uid":1611745,"ip_address":"","ucode":"BD92741A11D3CD","user_header":"https://static001.geekbang.org/account/avatar/00/18/97/e1/0f4d90ff.jpg","comment_is_top":false,"comment_ctime":1564814045,"is_pvip":true,"replies":[{"id":"44407","content":"&#47;app是容器内部应用的路径，加上选项表示使用不同的磁盘路径（默认是&#47;dev&#47;sda1）。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1565015968,"ip_address":"","comment_id":120242,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1564814045","product_id":100020901,"comment_content":"奇怪了，为何我的 docker run --privileged --name=app -itd feisky&#47;app:io-direct &#47;app -d &#47;dev&#47;vda1 必须要加那个  &#47;app 才能运行成功","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461255,"discussion_content":"/app是容器内部应用的路径，加上选项表示使用不同的磁盘路径（默认是/dev/sda1）。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565015968,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":119824,"user_name":"Freeman","can_delete":false,"product_type":"c1","uid":1580881,"ip_address":"","ucode":"4B8AC8AD312623","user_header":"https://static001.geekbang.org/account/avatar/00/18/1f/51/ff77dc70.jpg","comment_is_top":false,"comment_ctime":1564708671,"is_pvip":false,"replies":[{"id":"44404","content":"available内存也在增加吗？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1565015604,"ip_address":"","comment_id":119824,"utype":1}],"discussion_count":4,"race_medal":0,"score":"1564708671","product_id":100020901,"comment_content":"不知道老师还在不在关注留言区。在生产环境中遇到了一个问题，就是系统的cache不断地增加导致可用内存变少，现在想到的解决办法是定期的drop_cache。程序中不可避免的需要读取文件以及一些io，请问这种还有什么更好的优化方案么？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461088,"discussion_content":"available内存也在增加吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565015604,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1220624,"avatar":"https://static001.geekbang.org/account/avatar/00/12/a0/10/6c8ddac0.jpg","nickname":"张兵","note":"","ucode":"D7A24AF7DC488D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":24879,"discussion_content":"我也遇到同样的问题，目前没有头绪。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570301920,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1580881,"avatar":"https://static001.geekbang.org/account/avatar/00/18/1f/51/ff77dc70.jpg","nickname":"Freeman","note":"","ucode":"4B8AC8AD312623","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4006,"discussion_content":"抱歉，才看到。avaliable也有增加，free在不断减少！cache的不断增加，是因为我每次读取的内容不一样么？程序是有读取stdout的…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565055338,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1580881,"avatar":"https://static001.geekbang.org/account/avatar/00/18/1f/51/ff77dc70.jpg","nickname":"Freeman","note":"","ucode":"4B8AC8AD312623","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4005,"discussion_content":"抱歉，才看到？avaliable也有增加，free在不断减少！cache的不断增加，是因为我每次读取的内容不一样么？程序是有读取stdout的…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565055304,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117473,"user_name":"君哥聊技术","can_delete":false,"product_type":"c1","uid":1325816,"ip_address":"","ucode":"2C9A22BCE4C79E","user_header":"https://static001.geekbang.org/account/avatar/00/14/3a/f8/c1a939e7.jpg","comment_is_top":false,"comment_ctime":1564055425,"is_pvip":false,"replies":[{"id":"43472","content":"是不是cachetop使用的python跟bcc安装使用的python不同？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1564410441,"ip_address":"","comment_id":117473,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1564055425","product_id":100020901,"comment_content":"老师，安装bcc成功，但是运行cachetop时报：ModuleNotFoundError: No module named &#39;bcc&#39;<br>这个有解决方法吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459988,"discussion_content":"是不是cachetop使用的python跟bcc安装使用的python不同？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564410441,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112801,"user_name":"辉晖","can_delete":false,"product_type":"c1","uid":1574062,"ip_address":"","ucode":"E5EC033EE4952B","user_header":"https://static001.geekbang.org/account/avatar/00/18/04/ae/0118c132.jpg","comment_is_top":false,"comment_ctime":1562828334,"is_pvip":false,"replies":[{"id":"41993","content":"可能有两个原因：内核版本&lt;4.4，或者 kernel-devel 版本跟实际运行内核版本不一致","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1563458440,"ip_address":"","comment_id":112801,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1562828334","product_id":100020901,"comment_content":"运行命令会报错Exception: Failed to compile BPF text<br>已经安装kernel-devel了","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457918,"discussion_content":"可能有两个原因：内核版本&amp;lt;4.4，或者 kernel-devel 版本跟实际运行内核版本不一致","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563458440,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1631373,"avatar":"https://static001.geekbang.org/account/avatar/00/18/e4/8d/1c49755d.jpg","nickname":"丁小疯","note":"","ucode":"8FD320587FB63C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5586,"discussion_content":"问下，你最后是怎么解决的呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566364242,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":101936,"user_name":"子非鱼","can_delete":false,"product_type":"c1","uid":1545557,"ip_address":"","ucode":"05EC04408E0863","user_header":"https://static001.geekbang.org/account/avatar/00/17/95/55/08b34e15.jpg","comment_is_top":false,"comment_ctime":1560061950,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560061950","product_id":100020901,"comment_content":"倪老师您好，向您请教个问题，一个进程开启多个线程，每个线程绑定不同的核，主线程定义的全局变量，发现每个线程都备份了一个，不再同步啦。您可以抽时间解释一下吗？","like_count":0},{"had_liked":false,"id":95211,"user_name":"Musisan","can_delete":false,"product_type":"c1","uid":1500498,"ip_address":"","ucode":"A9A9FE56AABEBA","user_header":"https://static001.geekbang.org/account/avatar/00/16/e5/52/35bc9c07.jpg","comment_is_top":false,"comment_ctime":1557987981,"is_pvip":false,"replies":[{"id":"34170","content":"在性能分析思路上，这两个系统没有本质的区别","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1558095527,"ip_address":"","comment_id":95211,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1557987981","product_id":100020901,"comment_content":"老师，我想问下，你为啥不用centos作为案例来分析呢，服务器操作领域这块儿，不说别的，就说公司这边，基本上都是centos，你整一个Ubuntu，第一工具是挺新的，但是不太适合啊，所以还是麻烦建议之后能不能使用centos，或者您告诉我个使用Ubuntu的理由，感觉有些东西和实际能接轨，有些偏差太大了。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450372,"discussion_content":"在性能分析思路上，这两个系统没有本质的区别","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558095527,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580822,"discussion_content":"因为Ubuntu的内核版本一直都比较centos系列高，而且Ubuntu20内核都干到5了。反观centos内核更新太慢了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658386548,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1287774,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a6/5e/b05254a6.jpg","nickname":"Mhy","note":"","ucode":"DE19BCAD1F856E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":269181,"discussion_content":"其实老外挺喜欢用Ubuntu的，和老外有业务合作的话应该有机会接触的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589875373,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86634,"user_name":"薛25","can_delete":false,"product_type":"c1","uid":1219135,"ip_address":"","ucode":"D9F8CDC3C1163A","user_header":"https://static001.geekbang.org/account/avatar/00/12/9a/3f/18c581fd.jpg","comment_is_top":false,"comment_ctime":1555415806,"is_pvip":false,"replies":[{"id":"31286","content":"常用的工具考虑事先装好","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1555500309,"ip_address":"","comment_id":86634,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555415806","product_id":100020901,"comment_content":"emmmmmmm出了问题的系统一般都卡的不行，哪能费这劲装bbc这工具呀。。。。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447104,"discussion_content":"常用的工具考虑事先装好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555500309,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":83927,"user_name":"hola","can_delete":false,"product_type":"c1","uid":1068559,"ip_address":"","ucode":"1872B1B3FCEAFC","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/0f/c43745e7.jpg","comment_is_top":false,"comment_ctime":1554734560,"is_pvip":false,"replies":[{"id":"30375","content":"bcc不支持，可以考虑systemtap动态追踪的方法","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1554815226,"ip_address":"","comment_id":83927,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1554734560","product_id":100020901,"comment_content":"我这里还用的是centos6.8 内核是Linux version 2.6.32-642.el6.x86_64<br>这可咋整？ 怎么查看cache命中率呢","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446179,"discussion_content":"bcc不支持，可以考虑systemtap动态追踪的方法","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554815226,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":82238,"user_name":"让熊猫飞上天","can_delete":false,"product_type":"c1","uid":1348156,"ip_address":"","ucode":"7D6D349B6E3730","user_header":"https://static001.geekbang.org/account/avatar/00/14/92/3c/9116abf4.jpg","comment_is_top":false,"comment_ctime":1554167440,"is_pvip":false,"replies":[{"id":"29852","content":"gzip的内存使用可以通过选项减小的，但压缩过程可能会变慢。除了剩余内存，要关注一下可用内存。推荐数据库服务器多预留一些内存","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1554211689,"ip_address":"","comment_id":82238,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1554167440","product_id":100020901,"comment_content":"你好老师，我问一下我有个系统逻辑核数96，物理内存128G,跑的oracle,现在情况是我的内存free剩余1.2g，里面每天备份会有一个gzip压缩，这个压缩的文件压缩完成后大概9G多点。压缩需要四个多小时，这个gzip进程会占满一个逻辑cpu,,我用top命令排序看内存占用，最大的进程就是这个gzip占用0.3%<br>内存吃的这么多，不知道什么原因。数据库一天时间基本不是很忙","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445520,"discussion_content":"gzip的内存使用可以通过选项减小的，但压缩过程可能会变慢。除了剩余内存，要关注一下可用内存。推荐数据库服务器多预留一些内存","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554211689,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1013424,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/b0/14fec62f.jpg","nickname":"不了峰","note":"","ucode":"E23B96D6A3D4EC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550338,"discussion_content":"oracle 的备份命令中增加 压缩选项。 这样外层就不要再 gzip 了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644486491,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69939,"user_name":"Kepler","can_delete":false,"product_type":"c1","uid":1214303,"ip_address":"","ucode":"0C9CA3DB8B3CF0","user_header":"https://static001.geekbang.org/account/avatar/00/12/87/5f/6bf8b74a.jpg","comment_is_top":false,"comment_ctime":1550911766,"is_pvip":true,"replies":[{"id":"25341","content":"参考一下官方文档 https:&#47;&#47;github.com&#47;iovisor&#47;bcc&#47;blob&#47;master&#47;FAQ.txt","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551194347,"ip_address":"","comment_id":69939,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550911766","product_id":100020901,"comment_content":"鹏飞老师，安装完bcc包之后，执行好多命令（如cachetop, memleak）都报错：<br>ImportError: cannot import name BPF<br>请问是怎么回事呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440365,"discussion_content":"参考一下官方文档 https://github.com/iovisor/bcc/blob/master/FAQ.txt","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551194347,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":67653,"user_name":"Vicky🐣🐣🐣","can_delete":false,"product_type":"c1","uid":1266840,"ip_address":"","ucode":"F659F178A2FF34","user_header":"https://static001.geekbang.org/account/avatar/00/13/54/98/52ca7053.jpg","comment_is_top":false,"comment_ctime":1550217532,"is_pvip":false,"replies":[{"id":"24041","content":"有可能是默认选项里面的磁盘路径不对，请参考 github 设置磁盘路径 https:&#47;&#47;github.com&#47;feiskyer&#47;linux-perf-examples&#47;tree&#47;master&#47;io-cached","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550325934,"ip_address":"","comment_id":67653,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550217532","product_id":100020901,"comment_content":"老师，您好，我运行docker后就自动退出了，请问是什么原因呢？<br># docker run --privileged --name=app -itd feisky&#47;app:io-direct<br>f23a2acf9d6fabc8f9a098fdec515cf609507cf504ae9dc19045fc5bd78fc375<br># docker ps -a<br>CONTAINER ID        IMAGE                  COMMAND                  CREATED             STATUS                      PORTS               NAMES<br>f23a2acf9d6f        feisky&#47;app:io-direct   &quot;&#47;app&quot;                   2 seconds ago       Exited (1) 1 second ago                         app<br># docker logs app<br>日志输出为空","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439306,"discussion_content":"有可能是默认选项里面的磁盘路径不对，请参考 github 设置磁盘路径 https://github.com/feiskyer/linux-perf-examples/tree/master/io-cached","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550325934,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":66002,"user_name":"大飞","can_delete":false,"product_type":"c1","uid":1320080,"ip_address":"","ucode":"2D98888FC63CA9","user_header":"","comment_is_top":false,"comment_ctime":1549848625,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1549848625","product_id":100020901,"comment_content":"打卡<br>","like_count":0},{"had_liked":false,"id":61780,"user_name":"Eric","can_delete":false,"product_type":"c1","uid":1043295,"ip_address":"","ucode":"3F0E90E53C914B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLz2Db6H0jT6EWuqnWlGt7UiaFViaScE6ADdXpU1I5Joh4ea4htIjTR04XoNxj8GA92L13iaSQl1JqHQ/132","comment_is_top":false,"comment_ctime":1547798494,"is_pvip":false,"replies":[{"id":"22572","content":"看错误是少了 -lrt 导致的，清空下环境（比如重新clone）重新编译试试","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548574262,"ip_address":"","comment_id":61780,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547798494","product_id":100020901,"comment_content":"老师好，我的环境是 Centos6.5 ，按照老师给的 github 地址教程，升级了内核，走完了前面每个步骤，在最后编译 bcc 的时候，报错了，这次的错误我实在看不懂，查了 google 也没有头绪，麻烦老师我看看。  由于篇幅有限，我中间删掉了点正常输出信息。<br><br>[ 11%] Building sdist for python<br>running sdist<br>running check<br>warning: sdist: manifest template &#39;MANIFEST.in&#39; does not exist (using default file list)<br>warning: sdist: standard file not found: should have one of README, README.txt<br><br>[ 11%] Building C object introspection&#47;CMakeFiles&#47;bps.dir&#47;bps.c.o<br>[ 12%] Linking C executable bps<br>CMakeFiles&#47;bps.dir&#47;bps.c.o: In function `print_prog_info&#39;:<br>bps.c:(.text+0x32): undefined reference to `clock_gettime&#39;<br>bps.c:(.text+0x13b): undefined reference to `clock_gettime&#39;<br>collect2: error: ld returned 1 exit status<br>make[2]: *** [introspection&#47;bps] Error 1<br>make[1]: *** [introspection&#47;CMakeFiles&#47;bps.dir&#47;all] Error 2<br>make[1]: *** Waiting for unfinished jobs....<br>[ 16%] Linking CXX static library libbcc-loader-static.a<br>[ 16%] Built target bcc-loader-static<br>[ 16%] Building CXX object src&#47;cc&#47;frontends&#47;clang&#47;CMakeFiles&#47;clang_frontend.dir&#47;tp_frontend_action.cc.o<br>[ 17%] Building CXX object src&#47;cc&#47;frontends&#47;b&#47;CMakeFiles&#47;b_frontend.dir&#47;printer.cc.o<br>[ 17%] Building CXX object src&#47;cc&#47;frontends&#47;b&#47;CMakeFiles&#47;b_frontend.dir&#47;type_check.cc.o<br>[ 17%] Building CXX object src&#47;cc&#47;frontends&#47;b&#47;CMakeFiles&#47;b_frontend.dir&#47;lexer.ll.cc.o<br>[ 18%] Building CXX object src&#47;cc&#47;frontends&#47;clang&#47;CMakeFiles&#47;clang_frontend.dir&#47;kbuild_helper.cc.o<br>[ 19%] Linking CXX static library libb_frontend.a<br>[ 19%] Built target b_frontend<br>[ 19%] Building CXX object src&#47;cc&#47;frontends&#47;clang&#47;CMakeFiles&#47;clang_frontend.dir&#47;__&#47;__&#47;common.cc.o<br>[ 20%] Linking CXX static library libclang_frontend.a<br>[ 20%] Built target clang_frontend<br>make: *** [all] Error 2","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436992,"discussion_content":"看错误是少了 -lrt 导致的，清空下环境（比如重新clone）重新编译试试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548574262,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":60334,"user_name":"如果","can_delete":false,"product_type":"c1","uid":1320638,"ip_address":"","ucode":"138A3EEEE50850","user_header":"","comment_is_top":false,"comment_ctime":1547459175,"is_pvip":false,"replies":[{"id":"22298","content":"你的机器性能太好了，增加下 count 试试","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548248500,"ip_address":"","comment_id":60334,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547459175","product_id":100020901,"comment_content":"DAY17,打卡<br>老师请教下：我dd的文件多次读取，命中率基本没有改变，并未变成老师所说的100%<br>如下：<br>[root@localhost ~]# pcstat file <br>+-------+----------------+------------+-----------+---------+<br>| Name  | Size (bytes)   | Pages      | Cached    | Percent |<br>|-------+----------------+------------+-----------+---------|<br>| file  | 419430400      | 102400     | 0         | 000.000 |<br>+-------+----------------+------------+-----------+---------+<br>[root@localhost ~]# dd if=file of=&#47;dev&#47;null bs=1M<br>记录了400+0 的读入<br>记录了400+0 的写出<br>419430400字节(419 MB)已复制，0.861627 秒，487 MB&#47;秒<br>[root@localhost ~]# dd if=file of=&#47;dev&#47;null bs=1M<br>记录了400+0 的读入<br>记录了400+0 的写出<br>419430400字节(419 MB)已复制，0.885821 秒，473 MB&#47;秒<br>[root@localhost ~]# dd if=file of=&#47;dev&#47;null bs=1M<br>记录了400+0 的读入<br>记录了400+0 的写出<br>419430400字节(419 MB)已复制，0.895317 秒，468 MB&#47;秒<br>[root@localhost ~]# dd if=file of=&#47;dev&#47;null bs=1M<br>记录了400+0 的读入<br>记录了400+0 的写出<br>419430400字节(419 MB)已复制，0.949644 秒，442 MB&#47;秒<br>[root@localhost ~]# pcstat file <br>+-------+----------------+------------+-----------+---------+<br>| Name  | Size (bytes)   | Pages      | Cached    | Percent |<br>|-------+----------------+------------+-----------+---------|<br>| file  | 419430400      | 102400     | 29904     | 029.203 |<br>+-------+----------------+------------+-----------+---------+<br> ","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436479,"discussion_content":"你的机器性能太好了，增加下 count 试试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548248500,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58617,"user_name":"xfan","can_delete":false,"product_type":"c1","uid":1315147,"ip_address":"","ucode":"48ED8D498D7F56","user_header":"https://static001.geekbang.org/account/avatar/00/14/11/4b/fa64f061.jpg","comment_is_top":false,"comment_ctime":1547137327,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1547137327","product_id":100020901,"comment_content":"我知道问题在哪了，是我的时间不是1秒，我不该除以5，","like_count":0},{"had_liked":false,"id":57782,"user_name":"kakasir","can_delete":false,"product_type":"c1","uid":1316615,"ip_address":"","ucode":"21F9742D3E63B3","user_header":"https://static001.geekbang.org/account/avatar/00/14/17/07/83f030c9.jpg","comment_is_top":false,"comment_ctime":1546910354,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546910354","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":56835,"user_name":"jssfy","can_delete":false,"product_type":"c1","uid":1137238,"ip_address":"","ucode":"F16353CFE607B7","user_header":"https://static001.geekbang.org/account/avatar/00/11/5a/56/115c6433.jpg","comment_is_top":false,"comment_ctime":1546566177,"is_pvip":false,"replies":[{"id":"21314","content":"早就不用了，4.x应该不再更新了吧","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1547259140,"ip_address":"","comment_id":56835,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546566177","product_id":100020901,"comment_content":"请问centos 4.x 你自己有产品环境用过吗，是否会有坑？如果要保持用3.x版本的话，可以从proc中统计到相应的miss等信息不？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435267,"discussion_content":"早就不用了，4.x应该不再更新了吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547259140,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56376,"user_name":"腾达","can_delete":false,"product_type":"c1","uid":1079876,"ip_address":"","ucode":"72F9CFBA44FDEE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL9hlAIKQ1sGDu16oWLOHyCSicr18XibygQSMLMjuDvKk73deDlH9aMphFsj41WYJh121aniaqBLiaMNg/132","comment_is_top":false,"comment_ctime":1546431985,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546431985","product_id":100020901,"comment_content":"经过若干天的回味，我想再问一个问题，读取文件的某一段的时候，会经过buffer&#47;cache, 如果此时有另外一个进程&#47;线程修改了，恰好修改了该段内容，读的进程&#47;线程是如何保证buffer&#47;cache失效，读取到的是最新的被修改的内容的呢？ ","like_count":0},{"had_liked":false,"id":56307,"user_name":"李逍遥","can_delete":false,"product_type":"c1","uid":1109750,"ip_address":"","ucode":"DB74823527E203","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/xzHDjCSFicNY3MUMECtNz6sM8yDJhBoyGk5IRoOtUat6ZIkGzxjqEqwqKYWMD3GjehScKvMjicGOGDog5FF18oyg/132","comment_is_top":false,"comment_ctime":1546419421,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546419421","product_id":100020901,"comment_content":"写的缓存命中率如何理解<br>","like_count":0},{"had_liked":false,"id":56282,"user_name":"小老鼠","can_delete":false,"product_type":"c1","uid":1257460,"ip_address":"","ucode":"C663A0C863A515","user_header":"https://static001.geekbang.org/account/avatar/00/13/2f/f4/2dede51a.jpg","comment_is_top":false,"comment_ctime":1546415983,"is_pvip":false,"replies":[{"id":"20335","content":"sorry，对suse不熟悉，麻烦网络搜索一下或者试试源码安装","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546445227,"ip_address":"","comment_id":56282,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546415983","product_id":100020901,"comment_content":"我是Suse linux ，如何安排bcc？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434973,"discussion_content":"sorry，对suse不熟悉，麻烦网络搜索一下或者试试源码安装","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546445227,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56279,"user_name":"小老鼠","can_delete":false,"product_type":"c1","uid":1257460,"ip_address":"","ucode":"C663A0C863A515","user_header":"https://static001.geekbang.org/account/avatar/00/13/2f/f4/2dede51a.jpg","comment_is_top":false,"comment_ctime":1546415943,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546415943","product_id":100020901,"comment_content":"我是Suse","like_count":0},{"had_liked":false,"id":55856,"user_name":"allan","can_delete":false,"product_type":"c1","uid":1142819,"ip_address":"","ucode":"CA0BE868AA9FF5","user_header":"https://static001.geekbang.org/account/avatar/00/11/70/23/972dcd30.jpg","comment_is_top":false,"comment_ctime":1546329523,"is_pvip":false,"replies":[{"id":"20277","content":"还有元数据和预读","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546424696,"ip_address":"","comment_id":55856,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546329523","product_id":100020901,"comment_content":"<br>为什么设置了 直接I&#47;O ，还是有一小部分会读缓存？不是应该全部绕过缓存吗？<br><br>看到有同学也有类似疑问，希望老师解答一下。谢谢。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434862,"discussion_content":"还有元数据和预读","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546424696,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55736,"user_name":"似水流年","can_delete":false,"product_type":"c1","uid":1304443,"ip_address":"","ucode":"D114A8E273133C","user_header":"https://static001.geekbang.org/account/avatar/00/13/e7/7b/71da8283.jpg","comment_is_top":false,"comment_ctime":1546273431,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546273431","product_id":100020901,"comment_content":"老师，我的cachestat命令安装不了，使用和安装情况如下：麻烦解答一下。<br>ding@docker:~$ cachestat 1 3<br><br>Command &#39;cachestat&#39; not found, did you mean:<br><br>  command &#39;cachestats&#39; from deb nocache<br><br>Try: sudo apt install &lt;deb name&gt;<br><br>ding@docker:~$ sudo apt install cachestat<br>Reading package lists... Done<br>Building dependency tree       <br>Reading state information... Done<br>E: Unable to locate package cachestat<br>","like_count":0},{"had_liked":false,"id":55388,"user_name":"白华","can_delete":false,"product_type":"c1","uid":1315666,"ip_address":"","ucode":"FC9BACFCA6E8C1","user_header":"https://static001.geekbang.org/account/avatar/00/14/13/52/db1b01fc.jpg","comment_is_top":false,"comment_ctime":1546156011,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1546156011","product_id":100020901,"comment_content":"老师，我下载pcstat遇到了困难。使用你设置代理方式也无法下载那个go项目啊，我有另一种方法，把项目从GitHub上clone下来，然后允许go get github.com&#47;tobert&#47;pcstat&#47;pcstat  直接没有任何反应，理论上是把该软件下载下来了，但是并没有找到这个软件","like_count":0,"discussions":[{"author":{"id":1104177,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d9/31/e58f2fb0.jpg","nickname":"ranger2","note":"","ucode":"59F15FFB511161","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":74814,"discussion_content":"应该是在你本地的主目录下创建了一个go/bin目录，pcstat就在里面，你可以把它拷贝到 /usr/bin目录下；当然也可以不用这么安装，直接从网上找一个pcstat放到/usr/bin目录下就可以用了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575690446,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55374,"user_name":"腾达","can_delete":false,"product_type":"c1","uid":1079876,"ip_address":"","ucode":"72F9CFBA44FDEE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL9hlAIKQ1sGDu16oWLOHyCSicr18XibygQSMLMjuDvKk73deDlH9aMphFsj41WYJh121aniaqBLiaMNg/132","comment_is_top":false,"comment_ctime":1546151929,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546151929","product_id":100020901,"comment_content":"我做实验的时候发现几个问题，在解释“至于为什么只能看到 0.8 MB 的 HITS，我们后面再解释“ 这里好像解释的不太清楚。每个人的机器不太一样。虚拟机添加磁盘很方便，一块新添加的磁盘与一块旧磁盘比起来差很多。比如，一块新磁盘sdc，默认32M读取，执行 .&#47;io-direct -d &#47;dev&#47;sdc -s 33554432 的时候，HIT常稳定在4096，算下来刚好是32M&#47;s。会发现，即使不用buffer，也达到了用buffer的效果。如果加大每次读取的大小，改为读取320M，.&#47;io-direct -d &#47;dev&#47;sdc -s 335544320，HIT会变化，算下来，读取速率达不到320M&#47;s，大概在250M&#47;s，这样可以解释老师所说的0.8比32M&#47;s小很多，我这里大概是250M&#47;s比320M&#47;s差一些。如果用旧盘，比如sda，则数据也会不太一样。<br><br>下面是2个我运行的对比结果： HITS上差异比较大<br>.&#47;io-direct -d &#47;dev&#47;sda -s 335544320<br>.&#47;io-fix -d &#47;dev&#47;sda -s 335544320<br><br>    PID   UID      CMD              HITS     MISSES   DIRTIES  READ_HIT%  WRITE_HIT% <br>   8053 root     io-direct          81920        0        0     100.0%       0.0%<br>   8052 root     io-fix               255769        0        0     100.0%       0.0%<br><br><br>","like_count":0},{"had_liked":false,"id":55265,"user_name":"Geek_60821e","can_delete":false,"product_type":"c1","uid":1316693,"ip_address":"","ucode":"A55F71113AEEA4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJTqaqppkyn9avZHqCnONVJ2Cwp9fmr7yQqUB8icRMFgCbYEHPAyogHqfYjgKPQBteKxnEKQHJzDmQ/132","comment_is_top":false,"comment_ctime":1546082742,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546082742","product_id":100020901,"comment_content":"读文件向redis中写入1g大小的数据(同一个块设备上)，统计结果:<br>1 用vmstat统计bi值一直为0,但bo有k级值<br>2 用iostat统计w&#47;s有几百的值，r&#47;s值一直为0<br>问题:1这两工具统计出来结果是反的？都有问题？<br>2 我觉的应该读写都能统计到数值才对？","like_count":0},{"had_liked":false,"id":55204,"user_name":"javaworker","can_delete":false,"product_type":"c1","uid":1056209,"ip_address":"","ucode":"ABF9DDDBD3BDBF","user_header":"https://static001.geekbang.org/account/avatar/00/10/1d/d1/f427b83e.jpg","comment_is_top":false,"comment_ctime":1546065156,"is_pvip":true,"replies":[{"id":"20016","content":"怀疑证书问题，可以用openssl工具在两台机器上验证对比，看看有什么不同。具体方法可以网络搜索一下","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546075598,"ip_address":"","comment_id":55204,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546065156","product_id":100020901,"comment_content":"老师，请教个问题，公司现在有两个环境，都是linux的（环境A和环境B），同样的代码都是调用华为jdk发推送，在环境A中就正常，手机能收到推送。在环境B中，发华为推送，发10笔也就能成功收到5笔，收不到的日志里回报一个ssl的错误，和公司说是网络有问题或者证书有问题，公司网络部非说两个环境配置都是一样的，这个我如何能在跟踪一下环境B发推送是到底是哪部有问题？能给网络部一个明确的证据证明呢？请指教一二，谢谢","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434698,"discussion_content":"怀疑证书问题，可以用openssl工具在两台机器上验证对比，看看有什么不同。具体方法可以网络搜索一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546075598,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55154,"user_name":"白华","can_delete":false,"product_type":"c1","uid":1315666,"ip_address":"","ucode":"FC9BACFCA6E8C1","user_header":"https://static001.geekbang.org/account/avatar/00/14/13/52/db1b01fc.jpg","comment_is_top":false,"comment_ctime":1546053146,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546053146","product_id":100020901,"comment_content":"在centos7上bcc-tools的安装方法我写在了这里：https:&#47;&#47;www.jianshu.com&#47;p&#47;997e0a6d8e09  大家可以看下","like_count":0},{"had_liked":false,"id":55028,"user_name":"淸曉","can_delete":false,"product_type":"c1","uid":1332899,"ip_address":"","ucode":"6E63DA4E29FE09","user_header":"https://static001.geekbang.org/account/avatar/00/14/56/a3/649d861c.jpg","comment_is_top":false,"comment_ctime":1546003832,"is_pvip":false,"replies":[{"id":"19959","content":"刚刚试了已经可以了","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546007396,"ip_address":"","comment_id":55028,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546003832","product_id":100020901,"comment_content":"今天llvm.org一直都访问不了，centos都没办法安装，今天都没好好学！","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434654,"discussion_content":"刚刚试了已经可以了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546007396,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55000,"user_name":"向前看","can_delete":false,"product_type":"c1","uid":1248919,"ip_address":"","ucode":"5FB10D4A17A864","user_header":"https://static001.geekbang.org/account/avatar/00/13/0e/97/c49d843c.jpg","comment_is_top":false,"comment_ctime":1545998803,"is_pvip":false,"replies":[{"id":"19918","content":"dirties是脏页，也就是已经在缓存中并且被进程修改过的内存页，这些页还没有刷到磁盘中","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546002908,"ip_address":"","comment_id":55000,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545998803","product_id":100020901,"comment_content":"老师有个不解的地方，望解答，谢谢<br>现在有个不解的地方是在计算misses 页面数的时候：<br>        if re.match(b&#39;mark_page_accessed&#39;, b.ksym(k.ip)) is not None:<br>            mpa = max(0, v.value)<br><br>        if re.match(b&#39;mark_buffer_dirty&#39;, b.ksym(k.ip)) is not None:<br>            mbd = max(0, v.value)<br><br>        if re.match(b&#39;add_to_page_cache_lru&#39;, b.ksym(k.ip)) is not None:<br>            apcl = max(0, v.value)<br><br>        if re.match(b&#39;account_page_dirtied&#39;, b.ksym(k.ip)) is not None:<br>            apd = max(0, v.value)<br><br>        # total = total cache accesses without counting dirties<br>        # misses = total of add to lru because of read misses<br>        total = (mpa - mbd)<br>        misses = (apcl - apd)<br>用add_to_page_cache_lru 页面的数量减去account_page_dirtied 页面数量<br>但是在执行account_page_dirtied的时候页面已经在基数树里面了，这样做有什么意义呢？<br>注释说misses = total of add to lru because of read misses<br>难道account_page_dirtied代表写miss？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434646,"discussion_content":"dirties是脏页，也就是已经在缓存中并且被进程修改过的内存页，这些页还没有刷到磁盘中","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546002908,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54948,"user_name":"白华","can_delete":false,"product_type":"c1","uid":1315666,"ip_address":"","ucode":"FC9BACFCA6E8C1","user_header":"https://static001.geekbang.org/account/avatar/00/14/13/52/db1b01fc.jpg","comment_is_top":false,"comment_ctime":1545986962,"is_pvip":false,"replies":[{"id":"19916","content":"好的，我整理下放到答疑篇中","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546002441,"ip_address":"","comment_id":54948,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545986962","product_id":100020901,"comment_content":"老师，centos7版本安装这个软件能不能出个文章，看github上的安装教程有些乱，百度看文章也很少，需要下载的内容有很多都无法下载，根本无法进行试验操作","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434627,"discussion_content":"好的，我整理下放到答疑篇中","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546002441,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54943,"user_name":"DJH","can_delete":false,"product_type":"c1","uid":1256740,"ip_address":"","ucode":"2BDEF123B3DB6A","user_header":"https://static001.geekbang.org/account/avatar/00/13/2d/24/28acca15.jpg","comment_is_top":false,"comment_ctime":1545985938,"is_pvip":false,"replies":[{"id":"19919","content":"是的，下载 golang.org 的包需要使用代理，设置方法是：<br><br>git config [--global] http.proxy http:&#47;&#47;proxy.example.com:port","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546002924,"ip_address":"","comment_id":54943,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545985938","product_id":100020901,"comment_content":"pcstat装不上，难道要翻墙？<br><br>root@perf-ubuntu:&#47;tmp# export GOPATH=~&#47;go<br>root@perf-ubuntu:&#47;tmp# export PATH=~&#47;go&#47;bin:$PATH<br>root@perf-ubuntu:&#47;tmp# go get golang.org&#47;x&#47;sys&#47;unix<br>package golang.org&#47;x&#47;sys&#47;unix: unrecognized import path &quot;golang.org&#47;x&#47;sys&#47;unix&quot; (https fetch: Get https:&#47;&#47;golang.org&#47;x&#47;sys&#47;unix?go-get=1: dial tcp 216.239.37.1:443: i&#47;o timeout)<br>root@perf-ubuntu:&#47;tmp# go get github.com&#47;tobert&#47;pcstat&#47;pcstat<br><br># cd .; git clone https:&#47;&#47;github.com&#47;tobert&#47;pcstat &#47;root&#47;go&#47;src&#47;github.com&#47;tobert&#47;pcstat<br>Cloning into &#39;&#47;root&#47;go&#47;src&#47;github.com&#47;tobert&#47;pcstat&#39;...<br>error: RPC failed; curl 56 GnuTLS recv error (-54): Error in the pull function.<br>fatal: The remote end hung up unexpectedly<br>fatal: early EOF<br>fatal: index-pack failed<br>package github.com&#47;tobert&#47;pcstat&#47;pcstat: exit status 128<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434624,"discussion_content":"是的，下载 golang.org 的包需要使用代理，设置方法是：\n\ngit config [--global] http.proxy http://proxy.example.com:port","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546002924,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54942,"user_name":"赵强强","can_delete":false,"product_type":"c1","uid":1073596,"ip_address":"","ucode":"1B8AE07484C69A","user_header":"https://static001.geekbang.org/account/avatar/00/10/61/bc/88a905a5.jpg","comment_is_top":false,"comment_ctime":1545985907,"is_pvip":false,"replies":[{"id":"19920","content":"在存储系统、数据库系统中比较多","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546003220,"ip_address":"","comment_id":54942,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545985907","product_id":100020901,"comment_content":"倪老师，实际开发中，那些场景会涉及到直接读写磁盘，而不是读写文件呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434623,"discussion_content":"在存储系统、数据库系统中比较多","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546003220,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54924,"user_name":"淸曉","can_delete":false,"product_type":"c1","uid":1332899,"ip_address":"","ucode":"6E63DA4E29FE09","user_header":"https://static001.geekbang.org/account/avatar/00/14/56/a3/649d861c.jpg","comment_is_top":false,"comment_ctime":1545982351,"is_pvip":false,"replies":[{"id":"19921","content":"llvm.org 可以访问的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546003245,"ip_address":"","comment_id":54924,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1545982351","product_id":100020901,"comment_content":"安装bcc会用到llvm,但LLVM网站访问不到，已经无法下载，该怎么办？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434614,"discussion_content":"llvm.org 可以访问的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546003245,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580824,"discussion_content":"翻墙下载","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658386662,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54876,"user_name":"唯美","can_delete":false,"product_type":"c1","uid":1263430,"ip_address":"","ucode":"9186A5B99DFBCA","user_header":"https://static001.geekbang.org/account/avatar/00/13/47/46/61f16147.jpg","comment_is_top":false,"comment_ctime":1545975172,"is_pvip":false,"replies":[{"id":"19923","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546003261,"ip_address":"","comment_id":54876,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545975172","product_id":100020901,"comment_content":"打卡17Day","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434595,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546003261,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54718,"user_name":"风飘，吾独思","can_delete":false,"product_type":"c1","uid":1131032,"ip_address":"","ucode":"4DF0E7DC22EE53","user_header":"https://static001.geekbang.org/account/avatar/00/11/42/18/edc1b373.jpg","comment_is_top":false,"comment_ctime":1545957125,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545957125","product_id":100020901,"comment_content":"打开","like_count":0},{"had_liked":false,"id":54717,"user_name":"Linuxer","can_delete":false,"product_type":"c1","uid":1153978,"ip_address":"","ucode":"272D9D8089C3D6","user_header":"https://static001.geekbang.org/account/avatar/00/11/9b/ba/333b59e5.jpg","comment_is_top":false,"comment_ctime":1545957116,"is_pvip":false,"replies":[{"id":"19938","content":"Cranliu是舍韦什么？分享一下？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546005122,"ip_address":"","comment_id":54717,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545957116","product_id":100020901,"comment_content":"Cranliu IBM红皮书中应该有","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434543,"discussion_content":"Cranliu是舍韦什么？分享一下？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546005122,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54715,"user_name":"Linuxer","can_delete":false,"product_type":"c1","uid":1153978,"ip_address":"","ucode":"272D9D8089C3D6","user_header":"https://static001.geekbang.org/account/avatar/00/11/9b/ba/333b59e5.jpg","comment_is_top":false,"comment_ctime":1545957003,"is_pvip":false,"replies":[{"id":"19937","content":"没有现成的工具，如果熟悉systemtap，或许用它来写一个","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546005052,"ip_address":"","comment_id":54715,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545957003","product_id":100020901,"comment_content":"因为这种问题不一定都在高版本的内核中出现，如果想在监控缓存命中率请问有什么工具可用。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434542,"discussion_content":"没有现成的工具，如果熟悉systemtap，或许用它来写一个","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546005052,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54714,"user_name":"袁庆","can_delete":false,"product_type":"c1","uid":1000808,"ip_address":"","ucode":"115E69A50BF375","user_header":"https://static001.geekbang.org/account/avatar/00/0f/45/68/ef7d72ff.jpg","comment_is_top":false,"comment_ctime":1545956806,"is_pvip":false,"replies":[{"id":"19939","content":"把Redis作为数据存储的缓存使用。我们后面IO部分也有Redis的案例","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546005183,"ip_address":"","comment_id":54714,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545956806","product_id":100020901,"comment_content":"倪老师，怎样用redis提升缓存应用效率？能详细讲讲么？谢谢！","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434541,"discussion_content":"把Redis作为数据存储的缓存使用。我们后面IO部分也有Redis的案例","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546005183,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54709,"user_name":"Cranliu","can_delete":false,"product_type":"c1","uid":1304302,"ip_address":"","ucode":"DC2DE84B142FDA","user_header":"https://static001.geekbang.org/account/avatar/00/13/e6/ee/e3c4c9b3.jpg","comment_is_top":false,"comment_ctime":1545956054,"is_pvip":false,"replies":[{"id":"19940","content":"IO模块讲","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546005192,"ip_address":"","comment_id":54709,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545956054","product_id":100020901,"comment_content":"老师能给一下各种磁盘类型的吞吐量以及IOPS吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434540,"discussion_content":"IO模块讲","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546005192,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}