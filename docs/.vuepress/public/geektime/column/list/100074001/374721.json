{"id":374721,"title":"25 | å®¹é‡åœºæ™¯ä¹‹äºŒï¼šç¼“å­˜å¯¹æ€§èƒ½ä¼šæœ‰ä»€ä¹ˆæ ·çš„å½±å“ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯é«˜æ¥¼ã€‚</p><p>ä¸ŠèŠ‚è¯¾ï¼Œæˆ‘ä»¬ç»å†äº†ä¸‰ä¸ªé˜¶æ®µçš„åˆ†æä¼˜åŒ–ï¼Œåˆ†åˆ«è§£å†³äº†åœ¨å‹åŠ›çº¿ç¨‹ä¸å˜çš„æƒ…å†µä¸‹ï¼Œå“åº”æ—¶é—´éšæ—¶é—´å¢åŠ è€Œå¢åŠ çš„é—®é¢˜ï¼Œè¿˜æœ‰æ•°æ®åº“åŠ ç´¢å¼•çš„é—®é¢˜ï¼Œä»¥åŠKubernetesè°ƒåº¦ä¸å‡è¡¡çš„é—®é¢˜ã€‚æœ€åï¼ŒTPSæ›²çº¿çœ‹èµ·æ¥æŒºæ­£å¸¸äº†ï¼Œä½†æ˜¯å‘½è¿ä¸ä¼šå› ä¸ºæˆ‘åŠªåŠ›äº†å°±ä¼šæ”¾è¿‡æˆ‘ã€‚</p><p>ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿå› ä¸ºåœ¨ä¸ŠèŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬çš„åœºæ™¯åªæŒç»­äº†åå‡ åˆ†é’Ÿï¼Œå¯¹äºå®¹é‡åœºæ™¯æ¥è¯´ï¼Œæ—¶é—´è¿˜æ˜¯ä¸å¤Ÿé•¿ã€‚ä½ çŸ¥é“ï¼Œå‹åŠ›æŒç»­åå‡ åˆ†é’Ÿï¼Œä¸”TPSæ˜¾ç¤ºæ­£å¸¸ï¼Œå¹¶ä¸èƒ½è¯´æ˜ç³»ç»Ÿæ²¡æœ‰é—®é¢˜ã€‚</p><p>å› æ­¤ï¼Œæˆ‘åˆå¯¹ç³»ç»Ÿè¿›è¡ŒæŒç»­çš„å‹åŠ›æµ‹è¯•ï¼Œå°±æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œåˆé‡åˆ°äº†æ–°çš„é—®é¢˜â€¦â€¦</p><h2>ç¬¬å››é˜¶æ®µåˆ†æ</h2><h3>åœºæ™¯å‹åŠ›æ•°æ®</h3><p>è¿™æ˜¯æˆ‘åœ¨è¿›è¡ŒæŒç»­åŠ å‹è¿‡ç¨‹ä¸­ï¼Œå¾—åˆ°çš„åœºæ™¯æ•°æ®ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/a0/ea/a0408ff35e086996e13f4218ca4c26ea.png?wh=1828*833\" alt=\"\"></p><p>çœ‹ä¸Šé¢çš„æ›²çº¿å›¾å°±èƒ½çŸ¥é“ï¼Œè¿™æ˜¯åœ¨å‹åŠ›æŒç»­çš„è¿‡ç¨‹ä¸­ï¼Œå‡ºç°äº†TPSæ‰ä¸‹æ¥çš„é—®é¢˜ï¼Œè¿™æ˜¯ä¸èƒ½æ¥å—çš„ã€‚</p><h3>æ‹†åˆ†å“åº”æ—¶é—´</h3><p>é’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ç°åœ¨çš„æ—¶é—´æ¶ˆè€—ã€‚è¿™æ˜¯å·²ç»è¿è¡Œäº†ä¸€æ®µæ—¶é—´çš„å“åº”æ—¶é—´å›¾ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/18/c6/1858074580cc743b6259726e03de2ac6.png?wh=914*294\" alt=\"\"></p><p>æˆ‘ä»¬å¯ä»¥æ ¹æ®æ•´ä½“çš„å¹³å‡å“åº”æ—¶é—´ï¼Œä¸€ä¸ªä¸ªåˆ†æè¿™äº›æ¥å£çš„æ—¶é—´æ¶ˆè€—åœ¨äº†å“ªé‡Œã€‚å…¶å®ï¼Œä»è¿™å¼ å›¾å°±èƒ½çœ‹å‡ºï¼Œæ‰€æœ‰çš„ä¸šåŠ¡æ—¶é—´ç›¸æ¯”ä¸Šä¸€èŠ‚è¯¾çš„å“åº”æ—¶é—´å›¾éƒ½å¢åŠ äº†ã€‚ç”±äºæ‰€æœ‰ä¸šåŠ¡çš„å“åº”æ—¶é—´éƒ½å¢åŠ äº†ï¼Œè¯´æ˜ä¸æ˜¯æŸä¸ªä¸šåŠ¡æœ¬èº«çš„é—®é¢˜ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ä»»æ„åˆ†æä¸€ä¸ªæ¥å£å°±å¯ä»¥ã€‚</p><p>è¿™é‡Œæˆ‘ç”¨ç”Ÿæˆç¡®è®¤è®¢å•è¿™ä¸ªæ¥å£åšæ—¶é—´æ‹†åˆ†ã€‚åœ¨ä¹‹å‰éƒ¨ç½²ç³»ç»Ÿçš„æ—¶å€™ï¼Œæˆ‘ä»¬æŠŠSkyWalkingé‡‡æ ·ç‡è®¾ç½®å¾—éå¸¸ä½ï¼Œåªæœ‰5%å·¦å³ï¼Œç›®çš„ä¸ºäº†ä¸è®©APMå½±å“æ€§èƒ½å’Œç½‘ç»œã€‚</p><!-- [[[read_end]]] --><p>ä¸‹é¢è¿™äº›æ•°æ®æ˜¯æŒ‰åˆ†é’Ÿå¹³å‡çš„ã€‚</p><ul>\n<li>\n<p>Gatewayï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/57/58/5764d379eb0cd29cc19f506047430758.png?wh=334*178\" alt=\"\"></p>\n</li>\n<li>\n<p>Orderï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/ac/f8/ac07769yyaa61dbcf4cddd92c5dff0f8.png?wh=321*185\" alt=\"\"></p>\n</li>\n<li>\n<p>Cartï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/55/3d/556ab449aa47a27fda1f52bb1195a73d.png?wh=315*179\" alt=\"\"></p>\n</li>\n<li>\n<p>Memberï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/8d/e5/8d43f0322dae23b3bd6c20665a88b1e5.png?wh=328*176\" alt=\"\"></p>\n</li>\n<li>\n<p>Authï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/67/1f/6735e1e63f7fca798bd17160c11ab51f.png?wh=327*188\" alt=\"\"></p>\n</li>\n</ul><p>ä»æ•°æ®ä¸Šæ¥çœ‹ï¼Œä¼¼ä¹æ¯ä¸ªæœåŠ¡éƒ½å’Œæ•´ä½“å“åº”æ—¶é—´æ…¢æœ‰å…³ã€‚æ‚²å‚¬çš„åœºæ™¯æ€»æ˜¯è¿™æ ·ã€‚</p><p>ä¸è¿‡ï¼Œåˆ«æ…Œå¼ ï¼Œæˆ‘ä»¬ä»ç„¶æŒ‰ç…§å…¨å±€åˆ°å®šå‘çš„åˆ†ææ€è·¯æ¥èµ°å°±å¯ä»¥äº†ã€‚æˆ‘ä»¬å…ˆçœ‹å…¨å±€ç›‘æ§æ•°æ®ã€‚</p><h3>å…¨å±€ç›‘æ§åˆ†æ</h3><p>ä»å…¨å±€ç›‘æ§çš„ç¬¬ä¸€ä¸ªç•Œé¢æ¥çœ‹ï¼Œworker-4ä¸Šçš„CPUèµ„æºä½¿ç”¨æ¯”è¾ƒé«˜ï¼Œå…¶æ¬¡æ˜¯worker-6ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/97/05/97a61841d5791f036592d36f997d8e05.png?wh=1829*461\" alt=\"\"></p><p>æˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªæ¥æ”¶æ‹¾ã€‚</p><p>æˆ‘ä»¬å…ˆè¿›å…¥åˆ°worker-4ä¸­ï¼Œæ‰§è¡Œtop/vmstatå‘½ä»¤ï¼Œæˆªå–åˆ°ä¸€äº›é‡è¦çš„æ•°æ®ï¼Œä¸‹é¢è¿™äº›æ˜¯worker-4è¿™ä¸ªèŠ‚ç‚¹æ›´ä¸ºè¯¦ç»†çš„å…¨å±€ç›‘æ§æ•°æ®ï¼š</p><pre><code>-- vmstatçš„æ•°æ®\nprocs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\n â€‹r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa s\n12  0      0 4484940   1100 4184984    0    0     0     0 45554 21961 58 25 14  0  3\n 9  0      0 4484460   1100 4185512    0    0     0     0 45505 20851 60 25 14  0  1\n16  0      0 4483872   1100 4186016    0    0     0     0 44729 20750 62 24 12  0  2\n15  0      0 4470944   1100 4186476    0    0     0     0 45309 25481 62 24 13  0  2\n14  0      0 4431336   1100 4186972    0    0     0     0 48380 31344 60 25 14  0  1\n16  0      0 4422728   1100 4187524    0    0     0     0 46735 27081 64 24 12  0  1\n17  0      0 4412468   1100 4188004    0    0     0     0 45928 23809 60 25 13  0  2\n22  0      0 4431204   1100 4188312    0    0     0     0 46013 24588 62 23 13  0  1\n12  0      0 4411116   1100 4188784    0    0     0     0 49371 34817 59 24 15  0  2\n16  1      0 4406048   1100 4189016    0    0     0     0 44410 21650 66 23 10  0  1\n..................\n\n\n--- topçš„æ•°æ®\n  â€‹PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                                                 \n  935 root      20   0 6817896   1.3g  16388 S 301.7  8.7  71:26.27 java -Dapp.id=svc-mall-gateway -javaagent:/opt/skywalking/agent/skywalking-agent.jar -Dskywalking.agent.service_name=svc+\n 1009 101       20   0   13500   2980    632 R  37.6  0.0  10:13.51 nginx: worker process                                                                                                    \n 1007 101       20   0   13236   2764    632 R  20.8  0.0   3:17.14 nginx: worker process                                                                                                    \n 7690 root      20   0 3272448   3.0g   1796 S  14.2 19.1   2:58.31 redis-server 0.0.0.0:6379                                                                                                \n 6545 101       20   0  737896  48804  12640 S  13.9  0.3  12:36.09 /nginx-ingress -nginx-configmaps=nginx-ingress/nginx-config -default-server-tls-secret=nginx-ingress/default-server-secr+\n 1108 root      20   0 1423104 106236  29252 S  12.2  0.7  16:28.02 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock                                                   \n 1008 101       20   0   13236   2760    628 S   6.9  0.0   0:46.30 nginx: worker process                                                                                                    \n 6526 root      20   0  109096   8412   2856 S   6.3  0.1   7:30.98 containerd-shim -namespace moby -workdir /var/lib/containerd/io.containerd.runtime.v1.linux/moby/6eb72c56b028b0d5bd7f8df+\n 1082 root      20   0 3157420 116036  36328 S   5.3  0.7  11:15.65 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf+\n 6319 nfsnobo+  20   0  759868  53880  18896 S   3.0  0.3   3:18.33 grafana-server --homepath=/usr/share/grafana --config=/etc/grafana/grafana.ini --packaging=docker cfg:default.log.mode=c+\n 6806 root      20   0 1632160  47276  17108 S   2.6  0.3   5:09.43 calico-node -felix                                                                                                       \n    6 root      20   0       0      0      0 S   1.0  0.0   0:14.19 [ksoftirqd/0] \n..................\n</code></pre><p>ä»vmstatçš„inåˆ—å¯ä»¥çœ‹å‡ºï¼Œç³»ç»Ÿçš„ä¸­æ–­æ•°æ¯”è¾ƒé«˜ï¼›ä»vmstatä¸­çš„csï¼ˆcontext switchï¼‰æ¥çœ‹ï¼ŒCSä¹Ÿè¾¾åˆ°äº†3ä¸‡å·¦å³ã€‚åŒæ—¶ï¼Œsy cpuï¼ˆsyscallæ¶ˆè€—çš„CPUï¼‰ä¹Ÿå åˆ°äº†25%å·¦å³ã€‚è¿™å°±è¯´æ˜æˆ‘ä»¬éœ€è¦ç€é‡å…³æ³¨syscallï¼ˆç³»ç»Ÿè°ƒç”¨ï¼‰å±‚é¢ã€‚</p><h3>å®šå‘ç›‘æ§åˆ†æ</h3><p>æˆ‘ä»¬å…ˆæŸ¥çœ‹ä¸­æ–­æ•°æ®ï¼Œä¸‹é¢è¿™å¼ å›¾å°±æ˜¯å…¨éƒ¨çš„ä¸­æ–­æ•°æ®æˆªå›¾ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/0b/1b/0bfyy6b43928554d94eaf83dd44yyd1b.png?wh=1287*926\" alt=\"\"></p><p>è™½ç„¶ä»è¿™å¼ å›¾é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•´ä½“çš„ä¸­æ–­æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä»ç™½åº•é»‘å­—çš„æ•°æ®ä¸Šçœ‹åˆ°æ•°æ®çš„å˜åŒ–ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ²¡æœ‰ç»“è®ºã€‚</p><p>æˆ‘ä»¬å†çœ‹è½¯ä¸­æ–­çš„æ•°æ®ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/a5/ac/a5e8055b5b893c376bb9379a7de69cac.png?wh=1636*470\" alt=\"\"></p><p>ä»ç™½åº•é»‘å­—çš„æ•°æ®å¯ä»¥çœ‹åˆ°ï¼ŒNET_RXçš„å˜åŒ–è¾ƒå¤§ï¼ˆTIMERæ˜¯ç³»ç»Ÿçš„æ—¶é’Ÿï¼Œæˆ‘ä»¬ä¸ç”¨åšåˆ†æï¼‰ï¼Œè€Œè¿™ä¸ªæœåŠ¡å™¨worker-4ä¸ŠåŒæ—¶æ”¾äº†Gatewayå’ŒRedisï¼Œå¹¶ä¸”è¿™ä¸¤ä¸ªæœåŠ¡éƒ½æ˜¯ç”¨ç½‘ç»œçš„å¤§æˆ·ï¼Œæ˜¾ç„¶è¿™æ˜¯æˆ‘ä»¬è¦åˆ†æçš„åœ°æ–¹ã€‚</p><p>ç”±äºç½‘ç»œçš„ä¸­æ–­æ¯”è¾ƒé«˜ï¼Œæˆ‘ä»¬è¿›å…¥åˆ°Podä¸­ï¼ŒæŸ¥çœ‹ä¸€ä¸‹ç½‘ç»œé˜Ÿåˆ—ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/dc/96/dce7bf1af8e13b3273e79bc054f48f96.png?wh=1181*670\" alt=\"\"></p><p>ä½ çœ‹ï¼Œè¿™é‡Œé¢æœ‰recv_Qã€‚æˆ‘ä»¬çŸ¥é“ï¼Œrecv_Qæ˜¯ç½‘ç»œæ•°æ®çš„æ¥æ”¶é˜Ÿåˆ—ï¼Œå®ƒæŒç»­æœ‰å€¼è¯´æ˜äº†æ¥æ”¶é˜Ÿåˆ—ä¸­ç¡®å®æœ‰é˜»å¡ã€‚</p><p>è¯·ä½ æ³¨æ„ï¼Œè¿™ä¸ªç»“è®ºä¸æ˜¯æˆ‘åªåˆ·ä¸€æ¬¡netstatå¾—åˆ°çš„ï¼Œè€Œæ˜¯åˆ·äº†å¾ˆå¤šæ¬¡ã€‚å› ä¸ºæ¯æ¬¡éƒ½æœ‰è¿™æ ·çš„é˜Ÿåˆ—å‡ºç°ï¼Œæ‰€ä»¥ï¼Œæˆ‘æ‰ä¼šåˆ¤æ–­ç½‘ç»œæ¥æ”¶é˜Ÿåˆ—recv_Qä¸­ç¡®å®æœ‰æœªå¤„ç†å®Œçš„æ•°æ®ã€‚å¦‚æœå®ƒåªæ˜¯å¶å°”å‡ºç°ä¸€æ¬¡ï¼Œé‚£é—®é¢˜å€’æ˜¯ä¸å¤§ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬ç»§ç»­åˆ†æè¿™ä¸ªé—®é¢˜ï¼Œå¾…ä¼šå†ç»™å‡ºè§£å†³æ–¹æ¡ˆã€‚</p><p>æ—¢ç„¶æ¥æ”¶é˜Ÿåˆ—ä¸­æœ‰å€¼ï¼Œä»æ•°æ®ä¼ é€’çš„é€»è¾‘æ¥çœ‹ï¼Œè¿™åº”è¯¥æ˜¯ä¸Šå±‚çš„åº”ç”¨æ²¡æœ‰åŠæ—¶å¤„ç†ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ¥è·Ÿè¸ªä¸€ä¸‹æ–¹æ³•çš„æ‰§è¡Œæ—¶é—´ã€‚</p><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆè·Ÿè¸ªè´Ÿè´£ç”Ÿæˆç¡®è®¤è®¢å•çš„generateConfirmOrderæ¥å£ï¼ˆå…¶å®è¿™é‡Œè¦è·Ÿè¸ªå“ªä¸ªæ–¹æ³•å€’æ˜¯æ— æ‰€è°“ï¼Œå› ä¸ºå‰é¢è¯´äº†æ‰€æœ‰ä¸šåŠ¡éƒ½å¾ˆæ…¢ï¼‰ï¼š</p><pre><code>Command execution times exceed limit: 5, so command will exit. You can set it with -n option.\nCondition express: 1==1 , result: true\n`---ts=2021-02-18 19:20:15;thread_name=http-nio-8086-exec-113;id=3528;is_daemon=true;priority=5;TCCL=org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedWebappClassLoader@20a46227\n    â€‹`---[151.845221ms] com.dunshan.mall.order.service.impl.PortalOrderServiceImpl$$EnhancerBySpringCGLIB$$11e4c326:generateConfirmOrder(\n        â€‹`---[151.772564ms] org.springframework.cglib.proxy.MethodInterceptor:intercept() #5\n            â€‹`---[151.728833ms] com.dunshan.mall.order.service.impl.PortalOrderServiceImpl:generateConfirmOrder(\n                â€‹+---[0.015801ms] com.dunshan.mall.order.domain.ConfirmOrderResult:&lt;init&gt;() #8\n                â€‹+---[75.263121ms] com.dunshan.mall.order.feign.MemberService:getCurrentMember() #8\n                â€‹+---[0.006396ms] com.dunshan.mall.model.UmsMember:getId() #9\n                â€‹+---[0.004322ms] com.dunshan.mall.model.UmsMember:getId() #9\n                â€‹+---[0.008234ms] java.util.List:toArray() #5\n                â€‹+---[min=0.006794ms,max=0.012615ms,total=0.019409ms,count=2] org.slf4j.Logger:info() #5\n                â€‹+---[0.005043ms] com.dunshan.mall.model.UmsMember:getId() #9\n                â€‹+---[28.805315ms] com.dunshan.mall.order.feign.CartItemService:listPromotionnew() #5\n                â€‹+---[0.007123ms] com.dunshan.mall.order.domain.ConfirmOrderResult:setCartPromotionItemList() #9\n                â€‹+---[0.012758ms] com.dunshan.mall.model.UmsMember:getList() #10\n                â€‹+---[0.011984ms] com.dunshan.mall.order.domain.ConfirmOrderResult:setMemberReceiveAddressList() #5\n                â€‹+---[0.03736ms] com.alibaba.fastjson.JSON:toJSON() #11\n                â€‹+---[0.010188ms] com.dunshan.mall.order.domain.OmsCartItemVo:&lt;init&gt;() #12\n                â€‹+---[0.005661ms] com.dunshan.mall.order.domain.OmsCartItemVo:setCartItemList() #12\n                â€‹+---[19.225703ms] com.dunshan.mall.order.feign.MemberService:listCart() #12\n                â€‹+---[0.010474ms] com.dunshan.mall.order.domain.ConfirmOrderResult:setCouponHistoryDetailList() #5\n                â€‹+---[0.007807ms] com.dunshan.mall.model.UmsMember:getIntegration() #13\n                â€‹+---[0.009189ms] com.dunshan.mall.order.domain.ConfirmOrderResult:setMemberIntegration() #5\n                â€‹+---[27.471129ms] com.dunshan.mall.mapper.UmsIntegrationConsumeSettingMapper:selectByPrimaryKey() #13\n                â€‹+---[0.019764ms] com.dunshan.mall.order.domain.ConfirmOrderResult:setIntegrationConsumeSetting() #13\n                â€‹+---[0.154893ms] com.dunshan.mall.order.service.impl.PortalOrderServiceImpl:calcCartAmount() #13\n                â€‹`---[0.013139ms] com.dunshan.mall.order.domain.ConfirmOrderResult:setCalcAmount() #13\n</code></pre><p>ä½ çœ‹ï¼Œè¿™ä¸ªæ¥å£ä¸­æœ‰ä¸€ä¸ªgetCurrentMemberæ–¹æ³•ï¼Œå®ƒæ˜¯Memberä¸Šçš„ä¸€ä¸ªæœåŠ¡ï¼Œæ˜¯ç”¨æ¥è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯çš„ï¼Œè€Œå…¶ä»–æœåŠ¡éƒ½ä¼šç”¨åˆ°è¿™ä¸ªæœåŠ¡ï¼Œå› ä¸ºéœ€è¦Tokenå˜›ã€‚</p><p>ä»ä¸Šé¢çš„æ ˆä¿¡æ¯çœ‹ï¼ŒgetCurrentMemberç”¨äº†75mså¤šï¼Œè¿™ä¸ªæ—¶é—´æ˜æ˜¾æ˜¯æ…¢äº†ï¼Œæˆ‘ä»¬è·Ÿè¸ªä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ï¼Œçœ‹çœ‹æ˜¯å“ªé‡Œæ…¢äº†ï¼š</p><pre><code>Condition express: 1==1 , result: true\n`---ts=2021-02-18 19:43:18;thread_name=http-nio-8083-exec-25;id=34bd;is_daemon=true;priority=5;TCCL=org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedWebappClassLoader@6cb759d5\n    â€‹`---[36.139809ms] com.dunshan.mall.member.service.imp.MemberServiceImpl:getCurrentMember(\n        â€‹+---[0.093398ms] javax.servlet.http.HttpServletRequest:getHeader() #18\n        â€‹+---[0.020236ms] cn.hutool.core.util.StrUtil:isEmpty() #18\n        â€‹+---[0.147621ms] cn.hutool.json.JSONUtil:toBean() #19\n        â€‹+---[0.02041ms] com.dunshan.mall.common.domain.UserDto:getId() #19\n        â€‹`---[35.686266ms] com.dunshan.mall.member.service.MemberCacheService:getMember() #5\n</code></pre><p>è¿™ç§éœ€è¦ç¬é—´æŠ“çš„æ•°æ®ï¼Œè¦åå¤æŠ“å¾ˆå¤šéæ‰èƒ½ç¡®å®šã€‚è™½ç„¶æˆ‘åœ¨è¿™é‡Œåªå±•ç¤ºäº†ä¸€æ¡ï¼Œä½†æ˜¯ï¼Œæˆ‘æŠ“çš„æ—¶å€™å¯æ˜¯æŠ“äº†å¥½å¤šæ¬¡æ‰å¾—åˆ°çš„ã€‚ä»ä¸Šé¢çš„æ•°æ®æ¥çœ‹ï¼ŒgetCurrentMemberä¸­ä½¿ç”¨çš„getMemberæ–¹æ³•è€—æ—¶æ¯”è¾ƒé•¿ï¼Œè¾¾åˆ°äº†35mså¤šã€‚</p><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹getMemberçš„å…·ä½“å®ç°ï¼š</p><pre><code>@Override\npublic UmsMember getMember(Long memberId) {\n    String key = REDIS_DATABASE + &quot;:&quot; + REDIS_KEY_MEMBER + &quot;:&quot; + memberId;\n    return (UmsMember) redisService.get(key);\nâ€‹\n</code></pre><p>è¿™ä¸ªä»£ç çš„é€»è¾‘å¾ˆç®€å•ï¼šæ‹¼æ¥Keyä¿¡æ¯ï¼Œç„¶åä»Redisé‡Œæ‰¾åˆ°ç›¸åº”çš„Memberä¿¡æ¯ã€‚</p><p>æ—¢ç„¶getMemberå‡½æ•°æ˜¯ä»Redisé‡Œè·å–æ•°æ®ï¼Œé‚£æˆ‘ä»¬å°±åˆ°Redisé‡Œæ£€æŸ¥ä¸€ä¸‹slowlogï¼š</p><pre><code>127.0.0.1:6379&gt; slowlog get\n1) 1) (integer) 5\n   1) (integer) 1613647620\n   2) (integer) 30577\n   3) 1) &quot;GET&quot;\n      1) &quot;mall:ums:member:2070064&quot;\n   4) &quot;10.100.140.46:53152&quot;\n   5) &quot;&quot;\n2) 1) (integer) 4\n   1) (integer) 1613647541\n   2) (integer) 32878\n   3) 1) &quot;GET&quot;\n      1) &quot;mall:ums:member:955622&quot;\n   4) &quot;10.100.140.46:53152&quot;\n   5) &quot;&quot;\n........................\n</code></pre><p>ä½ çœ‹ï¼Œç¡®å®æ˜¯getå‘½ä»¤æ…¢äº†ï¼Œçœ‹æ—¶é—´éƒ½è¶…è¿‡äº†10msï¼ˆslowlogé»˜è®¤è®¾ç½®æ˜¯10msä»¥ä¸Šæ‰è®°å½•ï¼‰ã€‚å¦‚æœè¿™ä¸ªå‘½ä»¤æ‰§è¡Œçš„æ¬¡æ•°ä¸å¤šï¼Œå€’ä¹Ÿæ²¡å•¥ã€‚å…³é”®æ˜¯è¿™ä¸ªå‘½ä»¤æ˜¯éªŒè¯ç”¨æˆ·çš„æ—¶å€™ç”¨çš„ï¼Œè¿™æ ·çš„æ—¶é—´æ˜¯æ²¡åŠæ³•å®¹å¿çš„ã€‚</p><p>ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ</p><p>å› ä¸ºåœ¨ä¸šåŠ¡ä¸Šæ¥çœ‹ï¼Œé™¤äº†æ‰“å¼€é¦–é¡µå’ŒæŸ¥è¯¢å•†å“ä¸ç”¨å®ƒä¹‹å¤–ï¼Œå…¶ä»–çš„è„šæœ¬ä¼¼ä¹éƒ½éœ€è¦ç”¨å®ƒã€‚æ‰€ä»¥ï¼Œå®ƒæ…¢äº†ä¸æ˜¯å½±å“ä¸€ä¸ªä¸šåŠ¡ï¼Œè€Œæ˜¯å½±å“ä¸€å †ä¸šåŠ¡ã€‚</p><p>ç„¶è€Œï¼Œæ­£å½“æˆ‘ä»¬åˆ†æåˆ°è¿™é‡Œï¼Œè¿˜æ²¡æ¥å¾—åŠåšä¼˜åŒ–çš„æ—¶å€™ï¼Œåˆ......å‡ºç°äº†æ–°é—®é¢˜ã€‚æˆ‘åœ¨æ¥ç€å‹çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°äº†è¿™æ ·çš„ç°è±¡ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/50/09/50ce836643202d334b172c1b806eb109.png?wh=1831*833\" alt=\"\"></p><p>ä½ ç§ç§ï¼ŒTPSä¸ç¨³å®šå°±ç®—äº†ï¼Œåé¢å±…ç„¶è¿˜å…¨æŠ¥é”™äº†ï¼Œè¿™ä¹Ÿå¤ªä¸åˆé€‚äº†å§ï¼</p><p>äºæ˜¯ï¼Œæˆ‘å¼€å§‹å¯¹æŠ¥é”™æ—¥å¿—ä¸€é€šæŸ¥ï¼Œæœ€åå‘ç°äº†Redisçš„å®¹å™¨éƒ½é£˜çº¢äº†ï¼Œä¸‹é¢æ˜¯Redisåœ¨æ¶æ„ä¸­çš„çŠ¶æ€æˆªå›¾ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/55/29/55acca876156a22d6cfb2f4ea6aae129.png?wh=478*192\" alt=\"\"></p><p>è¿™æ˜æ˜¾æ˜¯Redisæ²¡äº†å‘€ï¼è¿™æ—¶å€™æˆ‘ä»¬å†å»çœ‹åº”ç”¨çš„çŠ¶æ€ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/5b/a1/5b3777e79f5880c7c34f31fa5f3b73a1.png?wh=1844*770\" alt=\"\"></p><p>æ»¡ç›®ç–®ç—å‘€ï¼</p><p>æ¥ç€ï¼Œæˆ‘ä»¬ç™»å½•åˆ°RedisæœåŠ¡æ‰€åœ¨çš„workerèŠ‚ç‚¹ï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼š</p><pre><code>[ 7490.807349] redis-server invoked oom-killer: gfp_mask=0xd0, order=0, oom_score_adj=807\n[ 7490.821216] redis-server cpuset=docker-18cc9a81d8a58856ecf5fed45d7db431885b33236e5ad50919297cec453cebe1.scope mems_allowed=0\n[ 7490.826286] CPU: 2 PID: 27225 Comm: redis-server Kdump: loaded Tainted: G               ------------ T 3.10.0-1127.el7.x86_64 #1\n[ 7490.832929] Hardware name: Red Hat KVM, BIOS 0.5.1 01/01/2011\n[ 7490.836240] Call Trace:\n[ 7490.838006]  [&lt;ffffffff9af7ff85&gt;] dump_stack+0x19/0x1b\n[ 7490.841975]  [&lt;ffffffff9af7a8a3&gt;] dump_header+0x90/0x229\n[ 7490.844690]  [&lt;ffffffff9aa9c4a8&gt;] ? ep_poll_callback+0xf8/0x220\n[ 7490.847625]  [&lt;ffffffff9a9c246e&gt;] oom_kill_process+0x25e/0x3f0\n[ 7490.850515]  [&lt;ffffffff9a933a41&gt;] ? cpuset_mems_allowed_intersects+0x21/0x30\n[ 7490.853893]  [&lt;ffffffff9aa40ba6&gt;] mem_cgroup_oom_synchronize+0x546/0x570\n[ 7490.857075]  [&lt;ffffffff9aa40020&gt;] ? mem_cgroup_charge_common+0xc0/0xc0\n[ 7490.860348]  [&lt;ffffffff9a9c2d14&gt;] pagefault_out_of_memory+0x14/0x90\n[ 7490.863651]  [&lt;ffffffff9af78db3&gt;] mm_fault_error+0x6a/0x157\n[ 7490.865928]  [&lt;ffffffff9af8d8d1&gt;] __do_page_fault+0x491/0x500\n[ 7490.868661]  [&lt;ffffffff9af8da26&gt;] trace_do_page_fault+0x56/0x150\n[ 7490.871811]  [&lt;ffffffff9af8cfa2&gt;] do_async_page_fault+0x22/0xf0\n[ 7490.874423]  [&lt;ffffffff9af897a8&gt;] async_page_fault+0x28/0x30\n[ 7490.877127] Task in /kubepods.slice/kubepods-burstable.slice/kubepods-burstable-pod6e897c3a_8b9f_479b_9f53_33d2898977b0.slice/docker-18cc9a81d8a58856ecf5fed45d7db431885b33236e5ad50919297cec453cebe1.scope killed as a result of limit of /kubepods.slice/kubepods-burstable.slice/kubepods-burstable-pod6e897c3a_8b9f_479b_9f53_33d2898977b0.slice/docker-18cc9a81d8a58856ecf5fed45d7db431885b33236e5ad50919297cec453cebe1.scope\n[ 7490.893825] memory: usage 3145728kB, limit 3145728kB, failcnt 176035\n[ 7490.896099] memory+swap: usage 3145728kB, limit 3145728kB, failcnt 0\n[ 7490.899137] kmem: usage 0kB, limit 9007199254740988kB, failcnt 0\n[ 7490.902012] Memory cgroup stats for /kubepods.slice/kubepods-burstable.slice/kubepods-burstable-pod6e897c3a_8b9f_479b_9f53_33d2898977b0.slice/docker-18cc9a81d8a58856ecf5fed45d7db431885b33236e5ad50919297cec453cebe1.scope: cache:72KB rss:3145656KB rss_huge:0KB mapped_file:0KB swap:0KB inactive_anon:0KB active_anon:3145652KB inactive_file:0KB active_file:20KB unevictable:0KB\n[ 7490.962494] [ pid ]   uid  tgid total_vm      rss nr_ptes swapents oom_score_adj name\n[ 7490.966577] [27197]     0 27197      596      166       5        0           807 sh\n[ 7490.970286] [27225]     0 27225   818112   786623    1550        0           807 redis-server\n[ 7490.974006] [28322]     0 28322      999      304       6        0           807 bash\n[ 7490.978178] Memory cgroup out of memory: Kill process 27242 (redis-server) score 1808 or sacrifice child\n[ 7490.983765] Killed process 27225 (redis-server), UID 0, total-vm:3272448kB, anon-rss:3144732kB, file-rss:1760kB, shmem-rss:0kB\n</code></pre><p>åŸæ¥æ˜¯workerèŠ‚ç‚¹çš„å†…å­˜ä¸å¤Ÿç”¨äº†ï¼Œè€ŒRedisåœ¨è®¡ç®—OOMè¯„åˆ†æ—¶ä¹Ÿè¾¾åˆ°äº†1808åˆ†ã€‚äºæ˜¯ï¼Œæ“ä½œç³»ç»Ÿå°±ä¹‰æ— åé¡¾åœ°æŠŠRedisç»™æ€äº†ã€‚</p><p>æˆ‘ä»¬å†æ¬¡æŠŠRediså¯åŠ¨ä¹‹åï¼Œè§‚å¯Ÿå®ƒçš„å†…å­˜æ¶ˆè€—ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><pre><code>[root@k8s-worker-4 ~]# pidstat -r -p 5356 1\nLinux 3.10.0-1127.el7.x86_64 (k8s-worker-4) \t2021å¹´02æœˆ18æ—¥ \t_x86_64_\t(6 CPU)\n\n\n19æ—¶55åˆ†52ç§’   UID       PID  minflt/s  majflt/s     VSZ    RSS   %MEM  Command\n19æ—¶55åˆ†53ç§’     0      5356     32.00      0.00 3272448 1122152   6.90  redis-server\n19æ—¶55åˆ†54ç§’     0      5356     27.00      0.00 3272448 1122416   6.90  redis-server\n19æ—¶55åˆ†55ç§’     0      5356     28.00      0.00 3272448 1122416   6.90  redis-server\n19æ—¶55åˆ†56ç§’     0      5356     28.00      0.00 3272448 1122680   6.90  redis-server\n19æ—¶55åˆ†57ç§’     0      5356     21.78      0.00 3272448 1122680   6.90  redis-server\n19æ—¶55åˆ†58ç§’     0      5356     38.00      0.00 3272448 1122880   6.90  redis-server\n19æ—¶55åˆ†59ç§’     0      5356     21.00      0.00 3272448 1122880   6.90  redis-server\n19æ—¶56åˆ†00ç§’     0      5356     25.00      0.00 3272448 1122880   6.90  redis-server\n</code></pre><p>æˆ‘åªæ˜¯æˆªå–äº†Redisæ²¡æ­»ä¹‹å‰çš„ä¸€å°æ®µæ•°æ®ï¼Œç„¶åé€šè¿‡RSSï¼ˆå®é™…ä½¿ç”¨å†…å­˜ï¼‰æ¥ä¸æ–­è§‚å¯Ÿè¿™æ®µæ•°æ®ï¼Œå‘ç°å†…å­˜ç¡®å®ä¼šä¸€ç›´å¾€ä¸Šæ¶¨ã€‚æˆ‘åˆæŸ¥äº†ä¸€ä¸‹Redisçš„é…ç½®æ–‡ä»¶ï¼Œå‘ç°æ²¡é…ç½®maxmemoryã€‚</p><p>æ²¡é…ç½®å€’æ˜¯æ²¡ä»€ä¹ˆï¼Œå†…å­˜ä¸å¤Ÿå°±ä¸å¤Ÿäº†å‘—ï¼ŒPodä¸æ˜¯è¿˜æœ‰å†…å­˜é™åˆ¶å—ï¼Ÿä½†å¯æƒœçš„æ˜¯ï¼Œworkerä¸Šçš„å†…å­˜ä¸å¤Ÿäº†ï¼Œå¯¼è‡´äº†Redisè¿›ç¨‹è¢«æ“ä½œç³»ç»Ÿæ€æ‰äº†ï¼Œè¿™å°±è§£é‡Šäº†TPSå›¾ä¸­ååŠæ®µä¼šæŠ¥é”™çš„é—®é¢˜ã€‚</p><p>ä½†æ˜¯å“åº”æ—¶é—´æ…¢ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¾—æ¥ç€åˆ†æã€‚æˆ‘ä»¬åœ¨å‰é¢çœ‹åˆ°è½¯ä¸­æ–­å’Œå¸¦å®½æœ‰å…³ï¼Œä¸ºäº†å‡å°‘æœåŠ¡ä¸­æ–­ä¹‹é—´çš„ç›¸äº’å½±å“ï¼Œå¾…ä¼šæˆ‘æŠŠRediså’ŒGatewayä¸¤ä¸ªæœåŠ¡åˆ†å¼€ã€‚</p><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒRedisæ˜¯é å†…å­˜æ¥ç»´æŠ¤æ•°æ®çš„ï¼Œå¦‚æœåªåšå†…å­˜çš„æ“ä½œï¼Œå®ƒå€’æ˜¯ä¼šå¾ˆå¿«ã€‚ä½†æ˜¯Redisè¿˜æœ‰ä¸€å—è·Ÿå†…å­˜æ¯”è¾ƒæœ‰å…³çš„åŠŸèƒ½ï¼Œå°±æ˜¯æŒä¹…åŒ–ã€‚æˆ‘ä»¬ç°åœ¨é‡‡ç”¨çš„æ˜¯AOFæŒä¹…åŒ–ç­–ç•¥ï¼Œå¹¶ä¸”æ²¡æœ‰é™åˆ¶AOFçš„æ–‡ä»¶å¤§å°ã€‚</p><p>è¿™ä¸ªæŒä¹…åŒ–æ–‡ä»¶æ˜¯æ”¾åˆ°NFSæ–‡ä»¶æœåŠ¡å™¨ä¸Šé¢çš„ï¼Œæ—¢ç„¶æ˜¯æ”¾åˆ°æ–‡ä»¶æœåŠ¡å™¨ä¸Šï¼Œé‚£å°±éœ€è¦æœ‰è¶³å¤Ÿçš„ç£ç›˜IOèƒ½åŠ›æ‰å¯ä»¥ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åˆ°nfsæœåŠ¡å™¨ä¸ŠæŸ¥çœ‹ä¸€ä¸‹IOçš„èƒ½åŠ›ï¼Œæˆªå–éƒ¨åˆ†æ•°æ®å¦‚ä¸‹ï¼š</p><pre><code>Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util\nsda               0.00     0.00   65.00    0.00  6516.00     0.00   200.49     1.85   28.43   28.43    0.00   3.95  25.70\n\n\nDevice:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util\nsda               0.00     0.00   24.00    0.00   384.00     0.00    32.00     0.15    6.46    6.46    0.00   6.46  15.50\n\n\nDevice:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util\nsda               0.00     0.00    8.00    0.00  1124.00     0.00   281.00     0.07    8.38    8.38    0.00   4.00   3.20\n\n\n..........................\n\n\nDevice:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util\nsda               0.00     0.00   11.00    0.00   556.00     0.00   101.09     0.15   13.55   13.55    0.00  10.36  11.40\n\n\nDevice:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util\nsda               0.00     0.00    4.00    0.00    32.00     0.00    16.00     0.08   19.25   19.25    0.00  15.25   \n</code></pre><p>é€šè¿‡svctmï¼ˆIOå“åº”æ—¶é—´è®¡æ•°å™¨ï¼‰è¿™ä¸ªå‚æ•°å¯ä»¥çœ‹åˆ°ï¼ŒIOçš„å“åº”æ—¶é—´ä¹Ÿå¢åŠ äº†ã€‚è™½ç„¶åœ¨sysstatçš„æ–°ç‰ˆæœ¬ä¸­å·²ç»ä¸å»ºè®®ä½¿ç”¨svctmäº†ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬å½“å‰ä½¿ç”¨çš„ç‰ˆæœ¬ä¸­ï¼Œä»ç„¶æœ‰è¿™ä¸ªå‚æ•°ã€‚å¹¶ä¸”é€šè¿‡å®ƒï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°IOçš„å“åº”æ—¶é—´ç¡®å®åœ¨å¢åŠ ã€‚</p><p>ä¸ºäº†è¯æ˜IOçš„å“åº”æ—¶é—´æ˜¯å’ŒAOFæœ‰å…³ï¼Œæˆ‘ä»¬å…ˆæŠŠAOFå…³æ‰ï¼Œè®¾ç½®appendonly noçœ‹çœ‹æ•ˆæœã€‚å¦‚æœæœ‰æ•ˆæœï¼Œé‚£ä¼˜åŒ–æ–¹å‘å°±éå¸¸æ˜ç¡®äº†ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯è¿™å‡ ä¸ªä¼˜åŒ–åŠ¨ä½œï¼š</p><ol>\n<li>\n<p>æŠŠRediså…ˆç§»åˆ°ä¸€ä¸ªç½‘ç»œéœ€æ±‚æ²¡é‚£ä¹ˆå¤§çš„Workerä¸Šå»ï¼Œè§‚å¯Ÿä¸€ä¸‹TPSèƒ½ä¸èƒ½å¥½ä¸€ç‚¹ã€‚å¦‚æœè¿™ä¸€æ­¥æœ‰æ•ˆæœï¼Œæˆ‘ä»¬å°±ä¸ç”¨å†æŠ˜è…¾ä¸‹ä¸€æ­¥äº†ï¼›</p>\n</li>\n<li>\n<p>å¦‚æœä¸Šä¸€æ­¥åšå®Œä¹‹åæ²¡æœ‰æ•ˆæœï¼Œå°±å†æŠŠAOFå…³æ‰ï¼Œå†è§‚å¯ŸTPSã€‚å¦‚æœAOFå…³æ‰åæœ‰æ•ˆæœï¼Œé‚£æˆ‘ä»¬å°±å¾—åˆ†æä¸‹è¿™ä¸ªåº”ç”¨æœ‰æ²¡æœ‰å¿…è¦åšRedisçš„æŒä¹…åŒ–äº†ã€‚å¦‚æœæœ‰å¿…è¦ï¼Œå°±å¾—æ¢ä¸ªå¿«ä¸€ç‚¹çš„ç¡¬ç›˜ï¼›</p>\n</li>\n<li>\n<p>ä¸ç®¡ä¸Šé¢ä¸¤æ­¥æœ‰ç”¨æ²¡ç”¨ï¼Œå¯¹Redisæ¥è¯´ï¼Œæˆ‘ä»¬éƒ½åº”è¯¥è€ƒè™‘é™åˆ¶å†…å­˜çš„å¤§å°å’ŒAOFæ–‡ä»¶çš„å¤§å°ã€‚</p>\n</li>\n</ol><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹æŠŠRedisä»worker-4ç§»åˆ°worker-7ä¸Šä¹‹åçš„TPSå¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/82/b0/8280f7c008b93b51b1a8cfd18e0041b0.png?wh=1832*587\" alt=\"\"></p><p>TPSè¿˜æ˜¯åœ¨ä¸‹é™ï¼Œå¹¶ä¸”æ²¡æœ‰ä¸€å¼€å§‹çš„é‚£ä¹ˆé«˜äº†ï¼Œä¹‹å‰éƒ½èƒ½è¾¾åˆ°1000TPSã€‚è¿™ä¸ªçœ‹ä¼¼éå¸¸æ­£ç¡®çš„ä¼˜åŒ–åŠ¨ä½œå´å¯¼è‡´äº†TPSä¸‹é™çš„ç°è±¡ï¼Œæ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„ã€‚</p><p>ç°åœ¨è¿˜ä¸çŸ¥é“é—®é¢˜åœ¨å“ªé‡Œï¼Œä¸è¿‡ï¼Œæˆ‘ä»¬ä¸€ç›´æƒ³è¾¾åˆ°çš„ç›®æ ‡æ˜¯é™é˜Ÿåˆ—ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å…ˆç¡®è®¤ä¸‹ç½‘ç»œé˜Ÿåˆ—æœ‰æ²¡æœ‰é™ä¸‹æ¥ï¼Œå†æ¥è€ƒè™‘TPSæ€ä¹ˆæå‡ã€‚</p><p>ä½ çœ‹worker-4ä¸Šçš„é˜Ÿåˆ—ï¼Œæ²¡æœ‰recv_Qçš„å€¼äº†ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/ee/29/eedebbd0338a8de3a68a9bffe3f99029.png?wh=1304*576\" alt=\"\"></p><p>ç°åœ¨æˆ‘ä»¬å°±å¾—æ¥å¤„ç†ä¸‹AOFäº†ï¼Œå› ä¸ºæˆ‘ä»¬è™½ç„¶ç§»å¼€äº†Redisï¼Œä½†æ˜¯TPSå¹¶æ²¡æœ‰ä¸Šå‡ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¿˜å¾—çœ‹çœ‹AOFçš„å½±å“ã€‚</p><p>å…³æ‰AOFä¹‹åï¼ŒTPSå¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/00/ab/009dc49121215309fd600454ae07d5ab.png?wh=1831*581\" alt=\"\"></p><p>æ€»ä½“èµ„æºå¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/31/e0/31afcba048861d02981f5947c88819e0.png?wh=1827*456\" alt=\"\"></p><p>çœ‹åˆ°äº†æ²¡ï¼Œæ•ˆæœè¿˜æ˜¯æœ‰çš„å§ï¼Ÿæˆ‘ä»¬å¯æ˜¯å¾—åˆ°äº†1000ä»¥ä¸Šçš„ç¨³å®šçš„TPSæ›²çº¿ã€‚</p><p>åœ¨è¿™ä¸ªå®¹é‡åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å®Œæˆäº†å››ä¸ªé˜¶æ®µçš„åˆ†æä¹‹åï¼Œä¼˜åŒ–æ•ˆæœè¿˜ä¸é”™ã€‚ä¸è¿‡ï¼Œæ¯ä¸ªæ€§èƒ½æµ‹è¯•éƒ½åº”è¯¥æœ‰<strong>ç»“è®º</strong>ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åšä¸€ä¸ªåŠ¨ä½œï¼Œå°±æ˜¯æ¥ç€å¢åŠ å‹åŠ›ï¼Œçœ‹ä¸€ä¸‹ç³»ç»Ÿçš„æœ€å¤§å®¹é‡èƒ½è¾¾åˆ°å¤šå°‘ã€‚</p><p>äºæ˜¯ï¼Œæˆ‘ä»¬è¿›å…¥ç¬¬äº”ä¸ªé˜¶æ®µçš„åˆ†æã€‚</p><h2>ç¬¬äº”é˜¶æ®µåˆ†æ</h2><p>è¯·ä½ æ³¨æ„<strong>ï¼Œå®¹é‡</strong><strong>åœºæ™¯æœ€é‡è¦çš„å˜åŒ–åªæœ‰ä¸€ä¸ªï¼Œå°±æ˜¯å¢åŠ çº¿ç¨‹</strong>ã€‚è€Œè·Ÿç€çº¿ç¨‹ä¸€èµ·å˜åŒ–çš„å°±æ˜¯å‚æ•°åŒ–çš„æ•°æ®é‡ã€‚åœ¨è¿™æ ·çš„å¢åŠ çº¿ç¨‹çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬è¿˜è¦å…³æ³¨çš„å°±æ˜¯èµ„æºçš„å‡è¡¡ä½¿ç”¨ã€‚å› æ­¤ï¼Œåœ¨ç¬¬å››é˜¶æ®µçš„ä¼˜åŒ–ä¹‹åï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªåœºæ™¯çš„ç»“æœæ˜¯ä¸ªä»€ä¹ˆæ ·å­ã€‚</p><h3>åœºæ™¯è¿è¡Œæ•°æ®</h3><p>åœºæ™¯å‹åŠ›æ•°æ®å¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/db/5d/dbcd3ae8b6df86ac8bf2c9a919270a5d.png?wh=1830*582\" alt=\"\"></p><p>ä»æ•ˆæœä¸Šæ¥çœ‹ï¼Œä¸é”™å“¦ï¼ŒTPSå·²ç»è¾¾åˆ°1700äº†ã€‚</p><h3>å…¨å±€ç›‘æ§åˆ†æ</h3><p>å…¨å±€ç›‘æ§çš„æ•°æ®å¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/ey/c4/eyy599b05a63e03383107a67d56d5ec4.png?wh=1834*459\" alt=\"\"></p><p>ä»ä¸Šé¢ä¸¤å¼ å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æˆ‘ä»¬è¿™æ ·çš„å‹åŠ›ä¹‹ä¸‹ï¼ŒTPSæœ€å¤§èƒ½è¾¾åˆ°1700å·¦å³ï¼Œç³»ç»Ÿæ•´ä½“èµ„æºä½¿ç”¨ç‡ä¹Ÿä¸ç®—å°‘äº†ã€‚</p><p><strong>ç»è¿‡äº†åŸºå‡†åœºæ™¯å’Œå®¹é‡åœºæ™¯ä¹‹åï¼Œæˆ‘ä»¬ç°åœ¨<strong><strong>å°±å¯ä»¥ä¸‹</strong></strong>ç»“è®ºäº†</strong><strong>ï¼š</strong><strong>ç³»ç»Ÿèµ„æºåœ¨è¿™ä¸ªæœ€å¤§å®¹é‡çš„åœºæ™¯ä¸­å·²ç»è¾¾åˆ°äº†æ¯”è¾ƒé«˜çš„ä½¿ç”¨ç‡ã€‚</strong></p><p>ä½ æœ‰æ²¡æœ‰å¬è¿‡æ€§èƒ½è¡Œä¸šä¸­ä¸€ç›´æµä¼ çš„ä¸€å¥è¯ï¼šæ€§èƒ½ä¼˜åŒ–æ˜¯æ— æ­¢å¢ƒçš„ã€‚æ‰€ä»¥ï¼Œ<strong>æˆ‘ä»¬ä¸€å®šè¦é€‰æ‹©å¥½æ€§èƒ½é¡¹ç›®ç»“æŸçš„å…³é”®ç‚¹ã€‚</strong></p><p>å°±æ‹¿æˆ‘ä»¬è¿™ä¸ªè¯¾ç¨‹çš„æ¡ˆä¾‹æ¥è¯´ï¼Œè¿™ä¸ªç³»ç»Ÿåœ¨æŠ€æœ¯ä¸Šå·²ç»æ²¡æœ‰ä¼˜åŒ–çš„ç©ºé—´äº†ï¼Œæˆ–è€…è¯´åœ¨æŠ€æœ¯ä¸Šä¼˜åŒ–çš„æˆæœ¬æ¯”è¾ƒé«˜ï¼ˆæ¯”å¦‚è¯´è¦åšä¸€äº›å®šåˆ¶çš„å¼€å‘å’Œæ”¹é€ ï¼‰ã€‚å¦‚æœä½ åœ¨è¿™ç§æƒ…å†µä¸‹è¿˜æƒ³è¦æ‰©å¤§å®¹é‡ï¼Œé‚£ä¹ˆä½ èƒ½åšçš„å°±æ˜¯å¢åŠ èŠ‚ç‚¹å’Œç¡¬ä»¶èµ„æºï¼ŒæŠŠæ‰€æœ‰çš„ç¡¬ä»¶èµ„æºå…¨éƒ½ç”¨å®Œã€‚</p><p>ä½†æ˜¯ï¼è¯·æ‰€æœ‰åšæ€§èƒ½é¡¹ç›®çš„äººæ³¨æ„ï¼<strong>æˆ‘ä»¬åšæ€§èƒ½é¡¹ç›®ï¼Œä¸æ˜¯è¯´æŠŠç³»ç»Ÿä¼˜åŒ–åˆ°æœ€å¥½<strong><strong>å</strong></strong>ï¼Œå°±å¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æŒ‰è¿™æ ·çš„å®¹é‡æ¥è®¾è®¡æ•´ä½“çš„ç”Ÿäº§èµ„æº****äº†</strong>ï¼è¦çŸ¥é“ï¼Œç”Ÿäº§ç¯å¢ƒä¸­å‡ºç°é—®é¢˜çš„ä»£ä»·æ˜¯éå¸¸é«˜çš„ï¼Œä¸€èˆ¬æˆ‘ä»¬éƒ½ä¼šå¢åŠ ä¸€å®šçš„å†—ä½™ï¼Œä½†æ˜¯å†—ä½™å¤šå°‘å°±ä¸ä¸€è€Œè¶³äº†ã€‚</p><p>åœ¨å¾ˆå¤šä¼ä¸šä¸­ï¼Œç”Ÿäº§ç¯å¢ƒé‡Œä½¿ç”¨çš„CPUéƒ½æ²¡æœ‰è¶…è¿‡20%ã€‚ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆå¤šçš„å†—ä½™å‘¢ï¼Ÿåœ¨æˆ‘çš„ç»éªŒä¸­ï¼Œå¤§éƒ¨åˆ†çš„é¡¹ç›®éƒ½æ˜¯æ ¹æ®ä¸šåŠ¡çš„å‘å±•åœ¨ä¸æ–­è¿­ä»£ï¼Œç„¶åå½¢æˆäº†è¿™æ ·çš„å±€é¢ã€‚ä½ å¯ä»¥æƒ³åƒä¸€ä¸‹ï¼Œè¿™æ ·çš„ç”Ÿäº§ç¯å¢ƒé‡Œæœ‰å¤šå°‘èµ„æºæµªè´¹ã€‚</p><p>è¯´åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬ä¸å¾—ä¸è¯´ä¸€ä¸‹æ€ä¹ˆè¯„ä¼°æ¶æ„çº§çš„å®¹é‡ã€‚å› ä¸ºå¯¹äºä¸€ä¸ªå›ºå®šå®¢æˆ·ç«¯æ•°çš„ç³»ç»Ÿæ¥è¯´ï¼Œå¾ˆå®¹æ˜“åˆ¤æ–­æ•´ä½“çš„å®¹é‡ã€‚ä½†æ˜¯ï¼Œå¯¹éå›ºå®šå®¢æˆ·ç«¯æ•°çš„ç³»ç»Ÿè€Œè¨€ï¼Œè¦æƒ³æŠµæŒ¡å¾—ä½çªå‘çš„ä¸šåŠ¡å®¹é‡ã€‚é‚£å°±è¦ç»è¿‡ä¸¥æ ¼çš„è®¾è®¡äº†ï¼Œåƒç¼“å­˜ã€é˜Ÿåˆ—ã€é™æµã€ç†”æ–­ã€é¢„çƒ­ç­‰ç­‰è¿™äº›æ‰‹æ®µéƒ½è¦ä¸Šäº†ã€‚</p><p>å¯¹äºæ•´ä½“çš„æ¶æ„å®¹é‡è®¾è®¡ï¼Œåœ¨æ‰€æœ‰çš„ä¼ä¸šä¸­éƒ½ä¸æ˜¯ä¸€è¹´è€Œå°±çš„ï¼Œéƒ½è¦ç»è¿‡å¤šæ¬¡çš„ã€å¤šå¹´çš„ç‰ˆæœ¬è¿­ä»£ï¼Œè·Ÿç€ä¸šåŠ¡çš„å‘å±•ä¸æ–­æ¼”è¿›å¾—åˆ°ã€‚è¿™å°±ä¸æ˜¯ä¸€ä¸ªä¸“æ å¯ä»¥å°½è¿°çš„äº†ã€‚</p><h2>æ€»ç»“</h2><p>ä»åŸºå‡†åœºæ™¯åšå®Œä¹‹åï¼Œæˆ‘ä»¬æ¥åˆ°äº†å®¹é‡åœºæ™¯ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„å˜åŒ–ã€‚åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæˆ‘ä»¬è§£å†³äº†å‡ ä¸ªé—®é¢˜å¹¶æœ€ç»ˆç»™å‡ºäº†ç»“è®ºï¼š</p><p>ç¬¬ä¸€ä¸ªé˜¶æ®µï¼šåˆ†æäº†å‹åŠ›å·¥å…·å‚æ•°åŒ–çš„é—®é¢˜ï¼Œè§£å†³äº†TPSä¸æ–­é™ä½ã€å“åº”æ—¶é—´ä¸æ–­ä¸Šå‡çš„é—®é¢˜ã€‚</p><p>ç¬¬äºŒä¸ªé˜¶æ®µï¼šåˆ†æäº†æ•°æ®åº“ç´¢å¼•ï¼Œè§£å†³äº†TPSä½çš„é—®é¢˜ã€‚</p><p>ç¬¬ä¸‰ä¸ªé˜¶æ®µï¼šåˆ†æäº†èµ„æºäº‰ç”¨ï¼Œè§£å†³äº†å¤šå®¹å™¨è·‘åˆ°ä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„é—®é¢˜ã€‚</p><p>ç¬¬å››ä¸ªé˜¶æ®µï¼šåˆ†æäº†ç½‘ç»œäº‰ç”¨å’ŒRedisçš„AOFï¼Œè§£å†³äº†TPSä¸ç¨³å®šçš„é—®é¢˜ã€‚</p><p>ç¬¬äº”ä¸ªé˜¶æ®µï¼šé€’å¢å‹åŠ›ï¼Œç»™å‡ºæœ€ç»ˆç³»ç»Ÿæ•´ä½“å®¹é‡çš„ç»“è®ºã€‚</p><p>åœ¨åšå®Œè¿™äº›åŠ¨ä½œä¹‹åï¼Œæˆ‘ä»¬ç»ˆäºå¯ä»¥ç»™å‡ºæ¯”è¾ƒæ˜ç¡®çš„ç»“è®ºäº†ï¼šTPSèƒ½è¾¾åˆ°1700ï¼</p><p>è¯·ä½ è®°ä½ï¼Œå¯¹äºä¸€ä¸ªæ€§èƒ½é¡¹ç›®æ¥è¯´ï¼Œæ²¡æœ‰ç»“è®ºå°±æ˜¯åœ¨è€æµæ°“ã€‚æ‰€ä»¥ï¼Œæˆ‘ä¸€ç›´å¼ºè°ƒï¼Œ<strong>åœ¨æ€§èƒ½é¡¹ç›®ä¸­</strong><strong>ï¼Œæˆ‘ä»¬</strong><strong>ä¸€å®šè¦ç»™å‡ºæœ€å¤§å®¹é‡çš„ç»“è®ºã€‚</strong></p><h2>è¯¾åä½œä¸š</h2><p>è¿™å°±æ˜¯ä»Šå¤©çš„å…¨éƒ¨å†…å®¹ï¼Œæœ€åç»™ä½ ç•™ä¸¤ä¸ªæ€è€ƒé¢˜å§ï¼š</p><ol>\n<li>ä¸ºä»€ä¹ˆæ€§èƒ½é¡¹ç›®ä¸€å®šè¦æœ‰ç»“è®ºï¼Ÿ</li>\n<li>å½“å¤šä¸ªæ€§èƒ½é—®é¢˜åŒæ—¶å‡ºç°æ—¶ï¼Œæˆ‘ä»¬æ€ä¹ˆåˆ¤æ–­å®ƒä»¬äº§ç”Ÿçš„ç›¸äº’å½±å“ï¼Ÿ</li>\n<li>å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç³»ç»Ÿå·²ç»ä¼˜åŒ–åˆ°äº†æœ€ä¼˜çš„çŠ¶æ€ï¼Ÿ</li>\n</ol><p>è®°å¾—åœ¨ç•™è¨€åŒºå’Œæˆ‘è®¨è®ºã€äº¤æµä½ çš„æƒ³æ³•ï¼Œæ¯ä¸€æ¬¡æ€è€ƒéƒ½ä¼šè®©ä½ æ›´è¿›ä¸€æ­¥ã€‚</p><p>å¦‚æœè¿™èŠ‚è¯¾è®©ä½ æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿæ¬¢è¿ä½ åˆ†äº«ç»™ä½ çš„æœ‹å‹ï¼Œå…±åŒå­¦ä¹ è¿›æ­¥ã€‚æˆ‘ä»¬ä¸‹ä¸€è®²å†è§ï¼</p>","comments":[{"had_liked":false,"id":302942,"user_name":"jy","can_delete":false,"product_type":"c1","uid":1785172,"ip_address":"","ucode":"F4E179C435451B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJ6G2xZvNRmhyXBjmGbI5G8icGCCMPupr6yxZ1IcURwp7GTRHcpWGWpg9A0fLlyicmVdDwzqZqwiaOQ/132","comment_is_top":false,"comment_ctime":1626446766,"is_pvip":false,"replies":[{"id":"109662","content":"1ï¼Œ æ˜¯çš„ã€‚æˆ‘è¿™é‡Œæ²¡æœ‰åšè‡ªåŠ¨è§¦å‘ã€‚<br>2.  skywalingçš„é…ç½®æ–‡ä»¶ä¸­ã€‚<br>3. æˆ‘è®¾ç½®çš„æ—¶å€™å°±å·²ç»ç¡®å®šäº†ã€‚<br>4. åŒä¸Šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1626536635,"ip_address":"","comment_id":302942,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10216381358","product_id":100074001,"comment_content":"é—®é¢˜ï¼š<br>1ã€â€œåˆ†æäº†èµ„æºäº‰ç”¨ï¼Œè§£å†³äº†å¤šå®¹å™¨è·‘åˆ°ä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„é—®é¢˜ã€‚â€ï¼Œå¤šç¯‡æ–‡ä¸­éƒ½æœ‰ç§»åˆ°å¦å¤–ä¸€ä¸ªworkï¼Œè¿™åªèƒ½æ‰‹åŠ¨ç§»ï¼Ÿ<br>2ã€â€œåœ¨ä¹‹å‰éƒ¨ç½²ç³»ç»Ÿçš„æ—¶å€™ï¼Œæˆ‘ä»¬æŠŠ SkyWalking é‡‡æ ·ç‡è®¾ç½®å¾—éå¸¸ä½ï¼Œåªæœ‰ 5% å·¦å³ï¼Œç›®çš„ä¸ºäº†ä¸è®© APM å½±å“æ€§èƒ½å’Œç½‘ç»œâ€ï¼Œè¯·é—®ä¸‹è¿™ä¸ªåœ¨å“ªè®¾ç½®å‘¢ï¼Ÿ<br>3ã€ç¬¬å››ä¸ªé˜¶æ®µåï¼Œæ€ä¹ˆæ²¡æœ‰æ ¸å¯¹tpsæ˜¯å¦å¤åˆä¸šåŠ¡æ¯”ä¾‹ï¼Ÿ<br>4ã€ç¬¬äº”ä¸ªé˜¶æ®µåï¼Œæ€ä¹ˆæ²¡æœ‰æ ¸å¯¹æœ€å¤§å®¹é‡æ—¶tpsæ˜¯å¦å¤åˆä¸šåŠ¡æ¯”ä¾‹ï¼Ÿ<br><br>è°¢è°¢è€å¸ˆ","like_count":2,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523486,"discussion_content":"1ï¼Œ æ˜¯çš„ã€‚æˆ‘è¿™é‡Œæ²¡æœ‰åšè‡ªåŠ¨è§¦å‘ã€‚\n2.  skywalingçš„é…ç½®æ–‡ä»¶ä¸­ã€‚\n3. æˆ‘è®¾ç½®çš„æ—¶å€™å°±å·²ç»ç¡®å®šäº†ã€‚\n4. åŒä¸Šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626536635,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":298131,"user_name":"sky_you","can_delete":false,"product_type":"c1","uid":2647818,"ip_address":"","ucode":"3169CB6C9C9601","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er9ay1I6KWdnn0MX1JSfic0xdmWLcD1Jh1Fx2AP67d6Kicr71HH5jOKHrUZbTmfsLTQDNTTroCbcTzA/132","comment_is_top":false,"comment_ctime":1623919746,"is_pvip":false,"replies":[{"id":"108238","content":"æ€§èƒ½é—®é¢˜çš„è§£å†³ä¸€æ–¹é¢é çš„æ˜¯èƒ½åŠ›ï¼›å¦ä¸€æ–¹é¢å°±æ˜¯é…åˆäº†ã€‚<br>å¯¹ä¸é…åˆçš„åªèƒ½æ‹¿èŒä½æ¥å‹åˆ¶ã€‚ğŸ˜ŠğŸ˜Š","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1624004578,"ip_address":"","comment_id":298131,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5918887042","product_id":100074001,"comment_content":"çœ‹åˆ°äº†è€å¸ˆçš„å¾ˆå¤šä¼˜åŒ–æ€è·¯ï¼Œæˆ‘è§‰å¾—æ²¡æœ‰å¤šå¹´çŸ¥è¯†çš„ç§¯ç´¯æ˜¯å¾ˆéš¾åšåˆ°è¿™ç§ç¨‹åº¦çš„ã€‚è§£ææ€è·¯å¾ˆé‡è¦ã€‚<br>åŒæ—¶åœ¨å®é™…çš„é¡¹ç›®ä¸­ï¼Œæ€§èƒ½å·¥ä½œçš„å±•å¼€ä¹Ÿæ²¡æœ‰é‚£ä¹ˆé¡ºåˆ©ã€‚æ¯”å¦‚æˆ‘ç°åœ¨é‡åˆ°çš„ã€‚å¼€å‘å°±ä¸æ€ä¹ˆé…åˆï¼Œæˆ‘è¯´ä»£ç æœ‰é—®é¢˜ï¼Œæå‡ºä»£ç åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹è¦åšç›¸å…³çš„ä¼˜åŒ–ã€‚å¼€å‘ç¼ºä¸æ‡‚æˆ‘åœ¨è¯´ä»€ä¹ˆã€‚å¯èƒ½æˆ‘æŠ€æœ¯è¿˜ä¸åˆ°å®¶ï¼Œä¸èƒ½ç›´æ¥å¸®ä»–æ”¹ä»£ç ã€‚ç»“æœå°±å¯¼è‡´äº†é—®é¢˜æ²¡æœ‰åŠæ³•è§£å†³ã€‚","like_count":1,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522026,"discussion_content":"æ€§èƒ½é—®é¢˜çš„è§£å†³ä¸€æ–¹é¢é çš„æ˜¯èƒ½åŠ›ï¼›å¦ä¸€æ–¹é¢å°±æ˜¯é…åˆäº†ã€‚\nå¯¹ä¸é…åˆçš„åªèƒ½æ‹¿èŒä½æ¥å‹åˆ¶ã€‚ğŸ˜ŠğŸ˜Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624004578,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":350939,"user_name":"Geek_c1b445","can_delete":false,"product_type":"c1","uid":2159305,"ip_address":"åŒ—äº¬","ucode":"8A2B1821E0DEAA","user_header":"","comment_is_top":false,"comment_ctime":1657368242,"is_pvip":false,"replies":[{"id":"129319","content":"æ˜¯çš„ã€‚è®¾ç½®ä¸åŒçº§åˆ«çš„Tã€‚ ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1785562","ctime":1661333335,"ip_address":"åŒ—äº¬","comment_id":350939,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1657368242","product_id":100074001,"comment_content":"è¯·é—®è€å¸ˆï¼š<br>çœ‹æˆªå›¾å¥½åƒæ˜¯æ¯ä¸ªæ¥å£æŒ‰æ¥å£ç»Ÿè®¡æ¯”ä¾‹å»é…ç½®çš„å—ï¼Ÿ<br>å‰é¢ç« èŠ‚å¥½åƒè¯´å¾—æŒ‰ç…§ä¸šåŠ¡é…ç½®å—ï¼Ÿæ¯”å¦‚ä¸‹å•ä¸šåŠ¡ç”±ç™»é™†ã€æŸ¥çœ‹å•†å“ã€æ”¯ä»˜3ä¸ªæ¥å£ç»„æˆä¸€ä¸ªTé…ç½®åˆ°æ··åˆåœºæ™¯å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585112,"discussion_content":"æ˜¯çš„ã€‚è®¾ç½®ä¸åŒçº§åˆ«çš„Tã€‚ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661333335,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":333478,"user_name":"zwm","can_delete":false,"product_type":"c1","uid":1787187,"ip_address":"","ucode":"BDF98B3A1CD406","user_header":"https://static001.geekbang.org/account/avatar/00/1b/45/33/cdea4bca.jpg","comment_is_top":false,"comment_ctime":1644377757,"is_pvip":false,"replies":[{"id":"122555","content":"çœ‹æƒ…å†µï¼Œæ˜¯å¸¦å®½çš„é—®é¢˜ï¼Œå‡å¸¦å®½æ‰å¯ä»¥ã€‚æœ‰äº›ä¸æ˜¯å¸¦å®½é˜»å¡çš„ï¼Œè€Œæ˜¯åº”ç”¨é˜»å¡çš„ã€‚ ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1785562","ctime":1645579487,"ip_address":"","comment_id":333478,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1644377757","product_id":100074001,"comment_content":"ç½‘ç»œé˜Ÿåˆ—æ˜¯ä¸æ˜¯å‡å¸¦å®½ä¹Ÿå¯ä»¥ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552723,"discussion_content":"çœ‹æƒ…å†µï¼Œæ˜¯å¸¦å®½çš„é—®é¢˜ï¼Œå‡å¸¦å®½æ‰å¯ä»¥ã€‚æœ‰äº›ä¸æ˜¯å¸¦å®½é˜»å¡çš„ï¼Œè€Œæ˜¯åº”ç”¨é˜»å¡çš„ã€‚ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645579487,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":333437,"user_name":"zwm","can_delete":false,"product_type":"c1","uid":1787187,"ip_address":"","ucode":"BDF98B3A1CD406","user_header":"https://static001.geekbang.org/account/avatar/00/1b/45/33/cdea4bca.jpg","comment_is_top":false,"comment_ctime":1644368964,"is_pvip":false,"replies":[{"id":"122553","content":"1ï¼Œç»™å‡ºtpså’Œå“åº”æ—¶é—´ä¹Ÿç®—æ˜¯ç»“è®ºï¼Œè¿™æ˜¯æ€§èƒ½æµ‹è¯•é¡¹ç›®çš„ç»“è®ºä¸­å¿…é¡»æœ‰çš„ã€‚ è€Œå¯¹æ€§èƒ½ç“¶é¢ˆæ¥è¯´ï¼Œè¿™ä¸ªä¸ç®—æ˜¯ç»“è®ºï¼Œåªæ˜¯ç°è±¡ã€‚ <br>2. é‚£å¿…é¡»çš„ã€‚<br>3. çœ‹è¶‹åŠ¿å›¾ã€‚ ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1785562","ctime":1645579276,"ip_address":"","comment_id":333437,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1644368964","product_id":100074001,"comment_content":"1 æ²¡æœ‰ç»“è®ºå°±æ²¡æœ‰ä»·å€¼ã€‚ä½†æ˜¯æœ‰ä¸ªç–‘é—®ï¼Œæˆ‘ä»¬ç°åœ¨åšçš„æ€§èƒ½æµ‹è¯•çš„ç»“è®ºæ¯”è¾ƒå¤šçš„æ˜¯ä¸¤ä¸ªï¼Œ1æ˜¯æœ€å¤§TPSï¼ˆä¸çœ‹èµ„æºï¼‰   2æ˜¯å¡å“åº”æ—¶é—´2sçœ‹æ€§èƒ½æƒ…å†µï¼Œè¿™ä¹Ÿç®—æ˜¯ç»“è®ºå§<br>2 å…ˆè§£å†³ä¸€ä¸ªï¼Œæ¯æ¬¡åªä¼˜åŒ–1ä¸ªç‚¹<br>3 èµ„æºä½¿ç”¨è¾ƒé«˜ï¼ŒTPSé•¿æœŸç¨³å®šï¼Ÿè¿™ä¸ªé—®é¢˜ä¸å¤ªæ¸…æ¥šï¼Œï¼Œï¼Œ","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552720,"discussion_content":"1ï¼Œç»™å‡ºtpså’Œå“åº”æ—¶é—´ä¹Ÿç®—æ˜¯ç»“è®ºï¼Œè¿™æ˜¯æ€§èƒ½æµ‹è¯•é¡¹ç›®çš„ç»“è®ºä¸­å¿…é¡»æœ‰çš„ã€‚ è€Œå¯¹æ€§èƒ½ç“¶é¢ˆæ¥è¯´ï¼Œè¿™ä¸ªä¸ç®—æ˜¯ç»“è®ºï¼Œåªæ˜¯ç°è±¡ã€‚ \n2. é‚£å¿…é¡»çš„ã€‚\n3. çœ‹è¶‹åŠ¿å›¾ã€‚ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645579276,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332784,"user_name":"ğŸ¹","can_delete":false,"product_type":"c1","uid":1167368,"ip_address":"","ucode":"7A0F883B0BC6F0","user_header":"https://static001.geekbang.org/account/avatar/00/11/d0/08/5a1576ed.jpg","comment_is_top":false,"comment_ctime":1643604697,"is_pvip":false,"replies":[{"id":"121757","content":"æ˜¯çš„ã€‚ ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1785562","ctime":1644243617,"ip_address":"","comment_id":332784,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1643604697","product_id":100074001,"comment_content":"å¼•ç”¨â€œæ¥ç€ï¼Œæˆ‘ä»¬ç™»å½•åˆ° Redis æœåŠ¡æ‰€åœ¨çš„ worker èŠ‚ç‚¹ï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼šâ€<br>-------è€å¸ˆè¿™ä¸ªæ˜¯çœ‹çš„linuxç³»ç»Ÿçš„ç³»ç»Ÿæ—¥å¿—å—ï¼Ÿ  dmesg | more  æ˜¯è¿™ä¸ªå—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549797,"discussion_content":"æ˜¯çš„ã€‚ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644243618,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":300737,"user_name":"Geek_Gabriel","can_delete":false,"product_type":"c1","uid":1785399,"ip_address":"","ucode":"D650708A2881CA","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM7ib9sicOBrwtOUZWq4sB1BuXicHavq0PltfZNkktdqcfQmibATk481FT6Gnic2ZNnWV8PVZJQOU7O2cag/132","comment_is_top":false,"comment_ctime":1625363313,"is_pvip":false,"replies":[{"id":"109126","content":"å¯¹ã€‚è¿™é‡Œåº”è¯¥æ˜¯å“åº”æ—¶é—´ï¼Œæ‰‹æŠ–äº†ã€‚æˆ‘ä¿®æ”¹ä¸€ä¸‹ã€‚å¯ä»¥è”ç³»æˆ‘é¢†5å…ƒçº é”™çº¢åŒ…ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1625650041,"ip_address":"","comment_id":300737,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1625363313","product_id":100074001,"comment_content":"ä¸ŠèŠ‚è¯¾ï¼Œæˆ‘ä»¬ç»å†äº†ä¸‰ä¸ªé˜¶æ®µçš„åˆ†æä¼˜åŒ–ï¼Œåˆ†åˆ«è§£å†³äº†åœ¨å‹åŠ›çº¿ç¨‹ä¸å˜çš„æƒ…å†µä¸‹ï¼ŒTPS éšæ—¶é—´å¢åŠ è€Œå¢åŠ çš„é—®é¢˜ï¼Œè¿˜æœ‰æ•°æ®åº“åŠ ç´¢å¼•çš„é—®é¢˜ã€‚<br><br>è¿™å„¿çš„TPSåº”è¯¥æ˜¯ARTå§.ä¸Šä¸€èŠ‚ä¸­æåˆ°äº†tpsä¸‹é™ï¼Œartä¸Šå‡çš„é—®é¢˜ã€‚","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522804,"discussion_content":"å¯¹ã€‚è¿™é‡Œåº”è¯¥æ˜¯å“åº”æ—¶é—´ï¼Œæ‰‹æŠ–äº†ã€‚æˆ‘ä¿®æ”¹ä¸€ä¸‹ã€‚å¯ä»¥è”ç³»æˆ‘é¢†5å…ƒçº é”™çº¢åŒ…ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625650041,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}