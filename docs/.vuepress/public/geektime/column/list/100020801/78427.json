{"id":78427,"title":"30 | ç­”ç–‘æ–‡ç« ï¼ˆäºŒï¼‰ï¼šç”¨åŠ¨æ€çš„è§‚ç‚¹çœ‹åŠ é”","content":"<p>åœ¨ç¬¬<a href=\"https://time.geekbang.org/column/article/75173\">20</a>å’Œ<a href=\"https://time.geekbang.org/column/article/75659\">21</a>ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å’Œä½ ä»‹ç»äº†InnoDBçš„é—´éš™é”ã€next-key lockï¼Œä»¥åŠåŠ é”è§„åˆ™ã€‚åœ¨è¿™ä¸¤ç¯‡æ–‡ç« çš„è¯„è®ºåŒºï¼Œå‡ºç°äº†å¾ˆå¤šé«˜è´¨é‡çš„ç•™è¨€ã€‚æˆ‘è§‰å¾—é€šè¿‡åˆ†æè¿™äº›é—®é¢˜ï¼Œå¯ä»¥å¸®åŠ©ä½ åŠ æ·±å¯¹åŠ é”è§„åˆ™çš„ç†è§£ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘å°±ä»ä¸­æŒ‘é€‰äº†å‡ ä¸ªæœ‰ä»£è¡¨æ€§çš„é—®é¢˜ï¼Œæ„æˆäº†ä»Šå¤©è¿™ç¯‡ç­”ç–‘æ–‡ç« çš„ä¸»é¢˜ï¼Œå³ï¼šç”¨åŠ¨æ€çš„è§‚ç‚¹çœ‹åŠ é”ã€‚</p><p><strong>ä¸ºäº†æ–¹ä¾¿ä½ ç†è§£ï¼Œæˆ‘ä»¬å†ä¸€èµ·å¤ä¹ ä¸€ä¸‹åŠ é”è§„åˆ™ã€‚è¿™ä¸ªè§„åˆ™ä¸­ï¼ŒåŒ…å«äº†ä¸¤ä¸ªâ€œåŸåˆ™â€ã€ä¸¤ä¸ªâ€œä¼˜åŒ–â€å’Œä¸€ä¸ªâ€œbugâ€ï¼š</strong></p><ul>\n<li>åŸåˆ™1ï¼šåŠ é”çš„åŸºæœ¬å•ä½æ˜¯next-key lockã€‚å¸Œæœ›ä½ è¿˜è®°å¾—ï¼Œnext-key lockæ˜¯å‰å¼€åé—­åŒºé—´ã€‚</li>\n<li>åŸåˆ™2ï¼šæŸ¥æ‰¾è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ã€‚</li>\n<li>ä¼˜åŒ–1ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œç»™å”¯ä¸€ç´¢å¼•åŠ é”çš„æ—¶å€™ï¼Œnext-key locké€€åŒ–ä¸ºè¡Œé”ã€‚</li>\n<li>ä¼˜åŒ–2ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³éå†æ—¶ä¸”æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶çš„æ—¶å€™ï¼Œnext-key locké€€åŒ–ä¸ºé—´éš™é”ã€‚</li>\n<li>ä¸€ä¸ªbugï¼šå”¯ä¸€ç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢ä¼šè®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢ã€‚</li>\n</ul><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çš„è®¨è®ºè¿˜æ˜¯åŸºäºä¸‹é¢è¿™ä¸ªè¡¨tï¼š</p><pre><code>CREATE TABLE `t` (\n  `id` int(11) NOT NULL,\n  `c` int(11) DEFAULT NULL,\n  `d` int(11) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  KEY `c` (`c`)\n) ENGINE=InnoDB;\n\ninsert into t values(0,0,0),(5,5,5),\n(10,10,10),(15,15,15),(20,20,20),(25,25,25);\n</code></pre><h1>ä¸ç­‰å·æ¡ä»¶é‡Œçš„ç­‰å€¼æŸ¥è¯¢</h1><p>æœ‰åŒå­¦å¯¹â€œç­‰å€¼æŸ¥è¯¢â€æå‡ºäº†ç–‘é—®ï¼šç­‰å€¼æŸ¥è¯¢å’Œâ€œéå†â€æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆæˆ‘ä»¬æ–‡ç« çš„ä¾‹å­é‡Œé¢ï¼Œwhereæ¡ä»¶æ˜¯ä¸ç­‰å·ï¼Œè¿™ä¸ªè¿‡ç¨‹é‡Œä¹Ÿæœ‰ç­‰å€¼æŸ¥è¯¢ï¼Ÿ</p><!-- [[[read_end]]] --><p>æˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸‹è¿™ä¸ªä¾‹å­ï¼Œåˆ†æä¸€ä¸‹è¿™æ¡æŸ¥è¯¢è¯­å¥çš„åŠ é”èŒƒå›´ï¼š</p><pre><code>begin;\nselect * from t where id&gt;9 and id&lt;12 order by id desc for update;\n</code></pre><p>åˆ©ç”¨ä¸Šé¢çš„åŠ é”è§„åˆ™ï¼Œæˆ‘ä»¬çŸ¥é“è¿™ä¸ªè¯­å¥çš„åŠ é”èŒƒå›´æ˜¯ä¸»é”®ç´¢å¼•ä¸Šçš„ (0,5]ã€(5,10]å’Œ(10, 15)ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œid=15è¿™ä¸€è¡Œï¼Œå¹¶æ²¡æœ‰è¢«åŠ ä¸Šè¡Œé”ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬è¯´åŠ é”å•ä½æ˜¯next-key lockï¼Œéƒ½æ˜¯å‰å¼€åé—­åŒºé—´ï¼Œä½†æ˜¯è¿™é‡Œç”¨åˆ°äº†ä¼˜åŒ–2ï¼Œå³ç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³éå†çš„æ—¶å€™id=15ä¸æ»¡è¶³æ¡ä»¶ï¼Œæ‰€ä»¥next-key locké€€åŒ–ä¸ºäº†é—´éš™é” (10, 15)ã€‚</p><p>ä½†æ˜¯ï¼Œæˆ‘ä»¬çš„æŸ¥è¯¢è¯­å¥ä¸­whereæ¡ä»¶æ˜¯å¤§äºå·å’Œå°äºå·ï¼Œè¿™é‡Œçš„â€œç­‰å€¼æŸ¥è¯¢â€åˆæ˜¯ä»å“ªé‡Œæ¥çš„å‘¢ï¼Ÿ</p><p>è¦çŸ¥é“ï¼ŒåŠ é”åŠ¨ä½œæ˜¯å‘ç”Ÿåœ¨è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ï¼Œæ‰€ä»¥ä½ åœ¨åˆ†æåŠ é”è¡Œä¸ºçš„æ—¶å€™ï¼Œè¦ä»ç´¢å¼•ä¸Šçš„æ•°æ®ç»“æ„å¼€å§‹ã€‚è¿™é‡Œï¼Œæˆ‘å†æŠŠè¿™ä¸ªè¿‡ç¨‹æ‹†è§£ä¸€ä¸‹ã€‚</p><p>å¦‚å›¾1æ‰€ç¤ºï¼Œæ˜¯è¿™ä¸ªè¡¨çš„ç´¢å¼•idçš„ç¤ºæ„å›¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/ac/bb/ac1aa07860c565b907b32c5f75c4f2bb.png?wh=1142*856\" alt=\"\"></p><center><span class=\"reference\">å›¾1 ç´¢å¼•idç¤ºæ„å›¾</span></center><ol>\n<li>\n<p>é¦–å…ˆè¿™ä¸ªæŸ¥è¯¢è¯­å¥çš„è¯­ä¹‰æ˜¯order by id descï¼Œè¦æ‹¿åˆ°æ»¡è¶³æ¡ä»¶çš„æ‰€æœ‰è¡Œï¼Œä¼˜åŒ–å™¨å¿…é¡»å…ˆæ‰¾åˆ°â€œç¬¬ä¸€ä¸ªid&lt;12çš„å€¼â€ã€‚</p>\n</li>\n<li>\n<p>è¿™ä¸ªè¿‡ç¨‹æ˜¯é€šè¿‡ç´¢å¼•æ ‘çš„æœç´¢è¿‡ç¨‹å¾—åˆ°çš„ï¼Œåœ¨å¼•æ“å†…éƒ¨ï¼Œå…¶å®æ˜¯è¦æ‰¾åˆ°id=12çš„è¿™ä¸ªå€¼ï¼Œåªæ˜¯æœ€ç»ˆæ²¡æ‰¾åˆ°ï¼Œä½†æ‰¾åˆ°äº†(10,15)è¿™ä¸ªé—´éš™ã€‚</p>\n</li>\n<li>\n<p>ç„¶åå‘å·¦éå†ï¼Œåœ¨éå†è¿‡ç¨‹ä¸­ï¼Œå°±ä¸æ˜¯ç­‰å€¼æŸ¥è¯¢äº†ï¼Œä¼šæ‰«æåˆ°id=5è¿™ä¸€è¡Œï¼Œæ‰€ä»¥ä¼šåŠ ä¸€ä¸ªnext-key lock (0,5]ã€‚</p>\n</li>\n</ol><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œé€šè¿‡æ ‘æœç´¢çš„æ–¹å¼å®šä½è®°å½•çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯â€œç­‰å€¼æŸ¥è¯¢â€çš„æ–¹æ³•ã€‚</p><h1>ç­‰å€¼æŸ¥è¯¢çš„è¿‡ç¨‹</h1><p>ä¸ä¸Šé¢è¿™ä¸ªä¾‹å­å¯¹åº”çš„ï¼Œæ˜¯@å‘æ¡æ©™å­åŒå­¦æå‡ºçš„é—®é¢˜ï¼šä¸‹é¢è¿™ä¸ªè¯­å¥çš„åŠ é”èŒƒå›´æ˜¯ä»€ä¹ˆï¼Ÿ</p><pre><code>begin;\nselect id from t where c in(5,20,10) lock in share mode;\n</code></pre><p>è¿™æ¡æŸ¥è¯¢è¯­å¥é‡Œç”¨çš„æ˜¯inï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹è¿™æ¡è¯­å¥çš„explainç»“æœã€‚<br>\n<img src=\"https://static001.geekbang.org/resource/image/8a/b3/8a089159c82c1458b26e2756583347b3.png?wh=1483*143\" alt=\"\"></p><center><span class=\"reference\">å›¾2 inè¯­å¥çš„explainç»“æœ</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ¡inè¯­å¥ä½¿ç”¨äº†ç´¢å¼•cå¹¶ä¸”rows=3ï¼Œè¯´æ˜è¿™ä¸‰ä¸ªå€¼éƒ½æ˜¯é€šè¿‡B+æ ‘æœç´¢å®šä½çš„ã€‚</p><p>åœ¨æŸ¥æ‰¾c=5çš„æ—¶å€™ï¼Œå…ˆé”ä½äº†(0,5]ã€‚ä½†æ˜¯å› ä¸ºcä¸æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œä¸ºäº†ç¡®è®¤è¿˜æœ‰æ²¡æœ‰åˆ«çš„è®°å½•c=5ï¼Œå°±è¦å‘å³éå†ï¼Œæ‰¾åˆ°c=10æ‰ç¡®è®¤æ²¡æœ‰äº†ï¼Œè¿™ä¸ªè¿‡ç¨‹æ»¡è¶³ä¼˜åŒ–2ï¼Œæ‰€ä»¥åŠ äº†é—´éš™é”(5,10)ã€‚</p><p>åŒæ ·çš„ï¼Œæ‰§è¡Œc=10è¿™ä¸ªé€»è¾‘çš„æ—¶å€™ï¼ŒåŠ é”çš„èŒƒå›´æ˜¯(5,10] å’Œ (10,15)ï¼›æ‰§è¡Œc=20è¿™ä¸ªé€»è¾‘çš„æ—¶å€™ï¼ŒåŠ é”çš„èŒƒå›´æ˜¯(15,20] å’Œ (20,25)ã€‚</p><p>é€šè¿‡è¿™ä¸ªåˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œè¿™æ¡è¯­å¥åœ¨ç´¢å¼•cä¸ŠåŠ çš„ä¸‰ä¸ªè®°å½•é”çš„é¡ºåºæ˜¯ï¼šå…ˆåŠ c=5çš„è®°å½•é”ï¼Œå†åŠ c=10çš„è®°å½•é”ï¼Œæœ€ååŠ c=20çš„è®°å½•é”ã€‚</p><p>ä½ å¯èƒ½ä¼šè¯´ï¼Œè¿™ä¸ªåŠ é”èŒƒå›´ï¼Œä¸å°±æ˜¯ä»(5,25)ä¸­å»æ‰c=15çš„è¡Œé”å—ï¼Ÿä¸ºä»€ä¹ˆè¿™ä¹ˆéº»çƒ¦åœ°åˆ†æ®µè¯´å‘¢ï¼Ÿ</p><p>å› ä¸ºæˆ‘è¦è·Ÿä½ å¼ºè°ƒè¿™ä¸ªè¿‡ç¨‹ï¼šè¿™äº›é”æ˜¯â€œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸€ä¸ªä¸€ä¸ªåŠ çš„â€ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§åŠ ä¸Šå»çš„ã€‚</p><p>ç†è§£äº†è¿™ä¸ªåŠ é”è¿‡ç¨‹ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¥åˆ†æä¸‹é¢ä¾‹å­ä¸­çš„æ­»é”é—®é¢˜äº†ã€‚</p><p>å¦‚æœåŒæ—¶æœ‰å¦å¤–ä¸€ä¸ªè¯­å¥ï¼Œæ˜¯è¿™ä¹ˆå†™çš„ï¼š</p><pre><code>select id from t where c in(5,20,10) order by c desc for update;\n</code></pre><p>æ­¤æ—¶çš„åŠ é”èŒƒå›´ï¼Œåˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬ç°åœ¨éƒ½çŸ¥é“é—´éš™é”æ˜¯ä¸äº’é”çš„ï¼Œä½†æ˜¯è¿™ä¸¤æ¡è¯­å¥éƒ½ä¼šåœ¨ç´¢å¼•cä¸Šçš„c=5ã€10ã€20è¿™ä¸‰è¡Œè®°å½•ä¸ŠåŠ è®°å½•é”ã€‚</p><p>è¿™é‡Œä½ éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œç”±äºè¯­å¥é‡Œé¢æ˜¯order by c descï¼Œ è¿™ä¸‰ä¸ªè®°å½•é”çš„åŠ é”é¡ºåºï¼Œæ˜¯å…ˆé”c=20ï¼Œç„¶åc=10ï¼Œæœ€åæ˜¯c=5ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸¤æ¡è¯­å¥è¦åŠ é”ç›¸åŒçš„èµ„æºï¼Œä½†æ˜¯åŠ é”é¡ºåºç›¸åã€‚å½“è¿™ä¸¤æ¡è¯­å¥å¹¶å‘æ‰§è¡Œçš„æ—¶å€™ï¼Œå°±å¯èƒ½å‡ºç°æ­»é”ã€‚</p><p>å…³äºæ­»é”çš„ä¿¡æ¯ï¼ŒMySQLåªä¿ç•™äº†æœ€åä¸€ä¸ªæ­»é”çš„ç°åœºï¼Œä½†è¿™ä¸ªç°åœºè¿˜æ˜¯ä¸å®Œå¤‡çš„ã€‚</p><p>æœ‰åŒå­¦åœ¨è¯„è®ºåŒºç•™è¨€åˆ°ï¼Œå¸Œæœ›æˆ‘èƒ½å±•å¼€ä¸€ä¸‹æ€ä¹ˆçœ‹æ­»é”ã€‚ç°åœ¨ï¼Œæˆ‘å°±æ¥ç®€å•åˆ†æä¸€ä¸‹ä¸Šé¢è¿™ä¸ªä¾‹å­çš„æ­»é”ç°åœºã€‚</p><h1>æ€ä¹ˆçœ‹æ­»é”ï¼Ÿ</h1><p>å›¾3æ˜¯åœ¨å‡ºç°æ­»é”åï¼Œæ‰§è¡Œshow engine innodb statuså‘½ä»¤å¾—åˆ°çš„éƒ¨åˆ†è¾“å‡ºã€‚è¿™ä¸ªå‘½ä»¤ä¼šè¾“å‡ºå¾ˆå¤šä¿¡æ¯ï¼Œæœ‰ä¸€èŠ‚LATESTDETECTED DEADLOCKï¼Œå°±æ˜¯è®°å½•çš„æœ€åä¸€æ¬¡æ­»é”ä¿¡æ¯ã€‚<br>\n<img src=\"https://static001.geekbang.org/resource/image/a7/f6/a7dccb91bc17d12746703eb194775cf6.png?wh=1288*825\" alt=\"\"></p><center><span class=\"reference\">å›¾3 æ­»é”ç°åœº</span></center><p>æˆ‘ä»¬æ¥çœ‹çœ‹è¿™å›¾ä¸­çš„å‡ ä¸ªå…³é”®ä¿¡æ¯ã€‚</p><ol>\n<li>\n<p>è¿™ä¸ªç»“æœåˆ†æˆä¸‰éƒ¨åˆ†ï¼š</p>\n<ul>\n<li>(1) TRANSACTIONï¼Œæ˜¯ç¬¬ä¸€ä¸ªäº‹åŠ¡çš„ä¿¡æ¯ï¼›</li>\n<li>(2) TRANSACTIONï¼Œæ˜¯ç¬¬äºŒä¸ªäº‹åŠ¡çš„ä¿¡æ¯ï¼›</li>\n<li>WE ROLL BACK TRANSACTION (1)ï¼Œæ˜¯æœ€ç»ˆçš„å¤„ç†ç»“æœï¼Œè¡¨ç¤ºå›æ»šäº†ç¬¬ä¸€ä¸ªäº‹åŠ¡ã€‚</li>\n</ul>\n</li>\n<li>\n<p>ç¬¬ä¸€ä¸ªäº‹åŠ¡çš„ä¿¡æ¯ä¸­ï¼š</p>\n<ul>\n<li>WAITING FOR THIS LOCK TO BE GRANTEDï¼Œè¡¨ç¤ºçš„æ˜¯è¿™ä¸ªäº‹åŠ¡åœ¨ç­‰å¾…çš„é”ä¿¡æ¯ï¼›</li>\n<li>index c of table `test`.`t`ï¼Œè¯´æ˜åœ¨ç­‰çš„æ˜¯è¡¨tçš„ç´¢å¼•cä¸Šé¢çš„é”ï¼›</li>\n<li>lock mode S waiting è¡¨ç¤ºè¿™ä¸ªè¯­å¥è¦è‡ªå·±åŠ ä¸€ä¸ªè¯»é”ï¼Œå½“å‰çš„çŠ¶æ€æ˜¯ç­‰å¾…ä¸­ï¼›</li>\n<li>Record lockè¯´æ˜è¿™æ˜¯ä¸€ä¸ªè®°å½•é”ï¼›</li>\n<li>n_fields 2è¡¨ç¤ºè¿™ä¸ªè®°å½•æ˜¯ä¸¤åˆ—ï¼Œä¹Ÿå°±æ˜¯å­—æ®µcå’Œä¸»é”®å­—æ®µidï¼›</li>\n<li>0: len 4; hex 0000000a; asc ;;æ˜¯ç¬¬ä¸€ä¸ªå­—æ®µï¼Œä¹Ÿå°±æ˜¯cã€‚å€¼æ˜¯åå…­è¿›åˆ¶aï¼Œä¹Ÿå°±æ˜¯10ï¼›</li>\n<li>1: len 4; hex 0000000a; asc ;;æ˜¯ç¬¬äºŒä¸ªå­—æ®µï¼Œä¹Ÿå°±æ˜¯ä¸»é”®idï¼Œå€¼ä¹Ÿæ˜¯10ï¼›</li>\n<li>è¿™ä¸¤è¡Œé‡Œé¢çš„ascè¡¨ç¤ºçš„æ˜¯ï¼Œæ¥ä¸‹æ¥è¦æ‰“å°å‡ºå€¼é‡Œé¢çš„â€œå¯æ‰“å°å­—ç¬¦â€ï¼Œä½†10ä¸æ˜¯å¯æ‰“å°å­—ç¬¦ï¼Œå› æ­¤å°±æ˜¾ç¤ºç©ºæ ¼ã€‚</li>\n<li>ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¿¡æ¯å°±åªæ˜¾ç¤ºå‡ºäº†ç­‰é”çš„çŠ¶æ€ï¼Œåœ¨ç­‰å¾…(c=10,id=10)è¿™ä¸€è¡Œçš„é”ã€‚</li>\n<li>å½“ç„¶ä½ æ˜¯çŸ¥é“çš„ï¼Œæ—¢ç„¶å‡ºç°æ­»é”äº†ï¼Œå°±è¡¨ç¤ºè¿™ä¸ªäº‹åŠ¡ä¹Ÿå æœ‰åˆ«çš„é”ï¼Œä½†æ˜¯æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥ã€‚åˆ«ç€æ€¥ï¼Œæˆ‘ä»¬ä»ç¬¬äºŒä¸ªäº‹åŠ¡çš„ä¿¡æ¯ä¸­æ¨å¯¼å‡ºæ¥ã€‚</li>\n</ul>\n</li>\n<li>\n<p>ç¬¬äºŒä¸ªäº‹åŠ¡æ˜¾ç¤ºçš„ä¿¡æ¯è¦å¤šä¸€äº›ï¼š</p>\n<ul>\n<li>â€œ HOLDS THE LOCK(S)â€ç”¨æ¥æ˜¾ç¤ºè¿™ä¸ªäº‹åŠ¡æŒæœ‰å“ªäº›é”ï¼›</li>\n<li>index c of table `test`.`t` è¡¨ç¤ºé”æ˜¯åœ¨è¡¨tçš„ç´¢å¼•cä¸Šï¼›</li>\n<li>hex 0000000aå’Œhex 00000014è¡¨ç¤ºè¿™ä¸ªäº‹åŠ¡æŒæœ‰c=10å’Œc=20è¿™ä¸¤ä¸ªè®°å½•é”ï¼›</li>\n<li>WAITING FOR THIS LOCK TO BE GRANTEDï¼Œè¡¨ç¤ºåœ¨ç­‰(c=5,id=5)è¿™ä¸ªè®°å½•é”ã€‚</li>\n</ul>\n</li>\n</ol><p>ä»ä¸Šé¢è¿™äº›ä¿¡æ¯ä¸­ï¼Œæˆ‘ä»¬å°±çŸ¥é“ï¼š</p><ol>\n<li>\n<p>â€œlock in share modeâ€çš„è¿™æ¡è¯­å¥ï¼ŒæŒæœ‰c=5çš„è®°å½•é”ï¼Œåœ¨ç­‰c=10çš„é”ï¼›</p>\n</li>\n<li>\n<p>â€œfor updateâ€è¿™ä¸ªè¯­å¥ï¼ŒæŒæœ‰c=20å’Œc=10çš„è®°å½•é”ï¼Œåœ¨ç­‰c=5çš„è®°å½•é”ã€‚</p>\n</li>\n</ol><p>å› æ­¤å¯¼è‡´äº†æ­»é”ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸¤ä¸ªç»“è®ºï¼š</p><ol>\n<li>\n<p>ç”±äºé”æ˜¯ä¸€ä¸ªä¸ªåŠ çš„ï¼Œè¦é¿å…æ­»é”ï¼Œå¯¹åŒä¸€ç»„èµ„æºï¼Œè¦æŒ‰ç…§å°½é‡ç›¸åŒçš„é¡ºåºè®¿é—®ï¼›</p>\n</li>\n<li>\n<p>åœ¨å‘ç”Ÿæ­»é”çš„æ—¶åˆ»ï¼Œfor update è¿™æ¡è¯­å¥å æœ‰çš„èµ„æºæ›´å¤šï¼Œå›æ»šæˆæœ¬æ›´å¤§ï¼Œæ‰€ä»¥InnoDBé€‰æ‹©äº†å›æ»šæˆæœ¬æ›´å°çš„lock in share modeè¯­å¥ï¼Œæ¥å›æ»šã€‚</p>\n</li>\n</ol><h1>æ€ä¹ˆçœ‹é”ç­‰å¾…ï¼Ÿ</h1><p>çœ‹å®Œæ­»é”ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªé”ç­‰å¾…çš„ä¾‹å­ã€‚</p><p>åœ¨ç¬¬21ç¯‡æ–‡ç« çš„è¯„è®ºåŒºï¼Œ@Geek_9ca34e åŒå­¦åšäº†ä¸€ä¸ªæœ‰è¶£éªŒè¯ï¼Œæˆ‘æŠŠå¤ç°æ­¥éª¤åˆ—å‡ºæ¥ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/af/75/af3602b81aeb49e33577ba372d220a75.png?wh=1246*402\" alt=\"\"></p><center><span class=\"reference\">å›¾4 deleteå¯¼è‡´é—´éš™å˜åŒ–</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œç”±äºsession Aå¹¶æ²¡æœ‰é”ä½c=10è¿™ä¸ªè®°å½•ï¼Œæ‰€ä»¥session Båˆ é™¤id=10è¿™ä¸€è¡Œæ˜¯å¯ä»¥çš„ã€‚ä½†æ˜¯ä¹‹åï¼Œsession Bå†æƒ³insert id=10è¿™ä¸€è¡Œå›å»å°±ä¸è¡Œäº†ã€‚</p><p>ç°åœ¨æˆ‘ä»¬ä¸€èµ·çœ‹ä¸€ä¸‹æ­¤æ—¶show engine innodb statusçš„ç»“æœï¼Œçœ‹çœ‹èƒ½ä¸èƒ½ç»™æˆ‘ä»¬ä¸€äº›æç¤ºã€‚é”ä¿¡æ¯æ˜¯åœ¨è¿™ä¸ªå‘½ä»¤è¾“å‡ºç»“æœçš„TRANSACTIONSè¿™ä¸€èŠ‚ã€‚ä½ å¯ä»¥åœ¨æ–‡ç¨¿ä¸­çœ‹åˆ°è¿™å¼ å›¾ç‰‡<br>\n<img src=\"https://static001.geekbang.org/resource/image/c3/a6/c3744fb7b61df2a5b45b8eb1f2a853a6.png?wh=1701*324\" alt=\"\"></p><center><span class=\"reference\">å›¾ 5 é”ç­‰å¾…ä¿¡æ¯</span></center><p>æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªå…³é”®ä¿¡æ¯ã€‚</p><ol>\n<li>\n<p>index PRIMARY of table `test`.`t` ï¼Œè¡¨ç¤ºè¿™ä¸ªè¯­å¥è¢«é”ä½æ˜¯å› ä¸ºè¡¨tä¸»é”®ä¸Šçš„æŸä¸ªé”ã€‚</p>\n</li>\n<li>\n<p>lock_mode X locks gap before rec insert intention waiting è¿™é‡Œæœ‰å‡ ä¸ªä¿¡æ¯ï¼š</p>\n<ul>\n<li>insert intentionè¡¨ç¤ºå½“å‰çº¿ç¨‹å‡†å¤‡æ’å…¥ä¸€ä¸ªè®°å½•ï¼Œè¿™æ˜¯ä¸€ä¸ªæ’å…¥æ„å‘é”ã€‚ä¸ºäº†ä¾¿äºç†è§£ï¼Œä½ å¯ä»¥è®¤ä¸ºå®ƒå°±æ˜¯è¿™ä¸ªæ’å…¥åŠ¨ä½œæœ¬èº«ã€‚</li>\n<li>gap before rec è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªé—´éš™é”ï¼Œè€Œä¸æ˜¯è®°å½•é”ã€‚</li>\n</ul>\n</li>\n<li>\n<p>é‚£ä¹ˆè¿™ä¸ªgapæ˜¯åœ¨å“ªä¸ªè®°å½•ä¹‹å‰çš„å‘¢ï¼Ÿæ¥ä¸‹æ¥çš„0~4è¿™5è¡Œçš„å†…å®¹å°±æ˜¯è¿™ä¸ªè®°å½•çš„ä¿¡æ¯ã€‚</p>\n</li>\n<li>\n<p>n_fields 5ä¹Ÿè¡¨ç¤ºäº†ï¼Œè¿™ä¸€ä¸ªè®°å½•æœ‰5åˆ—ï¼š</p>\n<ul>\n<li>0: len 4; hex 0000000f; asc ;;ç¬¬ä¸€åˆ—æ˜¯ä¸»é”®idå­—æ®µï¼Œåå…­è¿›åˆ¶få°±æ˜¯id=15ã€‚æ‰€ä»¥ï¼Œè¿™æ—¶æˆ‘ä»¬å°±çŸ¥é“äº†ï¼Œè¿™ä¸ªé—´éš™å°±æ˜¯id=15ä¹‹å‰çš„ï¼Œå› ä¸ºid=10å·²ç»ä¸å­˜åœ¨äº†ï¼Œå®ƒè¡¨ç¤ºçš„å°±æ˜¯(5,15)ã€‚</li>\n<li>1: len 6; hex 000000000513; asc ;;ç¬¬äºŒåˆ—æ˜¯é•¿åº¦ä¸º6å­—èŠ‚çš„äº‹åŠ¡idï¼Œè¡¨ç¤ºæœ€åä¿®æ”¹è¿™ä¸€è¡Œçš„æ˜¯trx idä¸º1299çš„äº‹åŠ¡ã€‚</li>\n<li>2: len 7; hex b0000001250134; asc % 4;; ç¬¬ä¸‰åˆ—é•¿åº¦ä¸º7å­—èŠ‚çš„å›æ»šæ®µä¿¡æ¯ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„acsåé¢æœ‰æ˜¾ç¤ºå†…å®¹(%å’Œ4)ï¼Œè¿™æ˜¯å› ä¸ºåˆšå¥½è¿™ä¸ªå­—èŠ‚æ˜¯å¯æ‰“å°å­—ç¬¦ã€‚</li>\n<li>åé¢ä¸¤åˆ—æ˜¯cå’Œdçš„å€¼ï¼Œéƒ½æ˜¯15ã€‚</li>\n</ul>\n</li>\n</ol><p>å› æ­¤ï¼Œæˆ‘ä»¬å°±çŸ¥é“äº†ï¼Œç”±äºdeleteæ“ä½œæŠŠid=10è¿™ä¸€è¡Œåˆ æ‰äº†ï¼ŒåŸæ¥çš„ä¸¤ä¸ªé—´éš™(5,10)ã€(10,15ï¼‰å˜æˆäº†ä¸€ä¸ª(5,15)ã€‚</p><p>è¯´åˆ°è¿™é‡Œï¼Œä½ å¯ä»¥è”åˆèµ·æ¥å†æ€è€ƒä¸€ä¸‹è¿™ä¸¤ä¸ªç°è±¡ä¹‹é—´çš„å…³è”ï¼š</p><ol>\n<li>\n<p>session Aæ‰§è¡Œå®Œselectè¯­å¥åï¼Œä»€ä¹ˆéƒ½æ²¡åšï¼Œä½†å®ƒåŠ é”çš„èŒƒå›´çªç„¶â€œå˜å¤§â€äº†ï¼›</p>\n</li>\n<li>\n<p>ç¬¬21ç¯‡æ–‡ç« çš„è¯¾åæ€è€ƒé¢˜ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œselect * from t where c&gt;=15 and c&lt;=20 order by c desc lock in share mode; å‘å·¦æ‰«æåˆ°c=10çš„æ—¶å€™ï¼Œè¦æŠŠ(5, 10]é”èµ·æ¥ã€‚</p>\n</li>\n</ol><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€è°“â€œé—´éš™â€ï¼Œå…¶å®æ ¹æœ¬å°±æ˜¯ç”±â€œè¿™ä¸ªé—´éš™å³è¾¹çš„é‚£ä¸ªè®°å½•â€å®šä¹‰çš„ã€‚</p><h1>updateçš„ä¾‹å­</h1><p>çœ‹è¿‡äº†insertå’Œdeleteçš„åŠ é”ä¾‹å­ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªupdateè¯­å¥çš„æ¡ˆä¾‹ã€‚åœ¨ç•™è¨€åŒºä¸­@ä¿¡ä¿¡ åŒå­¦åšäº†è¿™ä¸ªè¯•éªŒï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/61/a7/61c1ceea7b59201649c2514c9db864a7.png?wh=1252*500\" alt=\"\"></p><center><span class=\"reference\">å›¾ 6 update çš„ä¾‹å­</span></center><p>ä½ å¯ä»¥è‡ªå·±åˆ†æä¸€ä¸‹ï¼Œsession Açš„åŠ é”èŒƒå›´æ˜¯ç´¢å¼•cä¸Šçš„ (5,10]ã€(10,15]ã€(15,20]ã€(20,25]å’Œ(25,supremum]ã€‚</p><blockquote>\n<p>æ³¨æ„ï¼šæ ¹æ®c&gt;5æŸ¥åˆ°çš„ç¬¬ä¸€ä¸ªè®°å½•æ˜¯c=10ï¼Œå› æ­¤ä¸ä¼šåŠ (0,5]è¿™ä¸ªnext-key lockã€‚</p>\n</blockquote><p>ä¹‹åsession Bçš„ç¬¬ä¸€ä¸ªupdateè¯­å¥ï¼Œè¦æŠŠc=5æ”¹æˆc=1ï¼Œä½ å¯ä»¥ç†è§£ä¸ºä¸¤æ­¥ï¼š</p><ol>\n<li>\n<p>æ’å…¥(c=1, id=5)è¿™ä¸ªè®°å½•ï¼›</p>\n</li>\n<li>\n<p>åˆ é™¤(c=5, id=5)è¿™ä¸ªè®°å½•ã€‚</p>\n</li>\n</ol><p>æŒ‰ç…§æˆ‘ä»¬ä¸Šä¸€èŠ‚è¯´çš„ï¼Œç´¢å¼•cä¸Š(5,10)é—´éš™æ˜¯ç”±è¿™ä¸ªé—´éš™å³è¾¹çš„è®°å½•ï¼Œä¹Ÿå°±æ˜¯c=10å®šä¹‰çš„ã€‚æ‰€ä»¥é€šè¿‡è¿™ä¸ªæ“ä½œï¼Œsession Açš„åŠ é”èŒƒå›´å˜æˆäº†å›¾7æ‰€ç¤ºçš„æ ·å­ï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/d2/e9/d2f6a0c46dd8d12f6a90dacc466d53e9.png?wh=1142*856\" alt=\"\"></p><center><span class=\"reference\">å›¾ 7 session Bä¿®æ”¹åï¼Œ session Açš„åŠ é”èŒƒå›´</span></center><p>å¥½ï¼Œæ¥ä¸‹æ¥session Bè¦æ‰§è¡Œ update t set c = 5 where c = 1è¿™ä¸ªè¯­å¥äº†ï¼Œä¸€æ ·åœ°å¯ä»¥æ‹†æˆä¸¤æ­¥ï¼š</p><ol>\n<li>\n<p>æ’å…¥(c=5, id=5)è¿™ä¸ªè®°å½•ï¼›</p>\n</li>\n<li>\n<p>åˆ é™¤(c=1, id=5)è¿™ä¸ªè®°å½•ã€‚</p>\n</li>\n</ol><p>ç¬¬ä¸€æ­¥è¯•å›¾åœ¨å·²ç»åŠ äº†é—´éš™é”çš„(1,10)ä¸­æ’å…¥æ•°æ®ï¼Œæ‰€ä»¥å°±è¢«å µä½äº†ã€‚</p><h1>å°ç»“</h1><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ç”¨å‰é¢<a href=\"https://time.geekbang.org/column/article/75173\">ç¬¬20</a>å’Œ<a href=\"https://time.geekbang.org/column/article/75659\">ç¬¬21ç¯‡</a>æ–‡ç« è¯„è®ºåŒºçš„å‡ ä¸ªé—®é¢˜ï¼Œå†æ¬¡è·Ÿä½ å¤ä¹ äº†åŠ é”è§„åˆ™ã€‚å¹¶ä¸”ï¼Œæˆ‘å’Œä½ é‡ç‚¹è¯´æ˜äº†ï¼Œåˆ†æåŠ é”èŒƒå›´æ—¶ï¼Œä¸€å®šè¦é…åˆè¯­å¥æ‰§è¡Œé€»è¾‘æ¥è¿›è¡Œã€‚</p><p>åœ¨æˆ‘çœ‹æ¥ï¼Œæ¯ä¸ªæƒ³è®¤çœŸäº†è§£MySQLåŸç†çš„åŒå­¦ï¼Œåº”è¯¥éƒ½è¦èƒ½å¤Ÿåšåˆ°ï¼šé€šè¿‡explainçš„ç»“æœï¼Œå°±èƒ½å¤Ÿè„‘è¡¥å‡ºä¸€ä¸ªSQLè¯­å¥çš„æ‰§è¡Œæµç¨‹ã€‚è¾¾åˆ°è¿™æ ·çš„ç¨‹åº¦ï¼Œæ‰ç®—æ˜¯å¯¹ç´¢å¼•ç»„ç»‡è¡¨ã€ç´¢å¼•ã€é”çš„æ¦‚å¿µæœ‰äº†æ¯”è¾ƒæ¸…æ™°çš„è®¤è¯†ã€‚ä½ åŒæ ·ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæ¥éªŒè¯è‡ªå·±å¯¹è¿™äº›çŸ¥è¯†ç‚¹çš„æŒæ¡ç¨‹åº¦ã€‚</p><p>åœ¨åˆ†æè¿™äº›åŠ é”è§„åˆ™çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¹Ÿé¡ºä¾¿è·Ÿä½ ä»‹ç»äº†æ€ä¹ˆçœ‹show engine innodb statusè¾“å‡ºç»“æœä¸­çš„äº‹åŠ¡ä¿¡æ¯å’Œæ­»é”ä¿¡æ¯ï¼Œå¸Œæœ›è¿™äº›å†…å®¹å¯¹ä½ ä»¥ååˆ†æç°åœºèƒ½æœ‰æ‰€å¸®åŠ©ã€‚</p><p>è€è§„çŸ©ï¼Œå³ä¾¿æ˜¯ç­”ç–‘æ–‡ç« ï¼Œæˆ‘ä¹Ÿè¿˜æ˜¯è¦ç•™ä¸€ä¸ªè¯¾åé—®é¢˜ç»™ä½ çš„ã€‚</p><p>ä¸Šé¢æˆ‘ä»¬æåˆ°ä¸€ä¸ªå¾ˆé‡è¦çš„ç‚¹ï¼šæ‰€è°“â€œé—´éš™â€ï¼Œå…¶å®æ ¹æœ¬å°±æ˜¯ç”±â€œè¿™ä¸ªé—´éš™å³è¾¹çš„é‚£ä¸ªè®°å½•â€å®šä¹‰çš„ã€‚</p><p>é‚£ä¹ˆï¼Œä¸€ä¸ªç©ºè¡¨æœ‰é—´éš™å—ï¼Ÿè¿™ä¸ªé—´éš™æ˜¯ç”±è°å®šä¹‰çš„ï¼Ÿä½ æ€ä¹ˆéªŒè¯è¿™ä¸ªç»“è®ºå‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ å…³äºåˆ†æå’ŒéªŒè¯æ–¹æ³•å†™åœ¨ç•™è¨€åŒºï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h1>ä¸ŠæœŸé—®é¢˜æ—¶é—´</h1><p>æˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« æœ€åç•™ç»™çš„é—®é¢˜ï¼Œæ˜¯åˆ†äº«ä¸€ä¸‹ä½ å…³äºä¸šåŠ¡ç›‘æ§çš„å¤„ç†ç»éªŒã€‚</p><p>åœ¨è¿™ç¯‡æ–‡ç« çš„è¯„è®ºåŒºï¼Œå¾ˆå¤šåŒå­¦éƒ½åˆ†äº«äº†ä¸é”™çš„ç»éªŒã€‚è¿™é‡Œï¼Œæˆ‘å°±é€‰æ‹©å‡ ä¸ªæ¯”è¾ƒå…¸å‹çš„ç•™è¨€ï¼Œå’Œä½ åˆ†äº«å§ï¼š</p><ul>\n<li>@è€æ¨åŒå¿— å›ç­”å¾—å¾ˆè¯¦ç»†ã€‚ä»–çš„ä¸»è¦æ€è·¯å°±æ˜¯å…³äºæœåŠ¡çŠ¶æ€å’ŒæœåŠ¡è´¨é‡çš„ç›‘æ§ã€‚å…¶ä¸­ï¼ŒæœåŠ¡çŠ¶æ€çš„ç›‘æ§ï¼Œä¸€èˆ¬éƒ½å¯ä»¥ç”¨å¤–éƒ¨ç³»ç»Ÿæ¥å®ç°ï¼›è€ŒæœåŠ¡çš„è´¨é‡çš„ç›‘æ§ï¼Œå°±è¦é€šè¿‡æ¥å£çš„å“åº”æ—¶é—´æ¥ç»Ÿè®¡ã€‚</li>\n<li>@Ryoma åŒå­¦ï¼Œæåˆ°æœåŠ¡ä¸­ä½¿ç”¨äº†healthCheckæ¥æ£€æµ‹ï¼Œå…¶å®è·Ÿæˆ‘ä»¬æ–‡ä¸­æåˆ°çš„select 1çš„æ¨¡å¼ç±»ä¼¼ã€‚</li>\n<li>@å¼ºå“¥ åŒå­¦ï¼ŒæŒ‰ç…§ç›‘æ§çš„å¯¹è±¡ï¼Œå°†ç›‘æ§åˆ†æˆäº†åŸºç¡€ç›‘æ§ã€æœåŠ¡ç›‘æ§å’Œä¸šåŠ¡ç›‘æ§ï¼Œå¹¶åˆ†äº«äº†æ¯ç§ç›‘æ§éœ€è¦å…³æ³¨çš„å¯¹è±¡ã€‚</li>\n</ul><p>è¿™äº›éƒ½æ˜¯å¾ˆå¥½çš„ç»éªŒï¼Œä½ ä¹Ÿå¯ä»¥æ ¹æ®å…·ä½“çš„ä¸šåŠ¡åœºæ™¯å€Ÿé‰´é€‚åˆè‡ªå·±çš„æ–¹æ¡ˆã€‚</p><p></p>","neighbors":{"left":{"article_title":"29 | å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ•°æ®åº“æ˜¯ä¸æ˜¯å‡ºé—®é¢˜äº†ï¼Ÿ","id":78134},"right":{"article_title":"31 | è¯¯åˆ æ•°æ®åé™¤äº†è·‘è·¯ï¼Œè¿˜èƒ½æ€ä¹ˆåŠï¼Ÿ","id":78658}},"comments":[{"had_liked":false,"id":62658,"user_name":"Ryoma","can_delete":false,"product_type":"c1","uid":1130590,"ip_address":"","ucode":"7F692369239692","user_header":"https://static001.geekbang.org/account/avatar/00/11/40/5e/b8fada94.jpg","comment_is_top":true,"comment_ctime":1548125307,"is_pvip":true,"replies":[{"id":"22180","content":"å—¯ æ‰€ä»¥æˆ‘è¿™é‡Œç‰¹åˆ«å°å¿ƒåœ°æ²¡æœ‰å†™â€œé”â€œè¿™ä¸ªå­—ã€‚<br><br>é—´éš™ (5,10)ã€(10,15ï¼‰æ˜¯å®¢è§‚å­˜åœ¨çš„ã€‚<br><br>ä½ æå¾—ä¹Ÿå¾ˆå¯¹ï¼Œâ€œé”â€æ˜¯æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰åŠ çš„ï¼Œæ˜¯ä¸€ä¸ªåŠ¨æ€çš„æ¦‚å¿µã€‚<br>è¿™ä¸ªé—®é¢˜ä¹Ÿèƒ½å¤Ÿè®©å¤§å®¶æ›´äº†è§£æˆ‘ä»¬æ ‡é¢˜çš„æ„æ€ï¼Œç½®é¡¶äº†å“ˆ ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":62658,"uid":"1264162","ip_address":"","utype":1,"ctime":1548129344,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":12,"race_medal":2,"score":"9.2233726525832008e+18","product_id":100020801,"comment_content":"åˆ é™¤æ•°æ®ï¼Œå¯¼è‡´é”æ‰©å¤§çš„æè¿°ï¼šâ€œå› æ­¤ï¼Œæˆ‘ä»¬å°±çŸ¥é“äº†ï¼Œç”±äº delete æ“ä½œæŠŠ id=10 è¿™ä¸€è¡Œåˆ æ‰äº†ï¼ŒåŸæ¥çš„ä¸¤ä¸ªé—´éš™ (5,10)ã€(10,15ï¼‰å˜æˆäº†ä¸€ä¸ª (5,15)ã€‚â€<br>æˆ‘è§‰å¾—è¿™ä¸ªæåˆ°çš„(5, 10) å’Œ (10, 15)ä¸¤ä¸ªé—´éš™ä¼šè®©äººæœ‰ç‚¹è¯¯è§£ï¼Œå®é™…ä¸Šåœ¨åˆ é™¤ä¹‹å‰é—´éš™é”åªæœ‰ä¸€ä¸ª(10, 15)ï¼Œåˆ é™¤äº†æ•°æ®ä¹‹åï¼Œå¯¼è‡´é—´éš™é”å·¦ä¾§æ‰©å¼ æˆäº†5ï¼Œé—´éš™é”æˆä¸ºäº†(5, 15)ã€‚","like_count":144,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437293,"discussion_content":"å—¯ æ‰€ä»¥æˆ‘è¿™é‡Œç‰¹åˆ«å°å¿ƒåœ°æ²¡æœ‰å†™â€œé”â€œè¿™ä¸ªå­—ã€‚\n\né—´éš™ (5,10)ã€(10,15ï¼‰æ˜¯å®¢è§‚å­˜åœ¨çš„ã€‚\n\nä½ æå¾—ä¹Ÿå¾ˆå¯¹ï¼Œâ€œé”â€æ˜¯æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰åŠ çš„ï¼Œæ˜¯ä¸€ä¸ªåŠ¨æ€çš„æ¦‚å¿µã€‚\nè¿™ä¸ªé—®é¢˜ä¹Ÿèƒ½å¤Ÿè®©å¤§å®¶æ›´äº†è§£æˆ‘ä»¬æ ‡é¢˜çš„æ„æ€ï¼Œç½®é¡¶äº†å“ˆ ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548129344,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1031683,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/be/03/404edf37.jpg","nickname":"å°åŠ¨ç‰©","note":"","ucode":"BCC35CE768EB99","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":379514,"discussion_content":"åŸæ–‡è¿™æ®µè¯ï¼Œï¼Œï¼Œæˆ‘çœ‹äº†åæ¥åˆ†é’Ÿï¼Œæ²¡å¤ªç†è§£ã€‚çœ‹äº†è¯„è®ºç»ˆäºæ‡‚äº†ã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1623933927,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1018620,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8a/fc/d1dd57dd.jpg","nickname":"ipofss","note":"","ucode":"DE3061C9259F9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":185233,"discussion_content":"æˆ‘ä¹Ÿæœ‰è¿™ä¸ªç–‘é—®ï¼Œç°åœ¨æ˜ç™½äº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1582606093,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1817694,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/bc/5e/eefba15b.jpg","nickname":"Cooo","note":"","ucode":"6B099F66F25202","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578680,"discussion_content":"æˆ‘è¯•äº†ä¸€ä¸‹ï¼Œå’Œè€å¸ˆè¯´çš„æœ‰å‡ºå…¥ï¼Œäº‹åŠ¡Bä¸­åˆ é™¤id=10è¿™ä¸€è¡Œï¼Œåè¿˜å¯ä»¥æ’å…¥æˆåŠŸï¼Œæ„Ÿè§‰å¹¶æ²¡æœ‰æ‰©å¤§é”èŒƒå›´ã€‚æœ‰äººèƒ½è§£ç­”ä¸€ä¸‹å—\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656941249,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1543162,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/fa/103e6900.jpg","nickname":"å±±é¬¼è°£","note":"","ucode":"E25F498B85A01B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535000,"discussion_content":"è¿˜å¥½æˆ‘çœ‹äº†è¯„è®ºï¼Œä½œè€…æ€è·¯è½¬å˜å¿«äº†äº›ã€‚æˆ‘è‡ªå·±æ¨å°±æ¨å‡ºäº†ä¸€ä¸ªé—´éš™é”ï¼Œæˆ‘è¿˜ä»¥ä¸ºæˆ‘å­¦é”™äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638329894,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1187160,"avatar":"https://static001.geekbang.org/account/avatar/00/12/1d/58/fb740847.jpg","nickname":"éšå¿ƒè€ŒåŠ¨","note":"","ucode":"3A59D3EC728265","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":532120,"discussion_content":"ç‰›ç‰›ç‰›ï¼Œæˆ‘è¯´æ€ä¹ˆå®éªŒä¸å‡ºæ¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637542217,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1926222,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/64/4e/83c61c7f.jpg","nickname":"é“ä»”","note":"","ucode":"077A290A2DCF42","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375595,"discussion_content":"ç¡®å® çœ‹åˆ°é‚£çš„æ—¶å€™ç¡®å®ä»¥ä¸ºæˆ‘é”™äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621760773,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2558430,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJjbYMNwhsazNatHcxQ7L9MXTq2zurFrnZHWZxsWY55czDxSerHAeibrvwZB7t6CqoDfjMM2nWDHmg/132","nickname":"Geek_73fe59","note":"","ucode":"123D06150ADBFA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368192,"discussion_content":"Ryomaçš„è¯„è®ºä¸å®Œå…¨æ­£ç¡®ï¼Œé—´éš™é”è¿˜æœ‰ï¼ˆ15,20]","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618590397,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":2448277,"avatar":"https://static001.geekbang.org/account/avatar/00/25/5b/95/462890c6.jpg","nickname":"å¶æ¶›","note":"","ucode":"B45348979BE159","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2558430,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJjbYMNwhsazNatHcxQ7L9MXTq2zurFrnZHWZxsWY55czDxSerHAeibrvwZB7t6CqoDfjMM2nWDHmg/132","nickname":"Geek_73fe59","note":"","ucode":"123D06150ADBFA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":370463,"discussion_content":"äººå®¶è¯´çš„æ˜¯8.0.18ä»¥åé«˜ç‰ˆæœ¬äº†ï¼Œæ²¡æœ‰å”¯ä¸€ç´¢å¼•èŒƒå›´åŠ é”çš„BUGäº†","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1619424025,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":368192,"ip_address":""},"score":370463,"extra":""},{"author":{"id":2862052,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/ab/e4/9c64475b.jpg","nickname":"å¬é£","note":"","ucode":"4BB3F3F790825B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2558430,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJjbYMNwhsazNatHcxQ7L9MXTq2zurFrnZHWZxsWY55czDxSerHAeibrvwZB7t6CqoDfjMM2nWDHmg/132","nickname":"Geek_73fe59","note":"","ucode":"123D06150ADBFA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542770,"discussion_content":"é—´éš™é”ä¸åº”è¯¥æ˜¯ (15, 20)å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640839808,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":368192,"ip_address":""},"score":542770,"extra":""},{"author":{"id":2389270,"avatar":"https://static001.geekbang.org/account/avatar/00/24/75/16/6e28bf17.jpg","nickname":"åˆæ™¨","note":"","ucode":"C5D95D13E49127","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2862052,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/ab/e4/9c64475b.jpg","nickname":"å¬é£","note":"","ucode":"4BB3F3F790825B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585477,"discussion_content":"èŒƒå›´æŸ¥è¯¢ï¼Œæ²¡æœ‰ä¼˜åŒ–åŸåˆ™ï¼Œå› æ­¤ä¸é€€åŒ–ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661588460,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":542770,"ip_address":"é™•è¥¿"},"score":585477,"extra":""}]},{"author":{"id":1587367,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/kDAfyOQibroSCUliaG2tiachpaKyuPGd6eyRe20ibvb3R1QjSrLSufevBIOLQjAJpricM6mqeJJ4pccnbgKIfvoFnKw/132","nickname":"Geek_bcdbd4","note":"","ucode":"681F337C89A216","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":342988,"discussion_content":"è°¢è°¢ï¼Œè§£ç­”äº†æˆ‘çš„ç–‘é—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610893305,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62715,"user_name":"ä»¤ç‹å°‘ä¾ ","can_delete":false,"product_type":"c1","uid":1334516,"ip_address":"","ucode":"36390E67AF0779","user_header":"https://static001.geekbang.org/account/avatar/00/14/5c/f4/88f107d9.jpg","comment_is_top":true,"comment_ctime":1548141535,"is_pvip":false,"replies":[{"id":"22243","content":"å¯¹ï¼Œ å¥½é—®é¢˜<br>lock_mode X waitingè¡¨ç¤ºnext-key lockï¼›<br>lock_mode X locks rec but not gapæ˜¯åªæœ‰è¡Œé”ï¼›<br>è¿˜æœ‰ä¸€ç§ â€œlocks gap before recâ€ï¼Œå°±æ˜¯åªæœ‰é—´éš™é”ï¼›<br>","user_name":"ä½œè€…å›å¤","comment_id":62715,"uid":"1264162","ip_address":"","utype":1,"ctime":1548215829,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":2,"race_medal":0,"score":"9.2233723862953001e+18","product_id":100020801,"comment_content":"æœ‰ä¸ªé—®é¢˜æƒ³ç¡®è®¤ä¸‹ï¼Œåœ¨æ­»é”æ—¥å¿—é‡Œï¼Œlock_mode X waitingæ˜¯é—´éš™é”+è¡Œé”ï¼Œlock_mode X locks rec but not gapè¿™ç§åŠ but not gapæ‰æ˜¯è¡Œé”ï¼Ÿ<br>è€å¸ˆä½ åé¢èƒ½è¯´ä¸‹group byçš„åŸç†å—ï¼Œæˆ‘çœ‹ç›®å½•é‡Œé¢æ²¡æœ‰","like_count":82,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437317,"discussion_content":"å¯¹ï¼Œ å¥½é—®é¢˜\nlock_mode X waitingè¡¨ç¤ºnext-key lockï¼›\nlock_mode X locks rec but not gapæ˜¯åªæœ‰è¡Œé”ï¼›\nè¿˜æœ‰ä¸€ç§ â€œlocks gap before recâ€ï¼Œå°±æ˜¯åªæœ‰é—´éš™é”ï¼›\n","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1548215829,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2009461,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/a9/75/dbccd12d.jpg","nickname":"ç¨»è‰äºº","note":"","ucode":"6694EE2CD36B8C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":356511,"discussion_content":"group byåŸç†æˆ‘ä¹Ÿæƒ³çŸ¥é“ï¼ï¼ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615614479,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":66207,"user_name":"IceGeek17","can_delete":false,"product_type":"c1","uid":1103101,"ip_address":"","ucode":"1B42D7260449B4","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/fd/43802282.jpg","comment_is_top":false,"comment_ctime":1549892184,"is_pvip":false,"replies":[{"id":"25269","content":"1. å¯¹çš„<br><br>2. å¯¹çš„<br><br>3. â€œå› ä¸ºæ‰«åˆ°äº†c=10ï¼Œæ‰€ä»¥ä¼šåŠ next-key lock (5,10]â€ï¼Œ å¯¹çš„ã€‚ <br>    ç¬¬äºŒä¸ªâ€œå¦‚æœâ€ï¼Œå®ç°ä¸Šå¹¶ä¸æ˜¯è¿™æ ·çš„ï¼Œæ‰€ä»¥æ²¡æ³•å›ç­”ğŸ˜†<br>","user_name":"ä½œè€…å›å¤","comment_id":66207,"uid":"1264162","ip_address":"","utype":1,"ctime":1551186229,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":8,"race_medal":0,"score":"229183158872","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ–°å¹´å¥½ï¼Œæœ‰å‡ ä¸ªé—®é¢˜ï¼š<br>é—®é¢˜ä¸€ï¼š<br>å¯¹äºæ–‡ä¸­çš„ç¬¬ä¸€ä¸ªä¾‹å­ï¼ˆä¸ç­‰å·æ¡ä»¶é‡Œçš„ç­‰å€¼æŸ¥è¯¢ï¼‰ï¼Œå½“è¯•å›¾å»æ‰¾ â€œç¬¬ä¸€ä¸ªid&lt;12çš„å€¼&quot;çš„æ—¶å€™ï¼Œç”¨çš„è¿˜æ˜¯ä»å·¦å¾€å³çš„éå†ï¼ˆå› ä¸ºç”¨åˆ°äº†ä¼˜åŒ–2ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å»æ‰¾ç¬¬ä¸€ä¸ªç­‰å€¼çš„æ—¶å€™ï¼ˆé€šè¿‡æ ‘æœç´¢å»å®šä½è®°å½•çš„æ—¶å€™ï¼‰ï¼Œå³ä½¿order by descï¼Œä½†ç”¨çš„è¿˜æ˜¯å‘å³éå†ï¼Œå½“æ‰¾åˆ°äº†ç¬¬ä¸€ä¸ªç­‰å€¼çš„æ—¶å€™ï¼ˆä¾‹å­ä¸­çš„id=15ï¼‰ï¼Œç„¶åæ ¹æ®order by descï¼Œå†å‘å·¦éå†ã€‚<br>æ˜¯ä¸æ˜¯è¿™ä¹ˆç†è§£ï¼Ÿ<br><br>é—®é¢˜äºŒï¼š<br>å¯¹äºç¬¬21è®²çš„æ€è€ƒé¢˜ï¼Œ select * from t where c&gt;=15 and c&lt;=20 order by c desc lock in share modeï¼Œ è€å¸ˆå·²ç»ç»™å‡ºäº†ç­”æ¡ˆï¼Œæˆ‘è¿™é‡Œå†è¯¦ç»†ç†è§£ä¸€ä¸‹ï¼š<br>å…ˆå®šä½ç´¢å¼•cä¸Šæœ€å³è¾¹c=20çš„è¡Œï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªç­‰å€¼æŸ¥è¯¢ä¼šæ‰«æåˆ°c=25ï¼Œç„¶åé€šè¿‡ä¼˜åŒ–2ï¼Œnext-key locké€€åŒ–ä¸ºé—´éš™é”ï¼Œåˆ™ä¼šåŠ ä¸Šé—´éš™é”ï¼ˆ20ï¼Œ25ï¼‰ï¼Œç´§æ¥ç€å†å‘å·¦éå†ï¼Œä¼šåŠ  next-key lock (15, 20], (10, 15], å› ä¸ºè¦æ‰«æåˆ°c=10æ‰åœä¸‹æ¥ï¼Œæ‰€ä»¥ä¹Ÿä¼šåŠ next-key lock (5,10]<br>ç†è§£çš„æ˜¯å¦æ­£ç¡®ï¼Ÿ<br><br>é—®é¢˜ä¸‰ï¼š<br>å¯¹äºä¸Šé¢çš„é—®é¢˜äºŒçš„sqlï¼Œåœ¨ç´¢å¼•cä¸Šï¼ŒæŠŠï¼ˆ10ï¼Œ25ï¼‰è¿™æ®µåŒºé—´é”ä¸Šå°±åº”è¯¥æ˜¯å®Œå¤‡çš„äº†ï¼Œç†è®ºä¸Šï¼ˆ5ï¼Œ10]è¿™æ®µåŒºé—´æ˜¯å¦é”ä¸Šå¯¹ç»“æœåº”è¯¥æ²¡æœ‰å½±å“å‘€ã€‚<br>æ˜¯ä¸æ˜¯è¯´MySQLå°±æ˜¯è¿™ä¹ˆå®ç°çš„ï¼Œnext-key lockå‰å¼€åé—­ï¼Œå› ä¸ºæ‰«åˆ°äº†c=10ï¼Œæ‰€ä»¥ä¼šåŠ next-key lock (5,10]ï¼Œè¿™é‡ŒMySQLçš„å®ç°æ‰©å¤§äº†é”çš„åŒºé—´èŒƒå›´ï¼Œå…¶å®æ²¡æœ‰è¿™ä¸ªå¿…è¦ï¼Ÿ<br>å¦å¤–ï¼Œå¦‚æœä¸åŠ next-key lock (5,10]ï¼Œæ˜¯ä¸æ˜¯è¿™é‡Œc=10è¿˜æ˜¯åº”è¯¥è¦é”çš„ï¼Œå¦‚æœä¸é”å¯èƒ½è¢«åˆ é™¤ï¼Ÿ<br><br>","like_count":53,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438750,"discussion_content":"1. å¯¹çš„\n\n2. å¯¹çš„\n\n3. â€œå› ä¸ºæ‰«åˆ°äº†c=10ï¼Œæ‰€ä»¥ä¼šåŠ next-key lock (5,10]â€ï¼Œ å¯¹çš„ã€‚ \n    ç¬¬äºŒä¸ªâ€œå¦‚æœâ€ï¼Œå®ç°ä¸Šå¹¶ä¸æ˜¯è¿™æ ·çš„ï¼Œæ‰€ä»¥æ²¡æ³•å›ç­”ğŸ˜†\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551186229,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1672786,"avatar":"https://static001.geekbang.org/account/avatar/00/19/86/52/91c7d112.jpg","nickname":"Garen","note":"","ucode":"0608C88F83EF0C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":41420,"discussion_content":"ç¬¬3ä¸ªé—®é¢˜ï¼ŒçœŸçš„ä¼šè®©äººè§‰å¾—mysqlå¾ˆå‚»ã€‚ä½†æ˜¯ æ˜¯ç¬¦åˆè€å¸ˆçš„ä¸¤ä¸ªåŸåˆ™çš„ã€‚æ¡ä»¶>=15,å‘å·¦æ‰«æåˆ°15æ—¶ï¼ŒèŒƒå›´æŸ¥æ‰¾>å°±ç»“æŸäº†ï¼Œå› ä¸ºä¸æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œæ‰€ä»¥è¿˜è¦ç»§ç»­å‘å·¦æ‰«æ=15ã€‚ç›´åˆ°æ‰«æåˆ°10ï¼Œæ ¹æ®åŸåˆ™2ï¼Œæ‰«æåˆ°çš„éƒ½åŠ é”ï¼Œæ‰€ä»¥10æ˜¯è¦åŠ é”çš„ã€‚ä½†æ˜¯åŸåˆ™1ï¼ŒåŠ é”çš„å•ä½æ˜¯next-key lockï¼Œæ‰€ä»¥åŠ äº†(5ï¼Œ10]ã€‚\n\næ„Ÿè§‰mysqlå‚»ï¼Œæ˜¯å› ä¸ºä¼˜åŒ–2ï¼Œåªé€‚ç”¨äºå‘å³éå†ã€‚è¿™ä¸ªä¾‹å­æ˜¯å‘å·¦éå†çš„ã€‚è€Œä¸”next-key lockå·¦å¼€å³é—­æœ‰ç‚¹æ­»æ¿äº†ã€‚åº”è¯¥ASCå·¦å¼€å³é—­ï¼ŒDESCå·¦é—­å³å¼€ã€‚è¿™æ ·ä¼˜åŒ–2å‘å·¦ä¹Ÿèƒ½ç”±æ–°å®šä¹‰çš„next-key lock é€€åŒ–ä¸ºé—´éš™é”äº†ã€‚åŠ é”èŒƒå›´å°±æ˜¯(10,25)ã€‚10è¿™æ¡æ•°æ®ä¹Ÿä¸ç”¨åŠ é”ï¼Œå¦‚æœçœŸè¢«åˆ äº†ï¼Œæ ¹æ®é—´éš™é”çš„å®šä¹‰ï¼Œé”èŒƒå›´è‡ªç„¶ä¼šæ‰©å¤§","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1572422942,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1261360,"avatar":"https://static001.geekbang.org/account/avatar/00/13/3f/30/23f6b413.jpg","nickname":"äº”åä¹ç§’","note":"","ucode":"1F34F62193CFF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1672786,"avatar":"https://static001.geekbang.org/account/avatar/00/19/86/52/91c7d112.jpg","nickname":"Garen","note":"","ucode":"0608C88F83EF0C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308019,"discussion_content":"å—¯ï¼ŒèµåŒã€‚æ„Ÿè§‰åƒæ˜¯å†å²é—ç•™é—®é¢˜ï¼Œè„‘è¡¥äº†ä¸€ä¸‹å®ç°æ–¹æ¡ˆï¼Œä»ç¨‹åºè®¾è®¡è§’åº¦æ¥è¯´ï¼Œè¿™æ ·å®ç°èµ·æ¥è®¾è®¡æ€æƒ³ç»Ÿä¸€ï¼Œæ²¡æœ‰è€ƒè™‘åˆ°å¯¹descçš„ç‰¹æ®Šä¼˜åŒ–ã€‚ä»¥å·¦å³å­˜åœ¨çš„è®°å½•ä½œä¸ºé—´éš™åŠ é”ä¹Ÿæ‰©å¤§äº†é—´éš™é”çš„èŒƒå›´ï¼Œä½†è¿™æ ·çš„è®¾è®¡åº”è¯¥æ˜¯æœ€æ¸…æ™°çš„ï¼Œå¹¶ä¸”å¹³æ—¶çš„åº”ç”¨åœºæ™¯åˆå¤§å¤šæ˜¯å†™å°‘è¯»å¤šã€‚ç»¼ä¸Šæ„Ÿè§‰æœ‰äº›åº”è¯¥æ˜¯æƒè¡¡å’Œå†å²é—ç•™çš„é—®é¢˜ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1600826722,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":41420,"ip_address":""},"score":308019,"extra":""},{"author":{"id":1887586,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLhicDSmL4vicPADhxxzOzukMar8nV5Tc3ic2dz4FQIxMX3WmX5a2V3sdD121eWpvfQI8NXIkkDZoDFw/132","nickname":"Geek_536b54","note":"","ucode":"F62BC7781D9212","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1672786,"avatar":"https://static001.geekbang.org/account/avatar/00/19/86/52/91c7d112.jpg","nickname":"Garen","note":"","ucode":"0608C88F83EF0C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335192,"discussion_content":"DESC ä¸èƒ½å·¦é—­å³å¼€ è€å¸ˆè¿™ä¸ªä¾‹å­åªæ˜¯è¯´æ˜ï¼Œå‡å¦‚ç›®å‰Cç´¢å¼• 0 5 10 10 15 20 25 å‘¢ æ˜æ˜æ˜¯åˆ°å·¦è¾¹ç¬¬ä¸€ä¸ª10å°±ä¸æ»¡è¶³æ¡ä»¶ï¼Œå·¦é—­ä¼šæŠŠæœ€å·¦è¾¹ç¬¬äºŒä¸ª10ä¹ŸåŒ…æ‹¬åœ¨å†…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608113637,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":41420,"ip_address":""},"score":335192,"extra":""}]},{"author":{"id":1649282,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLGAV2NgUo0VVNjiagIJCZmPHvogtAJcUib6icLCbR4vcvfziashHZjpZ0FUxSdawFnHGUSmIaePvDaWQ/132","nickname":"Geek_b74670","note":"","ucode":"083AF837FB0112","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":8289,"discussion_content":"é—®é¢˜2æè¿°çš„å¾ˆè¯¦ç»†ï¼ŒåŒæ—¶ä¹ŸæŠŠä¾‹å­1çš„è¿‡ç¨‹ä¹Ÿæè¿°å‡ºæ¥äº†ï¼Œåœ¨ä½ çš„æç¤ºä¸‹ï¼Œç»ˆäºæŠŠè¡Œé”ï¼Œgap lockï¼Œnext-key lockæ€ä¹ˆåŠ ææ‡‚äº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1567876236,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1641131,"avatar":"","nickname":"æœ¨æœ¨å¤•","note":"","ucode":"AD74A0CD183EF3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6180,"discussion_content":"é—®é¢˜2ä¸­æ‰«æåˆ°c=10åœä¸‹æ¥å·²ç»ä¸æ»¡è¶³æ¡ä»¶äº†ï¼Œä¸ºå•¥è¿˜è¦ç»§ç»­å‘å·¦æ‰«æé”ä½ï¼ˆ5ï¼Œ10]å‘¢ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566745487,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1351117,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/2au3iaQvydOVeVY1vlSVeGia7SvrpWFVibdxdjKiafof3RhzFO9e8sxKIBxKXJQibRNpO9pCH2hmibkibsGv7YKF3yjEw/132","nickname":"ç§‹ä¸€åŒ¹","note":"","ucode":"BEBDBF8C15C6BC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1641131,"avatar":"","nickname":"æœ¨æœ¨å¤•","note":"","ucode":"AD74A0CD183EF3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":281710,"discussion_content":"åŠ é”çš„åŸºæœ¬å•ä½æ˜¯next key lock","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1591796608,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":6180,"ip_address":""},"score":281710,"extra":""},{"author":{"id":1333649,"avatar":"https://static001.geekbang.org/account/avatar/00/14/59/91/fa2d8bb2.jpg","nickname":"ä¸åƒè¾£ğŸ‘¾","note":"","ucode":"B25E0725B5E85F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1641131,"avatar":"","nickname":"æœ¨æœ¨å¤•","note":"","ucode":"AD74A0CD183EF3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383252,"discussion_content":"çœŸç›¸åªæœ‰ä¸€ä¸ªï¼Œæ‡’å¾—é‡Šæ”¾ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626012387,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":6180,"ip_address":""},"score":383252,"extra":""}]}]},{"had_liked":false,"id":62613,"user_name":"Jason_é¹","can_delete":false,"product_type":"c1","uid":1179329,"ip_address":"","ucode":"4A3DCAAC531724","user_header":"https://static001.geekbang.org/account/avatar/00/11/fe/c1/6c99fff4.jpg","comment_is_top":false,"comment_ctime":1548120287,"is_pvip":false,"replies":[{"id":"22162","content":"æ ¹æ®c&gt;5æŸ¥åˆ°çš„ç¬¬ä¸€ä¸ªè®°å½•æ˜¯c=10ï¼Œå› æ­¤ä¸ä¼šåŠ (0,5]è¿™ä¸ªnext-key lockã€‚<br><br>ä½ æé†’å¾—å¯¹ï¼Œæˆ‘åº”è¯¥å¤šè¯´æ˜è¿™å¥ï¼Œ æˆ‘åŠ åˆ°æ–‡ç¨¿ä¸­å•¦ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":62613,"uid":"1264162","ip_address":"","utype":1,"ctime":1548124349,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":7,"race_medal":0,"score":"151871975647","product_id":100020801,"comment_content":"æœ€åä¸€ä¸ªupdateçš„ä¾‹å­ï¼Œä¸ºæ²¡æœ‰åŠ ï¼ˆ0ï¼Œ5ï¼‰çš„é—´éš™å‘¢ï¼Ÿæˆ‘ç†è§£åº”è¯¥æ˜¯å…ˆæ‹¿cï¼5å»b+æ ‘æœç´¢ï¼ŒæŒ‰ç…§é—´éš™ç´¢æœ€å³åŸåˆ™ï¼Œåº”è¯¥ä¼šåŠ ï¼ˆ0ï¼Œ5]çš„é—´éš™ï¼Œç„¶åcï¼5ä¸æ»¡è¶³å¤§äº5æ¡ä»¶ï¼Œæ ¹æ®ä¼˜åŒ–2åŸåˆ™é€€åŒ–æˆï¼ˆ0ï¼Œ5ï¼‰çš„é—´éš™ç´¢ï¼Œæˆ‘æ˜¯è¿™æ ·ç†è§£çš„","like_count":35,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437277,"discussion_content":"æ ¹æ®c&amp;gt;5æŸ¥åˆ°çš„ç¬¬ä¸€ä¸ªè®°å½•æ˜¯c=10ï¼Œå› æ­¤ä¸ä¼šåŠ (0,5]è¿™ä¸ªnext-key lockã€‚\n\nä½ æé†’å¾—å¯¹ï¼Œæˆ‘åº”è¯¥å¤šè¯´æ˜è¿™å¥ï¼Œ æˆ‘åŠ åˆ°æ–‡ç¨¿ä¸­å•¦ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548124349,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"ä¸€å…ƒ(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":305985,"discussion_content":"æˆ‘æƒ³ç³»ç»Ÿæ˜¯å¦‚ä½•çŸ¥é“ç¬¬ä¸€æ¡å°±æŸ¥c=10è¿™æ¡è®°å½•çš„ï¼Ÿä¸åº”è¯¥å…ˆæŸ¥c=5è¿™æ¡è®°å½•ç„¶åå‘åéå†å—ï¼ŸæŸ¥æ‰¾è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„å¯¹è±¡éƒ½ä¼šåŠ é”å‘€ï¼ä¸å…ˆå®šä½åˆ°c=5ï¼Œç³»ç»Ÿæ˜¯æ€ä¹ˆçŸ¥é“ç›´æ¥æŸ¥è¯¢c=10çš„ï¼Ÿ","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1600142022,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1261360,"avatar":"https://static001.geekbang.org/account/avatar/00/13/3f/30/23f6b413.jpg","nickname":"äº”åä¹ç§’","note":"","ucode":"1F34F62193CFF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"ä¸€å…ƒ(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308025,"discussion_content":"åº”è¯¥æ˜¯B+æ ‘çš„å®šä½åŠŸèƒ½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600827197,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":305985,"ip_address":""},"score":308025,"extra":""},{"author":{"id":1543040,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/80/8702bd5f.jpg","nickname":"evan","note":"","ucode":"491B073D5AFEDE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"ä¸€å…ƒ(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":320040,"discussion_content":"ä¹Ÿæœ‰åŒæ ·çš„ç–‘é—®...","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1604229911,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":305985,"ip_address":""},"score":320040,"extra":""},{"author":{"id":1543162,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/fa/103e6900.jpg","nickname":"å±±é¬¼è°£","note":"","ucode":"E25F498B85A01B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"ä¸€å…ƒ(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535036,"discussion_content":"æˆ‘çš„ç†è§£ï¼šé€šè¿‡B+æ•°æ‰¾åˆ°c=10,æ‰¾çš„è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°c=5ï¼Œä½†æ˜¯é—´éš™é”ï¼Œåº”è¯¥é”çš„æ˜¯å¶å­èŠ‚ç‚¹ï¼Œéå†ä¹Ÿæ˜¯éå†å¶å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥ç­‰å€¼æŸ¥è¯¢æ‰ä¼šè¢«å®šä¹‰ä¸ºï¼šé€šè¿‡æ ‘æœç´¢çš„æ–¹å¼æ¥å®šä½è®°å½•ã€‚è€Œåé€šè¿‡å¶å­èŠ‚ç‚¹(æ­¤æ—¶å·²ç»å®šä½åˆ°c=10)çš„å¾€å³éå†ã€‚\nå³ï¼šéå¶å­èŠ‚ç‚¹é‡åˆ°çš„ï¼Œä¸ä¼šåŠ é”ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638339808,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":305985,"ip_address":""},"score":535036,"extra":""}]},{"author":{"id":1211790,"avatar":"https://static001.geekbang.org/account/avatar/00/12/7d/8e/bb16d414.jpg","nickname":"Wangxi","note":"","ucode":"C25A9A14179930","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":257363,"discussion_content":"è¿™ä¸ªåšäº†å®éªŒï¼Œ(0,5) åŒºé—´æ˜¯æ²¡åŠ é”çš„ï¼Œ id > 10 ä¹Ÿåšäº†å®éªŒ (5, 10)ä¹Ÿæ˜¯æ²¡æœ‰åŠ é”çš„ã€‚ mysql8.0.18","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1588562291,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62571,"user_name":"é•¿æ°","can_delete":false,"product_type":"c1","uid":1312212,"ip_address":"","ucode":"DD52C9494005F7","user_header":"https://static001.geekbang.org/account/avatar/00/14/05/d4/e06bf86d.jpg","comment_is_top":false,"comment_ctime":1548115271,"is_pvip":false,"replies":[{"id":"22149","content":"select * from t where c&gt;=15 and c&lt;=20 order by c desc in share mode;<br><br>è¿™ä¸ªè¯­å¥æ˜¯æ ¹æ® c=20 æ¥æŸ¥æ•°æ®çš„ï¼Œæ‰€ä»¥åŠ é”(20,25]çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ä¼˜åŒ–2ï¼›<br><br>select * from t where id&gt;10 and id&lt;=15 for updateï¼›<br>è¿™é‡Œçš„id=20ï¼Œæ˜¯ç”¨â€œå‘å³éå†â€çš„æ–¹å¼å¾—åˆ°çš„ï¼Œæ²¡æœ‰ä¼˜åŒ–ï¼ŒæŒ‰ç…§â€œä»¥next-key lockâ€ä¸ºåŠ é”å•ä½æ¥æ‰§è¡Œ<br><br>","user_name":"ä½œè€…å›å¤","comment_id":62571,"uid":"1264162","ip_address":"","utype":1,"ctime":1548119134,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":10,"race_medal":0,"score":"83152493895","product_id":100020801,"comment_content":"è€å¸ˆï¼Œä¹‹å‰è®²è¿™ä¸ªä¾‹å­æ—¶ï¼Œselect * from t where c&gt;=15 and c&lt;=20 order by c desc in share mode;<br>æœ€å³è¾¹åŠ çš„æ˜¯ (20, 25)çš„é—´éš™é”ï¼Œ<br>è€Œè¿™ä¸ªä¾‹å­select * from t where id&gt;10 and id&lt;=15 for updateä¸­ï¼Œæœ€å³è¾¹åŠ çš„æ˜¯(15,20]çš„next-keyé”ï¼Œ<br>è¿™ä¸¤ä¸ªæŸ¥è¯¢ä¸ºä½•æœ€åè¾¹ä¸€ä¸ªåŠ çš„gapé”ï¼Œä¸€ä¸ªåŠ çš„next-keyé”ï¼Œä»–ä»¬éƒ½æ˜¯&lt;=çš„ç­‰å€¼èŒƒå›´æŸ¥è¯¢ï¼ŒåŒºåˆ«åœ¨å“ªé‡Œï¼Ÿ","like_count":19,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437261,"discussion_content":"select * from t where c&amp;gt;=15 and c&amp;lt;=20 order by c desc in share mode;\n\nè¿™ä¸ªè¯­å¥æ˜¯æ ¹æ® c=20 æ¥æŸ¥æ•°æ®çš„ï¼Œæ‰€ä»¥åŠ é”(20,25]çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ä¼˜åŒ–2ï¼›\n\nselect * from t where id&amp;gt;10 and id&amp;lt;=15 for updateï¼›\nè¿™é‡Œçš„id=20ï¼Œæ˜¯ç”¨â€œå‘å³éå†â€çš„æ–¹å¼å¾—åˆ°çš„ï¼Œæ²¡æœ‰ä¼˜åŒ–ï¼ŒæŒ‰ç…§â€œä»¥next-key lockâ€ä¸ºåŠ é”å•ä½æ¥æ‰§è¡Œ\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548119134,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1508329,"avatar":"https://static001.geekbang.org/account/avatar/00/17/03/e9/6358059c.jpg","nickname":"GalaxyCreater","note":"","ucode":"C79E8A088D57CF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":263146,"discussion_content":"select * from t where id>10 and id<=15 for update ä½ æŠŠè¿™é‡Œçš„idæ¢æˆcåŠ é”æ–¹å¼å°±ä¸€æ ·äº†ï¼Œå”¯ä¸€ç´¢å¼•å’Œæ™®é€šç´¢å¼•çš„åŒºåˆ«ã€‚å”¯ä¸€ç´¢å¼•èŒƒå›´é”bug","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1589180101,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1117597,"avatar":"https://static001.geekbang.org/account/avatar/00/11/0d/9d/58d09086.jpg","nickname":"è¾¾è¾¾é˜Ÿé•¿","note":"","ucode":"1C3F2E4F6B7637","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":265103,"discussion_content":"idæ˜¯ä¸»é”®ï¼Œå”¯ä¸€ç´¢å¼•ï¼Œå®šä½åˆ°15å°±ç»“æŸäº†\ncä¸æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œåˆ°20è¿˜å¾—å¾€åçœ‹çœ‹ï¼Œå‘ç°æ˜¯25ï¼Œé€€åŒ–","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1589375122,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1937062,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/8e/a6/c3286b61.jpg","nickname":"Javaå’å¢™å·¥ç¨‹å¸ˆ","note":"","ucode":"E76AE44A9C76AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1117597,"avatar":"https://static001.geekbang.org/account/avatar/00/11/0d/9d/58d09086.jpg","nickname":"è¾¾è¾¾é˜Ÿé•¿","note":"","ucode":"1C3F2E4F6B7637","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308408,"discussion_content":"idæ˜¯ä¸»é”®ï¼Œå”¯ä¸€ç´¢å¼•ï¼Œå®šä½åˆ°15ï¼Œé€€åŒ–ä¸ºè¡Œé”\ncä¸æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œåˆ°20è¿˜å¾—å¾€åçœ‹çœ‹ï¼Œå‘ç°æ˜¯25ï¼Œé€€åŒ–ä¸ºé—´éš™é”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600942290,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":265103,"ip_address":""},"score":308408,"extra":""}]},{"author":{"id":1302741,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e0/d5/7485e51f.jpg","nickname":"~ç²ç²ç²~å­~å“¥~","note":"","ucode":"89379F3A0427EA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":104553,"discussion_content":"order by descæ˜¯æœ‰å¤§åˆ°å°æ‰«æï¼Œå…ˆå®šä½çš„æ˜¯c=20,ä¸åŠ order byæ˜¯å…ˆå®šä½id=15","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1577440734,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588005,"discussion_content":"å®Œå…¨getï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663438295,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1043325,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/c9xpiakQ3OC1AlfCeW03lLnnb7mj5v35Hib8YDs66zpnVib2n2qFichFmFp2Ec4QDPR0dKh38MkBBLyD3bE4NiaanZQ/132","nickname":"é¾™æ™“","note":"","ucode":"FAF34F1C65D103","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":357876,"discussion_content":"çŸ¥é“æ˜¯ä¸€å›äº‹ï¼Œçµæ´»è¿ç”¨è¿˜éœ€å¤šå¤šç»ƒä¹ å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615886938,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1261360,"avatar":"https://static001.geekbang.org/account/avatar/00/13/3f/30/23f6b413.jpg","nickname":"äº”åä¹ç§’","note":"","ucode":"1F34F62193CFF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308030,"discussion_content":"ç¬¬ä¸€ä¸ªå‘å³éå†æ˜¯å› ä¸ºcä¸æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œæ˜¯ç­‰å€¼æŸ¥æ‰¾çš„åŸå› å‘å³éå†ï¼Œé€‚ç”¨çš„æ˜¯ç­‰å€¼æŸ¥æ‰¾çš„è§„åˆ™ï¼Œç¬¬äºŒä¸ªå‘å³éå†idæ˜¯å”¯ä¸€ç´¢å¼•ï¼Œæ˜¯å”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥æ‰¾çš„bugå¯¼è‡´å‘å³éå†ï¼Œé€‚ç”¨çš„æ˜¯èŒƒå›´æŸ¥æ‰¾çš„è§„åˆ™ã€‚æˆ‘ä¹Ÿæ„Ÿè§‰èŒƒå›´æŸ¥æ‰¾ç”¨é—´éš™é”ä¹Ÿä¸ä¼šå½±å“ç»“æœçš„æ­£ç¡®æ€§ï¼Œè¿™å¯èƒ½æ˜¯ä¸ªéœ€è¦ä¼˜åŒ–çš„ç‚¹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600827821,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1302064,"avatar":"https://static001.geekbang.org/account/avatar/00/13/de/30/b468b41d.jpg","nickname":"åŒ—è½ç‹®é—¨","note":"","ucode":"C5A951170001B9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":706,"discussion_content":"SELECT * FROM t WHERE c<=20 ORDER BY c DESC LOCK in SHARE mode;  å°‘äº†c>=15 ä¸ºä»€ä¹ˆå°±ä¸ä¼šä½¿ç”¨ä¼˜åŒ–2   ä¼šé”ä½25ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561971816,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1554570,"avatar":"https://static001.geekbang.org/account/avatar/00/17/b8/8a/7367a69e.jpg","nickname":"å˜‰å…´","note":"","ucode":"6997E7A3E25EE4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1302064,"avatar":"https://static001.geekbang.org/account/avatar/00/13/de/30/b468b41d.jpg","nickname":"åŒ—è½ç‹®é—¨","note":"","ucode":"C5A951170001B9","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":21936,"discussion_content":"explainæŸ¥çœ‹ä¸€ä¸‹ï¼Œä½ ä¼šå‘ç°èµ°çš„æ˜¯å…¨è¡¨æ‰«æ...","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569554643,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":706,"ip_address":""},"score":21936,"extra":""}]}]},{"had_liked":false,"id":62642,"user_name":"â˜","can_delete":false,"product_type":"c1","uid":1302793,"ip_address":"","ucode":"6FAEF05F234D2A","user_header":"https://static001.geekbang.org/account/avatar/00/13/e1/09/9483f537.jpg","comment_is_top":false,"comment_ctime":1548123890,"is_pvip":false,"replies":[{"id":"22175","content":"ç´¢å¼•æœç´¢å°±æ˜¯ â€œæ‰¾åˆ°ç¬¬ä¸€ä¸ªå€¼ï¼Œç„¶åå‘å·¦æˆ–å‘å³éå†â€ï¼Œ<br>order by desc å°±æ˜¯è¦ç”¨æœ€å¤§çš„å€¼æ¥æ‰¾ç¬¬ä¸€ä¸ªï¼›<br>order byå°±æ˜¯è¦ç”¨åšå°çš„å€¼æ¥æ‰¾ç¬¬ä¸€ä¸ªï¼›<br><br>â€œæ‰€ä»¥åªéœ€è¦[20,25)æ¥åˆ¤æ–­å·²ç»æ˜¯æœ€åä¸€ä¸ª20å°±å¯ä»¥äº†æ˜¯å§â€ï¼Œ<br>ä½ æè¿°çš„æ„æ€æ˜¯å¯¹çš„ï¼Œä½†æ˜¯åœ¨MySQLé‡Œé¢ä¸å»ºè®®å†™è¿™æ ·çš„å‰é—­åå¼€åŒºé—´å“ˆï¼Œå®¹æ˜“é€ æˆè¯¯è§£ã€‚<br>å¯ä»¥æè¿°ä¸ºï¼š<br>â€œå–ç¬¬ä¸€ä¸ªid=20åï¼Œå‘å³éå†(25,25)è¿™ä¸ªé—´éš™â€^_^","user_name":"ä½œè€…å›å¤","comment_id":62642,"uid":"1264162","ip_address":"","utype":1,"ctime":1548128880,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"74562567922","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼š<br>        select * from t where c&gt;=15 and c&lt;=20 order by c desc for update;<br>        ä¸ºä»€ä¹ˆè¿™ç§c=20å°±æ˜¯ç”¨æ¥æŸ¥æ•°æ®çš„å°±ä¸æ˜¯å‘å³éå†<br>        select * from t where c&gt;=15 and c&lt;=20 è¿™ç§å°±æ˜¯å‘å³éå†<br>        æ€ä¹ˆå»åˆ¤æ–­åˆé€‚æ˜¯æŸ¥æ‰¾æ•°æ®ï¼Œä½•æ—¶åˆæ˜¯éå†å‘¢ï¼Œæ˜¯å› ä¸ºç¬¬ä¸€ä¸ªæœ‰order by descï¼Œç„¶ååå‘å‘å·¦éå†äº†å—ï¼Ÿæ‰€ä»¥åªéœ€è¦[20,25)æ¥åˆ¤æ–­å·²ç»æ˜¯æœ€åä¸€ä¸ª20å°±å¯ä»¥äº†æ˜¯å§","like_count":17,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437285,"discussion_content":"ç´¢å¼•æœç´¢å°±æ˜¯ â€œæ‰¾åˆ°ç¬¬ä¸€ä¸ªå€¼ï¼Œç„¶åå‘å·¦æˆ–å‘å³éå†â€ï¼Œ\norder by desc å°±æ˜¯è¦ç”¨æœ€å¤§çš„å€¼æ¥æ‰¾ç¬¬ä¸€ä¸ªï¼›\norder byå°±æ˜¯è¦ç”¨åšå°çš„å€¼æ¥æ‰¾ç¬¬ä¸€ä¸ªï¼›\n\nâ€œæ‰€ä»¥åªéœ€è¦[20,25)æ¥åˆ¤æ–­å·²ç»æ˜¯æœ€åä¸€ä¸ª20å°±å¯ä»¥äº†æ˜¯å§â€ï¼Œ\nä½ æè¿°çš„æ„æ€æ˜¯å¯¹çš„ï¼Œä½†æ˜¯åœ¨MySQLé‡Œé¢ä¸å»ºè®®å†™è¿™æ ·çš„å‰é—­åå¼€åŒºé—´å“ˆï¼Œå®¹æ˜“é€ æˆè¯¯è§£ã€‚\nå¯ä»¥æè¿°ä¸ºï¼š\nâ€œå–ç¬¬ä¸€ä¸ªid=20åï¼Œå‘å³éå†(25,25)è¿™ä¸ªé—´éš™â€^_^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548128880,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63955,"user_name":"Long","can_delete":false,"product_type":"c1","uid":1318970,"ip_address":"","ucode":"2417242560360A","user_header":"https://static001.geekbang.org/account/avatar/00/14/20/3a/90db6a24.jpg","comment_is_top":false,"comment_ctime":1548618757,"is_pvip":false,"replies":[{"id":"22620","content":"ğŸ˜† ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":63955,"uid":"1264162","ip_address":"","utype":1,"ctime":1548635657,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"57383193605","product_id":100020801,"comment_content":"æ„Ÿè§‰è¿™ç¯‡æ–‡ç« ä»¥åŠå‰é¢åŠ é”çš„æ–‡ç« ï¼Œæå‡äº†è‡ªå·±çš„è®¤çŸ¥ã€‚è¿˜æœ‰ï¼Œè°¢è°¢è€å¸ˆè®²è§£äº†æ—¥å¿—çš„å¯¹åº”ç»†èŠ‚â€¦â€¦è¿˜æ„¿äº†","like_count":13,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437780,"discussion_content":"ğŸ˜† ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548635657,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":235671,"user_name":"Geek8819","can_delete":false,"product_type":"c1","uid":2028950,"ip_address":"","ucode":"521AEDAB2EED81","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f5/96/e963b41b.jpg","comment_is_top":false,"comment_ctime":1595144788,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"44544817748","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæˆ‘è®°å¾—ä¹‹å‰ä½ æœ‰è¯´è¿‡èŒƒå›´æŸ¥è¯¢ç¬¬ä¸€æ¬¡å®šä½æ—¶ç”¨çš„ç­‰å€¼æŸ¥æ‰¾ã€‚é‚£select * from t where id &gt;10 and id &lt;= 15è¿™æ¡è¯­å¥ï¼Œé¦–å…ˆç”¨10å»ç´¢å¼•æ ‘æŸ¥æ‰¾ã€‚ä¸åº”è¯¥åŠ ï¼ˆ5ï¼Œ10]è¿™æ ·ä¸€ä¸ªè®°å½•é”ä¹ˆï¼Ÿ","like_count":10},{"had_liked":false,"id":62313,"user_name":"é•¿æ°","can_delete":false,"product_type":"c1","uid":1312212,"ip_address":"","ucode":"DD52C9494005F7","user_header":"https://static001.geekbang.org/account/avatar/00/14/05/d4/e06bf86d.jpg","comment_is_top":false,"comment_ctime":1548030908,"is_pvip":false,"replies":[{"id":"22025","content":"ä¸æ˜¯å“¦ï¼Œè¿™é‡Œç¬¬ä¸€ä¸ªid&gt;10æ‰¾åˆ°çš„æ˜¯(10,15)è¿™ä¸ªgapï¼Œå¹¶æ²¡æœ‰åŠ ï¼ˆ5,10ï¼‰ï¼Œ <br>è¿˜æœ‰æ ¹æ®è‚¡åˆ™é‡Œé¢çš„â€œbugâ€ï¼Œid=20ä¹Ÿä¼šè¢«é”çš„ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯ï¼ˆ10,15]ï¼ˆ15,20]","user_name":"ä½œè€…å›å¤","comment_id":62313,"uid":"1264162","ip_address":"","utype":1,"ctime":1548037071,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"40202736572","product_id":100020801,"comment_content":"è€å¸ˆï¼Œselect * from t where id&gt;10 and id&lt;=15 for update;è¿™ä¸ªè¯­å¥æŒæœ‰çš„é”ä¸åº”è¯¥æ˜¯ï¼ˆ5,10ï¼‰ï¼ˆ10,15]ï¼ˆ15,20ï¼‰å—ï¼Ÿ","like_count":9,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437167,"discussion_content":"ä¸æ˜¯å“¦ï¼Œè¿™é‡Œç¬¬ä¸€ä¸ªid&amp;gt;10æ‰¾åˆ°çš„æ˜¯(10,15)è¿™ä¸ªgapï¼Œå¹¶æ²¡æœ‰åŠ ï¼ˆ5,10ï¼‰ï¼Œ \nè¿˜æœ‰æ ¹æ®è‚¡åˆ™é‡Œé¢çš„â€œbugâ€ï¼Œid=20ä¹Ÿä¼šè¢«é”çš„ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯ï¼ˆ10,15]ï¼ˆ15,20]","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548037071,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":184420,"user_name":"ç´¢æ—­ä¸œ","can_delete":false,"product_type":"c1","uid":1139039,"ip_address":"","ucode":"BFD07BCD8C8CAE","user_header":"https://static001.geekbang.org/account/avatar/00/11/61/5f/b279daaf.jpg","comment_is_top":false,"comment_ctime":1583311652,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"31648082724","product_id":100020801,"comment_content":"select * from t where id&gt;10 and id&lt;=15 for update;<br><br>select c from t where c&gt;5 lock in share mode;<br><br>ç¬¬ä¸€æ¡çš„é”æ˜¯(5,10),(10,15)<br>ç¬¬äºŒä¸ªè¯­å¥çš„é”æ˜¯ï¼ˆ5,10]....<br>ä¸¤ä¸ªå¯¹æ¯”ï¼Œæ„Ÿè§‰çŸ›ç›¾äº†å‘€ï¼Œç¬¬äºŒä¸ªè¯­å¥ç»™çš„ç†ç”±æ˜¯ï¼Œå¤§äº5çš„ç¬¬ä¸€ä¸ªè¢«è®¿é—®åˆ°çš„è®°å½•æ˜¯10ï¼ŒåŒæ ·åŸç†ç¬¬ä¸€ä¸ªè¯­å¥è®¿é—®çš„ç¬¬ä¸€ä¸ªè®°å½•ä¸æ˜¯åº”è¯¥æ˜¯15å—ï¼Ÿ","like_count":7,"discussions":[{"author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"ä¸€å…ƒ(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306003,"discussion_content":"å…ˆå…¥ä¸ºä¸»ï¼Œè¢«ä½ è¯¯å¯¼äº†ï¼Œç¬¬ä¸€æ¡çš„é”æ˜¯(10,15]ï¼Œ(15,20]ã€‚æ¥¼ä¸Šä¹‹æ‰€ä»¥å®æµ‹ç»“æœæ˜¯(10,15) æ˜¯å› ä¸º mysql 8.0.18å·²ç»ä¿®å¤å”¯ä¸€ç´¢å¼•ç»§ç»­å‘ä¸‹éå†çš„BUG","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1600146279,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1211790,"avatar":"https://static001.geekbang.org/account/avatar/00/12/7d/8e/bb16d414.jpg","nickname":"Wangxi","note":"","ucode":"C25A9A14179930","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":257366,"discussion_content":"mysql 8.0.18åˆšåšäº†å®éªŒ ç¬¬ä¸€æ¡é”æ˜¯(10,15] ç¬¬äºŒæ¡é”æ˜¯(5, 10)....","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1588562508,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1111825,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/11/714285d8.jpg","nickname":"Wolfã€Heart","note":"","ucode":"9A6FC15DAF6269","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":408739,"discussion_content":"ç¬¬ä¸€æ¡åŠ é”æ˜¯ï¼šï¼ˆ10,15]ï¼ˆ15,20]å¹¶æ²¡æœ‰(5,10)ï¼Œæ„Ÿè§‰åº”è¯¥ä¹Ÿæ˜¯å…ˆå®šä½åˆ°5è¿™æ¡è®°å½•ï¼Œå¯¹åº”next-key lockï¼ˆ5,10]ï¼Œç»§ç»­å‘åå¯»æ‰¾ï¼Œç›´åˆ°id=20åœæ­¢ï¼Œå› æ­¤åŠ é”èŒƒå›´ï¼ˆ5,10]ã€ï¼ˆ10,15]ï¼ˆ15,20]ï¼Œåˆç”±äº5è¿™æ¡è®°å½•å¹¶ä¸æ»¡è¶³æŸ¥è¯¢æ¡ä»¶ï¼Œåªæ˜¯ç”¨äºè¾…åŠ©å®šä½è®°å½•ï¼Œéœ€è¦ç§»é™¤ï¼Œå› æ­¤æœ€ç»ˆåŠ é”èŒƒå›´ä¸ºï¼ˆ10,15]ï¼ˆ15,20]","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635313295,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":105023,"user_name":"å¾€äº‹éšé£ï¼Œé¡ºå…¶è‡ªç„¶","can_delete":false,"product_type":"c1","uid":1235692,"ip_address":"","ucode":"F266EC6B143E38","user_header":"https://static001.geekbang.org/account/avatar/00/12/da/ec/779c1a78.jpg","comment_is_top":false,"comment_ctime":1560906180,"is_pvip":false,"replies":[{"id":"38147","content":"ç»ƒç€ç»ƒç€ï¼Œè§„åˆ™å°±å¿˜è®°äº†ï¼Œç„¶åç›´æ¥è„‘è¡¥æ‰§è¡Œæµç¨‹ï¼Œä¸Šç»“è®º","user_name":"ä½œè€…å›å¤","comment_id":105023,"uid":"1264162","ip_address":"","utype":1,"ctime":1560998212,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"31625677252","product_id":100020801,"comment_content":"è¿™ä¹ˆå¤šåŠ é”è§„åˆ™è®°ä¸ä½","like_count":7,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454527,"discussion_content":"ç»ƒç€ç»ƒç€ï¼Œè§„åˆ™å°±å¿˜è®°äº†ï¼Œç„¶åç›´æ¥è„‘è¡¥æ‰§è¡Œæµç¨‹ï¼Œä¸Šç»“è®º","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560998212,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99987,"user_name":"hal","can_delete":false,"product_type":"c1","uid":1359844,"ip_address":"","ucode":"98E625F7327FD9","user_header":"https://static001.geekbang.org/account/avatar/00/14/bf/e4/45758517.jpg","comment_is_top":false,"comment_ctime":1559378851,"is_pvip":false,"replies":[{"id":"36695","content":"ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤","user_name":"ä½œè€…å›å¤","comment_id":99987,"uid":"1264162","ip_address":"","utype":1,"ctime":1560003646,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"31624149923","product_id":100020801,"comment_content":"éå¸¸è°¢è°¢è€å¸ˆï¼Œä¸“æ è´¨é‡éå¸¸é«˜ï¼Œç¥è€å¸ˆèº«ä½“å¥åº·ä¸‡äº‹å¦‚æ„ï¼Œå› ä¸ºå†…å®¹å†™çš„å¤ªå¥½äº†â€¦â€¦å¾ˆæ¿€åŠ¨ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘","like_count":7,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452353,"discussion_content":"ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560003646,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62793,"user_name":"é•¿æ°","can_delete":false,"product_type":"c1","uid":1312212,"ip_address":"","ucode":"DD52C9494005F7","user_header":"https://static001.geekbang.org/account/avatar/00/14/05/d4/e06bf86d.jpg","comment_is_top":false,"comment_ctime":1548158223,"is_pvip":false,"replies":[{"id":"22250","content":"1. ä»£ç å®ç°ä¸Šï¼Œä¼ å…¥çš„å°±æ˜¯id&gt;10é‡Œé¢çš„è¿™ä¸ª10<br>2. å¯ä»¥çš„ï¼Œä¸è¿‡å› ä¸ºidæ˜¯ä¸»é”®ï¼Œè€Œä¸”id=15è¿™ä¸€è¡Œå­˜åœ¨ï¼Œæˆ‘è§‰å¾—ç”¨ä¼˜åŒ–1è§£é‡Šæ›´å¥½å“¦","user_name":"ä½œè€…å›å¤","comment_id":62793,"uid":"1264162","ip_address":"","utype":1,"ctime":1548216820,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":2,"race_medal":0,"score":"31612929295","product_id":100020801,"comment_content":"è€å¸ˆï¼Œè¿˜æ˜¯select * from t where c&gt;=15 and c&lt;=20 order by c desc in share modeä¸select * from t where id&gt;10 and id&lt;=15 for updateçš„é—®é¢˜ï¼Œä¸ºä½•select * from t where id&gt;10 and id&lt;=15 for updateä¸èƒ½è§£é‡Šä¸ºï¼šæ ¹æ®id=15æ¥æŸ¥æ•°æ®ï¼ŒåŠ é”(15, 20]çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ä¼˜åŒ–2ï¼Œ<br>è¿™ä¸ªç­‰å€¼æŸ¥è¯¢æ˜¯æ ¹æ®ä»€ä¹ˆè§„åˆ™æ¥å®šçš„ï¼Ÿ å¦‚æœselect * from t where id&gt;10 and id&lt;=15 for updateåŠ ä¸Šorder by id descæ˜¯å¦å¯ä»¥æŒ‰ç…§id=15ç­‰å€¼æŸ¥è¯¢ï¼Œåˆ©ç”¨ä¼˜åŒ–2ï¼Ÿå¤šè°¢æŒ‡æ•™ã€‚","like_count":7,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437351,"discussion_content":"1. ä»£ç å®ç°ä¸Šï¼Œä¼ å…¥çš„å°±æ˜¯id&amp;gt;10é‡Œé¢çš„è¿™ä¸ª10\n2. å¯ä»¥çš„ï¼Œä¸è¿‡å› ä¸ºidæ˜¯ä¸»é”®ï¼Œè€Œä¸”id=15è¿™ä¸€è¡Œå­˜åœ¨ï¼Œæˆ‘è§‰å¾—ç”¨ä¼˜åŒ–1è§£é‡Šæ›´å¥½å“¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548216820,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1261360,"avatar":"https://static001.geekbang.org/account/avatar/00/13/3f/30/23f6b413.jpg","nickname":"äº”åä¹ç§’","note":"","ucode":"1F34F62193CFF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308051,"discussion_content":"å¯ä»¥æƒ³æƒ³æœ€åè¿”å›å®¢æˆ·ç«¯çš„ç»“æœï¼Œæ²¡æœ‰descçš„æ­£åºæ’åˆ—ï¼Œæ˜¯ä»æœ€å°å€¼å‘æœ€å¤§å€¼å–å€¼ï¼Œæ‰€ä»¥æ ¹æ®æœ€å°å€¼å®šä½ï¼›åŠ äº†descï¼Œå€’æ’æ˜¯ä»æœ€å¤§å‘æœ€å°å–å€¼ï¼Œæ‰€ä»¥æ ¹æ®æœ€å¤§å€¼å®šä½ï¼Œå‘æœ€å°å–å€¼ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1600831254,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62440,"user_name":"åº“æ·˜æ·˜","can_delete":false,"product_type":"c1","uid":1310240,"ip_address":"","ucode":"90813B0C46E978","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqibSwKPg7hiapc49qoM4dibhM3fYANPjfltF2ibBZ3dHX2hibjg5EIIcziahrmjO5R2XrcRibvU39TQS7jg/132","comment_is_top":false,"comment_ctime":1548058694,"is_pvip":false,"replies":[{"id":"22102","content":"å‘ç°äº†ğŸ‘ğŸ¿","user_name":"ä½œè€…å›å¤","comment_id":62440,"uid":"1264162","ip_address":"","utype":1,"ctime":1548087432,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"31612829766","product_id":100020801,"comment_content":"å¯¹äºé—®é¢˜ æˆ‘ç†è§£æ˜¯è¿™æ · <br>session 1ï¼š<br>delete from t;<br>begin; select * from t for update;<br>session 2:<br>insert into t values(1,1,1);å‘ç”Ÿç­‰å¾…<br>show engine innodb status\\G; <br>.....<br>------- TRX HAS BEEN WAITING 5 SEC FOR THIS LOCK TO BE GRANTED:<br>RECORD LOCKS space id 75 page no 3 n bits 72 index PRIMARY of table `test`.`t` trx id 752090 lock_mode X insert intention waiting<br>Record lock, heap no 1 PHYSICAL RECORD: n_fields 1; compact format; info bits 0<br> 0: len 8; hex 73757072656d756d; asc supremum;;<br>å…¶ä¸­ç”³è¯·æ’å…¥æ„å‘é”ä¸é—´éš™é” å†²çªï¼Œsupremumè¿™ä¸ªèƒ½å¦ç†è§£ä¸º é—´éš™å³è¾¹çš„é‚£ä¸ªè®°å½•","like_count":7,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437214,"discussion_content":"å‘ç°äº†ğŸ‘ğŸ¿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548087432,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":287750,"user_name":"Yc","can_delete":false,"product_type":"c1","uid":1661365,"ip_address":"","ucode":"407776D104D6F8","user_header":"https://static001.geekbang.org/account/avatar/00/19/59/b5/26d3c637.jpg","comment_is_top":false,"comment_ctime":1618132425,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"27387936201","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œè¯·é—®ä¸€ä¸‹ å›¾4çš„ä¸€ä¸ªé—®é¢˜ã€‚ã€‚æ±‚è§£ç­”<br><br>ä¸ºå•¥ï¼Œ10ä¸ä¼šè¢«é”ä½å‘¢ï¼Ÿæ¡ä»¶æ˜¯id&gt;10ï¼ŒæŸ¥è¯¢è§„åˆ™æ˜¯é¦–å…ˆæ‰¾åˆ°id=10çš„è¿™è¡Œæ•°æ®ï¼Œç„¶åæ ¹æ®è¿™è¡Œæ•°æ®è¿›è¡Œå‘å³éå†ã€‚æŒ‰ç…§åŠ é”è§„åˆ™ï¼šåŸåˆ™ 2ï¼šæŸ¥æ‰¾è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ã€‚<br>åŠ é”çš„è¯ åœ¨æ ¹æ®ä¼˜åŒ–1ï¼šä¼˜åŒ– 1ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œç»™å”¯ä¸€ç´¢å¼•åŠ é”çš„æ—¶å€™ï¼Œnext-key lock é€€åŒ–ä¸ºè¡Œé”ã€‚  è¿™ä¸ªä¾‹å­ä¸ºå•¥ID=10ä¸åŠ é”ï¼ï¼ï¼ï¼Œæ±‚è€å¸ˆç¿»ç‰Œ","like_count":6,"discussions":[{"author":{"id":1324550,"avatar":"https://static001.geekbang.org/account/avatar/00/14/36/06/08c46bcd.jpg","nickname":"è‚åˆ©","note":"","ucode":"808E064089724D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587395,"discussion_content":"ä»å·¦è¾¹ç¬¬1ä¸ªèµ·ç‚¹æŸ¥æ‰¾æ˜¯ç­‰å€¼æŸ¥è¯¢ï¼Œå› ä¸ºæ˜¯&gt;10,ç­‰äº10ç›¸å½“äºæ²¡æ‰¾åˆ°ï¼Œè€Œä¸”è§„åˆ™ åˆ’æœ¬æ¥ä¹Ÿæ˜¯å·¦å¼€å³é—­ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663032039,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2724584,"avatar":"https://static001.geekbang.org/account/avatar/00/29/92/e8/32378dd0.jpg","nickname":"æ—¶è’","note":"","ucode":"DDE08CDBD24D5C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582256,"discussion_content":"åŒé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659339226,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æµ™æ±Ÿ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1170925,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/ed/e6eed95e.jpg","nickname":"Flying","note":"","ucode":"CA3DCE897F2013","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387361,"discussion_content":"åŒé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628134674,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2045385,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/35/c9/f1d1bb6f.jpg","nickname":"zhang_qing_yun","note":"","ucode":"E4CD54834ADFFD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":369829,"discussion_content":"åŒé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619168455,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":82706,"user_name":"å”¯å¥¹å‘½","can_delete":false,"product_type":"c1","uid":1240398,"ip_address":"","ucode":"8F687E8D306840","user_header":"https://static001.geekbang.org/account/avatar/00/12/ed/4e/ef406442.jpg","comment_is_top":false,"comment_ctime":1554281237,"is_pvip":false,"replies":[{"id":"30167","content":"ä¿®æ”¹ç´¢å¼•å€¼éƒ½ä¼šä¿®æ”¹ä½ç½®çš„ğŸ˜†<br>","user_name":"ä½œè€…å›å¤","comment_id":82706,"uid":"1264162","ip_address":"","utype":1,"ctime":1554626046,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":2,"race_medal":0,"score":"27324085013","product_id":100020801,"comment_content":"è€å¸ˆï¼Œupdateè¯­å¥  mysqlåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ ï¼Œéƒ½æ˜¯å…ˆæ‹†æˆ  æ’å…¥ å’Œ åˆ é™¤çš„å—ï¼Ÿä¸æ˜¯ç›´æ¥ä¿®æ”¹ï¼Ÿ","like_count":7,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445691,"discussion_content":"ä¿®æ”¹ç´¢å¼•å€¼éƒ½ä¼šä¿®æ”¹ä½ç½®çš„ğŸ˜†\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554626046,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":175908,"discussion_content":"é”éƒ½æ˜¯ä½œç”¨åœ¨ç´¢å¼•ä¸Šçš„ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1582002164,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62718,"user_name":"Justin","can_delete":false,"product_type":"c1","uid":1305601,"ip_address":"","ucode":"D49723FEA66731","user_header":"https://static001.geekbang.org/account/avatar/00/13/ec/01/978d54af.jpg","comment_is_top":false,"comment_ctime":1548141814,"is_pvip":false,"replies":[{"id":"22245","content":"ä¼šçš„","user_name":"ä½œè€…å›å¤","comment_id":62718,"uid":"1264162","ip_address":"","utype":1,"ctime":1548215865,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"27317945590","product_id":100020801,"comment_content":"æƒ³å’¨è¯¢ä¸€ä¸‹ æ™®é€šç´¢å¼• å¦‚æœç´¢å¼•ä¸­åŒ…æ‹¬çš„å…ƒç´ éƒ½ç›¸åŒ åœ¨ç´¢å¼•ä¸­é¡ºåºæ˜¯æ€ä¹ˆæ’è§£çš„å‘¢ æ˜¯æŒ‰ä¸»é”®æ’åˆ—çš„å— æ¯”å¦‚(name ,age ) ç´¢å¼• name ageéƒ½ä¸€æ · é‚£ç´¢å¼•ä¸­ä¼šæŒ‰ç…§ä¸»é”®æ’åºå—ï¼Ÿ","like_count":6,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437319,"discussion_content":"ä¼šçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548215865,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96509,"user_name":"Lane","can_delete":false,"product_type":"c1","uid":1008257,"ip_address":"","ucode":"F70459D1BBD9F4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/62/81/ad80f427.jpg","comment_is_top":false,"comment_ctime":1558437095,"is_pvip":true,"discussion_count":4,"race_medal":0,"score":"23033273575","product_id":100020801,"comment_content":"ç¬¬ä¸€ä¸ªä¾‹å­<br>begin; select * from t where id&gt;9 and id&lt;12 order by id desc for update;  <br>ä¸ºä»€ä¹ˆä¼šæœ‰(0,5]ï¼Œä¸ç†è§£ï¼Œä½†æ˜¯æµ‹è¯•ç¡®å®insert into t values (3,3,3);ä¼šå¡ä¸»","like_count":5,"discussions":[{"author":{"id":1226968,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b8/d8/f81b5604.jpg","nickname":"hcyycb","note":"","ucode":"77FF6CA41F9E66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4479,"discussion_content":"æœ‰â€œorder by id descâ€,æ‰€ä»¥ä¼šå‘å·¦éå†ï¼Œè¦ä¸€ç›´åˆ°id=5,æ‰æ˜¯æ‰¾åˆ°äº†ä¸æ˜¯ç­‰äº9çš„ç¬¬ä¸€ä¸ªå€¼ï¼Œæ‰€ä»¥ä¼šåŠ (0,5] è¿™æ ·çš„ next-key  lock çš„é”ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1565453076,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1335409,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ0siaXviaRMJxYNCibIeicadw3F9L28oTbJIUXSmKtNWvEHNviaM7dr60PZSq1cHj6AzruuP8wvyHnYSA/132","nickname":"é…·é…·å“’","note":"","ucode":"463ED1CA951AC3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1226968,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b8/d8/f81b5604.jpg","nickname":"hcyycb","note":"","ucode":"77FF6CA41F9E66","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":36042,"discussion_content":"å¯¹äºè¿™ä¸ªæˆ‘ä¹Ÿæ²¡ç†è§£ï¼Œæ²¡æœ‰order by desc èƒ½åˆ†æä¸‹å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571317576,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":4479,"ip_address":""},"score":36042,"extra":""},{"author":{"id":1795793,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/zxkns28cIAUZIt3WjDb8G26qiccT84d9GMr9ZpbYR60TU1ibqSj9NoYVHlJvGF1kOltkqNDmEfJCqPuYVkue3WHg/132","nickname":"Geek_55e386","note":"","ucode":"5A727F1323C2D0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1335409,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ0siaXviaRMJxYNCibIeicadw3F9L28oTbJIUXSmKtNWvEHNviaM7dr60PZSq1cHj6AzruuP8wvyHnYSA/132","nickname":"é…·é…·å“’","note":"","ucode":"463ED1CA951AC3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366912,"discussion_content":"é¦–å…ˆåŠ é”,ä» (å°,å¤§]\nid > 9; æŒ‰ç…§descé™åºæ’åˆ—, ä»–è¦æ‹¿åˆ°æ¯”9å°çš„å€¼5;\nç„¶åé—´éš™æ·é”è§„åˆ™,  æ¯”5å°çš„ (0, 5]","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618216705,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":36042,"ip_address":""},"score":366912,"extra":""}]},{"author":{"id":2046557,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epHrVsJzVH0LUFyMmU77Raj3fF3oXrl8OpD4v1wWhRHjPbs2iaeZE5qtw1ZoZWqq5oAeDkAwa8Nv6g/132","nickname":"Geek_aa9f6e","note":"","ucode":"D2EAAC7244FA45","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539727,"discussion_content":"å‡å¦‚è¯´æ²¡æœ‰è¿™ä¸ª(0,5]ï¼Œä¼šæœ‰ä»€ä¹ˆå½±å“å—ï¼Ÿæ„Ÿè§‰æ²¡å•¥å½±å“å•Šï¼Œè¿™ä¸ªé”æœ‰ç‚¹å¤šä½™ï¼Œå¯ä»¥è¢«ä¼˜åŒ–å§ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639815354,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62416,"user_name":"è€æ¨åŒå¿—","can_delete":false,"product_type":"c1","uid":1246199,"ip_address":"","ucode":"3F334F0CFD3DE6","user_header":"https://static001.geekbang.org/account/avatar/00/13/03/f7/3a493bec.jpg","comment_is_top":false,"comment_ctime":1548052199,"is_pvip":false,"replies":[{"id":"22094","content":"èµ<br>show engine innodb status æœ‰æƒŠå–œğŸ˜†","user_name":"ä½œè€…å›å¤","comment_id":62416,"uid":"1264162","ip_address":"","utype":1,"ctime":1548078244,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":2,"race_medal":0,"score":"23022888679","product_id":100020801,"comment_content":"å…ˆè¯´ç»“è®ºï¼šç©ºè¡¨é” (-supernumï¼Œsupernum],è€å¸ˆæåˆ°è¿‡mysqlçš„æ­£æ— ç©·æ˜¯supernumï¼Œåœ¨æ²¡æœ‰æ•°æ®çš„æƒ…å†µä¸‹ï¼Œnext-key lock åº”è¯¥æ˜¯supernumå‰é¢çš„é—´éš™åŠ  supernumçš„è¡Œé”ã€‚ä½†æ˜¯å‰å¼€åé—­çš„åŒºé—´ï¼Œå‰é¢çš„å€¼æ˜¯ä»€ä¹ˆæˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œå°±å†™äº†ä¸€ä¸ª-supernumã€‚<br>ç¨å¾®éªŒè¯ä¸€ä¸‹<br>session 1ï¼‰<br>begin;<br>select * from t where id&gt;9 for update;<br>session 2ï¼‰<br>begin;<br>insert into t values(0,0,0),(5,5,5);<br>ï¼ˆblockï¼‰<br>","like_count":5,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437204,"discussion_content":"èµ\nshow engine innodb status æœ‰æƒŠå–œğŸ˜†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548078244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1061402,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/y5NFbibdKCFCg0lHKK5ERGOQWXYYK7jhnqm2BxQ6r7tWvXx8uDmibglweejDWU39BTmDSAtBJGj1ibOZK2uIHQyqg/132","nickname":"Mr_freezing37","note":"","ucode":"BB605A6FEDCEB6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":259615,"discussion_content":"è€å¸ˆè¯´çš„æƒŠå–œæ˜¯supremumçš„å€¼ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588790646,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":148225,"user_name":"Icy:S LYZ","can_delete":false,"product_type":"c1","uid":1683788,"ip_address":"","ucode":"73C983E11A43C2","user_header":"https://static001.geekbang.org/account/avatar/00/19/b1/4c/9f06f199.jpg","comment_is_top":false,"comment_ctime":1572960881,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18752830065","product_id":100020801,"comment_content":"éš¾é“åªæœ‰æˆ‘æœ‰ç–‘é—®ï¼Œå¦‚æœå”¯ä¸€ç´¢å¼•å˜æˆvarcharï¼Œé—´éš™åŒºé—´ä¼šæ€ä¹ˆé€‰å—ï¼Ÿï¼Ÿï¼Ÿè¿˜æ˜¯æˆ‘çš„é—®é¢˜ï¼Ÿ","like_count":4},{"had_liked":false,"id":324967,"user_name":"bigdudo","can_delete":false,"product_type":"c1","uid":1371360,"ip_address":"","ucode":"5938710D7C1149","user_header":"https://static001.geekbang.org/account/avatar/00/14/ec/e0/d072d6f0.jpg","comment_is_top":false,"comment_ctime":1638761329,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"10228695921","product_id":100020801,"comment_content":"äººåœ¨åœ°é“ï¼Œè¿˜æ²¡æ—¶é—´åä¸‹æ¥å¥½å¥½æ•´ç†ç¬”è®°ï¼Œé‚åœ¨æ­¤ç°æ€»ç»“ä¸‹ï¼šåŠ é”è¿™ä¸ªå¿…é¡»è¦è·Ÿç€b+æ ‘æ¥æ¯”ç…§æ‰æ¸…æ™°ï¼›è¦æ—¶åˆ»è°¨è®°æŒ‰ç…§æœ€å³åŸåˆ™ã€‚ä¸¾å‡ ä¸ªä¸ªä¾‹å­ï¼š<br>1ã€select id from table_q where c&gt;5and c&lt;15 æŒ‰ç…§æ–‡ä¸­æ—¢æœ‰çš„æ•°æ®ï¼Œé¦–å…ˆè‚¯å®šè¦ä»5å¼€å§‹æŸ¥æ•°æ®ï¼šå› ä¸ºcä¸ç­‰äº5ï¼Œæ‰€ä»¥åŒºé—´ï¼ˆ5ï¼Œ10]çš„nklockæ˜¯æˆç«‹çš„ï¼Œ(10,15] (15,20] (20,wuqiong) ä»¥ä¸Šå¯¹äºc&gt;5æ¥è¯´éƒ½æ˜¯æˆç«‹çš„ã€‚c&lt;15 æ»¡è¶³çš„æœ‰(10,15) (5,10](0,5]å–äº¤é›†å¾—åˆ°ï¼ˆ5ï¼Œ10](10,15)<br>2ã€å…¶æ¬¡å¦‚æœæ˜¯select id from table_q where c=5 é¦–å…ˆï¼ˆ0ï¼Œ5]è‚¯å®šæ²¡è·‘äº† ä½†æ˜¯è¦æ¸…æ¥šï¼Œä½ å¦‚æœæ˜¯å¼•æ“ï¼Œä½ ä»å·¦å¾€å³æ‹¿ã€æ‹¿åˆ°ç¬¬ä¸€ä¸ª5ï¼Œä½ ä¼šå®‰å¿ƒçš„æ‹æ‹å±è‚¡å»äº¤å·®å—ï¼Ÿè‚¯å®šè¦å¾€åæ‹¿æ‹¿åˆ°ä¸ä¸€æ ·çš„ä¸ºæ­¢ï¼Œæ‰€ä»¥åŒºé—´è‡ªç„¶è€Œç„¶å°±å»¶ä¼¸åˆ°äº†ï¼ˆ5ï¼Œ10ï¼‰ã€‚10æ²¡å¿…è¦åŠ é”äº†ï¼Œå› ä¸ºä¸ç­‰äº5<br><br>3ã€ç„¶åå¦‚æœselect id from table_q where c&gt;=5and c&lt;=15 é‚£è‚¯å®šè¦ä»ï¼ˆ0ï¼Œ5]å¼€å§‹ ç„¶åï¼ˆ10ï¼Œ15]ä¹Ÿè¦æ˜¯å³é—­åŒºé—´ï¼Œä½†æ˜¯å’Œç¬¬äºŒä¸ªä¾‹å­ä¸€æ ·ï¼Œå¼•æ“ä»å·¦å¾€å³æ‹¿ï¼Œæ€ä¹ˆèƒ½ç¡®è®¤åˆ°è¿™ä¸ª15å°±å¯ä»¥å‘¢ï¼Ÿä¸‡ä¸€åé¢è¿˜æœ‰15å‘¢ï¼Ÿè‚¯å®šè¿˜è¦å¾€åcheckï¼Œæ‰€ä»¥å°±ä¼šå»¶ä¼¸åˆ°ï¼ˆ15ï¼Œ20ï¼‰ã€‚<br><br>4ã€å†è¯´è¿™ä¸ª<br>begin;<br>select * from t where id&gt;9 and id&lt;12 order by id desc for update;<br>é¦–å…ˆå› ä¸ºæ˜¯é€†åºï¼Œæ‰€ä»¥å¼•æ“æ˜¯ä»å³å‘å·¦check<br>å…ˆcheck id&lt;12 (15,10] (10,5](5,0]<br>å…¶æ¬¡æ˜¯id&gt;9 (wuqiong,15] (15,10] (10,5]<br>å–äº¤é›† å°±æ˜¯[5,15)<br><br>å¯¹äºåŠ é”ï¼Œä¸ªäººç†è§£æ˜¯çŸ¥é“å…¶æœ¬è´¨å°±å¥½ï¼Œæ²¡å¿…è¦è¿‡åˆ†è¿½æ±‚å¯¹å…¶ç†è§£çš„ç²¾ç»†ç¨‹åº¦ï¼Œçœ‹ä»–ä»¬çš„å¯¹åŠ é”çš„è¿­ä»£ï¼Œæ˜¯ä¸€ç‰ˆä¸€ç‰ˆä¼˜åŒ–å¾—æ¥çš„ï¼Œè€Œæ‰€è°“çš„è¿™äº›åŠ é”é€»è¾‘ä¹Ÿæ˜¯å¤§éƒ¨åˆ†äººæš—ç®±ç†è§£å¾—å‡ºçš„ä¸€ä¸ªå¤§æ¦‚ç»“è®ºã€‚æˆ‘ä»¬åªéœ€è¦çŸ¥é“å…¶åŠ é”çš„ä¾æ®å’ŒåŸå› ï¼Œæˆ‘è§‰å¾—å°±å·²ç»å¯¹è¿™å—çš„å†…å®¹ç†è§£çš„7788äº†ã€‚æ²¡å¿…è¦é’»è¿›å»siç£•ã€‚è¯´ä¸å®šä¸‹ä¸ªç‰ˆæœ¬çš„åŠ é”è§„åˆ™åˆå¾®è°ƒäº†å‘¢ï¼Œå¼€åŒºé—´åˆå˜å›äº†é—­åŒºé—´äº†å‘¢ï¼Ÿ é‚£æˆ‘ä»¬ä¸€ç›´çº ç»“è¿™ç§å°ç»†èŠ‚çš„ å²‚ä¸æ˜¯è¦ç–¯æ‰ï¼Œè¿˜æ˜¯é‚£å¥è¯ï¼ŒçŸ¥é“å’Œäº†è§£å¯¹äºnextKeyLockçš„æ·é”ä¾æ®å’Œæœ¬è´¨åï¼Œå¯¹äºInnodbå¼€å‘è€…ä»–ä»¬åç»­çš„æ”¹åŠ¨åœ¨æˆ‘ä»¬è¿™é‡Œä¹Ÿåªæ˜¯é”¦ä¸Šæ·»èŠ±ç½¢äº†","like_count":2,"discussions":[{"author":{"id":1804626,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/89/52/b96c272d.jpg","nickname":"ğŸ¤","note":"","ucode":"17D997E499E651","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580618,"discussion_content":"æˆ‘ä¸€èˆ¬éƒ½æ˜¯ä½ è¿™ä¹ˆç†è§£çš„ éå”¯ä¸€ç´¢å¼•å°±æ˜¯è¦å¤šæ‰¾ä¸€è¡Œ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658296794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1804626,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/89/52/b96c272d.jpg","nickname":"ğŸ¤","note":"","ucode":"17D997E499E651","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580617,"discussion_content":"å¯¹ æ„Ÿè§‰æ­»ç£•æ²¡å¿…è¦ çœ‹çš„å¿ƒæƒ…çƒ¦ å±…ç„¶æŠŠbugå½“ç‰¹æ€§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658296692,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":247651,"user_name":"è€ƒæ‹‰å‡ºå±±","can_delete":false,"product_type":"c1","uid":1303954,"ip_address":"","ucode":"917E35FD7B2D06","user_header":"https://wx.qlogo.cn/mmopen/vi_32/1mOvT5fApeicXppMP3zADG6XIPicNt5D9dL6y46SF5UUcH0hicG21LM6xSgHJj5oAdzCyeGtLZYHYmlvaFwecrGOA/132","comment_is_top":false,"comment_ctime":1599786706,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"10189721298","product_id":100020801,"comment_content":"ç¬¬ä¸€ä¸ªè§£é‡Šæœ‰è¯¯å¯¼ï¼Œæ²¡è¯´æ¸…æ¥šã€‚å› ä¸ºä¹‹å‰æœ‰ä¾‹å­è¯´è¿‡  å°äº  å¤§äº å°äºï¼œ  ï¼  ä¸æ˜¯ç­‰å€¼æŸ¥è¯¢ã€‚ç°åœ¨åˆæ¥è§£é‡Šç­‰å€¼æŸ¥è¯¢ã€‚","like_count":2,"discussions":[{"author":{"id":1228424,"avatar":"https://static001.geekbang.org/account/avatar/00/12/be/88/8d15796f.jpg","nickname":"John","note":"","ucode":"A46AF2906C38C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":310903,"discussion_content":"ç”¨æˆ·sql çš„èŒƒå›´æŸ¥è¯¢åœ¨MySQLå†…éƒ¨ä¼šè½¬æˆ&#34;å¯¹èŒƒå›´è¾¹ç•Œçš„ç­‰å€¼æŸ¥è¯¢&#34;","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1602120092,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1364763,"avatar":"https://static001.geekbang.org/account/avatar/00/14/d3/1b/94a0637b.jpg","nickname":"ä¾æ—§æœ¨ç“œ","note":"","ucode":"A77CD9CE9F67EB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":309926,"discussion_content":"æˆ‘çœ‹ç€ä¹Ÿæ˜¯ï¼Œå‡ ä¸ªä¼˜åŒ–éƒ½æ˜¯æœ‰ä¸åŒåœºæ™¯çš„ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è§£é‡Šçš„å¾ˆè¯¦ç»†ã€‚é€ æˆç¬¬ä¸€æ—¶é—´åœ¨å¾€5ä¸ªè§„åˆ™é‡Œå¥—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601520903,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62730,"user_name":"PengfeiWang","can_delete":false,"product_type":"c1","uid":1308369,"ip_address":"","ucode":"C877BBE99192B2","user_header":"https://static001.geekbang.org/account/avatar/00/13/f6/d1/dcafd7cf.jpg","comment_is_top":false,"comment_ctime":1548144239,"is_pvip":false,"replies":[{"id":"22246","content":"ä¸»è¦æ˜¯è¿™é‡Œè¿™ä¸€è¡Œä¸å­˜åœ¨ã€‚ã€‚<br>å¦‚æœèƒ½å¤Ÿæ˜ç¡®æ‰¾åˆ°ä¸€è¡Œé”ä½çš„è¯ï¼Œä½¿ç”¨ä¼˜åŒ–1å°±æ›´å‡†ç¡®äº›","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1548216054,"ip_address":"","comment_id":62730,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10138078831","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼š<br>         å¯¹æ–‡ä¸­ä»¥ä¸‹è¯­å¥æ„Ÿåˆ°æœ‰å›°æƒ‘ï¼š<br>æˆ‘ä»¬è¯´åŠ é”å•ä½æ˜¯ next-key lockï¼Œéƒ½æ˜¯å‰å¼€åé—­åŒºï¼Œä½†æ˜¯è¿™é‡Œç”¨åˆ°äº†ä¼˜åŒ– 2ï¼Œå³ç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³éå†çš„æ—¶å€™id=15ä¸æ»¡è¶³æ¡ä»¶ï¼Œæ‰€ä»¥ next-key lock é€€åŒ–ä¸ºäº†é—´éš™é” (10, 15)ã€‚<br>SQLè¯­å¥ä¸­æ¡ä»¶ä¸­ä½¿ç”¨çš„æ˜¯idå­—æ®µï¼ˆå”¯ä¸€ç´¢å¼•ï¼‰ï¼Œé‚£ä¹ˆæ ¹æ®åŠ é”è§„åˆ™è¿™é‡Œä¸åº”è¯¥ç”¨çš„æ˜¯ä¼˜åŒ– 2ï¼Œè€Œæ˜¯ä¼˜åŒ– 1ï¼Œå› ä¸ºä¼˜åŒ–1ä¸­æ˜ç¡®æŒ‡å‡ºç»™å”¯ä¸€ç´¢å¼•åŠ é”ï¼Œä»è€Œä¼˜åŒ– 2çš„å­—é¢æ„æ€æ¥ç†è§£ï¼Œå®ƒé€‚ç”¨äºæ™®é€šç´¢å¼•ã€‚ä¸çŸ¥é“æ˜¯ä¸æ˜¯æˆ‘ç†è§£çš„ä¸åˆ°ä½ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437326,"discussion_content":"ä¸»è¦æ˜¯è¿™é‡Œè¿™ä¸€è¡Œä¸å­˜åœ¨ã€‚ã€‚\nå¦‚æœèƒ½å¤Ÿæ˜ç¡®æ‰¾åˆ°ä¸€è¡Œé”ä½çš„è¯ï¼Œä½¿ç”¨ä¼˜åŒ–1å°±æ›´å‡†ç¡®äº›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548216054,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":197128,"user_name":"å–»èŒ‚","can_delete":false,"product_type":"c1","uid":1318661,"ip_address":"","ucode":"C8BD8086A17365","user_header":"https://static001.geekbang.org/account/avatar/00/14/1f/05/8a06692e.jpg","comment_is_top":false,"comment_ctime":1585359710,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5880327006","product_id":100020801,"comment_content":"<br>begin;<br>select * from t where id&gt;9 and id&lt;12 order by id desc for update;   è¿™ä¸ªè¿˜æ˜¯æœ‰ç‚¹ä¸å¤ªæ˜ç™½ <br>å› ä¸ºæ ¹æ®ä¸€ä¸ª bugï¼šå”¯ä¸€ç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢ä¼šè®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢ã€‚è¿™ä¸ªåŸåˆ™å‘å·¦éå†æ‰¾åˆ°5è¿™ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„å€¼åº”è¯¥è¦ç»“æŸå•Šï¼ŒåŠ é”åº”è¯¥æ˜¯[5,15) ä¸ºä»€ä¹ˆï¼ˆ0ï¼Œ5ï¼‰è¿˜ä¼šåŠ ä¸Šé—´éš™é”ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1889026,"avatar":"","nickname":"çº¢é¢œé“­å¿ƒ","note":"","ucode":"18F94E5444C71A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":232318,"discussion_content":"å”¯ä¸€ç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢ä¼šè®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢; å¹¶ä»¥è¯¥å€¼ä¸ºnext-key Lockçš„å³ä¾§è¾¹ç•Œ ç´¢å¼•ä¸Šä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸º5 ä»¥å®ƒä¸ºå³è¾¹ç•Œåº”è¯¥æ˜¯(0,5] åªä¸è¿‡è§‰å¾—å¤šé”äº†ä¸€æ®µåŒºé—´ï¼› å¦‚æœä¸ºorder by id  ascï¼Œåªæœ‰é—´æ­‡é”(10,15) åŒæ ·ä»¥ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºå³è¾¹ç•Œ(åŠ ä¸Šä¼˜åŒ–è§„åˆ™2)ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å¹¶æ²¡æœ‰å¤šé”é—´éš™ï¼› ä¸ªäººåˆ†æï¼šmysqlæ˜¯ä¸ºäº†å°†è§„åˆ™å˜å¾—æ›´ä¸ºé€šç”¨ï¼›ä¸è¿‡è§‰å¾—å¯ä»¥ä¼˜åŒ–ä¸‹ï¼Œå°†å‘å·¦éå†åŠ é”é€»è¾‘å˜æ›´ä¸ºï¼Œå°†ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä½œä¸ºnext-key Lockçš„å·¦ä¾§åŒºé—´å€¼ï¼Œé¿å…è¿‡åº¦åŠ é”ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586866616,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1351755,"avatar":"https://static001.geekbang.org/account/avatar/00/14/a0/4b/b818d731.jpg","nickname":"kkk","note":"","ucode":"33C6170F5E0CD5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":219413,"discussion_content":"æˆ‘ä¹Ÿæ˜¯ä¸æ˜ç™½è¿™ä¸€ç‚¹ï¼Œæˆ‘æ„Ÿè§‰æ˜¯ä¸æ˜¯å’Œorder by æœ‰å…³ç³»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585754197,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":184981,"user_name":"è·¯è¿‡çš„çŒª","can_delete":false,"product_type":"c1","uid":1207854,"ip_address":"","ucode":"5CC5FEB7977289","user_header":"https://static001.geekbang.org/account/avatar/00/12/6e/2e/008b5481.jpg","comment_is_top":false,"comment_ctime":1583461762,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5878429058","product_id":100020801,"comment_content":"ç™¾æ€ä¸å¾—å…¶è§£ï¼š<br><br>begin;<br>select * from t where c &lt; 15 for update;<br>select * from t where c = 15 for update;<br>é”ä½ (-âˆ, 15] ã€(15, 20)<br><br>begin;<br>select * from t where c &lt;= 15 for update;<br>é”ä½ (-âˆ, 15] ã€(15, 20]<br><br>ä¸ºä»€ä¹ˆä½¿ç”¨ &lt;= åï¼Œ20è¿™ä¸ªè®°å½•å°±åŠ ä¸Šé”äº†å‘¢ï¼Ÿ<br>æ˜¯MySQLæ•…æ„ä¸ºä¹‹ï¼Œè¿˜æ˜¯æœ‰å…¶ä»–åŸå› ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":2882162,"avatar":"","nickname":"Geek_bf19f6","note":"","ucode":"869D41CD1A291E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544592,"discussion_content":"æˆ‘æ„Ÿè§‰å¯ä»¥è¿™ä¹ˆæƒ³ å°±æ˜¯ç¬¬ä¸€ä¸ªâ•-âˆ,15ã€‘è‚¯å®šæ²¡é—®é¢˜ å¹¶ä¸”cå°äº15åˆ°15è¿™å—å°±å¯ä»¥ç»“æŸäº† æ‰€ä»¥ä¸éœ€è¦â•15,20çš„é” ä½†æ˜¯è¿˜æœ‰ä¸€ä¸ª=15çš„æ¡ä»¶ æ‰€ä»¥åˆ©ç”¨è¿™ä¸ªç­‰å€¼æ¥æ‰¾åˆ°(15,20) ä½ çš„ç¬¬äºŒä¸ªäº‹ç‰©åŒæ ·æ˜¯-âˆ,15]çš„å¼€å±€ åˆå› ä¸ºè¿™æ˜¯ä»å°åˆ°å¤§çš„æ’åº è€Œä¸”åªæœ‰ä¸€ä¸ªé”æ¡ä»¶(ç¬¬ä¸€ä¸ªäº‹ç‰©æœ‰ä¸¤ä¸ªæ¡ä»¶) æ‰€ä»¥æ­¤èŒƒå›´æŸ¥è¯¢çš„ç­‰å€¼æ¡ä»¶è‚¯å®šæ˜¯åœ¨å·¦è¾¹çš„èµ·ç‚¹å·²ç»ç”¨å®Œäº† æ‰€ä»¥åˆ°20åœæ­¢åªæ˜¯&lt;=çš„ç¬¬ä¸€ä¸ªçš„ä¸ç¬¦åˆçš„æ¡ä»¶ è¿™æ ·ä¸€æ¥15.20ã€‘å°±å­˜åœ¨äº† ä¸¤è€…çš„åŒºåˆ«åœ¨äºäº‹ç‰©ä¸€æ˜ç¡®æŒ‡å‡ºäº†15æœ‰ç­‰å€¼çš„æ¡ä»¶è€Œäº‹ç‰©äºŒè™½ç„¶&lt;=15çš„æ¡ä»¶ ä½†æ˜¯å¹¶ä¸èƒ½åº”ç”¨ 15ä½œä¸ºç­‰å€¼ã€‚è¿™ä¸»è¦çœ‹åˆ°åº•æ˜¯é€†åºè¿˜æ˜¯æ­£åº æ–‡ä¸­çš„éƒ½æ˜¯æ­£åº å¯¹äºèŒƒå›´æŸ¥æ‰¾ éƒ½æ˜¯æœ€å·¦è¾¹çš„å½“ä½œç­‰å€¼æ¡ä»¶ é€†åºåˆ™ç›¸åã€‚äºæ˜¯ä¹15éƒ½ä¸ä¼šåšä¸ºç­‰å€¼æŸ¥è¯¢ åªä¸è¿‡äº‹ç‰©1è¿˜æœ‰ç¬¬äºŒä¸ªåŠ é”æ¡ä»¶å°±æ˜¯15çš„ç­‰å€¼æŸ¥è¯¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641573858,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1015341,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7e/2d/abb7bfe3.jpg","nickname":"æ— çœ ","note":"","ucode":"26EB12DDBE36C0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":300020,"discussion_content":"begin; select * from t_lock_test where c<16 for update;\n\né”ä½äº†æ‰€æœ‰èŒƒå›´ï¼Œæ›´æ˜¯å¥‡æ€ª","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597912943,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":176660,"user_name":"æ–æ³¢é‚£å¥‘","can_delete":false,"product_type":"c1","uid":1464006,"ip_address":"","ucode":"85E2EBC01392B1","user_header":"https://static001.geekbang.org/account/avatar/00/16/56/c6/0b449bc6.jpg","comment_is_top":false,"comment_ctime":1581132827,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"5876100123","product_id":100020801,"comment_content":"è€å¸ˆ æœ€åé‚£ä¸¤ä¸ªä¾‹å­ æˆ‘åœ¨æˆ‘çš„MySQL 8.0ä¸Šè¯•æ˜¯å¯ä»¥çš„ æ²¡æœ‰é˜»å¡","like_count":1,"discussions":[{"author":{"id":1324550,"avatar":"https://static001.geekbang.org/account/avatar/00/14/36/06/08c46bcd.jpg","nickname":"è‚åˆ©","note":"","ucode":"808E064089724D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587397,"discussion_content":"8.0ä¿®å¤äº†bug","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663032338,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1990288,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/5e/90/6ab53210.jpg","nickname":"ä»˜å¨","note":"","ucode":"7C0E9724647F9B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":263218,"discussion_content":"è¯´æ²¡é˜»å¡çš„æ˜¯ä¸æ˜¯ä½ æ²¡ç†è§£è€å¸ˆsession B  æ˜¯ä¸¤ä¸ªäº‹åŠ¡å§ï¼Ÿæ˜¯ä¸æ˜¯æ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡å†…äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589189362,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"ä¸€æ­¥","note":"","ucode":"73CEA468CE70C3","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":1990288,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/5e/90/6ab53210.jpg","nickname":"ä»˜å¨","note":"","ucode":"7C0E9724647F9B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":410395,"discussion_content":"æ”¾åˆ°ä¸€ä¸ªäº‹ç‰©é‡Œé¢ ä¸ºä»€ä¹ˆå¯ä»¥æ‰§è¡ŒæˆåŠŸçš„ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635686075,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":263218,"ip_address":""},"score":410395,"extra":""}]},{"author":{"id":1586908,"avatar":"https://static001.geekbang.org/account/avatar/00/18/36/dc/97369381.jpg","nickname":"å¼ é’Ÿå¼º","note":"","ucode":"EE0D5CAEDBBAC8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":233273,"discussion_content":"æˆ‘ä¹Ÿæ˜¯mysql8.0çš„ï¼Œæ²¡é˜»å¡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586915443,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":133509,"user_name":"-W.LI-","can_delete":false,"product_type":"c1","uid":1210699,"ip_address":"","ucode":"3556786538664F","user_header":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","comment_is_top":false,"comment_ctime":1568595639,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"5863562935","product_id":100020801,"comment_content":"è€å¸ˆå¥½!ä¸çŸ¥é“è¿˜çœ‹å¾—è§ä¹ˆã€‚å¾ˆçŸ›ç›¾å•Šæœ‰ä¸ªåœ°æ–¹ã€‚<br>begin;<br>select * from t where id&gt;9 and id&lt;12 order by id desc for update;<br>åŠ é”æ–¹ä½æ˜¯(0,5]..(10.15)ã€‚åŠ é”æ—¶æ˜¯æ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³çš„æ¡ä»¶ç„¶ååŠ ä¸€ä¸ªå‰å¼€åé—­çš„ã€‚æ‰€ä»¥(0,5]ä¹Ÿè¢«åŠ é”äº†ï¼Œå¯ä»¥ã€‚<br>ä½†æ˜¯åˆ°äº†ä¸‹ä¸€ä¸ª<br>begin;<br>select id from t where c in(5,20,10) lock in share mode;<br>åœ¨æŸ¥æ‰¾ c=5 çš„æ—¶å€™ï¼Œå…ˆé”ä½äº† (0,5]ã€‚ä½†æ˜¯å› ä¸º c ä¸æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œä¸ºäº†ç¡®è®¤è¿˜æœ‰æ²¡æœ‰åˆ«çš„è®°å½• c=5ï¼Œå°±è¦å‘å³éå†ï¼Œæ‰¾åˆ° c=10 æ‰ç¡®è®¤æ²¡æœ‰äº†ï¼Œè¿™ä¸ªè¿‡ç¨‹æ»¡è¶³ä¼˜åŒ– 2ï¼Œæ‰€ä»¥åŠ äº†é—´éš™é” (5,10)ã€‚<br>ä½ å¯èƒ½ä¼šè¯´ï¼Œè¿™ä¸ªåŠ é”èŒƒå›´ï¼Œä¸å°±æ˜¯ä» (5,25) ä¸­å»æ‰ c=15 çš„è¡Œé”å—ï¼Ÿä¸ºä»€ä¹ˆè¿™ä¹ˆéº»çƒ¦åœ°åˆ†æ®µè¯´å‘¢ï¼Ÿ<br>ä¸‹é¢è¿™ä¸ªåŠ é”èŒƒå›´åˆ°åº•æ˜¯å¤šå°‘å•Š?ã€‚<br>(0,25)è¿˜æ˜¯(5,25)?cä¸æ˜¯å”¯ä¸€ç´¢å¼•ä¸ç¬¦åˆä¼˜åŒ–æ¡ä»¶ã€‚ä¹‹å‰9é‚£ä¸€è¡Œã€‚å¯¹(0,5]ï¼‹äº†é”ã€‚ç¬¬ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„æ˜¯0ï¼Œä¸ºå•¥ä¸å¯¹(-xxï¼Œ0]åŠ é”å‘¢?","like_count":1,"discussions":[{"author":{"id":1257945,"avatar":"https://static001.geekbang.org/account/avatar/00/13/31/d9/1a748694.jpg","nickname":"ä¸æ˜¯å…šå‘˜","note":"","ucode":"1C8DD42D693FFA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377232,"discussion_content":"åŒæ ·å¯¹ã€ä¸å°±æ˜¯ä» (5,25) ä¸­å»æ‰ c=15 çš„è¡Œé”å—ï¼Ÿã€‘è¿™å¥è¯æœ‰ç–‘é—®ï¼Œä¸ºä»€ä¹ˆæ˜¯ (5,25) è€Œä¸æ˜¯ (0,25) ï¼Ÿæœ€å¼€å§‹ä¸æ˜¯å·²ç»æ ¹æ®åŸåˆ™ 1 ä¸ºåŒºé—´ (0, 5] æ·»åŠ  next-key lock äº†ä¹ˆï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622555459,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1788647,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/4a/e7/6c16af5d.jpg","nickname":"æ±‰æ±Ÿ","note":"","ucode":"01622D984B8F9B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":352675,"discussion_content":"æˆ‘ç†è§£çš„ä¸ºä»€ä¹ˆåŠ é”åˆ†æ®µè¯´ æ˜¯å› ä¸ºåŠ é”æ˜¯ä¸€ä¸ªå€¼ä¸€ä¸ªå€¼åŠ çš„ï¼Œé‚£ä¹ˆè¿™æ ·çš„è¯ å¦‚æœåˆšå¥½æœ‰ä¸€ä¸ªåŠ é”æ˜¯ å€’åºå¼€å§‹åŠ  æ¯”å¦‚ å…ˆåŠ  20 å†åŠ  10 å†åŠ  5 è¿™æ ·æœ‰å¯èƒ½è¿™ä¸¤ä¸ªè¯­å¥ä¼šå½¢æˆæ­»é”ï¼Œå¦‚æœæ˜¯ä¸€ä¸‹å­æŠŠé”éƒ½åŠ å®Œ é‚£é¡¶å¤šæ˜¯ å¦ä¸€ä¸ªäº‹åŠ¡ç­‰å¾… ä¸ä¼šå½¢æˆæ­»é”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614817576,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1674555,"avatar":"https://static001.geekbang.org/account/avatar/00/19/8d/3b/42d9c669.jpg","nickname":"è‰¾ç‘å…‹å°éœ¸ç‹","note":"","ucode":"58FCCAC0F675E1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":166212,"discussion_content":"æˆ‘ä¹Ÿè§‰å¾—æ˜¯  (0,15) (15,25)... ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581355421,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":118298,"user_name":"é”‹èŠ’","can_delete":false,"product_type":"c1","uid":1320419,"ip_address":"","ucode":"BB5284E3C8D78D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ach5TNuIu8T4Of8ibvfWM4JPic5uQn9Y7TgGjBHLp2iar4icxJzs14bpUXV9OdYiciblvJl14zSqXjwtDffHnSTqbD6g/132","comment_is_top":false,"comment_ctime":1564313645,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5859280941","product_id":100020801,"comment_content":"è€å¸ˆï¼Œ åœ¨è¯»æäº¤ éš”ç¦»çº§åˆ« ä¹Ÿä¼šæœ‰ é—´éš™é”next-key lock  ä¹ˆ ï¼Ÿnext-key lock åœ¨mysqlä¸­æ€ä¹ˆå¯åŠ¨å‘¢ ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":2542376,"avatar":"https://static001.geekbang.org/account/avatar/00/26/cb/28/21a8a29e.jpg","nickname":"å¤å¤©","note":"","ucode":"5F224DDAC94DFF","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368693,"discussion_content":"åœ¨è¯»æäº¤ éš”ç¦»çº§åˆ« é™¤äº†å¤–é”®ç”¨åˆ° gap é”ï¼Œå…¶ä»–éƒ½æ˜¯è¡Œé”","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1618804940,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":98817,"user_name":"è¿˜ä¸€æ£µæ ‘","can_delete":false,"product_type":"c1","uid":1317709,"ip_address":"","ucode":"C187F2A141D60E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eop9WylZJicLQxlvXukXUgPp39zJHyyReK5s1C9VhA6rric7GiarbfQMuWhdCCDdxdfL610Hc4cNkn9Q/132","comment_is_top":false,"comment_ctime":1559099998,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5854067294","product_id":100020801,"comment_content":"ä¸ºä»€ä¹ˆæˆ‘åœ¨5.6çš„ç‰ˆæœ¬ä¸Š æµ‹è¯•  æ–‡ä¸­æœ€å2ä¸ªæ­»é”çš„æ¡ˆä¾‹éƒ½æ²¡æœ‰å¤ç° ï¼ˆrrï¼Œrcéƒ½æµ‹è¯•äº†ï¼Œæ²¡æœ‰å¤ç°æ­»é”ï¼‰<br>CREATE TABLE `t` (<br>  `id` int(11) NOT NULL,<br>  `c` int(11) DEFAULT NULL,<br>  `d` int(11) DEFAULT NULL,<br>  PRIMARY KEY (`id`),<br>  KEY `i_c` (`c`)<br>) ENGINE=InnoDB DEFAULT CHARSET=latin1ï¼›<br>gaotuan[test]11:17:59&gt;select *  from t;<br>+----+------+------+<br>| id | c    | d    |<br>+----+------+------+<br>|  0 |    0 |    0 |<br>|  1 |    1 |    1 |<br>|  5 |    5 |    5 |<br>| 10 |   10 |   10 |<br>| 15 |   15 |   15 |<br>| 20 |   20 |   20 |<br>| 25 |   25 |   25 |<br>+----+------+------+<br>session1ï¼š<br>gaotuan[test]11:02:04&gt;begin;<br>Query OK, 0 rows affected (0.00 sec)<br><br>gaotuan[test]11:02:07&gt;select c from t where c&gt;5 lock in share mode;<br>+------+<br>| c    |<br>+------+<br>|   10 |<br>|   15 |<br>|   20 |<br>|   25 |<br>+------+<br>4 rows in set (0.00 sec)<br><br>session2ï¼š<br>gaotuan[test]11:05:08&gt;begin;<br>Query OK, 0 rows affected (0.00 sec)<br><br>gaotuan[test]11:05:11&gt;<br>gaotuan[test]11:05:13&gt;delete from t where id=10;<br>Query OK, 1 row affected (0.00 sec)<br><br>gaotuan[test]11:05:19&gt;insert into t values(10,10,10);<br>Query OK, 1 row affected (0.00 sec)<br><br>gaotuan[test]11:05:30&gt;rollback;","like_count":1},{"had_liked":false,"id":76522,"user_name":"w","can_delete":false,"product_type":"c1","uid":1318306,"ip_address":"","ucode":"DB837CAE2FB7C7","user_header":"https://static001.geekbang.org/account/avatar/00/14/1d/a2/ef8758c9.jpg","comment_is_top":false,"comment_ctime":1552625682,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"5847592978","product_id":100020801,"comment_content":"æœ‰ä¸ªå¾ˆå¥‡æ€ªçš„ç°è±¡<br>session a: begin; select * from cd where c &lt;= 10 for update;<br>session b: select * from cd where c = 15 for update;<br>æ­¤æ—¶session bä¼šè¢«block<br>session aç¨ä½œä¿®æ”¹<br>session a: begin; select * from cd where c = 10 for update;<br>session b: select * from cd where c = 15 for update;<br>\bæ­¤æ—¶session bä¸ä¼šè¢«é˜»å¡ä½ã€‚æˆ‘ç†è§£å³ä½¿c&lt;=10è¿™ç§ä¹Ÿä¸åº”è¯¥é˜»å¡c=15ã€‚<br>æˆ‘ç†è§£çš„åŠ é”è¿‡ç¨‹æ˜¯ç­‰å€¼æŸ¥æ‰¾åˆ°c=10è¿™ä¸€è¡Œï¼Œå‘å³éå† next-key lockä¸ºï¼ˆ10ï¼Œ15]ï¼Œæ ¹æ®ä¼˜åŒ–2é€€åŒ–ä¸º(10,15) ã€‚ä½†æ˜¯å®éªŒç»“æœä»¤äººè´¹è§£","like_count":1,"discussions":[{"author":{"id":1593250,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/KRaFF1vD8IklMK39rL3JxQ4LwvG04P8IIUU63Kk0Js6GA3iclxJH3YFA2nm07Ajc6QsnKbgSqhj8N5OPBRib2GuA/132","nickname":"River91","note":"","ucode":"D0E7C001E4188E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2452,"discussion_content":"explainä¸€ä¸‹ï¼Œå‘ç°æ²¡æœ‰èµ°ç´¢å¼•ï¼Œèµ°äº†å…¨è¡¨æ‰«æï¼Œæ ¹æ®è§„åˆ™2ï¼Œæ‰€æœ‰è®°å½•éƒ½ä¼šåŠ é”ã€‚æˆ‘æ˜¯è¿™ä¹ˆç†è§£çš„","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1563633646,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":568650,"discussion_content":"èŒƒå›´æŸ¥è¯¢æ˜¯bugã€‚ä¸ä¼šé€€åŒ–é—´éš™é”ã€‚è¿™äº›åŠ é”çš„è§„åˆ™ä¸€å®šè¦åŒºåˆ†å¥½ç§ç±»ã€‚æ¯”å¦‚å”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢ã€‚éå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢ã€‚ç­‰å€¼èŒƒå›´ã€‚èŒƒå›´ï¼Œæ’åº...","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651194266,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1226968,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b8/d8/f81b5604.jpg","nickname":"hcyycb","note":"","ucode":"77FF6CA41F9E66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4485,"discussion_content":"ä¸»è¦æ˜¯ä½ è¿™é‡Œç”¨çš„æ˜¯ æ’å®ƒé”ï¼Œè€Œä¸” select * è¿™æ ·æ˜¯è¦â€œå›è¡¨â€çš„ï¼Œç”¨explain æ˜¾ç¤ºæ˜¯å…¨è¡¨æ‰«æï¼Œè®¿é—®åˆ°çš„å¯¹è±¡éƒ½è¦åŠ é”ï¼ŒåŠ äº†æ’å®ƒé”åï¼Œå…¶ä»–æƒ³è¯»çš„é”éƒ½åŠ ä¸ä¸Šäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565458365,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1226196,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b5/d4/3bd5b77b.jpg","nickname":"ä½‘å„¿","note":"","ucode":"0629888E7A5E16","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1922,"discussion_content":"æˆ‘ä¹Ÿæœ‰åŒæ ·çš„ç–‘é—®ï¼Œå“ªä½å¤§ç¥è§£ç­”ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563097206,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62305,"user_name":"å¾€äº‹éšé£ï¼Œé¡ºå…¶è‡ªç„¶","can_delete":false,"product_type":"c1","uid":1235692,"ip_address":"","ucode":"F266EC6B143E38","user_header":"https://static001.geekbang.org/account/avatar/00/12/da/ec/779c1a78.jpg","comment_is_top":false,"comment_ctime":1548030269,"is_pvip":false,"replies":[{"id":"22027","content":"ç¬¬22ç¯‡æ–‡ç« æœ«å°¾æœ‰è¯´æ˜çš„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1548037252,"ip_address":"","comment_id":62305,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5842997565","product_id":100020801,"comment_content":"ç¬¬ 21 ç¯‡æ–‡ç« çš„è¯¾åæ€è€ƒé¢˜ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œ select * from t where c&gt;=15 and c&lt;=20 order by c desc lock in share mode; å‘å·¦æ‰«æåˆ° c=10 çš„æ—¶å€™ï¼Œè¦æŠŠ (5, 10] é”èµ·æ¥ã€‚è¿™é‡Œé¢æ€ä¹ˆä¼šæŠŠ5-10ä¹Ÿé”èµ·æ¥ï¼Ÿä¸æ˜¯å‘å·¦éå†æ‰¾åˆ°10å°±ç»“æŸäº†ï¼Ÿå¹²å˜›è¿˜è¦æ‰¾5","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437164,"discussion_content":"ç¬¬22ç¯‡æ–‡ç« æœ«å°¾æœ‰è¯´æ˜çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548037238,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1997293,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/79/ed/4737a49b.jpg","nickname":"é›ªã®é›«Â·é›¨ã®éŸ³","note":"","ucode":"0693DA3939A321","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":270903,"discussion_content":"next-key lockæ˜¯åŠ é”çš„åŸºæœ¬å•ä½ï¼Œæ‰€ä»¥æ‰«æåˆ°c=10çš„è®°å½•çš„æ—¶å€™åŠ é”åŠ çš„å°±æ˜¯(5,10]","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590067874,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":357832,"user_name":"LL","can_delete":false,"product_type":"c1","uid":3004698,"ip_address":"å±±è¥¿","ucode":"1E498475B2D9EC","user_header":"https://static001.geekbang.org/account/avatar/00/2d/d9/1a/f5bb1a23.jpg","comment_is_top":false,"comment_ctime":1663668938,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1663668938","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œé¦–å…ˆæ„Ÿè°¢è€å¸ˆï¼Œä»è€å¸ˆè¿™å­¦åˆ°äº†ä¸å°‘MySQLçš„çŸ¥è¯†ã€‚ä¹‹å‰çœ‹è¿™ä¸‰ç¯‡çš„æ–‡ç« çš„æ—¶å€™äº‘é‡Œé›¾é‡Œï¼Œæœ€è¿‘å¿«çœ‹å®Œä¸“æ äº†ï¼Œåˆå›è¿‡å¤´æ¥çœ‹é—´éš™é”è¿™å—ï¼Œå¤§éƒ¨åˆ†é—®é¢˜éƒ½æ˜æœ—äº†ï¼Œä½†è¿˜æ˜¯æœ‰ç–‘æƒ‘ï¼ŒåŠ é”è§„åˆ™2ï¼šæŸ¥æ‰¾è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„å¯¹è±¡â€œæ‰ä¼šâ€åŠ é”ï¼ˆ21è®²æ¡ˆä¾‹2ä¸­åˆå†™åˆ° æ ¹æ®åŸåˆ™ 2ï¼Œè®¿é—®åˆ°çš„â€œéƒ½è¦â€åŠ é” ï¼‰ã€‚<br><br>1.ç¬¬ä¸€ä¸ªé—®é¢˜ï¼š<br>æŒ‰ç…§æ‰«æåˆ°éƒ½è¦åŠ çš„è¯ï¼Œç¬¬20è®²ä¸­ï¼Œc=5çš„ç­‰å€¼æŸ¥è¯¢ï¼ŒåŠ äº†(0ï¼Œ5]ï¼Œå†æ‰«æåˆ°ä¸ç¬¦åˆçš„æ¡ä»¶10ï¼ŒåŠ (5,10]å†ä¼˜åŒ–ä¸º(5,10)ã€‚çœ‹äº†ç¬¬30è®²ä¹‹åï¼Œä¸ç­‰å·é‡Œçš„ç­‰å€¼æŸ¥è¯¢ï¼Œid&gt;12ï¼Œæ˜¯å…ˆæ‰¾id=12ã€‚é‚£åè¾¹çš„id&gt;10çš„èŒƒå›´æŸ¥è¯¢ï¼Œä¸åº”è¯¥å°±æ˜¯å…ˆæ‰¾id=10çš„è®°å½•å—ï¼Œæ­¤id=10è¿™ä¸ªè®°å½•å­˜åœ¨ï¼Œæ ¹æ®è®¿é—®åˆ°éƒ½è¦åŠ é”,é‚£ä¸ºä»€ä¹ˆä¸åŠ next-key lock (å†ä¼˜åŒ–æˆè¡Œé”)ã€‚<br>2.ç¬¬äºŒä¸ªé—®é¢˜<br>éå”¯ä¸€ç´¢å¼•çš„ç­‰å€¼æŸ¥è¯¢ï¼Œå¦‚c=5ï¼Œid=5,ä¸ºä»€ä¹ˆæœ‰å¿…è¦åŠ (5,10)çš„é”ï¼Ÿä¸åŠ çš„è¯ï¼Œc=5,id=6ï¼Œä¼šè¢«é˜»å¡å—ã€‚<br>æ¥è§¦ä¸“æ çš„æ—¶é—´æ¯”è¾ƒæ™šï¼Œä¸çŸ¥é“è€å¸ˆè¿˜å…³æ³¨ç•™è¨€ä¸~","like_count":0},{"had_liked":false,"id":350755,"user_name":"å¼‹å»¶","can_delete":false,"product_type":"c1","uid":2708966,"ip_address":"","ucode":"D04AAEDF8C658A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epRo9GU1yic8fZwJp2ia9qq0RL7nCvDcosxwwIMZxSHtxjh4aLezyuvYdzgsEY2cib9ibSJNIqb8gFqHw/132","comment_is_top":false,"comment_ctime":1657173389,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1657173389","product_id":100020801,"comment_content":"èŒƒå›´ã€ç­‰å€¼","like_count":0},{"had_liked":false,"id":347706,"user_name":"whyly","can_delete":false,"product_type":"c1","uid":1798882,"ip_address":"","ucode":"D34D6B7164C982","user_header":"https://static001.geekbang.org/account/avatar/00/1b/72/e2/95b0543c.jpg","comment_is_top":false,"comment_ctime":1654331900,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1654331900","product_id":100020801,"comment_content":"ç©ºè¡¨é—´éš™æ˜¯(Infimum, Supremum]","like_count":0},{"had_liked":false,"id":339576,"user_name":"ä½ä½çœŸå›","can_delete":false,"product_type":"c1","uid":2761438,"ip_address":"","ucode":"CE6E1A08C30DB1","user_header":"https://static001.geekbang.org/account/avatar/00/2a/22/de/1351551d.jpg","comment_is_top":false,"comment_ctime":1648199185,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1648199185","product_id":100020801,"comment_content":"å¯ä»¥ä»B+æ•°èŸ¹è¡Œåè®®çš„è§’åº¦æ¥ç†è§£next-key lockå’Œè¡Œé”ä¹‹é—´çš„è½¬åŒ–","like_count":0},{"had_liked":false,"id":338370,"user_name":"å¯¥è‹¥æ™¨æ˜Ÿ","can_delete":false,"product_type":"c1","uid":1447739,"ip_address":"","ucode":"2E87E43687DE72","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eou1BMETumU21ZI4yiaLenOMSibzkAgkw944npIpsJRicmdicxlVQcgibyoQ00rdGk9Htp1j0dM5CP2Fibw/132","comment_is_top":false,"comment_ctime":1647441052,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1647441052","product_id":100020801,"comment_content":"å¤§å®¶è²Œä¼¼éƒ½å¯¹ç­‰å€¼æŸ¥è¯¢çš„æŸ¥æ‰¾è¿‡ç¨‹ï¼ŒæŸ¥æ‰¾çš„è¿‡ç¨‹ä¸­æ˜¯å¦è®¿é—®äº†æŸä¸ªè®°å½•è¿™ç§é—®é¢˜ç†ä¸æ¸…æ¥šï¼Œå¸Œæœ›å†è¡¥å……ä¸€ä¸‹","like_count":0},{"had_liked":false,"id":338024,"user_name":"æ°sir","can_delete":false,"product_type":"c1","uid":1098505,"ip_address":"","ucode":"80BB56B3BFB71A","user_header":"https://static001.geekbang.org/account/avatar/00/10/c3/09/dc368335.jpg","comment_is_top":false,"comment_ctime":1647241010,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1647241010","product_id":100020801,"comment_content":"ç–‘é—®ï¼š<br>select * from t where id &gt;=10 and id &lt;= 15 order by id desc for update<br>å¦‚ä½•åˆ†æè¿™ä¸ªä¾‹å­çš„åŠ é”æµç¨‹å‘¢ï¼Ÿ<br>1ï¼Œç­‰å€¼æŸ¥è¯¢id=15ï¼Œæ‰¾åˆ°äº†ï¼Œå¯¹id=15åŠ è¡Œé”ã€ä¼˜åŒ–1ã€‘<br>2ï¼Œorder by id desc å‘å·¦éå†ï¼Œæ‰¾åˆ°id=10ï¼ŒåŠ next-key lock (5,10]ï¼Œæ»¡è¶³id&gt;=10ç»§ç»­å‘å·¦éå†ï¼Œ<br>3ï¼Œæ‰¾åˆ°id=5ï¼ŒåŠ next-key lock (0,5]ï¼Œä¸æ»¡è¶³id&gt;=10ç»“æŸ<br>4ï¼Œæœ€ç»ˆåŠ é”èŒƒå›´æ˜¯(0,5],(5,10],15ï¼Œä½†æ˜æ˜¾æœ‰é—®é¢˜ï¼Œå¦‚ä½•è§£é‡Šå‘¢ï¼Ÿ<br><br>order id ascåˆ™å¾ˆå¥½åˆ†æï¼š<br>select * from t where id &gt;=10 and id &lt;= 15 for update<br>å¦‚ä½•åˆ†æè¿™ä¸ªä¾‹å­çš„åŠ é”æµç¨‹å‘¢ï¼Ÿ<br>1ï¼Œç­‰å€¼æŸ¥è¯¢id=10ï¼Œæ‰¾åˆ°äº†ï¼Œå¯¹id=10åŠ è¡Œé”ã€ä¼˜åŒ–1ã€‘<br>2ï¼Œå‘å³éå†ï¼Œæ‰¾åˆ°id=15ï¼ŒåŠ next-key lock (10,15]ï¼Œæ»¡è¶³id&lt;=15ç»§ç»­å‘å³éå†ï¼Œ<br>3ï¼Œæ‰¾åˆ°id=20ï¼ŒåŠ next-key lock (15,20]ï¼Œä¸æ»¡è¶³id&lt;=15ç»“æŸ<br>4ï¼Œæœ€ç»ˆåŠ é”èŒƒå›´æ˜¯10,(10,15],(15,20]","like_count":0},{"had_liked":false,"id":327673,"user_name":"yueyuebaby","can_delete":false,"product_type":"c1","uid":1100903,"ip_address":"","ucode":"7766CFACE88D91","user_header":"https://static001.geekbang.org/account/avatar/00/10/cc/67/2ce23ee6.jpg","comment_is_top":false,"comment_ctime":1640228165,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1640228165","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ã€‚è¿™ä¸ªæ­»é”é—®é¢˜ä¸€ç›´æ²¡æœ‰ç†è§£ï¼Œä¸»é”®è®°å½•çš„updateæ›´æ–°è‡ªå¢æŸä¸ªå­—æ®µæ­»é”äº†ï¼Œå¦‚sqlï¼š        update `tb_cp`  SET  `completed_total`  =`completed_total`  +1 WHERE  id = 644<br>        å¹¶å‘æ›´æ–°ã€‚éº»çƒ¦è€å¸ˆè§£ç­”ä¸€ä¸‹ï¼Œè°¢è°¢ã€‚<br>æ­»é”æ—¥å¿—å¦‚ä¸‹ï¼š<br>        2021-05-16 14:39:45 7fbd4ffff700<br>        *** (1) TRANSACTION:<br>        TRANSACTION 40213711, ACTIVE 1.169 sec starting index read<br>        mysql tables in use 1, locked 1<br>        LOCK WAIT 27 lock struct(s), heap size 2936, 19 row lock(s), undo log entries 8<br>        LOCK BLOCKING MySQL thread id: 822312382 block 839573619<br>        MySQL thread id 839573619, OS thread handle 0x7fbd49bff700, query id 1115380 10.168.23.17 cp updating<br>        update `tb_cp`  SET  `completed_total`  =`completed_total`  +1 WHERE  id = 644<br>        *** (1) WAITING FOR THIS LOCK TO BE GRANTED:<br>        RECORD LOCKS space id 26 page no 8 n bits 296 index `PRIMARY` of table `xl`.`tb_cp` trx id 40213711 lock_mode X locks rec but not gap waiting<br>        Record lock, heap no 64 PHYSICAL RECORD: n_fields 12; compact format; info bits 0<br>        *** (2) TRANSACTION:<br>        TRANSACTION 40213713, ACTIVE 0.927 sec starting index read<br>        mysql tables in use 1, locked 1<br>        27 lock struct(s), heap size 2936, 19 row lock(s), undo log entries 8<br>        MySQL thread id 822312382, OS thread handle 0x7fbd4ffff700, query id 1115413 10.168.23.17 cp updating<br>        update `tb_cp`  SET  `completed_total`  =`completed_total`  +1 WHERE  id = 644<br>        *** (2) HOLDS THE LOCK(S):<br>        RECORD LOCKS space id 26 page no 8 n bits 296 index `PRIMARY` of table `xl`.`tb_cp` trx id 40213713 lock mode S locks rec but not gap<br>        Record lock, heap no 64 PHYSICAL RECORD: n_fields 12; compact format; info bits 0<br>        *** (2) WAITING FOR THIS LOCK TO BE GRANTED:<br>        RECORD LOCKS space id 26 page no 8 n bits 296 index `PRIMARY` of table `xl`.`tb_cp` trx id 40213713 lock_mode X locks rec but not gap waiting<br>        Record lock, heap no 64 PHYSICAL RECORD: n_fields 12; compact format; info bits 0<br>        *** WE ROLL BACK TRANSACTION (2)","like_count":0},{"had_liked":false,"id":324419,"user_name":"FelixFly","can_delete":false,"product_type":"c1","uid":1160461,"ip_address":"","ucode":"1D39A7C3D0E31F","user_header":"https://static001.geekbang.org/account/avatar/00/11/b5/0d/0e65dee6.jpg","comment_is_top":false,"comment_ctime":1638426068,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1638426068","product_id":100020801,"comment_content":"begin;<br>select * from t where id&gt;9 and id&lt;12 order by id desc for update;<br>åŠ é”èŒƒå›´æ˜¯ä¸»é”®ç´¢å¼•ä¸Šçš„ (0,5]ã€(5,10]å’Œ (10, 15)ï¼Œå…¶ä¸­(5,10]å’Œ (10, 15)éƒ½å¥½ç†è§£ï¼Œä¸æ˜¯æœ‰id &gt; 9 æ¡ä»¶ä¹ˆï¼Ÿä¸ºå•¥è¿˜ä¼šé”(0,5]ï¼Ÿ<br><br>å½“å»æ‰äº†`order by id desc` ï¼ŒåŠ é”èŒƒå›´æ˜¯ä¸»é”®ç´¢å¼•ä¸Šçš„(5,10]å’Œ (10, 15]ï¼Œè¿™ä¸ªåˆåŒ…å«15æ˜¯ä»€ä¹ˆåŸå› <br><br>","like_count":0,"discussions":[{"author":{"id":1160461,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b5/0d/0e65dee6.jpg","nickname":"FelixFly","note":"","ucode":"1D39A7C3D0E31F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535719,"discussion_content":"å°´å°¬ï¼Œæ–‡ç« ä¸‹é¢æ‰¾ä¸åˆ°è‡ªå·±çš„ç•™è¨€è®°å½•ï¼Œæçš„é—®é¢˜è‡ªå·±æ²¡æœ‰åŠæ³•å›ç­”ï¼Œè®°å¾—APPä¸Šæœ‰ç²¾é€‰ç•™è¨€ï¼Œæ‰€ä»¥åœ¨è¿™è¯„è®ºä¸‹è‡ªå·±ï¼Œç»è¿‡è‡ªå·±çš„æ¢ç´¢å’Œç†è§£ï¼š\nè¯­å¥1ï¼š`begin; select * from t where id &gt; 9 and id &lt; 12 order by id desc for update`;\n\nè¿™ä¸ªé”çš„èŒƒå›´æ˜¯(0,5]ã€(5,10]å’Œ(10,15)\n\n* ç”±äºå­˜åœ¨`order by id desc`å­˜åœ¨ï¼Œç´¢å¼•å…ˆä»`id &lt; 12`å¼€å§‹æŸ¥æ‰¾12çš„ä½ç½®ï¼Œæ²¡æœ‰æ‰¾åˆ°ï¼Œæ‰¾åˆ°äº†(10,15)çš„é—´éš™ï¼Œä¼˜åŒ–â‘¡\n* å‘å·¦éå†ï¼ŒæŸ¥è¯¢åˆ°10è¿™ä¸ªå€¼ï¼Œè¿™ä¸ªæ—¶å€™åŠ (5,10]ï¼Œåˆ¤æ–­æ¡ä»¶id &gt; 9 æˆç«‹ï¼Œç»§ç»­å‘å·¦éå†ï¼ŒåŸåˆ™â‘ å’ŒåŸåˆ™â‘¡\n* å‘å·¦éå†ï¼ŒæŸ¥è¯¢åˆ°5è¿™ä¸ªå€¼ï¼Œè¿™ä¸ªæ—¶å€™åŠ (0,5]ï¼Œåˆ¤æ–­æ¡ä»¶id &gt; 9 ä¸æˆç«‹äº†ï¼Œç»“æŸåŠ é”ï¼ŒåŸåˆ™â‘ å’ŒåŸåˆ™â‘¡\n\nè¯­å¥2ï¼š`begin; select * from t where id &gt; 9 and id &lt; 12 for update`;\n\nè¿™ä¸ªé”çš„èŒƒå›´æ˜¯(5,10]å’Œ(10,15]\n\n* `id &gt; 9` å…ˆæ‰¾åˆ°9 è¿™ä¸ªå€¼ï¼Œæ²¡æœ‰æ‰¾åˆ°ï¼Œæ‰¾åˆ°äº†(5,10)çš„é—´éš™ï¼Œä¼˜åŒ–â‘¡\n* å‘å³éå†ï¼Œæ‰¾åˆ°10è¿™ä¸ªå€¼ï¼Œè¿™ä¸ªæ—¶å€™åŠ (5,10]ï¼Œåˆ¤æ–­æ¡ä»¶id &lt;12 æˆç«‹ï¼ŒåŸåˆ™â‘ å’ŒåŸåˆ™â‘¡\n* å‘å³éå†ï¼Œæ‰¾åˆ°15è¿™ä¸ªå€¼ï¼Œè¿™ä¸ªæ—¶å€™åŠ (10,15]ï¼Œåˆ¤æ–­æ¡ä»¶id &lt;12 ä¸æˆç«‹äº†ï¼Œç»“æŸåŠ é”ï¼ŒåŸåˆ™â‘ å’ŒåŸåˆ™â‘¡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638523833,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":318467,"user_name":"Wolfã€Heart","can_delete":false,"product_type":"c1","uid":1111825,"ip_address":"","ucode":"9A6FC15DAF6269","user_header":"https://static001.geekbang.org/account/avatar/00/10/f7/11/714285d8.jpg","comment_is_top":false,"comment_ctime":1635304604,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1635304604","product_id":100020801,"comment_content":"1.æ‰§è¡Œè¯­å¥select * from t where id&gt;9 and id&lt;12 order by id desc for updateï¼ŒåŠ é”èŒƒå›´ï¼š(0,5]ã€(5,10]å’Œ (10, 15)ï¼Œç»™å‡ºçš„è§£é‡Šï¼šå¼•æ“å†…éƒ¨ä¼šæŸ¥æ‰¾12è¿™æ¡è®°å½•ï¼Œç”±äºè®°å½•ä¸å­˜åœ¨ï¼Œåªèƒ½æ‰¾åˆ°(10,15)é—´éš™<br>2.æ‰§è¡Œselect c from t where c &gt; 5 lock in share modeè¯­å¥ï¼ŒæŒ‰ç…§å¦‚ä¸Šçš„è§£é‡Šï¼Œå¼•æ“å†…éƒ¨åº”è¯¥æŸ¥æ‰¾5è¿™æ¡è®°å½•ï¼Œé‚£ä¹ˆåŠ é”èŒƒå›´å°±åº”è¯¥åŒ…å«(0, 5)ï¼Œç„¶è€Œå®é™…åŠ é”èŒƒå›´ï¼š(5,10]ã€(10,15]ã€(15,20]ã€(20,25](25,supremum]<br>æœŸå¾…ä½ çš„å›å¤ï¼Œè§£é™¤å¿ƒä¸­ç–‘æƒ‘ï¼Œæ„Ÿæ¿€ä¸å°½<br>","like_count":0,"discussions":[{"author":{"id":1111825,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/11/714285d8.jpg","nickname":"Wolfã€Heart","note":"","ucode":"9A6FC15DAF6269","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":412414,"discussion_content":"èŒƒå›´æŸ¥è¯¢é¦–å…ˆä¹Ÿæ˜¯å®šä½è®°å½•ï¼Œé’ˆå¯¹ç¬¬äºŒæ¡æŸ¥è¯¢è¯­å¥c > 5ï¼Œå¯ä»¥å…ˆå®šä½5è¿™æ¡è®°å½•ï¼Œå› æ­¤åŠ é”èŒƒå›´ï¼ˆ0,5]ï¼Œ(5,10],(10,15],(15,20],(20,25],(25,superme],ç”±äº5è¿™æ¡è®°å½•åªæ˜¯ç”¨äºè¾…åŠ©å®šä½è®°å½•ï¼Œåœ¨æŸ¥è¯¢ä¸­å…¶å®å¹¶ä¸å­˜åœ¨ï¼Œå› æ­¤éœ€è¦æŠŠ(0,5]åŠ é”èŒƒå›´å»é™¤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636162913,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":316431,"user_name":"å°ä¹™å“¥","can_delete":false,"product_type":"c1","uid":1063308,"ip_address":"","ucode":"C77E79BEA0C325","user_header":"https://static001.geekbang.org/account/avatar/00/10/39/8c/089525aa.jpg","comment_is_top":false,"comment_ctime":1634302562,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634302562","product_id":100020801,"comment_content":"https:&#47;&#47;stackoverflow.com&#47;questions&#47;66898742&#47;mysql-unique-key-causes-dead-lock<br>å“ªä½å¤§ç¥å¯ä»¥å¸®å¿™åˆ†æä¸€ä¸‹è¿™ä¸ªæ­»é”","like_count":0},{"had_liked":false,"id":315942,"user_name":"ç‰¹ç«‹ç‹¬è¡Œçš„çŒª","can_delete":false,"product_type":"c1","uid":1465344,"ip_address":"","ucode":"1440F96375740A","user_header":"https://static001.geekbang.org/account/avatar/00/16/5c/00/5d11e68d.jpg","comment_is_top":false,"comment_ctime":1634078101,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634078101","product_id":100020801,"comment_content":"session 1ï¼š<br>delete from t2;<br>begin; select * from t2 for update;<br>session 2:<br>insert into t2 values(1,1,1);å‘ç”Ÿç­‰å¾…<br><br>show engine innodb status\\G;<br>------------<br>TRANSACTIONS<br>------------<br>Trx id counter 104558<br>Purge done for trx&#39;s n:o &lt; 104549 undo n:o &lt; 0 state: running but idle<br>History list length 0<br>LIST OF TRANSACTIONS FOR EACH SESSION:<br>---TRANSACTION 421974886751856, not started<br>0 lock struct(s), heap size 1136, 0 row lock(s)<br>---TRANSACTION 104557, ACTIVE 24 sec inserting<br>mysql tables in use 1, locked 1<br>LOCK WAIT 2 lock struct(s), heap size 1136, 1 row lock(s)<br>MySQL thread id 34, OS thread handle 140477509486336, query id 349 localhost root update<br>insert into t2 values(1)<br>------- TRX HAS BEEN WAITING 24 SEC FOR THIS LOCK TO BE GRANTED:<br>RECORD LOCKS space id 44 page no 3 n bits 72 index PRIMARY of table `test01`.`t2` trx id 104557 lock_mode X insert intention waiting<br>Record lock, heap no 1 PHYSICAL RECORD: n_fields 1; compact format; info bits 0<br>0: len 8; hex 73757072656d756d; asc supremum;;<br><br>mysql&gt; select * from information_schema.innodb_locks;<br>+---------------+-------------+-----------+-----------+---------------+------------+------------+-----------+----------+------------------------+<br>| lock_id       | lock_trx_id | lock_mode | lock_type | lock_table    | lock_index | lock_space | lock_page | lock_rec | lock_data              |<br>+---------------+-------------+-----------+-----------+---------------+------------+------------+-----------+----------+------------------------+<br>| 104557:44:3:1 | 104557      | X         | RECORD    | `test01`.`t2` | PRIMARY    |         44 |         3 |        1 | supremum pseudo-record |<br>| 104555:44:3:1 | 104555      | X         | RECORD    | `test01`.`t2` | PRIMARY    |         44 |         3 |        1 | supremum pseudo-record |<br>+---------------+-------------+-----------+-----------+---------------+------------+------------+-----------+----------+------------------------+<br><br>å…¶ä¸­ç”³è¯·æ’å…¥æ„å‘é”ä¸é—´éš™é” å†²çªï¼Œsupremumå°±æ˜¯é—´éš™å³è¾¹çš„é‚£ä¸ªè®°å½•","like_count":0},{"had_liked":false,"id":278486,"user_name":"åŠ±ç ”å†°","can_delete":false,"product_type":"c1","uid":1106394,"ip_address":"","ucode":"FCBC8266018FA0","user_header":"https://static001.geekbang.org/account/avatar/00/10/e1/da/d7f591a7.jpg","comment_is_top":false,"comment_ctime":1612969664,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612969664","product_id":100020801,"comment_content":"è€å¸ˆåœ¨å¼€å§‹çš„ç¬¬ä¸€ä¸ªä¾‹å­ä¸­è¯´ï¼šåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œé€šè¿‡æ ‘æœç´¢çš„æ–¹å¼å®šä½è®°å½•çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯â€œç­‰å€¼æŸ¥è¯¢â€çš„æ–¹æ³•ã€‚<br>åœ¨ æ€ä¹ˆçœ‹é”ç­‰å¾…çš„ä¾‹å­ä¸­<br>select * from t where id &gt;10 and Iâ€™d&lt;=15 for update<br>å¦‚æœæŒ‰ç…§ä¾‹å­ä¸€çš„ç»“è®º&gt;10çš„ç‚¹åº”è¯¥ä¼šæ‰¾åˆ°id=10è¿™ä¸€è¡Œï¼Œè¿™æ—¶å€™å¯ä»¥ç”¨åˆ°ä¼˜åŒ–1ï¼Œæ‰€ä»¥ä¼šç»™is=10çš„è¿™ä¸€è¡ŒåŠ é”å•Šï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰åŠ é”èƒ½åˆ é™¤æˆåŠŸå‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":258441,"user_name":"creed","can_delete":false,"product_type":"c1","uid":1911117,"ip_address":"","ucode":"617CA912AE9CD1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/3wia2iaNnpnfRYs5O1OIYWhv7oEXSiaArqc9tIkicKVxBLUCycdBoNvzMfF2GRl89e7oJ2icZNCvdMD5iaibcOVemX5GA/132","comment_is_top":false,"comment_ctime":1604448515,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604448515","product_id":100020801,"comment_content":"è€å¸ˆè¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼Œæ­»é”åˆ†æä¸­ï¼š<br>â€œn_fields 2 è¡¨ç¤ºè¿™ä¸ªè®°å½•æ˜¯ä¸¤åˆ—ï¼Œä¹Ÿå°±æ˜¯å­—æ®µ c å’Œä¸»é”®å­—æ®µ idï¼›0: len 4; hex 0000000a; asc ;; æ˜¯ç¬¬ä¸€ä¸ªå­—æ®µï¼Œä¹Ÿå°±æ˜¯ cã€‚å€¼æ˜¯åå…­è¿›åˆ¶ aï¼Œä¹Ÿå°±æ˜¯ 10ï¼›1: len 4; hex 0000000a; asc ;; æ˜¯ç¬¬äºŒä¸ªå­—æ®µï¼Œä¹Ÿå°±æ˜¯ä¸»é”® idï¼Œå€¼ä¹Ÿæ˜¯ 10ï¼›â€ æ€ä¹ˆçœ‹å‡ºn_fileds 2å°±æ˜¯å­—æ®µcå’Œä¸»é”®id","like_count":0},{"had_liked":false,"id":258285,"user_name":"@%åˆ%@","can_delete":false,"product_type":"c1","uid":1053509,"ip_address":"","ucode":"2B8A6134675ED7","user_header":"https://static001.geekbang.org/account/avatar/00/10/13/45/16c60da2.jpg","comment_is_top":false,"comment_ctime":1604369472,"is_pvip":true,"discussion_count":2,"race_medal":0,"score":"1604369472","product_id":100020801,"comment_content":"ä¸è€å¸ˆï¼Œä½ å¥½ï¼Œå…³äº select * from t where id&gt;9 and id&lt;12 order by id desc for update; æˆ‘ä¸€ç›´æ²¡ç†è§£ä¸ºä»€ä¹ˆ(0,5]è¿™ä¸ªé—´éš™ä¹ŸåŠ ä¸Šé”äº†ï¼Œid&lt;12å‘å·¦éå†ï¼Œé”ä¸Š(0,5]è¿™ä¸ªé—´éš™æ˜¯ä¸ºäº†é˜²æ­¢åœ¨è¿™ä¸ªé—´éš™ä¸­æ’å…¥æ•°æ®ï¼Œå¯¼è‡´å‰åæ•°æ®ä¸ä¸€è‡´ï¼Œè¿™ä¸ªæˆ‘èƒ½ç†è§£ï¼Œä½†æ˜¯ä¸æ˜¯è¿˜æœ‰ id&gt;9è¿™ä¸ªæ¡ä»¶å—ï¼Œè¿™æ ·å…¶å®æ˜¯å¯ä»¥ä¿è¯ä¸è®¿é—®(0,5]è¿™ä¸ªé—´éš™çš„ï¼Œè¿™æ ·ç†è§£å¯¹å—ï¼Ÿå¸Œæœ›è¯¦ç»†è§£ç­”ä¸‹ã€‚","like_count":0,"discussions":[{"author":{"id":1526355,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","nickname":"moonfox","note":"","ucode":"902BFF40EFA9FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348576,"discussion_content":"åŒæ„ï¼Œå…¶å®åªç”¨é”åˆ°(5ï¼Œ10]ï¼Œå°±å¯ä»¥äº†ï¼Œä¹‹æ‰€ä»¥é”åˆ°(0ï¼Œ5]æ„Ÿè§‰æ˜¯çº¯ç²¹ä¸ºäº†ä»£ç é€»è¾‘ç»Ÿä¸€ï¼Œå¯ä»¥é‡å¤è°ƒç”¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612636318,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1857196,"avatar":"","nickname":"æ–‡é‡","note":"","ucode":"6193A3648DD557","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1526355,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","nickname":"moonfox","note":"","ucode":"902BFF40EFA9FA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384058,"discussion_content":"æˆ‘è§‰å¾—ä¸æ˜¯ï¼Œè¦ä¸å°±æ˜¯ä»£ç å†™çš„æœ‰é—®é¢˜ï¼Œè¿™ä¸ªé—´éš™çœŸçš„æ²¡å¿…è¦é”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626346814,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":348576,"ip_address":""},"score":384058,"extra":""}]}]},{"had_liked":false,"id":254685,"user_name":"Geek_1968cf","can_delete":false,"product_type":"c1","uid":2224546,"ip_address":"","ucode":"1839F5CD2CCD63","user_header":"","comment_is_top":false,"comment_ctime":1603168119,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603168119","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼Œç¡®è®¤ä¸ªé—®é¢˜ã€‚update  t set c=1 where b=2; bæ˜¯æ™®é€šç´¢å¼•ï¼Œæœ‰ä¸‰è¡Œæ•°æ®b=2ã€‚ç»™bç´¢å¼•ç­‰äº2åŠ é”ï¼Œè¿™ä¸‰è¡Œç´¢å¼•æ˜¯ä¸€ä¸‹å­åŠ äº†é”ï¼Œè¿˜æ˜¯ä¸€è¡Œä¸€è¡ŒåŠ çš„é”å‘¢ã€‚å¦‚æœæœ‰å…¶ä»–çš„äº‹åŠ¡æ¥ç»™è¿™å‡ è¡Œæ•°æ®åŠ é”ï¼Œä¼šäº§ç”Ÿæ­»é”å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":253330,"user_name":"å‘¨å…´ä½³","can_delete":false,"product_type":"c1","uid":1925466,"ip_address":"","ucode":"E5F941019F1D2E","user_header":"","comment_is_top":false,"comment_ctime":1602685765,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602685765","product_id":100020801,"comment_content":"-- session 1;<br>begin;<br>select c from t WHERE c &gt; 5 LOCK IN SHARE MODE;<br>-- session 2;<br>BEGIN;<br>UPDATE t SET c = 2 WHERE c = 5;<br>-- session 3<br>BEGIN;<br>INSERT INTO `t` (`id`, `c`, `d`) VALUES (1, 1, 1);<br>session 3 ä¸ºä»€ä¹ˆä¼šé”ä½ï¼Ÿ","like_count":0},{"had_liked":false,"id":252852,"user_name":"...","can_delete":false,"product_type":"c1","uid":2173050,"ip_address":"","ucode":"DD6CFE144B4D6D","user_header":"https://static001.geekbang.org/account/avatar/00/21/28/7a/8e71fccf.jpg","comment_is_top":false,"comment_ctime":1602502085,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602502085","product_id":100020801,"comment_content":"<br>select * from t where id&gt;9 and id&lt;12 order by id desc for update;<br>ä¸ºä»€ä¹ˆè¿™å¥è¦åœ¨(0,5] åŠ é”ï¼Ÿæƒ³äº†åŠå¤©éƒ½ä¸æ˜ç™½ èŒƒå›´æŸ¥è¯¢ä¸­c=5ä¸æ˜¯å·²ç»ä¸ç¬¦åˆï¼Œå¯ä»¥ç›´æ¥ä¸è¦ï¼Ÿ","like_count":0},{"had_liked":false,"id":250819,"user_name":"åˆ«é—®","can_delete":false,"product_type":"c1","uid":1500187,"ip_address":"","ucode":"B24480E6E5792B","user_header":"https://static001.geekbang.org/account/avatar/00/16/e4/1b/76d3b44c.jpg","comment_is_top":false,"comment_ctime":1601253636,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601253636","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œå…³äºæ­»é”æ—¥å¿—å«ä¹‰æœ‰ä»€ä¹ˆæ¨èèµ„æ–™é˜…è¯»å˜›ï¼Œæˆ‘æŸ¥åˆ°çš„ä¸€äº›éƒ½æ˜¯å‚å·®ä¸é½ï¼Œå¸®åŠ©ä¸å¤§çš„-.-","like_count":0},{"had_liked":false,"id":248844,"user_name":"ä¸€å—è·‘è·‘","can_delete":false,"product_type":"c1","uid":1177796,"ip_address":"","ucode":"576EC5A37721FD","user_header":"https://static001.geekbang.org/account/avatar/00/11/f8/c4/c7f665df.jpg","comment_is_top":false,"comment_ctime":1600332822,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1600332822","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼Œé’ˆå¯¹ select * from t where id&gt;9 and id&lt;12 order by id desc for update; è¿™ä¸ªçš„åŠ é”è¿˜ä¸å¤ªäº†è§£ï¼Œç»è¿‡æµ‹è¯•ï¼Œåœ¨è¿™æ¡è¯­å¥æ‰§è¡ŒæœŸé—´ï¼Œç…§æ ·å¯ä»¥æ‰§è¡Œinsert into t values(13,13,13)ï¼Œinsert into t values(2,2,2)ï¼Œinsert into t values(7,7,7)ï¼ŒæŒ‰ç…§é—´è¯¾ç¨‹åˆ†ææ¥çœ‹åº”è¯¥éƒ½é˜»å¡æ‰å¯¹å•Š","like_count":0},{"had_liked":false,"id":247674,"user_name":"è€ƒæ‹‰å‡ºå±±","can_delete":false,"product_type":"c1","uid":1303954,"ip_address":"","ucode":"917E35FD7B2D06","user_header":"https://wx.qlogo.cn/mmopen/vi_32/1mOvT5fApeicXppMP3zADG6XIPicNt5D9dL6y46SF5UUcH0hicG21LM6xSgHJj5oAdzCyeGtLZYHYmlvaFwecrGOA/132","comment_is_top":false,"comment_ctime":1599790494,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599790494","product_id":100020801,"comment_content":"21è®²ä¸­æœ‰è¿™ä¹ˆä¸ªä¾‹å­â€œselect * from t where id&gt;=10 and id&lt;11 for update;â€ é¦–æ¬¡ session A å®šä½æŸ¥æ‰¾ id=10 çš„è¡Œçš„æ—¶å€™ï¼Œæ˜¯å½“åšç­‰å€¼æŸ¥è¯¢æ¥åˆ¤æ–­çš„ï¼Œè€Œå‘å³æ‰«æåˆ° id=15 çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯èŒƒå›´æŸ¥è¯¢åˆ¤æ–­ã€‚ï¼Œsession A è¿™æ—¶å€™é”çš„èŒƒå›´å°±æ˜¯ä¸»é”®ç´¢å¼•ä¸Šï¼Œè¡Œé” id=10 å’Œ next-key lock(10,15]  <br><br>æœ¬ç« ä¸­ç¬¬ä¸€ä¸ªä¾‹å­â€œselect * from t where id&gt;9 and id&lt;12 order by id desc for update;â€ä¸ºä»€ä¹ˆè¿™é‡Œæ‰¾åˆ° 15  å°±ä¸æ˜¯èŒƒå›´æŸ¥æ‰¾ è€Œæ˜¯ç­‰å€¼æŸ¥æ‰¾ 15 ä¸åŠ è¡Œé”","like_count":0},{"had_liked":false,"id":237677,"user_name":"lleft","can_delete":false,"product_type":"c1","uid":1970443,"ip_address":"","ucode":"D573EB509455AE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIx1V1QAxC4NHaxYZGyuibBN8lcURJWc5nrnO4yic1kxnDemYV2FJGialf47kYX9qtDnZZOfe1SJeLicg/132","comment_is_top":false,"comment_ctime":1595922431,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595922431","product_id":100020801,"comment_content":"æ–‡ä¸­ç­‰å€¼æŸ¥è¯¢çš„æ­»é”é—®é¢˜ï¼Œæ²¡æœ‰æ¨¡æ‹Ÿå‡ºæ¥ï¼Œåªæœ‰é”ç­‰å¾…ï¼Œå¹¶æ²¡æœ‰æ­»é”ã€‚<br>session1ï¼š<br>begin;<br>select id from t where c in(5,20,10) lock in share mode;<br><br>session2ï¼š<br>select id from t where c in(5,20,10) order by c desc for update;<br>ä¸ä¼šæ­»é”å‘€ï¼Œåªæœ‰é”ç­‰å¾…ã€‚ã€‚ã€‚","like_count":0},{"had_liked":false,"id":234893,"user_name":"é™é™è†å¬","can_delete":false,"product_type":"c1","uid":1263932,"ip_address":"","ucode":"0A8600CB928EFE","user_header":"https://static001.geekbang.org/account/avatar/00/13/49/3c/5d54c510.jpg","comment_is_top":false,"comment_ctime":1594821074,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594821074","product_id":100020801,"comment_content":"è€å¸ˆå¯å¦‚æœä¸¤æ¡sqlè¯­å¥ï¼Œupdate t set d=1 where c in (5,10,15)å’Œupdate t set d=1 where c in (15,10,5)ï¼Œè¿™ä¸¤æ¡è¯­å¥mysqlä¼šåšä¼˜åŒ–ä¹ˆï¼Œè¿˜æ˜¯åŠ é”é¡ºåºå°±æ˜¯inè¯­å¥é‡Œé¢çš„å€¼çš„é¡ºåºã€‚","like_count":0},{"had_liked":false,"id":234882,"user_name":"ååœ°é“çš„ç¨‹åºå‘˜","can_delete":false,"product_type":"c1","uid":1621470,"ip_address":"","ucode":"A04A239D173E2A","user_header":"https://static001.geekbang.org/account/avatar/00/18/bd/de/e0c994b3.jpg","comment_is_top":false,"comment_ctime":1594817393,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594817393","product_id":100020801,"comment_content":"è€å¸ˆæˆ‘çš„æ•°æ®åº“æ˜¯8.0.17ï¼Œè¡¨ç»“æ„æ˜¯CREATE TABLE hero (<br>    number INT,<br>    name VARCHAR(100),<br>    country varchar(100),<br>    PRIMARY KEY (number),<br>    UNIQUE idx_name (name)<br>) Engine=InnoDB CHARSET=utf8;<br>æ’å…¥æ•°æ®INSERT INTO hero VALUES<br>    (1, &#39;låˆ˜å¤‡&#39;, &#39;èœ€&#39;),<br>    (3, &#39;zè¯¸è‘›äº®&#39;, &#39;èœ€&#39;),<br>    (8, &#39;cæ›¹æ“&#39;, &#39;é­&#39;),<br>    (15, &#39;xè€å½§&#39;, &#39;é­&#39;),<br>    (20, &#39;så­™æƒ&#39;, &#39;å´&#39;); <br>äº‹åŠ¡1ï¼šæ‰§è¡ŒSELECT * FROM hero FORCE INDEX(uk_name) WHERE name &gt;= &#39;cæ›¹æ“&#39; LOCK IN SHARE MODE;æœªæäº¤<br>äº‹åŠ¡2ï¼šæ‰§è¡Œinsert into hero values(7,&#39;bä¿åˆ©&#39;,&#39;æœªçŸ¥&#39;);ä¼šé˜»å¡<br>æŒ‰ç…§ä¼˜åŒ–1ï¼Œcæ›¹æ“çš„å”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢åº”è¯¥æ˜¯åŠ æ™®é€šè¡Œé”ï¼Œä½†æ˜¯æ‰§è¡Œshow engine innodb statusï¼Œå´çœ‹åˆ°lock_mode X locks gap before rec insert intention waitingï¼Œè€å¸ˆè§£ç­”ä¸€ä¸‹","like_count":0},{"had_liked":false,"id":234881,"user_name":"ååœ°é“çš„ç¨‹åºå‘˜","can_delete":false,"product_type":"c1","uid":1621470,"ip_address":"","ucode":"A04A239D173E2A","user_header":"https://static001.geekbang.org/account/avatar/00/18/bd/de/e0c994b3.jpg","comment_is_top":false,"comment_ctime":1594817389,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594817389","product_id":100020801,"comment_content":"è€å¸ˆæˆ‘çš„æ•°æ®åº“æ˜¯8.0.17ï¼Œè¡¨ç»“æ„æ˜¯CREATE TABLE hero (<br>    number INT,<br>    name VARCHAR(100),<br>    country varchar(100),<br>    PRIMARY KEY (number),<br>    UNIQUE idx_name (name)<br>) Engine=InnoDB CHARSET=utf8;<br>æ’å…¥æ•°æ®INSERT INTO hero VALUES<br>    (1, &#39;låˆ˜å¤‡&#39;, &#39;èœ€&#39;),<br>    (3, &#39;zè¯¸è‘›äº®&#39;, &#39;èœ€&#39;),<br>    (8, &#39;cæ›¹æ“&#39;, &#39;é­&#39;),<br>    (15, &#39;xè€å½§&#39;, &#39;é­&#39;),<br>    (20, &#39;så­™æƒ&#39;, &#39;å´&#39;); <br>äº‹åŠ¡1ï¼šæ‰§è¡ŒSELECT * FROM hero FORCE INDEX(uk_name) WHERE name &gt;= &#39;cæ›¹æ“&#39; LOCK IN SHARE MODE;æœªæäº¤<br>äº‹åŠ¡2ï¼šæ‰§è¡Œinsert into hero values(7,&#39;bä¿åˆ©&#39;,&#39;æœªçŸ¥&#39;);ä¼šé˜»å¡<br>æŒ‰ç…§ä¼˜åŒ–1ï¼Œcæ›¹æ“çš„å”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢åº”è¯¥æ˜¯åŠ æ™®é€šè¡Œé”ï¼Œä½†æ˜¯æ‰§è¡Œshow engine innodb statusï¼Œå´çœ‹åˆ°lock_mode X locks gap before rec insert intention waitingï¼Œè€å¸ˆè§£ç­”ä¸€ä¸‹","like_count":0},{"had_liked":false,"id":231675,"user_name":"å°æ²™","can_delete":false,"product_type":"c1","uid":1170866,"ip_address":"","ucode":"9AD2FE435168B4","user_header":"","comment_is_top":false,"comment_ctime":1593746271,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593746271","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå¦‚ä½•æ˜¾ç¤ºSQLè¯­å¥æ‰€åŠ é—´éš™é”ï¼Ÿ<br>å¦‚ï¼Œä½¿ç”¨show engine innodb statusä¹‹ç±»çš„ï¼Œå¦‚ä½•æŸ¥çœ‹é—´éš™é”çš„èŒƒå›´ã€‚å¦‚æœMYSQLèƒ½æ˜¾ç¤ºå‡ºæ¥æ‰€åŠ çš„é—´éš™é”ï¼Œä¸€æ–¹é¢æœ‰åˆ©äºè‡ªå·±çš„å­¦ä¹ å’ŒéªŒè¯ï¼Œä¸€æ–¹é¢çº¿ä¸Šé‡åˆ°é—®é¢˜ä¹Ÿèƒ½ç¡®åˆ‡çš„çŸ¥é“åŸå› ã€‚","like_count":0},{"had_liked":false,"id":224183,"user_name":"å¿ƒå£°","can_delete":false,"product_type":"c1","uid":1448630,"ip_address":"","ucode":"ABFFC9137B0FC8","user_header":"https://static001.geekbang.org/account/avatar/00/16/1a/b6/4777f789.jpg","comment_is_top":false,"comment_ctime":1591314643,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1591314643","product_id":100020801,"comment_content":"å¼€å¯ä¸¤ä¸ªäº‹åŠ¡ï¼Œäº‹åŠ¡aæ’å…¥æ•°æ®ä»0-10ï¼Œäº‹åŠ¡bæ’å…¥æ•°æ®ä»5-15ï¼Œè¯·é—®ä¼šå‘ç”Ÿæ­»é”å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1324550,"avatar":"https://static001.geekbang.org/account/avatar/00/14/36/06/08c46bcd.jpg","nickname":"è‚åˆ©","note":"","ucode":"808E064089724D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587400,"discussion_content":"æ’å…¥æ„å‘é”ä¹‹é—´æ˜¯ä¸ä¼šå†²çªçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663034726,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":223778,"user_name":"é²ç­å¤§å¸ˆ","can_delete":false,"product_type":"c1","uid":1179156,"ip_address":"","ucode":"4F9615DF87B031","user_header":"https://static001.geekbang.org/account/avatar/00/11/fe/14/f1532dec.jpg","comment_is_top":false,"comment_ctime":1591178192,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1591178192","product_id":100020801,"comment_content":"update user_item set status=1 where user_id=? and item_id=?<br>è€å¸ˆï¼Œè¿™ä¸ªè¯­å¥ä¼šæ­»é”å—ï¼Œå‡è®¾user_idå’Œitem_idéƒ½åŠ äº†ç´¢å¼•ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å…ˆåœ¨ä¸»é”®ç´¢å¼•åŠ é”è¿˜æ˜¯åœ¨éä¸»é”®ç´¢å¼•åŠ é”å‘¢","like_count":0,"discussions":[{"author":{"id":1324550,"avatar":"https://static001.geekbang.org/account/avatar/00/14/36/06/08c46bcd.jpg","nickname":"è‚åˆ©","note":"","ucode":"808E064089724D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587401,"discussion_content":"åº”è¯¥æ˜¯æŸ¥è¯¢é˜¶æ®µåªä¼šé€‰æ‹©ä¸€ä¸ªç´¢å¼•ï¼Œç„¶ååŠ é”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663034847,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":221991,"user_name":"Geek_a8be59","can_delete":false,"product_type":"c1","uid":1563985,"ip_address":"","ucode":"BEC0F57B51DC44","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKdiaUiaCYQe9tibemaNU5ya7RrU3MYcSGEIG7zF27u0ZDnZs5lYxPb7KPrAsj3bibM79QIOnPXAatfIw/132","comment_is_top":false,"comment_ctime":1590651323,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590651323","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œè¯·é—®ä¸€ä¸‹è¿™ä¸ªè¦æ€ä¹ˆè§£é‡Šï¼Ÿ<br>SELECT * from t where id &gt;10 and id &lt;15 for update;<br><br>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆè¿™ä¸ªå®é™…é”ä½äº†15è¿™è¡Œï¼Ÿ<br>æŒ‰ç…§æˆ‘çš„ç†è§£ï¼šç­‰å€¼æŸ¥è¯¢â€œid&gt;10â€,æ‰«æåˆ°15è¿™è¡Œï¼Œæ‰€ä»¥æ ¹æ®ä¼˜åŒ–äºŒï¼Œè¿™ä¸ªåŠ çš„æ˜¯åº”è¯¥æ˜¯(10,15)ä¸æ˜¯ä¹ˆã€‚<br>ç¬¬äºŒä¸ªé—®é¢˜ï¼šä¼˜åŒ–äºŒé‡Œé¢æ‰€è¯´çš„â€œä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶â€é‡Œçš„è¿™ä¸ªç­‰å€¼æ¡ä»¶å…·ä½“æŒ‡ä»€ä¹ˆçš„ï¼Œæ¯”å¦‚ä¸Šé¢è¯´æ˜¯æŒ‡id&gt;10è¿˜æ˜¯id&gt;10 and id&lt;15","like_count":0},{"had_liked":false,"id":219705,"user_name":"é›ªã®é›«Â·é›¨ã®éŸ³","can_delete":false,"product_type":"c1","uid":1997293,"ip_address":"","ucode":"0693DA3939A321","user_header":"https://static001.geekbang.org/account/avatar/00/1e/79/ed/4737a49b.jpg","comment_is_top":false,"comment_ctime":1590067604,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590067604","product_id":100020801,"comment_content":"å›ç­”é—®é¢˜ï¼š<br>æœ‰ï¼Œè¿™ä¸ªé—´éš™æ˜¯ç”±supremumå®šä¹‰çš„ã€‚<br>éªŒè¯ï¼š<br>1ã€åˆ›å»ºä¸€ä¸ªç©ºè¡¨t<br>CREATE TABLE `t` ( `id` int(11) NOT NULL, `c` int(11) DEFAULT NULL, `d` int(11) DEFAULT NULL, PRIMARY KEY (`id`), KEY `c` (`c`)) ENGINE=InnoDB;<br>2ã€sessionAæ‰§è¡Œ<br>begin;<br>select * from t for update;<br>3ã€sessionBæ‰§è¡Œ<br>insert into t values(1,1,1);<br><br>å‘ç°sessionBçš„æ’å…¥æ“ä½œè¢«é˜»å¡ã€‚<br>æ­¤æ—¶æ‰§è¡Œshow engine innodb statusï¼Œå‘ç°å…¶ç»“æœä¸­å…³äºé”çš„ä¿¡æ¯ä¸ºï¼š<br>RECORD LOCKS space id 2309 page no 4 n bits 72 index PRIMARY of table `mldn`.`t` trx id 368234 lock_mode X insert intention waiting<br>Record lock, heap no 1 PHYSICAL RECORD: n_fields 1; compact format; info bits 0<br> 0: len 8; hex 73757072656d756d; asc supremum;;<br>éªŒè¯äº†next-key lockæ˜¯åˆ°supremumä¸ºæ­¢çš„ã€‚<br><br>","like_count":0},{"had_liked":false,"id":214698,"user_name":"ä¸Šå–„è‹¥æ°´","can_delete":false,"product_type":"c1","uid":1116397,"ip_address":"","ucode":"F4EC3FA1F27594","user_header":"https://static001.geekbang.org/account/avatar/00/11/08/ed/fe5242fe.jpg","comment_is_top":false,"comment_ctime":1588784304,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588784304","product_id":100020801,"comment_content":"è€å¸ˆï¼Œé—®ä¸ªé—®é¢˜ã€‚<br>ä¸ºä»€ä¹ˆ Select * from t where id&gt;10 and id&lt;15 for update; è¿™ä¸ªè¯­å¥çš„åŒºé—´æ˜¯ä»(5,10)å¼€å§‹çš„ï¼Œ<br>è€ŒSelect c from t where c&gt;5 lock in share mode; è¿™ä¸ªè¯­å¥çš„åŒºé—´æ˜¯ä»(5,10]å¼€å§‹çš„","like_count":0},{"had_liked":false,"id":213795,"user_name":"Wangxi","can_delete":false,"product_type":"c1","uid":1211790,"ip_address":"","ucode":"C25A9A14179930","user_header":"https://static001.geekbang.org/account/avatar/00/12/7d/8e/bb16d414.jpg","comment_is_top":false,"comment_ctime":1588563266,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1588563266","product_id":100020801,"comment_content":"å®éªŒç¯å¢ƒ mysql 8.0.18 éš”ç¦»çº§åˆ« å¯é‡å¤è¯»<br><br>select * from t where id &gt; 10 and id &lt;= 15  for update;<br>è¿™ä¸€å¥ä¼šé”ä½çš„èŒƒå›´æ˜¯ (10, 15] å¹¶ä¸ä¼šé”ä½(5,10)<br>å½“æ‰§è¡Œ delete from t where id= 10; å ç”±äº(10, 15] å·¦è¾¹ç•Œè¢«åˆ äº†ï¼Œè¿™ä¸ªé”èŒƒå›´ä¼šå‘å·¦æ‰©æ•£åˆ°5è¿™é‡Œï¼Œå˜æˆäº†(5, 15]<br><br>","like_count":0},{"had_liked":false,"id":212828,"user_name":"â€¦","can_delete":false,"product_type":"c1","uid":1297845,"ip_address":"","ucode":"207C7F95192129","user_header":"https://static001.geekbang.org/account/avatar/00/13/cd/b5/2e60f2b0.jpg","comment_is_top":false,"comment_ctime":1588217258,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1588217258","product_id":100020801,"comment_content":"session a <br>begin;<br>select * from t where id &gt; 10 and id &lt;= 15 for update;<br><br>session2 insert int t values(11,11,11);<br><br>è¿™ä¸ªä¸ºä»€ä¹ˆä¼šé˜»å¡å‘¢ï¼Ÿ<br>æŒ‰æˆ‘çš„ç†è§£ é¦–å…ˆæ˜¯æŸ¥è¯¢&gt;10çš„ç¬¬ä¸€ä¸ªæ•°å­—ä¹Ÿå°±æ˜¯15ï¼Œè¿™ä¸ªæ—¶å€™åŠ çš„æ˜¯(10, 15]çš„é”ã€‚<br>å› ä¸ºæ˜¯ç­‰å€¼æŸ¥è¯¢ï¼Œåˆå› ä¸ºæ˜¯å”¯ä¸€ç´¢å¼•ï¼Œæ‰€ä»¥ä¼šé€€åŒ–ä¸º15çš„è¡Œé”ï¼Œä¸æ˜¯è¿™æ ·å—ï¼Ÿ ","like_count":0,"discussions":[{"author":{"id":1563985,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKdiaUiaCYQe9tibemaNU5ya7RrU3MYcSGEIG7zF27u0ZDnZs5lYxPb7KPrAsj3bibM79QIOnPXAatfIw/132","nickname":"Geek_a8be59","note":"","ucode":"BEC0F57B51DC44","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":275459,"discussion_content":"æˆ‘ä¹Ÿæ˜¯è¿™é‡Œæƒ³ä¸é€š ä¸çŸ¥é“è¿™ä¸ªç­‰å€¼åˆ°åº•æŒ‡çš„ä»€ä¹ˆæ„æ€ã€‚SELECT * from t where id>10 and id<=15 ORDER BY id desc  for update; å‘ç°è¿™ä¸ªæœ‰ï¼ˆ15ï¼Œ20ï¼‰çš„é—´éš™ï¼Œä½†æ˜¯é€šè¿‡æè¿°é¦–å…ˆå®šä½åˆ°äº†15ï¼Œåº”è¯¥å°±æ˜¯ï¼ˆ10,15ã€‘ï¼Œæ ¹æ®ä¼˜åŒ–ä¸€ï¼Œåº”è¯¥å°±æ˜¯15è¿™ä¸ªè®°å½•é”ï¼Œç„¶åå‘å·¦éå†ï¼Œï¼ˆ5,10ã€‘å’Œ15è¿™ä¸ªè¡Œé”ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆä¼šæœ‰ï¼ˆ15,20ï¼‰å’Œï¼ˆ5,10ï¼‰è¿™ä¸ªé—´éš™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590717159,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":211325,"user_name":"é²ç­å¤§å¸ˆ","can_delete":false,"product_type":"c1","uid":1179156,"ip_address":"","ucode":"4F9615DF87B031","user_header":"https://static001.geekbang.org/account/avatar/00/11/fe/14/f1532dec.jpg","comment_is_top":false,"comment_ctime":1587948960,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587948960","product_id":100020801,"comment_content":"<br>begin;<br>select * from t where id&gt;9 and id&lt;12 order by id desc for update;<br>è€å¸ˆï¼Œå¦‚æœæŠŠid&gt;9 and id&lt;12æ¢æˆï¼Œid&gt;1000000 and id&lt;1000002,æ˜¯ä¸æ˜¯å°±ä¼šåŠ å¥½å¤šå¥½å¤šçš„é—´éš™é”å’Œè¡Œé”ï¼Œè¿™ä¸ªæ—¶å€™å‡ ä¹ç­‰ä»·äºé”è¡¨äº†å§ï¼Ÿæ€§èƒ½ä¹Ÿå¤ªå·®äº†ï¼Œé‚£åˆ°åº•ä»€ä¹ˆåœºæ™¯æ‰é€‚åˆä½¿ç”¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ï¼Ÿ","like_count":0},{"had_liked":false,"id":206670,"user_name":"å¼ é’Ÿå¼º","can_delete":false,"product_type":"c1","uid":1586908,"ip_address":"","ucode":"EE0D5CAEDBBAC8","user_header":"https://static001.geekbang.org/account/avatar/00/18/36/dc/97369381.jpg","comment_is_top":false,"comment_ctime":1586915376,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586915376","product_id":100020801,"comment_content":"æœ€åè®²è§£çš„ä¸¤ä¸ªé”ç­‰å¾…çš„ä¾‹å­ï¼Œæˆ‘æ€ä¹ˆéƒ½å¤ç°ä¸äº†å•Šï¼Ÿmysqlç‰ˆæœ¬ 8.0.12ï¼Œéš”ç¦»çº§åˆ« REPEATABLE-READ","like_count":0},{"had_liked":false,"id":186037,"user_name":"å¤©å¤©å‘ä¸Š","can_delete":false,"product_type":"c1","uid":1242455,"ip_address":"","ucode":"0CCCA6F4DCC480","user_header":"https://static001.geekbang.org/account/avatar/00/12/f5/57/ce10fb1b.jpg","comment_is_top":false,"comment_ctime":1583745118,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583745118","product_id":100020801,"comment_content":"æ‰€è°“â€œé—´éš™â€ï¼Œå…¶å®æ ¹æœ¬å°±æ˜¯ç”±â€œè¿™ä¸ªé—´éš™å³è¾¹çš„é‚£ä¸ªè®°å½•â€å®šä¹‰çš„ï¼Œè¿™å¥è¯ï¼Œè¿˜æ˜¯ä¸æ˜ç™½æ˜¯ä»€ä¹ˆæ„æ€ã€‚","like_count":0},{"had_liked":false,"id":182172,"user_name":"å°éœ¸ç‹å­¦ä¹ æœº","can_delete":false,"product_type":"c1","uid":1475972,"ip_address":"","ucode":"522112D5F72FF9","user_header":"","comment_is_top":false,"comment_ctime":1582725752,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582725752","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œè¯·é—®ï¼š select id from t where c &gt;5 lock in share mode ; è¿™ç§è¯»é”ï¼Œåœ¨show engine innodb statusé‡Œé¢çœ‹ä¸å‡ºæ¥ï¼Œéœ€è¦è®¾ç½®ä»€ä¹ˆå‚æ•°å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":178410,"user_name":"é’é’è’¹è‘­","can_delete":false,"product_type":"c1","uid":1798505,"ip_address":"","ucode":"B0BB2B59A2CCA8","user_header":"https://static001.geekbang.org/account/avatar/00/1b/71/69/8c75dc75.jpg","comment_is_top":false,"comment_ctime":1581681718,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581681718","product_id":100020801,"comment_content":"ç©ºè¡¨åº”è¯¥æœ‰é”ã€‚æŒ‰ç…§é—´éš™é”çš„è§„åˆ™åº”è¯¥æ˜¯ (-supernumï¼Œsupernum]<br>ç„¶åç”¨show engine innodb statusçœ‹åˆ°äº†<br>Record lock, heap no 1 PHYSICAL RECORD: n_fields 1; compact format; info bits 0<br> 0: len 8; hex 73757072656d756d; asc supremum;;<br>çœ‹äº†è€å¸ˆè¿™ä¹ˆä¹…çš„ä¸“æ ã€‚å°±å››ä¸ªå­—ï¼Œå—ç›ŠåŒªæµ…","like_count":0},{"had_liked":false,"id":176270,"user_name":"forever","can_delete":false,"product_type":"c1","uid":1574051,"ip_address":"","ucode":"3EBCD4AB045880","user_header":"https://static001.geekbang.org/account/avatar/00/18/04/a3/95de9a19.jpg","comment_is_top":false,"comment_ctime":1581003772,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581003772","product_id":100020801,"comment_content":"è¿™ä¹ˆå¤šè§„åˆ™å¾—æ¢³ç†ä¸‹","like_count":0},{"had_liked":false,"id":175196,"user_name":"åèç§‘æŠ€","can_delete":false,"product_type":"c1","uid":1808280,"ip_address":"","ucode":"B6BA3C47C05073","user_header":"","comment_is_top":false,"comment_ctime":1580612307,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1580612307","product_id":100020801,"comment_content":"Session A<br>begin;<br>select c from t where c&gt;5 lock in share mode; <br>åŠ é”èŒƒå›´æ˜¯ç´¢å¼• c ä¸Šçš„ (5,10]ã€(10,15]ã€(15,20]ã€(20,25]å’Œ (25,supremum]ã€‚<br><br>Session B<br>update t set c=1 where c=5; <br>è¯·é—®ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆsession Bçš„update è¯­å¥é”çš„èŒƒå›´ä¸æ˜¯ ï¼ˆ1ï¼Œ5], (5,10) è€Œåªæœ‰ï¼ˆ1ï¼Œ5ã€‘ï¼Ÿ","like_count":0},{"had_liked":false,"id":175180,"user_name":"åèç§‘æŠ€","can_delete":false,"product_type":"c1","uid":1808280,"ip_address":"","ucode":"B6BA3C47C05073","user_header":"","comment_is_top":false,"comment_ctime":1580605275,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1580605275","product_id":100020801,"comment_content":"begin;<br>select * from t where id&gt;9 and id&lt;12 order by id desc for update;<br>åŸæ–‡ï¼šåŠ é”èŒƒå›´æ˜¯ä¸»é”®ç´¢å¼•ä¸Šçš„ (0,5]ã€(5,10]å’Œ (10, 15)ã€‚<br>é—®é¢˜ï¼šæ·é”èŒƒå›´åº”è¯¥åªæœ‰ (5,10]å’Œ (10, 15)ï¼Œ å› ä¸º id &gt;9 çš„æ¡ä»¶åœ¨å‘å·¦éå†æ—¶ä¼šä½¿å¾— åˆ° ï¼ˆ5ï¼Œ10ã€‘è¿™ä¸ªåŒºé—´å°±ç»“æŸäº†å‘€ï¼Ÿ","like_count":0},{"had_liked":false,"id":171682,"user_name":"88591","can_delete":false,"product_type":"c1","uid":1254656,"ip_address":"","ucode":"04CE3E46455185","user_header":"https://static001.geekbang.org/account/avatar/00/13/25/00/3afbab43.jpg","comment_is_top":false,"comment_ctime":1578991278,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578991278","product_id":100020801,"comment_content":"è€å¸ˆ<br>select * from t where id&gt;9 and id&lt;12 order by id desc for update;  <br>order by è¿™ä¸ªæŸ¥æ‰¾ è¿‡ç¨‹è¿˜æ˜¯ä¸æ¸…æ¥šã€‚å®‰è£…æŸ¥è¯¢è¿‡ç¨‹åº”è¯¥æ˜¯å…ˆè¿‡æ»¤æ•°æ®åœ¨æ’åºã€‚æ„Ÿè§‰è¿™ä¸ªåŠ é”çš„æµç¨‹æ˜¯å…ˆæ’åºåè¿‡æ»¤","like_count":0},{"had_liked":false,"id":165594,"user_name":"Dev-L","can_delete":false,"product_type":"c1","uid":1145068,"ip_address":"","ucode":"485E940C3F17B9","user_header":"https://static001.geekbang.org/account/avatar/00/11/78/ec/f7f0d21a.jpg","comment_is_top":false,"comment_ctime":1577265986,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577265986","product_id":100020801,"comment_content":"ç­‰å€¼æŸ¥è¯¢ï¼ŒèŒƒå›´æŸ¥è¯¢ï¼Œä»¥åŠå‘å³&#47;å‘å·¦éå†çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿå®Œå…¨è¢«è‡ªå·±å¼„æ™•äº†ï¼Œå“ªä½å¤§ç¥èƒ½è§£ç­”ä¸€ä¸‹ï¼Ÿ<br>å¦‚æœæŸ¥çš„æ˜¯where c&lt;10 order by c descï¼Œå’Œwhere c&lt;=10 order by c descçš„é”åˆ†å¸ƒæœ‰ä»€ä¹ˆä¸åŒ","like_count":0},{"had_liked":false,"id":143163,"user_name":"é«˜ä¸–å®¶","can_delete":false,"product_type":"c1","uid":1581769,"ip_address":"","ucode":"B87372C333CCA2","user_header":"https://static001.geekbang.org/account/avatar/00/18/22/c9/74a7925d.jpg","comment_is_top":false,"comment_ctime":1571641440,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571641440","product_id":100020801,"comment_content":"select * from t where id&gt;9 and id&lt;12 order by id desc for update;<br>é”çš„èŒƒå›´æ˜¯ [10,15)<br>select * from t where id&gt;9 and id&lt;12 for update;<br>é”çš„èŒƒå›´æ˜¯[10,15]<br>ä¸´ç•Œé”å·¦å¼€å³é—­  ä¹Ÿæ˜¯æŒ‰ç…§æ’åºåçš„å·¦å¼€å³é—­å¯¹å§","like_count":0},{"had_liked":false,"id":136932,"user_name":"å˜‰å…´","can_delete":false,"product_type":"c1","uid":1554570,"ip_address":"","ucode":"6997E7A3E25EE4","user_header":"https://static001.geekbang.org/account/avatar/00/17/b8/8a/7367a69e.jpg","comment_is_top":false,"comment_ctime":1569555963,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1569555963","product_id":100020801,"comment_content":"-- T1 äº‹åŠ¡A<br>begin;<br>select * from c20 where id&gt;=15 and id&lt;=20 order by id desc lock in share mode;<br><br>-- T2 äº‹åŠ¡B<br>begin;<br>update c20 set d=d+1 where id=25;\t-- OK<br>insert into c20 values(21,21,21);\t-- é˜»å¡<br><br>ä¸èƒ½ç†è§£, ä¸ºä»€ä¹ˆäº‹åŠ¡Aæ‰§è¡Œçš„è¯­å¥ä¼šç»™ é—´éš™(20,25) åŠ ä¸Šé”.<br>é€šè¿‡ show engine innodb status; æŸ¥çœ‹å‘ç°äº‹åŠ¡Aç¡®å®æŒæœ‰ä¸Šè¿°é—´éš™é”.<br>é€šè¿‡ explain select * from c20 where id&gt;=15 and id&lt;=20 order by id desc lock in share mode; æŸ¥çœ‹ Extra ä¹Ÿæ²¡æœ‰ filesort, key=PRIMARY, å› æ­¤ä¸ªäººè®¤ä¸ºæ˜¯æŒ‰ç…§ä¸»é”®ç´¢å¼•å‘å·¦éå†å¾—åˆ°ç»“æœ.<br><br>æŒ‰ç…§æˆ‘çš„ç†è§£, ç”±äº `order by id desc` , å› æ­¤é¦–å…ˆæ˜¯åœ¨ä¸»é”®ç´¢å¼•ä¸Šæœç´¢ id=20, åŒæ—¶ç”±äºä¸»é”®ç´¢å¼•ä¸Šè¿™ä¸ªå€¼æ˜¯å”¯ä¸€çš„, å› æ­¤ä¸å¿…å‘å³éå†. ç„¶è€Œäº‹å®ä¸Šå®ƒç¡®å®è¿™ä¹ˆåšäº†, è¿™è®©æˆ‘æƒ³åˆ°äº† BUG1: ä¸»é”®ç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢ä¼šéå†åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ª.<br>ä½†æ˜¯è¿™ä¸€æ­¥çš„æœç´¢è¿‡ç¨‹åº”è¯¥æ˜¯ç­‰å€¼æŸ¥è¯¢æ‰å¯¹, å®Œå…¨ä¸€è„¸æ‡µä½äº†...<br>ä¸çŸ¥é“è€å¸ˆç°åœ¨è¿˜èƒ½çœ‹åˆ°è¿™æ¡è¯„è®ºä¸?","like_count":0,"discussions":[{"author":{"id":1324550,"avatar":"https://static001.geekbang.org/account/avatar/00/14/36/06/08c46bcd.jpg","nickname":"è‚åˆ©","note":"","ucode":"808E064089724D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587404,"discussion_content":"select * from c20 where id&gt;=15 and id&lt;=20 order by id desc lock in share mode;\né”ä¸º(5,10],(10,15],(15,20],(20,25)  \n\nupdate c20 set d=d+1 where id=25;\nupdate çš„é—´éš™é”(20,25),(25,+..),  \né—´éš™é”(20,25)  å’Œ(20,25),(25,+..),  é”ä¹‹é—´å…¼å®¹çš„ï¼Œä¸é”\n\næ’å…¥æ„å‘é”å’Œé—´éš™é”æ˜¯å†²çªï¼Œä¸å…¼å®¹çš„ã€‚æ‰€ä»¥ä¼šé”ä½çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663035701,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130032,"user_name":"feihui","can_delete":false,"product_type":"c1","uid":1007294,"ip_address":"","ucode":"13F1D4A82BC650","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5e/be/9ea55f46.jpg","comment_is_top":false,"comment_ctime":1567354986,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1567354986","product_id":100020801,"comment_content":"è€å¸ˆï¼Œä½ å¥½ï¼Œè¯·é—®ç¬¬ä¸€ä¸ªä¾‹å­ä¸­ select * from t where id&gt;9 and id&lt;12 order by id desc for update; ä¸ºä»€ä¹ˆä¼šæŠŠ ï¼ˆ0, 5] çš„é—´éš™é”ä¹ŸåŠ ä¸Šçš„ï¼Ÿç™¾æ€ä¸å¾—å…¶è§£","like_count":0},{"had_liked":false,"id":129859,"user_name":"MrVito","can_delete":false,"product_type":"c1","uid":1252169,"ip_address":"","ucode":"716FF6F8871706","user_header":"https://static001.geekbang.org/account/avatar/00/13/1b/49/ddefc656.jpg","comment_is_top":false,"comment_ctime":1567306975,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567306975","product_id":100020801,"comment_content":"explainå¾ˆé‡è¦ï¼ŒåŠ é”è¦æ˜æ™°ï¼","like_count":0},{"had_liked":false,"id":120504,"user_name":"é’±","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1564916508,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564916508","product_id":100020801,"comment_content":"æ„Ÿè°¢<br>åˆæ˜¯å¯¹åŠ é”è§„åˆ™çš„æ¢³ç†ï¼ŒåŠ é”çš„èŒƒå›´æˆ‘è¿˜æ˜¯ä¸èƒ½å®Œå…¨æ‹¿æå¥½ï¼Œä¸è¿‡æ¯”ä¹‹å‰çš„è‡ªå·±å¼ºä¸€ä¸¢ä¸¢ã€‚<br>å°ç»“ä¸€ä¸‹<br>1ï¼šåŠ é”æœ¬è´¨ä¸Šå°±æ˜¯è§£å†³å› é«˜å¹¶å‘å¼•èµ·çš„é—®é¢˜ï¼Œå…¸å‹çš„å°±æ˜¯æ•°æ®ä¸ä¸€è‡´<br>2ï¼šé”æ˜¯åœ¨ç´¢å¼•æ ‘ä¸Šçš„ï¼Œé”æ˜¯é€ä¸ªåŠ ä¸Šçš„<br>3ï¼šè¡Œé”å®¹æ˜“ç†è§£ï¼Œå°±æ˜¯é”å®šä¸€ä¸ªè®°å½•è¡Œ<br>4ï¼šé—´éš™é”æ˜¯ä¸ºäº†è§£å†³å¹»è¯»è€Œç”Ÿçš„ï¼Œé”å®šçš„æ˜¯ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„èŒƒå›´ï¼Œé˜²æ­¢æ‰§è¡Œæ’å…¥æ“ä½œï¼Œå¯¼è‡´å¹»è¯»çš„äº§ç”Ÿ<br>5ï¼šåŠ é”çš„è§„åˆ™è§è€å¸ˆçš„æ€»ç»“ï¼Œä¸¤ä¸ªåŸåˆ™ä¸¤ä¸ªä¼˜åŒ–ä¸€ä¸ªbugï¼Œæˆ‘è§‰å¾—åˆ¤æ–­çš„æ—¶å€™ï¼Œå¦‚æœæ‹¿ä¸å®šä¹Ÿå¯é€†å‘æ€ç»´ï¼Œçœ‹çœ‹é”å®šé‚£äº›èŒƒå›´åå°±ä¸ä¼šå‡ºç°å¹»è¯»ç°è±¡å•¦ğŸ˜„<br>6ï¼šç´¢å¼•æœç´¢çš„æ—¶å€™ï¼Œæ˜¯å…ˆå®šä½ä¸€ä¸ªå€¼ï¼Œç„¶åå‘å·¦æˆ–å³éå†ï¼Œè¿™ä¸ªå¯¹äºç†è§£é€ä¸ªåŠ é”æœ‰å¸®åŠ©","like_count":0},{"had_liked":false,"id":102077,"user_name":"å¿†å­£","can_delete":false,"product_type":"c1","uid":1141957,"ip_address":"","ucode":"F62FB7F3D2F0CE","user_header":"","comment_is_top":false,"comment_ctime":1560129871,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560129871","product_id":100020801,"comment_content":"çœ‹çš„å¾ˆè’™ ä¸ºä»€ä¹ˆç¬¬ä¸€ä¸ªä¾‹å­ éœ€è¦å‘å·¦éå†åˆ°05","like_count":0},{"had_liked":false,"id":97769,"user_name":"ä¹”çº³æ£®","can_delete":false,"product_type":"c1","uid":1045107,"ip_address":"","ucode":"51EC9FAE071388","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f2/73/1c7bceae.jpg","comment_is_top":false,"comment_ctime":1558769503,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1558769503","product_id":100020801,"comment_content":"è€å¸ˆï¼ŒRR å’Œ RC éƒ½æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„éš”ç¦»çº§åˆ«ï¼Œè¿™ä¸¤ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹çš„åŠ é”è§„åˆ™æ¯”è¾ƒå¤§ï¼›<br>","like_count":0},{"had_liked":false,"id":78826,"user_name":"å°å¡å‘å‰å†²","can_delete":false,"product_type":"c1","uid":1124914,"ip_address":"","ucode":"1C8908A61FA00B","user_header":"https://static001.geekbang.org/account/avatar/00/11/2a/32/6354a589.jpg","comment_is_top":false,"comment_ctime":1553249232,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553249232","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæˆ‘çš„é—®é¢˜è·Ÿ@é•¿æ°çš„ç¬¬äºŒé—®ç±»ä¼¼ã€‚å¯¹äºsqlï¼š select * from t where id&gt;10 and id&lt;=15 for updateåŠ ä¸Šorder by id descã€‚ å®ƒçš„åŠ é”é¡ºåºæ˜¯ä¸æ˜¯ï¼š ï¼ˆ10, 15]ï¼Œ (15,20] (bug)ï¼Œ ï¼ˆ5,10]?<br>æˆ‘ä¸å¤ªæ˜ç™½ä¸ºä»€ä¹ˆè¯´ï¼Œè¿™é‡Œè¦ç”¨ä¼˜åŒ–1ï¼Œè·å¾—è¡Œé”ï¼Ÿ è¿˜æ˜¯è¯´ï¼Œå…ˆè·å–id=15çš„è¡Œé”ï¼Œç„¶ååœ¨åŠ ï¼ˆ10,15]ï¼Œ ï¼ˆ5,10]","like_count":0},{"had_liked":false,"id":62922,"user_name":"æ»”æ»”","can_delete":false,"product_type":"c1","uid":1303342,"ip_address":"","ucode":"6968B5771AF79D","user_header":"https://static001.geekbang.org/account/avatar/00/13/e3/2e/77ad18f4.jpg","comment_is_top":false,"comment_ctime":1548207830,"is_pvip":false,"replies":[{"id":"22251","content":"ä¼šåŠ é”ï¼Œinsert into t values (6,6,6) è¢«å µä½äº†","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1548216910,"ip_address":"","comment_id":62922,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548207830","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæœ‰ä¸ªç–‘é—®ï¼Œselect * from t where c&gt;=15 and c&lt;=20 order by c desc lock in share mode; å‘å·¦æ‰«æåˆ° c=10 çš„æ—¶å€™ï¼Œä¸ºä»€ä¹ˆè¦æŠŠ (5, 10] é”èµ·æ¥ï¼Ÿä¸é”ä¹Ÿä¸ä¼šå‡ºç°å¹»è¯»æˆ–è€…é€»è¾‘ä¸Šçš„ä¸ä¸€è‡´å§ğŸ¤”","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437402,"discussion_content":"ä¼šåŠ é”ï¼Œinsert into t values (6,6,6) è¢«å µä½äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548216910,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62883,"user_name":"å°˜å°","can_delete":false,"product_type":"c1","uid":1247006,"ip_address":"","ucode":"CEE0C006387A03","user_header":"https://static001.geekbang.org/account/avatar/00/13/07/1e/bdbe93f4.jpg","comment_is_top":false,"comment_ctime":1548202048,"is_pvip":false,"replies":[{"id":"23184","content":"ä¼šè®²çš„å“ˆ~<br>æ–°æ˜¥å¿«ä¹~","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1549270503,"ip_address":"","comment_id":62883,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548202048","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå’¨è¯¢ä¸ªé—®é¢˜ï¼Œæœ¬æ¥æƒ³åœ¨åé¢åˆ†åŒºè¡¨çš„æ–‡ç« é—®ï¼Œå‘ç°å¤§çº²é‡Œæ²¡æœ‰åˆ†åŒºè¡¨è¿™ä¸€è®²ã€‚<br>1ï¼Œtimestampç±»å‹ä¸ºä»€ä¹ˆä¸æ”¯æŒåˆ†åŒºï¼Ÿ<br>2ï¼Œå‰é¢çš„æ–‡ç« è®²è¿‡åˆ†åŒºä¸è¦å¤ªå¤šï¼Œè¿™ä¸ªå¤šäº†ä¼šæ€ä¹ˆæ ·ï¼Ÿæ¯”å¦‚ä¸€ä¸ªè¡¨ä¸€åƒå¤šä¸ªåˆ†åŒº<br>è°¢è°¢","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437382,"discussion_content":"ä¼šè®²çš„å“ˆ~\næ–°æ˜¥å¿«ä¹~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549270503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62768,"user_name":"å¤å¨œæ‹‰é»‘æš—ä¹‹ç¥Â·å·´å•¦å•¦èƒ½é‡Â·å •è½è¾¾","can_delete":false,"product_type":"c1","uid":1185642,"ip_address":"","ucode":"080BBCEF7DE985","user_header":"https://static001.geekbang.org/account/avatar/00/12/17/6a/c979163e.jpg","comment_is_top":false,"comment_ctime":1548152153,"is_pvip":false,"replies":[{"id":"22249","content":"ä½ è¿™ä¸ªä¾‹å­é‡Œé¢æœ‰ä¸¤è¡Œc=10","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1548216684,"ip_address":"","comment_id":62768,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548152153","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼š<br>æˆ‘æ‰§è¡Œâ€œexplain select id from t where c in(5,20,10) lock in share mode;â€ æ—¶ï¼Œæ˜¾ç¤ºçš„rowså¯¹åº”çš„å€¼æ˜¯4ã€‚ä¸ºä»€ä¹ˆå•Šï¼Ÿ<br>æˆ‘çš„mysqlç‰ˆæœ¬æ˜¯ï¼š5.7.23-0ubuntu0.16.04.1ï¼Œå…·ä½“sqlè¯­å¥å¦‚ä¸‹ï¼š<br>mysql&gt; select * from t;<br>+----+------+------+<br>| id | c    | d    |<br>+----+------+------+<br>|  0 |    0 |    0 |<br>|  5 |    5 |    5 |<br>| 10 |   10 |   10 |<br>| 15 |   15 |   15 |<br>| 20 |   20 |   20 |<br>| 25 |   25 |   25 |<br>| 30 |   10 |   30 |<br>+----+------+------+<br>7 rows in set (0.00 sec)<br><br>mysql&gt; explain select id from t where c in(5,20,10) lock in share mode;<br>+----+-------------+-------+------------+-------+---------------+------+---------+------+------+----------+--------------------------+<br>| id | select_type | table | partitions | type  | possible_keys | key  | key_len | ref  | rows | filtered | Extra                    |<br>+----+-------------+-------+------------+-------+---------------+------+---------+------+------+----------+--------------------------+<br>|  1 | SIMPLE      | t        | NULL       | range | c                  | c        | 5       | NULL |    4 |   100.00 | Using where; Using index |<br>+----+-------------+-------+------------+-------+---------------+------+---------+------+------+----------+--------------------------+<br>1 row in set, 1 warning (0.00 sec)","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437343,"discussion_content":"ä½ è¿™ä¸ªä¾‹å­é‡Œé¢æœ‰ä¸¤è¡Œc=10","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548216684,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62740,"user_name":"Ivan","can_delete":false,"product_type":"c1","uid":1302381,"ip_address":"","ucode":"57090A053A247F","user_header":"https://static001.geekbang.org/account/avatar/00/13/df/6d/44cf0de4.jpg","comment_is_top":false,"comment_ctime":1548146439,"is_pvip":false,"replies":[{"id":"22248","content":"å¥½é—®é¢˜ï¼Œç¬¬33ç¯‡ä¼šè¯´åˆ°å“ˆ<br>ä½ å¯ä»¥åœ¨mysqlå®¢æˆ·ç«¯å‚æ•°å¢åŠ  --quick å†è¯•è¯•","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1548216263,"ip_address":"","comment_id":62740,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548146439","product_id":100020801,"comment_content":"Jan 17 23:52:27 prod-mysql-01 kernel: [ pid ]   uid  tgid total_vm      rss cpu oom_adj oom_score_adj name<br>Jan 17 23:52:27 prod-mysql-01 kernel: [125254]     0 125254    27087        5   0       0             0 mysqld_safe<br>Jan 17 23:52:27 prod-mysql-01 kernel: [126004]   498 126004 24974389 22439356   5       0             0 mysqld<br>Jan 17 23:52:27 prod-mysql-01 kernel: [ 5733]     0  5733  7606586  6077037   7       0             0 mysql<br>---------------------------ç³»ç»Ÿæ—¥å¿—--------------------------------------------------------------------------------<br><br>è€å¸ˆä½ å¥½ï¼Œè¯·æ•™ä¸€ä¸ªé—®é¢˜ ï¼Œæˆ‘åœ¨mysqlæœåŠ¡å™¨ä¸Šæœ¬åœ°ç™»å½•ï¼Œæ‰§è¡Œäº†ä¸€ä¸ªSQLï¼ˆselect  b.id,b.status from  rb_bak b   where  id not  in (select  id from rb );è¯¥è¯­å¥é—®äº†æ‰¾ä¸åŒæ•°æ®ï¼Œ rbå’Œ rb_bak æ•°æ®é‡å‡ä¸º500ä¸‡å·¦å³ï¼‰ï¼ŒSQLå¾ˆæ…¢ï¼Œ30åˆ†é’Ÿä¹Ÿæ²¡ç»“æœï¼›<br>åœ¨SQLè¯­å¥æ‰§è¡ŒæœŸé—´ï¼Œå‘ç”Ÿäº†OOMï¼ŒmysqlæœåŠ¡è¢«killã€‚æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—å‘ç° mysqld å ç”¨å†…å­˜åŸºæœ¬æ²¡æœ‰å˜ï¼Œä½†æ˜¯æœ¬æœºè¿æ¥mysqlçš„å®¢æˆ·ç«¯è¿›ç¨‹ï¼ˆ5733ï¼‰å´å ç”¨äº†å†…å­˜è¿‘20Gï¼Œè¿™å¾ˆè®©äººè´¹è§£ï¼ŒSQLæ²¡æœ‰æ‰§è¡Œå®Œï¼Œå®¢æˆ·ç«¯æ€ä¹ˆä¼šå ç”¨è¿™ä¹ˆå¤šå†…å­˜ï¼Ÿ<br>ç”¨å…¶ä»–SQLæŸ¥è¯¢æŸ¥è¯¢ä¸åŒæ•°æ®ï¼Œä¹Ÿå°±åå‡ æ¡æ•°æ®ï¼Œæ›´ä¸å¯èƒ½å ç”¨è¿™ä¹ˆå¤šå†…å­˜å‘€ã€‚è¿˜è¯·è€å¸ˆå¸®å¿™åˆ†æä¸€ä¸‹ï¼Œè°¢è°¢ã€‚","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437330,"discussion_content":"å¥½é—®é¢˜ï¼Œç¬¬33ç¯‡ä¼šè¯´åˆ°å“ˆ\nä½ å¯ä»¥åœ¨mysqlå®¢æˆ·ç«¯å‚æ•°å¢åŠ  --quick å†è¯•è¯•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548216263,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62714,"user_name":"ServerCoder","can_delete":false,"product_type":"c1","uid":1066487,"ip_address":"","ucode":"7F266C97696E16","user_header":"https://static001.geekbang.org/account/avatar/00/10/45/f7/0f9bcf1f.jpg","comment_is_top":false,"comment_ctime":1548141189,"is_pvip":false,"replies":[{"id":"22242","content":"å¯ä»¥ç”¨åˆ°å¤šæ ¸å‘€ï¼Œä½ æ˜¯æ€ä¹ˆå¾—åˆ° â€œæ—¶é—´ä¸»è¦è€—è´¹åœ¨äº†ç½‘ç»œè¯»å–ä¸Šã€‚â€è¿™ä¸ªç»“è®ºçš„ï¼Ÿ<br><br>å¦å¤–ï¼ŒæŠŠè¿™ä¸‰ä¸ªæ–‡ä»¶å…ˆæ‹·è´åˆ°æ•°æ®åº“æœ¬åœ°ï¼Œç„¶åæœ¬åœ°æ‰§è¡Œloadçœ‹çœ‹ä»€ä¹ˆæ•ˆæœï¼Ÿ<br>","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1548215119,"ip_address":"","comment_id":62714,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548141189","product_id":100020801,"comment_content":"æ—è€å¸ˆæˆ‘æœ‰ä¸ªé—®é¢˜æƒ³è¯·æ•™ä¸€ä¸‹ï¼Œæè¿°å¦‚ä¸‹ï¼Œæœ›ç»™äºˆæŒ‡ç‚¹ï¼Œå…ˆè°¢è°¢äº†ï¼<br><br>ç¯å¢ƒï¼šè™šæ‹Ÿæœºï¼ŒCPU 4æ ¸ï¼Œå†…å­˜8Gï¼Œç³»ç»ŸCentOS7.4ï¼ŒMySQLç‰ˆæœ¬5.6.40<br>æ•°æ®åº“é…ç½®ï¼š<br>bulk_insert_buffer_size = 256M<br>sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES<br>secure_file_priv=&#39;&#39;<br>default-storage-engine=MYISAM<br>æµ‹è¯•åœºæ™¯ä¿®æ”¹è¿‡çš„å‚æ•°(ä»¥ä¸‹è¿™äº›å‚æ•°å¾—è°ƒæ•´å¯¹åŠ è½½æ•ˆç‡æ²¡æœ‰å®è´¨çš„æå‡)ï¼š<br>myisam_repair_threads=3<br>myisam_sort_buffer_size=256M<br>net_buffer_length=1M<br>myisam_use_mmap=ON<br>key_buffer_size=256M<br><br>æµ‹è¯•åœºæ™¯ï¼šæµ‹è¯•ç¨‹åºå¤šçº¿ç¨‹ï¼Œé€šè¿‡å®¢æˆ·ç«¯APIï¼Œæ‰§è¡Œload data infileè¯­å¥åŠ è½½æ•°æ®æ–‡ä»¶<br>ä¸‰ä¸ªçº¿ç¨‹ï¼Œä¸‰ä¸ªæ–‡ä»¶(æ¯ä¸ªæ–‡ä»¶100ä¸‡æ¡æ•°æ®ã€150MB)ï¼Œä¸‰å¼ è¡¨(è¡¨ç»“æ„ç›¸åŒï¼Œå­—æ®µç±»å‹å‡ä¸ºæ•´å½¢ï¼Œæ²¡æœ‰å®šä¹‰ä¸»é”®ï¼Œæœ‰ä¸€ä¸ªå­—æ®µåŠ äº†éå”¯ä¸€ç´¢å¼•)ï¼Œä¸€ä¸€å¯¹åº”è¿›è¡Œæ•°æ®åŠ è½½ï¼Œæ•°æ®åº“æ²¡æœ‰ä½¿ç”¨å¤šæ ¸ï¼Œè€Œæ˜¯æŠŠä¸€ä¸ªæ ¸å¿ƒçš„åˆ©ç”¨ç‡å‡åˆ†ç»™äº†ä¸‰ä¸ªçº¿ç¨‹ã€‚<br>å•ä¸ªçº¿ç¨‹åŠ è½½ä¸€ä¸ªæ–‡ä»¶å¤§çº¦è€—æ—¶3ç§’<br>å•çº¿ç¨‹åŠ è½½ä¸‰ä¸ªæ–‡ä»¶åˆ°ä¸‰å¼ è¡¨å¤§çº¦è€—æ—¶9ç§’<br>ä¸‰ä¸ªçº¿ç¨‹åˆ†åˆ«åŠ è½½ä¸‰ä¸ªæ–‡ä»¶åˆ°ä¸‰å¼ è¡¨ï¼Œåˆ™æ¯ä¸ªçº¿ç¨‹å‡è€—æ—¶å¤§çº¦9ç§’ã€‚ä»è¿™ä¸ªæ•ˆæœçœ‹ï¼Œå•çº¿ç¨‹é¡ºåºåŠ è½½å’Œä¸‰çº¿ç¨‹å¹¶å‘åŠ è½½è€—æ—¶ç›¸åŒï¼Œæ²¡æœ‰æå‡æ•ˆæœã€‚<br>ä¸‰çº¿ç¨‹åŠ è½½è¿‡ç¨‹ä¸­æŸ¥çœ‹processlistå‘ç°æ—¶é—´ä¸»è¦è€—è´¹åœ¨äº†ç½‘ç»œè¯»å–ä¸Šã€‚<br><br>é—®é¢˜ï¼šä¸ºå•¥è¿™ç§åœºæ™¯ä¸‹MySQLä¸åˆ©ç”¨å¤šæ ¸ï¼Ÿè¿™ç§å¹¶è¡ŒåŠ è½½çš„æƒ…å†µè¦å¦‚ä½•æ‰èƒ½è®©å…¶åˆ©ç”¨å¤šæ ¸ï¼Œæå‡åŠ è½½é€Ÿåº¦<br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437316,"discussion_content":"å¯ä»¥ç”¨åˆ°å¤šæ ¸å‘€ï¼Œä½ æ˜¯æ€ä¹ˆå¾—åˆ° â€œæ—¶é—´ä¸»è¦è€—è´¹åœ¨äº†ç½‘ç»œè¯»å–ä¸Šã€‚â€è¿™ä¸ªç»“è®ºçš„ï¼Ÿ\n\nå¦å¤–ï¼ŒæŠŠè¿™ä¸‰ä¸ªæ–‡ä»¶å…ˆæ‹·è´åˆ°æ•°æ®åº“æœ¬åœ°ï¼Œç„¶åæœ¬åœ°æ‰§è¡Œloadçœ‹çœ‹ä»€ä¹ˆæ•ˆæœï¼Ÿ\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548215119,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62675,"user_name":"æ…•å¡”","can_delete":false,"product_type":"c1","uid":1302106,"ip_address":"","ucode":"5C6C668C1106A5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/A94RKUfWfwzRzb68T9xskctQ43TBgXSBIL78p0N0ria2tQxmsTTJebYmefhkbHK7zwpoxokxs43UxpgDTdwm5tg/132","comment_is_top":false,"comment_ctime":1548128424,"is_pvip":false,"replies":[{"id":"22241","content":"æˆ‘è§‰å¾—è¿™ä¸¤ä¸ªå¯¹æ¯”ä¸å¤ªå…¬å¹³^_^<br><br>1ï¼‰çš„æµ‹è¯•å¯èƒ½ä¼šå‡ºç°ä¸­é—´ä»¶ç“¶é¢ˆï¼Œ<br>   a)ç½‘ç»œç¯èŠ‚ä¸­é—´å¢åŠ äº†ä¸€è·³ï¼›<br>   b) å¦‚æœæ˜¯å°æŸ¥è¯¢ï¼Œå¯èƒ½proxyå…ˆæ‰“åˆ°ç“¶é¢ˆ<br>2)çš„æµ‹è¯•ç»“è®ºä¸€èˆ¬ä¼šæ¯”1ï¼‰å¥½äº›<br><br>ä½†æ˜¯æœ‰è¿™ä¸ªæ¶æ„ï¼Œä½ è‚¯å®šæ˜¯ä»ä¸­é—´ä»¶è®¿é—®æ•°æ®åº“çš„ï¼Œæ‰€ä»¥åº”è¯¥ä»¥1çš„æµ‹è¯•ç»“æœä¸ºå‡†","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1548214759,"ip_address":"","comment_id":62675,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548128424","product_id":100020801,"comment_content":"æ˜¯è¿™æ ·çš„ å‡è®¾åªæœ‰ä¸€ä¸»ä¸€ä» 1)æ˜¯é›†ç¾¤åªæœ‰ä¸€ä¸ªsysbenchå®ä¾‹ï¼Œäº§ç”Ÿçš„æ•°æ®æµé€šè¿‡ä¸­é—´ä»¶ï¼Œä¸»æœºåˆ†å…¨éƒ¨å†™ï¼Œå’Œ30%çš„è¯»ï¼Œå¦å¤–70%çš„è¯»å…¨éƒ¨åˆ†ç»™ä»æœºã€‚2)æœ‰ä¸¤ä¸ªsysbenchï¼Œä¸€ä¸ªè¯»å†™åŠ å‹åˆ°ä¸»æœºï¼Œå¦ä¸€ä¸ªåªæœ‰åŠ å‹åˆ°ä»æœºã€‚ä¸»ä»å¤åˆ¶ä¹‹é—´é€šè¿‡binlogã€‚é—®é¢˜åœ¨1)çš„QPSç´¯åŠ ä¸2)QPSç´¯åŠ  æ„ä¹‰ä¸€æ ·å—   1)çš„ä¸€æ¡äº‹åŠ¡æœ‰è¯»å†™ï¼Œè€Œ2)çš„æƒ…å†µï¼Œä¸»æœºä¸1)ä¸€æ ·ï¼Œä»æœºçš„è¯»äº‹åŠ¡ä¸ä¸»æœºé‡Œçš„è¯»ä¸ä¸€æ ·å§ğŸ˜","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437299,"discussion_content":"æˆ‘è§‰å¾—è¿™ä¸¤ä¸ªå¯¹æ¯”ä¸å¤ªå…¬å¹³^_^\n\n1ï¼‰çš„æµ‹è¯•å¯èƒ½ä¼šå‡ºç°ä¸­é—´ä»¶ç“¶é¢ˆï¼Œ\n   a)ç½‘ç»œç¯èŠ‚ä¸­é—´å¢åŠ äº†ä¸€è·³ï¼›\n   b) å¦‚æœæ˜¯å°æŸ¥è¯¢ï¼Œå¯èƒ½proxyå…ˆæ‰“åˆ°ç“¶é¢ˆ\n2)çš„æµ‹è¯•ç»“è®ºä¸€èˆ¬ä¼šæ¯”1ï¼‰å¥½äº›\n\nä½†æ˜¯æœ‰è¿™ä¸ªæ¶æ„ï¼Œä½ è‚¯å®šæ˜¯ä»ä¸­é—´ä»¶è®¿é—®æ•°æ®åº“çš„ï¼Œæ‰€ä»¥åº”è¯¥ä»¥1çš„æµ‹è¯•ç»“æœä¸ºå‡†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548214759,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62436,"user_name":"æ…•å¡”","can_delete":false,"product_type":"c1","uid":1302106,"ip_address":"","ucode":"5C6C668C1106A5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/A94RKUfWfwzRzb68T9xskctQ43TBgXSBIL78p0N0ria2tQxmsTTJebYmefhkbHK7zwpoxokxs43UxpgDTdwm5tg/132","comment_is_top":false,"comment_ctime":1548057741,"is_pvip":false,"replies":[{"id":"22163","content":"TPSå°±çœ‹ä¸»åº“çš„å†™å…¥<br>QPSå°±çœ‹æ‰€æœ‰ä»åº“çš„è¯»èƒ½åŠ›åŠ å’Œ<br>ä¸è¿‡æ²¡çœ‹æ‡‚ä½ é—®é¢˜ä¸­1ï¼‰å’Œ2ï¼‰çš„åŒºåˆ«ğŸ˜…","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1548124479,"ip_address":"","comment_id":62436,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548057741","product_id":100020801,"comment_content":"å¤§ä½¬ è¯·æ•™ä¸‹ä¸€ä¸»å¤šä»é›†ç¾¤æ€§èƒ½æµ‹è¯•æ€§èƒ½è®¡ç®—é—®é¢˜  å¦‚æœä½¿ç”¨åŸºå‡†æµ‹è¯•å·¥å…·sysbenchã€‚æ•°æ®æµæœ‰ä¸¤ç§<br>1)<br> sysbench---mycat---mysqlä¸»æœº(è¯»å†™) TPS QPS1<br>                             |               |binlog<br>                             mysqlä»æœº(åªè¯»)QPS2<br>é‚£æ€§èƒ½æŒ‡æ ‡  TPS  QPS=QPS1+QPS2<br>2)<br>sysbench---mysqlä¸»æœº(è¯»å†™) TPS QPS1<br>                               | binlog<br>sysbench---mysqlä»æœº(åªè¯»)TPS QPS2<br>é›†ç¾¤æ€§èƒ½æŒ‡æ ‡TPS  QPS=QPS1+QPS2<br>è¿™ä¸¤ç§å“ªç§ä¸¥è°¨äº›å•Šï¼Ÿmycatçš„æŸå¤±å¿½ç•¥ã€‚<br>ç”Ÿäº§ä¸­çš„é›†ç¾¤æ€§èƒ½æ€ä¹ˆç®—çš„å‘¢ï¼Ÿï¼Ÿï¼Ÿ(è¿˜æ˜¯å­¦ç”Ÿ è°¢è°¢ï¼)","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437211,"discussion_content":"TPSå°±çœ‹ä¸»åº“çš„å†™å…¥\nQPSå°±çœ‹æ‰€æœ‰ä»åº“çš„è¯»èƒ½åŠ›åŠ å’Œ\nä¸è¿‡æ²¡çœ‹æ‡‚ä½ é—®é¢˜ä¸­1ï¼‰å’Œ2ï¼‰çš„åŒºåˆ«ğŸ˜…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548124479,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62369,"user_name":"HuaMax","can_delete":false,"product_type":"c1","uid":1118488,"ip_address":"","ucode":"2E78DE1AF098AF","user_header":"https://static001.geekbang.org/account/avatar/00/11/11/18/8cee35f9.jpg","comment_is_top":false,"comment_ctime":1548040362,"is_pvip":false,"replies":[{"id":"22054","content":"ä¸æ˜¯çš„ï¼Œè¦æ‰¾id&gt;10çš„ï¼Œå¹¶æ²¡æœ‰å‘½ä¸­id=10å“¦ï¼Œä½ å¯ä»¥ç†è§£æˆå°±æ˜¯æŸ¥åˆ°äº†(10,15)è¿™ä¸ªé—´éš™","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1548042323,"ip_address":"","comment_id":62369,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548040362","product_id":100020801,"comment_content":"åˆ é™¤å¯¼è‡´é”èŒƒå›´æ‰©å¤§é‚£ä¸ªä¾‹å­ï¼Œid&gt;10 and id&lt;=15ï¼Œé”èŒƒå›´ä¸ºä»€ä¹ˆæ²¡æœ‰10å‘¢ï¼Ÿä¸æ˜¯åº”è¯¥ï¼ˆ5ï¼Œ10]å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437186,"discussion_content":"ä¸æ˜¯çš„ï¼Œè¦æ‰¾id&amp;gt;10çš„ï¼Œå¹¶æ²¡æœ‰å‘½ä¸­id=10å“¦ï¼Œä½ å¯ä»¥ç†è§£æˆå°±æ˜¯æŸ¥åˆ°äº†(10,15)è¿™ä¸ªé—´éš™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548042323,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62367,"user_name":"llx","can_delete":false,"product_type":"c1","uid":1153012,"ip_address":"","ucode":"95741E1BD74B26","user_header":"https://static001.geekbang.org/account/avatar/00/11/97/f4/6709b8cf.jpg","comment_is_top":false,"comment_ctime":1548039030,"is_pvip":false,"replies":[{"id":"22053","content":"ğŸ‘ ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1548042247,"ip_address":"","comment_id":62367,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548039030","product_id":100020801,"comment_content":"å›å¤@å¾€äº‹éšé£ï¼Œé¡ºå…¶è‡ªç„¶<br>å‰é¢æœ‰è§£é‡Šä¸ºä»€ä¹ˆï¼Œè¿™ç¯‡æ–‡ç« æœ‰æ›´è¯¦ç»†çš„è§£é‡Šã€‚Gap lock ç”±å³å€¼æŒ‡å®šçš„ï¼Œç”±äº c ä¸æ˜¯å”¯ä¸€é”®ï¼Œéœ€è¦åˆ°10ï¼Œéå†åˆ°10çš„æ—¶å€™ï¼Œå°±æŠŠ 5-10 é”äº†<br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437185,"discussion_content":"ğŸ‘ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548042247,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}