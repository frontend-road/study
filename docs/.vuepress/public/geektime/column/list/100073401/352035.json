{"id":352035,"title":"01 | æ€§èƒ½è°ƒä¼˜çš„å¿…è¦æ€§ï¼šSparkæœ¬èº«å°±å¾ˆå¿«ï¼Œä¸ºå•¥è¿˜éœ€è¦æˆ‘è°ƒä¼˜ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å´ç£Šã€‚</p><p>åœ¨æ—¥å¸¸çš„å¼€å‘å·¥ä½œä¸­ï¼Œæˆ‘å‘ç°æœ‰ä¸ªç°è±¡å¾ˆæ™®éã€‚å¾ˆå¤šå¼€å‘è€…éƒ½è®¤ä¸ºSparkçš„æ‰§è¡Œæ€§èƒ½å·²ç»éå¸¸å¼ºäº†ï¼Œå®é™…å·¥ä½œä¸­åªè¦æŒ‰éƒ¨å°±ç­åœ°å®ç°ä¸šåŠ¡åŠŸèƒ½å°±å¯ä»¥äº†ï¼Œæ²¡æœ‰å¿…è¦è¿›è¡Œæ€§èƒ½è°ƒä¼˜ã€‚</p><p>ä½ æ˜¯ä¸æ˜¯ä¹Ÿè¿™ä¹ˆè®¤ä¸ºå‘¢ï¼Ÿç¡®å®ï¼ŒSparkçš„æ ¸å¿ƒç«äº‰åŠ›å°±æ˜¯å®ƒçš„æ‰§è¡Œæ€§èƒ½ï¼Œè¿™ä¸»è¦å¾—ç›ŠäºSparkåŸºäºå†…å­˜è®¡ç®—çš„è¿è¡Œæ¨¡å¼å’Œé’¨ä¸è®¡åˆ’çš„é”¦ä¸Šæ·»èŠ±ï¼Œä»¥åŠSpark SQLä¸Šçš„ä¸“æ³¨ä¸å‘åŠ›ã€‚</p><p>ä½†æ˜¯ï¼ŒçœŸå¦‚å¤§å®¶æ‰€è¯´ï¼Œ<strong>å¼€å‘è€…åªè¦æŠŠä¸šåŠ¡é€»è¾‘å®ç°äº†å°±ä¸‡äº‹å¤§å‰äº†å—</strong>ï¼Ÿè¿™æ ·ï¼Œå’±ä»¬å…ˆä¸æ€¥äºå¾—å‡ºç»“è®ºï¼Œä½ å…ˆè·Ÿç€æˆ‘ä¸€èµ·çœ‹ä¸¤ä¸ªæ—¥å¸¸å¼€å‘ä¸­å¸¸è§çš„ä¾‹å­ï¼Œæœ€åæˆ‘ä»¬å†æ¥å›ç­”è¿™ä¸ªé—®é¢˜ã€‚</p><p>åœ¨æ•°æ®åº”ç”¨åœºæ™¯ä¸­ï¼ŒETLï¼ˆExtract Transform Loadï¼‰å¾€å¾€æ˜¯æ‰“å¤´é˜µçš„é‚£ä¸ªï¼Œæ¯•ç«Ÿæºæ•°æ®ç»è¿‡æŠ½å–å’Œè½¬æ¢æ‰èƒ½ç”¨äºæ¢ç´¢å’Œåˆ†æï¼Œæˆ–è€…æ˜¯ä¾›å…»ç»™æœºå™¨å­¦ä¹ ç®—æ³•è¿›è¡Œæ¨¡å‹è®­ç»ƒï¼Œä»è€ŒæŒ–æ˜å‡ºæ•°æ®æ·±å±‚æ¬¡çš„ä»·å€¼ã€‚æˆ‘ä»¬ä»Šå¤©è¦ä¸¾çš„ä¸¤ä¸ªä¾‹å­ï¼Œéƒ½å–è‡ªå…¸å‹ETLç«¯åˆ°ç«¯ä½œä¸šä¸­å¸¸è§çš„æ“ä½œå’Œè®¡ç®—ä»»åŠ¡ã€‚</p><h2>å¼€å‘æ¡ˆä¾‹1ï¼šæ•°æ®æŠ½å–</h2><p>ç¬¬ä¸€ä¸ªä¾‹å­å¾ˆç®€å•ï¼šç»™å®šæ•°æ®æ¡ç›®ï¼Œä»ä¸­æŠ½å–ç‰¹å®šå­—æ®µã€‚è¿™æ ·çš„æ•°æ®å¤„ç†éœ€æ±‚åœ¨å¹³æ—¶çš„ETLä½œä¸šä¸­ç›¸å½“æ™®éã€‚æƒ³è¦å®ç°è¿™ä¸ªéœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªå‡½æ•°extractFieldsï¼šå®ƒçš„è¾“å…¥å‚æ•°æ˜¯Seq[Row]ç±»å‹ï¼Œä¹Ÿå³æ•°æ®æ¡ç›®åºåˆ—ï¼›è¾“å‡ºç»“æœçš„è¿”å›ç±»å‹æ˜¯Seq[(String, Int)]ï¼Œä¹Ÿå°±æ˜¯ï¼ˆString, Intï¼‰å¯¹å„¿çš„åºåˆ—ï¼›å‡½æ•°çš„è®¡ç®—é€»è¾‘æ˜¯ä»æ•°æ®æ¡ç›®ä¸­æŠ½å–ç´¢å¼•ä¸º2çš„å­—ç¬¦ä¸²å’Œç´¢å¼•ä¸º4çš„æ•´å‹ã€‚</p><!-- [[[read_end]]] --><p>åº”è¯¥è¯´è¿™ä¸ªä¸šåŠ¡éœ€æ±‚ç›¸å½“ç®€å•æ˜äº†ï¼Œå®ç°èµ·æ¥ç®€ç›´æ˜¯å°èœä¸€ç¢Ÿã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘è§‚å¯Ÿåˆ°æœ‰ä¸å°‘åŒå­¦ä¸€ä¸Šæ¥å°±è¿…é€Ÿåœ°ç”¨ä¸‹é¢çš„æ–¹å¼å»å®ç°ï¼Œå¹²è„†åˆ©è½ï¼Œä»£ç å†™å¾—æŒºå¿«ï¼ŒåŠŸèƒ½ä¹Ÿæ²¡é—®é¢˜ï¼ŒUTã€åŠŸèƒ½æµ‹è¯•éƒ½èƒ½è¿‡ã€‚</p><pre><code>//å®ç°æ–¹æ¡ˆ1 â€”â€” åä¾‹\nval extractFields: Seq[Row] =&gt; Seq[(String, Int)] = {\n  (rows: Seq[Row]) =&gt; {\n    var fields = Seq[(String, Int)]()\n    rows.map(row =&gt; {\n        fields = fields :+ (row.getString(2), row.getInt(4))\n    })\n  fields\n  }\n}\n</code></pre><p>åœ¨ä¸Šé¢è¿™ä¸ªå‡½æ•°ä½“ä¸­ï¼Œæ˜¯å…ˆå®šä¹‰ä¸€ä¸ªç±»å‹æ˜¯Seq[(String, Int)]çš„å˜é‡fieldsï¼Œå˜é‡ç±»å‹å’Œå‡½æ•°è¿”å›ç±»å‹å®Œå…¨ä¸€è‡´ã€‚ç„¶åï¼Œå‡½æ•°é€ä¸ªéå†è¾“å…¥å‚æ•°ä¸­çš„æ•°æ®æ¡ç›®ï¼ŒæŠ½å–æ•°æ®æ¡ç›®ä¸­ç´¢å¼•æ˜¯2å’Œ4çš„å­—æ®µå¹¶ä¸”æ„å»ºäºŒå…ƒå…ƒç»„ï¼Œç´§æ¥ç€æŠŠå…ƒç»„è¿½åŠ åˆ°æœ€åˆå®šä¹‰çš„å˜é‡fieldsä¸­ã€‚æœ€åï¼Œå‡½æ•°è¿”å›ç±»å‹æ˜¯Seq[(String, Int)]çš„å˜é‡fieldsã€‚</p><p>ä¹çœ‹ä¸Šå»ï¼Œè¿™ä¸ªå‡½æ•°ä¼¼ä¹æ²¡ä»€ä¹ˆé—®é¢˜ã€‚ç‰¹æ®Šçš„åœ°æ–¹åœ¨äºï¼Œå°½ç®¡è¿™ä¸ªæ•°æ®æŠ½å–å‡½æ•°å¾ˆå°ï¼Œåœ¨å¤æ‚çš„ETLåº”ç”¨é‡Œæ˜¯éå¸¸å¾®å°çš„ä¸€ç¯ï¼Œä½†åœ¨æ•´ä¸ªETLä½œä¸šä¸­ï¼Œå®ƒä¼šåœ¨ä¸åŒåœ°æ–¹è¢«é¢‘ç¹åœ°åå¤è°ƒç”¨ã€‚å¦‚æœæˆ‘åŸºäºè¿™ä»½ä»£ç æŠŠæ•´ä¸ªETLåº”ç”¨æ¨ä¸Šçº¿ï¼Œå°±ä¼šå‘ç°ETLä½œä¸šç«¯åˆ°ç«¯çš„æ‰§è¡Œæ•ˆç‡éå¸¸å·®ï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹å®Œæˆä½œä¸šéœ€è¦ä¸¤ä¸ªå°æ—¶ï¼Œè¿™æ ·çš„é€Ÿåº¦éš¾å…æœ‰ç‚¹è®©äººæ²®ä¸§ã€‚</p><p>æƒ³è¦è®©ETLä½œä¸šè·‘å¾—æ›´å¿«ï¼Œæˆ‘ä»¬è‡ªç„¶éœ€è¦åšæ€§èƒ½è°ƒä¼˜ã€‚å¯é—®é¢˜æ˜¯æˆ‘ä»¬è¯¥ä»å“ªå„¿å…¥æ‰‹å‘¢ï¼Ÿæ—¢ç„¶extractFieldsè¿™ä¸ªå°å‡½æ•°ä¼šè¢«é¢‘ç¹åœ°è°ƒç”¨ï¼Œä¸å¦‚æˆ‘ä»¬ä»å®ƒä¸‹æ‰‹å¥½äº†ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å¯èƒ½ç»™å®ƒâ€œå‡ä¸ªè‚¥ã€ç˜¦ä¸ªèº«â€ã€‚é‡æ–°å®¡è§†å‡½æ•°extractFieldsçš„ç±»å‹ä¹‹åï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œè¿™ä¸ªå‡½æ•°ä»å¤´åˆ°å°¾æ— éæ˜¯ä»Seq[Row]åˆ°Seq[(String, Int)]çš„è½¬æ¢ï¼Œå‡½æ•°ä½“çš„æ ¸å¿ƒé€»è¾‘å°±æ˜¯å­—æ®µæå–ï¼Œåªè¦ä»Seq[Row]å¯ä»¥å¾—åˆ°Seq[(String, Int)]ï¼Œç›®çš„å°±è¾¾åˆ°äº†ã€‚</p><p>è¦è¾¾æˆè¿™ä¸¤ç§æ•°æ®ç±»å‹ä¹‹é—´çš„è½¬æ¢ï¼Œé™¤äº†åˆ©ç”¨ä¸Šé¢è¿™ç§å¼€å‘è€…ä¿¡æ‰‹æ‹ˆæ¥çš„è¿‡ç¨‹å¼ç¼–ç¨‹ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨å‡½æ•°å¼çš„ç¼–ç¨‹èŒƒå¼ã€‚å‡½æ•°å¼ç¼–ç¨‹çš„åŸåˆ™ä¹‹ä¸€å°±æ˜¯å°½å¯èƒ½åœ°åœ¨å‡½æ•°ä½“ä¸­é¿å…å‰¯ä½œç”¨ï¼ˆSide effectï¼‰ï¼Œå‰¯ä½œç”¨æŒ‡çš„æ˜¯å‡½æ•°å¯¹äºçŠ¶æ€çš„ä¿®æ”¹å’Œå˜æ›´ï¼Œæ¯”å¦‚ä¸Šä¾‹ä¸­extractFieldså‡½æ•°å¯¹äºfieldså˜é‡ä¸åœåœ°æ‰§è¡Œè¿½åŠ æ“ä½œå°±å±äºå‰¯ä½œç”¨ã€‚</p><p>åŸºäºè¿™ä¸ªæƒ³æ³•ï¼Œæˆ‘ä»¬å°±æœ‰äº†ç¬¬äºŒç§å®ç°æ–¹å¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ä¸ç¬¬ä¸€ç§å®ç°ç›¸æ¯”ï¼Œå®ƒæœ€å¤§çš„åŒºåˆ«åœ¨äºå»æ‰äº†fieldså˜é‡ã€‚ä¹‹åï¼Œä¸ºäº†è¾¾åˆ°åŒæ ·çš„æ•ˆæœï¼Œæˆ‘ä»¬åœ¨è¾“å…¥å‚æ•°Seq[Row]ä¸Šç›´æ¥è°ƒç”¨mapæ“ä½œé€ä¸€åœ°æå–ç‰¹å®šå­—æ®µå¹¶æ„å»ºå…ƒç»„ï¼Œæœ€åé€šè¿‡toSeqå°†æ˜ å°„è½¬æ¢ä¸ºåºåˆ—ï¼Œå¹²å‡€åˆ©è½ï¼Œä¸€æ°”å‘µæˆã€‚</p><pre><code>//å®ç°æ–¹æ¡ˆ2 â€”â€” æ­£ä¾‹\nval extractFields: Seq[Row] =&gt; Seq[(String, Int)] = {\n  (rows: Seq[Row]) =&gt; \n    rows.map(row =&gt; (row.getString(2), row.getInt(4))).toSeq\n}\n\n</code></pre><p>ä½ å¯èƒ½ä¼šé—®ï¼šâ€œä¸¤ä»½ä»£ç å®ç°æ— éæ˜¯å·®äº†ä¸ªä¸­é—´å˜é‡è€Œå·²ï¼Œèƒ½æœ‰å¤šå¤§å·®åˆ«å‘¢ï¼Ÿçœ‹ä¸Šå»ä¸è¿‡æ˜¯ä»£ç æ›´ç®€æ´äº†è€Œå·²ã€‚â€äº‹å®ä¸Šï¼Œæˆ‘åŸºäºç¬¬äºŒä»½ä»£ç æŠŠETLä½œä¸šæ¨ä¸Šçº¿åï¼Œå°±æƒŠå¥‡åœ°å‘ç°ç«¯åˆ°ç«¯æ‰§è¡Œæ€§èƒ½æå‡äº†ä¸€å€ï¼ä»åŸæ¥çš„ä¸¤ä¸ªå°æ—¶ç¼©çŸ­åˆ°ä¸€ä¸ªå°æ—¶ã€‚<strong>ä¸¤ä»½åŠŸèƒ½å®Œå…¨ä¸€æ ·çš„ä»£ç ï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­çš„æ‰§è¡Œæ€§èƒ½ç«Ÿç„¶æœ‰ç€æˆå€çš„å·®åˆ«ã€‚å› æ­¤ä½ çœ‹ï¼Œåœ¨æ—¥å¸¸çš„å¼€å‘å·¥ä½œä¸­ï¼Œä»…ä»…ä¸“æ³¨äºä¸šåŠ¡åŠŸèƒ½å®ç°è¿˜æ˜¯ä¸å¤Ÿçš„ï¼Œä»»ä½•ä¸€ä¸ªå¯ä»¥è¿›è¡Œè°ƒä¼˜çš„å°ç¯èŠ‚å’±ä»¬éƒ½ä¸èƒ½æ”¾è¿‡ã€‚</strong></p><h2>å¼€å‘æ¡ˆä¾‹2ï¼šæ•°æ®è¿‡æ»¤ä¸æ•°æ®èšåˆ</h2><p>ä½ ä¹Ÿè®¸ä¼šè¯´ï¼šâ€œä½ è¿™ä¸ªä¾‹å­åªæ˜¯ä¸ªä¾‹å§ï¼Ÿæ›´ä½•å†µï¼Œè¿™ä¸ªä¾‹å­é‡Œçš„ä¼˜åŒ–ï¼Œä»…ä»…æ˜¯ç¼–ç¨‹èŒƒå¼çš„è°ƒæ•´ï¼Œçœ‹ä¸Šå»å’ŒSparkä¼¼ä¹ä¹Ÿæ²¡ä»€ä¹ˆå…³ç³»å•Šï¼â€ä¸è¦ç´§ï¼Œæˆ‘ä»¬å†æ¥çœ‹ç¬¬äºŒä¸ªä¾‹å­ã€‚ç¬¬äºŒä¸ªä¾‹å­ä¼šç¨å¾®å¤æ‚ä¸€äº›ï¼Œæˆ‘ä»¬å…ˆæ¥æŠŠä¸šåŠ¡éœ€æ±‚å’Œæ•°æ®å…³ç³»äº¤ä»£æ¸…æ¥šã€‚</p><pre><code>/**\n(startDate, endDate)\ne.g. (&quot;2021-01-01&quot;, &quot;2021-01-31&quot;)\n*/\nval pairDF: DataFrame = _\n \n/**\n(dim1, dim2, dim3, eventDate, value)\ne.g. (&quot;X&quot;, &quot;Y&quot;, &quot;Z&quot;, &quot;2021-01-15&quot;, 12)\n*/\nval factDF: DataFrame = _\n \n// Storage root path\nval rootPath: String = _ \n\n</code></pre><p>åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä»½æ•°æ®ï¼Œåˆ†åˆ«æ˜¯pairDFå’ŒfactDFï¼Œæ•°æ®ç±»å‹éƒ½æ˜¯DataFrameã€‚ç¬¬ä¸€ä»½æ•°æ®pairDFçš„SchemaåŒ…å«ä¸¤ä¸ªå­—æ®µï¼Œåˆ†åˆ«æ˜¯å¼€å§‹æ—¥æœŸå’Œç»“æŸæ—¥æœŸã€‚ç¬¬äºŒä»½æ•°æ®çš„å­—æ®µè¾ƒå¤šï¼Œä¸è¿‡æœ€ä¸»è¦çš„å­—æ®µå°±ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯Event dateäº‹ä»¶æ—¥æœŸï¼Œå¦ä¸€ä¸ªæ˜¯ä¸šåŠ¡å…³å¿ƒçš„ç»Ÿè®¡é‡ï¼Œå–åä¸ºValueã€‚å…¶ä»–ç»´åº¦å¦‚dim1ã€dim2ã€dim3ä¸»è¦ç”¨äºæ•°æ®åˆ†ç»„ï¼Œå…·ä½“å«ä¹‰å¹¶ä¸é‡è¦ã€‚ä»æ•°æ®é‡æ¥çœ‹ï¼ŒpairDFçš„æ•°æ®é‡å¾ˆå°ï¼Œå¤§æ¦‚å‡ ç™¾æ¡è®°å½•ï¼ŒfactDFæ•°æ®é‡å¾ˆå¤§ï¼Œæœ‰ä¸Šåƒä¸‡è¡Œã€‚</p><p>å¯¹äºè¿™ä¸¤ä»½æ•°æ®æ¥è¯´ï¼Œå…·ä½“çš„ä¸šåŠ¡éœ€æ±‚å¯ä»¥æ‹†æˆ3æ­¥ï¼š</p><ol>\n<li>å¯¹äºpairDFä¸­çš„æ¯ä¸€ç»„æ—¶é—´å¯¹ï¼Œä»factDFä¸­è¿‡æ»¤å‡ºEvent dateè½åœ¨å…¶é—´çš„æ•°æ®æ¡ç›®ï¼›</li>\n<li>ä»dim1ã€dim2ã€dim3å’ŒEvent date 4ä¸ªç»´åº¦å¯¹factDFåˆ†ç»„ï¼Œå†å¯¹ä¸šåŠ¡ç»Ÿè®¡é‡Valueè¿›è¡Œæ±‡æ€»ï¼›</li>\n<li>å°†æœ€ç»ˆçš„ç»Ÿè®¡ç»“æœè½ç›˜åˆ°Amazon S3ã€‚</li>\n</ol><p>é’ˆå¯¹è¿™æ ·çš„ä¸šåŠ¡éœ€æ±‚ï¼Œä¸å°‘åŒå­¦æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤æŒ‰éƒ¨å°±ç­åœ°è¿›è¡Œäº†å¦‚ä¸‹çš„å®ç°ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å°±ç»“åˆå…·ä½“çš„ä»£ç æ¥å’Œä½ è¯´è¯´å…¶ä¸­çš„è®¡ç®—é€»è¾‘ã€‚</p><pre><code>//å®ç°æ–¹æ¡ˆ1 â€”â€” åä¾‹\ndef createInstance(factDF: DataFrame, startDate: String, endDate: String): DataFrame = {\nval instanceDF = factDF\n.filter(col(&quot;eventDate&quot;) &gt; lit(startDate) &amp;&amp; col(&quot;eventDate&quot;) &lt;= lit(endDate))\n.groupBy(&quot;dim1&quot;, &quot;dim2&quot;, &quot;dim3&quot;, &quot;event_date&quot;)\n.agg(sum(&quot;value&quot;) as &quot;sum_value&quot;)\ninstanceDF\n}\n \npairDF.collect.foreach{\ncase (startDate: String, endDate: String) =&gt;\nval instance = createInstance(factDF, startDate, endDate)\nval outPath = s&quot;${rootPath}/endDate=${endDate}/startDate=${startDate}&quot;\ninstance.write.parquet(outPath)\n} \n</code></pre><p>é¦–å…ˆï¼Œä»–ä»¬æ˜¯ä»¥factDFã€å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´ä¸ºå½¢å‚å®šä¹‰createInstanceå‡½æ•°ã€‚åœ¨å‡½æ•°ä½“ä¸­ï¼Œå…ˆæ ¹æ®Event dateå¯¹factDFè¿›è¡Œè¿‡æ»¤ï¼Œç„¶åä»4ä¸ªç»´åº¦åˆ†ç»„æ±‡æ€»ç»Ÿè®¡é‡ï¼Œæœ€åå°†æ±‡æ€»ç»“æœè¿”å›ã€‚å®šä¹‰å®ŒcreateInstanceå‡½æ•°ä¹‹åï¼Œæ”¶é›†pairDFåˆ°Driverç«¯å¹¶é€æ¡éå†æ¯ä¸€ä¸ªæ—¶é—´å¯¹ï¼Œç„¶åä»¥factDFã€å¼€å§‹æ—¶é—´ã€ç»“æŸæ—¶é—´ä¸ºå®å‚è°ƒç”¨createInstanceå‡½æ•°ï¼Œæ¥è·å–æ»¡è¶³è¿‡æ»¤è¦æ±‚çš„æ±‡æ€»ç»“æœã€‚æœ€åï¼Œä»¥Parquetçš„å½¢å¼å°†ç»“æœè½ç›˜ã€‚</p><p>åŒæ ·åœ°ï¼Œè¿™æ®µä»£ç ä»åŠŸèƒ½çš„è§’åº¦æ¥è¯´æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œè€Œä¸”ä»çº¿ä¸Šçš„ç»“æœæ¥çœ‹ï¼Œæ•°æ®çš„å¤„ç†é€»è¾‘ä¹Ÿå®Œå…¨ç¬¦åˆé¢„æœŸã€‚ä¸è¿‡ï¼Œç«¯åˆ°ç«¯çš„æ‰§è¡Œæ€§èƒ½å¯ä»¥è¯´æ˜¯æƒ¨ä¸å¿ç¹ï¼Œåœ¨16å°æœºå‹ä¸ºC5.4xlarge AWS EC2çš„åˆ†å¸ƒå¼è¿è¡Œç¯å¢ƒä¸­ï¼ŒåŸºäºä¸Šé¢è¿™ä»½ä»£ç çš„ETLä½œä¸šèŠ±è´¹äº†åŠä¸ªå°æ—¶æ‰æ‰§è¡Œå®Œæ¯•ã€‚</p><p>æ²¡æœ‰å¯¹æ¯”å°±æ²¡æœ‰ä¼¤å®³ï¼Œåœ¨åŒä¸€ä»½æ•°æ®é›†ä¹‹ä¸Šï¼Œé‡‡ç”¨ä¸‹é¢çš„ç¬¬äºŒç§å®ç°æ–¹å¼ï¼Œä»…ç”¨2å°åŒæ ·æœºå‹çš„EC2å°±èƒ½è®©ETLä½œä¸šåœ¨15åˆ†é’Ÿä»¥å†…å®Œæˆç«¯åˆ°ç«¯çš„è®¡ç®—ä»»åŠ¡ã€‚<strong>ä¸¤ä»½ä»£ç çš„ä¸šåŠ¡åŠŸèƒ½å’Œè®¡ç®—é€»è¾‘å®Œå…¨ä¸€è‡´ï¼Œæ‰§è¡Œæ€§èƒ½å´å·®äº†åä¸‡å…«åƒé‡Œ</strong>ã€‚</p><pre><code>//å®ç°æ–¹æ¡ˆ2 â€”â€” æ­£ä¾‹\nval instances = factDF\n.join(pairDF, factDF(&quot;eventDate&quot;) &gt; pairDF(&quot;startDate&quot;) &amp;&amp; factDF(&quot;eventDate&quot;) &lt;= pairDF(&quot;endDate&quot;))\n.groupBy(&quot;dim1&quot;, &quot;dim2&quot;, &quot;dim3&quot;, &quot;eventDate&quot;, &quot;startDate&quot;, &quot;endDate&quot;)\n.agg(sum(&quot;value&quot;) as &quot;sum_value&quot;)\n \ninstances.write.partitionBy(&quot;endDate&quot;, &quot;startDate&quot;).parquet(rootPath)\n</code></pre><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œè¿™ä¸¤ä»½ä»£ç åˆ°åº•å·®åœ¨å“ªé‡Œï¼Œæ˜¯ä»€ä¹ˆå¯¼è‡´å®ƒä»¬çš„æ‰§è¡Œæ€§èƒ½å·®åˆ«å¦‚æ­¤ä¹‹å¤§ã€‚æˆ‘ä»¬ä¸å¦¨å…ˆæ¥å›é¡¾ç¬¬ä¸€ç§å®ç°æ–¹å¼ï¼Œå—…ä¸€å—…è¿™é‡Œé¢æœ‰å“ªäº›ä¸å¥½çš„ä»£ç å‘³é“ã€‚</p><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œè§¦å‘Sparkå»¶è¿Ÿè®¡ç®—çš„Actionsç®—å­ä¸»è¦æœ‰ä¸¤ç±»ï¼šä¸€ç±»æ˜¯å°†åˆ†å¸ƒå¼è®¡ç®—ç»“æœç›´æ¥è½ç›˜çš„æ“ä½œï¼Œå¦‚DataFrameçš„writeã€RDDçš„saveAsTextFileç­‰ï¼›å¦ä¸€ç±»æ˜¯å°†åˆ†å¸ƒå¼ç»“æœæ”¶é›†åˆ°Driverç«¯çš„æ“ä½œï¼Œå¦‚firstã€takeã€collectã€‚</p><p>æ˜¾ç„¶ï¼Œå¯¹äºç¬¬äºŒç±»ç®—å­æ¥è¯´ï¼ŒDriveræœ‰å¯èƒ½å½¢æˆå•ç‚¹ç“¶é¢ˆï¼Œå°¤å…¶æ˜¯ç”¨collectç®—å­å»å…¨é‡æ”¶é›†è¾ƒå¤§çš„ç»“æœé›†æ—¶ï¼Œæ›´å®¹æ˜“å‡ºç°æ€§èƒ½é—®é¢˜ã€‚å› æ­¤ï¼Œåœ¨ç¬¬ä¸€ç§å®ç°æ–¹å¼ä¸­ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å°±èƒ½å—…åˆ°collectè¿™é‡Œçš„è°ƒç”¨ï¼Œå‘³é“å¾ˆå·®ã€‚</p><p>å°½ç®¡collectè¿™é‡Œå‘³é“ä¸å¥½ï¼Œä½†åœ¨æˆ‘ä»¬çš„åœºæ™¯é‡Œï¼ŒpairDFæ¯•ç«Ÿæ˜¯ä¸€ä»½å¾ˆå°çš„æ•°æ®é›†ï¼Œæ‰å‡ ç™¾æ¡æ•°æ®è®°å½•è€Œå·²ï¼Œå…¨é‡æœé›†åˆ°Driverç«¯ä¹Ÿä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ã€‚</p><p>æœ€è¦å‘½çš„æ˜¯collectåé¢çš„foreachã€‚è¦çŸ¥é“ï¼ŒfactDFæ˜¯ä¸€ä»½åºå¤§çš„åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œå°½ç®¡createInstanceçš„é€»è¾‘ä»…ä»…æ˜¯å¯¹factDFè¿›è¡Œè¿‡æ»¤ã€æ±‡æ€»å¹¶è½ç›˜ï¼Œä½†æ˜¯createInstanceå‡½æ•°åœ¨foreachä¸­ä¼šè¢«è°ƒç”¨å‡ ç™¾æ¬¡ï¼ŒpairDFä¸­æœ‰å¤šå°‘ä¸ªæ—¶é—´å¯¹ï¼ŒcreateInstanceå°±ä¼šè¢«è°ƒç”¨å¤šå°‘æ¬¡ã€‚å¯¹äºSparkä¸­çš„DAGæ¥è¯´ï¼Œåœ¨æ²¡æœ‰ç¼“å­˜çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸€æ¬¡Actionçš„è§¦å‘éƒ½ä¼šå¯¼è‡´æ•´æ¡DAGä»å¤´åˆ°å°¾é‡æ–°æ‰§è¡Œã€‚</p><p>æ˜ç™½äº†è¿™ä¸€ç‚¹ä¹‹åï¼Œæˆ‘ä»¬å†æ¥ä»”ç»†è§‚å¯Ÿè¿™ä»½ä»£ç ï¼Œä½ å“ã€ä½ ç»†å“ï¼Œç›®ä¸è½¬ç›åœ°ç›¯ç€foreachå’ŒcreateInstanceä¸­çš„factDFï¼Œä½ ä¼šæƒŠè®¶åœ°å‘ç°ï¼šæœ‰ç€ä¸Šåƒä¸‡è¡Œæ•°æ®çš„factDFè¢«åå¤æ‰«æäº†å‡ ç™¾æ¬¡ï¼è€Œä¸”ï¼Œæ˜¯å…¨é‡æ‰«æå“Ÿï¼å“ä¸å“äººï¼Ÿå¯ä¸å¯æ€•ï¼Ÿè¿™ä¹ˆåˆ†æä¸‹æ¥ï¼ŒETLä½œä¸šç«¯åˆ°ç«¯æ‰§è¡Œæ•ˆç‡ä½ä¸‹çš„å§‹ä½œä¿‘è€…ï¼Œæ˜¯ä¸æ˜¯å°±æš´éœ²æ— é—äº†ï¼Ÿ</p><p>åè§‚ç¬¬äºŒä»½ä»£ç ï¼ŒfactDFå’ŒpairDFç”¨pairDF.startDate &lt; factDF.eventDate &lt;= pairDF.endDateçš„ä¸ç­‰å¼æ¡ä»¶è¿›è¡Œæ•°æ®å…³è”ã€‚åœ¨Sparkä¸­ï¼Œä¸ç­‰å¼Joinçš„å®ç°æ–¹å¼æ˜¯Nested Loop Joinã€‚å°½ç®¡Nested Loop Joinæ˜¯æ‰€æœ‰Joinå®ç°æ–¹å¼ï¼ˆMerge Joinï¼ŒHash Joinï¼ŒBroadcast Joinç­‰ï¼‰ä¸­æ€§èƒ½æœ€å·®çš„ä¸€ç§ï¼Œè€Œä¸”è¿™ç§Joinæ–¹å¼æ²¡æœ‰ä»»ä½•ä¼˜åŒ–ç©ºé—´ï¼Œä½†factDFä¸pairDFçš„æ•°æ®å…³è”åªéœ€è¦æ‰«æä¸€æ¬¡å…¨é‡æ•°æ®ï¼Œä»…è¿™ä¸€é¡¹ä¼˜åŠ¿åœ¨æ‰§è¡Œæ•ˆç‡ä¸Šå°±å¯ä»¥åŠæ‰“ç¬¬ä¸€ä»½ä»£ç å®ç°ã€‚</p><h2>å°ç»“</h2><p>ä»Šå¤©ï¼Œæˆ‘ä»¬åˆ†æäº†ä¸¤ä¸ªæ¡ˆä¾‹ï¼Œè¿™ä¸¤ä¸ªæ¡ˆä¾‹éƒ½æ¥è‡ªæ•°æ®åº”ç”¨çš„ETLåœºæ™¯ã€‚ç¬¬ä¸€ä¸ªæ¡ˆä¾‹è®²çš„æ˜¯ï¼Œåœ¨å‡½æ•°è¢«é¢‘ç¹è°ƒç”¨çš„æƒ…å†µä¸‹ï¼Œå‡½æ•°é‡Œé¢ä¸€ä¸ªç®€å•å˜é‡æ‰€å¼•å…¥çš„æ€§èƒ½å¼€é”€è¢«æˆå€åœ°æ”¾å¤§ã€‚ç¬¬äºŒä¸ªä¾‹å­è®²çš„æ˜¯ï¼Œä¸æ°å½“çš„å®ç°æ–¹å¼å¯¼è‡´æµ·é‡æ•°æ®è¢«åå¤åœ°æ‰«ææˆç™¾ä¸Šåƒæ¬¡ã€‚</p><p>é€šè¿‡å¯¹è¿™ä¸¤ä¸ªæ¡ˆä¾‹è¿›è¡Œåˆ†æå’Œæ¢è®¨ï¼Œæˆ‘ä»¬å‘ç°ï¼Œå¯¹äºSparkçš„åº”ç”¨å¼€å‘ï¼Œç»ä¸ä»…ä»…æ˜¯å®Œæˆä¸šåŠ¡åŠŸèƒ½å®ç°å°±é«˜æ•æ— å¿§äº†ã€‚<strong>Sparkå¤©ç”Ÿçš„æ‰§è¡Œæ•ˆç‡å†é«˜ï¼Œä¹Ÿéœ€è¦ä½ é’ˆå¯¹å…·ä½“çš„åº”ç”¨åœºæ™¯å’Œè¿è¡Œç¯å¢ƒè¿›è¡Œæ€§èƒ½è°ƒä¼˜</strong>ã€‚</p><p>è€Œæ€§èƒ½è°ƒä¼˜çš„æ”¶ç›Šæ˜¾è€Œæ˜“è§ï¼šä¸€æ¥å¯ä»¥èŠ‚çº¦æˆæœ¬ï¼Œå°¤å…¶æ˜¯æŒ‰éœ€ä»˜è´¹çš„äº‘ä¸Šæˆæœ¬ï¼Œæ›´çŸ­çš„æ‰§è¡Œæ—¶é—´æ„å‘³ç€æ›´å°‘çš„èŠ±é”€ï¼›äºŒæ¥å¯ä»¥æå‡å¼€å‘çš„è¿­ä»£æ•ˆç‡ï¼Œå°¤å…¶æ˜¯å¯¹äºä»äº‹æ•°æ®åˆ†æã€æ•°æ®ç§‘å­¦ã€æœºå™¨å­¦ä¹ çš„åŒå­¦æ¥è¯´ï¼Œæ›´é«˜çš„æ‰§è¡Œæ•ˆç‡å¯ä»¥æ›´å¿«åœ°è·å–æ•°æ®æ´å¯Ÿï¼Œæ›´å¿«åœ°æ‰¾åˆ°æ¨¡å‹æ”¶æ•›çš„æœ€ä¼˜è§£ã€‚å› æ­¤ä½ çœ‹ï¼Œæ€§èƒ½è°ƒä¼˜ä¸æ˜¯ä¸€ä»¶é”¦ä¸Šæ·»èŠ±çš„äº‹æƒ…ï¼Œè€Œæ˜¯å¼€å‘è€…å¿…é¡»è¦æŒæ¡çš„ä¸€é¡¹å‚èº«æŠ€èƒ½ã€‚</p><p>é‚£ä¹ˆï¼Œå¯¹äºSparkçš„æ€§èƒ½è°ƒä¼˜ï¼Œä½ å‡†å¤‡å¥½äº†å—ï¼Ÿç”Ÿæ´»ä¸æ­¢çœ¼å‰çš„è‹Ÿä¸”ï¼Œè®©æˆ‘ä»¬æ¥ä¸€åœºè¯´èµ°å°±èµ°çš„æ€§èƒ½è°ƒä¼˜ä¹‹æ—…å§ã€‚æ¥å§ï¼å¿«ä¸Šè½¦ï¼æ‰¶ç¨³åå¥½ï¼Œç³»å¥½å®‰å…¨å¸¦ï¼Œå’±ä»¬å‡†å¤‡å‘è½¦äº†ï¼</p><h2>æ¯æ—¥ä¸€ç»ƒ</h2><ol>\n<li>æ—¥å¸¸å·¥ä½œä¸­ï¼Œä½ è¿˜é‡åˆ°è¿‡å“ªäº›åŠŸèƒ½å®ç°ä¸€è‡´ã€ä½†æ€§èƒ½å¤§ç›¸å¾„åº­çš„æ¡ˆä¾‹å—ï¼Ÿ</li>\n<li>æˆ‘ä»¬ä»Šå¤©è®²çš„ç¬¬äºŒä¸ªæ¡ˆä¾‹ä¸­çš„æ­£ä¾‹ä»£ç ï¼Œä½ è§‰å¾—è¿˜æœ‰å¯èƒ½è¿›ä¸€æ­¥ä¼˜åŒ–å—ï¼Ÿ</li>\n</ol><p>æœŸå¾…åœ¨ç•™è¨€åŒºçœ‹åˆ°ä½ åˆ†äº«ï¼Œä¹Ÿæ¬¢è¿æŠŠä½ å¯¹å¼€å‘æ¡ˆä¾‹çš„æ€è€ƒå†™ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ï¼</p>","neighbors":{"left":{"article_title":"å¼€ç¯‡è¯ | Sparkæ€§èƒ½è°ƒä¼˜ï¼Œä½ è¯¥æŒæ¡è¿™äº›â€œå¥—è·¯â€","id":352065},"right":{"article_title":"02 | æ€§èƒ½è°ƒä¼˜çš„æœ¬è´¨ï¼šè°ƒä¼˜çš„æ‰‹æ®µäº”èŠ±å…«é—¨ï¼Œè¯¥ä»å“ªé‡Œå…¥æ‰‹ï¼Ÿ","id":352577}},"comments":[{"had_liked":false,"id":283519,"user_name":"Will","can_delete":false,"product_type":"c1","uid":1256770,"ip_address":"","ucode":"671FFBDF1A3E69","user_header":"https://static001.geekbang.org/account/avatar/00/13/2d/42/6e3be953.jpg","comment_is_top":false,"comment_ctime":1615806338,"is_pvip":false,"replies":[{"id":"102926","content":"æ²¡é”™ï¼ŒBroadcast joinså¯ä»¥è¿›ä¸€æ­¥æå‡æ€§èƒ½ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1615871880,"ip_address":"","comment_id":283519,"utype":1}],"discussion_count":5,"race_medal":0,"score":"66040315778","product_id":100073401,"comment_content":"ç¬¬äºŒä¸ªä¾‹å­ï¼Œå¯ä»¥åˆ©ç”¨map joinï¼Œè®©å°æ•°æ®åˆ†å‘åˆ°æ¯ä¸ªworkerä¸Šï¼Œè¿™æ ·ä¸ç”¨shuffleæ•°æ®","like_count":15,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517061,"discussion_content":"æ²¡é”™ï¼ŒBroadcast joinså¯ä»¥è¿›ä¸€æ­¥æå‡æ€§èƒ½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615871880,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2485585,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIiaeebUYxl7e4jicPshDRKMbiculHUjKgZZ2ygDibn2S7bbsjeqYIdsEUdVyoryKNa43ZGnDQmWjv3ibQ/132","nickname":"Geek_d794f8","note":"","ucode":"1E20DA4FF8B800","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":361377,"discussion_content":"å¹¿æ’­joiné»˜è®¤æ˜¯å¼€å¯çš„å§","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1616656103,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":2485585,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIiaeebUYxl7e4jicPshDRKMbiculHUjKgZZ2ygDibn2S7bbsjeqYIdsEUdVyoryKNa43ZGnDQmWjv3ibQ/132","nickname":"Geek_d794f8","note":"","ucode":"1E20DA4FF8B800","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362527,"discussion_content":"éœ€è¦é…åˆç›¸å…³çš„é…ç½®é¡¹å“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616979523,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":361377,"ip_address":""},"score":362527,"extra":""}]},{"author":{"id":1269727,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eq6dppX1EPFeNOiaYOEClwPrO71zlLoprY0YffxSIk7773sjo4CE5juo0ppIzgfJ7Y5eUbwYl1SkNg/132","nickname":"xujunwei","note":"","ucode":"E129638FD1481F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":412184,"discussion_content":"PairDF è¡¨æ¯”è¾ƒå°çš„æ—¶å€™ä¼šèµ°Broadcast nested loop join å—ï¼Ÿï¼Œåªæ˜¯åšå•çº¯çš„åšBroadcast joinæ˜¯ä¸æ˜¯ä¸èƒ½æå‡æ•ˆç‡ï¼Œæˆ‘è§‰å¾—PairDFå¾—è½¬æ¢æˆHash Join æŠŠæ—¥æœŸå±•å¼€æŠŠæ‰€æœ‰æ—¥æœŸå±•å¼€æˆï¼ˆæ—¥æœŸï¼ŒList[(å¼€å§‹æ—¥æœŸï¼Œç»“æŸæ—¥æœŸ)]ï¼‰å½¢å¼ åš ç­‰å€¼join å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–æ•ˆç‡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636096320,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2068627,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/90/93/5e94be87.jpg","nickname":"é’æ„Ÿ","note":"","ucode":"50FE1DD4EAEB78","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":403251,"discussion_content":"æ£’æ£’æ£’","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634039944,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":286138,"user_name":"FendoraèŒƒä¸œ_","can_delete":false,"product_type":"c1","uid":1187106,"ip_address":"","ucode":"63EE9DBEE08D70","user_header":"https://static001.geekbang.org/account/avatar/00/12/1d/22/f04cea4c.jpg","comment_is_top":false,"comment_ctime":1617165761,"is_pvip":false,"replies":[{"id":"103886","content":"nljæ˜¯ä¸€ç§joinå®ç°æ–¹å¼å“ˆï¼Œå’Œhash joinã€sort merge joinä¸€æ ·ï¼Œæ˜¯ä¸€ç§joinå®ç°æœºåˆ¶ã€‚cartesian joinæ˜¯ä¸€ç§joinå½¢å¼ï¼Œå’Œinnerã€leftã€rightå¯¹ç­‰ã€‚æ¯ä¸€ç§joinå½¢å¼ï¼Œéƒ½å¯ä»¥ç”¨å¤šç§å®ç°æœºåˆ¶æ¥åšã€æ¥å®ç°ï½","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1617189962,"ip_address":"","comment_id":286138,"utype":1}],"discussion_count":4,"race_medal":0,"score":"61746707905","product_id":100073401,"comment_content":"è¯·é—®ç£Šå“¥ï¼Œsparké‡Œé¢nested loop joinå’Œcartesian product jionæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ","like_count":14,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517880,"discussion_content":"nljæ˜¯ä¸€ç§joinå®ç°æ–¹å¼å“ˆï¼Œå’Œhash joinã€sort merge joinä¸€æ ·ï¼Œæ˜¯ä¸€ç§joinå®ç°æœºåˆ¶ã€‚cartesian joinæ˜¯ä¸€ç§joinå½¢å¼ï¼Œå’Œinnerã€leftã€rightå¯¹ç­‰ã€‚æ¯ä¸€ç§joinå½¢å¼ï¼Œéƒ½å¯ä»¥ç”¨å¤šç§å®ç°æœºåˆ¶æ¥åšã€æ¥å®ç°ï½","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1617189962,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1357290,"avatar":"https://static001.geekbang.org/account/avatar/00/14/b5/ea/e7d78a65.jpg","nickname":"ä¸çŠ¹è±«ï½ä¸åæ‚”","note":"","ucode":"CB9AABBC403BB1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577034,"discussion_content":"å¤šç§join(leftã€rightã€innerã€catesian)ï¼Œæ¯ç§joinéƒ½æœ‰å¤šç§å®ç°æœºåˆ¶(nestã€hashã€sort merge)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655896160,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2068627,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/90/93/5e94be87.jpg","nickname":"é’æ„Ÿ","note":"","ucode":"50FE1DD4EAEB78","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":403254,"discussion_content":"ç®€æ´ç²¾è¾Ÿï¼Œæˆ‘è¦å»æŸ¥ä¸€ä¸‹è¿™å‡ ç§Joinçš„å®ç°æœºåˆ¶äº†ï¼Œè¿˜æ²¡æœ‰å­¦ä¹ è¿‡ï¼ŒåŠ æ²¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634040337,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1187106,"avatar":"https://static001.geekbang.org/account/avatar/00/12/1d/22/f04cea4c.jpg","nickname":"FendoraèŒƒä¸œ_","note":"","ucode":"63EE9DBEE08D70","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":363562,"discussion_content":"joinå½¢å¼å¯¹åº”å¤šç§joinå®ç°æ–¹å¼ï¼ŒğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617237774,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":290900,"user_name":"aof","can_delete":false,"product_type":"c1","uid":1062864,"ip_address":"","ucode":"5815D63C4926BC","user_header":"https://static001.geekbang.org/account/avatar/00/10/37/d0/26975fba.jpg","comment_is_top":false,"comment_ctime":1619842707,"is_pvip":false,"replies":[{"id":"105410","content":"èµğŸ‘ï¼Œæ»¡åˆ†ğŸ’¯ï¼Œæ— å¯æŒ‘å‰”~<br><br>","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1619860714,"ip_address":"","comment_id":290900,"utype":1}],"discussion_count":2,"race_medal":0,"score":"48864482963","product_id":100073401,"comment_content":"1. å…¶å®æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ç”¨foreachç®—å­å°†æ•°æ®å†™å…¥åˆ°å¤–éƒ¨æ•°æ®åº“ï¼Œå¯¼è‡´æ¯æ¡æ•°æ®çš„å†™å…¥éƒ½ä¼šå»ºç«‹è¿æ¥ï¼Œå¦å¤–å•æ¡å†™å…¥ä¹Ÿæ¯”æ‰¹é‡å†™å…¥çš„æ€§èƒ½å·®å¾ˆå¤šã€‚å»ºè®®ä½¿ç”¨foreachPartition()ï¼Œæ¯ä¸ªåˆ†åŒºå»ºç«‹ä¸€ä¸ªè¿æ¥ï¼ŒåŒæ—¶å¯ä»¥æ‰¹é‡å†™å…¥ï¼Œæ€§èƒ½ä¼šå¥½å¾ˆå¤šã€‚<br>2. ä¸€èˆ¬æ¥è®²ï¼Œå°è¡¨ä¸å¤§è¡¨çš„å…³è”æ“ä½œï¼Œé¦–å…ˆè¦è€ƒè™‘Broadcast Join<br><br><br>å¦å¤–ï¼Œå…³äºNested Loop Joinçš„åŸç†ï¼šhttps:&#47;&#47;www.geeksforgeeks.org&#47;join-algorithms-in-database&#47;amp&#47;<br>","like_count":11,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519315,"discussion_content":"èµğŸ‘ï¼Œæ»¡åˆ†ğŸ’¯ï¼Œæ— å¯æŒ‘å‰”~\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619860714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1476427,"avatar":"https://static001.geekbang.org/account/avatar/00/16/87/4b/16ea3997.jpg","nickname":"tiankonghewo","note":"","ucode":"7A55A9C17DD9DF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":532021,"discussion_content":"å…³äºNested Loop Joinçš„åŸç†,èµ„æ–™å¾ˆèµ,å­¦ä¹ äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637501656,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":283804,"user_name":"TaoInsight","can_delete":false,"product_type":"c1","uid":1318272,"ip_address":"","ucode":"81A31DD9630FEC","user_header":"https://static001.geekbang.org/account/avatar/00/14/1d/80/59f1886d.jpg","comment_is_top":false,"comment_ctime":1615943554,"is_pvip":false,"replies":[{"id":"102969","content":"è¿™å—èƒ½å±•å¼€è¯´è¯´å—ï¼Ÿå…·ä½“æ€ä¹ˆè½¬åŒ–ä¸ºç­‰å€¼joinï¼Ÿå¯ä»¥ä¸¾ä¸ªä¾‹å­å“ˆï½","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1615958654,"ip_address":"","comment_id":283804,"utype":1}],"discussion_count":6,"race_medal":0,"score":"35975681922","product_id":100073401,"comment_content":"å¦‚æœpaiâ€†rDFçš„startDateå’ŒendDateèŒƒå›´æœ‰é™ï¼Œå¯ä»¥æŠŠæ—¥æœŸèŒƒå›´å±•å¼€ï¼Œå°†éç­‰å€¼joinè½¬æˆç­‰å€¼join","like_count":8,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517152,"discussion_content":"è¿™å—èƒ½å±•å¼€è¯´è¯´å—ï¼Ÿå…·ä½“æ€ä¹ˆè½¬åŒ–ä¸ºç­‰å€¼joinï¼Ÿå¯ä»¥ä¸¾ä¸ªä¾‹å­å“ˆï½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615958654,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1318272,"avatar":"https://static001.geekbang.org/account/avatar/00/14/1d/80/59f1886d.jpg","nickname":"TaoInsight","note":"","ucode":"81A31DD9630FEC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":358318,"discussion_content":"ä»¥æ–‡ä¸­çš„ä¾‹å­ï¼Œå¦‚æœpairDFçš„ä¸€æ¡è®°å½•æ˜¯(startDate, endDate) = (&#34;2021-01-01&#34;, &#34;2021-01-31&#34;)ï¼Œexplodeæˆ31æ¡ï¼Œ(startDate, endDate, eventDate) = (&#34;2021-01-01&#34;, &#34;2021-01-31&#34;), &#34;2021-01-01&#34;),(&#34;2021-01-01&#34;, &#34;2021-01-31&#34;, &#34;2021-01-02&#34;), ... ,(&#34;2021-01-01&#34;, &#34;2021-01-31&#34;, &#34;2021-01-31&#34;), è¿™æ ·å°±å¯ä»¥åŸºäºeventDateå­—æ®µè¿›è¡Œç­‰å€¼å…³è”ã€‚\næ•°æ®ä¼šæœ‰Nå€çš„è†¨èƒ€ï¼Œä¸è¿‡åªè¦Nä¸å¤ªå¤§ï¼Œä¹Ÿå¯ä»¥è¿™ä¹ˆæ","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1615964176,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1029952,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b7/40/979af7cc.jpg","nickname":"æ•¬å½¦è¾‰","note":"","ucode":"99C18D514673FE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1318272,"avatar":"https://static001.geekbang.org/account/avatar/00/14/1d/80/59f1886d.jpg","nickname":"TaoInsight","note":"","ucode":"81A31DD9630FEC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":379522,"discussion_content":"è¿™ä¸ªæ€è·¯å¾ˆç»™åŠ›å“ˆï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623939308,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":358318,"ip_address":""},"score":379522,"extra":""}]},{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":358805,"discussion_content":"éå¸¸å¥½çš„æ€è·¯ï¼è¿™ä¸ªæ˜¯æˆ‘ä¹‹å‰æ²¡æœ‰æƒ³åˆ°çš„ï¼Œèµ~ Nå…¶å®è¿˜å¥½ï¼ŒpairDFå°±ç®—è†¨èƒ€ä¸ª100å€ï¼Œä¹Ÿèƒ½å¡è¿›å¹¿æ’­å˜é‡ï¼Œç”¨Broadcast joinsåšç­‰å€¼joinï¼Œåº”è¯¥æ˜¯è¿™ä¸ªåœºæ™¯æœ€ä½³çš„è§£å†³æ–¹æ¡ˆäº†ã€‚èµï¼ğŸ‘ åé¢æˆ‘ä¼šæ•´ç†å¤§å®¶çš„å›ç­”ï¼ŒæŠŠä¸€äº›å¥½çš„æ€è·¯æ•´ç†è¿›å»ï¼Œä½ çš„è¿™ä¸ªæƒ³æ³•è‚¯å®šç®—ä¸€ä¸ª~","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1616053094,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1030156,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM7BDPIqkNsYm2ibVUkhIAuniaBOcRIiaroNsKT7YasCRGkVxbba5gsZccBRkGs1rlXRJScvDMebqcSGw/132","nickname":"ä¸ç®—å¸…","note":"","ucode":"1907C992E4DF30","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558187,"discussion_content":"ç­‰å€¼å…³è”å’Œéç­‰å€¼å…³è”æ€§èƒ½ä¸Šæœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Ÿ\næ˜¯å¦åƒMySQLé‚£æ ·å­˜åœ¨ç´¢å¼•ä¸€è¯´ï¼Ÿ\næŒ‰ç…§æˆ‘ä¸ªäººç†è§£ï¼Œè¿™ä¸¤ç§ä¸éƒ½æ˜¯å…¨è¡¨æ‰«æå—ï¼Œä»æ‰§è¡Œé‡ä¸Šï¼Œéç­‰å€¼è¡¨è¾¾å¼åªæ˜¯æ¯”ç­‰å€¼è¡¨è¾¾å¼å¤šäº†ä¸€æ¡æ‰§è¡Œè¯­å¥çš„æ€§èƒ½æ¶ˆè€—ã€‚ç›¸æ¯”è¾ƒæ¥¼ä¸»çš„æ–¹æ¡ˆè¿˜æœ‰æ•°æ®é‡è†¨èƒ€é—®é¢˜å‘¢ã€‚\n\næ˜¯ä¸æ˜¯å¯ä»¥è¿™ä¹ˆè§£é‡Šï¼Œç­‰å€¼JOINæ“ä½œå®é™…ä¸Šæ˜¯å°†å°è¡¨å˜æˆMapæ•°æ®ç»“æ„ï¼Œå¹¿æ’­åˆ°å…¶ä»–executorsï¼Œç­‰å€¼æŸ¥è¯¢æ˜¯è¿‘ä¼¼O(1)çš„æ“ä½œã€‚\néç­‰å€¼æŸ¥è¯¢å› ä¸ºéœ€è¦ä¼ å…¥æ¯”è¾ƒå‚æ•°ï¼Œæ— æ³•æ˜ å°„æˆMap,æ—¶é—´å¤æ‚åº¦æ˜¯O(å°N)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648123664,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":358806,"discussion_content":"å¤šå¤šå‚ä¸åç»­è¯¾ç¨‹çš„è®¨è®ºå“ˆ~\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616053130,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":298047,"user_name":"æ…¢æ…¢å¢","can_delete":false,"product_type":"c1","uid":1329566,"ip_address":"","ucode":"853D399100D83B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/IcDlyK6DaBrssVGlmosXnahdJ4bwCesjXa98iaapSDozBiagZTqSCok6iaktu2wOibvpNv9Pd6nfwMg7N7KTSTzYRw/132","comment_is_top":false,"comment_ctime":1623896604,"is_pvip":false,"replies":[{"id":"108256","content":"ç©ºtask~ å…¶å®è¿™ä¸ªå¥½ç†è§£ï¼Œæ¯”å¦‚ä½ å¯¹åŸå§‹æ•°æ®é›†åšè¿‡æ»¤ï¼ŒåŸæ¥çš„æ•°æ®æœ‰1ä¸‡æ¡ï¼Œè¿‡æ»¤ä¹‹å1æ¡ï¼Œä½†æ˜¯filterä¼šç»§æ‰¿ä¹‹å‰çš„partitionerï¼Œä¹Ÿå°±æ˜¯åˆ†åŒºå’Œä¹‹å‰æ˜¯ä¸€æ ·çš„ï¼Œä½†å…¶å®å¾ˆå¤šåˆ†åŒºä¸­éƒ½æ²¡æœ‰æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ç©ºtaskã€‚ä½ è¿™ä¸ªä¾‹å­ä¹Ÿä¸€æ ·ï¼Œå¹¶è¡Œåº¦æ˜¯200ï¼Œå®é™…ä¸Šå°±æ˜¯reducerçš„partitionerä¼šåˆ’åˆ†å‡º200çš„åˆ†åŒºï¼Œpartitioneræ˜¯å›ºå®šçš„ï¼Œåˆ†åŒºæ˜¯ä¸€å®šè¦åˆ’å‡ºæ¥çš„ï¼Œä½†æ˜¯å®é™…ä¸Šæ•°æ®åªæœ‰ä¸€æ¡ï¼Œå…¶ä»–çš„éƒ½æ˜¯ç©ºtaskï¼Œç™½ç™½æµªè´¹è°ƒåº¦èµ„æºã€‚<br><br>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆCoalesceä¹‹åï¼Œè¦åšfilterï¼Œä»¥åŠä¸ºä»€ä¹ˆAQEè¦åšè‡ªåŠ¨åˆ†åŒºåˆå¹¶ï¼Œé“ç†å…¶å®éƒ½ä¸€æ ·ï¼Œéƒ½æ˜¯ä¸ºäº†é¿å…ç©ºtaskç™½ç™½æµªè´¹å®è´µçš„CPUèµ„æºã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1624009734,"ip_address":"","comment_id":298047,"utype":1}],"discussion_count":3,"race_medal":0,"score":"18803765788","product_id":100073401,"comment_content":"è€å¸ˆï¼Œæˆ‘æŠŠç¬¬äºŒä¸ªä¾‹å­è‡ªå·±è¯•äº†ä¸€éï¼Œæœ‰ä¸ªé—®é¢˜ä¸ç†è§£ï¼šä¸¤ä¸ªdféƒ½åªæœ‰ä¸€æ¡æ•°æ®ï¼Œsparkuiä¸Šç¬¬äºŒä¸ªstageæœ‰200ä¸ªtaskï¼Œä¸ºä»€ä¹ˆshuffleä¹‹åçš„stageçš„taskæœ‰200ä¸ªï¼Œè™½ç„¶è¯´shuffleä¹‹åreduceé»˜è®¤å¹¶è¡Œåº¦æ˜¯200ï¼Œä½†æˆ‘åªæœ‰ä¸€æ¡æ•°æ®ï¼Œå®é™…ä¸Šåªéœ€è¦ä¸€ä¸ªtaskå•Šï¼Œå…¶ä»–çš„taskæ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521999,"discussion_content":"ç©ºtask~ å…¶å®è¿™ä¸ªå¥½ç†è§£ï¼Œæ¯”å¦‚ä½ å¯¹åŸå§‹æ•°æ®é›†åšè¿‡æ»¤ï¼ŒåŸæ¥çš„æ•°æ®æœ‰1ä¸‡æ¡ï¼Œè¿‡æ»¤ä¹‹å1æ¡ï¼Œä½†æ˜¯filterä¼šç»§æ‰¿ä¹‹å‰çš„partitionerï¼Œä¹Ÿå°±æ˜¯åˆ†åŒºå’Œä¹‹å‰æ˜¯ä¸€æ ·çš„ï¼Œä½†å…¶å®å¾ˆå¤šåˆ†åŒºä¸­éƒ½æ²¡æœ‰æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ç©ºtaskã€‚ä½ è¿™ä¸ªä¾‹å­ä¹Ÿä¸€æ ·ï¼Œå¹¶è¡Œåº¦æ˜¯200ï¼Œå®é™…ä¸Šå°±æ˜¯reducerçš„partitionerä¼šåˆ’åˆ†å‡º200çš„åˆ†åŒºï¼Œpartitioneræ˜¯å›ºå®šçš„ï¼Œåˆ†åŒºæ˜¯ä¸€å®šè¦åˆ’å‡ºæ¥çš„ï¼Œä½†æ˜¯å®é™…ä¸Šæ•°æ®åªæœ‰ä¸€æ¡ï¼Œå…¶ä»–çš„éƒ½æ˜¯ç©ºtaskï¼Œç™½ç™½æµªè´¹è°ƒåº¦èµ„æºã€‚\n\nè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆCoalesceä¹‹åï¼Œè¦åšfilterï¼Œä»¥åŠä¸ºä»€ä¹ˆAQEè¦åšè‡ªåŠ¨åˆ†åŒºåˆå¹¶ï¼Œé“ç†å…¶å®éƒ½ä¸€æ ·ï¼Œéƒ½æ˜¯ä¸ºäº†é¿å…ç©ºtaskç™½ç™½æµªè´¹å®è´µçš„CPUèµ„æºã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624009734,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2162751,"avatar":"https://static001.geekbang.org/account/avatar/00/21/00/3f/a0f84788.jpg","nickname":"Sean","note":"","ucode":"69234046BFD81B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387773,"discussion_content":"ç†è§£é€šå¸¸æˆ‘ä»¬åœ¨filterä¹‹åè¦è¿›è¡Œcoalesceç¼©å‡åˆ†åŒº,è€å¸ˆè¯´coalesceä¹‹ååšfilteræå‰æ”¶ç¼©èµ„æºåœ¨å¤„ç†æ•°æ®ä¼šä¸ä¼šä¹Ÿä¸å¤ªåˆç†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628408027,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":2162751,"avatar":"https://static001.geekbang.org/account/avatar/00/21/00/3f/a0f84788.jpg","nickname":"Sean","note":"","ucode":"69234046BFD81B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":404356,"discussion_content":"è¯´çš„å¯¹ï¼Œæˆ‘è¿™é‡Œå†™åäº†ï¼Œåº”è¯¥æ˜¯å…ˆfilterï¼Œåcoalesceï¼Œä¼°è®¡å½“æ—¶è„‘å­æ‡µï¼Œå†™åäº†ï¼Œå“ˆå“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634292674,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":387773,"ip_address":""},"score":404356,"extra":""}]}]},{"had_liked":false,"id":283605,"user_name":"è‘›è‚","can_delete":false,"product_type":"c1","uid":1008349,"ip_address":"","ucode":"2771A5888FCBE0","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/6uQj0EmXTGstVxNicLWqJhGvY0tavWvxK5RwgxjaMK1rNB9Rf7kAdnzBnG7YOicHjTibOf6G6HEFwonRFXDN3Pp8A/132","comment_is_top":false,"comment_ctime":1615855078,"is_pvip":false,"replies":[{"id":"102925","content":"å¥½é—®é¢˜ï¼Œå…¶å®æ”¹åŠ¨éå¸¸å°ï¼Œå¼€é”€ç›¸æ¯”æ­£ä¾‹ä¹Ÿä¸å¤§ï¼Œä½†è¿™é‡Œçš„å…³é”®åœ¨äºï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¢«ååå¤å¤è°ƒç”¨ä¸Šç™¾æ¬¡ï¼Œç´¯ç§¯ä¸‹æ¥ï¼Œå¼€é”€å°±ä¸Šå»äº†ã€‚æ‰€ä»¥ï¼Œå…³é”®ä¸åœ¨äºç‚¹å°ä¸å°ï¼Œè€Œæ˜¯è¿™ä¸ªç‚¹ï¼Œæ˜¯ä¸æ˜¯ç“¶é¢ˆã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1615871596,"ip_address":"","comment_id":283605,"utype":1}],"discussion_count":3,"race_medal":0,"score":"18795724262","product_id":100073401,"comment_content":"Case 1ä¸ºä»€ä¹ˆæ€§èƒ½å·®ä¸€å€å‘¢","like_count":4,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517090,"discussion_content":"å¥½é—®é¢˜ï¼Œå…¶å®æ”¹åŠ¨éå¸¸å°ï¼Œå¼€é”€ç›¸æ¯”æ­£ä¾‹ä¹Ÿä¸å¤§ï¼Œä½†è¿™é‡Œçš„å…³é”®åœ¨äºï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¢«ååå¤å¤è°ƒç”¨ä¸Šç™¾æ¬¡ï¼Œç´¯ç§¯ä¸‹æ¥ï¼Œå¼€é”€å°±ä¸Šå»äº†ã€‚æ‰€ä»¥ï¼Œå…³é”®ä¸åœ¨äºç‚¹å°ä¸å°ï¼Œè€Œæ˜¯è¿™ä¸ªç‚¹ï¼Œæ˜¯ä¸æ˜¯ç“¶é¢ˆã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615871596,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2010843,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoG8k56TKsdCmVletmYKYwibickH5Ced8UyxicpY9icZEM2ZTcqyUaEk2PRmH1FVLtGTggw/132","nickname":"orangelin","note":"","ucode":"730CC9997C16F2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":360138,"discussion_content":"æˆ‘è¿™é‡Œçš„ç†è§£æ˜¯ pairDFå®é™…ä¸Šåªäº§ç”Ÿäº†ä¸€ä¸ªjobï¼Œä½†æ˜¯ä»–çš„éå†é‡Œè°ƒç”¨äº†createå‡½æ•°ï¼Œè€Œè¯¥å‡½æ•°åˆè°ƒç”¨äº†factDFï¼Œåœ¨æ²¡æœ‰åšç¼“å­˜çš„æƒ…å†µä¸‹ï¼ŒparDFçš„æ¯æ¡æ•°æ®å¯¹äºDAGæ¥è¯´éƒ½éœ€è¦é‡æ–°è·å–factDF,å‡è®¾pariDFæœ‰1000æ¡è®°å½•ï¼Œé‚£ä¹ˆæ¯ä¸€æ¡è®°å½•éƒ½éœ€è¦ä¸€ä¸ªjobæ¥ç”ŸæˆfactDFï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616377959,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":2010843,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoG8k56TKsdCmVletmYKYwibickH5Ced8UyxicpY9icZEM2ZTcqyUaEk2PRmH1FVLtGTggw/132","nickname":"orangelin","note":"","ucode":"730CC9997C16F2","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":362531,"discussion_content":"æ²¡é”™ï¼Œè§‚å¯Ÿçš„å¾ˆä»”ç»†ï¼Œç¬¬ä¸€ç‰ˆçš„å®ç°å°±ä¼šåƒä½ è¯´çš„ï¼Œæ¯æ¡éƒ½triggerä¸€æ¬¡action","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616979646,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":360138,"ip_address":""},"score":362531,"extra":""}]}]},{"had_liked":false,"id":284697,"user_name":"Elon","can_delete":false,"product_type":"c1","uid":1004727,"ip_address":"","ucode":"DB5BE4DA9A1690","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/b7/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1616419708,"is_pvip":false,"replies":[{"id":"103286","content":"æ˜¯çš„ï¼Œä½ è¯´çš„æ²¡é”™ã€‚å‡½æ•°çš„å‰¯ä½œç”¨æŒ‡çš„æ˜¯å¯¹å¤–éƒ¨å˜é‡ã€å¤–éƒ¨ç¯å¢ƒçš„å½±å“ï¼Œå†…éƒ¨çŠ¶æ€çš„æ”¹å˜å’Œè½¬æ¢ä¸ç®—ã€‚æ–‡ä¸­è¿™å—è¡¨è¿°çš„ä¸ä¸¥è°¨å“ˆï¼Œè¿™é‡Œä¸»è¦æ˜¯æƒ³å¼ºè°ƒå¯å˜å˜é‡fieldså¸¦æ¥çš„è®¡ç®—å¼€é”€ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1616456083,"ip_address":"","comment_id":284697,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14501321596","product_id":100073401,"comment_content":"å‡½æ•°å¼çš„å‰¯ä½œç”¨æŒ‡çš„æ˜¯ä¸ä¿®æ”¹å…¥å‚å§ï¼Ÿåœ¨å‡½æ•°å†…éƒ¨æ˜¯å¯ä»¥å®šä¹‰å˜é‡ã€ä¿®æ”¹å˜é‡çš„ã€‚å› æ­¤fieldså˜é‡åœ¨å‡½æ•°å†…éƒ¨ï¼Œåº”è¯¥ä¸ç®—å‰¯ä½œç”¨å§ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517435,"discussion_content":"æ˜¯çš„ï¼Œä½ è¯´çš„æ²¡é”™ã€‚å‡½æ•°çš„å‰¯ä½œç”¨æŒ‡çš„æ˜¯å¯¹å¤–éƒ¨å˜é‡ã€å¤–éƒ¨ç¯å¢ƒçš„å½±å“ï¼Œå†…éƒ¨çŠ¶æ€çš„æ”¹å˜å’Œè½¬æ¢ä¸ç®—ã€‚æ–‡ä¸­è¿™å—è¡¨è¿°çš„ä¸ä¸¥è°¨å“ˆï¼Œè¿™é‡Œä¸»è¦æ˜¯æƒ³å¼ºè°ƒå¯å˜å˜é‡fieldså¸¦æ¥çš„è®¡ç®—å¼€é”€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616456083,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":284021,"user_name":"fsc2016","can_delete":false,"product_type":"c1","uid":1255585,"ip_address":"","ucode":"5480F05703A974","user_header":"https://static001.geekbang.org/account/avatar/00/13/28/a1/fd2bfc25.jpg","comment_is_top":false,"comment_ctime":1616038643,"is_pvip":false,"replies":[{"id":"103038","content":"å¯ä»¥ï¼Œæ²¡é—®é¢˜ï¼Œæ¥è§¦è¿‡Sparkå°±è¡Œã€‚æ”¾å¿ƒå§ï¼ŒåŸç†éƒ¨åˆ†ä¼šæœ‰å¤§é‡çš„ç”Ÿæ´»åŒ–ç±»æ¯”å’Œæ•…äº‹ï¼Œå°½å¯èƒ½åœ°è®©ä½ â€œè¾¹ç©è¾¹å­¦â€ã€‚å¦å¤–ï¼Œå’±ä»¬æœ‰å¾®ä¿¡ç¾¤ï¼Œæœ‰é—®é¢˜å¯ä»¥éšæ—¶æ¢è®¨ï½","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1616051117,"ip_address":"","comment_id":284021,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14500940531","product_id":100073401,"comment_content":"è¯·é—®è€å¸ˆï¼Œè¿™ä¸ªè¯¾ç¨‹éœ€è¦å“ªäº›åŸºç¡€ï¼Œæˆ‘å¹³æ—¶ä½¿ç”¨è¿‡pysaprk åšè¿‡ä¸€äº›æœºå™¨å­¦ä¹ ç›¸å…³æ•°æ®å¤„ç†ç»ƒä¹ ï¼Œå¯¹äºæˆ‘è¿™ç§ä½¿ç”¨sparkä¸å¤šçš„ï¼Œå¯ä»¥æ¶ˆåŒ–å¸æ”¶å˜›","like_count":3,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517205,"discussion_content":"å¯ä»¥ï¼Œæ²¡é—®é¢˜ï¼Œæ¥è§¦è¿‡Sparkå°±è¡Œã€‚æ”¾å¿ƒå§ï¼ŒåŸç†éƒ¨åˆ†ä¼šæœ‰å¤§é‡çš„ç”Ÿæ´»åŒ–ç±»æ¯”å’Œæ•…äº‹ï¼Œå°½å¯èƒ½åœ°è®©ä½ â€œè¾¹ç©è¾¹å­¦â€ã€‚å¦å¤–ï¼Œå’±ä»¬æœ‰å¾®ä¿¡ç¾¤ï¼Œæœ‰é—®é¢˜å¯ä»¥éšæ—¶æ¢è®¨ï½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616051117,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":315401,"user_name":"æµ©ç„¶","can_delete":false,"product_type":"c1","uid":1805991,"ip_address":"","ucode":"1F2FC08382D396","user_header":"https://static001.geekbang.org/account/avatar/00/1b/8e/a7/92d1b90e.jpg","comment_is_top":false,"comment_ctime":1633881616,"is_pvip":false,"replies":[{"id":"114409","content":"ç²¾è¾Ÿï¼æ»¡åˆ†ğŸ’¯ï¼Œä¸€é’ˆè§è¡€","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1633961985,"ip_address":"","comment_id":315401,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10223816208","product_id":100073401,"comment_content":"ç®€å•å•Šã€‚é‚£ä¸ªæ—¶é—´åŒºé—´çš„ï¼Œç½—åˆ—å‡ºæ¥ï¼Œå¹¿æ’­ä¸€ä¸‹å°±å®Œäº‹äº†ã€‚ä»nest loopåˆ°hash joinçš„è·¨è¶Šã€‚<br>æˆ‘ä¹‹å‰åšOracleä¼˜åŒ–çš„ï¼Œæ‰€ä»¥ç¬¬ä¸€ååº”æ˜¯å“ˆå¸Œjoinï¼Œç¬¬äºŒååº”æ˜¯ä¸ç­‰å€¼åˆ°ç­‰å€¼ã€‚","like_count":2,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527953,"discussion_content":"ç²¾è¾Ÿï¼æ»¡åˆ†ğŸ’¯ï¼Œä¸€é’ˆè§è¡€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633961985,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":283544,"user_name":"å¯¹æ–¹æ­£åœ¨è¾“å…¥ã€‚ã€‚ã€‚","can_delete":false,"product_type":"c1","uid":1179298,"ip_address":"","ucode":"7B0DEB4D9B43D2","user_header":"https://static001.geekbang.org/account/avatar/00/11/fe/a2/5252a278.jpg","comment_is_top":false,"comment_ctime":1615813246,"is_pvip":false,"replies":[{"id":"102928","content":"å¹¿æ’­çš„æ€è·¯å¾ˆèµã€‚ä¸è¿‡äºŒåˆ†æŸ¥æ‰¾è¿™é‡Œå€¼å¾—å•†æ¦·å“ˆï¼Œå’±ä»¬ç›®çš„æ˜¯è¿‡æ»¤å‡ºæ»¡è¶³æ¡ä»¶çš„event dateï¼Œç„¶åå’Œå…¶ä»–ç»´åº¦ä¸€èµ·ã€åˆ†ç»„èšåˆã€‚è¿™é‡Œå…³é”®ä¸åœ¨äºè¿‡æ»¤å’ŒæŸ¥æ‰¾æ•ˆç‡ï¼Œå…³é”®åœ¨äºå¤§è¡¨çš„é‡å¤æ‰«æï¼Œåªè¦è§£å†³è¿™ä¸ªæ ¸å¿ƒç—›ç‚¹ï¼Œæ€§èƒ½é—®é¢˜å°±è¿åˆƒè€Œè§£ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1615873831,"ip_address":"","comment_id":283544,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10205747838","product_id":100073401,"comment_content":"å¯ä»¥å…ˆå°†pairdf collectåˆ°driverï¼Œå†å°†æ•°ç»„æŒ‰ç…§startdateæ’åºï¼Œç„¶åå†å°†å…¶å¹¿æ’­ã€‚ç„¶ååœ¨factdf.mapé‡Œé¢å®ç°ä¸€ä¸ªæ–¹æ³•æ¥ä»å¹¿æ’­çš„æ•°ç»„é‡Œé¢äºŒåˆ†æŸ¥æ‰¾åˆ°eventdateæ‰€å±çš„æ—¶é—´å¯¹å­ã€‚æœ€åå°±å¯ä»¥æ ¹æ®è¿™ä¸ªæ—¶é—´å¯¹å­ä»¥åŠå…¶ä»–çš„ç»´åº¦å±æ€§è¿›è¡Œåˆ†ç»„èšåˆäº†","like_count":2,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517068,"discussion_content":"å¹¿æ’­çš„æ€è·¯å¾ˆèµã€‚ä¸è¿‡äºŒåˆ†æŸ¥æ‰¾è¿™é‡Œå€¼å¾—å•†æ¦·å“ˆï¼Œå’±ä»¬ç›®çš„æ˜¯è¿‡æ»¤å‡ºæ»¡è¶³æ¡ä»¶çš„event dateï¼Œç„¶åå’Œå…¶ä»–ç»´åº¦ä¸€èµ·ã€åˆ†ç»„èšåˆã€‚è¿™é‡Œå…³é”®ä¸åœ¨äºè¿‡æ»¤å’ŒæŸ¥æ‰¾æ•ˆç‡ï¼Œå…³é”®åœ¨äºå¤§è¡¨çš„é‡å¤æ‰«æï¼Œåªè¦è§£å†³è¿™ä¸ªæ ¸å¿ƒç—›ç‚¹ï¼Œæ€§èƒ½é—®é¢˜å°±è¿åˆƒè€Œè§£ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615873831,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1184678,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJDgV2qia6eAL7Fb4egX3odViclRRwOlkfCBrjhU9lLeib90KGkIDjdddSibNVs47N90L36Brgnr6ppiag/132","nickname":"ddww","note":"","ucode":"2871112FC9B3F7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390486,"discussion_content":"æˆ‘è§‰å¾—è€é“ï¼Œæ²¡æ¯›ç—…ï¼Œå°†å°è¡¨ï¼Œç¬¬ä¸€æ­¥:åŠ å…¥åˆ°å¹¿æ’­å˜é‡ã€‚ç¬¬äºŒæ­¥:ä¹‹åå†æä¾›ä¸€ä¸ªæŸ¥æ‰¾ç®—æ³•ï¼Œè¿™ä¸å°±è¿›è¡Œäº†è¿‡æ»¤æ“ä½œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629860027,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":283526,"user_name":"Geek_92df49","can_delete":false,"product_type":"c1","uid":2284073,"ip_address":"","ucode":"F8AC23800BC89C","user_header":"","comment_is_top":false,"comment_ctime":1615807598,"is_pvip":false,"replies":[{"id":"102929","content":"å…„å¼Ÿæˆ‘æ˜¯ä½œè€…å“ˆï¼Œä½ è¯´çš„æ²¡é”™ï¼Œåˆ†ç»„åªéœ€è¦å‰4ä¸ªå­—æ®µï¼Œä½†æ˜¯ä½ çœ‹æœ€åï¼Œinstances.write.partitionBy(&quot;endDate&quot;, &quot;startDate&quot;).parquet(rootPath)ï¼Œéœ€è¦ç”¨å¼€å§‹å’Œç»“æŸæ—¶é—´è¿™ä¸¤ä¸ªå­—æ®µå»åšåˆ†åŒºå­˜å‚¨ï¼Œå› æ­¤ï¼Œåœ¨å‰ä¸€æ­¥åˆ†ç»„çš„æ—¶å€™ï¼ŒæŠŠè¿™ä¸¤ä¸ªå­—æ®µä¿ç•™äº†ä¸‹æ¥ã€‚","user_name":"ç¼–è¾‘å›å¤","user_name_real":"ç‹è¹","uid":"1743279","ctime":1615875809,"ip_address":"","comment_id":283526,"utype":2}],"discussion_count":10,"race_medal":0,"score":"10205742190","product_id":100073401,"comment_content":"å››ä¸ªç»´åº¦åˆ†ç»„ä¸ºä»€ä¹ˆè¦åŠ ä¸Šå¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´ï¼Ÿ<br>.groupBy(&quot;dim1&quot;, &quot;dim2&quot;, &quot;dim3&quot;, &quot;event_date&quot;, &quot;startDate&quot;, &quot;endDate&quot;)","like_count":2,"discussions":[{"author":{"id":1743279,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/99/af/e4cc7374.jpg","nickname":"å•Šå‘œ","note":"","ucode":"76E24AB808868D","race_medal":0,"user_type":4,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517064,"discussion_content":"å…„å¼Ÿæˆ‘æ˜¯ä½œè€…å“ˆï¼Œä½ è¯´çš„æ²¡é”™ï¼Œåˆ†ç»„åªéœ€è¦å‰4ä¸ªå­—æ®µï¼Œä½†æ˜¯ä½ çœ‹æœ€åï¼Œinstances.write.partitionBy(&amp;quot;endDate&amp;quot;, &amp;quot;startDate&amp;quot;).parquet(rootPath)ï¼Œéœ€è¦ç”¨å¼€å§‹å’Œç»“æŸæ—¶é—´è¿™ä¸¤ä¸ªå­—æ®µå»åšåˆ†åŒºå­˜å‚¨ï¼Œå› æ­¤ï¼Œåœ¨å‰ä¸€æ­¥åˆ†ç»„çš„æ—¶å€™ï¼ŒæŠŠè¿™ä¸¤ä¸ªå­—æ®µä¿ç•™äº†ä¸‹æ¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615875809,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1460463,"avatar":"https://static001.geekbang.org/account/avatar/00/16/48/ef/4750cb14.jpg","nickname":"ğŸš¤","note":"","ucode":"95D7F773789B74","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":357828,"discussion_content":"group byä¸åŠ ä¸Š &#34;startDate&#34;, &#34;endDate&#34;,æœ€åå†™æ•°æ®çš„æ—¶å€™ä¸èƒ½æŒ‰ç…§è¿™ä¸¤ä¸ªå­—æ®µåˆ†åŒº","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1615876597,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":1460463,"avatar":"https://static001.geekbang.org/account/avatar/00/16/48/ef/4750cb14.jpg","nickname":"ğŸš¤","note":"","ucode":"95D7F773789B74","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":357860,"discussion_content":"æ­£è§£~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615883821,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":357828,"ip_address":""},"score":357860,"extra":""}]},{"author":{"id":1370659,"avatar":"https://static001.geekbang.org/account/avatar/00/14/ea/23/508f71e3.jpg","nickname":"Jefitar","note":"","ucode":"D7ED9F32ADA5B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":357897,"discussion_content":"è€å¸ˆï¼Œè¯¾ç¨‹å‡ å¤©ä¸€æ›´å•Šï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615891684,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":1370659,"avatar":"https://static001.geekbang.org/account/avatar/00/14/ea/23/508f71e3.jpg","nickname":"Jefitar","note":"","ucode":"D7ED9F32ADA5B1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":358021,"discussion_content":"æ¯å‘¨ä¸€ã€ä¸‰ã€äº”æ›´æ–°å“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615904610,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":357897,"ip_address":""},"score":358021,"extra":""}]},{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":357824,"discussion_content":"å…„å¼Ÿæˆ‘æ˜¯ä½œè€…å“ˆï¼Œä½ è¯´çš„æ²¡é”™ï¼Œåˆ†ç»„åªéœ€è¦å‰4ä¸ªå­—æ®µï¼Œä½†æ˜¯ä½ çœ‹æœ€åï¼Œinstances.write.partitionBy(&#34;endDate&#34;, &#34;startDate&#34;).parquet(rootPath)ï¼Œéœ€è¦ç”¨å¼€å§‹å’Œç»“æŸæ—¶é—´è¿™ä¸¤ä¸ªå­—æ®µå»åšåˆ†åŒºå­˜å‚¨ï¼Œå› æ­¤ï¼Œåœ¨å‰ä¸€æ­¥åˆ†ç»„çš„æ—¶å€™ï¼ŒæŠŠè¿™ä¸¤ä¸ªå­—æ®µä¿ç•™äº†ä¸‹æ¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615875622,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1254213,"avatar":"https://static001.geekbang.org/account/avatar/00/13/23/45/3addffe7.jpg","nickname":"brv","note":"","ucode":"DD94D8C2085EAB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":358149,"discussion_content":"ç±»ä¼¼äºhiveçš„åŠ¨æ€åˆ†åŒºå—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615941130,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":357824,"ip_address":""},"score":358149,"extra":""},{"author":{"id":1159758,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b2/4e/13a993a5.jpg","nickname":"è¶…çº§è¾¾è¾¾","note":"","ucode":"153FCE3113AD11","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1254213,"avatar":"https://static001.geekbang.org/account/avatar/00/13/23/45/3addffe7.jpg","nickname":"brv","note":"","ucode":"DD94D8C2085EAB","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":358294,"discussion_content":"æ˜¯çš„ï¼ŒSparkçš„partitionByå¯ä»¥æ ¹æ®å…·ä½“æ•°æ®å†…å®¹å»åŠ¨æ€åˆ›å»ºå¯¹åº”çš„åˆ†åŒºï¼Œç±»ä¼¼äºHiveçš„åŠ¨æ€åˆ†åŒºåŠŸèƒ½ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1615961562,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":358149,"ip_address":""},"score":358294,"extra":""},{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":1159758,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b2/4e/13a993a5.jpg","nickname":"è¶…çº§è¾¾è¾¾","note":"","ucode":"153FCE3113AD11","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":358308,"discussion_content":"æ­£è§£~\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615963114,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":358294,"ip_address":""},"score":358308,"extra":""}]},{"author":{"id":1179298,"avatar":"https://static001.geekbang.org/account/avatar/00/11/fe/a2/5252a278.jpg","nickname":"å¯¹æ–¹æ­£åœ¨è¾“å…¥ã€‚ã€‚ã€‚","note":"","ucode":"7B0DEB4D9B43D2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":357479,"discussion_content":"å› ä¸ºæ˜¯è¦åœ¨æ¯ä¸€æ¡pairDfçš„æ•°æ®æ¡ç›®åŸºç¡€ä¹‹ä¸Šç­›é€‰å‡ºfactDfçš„æ•°æ®èšåˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615811897,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":284963,"user_name":"åˆ˜å‰è¶…","can_delete":false,"product_type":"c1","uid":1111513,"ip_address":"","ucode":"846F8EAB9AFAE9","user_header":"https://static001.geekbang.org/account/avatar/00/10/f5/d9/345d743d.jpg","comment_is_top":false,"comment_ctime":1616563526,"is_pvip":false,"replies":[{"id":"103381","content":"å…„å¼Ÿæˆ‘æ˜¯ä½œè€…å“ˆï¼Œç¬¬äºŒä»½ä»£ç ï¼Œæˆ‘æœ‰å‡ ä¸ªç–‘é—®ï¼š<br>1. ä¸¤ä¸ªimportè¯­å¥çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ<br>2. adså…·ä½“æ˜¯ä»€ä¹ˆå†…å®¹ï¼Ÿæ˜¯RDDï¼Œè¿˜æ˜¯æ•°ç»„ï¼Œè¿˜æ˜¯ä»€ä¹ˆï¼Ÿ<br>3. æ²¡æœ‰çœ‹åˆ°å“ªé‡Œå®šä¹‰åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œæ‰€æœ‰è®¡ç®—çœ‹ä¸Šå»æ˜¯åŸºäº(0 until ads.size())è¿™ä¸ªListï¼Œé‚£ä¹ˆåç»­æ‰€æœ‰çš„è®¡ç®—ï¼Œmapï¼Œmapé‡Œé¢çš„toMapï¼Œéƒ½æ˜¯åœ¨driverè®¡ç®—çš„ï¼Œå¦‚æœä½ 9Tæ•°æ®éƒ½åœ¨driverè®¡ç®—ï¼Œé‚£ç»“æœã€‚ã€‚ã€‚<br>4. toMapä¹‹åï¼ŒåˆåŠ äº†ä¸ªmapï¼Œæˆ‘ç†è§£æ˜¯ä¸ºäº†æŠŠvalueä¸­çš„nullæ›¿æ¢ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œmapé‡Œé¢åªå¤„ç†valueå°±å¥½äº†ï¼Œä¸ç”¨å¸¦ç€key<br><br>ä¸çŸ¥é“æˆ‘ç†è§£çš„å¯¹ä¸å¯¹å“ˆï¼ŒæœŸå¾…è€å¼Ÿæä¾›æ›´å¤šä¿¡æ¯~","user_name":"ç¼–è¾‘å›å¤","user_name_real":"ç‹è¹","uid":"1743279","ctime":1616593457,"ip_address":"","comment_id":284963,"utype":2}],"discussion_count":2,"race_medal":0,"score":"5911530822","product_id":100073401,"comment_content":"æˆ‘ä»¬æ¯å¤©æœ‰9Tæ•°æ®ï¼Œç”¨å¦‚ä¸‹ä»£ç åšETL  jsonå¹³é“ºï¼ŒèŠ±å¾ˆé•¿æ—¶é—´<br>val adArr = ArrayBuffer[Map[String, String]]()<br>if (ads != null) {<br>  val adnum = ads.length<br>  for (i &lt;- 0 until adnum) {<br>    val addObj = ads.getJSONObject(i)<br>    val adMap = THashMap[String, String]()<br>    addObj.entrySet().foreach(x =&gt; adMap += (x.getKey -&gt; (if(x.getValue==null) &quot;&quot; else x.getValue.toString )  ))<br>    adArr += adMap.toMap<br>  }<br>}<br>åŸºäºè€å¸ˆè®²çš„ï¼Œé¿å…å‰¯ä½œç”¨ï¼Œæ”¹ä¸ºå¦‚ä¸‹ä»£ç <br>import org.apache.flink.streaming.api.scala._<br>import scala.collection.JavaConversions._<br> val adArr = (0 until ads.size()).map(i =&gt; ads.getJSONObject(i).toMap.map(entry =&gt; entry._1 -&gt; (if(entry._2==null) &quot;&quot; else entry._2.toString)))<br>å°è¯•åæ²¡å•¥æ•ˆæœï¼Œå¸Œæœ›è€å¸ˆæŒ‡å¯¼ä¸€ä¸‹","like_count":1,"discussions":[{"author":{"id":1743279,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/99/af/e4cc7374.jpg","nickname":"å•Šå‘œ","note":"","ucode":"76E24AB808868D","race_medal":0,"user_type":4,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517527,"discussion_content":"å…„å¼Ÿæˆ‘æ˜¯ä½œè€…å“ˆï¼Œç¬¬äºŒä»½ä»£ç ï¼Œæˆ‘æœ‰å‡ ä¸ªç–‘é—®ï¼š\n1. ä¸¤ä¸ªimportè¯­å¥çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ\n2. adså…·ä½“æ˜¯ä»€ä¹ˆå†…å®¹ï¼Ÿæ˜¯RDDï¼Œè¿˜æ˜¯æ•°ç»„ï¼Œè¿˜æ˜¯ä»€ä¹ˆï¼Ÿ\n3. æ²¡æœ‰çœ‹åˆ°å“ªé‡Œå®šä¹‰åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œæ‰€æœ‰è®¡ç®—çœ‹ä¸Šå»æ˜¯åŸºäº(0 until ads.size())è¿™ä¸ªListï¼Œé‚£ä¹ˆåç»­æ‰€æœ‰çš„è®¡ç®—ï¼Œmapï¼Œmapé‡Œé¢çš„toMapï¼Œéƒ½æ˜¯åœ¨driverè®¡ç®—çš„ï¼Œå¦‚æœä½ 9Tæ•°æ®éƒ½åœ¨driverè®¡ç®—ï¼Œé‚£ç»“æœã€‚ã€‚ã€‚\n4. toMapä¹‹åï¼ŒåˆåŠ äº†ä¸ªmapï¼Œæˆ‘ç†è§£æ˜¯ä¸ºäº†æŠŠvalueä¸­çš„nullæ›¿æ¢ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œmapé‡Œé¢åªå¤„ç†valueå°±å¥½äº†ï¼Œä¸ç”¨å¸¦ç€key\n\nä¸çŸ¥é“æˆ‘ç†è§£çš„å¯¹ä¸å¯¹å“ˆï¼ŒæœŸå¾…è€å¼Ÿæä¾›æ›´å¤šä¿¡æ¯~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616593457,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":361103,"discussion_content":"å¦å¤–ï¼Œæˆ‘ä»¬æœ‰ä¸ªè¯»è€…å¾®ä¿¡ç¾¤ï¼šâ€œ528*å´ç£Šçš„ Spark è¯»è€…ç¾¤â€ï¼Œé‚£é‡Œè®¨è®ºæ›´æ–¹ä¾¿ï¼Œä½ å¯ä»¥é—®é—®è¿è¥æ€ä¹ˆåŠ å…¥ã€‚æˆ–è€…ä½ å¯ä»¥åŠ æˆ‘å¥½å‹ï¼ŒæœrJunioræˆ–è€…â€œæ–¹å—Kâ€ï¼Œæˆ‘æŠŠä½ æ‹‰è¿›å»ï¼Œä½ æŠŠæ›´å¤šä¿¡æ¯è´´ç»™æˆ‘ï¼Œå’±ä»¬ä¸€èµ·çœ‹çœ‹ç“¶é¢ˆåœ¨å“ªå„¿ï¼Œç„¶åå†çœ‹æ€ä¹ˆä¼˜åŒ–ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1616593626,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":283889,"user_name":"LJK","can_delete":false,"product_type":"c1","uid":1199213,"ip_address":"","ucode":"12B2441099FF1D","user_header":"https://static001.geekbang.org/account/avatar/00/12/4c/6d/c20f2d5a.jpg","comment_is_top":false,"comment_ctime":1615973157,"is_pvip":false,"replies":[{"id":"103037","content":"ä¸ä¸€å®šçš„ï¼Œactionä¸ªæ•°ä¸æ˜¯å…³é”®ï¼Œå…³é”®æ˜¯æ•°æ®çš„è®¿é—®æ•ˆç‡ã€‚å…³äºæå‡æ•°æ®è®¿é—®æ•ˆç‡ï¼Œå’±ä»¬ä¸“æ åé¢çš„å†…å®¹ä¼šè®²å“ˆï½","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1616050952,"ip_address":"","comment_id":283889,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5910940453","product_id":100073401,"comment_content":"åŒä¸€ä¸ªapplicationå¦‚æœactionå¤šçš„è¯ä¸€å®šä¼šå½±å“æ•ˆç‡å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517172,"discussion_content":"ä¸ä¸€å®šçš„ï¼Œactionä¸ªæ•°ä¸æ˜¯å…³é”®ï¼Œå…³é”®æ˜¯æ•°æ®çš„è®¿é—®æ•ˆç‡ã€‚å…³äºæå‡æ•°æ®è®¿é—®æ•ˆç‡ï¼Œå’±ä»¬ä¸“æ åé¢çš„å†…å®¹ä¼šè®²å“ˆï½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616050952,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360762,"user_name":"é˜¿å¥","can_delete":false,"product_type":"c1","uid":1048598,"ip_address":"å¹¿ä¸œ","ucode":"2EAF87513224C1","user_header":"https://static001.geekbang.org/account/avatar/00/10/00/16/bedf7932.jpg","comment_is_top":false,"comment_ctime":1666834074,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1666834074","product_id":100073401,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæˆ‘æœ€è¿‘é‡åˆ°ä¸€ä¸ªå¥‡æ€ªçš„é—®é¢˜ã€‚æˆ‘ç›´æ¥ç™»å½•ç»ˆç«¯å»æ‰§è¡Œspark submitä»»åŠ¡å¯ä»¥æ‰§è¡ŒæˆåŠŸï¼Œæˆ‘åœ¨é¡¹ç›®é‡Œæ˜¯æ¨¡ä»¿çš„å°æµ·è±šè°ƒåº¦å™¨åœ¨ç¨‹åºé‡Œå»æ‹¼æ¥çš„spark submitè„šæœ¬ç„¶åç”Ÿæˆçš„shellè„šæœ¬ï¼Œé€šè¿‡sudo -u  hadoopé›†ç¾¤çš„ç§Ÿæˆ·  sh commandå»æ‰§è¡Œçš„ï¼Œè¿™ç§æ–¹å¼æäº¤çš„ä»»åŠ¡å¦‚æœä»»åŠ¡æ•°æ®é‡å°å¯ä»¥æ‰§è¡ŒæˆåŠŸï¼Œä»»åŠ¡æ•°æ®é‡å¤§å°±ä¼šå¤±è´¥ï¼Œæç¤ºapplicationmaster æ¥å—åˆ°äº†killçš„ä¿¡å·","like_count":0},{"had_liked":false,"id":355389,"user_name":"å”æ–¹åˆš","can_delete":false,"product_type":"c1","uid":3046392,"ip_address":"ä¸Šæµ·","ucode":"93DA58C3DCCF1B","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/ugib9sF9icd9dhibQoAA025hibbD5zgZTiaddLoeEH457hrkBBhtQK6qknTWt270rHCtBZqeqsbibtHghgjdkPx3DyIw/132","comment_is_top":false,"comment_ctime":1661330154,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1661330154","product_id":100073401,"comment_content":"å¼±å¼±çš„é—®ä¸ªé—®é¢˜ï¼Œval extractFields: Seq[Row] =&gt; Seq[(String, Int)] = {}ï¼Œä¸€èˆ¬å®šä¹‰æ–¹æ³•ï¼Œå†’å·åé¢ä¸æ˜¯è¿”å›å€¼ä¹ˆï¼Œæ€ä¹ˆè¿™é‡Œå†’å·åé¢å‚æ•°å’Œè¿”å›å€¼éƒ½æœ‰","like_count":0,"discussions":[{"author":{"id":2775166,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/58/7e/1d5fadd4.jpg","nickname":"object","note":"","ucode":"F64CF320C1DA12","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585975,"discussion_content":"scalaçš„è¯­æ³•ï¼Œé€šä¿—æ¥è®²å°±æŠŠä¸€ä¸ªå‡½æ•°èµ‹å€¼æˆä¸€ä¸ªå˜é‡äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661922669,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å‰æ—"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":349113,"user_name":"ç»„ç»‡çµé­‚ ç‹å­å¥","can_delete":false,"product_type":"c1","uid":2957218,"ip_address":"","ucode":"94DB462CEAFAD3","user_header":"https://static001.geekbang.org/account/avatar/00/2d/1f/a2/0ac2dc38.jpg","comment_is_top":false,"comment_ctime":1655736251,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1655736251","product_id":100073401,"comment_content":"çœ‹åˆ°ä¸€ä¸ªæ•°æ®é‡å¤§å¦ä¸€ä¸ªæ•°æ®é‡å°ï¼Œç«‹åˆ»é©¬ä¸Šå°±ä¼šæƒ³åˆ°å¹¿æ’­å˜é‡ã€‚è¿˜æœ‰ä¼˜åŒ–éƒ¨åˆ†writeç”¨åˆ°äº†partitionByè¿™ä¸ªç»†èŠ‚å¿…é¡»æ³¨æ„","like_count":0},{"had_liked":false,"id":345108,"user_name":"Geek_32772e","can_delete":false,"product_type":"c1","uid":1446158,"ip_address":"","ucode":"2850EF64F4775F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoribOUgcicu1sOqZZVtPqpSDSS43vicxW0GesxQeBRjUC47CzulKSzYNj2aMg9YOZDdjPdAZxS3jNcQ/132","comment_is_top":false,"comment_ctime":1652028797,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1652028797","product_id":100073401,"comment_content":"è¿™ä¸¤ä¸ªä¾‹å­ç›´æ¥ç”¨sparkSQLä¸æ˜¯æ›´ç®€å•å—","like_count":0},{"had_liked":false,"id":342167,"user_name":"Spoon","can_delete":false,"product_type":"c1","uid":1959822,"ip_address":"","ucode":"2FF9193AD482C2","user_header":"https://static001.geekbang.org/account/avatar/00/1d/e7/8e/318cfde0.jpg","comment_is_top":false,"comment_ctime":1650079810,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1650079810","product_id":100073401,"comment_content":"ä½¿ç”¨Boradcast NLJè¿™æ ·å¯ä»¥èŠ‚çœShuffleå¸¦æ¥çš„å¼€é”€~","like_count":0},{"had_liked":false,"id":323754,"user_name":"Unknown element","can_delete":false,"product_type":"c1","uid":2028277,"ip_address":"","ucode":"34A129800D0238","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f2/f5/b82f410d.jpg","comment_is_top":false,"comment_ctime":1638152235,"is_pvip":false,"replies":[{"id":"117605","content":"è€å¼Ÿåˆ«ç€æ€¥~ <br><br>å…ˆæŠŠNLJçš„ç®—æ³•å¤æ‚åº¦å¿˜æ‰ï¼Œå…ˆä¸ç”¨ç®¡ç”¨ä»€ä¹ˆJoinå®ç°æœºåˆ¶ï¼Œå…ˆå…³æ³¨ä¸‹é¢è¿™æ®µä»£ç ï¼š<br>&#47;&#47;å®ç°æ–¹æ¡ˆ1 â€”â€” åä¾‹def createInstance(factDF: DataFrame, startDate: String, endDate: String): DataFrame = {val instanceDF = factDF.filter(col(&quot;eventDate&quot;) &gt; lit(startDate) &amp;&amp; col(&quot;eventDate&quot;) &lt;= lit(endDate)).groupBy(&quot;dim1&quot;, &quot;dim2&quot;, &quot;dim3&quot;, &quot;event_date&quot;).agg(sum(&quot;value&quot;) as &quot;sum_value&quot;)instanceDF}<br><br>factDF æ˜¯ä¸€ä»½åºå¤§çš„åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œå°½ç®¡ createInstance çš„é€»è¾‘ä»…ä»…æ˜¯å¯¹ factDF è¿›è¡Œè¿‡æ»¤ã€æ±‡æ€»å¹¶è½ç›˜ï¼Œä½†æ˜¯ createInstance å‡½æ•°åœ¨ foreach ä¸­ä¼šè¢«è°ƒç”¨å‡ ç™¾æ¬¡ï¼ŒpairDF ä¸­æœ‰å¤šå°‘ä¸ªæ—¶é—´å¯¹ï¼ŒcreateInstance å°±ä¼šè¢«è°ƒç”¨å¤šå°‘æ¬¡ã€‚å¯¹äº Spark ä¸­çš„ DAG æ¥è¯´ï¼Œåœ¨æ²¡æœ‰ç¼“å­˜çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸€æ¬¡ Action çš„è§¦å‘éƒ½ä¼šå¯¼è‡´æ•´æ¡ DAG ä»å¤´åˆ°å°¾é‡æ–°æ‰§è¡Œã€‚æ˜ç™½äº†è¿™ä¸€ç‚¹ä¹‹åï¼Œæˆ‘ä»¬å†æ¥ä»”ç»†è§‚å¯Ÿè¿™ä»½ä»£ç ï¼Œç›¯ç€ foreach å’Œ createInstance ä¸­çš„ factDFï¼Œä½ ä¼šæƒŠè®¶åœ°å‘ç°ï¼šæœ‰ç€ä¸Šåƒä¸‡è¡Œæ•°æ®çš„ factDF è¢«åå¤æ‰«æäº†å‡ ç™¾æ¬¡ï¼<br><br>æ€§èƒ½å·®çš„å…³é”®åœ¨äºï¼šâ€œæœ‰ç€ä¸Šåƒä¸‡è¡Œæ•°æ®çš„ factDF è¢«åå¤æ‰«æäº†å‡ ç™¾æ¬¡ï¼â€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒä¸€ä»½è¶…å¤§çš„åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œè¢«ç£ç›˜I&#47;Oäº†ä¸Šç™¾æ¬¡ã€‚è€Œæ­£ä¾‹ä»£ç ä¸­ï¼Œè¿™ä»½æ•°æ®é›†åªä¼šè¢«I&#47;Oä¸€æ¬¡ã€‚ä»…è¿™ä¸€é¡¹åŒºåˆ«ï¼Œæ‰§è¡Œæ€§èƒ½å°±é«˜ä¸‹ç«‹ç°äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1043100","ctime":1638284595,"ip_address":"","comment_id":323754,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1638152235","product_id":100073401,"comment_content":"è€å¸ˆæˆ‘æŠŠæ‰€æœ‰è¯¾ç¨‹çœ‹äº†ä¸€éè¿˜æ˜¯ä¸å¤ªç†è§£ä¸ºä»€ä¹ˆä¾‹2 æ­£ä¾‹çš„æ€§èƒ½æ›´é«˜ï¼ˆæ‚è„¸ï¼‰ï¼›å¦‚æœsparkä¸èƒ½æ ¹æ®æ—¥æœŸèŒƒå›´å¯¹fairDFåšè¿‡æ»¤æå‰å»æ‰ä¸€éƒ¨åˆ†çš„è¯ ä¸ç®¡æ˜¯fairDF left join factDFè¿˜æ˜¯factDF left join fairDFè¿˜æ˜¯åä¾‹çš„ä»£ç ï¼Œæ„Ÿè§‰æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ size(fairDF)*size(factDF) å•Šã€‚ã€‚ã€‚è™½ç„¶æ•°æ®æ˜¯åˆ†å¸ƒåœ¨ä¸åŒèŠ‚ç‚¹ä¸­ä½†æ˜¯NLJçš„ç®—æ³•ä¸æ˜¯å¯¹äºfactDFä¸­æ¯æ¡è®°å½•éƒ½éå†ä¸€éfairDFå—ï¼Ÿå¸Œæœ›è€å¸ˆèƒ½è§£ç­”ä¸€ä¸‹å˜¤å˜¤å˜¤","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534840,"discussion_content":"è€å¼Ÿåˆ«ç€æ€¥~ \n\nå…ˆæŠŠNLJçš„ç®—æ³•å¤æ‚åº¦å¿˜æ‰ï¼Œå…ˆä¸ç”¨ç®¡ç”¨ä»€ä¹ˆJoinå®ç°æœºåˆ¶ï¼Œå…ˆå…³æ³¨ä¸‹é¢è¿™æ®µä»£ç ï¼š\n//å®ç°æ–¹æ¡ˆ1 â€”â€” åä¾‹def createInstance(factDF: DataFrame, startDate: String, endDate: String): DataFrame = {val instanceDF = factDF.filter(col(&#34;eventDate&#34;) &gt; lit(startDate) &amp;&amp; col(&#34;eventDate&#34;) &lt;= lit(endDate)).groupBy(&#34;dim1&#34;, &#34;dim2&#34;, &#34;dim3&#34;, &#34;event_date&#34;).agg(sum(&#34;value&#34;) as &#34;sum_value&#34;)instanceDF}\n\nfactDF æ˜¯ä¸€ä»½åºå¤§çš„åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œå°½ç®¡ createInstance çš„é€»è¾‘ä»…ä»…æ˜¯å¯¹ factDF è¿›è¡Œè¿‡æ»¤ã€æ±‡æ€»å¹¶è½ç›˜ï¼Œä½†æ˜¯ createInstance å‡½æ•°åœ¨ foreach ä¸­ä¼šè¢«è°ƒç”¨å‡ ç™¾æ¬¡ï¼ŒpairDF ä¸­æœ‰å¤šå°‘ä¸ªæ—¶é—´å¯¹ï¼ŒcreateInstance å°±ä¼šè¢«è°ƒç”¨å¤šå°‘æ¬¡ã€‚å¯¹äº Spark ä¸­çš„ DAG æ¥è¯´ï¼Œåœ¨æ²¡æœ‰ç¼“å­˜çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸€æ¬¡ Action çš„è§¦å‘éƒ½ä¼šå¯¼è‡´æ•´æ¡ DAG ä»å¤´åˆ°å°¾é‡æ–°æ‰§è¡Œã€‚æ˜ç™½äº†è¿™ä¸€ç‚¹ä¹‹åï¼Œæˆ‘ä»¬å†æ¥ä»”ç»†è§‚å¯Ÿè¿™ä»½ä»£ç ï¼Œç›¯ç€ foreach å’Œ createInstance ä¸­çš„ factDFï¼Œä½ ä¼šæƒŠè®¶åœ°å‘ç°ï¼šæœ‰ç€ä¸Šåƒä¸‡è¡Œæ•°æ®çš„ factDF è¢«åå¤æ‰«æäº†å‡ ç™¾æ¬¡ï¼\n\næ€§èƒ½å·®çš„å…³é”®åœ¨äºï¼šâ€œæœ‰ç€ä¸Šåƒä¸‡è¡Œæ•°æ®çš„ factDF è¢«åå¤æ‰«æäº†å‡ ç™¾æ¬¡ï¼â€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒä¸€ä»½è¶…å¤§çš„åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œè¢«ç£ç›˜I/Oäº†ä¸Šç™¾æ¬¡ã€‚è€Œæ­£ä¾‹ä»£ç ä¸­ï¼Œè¿™ä»½æ•°æ®é›†åªä¼šè¢«I/Oä¸€æ¬¡ã€‚ä»…è¿™ä¸€é¡¹åŒºåˆ«ï¼Œæ‰§è¡Œæ€§èƒ½å°±é«˜ä¸‹ç«‹ç°äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638284595,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2028277,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/f2/f5/b82f410d.jpg","nickname":"Unknown element","note":"","ucode":"34A129800D0238","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536321,"discussion_content":"ä½†æ˜¯ä¸ºä»€ä¹ˆæ­£ä¾‹ä¸­factDFåªè¢«I/Oä¸€æ¬¡å‘¢...","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638758644,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":322622,"user_name":"tiankonghewo","can_delete":false,"product_type":"c1","uid":1476427,"ip_address":"","ucode":"7A55A9C17DD9DF","user_header":"https://static001.geekbang.org/account/avatar/00/16/87/4b/16ea3997.jpg","comment_is_top":false,"comment_ctime":1637503558,"is_pvip":false,"replies":[{"id":"117334","content":"è€å¼Ÿè¿™æ˜¯å…¸å‹çš„â€œå•æœºæ€ç»´â€å“ˆ~ å¯ä»¥èŠ±äº›æ—¶é—´äº†è§£ä¸€ä¸‹è¯¾ç¨‹åé¢çš„å†…å®¹~<br>è¿™é‡Œè¯´çš„æ‰«æä¸€æ¬¡ï¼ŒæŒ‡çš„æ˜¯é©±åŠ¨è¡¨factDFï¼Œä½ å¯ä»¥å…ˆä¸è€ƒè™‘NLJç®—æ³•ä¸Šçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œè€Œä»åˆ†å¸ƒå¼çš„è§’åº¦ï¼Œå»è€ƒè™‘ä¸‹å“ˆ~","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1043100","ctime":1637897949,"ip_address":"","comment_id":322622,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1637503558","product_id":100073401,"comment_content":"&quot;å°½ç®¡ Nested Loop Join æ˜¯æ‰€æœ‰ Join å®ç°æ–¹å¼ï¼ˆMerge Joinï¼ŒHash Joinï¼ŒBroadcast Join ç­‰ï¼‰ä¸­æ€§èƒ½æœ€å·®çš„ä¸€ç§ï¼Œè€Œä¸”è¿™ç§ Join æ–¹å¼æ²¡æœ‰ä»»ä½•ä¼˜åŒ–ç©ºé—´ï¼Œä½† factDF ä¸ pairDF çš„æ•°æ®å…³è”åªéœ€è¦æ‰«æä¸€æ¬¡å…¨é‡æ•°æ®&quot;, <br>å¯¹äºè¿™ä¸€æ®µè¯,æ„Ÿè§‰è§£é‡Šçš„ä¸å¥½, Nested Loop Join æ˜¯ä¸¤ä¸ªforå¾ªç¯, æ—¶é—´å¤æ‚åº¦åº”è¯¥ä¹Ÿæ˜¯M*N, å¦‚æœfactDFåªéœ€è¦æ‰«ç ä¸€éå…¨é‡æ•°æ®,é‚£ä¹ˆpairDFéœ€è¦æ‰«æçš„æ¬¡æ•°ä¹Ÿä¸ä¼šå°‘,<br>ä¸¤ä¸ªforå¾ªç¯,æ—¶é—´å¤æ‚åº¦æ€ä¹ˆéƒ½æ˜¯M*N, é‚£ä¹ˆèŠ‚çº¦ä¸‹æ¥çš„æ—¶é—´,ç›¸æ¯”ç¬¬ä¸€ç§foreachæ–¹å¼,åº”è¯¥æ˜¯ä»ç£ç›˜ä¸­æ‹‰å–çš„æ—¶é—´<br><br>","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":533545,"discussion_content":"è€å¼Ÿè¿™æ˜¯å…¸å‹çš„â€œå•æœºæ€ç»´â€å“ˆ~ å¯ä»¥èŠ±äº›æ—¶é—´äº†è§£ä¸€ä¸‹è¯¾ç¨‹åé¢çš„å†…å®¹~\nè¿™é‡Œè¯´çš„æ‰«æä¸€æ¬¡ï¼ŒæŒ‡çš„æ˜¯é©±åŠ¨è¡¨factDFï¼Œä½ å¯ä»¥å…ˆä¸è€ƒè™‘NLJç®—æ³•ä¸Šçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œè€Œä»åˆ†å¸ƒå¼çš„è§’åº¦ï¼Œå»è€ƒè™‘ä¸‹å“ˆ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637897949,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2855459,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/icJzoUc02ECdBbFgGzVIwYfpRgL3TXuRRE5GsDqZFmAlAAm1KUQS1rHewgj5FB4TChovo3YaceicEZE2MgZJ1ftw/132","nickname":"Geek_eb29a4","note":"","ucode":"CF88D4ED5F4A25","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537697,"discussion_content":"è¿™é‡Œè¯´çš„æ‰«æä¸€æ¬¡ï¼ŒæŒ‡çš„æ˜¯é©±åŠ¨è¡¨factD //   è¿™å¥è¯èƒ½ä¸èƒ½å†é€šä¿—è§£æä¸€ä¸‹   ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639146041,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":322610,"user_name":"tiankonghewo","can_delete":false,"product_type":"c1","uid":1476427,"ip_address":"","ucode":"7A55A9C17DD9DF","user_header":"https://static001.geekbang.org/account/avatar/00/16/87/4b/16ea3997.jpg","comment_is_top":false,"comment_ctime":1637498551,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637498551","product_id":100073401,"comment_content":"ç¬¬äºŒä¸ªä¾‹å­,å­¦ä¹ äº†","like_count":0},{"had_liked":false,"id":322023,"user_name":"èè‰å·´ç´¢å°å¸ƒä¸","can_delete":false,"product_type":"c1","uid":1221146,"ip_address":"","ucode":"00C285326B8C77","user_header":"https://static001.geekbang.org/account/avatar/00/12/a2/1a/f2c8988b.jpg","comment_is_top":false,"comment_ctime":1637139900,"is_pvip":false,"replies":[{"id":"116958","content":"è€å¼Ÿè¿™æ˜¯å…¸å‹çš„â€œå•æœºæ€ç»´â€å“ˆ~ å¯ä»¥èŠ±äº›æ—¶é—´äº†è§£ä¸€ä¸‹è¯¾ç¨‹åé¢çš„å†…å®¹~<br>è¿™é‡Œè¯´çš„æ‰«æä¸€æ¬¡ï¼ŒæŒ‡çš„æ˜¯é©±åŠ¨è¡¨factDFï¼Œä½ å¯ä»¥å…ˆä¸è€ƒè™‘NLJç®—æ³•ä¸Šçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œè€Œä»åˆ†å¸ƒå¼çš„è§’åº¦ï¼Œå»è€ƒè™‘ä¸‹å“ˆ~","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1043100","ctime":1637162403,"ip_address":"","comment_id":322023,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1637139900","product_id":100073401,"comment_content":"è€å¸ˆï¼Œæˆ‘çœ‹äº†ä¸‹nested loop joinçš„åŸç†ï¼ŒæŸ¥æ‰¾æ¬¡æ•°åº”è¯¥ä¸ºå¤–å±‚å¾ªç¯çš„æ¬¡æ•°å‘€ï¼Œä¸ºä»€ä¹ˆä½ è¯´åªå…¨è¡¨æ‰«æä¸€æ¬¡å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530894,"discussion_content":"è€å¼Ÿè¿™æ˜¯å…¸å‹çš„â€œå•æœºæ€ç»´â€å“ˆ~ å¯ä»¥èŠ±äº›æ—¶é—´äº†è§£ä¸€ä¸‹è¯¾ç¨‹åé¢çš„å†…å®¹~\nè¿™é‡Œè¯´çš„æ‰«æä¸€æ¬¡ï¼ŒæŒ‡çš„æ˜¯é©±åŠ¨è¡¨factDFï¼Œä½ å¯ä»¥å…ˆä¸è€ƒè™‘NLJç®—æ³•ä¸Šçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œè€Œä»åˆ†å¸ƒå¼çš„è§’åº¦ï¼Œå»è€ƒè™‘ä¸‹å“ˆ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637162403,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":315319,"user_name":"é›å½’æ¥ğŸ","can_delete":false,"product_type":"c1","uid":1698742,"ip_address":"","ucode":"FC3A7ABC05C27D","user_header":"https://static001.geekbang.org/account/avatar/00/19/eb/b6/2069455f.jpg","comment_is_top":false,"comment_ctime":1633830340,"is_pvip":false,"replies":[{"id":"114519","content":"æˆ‘ä»¬ä¸€ä¸ªä¸ªæ¥è¯´~<br><br>1. åŠä¸ªå°æ—¶æ˜¯å¦æ­£å¸¸ï¼Œå…¶å®è¦çœ‹ä½ é›†ç¾¤è§„æ¨¡çš„ã€‚ä¸è¿‡åƒä½ æ‰€è¯´ï¼ŒåŒç­‰è§„æ¨¡ä¸‹ï¼Œimpalaã€hiveæ¯”Sparkå¿«äº†ä¸€ä¸ªæ•°é‡çº§ï¼Œè¿™ä¸ªè¯´å®è¯æˆ‘æŒºå›°æƒ‘ã€‚ä¸€ç§çŒœæµ‹æ˜¯ï¼Œimpalaã€hiveç”¨çš„æ˜¯broadcast joinï¼Œè€ŒSparkç”¨çš„shuffle joinã€‚ä½ å¯ä»¥è€ƒè™‘æŠŠ50ä¸‡ã€å‡ ä¸‡çš„æ•°æ®è¡¨ï¼Œéƒ½å¼ºåˆ¶å¹¿æ’­ï¼Œç„¶åç”¨broadcast joinå»å®ç°left joinï¼Œç„¶åå†å¯¹æ¯”æ‰§è¡Œæ—¶é—´<br><br>2. Spark SQLç¡®å®ä¸å¤ªé€‚åˆå¤§è¡¨Joinå¤§è¡¨çš„åœºæ™¯ï¼Œè¿™ä¸ªæˆ‘ä»¬åœ¨åé¢çš„28ã€29è®²ç»™å‡ºä¸€äº›å¤§è¡¨Joinå¤§è¡¨çš„tipså’Œæœ€ä½³å®è·µï¼Œè€å¼Ÿä¸å¦¨å‚è€ƒä¸‹~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1634136834,"ip_address":"","comment_id":315319,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1633830340","product_id":100073401,"comment_content":"æˆ‘æœ‰2ä¸ªé—®é¢˜æƒ³è¯·æ•™ä¸€ä¸‹è€å¸ˆï¼š<br>ç¬¬ä¸€ä¸ªï¼šæˆ‘ä»¬ç°åœ¨ç”Ÿäº§ç”¨sparkSQLå»åšSQLåˆ†æï¼Œä¸€å¼ 4åƒä¸‡æ•°æ®å·¦å³çš„è¡¨å»left join ä¸€å¼ 50ä¸‡çš„è¡¨å’Œå‡ å¼ å‡ ä¸‡æ•°æ®çš„è¡¨ï¼Œè¦èŠ±è´¹åŠä¸ªå°æ—¶ï¼Œè¿™ä¸ªæ­£å¸¸å—ï¼Ÿç„¶åæŠŠå¾—åˆ°çš„è¿‘800ä¸‡çš„æ•°æ®å†™å…¥TIDBåˆèŠ±è´¹åŠä¸ªå°æ—¶ï¼Œè¿™ä¸ªæ˜¯ä¸æ˜¯æ­£å¸¸çš„æ—¶æ•ˆå•Šï¼Ÿï¼Œä½†æ˜¯ç”¨MPPæ•°æ®åº“å¦‚impala,hiveç­‰å‡ åˆ†é’Ÿå°±å…¨æå®šäº†ã€‚<br>ç¬¬äºŒä¸ªï¼šæœ‰5å¼ 700ä¸‡å·¦å³æ•°æ®çš„è¡¨åšleft joinçš„è¯sparkSQLç»å¸¸ä¼šOOMï¼Œç„¶åè°ƒå¤§å†…å­˜åè¦è·‘1ä¸ªå°æ—¶æ‰èƒ½å‡ºç»“æœï¼Œæ˜¯ä¸æ˜¯sparkSQLåœ¨å¤§è¡¨å…³è”å¤§è¡¨æ–¹é¢æ€§èƒ½å¾ˆå·®å•Šï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527932,"discussion_content":"æˆ‘ä»¬ä¸€ä¸ªä¸ªæ¥è¯´~\n\n1. åŠä¸ªå°æ—¶æ˜¯å¦æ­£å¸¸ï¼Œå…¶å®è¦çœ‹ä½ é›†ç¾¤è§„æ¨¡çš„ã€‚ä¸è¿‡åƒä½ æ‰€è¯´ï¼ŒåŒç­‰è§„æ¨¡ä¸‹ï¼Œimpalaã€hiveæ¯”Sparkå¿«äº†ä¸€ä¸ªæ•°é‡çº§ï¼Œè¿™ä¸ªè¯´å®è¯æˆ‘æŒºå›°æƒ‘ã€‚ä¸€ç§çŒœæµ‹æ˜¯ï¼Œimpalaã€hiveç”¨çš„æ˜¯broadcast joinï¼Œè€ŒSparkç”¨çš„shuffle joinã€‚ä½ å¯ä»¥è€ƒè™‘æŠŠ50ä¸‡ã€å‡ ä¸‡çš„æ•°æ®è¡¨ï¼Œéƒ½å¼ºåˆ¶å¹¿æ’­ï¼Œç„¶åç”¨broadcast joinå»å®ç°left joinï¼Œç„¶åå†å¯¹æ¯”æ‰§è¡Œæ—¶é—´\n\n2. Spark SQLç¡®å®ä¸å¤ªé€‚åˆå¤§è¡¨Joinå¤§è¡¨çš„åœºæ™¯ï¼Œè¿™ä¸ªæˆ‘ä»¬åœ¨åé¢çš„28ã€29è®²ç»™å‡ºä¸€äº›å¤§è¡¨Joinå¤§è¡¨çš„tipså’Œæœ€ä½³å®è·µï¼Œè€å¼Ÿä¸å¦¨å‚è€ƒä¸‹~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634136834,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":315225,"user_name":"å­å…®","can_delete":false,"product_type":"c1","uid":2767208,"ip_address":"","ucode":"BA213EAB26DF16","user_header":"https://static001.geekbang.org/account/avatar/00/2a/39/68/56dfc8c0.jpg","comment_is_top":false,"comment_ctime":1633755604,"is_pvip":false,"replies":[{"id":"114420","content":"æ­£åä¾‹å…¶å®éƒ½æœ‰Shuffleï¼Œè¿™é‡Œçš„å¯¹æ¯”ï¼Œå…¶å®å’ŒShuffleæ— å…³å“ˆ~<br><br>è¿™é‡Œçš„ç—‡ç»“ï¼Œå…¶å®æ˜¯â€œå•æœºæ€ç»´â€å¸¦æ¥çš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯åƒå†™å•æœºä»£ç é‚£æ ·ï¼Œå»å®ç°åˆ†å¸ƒå¼åº”ç”¨ï¼Œä»è€Œå¯¼è‡´åŒä¸€ä»½æ•°æ®é›†è¢«ååå¤å¤åœ°æ‰«æï¼Œä»è€Œå¯¼è‡´æ‰§è¡Œæ•ˆç‡ä½ä¸‹~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1633964078,"ip_address":"","comment_id":315225,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1633755604","product_id":100073401,"comment_content":"è€å¸ˆï¼Œæ¡ˆä¾‹äºŒï¼Œæ­£ä¾‹ä¸­ç”¨çš„joinï¼Œä¼šåšshuffle ,åä¾‹æ˜¯åšéå†ï¼Œå¤§æ•°æ®ä¸‹ï¼Œä¼šä¸ä¼šä¸åšshuffle æ›´å¥½ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527907,"discussion_content":"æ­£åä¾‹å…¶å®éƒ½æœ‰Shuffleï¼Œè¿™é‡Œçš„å¯¹æ¯”ï¼Œå…¶å®å’ŒShuffleæ— å…³å“ˆ~\n\nè¿™é‡Œçš„ç—‡ç»“ï¼Œå…¶å®æ˜¯â€œå•æœºæ€ç»´â€å¸¦æ¥çš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯åƒå†™å•æœºä»£ç é‚£æ ·ï¼Œå»å®ç°åˆ†å¸ƒå¼åº”ç”¨ï¼Œä»è€Œå¯¼è‡´åŒä¸€ä»½æ•°æ®é›†è¢«ååå¤å¤åœ°æ‰«æï¼Œä»è€Œå¯¼è‡´æ‰§è¡Œæ•ˆç‡ä½ä¸‹~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633964078,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":305343,"user_name":"è¾¹è¾¹çˆ±å­¦ä¹ ","can_delete":false,"product_type":"c1","uid":2126965,"ip_address":"","ucode":"3B091043B0E1EC","user_header":"","comment_is_top":false,"comment_ctime":1627912587,"is_pvip":false,"replies":[{"id":"110612","content":"é—®é¢˜æ²¡çœ‹æ‡‚ï¼Œå“ˆå“ˆï¼Œèƒ½å…·ä½“è¯´è¯´å˜›ï¼Ÿ<br><br>æˆ‘çš„ç†è§£æ˜¯ï¼Œ1ï¼‰å­æŸ¥è¯¢é‚£ä¸ªSQLï¼Œå¤–è¡¨table1æ˜¯å…¨è¡¨æ‰«æï¼Œä½†æ˜¯SQLæ‰§è¡Œä¸‹æ¥æ²¡æœ‰éå¸¸æ…¢ï¼Ÿ<br>2ï¼‰inner joinçš„SQLï¼Œå¤–è¡¨table1æ˜¯éƒ¨åˆ†æ‰«æï¼Œç„¶åå‘¢ï¼Ÿ<br><br>ä¸çŸ¥é“æˆ‘ç†è§£çš„å¯¹ä¸å¯¹å“ˆï¼Œæ‰€ä»¥é—®é¢˜æ˜¯å•¥å‘¢ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1628146640,"ip_address":"","comment_id":305343,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1627912587","product_id":100073401,"comment_content":"(1) select partition_col from table1 where partition_col in (select partition_col from table2 where partition_col between 1 and 10)<br>(2) select partition_col from table1 inner join (select partition_col from table2 where partition_col between 1 and 10) r on table1.partition_col = r.partition_col<br>ï¼ˆ1ï¼‰å…¨è¡¨scanï¼Œæ²¡æœ‰éå¸¸æ…¢<br>ï¼ˆ2ï¼‰æŒ‡å®šåˆ†åŒºscan<br>ä¸ºå•¥ä¼šè¿™æ ·å‘¢","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524357,"discussion_content":"é—®é¢˜æ²¡çœ‹æ‡‚ï¼Œå“ˆå“ˆï¼Œèƒ½å…·ä½“è¯´è¯´å˜›ï¼Ÿ\n\næˆ‘çš„ç†è§£æ˜¯ï¼Œ1ï¼‰å­æŸ¥è¯¢é‚£ä¸ªSQLï¼Œå¤–è¡¨table1æ˜¯å…¨è¡¨æ‰«æï¼Œä½†æ˜¯SQLæ‰§è¡Œä¸‹æ¥æ²¡æœ‰éå¸¸æ…¢ï¼Ÿ\n2ï¼‰inner joinçš„SQLï¼Œå¤–è¡¨table1æ˜¯éƒ¨åˆ†æ‰«æï¼Œç„¶åå‘¢ï¼Ÿ\n\nä¸çŸ¥é“æˆ‘ç†è§£çš„å¯¹ä¸å¯¹å“ˆï¼Œæ‰€ä»¥é—®é¢˜æ˜¯å•¥å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628146640,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2347318,"avatar":"https://static001.geekbang.org/account/avatar/00/23/d1/36/8c015107.jpg","nickname":"bee","note":"","ucode":"43CC23663FB156","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555884,"discussion_content":"è€å¸ˆæˆ‘è§‰å¾—ä»–è¯´å¾—æ˜¯ä¸ºä»€ä¹ˆ ç¬¬ä¸€æ¡sql å¯¹äºtable1 ä¼šå…¨è¡¨æ‰«æ ç¬¬äºŒæ¡sqlå¯¹äºtable1 æ¥è¯´åªæ˜¯æ‰«æéƒ¨åˆ†åˆ†åŒº,  æˆ‘è§‰å¾—ç¬¬äºŒæ¡sqlè¿›è¡Œäº†åŠ¨æ€åˆ†åŒºè¿‡æ»¤ æ‰€ä»¥table1 ä¼šåªæ‰«æéƒ¨åˆ†åˆ†åŒº","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647092145,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":284469,"user_name":"æ–¹å¾—å§‹ç»ˆ","can_delete":false,"product_type":"c1","uid":1229356,"ip_address":"","ucode":"6FBEDDACC32EA1","user_header":"https://static001.geekbang.org/account/avatar/00/12/c2/2c/900cb4f0.jpg","comment_is_top":false,"comment_ctime":1616286731,"is_pvip":false,"replies":[{"id":"103167","content":"ä¸Šä¼ åˆ°äº†Bç«™ï¼šhttps:&#47;&#47;www.bilibili.com&#47;video&#47;BV1AX4y1G7Ks&#47;","user_name":"ç¼–è¾‘å›å¤","user_name_real":"ç‹è¹","uid":"1743279","ctime":1616295724,"ip_address":"","comment_id":284469,"utype":2}],"discussion_count":1,"race_medal":0,"score":"1616286731","product_id":100073401,"comment_content":"é”™è¿‡äº†è€å¸ˆä¸Šæ˜ŸæœŸçš„ç›´æ’­ï¼Œè¯·é—®åœ¨å“ªé‡Œå¯ä»¥çœ‹åˆ°å›æ”¾å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1743279,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/99/af/e4cc7374.jpg","nickname":"å•Šå‘œ","note":"","ucode":"76E24AB808868D","race_medal":0,"user_type":4,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517360,"discussion_content":"ä¸Šä¼ åˆ°äº†Bç«™ï¼šhttps://www.bilibili.com/video/BV1AX4y1G7Ks/","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616295724,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":284370,"user_name":"æ–¹å¾—å§‹ç»ˆ","can_delete":false,"product_type":"c1","uid":1229356,"ip_address":"","ucode":"6FBEDDACC32EA1","user_header":"https://static001.geekbang.org/account/avatar/00/12/c2/2c/900cb4f0.jpg","comment_is_top":false,"comment_ctime":1616216828,"is_pvip":false,"replies":[{"id":"103154","content":"å¯ä»¥çš„ï¼Œåé¢ä¼šç»Ÿä¸€æ”¾åˆ°gitä¸Šï¼Œæ–¹ä¾¿å¤§å®¶æŸ¥é˜…ã€‚å¯¹ï¼Œç›®å‰ä¸“æ é‡Œçš„ä»£ç ç¤ºä¾‹éƒ½æ˜¯Scalaï¼Œä¸»è¦æ˜¯ç®€æ´ï¼Œç”¨å¾ˆçŸ­çš„ä»£ç å°±èƒ½ç¤ºæ„ã€‚å¦‚æœä¹ æƒ¯ç”¨pysparkå¼€å‘ï¼Œå…¶å®ä¸ç”¨åˆ»æ„å»å­¦Scalaï¼ŒAPIå…¶å®å¤§åŒå°å¼‚ï¼ŒåŒºåˆ«ä¸å¤§ã€‚pysparkæ¯”è¾ƒç†Ÿæ‚‰çš„è¯ï¼ŒScalaçš„ä»£ç ä¹Ÿå¾ˆå®¹æ˜“çœ‹æ‡‚ï½ å¦å¤–ï¼Œæ‰§è¡Œæ€§èƒ½pysparkä¹Ÿä¸å·®ï¼Œå’ŒScalaï¼ŒJavaç›¸å½“ã€‚é™¤äº†udféœ€è¦è·¨è¿›ç¨‹ã€æœ‰ä¸€äº›å¼€é”€ä¹‹å¤–ï¼Œæ•´ä½“è¿˜å¥½ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1616283901,"ip_address":"","comment_id":284370,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1616216828","product_id":100073401,"comment_content":"ä»£ç ä¼šé›†ä¸­æ”¾åˆ°GitHubä¸Šé¢å—ï¼Ÿè¿™æ ·æ–¹ä¾¿äºä»¥åå­¦ä¹ æŸ¥æ‰¾ã€‚æˆ‘ä¸»è¦ç”¨ pyspark, è¿™ä¸ªè¯¾ç¨‹åªç”¨Scalaå—ï¼Ÿè¯·é—®æœ‰å…³äºScala sparkçš„å…¥é—¨æ•™ç¨‹å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517322,"discussion_content":"å¯ä»¥çš„ï¼Œåé¢ä¼šç»Ÿä¸€æ”¾åˆ°gitä¸Šï¼Œæ–¹ä¾¿å¤§å®¶æŸ¥é˜…ã€‚å¯¹ï¼Œç›®å‰ä¸“æ é‡Œçš„ä»£ç ç¤ºä¾‹éƒ½æ˜¯Scalaï¼Œä¸»è¦æ˜¯ç®€æ´ï¼Œç”¨å¾ˆçŸ­çš„ä»£ç å°±èƒ½ç¤ºæ„ã€‚å¦‚æœä¹ æƒ¯ç”¨pysparkå¼€å‘ï¼Œå…¶å®ä¸ç”¨åˆ»æ„å»å­¦Scalaï¼ŒAPIå…¶å®å¤§åŒå°å¼‚ï¼ŒåŒºåˆ«ä¸å¤§ã€‚pysparkæ¯”è¾ƒç†Ÿæ‚‰çš„è¯ï¼ŒScalaçš„ä»£ç ä¹Ÿå¾ˆå®¹æ˜“çœ‹æ‡‚ï½ å¦å¤–ï¼Œæ‰§è¡Œæ€§èƒ½pysparkä¹Ÿä¸å·®ï¼Œå’ŒScalaï¼ŒJavaç›¸å½“ã€‚é™¤äº†udféœ€è¦è·¨è¿›ç¨‹ã€æœ‰ä¸€äº›å¼€é”€ä¹‹å¤–ï¼Œæ•´ä½“è¿˜å¥½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616283901,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2162751,"avatar":"https://static001.geekbang.org/account/avatar/00/21/00/3f/a0f84788.jpg","nickname":"Sean","note":"","ucode":"69234046BFD81B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387778,"discussion_content":"æƒ³é—®ä¸€ä¸‹ ä¸“æ çš„è¿™å—ä»£ç gitåœ°å€å¯ä»¥å‘ä¸€ä¸‹å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628408923,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":2162751,"avatar":"https://static001.geekbang.org/account/avatar/00/21/00/3f/a0f84788.jpg","nickname":"Sean","note":"","ucode":"69234046BFD81B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":404361,"discussion_content":"https://github.com/wulei-bj-cn/potatoes.git","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634292901,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":387778,"ip_address":""},"score":404361,"extra":""}]}]},{"had_liked":false,"id":284004,"user_name":"å¤©æ¸¡","can_delete":false,"product_type":"c1","uid":1322829,"ip_address":"","ucode":"B4D031E05E266E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJrZb9pm07aicqH4rErIanMN5owmsBO6rWa6VSkpFMFjVRKOKkNM6JEf2gvQ2g23xUiammg7PUykJFA/132","comment_is_top":false,"comment_ctime":1616035083,"is_pvip":false,"replies":[{"id":"103036","content":"å¹¿æ’­çš„æ€è·¯æ²¡é—®é¢˜ï½ ","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1616050825,"ip_address":"","comment_id":284004,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1616035083","product_id":100073401,"comment_content":"å¯å¦å°†å°è¡¨è¿›è¡Œbroadcastï¼Œå°†reduceç«¯joinå˜ä¸ºmapç«¯joinã€‚","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517201,"discussion_content":"å¹¿æ’­çš„æ€è·¯æ²¡é—®é¢˜ï½ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616050825,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":283720,"user_name":"Shockang","can_delete":false,"product_type":"c1","uid":1263546,"ip_address":"","ucode":"B871D731F6E6B1","user_header":"https://static001.geekbang.org/account/avatar/00/13/47/ba/d36340c1.jpg","comment_is_top":false,"comment_ctime":1615896430,"is_pvip":false,"replies":[{"id":"102978","content":"case1çš„å‰¯ä½œç”¨æœ¬èº«å…¶å®è¿˜å¥½ï¼Œä¸»è¦æ˜¯å®ƒå¼•å…¥çš„å¼€é”€ï¼Œå°±æ˜¯ä½ è¯´çš„æ€§èƒ½æŸè€—ã€‚case2çš„å¹¿æ’­æ€è·¯æ²¡é—®é¢˜ï½ <br><br>coalesceè¿™é‡Œæœ‰å¾…å•†æ¦·å“ˆï¼Œæ­£ä¾‹é‡Œé¢å·²ç»æ²¡æœ‰filterï¼Œåä¾‹é‡Œé¢åŠ coalesceä¹Ÿäºäº‹æ— è¡¥ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1615963203,"ip_address":"","comment_id":283720,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1615896430","product_id":100073401,"comment_content":"Case1é‡Œé¢é™¤äº†è€å¸ˆè®²çš„å‰¯ä½œç”¨å¤–ï¼Œæˆ‘è®¤ä¸ºScalaåœ¨å¤„ç†é—­åŒ…æ—¶ä¹Ÿä¼šå­˜åœ¨ä¸€å®šçš„æ€§èƒ½æŸè€—ï¼ŒCase2é‡Œé¢æŠŠå¤§å˜é‡å¹¿æ’­å‡ºå»æ˜¯ä¸€ç§å¸¸è§çš„æ“ä½œï¼Œå¦å¤–ï¼Œfilterä¹‹ååŠ ä¸Šcoalesce ä¹Ÿæ˜¯æ¯”è¾ƒå¸¸è§çš„ä¼˜åŒ–æ‰‹æ®µ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517127,"discussion_content":"case1çš„å‰¯ä½œç”¨æœ¬èº«å…¶å®è¿˜å¥½ï¼Œä¸»è¦æ˜¯å®ƒå¼•å…¥çš„å¼€é”€ï¼Œå°±æ˜¯ä½ è¯´çš„æ€§èƒ½æŸè€—ã€‚case2çš„å¹¿æ’­æ€è·¯æ²¡é—®é¢˜ï½ \n\ncoalesceè¿™é‡Œæœ‰å¾…å•†æ¦·å“ˆï¼Œæ­£ä¾‹é‡Œé¢å·²ç»æ²¡æœ‰filterï¼Œåä¾‹é‡Œé¢åŠ coalesceä¹Ÿäºäº‹æ— è¡¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615963203,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":283666,"user_name":"rb@31","can_delete":false,"product_type":"c1","uid":1177418,"ip_address":"","ucode":"F5990804D55D96","user_header":"","comment_is_top":false,"comment_ctime":1615876121,"is_pvip":false,"replies":[{"id":"102935","content":"ä½ å¥½ï¼Œè¯¾ç¨‹è¯¦æƒ…é¡µå¤„æœ‰æ›´æ–°å®‰æ’å“¦ï¼Œæ¯å‘¨ä¸€ï¼Œä¸‰ï¼Œäº”æ›´æ–°ã€‚é¢„è®¡æ›´æ–°åˆ°5æœˆä»½","user_name":"ç¼–è¾‘å›å¤","user_name_real":"ç‹è¹","uid":"1743279","ctime":1615883214,"ip_address":"","comment_id":283666,"utype":2}],"discussion_count":1,"race_medal":0,"score":"1615876121","product_id":100073401,"comment_content":"å¦å¤–ï¼Œä¸çŸ¥é“è€å¸ˆçš„æ›´æ–°é¢‘ç‡ã€‚å¤§æ¦‚å¤šä¹…èƒ½å…¨éƒ¨æ›´æ–°å¥½ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1743279,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/99/af/e4cc7374.jpg","nickname":"å•Šå‘œ","note":"","ucode":"76E24AB808868D","race_medal":0,"user_type":4,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517106,"discussion_content":"ä½ å¥½ï¼Œè¯¾ç¨‹è¯¦æƒ…é¡µå¤„æœ‰æ›´æ–°å®‰æ’å“¦ï¼Œæ¯å‘¨ä¸€ï¼Œä¸‰ï¼Œäº”æ›´æ–°ã€‚é¢„è®¡æ›´æ–°åˆ°5æœˆä»½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615883214,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]}]}]}