{"id":103358,"title":"22 | å¹¶å‘ç¼–ç¨‹ä¹‹Asyncio","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æ™¯éœ„ã€‚</p><p>ä¸ŠèŠ‚è¯¾ï¼Œæˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†Pythonå¹¶å‘ç¼–ç¨‹çš„ä¸€ç§å®ç°â€”â€”å¤šçº¿ç¨‹ã€‚ä»Šå¤©è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬ç»§ç»­å­¦ä¹ Pythonå¹¶å‘ç¼–ç¨‹çš„å¦ä¸€ç§å®ç°æ–¹å¼â€”â€”Asyncioã€‚ä¸åŒäºåç¨‹é‚£ç« ï¼Œè¿™èŠ‚è¯¾æˆ‘ä»¬æ›´æ³¨é‡åŸç†çš„ç†è§£ã€‚</p><p>é€šè¿‡ä¸ŠèŠ‚è¯¾çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œåœ¨å¤„ç†I/Oæ“ä½œæ—¶ï¼Œä½¿ç”¨å¤šçº¿ç¨‹ä¸æ™®é€šçš„å•çº¿ç¨‹ç›¸æ¯”ï¼Œæ•ˆç‡å¾—åˆ°äº†æå¤§çš„æé«˜ã€‚ä½ å¯èƒ½ä¼šæƒ³ï¼Œæ—¢ç„¶è¿™æ ·ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦Asyncioï¼Ÿ</p><p>è¯šç„¶ï¼Œå¤šçº¿ç¨‹æœ‰è¯¸å¤šä¼˜ç‚¹ä¸”åº”ç”¨å¹¿æ³›ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€å®šçš„å±€é™æ€§ï¼š</p><ul>\n<li>æ¯”å¦‚ï¼Œå¤šçº¿ç¨‹è¿è¡Œè¿‡ç¨‹å®¹æ˜“è¢«æ‰“æ–­ï¼Œå› æ­¤æœ‰å¯èƒ½å‡ºç°race conditionçš„æƒ…å†µï¼›</li>\n<li>å†å¦‚ï¼Œçº¿ç¨‹åˆ‡æ¢æœ¬èº«å­˜åœ¨ä¸€å®šçš„æŸè€—ï¼Œçº¿ç¨‹æ•°ä¸èƒ½æ— é™å¢åŠ ï¼Œå› æ­¤ï¼Œå¦‚æœä½ çš„ I/Oæ“ä½œéå¸¸heavyï¼Œå¤šçº¿ç¨‹å¾ˆæœ‰å¯èƒ½æ»¡è¶³ä¸äº†é«˜æ•ˆç‡ã€é«˜è´¨é‡çš„éœ€æ±‚ã€‚</li>\n</ul><p>æ­£æ˜¯ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼ŒAsyncioåº”è¿è€Œç”Ÿã€‚</p><h2>ä»€ä¹ˆæ˜¯Asyncio</h2><h3>Sync VS Async</h3><p>æˆ‘ä»¬é¦–å…ˆæ¥åŒºåˆ†ä¸€ä¸‹Syncï¼ˆåŒæ­¥ï¼‰å’ŒAsyncï¼ˆå¼‚æ­¥ï¼‰çš„æ¦‚å¿µã€‚</p><ul>\n<li>æ‰€è°“Syncï¼Œæ˜¯æŒ‡æ“ä½œä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ‰§è¡Œï¼Œä¸‹ä¸€ä¸ªæ“ä½œå¿…é¡»ç­‰ä¸Šä¸€ä¸ªæ“ä½œå®Œæˆåæ‰èƒ½æ‰§è¡Œã€‚</li>\n<li>è€ŒAsyncæ˜¯æŒ‡ä¸åŒæ“ä½œé—´å¯ä»¥ç›¸äº’äº¤æ›¿æ‰§è¡Œï¼Œå¦‚æœå…¶ä¸­çš„æŸä¸ªæ“ä½œè¢«blockäº†ï¼Œç¨‹åºå¹¶ä¸ä¼šç­‰å¾…ï¼Œè€Œæ˜¯ä¼šæ‰¾å‡ºå¯æ‰§è¡Œçš„æ“ä½œç»§ç»­æ‰§è¡Œã€‚</li>\n</ul><p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œä½ çš„è€æ¿è®©ä½ åšä¸€ä»½è¿™ä¸ªå­£åº¦çš„æŠ¥è¡¨ï¼Œå¹¶ä¸”é‚®ä»¶å‘ç»™ä»–ã€‚</p><!-- [[[read_end]]] --><ul>\n<li>å¦‚æœæŒ‰ç…§Syncçš„æ–¹å¼ï¼Œä½ ä¼šå…ˆå‘è½¯ä»¶è¾“å…¥è¿™ä¸ªå­£åº¦çš„å„é¡¹æ•°æ®ï¼Œæ¥ä¸‹æ¥ç­‰å¾…5minï¼Œç­‰æŠ¥è¡¨æ˜ç»†ç”Ÿæˆåï¼Œå†å†™é‚®ä»¶å‘ç»™ä»–ã€‚</li>\n<li>ä½†å¦‚æœæŒ‰ç…§Asyncçš„æ–¹å¼ï¼Œå†ä½ è¾“å®Œè¿™ä¸ªå­£åº¦çš„å„é¡¹æ•°æ®åï¼Œä¾¿ä¼šå¼€å§‹å†™é‚®ä»¶ã€‚ç­‰æŠ¥è¡¨æ˜ç»†ç”Ÿæˆåï¼Œä½ ä¼šæš‚åœé‚®ä»¶ï¼Œå…ˆå»æŸ¥çœ‹æŠ¥è¡¨ï¼Œç¡®è®¤åç»§ç»­å†™é‚®ä»¶ç›´åˆ°å‘é€å®Œæ¯•ã€‚</li>\n</ul><h3>Asyncioå·¥ä½œåŸç†</h3><p>æ˜ç™½äº†Sync å’ŒAsyncï¼Œå›åˆ°æˆ‘ä»¬ä»Šå¤©çš„ä¸»é¢˜ï¼Œåˆ°åº•ä»€ä¹ˆæ˜¯Asyncioå‘¢ï¼Ÿ</p><p>äº‹å®ä¸Šï¼ŒAsyncioå’Œå…¶ä»–Pythonç¨‹åºä¸€æ ·ï¼Œæ˜¯å•çº¿ç¨‹çš„ï¼Œå®ƒåªæœ‰ä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œä½†æ˜¯å¯ä»¥è¿›è¡Œå¤šä¸ªä¸åŒçš„ä»»åŠ¡ï¼ˆtaskï¼‰ï¼Œè¿™é‡Œçš„ä»»åŠ¡ï¼Œå°±æ˜¯ç‰¹æ®Šçš„futureå¯¹è±¡ã€‚è¿™äº›ä¸åŒçš„ä»»åŠ¡ï¼Œè¢«ä¸€ä¸ªå«åševent loopçš„å¯¹è±¡æ‰€æ§åˆ¶ã€‚ä½ å¯ä»¥æŠŠè¿™é‡Œçš„ä»»åŠ¡ï¼Œç±»æ¯”æˆå¤šçº¿ç¨‹ç‰ˆæœ¬é‡Œçš„å¤šä¸ªçº¿ç¨‹ã€‚</p><p>ä¸ºäº†ç®€åŒ–è®²è§£è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾ä»»åŠ¡åªæœ‰ä¸¤ä¸ªçŠ¶æ€ï¼šä¸€æ˜¯é¢„å¤‡çŠ¶æ€ï¼›äºŒæ˜¯ç­‰å¾…çŠ¶æ€ã€‚æ‰€è°“çš„é¢„å¤‡çŠ¶æ€ï¼Œæ˜¯æŒ‡ä»»åŠ¡ç›®å‰ç©ºé—²ï¼Œä½†éšæ—¶å¾…å‘½å‡†å¤‡è¿è¡Œã€‚è€Œç­‰å¾…çŠ¶æ€ï¼Œæ˜¯æŒ‡ä»»åŠ¡å·²ç»è¿è¡Œï¼Œä½†æ­£åœ¨ç­‰å¾…å¤–éƒ¨çš„æ“ä½œå®Œæˆï¼Œæ¯”å¦‚I/Oæ“ä½œã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œevent loopä¼šç»´æŠ¤ä¸¤ä¸ªä»»åŠ¡åˆ—è¡¨ï¼Œåˆ†åˆ«å¯¹åº”è¿™ä¸¤ç§çŠ¶æ€ï¼›å¹¶ä¸”é€‰å–é¢„å¤‡çŠ¶æ€çš„ä¸€ä¸ªä»»åŠ¡ï¼ˆå…·ä½“é€‰å–å“ªä¸ªä»»åŠ¡ï¼Œå’Œå…¶ç­‰å¾…çš„æ—¶é—´é•¿çŸ­ã€å ç”¨çš„èµ„æºç­‰ç­‰ç›¸å…³ï¼‰ï¼Œä½¿å…¶è¿è¡Œï¼Œä¸€ç›´åˆ°è¿™ä¸ªä»»åŠ¡æŠŠæ§åˆ¶æƒäº¤è¿˜ç»™event loopä¸ºæ­¢ã€‚</p><p>å½“ä»»åŠ¡æŠŠæ§åˆ¶æƒäº¤è¿˜ç»™event loopæ—¶ï¼Œevent loopä¼šæ ¹æ®å…¶æ˜¯å¦å®Œæˆï¼ŒæŠŠä»»åŠ¡æ”¾åˆ°é¢„å¤‡æˆ–ç­‰å¾…çŠ¶æ€çš„åˆ—è¡¨ï¼Œç„¶åéå†ç­‰å¾…çŠ¶æ€åˆ—è¡¨çš„ä»»åŠ¡ï¼ŒæŸ¥çœ‹ä»–ä»¬æ˜¯å¦å®Œæˆã€‚</p><ul>\n<li>å¦‚æœå®Œæˆï¼Œåˆ™å°†å…¶æ”¾åˆ°é¢„å¤‡çŠ¶æ€çš„åˆ—è¡¨ï¼›</li>\n<li>å¦‚æœæœªå®Œæˆï¼Œåˆ™ç»§ç»­æ”¾åœ¨ç­‰å¾…çŠ¶æ€çš„åˆ—è¡¨ã€‚</li>\n</ul><p>è€ŒåŸå…ˆåœ¨é¢„å¤‡çŠ¶æ€åˆ—è¡¨çš„ä»»åŠ¡ä½ç½®ä»æ—§ä¸å˜ï¼Œå› ä¸ºå®ƒä»¬è¿˜æœªè¿è¡Œã€‚</p><p>è¿™æ ·ï¼Œå½“æ‰€æœ‰ä»»åŠ¡è¢«é‡æ–°æ”¾ç½®åœ¨åˆé€‚çš„åˆ—è¡¨åï¼Œæ–°ä¸€è½®çš„å¾ªç¯åˆå¼€å§‹äº†ï¼ševent loopç»§ç»­ä»é¢„å¤‡çŠ¶æ€çš„åˆ—è¡¨ä¸­é€‰å–ä¸€ä¸ªä»»åŠ¡ä½¿å…¶æ‰§è¡Œâ€¦å¦‚æ­¤å‘¨è€Œå¤å§‹ï¼Œç›´åˆ°æ‰€æœ‰ä»»åŠ¡å®Œæˆã€‚</p><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¯¹äºAsyncioæ¥è¯´ï¼Œå®ƒçš„ä»»åŠ¡åœ¨è¿è¡Œæ—¶ä¸ä¼šè¢«å¤–éƒ¨çš„ä¸€äº›å› ç´ æ‰“æ–­ï¼Œå› æ­¤Asyncioå†…çš„æ“ä½œä¸ä¼šå‡ºç°race conditionçš„æƒ…å†µï¼Œè¿™æ ·ä½ å°±ä¸éœ€è¦æ‹…å¿ƒçº¿ç¨‹å®‰å…¨çš„é—®é¢˜äº†ã€‚</p><h3>Asyncioç”¨æ³•</h3><p>è®²å®Œäº†Asyncioçš„åŸç†ï¼Œæˆ‘ä»¬ç»“åˆå…·ä½“çš„ä»£ç æ¥çœ‹ä¸€ä¸‹å®ƒçš„ç”¨æ³•ã€‚è¿˜æ˜¯ä»¥ä¸ŠèŠ‚è¯¾ä¸‹è½½ç½‘ç«™å†…å®¹ä¸ºä¾‹ï¼Œç”¨Asyncioçš„å†™æ³•æˆ‘æ”¾åœ¨äº†ä¸‹é¢ä»£ç ä¸­ï¼ˆçœç•¥äº†å¼‚å¸¸å¤„ç†çš„ä¸€äº›æ“ä½œï¼‰ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·æ¥çœ‹ï¼š</p><pre><code>import asyncio\nimport aiohttp\nimport time\n\nasync def download_one(url):\n    async with aiohttp.ClientSession() as session:\n        async with session.get(url) as resp:\n            print('Read {} from {}'.format(resp.content_length, url))\n\nasync def download_all(sites):\n    tasks = [asyncio.create_task(download_one(site)) for site in sites]\n    await asyncio.gather(*tasks)\n\ndef main():\n    sites = [\n        'https://en.wikipedia.org/wiki/Portal:Arts',\n        'https://en.wikipedia.org/wiki/Portal:History',\n        'https://en.wikipedia.org/wiki/Portal:Society',\n        'https://en.wikipedia.org/wiki/Portal:Biography',\n        'https://en.wikipedia.org/wiki/Portal:Mathematics',\n        'https://en.wikipedia.org/wiki/Portal:Technology',\n        'https://en.wikipedia.org/wiki/Portal:Geography',\n        'https://en.wikipedia.org/wiki/Portal:Science',\n        'https://en.wikipedia.org/wiki/Computer_science',\n        'https://en.wikipedia.org/wiki/Python_(programming_language)',\n        'https://en.wikipedia.org/wiki/Java_(programming_language)',\n        'https://en.wikipedia.org/wiki/PHP',\n        'https://en.wikipedia.org/wiki/Node.js',\n        'https://en.wikipedia.org/wiki/The_C_Programming_Language',\n        'https://en.wikipedia.org/wiki/Go_(programming_language)'\n    ]\n    start_time = time.perf_counter()\n    asyncio.run(download_all(sites))\n    end_time = time.perf_counter()\n    print('Download {} sites in {} seconds'.format(len(sites), end_time - start_time))\n    \nif __name__ == '__main__':\n    main()\n\n## è¾“å‡º\nRead 63153 from https://en.wikipedia.org/wiki/Java_(programming_language)\nRead 31461 from https://en.wikipedia.org/wiki/Portal:Society\nRead 23965 from https://en.wikipedia.org/wiki/Portal:Biography\nRead 36312 from https://en.wikipedia.org/wiki/Portal:History\nRead 25203 from https://en.wikipedia.org/wiki/Portal:Arts\nRead 15160 from https://en.wikipedia.org/wiki/The_C_Programming_Language\nRead 28749 from https://en.wikipedia.org/wiki/Portal:Mathematics\nRead 29587 from https://en.wikipedia.org/wiki/Portal:Technology\nRead 79318 from https://en.wikipedia.org/wiki/PHP\nRead 30298 from https://en.wikipedia.org/wiki/Portal:Geography\nRead 73914 from https://en.wikipedia.org/wiki/Python_(programming_language)\nRead 62218 from https://en.wikipedia.org/wiki/Go_(programming_language)\nRead 22318 from https://en.wikipedia.org/wiki/Portal:Science\nRead 36800 from https://en.wikipedia.org/wiki/Node.js\nRead 67028 from https://en.wikipedia.org/wiki/Computer_science\nDownload 15 sites in 0.062144195078872144 seconds\n</code></pre><p>è¿™é‡Œçš„Asyncå’Œawaitå…³é”®å­—æ˜¯Asyncioçš„æœ€æ–°å†™æ³•ï¼Œè¡¨ç¤ºè¿™ä¸ªè¯­å¥/å‡½æ•°æ˜¯non-blockçš„ï¼Œæ­£å¥½å¯¹åº”å‰é¢æ‰€è®²çš„event loopçš„æ¦‚å¿µã€‚å¦‚æœä»»åŠ¡æ‰§è¡Œçš„è¿‡ç¨‹éœ€è¦ç­‰å¾…ï¼Œåˆ™å°†å…¶æ”¾å…¥ç­‰å¾…çŠ¶æ€çš„åˆ—è¡¨ä¸­ï¼Œç„¶åç»§ç»­æ‰§è¡Œé¢„å¤‡çŠ¶æ€åˆ—è¡¨é‡Œçš„ä»»åŠ¡ã€‚</p><p>ä¸»å‡½æ•°é‡Œçš„asyncio.run(coro)æ˜¯Asyncioçš„root callï¼Œè¡¨ç¤ºæ‹¿åˆ°event loopï¼Œè¿è¡Œè¾“å…¥çš„coroï¼Œç›´åˆ°å®ƒç»“æŸï¼Œæœ€åå…³é—­è¿™ä¸ªevent loopã€‚äº‹å®ä¸Šï¼Œasyncio.run()æ˜¯Python3.7+æ‰å¼•å…¥çš„ï¼Œç›¸å½“äºè€ç‰ˆæœ¬çš„ä»¥ä¸‹è¯­å¥ï¼š</p><pre><code>loop = asyncio.get_event_loop()\ntry:\n    loop.run_until_complete(coro)\nfinally:\n    loop.close()\n</code></pre><p>è‡³äºAsyncioç‰ˆæœ¬çš„å‡½æ•°download_all()ï¼Œå’Œä¹‹å‰å¤šçº¿ç¨‹ç‰ˆæœ¬æœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼š</p><pre><code>tasks = [asyncio.create_task(download_one(site)) for site in sites]\nawait asyncio.gather(*task)\n</code></pre><p>è¿™é‡Œçš„<code>asyncio.create_task(coro)</code>ï¼Œè¡¨ç¤ºå¯¹è¾“å…¥çš„åç¨‹coroåˆ›å»ºä¸€ä¸ªä»»åŠ¡ï¼Œå®‰æ’å®ƒçš„æ‰§è¡Œï¼Œå¹¶è¿”å›æ­¤ä»»åŠ¡å¯¹è±¡ã€‚è¿™ä¸ªå‡½æ•°ä¹Ÿæ˜¯Python 3.7+æ–°å¢çš„ï¼Œå¦‚æœæ˜¯ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œä½ å¯ä»¥ç”¨<code>asyncio.ensure_future(coro)</code>ç­‰æ•ˆæ›¿ä»£ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæˆ‘ä»¬å¯¹æ¯ä¸€ä¸ªç½‘ç«™çš„ä¸‹è½½ï¼Œéƒ½åˆ›å»ºäº†ä¸€ä¸ªå¯¹åº”çš„ä»»åŠ¡ã€‚</p><p>å†å¾€ä¸‹çœ‹ï¼Œ<code>asyncio.gather(*aws, loop=None, return_exception=False)</code>ï¼Œåˆ™è¡¨ç¤ºåœ¨event loopä¸­è¿è¡Œ<code>awsåºåˆ—</code>çš„æ‰€æœ‰ä»»åŠ¡ã€‚å½“ç„¶ï¼Œé™¤äº†ä¾‹å­ä¸­ç”¨åˆ°çš„è¿™å‡ ä¸ªå‡½æ•°ï¼ŒAsyncioè¿˜æä¾›äº†å¾ˆå¤šå…¶ä»–çš„ç”¨æ³•ï¼Œä½ å¯ä»¥æŸ¥çœ‹  <a href=\"https://docs.python.org/3/library/asyncio-eventloop.html\">ç›¸åº”æ–‡æ¡£</a>  è¿›è¡Œäº†è§£ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹æœ€åçš„è¾“å‡ºç»“æœâ€”â€”ç”¨æ—¶åªæœ‰0.06sï¼Œæ•ˆç‡æ¯”èµ·ä¹‹å‰çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œå¯ä»¥è¯´æ˜¯æ›´ä¸Šä¸€å±‚æ¥¼ï¼Œå……åˆ†ä½“ç°å…¶ä¼˜åŠ¿ã€‚</p><h2>Asyncioæœ‰ç¼ºé™·å—ï¼Ÿ</h2><p>å­¦äº†è¿™ä¹ˆå¤šå†…å®¹ï¼Œæˆ‘ä»¬è®¤è¯†åˆ°äº†Asyncioçš„å¼ºå¤§ï¼Œä½†ä½ è¦æ¸…æ¥šï¼Œä»»ä½•ä¸€ç§æ–¹æ¡ˆéƒ½ä¸æ˜¯å®Œç¾çš„ï¼Œéƒ½å­˜åœ¨ä¸€å®šçš„å±€é™æ€§ï¼ŒAsyncioåŒæ ·å¦‚æ­¤ã€‚</p><p>å®é™…å·¥ä½œä¸­ï¼Œæƒ³ç”¨å¥½Asyncioï¼Œç‰¹åˆ«æ˜¯å‘æŒ¥å…¶å¼ºå¤§çš„åŠŸèƒ½ï¼Œå¾ˆå¤šæƒ…å†µä¸‹å¿…é¡»å¾—æœ‰ç›¸åº”çš„Pythonåº“æ”¯æŒã€‚ä½ å¯èƒ½æ³¨æ„åˆ°äº†ï¼Œä¸ŠèŠ‚è¯¾çš„å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯requestsåº“ï¼Œä½†ä»Šå¤©æˆ‘ä»¬å¹¶æ²¡æœ‰ä½¿ç”¨ï¼Œè€Œæ˜¯ç”¨äº†aiohttpåº“ï¼ŒåŸå› å°±æ˜¯requestsåº“å¹¶ä¸å…¼å®¹Asyncioï¼Œä½†æ˜¯aiohttpåº“å…¼å®¹ã€‚</p><p>Asyncioè½¯ä»¶åº“çš„å…¼å®¹æ€§é—®é¢˜ï¼Œåœ¨Python3çš„æ—©æœŸä¸€ç›´æ˜¯ä¸ªå¤§é—®é¢˜ï¼Œä½†æ˜¯éšç€æŠ€æœ¯çš„å‘å±•ï¼Œè¿™ä¸ªé—®é¢˜æ­£é€æ­¥å¾—åˆ°è§£å†³ã€‚</p><p>å¦å¤–ï¼Œä½¿ç”¨Asyncioæ—¶ï¼Œå› ä¸ºä½ åœ¨ä»»åŠ¡çš„è°ƒåº¦æ–¹é¢æœ‰äº†æ›´å¤§çš„è‡ªä¸»æƒï¼Œå†™ä»£ç æ—¶å°±å¾—æ›´åŠ æ³¨æ„ï¼Œä¸ç„¶å¾ˆå®¹æ˜“å‡ºé”™ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ éœ€è¦awaitä¸€ç³»åˆ—çš„æ“ä½œï¼Œå°±å¾—ä½¿ç”¨asyncio.gather()ï¼›å¦‚æœåªæ˜¯å•ä¸ªçš„futureï¼Œæˆ–è®¸åªç”¨asyncio.wait()å°±å¯ä»¥äº†ã€‚é‚£ä¹ˆï¼Œå¯¹äºä½ çš„futureï¼Œä½ æ˜¯æƒ³è¦è®©å®ƒrun_until_complete()è¿˜æ˜¯run_forever()å‘¢ï¼Ÿè¯¸å¦‚æ­¤ç±»ï¼Œéƒ½æ˜¯ä½ åœ¨é¢å¯¹å…·ä½“é—®é¢˜æ—¶éœ€è¦è€ƒè™‘çš„ã€‚</p><h2>å¤šçº¿ç¨‹è¿˜æ˜¯Asyncio</h2><p>ä¸çŸ¥ä¸è§‰ï¼Œæˆ‘ä»¬å·²ç»æŠŠå¹¶å‘ç¼–ç¨‹çš„ä¸¤ç§æ–¹å¼éƒ½ç»™å­¦ä¹ å®Œäº†ã€‚ä¸è¿‡ï¼Œé‡åˆ°å®é™…é—®é¢˜æ—¶ï¼Œå¤šçº¿ç¨‹å’ŒAsyncioåˆ°åº•å¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿ</p><p>æ€»çš„æ¥è¯´ï¼Œä½ å¯ä»¥éµå¾ªä»¥ä¸‹ä¼ªä»£ç çš„è§„èŒƒï¼š</p><pre><code>if io_bound:\n    if io_slow:\n        print('Use Asyncio')\n    else:\n        print('Use multi-threading')\nelse if cpu_bound:\n    print('Use multi-processing')\n</code></pre><ul>\n<li>å¦‚æœæ˜¯I/O boundï¼Œå¹¶ä¸”I/Oæ“ä½œå¾ˆæ…¢ï¼Œéœ€è¦å¾ˆå¤šä»»åŠ¡/çº¿ç¨‹ååŒå®ç°ï¼Œé‚£ä¹ˆä½¿ç”¨Asyncioæ›´åˆé€‚ã€‚</li>\n<li>å¦‚æœæ˜¯I/O boundï¼Œä½†æ˜¯I/Oæ“ä½œå¾ˆå¿«ï¼Œåªéœ€è¦æœ‰é™æ•°é‡çš„ä»»åŠ¡/çº¿ç¨‹ï¼Œé‚£ä¹ˆä½¿ç”¨å¤šçº¿ç¨‹å°±å¯ä»¥äº†ã€‚</li>\n<li>å¦‚æœæ˜¯CPU boundï¼Œåˆ™éœ€è¦ä½¿ç”¨å¤šè¿›ç¨‹æ¥æé«˜ç¨‹åºè¿è¡Œæ•ˆç‡ã€‚</li>\n</ul><h2>æ€»ç»“</h2><p>ä»Šå¤©è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†Asyncioçš„åŸç†å’Œç”¨æ³•ï¼Œå¹¶æ¯”è¾ƒäº†Asyncioå’Œå¤šçº¿ç¨‹å„è‡ªçš„ä¼˜ç¼ºç‚¹ã€‚</p><p>ä¸åŒäºå¤šçº¿ç¨‹ï¼ŒAsyncioæ˜¯å•çº¿ç¨‹çš„ï¼Œä½†å…¶å†…éƒ¨event loopçš„æœºåˆ¶ï¼Œå¯ä»¥è®©å®ƒå¹¶å‘åœ°è¿è¡Œå¤šä¸ªä¸åŒçš„ä»»åŠ¡ï¼Œå¹¶ä¸”æ¯”å¤šçº¿ç¨‹äº«æœ‰æ›´å¤§çš„è‡ªä¸»æ§åˆ¶æƒã€‚</p><p>Asyncioä¸­çš„ä»»åŠ¡ï¼Œåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šè¢«æ‰“æ–­ï¼Œå› æ­¤ä¸ä¼šå‡ºç°race conditionçš„æƒ…å†µã€‚å°¤å…¶æ˜¯åœ¨I/Oæ“ä½œheavyçš„åœºæ™¯ä¸‹ï¼ŒAsyncioæ¯”å¤šçº¿ç¨‹çš„è¿è¡Œæ•ˆç‡æ›´é«˜ã€‚å› ä¸ºAsyncioå†…éƒ¨ä»»åŠ¡åˆ‡æ¢çš„æŸè€—ï¼Œè¿œæ¯”çº¿ç¨‹åˆ‡æ¢çš„æŸè€—è¦å°ï¼›å¹¶ä¸”Asyncioå¯ä»¥å¼€å¯çš„ä»»åŠ¡æ•°é‡ï¼Œä¹Ÿæ¯”å¤šçº¿ç¨‹ä¸­çš„çº¿ç¨‹æ•°é‡å¤šå¾—å¤šã€‚</p><p>ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¾ˆå¤šæƒ…å†µä¸‹ï¼Œä½¿ç”¨Asyncioéœ€è¦ç‰¹å®šç¬¬ä¸‰æ–¹åº“çš„æ”¯æŒï¼Œæ¯”å¦‚å‰é¢ç¤ºä¾‹ä¸­çš„aiohttpã€‚è€Œå¦‚æœI/Oæ“ä½œå¾ˆå¿«ï¼Œå¹¶ä¸heavyï¼Œé‚£ä¹ˆè¿ç”¨å¤šçº¿ç¨‹ï¼Œä¹Ÿèƒ½å¾ˆæœ‰æ•ˆåœ°è§£å†³é—®é¢˜ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>è¿™ä¸¤èŠ‚è¯¾ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¹¶å‘ç¼–ç¨‹çš„ä¸¤ç§å®ç°æ–¹å¼ï¼Œä¹Ÿå¤šæ¬¡æåˆ°äº†å¹¶è¡Œç¼–ç¨‹ï¼ˆmulti-processingï¼‰ï¼Œå…¶é€‚ç”¨äºCPU heavyçš„åœºæ™¯ã€‚</p><p>ç°åœ¨æœ‰è¿™ä¹ˆä¸€ä¸ªéœ€æ±‚ï¼šè¾“å…¥ä¸€ä¸ªåˆ—è¡¨ï¼Œå¯¹äºåˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œæˆ‘æƒ³è®¡ç®—0åˆ°è¿™ä¸ªå…ƒç´ çš„æ‰€æœ‰æ•´æ•°çš„å¹³æ–¹å’Œã€‚</p><p>æˆ‘æŠŠå¸¸è§„ç‰ˆæœ¬çš„å†™æ³•æ”¾åœ¨äº†ä¸‹é¢ï¼Œä½ èƒ½é€šè¿‡æŸ¥é˜…èµ„æ–™ï¼Œå†™å‡ºå®ƒçš„å¤šè¿›ç¨‹ç‰ˆæœ¬ï¼Œå¹¶ä¸”æ¯”è¾ƒç¨‹åºçš„è€—æ—¶å—ï¼Ÿ</p><pre><code>import time\ndef cpu_bound(number):\n    print(sum(i * i for i in range(number)))\n\ndef calculate_sums(numbers):\n    for number in numbers:\n        cpu_bound(number)\n\ndef main():\n    start_time = time.perf_counter()  \n    numbers = [10000000 + x for x in range(20)]\n    calculate_sums(numbers)\n    end_time = time.perf_counter()\n    print('Calculation takes {} seconds'.format(end_time - start_time))\n    \nif __name__ == '__main__':\n    main()\n</code></pre><p>æ¬¢è¿åœ¨ç•™è¨€åŒºå†™ä¸‹ä½ çš„æ€è€ƒå’Œç­”æ¡ˆï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠä»Šå¤©çš„å†…å®¹åˆ†äº«ç»™ä½ çš„åŒäº‹æœ‹å‹ï¼Œæˆ‘ä»¬ä¸€èµ·äº¤æµã€ä¸€èµ·è¿›æ­¥ã€‚</p><p></p>","comments":[{"had_liked":false,"id":109540,"user_name":"Jingxiao","can_delete":false,"product_type":"c1","uid":1259521,"ip_address":"","ucode":"EB966BB87132F6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJOlibibPFEWOib8ib7RtfAtxND5FUqCxxoeTuLAbBI9ic23xuwdXT4IyiaWq3Fic9RgEAYI0lBTbEp2rcg/132","comment_is_top":true,"comment_ctime":1562053729,"is_pvip":false,"discussion_count":7,"race_medal":0,"score":"9.2233721457910006e+18","product_id":100026901,"comment_content":"æ€è€ƒé¢˜ç­”æ¡ˆï¼š<br>import multiprocessing<br>import time<br><br><br>def cpu_bound(number):<br>    return sum(i * i for i in range(number))<br><br><br>def find_sums(numbers):<br>    with multiprocessing.Pool() as pool:<br>        pool.map(cpu_bound, numbers)<br><br><br>if __name__ == &quot;__main__&quot;:<br>    numbers = [10000000 + x for x in range(20)]<br><br>    start_time = time.time()<br>    find_sums(numbers)<br>    duration = time.time() - start_time<br>    print(f&quot;Duration {duration} seconds&quot;)","like_count":25,"discussions":[{"author":{"id":1087879,"avatar":"https://static001.geekbang.org/account/avatar/00/10/99/87/98ebb20e.jpg","nickname":"dao","note":"","ucode":"4181FB270462CF","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":328499,"discussion_content":"ç”¨ sysctl -n hw.ncpu å¾—åˆ°ç”µè„‘æ˜¯12æ ¸ï¼Œç„¶åè¿è¡Œä¸‹é¢ä»£ç ï¼Œæ¯”è€å¸ˆçš„æ•ˆç‡æ›´é«˜ã€‚\n--------- \nimport concurrent.futures\nimport time\n\ndef cpu_bound(number):\n    return sum(i * i for i in range(number))\n\ndef main():\n    start_time = time.perf_counter()\n    numbers = [10000000 + x for x in range(20)]\n    with concurrent.futures.ProcessPoolExecutor() as executor:\n        for number in executor.map(cpu_bound, numbers, chunksize=2):\n            print(number)\n    end_time = time.perf_counter()\n    print(&#39;Calculation takes {} seconds&#39;.format(end_time - start_time))\n\nif __name__ == &#39;__main__&#39;:\n    main()\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1606149319,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2257398,"avatar":"https://static001.geekbang.org/account/avatar/00/22/71/f6/0fa1ae6c.jpg","nickname":"ç™½æœ¨ç°é›ª","note":"","ucode":"A42670A623C580","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1087879,"avatar":"https://static001.geekbang.org/account/avatar/00/10/99/87/98ebb20e.jpg","nickname":"dao","note":"","ucode":"4181FB270462CF","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":363552,"discussion_content":"12æ ¸ä¸ºä»€ä¹ˆä½ ç»™chunksizeè®¾äº†2ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617236242,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":328499,"ip_address":""},"score":363552,"extra":""}]},{"author":{"id":1087879,"avatar":"https://static001.geekbang.org/account/avatar/00/10/99/87/98ebb20e.jpg","nickname":"dao","note":"","ucode":"4181FB270462CF","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":328500,"discussion_content":"å¯ä»¥æ ¹æ®ç”µè„‘æ ¸æ•°ï¼Œè°ƒæ•´ chunksize","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606149416,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1919541,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/4a/35/66caeed9.jpg","nickname":"å®Œç¾åšæŒ","note":"","ucode":"AE0261D8DDEF64","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":310408,"discussion_content":"è€å¸ˆï¼Œæˆ‘åœ¨jupyter notebookè¿è¡Œæ‚¨åœ¨ç•™è¨€ä¸­ç»™å‡ºçš„ç­”æ¡ˆä»£ç ï¼Œä¸çŸ¥é“å“ªé‡Œä¸å¯¹ æ²¡æœ‰æŠ¥é”™ä½†æ˜¯ä¸€ç›´å‡ºä¸æ¥ç»“æœ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601818566,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2369413,"avatar":"https://static001.geekbang.org/account/avatar/00/24/27/85/ddeeaf30.jpg","nickname":"dived","note":"","ucode":"141916A3BAF5A1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1919541,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/4a/35/66caeed9.jpg","nickname":"å®Œç¾åšæŒ","note":"","ucode":"AE0261D8DDEF64","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374792,"discussion_content":"å•ç‹¬å†™ä¸€ä¸ª.pyæ–‡ä»¶æ¥è¿è¡Œ æˆ‘çŒœå› ä¸ºæ˜¯å¤šè¿›ç¨‹çš„å…³ç³»ï¼Œéœ€è¦ä¸€ä¸ªç»Ÿä¸€çš„ä¸»å…¥å£æ¥è¿è¡Œç¨‹åº","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621348514,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":310408,"ip_address":""},"score":374792,"extra":""}]},{"author":{"id":1895499,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/ec/4b/442dd5f1.jpg","nickname":"åŠæ™‚è¡Œæ¨‚","note":"","ucode":"2FD0E0BB8327DE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":261009,"discussion_content":"è€å¸ˆï¼Œä½¿ç”¨çš„åº“ä¸åŒï¼ŒmultiProcessingå’Œfutures ç”¨æ—¶ç›¸å·®äº†ä¸ƒå€ï¼ï¼ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588928671,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1186807,"avatar":"https://static001.geekbang.org/account/avatar/00/12/1b/f7/45e8b64a.jpg","nickname":"Fire","note":"","ucode":"4A2C50B77EDB2C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1895499,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/ec/4b/442dd5f1.jpg","nickname":"åŠæ™‚è¡Œæ¨‚","note":"","ucode":"2FD0E0BB8327DE","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293969,"discussion_content":"ç”¨futureså†™çš„å¤šçº¿ç¨‹æˆ–è€…åç¨‹ï¼Ÿåœ¨pythonä¸­è¿™ä¸¤ç§æƒ…å†µä¸‹åªèƒ½ç”¨ä¸Šå•æ ¸cpuè®¡ç®—ï¼ˆå¤šçº¿ç¨‹å› ä¸ºGILå­˜åœ¨åªèƒ½ä½¿ç”¨ä¸€ä¸ªæ ¸ï¼Œä¸€æ ¸è·‘æ»¡ï¼Œå¤šæ ¸å›´è§‚ï¼‰ã€‚è¿™ç§cpuå¯†é›†å‹çš„ç¨‹åºï¼Œç”¨å¤šè¿›ç¨‹èƒ½å®ç°å¹¶è¡Œã€‚åœ¨pythonä¸­çš„å¤šçº¿ç¨‹å’Œåç¨‹åªèƒ½è¯´æ˜¯å¹¶å‘ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595748999,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":261009,"ip_address":""},"score":293969,"extra":""}]}]},{"had_liked":false,"id":108308,"user_name":"helloworld","can_delete":false,"product_type":"c1","uid":1105161,"ip_address":"","ucode":"1EECCA0F43E278","user_header":"https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg","comment_is_top":false,"comment_ctime":1561715899,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"220605047995","product_id":100026901,"comment_content":"æ€»ç»“å¤šçº¿ç¨‹å’Œåç¨‹ä¹‹é—´çš„å…±åŒç‚¹å’ŒåŒºåˆ«ï¼š<br>å…±åŒç‚¹ï¼š<br>éƒ½æ˜¯å¹¶å‘æ“ä½œï¼Œå¤šçº¿ç¨‹åŒä¸€æ—¶é—´ç‚¹åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œï¼Œåç¨‹åŒä¸€æ—¶é—´ç‚¹åªèƒ½æœ‰ä¸€ä¸ªä»»åŠ¡åœ¨æ‰§è¡Œï¼›<br>ä¸åŒç‚¹ï¼š<br>å¤šçº¿ç¨‹ï¼Œæ˜¯åœ¨I&#47;Oé˜»å¡æ—¶é€šè¿‡åˆ‡æ¢çº¿ç¨‹æ¥è¾¾åˆ°å¹¶å‘çš„æ•ˆæœï¼Œåœ¨ä»€ä¹ˆæƒ…å†µä¸‹åšçº¿ç¨‹åˆ‡æ¢æ˜¯ç”±æ“ä½œç³»ç»Ÿæ¥å†³å®šçš„ï¼Œå¼€å‘è€…ä¸ç”¨æ“å¿ƒï¼Œä½†ä¼šé€ æˆrace conditionï¼›<br>åç¨‹ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨I&#47;Oé˜»å¡æ—¶é€šè¿‡åœ¨çº¿ç¨‹å†…åˆ‡æ¢ä»»åŠ¡æ¥è¾¾åˆ°å¹¶å‘çš„æ•ˆæœï¼Œåœ¨ä»€ä¹ˆæƒ…å†µä¸‹åšä»»åŠ¡åˆ‡æ¢æ˜¯å¼€å‘è€…å†³å®šçš„ï¼Œä¸ä¼šæœ‰race conditionçš„æƒ…å†µï¼›<br>å¤šçº¿ç¨‹çš„çº¿ç¨‹åˆ‡æ¢æ¯”åç¨‹çš„ä»»åŠ¡åˆ‡æ¢å¼€é”€æ›´å¤§ï¼›<br>å¯¹äºå¼€å‘è€…è€Œè¨€ï¼Œå¤šçº¿ç¨‹å¹¶å‘çš„ä»£ç æ¯”åç¨‹å¹¶å‘çš„æ›´å®¹æ˜“ä¹¦å†™ã€‚<br>ä¸€èˆ¬æƒ…å†µä¸‹åç¨‹å¹¶å‘çš„å¤„ç†æ•ˆç‡æ¯”å¤šçº¿ç¨‹å¹¶å‘æ›´é«˜ã€‚","like_count":51,"discussions":[{"author":{"id":1316758,"avatar":"https://static001.geekbang.org/account/avatar/00/14/17/96/846fc11b.jpg","nickname":"Richard","note":"","ucode":"893F958B9DD161","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":230715,"discussion_content":"è¯·é—®ä½ æ˜¯æ€ä¹ˆç†è§£â€œåç¨‹ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨I/Oé˜»å¡æ—¶é€šè¿‡åœ¨çº¿ç¨‹å†…åˆ‡æ¢ä»»åŠ¡æ¥è¾¾åˆ°å¹¶å‘çš„æ•ˆæœï¼Œåœ¨ä»€ä¹ˆæƒ…å†µä¸‹åšä»»åŠ¡åˆ‡æ¢æ˜¯å¼€å‘è€…å†³å®šçš„ï¼Œä¸ä¼šæœ‰race conditionçš„æƒ…å†µï¼›â€I/Oé˜»å¡çš„ï¼Ÿçº¿ç¨‹é‡åˆ°é˜»å¡æ—¶ä¼šè®©å‡ºCPUï¼Œå› ä¸ºåç¨‹æ˜¯åœ¨å•çº¿ç¨‹ä¸­ç©çš„ï¼Œé‚£å› ä¸ºä¸€ä¸ªåç¨‹å‘ç”Ÿé˜»å¡ä¼šä½¿æ•´ä¸ªçº¿ç¨‹å¤±å»CPUï¼Œè¿™ä¸ªæ—¶å€™ä»»åŠ¡åˆ‡æ¢ä»ä½•è°ˆèµ·å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586766077,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1105161,"avatar":"https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg","nickname":"helloworld","note":"","ucode":"1EECCA0F43E278","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1316758,"avatar":"https://static001.geekbang.org/account/avatar/00/14/17/96/846fc11b.jpg","nickname":"Richard","note":"","ucode":"893F958B9DD161","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":233560,"discussion_content":"åç¨‹ä¸­çš„æŸä¸ªä»»åŠ¡å‘ç”Ÿioé˜»å¡æ—¶ï¼Œæ˜¯è¿™ä¸ªä»»åŠ¡è®©å‡ºcpuç»™å…¶ä»–ä»»åŠ¡ï¼Œè€Œä¸æ˜¯åç¨‹ï¼ˆå•çº¿ç¨‹ï¼‰è®©å‡ºcpu","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586930661,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":230715,"ip_address":""},"score":233560,"extra":""},{"author":{"id":1316758,"avatar":"https://static001.geekbang.org/account/avatar/00/14/17/96/846fc11b.jpg","nickname":"Richard","note":"","ucode":"893F958B9DD161","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1105161,"avatar":"https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg","nickname":"helloworld","note":"","ucode":"1EECCA0F43E278","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":234800,"discussion_content":"æˆ‘è§‰å¾—ä½ è¿˜æ²¡æœ‰ç†è§£å¥½è¿›ï¼Œçº¿ç¨‹çš„è°ƒåº¦åŸç†ã€‚å…¶å®æˆ‘è¿™å‡ å¤©ç ”ç©¶äº†Pythonçš„åç¨‹ï¼Œå¤§æ¦‚ææ˜ç™½äº†å…¶ä¸­åŸç†ï¼Œè¿™é‡Œçš„â€œé˜»å¡â€œä¸â€œå¼‚æ­¥â€œæ˜¯ä¸€ä¸ªæ›´é«˜å±‚æ¬¡çš„æŠ½è±¡æ¦‚å¿µï¼Œå¹¶éæŒ‡ç³»ç»Ÿè°ƒç”¨çº§åˆ«çš„ã€‚æˆ‘ä¸ºä»€ä¹ˆå¼ºè°ƒâ€œé˜»å¡â€ï¼Œâ€œå¼‚æ­¥â€è¿™äº›æ¦‚å¿µï¼Œå¦‚æœä½ è¯»è¿‡unpé‚£æœ¬ä¹¦ï¼Œè¦ç†è§£unixçš„ioæ¨¡å‹è¿™äº›æ˜¯é¿ä¸å¼€çš„æ¦‚å¿µã€‚ç½‘ä¸Šå¤§éƒ¨åˆ†çš„æ–‡ç« å¼•ç”¨äº†unpçš„å†…å®¹æ¥ä»‹ç»é˜»å¡ï¼Œéé˜»å¡ï¼ŒåŒæ­¥ï¼Œå¼‚æ­¥çš„æ¦‚å¿µï¼Œç´§æ¥ç€ä¾¿ä»‹ç»asyncioåŒ…çš„ä½¿ç”¨ï¼Œå…¶å®asyncioé‡Œé˜»å¡å’Œå¼‚æ­¥çš„æ¦‚å¿µå¹¶ä¸å®Œå…¨ç­‰åŒäºunpä¸­ä»‹ç»çš„ç³»ç»Ÿè°ƒç”¨ioï¼Œæ˜¯åœ¨ä¸€ä¸ªæ›´å¥½çš„æŠ½è±¡å±‚æ¬¡ä¸Šï¼Œä¸€ä¸ªasyncioçš„åç¨‹ä¾ç„¶å¯èƒ½é‡åˆ°åº•å±‚åŒæ­¥çš„ioè°ƒç”¨ï¼Œæ­¤æ—¶è¿™ä¸ªåç¨‹å°±æ˜¯ä¼šé˜»å¡ä½æ•´ä¸ªå½“å‰çº¿ç¨‹ï¼Œä½¿å¾—çº¿ç¨‹å¤±å»CPUï¼Œä»è€Œå½±å“åˆ°å…¶å®ƒçš„åç¨‹ã€‚å…¶å®ä½ ç†è§£çš„ä¹Ÿæ²¡é”™ï¼Œåªæ˜¯é«˜å±‚æŠ½è±¡çš„è§£é‡Šï¼Œä½†å‰ææ˜¯ä½ è¦æ¸…æ¥šä½ æ­¤æ—¶è¯´çš„é˜»å¡æ˜¯ä»€ä¹ˆæ„æ€ï¼Œå®ƒä¸æ˜¯æŒ‡ç³»ç»Ÿè°ƒç”¨çº§åˆ«ï¼Œè€Œæ˜¯ä»»åŠ¡çº§åˆ«çš„æŸäº›æ¡ä»¶ä¸èƒ½æ»¡è¶³çš„æƒ…å†µï¼Œè€Œè¿™äº›ä¸èƒ½æ»¡è¶³çš„æ¡ä»¶å¯èƒ½æ˜¯å…¶å®ƒåç¨‹çš„CPUæ“ä½œï¼Œè€Œä¸æ˜¯ioæ“ä½œã€‚å› ä¸ºä½ è¦æ¸…æ¥šä¸€ä¸ªäº‹å®:ç›®å‰Linuxä¸‹å¯¹å¼‚æ­¥ioçš„æ”¯æŒæ˜¯æœ‰é™çš„ï¼Œå®ƒåªå®ç°äº†ç£ç›˜çš„å¼‚æ­¥ioï¼Œç½‘ç»œioä»ç„¶æ˜¯åŒæ­¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨Linuxä¸Šå¼‚æ­¥ioä½¿ç”¨åœºæ™¯å¾ˆå°‘å¾ˆå°‘ï¼Œä¸šç•Œå‡ ä¹åªæ‹¿å®ƒå½“ä¸ªæ¦‚å¿µæ¥è®²ã€‚å› æ­¤æˆ‘è§‰å¾—Pythonçš„è¿™ä¸ªasyncioåŒ…åæ˜¯ä¸€ä¸ªå¾ˆç³Ÿç³•çš„å‘½åï¼Œç‰¹åˆ«æ˜¯å¯¹äºç†è§£ä¸€ç‚¹ç‚¹åº•å±‚åŸç†çš„äººæ¥è¯´ã€‚å®ƒçš„åç¨‹çœŸçš„å¾ˆéš¾ç†è§£ä¹Ÿå¾ˆéš¾ä½¿ç”¨ï¼Œå¦‚æœä½ ç”¨è¿‡goçš„goroutineä½ å°±æ˜ç™½æˆ‘ä¸ºä»€ä¹ˆå¦‚æ­¤åæ§½Pythonçš„åç¨‹äº†ã€‚è™½ç„¶å®ƒé¿å…äº†çº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„æˆæœ¬ï¼Œé¿å…äº†å¹¶å‘æ—¶çš„é™æ€æ¡ä»¶ï¼Œä½†goçš„çº¿ç¨‹æ¨¡å‹æŸç§ç¨‹åº¦ä¸Šè®²ä¹Ÿé¿å…äº†goroutineçš„åˆ‡æ¢å¼€é”€ï¼Œä»…ä»…éœ€è¦åœ¨å¹¶å‘æ—¶ç…§é¡¾å¥½ç«æ€æ¡ä»¶ï¼Œä½†goå¸¦æ¥çš„ç®€å•æ˜“ç”¨æ€§æ˜¯Pythonçš„åç¨‹æœ›å°˜è«åŠçš„ï¼Œæ‰€ä»¥ç°é˜¶æ®µæˆ‘æ˜¯ä¸ä¼šä½¿ç”¨Pythonçš„åç¨‹çš„ã€‚","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1586999392,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":233560,"ip_address":""},"score":234800,"extra":""}]}]},{"had_liked":false,"id":108323,"user_name":"hlz-123","can_delete":false,"product_type":"c1","uid":1433586,"ip_address":"","ucode":"B7E5EF0C260BD2","user_header":"","comment_is_top":false,"comment_ctime":1561719017,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"113230868713","product_id":100026901,"comment_content":"1ã€å•è¿›ç¨‹ï¼Œè€å¸ˆçš„åŸç¨‹åºï¼Œè¿è¡Œæ—¶é—´<br>     Calculation takes 15.305913339 seconds<br>2ã€CPUå¹¶è¡Œæ–¹å¼ï¼Œè¿è¡Œæ—¶é—´ï¼š<br>     Calculation takes 3.457259904 seconds<br>      def calculate_sums(numbers):    <br>             with concurrent.futures.ProcessPoolExecutor() as executor:<br>             executor.map(cpu_bound,numbers)<br>3ã€å¤šçº¿ç¨‹ï¼Œcocurrent.futuresï¼Œè¿è¡Œæ—¶é—´<br>      Calculation takes 15.331446270999999 seconds<br>      def calculate_sums(numbers):<br>                with concurrent.futures.ThreadPoolExecutor(max_workers=5) as executor:<br>                executor.map(cpu_bound,numbers)<br>4ã€å¼‚æ­¥æ–¹å¼ï¼Œasyncio<br>      Calculation takes 16.019983702999998 seconds<br>      async def cpu_bound(number):<br>            print(sum(i * i for i in range(number)))<br>      async def calculate_sums(numbers):<br>           tasks=[asyncio.create_task(cpu_bound(number)) for number in numbers]<br>           await asyncio.gather(*tasks)","like_count":27,"discussions":[{"author":{"id":3028131,"avatar":"","nickname":"Geek_8d024b","note":"","ucode":"3B9811601B3E71","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576223,"discussion_content":"å¤šçº¿ç¨‹æ—¶é—´å¹¶ä¸ä¼šå‡å°‘ï¼Œå› ä¸ºpythonæ˜¯ä¼ªå¤šçº¿ç¨‹ã€‚åªæœ‰å¤šè¿›ç¨‹è€—æ—¶æ‰ä¼šå‡å°‘","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1655361413,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2087309,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/d9/8d/78dd472a.jpg","nickname":"çŸ¥æ­¢ã€‚","note":"","ucode":"5D56DD062B1A43","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302736,"discussion_content":"ç”¨ asyncio æ–¹æ³•æç¤º  RuntimeWarning: Enable tracemalloc to get the object allocation traceback\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599016213,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1113937,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/51/9d5cfadd.jpg","nickname":"å¥½è¿æ¥","note":"","ucode":"F469ED6CEFEF30","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":2087309,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/d9/8d/78dd472a.jpg","nickname":"çŸ¥æ­¢ã€‚","note":"","ucode":"5D56DD062B1A43","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":307866,"discussion_content":"def main():\n    start_time = time.perf_counter()\n    numbers = [10000000 + x for x in range(20)]\n    asyncio.run(calculate_sums(numbers))\n    end_time = time.perf_counter()\n    print(&#39;Calculation takes {} seconds&#39;.format(end_time - start_time))","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600776503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":302736,"ip_address":""},"score":307866,"extra":""}]},{"author":{"id":1322612,"avatar":"https://static001.geekbang.org/account/avatar/00/14/2e/74/88c613e0.jpg","nickname":"æ‰¶å¹½","note":"","ucode":"1400EDFF8970D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":31182,"discussion_content":"logç§€å•Šï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570885914,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108065,"user_name":"transformation","can_delete":false,"product_type":"c1","uid":1367677,"ip_address":"","ucode":"B47EDE826DE1D0","user_header":"https://static001.geekbang.org/account/avatar/00/14/de/7d/61d76ae0.jpg","comment_is_top":false,"comment_ctime":1561676591,"is_pvip":true,"discussion_count":5,"race_medal":0,"score":"35921414959","product_id":100026901,"comment_content":"import time<br>from concurrent import futures<br><br><br>def cpu_bound(number):<br>    return sum(i * i for i in range(number))<br><br><br>def calculate_sums(numbers):<br>    for number in numbers:<br>        print(cpu_bound(number))<br><br><br>def main():<br>    start_time = time.perf_counter()<br>    numbers = [10000000 + x for x in range(20)]<br>    calculate_sums(numbers)<br>    end_time = time.perf_counter()<br>    print(&#39;Calculation takes {} seconds&#39;.format(end_time - start_time))<br><br><br>def main_process():<br>    start_time = time.perf_counter()<br>    numbers = [10000000 + x for x in range(20)]<br>    with futures.ProcessPoolExecutor() as pe:<br>        result = pe.map(cpu_bound, numbers)<br>        print(f&quot;result: {list(result)}&quot;)<br>    end_time = time.perf_counter()<br>    print(&#39;multiprocessing Calculation takes {} seconds&#39;.format(end_time - start_time))<br><br><br>if __name__ == &#39;__main__&#39;:<br>    main()<br>    main_process()<br>â€”â€”â€”â€”â€”â€”â€”â€”<br>è¾“å‡ºï¼š<br>333333283333335000000<br>333333383333335000000<br>333333483333355000001<br>333333583333395000005<br>333333683333455000014<br>333333783333535000030<br>333333883333635000055<br>333333983333755000091<br>333334083333895000140<br>333334183334055000204<br>333334283334235000285<br>333334383334435000385<br>333334483334655000506<br>333334583334895000650<br>333334683335155000819<br>333334783335435001015<br>333334883335735001240<br>333334983336055001496<br>333335083336395001785<br>333335183336755002109<br>Calculation takes 15.771127400000001 seconds<br>result: [333333283333335000000, 333333383333335000000, 333333483333355000001, 333333583333395000005, 333333683333455000014, 333333783333535000030, 333333883333635000055, 333333983333755000091, 333334083333895000140, 333334183334055000204, 333334283334235000285, 333334383334435000385, 333334483334655000506, 333334583334895000650, 333334683335155000819, 333334783335435001015, 333334883335735001240, 333334983336055001496, 333335083336395001785, 333335183336755002109]<br>multiprocessing Calculation takes 4.7333084 seconds<br>","like_count":8,"discussions":[{"author":{"id":1122308,"avatar":"https://static001.geekbang.org/account/avatar/00/11/20/04/72cc2057.jpg","nickname":"Sunny","note":"","ucode":"90CA0ABBB683FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4611,"discussion_content":"ç›®æµ‹è€å“¥8æ ¸çš„ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565594450,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1367677,"avatar":"https://static001.geekbang.org/account/avatar/00/14/de/7d/61d76ae0.jpg","nickname":"transformation","note":"","ucode":"B47EDE826DE1D0","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1122308,"avatar":"https://static001.geekbang.org/account/avatar/00/11/20/04/72cc2057.jpg","nickname":"Sunny","note":"","ucode":"90CA0ABBB683FA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4671,"discussion_content":"i7 8700","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565650466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":4611,"ip_address":""},"score":4671,"extra":""}]},{"author":{"id":1359389,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/ic76sMTwXTJYJQglBTHVian3OHibEuvGXuRH5QibvwqVIsUNa8pzRYkmsbXjLp1eacN1vC77EVKe4k5u7RRVFb3dOg/132","nickname":"zengyunda","note":"","ucode":"3F08F16FB92C8E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1021,"discussion_content":"éš¾é“æˆ‘ç”µè„‘å¤ªå·®ï¼Ÿæˆ‘å•çº¿ç¨‹æ‰§è¡Œäº†40å·¦å³ï¼Œç”¨å¤šè¿›ç¨‹ä¹Ÿæ‰æ˜¯ä½ æ™®é€šç‰ˆæœ¬çš„æ—¶å»¶ã€‚ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562240717,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1524609,"avatar":"https://static001.geekbang.org/account/avatar/00/17/43/81/8b09dd90.jpg","nickname":"csn","note":"","ucode":"68FAE1EE372ADF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":673,"discussion_content":"print(f&#34;result: {list(result)}&#34;)ï¼Œä¸ºä½•è¿™æ®µä»£ç æ‰§è¡ŒæŠ¥é”™ï¼Œè¯·æŒ‡æ•™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561952256,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1132661,"avatar":"https://static001.geekbang.org/account/avatar/00/11/48/75/02b4366a.jpg","nickname":"ä¹˜åTornadoçš„çº¿ç¨‹é­”æ³•å¸ˆ","note":"","ucode":"C4C9915866E769","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1524609,"avatar":"https://static001.geekbang.org/account/avatar/00/17/43/81/8b09dd90.jpg","nickname":"csn","note":"","ucode":"68FAE1EE372ADF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":705,"discussion_content":"æ£€æŸ¥ä¸‹Pythonçš„ç‰ˆæœ¬ï¼Œç¡®ä¿åœ¨3.6ç‰ˆæœ¬ä»¥ä¸Šï¼Œå› ä¸ºf-stringè¿™ä¸ªç‰¹æ€§æ˜¯åœ¨3.6ç‰ˆæœ¬åŠ å…¥çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561971742,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":673,"ip_address":""},"score":705,"extra":""}]}]},{"had_liked":false,"id":108107,"user_name":"å¤©å‡‰å¥½ä¸ªç§‹","can_delete":false,"product_type":"c1","uid":1136145,"ip_address":"","ucode":"E11B5F990A4000","user_header":"https://static001.geekbang.org/account/avatar/00/11/56/11/5d113d5c.jpg","comment_is_top":false,"comment_ctime":1561683084,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"31626454156","product_id":100026901,"comment_content":"å¦‚æœå®Œæˆï¼Œåˆ™å°†å…¶æ”¾åˆ°é¢„å¤‡çŠ¶æ€çš„åˆ—è¡¨ï¼›<br>å¦‚æœæœªå®Œæˆï¼Œåˆ™ç»§ç»­æ”¾åœ¨ç­‰å¾…çŠ¶æ€çš„åˆ—è¡¨ã€‚<br>è¿™é‡Œæ˜¯ä¸æ˜¯å†™çš„æœ‰é—®é¢˜ï¼Ÿ<br>PS:æƒ³é—®ä¸€ä¸‹ï¼Œå®Œæˆä¹‹åä¸ºä»€ä¹ˆè¿˜è¦æ”¾é˜Ÿåˆ—é‡Œï¼Ÿéš¾é“ä¸åº”è¯¥ä»é˜Ÿåˆ—é‡Œç§»é™¤å—ï¼Ÿ","like_count":7,"discussions":[{"author":{"id":1105161,"avatar":"https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg","nickname":"helloworld","note":"","ucode":"1EECCA0F43E278","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":562,"discussion_content":"æ˜¯ä½ ç†è§£çš„é—®é¢˜ã€‚æ–‡ç« ä¸­è¯´çš„å®Œæˆæ˜¯æœ‰è¯­å¢ƒçš„ï¼Œä¸æ˜¯åƒä½ æƒ³çš„é‚£æ ·ä»»åŠ¡å½»åº•å®Œæˆï¼Œè€Œæ˜¯ç‰¹æŒ‡è¯¥ä»»åŠ¡ä¸­çš„I/Oæ“ä½œå­ä»»åŠ¡æ˜¯å¦å®Œæˆã€‚è¿™å›ä½ å†å›åŸæ–‡ä¸­é‡æ–°ç†è§£ä¸€éåº”è¯¥å°±èƒ½æ˜ç™½äº†ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1561708003,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1579668,"avatar":"https://static001.geekbang.org/account/avatar/00/18/1a/94/dd7c4c33.jpg","nickname":"ç« é±¼goodest","note":"","ucode":"0587B1A23B36E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1105161,"avatar":"https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg","nickname":"helloworld","note":"","ucode":"1EECCA0F43E278","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3205,"discussion_content":"è¿™æ ·è§£é‡Šä¸åˆç†å§ï¼Œä¸€ä¸ªä»»åŠ¡è‹¥æ²¡æœ‰å…¨éƒ¨å®Œæˆï¼Œåªæ˜¯å­ä»»åŠ¡å®Œæˆï¼Œåº”è¯¥æ˜¯æ”¾åˆ°ç­‰å¾…çŠ¶æ€çš„åˆ—æ ‡å•Šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564302760,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":562,"ip_address":""},"score":3205,"extra":""}]}]},{"had_liked":false,"id":143226,"user_name":"å»ºå¼º","can_delete":false,"product_type":"c1","uid":1397126,"ip_address":"","ucode":"62B03D0E0C64EC","user_header":"https://static001.geekbang.org/account/avatar/00/15/51/86/b5fd8dd8.jpg","comment_is_top":false,"comment_ctime":1571651252,"is_pvip":false,"replies":[{"id":"56039","content":"å¾ˆæ£’çš„ä¾‹å­ï¼Œä½†æ˜¯å¯¹è®¡ç®—å¯†é›†å‹ç¨‹åºï¼Œä½ å¯ä»¥æ‰“å¼€ä»»åŠ¡ç®¡ç†å™¨çš„æ€§èƒ½é¡µï¼ŒCPU é€‰æ‹©æ˜¾ç¤ºé€»è¾‘å¤„ç†å™¨ï¼Œå¯ä»¥æ³¨æ„åˆ°ä¸²è¡Œæ‰§è¡Œå’Œå¹¶è¡Œæ‰§è¡Œçš„ä¸åŒã€‚","user_name":"ä½œè€…å›å¤","comment_id":143226,"uid":"1513504","ip_address":"","utype":1,"ctime":1572244764,"user_name_real":"é«˜å±±æµæ°´"}],"discussion_count":2,"race_medal":0,"score":"23046487732","product_id":100026901,"comment_content":"ä¸Šç½‘æŸ¥è¯¢èµ„æ–™åï¼Œåˆæ­¥äº†è§£äº†å¤šè¿›ç¨‹çš„ä¸€äº›çŸ¥è¯†ï¼ŒæŒ‰ç…§èµ„æ–™ä¸­çš„æ–¹æ³•ç®€å•æ”¹å†™äº†ä¸€ä¸‹ç¨‹åºï¼Œç”±äºå¤šè¿›ç¨‹æ–¹å¼æ—¶ï¼Œä¸çŸ¥ä»€ä¹ˆåŸå› ï¼Œcpu_boundå‡½æ•°ä¸èƒ½å®æ—¶è¾“å‡ºï¼Œæ‰€ä»¥å°±æŠŠcpu_boundæ”¹ä¸ºè¿”å›å­—ç¬¦ä¸²å½¢å¼çš„ç»“æœï¼Œç­‰æ‰€æœ‰çš„æ•°è®¡ç®—å®Œæˆåï¼Œå†ä¸€å¹¶è¾“å‡ºç»“æœ ï¼Œç¨‹åºä¸­å¸¸è§„æ‰§è¡Œå’Œå¤šè¿›ç¨‹ä¸¤ç§æ–¹å¼éƒ½æœ‰ï¼Œå¹¶ä½œäº†å¯¹æ¯”åå‘ç°ï¼Œå¸¸è§„æ‰§è¡Œç”¨æ—¶çº¦23ç§’ï¼Œå¤šè¿›ç¨‹ç”¨æ—¶çº¦6ç§’ï¼Œä¸¤è€…ç›¸å·®4å€ï¼Œç¨‹åºå¦‚ä¸‹ï¼Œä¸è¶³å¤„è¯·è€å¸ˆæŒ‡æ­£ï¼š<br>#å¤šè¿›ç¨‹æ¼”ç¤º<br>import multiprocessing<br>import time<br><br>def cpu_bound(number):<br>    return &#39;sum({}^2)={}&#39;.format(number,sum(i * i for i in range(number)))<br><br>def calculate_sums(numbers):<br>    <br>    results = []<br><br>    print(&#39;-&#39;*10+&#39;ä¸²è¡Œæ‰§è¡Œå¼€å§‹ï¼š&#39;+&#39;-&#39;*10)<br><br>    for number in numbers:<br>        results.append(cpu_bound(number))<br><br>    print(&#39;-&#39;*10+&#39;ä¸²è¡Œæ‰§è¡Œç»“æŸï¼Œç»“æœå¦‚ä¸‹ï¼š&#39;+&#39;-&#39;*10)<br>    for res in results:<br>        print(res)<br><br>def multicalculate_sums(numbers):<br><br>    #åˆ›å»ºæœ‰4ä¸ªè¿›ç¨‹çš„è¿›ç¨‹æ± <br>    pool = multiprocessing.Pool(processes=4)<br><br>    results = []<br><br>    print(&#39;-&#39;*10+&#39;å¤šè¿›ç¨‹æ‰§è¡Œå¼€å§‹ï¼š&#39;+&#39;-&#39;*10)<br><br>    #ä¸ºæ¯ä¸€ä¸ªéœ€è¦è®¡ç®—çš„å…ƒç´ åˆ›å»ºä¸€ä¸ªè¿›ç¨‹<br>    for number in numbers:<br>        results.append(pool.apply_async(cpu_bound, (number,)))<br><br>    pool.close() #å…³é—­è¿›ç¨‹æ± ï¼Œä¸èƒ½å¾€è¿›ç¨‹æ± æ·»åŠ è¿›ç¨‹<br>    pool.join()  #ç­‰å¾…è¿›ç¨‹æ± ä¸­çš„æ‰€æœ‰è¿›ç¨‹æ‰§è¡Œå®Œæ¯•<br><br>    print(&#39;-&#39;*10+&#39;å¤šè¿›ç¨‹æ‰§è¡Œç»“æŸï¼Œç»“æœå¦‚ä¸‹ï¼š&#39;+&#39;-&#39;*10)<br>    for res in results:<br>        print(res.get())<br>    <br>def main():<br><br>    numbers = [10000000 + x for x in range(20)]<br><br>    #ä¸²è¡Œæ‰§è¡Œæ–¹å¼<br>    start_time = time.perf_counter()  <br>    calculate_sums(numbers)<br>    end_time = time.perf_counter()<br>    print(&#39;ä¸²è¡Œæ‰§è¡Œç”¨æ—¶ï¼šCalculation takes {} seconds&#39;.format(end_time - start_time))<br><br>    #å¤šè¿›ç¨‹æ‰§è¡Œæ–¹å¼<br>    start_time = time.perf_counter()  <br>    multicalculate_sums(numbers)<br>    end_time = time.perf_counter()<br>    print(&#39;å¤šè¿›ç¨‹æ‰§è¡Œç”¨æ—¶ï¼šCalculation takes {} seconds&#39;.format(end_time - start_time))<br>    <br>if __name__ == &#39;__main__&#39;:<br>    main()<br>","like_count":5,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"é«˜å±±æµæ°´","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471433,"discussion_content":"å¾ˆæ£’çš„ä¾‹å­ï¼Œä½†æ˜¯å¯¹è®¡ç®—å¯†é›†å‹ç¨‹åºï¼Œä½ å¯ä»¥æ‰“å¼€ä»»åŠ¡ç®¡ç†å™¨çš„æ€§èƒ½é¡µï¼ŒCPU é€‰æ‹©æ˜¾ç¤ºé€»è¾‘å¤„ç†å™¨ï¼Œå¯ä»¥æ³¨æ„åˆ°ä¸²è¡Œæ‰§è¡Œå’Œå¹¶è¡Œæ‰§è¡Œçš„ä¸åŒã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572244764,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1649859,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/CqF8eiaanNteyu2U7FibYicjnw99VXZST61vvMpQKSd5iaLNW6EicLeFYyDOKJmg9rNx6KW90DwpPMKNxiben6fQeZjA/132","nickname":"Geek_24abc6","note":"","ucode":"88CD214232C6BC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":191512,"discussion_content":"æˆ‘çš„ç”µè„‘è¿è¡Œå‡ºæ¥ï¼Œ4ç§æ–¹å¼çš„æ—¶é—´éƒ½åœ¨1.8ç§’å·¦å³","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582992852,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":153857,"user_name":"Paul Shan","can_delete":false,"product_type":"c1","uid":1593140,"ip_address":"","ucode":"32D99989028284","user_header":"","comment_is_top":false,"comment_ctime":1574320284,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14459222172","product_id":100026901,"comment_content":"syncæ˜¯çº¿æ€§å‰åæ‰§è¡Œã€‚<br>asyncæ˜¯ç©¿æ’æ‰§è¡Œï¼Œä¹‹æ‰€ä»¥è¦ç©¿æ’ï¼Œä»£ç éœ€è¦çš„èµ„æºä¸åŒï¼Œæœ‰çš„ä»£ç éœ€è¦CPUï¼Œæœ‰çš„ä»£ç éœ€è¦IOï¼ˆä¾‹å¦‚ç½‘ç»œï¼‰,ç©¿æ’ä»¥åï¼ŒåŒæ—¶éœ€è¦CPUå’Œç½‘ç»œçš„ä»£ç å¯ä»¥åŒæ—¶æ‰§è¡Œï¼Œå……åˆ†åˆ©ç”¨ç¡¬ä»¶ã€‚<br><br>å…·ä½“åˆ°å…³é”®å­— async æ˜¯è¡¨ç¤ºå‡½æ•°æ˜¯å¼‚æ­¥çš„ï¼Œä¹Ÿå°±æ˜¯æ¥å›ç©¿æ’çš„èµ·ç‚¹ï¼ˆè¿›å…¥é¢„å¤‡é˜Ÿåˆ—ï¼‰ï¼Œawaitæ˜¯è¡¨ç¤ºè°ƒç”¨éœ€è¦IOï¼Œä¹Ÿå°±æ˜¯è¿›å…¥ç­‰å¾…é˜Ÿåˆ—çš„å…¥å£ï¼ˆå‡½æ•°å¼€å§‹è°ƒç”¨ï¼‰å’Œå‡ºå£ï¼ˆå‡½æ•°è°ƒç”¨ç»“æŸï¼Œé‡æ–°è¿›å…¥é¢„å¤‡é˜Ÿåˆ—ï¼‰ã€‚","like_count":3},{"had_liked":false,"id":108980,"user_name":"å”å“¥","can_delete":false,"product_type":"c1","uid":1363974,"ip_address":"","ucode":"385B76AC28D175","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKokKnHQKrAupdgYJ8mHPbZbeDxKR229qLYkaJt4pwvd1ZcdicgjTdqPKuJlO09ibtZSOvsSLAAnWJQ/132","comment_is_top":false,"comment_ctime":1561943538,"is_pvip":true,"discussion_count":2,"race_medal":0,"score":"14446845426","product_id":100026901,"comment_content":"è€å¸ˆå¥½ï¼Œå¯¹äº Asyncio æ¥è¯´ï¼Œå®ƒçš„ä»»åŠ¡åœ¨è¿è¡Œæ—¶ä¸ä¼šè¢«å¤–éƒ¨çš„ä¸€äº›å› ç´ æ‰“æ–­ã€‚ä¸è¢«æ‰“æ–­æ˜¯å¦‚ä½•ä¿è¯çš„ï¼Ÿè¿˜æœ‰event loopæ˜¯æ¯æ¬¡å–å‡ºä¸€ä¸ªä»»åŠ¡è¿è¡Œï¼Œå½“è¿™ä¸ªä»»åŠ¡è¿è¡ŒæœŸé—´å®ƒå°±æ˜¯åªç­‰å¾…ä»»åŠ¡ç»“æŸå—ï¼Ÿä¸å¹²å…¶ä»–äº‹äº†å—ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":2064044,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/7e/ac/4303e8ef.jpg","nickname":"Geek_b692f5","note":"","ucode":"C2826604F71C36","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":299954,"discussion_content":"æ„æ€æ˜¯å½“å‰è¿è¡Œçš„ä»»åŠ¡ï¼Œåœ¨æ²¡æœ‰é‡åˆ°blockçš„æ—¶å€™ï¼Œå°†ä¼šä¸€ç›´æ˜¯å®ƒå¤„äºè¿è¡ŒçŠ¶æ€ï¼Œå…¶ä»–ä»»åŠ¡éƒ½å¤„äºç­‰å¾…çŠ¶æ€","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1597888302,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2347194,"avatar":"https://static001.geekbang.org/account/avatar/00/23/d0/ba/98bc816b.jpg","nickname":"ShuğŸ¹","note":"","ucode":"29521F803CE2CC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":341079,"discussion_content":"æˆ‘æ˜¯è¿™æ ·ç†è§£çš„ï¼Œå› ä¸ºæ‰€æœ‰ä»»åŠ¡éƒ½æœ‰ä¸€ä¸ªæ€»æŒ‡æŒ¥ï¼Œéƒ½å¬è¿™ä¸ªæ€»æŒ‡æŒ¥çš„å®‰æ’ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°ä¸€ä¸ªä»»åŠ¡æœ¬è¯¥æ‰§è¡Œå®Œç»“æœè¢«æ‰“æ–­ã€ä¸¤ä¸ªä»»åŠ¡race conditionçš„æƒ…å†µã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610286237,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108271,"user_name":"Geek_59f23e","can_delete":false,"product_type":"c1","uid":1513783,"ip_address":"","ucode":"A463C6EB7447FD","user_header":"https://static001.geekbang.org/account/avatar/00/17/19/37/e0a9bf99.jpg","comment_is_top":false,"comment_ctime":1561709414,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14446611302","product_id":100026901,"comment_content":"import time<br>from multiprocessing import Pool<br><br><br>def square(number):<br>    return sum(i * i for i in range(number))<br><br><br>def single_process(numbers):<br>    res = []<br>    for number in numbers:<br>        res.append(square(number))<br>    return res<br><br><br>def multi_process(numbers):<br>    with Pool() as pool:<br>        res = pool.map(square, numbers)<br>    return res<br><br><br>if __name__ == &#39;__main__&#39;:<br>    numbers = [10000000 + x for x in range(20)]<br>    start1 = time.perf_counter()<br>    single_process(numbers)<br>    print(&#39;å•è¿›ç¨‹ç”¨æ—¶ï¼š%f ç§’&#39; % (time.perf_counter() - start1))<br>    start2 = time.perf_counter()<br>    multi_process(numbers)<br>    print(&#39;å¤šè¿›ç¨‹ç”¨æ—¶ï¼š%f ç§’&#39; % (time.perf_counter() - start2))<br><br>â€”â€”â€”â€”â€”â€”â€”â€”<br>è¾“å‡ºï¼š<br>å•è¿›ç¨‹ç”¨æ—¶ï¼š29.382878 ç§’<br>å¤šè¿›ç¨‹ç”¨æ—¶ï¼š10.354565 ç§’<br><br>[333333283333335000000, 333333383333335000000, 333333483333355000001, 333333583333395000005, 333333683333455000014, 333333783333535000030, 333333883333635000055, 333333983333755000091, 333334083333895000140, 333334183334055000204, 333334283334235000285, 333334383334435000385, 333334483334655000506, 333334583334895000650, 333334683335155000819, 333334783335435001015, 333334883335735001240, 333334983336055001496, 333335083336395001785, 333335183336755002109]<br>","like_count":3},{"had_liked":false,"id":108148,"user_name":"TKbook","can_delete":false,"product_type":"c1","uid":1073829,"ip_address":"","ucode":"F6E0E99CC79059","user_header":"https://static001.geekbang.org/account/avatar/00/10/62/a5/43aa0c27.jpg","comment_is_top":false,"comment_ctime":1561686890,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"10151621482","product_id":100026901,"comment_content":"race condition æ˜¯ä»€ä¹ˆï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1005520,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/d0/b9312769.jpg","nickname":"åŒ—æ–—(å®‡)","note":"","ucode":"9532B48D7C29C7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":547677,"discussion_content":"ç«æ€æ¡ä»¶(race condition)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642818743,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1524797,"avatar":"https://static001.geekbang.org/account/avatar/00/17/44/3d/35d6670d.jpg","nickname":"Claywoow","note":"","ucode":"1F1C70BCE33536","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1257,"discussion_content":"å¤šä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¼šå‡ºç°èµ„æºç«äº‰(race condition)çš„æƒ…å†µï¼›æœ‰å¯èƒ½ä¼šå¯¼è‡´åŒä¸€ä¸ªèµ„æº/æ•°æ®è¢«å¤šä¸ªçº¿ç¨‹äº‰å¤ºçš„æƒ…å†µï¼Œè¿™æ ·ä¼šå¯¼è‡´æœ€åçš„ç»“æœå¯èƒ½ä¼šå’ŒæœŸæœ›çš„ç»“æœä¸ä¸€è‡´çš„å„ç§ç‰¹æ®Šæƒ…å†µå§ã€‚ä¸ªäººçš„è®¤ä¸ºå¯èƒ½ä¸æ˜¯å¾ˆå‡†ç¡®ï¼Œä¹Ÿå¸Œæœ›æœ‰ç†è§£æ›´é€å½»çš„å¤§ä½¬æ¥è§£é‡Šä¸€ä¸‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562484293,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":335483,"user_name":"Geek_63ad86","can_delete":false,"product_type":"c1","uid":1528671,"ip_address":"","ucode":"E758532B1169D6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/ib3Rzem884S7icAGXsBzGKyricapL0sfax7wL7T4n1W1ZPZ0h7XNtGd5aqLlZQgZ3bZTPBmC4xa7ia8iaR0XBKMAuIQ/132","comment_is_top":false,"comment_ctime":1645535520,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5940502816","product_id":100026901,"comment_content":"æé‡‘ç”²åˆ°æ­¤ä¸€æ¸¸","like_count":1},{"had_liked":false,"id":283805,"user_name":"sugar","can_delete":false,"product_type":"c1","uid":2184057,"ip_address":"","ucode":"491906283FC13B","user_header":"https://static001.geekbang.org/account/avatar/00/21/53/79/327ef30e.jpg","comment_is_top":false,"comment_ctime":1615943910,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5910911206","product_id":100026901,"comment_content":"asyncioæ˜¯ä¸æ˜¯è·ŸIOå¤šè·¯å¤ç”¨ä¸€ä¸ªé“ç†å•Š","like_count":1},{"had_liked":false,"id":251739,"user_name":"å®Œç¾åšæŒ","can_delete":false,"product_type":"c1","uid":1919541,"ip_address":"","ucode":"AE0261D8DDEF64","user_header":"https://static001.geekbang.org/account/avatar/00/1d/4a/35/66caeed9.jpg","comment_is_top":false,"comment_ctime":1601818517,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5896785813","product_id":100026901,"comment_content":"æˆ‘åœ¨jupyter notebookä¸­ç”¨ä¸‹é¢çš„å¤šè¿›ç¨‹åœ°å¹¶è¡Œå¤šæ¬¡å°è¯•åªéœ€è¦0.2-0.9sé—´ï¼Œä½†æ˜¯è€å¸ˆç»™çš„æ™®é€šç¨‹åºéœ€è¦30å¤šsï¼Œè€Œä¸”è€å¸ˆåœ¨ç•™è¨€ä¸­ç»™å‡ºçš„ç­”æ¡ˆä»£ç ï¼Œä¸çŸ¥é“å“ªé‡Œä¸å¯¹ï¼Œè¿è¡Œä¸å‡ºç»“æœï¼Œæ²¡æœ‰æŠ¥é”™ä½†æ˜¯ä¸€ç›´å‡ºä¸æ¥ç»“æœ<br>import concurrent.futures<br>import time<br>def cpu_bound(number):<br>    return sum(i * i for i in range(number))<br><br>def calculate_sums(numbers):<br>    with concurrent.futures.ProcessPoolExecutor() as executor:<br>        executor.map(cpu_bound, numbers)<br><br>def main():<br>    start_time = time.perf_counter()  <br>    numbers = [10000000 + x for x in range(20)]<br>    calculate_sums(numbers)<br>    end_time = time.perf_counter()<br>    print(&#39;Calculation takes {} seconds&#39;.format(end_time - start_time))<br>    <br>if __name__ == &#39;__main__&#39;:<br>    main()","like_count":1,"discussions":[{"author":{"id":1528176,"avatar":"https://static001.geekbang.org/account/avatar/00/17/51/70/68b3f0e6.jpg","nickname":"å¥èº«å’¸é±¼","note":"","ucode":"415CBFF3F158F3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332284,"discussion_content":"æˆ‘ä¹Ÿæ˜¯è¿™æ ·ï¼Œè¿™ä½åŒå­¦é—®é¢˜ç°åœ¨è§£å†³äº†å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607149085,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":230584,"user_name":"Kevin","can_delete":false,"product_type":"c1","uid":1923859,"ip_address":"","ucode":"89EA5FCF036C42","user_header":"https://static001.geekbang.org/account/avatar/00/1d/5b/13/6db9ba58.jpg","comment_is_top":false,"comment_ctime":1593423197,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5888390493","product_id":100026901,"comment_content":"ä½¿ç”¨resp.content_length å¾—åˆ°çš„None<br><br>é€šè¿‡text = await resp.text()<br>len(text)å¯ä»¥æ‹¿åˆ°èµ„æºå¤§å°ä½†æ˜¯å¾ˆè€—æ—¶","like_count":1},{"had_liked":false,"id":205431,"user_name":"Richard","can_delete":false,"product_type":"c1","uid":1316758,"ip_address":"","ucode":"893F958B9DD161","user_header":"https://static001.geekbang.org/account/avatar/00/14/17/96/846fc11b.jpg","comment_is_top":false,"comment_ctime":1586616102,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5881583398","product_id":100026901,"comment_content":"çœ‹äº†å¾ˆå¤šæé—®éƒ½æ²¡æœ‰è¢«å›ç­”ï¼Œæˆ‘ä¹Ÿå¯¹asyncioæœ‰ä¸ªå¾ˆå¤§çš„ç–‘é—®ï¼Œé‚£å°±æ˜¯æˆ‘è¶Šæ¥è¶Šæ„Ÿè§‰asyncioæ˜¯ä¸€ä¸ªå¾ˆç³Ÿç³•çš„åå­—ï¼Œä»å†…å®¹ä¸Šçœ‹åªæ˜¯è§£å†³å¹¶å‘é—®é¢˜ï¼Œæˆ‘æ²¡æœ‰çœ‹åˆ°é’ˆå¯¹ioçš„æè¿°ï¼Œè€Œä¸”æˆ‘ç›®å‰çš„çŸ¥è¯†ä½“ç³»è®¤ä¸º:Linuxä¸Šè§£å†³é«˜å¹¶å‘å¤§å¤šæ˜¯ç”¨çš„ioå¤šè·¯å¤ç”¨å’Œéé˜»å¡ï¼Œè‡³äºå¼‚æ­¥ioå¾ˆå°‘ä½¿ç”¨ï¼Œè€Œä¸”Linuxä»…ä»…å®ç°äº†ç£ç›˜è¯»å†™çš„å¼‚æ­¥ioï¼Œè€Œç½‘ç»œioæ²¡æœ‰å®ç°å¼‚æ­¥ã€‚æ‰€ä»¥æˆ‘å°±è‡ªç„¶å¯¹Pythonè¿™ä¸ªasyncioæœ‰ç–‘é—®äº†ï¼Ÿå®ƒå’Œæ“ä½œç³»ç»Ÿioæ˜¯åŒä¸€ä¸ªå±‚æ¬¡æ¦‚å¿µä¹ˆï¼Ÿè‡³å°‘æˆ‘è§‰å¾—è¿™æ˜¯ä¸ªå¾ˆç³Ÿç³•çš„å‘½åï¼Œæˆ‘ä¸çŸ¥é“åˆå­¦è€…é‡åˆ°å¼‚æ­¥ioçš„æ¦‚å¿µæ—¶èŠ±å¤§åŠ›æ°”ææ¸…æ¥šé˜»å¡éé˜»å¡å¼‚æ­¥å’ŒåŒæ­¥ä¹‹åï¼Œé¢å¯¹Linuxä¸Šå¼‚æ­¥ioæ”¯æŒä»¥åŠåº”ç”¨æœ‰é™çš„äº‹å®ä¹‹åä¼šä½œä½•æ„Ÿæƒ³ï¼ç›¼å¤ï¼","like_count":1,"discussions":[{"author":{"id":1316758,"avatar":"https://static001.geekbang.org/account/avatar/00/14/17/96/846fc11b.jpg","nickname":"Richard","note":"","ucode":"893F958B9DD161","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":234807,"discussion_content":"å…¶å®æˆ‘è¿™å‡ å¤©ç ”ç©¶äº†Pythonçš„åç¨‹ï¼Œå¤§æ¦‚ææ˜ç™½äº†å…¶ä¸­åŸç†ï¼Œè¿™é‡Œçš„â€œé˜»å¡â€œä¸â€œå¼‚æ­¥â€œæ˜¯ä¸€ä¸ªæ›´é«˜å±‚æ¬¡çš„æŠ½è±¡æ¦‚å¿µï¼Œå¹¶éæŒ‡ç³»ç»Ÿè°ƒç”¨çº§åˆ«çš„ã€‚æˆ‘ä¸ºä»€ä¹ˆå¼ºè°ƒâ€œé˜»å¡â€ï¼Œâ€œå¼‚æ­¥â€è¿™äº›æ¦‚å¿µï¼Œå¦‚æœä½ è¯»è¿‡unpé‚£æœ¬ä¹¦ï¼Œè¦ç†è§£unixçš„ioæ¨¡å‹è¿™äº›æ˜¯é¿ä¸å¼€çš„æ¦‚å¿µã€‚ç½‘ä¸Šå¤§éƒ¨åˆ†çš„æ–‡ç« å¼•ç”¨äº†unpçš„å†…å®¹æ¥ä»‹ç»é˜»å¡ï¼Œéé˜»å¡ï¼ŒåŒæ­¥ï¼Œå¼‚æ­¥çš„æ¦‚å¿µï¼Œç´§æ¥ç€ä¾¿ä»‹ç»asyncioåŒ…çš„ä½¿ç”¨ï¼Œå…¶å®asyncioé‡Œé˜»å¡å’Œå¼‚æ­¥çš„æ¦‚å¿µå¹¶ä¸å®Œå…¨ç­‰åŒäºunpä¸­ä»‹ç»çš„ç³»ç»Ÿè°ƒç”¨ioï¼Œæ˜¯åœ¨ä¸€ä¸ªæ›´é«˜çš„æŠ½è±¡å±‚æ¬¡ä¸Šï¼Œä¸€ä¸ªasyncioçš„åç¨‹ä¾ç„¶å¯èƒ½é‡åˆ°åº•å±‚åŒæ­¥çš„ioè°ƒç”¨ï¼Œæ­¤æ—¶è¿™ä¸ªåç¨‹å°±æ˜¯ä¼šé˜»å¡ä½æ•´ä¸ªå½“å‰çº¿ç¨‹ï¼Œä½¿å¾—çº¿ç¨‹å¤±å»CPUï¼Œä»è€Œå½±å“åˆ°å…¶å®ƒçš„åç¨‹ã€‚å…¶å®ä½ ç†è§£çš„ä¹Ÿæ²¡é”™ï¼Œåªæ˜¯é«˜å±‚æŠ½è±¡çš„è§£é‡Šï¼Œä½†å‰ææ˜¯ä½ è¦æ¸…æ¥šä½ æ­¤æ—¶è¯´çš„é˜»å¡æ˜¯ä»€ä¹ˆæ„æ€ï¼Œå®ƒä¸æ˜¯æŒ‡ç³»ç»Ÿè°ƒç”¨çº§åˆ«ï¼Œè€Œæ˜¯ä»»åŠ¡çº§åˆ«çš„æŸäº›æ¡ä»¶ä¸èƒ½æ»¡è¶³çš„æƒ…å†µï¼Œè€Œè¿™äº›ä¸èƒ½æ»¡è¶³çš„æ¡ä»¶å¯èƒ½æ˜¯å…¶å®ƒåç¨‹çš„CPUæ“ä½œï¼Œè€Œä¸æ˜¯ioæ“ä½œã€‚å› ä¸ºä½ è¦æ¸…æ¥šä¸€ä¸ªäº‹å®:ç›®å‰Linuxä¸‹å¯¹å¼‚æ­¥ioçš„æ”¯æŒæ˜¯æœ‰é™çš„ï¼Œå®ƒåªå®ç°äº†ç£ç›˜çš„å¼‚æ­¥ioï¼Œç½‘ç»œioä»ç„¶æ˜¯åŒæ­¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨Linuxä¸Šå¼‚æ­¥ioä½¿ç”¨åœºæ™¯å¾ˆå°‘å¾ˆå°‘ï¼Œä¸šç•Œå‡ ä¹åªæ‹¿å®ƒå½“ä¸ªæ¦‚å¿µæ¥è®²ã€‚å› æ­¤æˆ‘è§‰å¾—Pythonçš„è¿™ä¸ªasyncioåŒ…åæ˜¯ä¸€ä¸ªå¾ˆç³Ÿç³•çš„å‘½åï¼Œç‰¹åˆ«æ˜¯å¯¹äºç†è§£ä¸€ç‚¹ç‚¹åº•å±‚åŸç†çš„äººæ¥è¯´ã€‚å®ƒçš„åç¨‹çœŸçš„å¾ˆéš¾ç†è§£ä¹Ÿå¾ˆéš¾ä½¿ç”¨ï¼Œå¦‚æœä½ ç”¨è¿‡goçš„goroutineä½ å°±æ˜ç™½æˆ‘ä¸ºä»€ä¹ˆå¦‚æ­¤åæ§½Pythonçš„åç¨‹äº†ã€‚è™½ç„¶å®ƒé¿å…äº†çº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„æˆæœ¬ï¼Œé¿å…äº†å¹¶å‘æ—¶çš„ç«æ€æ¡ä»¶ï¼Œä½†goçš„çº¿ç¨‹æ¨¡å‹æŸç§ç¨‹åº¦ä¸Šè®²ä¹Ÿé¿å…äº†goroutineçš„åˆ‡æ¢å¼€é”€ï¼Œä»…ä»…éœ€è¦åœ¨å¹¶å‘æ—¶ç…§é¡¾å¥½ç«æ€æ¡ä»¶ï¼Œä½†goå¸¦æ¥çš„ç®€å•æ˜“ç”¨æ€§æ˜¯Pythonçš„åç¨‹æœ›å°˜è«åŠçš„ï¼Œæ‰€ä»¥ç°é˜¶æ®µæˆ‘æ˜¯ä¸ä¼šä½¿ç”¨Pythonçš„åç¨‹çš„ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586999613,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1218402,"avatar":"https://static001.geekbang.org/account/avatar/00/12/97/62/568fc34e.jpg","nickname":"ç†æƒ³æ°¸è¿œéƒ½å¹´è½»","note":"","ucode":"0DA68671B76C38","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337975,"discussion_content":"ä»–ä¸ä¼šä½ çš„æé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609140833,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109859,"user_name":"KaitoShy","can_delete":false,"product_type":"c1","uid":1038415,"ip_address":"","ucode":"E2E2E9BD3F5048","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d8/4f/65abc6f0.jpg","comment_is_top":false,"comment_ctime":1562122377,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5857089673","product_id":100026901,"comment_content":"è¿è¡Œæ–‡ç« ä¸­å‡ºç°çš„ä»£ç æ—¶å‡ºç°â€˜aiohttp.client_exceptions.ClientConnectorCertificateErrorâ€™çš„è¿™ä¸ªæŠ¥é”™ï¼Œæˆ‘è®²ä»£ç ç¬¬7è¡Œæ›´æ”¹æˆâ€˜async with session.get(url, ssl=False) as respâ€™åè¿è¡ŒæˆåŠŸï¼Œæ˜¯å¦è¿˜æœ‰å…¶ä»–çš„è§£å†³æ–¹æ¡ˆï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1032331,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c0/8b/0371baee.jpg","nickname":"å¼ ä¸½å¨œ","note":"","ucode":"D70CFF68E72DAF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":916,"discussion_content":"é—®é¢˜ç¡®å®è§£å†³äº†ï¼Œé«˜ç‰ˆæœ¬å’Œä½ç‰ˆæœ¬éƒ½å¯è¿è¡Œäº†ï¼Œä¸è¿‡resp.content_lengthå¹¶ä¸èƒ½å¾—åˆ°å…·ä½“çš„æ–‡ä»¶çš„å¤§å°ï¼Œæ˜¾ç¤ºRead None from https://baike.baidu.com/vbaike/","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562148743,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1032331,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c0/8b/0371baee.jpg","nickname":"å¼ ä¸½å¨œ","note":"","ucode":"D70CFF68E72DAF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":909,"discussion_content":"æˆ‘ä¹Ÿè¯•è¯•\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562146749,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108089,"user_name":"æ–¹å‘","can_delete":false,"product_type":"c1","uid":1261031,"ip_address":"","ucode":"CBB283D30C8C09","user_header":"https://static001.geekbang.org/account/avatar/00/13/3d/e7/e4b4afcc.jpg","comment_is_top":false,"comment_ctime":1561681307,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"5856648603","product_id":100026901,"comment_content":"å¦‚æœå®Œæˆï¼Œåˆ™æ”¾åˆ°é¢„å¤‡çŠ¶æ€åˆ—è¡¨ï¼Œè¿™å¥è¯ä¸ç†è§£ã€‚è¿™æ ·ä¸€æ¥ï¼Œé¢„å¤‡çŠ¶æ€åˆ—è¡¨åŒæ—¶æ‹¥æœ‰ä¸¤ç§å½¢å¼çš„ä»»åŠ¡å•Š","like_count":1,"discussions":[{"author":{"id":1105161,"avatar":"https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg","nickname":"helloworld","note":"","ucode":"1EECCA0F43E278","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":563,"discussion_content":"æŒ‰ç…§ä½ è¿™ä¹ˆç†è§£ä¹Ÿå¯ä»¥ï¼Œé¢„å¤‡çŠ¶æ€åˆ—è¡¨ä¸­å­˜åœ¨ä¸¤ç§å½¢æ€çš„ä»»åŠ¡ï¼Œä¸€ç§æ˜¯ä»æ¥æ²¡æœ‰æ‰§è¡Œè¿‡çš„ä»»åŠ¡ï¼Œä¸€ç§æ˜¯ä¹‹å‰è¿˜æ²¡æ‰§è¡Œå®Œçš„ä»»åŠ¡ï¼Œå°±æ˜¯ç”±äºI/Oé˜»å¡è¢«æ”¾åœ¨ç­‰å¾…çŠ¶æ€åˆ—è¡¨çš„ï¼Œä½†æ˜¯I/Oæ“ä½œå®Œæˆäº†ï¼Œæ‰€ä»¥event loopåˆæŠŠä»–æ”¾å›åˆ°é¢„å¤‡çŠ¶æ€åˆ—è¡¨äº†ï¼Œç­‰å¾…æ–°ä¸€è½®çš„å¾ªç¯å°±å¯ä»¥ç»§ç»­æ‰§è¡Œäº†ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1561708469,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1554764,"avatar":"https://static001.geekbang.org/account/avatar/00/17/b9/4c/8c9edc85.jpg","nickname":"å°åº","note":"","ucode":"7C8367CDB47163","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":411377,"discussion_content":"é¦–å…ˆè¦å¯¹asyncå’Œawaitæœ‰ä¸€ä¸ªäº†è§£ï¼Œé‡åˆ°awaitæ—¶ï¼Œå¦‚æœä¸èƒ½ç«‹å³æ‹¿åˆ°ç»“æœï¼Œå°±ä¸ä¼šå†ç»§ç»­é˜»å¡åœ¨å½“å‰å­ä»»åŠ¡ï¼Œä¼šè¿”å›ï¼Œå°†æ§åˆ¶æƒäº¤è¿˜ç»™event loopï¼Œevent loopæ‹¿åˆ°æ§åˆ¶æƒåå°±ä¼šæŠŠå®ƒå­˜åˆ°é¢„å¤‡çŠ¶æ€åˆ—è¡¨ï¼Œå°†æ¥æŸä¸ªæ—¶åˆ»awaitçš„é€»è¾‘æ‰§è¡Œå®Œæ¯•åï¼Œevent loopä¼šå°†å®ƒç»§ç»­æ”¾åˆ°ç­‰å¾…åˆ—è¡¨å»æ‰§è¡Œawaitä¹‹åçš„é€»è¾‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635911798,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1141751,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6b/f7/3a3b82c2.jpg","nickname":"Aspirin","note":"","ucode":"858B551CF0C2F4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":322347,"discussion_content":"è¿™å¥è¯ä¸­çš„å¦‚æœå®Œæˆï¼ŒæŒ‡çš„æ˜¯å¦‚æœå¤„äºç­‰å¾…I/Oçš„ä»»åŠ¡å®Œæˆç­‰å¾…ï¼Œåˆ™æŠŠå®ƒæ”¾å…¥é¢„å¤‡çŠ¶æ€çš„åˆ—è¡¨ï¼Œç­‰å¾…è¢«è°ƒç”¨æ‰§è¡Œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604729095,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":359579,"user_name":"é™ˆé›å—","can_delete":false,"product_type":"c1","uid":2368778,"ip_address":"ä¸Šæµ·","ucode":"D8BE4BBD001B60","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLAdqqPjPWlIibwqDydskjPMfv4V0dibs3p7DoeEziaJVSKoib1siaMHw7xYvk5KwiafCdGRWtUw6eeoyvg/132","comment_is_top":false,"comment_ctime":1665655143,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1665655143","product_id":100026901,"comment_content":"ä½¿ç”¨ asyncio.get_event_loop().run_until_complete(download_all(sites)) æ›¿æ¢asyncio.run(download_all(sites))","like_count":0},{"had_liked":false,"id":341771,"user_name":"é»˜é»˜ä¸”å¬é£","can_delete":false,"product_type":"c1","uid":2539346,"ip_address":"","ucode":"105E5FD2429AE3","user_header":"https://static001.geekbang.org/account/avatar/00/26/bf/52/59304c42.jpg","comment_is_top":false,"comment_ctime":1649828378,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1649828378","product_id":100026901,"comment_content":"class WeiXinWeb:<br># set(name, value, ex=None<br>    def __init__(self,appid,secret) -&gt; None:<br>        <br>        self.base_url = &quot;https:&#47;&#47;api.weixin.qq.com&#47;&quot;<br>        self.appid = appid<br>        self.secret = secret<br><br>    async def access_token(self) -&gt;str:<br>        &quot;&quot;&quot;è·å–åŸºç¡€access_token&quot;&quot;&quot;<br>        # åˆ¤æ–­redisä¸­çš„åŸºç¡€token<br>        if not await redis_conn.get(&quot;access_token&quot;) :<br>            # æ‹¼æ¥åŸºç¡€tokenè¯·æ±‚å­—ç¬¦ä¸²<br>            url:str = f&quot;{self.base_url}cgi-bin&#47;token?grant_type=client_credential&amp;appid={self.appid}&amp;secret={self.secret}&quot;<br>            # å¼‚æ­¥è¯·æ±‚åŸºç¡€token<br>            async with ClientSession() as sess:<br>                async with sess.get(url) as r:<br>                    # è·å–åˆ°çš„åŸºç¡€tokenå­˜å…¥redisä¸­<br>                    res = await r.text()<br>                    await redis_conn.set(&quot;access_token&quot;, json.loads(res).get(&quot;access_token&quot;,&quot;&quot;), ex=3600)<br>        token = await redis_conn.get(&quot;access_token&quot;)<br>        return str(token,&quot;utf-8&quot;)<br><br>appid = &quot;&quot;<br>secret = &quot;&quot;","like_count":0},{"had_liked":false,"id":309465,"user_name":"æ¶¼ç™½å¼€","can_delete":false,"product_type":"c1","uid":2344070,"ip_address":"","ucode":"D25A9C84CABB8D","user_header":"https://static001.geekbang.org/account/avatar/00/23/c4/86/0658e993.jpg","comment_is_top":false,"comment_ctime":1630147955,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630147955","product_id":100026901,"comment_content":"import multiprocessing<br>import time<br><br><br>def cpu_bound(number):<br>    return sum(i * i for i in range(number))<br><br><br>def find_sums(numbers):<br>    with multiprocessing.Pool() as pool:<br>        pool.map(cpu_bound, numbers)<br><br><br>if __name__ == &quot;__main__&quot;:<br>    numbers = [10000000 + x for x in range(20)]<br><br>    start_time = time.time()<br>    find_sums(numbers)<br>    duration = time.time() - start_time<br>    print(f&quot;Duration {duration} seconds&quot;)","like_count":0},{"had_liked":false,"id":307988,"user_name":"è‚¥çŒ«ä¸å¼€å¿ƒ","can_delete":false,"product_type":"c1","uid":2357566,"ip_address":"","ucode":"FA9204B84913C0","user_header":"https://static001.geekbang.org/account/avatar/00/23/f9/3e/0d5f27c4.jpg","comment_is_top":false,"comment_ctime":1629350570,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1629350570","product_id":100026901,"comment_content":"æ€æ ·æŠŠä¸€ä¸ªæ™®é€šçš„åŒæ­¥æ–¹æ³•å°è£…æˆå¼‚æ­¥å‘¢","like_count":0},{"had_liked":false,"id":307238,"user_name":"SilenceÂ°","can_delete":false,"product_type":"c1","uid":2041989,"ip_address":"","ucode":"1782A115C603FD","user_header":"https://static001.geekbang.org/account/avatar/00/1f/28/85/3ae5efed.jpg","comment_is_top":false,"comment_ctime":1628958196,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1628958196","product_id":100026901,"comment_content":"è¯·é—®ä¸‹è¿™ä¸¤ç§æ–¹å¼æˆ‘åœ¨æˆ‘ç”µè„‘ä¸Šè¿è¡Œæ—¶é—´å·®ä¸å¤šï¼Œå“ªä¸ªæ˜¯å¤šè¿›ç¨‹çš„ï¼Ÿæˆ‘çœ‹è€å¸ˆè®²è¿‡çš„è¿™ä¸¤ä¸ªéƒ½æ˜¯å‘€ã€‚ã€‚<br>    with concurrent.futures.ProcessPoolExecutor() as executor:<br>        executor.map(cpu_bound, numbers)<br>å¦ä¸€ä¸ªæ˜¯ï¼š<br>    with multiprocessing.Pool() as pool:<br>        pool.map(cpu_bound, numbers)<br>ç¬¬äºŒä¸ªæ˜¯è€å¸ˆç»™çš„ç­”æ¡ˆï¼Œæ±‚å¤§ä½¬æŒ‡æ•™ï¼","like_count":0},{"had_liked":false,"id":305771,"user_name":"é™ˆå…ˆè·‘","can_delete":false,"product_type":"c1","uid":2669673,"ip_address":"","ucode":"23F1A2673278A4","user_header":"","comment_is_top":false,"comment_ctime":1628153869,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1628153869","product_id":100026901,"comment_content":"å¤šçº¿ç¨‹å’Œ Asyncioçš„é€‰æ‹©ä¸Šï¼Œæ€ä¹ˆæ‰ç®—IOæ…¢ï¼Ÿèƒ½ç»™ç‚¹å…·ä½“çš„åœºæ™¯å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":300885,"user_name":"ç½—è¾‘","can_delete":false,"product_type":"c1","uid":1539649,"ip_address":"","ucode":"06AB60316B51C4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/OwZuBRbVUkziazePs2xTKskNpZachRtCBZLHlv4dAUgaBC5qHI292xaxvg3atGnHlDwjIOXPKEbc7zOrtMyicSNg/132","comment_is_top":false,"comment_ctime":1625417590,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625417590","product_id":100026901,"comment_content":"æ€è€ƒé¢˜å¯¹äºè®¡ç®—å¯†é›†å‹ï¼Œé‡‡ç”¨å’Œç”µè„‘CPUæ ¸æ•°åŒ¹é…çš„å¤šè¿›ç¨‹æ˜¯æœ€å¿«çš„ã€‚å¤šçº¿ç¨‹æ ¸åç¨‹éƒ½æ— æ³•100%ä½¿ç”¨CPUï¼Œå¤šè¿›ç¨‹å¯ä»¥ã€‚æœ›è€å¸ˆæŒ‡ç‚¹ã€‚<br>import asyncio<br>import aiohttp<br>import concurrent.futures<br>import threading<br>import time<br><br>def cpu_bound(number):<br>    print(sum(i * i for i in range(number)))<br><br>def calculate_sums(numbers):<br>    with concurrent.futures.ProcessPoolExecutor(max_workers=4) as executor:<br>        executor.map(cpu_bound,numbers)<br><br>def main():<br>    start_time = time.perf_counter()<br>    numbers = [10000000 + x for x in range(20)]<br>    calculate_sums(numbers)<br>    end_time = time.perf_counter()<br>    print(&#39;Calculation takes {} seconds&#39;.format(end_time - start_time))<br><br><br>if __name__ == &#39;__main__&#39;:<br>    main()","like_count":0},{"had_liked":false,"id":294241,"user_name":"Dean","can_delete":false,"product_type":"c1","uid":1232975,"ip_address":"","ucode":"9003F1E9ECD286","user_header":"https://static001.geekbang.org/account/avatar/00/12/d0/4f/b068b1b3.jpg","comment_is_top":false,"comment_ctime":1621847745,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621847745","product_id":100026901,"comment_content":"æ˜¯ä¸æ˜¯åº”è¯¥åªç”¨ä¸€ä¸ªsessionï¼Œè€Œä¸æ˜¯æ¯æ¬¡è°ƒç”¨download_oneéƒ½åˆ›å»ºä¸€ä¸ªaiohttp.ClientSession()ï¼Ÿ","like_count":0},{"had_liked":false,"id":238219,"user_name":"äº‘èˆèˆ","can_delete":false,"product_type":"c1","uid":1219179,"ip_address":"","ucode":"19B1597DB49819","user_header":"https://static001.geekbang.org/account/avatar/00/12/9a/6b/e8ef2989.jpg","comment_is_top":false,"comment_ctime":1596096832,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596096832","product_id":100026901,"comment_content":"import time<br>import multiprocessing<br><br>def get_multi_sum(num):<br>    return(sum([i * i for i in range(num + 1)]))<br>    <br>def get_list_multi_sum(l):<br>    with multiprocessing.Pool() as pool:<br>        pool.map(get_multi_sum, l)<br> <br>def main():<br>    l = [ 10000000 + i for i in range(20) ]<br>    <br>    st = time.perf_counter()<br>    get_list_multi_sum(l)<br>    et = time.perf_counter()<br>    print(&quot;run time {}s&quot;.format(et - st))<br><br>if __name__ == &#39;__main__&#39;:<br>    main()<br><br><br>===============<br>run time 3.4401765440000003s","like_count":0},{"had_liked":false,"id":237914,"user_name":"å°å“¥  åœ¨è·¯ä¸Š","can_delete":false,"product_type":"c1","uid":1524619,"ip_address":"","ucode":"93AB7B61828CEA","user_header":"https://static001.geekbang.org/account/avatar/00/17/43/8b/11e04392.jpg","comment_is_top":false,"comment_ctime":1596003924,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596003924","product_id":100026901,"comment_content":"é‚£å¯ä»¥ä½¿ç”¨å¤šçº¿ç¨‹åŠ asyncioçš„æ–¹æ³•å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":230591,"user_name":"Kevin","can_delete":false,"product_type":"c1","uid":1923859,"ip_address":"","ucode":"89EA5FCF036C42","user_header":"https://static001.geekbang.org/account/avatar/00/1d/5b/13/6db9ba58.jpg","comment_is_top":false,"comment_ctime":1593424318,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1593424318","product_id":100026901,"comment_content":"def cpu_bound_thread(number):<br>    print(sum(i * i for i in range(number)))<br><br>def calculate_sums_thread(numbers):<br>    # å¤šçº¿ç¨‹ç‰ˆæœ¬<br>    # with concurrent.futures.ThreadPoolExecutor(max_workers=5) as executor:<br>    #     executor.map(cpu_bound_thread, numbers)<br>    # å¤šè¿›ç¨‹ç‰ˆ<br>    with concurrent.futures.ProcessPoolExecutor() as executor:<br>        executor.map(cpu_bound_thread, numbers)<br><br>def main_thread():<br>    start_time = time.perf_counter()<br>    numbers = [10000000 + x for x in range(20)]<br>    calculate_sums_thread(numbers)<br>    end_time = time.perf_counter()<br>    print(&#39;Calculation takes {} seconds&#39;.format(end_time - start_time))<br><br>if __name__ == &#39;__main__&#39;:<br>    # å•çº¿ç¨‹ç‰ˆæœ¬ï¼Œè€—æ—¶å°†è¿‘18så·¦å³<br>    # main_single()<br>    # å¤šçº¿ç¨‹ç‰ˆæœ¬ ç”¨æ—¶18så·¦å³ å¤šè¿›ç¨‹ç”¨æ—¶ 5s<br>    main_thread()","like_count":0},{"had_liked":false,"id":221405,"user_name":"Flynn","can_delete":false,"product_type":"c1","uid":1138563,"ip_address":"","ucode":"BD3A938D02AF8C","user_header":"https://static001.geekbang.org/account/avatar/00/11/5f/83/caf8cab9.jpg","comment_is_top":false,"comment_ctime":1590493683,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590493683","product_id":100026901,"comment_content":"import time<br>from concurrent.futures import ProcessPoolExecutor<br><br>def cpu_bound(number):<br>    return sum(i * i for i in range(number))<br><br>def find_sums(numbers):<br>    with ProcessPoolExecutor() as executor:<br>        executor.map(cpu_bound, numbers)<br><br><br>if __name__ == &quot;__main__&quot;:<br>    numbers = [10000000 + x for x in range(20)]<br><br>    start_time = time.time()<br>    find_sums(numbers)<br>    duration = time.time() - start_time<br>    print(f&quot;Duration {duration} seconds&quot;)","like_count":0},{"had_liked":false,"id":215206,"user_name":"æ›¾ä¼Ÿæ°","can_delete":false,"product_type":"c1","uid":1828065,"ip_address":"","ucode":"3DC3F0CC443E90","user_header":"","comment_is_top":false,"comment_ctime":1588929225,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588929225","product_id":100026901,"comment_content":"from joblib import Parallel, delayed<br>import time<br><br><br>def cpu_bound(number):<br>    print(sum(i * i for i in range(number)))<br><br><br>def calculate_sums(numbers):<br>    Parallel(n_jobs=3)(<br>        delayed(cpu_bound)(number)<br>        for number in numbers)<br><br><br>def main():<br>    start_time = time.perf_counter()<br>    numbers = [5000000 + x for x in range(20)]<br>    calculate_sums(numbers)<br>    end_time = time.perf_counter()<br>    print(&#39;Calculation takes {} seconds&#39;.format(end_time - start_time))<br><br><br>if __name__ == &#39;__main__&#39;:<br>    main()","like_count":0},{"had_liked":false,"id":207891,"user_name":"ç‘å“²","can_delete":false,"product_type":"c1","uid":1502093,"ip_address":"","ucode":"9F170728A055AD","user_header":"https://static001.geekbang.org/account/avatar/00/16/eb/8d/8ee78d3d.jpg","comment_is_top":false,"comment_ctime":1587208561,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587208561","product_id":100026901,"comment_content":"# async_square_sum.py<br><br>&quot;&quot;&quot;<br>è¾“å…¥ä¸€ä¸ªåˆ—è¡¨ï¼Œå¯¹äºåˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œæˆ‘æƒ³è®¡ç®— 0 åˆ°è¿™ä¸ªå…ƒç´ çš„æ‰€æœ‰æ•´æ•°çš„å¹³æ–¹å’Œã€‚<br>æ¯ä¸€ä¸ªå…ƒç´ å¹³å‡åˆ†åˆ°æ¯ä¸€ä¸ªæ ¸æ¥ç®—ã€‚<br>&quot;&quot;&quot;<br>import concurrent.futures<br>import time<br><br><br>def compute_one(start, end):<br>    return sum(i * i for i in range(start, end))<br><br><br>def async_cpu_bound(number):<br>    ret = 0<br>    with concurrent.futures.ProcessPoolExecutor() as executor:<br>        to_do = []<br>        max_workers = executor._max_workers<br><br>        nodes = [round(number * i &#47; max_workers) for i in range(max_workers)]<br>        nodes.append(number)<br>        for i in range(1, len(nodes)):<br>            future = executor.submit(compute_one, nodes[i - 1], nodes[i])<br>            to_do.append(future)<br>            # as_completedå‡½æ•°ï¼Œåœ¨futureå®Œæˆåï¼Œè¾“å‡ºç»“æœ<br>        for future in concurrent.futures.as_completed(to_do):<br>            ret += future.result()<br>    print(ret)<br><br><br>def calculate_sums(numbers):<br>    for number in numbers:<br>        async_cpu_bound(number)<br><br><br>def main():<br>    start_time = time.perf_counter()<br>    numbers = [10000000 + x for x in range(60)]<br>    calculate_sums(numbers)<br>    end_time = time.perf_counter()<br>    print(&#39;Calculation takes {} seconds&#39;.format(end_time - start_time))<br><br><br>if __name__ == &#39;__main__&#39;:<br>    main()<br>","like_count":0},{"had_liked":false,"id":207890,"user_name":"ç‘å“²","can_delete":false,"product_type":"c1","uid":1502093,"ip_address":"","ucode":"9F170728A055AD","user_header":"https://static001.geekbang.org/account/avatar/00/16/eb/8d/8ee78d3d.jpg","comment_is_top":false,"comment_ctime":1587208512,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587208512","product_id":100026901,"comment_content":"å¦ä¸€ç§åšæ³•<br># async_square_sum.py<br><br>&quot;&quot;&quot;<br>è¾“å…¥ä¸€ä¸ªåˆ—è¡¨ï¼Œå¯¹äºåˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œæˆ‘æƒ³è®¡ç®— 0 åˆ°è¿™ä¸ªå…ƒç´ çš„æ‰€æœ‰æ•´æ•°çš„å¹³æ–¹å’Œã€‚<br>æ¯ä¸€ä¸ªå…ƒç´ å¹³å‡åˆ†åˆ°æ¯ä¸€ä¸ªæ ¸æ¥ç®—ã€‚<br>&quot;&quot;&quot;<br>import concurrent.futures<br>import time<br><br><br>def compute_one(start, end):<br>    return sum(i * i for i in range(start, end))<br><br><br>def async_cpu_bound(number):<br>    ret = 0<br>    with concurrent.futures.ProcessPoolExecutor() as executor:<br>        to_do = []<br>        max_workers = executor._max_workers<br><br>        nodes = [round(number * i &#47; max_workers) for i in range(max_workers)]<br>        nodes.append(number)<br>        for i in range(1, len(nodes)):<br>            future = executor.submit(compute_one, nodes[i - 1], nodes[i])<br>            to_do.append(future)<br>            # as_completedå‡½æ•°ï¼Œåœ¨futureå®Œæˆåï¼Œè¾“å‡ºç»“æœ<br>        for future in concurrent.futures.as_completed(to_do):<br>            ret += future.result()<br>    print(ret)<br><br><br>def calculate_sums(numbers):<br>    for number in numbers:<br>        async_cpu_bound(number)<br><br><br>def main():<br>    start_time = time.perf_counter()<br>    numbers = [10000000 + x for x in range(60)]<br>    calculate_sums(numbers)<br>    end_time = time.perf_counter()<br>    print(&#39;Calculation takes {} seconds&#39;.format(end_time - start_time))<br><br><br>if __name__ == &#39;__main__&#39;:<br>    main()<br>","like_count":0},{"had_liked":false,"id":206663,"user_name":"é£å¹æˆ‘èµ°","can_delete":false,"product_type":"c1","uid":1437373,"ip_address":"","ucode":"0AC9B31DAEFBB5","user_header":"https://static001.geekbang.org/account/avatar/00/15/ee/bd/2a610ff9.jpg","comment_is_top":false,"comment_ctime":1586914582,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586914582","product_id":100026901,"comment_content":"import asyncio<br>import time, concurrent.futures<br><br><br>def cpu_bound(number):<br>    print(sum(i * i for i in range(number)))<br><br><br>async def cpu_bound_async(number):<br>    print(sum(i * i for i in range(number)))<br><br><br>def calculate_sums(numbers):<br>    for number in numbers:<br>        cpu_bound(number)<br><br><br>def calculate_sums_with_Process(numbers):<br>    with concurrent.futures.ProcessPoolExecutor() as executor:<br>        executor.map(cpu_bound, numbers)<br><br><br>def calculate_sums_with_Thread(numbers):<br>    with concurrent.futures.ThreadPoolExecutor(max_workers=5) as executor:<br>        executor.map(cpu_bound, numbers)<br><br>async def calulate_sums_with_async(numbers):<br>    tasks = [asyncio.create_task(cpu_bound_async(number)) for number in numbers]<br>    await asyncio.gather(*tasks)<br><br>def main():<br>    numbers = [10000000 + x for x in range(20)]<br>    print(&#39;=======Normal======&#39;)<br>    start_time = time.perf_counter()<br>    # print(numbers)<br>    calculate_sums(numbers)<br>    end_time = time.perf_counter()<br>    print(&#39;Calculation takes {} seconds.&#39;.format(end_time - start_time))<br>    print(&#39;=========WithProcess======&#39;)<br>    start_time = time.perf_counter()<br>    # numbers = [10000000 + x for x in range(20)]<br>    # print(numbers)<br>    calculate_sums_with_Process(numbers)<br>    end_time = time.perf_counter()<br>    print(&#39;Calculation takes {} seconds.&#39;.format(end_time - start_time))<br>    print(&#39;========WithThread=======&#39;)<br>    start_time = time.perf_counter()<br>    # numbers = [10000000 + x for x in range(20)]<br>    # print(numbers)<br>    calculate_sums_with_Thread(numbers)<br>    end_time = time.perf_counter()<br>    print(&#39;Calculation takes {} seconds.&#39;.format(end_time - start_time))<br>    print(&#39;========WithAsync======&#39;)<br>    start_time = time.perf_counter()<br>    # numbers = [10000000 + x for x in range(20)]<br>    # print(numbers)<br>    asyncio.run(calulate_sums_with_async(numbers))<br>    end_time = time.perf_counter()<br>    print(&#39;Calculation takes {} seconds.&#39;.format(end_time - start_time))<br><br>if __name__ == &#39;__main__&#39;:<br>    main()<br>","like_count":0},{"had_liked":false,"id":203559,"user_name":"æ— æ‰ä¸è‚–ç”Ÿ","can_delete":false,"product_type":"c1","uid":1065687,"ip_address":"","ucode":"A2F83FC7405792","user_header":"https://static001.geekbang.org/account/avatar/00/10/42/d7/1f1634af.jpg","comment_is_top":false,"comment_ctime":1586233099,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586233099","product_id":100026901,"comment_content":"å®é™…ä¸­async å’Œawaitéƒ½è¯¥å†™åœ¨å“ªäº›è¯­å¥ï¼Œå®åœ¨æä¸æ¸…ï¼Œæœ‰æ²¡æœ‰èƒ½æŒ‡ç‚¹ä¸€ä¸‹çš„ã€‚<br>async def download_url(url):<br>    async with aiohttp.ClientSession() as session:  #ä¸ºä»€ä¹ˆè¿™é‡Œè¦async<br>        async with session.get(url) as resp: #è¿™é‡Œä¸ºä»€ä¹ˆè¦async<br>            # time.sleep(2)  #è¿™é‡Œè¯¥ç”¨asyncè¿˜æ˜¯await<br>            print(f&#39;å¾…æ—¶é—´ï¼š{2},content length:{resp.content_length}&#39;)<br>            await write_to_file(resp.text)   #è¿™é‡Œæˆ‘å†™åˆ°æ–‡ä»¶é‚£ä¹ˆè¯¥ç”¨ä»€ä¹ˆ<br><br>async def write_to_file(text):<br>    file_path = &#39;.&#47;future_test&#47;files&#47;&#39;<br>    if not os.path.exists(file_path):<br>        print(f&#39;create path:{file_path}&#39;)<br>        os.makedirs(file_path)<br>    async with open(os.path.join(file_path, datetime.now().strftime(&#39;%Y%m%d%H%M%S&#39;) + uuid.uuid4().hex[:10] + &#39;.txt&#39;), &#39;w&#39;) as f:  #è¿™é‡Œ<br>        await f.write(text)  #è¿™é‡Œ<br>        print(f&#39;write {len(text)}&#39;)<br><br>ä¸çŸ¥é“éƒ½å“ªé‡Œè¯¥ç”¨asyncå’Œawaitï¼ŒåŒæ—¶è¿˜èƒ½ä¿è¯å†™æ–‡ä»¶çš„å†…å®¹ä¸ä¼šå‡ºé”™","like_count":0},{"had_liked":false,"id":192388,"user_name":"Longerian","can_delete":false,"product_type":"c1","uid":1032464,"ip_address":"","ucode":"0B74EE70D09A2A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c1/10/28d5a686.jpg","comment_is_top":false,"comment_ctime":1584848449,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584848449","product_id":100026901,"comment_content":"# ç»ƒä¹ é¢˜ï¼Œå¤šè¿›ç¨‹ç‰ˆæœ¬<br>import concurrent.futures<br>import time<br><br>def calculate_one(number):<br>    result = sum(i * i for i in range(number))<br>#     print(result)<br>    return result<br><br>def calculate_sums(numbers):<br>    with concurrent.futures.ProcessPoolExecutor(max_workers=4) as executor:<br>#         executor.map(calculate_one, numbers)<br>        todo = []<br>        for number in numbers:<br>            future = executor.submit(calculate_one, number)<br>            todo.append(future)<br>            <br>        for future in concurrent.futures.as_completed(todo):<br>            print(future.result())<br><br>def main():<br>    start_time = time.perf_counter()<br>    numbers = [10000000 + x for x in range(10)]<br>    print(numbers)<br>    calculate_sums(numbers)<br>    end_time = time.perf_counter()<br>    print(&#39;Calculation takes {} seconds&#39;.format(end_time - start_time))<br>    <br>if __name__ == &#39;__main__&#39;:<br>    main()<br><br>æµ‹è¯•äº†ä¸‹ concurrent.futures.ProcessPoolExecutor(max_workers=4) è¿™ä¸€å¥å¿…é¡»å¾—æŒ‡å®šworkerå‚æ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼š&lt;ipython-input-29-ad5cc29cafd2&gt; in calculate_sums(numbers)<br>      9 <br>     10 def calculate_sums(numbers):<br>---&gt; 11     with concurrent.futures.ProcessPoolExecutor as executor:<br>     12         executor.map(calculate_one, numbers)<br>     13 #         todo = []<br><br>AttributeError: __enter__<br><br>å¤šè¿›ç¨‹ç‰ˆæœ¬æ‰§è¡Œä¸‹æ¥æœ‰é€Ÿåº¦æœ‰å¤§å¹…æå‡","like_count":0},{"had_liked":false,"id":192373,"user_name":"Longerian","can_delete":false,"product_type":"c1","uid":1032464,"ip_address":"","ucode":"0B74EE70D09A2A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c1/10/28d5a686.jpg","comment_is_top":false,"comment_ctime":1584847999,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584847999","product_id":100026901,"comment_content":"å†™äº†è¿™ä¹ˆä¸€æ®µæ–¹æ³•ï¼š<br> def calculate_sums(numbers):<br>    with concurrent.futures.ProcessPoolExecutor as executor:<br>        executor.map(calculate_one, numbers)<br><br>è¿è¡Œæ—¶æŠ¥é”™ï¼Œæ˜¯ä¸ºä»€ä¹ˆï¼Œpythonç‰ˆæœ¬ 3.7.3ï¼Œåœ¨ notebooké‡Œè¿è¡Œä¹Ÿæœ‰è¿™ä¸ªé”™<br>&lt;ipython-input-29-ad5cc29cafd2&gt; in calculate_sums(numbers)<br>      9 <br>     10 def calculate_sums(numbers):<br>---&gt; 11     with concurrent.futures.ProcessPoolExecutor as executor:<br>     12         executor.map(calculate_one, numbers)<br>     13 #         todo = []<br><br>AttributeError: __enter__<br>","like_count":0},{"had_liked":false,"id":175532,"user_name":"è‹¹æœ","can_delete":false,"product_type":"c1","uid":1761988,"ip_address":"","ucode":"5D0FA9D8560FD8","user_header":"https://static001.geekbang.org/account/avatar/00/1a/e2/c4/25acaa38.jpg","comment_is_top":false,"comment_ctime":1580739629,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1580739629","product_id":100026901,"comment_content":"#åˆ©ç”¨å¤šè¿›ç¨‹å®ç°ä¸Šè¿°çš„è®¡ç®—ä¾‹å­<br>import time<br>from concurrent import futures<br>def cpu_bound(number):<br>    print(sum(i * i for i in range(number)))<br><br>def calculate_sums(numbers):<br>    with futures.ProcessPoolExecutor() as executor:<br>        executor.map(cpu_bound,numbers)<br><br>def main():<br>    start_time = time.perf_counter()  <br>    numbers = [10000000 + x for x in range(20)]<br>    calculate_sums(numbers)<br>    end_time = time.perf_counter()<br>    print(&#39;Calculation takes {} seconds&#39;.format(end_time - start_time))<br>    <br>if __name__ == &#39;__main__&#39;:<br>    main()<br>","like_count":0},{"had_liked":false,"id":165976,"user_name":"èµ·äºç´¯åœŸ","can_delete":false,"product_type":"c1","uid":1227925,"ip_address":"","ucode":"2D95D0C6D6226E","user_header":"https://static001.geekbang.org/account/avatar/00/12/bc/95/2dbacf68.jpg","comment_is_top":false,"comment_ctime":1577353972,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1577353972","product_id":100026901,"comment_content":"import time<br>import multiprocessing<br><br><br>def cpu_bound(number):<br>    print(sum(i * i for i in range(number)))<br><br><br>def calculate_sums(numbers):<br>    pool = multiprocessing.Pool(processes=4)<br>    for number in numbers:<br>        pool.apply_async(cpu_bound, (number,))<br>    pool.close()<br>    pool.join()<br><br>def main():<br>    start_time = time.perf_counter()<br>    numbers = [10000000 + x for x in range(20)]<br><br>    calculate_sums(numbers)<br>    end_time = time.perf_counter()<br>    print(&#39;Calculation takes {} seconds&#39;.format(end_time - start_time))<br><br><br>if __name__ == &#39;__main__&#39;:<br>    main()","like_count":0},{"had_liked":false,"id":164816,"user_name":"Lion","can_delete":false,"product_type":"c1","uid":1354415,"ip_address":"","ucode":"AB9F4F373A5DF9","user_header":"https://static001.geekbang.org/account/avatar/00/14/aa/af/98c5e896.jpg","comment_is_top":false,"comment_ctime":1577094757,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577094757","product_id":100026901,"comment_content":"æ€è€ƒé¢˜ï¼š<br>import time<br>import os<br>from multiprocessing import Pool<br><br>def cpu_bound(number):<br>    return sum(i * i for i in range(number))<br><br>def calculate_sums(numbers):<br>\twith Pool() as p:<br>\t\tresult = p.map(cpu_bound, numbers)<br>\t\tfor one in result:<br>\t\t\tprint(one)<br>\t\t\t\t\t\t<br>def main():<br>    start_time = time.perf_counter()  <br>    numbers = [10000000 + x for x in range(20)]<br>    calculate_sums(numbers)<br>    end_time = time.perf_counter()<br>    print(&#39;Calculation takes {} seconds&#39;.format(end_time - start_time))<br>    <br>if __name__ == &#39;__main__&#39;:<br>    main()","like_count":0},{"had_liked":false,"id":164586,"user_name":"é•¿æœŸè§„åˆ’","can_delete":false,"product_type":"c1","uid":1019332,"ip_address":"","ucode":"5EF65E9115834B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","comment_is_top":false,"comment_ctime":1577033916,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577033916","product_id":100026901,"comment_content":"è€å¸ˆï¼Œæˆ‘è¯´ä¸€ä¸‹å¯¹geventå’Œasyncioçš„ç†è§£ï¼Œè¯·æŒ‡æ­£ã€‚geventçš„ç‰¹ç‚¹æ˜¯å¦‚æœå¯¹socketæ‰“patchï¼Œé‚£æ‰€æœ‰ä½¿ç”¨socketåº“çš„åœ°æ–¹éƒ½è¢«patchäº†ï¼Œå½±å“èŒƒå›´æ˜¯å…¨å±€æ€§çš„ï¼Œä¼˜ç‚¹æ˜¯ä¸€ä¸ªåŒæ­¥åº“åœ¨ä½¿ç”¨geventåå°±å˜æˆå¼‚æ­¥äº†ï¼Œå¾ˆæ–¹ä¾¿ã€‚è€Œasyncioåªåœ¨ä½ æƒ³å¼‚æ­¥çš„åœ°æ–¹å¼‚æ­¥ï¼Œå½±å“èŒƒå›´æ˜¯å±€éƒ¨æ€§çš„ï¼Œæ›´å¯æ§ï¼Œä½†ç¼ºç‚¹æ˜¯ä¸€ä¸ªåŒæ­¥åº“ï¼Œä½ æ— æ³•ä½¿ç”¨asyncioã€‚è¿™ç§ç†è§£å¯¹å—","like_count":0},{"had_liked":false,"id":162489,"user_name":"å¡å¡","can_delete":false,"product_type":"c1","uid":1123771,"ip_address":"","ucode":"1114D32368CBC1","user_header":"https://static001.geekbang.org/account/avatar/00/11/25/bb/030145ca.jpg","comment_is_top":false,"comment_ctime":1576545475,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576545475","product_id":100026901,"comment_content":"è€å¸ˆï¼Œä½ å¥½ï¼Œpythonæœ‰ä¸ªå¤šè¿›ç¨‹çš„åº“ï¼šmultiprocessingï¼Œå¯ä»¥è¯¦ç»†è®²è§£ä¸€ä¸‹ä¹ˆï¼Ÿ","like_count":0},{"had_liked":false,"id":154492,"user_name":"è½»é£æ‚ æ‰¬","can_delete":false,"product_type":"c1","uid":1319215,"ip_address":"","ucode":"F2276CE113BED1","user_header":"https://static001.geekbang.org/account/avatar/00/14/21/2f/b29e8af8.jpg","comment_is_top":false,"comment_ctime":1574461367,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1574461367","product_id":100026901,"comment_content":"ä½ å¥½è€å¸ˆï¼Œæˆ‘åœ¨è¿è¡Œæ–‡ä¸­ä¾‹å­çš„æ—¶å€™å¾—åˆ°ä¸€ä¸ªRuntimeError: Event loop is closedã€‚","like_count":0},{"had_liked":false,"id":153853,"user_name":"ã€‚","can_delete":false,"product_type":"c1","uid":1141658,"ip_address":"","ucode":"E71BD258F7FC26","user_header":"https://static001.geekbang.org/account/avatar/00/11/6b/9a/30de483d.jpg","comment_is_top":false,"comment_ctime":1574319368,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1574319368","product_id":100026901,"comment_content":"pyhton 3.7.4 åœ¨jupyterä¸­ æ‰§è¡Œ asyncio.run è¿˜æ˜¯æŠ¥RuntimeError: asyncio.run() cannot be called from a running event loopï¼Œ æ¢æˆ await æŠ¥SyntaxError: &#39;await&#39; outside async functionï¼Œè¿™æ˜¯ä»€ä¹ˆåŸå› ","like_count":0,"discussions":[{"author":{"id":1107591,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e6/87/00febb64.jpg","nickname":"é›·æ›´","note":"","ucode":"BE7840FECBBE32","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":70635,"discussion_content":"jupterçš„bugï¼Œä½¿ç”¨äº†tornadoçš„loopäº†ã€‚é™ç‰ˆæœ¬å°±å¯ä»¥è§£å†³","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575374177,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":152565,"user_name":"æ®µæ€»","can_delete":false,"product_type":"c1","uid":1736445,"ip_address":"","ucode":"6A9DFAC00D984A","user_header":"https://static001.geekbang.org/account/avatar/00/1a/7e/fd/8db6a025.jpg","comment_is_top":false,"comment_ctime":1574043358,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1574043358","product_id":100026901,"comment_content":"ç½‘ç«™ä¸‹è½½é‚£ä¸ªä»£ç å‡ºç°è¿™ä¸ªé—®é¢˜ï¼šCannot connect to host en.wikipedia.org:443 ssl:default [è¿œç¨‹ä¸»æœºå¼ºè¿«å…³é—­äº†ä¸€ä¸ªç°æœ‰çš„è¿æ¥ã€‚] çƒ¦è¯·å¤§å®¶æœ‰ç©ºçœ‹çœ‹è¯¥æ€ä¹ˆè§£å†³ï¼Ÿè°¢è¿‡å¤§å®¶ï¼","like_count":0,"discussions":[{"author":{"id":1705772,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/07/2c/d2f48330.jpg","nickname":"Ryan","note":"","ucode":"D3174038A12163","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":64096,"discussion_content":"è¢«å¢™äº†...","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1574936546,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":149777,"user_name":"LeonğŸ“·","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1573375151,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573375151","product_id":100026901,"comment_content":"è€å¸ˆï¼Œæˆ‘çš„pycharmæœ€æ–°ç‰ˆæŠ¥è¿™ä¸ªé”™è¯¯ï¼Œè¿™ä¸ªæ˜¯å•¥æ„æ€  File &quot;&#47;Users&#47;Liuchao&#47;PycharmProjects&#47;lsn1&#47;venv&#47;lib&#47;python3.7&#47;site-packages&#47;aiohttp&#47;tcp_helpers.py&quot;, line 20, in &lt;module&gt;<br>    def tcp_keepalive(transport: asyncio.Transport) -&gt; None:<br>AttributeError: module &#39;asyncio&#39; has no attribute &#39;Transport&#39;","like_count":0},{"had_liked":false,"id":149320,"user_name":"å­¤ç‹¬å‰‘","can_delete":false,"product_type":"c1","uid":1526368,"ip_address":"","ucode":"C639EED1385A6A","user_header":"https://static001.geekbang.org/account/avatar/00/17/4a/60/16e74471.jpg","comment_is_top":false,"comment_ctime":1573192165,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573192165","product_id":100026901,"comment_content":"c++è°ƒç”¨pycæ–‡ä»¶A.pycï¼ŒA.pycåˆåŒæ—¶è°ƒç”¨äº†è‡ªå®šä¹‰å—B.pycï¼Œç³»ç»Ÿæç¤ºæ‰¾ä¸åˆ°B.pycæ¨¡å—ï¼Œæ˜¯ä»€ä¹ˆåŸå› å‘¢  ä¸¤ä¸ªæ¨¡å—éƒ½æ”¾åœ¨c++è½¯ä»¶ç³»ç»Ÿç›®å½•","like_count":0},{"had_liked":false,"id":146588,"user_name":"é˜¿å¡ç‰›","can_delete":false,"product_type":"c1","uid":1022247,"ip_address":"","ucode":"0BC43A904C3199","user_header":"https://static001.geekbang.org/account/avatar/00/0f/99/27/47aa9dea.jpg","comment_is_top":false,"comment_ctime":1572577209,"is_pvip":false,"replies":[{"id":"56796","content":"é€šä¿—æ¥è®²æ˜¯","user_name":"ä½œè€…å›å¤","user_name_real":"Jingxiao","uid":"1259521","ctime":1572803956,"ip_address":"","comment_id":146588,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1572577209","product_id":100026901,"comment_content":"å¸¸å¬åˆ°é˜»å¡ï¼ŒåŒæ­¥æ˜¯ä¸æ˜¯å°±æ˜¯é˜»å¡åœ°æ„æ€","like_count":0,"discussions":[{"author":{"id":1259521,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJOlibibPFEWOib8ib7RtfAtxND5FUqCxxoeTuLAbBI9ic23xuwdXT4IyiaWq3Fic9RgEAYI0lBTbEp2rcg/132","nickname":"Jingxiao","note":"","ucode":"EB966BB87132F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472928,"discussion_content":"é€šä¿—æ¥è®²æ˜¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572803956,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1105161,"avatar":"https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg","nickname":"helloworld","note":"","ucode":"1EECCA0F43E278","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":218500,"discussion_content":"åŒæ­¥å’Œé˜»å¡å®Œå…¨æ˜¯ä¸¤ç äº‹ï¼ŒåŒæ­¥æ˜¯é’ˆå¯¹ä»£ç æ¥è¯´çš„ï¼Œé˜»å¡æ˜¯é’ˆå¯¹cpuæ¥è¯´çš„ï¼Œæœ‰ä¸€ä¸ªè¯´æ³•å«åŒæ­¥éé˜»å¡ï¼Œæ„æ€æ˜¯è¯´ï¼Œä»£ç æ˜¯åŒæ­¥çš„ï¼Œå°±æ˜¯æŒ‰æ­£å¸¸é€»è¾‘é¡ºåºå†™çš„ï¼Œä½†æ˜¯å’Œå¼‚æ­¥ä»£ç æ•ˆæœä¸€æ ·ï¼Œä¸ä¼šç”±äºç½‘ç»œæˆ–ç£ç›˜ioè®©cpuç­‰å¾…ï¼Œå¯¼è‡´é˜»å¡å…¶ä»–ä»£ç é€»è¾‘æ‰§è¡Œï¼Œå…¸å‹çš„ä¾‹å­å°±æ˜¯openresty/luaï¼Œå€ŸåŠ©nginxçš„äº‹ä»¶å¾ªç¯æœºåˆ¶ï¼Œå¼€å‘è€…å†™åŒæ­¥çš„ä»£ç ï¼Œå°±ä¼šæœ‰å¼‚æ­¥çš„æ•ˆæœã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1585663005,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":140706,"user_name":"è‡ªç”±æ°‘","can_delete":false,"product_type":"c1","uid":1346236,"ip_address":"","ucode":"435C67531697F1","user_header":"https://static001.geekbang.org/account/avatar/00/14/8a/bc/cb39ed38.jpg","comment_is_top":false,"comment_ctime":1571035181,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571035181","product_id":100026901,"comment_content":"æ€»ç»“:Pythonå¹¶å‘ç¼–ç¨‹å¼€é”€ä»å¤§åˆ°å°ä¸ºå¤šè¿›ç¨‹ï¼Œå¤šçº¿ç¨‹å’Œåç¨‹ã€‚åˆ†åˆ«é€‚åˆäºé‡CPUæ“ä½œï¼Œé‡I&#47;Oå¿«æ“ä½œï¼Œé‡I&#47;Oæ…¢æ“ä½œã€‚æ³¨æ„ä½¿ç”¨Asyncioéœ€è¦ç¬¬ä¸‰æ–¹åº“æ”¯æŒã€‚<br>æ€è€ƒé¢˜<br># æ€è€ƒé¢˜ å¹¶è¡Œç‰ˆæœ¬<br>def calculate_sums_future(numbers):<br>    with concurrent.futures.ThreadPoolExecutor() as executor:<br>        executor.map(cpu_bound, numbers)<br><br>def calcuter_future(numbers):<br>    start_time = time.perf_counter()<br>    calculate_sums_future(numbers)<br>    end_time = time.perf_counter()<br>    print(&quot;å¤šè¿›ç¨‹ç‰ˆæœ¬ï¼Œè€—æ—¶{}ç§’&quot;.format(end_time-start_time))<br>è¿è¡Œç»“æœå´ä¸å¥½ï¼Œè€—æ—¶æ˜¯æ™®é€šç‰ˆæœ¬çš„8å€ã€‚<br>åˆå†™äº†ä¸€ä¸ªåŠ¨æ€è§„åˆ’çš„ç‰ˆæœ¬:<br># æ€è€ƒé¢˜ åŠ¨æ€è§„åˆ’ç‰ˆæœ¬<br>squ = {} # ç”¨æ¥å‚¨å­˜ä¸­é—´ç»“æœ<br>def cpu_dp(number):<br>\tresult = 0<br>\tfor i in range(number):<br>\t\tif i not in squ.keys():<br>\t\t\tsqu[i] = i*i<br>\t\tresult += squ[i]<br>\tprint(&quot;number={}, result={}&quot;.format(number, result))<br>\t\t<br>def calculate_sums_dp(numbers):<br>\tfor number in numbers:<br>\t\tcpu_dp(number)<br>\t\t<br>def calcuter_dp(numbers):<br>\tstart_time = time.perf_counter()<br>\tcalculate_sums_dp(numbers)<br>\tend_time = time.perf_counter()<br>\tprint(&quot;åŠ¨æ€è§„åˆ’ç‰ˆæœ¬ï¼Œè€—æ—¶{}ç§’&quot;.format(end_time-start_time))<br>è€—æ—¶è¿˜æ˜¯æ¯”å¸¸è§„ç‰ˆæœ¬æ…¢äº†ä¸¤å€ã€‚åŸå› ï¼Ÿ<br>è¯¾ç¨‹çš„ç»ƒä¹ ä»£ç : https:&#47;&#47;github.com&#47;zwdnet&#47;PythonPractice","like_count":0},{"had_liked":false,"id":137971,"user_name":"å®‰æ’","can_delete":false,"product_type":"c1","uid":1260026,"ip_address":"","ucode":"F78CFA9624CAEF","user_header":"https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg","comment_is_top":false,"comment_ctime":1569946063,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1569946063","product_id":100026901,"comment_content":"cpuå¯†é›†å‹çš„ä»»åŠ¡ä¸ºä»€ä¹ˆå¤šè¿›ç¨‹ä¼šå¥½äº›ï¼Ÿç”¨å¤šçº¿ç¨‹ä¸ä¹Ÿæ˜¯å¯ä»¥å—ï¼Ÿå¤šè¿›ç¨‹æˆ‘ç†è§£çš„å°±æ˜¯éš”ç¦»ä½œç”¨ä¼šå¥½ä¸€äº›ã€‚ç”¨å¤šçº¿ç¨‹åªè¦èƒ½è·‘æ»¡å¤šä¸ªæ ¸æ•ˆç‡æ˜¯ä¸€æ ·çš„å§ã€‚","like_count":0,"discussions":[{"author":{"id":1156329,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a4/e9/3b65c171.jpg","nickname":"è¶…äºº","note":"","ucode":"119ED76F577FC7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":29073,"discussion_content":"å•ä¸ªè¿›ç¨‹å†…ï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œï¼Œå¤šè¿›ç¨‹çš„å¯ä»¥ä½¿ç”¨å¤šæ ¸å¹¶è¡Œæ‰§è¡Œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570724944,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1260026,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg","nickname":"å®‰æ’","note":"","ucode":"F78CFA9624CAEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1156329,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a4/e9/3b65c171.jpg","nickname":"è¶…äºº","note":"","ucode":"119ED76F577FC7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":29079,"discussion_content":"ç†è§£äº†ï¼Œè¿™é‡Œçš„çº¿ç¨‹è¯´çš„æ˜¯pythonçš„çº¿ç¨‹ï¼Œä¸èƒ½çœŸæ­£å¹¶è¡Œã€‚æˆ‘ç†è§£æˆposixçº¿ç¨‹äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570725180,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":29073,"ip_address":""},"score":29079,"extra":""}]}]},{"had_liked":false,"id":129326,"user_name":"ç¦å¸ƒæ–¯ç¬¬ä¸€","can_delete":false,"product_type":"c1","uid":1244851,"ip_address":"","ucode":"6DA11E1E6819F2","user_header":"https://static001.geekbang.org/account/avatar/00/12/fe/b3/964eb5ac.jpg","comment_is_top":false,"comment_ctime":1567088803,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567088803","product_id":100026901,"comment_content":"ç”¨äº†è€å¸ˆ21èŠ‚è¯¾çš„concurrentåŒ…ã€‚ã€‚ã€‚æ„Ÿè§‰è¿™ä¸ªæ›´æŠ½è±¡æ›´æ–¹ä¾¿ã€‚<br><br>import time<br>import concurrent.futures<br>def cpu_bound(number):<br>    print(sum(i * i for i in range(number)))<br><br>def calculate_sums(numbers):<br>    with concurrent.futures.ProcessPoolExecutor() as executor:<br>        executor.map(cpu_bound, numbers)<br>#     for number in numbers:<br>#         cpu_bound(number)<br><br>def main():<br>    start_time = time.perf_counter()<br>    numbers = [10000000 + x for x in range(20)]<br>    calculate_sums(numbers)<br>    end_time = time.perf_counter()<br>    print(&#39;Calculation take {} seconds&#39;.format(end_time - start_time))<br>    <br>if __name__ == &#39;__main__&#39;:<br>    main()<br><br>Calculation take 0.24892765399999917 seconds<br>","like_count":0},{"had_liked":false,"id":127028,"user_name":"å¤§é¾„å°å­¦ç”Ÿ","can_delete":false,"product_type":"c1","uid":1057111,"ip_address":"","ucode":"AA7860B88FB0F1","user_header":"https://static001.geekbang.org/account/avatar/00/10/21/57/ee02ef41.jpg","comment_is_top":false,"comment_ctime":1566538783,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566538783","product_id":100026901,"comment_content":"è€å¸ˆï¼Œç”¨ä¸€ä¸ªçº¿ç¨‹æŸ¥çœ‹å¹¶ä¿®æ”¹ä»»åŠ¡çŠ¶æ€ï¼Œå¦ä¸€çº¿ç¨‹åªç®¡è°ƒå…¥å‡†å¤‡å¥½ä»»åŠ¡çš„è¿è¡Œï¼Œè¿™æ ·æ˜¯ä¸æ˜¯ä¹Ÿè¡Œï¼Ÿ","like_count":0},{"had_liked":false,"id":120877,"user_name":"æ¢å¤§ç“œ","can_delete":false,"product_type":"c1","uid":1435855,"ip_address":"","ucode":"04D708E3662D27","user_header":"https://static001.geekbang.org/account/avatar/00/15/e8/cf/554f08f9.jpg","comment_is_top":false,"comment_ctime":1565008429,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565008429","product_id":100026901,"comment_content":"import time<br>from concurrent import futures<br>import multiprocessing<br><br>def calBound(num):<br>    return sum(i*i for i in range(num))<br>def main():<br>    start_time = time.perf_counter()<br><br>    numbers = [10000000 + x for x in range(20)]<br>    with futures.ProcessPoolExecutor() as exe:<br>        result = exe.map(calBound, numbers)<br>        print(f&quot;result:{list(result)}&quot;)<br>    end_time = time.perf_counter()<br>    print(&quot;concurrent.futures Cost : {} Seconds&quot;.format(end_time - start_time))<br>def main2():<br>    start_time = time.perf_counter()<br>    numbers = [1000000 + x for x in range(20)]<br>    with multiprocessing.Pool() as pl:<br>        pl_1 = pl.map(calBound,numbers)<br>        print(f&quot;result:{list(pl_1)}&quot;)<br>    end_time = time.perf_counter()<br>    print(&quot;mulitprocessing Model Cost : {} Seconds&quot;.format(end_time-start_time))<br>if __name__ == &#39;__main__&#39;:<br>    print(&quot;about concurrent!&quot;)<br>    main()<br>    print(&quot;about multprocessing!&quot;)<br>    main2()<br>--------ç»“æœ------<br>about concurrent!<br>result:[333333283333335000000, 333333383333335000000, 333333483333355000001, 333333583333395000005, 333333683333455000014, 333333783333535000030, 333333883333635000055, 333333983333755000091, 333334083333895000140, 333334183334055000204, 333334283334235000285, 333334383334435000385, 333334483334655000506, 333334583334895000650, 333334683335155000819, 333334783335435001015, 333334883335735001240, 333334983336055001496, 333335083336395001785, 333335183336755002109]<br>concurrent.futures Cost : 13.748006390000228 Seconds<br>about multprocessing!<br>result:[333332833333500000, 333333833333500000, 333334833335500001, 333335833339500005, 333336833345500014, 333337833353500030, 333338833363500055, 333339833375500091, 333340833389500140, 333341833405500204, 333342833423500285, 333343833443500385, 333344833465500506, 333345833489500650, 333346833515500819, 333347833543501015, 333348833573501240, 333349833605501496, 333350833639501785, 333351833675502109]<br>mulitprocessing Model Cost : 1.2475415999997495 Seconds<br><br>ä½¿ç”¨ä¸åŒçš„åº“ï¼Œç»“æœå·®äº†å¾ˆå¤šã€‚è¿™æ˜¯ä¸ºå•¥ã€‚","like_count":0},{"had_liked":false,"id":117468,"user_name":"taoist","can_delete":false,"product_type":"c1","uid":1195004,"ip_address":"","ucode":"D70AFE25CD8F10","user_header":"https://static001.geekbang.org/account/avatar/00/12/3b/fc/04a75cd0.jpg","comment_is_top":false,"comment_ctime":1564054570,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1564054570","product_id":100026901,"comment_content":"import time<br>import concurrent.futures<br><br><br>def cpu_bound(number):<br>    print(sum(i * i for i in range(number)))<br><br><br>def calculate_sums(numbers):<br>    for number in numbers:<br>        cpu_bound(number)<br><br><br>def process_calculate_sums(numbers):<br>    with concurrent.futures.ProcessPoolExecutor(max_workers=4) as ppe:<br>        ppe.map(cpu_bound, numbers)<br><br><br>def main():<br>    numbers = [10000000 + x for x in range(20)]<br>    start_time = time.perf_counter()<br>    calculate_sums(numbers)<br>    print(&#39;Calculation takes {} seconds&#39;.format(time.perf_counter() - start_time))<br><br>    start_time = time.perf_counter()<br>    process_calculate_sums(numbers)<br>    print(&#39;multiprocessing Calculation takes {} seconds&#39;.format(time.perf_counter() - start_time))<br><br><br>if __name__ == &#39;__main__&#39;:<br>    main()<br><br># ç»“æœ<br>Calculation takes 14.432480293995468 seconds<br>multiprocessing Calculation takes 4.268043693999061 seconds<br># 4æ ¸CPUï¼Œ å®é™…ä¸Šå¹¶æ²¡æœ‰4å€çš„æ€§èƒ½æå‡ï¼Œ3å€å¤šç‚¹","like_count":0},{"had_liked":false,"id":110922,"user_name":"è§æ½‡é£","can_delete":false,"product_type":"c1","uid":1152788,"ip_address":"","ucode":"24BB9E0134B7F5","user_header":"https://static001.geekbang.org/account/avatar/00/11/97/14/20087885.jpg","comment_is_top":false,"comment_ctime":1562395616,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562395616","product_id":100026901,"comment_content":"æœ‰äº›ç½‘ç«™resp.content_lengthä¼šNone;æ‰§è¡Œprint(&#39;Read {} from {}&#39;.format(resp.content_length, url))ä¼šæ˜¾ç¤ºRead None from https:&#47;&#47;news.qq.com&#47;","like_count":0},{"had_liked":false,"id":110357,"user_name":"Ben","can_delete":false,"product_type":"c1","uid":1252353,"ip_address":"","ucode":"70351D4FAE47F7","user_header":"https://static001.geekbang.org/account/avatar/00/13/1c/01/5aaaf5b6.jpg","comment_is_top":false,"comment_ctime":1562240799,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562240799","product_id":100026901,"comment_content":"è€å¸ˆ, è¯·çœ‹ä¸‹, ä¸‹é¢ç†è§£çš„å¯¹ä¸å¯¹<br>å¦‚æœå…±äº«ç›¸åŒçš„äº‹ä»¶å¾ªç¯, é‚£ä¹ˆasyncio.create_taskåˆ›å»ºçš„futureå¯¹è±¡, <br>åœ¨asyncio.gather()æ”¶é›†æ—¶, å¦‚æœé¢„å¤‡çŠ¶æ€çš„é˜Ÿåˆ—ä¸­å‘ç°å·²ç»æ‰§è¡Œäº†, <br>é‚£ä¹ˆå°±åªæ”¶é›†ç»“æœ, ä¸éœ€è¦å†å»æ‰§è¡Œä¸€é, <br>è€Œæœªè¢«æ‰§è¡Œè¿‡çš„, å°±ä¼šæŒ‰ç¨‹åºçš„æ§åˆ¶ç»§ç»­æ‰§è¡Œ, å½“æ‰€æœ‰çš„futureå¯¹è±¡éƒ½å®Œæˆ, å°±è¿”å›ä¸€ä¸ªæ”¶é›†çš„ç»“æœ","like_count":0},{"had_liked":false,"id":109982,"user_name":"å¼ ä¸½å¨œ","can_delete":false,"product_type":"c1","uid":1032331,"ip_address":"","ucode":"D70CFF68E72DAF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c0/8b/0371baee.jpg","comment_is_top":false,"comment_ctime":1562144860,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"1562144860","product_id":100026901,"comment_content":"è¯·é—®åœ¨è¿è¡Œä¸‹è½½ç½‘ç«™å†…å®¹æ—¶å‡ºç°ä»¥ä¸‹é—®é¢˜æ€ä¹ˆè§£å†³å•Šï¼Ÿæˆ‘ä¹Ÿé‡åˆ°äº†è¿™ä¸ªé”™è¯¯ï¼Œè¯·è€å¸ˆèƒ½ç»™ç»™äºˆè§£ç­”<br>SSL error in data received<br>protocol: &lt;asyncio.sslproto.SSLProtocol object at 0x7f3a241e4b00&gt;<br>transport: &lt;_SelectorSocketTransport fd=58 read=polling write=&lt;idle, bufsize=0&gt;&gt;","like_count":0,"discussions":[{"author":{"id":1032331,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c0/8b/0371baee.jpg","nickname":"å¼ ä¸½å¨œ","note":"","ucode":"D70CFF68E72DAF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":915,"discussion_content":"é«˜ç‰ˆæœ¬ï¼šä»£ç ç¬¬7è¡Œæ›´æ”¹æˆâ€˜async with session.get(url, ssl=False) as respâ€™åè¿è¡ŒæˆåŠŸã€‚\næ¥¼ä¸‹çš„666å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562148601,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1032331,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c0/8b/0371baee.jpg","nickname":"å¼ ä¸½å¨œ","note":"","ucode":"D70CFF68E72DAF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":908,"discussion_content":"å…³äºPython3.7.3 ç‰ˆæœ¬è¿è¡ŒæŠ¥é”™çš„é—®é¢˜ï¼Œç›®å‰æ²¡æœ‰æ‰¾åˆ°çš„è§£å†³åŠæ³•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562146726,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1032331,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c0/8b/0371baee.jpg","nickname":"å¼ ä¸½å¨œ","note":"","ucode":"D70CFF68E72DAF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":907,"discussion_content":"æ‰¾åˆ°äº†ä¸€ç§é™çº§çš„æ–¹æ¡ˆï¼Œç”¨é«˜ç‰ˆæœ¬Pythonçš„ä¼šå‡ºç°é—®é¢˜ï¼Œæˆ‘ä½¿ç”¨äº†ä½ç‰ˆæœ¬çš„å†™æ³•ï¼Œå¹¶ä¸”å¯¹åº”çš„ç¨‹åºä»£ç ä¹Ÿåšäº†ç›¸åº”çš„è°ƒæ•´ï¼Œç°åœ¨å¯ä»¥æ­£å¸¸è¿è¡Œäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562146696,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109625,"user_name":"WANG","can_delete":false,"product_type":"c1","uid":1014839,"ip_address":"","ucode":"40795CDD7734F8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7c/37/a747c9f2.jpg","comment_is_top":false,"comment_ctime":1562067759,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1562067759","product_id":100026901,"comment_content":"å¯ä»¥æ¯”è€å¸ˆå°‘å‡ è¡Œä»£ç ğŸ˜<br><br>from multiprocessing import Pool<br>import time<br><br>def cpu_bound(number):<br>    print(sum(i * i for i in range(number)))<br><br>if __name__ == &#39;__main__&#39;:<br>    start_time = time.time()<br>    with Pool() as p:<br>        p.map(cpu_bound, [10000000 + x for x in range(20)])<br>print(&quot;Duration {} seconds&quot;.format(time.time() - start_time))","like_count":0},{"had_liked":false,"id":109572,"user_name":"ã€°","can_delete":false,"product_type":"c1","uid":1164565,"ip_address":"","ucode":"5ECF54B48BB29B","user_header":"https://static001.geekbang.org/account/avatar/00/11/c5/15/cf00ae4f.jpg","comment_is_top":false,"comment_ctime":1562059398,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562059398","product_id":100026901,"comment_content":"å¯ä»¥æ¯ä¸ªçº¿ç¨‹ä½¿ç”¨asyncioï¼Œç„¶åå¼€å¤šä¸ªè¿›ç¨‹å—ï¼Œå°±æ˜¯ä¸¤ç§æ–¹å¼ç»“åˆèµ·æ¥ã€‚","like_count":0},{"had_liked":false,"id":109057,"user_name":"WingÂ·ä¸‰é‡‘","can_delete":false,"product_type":"c1","uid":1341402,"ip_address":"","ucode":"6B9F5822C3717F","user_header":"https://static001.geekbang.org/account/avatar/00/14/77/da/54c663f3.jpg","comment_is_top":false,"comment_ctime":1561953638,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561953638","product_id":100026901,"comment_content":"æ€è€ƒé¢˜ï¼š<br>1ã€ç”¨  concurrent.futures.ProcessPoolExecutor æˆ– multiprocessing.Pool å‡ ä¹ç­‰æ•ˆï¼Œå¦å¤–æœ‰äº›é—®é¢˜éœ€è¦æ³¨æ„ï¼›<br>2ã€åœ¨ä½¿ç”¨ mapæ—¶ï¼Œprint åœ¨å­è¿›ç¨‹ä¸­ä¸ä¼šæ˜¾ç¤ºï¼Œéœ€è¦ç”¨ logging æˆ– æ”¹ print ä¸º return çš„æ–¹æ³•ä»£æ›¿ï¼›<br>3ã€åœ¨äº¤äº’å¼ç¼–è¯‘ç¯å¢ƒï¼ˆå¦‚ jupyterï¼‰ä¸­ï¼Œå¤šè¿›ç¨‹æ˜¯æ— æ³•é¡ºåˆ©è¿è¡Œçš„ï¼ˆprint ç»“æœçš„è¯ä¼šæŠ¥ BrokenProcessPool çš„é”™è¯¯ï¼Œä¸ print ç»“æœçš„è¯å®é™…ä¸Šæ²¡æœ‰è¿è¡Œï¼‰ï¼Œæ‰€ä»¥æœ¬äººæ”¹ä¸ºåœ¨ sublime 3 ä¸­è¿è¡Œã€‚<br><br>åŸç å¦‚ä¸‹ï¼š<br>import time, concurrent.futures<br>from multiprocessing import Pool<br>import time<br><br>def cpu_bound(number):<br>    return sum(i * i for i in range(number))<br>            <br>def calculate_sums(numbers):<br>    # multiprocessing ver 1<br>    with concurrent.futures.ProcessPoolExecutor() as executor:<br>        print(list(executor.map(cpu_bound, numbers)))<br>        # æ³¨æ„ï¼Œå¦‚æœè¿™é‡Œä¸æ˜¯ç”¨ map è€Œæ˜¯ç”¨ for + submitï¼Œä¸Šé¢ cpu_bound å°±è¿˜æ˜¯ç”¨ print è€Œä¸ç”¨æ”¹ä¸º return<br>    # ver 2<br>    with Pool() as p:<br>        print(p.map(cpu_bound, numbers))<br>        <br>if __name__ == &#39;__main__&#39;:<br>    main()","like_count":0},{"had_liked":false,"id":108800,"user_name":"Fergus","can_delete":false,"product_type":"c1","uid":1277066,"ip_address":"","ucode":"3A8AC741C49CEB","user_header":"https://static001.geekbang.org/account/avatar/00/13/7c/8a/bdeb76ac.jpg","comment_is_top":false,"comment_ctime":1561885444,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561885444","product_id":100026901,"comment_content":"# -*- encoding -*-<br>&#39;&#39;&#39;<br>py 3.6<br>sulime<br>-- å‘ç°ç”µè„‘å¤ªã€‚ã€‚ã€‚<br>&#39;&#39;&#39;<br><br><br>import time<br>import concurrent.futures<br>from multiprocessing import Pool<br><br>now = lambda: time.perf_counter()<br><br>def cpu_bound(number):<br>    # print(sum(i * i for i in range(number)))<br>    return sum(i*i for i in range(number))<br><br>def calculate_sums(numbers):<br>    # # 1.0  49s<br>    # for number in numbers:<br>    #     cpu_bound(number)<br><br>    # # 2.0  30s<br>    # with concurrent.futures.ProcessPoolExecutor(max_workers=3) as executor:<br>    #     executor.map(cpu_bound, numbers)<br><br>    # # 3.0  30s<br>    # with concurrent.futures.ProcessPoolExecutor(max_workers=3) as executor:<br>    #     for num in numbers:<br>    #         executor.submit(cpu_bound, num)<br><br>    # # 4.0  30s<br>    # p = Pool(4)<br>    # for num in numbers:<br>    #     p.apply_async(cpu_bound, args=(num,))<br>    # p.close()<br>    # p.join()<br><br>    # 5.0 30s<br>    # cpu_bound    return -**-<br>    with Pool(4) as p:<br>        print(p.map(cpu_bound, numbers))<br><br>        <br><br><br>def main():<br>    start_time = now()<br>    numbers = [10000000 + x for x in range(20)]<br>    calculate_sums(numbers)<br>    print(&#39;Calculation takes {:.2f} s&#39;.format(now() - start_time))<br>    <br>if __name__ == &#39;__main__&#39;:<br>    main()<br>","like_count":0},{"had_liked":false,"id":108787,"user_name":"å°ä¾ é¾™æ—‹é£","can_delete":false,"product_type":"c1","uid":1126441,"ip_address":"","ucode":"073F3924A99835","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/29/d6816ebf.jpg","comment_is_top":false,"comment_ctime":1561881852,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561881852","product_id":100026901,"comment_content":"import time<br>import concurrent.futures<br><br>def cpu_bound(number):<br>    print(sum(i * i for i in range(number)))<br><br>def calculate_sums(numbers):<br>    with concurrent.futures.ProcessPoolExecutor() as executor:#å¤šè¿›ç¨‹å¹¶è¡Œ<br>        try:<br>            executor.map(cpu_bound, numbers)<br>        except concurrent.futures.TimeoutError:<br>            print(&#39;TimeoutError&#39;)<br>        except:<br>            print(&#39;other Error&#39;)<br><br>def main():<br>    start_time = time.perf_counter()<br>    numbers = [10000000 + x for x in range(20)]<br>    calculate_sums(numbers)<br>    end_time = time.perf_counter()<br>    print(&#39;Calculation takes {} seconds&#39;.format(end_time - start_time))<br><br>if __name__ == &#39;__main__&#39;:<br>    main()","like_count":0},{"had_liked":false,"id":108467,"user_name":"szc","can_delete":false,"product_type":"c1","uid":1202730,"ip_address":"","ucode":"869C227F5D2513","user_header":"https://static001.geekbang.org/account/avatar/00/12/5a/2a/5ab880b0.jpg","comment_is_top":false,"comment_ctime":1561777978,"is_pvip":false,"replies":[{"id":"39291","content":"è¿™ä¸ªå¾—çœ‹å…·ä½“åœºæ™¯ã€‚æ¯”å¦‚å¤§å…¬å¸é‡Œç›¸åº”ä¸šåŠ¡çˆ¬è™«çš„è§„æ¨¡éå¸¸å¤§ï¼Œè¦æŠ“å–ç™¾ä¸‡çº§çš„è§†é¢‘æ–°é—»ä¿¡æ¯æµï¼Œè¿™ç§å°±å±äºIO heavyã€‚ä½†æ˜¯å¦‚æœä½ åªéœ€è¦æŠ“å–10ä¸ªç½‘ç«™çš„ä¿¡æ¯ï¼Œå¹¶ä¸”ç½‘ç»œè¿æ¥è‰¯å¥½ï¼Œé‚£ä¹ˆIOå°±å¾ˆå¿«","user_name":"ä½œè€…å›å¤","user_name_real":"Jingxiao","uid":"1259521","ctime":1561793907,"ip_address":"","comment_id":108467,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561777978","product_id":100026901,"comment_content":"èƒ½å¦ä¸¾ä¸€äº›ä¾‹å­ï¼Œå“ªäº›åœºæ™¯æ˜¯IOå¯†é›†å‹ä¸­çš„IOheavyï¼Œ é‚£äº›æ˜¯IOå¾ˆå¿«","like_count":0,"discussions":[{"author":{"id":1259521,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJOlibibPFEWOib8ib7RtfAtxND5FUqCxxoeTuLAbBI9ic23xuwdXT4IyiaWq3Fic9RgEAYI0lBTbEp2rcg/132","nickname":"Jingxiao","note":"","ucode":"EB966BB87132F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455992,"discussion_content":"è¿™ä¸ªå¾—çœ‹å…·ä½“åœºæ™¯ã€‚æ¯”å¦‚å¤§å…¬å¸é‡Œç›¸åº”ä¸šåŠ¡çˆ¬è™«çš„è§„æ¨¡éå¸¸å¤§ï¼Œè¦æŠ“å–ç™¾ä¸‡çº§çš„è§†é¢‘æ–°é—»ä¿¡æ¯æµï¼Œè¿™ç§å°±å±äºIO heavyã€‚ä½†æ˜¯å¦‚æœä½ åªéœ€è¦æŠ“å–10ä¸ªç½‘ç«™çš„ä¿¡æ¯ï¼Œå¹¶ä¸”ç½‘ç»œè¿æ¥è‰¯å¥½ï¼Œé‚£ä¹ˆIOå°±å¾ˆå¿«","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561793907,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108430,"user_name":"å“é›¨","can_delete":false,"product_type":"c1","uid":1581705,"ip_address":"","ucode":"C5FB3A3BC68F92","user_header":"https://static001.geekbang.org/account/avatar/00/18/22/89/73397ccb.jpg","comment_is_top":false,"comment_ctime":1561771544,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561771544","product_id":100026901,"comment_content":"from multiprocessing import Pool<br>import time<br><br><br>def square(number):<br>    print(sum(i * i for i in range(number)))<br><br><br>def calculate_sums(numbers):<br>    with Pool() as pool:<br>        pool.map(square, numbers)<br><br>def main():<br>    start_time = time.perf_counter()<br>    numbers = [10000000 + x for x in range(20)]<br>    calculate_sums(numbers)<br>    end_time = time.perf_counter()<br>    print(&#39;Calculation takes {} seconds&#39;.format(end_time - start_time))<br><br><br>if __name__ == &#39;__main__&#39;:<br>    main()<br><br>Calculation takes 9.752991132001625 seconds<br>ä¸ä½¿ç”¨å¤šè¿›ç¨‹æ¶ˆè€—16s<br>Calculation takes 16.316618639997614 seconds","like_count":0},{"had_liked":false,"id":108275,"user_name":"helloworld","can_delete":false,"product_type":"c1","uid":1105161,"ip_address":"","ucode":"1EECCA0F43E278","user_header":"https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg","comment_is_top":false,"comment_ctime":1561711174,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561711174","product_id":100026901,"comment_content":"import concurrent.futures<br>import multiprocessing<br>import time<br><br>def cpu_bound(number):<br>    re = sum(i * i for i in range(number))<br>    process_sharelist.append(re)<br><br>def calculate_sums(numbers):<br>    with concurrent.futures.ProcessPoolExecutor() as executor:<br>        executor.map(cpu_bound, numbers)<br><br>if __name__ == &#39;__main__&#39;:<br>    start_time = time.perf_counter()  <br>    numbers = [10000000 + x for x in range(20)]<br><br>    process_sharelist = multiprocessing.Manager().list()<br>    calculate_sums(numbers)<br><br>    for i in process_sharelist:<br>        print(i)<br><br>    end_time = time.perf_counter()<br>    print(&#39;Calculation takes {} seconds&#39;.format(end_time - start_time))<br><br>å‘æˆ‘ä¸Šé¢è¿™ç§ä½¿ç”¨è¿›ç¨‹é—´å…±äº«åˆ—è¡¨ï¼Œè®©æ¯ä¸ªè¿›ç¨‹å¾€åŒä¸€ä¸ªåˆ—è¡¨ä¸­å†™æ•°æ®ï¼Œæ•°æ®ä¼šä¸ä¼šé”™ä¹±ï¼Ÿ","like_count":0},{"had_liked":false,"id":108228,"user_name":"Redevil","can_delete":false,"product_type":"c1","uid":1527609,"ip_address":"","ucode":"21C90472DC6357","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PrKSgib1DcguTZYoOAqNw8tpLKylQU6dQPwI4NLJkd6344EWHaLF5yHe6PpAD6fsxSm0no7qiakiaEHUYw4nzTEyw/132","comment_is_top":false,"comment_ctime":1561701676,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561701676","product_id":100026901,"comment_content":"å­¦åˆ°äº†ï¼šæƒ³å¯åŠ¨å¤šè¿›ç¨‹pythonç¨‹åº<br>1. ä¸èƒ½ç”¨jupyter notebook<br>2. å¿…é¡»ä½¿ç”¨if __name__ == &#39;__main__&#39;: æ–¹å¼<br>","like_count":0},{"had_liked":false,"id":108196,"user_name":"å¹²å¸ƒçƒ","can_delete":false,"product_type":"c1","uid":1218173,"ip_address":"","ucode":"048ABC199D89B9","user_header":"https://static001.geekbang.org/account/avatar/00/12/96/7d/c7e8cd34.jpg","comment_is_top":false,"comment_ctime":1561693734,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561693734","product_id":100026901,"comment_content":"import time<br>import concurrent.futures<br><br><br>def cpu_bound(number):<br>    print(sum(i * i for i in range(number)))<br><br>def calculate_sums(numbers):<br>    with concurrent.futures.ProcessPoolExecutor() as executor:<br>        executor.map(cpu_bound, numbers)<br><br>def main():<br>    start_time = time.perf_counter()  <br>    numbers = [10000000 + x for x in range(20)]<br>    calculate_sums(numbers)<br>    end_time = time.perf_counter()<br>    print(&#39;Calculation takes {} seconds&#39;.format(end_time - start_time))<br>    <br>if __name__ == &#39;__main__&#39;:<br>    main()","like_count":0},{"had_liked":false,"id":108194,"user_name":"ç¨‹åºå‘˜äººç”Ÿ","can_delete":false,"product_type":"c1","uid":1113668,"ip_address":"","ucode":"C5C5073D89AAA2","user_header":"https://static001.geekbang.org/account/avatar/00/10/fe/44/3e3040ac.jpg","comment_is_top":false,"comment_ctime":1561693656,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561693656","product_id":100026901,"comment_content":"å¤šè¿›ç¨‹ä¿®æ”¹ç‰ˆæœ¬ï¼š<br>import time<br>import multiprocessing<br><br><br>def cpu_bound(number):<br>    print(sum(i * i for i in range(number)))<br><br><br>def calculate_sums(numbers):<br>    for number in numbers:<br>        #cpu_bound(number)<br>        p = multiprocessing.Process(target=cpu_bound, args=(number,))<br>        p.start()<br>    p.join()<br><br><br>def main():<br>    start_time = time.perf_counter()<br>    numbers = [10000000 + x for x in range(20)]<br>    calculate_sums(numbers)<br>    end_time = time.perf_counter()<br>    print(&#39;Calculation takes {} seconds&#39;.format(end_time - start_time))<br><br><br>if __name__ == &#39;__main__&#39;:<br>    main()<br><br>è¿è¡Œç»“æœï¼š<br>Calculation takes 9.415819544 seconds","like_count":0},{"had_liked":false,"id":108190,"user_name":"èˆ’æœ","can_delete":false,"product_type":"c1","uid":1378263,"ip_address":"","ucode":"9E81D1268D63B0","user_header":"https://static001.geekbang.org/account/avatar/00/15/07/d7/7702a7e4.jpg","comment_is_top":false,"comment_ctime":1561692752,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1561692752","product_id":100026901,"comment_content":"async å’Œ awaitæœ‰ä»€ä¹ˆä½œç”¨å•Š","like_count":0,"discussions":[{"author":{"id":1105161,"avatar":"https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg","nickname":"helloworld","note":"","ucode":"1EECCA0F43E278","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":566,"discussion_content":"asyncæ ‡è¯†è¯¥å‡½æ•°æˆ–è¯­å¥æ˜¯ä¸€ä¸ªåç¨‹å¯¹è±¡ï¼ˆå¼‚æ­¥å¯¹è±¡ï¼‰ï¼Œawait + åç¨‹å¯¹è±¡ï¼Œè¡¨æ˜è¯¥æ¡è¯­å¥æ˜¯I/Oè€—æ—¶è¯­å¥ï¼Œæ‰€ä»¥ä»»åŠ¡åœ¨æ­¤å¤„ä¸­æ–­ï¼ŒæŠŠæ§åˆ¶æƒäº¤ç»™çº¿ç¨‹å»æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œå®ç°éé˜»å¡ã€‚å½“I/Oæ“ä½œå®Œæˆï¼Œçº¿ç¨‹å†å›æ¥ç»§ç»­æ‰§è¡Œè¯¥ä»»åŠ¡æ²¡å®Œæˆçš„ä»£ç ","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1561709062,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108099,"user_name":"farFlight","can_delete":false,"product_type":"c1","uid":1245211,"ip_address":"","ucode":"B0872D3ECBEC38","user_header":"https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83epbRibsic15KXfGEN3SSjnLhXGyhK2Uyrj5ibBJsKAjicNqtafDaQOLH4xpSJRZD1vmibFPJER1ySmwP9A/132","comment_is_top":false,"comment_ctime":1561682262,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"1561682262","product_id":100026901,"comment_content":"è¯·é—®åœ¨è¿è¡Œä¸‹è½½ç½‘ç«™å†…å®¹æ—¶å‡ºç°ä»¥ä¸‹é—®é¢˜æ€ä¹ˆè§£å†³å•Šï¼Ÿ<br>SSL error in data received<br>protocol: &lt;asyncio.sslproto.SSLProtocol object at 0x7f3a241e4b00&gt;<br>transport: &lt;_SelectorSocketTransport fd=58 read=polling write=&lt;idle, bufsize=0&gt;&gt;","like_count":0,"discussions":[{"author":{"id":1032331,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c0/8b/0371baee.jpg","nickname":"å¼ ä¸½å¨œ","note":"","ucode":"D70CFF68E72DAF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":901,"discussion_content":"æˆ‘ä¹Ÿé‡åˆ°æ­¤ç±»çš„é”™è¯¯ï¼Œä½†æ˜¯æ˜¯é—´æ­‡æ€§çš„ã€‚ç”¨ç™¾åº¦ç™¾ç§‘ä»¥åŠç»´åŸºç™¾ç§‘æŠ¥é”™è¿˜ä¸ä¸€æ ·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562144231,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1526815,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJQDJajN26Fx1iaw5JroPHc7b4QqNQcIlZGZaVKz1qyiaho68J1ra5s6t1UCkaCUyogbcdcHscFOqOQ/132","nickname":"suifengyehun","note":"","ucode":"189944EFFFB46B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":695,"discussion_content":"æˆ‘ä¹Ÿå‡ºç°è¿™ä¸ªé”™è¯¯äº†ï¼Œç½‘å€éƒ½ç”¨ç™¾åº¦ç™¾ç§‘çš„æ›¿æ¢æ‰ç»´åŸºç™¾ç§‘çš„äº†ã€‚ç½‘ä¸ŠæŸ¥äº†èµ„æ–™ï¼Œè¯´è¦ç¦ç”¨ssléªŒè¯ï¼Œä½†æ˜¯è¯•äº†è¿˜æ˜¯ä¸è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561968263,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1032331,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c0/8b/0371baee.jpg","nickname":"å¼ ä¸½å¨œ","note":"","ucode":"D70CFF68E72DAF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1526815,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJQDJajN26Fx1iaw5JroPHc7b4QqNQcIlZGZaVKz1qyiaho68J1ra5s6t1UCkaCUyogbcdcHscFOqOQ/132","nickname":"suifengyehun","note":"","ucode":"189944EFFFB46B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":903,"discussion_content":"è¯·é—®è¿™ä¸ªé—®é¢˜æœ‰è§£å†³æ–¹æ¡ˆä¸ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562144828,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":695,"ip_address":""},"score":903,"extra":""}]},{"author":{"id":1037253,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/d3/c5/71ce5bbf.jpg","nickname":"Seunzi","note":"","ucode":"601A1C8FBAAD4F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555,"discussion_content":"åº”è¯¥æ˜¯ç»´åŸºç™¾ç§‘è¢«å¢™äº†å¯¼è‡´çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561699113,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108059,"user_name":"LJK","can_delete":false,"product_type":"c1","uid":1199213,"ip_address":"","ucode":"12B2441099FF1D","user_header":"https://static001.geekbang.org/account/avatar/00/12/4c/6d/c20f2d5a.jpg","comment_is_top":false,"comment_ctime":1561660140,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561660140","product_id":100026901,"comment_content":"è€å¸ˆå¥½ï¼Œæƒ³è¯·é—®ä¸€ä¸‹Asyncioå’Œgo functionçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿæ„Ÿè§‰å¥½åƒéƒ½æ˜¯ç”¨æˆ·çº§çº¿ç¨‹â€¦è°¢è°¢è€å¸ˆ","like_count":0}]}