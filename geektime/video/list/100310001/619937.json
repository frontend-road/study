{"id":619937,"title":"74｜自定义异常捕获：如何定义业务异常？","content":"<p><strong>课后习题</strong><br>\n请你编写自定义异常类，如果读取的文件小于 10 个字符，抛出文件过小的自定义异常，如果读取的文件大于等于 10 个字符，则正常输出该文件内容。</p><p><strong>课程代码、课件及其他相关资料地址</strong><br>\n<a href=\"https://gitee.com/wilsonyin/zero-basics-python\">https://gitee.com/wilsonyin/zero-basics-python</a></p>","comments":[{"had_liked":false,"id":379381,"user_name":"Geek_Mike","can_delete":false,"product_type":"c3","uid":3196376,"ip_address":"云南","ucode":"CFA942192C3B74","user_header":"https://static001.geekbang.org/account/avatar/00/30/c5/d8/c5509b9c.jpg","comment_is_top":false,"comment_ctime":1691848943,"is_pvip":false,"replies":[{"id":138348,"content":"代码有个小问题， 使用 with 语句时，__exit__ 会捕获所有类型的异常，而不仅仅是 CustomException。这可能不是你想要的行为。我稍微改写一下：\n\nclass ExceptionHandler:\n    def __init__(self, exc_type):\n        self.exc_type = exc_type\n\n    def __enter__(self):\n        return self\n    \n    def __exit__(self, exc_type, exc_value, traceback):\n        if exc_type == self.exc_type:\n            print(&#39;捕获到了自定义异常:&#39;, exc_value)\n            return True  # 这意味着异常已被处理，不会再向上层传播\n\nwith open(&#39;.&#47;b.txt&#39;, &#39;r&#39;) as f:\n    content = f.read()\n\nwith ExceptionHandler(CustomException):\n    if len(content) &lt; 10:\n        raise CustomException(&#39;文件不能小于10个字符&#39;)\n    print(content)\n","user_name":"作者回复","user_name_real":"编辑","uid":1056235,"ctime":1692536963,"ip_address":"甘肃","comment_id":379381,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"# 不太确定是不是听懂了最后讲的，通过with语句调用自定义异常的内容。不知道是不是应该像下面这样编写代码：\n\nclass CustomException(Exception):\n    def __init__(self, message):\n        self.message = message\n        super().__init__(self.message)\n\n    def __enter__(self):\n        return self\n    \n    def __exit__(self, exc_type, exc_value, traceback):\n        if self.message:\n            print(&#39;文件不能小于10个字符&#39;)\n\n\nwith open(&#39;.&#47;b.txt&#39;,&#39;r&#39;) as f:\n    content = f.read()\n\ntry:\n    if len(content) &lt; 10:\n        with CustomException(True):\n            pass\n\nexcept CustomException as ce:\n    print(ce)\n\nelse:\n    with open(&#39;.&#47;b.txt&#39;, &#39;r&#39;) as f:\n        print(f.read())","like_count":1,"discussions":[{"author":{"id":1056235,"avatar":"https://static001.geekbang.org/account/avatar/00/10/1d/eb/b2123759.jpg","nickname":"尹会生","note":"","ucode":"D1093DBD093617","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":626104,"discussion_content":"代码有个小问题， 使用 with 语句时，__exit__ 会捕获所有类型的异常，而不仅仅是 CustomException。这可能不是你想要的行为。我稍微改写一下：\n\nclass ExceptionHandler:\n    def __init__(self, exc_type):\n        self.exc_type = exc_type\n\n    def __enter__(self):\n        return self\n    \n    def __exit__(self, exc_type, exc_value, traceback):\n        if exc_type == self.exc_type:\n            print(&#39;捕获到了自定义异常:&#39;, exc_value)\n            return True  # 这意味着异常已被处理，不会再向上层传播\n\nwith open(&#39;./b.txt&#39;, &#39;r&#39;) as f:\n    content = f.read()\n\nwith ExceptionHandler(CustomException):\n    if len(content) &lt; 10:\n        raise CustomException(&#39;文件不能小于10个字符&#39;)\n    print(content)\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1692536963,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"甘肃","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":396313,"user_name":"尹长拟","can_delete":false,"product_type":"c3","uid":3074007,"ip_address":"北京","ucode":"1EBD42B5BBD934","user_header":"","comment_is_top":false,"comment_ctime":1733936716,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"class byteError(Exception):\n    def __init__(self, message=&#39;文件过小，不足十个字符&#39;):\n        self.message = message\n        super().__init__(self.message)\n\ntry:\n    with open(&quot;.&#47;userData.txt&quot;,&#39;r&#39;) as f:\n        content = f.read()\n\n    if len(content) &lt; 10:\n        raise byteError()\n    else:\n        print(&quot;文件内容如下：&quot;)\n        print(content)\n    \nexcept byteError as e:\n    print(f&quot; 自定义异常：{e}&quot;)\n\nexcept Exception as ee:\n    print(f&quot;出现的其他异常为{type(ee)},异常信息{ee}&quot;)","like_count":0},{"had_liked":false,"id":389298,"user_name":"黑曼巴","can_delete":false,"product_type":"c3","uid":1393080,"ip_address":"北京","ucode":"3287B001C303F2","user_header":"https://static001.geekbang.org/account/avatar/00/15/41/b8/456c5861.jpg","comment_is_top":false,"comment_ctime":1712060180,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"能成功调用子类父类不一定成功调用吧 、子类肯定有自己的类方法类属性啊 老师是不是说反了","like_count":0},{"had_liked":false,"id":386989,"user_name":"杨帆","can_delete":false,"product_type":"c3","uid":3805884,"ip_address":"上海","ucode":"F02879DB1370AD","user_header":"https://static001.geekbang.org/account/avatar/00/3a/12/bc/2a7ec1e9.jpg","comment_is_top":false,"comment_ctime":1706088742,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"class Filesize_Error(Exception):\n    @property\n    def filesize(self):\n        return f&quot;文件过小，存在异常&quot;\n\nwith open(&#39;demo2.txt&#39;,mode=&#39;r&#39;,encoding=&#39;UTF-8&#39;) as f:\n    try:\n        data=f.read()\n        if len(data)&lt;10:\n            raise Filesize_Error\n    except Filesize_Error as fe:\n         print(fe.filesize)\n    else:\n        print(data)","like_count":0},{"had_liked":false,"id":385129,"user_name":"蓝定月","can_delete":false,"product_type":"c3","uid":1497795,"ip_address":"上海","ucode":"3765E44A958022","user_header":"https://static001.geekbang.org/account/avatar/00/16/da/c3/4133a67a.jpg","comment_is_top":false,"comment_ctime":1702129989,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"class FileLessException(Exception):\n    def __init__(self, byte):\n        self.msg = &quot;File is less than 10 bytes&quot;\n        self.bytes = byte\n\n    @property\n    def input(self):\n        return f&quot;读取到文件字节数是{self.bytes},&quot;+self.msg\n\n\nif __name__ == &#39;__main__&#39;:\n    try:\n        with open(&#39;test.txt&#39;, &#39;r&#39;) as f:\n            contents = f.read()\n            if len(contents) &lt; 10:\n                raise FileLessException(len(contents))\n            else:\n                print(f&quot;读取到内容：{contents}&quot;)\n    except FileLessException as e:\n        print(&#39;error:&#39;, e.input)\n    finally:\n        print(&#39;程序运行结束&#39;)","like_count":0},{"had_liked":false,"id":385086,"user_name":"Geek_631607","can_delete":false,"product_type":"c3","uid":3789991,"ip_address":"广东","ucode":"EAF874838F0BE4","user_header":"","comment_is_top":false,"comment_ctime":1702025625,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"class MyException(Exception):\n    def __init__(self, message) -&gt; None:\n        self.message = message\n\n    @property\n    def msg(self):\n        return self.message\n    \n\n\n\ntry:\n    with open(&#39;.&#47;a.txt&#39;) as f:\n        if len(f.read()) &lt; 10:\n            raise MyException(&quot;文件过小&quot;)\n        print(f.read())\nexcept MyException as e:\n    print(e.msg)","like_count":0},{"had_liked":false,"id":382698,"user_name":"MarkG","can_delete":false,"product_type":"c3","uid":3675806,"ip_address":"山东","ucode":"454082595FE769","user_header":"https://static001.geekbang.org/account/avatar/00/38/16/9e/48621655.jpg","comment_is_top":false,"comment_ctime":1697815773,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"class SizeError(Exception):\n    def __init__(self, filename):\n        self.filename = filename\n\n    @property\n    def more_than_10(self):\n        return f&quot;{self.filename}不能小于10个字符&quot;\n\n\nfilename = &#39;a.txt&#39;\n\ntry:\n    with open(filename) as f:\n        if len(f.read()) &lt; 10:\n            raise SizeError(filename)\n\nexcept SizeError as se:\n    print(se.more_than_10)","like_count":0},{"had_liked":false,"id":379326,"user_name":"Geek_Mike","can_delete":false,"product_type":"c3","uid":3196376,"ip_address":"云南","ucode":"CFA942192C3B74","user_header":"https://static001.geekbang.org/account/avatar/00/30/c5/d8/c5509b9c.jpg","comment_is_top":false,"comment_ctime":1691729715,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"&#39;&#39;&#39;编写自定义异常类，如果读取的文件小于 10 个字符，抛出文件过小的自定义异常，如果读取的文件大于等于 10 个字符，则正常输出该文件内容。&#39;&#39;&#39;\n\nfrom os import path\n\nfile_name = input(&#39;please input the file name and suffix:&#39;)\nfile_path = path.abspath(file_name)\n\nclass MyException(Exception):\n    def __init__(self, bv):\n        self.bv = bv\n    \n    def check(self):\n        if self.bv:\n            print(&#39;文件小于10个字符&#39;)\n\ntry:\n   with open(file_path, &#39;r&#39;) as f:\n            content = f.read()\n            if len(content) &lt; 10:\n                raise MyException(True)\n\nexcept MyException as me:\n    me.check()\n\nelse:\n    with open(file_path, &#39;r&#39;) as f:\n        print(f.read())","like_count":0},{"had_liked":false,"id":378312,"user_name":"Greenery","can_delete":false,"product_type":"c3","uid":3566765,"ip_address":"中国香港","ucode":"16111129C9EBA2","user_header":"https://static001.geekbang.org/account/avatar/00/36/6c/ad/0a694b50.jpg","comment_is_top":false,"comment_ctime":1690080458,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"# %%\nclass SmallError(Exception):\n    def __init__(self, size):\n        self.size = size\n\n    @property\n    def msg(self):\n        return f&quot;file size=={self.size}. too small!&quot;\n\n\n# %%\ntry:\n    with open(&quot;f1.txt&quot;) as f:\n        cnt = f.read()\n        if len(cnt) &lt; 10:\n            raise SmallError(len(cnt))\nexcept SmallError as se:\n    print(se.msg)\nelse:\n    print(cnt)\nfinally:\n    print(&quot;done.&quot;)","like_count":0},{"had_liked":false,"id":369837,"user_name":"Geek_4737d8","can_delete":false,"product_type":"c3","uid":3528224,"ip_address":"美国","ucode":"BB7BBB7AEB6F0A","user_header":"","comment_is_top":false,"comment_ctime":1678024804,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"class NumError(Exception):\n    def __init__(self, filename, num):\n        self.filename = filename\n        self.num = num\n\n    @property\n    def msn(self):\n        return f&quot;文件{self.filename}中的字符数为:{self.num},小于 10 个字符限制&quot;\n\n\nfile = &quot;userData.txt&quot;\nwith open(file, &#39;r&#39;) as f:\n    file_read = f.read()\n    # 获取文件中字符数量\n    file_len = len(file_read)\n    try:\n        if file_len &gt;= 10:\n            print(file_read)\n        else:\n            raise NumError(file, file_len)\n    except NumError as e:\n        print(e.msn)","like_count":0},{"had_liked":false,"id":369299,"user_name":"yanyu-xin","can_delete":false,"product_type":"c3","uid":1899757,"ip_address":"广东","ucode":"3AA389F9E4C236","user_header":"","comment_is_top":false,"comment_ctime":1677372520,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100310001,"comment_content":"class NameError(Exception):\n    &#39;&#39;&#39;自定义异常类，如果读取的文件小于 10 个字符，抛出文件过小的自定义异常&#39;&#39;&#39;\n    def __init__(self, message, filename):\n        self.message = message\n        self.name = filename\n    \n    @property\n    def msg(self):\n        return f&quot;文件长度{self.message} 小于10个字符. {self.name}文件不允许使用 &quot;\n\n\nfname = &#39;.&#47;a.txt&#39;\ntry:\n    with open (fname, &#39;r&#39;) as f: # 读取文件大小\n        strF=f.read()\n        flen = len(strF)  \n        if flen &lt;= 10 :\n            raise NameError(flen,fname)\nexcept NameError as ne: # 文件小于 10 个字符，抛出文件过小的自定义异常\n    print(ne.msg)\nelse: # 读取的文件大于等于 10 个字符，正常输出该文件内容。\n    print(strF)","like_count":0},{"had_liked":false,"id":367468,"user_name":"聪少 Jeff","can_delete":false,"product_type":"c3","uid":1159983,"ip_address":"广东","ucode":"C791ACA9B47679","user_header":"https://static001.geekbang.org/account/avatar/00/11/b3/2f/d08a1363.jpg","comment_is_top":false,"comment_ctime":1675250528,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100310001,"comment_content":"class FileLengthError(Exception):\n    def __init__(self, message):\n        self.message = message\n    \n    @property\n    def msg(self):\n        return f&quot;当前文件是{self.message}字符数，小于10个字符&quot;\n\nfile = &quot;.&#47;a.txt&quot;  # 内容是 Hello\nwith open(file) as f:\n    fconten = f.read()\n\ntry:\n    flen = len(fconten)\n    if flen &lt; 10:\n        raise FileLengthError(flen)\n    else:\n        print(fconten)\nexcept FileLengthError as fe:\n    print(fe.msg)\n\n#结果是：当前文件是6字符数，小于10个字符","like_count":0},{"had_liked":false,"id":366720,"user_name":"Cy23","can_delete":false,"product_type":"c3","uid":1591293,"ip_address":"辽宁","ucode":"8DC561C5151758","user_header":"https://static001.geekbang.org/account/avatar/00/18/47/fd/895f0c27.jpg","comment_is_top":false,"comment_ctime":1674112802,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100310001,"comment_content":"class MyException(Exception):\n  def __init__(self, message):\n    self.message = message\n  @property\n  def msg(self):\n    return f&quot;文件过小产生异常，文件长度 {self.message}&quot;\n\nwith open(&#39;.&#47;1.txt&#39;, &#39;r&#39;) as f:\n  cont = f.read()\n  try:\n    contlen = len(cont)\n    if contlen &lt; 10:\n      raise MyException(contlen)\n    else:\n      print(cont)\n  except MyException as e:\n    print(e.msg)","like_count":0},{"had_liked":false,"id":366589,"user_name":"月姣","can_delete":false,"product_type":"c3","uid":3228357,"ip_address":"江苏","ucode":"3EB6240054A24A","user_header":"https://static001.geekbang.org/account/avatar/00/31/42/c5/45c93ea8.jpg","comment_is_top":false,"comment_ctime":1673946448,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100310001,"comment_content":"class MyException(Exception):\n    def __init__(self,message):\n        self.message = message\n        \n    @property\n    def msg(self):\n        return f&quot;文件过小产生异常，文件长度 {self.message}&quot;\n    \ntestfile = &#39;C:&#47;test&#47;loga.txt&#39;\nwith open(testfile,&#39;r&#39;) as f:\n    cont = f.read()\n    try:\n        contlen = len(cont)\n        if contlen &lt; 10:\n            raise MyException(contlen)\n        else:\n            print(&quot;文件内容：&quot;)\n            print(cont)\n    except MyException as e:\n        print(e.msg) \n    #else:\n    #    print(&quot;文件内容：&quot;)\n    #    print(cont)","like_count":0},{"had_liked":false,"id":366118,"user_name":"PatrickL","can_delete":false,"product_type":"c3","uid":1341431,"ip_address":"上海","ucode":"EF0EC18639B9B2","user_header":"https://static001.geekbang.org/account/avatar/00/14/77/f7/11548247.jpg","comment_is_top":false,"comment_ctime":1673413072,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100310001,"comment_content":"class SmallFileError(Exception):\n    def __init__(self, myFile, charLimit):\n        self.myFile = myFile\n        self.charLimit = charLimit\n        \n    @property\n    def msg(self):\n        return f&#39;文件&quot;{self.myFile}&quot;中的字符数小于{self.charLimit}。&#39;\n    \nmyFile = &#39;零基础学Python_第74讲.txt&#39;\ncharLimit = 10\nwith open(myFile) as f:\n    try:\n        if len(f.read()) &lt; charLimit:\n            raise SmallFileError(myFile, charLimit)\n    except SmallFileError as sfe:\n        print(sfe.msg)","like_count":0},{"had_liked":false,"id":365719,"user_name":"Matthew","can_delete":false,"product_type":"c3","uid":2843865,"ip_address":"江苏","ucode":"96093089773740","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKSVuNarJuDhBSvHY0giaq6yriceEBKiaKuc04wCYWOuso50noqDexaPJJibJN7PHwvcQppnzsDia1icZkw/132","comment_is_top":false,"comment_ctime":1672922237,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100310001,"comment_content":"# 自定义异常类\nclass SmallFileError(Exception):\n    def __init__(self, file_path, char_limit):\n            self.file_path = file_path\n            self.char_limit = char_limit\n     \n    @property\n    def msg(self):\n        return f&quot;{self.__class__.__name__}：文件 {self.file_path} 中的字符数小于 {self.char_limit}&quot;\n    \n\n# 测试程序\nfile_path = &quot;.&#47;data.txt&quot;  # 文件相对路径，文件中的字符数是9\nchar_limit = 10  # 判断字符界限\n\nwith open(file_path) as file:\n    try:\n        if file.read().count(&quot;&quot;) - 1 &lt; char_limit:\n            raise SmallFileError(file_path, char_limit)\n    except SmallFileError as e:\n        print(e.msg)","like_count":0}]}