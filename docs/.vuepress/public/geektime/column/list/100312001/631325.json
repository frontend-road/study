{"id":631325,"title":"31ï½œæ—¥å¿—ï¼šå¦‚ä½•æ­å»ºè½»é‡äº‘åŸç”Ÿä¸šåŠ¡æ—¥å¿—ç³»ç»Ÿï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç‹ç‚œã€‚</p><p>ä¸Šä¸€èŠ‚è¯¾ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•è¿…é€Ÿåˆ¤æ–­ä¸šåŠ¡å¯ç”¨æ€§ä»¥åŠå½“æ•…éšœå‡ºç°æ—¶åº”è¯¥å¦‚ä½•æ’æŸ¥é—®é¢˜ã€‚å…¶ä¸­ï¼Œåœ¨å¯è§‚æµ‹æ€§çš„æ—¥å¿—æ–¹é¢ï¼Œæˆ‘æåˆ°äº†ä½¿ç”¨ kubectl æ¥æŸ¥çœ‹ Pod æ—¥å¿—çš„æ–¹æ³•ã€‚ä¸è¿‡ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬é¢ä¸´çš„æƒ…å†µä¼šæ›´åŠ å¤æ‚ã€‚</p><p>æ¯”å¦‚ï¼Œå¯¹äºåŒä¸€ä¸ªå·¥ä½œè´Ÿè½½ï¼Œå®ƒå¯èƒ½æœ‰å‡ åä¸Šç™¾ä¸ª Pod å®ä¾‹ï¼Œå½“æˆ‘ä»¬éœ€è¦å®šä½å…·ä½“æŸä¸€ä¸ªè¯·æ±‚çš„æ—¥å¿—æ—¶ï¼Œå®ƒå¯èƒ½å‡ºç°åœ¨ä»»ä½•ä¸€ä¸ª Pod é‡Œã€‚å¾ˆæ˜¾ç„¶ï¼ŒæŸ¥çœ‹æ¯ä¸€ä¸ª Pod çš„æ—¥å¿—æ˜¯ä¸åˆ‡å®é™…çš„ã€‚å…¶æ¬¡ï¼Œå³ä¾¿æˆ‘ä»¬èƒ½æ‰¾åˆ°å¯¹åº”çš„ Podï¼Œåœ¨æŸ¥è¯¢æ—¥å¿—æ—¶ä¹Ÿå¾ˆéš¾è¿›è¡Œæ¡ä»¶æœç´¢ã€‚æœ€åï¼ŒKubernetes å¹¶ä¸èƒ½æŒä¹…åŒ–å­˜å‚¨ Pod æ—¥å¿—ï¼Œè¿™æ„å‘³ç€ä¸€æ®µæ—¶é—´åæˆ‘ä»¬å°†æ— æ³•æŸ¥è¯¢åˆ°ä»¥å‰çš„æ—¥å¿—ä¿¡æ¯ã€‚</p><p>æ­¤å¤–ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬è¿˜å¸Œæœ›é€šè¿‡æ—¥å¿—è¿›ä¸€æ­¥äº†è§£ç³»ç»Ÿçš„æ€§èƒ½è¡¨ç°ã€‚ä¾‹å¦‚ï¼šå‡ºç°é¢‘ç‡æœ€é«˜çš„é”™è¯¯æ˜¯ä»€ä¹ˆï¼Ÿé”™è¯¯æ—¥å¿—çš„å¢é•¿æƒ…å†µæ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ</p><p>æ—¥å¿—ç³»ç»Ÿä½œä¸ºåº”ç”¨å¯è§‚æµ‹æ€§çš„ä¸‰å¤§æ”¯æŸ±ä¹‹ä¸€ï¼Œèƒ½å¤Ÿä¸ºæˆ‘ä»¬æä¾›è½¯ä»¶å…¨ç”Ÿå‘½å‘¨æœŸçš„äº‹ä»¶å’Œé”™è¯¯è®°å½•ã€‚å› æ­¤ï¼Œå»ºç«‹ä¸­å¿ƒåŒ–çš„æ—¥å¿—å­˜å‚¨å’ŒæŸ¥è¯¢ç³»ç»Ÿèƒ½å¤Ÿå¾ˆå¥½åœ°å¸®åŠ©æˆ‘ä»¬è§£å†³è¿™äº›é—®é¢˜ã€‚</p><p>æ‰€ä»¥ï¼Œè¿™èŠ‚è¯¾ï¼Œæˆ‘å°†å¸¦ä½ å­¦ä¹ å¦‚ä½•æ„å»ºå¯è§‚æµ‹æ€§çš„æ—¥å¿—ä½“ç³»ï¼Œå¹¶é€šè¿‡ Grafana Loki æ¥æ­å»ºè½»é‡çš„æ—¥å¿—ç³»ç»Ÿã€‚åœ¨ä½¿ç”¨æ–¹é¢ï¼Œæˆ‘è¿˜ä¼šç®€å•ä»‹ç» Loki æŸ¥è¯¢æ—¥å¿—çš„ LogQL è¯­æ³•ï¼Œå¸¦ä½ ä»é›¶ä¸Šæ‰‹ Lokiã€‚</p><!-- [[[read_end]]] --><h2>å®‰è£… Loki</h2><p>å®Œæ•´çš„ Loki æ—¥å¿—ç³»ç»ŸåŒ…å«ä¸‹é¢ä¸‰ä¸ªç»„ä»¶ã€‚</p><ol>\n<li>Lokiï¼šæ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£æ—¥å¿—å­˜å‚¨å’Œå¤„ç†æŸ¥è¯¢ã€‚</li>\n<li>Promtailï¼šæ—¥å¿—æ”¶é›†å·¥å…·ï¼Œè´Ÿè´£æ”¶é›† Pod çš„æ—¥å¿—å¹¶å‘é€ç»™ Lokiã€‚</li>\n<li>Grafanaï¼šUI Dashboardï¼Œç”¨äºæŸ¥è¯¢æ—¥å¿—ã€‚</li>\n</ol><p>ä¸ºäº†ä¸€æ¬¡æ€§å®‰è£…æ‰€æœ‰çš„ç»„ä»¶ï¼ŒGrafana å°è£…äº† Loki-Stack Helm Chartï¼Œå®ƒåŒ…å«è¿™ä¸‰ä¸ªç»„ä»¶ï¼Œå¹¶ä¸”å·²ç»åšäº†åˆå§‹åŒ–çš„é…ç½®ï¼Œæˆ‘æ¨èä½ ç”¨ Helm çš„æ–¹å¼æ¥å®‰è£…ã€‚</p><p>é¦–å…ˆï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥æ·»åŠ  Helm Repoã€‚</p><pre><code class=\"language-yaml\">$ helm repo add grafana https://grafana.github.io/helm-charts\n</code></pre><p>ç„¶åï¼Œä½¿ç”¨ Helm æ¥å®‰è£… Lokiã€‚</p><pre><code class=\"language-yaml\">$ helm upgrade --install loki --namespace=loki-stack grafana/loki-stack --create-namespace --set grafana.enabled=true --set grafana.image.tag=\"9.3.2\"\n</code></pre><p>åœ¨ä¸Šé¢çš„å®‰è£…å‘½ä»¤ä¸­ï¼Œæˆ‘ä»¬æŒ‡å®šå®‰è£…çš„å‘½åç©ºé—´ä¸º loki-stackï¼Œå¹¶ä¸”ä½¿ç”¨äº† --set å‚æ•°å¼€å¯äº† Grafana ç»„ä»¶ï¼Œé•œåƒç‰ˆæœ¬è®¾ç½®ä¸ºäº† 9.3.2ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œç­‰å¾… Loki æ‰€æœ‰ç»„ä»¶å¤„äº Ready çŠ¶æ€ã€‚</p><pre><code class=\"language-yaml\">$ kubectl wait --for=condition=Ready pods --all -n loki-stack --timeout=300s\npod/loki-0 condition met\npod/loki-grafana-6f54cd8746-z5pmh condition met\npod/loki-promtail-qzcwj condition met\n</code></pre><p>åˆ°è¿™é‡Œï¼ŒLoki&nbsp;å°±å®‰è£…å¥½äº†ã€‚æˆ‘ä»¬æ¥ç»§ç»­çœ‹ä¸€ä¸‹è¿™ä¸‰ä¸ªç»„ä»¶å…·ä½“çš„éƒ¨ç½²æ–¹å¼ï¼Œä½ å¯ä»¥é€šè¿‡ kubectl get all æ¥æŸ¥çœ‹ loki-stack å‘½åç©ºé—´ä¸‹çš„å·¥ä½œè´Ÿè½½ã€‚</p><pre><code class=\"language-yaml\">$ kubectl get all -n loki-stack\n......\nNAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DESIRED&nbsp; &nbsp;CURRENT&nbsp; &nbsp;READY&nbsp; &nbsp;UP-TO-DATE&nbsp; &nbsp;AVAILABLE&nbsp; &nbsp;NODE SELECTOR&nbsp; &nbsp;AGE\ndaemonset.apps/loki-promtail&nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;none&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 22h\n\nNAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;READY&nbsp; &nbsp;UP-TO-DATE&nbsp; &nbsp;AVAILABLE&nbsp; &nbsp;AGE\ndeployment.apps/loki-grafana&nbsp; &nbsp;1/1&nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;22h\n\nNAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DESIRED&nbsp; &nbsp;CURRENT&nbsp; &nbsp;READY&nbsp; &nbsp;AGE\nreplicaset.apps/loki-grafana-6f54cd8746&nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;22h\nreplicaset.apps/loki-grafana-7cbbfb8f9b&nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp;22h\n\nNAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; READY&nbsp; &nbsp;AGE\nstatefulset.apps/loki&nbsp; &nbsp;1/1&nbsp; &nbsp; &nbsp;22h\n</code></pre><p>ä»è¿”å›ç»“æœå¯ä»¥çœ‹å‡ºï¼Œæ—¥å¿—é‡‡é›†ä»£ç† Promtail ç»„ä»¶æ˜¯ä»¥ Daemonset çš„æ–¹å¼æ¥éƒ¨ç½²çš„ï¼ŒUI ç•Œé¢ Grafana æ˜¯ä»¥ Deployment çš„æ–¹å¼éƒ¨ç½²çš„ï¼Œæ ¸å¿ƒçš„ Loki ç»„ä»¶å› ä¸ºéœ€è¦æŒä¹…åŒ–å­˜å‚¨ï¼Œæ‰€ä»¥æ˜¯é€šè¿‡æœ‰çŠ¶æ€çš„ Statefulset å·¥ä½œè´Ÿè½½æ¥éƒ¨ç½²çš„ã€‚è¿™ä¸‰ä¸ªç»„ä»¶çš„å·¥ä½œåŸç†æˆ‘ä¼šåœ¨åé¢çš„åŸç†è§£æéƒ¨åˆ†è¯¦ç»†ä»‹ç»ã€‚</p><h3>è®¿é—® Grafana</h3><p>Grafana æ˜¯æˆ‘ä»¬æ—¥å¸¸æŸ¥è¯¢æ—¥å¿—çš„å…¥å£ï¼Œåœ¨è®¿é—®å‰æˆ‘ä»¬éœ€è¦å…ˆä» Secret å¯¹è±¡ä¸­è·å–ç™»å½•å¯†ç ã€‚</p><pre><code class=\"language-yaml\">$ kubectl get secret --namespace loki-stack loki-grafana -o jsonpath=\"{.data.admin-password}\" | base64 --decode ; echo\nR1JTMgYLrmFBqlKCs9PWH6rk0LmhhHlobaZLdHU7\n</code></pre><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæˆ‘æ¨èä½ é…ç½® Ingress ç­–ç•¥ï¼Œå¹¶é€šè¿‡ Ingress-Nginx ç½‘å…³æ¥è®¿é—® Grafanaã€‚å®éªŒé˜¶æ®µåˆ™å¯ä»¥é€šè¿‡ç«¯å£è½¬å‘çš„æ–¹å¼è¿›è¡Œè®¿é—®ã€‚</p><pre><code class=\"language-yaml\">$ kubectl port-forward --namespace loki-stack service/loki-grafana 3000:80\n</code></pre><p>ä¸‹ä¸€æ­¥ä½¿ç”¨æµè§ˆå™¨è®¿é—® <a href=\"http://127.0.0.1:3000\">http://127.0.0.1:3000</a>ï¼Œè¾“å…¥ç”¨æˆ·å admin å’Œä¸Šé¢è·å–çš„å¯†ç ï¼Œç™»å½•åï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ° Grafana çš„ç•Œé¢ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/23/39/237169e34f79fd23fbc4a275d3288639.png?wh=1920x1041\" alt=\"å›¾ç‰‡\"></p><h2>éƒ¨ç½²ç¤ºä¾‹åº”ç”¨</h2><p>æ¥ä¸‹æ¥ï¼Œä¸ºäº†ä»‹ç» Loki çš„ä½¿ç”¨æ–¹æ³•ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦è®©é›†ç¾¤å†…äº§ç”Ÿä¸€äº›æ—¥å¿—ï¼Œä½ éœ€è¦å…ˆéƒ¨ç½²æˆ‘æå‰å†™å¥½çš„ç¤ºä¾‹åº”ç”¨ã€‚</p><pre><code class=\"language-yaml\">$ kubectl apply -f https://ghproxy.com/https://raw.githubusercontent.com/lyzhang1999/kubernetes-example/main/loki/deployment.yaml\ndeployment.apps/log-example created\nservice/log-example created\ningress.networking.k8s.io/log-example created\n</code></pre><p>åœ¨è¿™ä¸ªç¤ºä¾‹åº”ç”¨ä¸­ï¼Œç”±äºæˆ‘é…ç½®äº†å­˜æ´»æ¢é’ˆï¼Œæ‰€ä»¥ Pod æ¯éš” 10 ç§’é’Ÿä¼šåœ¨æ ‡å‡†è¾“å‡ºä¸­æ‰“å°æ—¥å¿—ä¿¡æ¯ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•é€šè¿‡ kubectl logs å‘½ä»¤æ¥æŸ¥çœ‹ Pod çš„æ—¥å¿—ä¿¡æ¯ã€‚</p><pre><code class=\"language-yaml\">$ kubectl logs -l app=log-example&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;\ntime=\"2022-12-23T02:55:52Z\" level=info msg=\"request completed\" duration=\"63.233Âµs\" method=GET size=4 status=200 uri=/ping\n{\"duration\":63233,\"level\":\"info\",\"method\":\"GET\",\"msg\":\"request completed\",\"size\":4,\"status\":200,\"time\":\"2022-12-23T02:55:52Z\",\"uri\":\"/ping\"}\n</code></pre><p>ä»è¿”å›ç»“æœæˆ‘ä»¬ä¼šå‘ç°ï¼Œç¤ºä¾‹åº”ç”¨è¾“å‡ºäº†ä¸¤ç§æ ¼å¼çš„æ—¥å¿—ä¿¡æ¯ï¼Œä¸€ç§æ˜¯<strong>æ ‡å‡†çš„ logfmt æ ¼å¼</strong>ï¼Œå¦ä¸€ç§æ˜¯ <strong>JSON æ ¼å¼ï¼Œ</strong>è¿™ä¸¤ç§æ—¥å¿—æ ¼å¼åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹æ˜¯æœ€å¸¸è§çš„ã€‚åœ¨æ—¥å¿—å†…å®¹ä¸­ï¼Œduration è¡¨ç¤ºè¯·æ±‚å¤„ç†çš„æ—¶é—´ï¼Œmethod è¡¨ç¤ºè¯·æ±‚æ–¹å¼ï¼Œsize è¡¨ç¤ºè¿”å›å†…å®¹çš„å¤§å°ï¼Œstatus è¡¨ç¤ºè¿”å›çš„çŠ¶æ€ç ï¼Œuri è¡¨ç¤ºè¯·æ±‚çš„è·¯å¾„ã€‚</p><h2>æŸ¥è¯¢æ—¥å¿—</h2><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œé€šè¿‡å‘½ä»¤è¡Œæ¥æŸ¥è¯¢æ—¥å¿—å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„å®è·µã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•ä½¿ç”¨ Loki æ¥æŸ¥è¯¢ Pod çš„æ—¥å¿—ä¿¡æ¯ã€‚</p><p>åœ¨è¿›å…¥ Grafana ä¹‹åï¼Œç‚¹å‡»å·¦ä¾§çš„â€œExploreâ€è¿›å…¥æ—¥å¿—æŸ¥è¯¢ç•Œé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/86/0a/867b2c35c7ba49e02a47e5a86yy26d0a.png?wh=1920x1041\" alt=\"å›¾ç‰‡\"></p><p>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒæŸ¥è¯¢ Loki çš„æ—¥å¿—ä¿¡æ¯éœ€è¦ç¼–å†™ LogQLï¼Œå®ƒæ˜¯ Loki ç”¨æ¥æŸ¥è¯¢æ—¥å¿—çš„ä¸€ç§ç‰¹æ®Šè¯­æ³•ï¼Œå­¦ä¹ çš„é—¨æ§›ä¹Ÿæ¯”è¾ƒé«˜ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¹‹å‰éƒ¨ç½² Grafana çš„æ—¶å€™ï¼Œæˆ‘å°±ç‰¹æ„éƒ¨ç½²äº† 9.0 çš„ç‰ˆæœ¬ï¼Œå®ƒå¸¦æœ‰å›¾å½¢åŒ–çš„æŸ¥è¯¢è¯­å¥æ„é€ å™¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¡¨å•çš„æ–¹å¼æ¥æ„é€ æŸ¥è¯¢è¯­å¥ã€‚</p><p>åœ¨â€œLabel filtersâ€ä¸‹æ‹‰æ¡†ä¸­é€‰æ‹©â€œappâ€ï¼Œåœ¨å³ä¾§çš„ä¸‹æ‹‰æ¡†ä¸­é€‰æ‹©æˆ‘ä»¬éƒ¨ç½²çš„ç¤ºä¾‹åº”ç”¨â€œlog-exampleâ€ï¼Œæ­¤æ—¶ï¼Œåœ¨â€œRaw queryâ€ä¸­ä¼šæ˜¾ç¤ºé€šè¿‡è¡¨å•æ„é€ çš„ LogQLã€‚ç‚¹å‡»å³ä¸Šè§’è“è‰²çš„â€œRun queryâ€æŒ‰é’®æ¥æŸ¥è¯¢æ—¥å¿—ï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ°ç•Œé¢ä¸­è¿”å›çš„ Pod æ—¥å¿—ä¿¡æ¯ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/09/19/09fe141706a2ec3a62b6464fc858f819.png?wh=1920x1041\" alt=\"å›¾ç‰‡\"></p><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ä¸€æ¬¡æœ€ç®€å•çš„æ—¥å¿—æŸ¥è¯¢ã€‚æ€ä¹ˆæ ·ï¼ŒæŸ¥è¯¢æ—¥å¿—æ˜¯ä¸æ˜¯å˜å¾—éå¸¸ç®€å•ä¸”å‹å¥½äº†å‘¢ï¼Ÿ</p><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬è¿˜ä¼šé€šè¿‡æŸ¥æ‰¾æ—¥å¿—ä¸­çš„å…³é”®ä¿¡æ¯æ¥å®šä½é”™è¯¯çš„ä½ç½®ã€‚åœ¨ Loki ä¸­ ï¼Œè¦é€šè¿‡å…³é”®å­—æ¥æŸ¥æ‰¾æ—¥å¿—ä¹Ÿéå¸¸ç®€å•ï¼Œä½ å¯ä»¥åœ¨â€œLine containsâ€ä¸‹æ–¹çš„è¾“å…¥æ¡†ä¸­è¾“å…¥å…³é”®å­—æ¥æŸ¥æ‰¾æ—¥å¿—ã€‚æ¯”å¦‚è¦æŸ¥æ‰¾åŒ…å«å­—ç¬¦ä¸²â€œ200â€çš„æ—¥å¿—ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b5/1a/b578e44dd9c45b92db0f506fd2de571a.png?wh=1920x942\" alt=\"å›¾ç‰‡\"></p><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿé€šè¿‡å…³é”®å­—æ¥å®šä½æ—¥å¿—ä¿¡æ¯äº†ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥åˆ†æåˆšæ‰çš„æŸ¥è¯¢è¿‡ç¨‹ã€‚ä¹‹å‰é€šè¿‡è¡¨å•æ„é€ çš„ LogQL æ˜¯ä¸‹é¢è¿™æ ·çš„ã€‚</p><pre><code class=\"language-yaml\">{app=\"log-example\"}&nbsp;|=&nbsp;`200`\n</code></pre><p>è¿™ä¸ªå…¸å‹çš„ LogQL å®é™…ä¸Šæ˜¯ç”±ä¸¤éƒ¨åˆ†ç»„æˆçš„ï¼Œå‰åŠéƒ¨åˆ†å¤§æ‹¬å·é‡Œçš„ {app=â€œlog-exampleâ€} æ˜¯æ—¥å¿—æµé€‰æ‹©å™¨ï¼ŒååŠéƒ¨åˆ†æ˜¯æ—¥å¿—ç®¡é“æ“ä½œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/ff/91/ff38e8f7ef16889847517ced0a6ba791.png?wh=1920x584\" alt=\"å›¾ç‰‡\"></p><p>æ—¥å¿—æµé€‰æ‹©å™¨å†³å®šæ—¥å¿—çš„æ¥æºï¼Œå®ƒå¯ä»¥é€šè¿‡ Label filters æ ‡ç­¾è¿‡æ»¤å™¨æ¥é€‰æ‹©æ—¥å¿—ï¼Œå®ƒæ˜¯ä¸€æ®µåŒ…åœ¨å¤§æ‹¬å·å†…çš„è¡¨è¾¾å¼ã€‚</p><p>æ—¥å¿—ç®¡é“æ“ä½œæ˜¯å¯¹æ—¥å¿—çš„è¿›ä¸€æ­¥å¤„ç†ï¼Œå®ƒä»¥â€œ|â€ç¬¦å·ä½œä¸ºç®¡é“æ“ä½œç¬¦ã€‚ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å…³é”®å­—æœç´¢æ—¥å¿—ï¼Œæˆ–è€…é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æ¥è¿‡æ»¤æ—¥å¿—ã€‚</p><p>å¦‚æœä½ ç†Ÿæ‚‰ Linux ç³»ç»Ÿï¼Œé‚£ä¹ˆä½ å®Œå…¨å¯ä»¥æŠŠå®ƒå’Œ Linux ä¸­çš„ç®¡é“æ“ä½œè¿›è¡Œç±»æ¯”æ¥åŠ æ·±ç†è§£ã€‚æ¯”å¦‚åœ¨ Linux ä¸‹ï¼Œè¦ä»ä¸€ä¸ª log æ–‡ä»¶ä¸­æŸ¥æ‰¾ä¸€æ®µåŒ…å«æŸä¸ªå…³é”®å­—çš„æ—¥å¿—ï¼Œä½ å¯ä»¥åƒä¸‹é¢è¿™ä¹ˆåšã€‚</p><pre><code class=\"language-yaml\">$ cat log.log | grep \"key_word\"\n</code></pre><p>åœ¨è¿™æ®µ Linux å‘½ä»¤ä¸­ï¼Œcat å…¶å®å°±æ˜¯ Loki ä¸­çš„æ—¥å¿—æµé€‰æ‹©å™¨ï¼Œå®ƒå†³å®šäº†æ—¥å¿—æ¥æºã€‚è€Œåé¢çš„ç®¡é“æ“ä½œç¬¦å’Œ grep åˆ™æ˜¯å¯¹æ—¥å¿—çš„è¿›ä¸€æ­¥æ£€ç´¢ï¼Œè¿™æ ·çœ‹æ˜¯ä¸æ˜¯æ›´å¥½ç†è§£äº†å‘¢ï¼Ÿ</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å…ˆç®€å•ä»‹ç»ä¸€ä¸‹æ—¥å¿—æµé€‰æ‹©å™¨ä¸­çš„ Label filters æ ‡ç­¾è¿‡æ»¤å™¨ã€‚</p><h3>Label filters</h3><p>Label filters æ˜¯æ ‡ç­¾è¿‡æ»¤å™¨ï¼ŒLoki å·²ç»ä¸ºæˆ‘ä»¬å†…ç½®äº†ä¸€äº›è¿‡æ»¤å™¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥é€‰æ‹©æ—¥å¿—çš„æ¥æºï¼Œä¾‹å¦‚é€šè¿‡ Kubernetes Label åŒ¹é…ä¸€ç»„ Pod çš„æ—¥å¿—ï¼Œè¿˜å¯ä»¥åŒ¹é…æŸä¸ªå‘½åç©ºé—´çš„æ—¥å¿—ï¼Œç”šè‡³æ˜¯æŸä¸ªå®¹å™¨çš„æ—¥å¿—ã€‚é€šå¸¸ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢å‡ ç§ç±»å‹çš„æ ‡ç­¾è¿‡æ»¤å™¨ã€‚</p><ol>\n<li>å·¥ä½œè´Ÿè½½çš„ Labelï¼šé€šè¿‡ Label åŒ¹é…ä¸€ç»„ Pod ä½œä¸ºæ—¥å¿—æ¥æºï¼Œæˆ‘ä»¬åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­å°±ç”¨åˆ°äº†å®ƒã€‚</li>\n<li>å®¹å™¨ï¼šé€‰æ‹©ç‰¹å®šå®¹å™¨çš„æ—¥å¿—ä½œä¸ºæ¥æºã€‚</li>\n<li>å‘½åç©ºé—´ï¼šé€‰æ‹©ç‰¹å®šçš„å‘½åç©ºé—´ä½œä¸ºæ—¥å¿—æ¥æºã€‚</li>\n<li>èŠ‚ç‚¹ï¼šé€‰æ‹©ç‰¹å®šçš„èŠ‚ç‚¹ä½œä¸ºæ—¥å¿—æ¥æºã€‚</li>\n<li>Podï¼šé€‰æ‹©ç‰¹å®šçš„ Pod ä½œä¸ºæ—¥å¿—æ¥æºã€‚</li>\n</ol><p>åœ¨å®é™…çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬æŸ¥çœ‹æ—¥å¿—çš„å¯¹è±¡å¾€å¾€æ˜¯æ˜ç¡®çš„ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¼šé€šè¿‡<strong>Label æˆ–è€…å®¹å™¨å</strong>çš„æ–¹å¼æ¥é€‰æ‹©æ—¥å¿—æ¥æºï¼Œè¿™ä¼šå‡å°‘æ£€ç´¢æ—¥å¿—çš„æ•°é‡å¹¶åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚</p><h3>æ—¥å¿—ç®¡é“æ“ä½œ</h3><p>æ—¥å¿—ç®¡é“æ“ä½œæ˜¯ä»¥â€œ|â€ç¬¦å·ä¸ºæ ‡è¯†çš„ï¼Œå’Œ Linux çš„ç®¡é“æ“ä½œç¬¦ä¸€æ ·ï¼Œåœ¨ä¸€æ¬¡æ—¥å¿—æŸ¥è¯¢ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨å¤šä¸ªæ—¥å¿—ç®¡é“ç»„æˆé“¾å¼æ“ä½œã€‚</p><p>æ—¥å¿—ç®¡é“æ“ä½œå†…å®¹éå¸¸å¤šï¼Œæ‰€ä»¥æˆ‘å¹¶ä¸æ‰“ç®—åšå®Œæ•´çš„ä»‹ç»ã€‚è¿™é‡Œæˆ‘ä»å®é™…çš„åœºæ™¯å‡ºå‘ï¼Œå‘ä½ ä»‹ç»ä¸€äº›å¸¸ç”¨çš„æ—¥å¿—ç®¡é“ç¼–å†™æ–¹æ³•ã€‚</p><p>æ—¥å¿—ç®¡é“æ“ä½œæœ€ç®€å•çš„ä¾‹å­æ˜¯é€šè¿‡å…³é”®å­—æŸ¥æ‰¾æ—¥å¿—ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢ç”¨åˆ°çš„åŒ¹é…åŒ…å«å­—ç¬¦ä¸²â€œ200â€çš„æ—¥å¿—ï¼Œå®ƒçš„å†™æ³•æ˜¯ï¼š|= <code>200</code></p><p>è¿™é‡Œçš„â€œ=â€å·å®é™…ä¸Šæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œä»£è¡¨åŒ…å«å­—ç¬¦ä¸²ã€‚é™¤äº†åŒ…å«ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ä¸‹é¢å‡ ä¸ªè¡¨è¾¾å¼ã€‚</p><ol>\n<li>!=ï¼Œæ—¥å¿—ä¸åŒ…å«å­—ç¬¦ä¸²ã€‚</li>\n<li>|~ï¼Œæ—¥å¿—åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ã€‚</li>\n<li>!~ï¼Œæ—¥å¿—ä¸åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ã€‚</li>\n</ol><p>æ­¤å¤–ï¼Œå¯¹äºç»“æ„åŒ–çš„æ—¥å¿—ä¿¡æ¯ï¼Œæ—¥å¿—ç®¡é“æ“ä½œé‡Œè¿˜å¯ä»¥ä½¿ç”¨å†…ç½®çš„æ—¥å¿—è§£æå™¨ï¼Œä¾‹å¦‚ logfmt å’Œ JSON è§£æå™¨ï¼Œå®ƒä»¬å¯ä»¥è¿›ä¸€æ­¥åˆ†ææ—¥å¿—ä¸­çš„é”®å€¼å¯¹ã€‚</p><h3>æ—¥å¿—å­—æ®µå€¼æŸ¥è¯¢</h3><p>åœ¨å®é™…çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šä½¿ç”¨ logfmt å’Œ JSON æ ¼å¼è¾“å‡ºæ—¥å¿—ã€‚logfmt å’Œ JSON éƒ½æ˜¯åŒ…å« Key å’Œ Value çš„æ—¥å¿—æ ¼å¼ï¼Œä¾‹å¦‚ä¸‹é¢å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ logfmt çš„ä¾‹å­ã€‚</p><pre><code class=\"language-yaml\">time=\"2022-12-23T02:55:52Z\" level=info msg=\"request completed\" duration=\"63.233Âµs\" method=GET size=4 status=200 uri=/ping\n</code></pre><p>æœ‰æ—¶å€™ï¼Œé€šè¿‡å…³é”®å­—æœç´¢æ‰¾åˆ°çš„æ—¥å¿—å¯èƒ½å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚æ¯”å¦‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒåŒ…å«å­—ç¬¦ä¸²â€œ200â€çš„æ—¥å¿—å¹¶ä¸ä»£è¡¨è¯·æ±‚è¿”å›çŠ¶æ€ç ä¸º 200 çš„æ—¥å¿—ï¼Œæˆ‘ä»¬éœ€è¦ç²¾ç¡®åˆ°æ—¥å¿— status å­—æ®µçš„å€¼ã€‚å…¶æ¬¡ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æ‰¾åˆ°æ‰€æœ‰è¯·æ±‚è¿”å›çŠ¶æ€ç ä¸ºé 200 çš„æ—¥å¿—ï¼Œå…³é”®å­—æœç´¢å°±ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚äº†ã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ›´ç²¾ç¡®çš„æŸ¥æ‰¾æ–¹æ¡ˆï¼šæ—¥å¿—è§£æå™¨ã€‚</p><p>ä¾‹å¦‚ï¼Œå¯¹äº logfmt æ ¼å¼çš„æ—¥å¿—ï¼Œ<strong>è¦æ‰¾åˆ° status å­—æ®µå€¼ä¸º 200 çš„æ—¥å¿—</strong>ï¼Œæˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™ä¹ˆå†™ LogQLã€‚</p><pre><code class=\"language-yaml\">{app=\"log-example\"} | logfmt | status = `200`\n</code></pre><p>é€šè¿‡ logfmt ç®¡é“æ“ä½œç¬¦ï¼ŒLoki ä¾¿èƒ½å¤Ÿå¸®æˆ‘ä»¬è§£ææ—¥å¿—å†…çš„æ‰€æœ‰å­—æ®µã€‚ä»¥æ­¤ç±»æ¨ï¼Œä½ å¯ä»¥æŠŠ status å­—æ®µæ›¿æ¢ä¸º uri å­—æ®µæ¥æŸ¥æ‰¾ç‰¹å®šçš„è¯·æ±‚è·¯å¾„ã€‚</p><p>å¯¹äº JSON æ ¼å¼çš„æ—¥å¿—ï¼Œä½ å¯ä»¥ä½¿ç”¨ JSON è§£æå™¨ï¼Œåœ¨ä¸Šé¢çš„è¯­å¥ä¸­ï¼Œä½ åªéœ€è¦å°† logfmt æ›¿æ¢ä¸º json å³å¯ã€‚</p><pre><code class=\"language-yaml\">{app=\"log-example\"} | json | status = `200`\n</code></pre><p>ä½ ä¹Ÿå¯ä»¥é€šè¿‡ Grafana è¡¨å•æ¥æ„é€ è¿™ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a9/10/a9c8e1af4fe0yy9c30cd8dd258bbe710.png?wh=1212x928\" alt=\"å›¾ç‰‡\"></p><p>æ­¤å¤–ï¼Œ<strong>ä½ è¿˜å¯ä»¥å°† Grafana åˆ‡æ¢åˆ°è¾“å…¥ Code æ¨¡å¼</strong>ï¼ˆå‚è€ƒæˆªå›¾ä¸­çº¢æ¡†éƒ¨åˆ†ï¼‰ï¼Œå¹¶å°†ä¸Šé¢çš„ LogQL ç²˜è´´åˆ°è¾“å…¥æ¡†å†…æ¥æŸ¥è¯¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/cb/49/cbc6b9a18541da598fcf47947da4d749.png?wh=1920x222\" alt=\"å›¾ç‰‡\"></p><h2>å¸¸ç”¨ LogQL ä¾‹å­</h2><p>ä¸ºäº†æ›´å¥½åœ°å¸®åŠ©ä½ ä½¿ç”¨ Lokiï¼Œè¿™é‡Œæˆ‘å†æ€»ç»“å‡ ä¸ªå¸¸ç”¨çš„ LogQL ä¾‹å­ï¼Œä½ å¯ä»¥æ ¹æ®ä¸‹é¢è¿™äº›ä¾‹å­ä¸¾ä¸€åä¸‰ã€‚</p><ul>\n<li>æŸ¥è¯¢çŠ¶æ€ç ä¸ç­‰äº 200 çš„æ—¥å¿—ã€‚</li>\n<li>æŸ¥è¯¢çŠ¶æ€ç åœ¨ 400 å’Œ 500 åŒºé—´çš„æ—¥å¿—ã€‚</li>\n<li>æŸ¥è¯¢æ¥å£è¿”å›æ—¶é—´è¶…è¿‡ 3us çš„æ—¥å¿—ã€‚</li>\n<li>é‡æ–°æ ¼å¼åŒ–è¾“å‡ºæ—¥å¿—ã€‚</li>\n<li>åˆ†ç»„ç»Ÿè®¡ 10s å†… Pod çš„æ—¥å¿—æ•°é‡ã€‚</li>\n<li>åˆ†ç»„ç»Ÿè®¡ 1 åˆ†é’Ÿå†…çš„è¯·æ±‚çŠ¶æ€ç æ•°é‡ã€‚</li>\n<li>ç»Ÿè®¡ TP99 çš„è¯·æ±‚è€—æ—¶å¹¶åˆ†ç»„ã€‚</li>\n</ul><p>ç”±äºç¤ºä¾‹åº”ç”¨è¾“å‡ºäº† logfmt å’Œ JSON ä¸¤ç§æ ¼å¼çš„æ—¥å¿—ï¼Œæ‰€ä»¥åœ¨æ‰€æœ‰çš„ä¾‹å­ä¸­ï¼Œæˆ‘éƒ½ä¼šé€šè¿‡ç®¡é“æ“ä½œ â€œstatus=â€ æ¥åŒ¹é… logfmt çš„æ—¥å¿—ï¼Œä»¥ä¾¿æŠŠå®ƒå’Œ JSON æ ¼å¼çš„æ—¥å¿—åŒºåˆ†å¼€ã€‚æ­¤å¤–ï¼Œä½ å¯ä»¥å…ˆæŠŠ Grafana çš„æŸ¥è¯¢ç•Œé¢åˆ‡æ¢åˆ°<strong>Code æ¨¡å¼</strong>ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥å¤åˆ¶ä¸‹é¢çš„è¯­å¥æ¥è¿›è¡Œè¯•éªŒäº†ã€‚</p><h3>æŸ¥è¯¢çŠ¶æ€ç ä¸ç­‰äº 200 çš„æ—¥å¿—</h3><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼ŒæŸ¥è¯¢è¿”å›çŠ¶æ€ç ä¸ç­‰äº 200 çš„åœºæ™¯æ˜¯æ¯”è¾ƒå¸¸è§çš„ï¼Œä»¥ç¤ºä¾‹åº”ç”¨ä¸ºä¾‹ï¼Œä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„ LogQL æ¥æŸ¥è¯¢ã€‚</p><pre><code class=\"language-yaml\">{app=\"log-example\"} |= `status=` | logfmt | status != `200`\n</code></pre><p>ä½ ä¹Ÿå¯ä»¥é€šè¿‡è¡¨å•æ„å»ºæŸ¥è¯¢è¯­å¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f7/52/f7454ff4dd34d73d35ceb4075e7c0a52.png?wh=1476x724\" alt=\"å›¾ç‰‡\"></p><h3>æŸ¥è¯¢çŠ¶æ€ç åœ¨ 400 å’Œ 500 åŒºé—´çš„æ—¥å¿—</h3><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼ŒæŸ¥è¯¢æŸä¸ªåŒºé—´çš„æ—¥å¿—æœ‰åŠ©äºé’ˆå¯¹æ€§åœ°å®šä½é”™è¯¯æ—¥å¿—ï¼Œä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„&nbsp;LogQL æ¥æŸ¥è¯¢ã€‚</p><pre><code class=\"language-yaml\">{app=\"log-example\"} |= `status=` | logfmt | status &gt;= 400 | status &lt;= 500\n</code></pre><p>ä½ è¿˜å¯ä»¥é€šè¿‡è¡¨å•æ„å»ºæŸ¥è¯¢è¯­å¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/de/53/de4ee7b7f62289f1d7131ac69576e153.png?wh=1920x730\" alt=\"å›¾ç‰‡\"></p><h3>æŸ¥è¯¢æ¥å£è¿”å›æ—¶é—´è¶…è¿‡ 3us çš„æ—¥å¿—</h3><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬ç»å¸¸æœ‰æŸ¥æ‰¾å“åº”æ¯”è¾ƒæ…¢çš„æ¥å£çš„éœ€æ±‚ï¼Œä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„ LogQL æ¥æŸ¥è¯¢ã€‚</p><pre><code class=\"language-yaml\">{app=\"log-example\"}&nbsp;|=&nbsp;`status=`&nbsp;|&nbsp;logfmt&nbsp;|&nbsp;duration&nbsp;&gt;&nbsp;3us\n</code></pre><p>ä½ è¿˜å¯ä»¥é€šè¿‡è¡¨å•æ„å»ºæŸ¥è¯¢è¯­å¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/yy/36/yyfcc3b906feyy514f784fb725607136.png?wh=1452x724\" alt=\"å›¾ç‰‡\"></p><p>é€šè¿‡è¿™ä¸ªä¾‹å­æˆ‘ä»¬ä¼šå‘ç°ï¼ŒGrafana ä¼šè‡ªåŠ¨æ¨æ–­æ—¥å¿—å€¼çš„ç±»å‹ï¼Œä¾‹å¦‚å¸¸è§çš„å­—ç¬¦ä¸²ç±»å‹ã€æ•°å­—ç±»å‹å’Œæ—¶é—´ç±»å‹ï¼Œå¹¶ä¸”æ”¯æŒæ¯”è¾ƒæ“ä½œç¬¦ï¼Œä½¿ç”¨éå¸¸æ–¹ä¾¿ã€‚</p><h3>é‡æ–°æ ¼å¼åŒ–è¾“å‡ºæ—¥å¿—</h3><p>æœ‰æ—¶å€™ï¼Œæ—¥å¿—çš„è¾“å‡ºå†…å®¹æ¯”è¾ƒå¤šï¼Œå½“æˆ‘ä»¬å¸Œæœ›é‡ç‚¹æŸ¥çœ‹éƒ¨åˆ†å†…å®¹æ—¶ï¼Œé‡æ–°å¯¹æ—¥å¿—è¾“å‡ºè¿›è¡Œæ ¼å¼åŒ–å°±æ˜¾å¾—æ¯”è¾ƒé‡è¦äº†ï¼Œä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„ LogQL æ¥é‡æ–°æ ¼å¼åŒ–è¾“å‡ºæ—¥å¿—ã€‚</p><pre><code class=\"language-yaml\">{app=\"log-example\"}&nbsp;|=&nbsp;`status=`&nbsp;|&nbsp;logfmt&nbsp;|&nbsp;line_format&nbsp;`{{ .duration }} {{ .uri }}`\n</code></pre><p>åœ¨è¿™æ¡è¯­å¥ä¸­ï¼Œline_format å…³é”®å­—åé¢æŒ‡å®šäº†æ—¥å¿—è¾“å‡ºçš„å†…å®¹ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæŸ¥è¯¢æ—¥å¿—å°†é‡æ–°æ ¼å¼åŒ–ä¸ºå“åº”æ—¶é—´å’Œè¯·æ±‚è·¯å¾„è¾“å‡ºï¼Œè€Œä¸åŒ…å«å…¶ä»–å†…å®¹ã€‚</p><p>ä½ è¿˜å¯ä»¥é€šè¿‡è¡¨å•æ„å»ºæŸ¥è¯¢è¯­å¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/26/2b/26d21274f2fd1ec071134f2428408f2b.png?wh=1390x600\" alt=\"å›¾ç‰‡\"></p><h3>åˆ†ç»„ç»Ÿè®¡ 10s å†… Pod çš„æ—¥å¿—æ•°é‡</h3><p>é™¤äº†æ—¥å¿—æŸ¥è¯¢ä»¥å¤–ï¼ŒLoki è¿˜èƒ½å¤Ÿå¸®æˆ‘ä»¬å¯¹æ—¥å¿—è¿›è¡Œåº¦é‡ç»Ÿè®¡ã€‚ä¾‹å¦‚ï¼Œè¦ç»Ÿè®¡ 10s å†…æ¥å£è¿”å›æ—¶é—´è¶…è¿‡ 4us çš„æ—¥å¿—æ•°é‡ï¼Œå¹¶æŒ‰ Pod è¿›è¡Œåˆ†ç»„ï¼Œä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„ LogQL æ¥è¿›è¡Œç»Ÿè®¡ã€‚</p><pre><code class=\"language-yaml\">sum by (pod) (count_over_time({app=\"log-example\"} |= `status=` | logfmt | duration &gt; 4us [10s]))\n</code></pre><p>åœ¨è¿™æ¡æŸ¥è¯¢è¯­å¥ä¸­ï¼Œcount_over_time æŒ‡çš„æ˜¯ç»Ÿè®¡ç»™å®šèŒƒå›´å†…æ¯ä¸ªæ—¥å¿—çš„æ¡ç›®æ•°é‡ï¼Œsum by æŒ‡çš„æ˜¯å¯¹ Pod è¿›è¡Œåˆ†ç»„ã€‚</p><p>è¿è¡ŒæŸ¥è¯¢åï¼Œä½ å°†å¾—åˆ°ä¸‹é¢çš„å›¾è¡¨ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/20/8c/20a899a5ed76257a5d77d75e5561898c.png?wh=1920x729\" alt=\"å›¾ç‰‡\"></p><h3>åˆ†ç»„ç»Ÿè®¡ 1 åˆ†é’Ÿå†…çš„è¯·æ±‚çŠ¶æ€ç æ•°é‡</h3><p>è¦å¯¹ 1 åˆ†é’Ÿå†…çš„è¯·æ±‚çŠ¶æ€ç è¿›è¡Œåˆ†ç»„çš„æ•°é‡ç»Ÿè®¡ï¼Œä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„ LogQL æ¥æŸ¥è¯¢ã€‚</p><pre><code class=\"language-yaml\">sum by (status) (\ncount_over_time({app=\"log-example\"} |= `status=` | logfmt | __error__=\"\"[1m])\n)\n</code></pre><p>è¿è¡ŒæŸ¥è¯¢è¯­å¥åï¼Œä½ å°†å¾—åˆ°ä¸‹é¢çš„å›¾è¡¨ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/8e/45/8ea28216c0fcc3fc2bb646e92f9d7d45.png?wh=1920x778\" alt=\"å›¾ç‰‡\"></p><h3>ç»Ÿè®¡ TP99 çš„è¯·æ±‚è€—æ—¶å¹¶åˆ†ç»„</h3><p>è¦ç»Ÿè®¡ 1 åˆ†é’Ÿå†… 99% çš„è¯·æ±‚è€—æ—¶å¹¶æŒ‰ç…§æ¡ä»¶åˆ†ç»„ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ LogQL æ¥æŸ¥è¯¢ã€‚</p><pre><code class=\"language-yaml\">quantile_over_time(0.99,\n  {app=\"log-example\"}\n  |= `status=` | logfmt | unwrap duration(duration) | __error__=\"\"[1m]\n) by (method,status)\n</code></pre><p>quantile_over_time æ˜¯ Loki çš„å†…ç½®å‡½æ•°ï¼Œç”¨æ¥æŒ‡å®šé—´éš”å†…å€¼çš„åˆ†ä½æ•°ã€‚</p><p>è¿è¡ŒæŸ¥è¯¢è¯­å¥åï¼Œä½ å°†å¾—åˆ°ä¸‹é¢çš„å›¾è¡¨ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a5/a8/a5fb417ee15812fbdbbeyya345d40aa8.png?wh=1920x795\" alt=\"å›¾ç‰‡\"></p><p>ä»è¿”å›ç»“æœæˆ‘ä»¬å¯ä»¥çœ‹åˆ° 99% çš„è¯·æ±‚åœ¨è¿™æ®µæ—¶é—´å†…çš„å“åº”æƒ…å†µï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„ç³»ç»Ÿè¯„ä¼°æŒ‡æ ‡ã€‚</p><p>ä¸è¿‡ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šç›´æ¥ä»æ—¥å¿—ä¸­è§‚å¯Ÿ HTTP è¯·æ±‚çš„å“åº”æƒ…å†µï¼Œè€Œæ˜¯ä¼šé€šè¿‡ç›‘æµ‹ç½‘å…³çš„æ€§èƒ½æ•°æ®æ¥è¿›è¡Œåˆ¤æ–­ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°†ä¼šåœ¨ä¸‹ä¸€èŠ‚è¯¾è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚</p><h2>å·¥ä½œåŸç†è§£æ</h2><p>ç›¸æ¯”è¾ƒä¼ ç»Ÿçš„ EFK å’Œ ELK æ—¥å¿—æŠ€æœ¯æ ˆï¼ŒLoki åœ¨ Kubernetes åœºæ™¯ä¸‹æ›´åŠ è½»é‡ï¼ŒåŒæ—¶ï¼Œå®ƒè¿˜ä½¿ç”¨äº† Grafana ä½œä¸ºæŸ¥è¯¢ç•Œé¢ï¼Œåœ¨æ„å»ºäº†ç›‘æ§ç³»ç»Ÿä¹‹åï¼Œå¯ä»¥åœ¨åŒä¸€å¥—ç•Œé¢æŸ¥è¯¢æ—¥å¿—å’ŒæŒ‡æ ‡ä¿¡æ¯ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ç®€å•ä»‹ç»ä¸€ä¸‹ Loki çš„å·¥ä½œåŸç†ï¼Œå®ƒçš„æ ¸å¿ƒç»„ä»¶åŒ…å« Promtail å’Œ Lokiã€‚</p><h3>Promtail</h3><p>åœ¨æ·±å…¥äº†è§£ Promtail ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦çŸ¥é“ä¸€äº› Kubernetes æ—¥å¿—çš„èƒŒæ™¯çŸ¥è¯†ã€‚</p><p>é¦–å…ˆï¼Œå½“ Pod æ‰“å°è¾“å‡ºæ—¥å¿—æ—¶ï¼Œä¼šè¢« Kubernetes å­˜å‚¨åœ¨å¯¹åº” Node èŠ‚ç‚¹çš„ /var/log ç›®å½•çš„æ–‡ä»¶ä¸­ï¼Œå¯¹äº Kind é›†ç¾¤ï¼Œä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„å®éªŒæ¥éªŒè¯è¿™ä¸ªè¿‡ç¨‹ã€‚</p><p>é¦–å…ˆï¼Œé€šè¿‡ docker ps å‘½ä»¤æ¥æŸ¥çœ‹æœ¬åœ°æ­£åœ¨è¿è¡Œä¸­çš„å®¹å™¨ã€‚</p><pre><code class=\"language-yaml\">$ docker ps\nCONTAINER ID&nbsp; &nbsp;IMAGE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; COMMAND&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CREATED&nbsp; &nbsp; &nbsp; &nbsp; STATUS&nbsp; &nbsp; &nbsp; &nbsp; PORTS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NAMES\na68175b2b097&nbsp; &nbsp;kindest/node:v1.25.0&nbsp; &nbsp;\"/usr/local/bin/entrâ€¦\"&nbsp; &nbsp;31 hours ago&nbsp; &nbsp;Up 21 hours&nbsp; &nbsp;127.0.0.1:60632-&gt;6443/tcp&nbsp; &nbsp;kind-control-plane\n</code></pre><p>ç”±äº Kind æ˜¯ä½¿ç”¨å®¹å™¨æ¥æ¨¡æ‹Ÿ Node èŠ‚ç‚¹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ docker exec æ¥è¿›å…¥åˆ°å®¹å™¨ä¸­ï¼Œè¿™å°±ç›¸å½“äºæˆ‘ä»¬è¿›å…¥äº† Kubernetes çš„ Node èŠ‚ç‚¹ã€‚</p><pre><code class=\"language-yaml\">$ docker exec -it a68175b2b097 bash\nroot@kind-control-plane:/#\n</code></pre><p>æ¥ä¸‹æ¥ï¼Œè¿›å…¥ /var/log/pods ç›®å½•ã€‚</p><pre><code class=\"language-yaml\">root@kind-control-plane:/# cd /var/log/pods\nroot@kind-control-plane:/var/log/pods# ls\ndefault_log-example-67746dfd97-cq7lb_201ecbd1-d6e4-4efe-8bd8-c7620ef21f15\ndefault_log-example-67746dfd97-f2h74_76fce842-09fb-456d-bfcd-dd6fa3d67029\n</code></pre><p>è¿™ä¸ªç›®å½•å­˜å‚¨äº†èŠ‚ç‚¹ä¸­æ‰€æœ‰ Pod çš„æ—¥å¿—æ–‡ä»¶ï¼Œç›®å½•ååŒ…å« Pod åç§°ã€‚æˆ‘ä»¬è¿›å…¥åˆ°ç¬¬ä¸€ä¸ª Pod çš„ç›®å½•è¿›ä¸€æ­¥æŸ¥çœ‹æ—¥å¿—ã€‚</p><pre><code class=\"language-yaml\">root@kind-control-plane:/var/log/pods# cd default_log-example-67746dfd97-cq7lb_201ecbd1-d6e4-4efe-8bd8-c7620ef21f15/go-backend\nroot@kind-control-plane:/var/log/pods/default_log-example-67746dfd97-cq7lb_201ecbd1-d6e4-4efe-8bd8-c7620ef21f15/\ngo-backend# ls\n0.log\n</code></pre><p>åœ¨è¿”å›çš„ç»“æœä¸­ï¼Œ0.log æ–‡ä»¶å®é™…ä¸Šå°±æ˜¯ Pod çš„æ—¥å¿—æ–‡ä»¶ï¼Œä½ å¯ä»¥å°è¯•ä½¿ç”¨ tail -f å‘½ä»¤æ¥æŸ¥çœ‹å®ƒï¼Œ<strong>ä½ ä¼šå‘ç°è¿™ä¸ªæ–‡ä»¶ä¼šå®æ—¶äº§ç”Ÿæ–°çš„æ—¥å¿—ã€‚</strong></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åªè¦èƒ½è·å–åˆ°è¿™ä¸ªæ—¥å¿—æ–‡ä»¶çš„å†…å®¹ï¼Œå°±å¯ä»¥å®ç°å¯¹ Pod æ—¥å¿—çš„é‡‡é›†ã€‚</p><p>å›åˆ° Loki çš„ Promtail ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“å®ƒæ˜¯ä»¥ DaemonSet çš„æ–¹å¼éƒ¨ç½²åœ¨ Kubernetes é›†ç¾¤ä¸­çš„ï¼Œè¿™æ„å‘³ç€ï¼ŒKubernetes æ¯ä¸€ä¸ª Node èŠ‚ç‚¹éƒ½å°†è¿è¡Œ Promtailï¼Œå®ƒé€šè¿‡å®ç°ç±»ä¼¼äº tail -f çš„èƒ½åŠ›æ¥è·å–æ–°çš„æ—¥å¿—ï¼Œå¹¶å°†æ—¥å¿—ä¿¡æ¯å‘é€åˆ° Loki è¿›è¡Œå­˜å‚¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/11/80/115f88ceb81f059028239f6720566380.jpg?wh=1920x877\" alt=\"å›¾ç‰‡\"></p><h3>Loki</h3><p>Loki ä¸»è¦è´Ÿè´£æ—¥å¿—çš„å­˜å‚¨å’Œè¯»å–ï¼Œå®ƒçš„å†™å…¥ QPS å¯èƒ½éå¸¸é«˜ï¼Œæ‰€ä»¥æ•´ä½“æ¶æ„è®¾è®¡ä¼šæ›´åŠ çµæ´»ï¼Œå®ƒæ ¸å¿ƒçš„è®¾è®¡æ€æƒ³æ˜¯<strong>è¯»å†™åˆ†ç¦»</strong>ã€‚</p><p>å½“ä¸€æ¡æ—¥å¿—å‘é€åˆ° Loki ä¹‹åï¼Œå®ƒä¼šç»å†ä¸‹é¢çš„æµç¨‹ã€‚</p><ol>\n<li>æ—¥å¿—åˆ°è¾¾çš„ç¬¬ä¸€ç«™æ˜¯ Distributor ç»„ä»¶ï¼ŒDistributor æ¥æ”¶åˆ°æ—¥å¿—åä¼šåˆ†å‘åˆ°å¤šä¸ª Ingester æ¥æ”¶å™¨ä¸Šã€‚</li>\n<li>Ingester æ¥æ”¶å™¨æ˜¯ä¸€ä¸ªæœ‰çŠ¶æ€çš„ç»„ä»¶ï¼ˆè¿™ä¹Ÿæ˜¯ Loki åœ¨ Kubernetes é‡‡ç”¨ StatefulSet éƒ¨ç½²çš„åŸå› ï¼‰ï¼Œå®ƒä¼šå¯¹æ—¥å¿—è¿›è¡Œ gzip å‹ç¼©å’Œç¼“å­˜ï¼Œå½“ç¼“å­˜è¾¾åˆ°ä¸€å®šè§„æ¨¡æ—¶ï¼Œå°±å°†æ—¥å¿—æ•°æ®å†™å…¥åˆ°æ•°æ®åº“ä¸­ã€‚</li>\n</ol><p>åœ¨æ•°æ®åº“å­˜å‚¨æ–¹é¢ï¼ŒLoki å°†å­˜å‚¨ç´¢å¼•çš„æ•°æ®åº“å’Œå­˜å‚¨æ—¥å¿—çš„æ•°æ®åº“åšäº†åˆ†ç¦»ï¼Œå¹¶ä¸”æ”¯æŒä¸°å¯Œçš„äº‘å‚å•†æ•°æ®åº“ã€‚</p><p>å½“ Grafana å‘å‡ºæ—¥å¿—æŸ¥è¯¢è¯·æ±‚æ—¶ï¼ŒLoki Querier æŸ¥è¯¢å™¨ç»„ä»¶å°†é¦–å…ˆä»ç´¢å¼•æ•°æ®åº“ä¸­è·å¾—æ—¥å¿—ç´¢å¼•ï¼Œå¹¶è·å–æ—¥å¿—ã€‚æ­¤å¤–ï¼ŒQuerier ç»„ä»¶è¿˜ä¼šä» Ingester è¯»å–è¿˜æ²¡æœ‰å†™å…¥æ•°æ®åº“çš„æ—¥å¿—ä¿¡æ¯ã€‚</p><h2>ç”Ÿäº§å»ºè®®</h2><p>ç”±äº Loki çš„é…ç½®æ¯”è¾ƒå¤æ‚ï¼Œè€Œç”Ÿäº§ç¯å¢ƒä¸‹æ—¥å¿—é‡ä¸€èˆ¬æ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿç»™ä½ æä¾›å‡ ç‚¹ç”Ÿäº§å»ºè®®ä¾›ä½ å‚è€ƒã€‚</p><h3>é…ç½®æŒä¹…åŒ–</h3><p>åœ¨ä½¿ç”¨ Helm å®‰è£… Loki æ—¶ï¼Œé»˜è®¤å¹¶ä¸ä¼šå¯¹æ—¥å¿—æŒä¹…åŒ–å­˜å‚¨ï¼Œä½ éœ€è¦è¿›è¡Œé¢å¤–çš„é…ç½®ã€‚<strong>åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæˆ‘å»ºè®®å¼€å¯æ—¥å¿—çš„æŒä¹…åŒ–å­˜å‚¨ã€‚</strong></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæŒä¹…åŒ–å­˜å‚¨éœ€è¦ Kubernetes StorageClass çš„æ”¯æŒã€‚åœ¨å®‰è£…å‰ï¼Œä½ éœ€è¦å°†ä¸‹é¢çš„å†…å®¹ä¿å­˜ä¸º pvc-values.yamlã€‚</p><pre><code class=\"language-yaml\">loki:\n&nbsp; persistence:\n&nbsp; &nbsp; enabled: true\n&nbsp; &nbsp; size: 500Gi\n</code></pre><p>ç„¶åï¼Œåœ¨å®‰è£…æ—¶æŒ‡å®šè¿™ä¸ªé…ç½®æ–‡ä»¶ã€‚</p><pre><code class=\"language-yaml\">helm upgrade --install loki --namespace=loki-stack grafana/loki-stack --create-namespace --set grafana.enabled=true --set grafana.image.tag=\"9.3.2\" -f pvc-values.yaml\n</code></pre><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæ—¥å¿—å­˜å‚¨é‡çš„å¢é•¿å¯èƒ½ä¼šå¾ˆå¿«ï¼Œæ‰€ä»¥ä½ å¯ä»¥æå‰åˆ†é…ä¸€ä¸ªè¾ƒå¤§å­˜å‚¨å®¹é‡çš„ PVC æŒä¹…å·ï¼Œå¹¶ç•™æ„é›†ç¾¤æ˜¯å¦æ”¯æŒå¯¹æŒä¹…å·çš„åŠ¨æ€æ‰©å®¹ï¼Œä»¥ä¾¿åç»­éšæ—¶æ‰©å¤§æ—¥å¿—å­˜å‚¨å®¹é‡ã€‚</p><h3>ä½¿ç”¨åˆé€‚çš„éƒ¨ç½²æ–¹å¼</h3><p><strong>Loki ä¸€å…±æœ‰ä¸‰ç§éƒ¨ç½²æ–¹å¼ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯å•ä½“æ¨¡å¼ã€æ‰©å±•æ¨¡å¼å’Œå¾®æœåŠ¡æ¨¡å¼ã€‚</strong></p><p>å…¶ä¸­ï¼Œå•ä½“æ¨¡å¼æ˜¯æˆ‘ä»¬è¿™èŠ‚è¯¾é‡‡ç”¨çš„éƒ¨ç½²æ–¹å¼ï¼Œå®ƒçš„å®‰è£…å’Œé…ç½®éƒ½éå¸¸ç®€å•ï¼Œä½†æ€§èƒ½ä¸€èˆ¬ï¼Œè¿™ç§éƒ¨ç½²æ–¹å¼é€‚ç”¨äºæ¯å¤©æ—¥å¿—é‡åœ¨ <strong>100G</strong>å·¦å³çš„ä¸šåŠ¡ç³»ç»Ÿã€‚</p><p>æ‰©å±•æ¨¡å¼åœ¨éƒ¨ç½²ä¸Šçš„ä¸»è¦çš„å˜åŒ–æ˜¯è¯»å†™åˆ†ç¦»ï¼Œå¦‚æœæ¯å¤©çš„æ—¥å¿—é‡æ˜¯å‡ ç™¾ G ç”šè‡³æ˜¯ä¸Š T çº§åˆ«ï¼Œå»ºè®®ä½¿ç”¨è¿™ç§éƒ¨ç½²æ–¹å¼ã€‚</p><p>ä½ ä»ç„¶å¯ä»¥é€šè¿‡ Helm Chart çš„æ–¹å¼è¿›è¡Œéƒ¨ç½²ï¼Œåœ¨éƒ¨ç½²çš„æ—¶å€™ä½ éœ€è¦é€‰æ‹©åç§°ä¸º grafana/loki-simple-scalable çš„ Helm Chartã€‚</p><p>å¾®æœåŠ¡éƒ¨ç½²æ–¹å¼é€‚ç”¨äºæ›´å¤§çš„æ—¥å¿—å­˜å‚¨è§„æ¨¡ï¼Œåœ¨éƒ¨ç½²æ—¶ä½ å¯ä»¥é€‰æ‹©åç§°ä¸º grafana/loki-distributed çš„ Helm Chartã€‚</p><h3>ä½¿ç”¨äº‘å‚å•†æ‰˜ç®¡æœåŠ¡å­˜å‚¨æ—¥å¿—</h3><p>é€šå¸¸ï¼ŒKubernetes æŒä¹…å·å­˜åœ¨æœ€å¤§å®¹é‡é™åˆ¶ï¼Œè¿™æ„å‘³ç€æ—¥å¿—å­˜å‚¨æ—©æ™šä¼šè¾¾åˆ°ä¸Šé™ã€‚æ­¤å¤–ï¼ŒPVC çš„ä»·æ ¼ç›¸å¯¹è¾ƒé«˜ï¼Œå¹¶ä¸”æ—¥å¿—æŸ¥è¯¢é¢‘ç‡ä¸é«˜ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©æ›´åŠ é€‚åˆçš„æ—¥å¿—å­˜å‚¨çš„æ–¹å¼ï¼Œä¾‹å¦‚ AWS S3 å’Œ DynamoDBã€‚</p><p>å…¶ä¸­ï¼ŒDynamoDB ç”¨äºå­˜å‚¨æ—¥å¿—ç´¢å¼•ï¼ŒS3 å¯¹è±¡å­˜å‚¨ç”¨æ¥ä¿å­˜æ—¥å¿—ï¼Œè¿™ç§æ—¥å¿—å­˜å‚¨æ–¹å¼æ²¡æœ‰å®¹é‡é™åˆ¶ï¼Œä¹Ÿä¸éœ€è¦é¢å¤–çš„ç»´æŠ¤ï¼Œåœ¨æ—¥å¿—è§„æ¨¡æ¯”è¾ƒå¤§çš„åœºæ™¯ä¸‹ï¼Œæˆ‘æ¨èä½ ç”¨è¿™ç§å­˜å‚¨æ–¹å¼ã€‚</p><p>è¦ä½¿ç”¨ S3 å’Œ DynamoDBï¼Œä½ å¯ä»¥åœ¨å®‰è£… Loki æ—¶æŒ‡å®šå­˜å‚¨æ–¹å¼ã€‚å°†ä¸‹é¢çš„å†…å®¹ä¿å­˜ä¸º s3-values.yamlã€‚</p><pre><code class=\"language-yaml\">loki:\n&nbsp; config:\n&nbsp; &nbsp; schema_config:\n&nbsp; &nbsp; &nbsp; configs:\n&nbsp; &nbsp; &nbsp; - from: 2020-05-15\n&nbsp; &nbsp; &nbsp; &nbsp; store: aws\n&nbsp; &nbsp; &nbsp; &nbsp; object_store: s3\n&nbsp; &nbsp; &nbsp; &nbsp; schema: v11\n&nbsp; &nbsp; &nbsp; &nbsp; index:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; prefix: loki_\n&nbsp; &nbsp; storage_config:\n&nbsp; &nbsp; &nbsp; aws:\n&nbsp; &nbsp; &nbsp; &nbsp; s3: s3://access_key:secret_access_key@region/bucket_name\n&nbsp; &nbsp; &nbsp; &nbsp; dynamodb:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dynamodb_url: dynamodb://access_key:secret_access_key@region\n</code></pre><p>ç„¶ååœ¨ä½¿ç”¨ Helm å®‰è£… Loki æ—¶æŒ‡å®šè¿™ä¸ªé…ç½®æ–‡ä»¶å³å¯ã€‚æ›´å¤šå…³äºå­˜å‚¨æ–¹å¼çš„é…ç½®ä½ å¯ä»¥å‚è€ƒ<a href=\"https://grafana.com/docs/loki/latest/configuration/examples/\">è¿™ä¸ªé“¾æ¥</a>ã€‚</p><h2>æ€»ç»“</h2><p>è¿™èŠ‚è¯¾æ¶‰åŠçš„çŸ¥è¯†ç‚¹æ¯”è¾ƒå¤šï¼Œæˆ‘å¸Œæœ›ä½ èƒ½å¤šèŠ±ä¸€ç‚¹æ—¶é—´æ”¾åœ¨å®æˆ˜å’ŒæŸ¥è¯¢ä¾‹å­ä¸Šï¼Œè¿™ä¼šå¸®åŠ©ä½ æ›´å¥½åœ°ä»é›¶å…¥é—¨ Lokiã€‚</p><p>ç®€å•æ€»ç»“ä¸€ä¸‹ï¼Œè¿™èŠ‚è¯¾æˆ‘å¸¦ä½ å­¦ä¹ äº†å¦‚ä½•é€šè¿‡ Loki Stack æ¥æ­å»ºæ—¥å¿—ç³»ç»Ÿã€‚åœ¨å®æˆ˜ç¯èŠ‚ï¼Œæˆ‘ä»¬éƒ¨ç½²çš„æ ¸å¿ƒç»„ä»¶åŒ…æ‹¬ Lokiã€Promtail å’Œ Grafanaã€‚å…¶ä¸­ï¼ŒLoki è´Ÿè´£æ—¥å¿—çš„å­˜å‚¨å’ŒæŸ¥è¯¢ï¼ŒPromtail è´Ÿè´£é‡‡é›† Pod æ—¥å¿—ï¼ŒGrafana æ˜¯æ—¥å¿—çš„ UI æŸ¥è¯¢ç•Œé¢ã€‚</p><p>è¦æŸ¥è¯¢æ—¥å¿—ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ LogQL è¯­å¥ï¼Œå®ƒåŒ…æ‹¬æ—¥å¿—æµé€‰æ‹©å™¨å’Œæ—¥å¿—ç®¡é“æ“ä½œã€‚å…¶ä¸­ï¼Œæ—¥å¿—æµé€‰æ‹©å™¨å†³å®šæ—¥å¿—çš„æ¥æºï¼Œæ¯”å¦‚é€šè¿‡ Kubernetes Label æ¥åŒ¹é… Pod å¯¹è±¡è·å–æ—¥å¿—ã€‚ç®¡é“æ“ä½œæ˜¯å¯¹æ—¥å¿—çš„è¿›ä¸€æ­¥å¤„ç†ï¼Œæ¯”å¦‚æŸ¥æ‰¾å…³é”®å­—ã€æŸ¥æ‰¾æ—¥å¿—çš„å­—æ®µå€¼ä»¥åŠä¸€äº›èšåˆæ“ä½œã€‚</p><p>LogQL ç¼–å†™èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥æˆ‘ä»çœŸå®çš„ä¾‹å­å‡ºå‘ï¼Œè®©ä½ è¿›ä¸€æ­¥ç†è§£ LogQL çš„èƒ½åŠ›ã€‚å…¶ä¸­ï¼Œå¯¹äºæ—¥å¿—å­—æ®µå€¼çš„æŸ¥è¯¢æ˜¯ä¸€é¡¹éå¸¸é‡è¦å¹¶ä¸”å¸¸ç”¨çš„åŠŸèƒ½ï¼Œå®ƒä¸»è¦é€šè¿‡è§£æå™¨æ¥å®ç°ï¼Œä½ å¯ä»¥åƒæŸ¥è¯¢<strong>å…³ç³»å‹æ•°æ®åº“ä¸€æ ·æ¥æŸ¥è¯¢æ—¥å¿—</strong>ã€‚ä¸è¿‡ï¼Œä½ éœ€è¦ç‰¹åˆ«æ³¨æ„ä¸šåŠ¡ç³»ç»Ÿè¾“å‡ºæ—¥å¿—çš„æ ¼å¼ï¼Œé€šå¸¸ Logfmt å’Œ JSON æ˜¯é¦–é€‰çš„æ—¥å¿—æ ¼å¼ã€‚</p><p>åœ¨ä»‹ç»å¸¸ç”¨çš„ LogQL çš„æ—¶å€™ï¼Œæˆ‘ä¸ä»…ä»‹ç»äº†æŸ¥è¯¢æ—¥å¿—çš„è¯­å¥ï¼Œè¿˜è¿›ä¸€æ­¥ä»‹ç»äº†å¦‚ä½•é€šè¿‡æ—¥å¿—æŸ¥è¯¢ HTTP è¯·æ±‚ç›¸å…³æŒ‡æ ‡ã€‚ä¸è¿‡ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œ<strong>æˆ‘ä»¬ä¸€èˆ¬ä¸è¿™ä¹ˆåš</strong>ï¼Œè€Œæ˜¯ä¼šé€šè¿‡ç½‘å…³æ¥è·å–æ›´å¤šä¸“ä¸šçš„ HTTP è¯·æ±‚ç›¸å…³æŒ‡æ ‡ï¼Œè¿™éƒ¨åˆ†çš„å†…å®¹æˆ‘å°†åœ¨ä¸‹èŠ‚è¯¾ç»§ç»­æ·±å…¥ä»‹ç»ã€‚</p><p>æ­¤å¤–ï¼Œæˆ‘è¿˜å‘ä½ ä»‹ç»äº† Loki çš„å·¥ä½œåŸç†ã€‚åœ¨è¿™éƒ¨åˆ†å†…å®¹ä¸­ï¼Œæˆ‘é¡ºä¾¿å¸®ä½ å¤ä¹ äº† Kubernetes Pod çš„æ—¥å¿—å­˜å‚¨æœºåˆ¶ä»¥åŠ Promtail é‡‡é›†æ—¥å¿—çš„åŸºæœ¬åŸç†ï¼Œå®é™…ä¸Šï¼Œä¸ç®¡æ˜¯ EFK è¿˜æ˜¯ ELK çš„æ—¥å¿—ç³»ç»Ÿï¼Œå®ƒä»¬é‡‡é›†æ—¥å¿—çš„åŸºæœ¬åŸç†éƒ½æ˜¯ç±»ä¼¼çš„ã€‚</p><p>æœ€åï¼Œæˆ‘è¿˜ä¸ºä½ æä¾›äº†å‡ ä¸ªç”Ÿäº§å»ºè®®ï¼Œä½ éœ€è¦ç‰¹åˆ«æ³¨æ„å­˜å‚¨é…ç½®å’Œ Loki çš„éƒ¨ç½²æ–¹å¼ï¼Œæå‰äº†è§£æ—¥å¿—ç³»ç»Ÿå¯èƒ½å­˜åœ¨çš„ç“¶é¢ˆã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æœ€åï¼Œç»™ä½ ç•™ä¸¤é“æ€è€ƒé¢˜å§ã€‚</p><ol>\n<li>ä»¥ç¤ºä¾‹åº”ç”¨ä¸ºä¾‹ï¼Œè¯·ä½ å°è¯•æŸ¥è¯¢ 1 å°æ—¶å†…è¯·æ±‚çŠ¶æ€ç ä¸ä¸º 200 çš„å¢é•¿é€Ÿç‡ï¼ˆrateï¼‰ï¼Œå¹¶æŒ‰çŠ¶æ€ç åˆ†ç»„ï¼ˆæç¤ºï¼šç»“åˆå¸¸ç”¨æŸ¥è¯¢ä¾‹å­ä¸­çš„ç¬¬ä¸€ä¸ªå’Œç¬¬äº”ä¸ªä¾‹å­ï¼‰ï¼›</li>\n<li>ä»¥ç¤ºä¾‹åº”ç”¨ä¸ºä¾‹ï¼Œè¯·ä½ å°è¯•æŸ¥è¯¢ 10 åˆ†é’Ÿå†…æ—¥å¿—ååé‡æœ€å¤§çš„å‰ 3 ä¸ªåº”ç”¨ç¨‹åºï¼ˆæç¤ºï¼šå‰åå¯ä»¥ç”¨ topk å‡½æ•°ï¼‰ã€‚</li>\n</ol><p>æ¬¢è¿ä½ ç»™æˆ‘ç•™è¨€äº¤æµè®¨è®ºï¼Œä½ ä¹Ÿå¯ä»¥æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ã€‚</p>","neighbors":{"left":{"article_title":"30ï½œåº”ç”¨å¥åº·ï¼šå¦‚ä½•è¿…é€Ÿåˆ¤æ–­ä¸šåŠ¡çŠ¶æ€å’Œå¯ç”¨æ€§ï¼Ÿ","id":630627},"right":{"article_title":"32ï½œç›‘æ§ï¼šå¦‚ä½•å¿«é€Ÿæ­å»ºä¸šåŠ¡ HTTP å¥åº·çŠ¶æ€ç›‘æ§ï¼Ÿ","id":631938}},"comments":[{"had_liked":false,"id":370343,"user_name":"äº‰å…‰ Alan","can_delete":false,"product_type":"c1","uid":1336328,"ip_address":"ä¸Šæµ·","ucode":"338534F909AF03","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/08/0287f41f.jpg","comment_is_top":false,"comment_ctime":1678731511,"is_pvip":false,"replies":[{"id":135065,"content":"å°è§„æ¨¡åœºæ™¯ç”¨ Lokiï¼Œå¤§è§„æ¨¡åœºæ™¯ä¸‹ ELK æŸ¥è¯¢çš„æ€§èƒ½æ¯”è¾ƒå¥½ï¼Œä½†ç´¢å¼•æ–‡ä»¶å ç”¨çš„ç©ºé—´ä¼šæ¯”è¾ƒå¤§ã€‚Splunk é‡‡é›†æ•°æ®æ¯”è¾ƒå¿«ï¼Œä½†æŸ¥è¯¢æ¯”è¾ƒæ…¢ã€‚Loki ç›¸å¯¹æ¥è¯´æ€§èƒ½æ¯”è¾ƒå‡è¡¡ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1678764757,"ip_address":"å¹¿ä¸œ","comment_id":370343,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"é’ˆå¯¹elkï¼Œsplunkï¼Œlokièƒ½è°ˆä¸€ä¸‹ä¼˜ç¼ºç‚¹å—ï¼Ÿéƒ½é€‚åˆä»€ä¹ˆåœºæ™¯\n","like_count":3,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":608993,"discussion_content":"å°è§„æ¨¡åœºæ™¯ç”¨ Lokiï¼Œå¤§è§„æ¨¡åœºæ™¯ä¸‹ ELK æŸ¥è¯¢çš„æ€§èƒ½æ¯”è¾ƒå¥½ï¼Œä½†ç´¢å¼•æ–‡ä»¶å ç”¨çš„ç©ºé—´ä¼šæ¯”è¾ƒå¤§ã€‚Splunk é‡‡é›†æ•°æ®æ¯”è¾ƒå¿«ï¼Œä½†æŸ¥è¯¢æ¯”è¾ƒæ…¢ã€‚Loki ç›¸å¯¹æ¥è¯´æ€§èƒ½æ¯”è¾ƒå‡è¡¡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678764757,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3208219,"avatar":"","nickname":"Geek_1b26d5","note":"","ucode":"0116A8F191EA01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":619323,"discussion_content":"ç°åœ¨clickhouse+vectorç”¨æ¥åšæ—¥å¿—ä¹ŸæŒºä¸é”™ï¼Œæ¯”eså­˜å‚¨ä½å¾ˆå¤šï¼ŒæŸ¥è¯¢é€Ÿåº¦ä¹Ÿæ¯”lokié«˜å¤šäº†ï¼Œæˆ‘ç°åœ¨è°ƒä¼˜lokiéƒ½æ— æ³•å¹³è¡¡429å’Œå†…å­˜oomè¿™ä¸¤ä¸ªé—®é¢˜äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1684984755,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":368933,"user_name":"Geek_28f561","can_delete":false,"product_type":"c1","uid":3541684,"ip_address":"åŒ—äº¬","ucode":"E0DEF66AC6D77F","user_header":"","comment_is_top":false,"comment_ctime":1676912819,"is_pvip":false,"replies":[{"id":134362,"content":"æ˜¯ä¸€ä¸ªä¸é”™çš„æ–¹æ¡ˆï¼ŒOSS å¯ä»¥å®ç°æ¥è¿‘æ— é™å­˜å‚¨çš„æ–¹æ¡ˆï¼ŒJuiceFS æä¾›æ–‡ä»¶ç³»ç»Ÿã€‚ä¸è¿‡éœ€è¦æ³¨æ„ä¸¤ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªæ˜¯å­˜å‚¨å·çš„æŒ‚è½½é—®é¢˜ï¼Œç¬¬äºŒä¸ªæ˜¯è¯»å–å’Œå†™å…¥é€Ÿåº¦çš„é—®é¢˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1676940082,"ip_address":"å¹¿ä¸œ","comment_id":368933,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"æ¯å¤©ä¸ŠTçº§åˆ«çš„æ—¥å¿—ï¼Œå¦‚æœä½¿ç”¨é˜¿é‡Œäº‘ï¼ŒLokiçš„å­˜å‚¨ç”¨ä»€ä¹ˆæœåŠ¡ã€‚å¼€æºçš„JuiceFS+é˜¿é‡Œçš„OSSæ€ä¹ˆæ ·ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":606092,"discussion_content":"æ˜¯ä¸€ä¸ªä¸é”™çš„æ–¹æ¡ˆï¼ŒOSS å¯ä»¥å®ç°æ¥è¿‘æ— é™å­˜å‚¨çš„æ–¹æ¡ˆï¼ŒJuiceFS æä¾›æ–‡ä»¶ç³»ç»Ÿã€‚ä¸è¿‡éœ€è¦æ³¨æ„ä¸¤ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªæ˜¯å­˜å‚¨å·çš„æŒ‚è½½é—®é¢˜ï¼Œç¬¬äºŒä¸ªæ˜¯è¯»å–å’Œå†™å…¥é€Ÿåº¦çš„é—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1676940082,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371807,"user_name":"é‚µæ¶µ","can_delete":false,"product_type":"c1","uid":1069135,"ip_address":"åŒ—äº¬","ucode":"43A16551A82F2F","user_header":"","comment_is_top":false,"comment_ctime":1680349606,"is_pvip":false,"replies":[{"id":135635,"content":"ä¸€èˆ¬å»ºè®®æŠŠæ—¥å¿—æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºä¸­ï¼Œå¦‚æœæ˜¯è¾“å‡ºæ–‡ä»¶çš„è¯å¯èƒ½ EFK æŠ€æœ¯æ ˆæ›´é€‚åˆã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1680355526,"ip_address":"å¹¿ä¸œ","comment_id":371807,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"æ–‡ä¸­æ”¶é›†çš„podçš„æ—¥å¿—æ˜¯podä¸­è¿›ç¨‹æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºçš„ï¼Œå¦‚æœpodä¸­éƒ¨ç½²çš„åº”ç”¨æ˜¯æ‰“å°æ—¥å¿—åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œè¦å¦‚ä½•æ”¶é›†æ—¥å¿—ï¼Ÿæˆ–è€…ï¼Œåœ¨å°†åº”ç”¨éƒ¨ç½²åˆ°k8sä¸­æ—¶ï¼Œæ˜¯å»ºè®®éƒ½å°†æ—¥å¿—æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":611843,"discussion_content":"ä¸€èˆ¬å»ºè®®æŠŠæ—¥å¿—æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºä¸­ï¼Œå¦‚æœæ˜¯è¾“å‡ºæ–‡ä»¶çš„è¯å¯èƒ½ EFK æŠ€æœ¯æ ˆæ›´é€‚åˆã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680355527,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":370706,"user_name":"é»‘é¹°","can_delete":false,"product_type":"c1","uid":1091316,"ip_address":"åŒ—äº¬","ucode":"D6AD9EBDC1B48D","user_header":"https://static001.geekbang.org/account/avatar/00/10/a6/f4/a9f2f104.jpg","comment_is_top":false,"comment_ctime":1679124688,"is_pvip":false,"replies":[{"id":135265,"content":"ğŸ‘ğŸ»","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1679206089,"ip_address":"å¹¿ä¸œ","comment_id":370706,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"æ€è€ƒé¢˜1ï¼š\nsum by(status) (\n  rate({app=&quot;log-example&quot;} |= `status=` | logfmt |  status != 200 [1h])\n)\n\næ€è€ƒé¢˜2ï¼š\ntopk(3, \n  sum(\n    rate({ app != &quot;&quot; } [10m])\n  ) by(app) \n)","like_count":1,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":609777,"discussion_content":"ğŸ‘ğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679206090,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":370496,"user_name":"é»‘é¹°","can_delete":false,"product_type":"c1","uid":1091316,"ip_address":"åŒ—äº¬","ucode":"D6AD9EBDC1B48D","user_header":"https://static001.geekbang.org/account/avatar/00/10/a6/f4/a9f2f104.jpg","comment_is_top":false,"comment_ctime":1678883210,"is_pvip":false,"replies":[{"id":135131,"content":"ä¸€ç§æ˜¯é€šè¿‡ K8s çš„ PVC æ¥æä¾›æŒä¹…åŒ–å­˜å‚¨ï¼Œä¸€ç§æ˜¯ä½¿ç”¨å¤–éƒ¨ S3 æ¥å­˜å‚¨é•œåƒã€‚ç”Ÿäº§ç¯å¢ƒæ¨èç”¨å¤–éƒ¨å­˜å‚¨ç³»ç»Ÿã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1678930794,"ip_address":"å¹¿ä¸œ","comment_id":370496,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"é…ç½®æŒä¹…åŒ– å’Œ æ—¥å¿—æŒä¹…åŒ–é…ç½® è¿™ä¸¤ä¸ªæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ\n\n\nloki:\n  persistence:\n    enabled: true\n    size: 500Gi\n\nä¸\n\nloki:\n  config:\n    schema_config:\n      configs:\n      - from: 2020-05-15\n        store: aws\n        object_store: s3\n        schema: v11\n        index:\n          prefix: loki_\n    storage_config:\n      aws:\n        s3: s3:&#47;&#47;access_key:secret_access_key@region&#47;bucket_name\n        dynamodb:\n          dynamodb_url: dynamodb:&#47;&#47;access_key:secret_access_key@region","like_count":1,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":609299,"discussion_content":"ä¸€ç§æ˜¯é€šè¿‡ K8s çš„ PVC æ¥æä¾›æŒä¹…åŒ–å­˜å‚¨ï¼Œä¸€ç§æ˜¯ä½¿ç”¨å¤–éƒ¨ S3 æ¥å­˜å‚¨é•œåƒã€‚ç”Ÿäº§ç¯å¢ƒæ¨èç”¨å¤–éƒ¨å­˜å‚¨ç³»ç»Ÿã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678930794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1207598,"avatar":"https://static001.geekbang.org/account/avatar/00/12/6d/2e/d265d632.jpg","nickname":"Leibniz","note":"","ucode":"357D4451A6FC3F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631677,"discussion_content":"è¯·é—®ï¼Œå­˜å‚¨æ—¥å¿—ç´¢å¼•å’Œä¿å­˜æ—¥å¿—éƒ½ç»Ÿä¸€ä½¿ç”¨minioå¯ä»¥å—ï¼Ÿæœ‰åŒå­¦åœ¨ç”Ÿäº§ç¯å¢ƒç”¨æœ¬æ–‡çš„PLGæ–¹æ¡ˆå¯¹æ¥è¿‡å¤–éƒ¨minioï¼Œèƒ½åˆ†äº«ä¸‹éƒ¨ç½²å¯¹æ¥è¿‡ç¨‹å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1699861485,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":379166,"user_name":"åˆåŒå’å•æ˜¯ä¸€å¹´å•Š","can_delete":false,"product_type":"c1","uid":1000015,"ip_address":"åŒ—äº¬","ucode":"E067320E537DEE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/42/4f/ff1ac464.jpg","comment_is_top":false,"comment_ctime":1691462893,"is_pvip":false,"replies":[{"id":138149,"content":"Grafana alert åº”è¯¥å°±å¯ä»¥æ»¡è¶³","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1691468316,"ip_address":"å¹¿ä¸œ","comment_id":379166,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"lokiå¦‚æœé…ç½®å…³é”®å­—å‘Šè­¦ï¼Œæœ‰å¯¹æ¥çš„å¼€æºæ–¹æ¡ˆå—","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":625224,"discussion_content":"Grafana alert åº”è¯¥å°±å¯ä»¥æ»¡è¶³","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1691468316,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":376843,"user_name":"Geek_d312b7","can_delete":false,"product_type":"c1","uid":3646187,"ip_address":"å¹¿ä¸œ","ucode":"8C06B10A4FCC36","user_header":"","comment_is_top":false,"comment_ctime":1687570468,"is_pvip":false,"replies":[{"id":137368,"content":"å› ä¸ºå®é™…åº”ç”¨è¾“å‡ºäº†ä¸¤ç§æ ¼å¼çš„æ—¥å¿—ï¼ŒæŸ¥è¯¢ json çš„æ—¥å¿—å¯ä»¥ç”¨ \n{app=&quot;log-example&quot;} | json | status = `200`\n\næŸ¥è¯¢ logfmt æ ¼å¼çš„æ—¥å¿—å¯ä»¥ç”¨ \n{app=&quot;log-example&quot;} | logfmt | status = `200` ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1687585422,"ip_address":"å¹¿ä¸œ","comment_id":376843,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"è¯·é—®:\n{app=&quot;log-example&quot;} |= `` æŸ¥è¯¢æ˜¾ç¤ºçš„æ—¥å¿—éƒ½æ˜¯å¸¦åæ–œçº¿ï¼ˆè½¬ä¹‰ç¬¦å·ï¼‰æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿæ¯”å¦‚ç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼Œ\n\n{\n  &quot;log&quot;: &quot;{\\&quot;duration\\&quot;:2935,\\&quot;level\\&quot;:\\&quot;info\\&quot;,\\&quot;method\\&quot;:\\&quot;GET\\&quot;,\\&quot;msg\\&quot;:\\&quot;request completed\\&quot;,\\&quot;size\\&quot;:4,\\&quot;status\\&quot;:200,\\&quot;time\\&quot;:\\&quot;2023-06-24T01:27:05Z\\&quot;,\\&quot;uri\\&quot;:\\&quot;&#47;ping\\&quot;}\\n&quot;,\n  &quot;stream&quot;: &quot;stderr&quot;,\n  &quot;time&quot;: &quot;2023-06-24T01:27:05.513473746Z&quot;\n}\n\nå¦å¤–ï¼Œcodeæ¨¡å¼ä½¿ç”¨ä¸‹é¢çš„æŸ¥è¯¢è¯­å¥ï¼Œä¸€æ¡æ—¥å¿—ä¹Ÿéƒ½æ²¡æœ‰æŸ¥è¯¢å‡ºæ¥ã€‚\n\n{app=&quot;log-example&quot;} | logfmt | status = `200`\n{app=&quot;log-example&quot;} | log | status = `200`\n\næ˜¯ä»€ä¹ˆåŸå› ï¼Ÿæ˜¯ä¸æ˜¯è·Ÿä¸Šé¢ {app=&quot;log-example&quot;} |= ``  æŸ¥å‡ºæ¥æ˜¾ç¤ºéƒ½å¸¦æœ‰è½¬ä¹‰ç¬¦å·æœ‰å…³ï¼Ÿ\n","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":621739,"discussion_content":"å› ä¸ºå®é™…åº”ç”¨è¾“å‡ºäº†ä¸¤ç§æ ¼å¼çš„æ—¥å¿—ï¼ŒæŸ¥è¯¢ json çš„æ—¥å¿—å¯ä»¥ç”¨ \n{app=&#34;log-example&#34;} | json | status = `200`\n\næŸ¥è¯¢ logfmt æ ¼å¼çš„æ—¥å¿—å¯ä»¥ç”¨ \n{app=&#34;log-example&#34;} | logfmt | status = `200` ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1687585422,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":369879,"user_name":"é»‘é¹°","can_delete":false,"product_type":"c1","uid":1091316,"ip_address":"åŒ—äº¬","ucode":"D6AD9EBDC1B48D","user_header":"https://static001.geekbang.org/account/avatar/00/10/a6/f4/a9f2f104.jpg","comment_is_top":false,"comment_ctime":1678091541,"is_pvip":false,"replies":[{"id":134827,"content":"ç”¨ {app=&quot;log-example&quot;} |= `status=` è¿™æ¡è¯­å¥èƒ½æŸ¥åˆ° logfmt æ ¼å¼è¾“å‡ºçš„æ—¥å¿—å—ï¼Ÿç¤ºä¾‹åº”ç”¨è¾“å‡ºäº† logfmt å’Œ json ä¸¤ç§æ ¼å¼çš„æ—¥å¿—ï¼Œä¹Ÿå¯ä»¥å°è¯•ç”¨ {app=&quot;log-example&quot;} | json | status = `200` è¯­å¥æ¥æŸ¥è¯¢ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1678103256,"ip_address":"å¹¿ä¸œ","comment_id":369879,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"{app=&quot;log-example&quot;} | logfmt | status = `200`\ncodeæ¨¡å¼ä½¿ç”¨ä¸Šé¢çš„æŸ¥è¯¢è¯­å¥ï¼Œä¸€æ¡æ—¥å¿—ä¹Ÿæ²¡æœ‰æŸ¥è¯¢å‡ºæ¥ã€‚\n\nç”¨ {app=&quot;log-example&quot;} |= `status=` è¿™æ¡è¯­å¥ï¼Œå¯ä»¥æŸ¥è¯¢åˆ°å¾ˆå¤š status=200çš„æ—¥å¿—ã€‚\n\nè¯·é—®ä¸‹æ˜¯æˆ‘å“ªé‡Œæ“ä½œä¸å¯¹å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":607709,"discussion_content":"ç”¨ {app=&#34;log-example&#34;} |= `status=` è¿™æ¡è¯­å¥èƒ½æŸ¥åˆ° logfmt æ ¼å¼è¾“å‡ºçš„æ—¥å¿—å—ï¼Ÿç¤ºä¾‹åº”ç”¨è¾“å‡ºäº† logfmt å’Œ json ä¸¤ç§æ ¼å¼çš„æ—¥å¿—ï¼Œä¹Ÿå¯ä»¥å°è¯•ç”¨ {app=&#34;log-example&#34;} | json | status = `200` è¯­å¥æ¥æŸ¥è¯¢ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678103256,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1091316,"avatar":"https://static001.geekbang.org/account/avatar/00/10/a6/f4/a9f2f104.jpg","nickname":"é»‘é¹°","note":"","ucode":"D6AD9EBDC1B48D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":609204,"discussion_content":"å¯ä»¥æŸ¥è¯¢åˆ°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678871257,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":368802,"user_name":"æ—‹é£","can_delete":false,"product_type":"c1","uid":1048798,"ip_address":"åŒ—äº¬","ucode":"59506F15AF3A6C","user_header":"https://static001.geekbang.org/account/avatar/00/10/00/de/5819440a.jpg","comment_is_top":false,"comment_ctime":1676728913,"is_pvip":false,"replies":[{"id":134326,"content":"æ„Ÿè°¢æŒ‡æ­£ï¼Œå·²ç»åŒæ—¶ä¸Šä¼ äº† amd64 ç‰ˆæœ¬äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1676771321,"ip_address":"å¹¿ä¸œ","comment_id":368802,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"log-exampleé•œåƒåªæ”¯æŒarmï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":605587,"discussion_content":"æ„Ÿè°¢æŒ‡æ­£ï¼Œå·²ç»åŒæ—¶ä¸Šä¼ äº† amd64 ç‰ˆæœ¬äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1676771321,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":368765,"user_name":"æ—é¾","can_delete":false,"product_type":"c1","uid":1766285,"ip_address":"å¹¿ä¸œ","ucode":"61A98DC0DC1E8A","user_header":"https://static001.geekbang.org/account/avatar/00/1a/f3/8d/402e0e0f.jpg","comment_is_top":false,"comment_ctime":1676683202,"is_pvip":false,"replies":[{"id":134314,"content":"é“¾è·¯è¿½è¸ªä¸»è¦ç”¨æ¥æŸ¥çœ‹æœåŠ¡çš„è¯·æ±‚é“¾è·¯æƒ…å†µï¼Œæ—¥å¿—ä¸»è¦ç”¨æ¥æ’æŸ¥æœåŠ¡è¾“å‡ºçš„é”™è¯¯æ—¥å¿—ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1676700527,"ip_address":"å¹¿ä¸œ","comment_id":368765,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"æƒ³é—®ä¸€ä¸‹ï¼Œé¡¹ç›®ä¸­å·²ç»æœ‰äº†é“¾è·¯çš„åŠŸèƒ½ï¼Œè¿˜éœ€è¦æ—¥å¿—å—ï¼Ÿ  é“¾è·¯è®°å½•äº†è¯·æ±‚å€¼ï¼Œå“åº”å€¼ï¼Œåªèƒ½æ‰§è¡Œçš„sqlï¼Œesã€redisçš„è¯­å¥ç­‰ã€‚","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":605516,"discussion_content":"é“¾è·¯è¿½è¸ªä¸»è¦ç”¨æ¥æŸ¥çœ‹æœåŠ¡çš„è¯·æ±‚é“¾è·¯æƒ…å†µï¼Œæ—¥å¿—ä¸»è¦ç”¨æ¥æ’æŸ¥æœåŠ¡è¾“å‡ºçš„é”™è¯¯æ—¥å¿—ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1676700527,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1766285,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/f3/8d/402e0e0f.jpg","nickname":"æ—é¾","note":"","ucode":"61A98DC0DC1E8A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":605813,"discussion_content":"å°±æ˜¯è¯´é“¾è·¯ä¸­ä¸åº”è¯¥åŒ…å«sqlã€esç­‰æ‰§è¡Œè¯­å¥ï¼Ÿè¿™äº›åº”è¯¥æ”¾åœ¨æ—¥å¿—ä¸­ï¼Œé“¾è·¯åªå­˜æ”¾è°ƒç”¨å…³ç³»åŠæˆåŠŸå¤±è´¥å€¼ï¼Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1676873992,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":389660,"user_name":"Geek_45a572","can_delete":false,"product_type":"c1","uid":3654504,"ip_address":"é™•è¥¿","ucode":"B0503B2F0D8A6D","user_header":"","comment_is_top":false,"comment_ctime":1713191027,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"Dynamicdbå­˜å•¥å‘¢ï¼Ÿè¿™ä¸ªæ¯å¤©100gæ—¥å¿—å¢é‡å¤§æ¦‚èƒ½ç”¨å¤šå°‘","like_count":0},{"had_liked":false,"id":384071,"user_name":"Leibniz","can_delete":false,"product_type":"c1","uid":1207598,"ip_address":"å¹¿ä¸œ","ucode":"357D4451A6FC3F","user_header":"https://static001.geekbang.org/account/avatar/00/12/6d/2e/d265d632.jpg","comment_is_top":false,"comment_ctime":1700217721,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"æ€ä¹ˆç ´è§£é‡†é›†ä¸åˆ°è½¯é“¾æ¥æ—¥å¿—ï¼Ÿ","like_count":0},{"had_liked":false,"id":384005,"user_name":"Leibniz","can_delete":false,"product_type":"c1","uid":1207598,"ip_address":"å¹¿ä¸œ","ucode":"357D4451A6FC3F","user_header":"https://static001.geekbang.org/account/avatar/00/12/6d/2e/d265d632.jpg","comment_is_top":false,"comment_ctime":1700095134,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¸€ä¸ªé›†ç¾¤éƒ¨ç½²ä¸€å¥—loki-stackï¼Œæ˜¯å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":3654504,"avatar":"","nickname":"Geek_45a572","note":"","ucode":"B0503B2F0D8A6D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":641982,"discussion_content":"å½“ç„¶ä¸æ˜¯ã€‚lokiå’Œgrafanaåªéœ€è¦ä¸€ä¸ª","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1713191161,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"é™•è¥¿","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383889,"user_name":"Leibniz","can_delete":false,"product_type":"c1","uid":1207598,"ip_address":"å¹¿ä¸œ","ucode":"357D4451A6FC3F","user_header":"https://static001.geekbang.org/account/avatar/00/12/6d/2e/d265d632.jpg","comment_is_top":false,"comment_ctime":1699873419,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"è¯·é—®ï¼Œå­˜å‚¨æ—¥å¿—ç´¢å¼•å’Œä¿å­˜æ—¥å¿—éƒ½ç»Ÿä¸€ä½¿ç”¨minioå¯ä»¥å—ï¼Ÿæœ‰åŒå­¦åœ¨ç”Ÿäº§ç¯å¢ƒç”¨æœ¬æ–‡çš„PLGæ–¹æ¡ˆå¯¹æ¥è¿‡å¤–éƒ¨minioï¼Œèƒ½åˆ†äº«ä¸‹éƒ¨ç½²å¯¹æ¥è¿‡ç¨‹å—ï¼Ÿ","like_count":0}]}