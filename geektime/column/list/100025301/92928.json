{"id":92928,"title":"07 | Workflow设计模式：让你在大规模数据世界中君临天下","content":"<p>你好，我是蔡元楠。</p><p>今天我要与你分享的主题是“Workflow设计模式”。</p><p>在上一讲中，我们一起学习了大规模数据处理的两种处理模式——批处理和流处理。</p><p>利用好这两种处理模式，作为架构师的你就可以运筹帷幄，根据实际需求搭建出一套符合自己应用的数据处理系统。</p><p>然而，光是掌握了这两种数据处理模式就足够自如应对大规模数据世界中的需求挑战吗？从我的实战经验中看来，其实未必。</p><p>我们每个人在最开始学习大规模数据处理的时候，可能都是以WordCount作为教学例子来进行学习的。</p><p>WordCount这个例子，只需要一个单词集合作为输入，数据处理的结果是统计单词出现的次数，中间只需要经过一次数据处理的转换，就如同下图所示。</p><p><img src=\"https://static001.geekbang.org/resource/image/1b/9c/1b82384d37d37653721613e49933359c.jpg?wh=1798*650\" alt=\"\"></p><p>但在现实的应用场景种中，各式各样的应用需求决定了大规模数据处理中的应用场景会比WordCount复杂很多倍。</p><p>我还是以我在第一讲中所提到过的例子来说明吧。</p><p>在根据活跃在街头的美团外卖电动车的数量来预测美团的股价这个例子中，我们的输入数据集有可能不止一个。</p><p>例如，会有自己团队在街道上拍摄到的美团外卖电动车图片，会有第三方公司提供的美团外卖电动车数据集等等。</p><p>整个数据处理流程又会需要至少10个处理模块，每一个处理模块的输出结果都将会成为下一个处理模块的输入数据，就如同下图所示。</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/bb/a7/bb5bac6c66bca6c3d16172046a84e5a7.jpg?wh=1898*1226\" alt=\"\"></p><p>像上面的图示一样，我们将这种由多个不同的处理模块连接在一​​起，最后得出一个自己需要结果的有向无环图（Directed Acyclic Graph/DAG），称为一个工作流系统（Workflow System）。</p><p>在工作流系统的每个处理模块里，系统要执行的操作有可能不是单单一个数据转换的操作这么简单。像在上面例子的Ingestion这个模块中，我们需要将多个不同的数据集合并在一起，也需要将不合格的一些图片过滤掉。</p><p>如果你用过Apache Spark 1.4以上的版本的话，Spark平台里面的Execution DAG就可以为你展示一个完整的工作流图。</p><p>今天，我为你解释四种工作流系统的设计模式，希望你能够很好地理解它们，并运用在自己的数据处理系统设计中。在遇到各种复杂的应用场景的时候能够从容面对。</p><h2>复制模式（Copier Pattern）</h2><p>复制模式通常是将单个数据处理模块中的数据，完整地复制到两个或更多的数据处理模块中，然后再由不同的数据处理模块进行处理。工作流系统图通常如下图所示。</p><p><img src=\"https://static001.geekbang.org/resource/image/5f/3b/5fa7f641e5d2fd2ca79644c3e3a04f3b.jpg?wh=1752*1100\" alt=\"\"></p><p>当我们在处理大规模数据时，需要对同一个数据集采取多种不同的数据处理转换，我们就可以优先考虑采用<strong>复制模式</strong>。</p><p>我来举个在YouTube视频平台中，系统处理视频数据集的一个例子吧。</p><p>我们都知道，视频平台很多时候都会提供不同分辨率的视频。4K或1080P的视频可以提供给网络带宽很高的用户。而在网络很慢的情况下，视频平台系统会自动转换成低分辨率格式的视频，像360P这样的视频给用户。</p><p>而在YouTube视频平台中，如果你将鼠标放在视频缩略图上，它会自动播放一段已经生成好的动画缩略图（Animated GIF Thumbnail ）。</p><p>不仅如此，在平台的背后，一个视频的数据集可能被自然语言理解（NLP）的数据处理模块分析，用以自动生成视频字幕；还有可能被视频分析的数据处理模块分析，用以产生更好的内容推荐系统。那么，它的整个工作流系统就会如下图所示一样。</p><p><img src=\"https://static001.geekbang.org/resource/image/33/b9/3353788330d777c427d07d2b1d65e5b9.jpg?wh=1930*926\" alt=\"\"></p><p>我们可以看到，在这个工作流系统中，每个数据处理模块的输入是相同的，而下面的5个数据处理模块都可以单独并且同步地运行处理。</p><h2>过滤模式（Filter Pattern）</h2><p>过滤模式的作用是过滤掉不符合特定条件的数据。</p><p>在数据集通过了这个数据处理模块后，数据集会缩减到只剩下符合条件的数据。工作流系统图通常如下图所示。</p><p><img src=\"https://static001.geekbang.org/resource/image/2e/6c/2ed81b389597b6de86300ef19f95bb6c.jpg?wh=1164*690\" alt=\"\"></p><p>当我们在处理大规模数据时，需要针对一个数据集中某些特定的数据采取数据处理时，我们就可以优先考虑采用<strong>过滤模式</strong>。</p><p>我举个商城会员系统的例子来解释吧。</p><p>在商城会员系统中，系统通常会根据用户的消费次数、用户消费金额还有用户的注册时间，将用户划分成不同的等级。</p><p>假设现在商城有五星会员（Five-stars Membership）、金牌会员（Golden Membership）和钻石会员（Diamond Membership）。</p><p>而系统现在打算通过邮件，只针对身份是钻石会员的用户发出钻石会员活动邀请。这个时候，我们就可以通过<strong>过滤模式</strong>，将钻石会员的用户从所有用户中筛选出来，如下图所示。</p><p><img src=\"https://static001.geekbang.org/resource/image/47/0f/47498fc9b2d41c59ffb286d84c4f220f.jpg?wh=1674*1244\" alt=\"\"></p><p>在这个工作流系统中，一个数据处理模块会将输入的数据集过滤成符合条件的数据，然后传输到下一个数据处理模块进行单独处理。</p><h2>分离模式（Splitter Pattern）</h2><p>如果你在处理数据集时并不想丢弃里面的任何数据，而是想把数据分类为不同的类别来进行处理时，你就需要用到分离模式来处理数据。它的工作流系统图通常如下图所示。</p><p><img src=\"https://static001.geekbang.org/resource/image/f2/93/f2e872adf258737f35a9121cf89fad93.jpg?wh=1490*798\" alt=\"\"></p><p>需要注意的是，分离模式并不会过滤任何数据，只是将原来的数据集分组了。</p><p>还是以刚刚商城会员系统为例。假设现在商城有五星会员、金牌会员和钻石会员。</p><p>系统现在打算通过邮件，针对<strong>全部的会员</strong>用户发出与他们身份相符的<strong>不同活动</strong>的邀请。</p><p>这个时候，我们就可以通过<strong>分离模式</strong>将用户按照会员等级分组，然后发送相应的活动内容，如下图所示。</p><p><img src=\"https://static001.geekbang.org/resource/image/c5/85/c5d84c2aab2e02cc6e1d2e9f7c40e185.jpg?wh=1902*936\" alt=\"\"></p><p>需要注意的是，在分离模式下，同样的数据其实是可以被划分到不同的数据处理模块的。</p><p><img src=\"https://static001.geekbang.org/resource/image/8b/15/8b8061a5947b7d7e32fe832290e1ab15.jpg?wh=1486*798\" alt=\"\"></p><p>数据B是可以同时划分到工作流1和工作流2中。其实这种情况挺常见的，我可以给你举个例子来解释。</p><p>在银行系统上，用户可以通过勾选以短信通知或者以邮件通知的方式来提醒用户一笔交易成功。如果用户同时勾选了短信和邮件两种方式，那么属于这个用户的交易信息既会通过短信通知的数据处理模块来处理，也会通过邮件通知数据处理模块来处理。</p><h2>合并模式（Joiner Pattern）</h2><p>合并模式会将多个不同的数据集转换集中到一起，成为一个总数据集，然后将这个总的数据集放在一个工作流中进行处理。</p><p><img src=\"https://static001.geekbang.org/resource/image/a4/4e/a4827ed21e8af58d30371e8ecf1e744e.jpg?wh=1404*970\" alt=\"\"></p><p>还是以根据活跃在街头的美团外卖电动车的数量来预测美团的股价这个例子来说吧。</p><p>数据接入这一处理模块里，我们的输入数据有自己团队在街道上拍摄到的美团外卖电动车图片和第三方公司提供的美团外卖电动车图片。</p><p>如果我们打算先整合所有数据，然后进行其它数据处理的话，工作流系统图通常如下图所示。</p><p><img src=\"https://static001.geekbang.org/resource/image/1c/ed/1c4bc9aaebc908633da174ba847999ed.jpg?wh=1882*1090\" alt=\"\"></p><h2>小结</h2><p>今天我们一起学习了在大规模数据处理中用到的四种设计模式，分别是复制模式、过滤模式、分离模式和合并模式。</p><p>在设计大规模数据处理系统的时候，我们都希望能事先设计好一个工作流系统图出来作为参考。</p><p>有了这样一个大规模数据处理的整体蓝图之后，对于我们理解不同的处理模块是如何相互关联或者对未来优化系统设计是有很大帮助的。</p><h2>思考题</h2><p>在一个航空预定系统中，我们需要处理用户注册、购买机票和出行前24小时的提醒等功能。在这整个过程中，系统的数据处理运用了哪几个设计模式呢？</p><p>欢迎你把文章分享给你的朋友。</p><p></p>","comments":[{"had_liked":false,"id":90831,"user_name":"third","can_delete":false,"product_type":"c1","uid":1025114,"ip_address":"","ucode":"9A37408A834F0B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a4/5a/e708e423.jpg","comment_is_top":false,"comment_ctime":1556681292,"is_pvip":false,"replies":[{"id":"32576","content":"总结得很好！","user_name":"作者回复","user_name_real":"Geek_88e0d7","uid":"1503187","ctime":1556701769,"ip_address":"","comment_id":90831,"utype":1}],"discussion_count":1,"race_medal":0,"score":"349449032268","product_id":100025301,"comment_content":"用户注册，入库，合并模式<br><br>购买机票，分为查询机票和购买<br><br>查询机票，读取特定机票，过滤模式<br><br>购买机票，将所有渠道的票和合并起来，合并模式<br><br>24小时提醒，过滤出这班航班的机票，过滤模式<br>发送短信和电子邮箱，复制模式之后，进行分类模式发送","like_count":82,"discussions":[{"author":{"id":1503187,"avatar":"","nickname":"Geek_88e0d7","note":"","ucode":"3E2596F3EB9165","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448681,"discussion_content":"总结得很好！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556701769,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91625,"user_name":"monkeyking","can_delete":false,"product_type":"c1","uid":1196221,"ip_address":"","ucode":"4AF7ECF79C4379","user_header":"https://static001.geekbang.org/account/avatar/00/12/40/bd/acb9d02a.jpg","comment_is_top":false,"comment_ctime":1557062828,"is_pvip":false,"replies":[{"id":"32925","content":"谢谢你的留言！感觉我又学习到了，计算机的很多底层思想确实都是相通的。","user_name":"作者回复","user_name_real":"Geek_88e0d7","uid":"1503187","ctime":1557194342,"ip_address":"","comment_id":91625,"utype":1}],"discussion_count":3,"race_medal":0,"score":"194830591148","product_id":100025301,"comment_content":"这几个模式就是sql的几个operator吗？<br>复制 → subquery<br>过滤 → where<br>分离 → group by<br>合并 → join<br>","like_count":46,"discussions":[{"author":{"id":1503187,"avatar":"","nickname":"Geek_88e0d7","note":"","ucode":"3E2596F3EB9165","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448970,"discussion_content":"谢谢你的留言！感觉我又学习到了，计算机的很多底层思想确实都是相通的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557194342,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1070154,"avatar":"https://static001.geekbang.org/account/avatar/00/10/54/4a/d8c7cacb.jpg","nickname":"徐飞","note":"","ucode":"C4A0B6D45338E1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":331749,"discussion_content":"合并-→union","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1606966476,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1443773,"avatar":"https://static001.geekbang.org/account/avatar/00/16/07/bd/00a3f6aa.jpg","nickname":"Huan","note":"","ucode":"24F1657DDEC117","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382866,"discussion_content":"分离用case when类比更加合适","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1625748489,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":90922,"user_name":"挖矿的小戈","can_delete":false,"product_type":"c1","uid":1503917,"ip_address":"","ucode":"2078A85139BD5D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/9chAb6SjxFiapSeicsAsGqzziaNlhX9d5aEt8Z0gUNsZJ9dICaDHqAypGvjv4Bx3PryHnj7OFnOXFOp7Ik21CVXEA/132","comment_is_top":false,"comment_ctime":1556723779,"is_pvip":false,"replies":[{"id":"32979","content":"谢谢大佬的答案！理解基本无误的！","user_name":"作者回复","user_name_real":"Geek_88e0d7","uid":"1503187","ctime":1557211221,"ip_address":"","comment_id":90922,"utype":1}],"discussion_count":1,"race_medal":0,"score":"113225873475","product_id":100025301,"comment_content":"1. 注册：合并模式（因为注册渠道可能会有手机号注册、邮箱注册、微信注册等等不同的渠道，所以需要合并）<br>2. 购买机票：过滤+合并（首先过滤出用户查找的航班机票信息、之后查找出符合条件的机票由于可能来自不同的渠道，所有需要合并后返回给用户）<br>3. 提醒：复制+过滤+分离<br>          过滤：根据时间、地点等因素过滤出需要给予提醒的用户 and 机票<br>          复制：有可能需要对同一份数据（勾选多种提醒方式的用户）进行不同的处理（邮件通知 or 电话通知 or 短信通知）<br>          分离：将前面过滤出的用户进行分成3组，分别对应（邮件通知 + 电话通知 +短信通知）<br>请大佬指教，理解有误没","like_count":27,"discussions":[{"author":{"id":1503187,"avatar":"","nickname":"Geek_88e0d7","note":"","ucode":"3E2596F3EB9165","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448724,"discussion_content":"谢谢大佬的答案！理解基本无误的！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557211221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":90807,"user_name":"缪斯","can_delete":false,"product_type":"c1","uid":1121861,"ip_address":"","ucode":"CF3A7ED36B107A","user_header":"https://static001.geekbang.org/account/avatar/00/11/1e/45/ebd94d28.jpg","comment_is_top":false,"comment_ctime":1556670755,"is_pvip":false,"replies":[{"id":"32990","content":"谢谢你的答案！","user_name":"作者回复","user_name_real":"Geek_88e0d7","uid":"1503187","ctime":1557216318,"ip_address":"","comment_id":90807,"utype":1}],"discussion_count":1,"race_medal":0,"score":"35916409123","product_id":100025301,"comment_content":"用户注册需要用到合并模式（不同客户端），购票过程需要用到过滤模式（对时间地点进行筛选过滤选票），提醒需要用到分离模式（进行不同渠道的分发提醒通知，如短信，电话等）。","like_count":8,"discussions":[{"author":{"id":1503187,"avatar":"","nickname":"Geek_88e0d7","note":"","ucode":"3E2596F3EB9165","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448666,"discussion_content":"谢谢你的答案！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557216318,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":137214,"user_name":"vigo","can_delete":false,"product_type":"c1","uid":1086295,"ip_address":"","ucode":"036CEE5F3FABE7","user_header":"https://static001.geekbang.org/account/avatar/00/10/93/57/3ffdfc8d.jpg","comment_is_top":false,"comment_ctime":1569654219,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18749523403","product_id":100025301,"comment_content":"秦始皇统一六国过程中都使用什么模式！","like_count":5},{"had_liked":false,"id":101250,"user_name":"nuclear","can_delete":false,"product_type":"c1","uid":1469188,"ip_address":"","ucode":"05521623A887A4","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epRUsrkh6HY63ia54D56zUWAKzBGibgUZ6ibgettorCuMYTF1VgwYKObvFjCuJia4DqLTxx9aRv5lYZRg/132","comment_is_top":false,"comment_ctime":1559750382,"is_pvip":false,"replies":[{"id":"36991","content":"谢谢你的提问，这个问题问得很好！对于有边界数据来说，也就是批处理，如果是读取两个流有速度上的误差是没有关系。如果你问的是无边界数据，那种有无止境数据的流处理的话，这里需要要求你在数据完整性和结果的延时上作出取舍了。具体的内容我会在介绍Beam的时候讲到。","user_name":"作者回复","user_name_real":"Geek_88e0d7","uid":"1503187","ctime":1560239721,"ip_address":"","comment_id":101250,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18739619566","product_id":100025301,"comment_content":"感觉合并模式可能会有问题，如果两个流有差速怎么办？","like_count":5,"discussions":[{"author":{"id":1503187,"avatar":"","nickname":"Geek_88e0d7","note":"","ucode":"3E2596F3EB9165","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452871,"discussion_content":"谢谢你的提问，这个问题问得很好！对于有边界数据来说，也就是批处理，如果是读取两个流有速度上的误差是没有关系。如果你问的是无边界数据，那种有无止境数据的流处理的话，这里需要要求你在数据完整性和结果的延时上作出取舍了。具体的内容我会在介绍Beam的时候讲到。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560239721,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117908,"user_name":"潘腾","can_delete":false,"product_type":"c1","uid":1566689,"ip_address":"","ucode":"04FEC6FFD62F43","user_header":"","comment_is_top":false,"comment_ctime":1564189839,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10154124431","product_id":100025301,"comment_content":"就spark应用而言，过滤模式可以通过filter实现，<br><br>合并模式可以通过join实现。<br><br>至于复制模式，一般来讲一个rdd在后续处理中被多次使用到，应该就算是复制模式了吧，为了提高效率，可以使用persist持久化。<br><br>分离模式就是groupByKey吧。<br><br>这四种模式在spark中还有没有其他的实现方式呢？","like_count":2},{"had_liked":false,"id":100084,"user_name":"linkzhang","can_delete":false,"product_type":"c1","uid":1344228,"ip_address":"","ucode":"4AEB5BFDAC711D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/7k4uHp6TAAWGgfEhkVHYMK2gZegn9JJU14osmhpX8qibibsV0ff5aibZI4Mt89NlYnk09lAqiaRDNuCMXH5m5oqceA/132","comment_is_top":false,"comment_ctime":1559440727,"is_pvip":false,"replies":[{"id":"36993","content":"谢谢你的留言！其实还是需要用到复制模式的，分离的过程只是将用户划分在不同的类别中。如果同一个用户需要两种或以上的方式通知，那我们就需要把同一个用户采用复制模式复制到不同的模块中去处理了。","user_name":"作者回复","user_name_real":"Geek_88e0d7","uid":"1503187","ctime":1560239956,"ip_address":"","comment_id":100084,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10149375319","product_id":100025301,"comment_content":"极客星球评论功能不好用啊（汗）<br>请问老师，看到很多回答里面都提到，提醒功能需要用到复制模式，但我理解只需要过滤和分离，过滤出需要提醒的用户后，如果一个用户需要多种方式通知，在分离的过程中是不是已经隐含了复制数据，不然上面的例子中，一个数据无法通过分离模式输入到两个处理模块","like_count":3,"discussions":[{"author":{"id":1503187,"avatar":"","nickname":"Geek_88e0d7","note":"","ucode":"3E2596F3EB9165","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452405,"discussion_content":"谢谢你的留言！其实还是需要用到复制模式的，分离的过程只是将用户划分在不同的类别中。如果同一个用户需要两种或以上的方式通知，那我们就需要把同一个用户采用复制模式复制到不同的模块中去处理了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560239956,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":100082,"user_name":"linkzhang","can_delete":false,"product_type":"c1","uid":1344228,"ip_address":"","ucode":"4AEB5BFDAC711D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/7k4uHp6TAAWGgfEhkVHYMK2gZegn9JJU14osmhpX8qibibsV0ff5aibZI4Mt89NlYnk09lAqiaRDNuCMXH5m5oqceA/132","comment_is_top":false,"comment_ctime":1559440480,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5854407776","product_id":100025301,"comment_content":"请问老师，看到很多回答里面都提到，提醒功能需要用到复制模式，但我理解只需要过滤和分离模式，过滤出需要提醒的用户后，如果一个用户勾选了多种通知方式，在分离的过程是不是已经隐含了复制数据，不然前面例子中","like_count":1},{"had_liked":false,"id":93132,"user_name":"珅剑","can_delete":false,"product_type":"c1","uid":1504220,"ip_address":"","ucode":"4290D5C140F80F","user_header":"https://static001.geekbang.org/account/avatar/00/16/f3/dc/80b0cd23.jpg","comment_is_top":false,"comment_ctime":1557405182,"is_pvip":false,"replies":[{"id":"33222","content":"谢谢你的提问！Workflow作为一种数据处理设计思想是既适用于批处理也适用于流处理的。","user_name":"作者回复","user_name_real":"Geek_88e0d7","uid":"1503187","ctime":1557428087,"ip_address":"","comment_id":93132,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5852372478","product_id":100025301,"comment_content":"workflow是否只适用于批处理？","like_count":1,"discussions":[{"author":{"id":1503187,"avatar":"","nickname":"Geek_88e0d7","note":"","ucode":"3E2596F3EB9165","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":449501,"discussion_content":"谢谢你的提问！Workflow作为一种数据处理设计思想是既适用于批处理也适用于流处理的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557428087,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91207,"user_name":"james","can_delete":false,"product_type":"c1","uid":1049208,"ip_address":"","ucode":"5701899403917C","user_header":"https://static001.geekbang.org/account/avatar/00/10/02/78/23c56bce.jpg","comment_is_top":false,"comment_ctime":1556929260,"is_pvip":false,"replies":[{"id":"32942","content":"谢谢你的答案！就问问你mq消息发丢了怎么办？","user_name":"作者回复","user_name_real":"Geek_88e0d7","uid":"1503187","ctime":1557198069,"ip_address":"","comment_id":91207,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5851896556","product_id":100025301,"comment_content":"题目用mq可以搞定，没啥模式信手拈来","like_count":1,"discussions":[{"author":{"id":1503187,"avatar":"","nickname":"Geek_88e0d7","note":"","ucode":"3E2596F3EB9165","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448844,"discussion_content":"谢谢你的答案！就问问你mq消息发丢了怎么办？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557198069,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1111899,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/5b/d2e7c2c4.jpg","nickname":"时隐时现","note":"","ucode":"DA4D622FF84920","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":26694,"discussion_content":"mq消息可以通过各个产品的参数设置保证数据0丢失吧，比如kafka，如果是producer发消息了没有响应，可以重试发送，在broker端去重即可，broker端发消息没有收到consumer的响应，同理","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570613929,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":90811,"user_name":"明翼","can_delete":false,"product_type":"c1","uid":1068361,"ip_address":"","ucode":"E77F86BEB3D5C1","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","comment_is_top":false,"comment_ctime":1556672068,"is_pvip":false,"replies":[{"id":"32577","content":"总结得不错！","user_name":"作者回复","user_name_real":"Geek_88e0d7","uid":"1503187","ctime":1556701831,"ip_address":"","comment_id":90811,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5851639364","product_id":100025301,"comment_content":"注册如果多个系统对新用户都处理就复制，如果按照区域注册可能是分离模式，购买不知道是否有根据会员等级提供不同服务的如果有那就分离，买不同地方这个高并发先过滤到不同机器？至于通知，合并模式多个购买渠道信息合并一起通知所有用户","like_count":1,"discussions":[{"author":{"id":1503187,"avatar":"","nickname":"Geek_88e0d7","note":"","ucode":"3E2596F3EB9165","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448669,"discussion_content":"总结得不错！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556701831,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":90804,"user_name":"朱同学","can_delete":false,"product_type":"c1","uid":1514233,"ip_address":"","ucode":"2EF7D5A051712C","user_header":"https://static001.geekbang.org/account/avatar/00/17/1a/f9/180f347a.jpg","comment_is_top":false,"comment_ctime":1556668598,"is_pvip":false,"replies":[{"id":"32992","content":"谢谢你的答案，分析得很不错！","user_name":"作者回复","user_name_real":"Geek_88e0d7","uid":"1503187","ctime":1557217349,"ip_address":"","comment_id":90804,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5851635894","product_id":100025301,"comment_content":"如果用户从注册到购买到提醒是一个工作流的话，那么注册到购买是合并模式，因为并发的购买请求可能需要进入队列排队，到提醒的话，考虑到推送实时性，我会选择分类模式，如果系统按照整分钟推送，我会将未来几天的每分钟作为一个分类，下单处理完成后，我会把新的订单集合通过复制模式分发给不同的处理分支，推送只是其中的一个分支，推送提醒处理就是把订单分到以分钟为单位分类中，到了整分推送时间直接推送对应的分类即可。","like_count":1,"discussions":[{"author":{"id":1503187,"avatar":"","nickname":"Geek_88e0d7","note":"","ucode":"3E2596F3EB9165","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448664,"discussion_content":"谢谢你的答案，分析得很不错！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557217349,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":260160,"user_name":"技术修行者","can_delete":false,"product_type":"c1","uid":1013147,"ip_address":"","ucode":"28CA41A1214D6B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/75/9b/611e74ab.jpg","comment_is_top":false,"comment_ctime":1604932675,"is_pvip":true,"discussion_count":1,"race_medal":1,"score":"1604932675","product_id":100025301,"comment_content":"看了大家的留言，感觉分析的好全面！<br><br>用户注册，考虑不同类型的接入端，使用合并模式。<br><br>购票，过滤模式加合并模式。<br><br>航班提醒，分类模式。","like_count":0,"discussions":[{"author":{"id":1013147,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/75/9b/611e74ab.jpg","nickname":"技术修行者","note":"","ucode":"28CA41A1214D6B","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":323422,"discussion_content":"最后航班提醒应该是复制模式加分离模式。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604932751,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":202260,"user_name":"Siping","can_delete":false,"product_type":"c1","uid":1487971,"ip_address":"","ucode":"48E685333C663D","user_header":"https://static001.geekbang.org/account/avatar/00/16/b4/63/21902253.jpg","comment_is_top":false,"comment_ctime":1585945556,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585945556","product_id":100025301,"comment_content":"这个系列不错","like_count":0},{"had_liked":false,"id":187784,"user_name":"Eden2020","can_delete":false,"product_type":"c1","uid":1899158,"ip_address":"","ucode":"0DEE62F2335237","user_header":"https://static001.geekbang.org/account/avatar/00/1c/fa/96/4a7b7505.jpg","comment_is_top":false,"comment_ctime":1584241123,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584241123","product_id":100025301,"comment_content":"过滤模式和分离模式，针对不同用户进行分离处理，分离前先过滤出不同用户","like_count":0},{"had_liked":false,"id":169134,"user_name":"wang","can_delete":false,"product_type":"c1","uid":1270262,"ip_address":"","ucode":"C1A3BCACCB188E","user_header":"https://static001.geekbang.org/account/avatar/00/13/61/f6/1d6b548a.jpg","comment_is_top":false,"comment_ctime":1578278917,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578278917","product_id":100025301,"comment_content":"思考题：我的理解是，还是一个本质，数据集的来源，和数据集的去向去判断设计模式，用户注册的行为可以涉及到的数据集是一个实时首页的航班信息展示，那么是filter mode，从全量的航班信息数据集中找到当前时间段的满足需求的数据集， 购买机票可能涉及到就是某一个条件的数据集合展示，那么可以是filter mode，或者是正对一个相对全量的数据集合，进行多维度的分离，比如按照时间段的处理到一个数据集合，又或者按照价格处理到一个数据集，那么就是splitter mode， 出行前的24小时提醒，数据集来源是所有购买了票的用户，通过时间段的处理filter 到满足某一个时间前24小时这个条件的用户集合，然后进行提醒，这是filter mode，除此之外，对于join mode 的划分还是取决于是否有多个数据源集合的条件，比如一个航空系统的航班信息的设置，是需要收集各种维度的数据决定的，比如其他航空公司的路线数据，天气等数据，这些数据的某一些相同的维度可以join 进行设置该系统的航班信息。","like_count":0},{"had_liked":false,"id":107450,"user_name":"风中花","can_delete":false,"product_type":"c1","uid":1085237,"ip_address":"","ucode":"067E0A1E116844","user_header":"https://static001.geekbang.org/account/avatar/00/10/8f/35/f1839bb2.jpg","comment_is_top":false,"comment_ctime":1561538100,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561538100","product_id":100025301,"comment_content":"老师这么一分析，我们这个机票预定流程。就包含了四种模式。真是仔细一想，还就是这个模式。不学习，永远不知道有这样的模式，我们一直在走着这样的模式。真是生在模式中不知模式。","like_count":0},{"had_liked":false,"id":107448,"user_name":"风中花","can_delete":false,"product_type":"c1","uid":1085237,"ip_address":"","ucode":"067E0A1E116844","user_header":"https://static001.geekbang.org/account/avatar/00/10/8f/35/f1839bb2.jpg","comment_is_top":false,"comment_ctime":1561537856,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561537856","product_id":100025301,"comment_content":"看来同学们得分析，确实学到了！ 购买机票 过程是登录-&gt;验证有效性-&gt;查询 -&gt; 选择-&gt;验证选择-验证用户有效性-&gt;购买 结束 。 登录和验证 就是一个过滤   查询 就是一个先复制 因为一份查询到多个平台拿数据。其次过滤 在合并 返回给用户  。用户选择如果不同平台数据必将涉及一个 多平台得预定 所以有一个 数据分离到不同平台预定 然后返回合并返回给用户。机票预定我想也就这么多流程了，至少现在我们现在是这样的，哈哈","like_count":0},{"had_liked":false,"id":92104,"user_name":"长大的肚腩","can_delete":false,"product_type":"c1","uid":1002954,"ip_address":"","ucode":"7FBF297618B0FF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4d/ca/a379f032.jpg","comment_is_top":false,"comment_ctime":1557188999,"is_pvip":false,"replies":[{"id":"32906","content":"谢谢你的留言！如果只针对注册的场景确实可以有不同的处理方式，如果用MQ的话你可能还需要log一些失败的case再重新处理。","user_name":"作者回复","user_name_real":"Geek_88e0d7","uid":"1503187","ctime":1557190165,"ip_address":"","comment_id":92104,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1557188999","product_id":100025301,"comment_content":"可能原始数据源的物理存储位置不同需要用合并模式，但如果针对这个注册的场景，不同渠道我们一般不用模式吧，直接一个canal同步数据库binlog日志到MQ就可以了吧。","like_count":0,"discussions":[{"author":{"id":1503187,"avatar":"","nickname":"Geek_88e0d7","note":"","ucode":"3E2596F3EB9165","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":449148,"discussion_content":"谢谢你的留言！如果只针对注册的场景确实可以有不同的处理方式，如果用MQ的话你可能还需要log一些失败的case再重新处理。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557190165,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91896,"user_name":"来碗绿豆汤","can_delete":false,"product_type":"c1","uid":1070051,"ip_address":"","ucode":"B0AB63B8D9729F","user_header":"https://static001.geekbang.org/account/avatar/00/10/53/e3/39dcfb11.jpg","comment_is_top":false,"comment_ctime":1557129987,"is_pvip":false,"replies":[{"id":"32893","content":"谢谢你的答案，你的理解我也赞同！","user_name":"作者回复","user_name_real":"Geek_88e0d7","uid":"1503187","ctime":1557188116,"ip_address":"","comment_id":91896,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1557129987","product_id":100025301,"comment_content":"用户注册完之后，并不一定所有用户都马上买票，所有这里需要一个过滤模式过滤掉没有买票的用户；之后需要一个分离模式，根据用户出行时间分组，发送通知","like_count":0,"discussions":[{"author":{"id":1503187,"avatar":"","nickname":"Geek_88e0d7","note":"","ucode":"3E2596F3EB9165","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":449071,"discussion_content":"谢谢你的答案，你的理解我也赞同！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557188116,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91604,"user_name":"不贰过先生","can_delete":false,"product_type":"c1","uid":1496958,"ip_address":"","ucode":"B208B8DF5FA109","user_header":"https://static001.geekbang.org/account/avatar/00/16/d7/7e/6b6384e9.jpg","comment_is_top":false,"comment_ctime":1557059523,"is_pvip":false,"replies":[{"id":"32977","content":"谢谢你的答案！","user_name":"作者回复","user_name_real":"Geek_88e0d7","uid":"1503187","ctime":1557209679,"ip_address":"","comment_id":91604,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1557059523","product_id":100025301,"comment_content":"用户注册是会将用户信息用于多个不同的工作流属于复制模式；<br>购买机票：用户会根据自己要求查询特定时间和地点的机票这是过滤模式，买票完毕后会发生合并模式，即通过合并模式让可卖的总机票数减一；<br>出行前24小时提醒，用户可选择多种提醒方式的一种或多种属于分离模式。","like_count":0,"discussions":[{"author":{"id":1503187,"avatar":"","nickname":"Geek_88e0d7","note":"","ucode":"3E2596F3EB9165","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448963,"discussion_content":"谢谢你的答案！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557209679,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91095,"user_name":"zhihai.tu","can_delete":false,"product_type":"c1","uid":1045888,"ip_address":"","ucode":"61371EA3EF6988","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f5/80/baddf03b.jpg","comment_is_top":false,"comment_ctime":1556853997,"is_pvip":true,"replies":[{"id":"32968","content":"谢谢你的答案！分析得很到位啊！","user_name":"作者回复","user_name_real":"Geek_88e0d7","uid":"1503187","ctime":1557205773,"ip_address":"","comment_id":91095,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1556853997","product_id":100025301,"comment_content":"1、用户注册：使用到了合并模式，系统需要整合网页端注册的用户以及手机端app注册的用户。<br>2、购买机票：使用到了分离模式，系统根据不同的用户等级，分离出来各个群体，针对不同群体提供不同的折扣力度。同样使用到了过滤模式，例如享有招行信用卡支付优惠2%。<br>3、出行前24小时提醒：使用到了分离模式，提供短信提醒、邮件提醒、电话提醒等服务。","like_count":0,"discussions":[{"author":{"id":1503187,"avatar":"","nickname":"Geek_88e0d7","note":"","ucode":"3E2596F3EB9165","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448801,"discussion_content":"谢谢你的答案！分析得很到位啊！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557205773,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91055,"user_name":"Liu C.","can_delete":false,"product_type":"c1","uid":1504607,"ip_address":"","ucode":"29F3988DD8128A","user_header":"https://static001.geekbang.org/account/avatar/00/16/f5/5f/217c6a14.jpg","comment_is_top":false,"comment_ctime":1556839308,"is_pvip":false,"replies":[{"id":"32993","content":"谢谢你的答案，分析得不错！","user_name":"作者回复","user_name_real":"Geek_88e0d7","uid":"1503187","ctime":1557217386,"ip_address":"","comment_id":91055,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1556839308","product_id":100025301,"comment_content":"注册：合并模式，把用户合并起来储存<br>购票：分离模式，把用户按照机票分类，之后合并模式进行储存<br>24小时提醒：过滤模式过滤出需要提醒的用户，之后分离模式，按照所需的提醒方式分类提醒","like_count":0,"discussions":[{"author":{"id":1503187,"avatar":"","nickname":"Geek_88e0d7","note":"","ucode":"3E2596F3EB9165","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448782,"discussion_content":"谢谢你的答案，分析得不错！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557217386,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":90904,"user_name":"罗钛龙","can_delete":false,"product_type":"c1","uid":1259075,"ip_address":"","ucode":"10B546AEAA8D08","user_header":"https://static001.geekbang.org/account/avatar/00/13/36/43/b89372d1.jpg","comment_is_top":false,"comment_ctime":1556719418,"is_pvip":false,"replies":[{"id":"32980","content":"谢谢你的答案！","user_name":"作者回复","user_name_real":"Geek_88e0d7","uid":"1503187","ctime":1557211247,"ip_address":"","comment_id":90904,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1556719418","product_id":100025301,"comment_content":"注册～复制模式<br>购票～过滤模式<br>提醒～合并&#47;过滤模式","like_count":0,"discussions":[{"author":{"id":1503187,"avatar":"","nickname":"Geek_88e0d7","note":"","ucode":"3E2596F3EB9165","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448716,"discussion_content":"谢谢你的答案！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557211247,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":90848,"user_name":"段斌","can_delete":false,"product_type":"c1","uid":1173578,"ip_address":"","ucode":"B5A85C6AF139B4","user_header":"https://static001.geekbang.org/account/avatar/00/11/e8/4a/c2a539a0.jpg","comment_is_top":false,"comment_ctime":1556687792,"is_pvip":false,"replies":[{"id":"32572","content":"分析得不错，另外我觉得用户注册和注册成功这两步可以合并为一步。","user_name":"作者回复","user_name_real":"Geek_88e0d7","uid":"1503187","ctime":1556699125,"ip_address":"","comment_id":90848,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1556687792","product_id":100025301,"comment_content":"用户注册（复制注册服务）-&gt;注册成功（过滤成功注册用户）-&gt;购买机票（合并购买动作）-&gt;购买机票成功（过滤成功购买用户）-&gt;出行前24小时提醒（分离提醒消息系统）<br><br>请元楠给个反馈，评估当前的认知是否正确","like_count":0,"discussions":[{"author":{"id":1503187,"avatar":"","nickname":"Geek_88e0d7","note":"","ucode":"3E2596F3EB9165","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448689,"discussion_content":"分析得不错，另外我觉得用户注册和注册成功这两步可以合并为一步。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556699125,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":90810,"user_name":"时间是最真的答案","can_delete":false,"product_type":"c1","uid":1183601,"ip_address":"","ucode":"B90F3EF769F865","user_header":"https://static001.geekbang.org/account/avatar/00/12/0f/71/9273e8a4.jpg","comment_is_top":false,"comment_ctime":1556671486,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556671486","product_id":100025301,"comment_content":"出行前24小时的提醒用到了过滤模式","like_count":0}]}