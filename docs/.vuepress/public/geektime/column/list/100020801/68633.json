{"id":68633,"title":"02  | 日志系统：一条SQL更新语句是如何执行的？","content":"<p>前面我们系统了解了一个查询语句的执行流程，并介绍了执行过程中涉及的处理模块。相信你还记得，一条查询语句的执行过程一般是经过连接器、分析器、优化器、执行器等功能模块，最后到达存储引擎。</p><p>那么，一条更新语句的执行流程又是怎样的呢？</p><p>之前你可能经常听DBA同事说，MySQL可以恢复到半个月内任意一秒的状态，惊叹的同时，你是不是心中也会不免会好奇，这是怎样做到的呢？</p><p>我们还是从一个表的一条更新语句说起，下面是这个表的创建语句，这个表有一个主键ID和一个整型字段c：</p><pre><code>mysql&gt; create table T(ID int primary key, c int);\n</code></pre><p>如果要将ID=2这一行的值加1，SQL语句就会这么写：</p><pre><code>mysql&gt; update T set c=c+1 where ID=2;\n</code></pre><p>前面我有跟你介绍过SQL语句基本的执行链路，这里我再把那张图拿过来，你也可以先简单看看这个图回顾下。首先，可以确定的说，查询语句的那一套流程，更新语句也是同样会走一遍。</p><p><img src=\"https://static001.geekbang.org/resource/image/0d/d9/0d2070e8f84c4801adbfa03bda1f98d9.png?wh=1920*1440\" alt=\"\"></p><center><span class=\"reference\">MySQL的逻辑架构图</span></center><p>你执行语句前要先连接数据库，这是连接器的工作。</p><p>前面我们说过，在一个表上有更新的时候，跟这个表有关的查询缓存会失效，所以这条语句就会把表T上所有缓存结果都清空。这也就是我们一般不建议使用查询缓存的原因。</p><p>接下来，分析器会通过词法和语法解析知道这是一条更新语句。优化器决定要使用ID这个索引。然后，执行器负责具体执行，找到这一行，然后更新。</p><!-- [[[read_end]]] --><p>与查询流程不一样的是，更新流程还涉及两个重要的日志模块，它们正是我们今天要讨论的主角：redo log（重做日志）和 binlog（归档日志）。如果接触MySQL，那这两个词肯定是绕不过的，我后面的内容里也会不断地和你强调。不过话说回来，redo log和binlog在设计上有很多有意思的地方，这些设计思路也可以用到你自己的程序里。</p><h1>重要的日志模块：redo log</h1><p>不知道你还记不记得《孔乙己》这篇文章，酒店掌柜有一个粉板，专门用来记录客人的赊账记录。如果赊账的人不多，那么他可以把顾客名和账目写在板上。但如果赊账的人多了，粉板总会有记不下的时候，这个时候掌柜一定还有一个专门记录赊账的账本。</p><p>如果有人要赊账或者还账的话，掌柜一般有两种做法：</p><ul>\n<li>一种做法是直接把账本翻出来，把这次赊的账加上去或者扣除掉；</li>\n<li>另一种做法是先在粉板上记下这次的账，等打烊以后再把账本翻出来核算。</li>\n</ul><p>在生意红火柜台很忙时，掌柜一定会选择后者，因为前者操作实在是太麻烦了。首先，你得找到这个人的赊账总额那条记录。你想想，密密麻麻几十页，掌柜要找到那个名字，可能还得带上老花镜慢慢找，找到之后再拿出算盘计算，最后再将结果写回到账本上。</p><p>这整个过程想想都麻烦。相比之下，还是先在粉板上记一下方便。你想想，如果掌柜没有粉板的帮助，每次记账都得翻账本，效率是不是低得让人难以忍受？</p><p>同样，在MySQL里也有这个问题，如果每一次的更新操作都需要写进磁盘，然后磁盘也要找到对应的那条记录，然后再更新，整个过程IO成本、查找成本都很高。为了解决这个问题，MySQL的设计者就用了类似酒店掌柜粉板的思路来提升更新效率。</p><p>而粉板和账本配合的整个过程，其实就是MySQL里经常说到的WAL技术，WAL的全称是Write-Ahead Logging，它的关键点就是先写日志，再写磁盘，也就是先写粉板，等不忙的时候再写账本。</p><p>具体来说，当有一条记录需要更新的时候，InnoDB引擎就会先把记录写到redo log（粉板）里面，并更新内存，这个时候更新就算完成了。同时，InnoDB引擎会在适当的时候，将这个操作记录更新到磁盘里面，而这个更新往往是在系统比较空闲的时候做，这就像打烊以后掌柜做的事。</p><p>如果今天赊账的不多，掌柜可以等打烊后再整理。但如果某天赊账的特别多，粉板写满了，又怎么办呢？这个时候掌柜只好放下手中的活儿，把粉板中的一部分赊账记录更新到账本中，然后把这些记录从粉板上擦掉，为记新账腾出空间。</p><p>与此类似，InnoDB的redo log是固定大小的，比如可以配置为一组4个文件，每个文件的大小是1GB，那么这块“粉板”总共就可以记录4GB的操作。从头开始写，写到末尾就又回到开头循环写，如下面这个图所示。</p><p><img src=\"https://static001.geekbang.org/resource/image/16/a7/16a7950217b3f0f4ed02db5db59562a7.png?wh=1142*856\" alt=\"\"></p><p>write pos是当前记录的位置，一边写一边后移，写到第3号文件末尾后就回到0号文件开头。checkpoint是当前要擦除的位置，也是往后推移并且循环的，擦除记录前要把记录更新到数据文件。</p><p>write pos和checkpoint之间的是“粉板”上还空着的部分，可以用来记录新的操作。如果write pos追上checkpoint，表示“粉板”满了，这时候不能再执行新的更新，得停下来先擦掉一些记录，把checkpoint推进一下。</p><p>有了redo log，InnoDB就可以保证即使数据库发生异常重启，之前提交的记录都不会丢失，这个能力称为<strong>crash-safe</strong>。</p><p>要理解crash-safe这个概念，可以想想我们前面赊账记录的例子。只要赊账记录记在了粉板上或写在了账本上，之后即使掌柜忘记了，比如突然停业几天，恢复生意后依然可以通过账本和粉板上的数据明确赊账账目。</p><h1>重要的日志模块：binlog</h1><p>前面我们讲过，MySQL整体来看，其实就有两块：一块是Server层，它主要做的是MySQL功能层面的事情；还有一块是引擎层，负责存储相关的具体事宜。上面我们聊到的粉板redo log是InnoDB引擎特有的日志，而Server层也有自己的日志，称为binlog（归档日志）。</p><p>我想你肯定会问，为什么会有两份日志呢？</p><p>因为最开始MySQL里并没有InnoDB引擎。MySQL自带的引擎是MyISAM，但是MyISAM没有crash-safe的能力，binlog日志只能用于归档。而InnoDB是另一个公司以插件形式引入MySQL的，既然只依靠binlog是没有crash-safe能力的，所以InnoDB使用另外一套日志系统——也就是redo log来实现crash-safe能力。</p><p>这两种日志有以下三点不同。</p><ol>\n<li>\n<p>redo log是InnoDB引擎特有的；binlog是MySQL的Server层实现的，所有引擎都可以使用。</p>\n</li>\n<li>\n<p>redo log是物理日志，记录的是“在某个数据页上做了什么修改”；binlog是逻辑日志，记录的是这个语句的原始逻辑，比如“给ID=2这一行的c字段加1 ”。</p>\n</li>\n<li>\n<p>redo log是循环写的，空间固定会用完；binlog是可以追加写入的。“追加写”是指binlog文件写到一定大小后会切换到下一个，并不会覆盖以前的日志。</p>\n</li>\n</ol><p>有了对这两个日志的概念性理解，我们再来看执行器和InnoDB引擎在执行这个简单的update语句时的内部流程。</p><ol>\n<li>\n<p>执行器先找引擎取ID=2这一行。ID是主键，引擎直接用树搜索找到这一行。如果ID=2这一行所在的数据页本来就在内存中，就直接返回给执行器；否则，需要先从磁盘读入内存，然后再返回。</p>\n</li>\n<li>\n<p>执行器拿到引擎给的行数据，把这个值加上1，比如原来是N，现在就是N+1，得到新的一行数据，再调用引擎接口写入这行新数据。</p>\n</li>\n<li>\n<p>引擎将这行新数据更新到内存中，同时将这个更新操作记录到redo log里面，此时redo log处于prepare状态。然后告知执行器执行完成了，随时可以提交事务。</p>\n</li>\n<li>\n<p>执行器生成这个操作的binlog，并把binlog写入磁盘。</p>\n</li>\n<li>\n<p>执行器调用引擎的提交事务接口，引擎把刚刚写入的redo log改成提交（commit）状态，更新完成。</p>\n</li>\n</ol><p>这里我给出这个update语句的执行流程图，图中浅色框表示是在InnoDB内部执行的，深色框表示是在执行器中执行的。</p><p><img src=\"https://static001.geekbang.org/resource/image/2e/be/2e5bff4910ec189fe1ee6e2ecc7b4bbe.png?wh=1142*1522\" alt=\"\"></p><center><span class=\"reference\">update语句执行流程</span></center><p>你可能注意到了，最后三步看上去有点“绕”，将redo log的写入拆成了两个步骤：prepare和commit，这就是\"两阶段提交\"。</p><h1>两阶段提交</h1><p>为什么必须有“两阶段提交”呢？这是为了让两份日志之间的逻辑一致。要说明这个问题，我们得从文章开头的那个问题说起：<strong>怎样让数据库恢复到半个月内任意一秒的状态？</strong></p><p>前面我们说过了，binlog会记录所有的逻辑操作，并且是采用“追加写”的形式。如果你的DBA承诺说半个月内可以恢复，那么备份系统中一定会保存最近半个月的所有binlog，同时系统会定期做整库备份。这里的“定期”取决于系统的重要性，可以是一天一备，也可以是一周一备。</p><p>当需要恢复到指定的某一秒时，比如某天下午两点发现中午十二点有一次误删表，需要找回数据，那你可以这么做：</p><ul>\n<li>首先，找到最近的一次全量备份，如果你运气好，可能就是昨天晚上的一个备份，从这个备份恢复到临时库；</li>\n<li>然后，从备份的时间点开始，将备份的binlog依次取出来，重放到中午误删表之前的那个时刻。</li>\n</ul><p>这样你的临时库就跟误删之前的线上库一样了，然后你可以把表数据从临时库取出来，按需要恢复到线上库去。</p><p>好了，说完了数据恢复过程，我们回来说说，为什么日志需要“两阶段提交”。这里不妨用反证法来进行解释。</p><p>由于redo log和binlog是两个独立的逻辑，如果不用两阶段提交，要么就是先写完redo log再写binlog，或者采用反过来的顺序。我们看看这两种方式会有什么问题。</p><p>仍然用前面的update语句来做例子。假设当前ID=2的行，字段c的值是0，再假设执行update语句过程中在写完第一个日志后，第二个日志还没有写完期间发生了crash，会出现什么情况呢？</p><ol>\n<li>\n<p><strong>先写redo log后写binlog</strong>。假设在redo log写完，binlog还没有写完的时候，MySQL进程异常重启。由于我们前面说过的，redo log写完之后，系统即使崩溃，仍然能够把数据恢复回来，所以恢复后这一行c的值是1。<br>\n但是由于binlog没写完就crash了，这时候binlog里面就没有记录这个语句。因此，之后备份日志的时候，存起来的binlog里面就没有这条语句。<br>\n然后你会发现，如果需要用这个binlog来恢复临时库的话，由于这个语句的binlog丢失，这个临时库就会少了这一次更新，恢复出来的这一行c的值就是0，与原库的值不同。</p>\n</li>\n<li>\n<p><strong>先写binlog后写redo log</strong>。如果在binlog写完之后crash，由于redo log还没写，崩溃恢复以后这个事务无效，所以这一行c的值是0。但是binlog里面已经记录了“把c从0改成1”这个日志。所以，在之后用binlog来恢复的时候就多了一个事务出来，恢复出来的这一行c的值就是1，与原库的值不同。</p>\n</li>\n</ol><p>可以看到，如果不使用“两阶段提交”，那么数据库的状态就有可能和用它的日志恢复出来的库的状态不一致。</p><p>你可能会说，这个概率是不是很低，平时也没有什么动不动就需要恢复临时库的场景呀？</p><p>其实不是的，不只是误操作后需要用这个过程来恢复数据。当你需要扩容的时候，也就是需要再多搭建一些备库来增加系统的读能力的时候，现在常见的做法也是用全量备份加上应用binlog来实现的，这个“不一致”就会导致你的线上出现主从数据库不一致的情况。</p><p>简单说，redo log和binlog都可以用于表示事务的提交状态，而两阶段提交就是让这两个状态保持逻辑上的一致。</p><h1>小结</h1><p>今天，我介绍了MySQL里面最重要的两个日志，即物理日志redo log和逻辑日志binlog。</p><p>redo log用于保证crash-safe能力。innodb_flush_log_at_trx_commit这个参数设置成1的时候，表示每次事务的redo log都直接持久化到磁盘。这个参数我建议你设置成1，这样可以保证MySQL异常重启之后数据不丢失。</p><p>sync_binlog这个参数设置成1的时候，表示每次事务的binlog都持久化到磁盘。这个参数我也建议你设置成1，这样可以保证MySQL异常重启之后binlog不丢失。</p><p>我还跟你介绍了与MySQL日志系统密切相关的“两阶段提交”。两阶段提交是跨系统维持数据逻辑一致性时常用的一个方案，即使你不做数据库内核开发，日常开发中也有可能会用到。</p><p>文章的最后，我给你留一个思考题吧。前面我说到定期全量备份的周期“取决于系统重要性，有的是一天一备，有的是一周一备”。那么在什么场景下，一天一备会比一周一备更有优势呢？或者说，它影响了这个数据库系统的哪个指标？</p><p>你可以把你的思考和观点写在留言区里，我会在下一篇文章的末尾给出我的答案。</p><p>感谢你的收听，也欢迎你把这篇文章分享给更多的朋友一起阅读。</p><p></p>","neighbors":{"left":{"article_title":"01 | 基础架构：一条SQL查询语句是如何执行的？","id":68319},"right":{"article_title":"03 | 事务隔离：为什么你改了我还看不见？","id":68963}},"comments":[{"had_liked":false,"id":39549,"user_name":"super blue cat","can_delete":false,"product_type":"c1","uid":1078411,"ip_address":"","ucode":"27DBB28EF19AB3","user_header":"https://static001.geekbang.org/account/avatar/00/10/74/8b/840afbd8.jpg","comment_is_top":true,"comment_ctime":1542300599,"is_pvip":false,"replies":[{"id":"14153","content":"Redo log不是记录数据页“更新之后的状态”，而是记录这个页 “做了什么改动”。<br><br>Binlog有两种模式，statement 格式的话是记sql语句， row格式会记录行的内容，记两条，更新前和更新后都有。<br>（谢谢你提这个问题，为了不打断文章思路，这个点没在正文写，但是又是很重要的点😄😄）","user_name":"作者回复","comment_id":39549,"uid":"1264162","ip_address":"","utype":1,"ctime":1542301166,"user_name_real":"林晓斌"}],"discussion_count":80,"race_medal":0,"score":"9.2233769947893002e+18","product_id":100020801,"comment_content":"我可以认为redo log 记录的是这个行在这个页更新之后的状态，binlog 记录的是sql吗？","like_count":1155,"discussions":[{"author":{"id":1810051,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK0uyg1IicbEhLwsgM2A2ROoyVdWdmUqZfQfs6G67w9m3hdRNBMOQJatQoACj3qNGgj2KVIgricaYiaQ/132","nickname":"木得感情的编码机器","note":"","ucode":"9C6CD47ADCB8E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164263,"discussion_content":"SQL是面向用户的语义化命令，你可以理解为高级编程语言。高级编程语言最终会被执行去完成磁盘上数据的操作。我理解redo log记录的是磁盘上数据的物理变化，binlog记录的是当时所执行的高级编程语言。","likes_number":76,"is_delete":false,"is_hidden":false,"ctime":1581165717,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":6,"child_discussions":[{"author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"一元(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1810051,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK0uyg1IicbEhLwsgM2A2ROoyVdWdmUqZfQfs6G67w9m3hdRNBMOQJatQoACj3qNGgj2KVIgricaYiaQ/132","nickname":"木得感情的编码机器","note":"","ucode":"9C6CD47ADCB8E6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301026,"discussion_content":"你是我觉得说得最有道理的，这老师讲得是一头雾水，佛了！","likes_number":9,"is_delete":false,"is_hidden":false,"ctime":1598368123,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":164263,"ip_address":""},"score":301026,"extra":""},{"author":{"id":1503506,"avatar":"https://static001.geekbang.org/account/avatar/00/16/f1/12/7dac30d6.jpg","nickname":"你为啥那么牛","note":"","ucode":"1ABC604A54A8F6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"一元(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":324912,"discussion_content":"感觉有所保留","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1605189566,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":301026,"ip_address":""},"score":324912,"extra":""},{"author":{"id":2300779,"avatar":"","nickname":"Geek_886bfd","note":"","ucode":"5F2A03D4ED7C30","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1810051,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK0uyg1IicbEhLwsgM2A2ROoyVdWdmUqZfQfs6G67w9m3hdRNBMOQJatQoACj3qNGgj2KVIgricaYiaQ/132","nickname":"木得感情的编码机器","note":"","ucode":"9C6CD47ADCB8E6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":325737,"discussion_content":"所以这就是redo log是物理日志，bin log是逻辑日志。物理日志与存储引擎相关，逻辑日志可以跨存储引擎。","likes_number":34,"is_delete":false,"is_hidden":false,"ctime":1605418742,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":164263,"ip_address":""},"score":325737,"extra":""}]},{"author":{"id":1194060,"avatar":"https://static001.geekbang.org/account/avatar/00/12/38/4c/5426e2e0.jpg","nickname":"CJJ","note":"","ucode":"7E02A6A8547559","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":327078,"discussion_content":"我的理解，redo log记录的是当时的数据是怎么变化的，比如备份的时候记录table表中字段a的值是1→3（由1变成3），而binlog里面记录可能就是多条SQL执行之后a的值才等于3，比如update table set a =1 where ID=1；update table set a=3 where ID=1；或者执行过更多SQL才变成3。","likes_number":35,"is_delete":false,"is_hidden":false,"ctime":1605746202,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1066020,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKM9iaxAZwgZHBcibJiaCNTaCZZK2Hl9zbBJ5icpv0bVSzBocYhtmhgia2OMzz9ZG6h6ZBGeoEdH0ORq6g/132","nickname":"Michael","note":"","ucode":"2F728638758FBA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1194060,"avatar":"https://static001.geekbang.org/account/avatar/00/12/38/4c/5426e2e0.jpg","nickname":"CJJ","note":"","ucode":"7E02A6A8547559","race_medal":1,"user_type":1,"is_pvip":true},"discussion":{"id":338454,"discussion_content":"透彻。还是例子好懂。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609294123,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":327078,"ip_address":""},"score":338454,"extra":""},{"author":{"id":2018275,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/cb/e3/a5cad724.jpg","nickname":"Lu","note":"","ucode":"DA2F82DB9437D1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1194060,"avatar":"https://static001.geekbang.org/account/avatar/00/12/38/4c/5426e2e0.jpg","nickname":"CJJ","note":"","ucode":"7E02A6A8547559","race_medal":1,"user_type":1,"is_pvip":true},"discussion":{"id":351338,"discussion_content":"可以使用canal来比较直观地查看binlog结构，每次DML操作都会产生binlog日志，并非是多次记录的集合（当然这是binlog处于row模式的情况下）","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1614249628,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":327078,"ip_address":""},"score":351338,"extra":""}]},{"author":{"id":1392326,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/7KvTibLByic8Eht03jsera25gTIoJEKnajulAVyRibaFic34rNjCSd3DBpjwWInJ72gBMuo1RNNoFdiay0PUSy8971Q/132","nickname":"hahahhh","note":"","ucode":"ED94DDF526F94D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293075,"discussion_content":"redo log，可以理解为，因为其记录的是对物理页的修改，一个物理页16kb，那redo log里记录的可以这么理解：16kb，换算出byte，就是16 * 1024,这么多个字节，假设文件开始为第0个字节，简称为offset 0； redo log，可能会这么记录，offset x开始，写入长度为n的字节数组，要写入的字节数组为byteArray[n]。我们平时对数组操作也会有类似api，对吧","likes_number":17,"is_delete":false,"is_hidden":false,"ctime":1595427575,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1820990,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/c9/3e/78cee9d0.jpg","nickname":"单行道","note":"","ucode":"C4B54DC46D975B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1392326,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/7KvTibLByic8Eht03jsera25gTIoJEKnajulAVyRibaFic34rNjCSd3DBpjwWInJ72gBMuo1RNNoFdiay0PUSy8971Q/132","nickname":"hahahhh","note":"","ucode":"ED94DDF526F94D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":331442,"discussion_content":"哈哈 一看就是石衫老师专栏内容，redo log具体记录的就是表空间号，数据页号，偏移量，修改了几个字节的值和具体的修改值","likes_number":15,"is_delete":false,"is_hidden":false,"ctime":1606876086,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":293075,"ip_address":""},"score":331442,"extra":""},{"author":{"id":1641326,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJDdmHm6txEVtEXEDibSdIsRLEpghOoMt2kfZHetY9QLWHygicKCfhVoYiaylAZJoXbcCMBhXqMF4icgw/132","nickname":"洗洗睡吧","note":"","ucode":"DE7F8B4CA512F6","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1820990,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/c9/3e/78cee9d0.jpg","nickname":"单行道","note":"","ucode":"C4B54DC46D975B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351777,"discussion_content":"这个数据页号，偏移量是通过IO操作得到的吗，如果是，那redolog不就变成随机IO了？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614435152,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":331442,"ip_address":""},"score":351777,"extra":""},{"author":{"id":1970443,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIx1V1QAxC4NHaxYZGyuibBN8lcURJWc5nrnO4yic1kxnDemYV2FJGialf47kYX9qtDnZZOfe1SJeLicg/132","nickname":"lleft","note":"","ucode":"D573EB509455AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1641326,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJDdmHm6txEVtEXEDibSdIsRLEpghOoMt2kfZHetY9QLWHygicKCfhVoYiaylAZJoXbcCMBhXqMF4icgw/132","nickname":"洗洗睡吧","note":"","ucode":"DE7F8B4CA512F6","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":368740,"discussion_content":"redo log文件初始化之后就已经生成固定大小的文件了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618820202,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":351777,"ip_address":""},"score":368740,"extra":""}]},{"author":{"id":1815964,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/BfwsrYQVhMQKwdT7JPRDVt9qXtPjGpR08t84CiazmGUhC74X52m2s5jFxibm2ybeKUhCaOH9mkMryMWrBcOc5mtw/132","nickname":"Geek_fanfan","note":"","ucode":"5F278BC23911B7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":154974,"discussion_content":"redolog记录的是这个页“做了什么改动”，这句话要怎么理解？它的意义是什么呢？既然binlog已经记录了sql和对应记录前后的数据内容，那这个redolog作用的点又在什么地方？有没有人可以指点一下的","likes_number":11,"is_delete":false,"is_hidden":false,"ctime":1580205384,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":18,"child_discussions":[{"author":{"id":1018620,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8a/fc/d1dd57dd.jpg","nickname":"ipofss","note":"","ucode":"DE3061C9259F9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1815964,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/BfwsrYQVhMQKwdT7JPRDVt9qXtPjGpR08t84CiazmGUhC74X52m2s5jFxibm2ybeKUhCaOH9mkMryMWrBcOc5mtw/132","nickname":"Geek_fanfan","note":"","ucode":"5F278BC23911B7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":162131,"discussion_content":"同问，第2点我也没理解","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1580962388,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":154974,"ip_address":""},"score":162131,"extra":""},{"author":{"id":1539926,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIUBia0Aevb2CyMNPvuzTkVvlcoDpdFELFav5Bcic90wxehZibo0VglM7aRZLMo93Ful7v5TFlKfEYyg/132","nickname":"啊不多","note":"","ucode":"A38DE3C564B748","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1815964,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/BfwsrYQVhMQKwdT7JPRDVt9qXtPjGpR08t84CiazmGUhC74X52m2s5jFxibm2ybeKUhCaOH9mkMryMWrBcOc5mtw/132","nickname":"Geek_fanfan","note":"","ucode":"5F278BC23911B7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":176149,"discussion_content":"我理解的是 redo log记录的是物理日志 应该是某一页上某个数据的改变这种 bin log是 可以执行的sql","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582026871,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":154974,"ip_address":""},"score":176149,"extra":""},{"author":{"id":1608605,"avatar":"https://static001.geekbang.org/account/avatar/00/18/8b/9d/11cf22de.jpg","nickname":"1174770765","note":"","ucode":"6823E4FB927288","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1815964,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/BfwsrYQVhMQKwdT7JPRDVt9qXtPjGpR08t84CiazmGUhC74X52m2s5jFxibm2ybeKUhCaOH9mkMryMWrBcOc5mtw/132","nickname":"Geek_fanfan","note":"","ucode":"5F278BC23911B7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":195722,"discussion_content":"我的理解是，redo log记录的是这一页物理上的改动，不是SQL语句","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1583301988,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":154974,"ip_address":""},"score":195722,"extra":""}]},{"author":{"id":2667912,"avatar":"https://static001.geekbang.org/account/avatar/00/28/b5/88/9b65e31c.jpg","nickname":"Y          X","note":"","ucode":"C9926CA7510F3C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":406698,"discussion_content":"害，搞得我都想亲眼去看看这两个log长啥样","likes_number":10,"is_delete":false,"is_hidden":false,"ctime":1634822577,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429110,"discussion_content":"Redo log不是记录数据页“更新之后的状态”，而是记录这个页 “做了什么改动”。\n\nBinlog有两种模式，statement 格式的话是记sql语句， row格式会记录行的内容，记两条，更新前和更新后都有。\n（谢谢你提这个问题，为了不打断文章思路，这个点没在正文写，但是又是很重要的点😄😄）","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1542301166,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":549708,"discussion_content":"Mark一下，但是希望作者对“记录这个页做了什么改动”这种描述能够给出更详细的举例或者描述。","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1644217320,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":429110,"ip_address":""},"score":549708,"extra":""}]},{"author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"一元(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301112,"discussion_content":"我的理解是，binlog和redo log 都具备恢复能力，只是redo log是物理日志，恢复速度相较于 binglog的逻辑日志 恢复起来更快，所以redo log用于 crash时的数据丢失恢复，binlog用于恢复到一个之前的某个时间点的恢复。\n    其实redo 和binlog的存储结构也能引证我的想法，redo log是循环写的，不能存太多log，而binlog是“追加写的”只要内存大，理论上是无限制的，可以记录很长时间的log，也就适合恢复到之前任意时间点的数据库。\n    同时，我觉得说binlog没有crash-safe能力是不完全正确的，因为binlog显然是可以用于崩溃后的数据恢复（因为更新操作时的两次提交保证了binlog和redo log的数据写入是“同一个事务”），那为啥却说binlog没有crash-safa能呢？我想可能是历史原因，binlog从一开始就不是用于crash时的数据恢复，所以binlog虽然有crash-safe的能力，但是没有这个功能。","likes_number":8,"is_delete":false,"is_hidden":false,"ctime":1598410648,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":7,"child_discussions":[{"author":{"id":2149133,"avatar":"https://static001.geekbang.org/account/avatar/00/20/cb/0d/11e3e3f6.jpg","nickname":"THE SWORD OF AMBER","note":"","ucode":"BEC2834C1EC165","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"一元(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301826,"discussion_content":"binlog恢复数据需要有全量备份，redolog不需要备份也能恢复数据","likes_number":14,"is_delete":false,"is_hidden":false,"ctime":1598673150,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":301112,"ip_address":""},"score":301826,"extra":""},{"author":{"id":1277081,"avatar":"https://static001.geekbang.org/account/avatar/00/13/7c/99/4dac6ce6.jpg","nickname":"lakeslove","note":"","ucode":"65E14D29D3C981","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"一元(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":346676,"discussion_content":"因为binlog没有记录内存中哪些数据没写入到磁盘，也就是没有checkpoint，如果想要binlog有crash-safe能力，需要改造binlog，例如这样改造：\n每次把内存中的数据写入到磁盘中是，在相应的binlog上做标记。\n这样子数据库重启后，就知道哪些数据需要恢复了。\n但是这个方式需要扫描整个binlog，显然不如redolog方便。\n改造优化：\n内存中的数据加入编号，按编号从小到大顺序依次写入磁盘，每写一条就把binlog上的标记往上移动一条，这样就只需要做一个标记即可。恢复时也只需要恢复这个标记以后的日志即可。\n但是这些改造肯定很复杂，涉及很多东西啊。。。","likes_number":19,"is_delete":false,"is_hidden":false,"ctime":1612018675,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":301112,"ip_address":""},"score":346676,"extra":""},{"author":{"id":1583740,"avatar":"https://static001.geekbang.org/account/avatar/00/18/2a/7c/0d6a87c4.jpg","nickname":"dandy","note":"","ucode":"5EE976FCBD9215","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1277081,"avatar":"https://static001.geekbang.org/account/avatar/00/13/7c/99/4dac6ce6.jpg","nickname":"lakeslove","note":"","ucode":"65E14D29D3C981","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":355019,"discussion_content":"为什么要知道checkpoint，crash之后，直接全亮执行binlog不是就恢复了吗？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1615375624,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":346676,"ip_address":""},"score":355019,"extra":""}]},{"author":{"id":2063911,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/7e/27/c2502abf.jpg","nickname":"小彬","note":"","ucode":"8688FD8E7BAA4F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":361668,"discussion_content":"可以这样认为吗？备份恢复的时候使用bin log，而mysql因异常重启的时候，使用redo log进行恢复的。因为这种原因，所以要保持bin log 和redo log一致？如果都是在binlog进行恢复是不是就可以了？\n\n另外，有一个问题，如果redo log的prepare写好了，而bin log写入的时候失败了，会出现什么情况？在或者binlog也写入成功了，而redo log的write 失败了，又会出现什么情况？","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1616725153,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":9,"child_discussions":[{"author":{"id":1970443,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIx1V1QAxC4NHaxYZGyuibBN8lcURJWc5nrnO4yic1kxnDemYV2FJGialf47kYX9qtDnZZOfe1SJeLicg/132","nickname":"lleft","note":"","ucode":"D573EB509455AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2063911,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/7e/27/c2502abf.jpg","nickname":"小彬","note":"","ucode":"8688FD8E7BAA4F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368730,"discussion_content":"redo log的prepare写好了binlog写入失败的话，事务提交失败回滚。如果redo log的prepare写好了且binlog写入了，那么redo log的 commit没有写成功不影响事务的提交。","likes_number":9,"is_delete":false,"is_hidden":false,"ctime":1618819520,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":361668,"ip_address":""},"score":368730,"extra":""},{"author":{"id":2365564,"avatar":"https://static001.geekbang.org/account/avatar/00/24/18/7c/91d6dd83.jpg","nickname":"红高粱","note":"","ucode":"0DD331C8E01A81","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2063911,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/7e/27/c2502abf.jpg","nickname":"小彬","note":"","ucode":"8688FD8E7BAA4F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373542,"discussion_content":"赞，你想问的问题我也想知道，反复阅读了几次文章，文章重点标准了，redo日志提供快速恢复能力，binlog则不具备这个能力","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1620781432,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":361668,"ip_address":""},"score":373542,"extra":""},{"author":{"id":2156734,"avatar":"https://static001.geekbang.org/account/avatar/00/20/e8/be/11937399.jpg","nickname":"小文","note":"","ucode":"E42DF2D72025A9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1970443,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIx1V1QAxC4NHaxYZGyuibBN8lcURJWc5nrnO4yic1kxnDemYV2FJGialf47kYX9qtDnZZOfe1SJeLicg/132","nickname":"lleft","note":"","ucode":"D573EB509455AE","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378211,"discussion_content":"为啥commit没有写成功不影响事物的提交，不影响还要commit干啥？求大佬解答","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1623114716,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":368730,"ip_address":""},"score":378211,"extra":""}]},{"author":{"id":1886331,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/c8/7b/153181d7.jpg","nickname":"夜辉","note":"","ucode":"9421385F51FF9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377333,"discussion_content":"buffer pool记录每一页的变动，redo log记载物理日志，保证持久性\nbinlog log记载逻辑日志，用于主从复制和异构数据同步","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1622605369,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1202874,"avatar":"https://static001.geekbang.org/account/avatar/00/12/5a/ba/1a6648f8.jpg","nickname":"张伟","note":"","ucode":"61006DF5A017B8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6347,"discussion_content":"binlog三种模式，还有max","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1566865475,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1255051,"avatar":"https://static001.geekbang.org/account/avatar/00/13/26/8b/2bb5f68f.jpg","nickname":"ymeh","note":"","ucode":"6404D4B0DD1E44","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1202874,"avatar":"https://static001.geekbang.org/account/avatar/00/12/5a/ba/1a6648f8.jpg","nickname":"张伟","note":"","ucode":"61006DF5A017B8","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":276754,"discussion_content":"mixed","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1590935215,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":6347,"ip_address":""},"score":276754,"extra":""}]},{"author":{"id":1092218,"avatar":"https://static001.geekbang.org/account/avatar/00/10/aa/7a/ae8c247d.jpg","nickname":"指尖以东","note":"","ucode":"1DEE134FE92FD0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":275658,"discussion_content":"听你们讨论学到了，redo是物理上的变化，不是sql","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1590748668,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1019332,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","nickname":"长期规划","note":"","ucode":"5EF65E9115834B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2362,"discussion_content":"redo Iog记录做了什么改动，那不就是记录SQL语句吗？","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1563517201,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":8,"child_discussions":[{"author":{"id":1232273,"avatar":"https://static001.geekbang.org/account/avatar/00/12/cd/91/3d6c53f8.jpg","nickname":"Nash.Z","note":"","ucode":"76B14722664402","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1019332,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","nickname":"长期规划","note":"","ucode":"5EF65E9115834B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6226,"discussion_content":"同样的疑问","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1566795074,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":2362,"ip_address":""},"score":6226,"extra":""},{"author":{"id":1625903,"avatar":"https://static001.geekbang.org/account/avatar/00/18/cf/2f/f0554c53.jpg","nickname":"啦啦啦","note":"","ucode":"273C35DCA5BF97","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1019332,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","nickname":"长期规划","note":"","ucode":"5EF65E9115834B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":32649,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571054863,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":2362,"ip_address":""},"score":32649,"extra":""},{"author":{"id":1709779,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/5oQNw43pkMN5Yxb64LibEAE1Zcl5ic9arGg21Vxv9y0zMKjtHomtmDMNI2VUCq4eAwewWfCpjjmhWd7sAgdlhYLQ/132","nickname":"解雨臣","note":"","ucode":"1FF2E89934FFB7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1019332,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","nickname":"长期规划","note":"","ucode":"5EF65E9115834B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":72504,"discussion_content":"个人感觉应该是从记录数据库文件的第几位发生了变化","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1575480750,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":2362,"ip_address":""},"score":72504,"extra":""}]},{"author":{"id":1194060,"avatar":"https://static001.geekbang.org/account/avatar/00/12/38/4c/5426e2e0.jpg","nickname":"CJJ","note":"","ucode":"7E02A6A8547559","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":327073,"discussion_content":"是不是可以把redo log和binlog理解成相当于Redis里面的rdb和aof呢？","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1605745483,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2326134,"avatar":"https://static001.geekbang.org/account/avatar/00/23/7e/76/368394bf.jpg","nickname":"哦","note":"","ucode":"C776659DED9D79","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1194060,"avatar":"https://static001.geekbang.org/account/avatar/00/12/38/4c/5426e2e0.jpg","nickname":"CJJ","note":"","ucode":"7E02A6A8547559","race_medal":1,"user_type":1,"is_pvip":true},"discussion":{"id":327339,"discussion_content":"个人认为可以将binlog类似于rdb和aof，而redolog只是对最近的物理改动的记录，不是一个“全局”记录","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1605793543,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":327073,"ip_address":""},"score":327339,"extra":""}]},{"author":{"id":1740528,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/8e/f0/6db53b6c.jpg","nickname":"呵呵","note":"","ucode":"4357D0804FA9AD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":52940,"discussion_content":"redo log 记录的就是数据，binlog记录逻辑，可以这么理解吧","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1574093349,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2028951,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/f5/97/9a7ee7b3.jpg","nickname":"Geek4329","note":"","ucode":"D6FB8D1B2D5DAC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":532772,"discussion_content":"redo log: 比如把c修改为2。binlog：比如c加上1","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1637681704,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1252375,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1c/17/34e707b1.jpg","nickname":"奈何3刀流","note":"","ucode":"CBE5D230652DE9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591367,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666538787,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"湖北"},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575479,"discussion_content":"Binlog有3种模式：statement、row、Mixed 推荐使用Mixed ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654862895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2028951,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/f5/97/9a7ee7b3.jpg","nickname":"Geek4329","note":"","ucode":"D6FB8D1B2D5DAC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":533263,"discussion_content":"可以使用mysql binlog和strings工具打开日志文件看看","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637827331,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2623805,"avatar":"https://static001.geekbang.org/account/avatar/00/28/09/3d/5d9c15aa.jpg","nickname":"wsy.","note":"","ucode":"D34078775EC363","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385164,"discussion_content":"请问在更新时更新到内存是更新到nageneicun","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626926176,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1236318,"avatar":"https://static001.geekbang.org/account/avatar/00/12/dd/5e/f09d214b.jpg","nickname":"74~75","note":"","ucode":"F54118CA15A840","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2623805,"avatar":"https://static001.geekbang.org/account/avatar/00/28/09/3d/5d9c15aa.jpg","nickname":"wsy.","note":"","ucode":"D34078775EC363","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535534,"discussion_content":"更新时是更新加载进内存中的数据页，此时该数据页称为“脏页”，会有专门的线程好像叫purge线程定期刷新到磁盘，文中说的都是日志的刷盘。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638458285,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":385164,"ip_address":""},"score":535534,"extra":""}]},{"author":{"id":2001267,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/89/73/0d74294d.jpg","nickname":"Geek_f68d95","note":"","ucode":"0A5C8A9B628B4F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283914,"discussion_content":"redo log 是执行操作之前就记录了的日志，而binlog是操作完成后，空闲时间才记录的日志，可以这样理解吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592398909,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1179312,"avatar":"https://static001.geekbang.org/account/avatar/00/11/fe/b0/260f41f0.jpg","nickname":"loris","note":"","ucode":"00842745CF4B31","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":39394,"discussion_content":"是这条数据所在的数据页发生了什么变动。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571921393,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1276434,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/eCbn0LY9oIzlw6X1FSBibbdLjZZTk4ial6TedJWP2whYCb1Is9aEAJojZnHFyd5FHyeCKc2c14zibvQLBRicOxd3Dg/132","nickname":"归途","note":"","ucode":"A9DA6CFFB46FBF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3510,"discussion_content":"同问","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1564543131,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":true,"id":39798,"user_name":"Jason","can_delete":false,"product_type":"c1","uid":1308126,"ip_address":"","ucode":"7FFD6DFCE6EB36","user_header":"https://static001.geekbang.org/account/avatar/00/13/f5/de/c33e531e.jpg","comment_is_top":true,"comment_ctime":1542357974,"is_pvip":false,"replies":[{"id":"14298","content":"👍🏿置顶了<br><br>你说的物理复制业界有团队在做了<br><br>而且官方新版本也把MySQL的表结构都收归InnoDB管理了😄","user_name":"作者回复","comment_id":39798,"uid":"1264162","ip_address":"","utype":1,"ctime":1542363027,"user_name_real":"林晓斌"}],"discussion_count":27,"race_medal":0,"score":"9.2233752510327009e+18","product_id":100020801,"comment_content":"首先谈一下，学习后的收获<br>redo是物理的，binlog是逻辑的；现在由于redo是属于InnoDB引擎，所以必须要有binlog，因为你可以使用别的引擎<br>保证数据库的一致性，必须要保证2份日志一致，使用的2阶段式提交；其实感觉像事务，不是成功就是失败，不能让中间环节出现，也就是一个成功，一个失败<br>如果有一天mysql只有InnoDB引擎了，有redo来实现复制，那么感觉oracle的DG就诞生了，物理的速度也将远超逻辑的，毕竟只记录了改动向量<br>binlog几大模式，一般采用row，因为遇到时间，从库可能会出现不一致的情况，但是row更新前后都有，会导致日志变大<br>最后2个参数，保证事务成功，日志必须落盘，这样，数据库crash后，就不会丢失某个事务的数据了<br>其次说一下，对问题的理解<br>备份时间周期的长短，感觉有2个方便<br>首先，是恢复数据丢失的时间，既然需要恢复，肯定是数据丢失了。如果一天一备份的话，只要找到这天的全备，加入这天某段时间的binlog来恢复，如果一周一备份，假设是周一，而你要恢复的数据是周日某个时间点，那就，需要全备+周一到周日某个时间点的全部binlog用来恢复，时间相比前者需要增加很多；看业务能忍受的程度<br>其次，是数据库丢失，如果一周一备份的话，需要确保整个一周的binlog都完好无损，否则将无法恢复；而一天一备，只要保证这天的binlog都完好无损；当然这个可以通过校验，或者冗余等技术来实现，相比之下，上面那点更重要<br><br>不对的地方，望大神指点","like_count":748,"discussions":[{"author":{"id":2046179,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/ajNVdqHZLLAsbPRKgaVw8kKp5pKGUE4JdDZaW16RoRTItTI3wJ3pPGNoFIjYQm8FKa3xLlNwRicziclmWKsmp7kA/132","nickname":"清河","note":"","ucode":"AB44CB37FCB026","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301043,"discussion_content":"这个要结合实例恢复一起看才能理解，当实例崩溃后，数据库重启，数据库按照redolog前滚，当发现最后一个事务只有prepare，没有commit时，需要到binlog中找这条语句的记录，找到了，则提交事务，找不到就回滚。","likes_number":33,"is_delete":false,"is_hidden":false,"ctime":1598370375,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1259126,"avatar":"https://static001.geekbang.org/account/avatar/00/13/36/76/f6695148.jpg","nickname":"BeautifulSoup","note":"","ucode":"1FC5CAA611FC33","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2046179,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/ajNVdqHZLLAsbPRKgaVw8kKp5pKGUE4JdDZaW16RoRTItTI3wJ3pPGNoFIjYQm8FKa3xLlNwRicziclmWKsmp7kA/132","nickname":"清河","note":"","ucode":"AB44CB37FCB026","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537494,"discussion_content":"补充：找到了完整的binlog就提交，否则回滚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1639066077,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":301043,"ip_address":""},"score":537494,"extra":""},{"author":{"id":1104129,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d9/01/3ad0c998.jpg","nickname":"NingJiaa","note":"","ucode":"5CEA19486F7D48","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1259126,"avatar":"https://static001.geekbang.org/account/avatar/00/13/36/76/f6695148.jpg","nickname":"BeautifulSoup","note":"","ucode":"1FC5CAA611FC33","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548684,"discussion_content":"解释了疑虑","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643330991,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":537494,"ip_address":""},"score":548684,"extra":""}]},{"author":{"id":2189226,"avatar":"https://static001.geekbang.org/account/avatar/00/21/67/aa/95817353.jpg","nickname":"Summer","note":"","ucode":"AFF9C7061A78C5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":307306,"discussion_content":"这里是物理的和逻辑的是什么概念，没明白","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1600595130,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":2021212,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/MdmRMTV2IwvQZF2IO0G0CFWbKxT9CIibmcdicS3J4SmrA4P1e36jCwyXZpia06ItwP4GibGnCrPJHicBbd5y9libTpiaA/132","nickname":"^_^","note":"","ucode":"301EE75D170771","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2189226,"avatar":"https://static001.geekbang.org/account/avatar/00/21/67/aa/95817353.jpg","nickname":"Summer","note":"","ucode":"AFF9C7061A78C5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":338360,"discussion_content":"物理：InnoDB存储引擎提供接口给执行器调用（操作数据），数据库的数据是存在磁盘上的（或者说硬盘上），那么redo log记录存储引擎修改硬盘上的数据的操作就叫做物理操作；\n逻辑：binlog归档日志，有两种模式 1.statement记录sql; 2 row格式记录两条数据，数据修改前的样子，数据修改后的样子。记录的是一种逻辑上的变化 。","likes_number":19,"is_delete":false,"is_hidden":false,"ctime":1609247891,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":307306,"ip_address":""},"score":338360,"extra":""},{"author":{"id":1066020,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKM9iaxAZwgZHBcibJiaCNTaCZZK2Hl9zbBJ5icpv0bVSzBocYhtmhgia2OMzz9ZG6h6ZBGeoEdH0ORq6g/132","nickname":"Michael","note":"","ucode":"2F728638758FBA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2021212,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/MdmRMTV2IwvQZF2IO0G0CFWbKxT9CIibmcdicS3J4SmrA4P1e36jCwyXZpia06ItwP4GibGnCrPJHicBbd5y9libTpiaA/132","nickname":"^_^","note":"","ucode":"301EE75D170771","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":338465,"discussion_content":"binlog也是存在硬盘上的，也是物理的。所以，这个理由不对。","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1609296664,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":338360,"ip_address":""},"score":338465,"extra":""},{"author":{"id":2536268,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/afiaWq0ka02S0s5vmFyblCvfQfxBoebhJtHydvZoE2GKA7zYyy3YHDmEBlmtXJmFIDxUINiaJNkIK7nT4oNnK8KA/132","nickname":"Geek_04099f","note":"","ucode":"5FC68FDBC3A88E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2021212,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/MdmRMTV2IwvQZF2IO0G0CFWbKxT9CIibmcdicS3J4SmrA4P1e36jCwyXZpia06ItwP4GibGnCrPJHicBbd5y9libTpiaA/132","nickname":"^_^","note":"","ucode":"301EE75D170771","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":369833,"discussion_content":"个人理解： 1. redo log 是记录磁盘上发生的数据操作  2. binlog 是记录sql指令或者指令前后的数据变化。  类似于机器语言和高级语言的关系","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619169669,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":338360,"ip_address":""},"score":369833,"extra":""}]},{"author":{"id":1997215,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/79/9f/92e3461c.jpg","nickname":"多比","note":"","ucode":"A427794A656231","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288563,"discussion_content":"就算分两阶段，如果在提交bin-log，和提交redo log事物之间系统崩溃，是否也会出现日志不一样的情况","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1593789118,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":10,"child_discussions":[{"author":{"id":1324405,"avatar":"https://static001.geekbang.org/account/avatar/00/14/35/75/0e38aabb.jpg","nickname":"Better","note":"","ucode":"CD29A0B1C616B3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1997215,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/79/9f/92e3461c.jpg","nickname":"多比","note":"","ucode":"A427794A656231","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288801,"discussion_content":"不会了，我个人理解把binlog夹在redo log中间，就是为了保证如果redo提交前的任何失败，都会带来回滚，binlog的写入也应该不会成功，只有这样，才能保证两个一致","likes_number":13,"is_delete":false,"is_hidden":false,"ctime":1593875590,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":288563,"ip_address":""},"score":288801,"extra":""},{"author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"一元(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1324405,"avatar":"https://static001.geekbang.org/account/avatar/00/14/35/75/0e38aabb.jpg","nickname":"Better","note":"","ucode":"CD29A0B1C616B3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301029,"discussion_content":"对，只能这样理解才能说得通了，这个老师讲得不行","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1598368333,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":288801,"ip_address":""},"score":301029,"extra":""},{"author":{"id":1314724,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0f/a4/0b49469f.jpg","nickname":"木子00","note":"","ucode":"8F78CA722EB29B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"一元(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303874,"discussion_content":"哈哈。也不能这样讲。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599398869,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":301029,"ip_address":""},"score":303874,"extra":""}]},{"author":{"id":1133036,"avatar":"https://static001.geekbang.org/account/avatar/00/11/49/ec/6bae1fd7.jpg","nickname":"哇咔咔","note":"","ucode":"54BF877836C591","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588312,"discussion_content":"没懂既然binlog是通用的，为啥还要redo log？看文章这两种日志没有太大差别","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663661704,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429228,"discussion_content":"👍🏿置顶了\n\n你说的物理复制业界有团队在做了\n\n而且官方新版本也把MySQL的表结构都收归InnoDB管理了😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542363027,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2578483,"avatar":"https://static001.geekbang.org/account/avatar/00/27/58/33/65020e1b.jpg","nickname":"名字不要太长像我这样就好","note":"","ucode":"B278FE439C581A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":369147,"discussion_content":"有时候会备份错误，怎么解决","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618943126,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1207853,"avatar":"https://static001.geekbang.org/account/avatar/00/12/6e/2d/df5ec0bf.jpg","nickname":"嘻哈二重性","note":"","ucode":"89FAD507691FEA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366205,"discussion_content":"不就是redis的复制方式","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617981002,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1592030,"avatar":"https://static001.geekbang.org/account/avatar/00/18/4a/de/27141bce.jpg","nickname":"～","note":"","ucode":"A0324B59624794","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350493,"discussion_content":"物理是什么意思啊\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613894305,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1400806,"avatar":"https://static001.geekbang.org/account/avatar/00/15/5f/e6/19778e70.jpg","nickname":"Mr.埃克斯","note":"","ucode":"855BE5DFD2BB0B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1592030,"avatar":"https://static001.geekbang.org/account/avatar/00/18/4a/de/27141bce.jpg","nickname":"～","note":"","ucode":"A0324B59624794","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":412791,"discussion_content":"物理就是对应硬盘哪个页里哪个数据要改成什么值, 逻辑就是哪个表哪个字段要改成什么值。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636290704,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":350493,"ip_address":""},"score":412791,"extra":""}]},{"author":{"id":1003453,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/4f/bd/6d825f68.jpg","nickname":"一想再想N","note":"","ucode":"EA22728C2A43F2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301967,"discussion_content":"你没理解两阶段的意思，再回去读一下。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598721370,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1318468,"avatar":"","nickname":"极客—月","note":"","ucode":"EE12EEBF242B1D","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":1003453,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/4f/bd/6d825f68.jpg","nickname":"一想再想N","note":"","ucode":"EA22728C2A43F2","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":558636,"discussion_content":"大佬能说下理解吗？我理解的也是他这样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648427652,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":301967,"ip_address":""},"score":558636,"extra":""}]}]},{"had_liked":false,"id":39741,"user_name":"lfn","can_delete":false,"product_type":"c1","uid":1026593,"ip_address":"","ucode":"2E1558C6A12A89","user_header":"https://static001.geekbang.org/account/avatar/00/0f/aa/21/6c3ba9af.jpg","comment_is_top":true,"comment_ctime":1542344669,"is_pvip":false,"replies":[{"id":"14250","content":"binlog还不能去掉。<br><br>一个原因是，redolog只有InnoDB有，别的引擎没有。<br><br>另一个原因是，redolog是循环写的，不持久保存，binlog的“归档”这个功能，redolog是不具备的。  ","user_name":"作者回复","comment_id":39741,"uid":"1264162","ip_address":"","utype":1,"ctime":1542345182,"user_name_real":"林晓斌"}],"discussion_count":69,"race_medal":0,"score":"9.2233741558159995e+18","product_id":100020801,"comment_content":"老师,今天MYSQL第二讲中提到binlog和redo log, 我感觉binlog很多余，按理是不是只要redo log就够了?[费解] <br>您讲的时候说redo log是InnoDB的要求，因为以plugin的形式加入到MySQL中，此时binlog作为Server层的日志已然存在，所以便有了两者共存的现状。但我觉得这并不能解释我们在只用InonoDB引擎的时候还保留Binlog这种设计的原因.","like_count":494,"discussions":[{"author":{"id":1692320,"avatar":"https://static001.geekbang.org/account/avatar/00/19/d2/a0/c8714628.jpg","nickname":"独一无二","note":"","ucode":"A7DE0EA2BD8FE3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":28564,"discussion_content":"还有一个原因，是主从是基于binlog进行复制的。","likes_number":24,"is_delete":false,"is_hidden":false,"ctime":1570704957,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1186807,"avatar":"https://static001.geekbang.org/account/avatar/00/12/1b/f7/45e8b64a.jpg","nickname":"Fire","note":"","ucode":"4A2C50B77EDB2C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":307709,"discussion_content":"这个问题问的好啊！如果只留一份日志就不会有冲突的问题。在当下两个日志都有特定不好取代的作用时采用两阶段提交来保证一致性。 我看老师讲解，只专注于为何要两阶段写日志，没能跳出来去看为什么要有两个日志。","likes_number":15,"is_delete":false,"is_hidden":false,"ctime":1600740508,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":6,"child_discussions":[{"author":{"id":1354639,"avatar":"https://static001.geekbang.org/account/avatar/00/14/ab/8f/fe478a0f.jpg","nickname":"阿森","note":"","ucode":"92D451E975CC09","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1186807,"avatar":"https://static001.geekbang.org/account/avatar/00/12/1b/f7/45e8b64a.jpg","nickname":"Fire","note":"","ucode":"4A2C50B77EDB2C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":309427,"discussion_content":"redo log有crash-safe能力，但没有归档能力。为了同时实现归档和crash-safe，就要有这两个日志。","likes_number":23,"is_delete":false,"is_hidden":false,"ctime":1601287408,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":307709,"ip_address":""},"score":309427,"extra":""},{"author":{"id":2308968,"avatar":"","nickname":"Geek_9789da","note":"","ucode":"6A4A182A7E2C6B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1354639,"avatar":"https://static001.geekbang.org/account/avatar/00/14/ab/8f/fe478a0f.jpg","nickname":"阿森","note":"","ucode":"92D451E975CC09","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":326444,"discussion_content":"你好我问下归档是什么意思","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1605596108,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":309427,"ip_address":""},"score":326444,"extra":""},{"author":{"id":1253597,"avatar":"https://static001.geekbang.org/account/avatar/00/13/20/dd/82d8eff2.jpg","nickname":"Mine","note":"","ucode":"85C3A3117FD9CB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2308968,"avatar":"","nickname":"Geek_9789da","note":"","ucode":"6A4A182A7E2C6B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":328898,"discussion_content":"存档，备份。redo log是循环写，没有完整的备份数据，只是用于做crash safe。","likes_number":15,"is_delete":false,"is_hidden":false,"ctime":1606269023,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":326444,"ip_address":""},"score":328898,"extra":""}]},{"author":{"id":1128669,"avatar":"https://static001.geekbang.org/account/avatar/00/11/38/dd/cb4cb569.jpg","nickname":"周健","note":"","ucode":"C187D877843689","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":369407,"discussion_content":"这两个都不是重点，重点是磁盘故障会导致单机数据丢失，主备同步都是依赖binlog来做的(因为非innodb也需要跨机器同步)","likes_number":10,"is_delete":false,"is_hidden":false,"ctime":1619018515,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2662146,"avatar":"","nickname":"Geek_ed6a8e","note":"","ucode":"C63EA12088E30B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1128669,"avatar":"https://static001.geekbang.org/account/avatar/00/11/38/dd/cb4cb569.jpg","nickname":"周健","note":"","ucode":"C187D877843689","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":379720,"discussion_content":"binlog是基于备份和binlog中的sql语句恢复数据库；redo log是为了保证事物提交后遇到crash，防止那些未写入磁盘、还保存在内存中的数据丢失。显然实际生产中如遇到突发情况，用redo log 可以更快恢复生产。两者的功能定位不同。","likes_number":16,"is_delete":false,"is_hidden":false,"ctime":1624092448,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":369407,"ip_address":""},"score":379720,"extra":""}]},{"author":{"id":1059579,"avatar":"https://static001.geekbang.org/account/avatar/00/10/2a/fb/e2b29825.jpg","nickname":"Bing","note":"","ucode":"1A9745BBF0CDDB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":31023,"discussion_content":"redolog擦除前不是会把要擦除的记录持久化吗","likes_number":9,"is_delete":false,"is_hidden":false,"ctime":1570878691,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":9,"child_discussions":[{"author":{"id":1320092,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM4z9WYWVvWDhMF0SicPE5ad56ME6DibyWGbRoQa0lH4U9icdsjNcv3ssRickcuRMDA01e6vMXnmOVSr9l5LVUefVxicn/132","nickname":"black_mirror","note":"","ucode":"2549C87298BF12","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1059579,"avatar":"https://static001.geekbang.org/account/avatar/00/10/2a/fb/e2b29825.jpg","nickname":"Bing","note":"","ucode":"1A9745BBF0CDDB","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":35571,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571289585,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":31023,"ip_address":""},"score":35571,"extra":""},{"author":{"id":1088309,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9b/35/79e42357.jpg","nickname":"铁匠","note":"","ucode":"D403835F5DB8F7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1059579,"avatar":"https://static001.geekbang.org/account/avatar/00/10/2a/fb/e2b29825.jpg","nickname":"Bing","note":"","ucode":"1A9745BBF0CDDB","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":61175,"discussion_content":"redo log保证数据不丢失，binlog可以做全量数据归档，例如：建从库的时候可以直接用binlog恢复数据（如果没有全量的binlog，就只能select出来再insert到新库，然后再用binlog增量同步）","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1574774910,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":31023,"ip_address":""},"score":61175,"extra":""},{"author":{"id":1405020,"avatar":"https://static001.geekbang.org/account/avatar/00/15/70/5c/ebb274eb.jpg","nickname":"板栗饼","note":"","ucode":"2DA25B053D7721","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1059579,"avatar":"https://static001.geekbang.org/account/avatar/00/10/2a/fb/e2b29825.jpg","nickname":"Bing","note":"","ucode":"1A9745BBF0CDDB","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":128488,"discussion_content":"我理解的是不是把记录持久化，是把记录的信息更新到磁盘数据上，比如redo log里记载某条数据c字段+1，擦除前就把磁盘上这条数据的c字段加上1，再进行擦除，这条记录本身并不会持久保存。","likes_number":11,"is_delete":false,"is_hidden":false,"ctime":1578643725,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":31023,"ip_address":""},"score":128488,"extra":""}]},{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429207,"discussion_content":"binlog还不能去掉。\n\n一个原因是，redolog只有InnoDB有，别的引擎没有。\n\n另一个原因是，redolog是循环写的，不持久保存，binlog的“归档”这个功能，redolog是不具备的。  ","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1542345182,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2169950,"avatar":"https://static001.geekbang.org/account/avatar/00/21/1c/5e/69d6797b.jpg","nickname":"Unique","note":"","ucode":"FE8E79B3B95AFF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":304473,"discussion_content":"binlog的作用并不是只有这里，建议了解一下mysql集群","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1599577202,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1515223,"avatar":"https://static001.geekbang.org/account/avatar/00/17/1e/d7/7d28a531.jpg","nickname":"飞机翅膀上","note":"","ucode":"D239DFFECDBF01","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":2169950,"avatar":"https://static001.geekbang.org/account/avatar/00/21/1c/5e/69d6797b.jpg","nickname":"Unique","note":"","ucode":"FE8E79B3B95AFF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":325905,"discussion_content":"老师说了呀，扩容的时候通过全量备份+binlog","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1605456281,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":304473,"ip_address":""},"score":325905,"extra":""}]},{"author":{"id":1661704,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","nickname":"丁丁历险记","note":"","ucode":"A43829E454C067","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":277790,"discussion_content":"没binlog   . 只有很老的全备，新从库咋办，只能凉凉。","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1591106044,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1118074,"avatar":"https://static001.geekbang.org/account/avatar/00/11/0f/7a/4196443e.jpg","nickname":"timor","note":"","ucode":"0D886B2137ABBC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1661704,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","nickname":"丁丁历险记","note":"","ucode":"A43829E454C067","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":287050,"discussion_content":"重新开启binlog，再做一次全备就可以了","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1593353982,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":277790,"ip_address":""},"score":287050,"extra":""},{"author":{"id":2046179,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/ajNVdqHZLLAsbPRKgaVw8kKp5pKGUE4JdDZaW16RoRTItTI3wJ3pPGNoFIjYQm8FKa3xLlNwRicziclmWKsmp7kA/132","nickname":"清河","note":"","ucode":"AB44CB37FCB026","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1118074,"avatar":"https://static001.geekbang.org/account/avatar/00/11/0f/7a/4196443e.jpg","nickname":"timor","note":"","ucode":"0D886B2137ABBC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301044,"discussion_content":"这不还是要binlog吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598370464,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":287050,"ip_address":""},"score":301044,"extra":""},{"author":{"id":2448006,"avatar":"https://static001.geekbang.org/account/avatar/00/25/5a/86/9b632422.jpg","nickname":"hustle everyday","note":"","ucode":"6E856497161716","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1661704,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","nickname":"丁丁历险记","note":"","ucode":"A43829E454C067","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351300,"discussion_content":"主从不就是基于binlog来实现的吗？怎么会没有binlog","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1614235394,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":277790,"ip_address":""},"score":351300,"extra":""}]},{"author":{"id":1463686,"avatar":"https://static001.geekbang.org/account/avatar/00/16/55/86/ca7c94ce.jpg","nickname":"羁绊12221","note":"","ucode":"15B47C5053388A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":16511,"discussion_content":"如果能像oracle一样支持 redolog的归档，理论上binlog是不是不是必须的了？","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1568897407,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1003515,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/4f/fb/10366b97.jpg","nickname":"Henry","note":"","ucode":"54AFE9C99B31B4","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1463686,"avatar":"https://static001.geekbang.org/account/avatar/00/16/55/86/ca7c94ce.jpg","nickname":"羁绊12221","note":"","ucode":"15B47C5053388A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":25395,"discussion_content":"我也有一样的疑问，理论上可以结合binlog和redolog的优势呀，因为没有什么冲突的点。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570515892,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":16511,"ip_address":""},"score":25395,"extra":""},{"author":{"id":1204168,"avatar":"https://static001.geekbang.org/account/avatar/00/12/5f/c8/13aa8aa9.jpg","nickname":"night","note":"","ucode":"03B3C955092C03","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1463686,"avatar":"https://static001.geekbang.org/account/avatar/00/16/55/86/ca7c94ce.jpg","nickname":"羁绊12221","note":"","ucode":"15B47C5053388A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541251,"discussion_content":"我理解理论上是这样的（在讨论范围限定于 innodb 引擎的前提下），就像另一位同学评论的，完全可以结合 binlog 和 redolog 的优势重新设计下，不过可能会有较大的底层改动吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640311988,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":16511,"ip_address":""},"score":541251,"extra":""}]},{"author":{"id":2895981,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/30/6d/a678c9a2.jpg","nickname":"Return to zero","note":"","ucode":"074C9B1B4CBF18","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":547389,"discussion_content":"补充一下，为什么需要redolog日志，因为保存的是未被刷新磁盘的日志，而binlog日志是全部的信息，没有字段区分哪些是写入的那些事未写入的，所以只能用作归档","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1642655693,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1054108,"avatar":"https://static001.geekbang.org/account/avatar/00/10/15/9c/310c902c.jpg","nickname":"e^x","note":"","ucode":"29B56E0DF4EF48","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391460,"discussion_content":"个人理解：\nBinlog是为了备份和恢复\nRedolog是为了性能和宕机恢复（crash-safe）","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1630475050,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1883737,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/be/59/d890189f.jpg","nickname":"小猫","note":"","ucode":"615CF321850403","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1054108,"avatar":"https://static001.geekbang.org/account/avatar/00/10/15/9c/310c902c.jpg","nickname":"e^x","note":"","ucode":"29B56E0DF4EF48","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":407850,"discussion_content":"binLog可以到处复制，redolog是磁盘页面的日志，除了本机其他机器要了也没用。我认为最重要的区别就这一点，不然根本不需要binlog。","likes_number":13,"is_delete":false,"is_hidden":false,"ctime":1635133135,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":391460,"ip_address":""},"score":407850,"extra":""}]},{"author":{"id":1116277,"avatar":"https://static001.geekbang.org/account/avatar/00/11/08/75/512b9f26.jpg","nickname":"张汉桂-东莞","note":"","ucode":"38657ABA59382A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":161459,"discussion_content":"老师好，我用innerDB引擎的话，是不是启用一个log就可以了呀？既然redo是只有innerDB才支持，那么直接把redolog关闭不就完事儿了吗？还是说根本没有关闭redolog的参数？\n","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1580902587,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1118074,"avatar":"https://static001.geekbang.org/account/avatar/00/11/0f/7a/4196443e.jpg","nickname":"timor","note":"","ucode":"0D886B2137ABBC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1116277,"avatar":"https://static001.geekbang.org/account/avatar/00/11/08/75/512b9f26.jpg","nickname":"张汉桂-东莞","note":"","ucode":"38657ABA59382A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":287052,"discussion_content":"不需要主从不需要数据恢复的话，binlog是可以关闭的，而且默认就是关闭的","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1593354074,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":161459,"ip_address":""},"score":287052,"extra":""},{"author":{"id":1583740,"avatar":"https://static001.geekbang.org/account/avatar/00/18/2a/7c/0d6a87c4.jpg","nickname":"dandy","note":"","ucode":"5EE976FCBD9215","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1116277,"avatar":"https://static001.geekbang.org/account/avatar/00/11/08/75/512b9f26.jpg","nickname":"张汉桂-东莞","note":"","ucode":"38657ABA59382A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":355030,"discussion_content":"我也觉得没问题，关了，如果 crash了，你肯定知道哪个时间点，那你就在这个时间点之前，重访binlog不是就好了，真没理解这有啥用，应该就是为了方便快速恢复。不然需要人为指定恢复binlog。但是感觉也没啥必要。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615376364,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":161459,"ip_address":""},"score":355030,"extra":""},{"author":{"id":2130032,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/mpsOZBaHEA5oZ4A43dU21tNsakMyLRcmjn1liaJctPYfVkzB18dspeoOFNUxmEBq7I6Bjib0qPiaoF5uu0icNYek5g/132","nickname":"BestRiven","note":"","ucode":"D2642BC46EE9FC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1583740,"avatar":"https://static001.geekbang.org/account/avatar/00/18/2a/7c/0d6a87c4.jpg","nickname":"dandy","note":"","ucode":"5EE976FCBD9215","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":371980,"discussion_content":"感觉只用binlog如果适当修改优化是可以实现crash_safe,但是其效果永远赶不上redo log,因为一旦系统读入某个page，直接用redo_log就可以将这个页的内容进行修改，然后在redo log清除这个页的修改。但是binlog呢，需要检查一下这个page的内容，然后再去binlog对应一条一条的找记录修改。始终感觉差那么点意思。可能真的是各司其职。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1620114454,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":355030,"ip_address":""},"score":371980,"extra":""}]},{"author":{"id":2346018,"avatar":"https://static001.geekbang.org/account/avatar/00/23/cc/22/a93febed.jpg","nickname":"Rainer","note":"","ucode":"DAB6670EF179A3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576464,"discussion_content":"感觉很多人都没有答到点子上，redo记录是对数据页物理上的修改。通过redo进行数据crash后的恢复直接修改磁盘数据页即可，应用redo的过程就是直接将物理数据修改操作应用到某个页中即可。那么我们再来看如果把binlog当redo用，在回放binlog的时候回放的是逻辑上sql操作语句。而这就尴尬了，这sql语句一回放把整个表都操作了。假设某语句update student set name = &#39;哈皮&#39; where age = 15，回放对应的binlog就是把这语句在执行一遍;若此时在binlog回放前插入了age为15的数据，这样一回放刚插的数据也收到影响，明显存在问题。所以本质上因为binlog是逻辑日志所以不能用于保证crash-safe，其他的原因都不是根本原因。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1655562069,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1125834,"avatar":"https://static001.geekbang.org/account/avatar/00/11/2d/ca/02b0e397.jpg","nickname":"fomy","note":"","ucode":"CD87EA03B1F327","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":413471,"discussion_content":"binlog在实现重启后恢复很慢，因此需要redo log恢复得更快。但是redo log只适用于当前机器page页，因此涉及到主从同步还是要用biglog。所以必须保证数据的一致性。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1636473888,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2189226,"avatar":"https://static001.geekbang.org/account/avatar/00/21/67/aa/95817353.jpg","nickname":"Summer","note":"","ucode":"AFF9C7061A78C5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":323057,"discussion_content":"搞不懂为啥需要两个log，写一个不是很简单吗，不是成功就是失败就两个状态","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1604880509,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":7,"child_discussions":[{"author":{"id":1820990,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/c9/3e/78cee9d0.jpg","nickname":"单行道","note":"","ucode":"C4B54DC46D975B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2189226,"avatar":"https://static001.geekbang.org/account/avatar/00/21/67/aa/95817353.jpg","nickname":"Summer","note":"","ucode":"AFF9C7061A78C5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":331446,"discussion_content":"建议多看这几篇，提这个问题感觉你没认真看，这两个日志出处不一样，用处不一样，特点更不一样，他们功能更不一样，何来可以取代之说？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1606876820,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":323057,"ip_address":""},"score":331446,"extra":""},{"author":{"id":2189226,"avatar":"https://static001.geekbang.org/account/avatar/00/21/67/aa/95817353.jpg","nickname":"Summer","note":"","ucode":"AFF9C7061A78C5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1820990,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/c9/3e/78cee9d0.jpg","nickname":"单行道","note":"","ucode":"C4B54DC46D975B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335310,"discussion_content":"我的意思是如果有一种日志兼具这两种特性是否只要一个日志就够了。还是双日志设计是数据库业界的标准或常规思路","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608165373,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":331446,"ip_address":""},"score":335310,"extra":""},{"author":{"id":1336951,"avatar":"https://static001.geekbang.org/account/avatar/00/14/66/77/194ba21d.jpg","nickname":"lzh","note":"","ucode":"C3D83DF4230109","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2189226,"avatar":"https://static001.geekbang.org/account/avatar/00/21/67/aa/95817353.jpg","nickname":"Summer","note":"","ucode":"AFF9C7061A78C5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344424,"discussion_content":"bin_log是server层通用日志吧，有些引擎如memory都没有crash safe的功能，没必要为了innodb去让bin_log搞那么多东西耦合起来","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1611460333,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":335310,"ip_address":""},"score":344424,"extra":""}]},{"author":{"id":1133036,"avatar":"https://static001.geekbang.org/account/avatar/00/11/49/ec/6bae1fd7.jpg","nickname":"哇咔咔","note":"","ucode":"54BF877836C591","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588316,"discussion_content":"那直接留下binglog不就好了吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663661859,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2564241,"avatar":"https://static001.geekbang.org/account/avatar/00/27/20/91/61162bdc.jpg","nickname":"Violet","note":"","ucode":"0A5358A06362DA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579611,"discussion_content":"我理解binlog也可以用来实现crash safe? 但是因为部分存储引擎不支持crash safe所以server层没有支持。innodb为了支持所以自己做了redolog","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657571337,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1656525,"avatar":"https://static001.geekbang.org/account/avatar/00/19/46/cd/7980c0e9.jpg","nickname":"刘安","note":"","ucode":"FD40A19C2D1F14","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577487,"discussion_content":"去掉binlog，错删库了咋恢复。。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656141789,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2747514,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqmWLZw4Hkb5AzJxclib5Ud0Qxtd3n5o16xfqUggbFUwickG0DL5njY2dZ3Q3RjqFbbAibJicaruzRGjg/132","nickname":"小猪","note":"","ucode":"E01AAC689E572F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576532,"discussion_content":"我认为redo log具有crash-safe的能力，而binlog没有。想到一种场景，假设正好在刷新redolog到磁盘中，假设顺序是先刷新数据到磁盘再修改checkpoint，刷新完数据就挂了。此时如果恢复用的是binlog，想象一下，update table set a = a + 1，此时数据页不就多加了一个1！！！但是redolog记录的时候数据页的变更，所以不会多加一个1，所以我认为这是binlog不能crash-safe的一个原因","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655631587,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1369754,"avatar":"https://static001.geekbang.org/account/avatar/00/14/e6/9a/d0725a24.jpg","nickname":"Athena","note":"","ucode":"1183247AE864AA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":562525,"discussion_content":"你说出了我的疑问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649844819,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549715,"discussion_content":"感觉可以不需要redo log，只是innoDB不是MySql自己的，MySql又要用innoDB，就只能通过二阶段提交保持两个log的一致性。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644218278,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2906405,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/59/25/5e39b339.jpg","nickname":"Daydreamer","note":"","ucode":"E3D2203753D788","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549521,"discussion_content":"1.redo log 只适用于innoDB引擎；bin log属于server，可以适配所有引擎，不能只照顾innoDB引擎的而不管其他引擎。\n2.redo log 是循环写，不能完全保证所有的操作都写在里面；bin log是“追加写”，记录了完整的操作，更适合回滚复原DB。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644051566,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1463873,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIO2hQgGGq9htCBJNNAMH33VFvCBicwOjwCVXTg3WxYBkI3of3ibfQWib4ibF8m2y9vORT5mSibuqw5LNA/132","nickname":"带头大哥","note":"","ucode":"DA49D606C1E6DF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":138443,"discussion_content":"我也感觉设计2个日志有点问题，为什么不把日志单独设计共享出来，既可以归档也可以cash的时候回复数据，非要搞出2套","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579243641,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1183518,"avatar":"https://static001.geekbang.org/account/avatar/00/12/0f/1e/6b6eb987.jpg","nickname":"我们在路上","note":"","ucode":"0DB77DB7C64C47","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1463873,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIO2hQgGGq9htCBJNNAMH33VFvCBicwOjwCVXTg3WxYBkI3of3ibfQWib4ibF8m2y9vORT5mSibuqw5LNA/132","nickname":"带头大哥","note":"","ucode":"DA49D606C1E6DF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":224731,"discussion_content":"InnoDB是别的公司开发的，被MySQL拿来用了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586326929,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":138443,"ip_address":""},"score":224731,"extra":""},{"author":{"id":1253597,"avatar":"https://static001.geekbang.org/account/avatar/00/13/20/dd/82d8eff2.jpg","nickname":"Mine","note":"","ucode":"85C3A3117FD9CB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1463873,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIO2hQgGGq9htCBJNNAMH33VFvCBicwOjwCVXTg3WxYBkI3of3ibfQWib4ibF8m2y9vORT5mSibuqw5LNA/132","nickname":"带头大哥","note":"","ucode":"DA49D606C1E6DF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":328900,"discussion_content":"看问题要看历史呀，mysql就只有innodb支持事务保证数据的强一致性，其他引擎不支持。早年mysql的默认引擎还是myIasm呢。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1606269197,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":138443,"ip_address":""},"score":328900,"extra":""}]},{"author":{"id":1310826,"avatar":"https://static001.geekbang.org/account/avatar/00/14/00/6a/da96c764.jpg","nickname":"尹希闯","note":"","ucode":"A35F70179808D8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":63914,"discussion_content":"redo log只有4个g，binlog全量，如何保证4个g以外部分也一致呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574921651,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":10,"child_discussions":[{"author":{"id":1810051,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK0uyg1IicbEhLwsgM2A2ROoyVdWdmUqZfQfs6G67w9m3hdRNBMOQJatQoACj3qNGgj2KVIgricaYiaQ/132","nickname":"木得感情的编码机器","note":"","ucode":"9C6CD47ADCB8E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1310826,"avatar":"https://static001.geekbang.org/account/avatar/00/14/00/6a/da96c764.jpg","nickname":"尹希闯","note":"","ucode":"A35F70179808D8","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164267,"discussion_content":"不需要保证。redo log 理解为“内存里的日志”就好了。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1581165961,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":63914,"ip_address":""},"score":164267,"extra":""},{"author":{"id":1196339,"avatar":"https://static001.geekbang.org/account/avatar/00/12/41/33/d1064f9a.jpg","nickname":"Sun","note":"","ucode":"1BC2741DC07FC5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1810051,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK0uyg1IicbEhLwsgM2A2ROoyVdWdmUqZfQfs6G67w9m3hdRNBMOQJatQoACj3qNGgj2KVIgricaYiaQ/132","nickname":"木得感情的编码机器","note":"","ucode":"9C6CD47ADCB8E6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":167083,"discussion_content":"redo log明显不能理解为内存里的日志呀，redo log不同步落盘的话，假如只在内存里，是无法保证crash safe的，老师在文章最后也说了这一点，必须在事务提交的时候刷盘，才可以保证不丢失数据。","likes_number":11,"is_delete":false,"is_hidden":false,"ctime":1581440625,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":164267,"ip_address":""},"score":167083,"extra":""},{"author":{"id":1608605,"avatar":"https://static001.geekbang.org/account/avatar/00/18/8b/9d/11cf22de.jpg","nickname":"1174770765","note":"","ucode":"6823E4FB927288","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1310826,"avatar":"https://static001.geekbang.org/account/avatar/00/14/00/6a/da96c764.jpg","nickname":"尹希闯","note":"","ucode":"A35F70179808D8","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":195732,"discussion_content":"redo log 在满了以后 会更新磁盘，这样就不存在你的问题了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1583302656,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":63914,"ip_address":""},"score":195732,"extra":""}]}]},{"had_liked":false,"id":39753,"user_name":"Godruoyi","can_delete":false,"product_type":"c1","uid":1021785,"ip_address":"","ucode":"62B9BDEC55A983","user_header":"https://static001.geekbang.org/account/avatar/00/0f/97/59/6f9c036e.jpg","comment_is_top":true,"comment_ctime":1542346892,"is_pvip":false,"replies":[{"id":"14261","content":"几乎全对，除了这个“两阶段提交时，若redo log写入成功，但binlog写入失败…”这句话。<br><br>实际上，因为是两阶段提交，这时候redolog只是完成了prepare, 而binlog又失败，那么事务本身会回滚，所以这个库里面status的值是0。<br><br>如果通过binlog 恢复出一个库，status值也是0。<br><br>这样不算丢失，这样是合理的结果。<br><br>两阶段就是保证一致性用的。<br>你不用担心日志写错，那样就是bug了…","user_name":"作者回复","comment_id":39753,"uid":"1264162","ip_address":"","utype":1,"ctime":1542347923,"user_name_real":"林晓斌"}],"discussion_count":47,"race_medal":0,"score":"9.2233731035489997e+18","product_id":100020801,"comment_content":"Bin log 用于记录了完整的逻辑记录，所有的逻辑记录在 bin log 里都能找到，所以在备份恢复时，是以 bin log 为基础，通过其记录的完整逻辑操作，备份出一个和原库完整的数据。<br><br>在两阶段提交时，若 redo log 写入成功，bin log 写入失败，则后续通过 bin log 恢复时，恢复的数据将会缺失一部分。(如 redo log 执行了 update t set status = 1，此时原库的数据 status 已更新为 1，而 bin log 写入失败，没有记录这一操作，后续备份恢复时，其 status = 0，导致数据不一致）。<br><br>若先写入 bin log，当 bin log 写入成功，而 redo log 写入失败时，原库中的 status 仍然是 0 ，但是当通过 bin log 恢复时，其记录的操作是 set status = 1，也会导致数据不一致。<br><br>其核心就是， redo log 记录的，即使异常重启，都会刷新到磁盘，而 bin log 记录的， 则主要用于备份。<br><br>我可以这样理解吗？还有就是如何保证 redo log 和 bin log 操作的一致性啊？","like_count":248,"discussions":[{"author":{"id":1184024,"avatar":"https://static001.geekbang.org/account/avatar/00/12/11/18/48e2ebb4.jpg","nickname":"topgunviper","note":"","ucode":"FF3BDED4EBC1FD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545948,"discussion_content":"关键问题：2PC的前两步成功，第三部失败怎么办？即：步骤1.InnoDB执行事务prepare操作成功；步骤2.Server写binlog成功；步骤第三部commit失败的情况。假设MySQL第三步前宕机，重启后MySQL首先扫描binlog文件，收集最近写入的xid【事务ID，redo log记录里也会有该信息】；然后会扫描redo log里有哪些未提交的事务【即prepare状态的事务】，如果事务写入binlog，那么执行commit；如果没有写入binlog【即事务ID在binlog中查找不到】，那么回滚该事务。这样就可以保证两者的一致性了。【官方文档：https://dev.mysql.com/doc/refman/8.0/en/binary-log.html】","likes_number":38,"is_delete":false,"is_hidden":false,"ctime":1642089287,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1331034,"avatar":"https://static001.geekbang.org/account/avatar/00/14/4f/5a/b38785b5.jpg","nickname":"阿O、不拽","note":"","ucode":"3F3C089F6D354A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1184024,"avatar":"https://static001.geekbang.org/account/avatar/00/12/11/18/48e2ebb4.jpg","nickname":"topgunviper","note":"","ucode":"FF3BDED4EBC1FD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587779,"discussion_content":"mark（binlog redolog两阶段提交）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663291495,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":545948,"ip_address":"上海"},"score":587779,"extra":""}]},{"author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"一元(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301105,"discussion_content":"老师在这个点讲得含糊其辞的，看起冒火得很","likes_number":21,"is_delete":false,"is_hidden":false,"ctime":1598409056,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1135990,"avatar":"https://static001.geekbang.org/account/avatar/00/11/55/76/a55871ab.jpg","nickname":"孙庆良","note":"","ucode":"CA05C4CFEFB0F9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"一元(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374396,"discussion_content":"确实讲的含糊其辞，看遍了评论，都在讨论这个","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621163494,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":301105,"ip_address":""},"score":374396,"extra":""}]},{"author":{"id":1228852,"avatar":"https://static001.geekbang.org/account/avatar/00/12/c0/34/0574bb44.jpg","nickname":"最初的印象","note":"","ucode":"4DD68307FA274E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":122576,"discussion_content":"如果redo log的prepare成功，bin log 也成功，但最后redo log 的commit失败，那不是也有问题吗？","likes_number":13,"is_delete":false,"is_hidden":false,"ctime":1578362081,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":12,"child_discussions":[{"author":{"id":1119671,"avatar":"https://static001.geekbang.org/account/avatar/00/11/15/b7/1dbe1539.jpg","nickname":"伯力_双城子","note":"","ucode":"09550C7D20986A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1228852,"avatar":"https://static001.geekbang.org/account/avatar/00/12/c0/34/0574bb44.jpg","nickname":"最初的印象","note":"","ucode":"4DD68307FA274E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":137210,"discussion_content":"同问","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1579182069,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":122576,"ip_address":""},"score":137210,"extra":""},{"author":{"id":1019568,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8e/b0/ef201991.jpg","nickname":"CcczzZ","note":"","ucode":"5F46DA5053D2BB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1228852,"avatar":"https://static001.geekbang.org/account/avatar/00/12/c0/34/0574bb44.jpg","nickname":"最初的印象","note":"","ucode":"4DD68307FA274E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":146143,"discussion_content":"redo log commit失败，最后就都回滚了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1579599784,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":122576,"ip_address":""},"score":146143,"extra":""},{"author":{"id":1049741,"avatar":"https://static001.geekbang.org/account/avatar/00/10/04/8d/005c2ff3.jpg","nickname":"weineel","note":"","ucode":"6DC6EF4F256A53","race_medal":2,"user_type":1,"is_pvip":true},"reply_author":{"id":1019568,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8e/b0/ef201991.jpg","nickname":"CcczzZ","note":"","ucode":"5F46DA5053D2BB","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":146947,"discussion_content":"commit 前 crash 了，不就没法回滚了，而 redo log 在 prepare 状态无法恢复，binlog 又已经写入了，不就不一致了？","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1579620446,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":146143,"ip_address":""},"score":146947,"extra":""}]},{"author":{"id":1991164,"avatar":"","nickname":"Geek_32ec8d","note":"","ucode":"3CEAC372C0C684","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":256237,"discussion_content":"如果commit的时候失败尼","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1588458441,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1350991,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9d/4f/273ffb51.jpg","nickname":"小哪吒","note":"","ucode":"252087A733355C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1991164,"avatar":"","nickname":"Geek_32ec8d","note":"","ucode":"3CEAC372C0C684","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":292634,"discussion_content":"不会回滚，认为事务正常提交","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1595291566,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":256237,"ip_address":""},"score":292634,"extra":""}]},{"author":{"id":1500535,"avatar":"","nickname":"潘pan","note":"","ucode":"5C7A04F1F79210","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6392,"discussion_content":"我有个好奇的地方，如果redolog在 commit阶段没有写入失败，就是binlog写入成功，redo log prepare写入成功， 那么redo log事务要回滚， 而binlog阶段又是直接恢复，那么 数据不还是不一致吗","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1566879053,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":7,"child_discussions":[{"author":{"id":1665242,"avatar":"","nickname":"ylchen.xd","note":"","ucode":"8D9EDAAC1E28ED","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1500535,"avatar":"","nickname":"潘pan","note":"","ucode":"5C7A04F1F79210","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":14641,"discussion_content":"redolog因为commit不成功要回滚吗？我猜是这里是没有回滚的。redolog prepare+binlog一致，表示系统上认同了这次改动。非commit状态只是说明写入磁盘的动作没有完成而已。不管什么原因commit失败，数据还可以缓存在内存里，对外宣称改动成功，等待下次写入。你要说这时候断电了，内存没了，我就从log中恢复，写入磁盘。多出来的数据我本来就是要写入的，不存在不一致的问题。","likes_number":11,"is_delete":false,"is_hidden":false,"ctime":1568774540,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":6392,"ip_address":""},"score":14641,"extra":""},{"author":{"id":1241121,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f0/21/7168f973.jpg","nickname":"JStFs","note":"","ucode":"636E85653555DD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1500535,"avatar":"","nickname":"潘pan","note":"","ucode":"5C7A04F1F79210","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":23485,"discussion_content":"这也是我想问的！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569825408,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":6392,"ip_address":""},"score":23485,"extra":""},{"author":{"id":1691109,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJIocn8OMjfSGqyeSJEV3ID2rquLR0S6xo0ibdNYQgzicib6L6VlqWjhgxOqD2iaicX1KhbWXWCsmBTskA/132","nickname":"虚竹","note":"","ucode":"8D8C96C793724E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1665242,"avatar":"","nickname":"ylchen.xd","note":"","ucode":"8D9EDAAC1E28ED","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":46354,"discussion_content":"因为是先写redolog，应该主要是想避免redolog有而binlog没有的情况","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573141916,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":14641,"ip_address":""},"score":46354,"extra":""}]},{"author":{"id":1272996,"avatar":"https://static001.geekbang.org/account/avatar/00/13/6c/a4/7f7c1955.jpg","nickname":"死磕郎一世","note":"","ucode":"86C1197C3FB2A0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381186,"discussion_content":"老师，我有个疑问，既更新一条数据的最后三步：1、redolog在写入时只是完成了prepare状态，应该没有真正的写入磁盘，为后续的事物做准备，告诉执行器，随时可以提交事物\n2、执行器收到消息，binlog写入成功，向存储引擎提交事物\n3、存储引擎收到消息，执行提交事物动作，redolog真正写入磁盘，假如就在这提交事物的时候，mysql异常重启，提交事物失败了，就是redolog没有写入磁盘，此时前面两步会回滚吗？如果能回滚，又是怎么做到的？","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1624945317,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2131215,"avatar":"https://static001.geekbang.org/account/avatar/00/20/85/0f/5cb822d6.jpg","nickname":"shadow","note":"","ucode":"64DCFAEC37EFBC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301225,"discussion_content":"redolog如果没有及时落盘的话 数据应该就丢失了吧","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1598445720,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1834977,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/ff/e1/ea2b6cef.jpg","nickname":"有头发的程序员","note":"","ucode":"48B9B1C5CC4E3A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2131215,"avatar":"https://static001.geekbang.org/account/avatar/00/20/85/0f/5cb822d6.jpg","nickname":"shadow","note":"","ucode":"64DCFAEC37EFBC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":304471,"discussion_content":"是的。 redo log也有缓存的，这个老师没讲。 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599576997,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":301225,"ip_address":""},"score":304471,"extra":""}]},{"author":{"id":1700307,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er9RraTibVnM1MicM7icUkmJwjhxcoBGx5ONKQwz80GK47dhYBzPicp9t6eXv7R8wRg4umepHEiaXat3DQ/132","nickname":"Geek_Stone","note":"","ucode":"73DF77A05D1600","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":35441,"discussion_content":"redolog的prepare已经记了，崩溃恢复之后如果发现binlog没记，会回滚这个事务；如果binlog记了，就认可这个事务并提交。那么本质上是以binlog为准的，redolog有没有commit阶段好像没什么区别，为何还要搞出两阶段提交的概念呢？","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1571280174,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1691109,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJIocn8OMjfSGqyeSJEV3ID2rquLR0S6xo0ibdNYQgzicib6L6VlqWjhgxOqD2iaicX1KhbWXWCsmBTskA/132","nickname":"虚竹","note":"","ucode":"8D8C96C793724E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1700307,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er9RraTibVnM1MicM7icUkmJwjhxcoBGx5ONKQwz80GK47dhYBzPicp9t6eXv7R8wRg4umepHEiaXat3DQ/132","nickname":"Geek_Stone","note":"","ucode":"73DF77A05D1600","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":46347,"discussion_content":"应该不能去查binlog记没记吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573141663,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":35441,"ip_address":""},"score":46347,"extra":""},{"author":{"id":1049741,"avatar":"https://static001.geekbang.org/account/avatar/00/10/04/8d/005c2ff3.jpg","nickname":"weineel","note":"","ucode":"6DC6EF4F256A53","race_medal":2,"user_type":1,"is_pvip":true},"reply_author":{"id":1700307,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er9RraTibVnM1MicM7icUkmJwjhxcoBGx5ONKQwz80GK47dhYBzPicp9t6eXv7R8wRg4umepHEiaXat3DQ/132","nickname":"Geek_Stone","note":"","ucode":"73DF77A05D1600","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":146966,"discussion_content":"我的理解，redo log 是 crash-safe 的恢复的时候是以 redo log 为准的，redo log 没有 commit，这条更新应该是无效的。所以 binlog 有这条记录，就和实际恢复出来的数据不一致了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579620713,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":35441,"ip_address":""},"score":146966,"extra":""},{"author":{"id":1960057,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/e8/79/f84eab1c.jpg","nickname":"落叶随风","note":"","ucode":"527E962B897802","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1700307,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er9RraTibVnM1MicM7icUkmJwjhxcoBGx5ONKQwz80GK47dhYBzPicp9t6eXv7R8wRg4umepHEiaXat3DQ/132","nickname":"Geek_Stone","note":"","ucode":"73DF77A05D1600","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288139,"discussion_content":"我赞成你的这句话“本质上是以binlog为准的”。对于“为何还要搞出两阶段提交的概念呢？”，我的理解是，如果没有两阶段提交，崩溃恢复的时候，要拿每个redolog和binlog进行核对。如果有两阶段提交，崩溃恢复的时候，只需要拿有prepare状态但是没有commit状态的redolog和binlog进行核对。（个人猜测，不知道对不对。）","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1593659009,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":35441,"ip_address":""},"score":288139,"extra":""}]},{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429212,"discussion_content":"几乎全对，除了这个“两阶段提交时，若redo log写入成功，但binlog写入失败…”这句话。\n\n实际上，因为是两阶段提交，这时候redolog只是完成了prepare, 而binlog又失败，那么事务本身会回滚，所以这个库里面status的值是0。\n\n如果通过binlog 恢复出一个库，status值也是0。\n\n这样不算丢失，这样是合理的结果。\n\n两阶段就是保证一致性用的。\n你不用担心日志写错，那样就是bug了…","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1542347923,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":549717,"discussion_content":"Mark一下，binlog写入失败，会导致事务回滚，那redo log如果commit失败呢，也回滚事务吗？这个场景作者也没有讲到。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644218559,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":429212,"ip_address":""},"score":549717,"extra":""}]},{"author":{"id":1082000,"avatar":"https://static001.geekbang.org/account/avatar/00/10/82/90/e4a08b0e.jpg","nickname":"KangShan","note":"","ucode":"07497A7AC92238","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303113,"discussion_content":"也就是说 redo log 必须在 binlog 之前，不然事务回滚没有意义。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1599144055,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":574816,"discussion_content":"1.prepare：先WAL然后落盘binlog；后续的commit只是简单打个完整性标识,可以避免异常重启对已经提交过的事务进行完整性校验","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654359538,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1935838,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/n1gS0knXOF4D8Oo5ocQicCCtwNibmNz4ODrmVg8icobVgap9to11t7ahFm4U81K4MDcavibMNxib39mzm5ibAJR4DdzA/132","nickname":"Ly","note":"","ucode":"0A7A27C8126ACF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":413944,"discussion_content":"如果没有两阶段提交，redo log写成功了，binlog没有成功，在recovery的时候应用redo log的时候不会记录binlog吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636616644,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1791581,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/56/5d/945a012b.jpg","nickname":"XQCSNDT","note":"","ucode":"D2E33B42048C27","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367337,"discussion_content":"实际上，因为是两阶段提交，这时候redolog只是完成了prepare, 而binlog又失败，那么事务本身会回滚，所以这个库里面status的值是0。\n-----\n老师好，您说的事务会回滚的意思我理解，但是mysql是如何判断是否需要回滚的呀，还有mysql是在重启的时候判断事务是否回滚的吗？还是通过其他方式\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618324181,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1111805,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f6/fd/2c619dde.jpg","nickname":"Joe","note":"","ucode":"F73CF74433168D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312521,"discussion_content":"redolog和binlog都写入成功，才可以提交事务，redolog一般设置成事务提交就落盘，但是binlog可能不是。如果此时宕机redolog可以进行前滚保证提交的事务数据不丢失。\nredolog是物理日志，binlog是逻辑日志，逻辑日志没法保证幂等性（个人理解）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602728065,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2221236,"avatar":"https://static001.geekbang.org/account/avatar/00/21/e4/b4/889954ca.jpg","nickname":"Levi","note":"","ucode":"F804879872BB76","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1111805,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f6/fd/2c619dde.jpg","nickname":"Joe","note":"","ucode":"F73CF74433168D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":562324,"discussion_content":"那如果我没开启binlog呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649812329,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":312521,"ip_address":""},"score":562324,"extra":""}]},{"author":{"id":1250205,"avatar":"https://static001.geekbang.org/account/avatar/00/13/13/9d/d91dc762.jpg","nickname":"喜欢吃鱼","note":"","ucode":"02F41572F53E3C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":305756,"discussion_content":"讲得很清楚，多谢！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600076372,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1676102,"avatar":"https://static001.geekbang.org/account/avatar/00/19/93/46/b93e3cee.jpg","nickname":"light","note":"","ucode":"260EF211676F22","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":284550,"discussion_content":"那请问异常重启时redo log的数据是单独开辟空间存到磁盘上吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592554325,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1791854,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/57/6e/8597a770.jpg","nickname":"熊孩子","note":"","ucode":"9EA3D3C8625843","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":143065,"discussion_content":"为啥老师上面写的也是这样的。。下面回复的时候这样又不对了。（我还是比较赞成老师在这个回复里面的观点。）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579488994,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1118424,"avatar":"https://static001.geekbang.org/account/avatar/00/11/10/d8/abb7bfe3.jpg","nickname":"热带鱼","note":"","ucode":"F718A64B51822A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":80915,"discussion_content":"终于明白了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576203899,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43856,"user_name":"小张","can_delete":false,"product_type":"c1","uid":1017155,"ip_address":"","ucode":"AAE72FA376083F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/85/43/3dc8222d.jpg","comment_is_top":true,"comment_ctime":1543312183,"is_pvip":false,"replies":[{"id":"15673","content":"👍🏿，会想到这么细致的场景<br><br>这些数据在内存中是无效其他事务读不到的（读到了也放弃），同样的，即使写进磁盘，也没关系，再次读到内存以后，还是原来的逻辑","user_name":"作者回复","comment_id":43856,"uid":"1264162","ip_address":"","utype":1,"ctime":1543323236,"user_name_real":"林晓斌"}],"discussion_count":31,"race_medal":0,"score":"9.2233726654633001e+18","product_id":100020801,"comment_content":"老师您好，有一个问题，如果在非常极端的情况下，redo log被写满，而redo log涉及的事务均未提交，此时又有新的事务进来时，就要擦除redo log，这就意味着被修改的的脏页此时要被迫被flush到磁盘了，因为用来保证事务持久性的redo log就要消失了。但如若真的执行了这样的操作，数据就在被commit之前被持久化到磁盘中了。当真的遇到这样的恶劣情况时，mysql会如何处理呢，会直接报错吗？还是有什么应对的方法和策略呢？","like_count":146,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430525,"discussion_content":"👍🏿，会想到这么细致的场景\n\n这些数据在内存中是无效其他事务读不到的（读到了也放弃），同样的，即使写进磁盘，也没关系，再次读到内存以后，还是原来的逻辑","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543323236,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1695608,"avatar":"https://static001.geekbang.org/account/avatar/00/19/df/78/d4946736.jpg","nickname":"很大的勇气","note":"","ucode":"7871D1C1E22F3F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306188,"discussion_content":"丁老师答非所问。我理解当redolog文件写满，当有新事物进来时，会发生等待。","likes_number":27,"is_delete":false,"is_hidden":false,"ctime":1600216413,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1797901,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/6f/0d/7dc0b289.jpg","nickname":"记事本","note":"","ucode":"3E5018B9550296","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1695608,"avatar":"https://static001.geekbang.org/account/avatar/00/19/df/78/d4946736.jpg","nickname":"很大的勇气","note":"","ucode":"7871D1C1E22F3F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":343670,"discussion_content":"也就是后面专栏讲的 mysql 为啥偶尔会抖一下。。。","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1611130611,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":306188,"ip_address":""},"score":343670,"extra":""},{"author":{"id":1066707,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/d3/e25d104a.jpg","nickname":"êｗěｎ","note":"","ucode":"5000233111BEFA","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1695608,"avatar":"https://static001.geekbang.org/account/avatar/00/19/df/78/d4946736.jpg","nickname":"很大的勇气","note":"","ucode":"7871D1C1E22F3F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350583,"discussion_content":"需要检查checkpoint刷盘，是要全局等待","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1613922807,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":306188,"ip_address":""},"score":350583,"extra":""},{"author":{"id":1225224,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b2/08/92f42622.jpg","nickname":"尔冬橙","note":"","ucode":"0B013A49BC18DA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1695608,"avatar":"https://static001.geekbang.org/account/avatar/00/19/df/78/d4946736.jpg","nickname":"很大的勇气","note":"","ucode":"7871D1C1E22F3F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571473,"discussion_content":"是的，回答错了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652237151,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":306188,"ip_address":""},"score":571473,"extra":""}]},{"author":{"id":1001893,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/49/a5/e4c1c2d4.jpg","nickname":"小文同学","note":"","ucode":"48F2AEB989C12A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":251048,"discussion_content":"redo log 是会在事务没提交前，也有可能写盘的，这也是为什么MySQL遇到大事务的时候，commit一般都能很快。为了保证redo log 的可用性，InnoDB 的 Master Thread 会定时触发 Fuzzy Checkpoint 保证 redo log 写盘。至于事务阻塞导致 redo log 被写满，估计只是理论上的场景，工程上应该不会出现的，出现这个问题的话，基本上意味着数据库早就不可用了。","likes_number":16,"is_delete":false,"is_hidden":false,"ctime":1588060729,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":10,"child_discussions":[{"author":{"id":2026531,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/ec/23/c575b915.jpg","nickname":"Curry不会投三分球","note":"","ucode":"165C57E53CC879","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1001893,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/49/a5/e4c1c2d4.jpg","nickname":"小文同学","note":"","ucode":"48F2AEB989C12A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294164,"discussion_content":"大佬，如果redolog在事务提交前写磁盘了，但是事务最终没有提交，磁盘里的数据不就是脏数据吗，这时候磁盘数据需要回滚？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595814658,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":251048,"ip_address":""},"score":294164,"extra":""},{"author":{"id":1001893,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/49/a5/e4c1c2d4.jpg","nickname":"小文同学","note":"","ucode":"48F2AEB989C12A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2026531,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/ec/23/c575b915.jpg","nickname":"Curry不会投三分球","note":"","ucode":"165C57E53CC879","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294450,"discussion_content":"回答这个问题，首先要清楚 redo log 的作用，是防止奔溃恢复时，数据的一致性。也就是说 T1 的事务 产生了 redo1log，T1回滚了(没有binlog)，redo1log其实并不需要清理，如果后续的T2顺利提交，redo1log就不会被访问了。\n\n所以理解这个问题，关键是 redo log 的作用。可以看看 Innodb技术内幕 7.2章 关于redo log的描述。","likes_number":11,"is_delete":false,"is_hidden":false,"ctime":1595897347,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":294164,"ip_address":""},"score":294450,"extra":""},{"author":{"id":1695608,"avatar":"https://static001.geekbang.org/account/avatar/00/19/df/78/d4946736.jpg","nickname":"很大的勇气","note":"","ucode":"7871D1C1E22F3F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1001893,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/49/a5/e4c1c2d4.jpg","nickname":"小文同学","note":"","ucode":"48F2AEB989C12A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306191,"discussion_content":"小文同学理解的有些误区。首先提问者说的是redo log文件写满了，不是redo log buffer满了。而你回答的原理是redolog buffer写入redolog文件的原理。master线程会源源不断将buffer中的数据写入到redo log文件中，该事务还未提交情况下只是写入到redolog文件中，但是不会刷新到对应的表。  提问者所说的问题不极端，这样的问题发生后，后续的事务无法运行。","likes_number":18,"is_delete":false,"is_hidden":false,"ctime":1600217099,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":251048,"ip_address":""},"score":306191,"extra":""}]},{"author":{"id":1202874,"avatar":"https://static001.geekbang.org/account/avatar/00/12/5a/ba/1a6648f8.jpg","nickname":"张伟","note":"","ucode":"61006DF5A017B8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6350,"discussion_content":"redo不存在事物概念，没有begin或commit等，redo的引进是缓存数据减少磁盘io，它有其他特性，例如连续空间，并发写入，并发事物共享存储空间，记录未提交事物的sql，记录回滚操作等，这里涉及undo的概念。。。","likes_number":11,"is_delete":false,"is_hidden":false,"ctime":1566866099,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1062848,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","nickname":"walle斌","note":"","ucode":"0DB3243004951F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291314,"discussion_content":"其实举个很简单的例子，如果你来设计一个文件的落库，或者心跳机制，你会选择，每次一个实际动作触发一次落库或者心跳检查，还是选择再额外增加一个定时机制，每间隔一个周期会自动检查一下是否需要落库或者心跳？。。。其实想明白这个就知道你说的场景会有，但是一定会提前解决了，或者db本身早就有问题了。。然后这点想明白了，其实 消息队列的心跳机制或者mq broker的落库 你也就明白了，哈哈哈 其实到最后技术都是互通的。","likes_number":10,"is_delete":false,"is_hidden":false,"ctime":1594776513,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1553046,"avatar":"https://static001.geekbang.org/account/avatar/00/17/b2/96/a524ebf6.jpg","nickname":"silas","note":"","ucode":"EEFF1E8ED00EE6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1062848,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","nickname":"walle斌","note":"","ucode":"0DB3243004951F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391031,"discussion_content":"羡慕你已经到了能觉得技术互通的地步了。我也好想哦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630236601,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":291314,"ip_address":""},"score":391031,"extra":""}]},{"author":{"id":1115724,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLwSoTjHPX5tm4whBSfoZLX6toZxrZGUaLABQywKNf4MDc9toK3QSV7Z99ATcGicFCysoleQ5ISzmw/132","nickname":"乘风","note":"","ucode":"0420C5535DACB7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":25158,"discussion_content":"redolog本身的特性是记录 数据修改后的影响,刷入时机有很多,并非sql提交时才刷入,猜测redolog记录的数据会有一个标识,即当前redolog关联的事务是否已提交,这样保证了事务一致性,如redolog日志持久化到磁盘,当其sql本身未提交,那么在此时宕机恢复时这条sql的影响是无效的,另一种方式是跟undo log相关,即redolog不管数据的事务性,由undo log来管理","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1570439285,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1577858,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLJ55iasmMeibReVXMlqWRTHiajEIyoEMneDQvo5VDhmW7Pgp3A28JLc1oMj0wfIpqevN5b3V30xuEdg/132","nickname":"小熊","note":"","ucode":"5875487F9983D4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":287548,"discussion_content":"一脸懵逼，没看明白","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1593481115,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1105469,"avatar":"https://static001.geekbang.org/account/avatar/00/10/de/3d/b74ee1af.jpg","nickname":"禾众","note":"","ucode":"C37D2965ECA3A3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":147667,"discussion_content":"我理解，数据可以先于redo刷盘。但是需要保证数据对应的undo的redo已经刷盘了。否则一旦崩溃数据读不到undo，就拿不到修改前的版本了。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1579665318,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1054827,"avatar":"https://static001.geekbang.org/account/avatar/00/10/18/6b/a1448af1.jpg","nickname":"贝影","note":"","ucode":"19545C8DCBF8A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1105469,"avatar":"https://static001.geekbang.org/account/avatar/00/10/de/3d/b74ee1af.jpg","nickname":"禾众","note":"","ucode":"C37D2965ECA3A3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542136,"discussion_content":"数据不能先于redo刷盘，这会造成crash recover后数据不一致","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640670381,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":147667,"ip_address":""},"score":542136,"extra":""}]},{"author":{"id":1882517,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/b9/95/cabab54b.jpg","nickname":"tong","note":"","ucode":"966DEDE81081D0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539435,"discussion_content":"尝试回答这个问题：\n首先redolog是直接写盘的\n\n一条update语句，先写一条redolog（包含事务id），标示为prepare状态；然后写binlog，执行器调用引擎的提交事务接口，通过事务id，找到之前记录的redolog（查找过程内部具体怎么实现的，不清楚）\n\n如果在此过程中，发生极端情况，redolog被写满，要刷脏（指的是将内存中与磁盘不一致的数据，刷到磁盘中）。但如果此时有极端情况，第0号文件全是尚未提交的事务，引用老师的话“这些数据在内存中是无效其他事务读不到的（读到了也放弃），同样的，即使写进磁盘，也没关系，再次读到内存以后，还是原来的逻辑”，就是会将redolog中日志刷到磁盘中，但是这些（注意是这些）尚未提交的事务，做的数据修改的版本，即使再次被加载内存中，对于其他事务（在读已提交，可重复读的隔离级别下，仍然是不可见）\n\n于此同时，由于innodb引擎在同步刷盘，此时的事务需要发生等待","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1639715404,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":3169346,"avatar":"","nickname":"Geek_0a981c","note":"","ucode":"FB6D49095FDAF0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1882517,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/b9/95/cabab54b.jpg","nickname":"tong","note":"","ucode":"966DEDE81081D0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585883,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661866209,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":539435,"ip_address":"浙江"},"score":585883,"extra":""}]},{"author":{"id":1015754,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","nickname":"helloworld","note":"","ucode":"00DF2FEC58D2E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5460,"discussion_content":"没有明白。“读到了也放弃”为什么？其他的事务如何判断？为什么“还是原来的逻辑”。是不是有点钻牛角尖了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1566285024,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1361159,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqJobg767PUeqrqQQ4B6YvMatj2SRyOicKZZ4gWTf30dMketiaj58Gc3RFTmckGxAXlL9ERSxGovq9g/132","nickname":"涛哥哥","note":"","ucode":"329A1384E3AB5E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1015754,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","nickname":"helloworld","note":"","ucode":"00DF2FEC58D2E6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":319225,"discussion_content":"数据会有一个事务版本号，会通过事务版本号来判断当前数据是否是脏读等，是否可用。如果不可用，需要通过undolog记录来一步一步往前回滚，直到回滚到你这个事务可用的数据。往后面看就知道了，需要有一定的理解能力，不简单，加油1","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1603966409,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":5460,"ip_address":""},"score":319225,"extra":""}]},{"author":{"id":2021212,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/MdmRMTV2IwvQZF2IO0G0CFWbKxT9CIibmcdicS3J4SmrA4P1e36jCwyXZpia06ItwP4GibGnCrPJHicBbd5y9libTpiaA/132","nickname":"^_^","note":"","ucode":"301EE75D170771","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553983,"discussion_content":"当追上checkpoint点位的时候，redo log已经写过一圈了再也写不下了，不可能写满了redo log最早的那一条还是未提交状态。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646152466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2007786,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/a2/ea/8f913dfa.jpg","nickname":"吃猫的鱼","note":"","ucode":"DC15372C47A0CD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312697,"discussion_content":"我也不太理解。但我大胆猜测一下，没有查阅资料，仅供参考：\n在文中有提到：1）数据库中的更新并不是直接写入磁盘，而是先写入内存；2）存储引擎会先去内存中查找；3）老师的回复中也说到了内存。\n那么，假设更新在内存中执行，这样redo_log满了写入磁盘也没事，最终mysql在空闲的时候会将内存中的东西写入到磁盘覆盖。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602773303,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1813288,"avatar":"","nickname":"雨蒙蒙","note":"","ucode":"06B17333308863","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":146253,"discussion_content":"会存在这样的情景吗？当redo log快要写满的时候，如果来不及刷脏，会阻塞新事务的更新吧？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579604990,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1088452,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9b/c4/ada64740.jpg","nickname":"Cloud","note":"","ucode":"36C97F2C7E0F3A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":41534,"discussion_content":"@小张 说的这种情况，在oracle中 应该就是对应 回滚段失效的场景。mysql还没有遇到过这种情况","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572447077,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52100,"user_name":"哇！怎么这么大个","can_delete":false,"product_type":"c1","uid":1196856,"ip_address":"","ucode":"87106662D244C9","user_header":"https://static001.geekbang.org/account/avatar/00/12/43/38/72feb2e0.jpg","comment_is_top":true,"comment_ctime":1545309989,"is_pvip":false,"replies":[{"id":"18913","content":"其实恢复数据只能恢复到误删之前到一刻，<br>误删之后的，不能只靠binlog来做，因为业务逻辑可能因为误删操作的行为，插入了逻辑错误的语句，<br><br>所以之后的，跟业务一起，从业务快速补数据的。只靠binlog补出来的往往不完整","user_name":"作者回复","comment_id":52100,"uid":"1264162","ip_address":"","utype":1,"ctime":1545315168,"user_name_real":"林晓斌"}],"discussion_count":13,"race_medal":0,"score":"9.2233725537962004e+18","product_id":100020801,"comment_content":"老师您好，我之前是做运维的，通过binlog恢复误操作的数据，但是实际上，我们会后知后觉，误删除一段时间了，才发现误删除，此时，我把之前误删除的binlog导入，再把误删除之后binlog导入，会出现问题，比如主键冲突，而且binlog导数据，不同模式下时间也有不同，但是一般都是row模式，时间还是很久，有没什么方式，时间短且数据一致性强的方式","like_count":120,"discussions":[{"author":{"id":1068178,"avatar":"https://static001.geekbang.org/account/avatar/00/10/4c/92/a9cf4fb6.jpg","nickname":"邬磊","note":"","ucode":"D938FD4ED5E67E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336494,"discussion_content":"首先”数据就在被commit之前被持久化到磁盘中了“ 这种情况是比较普遍的，即使不是redo Log满的情况(而且在满之前会刷盘)，刷脏的策略如下：1.在mysql的Master Thread里面1秒或者每10秒会刷脏页 2.检查如果LRU List里面的空间不够用户线程使用时也会触发在Page Cleaner Thread中刷脏 3.Redo Log文件占用75%的时候会触发异步刷脏，90%的时候会触发同步刷脏 4.当缓冲池中的脏页数量占据75%时，也会触发刷脏。 mysql中为了避免读到脏数据提供了mvcc机制，每行数据上都有一个db_roll_ptr指针(指向undo segment中的undo log，可以理解为一个链表，里面保存了之前事务修改的行数据)，当事务开启的时候会有一个当前事务id，执行第一个select语句的时候，innodb会创建一个快照（read view），快照中会去读取并保存链表里面的事务id，通过当前事务id和快照中的事务id的大小比较来确定读哪份数据。","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1608608488,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1204353,"avatar":"https://static001.geekbang.org/account/avatar/00/12/60/81/eaf6d0ac.jpg","nickname":"拉布拉多","note":"","ucode":"637A88D9F29F57","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1068178,"avatar":"https://static001.geekbang.org/account/avatar/00/10/4c/92/a9cf4fb6.jpg","nickname":"邬磊","note":"","ucode":"D938FD4ED5E67E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":338904,"discussion_content":"mvcc基本思想","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609415976,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":336494,"ip_address":""},"score":338904,"extra":""},{"author":{"id":1054827,"avatar":"https://static001.geekbang.org/account/avatar/00/10/18/6b/a1448af1.jpg","nickname":"贝影","note":"","ucode":"19545C8DCBF8A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1068178,"avatar":"https://static001.geekbang.org/account/avatar/00/10/4c/92/a9cf4fb6.jpg","nickname":"邬磊","note":"","ucode":"D938FD4ED5E67E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542141,"discussion_content":"想问下”数据就在被commit之前被持久化到磁盘中了“这句话是包括了如果一个更新语句在其redolog还未被写进磁盘时，更新的数据就已经被写进磁盘的情况吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640671041,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":336494,"ip_address":""},"score":542141,"extra":""}]},{"author":{"id":2365564,"avatar":"https://static001.geekbang.org/account/avatar/00/24/18/7c/91d6dd83.jpg","nickname":"红高粱","note":"","ucode":"0DD331C8E01A81","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334809,"discussion_content":"现在的业务没有物理删除的","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1607996215,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1015754,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","nickname":"helloworld","note":"","ucode":"00DF2FEC58D2E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5462,"discussion_content":"原来依赖binlog进行数据恢复也不是万能的","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1566286176,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433741,"discussion_content":"其实恢复数据只能恢复到误删之前到一刻，\n误删之后的，不能只靠binlog来做，因为业务逻辑可能因为误删操作的行为，插入了逻辑错误的语句，\n\n所以之后的，跟业务一起，从业务快速补数据的。只靠binlog补出来的往往不完整","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1545315168,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":2,"child_discussions":[{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":549719,"discussion_content":"既然binlog是逻辑的，可不可以恢复到误删除之前的一刻，然后越过误删除的那条记录，然后用后面的记录继续恢复?","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1644219284,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":433741,"ip_address":""},"score":549719,"extra":""},{"author":{"id":2509433,"avatar":"https://static001.geekbang.org/account/avatar/00/26/4a/79/8b92731d.jpg","nickname":"Xcxing","note":"","ucode":"F9131BE3BE50CE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587857,"discussion_content":"提问的兄弟就是这样恢复的吧，作者的回复是可以，但不能保证一定成功，最准确只能通过业务补回来","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663323261,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":549719,"ip_address":"广东"},"score":587857,"extra":""}]},{"author":{"id":1368090,"avatar":"https://static001.geekbang.org/account/avatar/00/14/e0/1a/3a77856a.jpg","nickname":"darwin","note":"","ucode":"2F93C0881AAC7B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":298575,"discussion_content":"可怕","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1597330887,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1202874,"avatar":"https://static001.geekbang.org/account/avatar/00/12/5a/ba/1a6648f8.jpg","nickname":"张伟","note":"","ucode":"61006DF5A017B8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6351,"discussion_content":"业务使用主键会有问题","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1566866186,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2638671,"avatar":"https://static001.geekbang.org/account/avatar/00/28/43/4f/45ac9e21.jpg","nickname":"moodsoso","note":"","ucode":"EDAF2595BFBA29","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":376245,"discussion_content":"后边的数据只有靠打补丁？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622037619,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2249670,"avatar":"","nickname":"mofee888","note":"","ucode":"F1FB6F68DCF802","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":326906,"discussion_content":"所以在DB中建业务主键也是纠结的事，现在一般都是在代码去保证，不在DB创建这种主键","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605697207,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1672786,"avatar":"https://static001.geekbang.org/account/avatar/00/19/86/52/91c7d112.jpg","nickname":"Garen","note":"","ucode":"0608C88F83EF0C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":27423,"discussion_content":"恢复数据只是binlog的一个作用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570639731,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39711,"user_name":"ricktian","can_delete":false,"product_type":"c1","uid":1030928,"ip_address":"","ucode":"06F90004164C64","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bb/10/f01eafe4.jpg","comment_is_top":true,"comment_ctime":1542339407,"is_pvip":false,"replies":[{"id":"14272","content":"文章中有提到“binlog没有被用来做崩溃恢复”，<br><br>历史上的原因是，这个是一开始就这么设计的，所以不能只依赖binlog。<br><br>操作上的原因是，binlog是可以关的，你如果有权限，可以set sql_log_bin=0关掉本线程的binlog日志。 所以只依赖binlog来恢复就靠不住。<br><br>@高枕、@思雨 也看下这个讨论😄","user_name":"作者回复","comment_id":39711,"uid":"1264162","ip_address":"","utype":1,"ctime":1542348865,"user_name_real":"林晓斌"}],"discussion_count":22,"race_medal":0,"score":"9.2233723734046003e+18","product_id":100020801,"comment_content":"redo log的机制看起来和ring buffer一样的；<br>另外有个和高枕、思雨一样的疑问，如果在重启后，需要通过检查binlog来确认redo log中处于prepare的事务是否需要commit，那是否不需要二阶段提交，直接以binlog的为准，如果binlog中不存在的，就认为是需要回滚的。这个地方，是不是我漏了什么，拉不通。。。 麻烦老师解下疑，多谢～ ","like_count":78,"discussions":[{"author":{"id":1277081,"avatar":"https://static001.geekbang.org/account/avatar/00/13/7c/99/4dac6ce6.jpg","nickname":"lakeslove","note":"","ucode":"65E14D29D3C981","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":320537,"discussion_content":"这个林老师确实没说明白，看别人的源码分析，binlog写完了，就是铁定的事务已完成。两阶段提交只是在事务完成后，顺手打个事务完成的标记，不知道好处是啥。\n我能看出来的就是方便存储引擎查询哪些事务确定已完成，不用拿全部的redolog和binlog做对比。\n可以参考这篇博文的源码分析：https://www.cnblogs.com/hustcat/p/3577584.html","likes_number":15,"is_delete":false,"is_hidden":false,"ctime":1604393592,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1302741,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e0/d5/7485e51f.jpg","nickname":"~玲玲玲~子~哥~","note":"","ucode":"89379F3A0427EA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5615,"discussion_content":"如果不依赖binlog只靠redo，那只要处于prepare是回滚还是前滚？依据什么判断","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1566380971,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1660151,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL17rDiannrcyaUB5X6haqLic1183mfwyunJicRO8IYV9U8MaYiaZp8jRnW5kLQIqRmwTaPGIEVQZL5Uw/132","nickname":"大湿兄","note":"","ucode":"587EBBBED90182","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1302741,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e0/d5/7485e51f.jpg","nickname":"~玲玲玲~子~哥~","note":"","ucode":"89379F3A0427EA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":9636,"discussion_content":"回滚吧，一个事务完成是commit或者rollback，prepare不代表事务结束吧","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1568198614,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":5615,"ip_address":""},"score":9636,"extra":""},{"author":{"id":1134266,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4e/ba/580ec429.jpg","nickname":"小兔子乖乖","note":"","ucode":"E5CC0258CF8858","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1302741,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e0/d5/7485e51f.jpg","nickname":"~玲玲玲~子~哥~","note":"","ucode":"89379F3A0427EA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368097,"discussion_content":"会通过undo log来回滚未提交的事务","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618565553,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":5615,"ip_address":""},"score":368097,"extra":""},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1302741,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e0/d5/7485e51f.jpg","nickname":"~玲玲玲~子~哥~","note":"","ucode":"89379F3A0427EA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586857,"discussion_content":"如果redo log里的事务是完整的prepare+commit,则进行提交\n如果redo log里的事务是不完整的，获取redo 的prepare事务列表和最后的一个bin log的Xid列表进行结合\n   if binlog事务完整，则进行提交\n   if bin log事务不完整，则进行回滚\n   binlog 与redo log通过checksum与xid进行完整性判断\n   redo log 与 bin log通过事务Xid进行关联","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662542564,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":5615,"ip_address":"广东"},"score":586857,"extra":""}]},{"author":{"id":1874999,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/9c/37/253ea895.jpg","nickname":"我不是码农","note":"","ucode":"EB4BB711CC54B6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549897,"discussion_content":"要说历史原因的话，我觉得redo log是随着事务而产生的，而事务是有了InnoDB引擎才有的，binlog是伴随着MySQL而生的，所以发展成了两者并存的现状。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1644289210,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429191,"discussion_content":"文章中有提到“binlog没有被用来做崩溃恢复”，\n\n历史上的原因是，这个是一开始就这么设计的，所以不能只依赖binlog。\n\n操作上的原因是，binlog是可以关的，你如果有权限，可以set sql_log_bin=0关掉本线程的binlog日志。 所以只依赖binlog来恢复就靠不住。\n\n@高枕、@思雨 也看下这个讨论😄","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1542348865,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":2,"child_discussions":[{"author":{"id":1177797,"avatar":"https://static001.geekbang.org/account/avatar/00/11/f8/c5/6d38f3e3.jpg","nickname":"黑微狗‮‮","note":"","ucode":"D44505E7E97BB3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":535021,"discussion_content":"如果关闭了本线程的binlog 那不是会造成主从不一致么？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638332527,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":429191,"ip_address":""},"score":535021,"extra":""},{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":549724,"discussion_content":"看了binlog不是没有crash-safe功能，只是历史原因，一开始就没拿binlog做这个事。而且binlog还可以关闭。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644219596,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":429191,"ip_address":""},"score":549724,"extra":""}]},{"author":{"id":1080985,"avatar":"https://static001.geekbang.org/account/avatar/00/10/7e/99/c4302030.jpg","nickname":"Khirye","note":"","ucode":"6C54C126FA54B8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":193207,"discussion_content":"所以理论来说是可以实现的对吧","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1583138324,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1311995,"avatar":"https://static001.geekbang.org/account/avatar/00/14/04/fb/40f298bb.jpg","nickname":"小罗希冀","note":"","ucode":"88416458FF0041","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3812,"discussion_content":"那为啥恢复的时候，只提到通过binlog恢复","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1564834030,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2497728,"avatar":"https://static001.geekbang.org/account/avatar/00/26/1c/c0/b8ff566a.jpg","nickname":"我是大橙子132","note":"","ucode":"61660568CF07C9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552540,"discussion_content":"https://time.geekbang.org/column/article/319481","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645504653,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1602239,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKyobcyicicCQoldZofsS36xrjA2R2hk2F89pu1hCqwjlRaRG4xKkgCicZibEVdOwpfN5rWjEchrsxicSQ/132","nickname":"Geek_e8d55e","note":"","ucode":"5F13626B0E1E45","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295483,"discussion_content":"binlog如果关了，那redo log还有prepare状态吗？感觉没啥用了，直接commit表示提交就可以了吧？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596205038,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1108731,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/wIWrciav7DRkOaD7vUtr084sxprq2U4obfH1ibls4RIsAw5foQlDGIt98x1RHATznNbh0iasibWV2Y7I7QpyFJ4TVA/132","nickname":"Wipeher","note":"","ucode":"A5D7451D95F42C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288497,"discussion_content":"还是不太清楚，redo写完之后，此时宕机，重启之后是回滚还是commit？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593762567,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":7,"child_discussions":[{"author":{"id":1539758,"avatar":"https://static001.geekbang.org/account/avatar/00/17/7e/ae/964f384f.jpg","nickname":"melody","note":"","ucode":"9283A16B20170C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1108731,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/wIWrciav7DRkOaD7vUtr084sxprq2U4obfH1ibls4RIsAw5foQlDGIt98x1RHATznNbh0iasibWV2Y7I7QpyFJ4TVA/132","nickname":"Wipeher","note":"","ucode":"A5D7451D95F42C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":289336,"discussion_content":"\nredo里面的数据有两种状态，分别是prepare,commit。宕机后重启，如果redo里面的数据是commit状态，则执行后续操作。如果是prepare状态，则需要根据binlog来确定数据是回滚还是提交，如果binlog中已经记录了prepare状态数据的逻辑修改，则commit，否则需要回滚。(如果修改已经归档到binlog，则此数据必须提交，因为下游的从库会用到binlog，这样才能保证主从一致)","likes_number":75,"is_delete":false,"is_hidden":false,"ctime":1594055541,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":288497,"ip_address":""},"score":289336,"extra":""},{"author":{"id":1204353,"avatar":"https://static001.geekbang.org/account/avatar/00/12/60/81/eaf6d0ac.jpg","nickname":"拉布拉多","note":"","ucode":"637A88D9F29F57","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1539758,"avatar":"https://static001.geekbang.org/account/avatar/00/17/7e/ae/964f384f.jpg","nickname":"melody","note":"","ucode":"9283A16B20170C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":338910,"discussion_content":"言简意赅，全说明白了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1609416984,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":289336,"ip_address":""},"score":338910,"extra":""},{"author":{"id":2806043,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLBFkSq1oiaEMRjtyyv4ZpCI0OuaSsqs04ODm0OkZF6QhsAh3SvqhxibS2n7PLAVZE3QRSn5Hic0DyXg/132","nickname":"ddh","note":"","ucode":"8E852375365F16","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1539758,"avatar":"https://static001.geekbang.org/account/avatar/00/17/7e/ae/964f384f.jpg","nickname":"melody","note":"","ucode":"9283A16B20170C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":403197,"discussion_content":"那如果是关了binlog呢","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1634030566,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":289336,"ip_address":""},"score":403197,"extra":""}]},{"author":{"id":1672786,"avatar":"https://static001.geekbang.org/account/avatar/00/19/86/52/91c7d112.jpg","nickname":"Garen","note":"","ucode":"0608C88F83EF0C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":27426,"discussion_content":"以binlog为准，redolog什么时候擦除？能不能擦除都不知道咯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570640097,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39662,"user_name":"DanielAnton","can_delete":false,"product_type":"c1","uid":1308521,"ip_address":"","ucode":"69D49AC70898B0","user_header":"https://static001.geekbang.org/account/avatar/00/13/f7/69/d8dba3de.jpg","comment_is_top":true,"comment_ctime":1542333150,"is_pvip":false,"replies":[{"id":"14191","content":"因为是“循环”的，图中这个状态下，write_pos 往前写，写到3号文件末尾，就回到0号继续写，这样你再理解看看“追”的状态。<br><br>刚好借你这个问题，说明一下，文中“write pos和checkpoint之间的是’粉板’上还空着的部分，可以用来记录新的操作。” <br>这句话，说的“空着的部分”，就是write pos 到3号文件末尾，再加上0号文件开头到checkpoint 的部分。","user_name":"作者回复","comment_id":39662,"uid":"1264162","ip_address":"","utype":1,"ctime":1542336188,"user_name_real":"林晓斌"}],"discussion_count":16,"race_medal":0,"score":"9.2233722144908001e+18","product_id":100020801,"comment_content":"有个问题请教老师，既然write pos和checkout都是往后推移并循环的，而且当write pos赶上checkout的时候要停下来，将checkout往后推进，那么是不是意味着write pos的位置始终在checkout后面，最多在一起，而这和老师画的图有些出入，不知道我的理解是不是有些错误，请老师指教。","like_count":41,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429168,"discussion_content":"因为是“循环”的，图中这个状态下，write_pos 往前写，写到3号文件末尾，就回到0号继续写，这样你再理解看看“追”的状态。\n\n刚好借你这个问题，说明一下，文中“write pos和checkpoint之间的是’粉板’上还空着的部分，可以用来记录新的操作。” \n这句话，说的“空着的部分”，就是write pos 到3号文件末尾，再加上0号文件开头到checkpoint 的部分。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542336188,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":549725,"discussion_content":"Checkpoint的初始位置在哪？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644219699,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":429168,"ip_address":""},"score":549725,"extra":""}]},{"author":{"id":1589452,"avatar":"https://static001.geekbang.org/account/avatar/00/18/40/cc/9ff93968.jpg","nickname":"🎄J","note":"","ucode":"0DD6E529B4221A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":8471,"discussion_content":"“空着的部分”=write pos 到3号文件末尾+0号文件开头到checkpoint 的部分 ，这样的话不就 &#34;空着的部分&#34;  > 整个&#34;粉板&#34; 了吗？不太理解老师的这个解释，我还是只是理解了图表层的含义，即 &#34;空着的部分&#34; = checkpoint - write pos","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1568008323,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1672786,"avatar":"https://static001.geekbang.org/account/avatar/00/19/86/52/91c7d112.jpg","nickname":"Garen","note":"","ucode":"0608C88F83EF0C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1589452,"avatar":"https://static001.geekbang.org/account/avatar/00/18/40/cc/9ff93968.jpg","nickname":"🎄J","note":"","ucode":"0DD6E529B4221A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":27419,"discussion_content":"感觉是换了一张图","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1570639356,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":8471,"ip_address":""},"score":27419,"extra":""}]},{"author":{"id":2036366,"avatar":"","nickname":"吟游诗人","note":"","ucode":"27CA90D3D9C5B6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":328674,"discussion_content":"老师这里的图画的确实有问题，我理解对于write pos会先往前跑，checkout跟在后面，当writepos再次跑到checkout位置时，要等check out做持久化操作并擦除以释放空间","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1606208218,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2457860,"avatar":"https://static001.geekbang.org/account/avatar/00/25/81/04/853bc40f.jpg","nickname":"岑寂","note":"","ucode":"C602B1D7F45D32","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2036366,"avatar":"","nickname":"吟游诗人","note":"","ucode":"27CA90D3D9C5B6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394367,"discussion_content":"明白了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631858426,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":328674,"ip_address":""},"score":394367,"extra":""}]},{"author":{"id":1484257,"avatar":"https://static001.geekbang.org/account/avatar/00/16/a5/e1/77281d4e.jpg","nickname":"叁木辛尧","note":"","ucode":"CBBEEA3FDDD44F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368690,"discussion_content":"我的理解是这样的：\nwrite point到check point即图中绿色的部分是空闲的可以写入新的更新的。\n而剩余的地方是未更新的，即check point需要更新的。\n而图中这种情况是怎么出现的呢，我是这样想的。一开始write point和check point在同一个起点，然后write point一直写，check point写的慢，当write point写了一圈回来了。check point才更新了一点，所以才会出现图中的这种情况。\n不知道我理解对不对？","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1618803299,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2615356,"avatar":"","nickname":"Geek_d738cf","note":"","ucode":"52589D7360851F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1484257,"avatar":"https://static001.geekbang.org/account/avatar/00/16/a5/e1/77281d4e.jpg","nickname":"叁木辛尧","note":"","ucode":"CBBEEA3FDDD44F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":376209,"discussion_content":"我和你的想法一致，两者都是沿顺时针方向前进，图中的状态应该是“粉板”快要写满了时的状态","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622016935,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":368690,"ip_address":""},"score":376209,"extra":""}]},{"author":{"id":1324340,"avatar":"https://static001.geekbang.org/account/avatar/00/14/35/34/294684ab.jpg","nickname":"Bug总是难免的","note":"","ucode":"2601659AB2AAB5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":183762,"discussion_content":"要用循环的思想去理解那张图，而不是看成一个圆，因为write pos和check point是可变的。我觉得老师说的没错。","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1582514664,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1058857,"avatar":"https://static001.geekbang.org/account/avatar/00/10/28/29/156b8b08.jpg","nickname":"帅地","note":"","ucode":"854397F4DDF4BD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":28725,"discussion_content":"Q:redo log部分，为什么需要check point？不能仅使用write pos，每次等write pos达到文件末尾再统一将log都写入磁盘并清空log么？\nA：效率问题，文中的圆形图可能不太好直观理解，可以这么理解，当write pos写到第1页的时候，系统出现了空闲时间，这个时候将0页到check point之间的部分数据写入磁盘，那么这个时候粉板可用空间就是write pos到3号文件末尾，再加上0号文件到check point的部分.\n不知道我这么理解对不对 老师能帮忙看一下么","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1570710117,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1874999,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/9c/37/253ea895.jpg","nickname":"我不是码农","note":"","ucode":"EB4BB711CC54B6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549904,"discussion_content":"这个可以这样理解，因为是环，所以没有前后之分，但是特殊点是，两个指针相遇，这时候就得强制把checkpoint往前推，从而给write留出空间。所以，按该图所示，绿色部分是可以写的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644290718,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1276613,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/gmP4Yh00MZPwNvr4UQdLeXaX3TVyZEEp195S3vD3Sfl1xz5jBr1474Mt6w5OPr0KsrnQObfLRy5PkKNFjSBiasA/132","nickname":"大头爸爸","note":"","ucode":"131E25DB04D222","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382488,"discussion_content":"Checkpoint可以理解为read pos吗？生产者当前位置是write pos，消费者当前位置是read pos。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625602844,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2403638,"avatar":"https://static001.geekbang.org/account/avatar/00/24/ad/36/a0df434f.jpg","nickname":"几里","note":"","ucode":"09E1C5618F1349","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":343815,"discussion_content":"有个疑问，有没有可能，这里当writepoint和checkpoint重合，但redolog并没有写满，是不是会出现假溢出呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611190355,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2027258,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/ee/fa/31361552.jpg","nickname":"X","note":"","ucode":"688D816A4931CA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":313228,"discussion_content":"图确确实实是被换，你们可以去搜搜看百度，以前的图看起来更容易理解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603007404,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1797227,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/1cHhkdhZpcfR9Idmno3wbJn0osVlHibicM2qZnF3Ew0ibpsvsCQxErIffkvIB7IUJYoUnGibj1ib07naL4icV5o1KKdQ/132","nickname":"Geek_3a23c0","note":"","ucode":"0E29C6465549B0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":153591,"discussion_content":"的确有点懵啊，空着的部分是不是绿色的部分啊？跟老师的描述好像有点不符啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580051590,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1739011,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/89/03/8498c7d5.jpg","nickname":"小K","note":"","ucode":"DA39D5CC847BEE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":135168,"discussion_content":"老师这里的描述好捉急啊，难道换图了吗？现在图里不就是只有两个颜色吗？空闲部分到底是不是“绿色”部分？？？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579075131,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39771,"user_name":"高枕","can_delete":false,"product_type":"c1","uid":1310312,"ip_address":"","ucode":"20F6CF75EC9AA4","user_header":"https://static001.geekbang.org/account/avatar/00/13/fe/68/e0bebd9a.jpg","comment_is_top":false,"comment_ctime":1542352771,"is_pvip":false,"replies":[{"id":"14273","content":"👍🏿，get 完成","user_name":"作者回复","comment_id":39771,"uid":"1264162","ip_address":"","utype":1,"ctime":1542354653,"user_name_real":"林晓斌"}],"discussion_count":80,"race_medal":0,"score":"4240675073923","product_id":100020801,"comment_content":"我再来说下自己的理解 。<br>1 prepare阶段 2 写binlog 3 commit<br>当在2之前崩溃时<br>重启恢复：后发现没有commit，回滚。备份恢复：没有binlog 。<br>一致<br>当在3之前崩溃<br>重启恢复：虽没有commit，但满足prepare和binlog完整，所以重启后会自动commit。备份：有binlog. 一致","like_count":988,"discussions":[{"author":{"id":1081312,"avatar":"https://static001.geekbang.org/account/avatar/00/10/7f/e0/8eae4cd6.jpg","nickname":"code","note":"","ucode":"4E9776712684F5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":51753,"discussion_content":"    它们有一个共同的数据字段,叫XID。崩溃恢复的时候,会按照顺序扫描redo log:\n   1.如果碰到既有prepare、又有commit的redo log,就直接提交\n   2.如果碰到只有prepare、而没有commit的redo log,就拿着XID去binlog找对应的事务","likes_number":71,"is_delete":false,"is_hidden":false,"ctime":1573921878,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":9,"child_discussions":[{"author":{"id":1271428,"avatar":"https://static001.geekbang.org/account/avatar/00/13/66/84/4c594c6f.jpg","nickname":"大熊","note":"","ucode":"B84215F6A817D1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1081312,"avatar":"https://static001.geekbang.org/account/avatar/00/10/7f/e0/8eae4cd6.jpg","nickname":"code","note":"","ucode":"4E9776712684F5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":77961,"discussion_content":"感谢，看文章时的一个疑惑","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1575961788,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":51753,"ip_address":""},"score":77961,"extra":""},{"author":{"id":1810051,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK0uyg1IicbEhLwsgM2A2ROoyVdWdmUqZfQfs6G67w9m3hdRNBMOQJatQoACj3qNGgj2KVIgricaYiaQ/132","nickname":"木得感情的编码机器","note":"","ucode":"9C6CD47ADCB8E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1081312,"avatar":"https://static001.geekbang.org/account/avatar/00/10/7f/e0/8eae4cd6.jpg","nickname":"code","note":"","ucode":"4E9776712684F5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164297,"discussion_content":"如果redo log很大，那么重启时磁盘I/O是不是很吃力？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1581167644,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":51753,"ip_address":""},"score":164297,"extra":""},{"author":{"id":1360250,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erFY9H3mxyTpZ9gxAmdeKic565hicicDZmv7cjswd8hdernmxib0chdQrlDNKUZQ8AticQCgDdgVEmJNuA/132","nickname":"牧鱼","note":"","ucode":"0EB8FDD7A4BB2E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1810051,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK0uyg1IicbEhLwsgM2A2ROoyVdWdmUqZfQfs6G67w9m3hdRNBMOQJatQoACj3qNGgj2KVIgricaYiaQ/132","nickname":"木得感情的编码机器","note":"","ucode":"9C6CD47ADCB8E6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":221182,"discussion_content":"是的","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1585986767,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":164297,"ip_address":""},"score":221182,"extra":""}]},{"author":{"id":1435803,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e8/9b/de4e4aaa.jpg","nickname":"O O","note":"","ucode":"F5B9F61D6411C4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":275551,"discussion_content":"如果要检查binlog，那prepare存在的意义是什么，我直接检验binlog的完整性就可以了。任何涉及两个系统提交的任务都会存在不一致的可能性，而且这种可能性无法完全消除，只能减少这种风险，prepare机制是把写binlog时间段的风险降低到commit更低时间段，从而降低不一致的风险，分布式事务也是同理，不管怎么设计，都是存在不一致风险的","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1590728536,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":5,"child_discussions":[{"author":{"id":1350991,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9d/4f/273ffb51.jpg","nickname":"小哪吒","note":"","ucode":"252087A733355C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1435803,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e8/9b/de4e4aaa.jpg","nickname":"O O","note":"","ucode":"F5B9F61D6411C4","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":292654,"discussion_content":"binlog 只记录逻辑操作，并无操作状态，即无法确定该操作是否完成。redo log是有状态的，所以没办法直接检查binlog。只有在redo log状态为prepare时，才会去检查binlog是否存在，否则只校验redo log是否是 commit就可以啦。","likes_number":10,"is_delete":false,"is_hidden":false,"ctime":1595296268,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":275551,"ip_address":""},"score":292654,"extra":""},{"author":{"id":2189226,"avatar":"https://static001.geekbang.org/account/avatar/00/21/67/aa/95817353.jpg","nickname":"Summer","note":"","ucode":"AFF9C7061A78C5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1350991,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9d/4f/273ffb51.jpg","nickname":"小哪吒","note":"","ucode":"252087A733355C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":323060,"discussion_content":"这里的逻辑操作是指什么，物理操作又是什么","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604881023,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":292654,"ip_address":""},"score":323060,"extra":""},{"author":{"id":1350991,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9d/4f/273ffb51.jpg","nickname":"小哪吒","note":"","ucode":"252087A733355C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2189226,"avatar":"https://static001.geekbang.org/account/avatar/00/21/67/aa/95817353.jpg","nickname":"Summer","note":"","ucode":"AFF9C7061A78C5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335350,"discussion_content":"可以简单理解为，，逻辑操作记录了「做了什么事儿，并无记录有没有做成功」，物理操作是「在哪儿做了这些事儿，有没有成功」。","likes_number":8,"is_delete":false,"is_hidden":false,"ctime":1608171490,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":323060,"ip_address":""},"score":335350,"extra":""}]},{"author":{"id":1586908,"avatar":"https://static001.geekbang.org/account/avatar/00/18/36/dc/97369381.jpg","nickname":"张钟强","note":"","ucode":"EE0D5CAEDBBAC8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":177124,"discussion_content":"如果修改的数据特别多，binlog日志需要分批写入，如果写了一半，就crash了，怎么能知道binlog日志是否写入完整？如果不知道是否完整的话，重启后如何操作？","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1582079957,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1406090,"avatar":"https://static001.geekbang.org/account/avatar/00/15/74/8a/d5b0cf30.jpg","nickname":"kyl","note":"","ucode":"DBDFD0FEB5A135","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293195,"discussion_content":"优秀，一直没明白commit之前崩溃是什么状况，原来会自动commit","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1595474174,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1795385,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/65/39/9cf81d07.jpg","nickname":"╮Jesse 、","note":"","ucode":"E0B1D69EEB0EC9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":167546,"discussion_content":"这个结论我认为不对，理由:\n1，bin-log不一定就是开启状态\n2，bin-log就算开启也不能用来确认做恢复时是否提交事务还是回滚事务的操作，假设一个事务中，有两条更新语句，第一条更新执行成功，innodb将redolog状态置为prepare，server层写binlog，当执行第二条update 时数据库崩溃，事务都还没有来得急提交，按照你的结论，这个事务会被提交，而事实上事务并没有执行完成。\n个人认为，如果在commit时数据库崩溃或者其他异常，就是事务执行失败。","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1581508242,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":8,"child_discussions":[{"author":{"id":1615539,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI6LXcIqb5K48nia8d4zmdsD1M9AZeyXoGrLzX5xvqfN0fqXOsYKUWLbZvZ8TtJCXWmYbCkCXg93dQ/132","nickname":"漏脚脖","note":"","ucode":"214AE52EC201E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1795385,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/65/39/9cf81d07.jpg","nickname":"╮Jesse 、","note":"","ucode":"E0B1D69EEB0EC9","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":173244,"discussion_content":"看到这个问题，又陷入了沉思。。哪个大神能解释一下Jesse的第2条","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1581841158,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":167546,"ip_address":""},"score":173244,"extra":""},{"author":{"id":1302556,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e0/1c/aa50dc27.jpg","nickname":"icyricky","note":"","ucode":"D63C285165309D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1795385,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/65/39/9cf81d07.jpg","nickname":"╮Jesse 、","note":"","ucode":"E0B1D69EEB0EC9","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":215129,"discussion_content":"一个事务的binlog是写在一起的，所以第2个假设本身就不成立。","likes_number":15,"is_delete":false,"is_hidden":false,"ctime":1585287694,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":167546,"ip_address":""},"score":215129,"extra":""},{"author":{"id":1073487,"avatar":"https://static001.geekbang.org/account/avatar/00/10/61/4f/e0b71e72.jpg","nickname":"我是谁","note":"","ucode":"D6C67E29D62EA9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1795385,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/65/39/9cf81d07.jpg","nickname":"╮Jesse 、","note":"","ucode":"E0B1D69EEB0EC9","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":265615,"discussion_content":"一个事务的两条更新语句都执行了才将redolog状态置为prepare吧","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1589421033,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":167546,"ip_address":""},"score":265615,"extra":""}]},{"author":{"id":1060113,"avatar":"https://static001.geekbang.org/account/avatar/00/10/2d/11/0ecbe9ea.jpg","nickname":"烈冬冰夏","note":"","ucode":"F2875FC596D4FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":133844,"discussion_content":"这样是不是有木有commit都没有影响 这感觉是不是多余的一步了","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1578994231,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2129471,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/ZV101y9OgicALx800PzFwJ9wjtnwu26UbgshGluQB5GkBKquCyHXVV7MRRP4Z3cMo64Ms9vYhUeV5kKKhFDDvlw/132","nickname":"Geek_0f20b0","note":"","ucode":"1B06C467E31627","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387617,"discussion_content":"当在3之前崩溃\n重启恢复：虽没有commit，但满足prepare和binlog完整，所以重启后会自动commit。备份：有binlog. 一致\n这个就是我要的答案","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1628305419,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1902437,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/07/65/47bfd83c.jpg","nickname":"Geek_62f8f3","note":"","ucode":"147DD53FBF1D1B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":379847,"discussion_content":"这个最评论最厉害，言简意赅！","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1624188107,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1834181,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/fc/c5/ff8b770e.jpg","nickname":"BugBean","note":"","ucode":"B51232281AD9BC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":220661,"discussion_content":"优秀，我想了半天想不出来","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1585913371,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1203288,"avatar":"https://static001.geekbang.org/account/avatar/00/12/5c/58/590d0a43.jpg","nickname":"请叫我紫皮书","note":"","ucode":"29F98AB3A5D98E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":202351,"discussion_content":"那这个redo log和binlog是如何关联的","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1583902164,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1583588,"avatar":"https://static001.geekbang.org/account/avatar/00/18/29/e4/ade74d94.jpg","nickname":"hejun","note":"","ucode":"DCF01B4159178F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1203288,"avatar":"https://static001.geekbang.org/account/avatar/00/12/5c/58/590d0a43.jpg","nickname":"请叫我紫皮书","note":"","ucode":"29F98AB3A5D98E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":246418,"discussion_content":"同问，难道说恢复程序会先检查prepare和binlog的记录是否都存在，再决定prepare是去commit还是rollback？","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1587739749,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":202351,"ip_address":""},"score":246418,"extra":""},{"author":{"id":1676302,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLNWRTm9x25GTHcIXn3le2EX3y86mY9ribRtLUPUgLlCfuxeKmqmt550CU1EDe8QVYMIrhRrp3sxBg/132","nickname":"YJ","note":"","ucode":"2F8969C83D2ECF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1203288,"avatar":"https://static001.geekbang.org/account/avatar/00/12/5c/58/590d0a43.jpg","nickname":"请叫我紫皮书","note":"","ucode":"29F98AB3A5D98E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":258636,"discussion_content":"通过事务ID关联的","likes_number":13,"is_delete":false,"is_hidden":false,"ctime":1588696725,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":202351,"ip_address":""},"score":258636,"extra":""}]},{"author":{"id":1217413,"avatar":"https://static001.geekbang.org/account/avatar/00/12/93/85/f5d9474c.jpg","nickname":"乔丹","note":"","ucode":"D832A9F97A0C7E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":163556,"discussion_content":"我开始就是这个疑惑。 如果在写完binlog 但是没有commit redolog  那么就会不一致。哈哈。 看到这个评论懂了。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1581085333,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1721824,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/45/e0/904ae497.jpg","nickname":"有人@我","note":"","ucode":"0D4227BA4B878B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":41508,"discussion_content":"我也在思考相同的问题，在3之前crash，redolog是prepare状态，binglog写入，mysql重启之后会自动commit？文章中并没有说呀","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1572442436,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429221,"discussion_content":"👍🏿，get 完成","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1542354653,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":3,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2762716,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/27/dc/b1b70730.jpg","nickname":"杨善阳","note":"","ucode":"3973CEB7CC8BA1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393384,"discussion_content":"解答了我的疑惑，厉害了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1631408089,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1941858,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Ff70ZuQbiaP0aUkNPasRkHfyIEyGLsMBd1EYQgQYZRoH85c4SsibWHJgA3u0X4Z8QyxHs17ausF2V4oN9hdYyfRg/132","nickname":"郑卫林","note":"","ucode":"13D14BDDCBC7AC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":358633,"discussion_content":"牛逼，我还在想这个怎么搞","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1616025132,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1018620,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8a/fc/d1dd57dd.jpg","nickname":"ipofss","note":"","ucode":"DE3061C9259F9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":354935,"discussion_content":"解决了我的困惑，重启后通过 阶段1+阶段2，推断出阶段3 已完成，妙","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1615365357,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1399424,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/9x5X5WYPsKD2UAsEhPthmZbWqcjk5VkrHyVspRbyjab4Nv0PsbZYiaUibciatOKZgVb5uTNtTsNRgJesVmWeTtlMA/132","nickname":"Geek_11dda3","note":"","ucode":"8942FD97809C9F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":347603,"discussion_content":"厉害，看完后唯一的问题被解决了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1612264689,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1399672,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ9w8F4hZ8Z4X2eqmbO4qW5q88dTMotdO68QojCwiaOJTvicwdl0p5nialDFzXxxUCO3LknWapg9tdnQ/132","nickname":"百灵鸟","note":"","ucode":"6E541BC3407701","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301194,"discussion_content":"那可以这样理解吗？系统崩溃的时候，如果binlog已经写了，没commit的系统会自动commit；如果写了redolog，没写binlog的都直接回滚。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1598435816,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1314724,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0f/a4/0b49469f.jpg","nickname":"木子00","note":"","ucode":"8F78CA722EB29B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1399672,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ9w8F4hZ8Z4X2eqmbO4qW5q88dTMotdO68QojCwiaOJTvicwdl0p5nialDFzXxxUCO3LknWapg9tdnQ/132","nickname":"百灵鸟","note":"","ucode":"6E541BC3407701","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303883,"discussion_content":"是的，就是这样理解的。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1599400129,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":301194,"ip_address":""},"score":303883,"extra":""},{"author":{"id":2365564,"avatar":"https://static001.geekbang.org/account/avatar/00/24/18/7c/91d6dd83.jpg","nickname":"红高粱","note":"","ucode":"0DD331C8E01A81","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1314724,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0f/a4/0b49469f.jpg","nickname":"木子00","note":"","ucode":"8F78CA722EB29B","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":334810,"discussion_content":"太可怕了，没有提交数据，实际上实际落盘，生死未知啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607996406,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":303883,"ip_address":""},"score":334810,"extra":""},{"author":{"id":1886331,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/c8/7b/153181d7.jpg","nickname":"夜辉","note":"","ucode":"9421385F51FF9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2365564,"avatar":"https://static001.geekbang.org/account/avatar/00/24/18/7c/91d6dd83.jpg","nickname":"红高粱","note":"","ucode":"0DD331C8E01A81","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377336,"discussion_content":"redo log commit才意味着事务提交成功，事务未提交当然不能保证数据的持久化，不然要放弃事务，或者回滚事务怎么办？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622606377,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":334810,"ip_address":""},"score":377336,"extra":""}]},{"author":{"id":1700307,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er9RraTibVnM1MicM7icUkmJwjhxcoBGx5ONKQwz80GK47dhYBzPicp9t6eXv7R8wRg4umepHEiaXat3DQ/132","nickname":"Geek_Stone","note":"","ucode":"73DF77A05D1600","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":35436,"discussion_content":"redolog的prepare已经记了，崩溃恢复之后如果发现binlog没记，会回滚这个事务；如果binlog记了，就认可这个事务并提交。那么本质上是以binlog为准的，redolog有没有commit阶段好像没什么区别，为何还要搞出两阶段提交的概念呢？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1571279901,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1681844,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/ZccFBM9wqKWZAicq7rN3tJGaibD9y0d6THJ1lknOGpdCQUjgU85W2XvibxTcaXHPhnRdjPstTamVVJFo2WRibRNB6A/132","nickname":"Geek_b3a962","note":"","ucode":"AC51C9390D32FB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1700307,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er9RraTibVnM1MicM7icUkmJwjhxcoBGx5ONKQwz80GK47dhYBzPicp9t6eXv7R8wRg4umepHEiaXat3DQ/132","nickname":"Geek_Stone","note":"","ucode":"73DF77A05D1600","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":53929,"discussion_content":"我也觉得很奇怪，没想明白","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574236412,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":35436,"ip_address":""},"score":53929,"extra":""},{"author":{"id":1781699,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/2f/c3/10c3b900.jpg","nickname":"霓虹深","note":"","ucode":"4B291E66D73D53","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1681844,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/ZccFBM9wqKWZAicq7rN3tJGaibD9y0d6THJ1lknOGpdCQUjgU85W2XvibxTcaXHPhnRdjPstTamVVJFo2WRibRNB6A/132","nickname":"Geek_b3a962","note":"","ucode":"AC51C9390D32FB","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":119024,"discussion_content":"redlog没写，崩溃恢复后，事物无效","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1578209473,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":53929,"ip_address":""},"score":119024,"extra":""},{"author":{"id":2055047,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/as9LQWnMq5HhG2syIxvPobMsFqF4B9LyicjAZI5bXQ7BWek0F5nAWIkaDX1LNxvyKC7kvts2YebgKU8neo5rVBA/132","nickname":"Geek_d8858e","note":"","ucode":"F14D4D229E1993","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1700307,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er9RraTibVnM1MicM7icUkmJwjhxcoBGx5ONKQwz80GK47dhYBzPicp9t6eXv7R8wRg4umepHEiaXat3DQ/132","nickname":"Geek_Stone","note":"","ucode":"73DF77A05D1600","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":292462,"discussion_content":"我理解因为要保证crash safe. 如果发生了重启，恢复数据来检查redolog，发现是记录是commit状态则写入磁盘，如果是prepare状态才会去检查binlog，如果有则提交事务，没有则回滚。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595235400,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":35436,"ip_address":""},"score":292462,"extra":""}]},{"author":{"id":1019332,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","nickname":"长期规划","note":"","ucode":"5EF65E9115834B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2364,"discussion_content":"优秀。原来一致是重启恢复和备份恢复的一致啊，明白了，谢谢。redo log只用于重启恢复，binIog只用于备份恢复，对吧","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1563518949,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1297858,"avatar":"https://static001.geekbang.org/account/avatar/00/13/cd/c2/4ffdf37b.jpg","nickname":"DJZhu","note":"","ucode":"82866CD74F1A6F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1019332,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","nickname":"长期规划","note":"","ucode":"5EF65E9115834B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":45894,"discussion_content":"所以重启恢复 和 备份恢复 的差别是什么咧？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573095354,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":2364,"ip_address":""},"score":45894,"extra":""},{"author":{"id":1019332,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","nickname":"长期规划","note":"","ucode":"5EF65E9115834B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1297858,"avatar":"https://static001.geekbang.org/account/avatar/00/13/cd/c2/4ffdf37b.jpg","nickname":"DJZhu","note":"","ucode":"82866CD74F1A6F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":45996,"discussion_content":"你这么一问，我又仔细想了想，也有点蒙，我个人感觉InnoDB使用binlog也能实现事务的异常重启。但它非要加一个redo log，可能是binlog太大，用于异常重启后的加载慢？既然有redo log，那重启时，数据的最终状态是由redo log和binlog一起决定的。我们假设数据库A异常关闭，重启后最终的数据集为S1；另一个全新的数据库B，用数据库A的binlog在B上重放，数据库B启动后数据集为S2。我们希望S1==S2。数据库A重启时redo log不为空，S1由redo log和binlog共同决定，而数据库B是新库，重启时，redo log为空，S2由binlog决定。为了让S1=S2，就要保证redo log与binlog对齐。S1是重启恢复，S2是备份恢复。我个人的理解，不一定对哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573107894,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":45894,"ip_address":""},"score":45996,"extra":""},{"author":{"id":1739011,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/89/03/8498c7d5.jpg","nickname":"小K","note":"","ucode":"DA39D5CC847BEE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1297858,"avatar":"https://static001.geekbang.org/account/avatar/00/13/cd/c2/4ffdf37b.jpg","nickname":"DJZhu","note":"","ucode":"82866CD74F1A6F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":135231,"discussion_content":"重启恢复的场景是，还没有来得及将数据持久化到磁盘，系统奔溃了。可以利用redolog恢复。\n备份恢复是，手动取出之前的备份，再用binlog补充到想要的时间点上。","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1579078692,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":45894,"ip_address":""},"score":135231,"extra":""}]},{"author":{"id":1667040,"avatar":"","nickname":"Geek_75a893","note":"","ucode":"C80D507E699CCA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586506,"discussion_content":"看二阶段提交的时候有这个疑惑，评论解决了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662279884,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1225224,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b2/08/92f42622.jpg","nickname":"尔冬橙","note":"","ucode":"0B013A49BC18DA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571486,"discussion_content":"还有一个问题在于，业务什么时候能收到修改成功的通知的，是redo log commit后么？ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652239660,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1476423,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL283nVzjAHOC3C9uM2eJLWKOSPWsuypMFibcLuaUaW2icpC2YjtB6LU2TqibsMicSib4ZbJAfhHH3jOVQ/132","nickname":"firechou","note":"","ucode":"9C0110C2D64ECB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555310,"discussion_content":"在评论里终于找到了我想要的答案","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646842856,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1209049,"avatar":"https://static001.geekbang.org/account/avatar/00/12/72/d9/488739d1.jpg","nickname":"张卓","note":"","ucode":"AD840AF264C32E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549744,"discussion_content":"那redolog感觉没什么意义了，按binlog恢复就行了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644224145,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1404934,"avatar":"https://static001.geekbang.org/account/avatar/00/15/70/06/f994debc.jpg","nickname":"海阔天空","note":"","ucode":"B96E4E9B013613","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537076,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638951323,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2845977,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/6d/19/204b0900.jpg","nickname":"Black Jack","note":"","ucode":"CB16C8F44EF422","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536069,"discussion_content":"写的简单明了，标记一下哈，","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638673832,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1371678,"avatar":"https://static001.geekbang.org/account/avatar/00/14/ee/1e/e5fdc6ea.jpg","nickname":"106","note":"","ucode":"C265B944EBED41","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":413782,"discussion_content":"解决疑惑！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636558111,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2704096,"avatar":"https://static001.geekbang.org/account/avatar/00/29/42/e0/82a01495.jpg","nickname":"StrMon","note":"","ucode":"F6F9B116E364BE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384380,"discussion_content":"如何判断在2之前还是3之前崩溃的？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626531436,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2671226,"avatar":"","nickname":"Geek_6a3c4b","note":"","ucode":"94E5A47FEA78BB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382455,"discussion_content":"老哥稳","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625578906,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1155275,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a0/cb/aab3b3e7.jpg","nickname":"张三丰","note":"","ucode":"3A6215A40B3B21","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374677,"discussion_content":"3之前的崩溃总结太片面，如果prepare和binlog不完整呢？ prepare阶段redo log 持久化了  ，这时候mysql宕机  ，事务回滚，已经持久化的redo log怎么办？  是删除还是保留？如果保留，虽然不会被其他事务读到但是有浪费资源的嫌疑，当mysql恢复的时候这段持久化的redo log会被重新加载至内存？然后根据这段redo log 重放 binlog？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621311951,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1886331,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/c8/7b/153181d7.jpg","nickname":"夜辉","note":"","ucode":"9421385F51FF9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1155275,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a0/cb/aab3b3e7.jpg","nickname":"张三丰","note":"","ucode":"3A6215A40B3B21","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377335,"discussion_content":"prepare不完整，相当于无效，无视；\n同理日志不完整，也是无效，无视；\n事务的数据不会持久化到磁盘上；\nbinlog日志是追加的，redo日志是循环写的，之前写的不用管；","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622606285,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":374677,"ip_address":""},"score":377335,"extra":""}]},{"author":{"id":2541855,"avatar":"https://static001.geekbang.org/account/avatar/00/26/c9/1f/ad8508be.jpg","nickname":"哈哈😄","note":"","ucode":"D9F952757C37B6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364842,"discussion_content":"如何判断有binlog吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617625426,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":5,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2353310,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIjUDIRQ0gRicqTxDm3MeIe1yjCrJuHMMbOD0QHKicx1KOibHwqn0tV8DQqvO3cmSpyjtacFm5jY9yxA/132","nickname":"AK47","note":"","ucode":"0A3F94DBA8C2AB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":361810,"discussion_content":"正在想这个问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616761636,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":5,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2231383,"avatar":"https://static001.geekbang.org/account/avatar/00/22/0c/57/a2d5ff93.jpg","nickname":"军训时间","note":"","ucode":"CB9E835E5EF0EF","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":354272,"discussion_content":"M","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615266315,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":5,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1723580,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/4c/bc/d9ef313e.jpg","nickname":"。","note":"","ucode":"BFEF2648FE8A85","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351750,"discussion_content":"mark一下，这么解释很好理解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614423852,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":5,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1792714,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/5a/ca/4d5d23d1.jpg","nickname":"Im me","note":"","ucode":"FF7DEED4BB4C37","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":328396,"discussion_content":"这一层的评论太优秀了，大家都在思考，也解答了我的疑惑，感谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606134114,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":5,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1200020,"avatar":"https://static001.geekbang.org/account/avatar/00/12/4f/94/05044c31.jpg","nickname":"踢车牛","note":"","ucode":"D6D793EF5314A0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":178763,"discussion_content":"优秀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582194996,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":5,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1395602,"avatar":"https://static001.geekbang.org/account/avatar/00/15/4b/92/03338a22.jpg","nickname":"王圣军","note":"","ucode":"1E13CF683137D1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":122862,"discussion_content":"这个问题也解决了我的一个疑问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578377320,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":5,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1759947,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epMibvaCUaca7IhdeAMID7YT921tIJcicJsRmTv5We02Lje88LicfmiciaM5UmmWTH6p8RewMRZbA85QGA/132","nickname":"Geek_134276","note":"","ucode":"1E5A61D4D02E4A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":80050,"discussion_content":"1.binlog没有记录 redolog是怎么回滚的 使用undolog吗  2.为什么没有commit, binlog会有记录呢 不是commit之后才写入的吗  大佬求指点","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576141884,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":5,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1745116,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/a0/dc/38cbb1b4.jpg","nickname":"zhen","note":"","ucode":"FDC8EB8A5941D2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":76043,"discussion_content":"解决了我的困惑","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575806994,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":5,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1484192,"avatar":"https://static001.geekbang.org/account/avatar/00/16/a5/a0/e0cccf7e.jpg","nickname":"圆圆满满","note":"","ucode":"396E7A822014D1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":29216,"discussion_content":"那如果binlog关闭了呢？是不是就没有两阶段提交了？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570755404,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":5,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1237199,"avatar":"https://static001.geekbang.org/account/avatar/00/12/e0/cf/43f201f2.jpg","nickname":"幼儿编程教学","note":"","ucode":"F13F3150E6CAE9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1484192,"avatar":"https://static001.geekbang.org/account/avatar/00/16/a5/a0/e0cccf7e.jpg","nickname":"圆圆满满","note":"","ucode":"396E7A822014D1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":30579,"discussion_content":"两阶段提交应该还是有的，只是，出现的情况会不一样吧。都是在3之前挂掉，\n有binlog，因为binlog有记录，会自动commit\n没binlog，因为没有记录 会commit还是rollback?大家谁能说说?","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1570843701,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":29216,"ip_address":""},"score":30579,"extra":""},{"author":{"id":1274495,"avatar":"https://static001.geekbang.org/account/avatar/00/13/72/7f/5da093c5.jpg","nickname":"水目沾","note":"","ucode":"FDD1D15C277D58","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1484192,"avatar":"https://static001.geekbang.org/account/avatar/00/16/a5/a0/e0cccf7e.jpg","nickname":"圆圆满满","note":"","ucode":"396E7A822014D1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":232989,"discussion_content":"两阶段提交时针对redolog 来说的，无论 binlog是否存在，redolog都会分为两个阶段。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586881213,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":29216,"ip_address":""},"score":232989,"extra":""}]},{"author":{"id":1241121,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f0/21/7168f973.jpg","nickname":"JStFs","note":"","ucode":"636E85653555DD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":23491,"discussion_content":"就在找这个问题的答案！！主要就是当在3之前崩溃：重启恢复需要把redo中的prepare状态特别对待，那就是去找相关的的binlog，找到则认为commit了，找不到则丢弃，不然无法从逻辑上保证2和3的原子性，不知道我理解是否正确……","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569826110,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":6,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1759947,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epMibvaCUaca7IhdeAMID7YT921tIJcicJsRmTv5We02Lje88LicfmiciaM5UmmWTH6p8RewMRZbA85QGA/132","nickname":"Geek_134276","note":"","ucode":"1E5A61D4D02E4A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1241121,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f0/21/7168f973.jpg","nickname":"JStFs","note":"","ucode":"636E85653555DD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":80052,"discussion_content":"为什么会在commit之前写入binlog","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576142142,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":23491,"ip_address":""},"score":80052,"extra":""}]},{"author":{"id":1309929,"avatar":"https://static001.geekbang.org/account/avatar/00/13/fc/e9/34437e7f.jpg","nickname":"老申家的哈哈","note":"","ucode":"CE9C851CB95DF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":852,"discussion_content":"回滚和不回滚的依据是有没有写入binlog?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562122860,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":6,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39880,"user_name":"某、人","can_delete":false,"product_type":"c1","uid":1308784,"ip_address":"","ucode":"ADB42AA12A11C1","user_header":"https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg","comment_is_top":false,"comment_ctime":1542374169,"is_pvip":false,"replies":[{"id":"14328","content":"其实在实现上5是调用了6的过程了的，所以是一回事。MySQL server 层和InnoDB层都保存了表结构，所以有书上描述时会拆开说。<br><br>这个描述很详细，同时还有点到我们后面要讲的内通（编辑快来，有人来砸场子啦😄😄）<br><br>","user_name":"作者回复","comment_id":39880,"uid":"1264162","ip_address":"","utype":1,"ctime":1542378427,"user_name_real":"林晓斌"}],"discussion_count":84,"race_medal":0,"score":"2651537195801","product_id":100020801,"comment_content":"1.首先客户端通过tcp&#47;ip发送一条sql语句到server层的SQL interface<br>2.SQL interface接到该请求后，先对该条语句进行解析，验证权限是否匹配<br>3.验证通过以后，分析器会对该语句分析,是否语法有错误等<br>4.接下来是优化器器生成相应的执行计划，选择最优的执行计划<br>5.之后会是执行器根据执行计划执行这条语句。在这一步会去open table,如果该table上有MDL，则等待。<br>如果没有，则加在该表上加短暂的MDL(S)<br>(如果opend_table太大,表明open_table_cache太小。需要不停的去打开frm文件)<br>6.进入到引擎层，首先会去innodb_buffer_pool里的data dictionary(元数据信息)得到表信息<br>7.通过元数据信息,去lock info里查出是否会有相关的锁信息，并把这条update语句需要的<br>锁信息写入到lock info里(锁这里还有待补充)<br>8.然后涉及到的老数据通过快照的方式存储到innodb_buffer_pool里的undo page里,并且记录undo log修改的redo<br>(如果data page里有就直接载入到undo page里，如果没有，则需要去磁盘里取出相应page的数据，载入到undo page里)<br>9.在innodb_buffer_pool的data page做update操作。并把操作的物理数据页修改记录到redo log buffer里<br>由于update这个事务会涉及到多个页面的修改，所以redo log buffer里会记录多条页面的修改信息。<br>因为group commit的原因，这次事务所产生的redo log buffer可能会跟随其它事务一同flush并且sync到磁盘上<br>10.同时修改的信息，会按照event的格式,记录到binlog_cache中。(这里注意binlog_cache_size是transaction级别的,不是session级别的参数,<br>一旦commit之后，dump线程会从binlog_cache里把event主动发送给slave的I&#47;O线程)<br>11.之后把这条sql,需要在二级索引上做的修改，写入到change buffer page，等到下次有其他sql需要读取该二级索引时，再去与二级索引做merge<br>(随机I&#47;O变为顺序I&#47;O,但是由于现在的磁盘都是SSD,所以对于寻址来说,随机I&#47;O和顺序I&#47;O差距不大)<br>12.此时update语句已经完成，需要commit或者rollback。这里讨论commit的情况，并且双1<br>13.commit操作，由于存储引擎层与server层之间采用的是内部XA(保证两个事务的一致性,这里主要保证redo log和binlog的原子性),<br>所以提交分为prepare阶段与commit阶段<br>14.prepare阶段,将事务的xid写入，将binlog_cache里的进行flush以及sync操作(大事务的话这步非常耗时)<br>15.commit阶段，由于之前该事务产生的redo log已经sync到磁盘了。所以这步只是在redo log里标记commit<br>16.当binlog和redo log都已经落盘以后，如果触发了刷新脏页的操作，先把该脏页复制到doublewrite buffer里，把doublewrite buffer里的刷新到共享表空间，然后才是通过page cleaner线程把脏页写入到磁盘中<br>老师，你看我的步骤中有什么问题嘛？我感觉第6步那里有点问题,因为第5步已经去open table了，第6步还有没有必要去buffer里查找元数据呢?这元数据是表示的系统的元数据嘛,还是所有表的？谢谢老师指正","like_count":618,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429272,"discussion_content":"其实在实现上5是调用了6的过程了的，所以是一回事。MySQL server 层和InnoDB层都保存了表结构，所以有书上描述时会拆开说。\n\n这个描述很详细，同时还有点到我们后面要讲的内通（编辑快来，有人来砸场子啦😄😄）\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542378427,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1796510,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKo5jCPQW87sFySwXiaLxibak0qQYuFRTyy8RlNsO9JDyxBk1AYDrsphRskxzXPLPOW8ibWicWlRAnzwg/132","nickname":"Kevin","note":"","ucode":"C23E3390995D95","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312853,"discussion_content":"满级号来新手村？","likes_number":22,"is_delete":false,"is_hidden":false,"ctime":1602834581,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1206789,"avatar":"https://static001.geekbang.org/account/avatar/00/12/6a/05/5154e91e.jpg","nickname":"Moyou","note":"","ucode":"9EF86F426D5873","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":147650,"discussion_content":"写的太早了，适合把所有的章节学一遍，然后在来看。会发现真的写的很好，可以帮助复习和判断掌握情况。","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1579664143,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2034632,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/0b/c8/15f055d3.jpg","nickname":"图灵机","note":"","ucode":"EB02DB653AD591","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":284804,"discussion_content":"二刷，终于能看懂你这个执行流程分析了","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1592645265,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1613665,"avatar":"https://static001.geekbang.org/account/avatar/00/18/9f/61/c46b42f4.jpg","nickname":"talkyoung","note":"","ucode":"8D231FA9004B64","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":271992,"discussion_content":"哥们儿 你太顶了","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1590235599,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580672,"discussion_content":"二阶段提交写错了。prepare是将redo log落盘,commit包含两部分,首先落库binlog接着才更新redo状态为commit","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1658315607,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575737,"discussion_content":"我靠有额砸场子，建议你也开一个专栏就叫做mysql我是创始人肚里的蛔虫上知500年下知500年哈哈","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1655083241,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1308784,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg","nickname":"某、人","note":"","ucode":"ADB42AA12A11C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":242824,"discussion_content":"如果有mysql相关的问题，可以加我的qq 798229502，大家一起讨论，学习","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1587485037,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2009461,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/a9/75/dbccd12d.jpg","nickname":"稻草人","note":"","ucode":"6694EE2CD36B8C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1308784,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg","nickname":"某、人","note":"","ucode":"ADB42AA12A11C1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":353137,"discussion_content":"大神有没微信，可以创个微信群沟通学习~~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615021606,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":242824,"ip_address":""},"score":353137,"extra":""}]},{"author":{"id":1112676,"avatar":"https://static001.geekbang.org/account/avatar/00/10/fa/64/457325e6.jpg","nickname":"Sam Fu","note":"","ucode":"EA285A4943271F","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":413167,"discussion_content":"所以redo log的prepare阶段redo log已经落盘了吗？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1636388403,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1010914,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEIgYQgM25OaLGNWPUg5NSrQuCrPNicHqNgB9lsJGMalNU18sibF4cdYxKPuwgVsIc1m5ha5voHrY9Lg/132","nickname":"jacoffee","note":"","ucode":"B3BFD39138400B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1112676,"avatar":"https://static001.geekbang.org/account/avatar/00/10/fa/64/457325e6.jpg","nickname":"Sam Fu","note":"","ucode":"EA285A4943271F","race_medal":1,"user_type":1,"is_pvip":true},"discussion":{"id":413370,"discussion_content":"要看版本，在MySQL 5.6的时候虽然引入binlog组提交，但是只是针对commit阶段进行了拆分(flush stage, sync stage, commit stage)，但prepare阶段没变，redo log还是在这个阶段落盘了。 \n但是MySQL 5.7的时候，进一步优化将redo log落盘延迟到了组提交的flush stage(binlog cache也是在这个stage写入binlog的)。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1636458725,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":413167,"ip_address":""},"score":413370,"extra":""},{"author":{"id":1112676,"avatar":"https://static001.geekbang.org/account/avatar/00/10/fa/64/457325e6.jpg","nickname":"Sam Fu","note":"","ucode":"EA285A4943271F","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":1010914,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEIgYQgM25OaLGNWPUg5NSrQuCrPNicHqNgB9lsJGMalNU18sibF4cdYxKPuwgVsIc1m5ha5voHrY9Lg/132","nickname":"jacoffee","note":"","ucode":"B3BFD39138400B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":413501,"discussion_content":"所以5.6是，但是5.7redo log落盘是在commit阶段了是么 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636504989,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":413370,"ip_address":""},"score":413501,"extra":""}]},{"author":{"id":1682672,"avatar":"https://static001.geekbang.org/account/avatar/00/19/ac/f0/78ee760d.jpg","nickname":"Harvey","note":"","ucode":"AB529F37D31335","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":29124,"discussion_content":"MDL锁（metadata lock），用于解决或者保证DDL操作与DML操作之间的一致性,DDL 数据定义语言，即用来创建、删除、修改、库或表结构，对数据库或表的结构操作","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1570729412,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2736955,"avatar":"https://static001.geekbang.org/account/avatar/00/29/c3/3b/c9ae499f.jpg","nickname":"impwang","note":"","ucode":"149DF7CA8D56C9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589996,"discussion_content":"您好，&#39;redo log&#39;日志、binlog日志落盘和&#39;doublewrite buffer&#39;落盘存在必然的先后顺序吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665453974,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京"},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3186707,"avatar":"https://static001.geekbang.org/account/avatar/00/30/a0/13/abb7e8ae.jpg","nickname":"abscisse","note":"","ucode":"DF126B98F67575","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589736,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665293038,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1643836,"avatar":"https://static001.geekbang.org/account/avatar/00/19/15/3c/726c2690.jpg","nickname":"我将带头冲锋","note":"","ucode":"2FEB5A381C51BA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586343,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662115018,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京"},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3023126,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/21/16/47fa109e.jpg","nickname":"铁马冰河入梦来","note":"","ucode":"48EDA86C9CB47B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583678,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660288646,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"辽宁"},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1736913,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/80/d1/e7d7e4cb.jpg","nickname":"等到烟火清凉","note":"","ucode":"F0EF705C7D1587","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582203,"discussion_content":"点赞，是为了很方便二刷","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659315081,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3014853,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/00/c5/869f06b0.jpg","nickname":"a","note":"","ucode":"D827019539BDA3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580881,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658393867,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1133356,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4b/2c/ac55de5a.jpg","nickname":"野心","note":"","ucode":"33321FFC79D95C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579068,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657163129,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1101234,"avatar":"https://static001.geekbang.org/account/avatar/00/10/cd/b2/807137b9.jpg","nickname":"北方易初","note":"","ucode":"C57FDBD37F43E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576438,"discussion_content":"哥们你这个把源码的执行流程给翻译过来了吧？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655549002,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1159645,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b1/dd/c814190f.jpg","nickname":"巴子小","note":"","ucode":"1C3D35AEC235BB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556217,"discussion_content":"请问知识源来自哪里呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647251486,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1691447,"avatar":"https://static001.geekbang.org/account/avatar/00/19/cf/37/6ed137b9.jpg","nickname":"Dunk","note":"","ucode":"A8F5AB98382719","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542517,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640771131,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2853701,"avatar":"","nickname":"Geek5715","note":"","ucode":"ECB78CC6C1ABBC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536478,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638791805,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2366875,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/PiaZ7nNKht10ByTCOSaLX6X44BLOaq3ic4maYGdsv163iabLFfKRG5MvlmPbDK8wFCNicbOPfdbQJDPafKH4VWlLJg/132","nickname":"Geek_b3481d","note":"","ucode":"BC31A6472BDF3A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":413122,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636384524,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2541855,"avatar":"https://static001.geekbang.org/account/avatar/00/26/c9/1f/ad8508be.jpg","nickname":"哈哈😄","note":"","ucode":"D9F952757C37B6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":402528,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633913471,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1357029,"avatar":"https://static001.geekbang.org/account/avatar/00/14/b4/e5/aaee9287.jpg","nickname":"？","note":"","ucode":"D05D461F15D88A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":397416,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632618531,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1459774,"avatar":"https://static001.geekbang.org/account/avatar/00/16/46/3e/8c75af6d.jpg","nickname":"Z东","note":"","ucode":"037B2BB2715DBA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394106,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631722358,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1283125,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIWlliaQwAmTOPxD0HfeCARWWRUYThQUToJL9elyGSGbbKFhWibvk8a4SqZjS7icv2lxr5dNdiaIg7gxw/132","nickname":"Geek_7ec603","note":"","ucode":"7983219E0C1592","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386907,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627889506,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2714815,"avatar":"","nickname":"Geek_78d6d3","note":"","ucode":"3B7A595EEC5995","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386189,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627459351,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2436788,"avatar":"https://static001.geekbang.org/account/avatar/00/25/2e/b4/7263d51c.jpg","nickname":"👑🚪🐎","note":"","ucode":"793AEB38601EE3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385095,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626878776,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1910824,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/28/28/5dd38c93.jpg","nickname":"风采依旧飘","note":"","ucode":"EAF86CD80E3020","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382999,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625819097,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1150279,"avatar":"https://static001.geekbang.org/account/avatar/00/11/8d/47/c5da0357.jpg","nickname":"山大大大大","note":"","ucode":"9E7D9EB804AAE4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381915,"discussion_content":"小白有个问题辛苦帮忙解答下，如果redo log和bin log每次都刷到磁盘，理论上内存和磁盘是一致的，这个时候还会存在脏页吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625287901,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1308784,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg","nickname":"某、人","note":"","ucode":"ADB42AA12A11C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1150279,"avatar":"https://static001.geekbang.org/account/avatar/00/11/8d/47/c5da0357.jpg","nickname":"山大大大大","note":"","ucode":"9E7D9EB804AAE4","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393203,"discussion_content":"但是更新的数据不是每次都刷新到磁盘。脏页的意思是内存里的数据与磁盘的数据不一致","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631287133,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":381915,"ip_address":""},"score":393203,"extra":""}]},{"author":{"id":1120740,"avatar":"https://static001.geekbang.org/account/avatar/00/11/19/e4/c44496f8.jpg","nickname":"应律","note":"","ucode":"CDD4665DD7B8EA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":379388,"discussion_content":"大神，膜拜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623858473,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":5,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2656645,"avatar":"","nickname":"Geek_1ae747","note":"","ucode":"EC341F29398753","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378748,"discussion_content":"m","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623387037,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":5,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2047274,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/3d/2a/5c90358c.jpg","nickname":"子月十七","note":"","ucode":"FDCF1ABF9F2D74","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378186,"discussion_content":"m","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623081266,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":5,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1927689,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoKWvo0PoFkZicZebJdgkwLJFias6xJX1LV0lEv6BEzCYd9Riao4S2KibSIZnr19SvpU9x0ltYicNs5R2Q/132","nickname":"Geek_Tange","note":"","ucode":"59BD673180CA64","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373923,"discussion_content":"m","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620916021,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":5,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1577580,"avatar":"https://static001.geekbang.org/account/avatar/00/18/12/6c/61a598e9.jpg","nickname":"苏暮沉觞","note":"","ucode":"532B816D4EF47B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373159,"discussion_content":"M","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620635221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":5,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1135528,"avatar":"https://static001.geekbang.org/account/avatar/00/11/53/a8/abc96f70.jpg","nickname":"return","note":"","ucode":"42B8A3380DF04B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":371944,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620093718,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":5,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2609120,"avatar":"https://static001.geekbang.org/account/avatar/00/27/cf/e0/21ed0b3a.jpg","nickname":"maktub","note":"","ucode":"6BFA296EC2DB0F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":371857,"discussion_content":"1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620027090,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":5,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2573016,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK65G9jqbSDuoIOCjcuOTOsY0EF44MeTrA24UbQjPsxVsD72eb2MbTjcVjEwS2H3ibiaf6l8HV0KzYg/132","nickname":"Geek_519954","note":"","ucode":"AC336BF1B1C685","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":370444,"discussion_content":"m","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619414774,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":5,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1651441,"avatar":"https://static001.geekbang.org/account/avatar/00/19/32/f1/fd24d52b.jpg","nickname":"青禾qingh","note":"","ucode":"453FC435B03790","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":370028,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619255509,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":5,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1669749,"avatar":"https://static001.geekbang.org/account/avatar/00/19/7a/75/3c5a69f7.jpg","nickname":"做个俗人","note":"","ucode":"5FFF291791D2D4","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366228,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617983334,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":5,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1448781,"avatar":"","nickname":"Geek__8da7f9af6655","note":"","ucode":"00754A721E3D21","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364909,"discussion_content":"M\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617640601,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":6,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1255706,"avatar":"https://static001.geekbang.org/account/avatar/00/13/29/1a/729fda22.jpg","nickname":"TnT","note":"","ucode":"8CAE52531075AC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":363778,"discussion_content":"M","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617281133,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":6,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2537517,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/u1Zr9yTrTibSWicFFophCK9KQShrQ3f5hiaFIZktZHb3o07uM3qK3vkoiaQRbguduKCQckNUT7Qu3JVQMNkIv3pALg/132","nickname":"Geek_1687cc","note":"","ucode":"CD6CA9DFCD63B0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362442,"discussion_content":"mark\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616943007,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":6,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1068876,"avatar":"https://static001.geekbang.org/account/avatar/00/10/4f/4c/3bd8fa31.jpg","nickname":"kbrx93","note":"","ucode":"00200B68FBF4DF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":361582,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616689143,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":6,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1097790,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c0/3e/ff3ed621.jpg","nickname":"云起","note":"","ucode":"1642C543B47B87","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":358626,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616023033,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":6,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1095174,"avatar":"https://static001.geekbang.org/account/avatar/00/10/b6/06/2d7bed7b.jpg","nickname":"beacon","note":"","ucode":"40B688BA69724A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":358159,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615942754,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":6,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1152743,"avatar":"https://static001.geekbang.org/account/avatar/00/11/96/e7/57cf6b75.jpg","nickname":"明光村小队长","note":"","ucode":"F6088DAD9D9E37","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":357194,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615741164,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":6,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1413645,"avatar":"https://static001.geekbang.org/account/avatar/00/15/92/0d/909f9aab.jpg","nickname":"咖啡","note":"","ucode":"7A6AE43700CC8F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":356880,"discussion_content":"mark\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615695001,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":6,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2145161,"avatar":"https://static001.geekbang.org/account/avatar/00/20/bb/89/84212151.jpg","nickname":"大圣","note":"","ucode":"0190AE6EF37168","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":354052,"discussion_content":"我想问下第12如果回滚，第10处slave会如何处理？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615220707,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":6,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1308784,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg","nickname":"某、人","note":"","ucode":"ADB42AA12A11C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2145161,"avatar":"https://static001.geekbang.org/account/avatar/00/20/bb/89/84212151.jpg","nickname":"大圣","note":"","ucode":"0190AE6EF37168","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":357569,"discussion_content":"回滚的事务, binlog都不会落盘，更不会传到从库","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1615820460,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":354052,"ip_address":""},"score":357569,"extra":""}]},{"author":{"id":2294072,"avatar":"https://static001.geekbang.org/account/avatar/00/23/01/38/e9c84993.jpg","nickname":"旺仔小拳头","note":"","ucode":"A6713E0C1736F8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":353167,"discussion_content":"mark!","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615042819,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":6,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1959822,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/e7/8e/318cfde0.jpg","nickname":"Spoon","note":"","ucode":"2FF9193AD482C2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":353104,"discussion_content":"mark\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615006305,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":7,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1731047,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/GmtqEx7x5hagZtXbd8Xs8ocUuHHLGIgiaqTwTcibPnpla1PVTbed2Ax7ZfzCjN2Qpeyao6ogq7L3icLzSB3vY1rlg/132","nickname":"Chanson","note":"","ucode":"74B3B180B4B953","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":352516,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614760297,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":7,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1200264,"avatar":"https://static001.geekbang.org/account/avatar/00/12/50/88/ef2dd675.jpg","nickname":"Shum","note":"","ucode":"FB517E2E2E5289","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349765,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613528560,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":7,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1146153,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIbxgUM37rN7rwZC9rUzleQWwqsOrqmUpibu9CMDImnuB2oEQ8p00PicYqBr81OvDkukCmzpUcM7FZw/132","nickname":"McTavish","note":"","ucode":"D391381A90113E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348775,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612708522,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":7,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1302149,"avatar":"https://static001.geekbang.org/account/avatar/00/13/de/85/da98e390.jpg","nickname":"tyy","note":"","ucode":"C3B436E6562744","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":346670,"discussion_content":"这个步骤很详细啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612017988,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":7,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1043325,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/c9xpiakQ3OC1AlfCeW03lLnnb7mj5v35Hib8YDs66zpnVib2n2qFichFmFp2Ec4QDPR0dKh38MkBBLyD3bE4NiaanZQ/132","nickname":"龙晓","note":"","ucode":"FAF34F1C65D103","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":341221,"discussion_content":"某人读过源码吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610354767,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":7,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1627397,"avatar":"https://static001.geekbang.org/account/avatar/00/18/d5/05/8fd8ca4c.jpg","nickname":"快快乐乐","note":"","ucode":"D093D8D5836FF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":341209,"discussion_content":"一条update语句执行过程：\n1.首先客户端通过tcp/ip发送一条sql语句到server层的SQL interface\n2.SQL interface接到该请求后，验证权限是否匹配\n3.验证通过以后，分析器会对该语句分析,是否词法，语法，语义有错误等\n4.接下来是优化器器生成相应的执行计划，选择最优的执行计划\n5.之后会是执行器根据执行计划执行这条语句。在这一步会去open table,如果该table上有MDL，则等待。如果没有，则加在该表上加短暂的MDL(S)(如果opend_table太大,表明open_table_cache太小。需要不停的去打开frm文件)\n6.进入到引擎层，首先会去innodb_buffer_pool里的data dictionary(元数据信息)得到表信息\n7.通过元数据信息,去lock info【一种内存数据结构】里查出是否会有相关的锁信息，并把这条update语句需要的，锁信息写入到lock info里(锁这里还有待补充)\n\n8.然后涉及到的老数据通过快照的方式存储到innodb_buffer_pool里的undo page里,并且记录undo log修改的redo(如果数据页里有就直接载入到undo page里，如果没有，则需要去磁盘里取出相应page的数据，载入到undo page里)\n9.在innodb_buffer_pool的data page做update操作。并把操作的物理数据页修改记录到redo log buffer里\n由于update这个事务会涉及到多个页面的修改，所以redo log buffer里会记录多条页面的修改信息。因为group commit的原因，这次事务所产生的redo log buffer可能会跟随其它事务一同flush并且sync到磁盘上。\n10.同时修改的信息，会按照event的格式,记录到binlog_cache中。(这里注意binlog_cache_size是transaction级别的,不是session级别的参数,一旦commit之后【主从同步后面才执行】，dump线程会从binlog_cache里把event主动发送给slave的I/O线程)\n11.之后把这条sql,需要在二级索引上做的修改，写入到change buffer page，等到下次有其他sql需要读取该二级索引时，再去与二级索引做merge(随机I/O变为顺序I/O,但是由于现在的磁盘都是SSD,所以对于寻址来说,随机I/O和顺序I/O差距不大)\n12.此时update语句已经完成【完成数据页更改【内存里面】，redolog日志记录，undo日志记录，binlog缓存】，需要commit或者rollback。这里讨论commit的情况，并且双1\n由于存储引擎层与server层之间采用的是内部XA(保证两个事务的一致性,这里主要保证redo log和binlog的原子性),所以提交分为prepare阶段与commit阶段\n13.prepare阶段,将事务的xid写入，将binlog_cache里的进行flush以及sync操作(大事务的话这步非常耗时)【具体操作文件】\n14.commit阶段，由于之前该事务产生的redo log已经sync到磁盘了。所以这步只是在redo log里标记commit【轻量级操作】\n15.当binlog和redo log都已经落盘以后，如果触发了刷新脏页的操作，先把该脏页复制到doublewrite buffer里，把doublewrite buffer里的刷新到共享表空间，然后才是通过page cleaner线程把脏页写入到磁盘中。【刷新磁盘是最后操作】\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610351501,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":7,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1302149,"avatar":"https://static001.geekbang.org/account/avatar/00/13/de/85/da98e390.jpg","nickname":"tyy","note":"","ucode":"C3B436E6562744","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1627397,"avatar":"https://static001.geekbang.org/account/avatar/00/18/d5/05/8fd8ca4c.jpg","nickname":"快快乐乐","note":"","ucode":"D093D8D5836FF6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":346678,"discussion_content":"xid是写入redo log还是binlog？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612019090,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":341209,"ip_address":""},"score":346678,"extra":""}]},{"author":{"id":1627397,"avatar":"https://static001.geekbang.org/account/avatar/00/18/d5/05/8fd8ca4c.jpg","nickname":"快快乐乐","note":"","ucode":"D093D8D5836FF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":341204,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610350291,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":7,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2305167,"avatar":"https://static001.geekbang.org/account/avatar/00/23/2c/8f/aa45f6c4.jpg","nickname":"lambda","note":"","ucode":"D1990B7903913B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339401,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609658721,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":7,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1204353,"avatar":"https://static001.geekbang.org/account/avatar/00/12/60/81/eaf6d0ac.jpg","nickname":"拉布拉多","note":"","ucode":"637A88D9F29F57","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":338937,"discussion_content":"mark！谢谢指点！详细且没废话。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609429004,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":7,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1780698,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/2b/da/fa630993.jpg","nickname":"旧时光。","note":"","ucode":"E9612FD41567BD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":328103,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606055114,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":8,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1661535,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5a/5f/8a76aa8b.jpg","nickname":"Lordran","note":"","ucode":"7CCD5F52471BB1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":326667,"discussion_content":"第5有点疑问，如果是MDL(读)也需要等待？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605658598,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":8,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1308784,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg","nickname":"某、人","note":"","ucode":"ADB42AA12A11C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1661535,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5a/5f/8a76aa8b.jpg","nickname":"Lordran","note":"","ucode":"7CCD5F52471BB1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":326694,"discussion_content":"不会","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605663926,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":326667,"ip_address":""},"score":326694,"extra":""}]},{"author":{"id":2018869,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/FQQA0icGXUvJZicd7jX1r85MmH2XgpQUlkXNpB2u9OibCc1k3ITJwaqbZm7WQiaT93hWYDRBCJMsThuL62PLTaP5hQ/132","nickname":"ytyee","note":"","ucode":"05079CE049A8FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":320166,"discussion_content":"搞不太清楚这里，为啥有人说执行commit之前不一定写完redo log了，但看这里是确定写完redo log了，即prepare状态","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604280372,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":8,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2285456,"avatar":"https://static001.geekbang.org/account/avatar/00/22/df/90/0d8864db.jpg","nickname":"少晴","note":"","ucode":"31C290044F3B95","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2018869,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/FQQA0icGXUvJZicd7jX1r85MmH2XgpQUlkXNpB2u9OibCc1k3ITJwaqbZm7WQiaT93hWYDRBCJMsThuL62PLTaP5hQ/132","nickname":"ytyee","note":"","ucode":"05079CE049A8FA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":321294,"discussion_content":"我看了前面的评论，还有老师的回复，确定一点就是prepare状态的redo log是落盘的，即使后面的写binlog之前或者commit之前崩溃，redo log也是有记录了，只是此时状态是prepare。等你崩溃恢复的时候，redo log被读取和binlog做比较，发现数据不一致且redo log有prepare状态，且binlog没有这个记录，那么这个prepare就会被丢弃。如果binlog状态和这个prepare一致，那么就会直接commit。你可以翻一翻前面老师对一些评论的回复，就能找到答案","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1604560583,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":320166,"ip_address":""},"score":321294,"extra":""}]},{"author":{"id":2171958,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/ibdLHjEF6Xe5jBrsrUjRWFpgXXpLkVdHofLbILGBGfbwSbFudJM8ecDl5wZFOESy7a67ZicjZSeCQUvWt2koibk1g/132","nickname":"Geek_726d9a","note":"","ucode":"A4E794BF6A4E6D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":314522,"discussion_content":"不知道 mysql 8  和这个描述的过程还一不一样....","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603166712,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":8,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1308784,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg","nickname":"某、人","note":"","ucode":"ADB42AA12A11C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2171958,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/ibdLHjEF6Xe5jBrsrUjRWFpgXXpLkVdHofLbILGBGfbwSbFudJM8ecDl5wZFOESy7a67ZicjZSeCQUvWt2koibk1g/132","nickname":"Geek_726d9a","note":"","ucode":"A4E794BF6A4E6D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":324795,"discussion_content":"主流程几乎没有变化的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605171749,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":314522,"ip_address":""},"score":324795,"extra":""}]},{"author":{"id":2242740,"avatar":"https://static001.geekbang.org/account/avatar/00/22/38/b4/1843033d.jpg","nickname":"lh","note":"","ucode":"F048C6C0C7E8EA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":313295,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603026456,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":8,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1102959,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d4/6f/8563b3ba.jpg","nickname":"Sunny","note":"","ucode":"6A57AA315EE4E0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312441,"discussion_content":"mark 回看","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602686501,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":8,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1306889,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f1/09/a597fe8d.jpg","nickname":"西柚","note":"","ucode":"3DDC5D0972DAB0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301655,"discussion_content":"mark，流程写很细，有助于理解。修改数据后，索引是异步更新吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598599640,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":8,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1336634,"avatar":"https://static001.geekbang.org/account/avatar/00/14/65/3a/bc801fb2.jpg","nickname":"mqray","note":"","ucode":"15664507AD7033","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":299847,"discussion_content":"sssp ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597836362,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":8,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1119014,"avatar":"https://static001.geekbang.org/account/avatar/00/11/13/26/ea36255d.jpg","nickname":"Ace","note":"","ucode":"CBC5C5EED89708","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283170,"discussion_content":"大佬厉害了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592203374,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":8,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1237583,"avatar":"https://static001.geekbang.org/account/avatar/00/12/e2/4f/df01f65e.jpg","nickname":"Danfēng","note":"","ucode":"E5B3451F1D0441","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":278367,"discussion_content":"太强了，你是去扣源码了嘛？还是后面学了来写的？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591178289,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":8,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1948762,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/bc/5a/855160ca.jpg","nickname":"锋","note":"","ucode":"61A3ACB1D14CAF","race_medal":2,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":252348,"discussion_content":"学完一遍再看，太强了，我直接做成图了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588157914,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":9,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1210049,"avatar":"https://static001.geekbang.org/account/avatar/00/12/76/c1/86b86c72.jpg","nickname":"circle","note":"","ucode":"8A8811838576F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":242016,"discussion_content":"你好 大神 请问查询如果耗时很长 导致事务时间很长 对mysql影响大吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587457607,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":9,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1120844,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1a/4c/952608f4.jpg","nickname":"培根","note":"","ucode":"6C506B7D68BAE9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":240066,"discussion_content":"写的真的好 第三遍看了 仍然有收获","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587332985,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":9,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1239693,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ea/8d/2e1b6705.jpg","nickname":"小德","note":"","ucode":"F541817F301EE6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":162868,"discussion_content":"砸场子了。。。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581029785,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":9,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1062373,"avatar":"https://static001.geekbang.org/account/avatar/00/10/35/e5/0b60d57e.jpg","nickname":"tommy","note":"","ucode":"E6EDD4ECBA01D6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7792,"discussion_content":"太牛逼了，步骤好复杂，怎样掌握呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567675881,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":9,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42732,"user_name":"WL","can_delete":false,"product_type":"c1","uid":1173771,"ip_address":"","ucode":"6277DCD776B87E","user_header":"https://static001.geekbang.org/account/avatar/00/11/e9/0b/1171ac71.jpg","comment_is_top":false,"comment_ctime":1543029682,"is_pvip":false,"discussion_count":23,"race_medal":0,"score":"972205638578","product_id":100020801,"comment_content":"为该讲的内容总结了几个问题, 大家复习的时候可以先尝试回答这些问题检查自己的掌握程度:<br>   1. redo log的概念是什么? 为什么会存在.<br>   2. 什么是WAL(write-ahead log)机制, 好处是什么.<br>   3. redo log 为什么可以保证crash safe机制.<br>   4. binlog的概念是什么, 起到什么作用, 可以做crash safe吗? <br>   5. binlog和redolog的不同点有哪些? <br>   6. 物理一致性和逻辑一直性各应该怎么理解? <br>   7. 执行器和innoDB在执行update语句时候的流程是什么样的?<br>   8. 如果数据库误操作, 如何执行数据恢复?<br>   9. 什么是两阶段提交, 为什么需要两阶段提交, 两阶段提交怎么保证数据库中两份日志间的逻辑一致性(什么叫逻辑一致性)?<br>  10. 如果不是两阶段提交, 先写redo log和先写bin log两种情况各会遇到什么问题?","like_count":226,"discussions":[{"author":{"id":2300779,"avatar":"","nickname":"Geek_886bfd","note":"","ucode":"5F2A03D4ED7C30","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351791,"discussion_content":"1. redo log是重做日志。主要用于MySQL异常重启后的一种数据恢复手段，确保了数据的一致性。归根到底是MySQL为了实现WAL机制的一种手段。因为MySQL进行更新操作，为了能够快速响应，所以采用了异步写回磁盘的技术，写入内存后就返回。但是会存在crash后内存数据丢失的隐患，而redo log具备crash safe能力。\n2. WAL机制是写前日志，也就是MySQL更新操作后在真正把数据写入到磁盘前先记录日志。好处是不用每一次操作都实时把数据写盘，就算crash后也可以通过redo log重放恢复，所以能够实现快速响应SQL语句。\n3. 因为redo log是每次更新操作完成后，就一定会写入的，如果写入失败，这说明此次操作失败，事务也不可能提交。redo log内部结构是基于页的，记录了这个页的字段值变化，只要crash后读取redo log进行重放就可以恢复数据。（因为redo log是循环写的，如果满了InnoDB就会执行真正写盘）\n4. bin log是归档日志，属于MySQL Server层的日志。可以起到全量备份的作用。当需要恢复数据时，可以取出某个时间范围内的bin log进行重放恢复。但是bin log不可以做crash safe，因为crash之前，bin log可能没有写入完全MySQL就挂了。所以需要配合redo log才可以进行crash safe。\n5. bin log是Server层，追加写，不会覆盖，记录了逻辑变化，是逻辑日志。redo log是存储引擎层，是InnoDB特有的。循环写，满了就覆盖从头写，记录的是基于页的物理变化，是物理日志，具备crash safe操作。\n6. 前者是数据的一致性，后者是行为一致性。（不清楚）\n7. 执行器在优化器选择了索引后，调用InnoDB读接口，读取要更新的行到内存中，执行SQL操作后，更新到内存，然后写redo log，写bin log，此时即为完成。后续InnoDB会在合适的时候把此次操作的结果写回到磁盘。\n8. 数据库在某一天误操作，就可以找到距离误操作最近的时间节点前的bin log，重放到临时数据库里，然后选择当天误删的数据恢复到线上数据库。\n9. 两阶段提交就是对于三步操作而言：1.prepare阶段 2. 写入bin log 3. commit\nredo log在写入后，进入prepare状态，然后bin log写入后，进入commit状态，事务可以提交。\n如果不用两阶段提交的话，可能会出现bin log写入之前，机器crash导致重启后redo log继续重放crash之前的操作，而当bin log后续需要作为备份恢复时，会出现数据不一致的情况。所以需要对redo log进行回滚。\n如果是bin log commit之前crash，那么重启后，发现redo log是prepare状态且bin log完整（bin log写入成功后，redo log会有bin log的标记），就会自动commit，让存储引擎提交事务。\n10.先写redo log，crash后bin log备份恢复时少了一次更新，与当前数据不一致。先写bin log，crash后，由于redo log没写入，事务无效，所以后续bin log备份恢复时，数据不一致。","likes_number":40,"is_delete":false,"is_hidden":false,"ctime":1614437346,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":2509692,"avatar":"","nickname":"Geek_400b59","note":"","ucode":"5770C832C698EE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2300779,"avatar":"","nickname":"Geek_886bfd","note":"","ucode":"5F2A03D4ED7C30","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":356001,"discussion_content":"牛","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615515946,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":351791,"ip_address":""},"score":356001,"extra":""},{"author":{"id":1259876,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/KYvWM0tjH8j920S32qkGMDDeRJDIg4LoqRppe74AISyhYyKmGTcia3BvDqjvibhCicx7ncGSRbQyd2phR7ZUZwR6A/132","nickname":"落月","note":"","ucode":"10663079C7096F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2300779,"avatar":"","nickname":"Geek_886bfd","note":"","ucode":"5F2A03D4ED7C30","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381902,"discussion_content":"您好，两阶段提交中：\n如果是bin log commit之前crash，那么重启后，发现redo log是prepare状态且bin log完整（bin log写入成功后，redo log会有bin log的标记），就会自动commit，让存储引擎提交事务。\n\nbin log写入成功后，redo log会有bin log的标记。这个标记也是binlog发送给redo log标识binlog已经写入成功。问题在于，如果crash发生在binlog写入成功，但在redo log获取到标记之前呢？也就是这种情况下的一致，是靠什么机制实现的呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625283302,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":351791,"ip_address":""},"score":381902,"extra":""},{"author":{"id":1259876,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/KYvWM0tjH8j920S32qkGMDDeRJDIg4LoqRppe74AISyhYyKmGTcia3BvDqjvibhCicx7ncGSRbQyd2phR7ZUZwR6A/132","nickname":"落月","note":"","ucode":"10663079C7096F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2300779,"avatar":"","nickname":"Geek_886bfd","note":"","ucode":"5F2A03D4ED7C30","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381909,"discussion_content":"如果是bin log commit之前crash。redo log是根据事务的XID去binlog中确认当前事务是否写入到了binlog。如果写入则redolog提交，未写入，则redolog回滚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625284564,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":351791,"ip_address":""},"score":381909,"extra":""}]},{"author":{"id":1314724,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0f/a4/0b49469f.jpg","nickname":"木子00","note":"","ucode":"8F78CA722EB29B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303891,"discussion_content":"这要是面试题。倒一大片。哈哈！","likes_number":9,"is_delete":false,"is_hidden":false,"ctime":1599401141,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"一元(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301119,"discussion_content":"我的理解是，binlog和redo log 都具备恢复能力，只是redo log是物理日志，恢复速度相较于 binglog的逻辑日志 恢复起来更快，所以redo log用于 crash时的数据丢失恢复，binlog用于恢复到一个之前的某个时间点的恢复。\n    其实redo 和binlog的存储结构也能引证我的想法，redo log是循环写的，不能存太多log，而binlog是“追加写的”只要内存大，理论上是无限制的，可以记录很长时间的log，也就适合恢复到之前任意时间点的数据库。\n    同时，我觉得说binlog没有crash-safe能力是不完全正确的，因为binlog显然是可以用于崩溃后的数据恢复（因为更新操作时的两次提交保证了binlog和redo log的数据写入是“同一个事务”），那为啥却说binlog没有crash-safa能呢？我想可能是历史原因，binlog从一开始就不是用于crash时的数据恢复，所以binlog虽然有crash-safe的能力，但是没有这个功能。\n","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1598411611,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":5,"child_discussions":[{"author":{"id":1134266,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4e/ba/580ec429.jpg","nickname":"小兔子乖乖","note":"","ucode":"E5CC0258CF8858","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"一元(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368131,"discussion_content":"如果数据页损坏的情况下，拿binlog是恢复不出来的吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618576805,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":301119,"ip_address":""},"score":368131,"extra":""},{"author":{"id":1135159,"avatar":"https://static001.geekbang.org/account/avatar/00/11/52/37/13b4c8aa.jpg","nickname":"Vincent","note":"","ucode":"CD8B84A57A6A0C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"一元(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383208,"discussion_content":"我觉得binlog 也有数据恢复能力，但是crash 瞬间的数据修复能力需要通过redo log 实现","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625991671,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":301119,"ip_address":""},"score":383208,"extra":""},{"author":{"id":2873900,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/da/2c/cdd92f3f.jpg","nickname":"wáng","note":"","ucode":"9BFEA73AD7680D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"一元(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549831,"discussion_content":"crash-safe和恢复不是一个概念，不能混为一谈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644248920,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":301119,"ip_address":""},"score":549831,"extra":""}]},{"author":{"id":1883760,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/be/70/ad0cad60.jpg","nickname":"ireader","note":"","ucode":"95F5DE9EBF090D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":314805,"discussion_content":"这种抓重点的思维怎么锻炼出来的\n","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1603199315,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1199343,"avatar":"https://static001.geekbang.org/account/avatar/00/12/4c/ef/c1593763.jpg","nickname":"Nick","note":"","ucode":"8F8BE8CE3B9EE9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":223500,"discussion_content":"不错的面试题 :)","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586230732,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1584208,"avatar":"https://static001.geekbang.org/account/avatar/00/18/2c/50/64365ef7.jpg","nickname":"zhoubo_eric","note":"","ucode":"34725AA3A9D59C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573116,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653207534,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2925869,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/a5/2d/dce6f248.jpg","nickname":"风中告退","note":"","ucode":"6D157E902BECEA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554014,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646187649,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2829144,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/2b/58/4a67284d.jpg","nickname":"九月清晨柳成荫","note":"","ucode":"431713477304F9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":413394,"discussion_content":"mark，不错的面试题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636462241,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2693719,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/6aIibPBt8LBr5KLnuDxllGYCo23Ol20ziajbHPwMl6CYIwybYrpxr8nJSUXYYSuAvdEuSallJCk7MSbw5o4coQ8w/132","nickname":"Geek_b4fbc6","note":"","ucode":"930441B1202678","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":413155,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636387161,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2038562,"avatar":"","nickname":"Geek_294566","note":"","ucode":"9FE3A2100EFB6B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388005,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628533008,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2714815,"avatar":"","nickname":"Geek_78d6d3","note":"","ucode":"3B7A595EEC5995","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386191,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627460053,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2436788,"avatar":"https://static001.geekbang.org/account/avatar/00/25/2e/b4/7263d51c.jpg","nickname":"👑🚪🐎","note":"","ucode":"793AEB38601EE3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385098,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626878873,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1668117,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJLgibqHsl97Oq3nvnEVz7V3kaGKLmia0Ja8c4yXO7QeLKiakganRJomNGgYToW4RnFs60zibDTHicjE5w/132","nickname":"学而不思则惘","note":"","ucode":"8ED2B08AA5A755","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":267212,"discussion_content":"有大佬来总结总结吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589615921,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1798979,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/73/43/ae139b1f.jpg","nickname":"博","note":"","ucode":"F7CA69FF5D09BA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1668117,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJLgibqHsl97Oq3nvnEVz7V3kaGKLmia0Ja8c4yXO7QeLKiakganRJomNGgYToW4RnFs60zibDTHicjE5w/132","nickname":"学而不思则惘","note":"","ucode":"8ED2B08AA5A755","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":274186,"discussion_content":"你来","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590551370,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":267212,"ip_address":""},"score":274186,"extra":""}]}]},{"had_liked":false,"id":39923,"user_name":"justd","can_delete":false,"product_type":"c1","uid":1197260,"ip_address":"","ucode":"A8857900C9FA18","user_header":"https://static001.geekbang.org/account/avatar/00/12/44/cc/3e62d111.jpg","comment_is_top":false,"comment_ctime":1542386451,"is_pvip":false,"discussion_count":10,"race_medal":0,"score":"796111336211","product_id":100020801,"comment_content":"一个完整的交易过程：账本记上 卖一瓶可乐（redo log为 prepare状态），然后收钱放入钱箱（bin log记录）然后回过头在账本上打个勾（redo log置为commit）表示一笔交易结束。<br>如果收钱时交易被打断，回过头来整理此次交易，发现只有记账没有收钱，则交易失败，删掉账本上的记录（回滚）；如果收了钱后被终止，然后回过头发现账本有记录（prepare）而且钱箱有本次收入（bin log），则继续完善账本（commit），本次交易有效。<br>","like_count":186,"discussions":[{"author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"一元(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301118,"discussion_content":"我觉得这里的binlog和redo log的描述对调一下应该更贴切一下，redo log 记录 支付宝收款3元，并将其状态置为prepare ，然后 binlog记录卖了一瓶可乐。因为 redo log是物理日志，记录底层的数据改变，恢复时更快，所以用于crash情况的数据恢复；而binlog是原始逻辑，对应的是更高维度的变化，记录起来更加简洁，但恢复速度相对慢些，用于恢复某一个时间点的状态。\n     其实redo 和binlog的存储结构也能引证我的想法，redo log是循环写的，不能存太多log，因为记录底层数据变化可能更为复制。而binlog是“追加写的”只要内存大，理论上是无限制的，可以记录很长时间的log，也就适合恢复到之前任意时间点的数据库。","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1598411489,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1119671,"avatar":"https://static001.geekbang.org/account/avatar/00/11/15/b7/1dbe1539.jpg","nickname":"伯力_双城子","note":"","ucode":"09550C7D20986A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":137244,"discussion_content":"点赞","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1579182752,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2222074,"avatar":"https://static001.geekbang.org/account/avatar/00/21/e7/fa/75fb3d90.jpg","nickname":"solo　-","note":"","ucode":"B762DB461B590C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311370,"discussion_content":"大哥 太牛了 赞！","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1602318730,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2027229,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoibIPRa2kiaqficmBgJzgKE19dhZeXTCcGewveAxT9icn1aZwMsHIZkic6nsfn9g62nEzbJJREHicjTnTQ/132","nickname":"Geek_d3cb3f","note":"","ucode":"C492BFED3A38A9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306393,"discussion_content":"厉害了！","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1600261409,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2020865,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/d6/01/eaa50203.jpg","nickname":"zft","note":"","ucode":"74DEC5FBA610B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":275931,"discussion_content":"写的真好","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1590768863,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1502693,"avatar":"","nickname":"Geek_f0a5c7","note":"","ucode":"F331C3A2E02A00","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":264937,"discussion_content":"很清晰","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1589360126,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1074805,"avatar":"https://static001.geekbang.org/account/avatar/00/10/66/75/54bb858e.jpg","nickname":"life is short, enjoy more.","note":"","ucode":"3B5F37D30790A7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":24996,"discussion_content":"很形象了，多谢！","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1570365570,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2671226,"avatar":"","nickname":"Geek_6a3c4b","note":"","ucode":"94E5A47FEA78BB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381294,"discussion_content":"redo log 的commit作用是什么啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624981957,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1204353,"avatar":"https://static001.geekbang.org/account/avatar/00/12/60/81/eaf6d0ac.jpg","nickname":"拉布拉多","note":"","ucode":"637A88D9F29F57","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":338972,"discussion_content":"很形象，非常好理解和记忆","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609466032,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1486782,"avatar":"https://static001.geekbang.org/account/avatar/00/16/af/be/ed64f835.jpg","nickname":"AlwaysJuly","note":"","ucode":"C2F6FAB17EC931","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":310331,"discussion_content":"棒，刚刚在想如果redolog commit阶段异常如何处理？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601779535,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39739,"user_name":"清歌","can_delete":false,"product_type":"c1","uid":1014496,"ip_address":"","ucode":"4545455E12F907","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7a/e0/3d5b28ef.jpg","comment_is_top":false,"comment_ctime":1542344276,"is_pvip":false,"replies":[{"id":"14251","content":"这样理解哈。 <br><br>逻辑日志可以给别的数据库，别的引擎使用，已经大家都讲得通这个“逻辑”；<br><br>物理日志就只有“我”自己能用，别人没有共享我的“物理格式”","user_name":"作者回复","comment_id":39739,"uid":"1264162","ip_address":"","utype":1,"ctime":1542345490,"user_name_real":"林晓斌"}],"discussion_count":9,"race_medal":0,"score":"641492471380","product_id":100020801,"comment_content":"binlog为什么说是逻辑日志呢？它里面有内容也会存储成物理文件，怎么说是逻辑而不是物理","like_count":149,"discussions":[{"author":{"id":1397631,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKVUskibDnhMt5MCIJ8227HWkeg2wEEyewps8GuWhWaY5fy7Ya56bu2ktMlxdla3K29Wqia9efCkWaQ/132","nickname":"衬衫的价格是19美元","note":"","ucode":"655F925451F772","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4441,"discussion_content":"1.物理日志记录的是在某个页上存储某个数据，关于页的分配和引擎有关，不同的引擎存结构不一样，页的分配页不一样；\n2.逻辑日志分为statement或者row,前者是sql，后者是某条数据的内容，都没有指定具这条数据在哪个具体的位置，所谓的物理，应该是指物理地址吧，我是这么理解的不道对不对","likes_number":10,"is_delete":false,"is_hidden":false,"ctime":1565423965,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1682672,"avatar":"https://static001.geekbang.org/account/avatar/00/19/ac/f0/78ee760d.jpg","nickname":"Harvey","note":"","ucode":"AB529F37D31335","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":29128,"discussion_content":"物理日志自己独享的数据，逻辑日志用于共享的数据","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1570730173,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429206,"discussion_content":"这样理解哈。 \n\n逻辑日志可以给别的数据库，别的引擎使用，已经大家都讲得通这个“逻辑”；\n\n物理日志就只有“我”自己能用，别人没有共享我的“物理格式”","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1542345490,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":549766,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644230122,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":429206,"ip_address":""},"score":549766,"extra":""}]},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553494,"discussion_content":"逻辑日志是sql规范，每个引擎都可以解析其行为，因此binlog会在server层，执行的适合需要解析，效率会受到影响；而物理日志记录的是物理地址，会耦合引擎的具体实现，但是解析效率高","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1645930731,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1565455,"avatar":"","nickname":"Geek_d458a5","note":"","ucode":"2E7D6F96EC7AA8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383111,"discussion_content":"不能使用redo log作为备库恢复的原因？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625907884,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1302556,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e0/1c/aa50dc27.jpg","nickname":"icyricky","note":"","ucode":"D63C285165309D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1565455,"avatar":"","nickname":"Geek_d458a5","note":"","ucode":"2E7D6F96EC7AA8","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":404001,"discussion_content":"binlog才用于备库恢复。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634206302,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":383111,"ip_address":""},"score":404001,"extra":""}]},{"author":{"id":1143536,"avatar":"https://static001.geekbang.org/account/avatar/00/11/72/f0/abb7bfe3.jpg","nickname":"Mcnulty","note":"","ucode":"3DD71D84B58A16","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367426,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618361681,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1323652,"avatar":"","nickname":"sibyl","note":"","ucode":"0D142011860D69","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":285539,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592875114,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39554,"user_name":"文@雨路","can_delete":false,"product_type":"c1","uid":1103072,"ip_address":"","ucode":"1EE59E03F9939C","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/e0/513d185e.jpg","comment_is_top":false,"comment_ctime":1542301343,"is_pvip":false,"replies":[{"id":"14154","content":"好问题👍🏿表示中间那段你都听明白了👍🏿<br><br>Binlog如果已经接受，那么redolog是prepare, binlog已经完整了对吧，这时候崩溃恢复过程会认可这个事务，提交掉。 （你可以分析下这种情况下，是否符合我们要达到的“用binlog恢复的库跟原库逻辑相同” 这个要求）","user_name":"作者回复","comment_id":39554,"uid":"1264162","ip_address":"","utype":1,"ctime":1542301823,"user_name_real":"林晓斌"}],"discussion_count":23,"race_medal":0,"score":"512643409567","product_id":100020801,"comment_content":"老师，我想问下如果提交事务的时候正好重启那么redo log和binlog会怎么处理？此时redo log处于prepare阶段，如果不接受这条log，但是binlog已经接受，还是说binlog会去检查redo log的状态，状态为prepare的不会恢复？","like_count":119,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429111,"discussion_content":"好问题👍🏿表示中间那段你都听明白了👍🏿\n\nBinlog如果已经接受，那么redolog是prepare, binlog已经完整了对吧，这时候崩溃恢复过程会认可这个事务，提交掉。 （你可以分析下这种情况下，是否符合我们要达到的“用binlog恢复的库跟原库逻辑相同” 这个要求）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542301823,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":2,"child_discussions":[{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":549767,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644230250,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":429111,"ip_address":""},"score":549767,"extra":""},{"author":{"id":1780698,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/2b/da/fa630993.jpg","nickname":"旧时光。","note":"","ucode":"E9612FD41567BD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":585900,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661899996,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":429111,"ip_address":"北京"},"score":585900,"extra":""}]},{"author":{"id":1195447,"avatar":"https://static001.geekbang.org/account/avatar/00/12/3d/b7/ef481641.jpg","nickname":"好好的","note":"","ucode":"D1C0C015063B60","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":281558,"discussion_content":"mysql重启恢复后，发现binlog和redo log prepare一致，会自动提交。但是这个提交成功怎么通知客户端呢？mysql重启后，与客户端的连接已经断开，这种情况下提交事务，客户端页面怎么知道执行是否成功呢？","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1591764153,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1722041,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/46/b9/834d003b.jpg","nickname":"啦啦啦","note":"","ucode":"6A31CDDA7FD3F6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1195447,"avatar":"https://static001.geekbang.org/account/avatar/00/12/3d/b7/ef481641.jpg","nickname":"好好的","note":"","ucode":"D1C0C015063B60","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303257,"discussion_content":"是哦，难道要客户端重试，这样有可能会产生脏数据吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599202773,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":281558,"ip_address":""},"score":303257,"extra":""},{"author":{"id":2351720,"avatar":"https://static001.geekbang.org/account/avatar/00/23/e2/68/ce547a12.jpg","nickname":"zjm1314","note":"","ucode":"63B0EAB7045054","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1722041,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/46/b9/834d003b.jpg","nickname":"啦啦啦","note":"","ucode":"6A31CDDA7FD3F6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339648,"discussion_content":"我觉得客户端直接报错了，但是这种错误，不能认为db成功，或者是失败，需要补偿机制或者人工干预","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609752138,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":303257,"ip_address":""},"score":339648,"extra":""},{"author":{"id":1111222,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f4/b6/ae7dc1e2.jpg","nickname":"余垚澈","note":"","ucode":"A451487F69451F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1195447,"avatar":"https://static001.geekbang.org/account/avatar/00/12/3d/b7/ef481641.jpg","nickname":"好好的","note":"","ucode":"D1C0C015063B60","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585376,"discussion_content":"客户端应该会提示连接断开，即不知道成功，也不知道失败，依赖后续查询状态后在做业务处理","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661502174,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":281558,"ip_address":"浙江"},"score":585376,"extra":""}]},{"author":{"id":1238337,"avatar":"https://static001.geekbang.org/account/avatar/00/12/e5/41/ffe533ba.jpg","nickname":"尚帝","note":"","ucode":"6F1703FD5A23A0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534534,"discussion_content":"高赞，但是这里就存在binlog决定恢复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638203778,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2035846,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/10/86/394fc8b2.jpg","nickname":"哈哈","note":"","ucode":"99D859A63DFF27","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332846,"discussion_content":"你上上边那层楼刚好对应你的答案","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607353881,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1179312,"avatar":"https://static001.geekbang.org/account/avatar/00/11/fe/b0/260f41f0.jpg","nickname":"loris","note":"","ucode":"00842745CF4B31","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":39428,"discussion_content":"同问这个问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571924058,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1700307,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er9RraTibVnM1MicM7icUkmJwjhxcoBGx5ONKQwz80GK47dhYBzPicp9t6eXv7R8wRg4umepHEiaXat3DQ/132","nickname":"Geek_Stone","note":"","ucode":"73DF77A05D1600","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":35435,"discussion_content":"redolog的prepare已经记了，崩溃恢复之后如果发现binlog没记，会回滚这个事务；如果binlog记了，就认可这个事务并提交。那么本质上是以binlog为准的，redolog有没有commit阶段好像没什么区别，为何还要搞出两阶段提交的概念呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571279826,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":7,"child_discussions":[{"author":{"id":1055456,"avatar":"https://static001.geekbang.org/account/avatar/00/10/1a/e0/06e54287.jpg","nickname":"浪荡居士","note":"","ucode":"376D4CBC0CB2BD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1700307,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er9RraTibVnM1MicM7icUkmJwjhxcoBGx5ONKQwz80GK47dhYBzPicp9t6eXv7R8wRg4umepHEiaXat3DQ/132","nickname":"Geek_Stone","note":"","ucode":"73DF77A05D1600","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":119104,"discussion_content":"所以其实作者也不清楚......","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578215929,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":35435,"ip_address":""},"score":119104,"extra":""},{"author":{"id":1810051,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK0uyg1IicbEhLwsgM2A2ROoyVdWdmUqZfQfs6G67w9m3hdRNBMOQJatQoACj3qNGgj2KVIgricaYiaQ/132","nickname":"木得感情的编码机器","note":"","ucode":"9C6CD47ADCB8E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1055456,"avatar":"https://static001.geekbang.org/account/avatar/00/10/1a/e0/06e54287.jpg","nickname":"浪荡居士","note":"","ucode":"376D4CBC0CB2BD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":165561,"discussion_content":"可能只是一种遵循规范的设计，或许在别处有其他用途。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581302244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":119104,"ip_address":""},"score":165561,"extra":""},{"author":{"id":1442605,"avatar":"https://static001.geekbang.org/account/avatar/00/16/03/2d/404627dc.jpg","nickname":"Anryg Zhun","note":"","ucode":"76DF8560BA9D14","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1055456,"avatar":"https://static001.geekbang.org/account/avatar/00/10/1a/e0/06e54287.jpg","nickname":"浪荡居士","note":"","ucode":"376D4CBC0CB2BD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":188264,"discussion_content":"因为binlog功能需要人为手动打开 默认是没有开启的 所以不能以它为准","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582806544,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":119104,"ip_address":""},"score":188264,"extra":""}]},{"author":{"id":1000004,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/44/d3d67640.jpg","nickname":"Hills录","note":"","ucode":"779020947ACABA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1307,"discussion_content":"如果人为把binlog关闭了呢？innodb如何判断是否接受处于prepare阶段的redolog？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562550765,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1336951,"avatar":"https://static001.geekbang.org/account/avatar/00/14/66/77/194ba21d.jpg","nickname":"lzh","note":"","ucode":"C3D83DF4230109","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1000004,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/44/d3d67640.jpg","nickname":"Hills录","note":"","ucode":"779020947ACABA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2962,"discussion_content":"那这次的事务应该属于有redo没有binlog的情况，会被回滚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1564064372,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":1307,"ip_address":""},"score":2962,"extra":""},{"author":{"id":1484192,"avatar":"https://static001.geekbang.org/account/avatar/00/16/a5/a0/e0cccf7e.jpg","nickname":"圆圆满满","note":"","ucode":"396E7A822014D1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1000004,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/44/d3d67640.jpg","nickname":"Hills录","note":"","ucode":"779020947ACABA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":29222,"discussion_content":"此时还有两阶段提交吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570755766,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":1307,"ip_address":""},"score":29222,"extra":""},{"author":{"id":1360250,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erFY9H3mxyTpZ9gxAmdeKic565hicicDZmv7cjswd8hdernmxib0chdQrlDNKUZQ8AticQCgDdgVEmJNuA/132","nickname":"牧鱼","note":"","ucode":"0EB8FDD7A4BB2E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1484192,"avatar":"https://static001.geekbang.org/account/avatar/00/16/a5/a0/e0cccf7e.jpg","nickname":"圆圆满满","note":"","ucode":"396E7A822014D1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":221658,"discussion_content":"没有两阶段提交","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586037221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":29222,"ip_address":""},"score":221658,"extra":""}]}]},{"had_liked":false,"id":39861,"user_name":"cyberbit","can_delete":false,"product_type":"c1","uid":1303197,"ip_address":"","ucode":"1BD53A25F5277F","user_header":"https://static001.geekbang.org/account/avatar/00/13/e2/9d/fbbd4611.jpg","comment_is_top":false,"comment_ctime":1542370003,"is_pvip":false,"replies":[{"id":"14319","content":"你是有故事的人😄","user_name":"作者回复","comment_id":39861,"uid":"1264162","ip_address":"","utype":1,"ctime":1542374048,"user_name_real":"林晓斌"}],"discussion_count":7,"race_medal":0,"score":"388089426643","product_id":100020801,"comment_content":"我理解备份就是救命药加后悔药，灾难发生的时候备份能救命，出现错误的时候备份能后悔。事情都有两面性，没有谁比谁好，只有谁比谁合适，完全看业务情况和需求而定。一天一备恢复时间更短，binlog更少，救命时候更快，但是后悔时间更短，而一周一备正好相反。我自己的备份策略是设置一个16小时延迟复制的从库，充当后悔药，恢复时间也较快。再两天一个全备库和binlog，作为救命药,最后时刻用。这样就比较兼顾了。","like_count":91,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429260,"discussion_content":"你是有故事的人😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542374048,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1193342,"avatar":"https://static001.geekbang.org/account/avatar/00/12/35/7e/46b26356.jpg","nickname":"韩静","note":"","ucode":"E9F22F861A7419","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394566,"discussion_content":"不过这种延迟的从库只能应用在及其核心的业务上吧，默认都这样用会比较浪费，这个从库平时不能提供服务，只能用来灾难恢复，成本比较高了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631941568,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2062472,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqXGKRyFDH2ia15hV4PeRfgibgb1djXGNibmU4LlMUK5hlHkWpqBpwmEXJ0HBZ2nAN0doQiaGROA5GIhg/132","nickname":"小八哥","note":"","ucode":"CE08853995218E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390650,"discussion_content":"膜拜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629952898,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2047882,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/3f/8a/dd0c712f.jpg","nickname":"ggg","note":"","ucode":"272D6F5AF3A7AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":343934,"discussion_content":"好贴切\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611213573,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1034120,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c7/88/a2e42dc8.jpg","nickname":"波波","note":"","ucode":"F63725D3416CC5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":236606,"discussion_content":"备份是每个版本保留一份（比如3月1号1份，3月10号1份），还是本次备份都会覆盖之前的备份版本？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587108424,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1886331,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/c8/7b/153181d7.jpg","nickname":"夜辉","note":"","ucode":"9421385F51FF9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1034120,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c7/88/a2e42dc8.jpg","nickname":"波波","note":"","ucode":"F63725D3416CC5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377337,"discussion_content":"周期覆盖","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622606683,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":236606,"ip_address":""},"score":377337,"extra":""}]},{"author":{"id":1179312,"avatar":"https://static001.geekbang.org/account/avatar/00/11/fe/b0/260f41f0.jpg","nickname":"loris","note":"","ucode":"00842745CF4B31","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":39433,"discussion_content":"推荐这种策略","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571924252,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40670,"user_name":"Mao","can_delete":false,"product_type":"c1","uid":1060202,"ip_address":"","ucode":"14CC85BC590A71","user_header":"https://static001.geekbang.org/account/avatar/00/10/2d/6a/323163df.jpg","comment_is_top":false,"comment_ctime":1542640209,"is_pvip":false,"discussion_count":28,"race_medal":0,"score":"366614860369","product_id":100020801,"comment_content":"老师，您好。您说MySQL 使用WAL，先写日志再写磁盘。请教一个问题，<br><br>执行一条Update 语句后，马上又执行一条 select * from table limit 10。<br><br>如果刚刚update的记录，还没持久化到磁盘中，而偏偏这个时候的查询条件，又包含了刚刚update的记录。<br><br>那么这个时候，是从日志中获取刚刚update的最新结果，还是说，先把日志中的记录先写磁盘，再返回最新结果？","like_count":85,"discussions":[{"author":{"id":1223523,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ab/63/2ff64979.jpg","nickname":"依旧","note":"","ucode":"39D2ABDB9F15A6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":20440,"discussion_content":"大哥， 数据已经放在内存中了，直接从内存中能找得到了！ 还要找磁盘干啥哦。亲， 么么哒","likes_number":19,"is_delete":false,"is_hidden":false,"ctime":1569316496,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1060202,"avatar":"https://static001.geekbang.org/account/avatar/00/10/2d/6a/323163df.jpg","nickname":"Mao","note":"","ucode":"14CC85BC590A71","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1223523,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ab/63/2ff64979.jpg","nickname":"依旧","note":"","ucode":"39D2ABDB9F15A6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":109316,"discussion_content":"感谢大佬解答","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577682753,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":20440,"ip_address":""},"score":109316,"extra":""},{"author":{"id":2351720,"avatar":"https://static001.geekbang.org/account/avatar/00/23/e2/68/ce547a12.jpg","nickname":"zjm1314","note":"","ucode":"63B0EAB7045054","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1060202,"avatar":"https://static001.geekbang.org/account/avatar/00/10/2d/6a/323163df.jpg","nickname":"Mao","note":"","ucode":"14CC85BC590A71","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339657,"discussion_content":"select * from table limit 10，是要查很多数据，如果要查询的数据有的在内存，有的在硬盘，这又怎么查呢？全表扫不是都读硬盘么，是先读内存再读硬盘？如果是有索引，那update这个过程索引没有更新么，索引没更新，如果使用了索引难道不会漏掉这个update的数据？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609753556,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":109316,"ip_address":""},"score":339657,"extra":""}]},{"author":{"id":1228560,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/10/b7974690.jpg","nickname":"BD","note":"","ucode":"A95CF8C3EDC228","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":287522,"discussion_content":"这个问题是完全取决于mysql的事务隔离级别和是否设置了事务自动提交，如果update和select是同一个事务，那么select会查到内存里最新的值，如果update 和select是不同的事务且事务隔离级别是读已提交，那么selcet不会读到内存里最新的值，这时MySQL的mvcc在起作用，如果是读未提交那么就能读到内存最新的值","likes_number":11,"is_delete":false,"is_hidden":false,"ctime":1593474664,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":2032840,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/04/c8/3c7af100.jpg","nickname":"Javatar","note":"","ucode":"E216645CDF632C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1228560,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/10/b7974690.jpg","nickname":"BD","note":"","ucode":"A95CF8C3EDC228","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":289082,"discussion_content":"大佬你好 题主的意思是redolog和binlog都写入成功，并且已提交。但老师的意思是数据真正写入磁盘，是一个异步的过程。那么在数据没写入磁盘前，别的事务如果查了这条数据，那此时会先触发写入磁盘的操作吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593971041,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":287522,"ip_address":""},"score":289082,"extra":""},{"author":{"id":1351075,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9d/a3/79fc9017.jpg","nickname":"minsky","note":"","ucode":"7296ECA064E89B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2032840,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/04/c8/3c7af100.jpg","nickname":"Javatar","note":"","ucode":"E216645CDF632C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308420,"discussion_content":"从事务的持久性来讲，其它事务读出来就还是写入硬盘里的数据吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600948324,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":289082,"ip_address":""},"score":308420,"extra":""},{"author":{"id":1135990,"avatar":"https://static001.geekbang.org/account/avatar/00/11/55/76/a55871ab.jpg","nickname":"孙庆良","note":"","ucode":"CA05C4CFEFB0F9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1351075,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9d/a3/79fc9017.jpg","nickname":"minsky","note":"","ucode":"7296ECA064E89B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":322365,"discussion_content":"这个和mvcc有关系了，看快照读还是当前读。具体细节我也理不清了，也不需要理清吧","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1604732603,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":308420,"ip_address":""},"score":322365,"extra":""}]},{"author":{"id":1015189,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/95/dd73022c.jpg","nickname":"我是曾经那个少年","note":"","ucode":"9F02F7FF147D14","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332721,"discussion_content":"查询和更新都是先内存获取数据的，想想文章中update语句步骤图第一步就是取这条记录的数据，如果内存存在就直接获取。","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1607324183,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1315728,"avatar":"https://static001.geekbang.org/account/avatar/00/14/13/90/f94a6436.jpg","nickname":"Jack Zhang","note":"","ucode":"E3AEAE55A9B16C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4835,"discussion_content":"update 提交后，数据已经写到内存，再查询就和日志没有关系。","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1565763924,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1183518,"avatar":"https://static001.geekbang.org/account/avatar/00/12/0f/1e/6b6eb987.jpg","nickname":"我们在路上","note":"","ucode":"0DB77DB7C64C47","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1315728,"avatar":"https://static001.geekbang.org/account/avatar/00/14/13/90/f94a6436.jpg","nickname":"Jack Zhang","note":"","ucode":"E3AEAE55A9B16C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":224942,"discussion_content":"我也这么理解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586338309,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":4835,"ip_address":""},"score":224942,"extra":""}]},{"author":{"id":2166073,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","nickname":"戒酒的李白","note":"","ucode":"744E1A22761647","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":322121,"discussion_content":"应该是先判断这页数据是否在内存中，如果在，直接返回内存中的结果。如果不在，就从磁盘中加载这个页，并且应用redo log，再返回结果。之后这个脏页会刷到磁盘。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1604676741,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":2351720,"avatar":"https://static001.geekbang.org/account/avatar/00/23/e2/68/ce547a12.jpg","nickname":"zjm1314","note":"","ucode":"63B0EAB7045054","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2166073,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","nickname":"戒酒的李白","note":"","ucode":"744E1A22761647","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":339649,"discussion_content":"这个脏页是什么意思，有脏数据的页？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609752243,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":322121,"ip_address":""},"score":339649,"extra":""},{"author":{"id":1747184,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/a8/f0/529f15e9.jpg","nickname":"第四单元","note":"","ucode":"3ED9D553E1DE17","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2351720,"avatar":"https://static001.geekbang.org/account/avatar/00/23/e2/68/ce547a12.jpg","nickname":"zjm1314","note":"","ucode":"63B0EAB7045054","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":398091,"discussion_content":"应该是指在redo log记录了，但没有刷新到磁盘的数据。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632733718,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":339649,"ip_address":""},"score":398091,"extra":""}]},{"author":{"id":1207854,"avatar":"https://static001.geekbang.org/account/avatar/00/12/6e/2e/008b5481.jpg","nickname":"路过的猪","note":"","ucode":"5CC5FEB7977289","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":177410,"discussion_content":"如果update到内存后，redolog/binlog写入之前，这个时刻【如果】有其他客户端B能读到的话（比如 10 更新为20了），从客户端来的角度来看的话，这个20是已经更新完成的了。然而如果redolog/binlog写入之前崩溃了，恢复时，这个更新肯定是要丢弃的（因为日志还没commit）；这时候之前的读就是有问题的。所以个人认为在commit之前，哪怕是更新到内存了，其他读取理应是看不到这个尚未commit的数据的（和事务隔离级别有关？）","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1582104464,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1442605,"avatar":"https://static001.geekbang.org/account/avatar/00/16/03/2d/404627dc.jpg","nickname":"Anryg Zhun","note":"","ucode":"76DF8560BA9D14","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1207854,"avatar":"https://static001.geekbang.org/account/avatar/00/12/6e/2e/008b5481.jpg","nickname":"路过的猪","note":"","ucode":"5CC5FEB7977289","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":188272,"discussion_content":"同意这个观点","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582806973,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":177410,"ip_address":""},"score":188272,"extra":""}]},{"author":{"id":1582691,"avatar":"https://static001.geekbang.org/account/avatar/00/18/26/63/d8719c0b.jpg","nickname":"劉才傑","note":"","ucode":"AE9B1068B78526","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3538,"discussion_content":"你update后的数据在内存中","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1564559921,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2642323,"avatar":"https://static001.geekbang.org/account/avatar/00/28/51/93/11086263.jpg","nickname":"WSGTOP","note":"","ucode":"F7280A67C7CE0C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545551,"discussion_content":"关注这个问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641995420,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1470434,"avatar":"https://static001.geekbang.org/account/avatar/00/16/6f/e2/f3b05833.jpg","nickname":"A 拽丫头","note":"","ucode":"F875D99D18DF6E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390690,"discussion_content":"关注这个问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629973999,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1204353,"avatar":"https://static001.geekbang.org/account/avatar/00/12/60/81/eaf6d0ac.jpg","nickname":"拉布拉多","note":"","ucode":"637A88D9F29F57","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":338983,"discussion_content":"mvcc","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609469328,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1592576,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLIzE6JOuXsOamCWiaq8sHHVyCK44bdIOEqnE42veoZPEqxs5IJ8RT1Hicz0ZlPQFcbEFSwjV7icrfEw/132","nickname":"jjyyun","note":"","ucode":"8824654F673087","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":292695,"discussion_content":"其实redolog的设计上是为了保持从库或者备份库的数据和主库一致，日志的持久化写的是日志文件，查询查的是数据文件，你可能把日志文件的刷盘理解为数据的持久化了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595310091,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1991164,"avatar":"","nickname":"Geek_32ec8d","note":"","ucode":"3CEAC372C0C684","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":256240,"discussion_content":"关注这个问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588459429,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1304762,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e8/ba/a6976395.jpg","nickname":"Stev","note":"","ucode":"AC16C3BF6D0E66","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":221868,"discussion_content":"这个跟服务器设置的隔离级别有关.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586072912,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":126684,"discussion_content":"肯定是从日志中读取的，因为查询时，由执行器先从日志中（粉板）获取数据，如果没有再进行IO，从硬盘中获取数据。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578533137,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1254656,"avatar":"https://static001.geekbang.org/account/avatar/00/13/25/00/3afbab43.jpg","nickname":"88591","note":"","ucode":"04CE3E46455185","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":115802,"discussion_content":"我也有相同的疑问，如果查询的时候，不使用缓存查询，那么是需要从硬盘中读取的。不知道在哪个环节实现了 读取一致的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578036075,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1682672,"avatar":"https://static001.geekbang.org/account/avatar/00/19/ac/f0/78ee760d.jpg","nickname":"Harvey","note":"","ucode":"AB529F37D31335","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":29127,"discussion_content":"关注这个问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570729830,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1397315,"avatar":"https://static001.geekbang.org/account/avatar/00/15/52/43/25209d6c.jpg","nickname":"无边丝雨","note":"","ucode":"B2AD1EAB9E9308","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":18070,"discussion_content":"查到的不是最新结果","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569000410,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1060202,"avatar":"https://static001.geekbang.org/account/avatar/00/10/2d/6a/323163df.jpg","nickname":"Mao","note":"","ucode":"14CC85BC590A71","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1397315,"avatar":"https://static001.geekbang.org/account/avatar/00/15/52/43/25209d6c.jpg","nickname":"无边丝雨","note":"","ucode":"B2AD1EAB9E9308","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":109317,"discussion_content":"我觉得也是，这样比较能理解这个流程了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577682859,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":18070,"ip_address":""},"score":109317,"extra":""}]},{"author":{"id":1109362,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ed/72/852bb4e3.jpg","nickname":"Specia_Lee","note":"","ucode":"96130441E64D0A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4851,"discussion_content":"同问，希望有大神来答疑，之后的查询到底是不是读磁盘的数据吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565774295,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39709,"user_name":"蚂蚁内推+v","can_delete":false,"product_type":"c1","uid":1050508,"ip_address":"","ucode":"24B10AEE54B3FD","user_header":"https://static001.geekbang.org/account/avatar/00/10/07/8c/0d886dcc.jpg","comment_is_top":false,"comment_ctime":1542338377,"is_pvip":false,"replies":[{"id":"14231","content":"1. Redolog是顺序写，并且可以组提交，还有别的一些优化，收益最大是是这两个因素；<br><br>2.是这样，正常执行是要commit 才算完，但是崩溃恢复过程的话，可以接受“redolog prepare 并且binlog完整” 的情况","user_name":"作者回复","comment_id":39709,"uid":"1264162","ip_address":"","utype":1,"ctime":1542341905,"user_name_real":"林晓斌"}],"discussion_count":5,"race_medal":0,"score":"349434689353","product_id":100020801,"comment_content":"老师，我这想请教两个问题：<br>1.写redo日志也是写io（我理解也是外部存储）。同样耗费性能。怎么能做到优化呢<br>2.数据库只有redo commit 之后才会真正提交到数据库吗","like_count":81,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429189,"discussion_content":"1. Redolog是顺序写，并且可以组提交，还有别的一些优化，收益最大是是这两个因素；\n\n2.是这样，正常执行是要commit 才算完，但是崩溃恢复过程的话，可以接受“redolog prepare 并且binlog完整” 的情况","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542341905,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2222937,"avatar":"","nickname":"ronaldo","note":"","ucode":"824AE89F4C58BB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":319924,"discussion_content":"你好老师，有个困惑：正常commit和redo log commit 是如何标记的？ 正常情况下该事务的生命中期中，事务的commit，以及redo log commit是分开表达么？ 或我该理解为：事务的持久化就是有redo log commit 标记来确定的 ？ ","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1604197333,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":2351720,"avatar":"https://static001.geekbang.org/account/avatar/00/23/e2/68/ce547a12.jpg","nickname":"zjm1314","note":"","ucode":"63B0EAB7045054","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2222937,"avatar":"","nickname":"ronaldo","note":"","ucode":"824AE89F4C58BB","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":339659,"discussion_content":"如果是显示的事务应该是最后的commit命令，如果不是，单个的udpate就是一个事务，那么执行完就自动commit","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609753741,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":319924,"ip_address":""},"score":339659,"extra":""},{"author":{"id":1882517,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/b9/95/cabab54b.jpg","nickname":"tong","note":"","ucode":"966DEDE81081D0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2222937,"avatar":"","nickname":"ronaldo","note":"","ucode":"824AE89F4C58BB","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":539405,"discussion_content":"同问，事务的commit和redo log的commit，是同一个commit吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639709313,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":319924,"ip_address":""},"score":539405,"extra":""}]},{"author":{"id":1001893,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/49/a5/e4c1c2d4.jpg","nickname":"小文同学","note":"","ucode":"48F2AEB989C12A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":251063,"discussion_content":"奔溃恢复的时候，redo log prepare + binlog 完整，数据库会自动进行 commit 操作","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588062673,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":73200,"user_name":"未来小娃","can_delete":false,"product_type":"c1","uid":1047329,"ip_address":"","ucode":"477D166EBB6B70","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fb/21/d017438c.jpg","comment_is_top":false,"comment_ctime":1551838536,"is_pvip":true,"replies":[{"id":"27093","content":"👍","user_name":"作者回复","comment_id":73200,"uid":"1264162","ip_address":"","utype":1,"ctime":1552112631,"user_name_real":"林晓斌"}],"discussion_count":18,"race_medal":0,"score":"332264320328","product_id":100020801,"comment_content":"先说下阅读的收获：<br>1、更新的流程先写redo日志，写完后更新内存，到这里操作就直接返回了。后续的流程是生成此操作的binlog，然后写到磁盘<br>2、redo日志是存储引擎实现的，记录的在某个数据页做了什么修改，固定大小，默认为4GB，可以循环写，解决了每次更新操作写磁盘、查找记录、然后更新整个过程效率低下的问题，redo日志将磁盘的随机写变成了顺序写，这个机制是WAL，先写日志再刷磁盘。一句话，redo日志保证了事务ACID的特性<br>3、binglog日志Server层实现的，记录的是语句的原始逻辑，比如给ID=1的行的状态设置成1，追加写，上个文件写完回切换成下一个文件，类似滚动日志<br>4、两阶段提交，是为了解决redo log和binlog不一致问题的，这里的不一致是指redo log写成功binlog写失败了，由于恢复是根据binlog恢复的，这样恢复的时候就会少一条更新操作，导致和线上库的数据不一致。具体而言，两阶段是指prepare阶段和commit阶段，写完redo log进入prepare阶段，写完binlog进入commit阶段。<br>然后说下由redo log联想到之前遇到的一个问题：一个普通的select查询超过30ms，经过和DBA的联合排查，确认是由于MySQL“刷脏”导致的。<br>所谓刷脏就是由于内存页和磁盘数据不一致导致了该内存页是“脏页”，将内存页数据刷到磁盘的操作称为“刷脏”。刷脏是为了避免产生“脏页”，主要是因为MySQL更新先写redo log再定期批量刷到磁盘的，这就导致内存页的数据和磁盘数据不一致，为了搞清楚为什么“刷脏”会导致慢查，我们先分析下redo log再哪些场景会刷到磁盘。<br>场景1：redo log写满了，此时MySQL会停止所有更新操作，把脏页刷到磁盘<br>场景2：系统内存不足，需要将脏页淘汰，此时会把脏页刷到磁盘<br>场景3：系统空闲时，MySQL定期将脏页刷到磁盘<br><br>可以想到，在场景1和2都会导致慢查的产生，根据文章提到的，redo log是可以循环写的，那么即使写满了应该也不会停止所有更新操作吧，其实是会的，文中有句话“粉板写满了，掌柜只能停下手中的活，把粉板的一部分赊账记录更新到账本中，把这些记录从粉板删除，为粉板腾出新的空间”，这就意味着写满后是会阻塞一段时间的。<br><br>那么问题来了，innodb存储引擎的刷脏策略是怎么样的呢？通常而言会有两种策略：全量（sharp checkpoint）和部分（fuzzy checkpoint）。全量刷脏发生在关闭数据库时，部分刷脏发生在运行时。部分刷脏又分为定期刷脏、最近最少使用刷脏、异步&#47;同步刷脏、脏页过多刷脏。暂时先写到这，后面打算写文详细介绍。","like_count":77,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441967,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552112631,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1054827,"avatar":"https://static001.geekbang.org/account/avatar/00/10/18/6b/a1448af1.jpg","nickname":"贝影","note":"","ucode":"19545C8DCBF8A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542162,"discussion_content":"你第一点的流程就跟作者画的图不一样，作者的图中先更新了内存，才开始写redo日志","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1640673640,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1044546,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/42/7728d4f5.jpg","nickname":"艿艿","note":"","ucode":"8F727AB7A7F6B2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":25627,"discussion_content":"学习了。牛逼！","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1570543544,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1911661,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLDOKcx20Xxmu5j8WxiafoYvo3bIAFDg8OeicRic1icD597QuMC9O8FyV2Al9RxNfVZXK0gkGUx6M3CVQ/132","nickname":"多年以后","note":"","ucode":"D70E7A1ABE0F39","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550419,"discussion_content":"第一条 写完内存就返回，后续在写binlog这里是不是有问题，假如返回了在写binlog的时候mysql重启了，这时候binlog没写完，是会回滚的。那你返回给用户说成功了？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644539950,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1124239,"avatar":"https://static001.geekbang.org/account/avatar/00/11/27/8f/3716c489.jpg","nickname":"小天","note":"","ucode":"C71AE345640101","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536817,"discussion_content":"这里有一个问题，redo日志是顺序写的，也是顺序刷磁盘的，那么除了把全部redo日志都落盘以外，如何保证把某个特定脏页的数据都落盘了？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638874928,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1054827,"avatar":"https://static001.geekbang.org/account/avatar/00/10/18/6b/a1448af1.jpg","nickname":"贝影","note":"","ucode":"19545C8DCBF8A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1124239,"avatar":"https://static001.geekbang.org/account/avatar/00/11/27/8f/3716c489.jpg","nickname":"小天","note":"","ucode":"C71AE345640101","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":542167,"discussion_content":"为什么会有特定脏页呢？你这里是指redo还是指数据啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640673867,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":536817,"ip_address":""},"score":542167,"extra":""}]},{"author":{"id":1721917,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/46/3d/9368382a.jpg","nickname":"二十四","note":"","ucode":"857189AC3A2E31","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388015,"discussion_content":"get到了新知识 mark一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628558276,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1669749,"avatar":"https://static001.geekbang.org/account/avatar/00/19/7a/75/3c5a69f7.jpg","nickname":"做个俗人","note":"","ucode":"5FFF291791D2D4","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366229,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617983454,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2351720,"avatar":"https://static001.geekbang.org/account/avatar/00/23/e2/68/ce547a12.jpg","nickname":"zjm1314","note":"","ucode":"63B0EAB7045054","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339669,"discussion_content":"还想到一个，如果biglog成功写入后，commit完，mysql宕机，那不内存里的东西就没了，这种情况怎么把这种改变同步到磁盘里呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609754729,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1886331,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/c8/7b/153181d7.jpg","nickname":"夜辉","note":"","ucode":"9421385F51FF9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2351720,"avatar":"https://static001.geekbang.org/account/avatar/00/23/e2/68/ce547a12.jpg","nickname":"zjm1314","note":"","ucode":"63B0EAB7045054","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377342,"discussion_content":"先从磁盘加载内存页，再基于redo log恢复内存数据，最终由操作系统异步刷数据至磁盘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622607344,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":339669,"ip_address":""},"score":377342,"extra":""}]},{"author":{"id":2351720,"avatar":"https://static001.geekbang.org/account/avatar/00/23/e2/68/ce547a12.jpg","nickname":"zjm1314","note":"","ucode":"63B0EAB7045054","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339665,"discussion_content":"为什么场景1,2,3会影响查询速率呢，数据已经在内存里了啊，按照上面的评论了解，直接用内存里的数据不就可以，而且这个场景直接用多线程会有多少影响CPU呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609754309,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2305167,"avatar":"https://static001.geekbang.org/account/avatar/00/23/2c/8f/aa45f6c4.jpg","nickname":"lambda","note":"","ucode":"D1990B7903913B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339402,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609658743,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2260179,"avatar":"https://static001.geekbang.org/account/avatar/00/22/7c/d3/8b674990.jpg","nickname":"老五","note":"","ucode":"47639E1012D3F7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335721,"discussion_content":"反了吧，不是先binlog吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608283640,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1323652,"avatar":"","nickname":"sibyl","note":"","ucode":"0D142011860D69","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":285544,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592876146,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1812970,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a9/ea/5bfce6c5.jpg","nickname":"mgs2002","note":"","ucode":"F5931108BD509B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":147600,"discussion_content":"看评论区都涨知识","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579661266,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1006735,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5c/8f/551b5624.jpg","nickname":"小可","note":"","ucode":"8834AF621FA67D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":126701,"discussion_content":"٩(๑ᵒ̴̶̷͈᷄ᗨᵒ̴̶̷͈᷅)و 好厉害！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578533669,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1194858,"avatar":"https://static001.geekbang.org/account/avatar/00/12/3b/6a/80d9c545.jpg","nickname":"RD","note":"","ucode":"E3947B6E1681AD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":87275,"discussion_content":"文章呢，写好了没呀，发个链接呗~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576658074,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1145404,"avatar":"https://static001.geekbang.org/account/avatar/00/11/7a/3c/87e015f8.jpg","nickname":"堵车","note":"","ucode":"7BC1E50A4F8D3D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":57591,"discussion_content":"redo log清除需要刷脏页？内存不足的时候，刷脏页需要清除redo log吗？如果需要的话，这是两个动作，怎么保证刷了脏页之后，redo log已清除？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574620169,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39617,"user_name":"黄金的太阳","can_delete":false,"product_type":"c1","uid":1105079,"ip_address":"","ucode":"9D7F2397124AB9","user_header":"https://static001.geekbang.org/account/avatar/00/10/dc/b7/e59c22f0.jpg","comment_is_top":false,"comment_ctime":1542328892,"is_pvip":false,"replies":[{"id":"14236","content":"你的理解是对的。<br>1. 写redo log是顺序写，不用去“找位置”，而更新数据需要找位置<br><br>2. 其实是3次（redolog两次 binlog 1次）。不过在并发更新的时候会合并写","user_name":"作者回复","comment_id":39617,"uid":"1264162","ip_address":"","utype":1,"ctime":1542342506,"user_name_real":"林晓斌"}],"discussion_count":8,"race_medal":0,"score":"315074941500","product_id":100020801,"comment_content":"请教老师，redo log是为了快速响应SQL充当了粉板，这里有两个疑问<br>1. redo log本身也是文件，记录文件的过程其实也是写磁盘，那和文中提到的离线写磁盘操作有何区别？<br>2.响应一次SQL我理解是要同时操作两个日志文件？也就是写磁盘两次？","like_count":73,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429142,"discussion_content":"你的理解是对的。\n1. 写redo log是顺序写，不用去“找位置”，而更新数据需要找位置\n\n2. 其实是3次（redolog两次 binlog 1次）。不过在并发更新的时候会合并写","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542342506,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2020865,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/d6/01/eaa50203.jpg","nickname":"zft","note":"","ucode":"74DEC5FBA610B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":275935,"discussion_content":"顺序写可以看做是在粉板上一行一行的记账，而随机写可以看做是去翻账本找到地方后再记账。顺序写的速度要快一些","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1590769321,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1087490,"avatar":"https://static001.geekbang.org/account/avatar/00/10/98/02/14e24394.jpg","nickname":"Zhikun Lao","note":"","ucode":"C39A437FCE1C8B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591,"discussion_content":"这个问题太关键了，谢谢指出！","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1561752998,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1798979,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/73/43/ae139b1f.jpg","nickname":"博","note":"","ucode":"F7CA69FF5D09BA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":274182,"discussion_content":"这个问题也可以这么描述吧，比如写redo log 和直接写磁盘 都是一次io,为啥还要用redo log ?\n应该有三点：一个是 顺序写。第二个是safe-crash 。第三个是redo log 写磁盘策略灵活，可根据实际情况选择","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1590551080,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1223523,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ab/63/2ff64979.jpg","nickname":"依旧","note":"","ucode":"39D2ABDB9F15A6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":20442,"discussion_content":"小哥， 同理可证，了解一下kafka为啥性能高，吞吐高.----->“顺序写”","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1569316558,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1389451,"avatar":"","nickname":"GoGle","note":"","ucode":"64D2598BFFF455","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391375,"discussion_content":"看到这里我更加糊涂了，那redolog要写两次，第一次是prepare顺序写能理解，那第二次，不是要找到之前redolog的位置，将其更新为commit状态吗？这还是要&#34;找位置&#34;啊，这不会慢吗？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1630421943,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1882517,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/b9/95/cabab54b.jpg","nickname":"tong","note":"","ucode":"966DEDE81081D0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1389451,"avatar":"","nickname":"GoGle","note":"","ucode":"64D2598BFFF455","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539409,"discussion_content":"我理解一条update语句，对应redolog是两条日志，既然是循环写，那也是循环读，prepare日志和commit日志，如果有commit日志了，直接提交就好了，不用管prepare日志了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639709617,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":391375,"ip_address":""},"score":539409,"extra":""}]},{"author":{"id":1902889,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/09/29/b170a88f.jpg","nickname":"John5","note":"","ucode":"61188D1D626107","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288004,"discussion_content":"我也是这个问题，才明白是怎么回事，","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1593612255,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40031,"user_name":"skyoo","can_delete":false,"product_type":"c1","uid":1302503,"ip_address":"","ucode":"EBC0528BA02DD7","user_header":"https://static001.geekbang.org/account/avatar/00/13/df/e7/4ce5ed27.jpg","comment_is_top":false,"comment_ctime":1542446415,"is_pvip":false,"replies":[{"id":"14408","content":"你选择了最优路径👍🏿","user_name":"作者回复","comment_id":40031,"uid":"1264162","ip_address":"","utype":1,"ctime":1542472006,"user_name_real":"林晓斌"}],"discussion_count":4,"race_medal":0,"score":"289305255247","product_id":100020801,"comment_content":"昨天上午 恢复别人误操作配置表数据，幸好有xtarbackup凌晨的全量备份，只提取了改表的ibd文件，然后在本地 做了 一个一样的空表，释放该表空间，加载 提取后的ibd文件，提取昨天零晨到九点的binlog文件 筛选改表这个时段的操作记录 增量更新到本地导出csv 导入线上  。binlog太tm重要了","like_count":67,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429340,"discussion_content":"你选择了最优路径👍🏿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542472006,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1886331,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/c8/7b/153181d7.jpg","nickname":"夜辉","note":"","ucode":"9421385F51FF9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377339,"discussion_content":"不直接基于binlog时间点执行嘛？\n这样不是可能会导致一些上下文数据的丢失嘛？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622606960,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2009461,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/a9/75/dbccd12d.jpg","nickname":"稻草人","note":"","ucode":"6694EE2CD36B8C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":353143,"discussion_content":"我理解是:1.加载凌晨的ibd文件就是把凌晨备份的数据恢复到临时库中;2.提取binlog并筛选这段时间的改相应表操作的SQL，然后把误操作的SQL处理掉，然后增量恢复，这样相当于把误操作对数据造成的影响消除。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615025145,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1627397,"avatar":"https://static001.geekbang.org/account/avatar/00/18/d5/05/8fd8ca4c.jpg","nickname":"快快乐乐","note":"","ucode":"D093D8D5836FF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":341226,"discussion_content":"在源实例上\nvi my.table\nXXXX.table1\n\nxtrabackup --defaults-file=/home/meinian/data/backup-my.cnf --tables-file=&#39;XXXX.table1&#39; --backup --target-dir=/home/meinian/data/0111backuptest\n下载对应文件ibd文件，需要复制到需要备份的文件目录\n\n在目标实例\n首先创建一个一模一样的表\nalter table table1 discard tablespace;\n上传文件，主要使用mysql账户进行操作\nalter table table1 import tablespace;\n\nselect count(1) from table1; -- 测试数据是否正常","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610355755,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40474,"user_name":"Mackie .Weng","can_delete":false,"product_type":"c1","uid":1308336,"ip_address":"","ucode":"A86DDC5F3E2DD5","user_header":"https://static001.geekbang.org/account/avatar/00/13/f6/b0/837f5d36.jpg","comment_is_top":false,"comment_ctime":1542623909,"is_pvip":false,"replies":[{"id":"14606","content":"你说的这个case我分析了一下。<br>1. 这个现象应该是数据页（page) 的内容错了。InnoDB在读到数据页的时候会判断checksum，碰到有不对的页，就会自己crash掉<br>2. 修改 force_recovery启动以后，mysqldump会显示Lost connection，表示出错的表是在主键索引上（如果是叶子节点，dump的时候是不会访问到的）<br>3. 这种场景的坏表修复，有一种方法，是把错误的page先忽略掉。每个page有checksum，可以扫文件找到checksum不对的page，清空掉内容，初始化成空的。（另一种做法是修改MySQL的代码让MySQL忽略这个错误，而不是crash）<br>4. 总之第3步的目的就是跳过那些已经错了的数据页，把表里面别的数据取出来<br>5. 按照前说的，可以判断出这个错误的页是在主键上面，所以会丢几行的。<br>6. 找回这几行的方法，有几个地方： 这个表其他索引里面有部分字段；undolog；binlog；业务对账。 但是这些都不能保证能够100%拿回全部数据。 <br>一般尽量用binlog，业务对账已经是属于数据库本身没辙了。<br><br>我碰到过这种情况，没有binlog的情况下，做到第5步，业务就满意了。<br><br>最后总结一下 ：一定要备份，包括数据和binlog。","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542632489,"ip_address":"","comment_id":40474,"utype":1}],"discussion_count":5,"race_medal":0,"score":"220585956005","product_id":100020801,"comment_content":"老师，非常感谢你的优质文章，你的每篇文章，我都要研究一段时间，而且一直做笔记，而且真的使我对mysql一个全新的认识，因为之前总感觉一直止步于数据恢复等业务操作都无法前行了。<br>恕我冒昧我突然想到前不久刚遇到的一个mysql的问题，我总感觉和我们学习的有很大关系，不知道是不是通过binlog来修复的。<br>情形是这样的，我们因为磁盘IO异常导致数据库异常重启了，并发现某个表数据损坏了（无数据备份）且mysql无法开启，一开始的做法innodb_force_recovery设置到1-6直到数据库可以启动，然后进行mysqldump备份，然而并不能备份，报错是mysqldump: Error 2013: Lost connection to MySQL server during query when dumping table `XX表` at row: 31961089。于是就跳过这个表进行备份，并修复了其他数据库，但是这个表的数据丢失最终请了外援修复好了，但是具体没告诉我们，不知道和我们这个有没联系？有没提示让我学学习下这方面？是可以用ibd文件修复吗？","like_count":51,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429533,"discussion_content":"你说的这个case我分析了一下。\n1. 这个现象应该是数据页（page) 的内容错了。InnoDB在读到数据页的时候会判断checksum，碰到有不对的页，就会自己crash掉\n2. 修改 force_recovery启动以后，mysqldump会显示Lost connection，表示出错的表是在主键索引上（如果是叶子节点，dump的时候是不会访问到的）\n3. 这种场景的坏表修复，有一种方法，是把错误的page先忽略掉。每个page有checksum，可以扫文件找到checksum不对的page，清空掉内容，初始化成空的。（另一种做法是修改MySQL的代码让MySQL忽略这个错误，而不是crash）\n4. 总之第3步的目的就是跳过那些已经错了的数据页，把表里面别的数据取出来\n5. 按照前说的，可以判断出这个错误的页是在主键上面，所以会丢几行的。\n6. 找回这几行的方法，有几个地方： 这个表其他索引里面有部分字段；undolog；binlog；业务对账。 但是这些都不能保证能够100%拿回全部数据。 \n一般尽量用binlog，业务对账已经是属于数据库本身没辙了。\n\n我碰到过这种情况，没有binlog的情况下，做到第5步，业务就满意了。\n\n最后总结一下 ：一定要备份，包括数据和binlog。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1542632489,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1188793,"avatar":"https://static001.geekbang.org/account/avatar/00/12/23/b9/8d182f13.jpg","nickname":"起风了","note":"","ucode":"9A8A2E51E198EE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306826,"discussion_content":"SQL必知必会：36丨数据库没有备份，没有使用Binlog的情况下，如何恢复数据？  这篇刚好讲了你这个问题。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1600398796,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1228560,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/10/b7974690.jpg","nickname":"BD","note":"","ucode":"A95CF8C3EDC228","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":287525,"discussion_content":"修改mysql代码这句比较重要<- ->","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593475486,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1812970,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a9/ea/5bfce6c5.jpg","nickname":"mgs2002","note":"","ucode":"F5931108BD509B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":147594,"discussion_content":"长篇大论。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579661121,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1062373,"avatar":"https://static001.geekbang.org/account/avatar/00/10/35/e5/0b60d57e.jpg","nickname":"tommy","note":"","ucode":"E6EDD4ECBA01D6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7794,"discussion_content":"吓得我赶紧去备份了一次","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567676348,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39677,"user_name":"喔～","can_delete":false,"product_type":"c1","uid":1172171,"ip_address":"","ucode":"FE2C87CE6FEBD8","user_header":"https://static001.geekbang.org/account/avatar/00/11/e2/cb/6bc95e09.jpg","comment_is_top":false,"comment_ctime":1542334762,"is_pvip":false,"replies":[{"id":"14194","content":"Crash-safe是崩溃恢复，就是原地满血复活；binlog恢复是制造一个影分身（副本）出来","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542336929,"ip_address":"","comment_id":39677,"utype":1}],"discussion_count":9,"race_medal":0,"score":"211995732266","product_id":100020801,"comment_content":"redo 是引擎提供的，binlog 是server 自带的，文中提到前者用在crash的恢复，后者用于库的恢复<br>两者是否在某种程度上是重复的？如果在都是追加写的情况下，是否两种日志都能用于 crash 与 库 的恢复呢？","like_count":49,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429175,"discussion_content":"Crash-safe是崩溃恢复，就是原地满血复活；binlog恢复是制造一个影分身（副本）出来","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542336929,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1967481,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/BJib7ba1CL6W9O0OhgLQX0aHX4CHia6qNTyztgwzC0MeFj6WRxH9ibJ0do3K6r56S0Tibv1dawa4b01RmILMTzYmWw/132","nickname":"codexu","note":"","ucode":"9B5E74E6FE7E61","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301060,"discussion_content":"1. 如果是主从模式下，binlog是必须的，因为从库的数据同步依赖的就是binlog；\n2. 如果是单机模式，并且不考虑数据库基于时间点的还原，binlog就不是必须，因为有redo log就可以保证crash-safe能力了；但如果万一需要回滚到某个时间点的状态，这时候就无能为力，所以建议binlog还是一直开启；\n来自：https://zhuanlan.zhihu.com/p/142491549","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1598390555,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1508329,"avatar":"https://static001.geekbang.org/account/avatar/00/17/03/e9/6358059c.jpg","nickname":"GalaxyCreater","note":"","ucode":"C79E8A088D57CF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":69569,"discussion_content":"redo log是数据库对数据的保护，就算不断的crash而不影响已成功写入的，持久性。binlog可以理解为备份，用于恢复某段时间内的数据","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1575293714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1178402,"avatar":"https://static001.geekbang.org/account/avatar/00/11/fb/22/a0ddf3ee.jpg","nickname":"see","note":"","ucode":"39D123F84885BE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":317974,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603625159,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2052088,"avatar":"","nickname":"dyh_zero","note":"","ucode":"98029D72597EF2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":307515,"discussion_content":"这个比喻太形象了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600674180,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1323652,"avatar":"","nickname":"sibyl","note":"","ucode":"0D142011860D69","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":285542,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592875296,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1494921,"avatar":"https://static001.geekbang.org/account/avatar/00/16/cf/89/3796d969.jpg","nickname":"懒羊羊","note":"","ucode":"D0FF5CCC60874A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":12529,"discussion_content":"满血复活和副本有什么区别","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568542169,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1695207,"avatar":"https://static001.geekbang.org/account/avatar/00/19/dd/e7/0d923009.jpg","nickname":"Geek_Winy","note":"","ucode":"BEE395FC91E131","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1494921,"avatar":"https://static001.geekbang.org/account/avatar/00/16/cf/89/3796d969.jpg","nickname":"懒羊羊","note":"","ucode":"D0FF5CCC60874A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":30001,"discussion_content":"我的理解：满血复活是指本数据库恢复为来的及写入的数据，副本是创建另一个从库之类的额；binlog不能用来作为崩溃恢复主要是没有redolog的chekpoint吧","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1570793778,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":12529,"ip_address":""},"score":30001,"extra":""},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1494921,"avatar":"https://static001.geekbang.org/account/avatar/00/16/cf/89/3796d969.jpg","nickname":"懒羊羊","note":"","ucode":"D0FF5CCC60874A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553496,"discussion_content":"满血复活就是一模一样;副本只能跟某个时间线的数据保持一致","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645931754,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":12529,"ip_address":""},"score":553496,"extra":""}]}]},{"had_liked":false,"id":39667,"user_name":"Lugyedo","can_delete":false,"product_type":"c1","uid":1011793,"ip_address":"","ucode":"EB5E456B638E70","user_header":"https://static001.geekbang.org/account/avatar/00/0f/70/51/f1825adb.jpg","comment_is_top":false,"comment_ctime":1542333851,"is_pvip":true,"replies":[{"id":"14188","content":"事务ID （比较细节，就没在正文里写了","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542335110,"ip_address":"","comment_id":39667,"utype":1}],"discussion_count":2,"race_medal":0,"score":"194815862171","product_id":100020801,"comment_content":"redo log和bin log怎么对应","like_count":45,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429170,"discussion_content":"事务ID （比较细节，就没在正文里写了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542335110,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1247155,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK9BHsYJRKhYarAarOlbicAyOfppmoI9arpryXFyqdKHC3bprWpfhVS2NosWQwBcTl2O2qmAnTgAqg/132","nickname":"wxw","note":"","ucode":"C90B38853B9E36","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":569273,"discussion_content":"应该准确来说是XID吧。  事务ID和XID是两个概念的吧 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651389811,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39558,"user_name":"文@雨路","can_delete":false,"product_type":"c1","uid":1103072,"ip_address":"","ucode":"1EE59E03F9939C","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/e0/513d185e.jpg","comment_is_top":false,"comment_ctime":1542303077,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"143276223845","product_id":100020801,"comment_content":"老师，也就是说状态恢复的过程会去同时检查redo log和binlog？不然怎么能确定一个prepare的redo log已经写好了binlog，因为不检查的话不能确定到底是写好了binlog之后奔溃的还是写之前奔溃的，也就不能确定这个prepare log的合法性。如果检查的话那么不用两阶段提交好像也没什么问题，无论先写哪个日志都可以。","like_count":33,"discussions":[{"author":{"id":1137853,"avatar":"https://static001.geekbang.org/account/avatar/00/11/5c/bd/f5d0a2c8.jpg","nickname":"逗比","note":"","ucode":"C8263662F1552B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368242,"discussion_content":"理论是理论吧，两阶段这玩意也不靠谱，所以用了两阶段和恢复的时候检查，才能更好的保证一致性","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618630294,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1064247,"avatar":"https://static001.geekbang.org/account/avatar/00/10/3d/37/bbe5f958.jpg","nickname":"王晨","note":"","ucode":"942D9BD67A3418","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367864,"discussion_content":"我猜是的，但是如果binlog关掉了，是不是直接就是提交状态了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618487778,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39806,"user_name":"约书亚","can_delete":false,"product_type":"c1","uid":1046714,"ip_address":"","ucode":"81EA27ADD9EC1A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg","comment_is_top":false,"comment_ctime":1542359842,"is_pvip":false,"replies":[{"id":"14289","content":"有用，如果redolog 已经commit了，崩溃恢复就不需要去找binlog. ","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542361724,"ip_address":"","comment_id":39806,"utype":1}],"discussion_count":9,"race_medal":0,"score":"126096411426","product_id":100020801,"comment_content":"看到了文@雨路的留言，和我的疑问一模一样。另外有个没提到，如果认可这个事务可以从crash恢复，起码要求服务器告知客户端事务成功了吧，那您说redo log prepare + bin log ok，就可以恢复了，说明bin log写入成功就算事务成功了？那最后一步确实没什么用呀。","like_count":29,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429233,"discussion_content":"有用，如果redolog 已经commit了，崩溃恢复就不需要去找binlog. ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542361724,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2711249,"avatar":"","nickname":"Geek_60bcde","note":"","ucode":"AD7792E790373F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387709,"discussion_content":"也就说，按照redolog来恢复数据的时候，发现状态是prepare，就会去根据事务ID找到对应的binlog进行查询。如果binlog存在，则commit。本身已经commit的redolog就省去了这个步骤，直接根据redolog恢复数据即可","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1628369372,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1228424,"avatar":"https://static001.geekbang.org/account/avatar/00/12/be/88/8d15796f.jpg","nickname":"John","note":"","ucode":"A46AF2906C38C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":309860,"discussion_content":"commit仅仅是一个标识位的检查，耗时非常短，而在binlog中扫描到对应的事务并检查binlog是否完整，是一个相对耗时的过程","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1601468320,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1217413,"avatar":"https://static001.geekbang.org/account/avatar/00/12/93/85/f5d9474c.jpg","nickname":"乔丹","note":"","ucode":"D832A9F97A0C7E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":163561,"discussion_content":"必须commit  就像提交svn一样   先add  然后commit。哈哈。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1581085489,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586938,"discussion_content":"最后一步如果成功了，那么就不需要去校验binlog的完整性了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662619539,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549774,"discussion_content":"Binlog+prepare就算成功，可是只有commit后才会给客户端返回事务成功吧？如果commit之前crash了，客户端没有收到成功，但是此时binlog+prepare已经算成功，不知道这种客户端和数据库服务端的不一致是不是会有影响？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644232010,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1362509,"avatar":"https://static001.geekbang.org/account/avatar/00/14/ca/4d/3f5b3939.jpg","nickname":"山水有相逢","note":"","ucode":"1BD2C4DE0CB673","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293541,"discussion_content":"有没可能 出现binlog写入成功，redolog写入失败的可能？？？？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595572272,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1611462,"avatar":"https://static001.geekbang.org/account/avatar/00/18/96/c6/5ae62afe.jpg","nickname":"Change","note":"","ucode":"C65BB004EEAF2B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1362509,"avatar":"https://static001.geekbang.org/account/avatar/00/14/ca/4d/3f5b3939.jpg","nickname":"山水有相逢","note":"","ucode":"1BD2C4DE0CB673","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":299635,"discussion_content":"不会，你看执行过程，更新完之后，引擎层先写的redo log 进入prepare状态，然后告诉执行器事务可以提交，此时执行器才会生成bin log并写到磁盘","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1597756300,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":293541,"ip_address":""},"score":299635,"extra":""}]},{"author":{"id":1494921,"avatar":"https://static001.geekbang.org/account/avatar/00/16/cf/89/3796d969.jpg","nickname":"懒羊羊","note":"","ucode":"D0FF5CCC60874A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":12536,"discussion_content":"也就是如果你确定所有数据都提交了，可以用redolog去恢复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568543035,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50805,"user_name":"act","can_delete":false,"product_type":"c1","uid":1316520,"ip_address":"","ucode":"F6A91056E39F8C","user_header":"https://static001.geekbang.org/account/avatar/00/14/16/a8/75476086.jpg","comment_is_top":false,"comment_ctime":1545048921,"is_pvip":false,"replies":[{"id":"18274","content":"都不是，<br>直接读内存😄","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545055457,"ip_address":"","comment_id":50805,"utype":1}],"discussion_count":14,"race_medal":0,"score":"121804133209","product_id":100020801,"comment_content":"执行一条Update 语句后，马上又执行一条 select * from table limit 10。<br><br>如果刚刚update的记录，还没持久化到磁盘中，而偏偏这个时候的查询条件，又包含了刚刚update的记录。<br><br>那么这个时候，是从日志中获取刚刚update的最新结果，还是说，先把日志中的记录先写磁盘，再返回最新结果？","like_count":28,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433115,"discussion_content":"都不是，\n直接读内存😄","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1545055457,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1886331,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/c8/7b/153181d7.jpg","nickname":"夜辉","note":"","ucode":"9421385F51FF9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377344,"discussion_content":"内存指的是innodb的buffer pool","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1622607594,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1115346,"avatar":"https://static001.geekbang.org/account/avatar/00/11/04/d2/51807e94.jpg","nickname":"Jokerone_","note":"","ucode":"11FB21838ACE8B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":282964,"discussion_content":"单条update语句，然后批量查询，内存里怎么找？又不是单条记录查询的。。。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1592129905,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1137853,"avatar":"https://static001.geekbang.org/account/avatar/00/11/5c/bd/f5d0a2c8.jpg","nickname":"逗比","note":"","ucode":"C8263662F1552B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1115346,"avatar":"https://static001.geekbang.org/account/avatar/00/11/04/d2/51807e94.jpg","nickname":"Jokerone_","note":"","ucode":"11FB21838ACE8B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368243,"discussion_content":"查询就是一条一条处理的，但是不代表一条条就是一次io，数据库会预取页到内存","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1618630687,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":282964,"ip_address":""},"score":368243,"extra":""},{"author":{"id":1159645,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b1/dd/c814190f.jpg","nickname":"巴子小","note":"","ucode":"1C3D35AEC235BB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1137853,"avatar":"https://static001.geekbang.org/account/avatar/00/11/5c/bd/f5d0a2c8.jpg","nickname":"逗比","note":"","ucode":"C8263662F1552B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556221,"discussion_content":"Jokerone_的意思应该是 批量查询的数据一部分在内存，一部分在磁盘，怎么组合","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647253582,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":368243,"ip_address":""},"score":556221,"extra":""}]},{"author":{"id":1112815,"avatar":"https://static001.geekbang.org/account/avatar/00/10/fa/ef/9d3fcb40.jpg","nickname":"lq","note":"","ucode":"1C9D741B906403","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":82092,"discussion_content":"不是说更新的时候会清空查询缓存的吗","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1576319337,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1508329,"avatar":"https://static001.geekbang.org/account/avatar/00/17/03/e9/6358059c.jpg","nickname":"GalaxyCreater","note":"","ucode":"C79E8A088D57CF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":78214,"discussion_content":"那客户端得到结果后，这时磁盘还没写入，这时数据库crash掉了，binlog还没写，重启恢复，这时候客户端的数据和数据库保存的数据不一致了，那客户端拿着这条数据做些更新数据库的逻辑，那这些数据会永久脏下去了？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575983898,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1810051,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK0uyg1IicbEhLwsgM2A2ROoyVdWdmUqZfQfs6G67w9m3hdRNBMOQJatQoACj3qNGgj2KVIgricaYiaQ/132","nickname":"木得感情的编码机器","note":"","ucode":"9C6CD47ADCB8E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1508329,"avatar":"https://static001.geekbang.org/account/avatar/00/17/03/e9/6358059c.jpg","nickname":"GalaxyCreater","note":"","ucode":"C79E8A088D57CF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":165572,"discussion_content":"binlog没写，但redo log写了。如果redo log也没写，后续的操作也不可能正常进行。因为log是增量的，不可能说磁盘中会先写入后续的log，再去写前面的log","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581303297,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":78214,"ip_address":""},"score":165572,"extra":""},{"author":{"id":1988131,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/56/23/848ac9f4.jpg","nickname":"Ken","note":"","ucode":"DB59170F4FC74E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1508329,"avatar":"https://static001.geekbang.org/account/avatar/00/17/03/e9/6358059c.jpg","nickname":"GalaxyCreater","note":"","ucode":"C79E8A088D57CF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":363669,"discussion_content":"呵呵，你这个问题挺有意思的。我来试回答下吧，希望没有误导你。\n\n1、如果客户端得到结果后，这说明在之前写操作的事务已经提交，这时不用管服务器端有没有挂，这个数据是没有问题的。\n2、如果binlog还没写，那就是还没有到事务提交的阶段，未提交的事务不会返回给客户端的。服务器crash-safe后回滚了数据，对客户端来说不影响。\n3、如果事务未提交客户端就能查询到结果，那就是脏读了。脏读就是在其他事务未提交的情况下也可以查到最新的数据。实际上，这个事务在后面可以被提交也可以被回滚，所以不管服务器端是否挂了也影响不大。\n\n服务器crash-safe之后，数据该回滚的回滚，该提交的提交。刚刚重启完，如果没有写数据，内存和磁盘数据是一致的。写到这里，我好像答非所问，晕。。。\n","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1617257633,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":78214,"ip_address":""},"score":363669,"extra":""},{"author":{"id":1159645,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b1/dd/c814190f.jpg","nickname":"巴子小","note":"","ucode":"1C3D35AEC235BB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1988131,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/56/23/848ac9f4.jpg","nickname":"Ken","note":"","ucode":"DB59170F4FC74E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556222,"discussion_content":"但是如果事务提交了，数据、redo、binlog也都写到内存，但是都没刷盘，这时客户端读取了内存中的数据，宕机了，那客户端读到的数据不就是脏的了吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647254714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":363669,"ip_address":""},"score":556222,"extra":""}]},{"author":{"id":1084363,"avatar":"https://static001.geekbang.org/account/avatar/00/10/8b/cb/54cea34c.jpg","nickname":"竹寺","note":"","ucode":"18FE4BC7C08713","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":39931,"discussion_content":"所以是调用引擎接口查询对应记录的时候，引擎层会先去内存看是否存在对应的记录，如果有记录就直接返回，没有的话再去查询磁盘获取记录？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572018098,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1605016,"avatar":"https://static001.geekbang.org/account/avatar/00/18/7d/98/2d1932c9.jpg","nickname":"迷路的猴子","note":"","ucode":"E64300CD4FB1D0","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1084363,"avatar":"https://static001.geekbang.org/account/avatar/00/10/8b/cb/54cea34c.jpg","nickname":"竹寺","note":"","ucode":"18FE4BC7C08713","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":237325,"discussion_content":"我觉得是","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587138116,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":39931,"ip_address":""},"score":237325,"extra":""}]},{"author":{"id":1494921,"avatar":"https://static001.geekbang.org/account/avatar/00/16/cf/89/3796d969.jpg","nickname":"懒羊羊","note":"","ucode":"D0FF5CCC60874A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":12531,"discussion_content":"视作没有更新吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568542236,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40222,"user_name":"小虾米","can_delete":false,"product_type":"c1","uid":1005528,"ip_address":"","ucode":"F543987A7FAB20","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/d8/425e1b0a.jpg","comment_is_top":false,"comment_ctime":1542559984,"is_pvip":false,"discussion_count":9,"race_medal":0,"score":"121801644272","product_id":100020801,"comment_content":"刚开始我也是比较疑惑既然有了binlog，为何还需要redolog。把老师的文章反复看了几遍大概弄明白了，redolog是innodb引擎特有的，为了WAL而存在,更新操作是先写入redolog，之后异步写到数据的磁盘文件中。假设现在前后更新了2条记录并且都写入binlog后突然宕机，在服务重启后，如果只根据binlog是无法获知当前磁盘上的数据文件中那2条记录的状态是否是最新的（除非从头开始跑一遍binlog），所以一定要借助redolog才能知道宕机前有哪些记录还没更新到磁盘。如果存储引擎不支持WAL，也不支持事务回滚，每次更新都是直接更新到数据磁盘中，这应该不需要考虑宕机的问题。因为WAL的异步写入存在，所以需要解决宕机的恢复问题，需要redolog的协助，而redolog需要和binlog保持状态一致，这又要依靠两阶段提交。","like_count":28,"discussions":[{"author":{"id":1128420,"avatar":"https://static001.geekbang.org/account/avatar/00/11/37/e4/5d7a32c6.jpg","nickname":"creasylai19","note":"","ucode":"F9B04060FCFD3F","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572550,"discussion_content":"可以在binlog中记录一个偏移量么，代表binlog中的数据那些是否已经同步到数据文件中……这样不需要redolog了，恢复的时候直接看binlog","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652849847,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":2371590,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoWkj13nDtjosQeeaZDIBcrzX3UPIMibWvq1KY0oqclpxUIZAIetRtvwia65IEl0AJgnetNV2XKLtPQ/132","nickname":"Geek_lee","note":"","ucode":"5BAA7A7B7BBD5A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1128420,"avatar":"https://static001.geekbang.org/account/avatar/00/11/37/e4/5d7a32c6.jpg","nickname":"creasylai19","note":"","ucode":"F9B04060FCFD3F","race_medal":1,"user_type":1,"is_pvip":false},"discussion":{"id":584418,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660811280,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":572550,"ip_address":"北京"},"score":584418,"extra":""},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2371590,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoWkj13nDtjosQeeaZDIBcrzX3UPIMibWvq1KY0oqclpxUIZAIetRtvwia65IEl0AJgnetNV2XKLtPQ/132","nickname":"Geek_lee","note":"","ucode":"5BAA7A7B7BBD5A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586936,"discussion_content":"思考一下：\n1.binlog如何实现checkpoint标明恢复位点\n2.binlog如何表示数据页的版本标明是否进行更新\n\n第一点好实现但是第二点作为逻辑日志的binlog是无法知道数据页具体详情的。\n综上，redo log是最佳实践","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662619297,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":584418,"ip_address":"广东"},"score":586936,"extra":""}]},{"author":{"id":2552755,"avatar":"https://static001.geekbang.org/account/avatar/00/26/f3/b3/9b0ec8c0.jpg","nickname":"独行浪子剑","note":"","ucode":"7480493576A9F0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391087,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630290483,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1160678,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b5/e6/c67f12bd.jpg","nickname":"左耳朵东","note":"","ucode":"60134ACF12BB52","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":379042,"discussion_content":"这样一说就通了，赞","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623640253,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2300779,"avatar":"","nickname":"Geek_886bfd","note":"","ucode":"5F2A03D4ED7C30","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351721,"discussion_content":"mark一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614413857,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1261949,"avatar":"https://static001.geekbang.org/account/avatar/00/13/41/7d/09b40420.jpg","nickname":"演yăn绎yì","note":"","ucode":"31A0B85D9046A9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":345534,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611737016,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2315864,"avatar":"https://static001.geekbang.org/account/avatar/00/23/56/58/b680b06f.jpg","nickname":"呱呱蛙","note":"","ucode":"9FB9EFFA125B52","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":325581,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605356749,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1323652,"avatar":"","nickname":"sibyl","note":"","ucode":"0D142011860D69","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":285550,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592876989,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45315,"user_name":"KeepGoing","can_delete":false,"product_type":"c1","uid":1184637,"ip_address":"","ucode":"B872F794265709","user_header":"https://static001.geekbang.org/account/avatar/00/12/13/7d/1454db9c.jpg","comment_is_top":false,"comment_ctime":1543585773,"is_pvip":true,"replies":[{"id":"16134","content":"1. Redolog是顺序写，数据文件是随机写。虽然都写盘，顺序写还是快很多的<br><br>2. 这个我在答疑文章中展开哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543628063,"ip_address":"","comment_id":45315,"utype":1}],"discussion_count":12,"race_medal":0,"score":"113212735469","product_id":100020801,"comment_content":"我有点蒙，<br>1.如果把innodb_flush_log_at_trx_commit设置成1每次都写入到磁盘，那不就等于是掌柜的每次记账都记到账本上嘛，那还要小黑板干嘛呢？感觉我从文中没理解到各位大神已知的信息一样。<br>2.binlog是逻辑，redolog是物理，两者都能记录历史，如果发生异常情况binlog就可以恢复数据，为什么说只有redolog才能算是crash-safe了呢。<br>可能是我基础不够就看大神的文章，有些懵，还烦老师给解一下疑惑～谢谢。","like_count":26,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430981,"discussion_content":"1. Redolog是顺序写，数据文件是随机写。虽然都写盘，顺序写还是快很多的\n\n2. 这个我在答疑文章中展开哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543628063,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1464006,"avatar":"https://static001.geekbang.org/account/avatar/00/16/56/c6/0b449bc6.jpg","nickname":"斐波那契","note":"","ucode":"85E2EBC01392B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":51855,"discussion_content":"我觉得你可能有点理解偏差 redo log写进磁盘里就是写进小黑板 记账本是更新数据记录 而innodb_flush_log_at_trx_commit设置成非1你可以理解为“餐馆里张三赊账酒5元 荤菜5元 由于老板跟张三很熟又都是赊账5元 老板很容易记下 所以连小黑板都懒得写了 回头张三迟迟不还帐在记到小黑板上”而如果参数设置成1就表示无论是熟人张三还是路人只要赊我的帐我一律记到小黑板上","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1573961415,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1111985,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg","nickname":"Frank","note":"","ucode":"9DADD72C193296","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1464006,"avatar":"https://static001.geekbang.org/account/avatar/00/16/56/c6/0b449bc6.jpg","nickname":"斐波那契","note":"","ucode":"85E2EBC01392B1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":139714,"discussion_content":"如果innodb_flush_log_at_trx_commit=1是redolog写入磁盘, 那什么时候redo log 同步写入数据文件呢。即账本","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579312915,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":51855,"ip_address":""},"score":139714,"extra":""},{"author":{"id":1810051,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK0uyg1IicbEhLwsgM2A2ROoyVdWdmUqZfQfs6G67w9m3hdRNBMOQJatQoACj3qNGgj2KVIgricaYiaQ/132","nickname":"木得感情的编码机器","note":"","ucode":"9C6CD47ADCB8E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1111985,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg","nickname":"Frank","note":"","ucode":"9DADD72C193296","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":165575,"discussion_content":"bin log是账本，和redo log无关。两者是独立逻辑。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581303390,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":139714,"ip_address":""},"score":165575,"extra":""},{"author":{"id":1442605,"avatar":"https://static001.geekbang.org/account/avatar/00/16/03/2d/404627dc.jpg","nickname":"Anryg Zhun","note":"","ucode":"76DF8560BA9D14","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1111985,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg","nickname":"Frank","note":"","ucode":"9DADD72C193296","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":188370,"discussion_content":"Commit时候","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582810310,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":139714,"ip_address":""},"score":188370,"extra":""}]},{"author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"一元(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302487,"discussion_content":"可能是你对redo log的刷盘理解有误吧。这个问题我这么说你可能就明白了。\ninnodb_flush_log_at_trx_commit设置成1是每次redo log都写入到磁盘，并非是更新的数据入库到磁盘。redo log写入磁盘可以理解为，掌柜每次将粉板上的数据记录到账本中，但这个记录无需归档到具体那个人下面的记录，而是在账本的某一页直接按照顺序记录下来，也是对应是顺序写盘。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1598932051,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1690807,"avatar":"https://static001.geekbang.org/account/avatar/00/19/cc/b7/af6ef83d.jpg","nickname":"抢小孩子糖吃","note":"","ucode":"09F302FC76582A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":51617,"discussion_content":"第一个问题同样没搞懂","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1573908980,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1679661,"avatar":"https://static001.geekbang.org/account/avatar/00/19/a1/2d/599e9051.jpg","nickname":"CycleGAN","note":"","ucode":"9FD04813911A02","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332369,"discussion_content":"我的理解，redolog本身也涉及到是写磁盘还是写在内存中，或者攒攒再写。就好比老板是直接记在黑板上，还是，可是写到记在脑子里过一会几个人的一起写到黑板上，不过，不落盘，不是又增加不可靠性了吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607172982,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1435803,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e8/9b/de4e4aaa.jpg","nickname":"O O","note":"","ucode":"F5B9F61D6411C4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":275552,"discussion_content":"这个设置为1的话，数据库的性能会有很大影响吧，我看书里面不建议设置为1的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590728725,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1198537,"avatar":"https://static001.geekbang.org/account/avatar/00/12/49/c9/e8be8bef.jpg","nickname":"Mù.","note":"","ucode":"682B035D7B2A77","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":226122,"discussion_content":"设置为1的话实现了强一致性，小黑板貌似没起到啥作用。0和2的话，小黑板本身顺序写和刷盘时的批量写，速度会比直接刷盘要快。\n设置为0：每隔1s,日志缓冲区(Log Buffer)中数据批量写入redo log file，同时批量刷盘。\n设置为1：每次事务提交，日志缓冲区(Log Buffer)中数据写入redo log file，同时刷盘。\n设置为2：每次事务提交，日志缓冲区(Log Buffer)中数据写入redo log file，每隔1s,批量刷盘。\n这样应该会清楚一些。个人理解。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586423577,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1137853,"avatar":"https://static001.geekbang.org/account/avatar/00/11/5c/bd/f5d0a2c8.jpg","nickname":"逗比","note":"","ucode":"C8263662F1552B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1198537,"avatar":"https://static001.geekbang.org/account/avatar/00/12/49/c9/e8be8bef.jpg","nickname":"Mù.","note":"","ucode":"682B035D7B2A77","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368244,"discussion_content":"你这说法就不对，他这个文章的黑板是已经代表写了文件了，你所谓的012就是到底是不是你脑子里记着，一批批写到黑板","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618630928,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":226122,"ip_address":""},"score":368244,"extra":""}]}]},{"had_liked":false,"id":44329,"user_name":"linqw","can_delete":false,"product_type":"c1","uid":1134138,"ip_address":"","ucode":"09DCFE98C54DD8","user_header":"https://static001.geekbang.org/account/avatar/00/11/4e/3a/86196508.jpg","comment_is_top":false,"comment_ctime":1543409400,"is_pvip":false,"replies":[{"id":"15867","content":"很好👍🏿<br><br>最后一段，“有索引”写数据也慢，因为是随机写","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543418742,"ip_address":"","comment_id":44329,"utype":1}],"discussion_count":3,"race_medal":0,"score":"100327657208","product_id":100020801,"comment_content":"学习后的收获总结：<br>1、首先数据库更新操作都是基于内存页，更新的时候不会直接更新磁盘，如果内存有存在就直接更新内存，如果内存没有存在就从磁盘读取到内存，在更新内存，并且写redo log，目的是为了更新效率更快，等空闲时间在将其redo log所做的改变更新到磁盘中，innodb_flush_log_at_trx_commit设置为1时，也可以防止服务出现异常重启，数据不会丢失<br>2、redo log两阶段提交，是为了保证redo log和binlog的一致性，如果redo log写入成功处于prepare阶段，写binlog失败，事务回滚，redo log会回滚到操作之前的状态<br>3、redo log也是写磁盘，写redo log是顺序写，update直接更新磁盘，需要找到数据，再对此数据进行更新，如果没有使用索引，数据量大会导致更新效率慢，不对的地方，望老师指点哦","like_count":23,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430729,"discussion_content":"很好👍🏿\n\n最后一段，“有索引”写数据也慢，因为是随机写","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543418742,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2300779,"avatar":"","nickname":"Geek_886bfd","note":"","ucode":"5F2A03D4ED7C30","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351722,"discussion_content":"mark一下，解决了我的疑惑：更新操作不会直接把结果立刻持久化到磁盘，而是更新到内存。（这样做可以实现快速响应，也是WAL的优势）","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1614413978,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2739046,"avatar":"https://static001.geekbang.org/account/avatar/00/29/cb/66/c34226a9.jpg","nickname":"非墨","note":"","ucode":"6C2F75B04DA1EB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":396027,"discussion_content":"是不是意味着内存中如果有数据是不会走索引的， 没有数据才会通过索引去磁盘寻找数据？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632382574,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39986,"user_name":"阿May的海绵宝宝","can_delete":false,"product_type":"c1","uid":1203058,"ip_address":"","ucode":"AA2B28DF8BEF80","user_header":"https://static001.geekbang.org/account/avatar/00/12/5b/72/4f8a4297.jpg","comment_is_top":false,"comment_ctime":1542428499,"is_pvip":false,"replies":[{"id":"14368","content":"1 对的<br>2 对的👍🏿<br>3 建议使用row格式，就是第二种","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542440371,"ip_address":"","comment_id":39986,"utype":1}],"discussion_count":1,"race_medal":0,"score":"96031709011","product_id":100020801,"comment_content":"1.单独依靠redologo无法做到指定某一点的恢复，是不是因为redologo是循环写的，如果要恢复的那一时刻被擦掉了，就无法知道这点的数据变动轨迹，而binlog是追加的方式，在文件完整的前提下，数据的变动轨迹都可以知晓？<br>2. 最后三步是 ①引擎写redolog，并处于prepare状态   ②执行器写binlog，成功后，发送commit<br>   ③引擎刚写入的redolog改变为commit状态<br>  如果crash发生后  redolog =prepare   binlog没有对应写入记录，则回滚<br>  如果crash发生后  redolog =prepare  binlog有对应写入记录，则提交<br>感觉有点像  1 &amp;&amp; 1= 1   1&amp;&amp;0=0   0&amp;&amp;1=0<br>3.binlog模式  ①记录sql语句    ②记录更新前后的行     一般是用哪种模式？","like_count":22,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429319,"discussion_content":"1 对的\n2 对的👍🏿\n3 建议使用row格式，就是第二种","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542440371,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39988,"user_name":"魔都浪子","can_delete":false,"product_type":"c1","uid":1177859,"ip_address":"","ucode":"8301440705105A","user_header":"https://static001.geekbang.org/account/avatar/00/11/f9/03/439bdb70.jpg","comment_is_top":false,"comment_ctime":1542428909,"is_pvip":false,"replies":[{"id":"14367","content":"不是，并没有返回“事务失败”呀，而是“执行异常”。执行异常本来就可能成功也可能失败的。你想一下这个场景：执行全部完成了，在回复客户端的时候网络断了，这怎么算😄","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542440280,"ip_address":"","comment_id":39988,"utype":1}],"discussion_count":10,"race_medal":0,"score":"74556872941","product_id":100020801,"comment_content":"在binlog写入磁盘后，commit提交前发生crash，由于commit没有成功，那返回给客户端的消息是事物失败，但是在系统恢复的时候却会重新提交事物，使之成功，这不是在欺骗客户端嘛？问题很大啊","like_count":17,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429321,"discussion_content":"不是，并没有返回“事务失败”呀，而是“执行异常”。执行异常本来就可能成功也可能失败的。你想一下这个场景：执行全部完成了，在回复客户端的时候网络断了，这怎么算😄","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1542440280,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":549779,"discussion_content":"Mark。也有同样的疑问。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644233514,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":429321,"ip_address":""},"score":549779,"extra":""}]},{"author":{"id":1494921,"avatar":"https://static001.geekbang.org/account/avatar/00/16/cf/89/3796d969.jpg","nickname":"懒羊羊","note":"","ucode":"D0FF5CCC60874A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":12540,"discussion_content":"这样子应用程序怎么判断","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1568543740,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2351720,"avatar":"https://static001.geekbang.org/account/avatar/00/23/e2/68/ce547a12.jpg","nickname":"zjm1314","note":"","ucode":"63B0EAB7045054","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1494921,"avatar":"https://static001.geekbang.org/account/avatar/00/16/cf/89/3796d969.jpg","nickname":"懒羊羊","note":"","ucode":"D0FF5CCC60874A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339673,"discussion_content":"其实，这个问题本质就是因为网络问题导致的网络异常问题，引入重试机制","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609755149,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":12540,"ip_address":""},"score":339673,"extra":""}]},{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549780,"discussion_content":"这时客户端做补偿，要处理好幂等性","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644233604,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1886331,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/c8/7b/153181d7.jpg","nickname":"夜辉","note":"","ucode":"9421385F51FF9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377345,"discussion_content":"业务根据主键查询结果，失败则重试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622608110,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1175246,"avatar":"https://static001.geekbang.org/account/avatar/00/11/ee/ce/c024a857.jpg","nickname":"藏锋","note":"","ucode":"D5F811B16725A0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":369598,"discussion_content":"提示用户异常，但是MySQL重启后通过重放事务，实际上是成功的，这在用户看来如何理解？在这个事务commit之前MySQL就挂了，但是重启后还是要执行commit操作的依据难道就是看binlog是否写成功？意思就是在写binlog之前mysql挂了重启后是执行回滚操作，而如果是在binlog写成功后挂了，那么在mysql恢复后依然执行commit操作？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619089959,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1064247,"avatar":"https://static001.geekbang.org/account/avatar/00/10/3d/37/bbe5f958.jpg","nickname":"王晨","note":"","ucode":"942D9BD67A3418","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367872,"discussion_content":"是的，这种就是不知道到底是成功还是失败了，包括微服务里面被调用方返回一个未知异常，也不知道到底是成功了还是失败了，是需要补偿的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618489090,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1143234,"avatar":"","nickname":"刘瑞","note":"","ucode":"7E712BC281A8A7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":215049,"discussion_content":"同问，蒙蒙的，那客户端没法判断成功还是失败了，逻辑不就有问题了吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585276752,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2351720,"avatar":"https://static001.geekbang.org/account/avatar/00/23/e2/68/ce547a12.jpg","nickname":"zjm1314","note":"","ucode":"63B0EAB7045054","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1143234,"avatar":"","nickname":"刘瑞","note":"","ucode":"7E712BC281A8A7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339671,"discussion_content":"这种异常程序做补偿，重试机制","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609755087,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":215049,"ip_address":""},"score":339671,"extra":""}]}]},{"had_liked":false,"id":39870,"user_name":"吕","can_delete":false,"product_type":"c1","uid":1210890,"ip_address":"","ucode":"8F08E2CB81C4C3","user_header":"https://static001.geekbang.org/account/avatar/00/12/7a/0a/0ce5c232.jpg","comment_is_top":false,"comment_ctime":1542372090,"is_pvip":false,"replies":[{"id":"14323","content":"MySQL的记录是以“页”为单位存取的，默认大小16K。也就是说，你要访问磁盘中一个记录，不会只读这个记录，而会把它所在的16K数据一起读入内存","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542377698,"ip_address":"","comment_id":39870,"utype":1}],"discussion_count":4,"race_medal":0,"score":"74556816122","product_id":100020801,"comment_content":"你好，关于提到的&#39;数据页&#39;这个词我没有太理解，是一种存储方式么？","like_count":17,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429266,"discussion_content":"MySQL的记录是以“页”为单位存取的，默认大小16K。也就是说，你要访问磁盘中一个记录，不会只读这个记录，而会把它所在的16K数据一起读入内存","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1542377698,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2933325,"avatar":"","nickname":"阿童挺挺","note":"","ucode":"821F0ADB38335C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":564280,"discussion_content":"mark\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650205605,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549781,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644233644,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1261949,"avatar":"https://static001.geekbang.org/account/avatar/00/13/41/7d/09b40420.jpg","nickname":"演yăn绎yì","note":"","ucode":"31A0B85D9046A9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":345585,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611748908,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39826,"user_name":"haruki","can_delete":false,"product_type":"c1","uid":1233609,"ip_address":"","ucode":"EE1BA166F20466","user_header":"https://static001.geekbang.org/account/avatar/00/12/d2/c9/f262f947.jpg","comment_is_top":false,"comment_ctime":1542361915,"is_pvip":false,"replies":[{"id":"14296","content":"一个事务的完整binlog是有固定格式，也就是说有固定结尾的😄","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542362881,"ip_address":"","comment_id":39826,"utype":1}],"discussion_count":3,"race_medal":0,"score":"74556805947","product_id":100020801,"comment_content":"老师，有个疑问，怎么知道binlog是完整的？这个想不通","like_count":17,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429244,"discussion_content":"一个事务的完整binlog是有固定格式，也就是说有固定结尾的😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542362881,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2856444,"avatar":"","nickname":"Geek_fa5eed","note":"","ucode":"9C18B5CD83C112","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583651,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660270978,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"四川"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549778,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644233448,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39808,"user_name":"Elvis","can_delete":false,"product_type":"c1","uid":1308724,"ip_address":"","ucode":"1FDE773C5AA43D","user_header":"https://static001.geekbang.org/account/avatar/00/13/f8/34/2ce5e546.jpg","comment_is_top":false,"comment_ctime":1542360315,"is_pvip":false,"replies":[{"id":"14288","content":"要写IO，是会影响，但是为了数据可靠性，还是要做的。<br><br>Redolog是直接写盘的，更新的内存是数据的内存。<br><br>如果没有写完就重启，就回滚，不算的丢数据","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542361668,"ip_address":"","comment_id":39808,"utype":1}],"discussion_count":4,"race_medal":0,"score":"74556804347","product_id":100020801,"comment_content":"请教下redo log 和 binlog 也是需要写文件的，也会消耗IO，这个不会影响数据库的性能吗？ 从内容看redo log首先写道缓存中，如果这个时候断电了，缓存也清空了，尚未写道磁盘，这个时候不是redo log 不完整的如何保证恢复的完整性呢？麻烦老师指教下","like_count":17,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429234,"discussion_content":"要写IO，是会影响，但是为了数据可靠性，还是要做的。\n\nRedolog是直接写盘的，更新的内存是数据的内存。\n\n如果没有写完就重启，就回滚，不算的丢数据","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542361668,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":3,"child_discussions":[{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":549777,"discussion_content":"请问，总结中不是说把redo log的innodb_flush_log_at_trx_commit 设置成1，redo log才会将每个事务记录直接写磁盘吗？如果这个参数不为1，那是不是redo log也有可能有丢日志的情况?作者这里说redo log是直接写盘的，是不是就只是说这个参数为1时的情况?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644233419,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":429234,"ip_address":""},"score":549777,"extra":""},{"author":{"id":1911661,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLDOKcx20Xxmu5j8WxiafoYvo3bIAFDg8OeicRic1icD597QuMC9O8FyV2Al9RxNfVZXK0gkGUx6M3CVQ/132","nickname":"多年以后","note":"","ucode":"D70E7A1ABE0F39","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550431,"discussion_content":"同意，我觉得Elvis说的redo log写入缓存指的log buffer如果把innodb_flush_log_at_trx_commit设置成1 才不会丢数据","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644544577,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":549777,"ip_address":""},"score":550431,"extra":""},{"author":{"id":2104089,"avatar":"https://static001.geekbang.org/account/avatar/00/20/1b/19/0d14cb36.jpg","nickname":"这就是网名","note":"","ucode":"B39577B1602183","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":571427,"discussion_content":"redolog和binlog刷盘策略不同时，两个数据在宕机时就可能差异较大，那两段提交还有意义吗？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1652202337,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":429234,"ip_address":""},"score":571427,"extra":""}]}]},{"had_liked":false,"id":48063,"user_name":"某、人","can_delete":false,"product_type":"c1","uid":1308784,"ip_address":"","ucode":"ADB42AA12A11C1","user_header":"https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg","comment_is_top":false,"comment_ctime":1544338774,"is_pvip":false,"replies":[{"id":"17140","content":"复习的好习惯呀👍🏿<br><br>如果你设置来双MM，启动以后binlog还会传到新主库的。<br><br>但是如果你设置的是单向的，那就会不一致了…<br>","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544357367,"ip_address":"","comment_id":48063,"utype":1}],"discussion_count":2,"race_medal":0,"score":"70263815510","product_id":100020801,"comment_content":"老师,打搅了,吃盘回锅肉,还有个问题想请假下。<br>开启了半同步复制after_sync以后，假设一个事务在已经把binlog sync到磁盘了,在传输binlog到从库上时,主库挂了。如果这时发生了主从切换,从库是没有这个事务的.但是挂掉的主库重新启起来,由于binlog已经fsync到磁盘,虽然引擎层未commit,但是会根据binlog来恢复这个事务.这个时候就是主从不一致了,那么和after_commit那就没区别呀。请问这个事务是恢复还是回滚呢？如果是回滚,内部又是怎么判断的呢？","like_count":16,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432014,"discussion_content":"复习的好习惯呀👍🏿\n\n如果你设置来双MM，启动以后binlog还会传到新主库的。\n\n但是如果你设置的是单向的，那就会不一致了…\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544357367,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1306125,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ee/0d/892eb1bb.jpg","nickname":"清凉薄荷糖","note":"","ucode":"CDEA8E4D55F3DE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":182498,"discussion_content":"这个问题应该要结合业务来处理，主库在等待binlog传输到从库的时间点挂了，应用端还没收到操作成功的通知，主从切换的话，这个操作在业务端应该认为是失败了，而此时新主库也没有对应数据，是合理的。原主库重新拉起应该认为的处理掉这个数据后再加入集群。","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1582429948,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45203,"user_name":"leon","can_delete":false,"product_type":"c1","uid":1141763,"ip_address":"","ucode":"E2479B1AC25B43","user_header":"https://static001.geekbang.org/account/avatar/00/11/6c/03/75c65e8f.jpg","comment_is_top":false,"comment_ctime":1543560496,"is_pvip":false,"replies":[{"id":"16141","content":"如果redolog是完整的，（包括了prepare和commit），就直接认为成功，不去判断binlog ","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543628930,"ip_address":"","comment_id":45203,"utype":1}],"discussion_count":3,"race_medal":0,"score":"70263037232","product_id":100020801,"comment_content":"老师，有个问题一直很困惑<br><br>两阶段提交为了保证binlog和redolog的一致性，<br>1 prepare阶段  2 写binlog  3 commit阶段<br>假如在3之前崩溃，恢复时，虽没有commit，但prepare和binlog完整，所以重启后会自动commit，以此来保证有binlog一致性。<br><br>既然能这样做，那为什么不把commit阶段去掉，恢复时，只要redolog和binlog完整就认为redolog有效，否则回滚呢？ 是因为效率还是其他的原因？","like_count":16,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430958,"discussion_content":"如果redolog是完整的，（包括了prepare和commit），就直接认为成功，不去判断binlog ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543628930,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1179919,"avatar":"https://static001.geekbang.org/account/avatar/00/12/01/0f/982315c0.jpg","nickname":"Json~X","note":"","ucode":"03C377813896D7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302039,"discussion_content":"那如果是这么说的话 二阶段相较于一阶段只是提高了崩溃恢复时的效率，因为不考虑效率的话，二阶段保证一致的方式一阶段完全适用，也就是一阶段(先写redo，再写bin)根本不存在不一致的问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598769226,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1054827,"avatar":"https://static001.geekbang.org/account/avatar/00/10/18/6b/a1448af1.jpg","nickname":"贝影","note":"","ucode":"19545C8DCBF8A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1179919,"avatar":"https://static001.geekbang.org/account/avatar/00/12/01/0f/982315c0.jpg","nickname":"Json~X","note":"","ucode":"03C377813896D7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542191,"discussion_content":"你这一阶段还不如没有redo","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640678038,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":302039,"ip_address":""},"score":542191,"extra":""}]}]},{"had_liked":false,"id":39618,"user_name":"子夜2104","can_delete":false,"product_type":"c1","uid":1070286,"ip_address":"","ucode":"C4FF54AEA6002F","user_header":"https://static001.geekbang.org/account/avatar/00/10/54/ce/92029d2f.jpg","comment_is_top":false,"comment_ctime":1542328908,"is_pvip":false,"replies":[{"id":"14221","content":"好习惯：）","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542340798,"ip_address":"","comment_id":39618,"utype":1}],"discussion_count":1,"race_medal":0,"score":"65966838348","product_id":100020801,"comment_content":"记笔记:<br>redo  log 记录 做了什么改动（比如把某个字段从0改成了1）<br><br>binlog 记录 是怎么修改的（记录sql语句或者 记录更新前后的行）","like_count":15,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429143,"discussion_content":"好习惯：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542340798,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39547,"user_name":"橡皮泥boy","can_delete":false,"product_type":"c1","uid":1011863,"ip_address":"","ucode":"478F5417EDD249","user_header":"https://static001.geekbang.org/account/avatar/00/0f/70/97/e5bf9ddb.jpg","comment_is_top":false,"comment_ctime":1542299926,"is_pvip":true,"discussion_count":2,"race_medal":0,"score":"61671842070","product_id":100020801,"comment_content":"【回答问题】<br>备份数据库的周期直接影响到了恢复的速度，一天一备的话，恢复时只需要重新执行最近一天的数据库修改操作。而一周一备则需要做很多。所以在对于系统恢复速度很敏感的系统，最好使用一天一备，甚至一小时一备等等。","like_count":14,"discussions":[{"author":{"id":1911661,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLDOKcx20Xxmu5j8WxiafoYvo3bIAFDg8OeicRic1icD597QuMC9O8FyV2Al9RxNfVZXK0gkGUx6M3CVQ/132","nickname":"多年以后","note":"","ucode":"D70E7A1ABE0F39","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550435,"discussion_content":"我都是一天全备一次，每小时增量备份一次","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644545153,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1682672,"avatar":"https://static001.geekbang.org/account/avatar/00/19/ac/f0/78ee760d.jpg","nickname":"Harvey","note":"","ucode":"AB529F37D31335","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":29129,"discussion_content":"恢复时候，更快速；另一方面，需要整库备份的额外存储要求的最小粒度也是不同的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570730395,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":73554,"user_name":"李二木","can_delete":false,"product_type":"c1","uid":1103091,"ip_address":"","ucode":"30E03BB84ADB27","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/f3/129d6dfe.jpg","comment_is_top":false,"comment_ctime":1551923993,"is_pvip":true,"replies":[{"id":"28011","content":"1. 如果你的语句是where type=&#39;xiaomi&#39;, 是肯定会的<br>2. 所有的查数据都是从内存读的，只是说如果还没在内存里，要从磁盘读<br>3. 没有<br>4. 会的，就是crash recovery过程","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1552726293,"ip_address":"","comment_id":73554,"utype":1}],"discussion_count":3,"race_medal":0,"score":"53091531545","product_id":100020801,"comment_content":"对于数据页在内存中我有个疑问(InnoDB)。<br>1假如我要更新type=&#39;xiaomi&#39;(可能有有100W条)数据。那么这些数据是否都要加载到内存中吗？<br>2 假如我要查询 type=&#39;xiaomai&#39; and location=&#39;beijing&#39;,那么这条数据获取时候从内存中获取的吗？<br>3 更新数据条数是不是有一个上线？<br>4 是不是每次启动mysql它都会检查一次先前有没有异常未提交成功的事务呢？<br><br>","like_count":12,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442152,"discussion_content":"1. 如果你的语句是where type=&amp;#39;xiaomi&amp;#39;, 是肯定会的\n2. 所有的查数据都是从内存读的，只是说如果还没在内存里，要从磁盘读\n3. 没有\n4. 会的，就是crash recovery过程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552726293,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2351720,"avatar":"https://static001.geekbang.org/account/avatar/00/23/e2/68/ce547a12.jpg","nickname":"zjm1314","note":"","ucode":"63B0EAB7045054","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339676,"discussion_content":"那假如表里放了1000亿条数据，然后要全表更新，就要把所有数据加载到内存里，但是如果内存不够，此时mysql就崩了？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609755265,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1886331,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/c8/7b/153181d7.jpg","nickname":"夜辉","note":"","ucode":"9421385F51FF9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2351720,"avatar":"https://static001.geekbang.org/account/avatar/00/23/e2/68/ce547a12.jpg","nickname":"zjm1314","note":"","ucode":"63B0EAB7045054","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377350,"discussion_content":"按照页的大小，从磁盘依次加载至内存","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622611683,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":339676,"ip_address":""},"score":377350,"extra":""}]}]},{"had_liked":false,"id":39863,"user_name":"高强","can_delete":false,"product_type":"c1","uid":1312433,"ip_address":"","ucode":"AA3C76FDD4BC61","user_header":"https://static001.geekbang.org/account/avatar/00/14/06/b1/ba6b4335.jpg","comment_is_top":false,"comment_ctime":1542370272,"is_pvip":false,"replies":[{"id":"14325","content":"不是，这个跟手动还是自动无关。你说的commit是一个命令，“提交这个事务”，包含了整个提交过程（也就是说两次redolog和一次binlog操作，都是在你的这个commit **命令**中做的）","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542377966,"ip_address":"","comment_id":39863,"utype":1}],"discussion_count":2,"race_medal":0,"score":"53081977824","product_id":100020801,"comment_content":"两阶段提交是针对自动提交事务的语句来说的吗？<br>如果是手动提交事务呢？<br>执行更新语句，只更新当前session缓存。当手动commit的时候，才是  记录redo log  处于prepare状态，执行器执行，记录binlog，然后 redlog commit<br>是这样吗<br><br>-------<br>如果用户手动commit，但是第三步redlog变成  commit的时候挂掉，这时候用户收到的执行结果是什么?---这时候恢复的时候是认可这次commit的","like_count":12,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429262,"discussion_content":"不是，这个跟手动还是自动无关。你说的commit是一个命令，“提交这个事务”，包含了整个提交过程（也就是说两次redolog和一次binlog操作，都是在你的这个commit **命令**中做的）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542377966,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1254801,"avatar":"https://static001.geekbang.org/account/avatar/00/13/25/91/46600294.jpg","nickname":"猴哥一一 cium","note":"","ucode":"38EC64F8D1A0B4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311834,"discussion_content":"不错,mark!","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602498676,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44751,"user_name":"Geek_c991e0","can_delete":false,"product_type":"c1","uid":1206623,"ip_address":"","ucode":"5B6391E2D69D50","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epLLXBLBLgticobxvBYRezd304Y66Q8ibYCl7mG9dvTHGrx9obRcn7ZmJBcib3ibsQPIX3xIbNYiaAUrOA/132","comment_is_top":false,"comment_ctime":1543486450,"is_pvip":false,"replies":[{"id":"16161","content":"是的，这就trx_commit没设置成1的后果…","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543630858,"ip_address":"","comment_id":44751,"utype":1}],"discussion_count":4,"race_medal":0,"score":"48788126706","product_id":100020801,"comment_content":"老师好，问个问题，如果两种log都写完成了，但是redolog没有写磁盘，物理机挂了，redolog在内存中就丢失了吧，再启动跟磁盘中的binlog就不一致，后期恢复数据的时候会有问题吧","like_count":11,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430827,"discussion_content":"是的，这就trx_commit没设置成1的后果…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543630858,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2166073,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","nickname":"戒酒的李白","note":"","ucode":"744E1A22761647","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":392759,"discussion_content":"双一配置很重要","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631112475,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2351720,"avatar":"https://static001.geekbang.org/account/avatar/00/23/e2/68/ce547a12.jpg","nickname":"zjm1314","note":"","ucode":"63B0EAB7045054","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339690,"discussion_content":"log写完成是log写到了对应的磁盘文件里，然后宕机侯内存里的数据没了，最后的数据还没有写到磁盘的表里，这种情况怎么处理呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609758360,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1226968,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b8/d8/f81b5604.jpg","nickname":"hcyycb","note":"","ucode":"77FF6CA41F9E66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":2351720,"avatar":"https://static001.geekbang.org/account/avatar/00/23/e2/68/ce547a12.jpg","nickname":"zjm1314","note":"","ucode":"63B0EAB7045054","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":410384,"discussion_content":"log都持久化了，所以重启之后，就从log里恢复数据哦。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635683079,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":339690,"ip_address":""},"score":410384,"extra":""}]}]},{"had_liked":false,"id":39582,"user_name":"高枕","can_delete":false,"product_type":"c1","uid":1310312,"ip_address":"","ucode":"20F6CF75EC9AA4","user_header":"https://static001.geekbang.org/account/avatar/00/13/fe/68/e0bebd9a.jpg","comment_is_top":false,"comment_ctime":1542326628,"is_pvip":false,"replies":[{"id":"14240","content":"很好的思考，你考虑一下这个场景，redolog没写，binlog写好了，怎么算。 注意由于binlog写完了，在备份恢复回来以后是会重放这个事务的。 ","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542342878,"ip_address":"","comment_id":39582,"utype":1}],"discussion_count":9,"race_medal":0,"score":"48786966884","product_id":100020801,"comment_content":"老师 与思雨有同样疑惑<br>也就是说状态恢复的过程会去同时检查redo log和binlog？不然怎么能确定一个prepare的redo log已经写好了binlog，因为不检查的话不能确定到底是写好了binlog之后奔溃的还是写之前奔溃的，也就不能确定这个prepare log的合法性。如果检查的话那么不用两阶段提交好像也没什么问题，无论先写哪个日志都可以","like_count":11,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429126,"discussion_content":"很好的思考，你考虑一下这个场景，redolog没写，binlog写好了，怎么算。 注意由于binlog写完了，在备份恢复回来以后是会重放这个事务的。 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542342878,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1159645,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b1/dd/c814190f.jpg","nickname":"巴子小","note":"","ucode":"1C3D35AEC235BB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":556229,"discussion_content":"那就先写redo，再binlog","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1647256467,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":429126,"ip_address":""},"score":556229,"extra":""}]},{"author":{"id":2612075,"avatar":"","nickname":"Geek_da2941","note":"","ucode":"B46B6BCC7C77CB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372499,"discussion_content":"重放这个事务会有什么问题吗。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620356200,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1159645,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b1/dd/c814190f.jpg","nickname":"巴子小","note":"","ucode":"1C3D35AEC235BB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2612075,"avatar":"","nickname":"Geek_da2941","note":"","ucode":"B46B6BCC7C77CB","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556226,"discussion_content":"数据备份重放binlog，但是本库的redo没有，数据不一致","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647256312,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":372499,"ip_address":""},"score":556226,"extra":""}]},{"author":{"id":1309759,"avatar":"https://static001.geekbang.org/account/avatar/00/13/fc/3f/7e95156a.jpg","nickname":"啊勇","note":"","ucode":"CB403DD04F920A","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":50915,"discussion_content":"同样的疑问？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573786004,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1494921,"avatar":"https://static001.geekbang.org/account/avatar/00/16/cf/89/3796d969.jpg","nickname":"懒羊羊","note":"","ucode":"D0FF5CCC60874A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":12539,"discussion_content":"不都是先写redo log的吗 怎么会存在binlog写了，redolog没写？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568543278,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1486549,"avatar":"https://static001.geekbang.org/account/avatar/00/16/ae/d5/abe7078a.jpg","nickname":"hu big sea","note":"","ucode":"489F9B4BF819FF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1494921,"avatar":"https://static001.geekbang.org/account/avatar/00/16/cf/89/3796d969.jpg","nickname":"懒羊羊","note":"","ucode":"D0FF5CCC60874A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302582,"discussion_content":"redo log 空间有限，可能被刷了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598965685,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":12539,"ip_address":""},"score":302582,"extra":""},{"author":{"id":1314724,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0f/a4/0b49469f.jpg","nickname":"木子00","note":"","ucode":"8F78CA722EB29B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1486549,"avatar":"https://static001.geekbang.org/account/avatar/00/16/ae/d5/abe7078a.jpg","nickname":"hu big sea","note":"","ucode":"489F9B4BF819FF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":304469,"discussion_content":"redolo 是循环写的怎么会，写不上呢。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599576722,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":302582,"ip_address":""},"score":304469,"extra":""},{"author":{"id":1159645,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b1/dd/c814190f.jpg","nickname":"巴子小","note":"","ucode":"1C3D35AEC235BB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1486549,"avatar":"https://static001.geekbang.org/account/avatar/00/16/ae/d5/abe7078a.jpg","nickname":"hu big sea","note":"","ucode":"489F9B4BF819FF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556227,"discussion_content":"被刷之前会保证数据变更被写到磁盘了，这样数据还是一致的，没有问题吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647256413,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":302582,"ip_address":""},"score":556227,"extra":""}]}]},{"had_liked":false,"id":76998,"user_name":"CK","can_delete":false,"product_type":"c1","uid":1308981,"ip_address":"","ucode":"F6EA575C429F1E","user_header":"https://static001.geekbang.org/account/avatar/00/13/f9/35/2abe5e56.jpg","comment_is_top":false,"comment_ctime":1552799368,"is_pvip":false,"replies":[{"id":"28816","content":"prepare写日志的最后一个512字节，会在commit的时候被改掉","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1553344832,"ip_address":"","comment_id":76998,"utype":1}],"discussion_count":2,"race_medal":0,"score":"44502472328","product_id":100020801,"comment_content":"hello，丁奇老师，在redo log commit的时候，想我一下，是追加写呢，还是找到prepare的地方进行修改呢","like_count":10,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443535,"discussion_content":"prepare写日志的最后一个512字节，会在commit的时候被改掉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553344832,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2166073,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","nickname":"戒酒的李白","note":"","ucode":"744E1A22761647","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":392762,"discussion_content":"那就是还是需要找到redolog的最后512字节，给改成commit状态。 也会有一个离散写入的过程，但是由于redolog有大小限制， 而且有固定的格式，查找起来会比binlog中查找快很多。 不知道我理解的对不对","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631112666,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":92453,"user_name":"张三丰","can_delete":false,"product_type":"c1","uid":1155275,"ip_address":"","ucode":"3A6215A40B3B21","user_header":"https://static001.geekbang.org/account/avatar/00/11/a0/cb/aab3b3e7.jpg","comment_is_top":false,"comment_ctime":1557276940,"is_pvip":false,"replies":[{"id":"34316","content":"那样不算丢失，因为并没有告诉用户“成功”","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1558261408,"ip_address":"","comment_id":92453,"utype":1}],"discussion_count":1,"race_medal":0,"score":"40211982604","product_id":100020801,"comment_content":"如果在写入redo log之前就异常重启了，数据还是会丢失的","like_count":9,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":449265,"discussion_content":"那样不算丢失，因为并没有告诉用户“成功”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558261408,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42332,"user_name":"酷飞不会飞","can_delete":false,"product_type":"c1","uid":1004609,"ip_address":"","ucode":"ECFD5111260A7D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/41/3d352f74.jpg","comment_is_top":false,"comment_ctime":1542940872,"is_pvip":true,"replies":[{"id":"15134","content":"是的，所以1. 要设置大一点的innodb redolog的大小 2. 用好点的磁盘😄","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542941129,"ip_address":"","comment_id":42332,"utype":1}],"discussion_count":1,"race_medal":0,"score":"40197646536","product_id":100020801,"comment_content":"有个问题请教老师，既然write pos和checkout都是往后推移并循环的，而且当write pos赶上checkout的时候要停下来，将checkout往后推进，是不是意味着，后续的更新请求都会等待，等checkout往后推到一定空间后，再继续执行。如果上述成立的话，在大量的更新或插入操作的时候，write pos可能会很快的追上checkout，从而再次产生等待的过程，这个是不是一个在性能上产生瓶颈。","like_count":9,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430053,"discussion_content":"是的，所以1. 要设置大一点的innodb redolog的大小 2. 用好点的磁盘😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542941129,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39770,"user_name":"有铭","can_delete":false,"product_type":"c1","uid":1046302,"ip_address":"","ucode":"2C7CB36CA5C04C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/3XbCueYYVWTiclv8T5tFpwiblOxLphvSZxL4ujMdqVMibZnOiaFK2C5nKRGv407iaAsrI0CDICYVQJtiaITzkjfjbvrQ/132","comment_is_top":false,"comment_ctime":1542352669,"is_pvip":false,"replies":[{"id":"14274","content":"确实没写到数据上，但是不影响查询正确性，因为写了内存，下次查询是从内存里面读的。 <br><br>内存可能会被淘汰，又会触发相应的写盘操作。<br>这个在第十讲中会提到。<br><br>确实一篇文章没里办法全部展开，继续关注后面的文章哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542354800,"ip_address":"","comment_id":39770,"utype":1}],"discussion_count":1,"race_medal":0,"score":"40197058333","product_id":100020801,"comment_content":"我觉得有些问题文中没有说的很清楚：<br>*. 文中说有可能先写在黑板上，暂时不会写到账本，是指的redo log本身，还是数据？如果是数据的话，那就有个新问题了，你update后数据不在硬盘上，此时select得到的数据不就是旧数据吗？<br>*. 从理论上讲，可不可以认为InnoDB引擎的事务特性完全是由redo log日志完成的？","like_count":9,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429220,"discussion_content":"确实没写到数据上，但是不影响查询正确性，因为写了内存，下次查询是从内存里面读的。 \n\n内存可能会被淘汰，又会触发相应的写盘操作。\n这个在第十讲中会提到。\n\n确实一篇文章没里办法全部展开，继续关注后面的文章哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542354800,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39560,"user_name":"T^T","can_delete":false,"product_type":"c1","uid":1119467,"ip_address":"","ucode":"FE31BA42B9D8C2","user_header":"https://static001.geekbang.org/account/avatar/00/11/14/eb/d2d9678c.jpg","comment_is_top":false,"comment_ctime":1542310199,"is_pvip":false,"replies":[{"id":"14255","content":"额，我主要怕有占篇幅之嫌… binlog的我加到答疑篇，redo的… 对于非数据库内核开发人员是不可读的数据， 基本大家用不到","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542345866,"ip_address":"","comment_id":39560,"utype":1}],"discussion_count":1,"race_medal":0,"score":"40197015863","product_id":100020801,"comment_content":"老师可以把redo log和binlog日志贴一点点吗？有助于直观感受","like_count":9,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429114,"discussion_content":"额，我主要怕有占篇幅之嫌… binlog的我加到答疑篇，redo的… 对于非数据库内核开发人员是不可读的数据， 基本大家用不到","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542345866,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":154994,"user_name":"James","can_delete":false,"product_type":"c1","uid":1134861,"ip_address":"","ucode":"48B0F2A334D1C1","user_header":"https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg","comment_is_top":false,"comment_ctime":1574612232,"is_pvip":false,"replies":[{"id":"59520","content":"如果是redolog恢复，不用额外处理，正常的使用中，模拟一个崩溃恢复，比如kill -9 这个mysqld进程，重启的时候，会自己做恢复；<br><br>如果是说binlog，你可以搜索一下 “mysql 恢复到指定时间点”","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1574651755,"ip_address":"","comment_id":154994,"utype":1}],"discussion_count":2,"race_medal":0,"score":"35934350600","product_id":100020801,"comment_content":"百度那么久,都没找到如何使用这些日志恢复..[不是从事db&#47;&#47;&#47;]","like_count":8,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475630,"discussion_content":"如果是redolog恢复，不用额外处理，正常的使用中，模拟一个崩溃恢复，比如kill -9 这个mysqld进程，重启的时候，会自己做恢复；\n\n如果是说binlog，你可以搜索一下 “mysql 恢复到指定时间点”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574651755,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1134861,"avatar":"https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg","nickname":"James","note":"","ucode":"48B0F2A334D1C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":58093,"discussion_content":"好的。多谢。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574651816,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104933,"user_name":"Yuan","can_delete":false,"product_type":"c1","uid":1565574,"ip_address":"","ucode":"2013046696EA5F","user_header":"https://static001.geekbang.org/account/avatar/00/17/e3/86/bd86172e.jpg","comment_is_top":false,"comment_ctime":1560873650,"is_pvip":false,"replies":[{"id":"38149","content":"没设计好 ^_^","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1560998245,"ip_address":"","comment_id":104933,"utype":1}],"discussion_count":3,"race_medal":0,"score":"35920612018","product_id":100020801,"comment_content":"为什么更新的时候要把所有的查询缓存清空呢，只删掉更新的那些不行吗","like_count":8,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454489,"discussion_content":"没设计好 ^_^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560998245,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1064247,"avatar":"https://static001.geekbang.org/account/avatar/00/10/3d/37/bbe5f958.jpg","nickname":"王晨","note":"","ucode":"942D9BD67A3418","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367876,"discussion_content":"真实在。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618489887,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1342647,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEIMXEAN5E36GHAVguQnbNOIicT0IXDk1aYw4l0crtMIRibyBdAicyJo8u1Bqol8qbQso4J0CRd4y4YdA/132","nickname":"Geek_2e8900","note":"","ucode":"ABB7B4977AC7CD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":125878,"discussion_content":"😂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578494780,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58115,"user_name":"jzyu","can_delete":false,"product_type":"c1","uid":1344904,"ip_address":"","ucode":"177A41ACF27316","user_header":"https://static001.geekbang.org/account/avatar/00/14/85/88/9b2973fc.jpg","comment_is_top":false,"comment_ctime":1546998884,"is_pvip":false,"replies":[{"id":"21126","content":"不用回滚日志，只需要打上“rollback”标签","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547119246,"ip_address":"","comment_id":58115,"utype":1}],"discussion_count":4,"race_medal":0,"score":"35906737252","product_id":100020801,"comment_content":"关于两阶段提交有个问题想请教一下。写redo log处于prepare阶段后，如果写binlog失败是会回滚redo log的记录吗？","like_count":8,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435913,"discussion_content":"不用回滚日志，只需要打上“rollback”标签","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547119246,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2166073,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","nickname":"戒酒的李白","note":"","ucode":"744E1A22761647","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":392769,"discussion_content":"redolog最后胡512字节改成rollback","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1631113244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1911661,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLDOKcx20Xxmu5j8WxiafoYvo3bIAFDg8OeicRic1icD597QuMC9O8FyV2Al9RxNfVZXK0gkGUx6M3CVQ/132","nickname":"多年以后","note":"","ucode":"D70E7A1ABE0F39","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550451,"discussion_content":"那这个时候内存里面是怎么处理的，是把这个数据页里面的数据再改回去，还是直接清掉？因为他也被修改了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644548527,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549793,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644242847,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39722,"user_name":"杨智晓 ✟","can_delete":false,"product_type":"c1","uid":1024263,"ip_address":"","ucode":"E3B56F4A38F63D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a1/07/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1542341857,"is_pvip":false,"replies":[{"id":"14246","content":"嗯嗯，WAL 是数据库的通用设计思路：）","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542343296,"ip_address":"","comment_id":39722,"utype":1}],"discussion_count":4,"race_medal":0,"score":"35902080225","product_id":100020801,"comment_content":"Redis还有HBASE的思路好像也是用redo log的方式，先写log，然后写入内存，最后再根据log把数据更新到磁盘","like_count":8,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429195,"discussion_content":"嗯嗯，WAL 是数据库的通用设计思路：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542343296,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1886331,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/c8/7b/153181d7.jpg","nickname":"夜辉","note":"","ucode":"9421385F51FF9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377353,"discussion_content":"Redis为提高性能，增加吞吐量，先写内存，再写日志，不能完全保证数据的持久化","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622612006,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1011395,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/6e/c3/c72155b5.jpg","nickname":"无敌悠爸©","note":"","ucode":"734B1DEC62B897","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":325148,"discussion_content":"Redis的AOF是写后日志","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605245400,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1044546,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/42/7728d4f5.jpg","nickname":"艿艿","note":"","ucode":"8F727AB7A7F6B2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":25644,"discussion_content":"Redis 是先更新内存，在 AOF 记录日志。\n这点和 HBASE 等不同。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570544285,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":95022,"user_name":"张三丰","can_delete":false,"product_type":"c1","uid":1155275,"ip_address":"","ucode":"3A6215A40B3B21","user_header":"https://static001.geekbang.org/account/avatar/00/11/a0/cb/aab3b3e7.jpg","comment_is_top":false,"comment_ctime":1557941343,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"31622712415","product_id":100020801,"comment_content":"请教老师两个问题，<br>1.“需要恢复到指定的某一秒时，比如某天下午两点发现中午十二点有一次误删表，需要找回数据，那你可以这么做：<br><br>首先，找到最近的一次全量备份，如果你运气好，可能就是昨天晚上的一个备份，从这个备份恢复到临时库；<br>然后，从备份的时间点开始，将备份的 binlog 依次取出来，重放到中午误删表之前的那个时刻。”<br>假如是2019-6-1 12点误删，2019-5-31做了全量备份，文中说“从备份的时间点开始，将备份的binlog依次取出来”，也就是说取得就是昨天的binlog，那么昨天的binlog怎么会有今天12点的数据？<br><br><br>2.为什么说binlog没有cash safe能力，而redo log有， binlog既然能备份，能恢复，为什么就不具备cash safe能力呢？ 做主从的时候，从库也是通过binlog同步和主库一样的数据的，也就说明binlog保留了完整的数据。<br>","like_count":7,"discussions":[{"author":{"id":1304762,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e8/ba/a6976395.jpg","nickname":"Stev","note":"","ucode":"AC16C3BF6D0E66","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":221876,"discussion_content":"第1个问题,由于只有1天的时间,bin log还一直在磁盘上,没有被删除,可以直接用. 老师说&#34;备份的binlog&#34;其实是没有&#34;备份&#34;这个动作的.  如果是隔了几天,binlog会被&#34;备份&#34;,然后删除,就需要去找备份了的binlog了,但是最后一天的binlog还在磁盘上,直接用就可以了.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586074063,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1690807,"avatar":"https://static001.geekbang.org/account/avatar/00/19/cc/b7/af6ef83d.jpg","nickname":"抢小孩子糖吃","note":"","ucode":"09F302FC76582A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":51623,"discussion_content":"个人观点   \n我觉得备份应该是备份了数据库的其他数据  没有备份日志\n  误删时也是误删了数据库其他数据 没有误删日志  所以binlog有数据库到现在的记录  甚至你误删的操作里面也记录在里面","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573910463,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78405,"user_name":"Geek_961eed","can_delete":false,"product_type":"c1","uid":1444566,"ip_address":"","ucode":"A62198D96379F5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erWxMXolPylQk8Z6V6yt2LtibksrksC4bHtmxkuCC4Wzw7trl6CfwmsSFMyHFItFnvl21RvQ8fyOBQ/132","comment_is_top":false,"comment_ctime":1553141267,"is_pvip":false,"replies":[{"id":"28911","content":"我觉得最重要的好处，是可以避免新建、删除文件带来的抖动，好问题。","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1553416862,"ip_address":"","comment_id":78405,"utype":1}],"discussion_count":2,"race_medal":0,"score":"31617912339","product_id":100020801,"comment_content":"想问下老师，redo log为什么要设计成环形的？环形缓冲区的设计又有什么好处？","like_count":7,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444081,"discussion_content":"我觉得最重要的好处，是可以避免新建、删除文件带来的抖动，好问题。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553416862,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2933325,"avatar":"","nickname":"阿童挺挺","note":"","ucode":"821F0ADB38335C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":564282,"discussion_content":"mark\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650205682,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68260,"user_name":"tooonly","can_delete":false,"product_type":"c1","uid":1112982,"ip_address":"","ucode":"3AA800BD45A85B","user_header":"https://static001.geekbang.org/account/avatar/00/10/fb/96/d2777aa7.jpg","comment_is_top":false,"comment_ctime":1550471314,"is_pvip":false,"replies":[{"id":"24405","content":"&quot;但是如果业务系统请求认为数据库异常，所以业务系统认为此次处理未生效，&quot; <br>不应该这么认为，如果业务系统这么认为，那属于业务系统的bug。。<br>正常应该是等重连成功以后再查一次，去确认事务状态","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1550583181,"ip_address":"","comment_id":68260,"utype":1}],"discussion_count":2,"race_medal":0,"score":"31615242386","product_id":100020801,"comment_content":"老师你好，看完你的这篇文章，我有一个疑惑，希望能够予以解答，1、写入redo log，处于prepare状态，2、写binlog，3、redo log commit;<br>如果在第2步执行完了之后，MySQL进程异常，恢复数据库后，会认为该条记录redo log处于prepare但binlog完整，所以该条记录自动提交且有效，但是如果业务系统请求认为数据库异常，所以业务系统认为此次处理未生效，告知其他业务系统，那么其他业务系统再次提交请求，是不是就造成了重复提交的问题，在平时业务系统应该怎么处理这类情况。","like_count":7,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439593,"discussion_content":"&amp;quot;但是如果业务系统请求认为数据库异常，所以业务系统认为此次处理未生效，&amp;quot; \n不应该这么认为，如果业务系统这么认为，那属于业务系统的bug。。\n正常应该是等重连成功以后再查一次，去确认事务状态","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550583181,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2351720,"avatar":"https://static001.geekbang.org/account/avatar/00/23/e2/68/ce547a12.jpg","nickname":"zjm1314","note":"","ucode":"63B0EAB7045054","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339700,"discussion_content":"是的，这种情况要不就是代码里加重试机制，或者直接终端监控告警人工干预","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609759405,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":41365,"user_name":"斜面镜子 Bill","can_delete":false,"product_type":"c1","uid":1305242,"ip_address":"","ucode":"B5505F94540D52","user_header":"https://static001.geekbang.org/account/avatar/00/13/ea/9a/02d589f9.jpg","comment_is_top":false,"comment_ctime":1542769545,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"31607540617","product_id":100020801,"comment_content":"备份时间周期的长短，理解需要考虑<br>1.业务实际的数据存量，如果大到一天没有办法备份完成，只能一周一次，甚至更长<br>2.业务数据的增量，如果增量非常大，如果一周备份一次，增量备份的考验会比较大，极大的概率会出现增量备份失败问题，另外恢复时长和成功率也比较困难<br>3.业务比较重要并且对恢复时间的忍受程度低，并且历史上多次出现类似数据回滚的需求，而且增量还不小优先一天一备份，相反业务实际不重要，出问题后可以容忍一定的不可用，而且增量还不多，出于成本考虑可以用一周一备份备份<br>4.文件的恢复效率很高的话，大多业务增量一周的恢复时长还是可以保证的，这时候就是提供SLA让业务决策了<br><br>综合数据存量、增量、备份成本、恢复效率、业务SLA选择，我理解就有答案了！","like_count":7},{"had_liked":false,"id":39638,"user_name":"沙亮亮","can_delete":false,"product_type":"c1","uid":1099492,"ip_address":"","ucode":"E6CF0D5B1E6691","user_header":"https://static001.geekbang.org/account/avatar/00/10/c6/e4/ec572f55.jpg","comment_is_top":false,"comment_ctime":1542330193,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"31607101265","product_id":100020801,"comment_content":"redo_log恢复是以什么状态为依据，是prepare，还是commit","like_count":7,"discussions":[{"author":{"id":1009329,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/b1/791d0f5e.jpg","nickname":"公号-生活点亮技术","note":"","ucode":"F807829A146624","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":361666,"discussion_content":"有一个txId，如果已经prepare，使用这个txId查binlog，如果查到，则说明成功了，则commit；如果没有查到，则rollback","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616724939,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1690807,"avatar":"https://static001.geekbang.org/account/avatar/00/19/cc/b7/af6ef83d.jpg","nickname":"抢小孩子糖吃","note":"","ucode":"09F302FC76582A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":51620,"discussion_content":"个人理解 是按commit为依据的  但如果有prepare没有commit 但binlog里有 应该会按prepare的来","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573909499,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1682672,"avatar":"https://static001.geekbang.org/account/avatar/00/19/ac/f0/78ee760d.jpg","nickname":"Harvey","note":"","ucode":"AB529F37D31335","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":29131,"discussion_content":"崩溃恢复 是要求redo log是commit状态，一定是最新状态\n副本恢复 是通过整库备份镜像+bin log 记录 实现的，通常，还需要业务对访问日志等进行重放，以最大限度恢复到现网状态","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570730823,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1886331,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/c8/7b/153181d7.jpg","nickname":"夜辉","note":"","ucode":"9421385F51FF9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1682672,"avatar":"https://static001.geekbang.org/account/avatar/00/19/ac/f0/78ee760d.jpg","nickname":"Harvey","note":"","ucode":"AB529F37D31335","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377352,"discussion_content":"正常提交以commit标志为准\ncrash recovery还可以以prepare结合完整binlog\nbinlog用于主从同步，和异构数据同步","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622611816,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":29131,"ip_address":""},"score":377352,"extra":""}]}]},{"had_liked":false,"id":155426,"user_name":"James","can_delete":false,"product_type":"c1","uid":1134861,"ip_address":"","ucode":"48B0F2A334D1C1","user_header":"https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg","comment_is_top":false,"comment_ctime":1574688181,"is_pvip":false,"replies":[{"id":"59707","content":"对的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1574733646,"ip_address":"","comment_id":155426,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27344491957","product_id":100020801,"comment_content":"暂时使用window实现binlog恢复.<br><br>--查看是否有开启binlog<br>show global variables like &#39;log_bin&#39;; <br>--没有开启,配置开启<br>--C:\\ProgramData\\MySQL\\MySQL Server 5.7 my.ini配置<br>--Binary Logging.<br>log-bin=mysql-bin<br>binlog-format=Row<br>--重启启动mysql,查看binlog内容<br>show binlog events in &#39;mysql-bin.000001&#39;;<br>--时间点 2019-11-25 21:10:00<br>--创建redolog表<br>--插入数据 1 2 3 4 5 <br>--时间点 2019-11-25 21:11:00 全量备份<br>--时间点 2019-11-25 21:12:00<br>--创建redolog2表<br>--时间点 2019-11-25 21:14:00<br>--删除redolog表,redolog2表<br>--使用全量备份<br>--在C:\\Program Files\\MySQL\\MySQL Server 5.7\\bin进行增量备份<br>-- .\\mysqlbinlog --start-datetime=&#39;2019-11-25 21:12:00&#39; --stop-datetime=&#39;2019-11-25 21:14:00&#39;  &#39;C:\\ProgramData\\MySQL\\MySQL Server 5.7\\Data\\mysql-bin.000001&#39; &gt; 1.sql<br>--执行1.sql,恢复redolog2表","like_count":6,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475749,"discussion_content":"对的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574733646,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127433,"user_name":"明翼","can_delete":false,"product_type":"c1","uid":1068361,"ip_address":"","ucode":"E77F86BEB3D5C1","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","comment_is_top":false,"comment_ctime":1566708974,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"27336512750","product_id":100020801,"comment_content":"我觉得这一篇太重要了，redolog和binlog的关系非常重要：<br>区别如下：<br>1） redolog 是InnoDB存储引擎特有的；binlog是server带有的，所有的引擎都支持。<br>2）redolog的目的是为了crash safe，同时还有提升性能的作用，因为通过WAL，写内存的时候直接写日志，比直接写到到磁盘要快，就算mysql挂了，可以通过redolog来得到最新的数据信息，记录的是临时数据。<br>   binlog的日志主要是归档用的，记录的是逻辑SQL信息，主要是数据库恢复用的，用数据库的全量备份+binlog日志可以恢复数据，不过我觉得应该也要重放下redo日志，才可以达到数据完整恢复吧。<br><br>3）redo日志是记录的物理页的变更信息，而binlog是记录SQL语句信息，属于逻辑信息范畴。","like_count":6,"discussions":[{"author":{"id":1100928,"avatar":"https://static001.geekbang.org/account/avatar/00/10/cc/80/898c1ed1.jpg","nickname":"sea季陪我去看海","note":"","ucode":"D0CA20E815A157","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552159,"discussion_content":"写redolog也是写磁盘操作，只是说如果更新直接更新磁盘，要比写redolog之后最后统一写磁盘代价低？所以才认为效率高吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645331136,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2300245,"avatar":"","nickname":"Geek_223eb3","note":"","ucode":"3DF5E1BFF35C37","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":323850,"discussion_content":"张三丰，我现在跟你有一样的疑问，请问现在你明白了吗，请教一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605009332,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":94729,"user_name":"ly","can_delete":false,"product_type":"c1","uid":1221628,"ip_address":"","ucode":"5E2B85252DABF3","user_header":"https://static001.geekbang.org/account/avatar/00/12/a3/fc/379387a4.jpg","comment_is_top":false,"comment_ctime":1557886204,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"27327689980","product_id":100020801,"comment_content":"【客户端sql语句】<br>begin;<br>update t set t.name = &#39;tom&#39; where t.id = 1;<br>commit;<br>【mysql端】<br>1. update语句发往mysql后，用id取数据，更新数据到内存，innoDB引擎写redo log设置为prepare状态--等待事务提交。<br>2. commit语句发往mysql后，开始写binlog到磁盘，然后innoDB引擎将redo log设置为commit状态。<br>关于commit的疑问点：<br>当binlog写磁盘失败，那肯定客户端也会收到失败的响应，事务不会提交。<br>当binlog写磁盘成功，但是redo log的commit失败，此时客户端的响应是成功还是失败呢？我想应该是成功的，因为binlog写磁盘成功代表以后是可以还原这次update的。<br><br>另外对数据恢复的理解-不知道对不对：<br>1. 当不存在binlog，只存在redo log（prepare状态）的时候，不恢复此数据。<br>2. 当存在binlog，存在redo log（prepare状态）的时候，允许恢复数据。<br>3. 只要存在redo log（commit状态）的时候，允许恢复数据。<br><br>以上是我的理解，请老师帮忙点评下。本节内容我基本上看了5遍以上才提出的问题，有点笨。望老师理解！","like_count":6,"discussions":[{"author":{"id":1171004,"avatar":"https://static001.geekbang.org/account/avatar/00/11/de/3c/96c1bc62.jpg","nickname":"卢建文","note":"","ucode":"900A0CE253F2BF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373833,"discussion_content":"有个问题，如果我有多个update语句，是不是要多次设置redo log 为 prepare 状态呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620889942,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2166073,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","nickname":"戒酒的李白","note":"","ucode":"744E1A22761647","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1171004,"avatar":"https://static001.geekbang.org/account/avatar/00/11/de/3c/96c1bc62.jpg","nickname":"卢建文","note":"","ucode":"900A0CE253F2BF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":392758,"discussion_content":"我理解这个是以事务为粒度的， 如果这多个update语句处于多个事务中（比如事务是自动提交的），那就会有多个redolog处于prepare状态；如果这几个update语句是处于同一个事务中， 那只会有一个redolog(记录了这几个update的变动)处于prepare阶段。 同时， redolog和binlog也是通过事务id进行关联的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631112411,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":373833,"ip_address":""},"score":392758,"extra":""}]},{"author":{"id":1983670,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/44/b6/5979439e.jpg","nickname":"小牛刀","note":"","ucode":"487F63F5FBC03A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":251525,"discussion_content":"当不开启binlog，也就是不存在二阶段提交了，要么commit要么rollback","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588087286,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1442605,"avatar":"https://static001.geekbang.org/account/avatar/00/16/03/2d/404627dc.jpg","nickname":"Anryg Zhun","note":"","ucode":"76DF8560BA9D14","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":188590,"discussion_content":"我的理解跟你的一样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582815443,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1044546,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/42/7728d4f5.jpg","nickname":"艿艿","note":"","ucode":"8F727AB7A7F6B2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":25622,"discussion_content":"是对滴。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570543365,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":67837,"user_name":"心语心愿","can_delete":false,"product_type":"c1","uid":1153168,"ip_address":"","ucode":"13BA3F5D5A46C9","user_header":"https://static001.geekbang.org/account/avatar/00/11/98/90/d9659fae.jpg","comment_is_top":false,"comment_ctime":1550293469,"is_pvip":true,"replies":[{"id":"24017","content":"是这样的，redolog是innodb里面的，<br><br>如果按照你说的这种方式，redolog提交后，在引擎内就得算是事务完成了（因为没有第二阶段让事务“真正完成”）<br><br>这样binlog失败的时候，想让引擎回滚就回滚不了了","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1550299868,"ip_address":"","comment_id":67837,"utype":1}],"discussion_count":2,"race_medal":0,"score":"27320097245","product_id":100020801,"comment_content":"有一个问题没想通想请教下老师，如果不分为两个阶段，而把写redo和binlog放在一个事务里面，如果写redo失败，则失败回滚，binlog写失败，则同样回滚，只有两个一同成功才算真正成功，这样也可以保证数据一致性，为什么一定需要两阶段呢","like_count":6,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439392,"discussion_content":"是这样的，redolog是innodb里面的，\n\n如果按照你说的这种方式，redolog提交后，在引擎内就得算是事务完成了（因为没有第二阶段让事务“真正完成”）\n\n这样binlog失败的时候，想让引擎回滚就回滚不了了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550299868,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1605161,"avatar":"https://static001.geekbang.org/account/avatar/00/18/7e/29/3ff55537.jpg","nickname":"舟潇","note":"","ucode":"01380F36DA7560","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391157,"discussion_content":"哇，原来问题出在这里！照老师说的，一切都可以解释的通了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630320579,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40814,"user_name":"菠菜","can_delete":false,"product_type":"c1","uid":1100102,"ip_address":"","ucode":"1D3F2DC57A579D","user_header":"https://static001.geekbang.org/account/avatar/00/10/c9/46/094b06bf.jpg","comment_is_top":false,"comment_ctime":1542678813,"is_pvip":false,"replies":[{"id":"14691","content":"1. 从checkpoint开始到writepos结束，不需要全部4G<br><br>2. Binlog写成功事务算成功，就提交事务；binlog没写成功就回滚","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542680382,"ip_address":"","comment_id":40814,"utype":1}],"discussion_count":3,"race_medal":0,"score":"27312482589","product_id":100020801,"comment_content":"俩问题，一个是当mysql重启，对于innodb的启动是如何实现的，听文章说redo log会很大，比如一个G，需要全都加载一边才能算启动完成吗？另一个，二段提交，如果在commit之前crash了，innodb是如何界定这一条数据全是丢弃还是不丢弃？因为有两种情况，一种是bin log写成功了，但是commit没成功，另一个是bin log压根就没写成功","like_count":6,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429619,"discussion_content":"1. 从checkpoint开始到writepos结束，不需要全部4G\n\n2. Binlog写成功事务算成功，就提交事务；binlog没写成功就回滚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542680382,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1661535,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5a/5f/8a76aa8b.jpg","nickname":"Lordran","note":"","ucode":"7CCD5F52471BB1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332199,"discussion_content":"但是在redolog写满的时候崩溃，重启的时候就还是会全部加载了吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607092114,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2166073,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","nickname":"戒酒的李白","note":"","ucode":"744E1A22761647","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1661535,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5a/5f/8a76aa8b.jpg","nickname":"Lordran","note":"","ucode":"7CCD5F52471BB1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":392764,"discussion_content":"redolog写满的时候崩溃，那由于等待刷脏页而没来得及写入redolog的数据会丢掉，但是由于此时也还没有写入binlog，所以不会产生数据不一致","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631112832,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":332199,"ip_address":""},"score":392764,"extra":""}]}]},{"had_liked":false,"id":39734,"user_name":"慕塔","can_delete":false,"product_type":"c1","uid":1302106,"ip_address":"","ucode":"5C6C668C1106A5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/A94RKUfWfwzRzb68T9xskctQ43TBgXSBIL78p0N0ria2tQxmsTTJebYmefhkbHK7zwpoxokxs43UxpgDTdwm5tg/132","comment_is_top":false,"comment_ctime":1542343794,"is_pvip":false,"replies":[{"id":"14253","content":"很好的提问方式👍🏿<br><br>Redo主要就是因为循环使用会覆盖；不过你说的这个逻辑，业界已经有团队通过改造InnoDB行为在做了，只是不是官方做的，所以正文中没提","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542345747,"ip_address":"","comment_id":39734,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27312147570","product_id":100020801,"comment_content":"多写场景需要吧 指标应该是RTO。有个问题既然innodb事务性这么强，为什么在恢复临时库不用redo恢复呢？直接对页进行恢复 数据一致性强，恢复时长也短，不用多写一份binlog，减少写放大。这样做主从直接redo同步岂不是更好吗(就是redo量有点大) 谢谢","like_count":6,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429203,"discussion_content":"很好的提问方式👍🏿\n\nRedo主要就是因为循环使用会覆盖；不过你说的这个逻辑，业界已经有团队通过改造InnoDB行为在做了，只是不是官方做的，所以正文中没提","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542345747,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39727,"user_name":"amazon1011","can_delete":false,"product_type":"c1","uid":1001032,"ip_address":"","ucode":"BD745BDCBD7059","user_header":"https://static001.geekbang.org/account/avatar/00/0f/46/48/e959b1e0.jpg","comment_is_top":false,"comment_ctime":1542342613,"is_pvip":false,"replies":[{"id":"14245","content":"对，这样说就精确👍🏿 <br><br>不过现在有些硬盘支持16K的原子写保证，就可以关掉double write buffer. <br>MariaDB 就提供了这个参数允许关掉","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542343261,"ip_address":"","comment_id":39727,"utype":1}],"discussion_count":2,"race_medal":0,"score":"27312146389","product_id":100020801,"comment_content":"老师，明白double write是为了保证数据页面的完整性，我上午问的是db 异常关闭起来需要做恢复的时候，因为MySQL 的redo 是物理逻辑日志，记录的是页面逻辑的改动，所以要保证数据页面的完整性，这个就是靠double write 去保证的，是这样吗？而Oracle因为redo是物理日志，所以不需要double write技术的保证?","like_count":6,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429198,"discussion_content":"对，这样说就精确👍🏿 \n\n不过现在有些硬盘支持16K的原子写保证，就可以关掉double write buffer. \nMariaDB 就提供了这个参数允许关掉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542343261,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1143234,"avatar":"","nickname":"刘瑞","note":"","ucode":"7E712BC281A8A7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":215045,"discussion_content":"redo是物理日志，binlog是逻辑日志，为什么你说mysql的redo是物理逻辑日志，我不太理解，您怎么划分的？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585276320,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":149164,"user_name":"长期规划","can_delete":false,"product_type":"c1","uid":1019332,"ip_address":"","ucode":"5EF65E9115834B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","comment_is_top":false,"comment_ctime":1573171981,"is_pvip":false,"replies":[{"id":"57918","content":"👍  <br>数据库的处理方式也可以借鉴到我们开发的其他系统中","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1573564586,"ip_address":"","comment_id":149164,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23048008461","product_id":100020801,"comment_content":"    第一：两阶段提交就可以解决一致性问题，屌，学习了，以后要处理一致性问题也用它。<br>    第二：binlog中只记录成功提交的事务。可以认为修改redo  log 的状态为commit不会失败，即使写完binlog后DB崩溃，重启用发现写了binlog，会自动修改redolog为commit。<br>    第三：redo log之所以叫redo应该是DB崩溃会用于事务自动回滚或继续提交。它是物理日志，即记录一个数据块的修改，而不是记录SQL，因为一个SQL可能对应多个数据块","like_count":5,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473758,"discussion_content":"👍  \n数据库的处理方式也可以借鉴到我们开发的其他系统中","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573564586,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46785,"user_name":"陈","can_delete":false,"product_type":"c1","uid":1304668,"ip_address":"","ucode":"81A54B3BA9C721","user_header":"https://static001.geekbang.org/account/avatar/00/13/e8/5c/561caff2.jpg","comment_is_top":false,"comment_ctime":1543981182,"is_pvip":false,"replies":[{"id":"16709","content":"有判断，相同就不写binlog了。<br><br>不过你这个问题可以衍生一个好问题，我问你一下，你怎么判断，这时候innodb里面改了(执行了修改动作，只是值不变），还是没改（直接跳过）？","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543985824,"ip_address":"","comment_id":46785,"utype":1}],"discussion_count":4,"race_medal":0,"score":"23018817662","product_id":100020801,"comment_content":"老师，今天遇到一个问题，当对一个表T中的字段t1做两次更新，update T set t1=2 where id=125;<br>update T set t1=2 where id=125;两次更新的值都相同， binlog只会记录一次日志，如果T表中的t1值原来就等于2，则Binlog不会记录日志。从原理中得知这个操作是没有导致行改变，因此不记录日志，Mysql源码更新操作是否有新值和原值的判读逻辑？<br>","like_count":5,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431544,"discussion_content":"有判断，相同就不写binlog了。\n\n不过你这个问题可以衍生一个好问题，我问你一下，你怎么判断，这时候innodb里面改了(执行了修改动作，只是值不变），还是没改（直接跳过）？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543985824,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2000552,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/86/a8/ab428874.jpg","nickname":"风满楼","note":"","ucode":"C761EB09D4EE0F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575888,"discussion_content":"server层再更新前有判断，如果更新前后值一致，会跳过。不一致，才会带参数传递到Innodb层。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655172358,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1882517,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/b9/95/cabab54b.jpg","nickname":"tong","note":"","ucode":"966DEDE81081D0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539467,"discussion_content":"根据影响行数判断，是否做了修改","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639723692,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2166073,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","nickname":"戒酒的李白","note":"","ucode":"744E1A22761647","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":392775,"discussion_content":"可以通过判断这个修改是否锁住了这行来判断？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631113641,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40891,"user_name":"花生","can_delete":false,"product_type":"c1","uid":1252241,"ip_address":"","ucode":"93A097D5129495","user_header":"https://static001.geekbang.org/account/avatar/00/13/1b/91/66f0d38a.jpg","comment_is_top":false,"comment_ctime":1542690293,"is_pvip":false,"replies":[{"id":"14710","content":"👍🏿","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542691023,"ip_address":"","comment_id":40891,"utype":1}],"discussion_count":2,"race_medal":0,"score":"23017526773","product_id":100020801,"comment_content":"记录一些偏实践的东西：<br>&#47;&#47; 配置文件etc&#47;my.cnf中，下边两个参数为redo log单个文件大小 和 这一组有几个文件。如下配置为 一组2个文件，文件默认大小2G。<br>innodb-log-file-size                    = 2G<br>innodb-log-files-in-group            = 2<br><br>&#47;&#47;上边配置的log文件位于 var目录中，两个文件命名如下，大小都是2G <br>var$ ll -h<br>-rw-rw---- 1 mysql mysql 2.0G Nov 20 10:58 ib_logfile0<br>-rw-rw---- 1 mysql mysql 2.0G Nov 12 12:55 ib_logfile1<br><br>这两个文件是在硬盘中申请的连续存储空间，配置好的mysql中，redo log会完全占用这一块的存储，所以不论文件中存储多少信息，占用空间都是固定的值2G.<br>","like_count":5,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429641,"discussion_content":"👍🏿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542691023,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1238436,"avatar":"https://static001.geekbang.org/account/avatar/00/12/e5/a4/e16dca6a.jpg","nickname":"阿凯文","note":"","ucode":"F17CF201E74849","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":281226,"discussion_content":"所以redo log持久化到硬盘的记录也是循环写的，会被覆盖的？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591696068,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40457,"user_name":"小文同学","can_delete":false,"product_type":"c1","uid":1001893,"ip_address":"","ucode":"48F2AEB989C12A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/49/a5/e4c1c2d4.jpg","comment_is_top":false,"comment_ctime":1542621615,"is_pvip":false,"replies":[{"id":"14572","content":"不会，最新的结果会保存在内存里面，就是“掌柜的记忆”，查询直接从内存返回就可以了<br>","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542623185,"ip_address":"","comment_id":40457,"utype":1}],"discussion_count":4,"race_medal":0,"score":"23017458095","product_id":100020801,"comment_content":"老师我问个笨问题，更新停留在redo-log bin-log上时，查询是如何把新数据也包括进来？是在查询启动的时候把redo-log的数据刷新到页数据里面么？同一个数据库里，查询和更新同样多时，岂不是会让redo-log的“粉笔板”效果失效？","like_count":5,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429526,"discussion_content":"不会，最新的结果会保存在内存里面，就是“掌柜的记忆”，查询直接从内存返回就可以了\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542623185,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2166073,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","nickname":"戒酒的李白","note":"","ucode":"744E1A22761647","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":392767,"discussion_content":"我理解应该是这样：   写入数据的时候， 会判断需要写入的数据页是否已经在内存中， 如果已经在内存中， 则将redolog的内容应用到内存中（此时脏页不会立即刷盘）；如果需要写入的数据页不在内存中，则只写redolog。  当需要查询的时候，会判断数据页是内存中是否存在，如果已经存在了， 直接取内存中的数据返回，如果数据页在内存不中存中，则从磁盘中读取这个数据页内存载入内存，并且应用这一页的redolog到内存中，再返回给客户端","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631113065,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1054827,"avatar":"https://static001.geekbang.org/account/avatar/00/10/18/6b/a1448af1.jpg","nickname":"贝影","note":"","ucode":"19545C8DCBF8A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2166073,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","nickname":"戒酒的李白","note":"","ucode":"744E1A22761647","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":542193,"discussion_content":"但是更新的时候不是会把所有的查询缓存清空吗？前面有个问题有问道","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640678738,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":392767,"ip_address":""},"score":542193,"extra":""},{"author":{"id":1911661,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLDOKcx20Xxmu5j8WxiafoYvo3bIAFDg8OeicRic1icD597QuMC9O8FyV2Al9RxNfVZXK0gkGUx6M3CVQ/132","nickname":"多年以后","note":"","ucode":"D70E7A1ABE0F39","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1054827,"avatar":"https://static001.geekbang.org/account/avatar/00/10/18/6b/a1448af1.jpg","nickname":"贝影","note":"","ucode":"19545C8DCBF8A2","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550459,"discussion_content":"你说的是查询缓存，他说的这个应该是buffer pool","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644558798,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":542193,"ip_address":""},"score":550459,"extra":""}]}]},{"had_liked":false,"id":39805,"user_name":"约书亚","can_delete":false,"product_type":"c1","uid":1046714,"ip_address":"","ucode":"81EA27ADD9EC1A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg","comment_is_top":false,"comment_ctime":1542359585,"is_pvip":false,"replies":[{"id":"14290","content":"Commit确实表示这两个日志都生效了。<br><br>可以看一下@高枕 在15:19 的评论","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542361924,"ip_address":"","comment_id":39805,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23017196065","product_id":100020801,"comment_content":"疑问，redo log是否必须处于commit状态，才能用于crash后的恢复？这样会不会在bin log写入，redo log commit之前发生crash？这样不是和您说情况2一样？<br>如果不是，那似乎又和情况1一样？<br>且如果最后commit之前crash，我理解是事务执行失败吧？那binlog这条记录不能用作恢复吧？<br>难道commit同时代表redo log和bin log生效?","like_count":5,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429232,"discussion_content":"Commit确实表示这两个日志都生效了。\n\n可以看一下@高枕 在15:19 的评论","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542361924,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39670,"user_name":"Enterprize","can_delete":false,"product_type":"c1","uid":1215130,"ip_address":"","ucode":"3C120E9023B6C5","user_header":"https://static001.geekbang.org/account/avatar/00/12/8a/9a/7270d764.jpg","comment_is_top":false,"comment_ctime":1542334108,"is_pvip":false,"replies":[{"id":"14189","content":"👍🏿爱学习，周末休息下，下一篇是下周一凌晨啦😄","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542335146,"ip_address":"","comment_id":39670,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23017170588","product_id":100020801,"comment_content":"爱学习的我表示可以更新快一些，每次看一篇不过瘾","like_count":5,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429171,"discussion_content":"👍🏿爱学习，周末休息下，下一篇是下周一凌晨啦😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542335146,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39599,"user_name":"Victor","can_delete":false,"product_type":"c1","uid":1301853,"ip_address":"","ucode":"FE02A97FF9A007","user_header":"https://static001.geekbang.org/account/avatar/00/13/dd/5d/ea2e41d0.jpg","comment_is_top":false,"comment_ctime":1542327344,"is_pvip":false,"replies":[{"id":"14238","content":"不止是checkpoint, 有别的时机的。 这个展开比较复杂，会在第十讲说到","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542342684,"ip_address":"","comment_id":39599,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23017163824","product_id":100020801,"comment_content":"感谢老师分享，很有深度，有个问题，一直有疑惑？Buffer Pool中的脏页刷新到磁盘中，只能由ckeckpoint操作触发么？有没有可能未提交的事务也刷新到磁盘中啦？","like_count":5,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429134,"discussion_content":"不止是checkpoint, 有别的时机的。 这个展开比较复杂，会在第十讲说到","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542342684,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39564,"user_name":"Allen","can_delete":false,"product_type":"c1","uid":1027383,"ip_address":"","ucode":"B624679AFDF61B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ad/37/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1542320939,"is_pvip":false,"replies":[{"id":"14254","content":"作者也很爱评论区，笔芯😁","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542345795,"ip_address":"","comment_id":39564,"utype":1}],"discussion_count":3,"race_medal":0,"score":"23017157419","product_id":100020801,"comment_content":"看了正文还有些不太能消化，再看看留言，还来也是有很重要的内容。看来留言也不能忽略，想当于大家学习后的交流和巩固","like_count":5,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429115,"discussion_content":"作者也很爱评论区，笔芯😁","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542345795,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1322622,"avatar":"https://static001.geekbang.org/account/avatar/00/14/2e/7e/bd3b2a08.jpg","nickname":"@","note":"","ucode":"1BF0CE3F3ED41E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579133,"discussion_content":"特别是 22 年看着 18 年的评论。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657187271,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1064247,"avatar":"https://static001.geekbang.org/account/avatar/00/10/3d/37/bbe5f958.jpg","nickname":"王晨","note":"","ucode":"942D9BD67A3418","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367881,"discussion_content":"评论区真是宝藏，特别是 21 年看着 18 年的评论。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618490610,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39559,"user_name":"pyhhou","can_delete":false,"product_type":"c1","uid":1256496,"ip_address":"","ucode":"31EF8D50CF91A5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ibZVAmmdAibBeVpUjzwId8ibgRzNk7fkuR5pgVicB5mFSjjmt2eNadlykVLKCyGA0GxGffbhqLsHnhDRgyzxcKUhjg/132","comment_is_top":false,"comment_ctime":1542306958,"is_pvip":false,"replies":[{"id":"14258","content":"记录binlog这个动作是执行器做的，引擎会提供信息；<br><br>嗯，写盘点代价比内存高的。但是这个是没法避免的。除非业务可以接受主机掉电丢数据。对于不能接受的业务，这个是绕不开的成本。 <br><br>所以幸好我们已经过了机械硬盘时代（弹冠相庆.gif)","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542346554,"ip_address":"","comment_id":39559,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23017143438","product_id":100020801,"comment_content":"老师讲的浅显易懂，我这个数据库小白感觉收获颇多。有两个地方不太理解，一是，binlog也可以被引擎操作，那么binlog除了由执行器记录逻辑信息，是否引擎也会参与进binlog的记录？另外就是小结中提到的将log文件在磁盘中持久化，这是一个怎样的操作？因为一想到外部磁盘总感觉和内存相比会很慢，每次更新都持久化磁盘会不会影响效率？望老师指正","like_count":5,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429113,"discussion_content":"记录binlog这个动作是执行器做的，引擎会提供信息；\n\n嗯，写盘点代价比内存高的。但是这个是没法避免的。除非业务可以接受主机掉电丢数据。对于不能接受的业务，这个是绕不开的成本。 \n\n所以幸好我们已经过了机械硬盘时代（弹冠相庆.gif)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542346554,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39551,"user_name":"十三","can_delete":false,"product_type":"c1","uid":1302582,"ip_address":"","ucode":"A214FA0FD9883E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJB3XACgTSAb61vSFyJskAcxbpNYskNBQdPbKIAn8jibRwlY0VUTyvwibvMhVqvPzMMQF3ibfmIHyHkg/132","comment_is_top":false,"comment_ctime":1542300863,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23017137343","product_id":100020801,"comment_content":"老师讲解的真好，期待更新","like_count":5},{"had_liked":false,"id":274203,"user_name":"王恩博","can_delete":false,"product_type":"c1","uid":1565769,"ip_address":"","ucode":"0B386D08AB554C","user_header":"https://static001.geekbang.org/account/avatar/00/17/e4/49/5cad48ed.jpg","comment_is_top":false,"comment_ctime":1610901675,"is_pvip":true,"replies":[{"id":"99602","content":"是，后面的章节有","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1611018399,"ip_address":"","comment_id":274203,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18790770859","product_id":100020801,"comment_content":"那假如一个大事务卡了很久没有commit，那么会不会发生redo-log一直卡在prepare 一直无法刷盘，导致checkpoint无法前进最终redo-log被写满的情况，此时又会发生什么呢，是后续的操作都会被阻塞么？<br>","like_count":4,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513939,"discussion_content":"是，后面的章节有","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611018399,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":92424,"user_name":"GLADIATOR","can_delete":false,"product_type":"c1","uid":1448564,"ip_address":"","ucode":"6FE14E0BCD6240","user_header":"https://static001.geekbang.org/account/avatar/00/16/1a/74/8f7f8786.jpg","comment_is_top":false,"comment_ctime":1557272469,"is_pvip":false,"replies":[{"id":"34317","content":"这个就是物理复制了，属于比较新的方向，现在官方还没有哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1558261432,"ip_address":"","comment_id":92424,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18737141653","product_id":100020801,"comment_content":"如果把redo log归档不就可以了吗？","like_count":4,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":449253,"discussion_content":"这个就是物理复制了，属于比较新的方向，现在官方还没有哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558261432,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70999,"user_name":"三胖","can_delete":false,"product_type":"c1","uid":1373454,"ip_address":"","ucode":"CD69FCD606FC5C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/1hp9kzzuLUVHzmmddIPIO2OgUWr1ibJRr8cMoB7K0fwx8Vmn34L8yN2NoYUtgNicfPGaXKF02pQ2huXd59r2I0kw/132","comment_is_top":false,"comment_ctime":1551241615,"is_pvip":false,"replies":[{"id":"25465","content":"1. ddl语句会写redo log的<br>2. 也要io开销，不过因为是顺序写，开销小<br>3. 不是更新后的值，而是 “数据页的内容是怎么变化的”","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1551265575,"ip_address":"","comment_id":70999,"utype":1}],"discussion_count":2,"race_medal":0,"score":"18731110799","product_id":100020801,"comment_content":"老师，ddl语句也会写入redo log吗？而且redo log是物理日志，同样也要I&#47;O开销吧？另外实在看不懂redo log里面到底存的是什么，不是更新后的值吗","like_count":4,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440939,"discussion_content":"1. ddl语句会写redo log的\n2. 也要io开销，不过因为是顺序写，开销小\n3. 不是更新后的值，而是 “数据页的内容是怎么变化的”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551265575,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1247006,"avatar":"https://static001.geekbang.org/account/avatar/00/13/07/1e/bdbe93f4.jpg","nickname":"尘封","note":"","ucode":"CEE0C006387A03","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334800,"discussion_content":"DDL会写undo log吗？undo是保证原子性的，而ddl不支持原子性","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607994549,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62657,"user_name":"磊","can_delete":false,"product_type":"c1","uid":1070732,"ip_address":"","ucode":"858BF8BFBFB0B8","user_header":"https://static001.geekbang.org/account/avatar/00/10/56/8c/a8317e23.jpg","comment_is_top":false,"comment_ctime":1548125223,"is_pvip":true,"replies":[{"id":"22179","content":"好问题，不是固定的大小哦<br><br>整个文件系统空间是固定大小的（根据系统配置）<br><br>write pos是“当前写入的位置”；<br>checkpoint是“已经将更新持久化到数据的位置”<br><br>所以如果系统TPS短时间内增大，这两个距离就会增大；<br>反之如果系统空闲的时候，这两个距离就会减小。<br><br>看到文章吃力也可以先跳过，可能之后的一篇就没那么难了。总之有问题随时发出来哈。<br><br>当然回头复习是好习惯，给你点赞👍","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1548129190,"ip_address":"","comment_id":62657,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18727994407","product_id":100020801,"comment_content":"老师您好，看到后面的文章越来越吃力，所以想回来再精细的看一遍，有个疑问，翻出了很多留言也没有找到有人问这个问题：<br>文章中写到：write pos 和 checkpoint 之前是“粉板”上还空着的部分，我的疑问是 checkpoint到write pos 这块内容的大小是如何定的，是不是一直是固定的大小？<br>","like_count":4,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437292,"discussion_content":"好问题，不是固定的大小哦\n\n整个文件系统空间是固定大小的（根据系统配置）\n\nwrite pos是“当前写入的位置”；\ncheckpoint是“已经将更新持久化到数据的位置”\n\n所以如果系统TPS短时间内增大，这两个距离就会增大；\n反之如果系统空闲的时候，这两个距离就会减小。\n\n看到文章吃力也可以先跳过，可能之后的一篇就没那么难了。总之有问题随时发出来哈。\n\n当然回头复习是好习惯，给你点赞👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548129190,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47055,"user_name":"null","can_delete":false,"product_type":"c1","uid":1024294,"ip_address":"","ucode":"F9039EFED6B55D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","comment_is_top":false,"comment_ctime":1544026870,"is_pvip":false,"replies":[{"id":"16800","content":"WAL机制里面有“已经提交但是还没落盘”的数据，binlog恢复不了这些","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544027538,"ip_address":"","comment_id":47055,"utype":1}],"discussion_count":6,"race_medal":0,"score":"18723896054","product_id":100020801,"comment_content":"思考题：<br>针对一周一备的情况下，假设最后一天因为误操作导致数据丢失，我们得找到上一周的整库备份文件进行恢复，同时还需要重放这周 7 天的 binlog 日志，恢复时间较长。而同样情况下，一天一备的场景，只需要重放今天的 binlog 日志便恢复数据了。<br><br>---<br><br>疑问：<br>为什么说“只依靠 binlog 是没有 crash-safe 能力的”？<br><br>原文提到：有了 redo log，InnoDB 就可以保证数据库发生异常重启，之前提交的记录都不会丢失，这种能力称之为 crash-safe。<br><br>假设我们将图“update 语句执行流程”中的“写入 redo log” 操作剔除，流程变成：... -&gt; “新行更新到内存” -&gt; “写 binlog” -&gt; “提交事务”。<br>1. 新行更新到内存，写 binlog 前发生异常重启，binlog 和 磁盘均无记录。（这种情况算数据丢失么？是否应该先写日志再更新内存呢？这样即使在写日志后，更新内存前，发生异常重启，数据在日志里未丢失。）<br>2. 写 binlog 之后发生异常，binlog 有记录，磁盘无记录，重放 binlog，磁盘状态与 binlog 一致，数据未丢失。<br><br>从上面 2 点来看，binlog 也可以保证数据库发生异常重启，之前提交的记录也不会丢失，即拥有 crash-safe 能力。<br><br>谢谢老师！","like_count":4,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431647,"discussion_content":"WAL机制里面有“已经提交但是还没落盘”的数据，binlog恢复不了这些","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544027538,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1228560,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/10/b7974690.jpg","nickname":"BD","note":"","ucode":"A95CF8C3EDC228","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":287654,"discussion_content":"“ WAL机制里面有“已经提交但是还没落盘”的数据，binlog恢复不了这些”这句话怎么理解啊","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1593504277,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1592576,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLIzE6JOuXsOamCWiaq8sHHVyCK44bdIOEqnE42veoZPEqxs5IJ8RT1Hicz0ZlPQFcbEFSwjV7icrfEw/132","nickname":"jjyyun","note":"","ucode":"8824654F673087","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1228560,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/10/b7974690.jpg","nickname":"BD","note":"","ucode":"A95CF8C3EDC228","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294495,"discussion_content":"+1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595905282,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":287654,"ip_address":""},"score":294495,"extra":""}]},{"author":{"id":1587367,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/kDAfyOQibroSCUliaG2tiachpaKyuPGd6eyRe20ibvb3R1QjSrLSufevBIOLQjAJpricM6mqeJJ4pccnbgKIfvoFnKw/132","nickname":"Geek_bcdbd4","note":"","ucode":"681F337C89A216","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302955,"discussion_content":"老师这点说错了吧，WLA里面有的数据肯定记录在redo log里了，根据二阶段提交协议，也是记录在binLog里面了，只不过这时候还没有落盘到磁盘（在系统空闲的时候将WLA里面的落盘），但是这时候无论是redo log还是bin log里面都有记录了吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599098376,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1886331,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/c8/7b/153181d7.jpg","nickname":"夜辉","note":"","ucode":"9421385F51FF9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1587367,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/kDAfyOQibroSCUliaG2tiachpaKyuPGd6eyRe20ibvb3R1QjSrLSufevBIOLQjAJpricM6mqeJJ4pccnbgKIfvoFnKw/132","nickname":"Geek_bcdbd4","note":"","ucode":"681F337C89A216","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377356,"discussion_content":"binlog中数据全部已经提交，但无法区分提交的数据是否持久化到磁盘中，而redo log从checkpoint~write pos位置的数据存在已提交，但未持久化到磁盘的数据。","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1622613121,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":302955,"ip_address":""},"score":377356,"extra":""},{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1886331,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/c8/7b/153181d7.jpg","nickname":"夜辉","note":"","ucode":"9421385F51FF9E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549813,"discussion_content":"Mark，开始一直疑惑两点问题: crash-safe到底safe在哪里，为什么binlog做不到；redo log在重启时是怎么知道哪些数据没有从内存写入磁盘。看到这才突然想通: binlog做不到crash-safe，是因为不知道哪些数据是没有从内存写入磁盘的；而redo log能做到，因为redo log有checkpoint，checkpoint和write pos之间的就是还没有写入磁盘的内存数据。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644244469,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":377356,"ip_address":""},"score":549813,"extra":""}]}]},{"had_liked":false,"id":42677,"user_name":"coolep","can_delete":false,"product_type":"c1","uid":1313451,"ip_address":"","ucode":"333BF57A2B5E78","user_header":"https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eorA0oyP7PSV68bicY1hzJITxPjCQJyLVJ2Bamhhv73knCr08HD69wsicLRh2yJksKAu0uzIs9P35xg/132","comment_is_top":false,"comment_ctime":1543019114,"is_pvip":false,"replies":[{"id":"15284","content":"如果是MySQL 代码里的精确顺序，是先更新内存的。这里主要是要说明WAL机制，这两个的顺序你可以认为“同时”，会更方便理解","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543029471,"ip_address":"","comment_id":42677,"utype":1}],"discussion_count":2,"race_medal":0,"score":"18722888298","product_id":100020801,"comment_content":"文中有两处内容让我迷惑，感觉描述不一致，如下：<br>“具体来说，当有一条记录需要更新的时候，InnoDB 引擎就会先把记录写到 redo log（粉板）里面，并更新内存”<br>“3.引擎将这行新数据更新到内存中，同时将这个更新操作记录到 redo log 里面”<br><br>该过程是先把新数据更新到内存中再写到redo log里吗？望老师给小白指导一下","like_count":4,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430157,"discussion_content":"如果是MySQL 代码里的精确顺序，是先更新内存的。这里主要是要说明WAL机制，这两个的顺序你可以认为“同时”，会更方便理解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543029471,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549815,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644244807,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42505,"user_name":"静处常思己过","can_delete":false,"product_type":"c1","uid":1131219,"ip_address":"","ucode":"D98F478185F3C3","user_header":"https://static001.geekbang.org/account/avatar/00/11/42/d3/5cb266ea.jpg","comment_is_top":false,"comment_ctime":1542962877,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18722832061","product_id":100020801,"comment_content":"在两阶段提交那段绕了半天。想了想：<br>1.redo log记录的数据状态，就是用户视角数据库中应该保存的状态。但是实际却可能还在内存中，没有写入磁盘。<br>2.异常重启：当MySQL异常重启后，会读取redo log，将没有写入磁盘的数据写进去。用户视角中的数据完整的保存了下来。并不会因为之前保存在内存中而丢失。此时redo log中没有commit状态的，就会回滚（如果redo log prepare + binlog = redo log commit）。<br>3.备份&#47;复制：当需要恢复数据到某一节点的时候，会用备份+重放binlog的方式。<br>4.如果没有两阶段提交存在。修改status 0 →1，写入redo log成功，写入binlog失败，那么MySQL异常重启后，根据redo log，数据库中的status已经是1 。但是如果我用binlog去恢复另外一个库，因为没有这个事务记录，所以status = 0。两个库对比，会出现一个stauts是0，另外一个是1的情况。反之同理。<br>5.上面是思考的过程，最后感觉可能也有同学跟我一样懵逼。我觉得要点是：redo log是MySQL用来保存类似工作现场快照的东西，MySQL崩溃后自己修复自己的时候用。手动备份或者恢复数据库的时候并不是依据它来做。binlog是给用户恢复到数据库某一节点用的。不能混了，不然绕不出来。<br>6.不知道上面的理解是不是都对。。。。","like_count":4},{"had_liked":false,"id":39640,"user_name":"jeffery","can_delete":false,"product_type":"c1","uid":1219972,"ip_address":"","ucode":"35E2DAA386FB86","user_header":"https://static001.geekbang.org/account/avatar/00/12/9d/84/171b2221.jpg","comment_is_top":false,"comment_ctime":1542330258,"is_pvip":false,"replies":[{"id":"14199","content":"建议设置row模式，row模式日志一样的可以用于重放的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542337416,"ip_address":"","comment_id":39640,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18722199442","product_id":100020801,"comment_content":"binglog 一般建议设置啥模式 假如row模式binglog 怎么回复","like_count":4,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429154,"discussion_content":"建议设置row模式，row模式日志一样的可以用于重放的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542337416,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39633,"user_name":"沙亮亮","can_delete":false,"product_type":"c1","uid":1099492,"ip_address":"","ucode":"E6CF0D5B1E6691","user_header":"https://static001.geekbang.org/account/avatar/00/10/c6/e4/ec572f55.jpg","comment_is_top":false,"comment_ctime":1542330064,"is_pvip":false,"replies":[{"id":"14249","content":"崩溃恢复用的是redolog","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542344852,"ip_address":"","comment_id":39633,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18722199248","product_id":100020801,"comment_content":"redo_log分为两阶段提交的一个原因是不是为了恢复binlog的时候不用去检查redo_log中对应语句的状态，因为binlog恢复的时候不可能每句都去检查redo_log是否提交成功，那样太繁琐？","like_count":4,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429150,"discussion_content":"崩溃恢复用的是redolog","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542344852,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39624,"user_name":"暴君•熊","can_delete":false,"product_type":"c1","uid":1101531,"ip_address":"","ucode":"AD1C6055E1F665","user_header":"https://static001.geekbang.org/account/avatar/00/10/ce/db/9dba29ea.jpg","comment_is_top":false,"comment_ctime":1542329309,"is_pvip":false,"replies":[{"id":"14211","content":"👍🏿听得认真就有奖励😄","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542338283,"ip_address":"","comment_id":39624,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18722198493","product_id":100020801,"comment_content":"头一次觉得概念变得如此清晰","like_count":4,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429146,"discussion_content":"👍🏿听得认真就有奖励😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542338283,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39623,"user_name":"一梦如是","can_delete":false,"product_type":"c1","uid":1305308,"ip_address":"","ucode":"9CCB1D0E547C83","user_header":"https://static001.geekbang.org/account/avatar/00/13/ea/dc/9a970e98.jpg","comment_is_top":false,"comment_ctime":1542329135,"is_pvip":false,"replies":[{"id":"14212","content":"第三讲会讲到哦","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542338305,"ip_address":"","comment_id":39623,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18722198319","product_id":100020801,"comment_content":"老师，undolog记录的是修改前的内容，这个是在什么时间写入和提交的呢？","like_count":4,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429145,"discussion_content":"第三讲会讲到哦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542338305,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39607,"user_name":"一步","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1542328008,"is_pvip":true,"replies":[{"id":"14223","content":"这个就涉及“组提交”概念。是的，有通知，commit完成然后才继续后面的流程（比如返回ack给客户端）","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542340906,"ip_address":"","comment_id":39607,"utype":1}],"discussion_count":1,"race_medal":1,"score":"18722197192","product_id":100020801,"comment_content":"老师，在两阶段提交那部分，每当一个动作完成后，会有事件通知吗？比如在binlog写入成功后，进行commit redo log，这个commit动作在成功或者失败后，会有回调或者事件通知吗？我感觉如果有通知机制的话，能更好的保持两个log的一致性，老师怎么认为呢？","like_count":4,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429139,"discussion_content":"这个就涉及“组提交”概念。是的，有通知，commit完成然后才继续后面的流程（比如返回ack给客户端）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542340906,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":177703,"user_name":"Geek_f2f3c7","can_delete":false,"product_type":"c1","uid":1436184,"ip_address":"","ucode":"96C65202E9D12C","user_header":"https://static001.geekbang.org/account/avatar/00/15/ea/18/80c24d33.jpg","comment_is_top":false,"comment_ctime":1581476944,"is_pvip":false,"replies":[{"id":"69166","content":"binlog记录了所有操作，操作记录里的时间也是精确到秒的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1581669558,"ip_address":"","comment_id":177703,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14466378832","product_id":100020801,"comment_content":"老师，怎样让数据库恢复到半个月内任意一秒的状态？这个是不是还需要redo log啊？为啥我感觉仅仅binlog不够","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483512,"discussion_content":"binlog记录了所有操作，操作记录里的时间也是精确到秒的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581669558,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":175052,"user_name":"阿明哥","can_delete":false,"product_type":"c1","uid":1192073,"ip_address":"","ucode":"825AAD05FA417C","user_header":"https://static001.geekbang.org/account/avatar/00/12/30/89/f9556ad0.jpg","comment_is_top":false,"comment_ctime":1580539990,"is_pvip":false,"replies":[{"id":"68005","content":"对，有可能","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1580555038,"ip_address":"","comment_id":175052,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14465441878","product_id":100020801,"comment_content":"老师您好，innodb_flush_log_at_trx_commit如果设置成1而sync_binlog未设置成1，这个时候如果执行完redo log后宕机了，是不是redo log的内容跟binlog也会不一样","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482608,"discussion_content":"对，有可能","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580555038,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549817,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644244998,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113284,"user_name":"锦","can_delete":false,"product_type":"c1","uid":1468298,"ip_address":"","ucode":"CB0EB4B68C468B","user_header":"https://static001.geekbang.org/account/avatar/00/16/67/8a/babd74dc.jpg","comment_is_top":false,"comment_ctime":1562933443,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14447835331","product_id":100020801,"comment_content":"感觉这个日志系统设计很有借鉴意义，即有状态的服务器系统都可以参考其设计思想。先写日志，后更新内存数据，最后写入存储系统(数据库)。这样就拥有了cashsafe的能力。<br>buffer pool中的lru淘汰算法分yong区和old区，分区使用不用算法策略，这点和JVM内存回收策略也有异曲同工之妙。<br>我发现实现高性能总会伴随各种buffer，而与高可用总是伴随各种日志。<br>","like_count":3,"discussions":[{"author":{"id":2351720,"avatar":"https://static001.geekbang.org/account/avatar/00/23/e2/68/ce547a12.jpg","nickname":"zjm1314","note":"","ucode":"63B0EAB7045054","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339695,"discussion_content":"最后一句话很对，殊途同归","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609758862,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":71656,"user_name":"Demter","can_delete":false,"product_type":"c1","uid":1158439,"ip_address":"","ucode":"BE3B6F726916CE","user_header":"https://static001.geekbang.org/account/avatar/00/11/ad/27/5556ae50.jpg","comment_is_top":false,"comment_ctime":1551408051,"is_pvip":false,"replies":[{"id":"26077","content":"<br>对，好问题，这个就是“推进checkpoint”的过程<br><br>当然也有可能redo log要更新的那个数据页刚好在内存，就跳过了你说的第一步","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1551509711,"ip_address":"","comment_id":71656,"utype":1}],"discussion_count":5,"race_medal":0,"score":"14436309939","product_id":100020801,"comment_content":"老师您好，请问redo log等系统不忙更新数据的时候，也是需要先从磁盘读出数据到内存，然后用redolog里面的记录更新内存，最后再一起写入磁盘吗？","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441259,"discussion_content":"\n对，好问题，这个就是“推进checkpoint”的过程\n\n当然也有可能redo log要更新的那个数据页刚好在内存，就跳过了你说的第一步","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551509711,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1911661,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLDOKcx20Xxmu5j8WxiafoYvo3bIAFDg8OeicRic1icD597QuMC9O8FyV2Al9RxNfVZXK0gkGUx6M3CVQ/132","nickname":"多年以后","note":"","ucode":"D70E7A1ABE0F39","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550501,"discussion_content":"内存里面的数据不也是更新过的吗，为什么要从磁盘再读到内存？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644571233,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2977279,"avatar":"","nickname":"Geek_c27ef8","note":"","ucode":"E003813AD580A1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1911661,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLDOKcx20Xxmu5j8WxiafoYvo3bIAFDg8OeicRic1icD597QuMC9O8FyV2Al9RxNfVZXK0gkGUx6M3CVQ/132","nickname":"多年以后","note":"","ucode":"D70E7A1ABE0F39","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572564,"discussion_content":"有可能需要刷盘的数据页不在内存中哦，被淘汰了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652858465,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":550501,"ip_address":""},"score":572564,"extra":""}]},{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549821,"discussion_content":"有点没太明白作者的意思，为什么要先从磁盘中读到内存，更新完再写回去呢？内存中的数据不就是新的吗？不是更新完内存数据才写的redo log吗，那内存中应该是最新的数据啊？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644245653,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1159645,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b1/dd/c814190f.jpg","nickname":"巴子小","note":"","ucode":"1C3D35AEC235BB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556254,"discussion_content":"其他事务变更了数据？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647264941,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":549821,"ip_address":""},"score":556254,"extra":""}]}]},{"had_liked":false,"id":70253,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1551059664,"is_pvip":false,"replies":[{"id":"25085","content":"对的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1551068939,"ip_address":"","comment_id":70253,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14435961552","product_id":100020801,"comment_content":"redo log 记录的，即使crash safe异常重启， 会刷新到磁盘。<br> bin log 归档记录的， 则主要用于备份，当需要通过恢复到某个时间点的数据时，就是通过备份文件与bin log来实现。","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440521,"discussion_content":"对的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551068939,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":67353,"user_name":"金龙","can_delete":false,"product_type":"c1","uid":1187493,"ip_address":"","ucode":"24B9B8A476DC9A","user_header":"https://static001.geekbang.org/account/avatar/00/12/1e/a5/85b05303.jpg","comment_is_top":false,"comment_ctime":1550134118,"is_pvip":false,"replies":[{"id":"23996","content":"实现上异常重启后，myisam就是放着不管的，会在你下次使用的时候提示 “表损坏，需要修复”<br><br>binlog不能崩溃恢复的原因，看下第15篇","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1550297915,"ip_address":"","comment_id":67353,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14435036006","product_id":100020801,"comment_content":"为什么说MyISAM 没有 crash-safe 的能力，binlog不能用来恢复吗？","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439153,"discussion_content":"实现上异常重启后，myisam就是放着不管的，会在你下次使用的时候提示 “表损坏，需要修复”\n\nbinlog不能崩溃恢复的原因，看下第15篇","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550297915,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62851,"user_name":"苍茫","can_delete":false,"product_type":"c1","uid":1299149,"ip_address":"","ucode":"CED8598307BEAE","user_header":"https://static001.geekbang.org/account/avatar/00/13/d2/cd/6fb14677.jpg","comment_is_top":false,"comment_ctime":1548173157,"is_pvip":false,"replies":[{"id":"22230","content":"第15篇和第23篇有提哈，你看下","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1548204852,"ip_address":"","comment_id":62851,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14433075045","product_id":100020801,"comment_content":"我想问下，逻辑日志和物理日志有啥区别，能不能详细解答一下？","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437372,"discussion_content":"第15篇和第23篇有提哈，你看下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548204852,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52115,"user_name":"哇！怎么这么大个","can_delete":false,"product_type":"c1","uid":1196856,"ip_address":"","ucode":"87106662D244C9","user_header":"https://static001.geekbang.org/account/avatar/00/12/43/38/72feb2e0.jpg","comment_is_top":false,"comment_ctime":1545312067,"is_pvip":false,"replies":[{"id":"18909","content":"就是回滚段导致的。<br>Ibdata不会帮你自动生成ibdata1,<br>会变大是因为有事务没提交，导致别的事务更新的回滚段不能回收，最终把文件撑大。<br>查一下数据库里的长事务，kill掉。不过这样只能避免继续膨胀，现有的空间不能回收了，<br><br>实在要回收只能靠把数据逻辑导入另外一个干净的库…","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545314759,"ip_address":"","comment_id":52115,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14430213955","product_id":100020801,"comment_content":"老师您好，有个问题需要请教您，我发现ibdata0文件无限膨胀并且不分裂初ibdata1文件，具体会是什么原因导致，有没什么有效的方式解决","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433751,"discussion_content":"就是回滚段导致的。\nIbdata不会帮你自动生成ibdata1,\n会变大是因为有事务没提交，导致别的事务更新的回滚段不能回收，最终把文件撑大。\n查一下数据库里的长事务，kill掉。不过这样只能避免继续膨胀，现有的空间不能回收了，\n\n实在要回收只能靠把数据逻辑导入另外一个干净的库…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545314759,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2166073,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","nickname":"戒酒的李白","note":"","ucode":"744E1A22761647","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":392777,"discussion_content":"unlog 也是在ibdata0中吗？  为啥kill掉后， 现有的空间不能回收？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631114436,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43880,"user_name":"shawn","can_delete":false,"product_type":"c1","uid":1010221,"ip_address":"","ucode":"8F6A8C7920996E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6a/2d/ec4ed8ce.jpg","comment_is_top":false,"comment_ctime":1543317001,"is_pvip":false,"replies":[{"id":"15664","content":"1. 是，而且更新的数据写到磁盘是后台操作<br><br>2. 是的，就是转成了顺序写","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543318267,"ip_address":"","comment_id":43880,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14428218889","product_id":100020801,"comment_content":"老师，对于wal我还有一些疑问：<br>1. 当你写入 插入一条记录c的时候，要先把c写入到WAL文件。commit 后做了两个动作，先把WAL文件持久化要磁盘，然后更新数据库（磁盘记录）。 我想问，是否要吧WAL文件持久化到磁盘，才更新数据库表和索引的记录到磁盘。<br>2.为什么WAL可用，是不是因为WAL是顺序性的文件，读写起来比较快？<br>","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430534,"discussion_content":"1. 是，而且更新的数据写到磁盘是后台操作\n\n2. 是的，就是转成了顺序写","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543318267,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43421,"user_name":"查尔斯","can_delete":false,"product_type":"c1","uid":1121529,"ip_address":"","ucode":"E3C7AB6E6B1631","user_header":"https://static001.geekbang.org/account/avatar/00/11/1c/f9/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1543225005,"is_pvip":false,"replies":[{"id":"15504","content":"Undolog是依赖redo来恢复的，没有redo的话，undolog就不完整…","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543228378,"ip_address":"","comment_id":43421,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14428126893","product_id":100020801,"comment_content":"有个疑问是，我们保证断电数据不丢失，可以在事务每次commit时候直接写磁盘落地，当然这性能太差，我们采取写日志的形式，日志是顺序写的，性能会高些，那这样的话我觉得可以直接使用binlog做断电后的恢复，每次写入binlog后再做commit，不写binlog当他没提交，这样理论上和直接写数据感觉是一样的，为什么还是要是用redo log呢？<br><br>~~~~~~~~~~~~~~~~~~~~~~~~~<br><br>书接上文，不支持直接回复有些难受<br><br>感谢您对我的解答，我的意思是使用binlog做断电数据恢复，没写log的不提交，但是 回滚操作使用undolog实现，redo log不写的话感觉不影响的呀","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430378,"discussion_content":"Undolog是依赖redo来恢复的，没有redo的话，undolog就不完整…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543228378,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40302,"user_name":"沙漠不二绿洲","can_delete":false,"product_type":"c1","uid":1309280,"ip_address":"","ucode":"2C756664F1853A","user_header":"https://static001.geekbang.org/account/avatar/00/13/fa/60/74a03dff.jpg","comment_is_top":false,"comment_ctime":1542590783,"is_pvip":false,"replies":[{"id":"14502","content":"Write pos是redo buffer接下来要写的位置， crash recovery 的起点就是checkpoint. (Crash recovery起点，这个提法很赞👍🏿","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542591875,"ip_address":"","comment_id":40302,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14427492671","product_id":100020801,"comment_content":"林老师，感谢你让我从未如此清晰的理解了二阶段提交的原理和必要性。有个疑惑checkpoint是指redo buffer落盘的位置，还是指日志更新写到表中的位置（crash recovery的起始点），我在理解oracle的checkpoint是后者的。。就不知道他们俩是否都一样?","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429466,"discussion_content":"Write pos是redo buffer接下来要写的位置， crash recovery 的起点就是checkpoint. (Crash recovery起点，这个提法很赞👍🏿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542591875,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40260,"user_name":"如余","can_delete":false,"product_type":"c1","uid":1184565,"ip_address":"","ucode":"C2005B97CE9593","user_header":"https://static001.geekbang.org/account/avatar/00/12/13/35/b6328a05.jpg","comment_is_top":false,"comment_ctime":1542587677,"is_pvip":false,"replies":[{"id":"14506","content":"这时候崩溃恢复时，事务会提交的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542592191,"ip_address":"","comment_id":40260,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14427489565","product_id":100020801,"comment_content":"如果binlog写入成功，而此时事务正在提交时crash了，那不是redo log  与 binlog 不一致，同时如果用binlog 恢复数据，是不是也会造成数据不一致，望老师解惑","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429448,"discussion_content":"这时候崩溃恢复时，事务会提交的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542592191,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39917,"user_name":"Nick","can_delete":false,"product_type":"c1","uid":1303145,"ip_address":"","ucode":"D453E42B9A8429","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIKa0PdjFnEpvGFBcED2P28ugPmwwRoCbeUfulpGEye8964F4nwChQyVfgVUia74TyDISvXTYJfQpA/132","comment_is_top":false,"comment_ctime":1542383517,"is_pvip":false,"replies":[{"id":"14349","content":"会先写一块内存，叫做log_buffer里面，在提交的时候再一次性写到磁盘","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542389610,"ip_address":"","comment_id":39917,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14427285405","product_id":100020801,"comment_content":"在一个大事物或长事物里，一边执行sql一边写redo log吗？未提交的事物也会写到redo log file吗？","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429291,"discussion_content":"会先写一块内存，叫做log_buffer里面，在提交的时候再一次性写到磁盘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542389610,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39847,"user_name":"落叶飞逝的恋","can_delete":false,"product_type":"c1","uid":1046429,"ip_address":"","ucode":"F9A95DB28BCF1E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f7/9d/be04b331.jpg","comment_is_top":false,"comment_ctime":1542365862,"is_pvip":false,"replies":[{"id":"14317","content":"都是文件，在数据库的data目录下，默认的，redolog是ib_log_file0这样的，binlog是xxx-bin.000001这样的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542369725,"ip_address":"","comment_id":39847,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14427267750","product_id":100020801,"comment_content":"还有这两种日志可以在哪直观查看","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429253,"discussion_content":"都是文件，在数据库的data目录下，默认的，redolog是ib_log_file0这样的，binlog是xxx-bin.000001这样的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542369725,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39676,"user_name":"发条橙子 。","can_delete":false,"product_type":"c1","uid":1259218,"ip_address":"","ucode":"ED076F4534FFED","user_header":"https://static001.geekbang.org/account/avatar/00/13/36/d2/c7357723.jpg","comment_is_top":false,"comment_ctime":1542334714,"is_pvip":false,"replies":[{"id":"14195","content":"1 是的<br>2 不是，server 层的查询缓存就是（query_cache) Server层跟innodb的buffer pool是没有交集的，引擎没有暴露这个接口，只有操作数据的接口<br>3 跟2 类似，不是一个东西哦","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542337117,"ip_address":"","comment_id":39676,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14427236602","product_id":100020801,"comment_content":"innodb结构为内存池和后台线程 ， 其中内存池里存在redo日志缓冲 和 缓冲池，其中缓冲池以页为单位缓冲磁盘数据 。<br><br>问题： <br>1.之前老师说更新语句时执行器调用innodb存储引擎先从内存读数据，指的就是从innodb缓存池中读取数据把，没有的话就去读取磁盘找， 找到后再同步到缓冲池。<br><br>2. 在 server层中， 连接器先 查询缓存 ， 这个缓存指的也是 innodb 的缓冲池么。mysql 通过公有的缓冲组件调用 innodb 的缓冲池来获取值。 获取不到在走 分析器 --&gt; 优化器 --&gt; 执行器的流程 。<br><br>3. 从缓冲中取的时候 ，为什么没有  分析器 --&gt; 优化器 --&gt; 执行器 的流程呢","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429174,"discussion_content":"1 是的\n2 不是，server 层的查询缓存就是（query_cache) Server层跟innodb的buffer pool是没有交集的，引擎没有暴露这个接口，只有操作数据的接口\n3 跟2 类似，不是一个东西哦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542337117,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1463749,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erHJBx7XzPpoIZRuOoaIE5Av5ibzfgx7jVKFdma7oQgtHnThkwX7Z2dbOia3jqXxbaPhENZVJlfgbicg/132","nickname":"长不大的孩子","note":"","ucode":"19D5EDEC4E13E3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":169530,"discussion_content":"innodb说到底也就是一个服务，对server层仅仅暴露了正删改查的相关接口，但是内部如何操作只能innodb自己玩，比如查询，innodb不管是缓存取值还是读磁盘取值，都是在他的内部自己做的，外部server层是无知的。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1581609381,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39660,"user_name":"喔～","can_delete":false,"product_type":"c1","uid":1172171,"ip_address":"","ucode":"FE2C87CE6FEBD8","user_header":"https://static001.geekbang.org/account/avatar/00/11/e2/cb/6bc95e09.jpg","comment_is_top":false,"comment_ctime":1542332601,"is_pvip":false,"replies":[{"id":"14196","content":"Redo和undo都在支持事务的，undo用于支持事务的隔离性（下一讲会介绍），redo支持持久性","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542337251,"ip_address":"","comment_id":39660,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14427234489","product_id":100020801,"comment_content":"老师，有点疑惑请教一下<br>对于 deferred 写操作，通过redo 来实现事务<br>对于 in-place 写操作，通过undo 来实现事务<br>那么对于redo与undo共存的日志体系，其目的与应用场景是怎样的？","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429167,"discussion_content":"Redo和undo都在支持事务的，undo用于支持事务的隔离性（下一讲会介绍），redo支持持久性","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542337251,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1886331,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/c8/7b/153181d7.jpg","nickname":"夜辉","note":"","ucode":"9421385F51FF9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377359,"discussion_content":"Redo保证持久性，Undo保证原子性和隔离性","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622614494,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39657,"user_name":"代贤君","can_delete":false,"product_type":"c1","uid":1304503,"ip_address":"","ucode":"5DA38EF27918D5","user_header":"https://static001.geekbang.org/account/avatar/00/13/e7/b7/5aa9a011.jpg","comment_is_top":false,"comment_ctime":1542331958,"is_pvip":false,"replies":[{"id":"14237","content":"是的，我们在 第六讲会提到","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542342595,"ip_address":"","comment_id":39657,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14427233846","product_id":100020801,"comment_content":"备份也是有锁的，特别是myisam引擎","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429165,"discussion_content":"是的，我们在 第六讲会提到","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542342595,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39635,"user_name":"hhhh","can_delete":false,"product_type":"c1","uid":1256101,"ip_address":"","ucode":"9E87017424B382","user_header":"https://static001.geekbang.org/account/avatar/00/13/2a/a5/625c0a2e.jpg","comment_is_top":false,"comment_ctime":1542330163,"is_pvip":false,"replies":[{"id":"14202","content":"Redolog固定大小，不会“导致过大”的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542337505,"ip_address":"","comment_id":39635,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14427232051","product_id":100020801,"comment_content":"频繁的更新写入，导致redolog过大，适合短周期的备份？","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429151,"discussion_content":"Redolog固定大小，不会“导致过大”的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542337505,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39606,"user_name":"amazon1011","can_delete":false,"product_type":"c1","uid":1001032,"ip_address":"","ucode":"BD745BDCBD7059","user_header":"https://static001.geekbang.org/account/avatar/00/0f/46/48/e959b1e0.jpg","comment_is_top":false,"comment_ctime":1542327878,"is_pvip":false,"replies":[{"id":"14227","content":"Double write buffer这里理解不太对，是要保证数据页完整才能“写入磁盘”。 这个过程跟我们今天的内容关系不大哈。我们可以在第10讲讨论这个问题","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542341058,"ip_address":"","comment_id":39606,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14427229766","product_id":100020801,"comment_content":"老师可以分享下MySQL 的redo和Oracle的redo有什么不一样吗?之前在书上看M中的的redo是物理逻辑日志，就是说记录到物理页面的，但记录页面的内容是逻辑的，基于这个原因，有了double write的设计，就是一定要保证数据页面是完整的才能应用redo，而O因为是真正的物理日志，才没有double write的设计，不知道理解的对不对，请指教，谢谢","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429138,"discussion_content":"Double write buffer这里理解不太对，是要保证数据页完整才能“写入磁盘”。 这个过程跟我们今天的内容关系不大哈。我们可以在第10讲讨论这个问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542341058,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39603,"user_name":"随心而至","can_delete":false,"product_type":"c1","uid":1097836,"ip_address":"","ucode":"31866865255101","user_header":"https://static001.geekbang.org/account/avatar/00/10/c0/6c/29be1864.jpg","comment_is_top":false,"comment_ctime":1542327571,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14427229459","product_id":100020801,"comment_content":"当每天需要进行大量的更新操作时，使用一天一备份较好，这样备份库使用bin log备份时可以更快地完成，而且备份库的数据不会落后主库太多","like_count":3},{"had_liked":false,"id":250444,"user_name":"郝攀刚จุ๊บ","can_delete":false,"product_type":"c1","uid":1206745,"ip_address":"","ucode":"8AE7A85093E51A","user_header":"https://static001.geekbang.org/account/avatar/00/12/69/d9/968df259.jpg","comment_is_top":false,"comment_ctime":1601087680,"is_pvip":false,"replies":[{"id":"92525","content":"这两个会影响<br>不过在高并发的问题里，锁的影响可能会大些","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1602664257,"ip_address":"","comment_id":250444,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10191022272","product_id":100020801,"comment_content":"今天面试遇到了一个问题，就是高并发的插入下，有哪些情况下会导致数据库插入变慢。对于这篇提到的redo log和binlog有关系吗？","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506208,"discussion_content":"这两个会影响\n不过在高并发的问题里，锁的影响可能会大些","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602664257,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":174954,"user_name":"一条鲁蛇🐍","can_delete":false,"product_type":"c1","uid":1515891,"ip_address":"","ucode":"9413747008D3C0","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJlrDU3ia4zj0zlNEt27JIrkwIuJo7kA3icD21xuLeSia22FNVfknibrMXSRPpQRfX4uv3oBeJQ7xc5iaA/132","comment_is_top":false,"comment_ctime":1580476610,"is_pvip":false,"replies":[{"id":"67985","content":"myisam 没有crash-safe，若在进行事务的时候crash了，是不是事务就丢失了？<br>----是的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1580489299,"ip_address":"","comment_id":174954,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10170411202","product_id":100020801,"comment_content":"老湿，不才有一疑惑~<br>假如只有innodb引擎有redo log进行crash-safe保护，那么其他引擎如myisam没有crash-safe的话，若在进行事务的时候crash了，是不是事务就丢失了？还是有其他机制保证了crash之后，不会有数据丢失？","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482580,"discussion_content":"myisam 没有crash-safe，若在进行事务的时候crash了，是不是事务就丢失了？\n----是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580489299,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":173464,"user_name":"珞珈山","can_delete":false,"product_type":"c1","uid":1441354,"ip_address":"","ucode":"D8CA5C61243712","user_header":"https://static001.geekbang.org/account/avatar/00/15/fe/4a/b2d6ed39.jpg","comment_is_top":false,"comment_ctime":1579567850,"is_pvip":false,"replies":[{"id":"67297","content":"加油，这个用户名看来，我团队里有不少你的校友😆","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1579613481,"ip_address":"","comment_id":173464,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10169502442","product_id":100020801,"comment_content":"打卡，加油","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482076,"discussion_content":"加油，这个用户名看来，我团队里有不少你的校友😆","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579613481,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337350,"discussion_content":"牛逼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608881405,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":168237,"user_name":"88591","can_delete":false,"product_type":"c1","uid":1254656,"ip_address":"","ucode":"04CE3E46455185","user_header":"https://static001.geekbang.org/account/avatar/00/13/25/00/3afbab43.jpg","comment_is_top":false,"comment_ctime":1578035913,"is_pvip":false,"replies":[{"id":"65330","content":"这时候查询的时候，直接从内存返回就可以了。<br>内存里是正确的数据<br><br>磁盘上数据文件其实还是旧数据，不过因为请求查不到，所以没关系。","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1578054551,"ip_address":"","comment_id":168237,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10167970505","product_id":100020801,"comment_content":"老师 ，更新redo log 和binlog log 成功后 。InnoDB 在空闲的时候才把日志文件写入到数据文件。如果查询的时候不使用缓存，日志文件还没有来得及同步到数据文件，那么怎么保证查询到的数据文件与日志文件一致的呢？","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480170,"discussion_content":"这时候查询的时候，直接从内存返回就可以了。\n内存里是正确的数据\n\n磁盘上数据文件其实还是旧数据，不过因为请求查不到，所以没关系。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578054551,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2020865,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/d6/01/eaa50203.jpg","nickname":"zft","note":"","ucode":"74DEC5FBA610B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":276162,"discussion_content":"文中有提到，更新时，会先写内存然后再写redo log","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590830879,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":145677,"user_name":"Geek_83a5c2","can_delete":false,"product_type":"c1","uid":1718459,"ip_address":"","ucode":"BAAD3012FF1FEA","user_header":"","comment_is_top":false,"comment_ctime":1572341790,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10162276382","product_id":100020801,"comment_content":"最新正在学习缓存，mysql的缓存绝对比我们项目考虑的要全面。在上篇文章中您提到如果更改频繁的数据库尽量不要使用查询缓存。在本篇，更新数据库时如果内存中有则直接修改内存中的数据。上篇的缓存和本篇说的内存应该不是一个。那mysql里为了提高性能，在什么地方使用了缓存（缓存和内存在一定程度上可以理解为是一样的?）。老师能否讲解一下mysql缓存的设计思想吗？以便我们在框架中借鉴该思想。","like_count":2},{"had_liked":false,"id":90123,"user_name":"Eric余浩","can_delete":false,"product_type":"c1","uid":1120829,"ip_address":"","ucode":"3EED5672AB14DF","user_header":"https://static001.geekbang.org/account/avatar/00/11/1a/3d/189c2360.jpg","comment_is_top":false,"comment_ctime":1556420571,"is_pvip":false,"replies":[{"id":"32681","content":"就只有redo，没有两阶段了","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1556895706,"ip_address":"","comment_id":90123,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10146355163","product_id":100020801,"comment_content":"如果没有开启binlog的更新操作是怎么样的？是否也有两段提交？","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448398,"discussion_content":"就只有redo，没有两阶段了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556895706,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":71786,"user_name":"kabuka","can_delete":false,"product_type":"c1","uid":1246009,"ip_address":"","ucode":"932DD1E875D850","user_header":"https://static001.geekbang.org/account/avatar/00/13/03/39/18956b2e.jpg","comment_is_top":false,"comment_ctime":1551432232,"is_pvip":false,"replies":[{"id":"26076","content":"redo log有redo log buffer<br>binlog 有binlog cache<br>保持数据的问题，可以跳看一下15和23篇","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1551509662,"ip_address":"","comment_id":71786,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10141366824","product_id":100020801,"comment_content":"redo 和 binlog是在内存中还是磁盘？要是在磁盘上每次写的时候会不会影响性能？还是内存和磁盘上都有，如果都有的话怎么保持在突然断电的时候数据一致性？ ","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441329,"discussion_content":"redo log有redo log buffer\nbinlog 有binlog cache\n保持数据的问题，可以跳看一下15和23篇","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551509662,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63285,"user_name":"summer_7196","can_delete":false,"product_type":"c1","uid":1390813,"ip_address":"","ucode":"B61E9F29D0D8CE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ2QFSebcWYzvSibOicRbaeqGmq1kFuHVvwjadDsicQnIbovlGqSfmfibtib9TSwcIqWfcxkKw8DSxTTVg/132","comment_is_top":false,"comment_ctime":1548316746,"is_pvip":false,"replies":[{"id":"22409","content":"不是，如果保证原子性，就不用两阶段啦","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1548321674,"ip_address":"","comment_id":63285,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10138251338","product_id":100020801,"comment_content":"两阶段提交是原子性的吧？","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437533,"discussion_content":"不是，如果保证原子性，就不用两阶段啦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548321674,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1629257,"avatar":"https://static001.geekbang.org/account/avatar/00/18/dc/49/43ae1627.jpg","nickname":"Ansyear","note":"","ucode":"489CE96852EA2C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":328235,"discussion_content":"所以关掉不使用binlog后，也可以不用两阶段提交而只用redolog保证原子性就行了吗？\n两阶段可以关掉吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606110601,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62656,"user_name":"Fj_yyyyy","can_delete":false,"product_type":"c1","uid":1389066,"ip_address":"","ucode":"CAC2A057DF84F8","user_header":"https://static001.geekbang.org/account/avatar/00/15/32/0a/f9b44e11.jpg","comment_is_top":false,"comment_ctime":1548125217,"is_pvip":false,"replies":[{"id":"22177","content":"redo log和binlog其实都是粉板的概念，<br>只是redo log是专门给innodb用的，而且在MySQL的实现里面，是用redo log来达到“崩溃恢复”这个作用的。<br><br>binlog一直的定位是“归档日志”","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1548128988,"ip_address":"","comment_id":62656,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10138059809","product_id":100020801,"comment_content":"老师, 我是一个初学者, 我有些不太理解为何要用redo.log, 前面举的那个记账的例子我可以理解, 但是binlog只是记录变化, 不是应该就是不停的写下去吗, 就不像是账本需要找到人, 然后对应的计入这个人的账目.....所以我觉得binlog就是那个粉板了...因为我是初学者, 所以可能很多基础知识有缺失, 老师直接指出搜索哪些相关知识可以帮助我理解这个问题也可以, 我可以自己去看","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437291,"discussion_content":"redo log和binlog其实都是粉板的概念，\n只是redo log是专门给innodb用的，而且在MySQL的实现里面，是用redo log来达到“崩溃恢复”这个作用的。\n\nbinlog一直的定位是“归档日志”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548128988,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":60802,"user_name":"suhui","can_delete":false,"product_type":"c1","uid":1155326,"ip_address":"","ucode":"53BD826C1164F9","user_header":"https://static001.geekbang.org/account/avatar/00/11/a0/fe/ac5a62f3.jpg","comment_is_top":false,"comment_ctime":1547554424,"is_pvip":false,"replies":[{"id":"21679","content":"1. 索引也是数据的一部分哈，一样的策略<br>2. 会写redolog，打上回滚标签，binlog就直接丢弃啦。回滚都是把没用的内存版本删掉","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547556839,"ip_address":"","comment_id":60802,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10137489016","product_id":100020801,"comment_content":"老师你好，复习这篇文章的时候有几个新的问题，还请老师解答：<br>        1. 如果更新语句涉及到索引，索引是什么时候被更新的，是否跟数据一样，先更新内存，然后再持久化到磁盘？<br>        2. 如果事务失败，回滚的时候，是否也会写redo log和binlog。回滚涉及到索引的更新话，索引如何回滚的呢？","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436626,"discussion_content":"1. 索引也是数据的一部分哈，一样的策略\n2. 会写redolog，打上回滚标签，binlog就直接丢弃啦。回滚都是把没用的内存版本删掉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547556839,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45325,"user_name":"KeepGoing","can_delete":false,"product_type":"c1","uid":1184637,"ip_address":"","ucode":"B872F794265709","user_header":"https://static001.geekbang.org/account/avatar/00/12/13/7d/1454db9c.jpg","comment_is_top":false,"comment_ctime":1543588091,"is_pvip":true,"replies":[{"id":"16108","content":"评论区是个好地方， 不怕无限展开，越用心看的人奖励越多😄","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543600922,"ip_address":"","comment_id":45325,"utype":1}],"discussion_count":3,"race_medal":0,"score":"10133522683","product_id":100020801,"comment_content":"把评论看完才能理解的很透彻，嗯～～～","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430983,"discussion_content":"评论区是个好地方， 不怕无限展开，越用心看的人奖励越多😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543600922,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1322622,"avatar":"https://static001.geekbang.org/account/avatar/00/14/2e/7e/bd3b2a08.jpg","nickname":"@","note":"","ucode":"1BF0CE3F3ED41E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579194,"discussion_content":"还不能复制  ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657247523,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2351720,"avatar":"https://static001.geekbang.org/account/avatar/00/23/e2/68/ce547a12.jpg","nickname":"zjm1314","note":"","ucode":"63B0EAB7045054","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339697,"discussion_content":"这个评论区涉及的不好啊，没有明确的分页","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609758941,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43748,"user_name":"zhxleon","can_delete":false,"product_type":"c1","uid":1309140,"ip_address":"","ucode":"4ADCCEBC6B0FB6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJoyqXrhQS7Chvj4yNxUlZ1Ltribiat2uQMiabQURjwA9KQojKicjjQOdJDZ85VwaI5t4LrOHOHjOLRgw/132","comment_is_top":false,"comment_ctime":1543286618,"is_pvip":false,"replies":[{"id":"15615","content":"官方的动作有这个趋势","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543286992,"ip_address":"","comment_id":43748,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10133221210","product_id":100020801,"comment_content":"innodb肯定是MySQL用的最多的存储引擎，redo为什么不能像oracle一样直接生成一份归档日志，这样MySQL也可以和oracle一样做物理复制了，只需要把redo产生吨位归档传输到从库应用即可，同时也能保证数据完全一致，而且从库应用日志速度也会比现在快的多","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430481,"discussion_content":"官方的动作有这个趋势","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543286992,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42731,"user_name":"WL","can_delete":false,"product_type":"c1","uid":1173771,"ip_address":"","ucode":"6277DCD776B87E","user_header":"https://static001.geekbang.org/account/avatar/00/11/e9/0b/1171ac71.jpg","comment_is_top":false,"comment_ctime":1543029577,"is_pvip":false,"replies":[{"id":"15300","content":"对的，存储成本和RTO的权衡","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543041697,"ip_address":"","comment_id":42731,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10132964169","product_id":100020801,"comment_content":"一天一备份, 每份bin log都比较小, 数据恢复比较快, 但是每天数据库备份占用的硬盘空间会比较大, 相比每周备份几乎多了一个数量级. ","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430176,"discussion_content":"对的，存储成本和RTO的权衡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543041697,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":41852,"user_name":"伪装成学霸的学渣","can_delete":false,"product_type":"c1","uid":1018936,"ip_address":"","ucode":"5E82A89D999664","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8c/38/f1f2227a.jpg","comment_is_top":false,"comment_ctime":1542859624,"is_pvip":false,"replies":[{"id":"15022","content":"建议全部小写，作者给了错误示范，以后改正😄","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542872240,"ip_address":"","comment_id":41852,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10132794216","product_id":100020801,"comment_content":"想请教一下 table 和  column的命名规则，怎样使比较推荐的方式。我看到作者是table 和 ID 是 大写， 其他的column是小写？ ","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429921,"discussion_content":"建议全部小写，作者给了错误示范，以后改正😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542872240,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":41328,"user_name":"yushing","can_delete":false,"product_type":"c1","uid":1108112,"ip_address":"","ucode":"244C58F218D586","user_header":"https://static001.geekbang.org/account/avatar/00/10/e8/90/d63f8347.jpg","comment_is_top":false,"comment_ctime":1542765875,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10132700467","product_id":100020801,"comment_content":"文本提到“如果每一次的更新操作都需要写进磁盘，磁盘还要找到对应的那条记录再更新，整个过程IO和查找成本都很高，于是使用WAL技术进行优化”，我的疑问是redo log和binlog不是也要写入磁盘么，那么使用redo log和binlog怎么能够解决更新时磁盘IO和查找成本高的问题呢？还望老师能够解答，谢谢~","like_count":2,"discussions":[{"author":{"id":1044546,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/42/7728d4f5.jpg","nickname":"艿艿","note":"","ucode":"8F727AB7A7F6B2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":25629,"discussion_content":"redolog 和 binlog 是顺序写入。\n如果直接更新数据，是随机写入。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1570543593,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":41112,"user_name":"LyricTian","can_delete":false,"product_type":"c1","uid":1198238,"ip_address":"","ucode":"675CD39863292F","user_header":"https://static001.geekbang.org/account/avatar/00/12/48/9e/4f895bfb.jpg","comment_is_top":false,"comment_ctime":1542727199,"is_pvip":false,"replies":[{"id":"14756","content":"更新都会被堵住，但是不算数据丢失，因为事务根本就提交不了。<br><br>事务&#47;数据丢失的定义应该是本应该存在的结果没了。但是这时候并没有告知客户端“成功”，也就不算“丢失”","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542729142,"ip_address":"","comment_id":41112,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10132661791","product_id":100020801,"comment_content":"老师好，我在文章中，看到说，如果redo log被写满了，需要停下来将数据写入磁盘。这个时候，整个数据库是处于阻塞状态吗？当有大量数据涌入的时候，会存在丢失数据的风险吗？","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429701,"discussion_content":"更新都会被堵住，但是不算数据丢失，因为事务根本就提交不了。\n\n事务/数据丢失的定义应该是本应该存在的结果没了。但是这时候并没有告知客户端“成功”，也就不算“丢失”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542729142,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40937,"user_name":"哈乐笑","can_delete":false,"product_type":"c1","uid":1307729,"ip_address":"","ucode":"803354F4AB3F02","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erYNBIwAj3KdIXaXbeMBUjTfYUkeiaCHDotMCN9vjoLJylqAsM0UtwZEjRQQV0QA4D81EwHq7YQxhA/132","comment_is_top":false,"comment_ctime":1542698382,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"10132632974","product_id":100020801,"comment_content":"看了作者的文章，我感觉redo log和binlog都有恢复数据库的功能，不过redo log是，当mysql服务挂掉之后，重启的时候回复用的恶，而binlog是用于数据库损坏或者误删等整体大规模恢复用的。不知道这样理解对不对","like_count":2},{"had_liked":false,"id":39879,"user_name":"oscarwin","can_delete":false,"product_type":"c1","uid":1131956,"ip_address":"","ucode":"492430BA342593","user_header":"https://static001.geekbang.org/account/avatar/00/11/45/b4/ec66d499.jpg","comment_is_top":false,"comment_ctime":1542373799,"is_pvip":false,"replies":[{"id":"14327","content":"不会删除，除非内存不够用。不过在数据从内存删除之前，系统会保证它会被更新到磁盘数据上","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542378101,"ip_address":"","comment_id":39879,"utype":1}],"discussion_count":3,"race_medal":0,"score":"10132308391","product_id":100020801,"comment_content":"老师，还有一个疑问，update后先写入内存，然后写redo log，那么写入的这条数据在内存中的驻留时间是怎么处理的？是redo log写入磁盘后从内存中删除吗？","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429271,"discussion_content":"不会删除，除非内存不够用。不过在数据从内存删除之前，系统会保证它会被更新到磁盘数据上","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542378101,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1911661,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLDOKcx20Xxmu5j8WxiafoYvo3bIAFDg8OeicRic1icD597QuMC9O8FyV2Al9RxNfVZXK0gkGUx6M3CVQ/132","nickname":"多年以后","note":"","ucode":"D70E7A1ABE0F39","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550905,"discussion_content":"系统保证它会被更新到磁盘数据上，这个是从redolog更新到磁盘还是从内测更新到磁盘呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644806898,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2351720,"avatar":"https://static001.geekbang.org/account/avatar/00/23/e2/68/ce547a12.jpg","nickname":"zjm1314","note":"","ucode":"63B0EAB7045054","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339702,"discussion_content":"那如果此时mysql重启了呢，内存里的东西就没了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609759670,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39825,"user_name":"wida","can_delete":false,"product_type":"c1","uid":1045395,"ip_address":"","ucode":"704D86B3EA62B6","user_header":"","comment_is_top":false,"comment_ctime":1542361898,"is_pvip":false,"replies":[{"id":"14297","content":"我们分成日志 (redolog)和 数据文件 ，不在一起的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542362939,"ip_address":"","comment_id":39825,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10132296490","product_id":100020801,"comment_content":"先写日志后写文件如何理解 日志不是在文件里吗？ 是不是redolog 是先在内存里头的？","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429243,"discussion_content":"我们分成日志 (redolog)和 数据文件 ，不在一起的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542362939,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39811,"user_name":"华仔","can_delete":false,"product_type":"c1","uid":1185183,"ip_address":"","ucode":"4D3304FE618F3A","user_header":"https://static001.geekbang.org/account/avatar/00/12/15/9f/84dfa9a7.jpg","comment_is_top":false,"comment_ctime":1542360460,"is_pvip":false,"replies":[{"id":"14282","content":"这个命名来源于redolog提交分成了两阶段","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542360775,"ip_address":"","comment_id":39811,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10132295052","product_id":100020801,"comment_content":"没有听懂两阶段提交的意思？是指阶段状态的提交，还是指redo日志的一次提交加binlog日志的一次提交呢。<br>是redo日志的两次状态提交么？","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429236,"discussion_content":"这个命名来源于redolog提交分成了两阶段","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542360775,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39782,"user_name":"毓殇笳","can_delete":false,"product_type":"c1","uid":1307422,"ip_address":"","ucode":"00C86902689D64","user_header":"https://static001.geekbang.org/account/avatar/00/13/f3/1e/8ea92c76.jpg","comment_is_top":false,"comment_ctime":1542356454,"is_pvip":false,"replies":[{"id":"14294","content":"哎呀作者害羞了😁","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542362530,"ip_address":"","comment_id":39782,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10132291046","product_id":100020801,"comment_content":"讲得非常好，有条不紊，温文尔雅","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429224,"discussion_content":"哎呀作者害羞了😁","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542362530,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39765,"user_name":"ajlidue","can_delete":false,"product_type":"c1","uid":1308376,"ip_address":"","ucode":"D6B29E941958E8","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er6NXib2NGaTAAEe2KCcibH2FiafOOD73kQdcuAMGrnRib5CDWXum0SWDOM9NnWicbUsDpghmxEmJtpk9w/132","comment_is_top":false,"comment_ctime":1542351962,"is_pvip":false,"replies":[{"id":"14277","content":"是你说的这样。<br><br>他们是在同一个执行流程里“按顺序执行”，这么交互的😄","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542354982,"ip_address":"","comment_id":39765,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10132286554","product_id":100020801,"comment_content":"老师，假如有一条sql要把c的值从0更新为1，如果已经记了redo log，但是还没有记binlog，这个时候MySQL崩掉了，恢复的时候，存储引擎发现记了redo log,但是没记binlog，存储引擎会把事务回滚，也就是数据库里记的值还是0。如果server记了binlog，但是还没来得及提交事务，那么crash recovery的时候会把这个事务提交，那么数据库里的值就是1。是这个样子的吗？还有一个问题就是，如果是这样子的，因为redo log是引擎层的，binlog是server层的，那么他们之间是怎么交互的？如果不是这样的，那mysql的crash recovery是怎么做的？","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429217,"discussion_content":"是你说的这样。\n\n他们是在同一个执行流程里“按顺序执行”，这么交互的😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542354982,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39625,"user_name":"涂涂的爸爸","can_delete":false,"product_type":"c1","uid":1302562,"ip_address":"","ucode":"FA95282B4DC698","user_header":"https://static001.geekbang.org/account/avatar/00/13/e0/22/18aa3672.jpg","comment_is_top":false,"comment_ctime":1542329411,"is_pvip":false,"replies":[{"id":"14220","content":"这个专栏这类会涉及比较少，这个专栏我们会更偏“业务应用 和 与应用相关的原理” binlog组提交太底层了，对开发几乎完全透明…","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542340767,"ip_address":"","comment_id":39625,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10132264003","product_id":100020801,"comment_content":"你好，这篇讲到了redo log 和binlog，后面会不会补充下bilog的组提交以及并发复制呢？感谢！","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429147,"discussion_content":"这个专栏这类会涉及比较少，这个专栏我们会更偏“业务应用 和 与应用相关的原理” binlog组提交太底层了，对开发几乎完全透明…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542340767,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39621,"user_name":"果然如此","can_delete":false,"product_type":"c1","uid":1210003,"ip_address":"","ucode":"C7543BD0A67505","user_header":"https://static001.geekbang.org/account/avatar/00/12/76/93/c78a132a.jpg","comment_is_top":false,"comment_ctime":1542329004,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10132263596","product_id":100020801,"comment_content":"一天一备份恢复的时候重放的时间更短。<br>有个问题：更新流程中，更新之前先返回这行数据，这里返回也是内存吧，这个内存和更新后写入的内存有什么区别？","like_count":2},{"had_liked":false,"id":39611,"user_name":"Jager","can_delete":false,"product_type":"c1","uid":1303364,"ip_address":"","ucode":"F0EC5EA91BF702","user_header":"https://static001.geekbang.org/account/avatar/00/13/e3/44/ecc6e5b5.jpg","comment_is_top":false,"comment_ctime":1542328334,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10132262926","product_id":100020801,"comment_content":"在频繁更新的场景下，binlog会非常大，这时候通过更高频率的备份就可以缩短binlog的保留时长，减少磁盘空间占用，另外就是在这种更新频繁的场景下，如果一周一次备份，恢复起来没有一天一个备份那么快，我想到的一个点，不知道有没有挨到边？","like_count":2},{"had_liked":false,"id":325881,"user_name":"青菜豆腐汤","can_delete":false,"product_type":"c1","uid":1640523,"ip_address":"","ucode":"437FFC94D8DA7A","user_header":"https://static001.geekbang.org/account/avatar/00/19/08/4b/2b038ac9.jpg","comment_is_top":false,"comment_ctime":1639210845,"is_pvip":false,"replies":[{"id":"118291","content":"这时候这条数据大概率数据还在内存里，直接从内存读到就返回了，不会涉及到磁盘读","user_name":"作者回复","user_name_real":"编辑","uid":"1264162","ctime":1639384944,"ip_address":"","comment_id":325881,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5934178141","product_id":100020801,"comment_content":"老师您好， 有个问题，我看评论区好像没人问。 <br>如果一个更新语句，写到存储引擎的redolog，而且状态是已提交，还没来得及同步到磁盘数据区。<br>这时，如果来一个查询，此条数据，是会查询出来的对吧。 那么这时候的查询流程是什么样子的，每次会先到redolog里查询下，有没有数据，因为redolog也是磁盘文件，这是效率会高吗？ ","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538255,"discussion_content":"这时候这条数据大概率数据还在内存里，直接从内存读到就返回了，不会涉及到磁盘读","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639384944,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312929,"user_name":"const","can_delete":false,"product_type":"c1","uid":1500149,"ip_address":"","ucode":"258BA2B11ED1B2","user_header":"https://static001.geekbang.org/account/avatar/00/16/e3/f5/f076b407.jpg","comment_is_top":false,"comment_ctime":1632126430,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5927093726","product_id":100020801,"comment_content":"redo log 用于保证 crash-safe 能力。innodb_flush_log_at_trx_commit 这个参数设置成 1 的时候，表示每次事务的 redo log 都直接持久化到磁盘。这个参数我建议你设置成 1，这样可以保证 MySQL 异常重启之后数据不丢失。<br><br>麻烦问一下，每次事务的redo log都持久化到磁盘上，实际上此时check_point会走到此次事务结束的点,  然后把这部分操作更新到磁盘上的ib_logfile..  和 ibd文件中吗？","like_count":1,"discussions":[{"author":{"id":1466982,"avatar":"https://static001.geekbang.org/account/avatar/00/16/62/66/8fe2a985.jpg","nickname":"mr_fujian","note":"","ucode":"0F9666FA81625D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573528,"discussion_content":"刷redlog file磁盘文件和数据文件磁盘是不同步的吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653473549,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1500149,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e3/f5/f076b407.jpg","nickname":"const","note":"","ucode":"258BA2B11ED1B2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":401270,"discussion_content":"偶然看到自己的提问，回答一下。\n如果上面那个参数是1 那么此时确实每次事务结束都会写到iblogfile和ibd文件内。其实我们可以去看文件的updatetime就可知道了。我认为其实还是checkpoint变动","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633616849,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312306,"user_name":"Z东","can_delete":false,"product_type":"c1","uid":1459774,"ip_address":"","ucode":"037B2BB2715DBA","user_header":"https://static001.geekbang.org/account/avatar/00/16/46/3e/8c75af6d.jpg","comment_is_top":false,"comment_ctime":1631723471,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5926690767","product_id":100020801,"comment_content":"看了一晚上的评论，学习了<br>binlog:  逻辑日志，归档日志,全量日志 作用于：数据恢复，备份，<br>redo log : 物理日志<br>crash  recovery  条件:  1，redo log   是commit 状态， 2， redo log   prepare , binlog 是完整的。其他情况的直接 rollback<br>crash  recovery 起点  check point  <br>执行流程：<br> redo log buffer -&gt; redo log（同步更新到内存）prepare -&gt; binlog cache -&gt; binlog -&gt; 修改 redo log  为 commit   -&gt; check point  写磁盘","like_count":1},{"had_liked":false,"id":308756,"user_name":"阿市","can_delete":false,"product_type":"c1","uid":1320234,"ip_address":"","ucode":"1DF2A71043A644","user_header":"https://static001.geekbang.org/account/avatar/00/14/25/2a/972a5881.jpg","comment_is_top":false,"comment_ctime":1629787794,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5924755090","product_id":100020801,"comment_content":"老师好，我想问，我再来说下自己的理解 。<br>1 prepare阶段 2 写binlog 3 commit<br>当在2之前崩溃时<br>重启恢复：后发现没有commit，回滚。备份恢复：没有binlog 。<br>一致<br>当在3之前崩溃<br>重启恢复：虽没有commit，但满足prepare和binlog完整，所以重启后会自动commit。备份：有binlog. 一致","like_count":1},{"had_liked":false,"id":303130,"user_name":"小小攻城狮","can_delete":false,"product_type":"c1","uid":1351564,"ip_address":"","ucode":"CDADAAB66C0EE7","user_header":"https://static001.geekbang.org/account/avatar/00/14/9f/8c/2cf8fd42.jpg","comment_is_top":false,"comment_ctime":1626603343,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5921570639","product_id":100020801,"comment_content":"影响数据的安全性和异常恢复速度","like_count":1},{"had_liked":false,"id":302781,"user_name":"Dobbykim","can_delete":false,"product_type":"c1","uid":1882279,"ip_address":"","ucode":"9CF18A328711F3","user_header":"https://static001.geekbang.org/account/avatar/00/1c/b8/a7/e2bae013.jpg","comment_is_top":false,"comment_ctime":1626360546,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5921327842","product_id":100020801,"comment_content":"老师，诚挚地问您一个问题，我想问一下，数据真正地被更新到磁盘中，这个过程是从 redo log file -&gt; 磁盘，还是从内存 （buffer pool ） 刷到磁盘呢？ ","like_count":1,"discussions":[{"author":{"id":1322622,"avatar":"https://static001.geekbang.org/account/avatar/00/14/2e/7e/bd3b2a08.jpg","nickname":"@","note":"","ucode":"1BF0CE3F3ED41E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579241,"discussion_content":"我觉得是内存。从内存修改，放到内存，然后刷到硬盘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657264705,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":281117,"user_name":"鲁大喵","can_delete":false,"product_type":"c1","uid":1093794,"ip_address":"","ucode":"BC880649611A08","user_header":"https://static001.geekbang.org/account/avatar/00/10/b0/a2/3757fc18.jpg","comment_is_top":false,"comment_ctime":1614587301,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5909554597","product_id":100020801,"comment_content":"binlog和redolog证明这里有个问题：文章只是通过反证法证明不使用二阶段会有不一致，但并不意味使用二阶段就可以保证一致。比如写binglog成功后还没有来得及调innodb引擎的commit，redolog仍处于prepare阶段，这时候MySQL重启后如何恢复呢？通过prepare的记录和去binlog中查询，如果有就自动commit，否则rollback？希望老师能讲讲重启恢复这部分内容。","like_count":1},{"had_liked":false,"id":278304,"user_name":"飞云","can_delete":false,"product_type":"c1","uid":1113175,"ip_address":"","ucode":"03C2EC2D0A5BE2","user_header":"https://static001.geekbang.org/account/avatar/00/10/fc/57/cf335b10.jpg","comment_is_top":false,"comment_ctime":1612864329,"is_pvip":false,"replies":[{"id":"101124","content":"再看看后面的章节吧~😆","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1612925870,"ip_address":"","comment_id":278304,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5907831625","product_id":100020801,"comment_content":"没有达到预期，原以为知识付费会有更加深刻的理解，有点失望","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":515342,"discussion_content":"再看看后面的章节吧~😆","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612925870,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":274985,"user_name":"我的喵","can_delete":false,"product_type":"c1","uid":1736650,"ip_address":"","ucode":"A7435BDBDD2587","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKyuuhxu0HH4cIKCClCqx0LTurCCYWmNcFwfTWV5te5afsibp2yuDmC9mibEHx0Xy8QlvqvMWWcAib8g/132","comment_is_top":false,"comment_ctime":1611241939,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5906209235","product_id":100020801,"comment_content":"打卡：<br>1.Redo Log属于InnoDb存储引擎层，而BinLog属于Mysql Server层。<br>2.Redo Log记录的是物理数据，直接映射到数据字段的变化，而Bin log属于逻辑日志，有两种格式，一种是sql，记录的就是sql,一种是row格式，直接记录了变更前后的数据内容。<br>3.Redo Log可以提供crash safe的能力，但因为其循环写无法提供归档能力。<br>4.Bin Log可以提供归档能力。","like_count":1},{"had_liked":false,"id":257205,"user_name":"Wheat","can_delete":false,"product_type":"c1","uid":1260141,"ip_address":"","ucode":"7D99EA149B6DE8","user_header":"https://static001.geekbang.org/account/avatar/00/13/3a/6d/910b2445.jpg","comment_is_top":false,"comment_ctime":1603880740,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5898848036","product_id":100020801,"comment_content":"那张update执行流程图是不是有问题？执行写操作时应该只会在change buffer中记录写操作，然后缓存到log buffer中，等到commit的时候将log buffer刷到redo log，这个过程是不会从磁盘读数据的","like_count":1},{"had_liked":false,"id":243105,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1597967762,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5892935058","product_id":100020801,"comment_content":"redo log 用于保证 crash-safe 能力。innodb_flush_log_at_trx_commit 这个参数设置成 1 的时候，表示每次事务的 redo log 都直接持久化到磁盘。这个参数我建议你设置成 1，这样可以保证 MySQL 异常重启之后数据不丢失。sync_binlog 这个参数设置成 1 的时候，表示每次事务的 binlog 都持久化到磁盘。这个参数我也建议你设置成 1，这样可以保证 MySQL 异常重启之后 binlog 不丢失。<br><br><br>从这段话看出了另外一层意思，redo log和binlog都是先写入内存buffer再落磁盘的","like_count":1,"discussions":[{"author":{"id":2351720,"avatar":"https://static001.geekbang.org/account/avatar/00/23/e2/68/ce547a12.jpg","nickname":"zjm1314","note":"","ucode":"63B0EAB7045054","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339699,"discussion_content":"redo log不就是文件么，为什么叫持久化磁盘？这个持久化磁盘是指数据写到表文件里？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609759286,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":233998,"user_name":"ಠ_ಠ再让我吃两口吧","can_delete":false,"product_type":"c1","uid":2039160,"ip_address":"","ucode":"D995966A0CA040","user_header":"https://static001.geekbang.org/account/avatar/00/1f/1d/78/d6fa54bd.jpg","comment_is_top":false,"comment_ctime":1594547868,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5889515164","product_id":100020801,"comment_content":"mysql的redolog和binlog是不是类似于redis持久化的rdb和aof日志啊？","like_count":1},{"had_liked":false,"id":224552,"user_name":"果果","can_delete":false,"product_type":"c1","uid":2027828,"ip_address":"","ucode":"458AC5EC0A8790","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f1/34/6978db6a.jpg","comment_is_top":false,"comment_ctime":1591440827,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5886408123","product_id":100020801,"comment_content":"这个我刚刚学完mysql基础增删改查语法，能看懂吗，还是先缓缓等以后再看？","like_count":1,"discussions":[{"author":{"id":1117208,"avatar":"https://static001.geekbang.org/account/avatar/00/11/0c/18/9233109e.jpg","nickname":"世界太小了","note":"","ucode":"48205078025482","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550161,"discussion_content":"估计不太懂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644399113,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":224192,"user_name":"wx","can_delete":false,"product_type":"c1","uid":1117803,"ip_address":"","ucode":"7AA8F0FEFD1128","user_header":"https://static001.geekbang.org/account/avatar/00/11/0e/6b/9ee9f422.jpg","comment_is_top":false,"comment_ctime":1591316072,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5886283368","product_id":100020801,"comment_content":"请教一下老师 有没有可能在server层记录binlog后，redo log   commit前MySQLcrash了，这时感觉也会出现数据不一致","like_count":1},{"had_liked":false,"id":185052,"user_name":"蛋炒饭加鸡蛋","can_delete":false,"product_type":"c1","uid":1628398,"ip_address":"","ucode":"C75E27B9FB3336","user_header":"https://static001.geekbang.org/account/avatar/00/18/d8/ee/17f220b6.jpg","comment_is_top":false,"comment_ctime":1583473415,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5878440711","product_id":100020801,"comment_content":"老师，有一点不太理解，既然binlog也能写入磁盘，而且通过row格式也记录了更新前后的两条记录，那为什么数据库异常重启后不具备crash-safe能力呢","like_count":1,"discussions":[{"author":{"id":2308968,"avatar":"","nickname":"Geek_9789da","note":"","ucode":"6A4A182A7E2C6B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":326546,"discussion_content":"如果只有binlog的话，假如是先写binlog再提交事物，那么写入binlog成功了，提交事物失败了，此时当前这个数据库数据还是原来的状态，但是binlog多了一条，所以再同步从库的时候和主库数据就不一致了，所以binlog确实没有crash-safe的能力","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605615057,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":173664,"user_name":"伯力_双城子","can_delete":false,"product_type":"c1","uid":1119671,"ip_address":"","ucode":"09550C7D20986A","user_header":"https://static001.geekbang.org/account/avatar/00/11/15/b7/1dbe1539.jpg","comment_is_top":false,"comment_ctime":1579655560,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5874622856","product_id":100020801,"comment_content":"Day2. 日志系统:一条SQL更新语句是如何执行的<br>   ===学习感想<br>主要是更新语句在mysql中的执行过程。<br>**更新语句过分析器对查询缓存的影响<br>在整个mysql体系架构中的server层 sql语句经过连接层之后，就会经过分析器。分析器确诊这条更新语句没有词法和语法问题之后，就会清空和这个更新语句相关的表在查询缓存中的内容。<br>**对更新语句重要的日志<br>(1).redo log 属于innodb存储引擎层的日志。用来对更新语句的内容做物理日志记录。这样日志一旦mysql进程出现崩溃，可以用来再次进程启动的时候，通过读取redolog的内容还原磁盘应该更新的数据。 <br>这个日志是循环记录的。大小固定。这样redo log不能保持超过他自身大小的数据记录，所以一旦想备份的数据量超过该日志的大小，redo log是无法做到的。<br><br>(2).bin log 是服务层的日志。用来记录cud相关操作的逻辑日志。是跨存储引擎存在的。日志采用追加记录的方式来记录日志。如果需要对数据库进行备份，可以通过binlog来进行。<br><br>**redo log和binlog两阶段提交--保证两日志数据内容的一致性。<br>因为这两个日志本质上都是对数据变动之后的值做记录，所以 无论何种历史原因，是应该保证这两个日志的逻辑一致性。<br>因为innodb存储引擎出现在mysql之后，所以binlog仅仅完成保存工作就好了。<br>后出现的redolog就必须采取措施才能保证这俩日志内容逻辑上的一致性。所以 如果不考虑binlog 就直接单独存储redolog 就会因为某一个日志先做 然后出现宕机 导致后一个日志没写 从而出现进程重启 两份日志的内容不一致性。<br>所以 后出现的 redolog 采用两阶段提交来保证和binlog内容的一致。 <br>首先redolog会把状态修改成prepare状态。<br>然后binlog记录完成。<br>最后redolog再把状态修改成commit状态。<br><br>这两个日志不是最标准的两阶段提交，这是因为binlog是跨存储引擎的，所以不能单独为了innodb存储引擎的redolog日志内容一致  而把binlog也做成两阶段提交。所以 做成了上述变形的两阶段提交。--所以 只能在redolog里面同样记录binlog中的xid 来保证两个日志的一致性。<br><br>**分析如何两个日志在各种场景下保持一致性。<br>(1). redolog的prepare状态完成，mysql宕机。此时 mysql重启 发现redolog里面有xid但是状态prepare  去binlog没有查到xid  此时 redolog回滚 事务回滚。两个日志内容一致。<br>(2). redolog prepare完成写入  binlog也完成写入 但是 redolog commit没有记录 mysql宕机了。这时候mysql重启之后，检查binlog和redolog的xid都存在  说明xid相关的记录都已完成 事务会被提交 两个记录的log内容一致。","like_count":1},{"had_liked":false,"id":173022,"user_name":"Kkkoko","can_delete":false,"product_type":"c1","uid":1069583,"ip_address":"","ucode":"C36729C4659F60","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ8BIG7fdqVH3xs2o7yDGpbr9FuT93FVN98CC4cYdojcJamJrPS6q8ObOFQwDgbxygiaYaWnuMk0cw/132","comment_is_top":false,"comment_ctime":1579410903,"is_pvip":false,"replies":[{"id":"67124","content":"“一个是MySQL服务端，一个是存储引擎端” 对的 <br><br>“请问这个缓存和innodb的LRU list是不是两个东西。” 不是😆","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1579440610,"ip_address":"","comment_id":173022,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5874378199","product_id":100020801,"comment_content":"建议不要开启查询缓存，因为对表的修改会清除缓存。<br><br>请问这个缓存和innodb的LRU list是不是两个东西。<br><br>一个是MySQL服务端，一个是存储引擎端","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481931,"discussion_content":"“一个是MySQL服务端，一个是存储引擎端” 对的 \n\n“请问这个缓存和innodb的LRU list是不是两个东西。” 不是😆","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579440610,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":167619,"user_name":"while (1)等;","can_delete":false,"product_type":"c1","uid":1061991,"ip_address":"","ucode":"BAEC7258D65B69","user_header":"https://static001.geekbang.org/account/avatar/00/10/34/67/06a7f9be.jpg","comment_is_top":false,"comment_ctime":1577880611,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"5872847907","product_id":100020801,"comment_content":"用了一下午才刷完留言，不但解了惑，还更加深了理解！","like_count":1,"discussions":[{"author":{"id":2020865,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/d6/01/eaa50203.jpg","nickname":"zft","note":"","ucode":"74DEC5FBA610B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":276164,"discussion_content":"评论区干货不少","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590830923,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":157945,"user_name":"九九三十一","can_delete":false,"product_type":"c1","uid":1760996,"ip_address":"","ucode":"0281D5D8A2037C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJvOiamibTX2EbNRSQfZC8XcSWw7gTvsnicNaNaZ4m8yMicHmYsWIrPMYsrrhumVGIo7qTyccWOx7mZ6Q/132","comment_is_top":false,"comment_ctime":1575288130,"is_pvip":false,"replies":[{"id":"60521","content":"redo如果没有commit，那系统宕机恢复后，事务是会回滚的。<br>其实这样是没问题的。<br>因为还没有commit之前，你用别的线程去查，也查不到数据；<br>崩溃恢复后，也查不到数据。<br>这样就是一致的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1575291519,"ip_address":"","comment_id":157945,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5870255426","product_id":100020801,"comment_content":"不知道现在还能不能得到回复，我就是想问一下，两种交叉写的方式依然会出问题啊，假如redolog在没有commit的时候，系统宕机以后，回复的数据也还是不一样的啊","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476589,"discussion_content":"redo如果没有commit，那系统宕机恢复后，事务是会回滚的。\n其实这样是没问题的。\n因为还没有commit之前，你用别的线程去查，也查不到数据；\n崩溃恢复后，也查不到数据。\n这样就是一致的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575291519,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":150835,"user_name":"a...Z","can_delete":false,"product_type":"c1","uid":1293877,"ip_address":"","ucode":"5A5A44903785FD","user_header":"https://static001.geekbang.org/account/avatar/00/13/be/35/dd79037e.jpg","comment_is_top":false,"comment_ctime":1573615088,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5868582384","product_id":100020801,"comment_content":"老师你好: 问个问题  mysql的事务,执行一条事务的时候是先写redo log的redo  log buffer是吧,然后在commit的时候根据策略刷新到redo  log file和磁盘,但是这个过程中,crash了,这个时候没有写入redo  log file,但是binglog 写入了,但是事实上和这个事务是执行成功了的,在重启恢复数据的时候,发现redo log file没有这个事务的prepare状态,解决这个问题,就是在commit的时候优先根据策略将buffer中的flush到redo log file和磁盘才认为commit成功,","like_count":1},{"had_liked":false,"id":142205,"user_name":"峻铭","can_delete":false,"product_type":"c1","uid":1106202,"ip_address":"","ucode":"63AB23BADACA88","user_header":"https://static001.geekbang.org/account/avatar/00/10/e1/1a/20977779.jpg","comment_is_top":false,"comment_ctime":1571311419,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5866278715","product_id":100020801,"comment_content":"把redo log比喻成粉板，太生动了","like_count":1},{"had_liked":false,"id":128431,"user_name":"潘pan","can_delete":false,"product_type":"c1","uid":1500535,"ip_address":"","ucode":"5C7A04F1F79210","user_header":"","comment_is_top":false,"comment_ctime":1566879075,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5861846371","product_id":100020801,"comment_content":"我有个好奇的地方，如果redolog在 commit阶段没有写入失败，就是binlog写入成功，redo log prepare写入成功， 那么redo log事务要回滚， 而binlog阶段又是直接恢复，那么 数据不还是不一致吗","like_count":1,"discussions":[{"author":{"id":1044546,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/42/7728d4f5.jpg","nickname":"艿艿","note":"","ucode":"8F727AB7A7F6B2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":25634,"discussion_content":"不会。如果 binlog 成功。通过 binlog 可以恢复出 redolog prepare 为 commit ，在崩溃恢复的时候。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570543826,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1494921,"avatar":"https://static001.geekbang.org/account/avatar/00/16/cf/89/3796d969.jpg","nickname":"懒羊羊","note":"","ucode":"D0FF5CCC60874A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":12542,"discussion_content":"选一种方式去恢复吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568544163,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108829,"user_name":"路人佳","can_delete":false,"product_type":"c1","uid":1449346,"ip_address":"","ucode":"2E8E7B8A79B67E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIFvkUVWscC7rNIIDy79zKPafoYa5Myn3Am8M42Be6kHhCOsup58T88yl9Mm7jPlxaJKTYYP3tMiaQ/132","comment_is_top":false,"comment_ctime":1561894220,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5856861516","product_id":100020801,"comment_content":"这里所说的binlog追加写，那就是是无限的追加写吗？之前的都不会被清楚吗？什么情况或者条件下会清空一次？","like_count":1,"discussions":[{"author":{"id":1360250,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erFY9H3mxyTpZ9gxAmdeKic565hicicDZmv7cjswd8hdernmxib0chdQrlDNKUZQ8AticQCgDdgVEmJNuA/132","nickname":"牧鱼","note":"","ucode":"0EB8FDD7A4BB2E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":222588,"discussion_content":"参数控制binlog大小，超过这个大小就记录新文件","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586160200,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1073845,"avatar":"https://static001.geekbang.org/account/avatar/00/10/62/b5/4159fa05.jpg","nickname":"zhanyd","note":"","ucode":"4C994EE512A3C4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":168573,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581590679,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":101128,"user_name":"wYnne","can_delete":false,"product_type":"c1","uid":1160139,"ip_address":"","ucode":"A71150402841BC","user_header":"https://static001.geekbang.org/account/avatar/00/11/b3/cb/8c22ffcf.jpg","comment_is_top":false,"comment_ctime":1559722716,"is_pvip":false,"replies":[{"id":"36727","content":"顺序上是这一样的：<br>   数据库里面写日志，此时算事务提交；<br>   返回响应包给客户端；<br>   客户端收到响应包<br>   客户端解析响应包里面的affacted_rows，得到1.<br>所以没有你说的这种情况哈<br><br>好问题<br>","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1560040494,"ip_address":"","comment_id":101128,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5854690012","product_id":100020801,"comment_content":"老师你好 这是我二刷了<br><br>       我想问下这个程序是什么时候获取到返回值的呢 比如我update一条正常来说程序是返回1 是在commit之后获取到的吗？如果是commit之前返回给程序 然后crash了 会给用户带来错觉吧？<br><br>       期待老师的回复","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452815,"discussion_content":"顺序上是这一样的：\n   数据库里面写日志，此时算事务提交；\n   返回响应包给客户端；\n   客户端收到响应包\n   客户端解析响应包里面的affacted_rows，得到1.\n所以没有你说的这种情况哈\n\n好问题\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560040494,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":97175,"user_name":"蓑笠翁","can_delete":false,"product_type":"c1","uid":1209245,"ip_address":"","ucode":"DFC1CA1E21AEB0","user_header":"https://static001.geekbang.org/account/avatar/00/12/73/9d/d85bf2d3.jpg","comment_is_top":false,"comment_ctime":1558602062,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5853569358","product_id":100020801,"comment_content":"请教下，redo log 已处于prepare状态，binlog也成功写入，commit前崩溃，重启后会自动commit，那说明binlog也是直接由执行器写入磁盘而不先写入内存缓冲？ 此时commit的事务也是崩溃前在prepare状态下直接写入到磁盘的吗？(因为崩溃后内存数据全丢，redo log直接写磁盘不经过内存缓冲)","like_count":1},{"had_liked":false,"id":92895,"user_name":"Geek_2c1623","can_delete":false,"product_type":"c1","uid":1523416,"ip_address":"","ucode":"02F5C29C71F7D1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/hkzTTpS89YDu3h48blvYUmDjfBaRNPfkjbT9xlPAam2ye0txxINyrFvVVrOt4cNxAFkXu2hMpicH3I2u1bPmAbg/132","comment_is_top":false,"comment_ctime":1557362726,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5852330022","product_id":100020801,"comment_content":"老师请教个问题，记录日志的初衷是为了提升写入效率和容灾恢复。因为日志都是循序写，在传统机械硬盘时代，因为其寻道时间漫长所以效果很明显，但是现在是固态硬盘时代，定位数据本身就很快速，就提升效率方面来说，还有必要写日志吗？因为固态硬盘都有一定的擦写寿命，减少日志写消耗，能延迟固态硬盘寿命。","like_count":1},{"had_liked":false,"id":90788,"user_name":"正是那朵玫瑰","can_delete":false,"product_type":"c1","uid":1048261,"ip_address":"","ucode":"73D630B654573F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fe/c5/3467cf94.jpg","comment_is_top":false,"comment_ctime":1556644271,"is_pvip":false,"replies":[{"id":"32680","content":"你是用的statement格式的binlog还是row格式的？<br><br>如果是statement的，要看看这个表上有没有别的更新语句，我之前碰到一种是用别的条件update的<br><br>另外，表结构和这个语句对应的binlog格式发下看看、","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1556895675,"ip_address":"","comment_id":90788,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5851611567","product_id":100020801,"comment_content":"老师想咨询个问题：今天（2019-4-30）我们线上数据库出现一个诡异的事情，一张表这一天只插入了一条的数据，在binlog日志中找到了这条数据的插入和更新语句，字段playerId不为0，但是现在查询这条数据playerId却是0，但是在binlog日志里面没有找到任何更新这条语句的sql了？实在找不到问题所在了，老师觉得是哪方面的原因呢，望指点下，谢谢？","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448652,"discussion_content":"你是用的statement格式的binlog还是row格式的？\n\n如果是statement的，要看看这个表上有没有别的更新语句，我之前碰到一种是用别的条件update的\n\n另外，表结构和这个语句对应的binlog格式发下看看、","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556895675,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2145161,"avatar":"https://static001.geekbang.org/account/avatar/00/20/bb/89/84212151.jpg","nickname":"大圣","note":"","ucode":"0190AE6EF37168","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301654,"discussion_content":"更新时binlog可以关的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598599609,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78194,"user_name":"何轩","can_delete":false,"product_type":"c1","uid":1338107,"ip_address":"","ucode":"4F9BBB03AB3382","user_header":"https://static001.geekbang.org/account/avatar/00/14/6a/fb/1b4b7420.jpg","comment_is_top":false,"comment_ctime":1553090683,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5848057979","product_id":100020801,"comment_content":"老师，看了这篇文章以后有三个问题：<br>1、存储引擎中修改后的新数据什么时候由内存写回到磁盘对应的表数据上？<br>2、内存数据在redo log写prepare之前就已经更新了，此时该内存数据是否对其他线程可见？<br>3、如果遇到回滚时，内存和redo log以及bin log中的记录怎么处理？<br>","like_count":1},{"had_liked":false,"id":68366,"user_name":"巅","can_delete":false,"product_type":"c1","uid":1363244,"ip_address":"","ucode":"18239CFA501049","user_header":"https://static001.geekbang.org/account/avatar/00/14/cd/2c/a02a8372.jpg","comment_is_top":false,"comment_ctime":1550489311,"is_pvip":false,"replies":[{"id":"24272","content":"“此时我断开连接，这个事务应该是失败的。”<br><br>----这里有问题，此时你主动断开连接，这个事务就是“异常”，而不是“失败”<br><br>异常的事务，状态可能是提交，也可能是为提交，所以记录存在，是合理状态的一种。<br>好问题<br>","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1550539324,"ip_address":"","comment_id":68366,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5845456607","product_id":100020801,"comment_content":"老师你好，关于redo 和binlog写入完成<br>但是不commit的情况<br><br>此时我断开连接，这个事务应该是失败的。<br>按照上面的说法，恢复的时候binlog这一条记录存在了，所以这条记录应该存在。<br>这个观点有问题还是mysql的bug","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439648,"discussion_content":"“此时我断开连接，这个事务应该是失败的。”\n\n----这里有问题，此时你主动断开连接，这个事务就是“异常”，而不是“失败”\n\n异常的事务，状态可能是提交，也可能是为提交，所以记录存在，是合理状态的一种。\n好问题\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550539324,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61170,"user_name":"Geek_41d472","can_delete":false,"product_type":"c1","uid":1247965,"ip_address":"","ucode":"DEC2B6329460CF","user_header":"https://static001.geekbang.org/account/avatar/00/13/0a/dd/88fa7b52.jpg","comment_is_top":false,"comment_ctime":1547631156,"is_pvip":false,"replies":[{"id":"21782","content":"是这样的，<br>innodb_flush_log_at_trx_commit =1 的时候，才是确保redo log里的数据是持久化到磁盘的；<br><br>如果是innodb_flush_log_at_trx_commit=2， 其实只是“写到redo log文件，但是没有持久化(fsync)”","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547635576,"ip_address":"","comment_id":61170,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5842598452","product_id":100020801,"comment_content":"您好老师,下面这段话是不是矛盾了,希望老师帮忙解答下<br>既然redo log 本身就配置了一组4个文件,每个文件的大小是 1GB，那么这块“粉板”总共就可以记录 4GB 的操作,这个时候不是持久化到磁盘吗?<br>为什么还要设置<br>innodb_flush_log_at_trx_commit 这个参数设置成 1 的时候，表示每次事务的 redo log 都直接持久化到磁盘.","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436772,"discussion_content":"是这样的，\ninnodb_flush_log_at_trx_commit =1 的时候，才是确保redo log里的数据是持久化到磁盘的；\n\n如果是innodb_flush_log_at_trx_commit=2， 其实只是“写到redo log文件，但是没有持久化(fsync)”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547635576,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1629257,"avatar":"https://static001.geekbang.org/account/avatar/00/18/dc/49/43ae1627.jpg","nickname":"Ansyear","note":"","ucode":"489CE96852EA2C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":328230,"discussion_content":"这里的log file其实是OS buffer，并不是磁盘上的物理文件，这点很重要，就是翻译理解的问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606110243,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51842,"user_name":"焦虑症晚期","can_delete":false,"product_type":"c1","uid":1025175,"ip_address":"","ucode":"3D3E61562CC26F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a4/97/83e63e00.jpg","comment_is_top":false,"comment_ctime":1545269333,"is_pvip":false,"replies":[{"id":"18777","content":"会，数据同步到从库其实也是在从库做更新，相同逻辑","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545270828,"ip_address":"","comment_id":51842,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5840236629","product_id":100020801,"comment_content":"在一个表上有更新的时候，跟这个表有关的查询缓存会失效，所以这条语句就会把表 T 上所有缓存结果都清空。<br><br><br>如果做了主从，把所有的读操作都指到从库上进行，主库update表，从库同步更新表数据，这个时候从库会不会有清空查询缓存的操作？<br><br>","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433643,"discussion_content":"会，数据同步到从库其实也是在从库做更新，相同逻辑","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545270828,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50355,"user_name":"进阶的码农","can_delete":false,"product_type":"c1","uid":1017821,"ip_address":"","ucode":"D8991282640334","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/dd/4f53f95d.jpg","comment_is_top":false,"comment_ctime":1544961037,"is_pvip":false,"replies":[{"id":"18076","content":"这个是为了保证数据安全必须的成本，但是WAL还是有用的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544970597,"ip_address":"","comment_id":50355,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5839928333","product_id":100020801,"comment_content":"innodb_flush_log_at_trx_commit 和 sync_binlog 都设置成1，那么都是每个事务结束直接写磁盘，那是不是就浪费了WAL的作用，这样每一次的更新操作都需要写进磁盘，然后磁盘也要找到对应的那条记录，然后再更新，整个过程 IO 成本、查找成本都很高。","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432954,"discussion_content":"这个是为了保证数据安全必须的成本，但是WAL还是有用的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544970597,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2351720,"avatar":"https://static001.geekbang.org/account/avatar/00/23/e2/68/ce547a12.jpg","nickname":"zjm1314","note":"","ucode":"63B0EAB7045054","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339701,"discussion_content":"老师，那wal干什么用，在那种允许数据不一致情况的出现的业务上？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609759530,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48932,"user_name":"patient","can_delete":false,"product_type":"c1","uid":1101211,"ip_address":"","ucode":"B270F33DC89752","user_header":"https://static001.geekbang.org/account/avatar/00/10/cd/9b/451d8c08.jpg","comment_is_top":false,"comment_ctime":1544579366,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5839546662","product_id":100020801,"comment_content":"redolog使用两阶段提交，会不会出现一种情况：redolog完成了prepare, 并且binlol也成功了，在redolog 进行commit时失败？","like_count":1,"discussions":[{"author":{"id":1044546,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/42/7728d4f5.jpg","nickname":"艿艿","note":"","ucode":"8F727AB7A7F6B2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":25636,"discussion_content":"存在。此时在恢复的时候，因为 binlog 成功，而 redolog 为 prepare 的时候，认为成功。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1570543999,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46589,"user_name":"清凉薄荷糖","can_delete":false,"product_type":"c1","uid":1306125,"ip_address":"","ucode":"CDEA8E4D55F3DE","user_header":"https://static001.geekbang.org/account/avatar/00/13/ee/0d/892eb1bb.jpg","comment_is_top":false,"comment_ctime":1543941305,"is_pvip":false,"replies":[{"id":"16664","content":"Buffer pool中","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543973960,"ip_address":"","comment_id":46589,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5838908601","product_id":100020801,"comment_content":"具体来说，当有一条记录需要更新的时候，InnoDB 引擎就会先把记录写到 redo log（粉板）里面，并更新内存，这个时候更新就算完成了。同时，InnoDB 引擎会在适当的时候，将这个操作记录更新到磁盘里面，而这个更新往往是在系统比较空闲的时候做，这就像打烊以后掌柜做的事。<br>老师，这一段里提到的将这个操作疾苦更新到磁盘里，是从redo log刷新过去还是直接从buffer pool呢？","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431490,"discussion_content":"Buffer pool中","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543973960,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44412,"user_name":"scream","can_delete":false,"product_type":"c1","uid":1302732,"ip_address":"","ucode":"69236244A5D739","user_header":"https://static001.geekbang.org/account/avatar/00/13/e0/cc/011b163c.jpg","comment_is_top":false,"comment_ctime":1543423482,"is_pvip":false,"replies":[{"id":"15870","content":"是的，但是两阶段的逻辑没变😄","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543427778,"ip_address":"","comment_id":44412,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5838390778","product_id":100020801,"comment_content":"上面id为某·人的关于二阶段提交，也就是14&#47;15描述貌似有点问题，preper阶段是刷redo到磁盘，commit阶段才刷binlog到磁盘，根据淘宝同学提的建议，5.7.之后某一个版本后改到了只需要确保刷binlog之前刷redo(根据lsn判断)，不知道我描述的对不对，请老师确认下！","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430753,"discussion_content":"是的，但是两阶段的逻辑没变😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543427778,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43779,"user_name":"seafooler","can_delete":false,"product_type":"c1","uid":1040831,"ip_address":"","ucode":"F9603E3907711A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e1/bf/7b22efac.jpg","comment_is_top":false,"comment_ctime":1543293530,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"5838260826","product_id":100020801,"comment_content":"老师，您这个逻辑架构图是用什么工具画的啊？","like_count":1,"discussions":[{"author":{"id":1044546,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/42/7728d4f5.jpg","nickname":"艿艿","note":"","ucode":"8F727AB7A7F6B2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":25638,"discussion_content":"听说是 Ipad 画图画的。。手头没 iPad 飘过。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570544040,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1040831,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/e1/bf/7b22efac.jpg","nickname":"seafooler","note":"","ucode":"F9603E3907711A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1044546,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/42/7728d4f5.jpg","nickname":"艿艿","note":"","ucode":"8F727AB7A7F6B2","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":209441,"discussion_content":"多谢多谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584631261,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":25638,"ip_address":""},"score":209441,"extra":""}]},{"author":{"id":1118132,"avatar":"https://static001.geekbang.org/account/avatar/00/11/0f/b4/4eaf4fa2.jpg","nickname":"Syrup","note":"","ucode":"E8292C0B38228A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":12986,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568625525,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":41882,"user_name":"代小亮","can_delete":false,"product_type":"c1","uid":1178251,"ip_address":"","ucode":"14F14CF45DD298","user_header":"https://static001.geekbang.org/account/avatar/00/11/fa/8b/d7dd7cae.jpg","comment_is_top":false,"comment_ctime":1542866229,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5837833525","product_id":100020801,"comment_content":"老师，两阶段提交过程中，如果是在redo log prepare状态，binlog已经写到磁盘上之后，数据库crash了，重启之后，binlog和redo log 不是也不一样吗？","like_count":1},{"had_liked":false,"id":41309,"user_name":"乔良qiaoliang","can_delete":false,"product_type":"c1","uid":1075315,"ip_address":"","ucode":"DDE301B3DF57A8","user_header":"https://static001.geekbang.org/account/avatar/00/10/68/73/3cda533e.jpg","comment_is_top":false,"comment_ctime":1542765095,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5837732391","product_id":100020801,"comment_content":"&quot;先写日志在写磁盘&quot; 这里的是日志和磁盘是逻辑上的所指？ 日志（粉板）本身不也在磁盘上么？","like_count":1,"discussions":[{"author":{"id":1044546,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/42/7728d4f5.jpg","nickname":"艿艿","note":"","ucode":"8F727AB7A7F6B2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":25641,"discussion_content":"这里的磁盘，应该值得是磁盘里的数据文件。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1570544113,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":41075,"user_name":"Albert","can_delete":false,"product_type":"c1","uid":1117950,"ip_address":"","ucode":"2AB817D7A50691","user_header":"https://static001.geekbang.org/account/avatar/00/11/0e/fe/00a9b201.jpg","comment_is_top":false,"comment_ctime":1542721913,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5837689209","product_id":100020801,"comment_content":"请问redo log是写磁盘吗？如果是，那这种写字盘和把数据直接写到磁盘上，如果有什么区别？如果不是那怎么保证灾难发生之后可以重新恢复？谢谢！","like_count":1,"discussions":[{"author":{"id":1044546,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/42/7728d4f5.jpg","nickname":"艿艿","note":"","ucode":"8F727AB7A7F6B2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":25642,"discussion_content":"写 redolog 是顺序写。\n写数据是随机写。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570544166,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40834,"user_name":"鹏飞天下","can_delete":false,"product_type":"c1","uid":1101792,"ip_address":"","ucode":"EB9FFD9FE64A4C","user_header":"https://static001.geekbang.org/account/avatar/00/10/cf/e0/f6819d03.jpg","comment_is_top":false,"comment_ctime":1542680695,"is_pvip":false,"replies":[{"id":"14699","content":"不是，“打烊的时候”和“粉板记不下”的时候这类时机","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542684904,"ip_address":"","comment_id":40834,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5837647991","product_id":100020801,"comment_content":"默默的问一句，啥时候数据真正的落到磁盘，进去表中？？？是commit之后吗","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429624,"discussion_content":"不是，“打烊的时候”和“粉板记不下”的时候这类时机","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542684904,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40479,"user_name":"爱做梦的咸鱼","can_delete":false,"product_type":"c1","uid":1051256,"ip_address":"","ucode":"9D9642CF0752BB","user_header":"","comment_is_top":false,"comment_ctime":1542624736,"is_pvip":false,"replies":[{"id":"14615","content":"全是innodb表的话理论上是可以的，不过现在官方还没这么做","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542635025,"ip_address":"","comment_id":40479,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5837592032","product_id":100020801,"comment_content":"那redo log如果改成追加写是不是就可以持久化了呢，此时如果一直用innodb是否不需要binlog了","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429534,"discussion_content":"全是innodb表的话理论上是可以的，不过现在官方还没这么做","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542635025,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40163,"user_name":"橙子","can_delete":false,"product_type":"c1","uid":1303623,"ip_address":"","ucode":"019A02ADD2E9F1","user_header":"https://static001.geekbang.org/account/avatar/00/13/e4/47/d6469ffa.jpg","comment_is_top":false,"comment_ctime":1542532856,"is_pvip":false,"replies":[{"id":"14473","content":"一开始没这么设计，实际上现在的binlog也不够，奔溃恢复需要日志和引擎内存状态配合的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542543997,"ip_address":"","comment_id":40163,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5837500152","product_id":100020801,"comment_content":"弱弱地问一句：老师，为什么binlog没有crash-safe的能力呢？不是写磁盘了吗？可以在重启后把宕机前的binlog中记录下来的异常事务sql语句执行一遍？<br>","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429402,"discussion_content":"一开始没这么设计，实际上现在的binlog也不够，奔溃恢复需要日志和引擎内存状态配合的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542543997,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549790,"discussion_content":"Mark，理解作者的意思是，崩溃恢复时光有日志不够，还要有引擎的内存状态","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644241278,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40156,"user_name":"信信","can_delete":false,"product_type":"c1","uid":1303865,"ip_address":"","ucode":"8DF0EC045579FD","user_header":"https://static001.geekbang.org/account/avatar/00/13/e5/39/951f89c8.jpg","comment_is_top":false,"comment_ctime":1542530063,"is_pvip":false,"replies":[{"id":"14474","content":"是这样的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542544026,"ip_address":"","comment_id":40156,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5837497359","product_id":100020801,"comment_content":"老师介绍了不用两阶段提交引发的不一致的的问题，但是没详细介绍用了两阶段提交，具体怎样工作的。看资料说是，崩溃恢复时，处于prepare 的事务会去查binlog ，如果有就继续提交事务，然后会去补充相应的redo log 。还有一点说的是prepare 标志记录在undo  log ，请老师指正。","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429399,"discussion_content":"是这样的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542544026,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40131,"user_name":"早起的鸟儿","can_delete":false,"product_type":"c1","uid":1083332,"ip_address":"","ucode":"EDB4C51C379EE0","user_header":"https://static001.geekbang.org/account/avatar/00/10/87/c4/50c8a490.jpg","comment_is_top":false,"comment_ctime":1542513611,"is_pvip":false,"replies":[{"id":"14423","content":"10万辆一起发的话就是要求10万的TPS，估计只能拆了…","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542521329,"ip_address":"","comment_id":40131,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5837480907","product_id":100020801,"comment_content":"老师你好，请教您一个问题，是实际工作中遇到的，就是在大数据量高并发情况下，如何保证实时表数据的无延时更新？具体场景是在车联网的一个项目里，车辆每30s上报一次数据，共有将近20万辆车，通过网关采集到这些数据后，经过解析器处理再入库，hbase和mysql各写一份，hbase作为历史数据存储库，mysql作为实时数据存储库，这些实时数据首先被垂直拆分成了将近十张表，然后每次有新数据上报都是直接根据车辆唯一vin码进行更新，使用replace语法，模拟测试的时候10万辆车就出现消息堆积和延时了，mysql是部署在32核128g的云服务器上，做了主备。","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429389,"discussion_content":"10万辆一起发的话就是要求10万的TPS，估计只能拆了…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542521329,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40056,"user_name":"Jason 彭","can_delete":false,"product_type":"c1","uid":1048658,"ip_address":"","ucode":"EF46202D6FA77A","user_header":"https://static001.geekbang.org/account/avatar/00/10/00/52/d1a1d0ab.jpg","comment_is_top":false,"comment_ctime":1542457163,"is_pvip":false,"replies":[{"id":"14401","content":"这个是外部备份系统的工作","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542469790,"ip_address":"","comment_id":40056,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5837424459","product_id":100020801,"comment_content":"影响的是RPO，一个是一天，一个是七天。请问老师，这个问题中，备份周期的设置是通过什么实现的？","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429353,"discussion_content":"这个是外部备份系统的工作","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542469790,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40048,"user_name":"kali","can_delete":false,"product_type":"c1","uid":1042714,"ip_address":"","ucode":"7159F913A83016","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/1NMAMj2T81BGLJhsnJ7IZL9BeP6LoX6ajukkTKficABoStaE6mAFHBibRQ3HiaG3VNJibVtqQy5m9RMibGfic62yibd7g/132","comment_is_top":false,"comment_ctime":1542455009,"is_pvip":false,"replies":[{"id":"14407","content":"1. InnoDB内部管理<br>2. 是<br>3. 这个我补充到答疑文章里面哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542471082,"ip_address":"","comment_id":40048,"utype":1}],"discussion_count":1,"race_medal":1,"score":"5837422305","product_id":100020801,"comment_content":"1:取Id=2这行，是怎么知道这一行属于哪一个数据页的？<br>2:redo是记录某个数据页内容的变化？<br>3:binlog在row格式时，一直不明白是怎么记录的","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429352,"discussion_content":"1. InnoDB内部管理\n2. 是\n3. 这个我补充到答疑文章里面哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542471082,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40028,"user_name":"娃哈哈","can_delete":false,"product_type":"c1","uid":1313301,"ip_address":"","ucode":"A36BA630B08D79","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epAKpagz3cHb1wfAhhWWjk4LtJtUOBG33Q9l1snibfA0lGXcjQQdzJF2sxiakZPhJ7FWEP1ERVLyjAQ/132","comment_is_top":false,"comment_ctime":1542445663,"is_pvip":false,"replies":[{"id":"14409","content":"客户端肯定是收不到了， 但是还是会commit","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542472071,"ip_address":"","comment_id":40028,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5837412959","product_id":100020801,"comment_content":"如果多个并发修改都未提交时，数据库崩溃了，这个时候有多个redolog的prepare和binlog的记录已经完成，但是还没有提交，这时重启后会怎么操作呢？innodb会通过binlog和prepare成对，然后去commit吗？那客户端会收到事务完成的通知吗？","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429337,"discussion_content":"客户端肯定是收不到了， 但是还是会commit","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542472071,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40015,"user_name":"Easy","can_delete":false,"product_type":"c1","uid":1069928,"ip_address":"","ucode":"36C7BA253EB3A8","user_header":"https://static001.geekbang.org/account/avatar/00/10/53/68/a29c3543.jpg","comment_is_top":false,"comment_ctime":1542442053,"is_pvip":false,"replies":[{"id":"14406","content":"更新在binlog里面有记录，用mysqlbinlog工具可以，仅限更新语句","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542470720,"ip_address":"","comment_id":40015,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5837409349","product_id":100020801,"comment_content":"有没有这样的命令dump日志得到查询历史SQL语句？","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429331,"discussion_content":"更新在binlog里面有记录，用mysqlbinlog工具可以，仅限更新语句","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542470720,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40014,"user_name":"张双星","can_delete":false,"product_type":"c1","uid":1268873,"ip_address":"","ucode":"8F3A9E74DAFACD","user_header":"https://static001.geekbang.org/account/avatar/00/13/5c/89/f7fff085.jpg","comment_is_top":false,"comment_ctime":1542441609,"is_pvip":false,"replies":[{"id":"14410","content":"这个其实也是一种做法，不会大家用的更多的还是直接找个备库再全量备一次","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542472123,"ip_address":"","comment_id":40014,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5837408905","product_id":100020801,"comment_content":"我想问下，定时备份也是通过执行当前时间到上一次备份时间之间的binlog来完成的吗？","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429330,"discussion_content":"这个其实也是一种做法，不会大家用的更多的还是直接找个备库再全量备一次","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542472123,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39821,"user_name":"守着云开","can_delete":false,"product_type":"c1","uid":1183885,"ip_address":"","ucode":"22220485396D0D","user_header":"https://static001.geekbang.org/account/avatar/00/12/10/8d/43edb2dd.jpg","comment_is_top":false,"comment_ctime":1542361308,"is_pvip":false,"replies":[{"id":"14301","content":"对","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542364449,"ip_address":"","comment_id":39821,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5837328604","product_id":100020801,"comment_content":"binlog里面有了 崩溃恢复的时候 redolog就会认可这个事务 这与binlog用于恢复数据的目的一致  可以这样理解吧","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429240,"discussion_content":"对","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542364449,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39809,"user_name":"©w©","can_delete":false,"product_type":"c1","uid":1309234,"ip_address":"","ucode":"D803AA9137B13C","user_header":"https://static001.geekbang.org/account/avatar/00/13/fa/32/04056740.jpg","comment_is_top":false,"comment_ctime":1542360401,"is_pvip":false,"replies":[{"id":"14283","content":"一开始就是从头了，中间如果有重启，也从重启前的位置继续。 <br><br>移动就是向右，到末尾循环；<br><br>移动多少 取决于事务要写下多少的日志","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542360899,"ip_address":"","comment_id":39809,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5837327697","product_id":100020801,"comment_content":"有個疑問: pos和checkpoint的位置一開始是怎麼確定的呢?checkpoint什麼時候移動呢?應該怎麼移動?移動多少？","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429235,"discussion_content":"一开始就是从头了，中间如果有重启，也从重启前的位置继续。 \n\n移动就是向右，到末尾循环；\n\n移动多少 取决于事务要写下多少的日志","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542360899,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39799,"user_name":"似水流年","can_delete":false,"product_type":"c1","uid":1304443,"ip_address":"","ucode":"D114A8E273133C","user_header":"https://static001.geekbang.org/account/avatar/00/13/e7/7b/71da8283.jpg","comment_is_top":false,"comment_ctime":1542358074,"is_pvip":false,"replies":[{"id":"14292","content":"expire_logs_days<br>默认是0 表示不自动删除；非零的话，单位是天","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542362449,"ip_address":"","comment_id":39799,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5837325370","product_id":100020801,"comment_content":"binlog感觉像oracle的归档日志，那么也有设置binlog日期的参数，这个参数是？默认值又是多少？","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429229,"discussion_content":"expire_logs_days\n默认是0 表示不自动删除；非零的话，单位是天","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542362449,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39766,"user_name":"ghostfevil","can_delete":false,"product_type":"c1","uid":1184888,"ip_address":"","ucode":"E7355B2D81C4FE","user_header":"","comment_is_top":false,"comment_ctime":1542352150,"is_pvip":false,"replies":[{"id":"14275","content":"这个专栏不太会讲源码，会讲原理+实践","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542354834,"ip_address":"","comment_id":39766,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5837319446","product_id":100020801,"comment_content":"老师能讲的时候讲讲源码吗","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429218,"discussion_content":"这个专栏不太会讲源码，会讲原理+实践","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542354834,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1044546,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/42/7728d4f5.jpg","nickname":"艿艿","note":"","ucode":"8F727AB7A7F6B2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":25643,"discussion_content":"期待老师来套源码解析 T T ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1570544205,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39706,"user_name":"安小依","can_delete":false,"product_type":"c1","uid":1101660,"ip_address":"","ucode":"A5C414C7B994FF","user_header":"https://static001.geekbang.org/account/avatar/00/10/cf/5c/d4e19eb6.jpg","comment_is_top":false,"comment_ctime":1542337880,"is_pvip":false,"replies":[{"id":"14233","content":"必须等commit完成后","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542341966,"ip_address":"","comment_id":39706,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5837305176","product_id":100020801,"comment_content":"更新完内存以后，mysql 会直接返回给客户端吗？还是说会等待 commit 成功才返回","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429187,"discussion_content":"必须等commit完成后","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542341966,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":549787,"discussion_content":"为什么更新内存在prepare阶段做?为什么不等到commit以后再更新内存?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644240183,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":429187,"ip_address":""},"score":549787,"extra":""}]}]},{"had_liked":false,"id":39682,"user_name":"_yiunia##远","can_delete":false,"product_type":"c1","uid":1138369,"ip_address":"","ucode":"AF508C3D0EB954","user_header":"https://static001.geekbang.org/account/avatar/00/11/5e/c1/cd721d46.jpg","comment_is_top":false,"comment_ctime":1542335423,"is_pvip":false,"replies":[{"id":"14193","content":"恐怕是innodb buffet pool发挥的作用😄","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542336837,"ip_address":"","comment_id":39682,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5837302719","product_id":100020801,"comment_content":"&quot;前面我们说过，在一个表上有更新的时候，跟这个表有关的查询缓存会失效，所以这条语句就会把表 T 上所有缓存结果都清空。&quot; 感觉不准确。。MySQL5.6开启缓存，第一次查询时间很长，第二次查询命中缓存时间很短，随意修改一行updated 时间，再次查询时间仍然很短。何解？","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429176,"discussion_content":"恐怕是innodb buffet pool发挥的作用😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542336837,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549786,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644239947,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39628,"user_name":"Linuxer","can_delete":false,"product_type":"c1","uid":1153978,"ip_address":"","ucode":"272D9D8089C3D6","user_header":"https://static001.geekbang.org/account/avatar/00/11/9b/ba/333b59e5.jpg","comment_is_top":false,"comment_ctime":1542329624,"is_pvip":false,"replies":[{"id":"14203","content":"崩溃恢复过程不写binlog了，用binlog恢复实例（或搭建备库）的时候，是会写redolog的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542337597,"ip_address":"","comment_id":39628,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5837296920","product_id":100020801,"comment_content":"请问用redolog恢复时还写binlog吗？反之呢？","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429148,"discussion_content":"崩溃恢复过程不写binlog了，用binlog恢复实例（或搭建备库）的时候，是会写redolog的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542337597,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549785,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644239899,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39576,"user_name":"Justin","can_delete":false,"product_type":"c1","uid":1305601,"ip_address":"","ucode":"D49723FEA66731","user_header":"https://static001.geekbang.org/account/avatar/00/13/ec/01/978d54af.jpg","comment_is_top":false,"comment_ctime":1542325839,"is_pvip":false,"replies":[{"id":"14243","content":"可以在线程里面单独设置 是否使用binlog, 也可以单独设置binlog格式，前提是要有super权限","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542343056,"ip_address":"","comment_id":39576,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5837293135","product_id":100020801,"comment_content":"老师 我有一个问题 比如因为删表等操作需要回滚，但不希望数据库执行binlog中全部的语句 比如说删除语句不执行的话 可以通过自己手动筛选数据库执行的binlog类型吗？还是必须都要执行呢？","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429123,"discussion_content":"可以在线程里面单独设置 是否使用binlog, 也可以单独设置binlog格式，前提是要有super权限","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542343056,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39569,"user_name":"angeltails","can_delete":false,"product_type":"c1","uid":1237257,"ip_address":"","ucode":"75AFEA43BB9BEB","user_header":"https://wx.qlogo.cn/mmopen/vi_32/ZP5xhL8zv874pBibuLof7bzkZpD6k5dW6wdqpdRncH8O82KAtEGRG8ResUibabVcogd4CfTaDBPM9KprGbPLtcDg/132","comment_is_top":false,"comment_ctime":1542324741,"is_pvip":false,"replies":[{"id":"14247","content":"看一下置顶评论哦","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542344109,"ip_address":"","comment_id":39569,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5837292037","product_id":100020801,"comment_content":"redo log 是记录记录这个数据改动后的值<br>而bin log 是记录这个数据是如何改动的这样吗？","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429119,"discussion_content":"看一下置顶评论哦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542344109,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39545,"user_name":"动脉","can_delete":false,"product_type":"c1","uid":1185978,"ip_address":"","ucode":"1F1A4E1F8FD1E0","user_header":"https://static001.geekbang.org/account/avatar/00/12/18/ba/b7194745.jpg","comment_is_top":false,"comment_ctime":1542299816,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5837267112","product_id":100020801,"comment_content":"真好","like_count":1},{"had_liked":false,"id":359820,"user_name":"恶魔果实","can_delete":false,"product_type":"c1","uid":1962297,"ip_address":"广东","ucode":"691CD833C984AC","user_header":"https://static001.geekbang.org/account/avatar/00/1d/f1/39/b0960780.jpg","comment_is_top":false,"comment_ctime":1665933426,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1665933426","product_id":100020801,"comment_content":"宕机了数据不是存在磁盘里面吗？<br>这里是数据恢复指的是什么？磁盘数据丢失吗？","like_count":0},{"had_liked":false,"id":359443,"user_name":"Geek_53bccf","can_delete":false,"product_type":"c1","uid":1481179,"ip_address":"上海","ucode":"1818C97E5D1CCC","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/UfqEYrR3cQXUhPEibnXD3kPSc8f0ibR4bdz6JnibjOBibfcxWrkVlz4iaCAAutOSotiaP2ROYX5esYfhAB3vj4avnYqQ/132","comment_is_top":false,"comment_ctime":1665545985,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1665545985","product_id":100020801,"comment_content":"老师你好，我对mysql的redo log的日子有点不明白的时候, redo log,它在mysql中相当于一个缓冲的概念,更多是让我们的更新效率更快,所有的跟新操作都先放到redo log中,在系统空闲的时候,在将redo log数据同步到磁盘中。如果我把同步的机制配置成每次写完redo log日志，必须同步磁盘文件,那么性能是不是非常差啊。而且redo log最大的作用是,崩溃恢复，就是mysql异常重启后，根据redo log日志数据可以进行数据恢复。如果你不每次同步到磁盘文件中,那么会导致数据库异常的时候，数据丢失的。但是每次同步的话,失去了redo log 作为缓冲区的作用了。老师我的理解对不对啊。要是不对，请你指出 谢谢。在日常开发中,这个同步的操作大部分是不是都是配置成,每次写完redo log 就立马同步磁盘文件啊。","like_count":0},{"had_liked":false,"id":359095,"user_name":"高程","can_delete":false,"product_type":"c1","uid":1202083,"ip_address":"北京","ucode":"BA8C7622992ABD","user_header":"https://static001.geekbang.org/account/avatar/00/12/57/a3/d2e9a4ab.jpg","comment_is_top":false,"comment_ctime":1665231816,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1665231816","product_id":100020801,"comment_content":"那会不会redo log处在prepare，binlog写成功时，mysql crash了。这时redo log和binlog是不是也没有办法完全保证一致呀？","like_count":0},{"had_liked":false,"id":358769,"user_name":"kk","can_delete":false,"product_type":"c1","uid":1182067,"ip_address":"广东","ucode":"BADB6FF2E659C1","user_header":"https://static001.geekbang.org/account/avatar/00/12/09/73/b85b3808.jpg","comment_is_top":false,"comment_ctime":1664715564,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1664715564","product_id":100020801,"comment_content":"两阶段提交是怎么解决问题的,redo log prepare了,binlog 写完了但是crash了,没来得及提交redo log就不是commited状态。这种情况是怎么处理的","like_count":0},{"had_liked":false,"id":358697,"user_name":"程辰","can_delete":false,"product_type":"c1","uid":1869309,"ip_address":"上海","ucode":"38F83CBEB7096D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJph3WBjqpJ4XoIvjNEsFbLOFah3icNoAHFpzdtRAU1TrmRfibUvXWRwlxZc2scN6gOyziahVIkqsjqw/132","comment_is_top":false,"comment_ctime":1664593592,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1664593592","product_id":100020801,"comment_content":"老师，如果redo log已经prepare的了，binlog也记了，然后断电了，这时候重启后怎么处理？","like_count":0},{"had_liked":false,"id":358516,"user_name":"Geek_62f574","can_delete":false,"product_type":"c1","uid":3037526,"ip_address":"广东","ucode":"2D9BB320C459B2","user_header":"","comment_is_top":false,"comment_ctime":1664381095,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1664381095","product_id":100020801,"comment_content":"老师，您好，我有个问题没有想明白，redo log的checkpoint的移动和内存页刷到物理磁盘这两个动作是否要保持原子性。我想了一下两种情况：<br>1.  脏页先写盘   a.内存写入磁盘在前，b. 移动checkpoint，那如果b之前crush了，重启后磁盘数据会被多redo一遍。<br>2. 先更新checkpoint，a. 更新checkpoint  b.刷脏页到磁盘；如果b之前crush了，那重启后脏页的内容就无法恢复了。<br>不知道我是不是漏了哪个点，麻烦您帮忙解答一下，谢谢。","like_count":0},{"had_liked":false,"id":357226,"user_name":"Geek_f0895f","can_delete":false,"product_type":"c1","uid":3178901,"ip_address":"上海","ucode":"1F7F5F598B9A2C","user_header":"","comment_is_top":false,"comment_ctime":1663078666,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1663078666","product_id":100020801,"comment_content":"数据量比较大的情况下，比如银行的每天的账务流水，可以每天一备，","like_count":0},{"had_liked":false,"id":357196,"user_name":"fx","can_delete":false,"product_type":"c1","uid":2334235,"ip_address":"浙江","ucode":"CA9066014707F3","user_header":"https://static001.geekbang.org/account/avatar/00/23/9e/1b/7abfa59f.jpg","comment_is_top":false,"comment_ctime":1663057715,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1663057715","product_id":100020801,"comment_content":"这里能否把undolog也一起带入讲下啊","like_count":0},{"had_liked":false,"id":356866,"user_name":"工具效能团队","can_delete":false,"product_type":"c1","uid":3012001,"ip_address":"广东","ucode":"4AF064B36AC6C9","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIRIylibB23ia0RFbJJdicEHMHpaL7lNlZZh9ZK3yrCZnlOWiaGCLbMiblRkKwsEvW6G0BTFN0B6lz9ljg/132","comment_is_top":false,"comment_ctime":1662652595,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1662652595","product_id":100020801,"comment_content":"大佬好，看过文章和评论列表后有几个疑惑点<br>1.有评论说去除binlog，单纯使用redolog，您回答说redolog记录不像binlog一样完整，redolog不是会缓冲区满了就会刷到磁盘吗，怎么会不完整呢，是因为缓冲区还存在未提交但是正常的事务吗。还有binlog写日志失败会回滚数据，本身也不会记录日志，这样用于数据库恢复感觉也没什么问题呀。<br>第一点总结：1)单纯使用binlog感觉没问题呀，也能做数据恢复<br>2.看评论和您的回复总结是，数据库自己宕机恢复使用redo，人为恢复数据使用binlog，是这样吗","like_count":0},{"had_liked":false,"id":356306,"user_name":"Geek_817205","can_delete":false,"product_type":"c1","uid":3168527,"ip_address":"广东","ucode":"F1FD315969AAE4","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/eian5Yx7AsnXiaHIfk264xicSath1o1C4HOVFM4XtUHS02cn4dp7ahq9fUejGEE653vYguS6SVRyFbCdz60GjaBWQ/132","comment_is_top":false,"comment_ctime":1662122942,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1662122942","product_id":100020801,"comment_content":"也就是说，redolog就像那个磁盘一样，在存在触发条件的情况下，就会将改变刷到磁盘数据中，而redolog的大小只有那么大，满了就会擦除。binlog则是满了会重起文件进行写入吗？<br>","like_count":0},{"had_liked":false,"id":356245,"user_name":"月明风清","can_delete":false,"product_type":"c1","uid":2226367,"ip_address":"河南","ucode":"65A97CF2E320FA","user_header":"https://static001.geekbang.org/account/avatar/00/21/f8/bf/59f2e600.jpg","comment_is_top":false,"comment_ctime":1662083699,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1662083699","product_id":100020801,"comment_content":"Redo Log 日志是ib_logfile0、ib_logfile1这样的文件，如何查看这个文件的具体内容呢，看了日志文件估计很多疑惑就能够解决了。","like_count":0},{"had_liked":false,"id":356152,"user_name":"Geek_817205","can_delete":false,"product_type":"c1","uid":3168527,"ip_address":"广东","ucode":"F1FD315969AAE4","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/eian5Yx7AsnXiaHIfk264xicSath1o1C4HOVFM4XtUHS02cn4dp7ahq9fUejGEE653vYguS6SVRyFbCdz60GjaBWQ/132","comment_is_top":false,"comment_ctime":1662014714,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1662014714","product_id":100020801,"comment_content":"按照我的理解，在研发MySQL的时候，设定binlog可以用于数据备份、数据恢复和主从复制。因为MyIASM引擎没有办法在实现crash-safe，所以才有了InnoDB引擎，出现了redolog。redolog的出现是为了更加精准的数据恢复。","like_count":0},{"had_liked":false,"id":356072,"user_name":"在路上","can_delete":false,"product_type":"c1","uid":1476245,"ip_address":"重庆","ucode":"2668A965FA79F2","user_header":"https://static001.geekbang.org/account/avatar/00/16/86/95/b9d960d9.jpg","comment_is_top":false,"comment_ctime":1661949719,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1661949719","product_id":100020801,"comment_content":"bin-log保存的是数据库的全量数据，恢复数据比较慢，业务需要响应快就需要备份周期短这样从bin-log中读取的操作记录少，业务恢复快","like_count":0},{"had_liked":false,"id":355717,"user_name":"Geek_8633c9","can_delete":false,"product_type":"c1","uid":2561108,"ip_address":"山东","ucode":"517B55CCFE7F0A","user_header":"","comment_is_top":false,"comment_ctime":1661684377,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1661684377","product_id":100020801,"comment_content":"取决于系统的重要性，当系统的数据很重要时，误操作会造成数据丢失和错误，所以一天一更在安全性上要比一周一更更具意义。","like_count":0},{"had_liked":false,"id":355501,"user_name":"Geek_1dcb72","can_delete":false,"product_type":"c1","uid":3163596,"ip_address":"浙江","ucode":"9C93391D762E56","user_header":"","comment_is_top":false,"comment_ctime":1661431087,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1661431087","product_id":100020801,"comment_content":"binlog 即使有数据，但恢复时候还是会看redo log是否commit。<br>那么上面的反证法，是不是举例不太恰当：<br>redolog没有prepare和commit状态 ，也可以用来恢复数据。如：只有当redo log和binlog都写入的操作才进行恢复","like_count":0},{"had_liked":false,"id":354395,"user_name":"Demogorgon","can_delete":false,"product_type":"c1","uid":1440667,"ip_address":"浙江","ucode":"BD553C5003D724","user_header":"https://static001.geekbang.org/account/avatar/00/15/fb/9b/c2ce045a.jpg","comment_is_top":false,"comment_ctime":1660358561,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1660358561","product_id":100020801,"comment_content":"\t并不是为了提升IO性能才设计的WAL。如果仅仅是为了提升性能，那为了WAL所采取的一系列措施也太得不偿失了。<br>\tWAL的出现是为了实现关系型数据库的原子性和持久性。实现原子性和持久性的最大困难是“写入磁盘”这个操作并不是原子性的，不仅有“写入”与“未写入”状态，还客观存在“正在写”的中间状态。<br>\t由于写入中间状态与崩溃都不可能消除，所以如果不做额外保障的话，将内存中的数据写入磁盘，并不能保证原子性与持久性。所以可能出现以下情形：<br>1：未提交事务，写入后崩溃（比如修改三个数据，程序还没修改完，但数据库已经将其中一个或两个数据的变动写入磁盘，此时出现崩溃）<br>2：已提交事务，写入前崩溃（程序已经修改完三个数据，但数据库还未将全部三个数据的变动都写入磁盘，此时出现崩溃）<br>\t由于写入中间状态与崩溃都是无法避免的，为了保证原子性和持久性，只能在崩溃恢复后采取补救措施，这种能力就被称为“崩溃恢复”。<br>\t为了能够实现崩溃恢复，采取了写日志的方式，写日志成功后再去写磁盘，这种事务实现方式被称为“提交日志（CommitLogging），目前阿里的OceanBase就采用这种方式，但是Commit Logging存在一个巨大缺陷：所有对数据的真实修改都必须发生在事务提交之后，即成功写入日志之后。在此之前，即使磁盘IO有足够的空闲，即使某个事务修改的数据量非常庞大，占用了大量的内存缓冲区，都不允许在事务提交前写入磁盘，因此这种方式对数据库性能的提升十分不利。<br>\t基于Commit Logging的问题就，提出了“提前写入日志”（Write-Ahead Logging）的日志改进方案，“提前写入”就是允许在事务提交之前写入变动数据的意思。而对于提前写入磁盘，在数据库崩溃后需要回滚的数据，给出的解决办法是增加另外一种被称为Undo Log的日志类型，当变动数据写入磁盘前，必须先记录Undo Log，以便在事务回滚或者崩溃恢复时根据Undo Log对提前写入的数据变动进行擦除。","like_count":0},{"had_liked":false,"id":354247,"user_name":"出云","can_delete":false,"product_type":"c1","uid":2974200,"ip_address":"湖南","ucode":"88EC2292532E88","user_header":"https://static001.geekbang.org/account/avatar/00/2d/61/f8/783896e3.jpg","comment_is_top":false,"comment_ctime":1660212440,"is_pvip":false,"discussion_count":0,"race_medal":2,"score":"1660212440","product_id":100020801,"comment_content":"内存中的数据页更改后会落入磁盘么，还是等清理redolog的时候物理数据页才会改变，我个人感觉内存里的改变不会直接落入磁盘哈","like_count":0},{"had_liked":false,"id":352259,"user_name":"2Years","can_delete":false,"product_type":"c1","uid":2633486,"ip_address":"","ucode":"9CC611009FCA4E","user_header":"https://static001.geekbang.org/account/avatar/00/28/2f/0e/d61a9a47.jpg","comment_is_top":false,"comment_ctime":1658485229,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1658485229","product_id":100020801,"comment_content":"老师我有个疑问：bin log 默认未开启，是不是就代表出现断电这种没办法恢复未提交的数据，会出现不一致的情况？并且删了数据没办法恢复<br><br>","like_count":0},{"had_liked":false,"id":351344,"user_name":"ants","can_delete":false,"product_type":"c1","uid":1223106,"ip_address":"","ucode":"5FAF7576F305DB","user_header":"https://static001.geekbang.org/account/avatar/00/12/a9/c2/f9fe5e90.jpg","comment_is_top":false,"comment_ctime":1657711528,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1657711528","product_id":100020801,"comment_content":"mttr","like_count":0},{"had_liked":false,"id":351066,"user_name":"瑶","can_delete":false,"product_type":"c1","uid":1304349,"ip_address":"","ucode":"E837D2A2D76B42","user_header":"https://static001.geekbang.org/account/avatar/00/13/e7/1d/f5eb2c85.jpg","comment_is_top":false,"comment_ctime":1657509121,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1657509121","product_id":100020801,"comment_content":"听了两遍第二章，我还是没懂redolog和binlog的区别？一般在我的工作中，如果恢复的话，我用到的就是全备+相对应时间的binglog，所以redolog到底是干什么用的呢？看来我还得再琢磨琢磨才行。","like_count":0},{"had_liked":false,"id":350737,"user_name":"丁龙","can_delete":false,"product_type":"c1","uid":2828786,"ip_address":"","ucode":"54C768AC8A0B5B","user_header":"https://static001.geekbang.org/account/avatar/00/2b/29/f2/4df6118e.jpg","comment_is_top":false,"comment_ctime":1657125977,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1657125977","product_id":100020801,"comment_content":"老师，有个问题，如果不按照两阶段提交的话，c的初始值为0，需要更新成1。比如说先写完binlog（将c由0更新成1），发生了crash，redolog没来的及写。在恢复时，c的值将恢复成1是吗？反过来的话，如果binlog没写完，而redolog写完了，因为binlog没有日志，而数据库中已经同步了redolog的日志信息，所以恢复出来也是1吗<br>","like_count":0},{"had_liked":false,"id":350016,"user_name":"柏强","can_delete":false,"product_type":"c1","uid":1969411,"ip_address":"","ucode":"A8A1D0ABBC0ABB","user_header":"","comment_is_top":false,"comment_ctime":1656506599,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1656506599","product_id":100020801,"comment_content":"为什么 binlog 没有 crash-safe 的能力？<br>我看上面介绍的恢复数据库到任何一秒的方法就是最近的备份数据加上binlog回放，完全没有redo-log什么事啊？！<br>我在网上看到有网友说 binlog 没有 redo-log 中checkpoint的概念，不能知道哪些日志的操作写到磁盘上了，所以不能用于恢复，可是既然是要恢复到特定时间(如 2022-06-29 14:00:00)，我就回放到这个时间点之前的日志不就行了吗？<br>至于文章中介绍的两阶段提交才能保证数据一致性的问题，这是只有两种日志并存才会存在的问题，如果，就只有 binlog ，不是就没有这个问题了吗？","like_count":0},{"had_liked":false,"id":349236,"user_name":"王思威","can_delete":false,"product_type":"c1","uid":2287524,"ip_address":"","ucode":"647765A8347D7E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIP2OtRibWAV13FsbKicLw8VUTHibwl4DD8tLq5CX0hmVdNv1b9o1XPUkmqtmN8w5G39GaiarxffyHgjg/132","comment_is_top":false,"comment_ctime":1655821065,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1655821065","product_id":100020801,"comment_content":"恢复机制和redis的备份机制是一样的，全量备份+增量，mysql是备份+binlog，redis是rdb快照+aof增量","like_count":0},{"had_liked":false,"id":349142,"user_name":"姜超","can_delete":false,"product_type":"c1","uid":1120395,"ip_address":"","ucode":"1622266500CE14","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ6Gia1LtqJmDBakeMqgdq2OXymy6AUbTKicjFrLwsia3As8aGDpib6ias7zMyxibUKAJ56LjV02LQMn1Nw/132","comment_is_top":false,"comment_ctime":1655773993,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1655773993","product_id":100020801,"comment_content":"如果在binlog写入中数据库发生崩溃，这后面该怎么处理…是通过什么样的机制知道各个阶段完成的呢","like_count":0},{"had_liked":false,"id":348126,"user_name":"徐小帅x","can_delete":false,"product_type":"c1","uid":2342515,"ip_address":"","ucode":"4B3131ED620296","user_header":"https://static001.geekbang.org/account/avatar/00/23/be/73/49613dcb.jpg","comment_is_top":false,"comment_ctime":1654762437,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1654762437","product_id":100020801,"comment_content":"老师，课程中讲的更新的SQL只是根据ID来更新一条数据，那一条更新多条数据SQL的执行流程是怎么样的？是跟上一节查询的流程那样的么，依次从引擎层获取到每一条满足条件的记录分别进行更新，还是一次性从引擎层将所有满足条件的数据取到SERVE层进行更新，更新完成后再一下全部写回引擎层的？","like_count":0},{"had_liked":false,"id":347445,"user_name":"木木三世","can_delete":false,"product_type":"c1","uid":1275770,"ip_address":"","ucode":"E47719FD6B47E3","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epPZTTZLENPereOG7GcHcsB8iaWm0lmo4o6hwxqibXuseWFWRMx0EZXvvXtN1iaKn8BVS8qkT4jkTo1g/132","comment_is_top":false,"comment_ctime":1654047375,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1654047375","product_id":100020801,"comment_content":"对于写操作十分频繁的大型分布式数据库，innodb_flush_log_at_trx_commit=1,sync_binlog=1是否可以优化？为了减少延迟并且保证数据安全，这两个参数可以怎么调？","like_count":0},{"had_liked":false,"id":347159,"user_name":"林贻民","can_delete":false,"product_type":"c1","uid":1202213,"ip_address":"","ucode":"F7185C61CAE4D0","user_header":"https://static001.geekbang.org/account/avatar/00/12/58/25/2088864b.jpg","comment_is_top":false,"comment_ctime":1653752965,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1653752965","product_id":100020801,"comment_content":"write pos和checkpoint会持久化吗？还是说MySQL重启的时候，会从头开始扫描全部的redo log文件，如果redo log设置为一组4个文件，每个文件1G，也就是要扫描4G的文件，这个成本也太大了，重启的时间会很长","like_count":0},{"had_liked":false,"id":347106,"user_name":"InfoQ_4e26bd8b8e0a","can_delete":false,"product_type":"c1","uid":2115036,"ip_address":"","ucode":"87BFCC8DBC0082","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIG9v88CtuQfOnvECccTAJSGic6KhsdQKhNKPNPIEcickDicWGqtMMP38AEa8qFotOicojFiazHmAzEr4g/132","comment_is_top":false,"comment_ctime":1653721744,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1653721744","product_id":100020801,"comment_content":"mysql所在的机器当机了&#47;重启了 redolog是不是就丢失了","like_count":0},{"had_liked":false,"id":346781,"user_name":"Geek_e0c36d","can_delete":false,"product_type":"c1","uid":1709425,"ip_address":"","ucode":"5FB004687DB2CB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/aM00uMFibmtMG9OcSiaB9HwRuRdRNUuMQibWNmmq7r33p7nibkY1CQbLicNYDufEjickLt82VQBtZ0BibrJ6X4RIer02A/132","comment_is_top":false,"comment_ctime":1653427186,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1653427186","product_id":100020801,"comment_content":"查询事务在两阶段提交扮演什么角色？<br>1、mysql默认为增删改每一条语句都开启事务；<br>2、设置回滚点；<br>3、mysql宕机后恢复，可以根据redo log 和 binlog 中的事务id 是否存在执行后续操作（不动或回滚或提交）；<br><br>老师，我还有漏掉什么吗？","like_count":0},{"had_liked":false,"id":346601,"user_name":"janey","can_delete":false,"product_type":"c1","uid":1227067,"ip_address":"","ucode":"0BD4BDB4EB2E94","user_header":"https://static001.geekbang.org/account/avatar/00/12/b9/3b/7224f3b8.jpg","comment_is_top":false,"comment_ctime":1653274732,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1653274732","product_id":100020801,"comment_content":"老师，有2个疑问：<br>前提：如果一个事务里有2个update,比如下面这样：<br>begin;<br>update T set c=c+1 where ID=2;<br>update T set c=c+1 where ID=3;<br>commit;<br>问题：<br>1.举例的场景都是针对单个insert来讲的， 那这2个update是在全部执行完成后才处理redo和binlog流程,还是每条语句执行完成后都走一遍上面说的redo和undo的流程。<br>或者第一个update时走mysql cache, 第二个update时执行mysql cache，并开始执行整个事务涉及的update相关fs page cache和fsync操作?<br>2.sync_binlog和innodb_flush_log_at_trx_commit的双1是指一个事务中的2个update都完成后的commit时sync吗？<br><br>重新翻阅了一下第2讲，第23讲和第15讲和评论区，没找出答案。课程已经比较久了，不知道还能不能得到解答，期待。<br>","like_count":0},{"had_liked":false,"id":345616,"user_name":"小海","can_delete":false,"product_type":"c1","uid":1359881,"ip_address":"","ucode":"22148B7E971ACB","user_header":"https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqqcz9HKr8r3kibiaxve9icIuz1qKv2PAhCr7tO6tjMVtsDa2VBIZZicfRxzXf1DDeEQTaM45JSLnGibdQ/132","comment_is_top":false,"comment_ctime":1652432480,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1652432480","product_id":100020801,"comment_content":"借楼请教个问题：<br>有一个同步方法，使用synchronized(*.class)加锁，内部逻辑为<br>1. Dao.delete()，根据条件删除数据，where条件未使用索引<br>2. Dao.count(*)，where条件无索引<br>2.Dao.batchSave()，向数据库插入20000条记录，具体执行时由于mybatis单次插入数据量太大会失败，因此batchSave()内部每500条执行一次批量插入。<br><br>当Controller层并发调用时，只有一个请求会获取synchronized锁，并操作数据库，但还是偶像现Dao.delete()死锁<br><br>show engine innodb status中并无DEAD LOCK相关信息<br><br>期待哪位大神指点下迷津<br>数据库为MySQL innodb引擎  RR隔离级别","like_count":0},{"had_liked":false,"id":345552,"user_name":"aha","can_delete":false,"product_type":"c1","uid":2243807,"ip_address":"","ucode":"D75CD8CF4B5D1E","user_header":"https://static001.geekbang.org/account/avatar/00/22/3c/df/9c9dc5c7.jpg","comment_is_top":false,"comment_ctime":1652376692,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1652376692","product_id":100020801,"comment_content":"这个&quot;二阶段提交&quot;，卡了自己好久，在这里说下理解：<br><br>问1：为什么redolog要拆分成两阶段提交？<br>答1：为了数据一致性<br>问2：不拆分不能保证吗？<br>答2：由于这有binlog和redolog分别由server和engine来写，总会存在一个写了一个还没写的情况，导致不一致<br>问3：为什么拆成两阶段能提升一致性？<br>答3：拆分不是重点，重点是拆分后，一方能够确认另一方的状态(有没有写成功)<br><br><br>MySql(有点像tcp三次握手的ack机制..)：<br>把redo log拆分成两阶段，<br>1. redo log 写完，成为prepare状态<br>2. 写 binlog<br>3. redo log 成为commit状态<br>假设1之后系统挂了重启，那么：<br>  engine: 自己只是prepare状态，不会恢复最后的命令<br>  server: binlog最后的输入没有记录，也不会恢复最后的命令<br>  最终：engin和server都丢弃最后的命令，数据一致<br>假设2之后系统挂了重启<br>  engine: redo已录最后一条命令<br>  server: 发现engine是prepare，则自动提交，把engin变成commit状态<br>  最终：engine和server都承认最后的命令，数据一致<br><br><br>脑洞一个新机制：可以把binlog的写入变成两阶段，redo log一阶段吗？（先写binlog，给他也整个状态)<br>1. binlog 写完，变成prepare状态<br>2. redo 写完<br>3. binlog 变为commit状态<br>假设1之后系统挂了重启，那么：<br>  engine: redolog没写，最后的执行的命令没有被物理写入<br>  server: 发现自己的binlog只在prepare状态，不会恢复最后一条命令<br>  最终：server和engin都扔掉了最后的一条命令，一致<br>假设2之后系统挂了重启，那么：<br>  engine：relog写了，发现binlog没有commit，但是有prepare，代表server层是有最后一条命令的记录的，此时把server层的prepare状态变成commit<br>  server: binlog 发现自己是commit状态(被engin改的), 恢复最后一条命令<br>  最终：一致，engine和server都承认了最后一条命令<br>  p.s. 这里engin发现server不在commit状态，选择丢掉最后的数据，server发现自己不在commit状态，也丢掉最后的输入命令是可以的；不过既然有机制恢复，当然是选择恢复~<br><br><br>如何选择binlog还是redolog去拆分二阶段呢？<br>这里取决于，server和engin谁能够去更改对方的状态(从prepare变成commit)<br>在mysql的实现中，肯定是engine暴露接口，让server有能力更改自己的状态(更底层的设施向上层提供接口，而不是反过来)，所以mysql的机制是redolog二阶段提交<br><br><br>综上，二阶段提交机制，让发生故障时，可以判断对方的状态，进而保证一致性<br><br><br>","like_count":0},{"had_liked":false,"id":345344,"user_name":"这就是网名","can_delete":false,"product_type":"c1","uid":2104089,"ip_address":"","ucode":"B39577B1602183","user_header":"https://static001.geekbang.org/account/avatar/00/20/1b/19/0d14cb36.jpg","comment_is_top":false,"comment_ctime":1652202030,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1652202030","product_id":100020801,"comment_content":"redo日志和binlog日志刷盘策略不一样时，两段提交还有意义吗，还是有可能导致在宕机时，其中一个日志比另一个日志多很多新的提交（因为持久化时机不同）","like_count":0},{"had_liked":false,"id":345089,"user_name":"穿裤子的云","can_delete":false,"product_type":"c1","uid":2181056,"ip_address":"","ucode":"C7193389F1BAC5","user_header":"","comment_is_top":false,"comment_ctime":1652013611,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1652013611","product_id":100020801,"comment_content":"老师，如果redo log处于prepare状态， binlog已写入磁盘，此时mysql异常重启了...... 因为redo log没有commit， 但是binlog已写盘，此时恢复数据时还能保证数据一致性嘛??","like_count":0},{"had_liked":false,"id":344992,"user_name":"KAKAROTS","can_delete":false,"product_type":"c1","uid":1495938,"ip_address":"","ucode":"34DEC1B8FC44CD","user_header":"https://static001.geekbang.org/account/avatar/00/16/d3/82/5c54e368.jpg","comment_is_top":false,"comment_ctime":1651916832,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1651916832","product_id":100020801,"comment_content":"有两个问题<br>1.在redo log写之前mysql重启，如何恢复数据?<br>2.文章中说到 redo log的刷盘是每次事物提交的时候刷的，那prepare状态的redo log还是在缓存中没有刷盘，这个时候binlog也写完了，正要提交事务时，mysql重启了，如何恢复数据?","like_count":0},{"had_liked":false,"id":343917,"user_name":"const","can_delete":false,"product_type":"c1","uid":1500149,"ip_address":"","ucode":"258BA2B11ED1B2","user_header":"https://static001.geekbang.org/account/avatar/00/16/e3/f5/f076b407.jpg","comment_is_top":false,"comment_ctime":1651117722,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1651117722","product_id":100020801,"comment_content":"redolog 同步到磁盘的时候，实际上会更新两个文件ibd文件和 ib_logfile.. 文件 . <br>更新时机就是此时实际上是check_point动了，只要它动了就会更新磁盘.<br>check_point什么时候动, 根据innodb_io_capacity(磁盘的读写速度咋样). 控制check_point移动.<br>write_pos只要更新就会移动.<br>不知道我的理解对不. ","like_count":0},{"had_liked":false,"id":343060,"user_name":"Geek_14d88e","can_delete":false,"product_type":"c1","uid":2985630,"ip_address":"","ucode":"ABD8F3A63E91F8","user_header":"","comment_is_top":false,"comment_ctime":1650613934,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1650613934","product_id":100020801,"comment_content":"请教下，两阶段提交为什么redo log需要commit阶段，在宕机重启后恢复数据时，需要判断redo log是否commit，并且有没有对应的bin log，有的话才恢复数据。那我为什么不可以直接提交prepare，然后事物提交时写bin log，在恢复时直接看bin log是否存在，bin log 是顺序读写的啊，io性能也不差吧，还能省去一次redo log的commit阶段的写。","like_count":0},{"had_liked":false,"id":342213,"user_name":"hao-kuai","can_delete":false,"product_type":"c1","uid":1272354,"ip_address":"","ucode":"DFDFDDDBA4503C","user_header":"https://static001.geekbang.org/account/avatar/00/13/6a/22/527904b2.jpg","comment_is_top":false,"comment_ctime":1650106543,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1650106543","product_id":100020801,"comment_content":"1. 更新操作会修改数据，所以需要记录操作过程<br>2.MYSQL 为了支持多种存在引擎和对外接口统一，将 server 和 存储引擎分开<br>3.然后二者各自有日志系统；server 层的叫逻辑日志binlog，存储引擎层叫物理日志 Redo log<br>4.为了保持通过日志恢复数据一致性，采用两阶段提交策略：即二者都写入成功了再提交","like_count":0},{"had_liked":false,"id":342152,"user_name":"取经人","can_delete":false,"product_type":"c1","uid":1107550,"ip_address":"","ucode":"C3668CA65200DF","user_header":"https://static001.geekbang.org/account/avatar/00/10/e6/5e/62158841.jpg","comment_is_top":false,"comment_ctime":1650071973,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1650071973","product_id":100020801,"comment_content":"3年后再来读，信息量依然很大","like_count":0},{"had_liked":false,"id":341800,"user_name":"程序员阿杜","can_delete":false,"product_type":"c1","uid":2717502,"ip_address":"","ucode":"701F330435A784","user_header":"https://static001.geekbang.org/account/avatar/00/29/77/3e/d89c0fff.jpg","comment_is_top":false,"comment_ctime":1649836331,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1649836331","product_id":100020801,"comment_content":"binlog 是server层的日志记录，两种模式可以存sql，也可以存前后数据行。不会丢失，内容是累加的<br>redolog 引擎层的，固定大小，物理上执行玩之后就会删除。","like_count":0},{"had_liked":false,"id":341542,"user_name":"再见理想","can_delete":false,"product_type":"c1","uid":1245999,"ip_address":"","ucode":"FAC88B3F6F6DFD","user_header":"https://static001.geekbang.org/account/avatar/00/13/03/2f/0a5e0751.jpg","comment_is_top":false,"comment_ctime":1649684741,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1649684741","product_id":100020801,"comment_content":"redo log 和 binlog 的区别<br>1，redo log 是innodb引擎特有的记录的物理日志，而binlog是mysql server层的，记录的逻辑日志 binlog的记录格式分为 row格式和 statement格式两种。<br>2，redo log是文件循环写有文件大小限制，而binlog是追加写。<br>redo log的刷盘时机：<br>1，当系统空闲时，<br>2，mysql实例即将关闭时。<br>3，redo log的 write-pos 追上 check-point时。<br>redo log使用的是 wal（write ahead logging）记录前先写日志，<br>1，将随机IO改为顺序IO。<br>2，为mysql提供crash-safe（故障恢复）的能力。<br>两阶段提交 （执行更新语句）<br>1，innodb将数据更新到内存，并将数据更改记录到redo log，将redolog置为prepare状态。将执行结果返回执行器，<br>2，执行器生成binlog并将binlog写入磁盘<br>3，执行器提交事务，将redo log改成commit状态。<br>数据库恢复：<br>1，首先恢复最近的数据库备份<br>2，从数据库备份时间开始重放binlog日志。<br>","like_count":0},{"had_liked":false,"id":340416,"user_name":"猕猴桃","can_delete":false,"product_type":"c1","uid":1131235,"ip_address":"","ucode":"005E562CC3A9A7","user_header":"https://static001.geekbang.org/account/avatar/00/11/42/e3/bf72015f.jpg","comment_is_top":false,"comment_ctime":1648806134,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1648806134","product_id":100020801,"comment_content":"我有一个问题，如果不使用redolog ，因为先记录了binlog ,  然后才提交到引擎层，如果此时crash ,依据binlog 进行修复，也并没有丢数据呀，继续将未完成的操作执行，会有什么问题呢","like_count":0},{"had_liked":false,"id":339904,"user_name":"威先森","can_delete":false,"product_type":"c1","uid":1687656,"ip_address":"","ucode":"5F445C6832274B","user_header":"https://static001.geekbang.org/account/avatar/00/19/c0/68/314e8306.jpg","comment_is_top":false,"comment_ctime":1648457286,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1648457286","product_id":100020801,"comment_content":"老师，innodb_flush_log_at_trx_commit设置为0时，redo log在记录时，会写进内存，而非直接持久化到磁盘吗？binlog是不是也是一样的道理？<br>","like_count":0},{"had_liked":false,"id":339773,"user_name":"woJA1wCgAAD6S7J1gdPcAQfOYguNUPaw","can_delete":false,"product_type":"c1","uid":2952716,"ip_address":"","ucode":"736C54F1FB4BF3","user_header":"","comment_is_top":false,"comment_ctime":1648373656,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1648373656","product_id":100020801,"comment_content":"可不可以这么理解，redo log日志，记录的直接保存到磁盘的，也就1变成2，而biglog日志则是记录sql，1怎么变成2的，有两个日志的原因是因为当数据库异常的时候，看用那个数据库恢复毕竟快，比较准确，但为了保证一致性，所以，两个日志要一起提交事物，就算恢复那个数据都是一样的","like_count":0},{"had_liked":false,"id":339704,"user_name":"Geek_457f47","can_delete":false,"product_type":"c1","uid":1443589,"ip_address":"","ucode":"B9EB1B46AA4D85","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/iamkqQRZFTAQgclRqskib3n860CStDuxq2aiaZO7EicDfLJwCdZ9gZiajhBoTNuFKH47DLKO5C4GHxukN5L1VOpcR6Q/132","comment_is_top":false,"comment_ctime":1648301609,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1648301609","product_id":100020801,"comment_content":"1.prepare 2,binlog 3,commit   如果最后一步这个事务回滚了，那这个时候redo-log就没有这个更新，但是binlog却多了一条语句，是不是不一致了呢","like_count":0},{"had_liked":false,"id":338877,"user_name":"剑八","can_delete":false,"product_type":"c1","uid":1297630,"ip_address":"","ucode":"0A09F41DB8A4E7","user_header":"https://static001.geekbang.org/account/avatar/00/13/cc/de/e28c01e1.jpg","comment_is_top":false,"comment_ctime":1647768982,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1647768982","product_id":100020801,"comment_content":"如果当前redo prepare阶段好了，然后挂了<br>这时候数据库恢复继续往下执行事务还是回滚事务，是由上层业务决定的？","like_count":0},{"had_liked":false,"id":338791,"user_name":"calvin","can_delete":false,"product_type":"c1","uid":2054188,"ip_address":"","ucode":"30F5D40748A5EF","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/bZ2icBkfjjsVtm88iaYPIaBs0icdze6IY7RlQEQlic7SQg5PW1CfWlMf0EtmuaYwBfaFetYOKCMSLcRicWHLmxRic5kg/132","comment_is_top":false,"comment_ctime":1647742502,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1647742502","product_id":100020801,"comment_content":"binlog写入成功后，事务回滚了，会怎样处理binlog","like_count":0},{"had_liked":false,"id":338067,"user_name":"Leo","can_delete":false,"product_type":"c1","uid":2649276,"ip_address":"","ucode":"CEBAD9CDCFC2A3","user_header":"https://static001.geekbang.org/account/avatar/00/28/6c/bc/f751786b.jpg","comment_is_top":false,"comment_ctime":1647265193,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1647265193","product_id":100020801,"comment_content":"binlog可以设置记录格式有两种：row &amp; statement后面章节会说到这两种不同模式有什么区别；","like_count":0},{"had_liked":false,"id":337977,"user_name":"cp","can_delete":false,"product_type":"c1","uid":2634906,"ip_address":"","ucode":"10DCEB5F041CB6","user_header":"https://static001.geekbang.org/account/avatar/00/28/34/9a/2fe8ec6f.jpg","comment_is_top":false,"comment_ctime":1647216355,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1647216355","product_id":100020801,"comment_content":"老师，当执行commit后，还没有写入磁盘，这是系统异常重启，数据会存入磁盘吗？","like_count":0},{"had_liked":false,"id":337328,"user_name":"阿u","can_delete":false,"product_type":"c1","uid":2368272,"ip_address":"","ucode":"C93BCC1578C08E","user_header":"https://static001.geekbang.org/account/avatar/00/24/23/10/eb58b3da.jpg","comment_is_top":false,"comment_ctime":1646755293,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1646755293","product_id":100020801,"comment_content":"如果在commit后，数据页没有落盘，怎么判断从 redo log 里面的什么地方开始恢复数据呢？ MySQL crash 后，怎么判断要恢复哪些数据？","like_count":0},{"had_liked":false,"id":337040,"user_name":"。。","can_delete":false,"product_type":"c1","uid":2853618,"ip_address":"","ucode":"A52A6043D27D87","user_header":"https://static001.geekbang.org/account/avatar/00/2b/8a/f2/6c6f7886.jpg","comment_is_top":false,"comment_ctime":1646563186,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646563186","product_id":100020801,"comment_content":"老师，由于只有 InnoDB 有 redo log，redo log 可以保证异常重启后，数据不丢失。那是否可以理解为如果使用 MyISAM、Memory，可能会出现数据丢失？","like_count":0},{"had_liked":false,"id":336661,"user_name":"怀揣梦想的学渣","can_delete":false,"product_type":"c1","uid":1916685,"ip_address":"","ucode":"2349B9F4F6FDE3","user_header":"https://static001.geekbang.org/account/avatar/00/1d/3f/0d/1e8dbb2c.jpg","comment_is_top":false,"comment_ctime":1646278093,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1646278093","product_id":100020801,"comment_content":"楼主，文中提到“checkpoint 是当前要擦除的位置”，是写满redo log后，开始写到磁盘并擦除redo log旧数据吗。","like_count":0},{"had_liked":false,"id":335656,"user_name":"伟","can_delete":false,"product_type":"c1","uid":2369399,"ip_address":"","ucode":"72C5C8D7F2A88F","user_header":"https://static001.geekbang.org/account/avatar/00/24/27/77/8493aa4a.jpg","comment_is_top":false,"comment_ctime":1645616127,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1645616127","product_id":100020801,"comment_content":"还是忍不住想说一句，INNODB由于要支持事物，所以用redo log来保证的一致性，而binlog是做不到这一点的","like_count":0},{"had_liked":false,"id":335624,"user_name":"叶涛","can_delete":false,"product_type":"c1","uid":2448277,"ip_address":"","ucode":"B45348979BE159","user_header":"https://static001.geekbang.org/account/avatar/00/25/5b/95/462890c6.jpg","comment_is_top":false,"comment_ctime":1645606544,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1645606544","product_id":100020801,"comment_content":"什么时候写入磁盘？还是没说。。。","like_count":0},{"had_liked":false,"id":335597,"user_name":"SharpBB","can_delete":false,"product_type":"c1","uid":2014573,"ip_address":"","ucode":"D30C5B798B8E8C","user_header":"https://static001.geekbang.org/account/avatar/00/1e/bd/6d/7010f98e.jpg","comment_is_top":false,"comment_ctime":1645600699,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1645600699","product_id":100020801,"comment_content":"一天一备感觉是需要对数据的一致性和苛刻的场景 如高并发的电商 金融等场景  一天一备是起码的","like_count":0},{"had_liked":false,"id":335387,"user_name":"Geek_6505ed","can_delete":false,"product_type":"c1","uid":2902027,"ip_address":"","ucode":"32D5F0C419AF58","user_header":"","comment_is_top":false,"comment_ctime":1645500035,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1645500035","product_id":100020801,"comment_content":"两阶段提交是如何保证redo log 和binlog的一致性的呢？","like_count":0},{"had_liked":false,"id":335176,"user_name":"Ray","can_delete":false,"product_type":"c1","uid":2046685,"ip_address":"","ucode":"37E86CE67F004B","user_header":"https://static001.geekbang.org/account/avatar/00/1f/3a/dd/e44bacb8.jpg","comment_is_top":false,"comment_ctime":1645372319,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1645372319","product_id":100020801,"comment_content":"是不是漏了关键的没说，为什么用二阶段提交，可以解决宕机丢数据的问题？能讲一下crash重启后，数据库如何从redo log和binlog恢复？","like_count":0},{"had_liked":false,"id":334834,"user_name":"章鱼哥","can_delete":false,"product_type":"c1","uid":1207198,"ip_address":"","ucode":"072E6BBDEFADB7","user_header":"https://static001.geekbang.org/account/avatar/00/12/6b/9e/82a4cbea.jpg","comment_is_top":false,"comment_ctime":1645150063,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1645150063","product_id":100020801,"comment_content":"不是很理解redo log是在内存还是在磁盘？如果在内存，断电一样会有丢失的风险.如果是写硬盘，那不是一样慢？","like_count":0},{"had_liked":false,"id":334663,"user_name":"泠然","can_delete":false,"product_type":"c1","uid":1642290,"ip_address":"","ucode":"E208DEFD75B9F4","user_header":"https://static001.geekbang.org/account/avatar/00/19/0f/32/8406e02d.jpg","comment_is_top":false,"comment_ctime":1645064323,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1645064323","product_id":100020801,"comment_content":"binlog有多大？？？","like_count":0},{"had_liked":false,"id":333287,"user_name":"团","can_delete":false,"product_type":"c1","uid":1113864,"ip_address":"","ucode":"D56ABBCE4E4D90","user_header":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","comment_is_top":false,"comment_ctime":1644246530,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1644246530","product_id":100020801,"comment_content":"具体的更新到内存中的数据是什么样的，日志清除时，怎么对数据进行相应操作还是不是很清楚，比如标记为prepare&#47;commit&#47;rollback的记录分别会怎么处理内存对应数据？回滚时binlog对应记录是怎么移除的？可能在后面章节会有吧，加快速度看。","like_count":0},{"had_liked":false,"id":333251,"user_name":"团","can_delete":false,"product_type":"c1","uid":1113864,"ip_address":"","ucode":"D56ABBCE4E4D90","user_header":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","comment_is_top":false,"comment_ctime":1644230872,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1644230872","product_id":100020801,"comment_content":"数据库重启后，怎么判断之前是否有crash呢？或者说怎么判断redo log中的记录对数据的修改是否已经都写磁盘了，或者从哪个点之后实际数据是丢失的？","like_count":0},{"had_liked":false,"id":332449,"user_name":"SamuraiDeng","can_delete":false,"product_type":"c1","uid":1203446,"ip_address":"","ucode":"928D78FCF5698E","user_header":"https://static001.geekbang.org/account/avatar/00/12/5c/f6/56d77359.jpg","comment_is_top":false,"comment_ctime":1643255456,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1643255456","product_id":100020801,"comment_content":"binlog 日志会小很多","like_count":0},{"had_liked":false,"id":332030,"user_name":"郁方林","can_delete":false,"product_type":"c1","uid":1130275,"ip_address":"","ucode":"8ABEAFDA815DDE","user_header":"https://static001.geekbang.org/account/avatar/00/11/3f/23/8ff389d2.jpg","comment_is_top":false,"comment_ctime":1642990543,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1642990543","product_id":100020801,"comment_content":"两阶段提交<br>1. 写入redolog，此时redolog处于prepare阶段<br>2. 写入binlog<br>3. 提交事务，更改redolog为commit阶段<br><br>异常发生时间：<br>&quot;步骤1&quot;：数据未写入redolog和binlog，重启后回滚<br>&quot;步骤2&quot;：数据写入redolog，但没有写入binlog，重启后回滚事务<br>&quot;步骤3&quot;：数据写入redolog和binlog，重启后提交事务<br><br># redo log 持久化到磁盘的参数 1表示每次事务的redo log都直接持久化到磁盘<br>show variables like &#39;innodb_flush_log_at_trx_commit&#39;;<br># binlog 持久化到磁盘的参数 1表示每次事务的binlog都直接持久化到磁盘<br>show variables like &#39;sync_binlog&#39;;","like_count":0},{"had_liked":false,"id":331841,"user_name":"zhoubo_eric","can_delete":false,"product_type":"c1","uid":1584208,"ip_address":"","ucode":"34725AA3A9D59C","user_header":"https://static001.geekbang.org/account/avatar/00/18/2c/50/64365ef7.jpg","comment_is_top":false,"comment_ctime":1642823134,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1642823134","product_id":100020801,"comment_content":"一天一备比一周一备优势 尤其在写入量或者频繁更新的场景下，binlog日志会产生的更多，一天一备恢复速度会更快，甚至不用备份的binlog即可，一般binlog最近一天的数据都会保存在本地 不会被清理 expire_log_days&gt;1","like_count":0},{"had_liked":false,"id":331240,"user_name":"冬瓜瓜","can_delete":false,"product_type":"c1","uid":1181599,"ip_address":"","ucode":"0EFB780C88F8D3","user_header":"https://static001.geekbang.org/account/avatar/00/12/07/9f/157ed758.jpg","comment_is_top":false,"comment_ctime":1642497905,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1642497905","product_id":100020801,"comment_content":"老师在描述update那5个步骤的时候，执行update的时候，最后还是让binlog写入磁盘（账本）了，那粉板的缓冲的功能体现在哪里呀？没搞懂。","like_count":0},{"had_liked":false,"id":330715,"user_name":"流线胖姑娘","can_delete":false,"product_type":"c1","uid":2875868,"ip_address":"","ucode":"1E1A88AECCD2CA","user_header":"https://static001.geekbang.org/account/avatar/00/2b/e1/dc/29245484.jpg","comment_is_top":false,"comment_ctime":1642130397,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1642130397","product_id":100020801,"comment_content":"老师您好，有个问题想请教您，就是，redolog buffer里面也是以block的形式存储的，刷盘也是以block为单位刷盘的，那么这时候block里还有其他还没提交的事务的redo log咋办?","like_count":0},{"had_liked":false,"id":329694,"user_name":"Daiver","can_delete":false,"product_type":"c1","uid":1466447,"ip_address":"","ucode":"9B1A03AFBC79BC","user_header":"https://static001.geekbang.org/account/avatar/00/16/60/4f/db0e62b3.jpg","comment_is_top":false,"comment_ctime":1641474636,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1641474636","product_id":100020801,"comment_content":"有个问题，redolog 在commit的时候mysql crash了，两种日志能保持逻辑一致吗","like_count":0},{"had_liked":false,"id":329693,"user_name":"aa轻松一刻","can_delete":false,"product_type":"c1","uid":1990735,"ip_address":"","ucode":"A3CE23EAE23626","user_header":"https://static001.geekbang.org/account/avatar/00/1e/60/4f/55985b31.jpg","comment_is_top":false,"comment_ctime":1641473865,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1641473865","product_id":100020801,"comment_content":"老师如果使用TRUNCATE命令清除表数据，有办法通过binlog恢复数据吗？","like_count":0},{"had_liked":false,"id":329382,"user_name":"不再是入门水平python的小宇","can_delete":false,"product_type":"c1","uid":2094450,"ip_address":"","ucode":"D49429660F2DC8","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/S5RFBwro1nY4aRN2WkE08G9HicMTz1WzFm1PuHgRMYLbtMA4SZI7A127muWUVAV2CSpCMmHB64g9Zy8a1kVmRcg/132","comment_is_top":false,"comment_ctime":1641308465,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1641308465","product_id":100020801,"comment_content":"懂了，好像又没懂，老师留的作业我不会做，接着学习吧。以前一直听人说binlog今天才算是真正了解是干嘛的","like_count":0},{"had_liked":false,"id":329069,"user_name":"吴文超","can_delete":false,"product_type":"c1","uid":2447595,"ip_address":"","ucode":"55EDC0EB95D493","user_header":"https://static001.geekbang.org/account/avatar/00/25/58/eb/fa1dd9ea.jpg","comment_is_top":false,"comment_ctime":1641093261,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1641093261","product_id":100020801,"comment_content":"恢复数据的时间","like_count":0},{"had_liked":false,"id":328783,"user_name":"let_me_go","can_delete":false,"product_type":"c1","uid":1510177,"ip_address":"","ucode":"A5936F5C5E3D65","user_header":"https://static001.geekbang.org/account/avatar/00/17/0b/21/f1aea35b.jpg","comment_is_top":false,"comment_ctime":1640879513,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1640879513","product_id":100020801,"comment_content":"可以这么理解逻辑日志redo log和物理日志bin log 吗？就像支付宝账单一样，你的余额从一千变成了五百，逻辑日志会记录每笔交易订单，记录你是怎么从一千变成了五百的，物理日志就只需要记录你现在是五百这个状态即可。","like_count":0},{"had_liked":false,"id":328480,"user_name":"杨丁","can_delete":false,"product_type":"c1","uid":1008597,"ip_address":"","ucode":"D469B0BCA86587","user_header":"https://static001.geekbang.org/account/avatar/00/0f/63/d5/a300899a.jpg","comment_is_top":false,"comment_ctime":1640749672,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1640749672","product_id":100020801,"comment_content":"内容总结：<br>1. Update流程和Select类似，会多redo log和binlog更新的逻辑<br>2. redo log是InnoDB引擎内部独有的，binlog是MySQL系统层的日志，作用于所有存储引擎<br>3. redo log是WAL的具体实现，用于保障事务的持久性，且能提升写入速度（redo log顺序写更快）<br>4. binlog用于“归档”，可基于binlog搭建新的MySQL节点，用于读写分离，备库<br>5. redo log和binlog通过“二阶段提交”保证两者数据的一致性，基于内部的XA机制实现<br>6. “二阶段提交”大致步骤为：redo log prepare，binlog 写入，redo log commit。崩溃恢复时，可根据redo log的状态+binlog是否完整写入，来决定是回滚还是提交<br><br>课后答案：一天一备与一周一备相对，它的数据恢复时间更短，影响的是系统的平均故障修复时间，继而影响系统的可用性和可靠性","like_count":0},{"had_liked":false,"id":327715,"user_name":"微光","can_delete":false,"product_type":"c1","uid":1372556,"ip_address":"","ucode":"023D7D3F637F4F","user_header":"https://static001.geekbang.org/account/avatar/00/14/f1/8c/754566c5.jpg","comment_is_top":false,"comment_ctime":1640248178,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1640248178","product_id":100020801,"comment_content":"笔记：<br>1、更新操作会通过查询的流程加载数据页到内存，然后取出具体数据行去修改<br>2、修改记录步骤：1、修改内存中的数据行；2、写入redo log（fsync时机取决于配置）；3、写入binlog（fsync时机取决于配置）<br>3、redo log和binlog通过两段式提交保证一致，写入步骤为：1、redo log prepare（fsync但事务未提交）；2、写入binlog（fsync）；3、redo log事务修改为已提交<br>4、redo log是循环写入，也就是空间有限；binlog是追加写入，空间限制取决于操作系统磁盘<br>","like_count":0},{"had_liked":false,"id":327509,"user_name":"一个无趣的俗人","can_delete":false,"product_type":"c1","uid":1691669,"ip_address":"","ucode":"25435088B10CA2","user_header":"https://static001.geekbang.org/account/avatar/00/19/d0/15/5851180d.jpg","comment_is_top":false,"comment_ctime":1640156941,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1640156941","product_id":100020801,"comment_content":"总结一下，回答几个问题：<br><br>1、为什么 MySQL 有了 binlog 还有 redo log？两者有什么不同？<br><br>2、两阶段提交是什么？有什么用？<br><br>4、既然 MySQL 崩溃恢复时可以接受“redolog prepare 并且binlog完整” 的情况，那两阶段提交的最后一步 “redolog commit”有什么意义？<br><br>5、简单讲讲 WAL 技术在更新操作时的作用和原理","like_count":0},{"had_liked":false,"id":326791,"user_name":"小兵","can_delete":false,"product_type":"c1","uid":1150486,"ip_address":"","ucode":"682674AE91FE68","user_header":"https://static001.geekbang.org/account/avatar/00/11/8e/16/7d97a36f.jpg","comment_is_top":false,"comment_ctime":1639701989,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1639701989","product_id":100020801,"comment_content":"一天一备数据库恢复时间会比一周一备小，如果出现故障时候，影响的就是故障恢复时间","like_count":0},{"had_liked":false,"id":326711,"user_name":"许劲松","can_delete":false,"product_type":"c1","uid":2574760,"ip_address":"","ucode":"1356B4C6CE852D","user_header":"https://static001.geekbang.org/account/avatar/00/27/49/a8/bae13c75.jpg","comment_is_top":false,"comment_ctime":1639641335,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1639641335","product_id":100020801,"comment_content":"好像mysql与oracle在这一块的机制是类似的，后者有什么归档日志（后来又演变了），概念上是restore(用全量备份）+recover(归档日志+undo）。这一块理解不难。  ","like_count":0},{"had_liked":false,"id":326710,"user_name":"许劲松","can_delete":false,"product_type":"c1","uid":2574760,"ip_address":"","ucode":"1356B4C6CE852D","user_header":"https://static001.geekbang.org/account/avatar/00/27/49/a8/bae13c75.jpg","comment_is_top":false,"comment_ctime":1639640935,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1639640935","product_id":100020801,"comment_content":"全量备份的频次越高，那么，理论上说，数据库恢复所需要的时间就越短。举例，如果数据库全量备份7天一次，那么，如果今天出事了，就要拿出7天以前的全量备份为基础，然后回放这7天以来的bin log；而如果是1天一次，那么，就可以取出昨天的全量备份为基础，回放昨天以后的bin log。","like_count":0},{"had_liked":false,"id":326101,"user_name":"很大的勇气","can_delete":false,"product_type":"c1","uid":1695608,"ip_address":"","ucode":"7871D1C1E22F3F","user_header":"https://static001.geekbang.org/account/avatar/00/19/df/78/d4946736.jpg","comment_is_top":false,"comment_ctime":1639379353,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1639379353","product_id":100020801,"comment_content":"老师，看文章和部分评论后，还有一点不清楚，望解答。<br>“执行器和 InnoDB 引擎在执行这个简单的 update 语句时的内部流程。”这个过程您分为5步。哪一步完成后，即使mysql崩溃了，恢复后这个事务还算数？ 谢谢！","like_count":0},{"had_liked":false,"id":325882,"user_name":"青菜豆腐汤","can_delete":false,"product_type":"c1","uid":1640523,"ip_address":"","ucode":"437FFC94D8DA7A","user_header":"https://static001.geekbang.org/account/avatar/00/19/08/4b/2b038ac9.jpg","comment_is_top":false,"comment_ctime":1639211108,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1639211108","product_id":100020801,"comment_content":"老师您好，有个疑问，没有人在评论区提问过。 <br>数据更新到redolog后，而且状态是已提交，还未来得及同步到磁盘数据区。<br>如果这是来一个查询，那么查询流程是什么样子的？<br> 每次会先到redolog查一下，再到数据区查吗？ 因为redolog也是磁盘文件，这样效率会高吗","like_count":0},{"had_liked":false,"id":325748,"user_name":"别惹年轻人","can_delete":false,"product_type":"c1","uid":1328102,"ip_address":"","ucode":"F02CE0AA709EED","user_header":"https://static001.geekbang.org/account/avatar/00/14/43/e6/99fd4bb9.jpg","comment_is_top":false,"comment_ctime":1639115814,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1639115814","product_id":100020801,"comment_content":"不对吧，2pc和binlog没有必然关系吧？2pc一个关键的点就是安全检查点，这个安全检查点是数据写入预写入日志(一阶段)，然后接着将数据写入磁盘(二阶段)。一阶段写入完成就算数据库崩溃也能二阶段也能保证提交。而binlog只是不同节点间数据同步的其中一种方式","like_count":0},{"had_liked":false,"id":325390,"user_name":"Geek_38cd4d","can_delete":false,"product_type":"c1","uid":2763747,"ip_address":"","ucode":"43BA12C6250D63","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epJDKDtO3oTNpFq0MA5cemfxWGXvicbPfUAZLP1jdWzkEUk5BPwQ2InBqCC4hgneIYhBQ7yzhKHYmA/132","comment_is_top":false,"comment_ctime":1638940666,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638940666","product_id":100020801,"comment_content":"有个矛盾的问题，1，redo log 可以reash safe，而binlog没有，即，前者可以在creash时候恢复，而后者不能，<br>2，那两阶段提交意义在哪，两阶段提交目的是两者要么都能恢复，要么都不能恢复，这不和之前1的作用矛盾了吗<br>我的理解，是不是说，redo log creash能力，是为了恢复没有落盘不完整的数据，两阶段提交的数据都是完整的数据，要保持一致的也是完整的数据，望各位帮忙解惑指正，谢谢","like_count":0},{"had_liked":false,"id":324841,"user_name":"小小","can_delete":false,"product_type":"c1","uid":1321715,"ip_address":"","ucode":"F75E2F68E7FB69","user_header":"https://static001.geekbang.org/account/avatar/00/14/2a/f3/4d712bfc.jpg","comment_is_top":false,"comment_ctime":1638677935,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638677935","product_id":100020801,"comment_content":"感谢老师。数据库CURD人员，看完文章才第一次清晰认识到这两个日志的区别。其次看评论的收获还是蛮大的。在我实在想不通问题的时候我觉得老师的举例还是很有启发性。因为innodb的cash-safe我们有了两个日志文件，也可以倒过来说我们为了获取高效性所以使用有cash-safe的引擎。为了做一致性恢复，必须要保证两份日志的一致性。怎么做呢？两阶段提交。","like_count":0},{"had_liked":false,"id":324609,"user_name":"wessonwang","can_delete":false,"product_type":"c1","uid":1000441,"ip_address":"","ucode":"A9BA5E3A3F278E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/43/f9/723ee153.jpg","comment_is_top":false,"comment_ctime":1638517131,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1638517131","product_id":100020801,"comment_content":"一般来说，核心系统的库，最好是一周一备，这样的话，binlog累积的少，回放的快，实现系统快速恢复。","like_count":0},{"had_liked":false,"id":324333,"user_name":"秋","can_delete":false,"product_type":"c1","uid":2842327,"ip_address":"","ucode":"4949614854B55F","user_header":"https://static001.geekbang.org/account/avatar/00/2b/5e/d7/14ab183a.jpg","comment_is_top":false,"comment_ctime":1638373577,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638373577","product_id":100020801,"comment_content":"mysql8以下的版本，如果开启了查询缓存，执行更新语句时是先到查询缓存查找，这时肯定查不到，然后接着分析器分析出这条语句是更新语句和更新的表，然后清空该表的查询缓存，是这样的吗？","like_count":0},{"had_liked":false,"id":324196,"user_name":"杨杨杨","can_delete":false,"product_type":"c1","uid":1214400,"ip_address":"","ucode":"6FF1927D51EDA2","user_header":"https://static001.geekbang.org/account/avatar/00/12/87/c0/94d35742.jpg","comment_is_top":false,"comment_ctime":1638333022,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638333022","product_id":100020801,"comment_content":"如果没有备份整库，只有binlog，误删表还能恢复吗？","like_count":0},{"had_liked":false,"id":324113,"user_name":"杨欢","can_delete":false,"product_type":"c1","uid":2857168,"ip_address":"","ucode":"0664E2D919A6E6","user_header":"https://static001.geekbang.org/account/avatar/00/2b/98/d0/1121f7b9.jpg","comment_is_top":false,"comment_ctime":1638314945,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638314945","product_id":100020801,"comment_content":"两阶段提交就是同时提交，是吗？但即使这样，也只能说降低日志不一致的可能性，也没法说他们一定一样？还是有什么机制在保证两个日志是一样的吗？","like_count":0},{"had_liked":false,"id":323687,"user_name":"LY","can_delete":false,"product_type":"c1","uid":1794879,"ip_address":"","ucode":"165C7C626C545F","user_header":"https://static001.geekbang.org/account/avatar/00/1b/63/3f/51b2a1f4.jpg","comment_is_top":false,"comment_ctime":1638095310,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638095310","product_id":100020801,"comment_content":"innodb_flush_log_at_trx_commit参数可以控制redolog落盘策略，如果该值设置为0，事务提交时redolog不一定会落盘，由mater thread每秒一次fsync刷盘，按照两阶段协议，如果redolog缓存中已经有记录和commit记录，并且binlog中也有记录并已落盘，此时数据库宕机，redolog中的缓存丢失，binlog中有记录，这种情况会怎么处理呢？","like_count":0},{"had_liked":false,"id":323485,"user_name":"LalexH","can_delete":false,"product_type":"c1","uid":2107804,"ip_address":"","ucode":"D35144BD4EB872","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ7VKDBDPfEML4J8gtSxTLv9f4kAdE46IC3leV4DS88HqZLj5dQOEicLTkJmkGV14KKruhP0Xv1jlA/132","comment_is_top":false,"comment_ctime":1637924826,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637924826","product_id":100020801,"comment_content":"MyISAM 没有 crash-safe 的能力，binlog 日志只能用于归档<br>关于这一句不是特别理解，既然redo log和binlog是数据一致性的，那么binlog记录成功也就保证了数据库在异常重启后，数据可以追回来，为什么说binlog没有crash-safe的能力了，有点不解？","like_count":0},{"had_liked":false,"id":322858,"user_name":"顾骨","can_delete":false,"product_type":"c1","uid":1131165,"ip_address":"","ucode":"3F6BA592AB7723","user_header":"https://static001.geekbang.org/account/avatar/00/11/42/9d/c36b7ef7.jpg","comment_is_top":false,"comment_ctime":1637635370,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1637635370","product_id":100020801,"comment_content":"思考题说的是 RPO: Recovery Point Objective 吗？","like_count":0},{"had_liked":false,"id":322746,"user_name":"卷神","can_delete":false,"product_type":"c1","uid":1606983,"ip_address":"","ucode":"0CA34A72908F1D","user_header":"https://static001.geekbang.org/account/avatar/00/18/85/47/ce792490.jpg","comment_is_top":false,"comment_ctime":1637573257,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637573257","product_id":100020801,"comment_content":"老师好，不知道现在提问还会不会回复，有个疑问<br>关于先写 redo log 后写 binlog的两个例子，原值是0，两个例子最终结果一个为0和1，为什么都说和原库值不一样？","like_count":0},{"had_liked":false,"id":322589,"user_name":"Geek_1c2bc7","can_delete":false,"product_type":"c1","uid":2294810,"ip_address":"","ucode":"121120235BCD6C","user_header":"http://thirdwx.qlogo.cn/mmopen/KFgDEHIEpnSYZZ72JU4vYRvRYLKiajhw8ddPRryVFddBLgHhLFSib9Rj7lHbuiaXxiaPiaRp6YXJCgXrdbeVA2qwh9ia5jUicgZJiclib/132","comment_is_top":false,"comment_ctime":1637490708,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637490708","product_id":100020801,"comment_content":"笔记总结：<br>redolog和binlog的区别和作用<br><br>redolog：innodb引擎自带的功能，用于存储数据还未更新到硬盘的内存位点，内部是一个环形数据结构，包含writePoint和checkPoint，当写入位点追上检查位点时，需要暂停写入，先更新数据到硬盘，并刷新checkPoint，然后写入位点才可以继续下移。<br>binlog：mysql的server模块自带的功能，一般先写入redolog后再生成这条记录的binlog<br><br>只有redolog没有binlog：无法根据全量备份进行数据恢复到数据库的指定的某一个时间状态，因为binlog属于每一条对mysql操作的归档日志，redolog只存储了一定时间段的数据<br>只有binlog没有redolog：对mysql硬盘的压力较大，因为需要频繁的对硬盘进行io操作<br><br>二阶段提交：先将数据写入内存再写入redolog，将该redolog的状态变更为prepare状态，然后在生成binlog写入硬盘，最后将redolog的状态改为commit状态<br><br>为何需要二阶段提交：<br>如果写入redolog后，mysql发生crash，那么该条记录就没有生成binlog，mysql恢复后，读取redolog将数据写入了硬盘，因此binlog的数据和mysql的实际数据不一致，也就是说备库和主库的数据发生不一致<br>如果先写入binlog，当mysql发生crash，那么redolog没有该条操作，那么binlog存储了变更后的数据，但是redolog并没有存，导致主库和从库的数据不一致，因此二阶段提交保证了主库和从库的一致性问题<br><br>为什么需要保证主库和从库的一致：当整个系统需要扩容，也就是说需要增加一些备库来增加读取能力时，就需要及时的使用一些已经用binlog备份好的备库","like_count":0},{"had_liked":false,"id":322457,"user_name":"肥宅困困(`･ω･`)","can_delete":false,"product_type":"c1","uid":1220083,"ip_address":"","ucode":"816474AC72A4FE","user_header":"https://static001.geekbang.org/account/avatar/00/12/9d/f3/c1cca9af.jpg","comment_is_top":false,"comment_ctime":1637398564,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637398564","product_id":100020801,"comment_content":"查阅了其他资料终于明白了binlog和redolog的区别和联系<br>Binlog用途：<br>1.归档备份，比如机器扩容增加备库的时候主从同步采用全量备份+binlog的模式。<br>无法实现crash safe（为了性能，Mysql的操作一般在内存中进行，没有redo log的存在，当机器崩溃后，内存的脏页丢了无法恢复）<br>RedoLog：<br>物理写，记录数据页发生的修改，当Mysql更新数据时，会同时更新内存数据页的数据和redo log。<br>redo log可用于崩溃恢复，机器崩溃重启后将redo log读进内存可使mysql数据恢复到崩溃前的状态。<br>恢复的条件：binlog完整性。首先redolog要存在记录（状态prepare 或 commit），其次binlog中要能找到该记录才视为数据是存在的。<br>redo log空间有限，满了之后需要将内存的脏页刷进磁盘，使内存和磁盘保持一致，才能开始写新的redo log。<br>","like_count":0},{"had_liked":false,"id":322202,"user_name":"Geek_be775f","can_delete":false,"product_type":"c1","uid":2848324,"ip_address":"","ucode":"B40A323802EA96","user_header":"","comment_is_top":false,"comment_ctime":1637232651,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637232651","product_id":100020801,"comment_content":"丁老师， 物理日志 redo log 和逻辑日志 binlog, 怎么去理解这个物理跟逻辑的区别呢？  还有，redo log什么时间写磁盘呢， 数据会不会有延时的问题呢？ ","like_count":0},{"had_liked":false,"id":321471,"user_name":"独行千万里","can_delete":false,"product_type":"c1","uid":1817418,"ip_address":"","ucode":"50577C0A2F7EF7","user_header":"https://static001.geekbang.org/account/avatar/00/1b/bb/4a/30477a9a.jpg","comment_is_top":false,"comment_ctime":1636893946,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636893946","product_id":100020801,"comment_content":"一天一备的优势：恢复数据库时，需要回放的binlog少，恢复速度快。对于更新频繁的数据库，一天一备更有优势。","like_count":0},{"had_liked":false,"id":321184,"user_name":"mark for luck","can_delete":false,"product_type":"c1","uid":1798114,"ip_address":"","ucode":"877AC961687A93","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/P7GtgVmSNibiaZY9ibCiaohicscwb03j1ROjJUqFkCOnkMQv5JQXZia56nmhOtxr2jOBUfMS94zsvXvnw7RbtpO0dJbQ/132","comment_is_top":false,"comment_ctime":1636702272,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636702272","product_id":100020801,"comment_content":"两个重要的日志模块，对于半个月内的数据库恢复非常有帮助<br>Redo log重做日志和 BinLog归档日志<br>Redo log <br>使用命令show variables like &#39;innodb_flush_log_at_trx_commit&#39;;查看参数是否为1，这样才能保证每次事务的redo log都持久化到磁盘，保证MySQL异常重启后数据不丢失。<br>Redo log属于引擎层，相当于《孔乙己》里面的粉板，有write pos记录当前位置，有check pos记录擦除位置。Inno DB中有redo log可以保证数据库发生异常重启，之前提交的记录不会丢失，实现crash safe功能。<br>Binlog<br>使用命令show variables like &#39;sync_binlog&#39;;查看参数是否为1，1时表示每次事务的binlog都持久化到磁盘，保证MySQL重启后binlog不丢失。<br>Binlog会记录所有的逻辑操作，并且是以追加写入的方式，是属于server层的自有日志。数据库能恢复半个月的数据，前提就是系统备份中有保存半个月的binlog。<br>思考题：前面我说到定期全量备份的周期“取决于系统重要性，有的是一天一备，有的是一周一备”。那么在什么场景下，一天一备会比一周一备更有优势呢？或者说，它影响了这个数据库系统的哪个指标？<br>一天一备份比一周已备份的优势是，最长的恢复时间更短；一周一备份要用到一个星期的binlog，这样会占用更多的存储空间。","like_count":0},{"had_liked":false,"id":321090,"user_name":"学海无涯","can_delete":false,"product_type":"c1","uid":1087418,"ip_address":"","ucode":"21602A26E9F7C0","user_header":"https://static001.geekbang.org/account/avatar/00/10/97/ba/9df87a24.jpg","comment_is_top":false,"comment_ctime":1636676179,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636676179","product_id":100020801,"comment_content":"老师，写内存和写redo log parpare，谁先谁后，我看您文中的两段表达，<br>段一：“InnoDB 引擎就会先把记录写到 redo log（粉板）里面，并更新内存，这个时候更新就算完成了。同时，InnoDB 引擎会在适当的时候，将这个操作记录更新到磁盘里面，” <br>段二：“引擎将这行新数据更新到内存中，同时将这个更新操作记录到 redo log 里面，此时 redo log 处于 prepare 状态。然后告知执行器执行完成了，随时可以提交事务。”<br>我看下来，没理解写内存和写redo log parpare，哪个先哪个后？","like_count":0},{"had_liked":false,"id":320492,"user_name":"menfre","can_delete":false,"product_type":"c1","uid":1925314,"ip_address":"","ucode":"D55E03C5F0217C","user_header":"https://static001.geekbang.org/account/avatar/00/1d/60/c2/ca220fd0.jpg","comment_is_top":false,"comment_ctime":1636353354,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636353354","product_id":100020801,"comment_content":"备份得越频繁，数据出事故后数据恢复得越快","like_count":0},{"had_liked":false,"id":320488,"user_name":"Allen","can_delete":false,"product_type":"c1","uid":1100387,"ip_address":"","ucode":"5B168A03809557","user_header":"https://static001.geekbang.org/account/avatar/00/10/ca/63/9be9ac89.jpg","comment_is_top":false,"comment_ctime":1636352264,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636352264","product_id":100020801,"comment_content":"两阶段提交: 先写redo-prepare，再写binlog，再commit redo<br>commit redo的时候不会因为其它redo的写如导致无法利用顺序io了吗?","like_count":0},{"had_liked":false,"id":320319,"user_name":"生如夏花","can_delete":false,"product_type":"c1","uid":1625148,"ip_address":"","ucode":"6336232A3946E4","user_header":"https://static001.geekbang.org/account/avatar/00/18/cc/3c/6ccdff77.jpg","comment_is_top":false,"comment_ctime":1636250438,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1636250438","product_id":100020801,"comment_content":"老师你好，我想问下用户提交后，也就是用户执行commit语句后，是在binlog写入成功后就给用户响应事务提交成功吗，如果是redolog commit阶段后才响应成功，那么在redolog commit前崩溃，那给用户的响应式事务提交失败，崩溃恢复后事务又自动提交了，此时在用户的角度上事务是失败的，但实际上事务是成功的，这样有问题吗","like_count":0},{"had_liked":false,"id":320136,"user_name":"Geek_13133f","can_delete":false,"product_type":"c1","uid":2835291,"ip_address":"","ucode":"9B4BFC0C654311","user_header":"","comment_is_top":false,"comment_ctime":1636095721,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636095721","product_id":100020801,"comment_content":"老师我有个疑问<br> 当redo log正在写或者reddo log已经落盘了，处于prepare状态，还没写binlog的时候奔溃了，服务恢复后<br>redo log是不完整的，这个时候不要还要通过undo log才能恢复吗，是不是可以理解为innodb的crash-safe能力需要redo log,undo log和binlog三者才能够保证？","like_count":0},{"had_liked":false,"id":319829,"user_name":"寥若晨星","can_delete":false,"product_type":"c1","uid":1447739,"ip_address":"","ucode":"2E87E43687DE72","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eou1BMETumU21ZI4yiaLenOMSibzkAgkw944npIpsJRicmdicxlVQcgibyoQ00rdGk9Htp1j0dM5CP2Fibw/132","comment_is_top":false,"comment_ctime":1635955557,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1635955557","product_id":100020801,"comment_content":"如果在写完binlog之后，redo log提交之前crash了那还不是会产生不一致的情况？","like_count":0},{"had_liked":false,"id":319710,"user_name":"小黄鸭","can_delete":false,"product_type":"c1","uid":2708370,"ip_address":"","ucode":"2800E3A723AEBD","user_header":"https://static001.geekbang.org/account/avatar/00/29/53/92/21c78176.jpg","comment_is_top":false,"comment_ctime":1635919124,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1635919124","product_id":100020801,"comment_content":"想问一下老师，这个redo log是否存在磁盘里呢？那不也是要IO吗？假如说不存在磁盘里，存在内存中，那为什么又说数据库异常重启也可以恢复呢，重启了内存中数据不是清空了吗？","like_count":0},{"had_liked":false,"id":319377,"user_name":"搭搭里满是糖","can_delete":false,"product_type":"c1","uid":2690105,"ip_address":"","ucode":"7FBEE6118380CC","user_header":"https://static001.geekbang.org/account/avatar/00/29/0c/39/d69bc473.jpg","comment_is_top":false,"comment_ctime":1635765825,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1635765825","product_id":100020801,"comment_content":"老师，请问redo log是怎么做crash-safe的？redo log是存在内存中吗，数据库崩溃的话，内存数据岂不是也会丢失掉？","like_count":0},{"had_liked":false,"id":319278,"user_name":"半桶水","can_delete":false,"product_type":"c1","uid":1226278,"ip_address":"","ucode":"623C529B596BD8","user_header":"https://static001.geekbang.org/account/avatar/00/12/b6/26/b67c6209.jpg","comment_is_top":false,"comment_ctime":1635731114,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1635731114","product_id":100020801,"comment_content":"那要是在最后一个阶段之前，即serve层写binlog和引擎层commit之间crash了是不是也会造成问题？","like_count":0},{"had_liked":false,"id":318347,"user_name":"灯开开","can_delete":false,"product_type":"c1","uid":2292501,"ip_address":"","ucode":"A04482E43E3144","user_header":"https://static001.geekbang.org/account/avatar/00/22/fb/15/d54bfaca.jpg","comment_is_top":false,"comment_ctime":1635251808,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1635251808","product_id":100020801,"comment_content":"重启后，要恢复数据，得清楚哪些需要恢复。redolog有这个功能，checkpoint到write-pos，且状态是prepare状态的数据需要恢复，继续查找是否有对应的binlog日志，如果有则commit，如果没有binlog日志则不做处理，等待擦掉。<br>","like_count":0},{"had_liked":false,"id":318222,"user_name":"Eternal","can_delete":false,"product_type":"c1","uid":1188023,"ip_address":"","ucode":"EA6FE7CC98F740","user_header":"https://static001.geekbang.org/account/avatar/00/12/20/b7/bdb3bcf0.jpg","comment_is_top":false,"comment_ctime":1635210380,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1635210380","product_id":100020801,"comment_content":"<br>老师能补充一下 MySQL的存储空间结构的相关知识点吗？<br>我了解到：<br>1、表空间是一个逻辑的存储空间的概念，是由一组文件组成 ；表空间又分共享和独享，这个可以通过参数调整；<br>2、表空间又由各种段组成，比如回滚段，数据段之类的，每个段是独立的文件还是一组文件呢？<br>3、每个段又由多个区组成，每个区在任何情况下都是1M空间，这样看来区是在一个独立的文件中；<br>4、每个区又由多个连续页的也组成，页的默认大小是16KB，这个参数可以调整；<br>5、每个页由很多行数据组成；<br><br>我的疑问是：<br>1、段是独立的文件还是一组文件呢？比如我的表T的回滚段刚开始是一个文件，后面数据量增大了，会扩展成两个文件吗？<br>   还是说一个表的一个类型的段是一个文件呢？比如数据段一个文件，回滚段一个文件，索引段一个文件？<br>2、还有redo-log 、binlog 这些数据是在那个空间 ，什么段存储呢？<br><br>我一直想整明白MySQL的存储空间结构，弄了很久都没搞明白，望老师看到后点播一二，或某一位路过的大神不啬慷慨点播一二","like_count":0},{"had_liked":false,"id":317984,"user_name":"李坤龙","can_delete":false,"product_type":"c1","uid":2824858,"ip_address":"","ucode":"68346B996EE22B","user_header":"https://static001.geekbang.org/account/avatar/00/2b/1a/9a/f2f9f5dd.jpg","comment_is_top":false,"comment_ctime":1635086317,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1635086317","product_id":100020801,"comment_content":"日志方面，MySQL和Oracle有本质的不同。<br>Oracle的归档日志直接就是redo log拷贝出来的，MySQL由于InnoDB引擎最初是由插件的形式引入的，因此和引擎层和Server层有一些Gap，存在两套不同的日志机制。Redo和Oracle的redo一致，但binlog实现的是归档日志的功能，但记录的是SQL语句，而不是物理向量。","like_count":0},{"had_liked":false,"id":317983,"user_name":"꧁༺༻꧂","can_delete":false,"product_type":"c1","uid":1178426,"ip_address":"","ucode":"8BFD5C1F6ED235","user_header":"https://static001.geekbang.org/account/avatar/00/11/fb/3a/3dc7c61c.jpg","comment_is_top":false,"comment_ctime":1635085739,"is_pvip":true,"discussion_count":1,"race_medal":5,"score":"1635085739","product_id":100020801,"comment_content":"老师，我的理解是这样，处于prepare状态的事物不会真的记录到redo log里面，而是等到commit状态了才会写入redo log，我的理解正确么？<br>原因是这样：<br>如果prepare状态就写入redo log，当多个事物都执行到了prepare状态，write pos 就会出现混乱了，需要指向多个位置，这和 write pos 指向一个明确的位置明显不符合。","like_count":0,"discussions":[{"author":{"id":1226968,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b8/d8/f81b5604.jpg","nickname":"hcyycb","note":"","ucode":"77FF6CA41F9E66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":410433,"discussion_content":"prepare状态的也会写到redo log——你再看到后面的文章就会看到老师明确的说到这部分内容的了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635691067,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":317980,"user_name":"꧁༺༻꧂","can_delete":false,"product_type":"c1","uid":1178426,"ip_address":"","ucode":"8BFD5C1F6ED235","user_header":"https://static001.geekbang.org/account/avatar/00/11/fb/3a/3dc7c61c.jpg","comment_is_top":false,"comment_ctime":1635085251,"is_pvip":true,"discussion_count":0,"race_medal":5,"score":"1635085251","product_id":100020801,"comment_content":"老师，我的理解是这样，处于prepare状态的事物，此时并不会真正写入redo log，等到了commit状态了才真正写入redo log。请问我的理解是否正确？会被写入到redo log中么？如果多个并发事物都在prepare阶段，那岂不是 write pos 所指向的点就冲突了么？","like_count":0},{"had_liked":false,"id":317947,"user_name":"怕什么，抱紧我","can_delete":false,"product_type":"c1","uid":1318633,"ip_address":"","ucode":"CBCEA76E9EF33B","user_header":"https://static001.geekbang.org/account/avatar/00/14/1e/e9/dcc63d8f.jpg","comment_is_top":false,"comment_ctime":1635068521,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1635068521","product_id":100020801,"comment_content":"所以redo log记录的到底是什么？","like_count":0},{"had_liked":false,"id":317928,"user_name":"长风","can_delete":false,"product_type":"c1","uid":2717329,"ip_address":"","ucode":"EDE656077E43DC","user_header":"https://static001.geekbang.org/account/avatar/00/29/76/91/e322bb5d.jpg","comment_is_top":false,"comment_ctime":1635063544,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1635063544","product_id":100020801,"comment_content":"学了老师的课让我一年小白受益匪浅<br><br>1.redolog 是只针对innodb存储引擎特有的一种日志方式 作用于引擎层(执行存储相关事宜模块)<br>2.Redolog主要记录的是 在哪里进行了什么什么样的修改<br>3.redolog为什么要设置两个阶段的提交？<br>(1).我可以理解为类似看待成“原子性”一样 将写入redo和写入bin<br>作为一个整体操作,要么全部成功 要么失败 失败的结果就是无法将redo的操作变为commit 后续mysql不会对非commit的数据进行处理 做到数据的安全性<br>4.binlog 是 server层全部引擎具备的一种日志模块<br>5.为什么不单独利用redolog去完成日志恢复<br>(1).redolog是innodb特有的 当我们采取mylsam引擎的时候,没有redolog进行数据恢复<br>问题:上面描述的二阶段提交 我很好奇当第一阶段的redolog进行prepare，binlog也写入成功 此时数据库服务重启 这时候执行器还未来得及将redolog的状态改为commit  binlog日志是怎么做到根据redolog的状态而判断是否为 有效呢<br>说的不对请大神指点<br>","like_count":0},{"had_liked":false,"id":317623,"user_name":"Geek_835e54","can_delete":false,"product_type":"c1","uid":2814750,"ip_address":"","ucode":"7C56C9528D9B80","user_header":"","comment_is_top":false,"comment_ctime":1634871442,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634871442","product_id":100020801,"comment_content":"老师请问一下，是不是每次commit都要将redo buffer持久化到磁盘中？如果不是的话，就没有办法故障恢复后的数据一致性了，还是要牺牲部分一致性来提高性能？","like_count":0},{"had_liked":false,"id":317563,"user_name":"鹅帮逮","can_delete":false,"product_type":"c1","uid":2755534,"ip_address":"","ucode":"A6DB1BEFDA5D9A","user_header":"https://static001.geekbang.org/account/avatar/00/2a/0b/ce/f0c520d1.jpg","comment_is_top":false,"comment_ctime":1634861870,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634861870","product_id":100020801,"comment_content":"插入删除操作也是同理吗","like_count":0},{"had_liked":false,"id":316786,"user_name":"LoveDlei","can_delete":false,"product_type":"c1","uid":1102916,"ip_address":"","ucode":"68065848DF518B","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/44/ec084136.jpg","comment_is_top":false,"comment_ctime":1634550818,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634550818","product_id":100020801,"comment_content":"有了 redo log，InnoDB 就可以保证即使数据库发生异常重启，之前提交的记录都不会丢失，我想问的是redo log是存储在内存，还是在磁盘啊？","like_count":0},{"had_liked":false,"id":315850,"user_name":"joker","can_delete":false,"product_type":"c1","uid":1501088,"ip_address":"","ucode":"4305206A1FE5EC","user_header":"https://static001.geekbang.org/account/avatar/00/16/e7/a0/9a962a74.jpg","comment_is_top":false,"comment_ctime":1634021879,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1634021879","product_id":100020801,"comment_content":"表上有更新的时候，为啥查询缓存会失效呢","like_count":0},{"had_liked":false,"id":315694,"user_name":"木木","can_delete":false,"product_type":"c1","uid":1763992,"ip_address":"","ucode":"B182555D11946D","user_header":"https://static001.geekbang.org/account/avatar/00/1a/ea/98/65a13c45.jpg","comment_is_top":false,"comment_ctime":1633945608,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1633945608","product_id":100020801,"comment_content":"sql更新语句执行过程<br>客户端-&gt;分析器-&gt;优化器-&gt;执行器-&gt;存储引擎<br><br>执行器发送查询命令给-&gt;存储引擎，存储引擎查询缓存，若命中返回给执行器，若未命中则读磁盘中数据到内存中然后返回给-&gt;执行器。执行器收到数据后经过计算（比如将N+1计算后得到3）后，将新数据更新命令发给-&gt;存储引擎,引擎将新数据更新到内存，并新增redolog日志（此时redolog日志状态为prepare）。然后通知-&gt;执行器数据更新完成.执行器新增binlog日志。调用-&gt;存储引擎接口,将redolog日志状态改为commit","like_count":0},{"had_liked":false,"id":314968,"user_name":"GengTeng","can_delete":false,"product_type":"c1","uid":1224623,"ip_address":"","ucode":"3F926F5EF1D075","user_header":"https://static001.geekbang.org/account/avatar/00/12/af/af/8b03ce2c.jpg","comment_is_top":false,"comment_ctime":1633617251,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1633617251","product_id":100020801,"comment_content":"具体来说，当有一条记录需要更新的时候，InnoDB 引擎就会先把记录写到 redo log（粉板）里面，并更新内存，这个时候更新就算完成了。同时，InnoDB 引擎会在适当的时候，将这个操作记录更新到磁盘里面，而这个更新往往是在系统比较空闲的时候做，这就像打烊以后掌柜做的事。<br><br>感觉这一段附近的的描述太混乱了。磁盘、内存是硬件层面的描述，redo log 、bin log是mysql业务逻辑层面的描述，这些概念混到一起讲对新手太不友好了。<br><br>先写redo log，再写内存，然后适当的时候更新到磁盘。<br><br>redo log这东西是在内存里吗，还是写到磁盘上才算数，如果只是内存，为啥要说“再写内存”，所以我理解为它是在磁盘上的，但是后面又说“更新到磁盘”，怎么，“先写redo log”这玩意是写了个假的吗，后面又写内存又写磁盘？<br><br>个人感觉不是篇幅太短介绍不来，是背景基础概念没慢慢讲好，就着急把它们全讲了。","like_count":0,"discussions":[{"author":{"id":1226968,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b8/d8/f81b5604.jpg","nickname":"hcyycb","note":"","ucode":"77FF6CA41F9E66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":410438,"discussion_content":"redo log 是磁盘文件。写redo log 之前有一个 redo log buffer，在redo log buffer里的日志，会批量写到redo log——分为write（写内存页）和fsync（写 hard disk）。即使是 prepare 状态的日志也有可能被持久化到磁盘，因为redo log buffer 是一块共用的内存，其他事务提交，会顺带一起刷盘。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635691430,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314785,"user_name":"张策","can_delete":false,"product_type":"c1","uid":1434941,"ip_address":"","ucode":"471F3A9D1F158F","user_header":"https://static001.geekbang.org/account/avatar/00/15/e5/3d/e9cf1a67.jpg","comment_is_top":false,"comment_ctime":1633430452,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1633430452","product_id":100020801,"comment_content":"1）写入redolog和binlog过程：先写入redolog后将状态设置为prepare，再写入binlog后将事务状态设置为commit。整体流程为2pc，作为mysql内部的2pc，以此区别分布式事务中的2pc。<br>2）目的：为了保证redolog和binlog数据逻辑上的一致。因为binlog日志常用来主从直接的数据同步和数据恢复。假如不采用2pc，那会就会先写redolog后写binlog，或者先写binlog后写redolog，而这样都会造成该数据库的数据不一致（先redolog后binlog，此时redolog写入成功，但是binlog失败会导致使用binlog恢复出来的数据库比该数据库少，先binlog后redolog，此时binlog写入成功，但是redolog失败会导致使用binlog恢复出来的数据库比该数据库多）<br>3）2pc如果在宕机重启后实现数据一致：分为三种情况，3-1）如果在redolog之前宕机，当前库的数据没有发生修改。此时当前库和用binlog恢复出来的库的数据保持一致；3-2）redolog写入成功，binlog写入失败时，撤销redolog对数据的修改，此时当前库和用binlog恢复出来的库的数据保持一致；3-3）redolog写入成功，binlog写入成功但是commit失败，自动提交事务，此时当前库和用binlog恢复出来的库的数据保持一致。<br><br>参考文献：<br>https:&#47;&#47;mp.weixin.qq.com&#47;s&#47;XTpoYW--6PTqotcC8tpF2A<br>https:&#47;&#47;www.cnblogs.com&#47;orange-CC&#47;p&#47;13291960.html<br><br><br>","like_count":0},{"had_liked":false,"id":314777,"user_name":"Roll-Back","can_delete":false,"product_type":"c1","uid":1995043,"ip_address":"","ucode":"E71F498A5E98DD","user_header":"https://static001.geekbang.org/account/avatar/00/1e/71/23/5b4c5a98.jpg","comment_is_top":false,"comment_ctime":1633421697,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1633421697","product_id":100020801,"comment_content":"老师我有个问题，我怎么感觉只要有binlog就行了么？为什么还要有binlog？<br>1.binlong所有引擎都可以使用。<br>2.如果binlog记录了更前前的行数据，在数据恢复的时候，直接将数据恢复到没有问题某一刻的数据就行了，为什么要依赖redolog？<br>3.增加了redolog之后，需要两阶段提交，（提交redolog，binlog），如果没有redolog，不就少了一次提交吗？效率不是更高吗？","like_count":0,"discussions":[{"author":{"id":1226968,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b8/d8/f81b5604.jpg","nickname":"hcyycb","note":"","ucode":"77FF6CA41F9E66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":410441,"discussion_content":"binlog没有checkpoint，要恢复也不知从哪里开始。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635691594,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314298,"user_name":"582726866","can_delete":false,"product_type":"c1","uid":1368458,"ip_address":"","ucode":"DED4D636F024C0","user_header":"https://static001.geekbang.org/account/avatar/00/14/e1/8a/ec2f38bd.jpg","comment_is_top":false,"comment_ctime":1632963260,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632963260","product_id":100020801,"comment_content":"如果redo log 到达prepared，binlog接着写入成功，然后崩溃了，即redo log还没有改为commit状态，这个情况下会发生什么事情呢？","like_count":0},{"had_liked":false,"id":314158,"user_name":"王加武","can_delete":false,"product_type":"c1","uid":1665471,"ip_address":"","ucode":"DDCFE578C6C428","user_header":"https://static001.geekbang.org/account/avatar/00/19/69/bf/50a824a4.jpg","comment_is_top":false,"comment_ctime":1632881000,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632881000","product_id":100020801,"comment_content":"一天一备的优势<br>数据恢复时间方面：如果是一周一备份，数据丢失了想要通过binlog恢复就得找到这周的某个时间点，而一周如果做了很多操作，找start-datetime和stop-datetime是很消耗成本的；但如果是一天一备，找到start-datetime和stop-datetime是比较容易的，然后根据这个时间进行恢复即可。<br>binlog丢失风险：一天一备，时间周期短，binlog丢失概率小，即使丢失了，损失成本相对较小，而如果是一周一备份，当数据丢失时，万一binlog丢失了，这个代价就比较大了。","like_count":0},{"had_liked":false,"id":313906,"user_name":"第四单元","can_delete":false,"product_type":"c1","uid":1747184,"ip_address":"","ucode":"3ED9D553E1DE17","user_header":"https://static001.geekbang.org/account/avatar/00/1a/a8/f0/529f15e9.jpg","comment_is_top":false,"comment_ctime":1632733623,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632733623","product_id":100020801,"comment_content":"请问redo logo到底是什么形式的记录？为什么比写磁盘快。","like_count":0},{"had_liked":false,"id":313599,"user_name":"Stephen","can_delete":false,"product_type":"c1","uid":1165201,"ip_address":"","ucode":"0D49223E6CB7B1","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ7mAt63VrbLZPHpeZxSc4IlBYswQSnaAB5wGePaGFDehgiaNfIxI1SJ5yIHIlmVk8hsw0RaoaSCPA/132","comment_is_top":false,"comment_ctime":1632550318,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632550318","product_id":100020801,"comment_content":"感觉更新比较频繁的，一天一备在出现异常时能够更快地恢复到当前状态吧。影响是需要占用更大的空间？","like_count":0},{"had_liked":false,"id":313383,"user_name":"Yina","can_delete":false,"product_type":"c1","uid":2656811,"ip_address":"","ucode":"56B3F2DC006273","user_header":"https://static001.geekbang.org/account/avatar/00/28/8a/2b/260231af.jpg","comment_is_top":false,"comment_ctime":1632402546,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632402546","product_id":100020801,"comment_content":"我的理解是redo属于physical层的，binlog是从logic层","like_count":0},{"had_liked":false,"id":313379,"user_name":"Flychen","can_delete":false,"product_type":"c1","uid":1880782,"ip_address":"","ucode":"4029A8F1D3C361","user_header":"https://static001.geekbang.org/account/avatar/00/1c/b2/ce/5638be2b.jpg","comment_is_top":false,"comment_ctime":1632402148,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632402148","product_id":100020801,"comment_content":"如何查看 redolog binlog 内容<br>","like_count":0},{"had_liked":false,"id":313358,"user_name":"霜之哀伤与火之高兴","can_delete":false,"product_type":"c1","uid":2756509,"ip_address":"","ucode":"79C044FB0E1471","user_header":"https://static001.geekbang.org/account/avatar/00/2a/0f/9d/3da7281d.jpg","comment_is_top":false,"comment_ctime":1632387982,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632387982","product_id":100020801,"comment_content":"两阶段提交时为了保证binlog和redolog的数据一致性，通过在redolog的两次状态更新中，完成binlog的记录，若binlog记录过程中，发生崩溃，在使用binlog进行恢复时，redog记录在黑板上的内容为失效，此时update操作并未真正成功，使得当前值仍未0，若为一阶段操作，会通过redolog的update，更新磁盘，使得磁盘为记录值为1。请指正","like_count":0},{"had_liked":false,"id":313325,"user_name":"Prisoner","can_delete":false,"product_type":"c1","uid":2679253,"ip_address":"","ucode":"AE469ACC071692","user_header":"https://static001.geekbang.org/account/avatar/00/28/e1/d5/c57a4bd8.jpg","comment_is_top":false,"comment_ctime":1632378530,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632378530","product_id":100020801,"comment_content":"binlog是Server层持有，redolog是Innodb引擎持有。","like_count":0},{"had_liked":false,"id":313311,"user_name":"Helios","can_delete":false,"product_type":"c1","uid":1380758,"ip_address":"","ucode":"BE6B98EE8F0D09","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJrOl63enWXCRxN0SoucliclBme0qrRb19ATrWIOIvibKIz8UAuVgicBMibIVUznerHnjotI4dm6ibODA/132","comment_is_top":false,"comment_ctime":1632372779,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632372779","product_id":100020801,"comment_content":"redolog一个事务需要写两次，如果不用lsmtree的话就要有随机写，请问老师redolog是用什么结构维护的呢","like_count":0},{"had_liked":false,"id":313295,"user_name":"特立独行的猪","can_delete":false,"product_type":"c1","uid":1465344,"ip_address":"","ucode":"1440F96375740A","user_header":"https://static001.geekbang.org/account/avatar/00/16/5c/00/5d11e68d.jpg","comment_is_top":false,"comment_ctime":1632366750,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632366750","product_id":100020801,"comment_content":"这次终于理解到了什么是两阶段提交？之前一直没有明白redo log和binlog 日志之间的关系，学到了","like_count":0},{"had_liked":false,"id":312824,"user_name":"Geek_4c861c","can_delete":false,"product_type":"c1","uid":2757724,"ip_address":"","ucode":"71464EC29C035F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Lib8iaCINXANIsGGDKbXcxOicjuLeKKD7o5ibGQl4xaPgiaNd2MOjiczdfCyZETXfGvY42H75Qg6QdnhG8FXc84kvkiag/132","comment_is_top":false,"comment_ctime":1632040638,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1632040638","product_id":100020801,"comment_content":"看完这一讲全是疑问。<br>1.为什么redolog能保证crsh-safe能力，而binlog不行？binlog和redolog不都是每次更新后记录日志吗？<br>2.innodb把数据写入redolog和内存里的时候，读取是直接从内存读吗，这个内存和MySQL的缓存有什么关联呢，先后顺序是什么？<br>3.把redolog写入磁盘后，内存里的数据怎么处理？","like_count":0},{"had_liked":false,"id":311758,"user_name":"江雪寒","can_delete":false,"product_type":"c1","uid":1040921,"ip_address":"","ucode":"57DA365E7D6402","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/ribLSAI2Haymibib9P0m463rllc95PwxFFJ3pBGV3W6P2zBteXLG1srT40TyoAHq6HCAF2ntaPhjG9sjnMm9MynAQ/132","comment_is_top":false,"comment_ctime":1631449333,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631449333","product_id":100020801,"comment_content":"老师好，如果写完binlog后就crash了，事务还没提交会怎样？","like_count":0},{"had_liked":false,"id":311685,"user_name":"杨善阳","can_delete":false,"product_type":"c1","uid":2762716,"ip_address":"","ucode":"3973CEB7CC8BA1","user_header":"https://static001.geekbang.org/account/avatar/00/2a/27/dc/b1b70730.jpg","comment_is_top":false,"comment_ctime":1631407966,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631407966","product_id":100020801,"comment_content":"status=0，update为0；如果redo log处于prepare状态，bin log写入成功status=1；此时系统宕机；事务回滚；bin log中status会记录为0吗？<br>","like_count":0},{"had_liked":false,"id":311544,"user_name":"意琦行","can_delete":false,"product_type":"c1","uid":1637619,"ip_address":"","ucode":"B940AA60B5CCEE","user_header":"https://static001.geekbang.org/account/avatar/00/18/fc/f3/28fe16cf.jpg","comment_is_top":false,"comment_ctime":1631276907,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631276907","product_id":100020801,"comment_content":"crash 后的恢复流程如下：<br>* 如果 redo log 里面的事务是完整的，也就是已经有了 commit 标识，则直接提交；<br>* 如果 redo log 里面的事务只有完整的 prepare，则判断对应的事务 binlog 是否存在并完整。<br>  * 如果是，则提交事务；<br>  * 否则，回滚事务。<br>所以即时 binlog 写完没来得及 commit redo log 也是没有问题的。<br><br>另外根据恢复逻辑可以发现：先写 redo log 再写 binlog，然后恢复的时候判断 binlog 完整的时候 redo log 才有效这样也可以达到两阶段提交效果，应该是可以的吧？<br><br>两阶段提交的优点是：如果 redo log 是 commit 状态的就不需要去查询 binlog 是否完整了，因为按照两阶段提交流程来说 redolog commit 了 那binlog肯定是完整的。<br>","like_count":0},{"had_liked":false,"id":311303,"user_name":"半年 2号","can_delete":false,"product_type":"c1","uid":2562181,"ip_address":"","ucode":"7F23C4532A5513","user_header":"https://static001.geekbang.org/account/avatar/00/27/18/85/83ac977e.jpg","comment_is_top":false,"comment_ctime":1631163298,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631163298","product_id":100020801,"comment_content":"write pos是当前写入的位置<br><br>checkpoint是已经将数据更新持久化的位置。持久化到磁盘后这部分数据就会空出来","like_count":0},{"had_liked":false,"id":310969,"user_name":"总有一天","can_delete":false,"product_type":"c1","uid":1240856,"ip_address":"","ucode":"730405447A6E95","user_header":"https://static001.geekbang.org/account/avatar/00/12/ef/18/5bd7b1be.jpg","comment_is_top":false,"comment_ctime":1631003777,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631003777","product_id":100020801,"comment_content":"图中这里“提交事务处于commit状态”之前有个写binlog的策略，如果sync_binlog设置为N。那是要等binlog落磁盘了，这个事务型的操作，才算彻底结束吗？","like_count":0},{"had_liked":false,"id":310965,"user_name":"总有一天","can_delete":false,"product_type":"c1","uid":1240856,"ip_address":"","ucode":"730405447A6E95","user_header":"https://static001.geekbang.org/account/avatar/00/12/ef/18/5bd7b1be.jpg","comment_is_top":false,"comment_ctime":1631002845,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1631002845","product_id":100020801,"comment_content":"老师好，各位大佬好，我想确认下“InnoDB 引擎就会先把记录写到 redo log（粉板）里面，并更新内存，这个时候更新就算完成了。同时，InnoDB 引擎会在适当的时候，将这个操作记录更新到磁盘里面，而这个更新往往是在系统比较空闲的时候做，这就像打烊以后掌柜做的事。”这句话，我理解的是innodb_flush_log_at_trx_commit 这里是 1 ；sync_binlog 是 0 ；才符合这句话，对吗？","like_count":0,"discussions":[{"author":{"id":1226968,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b8/d8/f81b5604.jpg","nickname":"hcyycb","note":"","ucode":"77FF6CA41F9E66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":410446,"discussion_content":"提到的这两个参数，是控制redo log 和 binlog 持久化的，不是影响数据持久化。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635691864,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":310362,"user_name":"Seven","can_delete":false,"product_type":"c1","uid":2403766,"ip_address":"","ucode":"37D99CF8535CDE","user_header":"https://static001.geekbang.org/account/avatar/00/24/ad/b6/a8caa2c7.jpg","comment_is_top":false,"comment_ctime":1630631978,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1630631978","product_id":100020801,"comment_content":"要求安全性和及时性强的系统比如金融支付类，一天一备优于一周一备","like_count":0},{"had_liked":false,"id":310307,"user_name":"Cassie","can_delete":false,"product_type":"c1","uid":2212810,"ip_address":"","ucode":"1C68BDBCC95FA5","user_header":"https://static001.geekbang.org/account/avatar/00/21/c3/ca/93f7eca9.jpg","comment_is_top":false,"comment_ctime":1630585893,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630585893","product_id":100020801,"comment_content":"有了 redo log，InnoDB 就可以保证即使数据库发生异常重启，之前提交的记录都不会丢失，这个能力称为 crash-safe<br>老师，我想问下如果没有redolog，每次都是直接写入磁盘，这样是不是也算是有crash-safe能力呢？如果是，那么有了redolog的作用是不是为了提高数据库写入的速度，从而提高性能呢？","like_count":0},{"had_liked":false,"id":310190,"user_name":"半年 2号","can_delete":false,"product_type":"c1","uid":2562181,"ip_address":"","ucode":"7F23C4532A5513","user_header":"https://static001.geekbang.org/account/avatar/00/27/18/85/83ac977e.jpg","comment_is_top":false,"comment_ctime":1630543934,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630543934","product_id":100020801,"comment_content":"redo里面的数据有两种状态，分别是prepare,commit。宕机后重启，如果redo里面的数据是commit状态，则执行后续操作。如果是prepare状态，则需要根据binlog来确定数据是回滚还是提交，如果binlog中已经记录了prepare状态数据的逻辑修改，则commit，否则需要回滚。(如果修改已经归档到binlog，则此数据必须提交，因为下游的从库会用到binlog，这样才能保证主从一致)","like_count":0},{"had_liked":false,"id":310037,"user_name":"稽山的柚子","can_delete":false,"product_type":"c1","uid":1546579,"ip_address":"","ucode":"E19BCF4604CBB9","user_header":"","comment_is_top":false,"comment_ctime":1630464390,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630464390","product_id":100020801,"comment_content":"我记着之前看到过一个点，写磁盘redolog之前也是会有一步先把redolog内容放到缓存中吧","like_count":0},{"had_liked":false,"id":309957,"user_name":"刘迪伟","can_delete":false,"product_type":"c1","uid":2560083,"ip_address":"","ucode":"ABCF16B08CD6ED","user_header":"","comment_is_top":false,"comment_ctime":1630409484,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630409484","product_id":100020801,"comment_content":"老师，那如果redolog已经更新为commit状态了，这时候服务器崩溃重启了，但是检查redolog已标记commit，此时就应该不做操作了吧？那这些数据是不是就丢失了？","like_count":0},{"had_liked":false,"id":309481,"user_name":"夏海","can_delete":false,"product_type":"c1","uid":2538057,"ip_address":"","ucode":"16CA47CDB30E03","user_header":"https://static001.geekbang.org/account/avatar/00/26/ba/49/3ce37157.jpg","comment_is_top":false,"comment_ctime":1630158341,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630158341","product_id":100020801,"comment_content":"一天一备 和一周一倍 优势在于容灾恢复时间短","like_count":0},{"had_liked":false,"id":309345,"user_name":"testestest","can_delete":false,"product_type":"c1","uid":2286916,"ip_address":"","ucode":"7919937DECA88C","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKSGstTaYHly9ucDviavQaBGcyVz9Emzy6MriahAiacuz6Rqq6d8vWcj3y4LoMMItVmT6ibICLibAus55Q/132","comment_is_top":false,"comment_ctime":1630055771,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1630055771","product_id":100020801,"comment_content":"关于两阶段提交有个问题：<br>如果写入binlog成功后，进行第二阶段时提交事务失败了（并不是mysql挂掉导致），那么数据库中的数据岂不不能更新？","like_count":0},{"had_liked":false,"id":309152,"user_name":"刘思远","can_delete":false,"product_type":"c1","uid":1878147,"ip_address":"","ucode":"F295F5F6B5F2D1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLFHmdHZlP01dsTAuHYxsUMN0yuFTovKhVOURnwHjFHqPsTxPNMA6f3md7tF4Aztl88VIxSDMcx0Q/132","comment_is_top":false,"comment_ctime":1629962371,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629962371","product_id":100020801,"comment_content":"丁奇大牛讲得很明白！","like_count":0},{"had_liked":false,"id":309048,"user_name":"极爷","can_delete":false,"product_type":"c1","uid":1780383,"ip_address":"","ucode":"24BE33FFA7331F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIEJ8h4x6vRmjYgvdeXle4iazib9cCYR4skiaj6xk17KuquGFXliag266MXZsTx1h2hICloE9EMAbcLIA/132","comment_is_top":false,"comment_ctime":1629904481,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629904481","product_id":100020801,"comment_content":"写入redo log的更新就是写入文件，不应该也是写入磁盘吗？不是一样很慢吗？这点麻烦老师解惑下","like_count":0},{"had_liked":false,"id":309019,"user_name":"gyx","can_delete":false,"product_type":"c1","uid":2746447,"ip_address":"","ucode":"134A34BD5CE28C","user_header":"https://static001.geekbang.org/account/avatar/00/29/e8/4f/9cef59d2.jpg","comment_is_top":false,"comment_ctime":1629895125,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629895125","product_id":100020801,"comment_content":"老师能不能请问一下，redo log对于prepare之后但没有commit的记录会怎么处理呢？换句话说如果在写完bin log之后但redo log commit之前系统重启的话恢复完的数据库是什么样子呢","like_count":0},{"had_liked":false,"id":308757,"user_name":"阿市","can_delete":false,"product_type":"c1","uid":1320234,"ip_address":"","ucode":"1DF2A71043A644","user_header":"https://static001.geekbang.org/account/avatar/00/14/25/2a/972a5881.jpg","comment_is_top":false,"comment_ctime":1629787846,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629787846","product_id":100020801,"comment_content":"老师我想问下，这是下边一个同学讲的自己的理解 。<br>1 prepare阶段 2 写binlog 3 commit<br>当在2之前崩溃时<br>重启恢复：后发现没有commit，回滚。备份恢复：没有binlog 。<br>一致。<br>当在3之前崩溃<br>重启恢复：虽没有commit，但满足prepare和binlog完整，所以重启后会自动commit。备份：有binlog. 一致<br>我看你的评论是ok。<br>那么我的问题是：那么redolog存在的意义是什么？","like_count":0},{"had_liked":false,"id":308506,"user_name":"Karl","can_delete":false,"product_type":"c1","uid":1389755,"ip_address":"","ucode":"2C040215317392","user_header":"","comment_is_top":false,"comment_ctime":1629650914,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629650914","product_id":100020801,"comment_content":"想问一下，恢复的时候如何知道bin log和redo log各自的某条日志是对应同一条数据更新的呢","like_count":0},{"had_liked":false,"id":308459,"user_name":"颜海航","can_delete":false,"product_type":"c1","uid":1308159,"ip_address":"","ucode":"5644F6328BF901","user_header":"https://static001.geekbang.org/account/avatar/00/13/f5/ff/523fb378.jpg","comment_is_top":false,"comment_ctime":1629628365,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629628365","product_id":100020801,"comment_content":"老师 能讲一下double write吗 这个和redo log的wal 作用有什么不同","like_count":0},{"had_liked":false,"id":308391,"user_name":"Geek_c995ce","can_delete":false,"product_type":"c1","uid":2237296,"ip_address":"","ucode":"129F6CF22ACA4E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqT3pba9RQEXAbUUy5RIwicvjgCpCzCrMpdxSuo2CN5ff0XP5iaAedrwstYqdolnVJXnTMfNJxLZwFA/132","comment_is_top":false,"comment_ctime":1629596849,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629596849","product_id":100020801,"comment_content":"数据页刷盘就是脏页刷盘吗老师，每次数据页刷盘后会主动更新redo log里面的checkpoint是吗","like_count":0},{"had_liked":false,"id":308372,"user_name":"Jasdent","can_delete":false,"product_type":"c1","uid":2742432,"ip_address":"","ucode":"7ED277F459921C","user_header":"https://static001.geekbang.org/account/avatar/00/29/d8/a0/47b72ec6.jpg","comment_is_top":false,"comment_ctime":1629559399,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629559399","product_id":100020801,"comment_content":"如果能把页和更新数据这些分析一下就更好了，例如某些情况下，一行的内存占用超过512B（假如系统页是512B），innodb的内存分配是怎么做的？","like_count":0},{"had_liked":false,"id":308369,"user_name":"Geek_c995ce","can_delete":false,"product_type":"c1","uid":2237296,"ip_address":"","ucode":"129F6CF22ACA4E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqT3pba9RQEXAbUUy5RIwicvjgCpCzCrMpdxSuo2CN5ff0XP5iaAedrwstYqdolnVJXnTMfNJxLZwFA/132","comment_is_top":false,"comment_ctime":1629557509,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629557509","product_id":100020801,"comment_content":"为什么说binlog没有crashsafe的能力呢，是因为只是场景需求不一样吗，binlog追加写，保留了所有逻辑日志，讲道理也有crashsafe的能力阿","like_count":0},{"had_liked":false,"id":308222,"user_name":"Geek_d064c6","can_delete":false,"product_type":"c1","uid":2307025,"ip_address":"","ucode":"B8D92862CCF6BA","user_header":"","comment_is_top":false,"comment_ctime":1629456253,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629456253","product_id":100020801,"comment_content":"老师，我有两个问题：<br>1.既然写redolog也是要写磁盘的，那为啥不直接把数据写到磁盘里，还要多一次写redolog？<br>2.更新数据的时候执行器找引擎要id=2的数据，文中说引擎要执行树搜索，这个树就是主键id对应的聚簇索引，这个索引应该是在内存里的吧，既然是聚簇索引那就包含了整条记录所有的字段，应该就不用再去磁盘中查找了啊，为啥后面你说如果内存里没有就去磁盘里查找<br>这两个问题困扰着我，尤其是第二个问题，希望老师能解答一下，十分感谢！","like_count":0},{"had_liked":false,"id":308190,"user_name":"Zhaoyang","can_delete":false,"product_type":"c1","uid":1037190,"ip_address":"","ucode":"131D83AC2566D2","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d3/86/b5d72c87.jpg","comment_is_top":false,"comment_ctime":1629445633,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629445633","product_id":100020801,"comment_content":"继续刷。再次熟悉一遍","like_count":0},{"had_liked":false,"id":308062,"user_name":"BryanGa","can_delete":false,"product_type":"c1","uid":2646438,"ip_address":"","ucode":"2340B0061331AF","user_header":"https://static001.geekbang.org/account/avatar/00/28/61/a6/07086720.jpg","comment_is_top":false,"comment_ctime":1629373862,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629373862","product_id":100020801,"comment_content":"老师，请问两段提交是怎样的一个执行过程，有点没明白和先redo log再binlog的区别","like_count":0},{"had_liked":false,"id":307704,"user_name":"KK","can_delete":false,"product_type":"c1","uid":1324863,"ip_address":"","ucode":"FFC31A3FE3A285","user_header":"https://static001.geekbang.org/account/avatar/00/14/37/3f/a9127a73.jpg","comment_is_top":false,"comment_ctime":1629206971,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1629206971","product_id":100020801,"comment_content":"如果记录redo log之后，没有更新到地盘，这个时候查询的数据是最新的吗？是在事务提交之后，会写入到磁盘吗？从而可以每次都查询到最新的记录？<br><br>“当有一条记录需要更新的时候，InnoDB 引擎就会先把记录写到 redo log（粉板）里面，并更新内存，这个时候更新就算完成了。同时，InnoDB 引擎会在适当的时候，将这个操作记录更新到磁盘里面，而这个更新往往是在系统比较空闲的时候做，这就像打烊以后掌柜做的事。”<br><br>这里适当的时候，是指“往往是在系统比较空闲的时候”，那如何保证我们更新数据之后，可以查询到最新的数据呢？","like_count":0},{"had_liked":false,"id":307440,"user_name":"Geek_2b002f","can_delete":false,"product_type":"c1","uid":2550380,"ip_address":"","ucode":"196A97534AFB8D","user_header":"","comment_is_top":false,"comment_ctime":1629103533,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629103533","product_id":100020801,"comment_content":"老师您好，有一个问题，如果在非常极端的情况下，redo log被写满，而redo log涉及的事务均未提交，此时又有新的事务进来时，就要擦除redo log，这就意味着被修改的的脏页此时要被迫被flush到磁盘了，因为用来保证事务持久性的redo log就要消失了。但如若真的执行了这样的操作，数据就在被commit之前被持久化到磁盘中了。当真的遇到这样的恶劣情况时，mysql会如何处理呢，会直接报错吗？还是有什么应对的方法和策略呢？<br>这是评论的一个同学的问题，看了老师您的回答，我还是不太明白，可以再讲细致一点吗？","like_count":0},{"had_liked":false,"id":307434,"user_name":"那那那","can_delete":false,"product_type":"c1","uid":2366248,"ip_address":"","ucode":"04FD2412BB30D3","user_header":"https://static001.geekbang.org/account/avatar/00/24/1b/28/3e7a2916.jpg","comment_is_top":false,"comment_ctime":1629099456,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1629099456","product_id":100020801,"comment_content":"undo log不需要参与 两阶段吗？为什么毫无存在感？","like_count":0},{"had_liked":false,"id":307230,"user_name":"卢本伟","can_delete":false,"product_type":"c1","uid":1941856,"ip_address":"","ucode":"E03B9949016930","user_header":"https://static001.geekbang.org/account/avatar/00/1d/a1/60/98f81f78.jpg","comment_is_top":false,"comment_ctime":1628951358,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1628951358","product_id":100020801,"comment_content":"记录redo log的时候（还未写到磁盘），断电了。这样不算数据丢失？","like_count":0},{"had_liked":false,"id":307156,"user_name":"@彤彤@","can_delete":false,"product_type":"c1","uid":1792133,"ip_address":"","ucode":"282B74E29A8E99","user_header":"https://static001.geekbang.org/account/avatar/00/1b/58/85/b5d857d3.jpg","comment_is_top":false,"comment_ctime":1628912668,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1628912668","product_id":100020801,"comment_content":"老师 您好，可以理解成redo 是一本书的目录，只是大概概括什么事情，binlog是正文，具体细致的讲述事情的全过程吗？","like_count":0},{"had_liked":false,"id":306520,"user_name":"咦","can_delete":false,"product_type":"c1","uid":2283781,"ip_address":"","ucode":"2E0D5A488489A4","user_header":"https://static001.geekbang.org/account/avatar/00/22/d9/05/0d772dbf.jpg","comment_is_top":false,"comment_ctime":1628592669,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1628592669","product_id":100020801,"comment_content":"说白了很清楚的一个事儿<br>相当于redo log更多的是做一个近期数据的记录，记录sql对数据做了哪些改动，<br><br>binlog就是相当于每条sql都是啥，相当于记录执行了哪些sql的一个日志而已<br><br>两阶段提交更多的是保证redo log和bin log的一个数据一致性而已，要么sql在两个日志中都存在，要么都不存在，如果一个存在一个不存在，那就是sql正在执行中，本次sql尚未提交，如果数据不一致会导致数据恢复时，两个日志不一样从而恢复出错，日志混乱<br><br>楼主，这上面说的有问题吗？还有一个哈。为啥要有redo log呢，我感觉这玩意儿就像一个缓存一样的东西，没有这个问题也不算很大，多加了这个，好处在哪里？","like_count":0},{"had_liked":false,"id":306405,"user_name":"Geek_08cc54","can_delete":false,"product_type":"c1","uid":2648302,"ip_address":"","ucode":"1C2533E40448A5","user_header":"","comment_is_top":false,"comment_ctime":1628531266,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1628531266","product_id":100020801,"comment_content":"redo log是server层记录，bin log是什么innoDB记录的；redo log记录了做了什么操作，bin log记录了数据变为了什么；redo log采用循环的方式，bin log追加的方式。执行更新语句的时候会先在内存中查找，未找到会从磁盘中寻找，找到后更新数据，并且记录在redo log中，第二阶段记录在bin log中。使用这两者事物操作可以确保一致性。<br><br>一天一备份还是一周一备份取决于数据的重要程度。<br>一天一备份的bin log目录小，查找起来更加方便。<br>一周一备份bin log占用空间大，寻找其中的一秒相比一天一备份麻烦。","like_count":0},{"had_liked":false,"id":306107,"user_name":"Geek_8c0618","can_delete":false,"product_type":"c1","uid":2009485,"ip_address":"","ucode":"46AB431B57B32F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eocvvlibbfYw4wezziaBKn2OLDpvTndicPr21ZZoeiaM5QLibICy7PJPQibCAz5zfMe08ibem7ll3LSzkWaQ/132","comment_is_top":false,"comment_ctime":1628353257,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1628353257","product_id":100020801,"comment_content":"一天一备 恢复扩容都比较快","like_count":0},{"had_liked":false,"id":305922,"user_name":"Geek2808","can_delete":false,"product_type":"c1","uid":2028948,"ip_address":"","ucode":"835C9691723163","user_header":"","comment_is_top":false,"comment_ctime":1628232721,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1628232721","product_id":100020801,"comment_content":"老师好，有一个问题想不明白。redo log相当于粉板，会隔一段时间才去刷盘，那如果这中间有对redo log中的这些发生变更数据的查询动作，而更改后的数据还没有刷新到磁盘中，这种情况MySQL是怎么处理的？此外查询操作还涉及到隔离级别，比如可重复读，那对于还没来得及落盘的数据，MySQL是怎么同时保证隔离级别下的读操作的？难不成是直接读内存中更新后的数据，然后内存中的数据行也要加上mvcc那种事务id吗？","like_count":0},{"had_liked":false,"id":305265,"user_name":"邓傲松","can_delete":false,"product_type":"c1","uid":1825941,"ip_address":"","ucode":"908314110DAAB1","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erlfNLObLHtVAuyAks6qXYg19fW601kjsPS5M6ibor9eyGuo3iboyXTzMbET4UMnu72aqKFIdO6aJcg/132","comment_is_top":false,"comment_ctime":1627895815,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627895815","product_id":100020801,"comment_content":"老师您好，想请教一个点，为什么说只有redo log有crash safe的能力呢，是因为bin log采用添加写的形式，文件数据太大，造成恢复缓慢吗？感觉它们之间的关系和redis里的AOF和RDB比较像。。","like_count":0},{"had_liked":false,"id":305064,"user_name":"佐智","can_delete":false,"product_type":"c1","uid":2709634,"ip_address":"","ucode":"493638FC1AF876","user_header":"https://static001.geekbang.org/account/avatar/00/29/58/82/f186a477.jpg","comment_is_top":false,"comment_ctime":1627797744,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627797744","product_id":100020801,"comment_content":"两阶段提交这个原理讲的不是很透彻，应该从正面解释原理，应该讲讲两阶段提交在系统发生了crash之后恢复系统时，redo log 是如何通过binlog 决定是 rollback 还是 commit。<br>这里我认为也不适合用反证法，解决方案还有其他很多种，两阶段提交只是其中一种，应该着重解释它的合理性","like_count":0},{"had_liked":false,"id":305049,"user_name":"ling","can_delete":false,"product_type":"c1","uid":1477373,"ip_address":"","ucode":"B07B936546A824","user_header":"https://wx.qlogo.cn/mmopen/vi_32/ekMuS3vjaNNpAjAU8oX4195yxib0TfqzVOjbiclRKN89yNoUjmXSTO6Gzv0OJtyAryaNqlukMpR81yK1o9HELchg/132","comment_is_top":false,"comment_ctime":1627790065,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627790065","product_id":100020801,"comment_content":"如果redo log不及时写入磁盘的话，这个时候有查询操作岂不是不同步了？","like_count":0},{"had_liked":false,"id":305047,"user_name":"ling","can_delete":false,"product_type":"c1","uid":1477373,"ip_address":"","ucode":"B07B936546A824","user_header":"https://wx.qlogo.cn/mmopen/vi_32/ekMuS3vjaNNpAjAU8oX4195yxib0TfqzVOjbiclRKN89yNoUjmXSTO6Gzv0OJtyAryaNqlukMpR81yK1o9HELchg/132","comment_is_top":false,"comment_ctime":1627789738,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627789738","product_id":100020801,"comment_content":"redo log用来更新数据到磁盘的，binlog主要用来备份数据，也就是数据库出现问题后，恢复的数据要通过binlog来恢复","like_count":0},{"had_liked":false,"id":304706,"user_name":"somenzz","can_delete":false,"product_type":"c1","uid":1187197,"ip_address":"","ucode":"EA59A170DF8910","user_header":"https://static001.geekbang.org/account/avatar/00/12/1d/7d/368df396.jpg","comment_is_top":false,"comment_ctime":1627559141,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627559141","product_id":100020801,"comment_content":"老师提到 redo log 在空间不够的情况下会刷页（写数据到磁盘文件），假如空间够的情况下，是否就不刷页，这样的话，查询操作时，查询缓存未命中的情况下，那么执行器是会调用存储引擎去 redo log 文件里面查数据吗？","like_count":0},{"had_liked":false,"id":304012,"user_name":"书山有路","can_delete":false,"product_type":"c1","uid":2458238,"ip_address":"","ucode":"F6330BBED8BE01","user_header":"https://static001.geekbang.org/account/avatar/00/25/82/7e/743d3a1e.jpg","comment_is_top":false,"comment_ctime":1627182684,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627182684","product_id":100020801,"comment_content":"小林老师您好，您在这一讲中关于查询缓存清理时机的说法我有一点疑问，既然MySQL是在分析器处理阶段才知道是update还是select，那么查询缓存到底应该是在什么时候做的清理操作呢？","like_count":0},{"had_liked":false,"id":303878,"user_name":"N","can_delete":false,"product_type":"c1","uid":2676401,"ip_address":"","ucode":"CB28879A0649D0","user_header":"https://static001.geekbang.org/account/avatar/00/28/d6/b1/7c6e6363.jpg","comment_is_top":false,"comment_ctime":1627042846,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627042846","product_id":100020801,"comment_content":"老师您好，我想问一下如果在binlog写之前崩溃，重启恢复时的流程是怎么样的？数据回滚，redolog中的指针也会恢复到事务开始的位置吗？","like_count":0},{"had_liked":false,"id":303359,"user_name":"BCool","can_delete":false,"product_type":"c1","uid":2689813,"ip_address":"","ucode":"E6C2B78F379988","user_header":"https://static001.geekbang.org/account/avatar/00/29/0b/15/d2b7d7be.jpg","comment_is_top":false,"comment_ctime":1626750472,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1626750472","product_id":100020801,"comment_content":"既然已经有binlog了，为什么还需要多一个的redo log呢?虽然是innodb特有的，这样不就多了一次写文件吗？","like_count":0},{"had_liked":false,"id":303339,"user_name":"dst","can_delete":false,"product_type":"c1","uid":1861196,"ip_address":"","ucode":"9177BBB6C8B905","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKx6EdicYYuYK745brMa9yAlkZs2YmzxRAm4BQ2kw9GbtcC8ebnQlyBfIJnGjH57ib4HVlQIpSbTrBw/132","comment_is_top":false,"comment_ctime":1626743009,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1626743009","product_id":100020801,"comment_content":"一天一备份的优势在于，数据恢复的时候恢复速度会快很多，需要加载的binlog要小。尤其是在更新数据很频繁的时候","like_count":0},{"had_liked":false,"id":303271,"user_name":"我不会敲代码","can_delete":false,"product_type":"c1","uid":1564618,"ip_address":"","ucode":"066AB3B7D9F7CE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eofl7wbZfn2ONSDZ6EqLW6xwESKavMBTbHqYvqf6iadzhAOVlWJ788TiaoFRj7IYQC7UTIENkALXIqA/132","comment_is_top":false,"comment_ctime":1626695342,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1626695342","product_id":100020801,"comment_content":"孔乙己里面提到的黑板，我认为更像是Buffer Pool的功能，数据的修改，先在Buffer Pool中进行，修改完之后，再在系统空闲的时候持久化到磁盘中。期间，就会存在脏页的现象，即Buffer Pool中有数据库没有更新的数据，而redo log就是解决数据库crash的时候，脏页没有持久化到磁盘这样的一个问题。在系统恢复的时候，通过将redo log写入Buffer Pool，来恢复数据。","like_count":0},{"had_liked":false,"id":303113,"user_name":"BeckerHan","can_delete":false,"product_type":"c1","uid":1906047,"ip_address":"","ucode":"110F02EE6E4CD2","user_header":"https://static001.geekbang.org/account/avatar/00/1d/15/7f/739b643a.jpg","comment_is_top":false,"comment_ctime":1626598218,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1626598218","product_id":100020801,"comment_content":"redolog 在mysql进程崩溃后是如何重放的，如果redolog的数据，记录在内存里，还没有刷盘，这时机器重启了，内存没了，那原先redolog的数据不就也没了?","like_count":0},{"had_liked":false,"id":302707,"user_name":"Dobbykim","can_delete":false,"product_type":"c1","uid":1882279,"ip_address":"","ucode":"9CF18A328711F3","user_header":"https://static001.geekbang.org/account/avatar/00/1c/b8/a7/e2bae013.jpg","comment_is_top":false,"comment_ctime":1626342152,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1626342152","product_id":100020801,"comment_content":"老师，redo log  和 redo log buffer，os buffer ，buffer pool、log file，到底是啥关系啊。。。我真的搞晕了，希望有人救一救我！","like_count":0},{"had_liked":false,"id":302689,"user_name":"Dobbykim","can_delete":false,"product_type":"c1","uid":1882279,"ip_address":"","ucode":"9CF18A328711F3","user_header":"https://static001.geekbang.org/account/avatar/00/1c/b8/a7/e2bae013.jpg","comment_is_top":false,"comment_ctime":1626334154,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1626334154","product_id":100020801,"comment_content":"老师 ，实在是不知道 redo log ，redo log buffer ，os buffer，log file 这些东西，在网上众说纷纭，答案更是良莠不齐，我也不知道谁说的对。这些名词到底是啥意思？可以解释一下么？救救孩子吧，被困了一天了","like_count":0},{"had_liked":false,"id":302688,"user_name":"Dobbykim","can_delete":false,"product_type":"c1","uid":1882279,"ip_address":"","ucode":"9CF18A328711F3","user_header":"https://static001.geekbang.org/account/avatar/00/1c/b8/a7/e2bae013.jpg","comment_is_top":false,"comment_ctime":1626333179,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1626333179","product_id":100020801,"comment_content":"老师，我想问一下，redo log，redo log buffer，buffer pool 这些都是什么意思，我从笔记里面看到这些名词，不是很懂","like_count":0},{"had_liked":false,"id":301939,"user_name":"Geek_3497a3","can_delete":false,"product_type":"c1","uid":2563444,"ip_address":"","ucode":"5465E74DBDBBDF","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqZrWgR4rnT5gFuVKq0VHDFkx6hjiaIEh7FLFXcceTBVaey0fyhv21xhtDrDDd3hgibdMm4DiccVpxaw/132","comment_is_top":false,"comment_ctime":1625989328,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625989328","product_id":100020801,"comment_content":"老师我冒胆问一下，执行器更新完值之后会调用引擎进行写入，写入到哪？写入到内存嘛？如果写入到内存，那为什么引擎还要更新数据行到内存？写入和更新不是一件事嘛？","like_count":0},{"had_liked":false,"id":301684,"user_name":"胡志聰","can_delete":false,"product_type":"c1","uid":2500335,"ip_address":"","ucode":"7003A094FAB027","user_header":"https://static001.geekbang.org/account/avatar/00/26/26/ef/86944a28.jpg","comment_is_top":false,"comment_ctime":1625810003,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625810003","product_id":100020801,"comment_content":"老师，我想问两阶段提交的时候，redo log 改成 commit 失败会怎样处理呢？","like_count":0},{"had_liked":false,"id":301310,"user_name":"Geek_5f2ccd","can_delete":false,"product_type":"c1","uid":2534827,"ip_address":"","ucode":"4E66416BD9ECD8","user_header":"","comment_is_top":false,"comment_ctime":1625626841,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625626841","product_id":100020801,"comment_content":"为什么说binlog 不能保证crash-safe呢？不是可以通过数据出问题前最近一次备份数据，加上binlog日志恢复吗？","like_count":0},{"had_liked":false,"id":301205,"user_name":"Geek_5f2ccd","can_delete":false,"product_type":"c1","uid":2534827,"ip_address":"","ucode":"4E66416BD9ECD8","user_header":"","comment_is_top":false,"comment_ctime":1625574250,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625574250","product_id":100020801,"comment_content":"个人认为redolog拿粉版举例不恰当，redolog记录前，做了以下处理：1、先进行了判断，如果更新数据行所在数据页在内存中，如果数据页不在内存，则将数据从磁盘读入了内存；2、更新内存中的行数据，写入新行到内存并记录redolog。而粉版只是记录更新语句，应该类比binlog更恰当","like_count":0},{"had_liked":false,"id":301143,"user_name":"Levi","can_delete":false,"product_type":"c1","uid":2221236,"ip_address":"","ucode":"F804879872BB76","user_header":"https://static001.geekbang.org/account/avatar/00/21/e4/b4/889954ca.jpg","comment_is_top":false,"comment_ctime":1625552239,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625552239","product_id":100020801,"comment_content":"老师，反证法第一种情况，既然redolog就能恢复数据，那为嘛还要用biglog去恢复呢，不用binlog不就不会造成临时库和原库不一样了吗？","like_count":0},{"had_liked":false,"id":300972,"user_name":"老夫子穿袈裟","can_delete":false,"product_type":"c1","uid":1634466,"ip_address":"","ucode":"3238BDAE0CDAF1","user_header":"https://static001.geekbang.org/account/avatar/00/18/f0/a2/e5d7dfd8.jpg","comment_is_top":false,"comment_ctime":1625472972,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625472972","product_id":100020801,"comment_content":"有个疑问点：<br><br>如果有多条更新SQL语句<br>update tableA set val = val+1 where id=1;<br>update tableA set val = val+1 where id=2;<br>update tableA set val = val+1 where id=3;<br>在执行过程中，redo log 和 binlog 是怎么记录的呢，先写 redo log 再写 binlog ，三条语句的流程都是这样么？如果 id = 1和id = 2都执行了，执行 id = 3 时MySQL宕机了，再重启该怎么恢复呢？","like_count":0},{"had_liked":false,"id":300699,"user_name":"walzzz","can_delete":false,"product_type":"c1","uid":1707393,"ip_address":"","ucode":"17D8079494189A","user_header":"https://static001.geekbang.org/account/avatar/00/1a/0d/81/ed4957e8.jpg","comment_is_top":false,"comment_ctime":1625314995,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1625314995","product_id":100020801,"comment_content":"有两个问题，请老师指教：<br><br>1、两阶段提交，最后commit的时候是到磁盘找回原来的redo日志修改状态还是直接追加？<br><br>2、一个没有提交的事务A，它的redo日志有可能在其他事务提交的时候一起从redo buffer刷盘，后面事务A提交的时候，是到磁盘找回原来的redo日志修改成prepare状态还是直接追加？如果是找回原来的日志修改，那假设这个事务A长时间不提交，那么日志文件循环写必定会将这个没提交的日志覆盖，这个问题是怎么处理的？","like_count":0},{"had_liked":false,"id":300665,"user_name":"山大大大大","can_delete":false,"product_type":"c1","uid":1150279,"ip_address":"","ucode":"9E7D9EB804AAE4","user_header":"https://static001.geekbang.org/account/avatar/00/11/8d/47/c5da0357.jpg","comment_is_top":false,"comment_ctime":1625298715,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625298715","product_id":100020801,"comment_content":"小白请教一个问题：如果redo log 和bin log都是每次刷盘，还会出现脏页吗？脏页在什么时候产生一直不是很明白。","like_count":0},{"had_liked":false,"id":299980,"user_name":"prader26","can_delete":false,"product_type":"c1","uid":1433707,"ip_address":"","ucode":"5EFFFC374ADECE","user_header":"https://static001.geekbang.org/account/avatar/00/15/e0/6b/f61d7466.jpg","comment_is_top":false,"comment_ctime":1624945238,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624945238","product_id":100020801,"comment_content":"redo log<br>当数据库更新一条记录的时候，innoDB 引擎，会先把记录写道redo log 中，并更新内存，这个时候更新就算完成了。当系统比较<br>空闲的时候，再读取redo log 中的记录把更新信息记录到磁盘中。 因此数据库就具备了 crash-safe 能力。<br>binlog<br>mysql 分为两块:一块是server 层，主要是做mysql功能层面的事情；另一块是引擎层，负责存储相关事宜。redo log 是innoDB 引擎特有的日志。而server 层的日志就是binlog<br><br>这两个log 为保证数据一致性，是2 阶段提交的。","like_count":0},{"had_liked":false,"id":299842,"user_name":"hyh","can_delete":false,"product_type":"c1","uid":1078419,"ip_address":"","ucode":"6910A08EB8DD84","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/sNib6T0m9lMhehC4gJrwwAShQavsoCiaic7rtEDdAv0gnQtrslibPRe24b7cvlpSQn05AylSn76fnI94mQuUBfodRg/132","comment_is_top":false,"comment_ctime":1624882010,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624882010","product_id":100020801,"comment_content":"有个疑问❓假如数据暂时在redo log那里，还没同步到磁盘，这时有一个查询该条数据的查询进来，mysql怎么处理😳还有redo log也要持久化到文件，这里也有磁盘IO的开销，好像也不比直接同步到磁盘低多少吧？","like_count":0},{"had_liked":false,"id":299049,"user_name":"夏清优","can_delete":false,"product_type":"c1","uid":2409331,"ip_address":"","ucode":"257C642ADAAEE3","user_header":"https://static001.geekbang.org/account/avatar/00/24/c3/73/341d44d2.jpg","comment_is_top":false,"comment_ctime":1624439212,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624439212","product_id":100020801,"comment_content":"老师，这个有个疑问，binlog记录了逻辑日志，当系统异常奔溃后，为什么不可以通过binlog恢复crash前的状态呢？","like_count":0},{"had_liked":false,"id":298552,"user_name":"Geek_62f8f3","can_delete":false,"product_type":"c1","uid":1902437,"ip_address":"","ucode":"147DD53FBF1D1B","user_header":"https://static001.geekbang.org/account/avatar/00/1d/07/65/47bfd83c.jpg","comment_is_top":false,"comment_ctime":1624188528,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624188528","product_id":100020801,"comment_content":"根据高枕的评论：<br><br>我再来说下自己的理解 。<br>1 prepare阶段 2 写binlog 3 commit<br>当在2之前崩溃时<br>重启恢复：后发现没有commit，回滚。备份恢复：没有binlog 。<br>一致<br>当在3之前崩溃<br>重启恢复：虽没有commit，但满足prepare和binlog完整，所以重启后会自动commit。备份：有binlog. 一致<br><br>追问一个问题，如何判断binlog是否完整？","like_count":0},{"had_liked":false,"id":298361,"user_name":"绝影","can_delete":false,"product_type":"c1","uid":1437760,"ip_address":"","ucode":"EA3C85D21DE210","user_header":"https://static001.geekbang.org/account/avatar/00/15/f0/40/219be32a.jpg","comment_is_top":false,"comment_ctime":1624059114,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624059114","product_id":100020801,"comment_content":"要理解 crash-safe 这个概念，可以想想我们前面赊账记录的例子。只要赊账记录记在了粉板上或写在了账本上，之后即使掌柜忘记了，比如突然停业几天，恢复生意后依然可以通过账本和粉板上的数据明确赊账账目。这里描述恢复生意不应该是环型队列中的数据吗？账本的数据应该是类似数据库中已经存在的数据，已经持久化写到磁盘了，即使发生意外明确账目的应该是粉板上的数据而和数据库中存在数据无关吧？","like_count":0},{"had_liked":false,"id":297602,"user_name":"精神病","can_delete":false,"product_type":"c1","uid":1199038,"ip_address":"","ucode":"3066FE896874E4","user_header":"https://static001.geekbang.org/account/avatar/00/12/4b/be/83cbb285.jpg","comment_is_top":false,"comment_ctime":1623661774,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1623661774","product_id":100020801,"comment_content":"两阶段提交：写入了relog处于prepare状态，也写入了binlog, 如果这时断电，即最后一步commit 没有执行，会出现什么情况？","like_count":0},{"had_liked":false,"id":296808,"user_name":"赵明宇","can_delete":false,"product_type":"c1","uid":2647421,"ip_address":"","ucode":"42E86A881A749A","user_header":"https://static001.geekbang.org/account/avatar/00/28/65/7d/d07435d0.jpg","comment_is_top":false,"comment_ctime":1623166273,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1623166273","product_id":100020801,"comment_content":"作为小白，其实第一次看的时候多半是懵懂<br>大家也不要心灰意冷，多看几遍，过几天再看一遍<br>大家一起加油！<br><br>redo log负责事务，binlog负责归档恢复<br>两者独立的逻辑，各司其职<br>两阶段提交就是让这两个状态保持逻辑上的一致<br>相互配合，才保证现有功能的完整性","like_count":0},{"had_liked":false,"id":296615,"user_name":"jasen","can_delete":false,"product_type":"c1","uid":2595680,"ip_address":"","ucode":"E0B7A5F82E247F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLq1w2nAUjZRccn8HJONc7WguHVPY5egD7DjNVDtQdoyicaycyQOPRj939ZnxRqkd4dPEATAicgUJAA/132","comment_is_top":false,"comment_ctime":1623064942,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1623064942","product_id":100020801,"comment_content":"redo log处于prepare即将修改为commit的时候crash了，binlog已经记录了 redolog还处于prepare阶段，会出现不一致吗？","like_count":0},{"had_liked":false,"id":296226,"user_name":"星航","can_delete":false,"product_type":"c1","uid":1238493,"ip_address":"","ucode":"6EED7D82272EFC","user_header":"https://static001.geekbang.org/account/avatar/00/12/e5/dd/3218199d.jpg","comment_is_top":false,"comment_ctime":1622817888,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622817888","product_id":100020801,"comment_content":"请问redo log是要实时保存在硬盘吗？","like_count":0},{"had_liked":false,"id":296045,"user_name":"T","can_delete":false,"product_type":"c1","uid":1034596,"ip_address":"","ucode":"99F29046BD0951","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c9/64/df5fec76.jpg","comment_is_top":false,"comment_ctime":1622714845,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622714845","product_id":100020801,"comment_content":"老师，undo log是在哪个过程写入的","like_count":0},{"had_liked":false,"id":295996,"user_name":"南顺城街","can_delete":false,"product_type":"c1","uid":2644383,"ip_address":"","ucode":"0BDC30E5FBB0C8","user_header":"https://static001.geekbang.org/account/avatar/00/28/59/9f/fb04a5fd.jpg","comment_is_top":false,"comment_ctime":1622697050,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622697050","product_id":100020801,"comment_content":"老师您好，如果更新内存后没来得及写 redo log怎么办<br>","like_count":0},{"had_liked":false,"id":295757,"user_name":"本来是亚","can_delete":false,"product_type":"c1","uid":1073592,"ip_address":"","ucode":"14527E5BC3C2A8","user_header":"https://static001.geekbang.org/account/avatar/00/10/61/b8/7b23f8cb.jpg","comment_is_top":false,"comment_ctime":1622592811,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1622592811","product_id":100020801,"comment_content":"一天一备在恢复目标的时候所用的时间更短，但是相应地需要耗费更多的存储空间","like_count":0},{"had_liked":false,"id":295474,"user_name":"zodas","can_delete":false,"product_type":"c1","uid":1356210,"ip_address":"","ucode":"301660D6EC0E94","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqnwc76trn2r8AmOibCLgQaQTxUmueVzV0Wy2tawx6Od41gUCOQicGD3KYa6gtAp0zjY5nOl1cI4huw/132","comment_is_top":false,"comment_ctime":1622443477,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622443477","product_id":100020801,"comment_content":"看了下，mysql 服务器上的日志目录，里面还有个 undo 日志，undo 跟 redolog、binlog 是如何协作的？","like_count":0},{"had_liked":false,"id":295441,"user_name":"加肥猫","can_delete":false,"product_type":"c1","uid":1354689,"ip_address":"","ucode":"8E75BD31143F78","user_header":"https://static001.geekbang.org/account/avatar/00/14/ab/c1/f50b1fde.jpg","comment_is_top":false,"comment_ctime":1622431586,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622431586","product_id":100020801,"comment_content":"老师 有没有可能存在写入binlog后 到redo_log提交前中间发送错误的可能性，如果发现了这种情况会有什么影响？","like_count":0},{"had_liked":false,"id":294973,"user_name":"Jaden~お張嘉楽","can_delete":false,"product_type":"c1","uid":1803215,"ip_address":"","ucode":"FA2737D6A1D2C9","user_header":"https://static001.geekbang.org/account/avatar/00/1b/83/cf/1f3b5b17.jpg","comment_is_top":false,"comment_ctime":1622168718,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622168718","product_id":100020801,"comment_content":"数据页是否在内存中？　这个数据页是什么出现的呢？<br>是对于同一个session中，只要有过查询就会保存这个数据页么？","like_count":0},{"had_liked":false,"id":294836,"user_name":"Alpha 👀","can_delete":false,"product_type":"c1","uid":1200971,"ip_address":"","ucode":"3C0BAD36550718","user_header":"https://static001.geekbang.org/account/avatar/00/12/53/4b/28991f30.jpg","comment_is_top":false,"comment_ctime":1622106666,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622106666","product_id":100020801,"comment_content":"老师，请问下为什么redo log要使用多个文件循环的方式，而不是使用一个大文件呢？","like_count":0},{"had_liked":false,"id":294615,"user_name":"L","can_delete":false,"product_type":"c1","uid":2450360,"ip_address":"","ucode":"588BC2DF8ABEB4","user_header":"https://static001.geekbang.org/account/avatar/00/25/63/b8/3f2aa709.jpg","comment_is_top":false,"comment_ctime":1622019046,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622019046","product_id":100020801,"comment_content":"老师好，在sync_binlog设置成1时，是不是就不需要redo log的crash-safe能力了？","like_count":0},{"had_liked":false,"id":293862,"user_name":"没伞的孩子得使劲奔跑","can_delete":false,"product_type":"c1","uid":1145779,"ip_address":"","ucode":"D015B4EF12E536","user_header":"https://static001.geekbang.org/account/avatar/00/11/7b/b3/194f7f90.jpg","comment_is_top":false,"comment_ctime":1621580717,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1621580717","product_id":100020801,"comment_content":"如果redo log 和 binlog 参数都是设置1 ，那不是对IO影响很大？","like_count":0},{"had_liked":false,"id":293419,"user_name":"Z","can_delete":false,"product_type":"c1","uid":1257299,"ip_address":"","ucode":"8E56D0618F1B76","user_header":"https://static001.geekbang.org/account/avatar/00/13/2f/53/f17cfee2.jpg","comment_is_top":false,"comment_ctime":1621386996,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621386996","product_id":100020801,"comment_content":"在主从模式下 binlog 写入磁盘了，还没来得及提交事务，数据库就宕机了，从库读取binlog不是会造成主从不一致吗？","like_count":0},{"had_liked":false,"id":293261,"user_name":"张三丰","can_delete":false,"product_type":"c1","uid":1155275,"ip_address":"","ucode":"3A6215A40B3B21","user_header":"https://static001.geekbang.org/account/avatar/00/11/a0/cb/aab3b3e7.jpg","comment_is_top":false,"comment_ctime":1621311968,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621311968","product_id":100020801,"comment_content":"还是有问题<br><br>如果prepare和binlog不完整呢？ prepare阶段redo log 持久化了  ，这时候mysql宕机  ，事务回滚，已经持久化的redo log怎么办？  是删除还是保留？如果保留，虽然不会被其他事务读到但是有浪费资源的嫌疑，当mysql恢复的时候这段持久化的redo log会被重新加载至内存？然后根据这段redo log 重放 binlog？","like_count":0},{"had_liked":false,"id":293178,"user_name":"Geek_8379ad","can_delete":false,"product_type":"c1","uid":1485206,"ip_address":"","ucode":"BC10846A3D3CFB","user_header":"","comment_is_top":false,"comment_ctime":1621255656,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1621255656","product_id":100020801,"comment_content":"你好，我有个以为，后面讲的更新流程为： 1. 写入redolog处于prepare阶段，2.写入binlog，3. 提交事务处理commit状态。如果完成1、2后，mysql服务挂了，那对与innodb引擎来说，redolog还处于prepare阶段，写入不生效，而对于binlog来说，以及写入更新，这样不还是会出现redolog和binlog不一致的情况吗？","like_count":0,"discussions":[{"author":{"id":1637619,"avatar":"https://static001.geekbang.org/account/avatar/00/18/fc/f3/28fe16cf.jpg","nickname":"意琦行","note":"","ucode":"B940AA60B5CCEE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393173,"discussion_content":"恢复的时候如果 binlog 完整那么处于 prepare 状态的 redo log 也算是提交成功的，也会恢复。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631276679,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":292990,"user_name":"二两油","can_delete":false,"product_type":"c1","uid":1848814,"ip_address":"","ucode":"849BF467F9F75B","user_header":"https://static001.geekbang.org/account/avatar/00/1c/35/ee/481ad097.jpg","comment_is_top":false,"comment_ctime":1621146569,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621146569","product_id":100020801,"comment_content":"binlog已经写了，redolog还是prepare状态，会不会由于一些原因导致此时没有commit？如果真发生这样的事情系统会怎么样？此时怎么保证逻辑一致的？","like_count":0},{"had_liked":false,"id":292634,"user_name":"Geek_24d27b","can_delete":false,"product_type":"c1","uid":1625645,"ip_address":"","ucode":"B52AB6E73F6A0E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Gf2QrwPGnMzia7UbNZvAqDOHZZXFyibnUUsc7JrLggqUC2Mw0UneEBP9KicP8Dic30O22XrOz1cB3DatE4NxGpbIlA/132","comment_is_top":false,"comment_ctime":1620905955,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1620905955","product_id":100020801,"comment_content":"redolog是事务才有的，还是所有写入&#47;更新&#47;删除语录都有的？","like_count":0},{"had_liked":false,"id":292368,"user_name":"建强","can_delete":false,"product_type":"c1","uid":1397126,"ip_address":"","ucode":"62B03D0E0C64EC","user_header":"https://static001.geekbang.org/account/avatar/00/15/51/86/b5fd8dd8.jpg","comment_is_top":false,"comment_ctime":1620797593,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1620797593","product_id":100020801,"comment_content":"思考题：对于某些重要的、不可间断的业务，比如银行的存、取款业务，需要采用一天一备，这样当系统发生故障时，可以用前一天的备份加上binlog和redolog可以使系统快速恢复到故障前的状态，备份周期影响系统的故障恢复时间。","like_count":0},{"had_liked":false,"id":292310,"user_name":"汉江","can_delete":false,"product_type":"c1","uid":1788647,"ip_address":"","ucode":"01622D984B8F9B","user_header":"https://static001.geekbang.org/account/avatar/00/1b/4a/e7/6c16af5d.jpg","comment_is_top":false,"comment_ctime":1620780792,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1620780792","product_id":100020801,"comment_content":"老师想问一下 两阶段提交中prepare和commit 阶段都是在 begin&#47;commit 中的commit提交操作一起操作的吗？还是说 prepare阶段先 然后 begin&#47;commit的commit 操作 最后 commit提交？","like_count":0},{"had_liked":false,"id":292271,"user_name":"Manfestain","can_delete":false,"product_type":"c1","uid":2066081,"ip_address":"","ucode":"66DC6802F502E6","user_header":"https://static001.geekbang.org/account/avatar/00/1f/86/a1/1e474eb9.jpg","comment_is_top":false,"comment_ctime":1620747129,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1620747129","product_id":100020801,"comment_content":"老师好，请教一下如何理解redo log的prepare和commit状态？更新操作不是已经写到redo log了吗？","like_count":0},{"had_liked":false,"id":292075,"user_name":"Geek_yb","can_delete":false,"product_type":"c1","uid":2615876,"ip_address":"","ucode":"850ED56C2FE196","user_header":"https://static001.geekbang.org/account/avatar/00/27/ea/44/b6c628c6.jpg","comment_is_top":false,"comment_ctime":1620661367,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1620661367","product_id":100020801,"comment_content":"当需要恢复到指定的某一秒时，比如某天下午两点发现中午十二点有一次误删表，需要找回数据，那你可以这么做：<br>首先，找到最近的一次全量备份，如果你运气好，可能就是昨天晚上的一个备份，从这个备份恢复到临时库；<br>然后，从备份的时间点开始，将备份的 binlog 依次取出来，重放到中午误删表之前的那个时刻。<br><br><br><br>看蒙了，用binlog就能完成数据恢复了 那还要redolog干什么？","like_count":0},{"had_liked":false,"id":291541,"user_name":"Geek_da2941","can_delete":false,"product_type":"c1","uid":2612075,"ip_address":"","ucode":"B46B6BCC7C77CB","user_header":"","comment_is_top":false,"comment_ctime":1620355649,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1620355649","product_id":100020801,"comment_content":"老师好，有一点想不通。redolog的crash-safe能力意义到底在哪儿呢。<br>1.写入redolog 进入perpare状态<br>2.写入binlog<br>3.提交事务commit。<br>如果在1之后，数据库宕机了，那么重启的时候，发现binlog没有数据，那也就不会commit，选择回滚，那1这步就没意义了吧。<br>如果在2之后，宕机了，重启后，1,2数据一致，可以commit，但此时binlog也有数据了呀，就算没有redolog也能恢复备份呀。<br>所以redolog的crash-safe能力意义到底在哪儿呢。<br>麻烦老师和大家帮忙解惑一下。","like_count":0},{"had_liked":false,"id":290934,"user_name":"颜桦","can_delete":false,"product_type":"c1","uid":1099576,"ip_address":"","ucode":"1CD7250E052B32","user_header":"https://static001.geekbang.org/account/avatar/00/10/c7/38/d1a50cd6.jpg","comment_is_top":false,"comment_ctime":1619866019,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1619866019","product_id":100020801,"comment_content":"老师判断数据页是否在内存中这个和缓存有什么区别，什么样的数据会存放在内存中？","like_count":0},{"had_liked":false,"id":290925,"user_name":"颜桦","can_delete":false,"product_type":"c1","uid":1099576,"ip_address":"","ucode":"1CD7250E052B32","user_header":"https://static001.geekbang.org/account/avatar/00/10/c7/38/d1a50cd6.jpg","comment_is_top":false,"comment_ctime":1619861945,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1619861945","product_id":100020801,"comment_content":"redolog如果写满了会怎样，如果直接覆盖最新的记录那不就是数据丢失吗？","like_count":0},{"had_liked":false,"id":290366,"user_name":"ck","can_delete":false,"product_type":"c1","uid":1142348,"ip_address":"","ucode":"2335A22314296A","user_header":"https://static001.geekbang.org/account/avatar/00/11/6e/4c/494b2907.jpg","comment_is_top":false,"comment_ctime":1619516384,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1619516384","product_id":100020801,"comment_content":"redo log保证了了crash-safe 是因为redo log 使用了两阶段提交, 保证了日志和数据库类中数据的一致性么?","like_count":0},{"had_liked":false,"id":290251,"user_name":"一如既往","can_delete":false,"product_type":"c1","uid":2338074,"ip_address":"","ucode":"A3DD54A16556D8","user_header":"https://static001.geekbang.org/account/avatar/00/23/ad/1a/e258975e.jpg","comment_is_top":false,"comment_ctime":1619448759,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1619448759","product_id":100020801,"comment_content":"为什么只依靠binlog就没crash safe的能力呢？是因为mysql不是每个事务提交都及时刷盘的原因吗？","like_count":0},{"had_liked":false,"id":289928,"user_name":"佳成_Cahen","can_delete":false,"product_type":"c1","uid":2324353,"ip_address":"","ucode":"88091603E3AD9B","user_header":"https://static001.geekbang.org/account/avatar/00/23/77/81/9bc87164.jpg","comment_is_top":false,"comment_ctime":1619266780,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1619266780","product_id":100020801,"comment_content":"既然binlog也能储存做了什么操作，而crash-safe又是记录之前操作的能力，那为什么说binlog没有crash-safe能力呢","like_count":0},{"had_liked":false,"id":289589,"user_name":"藏锋","can_delete":false,"product_type":"c1","uid":1175246,"ip_address":"","ucode":"D5F811B16725A0","user_header":"https://static001.geekbang.org/account/avatar/00/11/ee/ce/c024a857.jpg","comment_is_top":false,"comment_ctime":1619090762,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1619090762","product_id":100020801,"comment_content":"我说下我的理解，之前这一点我是很纠结很困惑的。mysql恢复后是执行commit还是回滚，主要取决于MySQL是在写完binlog之后挂的还是在写binlog之前挂的，如果是在写binog之前挂的，那么就执行回滚，如果是在写binlog之后挂的，不管当时这个事务是否commit了,mysql恢复后都会当commit处理，就是做提交处理。是这样吗","like_count":0},{"had_liked":false,"id":289584,"user_name":"藏锋","can_delete":false,"product_type":"c1","uid":1175246,"ip_address":"","ucode":"D5F811B16725A0","user_header":"https://static001.geekbang.org/account/avatar/00/11/ee/ce/c024a857.jpg","comment_is_top":false,"comment_ctime":1619089546,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1619089546","product_id":100020801,"comment_content":"我的疑问是，redo log里的每条记录是否都包含了其事务执行的状态(commit和未commit)？如果包含事务执行状态那很好理解，mysql重启后通过读redo log就能知道这条写操作的事务是已提交还是未提交状态。但是如果redo log并不记录事务执行状态，那么MySQL故障重启后，在读取redo log里面的记录时，怎么判断是写磁盘还是不写到磁盘","like_count":0},{"had_liked":false,"id":289006,"user_name":"lleft","can_delete":false,"product_type":"c1","uid":1970443,"ip_address":"","ucode":"D573EB509455AE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIx1V1QAxC4NHaxYZGyuibBN8lcURJWc5nrnO4yic1kxnDemYV2FJGialf47kYX9qtDnZZOfe1SJeLicg/132","comment_is_top":false,"comment_ctime":1618818317,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618818317","product_id":100020801,"comment_content":"存储引擎层更新数据到内存，这个内存指的是查询缓存吗？","like_count":0},{"had_liked":false,"id":288737,"user_name":"Tomcat","can_delete":false,"product_type":"c1","uid":1399488,"ip_address":"","ucode":"58A9D44991EDB7","user_header":"https://static001.geekbang.org/account/avatar/00/15/5a/c0/e20eb855.jpg","comment_is_top":false,"comment_ctime":1618646972,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618646972","product_id":100020801,"comment_content":"如果在redo log commit 之前宕机 会发生什么，此时也记录了binlog 这里感觉文章的逻辑不严密","like_count":0},{"had_liked":false,"id":288644,"user_name":"三口一头猫","can_delete":false,"product_type":"c1","uid":1317496,"ip_address":"","ucode":"96261B6675E63B","user_header":"https://static001.geekbang.org/account/avatar/00/14/1a/78/74275977.jpg","comment_is_top":false,"comment_ctime":1618577029,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1618577029","product_id":100020801,"comment_content":"老师如果prepare阶段binlog也写了但是这个时候断电 redo log不会commit 那binlog就会多出来记录 这样redo log和binlog并不一致啊","like_count":0},{"had_liked":false,"id":288317,"user_name":"五厘米","can_delete":false,"product_type":"c1","uid":2563505,"ip_address":"","ucode":"01B7A12290AE26","user_header":"https://static001.geekbang.org/account/avatar/00/27/1d/b1/e8264c02.jpg","comment_is_top":false,"comment_ctime":1618405773,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618405773","product_id":100020801,"comment_content":"学习输出（希望老师能够批评指正）<br>1.一条DML语句执行在执行器执行后首先查看引擎的缓存页，如果命中（索引查询方式在引擎的方法中实现）则更新缓存页中对应的数据。<br>2.更新缓存页之后，引擎记录redolog为prestatas（先写到缓存区，等事务结束后在更新到磁盘中，或者每秒同步一次，更加实际情况设定）binlog也是一样的（在redolog写到缓存区的时候，binlog也是先写到缓存区）这里是否可能出现redolog的预提交状态没有更新到磁盘中，binlog已经更新到磁盘中了？或者我们不考虑记录缓存区的逻辑，只要考虑记录到磁盘中的顺序正确即可？？？？？<br><br><br>3.当redolog预备状态，binlog已记录后crash了，mysql恢复的时候是引擎做了判断rbinlog是否完整的逻辑吗？？？是哪个环节读取了redolog配置？ 是哪个环节读取了binlog进行数据库恢复的？","like_count":0},{"had_liked":false,"id":288233,"user_name":"EatheinWong","can_delete":false,"product_type":"c1","uid":1339339,"ip_address":"","ucode":"F1F1C20D3FF55B","user_header":"https://static001.geekbang.org/account/avatar/00/14/6f/cb/bacbfef6.jpg","comment_is_top":false,"comment_ctime":1618373799,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618373799","product_id":100020801,"comment_content":"笔记：redolog，具备crash safe能力，但因为存储有限，所以无法取代binlog。binlog具备归档功能，结合redolg也不怕crash。两者通过事务控制相互配合，保证了崩溃应对能力和数据备份能力。","like_count":0},{"had_liked":false,"id":288209,"user_name":"piboye","can_delete":false,"product_type":"c1","uid":1066752,"ip_address":"","ucode":"7CFD8712857A85","user_header":"https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg","comment_is_top":false,"comment_ctime":1618365649,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1618365649","product_id":100020801,"comment_content":"redo 是要求幂等， binlog 是没有幂等特性吧？","like_count":0},{"had_liked":false,"id":288025,"user_name":"龙猫","can_delete":false,"product_type":"c1","uid":1112490,"ip_address":"","ucode":"FD726CC969EF9C","user_header":"https://static001.geekbang.org/account/avatar/00/10/f9/aa/3e80212e.jpg","comment_is_top":false,"comment_ctime":1618277624,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618277624","product_id":100020801,"comment_content":"过段时间在看感觉不一样了，哈哈","like_count":0},{"had_liked":false,"id":287847,"user_name":"咱是吓大的","can_delete":false,"product_type":"c1","uid":1292324,"ip_address":"","ucode":"A47C6DA5C00C6F","user_header":"https://static001.geekbang.org/account/avatar/00/13/b8/24/039f84a2.jpg","comment_is_top":false,"comment_ctime":1618194383,"is_pvip":true,"discussion_count":0,"race_medal":4,"score":"1618194383","product_id":100020801,"comment_content":"没理解redo log 是为什么是 InnoDB 引擎特有的日志，“粉板”不是应该在内存里而没有在磁盘里的吗","like_count":0},{"had_liked":false,"id":287749,"user_name":"达叔灬","can_delete":false,"product_type":"c1","uid":2404887,"ip_address":"","ucode":"5CCBAF13548F02","user_header":"https://static001.geekbang.org/account/avatar/00/24/b2/17/3161b49c.jpg","comment_is_top":false,"comment_ctime":1618131645,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618131645","product_id":100020801,"comment_content":"对于恢复数据到任何一个时间点，binlog也可以实现，因为binlog中记录着数据操作的所有记录。<br>而redolog主要针对事务提交过程中MySQL发生crash时结合undolog来保证事物的完整性，已提交事务的数据不会丢失，未提交事务的数据进行回滚。<br>结合本文查阅了一些文章，这样理解正确吗?","like_count":0},{"had_liked":false,"id":287731,"user_name":"星环少年","can_delete":false,"product_type":"c1","uid":1012583,"ip_address":"","ucode":"75D5402A6CD724","user_header":"https://static001.geekbang.org/account/avatar/00/0f/73/67/eb6cee42.jpg","comment_is_top":false,"comment_ctime":1618128657,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618128657","product_id":100020801,"comment_content":"InnoDB 引擎就会先把记录写到 redo log（粉板）里面，并更新内存，这个时候更新就算完成了。<br>&gt;&gt; 请问这里的内存指的是什么内存？内存数据什么时候更新到磁盘的？","like_count":0},{"had_liked":false,"id":287661,"user_name":"达叔灬","can_delete":false,"product_type":"c1","uid":2404887,"ip_address":"","ucode":"5CCBAF13548F02","user_header":"https://static001.geekbang.org/account/avatar/00/24/b2/17/3161b49c.jpg","comment_is_top":false,"comment_ctime":1618074691,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618074691","product_id":100020801,"comment_content":"终于理解了文中redolog写满后罗盘原来是将对应内存中的mysql数据写入到磁盘中。","like_count":0},{"had_liked":false,"id":287587,"user_name":"Geek_a7fd0f","can_delete":false,"product_type":"c1","uid":1445778,"ip_address":"","ucode":"24C2FF3610FE9C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKhD6Zib0sPIL1ia8obYgICUCjhE3MKib647IVKibC1Qq7gFp31sagtLJ3OjdicibKw9DZMltG4Lj30icKlg/132","comment_is_top":false,"comment_ctime":1618040824,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618040824","product_id":100020801,"comment_content":"innodb_flush_log_at_trx_commit设置为1的话，是不是意味着check point永远在write_pos后，一个位置的地方啊？不知道还有没有人回答","like_count":0},{"had_liked":false,"id":287505,"user_name":"RobinHcI","can_delete":false,"product_type":"c1","uid":2554543,"ip_address":"","ucode":"47C731D9CB999E","user_header":"https://static001.geekbang.org/account/avatar/00/26/fa/af/c542616a.jpg","comment_is_top":false,"comment_ctime":1617980732,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617980732","product_id":100020801,"comment_content":"除了涉及redo log , binlog 应该还有undo的更新吧？否则如何实现MVCC","like_count":0},{"had_liked":false,"id":287443,"user_name":"懒。","can_delete":false,"product_type":"c1","uid":1347830,"ip_address":"","ucode":"BF8F5390AC69DF","user_header":"https://static001.geekbang.org/account/avatar/00/14/90/f6/c2192c91.jpg","comment_is_top":false,"comment_ctime":1617952681,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617952681","product_id":100020801,"comment_content":"老师，请问innodb的增删改操作是不是都会创建事务的？","like_count":0},{"had_liked":false,"id":287315,"user_name":"王凯","can_delete":false,"product_type":"c1","uid":1746317,"ip_address":"","ucode":"3A8FE67E83E73F","user_header":"https://static001.geekbang.org/account/avatar/00/1a/a5/8d/839becc5.jpg","comment_is_top":false,"comment_ctime":1617879274,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617879274","product_id":100020801,"comment_content":"什么叫做逻辑日志，什么叫做物理日志？","like_count":0},{"had_liked":false,"id":287249,"user_name":"Geek_jerry","can_delete":false,"product_type":"c1","uid":1736148,"ip_address":"","ucode":"684923936D7849","user_header":"","comment_is_top":false,"comment_ctime":1617855428,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617855428","product_id":100020801,"comment_content":"为什么依赖binlog没有crash-safe的能力，binlog里不是会记录每次修改的内容吗？","like_count":0},{"had_liked":false,"id":287081,"user_name":"起风了","can_delete":false,"product_type":"c1","uid":2552749,"ip_address":"","ucode":"C2C3914C4C9E04","user_header":"https://static001.geekbang.org/account/avatar/00/26/f3/ad/47870aa9.jpg","comment_is_top":false,"comment_ctime":1617767130,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617767130","product_id":100020801,"comment_content":"老师您好, 这里有一个疑问麻烦您. <br>1. 文中前部分说到, 更新操作的时候会现写redo log, 然后在合适的时候在写入到binlog中, 后面的图例中又说更新操作的时候, redo log和binlog需要同时提交才行, 那么更新操作的时候redo log和binlog到底是先后执行还是同时执行呢?<br>2. 如果是先写redo log, 然后合适的时机再写binlog的话, 那万一中途出现问题, 如何保证redo log和binlog的内容一致呢?","like_count":0},{"had_liked":false,"id":286684,"user_name":"尼古拉斯","can_delete":false,"product_type":"c1","uid":1333065,"ip_address":"","ucode":"90291703BBF77C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLEhQyF89BRuFNHQEP6kPv1wKD56cC6dWhbooSFcdwA5B1Sg8EhWmzew0I6S0GqngOIGSvJ6MT5eQ/132","comment_is_top":false,"comment_ctime":1617500461,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617500461","product_id":100020801,"comment_content":"我觉得有一个地方没有说清楚，老师说到将数据写到磁盘很消耗性能，所以先写到redo log中，但是redo log也是写磁盘啊。应该说一下为什么写日志到磁盘比写更新数据到磁盘效率要高一些？","like_count":0},{"had_liked":false,"id":286498,"user_name":"君君","can_delete":false,"product_type":"c1","uid":1046711,"ip_address":"","ucode":"0E8F1058F01C28","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erRDnCKfAWyOSUfU9hI8gYu2qsMOUwnFlCSngM0a9hbdnMmqHmBlziajorVdm9NGjx23SlAJXvicHGQ/132","comment_is_top":false,"comment_ctime":1617347213,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617347213","product_id":100020801,"comment_content":"老师您好。请问下如果一个事务中有多个更新操作，是每更新一条记录就写一条redo log，还是全部更新完再一起写redo log","like_count":0},{"had_liked":false,"id":286124,"user_name":"Geek_ae11f9","can_delete":false,"product_type":"c1","uid":2319944,"ip_address":"","ucode":"BCD5A10B87427E","user_header":"","comment_is_top":false,"comment_ctime":1617161035,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617161035","product_id":100020801,"comment_content":"新增删除会走redo log吗？还是直接同步数据库","like_count":0},{"had_liked":false,"id":285973,"user_name":"Lambor","can_delete":false,"product_type":"c1","uid":1275494,"ip_address":"","ucode":"0E3C3C39A22495","user_header":"https://static001.geekbang.org/account/avatar/00/13/76/66/cbd6013c.jpg","comment_is_top":false,"comment_ctime":1617090628,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617090628","product_id":100020801,"comment_content":"WAL写 redo-log时，如果有多个并发事务，是竞争锁一个个顺序写入还是并发写入redo-log日志？","like_count":0},{"had_liked":false,"id":285860,"user_name":"tushanjing","can_delete":false,"product_type":"c1","uid":2112449,"ip_address":"","ucode":"5DC0B62289D971","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJGHYXGttb4b5tGf2NQHLIibDnCzqTT08OoEI3QYwX8qwlviaT8iaMiaKghw7ibB4PVAV0DUcCFsibfST3g/132","comment_is_top":false,"comment_ctime":1617035759,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617035759","product_id":100020801,"comment_content":"1. 执行器调用引擎的提交事务接口，引擎把刚刚写入的 redo log 改成提交（commit）状态，更新完成。<br>         请问，这里的commit和用户提交commit是一个意思吗？也就是说，“执行器调用引擎提交事务接口”是执行器生成binlog之后自动行为，还是用户的commit的行为呢？因为考虑到会有rollback的操作，所以这里不是很明白<br><br>2. 请问redo log和bin log都是实时落磁盘的吗？如果是，即每次更新都把redo log落磁盘，那应该也有会被io限制吧（虽然好像是顺序写？）；如果不是，那就是redo log也会先写到内存做缓存，然后在某个时刻落磁盘，那机器crash，可能就有redo log的丢失，redo log又怎么是crash-safe的呢<br><br>3. 两阶段提交的反例看起来解释的不好。反证只能说明必要性，好像证明不了充分性。而且prepare阶段和commit分别又是什么呢？好像也没有说清楚<br>","like_count":0},{"had_liked":false,"id":285824,"user_name":"庄周梦蝶","can_delete":false,"product_type":"c1","uid":1693576,"ip_address":"","ucode":"7878ED3EB11E97","user_header":"https://static001.geekbang.org/account/avatar/00/19/d7/88/7dcde249.jpg","comment_is_top":false,"comment_ctime":1617021414,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1617021414","product_id":100020801,"comment_content":"为什么中间数据要先写一遍内存再到硬盘，不可以直接写硬盘么？","like_count":0},{"had_liked":false,"id":285376,"user_name":"AK47","can_delete":false,"product_type":"c1","uid":2353310,"ip_address":"","ucode":"0A3F94DBA8C2AB","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIjUDIRQ0gRicqTxDm3MeIe1yjCrJuHMMbOD0QHKicx1KOibHwqn0tV8DQqvO3cmSpyjtacFm5jY9yxA/132","comment_is_top":false,"comment_ctime":1616761039,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616761039","product_id":100020801,"comment_content":"老师好，如果redo log 处于prepare状态，binlog刚写完，还没有通知innodb引擎提交，服务器就挂了。那么再次启动时，redo log会回滚，那么此时bonlog数据就与数据库不一致了。怎么办？","like_count":0},{"had_liked":false,"id":285205,"user_name":"Geek_39dd75","can_delete":false,"product_type":"c1","uid":2538570,"ip_address":"","ucode":"B0C3DD6409C3F7","user_header":"","comment_is_top":false,"comment_ctime":1616665448,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616665448","product_id":100020801,"comment_content":"redo log不是也有，磁盘持久化，也不会丢","like_count":0},{"had_liked":false,"id":285204,"user_name":"Geek_39dd75","can_delete":false,"product_type":"c1","uid":2538570,"ip_address":"","ucode":"B0C3DD6409C3F7","user_header":"","comment_is_top":false,"comment_ctime":1616665376,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616665376","product_id":100020801,"comment_content":"老师，MySQL主从复制使用binlog，问下主从复制可以使用redo log吗？redo log同样可以恢复吗？","like_count":0},{"had_liked":false,"id":285006,"user_name":"GeekWL","can_delete":false,"product_type":"c1","uid":1716943,"ip_address":"","ucode":"7A957139D4AF73","user_header":"https://static001.geekbang.org/account/avatar/00/1a/32/cf/4158e3be.jpg","comment_is_top":false,"comment_ctime":1616576728,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616576728","product_id":100020801,"comment_content":"理解: 我再来说下自己的理解 。 1 prepare阶段 2 写binlog 3 commit 当在2之前崩溃时 重启恢复：后发现没有commit，回滚。备份恢复：没有binlog 。 一致 当在3之前崩溃 重启恢复：虽没有commit，但满足prepare和binlog完整，所以重启后会自动commit。备份：有binlog(怎么检查有binlog呢?). 一致 疑问: 如果要检查binlog，那prepare存在的意义是什么，我直接检验binlog的完整性就可以了。任何涉及两个系统提交的任务都会存在不一致的可能性，而且这种可能性无法完全消除，只能减少这种风险，prepare机制是把写binlog时间段的风险降低到commit更低时间段，从而降低不一致的风险，分布式事务也是同理，不管怎么设计，都是存在不一致风险的 解答: binlog 只记录逻辑操作，并无操作状态，即无法确定该操作是否完成。redo log是有状态的，所以没办法直接检查binlog。只有在redo log状态为prepare时，才会去检查binlog是否存在，否则只校验redo log是否是 commit就可以啦。 怎么检查binlog: 一个完整事物binlog结尾有固定的格式.","like_count":0},{"had_liked":false,"id":284787,"user_name":"Geek_4ce7c8","can_delete":false,"product_type":"c1","uid":2399535,"ip_address":"","ucode":"D44814E2940EEC","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJO8Raf0zUoQVZBTS1FupoicI7m7dquCO4vPSCDKQvGebfIt166QguWk24dq3pC7M59JNCCw58qibcQ/132","comment_is_top":false,"comment_ctime":1616471014,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616471014","product_id":100020801,"comment_content":"感觉看完更懵了啊。","like_count":0},{"had_liked":false,"id":284501,"user_name":"Daiver","can_delete":false,"product_type":"c1","uid":1466447,"ip_address":"","ucode":"9B1A03AFBC79BC","user_header":"https://static001.geekbang.org/account/avatar/00/16/60/4f/db0e62b3.jpg","comment_is_top":false,"comment_ctime":1616307986,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616307986","product_id":100020801,"comment_content":"为啥不讲一下undo log 呢","like_count":0},{"had_liked":false,"id":284283,"user_name":"excellentchen","can_delete":false,"product_type":"c1","uid":2457152,"ip_address":"","ucode":"652EFA2A659058","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLAZhhRRQRdNnvnmHbKzmvg12KyJnSsgYrlCKDSwDI6lGAh3xLCm3FmeFkTKH2PqMdV04h1iacjeSg/132","comment_is_top":false,"comment_ctime":1616149069,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616149069","product_id":100020801,"comment_content":"日志那块没看懂，看完评论后懂了，感谢大神们","like_count":0},{"had_liked":false,"id":283463,"user_name":"帝江","can_delete":false,"product_type":"c1","uid":1590610,"ip_address":"","ucode":"93CBA4E4D05DA5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/B9vSOjMc2a86kYA8R5yDkVdFiaj2JeBZ1PuI9oUKhbnvuZwuibdUam6FTcGzDaiaFdk2GWJveUGhfCVpv4KaOdicoQ/132","comment_is_top":false,"comment_ctime":1615791450,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1615791450","product_id":100020801,"comment_content":"binlog 保证了数据恢复问题.类似棋谱.是有一定功能价值的.<br>redolog是为了将随机写改为顺序写.也就说没有redo log也是能工作的.只是提高了写入速度.<br>redo log 在写入实际数据页前面加了一个流程.也就说.成功的标志是redo log 完成.然后依赖redo log 转 实际数据的机制来完成数据写入.<br>两个日志的配合是先binlog 后 redo log .这样实际写入的数据肯定已经在binlog里面了.可以通过重放来得到一个一致的数据.而现在的顺序可能出现的问题是binlog成功, redo log 断电.这时候可以通过binlog得到数据.虽然redo log里面是prepare状态.<br>","like_count":0},{"had_liked":false,"id":283194,"user_name":"Geek_ae11f9","can_delete":false,"product_type":"c1","uid":2319944,"ip_address":"","ucode":"BCD5A10B87427E","user_header":"","comment_is_top":false,"comment_ctime":1615615724,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1615615724","product_id":100020801,"comment_content":"<br><br>对文中日志的作用是减少磁盘IO的描述疑惑？<br>问题描述：<br>我觉得数据库，修改完值之后，会立马去修改磁盘中的值，日志并没有消减IO<br>原因：数据一致性，A做了修改，B能看见A的修改，如果采用日志，空闲提交（比如过个一个小时提交一次日志），那么A做了修改，B将不可见A修改，一个小时后，才能看见数据修改，数据一致性没能保证<br>那么只能每次执行器，执行完语句，都去磁盘更改数据库磁盘数据，才能保证数据一致性<br>那么日志减少磁盘IO的说法好像不成立，在这个问题上，我有着疑惑","like_count":0},{"had_liked":false,"id":282833,"user_name":"罗选东","can_delete":false,"product_type":"c1","uid":2015657,"ip_address":"","ucode":"7E844804319E3B","user_header":"https://static001.geekbang.org/account/avatar/00/1e/c1/a9/ece95406.jpg","comment_is_top":false,"comment_ctime":1615432332,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1615432332","product_id":100020801,"comment_content":"1.一条sql更新语句也要走一遍sql查询语句的流程，与查询流程不同之处在于更新语句涉及到redolog和binlog的处理。<br>2.redolog和binlog的概念与不同点：<br>2.1&gt;redolog物理日志，记录更新的列值。binlog逻辑日志，记录更新逻辑。状态比如文中例子，那么是redolog是更新字段c=3，而binlog却是c=c+1<br>2.2&gt;redolog有固定大小，用完了就擦掉以前的，binlog可以追加，大小不限<br>2.3&gt;redolog是innodb特有的，正因为redolog，innodo才有了crash safe的能力。binlog是mysql server的，所有存储引擎都能用。单用redolog无法拥有crash safe，因为redolog大小有限。单用binlog无法拥有crash safe因为 binlog不能保证数据已成功通过引擎写入磁盘（更新过程若先写Binlog入磁盘崩了，恢复时无法确认是否该事务需要再执行，先入磁盘再写日志时崩了即会多一个写入。）<br>3.两阶段提交：一条sql更新语句在走完sql查询语句的那些相似流程后，在最后执行器与引擎入库过程，会进行两阶段提交。两阶段提交是为了保障数据一致性。<br>3.1&gt;两阶段提交的过程：redolog pre阶段-&gt;binlog写入-&gt;redolog commit阶段。<br>3.2&gt;如果不用两阶段提交，即使有了redolog也无法crash safe。因为无法保证数据一致性。先写redolog写入binlog崩了，恢复时，binlog会少一次。先写binlog写redolog崩了，恢复时，binlog会多一次。两阶段就不会出现这种问题，如在binlog写入失败，那么redolog还未提交会自己回滚。根据binlog恢复数据即是正确的。如在redolog commit失败，根据binlog恢复时，因为redolog pre和binlog是一致的，会自动commit，此时数据也是一致的。所以能保证数据的一致性。<br>","like_count":0},{"had_liked":false,"id":282639,"user_name":"yubo","can_delete":false,"product_type":"c1","uid":1813242,"ip_address":"","ucode":"7B95666C1769D1","user_header":"https://static001.geekbang.org/account/avatar/00/1b/aa/fa/8d12c0fe.jpg","comment_is_top":false,"comment_ctime":1615345620,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1615345620","product_id":100020801,"comment_content":"重点，把innodb_flush_log_at_trx_commit和sync_binlog两个参数都设置成1，每次事务都持久化到磁盘<br>","like_count":0},{"had_liked":false,"id":282490,"user_name":"怕什么，抱紧我","can_delete":false,"product_type":"c1","uid":1318633,"ip_address":"","ucode":"CBCEA76E9EF33B","user_header":"https://static001.geekbang.org/account/avatar/00/14/1e/e9/dcc63d8f.jpg","comment_is_top":false,"comment_ctime":1615276992,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1615276992","product_id":100020801,"comment_content":"写进redo log日志是顺序写可以理解，从rego log写入磁盘，不还是随机IO写吗？您的意思是避免高峰期写，缓解随机写的压力吗？","like_count":0},{"had_liked":false,"id":282049,"user_name":"天空提提","can_delete":false,"product_type":"c1","uid":1566421,"ip_address":"","ucode":"055EB8E1966E34","user_header":"https://static001.geekbang.org/account/avatar/00/17/e6/d5/20c2fb6b.jpg","comment_is_top":false,"comment_ctime":1615030455,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1615030455","product_id":100020801,"comment_content":"update t set num+=1 where id = 1<br>假设num原值是0，两个并发的时候num是1还是2？跟事务有没有关系？","like_count":0},{"had_liked":false,"id":281998,"user_name":"林军人","can_delete":false,"product_type":"c1","uid":2220955,"ip_address":"","ucode":"37A126E92E8B52","user_header":"https://static001.geekbang.org/account/avatar/00/21/e3/9b/b045124d.jpg","comment_is_top":false,"comment_ctime":1615008667,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1615008667","product_id":100020801,"comment_content":"问题1：什么是redo log <br>答：是一种物理日志，记录页做了什么改动，是Innodb特有的，由于是日志，所以在磁盘上顺序写入，redolog的大小是有限的，属于循环写入，所以可以根据write_pos和check_point知道哪些没有写入磁盘,从而其可以解决mysql异常重启后事务的恢复问题。和binlog配合从而实现mysql的回复机制<br><br>问题2：什么是binlog？<br>答：是一种逻辑日志，是归档日志, 处于Server层,有三种模式 statement, row, mixed; 记录更新操作或者数据. 为追加写入, 用于进行备份和恢复.<br><br>问题: 什么是两段式提交<br>为了使两个日志的事务提交状态保持一致, 是的数据库状态一致, 使用了两段式提交, 只有当 redo log commit 且 binlog中有记录时, 事务才算写入磁盘. <br>","like_count":0},{"had_liked":false,"id":281762,"user_name":"LoveDlei","can_delete":false,"product_type":"c1","uid":1102916,"ip_address":"","ucode":"68065848DF518B","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/44/ec084136.jpg","comment_is_top":false,"comment_ctime":1614872273,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1614872273","product_id":100020801,"comment_content":"redo log 在没有commit之前数据库故障挂掉，此时的redo log是存储在哪里呢？","like_count":0},{"had_liked":false,"id":281152,"user_name":"S_mine","can_delete":false,"product_type":"c1","uid":1802415,"ip_address":"","ucode":"EF5D89C2F2A8FF","user_header":"https://static001.geekbang.org/account/avatar/00/1b/80/af/46d8dc3f.jpg","comment_is_top":false,"comment_ctime":1614600051,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1614600051","product_id":100020801,"comment_content":"优势在于容灾性好，可以抵抗比较严重的损坏。只要最近的binlog和redolog还有数据库都在，就能恢复。<br>缺点在于数据库日志太多了，需要频繁清理。<br>觉得适用于并发高的数据库吧。","like_count":0},{"had_liked":false,"id":280336,"user_name":"苏忆","can_delete":false,"product_type":"c1","uid":1042793,"ip_address":"","ucode":"B8BE78280CCB99","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e9/69/779b48c2.jpg","comment_is_top":false,"comment_ctime":1614161195,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1614161195","product_id":100020801,"comment_content":"redo log记录的如果是更新的内容，那我第一次查的时候，没更新，更新在redo log，然后第二次查的话，会先把redo log 刷盘后才能返回更新后的内容吗？","like_count":0},{"had_liked":false,"id":280328,"user_name":"玩蜂","can_delete":false,"product_type":"c1","uid":1345119,"ip_address":"","ucode":"9EC71D81392FFF","user_header":"","comment_is_top":false,"comment_ctime":1614160247,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1614160247","product_id":100020801,"comment_content":"更新的流程没有考虑索引吗？比如时间字段是有索引的。当更新时间字段时，应该会重建索引吧","like_count":0},{"had_liked":false,"id":280281,"user_name":"Geek_684984","can_delete":false,"product_type":"c1","uid":2149833,"ip_address":"","ucode":"BAE0E43AA80892","user_header":"","comment_is_top":false,"comment_ctime":1614149924,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1614149924","product_id":100020801,"comment_content":"redo日志在数据库重启后依然存在，所以redo日志是存储到磁盘里面的嘛？","like_count":0},{"had_liked":false,"id":279758,"user_name":"Geek_087754","can_delete":false,"product_type":"c1","uid":2280250,"ip_address":"","ucode":"5A1DDB15CECEC0","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/HOIjvMJfj8QXiazZkIQPzyfRQQezcibosXemcqKHhhHEBwh5jv7WNqiaDibIriaFUa24icGHgPxmxbFyIicx77eXLvrNg/132","comment_is_top":false,"comment_ctime":1613958026,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1613958026","product_id":100020801,"comment_content":"老师想请教一个问题?<br>文中说binlog 没有crash safe 的能力为什么这么说呢？ 如果每次更改binlog都落盘不也就保证了持久化了吗？","like_count":0},{"had_liked":false,"id":279713,"user_name":"TristanDong","can_delete":false,"product_type":"c1","uid":1199392,"ip_address":"","ucode":"632B5E364C8AA8","user_header":"https://static001.geekbang.org/account/avatar/00/12/4d/20/9f430641.jpg","comment_is_top":false,"comment_ctime":1613918981,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1613918981","product_id":100020801,"comment_content":"没有明白，为什么说明binlog没有crash-safe？另外，两阶段提交为什么可以保证binlog和redo log的一致性","like_count":0},{"had_liked":false,"id":279195,"user_name":"panbook","can_delete":false,"product_type":"c1","uid":1064375,"ip_address":"","ucode":"1B1CC0F44C41DF","user_header":"https://static001.geekbang.org/account/avatar/00/10/3d/b7/d863295a.jpg","comment_is_top":false,"comment_ctime":1613651709,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1613651709","product_id":100020801,"comment_content":"由于有redo log，再查询的时候，也要查redo log么","like_count":0},{"had_liked":false,"id":279188,"user_name":"Aeins","can_delete":false,"product_type":"c1","uid":1045910,"ip_address":"","ucode":"D5BF220767541D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f5/96/0cf9f3c7.jpg","comment_is_top":false,"comment_ctime":1613649546,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1613649546","product_id":100020801,"comment_content":"1.WAL相比数据直接落盘的优势？<br>2.crash-safe是完全安全的吗？","like_count":0},{"had_liked":false,"id":278721,"user_name":"狼猫","can_delete":false,"product_type":"c1","uid":1080112,"ip_address":"","ucode":"F911CC975F4218","user_header":"https://static001.geekbang.org/account/avatar/00/10/7b/30/1b50450b.jpg","comment_is_top":false,"comment_ctime":1613233542,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1613233542","product_id":100020801,"comment_content":"数据库被篡改了怎么查找怎么被改的？","like_count":0},{"had_liked":false,"id":278078,"user_name":"Geek_5531e5","can_delete":false,"product_type":"c1","uid":2265177,"ip_address":"","ucode":"920DA9A2C18EDB","user_header":"","comment_is_top":false,"comment_ctime":1612751637,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612751637","product_id":100020801,"comment_content":"老师，请教一下，两阶段提交部分 第四步 写完binlog后 mysql 挂了 那就不会操作第五步commit了，这个时候的binlog 和redo log是没完成事务？那binlog会回滚 不记录刚才的操作日志吗？","like_count":0},{"had_liked":false,"id":277933,"user_name":"林林","can_delete":false,"product_type":"c1","uid":1613227,"ip_address":"","ucode":"7B6318B971E430","user_header":"https://static001.geekbang.org/account/avatar/00/18/9d/ab/6589d91a.jpg","comment_is_top":false,"comment_ctime":1612674927,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612674927","product_id":100020801,"comment_content":"请问老师，如果在两阶段提交的过程中，binlog写入成功了，但redolog commit时crash了，是否就会导致binlog和redolog不一直的情况了？","like_count":0},{"had_liked":false,"id":277386,"user_name":"林毅鑫","can_delete":false,"product_type":"c1","uid":1917916,"ip_address":"","ucode":"1BB3D186E90D96","user_header":"https://static001.geekbang.org/account/avatar/00/1d/43/dc/95d4f2c5.jpg","comment_is_top":false,"comment_ctime":1612402885,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612402885","product_id":100020801,"comment_content":"我以前总是听完就算了，现在发现用一个番茄的时间（25分钟）都无法完整的撸一篇。。","like_count":0},{"had_liked":false,"id":276593,"user_name":"tyy","can_delete":false,"product_type":"c1","uid":1302149,"ip_address":"","ucode":"C3B436E6562744","user_header":"https://static001.geekbang.org/account/avatar/00/13/de/85/da98e390.jpg","comment_is_top":false,"comment_ctime":1612020695,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612020695","product_id":100020801,"comment_content":"一条更新sql执行的过程：<br>1：一条sql进来进入连接器 TCP握手 权限验证<br>2：分析器进行词法 语法的分析<br>3：优化器选择怎么执行这个语句 用什么索引<br>4：执行器调用innodb的接口，如果这条语句所对应的的page在内存中(innodb_buffer_cache),则直接更新内存里的page，不在的话需要从磁盘读入innodb_buffer_cache,然后sql变动写入redolog 同事改为prepare状态 然后高告诉server层你可以鞋binlog了，等binlog写完后，server层调用innodb的提交事务接口，innodb把rebolog 的prepare状态改成commit状态，此时一条语句就更新完了","like_count":0},{"had_liked":false,"id":276341,"user_name":"Geek_19657e","can_delete":false,"product_type":"c1","uid":2428131,"ip_address":"","ucode":"19B0146A1B4732","user_header":"","comment_is_top":false,"comment_ctime":1611890100,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1611890100","product_id":100020801,"comment_content":"1、redo log是inno db特有，binlog是server层日志，支持所有存储引擎；<br>redo log空间大小固定，如达到最大空间，需先擦出原有log，binlog是追加写，log达到一定容量后会写到新的文件，不会覆盖原来的日志；<br>redo log是物理日志，记录的是页内存的修改，binlog是逻辑日志，简单说就是记录的修改sql语句；<br>2、更新流程<br>执行器通过引擎取数据<br>引擎层先查看数据是否在内存中，如在则返回，不在则从磁盘中读到内存中后返回<br>执行器修改引擎读取到的数据<br>引擎修改内存数据<br>写redo log日志，prepare阶段<br>执行器写binlog日志<br>执行器commit请求<br>3、两阶段提交：保持数据逻辑一致","like_count":0},{"had_liked":false,"id":276134,"user_name":"FD","can_delete":false,"product_type":"c1","uid":2052521,"ip_address":"","ucode":"ED396BD322489E","user_header":"https://static001.geekbang.org/account/avatar/00/1f/51/a9/741b5ad9.jpg","comment_is_top":false,"comment_ctime":1611806678,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1611806678","product_id":100020801,"comment_content":"innodb_flush_log_at_trx_commit和sync_binlog都设置为1会不会对性能有影响","like_count":0},{"had_liked":false,"id":275972,"user_name":"飞翔","can_delete":false,"product_type":"c1","uid":1065986,"ip_address":"","ucode":"3D3D10273BED18","user_header":"https://static001.geekbang.org/account/avatar/00/10/44/02/5c8e4b81.jpg","comment_is_top":false,"comment_ctime":1611734156,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1611734156","product_id":100020801,"comment_content":"建议把 redo log 里面的 redo log buffer  和 redo log file 引入讲述 ，能更清晰理解这个过程，我前面理解 redo log 一直认为 就是 磁盘文件","like_count":0},{"had_liked":false,"id":275950,"user_name":"吉法师","can_delete":false,"product_type":"c1","uid":2232546,"ip_address":"","ucode":"F1E3F4F526CA13","user_header":"https://static001.geekbang.org/account/avatar/00/22/10/e2/35f2fc23.jpg","comment_is_top":false,"comment_ctime":1611726942,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1611726942","product_id":100020801,"comment_content":"仔细的看了看 老师没说什么是两阶段提交。。","like_count":0},{"had_liked":false,"id":274726,"user_name":"Dr destiny","can_delete":false,"product_type":"c1","uid":2259441,"ip_address":"","ucode":"7A2FE6F24D9BDF","user_header":"https://static001.geekbang.org/account/avatar/00/22/79/f1/865a39e1.jpg","comment_is_top":false,"comment_ctime":1611136962,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1611136962","product_id":100020801,"comment_content":"redo log和binlog最后都是要写进磁盘里的，相比于直接把数据写进磁盘，它们对速度的提升有多大呢？（毕竟redo log都记录某一页有什么改动了，这个IO的开销也不小吧？）","like_count":0},{"had_liked":false,"id":274081,"user_name":"御东风","can_delete":false,"product_type":"c1","uid":2388524,"ip_address":"","ucode":"45EB50A3E717D0","user_header":"https://static001.geekbang.org/account/avatar/00/24/72/2c/94e30884.jpg","comment_is_top":false,"comment_ctime":1610815011,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1610815011","product_id":100020801,"comment_content":"有些理解不知道对不对：<br>1. 内存中的数据页应该主要是一些新近数据，这些数据中有些可能还没有被写入数据库，按道理在redo完成将修改写入数据库后，这些内存页存储的才是最新的数据。那么在这之前如果因为某些原因内存满了，内存中还没有写入磁盘的数据会被直接覆写吗?如果会，那么后续待select是不是就有可能无法获得最新的数据?<br>2. WAL 其实仍然需要执行查询，并对查询结果进行相应的值操作，因此其效率的提升主要还是在log可以顺序写，以及log可以批量提交?","like_count":0},{"had_liked":false,"id":274038,"user_name":"xiaowei","can_delete":false,"product_type":"c1","uid":1682435,"ip_address":"","ucode":"9E881A5A59068F","user_header":"https://static001.geekbang.org/account/avatar/00/19/ac/03/de335ba9.jpg","comment_is_top":false,"comment_ctime":1610794603,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1610794603","product_id":100020801,"comment_content":"老师您好，我其实有点疑惑，如果在更新某一条数据的时候，已经写入了redo log，执行器已经生成了binlog日志的时候，MySQL意外中断，那么redol log状态由prepare变更为commit的操作还是否执行，它是什么流程。","like_count":0},{"had_liked":false,"id":273502,"user_name":"Geek_d1a0bd","can_delete":false,"product_type":"c1","uid":2279097,"ip_address":"","ucode":"A7284F4D971E39","user_header":"","comment_is_top":false,"comment_ctime":1610615978,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1610615978","product_id":100020801,"comment_content":"“前面我们说过，在一个表上有更新的时候，跟这个表有关的查询缓存会失效，所以这条语句就会把表 T 上所有缓存结果都清空。这也就是我们一般不建议使用查询缓存的原因。<br>接下来，分析器会通过词法和语法解析知道这是一条更新语句。优化器决定要使用 ID 这个索引。然后，执行器负责具体执行，找到这一行，然后更新。”--------按照这个理解应该是分析器先进行语法解析得知sql语句是更新语句，然后在清空缓存吧","like_count":0},{"had_liked":false,"id":273499,"user_name":"Geek_d1a0bd","can_delete":false,"product_type":"c1","uid":2279097,"ip_address":"","ucode":"A7284F4D971E39","user_header":"","comment_is_top":false,"comment_ctime":1610615220,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1610615220","product_id":100020801,"comment_content":"“在一个表上有更新的时候，跟这个表有关的查询缓存会失效，所以这条语句就会把表 T 上所有缓存结果都清空”<br>这个发生在“查询缓存”阶段吗？那获取表名要经过分析器进行语法解析吧。所以这里我有点疑惑了，疑惑的是sql的执行流程，在上一篇文章中我了解到一条sql的执行流程：连接器-查询缓存-分析器-优化器-执行器-引擎接口","like_count":0},{"had_liked":false,"id":272329,"user_name":"陈建斌红了..","can_delete":false,"product_type":"c1","uid":1073301,"ip_address":"","ucode":"575F04D041C2C8","user_header":"https://static001.geekbang.org/account/avatar/00/10/60/95/08571d0b.jpg","comment_is_top":false,"comment_ctime":1610033867,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1610033867","product_id":100020801,"comment_content":"恢复的时候也没用到redo啊，这里有点不明白了","like_count":0},{"had_liked":false,"id":271246,"user_name":"学习学个屁","can_delete":false,"product_type":"c1","uid":1049017,"ip_address":"","ucode":"DF2D61E6FB2FCE","user_header":"https://static001.geekbang.org/account/avatar/00/10/01/b9/73435279.jpg","comment_is_top":false,"comment_ctime":1609489874,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609489874","product_id":100020801,"comment_content":"Redo log这儿刷磁盘是不是可以理解为一个文件， 这个文件就是事务提交的刷盘日志文件，最终在刷盘指的是ibd文件刷盘，ibd刷盘这个时间和开销大于 Redo log文件刷盘。","like_count":0},{"had_liked":false,"id":270153,"user_name":"Geek8819","can_delete":false,"product_type":"c1","uid":2028950,"ip_address":"","ucode":"521AEDAB2EED81","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f5/96/e963b41b.jpg","comment_is_top":false,"comment_ctime":1608957924,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608957924","product_id":100020801,"comment_content":"innodb_flush_log_at_trx_commit 这个参数设置成 1 的时候，表示每次事务的 redo log 都直接持久化到磁盘。这个参数我建议你设置成 1，这样可以保证 MySQL 异常重启之后数据不丢失。<br><br>这里不太同意，如果需要最强一致性，才推荐设置成1，可以保证mysql和操作系统crash都不会出现数据丢失，而如果设置成2，即使mysql crash，只要操作系统没有crash，操作系统也会负责把数据刷到磁盘","like_count":0},{"had_liked":false,"id":270098,"user_name":"俊少","can_delete":false,"product_type":"c1","uid":2389320,"ip_address":"","ucode":"88113958036F76","user_header":"https://static001.geekbang.org/account/avatar/00/24/75/48/9289735d.jpg","comment_is_top":false,"comment_ctime":1608903205,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608903205","product_id":100020801,"comment_content":"老师，你好，我想问下在你写的update语句的执行流程中，如果第四步执行完crash了，此时redo log还是prepare状态，这种情况下是如何保证数据库中的数据和日志中记录的数据二者是一样的呢？","like_count":0},{"had_liked":false,"id":270035,"user_name":"Lzh","can_delete":false,"product_type":"c1","uid":2344071,"ip_address":"","ucode":"49E1E7028972DE","user_header":"https://static001.geekbang.org/account/avatar/00/23/c4/87/174fa848.jpg","comment_is_top":false,"comment_ctime":1608883511,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608883511","product_id":100020801,"comment_content":"写binlog应该是写到从库里面吧，保持主从一致","like_count":0},{"had_liked":false,"id":270028,"user_name":"","can_delete":false,"product_type":"c1","uid":2385279,"ip_address":"","ucode":"","user_header":"","comment_is_top":false,"comment_ctime":1608881735,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608881735","product_id":100020801,"comment_content":"讲的好棒，来晚啦！","like_count":0},{"had_liked":false,"id":269771,"user_name":"marker","can_delete":false,"product_type":"c1","uid":1094478,"ip_address":"","ucode":"DDBF1CD83665C4","user_header":"https://static001.geekbang.org/account/avatar/00/10/b3/4e/5f22b09d.jpg","comment_is_top":false,"comment_ctime":1608780300,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1608780300","product_id":100020801,"comment_content":"老师这里有个疑惑，数据更新先走的redo log buffer 。<br>问题1.更新处于prepare阶段的时候，redo log buffer就会同步刷到 redo log里面，还是在commit的时候刷入 redo log。<br>问题2.如果是在commit的时候刷入 redo log，只是binlog完整的 redo log buffer 是一块内存区域。如果mysql异常重启肯定会丢失。这里是怎么保证的？","like_count":0},{"had_liked":false,"id":269600,"user_name":"nwc","can_delete":false,"product_type":"c1","uid":2349067,"ip_address":"","ucode":"2FEDB3D6D5C12A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIXeicJJQk6sbWzIQfVRHoUIPkQYyXRFZ6V0O42ddCic9ypt0liciaPFwicicfpo5HJ3ibicNtL5wkXlcib5CQ/132","comment_is_top":false,"comment_ctime":1608711410,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1608711410","product_id":100020801,"comment_content":"其实单看这篇文件还是有一点感觉讲述的挺迷糊的，就是redo log到底是只记录事务操作，还是说所有操作都会记录。","like_count":0},{"had_liked":false,"id":269109,"user_name":"Fan","can_delete":false,"product_type":"c1","uid":1115232,"ip_address":"","ucode":"3BF28670FD9407","user_header":"https://static001.geekbang.org/account/avatar/00/11/04/60/64d166b6.jpg","comment_is_top":false,"comment_ctime":1608527715,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608527715","product_id":100020801,"comment_content":"redo log 的位置在哪里呢？使用什么命令能知道路径呢？","like_count":0},{"had_liked":false,"id":269036,"user_name":"poplar","can_delete":false,"product_type":"c1","uid":1463444,"ip_address":"","ucode":"4D0ECC6AC87830","user_header":"","comment_is_top":false,"comment_ctime":1608479205,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608479205","product_id":100020801,"comment_content":"假如数据库崩溃时binlog写入完成，但是未commit, 此时业务线程返回失败，崩溃恢复后事务被正常提交；但是业务再次重试时，数据库数据已经变更，业务不是走不下去了吗","like_count":0},{"had_liked":false,"id":268581,"user_name":"TT","can_delete":false,"product_type":"c1","uid":1466771,"ip_address":"","ucode":"2D8CE3E45DA7A4","user_header":"https://static001.geekbang.org/account/avatar/00/16/61/93/3191eafa.jpg","comment_is_top":false,"comment_ctime":1608263001,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608263001","product_id":100020801,"comment_content":"## 什么是 redo log？<br><br>类比于实际生活中酒店记账的操作，如果有人赊账，可以先把账记录到粉板上，等到空闲或是粉板记不下的时候再核算整理到账本上，这样可以避免频繁翻查账本，提高了工作效率；<br><br>赊账相当于数据库的更新操作，记录到粉板相当于写 redo log，粉板满了相当于 redo log文件满了，整理到账本上相当于刷脏，频繁翻查账本相当于去磁盘上获取对应的记录<br><br>redo log 是在引擎层实现的**重做日志**，是 InnoDB 特有的<br><br>## redo log 的作用是什么？<br>redo log 加快了更新速度，也保证了 InnoDB的 crash-safe 能力：即使数据库异常重启，之前提交的记录也不会丢失<br><br>## 什么是 binlog？<br>binlog是在server层实现的**归档日志**<br><br>## binlog的作用是什么？<br>* 数据恢复<br>* 主从同步<br><br>## binlog 和 redo log 的区别是什么<br><br>* binlog 是server层的归档日志，redo log是引擎层的InnoDB引擎特有的重做日志<br>* redo log 是物理日志，记录的是在某个数据页上做了什么更改；binlog是逻辑日志，记录的是操作的原始逻辑，例如 &quot;给 ID=2 这一行的 c 字段 + 1&quot;<br>* binlog 是追加写的，一个文件写满就继续写下一个文件，不会覆盖之前的日志；redo log的空间固定，是循环写的；<br><br>## 什么是两阶段提交<br>`update T set c=c+1 where id=2` 的执行过程大致如下：<br>![20201217191240](http:&#47;&#47;pic.zero-tt.fun&#47;note&#47;20201217191240.png)<br>更新操作过程中，先把操作记录写入 redo log 并将 redo log 标记为 prepare 状态，然后写入 binlog，最后再提交事务并将 redo log 的状态更改为 commit<br><br>## 为什么要使用两阶段提交<br>两阶段提交是为了保证 redo log 和 binlog 的一致性，没有两阶段提交，无论先写 redo log 还是 binlog，都会出现两者不一致的情况。<br><br>## 评论区讨论<br><br>&gt;Q: 关于两阶段提交的讨论<br><br>1：prepare阶段， 2：写binlog， 3：commit<br>当在2之前崩溃时，重启恢复后发现没有commit，也没有对应的binlog，遂回滚；<br><br>当在3之前崩溃<br>重启恢复：虽没有commit，但满足prepare和binlog完整，所以重启后会自动commit<br><br>&gt;Q: 如何逻辑日志与物理日志<br><br>逻辑日志可以给别的数据库，别的引擎使用，已经大家都讲得通这个“逻辑”；<br>物理日志就只有“我”自己能用，别人没有共享我的“物理格式”<br><br>&gt;Q: redo log也是写文件，那它充当“粉板”会更快吗？<br><br>redo log是顺序写，数据文件是随机写，所以 redo log会更快<br><br>&gt;Q: 执行一条Update 语句后，马上又执行一条 select * from table limit 10。如果刚刚update的记录，还没持久化到磁盘中，而偏偏这个时候的查询条件，又包含了刚刚update的记录。那么这个时候，是从日志中获取刚刚update的最新结果，还是说，先把日志中的记录先写磁盘，再返回最新结果？<br><br>直接从内存中获取","like_count":0},{"had_liked":false,"id":268242,"user_name":"泥鳅也是鱼","can_delete":false,"product_type":"c1","uid":1287513,"ip_address":"","ucode":"3E69CBD0C10CB6","user_header":"https://static001.geekbang.org/account/avatar/00/13/a5/59/e27c2d45.jpg","comment_is_top":false,"comment_ctime":1608111142,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608111142","product_id":100020801,"comment_content":"老师，问下，一个对账业务，每天跑批的更新语句，采用的是逐条更新，开发打印的每条更新语句执行时间差异很大，有的要几百毫秒，有的几毫秒，单独执行都是几毫秒，之前一共2000秒就跑完，数据量大概40万，突然一天变成了4000秒，然后一直增加，有的时候一万秒，有时8000，这种该怎么排查","like_count":0},{"had_liked":false,"id":267673,"user_name":"怕什么，抱紧我","can_delete":false,"product_type":"c1","uid":1318633,"ip_address":"","ucode":"CBCEA76E9EF33B","user_header":"https://static001.geekbang.org/account/avatar/00/14/1e/e9/dcc63d8f.jpg","comment_is_top":false,"comment_ctime":1607868340,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1607868340","product_id":100020801,"comment_content":"update T set c=c+1 where ID=2;<br>这个例子有问题吧！<br>如果update..set的是一个确定好的值,可以redo log；<br>如果update..set的是一个需要读取磁盘并运算的,如C+1,redo log，redo log该怎么写, 内存该怎么更新：","like_count":0},{"had_liked":false,"id":267501,"user_name":"Geek_40c668","can_delete":false,"product_type":"c1","uid":1685451,"ip_address":"","ucode":"4F7B6A3D4F4DD1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/WnbsIzp30vkf8OVicicMHv0Cepxt17aSxdUVIaiaEMullXPE79ywaETSaRl6WeyePiaqqFYoxmK0IXbaUKLpmibD4ng/132","comment_is_top":false,"comment_ctime":1607775167,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607775167","product_id":100020801,"comment_content":"本章节的主要讲：<br>1.更新的执行。首先要执行查询，然后根据更新。2.提交分为两阶段：先写redo log ，此时处于prpare状态。然后写binlog，其次再提交。<br>3.crash safe：如果提交时发生故障，数据不丢失。重启后，查询到binlog则再次提交redo log。如果没有binlog，则回滚。<br>4.binlog redolog 区别：<br>    1.redo log记录的是物理日志，也就是从1更新为3。而bin log则是逻辑日志，记录的是sql或者新旧行记录。<br>     也就是说binlog可以用来恢复数据库，redo log也可以，只要恢复时刻以后的日志还在。<br>    2.redolog是循环写，会发生覆盖。binlog是追加写，没有限制。<br>    3.binlog是server 层日志，所有引擎共用。redo log是innodb特有。<br>4.备份的实质是：首先拥有完整的数据库备份，其次必须有该备份数据库备份以后的全部binlog。其实就是相当于将重新执行一遍sql到某一个时间点。","like_count":0},{"had_liked":false,"id":267446,"user_name":"Geek_8f3eb8","can_delete":false,"product_type":"c1","uid":2366684,"ip_address":"","ucode":"E7ECEAE22B3A2B","user_header":"","comment_is_top":false,"comment_ctime":1607746756,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607746756","product_id":100020801,"comment_content":"binglog有三种模式：SBR、RBR、MBR<br>SBR：语句模式，记录做什么命令记什么命令，可读性强，节省空间，可能记录不准确<br>RBR：行模式，记录数据行的变化，可读性差，范围操作日志量大，不会出现错误。8.0默认。<br>MBR：混合模式","like_count":0},{"had_liked":false,"id":266135,"user_name":"CycleGAN","can_delete":false,"product_type":"c1","uid":1679661,"ip_address":"","ucode":"9FD04813911A02","user_header":"https://static001.geekbang.org/account/avatar/00/19/a1/2d/599e9051.jpg","comment_is_top":false,"comment_ctime":1607181248,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607181248","product_id":100020801,"comment_content":"看了一下午老师的和同学的评论，有点懂了，总结一下<br>1.redolog是innodb为了异步写磁盘必须的，如果不异步写磁盘就没这些事情，异步写磁盘在这里是基础事实。<br>2.假如没有redolog还要异步写，那么记录在binlog的日志是可疑的，这条sql到底写到磁盘没。所以需要redo log辅助判定，redo log比较小也是他的定位决定的，毕竟小黑板写不了多少字，就是个缓存信息。<br>3.两个日志需要对齐进度，假设不是两阶段提交，先写redolog后写binlog，在写binlog出错，那么以后备份就少了一次成功的操作，如果先写binlog后写redolog，可能结果是多了一条失败的操作。、<br>4.两阶段提交，是写1redo log prepare-&gt;2bin log-&gt;3redo log commit-&gt;4.异步落盘，每一步都可能出错，1之前出错，无事发生。2之前出错，重启后，redolog没看到 commit，就去bin log看有没有记录，记了就补个commit完事，如果没记，回滚，第三步之前没关系的，最后的commit只是为了少去找binlog判断，在写入binlog的时候，已经实质性达成共识了，如果是第四步落盘失败，如果在redo和binlog里都有commit记录，就可以恢复数据了。<br>5.在写完binlog应该就可以返回给客户成功了，否则返回失败或不返回，所以一次update一般要写三次，2次redolog 1一次binlog<br>6.redolog也可以先写到内存后落盘，innodb_flush_log_at_trx_commit设置为1标识每次都会持久化到磁盘，如果不这样感觉会出问题<br>7.启发：先写日志，后更新内存数据，最后写入存储系统(数据库)。这样就拥有了cashsafe的能力，高性能伴随着日志和buffer<br>","like_count":0},{"had_liked":false,"id":265994,"user_name":"Lordran","can_delete":false,"product_type":"c1","uid":1661535,"ip_address":"","ucode":"7CCD5F52471BB1","user_header":"https://static001.geekbang.org/account/avatar/00/19/5a/5f/8a76aa8b.jpg","comment_is_top":false,"comment_ctime":1607092935,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607092935","product_id":100020801,"comment_content":"很好奇既然 redolog 记录了页的更新信息，那么在记录之后，发生了页分裂会怎么办？","like_count":0},{"had_liked":false,"id":265527,"user_name":"小白","can_delete":false,"product_type":"c1","uid":1875485,"ip_address":"","ucode":"6739BDF5C94C95","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/1ornnGqSaTxRdbxhUHibeyueicWA9DBLeQXaXETrTqXnNjBusw8z5zh8olEAQ9Z1XsAg6Uyw3STemHFY5AGVVtVw/132","comment_is_top":false,"comment_ctime":1606921678,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606921678","product_id":100020801,"comment_content":"内存的大小肯定大过redolog的大小吗redolog的数据一定在内存吗，数据只写入内存的话没写入磁盘，当查询的时候，数据不在内存也不在磁盘不就🈶问题","like_count":0},{"had_liked":false,"id":265272,"user_name":"推车的老王","can_delete":false,"product_type":"c1","uid":1832751,"ip_address":"","ucode":"568A2E436CCFBE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/HrblKDLM0uaYNgJo3ZbG3qzgvpq15vRDKadOkvktJuI6sWf4kUymXXXCM4ibicLcek22qAkd5oysSEVCTZuZJXGA/132","comment_is_top":false,"comment_ctime":1606836232,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606836232","product_id":100020801,"comment_content":"不知道是不是漏掉了lru和undo的部分，之前看的有些文章是有这部分的操作的，有没有大佬解答下","like_count":0},{"had_liked":false,"id":264747,"user_name":"moonfox","can_delete":false,"product_type":"c1","uid":1526355,"ip_address":"","ucode":"902BFF40EFA9FA","user_header":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","comment_is_top":false,"comment_ctime":1606628574,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606628574","product_id":100020801,"comment_content":"关于redo log 和 binlog不采用二阶段提交的假设，比如先写binlog或者redo，都没说明是什么时候在哪个阶段完成提交的？哪怕假设的也好。","like_count":0},{"had_liked":false,"id":264687,"user_name":"克里斯","can_delete":false,"product_type":"c1","uid":1181844,"ip_address":"","ucode":"00B755C10AC1C3","user_header":"https://static001.geekbang.org/account/avatar/00/12/08/94/2c22bd4e.jpg","comment_is_top":false,"comment_ctime":1606576123,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1606576123","product_id":100020801,"comment_content":"1.binlog和redolog刷盘，都是刷到了ibdata,ibd中吗?<br>2.binlog,redolog为啥要一致，不一致会有什么问题?<br>3.redolog,binlog提交顺序为啥要顺序一致？不一致不行吗？","like_count":0},{"had_liked":false,"id":263626,"user_name":"Geek_39fd46","can_delete":false,"product_type":"c1","uid":2015283,"ip_address":"","ucode":"ABBF511339E7A1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL7KRGHBE62N9LYJMdaYGoiaibjcDjFd700p6v6bwQUaKcmBnONyPy5ISkibTrtBWDIWF4f9eWyMjySw/132","comment_is_top":false,"comment_ctime":1606201107,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606201107","product_id":100020801,"comment_content":"我的理解是 redo log用来对付天灾(数据库crash了 由死亡状态恢复到健康正常状态) binlog用来对付人祸(DBA误操作了 由病态恢复到正常状态)","like_count":0},{"had_liked":false,"id":263454,"user_name":"Im me","can_delete":false,"product_type":"c1","uid":1792714,"ip_address":"","ucode":"FF7DEED4BB4C37","user_header":"https://static001.geekbang.org/account/avatar/00/1b/5a/ca/4d5d23d1.jpg","comment_is_top":false,"comment_ctime":1606137708,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606137708","product_id":100020801,"comment_content":"定期全量备份这个思考题我想的比较浅一些。由于redolog是用于保证crash-safe因此与定期全量备份没啥关系（磁盘坏了另说），而binlog的异常操作恢复依赖于定期全量备份，因此与其紧密相关，进一步说异常操作的数据恢复需要在最近一次全量备份的基础上根据binlog的记录重放到误操作之前，而根据日志恢复应该是比全量备份恢复慢的，所以全量备份的周期影响了异常操作恢复的时间","like_count":0},{"had_liked":false,"id":263439,"user_name":"Im me","can_delete":false,"product_type":"c1","uid":1792714,"ip_address":"","ucode":"FF7DEED4BB4C37","user_header":"https://static001.geekbang.org/account/avatar/00/1b/5a/ca/4d5d23d1.jpg","comment_is_top":false,"comment_ctime":1606133616,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606133616","product_id":100020801,"comment_content":"两阶段提交假如redolog处于compare状态，binlog写完了这时候宕机了，结果不是与情形2先写binlog后写redolog一样吗，求解答","like_count":0},{"had_liked":false,"id":263436,"user_name":"Im me","can_delete":false,"product_type":"c1","uid":1792714,"ip_address":"","ucode":"FF7DEED4BB4C37","user_header":"https://static001.geekbang.org/account/avatar/00/1b/5a/ca/4d5d23d1.jpg","comment_is_top":false,"comment_ctime":1606133135,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606133135","product_id":100020801,"comment_content":"binlog必须依赖于数据库的全备份吗，重放binlog是从上次全备份的时间点开始依次执行binlog中的逻辑语句直到误删语句的前一条吗","like_count":0},{"had_liked":false,"id":263347,"user_name":"j","can_delete":false,"product_type":"c1","uid":2324722,"ip_address":"","ucode":"96BAF9A9524C9F","user_header":"https://static001.geekbang.org/account/avatar/00/23/78/f2/02eb3b5c.jpg","comment_is_top":false,"comment_ctime":1606111637,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606111637","product_id":100020801,"comment_content":"请问老师第一步连接器中权限验证，这里的权限指的是对数据库中对象的操作权限还是只是对账号进行登录验证？是否取的是缓存中的数据字典进行验证？调用存储引擎接口获取数据时的权限检验和第一步连接器中权限验证的有什么区别呢？谢谢老师","like_count":0},{"had_liked":false,"id":262457,"user_name":"CJJ","can_delete":false,"product_type":"c1","uid":1194060,"ip_address":"","ucode":"7E02A6A8547559","user_header":"https://static001.geekbang.org/account/avatar/00/12/38/4c/5426e2e0.jpg","comment_is_top":false,"comment_ctime":1605745443,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1605745443","product_id":100020801,"comment_content":"其实是不是可以把redo log和binlog理解对应为Redis的rdb和aof呢？","like_count":0},{"had_liked":false,"id":262113,"user_name":"Geek_9789da","can_delete":false,"product_type":"c1","uid":2308968,"ip_address":"","ucode":"6A4A182A7E2C6B","user_header":"","comment_is_top":false,"comment_ctime":1605615196,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1605615196","product_id":100020801,"comment_content":"为什么binlog没有crash-ssafe我的理解：如果只有binlog的话，假如是先写binlog再提交事物，那么写入binlog成功了，提交事物失败了，此时当前这个数据库数据还是原来的状态，但是binlog多了一条，所以再同步从库的时候和主库数据就不一致了，所以binlog确实没有crash-safe的能力<br>那么如果假如没有redolog只有binlog的话，mysql能不能设计成如果写binlog成功了，提交事物commit的时候失败了，再自动回滚是不是就解决了问题呢，不考虑WAL的情况，此时只有binlog没有redolog","like_count":0},{"had_liked":false,"id":261939,"user_name":"自定义","can_delete":false,"product_type":"c1","uid":2294826,"ip_address":"","ucode":"8F4541C8843490","user_header":"https://static001.geekbang.org/account/avatar/00/23/04/2a/4c3d9a4a.jpg","comment_is_top":false,"comment_ctime":1605584194,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1605584194","product_id":100020801,"comment_content":"所谓两阶段提交，是不是可以理解为 分两步写redolog与binlog，然后进行一次提交，保证原子性？","like_count":0},{"had_liked":false,"id":261497,"user_name":"Geek_f265e1","can_delete":false,"product_type":"c1","uid":2319817,"ip_address":"","ucode":"3CD7E3A8347702","user_header":"","comment_is_top":false,"comment_ctime":1605360932,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1605360932","product_id":100020801,"comment_content":"mysql把数据同步到磁盘在一般情况下不会用到redolog，只有在异常后启动是才会从redolog里面去拿数据。不知道我说的对不对","like_count":0},{"had_liked":false,"id":261266,"user_name":"勿忘初心","can_delete":false,"product_type":"c1","uid":1803189,"ip_address":"","ucode":"344B8CD4844338","user_header":"https://static001.geekbang.org/account/avatar/00/1b/83/b5/47c75bfe.jpg","comment_is_top":false,"comment_ctime":1605254163,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1605254163","product_id":100020801,"comment_content":"老师您好,有一点不是很明白,您说redo log 主要节省的是随机写磁盘的IO消耗（转成顺序写）.可是你又说真正对磁盘数据页的修改，是通过将内存里脏页的数据刷回磁盘来完成的，而不是根据redolog ，那不就意味着最后还是要往磁盘随机写的。只是这个随机写的过程延后了，但是并没有节省啊。","like_count":0},{"had_liked":false,"id":261151,"user_name":"小彬","can_delete":false,"product_type":"c1","uid":2063911,"ip_address":"","ucode":"8688FD8E7BAA4F","user_header":"https://static001.geekbang.org/account/avatar/00/1f/7e/27/c2502abf.jpg","comment_is_top":false,"comment_ctime":1605230273,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1605230273","product_id":100020801,"comment_content":"问题，文章没有描述写完binlog后，crash的情况。这时系统怎么样操作redo log和binlog的？","like_count":0},{"had_liked":false,"id":260678,"user_name":"DoubleLet","can_delete":false,"product_type":"c1","uid":1481396,"ip_address":"","ucode":"17D38922C2E09D","user_header":"https://static001.geekbang.org/account/avatar/00/16/9a/b4/284503aa.jpg","comment_is_top":false,"comment_ctime":1605081831,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1605081831","product_id":100020801,"comment_content":"讲的忒好，评论区也有大神，可应该不适合小白","like_count":0},{"had_liked":false,"id":260480,"user_name":"sotondolphin","can_delete":false,"product_type":"c1","uid":1307088,"ip_address":"","ucode":"42198CE9B201FD","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/QZBHia4nXtspEaRibpmMIMVcDA2HHkNypfvVJ2IllQC3FeFCt7f9iaHW7z5yQ4lcB79ibJwia6tNtpuFroufntMhc2g/132","comment_is_top":false,"comment_ctime":1605019617,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1605019617","product_id":100020801,"comment_content":"一天一备，数据的有效性就很高，做恢复也容易，但是太耗储存空间了","like_count":0},{"had_liked":false,"id":260257,"user_name":"无痕","can_delete":false,"product_type":"c1","uid":1183711,"ip_address":"","ucode":"61B92B75092E4B","user_header":"https://static001.geekbang.org/account/avatar/00/12/0f/df/e0eb437e.jpg","comment_is_top":false,"comment_ctime":1604970811,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604970811","product_id":100020801,"comment_content":"老师。物理日志和逻辑日志说法上是怎么区别的","like_count":0},{"had_liked":false,"id":259904,"user_name":"Dannier","can_delete":false,"product_type":"c1","uid":1707575,"ip_address":"","ucode":"37EF32ADD1A023","user_header":"https://static001.geekbang.org/account/avatar/00/1a/0e/37/3fa2350d.jpg","comment_is_top":false,"comment_ctime":1604885054,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604885054","product_id":100020801,"comment_content":"binlog会记录没有提交的事务吗？","like_count":0},{"had_liked":false,"id":259750,"user_name":"Geek_0006c6","can_delete":false,"product_type":"c1","uid":1528041,"ip_address":"","ucode":"2B964C7EEFFAE2","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/l5hb1CM2hib112vNkZ1lCH2wKuqo7BtWUDDvW0VsBJic1IzY9eT5Qib7EMVAUdOqagMqcnuhvNhkic4JnVoMm1LZdQ/132","comment_is_top":false,"comment_ctime":1604825560,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604825560","product_id":100020801,"comment_content":"三点：更新update操作过程（两阶段法）；safe-crash机制（redolog）；备份恢复（binlog）。<br>.redolog为什么是固定大小循环写的而binlog要追加写?","like_count":0},{"had_liked":false,"id":259708,"user_name":"Wangyf","can_delete":false,"product_type":"c1","uid":2226219,"ip_address":"","ucode":"349068A07CB1D4","user_header":"https://static001.geekbang.org/account/avatar/00/21/f8/2b/339660f1.jpg","comment_is_top":false,"comment_ctime":1604817184,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1604817184","product_id":100020801,"comment_content":"更新频繁的场景适合一天一备吧，比如火车票飞机票。之前上数据库课程的时候，老师讲到日志系统。就说旁边的某航空公司，晚上下班了就开始备份当天的购票记录。航空公司就是一天一备份的，因为每天都有人买票。","like_count":0},{"had_liked":false,"id":259634,"user_name":"毕成功 Antony","can_delete":false,"product_type":"c1","uid":1079898,"ip_address":"","ucode":"32219043046F62","user_header":"https://static001.geekbang.org/account/avatar/00/10/7a/5a/4dfb21f7.jpg","comment_is_top":false,"comment_ctime":1604798667,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604798667","product_id":100020801,"comment_content":"从逻辑推断上来看，binlog写入的时机应该是事务提交时先写入，然后再写入redo log的commit。<br><br>只有这样，数据恢复时，就不会出现其实本未提交的事务，居然有了redo prepare和binlog，然后当做commit给恢复了。","like_count":0},{"had_liked":false,"id":259328,"user_name":"大圣","can_delete":false,"product_type":"c1","uid":2145161,"ip_address":"","ucode":"0190AE6EF37168","user_header":"https://static001.geekbang.org/account/avatar/00/20/bb/89/84212151.jpg","comment_is_top":false,"comment_ctime":1604682794,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604682794","product_id":100020801,"comment_content":"如果有两个事务,事务A先写了一条记录,但不提交, 然后事务B 开始疯狂的写,把粉板写满了,这时两个事务都未提交, 那粉板会把这些记录擦除吗?如果不擦除, 其它事务如何再写入?如果擦除, 事务A后来要回滚怎么办?","like_count":0},{"had_liked":false,"id":259183,"user_name":"玄真","can_delete":false,"product_type":"c1","uid":2237677,"ip_address":"","ucode":"D21A7096AFB816","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLg04lnicnUNWVmohBVoWiaKPpuYu8j0CHVIjjurfO3YcJqicHZBMYFqjoEpiaa3jrNmRzyzXiaPPt29cA/132","comment_is_top":false,"comment_ctime":1604647360,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604647360","product_id":100020801,"comment_content":"我在之前的资料上面看的两段式提交是这样：<br>1.\t当事务提交时InnoDB存储引擎进行prepare操作<br>2.\tMysql数据库上层写入二进制日志<br>3.\tInnodb存储引擎层将日志写入重做日志文件<br>a)\t修改内存中事务对应的信息，并且将日志写入重做日志缓冲<br>b)\t调用fsync将确保日志都从重做日志缓冲写入磁盘<br>也就是先写binlog再写redolog，但是看你关于update那个描述是先写redolog再写binlog最后更新redolog的状态为提交，这我就迷惑了","like_count":0},{"had_liked":false,"id":258812,"user_name":"陈小渣👻","can_delete":false,"product_type":"c1","uid":1374445,"ip_address":"","ucode":"6B968B06C76C63","user_header":"https://static001.geekbang.org/account/avatar/00/14/f8/ed/60fb8fba.jpg","comment_is_top":false,"comment_ctime":1604561358,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604561358","product_id":100020801,"comment_content":"更新的时候如果去根据主键id去更新，缓存清除掉这个主键对应的一条数据不就好了吗，为什么要清除所有数据","like_count":0},{"had_liked":false,"id":258797,"user_name":"Lintendo","can_delete":false,"product_type":"c1","uid":2057437,"ip_address":"","ucode":"7D500708DA7595","user_header":"https://static001.geekbang.org/account/avatar/00/1f/64/dd/53739daf.jpg","comment_is_top":false,"comment_ctime":1604558800,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604558800","product_id":100020801,"comment_content":"redo log会有一致性问题吗？比如刚update一条数据，还没来得及更新到磁盘，此时来执行查询操作会不会读到旧值？","like_count":0},{"had_liked":false,"id":258513,"user_name":"优秀的哲","can_delete":false,"product_type":"c1","uid":1317416,"ip_address":"","ucode":"48002805B39C4E","user_header":"https://static001.geekbang.org/account/avatar/00/14/1a/28/db76d173.jpg","comment_is_top":false,"comment_ctime":1604470758,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604470758","product_id":100020801,"comment_content":"有个疑问：一个事务A，在redo log ，binlog写入成功，但是在commit的前一刻实例crash了。此时redo log是prepare 状态，binlog 落盘了。在实例恢复的时候事务A是回滚还是commit成功。","like_count":0},{"had_liked":false,"id":258415,"user_name":"Avan","can_delete":false,"product_type":"c1","uid":1814688,"ip_address":"","ucode":"A5A6A5AF28FEEC","user_header":"https://static001.geekbang.org/account/avatar/00/1b/b0/a0/c8a5a061.jpg","comment_is_top":false,"comment_ctime":1604418022,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604418022","product_id":100020801,"comment_content":"逻辑日志和物理日志的区别还是没有搞明白，可以理解成物理日志记录的是最后的结果恢复的很快，逻辑日志还要有一个执行每一个sql才得到结果的过程吗？","like_count":0},{"had_liked":false,"id":258188,"user_name":"aimos.pang","can_delete":false,"product_type":"c1","uid":1449066,"ip_address":"","ucode":"3BE160DFC37558","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLKDeJwmJINEXh8lwADhZ0Wwia4qibMFe4uSP8v6qKIibpjXhCka45iaXpYm49XJF0ibSRmqicvN9IL5BXw/132","comment_is_top":false,"comment_ctime":1604322541,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604322541","product_id":100020801,"comment_content":"那么在什么场景下，一天一备会比一周一备更有优势呢？或者说，它影响了这个数据库系统的哪个指标？<br><br>当库比较小的时候，一天一备效率更高！","like_count":0},{"had_liked":false,"id":258175,"user_name":"x-ray","can_delete":false,"product_type":"c1","uid":1140175,"ip_address":"","ucode":"8363F0C4D0AC0B","user_header":"https://static001.geekbang.org/account/avatar/00/11/65/cf/326c0eea.jpg","comment_is_top":false,"comment_ctime":1604319390,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604319390","product_id":100020801,"comment_content":"上面提到，当需要恢复到指定的某一秒，首先找最近的全量备份，然后根据binlog重放，这个过程中貌似没有用到redo log。那么我是不是可以理解为，当数据库宕机时重启时，最新的状态是以redo log为基准的？那这个时候貌似用不到binlog。。。我感觉这里让我理解得有点迷糊。。。","like_count":0},{"had_liked":false,"id":257291,"user_name":"艾瑞克","can_delete":false,"product_type":"c1","uid":1167693,"ip_address":"","ucode":"934E5E827EB76B","user_header":"","comment_is_top":false,"comment_ctime":1603931073,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603931073","product_id":100020801,"comment_content":"老师好，请问redo log最开始是写在内存中的么，当写满了才写到磁盘去的么？mysql异常了，内存数据应该是会丢失的吧？","like_count":0},{"had_liked":false,"id":256862,"user_name":"Fire","can_delete":false,"product_type":"c1","uid":2057513,"ip_address":"","ucode":"8D3E102E690443","user_header":"https://static001.geekbang.org/account/avatar/00/1f/65/29/8c0fe011.jpg","comment_is_top":false,"comment_ctime":1603767678,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1603767678","product_id":100020801,"comment_content":"老师，我有一个问题，文中讲到：“当有一条记录需要更新的时候，InnoDB 引擎就会先把记录写到 redo log（粉板）里面，并更新内存，这个时候更新就算完成了。同时，InnoDB 引擎会在适当的时候，将这个操作记录更新到磁盘里面”。那么，如果 InnoDB 在把记录写到redo log后，写入磁盘前，有请求查询数据，是不是直接直接从内存中查，内存没有再查数据库呢？由此延伸出MySQL的每次查询，应该都是先查询内存，是吗？","like_count":0},{"had_liked":false,"id":256723,"user_name":"abc","can_delete":false,"product_type":"c1","uid":2246235,"ip_address":"","ucode":"8D9CFF6CD6E0C0","user_header":"https://static001.geekbang.org/account/avatar/00/22/46/5b/e6385a52.jpg","comment_is_top":false,"comment_ctime":1603717139,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603717139","product_id":100020801,"comment_content":"#提问#redo log#将redolog的记录更新到磁盘中，是说将内存中已经更新的数据，写入到磁盘中，同时擦除响应redolog的相关记录吗？","like_count":0},{"had_liked":false,"id":256066,"user_name":"Geek_d15b45","can_delete":false,"product_type":"c1","uid":1705853,"ip_address":"","ucode":"FD2E9671B311C0","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eo0VriaLNLA79Poua9EUKklfw36cXGEa7olgicUWGo4Q6exh3y2kz3SO0QibeqMjaGSJHzhCt1WjNq6g/132","comment_is_top":false,"comment_ctime":1603517563,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603517563","product_id":100020801,"comment_content":"精彩","like_count":0},{"had_liked":false,"id":254123,"user_name":"听雨","can_delete":false,"product_type":"c1","uid":1254493,"ip_address":"","ucode":"252754F9FCFF0C","user_header":"https://static001.geekbang.org/account/avatar/00/13/24/5d/65e61dcb.jpg","comment_is_top":false,"comment_ctime":1603069401,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603069401","product_id":100020801,"comment_content":"MySQL在提交事务阶段，会将Redo Log写入Redo Log Buffer中，同时会去写Bin Log文件，Bin Log写入完成后，会在Redo Log末尾加上个commit用以表示事务已经完成提交。那么，当写入Bin Log完成后，Redo Log刷盘前，MySQL宕机了，这时候相当于事务失败了，那Bin Log里面的那条数据是怎么处理的呢？","like_count":0},{"had_liked":false,"id":253161,"user_name":"小软的长颈鹿","can_delete":false,"product_type":"c1","uid":1244320,"ip_address":"","ucode":"ECAA0891DC55D4","user_header":"https://static001.geekbang.org/account/avatar/00/12/fc/a0/48997178.jpg","comment_is_top":false,"comment_ctime":1602638888,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602638888","product_id":100020801,"comment_content":"如果在redo log comnit前，bin log写入硬盘后发生crash会导致不一致情况出现吗？","like_count":0},{"had_liked":false,"id":251914,"user_name":"Tulane","can_delete":false,"product_type":"c1","uid":1242467,"ip_address":"","ucode":"E1F5108B9E738F","user_header":"https://static001.geekbang.org/account/avatar/00/12/f5/63/53639bb7.jpg","comment_is_top":false,"comment_ctime":1601972084,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601972084","product_id":100020801,"comment_content":"老师, 如果执行器执行的一条 sql, 涉及的数据在redolog的日志中也有相关的一些操作, 而 redolog 日志中相关日志, 还没有擦除并更新到磁盘的B+树结构中, 此时执行器直接读取引擎得到的结果可能是不全的么?<br><br>所以执行器读取 Innodb的数据时, 需要先把数据页读到内存, 然后与redolog中相关的操作结合下, 再给出结果呢?","like_count":0},{"had_liked":false,"id":251889,"user_name":"Wang","can_delete":false,"product_type":"c1","uid":1052957,"ip_address":"","ucode":"9BEFA46433F86B","user_header":"https://static001.geekbang.org/account/avatar/00/10/11/1d/6ad7eb3c.jpg","comment_is_top":false,"comment_ctime":1601952330,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1601952330","product_id":100020801,"comment_content":"交易订单支付系统一天一备份比周备份好一些，涉及用户的交易重要性高。","like_count":0},{"had_liked":false,"id":251826,"user_name":"涛","can_delete":false,"product_type":"c1","uid":1158168,"ip_address":"","ucode":"48C7BDB7AD650D","user_header":"https://static001.geekbang.org/account/avatar/00/11/ac/18/25ae9cf7.jpg","comment_is_top":false,"comment_ctime":1601889415,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601889415","product_id":100020801,"comment_content":"为什么归档日志没有crash-safe能力？","like_count":0},{"had_liked":false,"id":251665,"user_name":"橘子龙","can_delete":false,"product_type":"c1","uid":1112359,"ip_address":"","ucode":"8F39025CCB4123","user_header":"https://static001.geekbang.org/account/avatar/00/10/f9/27/2f71dbbe.jpg","comment_is_top":false,"comment_ctime":1601781025,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601781025","product_id":100020801,"comment_content":"两阶段提交那里并没有讲清楚 比如使用两阶段后会达到什么效果 p阶段的redolog 宕机后怎么恢复 等等 感觉可以说透一点","like_count":0},{"had_liked":false,"id":251621,"user_name":"Li Lei  Han Mei Mei","can_delete":false,"product_type":"c1","uid":1184299,"ip_address":"","ucode":"8F3DC22E91C4BB","user_header":"https://static001.geekbang.org/account/avatar/00/12/12/2b/0d8393ed.jpg","comment_is_top":false,"comment_ctime":1601732168,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601732168","product_id":100020801,"comment_content":"一天还是一周，影响的是灾后恢复所需要花费的时间。备份越频繁，灾后恢复越快。","like_count":0},{"had_liked":false,"id":251607,"user_name":"panxl1098","can_delete":false,"product_type":"c1","uid":1141021,"ip_address":"","ucode":"FB9D6F7B7853C8","user_header":"https://static001.geekbang.org/account/avatar/00/11/69/1d/d43aa419.jpg","comment_is_top":false,"comment_ctime":1601719554,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601719554","product_id":100020801,"comment_content":"老师，你好，我想问下，在分布式事务中的日志情况，是怎么样的。我记得有一个undolog的东西。能给说明下吗？","like_count":0},{"had_liked":false,"id":251593,"user_name":"沈","can_delete":false,"product_type":"c1","uid":1045368,"ip_address":"","ucode":"6BB452D97C50A5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f3/78/258fdd1f.jpg","comment_is_top":false,"comment_ctime":1601708779,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601708779","product_id":100020801,"comment_content":"有没有一节课讲下mysql编译后的系统目录和相关文件结构，缺少在系统架构层面上去看系统实现","like_count":0},{"had_liked":false,"id":251117,"user_name":"dbtiger","can_delete":false,"product_type":"c1","uid":1324202,"ip_address":"","ucode":"05E8447593318C","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/aa/431de942.jpg","comment_is_top":false,"comment_ctime":1601368022,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601368022","product_id":100020801,"comment_content":"redo log和Oracle的redo log机制一样，记录的是数据库所有变化。<br>binlog归档日志和Oracle数据库的归档日志有点不一样，Oracle归档存粹是将redo log的备份。","like_count":0},{"had_liked":false,"id":250018,"user_name":"Ball","can_delete":false,"product_type":"c1","uid":1521451,"ip_address":"","ucode":"1EE949E68D84CA","user_header":"https://static001.geekbang.org/account/avatar/00/17/37/2b/b32f1d66.jpg","comment_is_top":false,"comment_ctime":1600907496,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1600907496","product_id":100020801,"comment_content":"老师，两阶段提交这一部分我有个问题要请教下。<br>写入 binlog 和提交 redolog 是原子操作吗？怎么保证这两个操作的事务性？<br>如果 binlog 提交成功但是 redolog 还是 prepare 状态，这样 log 和库里的数据就又不一致了。","like_count":0},{"had_liked":false,"id":249617,"user_name":"W.Qiong吴琼","can_delete":false,"product_type":"c1","uid":2016087,"ip_address":"","ucode":"B6F54E3504641D","user_header":"https://static001.geekbang.org/account/avatar/00/1e/c3/57/76bd5e8a.jpg","comment_is_top":false,"comment_ctime":1600711844,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1600711844","product_id":100020801,"comment_content":"想咨询一下wal需要先写日志（redolog）再执行操作写磁盘，两阶段提交却是先执行语句在写日志(redolog和binlog），这两个是不是矛盾了呢","like_count":0},{"had_liked":false,"id":249526,"user_name":"Snail～","can_delete":false,"product_type":"c1","uid":2105727,"ip_address":"","ucode":"83A23EEDCB4F62","user_header":"https://static001.geekbang.org/account/avatar/00/20/21/7f/a471de8b.jpg","comment_is_top":false,"comment_ctime":1600683587,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1600683587","product_id":100020801,"comment_content":"您好，redo log日志和 binlog日志存储的都是增删改操作日志吗？查询操作是不是不存储日志？","like_count":0},{"had_liked":false,"id":249518,"user_name":"xxxt","can_delete":false,"product_type":"c1","uid":2023156,"ip_address":"","ucode":"376FEF77BED1C3","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTITgmLpJlcmsj61wiaHujcNgFEEKBiaMGF4MiaY6PqT7BEPniaolUpDLXr5TwVtn8icctVbH8BUhheaiaYQ/132","comment_is_top":false,"comment_ctime":1600680836,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1600680836","product_id":100020801,"comment_content":"我有个疑问 WAL技术是先写日志，再写磁盘 可是看文章在解释update语句的内部执行流程时第二步就调用引擎接口写入这行新数据，然后再写的日志。这样不久冲突了吗？调用引擎写入数据应该就是写入物理磁盘吧  ","like_count":0},{"had_liked":false,"id":249330,"user_name":"Summer","can_delete":false,"product_type":"c1","uid":2189226,"ip_address":"","ucode":"AFF9C7061A78C5","user_header":"https://static001.geekbang.org/account/avatar/00/21/67/aa/95817353.jpg","comment_is_top":false,"comment_ctime":1600595072,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1600595072","product_id":100020801,"comment_content":" 还是搞不懂为什么需要两个log才能恢复数据，既然server层已经有一个binlog，为什么不能用binlog做crash的恢复，为什么要多此一举搞一下redolog","like_count":0},{"had_liked":false,"id":249295,"user_name":"Geek_057492","can_delete":false,"product_type":"c1","uid":2172785,"ip_address":"","ucode":"81992FFDBD9DEF","user_header":"","comment_is_top":false,"comment_ctime":1600575547,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1600575547","product_id":100020801,"comment_content":"为什么我这边查询的表没有索引，一个表数据90w一个100w主子表，后来把主表的某个字段迁移到子表，后来发现子表查询比主子表关联查询慢了一秒多，不是很理解了？求老师解答","like_count":0},{"had_liked":false,"id":248958,"user_name":"qchang","can_delete":false,"product_type":"c1","uid":2180937,"ip_address":"","ucode":"F9D675805F44B8","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKWYicxW2TxmZbD80jCQbfs7icgV7fGdOTRWLzN7YSfLicVxU3lorJ3NSlNuzBvABrSiaHIjgibECjAVDg/132","comment_is_top":false,"comment_ctime":1600392008,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1600392008","product_id":100020801,"comment_content":"有个疑问，redo log并不能即时落盘，也就是事务提交并不能真正写入数据库，那查询或更新这条记录，存储引擎是怎么处理的？","like_count":0},{"had_liked":false,"id":248940,"user_name":"piboye","can_delete":false,"product_type":"c1","uid":1066752,"ip_address":"","ucode":"7CFD8712857A85","user_header":"https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg","comment_is_top":false,"comment_ctime":1600388546,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1600388546","product_id":100020801,"comment_content":"先写binlog或者先写redolog感觉问题也不大吧？不是都可以通过先写的恢复后写那个不一致的地方吗？ 因为并发导致日志顺序不一样？还是因为不一定是只有一条日志不一致？如果存在多条不一致的话，prepare就好理解，相当于标示可能不一致的区间了。老师这样理解对不？","like_count":0},{"had_liked":false,"id":248813,"user_name":"Bryant.C","can_delete":false,"product_type":"c1","uid":1172363,"ip_address":"","ucode":"0DF832373CFA97","user_header":"https://static001.geekbang.org/account/avatar/00/11/e3/8b/27f875ba.jpg","comment_is_top":false,"comment_ctime":1600319528,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1600319528","product_id":100020801,"comment_content":"应该影响的是数据的恢复时间进而影响系统的可用性，备份时间粒度越细，在发生问题时恢复时间越短，系统的“不可用”时间也就越短。但粒度变细后相应的存储和维护成本也会增长，业务应该按重要性来权衡这个中间的roi","like_count":0},{"had_liked":false,"id":248740,"user_name":"答案在风中","can_delete":false,"product_type":"c1","uid":1009548,"ip_address":"","ucode":"2CDD5A15D37121","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/8c/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1600281374,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1600281374","product_id":100020801,"comment_content":"binlog不支持crashsafe的根本原因应该是其作为逻辑层实现，没有具备事务的概念，也没法做到两阶段的提交；所以在更新语句执行跨server层、存储引擎层的时候，出现crash，没法单纯的通过binlog来推断跟新的执行情况（类比分布式事务问题）。而引入redolog，作为存储引擎层实现，天然的具备了事务概念，方便扩展为两阶段提交，已达到crash-safe能力；","like_count":0},{"had_liked":false,"id":248471,"user_name":"伍良贵","can_delete":false,"product_type":"c1","uid":1120195,"ip_address":"","ucode":"D59A6007155586","user_header":"https://static001.geekbang.org/account/avatar/00/11/17/c3/026096a4.jpg","comment_is_top":false,"comment_ctime":1600174402,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1600174402","product_id":100020801,"comment_content":"redo log和binlog同时写入的时候，假设数据库宕机了，应该会出现数据不一直的情况把  比如binlog写成功了 redolog 还没写完这种，或者反之","like_count":0},{"had_liked":false,"id":248456,"user_name":"很大的勇气","can_delete":false,"product_type":"c1","uid":1695608,"ip_address":"","ucode":"7871D1C1E22F3F","user_header":"https://static001.geekbang.org/account/avatar/00/19/df/78/d4946736.jpg","comment_is_top":false,"comment_ctime":1600170090,"is_pvip":false,"replies":[{"id":"92526","content":"先别急，看看后面的篇幅在回来回顾","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1602664342,"ip_address":"","comment_id":248456,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1600170090","product_id":100020801,"comment_content":"讲的很垃圾。例如:重要的日志模块:binlog。这一段。 第一步说了是将数据先放入内存。第二步是就是在内存中修改了这个值。第三步为什么还要会将修改的行放入内存呢。明显感觉逻辑不通。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505656,"discussion_content":"先别急，看看后面的篇幅在回来回顾","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602664342,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":248442,"user_name":"z","can_delete":false,"product_type":"c1","uid":2173047,"ip_address":"","ucode":"974B24F6E9308D","user_header":"https://static001.geekbang.org/account/avatar/00/21/28/77/e6b4806d.jpg","comment_is_top":false,"comment_ctime":1600164648,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1600164648","product_id":100020801,"comment_content":"对于binlog没有crash-safe能力的理解：假设在只有binlog日志的情况下（即不使用InnoDB存储引擎，使用其他事务型存储引擎），事务（update操作）提交后且binlog未写入event时，MySQL服务器崩溃重启后，事务提交后的数据还在，而binlog并没记录这次修改，等后面数据恢复时就会产生数据一致性的问题。此时再假设在只有redolog日志的情况下，因为WAL技术的原因，即使在MySQL服务器在任一阶段崩溃，也不会发生数据一致性的问题。","like_count":0},{"had_liked":false,"id":248301,"user_name":"爱因诗贤","can_delete":false,"product_type":"c1","uid":1528379,"ip_address":"","ucode":"150C439B87CED1","user_header":"https://static001.geekbang.org/account/avatar/00/17/52/3b/7a2610a6.jpg","comment_is_top":false,"comment_ctime":1600094184,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1600094184","product_id":100020801,"comment_content":"上次面试的时候，问了我一个&quot;为什么两阶段提交的问题&quot;，我按照你文章讲的回答正确了，可是面试官紧接着问我什么是&quot;三阶段提交？&quot;，我一脸懵逼","like_count":0},{"had_liked":false,"id":248033,"user_name":"木易大可","can_delete":false,"product_type":"c1","uid":1031719,"ip_address":"","ucode":"6BE8F506F07B5E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/be/27/348dda2a.jpg","comment_is_top":false,"comment_ctime":1599988187,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599988187","product_id":100020801,"comment_content":"看了两遍，才大概理解，加上看了留言部分，才算是有个深入的认识，继续学习💪","like_count":0},{"had_liked":false,"id":247654,"user_name":"Geek_zjynb666","can_delete":false,"product_type":"c1","uid":1628961,"ip_address":"","ucode":"4360D9F67B9601","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJDb4kl3yFjZ8q8WibZGjJ3EarrAqPXZOzYfZzficx2zicvYXvJocZKGiabnicgjMA8NfoPnsT7VzJspyA/132","comment_is_top":false,"comment_ctime":1599787255,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599787255","product_id":100020801,"comment_content":"我理解binlog不能crash safe是因为binlog不知道未写入磁盘的数据是哪些吧？请大神认证下","like_count":0},{"had_liked":false,"id":247588,"user_name":"学习学个屁","can_delete":false,"product_type":"c1","uid":1049017,"ip_address":"","ucode":"DF2D61E6FB2FCE","user_header":"https://static001.geekbang.org/account/avatar/00/10/01/b9/73435279.jpg","comment_is_top":false,"comment_ctime":1599748835,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599748835","product_id":100020801,"comment_content":"一天一备份,数据比较全,如出问题,可以恢复到任意一天,缺点是 每天备份会占用一定资源;<br>每周一备份,数据不一定全,如果中间出问题,不一定能恢复到任意一天;","like_count":0},{"had_liked":false,"id":247234,"user_name":"bob","can_delete":false,"product_type":"c1","uid":2055737,"ip_address":"","ucode":"75F74AFEC9B51E","user_header":"","comment_is_top":false,"comment_ctime":1599638465,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599638465","product_id":100020801,"comment_content":"如果按照原先的2阶段提交，在执行完bin_log的操作后，<br>理论上之后是执行器调用引擎的提交事务接口，执行commit操作，<br>但如果在这个时候发生宕机，<br>redo_log将只是perpare状态，binlog已经执行完了，请问redo_log岂不是和bin_og不一致？","like_count":0},{"had_liked":false,"id":246663,"user_name":"清晨吼于林","can_delete":false,"product_type":"c1","uid":1112920,"ip_address":"","ucode":"6ADCB9B9FB8330","user_header":"https://static001.geekbang.org/account/avatar/00/10/fb/58/6c422e70.jpg","comment_is_top":false,"comment_ctime":1599448429,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599448429","product_id":100020801,"comment_content":"关闭binglog，还需要两阶段提交吗？","like_count":0},{"had_liked":false,"id":246309,"user_name":"GEEKBANG_6211350","can_delete":false,"product_type":"c1","uid":1702670,"ip_address":"","ucode":"384E420950A9B3","user_header":"https://wx.qlogo.cn/mmopen/vi_32/takyO3145iciaG5Ytv3xxxoRpUTiaw6N10O8sCGfWZGZz6gx2rtNuJiaydzIFFrLAduov0tzg6j0s337aBIKPhGdeA/132","comment_is_top":false,"comment_ctime":1599272891,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599272891","product_id":100020801,"comment_content":"老师你好，两阶段提交有个疑问。redo log 完成写入，binlog 也完成了写入，但是准备在 rodo log 的记录改成commit 状态之前 发生了crash 那这样也没有保持 redo log 与 binlog 的一致啊？","like_count":0},{"had_liked":false,"id":246056,"user_name":"Geek_7b02f9","can_delete":false,"product_type":"c1","uid":2164223,"ip_address":"","ucode":"E1216DB46AD4A7","user_header":"","comment_is_top":false,"comment_ctime":1599146043,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599146043","product_id":100020801,"comment_content":"两阶段提交那里，如果最后一步把redo log改成commit状态失败，这也导致不一致了吧？这个怎么办？说明两阶段也不可靠吗？","like_count":0},{"had_liked":false,"id":246034,"user_name":"Geek_175bc2","can_delete":false,"product_type":"c1","uid":2131639,"ip_address":"","ucode":"D8D6F17C8D6B1D","user_header":"","comment_is_top":false,"comment_ctime":1599139647,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599139647","product_id":100020801,"comment_content":"有没有可能引擎在写入新行之后挂掉，此时redo_log没有写入进入到prepare阶段","like_count":0},{"had_liked":false,"id":245811,"user_name":"陈维良","can_delete":false,"product_type":"c1","uid":2162079,"ip_address":"","ucode":"385B45C42D449D","user_header":"https://static001.geekbang.org/account/avatar/00/20/fd/9f/8c3fa687.jpg","comment_is_top":false,"comment_ctime":1599060310,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599060310","product_id":100020801,"comment_content":"这个两阶段提交不是要innodb_support_xa么？","like_count":0},{"had_liked":false,"id":245537,"user_name":"学习学个屁","can_delete":false,"product_type":"c1","uid":1049017,"ip_address":"","ucode":"DF2D61E6FB2FCE","user_header":"https://static001.geekbang.org/account/avatar/00/10/01/b9/73435279.jpg","comment_is_top":false,"comment_ctime":1598970478,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598970478","product_id":100020801,"comment_content":" redo log  会循环写,用完了 会覆盖, bin log 不会,用完了会新建一个<br> redo log  记录更新之后的数据, bin log 记录更新之前的数据<br>redo log 是innodb特有的 物理日志, bin log是所有Server 层实现,所有引擎都可以使用<br>redo log 是按顺序写入日志的,Bin log是写进磁盘的<br>只有当redo 和 bin 两个都写入成功了,数据才一致,这样子为了保持数据一致性;<br>","like_count":0},{"had_liked":false,"id":245374,"user_name":"Magic","can_delete":false,"product_type":"c1","uid":1272047,"ip_address":"","ucode":"FD9CEDAA419EB0","user_header":"https://static001.geekbang.org/account/avatar/00/13/68/ef/6264ca3d.jpg","comment_is_top":false,"comment_ctime":1598927273,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598927273","product_id":100020801,"comment_content":"一天一备相比一周一备，提高了系统的恢复能力。即只需要回放一天的binlog就可以追上线上环境了。这对于那些对恢复时延要求很苛刻的业务场景比较适用。","like_count":0},{"had_liked":false,"id":245339,"user_name":"wangxw_it","can_delete":false,"product_type":"c1","uid":1522013,"ip_address":"","ucode":"213897FC88E98C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIcEZckW8g3NsPOdoia9UOTpHibeAp791ic8k47BK2FnrVsff6TXze67xHM093XmqUPY5Ck81Sd4oMvQ/132","comment_is_top":false,"comment_ctime":1598919481,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1598919481","product_id":100020801,"comment_content":"提交事物处于commit状态失败的话会不会也造成不一致","like_count":0},{"had_liked":false,"id":245179,"user_name":"Geek_684984","can_delete":false,"product_type":"c1","uid":2149833,"ip_address":"","ucode":"BAE0E43AA80892","user_header":"","comment_is_top":false,"comment_ctime":1598856708,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598856708","product_id":100020801,"comment_content":"binlog记录日志用的是追加写,如果sync_binlog参数不设置为1,binlog日志也是写到内存中吗?也是在mysql空闲的时候写到磁盘上吗?","like_count":0},{"had_liked":false,"id":245124,"user_name":"Geek_684984","can_delete":false,"product_type":"c1","uid":2149833,"ip_address":"","ucode":"BAE0E43AA80892","user_header":"","comment_is_top":false,"comment_ctime":1598840796,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598840796","product_id":100020801,"comment_content":"redo log在内存中的数据,也就是在&quot;粉板&quot;的日志记录,是会随着机器重启而丢失的吧?","like_count":0},{"had_liked":false,"id":244847,"user_name":"fire","can_delete":false,"product_type":"c1","uid":1101498,"ip_address":"","ucode":"0295B406DF2C8C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJoW8dLZMvrEicCTI33B85YTtlBZKcq0iaTjaWibW1BmNYp1I8WIanssjt6qibIVanNUormnTMxGv8nxg/132","comment_is_top":false,"comment_ctime":1598698373,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598698373","product_id":100020801,"comment_content":"请教一下：<br>1，假如我业务开的事务还没有commit，那么从库拿到binlog后，会不会导致主库查询到未提交的事务？<br>2，业务事务rollback后，主库是怎么rollback的呢？","like_count":0},{"had_liked":false,"id":244332,"user_name":"Scarf","can_delete":false,"product_type":"c1","uid":1021792,"ip_address":"","ucode":"3EDD87BD6354D5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/97/60/873cd557.jpg","comment_is_top":false,"comment_ctime":1598486972,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598486972","product_id":100020801,"comment_content":"老师。这里这两种日志是采用redo-binlog-redo，那采用binlog-redo-binlog的模式是否也可行？","like_count":0},{"had_liked":false,"id":243248,"user_name":"TinyCalf","can_delete":false,"product_type":"c1","uid":2137418,"ip_address":"","ucode":"0A3EF213359388","user_header":"https://static001.geekbang.org/account/avatar/00/20/9d/4a/09a5041e.jpg","comment_is_top":false,"comment_ctime":1598003251,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598003251","product_id":100020801,"comment_content":"老师您好，对于”粉板满了，这时候不能再执行新的更新，得停下来先擦掉一些记录，把 checkpoint 推进一下“这句话我有几个小问题：<br>停下来擦掉记录，不会造成请求阻塞吗？<br>处理擦掉部分的时候还没有写入，如果这时crash难道不会出问题吗？<br>如果光写log没写到库里，那不会导致数据实时性有问题吗？<br>为什么要写到写不下才擦掉，队列处理错峰填谷不是更合理吗？","like_count":0},{"had_liked":false,"id":243148,"user_name":"Geek_f2950d","can_delete":false,"product_type":"c1","uid":2044804,"ip_address":"","ucode":"A39B46B3D340EA","user_header":"","comment_is_top":false,"comment_ctime":1597976430,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597976430","product_id":100020801,"comment_content":"老师，请问下redo. log是innodb存储引擎特有的，和bin. log一起保障主从库之间数据的一致性。那么别的存储引擎是怎么保障主从库的一致性的？","like_count":0},{"had_liked":false,"id":242977,"user_name":"泉","can_delete":false,"product_type":"c1","uid":1613859,"ip_address":"","ucode":"A51243692E231A","user_header":"https://static001.geekbang.org/account/avatar/00/18/a0/23/d0d36383.jpg","comment_is_top":false,"comment_ctime":1597910045,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597910045","product_id":100020801,"comment_content":"老师您好，有个问题想请教一下您：<br>当使用java代码JDBC插入mysql数据时，在调用connection.commit（）方法时，是否是提交了事务,binlog日志做了记录，然后redolog更改了记录状态为commit","like_count":0},{"had_liked":false,"id":242896,"user_name":"smilepy","can_delete":false,"product_type":"c1","uid":1299892,"ip_address":"","ucode":"B137D7BE57FCF5","user_header":"https://static001.geekbang.org/account/avatar/00/13/d5/b4/475ac173.jpg","comment_is_top":false,"comment_ctime":1597886882,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597886882","product_id":100020801,"comment_content":"林老师，我有一个问题，如果binlog写成功了，但redo log commit阶段进程异常重启了，我的理解这时binlog和数据库的数据依然是不一致的啊。","like_count":0},{"had_liked":false,"id":242353,"user_name":"余学文","can_delete":false,"product_type":"c1","uid":1114284,"ip_address":"","ucode":"CCC7034351929B","user_header":"https://static001.geekbang.org/account/avatar/00/11/00/ac/614b8eb2.jpg","comment_is_top":false,"comment_ctime":1597678154,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597678154","product_id":100020801,"comment_content":"老师你好，可以理解为，redo跟oracle的redo一样，是数据库改动的记录。binlog可以优化成，oracle的archivelog，是redo的离线副本，这样就不用使用两阶段提交，多了一次写的过程，把binlog这个结构换成一个归档的进程就好了。","like_count":0},{"had_liked":false,"id":242193,"user_name":"Geek_eafbba","can_delete":false,"product_type":"c1","uid":2127209,"ip_address":"","ucode":"E2BCA005E3F39D","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKr7odjia5geesShZ76WcfbgWjaYLXUdK1R8lEibmSJcwo6OXvMonQia1MicCIUKOEbKC213It1FvOraQ/132","comment_is_top":false,"comment_ctime":1597632561,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1597632561","product_id":100020801,"comment_content":"redo log也是对文件进行操作，依旧有io开销，我理解redo log对应的存储媒介比起实际数据落入的磁盘速度应该是快很多的，从而才能达到提升速度的效果","like_count":0},{"had_liked":false,"id":242084,"user_name":"Merlin","can_delete":false,"product_type":"c1","uid":2072158,"ip_address":"","ucode":"FCC7FE00F96DCA","user_header":"https://static001.geekbang.org/account/avatar/00/1f/9e/5e/68ee6565.jpg","comment_is_top":false,"comment_ctime":1597586967,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597586967","product_id":100020801,"comment_content":"请问引擎只提供读写接口吗?对数据的操作是全部由执行器来进行的吗?","like_count":0},{"had_liked":false,"id":241521,"user_name":"Celine","can_delete":false,"product_type":"c1","uid":1926366,"ip_address":"","ucode":"63D5F2E8FB2130","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erwIgbTd3oy4GzkdCUBmz8lHGIIWBwoSIfibgQzwDlQuvTrLlqwTh7p99NBJIsu98ziaYoroQCSENwA/132","comment_is_top":false,"comment_ctime":1597321486,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597321486","product_id":100020801,"comment_content":"老师，想问一个问题，binlog写完,redolog是commit状态之后，事务是commit了吗？真正的数据是保存在内存里还是磁盘上，如果数据保存在内存里，mysql异常重启了，数据不就丢失了，跟log里边就不一样了，重启的时候会根据redolog去恢复数据吗？","like_count":0},{"had_liked":false,"id":241395,"user_name":"倔强小德普","can_delete":false,"product_type":"c1","uid":1180884,"ip_address":"","ucode":"4795B744BDDBDD","user_header":"https://static001.geekbang.org/account/avatar/00/12/04/d4/7173785e.jpg","comment_is_top":false,"comment_ctime":1597283995,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597283995","product_id":100020801,"comment_content":"引擎将这行新数据更新到内存中，同时将这个更新操作记录到 redo log 里面，此时 redo log 处于 prepare 状态。然后告知执行器执行完成了，随时可以提交事务。执行器生成这个操作的 binlog，并把 binlog 写入磁盘。执行器调用引擎的提交事务接口，引擎把刚刚写入的 redo log 改成提交（commit）状态，更新完成<br><br><br>binlog写入磁盘成功 到修改redolog到commit状态，这个期间发生crash， 也会不一致吧？<br>求解答<br><br>","like_count":0},{"had_liked":false,"id":241199,"user_name":"总有一天","can_delete":false,"product_type":"c1","uid":1240856,"ip_address":"","ucode":"730405447A6E95","user_header":"https://static001.geekbang.org/account/avatar/00/12/ef/18/5bd7b1be.jpg","comment_is_top":false,"comment_ctime":1597214101,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597214101","product_id":100020801,"comment_content":"老师我有个疑问，A1：比如在图中的更新流程写完 bin log后，打算redo log commit，此时的binlog被分库复制走了，那么这时又回滚了怎么办？A2：在写完bin log后，客户端发来回滚是怎么处理呢？图中没有解释","like_count":0},{"had_liked":false,"id":241093,"user_name":"Geek_49c56a","can_delete":false,"product_type":"c1","uid":2005292,"ip_address":"","ucode":"C787593980E6D1","user_header":"","comment_is_top":false,"comment_ctime":1597190520,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597190520","product_id":100020801,"comment_content":"老师想问下2阶段 如果redo prepare成功，binlog失败，那么redo也不会写入，没问题，如果redo prepare成功，binlog成功，redo commit的时候失败，会回滚binlog的日志吗，如果回滚的话，那么不使用2阶段提交，redo commit成功 binlog失败的时候，回滚redo是不是也可以满足","like_count":0},{"had_liked":false,"id":240921,"user_name":"Anette","can_delete":false,"product_type":"c1","uid":2035373,"ip_address":"","ucode":"C1E50164606941","user_header":"https://static001.geekbang.org/account/avatar/00/1f/0e/ad/04a5db7c.jpg","comment_is_top":false,"comment_ctime":1597117628,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597117628","product_id":100020801,"comment_content":"老师您好，有一个问题：update  tabke1 set c=10 where id =2这个语句多次执行的话，数据库（Innodb）表中记录会有多次更新吗？binlog是怎么样记录的呀？","like_count":0},{"had_liked":false,"id":240903,"user_name":"昔年","can_delete":false,"product_type":"c1","uid":2099500,"ip_address":"","ucode":"E2F20CFE0BDF06","user_header":"https://static001.geekbang.org/account/avatar/00/20/09/2c/c1fe8111.jpg","comment_is_top":false,"comment_ctime":1597113373,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597113373","product_id":100020801,"comment_content":"老师，我想请问下我们mysql数据库查询缓存是关闭的，但是我执行一条查询语句第二次总是比第一次快一点这是什么原因呢？","like_count":0},{"had_liked":false,"id":240791,"user_name":"丿醉月丨飞羽觞","can_delete":false,"product_type":"c1","uid":1807024,"ip_address":"","ucode":"01874317EC1FE1","user_header":"https://static001.geekbang.org/account/avatar/00/1b/92/b0/8b58ff2d.jpg","comment_is_top":false,"comment_ctime":1597066027,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597066027","product_id":100020801,"comment_content":"老师我想问一下，恢复数据前是需要人工看一下是采用redo log日志恢复还是binlog日志恢复吗？如果不看一下的话是不是就不知道两段提交进行到哪一步了？我在评论找半天都没有这个问题，想请老师解惑，谢谢。","like_count":0},{"had_liked":false,"id":240666,"user_name":"民","can_delete":false,"product_type":"c1","uid":1873896,"ip_address":"","ucode":"C99695CCBAFAAD","user_header":"","comment_is_top":false,"comment_ctime":1597030044,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597030044","product_id":100020801,"comment_content":"crash safe与持久化到磁盘不是一件事情？<br>1 假如不持久化，redo log ring在内存中，断电后如何做到crash safe呢？<br><br>is crash safe and persistence, not the same thing?<br>1 if no persistence to disk, redo log ring is just in memory, when to guarantee crash safe after sudden power off?","like_count":0},{"had_liked":false,"id":240473,"user_name":"duang_duang","can_delete":false,"product_type":"c1","uid":1392130,"ip_address":"","ucode":"77AE4ADD4BF3F3","user_header":"https://static001.geekbang.org/account/avatar/00/15/3e/02/45e25bab.jpg","comment_is_top":false,"comment_ctime":1596941726,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596941726","product_id":100020801,"comment_content":"老师，如果重复更新语句（update table set c=10  where id=2）连续多次提交，数据库会多次更新记录吗？","like_count":0},{"had_liked":false,"id":239918,"user_name":"Mars","can_delete":false,"product_type":"c1","uid":2064070,"ip_address":"","ucode":"BD0F7DF2E72341","user_header":"https://static001.geekbang.org/account/avatar/00/1f/7e/c6/e6898171.jpg","comment_is_top":false,"comment_ctime":1596693053,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596693053","product_id":100020801,"comment_content":"弱弱的问一句，既然redo log和binlog都可以通过设置参数的方式，确保每次事务都直接持久化到磁盘，好像单纯从这点出发，貌似看上去两种日志都具有crash-safe的能力，那为什么还需要存在两种不同的日志呢?","like_count":0},{"had_liked":false,"id":239878,"user_name":"summer","can_delete":false,"product_type":"c1","uid":1993986,"ip_address":"","ucode":"6F34505ECE6BAF","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIn0FpbcH9JA9ztMoCZ24BjypZtXCmptVJ6G7ofj3mExRzVaAc4YLgRo6Mlj1OSvbQQicQh3EA2VqQ/132","comment_is_top":false,"comment_ctime":1596682704,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596682704","product_id":100020801,"comment_content":"学习完毕的思考：<br>1：当问到InnoDB和MyISAM的区别时，经常会说到InnoDB支持事务，MSISAM不支持事务。这里InnoDB支持事务的原因个人觉得是因为InnoDB对数据进行操作时，多了Redo log的原因。<br>2：Redo log和binlog两种日志为了保持记录一致，采用了二阶段提交。这种机制在分布式场景下，和保证数据正确性有关系吗？如果有关系，有哪种关系？","like_count":0},{"had_liked":false,"id":239402,"user_name":"王豪","can_delete":false,"product_type":"c1","uid":1721488,"ip_address":"","ucode":"F54B518158C10F","user_header":"https://static001.geekbang.org/account/avatar/00/1a/44/90/7cbb4091.jpg","comment_is_top":false,"comment_ctime":1596524487,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596524487","product_id":100020801,"comment_content":"redo log 相当于黑板  当写满的时候不就存入磁盘当中，如果发生异常的时候不是可以  磁盘内容加黑板的内容就可以恢复到当前的数据。 这个他循环写不能持久化保存有什么关系，它是账本加黑板，理论上应该是可以还原的吧<br><br>用bin log的形式我可以理解：可以当做redis中的数据持久化aof把所有的操作都保存下来<br>","like_count":0},{"had_liked":false,"id":239102,"user_name":"@肘底看拳","can_delete":false,"product_type":"c1","uid":1433049,"ip_address":"","ucode":"2273BD44832EFA","user_header":"https://static001.geekbang.org/account/avatar/00/15/dd/d9/d26b996f.jpg","comment_is_top":false,"comment_ctime":1596436274,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596436274","product_id":100020801,"comment_content":"老师您好，想问一下，MySQL基本结构中的查询缓存，是只针对select语句去做缓存吗，里面里面缓存的内容只有select语句，不会有update语句是吗，还有就是这个缓存更新是什么时候，假如说执行update语句的话，连接器构建连接之后，也会去查询缓存里面匹配一遍吗？还是说直接就去分析器里面的。<br>MySQL是根据什么条件，判断是否需要去走查询缓存匹配的？","like_count":0},{"had_liked":false,"id":238464,"user_name":"沉淀","can_delete":false,"product_type":"c1","uid":1790036,"ip_address":"","ucode":"BC460D5AC78A6B","user_header":"https://static001.geekbang.org/account/avatar/00/1b/50/54/558506ee.jpg","comment_is_top":false,"comment_ctime":1596176255,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596176255","product_id":100020801,"comment_content":"会不会发生redo log也写了 binlog也写了， 结果机器停机了。<br>这个时候redolog 还是prepare 状态。<br>那接下来 这条数据的状态在机器重启后会被引擎还是 执行器重置状态呢？","like_count":0},{"had_liked":false,"id":238165,"user_name":"Geek_68d3d2","can_delete":false,"product_type":"c1","uid":1674369,"ip_address":"","ucode":"EBD6D881AA7A74","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqf54z1ZmqQY1kmJ6t1HAnrqMM3j6WKf0oDeVLhtnA2ZUKY6AX9MK6RjvcO8SiczXy3uU0IzBQ3tpw/132","comment_is_top":false,"comment_ctime":1596084061,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596084061","product_id":100020801,"comment_content":"redolog的两次状态主要是保证redolog和binlog的逻辑一致性是吧 在crash的时候还是会丢数据","like_count":0},{"had_liked":false,"id":237260,"user_name":"风","can_delete":false,"product_type":"c1","uid":1147929,"ip_address":"","ucode":"AFDBEFA49F269E","user_header":"https://static001.geekbang.org/account/avatar/00/11/84/19/7ed2ffa6.jpg","comment_is_top":false,"comment_ctime":1595758294,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1595758294","product_id":100020801,"comment_content":"老师,我看留言里面有说如果MySQL异常重启但是redo log状态为prepare binlog也记录了,那么自动提交redo log,那么如果binlog没有开启  但是redo log为prepare,那么该数据是丢弃还是commit？","like_count":0},{"had_liked":false,"id":237256,"user_name":"风","can_delete":false,"product_type":"c1","uid":1147929,"ip_address":"","ucode":"AFDBEFA49F269E","user_header":"https://static001.geekbang.org/account/avatar/00/11/84/19/7ed2ffa6.jpg","comment_is_top":false,"comment_ctime":1595757099,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1595757099","product_id":100020801,"comment_content":"请问redo log  buffer什么时候刷入到redo log file里面","like_count":0},{"had_liked":false,"id":237154,"user_name":"程序员班吉","can_delete":false,"product_type":"c1","uid":1478098,"ip_address":"","ucode":"BD48CF7649609A","user_header":"https://static001.geekbang.org/account/avatar/00/16/8d/d2/8a6be8d8.jpg","comment_is_top":false,"comment_ctime":1595692384,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595692384","product_id":100020801,"comment_content":"老师，MySQL的redo log是使用循环链表实现的吗？","like_count":0},{"had_liked":false,"id":237002,"user_name":"守望者","can_delete":false,"product_type":"c1","uid":1623487,"ip_address":"","ucode":"DEE375A5F2D57A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/sPORo6cN3GSVxjHj9nqSAPn7KG4wtSTqNUommjNndpf8qd7bHKHquuldXZfxD5nF1ldy4LeoAQNwSsOgcmWG9w/132","comment_is_top":false,"comment_ctime":1595647876,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595647876","product_id":100020801,"comment_content":"物理日志是幂等的，逻辑日志不是幂等的，可以这样理解吗？","like_count":0},{"had_liked":false,"id":236991,"user_name":"kubxy","can_delete":false,"product_type":"c1","uid":1514411,"ip_address":"","ucode":"EDA317D303CC42","user_header":"https://static001.geekbang.org/account/avatar/00/17/1b/ab/a5f88914.jpg","comment_is_top":false,"comment_ctime":1595644516,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595644516","product_id":100020801,"comment_content":"innodb在写入数据时还有一个doublewrite机制，文章中并没有提到。老师，doublewrite发生在什么时候，是将relo log从缓存刷入redo log文件之前吗？","like_count":0},{"had_liked":false,"id":236824,"user_name":"秦穆之","can_delete":false,"product_type":"c1","uid":1489177,"ip_address":"","ucode":"709C49BFCBB776","user_header":"https://static001.geekbang.org/account/avatar/00/16/b9/19/f4ef2c9a.jpg","comment_is_top":false,"comment_ctime":1595558165,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595558165","product_id":100020801,"comment_content":"读完日志相关的内容（本章，12 ，15）后，又一个疑问：redolog写入快的本质是预先分配存储，顺序写入。相对于刷脏数据页的，确实是快的多。我理解，这些“快”都是建立在机械硬盘寻道寻址的基础上。目前存储普遍换上了SSD，这些设计还会有明显的性能提升么？能否加餐讲解下在SSD和机械硬盘的区别，以及对于Mysql 的影响","like_count":0},{"had_liked":false,"id":236724,"user_name":"sibyl","can_delete":false,"product_type":"c1","uid":1323652,"ip_address":"","ucode":"0D142011860D69","user_header":"","comment_is_top":false,"comment_ctime":1595511563,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595511563","product_id":100020801,"comment_content":"老师好，为什么binlog不能做到crash-safe？ 我看了您15篇的解释，也说说我的理解，您看看对不对。<br><br>实际上binlog和redolog看起来挺像，都是追加写文件呀，总给人感觉redolog能用于crash-safe，那只要引擎能合理使用binlog，也能实现crash-safe。比如binlog如果和redolog一样先写日志后执行事务，那么InnoDB可通过binlog进行故障恢复么？<br><br>答案是否定的。只需要想想InnDb怎么根据这样的binlog进行故障恢复就理解了。要故障恢复，首先得确定要恢复哪些变更吧！但这时面对一个庞大的binlog，根本无法确定哪些binlog需要执行呀！<br><br>那RedoLog是怎么确定的呢？不用确定，ALL IN.<br><br>比如RedoLog执行前crash了，那么重启后继续执行这条RedoLog即可，即使这条RedoLog在执行后的瞬间crash了，这条RedoLog没能被及时擦掉，那么重启后再执行一遍也无妨（将同一块存储写两边是没差的）。所以重启后，所有RedoLog都会重新被执行！因为RedoLog的定位就是待执行的日志！执行后会立刻被擦除！<br><br>但是binlog呢？binlog保存的是所有的变更记录呀，重启后根本没法确定哪些日志需要执行好么！<br><br>如果binlog中加个状态，执行完后修改状态为“已完成”，好像就可以根据binlog进行故障恢复啦，但是目前不支持（老师您觉得呢？）。","like_count":0},{"had_liked":false,"id":236527,"user_name":"慧","can_delete":false,"product_type":"c1","uid":1658778,"ip_address":"","ucode":"E0FC2EF7AE33B2","user_header":"https://static001.geekbang.org/account/avatar/00/19/4f/9a/e71af464.jpg","comment_is_top":false,"comment_ctime":1595454522,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595454522","product_id":100020801,"comment_content":"对于系统不稳定时，经常需要恢复到过去某个点的数据库时，此时进行一天一备份比一周一备份，更好","like_count":0},{"had_liked":false,"id":236045,"user_name":"Geek_791ab4","can_delete":false,"product_type":"c1","uid":2070982,"ip_address":"","ucode":"FD43E5A153D8D5","user_header":"","comment_is_top":false,"comment_ctime":1595297361,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595297361","product_id":100020801,"comment_content":"老师，其实不太明白为什么bin-log不具备crash-safe的能力。都在bin-log里有留档，按理说数据库突然崩溃后，也是可以通过bin-log恢复数据的啊？","like_count":0},{"had_liked":false,"id":236023,"user_name":"Geek_791ab4","can_delete":false,"product_type":"c1","uid":2070982,"ip_address":"","ucode":"FD43E5A153D8D5","user_header":"","comment_is_top":false,"comment_ctime":1595293871,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595293871","product_id":100020801,"comment_content":"老师，文中有提到更新ID=ID+1 where ID=2的时候，会先看数据会不会在内存中，不在再去磁盘中找？？请问下，什么时候的数据会还在内存中了？在redo 里有记录，还没被刷新到磁盘中的数据么？","like_count":0},{"had_liked":false,"id":234439,"user_name":"有海🍻","can_delete":false,"product_type":"c1","uid":1483569,"ip_address":"","ucode":"5B702865770D5C","user_header":"https://static001.geekbang.org/account/avatar/00/16/a3/31/33e0a305.jpg","comment_is_top":false,"comment_ctime":1594692458,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594692458","product_id":100020801,"comment_content":"关于两阶段提交 我也有一点小问题 redo log那里写入内存失败了 就不会到binlog 所以会保证数据一致 那binlog 成功记录了做了什么变动，当他反馈了处于prepare状态的redolog时 此时发生问题 回滚 那binlog中这时候 是会做什么操作 是删除刚刚记录的变动吗？还是再做一次变动 变回去？ 如果不变 数据不就不一致了吗？","like_count":0},{"had_liked":false,"id":234295,"user_name":"hhhh","can_delete":false,"product_type":"c1","uid":1256101,"ip_address":"","ucode":"9E87017424B382","user_header":"https://static001.geekbang.org/account/avatar/00/13/2a/a5/625c0a2e.jpg","comment_is_top":false,"comment_ctime":1594634954,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594634954","product_id":100020801,"comment_content":"请问老师，redo log 推进checkpoint是通过主线程刷脏页来实现的吗？","like_count":0},{"had_liked":false,"id":234181,"user_name":"zapup","can_delete":false,"product_type":"c1","uid":1397351,"ip_address":"","ucode":"388D6BB5D7B137","user_header":"https://static001.geekbang.org/account/avatar/00/15/52/67/fcba0967.jpg","comment_is_top":false,"comment_ctime":1594612244,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594612244","product_id":100020801,"comment_content":"binlog 解决任何存储引擎层都可恢复的问题；redo log 解决 InnoDB 直接随机写磁盘慢的问题，改为顺序写。关注点不同","like_count":0},{"had_liked":false,"id":233939,"user_name":"Geek_c227aa","can_delete":false,"product_type":"c1","uid":1351531,"ip_address":"","ucode":"360CBE202D01A4","user_header":"","comment_is_top":false,"comment_ctime":1594525180,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594525180","product_id":100020801,"comment_content":"想问下老师，binlog有点理解了，存储的是类似sql操作。<br>redolog有点不太理解，存储的到底是啥，如果存储的是修改内容的话那如果面对数据是海量的那做更新的时候redolog是不是要把所有修改内容存储起来？","like_count":0},{"had_liked":false,"id":233303,"user_name":"强强","can_delete":false,"product_type":"c1","uid":2048666,"ip_address":"","ucode":"86E0C8A6B5CF55","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/bvIkMsUBo7glPEWJjpBEM7ice9nLySxsCibicZg2Uubuia27KZGXXYibPhMhIT6m1GVCIM1l1ILJnj74kwvOqqRSKjg/132","comment_is_top":false,"comment_ctime":1594283070,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594283070","product_id":100020801,"comment_content":"举个例子，MLOG_REC_UPDATE_IN_PLACE类型的REDO中记录了对Page中一个Record的修改，方法如下：<br><br>（Page ID，Record Offset，(Filed 1, Value 1) ... (Filed i, Value i) ... )<br>其中，PageID指定要操作的Page页，Record Offset记录了Record在Page内的偏移位置，后面的Field数组，记录了需要修改的Field以及修改后的Value","like_count":0},{"had_liked":false,"id":233197,"user_name":"Geek_c0624a","can_delete":false,"product_type":"c1","uid":2058789,"ip_address":"","ucode":"A0B79B4E419C54","user_header":"","comment_is_top":false,"comment_ctime":1594258384,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594258384","product_id":100020801,"comment_content":"当需要恢复到指定的某一秒时，比如某天下午两点发现中午十二点有一次误删表，需要找回数据，那你可以这么做：<br>首先，找到最近的一次全量备份，如果你运气好，可能就是昨天晚上的一个备份，从这个备份恢复到临时库；<br>然后，从备份的时间点开始，将备份的 binlog 依次取出来，重放到中午误删表之前的那个时刻。<br>这样你的临时库就跟误删之前的线上库一样了，然后你可以把表数据从临时库取出来，按需要恢复到线上库去。——》怎么做到用昨天的备份把今天12点的数据补齐？那今天的12个小时的数据还是丢失了。","like_count":0},{"had_liked":false,"id":233029,"user_name":"瑄应","can_delete":false,"product_type":"c1","uid":1524660,"ip_address":"","ucode":"7FDF6299AF2FD7","user_header":"https://static001.geekbang.org/account/avatar/00/17/43/b4/a52a7e8e.jpg","comment_is_top":false,"comment_ctime":1594197146,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594197146","product_id":100020801,"comment_content":"老师你好，在两阶段提交这里有个不懂的点，就是正确的逻辑是redo log 和 binlo一起写的吗，然后再由特定的程序去判断是否同步这样吗，希望老师能指点一下","like_count":0},{"had_liked":false,"id":232542,"user_name":"Geek_e3feaa","can_delete":false,"product_type":"c1","uid":2045550,"ip_address":"","ucode":"107F5F1FAC6D38","user_header":"","comment_is_top":false,"comment_ctime":1594031394,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594031394","product_id":100020801,"comment_content":"老师您好，想请问您的两阶段提交图里面最后的一次commit是在一个原子操作中让redo log和binlog同时处于已提交状态么，因为从图上来说如果在写完binlog后系统挂掉，那么这个时候binlog已经写完了，数据还是和redo log有不一致","like_count":0},{"had_liked":false,"id":232530,"user_name":"求一个简单的offer","can_delete":false,"product_type":"c1","uid":1797208,"ip_address":"","ucode":"C5D7AC9B501A97","user_header":"https://static001.geekbang.org/account/avatar/00/1b/6c/58/ca768509.jpg","comment_is_top":false,"comment_ctime":1594028750,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594028750","product_id":100020801,"comment_content":"undo log又是怎么样的一个存在呢？请教老师","like_count":0},{"had_liked":false,"id":232287,"user_name":"王建国","can_delete":false,"product_type":"c1","uid":1441408,"ip_address":"","ucode":"729F74BA069FBC","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ1uAplGtIQUOEdsnJpX27CCMaFr1KlfnDibNdnXnZdcFTYbgCsN7Ds8QxLCxJR0o3SMv02KRDyCcg/132","comment_is_top":false,"comment_ctime":1593945960,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593945960","product_id":100020801,"comment_content":"你好，老师，在两阶段提交这块还是有点迷惑, 说 redolog 和 binlog 两阶段提交是为了保证这个两个日志一致。但是，在redolog 进入prepare 状态后，binlog 也写入完成，在commit 的时候，断电。这个时候binlog 中已经有了这个操作记录，而redolog 中这条记录还是prepare状态。它两状态还是不一致","like_count":0},{"had_liked":false,"id":232281,"user_name":"王建国","can_delete":false,"product_type":"c1","uid":1441408,"ip_address":"","ucode":"729F74BA069FBC","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ1uAplGtIQUOEdsnJpX27CCMaFr1KlfnDibNdnXnZdcFTYbgCsN7Ds8QxLCxJR0o3SMv02KRDyCcg/132","comment_is_top":false,"comment_ctime":1593942938,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593942938","product_id":100020801,"comment_content":"你好，老师，请教一个问题<br>比如说： 我开启事 begin；这个时候会进行锁表操作，下一步，如果 我update set name = &quot;lisi&quot; from user where id = 2; 然后在commit 或者 rollback；<br>请问，如果 提交了事务，这三条语句（begin 、update set 、commit）都会写入binlog 和 redolog 吗？<br>还是 只写入 update set 语句到redolog 和 bilnog ?<br><br>如果我回滚了事务，这三个语句都会写入binlog 和 redolog 吗？还是怎么样的？ ","like_count":0},{"had_liked":false,"id":231374,"user_name":"张三","can_delete":false,"product_type":"c1","uid":1004092,"ip_address":"","ucode":"1155528FAE1546","user_header":"https://static001.geekbang.org/account/avatar/00/0f/52/3c/d6fcb93a.jpg","comment_is_top":false,"comment_ctime":1593659292,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593659292","product_id":100020801,"comment_content":"1. 设置innodb_flush_log_at_trx_commit=1，是不是就会更新磁盘的数据文件，所以这种情况下redo log只是用来保证crafh-safe的？<br>2. commit的时候才会真正更新磁盘的数据文件，这个更新是依靠redo log 还是 内存中的数据？","like_count":0},{"had_liked":false,"id":231290,"user_name":"Geek_2ac804","can_delete":false,"product_type":"c1","uid":1518795,"ip_address":"","ucode":"EDF69B20030BB8","user_header":"","comment_is_top":false,"comment_ctime":1593644393,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593644393","product_id":100020801,"comment_content":"可不可以理解为，1，redolog保证了更新速度2，保证了异常情况下可以根据redolog反悔之前的数据，只要binlog还没记录，就可以不要这份数据，这也是相比于myisam的一个优势？异常情况下，myisam由于没有redolog，只要数据落盘了，即使binlog没有记录，重启后数据也不能反悔，库和binglog数据就是不一致的，我理解的有问题吗？我的侧重点是用它跟myisam去比较，不知道myisam这边的更新逻辑怎样的","like_count":0},{"had_liked":false,"id":231234,"user_name":"John5","can_delete":false,"product_type":"c1","uid":1902889,"ip_address":"","ucode":"61188D1D626107","user_header":"https://static001.geekbang.org/account/avatar/00/1d/09/29/b170a88f.jpg","comment_is_top":false,"comment_ctime":1593612276,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593612276","product_id":100020801,"comment_content":"讲的真详细<br>","like_count":0},{"had_liked":false,"id":231222,"user_name":"Geek_2ac804","can_delete":false,"product_type":"c1","uid":1518795,"ip_address":"","ucode":"EDF69B20030BB8","user_header":"","comment_is_top":false,"comment_ctime":1593610829,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593610829","product_id":100020801,"comment_content":"我搞不懂有持久化redolog的时间，为何不直接持久化数据？","like_count":0},{"had_liked":false,"id":230972,"user_name":"酸葡萄","can_delete":false,"product_type":"c1","uid":1154146,"ip_address":"","ucode":"9D059C4FB327C0","user_header":"https://static001.geekbang.org/account/avatar/00/11/9c/62/f625b2bb.jpg","comment_is_top":false,"comment_ctime":1593536198,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593536198","product_id":100020801,"comment_content":"“具体来说，当有一条记录需要更新的时候，InnoDB 引擎就会先把记录写到 redo log（粉板）里面，并更新内存，这个时候更新就算完成了。同时，InnoDB 引擎会在适当的时候，将这个操作记录更新到磁盘里面，而这个更新往往是在系统比较空闲的时候做，这就像打烊以后掌柜做的事”<br><br>老师，您好，不是很理解，写到redo log也是持久化吧？很写磁盘有什么区别？数据不都是在磁盘上吗？","like_count":0},{"had_liked":false,"id":230775,"user_name":"崔经刚","can_delete":false,"product_type":"c1","uid":1827943,"ip_address":"","ucode":"207FDF850860C4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/P5lTnAkviacPGu5S5XJQGQdTpvkSjAVU9Nu2EYicIpMAjiaNP8aXDtfcIHicSnHw2fVIoqTWGGg48rZVzcficUlbgmw/132","comment_is_top":false,"comment_ctime":1593488244,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593488244","product_id":100020801,"comment_content":"接着@鹏飞天下的疑问     默默的问一句，啥时候数据真正的落到磁盘，进去表中？？？是commit之后吗？<br>您的回答是：“打烊的时候”和“粉板记不下”的时候这类时机。<br>请问，打烊的时候是指正常断开连接的时候吗？","like_count":0},{"had_liked":false,"id":230697,"user_name":"BD","can_delete":false,"product_type":"c1","uid":1228560,"ip_address":"","ucode":"A95CF8C3EDC228","user_header":"https://static001.geekbang.org/account/avatar/00/12/bf/10/b7974690.jpg","comment_is_top":false,"comment_ctime":1593472841,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593472841","product_id":100020801,"comment_content":"请问下老师，您上面说mysql执行一条update语句会先写redolog使其状态成parpare状态，然后再写binLog，最后commit redolog。我不理解的是如果在写完binlog之后，commit redolog之前MySQL挂了，那岂不是写完binlog而redolog的状态还没改过来吗","like_count":0},{"had_liked":false,"id":230458,"user_name":"Rick","can_delete":false,"product_type":"c1","uid":1502914,"ip_address":"","ucode":"9B41FCA5B4E526","user_header":"https://static001.geekbang.org/account/avatar/00/16/ee/c2/873cc8d9.jpg","comment_is_top":false,"comment_ctime":1593393550,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593393550","product_id":100020801,"comment_content":"老师，请教一个问题：我理解两阶段提交是innodb特有的，但是这个两阶段提交又需要依赖于server层的协助。那么其它存储引擎的执行过程也是走两阶段提交的过程吗？还是server层根据当前的存储引擎来决定是否走两阶段提交？如果是后者的话，那么相当于下层使用什么引擎对server层不是透明的？","like_count":0},{"had_liked":false,"id":228345,"user_name":"双子孤狼","can_delete":false,"product_type":"c1","uid":1658543,"ip_address":"","ucode":"AC5FFC3049AABF","user_header":"","comment_is_top":false,"comment_ctime":1592646028,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592646028","product_id":100020801,"comment_content":"关于WAL这个问题我有个疑问，写redo log这个操作和写内存的操作是否是原子操作？还有我记得就是更新语句中如果没有涉及到一些唯一约束之类的，就是直接更新内存就好了，这里是否也需要同步写redo log？","like_count":0},{"had_liked":false,"id":228302,"user_name":"陈狄","can_delete":false,"product_type":"c1","uid":2011954,"ip_address":"","ucode":"456F00EB2EB43D","user_header":"https://static001.geekbang.org/account/avatar/00/1e/b3/32/0ee78a1a.jpg","comment_is_top":false,"comment_ctime":1592638214,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592638214","product_id":100020801,"comment_content":"1、系统崩溃导致写入redo log但是没写入binlog，重启后因为redolog处于prepare阶段，两个日志文件不一致，就回滚。<br>2、写入redo log同时也写入binlog，然后系统崩溃，重启后因为两个日志文件一致，就commit。<br>一个问题，把什么改成prepare和commit的，是日志的某一行的某一个状态变量吗？","like_count":0},{"had_liked":false,"id":228268,"user_name":"静静聆听","can_delete":false,"product_type":"c1","uid":1263932,"ip_address":"","ucode":"0A8600CB928EFE","user_header":"https://static001.geekbang.org/account/avatar/00/13/49/3c/5d54c510.jpg","comment_is_top":false,"comment_ctime":1592628537,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592628537","product_id":100020801,"comment_content":"老师有个问题，如果redoLog prepare+binLog完整的情况会恢复数据，如果没有binlog只有redoLog，应该是在redoLog prepare的时候不会恢复此条数据，我的理解对么？","like_count":0},{"had_liked":false,"id":227499,"user_name":"红豆成香","can_delete":false,"product_type":"c1","uid":1488601,"ip_address":"","ucode":"FB8FBB639B4BA6","user_header":"https://static001.geekbang.org/account/avatar/00/16/b6/d9/4d8a4d4c.jpg","comment_is_top":false,"comment_ctime":1592392820,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592392820","product_id":100020801,"comment_content":"老师您好，有个问题想不明白，binlog既然能恢复半个月以内任意一秒的数据，为什么没有 crash-save能力，可以同样重全量备份中恢复到crash的时候","like_count":0},{"had_liked":false,"id":227492,"user_name":"Geek_66a431","can_delete":false,"product_type":"c1","uid":1484706,"ip_address":"","ucode":"D8941CA3BE8457","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/gIE15oOl1IicE8hicpPzuoARricgaL3y4nHDXaFCPX0U3UX3szgtrKCa4zCPc5GkdpceP0mftbJg3MdKHOLJOKJww/132","comment_is_top":false,"comment_ctime":1592391956,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592391956","product_id":100020801,"comment_content":"两阶段提交有疑问，如果binlog和redolog更新都成功了 但是接下来改变binlog状态的时候mysql挂掉了，会怎么样，不还是会有问题，问题根本没解决呀只不过转移了","like_count":0},{"had_liked":false,"id":227485,"user_name":"Geek_66a431","can_delete":false,"product_type":"c1","uid":1484706,"ip_address":"","ucode":"D8941CA3BE8457","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/gIE15oOl1IicE8hicpPzuoARricgaL3y4nHDXaFCPX0U3UX3szgtrKCa4zCPc5GkdpceP0mftbJg3MdKHOLJOKJww/132","comment_is_top":false,"comment_ctime":1592390102,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592390102","product_id":100020801,"comment_content":"“当有一条记录需要更新的时候，InnoDB 引擎就会先把记录写到 redo log（粉板）里面，并更新内存”<br>所以 粉板是磁盘上的咯？ 这不就成了每次都要写磁盘了么，可是之前说的不是不要每次都写磁盘么","like_count":0},{"had_liked":false,"id":227451,"user_name":"Judy","can_delete":false,"product_type":"c1","uid":1125103,"ip_address":"","ucode":"AF48B83F0C8CB6","user_header":"https://static001.geekbang.org/account/avatar/00/11/2a/ef/592cb371.jpg","comment_is_top":false,"comment_ctime":1592382567,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592382567","product_id":100020801,"comment_content":"从更新一条sql引出 redo log 日志<br>1 为什么会有redo log 日志<br>2 redo log 日志的作用是什么<br>3 rodo log 日志作用在存储引擎<br>4 mysql server层也有一个日志binlog日志<br>5 为什么会有binlog 日志<br>6 他们两个如何一起工作，来保证数据的一致性，两阶段提交<br>7 redolog和binlog的区别是什么","like_count":0},{"had_liked":false,"id":226542,"user_name":"喵呵呵","can_delete":false,"product_type":"c1","uid":2037143,"ip_address":"","ucode":"77BE7EED22B70E","user_header":"https://static001.geekbang.org/account/avatar/00/1f/15/97/7e8da615.jpg","comment_is_top":false,"comment_ctime":1592134985,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592134985","product_id":100020801,"comment_content":"我的理解：redo log的操作流程，我的理解，第一次写时，write pos在0文件的开头，checkpoint再3文件的末尾，write pos和 checkpoint 之间的部分，可以用来记录新的操作。write pos一边写一边后移，写道3文件的末尾时，追上了checkpoint，将4个文件写满，然后checkpoint后移，将write pos与checkpoint 之间的操作提交并擦除，这样write pos与checkpoint 之间又可以记录新的操作，如此循环往复的操作实现循环记录。请问老师我的理解正确吗？","like_count":0},{"had_liked":false,"id":226441,"user_name":"陈国林","can_delete":false,"product_type":"c1","uid":1438037,"ip_address":"","ucode":"83D12F3E79F197","user_header":"https://static001.geekbang.org/account/avatar/00/15/f1/55/8ac4f169.jpg","comment_is_top":false,"comment_ctime":1592103743,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592103743","product_id":100020801,"comment_content":"1. 在什么场景下，一天一备会比一周一备更有优势呢?<br>   答: 数据变化很频繁的场景下，一天一备保证数据能够及时的落盘做备份，数据可用性上比一周一备好<br>2. 它影响了这个数据库系统的哪个指标？<br>   答: 备份会影响数据库的吞吐能力，全量备份场景下会消耗比较大的磁盘IO，这个时候会影响正常的数据库的读写请求<br><br>","like_count":0},{"had_liked":false,"id":226421,"user_name":"Geek__风雨","can_delete":false,"product_type":"c1","uid":1447977,"ip_address":"","ucode":"A2CA9983A1EAA0","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM70nnPpGc2c9vic68lB3ndZxlWLwXakhpkq8ZzZSPRusynorCafpoAYxkicOYhRic9GTEqWjhagDLp6w/132","comment_is_top":false,"comment_ctime":1592095483,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592095483","product_id":100020801,"comment_content":"redo log用于平衡cpu和读写磁盘IO的，提高数据库处理性能，是Innode 独有；binlog是server层的逻辑日志（追加写入），可用于数据库恢复，全量备份+binlog","like_count":0},{"had_liked":false,"id":226386,"user_name":"creasylai19","can_delete":false,"product_type":"c1","uid":1128420,"ip_address":"","ucode":"F9B04060FCFD3F","user_header":"https://static001.geekbang.org/account/avatar/00/11/37/e4/5d7a32c6.jpg","comment_is_top":false,"comment_ctime":1592058199,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1592058199","product_id":100020801,"comment_content":"老师，两阶段提交，如果redo_log第一阶段prepared成功了，这时候数据库宕机了，binlog未记录，mysql重启后是怎么处理呢？另外，只记录redo_log，mysql怎么知道最终刷盘的时候是否能更新成功啊？（可能where语句过滤后根本没符合的数据呢）","like_count":0},{"had_liked":false,"id":226381,"user_name":"naadp","can_delete":false,"product_type":"c1","uid":2036468,"ip_address":"","ucode":"2C853E7E89EC00","user_header":"https://static001.geekbang.org/account/avatar/00/1f/12/f4/c5cc59f0.jpg","comment_is_top":false,"comment_ctime":1592056975,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592056975","product_id":100020801,"comment_content":"老师您好！我有个问题：您画的最后一幅图，如果bin log写成功了，但是在最后提交的时候停电了，那是不是意味着 bin log 有数据，但是 redo log 里面还处于预提交状态啊？那么来电后那一行数据会根据处于预提交状态的 redo log 来恢复吗？","like_count":0},{"had_liked":false,"id":226297,"user_name":"白开水","can_delete":false,"product_type":"c1","uid":1955459,"ip_address":"","ucode":"2E05353E8D9317","user_header":"https://static001.geekbang.org/account/avatar/00/1d/d6/83/bd4a8410.jpg","comment_is_top":false,"comment_ctime":1592027937,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1592027937","product_id":100020801,"comment_content":"数据库更新比较快的库，影响的是binlog； 数据库更新很慢的库，多长时间进行备份，写的binlog相差不多好恢复","like_count":0},{"had_liked":false,"id":226133,"user_name":"在路上","can_delete":false,"product_type":"c1","uid":1712454,"ip_address":"","ucode":"2FAB73D1D2469C","user_header":"https://static001.geekbang.org/account/avatar/00/1a/21/46/67433ab9.jpg","comment_is_top":false,"comment_ctime":1591958024,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591958024","product_id":100020801,"comment_content":"说下为什么需要redolog和binlog两者进行恢复。首先redolog产生在InnoDB引擎层，binlog产生在MySQL.的服务层，两者相对独立又有包含关系，MySQL不仅仅只能用innoDb，还可以用其他引擎。两阶段提交机制能确保引擎层的log和服务层的log一致，在数据恢复时相互应证。<br><br>还有一点，当MySQL换用其他引擎或者该innodb不工作于当前数据库，是否可以根据binlog或者redolog进行数据恢复","like_count":0},{"had_liked":false,"id":225996,"user_name":"virtualman","can_delete":false,"product_type":"c1","uid":1385732,"ip_address":"","ucode":"7265C9FCA481F1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epMS4ia73EIO41WWLan6DFormxuUSKOgyaQIsJwZ3VhMfFLtjG13Qp0GSIGHyFg33fSFXcBHHRibUzg/132","comment_is_top":false,"comment_ctime":1591925722,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591925722","product_id":100020801,"comment_content":"Redo log不是记录数据页“更新之后的状态”，而是记录这个页 “做了什么改动”。<br>这种方式不会有问题么？比如说日志已经记录下来了，但是在恢复的时候，你并不能确定当前在磁盘上存储的数据是更改前的还是更改后的，因为数据是先写到缓冲区的，而发生故障的时候是否从缓冲区已经写到硬盘上，这是不确定的。因此恢复的时候从硬盘上取的数据有可能是更改之后的，而利用这个数据再去执行一遍这个更改的操作逻辑的话，是不是就有可能把已经存储下来的正确数据改成错误的数据了呢？","like_count":0},{"had_liked":false,"id":225787,"user_name":"公共号","can_delete":false,"product_type":"c1","uid":1318914,"ip_address":"","ucode":"4759B517D4CD5E","user_header":"https://static001.geekbang.org/account/avatar/00/14/20/02/df2bfda9.jpg","comment_is_top":false,"comment_ctime":1591857695,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591857695","product_id":100020801,"comment_content":"两阶段提交，如果redo log commit失败会怎样啊","like_count":0},{"had_liked":false,"id":225663,"user_name":"一方通行","can_delete":false,"product_type":"c1","uid":1709955,"ip_address":"","ucode":"F85546122F9781","user_header":"https://static001.geekbang.org/account/avatar/00/1a/17/83/e4141c61.jpg","comment_is_top":false,"comment_ctime":1591807982,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591807982","product_id":100020801,"comment_content":"当数据量超级大时候，那么一天一备自然重要了，对redolog影响大，需要进行对应账本的。那么需要时间了","like_count":0},{"had_liked":false,"id":225648,"user_name":"Geek_60ec41","can_delete":false,"product_type":"c1","uid":1860207,"ip_address":"","ucode":"091BD54E066F64","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epeznkSJs1WxRyS0qiaOibOAqkWdgZzfMLI9wu0t56tC4GTfEkwj3RrzJkujqVH1LfAu25DN5764zTA/132","comment_is_top":false,"comment_ctime":1591804377,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591804377","product_id":100020801,"comment_content":"假如在两阶段提交中，redo log prepare成功，binlog写成功，但是redolog commit失败，会怎么处理呢？","like_count":0},{"had_liked":false,"id":225471,"user_name":"傻傻的帅","can_delete":false,"product_type":"c1","uid":1668617,"ip_address":"","ucode":"14A795523A682E","user_header":"https://static001.geekbang.org/account/avatar/00/19/76/09/62a10668.jpg","comment_is_top":false,"comment_ctime":1591761015,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591761015","product_id":100020801,"comment_content":"林老师，我在重刷课程的时候，在整理流程的时候，有几个问题不解，请你指导下：<br><br>更新语句执行过程(update t set cnt=cnt+1 where id=2;)：<br><br>1. 通过mysql客户端连接命令mysql(mysql -uroot -proot123)连接mysql服务器<br>2. 连接器在接到客户端连接后，读取mysql.user表中的相关信息，判断连接的用户名和密码是否是确，如果正确则将权限信息进行缓存，以便后面使用；否则，报错退出<br>3. 分析器解析(词法、语法)语句，得知是一条更新语句，如果是8.0以下版本，并且查询缓存(query_cache_type)参数开启，此时会清空对该表的查询缓存记录<br>4. 优化器生成相应的执行计划，此时会选择走主键索引(数据量大的情况)<br>5. 执行器根据执行计划，调用存储引擎相应接口(比如:find_data_by_index)<br>6. 存储引擎层，首先会去Innodb_buffer_pool里的data_dictionary(元数据信字典)得到表的相关信息；通过元数据信息，去lock_inof里查出是否会有相关的锁信息，并把这条update语句需要的锁信息写入到lock  info里<br>7. 存储引擎层查询主键索引树定位到id=2的这条记录，如果该记录所在页已经在内存中，则直接返回；否则，需要从磁盘中读取该记录所在页到内存中，然后再返回该记录<br>8. 执行器拿到该记录后，执行更新操作(cnt=cnt+1)，然后再调用存储引擎层的数据更新接口，更新该行记录<br>9. 存储引擎层，首先会把该记录的相关旧值信息记录到undo page，同时会复制到redo log buffer中，然后在内存中更新该记录的值 (cnt=cnt+1)，并把操作的物理数据页修改记录到redo log buffer里，并将此记录标记为prepare状态，并返回更新成功<br>10. 执行器收到存储引擎层更新成功的信息后，开始生成binlog日志(会按照event的格式，记录到binlog_cache)<br>11. 客户端执行commit，提交本次事务<br>12. 执行器将binlog_cache中的记录刷新到磁盘，同时调用存储引擎层的事务提交接口<br>13. 如果此时redo log日志还在缓存中，则将标志修改为commit状态，同时将记录刷新redo log日志文件中；如果此时cache中的记录已经刷新到redo log日志文件中，则只需将标志修改为commit状态即可<br>14. 本次事务结束 <br><br>问题：<br> 1、在第9步的时候， undo page是先写内存，还是直接写到undo 磁盘上的表空间中的<br> 2、生成的undo page会不会写到redo log日志文件中，在crash恢复的时候可以回滚未提交的事务<br><br>这里列出的流程还请老师看下有没有理解错，另外比如在更新过程中的刷脏页机制，change buffer这些都没有列出来","like_count":0},{"had_liked":false,"id":225268,"user_name":"Geek_d38f30","can_delete":false,"product_type":"c1","uid":1512147,"ip_address":"","ucode":"955D6480731336","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ib1aca6ibMC3bcTZeVdTFalyyhdvy4DLQ7s4WBTWaw95k8IJNTUkZ5VwfB9rYwxVz3PAz4chBJhWcyMHib9KdEEnQ/132","comment_is_top":false,"comment_ctime":1591700549,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591700549","product_id":100020801,"comment_content":"日志文件越大，回滚速度越慢。想业务快速回复，备份间隔越小越好。跑的日志越小","like_count":0},{"had_liked":false,"id":225197,"user_name":"flyailove","can_delete":false,"product_type":"c1","uid":1755631,"ip_address":"","ucode":"3FD96988AB626A","user_header":"https://static001.geekbang.org/account/avatar/00/1a/c9/ef/56ccc350.jpg","comment_is_top":false,"comment_ctime":1591681940,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591681940","product_id":100020801,"comment_content":"影响的是redo log吧，当全量备份的时候，会把redo log中的变更全部写到磁盘中去，然后就会对应的redo log部分清空了，释放更多的空间吧，请老师指正","like_count":0},{"had_liked":false,"id":225078,"user_name":"Super worm","can_delete":false,"product_type":"c1","uid":1739530,"ip_address":"","ucode":"2E14EEBD96D6D4","user_header":"","comment_is_top":false,"comment_ctime":1591630375,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1591630375","product_id":100020801,"comment_content":"老师我想问一下 如果在binlog写成功后 redolog commit之前发生crash 重启后会发生什么呢？","like_count":0},{"had_liked":false,"id":224868,"user_name":"Jetty","can_delete":false,"product_type":"c1","uid":1099407,"ip_address":"","ucode":"2128B46B68E741","user_header":"https://static001.geekbang.org/account/avatar/00/10/c6/8f/633764b4.jpg","comment_is_top":false,"comment_ctime":1591579774,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591579774","product_id":100020801,"comment_content":"1.commit指令写入 理论上也可能存在crash时一个日志成功另一个日志未写入的情况，这个时候恢复以先写入的commot指令为准吗？<br>2 更新是否能够执行成功还要看where条件能否全部满足，这个时候会依赖数据行在内存中的状态么？","like_count":0},{"had_liked":false,"id":224136,"user_name":"别人家的孩子","can_delete":false,"product_type":"c1","uid":1108823,"ip_address":"","ucode":"B0CC95888DE8C0","user_header":"https://static001.geekbang.org/account/avatar/00/10/eb/57/12d5f9fa.jpg","comment_is_top":false,"comment_ctime":1591283775,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591283775","product_id":100020801,"comment_content":"请教一个问题，执行update数据的时候写redolog，这个redolog也是磁盘上的文件，和直接操作磁盘上的数据是一样，为什么要多此一举呢？","like_count":0},{"had_liked":false,"id":223784,"user_name":"Danfēng","can_delete":false,"product_type":"c1","uid":1237583,"ip_address":"","ucode":"E5B3451F1D0441","user_header":"https://static001.geekbang.org/account/avatar/00/12/e2/4f/df01f65e.jpg","comment_is_top":false,"comment_ctime":1591179668,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591179668","product_id":100020801,"comment_content":"思考了一下哪个WAL技术，因为是先写到内存，不忙再写到磁盘。那么计算机最重要一个特性，就是内存断电不保存数据。那么刚好当redoLog还在&quot;粉板&quot;没到&quot;账本&quot;的时候，这个服务器断电GG了，那么此时，不就这部分数据恢复不回来了？","like_count":0},{"had_liked":false,"id":223691,"user_name":"小明","can_delete":false,"product_type":"c1","uid":2009185,"ip_address":"","ucode":"9FF1FE05BCFA3E","user_header":"https://static001.geekbang.org/account/avatar/00/1e/a8/61/0be5b5fe.jpg","comment_is_top":false,"comment_ctime":1591157275,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591157275","product_id":100020801,"comment_content":"林老师，我问下记重做日志是先记内存里，然后在某个时间点把多条重做日志刷到磁盘上的吗？","like_count":0},{"had_liked":false,"id":222842,"user_name":"残月@诗雨","can_delete":false,"product_type":"c1","uid":1111415,"ip_address":"","ucode":"38DA6C1BC808D5","user_header":"https://static001.geekbang.org/account/avatar/00/10/f5/77/7e852c51.jpg","comment_is_top":false,"comment_ctime":1590925916,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590925916","product_id":100020801,"comment_content":"执行update流程的第四步  4. 执行器生成这个操作的 binlog，并把 binlog 写入磁盘。这步应该是写入binlog buffer内存buffer吧，第5步事务提交之后，才会写入到磁盘（不一定fsync，有可能是page cache）","like_count":0},{"had_liked":false,"id":222367,"user_name":"王加武","can_delete":false,"product_type":"c1","uid":1665471,"ip_address":"","ucode":"DDCFE578C6C428","user_header":"https://static001.geekbang.org/account/avatar/00/19/69/bf/50a824a4.jpg","comment_is_top":false,"comment_ctime":1590761833,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590761833","product_id":100020801,"comment_content":"无论从安全性还是效率方面来考虑，都应该是一天备份一次，这样的话即使数据出现丢失了，我们也只需要从当天备份的数据里面找，快速高效","like_count":0},{"had_liked":false,"id":221974,"user_name":"Iqexception","can_delete":false,"product_type":"c1","uid":1109901,"ip_address":"","ucode":"597A335EAC50A1","user_header":"https://static001.geekbang.org/account/avatar/00/10/ef/8d/5c0d2e9c.jpg","comment_is_top":false,"comment_ctime":1590646745,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1590646745","product_id":100020801,"comment_content":"那个关于两阶段提交的解释一直没懂，我以为第一种“先写 redo log 后写 binlog”指的是现状，现在才明白是假设没有两阶段提交的情况，不知道有没有和我一样理解的。。","like_count":0},{"had_liked":false,"id":221873,"user_name":"专注无畏","can_delete":false,"product_type":"c1","uid":1687713,"ip_address":"","ucode":"A4F79126E99D51","user_header":"https://static001.geekbang.org/account/avatar/00/19/c0/a1/ee64ecad.jpg","comment_is_top":false,"comment_ctime":1590626601,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590626601","product_id":100020801,"comment_content":"您好老师，我心中有一疑惑。比如说MySQL写完redo log 处于 prepare状态，然后写binlog，写完binlog ， redo log该变成commit状态。按道理机器是随时都可能crash的，那如果写完binlog，还未将redo log改为 commit状态，这样MySQL恢复时将如何看待这个记录呢？","like_count":0},{"had_liked":false,"id":221376,"user_name":"木子00","can_delete":false,"product_type":"c1","uid":1314724,"ip_address":"","ucode":"8F78CA722EB29B","user_header":"https://static001.geekbang.org/account/avatar/00/14/0f/a4/0b49469f.jpg","comment_is_top":false,"comment_ctime":1590485006,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1590485006","product_id":100020801,"comment_content":"1. redo log 和 binlog 都可以持久化,那么binlog为什么不能crash-safe呢?<br>2. redo log 是物理日志,我理解的物理日志不就是以文件的形式存储的,binlog不也是可以,以文件的形式存储,那为什么binlog不是物理日志呢? 这个一直想不通.","like_count":0},{"had_liked":false,"id":221137,"user_name":"暮雨","can_delete":false,"product_type":"c1","uid":1176426,"ip_address":"","ucode":"4B7F4932446EF7","user_header":"https://static001.geekbang.org/account/avatar/00/11/f3/6a/6d82e7a3.jpg","comment_is_top":false,"comment_ctime":1590415101,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590415101","product_id":100020801,"comment_content":"每次redolog是waf机制，那么刚写入的数据，应该不会被直接写入到磁盘中，再次查询，数据是从redolog中获取的么","like_count":0},{"had_liked":false,"id":220842,"user_name":"初级码农007","can_delete":false,"product_type":"c1","uid":1067588,"ip_address":"","ucode":"2FE76DB747DB22","user_header":"https://static001.geekbang.org/account/avatar/00/10/4a/44/097daa02.jpg","comment_is_top":false,"comment_ctime":1590328952,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590328952","product_id":100020801,"comment_content":"老师，您好，我看完了整个课程，感觉还缺少了对undo log、事务回滚操作的讲解，如果是我看漏了麻烦指正在哪个章节，谢谢老师。","like_count":0},{"had_liked":false,"id":219924,"user_name":"邵振","can_delete":false,"product_type":"c1","uid":1250695,"ip_address":"","ucode":"63C1BAD3A809C4","user_header":"https://static001.geekbang.org/account/avatar/00/13/15/87/3dd57e11.jpg","comment_is_top":false,"comment_ctime":1590119146,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590119146","product_id":100020801,"comment_content":"如果数据更新频率较高，增量数据比较大，那么一天一备份要比一周更好，避免产生量很大而又不能remove的binlog数据","like_count":0},{"had_liked":false,"id":219651,"user_name":"slim shady","can_delete":false,"product_type":"c1","uid":1577357,"ip_address":"","ucode":"DB0D7A6AC3840B","user_header":"https://static001.geekbang.org/account/avatar/00/18/11/8d/ac0df87e.jpg","comment_is_top":false,"comment_ctime":1590056033,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590056033","product_id":100020801,"comment_content":"1，innodb怎么保证redo log在写满后打算擦掉的一部分数据和将内存中刷脏页到磁盘上的页的数据是一致的；如果update语句更新name=&#39;a&#39;,那么redo记录那一页做了更新为‘a’的操作，内存记录的页为name=&#39;a&#39;,之后有更新name=&#39;b&#39;,redo记录，内存修改name为b。恰巧这个时候redo log满了，需要擦掉name=&#39;a&#39;的日志，按照描述是需要将内存脏页刷新到磁盘中，那么磁盘中name=&#39;b&#39;;然而redo log却还有记录着name=&#39;b&#39;的日志。这样后面宕机利用redo crash-safe的时候，redo上name=&#39;b&#39;就成了无效操作 <br>2，内存满了刷新脏页到磁盘，是否需要同步擦掉redo log中相关脏页的数据，如果不清除redo log里面记录脏页偏移量的数据，等到redo log满了去擦掉的时候会出现找不到内存中的脏页记录；<br>redo log，内存刷脏之间到底存在着一个怎样的联系，希望可以得到回复，谢谢了!","like_count":0},{"had_liked":false,"id":219089,"user_name":"小样","can_delete":false,"product_type":"c1","uid":1047127,"ip_address":"","ucode":"0D670431F19A14","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/bOhve1DBV2oShl2JrXDib4J1T7LciagcB8jogD5c7pvt8Zv7Bq23Zfnl70cf2R81r8ia947Hbib9FZia56sdx9wcEibA/132","comment_is_top":false,"comment_ctime":1589942176,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589942176","product_id":100020801,"comment_content":"redo log是prepare状态，binlog已经写入了磁盘，这个时候crash的话，redo log没有commit，会有影响吗？还是说重启之后会提交","like_count":0},{"had_liked":false,"id":219062,"user_name":"老鹰","can_delete":false,"product_type":"c1","uid":1527015,"ip_address":"","ucode":"496EEDC7E5A18F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIBicEibaY3wha72OahG85Y08XoILfmGYnHalxzc0RtFu6icB1eibRpOciasutRaP7W4HYsmQqTtib0H85A/132","comment_is_top":false,"comment_ctime":1589938539,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589938539","product_id":100020801,"comment_content":"请问老师用的什么绘图软件","like_count":0},{"had_liked":false,"id":218133,"user_name":"akun","can_delete":false,"product_type":"c1","uid":1233246,"ip_address":"","ucode":"1DA2CD0D4629FA","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/uRTmqtfGM0b9lfClXSObI48qp3SHna7zRTRBG3HsPjHjSpMVeEoELzsHBquic3h4TdRgeEISqc91TZIFpiaxtCbA/132","comment_is_top":false,"comment_ctime":1589720533,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589720533","product_id":100020801,"comment_content":"redo log满了在往数据文件写时，发生crash，那是不是会有一定的数据丢失？<br>我们既然说数据不是及时写到数据文件里，而是先写到redo log里。那我修改提交，怎么能被别的查询查到","like_count":0},{"had_liked":false,"id":217697,"user_name":"黑客悟理","can_delete":false,"product_type":"c1","uid":1087847,"ip_address":"","ucode":"FEAA623FAD4486","user_header":"https://static001.geekbang.org/account/avatar/00/10/99/67/9d3f3ceb.jpg","comment_is_top":false,"comment_ctime":1589592016,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589592016","product_id":100020801,"comment_content":"老师，我不明白一个问题，既然都是写log，为什么binlog不能做到crash safe呢？ 如果异常重启，从binlog里面不也可以恢复数据吗？","like_count":0},{"had_liked":false,"id":217400,"user_name":"怕什么，抱紧我","can_delete":false,"product_type":"c1","uid":1318633,"ip_address":"","ucode":"CBCEA76E9EF33B","user_header":"https://static001.geekbang.org/account/avatar/00/14/1e/e9/dcc63d8f.jpg","comment_is_top":false,"comment_ctime":1589483444,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1589483444","product_id":100020801,"comment_content":"有个疑问:redolog日志可以恢复数据吧?","like_count":0},{"had_liked":false,"id":217178,"user_name":"David.cui","can_delete":false,"product_type":"c1","uid":1302228,"ip_address":"","ucode":"AB46F310403612","user_header":"https://static001.geekbang.org/account/avatar/00/13/de/d4/b83c4185.jpg","comment_is_top":false,"comment_ctime":1589433121,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589433121","product_id":100020801,"comment_content":"有没有觉得redo log其实更像其他数据库的redo，而binlog更像其他数据库的cdc或logminer","like_count":0},{"had_liked":false,"id":215332,"user_name":"归零","can_delete":false,"product_type":"c1","uid":1103208,"ip_address":"","ucode":"C99B8E93009A46","user_header":"https://static001.geekbang.org/account/avatar/00/10/d5/68/2201b6b9.jpg","comment_is_top":false,"comment_ctime":1588954488,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1588954488","product_id":100020801,"comment_content":"有一点没有明白，redolog具有crash-safe的能力，为什么binlog不具备呢？恢复到某一个时间点可以使用binlog，感觉也可以用在异常启动后的数据恢复，同样都是在磁盘里面的记录。","like_count":0},{"had_liked":false,"id":214028,"user_name":"冰封无名","can_delete":false,"product_type":"c1","uid":1081310,"ip_address":"","ucode":"EB212C047FD415","user_header":"https://static001.geekbang.org/account/avatar/00/10/7f/de/7d17e15b.jpg","comment_is_top":false,"comment_ctime":1588638698,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1588638698","product_id":100020801,"comment_content":"最后两步虽然是不同的模块来完成的，但这两步是不是该是原子的？","like_count":0},{"had_liked":false,"id":213723,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1588520546,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588520546","product_id":100020801,"comment_content":"总结：<br>（1） RedoLog和BinLog的异同点<br>● RedoLog是InnoDB特有，Binlog是Mysql的Server层实现的，所有引擎都可以使用。<br>● RedoLog是物理日志，记录“在某个数据页上做了什么修改”，BinLog是逻辑日志，记录的是这个操作的原始逻辑。<br>● RedoLog是循环写的，空间固定会用完；binLog是可以追加写入的。binlog写到一定大小后会切换到另一个，不会覆盖之前的。<br><br>（2） RedoLog的Crash-safe能力<br>有了 redo log，InnoDB 就可以保证即使数据库发生异常重启，之前提交的记录都不会丢失，这个能力称为 crash-safe。RedoLog其实是Mysql中的WAL技术，Write-Ahead Logging，它的关键点就是先写redoLog日志，等空闲时再写入磁盘！<br>具体来说，当有一条记录需要更新的时候，InnoDB 引擎就会先把记录写到 redo log（粉板）里面，并更新内存，这个时候更新就算完成了。同时，InnoDB 引擎会在适当的时候，将这个操作记录更新到磁盘（账本）里面，而这个更新往往是在系统比较空闲的时候做！<br><br>（3）RedoLog和binLog为什么需要两阶段提交？<br>反证法：<br>● RedoLog提交，binLog未提交，此时故障恢复后，若Binlog重放少一条。<br>● Binlog提交，RedoLog未提交，才是故障恢复后，若BinLog重放多一条。<br><br>","like_count":0},{"had_liked":false,"id":213644,"user_name":"…","can_delete":false,"product_type":"c1","uid":1297845,"ip_address":"","ucode":"207C7F95192129","user_header":"https://static001.geekbang.org/account/avatar/00/13/cd/b5/2e60f2b0.jpg","comment_is_top":false,"comment_ctime":1588498566,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588498566","product_id":100020801,"comment_content":"如果redo log每次提交都刷入磁盘的话，是不是就相当于每次把粉板上的账都记在账本上吗？<br>这样的话是不是和直接往磁盘写数据就没区别了？效率会很低吧","like_count":0},{"had_liked":false,"id":212954,"user_name":"test","can_delete":false,"product_type":"c1","uid":1129610,"ip_address":"","ucode":"C57A175CBC6547","user_header":"https://static001.geekbang.org/account/avatar/00/11/3c/8a/900ca88a.jpg","comment_is_top":false,"comment_ctime":1588246504,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588246504","product_id":100020801,"comment_content":"就是一个说，一个做，做的做完了要汇报给说的，如果没汇报，说的当自己没说过，做的也当自己没做过。","like_count":0},{"had_liked":false,"id":212348,"user_name":"简单猫","can_delete":false,"product_type":"c1","uid":1866485,"ip_address":"","ucode":"EA027D4C344E25","user_header":"https://static001.geekbang.org/account/avatar/00/1c/7a/f5/54a5084b.jpg","comment_is_top":false,"comment_ctime":1588088151,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588088151","product_id":100020801,"comment_content":"老师已经说的很清楚了redo log,相当于要做的事情 但没有做，临时记在一个文件上，并且这个本子记录用的是铅笔芯，当写满了redo log预先设置的本子(容量大小已经确认)，就要把记录提交，并擦掉记录(我在想具体一次性提交多少 这个性能如何优化)。 bin log就是流水账会记录所有的操作记录，只要用当前仓库的状态，反向一条一条的从bin log读取执行操作日志，仓库状态就能回复到bin log上的任意时间段。要注意的是该时间段 可能有部分记录还在redo log本上没提交(货物已经出入库)，所以要把redo log也commit到 归档点的数据库上 从而完全恢复","like_count":0},{"had_liked":false,"id":212103,"user_name":"无名之辈","can_delete":false,"product_type":"c1","uid":1108247,"ip_address":"","ucode":"23AB28F44A769C","user_header":"https://static001.geekbang.org/account/avatar/00/10/e9/17/c78d3963.jpg","comment_is_top":false,"comment_ctime":1588061245,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1588061245","product_id":100020801,"comment_content":"总结一下：<br>1.sql更新的执行流程<br>2.redolog和 binlog是什么以及区别？<br>3.redolog两阶段提交<br>4.redolog和 binlog持久化参数设置","like_count":0},{"had_liked":false,"id":211128,"user_name":"kirito2924","can_delete":false,"product_type":"c1","uid":1314646,"ip_address":"","ucode":"54C0A2DF8F4505","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJYyD1fflqCZRicNz7uurTIyOIMT2HDcaj9rKlsV2uvUX38IxuibBIfjdaLOQvyicq4cFzDHDLNPicdgg/132","comment_is_top":false,"comment_ctime":1587898710,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587898710","product_id":100020801,"comment_content":"孔乙己秀到我了","like_count":0},{"had_liked":false,"id":210892,"user_name":"Howe","can_delete":false,"product_type":"c1","uid":1054300,"ip_address":"","ucode":"E2E93375FF5A07","user_header":"https://static001.geekbang.org/account/avatar/00/10/16/5c/c0322969.jpg","comment_is_top":false,"comment_ctime":1587862331,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1587862331","product_id":100020801,"comment_content":"老师好，请教个问题，redo log的日志是写到内存中的，当数据库异常重启，redo log可以保证数据不丢失，这个的前提是redo log落入磁盘吧？上面也提到建议每次提交事务就将redo log写入磁盘，那数据库更新操作也是落入磁盘，这两者从磁盘IO的性能上来说并没有差吧？","like_count":0,"discussions":[{"author":{"id":1238436,"avatar":"https://static001.geekbang.org/account/avatar/00/12/e5/a4/e16dca6a.jpg","nickname":"阿凯文","note":"","ucode":"F17CF201E74849","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":281234,"discussion_content":"redolog是顺序IO数据落盘是随机IO","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591697851,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":210388,"user_name":"静悄悄的看","can_delete":false,"product_type":"c1","uid":1069103,"ip_address":"","ucode":"D3602584911805","user_header":"https://static001.geekbang.org/account/avatar/00/10/50/2f/5992eb8f.jpg","comment_is_top":false,"comment_ctime":1587734597,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587734597","product_id":100020801,"comment_content":"可以了解下缓冲池","like_count":0},{"had_liked":false,"id":210296,"user_name":"jauhwan","can_delete":false,"product_type":"c1","uid":1323670,"ip_address":"","ucode":"2E77BEFECA47B9","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/o9539ZDnXzdTyiaC2y1rDazEzglRKgmfubvT8rNAtwg8x3TWkV0UtzQNDmlyxibnVMbOgjzbHKFcibc5XW9fbQqBg/132","comment_is_top":false,"comment_ctime":1587716408,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587716408","product_id":100020801,"comment_content":"老师，我想请问一下“有了 redo log，InnoDB 就可以保证即使数据库发生异常重启，之前提交的记录都不会丢失，这个能力称为 crash-safe。” 因为redo log并不是实时写入磁盘的，假如还没写入磁盘的时候mysql就异常重启了，那么内存里的数据不是会丢失吗？也代表内存里的redo log会丢失呀。那这个时候不就会出现数据不一致了吗？","like_count":0},{"had_liked":false,"id":209243,"user_name":"齐冰森","can_delete":false,"product_type":"c1","uid":1777981,"ip_address":"","ucode":"AF0BD3CD007F3F","user_header":"https://static001.geekbang.org/account/avatar/00/1b/21/3d/9a54d88c.jpg","comment_is_top":false,"comment_ctime":1587522989,"is_pvip":false,"replies":[{"id":"78160","content":"没有提交的意思是，客人买一半（比如刚点菜完还没上菜），突然失火都跑了<br><br>这样是不应该记录到粉板上的<br><br>","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1587526402,"ip_address":"","comment_id":209243,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1587522989","product_id":100020801,"comment_content":"#比如突然停业几天，恢复生意后依然可以通过账本和粉板上的数据明确赊账账目。#<br>对于这一句话,不太清楚.如果崩溃之后,对于没有提交的事务来说,粉板上的记录难道不是不存在了吗?","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492746,"discussion_content":"没有提交的意思是，客人买一半（比如刚点菜完还没上菜），突然失火都跑了\n\n这样是不应该记录到粉板上的\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587526402,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":208471,"user_name":"黄文昊","can_delete":false,"product_type":"c1","uid":1161325,"ip_address":"","ucode":"FC5F74FB91C8CB","user_header":"https://static001.geekbang.org/account/avatar/00/11/b8/6d/aeb34336.jpg","comment_is_top":false,"comment_ctime":1587366390,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587366390","product_id":100020801,"comment_content":"留言比较晚了。<br><br>理解下来，2PC协议总结成一句话：“答应的事情就一定要做到”。","like_count":0},{"had_liked":false,"id":208086,"user_name":"可以但没必要","can_delete":false,"product_type":"c1","uid":1743812,"ip_address":"","ucode":"DEB3CED22C7A87","user_header":"https://static001.geekbang.org/account/avatar/00/1a/9b/c4/c5cca42b.jpg","comment_is_top":false,"comment_ctime":1587272226,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587272226","product_id":100020801,"comment_content":"当数据库数据更新频繁的时候，一天一备比一周一备更有优势，当误操作数据恢复时，一天一备丢失的数据是当天的操作数据，而一周一备则会丢失至少一天以上的数据。","like_count":0},{"had_liked":false,"id":207538,"user_name":"波波","can_delete":false,"product_type":"c1","uid":1034120,"ip_address":"","ucode":"F63725D3416CC5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c7/88/a2e42dc8.jpg","comment_is_top":false,"comment_ctime":1587104248,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587104248","product_id":100020801,"comment_content":"老师，“当有一条记录需要更新的时候，InnoDB 引擎就会先把记录写到 redo log（粉板）里面，并更新内存，这个时候更新就算完成了。同时，InnoDB 引擎会在适当的时候，将这个操作记录更新到磁盘里面”， 这里说的将记录更新到内存中，内存是指第1节课说的缓存吗？如果是，上节课提到缓存经常被置为无效，可以关闭查询缓存的操作，那如果不查缓存，进行数据更新时，先更新内存，等到适当时候才会更新硬盘，这期间查询这条数据是直接从硬盘查吗？会不会查不到？","like_count":0},{"had_liked":false,"id":206973,"user_name":"翁浩","can_delete":false,"product_type":"c1","uid":1962656,"ip_address":"","ucode":"A08676315D100B","user_header":"","comment_is_top":false,"comment_ctime":1586966153,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586966153","product_id":100020801,"comment_content":"我觉得数据库中数据重要性很高、更新频繁且数据恢复速度要求很快的场景下，一天一备比一周一备更有优势；因为重要的数据一般不能丢失，如果数据更新频率很低，每天和每周备份区别不大，再者，备份频繁一些，那么恢复数据的时间点更加精确而且binlog也会缩小范围，使得恢复数据更快","like_count":0},{"had_liked":false,"id":206189,"user_name":"拓拔泽","can_delete":false,"product_type":"c1","uid":1323257,"ip_address":"","ucode":"1EB797F64CE26D","user_header":"https://static001.geekbang.org/account/avatar/00/14/30/f9/e4e49771.jpg","comment_is_top":false,"comment_ctime":1586821586,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586821586","product_id":100020801,"comment_content":"老师，数据库是通过checkpoint机制将lru列表中的脏页刷到磁盘。除了lru列表，还有flush list，这两个有什么区别吗?","like_count":0},{"had_liked":false,"id":205845,"user_name":"冯佳兴","can_delete":false,"product_type":"c1","uid":1717342,"ip_address":"","ucode":"41D308E99EF9FF","user_header":"https://static001.geekbang.org/account/avatar/00/1a/34/5e/089ac156.jpg","comment_is_top":false,"comment_ctime":1586746098,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586746098","product_id":100020801,"comment_content":"受益颇深，总结如下<br>https:&#47;&#47;fjxcsdn.blog.csdn.net&#47;article&#47;details&#47;105480772","like_count":0},{"had_liked":false,"id":205842,"user_name":"冯佳兴","can_delete":false,"product_type":"c1","uid":1717342,"ip_address":"","ucode":"41D308E99EF9FF","user_header":"https://static001.geekbang.org/account/avatar/00/1a/34/5e/089ac156.jpg","comment_is_top":false,"comment_ctime":1586745862,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586745862","product_id":100020801,"comment_content":"prepare 准备阶段做了什么操作呢？","like_count":0},{"had_liked":false,"id":205841,"user_name":"冯佳兴","can_delete":false,"product_type":"c1","uid":1717342,"ip_address":"","ucode":"41D308E99EF9FF","user_header":"https://static001.geekbang.org/account/avatar/00/1a/34/5e/089ac156.jpg","comment_is_top":false,"comment_ctime":1586745839,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586745839","product_id":100020801,"comment_content":"完成 binlog 写入以后，系统崩溃，此时redo log 没有提交，也就意味着回滚，不会认可binlog中的日志对么？","like_count":0},{"had_liked":false,"id":203518,"user_name":"Raynor","can_delete":false,"product_type":"c1","uid":1657942,"ip_address":"","ucode":"717E910E10901A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eo8IGGkHia6FRKghTAng3Uw93tmwJqSu3MhMn4j5q20eO2B4GJh2CrLq6ia2D8Fs7CmdPV3GiavRJHDg/132","comment_is_top":false,"comment_ctime":1586226122,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586226122","product_id":100020801,"comment_content":"一周一备的情况下，系统恢复时间RTO应该会更好","like_count":0},{"had_liked":false,"id":202915,"user_name":"Fan()","can_delete":false,"product_type":"c1","uid":1069127,"ip_address":"","ucode":"FED79EC7D78E91","user_header":"https://static001.geekbang.org/account/avatar/00/10/50/47/46da4585.jpg","comment_is_top":false,"comment_ctime":1586085770,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586085770","product_id":100020801,"comment_content":"老师请教一个问题, 当开启binlog时, 事务提交是否是这三个阶段<br>1.innodb写prepare日志, 写xid到redo log, 将redo写入磁盘<br>2.写binlog, 将xid也写入binlog, binlog写入磁盘<br>3.innodb写commit log, 8.0前写binlog file,pos 到redo,8.0后写GTID到redo<br>不知道这个1,2,3说的对不, 其实我主要的问题是, commit ok的信息是在2完成后返回给客户端还是在3完成后返回给客户端?","like_count":0},{"had_liked":false,"id":201033,"user_name":"白开水","can_delete":false,"product_type":"c1","uid":1725387,"ip_address":"","ucode":"0300AB319468D3","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/yb5R8iaxicD8tROw24eqlC8icMLSz4UeMnebgXASYV8lLahzpaeiapqZkM3oAw55zPBR84KeRQ0ILQHmv3pmibuicxGg/132","comment_is_top":false,"comment_ctime":1585708209,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585708209","product_id":100020801,"comment_content":"老师，你好！<br>rodo logo属于物理文件，运行在InnoDB引擎，记录的是数据页的修改，有数据写入到内存的时候，更新内存，redolog处于prepare，此时写Binlog记录sql语句或row的内容，当Binlog写完之后，执行commit，<br>有下面的疑问需要老师解答一下：<br>1、redolog是物理的，Binlog是逻辑的，当rendolog处于prepare阶段-&gt;写binlog-&gt;commit之后，这个过程是有redolog来记录的吗，如果是，那么redolog循环写满之后，也将rendo日志写到磁盘上，进行归档的吗，同时归档可以设置多个路径吗？个人按照oracle的方式来理解，oracle如果设置了归档，redo写满之后，就会将redo写到物理磁盘上进行归档，mysql也是这样吗？<br>2、完全恢复的疑问：如果oracle要进行完全恢复，需要全备+归档+redolog，那么mysql完全恢复也需要全备+在线redolog+归档（redolog+binlog)吗？这里的归档自己理解为binlog和redolog写入到磁盘的文件，<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>","like_count":0},{"had_liked":false,"id":200684,"user_name":"小菠萝🍍","can_delete":false,"product_type":"c1","uid":1686410,"ip_address":"","ucode":"DA814203C6C062","user_header":"https://static001.geekbang.org/account/avatar/00/19/bb/8a/d33d9d3f.jpg","comment_is_top":false,"comment_ctime":1585637824,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585637824","product_id":100020801,"comment_content":"听完这次课，主要有以下理解：<br>1. redo log是防止每次更新操作都需要访问磁盘IO而产生的一个中间记录日志，这个日志存在于InnoDB执行引擎当中，每个数据库都有自己的InnoDB执行引擎，所以每个数据库都有自己的redo log，当采用InnoDB执行引擎的数据库crash并重启时，它的redo log仍然存在于引擎当中，所以可以保存已经提交的事务但却未写入磁盘的所有操作，并重新在某个适当的时候写入磁盘当中；<br>2. bin log是MySQL Server层下的一个逻辑日志，它主要是记录到目前为止对数据库的表执行了哪些操作，它是存在于磁盘上的，以追加的方式进行写入。<br>对于两阶段提交，目的在于保证binlog和redo log的一致性，因为在数据恢复的过程中，使用binlog将数据恢复到某一时间点时，也需要保证redo log真的做了这个操作，否则会出现很奇怪的现象：<br>列：c；更新前的值：0；更新后的值：1<br>1. redo log写入但binlog没有写入：crash重启后由于binlog没有写入更新操作，但redo log仍然存在一个事务，之后将这个更新操作成功写入磁盘持久化，那么以后再使用从这个binlog进行数据还原时，就会少了这条操作，导致数据库数据不一致；<br>2. binlog写入但redo log没有写入：也就是说这个更新操作是被回滚的，但是binlog却记录了这条更新操作，也就是说binlog认为数据库执行了这条更新操作，实际上没有执行，那么在之后使用binlog进行数据还原时会多出这一条更新操作，也会导致数据不一致。<br><br>留下一个小疑问：对于redo log和binlog记录的位置，redo log为什么称为物理日志，binlog为什么称为逻辑日志，虽然在文章里有提及，但我有个疑问是redo log和binlog是两个实实在在存在于磁盘上的文件吗？<br>以上内容不知道有没有理解错误？希望作者能指点指点！谢谢！","like_count":0},{"had_liked":false,"id":198185,"user_name":"August","can_delete":false,"product_type":"c1","uid":1538486,"ip_address":"","ucode":"72A0CB0C74CD35","user_header":"https://static001.geekbang.org/account/avatar/00/17/79/b6/98834766.jpg","comment_is_top":false,"comment_ctime":1585413138,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1585413138","product_id":100020801,"comment_content":"有个不解：文中一方面说binlog没有crash_safe能力，一方面又说数据库异常重启后要通过binlog来做数据恢复","like_count":0,"discussions":[{"author":{"id":1304762,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e8/ba/a6976395.jpg","nickname":"Stev","note":"","ucode":"AC16C3BF6D0E66","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":221897,"discussion_content":"crash_safe是指数据库意外down机,比如突然停电.这时候有的数据只记录了日志,还没写入磁盘,需要依赖redo log做恢复,如果没有redo log,只有bin log的话,数据库启动时会直接报错,无法启动.","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586077235,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":198134,"user_name":"August","can_delete":false,"product_type":"c1","uid":1538486,"ip_address":"","ucode":"72A0CB0C74CD35","user_header":"https://static001.geekbang.org/account/avatar/00/17/79/b6/98834766.jpg","comment_is_top":false,"comment_ctime":1585411299,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585411299","product_id":100020801,"comment_content":"我认为在数据库每天操作更新频繁的场景下，需要一天一备份，避免误操作或者系统crash导致重要数据丢失，提高crash_safe的能力。","like_count":0},{"had_liked":false,"id":196465,"user_name":"terryking","can_delete":false,"product_type":"c1","uid":1012371,"ip_address":"","ucode":"39433F06D6BEF6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/72/93/46895883.jpg","comment_is_top":false,"comment_ctime":1585283909,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585283909","product_id":100020801,"comment_content":"&quot;&quot;redo log 用于保证 crash-safe 能力。innodb_flush_log_at_trx_commit 这个参数设置成 1 的时候，表示每次事务的 redo log 都直接持久化到磁盘。这个参数我建议你设置成 1，这样可以保证 MySQL 异常重启之后数据不丢失。&quot;&quot; 这个redo log每次事务提交都持久化到磁盘指的是 把业务数据持久化到具体的数据页里面呢？还是redo log有内存区域，然后把redolog持久化到redolog的那4个块中？麻烦老师有时间解答一下","like_count":0},{"had_liked":false,"id":196448,"user_name":"刘瑞","can_delete":false,"product_type":"c1","uid":1143234,"ip_address":"","ucode":"7E712BC281A8A7","user_header":"","comment_is_top":false,"comment_ctime":1585282634,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585282634","product_id":100020801,"comment_content":"老师，您好，我想问一下这个写redolog和写盘不应该是这个事吗？写redolog就是顺序写磁盘，那为什么还需要配置innodb_flush_at_trx_commit为1啊？即使mysql异常重启了，根据redolog也可以恢复数据，不知道这个写磁盘有什么用？老师麻烦解答下呗，我问得问题从来没解答过，谢谢","like_count":0},{"had_liked":false,"id":195406,"user_name":"jzhongchen","can_delete":false,"product_type":"c1","uid":1745949,"ip_address":"","ucode":"B78FD795DB752F","user_header":"https://static001.geekbang.org/account/avatar/00/1a/a4/1d/81e93f87.jpg","comment_is_top":false,"comment_ctime":1585185839,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585185839","product_id":100020801,"comment_content":"以前只听说过 binlog 做备份或主从，第一次听说 redo log。<br>binlog 和 redo log 的区别很重要：<br>InnoDB 独有                 server 层实现（所有引擎可以使用）<br>物理的                        逻辑的<br>固定大小、循环性         追加写<br>crash-safe                  备份、主从、恢复<br><br>两段式提交是为了保证 binlog 和 redo log 的一致性","like_count":0},{"had_liked":false,"id":194814,"user_name":"未命名","can_delete":false,"product_type":"c1","uid":1178114,"ip_address":"","ucode":"414CAE9E927CD3","user_header":"https://static001.geekbang.org/account/avatar/00/11/fa/02/7e70ada0.jpg","comment_is_top":false,"comment_ctime":1585107470,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585107470","product_id":100020801,"comment_content":"打卡学习，在极客买过最有价值的就是这门课了","like_count":0},{"had_liked":false,"id":192003,"user_name":"刘桢","can_delete":false,"product_type":"c1","uid":1482815,"ip_address":"","ucode":"3BFAB1C9772EB4","user_header":"https://static001.geekbang.org/account/avatar/00/16/a0/3f/06b690ba.jpg","comment_is_top":false,"comment_ctime":1584809690,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584809690","product_id":100020801,"comment_content":"叮叮当","like_count":0},{"had_liked":false,"id":191792,"user_name":"单色","can_delete":false,"product_type":"c1","uid":1907486,"ip_address":"","ucode":"A1DA6E497FD74C","user_header":"https://static001.geekbang.org/account/avatar/00/1d/1b/1e/f5c16f7e.jpg","comment_is_top":false,"comment_ctime":1584796837,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584796837","product_id":100020801,"comment_content":"丁大神的专栏，精炼，精准，文章篇幅长短刚好，不像其他深入mysql的书，篇幅超长，阅读体验不好。赞丁神","like_count":0},{"had_liked":false,"id":191203,"user_name":"Yanpeng","can_delete":false,"product_type":"c1","uid":1501586,"ip_address":"","ucode":"393B68505F51B3","user_header":"https://static001.geekbang.org/account/avatar/00/16/e9/92/4627c1d7.jpg","comment_is_top":false,"comment_ctime":1584754315,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584754315","product_id":100020801,"comment_content":"binlog是主从库保持同步的基础，为啥没人提呢？","like_count":0},{"had_liked":false,"id":189813,"user_name":"Spring coming","can_delete":false,"product_type":"c1","uid":1116196,"ip_address":"","ucode":"9E01F2D987D08B","user_header":"https://static001.geekbang.org/account/avatar/00/11/08/24/1d3bafaf.jpg","comment_is_top":false,"comment_ctime":1584569046,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584569046","product_id":100020801,"comment_content":"好几个问题,麻烦老师帮你解答一下<br>问题1 有些数据在写入磁盘前是存放在redo log中的，如果这个时候重启服务后，innoDB会把redo log重新回放一遍，然后写入内存吗<br>问题2 在两段式提交中执行完倒数第二步后宕机了，服务重试后是怎么做到redo log和binlog数据同步的？引擎把prepare状态的数据在binlog中删除吗？<br>问题3 真实场景中会有redolog写满的情况吗？假如有的话，引擎把4g数据同步到磁盘时，这个时候引擎的写操作会完全堵塞住，等待同步完成，还是边同步边把checkpoint前移？<br>问题4 redolog数据页能多讲解一下吗","like_count":0},{"had_liked":false,"id":189124,"user_name":"bass.","can_delete":false,"product_type":"c1","uid":1680097,"ip_address":"","ucode":"7F4E44BC09DE8E","user_header":"https://static001.geekbang.org/account/avatar/00/19/a2/e1/bb6ac7c8.jpg","comment_is_top":false,"comment_ctime":1584457842,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584457842","product_id":100020801,"comment_content":"假如redo log 在commit的情况 bin log 已经持久化了 这种情况crash 怎么保证数据一致","like_count":0},{"had_liked":false,"id":188808,"user_name":"aven","can_delete":false,"product_type":"c1","uid":1219825,"ip_address":"","ucode":"BBA903948322F2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9c/f1/fd21e69a.jpg","comment_is_top":false,"comment_ctime":1584419487,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584419487","product_id":100020801,"comment_content":"如果binlog写入，修改redolog的状态失败会是怎么样呢","like_count":0},{"had_liked":false,"id":188618,"user_name":"运维老胡","can_delete":false,"product_type":"c1","uid":1227007,"ip_address":"","ucode":"DF398BEE296E11","user_header":"https://static001.geekbang.org/account/avatar/00/12/b8/ff/249da6da.jpg","comment_is_top":false,"comment_ctime":1584374655,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584374655","product_id":100020801,"comment_content":"一天一全备，需要恢复数据的时候时间最短","like_count":0},{"had_liked":false,"id":187570,"user_name":"Jazz--李*华","can_delete":false,"product_type":"c1","uid":1143801,"ip_address":"","ucode":"622F7C7D206655","user_header":"https://static001.geekbang.org/account/avatar/00/11/73/f9/23e61ff4.jpg","comment_is_top":false,"comment_ctime":1584160328,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584160328","product_id":100020801,"comment_content":"文中，粉板相当于redo log，账本相当于binlog。redo log记录的是物理日志，binlog记录的是逻辑日志。两阶段提交prepare和commit，为了保持两份日志的逻辑一致性。<br><br>问题：前面我说到定期全量备份的周期“取决于系统重要性，有的是一天一备，有的是一周一备”。那么在什么场景下，一天一备会比一周一备更有优势呢？或者说，它影响了这个数据库系统的哪个指标？<br><br><br>答：一天一备比一周一备更有优势，因为一天一备，在crash-safe后，可以全量备份加某一天某一时刻之前的binlog就可以了，所需的恢复时间更短。而每周一次全备，所需要恢复的binlog日志更多，可能是七天的binlog日志都要恢复。<br>在灾备的场景，一天一备比一周一备更有优势。它影响着数据库的MTTR指标。","like_count":0},{"had_liked":false,"id":187040,"user_name":"chenfu","can_delete":false,"product_type":"c1","uid":1797537,"ip_address":"","ucode":"A7BA1C41EAE218","user_header":"https://static001.geekbang.org/account/avatar/00/1b/6d/a1/083dfdbb.jpg","comment_is_top":false,"comment_ctime":1583998067,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583998067","product_id":100020801,"comment_content":"丁奇老师，我有个问题，假设更新一条记录 id =2 的字段 c+1 ，如果 redo log 处于prepare 状态，binlog写入日志之后， 数据库系统crash了【此时还没有进行commit】，那重启之后，binlog 是已经记录的有这个更新记录了吗，如果有的话此时redo log 会自动把prepare的那条记录应用到数据库，变成commit状态吗？","like_count":0},{"had_liked":false,"id":186769,"user_name":"超超不会飞","can_delete":false,"product_type":"c1","uid":1025894,"ip_address":"","ucode":"F30D3E62442954","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a7/66/d3e151c7.jpg","comment_is_top":false,"comment_ctime":1583920280,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583920280","product_id":100020801,"comment_content":"redo log 是用来提高更新效率的，而binlog是用来持久化操作记录的。<br>redo log 是循环写的，写满了就擦除。binlog 是持久化的，数据回复靠的是binlog，因为binlog持久化了所有的操作。<br><br>为什么需要两段式提交？<br>若 redo log 写入成功（把 status 更新为 1），binlog写入失败。后续恢复时，status 恢复为 0，与原数据不一致。<br>若 binlog 写入成功（status 被记录为 1），redo log 写入失败（表中的 status 仍旧为 0）。恢复数据时，status 被恢复为 1，而原表中 status 为 0。","like_count":0},{"had_liked":false,"id":186409,"user_name":"刘瑞","can_delete":false,"product_type":"c1","uid":1143234,"ip_address":"","ucode":"7E712BC281A8A7","user_header":"","comment_is_top":false,"comment_ctime":1583839257,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583839257","product_id":100020801,"comment_content":"老师您好，我想问下，1.undolog可以查看吗，如何查看<br>2.redolog可以查看吗，如何查看","like_count":0},{"had_liked":false,"id":185756,"user_name":"Ryan","can_delete":false,"product_type":"c1","uid":1667987,"ip_address":"","ucode":"95BBBEE5B23878","user_header":"https://static001.geekbang.org/account/avatar/00/19/73/93/0a3a1e5b.jpg","comment_is_top":false,"comment_ctime":1583675164,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583675164","product_id":100020801,"comment_content":"可以理解为 redo log是一个增量 或者是一段时间内的快照 因为是循环写 满了就会被清除，binlog是一个完整的备份 只要磁盘足够大就可以一直保留，可以这样理解吗？","like_count":0},{"had_liked":false,"id":184703,"user_name":"字节情怀","can_delete":false,"product_type":"c1","uid":1144914,"ip_address":"","ucode":"6C9AB8C844F4C5","user_header":"https://static001.geekbang.org/account/avatar/00/11/78/52/116508b8.jpg","comment_is_top":false,"comment_ctime":1583386293,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583386293","product_id":100020801,"comment_content":"写完binlog后commit失败不是也一样会出现不一致情况吗？","like_count":0},{"had_liked":false,"id":184618,"user_name":"贾森安德森","can_delete":false,"product_type":"c1","uid":1071680,"ip_address":"","ucode":"7FF58646E0AD86","user_header":"https://static001.geekbang.org/account/avatar/00/10/5a/40/59de94de.jpg","comment_is_top":false,"comment_ctime":1583371908,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583371908","product_id":100020801,"comment_content":"打卡第2天<br>感觉一天一备数据恢复时数据比较准确，<br>一周一备是不是中间隔得那几天数据会丢失？","like_count":0},{"had_liked":false,"id":183823,"user_name":"企鹅","can_delete":false,"product_type":"c1","uid":1498369,"ip_address":"","ucode":"AE29B98E5B4497","user_header":"https://static001.geekbang.org/account/avatar/00/16/dd/01/803f3750.jpg","comment_is_top":false,"comment_ctime":1583141100,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583141100","product_id":100020801,"comment_content":"老师好，想问一下，文中的粉笔板-redo log是存储在什么地方的，内存？磁盘","like_count":0},{"had_liked":false,"id":183204,"user_name":"Kvicii.Y","can_delete":false,"product_type":"c1","uid":1442588,"ip_address":"","ucode":"446BFA633569EA","user_header":"https://static001.geekbang.org/account/avatar/00/16/03/1c/c9fe6738.jpg","comment_is_top":false,"comment_ctime":1582971843,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582971843","product_id":100020801,"comment_content":"“昨天晚上的一个备份”，我理解的是应该是当天误操作那个晚上的binlog吧，这样只需要恢复误操作之前的的binlog就可以了吧？小白问题","like_count":0},{"had_liked":false,"id":180953,"user_name":"peiyi","can_delete":false,"product_type":"c1","uid":1272214,"ip_address":"","ucode":"4834AC379A21AB","user_header":"https://static001.geekbang.org/account/avatar/00/13/69/96/f7d2d30e.jpg","comment_is_top":false,"comment_ctime":1582448877,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582448877","product_id":100020801,"comment_content":"两阶段提交如果发生crush，主要根据bin log的状态选择不同操作。<br>1. binlog有记录，redolog状态commit：正常完成的事务，不需要恢复<br>2. binlog有记录，redolog状态prepare：在binlog写完提交事务之前的crash，恢复操作：提交事务<br>3. binlog无记录，redolog状态prepare：在binlog写完之前的crash，恢复操作：回滚事务<br>4. binlog无记录，redolog无记录：在redolog写之前crash，恢复操作：回滚事务<br>只要bin log没有记录，无论redo log是什么状态，数据都要回滚。","like_count":0},{"had_liked":false,"id":180909,"user_name":"Newcooler","can_delete":false,"product_type":"c1","uid":1060639,"ip_address":"","ucode":"1E77BD3A752809","user_header":"https://static001.geekbang.org/account/avatar/00/10/2f/1f/ef5cf01a.jpg","comment_is_top":false,"comment_ctime":1582441150,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582441150","product_id":100020801,"comment_content":"老师您好, redolog设计的初衷是不是出于性能考虑, 相当于操作存储数据的缓冲区, 因为操作存储数据是随机读写,而redolog只是顺序追加?","like_count":0},{"had_liked":false,"id":180709,"user_name":"Au童子","can_delete":false,"product_type":"c1","uid":1584164,"ip_address":"","ucode":"41AF0288D2553E","user_header":"https://static001.geekbang.org/account/avatar/00/18/2c/24/cebcede2.jpg","comment_is_top":false,"comment_ctime":1582369301,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582369301","product_id":100020801,"comment_content":"老师你好，时隔一年多了来评论不知道您能不能看到。这里有个问题我有点不明白，每次更新写redolog和binlog，日志也是磁盘上的文件，那是不是每次更新完日志就要立刻就要落到磁盘里呢，如果是这样的话那不还是违背了这个设计的初衷呢？如果不是的话，那这些日志如果在内存里的时候异常崩溃丢失了，又怎么还原这些更新的数据呢？","like_count":0},{"had_liked":false,"id":179110,"user_name":"石小","can_delete":false,"product_type":"c1","uid":1781893,"ip_address":"","ucode":"4258C686F289A6","user_header":"https://static001.geekbang.org/account/avatar/00/1b/30/85/14c2f16c.jpg","comment_is_top":false,"comment_ctime":1581918427,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581918427","product_id":100020801,"comment_content":"第一:redo log是在InnoDB存储引擎层产生，而binlog是MySQL数据库的上层产生的，并且二进制日志不仅仅针对INNODB存储引擎，MySQL数据库中的任何存储引擎对于数据库的更改都会产生二进制日志。<br><br>第二：两种日志记录的内容形式不同。MySQL的binlog是逻辑日志，其记录是对应的SQL语句。而innodb存储引擎层面的重做日志是物理日志。<br><br>第三：两种日志与记录写入磁盘的时间点不同，二进制日志只在事务提交完成后进行一次写入。而innodb存储引擎的重做日志在事务进行中不断地被写入，并日志不是随事务提交的顺序进行写入的。<br><br>二进制日志仅在事务提交时记录，并且对于每一个事务，仅在事务提交时记录，并且对于每一个事务，仅包含对应事务的一个日志。而对于innodb存储引擎的重做日志，由于其记录是物理操作日志，因此每个事务对应多个日志条目，并且事务的重做日志写入是并发的，并非在事务提交时写入，其在文件中记录的顺序并非是事务开始的顺序。<br><br>第四：binlog不是循环使用，在写满或者重启之后，会生成新的binlog文件，redo log是循环使用。<br><br>第五：binlog可以作为恢复数据使用，主从复制搭建，redo log作为异常宕机或者介质故障后的数据恢复使用。","like_count":0},{"had_liked":false,"id":177722,"user_name":"后知后觉","can_delete":false,"product_type":"c1","uid":1202501,"ip_address":"","ucode":"C0313CB4C744C8","user_header":"https://static001.geekbang.org/account/avatar/00/12/59/45/189d5cc2.jpg","comment_is_top":false,"comment_ctime":1581480913,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1581480913","product_id":100020801,"comment_content":"请问老师，如果commit时失败了，那么redo log就处在prepare状态，这个会有什么问题吗？崩溃回复数据的时候，如果发现redo log是prepare状态，引擎会怎么处理？","like_count":0},{"had_liked":false,"id":177146,"user_name":"木得感情的编码机器","can_delete":false,"product_type":"c1","uid":1810051,"ip_address":"","ucode":"9C6CD47ADCB8E6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK0uyg1IicbEhLwsgM2A2ROoyVdWdmUqZfQfs6G67w9m3hdRNBMOQJatQoACj3qNGgj2KVIgricaYiaQ/132","comment_is_top":false,"comment_ctime":1581303007,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581303007","product_id":100020801,"comment_content":"看了很多评论，似乎有不少同学认为redo log和binlog的二阶段提交设计不需要存在。那我来说一下我的理解。<br>假如有一笔账目，甲方账本上有记录，乙方账本上没记录，或者甲方没有，乙方有，那么我们应该相信谁呢？<br>加入二阶段提交的设计后，变成：甲方账本上记录有一笔账目，状态为已付款未收到发票。而乙方账本上记录了这一笔账目，状态为已收款，已开发票。<br>正常情况，最后甲方收到发票后才认为这笔账已完结（也就是二阶段提交）。特殊情况下（系统异常重启），甲方虽然没有收到发票，但是乙方记录中已经开出来了，可能是快递给弄丢了。那么双方协商这笔账目就此了结。<br>所以二阶段提交是一种信任保证，数据一致性保证的设计。因为甲乙双方都记录了同一笔账，说明这笔账是真实存在的。","like_count":0},{"had_liked":false,"id":177006,"user_name":"forever","can_delete":false,"product_type":"c1","uid":1574051,"ip_address":"","ucode":"3EBCD4AB045880","user_header":"https://static001.geekbang.org/account/avatar/00/18/04/a3/95de9a19.jpg","comment_is_top":false,"comment_ctime":1581247412,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581247412","product_id":100020801,"comment_content":"那一旦最后一步commit时系统崩了怎么办，还能保证两个日志一致吗？","like_count":0},{"had_liked":false,"id":176967,"user_name":"赵磊","can_delete":false,"product_type":"c1","uid":1481655,"ip_address":"","ucode":"18F3C2CC5040F9","user_header":"https://static001.geekbang.org/account/avatar/00/16/9b/b7/314ae48b.jpg","comment_is_top":false,"comment_ctime":1581238121,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581238121","product_id":100020801,"comment_content":"老师，文章中说到innoDB会在合适的时机将redo log中的日志刷新到磁盘，而这个时机是cpu较空闲或者redo log被写满了，那这样在数据提交到刷新到磁盘中是有一段时间差的，但实际情况是更新后可以立即被查询到，这是通过什么机制去实现的呢？","like_count":0},{"had_liked":false,"id":176927,"user_name":"凡","can_delete":false,"product_type":"c1","uid":1721168,"ip_address":"","ucode":"80C2A6452AB9EA","user_header":"https://static001.geekbang.org/account/avatar/00/1a/43/50/abb4ca1e.jpg","comment_is_top":false,"comment_ctime":1581229325,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581229325","product_id":100020801,"comment_content":"回答老师的课后题：从数据恢复的速度来看，一天一备的需要重放的 binlog量较少，能很快恢复数据库，只需要找出上一个备份恢复数据，比如备份是在零点，只需要找出前一天 0 点的 binlog 恢复即可，但是如果是一周一备，那就需要找到上周的备份数据，然后从上周备份的那个时间点重放 binlog，需要恢复的时间就很长了","like_count":0},{"had_liked":false,"id":176553,"user_name":"SnowsonZ","can_delete":false,"product_type":"c1","uid":1446972,"ip_address":"","ucode":"5AF76D55CCDC8F","user_header":"https://static001.geekbang.org/account/avatar/00/16/14/3c/d6be29f3.jpg","comment_is_top":false,"comment_ctime":1581085531,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581085531","product_id":100020801,"comment_content":"更新操作记录： redo log , bin log。通过两阶段提交，保证即使数据库故障崩溃后，依旧能最大可能保证数据的一致性。 redo log记录， prepare -&gt; bin log 记录 -&gt;redo log commit<br><br>区别：redo log由InnoDB提供，物理上更新记录，“该页数据有什么变动”；循环存储，大小限制，无法归档； 提供crash_safe, 即重启后redo log仍可正常flush到磁盘。bin log由 Server层提供，属逻辑上的变更记录，2种模式：1. SQL形式记录.   2. 变更前后的记录。用于数据备份<br><br>课后题，关于备份周期，周期越长，备份时消耗的时间越长。会影响对外服务的稳定性和性能。","like_count":0},{"had_liked":false,"id":176461,"user_name":"月迷津渡","can_delete":false,"product_type":"c1","uid":1264111,"ip_address":"","ucode":"2B18B2FE3DAC3B","user_header":"https://static001.geekbang.org/account/avatar/00/13/49/ef/02401473.jpg","comment_is_top":false,"comment_ctime":1581064436,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581064436","product_id":100020801,"comment_content":"有2个小问题，<br>1）redo log的最终落盘和事务提交是两个概念吧，已经事务提交成功的记录可以一直在redolog的日志中但是没有写磁盘数据文件吧。<br>2) 2段提交在事务commit成功之前如果有任何异常都是回退redolog和binlog？","like_count":0},{"had_liked":false,"id":176122,"user_name":"ipofss","can_delete":false,"product_type":"c1","uid":1018620,"ip_address":"","ucode":"DE3061C9259F9E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8a/fc/d1dd57dd.jpg","comment_is_top":false,"comment_ctime":1580963022,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1580963022","product_id":100020801,"comment_content":"老师，关于两阶段提交的，我没太理解。1、先写redo log，置为prepare；2、再写binlog；3、看到binlog写成功了，我才把redo log置为commit，而binlog不关我的事。。而前面这3步，又属于同一个事务，这样的话，进行数据库恢复时就能保证数据的完整一致性，是这样吗？","like_count":0},{"had_liked":false,"id":175447,"user_name":"杨池子","can_delete":false,"product_type":"c1","uid":1766622,"ip_address":"","ucode":"93B8E815B114F7","user_header":"https://static001.geekbang.org/account/avatar/00/1a/f4/de/24151d6e.jpg","comment_is_top":false,"comment_ctime":1580722080,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1580722080","product_id":100020801,"comment_content":"老师您好，请问两阶段提交是如何保证两个日志一致性的，比如redo log prepare状态而binlog还没写完时crach，以及binlog写完而redo log 还没改为commit状态时crach，如何能保证这两种情况下系统重启后两个日志一致","like_count":0},{"had_liked":false,"id":175328,"user_name":"cndws","can_delete":false,"product_type":"c1","uid":1518570,"ip_address":"","ucode":"887A591B9B83B5","user_header":"https://static001.geekbang.org/account/avatar/00/17/2b/ea/b320fa30.jpg","comment_is_top":false,"comment_ctime":1580655542,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1580655542","product_id":100020801,"comment_content":"binlog二进制日志，用于记录事务的增删改，如果commit成功就会写入binlog<br>relay log中继日志，用于记录prepare过程，commit提交以后更新到biblog，主从复制时，系统从主服务器copy过来的信息也会写入中继日志<br><br>备份频率主要取决于业务，业务量比较大操作频繁，建议1天1备，反之可以考虑1周1备","like_count":0},{"had_liked":false,"id":175002,"user_name":"陈大头","can_delete":false,"product_type":"c1","uid":1335400,"ip_address":"","ucode":"F1CA8837BF1E5C","user_header":"https://static001.geekbang.org/account/avatar/00/14/60/68/626cb455.jpg","comment_is_top":false,"comment_ctime":1580523496,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1580523496","product_id":100020801,"comment_content":"备份最主要是为了数据安全，预防误删的作用吧……所以业务量庞大，日写入量多，比较重要的主数据要一天一备吧","like_count":0},{"had_liked":false,"id":174840,"user_name":"雁㶇烟潴","can_delete":false,"product_type":"c1","uid":1302117,"ip_address":"","ucode":"30650DEE6A9F3B","user_header":"https://static001.geekbang.org/account/avatar/00/13/de/65/16545faf.jpg","comment_is_top":false,"comment_ctime":1580429842,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1580429842","product_id":100020801,"comment_content":"理清了两阶段提交","like_count":0},{"had_liked":false,"id":174060,"user_name":"疯琴","can_delete":false,"product_type":"c1","uid":1099379,"ip_address":"","ucode":"82ACAA4A27753D","user_header":"https://static001.geekbang.org/account/avatar/00/10/c6/73/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1579938706,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579938706","product_id":100020801,"comment_content":"粉板+账本的比喻生动形象👍请问老师mysqldump 出来的是不是就是 binlog？","like_count":0},{"had_liked":false,"id":174052,"user_name":"起而行","can_delete":false,"product_type":"c1","uid":1131399,"ip_address":"","ucode":"4F116B0B740776","user_header":"https://static001.geekbang.org/account/avatar/00/11/43/87/7604d7a4.jpg","comment_is_top":false,"comment_ctime":1579930292,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1579930292","product_id":100020801,"comment_content":"一天一备份可以提高恢复的效率。比如同样在周五crash,一周一备份，需要从周一开始重启。一天一备份可以从周四重启","like_count":0},{"had_liked":false,"id":173883,"user_name":"yazid","can_delete":false,"product_type":"c1","uid":1231108,"ip_address":"","ucode":"962643B6FE8B49","user_header":"https://static001.geekbang.org/account/avatar/00/12/c9/04/9d0050a5.jpg","comment_is_top":false,"comment_ctime":1579753607,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579753607","product_id":100020801,"comment_content":"有个问题，本章文中提到一种情况是：更新的数据直接写入磁盘io效率低，但是写入redo log的方式不也是对磁盘上的文件进行写入吗，为啥效率就比较高呢","like_count":0},{"had_liked":false,"id":173811,"user_name":"风云变","can_delete":false,"product_type":"c1","uid":1510011,"ip_address":"","ucode":"E586B6E3FD5157","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJgtVYia3HhaS65DjiaWBfTJj0yded6xBZbw0jT3IOxcqQibLz3yibw5KXK515tYXr3iaMibcywadst6C1w/132","comment_is_top":false,"comment_ctime":1579703658,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579703658","product_id":100020801,"comment_content":"跟oracle比，mysql要穿行写redolog和binlog，响应时间变长","like_count":0},{"had_liked":false,"id":173806,"user_name":"迈克","can_delete":false,"product_type":"c1","uid":1079085,"ip_address":"","ucode":"6728F105A9B37C","user_header":"https://static001.geekbang.org/account/avatar/00/10/77/2d/4d2d04a0.jpg","comment_is_top":false,"comment_ctime":1579701920,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579701920","product_id":100020801,"comment_content":"粉板这个比喻真神奇，看着就懂了","like_count":0},{"had_liked":false,"id":173763,"user_name":"小袁","can_delete":false,"product_type":"c1","uid":1811495,"ip_address":"","ucode":"3F5D8721F577D9","user_header":"https://static001.geekbang.org/account/avatar/00/1b/a4/27/15e75982.jpg","comment_is_top":false,"comment_ctime":1579681168,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579681168","product_id":100020801,"comment_content":"老师用反证法证明不用反证法会导致出现问题，但没有正面用了反证法就没有问题。","like_count":0},{"had_liked":false,"id":173725,"user_name":"su","can_delete":false,"product_type":"c1","uid":1119231,"ip_address":"","ucode":"DA3C0EC7F69DC6","user_header":"https://static001.geekbang.org/account/avatar/00/11/13/ff/985ead3c.jpg","comment_is_top":false,"comment_ctime":1579670725,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579670725","product_id":100020801,"comment_content":"所以到底是用什么来恢复, 没有讲清楚, 一会说redo log会恢复, 一会又说用binlog来做备份恢复, 难道两者都用? 两者都用的话就不会出现不一致的情况了吧","like_count":0},{"had_liked":false,"id":173707,"user_name":"mgs2002","can_delete":false,"product_type":"c1","uid":1812970,"ip_address":"","ucode":"F5931108BD509B","user_header":"https://static001.geekbang.org/account/avatar/00/1b/a9/ea/5bfce6c5.jpg","comment_is_top":false,"comment_ctime":1579665175,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579665175","product_id":100020801,"comment_content":"简单总结<br>1. MySQL的WAL（Write-Ahead Logging）机制, 先写日志，后写磁盘<br>2.  MySQL更新操作到执行器那一步需要写入redo log（重做日志，只支持InnoDB引擎），状态为预提交，然后在写入binlog（归档日志），写入成功后提交事务将redo log 状态改为已提交。<br>3.  为什么需要两段式提交，目的是为了保证恢复的数据和原库数据一致性。<br>4. 课后思考题：按我的理解天天备份和一周备份一次主要看系统数据的重要性，如果比较重要并且希望恢复的时间短可以天天备份，否则几天备份一次","like_count":0},{"had_liked":false,"id":173654,"user_name":"朱迪威","can_delete":false,"product_type":"c1","uid":1081079,"ip_address":"","ucode":"A7C84A447B825F","user_header":"https://static001.geekbang.org/account/avatar/00/10/7e/f7/ca1a29a1.jpg","comment_is_top":false,"comment_ctime":1579653618,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579653618","product_id":100020801,"comment_content":"请问老师，是不是只要记了binlog也就能保证数据一定会最终刷盘？如果是的话也就因为binlog只记刷盘结果，不记事务中间态所以不能用binlog恢复事务？第三个问题在不开binlog功能时，中间态的redo prepare不靠binlog如何能恢复呢？感谢您的解答","like_count":0},{"had_liked":false,"id":173641,"user_name":"brucelin99","can_delete":false,"product_type":"c1","uid":1031123,"ip_address":"","ucode":"70C818634843AF","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKr0veyMel7mqLpTWQaicWhLicwbSzSUkqon512o8EExpGb5qq8Qic7qYwlEFr942gJFgPia3Rg5Z6sUw/132","comment_is_top":false,"comment_ctime":1579648296,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579648296","product_id":100020801,"comment_content":"有个问题：今天数据更新清空缓存，那个缓存和后面那个先看内存是否存在要更新的记录的内存是什么关系，清空缓存在更新操作哪步进行？","like_count":0},{"had_liked":false,"id":173631,"user_name":"边际革命","can_delete":false,"product_type":"c1","uid":1124665,"ip_address":"","ucode":"EC15C0AE4D487A","user_header":"https://static001.geekbang.org/account/avatar/00/11/29/39/be9d2e88.jpg","comment_is_top":false,"comment_ctime":1579623022,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1579623022","product_id":100020801,"comment_content":"refo log是innodb特有的，那其他引擎是不是就无法保障crash-safe？","like_count":0},{"had_liked":false,"id":173626,"user_name":"Sunbrella","can_delete":false,"product_type":"c1","uid":1213392,"ip_address":"","ucode":"D84E2280C00ECD","user_header":"https://static001.geekbang.org/account/avatar/00/12/83/d0/12d7f662.jpg","comment_is_top":false,"comment_ctime":1579620994,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1579620994","product_id":100020801,"comment_content":"个人认为，应该是数据量的增加速度是不是很快","like_count":0},{"had_liked":false,"id":173603,"user_name":"janemoranee","can_delete":false,"product_type":"c1","uid":1683664,"ip_address":"","ucode":"83B32648717769","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eo8NE5zPveAJ1qUbNVgdhdcicnlh6y37BUgcCPAbxOpzc6Zmia8Bryauw5ujGR0e8ICExibWDNSLH2sg/132","comment_is_top":false,"comment_ctime":1579612509,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579612509","product_id":100020801,"comment_content":"全量备份周期日备份和周备份区别和应用场景是否可以解答一下","like_count":0},{"had_liked":false,"id":173570,"user_name":"愤怒的小龙打小鸟","can_delete":false,"product_type":"c1","uid":1115909,"ip_address":"","ucode":"363AF21A33CD2C","user_header":"https://static001.geekbang.org/account/avatar/00/11/07/05/0e59855d.jpg","comment_is_top":false,"comment_ctime":1579598795,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579598795","product_id":100020801,"comment_content":"老师您好，请教一个问题：由于redo log日志可能不是立即更新到磁盘的，当查询过来的时候假设缓存已经不存在该条记录，那么查询语句会先把redo log里的记录更新到磁盘中吗？如果每次查询不把redo log的日志更新到磁盘是不是会造成查询不准确？","like_count":0},{"had_liked":false,"id":173548,"user_name":"阿甘","can_delete":false,"product_type":"c1","uid":1015919,"ip_address":"","ucode":"FE86AE1DEB43ED","user_header":"","comment_is_top":false,"comment_ctime":1579593709,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579593709","product_id":100020801,"comment_content":"写两次log 成本不更高了吗","like_count":0},{"had_liked":false,"id":173530,"user_name":"连边","can_delete":false,"product_type":"c1","uid":1391748,"ip_address":"","ucode":"54B5DA38449728","user_header":"https://static001.geekbang.org/account/avatar/00/15/3c/84/608f679b.jpg","comment_is_top":false,"comment_ctime":1579590657,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579590657","product_id":100020801,"comment_content":"原来大的软件也存在历史遗留设计问题。","like_count":0},{"had_liked":false,"id":173496,"user_name":"落月","can_delete":false,"product_type":"c1","uid":1259876,"ip_address":"","ucode":"10663079C7096F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/KYvWM0tjH8j920S32qkGMDDeRJDIg4LoqRppe74AISyhYyKmGTcia3BvDqjvibhCicx7ncGSRbQyd2phR7ZUZwR6A/132","comment_is_top":false,"comment_ctime":1579576691,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579576691","product_id":100020801,"comment_content":"比较疑问的是，直接将数据更新到磁盘比较耗时，但是对于持久化redo log和binlog到磁盘，这两个log的磁盘IO如何做到高性能的呢？log的写入不也是一个耗时的过程吗？而且为了数据一致性和崩溃恢复肯定是先写完log再更新内存数据。数据库对log的写操作由专门的处理吗？","like_count":0},{"had_liked":false,"id":173396,"user_name":"CDz","can_delete":false,"product_type":"c1","uid":1114779,"ip_address":"","ucode":"A23BEE1C4A5922","user_header":"https://static001.geekbang.org/account/avatar/00/11/02/9b/b1a3c60d.jpg","comment_is_top":false,"comment_ctime":1579523282,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579523282","product_id":100020801,"comment_content":"斌哥 看完整个更新流程后有个小疑惑<br>更新流程：<br>1 读取<br>2 返回数据<br>3 运算（c加1）<br>4 写入新行<br>5 更新缓存<br>（后省略）<br>在第4步上有点疑惑，“写入新行”是什么意思，是写入到数据库中了吗？<br>那如果后面记录日志失败了不就会在恢复的时候出错了吗？<br><br>还是这整个流程MySQL是有记录的，记录日志失败了会重试直到记录成功为止<br>就算是刚好在第5步宕机了，重启来也会记录状态从第6步开始。<br><br>不知道理解的对不对，望大神解答<br>","like_count":0},{"had_liked":false,"id":173341,"user_name":"来电","can_delete":false,"product_type":"c1","uid":1399870,"ip_address":"","ucode":"C609CE25F6DC43","user_header":"https://static001.geekbang.org/account/avatar/00/15/5c/3e/06e00378.jpg","comment_is_top":false,"comment_ctime":1579507973,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579507973","product_id":100020801,"comment_content":"如果二阶提交在最后一步commit 提交事物的时候失败了，但是binlog日志已经记录了，canal 做数据迁移的时候这条数据就是一条错误的数据。这种情况如何处理？","like_count":0},{"had_liked":false,"id":173067,"user_name":"EncodedStar","can_delete":false,"product_type":"c1","uid":1504234,"ip_address":"","ucode":"03958CA7DDD6AE","user_header":"https://static001.geekbang.org/account/avatar/00/16/f3/ea/2b2adda5.jpg","comment_is_top":false,"comment_ctime":1579419762,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579419762","product_id":100020801,"comment_content":"老师你好，我有个问题就是，<br>1.redo log存的地方，既不是磁盘，又不是内存里，那是哪里？<br>2.还有就是，后面又说了存在4个文件里，文件不就是放在磁盘里的？<br>3.redo log这个文件宕机后是不是和core文件相似啊？<br>希望老师能解惑。。<br>","like_count":0},{"had_liked":false,"id":172642,"user_name":"englefly","can_delete":false,"product_type":"c1","uid":1145907,"ip_address":"","ucode":"E3FCF19E618718","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep2gRIticwS6CiatsCiaU4QRjAODKibQevrhSciatrmd90lNIZFxywE9yyZgAxKTmWiaBSH4zZUcRIV46qQ/132","comment_is_top":false,"comment_ctime":1579242546,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579242546","product_id":100020801,"comment_content":"如果 binlog写成功，但redolog在commit的时候系统死掉，也就是binlog认为修改完成了，但redo认为修改没有commit，两者不一致，mysql怎么处理呢？","like_count":0},{"had_liked":false,"id":172304,"user_name":"immortaliii","can_delete":false,"product_type":"c1","uid":1309441,"ip_address":"","ucode":"ACF57BD721E1B8","user_header":"https://static001.geekbang.org/account/avatar/00/13/fb/01/313be8c8.jpg","comment_is_top":false,"comment_ctime":1579146404,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579146404","product_id":100020801,"comment_content":"课后题：<br>问：定期全量备份的周期“取决于系统重要性，有的是一天一备，有的是一周一备”。那么在什么场景下，一天一备会比一周一备更有优势呢？或者说，它影响了这个数据库系统的哪个指标？<br>答：我觉得数据量大的库且更新频繁的库一天一备应该有优势，这样需要恢复数据的时间会少一些。影响了数据库恢复需要的时间。","like_count":0},{"had_liked":false,"id":172281,"user_name":"Geek_9ae28f","can_delete":false,"product_type":"c1","uid":1721182,"ip_address":"","ucode":"6CFD52D02F6223","user_header":"","comment_is_top":false,"comment_ctime":1579144157,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579144157","product_id":100020801,"comment_content":"每天对数据库的操作量很大，若是每周进行备份一次，数据积累过多，日后需要数据恢复的时候，压力很大。因此需要在对数据库操作频繁的情况下，进行每天一备份","like_count":0},{"had_liked":false,"id":172103,"user_name":"李奕慧","can_delete":false,"product_type":"c1","uid":1201005,"ip_address":"","ucode":"0D8871ED38859C","user_header":"https://static001.geekbang.org/account/avatar/00/12/53/6d/c3828950.jpg","comment_is_top":false,"comment_ctime":1579089929,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579089929","product_id":100020801,"comment_content":"不明白为什么binlog不能实现safe-crash，更新 redolog 和binlog都在同一个事物里啊。所有的东西binlog也都归档了。<br><br>如果crash了 binlog里没存的 redolog 一样没存啊","like_count":0},{"had_liked":false,"id":171912,"user_name":"美美","can_delete":false,"product_type":"c1","uid":1148422,"ip_address":"","ucode":"44CC95C45AF345","user_header":"https://static001.geekbang.org/account/avatar/00/11/86/06/72b01bb7.jpg","comment_is_top":false,"comment_ctime":1579052543,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579052543","product_id":100020801,"comment_content":"有个疑问，insert into a select * from b，这种binlog怎么存的","like_count":0},{"had_liked":false,"id":171710,"user_name":"chenjisi","can_delete":false,"product_type":"c1","uid":1131397,"ip_address":"","ucode":"45EED299415FA4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLpvgEIKzR8WFhJwRichrmibMnPGBKykeznOyx7MesibSd3HlUuZSGuUqibSxebVv2dgbfovdECWkTBiag/132","comment_is_top":false,"comment_ctime":1578995030,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578995030","product_id":100020801,"comment_content":"老师，文章里面的流程里面主要是说了redolog 和binlog，但是怎么没有讲到数据是什么时候落盘的呢，<br>文中讲到数据更新到内存，写redolog就算是完了，但是数据怎么更新到磁盘没有说的，更新到磁盘跟binlog有没关系呢，如果只是两个日志两阶段提交成功了，但是数据还只是在内存里面，那么用户来查询的时候不就看不到更新结果了？","like_count":0},{"had_liked":false,"id":171698,"user_name":"烈冬冰夏","can_delete":false,"product_type":"c1","uid":1060113,"ip_address":"","ucode":"F2875FC596D4FA","user_header":"https://static001.geekbang.org/account/avatar/00/10/2d/11/0ecbe9ea.jpg","comment_is_top":false,"comment_ctime":1578992902,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578992902","product_id":100020801,"comment_content":"请教下 如果主从下 主binlog成功 commit失败时 这是不是会引起主从数据不一致呢","like_count":0},{"had_liked":false,"id":170672,"user_name":"猕猴桃","can_delete":false,"product_type":"c1","uid":1131235,"ip_address":"","ucode":"005E562CC3A9A7","user_header":"https://static001.geekbang.org/account/avatar/00/11/42/e3/bf72015f.jpg","comment_is_top":false,"comment_ctime":1578661622,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578661622","product_id":100020801,"comment_content":"老师，我理解是的redo log 相当于做一个操作记录的缓存，异步刷磁盘使用，没有归档足够的数据来进行数据恢复；而binlog就是存着近期所有的数据改动，以便恢复使用，所以为了事物一致性，必须得两阶段提交。是这样吗","like_count":0},{"had_liked":false,"id":170500,"user_name":"王圣军","can_delete":false,"product_type":"c1","uid":1395602,"ip_address":"","ucode":"1E13CF683137D1","user_header":"https://static001.geekbang.org/account/avatar/00/15/4b/92/03338a22.jpg","comment_is_top":false,"comment_ctime":1578622227,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578622227","product_id":100020801,"comment_content":"更新数据时都是写redo log和缓存数据页，然后返回。那我是不是可以认为缓存数据页一直都是和redo log保持一致的？","like_count":0},{"had_liked":false,"id":170292,"user_name":"Zhaoyang","can_delete":false,"product_type":"c1","uid":1037190,"ip_address":"","ucode":"131D83AC2566D2","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d3/86/b5d72c87.jpg","comment_is_top":false,"comment_ctime":1578562563,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578562563","product_id":100020801,"comment_content":"说个粗浅的见解，就是看数据的重要性吧。订单数据的话，备份频率还是比较高的吧。","like_count":0},{"had_liked":false,"id":170246,"user_name":"马俊dd","can_delete":false,"product_type":"c1","uid":1222894,"ip_address":"","ucode":"C42AE8685636A7","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJHCrMvBIkafmFXsjq0p5wZY4icad6hy6gTGvvlWkyh8StSGuyVp40zGRWyRW6Z5sBxtkIic4UiaCLcw/132","comment_is_top":false,"comment_ctime":1578556679,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578556679","product_id":100020801,"comment_content":"问下老师<br>用什么工具查看redo log 、binlog 日志里面的内容<br>","like_count":0},{"had_liked":false,"id":170040,"user_name":"江大神","can_delete":false,"product_type":"c1","uid":1103580,"ip_address":"","ucode":"45AE039C8E54D6","user_header":"https://static001.geekbang.org/account/avatar/00/10/d6/dc/6bb5d20a.jpg","comment_is_top":false,"comment_ctime":1578496213,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578496213","product_id":100020801,"comment_content":"两阶段提交，还有些没说明白。<br>如果在刷binlog到磁盘后，innodb提交之前，这个时间数据库挂了，数据库依靠什么判断起来之后事务是否提交？<br>答案是：数据库挂了重启后，先进行redo前滚，如果发现有事务处于prepare，但是没有commit，那就查一下binlog有没有这个事务。如果有，就提交，如果没有，就回滚。","like_count":0},{"had_liked":false,"id":169986,"user_name":"citysun2009","can_delete":false,"product_type":"c1","uid":1090468,"ip_address":"","ucode":"285AB0E13C5927","user_header":"https://static001.geekbang.org/account/avatar/00/10/a3/a4/fc9cf791.jpg","comment_is_top":false,"comment_ctime":1578489125,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578489125","product_id":100020801,"comment_content":"老师好，看过文章以及大家的留言，有个问题一直想不通，比如已经prepare了，binlog也写成功了，此时commit失败(这里不是崩溃，大家都在讨论此时崩溃的情况)，如果就是某种原因没把commit状态更新到磁盘上，那又会如何？删除binlog中已经写好的日志吗？如果删除又失败了呢？是不是这种情况概率太小，就不考虑了？","like_count":0},{"had_liked":false,"id":169706,"user_name":"Wh1","can_delete":false,"product_type":"c1","uid":1282715,"ip_address":"","ucode":"6D28506B99A285","user_header":"https://static001.geekbang.org/account/avatar/00/13/92/9b/65f98192.jpg","comment_is_top":false,"comment_ctime":1578408916,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578408916","product_id":100020801,"comment_content":"老师，我可以把redo log理解成mysql执行更新操作的缓存么。感觉和缓存的作用好像啊","like_count":0},{"had_liked":false,"id":169473,"user_name":"最初的印象","can_delete":false,"product_type":"c1","uid":1228852,"ip_address":"","ucode":"4DD68307FA274E","user_header":"https://static001.geekbang.org/account/avatar/00/12/c0/34/0574bb44.jpg","comment_is_top":false,"comment_ctime":1578362100,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578362100","product_id":100020801,"comment_content":"如果redo log的prepare成功，bin log 也成功，但最后redo log 的commit失败，那不是也有问题吗？","like_count":0},{"had_liked":false,"id":169394,"user_name":"定格温暖","can_delete":false,"product_type":"c1","uid":1315395,"ip_address":"","ucode":"FD9DF5BBA905AD","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/bpyzQkT2iaFgP2xNWnJic6X67fwVJgic5Qwm6FrSEteCh3icEbA3fydPxCOB2aCrFtFhXCoH6k46g8GfleROwib3mTw/132","comment_is_top":false,"comment_ctime":1578326142,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578326142","product_id":100020801,"comment_content":"老师您好，请教个问题<br><br>执行一条Update 语句后，马上又执行一条 select * from table limit 1。<br><br>如果刚刚update的记录，还没持久化到磁盘中，而偏偏这个时候的查询条件，又包含了刚刚update的记录。<br><br>那么这个时候，是从内存中获取刚刚update的最新结果，还是说，先把日志中的记录先写磁盘，再返回最新结果","like_count":0},{"had_liked":false,"id":169232,"user_name":"羁绊12221","can_delete":false,"product_type":"c1","uid":1463686,"ip_address":"","ucode":"15B47C5053388A","user_header":"https://static001.geekbang.org/account/avatar/00/16/55/86/ca7c94ce.jpg","comment_is_top":false,"comment_ctime":1578298111,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578298111","product_id":100020801,"comment_content":"1. MySQL 更新记录思路：WAL(write-ahead logging)，先写日志(redolog)，更新内存就算更新成功了。合适的时机再更新磁盘。<br>                       日志 -- 粉板<br>\t\t\t\t\t   磁盘 -- 账本<br>2. InnoDB 的 redo log 大小是固定的，可以配置一组 4 个，每个 1G，可以写 4G 的日志，循环写。<br>   write pos 是当前写日志的位置，checkpoint会将执行checkpoint时间点之前的日志刷入磁盘，并清除该部分的 redolog。<br>   二者之间空着的部分是可以记录操作的“粉板”。<br>   保证了数据库异常重启更新不丢失，即 crash-safe<br>   --这点跟 oracle 类似，也是循环写，但是 oracle 支持开启 redolog 归档，所以备份文件 + redolog归档可用于数据回档恢复。<br>     但是 mysql redolog 不归档，覆写后丢失，备份 + redolog，数据缺失，无法回档。但是由于binlog是追加不覆盖的写，所以备份+binlog常用于回档和数据恢复。<br>3. binlog  是 server 层逻辑日志，记录的是 SQL 语句原始逻辑，追加写不会覆盖，可用于数据恢复<br>   redolog 是存储层物理日志(InnoDB 特有的)，记录的是“某个数据页做了什么修改”，循环写会覆盖，仅用来保证 crash-safe(数据文件+redolog)<br>4. 日志的两阶段提交：写入redolog(prepare阶段) --- 写binlog --- 提交事务(commit阶段)，可以把这个流程当成一个事务，具有原子性。<br>   目的是保证 redolog 和 binlog 数据的一致性，也就是保证 crash前数据库状态、crash恢复后数据库状态、crash恢复后+binlog恢复的数据库状态  三个状态数据一致<br>5. redolog：innodb_flush_log_at_trx_commit=1 每次事务的redolog都直接从buffer持久化到磁盘，crash重启后redolog不丢失<br>   binlog：sync_binlog=1 每次事务的binlog都持久化到磁盘，crash重启后binlog不丢失<br>6. 扩展：两阶段提交是跨系统维持数据逻辑一致性的常用手段<br>7. redolog 不是记录“数据页更新之后的状态”，而是记录“数据页做了什么改动”<br>   binlog 有两种模式，statement格式记录sql，row记录更新前和更新后的行的内容<br><br>   <br>疑问：为什么不能使用数据文件+binlog做 crash-safe？将 crash-safe和数据恢复回档统一起来，这样不就省了一个redolog？","like_count":0},{"had_liked":false,"id":169156,"user_name":"SoonSei","can_delete":false,"product_type":"c1","uid":1737411,"ip_address":"","ucode":"0065327DF15B0B","user_header":"https://static001.geekbang.org/account/avatar/00/1a/82/c3/8d70a854.jpg","comment_is_top":false,"comment_ctime":1578281130,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1578281130","product_id":100020801,"comment_content":"我有一点疑惑，有没有可能redolog和binlog的持久化不同时发生，然后某一时刻，binlog持久化完成了，但是redolog尚未持久化，此时发生崩溃，然后MySQL重启时通过redolog做恢复，但是此时的redolog相较于binlog是滞后的，那这样会发生什么情况呢？","like_count":0},{"had_liked":false,"id":168716,"user_name":"景梦园","can_delete":false,"product_type":"c1","uid":1620479,"ip_address":"","ucode":"0A17708457ACB2","user_header":"https://static001.geekbang.org/account/avatar/00/18/b9/ff/ea6c2e86.jpg","comment_is_top":false,"comment_ctime":1578146005,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578146005","product_id":100020801,"comment_content":"在哪里可以解析出这两个log看看呢？","like_count":0},{"had_liked":false,"id":166924,"user_name":"Geek_b617bf","can_delete":false,"product_type":"c1","uid":1220552,"ip_address":"","ucode":"9BAFC3B184B1D2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9f/c8/0318c83e.jpg","comment_is_top":false,"comment_ctime":1577631836,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577631836","product_id":100020801,"comment_content":"老师  感觉redo log是不是类似于redis的AOF日志,bin log就是RDB呢  感觉设计思路比较相似哎","like_count":0},{"had_liked":false,"id":166000,"user_name":"沉淀","can_delete":false,"product_type":"c1","uid":1790036,"ip_address":"","ucode":"BC460D5AC78A6B","user_header":"https://static001.geekbang.org/account/avatar/00/1b/50/54/558506ee.jpg","comment_is_top":false,"comment_ctime":1577360872,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577360872","product_id":100020801,"comment_content":"老师我的理解是redo log决定当前库的数据，binlog可以就是执行的日志。只要有binlog 执行的数据就不会丢失，因为有备份了。","like_count":0},{"had_liked":false,"id":165956,"user_name":"木木","can_delete":false,"product_type":"c1","uid":1181486,"ip_address":"","ucode":"E82C58AF2604ED","user_header":"https://static001.geekbang.org/account/avatar/00/12/07/2e/878d3c92.jpg","comment_is_top":false,"comment_ctime":1577350800,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577350800","product_id":100020801,"comment_content":"看了文章和评论，我的总结是这样的：<br>InfluxDB数据库引擎独有的redo log功能，可以使数据保持一致性，为什么可以保存数据的一致性？是因为redo log配合binlog实现的。如（数据库异常重启的场景）：<br><br>场景一：redo log为prepare状态时，binlog日志没有和redo log对应，那么事务会进行回滚<br><br>场景二：redo log为prepare状态时，binlog日志和redolog对应，那么事务将会提交。<br><br>由此证明InfluxDB引擎可以保持数据的一致性。<br>那么我有个问题是：除InfluxDB引擎外，其他数据库引擎遇到数据库异常重启时，都是事务回滚的吗？","like_count":0},{"had_liked":false,"id":165894,"user_name":"zmysang","can_delete":false,"product_type":"c1","uid":1642663,"ip_address":"","ucode":"8A98057E7819DD","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/tjhOILHBAmlx6YiaTZJzqzxn1uyB6XpdvGDIZhBn127TYEcoLLzxRiaKvtVd3HllQqPx7cqf2YmibyBUgGGGJPDkw/132","comment_is_top":false,"comment_ctime":1577341724,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577341724","product_id":100020801,"comment_content":"<br>老师您好，我有两个问题：<br>1、更新语句所以会清空该表的所有查询缓存（清空的操作是在完成更新做，还是在更新之前？？）<br>2、如果有更新时，此时发现日志写满了，就先停下来先将之前的记录写磁盘，然后再将更新写入日志。（这里的疑问：如果是在更新写入redo log之前，才会判断redo log是否已满，那么也会将当次更新直接就写入磁盘吗？如果不的话为什么呢？另外为什么不选择在每次更新完成时判断此时redo log是否已满，然后将日志的内容都写入磁盘，这样好像对请求延迟造成的影响会小一点）。","like_count":0},{"had_liked":false,"id":165645,"user_name":"Geek_55e386","can_delete":false,"product_type":"c1","uid":1795793,"ip_address":"","ucode":"5A727F1323C2D0","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/zxkns28cIAUZIt3WjDb8G26qiccT84d9GMr9ZpbYR60TU1ibqSj9NoYVHlJvGF1kOltkqNDmEfJCqPuYVkue3WHg/132","comment_is_top":false,"comment_ctime":1577275274,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577275274","product_id":100020801,"comment_content":"老师，我想知道 redo Log 最后一步没有提交事务的时候出错。<br>这时候binlog也会回退吗？","like_count":0},{"had_liked":false,"id":164684,"user_name":"along","can_delete":false,"product_type":"c1","uid":1118419,"ip_address":"","ucode":"0F44495219E0BC","user_header":"https://static001.geekbang.org/account/avatar/00/11/10/d3/157068af.jpg","comment_is_top":false,"comment_ctime":1577071799,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577071799","product_id":100020801,"comment_content":"1. redo log本身不就是日志么，设置innodb_flush_log_at_trx_commit为1是不是来保证事务完整性呢？还并不是保证事务丢失？<br>2. 数据页在内存中，此处的内存管理方式，是跟linuk的内存页的管理方式一致么？","like_count":0},{"had_liked":false,"id":164457,"user_name":"c340","can_delete":false,"product_type":"c1","uid":1111176,"ip_address":"","ucode":"D64CC3DDD09A0F","user_header":"https://static001.geekbang.org/account/avatar/00/10/f4/88/133bc14b.jpg","comment_is_top":false,"comment_ctime":1576997489,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1576997489","product_id":100020801,"comment_content":"两阶段提交，如果在binlog写完之后，redo日志状态更新为commit的时候崩了，不也是不一致吗？虽然语句都在，但是没有commit状态，这个日志也不完整啊","like_count":0},{"had_liked":false,"id":163180,"user_name":"terryking","can_delete":false,"product_type":"c1","uid":1012371,"ip_address":"","ucode":"39433F06D6BEF6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/72/93/46895883.jpg","comment_is_top":false,"comment_ctime":1576666565,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576666565","product_id":100020801,"comment_content":"老师，你好，看了这篇讲解之后对于MySQL又有了进一步的认识，看完之后，有一点疑问，麻烦有时间帮忙解答一下，如果redo-log已经写入了，但是bin-log还没写的时候就crash了，那么redo-log也是不会写入到物理存储里面的，这样确实可以保证数据的一致性，但是对于该更新操作是不是就丢失了？","like_count":0},{"had_liked":false,"id":163099,"user_name":"陶希阳","can_delete":false,"product_type":"c1","uid":1131314,"ip_address":"","ucode":"3BED65B051924C","user_header":"https://static001.geekbang.org/account/avatar/00/11/43/32/0b81fc39.jpg","comment_is_top":false,"comment_ctime":1576656427,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576656427","product_id":100020801,"comment_content":"老师，如果一个事物更新了多行记录，redo log写完成，binlog写了部分只记录了部分行的binlog，这个时候服务crash了，事物回滚的话，已经写了部分的binlog会删除吗？如果不删除，会造成不一致吗？","like_count":0},{"had_liked":false,"id":162688,"user_name":"ʘᴗʘ小白帽ʘᴗʘ","can_delete":false,"product_type":"c1","uid":1304567,"ip_address":"","ucode":"3519C67C3B1533","user_header":"https://static001.geekbang.org/account/avatar/00/13/e7/f7/8427bb06.jpg","comment_is_top":false,"comment_ctime":1576578597,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576578597","product_id":100020801,"comment_content":"老师您好，请问，如果一条update sql语句执行后，什么也没修改，mysql会记录binlog日志么？","like_count":0},{"had_liked":false,"id":162530,"user_name":"joseph.herder💭.","can_delete":false,"product_type":"c1","uid":1006963,"ip_address":"","ucode":"632A743D6B7355","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5d/73/742097e2.jpg","comment_is_top":false,"comment_ctime":1576549927,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1576549927","product_id":100020801,"comment_content":"POLARDB默认不记录binlog是什么原理？","like_count":0},{"had_liked":false,"id":162387,"user_name":"Skysper","can_delete":false,"product_type":"c1","uid":1058800,"ip_address":"","ucode":"164B3CAF81A7C5","user_header":"https://static001.geekbang.org/account/avatar/00/10/27/f0/06ecce19.jpg","comment_is_top":false,"comment_ctime":1576507534,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576507534","product_id":100020801,"comment_content":"如果redo log 第一阶段写成功 binlog写成功 这时候系统重启 redolog第二阶段提交失败 此时系统恢复时会怎样？","like_count":0},{"had_liked":false,"id":162185,"user_name":"惜昔","can_delete":false,"product_type":"c1","uid":1441589,"ip_address":"","ucode":"B3478E40B612FC","user_header":"https://static001.geekbang.org/account/avatar/00/15/ff/35/b744c027.jpg","comment_is_top":false,"comment_ctime":1576473128,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576473128","product_id":100020801,"comment_content":"老师 同样是写入磁盘 为啥更新的时候写的是binlog和redo log 与直接将记录写入磁盘相比有啥优势","like_count":0},{"had_liked":false,"id":161533,"user_name":"卑鄙的我","can_delete":false,"product_type":"c1","uid":1762825,"ip_address":"","ucode":"8809F55437BC7E","user_header":"https://static001.geekbang.org/account/avatar/00/1a/e6/09/2d4f564f.jpg","comment_is_top":false,"comment_ctime":1576224896,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576224896","product_id":100020801,"comment_content":"只依靠 binlog 是没有 crash-safe 能力的吗，还是说是由于MyISAM引擎的缘故呢","like_count":0},{"had_liked":false,"id":160488,"user_name":"湯尼陳","can_delete":false,"product_type":"c1","uid":1607276,"ip_address":"","ucode":"7C787DB9FBCA37","user_header":"https://static001.geekbang.org/account/avatar/00/18/86/6c/b4f41f88.jpg","comment_is_top":false,"comment_ctime":1575962237,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575962237","product_id":100020801,"comment_content":"老師好！如果拔電源的一刻，redo log沒有刷新的文件，那麼重啟後，是不是就不能恢復了？因為內存數據不在了.","like_count":0},{"had_liked":false,"id":158176,"user_name":"朕爱吾妃","can_delete":false,"product_type":"c1","uid":1733692,"ip_address":"","ucode":"B10EB69934F9E2","user_header":"https://static001.geekbang.org/account/avatar/00/1a/74/3c/da79d2a1.jpg","comment_is_top":false,"comment_ctime":1575342117,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575342117","product_id":100020801,"comment_content":"思考题：<br>我认为一天一备对于灾后恢复帮助要比一周一备要好一点，假如距离上次备份已经将近一周了，这时候出现了问题，那么就需要加载上次也就是将近7天前的数据，那么这7天的数据就需要通过binlog来恢复，而且我也觉得和Redis AOF的性质是一样的，如果需要通过binlog恢复的数据很多，或是binlog执行的操作很多，那么MySQL的恢复期会很长，毕竟要像执行sql一样，一句一句执行不如直接将数据加载到数据库中来的暴力直接速度快","like_count":0},{"had_liked":false,"id":158120,"user_name":"请叫我紫皮书","can_delete":false,"product_type":"c1","uid":1203288,"ip_address":"","ucode":"29F98AB3A5D98E","user_header":"https://static001.geekbang.org/account/avatar/00/12/5c/58/590d0a43.jpg","comment_is_top":false,"comment_ctime":1575335113,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575335113","product_id":100020801,"comment_content":"老师，我这里有一个疑问，如果在两阶段提交的第二个阶段提交过程数据库崩溃了，那是不是也会出现上面第二种情况的问题，也就是先写 binlog 后写 redo log出现的问题？","like_count":0},{"had_liked":false,"id":158105,"user_name":"Sic Pavis","can_delete":false,"product_type":"c1","uid":1106088,"ip_address":"","ucode":"48B5F0118347C8","user_header":"https://static001.geekbang.org/account/avatar/00/10/e0/a8/4e739cf6.jpg","comment_is_top":false,"comment_ctime":1575333681,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575333681","product_id":100020801,"comment_content":"redo log 用于保证 crash-safe 能力。innodb_flush_log_at_trx_commit 这个参数设置成 1 的时候，表示每次事务的 redo log 都直接持久化到磁盘。这个参数我建议你设置成 1，这样可以保证 MySQL 异常重启之后数据不丢失。<br>sync_binlog 这个参数设置成 1 的时候，表示每次事务的 binlog 都持久化到磁盘。这个参数我也建议你设置成 1，这样可以保证 MySQL 异常重启之后 binlog 不丢失。<br><br>如果每条log都直接持久化到磁盘，难道不会给数据库磁盘造成很大写入压力吗？","like_count":0},{"had_liked":false,"id":157814,"user_name":"PhilZhang","can_delete":false,"product_type":"c1","uid":1088010,"ip_address":"","ucode":"383F1A792C7DF9","user_header":"https://static001.geekbang.org/account/avatar/00/10/9a/0a/922615cf.jpg","comment_is_top":false,"comment_ctime":1575263794,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575263794","product_id":100020801,"comment_content":"redo log的作用就是innodb的一个缓存，可以这样理解呗","like_count":0},{"had_liked":false,"id":157287,"user_name":"nul","can_delete":false,"product_type":"c1","uid":1043499,"ip_address":"","ucode":"2DBF03B2193B76","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ec/2b/1e059a0f.jpg","comment_is_top":false,"comment_ctime":1575103168,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575103168","product_id":100020801,"comment_content":"看懵了，redo 是指黑板，binlog 指账本？ 那为什么最后一个图提交事务前会写binlog ? 那不是相当于记账时要写redo 还要写binlog 才行？","like_count":0},{"had_liked":false,"id":157272,"user_name":"凡凡是谁爹","can_delete":false,"product_type":"c1","uid":1762093,"ip_address":"","ucode":"FC902F6A76B7CC","user_header":"https://static001.geekbang.org/account/avatar/00/1a/e3/2d/0f8ee254.jpg","comment_is_top":false,"comment_ctime":1575101034,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575101034","product_id":100020801,"comment_content":"老师，文章中没介绍什么叫binlog的归档功能？没理解都是记两份日志，redolog只是保证重启不丢数据？binlog是用来恢复库的？是这样吗？","like_count":0},{"had_liked":false,"id":157026,"user_name":"liuchen","can_delete":false,"product_type":"c1","uid":1313735,"ip_address":"","ucode":"B49339881A018B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/JkY0hxE5l8K6FcGO5sJsq85CTCWia7y6fNETJ2KInniagYYbQClXoBlozsnt91YvUKn7VUbGlnibvxiaJXA3rCOAibg/132","comment_is_top":false,"comment_ctime":1575014814,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575014814","product_id":100020801,"comment_content":"redo log保证了crash-safe的能力，由于redo log的文件空间小，所以不能保证记录很久以前的操作。<br><br>binlog保证了恢复数据库的能力，由于binlog记录每一次的操作，当数据库需要恢复到以前的某个时刻时，从最近的一次备份，然后恢复binLog日志操作就可以恢复到某个时刻。<br><br>为了保证redo log 和 binlog记录的一致性，必须使用两阶段提交，这样就保证了redo log 和 binlog不会出现记录不一致的情况（就是一个写了一个没写）。","like_count":0},{"had_liked":false,"id":156465,"user_name":"雨夜星辰","can_delete":false,"product_type":"c1","uid":1007251,"ip_address":"","ucode":"C956006FBB22E4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5e/93/f9e9f358.jpg","comment_is_top":false,"comment_ctime":1574898005,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1574898005","product_id":100020801,"comment_content":"我在想一个问题，redo为什么不设计成持久化呢？如果设计成这样，是不是binlog存在的意义就不大了，当然有个前提是只使用InnoDb引擎","like_count":0,"discussions":[{"author":{"id":1007251,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/93/f9e9f358.jpg","nickname":"雨夜星辰","note":"","ucode":"C956006FBB22E4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":63725,"discussion_content":"自问自答一下，考虑到以前的机械硬盘读写速度，所以先写日志，再写硬盘是一种很好的解决方案，但随着现在固态硬盘的普及，MySQL也要伴随着发生读写机制的变化","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574905524,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":156082,"user_name":"anker","can_delete":false,"product_type":"c1","uid":1218937,"ip_address":"","ucode":"6EDF1FB9D45238","user_header":"https://static001.geekbang.org/account/avatar/00/12/99/79/74d4f24f.jpg","comment_is_top":false,"comment_ctime":1574818066,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574818066","product_id":100020801,"comment_content":"有一个疑问，binlog 没写完就 crash的话，在主从模式下，主库重启倒是能恢复，但是从库数据是否就会的丢失","like_count":0},{"had_liked":false,"id":155976,"user_name":"can","can_delete":false,"product_type":"c1","uid":1399641,"ip_address":"","ucode":"C63D5F0141D680","user_header":"https://static001.geekbang.org/account/avatar/00/15/5b/59/56827d05.jpg","comment_is_top":false,"comment_ctime":1574786524,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574786524","product_id":100020801,"comment_content":"redo log是循环写入的，那肯定只存有部分数据，那怎么还能用于崩溃恢复呢？不是就缺少数据了么","like_count":0},{"had_liked":false,"id":155856,"user_name":"aven","can_delete":false,"product_type":"c1","uid":1219825,"ip_address":"","ucode":"BBA903948322F2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9c/f1/fd21e69a.jpg","comment_is_top":false,"comment_ctime":1574768659,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574768659","product_id":100020801,"comment_content":"redo log和binlog的提交是事务提交吗？如果不是的话，那假设binlog完成了，在提交redo logcrash时，如何统一呢？","like_count":0},{"had_liked":false,"id":154525,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1574474242,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574474242","product_id":100020801,"comment_content":"1、redo log为什么能支持crash-safe，而bin-log不支持呢？<br>2、redo log 是物理日志，记录的是“在某个数据页上做了什么修改”；binlog 是逻辑日志，记录的是这个语句的原始逻辑，比如“给 ID=2 这一行的 c 字段加 1 ”。能否这样理解：物理日志记录了将id=2这条记录的c设置为2（假设原值1），逻辑日志直接记录了sql脚本","like_count":0},{"had_liked":false,"id":154288,"user_name":"三丰","can_delete":false,"product_type":"c1","uid":1310187,"ip_address":"","ucode":"CA69A069D3061D","user_header":"","comment_is_top":false,"comment_ctime":1574404643,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574404643","product_id":100020801,"comment_content":"老师，现在8.0默认数据引擎都改成了innodb了，是不是可以改成只要innodb就可以了呢，而binlog可以像oracle这样由redo来做归档。<br>在生产中由于binlog的存在，都不敢在生产中做大事务，很大原因是怕大量的binlog的写入导致整个数据库的操作变慢了。","like_count":0},{"had_liked":false,"id":153758,"user_name":"Cosmicx900827","can_delete":false,"product_type":"c1","uid":1711957,"ip_address":"","ucode":"A337063ABBB1D5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIs2r0zgqD67le9oF4Q4nw3Ox9rgPJRSN9QYnv0hXyS2PURb7Y5BWYl4AG8h4gqicMWAwgXibVu7OGA/132","comment_is_top":false,"comment_ctime":1574303300,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574303300","product_id":100020801,"comment_content":"redolog和binlog其实也只能解决mysl服务的突然crash，但是如果是服务器突然crash（比如突然断电），也是可能无法完全恢复。因为日志记录即使都改为1次修改就写入，可由于操作系统对文件系统的缓存，还是会存在最后的部分日志没有写入到磁盘文件，可以这么理解吧？","like_count":0},{"had_liked":false,"id":152053,"user_name":"小鬼","can_delete":false,"product_type":"c1","uid":1315049,"ip_address":"","ucode":"52EE8A18B90C6D","user_header":"https://static001.geekbang.org/account/avatar/00/14/10/e9/f5e55ccf.jpg","comment_is_top":false,"comment_ctime":1573866126,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573866126","product_id":100020801,"comment_content":"老师我想问下如果在两次日志之间mysql挂了会出现什么问题啊？","like_count":0},{"had_liked":false,"id":151980,"user_name":"W","can_delete":false,"product_type":"c1","uid":1565949,"ip_address":"","ucode":"C500B4113258F7","user_header":"https://static001.geekbang.org/account/avatar/00/17/e4/fd/3bf6d263.jpg","comment_is_top":false,"comment_ctime":1573826908,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573826908","product_id":100020801,"comment_content":"有个问题想请教下老师，更新操作为什么是先写内存再写日志(redo binlog)呢？如果在写内存和日志之间有读取该数据操作，随后崩溃日志写失败，恢复后没有这条记录，不就数据不一致了吗？或者说写完日志后内存的数据才能被读取？还望老师解惑","like_count":0},{"had_liked":false,"id":151974,"user_name":"Vincent","can_delete":false,"product_type":"c1","uid":1110967,"ip_address":"","ucode":"A14BA4C418315F","user_header":"https://static001.geekbang.org/account/avatar/00/10/f3/b7/d7377f0c.jpg","comment_is_top":false,"comment_ctime":1573825330,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573825330","product_id":100020801,"comment_content":"如果redo log的commit失败，binlog是如何回滚的?如果有主从，binlog在回滚之前已经将binlog同步到从库了，这时候怎么回滚?<br><br>光大的人名群众，哪位大佬可以帮忙解答一下。","like_count":0},{"had_liked":false,"id":151914,"user_name":"陈豪","can_delete":false,"product_type":"c1","uid":1608347,"ip_address":"","ucode":"3086C5D4A8CB37","user_header":"https://static001.geekbang.org/account/avatar/00/18/8a/9b/7f46472c.jpg","comment_is_top":false,"comment_ctime":1573811945,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573811945","product_id":100020801,"comment_content":"redo log, 是环形记录日志，如果已存的数据大于存储空间，会把之前的删除，把新的加上，<br>innoDB 就可以保证即使数据库发生异常重启（这句话不是很理解，就算没有redo log也可以通过binlog来保证数据不丢失呀)，我理解存redo log日志，效率比较高。 如果重启电脑好像，我个人没感觉到他的其它的作用。","like_count":0},{"had_liked":false,"id":151815,"user_name":"Geek_18b762","can_delete":false,"product_type":"c1","uid":1691227,"ip_address":"","ucode":"559785A91A1AE2","user_header":"","comment_is_top":false,"comment_ctime":1573796153,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573796153","product_id":100020801,"comment_content":"Redo log为啥必须循环写，也是顺序写不行吗？担心用不可控制的磁盘空间？","like_count":0},{"had_liked":false,"id":151408,"user_name":"嘟嘟熊","can_delete":false,"product_type":"c1","uid":1361018,"ip_address":"","ucode":"8478242F5BD2C5","user_header":"https://static001.geekbang.org/account/avatar/00/14/c4/7a/97b18989.jpg","comment_is_top":false,"comment_ctime":1573714336,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573714336","product_id":100020801,"comment_content":"redo log加上磁盘上的旧数据是数据库数据的最新状态，即redo log加磁盘数据源能恢复数据库在crash之间的最新状态，我认为理论上，binlog也可以恢复数据库到最新的状态，但是应该需要知道在crash时redo log对应于binlog的内容，知道了这部分内容，也可以用bin log实现crash safe，但是这部分应该是比较难获得的，最简单的方法时使用binlog和最近一次的全备份来实现。不知道这样理解对不对 ","like_count":0},{"had_liked":false,"id":150472,"user_name":"Geek_b617bf","can_delete":false,"product_type":"c1","uid":1220552,"ip_address":"","ucode":"9BAFC3B184B1D2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9f/c8/0318c83e.jpg","comment_is_top":false,"comment_ctime":1573542189,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573542189","product_id":100020801,"comment_content":"跟rdb与aof有几分相似呀","like_count":0},{"had_liked":false,"id":149238,"user_name":"长期规划","can_delete":false,"product_type":"c1","uid":1019332,"ip_address":"","ucode":"5EF65E9115834B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","comment_is_top":false,"comment_ctime":1573177664,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573177664","product_id":100020801,"comment_content":"老师，关于两阶段提交，我有个疑问。我感觉不用两阶段提交，也能保证一致性吧。比如先写redo log，后写binlog，若在写完redo log后异常重启，重启后检查redo log有数据，此时，再检查binlog发现没有记录，那就再写binlog，然后再commit。这样不就可以了吗","like_count":0},{"had_liked":false,"id":149200,"user_name":"长期规划","can_delete":false,"product_type":"c1","uid":1019332,"ip_address":"","ucode":"5EF65E9115834B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","comment_is_top":false,"comment_ctime":1573175053,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573175053","product_id":100020801,"comment_content":"老师，我理解异常重房时会用redolog+binlog决定数据最终状态，而备份时，是把主库binlog重放到另一个库，并没同步redolog，我理解另一个库启动时redolog为空，即数据只由binlog决定。要保证两库数据一致，就要redolog和binlog一致","like_count":0},{"had_liked":false,"id":148510,"user_name":"Geek_3004e0","can_delete":false,"product_type":"c1","uid":1732823,"ip_address":"","ucode":"441D39BDC39E4A","user_header":"https://static001.geekbang.org/account/avatar/00/1a/70/d7/d1049bae.jpg","comment_is_top":false,"comment_ctime":1573022827,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573022827","product_id":100020801,"comment_content":"还有关于binlog的，看到除了binlog_format，还有个参数binlog_row_image影响binlog记录的详细程度。为full的时候才会把修改前后所有列的数据都记录。但是测试时发现此参数即使设置为full，直接drop table也只记录sql语句，没有每行的原始数据。应该也没法用binlog恢复吧？","like_count":0},{"had_liked":false,"id":148508,"user_name":"Geek_3004e0","can_delete":false,"product_type":"c1","uid":1732823,"ip_address":"","ucode":"441D39BDC39E4A","user_header":"https://static001.geekbang.org/account/avatar/00/1a/70/d7/d1049bae.jpg","comment_is_top":false,"comment_ctime":1573022225,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573022225","product_id":100020801,"comment_content":"感谢丁老师，想问下，redo log是滚动更新的，增加redo log文件的大小跟调整redo log文件的个数效果一样吗？","like_count":0},{"had_liked":false,"id":148054,"user_name":"云师兄","can_delete":false,"product_type":"c1","uid":1205777,"ip_address":"","ucode":"EB19F80070FE23","user_header":"https://static001.geekbang.org/account/avatar/00/12/66/11/f7408e3e.jpg","comment_is_top":false,"comment_ctime":1572933467,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572933467","product_id":100020801,"comment_content":"业务系统中日志一般是作为一种监控手段而存在。但数据库中因其访问频次大，其本质是内存和硬盘的速度不一致，因而会影响吞吐率。<br>在增删改时需要“缓存机制”log是一种很好的弥补手段。binlog记录修改语句，redolog记录修改信息及提供crash-safe。<br>不过这种双日志带来的问题就是两阶段提交，本质还是保证其逻辑的一致性。<br>这种机制其实在系统中也存在，在write文件后数据只是记录在内存页中。在操作系统调度时才真正写入磁盘。","like_count":0},{"had_liked":false,"id":146599,"user_name":"行者","can_delete":false,"product_type":"c1","uid":1618607,"ip_address":"","ucode":"8179D167D99CB9","user_header":"https://static001.geekbang.org/account/avatar/00/18/b2/af/81303f5a.jpg","comment_is_top":false,"comment_ctime":1572578498,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572578498","product_id":100020801,"comment_content":"个人觉得理解为什么需要两阶段提交，可以类比理解为什么建立tcp连接需要三次握手，就很容易知道原因","like_count":0},{"had_liked":false,"id":146574,"user_name":"InfoQ_0ef441e6756e","can_delete":false,"product_type":"c1","uid":1438521,"ip_address":"","ucode":"F1E750A5472FE2","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLTPmSgD6QSgicqsbzibiau9xWSYgdsvYlnVWBg91ibHQBYg39MT4O3AV5CHlJlVUvw9Ks9TZEmRvicfTw/132","comment_is_top":false,"comment_ctime":1572575438,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572575438","product_id":100020801,"comment_content":"老师，两阶段提交bin log成功后，commit redo的时候crash会发生什么？binlog写进去了而redo没有？","like_count":0},{"had_liked":false,"id":146357,"user_name":"敲代码的老王","can_delete":false,"product_type":"c1","uid":1042444,"ip_address":"","ucode":"B641FB945F0C04","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e8/0c/870d2de4.jpg","comment_is_top":false,"comment_ctime":1572505018,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572505018","product_id":100020801,"comment_content":"redolog跟binlog都每次都写磁盘，性能是不是会很低呢？redis的aof可以选择是一秒写一次磁盘，还是每次都写，还是交给操作系统。","like_count":0},{"had_liked":false,"id":146140,"user_name":"Knuth","can_delete":false,"product_type":"c1","uid":1083616,"ip_address":"","ucode":"21298EF9BBB91A","user_header":"https://static001.geekbang.org/account/avatar/00/10/88/e0/292508a4.jpg","comment_is_top":false,"comment_ctime":1572439305,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572439305","product_id":100020801,"comment_content":"另外如果在第一次写入undo log的时候机器挂了导致写入失败，这个时候怎么处理呢","like_count":0},{"had_liked":false,"id":146136,"user_name":"Knuth","can_delete":false,"product_type":"c1","uid":1083616,"ip_address":"","ucode":"21298EF9BBB91A","user_header":"https://static001.geekbang.org/account/avatar/00/10/88/e0/292508a4.jpg","comment_is_top":false,"comment_ctime":1572439166,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572439166","product_id":100020801,"comment_content":"是不是讲漏了一点，如果redo log成功但是binlog失败，是需要回滚redo log的记录呢还是对binlog的一直重试？","like_count":0},{"had_liked":false,"id":146051,"user_name":"冰","can_delete":false,"product_type":"c1","uid":1689211,"ip_address":"","ucode":"1351EFB1E36FBD","user_header":"https://static001.geekbang.org/account/avatar/00/19/c6/7b/bdaf52cb.jpg","comment_is_top":false,"comment_ctime":1572424987,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572424987","product_id":100020801,"comment_content":"老师我有个问题<br>mysql查询缓存在有更新语句执行的时候，是在什么时候清空的，在接收器、分析器、优化器、还是binlog 提交的时候？<br>","like_count":0},{"had_liked":false,"id":145898,"user_name":"爱上飞飞的面码","can_delete":false,"product_type":"c1","uid":1102362,"ip_address":"","ucode":"3399E3DC30776E","user_header":"https://static001.geekbang.org/account/avatar/00/10/d2/1a/19365924.jpg","comment_is_top":false,"comment_ctime":1572400258,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572400258","product_id":100020801,"comment_content":"如果binlog写入了，事务提交失败了怎么办？","like_count":0},{"had_liked":false,"id":145064,"user_name":"欧阳","can_delete":false,"product_type":"c1","uid":1086986,"ip_address":"","ucode":"A72179D45213F6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqqj7ickh69y1Biau8xG4ogXA8ibqxpia69CiaQAQ6lqO0Qb9ujxiacAJq6ZwbzxmvgyQkuNwWaRUCXsYzA/132","comment_is_top":false,"comment_ctime":1572178053,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572178053","product_id":100020801,"comment_content":"请问下如果redo log的commit失败了 会怎么样呢？貌似还是保证不了redolog和binlog的一致性","like_count":0},{"had_liked":false,"id":144985,"user_name":"ray","can_delete":false,"product_type":"c1","uid":1717235,"ip_address":"","ucode":"10962C711CBC11","user_header":"","comment_is_top":false,"comment_ctime":1572149670,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572149670","product_id":100020801,"comment_content":"老師您好，<br>請問老師數據庫在更新數據，從取id=2開始（參照上圖），一直到最後一步commit跑出結果成功或失敗時。中間任何一個步驟如果server發生crash，server重啟之後，都會從該步驟繼續往下執行嗎？<br><br>謝謝老師^^","like_count":0},{"had_liked":false,"id":144657,"user_name":"路上","can_delete":false,"product_type":"c1","uid":1201805,"ip_address":"","ucode":"EA5E1305712854","user_header":"https://static001.geekbang.org/account/avatar/00/12/56/8d/fdcf3800.jpg","comment_is_top":false,"comment_ctime":1571991028,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571991028","product_id":100020801,"comment_content":"老师好，这里有个疑问：<br>redo log处于prepare阶段，binlog落盘完成的时刻，这个时候的处于preapre的redo log应该是并未完成落盘<br>此时数据库服务器故障重启，这里是完成事物的重新提交还是回滚事物？","like_count":0},{"had_liked":false,"id":144224,"user_name":"柳树","can_delete":false,"product_type":"c1","uid":1025223,"ip_address":"","ucode":"F03249D4534BCB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a4/c7/d1ee69c6.jpg","comment_is_top":false,"comment_ctime":1571880588,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571880588","product_id":100020801,"comment_content":"总结一下：<br>bin log 提供了归档数据、主从间复制数据的能力，属于 Mysql Server 层中的执行器，<br>而 redo log 除了通过 WAL 提升写性能，更重要的是提供了奔溃后恢复数据的能力，这块属于 innodb 引擎层。<br>而为了保证通过 bin log 还原或者复制出来的数据，和 redo log 恢复出来的数据，保持一致，才有了「两阶段提交」<br>这就是这篇文章的思路，非常有逻辑（不过我看了好多遍才梳理出来 - -）<br>另外有一点挺好奇，就像那张 update 语句执行流程图画的，有的是在 server 层执行，有的是在引擎层，而且是交替执行的，这个是 innodb 通过 server 层的扩展点实现的逻辑么，还是用其他方式实现的？<br>","like_count":0},{"had_liked":false,"id":143667,"user_name":"Fs","can_delete":false,"product_type":"c1","uid":1083184,"ip_address":"","ucode":"0AD0EFB5544B9A","user_header":"https://static001.geekbang.org/account/avatar/00/10/87/30/4626c8c0.jpg","comment_is_top":false,"comment_ctime":1571753776,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571753776","product_id":100020801,"comment_content":"其实其他数据库也有类似的概念<br>cassandra&#47;mongo&#47;es <br>https:&#47;&#47;fangzhang.blog.csdn.net&#47;article&#47;details&#47;97500732","like_count":0},{"had_liked":false,"id":143619,"user_name":"Geek_429275","can_delete":false,"product_type":"c1","uid":1693722,"ip_address":"","ucode":"8ABECBAD4B5D2C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIejMaMMuQw6eicRKNltDR9hemYSuWfKwr73nITK3nQVZncAputPZFWdUxZ1NflbZ7wmenVz2MCkFw/132","comment_is_top":false,"comment_ctime":1571745723,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571745723","product_id":100020801,"comment_content":"老师你好，我有个疑问，如果引擎将更新后的数据写入redo log，引擎还没有闲下来将更改更新到表中，这时候查询这条数据，是从redo log查？","like_count":0},{"had_liked":false,"id":142913,"user_name":"龙眼Tree","can_delete":false,"product_type":"c1","uid":1166123,"ip_address":"","ucode":"96923500E931F8","user_header":"https://static001.geekbang.org/account/avatar/00/11/cb/2b/3bc87c1f.jpg","comment_is_top":false,"comment_ctime":1571583108,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571583108","product_id":100020801,"comment_content":"读了整片文章，有一个疑问。感觉iinnodb引擎的引入是不是把备份恢复搞得太复杂了，能不能就只保存binlog，为了兼容innodb的日志，实现一个binlog转换为redolog的工具即可。刚接触mysql，可能很多东西还不了解，希望作者解答","like_count":0},{"had_liked":false,"id":142760,"user_name":"xinglichea","can_delete":false,"product_type":"c1","uid":1176447,"ip_address":"","ucode":"986DA07BF3CA89","user_header":"https://static001.geekbang.org/account/avatar/00/11/f3/7f/2dd9409b.jpg","comment_is_top":false,"comment_ctime":1571495977,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571495977","product_id":100020801,"comment_content":"请问老师，两阶段提交，MySQL在事务commit之前发生了crash，redo log buffer中的数据没来的急被刷到磁盘，但binglog是写成功了，此时备份恢复的数据与重启恢复会出现数据不一致吧","like_count":0},{"had_liked":false,"id":141388,"user_name":"困到清醒","can_delete":false,"product_type":"c1","uid":1384381,"ip_address":"","ucode":"1CD20C408C0BC9","user_header":"https://static001.geekbang.org/account/avatar/00/15/1f/bd/04100cb4.jpg","comment_is_top":false,"comment_ctime":1571147175,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1571147175","product_id":100020801,"comment_content":"有两个阶段，prepare和commit，我可以将它跟git远程仓库对比理解，git add之后还需要git commit，才是真正的提交。","like_count":0},{"had_liked":false,"id":141070,"user_name":"chjxbt","can_delete":false,"product_type":"c1","uid":1485031,"ip_address":"","ucode":"FDE1D416A7BFB8","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK9TicPMurialE1rG8zxZtiaChTlRv2ZHmUBCcbe9Dk8puSPBLmWRJRVQm7eom160dzz6NujqxszSjPg/132","comment_is_top":false,"comment_ctime":1571109364,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571109364","product_id":100020801,"comment_content":"想问一下，redo log是在系统比较空闲的时候才写入磁盘，那这时如果修改还没有写入磁盘，有个查询，那查询的结果是修改前的，还是修改后的。查询的时候， 查的是磁盘的数据这个没错吧？？","like_count":0},{"had_liked":false,"id":141051,"user_name":"飞翔","can_delete":false,"product_type":"c1","uid":1068571,"ip_address":"","ucode":"65AF6AF292DAD6","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/1b/f4b786b9.jpg","comment_is_top":false,"comment_ctime":1571107367,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1571107367","product_id":100020801,"comment_content":"binlog和redo log 都是wal是嘛","like_count":0},{"had_liked":false,"id":140053,"user_name":"Mr.miaoCoder","can_delete":false,"product_type":"c1","uid":1178246,"ip_address":"","ucode":"0FFE4DF00E08F9","user_header":"https://static001.geekbang.org/account/avatar/00/11/fa/86/47e39fb4.jpg","comment_is_top":false,"comment_ctime":1570797116,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570797116","product_id":100020801,"comment_content":"老师为啥不写undolog","like_count":0},{"had_liked":false,"id":139797,"user_name":"Harvey","can_delete":false,"product_type":"c1","uid":1682672,"ip_address":"","ucode":"AB529F37D31335","user_header":"https://static001.geekbang.org/account/avatar/00/19/ac/f0/78ee760d.jpg","comment_is_top":false,"comment_ctime":1570733108,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570733108","product_id":100020801,"comment_content":"redo log 是innode 引擎独有的，binlog是Mysql server层通用归档日志，我之前想的一点是，为啥不能用一个日志系统实现crash-safe和数据备份的场景？  Mysql 场景下，是因为现有的binlog,但binlog又是在server层而非在引擎层，即binlog只能对业务逻辑进行归档，无法强保证引擎层执行成功。那么在redo log上进行升级，即让redo log 拥有binlog的的归档能力（业务逻辑和数据引擎耦合在一起了哈）就可以规避二阶段提交的问题了吧，只不过是实现上太过urgly。","like_count":0},{"had_liked":false,"id":139507,"user_name":"Stpid_Wolf","can_delete":false,"product_type":"c1","uid":1055278,"ip_address":"","ucode":"EC3FBC6B227AE9","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Y5U2ADUvruWhziaB4tSyiaAJ98ib4ItfBe5SzcsZFNWQwmEicMIKyfPawGRxmhCgX0WASp5GibIHWJSwN0pMJKOs9wQ/132","comment_is_top":false,"comment_ctime":1570670259,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570670259","product_id":100020801,"comment_content":"想问下,在执行某条更新语句后,会不会出现由于redo log的“账本核算”的过程比较慢,导致新的查询语句查询到的是“账本核算”前的旧数据?","like_count":0},{"had_liked":false,"id":139297,"user_name":"傻傻的帅","can_delete":false,"product_type":"c1","uid":1668617,"ip_address":"","ucode":"14A795523A682E","user_header":"https://static001.geekbang.org/account/avatar/00/19/76/09/62a10668.jpg","comment_is_top":false,"comment_ctime":1570605290,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570605290","product_id":100020801,"comment_content":"binlog是在server层实现的，类似一个操作日志功能，针对所有的存储引擎；而redo log是innodb存储引擎所特有的，用于实现crash-safe和提升IO性能；binlog是mysql之前就有的功能，为了保证数据的一致性,所以innodb在实现redo log的时候采用了两阶段提交，来保证binlog和redo log两者要么同时写成功，要么都不写，保证数据的一致性；还有一点就是binlog是记录逻辑日志，采用追加方式生成日志文件，因此具有归档功能；而redo log大小是固定的，记录物理改变的，循环使用，目前不且备像oracle那样的归档功能，因此要保证恢复到任意时间点，需要binlog和全备协同作战；如果innodb的redo log具有归档开关的话，那只采用innodb存储引擎的数据库完全可以不需要binlog功能；主从备份也直接用redo log归档，就是一个小型的oracle dg","like_count":0},{"had_liked":false,"id":138957,"user_name":"Tim","can_delete":false,"product_type":"c1","uid":1480717,"ip_address":"","ucode":"3AAA9FD3D8DDDB","user_header":"https://static001.geekbang.org/account/avatar/00/16/98/0d/fb77a32c.jpg","comment_is_top":false,"comment_ctime":1570517781,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1570517781","product_id":100020801,"comment_content":"老师您好：本文中 “当有一条记录需要更新的时候，InnoDB 引擎就会先把记录写到 redo log（粉板）里面，并更新内存，这个时候更新就完成了。同时，InnoDB 引擎会在适当的时候，将这个操作记录更新到磁盘里面”。这里有个问题请教老师。这里的操作记录更新到磁盘里面，应该指的是redolog持久化到磁盘上吧，那什么时候将更新操作真正更新到磁盘上所存的真实数据里面呢？不然其他select怎么查呢？还是说我的理解有误，“操作记录更新到磁盘”指的是将redolog中的更新直接更新到磁盘上的真实数据，那这样的话好像也不行，redolog就永远只存在于内存了，重启丢失就没法恢复数据了。","like_count":0,"discussions":[{"author":{"id":1044546,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/42/7728d4f5.jpg","nickname":"艿艿","note":"","ucode":"8F727AB7A7F6B2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":25645,"discussion_content":"select 的数据，如果内存中有，则会读取内存中。\n如果被更新了，肯定会在内存中。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570544417,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":138841,"user_name":"Alan","can_delete":false,"product_type":"c1","uid":1005164,"ip_address":"","ucode":"AB242424C998DC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/56/6c/6e2fd5df.jpg","comment_is_top":false,"comment_ctime":1570468520,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570468520","product_id":100020801,"comment_content":"redolog只能保证数据库进程crash时不丢是，如果操作系统crash(比如突然掉电)时，感觉redolog未更新到磁盘的部分还是会丢对吧？","like_count":0},{"had_liked":false,"id":138748,"user_name":"乘风","can_delete":false,"product_type":"c1","uid":1115724,"ip_address":"","ucode":"0420C5535DACB7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLwSoTjHPX5tm4whBSfoZLX6toZxrZGUaLABQywKNf4MDc9toK3QSV7Z99ATcGicFCysoleQ5ISzmw/132","comment_is_top":false,"comment_ctime":1570438607,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570438607","product_id":100020801,"comment_content":"请教一个问题:上面提到过binlog与redolog的持久化,每次DML或事务操作都会做持久化数据到磁盘,这个阶段对mysql的影响有多大,并且写磁盘也是先写入到文件内核,文件内核的刷新应该没有采用强制刷新","like_count":0},{"had_liked":false,"id":138579,"user_name":"life is short, enjoy more.","can_delete":false,"product_type":"c1","uid":1074805,"ip_address":"","ucode":"3B5F37D30790A7","user_header":"https://static001.geekbang.org/account/avatar/00/10/66/75/54bb858e.jpg","comment_is_top":false,"comment_ctime":1570347471,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570347471","product_id":100020801,"comment_content":"老师你好，请教一个问题“有了 redo log，InnoDB 就可以保证即使数据库异常重启，之前提交的记录都不会丢失”，这个功能的前提条件是redo log已经持久化到硬盘当中了吧。redo更新这个动作肯定是发生在内存中的，那么redo log从内存持久化到磁盘的时机都有哪些呢？假如突然断电，redo log有什么机制能够将内存中的 redo log持久化吗？","like_count":0},{"had_liked":false,"id":137911,"user_name":"Spring","can_delete":false,"product_type":"c1","uid":1686750,"ip_address":"","ucode":"7FFC02D0D9287F","user_header":"https://static001.geekbang.org/account/avatar/00/19/bc/de/11396b76.jpg","comment_is_top":false,"comment_ctime":1569915528,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569915528","product_id":100020801,"comment_content":"事务回滚的时候，binlog和redo log中的记录他会回滚吗？","like_count":0},{"had_liked":false,"id":137910,"user_name":"Spring","can_delete":false,"product_type":"c1","uid":1686750,"ip_address":"","ucode":"7FFC02D0D9287F","user_header":"https://static001.geekbang.org/account/avatar/00/19/bc/de/11396b76.jpg","comment_is_top":false,"comment_ctime":1569915332,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569915332","product_id":100020801,"comment_content":"binlog 和 redo log倒底是先写哪个呢？","like_count":0},{"had_liked":false,"id":134940,"user_name":"半生瓜。","can_delete":false,"product_type":"c1","uid":1606288,"ip_address":"","ucode":"6D4CC445230D19","user_header":"https://static001.geekbang.org/account/avatar/00/18/82/90/295449c4.jpg","comment_is_top":false,"comment_ctime":1568959903,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568959903","product_id":100020801,"comment_content":"老师，可以理解为redo log 也有类似于缓存一样的作用吗。至于说redo log针对物理逻辑，“做了什么改动”这句还是不太理解，具体的形式是怎样的呢？","like_count":0},{"had_liked":false,"id":133590,"user_name":"Bing","can_delete":false,"product_type":"c1","uid":1355177,"ip_address":"","ucode":"01C276F21AD2D6","user_header":"https://static001.geekbang.org/account/avatar/00/14/ad/a9/031a0cc1.jpg","comment_is_top":false,"comment_ctime":1568615938,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568615938","product_id":100020801,"comment_content":"老师，delete语句是先删除再插入的操作嘛。可以说一下原理嘛，以及需要注意的地方。","like_count":0},{"had_liked":false,"id":133522,"user_name":"明翼","can_delete":false,"product_type":"c1","uid":1068361,"ip_address":"","ucode":"E77F86BEB3D5C1","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","comment_is_top":false,"comment_ctime":1568596896,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568596896","product_id":100020801,"comment_content":"老师有了binlog，binlog里面记录所有的更新操作，那插入语句是不是也在里面，如果在里面是不是不用备份数据库了，都用binlog是不是也可以恢复一个数据库，为什么老是要用数据库备份+binlog结合的方式那，整个恢复过程，redolog和binlog是哪个先应用？","like_count":0},{"had_liked":false,"id":132932,"user_name":"looper","can_delete":false,"product_type":"c1","uid":1238396,"ip_address":"","ucode":"DA4BCE83836C04","user_header":"https://static001.geekbang.org/account/avatar/00/12/e5/7c/2a5a418b.jpg","comment_is_top":false,"comment_ctime":1568276838,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568276838","product_id":100020801,"comment_content":"更重要的数据一天一备份。一天一备份相比一周一备份，binlog出现问题的概率更小，恢复起来也更亏快。","like_count":0},{"had_liked":false,"id":132818,"user_name":"未来怎样","can_delete":false,"product_type":"c1","uid":1652085,"ip_address":"","ucode":"4E54EB62595B27","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKORTofsU89GYKtywquzKuEiabvZnEOonfMYKuCPlo8GDlXqZuJdBicu0XtlaeodH4BnmHV1kldSAwQ/132","comment_is_top":false,"comment_ctime":1568247211,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568247211","product_id":100020801,"comment_content":"老师，有个疑问请教：<br>     redo log 会先将改变记录到日志，等到合适的时机再将这个改变日志写到磁盘，那在写入磁盘之前，不会对之后的查询造成影响吗？<br>","like_count":0},{"had_liked":false,"id":132383,"user_name":"Skyler","can_delete":false,"product_type":"c1","uid":1258530,"ip_address":"","ucode":"6B604E8C80C787","user_header":"https://static001.geekbang.org/account/avatar/00/13/34/22/72a20288.jpg","comment_is_top":false,"comment_ctime":1568104405,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1568104405","product_id":100020801,"comment_content":"关于两阶段提交有个疑惑，假如发生更新后redo log进入prepare阶段，下来成功写了对应的binlog，然后提交事务的时候，即要将redo log置为commit状态时系统crash了，mysql会如何应对呢？会回滚对应的binlog吗？","like_count":0,"discussions":[{"author":{"id":1044546,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/42/7728d4f5.jpg","nickname":"艿艿","note":"","ucode":"8F727AB7A7F6B2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":25656,"discussion_content":"不会。redolog 的目的，是 crash 后恢复数据。\n如果 relog 是 prepare ，而 binlog 已经提交了。那么恢复的时候，会标记 redolog 为 commit 。也就说，认为数据写入成功。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570545005,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132344,"user_name":"笑着活下去","can_delete":false,"product_type":"c1","uid":1621001,"ip_address":"","ucode":"23B8B4F9390A2B","user_header":"https://static001.geekbang.org/account/avatar/00/18/bc/09/d6b138fb.jpg","comment_is_top":false,"comment_ctime":1568093457,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568093457","product_id":100020801,"comment_content":"老师，我对binlog日志和redo log日志记录的内容还是比较混淆，结合后面15篇答疑部分，您说binlog不能用于库的崩溃恢复的一条原因是binlog不能获取到数据页，那么在这里的数据恢复需要对数据库备份做binlog重放，就可以得到某一时刻的数据库状态，那么这里是如何获取到数据页的呢？另外您能不能举个例子说明binlog日志和redolog日志内容的区别？","like_count":0},{"had_liked":false,"id":131809,"user_name":"Marco","can_delete":false,"product_type":"c1","uid":1138102,"ip_address":"","ucode":"78254AE72CB03A","user_header":"https://static001.geekbang.org/account/avatar/00/11/5d/b6/bedadca5.jpg","comment_is_top":false,"comment_ctime":1567913789,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567913789","product_id":100020801,"comment_content":"mysql更新的时候先从内存中获取要更新哪一行的数据，这里的内存跟查询缓存没关系吧，这个内存是在引擎层还是server层？","like_count":0},{"had_liked":false,"id":131711,"user_name":"Geek_ca6ea3","can_delete":false,"product_type":"c1","uid":1449733,"ip_address":"","ucode":"610152490E1AD8","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEIJ1RlMoHog4LoU2dTy8pw5mibTwUUUjApvo7A8fCBcpjrPYxBsqNvveYmZdkCfdibEWytQdZNAypVg/132","comment_is_top":false,"comment_ctime":1567860375,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567860375","product_id":100020801,"comment_content":"innodb_flush_log_at_trx_commit = 1<br>sync_binlog = 1<br>这两个参数是在哪里设置呢？<br><br><br>","like_count":0},{"had_liked":false,"id":131208,"user_name":"tommy","can_delete":false,"product_type":"c1","uid":1062373,"ip_address":"","ucode":"E6EDD4ECBA01D6","user_header":"https://static001.geekbang.org/account/avatar/00/10/35/e5/0b60d57e.jpg","comment_is_top":false,"comment_ctime":1567671605,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567671605","product_id":100020801,"comment_content":"将这行的c值加一 ---&gt; 写入新行 ，不应该是更新吗？怎么是写入新的行？","like_count":0},{"had_liked":false,"id":131204,"user_name":"tommy","can_delete":false,"product_type":"c1","uid":1062373,"ip_address":"","ucode":"E6EDD4ECBA01D6","user_header":"https://static001.geekbang.org/account/avatar/00/10/35/e5/0b60d57e.jpg","comment_is_top":false,"comment_ctime":1567670919,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567670919","product_id":100020801,"comment_content":"&quot;执行器拿到引擎给的行数据，把这个值加上 1，比如原来是 N...得到新的一行数据，再调用引擎接口写入这行新数据&quot;，是把整个行所有字段都更新了吗？还是只更新了要更新的那个字段？<br>","like_count":0},{"had_liked":false,"id":131203,"user_name":"tommy","can_delete":false,"product_type":"c1","uid":1062373,"ip_address":"","ucode":"E6EDD4ECBA01D6","user_header":"https://static001.geekbang.org/account/avatar/00/10/35/e5/0b60d57e.jpg","comment_is_top":false,"comment_ctime":1567670776,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567670776","product_id":100020801,"comment_content":"执行器先找引擎取 ID=2这一行，引擎找到之后返回的是整行数据，还是部分需要用到的数据？","like_count":0},{"had_liked":false,"id":130665,"user_name":"是我","can_delete":false,"product_type":"c1","uid":1297235,"ip_address":"","ucode":"0AC816A2FBD4F4","user_header":"https://static001.geekbang.org/account/avatar/00/13/cb/53/262a8ce2.jpg","comment_is_top":false,"comment_ctime":1567504255,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567504255","product_id":100020801,"comment_content":"一天一备增加数据时效性，但是消耗资源;一周一备时效性不强，但资源消耗不对，具体看业务需求，这是一个用空间换取效率的抉择。","like_count":0},{"had_liked":false,"id":129585,"user_name":"Yiliu","can_delete":false,"product_type":"c1","uid":1068884,"ip_address":"","ucode":"2CF20B138244B7","user_header":"https://static001.geekbang.org/account/avatar/00/10/4f/54/552bde40.jpg","comment_is_top":false,"comment_ctime":1567159164,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567159164","product_id":100020801,"comment_content":"老师, 请问如果多个update操作并发进行, 比如update1正在执行, update2来了. 这时对于redo log和binlog的处理, 是单线程的还是并发的? redo log和binlog中的数据是如何对应的呢? 比如我拿到一条redo log, 我怎么知道其对应的是哪条binlog?","like_count":0},{"had_liked":false,"id":129517,"user_name":"Tao","can_delete":false,"product_type":"c1","uid":1466809,"ip_address":"","ucode":"75FBDF49C601F4","user_header":"https://static001.geekbang.org/account/avatar/00/16/61/b9/dbf629c0.jpg","comment_is_top":false,"comment_ctime":1567146438,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1567146438","product_id":100020801,"comment_content":"innode_flush_log_at_trx_commit  请问这个参数设置为1之后，是redo log处于prepare状态的时候就落盘嘛","like_count":0,"discussions":[{"author":{"id":1044546,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/42/7728d4f5.jpg","nickname":"艿艿","note":"","ucode":"8F727AB7A7F6B2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":25660,"discussion_content":"同好奇这个问题。。mark 下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570545129,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128927,"user_name":"jc9090kkk","can_delete":false,"product_type":"c1","uid":1338831,"ip_address":"","ucode":"6C992D07A2E78F","user_header":"https://static001.geekbang.org/account/avatar/00/14/6d/cf/ec335526.jpg","comment_is_top":false,"comment_ctime":1566985309,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566985309","product_id":100020801,"comment_content":"老师你好，看完这篇文章我有个疑问，redo log是本质是内存吗？ 还是物理文件日志？ 如果是内存的话，我看到文章的末尾有提到将参数设置为1，这样能保证数据不丢失，但是这样操作不会提高了I&#47;O？ 因为每次的更新操作都会去写入磁盘，这种写磁盘的操作即便是SSD，也是随机写，单机的性能应该还有提升的空间吧？ 难道没有更完善的同步磁盘的策略了吗？另外一个疑问就是，如果碰到极端情况，比如断电，那么redo log里面的数据有没有可能还没有来得及写入到磁盘中，这样的话数据也不会丢失吗？希望老师能解答一下 谢谢","like_count":0},{"had_liked":false,"id":128796,"user_name":"JChungYang‼️","can_delete":false,"product_type":"c1","uid":1192820,"ip_address":"","ucode":"95A20B8420E5A6","user_header":"https://static001.geekbang.org/account/avatar/00/12/33/74/a4655211.jpg","comment_is_top":false,"comment_ctime":1566963656,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566963656","product_id":100020801,"comment_content":"想问下两阶段提交和两次写的区别是啥？还是说两次写是两阶段提交的实现而已","like_count":0},{"had_liked":false,"id":128600,"user_name":"Dthan","can_delete":false,"product_type":"c1","uid":1177838,"ip_address":"","ucode":"B5DEB7D050981D","user_header":"https://static001.geekbang.org/account/avatar/00/11/f8/ee/2cf560f5.jpg","comment_is_top":false,"comment_ctime":1566911941,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566911941","product_id":100020801,"comment_content":"有个问题请教下老师，数据会在内存中更新，事务提交之后会立即把这行数据刷盘吗，不刷盘丢了怎么办？","like_count":0},{"had_liked":false,"id":127573,"user_name":"鱼筱雨","can_delete":false,"product_type":"c1","uid":1597257,"ip_address":"","ucode":"17B11B3CF81153","user_header":"https://static001.geekbang.org/account/avatar/00/18/5f/49/115a8f4c.jpg","comment_is_top":false,"comment_ctime":1566742468,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566742468","product_id":100020801,"comment_content":"林老师，在mysql重启后，所有表的自增的索引ID会重置，有没有办法不让它重置？","like_count":0},{"had_liked":false,"id":126388,"user_name":"🍎🍀啊哦","can_delete":false,"product_type":"c1","uid":1253958,"ip_address":"","ucode":"A2EF10E5B2FAF8","user_header":"https://static001.geekbang.org/account/avatar/00/13/22/46/a2523cdf.jpg","comment_is_top":false,"comment_ctime":1566377981,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1566377981","product_id":100020801,"comment_content":"如果在commit redo log之前发生了异常，那么redo log不会丢失吗，异常前redo log只是一个prepare阶段但是bin log却是实实在在写入了。","like_count":0},{"had_liked":false,"id":126383,"user_name":"dykw","can_delete":false,"product_type":"c1","uid":1412912,"ip_address":"","ucode":"513D787379E158","user_header":"https://static001.geekbang.org/account/avatar/00/15/8f/30/ae34a463.jpg","comment_is_top":false,"comment_ctime":1566376976,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566376976","product_id":100020801,"comment_content":"数据的执行频次快的是不是需要一天一备，还有两阶段提交还是有点迷糊，是说两者是在同一个原子性操作吗？","like_count":0},{"had_liked":false,"id":126116,"user_name":"shawn","can_delete":false,"product_type":"c1","uid":1010221,"ip_address":"","ucode":"8F6A8C7920996E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6a/2d/ec4ed8ce.jpg","comment_is_top":false,"comment_ctime":1566315187,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566315187","product_id":100020801,"comment_content":"数据库的状态就有可能和用它的日志恢复出来的库的状态不一致。 redolog 记录当时日志 binlog记录用于备份的日志。","like_count":0},{"had_liked":false,"id":125961,"user_name":"helloworld","can_delete":false,"product_type":"c1","uid":1015754,"ip_address":"","ucode":"00DF2FEC58D2E6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","comment_is_top":false,"comment_ctime":1566283701,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566283701","product_id":100020801,"comment_content":"老师，假设redo log和binlog都保存完整的话，如果我需要恢复数据是不是下面的两种方式均可以：第一种，已经备份的数据+redo log；第二种：已经备份的数据+binlog？谢谢老师","like_count":0},{"had_liked":false,"id":125235,"user_name":"　","can_delete":false,"product_type":"c1","uid":1172538,"ip_address":"","ucode":"DBE2DB5CC52C91","user_header":"https://static001.geekbang.org/account/avatar/00/11/e4/3a/16545faf.jpg","comment_is_top":false,"comment_ctime":1566127529,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1566127529","product_id":100020801,"comment_content":"有两个问题：<br>1. 根据binlog这种完整和追加写入的特性，在误删表的场景中，完全可以利用此时的binlog来恢复，而不需要用到周期性备好的binlog。<br>2. innodb_flush_log_at_trx_commit设置为1，现有的redo log本身具有崩溃恢复和缓存暂存记录的能力，且依赖于空闲时间和写满的被动触发条件这样数据库的写入速度会更快。所以不是很理解这里。","like_count":0,"discussions":[{"author":{"id":1172538,"avatar":"https://static001.geekbang.org/account/avatar/00/11/e4/3a/16545faf.jpg","nickname":"　","note":"","ucode":"DBE2DB5CC52C91","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5274,"discussion_content":"innodb_flush_log_at_trx_commit我刚刚理解了，这个参数保证redo log写到磁盘上。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566127904,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":125168,"user_name":"张三丰","can_delete":false,"product_type":"c1","uid":1155275,"ip_address":"","ucode":"3A6215A40B3B21","user_header":"https://static001.geekbang.org/account/avatar/00/11/a0/cb/aab3b3e7.jpg","comment_is_top":false,"comment_ctime":1566106668,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566106668","product_id":100020801,"comment_content":"更新到redo log ，这个过程肯定是先更新到redo log的日志缓冲区，此时还没有持久化到磁盘，这个时候redo log的状态是prepare，这个时候mysql异常重启，那么redo log还能恢复么？ 因为此时数据页的变更还没有持久化到redo log file里。","like_count":0},{"had_liked":false,"id":124319,"user_name":"会飞的蜗牛","can_delete":false,"product_type":"c1","uid":1213356,"ip_address":"","ucode":"9C9CEB30B08DE4","user_header":"https://static001.geekbang.org/account/avatar/00/12/83/ac/eb006675.jpg","comment_is_top":false,"comment_ctime":1565859925,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565859925","product_id":100020801,"comment_content":"老师,数据写入redo Log,此时数据库宕机,但仍能恢复数据,我的疑问是:写入redo Log和宕机之间,日志又做了什么操作? 我的理解是虽然是写入了redoLog,但他是内存中的,如果此时宕机,那么内存中的redo Log记录不会消失么?还是说写入redo Log中,它会持久化到一个log file中,如果是持久化到log file中,那是否属于落盘的操作,如果属于的话,会不会多次IO影响性能?   ","like_count":0},{"had_liked":false,"id":122235,"user_name":"小白","can_delete":false,"product_type":"c1","uid":1577051,"ip_address":"","ucode":"6B6C0A0AD0F742","user_header":"","comment_is_top":false,"comment_ctime":1565320812,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565320812","product_id":100020801,"comment_content":"有个问题为什么binlog不能做崩溃恢复","like_count":0},{"had_liked":false,"id":121932,"user_name":"po88","can_delete":false,"product_type":"c1","uid":1236291,"ip_address":"","ucode":"244BD825A82053","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83equXYHzYnWw7jiasIeG3hhPZDqcRsWZQqia7JnTTp3sicJeLib96ibUgEiajBs4GhGWf3OZZicRk40BCcnVg/132","comment_is_top":false,"comment_ctime":1565251884,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565251884","product_id":100020801,"comment_content":"老师你好，上面提到的更新操作，数据是写进新行然后再把新行更新对应的内存，这里的写进新行是指直接写进了磁盘吗","like_count":0},{"had_liked":false,"id":121579,"user_name":"工科生小猴子","can_delete":false,"product_type":"c1","uid":1592148,"ip_address":"","ucode":"CE52F63EE72301","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLhpCNoXf1fPfkU8icso2kvjAVtmDibric0VBt9FdtfopM90Y8DlBYnM4UUmh9x7M79LpcIkWXnEeib7A/132","comment_is_top":false,"comment_ctime":1565161693,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565161693","product_id":100020801,"comment_content":"老师您好，我有个疑问，一直困惑着我：binlog没有记录数据页的更新细节，没有能力恢复数据页。这个语句能详细解释一下嘛？","like_count":0},{"had_liked":false,"id":120956,"user_name":"吖潘吖潘","can_delete":false,"product_type":"c1","uid":1435418,"ip_address":"","ucode":"6DE549504BF31E","user_header":"https://static001.geekbang.org/account/avatar/00/15/e7/1a/e86ae6c8.jpg","comment_is_top":false,"comment_ctime":1565018285,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565018285","product_id":100020801,"comment_content":"redo log 是物理日志，记录的是“在某个数据页上做了什么修改”；binlog 是逻辑日志，记录的是这个语句的原始逻辑，比如“给 ID=2 这一行的 c 字段加 1 ”。 <br>具体还不是分得清楚这两个描述的差别在哪。。。","like_count":0},{"had_liked":false,"id":120632,"user_name":"修罗","can_delete":false,"product_type":"c1","uid":1327398,"ip_address":"","ucode":"4A156F9D343F8C","user_header":"https://static001.geekbang.org/account/avatar/00/14/41/26/ba95c89a.jpg","comment_is_top":false,"comment_ctime":1564964198,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564964198","product_id":100020801,"comment_content":"redolog和undolog什么区别？","like_count":0},{"had_liked":false,"id":119681,"user_name":"爱因诗贤","can_delete":false,"product_type":"c1","uid":1528379,"ip_address":"","ucode":"150C439B87CED1","user_header":"https://static001.geekbang.org/account/avatar/00/17/52/3b/7a2610a6.jpg","comment_is_top":false,"comment_ctime":1564651368,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564651368","product_id":100020801,"comment_content":"老师听了你的课之后，太崇拜了","like_count":0},{"had_liked":false,"id":118812,"user_name":"andrelu","can_delete":false,"product_type":"c1","uid":1304398,"ip_address":"","ucode":"292B0574058D7F","user_header":"https://static001.geekbang.org/account/avatar/00/13/e7/4e/b512e910.jpg","comment_is_top":false,"comment_ctime":1564448919,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564448919","product_id":100020801,"comment_content":"老师后面会讲undo log吗，感觉redo和undo结合起来讲效果会很好","like_count":0},{"had_liked":false,"id":118561,"user_name":"尔冬橙","can_delete":false,"product_type":"c1","uid":1225224,"ip_address":"","ucode":"0B013A49BC18DA","user_header":"https://static001.geekbang.org/account/avatar/00/12/b2/08/92f42622.jpg","comment_is_top":false,"comment_ctime":1564388234,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564388234","product_id":100020801,"comment_content":"老师，我理解redolog是在内存还是磁盘呢，如果断电了，恢复后，redolog还有么","like_count":0},{"had_liked":false,"id":117552,"user_name":"环中","can_delete":false,"product_type":"c1","uid":1592361,"ip_address":"","ucode":"410EA358C9497B","user_header":"https://static001.geekbang.org/account/avatar/00/18/4c/29/0035a99e.jpg","comment_is_top":false,"comment_ctime":1564072961,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564072961","product_id":100020801,"comment_content":"1.写入新行后写redolog，如果写入新行后，脏页被回写磁盘，还没有写redolog，进程挂了。 这时候磁盘有新数据，binglog和redolog中也没有新数据。 binlog恢复数据会有问题。mysql是怎么解决的？<br>2.commit redolog，是在原来写的redolog再更改一个标志位吗？这种不是顺序写，是不是带来了磁盘寻道时间消耗了。 如果是ssd的话，是不是意味着要擦除块数据，再重新回写，导致写放大。","like_count":0},{"had_liked":false,"id":117026,"user_name":"Geek_cf29f0","can_delete":false,"product_type":"c1","uid":1337800,"ip_address":"","ucode":"F635968AE2656C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/bWpFdAQwTzBg70ib6QTQomfQV3Ak1CFQPXun20w2Kz3PCLtsV75nNrqBuDEvehtlCoTkyT3icNWnvO7nPMc1RFfg/132","comment_is_top":false,"comment_ctime":1563956785,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563956785","product_id":100020801,"comment_content":"对于每天业务操作频繁的数据，在数据需要恢复的情况下，一天一备减少了数据恢复的时间，相比较一周一备，一周一备还要确保一周内的binlog是完全不存在丢失的情况。","like_count":0},{"had_liked":false,"id":116599,"user_name":"ub8","can_delete":false,"product_type":"c1","uid":1481811,"ip_address":"","ucode":"0D937C3EAEB781","user_header":"https://static001.geekbang.org/account/avatar/00/16/9c/53/ade0afb0.jpg","comment_is_top":false,"comment_ctime":1563877381,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563877381","product_id":100020801,"comment_content":"麻烦问下，update执行流程1到5步都是串行的么？","like_count":0},{"had_liked":false,"id":116516,"user_name":"ub8","can_delete":false,"product_type":"c1","uid":1481811,"ip_address":"","ucode":"0D937C3EAEB781","user_header":"https://static001.geekbang.org/account/avatar/00/16/9c/53/ade0afb0.jpg","comment_is_top":false,"comment_ctime":1563862161,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563862161","product_id":100020801,"comment_content":"redo log 是物理日志<br>物理日志可以理解为直接操作磁盘二进制么？","like_count":0},{"had_liked":false,"id":115477,"user_name":"XD","can_delete":false,"product_type":"c1","uid":1079293,"ip_address":"","ucode":"DC9DCFB3841A4E","user_header":"https://static001.geekbang.org/account/avatar/00/10/77/fd/c6619535.jpg","comment_is_top":false,"comment_ctime":1563597852,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563597852","product_id":100020801,"comment_content":"具体来说，当有一条记录需要更新的时候，InnoDB 引擎就会先把记录写到 redo log（粉板）里面，并更新内存，这个时候更新就算完成了。<br><br>------<br><br>老师几个问题<br>1、这个内存指的是change buffer对吗？<br>2、change buffer里数据的记录跟redo log一样也是append吗？<br>3、所以总结下，change buffer只记录不在内存中的数据页的更新，redo log是全量的对数据页的操作，两者之间应该是对应的，每次redolog的checkpoint前移的时候，会查看change buffer中是否有对应的记录，如果有就会删，对吗？<br><br>请老师指导一下。","like_count":0},{"had_liked":false,"id":115255,"user_name":"长期规划","can_delete":false,"product_type":"c1","uid":1019332,"ip_address":"","ucode":"5EF65E9115834B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","comment_is_top":false,"comment_ctime":1563518996,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563518996","product_id":100020801,"comment_content":"老师，redo log只用于重启恢复，binIog只用于备份恢复，对吧","like_count":0},{"had_liked":false,"id":115244,"user_name":"长期规划","can_delete":false,"product_type":"c1","uid":1019332,"ip_address":"","ucode":"5EF65E9115834B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","comment_is_top":false,"comment_ctime":1563517213,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563517213","product_id":100020801,"comment_content":"redo Iog记录做了什么改动，那不就是记录SQL语句吗？","like_count":0},{"had_liked":false,"id":115050,"user_name":"excuse me？","can_delete":false,"product_type":"c1","uid":1546347,"ip_address":"","ucode":"2C09E177B38782","user_header":"https://static001.geekbang.org/account/avatar/00/17/98/6b/01fa0565.jpg","comment_is_top":false,"comment_ctime":1563461252,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563461252","product_id":100020801,"comment_content":"是否可以理解，redo log本意是用来提高数据库变更操作的效率的，类似没有redo log的其他引擎，也就不需要crash save了，因为已经执行到磁盘了？","like_count":0},{"had_liked":false,"id":115044,"user_name":"小小强","can_delete":false,"product_type":"c1","uid":1024615,"ip_address":"","ucode":"C0C99FEE339DFA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a2/67/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1563460188,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1563460188","product_id":100020801,"comment_content":"1, 先写redo log，此时是prepare状态。<br>2, 再写binlog<br>3, 事务提交失败，crash。这时redo log是prepare状态，岂不是也会出现数据不一致？","like_count":0,"discussions":[{"author":{"id":1044546,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/42/7728d4f5.jpg","nickname":"艿艿","note":"","ucode":"8F727AB7A7F6B2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":25661,"discussion_content":"重启恢复的时候，如果对应的 binlog 存在，会标记 redo log 为 commit 。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570545251,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114991,"user_name":"极客—月","can_delete":false,"product_type":"c1","uid":1318468,"ip_address":"","ucode":"EE12EEBF242B1D","user_header":"","comment_is_top":false,"comment_ctime":1563445053,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1563445053","product_id":100020801,"comment_content":"恢复过程里用到的只有binlog。为什么说binlog不具有crash-safe功能呢？另外如果binlog已经足够恢复数据了，为啥还要redolog呢？望老师指点一下","like_count":0},{"had_liked":false,"id":114318,"user_name":"啊啊啊哦哦","can_delete":false,"product_type":"c1","uid":1309877,"ip_address":"","ucode":"68C7153ECAAC57","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/RNO4yZyBvic914hewmNNE8iblYDcfv5yGHZ9OnKuCuZXNmGR0F5qV3icKLT2xpMt66GyEpicZVvrmz8A6TIqt92MQg/132","comment_is_top":false,"comment_ctime":1563271416,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1563271416","product_id":100020801,"comment_content":"第二次回来看文章， 老师想问下 从引擎接口读取一行。。 指的是 所有列都要读取吗。。 比如我 select id from table,        但是这个table有3个字段。。   字段过滤是在server层筛选完给客服端吗 ，还有读取一行时 它是放在哪个缓存中的？","like_count":0,"discussions":[{"author":{"id":1185046,"avatar":"https://static001.geekbang.org/account/avatar/00/12/15/16/0aae41a1.jpg","nickname":"no13bus","note":"","ucode":"69FA1A719DA4F6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":9042,"discussion_content":"得分情况。如果需要的字段都在索引上，那么用索引覆盖和索引下推的话就能拿到字段值，server层不需要进行过滤。如果不是这样，就要server来过滤了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568125618,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114233,"user_name":"学习，学习，再学习","can_delete":false,"product_type":"c1","uid":1178951,"ip_address":"","ucode":"3B07D19CCFB15C","user_header":"https://static001.geekbang.org/account/avatar/00/11/fd/47/78ee760d.jpg","comment_is_top":false,"comment_ctime":1563259018,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563259018","product_id":100020801,"comment_content":"我有个问题：当redo log处于prepare时，此时的日志应该还在log buffer里吧，并没有刷入磁盘（ib_logfile文件）里。如果此时（日志还在内存）发生了奔溃，是不是也恢复不了数据，因为日志还没刷入磁盘文件里。","like_count":0},{"had_liked":false,"id":114051,"user_name":"师恩磊","can_delete":false,"product_type":"c1","uid":1216657,"ip_address":"","ucode":"237A2B7D19E0A5","user_header":"https://static001.geekbang.org/account/avatar/00/12/90/91/aebfb724.jpg","comment_is_top":false,"comment_ctime":1563233657,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563233657","product_id":100020801,"comment_content":"什么时候数据库一天一备份比较好？当每天数据增量比较大时，一天一备份比较好，每天数据量比较小时，一周一备份就可。这个主要跟数据库的redolog有关，因为redolog是循环写的，每天数据量都比较大时，会造成redolog空间满了，此时会发生redolog备份，不能进行其他更新，插入等操作了，会影响生产。<br>疑问：1、两阶段提交时，如果crash发生在写binlog之后，commit之前，那binlog会回滚吗？redolog中已记录的日志会删除吗？<br>2、binlog和redolog中记录的东西到底有什么区别？比如一条更新语句Id初始值为0，update table set Id=Id+2 where Id=0;该条原始语句应该是记录在binlog中吧，redolog记录的是结果2。<br>总结：该节讲述了一条update语句在数据库中的“漫游之旅”，通过与select语句做对比来连接，其相同点:都是先连接器连接，查询缓存中是否存在Id=0的数据，有则直接返回，没有，则分析器，分析语法，词法是否正确，如果没问题，则优化器，选择合适的执行计划，最后通过执行器执行，先看id=0的数据是否在内存中，如果在直接返回，如果不在，从磁盘中读入内存，返回行数据，将该行数据更新为2，写到内存中，先在redolog中做记录处于preper状态，，然后再写入binlog中，再commit。此处是两阶段提交，解释了为什么要有两阶段提交，是因为binlog没有cash-safe的功能，为了保证binlog和tedolog逻辑一致性，数据不丢失。还解释了，binlog与redolog的区别：binlog逻辑日志，redolog是循环写入的，有write Point和Check Point。binlog是追加写入的，即不会覆盖之前的内容。最后讲述了数据日志的设置，为了保证cash-safe，将innodb_flush_log_at_trx_commit设置为1即，每次事物的redolog都永久化更新到磁盘，为了保证binlog日志不丢失，sync_binlog设置为1，每次将bin_log日志持久化更新到磁盘。<br>","like_count":0},{"had_liked":false,"id":113415,"user_name":"迈克尔嘿嘿","can_delete":false,"product_type":"c1","uid":1601276,"ip_address":"","ucode":"F73CAFCE84C8EF","user_header":"https://static001.geekbang.org/account/avatar/00/18/6e/fc/a7ff61e5.jpg","comment_is_top":false,"comment_ctime":1563001738,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563001738","product_id":100020801,"comment_content":"老师，假设现在修改一条数据，内存中的数据页上已经修改，但是还没有commit。如果这时有其它线程来查询这个数据，按理应该是查到的老数据，但是内存中的数据已经被修改，是不是读的线程又要到磁盘去获取老数据再返回呢？不知道自己把问题描述清楚没，还忘老师解答","like_count":0},{"had_liked":false,"id":113179,"user_name":"Jayden 王凯豪","can_delete":false,"product_type":"c1","uid":1592236,"ip_address":"","ucode":"6CAADB9B449892","user_header":"https://static001.geekbang.org/account/avatar/00/18/4b/ac/2a48928f.jpg","comment_is_top":false,"comment_ctime":1562908998,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562908998","product_id":100020801,"comment_content":"我们把redolog分成8个文件，每个文件2G，然后直接把binlog关掉了。理由：<br>我们用MySQL数据库做batch processing，从ETL到一系列的表操作最后出结果表，中间运算太多，binlog打开的话，不到一周磁盘就占去了1个TB<br>我们主要用InnoDB引擎","like_count":0},{"had_liked":false,"id":113144,"user_name":"TIAN","can_delete":false,"product_type":"c1","uid":1276795,"ip_address":"","ucode":"CCCF80602C1753","user_header":"https://static001.geekbang.org/account/avatar/00/13/7b/7b/5b39b47b.jpg","comment_is_top":false,"comment_ctime":1562902196,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562902196","product_id":100020801,"comment_content":"不好意思老师，我还有一个问题，在这篇蚊帐里没有提到，就是undo log是做什么的？需要去深入的学习了解一下么？我了解到有些数据库为了提高IO是把undo log去掉了。","like_count":0},{"had_liked":false,"id":113139,"user_name":"TIAN","can_delete":false,"product_type":"c1","uid":1276795,"ip_address":"","ucode":"CCCF80602C1753","user_header":"https://static001.geekbang.org/account/avatar/00/13/7b/7b/5b39b47b.jpg","comment_is_top":false,"comment_ctime":1562902131,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562902131","product_id":100020801,"comment_content":"老师您好，看更新记录的流程图理解是不是先写Redo log,然后redo log进入prepare状态，等Binlog写完了再commit，是这个逻辑么? 那么我们常说的innodb保证事物的一致性也就是这两个log的一致么？","like_count":0},{"had_liked":false,"id":112880,"user_name":"泠小墨","can_delete":false,"product_type":"c1","uid":1178634,"ip_address":"","ucode":"73D296D9F42911","user_header":"https://static001.geekbang.org/account/avatar/00/11/fc/0a/0c4b9170.jpg","comment_is_top":false,"comment_ctime":1562836780,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562836780","product_id":100020801,"comment_content":"老师，有两个疑问，<br>1.如果在最后redo log commit 阶段，发生了crash，这个时候，binlog 存在，而 redo log 是prepare 状态，数据库重启后会怎么处理。<br>2.write pos 移动速度快，check point 移动速度慢，当write pos 追上了 check point 会发生什么样的情况？MySQL 拒绝所有的写操作或者所有的操作么？","like_count":0},{"had_liked":false,"id":112306,"user_name":"杨鹏程baci","can_delete":false,"product_type":"c1","uid":1205949,"ip_address":"","ucode":"3D22F6B74340A8","user_header":"https://static001.geekbang.org/account/avatar/00/12/66/bd/bd5d503e.jpg","comment_is_top":false,"comment_ctime":1562718747,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562718747","product_id":100020801,"comment_content":"老师好，我理解有了redo-log，innodb就能不丢失，那其他的存储引擎就会丢失了吗，其他存储引擎如果是直接存盘的话，为什么会丢失了，应该顶多就是存储速度慢吧？望老师解答一下，谢谢！","like_count":0},{"had_liked":false,"id":111686,"user_name":"数禾极客","can_delete":false,"product_type":"c1","uid":1006508,"ip_address":"","ucode":"7C7D50C824DB86","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5b/ac/1fadba55.jpg","comment_is_top":false,"comment_ctime":1562583491,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562583491","product_id":100020801,"comment_content":"难道mysql不能更新一个大版本，只留有一个通用日志吗？","like_count":0},{"had_liked":false,"id":109968,"user_name":"IF You","can_delete":false,"product_type":"c1","uid":1108957,"ip_address":"","ucode":"C14188B97658A6","user_header":"https://static001.geekbang.org/account/avatar/00/10/eb/dd/3c9c613c.jpg","comment_is_top":false,"comment_ctime":1562142948,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562142948","product_id":100020801,"comment_content":"问题一：<br>为了不丢日志，是不是每次更新操作，必须刷4次盘：1.写redolog的prepare   2.写binlog  3.更新数据  4.写commit   。而必须同步刷盘才能保证不丢失。 是不是性能损失验证。<br>如果是同步刷盘，是不是讨论 粉板 和账本就没有意义了？<br>问题二：<br>redo prepare -&gt; binlog -&gt; commit<br>如果写binlog后commit之前，db宕机，客户端得到的反馈是不是db操作失败。<br>但是按照文章说的，db重启可能补偿commit，但是业务系统认为db失败了，请问如何解决？","like_count":0},{"had_liked":false,"id":109236,"user_name":"李郝","can_delete":false,"product_type":"c1","uid":1590465,"ip_address":"","ucode":"4818313D933CE6","user_header":"https://static001.geekbang.org/account/avatar/00/18/44/c1/ebe870bb.jpg","comment_is_top":false,"comment_ctime":1561985896,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561985896","product_id":100020801,"comment_content":"老师你好，请问redo log和binlog一起保证了crash safe。那么在1、redo log prepare 时 crash。2、写binlog 时 crash。3、redo log commit 时 crash。这三种情况的数据库恢复后分别是什么结果呢？按照文章中c 由0更新至1的话。1: c=0？2: c=0? 3: c=1? 是这样的结果吗？","like_count":0},{"had_liked":false,"id":109034,"user_name":"徐小鹏","can_delete":false,"product_type":"c1","uid":1451648,"ip_address":"","ucode":"1B5FA49C5D8652","user_header":"https://static001.geekbang.org/account/avatar/00/16/26/80/f220e4ee.jpg","comment_is_top":false,"comment_ctime":1561951131,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561951131","product_id":100020801,"comment_content":"老师，我有个问题，Mysql 中先写日志，然后写磁盘是因为磁盘IO费时。那么Redis 先写数据，然后写日志只是因为IO不费事么？","like_count":0},{"had_liked":false,"id":108788,"user_name":"少盐","can_delete":false,"product_type":"c1","uid":1305743,"ip_address":"","ucode":"BCC7E264B75702","user_header":"https://static001.geekbang.org/account/avatar/00/13/ec/8f/8299495a.jpg","comment_is_top":false,"comment_ctime":1561881996,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561881996","product_id":100020801,"comment_content":"事务的四种模式：<br>读未提交，只要查询的数据改变，无论修改该数据的事务是否提交，都可以被看到<br><br>读未提交，无论修改了多少次，多长时间，只要未提交，就不被其他人看到<br><br>可重复读，为了保证自己事务的前后一致性，外界数据无论怎么变都影响不到自己的事务，只有提交本次事务后，下次查询才能看到变化<br><br>串行化，本身事务要执行的对象相对其他事务就是锁定的，我没有完事，你不能插手<br><br>Oracle 默认为读提交模式<br><br>尽量避免长事务，占有大量内存空间或者锁资源","like_count":0},{"had_liked":false,"id":108727,"user_name":"黄展志","can_delete":false,"product_type":"c1","uid":1356083,"ip_address":"","ucode":"EBA342CD89072D","user_header":"https://static001.geekbang.org/account/avatar/00/14/b1/33/8993eae0.jpg","comment_is_top":false,"comment_ctime":1561866046,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561866046","product_id":100020801,"comment_content":"老师，想问一下，最后语句是在执行引擎里面执行还是执行引擎调用存储引擎接口执行？","like_count":0},{"had_liked":false,"id":108497,"user_name":"shenfl","can_delete":false,"product_type":"c1","uid":1184233,"ip_address":"","ucode":"607CD894152241","user_header":"https://static001.geekbang.org/account/avatar/00/12/11/e9/b6aa6364.jpg","comment_is_top":false,"comment_ctime":1561785431,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561785431","product_id":100020801,"comment_content":"老师，有个问题关于两阶段提交，假设redo log写完prepare，binlog也写完了，此时事务提交我理解也要写redo log和binlog两个地方，这样岂不是又回到原问题了？比如先在redolog里面提交了但是binlog还没写提交日志系统挂了。。","like_count":0},{"had_liked":false,"id":107983,"user_name":"蒋旺Foo","can_delete":false,"product_type":"c1","uid":1265741,"ip_address":"","ucode":"4325AB9674975C","user_header":"https://static001.geekbang.org/account/avatar/00/13/50/4d/392f969b.jpg","comment_is_top":false,"comment_ctime":1561643795,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561643795","product_id":100020801,"comment_content":"老师，请问一下，mysql逻辑架构图是用什么工具画的？给人一种亲切感。","like_count":0},{"had_liked":false,"id":107488,"user_name":"c","can_delete":false,"product_type":"c1","uid":1199438,"ip_address":"","ucode":"E1E383485EBF77","user_header":"https://static001.geekbang.org/account/avatar/00/12/4d/4e/5a20fe28.jpg","comment_is_top":false,"comment_ctime":1561545761,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561545761","product_id":100020801,"comment_content":"老师 mysql还有个undo log？那他是做什么用呢？和redo log有什么区别呢？？？？","like_count":0},{"had_liked":false,"id":107266,"user_name":"jack Wong","can_delete":false,"product_type":"c1","uid":1356930,"ip_address":"","ucode":"EDF88971815846","user_header":"https://static001.geekbang.org/account/avatar/00/14/b4/82/62548de6.jpg","comment_is_top":false,"comment_ctime":1561509920,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561509920","product_id":100020801,"comment_content":"Redlog会不断更新，不断被擦拭，感觉他像个缓存吧，然后binlog 可以不断追加操作变更，可以记录多个时间的操作。如果运用到代码中，尤其是那些分布式系统中，我对分布式不太熟，那么redlog是不是一个用来同步的角色呢？","like_count":0},{"had_liked":false,"id":107228,"user_name":"苦行僧","can_delete":false,"product_type":"c1","uid":1055334,"ip_address":"","ucode":"726024A9A9CF44","user_header":"https://static001.geekbang.org/account/avatar/00/10/1a/66/2d9db9ed.jpg","comment_is_top":false,"comment_ctime":1561505840,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561505840","product_id":100020801,"comment_content":"任何备份策略都逃不开业务场景","like_count":0},{"had_liked":false,"id":107227,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1561505830,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561505830","product_id":100020801,"comment_content":"精彩，为加深印象自己也小结一下，本节的核心，我认为在于了解WAL的思想，并且看看MySQL是怎么灵活运用的。<br><br>1：WAL是啥意思？<br><br>write ahead logging-日志先行，操作数据库时，先记录操作日志，然后再执行真正的操作。就好似“杀人回忆录”电影里讲述的那样，有了那个杀人记录本就不会因为撞车事故，导致自己不知道自己杀了多少人。<br><br>2：MySQL日志的作用？<br><br>2-1：用于事务实现-保证数据库的ACID特性<br><br>2-2：用于数据同步-实现主从数据同步<br><br>2-3：用于数据备份-用于数据灾备，数据还原等<br><br>3：日志如此重要，MySQL有哪些核心日志呢？<br><br>3-1：binlog-用于记录数据操作的逻辑日志，采用追加写的方式，可用于事务实现、数据同步、灾备恢复等。这个日志是通用的格式，MySQL数据库各种存储引擎都认识，其实只有这一个日志也是可以的，但是为了提高性能，又增加别的日志，比如：redolog。<br><br>3-2：redolog-用于记录数据修改的物理日志，啥意思？记录日志的格式特别，更直接和底层，记录数据页中的数据有什么改动。为了进一步提高效率，采用类循环数组的方式记录，空间有限，用于数据库的突然宕机事件的数据恢复。有没有感觉这两个日志的作用有交集，由于历史原因功能上确实有重复，但redolog的性能更优。如果这么解释也行，不过我没理解老师讲的，为啥binlog不能用于数据库突然宕机，然后重启用于数据恢复的理由?binlog日志内容过多不知道从哪里恢复？那用redolog是怎么实现的不能采取一样的措施嘛？没有记录操作的时间嘛？<br><br>4：两阶段提交<br><br>这个主要是为了保证binlog和redolog两份日志的一致性，用于实现数据库的事务。<br><br>5：我们目前也在使用WAL的方式来记录数据的操作历史，记录谁什么时候操作了什么数据以及数据的原值和修改值，主要用于问题追踪和定位责任人。<br><br>","like_count":0},{"had_liked":false,"id":106945,"user_name":"知行合一","can_delete":false,"product_type":"c1","uid":1521486,"ip_address":"","ucode":"2B8E634FC4CFB7","user_header":"https://static001.geekbang.org/account/avatar/00/17/37/4e/5c3153b2.jpg","comment_is_top":false,"comment_ctime":1561427379,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561427379","product_id":100020801,"comment_content":"真正写数据是什么个流程，还有查询的时候怎么结合缓存和磁盘中的数据库文件一起查呢？","like_count":0},{"had_liked":false,"id":104710,"user_name":"Geek_6944ac","can_delete":false,"product_type":"c1","uid":1575002,"ip_address":"","ucode":"CEB0AD8B0EDEAB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKe0iaNYicicxBBCibmu9iaVLdFibnOK4TTtgelqucyKXq9sEX0rGLnfZhdMfvMqDZF1SsibbXXGDoPyVObw/132","comment_is_top":false,"comment_ctime":1560820772,"is_pvip":false,"replies":[{"id":"38246","content":"👍","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1561054758,"ip_address":"","comment_id":104710,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560820772","product_id":100020801,"comment_content":"还在认真学习中，林工辛苦了，讲解得很形象生动，图文并茂，利于理解。让我们读者能很好够理解作者所述内容。具体技术细节上，目前不能提许多问题，坚持学习下去，一定会有收获和问题。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454384,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561054758,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104104,"user_name":"公共号","can_delete":false,"product_type":"c1","uid":1318914,"ip_address":"","ucode":"4759B517D4CD5E","user_header":"https://static001.geekbang.org/account/avatar/00/14/20/02/df2bfda9.jpg","comment_is_top":false,"comment_ctime":1560653057,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560653057","product_id":100020801,"comment_content":"redo log 的部分，我的理解是图里面绿色的部分是当前可以写的空间，写的时候 write_pos 不断向后移动，当追上 check_point 的时候，check_point 也向后移动，腾出更多的空间来。<br><br>然而作者在回复 @DainelAnton 的时候，说的是「这句话，说的“空着的部分”就是 write_pos 到 3 号文件末尾，再加上 0 号文件开头到 check_point 的部分」。这句话就不懂了。<br><br>是我理解的不对吗？","like_count":0},{"had_liked":false,"id":104027,"user_name":"Zhaoyang","can_delete":false,"product_type":"c1","uid":1037190,"ip_address":"","ucode":"131D83AC2566D2","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d3/86/b5d72c87.jpg","comment_is_top":false,"comment_ctime":1560595160,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560595160","product_id":100020801,"comment_content":"redo 只有innodb有，记录的是行为！binlog其实记录的是sql和数据","like_count":0},{"had_liked":false,"id":103487,"user_name":"cz","can_delete":false,"product_type":"c1","uid":1307369,"ip_address":"","ucode":"059BDE273CB5E0","user_header":"https://static001.geekbang.org/account/avatar/00/13/f2/e9/52c5f8c5.jpg","comment_is_top":false,"comment_ctime":1560453347,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560453347","product_id":100020801,"comment_content":"老师，我想问一下，如果我做一个更新操作，此时更新语句是成功执行了的，但是做redo log的时候失败写入，那么此时表中的值还是更新后的值吧<br><br>还有一个问题就是在做两次提交的先后顺序的时候，我先做的bin log日志写入，redo log写入失败，您文章中说到，先恢复表数据的时候会多出一个事务，这块有点不大明白，都是恢复数据，我们要的结果不就是保证数据的一致性嘛，这样binlog日志也可以实现数据的一致性，为什么会多出一个事务呢？","like_count":0},{"had_liked":false,"id":103386,"user_name":"龙猫","can_delete":false,"product_type":"c1","uid":1228191,"ip_address":"","ucode":"F0FC59632BC6F6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJB6kaR6vXGP95RvKy6GnmT33EEAkoPJrUCENE0ankWfKicm6QMbfw6yiadNJlIPZEIlPYgIm8mYEwg/132","comment_is_top":false,"comment_ctime":1560426960,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560426960","product_id":100020801,"comment_content":"在两阶段提交过程中。如果binlog写入成功后mysql crash，这个时候redo log的日志是prepare状态。怎么解决呢？mysql还是不能区分mysql是在binlog写入成功后crash还是之前crash。","like_count":0},{"had_liked":false,"id":103187,"user_name":"冷夜雨","can_delete":false,"product_type":"c1","uid":1047729,"ip_address":"","ucode":"4BD3942F91C854","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fc/b1/e1f906fa.jpg","comment_is_top":false,"comment_ctime":1560393572,"is_pvip":false,"replies":[{"id":"37612","content":"一直有一个线程在归档的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1560585558,"ip_address":"","comment_id":103187,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560393572","product_id":100020801,"comment_content":"老师 既然write pos 会赶上checkout的时候对吧，那我的问题是 当粉版满了 暂停后做一部分归档 ,那么是不应该有阈值 比如达到90%的时候 启动一个线程 来做归档  这样就不用暂停了吧","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453777,"discussion_content":"一直有一个线程在归档的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560585558,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":103106,"user_name":"昨夜的柠檬","can_delete":false,"product_type":"c1","uid":1125511,"ip_address":"","ucode":"C5829C29FB3E34","user_header":"https://static001.geekbang.org/account/avatar/00/11/2c/87/9a3d80dc.jpg","comment_is_top":false,"comment_ctime":1560385517,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560385517","product_id":100020801,"comment_content":"老师，会出现redo log prepare写成功，bin log写成功，最后redo log提交失败的情况吗？如果会，此时redo kog和bin log的状态岂不是不一致？","like_count":0},{"had_liked":false,"id":102780,"user_name":"史鹏飞","can_delete":false,"product_type":"c1","uid":1497528,"ip_address":"","ucode":"39D9A28082C0BE","user_header":"https://static001.geekbang.org/account/avatar/00/16/d9/b8/2d8900d5.jpg","comment_is_top":false,"comment_ctime":1560304442,"is_pvip":false,"replies":[{"id":"37377","content":"是的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1560422171,"ip_address":"","comment_id":102780,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560304442","product_id":100020801,"comment_content":"林老师，redo log是存储在硬盘上的吗？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453576,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560422171,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":102433,"user_name":"gkb111","can_delete":false,"product_type":"c1","uid":1224217,"ip_address":"","ucode":"9B3154BCC9046B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLLUic3XzxET3L3QXxcTbeg96GMx1HkiaiaZdudchmOmtPnuEPHK5vYEeMkvJR098XljMbXDialYib3z6w/132","comment_is_top":false,"comment_ctime":1560220583,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560220583","product_id":100020801,"comment_content":"redo日志，bin日志，备份，一天一倍","like_count":0},{"had_liked":false,"id":101917,"user_name":"王虎","can_delete":false,"product_type":"c1","uid":1046622,"ip_address":"","ucode":"BE80327F2E6102","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/5e/169b7acb.jpg","comment_is_top":false,"comment_ctime":1560051996,"is_pvip":false,"replies":[{"id":"37384","content":"不会<br><br>就算事务放弃了，redolog也留着，<br>redolog循环写的，下次循环回来就覆盖掉了","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1560422473,"ip_address":"","comment_id":101917,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560051996","product_id":100020801,"comment_content":"看上去数据库正常关闭会清空redolog？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453172,"discussion_content":"不会\n\n就算事务放弃了，redolog也留着，\nredolog循环写的，下次循环回来就覆盖掉了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560422473,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":101468,"user_name":"Rainman","can_delete":false,"product_type":"c1","uid":1025931,"ip_address":"","ucode":"6FD00E587EA4CF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a7/8b/208d9e2c.jpg","comment_is_top":false,"comment_ctime":1559813934,"is_pvip":false,"replies":[{"id":"36728","content":"1. 是的，这个事务还没有提交，没有提交的事务的更新，对其他事务是不可见的；<br>2. 好问题。<br>   是的，一个数据行的trx_id是一个数据的一部分，写磁盘的时候也是带着的。","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1560040945,"ip_address":"","comment_id":101468,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1559813934","product_id":100020801,"comment_content":"@小张 的留言，我想扩展一下。<br>1. redo log写入内存的数据，是跟各个事务绑定的。<br><br>假设 ID为2的数据c=1。<br>执行更新语句 update T set c=c+1 where ID=2; <br><br>在更新语句执行过程中，写入了redo log，但未两阶段提交。此时，是不是只有当前事务才能读取到c=2?<br><br>2.@小张 的留言下“即使写进磁盘，也没关系，再次读到内存以后，还是原来的逻辑”，老师能否扩展下这个解答。是不是指，即便写到磁盘，磁盘的数据也有事务版本信息来保障？<br><br>谢谢老师。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452977,"discussion_content":"1. 是的，这个事务还没有提交，没有提交的事务的更新，对其他事务是不可见的；\n2. 好问题。\n   是的，一个数据行的trx_id是一个数据的一部分，写磁盘的时候也是带着的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560040945,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":101235,"user_name":"张sir","can_delete":false,"product_type":"c1","uid":1209431,"ip_address":"","ucode":"52958DF6705208","user_header":"https://static001.geekbang.org/account/avatar/00/12/74/57/7b828263.jpg","comment_is_top":false,"comment_ctime":1559745871,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559745871","product_id":100020801,"comment_content":"一天一备应该会对数据库的IO造成压力","like_count":0},{"had_liked":false,"id":100389,"user_name":"小武","can_delete":false,"product_type":"c1","uid":1562946,"ip_address":"","ucode":"F8BF3F6EC36CBD","user_header":"https://static001.geekbang.org/account/avatar/00/17/d9/42/93fb1fdc.jpg","comment_is_top":false,"comment_ctime":1559544181,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559544181","product_id":100020801,"comment_content":"我有一个问题，如果在事务提交之后，redolog没有由prepare变成commit，redlog记录的这一次事务会被回滚吗？还是有什么特殊手段保证事务提交一定把redolog变成commit？","like_count":0},{"had_liked":false,"id":99995,"user_name":"怒龙ｚｈａｏ","can_delete":false,"product_type":"c1","uid":1547898,"ip_address":"","ucode":"67E52C7C1C8088","user_header":"https://static001.geekbang.org/account/avatar/00/17/9e/7a/0880ee6f.jpg","comment_is_top":false,"comment_ctime":1559381692,"is_pvip":false,"replies":[{"id":"37466","content":"不会，redo 如果没有commit，这个事务就回滚","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1560473183,"ip_address":"","comment_id":99995,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1559381692","product_id":100020801,"comment_content":"之前好像说redo log是prepare状态，当写完bin log后，才会调用commit接口，让redo log变成commit，那么如果bin log写完后，调用commit的时候出异常了，是不是bin log和redo log的记录不一致了？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452357,"discussion_content":"不会，redo 如果没有commit，这个事务就回滚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560473183,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99840,"user_name":"陈凡及格","can_delete":false,"product_type":"c1","uid":1226851,"ip_address":"","ucode":"C9EA565DC02BF4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJsLmETyjgibSegibNpyibia4elbVBBEgQRKibsIqXfVgSUu6Ztc4hI3j8sXibnX895eL85V6y5vk13r7EA/132","comment_is_top":false,"comment_ctime":1559319061,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559319061","product_id":100020801,"comment_content":"redo 日志放到磁盘还是内存中了？","like_count":0},{"had_liked":false,"id":99406,"user_name":"tommy","can_delete":false,"product_type":"c1","uid":1062373,"ip_address":"","ucode":"E6EDD4ECBA01D6","user_header":"https://static001.geekbang.org/account/avatar/00/10/35/e5/0b60d57e.jpg","comment_is_top":false,"comment_ctime":1559208279,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559208279","product_id":100020801,"comment_content":"具体来说，当有一条记录需要更新的时候，InnoDB引擎就会先把记录写到redo log（粉板）里面，并更新内存，这个时候更新就算完成了。<br>里面提到的“并更新内存”是更新的什么东西？","like_count":0},{"had_liked":false,"id":99331,"user_name":"泥鳅儿","can_delete":false,"product_type":"c1","uid":1323000,"ip_address":"","ucode":"26B47C8FC67615","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ojfRyNRvy1x3Mia0nssz6CNPHrHXwPPmibvds1URgoHQuKXrGiaxrEbsT6sAvuK4N4AOicySh8S9iaWcOLjteOl6Kgg/132","comment_is_top":false,"comment_ctime":1559194673,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559194673","product_id":100020801,"comment_content":"老师，那个两阶段提交 如果在写完binlog时服务故障重启了，这时redo log还没有修改为提交状态该怎么办，还是说存储引擎不会受到影响，","like_count":0},{"had_liked":false,"id":99294,"user_name":"Geek_89bbab","can_delete":false,"product_type":"c1","uid":1156607,"ip_address":"","ucode":"B3110D5B3C9500","user_header":"https://static001.geekbang.org/account/avatar/00/11/a5/ff/6201122c.jpg","comment_is_top":false,"comment_ctime":1559187278,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559187278","product_id":100020801,"comment_content":"老师，如果一个应用程序向数据库服务器发生了一个这个请求<br><br>begin；<br>update vote_tb set vote=vote+1 where uid=1;<br>commit;<br><br>如果服务器应答了，但是应答丢失了，客户端认为update失败了，但服务器认为自己成功执行了这个事务。这种情况怎么办？该怎么处理呢？","like_count":0},{"had_liked":false,"id":99017,"user_name":"侯恩训","can_delete":false,"product_type":"c1","uid":1162376,"ip_address":"","ucode":"F4DC47EECA0F00","user_header":"https://static001.geekbang.org/account/avatar/00/11/bc/88/fbb6022e.jpg","comment_is_top":false,"comment_ctime":1559130806,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559130806","product_id":100020801,"comment_content":"问题：一天一备会比一周一备更有优势呢？<br>当对系统恢复时间有要求的时候，一天一备恢复时间更短<br><br>","like_count":0},{"had_liked":false,"id":98350,"user_name":"七号叽","can_delete":false,"product_type":"c1","uid":1235812,"ip_address":"","ucode":"0CB7E5C3297511","user_header":"https://static001.geekbang.org/account/avatar/00/12/db/64/f9628492.jpg","comment_is_top":false,"comment_ctime":1558965264,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558965264","product_id":100020801,"comment_content":"老师你好，请问一下两阶段提交会不会有这种状况发生？比如在binlog写入成功后，redo log更新为commit的时候失败（MySQL异常退出等）从而仍然处于prepare阶段？如果有的话，innodb又是如何处理的呢？在重启后会能判断这种状况将这次事务进行提交吗？","like_count":0},{"had_liked":false,"id":98234,"user_name":"Rancood","can_delete":false,"product_type":"c1","uid":1204333,"ip_address":"","ucode":"052BDF2221F480","user_header":"https://static001.geekbang.org/account/avatar/00/12/60/6d/e2576fda.jpg","comment_is_top":false,"comment_ctime":1558938369,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558938369","product_id":100020801,"comment_content":"redo log是物理日志，binlog是逻辑日志，物理日志和逻辑日志怎么去理解","like_count":0},{"had_liked":false,"id":98029,"user_name":"G.S.K","can_delete":false,"product_type":"c1","uid":1222966,"ip_address":"","ucode":"88217F9289EB48","user_header":"https://static001.geekbang.org/account/avatar/00/12/a9/36/d054c979.jpg","comment_is_top":false,"comment_ctime":1558878315,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558878315","product_id":100020801,"comment_content":"请教老师一个问题，lru缓存淘汰时，被淘汰的页如果是个脏页，这个脏页需要写回磁盘。如果redo log中这个脏页更新信息的记录位置在checkpoint点的后边，那么这个脏页在写回磁盘时，redo log是否需要擦除这个脏页更新信息的记录？如果需要擦除这个记录，是否从checkpoint点开始到这个记录之间的所有记录都擦除呢？redo log擦除记录是不是严格按照从checkpoint点开始呢？","like_count":0},{"had_liked":false,"id":97990,"user_name":"一起来学习吧","can_delete":false,"product_type":"c1","uid":1402791,"ip_address":"","ucode":"C0C560A5FB759A","user_header":"https://static001.geekbang.org/account/avatar/00/15/67/a7/4082c642.jpg","comment_is_top":false,"comment_ctime":1558862453,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558862453","product_id":100020801,"comment_content":"binlog向redolog进行commit的阶段失败了会怎么样？","like_count":0},{"had_liked":false,"id":97875,"user_name":"春风和煦","can_delete":false,"product_type":"c1","uid":1464592,"ip_address":"","ucode":"4E2769BDD73291","user_header":"https://static001.geekbang.org/account/avatar/00/16/59/10/c0d24978.jpg","comment_is_top":false,"comment_ctime":1558804219,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1558804219","product_id":100020801,"comment_content":"本节可两个地方觉得需要理解，请老师看看理解的对不对<br>write pos 和 check point的理解：<br>俩人在操场跑圈，规则是：write pos先跑，check point随后出发；当write pos超check point一圈的时候就得停下来等，让check point跑一段再出发；check point不允许超过write pos<br><br>为什么要做两阶段提交：<br>C = 0;   UPDATE T SET C = C + 1 WHERE ID = 1<br>1、先写redo log再写binlog，那么在写完redolog后crash，重启后，数据库中该记录C为1，但是binlog中没这条记录，那么哪天你全量从备份恢复后再根据binlog进行增量恢复时，恢复完的结果就是不一致的<br>2、先写binlog再写redo log，那么在写完binlog之后crash，重启后因为redo log没有，C值为0，但是哪天你全量备份恢复以后根据binlog进行增量恢复时，C值为1，结果不一致了<br>3、先redo log prepare状态，再binlog，然后redo log commit，这样crash之后，根据redo log恢复时根据binlog进行判断，redo log为prepare状态，如果binlog有则继续执行commit，恢复时因为binlog有，所以是一致的，如果binlog没有，则放弃执行，将来根据binlog恢复也是一致的<br><br>","like_count":0},{"had_liked":false,"id":97540,"user_name":"那一夜","can_delete":false,"product_type":"c1","uid":1127542,"ip_address":"","ucode":"AA3C750FF0D744","user_header":"https://static001.geekbang.org/account/avatar/00/11/34/76/d81137fe.jpg","comment_is_top":false,"comment_ctime":1558690020,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558690020","product_id":100020801,"comment_content":"老师你好，innodb_flush_log_at_trx_commit和sync_binlog设置成1，表示每次事务之后刷新到磁盘，这里的刷新到磁盘想问一下是什么意思，是指这时候才写入redo log和bin log吗，还是数据在这里写到数据库的？","like_count":0},{"had_liked":false,"id":97275,"user_name":"wong","can_delete":false,"product_type":"c1","uid":1545351,"ip_address":"","ucode":"748D33EAEBB9E3","user_header":"https://static001.geekbang.org/account/avatar/00/17/94/87/52bfdc9d.jpg","comment_is_top":false,"comment_ctime":1558626267,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558626267","product_id":100020801,"comment_content":"两阶段提交部分：写binlog成功了，但是然后更新redolog prepare-&gt;commit 失败了或者说crash了，是不是还是会造成两中log不一致？求解答~","like_count":0},{"had_liked":false,"id":97195,"user_name":"Linuxer","can_delete":false,"product_type":"c1","uid":1153978,"ip_address":"","ucode":"272D9D8089C3D6","user_header":"https://static001.geekbang.org/account/avatar/00/11/9b/ba/333b59e5.jpg","comment_is_top":false,"comment_ctime":1558605751,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558605751","product_id":100020801,"comment_content":"参考了留言，哪个write pos 和 check point的图还是没看懂。是顺时针走，还是逆时针方向走呢<br>","like_count":0},{"had_liked":false,"id":97164,"user_name":"蓑笠翁","can_delete":false,"product_type":"c1","uid":1209245,"ip_address":"","ucode":"DFC1CA1E21AEB0","user_header":"https://static001.geekbang.org/account/avatar/00/12/73/9d/d85bf2d3.jpg","comment_is_top":false,"comment_ctime":1558599948,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558599948","product_id":100020801,"comment_content":"老师在一个问答里答复redo log要写2次(实际3次)磁盘io，而答复@Elvis的问题时说到redo log不会先写入到缓存，而是直接写盘，那么是redo log处于prepare状态时会写一次盘、commit时再写一次盘吗？多谢指教","like_count":0},{"had_liked":false,"id":97142,"user_name":"Asia","can_delete":false,"product_type":"c1","uid":1419860,"ip_address":"","ucode":"3198DE712494E3","user_header":"https://static001.geekbang.org/account/avatar/00/15/aa/54/a0d379f4.jpg","comment_is_top":false,"comment_ctime":1558596472,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558596472","product_id":100020801,"comment_content":"我尝试自己根据binlog恢复了一下库。<br>首先，binlog_format默认是statement，此外还有rows和mixed。<br>statement模式下记录的是sql语句<br>rows记录的是操作的上下文，相对statement更占空间<br>mixed我理解的是兼容模式，它会自动判断操作场景并最终选择使用statement还是rows模式。<br>但我实际操作发现一个问题，当我tx_isolation设置为read committed&#47;uncommitted时，默认使用statement会报错。<br>我看了下文档和一些大佬的解释还有点懵。。<br>那我可不可以这样理解，由于sbr记录的是sql，所以在rc级别下，不能保证事务中数据的可重复性（不可重复读），而sbr由于记录行数据可以保证这一点？<br>总感觉好像哪里不对。。<br>额，还是有点懵，反正我选择mixed。。","like_count":0},{"had_liked":false,"id":95208,"user_name":"sk","can_delete":false,"product_type":"c1","uid":1063062,"ip_address":"","ucode":"9FC8A04F1E33DB","user_header":"https://static001.geekbang.org/account/avatar/00/10/38/96/afcbac60.jpg","comment_is_top":false,"comment_ctime":1557986428,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557986428","product_id":100020801,"comment_content":"还是没有明白，恢复使用的binlog备份，并没有使用redo log啊。如果是这样的话，这个恢复只和binlog 有关系，两阶段提交的日志，貌似没有起到这个恢复一致性的逻辑。","like_count":0},{"had_liked":false,"id":94878,"user_name":"探索无止境","can_delete":false,"product_type":"c1","uid":1044178,"ip_address":"","ucode":"91D2A9907DFA79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ee/d2/7024431c.jpg","comment_is_top":false,"comment_ctime":1557914777,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557914777","product_id":100020801,"comment_content":"老师你好，我理解的是redo log是系统在发生故障重启之后，会自动执行这个日志，从而保证了数据不丢失，而binlog是当我们需要手工来进行数据恢复的时候，才会用到，不知道这样的理解是否正确？","like_count":0},{"had_liked":false,"id":94864,"user_name":"探索无止境","can_delete":false,"product_type":"c1","uid":1044178,"ip_address":"","ucode":"91D2A9907DFA79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ee/d2/7024431c.jpg","comment_is_top":false,"comment_ctime":1557913034,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557913034","product_id":100020801,"comment_content":"老师你好，我们写入信息到redolog也是持久化，为什么不支持更新磁盘的记录？感觉都是持久化操作，还请解惑，多谢！","like_count":0},{"had_liked":false,"id":93771,"user_name":"Tony Du","can_delete":false,"product_type":"c1","uid":1001661,"ip_address":"","ucode":"F5FCC400E615EA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/48/bd/6c7d4230.jpg","comment_is_top":false,"comment_ctime":1557585550,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557585550","product_id":100020801,"comment_content":"老师，请问InnoDB是怎么保证写redo log和写数据的一致性的？如果发生commit的时候，redo log写成功，但是数据落盘时mysql宕机，重启redo log和实际存储的数据就不一致了，怎么办？","like_count":0},{"had_liked":false,"id":92839,"user_name":"客舟听雨来coding","can_delete":false,"product_type":"c1","uid":1026219,"ip_address":"","ucode":"753F4B779CC416","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a8/ab/5d25cd32.jpg","comment_is_top":false,"comment_ctime":1557334884,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1557334884","product_id":100020801,"comment_content":"老师，你对这问题的回答没看懂，可以详细说一下吗","like_count":0},{"had_liked":false,"id":92293,"user_name":"加勒比海贼王","can_delete":false,"product_type":"c1","uid":1003465,"ip_address":"","ucode":"D922A1A5B3B04B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4f/c9/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1557222948,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1557222948","product_id":100020801,"comment_content":"以前没有开启binlog，现在中途开启的话，可以把以前的数据也存进去吗？","like_count":0},{"had_liked":false,"id":91528,"user_name":"杜美洁","can_delete":false,"product_type":"c1","uid":1514953,"ip_address":"","ucode":"78354D0430C9DF","user_header":"https://static001.geekbang.org/account/avatar/00/17/1d/c9/c22f4e4b.jpg","comment_is_top":false,"comment_ctime":1557049078,"is_pvip":false,"replies":[{"id":"32864","content":"嗯，一个是数据，一个是日志呀😆","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1557155180,"ip_address":"","comment_id":91528,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1557049078","product_id":100020801,"comment_content":"mysql更新操作写磁盘和binlog写磁盘是两个不同的概念吧","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448935,"discussion_content":"嗯，一个是数据，一个是日志呀😆","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557155180,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91225,"user_name":"浩","can_delete":false,"product_type":"c1","uid":1394346,"ip_address":"","ucode":"BD7FE280C83152","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKoGnC6068nQia1bOiaPxMRmkOQsaDsw5ib2drXic4gKOLzIFyZnnFm4uJ6KniboKG1nQD3J15y4d3QxLA/132","comment_is_top":false,"comment_ctime":1556937205,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556937205","product_id":100020801,"comment_content":"看了留言，感觉redolog其实充当缓冲区的作用，减少磁盘io，并同时具备crash-safe能力。疑问是，两阶段提交中，redolog写入成功变为prepare状态，等binlog写入成功，redolog会提交事务，使两个日志的写入都成功，如果提交失败，那么两个日志的写入失效，回滚，其实两阶段提交就是一个事务，这么理解对吗","like_count":0},{"had_liked":false,"id":91089,"user_name":"希","can_delete":false,"product_type":"c1","uid":1034680,"ip_address":"","ucode":"3BD96417BF265A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c9/b8/abe0d903.jpg","comment_is_top":false,"comment_ctime":1556852310,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556852310","product_id":100020801,"comment_content":"看了文章和评论后，还是有一个关于两阶段提交的疑问：<br>\tredo log prepare完成，binlog也写入成功，但是redo log commit前出现crash，导致提交不成功，那么下次重启后redo log会重新commit吗？<br>\t1）如果会，那么假如在重启前做数据恢复（也就是不给redo log重新commit的机会），是否会出现恢复了binlog中对应于redo log中未commit的纪录？<br>\t2）如果不会，那么redo log prepare的纪录和binlog中写入成功的纪录，会怎么处理？","like_count":0},{"had_liked":false,"id":90190,"user_name":"Geek_743a47","can_delete":false,"product_type":"c1","uid":1480471,"ip_address":"","ucode":"8D10E23A078330","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI5na6qtIrtPaI09iahKgA26u2hnFWy77ia0wIkToMYZhdEo3M5XZWO3NchiblmJUeuQVpabMeZerk9Q/132","comment_is_top":false,"comment_ctime":1556444367,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556444367","product_id":100020801,"comment_content":"redolog是做灾备的，binlog是做备份的，上面写到redolog满了或者空闲的时候写入表（账本）中，代表redolog是写入表中的原始数据，那其它非innodb存储引擎的呢，根据什么写入表中呢","like_count":0},{"had_liked":false,"id":90173,"user_name":"Geek_743a47","can_delete":false,"product_type":"c1","uid":1480471,"ip_address":"","ucode":"8D10E23A078330","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI5na6qtIrtPaI09iahKgA26u2hnFWy77ia0wIkToMYZhdEo3M5XZWO3NchiblmJUeuQVpabMeZerk9Q/132","comment_is_top":false,"comment_ctime":1556439171,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556439171","product_id":100020801,"comment_content":"innodb_flush_log_at_trx_commit<br>和<br>sync_binlog<br>分别对应的是redo log和binlog写入磁盘的策略吧","like_count":0},{"had_liked":false,"id":90078,"user_name":"客舟听雨来coding","can_delete":false,"product_type":"c1","uid":1026219,"ip_address":"","ucode":"753F4B779CC416","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a8/ab/5d25cd32.jpg","comment_is_top":false,"comment_ctime":1556410892,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1556410892","product_id":100020801,"comment_content":"两阶段提交，如果在写入binlog后，准备提交事务MySQL异常重启导致本次提交不了事务。那么是不是需要等重启后才提交事务。如果是的话，应用层在数据库异常重启时发现数据库错误可能做了别的操作，这样会导致一些奇怪的bug。如果不是的话，也就是这次的数据写入就得不到更新是吗？但是已经写入redo log，后续还是会得到更新","like_count":0},{"had_liked":false,"id":89702,"user_name":"今夜秋风和","can_delete":false,"product_type":"c1","uid":1434066,"ip_address":"","ucode":"453C8197FFC81D","user_header":"https://static001.geekbang.org/account/avatar/00/15/e1/d2/42ad2c87.jpg","comment_is_top":false,"comment_ctime":1556246618,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556246618","product_id":100020801,"comment_content":"两阶段的提交类似于一个原子特性，不能分割，一次成功或一次失败。redo log 循环写，和磁盘查找数据的时候怎么对应的？","like_count":0},{"had_liked":false,"id":89455,"user_name":"如果","can_delete":false,"product_type":"c1","uid":1320638,"ip_address":"","ucode":"138A3EEEE50850","user_header":"","comment_is_top":false,"comment_ctime":1556178257,"is_pvip":false,"replies":[{"id":"32282","content":"😆👍","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1556384607,"ip_address":"","comment_id":89455,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1556178257","product_id":100020801,"comment_content":"DAY2，打卡","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448141,"discussion_content":"😆👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556384607,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89398,"user_name":"伟伟哦","can_delete":false,"product_type":"c1","uid":1394961,"ip_address":"","ucode":"51E5FC28E6F0B3","user_header":"https://static001.geekbang.org/account/avatar/00/15/49/11/31d961a1.jpg","comment_is_top":false,"comment_ctime":1556163476,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556163476","product_id":100020801,"comment_content":"引擎将这行新数据更新到内存中，同时将这个更新操作记录到 redo log 里面，此时 redo log 处于 prepare 状态。然后告知执行器执行完成了，随时可以提交事务。<br><br>如果在这我crash了，是不是也是没有这条语句，回复的时候与源库不一致<br><br>执行器生成这个操作的 binlog，并把 binlog 写入磁盘。<br>执行器调用引擎的提交事务接口，引擎把刚刚","like_count":0},{"had_liked":false,"id":89394,"user_name":"伟伟哦","can_delete":false,"product_type":"c1","uid":1394961,"ip_address":"","ucode":"51E5FC28E6F0B3","user_header":"https://static001.geekbang.org/account/avatar/00/15/49/11/31d961a1.jpg","comment_is_top":false,"comment_ctime":1556163227,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556163227","product_id":100020801,"comment_content":"问下更新流程也是先写redo log 后写binlog<br><br><br><br>","like_count":0},{"had_liked":false,"id":88869,"user_name":"dayBlade","can_delete":false,"product_type":"c1","uid":1510022,"ip_address":"","ucode":"955A31A93EB02F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLVLGcUR9ibnyvzKcQ1eG8rf7d95fh3uUNO8cXxkeL8CUyDwssfXNbHdicAuicrcmeDXpreVNYibQuGGQ/132","comment_is_top":false,"comment_ctime":1556017240,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556017240","product_id":100020801,"comment_content":"这是我看到现在最清晰的评论","like_count":0},{"had_liked":false,"id":87974,"user_name":"rocky","can_delete":false,"product_type":"c1","uid":1084108,"ip_address":"","ucode":"A7D5565F441117","user_header":"https://static001.geekbang.org/account/avatar/00/10/8a/cc/23107392.jpg","comment_is_top":false,"comment_ctime":1555774808,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555774808","product_id":100020801,"comment_content":"1.redo log prepare<br>2.写binlog <br>3.redo log commit<br><br>a.当在2之前崩溃时<br>重启恢复：发现没有commit，事务回滚。<br>备份恢复：没有binlog 。<br>两种方式恢复的数据库一致，没毛病！<br><br>b.当在3之前崩溃<br>重启恢复：虽没有commit，但满足prepare和binlog完整，所以重启后会自动commit。<br>备份恢复：有binlog.<br>两种方式恢复的数据库一致，没毛病！<br><br>总结:<br>1.数据一致性指的是数据库通过重启恢复的数据和通过备份恢复的数据要保持一致<br>2.重启恢复用的是redo log，备份恢复用的是binlog<br>3.两阶段提交，其实就是利用了redo log的crash-safe特性<br>4.我理解的crash-safe，其实就是redo log在恢复阶段可以跟binlog进行对比，从而决定要不要写入磁盘的特性。若两者一致，即使redo log没有commit也能写入磁盘；如果binlog已经写完成了，也不可能存在不一致的情况。而binlog不支持这一点，所以binlog没有crash-safe特性。","like_count":0},{"had_liked":false,"id":87911,"user_name":"暮夜天璇","can_delete":false,"product_type":"c1","uid":1487218,"ip_address":"","ucode":"6003A04D264B5D","user_header":"https://static001.geekbang.org/account/avatar/00/16/b1/72/25c952ca.jpg","comment_is_top":false,"comment_ctime":1555750221,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555750221","product_id":100020801,"comment_content":"林老师好，有个地方我有点糊涂。您在介绍如果不是“2阶段提交“时会发生的2中情况时，先写完redolog指的是写入redolog并发生提交了是吗？如果写入redolog，在commit之前就发生crash，那数据库重启恢复后，c的值会是1吗，还是0。","like_count":0},{"had_liked":false,"id":87615,"user_name":"Dolphin","can_delete":false,"product_type":"c1","uid":1284855,"ip_address":"","ucode":"0481DE78AE7CB5","user_header":"https://static001.geekbang.org/account/avatar/00/13/9a/f7/6ff76318.jpg","comment_is_top":false,"comment_ctime":1555641910,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555641910","product_id":100020801,"comment_content":"老师你好，我有一个问题需要请教，当有一个update操作后，记录到了redo log，还没有commit，这个commit 是指什么意思？如果这时候再有select 查询操作的话是怎么执行的 ？","like_count":0},{"had_liked":false,"id":87205,"user_name":"牛牛","can_delete":false,"product_type":"c1","uid":1194626,"ip_address":"","ucode":"CFCE68B4F92209","user_header":"https://static001.geekbang.org/account/avatar/00/12/3a/82/1ff83a38.jpg","comment_is_top":false,"comment_ctime":1555547882,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555547882","product_id":100020801,"comment_content":"老师、你好、回来二刷、比以前感觉好多了、还有不明白的地方、想请教下<br><br>redo log的二阶段提交那里、<br>1 redo log prepare<br>2 binlog<br>3 redolog commit<br>此时、事务才完整、认为有效事务、如果1、2完成、3之前系统crash、<br>mysql检测到binlog和redo log都是完整的、会自动将redo logcommit、认为本次事务有效<br><br>我的疑问是、如果是一阶段提交、不管先redo log还是先binlog都可以、<br>首先、这在系统正常运行时不会有问题、<br>假如系统crash、此时也去检测两个日志的完整性和差异性、然后再决定要不要恢复呢？这样是不是可以？<br><br>我的理解：<br>1之前crash、两个log都没有、不用管<br>1、2之间crash、mysql能检测到两个log的trx数量不一致、也认为无效<br>2、3之间crash、trx数量一致、会检测两个log的完整性？<br><br>那按照这个逻辑、不做两阶段提交、每次crash都检测两个log的完整性和trx数、是不是可以？<br><br>多谢老师～、不知道我的理解有问题没？<br>还有个疑问、binlog有固定格式、可以校验完整性、redo log呢？任何校验？<br>","like_count":0},{"had_liked":false,"id":87140,"user_name":"暮雨","can_delete":false,"product_type":"c1","uid":1176426,"ip_address":"","ucode":"4B7F4932446EF7","user_header":"https://static001.geekbang.org/account/avatar/00/11/f3/6a/6d82e7a3.jpg","comment_is_top":false,"comment_ctime":1555516868,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555516868","product_id":100020801,"comment_content":"没有做数据库备份，能否通过这两个日志文件将数据恢复","like_count":0},{"had_liked":false,"id":86546,"user_name":"Smile°小太阳(ง ˙o˙)ว","can_delete":false,"product_type":"c1","uid":1334941,"ip_address":"","ucode":"5EE5CA396CA621","user_header":"https://static001.geekbang.org/account/avatar/00/14/5e/9d/36df7dc4.jpg","comment_is_top":false,"comment_ctime":1555396438,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555396438","product_id":100020801,"comment_content":" Redo log不是记录数据页“更新之后的状态”，而是记录这个页 “做了什么改动”。感觉不太理解，可以更详细些吗","like_count":0},{"had_liked":false,"id":86346,"user_name":"拯救地球好累","can_delete":false,"product_type":"c1","uid":1339022,"ip_address":"","ucode":"7643439601EF4C","user_header":"https://static001.geekbang.org/account/avatar/00/14/6e/8e/5d309a85.jpg","comment_is_top":false,"comment_ctime":1555371066,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555371066","product_id":100020801,"comment_content":"redo log是用于crash-safe的，在存储引擎层写入，是物理日志。<br>binlog是用于备份恢复的，在执行器中写入，是逻辑日志。<br>通过两阶段提交可以维护两者数据的一致性。","like_count":0},{"had_liked":false,"id":85670,"user_name":"学渣要每日进步","can_delete":false,"product_type":"c1","uid":1111434,"ip_address":"","ucode":"0EB5CB54F2E890","user_header":"https://static001.geekbang.org/account/avatar/00/10/f5/8a/e0fa8730.jpg","comment_is_top":false,"comment_ctime":1555169066,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1555169066","product_id":100020801,"comment_content":"老师，接着文@雨露同学的问题。Binlog如果已经接受，那么redolog是prepare, binlog已经完整了，这时候崩溃恢复过程会认可这个事务，提交掉。 这种情况业务端会当成更新失败来处理，这个会不会和业务逻辑处理矛盾了。","like_count":0},{"had_liked":false,"id":84780,"user_name":"QW","can_delete":false,"product_type":"c1","uid":1493185,"ip_address":"","ucode":"71B298F207BD69","user_header":"https://static001.geekbang.org/account/avatar/00/16/c8/c1/60235576.jpg","comment_is_top":false,"comment_ctime":1554906542,"is_pvip":false,"replies":[{"id":"30742","content":"关了binlog没有两阶段提交<br><br>这两个参数只是控制写潘策略，两阶段的每个阶段执行步骤都还在的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1555146366,"ip_address":"","comment_id":84780,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1554906542","product_id":100020801,"comment_content":"大佬，我想问问innodb_flush_log_at_trx_commit 和sync_binlog 两个参数不同的值对mysql 两阶段提交的影响","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446445,"discussion_content":"关了binlog没有两阶段提交\n\n这两个参数只是控制写潘策略，两阶段的每个阶段执行步骤都还在的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555146366,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":84602,"user_name":"坐看云起","can_delete":false,"product_type":"c1","uid":1488152,"ip_address":"","ucode":"7D47D5EBE7F2A8","user_header":"https://static001.geekbang.org/account/avatar/00/16/b5/18/7fa93717.jpg","comment_is_top":false,"comment_ctime":1554883902,"is_pvip":false,"replies":[{"id":"30749","content":"你可以用事务验证一下<br>先构造一个querycache<br>然后启动一个事务<br>begin;<br>update ....<br>select ... &#47;&#47;看看这里还能不能用上查询缓存😆<br>commit ","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1555147342,"ip_address":"","comment_id":84602,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1554883902","product_id":100020801,"comment_content":"缓存失效是在刷新内存之后呢，还是在commit成功之后呢？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446398,"discussion_content":"你可以用事务验证一下\n先构造一个querycache\n然后启动一个事务\nbegin;\nupdate ....\nselect ... //看看这里还能不能用上查询缓存😆\ncommit ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555147342,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":84093,"user_name":"杨春鹏","can_delete":false,"product_type":"c1","uid":1172056,"ip_address":"","ucode":"518F38232F97B5","user_header":"https://static001.geekbang.org/account/avatar/00/11/e2/58/8c8897c8.jpg","comment_is_top":false,"comment_ctime":1554781796,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554781796","product_id":100020801,"comment_content":"既然有了buffer pool，为什么还要存在QCache?","like_count":0},{"had_liked":false,"id":83550,"user_name":"Geek_6064de","can_delete":false,"product_type":"c1","uid":1484426,"ip_address":"","ucode":"3D994C104BA9CC","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/d17fK3ewEw349ITn1rQk16VGDe2xr29aMEESbrv0OEgEmtfaHkCLqRiauYRBiblGEZLCovArrAL5AibjI5K7zib4Sw/132","comment_is_top":false,"comment_ctime":1554646801,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554646801","product_id":100020801,"comment_content":"binlog似乎还有第三种mixed模式？","like_count":0},{"had_liked":false,"id":83503,"user_name":"南山","can_delete":false,"product_type":"c1","uid":1119593,"ip_address":"","ucode":"94656FE4A6C378","user_header":"https://static001.geekbang.org/account/avatar/00/11/15/69/187b9968.jpg","comment_is_top":false,"comment_ctime":1554630867,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1554630867","product_id":100020801,"comment_content":"老师，这里有一个问题没有想明白，更新的数据会写入内存，再写入redo log，然后写binlog，再改redo log为commit状态。那后续访问这条记录的查询是访问的内存对吧？如果是访问内存，如果访问这条记录的时间点是修改redo log为commit之前，那允许访问吗？还是需要结合事务的隔离级别来看呢？","like_count":0},{"had_liked":false,"id":83264,"user_name":"李拉东","can_delete":false,"product_type":"c1","uid":1228154,"ip_address":"","ucode":"C7697BF078B8C9","user_header":"https://static001.geekbang.org/account/avatar/00/12/bd/7a/506c77fe.jpg","comment_is_top":false,"comment_ctime":1554502654,"is_pvip":false,"replies":[{"id":"30154","content":"有表空间id，勉强可以跟“表”对应起来，不过没有 “字段”的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1554616221,"ip_address":"","comment_id":83264,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1554502654","product_id":100020801,"comment_content":"参考书《数据库系统实现》中，将redo log的记录格式描述为&lt;t,表，字段，值&gt;，即幂等。这里是否和您的操作记录说法有冲突？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445945,"discussion_content":"有表空间id，勉强可以跟“表”对应起来，不过没有 “字段”的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554616221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":83114,"user_name":"Flash","can_delete":false,"product_type":"c1","uid":1236163,"ip_address":"","ucode":"E285075C9E0B02","user_header":"https://static001.geekbang.org/account/avatar/00/12/dc/c3/e4ba51d5.jpg","comment_is_top":false,"comment_ctime":1554429024,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554429024","product_id":100020801,"comment_content":"数据更新频繁的场景，一天一备更有优势；<br>容错指标。","like_count":0},{"had_liked":false,"id":83032,"user_name":"唯笑","can_delete":false,"product_type":"c1","uid":1448680,"ip_address":"","ucode":"0D877D3CA04817","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/GricLGAeWwwXItvlgQZpHYgibhuVcWG9a7smjXWTdvS7nwyxRc8KEYwmr3dPkFYgrvgyl5qRZ0vbhtfoB9R8FPibQ/132","comment_is_top":false,"comment_ctime":1554377792,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554377792","product_id":100020801,"comment_content":"请问，结构图里面分析器指向查询缓存是什么意思？如果是更新语句直接清空缓存的意思嘛？","like_count":0},{"had_liked":false,"id":81814,"user_name":"tjudream","can_delete":false,"product_type":"c1","uid":1104851,"ip_address":"","ucode":"A81870769C5E15","user_header":"https://static001.geekbang.org/account/avatar/00/10/db/d3/d71622c8.jpg","comment_is_top":false,"comment_ctime":1554040284,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554040284","product_id":100020801,"comment_content":"学习笔记：<br>1. 一条update语句的执行流程<br>（1）通过连接器连接到数据库<br>（2）清除该表相关的查询缓存，不知道数据库是否会智能到只选择相关字段的缓存清除<br>（3）分析器：词法分析和语法分析<br>（4）优化器：选择索引<br>（5）执行器：调用存储引擎接口更新数据，同时写binlog<br>（6）存储引擎：更新数据，如果是innodb引擎，同时写redolog<br>2. redolog和binlog<br>（1）所属不一样：redolog是innodb特有的，binlog是mysql server层的<br>（2）redolog是物理层的，记录的是“在某个数据页上的修改”，因为redolog是存储引擎层的，所以它记录更底层的信息，如果引擎层不告诉server这些信息，server是无法获知的；<br>binlog是逻辑层的，记录的是从语句分析获取的信息<br>（3）redolog大小固定，循环写，写满时需要刷入到磁盘，也就意味着刷完磁盘后，就不能通过redolog分析出之前都做了什么了；<br>binlog是追加写的，理论上来说如果磁盘空间无限可以无限的写下去，binlog也称为归档日志，如果你不删除binlog，你可以通过binlog查出任意时间点的操作<br>3. 两阶段提交：保证事务。这个算法在分布式事务的场景下也可以使用","like_count":0},{"had_liked":false,"id":81438,"user_name":"半斤八两","can_delete":false,"product_type":"c1","uid":1067622,"ip_address":"","ucode":"973F074F0E899E","user_header":"https://static001.geekbang.org/account/avatar/00/10/4a/66/d3d19642.jpg","comment_is_top":false,"comment_ctime":1553913901,"is_pvip":false,"replies":[{"id":"29651","content":"磁盘上","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1554052036,"ip_address":"","comment_id":81438,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553913901","product_id":100020801,"comment_content":"老师redo log, undo log, binlog都在哪里存储呢，内存吗","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445197,"discussion_content":"磁盘上","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554052036,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81404,"user_name":"allean","can_delete":false,"product_type":"c1","uid":1051470,"ip_address":"","ucode":"A0D2DB4F219EAA","user_header":"https://static001.geekbang.org/account/avatar/00/10/0b/4e/fd946cb2.jpg","comment_is_top":false,"comment_ctime":1553904461,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553904461","product_id":100020801,"comment_content":"innodb_flush_log_at_trx_commit 这个参数设置成 1 的时候，表示每次事务的 redo log 都直接持久化到磁盘。这个参数我建议你设置成 1，这样可以保证 MySQL 异常重启之后数据不丢失。<br>____________________原文引用____________<br>每次都持久化到磁盘，那“粉板”的作用还能发挥减少随机写磁盘的优势吗？这不是和“粉板”的初衷相背离了吗？","like_count":0},{"had_liked":false,"id":81379,"user_name":"明石","can_delete":false,"product_type":"c1","uid":1226978,"ip_address":"","ucode":"42ACCC9445CD33","user_header":"https://static001.geekbang.org/account/avatar/00/12/b8/e2/9bf25e0a.jpg","comment_is_top":false,"comment_ctime":1553878393,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553878393","product_id":100020801,"comment_content":"老师好，想请教一个问题，在更新操作的第5步（将更新过后的数据写入内存），此时更新后的数据是有效的吗？（即可被查询到的吗？）如果不是有效的，那么假设redo log不是两阶段提交，在写binlog之前提交是不是也是可行的？因为如果某一次更新操作执行到写binlog时crash了，那么依据binlog恢复出来的数据依然是正确的呀（按照前面假设的那样，此时的更新是无效的，而binlog里也没有记录此次更新）。希望老师有空解答一下，目前为止我对redo log的理解就是，它的存在就是为了保证binlog上的记录都是有效的，不知道这么理解有没有道理。","like_count":0},{"had_liked":false,"id":81343,"user_name":"杨春鹏","can_delete":false,"product_type":"c1","uid":1172056,"ip_address":"","ucode":"518F38232F97B5","user_header":"https://static001.geekbang.org/account/avatar/00/11/e2/58/8c8897c8.jpg","comment_is_top":false,"comment_ctime":1553867072,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553867072","product_id":100020801,"comment_content":"老师，有一点没看懂。<br>最后那个参数设置成1，不就意味着每次更新的时候，redo都直接写入磁盘吗？那i&#47;o操作压力不是很大吗？","like_count":0},{"had_liked":false,"id":80291,"user_name":"williamcai","can_delete":false,"product_type":"c1","uid":1158294,"ip_address":"","ucode":"B158F52C2D39BC","user_header":"https://static001.geekbang.org/account/avatar/00/11/ac/96/46b13896.jpg","comment_is_top":false,"comment_ctime":1553647591,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553647591","product_id":100020801,"comment_content":"有个问题想问一下，执行器执行数据更新，内存更新了，但是还未写入磁盘，这时候读取的数据是更新前还是更新后的","like_count":0},{"had_liked":false,"id":80162,"user_name":"OneThin","can_delete":false,"product_type":"c1","uid":1050458,"ip_address":"","ucode":"506989C201402F","user_header":"https://static001.geekbang.org/account/avatar/00/10/07/5a/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1553611557,"is_pvip":false,"replies":[{"id":"29658","content":"你的理解是对的， <br>trx_id是数据的一个字段，会持久化到磁盘","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1554052943,"ip_address":"","comment_id":80162,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553611557","product_id":100020801,"comment_content":"是不是磁盘中的数据也有事务id，这样如果写完redolog，内存中的数据还没刷到磁盘，系统奔溃重启后可以用redolog来检查当前数据是不是最新的用来恢复","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444767,"discussion_content":"你的理解是对的， \ntrx_id是数据的一个字段，会持久化到磁盘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554052943,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":80064,"user_name":"FollowFlow","can_delete":false,"product_type":"c1","uid":1001212,"ip_address":"","ucode":"267D684C54AF42","user_header":"https://static001.geekbang.org/account/avatar/00/0f/46/fc/cd337487.jpg","comment_is_top":false,"comment_ctime":1553601937,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553601937","product_id":100020801,"comment_content":"请教 redo log 在写盘的时候 依赖操作系统的磁盘刷新吧？如果 redo log 只在磁盘 buffer 里，没有刷到盘上，这个时候操作系统崩溃了。 恢复的时候 会不会丢失数据呢？<br>","like_count":0},{"had_liked":false,"id":80046,"user_name":"FollowFlow","can_delete":false,"product_type":"c1","uid":1001212,"ip_address":"","ucode":"267D684C54AF42","user_header":"https://static001.geekbang.org/account/avatar/00/0f/46/fc/cd337487.jpg","comment_is_top":false,"comment_ctime":1553600059,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553600059","product_id":100020801,"comment_content":"请教您，崩溃恢复过程，在“redolog prepare 并且 binlog 完整” 的情况下，可以自动 commit。假设 binlog 是关闭的，崩溃恢复发现只有 redo log prepare ，这时会发生什么？","like_count":0},{"had_liked":false,"id":80043,"user_name":"FollowFlow","can_delete":false,"product_type":"c1","uid":1001212,"ip_address":"","ucode":"267D684C54AF42","user_header":"https://static001.geekbang.org/account/avatar/00/0f/46/fc/cd337487.jpg","comment_is_top":false,"comment_ctime":1553598897,"is_pvip":false,"replies":[{"id":"32872","content":"在后面的文章中有哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1557159788,"ip_address":"","comment_id":80043,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553598897","product_id":100020801,"comment_content":"redo log 是怎么做到 crash-safe 的？这篇文章几乎没涉及。<br><br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444736,"discussion_content":"在后面的文章中有哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557159788,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79526,"user_name":"蚂蚁内推+v","can_delete":false,"product_type":"c1","uid":1050508,"ip_address":"","ucode":"24B10AEE54B3FD","user_header":"https://static001.geekbang.org/account/avatar/00/10/07/8c/0d886dcc.jpg","comment_is_top":false,"comment_ctime":1553505156,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553505156","product_id":100020801,"comment_content":"只有binlog 可不可以呢？","like_count":0},{"had_liked":false,"id":79207,"user_name":"chitanda","can_delete":false,"product_type":"c1","uid":1235077,"ip_address":"","ucode":"B3E28E1C8E410B","user_header":"https://static001.geekbang.org/account/avatar/00/12/d8/85/21fd42fa.jpg","comment_is_top":false,"comment_ctime":1553401210,"is_pvip":false,"discussion_count":0,"race_medal":2,"score":"1553401210","product_id":100020801,"comment_content":"老师好，请问<br>只有在涉及更新，插入，删除语句的时候会写入redolog和binlog吗？只涉及到查询的语句会不会写redolog和binlog呢？","like_count":0},{"had_liked":false,"id":79193,"user_name":"Seven.Lin澤耿","can_delete":false,"product_type":"c1","uid":1181192,"ip_address":"","ucode":"4CAB732CD6F149","user_header":"https://static001.geekbang.org/account/avatar/00/12/06/08/855abb02.jpg","comment_is_top":false,"comment_ctime":1553398158,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553398158","product_id":100020801,"comment_content":"老师用什么画的图，好小清新","like_count":0},{"had_liked":false,"id":78955,"user_name":"　","can_delete":false,"product_type":"c1","uid":1172538,"ip_address":"","ucode":"DBE2DB5CC52C91","user_header":"https://static001.geekbang.org/account/avatar/00/11/e4/3a/16545faf.jpg","comment_is_top":false,"comment_ctime":1553308246,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553308246","product_id":100020801,"comment_content":"既然redolog 和 binlog通过这样的机制达到了一致性。<br><br>可是也带来了另一个问题，如果一个写入操作发生时，写入成功redolog状态:prepare，写入失败binlog(失败场景断电)。<br>那么再次开机时，redolog就回滚了，并没有起到它作为redolog发生故障时也能恢复数据的作用。","like_count":0},{"had_liked":false,"id":78948,"user_name":"　","can_delete":false,"product_type":"c1","uid":1172538,"ip_address":"","ucode":"DBE2DB5CC52C91","user_header":"https://static001.geekbang.org/account/avatar/00/11/e4/3a/16545faf.jpg","comment_is_top":false,"comment_ctime":1553306304,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553306304","product_id":100020801,"comment_content":"这些日志会记录是只记录“更新操作”而不记录“新增操作”么？<br>如果是只记录更新操作，那么昨天备份的数据是不能恢复到截止今天发生故障时间点之间的任意一个时间点呢。<br><br>一天一备的话更安全，恢复数据也更快。特别是每天的MySQL数据更新操作都很多的情况下。<br><br>从MySQL的角度来说，它是不是可以再次升级（扩展binlog日志，增加与存储引擎通信的协议），让存储引擎只需要它的binlog就够了？<br>","like_count":0},{"had_liked":false,"id":77950,"user_name":"见月明","can_delete":false,"product_type":"c1","uid":1314680,"ip_address":"","ucode":"89D13DFE959344","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIq0R7vjEVNqQhQ7JALNWAnSqoSYuia6aAibGFfnbdVHXQlpWIQyvF4uPSCQu51BSCEw06bPTJs6cgg/132","comment_is_top":false,"comment_ctime":1553045392,"is_pvip":false,"replies":[{"id":"28905","content":"看下15 和23","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1553415785,"ip_address":"","comment_id":77950,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553045392","product_id":100020801,"comment_content":"疑惑：为什么redo log不能像oracle那样归档，然后binlog变为选用呢? 是因为生产中不是只用innodb而是多种引擎同用？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443911,"discussion_content":"看下15 和23","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553415785,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77602,"user_name":"Skye","can_delete":false,"product_type":"c1","uid":1324135,"ip_address":"","ucode":"F2B7E3334D4814","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/67/c1a7586c.jpg","comment_is_top":false,"comment_ctime":1552968425,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552968425","product_id":100020801,"comment_content":"先写 redo log 后写 binlog。假设在 redo log 写完，binlog 还没有写完的时...<br>。。。<br>这一段的时候。写到redo log的日志中，是已经提交的吗？不然怎么可能更新为1.不是会回滚掉吗？<br>上面那个图，不是写到binlog在提交吗？也就是说不会有差异啊。能否帮我解释下这个问题。谢谢。<br><br><br><br>Hi,我鞥呢问下这个","like_count":0},{"had_liked":false,"id":77434,"user_name":"山人","can_delete":false,"product_type":"c1","uid":1302051,"ip_address":"","ucode":"666E99D3CAB955","user_header":"https://static001.geekbang.org/account/avatar/00/13/de/23/be735002.jpg","comment_is_top":false,"comment_ctime":1552924050,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552924050","product_id":100020801,"comment_content":"执行器更行的过程中，先判断数据页是否在innodb_buffer_pool中，然后从数据页中提取出这一行，由执行器执行更新。问题1：这行数据的更新操作c+1是在那块内存区域中进行？问题2：新行更新到内存，就是更新innodb_buffer_pool中对应这行的数据页？","like_count":0},{"had_liked":false,"id":76283,"user_name":"尘封","can_delete":false,"product_type":"c1","uid":1247006,"ip_address":"","ucode":"CEE0C006387A03","user_header":"https://static001.geekbang.org/account/avatar/00/13/07/1e/bdbe93f4.jpg","comment_is_top":false,"comment_ctime":1552567379,"is_pvip":false,"replies":[{"id":"27973","content":"没有","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1552694700,"ip_address":"","comment_id":76283,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1552567379","product_id":100020801,"comment_content":"老师，mysql的执行计划有缓存吗？对于同一类sql不会每次都硬解析吧？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443241,"discussion_content":"没有","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552694700,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":76133,"user_name":"假装自己不胖","can_delete":false,"product_type":"c1","uid":1412994,"ip_address":"","ucode":"308F1BAA96CDA5","user_header":"https://static001.geekbang.org/account/avatar/00/15/8f/82/374f43a1.jpg","comment_is_top":false,"comment_ctime":1552534318,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552534318","product_id":100020801,"comment_content":"redo保存到内存的时间是a,bing log保存的时间是b,那redo保存到磁盘的时间是c<br>那个数据库保存数据的时间是在a,b,c之后?","like_count":0},{"had_liked":false,"id":75203,"user_name":"Newwayy","can_delete":false,"product_type":"c1","uid":1079435,"ip_address":"","ucode":"4881C1D8ABE376","user_header":"https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqfYf9OHUa3bHGPQLia90dlgCa0d647o7iaMtYWtcLiaownDNN6CEZzdyibVs99q0c2hYpFic6VEyJHywQ/0","comment_is_top":false,"comment_ctime":1552363399,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552363399","product_id":100020801,"comment_content":"如果只使用bin log，不用redo log，数据恢复时会多一行数据，与原库不一致。<br><br>bin成功，引擎失败，是否会立即造成mysql不可用？还是说引擎依然可用？（如写了bin之后磁盘满了， 不能再写入，但可用查询。bin有日志，但查不出这条记录？）<br><br>如果bin成功，引起失败，mysql会立马crash，等待重启恢复，那就不存在数据一致性问题。可用看做重启前后是连贯操作。是吧？","like_count":0},{"had_liked":false,"id":75127,"user_name":"Lucus","can_delete":false,"product_type":"c1","uid":1198800,"ip_address":"","ucode":"CE8EB70CB9D9F1","user_header":"https://static001.geekbang.org/account/avatar/00/12/4a/d0/d319c44a.jpg","comment_is_top":false,"comment_ctime":1552356898,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552356898","product_id":100020801,"comment_content":"老师你好，刚刚你讲到了redolog也可以落盘，我想问问落盘也是循环写吗，还是和binlog一样可以保留全量？如果可以保留全量是不是binlog就可以去掉了，毕竟innodb几乎是必选了？","like_count":0},{"had_liked":false,"id":74203,"user_name":"Zhangxuesong","can_delete":false,"product_type":"c1","uid":1396503,"ip_address":"","ucode":"F5C4C3AC9429AD","user_header":"https://static001.geekbang.org/account/avatar/00/15/4f/17/2185685f.jpg","comment_is_top":false,"comment_ctime":1552142487,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552142487","product_id":100020801,"comment_content":"新版界面 看起爱感觉多了好多东西啊.  ^_^","like_count":0},{"had_liked":false,"id":74045,"user_name":"live fast","can_delete":false,"product_type":"c1","uid":1198218,"ip_address":"","ucode":"D5ECDDA2DBE5AE","user_header":"https://static001.geekbang.org/account/avatar/00/12/48/8a/a20396e9.jpg","comment_is_top":false,"comment_ctime":1552093197,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552093197","product_id":100020801,"comment_content":"老师，我有个地方不明白，既然是二阶段提交，如果失败了，redo和binlog里的数据是怎么恢复的？","like_count":0},{"had_liked":false,"id":73909,"user_name":"Leon📷","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1552031021,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552031021","product_id":100020801,"comment_content":"redolog保证事务在异常情况下和数据一致性，binlog保证恢复或者还原的时候数据和现场实际情况的一致性，当然binlog还有给从库同步，保证从库的一致性","like_count":0},{"had_liked":false,"id":73084,"user_name":"行轩","can_delete":false,"product_type":"c1","uid":1053253,"ip_address":"","ucode":"1F76A612AEDAD9","user_header":"https://static001.geekbang.org/account/avatar/00/10/12/45/f1151527.jpg","comment_is_top":false,"comment_ctime":1551794416,"is_pvip":false,"replies":[{"id":"27094","content":"看下15和23 ^_^","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1552112645,"ip_address":"","comment_id":73084,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551794416","product_id":100020801,"comment_content":"老师你好，这里redo log 和binlog 两阶段有点没看明白 <br>分下面几种场景：<br>场景一：redo log 预提交失败，binlog失败  ---&gt; 结果一致<br>场景二：redo log 预提交成功, binlog失败，那么用这两个文件单独恢复的时候 由于是预提交，所以都是0 ---&gt; 结果一致<br>场景三： redo log 预提交成功, binlog成功 ,redo commit 失败  这种情况恢复的时候，不就又出现了不一致嘛？<br>场景四：redo log 预提交成功, binlog成功 ,redo commit 成功，---&gt; 结果一致<br><br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441905,"discussion_content":"看下15和23 ^_^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552112645,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":72712,"user_name":"Geek_2c529b","can_delete":false,"product_type":"c1","uid":1397987,"ip_address":"","ucode":"8030439D873446","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIcibKIFF25l0ibUhNy7cxuxRSw9DwAfaNxvBjoSE26lMMjoy1UkPF46yGvx98QeYUvSa0DfSu47TBA/132","comment_is_top":false,"comment_ctime":1551700680,"is_pvip":false,"replies":[{"id":"27089","content":"物理逻辑日志，确实是更准确的描述","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1552111823,"ip_address":"","comment_id":72712,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551700680","product_id":100020801,"comment_content":"老师你好，我想问下innodb里的redo日志不是纯物理日志吧，应该是物理逻辑日志？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441702,"discussion_content":"物理逻辑日志，确实是更准确的描述","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552111823,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":72657,"user_name":"堵车","can_delete":false,"product_type":"c1","uid":1145404,"ip_address":"","ucode":"7BC1E50A4F8D3D","user_header":"https://static001.geekbang.org/account/avatar/00/11/7a/3c/87e015f8.jpg","comment_is_top":false,"comment_ctime":1551687241,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551687241","product_id":100020801,"comment_content":"两阶段提交时，binlog写入磁盘，commit之前，服务器重启。这时候redo log会发生怎样的变化？是和binlog一起回滚还是再次确认binlog是否写成功？","like_count":0},{"had_liked":false,"id":71674,"user_name":"Demter","can_delete":false,"product_type":"c1","uid":1158439,"ip_address":"","ucode":"BE3B6F726916CE","user_header":"https://static001.geekbang.org/account/avatar/00/11/ad/27/5556ae50.jpg","comment_is_top":false,"comment_ctime":1551409905,"is_pvip":false,"replies":[{"id":"25849","content":"1. 是的<br>2. 23篇checkpoint相关内容看一下<br>3. 自动的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1551426385,"ip_address":"","comment_id":71674,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551409905","product_id":100020801,"comment_content":"redolog的崩溃恢复能力是不是体现在：mysql异常时候更新到内存中的数据丢失了，这时候可以根据redolog中的记录把内存中的这些数据找回来？那如果只这样的话，redolog是如何判断哪些数据丢失了需要找回来呢？redolog恢复数据的过程是自动的还是需要人工操作的呢？<br>   在下菜鸟，问的问题如果太傻请老师多多包涵哈","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441270,"discussion_content":"1. 是的\n2. 23篇checkpoint相关内容看一下\n3. 自动的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551426385,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":71533,"user_name":"Aaaaaaaaaaayou","can_delete":false,"product_type":"c1","uid":1073601,"ip_address":"","ucode":"67BA315B87587D","user_header":"https://static001.geekbang.org/account/avatar/00/10/61/c1/93031a2a.jpg","comment_is_top":false,"comment_ctime":1551364037,"is_pvip":false,"replies":[{"id":"25644","content":"虽然两阶段不是因为这个原因设计的，不过有了两阶段，确保了，只要redo log完整就可以直接认为事务有效，确实减少了崩溃恢复的时间。","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1551367673,"ip_address":"","comment_id":71533,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551364037","product_id":100020801,"comment_content":"看到留言里面说既然恢复的时候可以通过事务 id 去检查 binlog 的完整性，就不需要两阶段提交了。个人认为这可能是一种优化，如果每次都去检查 binlog 就太低效率了，而加上两阶段提交的步骤，进行恢复的时候只有当 redo log 没有提交的时候需要去检查 binlog，而一般在commit阶段失败的概率都很小，所以需要检查binlog完整性的情况也比较少。不知道这样理解正确否","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441191,"discussion_content":"虽然两阶段不是因为这个原因设计的，不过有了两阶段，确保了，只要redo log完整就可以直接认为事务有效，确实减少了崩溃恢复的时间。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551367673,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":71168,"user_name":"L.B.Q.Y","can_delete":false,"product_type":"c1","uid":1069325,"ip_address":"","ucode":"5567989D1CDBBE","user_header":"https://static001.geekbang.org/account/avatar/00/10/51/0d/14d9364a.jpg","comment_is_top":false,"comment_ctime":1551275904,"is_pvip":false,"replies":[{"id":"25486","content":"是，不过顺序写的代价小很多","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1551279249,"ip_address":"","comment_id":71168,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551275904","product_id":100020801,"comment_content":"redo log本身也是一个持续化的存储方式，文件的话，也是存储到磁盘上的，那么写redo log的过程是不是也有磁盘IO的过程。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441023,"discussion_content":"是，不过顺序写的代价小很多","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551279249,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":71093,"user_name":"拉欧","can_delete":false,"product_type":"c1","uid":1206605,"ip_address":"","ucode":"40996A8093A95F","user_header":"https://static001.geekbang.org/account/avatar/00/12/69/4d/81c44f45.jpg","comment_is_top":false,"comment_ctime":1551263820,"is_pvip":false,"replies":[{"id":"25464","content":"是的，所以双1才应该是标配😆","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1551265465,"ip_address":"","comment_id":71093,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551263820","product_id":100020801,"comment_content":"一些对数据高度敏感的业务需要一天一备，比如金融&#47;电商，如果丢失数据是不可接受的","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440986,"discussion_content":"是的，所以双1才应该是标配😆","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551265465,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70771,"user_name":"平安喜乐","can_delete":false,"product_type":"c1","uid":1102350,"ip_address":"","ucode":"B97D8944B0B035","user_header":"https://static001.geekbang.org/account/avatar/00/10/d2/0e/26bf35a4.jpg","comment_is_top":false,"comment_ctime":1551179476,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551179476","product_id":100020801,"comment_content":"故障恢复的时间上","like_count":0},{"had_liked":false,"id":70734,"user_name":"rm","can_delete":false,"product_type":"c1","uid":1129548,"ip_address":"","ucode":"17EAF6256277E4","user_header":"https://static001.geekbang.org/account/avatar/00/11/3c/4c/cd7c8019.jpg","comment_is_top":false,"comment_ctime":1551171216,"is_pvip":false,"replies":[{"id":"25250","content":"1. 看下03、08 两篇<br>2. 看下12篇","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1551181397,"ip_address":"","comment_id":70734,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551171216","product_id":100020801,"comment_content":"本节学习内容：MySQL两个日志：1、redo log，2、binlog<br>功能：redo log日志记录数据库时间区间内做过什么；binlog日志记录了做过什么<br>记录的时间点：数据更新到内存是redo log记录；执行器执行完成后记录binlog。两个日志是事务性的。<br>有几个疑问：1、如果某条数据在更新中，有一个查询此条数据，MySQL是怎么处理的？<br>2、关于check point和write point，它们的位置是不是会变的？比如说当write point要追上check point了，redo log要擦除数据了，它擦除的是哪些数据？<br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440801,"discussion_content":"1. 看下03、08 两篇\n2. 看下12篇","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551181397,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70676,"user_name":"金龙","can_delete":false,"product_type":"c1","uid":1187493,"ip_address":"","ucode":"24B9B8A476DC9A","user_header":"https://static001.geekbang.org/account/avatar/00/12/1e/a5/85b05303.jpg","comment_is_top":false,"comment_ctime":1551161832,"is_pvip":false,"replies":[{"id":"25227","content":"这两个问题看下15和23篇","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1551163344,"ip_address":"","comment_id":70676,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551161832","product_id":100020801,"comment_content":"老师，我有两个疑问<br><br>1. 一个事务中有多个update语句时，两阶段提交是发生在什么时候？<br><br>2. 如果在写入binlog之后，redo log commit之前mysql崩溃，那么虽然崩溃恢复后redo log和binlog是完整的，可以提交事务，但是业务代码该如何处理这种情况？mysql奔溃后，业务代码应该是认为事务没有完成的，然后走了另外的逻辑，但是奔溃恢复后mysql可能又提交了事务，是不是会造成业务数据不一致？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440764,"discussion_content":"这两个问题看下15和23篇","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551163344,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70112,"user_name":"我爱学习","can_delete":false,"product_type":"c1","uid":1043769,"ip_address":"","ucode":"13178DBD04E1FC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ed/39/57d4401a.jpg","comment_is_top":false,"comment_ctime":1550999229,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1550999229","product_id":100020801,"comment_content":"老师，在解释两阶段提交必要性所举的例子中，第二点我有一点疑问<br><br>先写 binlog 后写 redo log。如果在 binlog 写完之后 crash，由于 redo log 还没写，崩溃恢复以后这个事务无效，所以这一行 c 的值是 0。但是 binlog 里面已经记录了“把 c 从 0 改成 1”这个日志。所以，在之后用 binlog 来恢复的时候就多了一个事务出来，恢复出来的这一行 c 的值就是 1，与原库的值不同。<br><br>用户的初衷就是要将c改成1，分两种情况：<br>1: 如果发现没有update成功，就算恢复后再多执行一次update，那么后面binlog日志里面执行两次update的结果也是c=1；<br>2: 用户后面没有多一次update，binlog日志直接恢复成1，虽然与原库里面的0不一致，但是是符合用户预期的啊；<br><br>虽然我知道两阶段提交的必要性，但第二点这个解释，我觉得是不是可以有其他说法？感觉有点钻牛角尖，不过就是觉得有点不太有说服力","like_count":0},{"had_liked":false,"id":68590,"user_name":"vitojiang","can_delete":false,"product_type":"c1","uid":1007150,"ip_address":"","ucode":"5B75CE272C21EF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5e/2e/bc539981.jpg","comment_is_top":false,"comment_ctime":1550551400,"is_pvip":false,"replies":[{"id":"24391","content":"你是说事务执行期间就先写一部分binlog？<br>这样是不行的，会影响binlog的连续性","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1550572043,"ip_address":"","comment_id":68590,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550551400","product_id":100020801,"comment_content":"请教个问题：不用两阶段也可以保证两个log状态的一致性吧，比如先写binlog，在事务提交的时候写redolog，redolog写成功，即事务commit成功，sql执行成功；否则commit失败？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439741,"discussion_content":"你是说事务执行期间就先写一部分binlog？\n这样是不行的，会影响binlog的连续性","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550572043,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68371,"user_name":"雨天","can_delete":false,"product_type":"c1","uid":1056406,"ip_address":"","ucode":"FD9FB404ECA463","user_header":"https://static001.geekbang.org/account/avatar/00/10/1e/96/3162d51f.jpg","comment_is_top":false,"comment_ctime":1550489747,"is_pvip":false,"replies":[{"id":"24235","content":"binlog这时候还没写到磁盘上的，直接删掉binlog cache李忠的内容就可以","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1550501990,"ip_address":"","comment_id":68371,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550489747","product_id":100020801,"comment_content":"老师第五部，如果提交事物失败怎么处理，修改redo log状态失败，怎么回滚binlog?","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439651,"discussion_content":"binlog这时候还没写到磁盘上的，直接删掉binlog cache李忠的内容就可以","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550501990,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":67838,"user_name":"Mingjie","can_delete":false,"product_type":"c1","uid":1356943,"ip_address":"","ucode":"0B83CD820E5F61","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLwVgXx5UCmXuUJIibytjfxlfia7XJBX6ricaVuGpAREA9fm8mK7WwKXEzictLQRIicvrIgRCGtrwfsS9g/132","comment_is_top":false,"comment_ctime":1550293619,"is_pvip":false,"replies":[{"id":"24018","content":"是一组磁盘上的文件<br>","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1550299891,"ip_address":"","comment_id":67838,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550293619","product_id":100020801,"comment_content":"redlog是一个存在于磁盘上的文件 ，不是一个内存文件是吧","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439393,"discussion_content":"是一组磁盘上的文件\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550299891,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":67819,"user_name":"Mingjie","can_delete":false,"product_type":"c1","uid":1356943,"ip_address":"","ucode":"0B83CD820E5F61","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLwVgXx5UCmXuUJIibytjfxlfia7XJBX6ricaVuGpAREA9fm8mK7WwKXEzictLQRIicvrIgRCGtrwfsS9g/132","comment_is_top":false,"comment_ctime":1550285892,"is_pvip":false,"replies":[{"id":"24016","content":"如果你是设置的“双1模式”，“那redo log内存中的执行记录还没来得及写到磁盘里”就意味着事务还没提交，这时候事务回滚不算数据丢失。<br><br>具体可以看15篇和23篇哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1550299782,"ip_address":"","comment_id":67819,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550285892","product_id":100020801,"comment_content":"InnoDB的crash-safe的功能，如果服务器突然掉电，那redo log内存中的执行记录还没来得及写到磁盘里，这部分操作不久丢失了吗？但MySQL一定不会让这种情况发生的，它是通过binlog日志找回的吗？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439385,"discussion_content":"如果你是设置的“双1模式”，“那redo log内存中的执行记录还没来得及写到磁盘里”就意味着事务还没提交，这时候事务回滚不算数据丢失。\n\n具体可以看15篇和23篇哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550299782,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":67640,"user_name":"kabuka","can_delete":false,"product_type":"c1","uid":1246009,"ip_address":"","ucode":"932DD1E875D850","user_header":"https://static001.geekbang.org/account/avatar/00/13/03/39/18956b2e.jpg","comment_is_top":false,"comment_ctime":1550216097,"is_pvip":false,"replies":[{"id":"23986","content":"undolog和redolog的协作关系，看一下08篇；<br>redolog 和 binlog恢复数据问题，看一下15篇^_^","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1550289615,"ip_address":"","comment_id":67640,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550216097","product_id":100020801,"comment_content":"還是不太明白redo和binlog的區別， binlog 記錄的sql  和 redo記錄改動不是一個意思么？都可以通過這個來恢復數據呀，另外是不是還有個undo日誌，這個和redo的協作關係是怎樣的？能否請老師通過具體的日誌內容來講解一下~","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439295,"discussion_content":"undolog和redolog的协作关系，看一下08篇；\nredolog 和 binlog恢复数据问题，看一下15篇^_^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550289615,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":67408,"user_name":"皇甫","can_delete":false,"product_type":"c1","uid":1126865,"ip_address":"","ucode":"6856B2508661E0","user_header":"https://static001.geekbang.org/account/avatar/00/11/31/d1/dc1f9b95.jpg","comment_is_top":false,"comment_ctime":1550140844,"is_pvip":false,"replies":[{"id":"24000","content":"在之前是查缓存，执行语句以后才更新（失效）缓存","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1550298498,"ip_address":"","comment_id":67408,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550140844","product_id":100020801,"comment_content":"有个疑问，更新语句应该是在分析器以后才能确定表名的吧。那它怎么在这之前去清空该表的缓存的呢？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439183,"discussion_content":"在之前是查缓存，执行语句以后才更新（失效）缓存","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550298498,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":66076,"user_name":"何小鸟","can_delete":false,"product_type":"c1","uid":1393196,"ip_address":"","ucode":"8FA4AFBCFD3435","user_header":"","comment_is_top":false,"comment_ctime":1549871242,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1549871242","product_id":100020801,"comment_content":"Red inno独有.不持久保存<br>bin持久存档<br>任何引擎可以使用","like_count":0},{"had_liked":false,"id":65824,"user_name":"帽子掉了","can_delete":false,"product_type":"c1","uid":1174781,"ip_address":"","ucode":"344892D6136346","user_header":"https://static001.geekbang.org/account/avatar/00/11/ec/fd/bad2abf5.jpg","comment_is_top":false,"comment_ctime":1549688660,"is_pvip":false,"replies":[{"id":"23409","content":"这样是担心如果binlog写不成功（比如磁盘满了），事务就来不及回滚了。<br><br>可以看下15篇哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1549874150,"ip_address":"","comment_id":65824,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1549688660","product_id":100020801,"comment_content":"老师您好，我翻遍了答案，感觉您还是没有解释这个问题。<br>二阶段提交能够解决，binlog和redolog的一致性问题，这个是能够得到证明的。但是我的疑惑是，二阶段提交相对于之前的一个方案的优势在哪里？ 具体是先写redolog，再写binlog，然后通过判断binlog是否写完成了同一个事务，来决定redolog是否需要回滚。  <br>因为两阶段提交也要检查binlog和redolog的一致性来决定redolog是否回滚。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438602,"discussion_content":"这样是担心如果binlog写不成功（比如磁盘满了），事务就来不及回滚了。\n\n可以看下15篇哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549874150,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65743,"user_name":"阳光","can_delete":false,"product_type":"c1","uid":1302684,"ip_address":"","ucode":"999603116C3093","user_header":"https://static001.geekbang.org/account/avatar/00/13/e0/9c/1c4d12a6.jpg","comment_is_top":false,"comment_ctime":1549614831,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1549614831","product_id":100020801,"comment_content":"mysql&gt; create table T(ID int primary key, c int);","like_count":0},{"had_liked":false,"id":65044,"user_name":"我已经设置了昵称","can_delete":false,"product_type":"c1","uid":1364034,"ip_address":"","ucode":"ED672C5EBDBDC4","user_header":"https://static001.geekbang.org/account/avatar/00/14/d0/42/6fd01fb9.jpg","comment_is_top":false,"comment_ctime":1549010930,"is_pvip":false,"replies":[{"id":"23069","content":"看一下第15和第23篇哈 ","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1549038934,"ip_address":"","comment_id":65044,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1549010930","product_id":100020801,"comment_content":"redo log有什么用，binlog可以用来恢复数据","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438294,"discussion_content":"看一下第15和第23篇哈 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549038934,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65007,"user_name":"金龟","can_delete":false,"product_type":"c1","uid":1228500,"ip_address":"","ucode":"1C7D35C8AE8D9D","user_header":"https://static001.geekbang.org/account/avatar/00/12/be/d4/ff1c1319.jpg","comment_is_top":false,"comment_ctime":1548998592,"is_pvip":false,"replies":[{"id":"23044","content":"不是这样，你看一下15篇，<br>实际上我们图中的两阶段，都是发生在你的 “4.commit;”这个动作里。","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1549009138,"ip_address":"","comment_id":65007,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548998592","product_id":100020801,"comment_content":"老师我有个问题:<br>1.begin;<br>2.update talble set a=1 where id=1;&#47;&#47;这一步产生redo log 的prepare阶段和binlog了<br>3...其他逻辑操作（比如java里面的判断语句等等）<br>4.commit;<br><br>按照我看评论的说法如果3之前mysql crash掉，再恢复会自动提交，这里应该会有问题吧，因为下面的操作有可能会抛异常回滚之类的","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438269,"discussion_content":"不是这样，你看一下15篇，\n实际上我们图中的两阶段，都是发生在你的 “4.commit;”这个动作里。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549009138,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63930,"user_name":"杰之7","can_delete":false,"product_type":"c1","uid":1297232,"ip_address":"","ucode":"F7DA2E21085332","user_header":"https://static001.geekbang.org/account/avatar/00/13/cb/50/66d0bd7f.jpg","comment_is_top":false,"comment_ctime":1548600192,"is_pvip":false,"replies":[{"id":"22605","content":"👍 ","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1548608451,"ip_address":"","comment_id":63930,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548600192","product_id":100020801,"comment_content":"可不可以叫您奇奇老师，😊,晚上的上一节的留言您让我发微博，这样可以更好帮我解答，我已经发了。<br><br>先回到您的问题，全量备份的周期，在什么场景下，一天一备会比一周更有优势。我觉得对于需要在更短时间内及时更新的数据一天一备更有优势。我想当发生crash之时，对于已经一天一备份的数据，可以立刻找到昨天到之后的所有数据，而一周就没有在这么快的时间上能够找到。<br><br>通过这一节的复习，老师这一节的内容通过恢复过去半个月的某时刻的数据的问题，给我们讲述了redo log与binlog,关键点是两阶段提交。通过反证法的例子给我们介绍了为什么要设计两阶段提交。<br><br>另外，这节还有一个实践性非常强的可做案例，通过binlog和全量备份扩容搭建备份的问题。我之后会先在网上查一些资料，有疑问，在微博上给您留言。<br><br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437769,"discussion_content":"👍 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548608451,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63840,"user_name":"这菜真香呀","can_delete":false,"product_type":"c1","uid":1046661,"ip_address":"","ucode":"13692E295A6A47","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/85/3c072e6f.jpg","comment_is_top":false,"comment_ctime":1548552368,"is_pvip":false,"replies":[{"id":"22570","content":"额 都是重点，不过如果说耗时，确实是刷盘才是主要的耗时的点","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1548566233,"ip_address":"","comment_id":63840,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548552368","product_id":100020801,"comment_content":"老师好，两阶段提交的重点是不是应该是redo log bin log 的刷盘，而非写日志？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437729,"discussion_content":"额 都是重点，不过如果说耗时，确实是刷盘才是主要的耗时的点","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548566233,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63743,"user_name":"vvsuperman","can_delete":false,"product_type":"c1","uid":1021518,"ip_address":"","ucode":"F393A3FB894124","user_header":"https://static001.geekbang.org/account/avatar/00/0f/96/4e/2acbc3a8.jpg","comment_is_top":false,"comment_ctime":1548484028,"is_pvip":false,"replies":[{"id":"22565","content":"15篇和23篇看一下 😆","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1548515642,"ip_address":"","comment_id":63743,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548484028","product_id":100020801,"comment_content":"能否拉出redo和bin在实际环境中一条记录的例子，还是有点绕，感觉是一样的","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437702,"discussion_content":"15篇和23篇看一下 😆","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548515642,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63539,"user_name":"kevinsu","can_delete":false,"product_type":"c1","uid":1078506,"ip_address":"","ucode":"BAD46B815D6A5C","user_header":"https://static001.geekbang.org/account/avatar/00/10/74/ea/10661bdc.jpg","comment_is_top":false,"comment_ctime":1548397002,"is_pvip":false,"replies":[{"id":"22464","content":"👍","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1548399705,"ip_address":"","comment_id":63539,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548397002","product_id":100020801,"comment_content":"---更新操作<br>涉及redo log，binlog<br>redo log是InnoDB引擎 binlog是Server层实现<br>redo log是物理日志，binlog是逻辑日志<br>redo log循环写 binlog追加写<br>数据库恢复-有备份的情况下，首先恢复临时库，然后重放故障时刻的binlog日志！<br>理解俩阶段提交的重要性！！！<br>innodb_flush_log_at_trx_commit参数设置成1，表示每次事务的redo log日志直接持久化到磁盘<br>sync_binlog参数设置成1，表示每次事务的binlog持久化到磁盘<br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437626,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548399705,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63284,"user_name":"summer_7196","can_delete":false,"product_type":"c1","uid":1390813,"ip_address":"","ucode":"B61E9F29D0D8CE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ2QFSebcWYzvSibOicRbaeqGmq1kFuHVvwjadDsicQnIbovlGqSfmfibtib9TSwcIqWfcxkKw8DSxTTVg/132","comment_is_top":false,"comment_ctime":1548316631,"is_pvip":false,"replies":[{"id":"22411","content":"不是😆","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1548321767,"ip_address":"","comment_id":63284,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548316631","product_id":100020801,"comment_content":"binlog设计成逻辑是怕生成的日志过大吗？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437532,"discussion_content":"不是😆","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548321767,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63219,"user_name":"哈哈哈","can_delete":false,"product_type":"c1","uid":1248876,"ip_address":"","ucode":"C40ABE7161EFAE","user_header":"https://static001.geekbang.org/account/avatar/00/13/0e/6c/1f3b1372.jpg","comment_is_top":false,"comment_ctime":1548300890,"is_pvip":false,"replies":[{"id":"22391","content":"“请问库的数据何时刷盘” ----两种情况，redo log在推进checkpoint的时候，和脏页被淘汰出内存的时候；<br><br>第二个问题看第15篇哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1548306968,"ip_address":"","comment_id":63219,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548300890","product_id":100020801,"comment_content":"老师您好，innodb_flush_log_at_trx_commit 设置 1，并且sync_binlog也设置为1，就表示redo log和bin log都是同步刷盘的，而库的数据先写内存，后写磁盘。库的数据保存在内存是安全，因为log中有全量数据可以恢复，请问库的数据何时刷盘，是依赖操作系统的pdflush还是mysql主动调用刷盘的系统调用？这是第一个疑问。第二个疑问是既然binlog中有全量的备份，为什么还需要redo log的，感觉关闭redolog也ok的吧，也没有两阶段提交的问题了？请老师答疑解惑~~","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437506,"discussion_content":"“请问库的数据何时刷盘” ----两种情况，redo log在推进checkpoint的时候，和脏页被淘汰出内存的时候；\n\n第二个问题看第15篇哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548306968,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63206,"user_name":"哈哈哈","can_delete":false,"product_type":"c1","uid":1248876,"ip_address":"","ucode":"C40ABE7161EFAE","user_header":"https://static001.geekbang.org/account/avatar/00/13/0e/6c/1f3b1372.jpg","comment_is_top":false,"comment_ctime":1548299246,"is_pvip":false,"replies":[{"id":"22392","content":"内存里是正确的值，直接从内存读走就行；<br>日志和数据的关系，是日志记录了数据从状态1到状态2的过程<br><br>这个过程持久化了，状态1也是已经持久化到磁盘的，那么状态2就可以不着急一定要写到磁盘。<br>这个是WAL机制的逻辑😆","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1548307050,"ip_address":"","comment_id":63206,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548299246","product_id":100020801,"comment_content":"老师您好，请问日志写刷盘跟修改库的数据这两者什么关系。也就是粉板的数据什么时候算总账，在没算账之前如何能查到最新的值？希望老师答疑解惑~","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437501,"discussion_content":"内存里是正确的值，直接从内存读走就行；\n日志和数据的关系，是日志记录了数据从状态1到状态2的过程\n\n这个过程持久化了，状态1也是已经持久化到磁盘的，那么状态2就可以不着急一定要写到磁盘。\n这个是WAL机制的逻辑😆","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548307050,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62878,"user_name":"苦行僧","can_delete":false,"product_type":"c1","uid":1055334,"ip_address":"","ucode":"726024A9A9CF44","user_header":"https://static001.geekbang.org/account/avatar/00/10/1a/66/2d9db9ed.jpg","comment_is_top":false,"comment_ctime":1548201546,"is_pvip":false,"replies":[{"id":"22231","content":"对的，恢复的时间需求","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1548204874,"ip_address":"","comment_id":62878,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548201546","product_id":100020801,"comment_content":"一天一备 还是一周一备 取决于业务需求 数据实时要求高的 比如金额的增减就要求一天一备","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437379,"discussion_content":"对的，恢复的时间需求","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548204874,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62798,"user_name":"黑白尤文","can_delete":false,"product_type":"c1","uid":1152644,"ip_address":"","ucode":"95B9F73AA0F20D","user_header":"https://static001.geekbang.org/account/avatar/00/11/96/84/d4ba322f.jpg","comment_is_top":false,"comment_ctime":1548160472,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1548160472","product_id":100020801,"comment_content":"感觉redolog类似于redis持久化里的aof，binlog类似于redis里的rdb。","like_count":0,"discussions":[{"author":{"id":1044546,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/42/7728d4f5.jpg","nickname":"艿艿","note":"","ucode":"8F727AB7A7F6B2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":25692,"discussion_content":"反了噢。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570546828,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62415,"user_name":"颜海航","can_delete":false,"product_type":"c1","uid":1308159,"ip_address":"","ucode":"5644F6328BF901","user_header":"https://static001.geekbang.org/account/avatar/00/13/f5/ff/523fb378.jpg","comment_is_top":false,"comment_ctime":1548052019,"is_pvip":false,"replies":[{"id":"22074","content":"08篇有涉及到一点，你看下哦<br>","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1548055612,"ip_address":"","comment_id":62415,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548052019","product_id":100020801,"comment_content":"老师 可以讲讲undo log吗","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437203,"discussion_content":"08篇有涉及到一点，你看下哦\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548055612,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62115,"user_name":"二马","can_delete":false,"product_type":"c1","uid":1006802,"ip_address":"","ucode":"4F1DF8732242A1","user_header":"","comment_is_top":false,"comment_ctime":1547941340,"is_pvip":false,"replies":[{"id":"21983","content":" 我觉得如果是1T以上的磁盘&amp;不小于64G的内存，都可以按照4*1G来配置redo log","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547962279,"ip_address":"","comment_id":62115,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547941340","product_id":100020801,"comment_content":"您说“redo log 可以是4组文件，每个文件大小1G”，从大并发update性能方面考虑，这个文件大小及几组一般怎样配置比较合适?","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437103,"discussion_content":" 我觉得如果是1T以上的磁盘&amp;amp;不小于64G的内存，都可以按照4*1G来配置redo log","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547962279,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62086,"user_name":"傅萌","can_delete":false,"product_type":"c1","uid":1323448,"ip_address":"","ucode":"46F7C467A8D04D","user_header":"https://static001.geekbang.org/account/avatar/00/14/31/b8/b1e0356d.jpg","comment_is_top":false,"comment_ctime":1547905762,"is_pvip":false,"replies":[{"id":"21967","content":"没有，checkpoint是后台线程追上来的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547914375,"ip_address":"","comment_id":62086,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547905762","product_id":100020801,"comment_content":"老师，redo log处在commit状态就是已经在check point了吗","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437091,"discussion_content":"没有，checkpoint是后台线程追上来的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547914375,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61969,"user_name":"Lukia","can_delete":false,"product_type":"c1","uid":1028698,"ip_address":"","ucode":"C19472337BCCC6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b2/5a/574f5bb0.jpg","comment_is_top":false,"comment_ctime":1547868165,"is_pvip":false,"replies":[{"id":"21958","content":"这里主要还是讲“数据更新逻辑”哈， undo log是有的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547880008,"ip_address":"","comment_id":61969,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547868165","product_id":100020801,"comment_content":"文中的redo log其实是redo+undo log吧，因为记录更新前和更新后的值都记录了的","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437054,"discussion_content":"这里主要还是讲“数据更新逻辑”哈， undo log是有的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547880008,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":60893,"user_name":"球魁","can_delete":false,"product_type":"c1","uid":1204752,"ip_address":"","ucode":"B369FD836310EE","user_header":"https://static001.geekbang.org/account/avatar/00/12/62/10/c1b4770d.jpg","comment_is_top":false,"comment_ctime":1547568843,"is_pvip":true,"replies":[{"id":"21726","content":"看一下15篇哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547604980,"ip_address":"","comment_id":60893,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547568843","product_id":100020801,"comment_content":"老师你好，按照上面所讲我觉得redo有点多余了，binlog 日志可以恢复某个点之前的操作，并且在异常重试的时候只有binlog 和redo共同存在的时候才会进行commit ，我用binlog也可以恢复数据，所以redo是不是多余了呢","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436657,"discussion_content":"看一下15篇哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547604980,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":60680,"user_name":"李大飞","can_delete":false,"product_type":"c1","uid":1052889,"ip_address":"","ucode":"3264FA5EE734A6","user_header":"https://static001.geekbang.org/account/avatar/00/10/10/d9/6d456c8e.jpg","comment_is_top":false,"comment_ctime":1547529354,"is_pvip":false,"replies":[{"id":"21667","content":"👍🤝","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547551672,"ip_address":"","comment_id":60680,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547529354","product_id":100020801,"comment_content":"落下了很多，正在不断学习。现在在公司直接利用每天午休的2小时来学习，感觉很充实，丁奇大大的文章很到位，评论区也很到位，常有高手出没，感谢丁奇大大和你们！感谢！","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436580,"discussion_content":"👍🤝","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547551672,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":60569,"user_name":"聪","can_delete":false,"product_type":"c1","uid":1009831,"ip_address":"","ucode":"9D672A8580A945","user_header":"https://static001.geekbang.org/account/avatar/00/0f/68/a7/c3fd1fd9.jpg","comment_is_top":false,"comment_ctime":1547514361,"is_pvip":false,"replies":[{"id":"21573","content":"不会呀，崩溃恢复的时候，会从checkpoint开始往后主动去刷数据的，没有checkpoint过的并不会丢失，只是崩溃恢复的时候花点时间","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547518250,"ip_address":"","comment_id":60569,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547514361","product_id":100020801,"comment_content":"老师有个问题，WAL可以保证之前提交的记录不会丢失。所以是不是只能是checkpoint过的记录不会丢失呢？那没有checkpoint过的数据但是已经write到redo log里的，在数据库发生问题了，应该都丢失了吧。如果发生这样的问题，如何恢复呢？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436545,"discussion_content":"不会呀，崩溃恢复的时候，会从checkpoint开始往后主动去刷数据的，没有checkpoint过的并不会丢失，只是崩溃恢复的时候花点时间","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547518250,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":59384,"user_name":"read","can_delete":false,"product_type":"c1","uid":1063112,"ip_address":"","ucode":"F0E4AE2FD92923","user_header":"https://static001.geekbang.org/account/avatar/00/10/38/c8/dfc7a25b.jpg","comment_is_top":false,"comment_ctime":1547360187,"is_pvip":false,"replies":[{"id":"21413","content":"没问题的<br><br>回滚中系统异常重启，重启后会继续回滚😆<br><br>是通过扫描redo log状态来发现的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547374595,"ip_address":"","comment_id":59384,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547360187","product_id":100020801,"comment_content":"老师，任何事务如果在回滚的时候系统异常重启了或者回滚操作失败了， 那是不是就导致数据状态可能不一致？ 这样情况会发生吗？ 如果发生了怎么避免？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436332,"discussion_content":"没问题的\n\n回滚中系统异常重启，重启后会继续回滚😆\n\n是通过扫描redo log状态来发现的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547374595,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":59381,"user_name":"read","can_delete":false,"product_type":"c1","uid":1063112,"ip_address":"","ucode":"F0E4AE2FD92923","user_header":"https://static001.geekbang.org/account/avatar/00/10/38/c8/dfc7a25b.jpg","comment_is_top":false,"comment_ctime":1547359717,"is_pvip":false,"replies":[{"id":"21412","content":"不会，你看下15篇，有说明哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547374561,"ip_address":"","comment_id":59381,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547359717","product_id":100020801,"comment_content":"老师你好，我想问一下，如果最后一步commit提交的时候MySQL异常重启了，那怎么办？ 那此时redo log还处于prepare的状态，但是binlog已经写入了。这样是不是就也不一致了？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436331,"discussion_content":"不会，你看下15篇，有说明哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547374561,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":59041,"user_name":"杰哥长得帅","can_delete":false,"product_type":"c1","uid":1241993,"ip_address":"","ucode":"5A7FD1794F62D7","user_header":"https://static001.geekbang.org/account/avatar/00/12/f3/89/fcfecb46.jpg","comment_is_top":false,"comment_ctime":1547284408,"is_pvip":false,"replies":[{"id":"21369","content":"看下15篇哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547293046,"ip_address":"","comment_id":59041,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547284408","product_id":100020801,"comment_content":"老师，有个地方不明白想请教下：为什么binlog不具备craahsafe功能呢","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436281,"discussion_content":"看下15篇哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547293046,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58158,"user_name":"牧鱼","can_delete":false,"product_type":"c1","uid":1360250,"ip_address":"","ucode":"0EB8FDD7A4BB2E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erFY9H3mxyTpZ9gxAmdeKic565hicicDZmv7cjswd8hdernmxib0chdQrlDNKUZQ8AticQCgDdgVEmJNuA/132","comment_is_top":false,"comment_ctime":1547003977,"is_pvip":false,"replies":[{"id":"21129","content":"WAL是指在“数据真正写入对应的磁盘数据页“ 之前写日志","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547119553,"ip_address":"","comment_id":58158,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547003977","product_id":100020801,"comment_content":"老师好，【update 语句执行流程】这张图的update更新流程是不是有点问题啊，既然是WAL了，为什么是将这一行的c值加1，写入新行，然后才是写入redo log呢？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435936,"discussion_content":"WAL是指在“数据真正写入对应的磁盘数据页“ 之前写日志","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547119553,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57926,"user_name":"TM_01","can_delete":false,"product_type":"c1","uid":1369752,"ip_address":"","ucode":"AFA1330C0FE1BC","user_header":"https://static001.geekbang.org/account/avatar/00/14/e6/98/289484e2.jpg","comment_is_top":false,"comment_ctime":1546942783,"is_pvip":false,"replies":[{"id":"21116","content":"没看懂你的意思， “innodb的update数据” 是什么意思，是update语句，还是“引擎更新数据”这个动作","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547118905,"ip_address":"","comment_id":57926,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546942783","product_id":100020801,"comment_content":"老师，innodb的update数据，是何时刷入磁盘的，也是和redo log buffer在commit阶段写入通过fsync延迟写入的机制一样嘛","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435831,"discussion_content":"没看懂你的意思， “innodb的update数据” 是什么意思，是update语句，还是“引擎更新数据”这个动作","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547118905,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57275,"user_name":"大牙","can_delete":false,"product_type":"c1","uid":1206791,"ip_address":"","ucode":"D4E869BF61DD61","user_header":"https://static001.geekbang.org/account/avatar/00/12/6a/07/96c1e57f.jpg","comment_is_top":false,"comment_ctime":1546703163,"is_pvip":false,"replies":[{"id":"20643","content":"看一下15篇，有提到这个问题😄","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1546709852,"ip_address":"","comment_id":57275,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546703163","product_id":100020801,"comment_content":"老师，还是对 redo log 的内容和 bin log的内容有些疑惑，假设redo log 和 bin log 都想记录“把c 从 0改成了1” 这个操作，那么redo log 就是 记录“把c 从 0改成了1”，bin log 记录的是实际的sql 语句：“update table set c = 1 where ... ” 或者记录 具体修改的行之前的值和更改之后的值。<br><br>我认为上述记录的内容很类似啊，一个系统crash之后，假设两个log 都可以用来恢复，我可以用bin log来恢复吗？如果不能，是哪里不能呢？ <br><br>谢谢老师","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435502,"discussion_content":"看一下15篇，有提到这个问题😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546709852,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57177,"user_name":"Geek_89bbab","can_delete":false,"product_type":"c1","uid":1156607,"ip_address":"","ucode":"B3110D5B3C9500","user_header":"https://static001.geekbang.org/account/avatar/00/11/a5/ff/6201122c.jpg","comment_is_top":false,"comment_ctime":1546672727,"is_pvip":false,"replies":[{"id":"20638","content":"哈哈你猜对啦 👍🏿<br><br>看一下15篇","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1546693800,"ip_address":"","comment_id":57177,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546672727","product_id":100020801,"comment_content":"引用@高枕的留言<br>1 prepare阶段 2 写binlog 3 commit<br>当在2之前崩溃时<br>重启恢复：后发现没有commit，回滚。备份恢复：没有binlog 。<br>一致<br>当在3之前崩溃<br>重启恢复：虽没有commit，但满足prepare和binlog完整，所以重启后会自动commit。备份：有binlog. 一致<br>—————<br>在3之前崩溃后，重启是如何判断prepare的redo log 已经记录了相应的binlog日志记录的？难道是redolog里面有一个事务id，binlog也有回应的事务id，通过在binlog中查询是否包含有对应事务id的binlog吗？求老师指点迷津","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435446,"discussion_content":"哈哈你猜对啦 👍🏿\n\n看一下15篇","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546693800,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56716,"user_name":"蓝天","can_delete":false,"product_type":"c1","uid":1318702,"ip_address":"","ucode":"E17EFE8FA5D5B0","user_header":"https://static001.geekbang.org/account/avatar/00/14/1f/2e/27d8b06d.jpg","comment_is_top":false,"comment_ctime":1546527011,"is_pvip":false,"replies":[{"id":"20440","content":"如果redo没落盘，那会回滚的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1546527922,"ip_address":"","comment_id":56716,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546527011","product_id":100020801,"comment_content":"请教下老师：关于先写redo log再写binlog的分析有些不理解。假设redo log写完后binlog还没写完，这时数据库出现意外宕机，修改数据的物理记录虽然记录到redo log，但是事务还没提交，我理解未提交意味着数据没有最终落盘，您说的c=1是因为innodb的崩溃恢复机制能把未提交的事务恢复到提交状态么？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435190,"discussion_content":"如果redo没落盘，那会回滚的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546527922,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56613,"user_name":"几近虚年","can_delete":false,"product_type":"c1","uid":1355831,"ip_address":"","ucode":"28CD6486EED8E2","user_header":"https://static001.geekbang.org/account/avatar/00/14/b0/37/d654fbac.jpg","comment_is_top":false,"comment_ctime":1546505997,"is_pvip":false,"replies":[{"id":"21107","content":"一起加油","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547117648,"ip_address":"","comment_id":56613,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546505997","product_id":100020801,"comment_content":"看了2遍稍微看懂了一些，理论性的知识点还是要多看几遍才行...<br>工作1年多的，之前只知道增删查改的sql语句，跟着老师学习，感觉发现了新大陆一样，学起来也感觉新奇，有意思。<br>跟着老师学完看能进步多少，嘿嘿嘿","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435147,"discussion_content":"一起加油","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547117648,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56610,"user_name":"圈圈","can_delete":false,"product_type":"c1","uid":1115855,"ip_address":"","ucode":"F3EF560C08816C","user_header":"https://static001.geekbang.org/account/avatar/00/11/06/cf/13a419b9.jpg","comment_is_top":false,"comment_ctime":1546505560,"is_pvip":true,"replies":[{"id":"21087","content":"👍🏿","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547107761,"ip_address":"","comment_id":56610,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546505560","product_id":100020801,"comment_content":"一天一备和一周一备的场景有一个因素，就是取决于服务器硬件的配置，比如redo log的容量，如果一天一备在容量小的情况下就安全些，如果一周一备，需要更大的配置。当然一天一备从另一个维度看，需要对服务器另一方面的花销，就是这个频率的备份IO的花销比一周一备更大。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435146,"discussion_content":"👍🏿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547107761,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56603,"user_name":"低调","can_delete":false,"product_type":"c1","uid":1124982,"ip_address":"","ucode":"7D29B371BE9A46","user_header":"https://static001.geekbang.org/account/avatar/00/11/2a/76/36fdddb3.jpg","comment_is_top":false,"comment_ctime":1546504459,"is_pvip":true,"replies":[{"id":"20419","content":"是同一个binlog😄<br><br>你看一下15篇，有说到你提的这个问题","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1546514839,"ip_address":"","comment_id":56603,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546504459","product_id":100020801,"comment_content":"这个binlog和主从的binlog是一个概念么？这个binlog不是可以关闭么，那两阶段提交也就没有意义了吧，懵了~","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435141,"discussion_content":"是同一个binlog😄\n\n你看一下15篇，有说到你提的这个问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546514839,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56573,"user_name":"JRich","can_delete":false,"product_type":"c1","uid":1114901,"ip_address":"","ucode":"66AE9D61533960","user_header":"https://static001.geekbang.org/account/avatar/00/11/03/15/293a185d.jpg","comment_is_top":false,"comment_ctime":1546495497,"is_pvip":false,"replies":[{"id":"20421","content":"会，你明天看下今晚会发的23篇，有说到😄","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1546514906,"ip_address":"","comment_id":56573,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546495497","product_id":100020801,"comment_content":"老师，binlog和redolog的那两个参数都设置为1的话，每次事务结束之后立马持久化到磁盘会不会影响性能。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435125,"discussion_content":"会，你明天看下今晚会发的23篇，有说到😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546514906,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56547,"user_name":"邵俊达","can_delete":false,"product_type":"c1","uid":1281460,"ip_address":"","ucode":"4B7DACE6DBCF95","user_header":"https://static001.geekbang.org/account/avatar/00/13/8d/b4/ff82483d.jpg","comment_is_top":false,"comment_ctime":1546485880,"is_pvip":false,"replies":[{"id":"20389","content":"08篇看一下😄","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1546486754,"ip_address":"","comment_id":56547,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546485880","product_id":100020801,"comment_content":"请问，当目前改动只写入了 redo log 还没有写入磁盘的时候，这时有一条查询语录会发生什么？不会不一致么？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435110,"discussion_content":"08篇看一下😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546486754,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56382,"user_name":"大宝","can_delete":false,"product_type":"c1","uid":1102771,"ip_address":"","ucode":"224458E5D1A35A","user_header":"https://static001.geekbang.org/account/avatar/00/10/d3/b3/4f5550c0.jpg","comment_is_top":false,"comment_ctime":1546432923,"is_pvip":false,"replies":[{"id":"20289","content":"看下15篇","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1546435140,"ip_address":"","comment_id":56382,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546432923","product_id":100020801,"comment_content":"老师 能不能问一下binlog为什么不能保证crash safe","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435008,"discussion_content":"看下15篇","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546435140,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55921,"user_name":"强哥","can_delete":false,"product_type":"c1","uid":1361817,"ip_address":"","ucode":"1915DEE2B7CCDD","user_header":"https://static001.geekbang.org/account/avatar/00/14/c7/99/6403695d.jpg","comment_is_top":false,"comment_ctime":1546348371,"is_pvip":false,"replies":[{"id":"20140","content":"🤝","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1546361422,"ip_address":"","comment_id":55921,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546348371","product_id":100020801,"comment_content":"喜欢孔乙己这个例子，说明read log很清楚","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434883,"discussion_content":"🤝","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546361422,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55913,"user_name":"just4cn","can_delete":false,"product_type":"c1","uid":1215994,"ip_address":"","ucode":"9FF8B154DF7B79","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoqjK62ZEuj3220ZAAqLBIgiayGn2MfvSOJb1uPz2TmwibSfxKURFj68ITdn6K0EK6MRW1llJBSzLJg/132","comment_is_top":false,"comment_ctime":1546346140,"is_pvip":false,"replies":[{"id":"20134","content":"确实有可能，binlog确实先发了，你还有这种场景啊，<br><br>比较少见到这种方案哈，我现在能想起来的就是轮询了。<br>当然还有可以去查解析出binlog里面的线程id 和时间戳，然后去查select  * from information_schema.innodb_trx where trx_mysql_thread_id=$tid and trx_started &lt; $timestamp;<br>必须返回空才行，本质上还是轮询就是了…<br><br>不过，<br>都拿到binlog了，看看能不能考虑设置成row格式，直接解析更更好些；<br><br>","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1546351017,"ip_address":"","comment_id":55913,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546346140","product_id":100020801,"comment_content":"接前一个问题<br>原问题：更新数据的过程是在确保数据能成功更新的情况下就写binlog，然后事务才提交commit，通过binlog来同步数据，当接收到binlog后还需要获取其它数据进行计算，此时立刻去读数据库会发现读不到刚更新的数据。<br>您的回复：做好区分，对延迟敏感的请求，需要去主库上查询。<br>------<br>感谢老师的回复，之前表达的不完善。这里就是接收到主库发出的binlog后，立刻去主库查询数据，有时查不到此条binlog对应的更新内容，当sleep 0.5s(或更久)再去获取便能取到正确的数据，初步怀疑是binlog发送时主库的事务尚未commit导致的，不知道有没有什么好的解决方法。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434880,"discussion_content":"确实有可能，binlog确实先发了，你还有这种场景啊，\n\n比较少见到这种方案哈，我现在能想起来的就是轮询了。\n当然还有可以去查解析出binlog里面的线程id 和时间戳，然后去查select  * from information_schema.innodb_trx where trx_mysql_thread_id=$tid and trx_started &amp;lt; $timestamp;\n必须返回空才行，本质上还是轮询就是了…\n\n不过，\n都拿到binlog了，看看能不能考虑设置成row格式，直接解析更更好些；\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546351017,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55872,"user_name":"just4cn","can_delete":false,"product_type":"c1","uid":1215994,"ip_address":"","ucode":"9FF8B154DF7B79","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoqjK62ZEuj3220ZAAqLBIgiayGn2MfvSOJb1uPz2TmwibSfxKURFj68ITdn6K0EK6MRW1llJBSzLJg/132","comment_is_top":false,"comment_ctime":1546335982,"is_pvip":false,"replies":[{"id":"20123","content":"这个是读写分离常见的问题…只能做好区分，对延迟敏感的请求，需要到主库上去查","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1546342085,"ip_address":"","comment_id":55872,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546335982","product_id":100020801,"comment_content":"老师，问个困扰较久的问题：目前更新数据的过程是在确保数据能更新成功的情况下就写binlog了，然后事务才提交commit，如果通过binlog来同步数据，当接收到binlog后还需要获取其它数据进行计算，此时立刻去读数据库的会发现有时候读不到刚更新的这条数据，这个有没有什么办法避免？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434870,"discussion_content":"这个是读写分离常见的问题…只能做好区分，对延迟敏感的请求，需要到主库上去查","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546342085,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55296,"user_name":"陈星","can_delete":false,"product_type":"c1","uid":1364303,"ip_address":"","ucode":"BA6E68DC61BF2D","user_header":"https://static001.geekbang.org/account/avatar/00/14/d1/4f/c52f9f6d.jpg","comment_is_top":false,"comment_ctime":1546093433,"is_pvip":false,"replies":[{"id":"20036","content":"重启过程中连接都连不了<br><br>你是说重启之后吗？崩溃恢复完成后开始提供服务","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1546134415,"ip_address":"","comment_id":55296,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546093433","product_id":100020801,"comment_content":"老师您好，如果redo log和bin log都已经提交，但是，没有写入到磁盘中的时候，突然发生重启，那么此时，进来的查询请求，会得到及时的响应吗？。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434731,"discussion_content":"重启过程中连接都连不了\n\n你是说重启之后吗？崩溃恢复完成后开始提供服务","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546134415,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54949,"user_name":"xm","can_delete":false,"product_type":"c1","uid":1254296,"ip_address":"","ucode":"9A08EB6F201D74","user_header":"https://static001.geekbang.org/account/avatar/00/13/23/98/bd96932f.jpg","comment_is_top":false,"comment_ctime":1545987298,"is_pvip":false,"replies":[{"id":"19886","content":"会，往后看哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545990397,"ip_address":"","comment_id":54949,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545987298","product_id":100020801,"comment_content":"Mysql redo、undo、bin、relay log这几个日志都晕了，老师会将下这几个日志的么？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434628,"discussion_content":"会，往后看哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545990397,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54915,"user_name":"小叶","can_delete":false,"product_type":"c1","uid":1309062,"ip_address":"","ucode":"99E19C0982FF7E","user_header":"https://static001.geekbang.org/account/avatar/00/13/f9/86/ba830df4.jpg","comment_is_top":false,"comment_ctime":1545981115,"is_pvip":false,"replies":[{"id":"19894","content":"不会，事务没提交呢，MVCC会让别的线程看不到这个内存的修改的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545994949,"ip_address":"","comment_id":54915,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545981115","product_id":100020801,"comment_content":"接上一个问题。<br>写内存的时候查询到的数据是不是最新的数据？如果写入内存成功，redolog，binlog失败了，会不会造成读到这个非法数据呢？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434609,"discussion_content":"不会，事务没提交呢，MVCC会让别的线程看不到这个内存的修改的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545994949,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54912,"user_name":"小叶","can_delete":false,"product_type":"c1","uid":1309062,"ip_address":"","ucode":"99E19C0982FF7E","user_header":"https://static001.geekbang.org/account/avatar/00/13/f9/86/ba830df4.jpg","comment_is_top":false,"comment_ctime":1545980883,"is_pvip":false,"replies":[{"id":"19893","content":"只是逻辑上原子，实现上不会加这么大一个锁哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545994891,"ip_address":"","comment_id":54912,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545980883","product_id":100020801,"comment_content":"老师你好，有个问题<br>写入新行、新行更新到内存、写入redolog写入binlog。这4个操作应该是原子性的吧？<br>这边的写内存，写redolog，写binlog是怎么保证原子性的呢？<br><br><br>还有提个建议，文中图的字体有点过于难分辨了。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434607,"discussion_content":"只是逻辑上原子，实现上不会加这么大一个锁哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545994891,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54892,"user_name":"金龟","can_delete":false,"product_type":"c1","uid":1228500,"ip_address":"","ucode":"1C7D35C8AE8D9D","user_header":"https://static001.geekbang.org/account/avatar/00/12/be/d4/ff1c1319.jpg","comment_is_top":false,"comment_ctime":1545978752,"is_pvip":false,"replies":[{"id":"19884","content":"对的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545988775,"ip_address":"","comment_id":54892,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545978752","product_id":100020801,"comment_content":"binlog的写入时机，应该是在事务提交的时候一次性写入的吧，老师","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434602,"discussion_content":"对的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545988775,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54652,"user_name":"paul","can_delete":false,"product_type":"c1","uid":1350127,"ip_address":"","ucode":"DEDD96BE979345","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKqDeE8vfUhETcZibFiacSgn863AIqNSGHGgvb1flfLGfOJcQjZomEeh9ibM3WFjWDia5eVMrRDKnUbOg/132","comment_is_top":false,"comment_ctime":1545923076,"is_pvip":false,"replies":[{"id":"19843","content":"都不是，直接从内存读走，内存里可是有修改的最新的结果哦","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545961833,"ip_address":"","comment_id":54652,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545923076","product_id":100020801,"comment_content":"请老师回答下，前面一个同学的问题，我也想到这个问题。 问题如下：<br><br>“ 老师，您好。您说MySQL 使用WAL，先写日志再写磁盘。请教一个问题，<br><br>执行一条Update 语句后，马上又执行一条 select * from table limit 10。<br><br>如果刚刚update的记录，还没持久化到磁盘中，而偏偏这个时候的查询条件，又包含了刚刚update的记录。<br><br>那么这个时候，是从日志中获取刚刚update的最新结果，还是说，先把日志中的记录先写磁盘，再返回最新结果？“","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434528,"discussion_content":"都不是，直接从内存读走，内存里可是有修改的最新的结果哦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545961833,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54562,"user_name":"tailender","can_delete":false,"product_type":"c1","uid":1133837,"ip_address":"","ucode":"BCF8C43F9039E9","user_header":"https://static001.geekbang.org/account/avatar/00/11/4d/0d/f8b8c22e.jpg","comment_is_top":false,"comment_ctime":1545900910,"is_pvip":false,"replies":[{"id":"19799","content":"这里说的是commit阶段哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545903146,"ip_address":"","comment_id":54562,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545900910","product_id":100020801,"comment_content":"update 执行过程的图里 写入新行深色 是代表已经写入磁盘了吗？ 不是先写redo log，大小满了才写磁盘吗","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434491,"discussion_content":"这里说的是commit阶段哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545903146,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54350,"user_name":"黄明恩","can_delete":false,"product_type":"c1","uid":1119409,"ip_address":"","ucode":"EF75C8BFA14D17","user_header":"https://static001.geekbang.org/account/avatar/00/11/14/b1/7d974f0a.jpg","comment_is_top":false,"comment_ctime":1545833704,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545833704","product_id":100020801,"comment_content":"老师好，redo log是innodb特有的，那么其他存储引擎有这个机制或者类似思路吗？要不然其他引擎的更新性能和crash safe能力都没保证吗？<br><br>还有就是顺序写和随机写在SSD硬盘开启差别很大吗","like_count":0},{"had_liked":false,"id":54210,"user_name":"Hyun","can_delete":false,"product_type":"c1","uid":1014376,"ip_address":"","ucode":"EF6E7F6D17793D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7a/68/f2bc8fcb.jpg","comment_is_top":false,"comment_ctime":1545807224,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1545807224","product_id":100020801,"comment_content":"如果没有或者禁用 binlog， 我觉得效率会更高一些。不知道 MySQL 后期是不是会调整。2 段式提交，理论上是用于分布式环境的，用在单机 OLTP 里面，是不是贵了点？","like_count":0},{"had_liked":false,"id":54050,"user_name":"fancion","can_delete":false,"product_type":"c1","uid":1121584,"ip_address":"","ucode":"9000895F6BE0E4","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/30/4a82c7af.jpg","comment_is_top":false,"comment_ctime":1545789426,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545789426","product_id":100020801,"comment_content":"1、其实这个地方不只是有redo，应该还有一个undo日志吧，用于保障未提交事务不会对数据库的ACID特性产生影响<br>2、Binlog模式除了statement和row，是不是还有混合模式","like_count":0},{"had_liked":false,"id":53914,"user_name":"spraith","can_delete":false,"product_type":"c1","uid":1141702,"ip_address":"","ucode":"7FBC54DF0BBF50","user_header":"https://static001.geekbang.org/account/avatar/00/11/6b/c6/2534e14a.jpg","comment_is_top":false,"comment_ctime":1545753754,"is_pvip":false,"replies":[{"id":"19530","content":"是的哦😄","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545756209,"ip_address":"","comment_id":53914,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545753754","product_id":100020801,"comment_content":"我觉得也可以这样理解：redolog和binlog可以看成是数据日志的两种不同存储方式（在短时间内），所以它们必须是一致的才行，不然它们本质上就不相同了。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434287,"discussion_content":"是的哦😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545756209,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53749,"user_name":"坏淡一个","can_delete":false,"product_type":"c1","uid":1118181,"ip_address":"","ucode":"D9C39F4133D9D6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eplMzkLgvebhLujCZI0DZAWS7MQGvYGHb4yeoDHdITVWpbSicvoVKw0dISm9ib3vYU7BqxrmuTV666g/132","comment_is_top":false,"comment_ctime":1545718968,"is_pvip":false,"replies":[{"id":"19502","content":"binlog都保留了、并且是row格式、并且误删操作是“delete” 才行","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545721502,"ip_address":"","comment_id":53749,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545718968","product_id":100020801,"comment_content":"如果有一个备份库的时间点，最接近误删除的时间点，但这个备份库的时间比误删除的晚，能不能用binlog倒过来回溯？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434228,"discussion_content":"binlog都保留了、并且是row格式、并且误删操作是“delete” 才行","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545721502,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53441,"user_name":"坏淡一个","can_delete":false,"product_type":"c1","uid":1118181,"ip_address":"","ucode":"D9C39F4133D9D6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eplMzkLgvebhLujCZI0DZAWS7MQGvYGHb4yeoDHdITVWpbSicvoVKw0dISm9ib3vYU7BqxrmuTV666g/132","comment_is_top":false,"comment_ctime":1545645031,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545645031","product_id":100020801,"comment_content":"执行器将值+1后，调用引擎接口，写入这行新数据，然后“引擎将新数据更新到内存中”，也就是说新数据是缓存在内存中的？在redo log把数据写入磁盘前，查询的都是内存中的数据？是不是等redo log把新数据实际写入磁盘后，这些缓存数据才会失效？","like_count":0},{"had_liked":false,"id":53437,"user_name":"坏淡一个","can_delete":false,"product_type":"c1","uid":1118181,"ip_address":"","ucode":"D9C39F4133D9D6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eplMzkLgvebhLujCZI0DZAWS7MQGvYGHb4yeoDHdITVWpbSicvoVKw0dISm9ib3vYU7BqxrmuTV666g/132","comment_is_top":false,"comment_ctime":1545644798,"is_pvip":false,"replies":[{"id":"19366","content":"看下15篇","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545653143,"ip_address":"","comment_id":53437,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545644798","product_id":100020801,"comment_content":"用了两阶段提交，如果redo log处于prepare状态，然后binlog写入完成，这时，在把redo log改为commit状态的过程中出问题崩溃重启了，这种情况会怎么办？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434139,"discussion_content":"看下15篇","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545653143,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52809,"user_name":"Spring","can_delete":false,"product_type":"c1","uid":1222211,"ip_address":"","ucode":"8175463FB4705B","user_header":"https://static001.geekbang.org/account/avatar/00/12/a6/43/cb6ab349.jpg","comment_is_top":false,"comment_ctime":1545534295,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545534295","product_id":100020801,"comment_content":"redo log记录了数据页做了什么变动，他会在适当的时候刷盘。而我们查询是从磁盘查出来的，如何保证我们读到的数据是更新后的数据呢？","like_count":0},{"had_liked":false,"id":51988,"user_name":"张洋","can_delete":false,"product_type":"c1","uid":1182914,"ip_address":"","ucode":"549BE5DEEF8417","user_header":"https://static001.geekbang.org/account/avatar/00/12/0c/c2/bad34a50.jpg","comment_is_top":false,"comment_ctime":1545289910,"is_pvip":true,"replies":[{"id":"18822","content":"没丢，顺序写比随机写的成本低","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545293268,"ip_address":"","comment_id":51988,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545289910","product_id":100020801,"comment_content":"又一个疑问如果把redolog的innodb_flush_log_at_trx_commit设置为1<br>不就相当于每一次都要提交到磁盘，就用不到他的记录到小黑板上的功能（先都写到日志，找一个合适的时间记录到磁盘），不是把他的优势给弄丢了吗？<br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433690,"discussion_content":"没丢，顺序写比随机写的成本低","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545293268,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51765,"user_name":"Geek_4de7b1","can_delete":false,"product_type":"c1","uid":1093121,"ip_address":"","ucode":"2A8BFED5BCB218","user_header":"https://static001.geekbang.org/account/avatar/00/10/ae/01/12818bab.jpg","comment_is_top":false,"comment_ctime":1545234216,"is_pvip":false,"replies":[{"id":"18788","content":"不是，<br>Redolog上打上commit 标签，写盘","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545271394,"ip_address":"","comment_id":51765,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545234216","product_id":100020801,"comment_content":"请问一下执行最后commit，innodb的commit具体是做了哪些操作呀？移动checkpoint指针吗？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433612,"discussion_content":"不是，\nRedolog上打上commit 标签，写盘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545271394,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51730,"user_name":"shawn","can_delete":false,"product_type":"c1","uid":1010221,"ip_address":"","ucode":"8F6A8C7920996E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6a/2d/ec4ed8ce.jpg","comment_is_top":false,"comment_ctime":1545229841,"is_pvip":false,"replies":[{"id":"18960","content":"两个理解都对","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545333046,"ip_address":"","comment_id":51730,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545229841","product_id":100020801,"comment_content":"老师，对于WAL我还有两个疑问如下：<br>1. 比如WAL 有两个记录（update amount = amount +1 where id = 2,  update amount = amount +1 where id = 200000 ）,虽然wal文件是顺序性的，但是数据库中id =2 ,id = 200000记录可能相差很远，这种寻址速度（寻找数据库中记录）应该也不会很快。不过wal到数据库文件操作是异步后台操作，不影响效率对么？<br><br> 2.另外根据前面事物隔离级别，一条记录只要写入WAL且WAL 持久化到磁盘，就算事物的原子性和持久性保证了对么。 至于WAL数据什么时候更新到数据库文件里不用管对么？<br><br>期待老师的解答，谢谢！","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433602,"discussion_content":"两个理解都对","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545333046,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50966,"user_name":"李皮皮皮皮皮","can_delete":false,"product_type":"c1","uid":1200281,"ip_address":"","ucode":"3BF1DEE4A12359","user_header":"https://static001.geekbang.org/account/avatar/00/12/50/99/44378317.jpg","comment_is_top":false,"comment_ctime":1545094137,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545094137","product_id":100020801,"comment_content":"老师你好，看完这篇我有几个疑问：<br>1.如果不设置立即刷到磁盘标志，redo log和binlog应该是放在内存中的吧，它们应该是写到两个不同的文件中的，会不会出现部分写的问题呢？<br>2.prepare-写binlog-commit这个过程中，如果异常重启了。怎么根据binlog找到对应的redo log或者反过来。难道有一个全局唯一id？<br>3.如果在上面写binlog阶段崩溃了，binlog未写入成功。恢复程序会撤销prepare状态的redo log。redo log和最终磁盘中的数据更新是不是只会存在一个？删redo log和写磁盘会不会出现不一致，比如中间又异常重启了","like_count":0},{"had_liked":false,"id":50905,"user_name":"李皮皮皮皮皮","can_delete":false,"product_type":"c1","uid":1200281,"ip_address":"","ucode":"3BF1DEE4A12359","user_header":"https://static001.geekbang.org/account/avatar/00/12/50/99/44378317.jpg","comment_is_top":false,"comment_ctime":1545063161,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545063161","product_id":100020801,"comment_content":"老师你好，看完这篇我有几个疑问：<br>1.如果不设置立即刷到磁盘标志，redo log和binlog应该先在内存中的吧。它们应该是写到两个不同的文件，会不会存在部分写的问题<br>2.prepare-写binlog-commit这个过程中，如果有异常重启。回复程序怎么根据binlog查找redo log或者反过来呢？其实可以有连续执行几个相同的sql语句。难道有一个唯一的id关联吗？<br>3.redo log是最终硬盘中数据更新是不是只能存在一个？比如一次更新，要么更新到最终数据了，要么有一条redo log。不能两者都有。如果只能有一个，那么紧跟着更新后面的针对这个更新的字段查询怎么处理？","like_count":0},{"had_liked":false,"id":50814,"user_name":"MichaelChen","can_delete":false,"product_type":"c1","uid":1184259,"ip_address":"","ucode":"FAD745F3220AE0","user_header":"https://static001.geekbang.org/account/avatar/00/12/12/03/c657c350.jpg","comment_is_top":false,"comment_ctime":1545049753,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545049753","product_id":100020801,"comment_content":"使用show [session|global] status可以查看统计各种SQL执行数以及MySQL各种状态，不写中间的global，默认参数为session，只查询当前链接中的参数，所以我们一般加上global，查询MySQL从上一次启动至今的数据统计，例如：show global status like &#39;Com_select%&#39;用来查询MySQL执行select 的次数","like_count":0},{"had_liked":false,"id":50626,"user_name":"lixg","can_delete":false,"product_type":"c1","uid":1228028,"ip_address":"","ucode":"6E821145950FBB","user_header":"https://static001.geekbang.org/account/avatar/00/12/bc/fc/cf98963a.jpg","comment_is_top":false,"comment_ctime":1545017614,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545017614","product_id":100020801,"comment_content":"我有两个问题<br>1.redo.log你说记录的是“做了什么改动”，这个以怎样的形式来显明改动的内容？<br>2.既然binlog记录了sql，那不是可以通过sql来回复数据吗，它为什么不支持crash safe呢不太理解","like_count":0},{"had_liked":false,"id":50433,"user_name":"XD","can_delete":false,"product_type":"c1","uid":1079293,"ip_address":"","ucode":"DC9DCFB3841A4E","user_header":"https://static001.geekbang.org/account/avatar/00/10/77/fd/c6619535.jpg","comment_is_top":false,"comment_ctime":1544972711,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544972711","product_id":100020801,"comment_content":"执行器先找引擎取 ID=2 这一行。ID 是主键，引擎直接用树搜索找到这一行。如果 ID=2 这一行所在的数据页本来就在内存中，就直接返回给执行器；否则，需要先从磁盘读入内存，然后再返回。<br><br>执行器拿到引擎给的行数据，把这个值加上 1，比如原来是 N，现在就是 N+1，得到新的一行数据，再调用引擎接口写入这行新数据。<br><br>-----<br><br>老师，这里有个疑问。执行器为什么不直接调用引擎的更新接口而非要先获取这条数据呢？<br>假如满足条件的数据很多，有1000条，innodb也会全部返回给执行器、执行器一条条记录去修改完、然后再调用写入接口一条条的去更新吗？","like_count":0},{"had_liked":false,"id":50220,"user_name":"别皱眉","can_delete":false,"product_type":"c1","uid":1177354,"ip_address":"","ucode":"D24F65EFF65586","user_header":"https://static001.geekbang.org/account/avatar/00/11/f7/0a/067537fc.jpg","comment_is_top":false,"comment_ctime":1544927483,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544927483","product_id":100020801,"comment_content":"老师，您好。我是一个小白<br>这里有个问题 希望您看看 谢谢😃<br>执行器先找引擎取 ID=2 这一行。ID 是主键，引擎直接用树搜索找到这一行。如果 ID=2 这一行所在的数据页本来就在内存中，就直接返回给执行器；否则，需要先从磁盘读入内存，然后再返回。<br><br>上篇文章中您说到<br>执行器调用InnoDB引擎取这个表的第一行，然后返回给执行器，由执行器判断ID是不是我们想要的值，在留言娶里您回答同学的问题说这个判断动作是由执行器发出的<br>但是这里怎么是InnoDB判断了呢<br><br>","like_count":0},{"had_liked":false,"id":49896,"user_name":"极客-绝影","can_delete":false,"product_type":"c1","uid":1243369,"ip_address":"","ucode":"D302CE68123E74","user_header":"https://static001.geekbang.org/account/avatar/00/12/f8/e9/f16a536b.jpg","comment_is_top":false,"comment_ctime":1544785356,"is_pvip":false,"replies":[{"id":"18018","content":"对的👍🏿","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544875547,"ip_address":"","comment_id":49896,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544785356","product_id":100020801,"comment_content":"回答问题<br>老师好，个人认为备份周期没有统一或者固定标准与规范，合适才是最好的，那么我认为合适有三个主要的考虑指标，分别是业务场景，数据重要性和数据量的多少。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432796,"discussion_content":"对的👍🏿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544875547,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49332,"user_name":"念你如昔","can_delete":false,"product_type":"c1","uid":1323531,"ip_address":"","ucode":"FCAD88AB57D084","user_header":"https://static001.geekbang.org/account/avatar/00/14/32/0b/981b4e93.jpg","comment_is_top":false,"comment_ctime":1544667537,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544667537","product_id":100020801,"comment_content":"仔细考虑了一下两阶段提交的异常情况：（请老师看看有没有问题）<br>             因为是采用的redolog来做崩溃后恢复的，所以在检测到有redolog处于prepare状态时，他应该会扫描binlog读取xid，将此xid与prepare事务链表中的xid做比较，如果存在，则前滚；如果不存在，则回滚。<br>","like_count":0},{"had_liked":false,"id":49145,"user_name":"念你如昔","can_delete":false,"product_type":"c1","uid":1323531,"ip_address":"","ucode":"FCAD88AB57D084","user_header":"https://static001.geekbang.org/account/avatar/00/14/32/0b/981b4e93.jpg","comment_is_top":false,"comment_ctime":1544611054,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544611054","product_id":100020801,"comment_content":"老师，两阶段提交中，如果redo log prepare之后，出现意外情况，事务会回滚。我有个疑问，如果服务器挂了的情况，比如说断电等情况，那么此时事务还会回滚吗","like_count":0},{"had_liked":false,"id":49056,"user_name":"雨中漫步","can_delete":false,"product_type":"c1","uid":1307862,"ip_address":"","ucode":"D225B6F5DD445D","user_header":"https://static001.geekbang.org/account/avatar/00/13/f4/d6/0ff4ebe5.jpg","comment_is_top":false,"comment_ctime":1544595988,"is_pvip":false,"replies":[{"id":"17621","content":"不是哦，我们说的都是“提交过程”哦。<br><br>在事务“执行计期间”，binlog 没有写盘，如你所说，这时候在binlog cache,没往备库发的<br><br>","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544608737,"ip_address":"","comment_id":49056,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544595988","product_id":100020801,"comment_content":"有个疑问，据之前的理解，应该是commit完成后才会写入binlog到binlog cache。看您说的update过程是先落盘binlog再commit。假设这样的话，在主从复制中，在主库事务未提交的情况下，binlog就已经被同步到从库了。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432468,"discussion_content":"不是哦，我们说的都是“提交过程”哦。\n\n在事务“执行计期间”，binlog 没有写盘，如你所说，这时候在binlog cache,没往备库发的\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544608737,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48936,"user_name":"Jike_chanpin_shishabi","can_delete":false,"product_type":"c1","uid":1201655,"ip_address":"","ucode":"DBE59491274446","user_header":"https://static001.geekbang.org/account/avatar/00/12/55/f7/af3feb56.jpg","comment_is_top":false,"comment_ctime":1544579769,"is_pvip":false,"replies":[{"id":"17572","content":"要看阶段。<br><br>第15篇会说","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544582945,"ip_address":"","comment_id":48936,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544579769","product_id":100020801,"comment_content":"老师，如果在执行器提交commit时挂了咋么办","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432426,"discussion_content":"要看阶段。\n\n第15篇会说","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544582945,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48904,"user_name":"吾道","can_delete":false,"product_type":"c1","uid":1160279,"ip_address":"","ucode":"22FF5277AF2D8C","user_header":"https://static001.geekbang.org/account/avatar/00/11/b4/57/1f3bb829.jpg","comment_is_top":false,"comment_ctime":1544577203,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544577203","product_id":100020801,"comment_content":"买了很多课程，感觉就这个讲得最容易弄懂😂","like_count":0},{"had_liked":false,"id":48819,"user_name":"木小易","can_delete":false,"product_type":"c1","uid":1143167,"ip_address":"","ucode":"B321EF018904C4","user_header":"https://static001.geekbang.org/account/avatar/00/11/71/7f/4eba4781.jpg","comment_is_top":false,"comment_ctime":1544542846,"is_pvip":false,"replies":[{"id":"17519","content":"那看来就是被行锁锁住了…","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544546068,"ip_address":"","comment_id":48819,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544542846","product_id":100020801,"comment_content":"老师，您好，最近生产环境遇到一个问题，show full processlist中抓到一个update语句，根据主键更新的，时间是30s，state为updating，但是slow log中没有记录，我知道slow log中只会记录执行时间&gt;long_query_time的查询，不包括lock_time。我的问题是updating过程中做了哪些事情，是有加锁的动作吗？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432369,"discussion_content":"那看来就是被行锁锁住了…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544546068,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48794,"user_name":"刘常青","can_delete":false,"product_type":"c1","uid":1333608,"ip_address":"","ucode":"6F15CBEF9AB8D1","user_header":"https://static001.geekbang.org/account/avatar/00/14/59/68/b1b5e8bb.jpg","comment_is_top":false,"comment_ctime":1544538404,"is_pvip":false,"replies":[{"id":"17522","content":"不是，应该是你们业务超时重试导致的吧…","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544546654,"ip_address":"","comment_id":48794,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544538404","product_id":100020801,"comment_content":"老师，数据库在卡的情况，在插入数据的时候会出现重复数据，这个原理是啥?是写入binlog日志在提交事务处于commit状态一直处于等待状态，出现的数据重复吗？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432356,"discussion_content":"不是，应该是你们业务超时重试导致的吧…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544546654,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48601,"user_name":"流浪在寂寞古城","can_delete":false,"product_type":"c1","uid":1105678,"ip_address":"","ucode":"FE90DCD5DC3A20","user_header":"https://static001.geekbang.org/account/avatar/00/10/df/0e/4e2b06d5.jpg","comment_is_top":false,"comment_ctime":1544493842,"is_pvip":false,"replies":[{"id":"17411","content":"第15篇答疑会说哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544500956,"ip_address":"","comment_id":48601,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544493842","product_id":100020801,"comment_content":"没有太理解为什么redo分为两段就可以保证一致，可以举个例子吗？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432268,"discussion_content":"第15篇答疑会说哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544500956,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48318,"user_name":"howhigh","can_delete":false,"product_type":"c1","uid":1051022,"ip_address":"","ucode":"C21ABC017C145D","user_header":"https://static001.geekbang.org/account/avatar/00/10/09/8e/2ff2823e.jpg","comment_is_top":false,"comment_ctime":1544419581,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544419581","product_id":100020801,"comment_content":"老师，我有一个疑问，如果临时账本数据是写在内存里的，那计算机宕机后，内存数据岂不是没有了，那为啥具备crash_safe的能力？","like_count":0},{"had_liked":false,"id":48317,"user_name":"如余","can_delete":false,"product_type":"c1","uid":1184565,"ip_address":"","ucode":"C2005B97CE9593","user_header":"https://static001.geekbang.org/account/avatar/00/12/13/35/b6328a05.jpg","comment_is_top":false,"comment_ctime":1544419135,"is_pvip":false,"replies":[{"id":"17252","content":"没有不写呀，都要写的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544424924,"ip_address":"","comment_id":48317,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544419135","product_id":100020801,"comment_content":"丁奇老师，问一下为什么redo log 中第四个文件不写内容，具体承载着什么作用","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432127,"discussion_content":"没有不写呀，都要写的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544424924,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48128,"user_name":"柯察金","can_delete":false,"product_type":"c1","uid":1115149,"ip_address":"","ucode":"F722BF8FCD2C47","user_header":"https://static001.geekbang.org/account/avatar/00/11/04/0d/3dc5683a.jpg","comment_is_top":false,"comment_ctime":1544364971,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544364971","product_id":100020801,"comment_content":"redo log 跟 bin log 都是针对事务吧？","like_count":0},{"had_liked":false,"id":48121,"user_name":"大肉丸","can_delete":false,"product_type":"c1","uid":1281715,"ip_address":"","ucode":"17C5B5FF4CF2B4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epLbHgQhI0pFNI9iblcKdXqI8F5Fc4fTW0OR78oPdT8rsdq6kIicLhjAUO8atSTIpYk66X1dv08RFcw/132","comment_is_top":false,"comment_ctime":1544362098,"is_pvip":false,"replies":[{"id":"17144","content":"嗯好几个评论说到，在答疑篇说这个哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544364765,"ip_address":"","comment_id":48121,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544362098","product_id":100020801,"comment_content":"老师，您好，我在网上有看到一个innodb_log_buffer， 好像是介于内存和redo log之间的一个缓冲区，不知道这个该怎么理解呢？或者说它的优势在哪？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432035,"discussion_content":"嗯好几个评论说到，在答疑篇说这个哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544364765,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48050,"user_name":"Genius  小嘉","can_delete":false,"product_type":"c1","uid":1238566,"ip_address":"","ucode":"B53F7C1FE3FC49","user_header":"https://static001.geekbang.org/account/avatar/00/12/e6/26/de4f01e7.jpg","comment_is_top":false,"comment_ctime":1544334212,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544334212","product_id":100020801,"comment_content":"老师，二阶段提交，是写完binlog就会返回给程序执行成功么？还是必须redo commit才会给程序成功？","like_count":0},{"had_liked":false,"id":47977,"user_name":"力挽狂澜爆炸输出的臭臭宁","can_delete":false,"product_type":"c1","uid":1155904,"ip_address":"","ucode":"E8D26181129BCA","user_header":"https://static001.geekbang.org/account/avatar/00/11/a3/40/e0df3b84.jpg","comment_is_top":false,"comment_ctime":1544276208,"is_pvip":false,"replies":[{"id":"17100","content":"15篇会说哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544332627,"ip_address":"","comment_id":47977,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544276208","product_id":100020801,"comment_content":"为什么不能用binlog的数据进行crash恢复呢？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431967,"discussion_content":"15篇会说哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544332627,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47959,"user_name":"qinggeouye","can_delete":false,"product_type":"c1","uid":1251536,"ip_address":"","ucode":"5B53EEDD7BEC9C","user_header":"https://static001.geekbang.org/account/avatar/00/13/18/d0/49b06424.jpg","comment_is_top":false,"comment_ctime":1544267104,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544267104","product_id":100020801,"comment_content":"redo log 记录物理日志（做了什么改动），事物的提交在 redo log 里完成，bin log 记录逻辑日志（执行语句SQL的原始逻辑、记录更新前后的内容）；<br><br>「两阶段提交」那块，先写入 redo log 处于 prepare 状态，再写 bin log，最后 redo log 提交事物处于 commit 状态。<br><br>有个疑问：<br>如果在最后 redo log 提交事物这一步，数据库发生了 crash 导致没有提交成功，但由于 bin log 里已经记录了逻辑日志，数据恢复的时候仍然从 bin log 取出逻辑SQL来恢复数据吗？","like_count":0},{"had_liked":false,"id":47921,"user_name":"wvalianty","can_delete":false,"product_type":"c1","uid":1261407,"ip_address":"","ucode":"E5029CD900094B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL17yp3TmdQNXWELQvjIA2azwZ6ib7Riae9Hcf2YFl1uvnvocQoicTOtJLnvjUPtpbYhSng7DtPR9lfg/132","comment_is_top":false,"comment_ctime":1544257589,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1544257589","product_id":100020801,"comment_content":"老师，请教一个问题，两段式提交，如果redolog  prepare和binlog都成功了，最后commit失败了，会怎样？","like_count":0,"discussions":[{"author":{"id":1943530,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/a7/ea/b3e10043.jpg","nickname":"Black liu","note":"","ucode":"3D92552D06CA8F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":220547,"discussion_content":"可以翻看上面的最新评论，有回答。这种情况，恢复的时候，就直接commit了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585893233,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47842,"user_name":"Genius  小嘉","can_delete":false,"product_type":"c1","uid":1238566,"ip_address":"","ucode":"B53F7C1FE3FC49","user_header":"https://static001.geekbang.org/account/avatar/00/12/e6/26/de4f01e7.jpg","comment_is_top":false,"comment_ctime":1544234855,"is_pvip":false,"replies":[{"id":"17111","content":"这个问题15篇会说哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544333930,"ip_address":"","comment_id":47842,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544234855","product_id":100020801,"comment_content":"老师，问个问题，redo log不是先写redo log buffer,然后再写到redo log磁盘文件么？  看您说的好像没有写到refo log buffer 这个过程啊。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431904,"discussion_content":"这个问题15篇会说哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544333930,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47773,"user_name":"陈","can_delete":false,"product_type":"c1","uid":1304668,"ip_address":"","ucode":"81A54B3BA9C721","user_header":"https://static001.geekbang.org/account/avatar/00/13/e8/5c/561caff2.jpg","comment_is_top":false,"comment_ctime":1544194327,"is_pvip":false,"replies":[{"id":"17015","content":"你是不是要回复11讲的，回复到02来了😓","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544195251,"ip_address":"","comment_id":47773,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544194327","product_id":100020801,"comment_content":"如果值相同有判断不写binlog那么按逻辑，数据应该也不会在内存中改，从而减少写磁盘，从而不会写redo log,至于怎么判断就要去看write pos是否有改变，可以通过一个大量的更新相同值语句来测试，这是我想到的方法，不知老师是否有其他方法？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431884,"discussion_content":"你是不是要回复11讲的，回复到02来了😓","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544195251,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47758,"user_name":"卫江","can_delete":false,"product_type":"c1","uid":1101226,"ip_address":"","ucode":"DE2F7A6916F1A9","user_header":"https://static001.geekbang.org/account/avatar/00/10/cd/aa/33d48789.jpg","comment_is_top":false,"comment_ctime":1544191562,"is_pvip":false,"replies":[{"id":"17035","content":"重启后，崩溃恢复过程中提交该事务","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544247223,"ip_address":"","comment_id":47758,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544191562","product_id":100020801,"comment_content":"我想问一下，update最后一步，既修改对应redo日志的状态为commit，这个时候，系统crash，会出现什么情况","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431879,"discussion_content":"重启后，崩溃恢复过程中提交该事务","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544247223,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47689,"user_name":"lucky star","can_delete":false,"product_type":"c1","uid":1311928,"ip_address":"","ucode":"C61FC9CA1C8A60","user_header":"https://static001.geekbang.org/account/avatar/00/14/04/b8/3fd2f448.jpg","comment_is_top":false,"comment_ctime":1544182532,"is_pvip":false,"replies":[{"id":"17000","content":"嗯，其实每个同学疑问的点可能都不一样，没法全部展开。答疑篇和评论区其实就是扩展正文的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544191064,"ip_address":"","comment_id":47689,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544182532","product_id":100020801,"comment_content":"建议老师把redo日志和binlog日志两阶段提交那里说仔细一点，比如说： <br>      1，binlog是有固定格式的，是可以检查出来写binlog的时候有没有出错（可以解疑写binlog时出错了恢复的时候怎么知道binlog数据是否正确的问题）；<br>      2， binlog和redo日志是有事物ID对应的（可以解疑如果刚好写完redo第一阶段， 还没开始写binlog，然后挂掉了， 这时候binlog是格式正确的， 恢复的时候是怎么确定binlog数据不缺失的问题）；<br>这都是我带着疑问从评论里找到的答案！ 如果在原文中写上会给读者省掉很多时间去找答案<br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431857,"discussion_content":"嗯，其实每个同学疑问的点可能都不一样，没法全部展开。答疑篇和评论区其实就是扩展正文的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544191064,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47333,"user_name":"broken_open","can_delete":false,"product_type":"c1","uid":1313347,"ip_address":"","ucode":"764CF5EEACC4AD","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEJjTz6oOKAXefgCNHTuTmwibBPJX9a4c407GHYmFPdMRgX67nZiavj2KhbiczicaaeSGxOxiaibnqH7icnVw/132","comment_is_top":false,"comment_ctime":1544109056,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544109056","product_id":100020801,"comment_content":"1 prepare阶段 2 写binlog 3 commit<br>当在2之前崩溃时<br>重启恢复：后发现没有commit，回滚。备份恢复：没有binlog 。<br>一致<br>当在3之前崩溃<br>重启恢复：虽没有commit，但满足prepare和binlog完整，所以重启后会自动commit。备份：有binlog. 一致","like_count":0},{"had_liked":false,"id":47259,"user_name":"三木禾","can_delete":false,"product_type":"c1","uid":1109458,"ip_address":"","ucode":"39C37228236860","user_header":"https://static001.geekbang.org/account/avatar/00/10/ed/d2/e3ae7ddd.jpg","comment_is_top":false,"comment_ctime":1544090735,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544090735","product_id":100020801,"comment_content":"还有如果二阶段操作，在binlog写入磁盘之后，MySQL崩溃了，事物还未提交，此时redolog的状态还是prepared，如何处理?<br>还有如果二阶段操作，在binlog未写入磁盘，MySQL崩溃了，事物还未提交，此时redolog的状态还是prepared，如何处理?<br>","like_count":0},{"had_liked":false,"id":47253,"user_name":"三木禾","can_delete":false,"product_type":"c1","uid":1109458,"ip_address":"","ucode":"39C37228236860","user_header":"https://static001.geekbang.org/account/avatar/00/10/ed/d2/e3ae7ddd.jpg","comment_is_top":false,"comment_ctime":1544089604,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544089604","product_id":100020801,"comment_content":"然后，从备份的时间点开始，将备份的 binlog 依次取出来，重放到中午误删表之前的那个时刻。<br>这，这段话不太理解，重放，将binlog取出来","like_count":0},{"had_liked":false,"id":47239,"user_name":"三木禾","can_delete":false,"product_type":"c1","uid":1109458,"ip_address":"","ucode":"39C37228236860","user_header":"https://static001.geekbang.org/account/avatar/00/10/ed/d2/e3ae7ddd.jpg","comment_is_top":false,"comment_ctime":1544086403,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544086403","product_id":100020801,"comment_content":"貌似不太理解数据页的概念，希望下次讲解一下数据库是如何组织数据的，谢谢老师","like_count":0},{"had_liked":false,"id":47197,"user_name":"vivien_zh","can_delete":false,"product_type":"c1","uid":1137491,"ip_address":"","ucode":"3C029219C90C14","user_header":"https://static001.geekbang.org/account/avatar/00/11/5b/53/200fda62.jpg","comment_is_top":false,"comment_ctime":1544075184,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544075184","product_id":100020801,"comment_content":"一周一备 需要保证在恢复的时间点之内的所有binlog日志必须没有损坏<br>一日一备 则需要更多的存储空间，而且恢复的速度也会快很多","like_count":0},{"had_liked":false,"id":47195,"user_name":"vivien_zh","can_delete":false,"product_type":"c1","uid":1137491,"ip_address":"","ucode":"3C029219C90C14","user_header":"https://static001.geekbang.org/account/avatar/00/11/5b/53/200fda62.jpg","comment_is_top":false,"comment_ctime":1544074913,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544074913","product_id":100020801,"comment_content":"感谢老师 细致的说清楚了redo log 和binlog的区别，更主要的是具体的解释了数据库异常crash后，通过备份+日志恢复中间的差异。","like_count":0},{"had_liked":false,"id":47070,"user_name":"null","can_delete":false,"product_type":"c1","uid":1024294,"ip_address":"","ucode":"F9039EFED6B55D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","comment_is_top":false,"comment_ctime":1544028979,"is_pvip":false,"replies":[{"id":"16821","content":"1. 但是binlog并不知道他们没有落盘，这个是引擎内部机制。不会去重新执行。<br><br>2. 对… 一般是这样，恢复出一个临时库是误删前的。然后把里面的数据按需取出来放到线上的库里","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544063820,"ip_address":"","comment_id":47070,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544028979","product_id":100020801,"comment_content":"谢谢老师回复。<br>老师经常半夜回复留言，上次有一条是凌晨 2 点多回复，老师辛苦了！！<br><br>---<br><br>疑问一：<br>老师您回复：WAL机制里面有“已经提交但是还没落盘”的数据，binlog恢复不了这些。<br>这是因为一开始 binlog 就是设计为归档日志，因此恢复不了“已经提交但是还没落盘”的数据么？<br>从图“update 语句执行流程”来看，提交前已经写 binlog 日志了，即使没落盘，这部分数据仍然是未丢失的。<br><br>疑问二：<br>文章的例子：某天下午两点发现中午十二点有一次误删表，需要找回数据<br>最近一次全量备份文件 + 重放到误删表之前那一时刻，这样十二点到两点的数据是不是丢失了，恢复不了了？<br><br>谢谢老师，晚安！","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431653,"discussion_content":"1. 但是binlog并不知道他们没有落盘，这个是引擎内部机制。不会去重新执行。\n\n2. 对… 一般是这样，恢复出一个临时库是误删前的。然后把里面的数据按需取出来放到线上的库里","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544063820,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46929,"user_name":"戴","can_delete":false,"product_type":"c1","uid":1246965,"ip_address":"","ucode":"05251C6B7BFF90","user_header":"https://static001.geekbang.org/account/avatar/00/13/06/f5/0f1adaf3.jpg","comment_is_top":false,"comment_ctime":1544003475,"is_pvip":false,"replies":[{"id":"16745","content":"第十五篇😄","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544011675,"ip_address":"","comment_id":46929,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544003475","product_id":100020801,"comment_content":"请问答疑的文章在哪里看呢","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431606,"discussion_content":"第十五篇😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544011675,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46559,"user_name":"股海旗舰","can_delete":false,"product_type":"c1","uid":1242102,"ip_address":"","ucode":"B7E0A5F2D8EE72","user_header":"https://static001.geekbang.org/account/avatar/00/12/f3/f6/55f8364f.jpg","comment_is_top":false,"comment_ctime":1543936049,"is_pvip":false,"replies":[{"id":"16648","content":"每个事务的binlog日志都有标准的结尾的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543942272,"ip_address":"","comment_id":46559,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543936049","product_id":100020801,"comment_content":"高枕同学提到的，有点疑问，烦请老师解答：<br>1 prepare阶段 2 写binlog 3 commit<br>..........<br>当在3之前崩溃<br>重启恢复：虽没有commit，但满足prepare和binlog完整，所以重启后会自动commit。备份：有binlog. 一致<br><br>疑问：虽没有commit，但满足prepare和binlog完整，所以重启后会自动commit。<br>--这里的binlog完整，通过什么方式或机制来判断？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431483,"discussion_content":"每个事务的binlog日志都有标准的结尾的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543942272,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46548,"user_name":"股海旗舰","can_delete":false,"product_type":"c1","uid":1242102,"ip_address":"","ucode":"B7E0A5F2D8EE72","user_header":"https://static001.geekbang.org/account/avatar/00/12/f3/f6/55f8364f.jpg","comment_is_top":false,"comment_ctime":1543934931,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543934931","product_id":100020801,"comment_content":"1、写入redolog prepare<br>2、写binlog<br>3、提交事务(commit)<br>如果2执行完，在执行3之前宕机，这时候，binlog已经写完了，如果使用binlog做备份恢复，那么恢复的库和实际的库的数据(MySQL重启后会将事务回滚？)应该是不一致吧。<br>如果数据一致，那不是第3步都不需要了？<br>我记得以前看过文档，要处理这种情况，需要将参数 innodb_support_xa设置为1来确保数据同步。","like_count":0},{"had_liked":false,"id":46502,"user_name":"王灯武","can_delete":false,"product_type":"c1","uid":1107432,"ip_address":"","ucode":"B35FF513125BA9","user_header":"https://static001.geekbang.org/account/avatar/00/10/e5/e8/033bdbf5.jpg","comment_is_top":false,"comment_ctime":1543930930,"is_pvip":false,"replies":[{"id":"16617","content":"这就是为什么MySQL 在崩溃恢复的时候，会在主库提交这个事务","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543932893,"ip_address":"","comment_id":46502,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543930930","product_id":100020801,"comment_content":"两阶段提交那个地方用了反证法，个人认为并不一定用了两阶段提交就一定可靠，写入redolog--&gt;写binlog--&gt;提交事务处于commit状态，这个是3步，可能在写完binlog后直接服务器断电，碰到过从库的binlog比主库还超前的状况（可能是binlog已通过网络传给从库，但是主库断电数据没落盘），大神可以解释下这种场景，谢谢！","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431473,"discussion_content":"这就是为什么MySQL 在崩溃恢复的时候，会在主库提交这个事务","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543932893,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46486,"user_name":"杰之7","can_delete":false,"product_type":"c1","uid":1297232,"ip_address":"","ucode":"F7DA2E21085332","user_header":"https://static001.geekbang.org/account/avatar/00/13/cb/50/66d0bd7f.jpg","comment_is_top":false,"comment_ctime":1543930294,"is_pvip":false,"replies":[{"id":"16618","content":"Redolog和binlog都是记录数据的改动，前者是针对数据页，后者是记录修改逻辑（这一行要怎么改）","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543933001,"ip_address":"","comment_id":46486,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543930294","product_id":100020801,"comment_content":"通过本节的学习熟悉了更新语句除了有查询语句的执行流程，还增加了两个日志，redolog和binlog。老师，我有一点疑问，文章写到redolog是物理日志，记录在某个数据页做了什么修改，binlog是逻辑日志，是原始逻辑。我是否可以这样理解，redolog是增加新的内容，binlog是对表中已有数据做改动。回到老师的问题，一天一备份与一周一在什么指标上更有优势，我的理解是在优化指标上更有优势，备份时间越长，之后查询建立索引上就需要花更多的时间，所以对优化指标有影响，请老师回复我的问题疑问，感谢与老师一同进步。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431469,"discussion_content":"Redolog和binlog都是记录数据的改动，前者是针对数据页，后者是记录修改逻辑（这一行要怎么改）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543933001,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46386,"user_name":"Sinyo","can_delete":false,"product_type":"c1","uid":1307297,"ip_address":"","ucode":"57B243E7AB86A5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJAibnPX9jW8kqLcIfibjic8GbkQkEUYyFKJkc39hZhibVlNrqwTjdLozkqibI2IwACd5YzofYickNxFnZg/132","comment_is_top":false,"comment_ctime":1543913387,"is_pvip":false,"replies":[{"id":"16600","content":"不能持久保存，是因为redolog是循环写的，这样没矛盾呀","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543927707,"ip_address":"","comment_id":46386,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543913387","product_id":100020801,"comment_content":"老师，您有提到以下两点，不知道是不是有点矛盾呢？第一点提到redolog能持久化到磁盘，第二点提到不能持久保存。<br><br>1. redo log 用于保证 crash-safe 能力。innodb_flush_log_at_trx_commit这个参数设置成 1 的时候，表示每次事务的 redo log 都直接持久化到磁盘。这个参数我建议你设置成 1，这样可以保证MySQL 异常重启之后数据不丢失；<br>2. binlog还不能去掉。<br>一个原因是，redolog只有InnoDB有，别的引擎没有。<br>另一个原因是，redolog是循环写的，不持久保存，binlog的“归档”这个功能，redolog是不具备的。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431442,"discussion_content":"不能持久保存，是因为redolog是循环写的，这样没矛盾呀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543927707,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46282,"user_name":"……","can_delete":false,"product_type":"c1","uid":1304775,"ip_address":"","ucode":"A4CA8D58022E36","user_header":"https://static001.geekbang.org/account/avatar/00/13/e8/c7/aba1275d.jpg","comment_is_top":false,"comment_ctime":1543892587,"is_pvip":false,"replies":[{"id":"16567","content":"1. 到了提交阶段，就是把logbuffer写入redolog duke<br><br>2. 第二阶段，其实就是binlog和redolog最终提交的阶段","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543898416,"ip_address":"","comment_id":46282,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543892587","product_id":100020801,"comment_content":"老师，有一点我有点想不通。两阶段提交的第一阶段，将变更的记录写入redo日志，这个阶段是写到了log buffer还是 log file？binlog也是一样。<br>在第二阶段提交，binlog和redo是这个时候进行刷盘，还是目前已经完成刷盘，二阶段提交确保两者已经刷盘的情况下才会真正意义上完成commit,否则进行rollback。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431404,"discussion_content":"1. 到了提交阶段，就是把logbuffer写入redolog duke\n\n2. 第二阶段，其实就是binlog和redolog最终提交的阶段","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543898416,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46199,"user_name":"王先统","can_delete":false,"product_type":"c1","uid":1236218,"ip_address":"","ucode":"4D208672C0D359","user_header":"https://static001.geekbang.org/account/avatar/00/12/dc/fa/3975f8da.jpg","comment_is_top":false,"comment_ctime":1543883589,"is_pvip":false,"replies":[{"id":"16553","content":"“再打散”是啥意思","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543891860,"ip_address":"","comment_id":46199,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543883589","product_id":100020801,"comment_content":"看了下留言，大家普遍对两阶段提交中的三个步骤再打散怎么保持一致有疑问，请老师再补充一下呢","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431371,"discussion_content":"“再打散”是啥意思","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543891860,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46192,"user_name":"王先统","can_delete":false,"product_type":"c1","uid":1236218,"ip_address":"","ucode":"4D208672C0D359","user_header":"https://static001.geekbang.org/account/avatar/00/12/dc/fa/3975f8da.jpg","comment_is_top":false,"comment_ctime":1543882910,"is_pvip":false,"replies":[{"id":"16556","content":"1. 系统重启后会提交这个事务<br><br>2. 系统重启后会回滚这个事务","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543892023,"ip_address":"","comment_id":46192,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543882910","product_id":100020801,"comment_content":"问一个两阶段提交的问题: 如果最后写完binlog，但是没有commit redolog，这个时候redolog处于prepare的状态，岂不是也不一致了？或者说，我只prepare了redolog系统就挂了， binlog都没写呢，又怎样呢？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431366,"discussion_content":"1. 系统重启后会提交这个事务\n\n2. 系统重启后会回滚这个事务","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543892023,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46114,"user_name":"疾风狂草","can_delete":false,"product_type":"c1","uid":1283489,"ip_address":"","ucode":"05F899725048BC","user_header":"","comment_is_top":false,"comment_ctime":1543849023,"is_pvip":false,"replies":[{"id":"16516","content":"前面对的，“Checkpoint需要真实记录”开始没看懂你的意思","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543887064,"ip_address":"","comment_id":46114,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543849023","product_id":100020801,"comment_content":"是否可以理解为：write pos是redolog记录的位置，而check point就是purge了的位置。如果是的话，redolog的末尾就是write pos，而check point 需要真实记录，并且落盘，才可以保证crash safe，那么他的机制是怎样的呢？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431341,"discussion_content":"前面对的，“Checkpoint需要真实记录”开始没看懂你的意思","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543887064,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45898,"user_name":"可凡不凡","can_delete":false,"product_type":"c1","uid":1296289,"ip_address":"","ucode":"9D42D6C5274D48","user_header":"https://static001.geekbang.org/account/avatar/00/13/c7/a1/273bff58.jpg","comment_is_top":false,"comment_ctime":1543815323,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543815323","product_id":100020801,"comment_content":"Redo log不是记录数据页“更新之后的状态”，而是记录这个页 “做了什么改动”。 <br>redo log 不是记录的更新后的状态吗","like_count":0},{"had_liked":false,"id":45896,"user_name":"可凡不凡","can_delete":false,"product_type":"c1","uid":1296289,"ip_address":"","ucode":"9D42D6C5274D48","user_header":"https://static001.geekbang.org/account/avatar/00/13/c7/a1/273bff58.jpg","comment_is_top":false,"comment_ctime":1543815229,"is_pvip":false,"replies":[{"id":"16396","content":"看08篇哈，那里有","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543820696,"ip_address":"","comment_id":45896,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543815229","product_id":100020801,"comment_content":"感觉老是应该把redo log 和 undo log 放一起说说 有点迷糊了","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431259,"discussion_content":"看08篇哈，那里有","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543820696,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45773,"user_name":"湘江鸿","can_delete":false,"product_type":"c1","uid":1235643,"ip_address":"","ucode":"3141BE28A69C17","user_header":"https://static001.geekbang.org/account/avatar/00/12/da/bb/a20f37b2.jpg","comment_is_top":false,"comment_ctime":1543794224,"is_pvip":false,"replies":[{"id":"16348","content":"这样不算，这样得应用程序自己check","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543800014,"ip_address":"","comment_id":45773,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543794224","product_id":100020801,"comment_content":"请教下，如果是redo log处于prepare状态，执行器写完了binlog，然后在提交事务给存储引擎的时候，存储引擎这边操作成功了，但是返回给执行器的时候宕机了，这样两边状态就不一致了吧？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431205,"discussion_content":"这样不算，这样得应用程序自己check","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543800014,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45739,"user_name":"gesanri","can_delete":false,"product_type":"c1","uid":1121174,"ip_address":"","ucode":"AE3B97DC3ED668","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELtOO0HKrj5SI5JSlmwiaCvaF6GLiaTmf5NX88OZaO3HymTAGTeIoicBUjqzmMF6sF5raPFjuqLFibrrw/132","comment_is_top":false,"comment_ctime":1543764427,"is_pvip":false,"replies":[{"id":"16271","content":"不只的，这个问题很多同学问，答疑文章来说哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543769334,"ip_address":"","comment_id":45739,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543764427","product_id":100020801,"comment_content":"看完文章我觉得可以只用binlog，不用redo log，没明白为什么binlog没有crash safe的能力?它不也是存文件吗？异常重启也可以通过它恢复啊，仅仅是因为binlog可以被关闭?那我不关它是不是就可以不用redo log了","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431184,"discussion_content":"不只的，这个问题很多同学问，答疑文章来说哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543769334,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45689,"user_name":"飞飞走走","can_delete":false,"product_type":"c1","uid":1304493,"ip_address":"","ucode":"E9BCBA6D00C226","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1V6BNbTzjPMFPXQLia7jGpKiczxASA2ooAy1tcTkVzbF4upxMZLTxj6GoIlJibudSrJUBCgB0pj9bA/132","comment_is_top":false,"comment_ctime":1543751498,"is_pvip":false,"replies":[{"id":"16276","content":"主要看你预设多大的TPS，现在SSD机器+32G 以上内存，建议设置4个1G","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543774686,"ip_address":"","comment_id":45689,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543751498","product_id":100020801,"comment_content":"老师，我想问下，装库的时候，redo 应该设置成几个文件，以及每个文件的大小怎么设置的，应该从哪些方面去考虑呢","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431158,"discussion_content":"主要看你预设多大的TPS，现在SSD机器+32G 以上内存，建议设置4个1G","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543774686,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45644,"user_name":"sugar","can_delete":false,"product_type":"c1","uid":1167046,"ip_address":"","ucode":"454538FF253B5F","user_header":"https://static001.geekbang.org/account/avatar/00/11/ce/c6/958212b5.jpg","comment_is_top":false,"comment_ctime":1543736752,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543736752","product_id":100020801,"comment_content":"老师您好，看到prepare-commit两阶段提交这里，想请问一下：如果系统运行到prepare阶段时断电，于是 这一次修改还未commit，那么下一次系统重启后会将此次中间态的redolog继续落到binlog中，还是将此条redolog回滚掉呢？重启后 Innodb是否会检查redolog与当前磁盘上物理存储的数据做diff呢？","like_count":0},{"had_liked":false,"id":45632,"user_name":"过去、今日","can_delete":false,"product_type":"c1","uid":1097197,"ip_address":"","ucode":"8E171203B06513","user_header":"https://static001.geekbang.org/account/avatar/00/10/bd/ed/95e8a314.jpg","comment_is_top":false,"comment_ctime":1543728779,"is_pvip":false,"replies":[{"id":"16279","content":"只好靠恢复后，应用程序自己来查数据验证","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543774829,"ip_address":"","comment_id":45632,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543728779","product_id":100020801,"comment_content":"两阶段提交<br>1、prepare 2、写入binlog 3、commit<br>如果到2后，系统奔溃，binlog没写入，事务回滚<br>如果到3后，系统奔溃，binlog写入，事务自动提交<br>那有个疑问在这过程中，事务回滚和提交mysql是怎么判断的？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431131,"discussion_content":"只好靠恢复后，应用程序自己来查数据验证","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543774829,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45570,"user_name":"扬～","can_delete":false,"product_type":"c1","uid":1208163,"ip_address":"","ucode":"6FA7D8FE188341","user_header":"https://static001.geekbang.org/account/avatar/00/12/6f/63/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1543680225,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543680225","product_id":100020801,"comment_content":"只设计使用binlog不行吗，对于里面的操作也分2阶段，这样崩溃时，也能根据记录最近的状态来判断是否回滚提交","like_count":0},{"had_liked":false,"id":45568,"user_name":"顺流逆流","can_delete":false,"product_type":"c1","uid":1311364,"ip_address":"","ucode":"8F9DD7CB7BD2A8","user_header":"https://static001.geekbang.org/account/avatar/00/14/02/84/add96944.jpg","comment_is_top":false,"comment_ctime":1543678768,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543678768","product_id":100020801,"comment_content":"我感觉binlog也可以保证crash-safe能力吧？因为如果binlog记录数据库所有执行更新语句，那么可以通过更新语句恢复数据库的状态吧？还有如果我只有binlog感觉就很安全了，为什么还需要redo log？我一直不太理解","like_count":0},{"had_liked":false,"id":45378,"user_name":"TiTi","can_delete":false,"product_type":"c1","uid":1127343,"ip_address":"","ucode":"58F19596A1EF4C","user_header":"https://static001.geekbang.org/account/avatar/00/11/33/af/dda311cf.jpg","comment_is_top":false,"comment_ctime":1543626929,"is_pvip":false,"replies":[{"id":"16167","content":"这时候崩溃恢复肯定是要回滚了<br><br>但是确没办法再“通知客户端”了，因为之前连接就已经断开了。<br><br>只能靠客户端发起新连接去查数据确认","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543631274,"ip_address":"","comment_id":45378,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543626929","product_id":100020801,"comment_content":"对于&quot;redo log 用于保证 crash-safe 能力&quot;这个描述，如果在写redo log的时候发生异常(比如断电)，那重启后该条更新是不是失败了？但是在这种情况下redo log、binlog和磁盘上的数据文件里都没有该条更新的记录，从数据一致性角度来看，整个MySQL系统是“安全”的。更新失败的事务可以通知客户端重新提交。不知道我这样理解对不对？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431007,"discussion_content":"这时候崩溃恢复肯定是要回滚了\n\n但是确没办法再“通知客户端”了，因为之前连接就已经断开了。\n\n只能靠客户端发起新连接去查数据确认","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543631274,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45141,"user_name":"彭莉","can_delete":false,"product_type":"c1","uid":1117755,"ip_address":"","ucode":"893D21432DD63A","user_header":"https://static001.geekbang.org/account/avatar/00/11/0e/3b/66ec78f8.jpg","comment_is_top":false,"comment_ctime":1543549676,"is_pvip":false,"replies":[{"id":"16150","content":"Undo log跟数据一样，也是WAL机制写入，需要依赖redolog 恢复出来<br><br>","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543630108,"ip_address":"","comment_id":45141,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543549676","product_id":100020801,"comment_content":"只有redo-log，没有undo-log，innodb应该没有办法做到crash safe，楼主可不可以把这块也稍微讲一下呢？目前有点一知半解。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430937,"discussion_content":"Undo log跟数据一样，也是WAL机制写入，需要依赖redolog 恢复出来\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543630108,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44846,"user_name":"yihang","can_delete":false,"product_type":"c1","uid":1012361,"ip_address":"","ucode":"A5506F085D1793","user_header":"https://static001.geekbang.org/account/avatar/00/0f/72/89/1a83120a.jpg","comment_is_top":false,"comment_ctime":1543499541,"is_pvip":false,"replies":[{"id":"15978","content":"已加入答疑文章topic","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543504573,"ip_address":"","comment_id":44846,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543499541","product_id":100020801,"comment_content":"有一点没有看懂为什么binlog没有crash-safe的能力？而redolog有？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430849,"discussion_content":"已加入答疑文章topic","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543504573,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44810,"user_name":"yu🐟","can_delete":false,"product_type":"c1","uid":1181583,"ip_address":"","ucode":"E988567C46539E","user_header":"https://static001.geekbang.org/account/avatar/00/12/07/8f/3ef096f3.jpg","comment_is_top":false,"comment_ctime":1543495691,"is_pvip":false,"replies":[{"id":"15988","content":"内存里数据是对的<br>","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543517806,"ip_address":"","comment_id":44810,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543495691","product_id":100020801,"comment_content":"老师您好，如果update写入日志，还没写进磁盘，此时执行查询，如何保证不会产生数据脏读的？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430840,"discussion_content":"内存里数据是对的\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543517806,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44556,"user_name":"包子木有馅","can_delete":false,"product_type":"c1","uid":1318851,"ip_address":"","ucode":"9B8712D4DC7471","user_header":"https://static001.geekbang.org/account/avatar/00/14/1f/c3/1ef2bccf.jpg","comment_is_top":false,"comment_ctime":1543457009,"is_pvip":true,"replies":[{"id":"15881","content":"“更新到磁盘” 就是后者，<br><br>Insert buffer本身是数据的一种， 只是说insert buffer也可以把随机读写变成顺序写。<br>这个我们后面讲唯一索引的时候会提到哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543458572,"ip_address":"","comment_id":44556,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543457009","product_id":100020801,"comment_content":"老师好，“同时，InnoDB 引擎会在适当的时候，将这个操作记录更新到磁盘”，想问一下这里“更新到磁盘”是指将日志写入磁盘呢还是说通过redolog更新磁盘里的数据页，如果是后一种的话，那和insert buffer不是一样了吗？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430792,"discussion_content":"“更新到磁盘” 就是后者，\n\nInsert buffer本身是数据的一种， 只是说insert buffer也可以把随机读写变成顺序写。\n这个我们后面讲唯一索引的时候会提到哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543458572,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44553,"user_name":"zxx","can_delete":false,"product_type":"c1","uid":1228129,"ip_address":"","ucode":"C1D9368A4F544E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/GrQsm2lOxnBhFuegVwNxrA2dd9qQLwLOlV3xUB615eqKia5vQPdRcnz1T6sxLcmiaSnibTEIVia9ebThaVWxF2TMnw/132","comment_is_top":false,"comment_ctime":1543456832,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543456832","product_id":100020801,"comment_content":"如果commit写入失败怎么办呢？","like_count":0},{"had_liked":false,"id":44386,"user_name":"王宝龙","can_delete":false,"product_type":"c1","uid":1328175,"ip_address":"","ucode":"C5A945E44FE89E","user_header":"https://static001.geekbang.org/account/avatar/00/14/44/2f/42a8d353.jpg","comment_is_top":false,"comment_ctime":1543418001,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543418001","product_id":100020801,"comment_content":"1. 在没有 InnoDB 的 redo log 之前，MyISAM 引擎就已经在做 “粉板” 功能了？只是没有写入日志而已，仅保留在内存中而已。如果是这样的话，那么就会产生 crash 后数据差异的状况。<br>2. 在更新操作时，作者举的例子，是“写入新行”之后再写入 redo log 和 binlog 的，但是按作者的话是，应该是“Write-Ahead Logging”先写日志，等不忙时在写磁盘。也就是说，在文中的第三张图中，作者是按 MySQL 不忙为前提，假如以 MySQL 繁忙为前提，那么 redo log 是不是应该在“写入新行”之前，然后 MySQL 等空闲时，再根据 redo log 写入。","like_count":0},{"had_liked":false,"id":44230,"user_name":"龙猫","can_delete":false,"product_type":"c1","uid":1112490,"ip_address":"","ucode":"FD726CC969EF9C","user_header":"https://static001.geekbang.org/account/avatar/00/10/f9/aa/3e80212e.jpg","comment_is_top":false,"comment_ctime":1543390134,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543390134","product_id":100020801,"comment_content":"mysql的插入操作是否也有两个日志呢，对于批量性的insert在values后面跟多少条值是上线？我看有人说2w多条。","like_count":0},{"had_liked":false,"id":44196,"user_name":"天马行空","can_delete":false,"product_type":"c1","uid":1061352,"ip_address":"","ucode":"3BD51E0E25099E","user_header":"https://static001.geekbang.org/account/avatar/00/10/31/e8/3e61e916.jpg","comment_is_top":false,"comment_ctime":1543381624,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543381624","product_id":100020801,"comment_content":"两个日志的记录是如何建立对应关系的？","like_count":0},{"had_liked":false,"id":44075,"user_name":"流血的手指","can_delete":false,"product_type":"c1","uid":1012632,"ip_address":"","ucode":"D50D16BF7B0B37","user_header":"","comment_is_top":false,"comment_ctime":1543367376,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543367376","product_id":100020801,"comment_content":"redolog binlog是直接写到硬盘吗？还是内存里","like_count":0},{"had_liked":false,"id":43870,"user_name":"Kongk0ng","can_delete":false,"product_type":"c1","uid":1004131,"ip_address":"","ucode":"784B1EABDD7328","user_header":"https://static001.geekbang.org/account/avatar/00/0f/52/63/a58ae0ab.jpg","comment_is_top":false,"comment_ctime":1543315204,"is_pvip":false,"replies":[{"id":"15665","content":"重启后崩溃恢复时提交事务","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543318298,"ip_address":"","comment_id":43870,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543315204","product_id":100020801,"comment_content":"请问如果写完binlog后crash，redolog还没commit，这时候会发生什么？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430530,"discussion_content":"重启后崩溃恢复时提交事务","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543318298,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43827,"user_name":"马若飞","can_delete":false,"product_type":"c1","uid":1046394,"ip_address":"","ucode":"3D0327329A10AE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","comment_is_top":false,"comment_ctime":1543304797,"is_pvip":false,"replies":[{"id":"15749","content":"是的，顺序写比随机写快","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543401701,"ip_address":"","comment_id":43827,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543304797","product_id":100020801,"comment_content":"如果是redo log是直接写磁盘，为什么不把更新的数据直接写磁盘？是因为慢太多？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430514,"discussion_content":"是的，顺序写比随机写快","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543401701,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43798,"user_name":"seafooler","can_delete":false,"product_type":"c1","uid":1040831,"ip_address":"","ucode":"F9603E3907711A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e1/bf/7b22efac.jpg","comment_is_top":false,"comment_ctime":1543296079,"is_pvip":false,"replies":[{"id":"15632","content":"日志顺序写盘，比直接写数据（随机写盘）还是快的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543297252,"ip_address":"","comment_id":43798,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543296079","product_id":100020801,"comment_content":"老师，我有个问题。如果将innodb_flush_log_at_trx_commit参数设置为1，那么每次redo log都要被刷新到磁盘，这样效率也会比较低吧。感觉就不太符合您讲的“掌柜写粉板提高效率”例子了。谢谢老师的解答","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430502,"discussion_content":"日志顺序写盘，比直接写数据（随机写盘）还是快的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543297252,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43791,"user_name":"动与静","can_delete":false,"product_type":"c1","uid":1253723,"ip_address":"","ucode":"7ABBE22860BBCC","user_header":"https://static001.geekbang.org/account/avatar/00/13/21/5b/09940ac6.jpg","comment_is_top":false,"comment_ctime":1543294660,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543294660","product_id":100020801,"comment_content":"老师，什么叫数据页？","like_count":0},{"had_liked":false,"id":43761,"user_name":"静静的等","can_delete":false,"product_type":"c1","uid":1266183,"ip_address":"","ucode":"93E4CE489CB025","user_header":"https://static001.geekbang.org/account/avatar/00/13/52/07/5d74b03f.jpg","comment_is_top":false,"comment_ctime":1543289621,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543289621","product_id":100020801,"comment_content":"1. redo log做的事情和binlog的row格式有什么区别呢？都是记录了“做了什么改动”。<br><br>Redo log不是记录数据页“更新之后的状态”，而是记录这个页 “做了什么改动”。<br>Binlog有两种模式，statement 格式的话是记sql语句， row格式会记录行的内容，记两条，更新前和更新后都有。","like_count":0},{"had_liked":false,"id":43758,"user_name":"静静的等","can_delete":false,"product_type":"c1","uid":1266183,"ip_address":"","ucode":"93E4CE489CB025","user_header":"https://static001.geekbang.org/account/avatar/00/13/52/07/5d74b03f.jpg","comment_is_top":false,"comment_ctime":1543289025,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543289025","product_id":100020801,"comment_content":"1. 写完binlog提交redo log之前，数据库crash了，这时候binlog和redo log的状态是怎样的？binlog 和redo log会回滚吗？<br>2. binlog为什么不能保证crash-safe?","like_count":0},{"had_liked":false,"id":43717,"user_name":"王大英","can_delete":false,"product_type":"c1","uid":1311484,"ip_address":"","ucode":"38C751FBBE8D4D","user_header":"https://static001.geekbang.org/account/avatar/00/14/02/fc/f18b97c3.jpg","comment_is_top":false,"comment_ctime":1543283782,"is_pvip":false,"replies":[{"id":"15603","content":"Innodb里面，redolog写完就算成功了，崩溃恢复以后这个行是1","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543285951,"ip_address":"","comment_id":43717,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543283782","product_id":100020801,"comment_content":"老师，我这个小白不懂，字段由0变1时，在“先写redo后写bin”下，写完redo就crush，您说用binlog恢复会导致结果是0和原库不一致。但那也还没commit啊，原库不还是0，用binlog恢复出来数据库也还是0，那不是反而保证了和原库一致吗？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430470,"discussion_content":"Innodb里面，redolog写完就算成功了，崩溃恢复以后这个行是1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543285951,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43659,"user_name":"大卫","can_delete":false,"product_type":"c1","uid":1323989,"ip_address":"","ucode":"DA32847C4563EF","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK7vYz9A0rM2EeOOYjMzgOf5oZWnBAJD5HgPpTGTlGWDSGE9Oic0qIF428vjJicXoaZsR5SfwwIUlUw/132","comment_is_top":false,"comment_ctime":1543278329,"is_pvip":false,"replies":[{"id":"15616","content":"你先看一下第三讲哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543287084,"ip_address":"","comment_id":43659,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543278329","product_id":100020801,"comment_content":"老师，有一点我一直不太理解，比如执行器查询一条记录的时候，引擎是从磁盘取数据放到内存在从内存中取数据返回的。更新的时候重做日志没有commit之前就更新内存了，这个时候其他的查询是不是就可以查到未提交的数据？如果加锁那么是对这块内存加锁吗？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430450,"discussion_content":"你先看一下第三讲哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543287084,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43645,"user_name":"奔跑的天蓝色蜗牛","can_delete":false,"product_type":"c1","uid":1142896,"ip_address":"","ucode":"2EB20C86A729E9","user_header":"https://static001.geekbang.org/account/avatar/00/11/70/70/381820ff.jpg","comment_is_top":false,"comment_ctime":1543273614,"is_pvip":false,"replies":[{"id":"15622","content":"不用，查内存就行","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543288130,"ip_address":"","comment_id":43645,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543273614","product_id":100020801,"comment_content":"使用redo log，有热点表的时候，对热点表的查询效率会较差—需要查询磁盘上的原始数据再查redo log，效率如何保证？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430443,"discussion_content":"不用，查内存就行","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543288130,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43633,"user_name":"仰泳的双鱼","can_delete":false,"product_type":"c1","uid":1058756,"ip_address":"","ucode":"24BA9FF7A6BA5A","user_header":"https://static001.geekbang.org/account/avatar/00/10/27/c4/eb7c7b29.jpg","comment_is_top":false,"comment_ctime":1543249616,"is_pvip":false,"replies":[{"id":"15626","content":"嗯，你这么做是可以的，但是正常重启innodb 要做崩溃恢复的，它一看，没redolog, 这个事务是没有的。但是binlog里面已经有了，用你的方法事务就存在。<br><br>设计上要避免使用方式的问题出现不一致的结果","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543288690,"ip_address":"","comment_id":43633,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543249616","product_id":100020801,"comment_content":"如果先写binlog  再写redolog ，出现crash时我以之前全备份加binlog进行恢复，不需要redolog了,出现不一致也没有问题啊？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430440,"discussion_content":"嗯，你这么做是可以的，但是正常重启innodb 要做崩溃恢复的，它一看，没redolog, 这个事务是没有的。但是binlog里面已经有了，用你的方法事务就存在。\n\n设计上要避免使用方式的问题出现不一致的结果","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543288690,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43563,"user_name":"xhrg","can_delete":false,"product_type":"c1","uid":1111400,"ip_address":"","ucode":"C0F3139B836F39","user_header":"https://static001.geekbang.org/account/avatar/00/10/f5/68/686d1a0b.jpg","comment_is_top":false,"comment_ctime":1543240427,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543240427","product_id":100020801,"comment_content":"Redolog是在系统闲时将更新到数据库，那在未更新到数据库之前，读取这条数据流程是什么样的","like_count":0},{"had_liked":false,"id":43514,"user_name":"王木鱼","can_delete":false,"product_type":"c1","uid":1305803,"ip_address":"","ucode":"BD17E305A87E6E","user_header":"https://static001.geekbang.org/account/avatar/00/13/ec/cb/27033e11.jpg","comment_is_top":false,"comment_ctime":1543235011,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543235011","product_id":100020801,"comment_content":"老师好。请问可不可以这样总结归纳：<br>事务的两阶段提交：<br>t-3 时刻：事务开始前，数据库一致<br>t-2 时刻：写入 redo log。redo log 中 本次事务为 prepare 状态<br>t-1 时刻：写入 bin log<br>t 时刻：提交事务，redo log 中 本次事务为 commit 状态<br>两阶段提交的好处是能恢复到 t时刻。<br><br>另有疑问：<br>1. 假设 bin log 可以在事务提交后 append 一个数据一致的标识，那是不是可以仅使用 binlog 就能恢复到 t-3 时刻？<br>2. redo log 是 InnoDB 特有的日志。那么从软件设计的角度来说，是不是由 MySQL 实现一个通用的 redo log(具体实现或接口定义) 会更好？这样以后还可以由开源社区提供其他更好的引擎，并且具有完整的 crash-free 能力","like_count":0},{"had_liked":false,"id":43331,"user_name":"Mr.Strive.Z.H.L","can_delete":false,"product_type":"c1","uid":1030198,"ip_address":"","ucode":"6D97E159E2EECD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b8/36/542c96bf.jpg","comment_is_top":false,"comment_ctime":1543215911,"is_pvip":false,"replies":[{"id":"15507","content":"在第一次课的置顶评论里面。<br><br>如果binlog没写完，这个事务在崩溃恢复过程中会回滚","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543228951,"ip_address":"","comment_id":43331,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543215911","product_id":100020801,"comment_content":"老师，第一次课的答案第二次课好像没提到答案呢？？还有就是二阶段提交：redo log一阶段perpare后，bin log记录时crash。这个时候没有commit，那redo log 如何处理？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430364,"discussion_content":"在第一次课的置顶评论里面。\n\n如果binlog没写完，这个事务在崩溃恢复过程中会回滚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543228951,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43325,"user_name":"亚伯拉罕·林","can_delete":false,"product_type":"c1","uid":1067272,"ip_address":"","ucode":"F164BF5BE9CF30","user_header":"https://static001.geekbang.org/account/avatar/00/10/49/08/9da90ad5.jpg","comment_is_top":false,"comment_ctime":1543214592,"is_pvip":false,"replies":[{"id":"15488","content":"看你的系统可靠性要求哈。两次增量备份之间如果机器挂了怎么解决的，要有个预案","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543216043,"ip_address":"","comment_id":43325,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543214592","product_id":100020801,"comment_content":"我采用mysqxtrabackup来全量和增量备份数据库,没有备份binlog，这样可以的吧","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430363,"discussion_content":"看你的系统可靠性要求哈。两次增量备份之间如果机器挂了怎么解决的，要有个预案","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543216043,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43304,"user_name":"特斯拉","can_delete":false,"product_type":"c1","uid":1230807,"ip_address":"","ucode":"C65901BD39AF0F","user_header":"https://static001.geekbang.org/account/avatar/00/12/c7/d7/b9f93eec.jpg","comment_is_top":false,"comment_ctime":1543209488,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543209488","product_id":100020801,"comment_content":"一天备份一次在经常需要扩容的的场景下可以提高系统的读能力。<br><br>有个小问题，为什么增加备份能提高读能力?","like_count":0},{"had_liked":false,"id":43228,"user_name":"加班工程师","can_delete":false,"product_type":"c1","uid":1312647,"ip_address":"","ucode":"F9038559292ECF","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/5c1gkU1VMGrmMCicz6IE2vYpGXMxv5eVf8EghxEQVrBJQ6mx8zUaqFrkUsiav6r1VUQ2qWqbmRNdYMJFCZUYib0MA/132","comment_is_top":false,"comment_ctime":1543197889,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543197889","product_id":100020801,"comment_content":"如果是在 新行更新到内存 到 写入redo-log 这两个阶段中间崩了(内存更新了但还没写入redo-log)会有什么措施吗","like_count":0},{"had_liked":false,"id":43033,"user_name":"Laputa","can_delete":false,"product_type":"c1","uid":1079345,"ip_address":"","ucode":"64C157042CF138","user_header":"https://static001.geekbang.org/account/avatar/00/10/78/31/c7f8d1db.jpg","comment_is_top":false,"comment_ctime":1543145361,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543145361","product_id":100020801,"comment_content":"文章和就留言中提到了数据页的概念，老师能否简单解释下什么是数据页","like_count":0},{"had_liked":false,"id":42965,"user_name":"大大大dvavid","can_delete":false,"product_type":"c1","uid":1323238,"ip_address":"","ucode":"1434DE4DB3DEF1","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJW3d3MZwQwaq0aKfQsL4TUaaVULibpNwA8e3OAoCCwGBco5mAbjybhhvv99UlNEkHJoPmFZN3z4kg/132","comment_is_top":false,"comment_ctime":1543120169,"is_pvip":false,"replies":[{"id":"15364","content":"这个叫延迟从库，你可以在这个库上备份。不过一般建议在一个普通从库上备份","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543148052,"ip_address":"","comment_id":42965,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543120169","product_id":100020801,"comment_content":"请问数据库备份是怎么做？可以通过主从数据库，将从库的复制时间设置为1天后复制的方法实现备份么？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430263,"discussion_content":"这个叫延迟从库，你可以在这个库上备份。不过一般建议在一个普通从库上备份","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543148052,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42954,"user_name":"大大大dvavid","can_delete":false,"product_type":"c1","uid":1323238,"ip_address":"","ucode":"1434DE4DB3DEF1","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJW3d3MZwQwaq0aKfQsL4TUaaVULibpNwA8e3OAoCCwGBco5mAbjybhhvv99UlNEkHJoPmFZN3z4kg/132","comment_is_top":false,"comment_ctime":1543118596,"is_pvip":false,"replies":[{"id":"15380","content":"《误删数据后除了跑路还能做啥》这篇会提到","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543152782,"ip_address":"","comment_id":42954,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543118596","product_id":100020801,"comment_content":"想问下老师，在没有数据库备份的情况下，仅仅通过binlog文件是否可以回复一次误删除的表数据？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430259,"discussion_content":"《误删数据后除了跑路还能做啥》这篇会提到","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543152782,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42925,"user_name":"Geek_9ca34e","can_delete":false,"product_type":"c1","uid":1222861,"ip_address":"","ucode":"9A9FDBBCCBE19B","user_header":"","comment_is_top":false,"comment_ctime":1543109934,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543109934","product_id":100020801,"comment_content":"老师你好，关于redo log和binlog大概思路我已明白，但是两阶段提交部分我还是有一点纠结，redo先写日志但是状态标记为prepare，再写binlog日志，整个事物提交时再把redo的状态改为commit，问题如下：1、redo 修改状态为commit的时候突然断电，服务器恢复后redo log和binlog是否就不一致了？2、redo 修改状态为commit的时候失败，整个事物回滚但是突然断电是否也会导致redo log和binlog不一致？3、如果通过binlog实现主从复制，那么是事物提交成功才复制到slave节点，还是只有写了binlog就复制到slave节点？4、不管是redo log还是binlog写了日志就理解刷到磁盘，还是写入磁盘缓冲器，实际的刷盘动作有磁盘来保证，不管是否断电重启都不影响实际耍盘和数据丢失？","like_count":0},{"had_liked":false,"id":42679,"user_name":"技术人生","can_delete":false,"product_type":"c1","uid":1033977,"ip_address":"","ucode":"6610644BC0A660","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJZBOcesNKYJRJKR6noK2VClOS8iaeEsibpXSLlFT87mARozsicHSAo8VibSEOZSRVw2XWK4UyqjQDYJQ/132","comment_is_top":false,"comment_ctime":1543019312,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1543019312","product_id":100020801,"comment_content":"哥，想了解下如果写binlog成功了，然后通知redolog commit失败了会怎么样？","like_count":0},{"had_liked":false,"id":42669,"user_name":"张永志","can_delete":false,"product_type":"c1","uid":1208727,"ip_address":"","ucode":"E54B75EF3F63B3","user_header":"https://static001.geekbang.org/account/avatar/00/12/71/97/f1a3d398.jpg","comment_is_top":false,"comment_ctime":1543012922,"is_pvip":false,"replies":[{"id":"15286","content":"正确😄","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1543029733,"ip_address":"","comment_id":42669,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543012922","product_id":100020801,"comment_content":"一天一备在恢复时应用binlog会更少，恢复起开更快，影响恢复所需时间。<br>如果只有最新一天的全备，恢复是快了，但是可恢复到的时间点就太有限了。<br>如果支持恢复到最近7天任意时点，在库不大且备份空间足够的情况下，可一个全备+隔天一个增量来做，但保留最近7天的binlog。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430153,"discussion_content":"正确😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543029733,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42652,"user_name":"","can_delete":false,"product_type":"c1","uid":1323424,"ip_address":"","ucode":"","user_header":"","comment_is_top":false,"comment_ctime":1542990301,"is_pvip":false,"replies":[{"id":"15274","content":"Myisam就是会丢…","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542994674,"ip_address":"","comment_id":42652,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542990301","product_id":100020801,"comment_content":"非常感谢老师，但是心中有个小疑问，望老师解答，innodb引入redo log是为了提高效率，并且有了它，InnoDB 就可以保证即使数据库发生异常重启，之前提交的记录都不会丢失，那没有redo log的myisam，数据库发生异常重启会丢失数据吗？如果不会丢失数据，那么myisam是否也算是crash-safe","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430149,"discussion_content":"Myisam就是会丢…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542994674,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42649,"user_name":"小笨蛋","can_delete":false,"product_type":"c1","uid":1118331,"ip_address":"","ucode":"7065FB157C4B70","user_header":"https://static001.geekbang.org/account/avatar/00/11/10/7b/eed9d6d6.jpg","comment_is_top":false,"comment_ctime":1542989085,"is_pvip":true,"replies":[{"id":"15275","content":"https:&#47;&#47;en.wikipedia.org&#47;wiki&#47;Write-ahead_logging WAL是数据库通用技术哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542994991,"ip_address":"","comment_id":42649,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542989085","product_id":100020801,"comment_content":"方便问一句吗？像你说的WAL这种关键技术等东西是在什么官方渠道看到的。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430147,"discussion_content":"https://en.wikipedia.org/wiki/Write-ahead_logging WAL是数据库通用技术哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542994991,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42611,"user_name":"小怪","can_delete":false,"product_type":"c1","uid":1108016,"ip_address":"","ucode":"E604BC8EF1B429","user_header":"https://static001.geekbang.org/account/avatar/00/10/e8/30/0a4eca46.jpg","comment_is_top":false,"comment_ctime":1542979009,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542979009","product_id":100020801,"comment_content":"厉害，需要看多遍","like_count":0},{"had_liked":false,"id":42527,"user_name":"zyy","can_delete":false,"product_type":"c1","uid":1048515,"ip_address":"","ucode":"1D0B2BD7E93C64","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ff/c3/b90b862c.jpg","comment_is_top":false,"comment_ctime":1542965507,"is_pvip":false,"replies":[{"id":"15186","content":"不是，存放数据的地方，你可以理解为按块儿存，一块儿16K","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542969047,"ip_address":"","comment_id":42527,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542965507","product_id":100020801,"comment_content":"反复看了几遍，根据正文和文末留言大致了解了这些概念。<br>有一个疑问 redo log记录 在某个数据页做了什么修改，这里数据页要怎么理解，数据查询的结果数据？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430116,"discussion_content":"不是，存放数据的地方，你可以理解为按块儿存，一块儿16K","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542969047,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42501,"user_name":"codewu","can_delete":false,"product_type":"c1","uid":1060861,"ip_address":"","ucode":"BAA2B1CB48FD00","user_header":"https://static001.geekbang.org/account/avatar/00/10/2f/fd/dead7549.jpg","comment_is_top":false,"comment_ctime":1542962613,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542962613","product_id":100020801,"comment_content":"老师，还是不太理解binlog为什么不具有crash safe的能力","like_count":0},{"had_liked":false,"id":42471,"user_name":"codewu","can_delete":false,"product_type":"c1","uid":1060861,"ip_address":"","ucode":"BAA2B1CB48FD00","user_header":"https://static001.geekbang.org/account/avatar/00/10/2f/fd/dead7549.jpg","comment_is_top":false,"comment_ctime":1542959204,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542959204","product_id":100020801,"comment_content":"既然恢复数据是基于binlog，那在恢复是基本上没redo log什么事，难道用来校验？","like_count":0},{"had_liked":false,"id":42456,"user_name":"alioo","can_delete":false,"product_type":"c1","uid":1022507,"ip_address":"","ucode":"F36A38C1F5FFAB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqOpANMwDibLmj5IGJh6dTw300sZ1BHM5sG3sZv1A1rvCHOiblPD3jgFOiaMVVujtctWnQbVFoNPpRgw/132","comment_is_top":false,"comment_ctime":1542956959,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542956959","product_id":100020801,"comment_content":"关于“一天一备会比一周一备更有优势”我谈谈的我观点：<br>binlog一般情况下是崩溃时用来恢复的，恢复时间越短，对业务的影响越小，一天一备的话只需要利用昨天的备份+今天截止到目前的增量binlog，增量数据相对小一些，恢复的时间自然要高效一些。<br>反过来说如果一周一备的话，首先binlog需要存储的至少是一周的数据（binlog如果小于一周的话否则故障发生时就无法恢复了）。所以我认为影响到的指标是expire_logs_days（可以通过 show variables like &#39;%expire_logs_days%&#39;来进行查看）","like_count":0},{"had_liked":false,"id":42452,"user_name":"zj-de","can_delete":false,"product_type":"c1","uid":1118020,"ip_address":"","ucode":"87DE1988754932","user_header":"https://static001.geekbang.org/account/avatar/00/11/0f/44/396d2d8e.jpg","comment_is_top":false,"comment_ctime":1542956710,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542956710","product_id":100020801,"comment_content":"先写redo log。再写bin log。如果在系统崩溃时。没有写redo log，那么这次修改就是真的丢了，找不回来，如果redo log写了。bin log 没写，那么需要依靠bin log + redo log来恢复。如果 bin log也写了，光靠bin log 就能恢复，是这样理解吗？","like_count":0},{"had_liked":false,"id":42438,"user_name":"Ivan","can_delete":false,"product_type":"c1","uid":1302381,"ip_address":"","ucode":"57090A053A247F","user_header":"https://static001.geekbang.org/account/avatar/00/13/df/6d/44cf0de4.jpg","comment_is_top":false,"comment_ctime":1542954549,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542954549","product_id":100020801,"comment_content":"老师，您好。mysql5.6以后的crash后的恢复，是不是只是用redo，而不会去查询binlog？","like_count":0},{"had_liked":false,"id":42335,"user_name":"hey","can_delete":false,"product_type":"c1","uid":1014997,"ip_address":"","ucode":"276BD331772A8A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7c/d5/5d6b3d34.jpg","comment_is_top":false,"comment_ctime":1542941073,"is_pvip":false,"replies":[{"id":"15152","content":"啥？","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542949495,"ip_address":"","comment_id":42335,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542941073","product_id":100020801,"comment_content":"能大概说下原理嘛 怎么个确认法","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430055,"discussion_content":"啥？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542949495,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42314,"user_name":"hey","can_delete":false,"product_type":"c1","uid":1014997,"ip_address":"","ucode":"276BD331772A8A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7c/d5/5d6b3d34.jpg","comment_is_top":false,"comment_ctime":1542939481,"is_pvip":false,"replies":[{"id":"15130","content":"代码里面要有确认的逻辑","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542940730,"ip_address":"","comment_id":42314,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542939481","product_id":100020801,"comment_content":"关于崩溃恢复 数据库目标既然是保持数据一致可能还原也可能执行 对于数据库的客户端这时候是什么状态呢 对于这些没有收到成功答复的更新操作 客户端需要一直重试吗","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430043,"discussion_content":"代码里面要有确认的逻辑","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542940730,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42266,"user_name":"Hesher","can_delete":false,"product_type":"c1","uid":1026832,"ip_address":"","ucode":"99AB8B1704CB7E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ab/10/b812ff3e.jpg","comment_is_top":false,"comment_ctime":1542936209,"is_pvip":false,"replies":[{"id":"15124","content":"1. 是的<br>2. Innodb没有binlog<br>3.这个问题问的同学有好几个，我加到答疑篇🤝","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542938531,"ip_address":"","comment_id":42266,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542936209","product_id":100020801,"comment_content":"看来恢复的过程是存储引擎来做的，server层肯定不会去动redo log。其他引擎，没有redo log，只靠bin log也能做备份恢复吧？跟InnoDB比优缺点在哪？看到其他同学的评论，恢复分为重启恢复和备份恢复，redo log的crash safe是为了做重启恢复吗？直接用binlog恢复不行吗，前提是bin log开启的情况下。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430030,"discussion_content":"1. 是的\n2. Innodb没有binlog\n3.这个问题问的同学有好几个，我加到答疑篇🤝","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542938531,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42087,"user_name":"justd","can_delete":false,"product_type":"c1","uid":1197260,"ip_address":"","ucode":"A8857900C9FA18","user_header":"https://static001.geekbang.org/account/avatar/00/12/44/cc/3e62d111.jpg","comment_is_top":false,"comment_ctime":1542907338,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542907338","product_id":100020801,"comment_content":"两种方式确定记录完整：    <br>1. redo log状态为 commit<br>2. redo log状态为prepare并且bin log记录完整 （提交commit之前）","like_count":0},{"had_liked":false,"id":42079,"user_name":"David.cui","can_delete":false,"product_type":"c1","uid":1302228,"ip_address":"","ucode":"AB46F310403612","user_header":"https://static001.geekbang.org/account/avatar/00/13/de/d4/b83c4185.jpg","comment_is_top":false,"comment_ctime":1542903885,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542903885","product_id":100020801,"comment_content":"我没有听明白孔乙己掌柜的粉板和账本怎么和redo log,binlog,磁盘数据对应起来。另外mysql的redolog和oracle 的redolg是名称一样但是用途不一样？","like_count":0},{"had_liked":false,"id":42053,"user_name":"TIMKeeper-sxs","can_delete":false,"product_type":"c1","uid":1321102,"ip_address":"","ucode":"A703D9EC1E1638","user_header":"https://static001.geekbang.org/account/avatar/00/14/28/8e/4c6c0ba2.jpg","comment_is_top":false,"comment_ctime":1542898322,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542898322","product_id":100020801,"comment_content":"老师，我受益非浅。","like_count":0},{"had_liked":false,"id":41941,"user_name":"grace_233","can_delete":false,"product_type":"c1","uid":1103572,"ip_address":"","ucode":"310FA881721E8F","user_header":"https://static001.geekbang.org/account/avatar/00/10/d6/d4/0fa9ca6a.jpg","comment_is_top":false,"comment_ctime":1542878487,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542878487","product_id":100020801,"comment_content":"老师，我有一个大大的问题想问。 上面的文章中有张 &quot;update 语句执行流程&quot; 的图我看懂了。但是我有一个疑惑。比如我在执行事务的时候，其实有两条sql语句：<br>1. update T set c=c+1 where ID=2;<br>2. commit;<br><br>我特别特别想知道，上面的 &quot;update 语句执行流程&quot; 图，哪些操作是在update T set c=c+1 where ID=2 语句发出后执行的，哪些操作是在commit语句发出之后执行的？<br><br>谢谢老师了~~~~~~~~~~","like_count":0},{"had_liked":false,"id":41923,"user_name":"Larwas","can_delete":false,"product_type":"c1","uid":1105436,"ip_address":"","ucode":"AF6BAA7769311A","user_header":"https://static001.geekbang.org/account/avatar/00/10/de/1c/60ff644d.jpg","comment_is_top":false,"comment_ctime":1542873953,"is_pvip":false,"replies":[{"id":"15040","content":"对，但是并不保证能够多出一个文件，也有可能write pos追上来就接近chenckpoint,这两位置在同一个文件","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542877673,"ip_address":"","comment_id":41923,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542873953","product_id":100020801,"comment_content":"write pos 是当前记录的位置<br>checkpoint 是当前要擦除的位置<br>请问老师，这个checkpoint 是不是就像图片一样，当写到3的时候，0已经被擦除了，并且checkpoint已经在1上面了。就是，checkpoint 是预先擦除一个文件的位置留给 write pos 写？<br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429948,"discussion_content":"对，但是并不保证能够多出一个文件，也有可能write pos追上来就接近chenckpoint,这两位置在同一个文件","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542877673,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":41907,"user_name":"湖","can_delete":false,"product_type":"c1","uid":1287906,"ip_address":"","ucode":"2C9BBFD8743D4B","user_header":"https://static001.geekbang.org/account/avatar/00/13/a6/e2/01dadfb4.jpg","comment_is_top":false,"comment_ctime":1542870847,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542870847","product_id":100020801,"comment_content":"若更新操作记录到redo log中，此时处于prepare状态， binlog也写入成功，但是在最后提交事务是失败会出现什么样的情况？事务会回滚？会做些什么事情呢？","like_count":0},{"had_liked":false,"id":41902,"user_name":"是我","can_delete":false,"product_type":"c1","uid":1297235,"ip_address":"","ucode":"0AC816A2FBD4F4","user_header":"https://static001.geekbang.org/account/avatar/00/13/cb/53/262a8ce2.jpg","comment_is_top":false,"comment_ctime":1542869867,"is_pvip":false,"replies":[{"id":"15015","content":"但是算先来后到的话，先有的binlog...","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542871461,"ip_address":"","comment_id":41902,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542869867","product_id":100020801,"comment_content":"因为redo log不是每个引擎都具备的，所以就需要binlog来进行辅助，不知道可以不可以这样理解？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429939,"discussion_content":"但是算先来后到的话，先有的binlog...","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542871461,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":41880,"user_name":"xiaoma2008","can_delete":false,"product_type":"c1","uid":1307110,"ip_address":"","ucode":"EA59E52B15F5C0","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKq0aBhhSXg7qiaWQH81zmjAYPXwoiaJEoMOxwXZF7d2iazMyQCeYpT7DJmxy2Iny7qq3RRr0UjOnO5A/132","comment_is_top":false,"comment_ctime":1542866141,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542866141","product_id":100020801,"comment_content":"请问一下，怎么根据id查询到page的？也就是说buffer pool中存的的page，怎么根据记录的id找到对应的page的呢？","like_count":0},{"had_liked":false,"id":41846,"user_name":"wjz1991","can_delete":false,"product_type":"c1","uid":1311687,"ip_address":"","ucode":"D82D744F5A4E6D","user_header":"https://static001.geekbang.org/account/avatar/00/14/03/c7/563345e1.jpg","comment_is_top":false,"comment_ctime":1542858670,"is_pvip":false,"replies":[{"id":"15024","content":"都要。而且不止写到log_buffer,还要写到redolog文件","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542872343,"ip_address":"","comment_id":41846,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542858670","product_id":100020801,"comment_content":"老师，问一个问题，客户端发起commit的时候，收到commit成功是在把事务写到innodb_log_buffer_size就返回成功，还是要刷到binlog后才返回成功啊","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429918,"discussion_content":"都要。而且不止写到log_buffer,还要写到redolog文件","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542872343,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":41829,"user_name":"Sea - fishing salt","can_delete":false,"product_type":"c1","uid":1316499,"ip_address":"","ucode":"AF57C086D504DD","user_header":"https://static001.geekbang.org/account/avatar/00/14/16/93/c5be3aee.jpg","comment_is_top":false,"comment_ctime":1542856098,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542856098","product_id":100020801,"comment_content":"我的理解：<br>redoLog就是记录将要做什么，相当于缓存的作用，实在暂时保留未来要写盘的意图，等到空闲时写盘。redolog记录了当前阶段（可以理解为只要没有成功commit，redoLog都有记录。在回滚或提交后再清除这条记录）<br>binLog归档主要用来恢复数据，第一保证事务正常，RedoLog有记录binLog没有日志，事务回滚；当redoLog有binLog也有时就继续提交。第二 数据恢复的时候使用binLog<br>大神，指教一下理解的对不对<br>还有个问题，更新没有及时写盘，还处在与prepare阶段时。查询数据select * from xx limit 10时执行器检索磁盘查的的不包含刚刚更新的那条？会发生数据不同步？","like_count":0},{"had_liked":false,"id":41773,"user_name":"七七","can_delete":false,"product_type":"c1","uid":1301937,"ip_address":"","ucode":"277BACE2330C54","user_header":"https://static001.geekbang.org/account/avatar/00/13/dd/b1/7323beb9.jpg","comment_is_top":false,"comment_ctime":1542850360,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1542850360","product_id":100020801,"comment_content":"老师，有没有什么直观的方法监控当前buffer pool淘汰了多少页、从磁盘读了多少页呢？谢谢","like_count":0},{"had_liked":false,"id":41744,"user_name":"sky","can_delete":false,"product_type":"c1","uid":1082187,"ip_address":"","ucode":"FC323371453C97","user_header":"https://static001.geekbang.org/account/avatar/00/10/83/4b/0e96fcae.jpg","comment_is_top":false,"comment_ctime":1542848399,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542848399","product_id":100020801,"comment_content":"老师好！<br>“与此类似，InnoDB 的 redo log 是固定大小的，比如可以配置为一组 4 个文件，每个文件的大小是 1GB，那么这块“粉板”总共就可以记录 4GB 的操作。”<br><br>这里无论配置多少组多少文件，它的总大小都不能超过4G吗 还是这个4G是可以配置的  还有关于这块的配置变量都有哪些呀 谢谢","like_count":0},{"had_liked":false,"id":41659,"user_name":"佳","can_delete":false,"product_type":"c1","uid":1263049,"ip_address":"","ucode":"F25D82CC74A76D","user_header":"https://static001.geekbang.org/account/avatar/00/13/45/c9/a4f7054f.jpg","comment_is_top":false,"comment_ctime":1542815327,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542815327","product_id":100020801,"comment_content":"那个redo log的日志说是物理的，并且是循环写，那一写满以后，原来的就要被擦除掉了，那万一日志发生崩溃，想要恢复到原来被擦除的日志信息的那部分还能恢复吗？那个时候的恢复是只能依靠binlog日志恢复吗？redo log日志在写满后擦除前会持久化原来的信息吗？redo log是怎么实现崩溃恢复的？是边写边做了持久化吗？然后一启动，自动加载崩溃前的保存到磁盘的状态来进行恢复的吗？","like_count":0},{"had_liked":false,"id":41653,"user_name":"蒋日健","can_delete":false,"product_type":"c1","uid":1318609,"ip_address":"","ucode":"0B3AB559DE635A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/j0n4JAfhd9wUicVeibMYcWQ3O4Y4dakC161f9rWM7cSicC7UMSSUsJ5hqibFjGmSB0dQDjfkjiavbBmUFroqHYquJRA/132","comment_is_top":false,"comment_ctime":1542814171,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542814171","product_id":100020801,"comment_content":"反反复复看了好多遍，最后的疑问是，redo log可以不要，因为别的引擎也没有这个日志，这时候，先写bin log，然后提交，之后返回，但是假如提交之前就异常退出了怎么办？有什么用来记录写入的bin log没生效么？这样重启后才知道应该删除这条bin log或者再执行一次提交。求老师解惑","like_count":0},{"had_liked":false,"id":41634,"user_name":"hellobfy","can_delete":false,"product_type":"c1","uid":1259019,"ip_address":"","ucode":"CDE51E2FFDA4F4","user_header":"","comment_is_top":false,"comment_ctime":1542812619,"is_pvip":false,"replies":[{"id":"15038","content":"一、其实真正做数据更新和事务维护的都是引擎。但是引擎接口是执行器来调用的，调用关系。<br><br>这里只需要明确，“加1” 这个操作是在server层的执行器做的就行啦<br><br>在这个流程里，逻辑计算在server, 引擎层做读写<br><br>二、理解正确<br><br>三、不是固定为4G哦，可以配置的，只是在现在普遍的大内存场景下，要支持稳定的写入性能，可以设置4G","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542877424,"ip_address":"","comment_id":41634,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542812619","product_id":100020801,"comment_content":"一。 同样都是调用引擎接口，  为什么写入新行操作算执行器的， 提交事务操作就算引擎的了？<br>具体描述如下：<br><br>update 语句时的内部流程时<br>2.执行器拿到引擎给的行数据，把这个值加上 1，比如原来是 <br>是 N，现在就是 N+1，得到新的一行数据，再调用引擎接口写入这行新数据。 <br><br>这里调用引擎接口时， 算执行器的操作<br><br>5.执行器调用引擎的提交事务接口，引擎把刚刚写入的 redo log 改成提交（commit）状态，更新完成。<br><br>这里调用引擎接口， 提交事务为什么就算引擎的操作了？ 跟上面是不是有冲突，还是因为什么原因呢？<br><br>二。 我对redolog的存在原因的理解： <br>redlog存在时为了数据库的内存操作的数据安全。 <br>虽然写日志有io成本， 但是比每条sql都直接操作硬盘的成本依然还是低， 。<br>所以综合来说，保证内存操作，然后日志硬盘io，最划算。<br><br>三。比较好奇redolog设计固定大小4g的历史原因。。<br><br><br> ps： 每次想您刚发出来时就好好读，有时候加班真的是不允许= =<br> 第一时间读了提出疑惑， 应该是回复最积极的时候啦 哈哈哈。。 <br><br>文中 checkpoint和write 中间部分 描述确实有歧义，需要多想一下。<br><br>另外希望大家写评论时候都注意格式，评论是对文章的补充，格式更好，大家读起来也更轻松和更快<br><br><br><br><br><br><br><br><br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429865,"discussion_content":"一、其实真正做数据更新和事务维护的都是引擎。但是引擎接口是执行器来调用的，调用关系。\n\n这里只需要明确，“加1” 这个操作是在server层的执行器做的就行啦\n\n在这个流程里，逻辑计算在server, 引擎层做读写\n\n二、理解正确\n\n三、不是固定为4G哦，可以配置的，只是在现在普遍的大内存场景下，要支持稳定的写入性能，可以设置4G","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542877424,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":41565,"user_name":"MrGuo","can_delete":false,"product_type":"c1","uid":1285455,"ip_address":"","ucode":"85F45502C42DD1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epyb06M55D5wXsDrsObicnNJtph90rsuKug7KYOJWleyGJrltDA2PAkp3jRAzIxFfUbnA96ic5TibLTQ/132","comment_is_top":false,"comment_ctime":1542806977,"is_pvip":false,"replies":[{"id":"14941","content":"Innodb 内存","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542813711,"ip_address":"","comment_id":41565,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542806977","product_id":100020801,"comment_content":"“1. 执行器先找引擎取 ID=2 这一行。ID 是主键，引擎直接用树搜索找到这一行。如果 ID=2 这一行所在的数据页本来就在内存中，就直接返回给执行器”  大神，请问这个数据页本来就在内存中 是 server端的缓存 吗？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429844,"discussion_content":"Innodb 内存","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542813711,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":41544,"user_name":"尼尼虾条","can_delete":false,"product_type":"c1","uid":1316817,"ip_address":"","ucode":"097C17231151B5","user_header":"","comment_is_top":false,"comment_ctime":1542803394,"is_pvip":false,"replies":[{"id":"14944","content":"我在答疑文章中说吧","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542814083,"ip_address":"","comment_id":41544,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542803394","product_id":100020801,"comment_content":"redo log记录的是数据页 做了什么改动，而binlog在statement模式下记录的是sql语句<br>这两者有什么不同呢？个人的理解是 改动不就是sql的语句的实现吗？？请老师答疑，谢谢","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429834,"discussion_content":"我在答疑文章中说吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542814083,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":41493,"user_name":"风雪","can_delete":false,"product_type":"c1","uid":1316279,"ip_address":"","ucode":"ADCA51048AF096","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ1bf1wUGI2KnSBpUs4EyyxoRvfHY9J3T8R7g32cfnosl3M4UIYagYvANpSpGRNT6YCNWK2buh2Tg/132","comment_is_top":false,"comment_ctime":1542793986,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542793986","product_id":100020801,"comment_content":"老师，是不是可以了理解redolog是为了保证binlog的日志记录有效，那redelog的prepare有什么用当没有写入binlog的时候，可以恢复数据吗，还是说当MySQL中断会清空redolog，那这样的话如果热的redolog做持久化了那是不是跟binlog一样可以恢复数据了","like_count":0},{"had_liked":false,"id":41444,"user_name":"你有资格吗？","can_delete":false,"product_type":"c1","uid":1233534,"ip_address":"","ucode":"4758C5A190BABB","user_header":"https://static001.geekbang.org/account/avatar/00/12/d2/7e/bd8c372a.jpg","comment_is_top":false,"comment_ctime":1542781970,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542781970","product_id":100020801,"comment_content":"老师我在这块有疑问：1.在redo log的时候您说的是写磁盘会比较耗费时间，先写redo log然后innodb会在合适的时候写入磁盘，那么这innodb写入之前这时候有线程来读这别数据，是不是不会读到新数据？<br>2.为什么bln log无法crash-safe,讲道理也可以读日志文件来看啊？<br>求大佬解惑！！！","like_count":0},{"had_liked":false,"id":41355,"user_name":"alvin li","can_delete":false,"product_type":"c1","uid":1276344,"ip_address":"","ucode":"33DA2C48CE9F97","user_header":"https://static001.geekbang.org/account/avatar/00/13/79/b8/eeb50705.jpg","comment_is_top":false,"comment_ctime":1542768427,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542768427","product_id":100020801,"comment_content":"对于写多的场景，或者业务本身对数据准确性比较敏感的场景，比如支付，应该备份频繁点比较好吧","like_count":0},{"had_liked":false,"id":41343,"user_name":"yushing","can_delete":false,"product_type":"c1","uid":1108112,"ip_address":"","ucode":"244C58F218D586","user_header":"https://static001.geekbang.org/account/avatar/00/10/e8/90/d63f8347.jpg","comment_is_top":false,"comment_ctime":1542766945,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542766945","product_id":100020801,"comment_content":"binlog写入成功，但在事务提交时crash时，导致redo log和binlog不一致了，老师在问答区提到这种情况下“崩溃恢复时，事务会自动提交”，那么崩溃恢复时redo log是怎么判断事务是需要提交还是回滚的呢？(因为还存在另一种情况是redo log prepare了，但binlog还未写入时crash了，这时崩溃恢复时，事务是应该回滚吧)","like_count":0},{"had_liked":false,"id":41220,"user_name":"有趣的灵魂","can_delete":false,"product_type":"c1","uid":1316167,"ip_address":"","ucode":"AC2A9519500267","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIFMkbt10jJJvu7OoudbmJRTJ7D8SKibYoSKD2iculwsq1QDsCtJ3QEeGUQZVR78GlX4uY3ia2znkRbQ/132","comment_is_top":false,"comment_ctime":1542760658,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542760658","product_id":100020801,"comment_content":"有一点没明白，redolog如果用完了，擦出的那一部分会保存到磁盘吗？如果redolog中的内容还没放到磁盘就被异常重启了，会不会丢失？","like_count":0},{"had_liked":false,"id":41186,"user_name":"kitty猫","can_delete":false,"product_type":"c1","uid":1303091,"ip_address":"","ucode":"62387ED4A29425","user_header":"https://static001.geekbang.org/account/avatar/00/13/e2/33/688f6c9c.jpg","comment_is_top":false,"comment_ctime":1542758197,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542758197","product_id":100020801,"comment_content":"老师，我是数据库新手，有个问题请问怎么解决，如果一个系统比较重要，对恢复库的时间比较敏感，当然是一天一全备最好，可是现在这个库每天备份已经要20小时，而且此系统使用率很高，备份的时候又会加大影响库的性能，该如何是好？","like_count":0},{"had_liked":false,"id":41122,"user_name":"张圆要坚强啊","can_delete":false,"product_type":"c1","uid":1273670,"ip_address":"","ucode":"D55ABB0A074FE3","user_header":"https://static001.geekbang.org/account/avatar/00/13/6f/46/b28d4c45.jpg","comment_is_top":false,"comment_ctime":1542728374,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542728374","product_id":100020801,"comment_content":"老师，有个问题不太理解，redo  log是存在磁盘中的吗？还是存在内存中？如果是存在于磁盘中，日志满了会再写一次磁盘，会不会影响性能？如果是在内存中，像突然断电这种情况会不会丢失更新？","like_count":0},{"had_liked":false,"id":41094,"user_name":"魔都浪子","can_delete":false,"product_type":"c1","uid":1177859,"ip_address":"","ucode":"8301440705105A","user_header":"https://static001.geekbang.org/account/avatar/00/11/f9/03/439bdb70.jpg","comment_is_top":false,"comment_ctime":1542724829,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542724829","product_id":100020801,"comment_content":"innodb_flush_log_at_trx_commit为0，sync-binlog为1，刷盘后binlog已经传到了slave，commit后系统crashed，redo日志还没有来得及刷盘，这样会造成主从数据不一致吗？","like_count":0},{"had_liked":false,"id":41005,"user_name":"唐名之","can_delete":false,"product_type":"c1","uid":1004394,"ip_address":"","ucode":"F472C71E043E03","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/JKKWS6TzhncvAA0p0NDiaATPIvMicSM76vNAg9IG1ibibcJYPAiaicYjZfq4gAV8GRtcTpOibfRD8vzqHBtL0ibmhwQsbg/132","comment_is_top":false,"comment_ctime":1542712046,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542712046","product_id":100020801,"comment_content":"老师我有疑问<br>1：当binlog写入成功后，系统发生carsh，undo 日志为prepare状态，那么binlog日志和undo日志逻辑不一致？系统重启该如何处理undo日志？","like_count":0},{"had_liked":false,"id":41004,"user_name":"柠檬","can_delete":false,"product_type":"c1","uid":1311006,"ip_address":"","ucode":"E7A7293E438FFF","user_header":"https://static001.geekbang.org/account/avatar/00/14/01/1e/3aa8d7ec.jpg","comment_is_top":false,"comment_ctime":1542711899,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542711899","product_id":100020801,"comment_content":"redo个人理解为直接写操作记录 <br>binlog 理解为更详细的操作记录，包括更新详细的操作过程。<br>o通过archive log进行恢复<br>mySQL通过binlog进行恢复。<br>不理解的是大的更新语句，如果中断，如何进行回滚","like_count":0},{"had_liked":false,"id":40943,"user_name":"文敦复","can_delete":false,"product_type":"c1","uid":1195258,"ip_address":"","ucode":"B8F4A6BD5D7805","user_header":"https://static001.geekbang.org/account/avatar/00/12/3c/fa/e2990931.jpg","comment_is_top":false,"comment_ctime":1542699934,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542699934","product_id":100020801,"comment_content":"看到老师评论中有：&quot;redolog是循环写的，不持久保存&quot;,redolog是在内存中的嘛，一直不持久化？","like_count":0},{"had_liked":false,"id":40942,"user_name":"南辕北辙","can_delete":false,"product_type":"c1","uid":1214502,"ip_address":"","ucode":"03EC406AE0D591","user_header":"https://static001.geekbang.org/account/avatar/00/12/88/26/b8c53cee.jpg","comment_is_top":false,"comment_ctime":1542699732,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542699732","product_id":100020801,"comment_content":"老师您好，根据我的理解对于一个update 第一个阶段执行器调用引擎还是要去磁盘上找到ID=2这行数据（如果该数据页没有在内存中）。然后执行器进行N+1操作，引擎将这个新数据更新到内存中，并且将数据的更新操作到redo log。我的疑问就是为什么最开始还要去硬盘上去找呢，为什么不在粉板上直接写上ID=2的记录执行N+1,这样连账本都不用去翻了。现在的流程是不是 先是去磁盘上找到ID=2，但是更新完成以后在内存中以及redo log和binlog上，并没有实时的去更新到磁盘上。不知道有没有理解出错，望老师指点。。","like_count":0},{"had_liked":false,"id":40939,"user_name":"M哥","can_delete":false,"product_type":"c1","uid":1247251,"ip_address":"","ucode":"1E3CD88B1EA6D5","user_header":"https://static001.geekbang.org/account/avatar/00/13/08/13/68579217.jpg","comment_is_top":false,"comment_ctime":1542698933,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542698933","product_id":100020801,"comment_content":"为什么满足prepare和binlog完整就是可以恢复的，我理解的是，在redo阶段是找到CK 的LSN开始通过redo日志重做，这个阶段是不管有没有commit都是会重做一遍的，这个时候是包含一部分脏数据的，在crash recovery的undo阶段会通过binlog进行判断是否需要回滚，因为binlog是完整的，所以prepare的uredo日志记录是不会会滚的，也就是说事物已经完成了。这么理解不知道对不对","like_count":0},{"had_liked":false,"id":40919,"user_name":"go","can_delete":false,"product_type":"c1","uid":1315072,"ip_address":"","ucode":"270138E0254D74","user_header":"https://static001.geekbang.org/account/avatar/00/14/11/00/97770728.jpg","comment_is_top":false,"comment_ctime":1542695043,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542695043","product_id":100020801,"comment_content":"写入新行的意思是在磁盘上更新数据吗","like_count":0},{"had_liked":false,"id":40911,"user_name":"饭粒","can_delete":false,"product_type":"c1","uid":1153455,"ip_address":"","ucode":"4C3220B0D43997","user_header":"https://static001.geekbang.org/account/avatar/00/11/99/af/d29273e2.jpg","comment_is_top":false,"comment_ctime":1542693966,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542693966","product_id":100020801,"comment_content":"两种备份的影响的数据库恢复的时间，一天一备最坏的情况下只要重放一天的日志量，而且在查找开始重放的pos点也更容易，可能只需要找一个binlog文件，一周一备可能已经产生多隔binlog文件。<br>另有个疑问是，把innodb_flush_log_at_trx_commit 和 sync_binlog 都设置为1，这样可以保证最好的一致性，但这样一来不是有两次同步磁盘io吗，就相当于翻了两次账本，这好像比翻一次更影响性能？","like_count":0},{"had_liked":false,"id":40839,"user_name":"菠菜","can_delete":false,"product_type":"c1","uid":1100102,"ip_address":"","ucode":"1D3F2DC57A579D","user_header":"https://static001.geekbang.org/account/avatar/00/10/c9/46/094b06bf.jpg","comment_is_top":false,"comment_ctime":1542681039,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542681039","product_id":100020801,"comment_content":"在crash的时候，如果可以对比repo bin 是否同时写入了，算作该条数据是否丢弃的条件，那为何还需要commit呢？是有其他考虑吗","like_count":0},{"had_liked":false,"id":40795,"user_name":"lzjun","can_delete":false,"product_type":"c1","uid":1006975,"ip_address":"","ucode":"E8463C74EB3740","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5d/7f/f22f9224.jpg","comment_is_top":false,"comment_ctime":1542677805,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542677805","product_id":100020801,"comment_content":"按我的理解，redo存储的是这样的信息，“列c原来是1，现在是2”。至于是怎么来的，redolog不知道。而binlog存储的是信息是这条语句的原始逻辑，存储的是“我把表的c列执行了加1操作”这个逻辑，至于最终的值变成了什么，binlog是不知道的，而只有redolog知道","like_count":0},{"had_liked":false,"id":40783,"user_name":"LAMBO","can_delete":false,"product_type":"c1","uid":1214041,"ip_address":"","ucode":"10EDE0FC134FA8","user_header":"https://static001.geekbang.org/account/avatar/00/12/86/59/e8f58a2a.jpg","comment_is_top":false,"comment_ctime":1542677059,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542677059","product_id":100020801,"comment_content":"两阶段提交听起来有点抽象，是否可以说得更通俗易懂点？","like_count":0},{"had_liked":false,"id":40759,"user_name":"Terry","can_delete":false,"product_type":"c1","uid":1079635,"ip_address":"","ucode":"92BDC3AF7855B4","user_header":"https://static001.geekbang.org/account/avatar/00/10/79/53/3a824aed.jpg","comment_is_top":false,"comment_ctime":1542674553,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542674553","product_id":100020801,"comment_content":"repo log的实现机制听起来像是循环队列。这样就限制了他的使用场景，不能够最为恢复数据的源，因为长度有限。所以恢复数据还的依靠binlog","like_count":0},{"had_liked":false,"id":40749,"user_name":"Together","can_delete":false,"product_type":"c1","uid":1306017,"ip_address":"","ucode":"DEBB25700CC7EA","user_header":"https://static001.geekbang.org/account/avatar/00/13/ed/a1/d2953af8.jpg","comment_is_top":false,"comment_ctime":1542673872,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542673872","product_id":100020801,"comment_content":"组复制模式下，如果主库有大事务产生，主库在等待从库接收的过程中，不断有新的交易进来，因为主库还没有收到从库的ACK，所以主库无法commit，数据也无法写入数据文件，有可能导致write pos追上checkpoint吗？","like_count":0},{"had_liked":false,"id":40719,"user_name":"刘大帅","can_delete":false,"product_type":"c1","uid":1001635,"ip_address":"","ucode":"9D37ADFDE117BD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/48/a3/a66e61b8.jpg","comment_is_top":false,"comment_ctime":1542668204,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542668204","product_id":100020801,"comment_content":"请问老师，崩溃恢复时，binlog完整是存储引擎判断的还是Server层判断的？个人感觉Server层应该是个无状态的，但是binlog又不是由存储引擎写入磁盘的，那么崩溃恢复时，是谁验证这个prepare状态的写入操作的binlog完整性呢？","like_count":0},{"had_liked":false,"id":40693,"user_name":"余向华","can_delete":false,"product_type":"c1","uid":1119778,"ip_address":"","ucode":"263773616D2C83","user_header":"https://static001.geekbang.org/account/avatar/00/11/16/22/2205cf0a.jpg","comment_is_top":false,"comment_ctime":1542643373,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542643373","product_id":100020801,"comment_content":"Binlog有两种模式，statement 格式的话是记sql语句， row格式会记录行的内容，记两条，更新前和更新后都有。<br>老师，我这里的疑问是如果是在开启了 statement 模式，也就说，在 server 层就已经完成了日志的备份了，数据库的存储引擎即使不是 InnoDB 引擎，也是拥有着 crash-fresh 能力，即使数据库异常重启了，把 binlog 给恢复，也不会丢数据，这样的理解对吗？","like_count":0},{"had_liked":false,"id":40663,"user_name":"广安门下","can_delete":false,"product_type":"c1","uid":1252034,"ip_address":"","ucode":"553A6B40FB3C9F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI0qUU5bc3kVeO0ZTJliau1dHMZglMib72gelIgKXew4RFDdAHsicodWgdaCwSAWetIuVaFwIzb2fFHw/132","comment_is_top":false,"comment_ctime":1542639750,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542639750","product_id":100020801,"comment_content":"问一下老师，既然redolog和binlog都是为了保持一次事物的一致性，那么这两个文件写的顺序可以换吗？","like_count":0},{"had_liked":false,"id":40655,"user_name":"liu","can_delete":false,"product_type":"c1","uid":1158856,"ip_address":"","ucode":"E83041FA8056D0","user_header":"https://static001.geekbang.org/account/avatar/00/11/ae/c8/0ca41f70.jpg","comment_is_top":false,"comment_ctime":1542639095,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542639095","product_id":100020801,"comment_content":"话说aurora是不是就只有redolog batch落盘，拿掉binlog","like_count":0},{"had_liked":false,"id":40596,"user_name":"易水寒","can_delete":false,"product_type":"c1","uid":1238961,"ip_address":"","ucode":"F5D8127ED4754E","user_header":"https://static001.geekbang.org/account/avatar/00/12/e7/b1/5c63be67.jpg","comment_is_top":false,"comment_ctime":1542635058,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542635058","product_id":100020801,"comment_content":"如果binlog写入成功了，提交事务操作将redolog状态更新为commit时失败了或宕机了，这不就成了binlog写入成功，redolog失败吗","like_count":0},{"had_liked":false,"id":40595,"user_name":"晓雯","can_delete":false,"product_type":"c1","uid":1303677,"ip_address":"","ucode":"1A5653500BFD85","user_header":"https://static001.geekbang.org/account/avatar/00/13/e4/7d/7021c203.jpg","comment_is_top":false,"comment_ctime":1542634928,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542634928","product_id":100020801,"comment_content":"既然redo log也可以恢复数据，那为什么都采用全备加binlog的方式？redo log是怎么恢复数据的，有什么限制条件吗？物理方式跟逻辑方式能讲一下吗 老师。","like_count":0},{"had_liked":false,"id":40589,"user_name":"肉包肉包.zss","can_delete":false,"product_type":"c1","uid":1017749,"ip_address":"","ucode":"352923E2208D59","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/95/9d7f390f.jpg","comment_is_top":false,"comment_ctime":1542634571,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542634571","product_id":100020801,"comment_content":"老师您好，请问下，真正刷数据空间这个动作，是innodb引擎的行为还是mysql server的行为呢？是以redo-log为依据还是以binlog为依据呢？<br>特指正常的流程，并不是指从节点拉取binlog同步数据的流程。","like_count":0},{"had_liked":false,"id":40559,"user_name":"书策稠浊","can_delete":false,"product_type":"c1","uid":1307497,"ip_address":"","ucode":"A29875CE15FDA3","user_header":"https://static001.geekbang.org/account/avatar/00/13/f3/69/7039d03f.jpg","comment_is_top":false,"comment_ctime":1542632356,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542632356","product_id":100020801,"comment_content":"感觉有bin就不需要redo了，请老师指点一下。","like_count":0},{"had_liked":false,"id":40465,"user_name":"风中追风","can_delete":false,"product_type":"c1","uid":1184441,"ip_address":"","ucode":"420AE0097EA32D","user_header":"https://static001.geekbang.org/account/avatar/00/12/12/b9/aab42878.jpg","comment_is_top":false,"comment_ctime":1542622760,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542622760","product_id":100020801,"comment_content":"老师，我有个地方不是很明白，innodb_flush_log_trx_commit跟sync_binlog的作用分别是将redolog跟binlog写到磁盘，难道默认情况下不是直接将这两个写到磁盘吗？还是这两个日志的内容是在内存里，只有配置了这两个参数才会写到磁盘","like_count":0},{"had_liked":false,"id":40401,"user_name":"梁中华","can_delete":false,"product_type":"c1","uid":1006789,"ip_address":"","ucode":"52FE40242CBAD0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5c/c5/1231d633.jpg","comment_is_top":false,"comment_ctime":1542615319,"is_pvip":true,"replies":[{"id":"14616","content":"如果用户执行rollback语句，整个事务就放弃了，不会进入“prepare”状态","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542635095,"ip_address":"","comment_id":40401,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1542615319","product_id":100020801,"comment_content":"接着高枕的话题继续讨论一下，如果第三步用户不是想commit而是想rollback,但不巧在第三步的时候崩溃了，回复后根据redo log和binlog一致来自动commit?","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429511,"discussion_content":"如果用户执行rollback语句，整个事务就放弃了，不会进入“prepare”状态","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542635095,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40353,"user_name":"everyok22","can_delete":false,"product_type":"c1","uid":1213878,"ip_address":"","ucode":"3A3304CCDC5C5C","user_header":"","comment_is_top":false,"comment_ctime":1542598974,"is_pvip":false,"replies":[{"id":"14533","content":"不用，读内存就行了","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542600652,"ip_address":"","comment_id":40353,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542598974","product_id":100020801,"comment_content":"有redo log , 那在查询的时候是不是就得读所有的redo log里的数据呢， 数据库是如何保证查询的效率的。索引是在什么时候写入的呢，跟redo log 一起写入的么。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429490,"discussion_content":"不用，读内存就行了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542600652,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40218,"user_name":"董航","can_delete":false,"product_type":"c1","uid":1231787,"ip_address":"","ucode":"9CA208FD26F849","user_header":"https://static001.geekbang.org/account/avatar/00/12/cb/ab/1aac53bf.jpg","comment_is_top":false,"comment_ctime":1542556408,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542556408","product_id":100020801,"comment_content":"老师，如果更新了一条数据，数据还在redolog里面，后续根据这个更新数据查询的sql不就获取不到数据了吗","like_count":0},{"had_liked":false,"id":40214,"user_name":"董航","can_delete":false,"product_type":"c1","uid":1231787,"ip_address":"","ucode":"9CA208FD26F849","user_header":"https://static001.geekbang.org/account/avatar/00/12/cb/ab/1aac53bf.jpg","comment_is_top":false,"comment_ctime":1542555518,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542555518","product_id":100020801,"comment_content":"如果数据一直在redo log里面，那么如何查询最新的数据","like_count":0},{"had_liked":false,"id":40185,"user_name":"phantom","can_delete":false,"product_type":"c1","uid":1302631,"ip_address":"","ucode":"C4FCE4A04D32CA","user_header":"https://static001.geekbang.org/account/avatar/00/13/e0/67/6db879e4.jpg","comment_is_top":false,"comment_ctime":1542543263,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542543263","product_id":100020801,"comment_content":"老师，那如果binlog已经记录，但redo进行commit失败，是否就是“前滚”？通过crash safe能够保证前滚到binlog记录的，redo prepare的状态？<br>另外，对于备份，在存储成本无需担心的情况下dba应该都会选择吧。毕竟追库时间一天以内啦。","like_count":0},{"had_liked":false,"id":40173,"user_name":"eric254","can_delete":false,"product_type":"c1","uid":1309096,"ip_address":"","ucode":"42E76806386754","user_header":"","comment_is_top":false,"comment_ctime":1542536241,"is_pvip":false,"replies":[{"id":"14471","content":"有buffer的，事务整个完成才学到redolog文件。redolog是顺序写","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542543375,"ip_address":"","comment_id":40173,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542536241","product_id":100020801,"comment_content":"mysql的redo log有没有log buffer？对于高并发事务或者批量事务 如何优化redo文件的写入瓶颈？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429408,"discussion_content":"有buffer的，事务整个完成才学到redolog文件。redolog是顺序写","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542543375,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40165,"user_name":"dream","can_delete":false,"product_type":"c1","uid":1117793,"ip_address":"","ucode":"65B33D32FA8BE9","user_header":"https://static001.geekbang.org/account/avatar/00/11/0e/61/ae68f8eb.jpg","comment_is_top":false,"comment_ctime":1542533096,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542533096","product_id":100020801,"comment_content":"redo log  和  binlog  分别在什么位置呢？","like_count":0},{"had_liked":false,"id":40147,"user_name":"风二中","can_delete":false,"product_type":"c1","uid":1131876,"ip_address":"","ucode":"73AC0AFB04931D","user_header":"https://static001.geekbang.org/account/avatar/00/11/45/64/2b09a36b.jpg","comment_is_top":false,"comment_ctime":1542526609,"is_pvip":true,"replies":[{"id":"14469","content":"1. 这两个其实是交叉发生的（对于一个有多次更新日志的事务来说），所以可以忽略先后。关键是他们都在“把日志写入redolog物理文件之前<br>2. 有了binlog, 需要两阶段","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542542766,"ip_address":"","comment_id":40147,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542526609","product_id":100020801,"comment_content":"林老师，好，有几个疑问：<br>1）文中‘’update 语句执行流程‘’示意图，是先修改数据，在记日志。不应该是先写日志（生成重做日志），在修改数据（缓存里）吗？<br>2）redo log两阶段提交具体是怎么实现呢？我理解就是直接记录哪个页面做了什么修改到redolog（硬盘日志文件）就结束了，已经落盘了，prepare，和commit怎么理解呢<br>谢谢了","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429395,"discussion_content":"1. 这两个其实是交叉发生的（对于一个有多次更新日志的事务来说），所以可以忽略先后。关键是他们都在“把日志写入redolog物理文件之前\n2. 有了binlog, 需要两阶段","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542542766,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40130,"user_name":"刘赛","can_delete":false,"product_type":"c1","uid":1100949,"ip_address":"","ucode":"EC3910CD2A291E","user_header":"","comment_is_top":false,"comment_ctime":1542512841,"is_pvip":false,"replies":[{"id":"14422","content":"崩溃恢复后事务提交。如果你是指这个瞬间，那就是“事务未完成”状态","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542521249,"ip_address":"","comment_id":40130,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542512841","product_id":100020801,"comment_content":"请教下，如果在binlog写入成功后出问题了，redo log 就没有进行commit了，此时系统是什么状态呢","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429388,"discussion_content":"崩溃恢复后事务提交。如果你是指这个瞬间，那就是“事务未完成”状态","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542521249,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40124,"user_name":"Sinyo","can_delete":false,"product_type":"c1","uid":1307297,"ip_address":"","ucode":"57B243E7AB86A5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJAibnPX9jW8kqLcIfibjic8GbkQkEUYyFKJkc39hZhibVlNrqwTjdLozkqibI2IwACd5YzofYickNxFnZg/132","comment_is_top":false,"comment_ctime":1542510673,"is_pvip":false,"replies":[{"id":"14416","content":"不是，这个但是是控制redolog的。 binlog存起来就有“归档”的功能","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542520997,"ip_address":"","comment_id":40124,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542510673","product_id":100020801,"comment_content":"老师，innodb_flush_log_at_trx_commit这个参数设置成 1，是不是等于binlog的归档了呢？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429383,"discussion_content":"不是，这个但是是控制redolog的。 binlog存起来就有“归档”的功能","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542520997,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40113,"user_name":"魔都浪子","can_delete":false,"product_type":"c1","uid":1177859,"ip_address":"","ucode":"8301440705105A","user_header":"https://static001.geekbang.org/account/avatar/00/11/f9/03/439bdb70.jpg","comment_is_top":false,"comment_ctime":1542505772,"is_pvip":false,"replies":[{"id":"14420","content":"这个prepare已经是在你执行“COMMIT”语句里面了","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542521166,"ip_address":"","comment_id":40113,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542505772","product_id":100020801,"comment_content":"redo日志在prepare阶段之后就已经刷盘啦？我按我的理解，innodb_flush_log_at_trx_commit 应该是控制在commit之后才会写磁盘啊？如果是没有问题，如果不是，binlog刷盘后是无法保证redolog刷盘的。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429377,"discussion_content":"这个prepare已经是在你执行“COMMIT”语句里面了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542521166,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40082,"user_name":"below zero","can_delete":false,"product_type":"c1","uid":1211712,"ip_address":"","ucode":"D7776374ACDA2A","user_header":"https://static001.geekbang.org/account/avatar/00/12/7d/40/92bb705c.jpg","comment_is_top":false,"comment_ctime":1542466069,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542466069","product_id":100020801,"comment_content":"那个备份的问题，应该还是根据恢复时间快慢的需要来决定是一天一备还是一周一备。","like_count":0},{"had_liked":false,"id":40068,"user_name":"kghch","can_delete":false,"product_type":"c1","uid":1313334,"ip_address":"","ucode":"E7E9DD543379B7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIJKia3LYh56vXYniaOuY75PfsIAznb07H0WL0UDrceu4KGJFB3Xia2HAq1gw5KfaSse3kl2MHek79BQ/132","comment_is_top":false,"comment_ctime":1542462797,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542462797","product_id":100020801,"comment_content":"数据库可用性，即宕机时的恢复速度","like_count":0},{"had_liked":false,"id":40032,"user_name":"风吹树叶沙沙沙","can_delete":false,"product_type":"c1","uid":1012502,"ip_address":"","ucode":"219F91A66F3DCC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/73/16/d22fbfbe.jpg","comment_is_top":false,"comment_ctime":1542446819,"is_pvip":false,"replies":[{"id":"14402","content":"不是，  binlog做不到的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542469912,"ip_address":"","comment_id":40032,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542446819","product_id":100020801,"comment_content":"老师，我理解Redo log和Binlog都是记录数据页的变化，他俩最大的区别应该是Redo log是固定大小循环记，而Binlog是达到指定大小后归档这一点吧。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429341,"discussion_content":"不是，  binlog做不到的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542469912,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40027,"user_name":"vo1d","can_delete":false,"product_type":"c1","uid":1308023,"ip_address":"","ucode":"9C6474D602EF90","user_header":"","comment_is_top":false,"comment_ctime":1542445563,"is_pvip":false,"replies":[{"id":"14404","content":"1. 你这个做法不好，应该先insert,拿到的这个last_insert_id就行<br><br>2. 如果有这种需求，最好不要把这些拆成单行。 或者创建另外一个表单独维护包含“1001”对应的集合","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542470378,"ip_address":"","comment_id":40027,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542445563","product_id":100020801,"comment_content":"老师你好，自学编程，刚接触mysql，最近碰到些问题想请教下老师。<br>1)我的数据表设计 id user ud,先做个多线程拿号登陆的功能，未避免拿到重复的号码，我百度到使用UPDATE $db SET ud=1, id=LAST_INSERT_ID(id) WHERE ud=0 LIMIT 1  ；SELECT user FROM $db WHERE ROW_COUNT()&gt;0 and id=LAST_INSERT_ID()；这两句来取号，但是效率很低，数据一大，mysql还容易崩溃。请问有更好的方法吗？谢谢。<br>2)我的第二个项目数据表设计 id user  info。数据利润  1，user1，1001;1002;1003。我想查询包含1001的数据，用like的话，数据少的话还可以接受，当百万数据的时候，就会很卡很慢。想请教老师有其他的方案吗？<br>新手，可能问题比较low，期待老师的解惑，谢谢。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429336,"discussion_content":"1. 你这个做法不好，应该先insert,拿到的这个last_insert_id就行\n\n2. 如果有这种需求，最好不要把这些拆成单行。 或者创建另外一个表单独维护包含“1001”对应的集合","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542470378,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":40024,"user_name":"hbprotoss","can_delete":false,"product_type":"c1","uid":1217862,"ip_address":"","ucode":"A18E0AC7D32FB5","user_header":"https://static001.geekbang.org/account/avatar/00/12/95/46/07a79c15.jpg","comment_is_top":false,"comment_ctime":1542444164,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542444164","product_id":100020801,"comment_content":"先写 redo log 后写 binlog 这个场景，个人感觉表述可以再修改一下。如果redo log先提交，那么主从复制的情况下，主库恢复是没问题的，但是由于没有binlog，从库数据就不一致了","like_count":0},{"had_liked":false,"id":40023,"user_name":"凉快","can_delete":false,"product_type":"c1","uid":1305139,"ip_address":"","ucode":"BD6DFC495B75CA","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er17O1Y2B8WibUQgQDibrVvTPqwF6dF6bKJLWE7gg2M2mEgZ5cHicn6KUJYHp9gmJfuP4bqshCUxfnGA/132","comment_is_top":false,"comment_ctime":1542443886,"is_pvip":false,"replies":[{"id":"14405","content":"1. 对，更新内存<br>2. 粉板记录的最多的更新记录是4G。 我们说的内存是放数据的内存，就是buffer_pool的大小","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542470574,"ip_address":"","comment_id":40023,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1542443886","product_id":100020801,"comment_content":"有一段不太懂：<br>具体来说，当有一条记录需要更新的时候，InnoDB 引擎就会先把记录写到 redo log（粉板）里面，并更新内存，这个时候更新就算完成了。<br>这里所说的，并更新内存，值得是更新内存里面的数据吗？ 即id为2的数据，<br>另一个问题，按照前面所讲的分区，那内存里面最大存储的数据量是否为4个G？（即，老板一直没时间写入账本，小黑板记录的最大数据量）","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429335,"discussion_content":"1. 对，更新内存\n2. 粉板记录的最多的更新记录是4G。 我们说的内存是放数据的内存，就是buffer_pool的大小","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542470574,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":549788,"discussion_content":"为什么不是commit之后再更新内存","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644240758,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":429335,"ip_address":""},"score":549788,"extra":""}]}]},{"had_liked":false,"id":39992,"user_name":"布衣","can_delete":false,"product_type":"c1","uid":1083873,"ip_address":"","ucode":"8488B584C322A7","user_header":"https://static001.geekbang.org/account/avatar/00/10/89/e1/2f3cc2d6.jpg","comment_is_top":false,"comment_ctime":1542430433,"is_pvip":false,"replies":[{"id":"14366","content":"第一个回滚，第二个事务有效","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542440127,"ip_address":"","comment_id":39992,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542430433","product_id":100020801,"comment_content":"老师，redo log是prepare状态，写binlog时crash；以及binlog写成功，但是redolog更新为commit状态时crash；重启后的回复机制又是怎么做的呢？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429323,"discussion_content":"第一个回滚，第二个事务有效","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542440127,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39985,"user_name":"宇锋","can_delete":false,"product_type":"c1","uid":1179916,"ip_address":"","ucode":"51CDC349948DA5","user_header":"https://static001.geekbang.org/account/avatar/00/12/01/0c/72905a3a.jpg","comment_is_top":false,"comment_ctime":1542427908,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542427908","product_id":100020801,"comment_content":"请问<br>1 binlog成功之后，更新redolog状态为commit出错了，好像还是会出现不一致。<br>2 可以说一下binlog的归档是什么意思?比如stament模式，他只是记录了原始更新sql,那他含有什么归档信息呢？","like_count":0},{"had_liked":false,"id":39979,"user_name":"刘文韬","can_delete":false,"product_type":"c1","uid":1312479,"ip_address":"","ucode":"41395E6036D516","user_header":"https://static001.geekbang.org/account/avatar/00/14/06/df/d0fe2300.jpg","comment_is_top":false,"comment_ctime":1542426601,"is_pvip":false,"replies":[{"id":"14369","content":"下一讲就讲MVCC😄 等周天晚上哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542440557,"ip_address":"","comment_id":39979,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542426601","product_id":100020801,"comment_content":"请问林老师，新行更新到内存与写redo log之间怎么保证一致性？如果在默认隔离级别（可重复读）下，是否此时的更新是写一块新内存？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429316,"discussion_content":"下一讲就讲MVCC😄 等周天晚上哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542440557,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39975,"user_name":"魔都浪子","can_delete":false,"product_type":"c1","uid":1177859,"ip_address":"","ucode":"8301440705105A","user_header":"https://static001.geekbang.org/account/avatar/00/11/f9/03/439bdb70.jpg","comment_is_top":false,"comment_ctime":1542425855,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542425855","product_id":100020801,"comment_content":"“update 语句时的内部流程”中的步骤4后系统崩溃，产生的效果不是跟后面举的例子先写binlog后写redo log一样嘛？也就是说binlog已经写入磁盘，但是没有commit的时候发生crash，那么redolog没有机会写入磁盘，这样两阶段一样会产生两种不一致的日志。","like_count":0},{"had_liked":false,"id":39958,"user_name":"肥龙","can_delete":false,"product_type":"c1","uid":1045652,"ip_address":"","ucode":"5B7EFED9E411E5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f4/94/13379a7f.jpg","comment_is_top":false,"comment_ctime":1542421438,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542421438","product_id":100020801,"comment_content":"老师，前面说的 “如果 write pos 追上 checkpoint，会擦出一部分数据”<br>擦出数据的多少的衡量标准是什么？也就是说，如果 write pos赶上了checkpoint，会擦出多少数据？这个是配置决定？还是mysql会随机擦出一部分？<br>","like_count":0},{"had_liked":false,"id":39947,"user_name":"fsj","can_delete":false,"product_type":"c1","uid":1017571,"ip_address":"","ucode":"5DA2B549C9B5FE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/86/e3/28d1330a.jpg","comment_is_top":false,"comment_ctime":1542418043,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542418043","product_id":100020801,"comment_content":"老师与同学在留言区互动真是太赞了，数据库小白用户也能看懂很大一部分，赞赞赞","like_count":0},{"had_liked":false,"id":39940,"user_name":"liao xueqiang","can_delete":false,"product_type":"c1","uid":1310325,"ip_address":"","ucode":"68713441579F6B","user_header":"https://static001.geekbang.org/account/avatar/00/13/fe/75/46742f12.jpg","comment_is_top":false,"comment_ctime":1542414701,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542414701","product_id":100020801,"comment_content":"个人理解，redo包含已提交和未提交的数据，而binlog只包含已提交的数据，请老师确认","like_count":0},{"had_liked":false,"id":39939,"user_name":"Ethan","can_delete":false,"product_type":"c1","uid":1302972,"ip_address":"","ucode":"70DAFC848452F4","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epVeXLvUlNmTDeia2Qpib4uiarUOgnvT3JX86SiaylraT6UORemgyQFkFibGhymcyKiacHdada1HHmCSJ8g/132","comment_is_top":false,"comment_ctime":1542414002,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542414002","product_id":100020801,"comment_content":"老师我想问一下为什么update的时候要把这个表所有的缓存都清空而不是只把更新的条目失效掉？","like_count":0},{"had_liked":false,"id":39931,"user_name":"高小强","can_delete":false,"product_type":"c1","uid":1302451,"ip_address":"","ucode":"06A915A5FDCA6D","user_header":"https://static001.geekbang.org/account/avatar/00/13/df/b3/4860a6bc.jpg","comment_is_top":false,"comment_ctime":1542409493,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542409493","product_id":100020801,"comment_content":"通俗易懂，期待老师下一篇的分享！","like_count":0},{"had_liked":false,"id":39920,"user_name":"狗蛋","can_delete":false,"product_type":"c1","uid":1303295,"ip_address":"","ucode":"812389B6F073AC","user_header":"https://static001.geekbang.org/account/avatar/00/13/e2/ff/ca3dec06.jpg","comment_is_top":false,"comment_ctime":1542385452,"is_pvip":false,"replies":[{"id":"14350","content":"这个是实现上的，逻辑上的这三个操作都还在","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542389693,"ip_address":"","comment_id":39920,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542385452","product_id":100020801,"comment_content":"5.7不是已经改了吗？prepare阶段写redo log改到binlog三阶段写的flush阶段了?","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429294,"discussion_content":"这个是实现上的，逻辑上的这三个操作都还在","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542389693,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39911,"user_name":"Finn","can_delete":false,"product_type":"c1","uid":1254026,"ip_address":"","ucode":"724A39E0C74CE5","user_header":"https://static001.geekbang.org/account/avatar/00/13/22/8a/93ee037f.jpg","comment_is_top":false,"comment_ctime":1542381922,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542381922","product_id":100020801,"comment_content":"讲的很好。👍","like_count":0},{"had_liked":false,"id":39910,"user_name":"阿涛","can_delete":false,"product_type":"c1","uid":1308853,"ip_address":"","ucode":"B0785A5B501352","user_header":"https://static001.geekbang.org/account/avatar/00/13/f8/b5/82b64369.jpg","comment_is_top":false,"comment_ctime":1542381744,"is_pvip":false,"replies":[{"id":"14346","content":"不会，这时候事务会回滚，binlog也没有，所以是一致的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542384999,"ip_address":"","comment_id":39910,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542381744","product_id":100020801,"comment_content":"如果更新写入redolog后处于prepare状态，此时系统突然断电，那么binlog没有写入记录，重启后数据库的实际数据根据redolog更新了，但与binlog的语句记录不符，那么binlog怎么办？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429286,"discussion_content":"不会，这时候事务会回滚，binlog也没有，所以是一致的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542384999,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39901,"user_name":"Goal","can_delete":false,"product_type":"c1","uid":1307012,"ip_address":"","ucode":"C337CD4C7E07B0","user_header":"https://static001.geekbang.org/account/avatar/00/13/f1/84/7d21bd9e.jpg","comment_is_top":false,"comment_ctime":1542379813,"is_pvip":false,"replies":[{"id":"14347","content":"我觉得这些还是应该发出来。不过你可以选择一下，编辑会把好的评论和答复置顶。","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542385069,"ip_address":"","comment_id":39901,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542379813","product_id":100020801,"comment_content":"留言太多了，老师可以过滤下吗？把比较集中的代表性的问题，放出来","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429282,"discussion_content":"我觉得这些还是应该发出来。不过你可以选择一下，编辑会把好的评论和答复置顶。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542385069,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39881,"user_name":"DotaSeven","can_delete":false,"product_type":"c1","uid":1309178,"ip_address":"","ucode":"B7B8BF0446461D","user_header":"https://static001.geekbang.org/account/avatar/00/13/f9/fa/62682d86.jpg","comment_is_top":false,"comment_ctime":1542374494,"is_pvip":false,"replies":[{"id":"14322","content":"这个稍微有点麻烦，最直接方法是GDB，停在两个函数中间，然后coredump出来","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542377574,"ip_address":"","comment_id":39881,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542374494","product_id":100020801,"comment_content":"老师，我想模式redo_log成功，bin_log失败；或者反过来。该如何模拟呢？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429273,"discussion_content":"这个稍微有点麻烦，最直接方法是GDB，停在两个函数中间，然后coredump出来","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542377574,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39877,"user_name":"oscarwin","can_delete":false,"product_type":"c1","uid":1131956,"ip_address":"","ucode":"492430BA342593","user_header":"https://static001.geekbang.org/account/avatar/00/11/45/b4/ec66d499.jpg","comment_is_top":false,"comment_ctime":1542373203,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542373203","product_id":100020801,"comment_content":"对思考题说说自己粗浅的理解，如果业务数据量非常大，那么一天一备要比一周一备会更好，因为一天一备相当于把备份的压力分散了，如果全部集中到一周后备份，那么备份的压力会很大。如果业务数据非常重要，一天一备也比一周一备更好，一旦出现了binlog日志被损坏的情况，最多也只丢失了一天的数据。但是，我感觉备份只要有binlog日志就可以，这样不需要占用主库的资源就可以完成备份，所以备份会影响哪些指标还思考不到","like_count":0},{"had_liked":false,"id":39874,"user_name":"吕","can_delete":false,"product_type":"c1","uid":1210890,"ip_address":"","ucode":"8F08E2CB81C4C3","user_header":"https://static001.geekbang.org/account/avatar/00/12/7a/0a/0ce5c232.jpg","comment_is_top":false,"comment_ctime":1542372953,"is_pvip":false,"replies":[{"id":"14326","content":"这时候是算提交成功的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542378011,"ip_address":"","comment_id":39874,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542372953","product_id":100020801,"comment_content":"两步提交法，如果在binlog执行完crash，那这时事务处于未提交状态，是prepared的状态，这样会不会也导致恢复的时候数据不一致？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429269,"discussion_content":"这时候是算提交成功的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542378011,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39871,"user_name":"吴小智","can_delete":false,"product_type":"c1","uid":1310798,"ip_address":"","ucode":"C7C9F58B5C9F7B","user_header":"https://static001.geekbang.org/account/avatar/00/14/00/4e/be2b206b.jpg","comment_is_top":false,"comment_ctime":1542372322,"is_pvip":false,"replies":[{"id":"14324","content":"这样问题比较难回答哈，你可以先理解下文章里面的反证的例子，返回想一个两阶段的崩溃的例子，看看哪里没想清楚再提出来","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542377777,"ip_address":"","comment_id":39871,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542372322","product_id":100020801,"comment_content":"那为什么两次提交可以确保一致性呢？小白勿喷","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429267,"discussion_content":"这样问题比较难回答哈，你可以先理解下文章里面的反证的例子，返回想一个两阶段的崩溃的例子，看看哪里没想清楚再提出来","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542377777,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39858,"user_name":"夜空中最亮的星","can_delete":false,"product_type":"c1","uid":1267566,"ip_address":"","ucode":"ADC3E7B6789955","user_header":"https://static001.geekbang.org/account/avatar/00/13/57/6e/b6795c44.jpg","comment_is_top":false,"comment_ctime":1542369239,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542369239","product_id":100020801,"comment_content":"老师写的很棒，收获很多，真的赚到了。","like_count":0},{"had_liked":false,"id":39852,"user_name":"强哥","can_delete":false,"product_type":"c1","uid":1206726,"ip_address":"","ucode":"3B8DC780FE4EF9","user_header":"https://static001.geekbang.org/account/avatar/00/12/69/c6/513df085.jpg","comment_is_top":false,"comment_ctime":1542368546,"is_pvip":false,"replies":[{"id":"14318","content":"是，undolog在后面一篇：）","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542371761,"ip_address":"","comment_id":39852,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542368546","product_id":100020801,"comment_content":" 一句话，redo日志用于保障，已提交事务的ACID特性。同时随机写改为顺序写，提升性能。这里缺少undolog的讲解吧？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429258,"discussion_content":"是，undolog在后面一篇：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542371761,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39844,"user_name":"落叶飞逝的恋","can_delete":false,"product_type":"c1","uid":1046429,"ip_address":"","ucode":"F9A95DB28BCF1E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f7/9d/be04b331.jpg","comment_is_top":false,"comment_ctime":1542365429,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542365429","product_id":100020801,"comment_content":"一天一备份相比一周一备份而言，更加可靠。发生数据库异常，可以快速恢复。","like_count":0},{"had_liked":false,"id":39839,"user_name":"lucia","can_delete":false,"product_type":"c1","uid":1307267,"ip_address":"","ucode":"0BCAF5F739E002","user_header":"https://static001.geekbang.org/account/avatar/00/13/f2/83/f2b7036b.jpg","comment_is_top":false,"comment_ctime":1542364884,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542364884","product_id":100020801,"comment_content":"讲解得很透彻","like_count":0},{"had_liked":false,"id":39834,"user_name":"yy","can_delete":false,"product_type":"c1","uid":1307788,"ip_address":"","ucode":"4F6E10E2D1FE8C","user_header":"","comment_is_top":false,"comment_ctime":1542364091,"is_pvip":false,"replies":[{"id":"14304","content":"一般这两个都建议设置成1（有时候称双1），除非你的系统IO撑不住了要临时应急","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542366070,"ip_address":"","comment_id":39834,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542364091","product_id":100020801,"comment_content":"老师 我想请教一下 两个控制日志写磁盘的性能参数 如果都设置1 会不会对io影响很大 对大并发也要设成1吗","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429248,"discussion_content":"一般这两个都建议设置成1（有时候称双1），除非你的系统IO撑不住了要临时应急","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542366070,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39833,"user_name":"ThinkingQuest","can_delete":false,"product_type":"c1","uid":1118560,"ip_address":"","ucode":"597D0C00DAEFE4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/0SDRac7XoordnKYgDLhz5wxAOtE6xqcsSywsywEtKQAR7xicBZQ6ceYftfZjl4Ivq3a5dzvRhYkn2GcUWiaQK7ZQ/132","comment_is_top":false,"comment_ctime":1542363917,"is_pvip":false,"replies":[{"id":"14303","content":"崩溃恢复后算成功","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542365997,"ip_address":"","comment_id":39833,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542363917","product_id":100020801,"comment_content":"两阶段提交这块看的不是很明白。<br><br>那个过程4之后写入binlog之后如果系统crash了，没有把redo log标记为commit的话，它会怎么样呢。 处在prepare状态下。 <br><br>两阶段提交这个东西，在分布式理论中看到过多次，反复考虑它的过程，始终觉得并不能保证一致性啊。<br>求解答。<br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429247,"discussion_content":"崩溃恢复后算成功","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542365997,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39822,"user_name":"极客童","can_delete":false,"product_type":"c1","uid":1250397,"ip_address":"","ucode":"D92EA8CA293B93","user_header":"https://static001.geekbang.org/account/avatar/00/13/14/5d/f4d789cc.jpg","comment_is_top":false,"comment_ctime":1542361591,"is_pvip":false,"replies":[{"id":"14299","content":"不会的，看一下置顶文章的评论哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542364308,"ip_address":"","comment_id":39822,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542361591","product_id":100020801,"comment_content":"我有个疑问，按照正常的两步提交，先写redo log，回来写bin log，然后再commit的时候故障重启没成功，这时候不是也会导致两者日志不一致的问题吗？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429241,"discussion_content":"不会的，看一下置顶文章的评论哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542364308,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39816,"user_name":"尼古拉斯·赵四","can_delete":false,"product_type":"c1","uid":1306127,"ip_address":"","ucode":"B70B573B37BCB3","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epfVZHmbUnsxU67FwotibOjM0Obc47VWMyRBmY06AjqTp0C96A8zhUULWjBerK3XtPC7Q8LVClzPxA/132","comment_is_top":false,"comment_ctime":1542360786,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542360786","product_id":100020801,"comment_content":"在RTO上一天一备会比一周一备更有优势","like_count":0},{"had_liked":false,"id":39814,"user_name":"五云天北是神州","can_delete":false,"product_type":"c1","uid":1310953,"ip_address":"","ucode":"8AA63B4CD0E2D3","user_header":"https://static001.geekbang.org/account/avatar/00/14/00/e9/00fd2bd3.jpg","comment_is_top":false,"comment_ctime":1542360659,"is_pvip":false,"replies":[{"id":"14300","content":"会在《MySQL重启一次要多久》里面提到，不过更多还是指出有这些过程，应用怎么处理… ","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542364434,"ip_address":"","comment_id":39814,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542360659","product_id":100020801,"comment_content":"坐等老师讲一讲详细的crash_recovery，尤其是undo和binlog对比事务链表的回滚那部分。谢谢","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429238,"discussion_content":"会在《MySQL重启一次要多久》里面提到，不过更多还是指出有这些过程，应用怎么处理… ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542364434,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39788,"user_name":"五年","can_delete":false,"product_type":"c1","uid":1081224,"ip_address":"","ucode":"28A6F945FB0626","user_header":"https://static001.geekbang.org/account/avatar/00/10/7f/88/c4263c58.jpg","comment_is_top":false,"comment_ctime":1542356847,"is_pvip":false,"replies":[{"id":"14293","content":"这样不算丢数据呀","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542362505,"ip_address":"","comment_id":39788,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542356847","product_id":100020801,"comment_content":"redo log 满血复活是怎么做到的呢.如果数据库 crash 掉, redo log 是保存到 crash 之前的最后一次提交, binlog 也是; 这时候数据库恢复的话,数据库本身为什么会丢什么数据呢...","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429227,"discussion_content":"这样不算丢数据呀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542362505,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39759,"user_name":"滴答","can_delete":false,"product_type":"c1","uid":1126947,"ip_address":"","ucode":"14143B90660178","user_header":"https://static001.geekbang.org/account/avatar/00/11/32/23/5de4b29a.jpg","comment_is_top":false,"comment_ctime":1542349889,"is_pvip":false,"replies":[{"id":"14278","content":"1. 不会。就直接从内存读走，内存是对的就行<br><br>2. 用binlog是用在备份恢复到过程中，这个过程就是用全量备份+binlog,你可以认为没redolog的帮助","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542355149,"ip_address":"","comment_id":39759,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542349889","product_id":100020801,"comment_content":"有两个问题想请教老师：<br>1、redolog记录更新日志，当更新完一个表之后再进行查询，此时会将这个表的redolog刷到物理表中再进行查询吗？如果不是的话是如何保证数据最新？<br>2、数据恢复是以binlog的记录为准吗？如果要考虑redolog，那redolog如何帮助恢复？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429214,"discussion_content":"1. 不会。就直接从内存读走，内存是对的就行\n\n2. 用binlog是用在备份恢复到过程中，这个过程就是用全量备份+binlog,你可以认为没redolog的帮助","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542355149,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39755,"user_name":"BigMortal","can_delete":false,"product_type":"c1","uid":1302057,"ip_address":"","ucode":"6236118A0FFCBB","user_header":"https://static001.geekbang.org/account/avatar/00/13/de/29/71685b0b.jpg","comment_is_top":false,"comment_ctime":1542347451,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542347451","product_id":100020801,"comment_content":"那么在什么场景下，一天一备会比一周一备更有优势呢？或者说，它影响了这个数据库系统的哪个指标？<br>回答：故障发生，需要快速恢复，一周一备，需要应用一周的binlog，恢复时间会相对较长；不知道我的理解时候正确","like_count":0},{"had_liked":false,"id":39746,"user_name":"如是","can_delete":false,"product_type":"c1","uid":1133500,"ip_address":"","ucode":"78F7D2402483C4","user_header":"https://static001.geekbang.org/account/avatar/00/11/4b/bc/86a9ac70.jpg","comment_is_top":false,"comment_ctime":1542345847,"is_pvip":false,"replies":[{"id":"14262","content":"看一下置顶回复","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542347961,"ip_address":"","comment_id":39746,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542345847","product_id":100020801,"comment_content":"老师，既然通过binlog就能恢复数据，为什么还要用redolog？只是重启的时候需要根据备份数据再执行一次binlog,启动可能会耗时，但是大部分情况下都是正常的，这种情况也可以根据备份数据和binlog合并来适当减缓这个问题，不知道我的理解是不是哪有问题，还是redolog还在别的操作上使用。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429208,"discussion_content":"看一下置顶回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542347961,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39735,"user_name":"Kam","can_delete":false,"product_type":"c1","uid":1181634,"ip_address":"","ucode":"0EF2CB222AF1F1","user_header":"https://static001.geekbang.org/account/avatar/00/12/07/c2/9066aee8.jpg","comment_is_top":false,"comment_ctime":1542344059,"is_pvip":false,"replies":[{"id":"14257","content":"谢谢表扬😄<br><br>嗯评论区我觉得是个很好的地方。有些点在正文展开就会打乱整体思路，不能无限细节；<br><br>评论区就是针对细节的，刚好补充","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542346309,"ip_address":"","comment_id":39735,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1542344059","product_id":100020801,"comment_content":"感觉很深刻。评论也有干货。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429204,"discussion_content":"谢谢表扬😄\n\n嗯评论区我觉得是个很好的地方。有些点在正文展开就会打乱整体思路，不能无限细节；\n\n评论区就是针对细节的，刚好补充","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542346309,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1322622,"avatar":"https://static001.geekbang.org/account/avatar/00/14/2e/7e/bd3b2a08.jpg","nickname":"@","note":"","ucode":"1BF0CE3F3ED41E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579243,"discussion_content":"评论太多了 刷到这吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657266119,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39718,"user_name":"Sinyo","can_delete":false,"product_type":"c1","uid":1307297,"ip_address":"","ucode":"57B243E7AB86A5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJAibnPX9jW8kqLcIfibjic8GbkQkEUYyFKJkc39hZhibVlNrqwTjdLozkqibI2IwACd5YzofYickNxFnZg/132","comment_is_top":false,"comment_ctime":1542341063,"is_pvip":false,"replies":[{"id":"14229","content":"置顶回复中说明了，看一下","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542341636,"ip_address":"","comment_id":39718,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542341063","product_id":100020801,"comment_content":"老师，是不是只能用bin log或redo log其中一个日志对数据库进行还原？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429194,"discussion_content":"置顶回复中说明了，看一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542341636,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39714,"user_name":"爸爸回来了","can_delete":false,"product_type":"c1","uid":1305016,"ip_address":"","ucode":"30B8C927C04D66","user_header":"","comment_is_top":false,"comment_ctime":1542340445,"is_pvip":false,"replies":[{"id":"14230","content":"作者碰到一个月一备，要跑20多天日志的，了解一下😭","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542341686,"ip_address":"","comment_id":39714,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542340445","product_id":100020801,"comment_content":"恢复数据时，根据全量所在的pos开始由binlog恢复。假设你周天做恢复，使用的是周一的备份。那么你有周二周三周四周五周六的binlog要恢复。这个过程是可以很感人的(ಥ_ಥ)","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429192,"discussion_content":"作者碰到一个月一备，要跑20多天日志的，了解一下😭","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542341686,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39710,"user_name":"石建磊","can_delete":false,"product_type":"c1","uid":1155403,"ip_address":"","ucode":"53A4E311D3DF62","user_header":"https://static001.geekbang.org/account/avatar/00/11/a1/4b/254480d3.jpg","comment_is_top":false,"comment_ctime":1542339312,"is_pvip":false,"replies":[{"id":"14232","content":"Binlog写完就算，但是并不是用binlog恢复，恢复这个工作还是innodb做的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542341954,"ip_address":"","comment_id":39710,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542339312","product_id":100020801,"comment_content":"两阶段提交那里不太懂，我理解是不是只要binlog保存成功，数据就能恢复，redolog 是不是就为了加快innodb引擎的写速度的?","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429190,"discussion_content":"Binlog写完就算，但是并不是用binlog恢复，恢复这个工作还是innodb做的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542341954,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39704,"user_name":"undifined","can_delete":false,"product_type":"c1","uid":1068920,"ip_address":"","ucode":"449CB4CD2DC089","user_header":"https://static001.geekbang.org/account/avatar/00/10/4f/78/c3d8ecb0.jpg","comment_is_top":false,"comment_ctime":1542337743,"is_pvip":false,"replies":[{"id":"14234","content":"整个事务回滚，数据也没有，日志也没有，也是一致的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542342014,"ip_address":"","comment_id":39704,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542337743","product_id":100020801,"comment_content":"老师 如果 binlog 或者 redo log 在写入磁盘的过程中故障了怎么保障数据一致","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429186,"discussion_content":"整个事务回滚，数据也没有，日志也没有，也是一致的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542342014,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39703,"user_name":"Sinyo","can_delete":false,"product_type":"c1","uid":1307297,"ip_address":"","ucode":"57B243E7AB86A5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJAibnPX9jW8kqLcIfibjic8GbkQkEUYyFKJkc39hZhibVlNrqwTjdLozkqibI2IwACd5YzofYickNxFnZg/132","comment_is_top":false,"comment_ctime":1542337705,"is_pvip":false,"replies":[{"id":"14235","content":"这个专栏应该不会涉及，主要涉及的还是大家碰到比较多的问题和概念","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542342082,"ip_address":"","comment_id":39703,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542337705","product_id":100020801,"comment_content":"老师以后可以提及一下BRIGHTHOUSE引擎么？谢谢！","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429185,"discussion_content":"这个专栏应该不会涉及，主要涉及的还是大家碰到比较多的问题和概念","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542342082,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39696,"user_name":"晨思暮语","can_delete":false,"product_type":"c1","uid":1304974,"ip_address":"","ucode":"F21D2FDCDD6B43","user_header":"https://static001.geekbang.org/account/avatar/00/13/e9/8e/6dc15a91.jpg","comment_is_top":false,"comment_ctime":1542336931,"is_pvip":false,"replies":[{"id":"14204","content":"处理是一样的，只是不是1，会不会每次写完直接强制落盘","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542338059,"ip_address":"","comment_id":39696,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542336931","product_id":100020801,"comment_content":"丁老师你好，有个问题请帮忙答疑？就是如果innodb_flush_at_trx_commit与sync_binlog都是非1情况下，prepare阶段如何处理redo log，谢谢！","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429183,"discussion_content":"处理是一样的，只是不是1，会不会每次写完直接强制落盘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542338059,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39695,"user_name":"发条橙子 。","can_delete":false,"product_type":"c1","uid":1259218,"ip_address":"","ucode":"ED076F4534FFED","user_header":"https://static001.geekbang.org/account/avatar/00/13/36/d2/c7357723.jpg","comment_is_top":false,"comment_ctime":1542336708,"is_pvip":false,"replies":[{"id":"14205","content":"会没了，但是没关系，因为redolog都没写完，表示你事务还没提交，中间出了错，本来就应该没的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542338121,"ip_address":"","comment_id":39695,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542336708","product_id":100020801,"comment_content":"老师，我现在有点搞不懂 mysql 缓存机制和 innodb缓存机制的关系 ，以及   redo日志也有缓存，如果在缓存中还没同步到 redo 日志里的时候，mysql 发生的 crash 时，是否更新记录就真的没了","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429182,"discussion_content":"会没了，但是没关系，因为redolog都没写完，表示你事务还没提交，中间出了错，本来就应该没的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542338121,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39694,"user_name":"似水流年","can_delete":false,"product_type":"c1","uid":1304443,"ip_address":"","ucode":"D114A8E273133C","user_header":"https://static001.geekbang.org/account/avatar/00/13/e7/7b/71da8283.jpg","comment_is_top":false,"comment_ctime":1542336606,"is_pvip":false,"replies":[{"id":"14208","content":"Redolog没写，这个不算丢数据的。交易失败是预期的，也应该这样处理。就靠业务重试","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542338203,"ip_address":"","comment_id":39694,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542336606","product_id":100020801,"comment_content":"是否在redo没写时重启数据库，会使事务丢失？这个交易也失败。怎样情况重启会出现数据库数据不一致呢？oracle都存在重启后数据不一致的情况。数据不一致后怎么恢复？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429181,"discussion_content":"Redolog没写，这个不算丢数据的。交易失败是预期的，也应该这样处理。就靠业务重试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542338203,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39685,"user_name":"倪大人","can_delete":false,"product_type":"c1","uid":1193052,"ip_address":"","ucode":"4798D69F3E86FB","user_header":"https://static001.geekbang.org/account/avatar/00/12/34/5c/6b4757a0.jpg","comment_is_top":false,"comment_ctime":1542335733,"is_pvip":false,"replies":[{"id":"14192","content":"默认会把binlog中未提交的事务，稍微改一下，写成“默认会把binlog中已经完整写完的binlog事务” 。<br><br>嗯嗯解释很到位","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542336774,"ip_address":"","comment_id":39685,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542335733","product_id":100020801,"comment_content":"关于redolog prepare之后发生意外，通过binlog恢复时怎么处理的问题，我理解是这样的：通过binlog恢复时默认会把binlog中未提交的记录提交一下，这样这部分数据binlog跟redolog就对得上了。如果binlog中没有记录，redolog中未提交的记录会回滚，相当于这一次更新失败，这样两边也能对得上了。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429179,"discussion_content":"默认会把binlog中未提交的事务，稍微改一下，写成“默认会把binlog中已经完整写完的binlog事务” 。\n\n嗯嗯解释很到位","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542336774,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39679,"user_name":"nimil","can_delete":false,"product_type":"c1","uid":1197925,"ip_address":"","ucode":"19933068972746","user_header":"https://static001.geekbang.org/account/avatar/00/12/47/65/cce8eb34.jpg","comment_is_top":false,"comment_ctime":1542334868,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542334868","product_id":100020801,"comment_content":"对于数据丢失时的恢复速度，如果一周一备相对于一天一备来说恢复速度肯定是要慢的，如果数据每天更新量不是很大，可以选择一周一备","like_count":0},{"had_liked":false,"id":39673,"user_name":"张良","can_delete":false,"product_type":"c1","uid":1241439,"ip_address":"","ucode":"BE95F81FE30FE4","user_header":"https://static001.geekbang.org/account/avatar/00/12/f1/5f/6ac1c883.jpg","comment_is_top":false,"comment_ctime":1542334551,"is_pvip":false,"replies":[{"id":"14197","content":"👍🏿到位","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542337275,"ip_address":"","comment_id":39673,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542334551","product_id":100020801,"comment_content":"回答上面李提出的问题：始终记住一点它们两个pos都是朝一个方向，按照一致的路径循环的。按图中所示，可写空间是从write pos到3，加上从0到check pos","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429173,"discussion_content":"👍🏿到位","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542337275,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39665,"user_name":"对方正在输入中…","can_delete":false,"product_type":"c1","uid":1210596,"ip_address":"","ucode":"D40224951C57E1","user_header":"https://static001.geekbang.org/account/avatar/00/12/78/e4/7978869e.jpg","comment_is_top":false,"comment_ctime":1542333531,"is_pvip":false,"replies":[{"id":"14190","content":"条理清晰的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542335238,"ip_address":"","comment_id":39665,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542333531","product_id":100020801,"comment_content":"回答问题：<br>1如果没有主从，无Binlog Server，建议至少每天一备份，库很小并发少，可以缩短备份周期，例如每小时备份一次。<br>2如果有主从，有Binlog Server，建议至少每周备份一次，库较小并发不算高，可以缩短备份周期，例如每天备份一次。<br>这里不区分有主从无Binlog Server的情况，是由于重要系统建议至少搭建主从复制，尽可能搭建Binlog Server(金融环境尤为重要)。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429169,"discussion_content":"条理清晰的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542335238,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39637,"user_name":"李","can_delete":false,"product_type":"c1","uid":1119312,"ip_address":"","ucode":"5C0FAA211F2E26","user_header":"https://static001.geekbang.org/account/avatar/00/11/14/50/c23cf47d.jpg","comment_is_top":false,"comment_ctime":1542330180,"is_pvip":true,"replies":[{"id":"14200","content":"看一下置顶评论哦","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542337481,"ip_address":"","comment_id":39637,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542330180","product_id":100020801,"comment_content":"wirte pos 是当前记录的位置，一边写一边后移，写到第 3 号文件末尾后就回到 0 号文件开头。checkpoint 是当前要擦除的位置，也是往后推移并且循环的，擦除记录前要把记录更新到数据文件。<br><br>write pos 和 checkpoint 之间的是“粉板”上还空着的部分，可以用来记录新的操作。如果 write pos 追上 checkpoint，表示“粉板”满了，这时候不能再执行新的更新，得停下来先擦掉一些记录，把 checkpoint 推进一下。<br>这个看不明白，按上图看的话，是不是画反了，不然已经超过检查点好远了？<br>如果没画反，检查点不是应该擦掉检查点之间的数据吗，那和写点之间的距离就是刚写过的，怎么可以用来记录新的？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429153,"discussion_content":"看一下置顶评论哦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542337481,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39598,"user_name":"Chenl07","can_delete":false,"product_type":"c1","uid":1089132,"ip_address":"","ucode":"0A0A086168A8F7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/0FI2bUjegtznv7XPC9DB9RJaqiaMiamWkibibPOibuUC3DCvI7XMvBANr6sDjRNbc1jwPic9pIaFxrdaib88VqUJKXSTQ/132","comment_is_top":false,"comment_ctime":1542327301,"is_pvip":false,"replies":[{"id":"14239","content":"这里说的清空的就是所有跟这个表有关的query_cache","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542342732,"ip_address":"","comment_id":39598,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542327301","product_id":100020801,"comment_content":"前面我们说过，在一个表上有更新的时候，跟这个表有关的查询缓存会失效，所以这条语句就会把表 T 上所有缓存结果都清空。<br><br>老师，这里所有缓存清空，包括数据缓存吗？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429133,"discussion_content":"这里说的清空的就是所有跟这个表有关的query_cache","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542342732,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39595,"user_name":"高枕","can_delete":false,"product_type":"c1","uid":1310312,"ip_address":"","ucode":"20F6CF75EC9AA4","user_header":"https://static001.geekbang.org/account/avatar/00/13/fe/68/e0bebd9a.jpg","comment_is_top":false,"comment_ctime":1542327130,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542327130","product_id":100020801,"comment_content":"老师最后留的问题 是不是会影响到binlog的指标？也就是说，如果一天一备，那么binlog就可以不用保留一天之前的信息了","like_count":0},{"had_liked":false,"id":39591,"user_name":"@周祥兴","can_delete":false,"product_type":"c1","uid":1099028,"ip_address":"","ucode":"565290ED89A964","user_header":"https://static001.geekbang.org/account/avatar/00/10/c5/14/7f165bfe.jpg","comment_is_top":false,"comment_ctime":1542327017,"is_pvip":false,"replies":[{"id":"14242","content":"嗯这个比较底层，运维开发基本无感知，怕展开太多。（其实这篇正文内容已经多了😁","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542342977,"ip_address":"","comment_id":39591,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542327017","product_id":100020801,"comment_content":"双写这个没有出现","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429130,"discussion_content":"嗯这个比较底层，运维开发基本无感知，怕展开太多。（其实这篇正文内容已经多了😁","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542342977,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39581,"user_name":"Hesher","can_delete":false,"product_type":"c1","uid":1026832,"ip_address":"","ucode":"99AB8B1704CB7E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ab/10/b812ff3e.jpg","comment_is_top":false,"comment_ctime":1542326503,"is_pvip":false,"replies":[{"id":"14241","content":"Redolog循环写，一周写超过4G没问题。 你要再看一下文章哈。","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1542342932,"ip_address":"","comment_id":39581,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542326503","product_id":100020801,"comment_content":"当一周内redolog容量超过4G？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429125,"discussion_content":"Redolog循环写，一周写超过4G没问题。 你要再看一下文章哈。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542342932,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}