{"id":71382,"title":"08 | 案例篇：系统中出现大量不可中断进程和僵尸进程怎么办？（下）","content":"<p>你好，我是倪朋飞。</p><p>上一节，我给你讲了Linux进程状态的含义，以及不可中断进程和僵尸进程产生的原因，我们先来简单复习下。</p><p>使用 ps 或者 top 可以查看进程的状态，这些状态包括运行、空闲、不可中断睡眠、可中断睡眠、僵尸以及暂停等。其中，我们重点学习了不可中断状态和僵尸进程：</p><ul>\n<li>\n<p>不可中断状态，一般表示进程正在跟硬件交互，为了保护进程数据与硬件一致，系统不允许其他进程或中断打断该进程。</p>\n</li>\n<li>\n<p>僵尸进程表示进程已经退出，但它的父进程没有回收该进程所占用的资源。</p>\n</li>\n</ul><p>上一节的最后，我用一个案例展示了处于这两种状态的进程。通过分析 top 命令的输出，我们发现了两个问题：</p><ul>\n<li>\n<p>第一，iowait 太高了，导致系统平均负载升高，并且已经达到了系统 CPU 的个数。</p>\n</li>\n<li>\n<p>第二，僵尸进程在不断增多，看起来是应用程序没有正确清理子进程的资源。</p>\n</li>\n</ul><p>相信你一定认真思考过这两个问题，那么，真相到底是什么呢？接下来，我们一起顺着这两个问题继续分析，找出根源。</p><p>首先，请你打开一个终端，登录到上次的机器中。然后执行下面的命令，重新运行这个案例：</p><pre><code># 先删除上次启动的案例\n$ docker rm -f app\n# 重新运行案例\n$ docker run --privileged --name=app -itd feisky/app:iowait\n</code></pre><h2>iowait 分析</h2><p>我们先来看一下 iowait 升高的问题。</p><p>我相信，一提到 iowait 升高，你首先会想要查询系统的 I/O 情况。我一般也是这种思路，那么什么工具可以查询系统的 I/O 情况呢？</p><!-- [[[read_end]]] --><p>这里，我推荐的正是上节课要求安装的 dstat ，它的好处是，可以同时查看 CPU 和 I/O 这两种资源的使用情况，便于对比分析。</p><p>那么，我们在终端中运行 dstat 命令，观察 CPU 和 I/O 的使用情况：</p><pre><code># 间隔1秒输出10组数据\n$ dstat 1 10\nYou did not select any stats, using -cdngy by default.\n--total-cpu-usage-- -dsk/total- -net/total- ---paging-- ---system--\nusr sys idl wai stl| read  writ| recv  send|  in   out | int   csw\n  0   0  96   4   0|1219k  408k|   0     0 |   0     0 |  42   885\n  0   0   2  98   0|  34M    0 | 198B  790B|   0     0 |  42   138\n  0   0   0 100   0|  34M    0 |  66B  342B|   0     0 |  42   135\n  0   0  84  16   0|5633k    0 |  66B  342B|   0     0 |  52   177\n  0   3  39  58   0|  22M    0 |  66B  342B|   0     0 |  43   144\n  0   0   0 100   0|  34M    0 | 200B  450B|   0     0 |  46   147\n  0   0   2  98   0|  34M    0 |  66B  342B|   0     0 |  45   134\n  0   0   0 100   0|  34M    0 |  66B  342B|   0     0 |  39   131\n  0   0  83  17   0|5633k    0 |  66B  342B|   0     0 |  46   168\n  0   3  39  59   0|  22M    0 |  66B  342B|   0     0 |  37   134\n</code></pre><p>从 dstat 的输出，我们可以看到，每当 iowait 升高（wai）时，磁盘的读请求（read）都会很大。这说明 iowait 的升高跟磁盘的读请求有关，很可能就是磁盘读导致的。</p><p>那到底是哪个进程在读磁盘呢？不知道你还记不记得，上节在  top  里看到的不可中断状态进程，我觉得它就很可疑，我们试着来分析下。</p><p>我们继续在刚才的终端中，运行 top 命令，观察 D 状态的进程：</p><pre><code># 观察一会儿按 Ctrl+C 结束\n$ top\n...\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n 4340 root      20   0   44676   4048   3432 R   0.3  0.0   0:00.05 top\n 4345 root      20   0   37280  33624    860 D   0.3  0.0   0:00.01 app\n 4344 root      20   0   37280  33624    860 D   0.3  0.4   0:00.01 app\n...\n\n</code></pre><p>我们从 top 的输出找到 D 状态进程的 PID，你可以发现，这个界面里有两个 D 状态的进程，PID分别是 4344 和 4345。</p><p>接着，我们查看这些进程的磁盘读写情况。对了，别忘了工具是什么。一般要查看某一个进程的资源使用情况，都可以用我们的老朋友 pidstat，不过这次记得加上 -d 参数，以便输出 I/O 使用情况。</p><p>比如，以 4344 为例，我们在终端里运行下面的 pidstat 命令，并用 -p 4344 参数指定进程号：</p><pre><code># -d 展示 I/O 统计数据，-p 指定进程号，间隔 1 秒输出 3 组数据\n$ pidstat -d -p 4344 1 3\n06:38:50      UID       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command\n06:38:51        0      4344      0.00      0.00      0.00       0  app\n06:38:52        0      4344      0.00      0.00      0.00       0  app\n06:38:53        0      4344      0.00      0.00      0.00       0  app\n</code></pre><p>在这个输出中，  kB_rd 表示每秒读的 KB 数， kB_wr 表示每秒写的 KB 数，iodelay 表示 I/O 的延迟（单位是时钟周期）。它们都是 0，那就表示此时没有任何的读写，说明问题不是 4344 进程导致的。</p><p>可是，用同样的方法分析进程 4345，你会发现，它也没有任何磁盘读写。</p><p>那要怎么知道，到底是哪个进程在进行磁盘读写呢？我们继续使用 pidstat，但这次去掉进程号，干脆就来观察所有进程的 I/O 使用情况。</p><p>在终端中运行下面的  pidstat 命令：</p><pre><code># 间隔 1 秒输出多组数据 (这里是 20 组)\n$ pidstat -d 1 20\n...\n06:48:46      UID       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command\n06:48:47        0      4615      0.00      0.00      0.00       1  kworker/u4:1\n06:48:47        0      6080  32768.00      0.00      0.00     170  app\n06:48:47        0      6081  32768.00      0.00      0.00     184  app\n\n06:48:47      UID       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command\n06:48:48        0      6080      0.00      0.00      0.00     110  app\n\n06:48:48      UID       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command\n06:48:49        0      6081      0.00      0.00      0.00     191  app\n\n06:48:49      UID       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command\n\n06:48:50      UID       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command\n06:48:51        0      6082  32768.00      0.00      0.00       0  app\n06:48:51        0      6083  32768.00      0.00      0.00       0  app\n\n06:48:51      UID       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command\n06:48:52        0      6082  32768.00      0.00      0.00     184  app\n06:48:52        0      6083  32768.00      0.00      0.00     175  app\n\n06:48:52      UID       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command\n06:48:53        0      6083      0.00      0.00      0.00     105  app\n...\n</code></pre><p>观察一会儿可以发现，的确是 app 进程在进行磁盘读，并且每秒读的数据有 32 MB，看来就是 app 的问题。不过，app 进程到底在执行啥 I/O 操作呢？</p><p>这里，我们需要回顾一下进程用户态和内核态的区别。进程想要访问磁盘，就必须使用系统调用，所以接下来，重点就是找出  app 进程的系统调用了。</p><p>strace  正是最常用的跟踪进程系统调用的工具。所以，我们从 pidstat 的输出中拿到进程的 PID 号，比如 6082，然后在终端中运行 strace 命令，并用 -p 参数指定 PID 号：</p><pre><code>$ strace -p 6082\nstrace: attach: ptrace(PTRACE_SEIZE, 6082): Operation not permitted\n</code></pre><p>这儿出现了一个奇怪的错误，strace 命令居然失败了，并且命令报出的错误是没有权限。按理来说，我们所有操作都已经是以 root 用户运行了，为什么还会没有权限呢？你也可以先想一下，碰到这种情况，你会怎么处理呢？</p><p><strong>一般遇到这种问题时，我会先检查一下进程的状态是否正常</strong>。比如，继续在终端中运行 ps 命令，并使用 grep 找出刚才的 6082 号进程：</p><pre><code>$ ps aux | grep 6082\nroot      6082  0.0  0.0      0     0 pts/0    Z+   13:43   0:00 [app] &lt;defunct&gt;\n</code></pre><p>果然，进程 6082 已经变成了 Z 状态，也就是僵尸进程。僵尸进程都是已经退出的进程，所以就没法儿继续分析它的系统调用。关于僵尸进程的处理方法，我们一会儿再说，现在还是继续分析 iowait 的问题。</p><p>到这一步，你应该注意到了，系统 iowait 的问题还在继续，但是  top、pidstat  这类工具已经不能给出更多的信息了。这时，我们就应该求助那些基于事件记录的动态追踪工具了。</p><p>你可以用  perf top 看看有没有新发现。再或者，可以像我一样，在终端中运行 perf record，持续一会儿（例如 15 秒），然后按 Ctrl+C 退出，再运行 perf report 查看报告：</p><pre><code>$ perf record -g\n$ perf report\n</code></pre><p>接着，找到我们关注的 app 进程，按回车键展开调用栈，你就会得到下面这张调用关系图：</p><p><img src=\"https://static001.geekbang.org/resource/image/21/a1/21e79416e946ed049317a4b4c5a576a1.png?wh=776*667\" alt=\"\"></p><p>这个图里的swapper 是内核中的调度进程，你可以先忽略掉。</p><p>我们来看其他信息，你可以发现， app 的确在通过系统调用 sys_read() 读取数据。并且从 new_sync_read 和 blkdev_direct_IO  能看出，进程正在对磁盘进行<strong>直接读</strong>，也就是绕过了系统缓存，每个读请求都会从磁盘直接读，这就可以解释我们观察到的 iowait 升高了。</p><p>看来，罪魁祸首是 app 内部进行了磁盘的直接 I/O啊！</p><p>下面的问题就容易解决了。我们接下来应该从代码层面分析，究竟是哪里出现了直接读请求。查看源码文件 <a href=\"https://github.com/feiskyer/linux-perf-examples/blob/master/high-iowait-process/app.c\">app.c</a>，你会发现它果然使用了 O_DIRECT 选项打开磁盘，于是绕过了系统缓存，直接对磁盘进行读写。</p><pre><code>open(disk, O_RDONLY|O_DIRECT|O_LARGEFILE, 0755)\n</code></pre><p>直接读写磁盘，对 I/O 敏感型应用（比如数据库系统）是很友好的，因为你可以在应用中，直接控制磁盘的读写。但在大部分情况下，我们最好还是通过系统缓存来优化磁盘 I/O，换句话说，删除 O_DIRECT 这个选项就是了。</p><p><a href=\"https://github.com/feiskyer/linux-perf-examples/blob/master/high-iowait-process/app-fix1.c\">app-fix1.c</a> 就是修改后的文件，我也打包成了一个镜像文件，运行下面的命令，你就可以启动它了：</p><pre><code># 首先删除原来的应用\n$ docker rm -f app\n# 运行新的应用\n$ docker run --privileged --name=app -itd feisky/app:iowait-fix1\n</code></pre><p>最后，再用 top 检查一下：</p><pre><code>$ top\ntop - 14:59:32 up 19 min,  1 user,  load average: 0.15, 0.07, 0.05\nTasks: 137 total,   1 running,  72 sleeping,   0 stopped,  12 zombie\n%Cpu0  :  0.0 us,  1.7 sy,  0.0 ni, 98.0 id,  0.3 wa,  0.0 hi,  0.0 si,  0.0 st\n%Cpu1  :  0.0 us,  1.3 sy,  0.0 ni, 98.7 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st\n...\n\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n 3084 root      20   0       0      0      0 Z   1.3  0.0   0:00.04 app\n 3085 root      20   0       0      0      0 Z   1.3  0.0   0:00.04 app\n    1 root      20   0  159848   9120   6724 S   0.0  0.1   0:09.03 systemd\n    2 root      20   0       0      0      0 S   0.0  0.0   0:00.00 kthreadd\n    3 root      20   0       0      0      0 I   0.0  0.0   0:00.40 kworker/0:0\n...\n</code></pre><p>你会发现， iowait 已经非常低了，只有 0.3%，说明刚才的改动已经成功修复了 iowait 高的问题，大功告成！不过，别忘了，僵尸进程还在等着你。仔细观察僵尸进程的数量，你会郁闷地发现，僵尸进程还在不断的增长中。</p><h2>僵尸进程</h2><p>接下来，我们就来处理僵尸进程的问题。既然僵尸进程是因为父进程没有回收子进程的资源而出现的，那么，要解决掉它们，就要找到它们的根儿，<strong>也就是找出父进程，然后在父进程里解决。</strong></p><p>父进程的找法我们前面讲过，最简单的就是运行  pstree 命令：</p><pre><code># -a 表示输出命令行选项\n# p表PID\n# s表示指定进程的父进程\n$ pstree -aps 3084\nsystemd,1\n  └─dockerd,15006 -H fd://\n      └─docker-containe,15024 --config /var/run/docker/containerd/containerd.toml\n          └─docker-containe,3991 -namespace moby -workdir...\n              └─app,4009\n                  └─(app,3084)\n</code></pre><p>运行完，你会发现 3084 号进程的父进程是 4009，也就是 app 应用。</p><p>所以，我们接着查看 app 应用程序的代码，看看子进程结束的处理是否正确，比如有没有调用 wait() 或 waitpid() ，抑或是，有没有注册 SIGCHLD 信号的处理函数。</p><p>现在我们查看修复 iowait 后的源码文件 <a href=\"https://github.com/feiskyer/linux-perf-examples/blob/master/high-iowait-process/app-fix1.c\">app-fix1.c</a> ，找到子进程的创建和清理的地方：</p><pre><code>int status = 0;\n  for (;;) {\n    for (int i = 0; i &lt; 2; i++) {\n      if(fork()== 0) {\n        sub_process();\n      }\n    }\n    sleep(5);\n  }\n\n  while(wait(&amp;status)&gt;0);\n</code></pre><p>循环语句本来就容易出错，你能找到这里的问题吗？这段代码虽然看起来调用了 wait() 函数等待子进程结束，但却错误地把 wait() 放到了 for 死循环的外面，也就是说，wait() 函数实际上并没被调用到，我们把它挪到 for 循环的里面就可以了。</p><p>修改后的文件我放到了 <a href=\"https://github.com/feiskyer/linux-perf-examples/blob/master/high-iowait-process/app-fix2.c\">app-fix2.c</a> 中，也打包成了一个 Docker 镜像，运行下面的命令，你就可以启动它：</p><pre><code># 先停止产生僵尸进程的 app\n$ docker rm -f app\n# 然后启动新的 app\n$ docker run --privileged --name=app -itd feisky/app:iowait-fix2\n</code></pre><p>启动后，再用 top 最后来检查一遍：</p><pre><code>$ top\ntop - 15:00:44 up 20 min,  1 user,  load average: 0.05, 0.05, 0.04\nTasks: 125 total,   1 running,  72 sleeping,   0 stopped,   0 zombie\n%Cpu0  :  0.0 us,  1.7 sy,  0.0 ni, 98.3 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st\n%Cpu1  :  0.0 us,  1.3 sy,  0.0 ni, 98.7 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st\n...\n\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n 3198 root      20   0    4376    840    780 S   0.3  0.0   0:00.01 app\n    2 root      20   0       0      0      0 S   0.0  0.0   0:00.00 kthreadd\n    3 root      20   0       0      0      0 I   0.0  0.0   0:00.41 kworker/0:0\n...\n</code></pre><p>好了，僵尸进程（Z状态）没有了， iowait  也是 0，问题终于全部解决了。</p><h2>小结</h2><p>今天我用一个多进程的案例，带你分析系统等待 I/O 的 CPU 使用率（也就是 iowait%）升高的情况。</p><p>虽然这个案例是磁盘 I/O 导致了 iowait 升高，不过， <strong>iowait 高不一定代表I/O 有性能瓶颈。当系统中只有 I/O 类型的进程在运行时，iowait 也会很高，但实际上，磁盘的读写远没有达到性能瓶颈的程度</strong>。</p><p>因此，碰到 iowait 升高时，需要先用 dstat、pidstat 等工具，确认是不是磁盘 I/O 的问题，然后再找是哪些进程导致了 I/O。</p><p>等待 I/O 的进程一般是不可中断状态，所以用 ps 命令找到的 D 状态（即不可中断状态）的进程，多为可疑进程。但这个案例中，在 I/O 操作后，进程又变成了僵尸进程，所以不能用 strace 直接分析这个进程的系统调用。</p><p>这种情况下，我们用了 perf 工具，来分析系统的 CPU 时钟事件，最终发现是直接 I/O 导致的问题。这时，再检查源码中对应位置的问题，就很轻松了。</p><p>而僵尸进程的问题相对容易排查，使用 pstree 找出父进程后，去查看父进程的代码，检查 wait() / waitpid() 的调用，或是 SIGCHLD 信号处理函数的注册就行了。</p><h2>思考</h2><p>最后，我想邀请你一起来聊聊，你碰到过的不可中断状态进程和僵尸进程问题。你是怎么分析它们的根源？又是怎么解决的？在今天的案例操作中，你又有什么新的发现吗？你可以结合我的讲述，总结自己的思路。</p><p>欢迎在留言区和我讨论，也欢迎把这篇文章分享给你的同事、朋友。我们一起在实战中演练，在交流中进步。</p><p><img src=\"https://static001.geekbang.org/resource/image/56/52/565d66d658ad23b2f4997551db153852.jpg?wh=1110*549\" alt=\"\"></p>","comments":[{"had_liked":false,"id":47429,"user_name":"Zecho","can_delete":false,"product_type":"c1","uid":1043058,"ip_address":"","ucode":"BF831B93BEC6E7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ea/72/aee38c83.jpg","comment_is_top":false,"comment_ctime":1544143790,"is_pvip":false,"replies":[{"id":"17054","content":"嗯嗯，实际上这里的案例是我故意设计的比较简单，这样初学者可以把重点放到理解当前讲的原理和指标上，而不是看着一堆的新工具和内核函数而感到害怕。当然了，火焰图、perf-tools、systemtap这些工具以后也会讲到，只是还是让我们先把基础的东西铺垫好。<br><br>如果你已经对这些比较熟悉了，推荐去把这些思路应用到实际的系统中去分析，然后在这里跟大家分享你的所得。我相信，你有可能会发现不同的理解，甚至是更好的分析思路。","user_name":"作者回复","comment_id":47429,"uid":"1001282","ip_address":"","utype":1,"ctime":1544277987,"user_name_real":"倪朋飞"}],"discussion_count":13,"race_medal":0,"score":"405271069614","product_id":100020901,"comment_content":"提一个建议，案例的讲解过于简单，与预期有些差距，很多时候我们实际遇到的要比这个复杂，这会带来不是简单的几个命令就可以，特别需要更深入的工具，比如brendan中火焰图，perf-tools，或者systemtab等等；希望能找些实际的案例，谢谢。","like_count":94,"discussions":[{"author":{"id":1994374,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/6e/86/c682976b.jpg","nickname":"zhushenghang","note":"","ucode":"712CFE335C7CE4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":262475,"discussion_content":"作为一名运维，我觉得老师讲的很好，我听懂了，我学下去了，最后，我对性能问题有自己的解决思路了，足矣。在这激流勇进的年代，切记饭要慢慢吃，有些道理简单谁都懂，但是怎么灵活运用简单的道理去处理复杂的问题才体现一个人的功力🤪","likes_number":15,"is_delete":false,"is_hidden":false,"ctime":1589103845,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1110706,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f2/b2/de353ede.jpg","nickname":"yYe","note":"","ucode":"62D27117CE842E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1994374,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/6e/86/c682976b.jpg","nickname":"zhushenghang","note":"","ucode":"712CFE335C7CE4","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572553,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652850525,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":262475,"ip_address":""},"score":572553,"extra":""}]},{"author":{"id":2066801,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/W0VEO7Hxzd61mia6Ls2EpBmaZ0l9q7SFUAErbu4XKIjWLmlALr4ybpicDoI8SoXY8XJNKmk04Ep1ibTCuFvfCF8GQ/132","nickname":"Chen","note":"","ucode":"5D0F3DF807706E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":325101,"discussion_content":"作为一名运维，我觉得老师讲的很好，我听懂了，我学下去了，最后，我对性能问题有自己的解决思路了，足矣。","likes_number":8,"is_delete":false,"is_hidden":false,"ctime":1605236448,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1202174,"avatar":"https://static001.geekbang.org/account/avatar/00/12/57/fe/beab006d.jpg","nickname":"Jasper","note":"","ucode":"A07ABF45D39089","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":116036,"discussion_content":"作为一名开发，我觉得老师讲的很好，我听懂了，我学下去了，最后，我对性能问题有自己的解决思路了，足矣","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1578051398,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1507080,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI1xcW38BFsNESjh9jehmF3h0lv36e1HC3KzOmSgrjtlkGxsM5dWDL6T0H2V57Bd3s4uyWLxNQ4Rg/132","nickname":"damili","note":"","ucode":"7E979B569B286B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291467,"discussion_content":"赞作者，多的，先把基础打好","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1594825975,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431766,"discussion_content":"嗯嗯，实际上这里的案例是我故意设计的比较简单，这样初学者可以把重点放到理解当前讲的原理和指标上，而不是看着一堆的新工具和内核函数而感到害怕。当然了，火焰图、perf-tools、systemtap这些工具以后也会讲到，只是还是让我们先把基础的东西铺垫好。\n\n如果你已经对这些比较熟悉了，推荐去把这些思路应用到实际的系统中去分析，然后在这里跟大家分享你的所得。我相信，你有可能会发现不同的理解，甚至是更好的分析思路。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1544277987,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1275659,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoTtHIemT3d7oOuDoU5dOGQeUzxTvcLPeD2qPS48ib5hlKq3ne650o5GVc2N5ia5uo4WOEnzmcNAZGQ/132","nickname":"刘青松","note":"","ucode":"65759A01ECD48C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":369756,"discussion_content":"太过于简单了，没有真是的生产案例，光简单的测试，完全不能体现出来linux的一个排查思路","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1619149455,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2715554,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLBHy0D2KUZwOGHRG8qloicx2V4E4mImsPIiavPfr12BZB6QyUlHNdmOohC3EbsgnM2QNBeoqu82Grw/132","nickname":"皮卡卡","note":"","ucode":"52B3F234550E7F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554430,"discussion_content":"作为一名开发，我觉得老师讲的很好，我听懂了，我学下去了，最后，我对性能问题有自己的解决思路了，足矣","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646377582,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2691184,"avatar":"","nickname":"北乐","note":"","ucode":"1AFEF20588F526","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":411340,"discussion_content":"作为一名测试，我觉得老师讲的很好，我听懂了，我学下去了，最后，我对性能问题有自己的解决思路了，足矣","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635903850,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1603813,"avatar":"https://static001.geekbang.org/account/avatar/00/18/78/e5/9ded99a5.jpg","nickname":"Fine","note":"","ucode":"C4CF830EBD2BA3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377904,"discussion_content":"│Kernel address maps (/proc/{kallsyms,modules}) were restricted.   │\n                                                   │                                                                  │\n                                                   │Check /proc/sys/kernel/kptr_restrict before running &#39;perf record&#39;.│\n                                                   │                                                                  │\n                                                   │As no suitable kallsyms nor vmlinux was found, kernel samples     │\n                                                   │can&#39;t be resolved.                                                │\n                                                   │                                                                  │\n                                                   │Samples in kernel modules can&#39;t be resolved as well.              │\n                                                   │                                                        \n大佬们，这个错谁遇到过，怎么解决啊，perf report就报这个错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622957966,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2416022,"avatar":"https://static001.geekbang.org/account/avatar/00/24/dd/96/8677254c.jpg","nickname":"承","note":"","ucode":"31E425788BA852","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344108,"discussion_content":"老师讲的挺好的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611296199,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1603813,"avatar":"https://static001.geekbang.org/account/avatar/00/18/78/e5/9ded99a5.jpg","nickname":"Fine","note":"","ucode":"C4CF830EBD2BA3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306622,"discussion_content":"我微信sheteshete、可以吗，可以付费取经","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600333885,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1603813,"avatar":"https://static001.geekbang.org/account/avatar/00/18/78/e5/9ded99a5.jpg","nickname":"Fine","note":"","ucode":"C4CF830EBD2BA3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306621,"discussion_content":"大佬，能交个朋友吗？或者拜师，我是一个刚入门的，这些东西都能看懂，但是又感觉工作中肯定比这个复杂，想取经","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600333854,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47388,"user_name":"每天晒白牙","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1544140158,"is_pvip":false,"discussion_count":2,"race_medal":1,"score":"233472374142","product_id":100020901,"comment_content":"【D8打卡】<br>今天主要学习的是系统中出现了大量不可中断进程和僵尸进程的处理方法<br>现象：<br>①iowait太高，导致平均负载升高，并且达到了系统CPU的个数<br>②僵尸进程不断增多<br>分析过程：<br>1.先分析iowait升高的原因<br>一般iowait升高，可能的原因是i&#47;o问题<br>①用dstat 命令同时查看cpu和i&#47;o对比情况（如 dstat 1 10 间隔1秒输出10组数据），通过结果可以发现iowait升高时，磁盘读请求（read）升高<br>所以推断iowait升高是磁盘读导致<br>②定位磁盘读的进程，使用top命令查看处于不可中断状态（D）的进程PID<br>③查看对应进程的磁盘读写情况，使用pidstat命令，加上-d参数，可以看到i&#47;o使用情况（如 pidstat -d -p &lt;pid&gt; 1 3）,发现处于不可中断状态的进程都没有进行磁盘读写<br>④继续使用pidstat命令，但是去掉进程号，查看所有进程的i&#47;o情况（pidstat -d 1 20），可以定位到进行磁盘读写的进程。我们知道进程访问磁盘，需要使用系统调用，<br>下面的重点就是找到该进程的系统调用<br>⑤使用strace查看进程的系统调用 strace -p &lt;pid&gt;<br>发现报了 strace:attach :ptrace(PTRACE_SIZE，6028)：Operation not peritted,说没有权限，我是使用的root权限，所以这个时候就要查看进程的状态是否正常<br>⑥ps aux | grep &lt;pid&gt; 发现进程处于Z状态，已经变成了僵尸进程，所以不能进行系统调用分析了<br>⑦既然top和pidstat都不能找出问题，使用基于事件记录的动态追踪工具<br>如果是centos系统，可以使用下面的方法<br>在容器外面把分析记录保存，到容器里面查看结果<br>操作：<br>（1）在centos系统上运行 perf record -g ，执行一会儿按ctrl+c停止<br>（2）把生成的perf.data（通常文件生成在命令执行的当前目录下，当然可以通过find | grep perf.data或 find &#47; -name perf.data查看路径）文件拷贝到容器里面分析：<br>docker cp perf.data app:&#47;tpm<br>docker exec -i -t app bash<br>cd &#47;tmp&#47;<br>apt-get update &amp;&amp; apt-get install -y linux-perf linux-tools procps<br>perf_4.9 report<br>然后观察调用栈信息，检查是否有磁盘读操作，这个案例是定位到了进行磁盘的直接读，当然也可以查看源码进行验证。因为我的centos系统用老师的 iowait镜像iowait升高不明显，所以使用的是iowait-new2镜像，可以得到想要的结果，但是这个镜像把我的系统能搞崩溃，所以我只能执行到cd &#47;tmp&#47;这步，下面那部就执行不下去了。但是整个分析过程还是理解了。<br><br>2.僵尸进程<br>僵尸进程出现的原因是父进程没有回收子进程的资源出现的。解决办法是找到父进程，在父进程中处理，使用pstree查父进程，然后查看父进程的源码检查wait()&#47;waitpid()的调用或SIGCHLD信号处理函数的注册","like_count":54,"discussions":[{"author":{"id":1110706,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f2/b2/de353ede.jpg","nickname":"yYe","note":"","ucode":"62D27117CE842E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572704,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652924443,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2104708,"avatar":"https://static001.geekbang.org/account/avatar/00/20/1d/84/c35e492e.jpg","nickname":"风清扬","note":"","ucode":"0505791F8EA497","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":570716,"discussion_content":"我我感觉每次都可以直接使用perf来定位","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651888298,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47441,"user_name":"王涛","can_delete":false,"product_type":"c1","uid":1315326,"ip_address":"","ucode":"6241F08634D342","user_header":"https://static001.geekbang.org/account/avatar/00/14/11/fe/de00d8d8.jpg","comment_is_top":false,"comment_ctime":1544144371,"is_pvip":false,"replies":[{"id":"17055","content":"找出进程就可以甩锅了😊<br><br>从磁盘IO的角度来说，其实很容易找出那些进程在消耗IO资源。因为这里侧重的是CPU使用的分析，所以IO讲的不是特别深入。后续的IO部分还会有更细致的拆解。","user_name":"作者回复","comment_id":47441,"uid":"1001282","ip_address":"","utype":1,"ctime":1544278188,"user_name_real":"倪朋飞"}],"discussion_count":3,"race_medal":0,"score":"160457934323","product_id":100020901,"comment_content":"d8打卡。看完这部分，作为一名运维人员就尴尬了，当开发跟你说机器性能有问题时，这个问题就变成了甩锅问题。开发说代码没问题，你又看不懂开发的代码。。。","like_count":37,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431767,"discussion_content":"找出进程就可以甩锅了😊\n\n从磁盘IO的角度来说，其实很容易找出那些进程在消耗IO资源。因为这里侧重的是CPU使用的分析，所以IO讲的不是特别深入。后续的IO部分还会有更细致的拆解。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544278188,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2587479,"avatar":"https://static001.geekbang.org/account/avatar/00/27/7b/57/e9b3d886.jpg","nickname":"阿昌","note":"","ucode":"C7AF1905B72AD3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586893,"discussion_content":"会看代码不就完事了。运维不一定要会写，但是会看还是可以的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662596843,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2806043,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLBFkSq1oiaEMRjtyyv4ZpCI0OuaSsqs04ODm0OkZF6QhsAh3SvqhxibS2n7PLAVZE3QRSn5Hic0DyXg/132","nickname":"ddh","note":"","ucode":"8E852375365F16","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539187,"discussion_content":"在这里的是不是大部分都是运维呀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639637768,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47403,"user_name":"ninuxer","can_delete":false,"product_type":"c1","uid":1243135,"ip_address":"","ucode":"5394ADAF2667D6","user_header":"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKQMM4m7NHuicr55aRiblTSEWIYe0QqbpyHweaoAbG7j2v7UUElqqeP3Ihrm3UfDPDRb1Hv8LvPwXqA/132","comment_is_top":false,"comment_ctime":1544142268,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"83148520892","product_id":100020901,"comment_content":"打卡day9<br>在用perf展开的分析详情中，有个children和self都90%多的swapper进程，如果我看到这个，我肯定会先去围绕这个进程展开，而会忽略占用才0.6%得app进程，关于这个情况，是我理解上有什么偏差么？","like_count":19,"discussions":[{"author":{"id":1582813,"avatar":"https://static001.geekbang.org/account/avatar/00/18/26/dd/d58156b1.jpg","nickname":"一粒","note":"","ucode":"FB5F583CC6AE3C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":316226,"discussion_content":"打开 day3","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603376643,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1298046,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKZicicibGibtR5zAia782Ajc5I5BN3F3tjAdlibATIknHv67gbxeH21N7B6vbgwLjYb1miaLKhqicptB5ibYw/132","nickname":"阿飞","note":"","ucode":"F8B1FC8521264D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":273596,"discussion_content":"看share object 那一列，swapper对应着内核调用，一般情况下来说都是用户空间的调用导致的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590475738,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1110706,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f2/b2/de353ede.jpg","nickname":"yYe","note":"","ucode":"62D27117CE842E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1298046,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKZicicibGibtR5zAia782Ajc5I5BN3F3tjAdlibATIknHv67gbxeH21N7B6vbgwLjYb1miaLKhqicptB5ibYw/132","nickname":"阿飞","note":"","ucode":"F8B1FC8521264D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572708,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652924758,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":273596,"ip_address":""},"score":572708,"extra":""}]}]},{"had_liked":false,"id":47507,"user_name":"walker","can_delete":false,"product_type":"c1","uid":1324219,"ip_address":"","ucode":"FA5B2400A53730","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/bb/0b971fca.jpg","comment_is_top":false,"comment_ctime":1544148699,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"48788788955","product_id":100020901,"comment_content":"有时候直接杀死僵尸进程的时候会导致服务不可用，或是崩溃。在线上运行的服务出现僵尸进程时，怎样处理比较好呢？","like_count":11,"discussions":[{"author":{"id":1804356,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/88/44/87cc5c0f.jpg","nickname":"小学生","note":"","ucode":"0DBB26031234FB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":266563,"discussion_content":"代码的问题，没办法，如果因为僵尸进程影响业务了，只有重启业务，杀死僵尸进程。然后拿着证据甩给开发。等着下一次版本升级。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1589532994,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1160951,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b6/f7/3c3b1385.jpg","nickname":"海胆阶段","note":"","ucode":"7A8C4BB4D0CDB8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367230,"discussion_content":"应该是杀死僵尸进程的父进程，最后被init 接管回收，僵尸进程已经死了，不能kill","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618301158,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47382,"user_name":"柯锦玲(侠客行)","can_delete":false,"product_type":"c1","uid":1319040,"ip_address":"","ucode":"BFF9390B9CDB9A","user_header":"https://static001.geekbang.org/account/avatar/00/14/20/80/d61ad0cc.jpg","comment_is_top":false,"comment_ctime":1544139785,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"35903878153","product_id":100020901,"comment_content":"dock镜像等资料在哪里下载？","like_count":8,"discussions":[{"author":{"id":1263977,"avatar":"https://static001.geekbang.org/account/avatar/00/13/49/69/c0fcf4e8.jpg","nickname":"def","note":"","ucode":"39BDBEA0560C13","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362219,"discussion_content":"直接docker run 会自动去拉取镜像的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616895502,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1442431,"avatar":"https://static001.geekbang.org/account/avatar/00/16/02/7f/ddf56ac5.jpg","nickname":"runzhliu","note":"","ucode":"CD51D9465D7A05","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":118727,"discussion_content":"dockerhub","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578187754,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":230781,"user_name":"生活不如诗","can_delete":false,"product_type":"c1","uid":1139515,"ip_address":"","ucode":"FD48EABEEC52B7","user_header":"https://static001.geekbang.org/account/avatar/00/11/63/3b/c5cd68ab.jpg","comment_is_top":false,"comment_ctime":1593491304,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"31658262376","product_id":100020901,"comment_content":"当遇到iowait过高时候的解决思路：<br>1. iowait过高的原因通常是进程在等待硬件资源或者硬件故障；<br>2. 通过top查看iowait值；<br>3. 通过dstat查看磁盘的读写值来查看是否达到了磁盘瓶颈，如果不是，则排查进程问题；<br>4. 通过top找到处于D状态的进程，这种进程通常都是在等待硬件资源；<br>5. 通过pidstat -d -p pid来查看此进程的读写速度；<br>6. 如果查不到，则通过pidstat -d 1来查看是哪些进程在一直进行读写；<br>7. 找到进程之后通过strace -p pid可以动态追踪进程运行状态，如果进程是僵尸进程，则通过perf record -ga来抓取一段时间的运行情况，然后分析进程的函数调用；<br>8. 根据perf抓取到的运行状态最终定位问题；<br>僵尸进程：<br>1. 如果遇到僵尸进程，首先通过pstree -aps 僵尸进程pid来找到僵尸进程的父进程；<br>2. 通过分析父进程源码查看是否有调用wait()，close()，wiatpid()或者SIGCHLD信号等来关闭子进程，如果没有则修改源码； ","like_count":7},{"had_liked":false,"id":47519,"user_name":"乔克","can_delete":false,"product_type":"c1","uid":1315273,"ip_address":"","ucode":"28A797A4235B78","user_header":"https://static001.geekbang.org/account/avatar/00/14/11/c9/c3eae895.jpg","comment_is_top":false,"comment_ctime":1544149558,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27313953334","product_id":100020901,"comment_content":"后面那两个镜像，我不知道是不是我系统的问题，我运行iowait直接飚满了，系统直接卡死。","like_count":6},{"had_liked":false,"id":47375,"user_name":"白华","can_delete":false,"product_type":"c1","uid":1315666,"ip_address":"","ucode":"FC9BACFCA6E8C1","user_header":"https://static001.geekbang.org/account/avatar/00/14/13/52/db1b01fc.jpg","comment_is_top":false,"comment_ctime":1544138090,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"27313941866","product_id":100020901,"comment_content":"今天进行实验看来还是不会成功的，上次在你的docker hub仓库中看到了iowait镜像，试了最新的几个，在centos7虚拟机中还是不行","like_count":6,"discussions":[{"author":{"id":1438574,"avatar":"https://static001.geekbang.org/account/avatar/00/15/f3/6e/664a4d84.jpg","nickname":"游民小陌","note":"","ucode":"C9398CFBB6C963","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":307430,"discussion_content":"然后怎么做的？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600649132,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":236656,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1595492085,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"23070328565","product_id":100020901,"comment_content":"pidstat参数解释汇总：<br>* -w参数表示输出进程切换指标<br>* -u参数则表示输出CPU使用指标<br>* -d 展示 I&#47;O 统计数据<br>* -p 指定进程号<br>表格参数解释：<br>* kB_rd 表示每秒读磁盘的 KB 数<br>* kB_wr 表示每秒写磁盘的 KB<br>* iodelay 表示 I&#47;O 的延迟（单位是时钟周期）<br>* cswch ： 表示进程每秒自愿上下文切换（voluntary context switches）的次数。<br>* nvcswch ： 表示进程每秒非自愿上下文切换（non voluntary context switches）的次数","like_count":5,"discussions":[{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571140,"discussion_content":"还有-t线程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652085580,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47597,"user_name":"姜小鱼","can_delete":false,"product_type":"c1","uid":1317762,"ip_address":"","ucode":"3E2076E20289BF","user_header":"https://static001.geekbang.org/account/avatar/00/14/1b/82/69581d8a.jpg","comment_is_top":false,"comment_ctime":1544162788,"is_pvip":false,"replies":[{"id":"17049","content":"IO部分会讲的","user_name":"作者回复","comment_id":47597,"uid":"1001282","ip_address":"","utype":1,"ctime":1544257190,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"23018999268","product_id":100020901,"comment_content":"老师：iowait%生高并不能得出存在io性能的结论，还要继续看io量(dstat)和io并发等情况.那么这个io量到底达到多少才能说明存在性能瓶颈？有一个量化指标吗？期待回复，谢谢","like_count":5,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431823,"discussion_content":"IO部分会讲的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544257190,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47595,"user_name":"帆帆帆帆帆帆帆帆","can_delete":false,"product_type":"c1","uid":1304645,"ip_address":"","ucode":"0CB732FFD07463","user_header":"https://static001.geekbang.org/account/avatar/00/13/e8/45/c58cb283.jpg","comment_is_top":false,"comment_ctime":1544162365,"is_pvip":false,"replies":[{"id":"17077","content":"嗯嗯，谢谢分享","user_name":"作者回复","comment_id":47595,"uid":"1001282","ip_address":"","utype":1,"ctime":1544313014,"user_name_real":"倪朋飞"}],"discussion_count":2,"race_medal":0,"score":"23018998845","product_id":100020901,"comment_content":"@jeff，数据库一般都有自己的数据缓冲池bufferpool，在合适的时间，数据库会从磁盘读入数据到bufferpool，或者从bufferpool写出数据到磁盘。在这种情况下，再使用文件系统缓存，反而不会有性能的提升，而且数据库写出数据到磁盘的时候，必须写到了磁盘才算真的完成了数据的持久化。","like_count":5,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431822,"discussion_content":"嗯嗯，谢谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544313014,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591516,"discussion_content":"oracle有自己的缓存，但是mysql是没有的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666609771,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":195520,"user_name":"斑马Z","can_delete":false,"product_type":"c1","uid":1500262,"ip_address":"","ucode":"ABB55B4652452F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK0K9AM6xxDzVV6pF66jyus5NuuxZzT9icad8AQDMKibwUOy3UnoZIZdyKIKd9sA06rgFnIWwiakSeOQ/132","comment_is_top":false,"comment_ctime":1585193411,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18765062595","product_id":100020901,"comment_content":"<br>本文和上文的案例中在centos中实操会遇到诸多问题，说明一下我的解决方法：<br><br>1.$ docker run --privileged --name=app -itd feisky&#47;app:iowait<br><br><br>这个无法正常启动，容器状态为 Exited (1）<br>原因看其他同学评论是<br><br>centos的磁盘前缀不同，无法找到的盘，修改app.c代码<br>        const char *sd_prefix = &quot;vd&quot;;<br>        const char *xvd_prefix = &quot;vdb&quot;;<br><br>解决方法是<br><br>修改启动参数为：<br>docker run --privileged --name=app -itd feisky&#47;app:iowait &#47;app -d &#47;dev&#47;vdb1<br><br>或者是用老师新的镜像<br>docker run --privileged --name=app -itd feisky&#47;app:short-process<br><br>完成以上步骤之后run成功了，我通过操作例如pidstat、iostat、top等命令发现主要是stress这样的短时进程占用了大量I&#47;O，不是文中提到的app进程，<br>然后同样的用perf top进行实操，但是问题来了，上上节课中出现的centos系统中perf top 显示的是十六进制的进程以及函数，无法准确定位，然后又一顿操作。<br><br><br>操作：<br>（1）在centos系统上运行 perf record -g ，执行一会儿按ctrl+c停止<br>（2）把生成的perf.data（通常文件生成在命令执行的当前目录下，当然可以通过find | grep perf.data或 find &#47; -name perf.data查看路径）文件拷贝到容器里面分析：<br>docker cp perf.data feisky:&#47;tpm<br>docker exec -i -t feisky bash<br>cd &#47;tmp&#47;<br>apt-get update &amp;&amp; apt-get install -y linux-perf linux-tools procps  # 很耗时<br>perf_4.9 report<br>这样就可以看到函数名了<br>","like_count":4},{"had_liked":false,"id":226568,"user_name":"zhushenghang","can_delete":false,"product_type":"c1","uid":1994374,"ip_address":"","ucode":"712CFE335C7CE4","user_header":"https://static001.geekbang.org/account/avatar/00/1e/6e/86/c682976b.jpg","comment_is_top":false,"comment_ctime":1592143483,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"14477045371","product_id":100020901,"comment_content":"其实生产环境出现僵尸进程是很难处理的，尤其僵尸进程很多的情况下一般系统都出问题了，而且有些僵尸进程的父进程还很可能是1号进程。只能reboot解决。","like_count":3,"discussions":[{"author":{"id":1487998,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqtXSgThiaEiaEqqic5YIJ7v469nCM3VXiccOJ4SxbYjW91ciczuYYEzcTVtYWaWXaokZqShuLdKsXjnFA/132","nickname":"Geek_b85295","note":"","ucode":"51CBB577C255EA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":345509,"discussion_content":"同！僵尸进程的父进程已经是1号进程了，估计是内核是出题了，只能重启解决","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1611730364,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571142,"discussion_content":"要是生产的环境，你可以通过kill -HUP pid号把这个僵尸进程挂起来或者是kill -s SIGCHLD pid这是 看了好多别的专栏给的解决方案但是没有操作过","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652086826,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1061803,"avatar":"https://static001.geekbang.org/account/avatar/00/10/33/ab/d8ba4242.jpg","nickname":"哒哒哒","note":"","ucode":"9378AD329F8AE0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":320371,"discussion_content":"是的，我遇到的僵尸进程通常就是这种情况。不知道除了reboot，还有其他的方法吗，或者怎么排查出现这种情况的原因呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604331185,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47561,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1544155520,"is_pvip":false,"replies":[{"id":"17083","content":"嗯嗯 可以再思考一点，比如假如父进程已经是init了又该怎么办？注意init进程是不会退出的","user_name":"作者回复","comment_id":47561,"uid":"1001282","ip_address":"","utype":1,"ctime":1544314429,"user_name_real":"倪朋飞"}],"discussion_count":4,"race_medal":0,"score":"14429057408","product_id":100020901,"comment_content":"[D8打卡]<br>今天又学了两个乖, dstat可以同时看cpu和io. (上篇文章安装后只看了下效果,没想到这一层).strace可以追踪系统调用.<br>虽然我之前也写过linux c程序,但是看到sys_read&#47;new_sync_read&#47;blkdev_direct_IO确实不知道是正在对磁盘进行直接读, 即使看了代码 也不知道 O_DIRECT 这个参数就是直接读.<br>还是功力太浅,线索摆在前面也抓不住,哈哈😁.<br>----<br>有些同学问&quot;服务出现僵尸进程时，怎样处理&quot;.<br>其实我也不知道怎么处理,但是我把那个父进程杀掉, 僵尸进程就几乎没有了. <br>上一篇文章中,老师也提到过[通常，僵尸进程持续的时间都比较短，在父进程回收它的资源后就会消亡；或者在父进程退出后，由 init 进程回收后也会消亡]<br>","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431811,"discussion_content":"嗯嗯 可以再思考一点，比如假如父进程已经是init了又该怎么办？注意init进程是不会退出的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544314429,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2180789,"avatar":"https://static001.geekbang.org/account/avatar/00/21/46/b5/1eeea0c3.jpg","nickname":"小猪快跑","note":"","ucode":"7C79883DB41392","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":309991,"discussion_content":"之前就出现了一次mysql进程变成了defunct状态，而父进程是 init， 没办法，重启机器解决的","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1601555906,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571143,"discussion_content":"可以通过挂起来僵尸进程，kill -HUP pid号或者是kill -s SIGCHLD pid","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652086943,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2147220,"avatar":"https://static001.geekbang.org/account/avatar/00/20/c3/94/e89ebc50.jpg","nickname":"神毓逍遥","note":"","ucode":"83351CB18B190E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301816,"discussion_content":"那怎么办呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598669961,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":82531,"user_name":"Andy Huang","can_delete":false,"product_type":"c1","uid":1105776,"ip_address":"","ucode":"72ACB53CFDBCDA","user_header":"https://static001.geekbang.org/account/avatar/00/10/df/70/52f2ab90.jpg","comment_is_top":false,"comment_ctime":1554249366,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"10144183958","product_id":100020901,"comment_content":"不大理解iowait的线程并没有使用CPU的，也不在就绪队列。为什么却要算作是CPU的负载","like_count":2,"discussions":[{"author":{"id":1226968,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b8/d8/f81b5604.jpg","nickname":"hcyycb","note":"","ucode":"77FF6CA41F9E66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387549,"discussion_content":"历史原因，刚开始有这个指标的时候，进程即使是不可中断状态，也是很短时间内就能获得它所需的资源的，自然就进入就绪队列。所以，就把不可中断状态的进程，也计算在系统负载。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1628238831,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1543040,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/80/8702bd5f.jpg","nickname":"evan","note":"","ucode":"491B073D5AFEDE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":317483,"discussion_content":"负载包括两部分: 正在运行的进程+不可中断的进程","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1603551405,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1014615,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7b/57/18b61282.jpg","nickname":"dullduck","note":"","ucode":"25293558309704","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2710,"discussion_content":"建议复习一下第二篇，怎么理解平均负载","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1563874730,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49086,"user_name":"Apollo","can_delete":false,"product_type":"c1","uid":1183821,"ip_address":"","ucode":"3A0C79CCB21FD9","user_header":"https://static001.geekbang.org/account/avatar/00/12/10/4d/f548bc68.jpg","comment_is_top":false,"comment_ctime":1544601138,"is_pvip":false,"replies":[{"id":"17667","content":"👍","user_name":"作者回复","comment_id":49086,"uid":"1001282","ip_address":"","utype":1,"ctime":1544660729,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"10134535730","product_id":100020901,"comment_content":"性能这一块跟着老师走，算是入门了，希望后面有更高阶的教程","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432480,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544660729,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47408,"user_name":"路过","can_delete":false,"product_type":"c1","uid":1316401,"ip_address":"","ucode":"7152C19ED024CC","user_header":"https://static001.geekbang.org/account/avatar/00/14/16/31/ae8adf82.jpg","comment_is_top":false,"comment_ctime":1544142539,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10134077131","product_id":100020901,"comment_content":"用ubuntu 做实验很顺利。请问老师，曾经发生僵尸进程的父进程是1，服务器又不方便重启，如何清理这样的僵尸进程？谢谢老师！","like_count":2},{"had_liked":false,"id":253825,"user_name":"Geek_f702be","can_delete":false,"product_type":"c1","uid":1143067,"ip_address":"","ucode":"8E3B5F393C4266","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epumnXjMLYzHkGFhAraIiaAMXpotuUR9PCexBWl25tRLFAvpzs03Hfse4Y1lyeWuryz6z80Fd8AXiaw/132","comment_is_top":false,"comment_ctime":1602907549,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5897874845","product_id":100020901,"comment_content":"打卡<br>碰到iowait升高时可以用dstat、pidstat分析是不是磁盘io问题，然后在找到问题进程。<br>用strace分析系统调用关系，如果是僵尸进程则需要借助基于事件记录的动态追踪工具perf<br>僵尸进程用pstree工具找到父进程后进行分析<br>","like_count":1},{"had_liked":false,"id":140297,"user_name":"嘉木","can_delete":false,"product_type":"c1","uid":1317999,"ip_address":"","ucode":"AF4877693782C0","user_header":"https://static001.geekbang.org/account/avatar/00/14/1c/6f/3ea2a599.jpg","comment_is_top":false,"comment_ctime":1570872802,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5865840098","product_id":100020901,"comment_content":"对iowait甚是不解，然后搜了下，看到下面这段判断CPU时间的  <br>void account_system_time(struct task_struct *p, int hardirq_offset, cputime_t cputime)<br>{<br>\tstruct cpu_usage_stat *cpustat = &amp;kstat_this_cpu.cpustat;<br>\tstruct rq *rq = this_rq();&#47;&#47;在smp环境下获取当前的run queue<br>\tcputime64_t tmp;<br><br>\tp-&gt;stime = cputime_add(p-&gt;stime, cputime);<br><br>\t&#47;* Add system time to cpustat. *&#47;<br>\ttmp = cputime_to_cputime64(cputime);<br>\tif (hardirq_count() - hardirq_offset)&#47;&#47;在做硬中断<br>\t\tcpustat-&gt;irq = cputime64_add(cpustat-&gt;irq, tmp);<br>\telse if (softirq_count())&#47;&#47;在做软中断<br>\t\tcpustat-&gt;softirq = cputime64_add(cpustat-&gt;softirq, tmp);<br>\telse if (p != rq-&gt;idle)&#47;&#47;程序在正常运行，非idle<br>\t\tcpustat-&gt;system = cputime64_add(cpustat-&gt;system, tmp);<br>\telse if (atomic_read(&amp;rq-&gt;nr_iowait) &gt; 0)&#47;&#47;既不做中断，而且在idle，那么就是iowait<br>\t\tcpustat-&gt;iowait = cputime64_add(cpustat-&gt;iowait, tmp);<br>\telse<br>\t\tcpustat-&gt;idle = cputime64_add(cpustat-&gt;idle, tmp);<br>\t&#47;* Account for system time used *&#47;<br>\tacct_update_integrals(p);<br>}<br><br>所以当CPU空闲的时候，如果这个CPU上有进程在等待IO，那么就是iowait，如果没有那就是idle","like_count":1,"discussions":[{"author":{"id":1244665,"avatar":"https://static001.geekbang.org/account/avatar/00/12/fd/f9/61bdb3f8.jpg","nickname":"未来小鬼","note":"","ucode":"A0ED87F78E6319","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583919,"discussion_content":"牛x，这下明白了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660489366,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"江苏"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":118286,"user_name":"tinyfool","can_delete":false,"product_type":"c1","uid":1604827,"ip_address":"","ucode":"8B93B6A9FBEA12","user_header":"","comment_is_top":false,"comment_ctime":1564309245,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5859276541","product_id":100020901,"comment_content":"老师，有个问题请教下：cpu使用率的统计中为什么会有%iowait这一项？处于D状态的进程导致cpu使用率中%iowait这一项升高，但是处于D状态的进程实际上并未占用cpu资源？","like_count":1,"discussions":[{"author":{"id":1804356,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/88/44/87cc5c0f.jpg","nickname":"小学生","note":"","ucode":"0DBB26031234FB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":266569,"discussion_content":"iowate  是指CPU等待IO的时间，使用CPU就是使用CPU的时间片，花费了时间在上面，多以CPU使用率就上去了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589533607,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":106415,"user_name":"魏乐","can_delete":false,"product_type":"c1","uid":1233832,"ip_address":"","ucode":"B6D50018BE67E7","user_header":"https://static001.geekbang.org/account/avatar/00/12/d3/a8/91eed372.jpg","comment_is_top":false,"comment_ctime":1561293869,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5856261165","product_id":100020901,"comment_content":"1.不可中断状态睡眠进程，不是指cpu不响应中断，而是这个进程不会相应异步事件，包括中断和信号等。<br>2.不可中断睡眠进程是在睡眠状态，不占用cpu使用率的","like_count":1},{"had_liked":false,"id":64072,"user_name":"风一样的男子","can_delete":false,"product_type":"c1","uid":1357985,"ip_address":"","ucode":"F02E87D5630DAB","user_header":"","comment_is_top":false,"comment_ctime":1548659951,"is_pvip":false,"replies":[{"id":"22963","content":"执行 docker logs app看看什么错误？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548941531,"ip_address":"","comment_id":64072,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5843627247","product_id":100020901,"comment_content":"老师，我在阿里云上购买的服务器Ubuntu18.04.1，运行命令docker run --privileged --name=app -itd feisky&#47;app:iowait后，app就退出了，是什么原因呢？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437842,"discussion_content":"执行 docker logs app看看什么错误？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548941531,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571144,"discussion_content":"你必须单独在弄一块磁盘，我在阿里云就是这样操作的，别用sda的磁盘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652087007,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1016052,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/80/f4/d340dc44.jpg","nickname":"devin","note":"","ucode":"C9682026B6B1FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":42726,"discussion_content":"同样的问题，请问老哥解决了吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572762208,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50308,"user_name":"发条橙子 。","can_delete":false,"product_type":"c1","uid":1259218,"ip_address":"","ucode":"ED076F4534FFED","user_header":"https://static001.geekbang.org/account/avatar/00/13/36/d2/c7357723.jpg","comment_is_top":false,"comment_ctime":1544949040,"is_pvip":false,"replies":[{"id":"18097","content":"可能跟stress的选项有关，你的命令是什么？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545003574,"ip_address":"","comment_id":50308,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5839916336","product_id":100020901,"comment_content":"老师 ， 我这边使用 stress 来模拟 io 的请求 ， 发现 stress 的进程时而 D 时而 R 。 但是用 pidstat 、 iostat  以及 dstat 都没有看到对 磁盘有  读数据请求 和 写数据请求 。 所以这个是 stress 工具本身的问题么 ？？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432938,"discussion_content":"可能跟stress的选项有关，你的命令是什么？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545003574,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47969,"user_name":"赵强强","can_delete":false,"product_type":"c1","uid":1073596,"ip_address":"","ucode":"1B8AE07484C69A","user_header":"https://static001.geekbang.org/account/avatar/00/10/61/bc/88a905a5.jpg","comment_is_top":false,"comment_ctime":1544271560,"is_pvip":false,"replies":[{"id":"17073","content":"试试分析下线程","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544312008,"ip_address":"","comment_id":47969,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5839238856","product_id":100020901,"comment_content":"倪老师.公司一个服务调用量很大，top命令输出显示php-fpm worker进程cpu使用率很高，但是pidstat输出确找不到该进程，进程确实一直存在的，是什么原因呢","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431964,"discussion_content":"试试分析下线程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544312008,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571145,"discussion_content":"pidstat -wt 看看进程和线程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652087039,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47614,"user_name":"路过","can_delete":false,"product_type":"c1","uid":1316401,"ip_address":"","ucode":"7152C19ED024CC","user_header":"https://static001.geekbang.org/account/avatar/00/14/16/31/ae8adf82.jpg","comment_is_top":false,"comment_ctime":1544165587,"is_pvip":false,"replies":[{"id":"17014","content":"嗯嗯 了解一些编程的基本功很有帮助，特别是复杂问题的最后很可能要去分析函数调用栈等，更需要一定的编程功底。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544193706,"ip_address":"","comment_id":47614,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5839132883","product_id":100020901,"comment_content":"听课程，还会需要有点编程的功底，否则这个问题排查起来只能粗暴简单处理了。把锅丢给开发了。:)","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431832,"discussion_content":"嗯嗯 了解一些编程的基本功很有帮助，特别是复杂问题的最后很可能要去分析函数调用栈等，更需要一定的编程功底。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544193706,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47611,"user_name":"破晓","can_delete":false,"product_type":"c1","uid":1335682,"ip_address":"","ucode":"E7862668514699","user_header":"https://static001.geekbang.org/account/avatar/00/14/61/82/96e00fd6.jpg","comment_is_top":false,"comment_ctime":1544165149,"is_pvip":false,"replies":[{"id":"17060","content":"不包括，这是两个不同的指标","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544280507,"ip_address":"","comment_id":47611,"utype":1}],"discussion_count":1,"race_medal":4,"score":"5839132445","product_id":100020901,"comment_content":"老师想问下关于cpu使用率这块的概念，sytem的cpu使用率，包不包含iowait的？他们之间是什么关系？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431831,"discussion_content":"不包括，这是两个不同的指标","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544280507,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47601,"user_name":"Adam","can_delete":false,"product_type":"c1","uid":1305633,"ip_address":"","ucode":"338BA720880E4F","user_header":"https://static001.geekbang.org/account/avatar/00/13/ec/21/b0fe1bfd.jpg","comment_is_top":false,"comment_ctime":1544163835,"is_pvip":false,"replies":[{"id":"17048","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544257146,"ip_address":"","comment_id":47601,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5839131131","product_id":100020901,"comment_content":"数据库服务器，一般为了充分提高性能，可能会考虑绕过内核缓冲区，由自己在用户态空间实现并管理IO缓冲区，包括缓存机制等。即在open系统调用中增加参数选项O_DIRECT，用它打开的文件便可以绕过内核缓冲区直接访问。","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431825,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544257146,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47550,"user_name":"hsggj","can_delete":false,"product_type":"c1","uid":1312093,"ip_address":"","ucode":"EA36957C4ED800","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLRCxev73gpRIKKwjvuU2WgFKcZ1rKrGhDSZpUMzRsEgvAEZN00XscsTXp0ib1OrNkn9LgH2hYxX1w/132","comment_is_top":false,"comment_ctime":1544153423,"is_pvip":false,"replies":[{"id":"17082","content":"可以的，我们案例里面已经有一个PHP的示例，我还会在答疑中介绍Java的使用方法。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544313543,"ip_address":"","comment_id":47550,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5839120719","product_id":100020901,"comment_content":"老师，请问一下，perf除了可以检测C++之外，其他的代码如java,php的问题可以检测吗？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431805,"discussion_content":"可以的，我们案例里面已经有一个PHP的示例，我还会在答疑中介绍Java的使用方法。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544313543,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47497,"user_name":"york","can_delete":false,"product_type":"c1","uid":1318852,"ip_address":"","ucode":"EE938B81A7FC04","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epGMibYc0m7cDHMsNRBUur2NPVnlBZFXoNjWomibfjnHeAO3XRt27VaH3WNtdUX11d3uIT1ZHWCxLeg/132","comment_is_top":false,"comment_ctime":1544148216,"is_pvip":false,"replies":[{"id":"17086","content":"点击文中的链接进入github","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544315192,"ip_address":"","comment_id":47497,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5839115512","product_id":100020901,"comment_content":"案例中的app源码，怎么能看得到？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431784,"discussion_content":"点击文中的链接进入github","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544315192,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360596,"user_name":"Geek_b3b8da","can_delete":false,"product_type":"c1","uid":3065276,"ip_address":"浙江","ucode":"5461CD95B1D764","user_header":"","comment_is_top":false,"comment_ctime":1666679734,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1666679734","product_id":100020901,"comment_content":"我排查僵尸进程是先查看top，看看zombie是否显示僵尸进程，如果有我就直接用命令while true; do ps -A -ostat,ppid,pid,cmd|egrep -e &quot;^[zZ]&quot;; sleep 1; done<br>去查看，找到僵尸进程以后，通过pstree -alps|grep 僵尸进程的名字，找到谁调用了他，然后找到那个程序直接丢给开发让他们解决","like_count":0},{"had_liked":false,"id":351818,"user_name":"Geek_f93234","can_delete":false,"product_type":"c1","uid":1769504,"ip_address":"","ucode":"1E5DC903A5429E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJGXndj5N66z9BL1ic9GibZzWWgoVeWaWTL2XUnCYic7iba2kAEvN9WfjmlXELD5lqt8IJ1P023N5ZWicg/132","comment_is_top":false,"comment_ctime":1658212286,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1658212286","product_id":100020901,"comment_content":"day8打卡","like_count":0},{"had_liked":false,"id":349450,"user_name":"cm","can_delete":false,"product_type":"c1","uid":3032342,"ip_address":"","ucode":"982D0F6F10939F","user_header":"https://static001.geekbang.org/account/avatar/00/2e/45/16/d197f950.jpg","comment_is_top":false,"comment_ctime":1655974827,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1655974827","product_id":100020901,"comment_content":"app 的确在通过系统调用 sys_read() 读取数据。并且从 new_sync_read 和 blkdev_direct_IO  能看出，进程正在对磁盘进行直接读，也就是绕过了系统缓存，每个读请求都会从磁盘直接读，这就可以解释我们观察到的 iowait 升高了。<br><br>您好老师，这块不太懂，通过 new_sync_read 和 blkdev_direct_IO就可以确定进程是对硬盘直接I&#47;O么？怎么判断的？","like_count":0,"discussions":[{"author":{"id":1799168,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/74/00/4da5d547.jpg","nickname":"🐳","note":"","ucode":"3876D4E8CA2364","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577581,"discussion_content":"blkdev_direct_IO  这个是内核函数，需要对内核函数 逻辑有所了解，当看到这个函数自然明白调用逻辑，从而判断是对硬盘直接进行IO操作的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656214783,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":342734,"user_name":"conlin","can_delete":false,"product_type":"c1","uid":2645622,"ip_address":"","ucode":"346D8431019AFD","user_header":"","comment_is_top":false,"comment_ctime":1650439446,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1650439446","product_id":100020901,"comment_content":"我是的是mac虚拟机安装的，没有出现iowait 升高，是固态硬盘，是不是写入速度太快了，没有出现iowait 升高","like_count":0},{"had_liked":false,"id":339635,"user_name":"太阳与冰","can_delete":false,"product_type":"c1","uid":2742520,"ip_address":"","ucode":"C2B97279BD66C7","user_header":"https://static001.geekbang.org/account/avatar/00/29/d8/f8/a775cde7.jpg","comment_is_top":false,"comment_ctime":1648263859,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1648263859","product_id":100020901,"comment_content":"之前遇到过僵尸进程的父进程是1，这个怎么处理啊，配合dmesg内核还有一堆报错；","like_count":0,"discussions":[{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571146,"discussion_content":"可以了解一下kill -HUP挂起僵尸进程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652087112,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":318255,"user_name":"青阳","can_delete":false,"product_type":"c1","uid":2139807,"ip_address":"","ucode":"3591D366BAB0B9","user_header":"https://static001.geekbang.org/account/avatar/00/20/a6/9f/3c60fffd.jpg","comment_is_top":false,"comment_ctime":1635217116,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1635217116","product_id":100020901,"comment_content":"老师，按照文章中的例子io太高，敲命令都没有反应了怎么办","like_count":0},{"had_liked":false,"id":318047,"user_name":"谢龙","can_delete":false,"product_type":"c1","uid":1740156,"ip_address":"","ucode":"C4091937839596","user_header":"https://static001.geekbang.org/account/avatar/00/1a/8d/7c/04e0e83a.jpg","comment_is_top":false,"comment_ctime":1635131887,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1635131887","product_id":100020901,"comment_content":"Ubuntu 20.10 的perf 工具查看 不了 进程调用关系啊？有遇到没啊","like_count":0},{"had_liked":false,"id":310027,"user_name":"Geek_951841","can_delete":false,"product_type":"c1","uid":1592165,"ip_address":"","ucode":"18A54D42C76866","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLs8SZLLWjyib2Y48iaKVM2CZK6eR17Tp8sJujR1JicfL0icLUzb7sJd1sXYfE8dQAiczHh7NjtLgjjz8g/132","comment_is_top":false,"comment_ctime":1630462128,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630462128","product_id":100020901,"comment_content":"提个建议，希望作者可以讲解一下系统自有的命令，因为在很多生产环境下没条件安装一些外部命令用来分析。","like_count":0},{"had_liked":false,"id":290820,"user_name":"夏天","can_delete":false,"product_type":"c1","uid":2542376,"ip_address":"","ucode":"5F224DDAC94DFF","user_header":"https://static001.geekbang.org/account/avatar/00/26/cb/28/21a8a29e.jpg","comment_is_top":false,"comment_ctime":1619768957,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1619768957","product_id":100020901,"comment_content":"总结一下。这两小节我们主要关注不可中断进程和僵尸进程。<br>man ps 看下它们的定义<br>D    uninterruptible sleep (usually IO)<br>Z    defunct (&quot;zombie&quot;) process, terminated but not reaped by its parent<br><br>系统出现大量不可中断进程。通常是 IO 引起。<br>通过 top&#47;ps 来看总体的机器和进程的状态。<br>通过 iostat&#47;dstat 来看系统总体的 IO 情况。<br>pidstat 来定位到某一个进程问题。<br>strace&#47;perf 来定位到函数级别。<br><br>如果出现大量僵尸问题。一般是代码 bug 导致父进程没有回收子进程。<br>pstree 找出父进程。","like_count":0},{"had_liked":false,"id":286924,"user_name":"谨兮谨兮","can_delete":false,"product_type":"c1","uid":1376885,"ip_address":"","ucode":"55712DD3852169","user_header":"https://static001.geekbang.org/account/avatar/00/15/02/75/2839c0bb.jpg","comment_is_top":false,"comment_ctime":1617684245,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1617684245","product_id":100020901,"comment_content":"perf record -g 为什么没用","like_count":0,"discussions":[{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571147,"discussion_content":"perf record -g -F 99试试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652087142,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":270953,"user_name":"玖月","can_delete":false,"product_type":"c1","uid":2367247,"ip_address":"","ucode":"427737A95CAE0C","user_header":"https://static001.geekbang.org/account/avatar/00/24/1f/0f/4fe3788e.jpg","comment_is_top":false,"comment_ctime":1609328460,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609328460","product_id":100020901,"comment_content":"每次开完朋飞老师文章，刷新我对Linux的认知，感觉大脑不够用，哈哈哈😄😄😄","like_count":0},{"had_liked":false,"id":258252,"user_name":"Geek_f2199f","can_delete":false,"product_type":"c1","uid":2187800,"ip_address":"","ucode":"9D4E80327B0779","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eor3yhoBAvuFADgenib7HYWNEibImD4o7uPfsxicicic3GBzp2MDib6E560DpSMIw2Sl9b4UOglzQicdAoEw/132","comment_is_top":false,"comment_ctime":1604361715,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1604361715","product_id":100020901,"comment_content":"那么出现僵尸进程只能重启了吗？","like_count":0,"discussions":[{"author":{"id":1009527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/77/c1310aad.jpg","nickname":"剑衣清风","note":"","ucode":"470CD81F6612F4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336760,"discussion_content":"可以 kill 掉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608693147,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":255609,"user_name":"一粒","can_delete":false,"product_type":"c1","uid":1582813,"ip_address":"","ucode":"FB5F583CC6AE3C","user_header":"https://static001.geekbang.org/account/avatar/00/18/26/dd/d58156b1.jpg","comment_is_top":false,"comment_ctime":1603378648,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1603378648","product_id":100020901,"comment_content":"还需要结合操作系统知识好好消化一下","like_count":0},{"had_liked":false,"id":255606,"user_name":"一粒","can_delete":false,"product_type":"c1","uid":1582813,"ip_address":"","ucode":"FB5F583CC6AE3C","user_header":"https://static001.geekbang.org/account/avatar/00/18/26/dd/d58156b1.jpg","comment_is_top":false,"comment_ctime":1603378111,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1603378111","product_id":100020901,"comment_content":"需要一整块时间把案例都执行一遍","like_count":0},{"had_liked":false,"id":254559,"user_name":"14155084066","can_delete":false,"product_type":"c1","uid":2245375,"ip_address":"","ucode":"EF5BFE8773578C","user_header":"https://static001.geekbang.org/account/avatar/00/22/42/ff/2a067d5d.jpg","comment_is_top":false,"comment_ctime":1603130909,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603130909","product_id":100020901,"comment_content":"还是perf好用","like_count":0},{"had_liked":false,"id":237942,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1596010454,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596010454","product_id":100020901,"comment_content":"strace -p 34035<br>strace: Process 34035 attached<br>futex(0x7faa4586d9d0, FUTEX_WAIT, 34037, NULL<br>-------------------<br>strace除了输出以上信息就没反应了。。<br>","like_count":0},{"had_liked":false,"id":237310,"user_name":"久伴你◆◇ヽ逍遥风ぁ","can_delete":false,"product_type":"c1","uid":2062771,"ip_address":"","ucode":"E6AE1EA4798FD7","user_header":"https://static001.geekbang.org/account/avatar/00/1f/79/b3/0ed5741a.jpg","comment_is_top":false,"comment_ctime":1595776416,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595776416","product_id":100020901,"comment_content":"想请教一下    我们这个当前系统的io读写较大  有什么工具能检查出或者观察出    当前的这个io速率是否已经达到了瓶颈？ 然后需要升级配置什么的","like_count":0},{"had_liked":false,"id":230782,"user_name":"生活不如诗","can_delete":false,"product_type":"c1","uid":1139515,"ip_address":"","ucode":"FD48EABEEC52B7","user_header":"https://static001.geekbang.org/account/avatar/00/11/63/3b/c5cd68ab.jpg","comment_is_top":false,"comment_ctime":1593491363,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593491363","product_id":100020901,"comment_content":"出现iowait过高的时候并不一定是磁盘性能瓶颈，此时先通过dstat等分析磁盘读写是否达到瓶颈，然后再定位是磁盘性能问题还是程序代码问题；之后再进行问题定位。","like_count":0},{"had_liked":false,"id":226549,"user_name":"runzexia","can_delete":false,"product_type":"c1","uid":2038259,"ip_address":"","ucode":"E91B1064FF6B68","user_header":"https://static001.geekbang.org/account/avatar/00/1f/19/f3/f015a5ea.jpg","comment_is_top":false,"comment_ctime":1592138261,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592138261","product_id":100020901,"comment_content":"公司在使用容器环境，我们没有权限访问主机。<br>perf在容器上因为安全策略被禁止使用。<br>大家有没有可替代的工具呢","like_count":0},{"had_liked":false,"id":224558,"user_name":"陈靖","can_delete":false,"product_type":"c1","uid":1147418,"ip_address":"","ucode":"8C9596A54DB5C8","user_header":"https://static001.geekbang.org/account/avatar/00/11/82/1a/64ec25ff.jpg","comment_is_top":false,"comment_ctime":1591442695,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1591442695","product_id":100020901,"comment_content":"快速查看僵尸进程<br>ps -eo pid,stat,args | awk &#39;$2~&#47;^Z&#47; { print }&#39;","like_count":0,"discussions":[{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571148,"discussion_content":"ps -A -ostat,ppid,pid,cmd|egrep &#34;[zZ]&#34;","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652087215,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":209246,"user_name":"kyra","can_delete":false,"product_type":"c1","uid":1241673,"ip_address":"","ucode":"26918E763F1D9A","user_header":"https://static001.geekbang.org/account/avatar/00/12/f2/49/43f222e4.jpg","comment_is_top":false,"comment_ctime":1587523236,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587523236","product_id":100020901,"comment_content":"下载了老师提供的镜像，运行iowait镜像容器，不会导致io升高，只有僵尸进程，但是运行iowait-fix1会出现文章里面iowait应该出现的现象，io升高，不可中断进程等，所以是不是镜像名标识错误了？","like_count":0},{"had_liked":false,"id":208760,"user_name":"Acter","can_delete":false,"product_type":"c1","uid":1082561,"ip_address":"","ucode":"EF747BEAD2A797","user_header":"https://static001.geekbang.org/account/avatar/00/10/84/c1/dfcad82a.jpg","comment_is_top":false,"comment_ctime":1587433360,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1587433360","product_id":100020901,"comment_content":"“当系统中只有 I&#47;O 类型的进程在运行时，iowait 也会很高，但实际上，磁盘的读写远没有达到性能瓶颈的程度”<br>这里可以理解是cpu处理能力到了瓶颈？","like_count":0,"discussions":[{"author":{"id":1226968,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b8/d8/f81b5604.jpg","nickname":"hcyycb","note":"","ucode":"77FF6CA41F9E66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391095,"discussion_content":"不是的。在 Linux 里，%iowait 的定义是：Percentage of time that the CPU or CPUs were idle during which the system had an outstanding disk I/O request.\n\n也就是说，出现 iowait 的前提是 CPU 处于空闲状态，并且有还未完成的 IO 请求，有进程因此在等待。\n\n假设1，CPU 繁忙、此时系统有 IO 处理，CPU 空闲、IO 处理也同时完毕，这种情况，iowait 是 0%.\n假设2，CPU 繁忙、此时系统没有 IO 处理，CPU 空闲、IO处理到达。这种情况，iowait 就变成了 50%.\n\n所以，不能根据一个 iowait 升高，就判断系统的CPU 处理能力或者磁盘有性能瓶颈了，还要结合其他指标判断。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630294337,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":197194,"user_name":"八台上","can_delete":false,"product_type":"c1","uid":1391143,"ip_address":"","ucode":"FB3D74B522C720","user_header":"https://static001.geekbang.org/account/avatar/00/15/3a/27/5d218272.jpg","comment_is_top":false,"comment_ctime":1585362706,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585362706","product_id":100020901,"comment_content":"想问一下为什么  strace 之后，就变成僵尸进程了呢","like_count":0},{"had_liked":false,"id":185050,"user_name":"影虫","can_delete":false,"product_type":"c1","uid":1897097,"ip_address":"","ucode":"A0BD3C13373786","user_header":"https://static001.geekbang.org/account/avatar/00/1c/f2/89/2d2df078.jpg","comment_is_top":false,"comment_ctime":1583471926,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583471926","product_id":100020901,"comment_content":"老师您好，我运行docker run 那个命令的时候，有时可以成功，有时直接断了。是不是网络问题","like_count":0},{"had_liked":false,"id":183075,"user_name":"宋胖胖","can_delete":false,"product_type":"c1","uid":1857496,"ip_address":"","ucode":"AA828F49CCEABA","user_header":"https://static001.geekbang.org/account/avatar/00/1c/57/d8/e9c8b923.jpg","comment_is_top":false,"comment_ctime":1582948848,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582948848","product_id":100020901,"comment_content":"命令都不能正常使用：pstree   -aps  2044 和  perf record -g   。和我的版本有关吗？<br> pstree -V<br>pstree (PSmisc) 22.6<br>版权所有 © 1993-2005 Werner Almesberger 和 Craig Small<br><br>PSmisc 无任何保证。<br>该程序为自由软件，欢迎你在 GNU 通用公共许可证(GPL) 下重新发布。<br>详情可参阅 COPYING 文件。<br># perf --version<br>perf version 2.6.32-754.27.1.el6.x86_64.debug<br>","like_count":0},{"had_liked":false,"id":183071,"user_name":"宋胖胖","can_delete":false,"product_type":"c1","uid":1857496,"ip_address":"","ucode":"AA828F49CCEABA","user_header":"https://static001.geekbang.org/account/avatar/00/1c/57/d8/e9c8b923.jpg","comment_is_top":false,"comment_ctime":1582948401,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582948401","product_id":100020901,"comment_content":"打卡，，僵尸进程（Z 状态） zombie,   &gt;perf record -g   命令不好用呢","like_count":0},{"had_liked":false,"id":180408,"user_name":"罗辑思维","can_delete":false,"product_type":"c1","uid":1318941,"ip_address":"","ucode":"D257A06EDE928E","user_header":"https://static001.geekbang.org/account/avatar/00/14/20/1d/0c1a184c.jpg","comment_is_top":false,"comment_ctime":1582275444,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1582275444","product_id":100020901,"comment_content":"实验做到$ pidstat -d 1 20，没有任何IO读写，机器就卡住了，无法重启机器，要强制关机才行。<br>16时45分29秒   UID       PID   kB_rd&#47;s   kB_wr&#47;s kB_ccwr&#47;s iodelay  Command<br>16时45分30秒     0       268     -1.00     -1.00     -1.00       3  jbd2&#47;dm-0-8<br>16时45分30秒     0       314     -1.00     -1.00     -1.00      15  systemd-journal<br>16时45分30秒     0      5465     -1.00     -1.00     -1.00      41  app<br>16时45分30秒     0      5472     -1.00     -1.00     -1.00     599  app<br>16时45分30秒     0      5474     -1.00     -1.00     -1.00     602  app<br>16时45分30秒     0      5475     -1.00     -1.00     -1.00      92  app<br>16时45分30秒     0      5478     -1.00     -1.00     -1.00     561  app<br>16时45分30秒     0      5481     -1.00     -1.00     -1.00     121  app<br>16时45分30秒     0      5482     -1.00     -1.00     -1.00     560  app<br>16时45分30秒     0      5483     -1.00     -1.00     -1.00     570  app<br>16时45分30秒     0      5487     -1.00     -1.00     -1.00     662  app<br>16时45分30秒     0      5492     -1.00     -1.00     -1.00     157  app<br>16时45分30秒     0      5541     -1.00     -1.00     -1.00      39  app<br>16时45分30秒     0      5542     -1.00     -1.00     -1.00     605  app<br>16时45分30秒     0      5559     -1.00     -1.00     -1.00     566  app<br>16时45分30秒     0      5591     -1.00     -1.00     -1.00     540  app<br>16时45分30秒     0      5593     -1.00     -1.00     -1.00     555  app<br>16时45分30秒     0      5595     -1.00     -1.00     -1.00     116  app<br>","like_count":0,"discussions":[{"author":{"id":1318941,"avatar":"https://static001.geekbang.org/account/avatar/00/14/20/1d/0c1a184c.jpg","nickname":"罗辑思维","note":"","ucode":"D257A06EDE928E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":180941,"discussion_content":"1 命令打错是dstat -d 1 20，不是pidstat -d 1 20\n2 后来用iotop命令可以看到io了；系统卡：执行docker stop app又恢复正常了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582322976,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":172360,"user_name":"风羽星泉","can_delete":false,"product_type":"c1","uid":1198377,"ip_address":"","ucode":"CBC63AA00C5D70","user_header":"https://static001.geekbang.org/account/avatar/00/12/49/29/bbeccb9f.jpg","comment_is_top":false,"comment_ctime":1579160597,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1579160597","product_id":100020901,"comment_content":"老师，弱弱地问个问题。在父进程里捕获了SIGCHILD信号之后，还需要调用wait()或者 waitpid()函数吗？","like_count":0,"discussions":[{"author":{"id":1188710,"avatar":"https://static001.geekbang.org/account/avatar/00/12/23/66/413c0bb5.jpg","nickname":"LDxy","note":"","ucode":"956432CE7B7761","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293947,"discussion_content":"不需要了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595736520,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":172271,"user_name":"。。。","can_delete":false,"product_type":"c1","uid":1803113,"ip_address":"","ucode":"F97D05D81A5803","user_header":"https://static001.geekbang.org/account/avatar/00/1b/83/69/a9201594.jpg","comment_is_top":false,"comment_ctime":1579143457,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579143457","product_id":100020901,"comment_content":"收益良多","like_count":0},{"had_liked":false,"id":172191,"user_name":"笑","can_delete":false,"product_type":"c1","uid":1741098,"ip_address":"","ucode":"689A435818403A","user_header":"https://static001.geekbang.org/account/avatar/00/1a/91/2a/c0fb21fa.jpg","comment_is_top":false,"comment_ctime":1579106439,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579106439","product_id":100020901,"comment_content":"补打卡，Day 7，碰到 iowait 升高时，需要先用 dstat、pidstat 等工具，确认是不是磁盘 I&#47;O 的问题，然后再找是哪些进程导致了 I&#47;O，然后用 ps 命令找到 D 状态的进程，再用 strace 直接分析这个进程的系统调用或者用 perf 工具来分析系统的 CPU 时钟事件。僵尸进程的问题，使用 pstree 找出父进程后，去查看父进程的代码，检查 wait() &#47; waitpid() 的调用，或是 SIGCHLD 信号处理函数的注册。","like_count":0},{"had_liked":false,"id":172048,"user_name":"刘友淙","can_delete":false,"product_type":"c1","uid":1620058,"ip_address":"","ucode":"97F3A69A308313","user_header":"","comment_is_top":false,"comment_ctime":1579078588,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579078588","product_id":100020901,"comment_content":"D6 打卡","like_count":0},{"had_liked":false,"id":166781,"user_name":"花晨少年","can_delete":false,"product_type":"c1","uid":1098987,"ip_address":"","ucode":"6AA3537A6BA10E","user_header":"https://static001.geekbang.org/account/avatar/00/10/c4/eb/2285a345.jpg","comment_is_top":false,"comment_ctime":1577593792,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577593792","product_id":100020901,"comment_content":"<br>我们发现iowait特别高，而且发现会有很多处于d状态(不可中断)，但是这个状态的进程并会变成僵尸进程而无法追踪，所以使用perf top发现这类进程使用io方式是直接io<br>这篇文章和上篇文章从标题到文中一直在讨论不可中断，但是这个案例并没有直接说明不可中断是裸io导致的，因为最终的落脚点绕过了对不可中断进程的排查，没有继续讲直接io为什么会导致这么多的不可中断进程。<br>我的理解是直接io导致 io性能直线下降，导致进程响应速度变慢，所以不可中断状态会持续时间加长，不知道这样理解是否正确，请老师帮忙解答。","like_count":0},{"had_liked":false,"id":160770,"user_name":"王圣军","can_delete":false,"product_type":"c1","uid":1395602,"ip_address":"","ucode":"1E13CF683137D1","user_header":"https://static001.geekbang.org/account/avatar/00/15/4b/92/03338a22.jpg","comment_is_top":false,"comment_ctime":1576030992,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576030992","product_id":100020901,"comment_content":"我这边测试用的是centos，使用perf导出后的看不到具体函数，都是16进制字符串，这个什么原因啊","like_count":0},{"had_liked":false,"id":150836,"user_name":"Shane","can_delete":false,"product_type":"c1","uid":1291344,"ip_address":"","ucode":"322D0A883BAF16","user_header":"https://static001.geekbang.org/account/avatar/00/13/b4/50/c5dad2dc.jpg","comment_is_top":false,"comment_ctime":1573615122,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573615122","product_id":100020901,"comment_content":"老师，为什么没有进程等待IO的耗时统计呢？","like_count":0},{"had_liked":false,"id":143602,"user_name":"耿长学","can_delete":false,"product_type":"c1","uid":1309948,"ip_address":"","ucode":"C7A262812854D4","user_header":"https://static001.geekbang.org/account/avatar/00/13/fc/fc/1e235814.jpg","comment_is_top":false,"comment_ctime":1571741957,"is_pvip":false,"replies":[{"id":"55577","content":"可能是设置的方法不对，比如ulimit命令只对shell及该shell启动的进程有效","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1571839841,"ip_address":"","comment_id":143602,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1571741957","product_id":100020901,"comment_content":"您好，倪老师，问下为什么我将最大进程数设置为500，测试僵尸进程影响最大进程数，但是僵尸进程的数量超过500了，这个是为什么呢？如下：<br># ulimit -a<br>core file size          (blocks, -c) 0<br>data seg size           (kbytes, -d) unlimited<br>scheduling priority             (-e) 0<br>file size               (blocks, -f) unlimited<br>pending signals                 (-i) 14556<br>max locked memory       (kbytes, -l) 64<br>max memory size         (kbytes, -m) unlimited<br>open files                      (-n) 500<br>pipe size            (512 bytes, -p) 8<br>POSIX message queues     (bytes, -q) 819200<br>real-time priority              (-r) 0<br>stack size              (kbytes, -s) 8192<br>cpu time               (seconds, -t) unlimited<br>max user processes              (-u) 500<br>virtual memory          (kbytes, -v) unlimited<br>file locks                      (-x) unlimited<br>top观察的输出：<br># top<br>top - 18:58:26 up 16 min,  3 users,  load average: 0.07, 0.04, 0.00<br>Tasks: 903 total,   2 running,  96 sleeping,   0 stopped, 746 zombie<br>%Cpu(s):  0.0 us,  0.5 sy,  0.0 ni, 99.5 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br>KiB Mem :  3753096 total,  3036368 free,   205036 used,   511692 buff&#47;cache<br>KiB Swap:  2097148 total,  2097148 free,        0 used.  3240780 avail Mem <br><br>   PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                        <br> 10526 root      20   0  162784   5300   3816 R   1.0  0.1   0:06.56 top                                                            <br> 10024 root      20   0  838280  45480  28864 S   0.3  1.2   0:02.29 dockerd-current                                                <br> 10030 root      20   0  533276  17116   8068 S   0.3  0.5   0:01.59 docker-containe                                                <br> 11317 root      20   0       0      0      0 I   0.3  0.0   0:00.05 kworker&#47;0:1-eve                                                                                          <br>     ","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471616,"discussion_content":"可能是设置的方法不对，比如ulimit命令只对shell及该shell启动的进程有效","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571839841,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1309948,"avatar":"https://static001.geekbang.org/account/avatar/00/13/fc/fc/1e235814.jpg","nickname":"耿长学","note":"","ucode":"C7A262812854D4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":41992,"discussion_content":"老师，进程启用的子进程不占用ulimt的进程号吗？启动子进程的pid数量有限制吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572567868,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128533,"user_name":"刘德聪","can_delete":false,"product_type":"c1","uid":1316662,"ip_address":"","ucode":"2968605D077072","user_header":"https://static001.geekbang.org/account/avatar/00/14/17/36/3d8e86e6.jpg","comment_is_top":false,"comment_ctime":1566897020,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1566897020","product_id":100020901,"comment_content":"老师，你好。有个问题请教。<br>当我使用dstat查看I&#47;O情况。 输出如下。<br>You did not select any stats, using -cdngy by default.<br>----total-cpu-usage---- -dsk&#47;total- -net&#47;total- ---paging-- ---system--<br>usr sys idl wai hiq siq| read  writ| recv  send|  in   out | int   csw <br>  1   3  67  29   0   0|  28M  103k|   0     0 |   0     0 | 487   716 <br>  0   1   0  99   0   0|  91M    0 | 270B   11k|   0     0 | 340   254 <br>  0   0   0  99   0   0| 111M    0 | 180B  214B|   0     0 | 342   233 <br>  0   1   0  99   0   0| 121M    0 | 120B  214B|   0     0 | 413   358 <br>  0   1   0  99   0   0| 129M   44k| 120B   11k|   0     0 | 405   362 <br>  0   1   0  99   0   0| 101M    0 | 150B  304B|   0     0 | 514   507 <br>  0   1   0  99   0   0| 117M    0 | 180B  214B|   0     0 | 357   244 <br>  0   1   0  99   0   0| 124M    0 | 180B 3266B|   0     0 | 351   236 <br>  0   1   0  99   0   0| 116M    0 |  60B  214B|   0     0 | 414   374 <br>  0   0   0 100   0   0| 104M    0 |  60B  214B|   0     0 | 323   233 <br>  0   1   0  99   0   0| 118M    0 | 180B   11k|   0     0 | 405   376 <br>但是当我使用 pidstat -d 1 20寻找IO高的进程的时候。输出数据基本都是-1.<br>Average:      UID       PID   kB_rd&#47;s   kB_wr&#47;s kB_ccwr&#47;s iodelay  Command<br>Average:        0         1     -1.00     -1.00     -1.00      95  systemd<br>Average:        0        55     -1.00     -1.00     -1.00       3  kswapd0<br>Average:        0       356     -1.00     -1.00     -1.00       5  jbd2&#47;sda1-8<br>Average:        0       390     -1.00     -1.00     -1.00      42  systemd-journal<br>Average:        0       416     -1.00     -1.00     -1.00       8  systemd-udevd<br>Average:        0       489     -1.00     -1.00     -1.00      42  loop13<br>Average:        0      1183     -1.00     -1.00     -1.00       9  systemd-logind<br>Average:      111      1204     -1.00     -1.00     -1.00      71  avahi-daemon<br>Average:        0      1208     -1.00     -1.00     -1.00       5  cron<br><br>请问老师，数据怎么都是-1， 是都溢出了吗？","like_count":0,"discussions":[{"author":{"id":1099881,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c8/69/ce605c29.jpg","nickname":"轶","note":"","ucode":"FA0483DF79E37D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":8404,"discussion_content":"Only root can access disk statistics for processes that they do not own. Try to execute pidstat with sudo.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567997284,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127110,"user_name":"NoBody","can_delete":false,"product_type":"c1","uid":1173766,"ip_address":"","ucode":"72E1B4FCDA2469","user_header":"https://static001.geekbang.org/account/avatar/00/11/e9/06/038a9cea.jpg","comment_is_top":false,"comment_ctime":1566556176,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566556176","product_id":100020901,"comment_content":"好强。。。。","like_count":0},{"had_liked":false,"id":126458,"user_name":"顺利","can_delete":false,"product_type":"c1","uid":1618652,"ip_address":"","ucode":"C904941C8BA6DA","user_header":"https://static001.geekbang.org/account/avatar/00/18/b2/dc/67e0e985.jpg","comment_is_top":false,"comment_ctime":1566388290,"is_pvip":false,"replies":[{"id":"47212","content":"请参考14答疑篇","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1566743781,"ip_address":"","comment_id":126458,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1566388290","product_id":100020901,"comment_content":"perf record分析出全部是十六进制，有没有很详细的解决办法，前面有一篇同学说的解决办法不是很详细。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463997,"discussion_content":"请参考14答疑篇","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566743781,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104784,"user_name":"Butter Fly","can_delete":false,"product_type":"c1","uid":1564473,"ip_address":"","ucode":"D2B488B465FC3C","user_header":"https://static001.geekbang.org/account/avatar/00/17/df/39/6ead11bc.jpg","comment_is_top":false,"comment_ctime":1560836807,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560836807","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":98488,"user_name":"林贻民","can_delete":false,"product_type":"c1","uid":1202213,"ip_address":"","ucode":"F7185C61CAE4D0","user_header":"https://static001.geekbang.org/account/avatar/00/12/58/25/2088864b.jpg","comment_is_top":false,"comment_ctime":1559010277,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559010277","product_id":100020901,"comment_content":"看了一下https:&#47;&#47;github.com&#47;linyimin-bupt&#47;linux-perf-examples&#47;blob&#47;master&#47;high-iowait-process&#47;app.c的代码，是不是选择的文件大小小于20 × 64 × 1024 × 1024, 子进程是不是会一直处于sub_process的while循环中，不会结束？","like_count":0},{"had_liked":false,"id":92032,"user_name":"胖","can_delete":false,"product_type":"c1","uid":1044068,"ip_address":"","ucode":"0EA8F5343CB4F4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ee/64/2646f6ef.jpg","comment_is_top":false,"comment_ctime":1557158490,"is_pvip":false,"replies":[{"id":"33114","content":"生产环境常见的指标都可以通过监控系统获取","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1557324722,"ip_address":"","comment_id":92032,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1557158490","product_id":100020901,"comment_content":"生产环境不给root权限也不给装性能分析工具，开发只给日志的可读权限，甚至只允许将日志拷贝到本地分析，遇到这些类似的性能问题就很尴尬了","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":449124,"discussion_content":"生产环境常见的指标都可以通过监控系统获取","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557324722,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91000,"user_name":"聰","can_delete":false,"product_type":"c1","uid":1517268,"ip_address":"","ucode":"F65760FDD31CEB","user_header":"https://static001.geekbang.org/account/avatar/00/17/26/d4/add17f35.jpg","comment_is_top":false,"comment_ctime":1556780964,"is_pvip":false,"replies":[{"id":"33123","content":"在Github上有所有案例的源码：github.com&#47;feiskyer&#47;linux-perf-examples","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1557325778,"ip_address":"","comment_id":91000,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1556780964","product_id":100020901,"comment_content":"想修改app.c ，然后docker commit 一个新的镜像。但进入容器后，找不到app.c文件，只有一个二进制文件app ,请问老师怎么修改呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448758,"discussion_content":"在Github上有所有案例的源码：github.com/feiskyer/linux-perf-examples","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557325778,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89175,"user_name":"manatee","can_delete":false,"product_type":"c1","uid":1041112,"ip_address":"","ucode":"708D90E7A265BD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e2/d8/f0562ede.jpg","comment_is_top":false,"comment_ctime":1556098171,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556098171","product_id":100020901,"comment_content":"迟到打卡","like_count":0},{"had_liked":false,"id":88801,"user_name":"大坏狐狸","can_delete":false,"product_type":"c1","uid":1325678,"ip_address":"","ucode":"5044F89A505C5B","user_header":"https://static001.geekbang.org/account/avatar/00/14/3a/6e/e39e90ca.jpg","comment_is_top":false,"comment_ctime":1556003549,"is_pvip":false,"replies":[{"id":"31953","content":"可以在父进程中SIGCHLD信号","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1556113347,"ip_address":"","comment_id":88801,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1556003549","product_id":100020901,"comment_content":"老师 如果一个系统里面出现了几个僵尸进程，除了kill掉这个进程的父进程之外，还有什么好方法么？不重启进程。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447907,"discussion_content":"可以在父进程中SIGCHLD信号","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556113347,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":82142,"user_name":"窝边草","can_delete":false,"product_type":"c1","uid":1474664,"ip_address":"","ucode":"C76ACBDAE2EE22","user_header":"https://static001.geekbang.org/account/avatar/00/16/80/68/17806503.jpg","comment_is_top":false,"comment_ctime":1554130408,"is_pvip":false,"replies":[{"id":"29835","content":"嗯嗯，最好是了解应用的工作原理","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1554209843,"ip_address":"","comment_id":82142,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1554130408","product_id":100020901,"comment_content":"看到这一节就开始感觉到了，运维工作如果不能看懂开发的代码就很难深入下去，很多时候知道是开发代码有问题，但是不懂代码就没法明确的指出问题。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445484,"discussion_content":"嗯嗯，最好是了解应用的工作原理","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554209843,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":73017,"user_name":"AceslupK","can_delete":false,"product_type":"c1","uid":1284474,"ip_address":"","ucode":"048F84D019CBBB","user_header":"https://static001.geekbang.org/account/avatar/00/13/99/7a/558666a5.jpg","comment_is_top":false,"comment_ctime":1551777868,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551777868","product_id":100020901,"comment_content":"嗯，先找到哪些进程在导致不可中断，代码虽然看不懂，但应该也是个里程碑。","like_count":0},{"had_liked":false,"id":71704,"user_name":"tianyitang","can_delete":false,"product_type":"c1","uid":1440036,"ip_address":"","ucode":"1B7BEBD49E277B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIcgKLQZibvbXn8iaPCibDAtKaOhRxDIcxCaclUaG4mxJ9377noTib9RE8VBakCvicQ8VEHkvfE0UbgCAQ/132","comment_is_top":false,"comment_ctime":1551418459,"is_pvip":false,"replies":[{"id":"26314","content":"什么错误？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551704474,"ip_address":"","comment_id":71704,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551418459","product_id":100020901,"comment_content":"老师：<br>运行 perf top ，提示打开老师的测试案例 app 失败","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441285,"discussion_content":"什么错误？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551704474,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":71669,"user_name":"信","can_delete":false,"product_type":"c1","uid":1402598,"ip_address":"","ucode":"7DA2AA0BEFE4AF","user_header":"https://static001.geekbang.org/account/avatar/00/15/66/e6/684026e3.jpg","comment_is_top":false,"comment_ctime":1551409314,"is_pvip":false,"replies":[{"id":"26310","content":"除了 strace 之外，还有很多内核级的工具，比如 perf、systemtap、bcc-tools 等都可以试试。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551703775,"ip_address":"","comment_id":71669,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551409314","product_id":100020901,"comment_content":"老师，我在使用strace命令 查看java 进程的时候，出现futex_wait，然后没别的输出了？像java 这种想分析内核调用情况的工具还有哪些推荐呢","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441267,"discussion_content":"除了 strace 之外，还有很多内核级的工具，比如 perf、systemtap、bcc-tools 等都可以试试。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551703775,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70353,"user_name":"平安喜乐","can_delete":false,"product_type":"c1","uid":1102350,"ip_address":"","ucode":"B97D8944B0B035","user_header":"https://static001.geekbang.org/account/avatar/00/10/d2/0e/26bf35a4.jpg","comment_is_top":false,"comment_ctime":1551083116,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551083116","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":67743,"user_name":"管清麟","can_delete":false,"product_type":"c1","uid":1198013,"ip_address":"","ucode":"7CA1651D0DE257","user_header":"https://static001.geekbang.org/account/avatar/00/12/47/bd/5c34df95.jpg","comment_is_top":false,"comment_ctime":1550238732,"is_pvip":false,"replies":[{"id":"24046","content":"这跟开源不开源没关系，僵尸进程是已经停止的进程，不会响应kill","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550326352,"ip_address":"","comment_id":67743,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550238732","product_id":100020901,"comment_content":"如果是开源软件造成的僵尸进程，使用kill方法可以吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439353,"discussion_content":"这跟开源不开源没关系，僵尸进程是已经停止的进程，不会响应kill","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550326352,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62911,"user_name":"keyboard_chen_-","can_delete":false,"product_type":"c1","uid":1012204,"ip_address":"","ucode":"E95757BEAF5573","user_header":"https://static001.geekbang.org/account/avatar/00/0f/71/ec/bfecf21b.jpg","comment_is_top":false,"comment_ctime":1548206428,"is_pvip":false,"replies":[{"id":"22337","content":"这正是案例中要分析的问题（实际上I&#47;O是新的进程了）","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548251874,"ip_address":"","comment_id":62911,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548206428","product_id":100020901,"comment_content":"僵尸进程不是代表子进程结束了吗，为什么还继续有IO操作？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437397,"discussion_content":"这正是案例中要分析的问题（实际上I/O是新的进程了）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548251874,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61976,"user_name":"Something","can_delete":false,"product_type":"c1","uid":1314641,"ip_address":"","ucode":"0772172E3597D3","user_header":"https://static001.geekbang.org/account/avatar/00/14/0f/51/ec3a5d28.jpg","comment_is_top":false,"comment_ctime":1547869824,"is_pvip":false,"replies":[{"id":"22142","content":"不是，用户进程可以通过系统调用跟硬件交互","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548117123,"ip_address":"","comment_id":61976,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547869824","product_id":100020901,"comment_content":"不可中断进程是不是都是内核进程，用户进程是没法与硬件直接交互吧？？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437059,"discussion_content":"不是，用户进程可以通过系统调用跟硬件交互","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548117123,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55201,"user_name":"花开蝶自来","can_delete":false,"product_type":"c1","uid":1358144,"ip_address":"","ucode":"767D55E7A82975","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKibu8C3CeYGF6JCBribiaEPia5gibaQnj9icryPVwoF6ibosmdicXJIhBEUdn0aDwZQ32oTyJL86DgDswhAg/132","comment_is_top":false,"comment_ctime":1546064162,"is_pvip":false,"replies":[{"id":"20017","content":"父进程是哪个进程？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546075630,"ip_address":"","comment_id":55201,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1546064162","product_id":100020901,"comment_content":"找到了僵死进程之后，如果父进程是系统的话，怎么办？重启？重装系统？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434696,"discussion_content":"父进程是哪个进程？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546075630,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1100272,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c9/f0/a35f60a5.jpg","nickname":"Lynn","note":"","ucode":"83A0CF04C7049C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388609,"discussion_content":"老师父进程是1的，情况下应该怎么处理？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628847126,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55197,"user_name":"花开蝶自来","can_delete":false,"product_type":"c1","uid":1358144,"ip_address":"","ucode":"767D55E7A82975","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKibu8C3CeYGF6JCBribiaEPia5gibaQnj9icryPVwoF6ibosmdicXJIhBEUdn0aDwZQ32oTyJL86DgDswhAg/132","comment_is_top":false,"comment_ctime":1546063309,"is_pvip":false,"replies":[{"id":"20018","content":"嗯嗯，是的。只要不是CPU密集型应用，很大概率看到的都是S状态","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546075730,"ip_address":"","comment_id":55197,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546063309","product_id":100020901,"comment_content":"我发现我写的程序一直是 S状态进程。这个是不是因为我的主线程 一直在循环等待 子线程完成的原因？<br>实际上我们看到的进程状态就是主线程的状态？子线程的状态应该要用 top -Hp &lt;pid&gt; 来显示吧","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434694,"discussion_content":"嗯嗯，是的。只要不是CPU密集型应用，很大概率看到的都是S状态","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546075730,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54189,"user_name":"maoxiajun","can_delete":false,"product_type":"c1","uid":1198843,"ip_address":"","ucode":"CB4926BC81B3B1","user_header":"https://static001.geekbang.org/account/avatar/00/12/4a/fb/70f14340.jpg","comment_is_top":false,"comment_ctime":1545802089,"is_pvip":false,"replies":[{"id":"19700","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545835127,"ip_address":"","comment_id":54189,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545802089","product_id":100020901,"comment_content":"lesson8打卡","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434387,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545835127,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53472,"user_name":"Only now","can_delete":false,"product_type":"c1","uid":1038574,"ip_address":"","ucode":"C617473A03AE27","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d8/ee/6e7c2264.jpg","comment_is_top":false,"comment_ctime":1545652953,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545652953","product_id":100020901,"comment_content":"Mark","like_count":0},{"had_liked":false,"id":50247,"user_name":"如果","can_delete":false,"product_type":"c1","uid":1320638,"ip_address":"","ucode":"138A3EEEE50850","user_header":"","comment_is_top":false,"comment_ctime":1544932837,"is_pvip":false,"replies":[{"id":"18100","content":"这是有可能的，因为<br><br>1. 启动的时候还是先把数据从磁盘读入内存，这会导致磁盘I&#47;O<br>2. 系统缓存要占用内存，而内存不一定充足。在内存部分，还会讲缓存的分析","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545004023,"ip_address":"","comment_id":50247,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544932837","product_id":100020901,"comment_content":"DAY8，打卡<br>老师，按照你的步骤做到最后一步，但是运行docker run --privileged --name=app -itd feisky&#47;app:iowait-fix2，目测app的S状态还是D，wa也会偶尔到20%，这是什么问题？<br><br>[root@localhost ~]# docker container ls<br>CONTAINER ID        IMAGE                    COMMAND             CREATED              STATUS              PORTS               NAMES<br>b841f420586b        feisky&#47;app:iowait-fix2   &quot;&#47;app&quot;              About a minute ago   Up 59 seconds                           app<br>[root@localhost ~]# top<br>top - 11:55:58 up 47 days,  2:55,  4 users,  load average: 0.85, 0.91, 1.58<br>Tasks: 445 total,   1 running, 444 sleeping,   0 stopped,   0 zombie<br>%Cpu(s):  0.1 us,  9.0 sy,  0.0 ni, 70.2 id, 20.2 wa,  0.0 hi,  0.4 si,  0.0 st<br>KiB Mem :  1868688 total,    70408 free,   335940 used,  1462340 buff&#47;cache<br>KiB Swap:  1048572 total,   257868 free,   790704 used.  1287972 avail Mem <br><br>   PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                           <br> 13928 root      20   0   70044  65364     44 D  21.9  3.5   0:00.66 app                                               <br> 13929 root      20   0   70044  65548     44 D  20.9  3.5   0:00.63 app                                               <br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432925,"discussion_content":"这是有可能的，因为\n\n1. 启动的时候还是先把数据从磁盘读入内存，这会导致磁盘I/O\n2. 系统缓存要占用内存，而内存不一定充足。在内存部分，还会讲缓存的分析","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545004023,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49345,"user_name":"划时代","can_delete":false,"product_type":"c1","uid":1061454,"ip_address":"","ucode":"9554CE2F83B77F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/2o1Izf2YyJSnnI0ErZ51pYRlnrmibqUTaia3tCU1PjMxuwyXSKOLUYiac2TQ5pd5gNGvS81fVqKWGvDsZLTM8zhWg/132","comment_is_top":false,"comment_ctime":1544668448,"is_pvip":false,"replies":[{"id":"17828","content":"这个案例的确是跟虚拟机配置有关，可以去看下github上的配置选项（新增了几个选项调整io压力）","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544744979,"ip_address":"","comment_id":49345,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544668448","product_id":100020901,"comment_content":"直接在虚拟机上运行app，出现了终端掉线，虚拟机内报out of memory和不断杀掉僵尸进程的错误输出，我修改了代码将iowait升高和僵尸进程分开模拟验证。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432584,"discussion_content":"这个案例的确是跟虚拟机配置有关，可以去看下github上的配置选项（新增了几个选项调整io压力）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544744979,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48695,"user_name":"Wendy","can_delete":false,"product_type":"c1","uid":1308653,"ip_address":"","ucode":"398DDC96B178F7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/0PT9LxT8D6micyk0YbPuGQElQIeSax7puBBTXJDicJDhUHNibrbJPjEPJBRklVmcKG1PB7YV8JNh0BpsJjSicfibT5A/132","comment_is_top":false,"comment_ctime":1544517266,"is_pvip":false,"replies":[{"id":"17454","content":"nginx直接会有I&#47;O吗？我的理解应该还是PHP的I&#47;O吧。第06篇是PHP的案例，可以参考一下","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544520530,"ip_address":"","comment_id":48695,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544517266","product_id":100020901,"comment_content":"老师好，我在生产环境跑了lnmp，假如是nginx进程io比较高，我需要如何定位函数问题？也就是如何通过perf然后去源码中分析代码？而且这个源码不像你的docker里的app源码，我的是nginx，nginx需要看哪个源码文件？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432314,"discussion_content":"nginx直接会有I/O吗？我的理解应该还是PHP的I/O吧。第06篇是PHP的案例，可以参考一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544520530,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48631,"user_name":"Wendy","can_delete":false,"product_type":"c1","uid":1308653,"ip_address":"","ucode":"398DDC96B178F7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/0PT9LxT8D6micyk0YbPuGQElQIeSax7puBBTXJDicJDhUHNibrbJPjEPJBRklVmcKG1PB7YV8JNh0BpsJjSicfibT5A/132","comment_is_top":false,"comment_ctime":1544501439,"is_pvip":false,"replies":[{"id":"17461","content":"解决思路要具体问题具体分析，跟瓶颈的位置有很大关系，可能是改代码、改系统配置、改软件的架构，甚至是换硬件等等。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544521132,"ip_address":"","comment_id":48631,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544501439","product_id":100020901,"comment_content":"总结了一下这几天的学习心得。<br>1.当系统出现性能问题，首先通过几个工具确认是哪个指标出现问题：平均负载、cpu使用率、I&#47;Owait<br>2.工具主要有top mpstat vmstat iostat dstat 这几个工具主要是看系统整体的性能状况<br>3.确认系统整体性能状态况之后需要再确认是哪个进程导致的指标问题。此时用pidstat找出问题进程 <br>4.找出问题进程后需要通过perf工具分析是进程的哪一个函数导致的指标问题。<br>5.最后是代码层的分析：及分析应用问题进程的源码，看看哪个函数哪个代码导致指标问题。<br>（分析路线：找指标，找进程，找函数，找源码）<br>   (解决路线:修改源码？向老师求证)","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432281,"discussion_content":"解决思路要具体问题具体分析，跟瓶颈的位置有很大关系，可能是改代码、改系统配置、改软件的架构，甚至是换硬件等等。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544521132,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48420,"user_name":"梁中华","can_delete":false,"product_type":"c1","uid":1006789,"ip_address":"","ucode":"52FE40242CBAD0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5c/c5/1231d633.jpg","comment_is_top":false,"comment_ctime":1544440889,"is_pvip":true,"replies":[{"id":"17342","content":"实际上你去查看手册的话，还会发现iowait给出的数值也不准确。<br><br>但是，这个指标也的确反应了CPU的状态，并且也有很大概率关联到I&#47;O的问题上","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544488174,"ip_address":"","comment_id":48420,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1544440889","product_id":100020901,"comment_content":"还是没有理解，既然iowait 的时候CPU 是空闲的，为啥还搞个Iowait 的CPU 使用率指标呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432173,"discussion_content":"实际上你去查看手册的话，还会发现iowait给出的数值也不准确。\n\n但是，这个指标也的确反应了CPU的状态，并且也有很大概率关联到I/O的问题上","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544488174,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48412,"user_name":"低调","can_delete":false,"product_type":"c1","uid":1087237,"ip_address":"","ucode":"F4F001639091E0","user_header":"https://static001.geekbang.org/account/avatar/00/10/97/05/17cf5840.jpg","comment_is_top":false,"comment_ctime":1544438167,"is_pvip":false,"replies":[{"id":"17344","content":"的确是这样","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544488300,"ip_address":"","comment_id":48412,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544438167","product_id":100020901,"comment_content":"我经常遇到的就是等待IO，也就是挂载的文件系统阻塞完成的，重启所有挂载的系统，让IO降下来，有的时候开发不合理读写文件造成。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432168,"discussion_content":"的确是这样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544488300,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48411,"user_name":"低调","can_delete":false,"product_type":"c1","uid":1087237,"ip_address":"","ucode":"F4F001639091E0","user_header":"https://static001.geekbang.org/account/avatar/00/10/97/05/17cf5840.jpg","comment_is_top":false,"comment_ctime":1544438166,"is_pvip":false,"replies":[{"id":"17351","content":"的确是这样","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544488771,"ip_address":"","comment_id":48411,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544438166","product_id":100020901,"comment_content":"我经常遇到的就是等待IO，也就是挂载的文件系统阻塞完成的，重启所有挂载的系统，让IO降下来，有的时候开发不合理读写文件造成。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432167,"discussion_content":"的确是这样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544488771,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48306,"user_name":"倪路","can_delete":false,"product_type":"c1","uid":1325941,"ip_address":"","ucode":"C7B93EE9001D96","user_header":"https://static001.geekbang.org/account/avatar/00/14/3b/75/1312e1c2.jpg","comment_is_top":false,"comment_ctime":1544416570,"is_pvip":false,"replies":[{"id":"17272","content":"的确应该关注I&#47;O问题，不过注意iowait是一个CPU使用率指标，所以这里就从CPU的角度来开始分析；后面I&#47;O部分还会讲怎么分析I&#47;O问题。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544435535,"ip_address":"","comment_id":48306,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544416570","product_id":100020901,"comment_content":"iowait太高，达到cpu个数？iowait时，cpu不是空闲的吗，这个只能说明磁盘负载高吧，为什么要强调达到cpu个数，我理解此时cpu资源是空闲的，不用关注cpu负载，而应关注磁盘负载吧？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432119,"discussion_content":"的确应该关注I/O问题，不过注意iowait是一个CPU使用率指标，所以这里就从CPU的角度来开始分析；后面I/O部分还会讲怎么分析I/O问题。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544435535,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48245,"user_name":"kakasir","can_delete":false,"product_type":"c1","uid":1316615,"ip_address":"","ucode":"21F9742D3E63B3","user_header":"https://static001.geekbang.org/account/avatar/00/14/17/07/83f030c9.jpg","comment_is_top":false,"comment_ctime":1544405934,"is_pvip":false,"replies":[{"id":"17281","content":"安装包推荐使用国内的镜像源，可以网络搜索下它们的用法","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544436693,"ip_address":"","comment_id":48245,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544405934","product_id":100020901,"comment_content":"打卡，在上班路上阅读学习思路，晚上回家安装环境练习，但是新做的虚拟机，什么工具都没有，网络不好，安装老是不成功很是郁闷","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432085,"discussion_content":"安装包推荐使用国内的镜像源，可以网络搜索下它们的用法","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544436693,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48056,"user_name":"王欢_阿布","can_delete":false,"product_type":"c1","uid":1006824,"ip_address":"","ucode":"CE6DC8232ACD75","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM5t5Zv2lCcVc9PwGMm9DiaIZRMaKTwC77yfPV6S8Se0ZA9ebFgGaC6ppxd6oOxcx9H9zKB5PLIZbtfPGtjLib2yiaC/132","comment_is_top":false,"comment_ctime":1544336333,"is_pvip":false,"replies":[{"id":"17290","content":"你是指内核crash吗？这一块一般是是bug而不是性能导致的，专栏没有涉及","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544437154,"ip_address":"","comment_id":48056,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544336333","product_id":100020901,"comment_content":"请问老师 课程会安排 linux crash的分析么 我这边有个linux crash 的问题 不知道如何定位","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432011,"discussion_content":"你是指内核crash吗？这一块一般是是bug而不是性能导致的，专栏没有涉及","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544437154,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47976,"user_name":"猪尾巴","can_delete":false,"product_type":"c1","uid":1169487,"ip_address":"","ucode":"4BDA1DB1A8A1B3","user_header":"https://static001.geekbang.org/account/avatar/00/11/d8/4f/4ec15857.jpg","comment_is_top":false,"comment_ctime":1544275442,"is_pvip":false,"replies":[{"id":"17072","content":"看这些内核函数的名字","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544311972,"ip_address":"","comment_id":47976,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544275442","product_id":100020901,"comment_content":"app 的确在通过系统调用 sys_read() 读取数据。并且从 new_sync_read 和 blkdev_direct_IO 能看出，进程正在对磁盘进行直接读。   这一部分怎么就能直接看出是对磁盘直接读呢。还请老师指教","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431966,"discussion_content":"看这些内核函数的名字","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544311972,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47916,"user_name":"bluefantasy1","can_delete":false,"product_type":"c1","uid":1106810,"ip_address":"","ucode":"83440E87C4EED3","user_header":"","comment_is_top":false,"comment_ctime":1544256301,"is_pvip":false,"replies":[{"id":"17058","content":"JVM有自己的内存管理机制，你可以使用JAVA自带的内存工具来分析，比如jmap、jstat等","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544279817,"ip_address":"","comment_id":47916,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544256301","product_id":100020901,"comment_content":"请教老师一个问题：Linux里的一个Java进程，我通过top命令的RES列看到它占用的内存是390M,我通过Java的监控工具看到进程占用的堆内存是70M，非堆内存是110M。加起来才180M呀。我想知道剩余的210M是怎么占用的。请问老师，有什么工具可以查看一个进程占用内存的详细情况。不像top命令那样只显示占用的内存总量。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431944,"discussion_content":"JVM有自己的内存管理机制，你可以使用JAVA自带的内存工具来分析，比如jmap、jstat等","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544279817,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47899,"user_name":"Goal","can_delete":false,"product_type":"c1","uid":1307012,"ip_address":"","ucode":"C337CD4C7E07B0","user_header":"https://static001.geekbang.org/account/avatar/00/13/f1/84/7d21bd9e.jpg","comment_is_top":false,"comment_ctime":1544250913,"is_pvip":false,"replies":[{"id":"17041","content":"其实各种Linux系统都是类似的，Ubuntu的好处是包含的软件包版本比较新，适合在学习的时候使用","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544255194,"ip_address":"","comment_id":47899,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544250913","product_id":100020901,"comment_content":"为什么用 ubuntu 这个系统，太麻烦了吧","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431934,"discussion_content":"其实各种Linux系统都是类似的，Ubuntu的好处是包含的软件包版本比较新，适合在学习的时候使用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544255194,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47854,"user_name":"mark","can_delete":false,"product_type":"c1","uid":1332461,"ip_address":"","ucode":"7135BC57978AAA","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ6U2qqpFnTbI6gn864YdOIxebTOoJdR6ibwYfUQxwXtl9KjUOJfdJ2aWgsUBYyj5jKqUESluKcUMg/132","comment_is_top":false,"comment_ctime":1544236727,"is_pvip":false,"replies":[{"id":"17044","content":"嗯嗯，思路和原理是相通的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544255967,"ip_address":"","comment_id":47854,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544236727","product_id":100020901,"comment_content":"案例是比较简单的，与生产环境实战还是有比较大的差距，不过就学习来说，重要的是思路与原理，讲的都比较接地气","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431912,"discussion_content":"嗯嗯，思路和原理是相通的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544255967,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47624,"user_name":"mj4ever","can_delete":false,"product_type":"c1","uid":1005549,"ip_address":"","ucode":"73028E537099CC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/ed/d50de13c.jpg","comment_is_top":false,"comment_ctime":1544166635,"is_pvip":true,"replies":[{"id":"17013","content":"👍 思路很正确","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544193565,"ip_address":"","comment_id":47624,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544166635","product_id":100020901,"comment_content":"通过本篇知识实践，谈谈学习感受：<br>1、在使用perf进一步排查代码时，由于对I&#47;O深层次知识不了解，所以，无法进行分析<br>2、看到有人留言“直接读写磁盘为什么对数据库程序更友好” 以及 文章中提到“new_sync_read” &amp; “blkdev_direct_IO”，就去百度了下，找到了这篇文章《Linux 中直接 I&#47;O 机制的介绍》，https:&#47;&#47;www.ibm.com&#47;developerworks&#47;cn&#47;linux&#47;l-cn-directio&#47;<br>3、文章中讲解了 缓存I&#47;O、自缓存应用程序、直接I&#47;O技术、异步访问文件方式等知识，能看懂一些，还谈不上深入理解，但是可以回答上面的一些问题：<br>（1）通常情况下，缓存I&#47;O会提高性能，但是对于数据库类型的软件，它会比操作系统更了解数据库中存放的数据，可以提供一种更有效的机制（如自缓存应用程序）来提高数据库中数据的存取性能<br>（2）要在块设备中执行直接 I&#47;O，进程必须在打开文件的时候设置对文件的访问模式为 O_DIRECT<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431838,"discussion_content":"👍 思路很正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544193565,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47598,"user_name":"路过","can_delete":false,"product_type":"c1","uid":1316401,"ip_address":"","ucode":"7152C19ED024CC","user_header":"https://static001.geekbang.org/account/avatar/00/14/16/31/ae8adf82.jpg","comment_is_top":false,"comment_ctime":1544163426,"is_pvip":false,"replies":[{"id":"17081","content":"其他的内核符号也都没有？看一下record界面的最后一行，有没有警告信息？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544313367,"ip_address":"","comment_id":47598,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544163426","product_id":100020901,"comment_content":"老师，我使用perf record -g命令收集信息了。收集了很多次，每次都是command列为swapper的左侧有加号，而为app或其他的，都没有加号。但可以在symbol列，看到sys_read,new_sync_read，blkdev_read_iter等信息。我的系统也用Ubuntu 18.04. 不知道为何不能还原您的实现场景。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431824,"discussion_content":"其他的内核符号也都没有？看一下record界面的最后一行，有没有警告信息？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544313367,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47585,"user_name":"berryfl","can_delete":false,"product_type":"c1","uid":1014479,"ip_address":"","ucode":"E9896F6EBC9A72","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLz5feictl6uxOFeth2zrO7LPOZKk0mvzIBYD9ic5EyGB39dicBbkYsIYoqqBsibJFo0fDicxN0CUt2dAQ/132","comment_is_top":false,"comment_ctime":1544159241,"is_pvip":false,"replies":[{"id":"17080","content":"嗯嗯 好建议，我加到案例里面去","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544313304,"ip_address":"","comment_id":47585,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544159241","product_id":100020901,"comment_content":"有些磁盘不是sd或者xvd前缀，比如AWS的新实例是以nvme作为前缀，建议留一个可选的命令行参数指定块设备，有需要的读者不用自己编译和打包","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431818,"discussion_content":"嗯嗯 好建议，我加到案例里面去","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544313304,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47536,"user_name":"hsggj","can_delete":false,"product_type":"c1","uid":1312093,"ip_address":"","ucode":"EA36957C4ED800","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLRCxev73gpRIKKwjvuU2WgFKcZ1rKrGhDSZpUMzRsEgvAEZN00XscsTXp0ib1OrNkn9LgH2hYxX1w/132","comment_is_top":false,"comment_ctime":1544152333,"is_pvip":false,"replies":[{"id":"17085","content":"不会","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544314716,"ip_address":"","comment_id":47536,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544152333","product_id":100020901,"comment_content":"老师，ubuntu 16.04上面运行perf时提示错误。这个安装不会对内核造成影响吧？<br>WARNING: perf not found for kernel 4.4.0-112<br>  You may need to install the following packages for this specific kernel:<br>    linux-tools-4.4.0-112-generic<br>    linux-cloud-tools-4.4.0-112-generic<br>  You may also want to install one of the following packages to keep up to date:<br>    linux-tools-generic<br>    linux-cloud-tools-generic","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431799,"discussion_content":"不会","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544314716,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47518,"user_name":"Leon📷","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1544149558,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544149558","product_id":100020901,"comment_content":"老师，你那个pstree -aps 僵尸进程之前是不是应该执行ps -A -o stat,ppid,pid,cmd | grep -e &#39;^[Zz]&#39;找出对应的僵尸，这个文章没有说明，看的有点懵。","like_count":0},{"had_liked":false,"id":47470,"user_name":"Geek_101627","can_delete":false,"product_type":"c1","uid":1070389,"ip_address":"","ucode":"F246019019F1CB","user_header":"https://static001.geekbang.org/account/avatar/00/10/55/35/09e7dfde.jpg","comment_is_top":false,"comment_ctime":1544146525,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544146525","product_id":100020901,"comment_content":"D9打卡","like_count":0},{"had_liked":false,"id":47462,"user_name":"Jerry","can_delete":false,"product_type":"c1","uid":1088756,"ip_address":"","ucode":"4213083D076AB8","user_header":"https://static001.geekbang.org/account/avatar/00/10/9c/f4/7e14ff8a.jpg","comment_is_top":false,"comment_ctime":1544146136,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544146136","product_id":100020901,"comment_content":"session leader是什么概念？","like_count":0},{"had_liked":false,"id":47459,"user_name":"Aaron Cheung","can_delete":false,"product_type":"c1","uid":1079816,"ip_address":"","ucode":"03972759C53667","user_header":"https://static001.geekbang.org/account/avatar/00/10/7a/08/4d3e47dd.jpg","comment_is_top":false,"comment_ctime":1544145734,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544145734","product_id":100020901,"comment_content":"上班之前先打卡","like_count":0},{"had_liked":false,"id":47453,"user_name":"大飞","can_delete":false,"product_type":"c1","uid":1320080,"ip_address":"","ucode":"2D98888FC63CA9","user_header":"","comment_is_top":false,"comment_ctime":1544145464,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544145464","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":47442,"user_name":"湖湘志","can_delete":false,"product_type":"c1","uid":1285578,"ip_address":"","ucode":"C8B069B3AD4FEA","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erJR5Kj0Xm6LykFHLaWqHjQiaroVxgdoGI7uHEGz2D3PfibWNkBYP23QLzFmcuicgKLbqUch0ZJ2ZNOA/132","comment_is_top":false,"comment_ctime":1544144405,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544144405","product_id":100020901,"comment_content":"D9","like_count":0},{"had_liked":false,"id":47425,"user_name":"jeff","can_delete":false,"product_type":"c1","uid":1063344,"ip_address":"","ucode":"3B13989DF44D6C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJSGU1LkzTK76HicuZ1IbiboziakPmL6KzcmlvgIibZ7tq0Tlt6OwhRKLAaTttbY6vSPY5XupEAWjT0eg/132","comment_is_top":false,"comment_ctime":1544143558,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544143558","product_id":100020901,"comment_content":"直接读写磁盘为什么对数据库程序更友好，这点没有完全理解。如果，是数据库程序的iowait高，是不是认为就和直接读写磁盘没有关系呢？","like_count":0},{"had_liked":false,"id":47424,"user_name":"风飘，吾独思","can_delete":false,"product_type":"c1","uid":1131032,"ip_address":"","ucode":"4DF0E7DC22EE53","user_header":"https://static001.geekbang.org/account/avatar/00/11/42/18/edc1b373.jpg","comment_is_top":false,"comment_ctime":1544143534,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544143534","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":47402,"user_name":"Linuxer","can_delete":false,"product_type":"c1","uid":1153978,"ip_address":"","ucode":"272D9D8089C3D6","user_header":"https://static001.geekbang.org/account/avatar/00/11/9b/ba/333b59e5.jpg","comment_is_top":false,"comment_ctime":1544142218,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544142218","product_id":100020901,"comment_content":"有一个问题请教，pidstat和dstat监控到的读数量怎么计算的?是统计的直接从磁盘读的数量还是包括从文系统缓存读的数量？","like_count":0},{"had_liked":false,"id":47389,"user_name":"DJH","can_delete":false,"product_type":"c1","uid":1256740,"ip_address":"","ucode":"2BDEF123B3DB6A","user_header":"https://static001.geekbang.org/account/avatar/00/13/2d/24/28acca15.jpg","comment_is_top":false,"comment_ctime":1544140290,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544140290","product_id":100020901,"comment_content":"倪老师，请教一个问题：僵尸进程如果长时间存在，有办法kill掉吗？是不是必须等到下次系统重启才会消失？","like_count":0},{"had_liked":false,"id":47376,"user_name":"solar","can_delete":false,"product_type":"c1","uid":1316091,"ip_address":"","ucode":"D5BE087E264401","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/dwehJHP4ycAfDb9MoudXb4QSt7YgmISqwwsa928XZ6aTWqwWh0kx0iatjocSibLa7iajXmbGlJ5svegY3P6LfKJ0w/132","comment_is_top":false,"comment_ctime":1544138444,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1544138444","product_id":100020901,"comment_content":"打卡~~~~","like_count":0}]}