{"id":816673,"title":"02ï½œå¦‚ä½•å–„ç”¨LLaMA 3é•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯Tylerã€‚</p><p>åœ¨ä¹‹å‰çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ·±å…¥æ¢è®¨äº†å¦‚ä½•åˆ©ç”¨ LLaMA æ¨¡å‹è¿›è¡Œå¯¹è¯ï¼Œå¹¶æ˜ç¡®äº†LLaMA åœ¨å¤šè½®å¯¹è¯ä¸­çš„æ ¸å¿ƒæœºåˆ¶ã€‚è¿™ä¸€æœºåˆ¶é€šè¿‡å­˜å‚¨å†å²å¯¹è¯å†…å®¹ï¼Œå°†æ— çŠ¶æ€çš„å¤§æ¨¡å‹æ¨ç†æœåŠ¡è½¬å˜ä¸ºæœ‰çŠ¶æ€çš„å¤šè½®å¯¹è¯æœåŠ¡ã€‚</p><p>è¿™ä¸€æœºåˆ¶æ˜¾è‘—æå‡äº†å¯¹è¯ç³»ç»Ÿåœ¨å¤„ç†å¤æ‚å¯¹è¯æƒ…å¢ƒæ—¶çš„èƒ½åŠ›ï¼Œä½†ä¹Ÿå¸¦æ¥äº†æ–°çš„æŒ‘æˆ˜ï¼šéšç€å†å²å¯¹è¯è½®æ¬¡çš„å¢åŠ ï¼Œæ¨¡å‹çš„è¾“å…¥é•¿åº¦ä¹Ÿéšä¹‹å¢é•¿ã€‚ä¸ºåº”å¯¹è¿™ä¸€æŒ‘æˆ˜ï¼Œå¤§æ¨¡å‹å¿…é¡»å…·å¤‡å¤„ç†é•¿æ–‡æœ¬è¾“å…¥çš„èƒ½åŠ›ï¼Œè¿™ä¸ä»…æ˜¯å¯¹ç°æœ‰æŠ€æœ¯çš„æ‰©å±•ï¼Œä¹Ÿæ˜¯é•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›å‘å±•çš„å…³é”®é©±åŠ¨åŠ›ã€‚</p><p>æœ¬èŠ‚è¯¾æˆ‘ä»¬å°†æ·±å…¥æ¢è®¨å¤„ç†é•¿æ–‡æœ¬è¾“å…¥æ—¶çš„å…³é”®æŠ€æœ¯å·¥ä½œï¼ŒåŒ…æ‹¬å½“å‰çš„è§£å†³æ–¹æ¡ˆã€ä¼˜åŠ¿åŠå…¶å±€é™æ€§ã€‚æˆ‘ä»¬å°†ç³»ç»Ÿæ€§åœ°åˆ†æå¦‚ä½•ä¼˜åŒ–é•¿æ–‡æœ¬è¾“å…¥çš„å¤„ç†ï¼Œä»¥æ»¡è¶³å¤§è§„æ¨¡å¯¹è¯ç³»ç»Ÿå¯¹é•¿æ–‡æœ¬çš„éœ€æ±‚ï¼Œå¹¶è¯„ä¼°è¿™äº›æŠ€æœ¯æ–¹æ¡ˆåœ¨å®é™…åº”ç”¨ä¸­çš„è¡¨ç°å’Œæ½œåœ¨æ”¹è¿›æ–¹å‘ã€‚</p><h2>é•¿æ–‡æœ¬å¤„ç†çš„å‘å±•ä¸ç°çŠ¶</h2><p>LLaMA æ¨¡å‹çš„é•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›æœ‰äº†æ˜¾è‘—æå‡ã€‚ä» LLaMA 2 çš„ 2048 ä¸ª token æ‰©å±•åˆ° 4096 ä¸ª tokenï¼Œå†åˆ° LLaMA 3 æ”¯æŒçš„ 8000 ä¸ª tokenï¼Œç”šè‡³é€šè¿‡è¿›ä¸€æ­¥å¾®è°ƒå¯ä»¥å¤„ç†æ›´é•¿çš„æ–‡æœ¬ã€‚è¿™æ„å‘³ç€è¿™äº›æ¨¡å‹ç°åœ¨å¯ä»¥å¤„ç†æ›´é•¿çš„æ–‡æœ¬ï¼Œç†è§£èƒ½åŠ›ä¹Ÿå¾—åˆ°äº†å¢å¼ºï¼Œç”Ÿæˆçš„å›åº”æ›´åŠ è¿è´¯ï¼Œç›¸å…³æ€§ä¹Ÿæ›´å¼ºã€‚å›¾è¡¨å±•ç¤ºäº†ä¸åŒæ¨¡å‹åœ¨é•¿æ–‡æœ¬å¤„ç†æ–¹é¢çš„è¿›å±•ã€‚</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/b5/b5/b558303bce1d3801c0fc0bd42575d5b5.png?wh=400x591\" alt=\"å›¾ç‰‡\"></p><p>é•¿æ–‡æœ¬å¤„ç†çš„å‘å±•ä¸ä»…æ˜¯æŠ€æœ¯çš„è¿›æ­¥ï¼Œä¹Ÿæ˜¯å¯¹å®é™…åº”ç”¨éœ€æ±‚çš„å“åº”ã€‚é•¿æ–‡æœ¬å¤„ç†çš„èƒ½åŠ›ç›´æ¥å½±å“åˆ°å¤§è§„æ¨¡å¯¹è¯ç³»ç»Ÿåœ¨å¤æ‚åœºæ™¯ä¸‹çš„è¡¨ç°ã€‚</p><h2>LLM é•¿æ–‡æœ¬çš„å¿…è¦æ€§</h2><p>åœ¨å¼€ç¯‡çš„æ—¶å€™ï¼Œæˆ‘ä»¬æåˆ°äº†é•¿æ–‡æœ¬å¯¹å¤šè½®å¯¹è¯çš„é‡è¦æ€§ï¼ŒåŒ…æ‹¬æ™ºèƒ½ä½“è‡ªæˆ‘æˆ–å½¼æ­¤ä¹‹é—´çš„å¤æ‚æç¤ºè¯åº”ç”¨åœºæ™¯ã€‚é•¿æ–‡æœ¬æ”¯æŒçš„å¤šè½®å¯¹è¯åœºæ™¯ä¸­ï¼Œæç¤ºè¯çš„é•¿åº¦é™åˆ¶ä¼šå½±å“æ™ºèƒ½ä½“çš„æ€è€ƒæ·±åº¦ã€‚</p><p>ä¸‹å›¾å±•ç¤ºäº†åŸºäº ReAct æç¤ºè¯çš„æ™ºèƒ½ä½“å¤šè½®æ€è€ƒèƒ½åŠ›ã€‚å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œæ™ºèƒ½ä½“åœ¨æ¯ä¸€æ­¥æ ¹æ®æœ€æ–°çš„å¤–éƒ¨æ•°æ®åˆ¤æ–­æ˜¯å¦èƒ½å¤Ÿå®Œæˆä»»åŠ¡ã€‚æç¤ºè¯çš„é•¿åº¦åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™åˆ¶äº†æ™ºèƒ½ä½“æ€è€ƒçš„æ·±åº¦ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/e9/ce/e940161046168f3f8f0f4a9608831dce.png?wh=818x699\" alt=\"å›¾ç‰‡\"></p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä»£ç ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ LLaMA è¿›è¡Œå¯¹è¯ä»»åŠ¡ï¼š</p><pre><code class=\"language-python\">from langchain_ollama.llms import OllamaLLM\nfrom langchain.agents import load_tools, initialize_agent\nfrom langchain.tools import Tool\nimport numexpr as ne\n\n# å®šä¹‰æ•°å­¦è®¡ç®—å·¥å…·\ndef calculate_expression(expression):\n&nbsp; &nbsp; return ne.evaluate(expression).item()&nbsp; # ä½¿ç”¨ numexpr è®¡ç®—è¡¨è¾¾å¼å¹¶è¿”å›ç»“æœ\n\nmath_tools = [\n&nbsp; &nbsp; Tool(\n&nbsp; &nbsp; &nbsp; &nbsp; name=\"Numexpr Math\",\n&nbsp; &nbsp; &nbsp; &nbsp; func=calculate_expression,\n&nbsp; &nbsp; &nbsp; &nbsp; description=\"ä¸€ä¸ªèƒ½å¤Ÿè¿›è¡Œé«˜æ•ˆæ•°å­¦è®¡ç®—çš„å·¥å…·ï¼Œå‚æ•°æ˜¯è¾“å…¥çš„æ•°å­¦è¡¨è¾¾å¼\"\n&nbsp; &nbsp; )\n]\n\n# åˆå§‹åŒ– LLM\nllm = OllamaLLM(model=\"llama3\")\n\n# å®šä¹‰ agent\nagent = initialize_agent(\n&nbsp; &nbsp; tools=math_tools,&nbsp; # ä½¿ç”¨è‡ªå®šä¹‰çš„æ•°å­¦è®¡ç®—å·¥å…·\n&nbsp; &nbsp; llm=llm,&nbsp;\n&nbsp; &nbsp; agent_type=\"zero-shot-react-description\",&nbsp;\n&nbsp; &nbsp; verbose=True,\n&nbsp; &nbsp; agent_kwargs={\"handle_parsing_errors\": True}&nbsp; # å¤„ç†è§£æé”™è¯¯\n)\n\n# ç”¨æˆ·é—®é¢˜\nuser_question = \"What is 37593 * 67?\"\nprint(f\"ç”¨æˆ·é—®é¢˜ï¼š{user_question}\")\n\n# æ‰§è¡Œå¹¶æ‰“å°ç»“æœ\nresponse = agent.run(user_question)\nprint(response)\n\n</code></pre><p>å‡è®¾ä¸Šè¿°ä»£ç å¤„ç†ä¸€ä¸ªå…³äºè®¡ç®—é—®é¢˜çš„åˆå§‹æç¤ºï¼Œå¹¶ç»è¿‡å¤šè½®å¯¹è¯ï¼Œå¯èƒ½çš„è¾“å‡ºå¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">Question: What is 37593 * 67?\nThought: Let's get started!\n\nThought: I need to perform a mathematical operation using Numexpr Math.\n\nAction: Numexpr Math\n\nAction Input: 37593 * 67\nObservation: 2518731\nThought:I'm excited to help! Here are the answers:\n\nFinal Answer: 2518731\n\n&gt; Finished chain.\n</code></pre><p>ä½†æ˜¯è¿™éƒ½è°ˆä¸ä¸Šé•¿æ–‡æœ¬è¾“å…¥çš„åˆšéœ€ï¼Œå› ä¸ºå­˜åœ¨ä¸€äº›æç¤ºè¯å‹ç¼©çš„æ›¿ä»£æ–¹æ¡ˆã€‚çœŸæ­£é•¿æ–‡æœ¬çš„â€œåˆšéœ€â€åœºæ™¯ï¼Œæˆ‘ä»¬åªèƒ½æŠŠä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶æ”¾è¿›å»ï¼Œéœ€è¦é€šè¿‡ä¸Šä¸‹æ–‡å†…å®¹è”åˆåˆ†æï¼Œæ‰èƒ½ç”Ÿæˆå‡ºç›®æ ‡å†…å®¹çš„åœºæ™¯ã€‚</p><p>é•¿æ–‡æœ¬å¤„ç†çš„â€œåˆšéœ€â€åœºæ™¯åŒ…æ‹¬å¤„ç†å®Œæ•´çš„æ–‡æ¡£ï¼Œå¦‚æ–‡ç« ã€ä»£ç ã€è„šæœ¬ã€æŠ¥å‘Šç­‰ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå°† Python ä»£ç ç¿»è¯‘ä¸º JavaScript çš„ä¾‹å­ï¼Œå±•ç¤ºäº†å…¨æ–‡è¾“å…¥çš„å¿…è¦æ€§ï¼š</p><pre><code class=\"language-python\">import ollama\n\ndef translate_code_to_js(python_code):\n&nbsp; &nbsp; # ä¼˜åŒ–ç¿»è¯‘æç¤º\n&nbsp; &nbsp; prompt = f\"\"\"\nYou are a code translation assistant. Your task is to translate Python code into JavaScript while ensuring the following:\n\n1. Maintain the original logic and functionality.\n2. Adapt Python-specific constructs to their JavaScript equivalents.\n3. Use clear and idiomatic JavaScript syntax.\n\nHere is the Python code you need to translate:\n\nPython Code:\n{python_code}\n\nPlease provide the corresponding JavaScript code below:\nJavaScript Code:\n\"\"\"\n\n&nbsp; &nbsp; # ä½¿ç”¨ Ollama æ¨¡å‹ 'llama3' è¿›è¡Œå¯¹è¯\n&nbsp; &nbsp; response = ollama.chat(model='llama3', messages=[\n&nbsp; &nbsp; &nbsp; &nbsp; {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'role': 'user',\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'content': prompt,\n&nbsp; &nbsp; &nbsp; &nbsp; },\n&nbsp; &nbsp; ])\n\n&nbsp; &nbsp; # è·å–ç”Ÿæˆçš„ JavaScript ä»£ç \n&nbsp; &nbsp; js_code = response['message']['content']\n&nbsp; &nbsp; return js_code\n\n# ç¤ºä¾‹ Python ä»£ç \npython_code = \"\"\"\ndef fibonacci(n):\n&nbsp; &nbsp; a, b = 0, 1\n&nbsp; &nbsp; while n &gt; 0:\n&nbsp; &nbsp; &nbsp; &nbsp; yield a\n&nbsp; &nbsp; &nbsp; &nbsp; a, b = b, a + b\n&nbsp; &nbsp; &nbsp; &nbsp; n -= 1\n\nfor number in fibonacci(5):\n&nbsp; &nbsp; print(number)\n\"\"\"\n\n# è°ƒç”¨å‡½æ•°å¹¶æ‰“å° JavaScript ä»£ç \nprint(translate_code_to_js(python_code))\n\n</code></pre><p>è¾“å‡ºçš„ä»£ç ï¼š</p><pre><code class=\"language-javascript\">function* fibonacci(n) {\n&nbsp; let a = 0, b = 1;\n&nbsp; for (let i = 0; i &lt; n; i++) {\n&nbsp; &nbsp; yield a;\n&nbsp; &nbsp; [a, b] = [b, a + b];\n&nbsp; }\n}\n\nfor (const number of fibonacci(5)) {\n&nbsp; console.log(number);\n}\n</code></pre><p>è¿™ä¸ªä¾‹å­è¡¨æ˜ï¼Œé€šè¿‡å¤šæ¬¡è¾“å…¥ä¸åŒçš„ä»£ç ç‰‡æ®µï¼Œå¾ˆéš¾è®©æ¨¡å‹ç”Ÿæˆå…¨å±€ä¸€è‡´çš„å˜é‡å£°æ˜å’Œé€»è¾‘è¡¨è¾¾ã€‚å› æ­¤ï¼Œé•¿æ–‡æœ¬è¾“å…¥åœ¨ä¸€äº›åœºæ™¯ä¸‹æ˜¯ä¸å¯æˆ–ç¼ºçš„ã€‚</p><p>é•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›çš„å¿«é€Ÿå‘å±•ï¼Œä¸ç”±è®©å¤§å®¶æå‡ºäº†ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼šæç¤ºè¯­å·¥ç¨‹æ–¹æ³•ï¼Œæ¯”å¦‚ RAG å’Œæ€ç»´é“¾ï¼ˆCoTï¼‰ï¼Œæ˜¯å¦ä»ç„¶å¿…è¦ï¼Ÿ</p><h2>é•¿æ–‡æœ¬å¤„ç†çš„å±€é™æ€§</h2><h3>é•¿æ–‡æœ¬å¤„ç†æ€§èƒ½é—®é¢˜</h3><p>ä¸ŠèŠ‚è¯¾æˆ‘ä»¬è®¨è®ºäº†LLaMAç”Ÿæˆå†…å®¹çš„æ–¹æ³•ã€‚æˆ‘ä»¬äº†è§£åˆ°ï¼ŒLLaMAåœ¨å¤„ç†é•¿æ–‡æœ¬æ—¶ï¼Œä¼šé¢ä¸´å¾ˆå¤§çš„ç®—åŠ›å¼€é”€ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ›´è¯¦ç»†åœ°äº†è§£LLaMAçš„å·¥ä½œåŸç†ï¼Œç‰¹åˆ«æ˜¯å®ƒçš„è‡ªå›å½’ç”Ÿæˆæœºåˆ¶å¦‚ä½•å½±å“æ¨ç†æ—¶çš„ç®—åŠ›éœ€æ±‚ï¼Œä»¥åŠä¸ºä»€ä¹ˆé•¿æ–‡æœ¬ä¼šæ¶ˆè€—æ›´å¤šèµ„æºã€‚</p><p>è¿™é‡Œå¿«é€Ÿå›é¡¾ä¸€ä¸‹ï¼ŒLLaMAæ¨¡å‹çš„æ–‡æœ¬ç”Ÿæˆä¾èµ–äºè‡ªå›å½’æ–¹æ³•ã€‚è‡ªå›å½’ç”Ÿæˆæ–¹æ³•é€æ­¥ç”Ÿæˆæ¯ä¸€ä¸ªè¯ï¼š</p><ul>\n<li>\n<p>åˆå§‹åŒ–ä¸Šä¸‹æ–‡ï¼šæ¨¡å‹ä»ä¸€ä¸ªèµ·å§‹æ–‡æœ¬æˆ–ç§å­ä¿¡æ¯å¼€å§‹ã€‚</p>\n</li>\n<li>\n<p>é¢„æµ‹ä¸‹ä¸€ä¸ªè¯ï¼šæ¯ç”Ÿæˆä¸€ä¸ªæ–°è¯ï¼Œæ¨¡å‹ä¼šæ ¹æ®å½“å‰ä¸Šä¸‹æ–‡ï¼ˆå·²ç»ç”Ÿæˆçš„è¯ï¼‰æ¥é¢„æµ‹ä¸‹ä¸€ä¸ªæœ€å¯èƒ½çš„è¯ã€‚å®ƒä¼šè®¡ç®—å½“å‰ä¸Šä¸‹æ–‡ä¸è¯æ±‡è¡¨ä¸­æ‰€æœ‰å¯èƒ½è¯æ±‡çš„ç›¸ä¼¼åº¦ï¼Œæ‰¾åˆ°æœ€åˆé€‚çš„ä¸‹ä¸€ä¸ªè¯ã€‚</p>\n</li>\n<li>\n<p>æ›´æ–°ä¸Šä¸‹æ–‡ï¼šç”Ÿæˆçš„æ–°è¯ä¼šè¢«æ·»åŠ åˆ°ä¸Šä¸‹æ–‡ä¸­ï¼Œæ¨¡å‹ä¼šæ›´æ–°çŠ¶æ€ï¼Œå‡†å¤‡ç”Ÿæˆä¸‹ä¸€ä¸ªè¯ã€‚è¿™ä¸€è¿‡ç¨‹ä¼šä¸€ç›´è¿›è¡Œï¼Œç›´åˆ°ç”Ÿæˆå®Œæ•´çš„æ–‡æœ¬ã€‚</p>\n</li>\n</ul><p>è‡ªå›å½’æ–¹æ³•çš„æ¨ç†ç®—åŠ›å¼€é”€å’Œè¾“å…¥æ–‡æœ¬çš„é•¿åº¦æœ‰å¾ˆå¤§å…³ç³»ã€‚</p><ol>\n<li>\n<p>è‡ªæ³¨æ„åŠ›æœºåˆ¶çš„è®¡ç®—å¤æ‚åº¦ï¼šç”±äºè‡ªæ³¨æ„åŠ›æœºåˆ¶çš„è®¡ç®—å¤æ‚åº¦ä¸ºO(n^2)ï¼Œå…¶ä¸­næ˜¯åºåˆ—é•¿åº¦ï¼Œå¤„ç†é•¿æ–‡æœ¬æ—¶è®¡ç®—å¤æ‚åº¦ä¼šæ˜¾è‘—å¢åŠ ã€‚æ¯æ–°å¢ä¸€ä¸ªä½ç½®ï¼Œæ¨¡å‹éœ€è¦å¤„ç†å’Œè®°å¿†æ•´ä¸ªä¸Šä¸‹æ–‡ï¼Œä»è€Œå¯¼è‡´è®¡ç®—æ—¶é—´å’Œèµ„æºéœ€æ±‚ä»¥å¹³æ–¹çº§å¢é•¿ã€‚</p>\n</li>\n<li>\n<p>æ˜¾å­˜å ç”¨ï¼šå¤„ç†é•¿æ–‡æœ¬ä¸ä»…å¢åŠ äº†è®¡ç®—å¤æ‚åº¦ï¼Œè¿˜å¢åŠ äº†æ˜¾å­˜çš„éœ€æ±‚ã€‚ç”±äºæ¨¡å‹éœ€è¦åœ¨ç”Ÿæˆæ¯ä¸€ä¸ªè¯æ—¶ä¿ç•™å’Œè®¡ç®—ä¹‹å‰æ‰€æœ‰ä½ç½®çš„çŠ¶æ€ï¼Œæ˜¾å­˜å ç”¨ä¹Ÿéšåºåˆ—é•¿åº¦å¢åŠ è€Œå¢åŠ ã€‚</p>\n</li>\n</ol><p>å› æ­¤ï¼Œå°½ç®¡LLaMAæ¨¡å‹åœ¨å¤„ç†æ–‡æœ¬ç”Ÿæˆæ—¶å±•ç°äº†å¼ºå¤§çš„èƒ½åŠ›ï¼Œä½†é•¿æ–‡æœ¬çš„è¾“å…¥ä»ç„¶ä¼šå¯¼è‡´æ˜¾è‘—çš„èµ„æºæ¶ˆè€—ã€‚è¿™åŒ…æ‹¬è®¡ç®—æ—¶é—´å’Œæ˜¾å­˜çš„éœ€æ±‚ã€‚å› æ­¤ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œéœ€è¦å¯¹é•¿æ–‡æœ¬è¿›è¡Œåˆç†çš„è£å‰ªå’Œé¢„å¤„ç†ï¼Œä»¥å¹³è¡¡èµ„æºçš„æ¶ˆè€—å¹¶ä¿æŒæ¨¡å‹çš„é«˜æ•ˆè¿è¡Œã€‚</p><p>ç”Ÿæˆé•¿æ–‡æœ¬é€šå¸¸éœ€è¦å¤§é‡çš„è®¡ç®—å’Œé€šä¿¡èµ„æºï¼Œå¹¶ä¸”è€—æ—¶è¾ƒé•¿ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒRAG çš„å…³é”®ä½œç”¨æ˜¯æå‡ç”Ÿæˆè´¨é‡çš„åŒæ—¶ä¿æŒæ•ˆç‡ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤„ç†é•¿æ–‡æ¡£æ—¶ï¼Œæˆ‘ä»¬å¾€å¾€åªéœ€è¦å…¶ä¸­çš„ä¸€ä¸ªå…³é”®ç‰‡æ®µæ¥å›ç­”é—®é¢˜ã€‚ä¸‹é¢åŸºäºå‘é‡æ•°æ®åº“å’Œ LLaMA 3 RAG çš„ä¾‹å­å¯ä»¥å¾ˆå¥½åœ°è¯´æ˜è¿™ä¸€ç‚¹ã€‚</p><pre><code class=\"language-javascript\">import chromadb\nfrom chromadb.config import Settings\nfrom FlagEmbedding import BGEM3FlagModel\nimport ollama&nbsp; # å¯¼å…¥Ollamaåº“\n\n# åˆå§‹åŒ–Chromaæ•°æ®åº“\nchroma_client = chromadb.PersistentClient(path=\"./chromadb\")\n\n# åˆ›å»ºä¸€äº›æµ‹è¯•æ–‡æ¡£\ndocuments = [\n&nbsp; &nbsp; {\n&nbsp; &nbsp; &nbsp; &nbsp; \"page_content\": \"åˆåŒæ˜¯ä¸¤æ–¹æˆ–å¤šæ–¹ä¹‹é—´çš„æ³•å¾‹åè®®ï¼Œé€šå¸¸åŒ…æ‹¬å„æ–¹çš„æƒåˆ©å’Œä¹‰åŠ¡ã€‚åˆåŒå¿…é¡»å…·å¤‡åˆæ³•æ€§å’Œå¯æ‰§è¡Œæ€§ã€‚\",\n&nbsp; &nbsp; &nbsp; &nbsp; \"metadata\": {\"id\": \"doc1\"}\n&nbsp; &nbsp; },\n&nbsp; &nbsp; {\n&nbsp; &nbsp; &nbsp; &nbsp; \"page_content\": \"åœ¨åˆåŒä¸­ï¼Œä¸»è¦ä¹‰åŠ¡åŒ…æ‹¬ï¼š1) ä»˜æ¬¾ä¹‰åŠ¡ï¼Œ2) å•†å“äº¤ä»˜ä¹‰åŠ¡ï¼Œ3) ç›¸å…³æœåŠ¡çš„æä¾›ã€‚åˆåŒä¸­çš„è¿™äº›ä¹‰åŠ¡å¿…é¡»åœ¨çº¦å®šçš„æ—¶é—´å†…å±¥è¡Œã€‚\",\n&nbsp; &nbsp; &nbsp; &nbsp; \"metadata\": {\"id\": \"doc2\"}\n&nbsp; &nbsp; },\n&nbsp; &nbsp; {\n&nbsp; &nbsp; &nbsp; &nbsp; \"page_content\": \"åˆåŒçš„è§£é™¤é€šå¸¸éœ€è¦åŒæ–¹çš„åŒæ„ï¼Œæˆ–è€…ç”±äºæ³•å¾‹è§„å®šçš„ç‰¹æ®Šæƒ…å†µï¼Œå¦‚è¿çº¦æˆ–ä¸å¯æŠ—åŠ›äº‹ä»¶ã€‚\",\n&nbsp; &nbsp; &nbsp; &nbsp; \"metadata\": {\"id\": \"doc3\"}\n&nbsp; &nbsp; },\n&nbsp; &nbsp; {\n&nbsp; &nbsp; &nbsp; &nbsp; \"page_content\": \"è¿çº¦è´£ä»»æ˜¯æŒ‡ä¸€æ–¹æœªèƒ½å±¥è¡ŒåˆåŒä¹‰åŠ¡æ—¶ï¼Œåº”æ‰¿æ‹…çš„æ³•å¾‹åæœï¼Œé€šå¸¸åŒ…æ‹¬èµ”å¿æŸå¤±å’Œç»§ç»­å±¥è¡ŒåˆåŒçš„è´£ä»»ã€‚\",\n&nbsp; &nbsp; &nbsp; &nbsp; \"metadata\": {\"id\": \"doc4\"}\n&nbsp; &nbsp; },\n&nbsp; &nbsp; {\n&nbsp; &nbsp; &nbsp; &nbsp; \"page_content\": \"åœ¨åˆåŒç”Ÿæ•ˆä¹‹å‰ï¼Œæ‰€æœ‰ç›¸å…³æ–¹å¿…é¡»ç†è§£åˆåŒæ¡æ¬¾ï¼Œå¹¶åŒæ„å…¶å†…å®¹ã€‚ç­¾å­—æ˜¯åˆåŒç”Ÿæ•ˆçš„é‡è¦æ ‡å¿—ã€‚\",\n&nbsp; &nbsp; &nbsp; &nbsp; \"metadata\": {\"id\": \"doc5\"}\n&nbsp; &nbsp; },\n&nbsp; &nbsp; {\n&nbsp; &nbsp; &nbsp; &nbsp; \"page_content\": \"åˆçº¦çš„å±¥è¡Œå¿…é¡»ç¬¦åˆè¯šä¿¡åŸåˆ™ï¼Œå³å„æ–¹åº”è¯šå®å®ˆä¿¡åœ°å±¥è¡Œè‡ªå·±çš„ä¹‰åŠ¡ï¼Œå¹¶å°Šé‡å¯¹æ–¹çš„åˆæ³•æƒç›Šã€‚\",\n&nbsp; &nbsp; &nbsp; &nbsp; \"metadata\": {\"id\": \"doc6\"}\n&nbsp; &nbsp; },\n&nbsp; &nbsp; {\n&nbsp; &nbsp; &nbsp; &nbsp; \"page_content\": \"åœ¨åˆåŒäº‰è®®ä¸­ï¼ŒåŒæ–¹å¯é€šè¿‡è°ƒè§£ã€ä»²è£æˆ–è¯‰è®¼çš„æ–¹å¼è§£å†³äº‰ç«¯ã€‚é€‰æ‹©åˆé€‚çš„æ–¹å¼å–å†³äºäº‰è®®çš„æ€§è´¨åŠé‡‘é¢ã€‚\",\n&nbsp; &nbsp; &nbsp; &nbsp; \"metadata\": {\"id\": \"doc7\"}\n&nbsp; &nbsp; },\n&nbsp; &nbsp; {\n&nbsp; &nbsp; &nbsp; &nbsp; \"page_content\": \"å…³äºåˆåŒçš„æ³•å¾‹æ³•è§„å„å›½æœ‰æ‰€ä¸åŒï¼Œäº†è§£é€‚ç”¨çš„æ³•å¾‹æ¡æ¬¾æ˜¯ç­¾è®¢åˆåŒå‰çš„é‡è¦æ­¥éª¤ã€‚\",\n&nbsp; &nbsp; &nbsp; &nbsp; \"metadata\": {\"id\": \"doc8\"}\n&nbsp; &nbsp; }\n]\n\n# åˆå§‹åŒ–BGE M3æ¨¡å‹\nmodel = BGEM3FlagModel('BAAI/bge-m3', use_fp16=True)\n\n# å°†æ–‡æ¡£æ·»åŠ åˆ°å‘é‡å­˜å‚¨ä¸­\ndocumentation_collection = chroma_client.get_or_create_collection(name=\"legal_docs\")\n\n# ç”Ÿæˆæ–‡æ¡£åµŒå…¥å¹¶æ·»åŠ åˆ°é›†åˆä¸­\nfor doc in documents:\n&nbsp; &nbsp; embedding = model.encode([doc['page_content']], batch_size=1)['dense_vecs'][0]\n&nbsp; &nbsp; documentation_collection.add(\n&nbsp; &nbsp; &nbsp; &nbsp; ids=[doc['metadata']['id']],&nbsp; # å‡è®¾æ–‡æ¡£æœ‰å”¯ä¸€çš„id\n&nbsp; &nbsp; &nbsp; &nbsp; embeddings=[embedding],\n&nbsp; &nbsp; &nbsp; &nbsp; documents=[doc['page_content']]\n&nbsp; &nbsp; )\n\n# æŸ¥è¯¢ç¤ºä¾‹\nquery = \"åˆåŒä¸­çš„ä¸»è¦ä¹‰åŠ¡æ˜¯ä»€ä¹ˆï¼Ÿ\"\nquery_embedding = model.encode([query], batch_size=1)['dense_vecs'][0]\n\n# æ‰§è¡Œå‘é‡æŸ¥è¯¢\nresults = documentation_collection.query(\n&nbsp; &nbsp; query_embeddings=[query_embedding],\n&nbsp; &nbsp; n_results=1&nbsp; # è·å–æœ€ç›¸ä¼¼çš„ä¸€ä¸ªç»“æœ\n)\n\n# æå–æ£€ç´¢åˆ°çš„æ–‡æ¡£å†…å®¹\ndata = results['documents'][0]&nbsp; # å‡è®¾åªæ£€ç´¢åˆ°ä¸€ä¸ªç»“æœ\ndocument_content = data&nbsp; # è¿™é‡Œå–å‡ºæ–‡æ¡£å†…å®¹\n\n# å°†ä¸Šä¸‹æ–‡ä¸æŸ¥è¯¢ä¸€èµ·ä¼ é€’ç»™ Ollama LLM\nprompt = f\"æ ¹æ®ä»¥ä¸‹ä¿¡æ¯ï¼Œè¯·å›ç­”ï¼š{query}\"\n\n# ä½¿ç”¨Ollamaç”Ÿæˆå“åº”\noutput = ollama.chat(model='llama3', messages=[\n&nbsp; &nbsp; {\n&nbsp; &nbsp; &nbsp; &nbsp; 'role': 'user',\n&nbsp; &nbsp; &nbsp; &nbsp; 'content': f\"ä½¿ç”¨ä»¥ä¸‹æ•°æ®ï¼š{document_content}. å“åº”è¿™ä¸ªæç¤ºï¼š{prompt}\"\n&nbsp; &nbsp; },\n])\n\n# è¾“å‡ºç”Ÿæˆçš„ç»“æœ\nprint(\"ç”Ÿæˆçš„ç»“æœï¼š\", output['message']['content'])\n</code></pre><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼ŒRAG æ¨¡å‹é€šè¿‡æ£€ç´¢ä¸é—®é¢˜ç›¸å…³çš„æ–‡æœ¬ç‰‡æ®µæ¥ç”Ÿæˆå›åº”ã€‚è¿™ç§æ–¹æ³•å¯ä»¥å‡å°‘é•¿æ–‡æœ¬å¤„ç†çš„è®¡ç®—è´Ÿæ‹…ï¼Œæé«˜å“åº”é€Ÿåº¦ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œæ€ç»´é“¾æ–¹æ³•å¯ä»¥æå‡ç”Ÿæˆå†…å®¹çš„è´¨é‡ï¼Œä½†é•¿æ–‡æœ¬çš„ä¿¡æ¯é‡è¿‡å¤§æ—¶ï¼ŒLLMï¼ˆå¤§è¯­è¨€æ¨¡å‹ï¼‰çš„æŒ‡ä»¤ç†è§£èƒ½åŠ›ä¼šæ˜¾è‘—ä¸‹é™ã€‚è¿™ä¸æ€ç»´é“¾çš„ç›®æ ‡ï¼Œå³é€šè¿‡åˆ†è§£å’Œèšç„¦æŒ‡ä»¤ï¼Œæ­£å¥½ç›¸åã€‚é€šè¿‡æ€ç»´é“¾å¤šæ­¥æ¨ç†çš„ Python ä¾‹å­ï¼Œå¯ä»¥æ›´æ¸…æ¥šåœ°çœ‹åˆ°è¿™ä¸€ç‚¹ã€‚</p><pre><code class=\"language-javascript\">from langchain.chains import LLMChain, SequentialChain\nfrom langchain_ollama.llms import OllamaLLM\nfrom langchain.prompts import PromptTemplate\n\n# åˆ›å»º LLM å®ä¾‹\nllm = OllamaLLM(model=\"llama3\")&nbsp; # ä½¿ç”¨ Ollama æ¨¡å‹\n\ndef create_chain(template: str, input_vars: list, output_key: str) -&gt; LLMChain:\n&nbsp; &nbsp; \"\"\"åˆ›å»º LLMChain å®ä¾‹\"\"\"\n&nbsp; &nbsp; prompt = PromptTemplate(\n&nbsp; &nbsp; &nbsp; &nbsp; input_variables=input_vars,\n&nbsp; &nbsp; &nbsp; &nbsp; template=template\n&nbsp; &nbsp; )\n&nbsp; &nbsp; return LLMChain(llm=llm, prompt=prompt, output_key=output_key)\n\n# ç¬¬ä¸€æ­¥ï¼šå¤´è„‘é£æš´è§£å†³æ–¹æ¡ˆ\ntemplate_step1 = \"\"\"\næ­¥éª¤ 1:\næˆ‘é¢ä¸´ä¸€ä¸ªå…³äº{input}çš„é—®é¢˜ã€‚è¯·æä¾›ä¸‰ä¸ªä¸åŒçš„è§£å†³æ–¹æ¡ˆï¼Œè€ƒè™‘åˆ°ä»¥ä¸‹å› ç´ ï¼š{perfect_factors}ã€‚\nA:\n\"\"\"\nchain1 = create_chain(template_step1, [\"input\", \"perfect_factors\"], \"solutions\")\n\n# ç¬¬äºŒæ­¥ï¼šè¯„ä¼°è§£å†³æ–¹æ¡ˆ\ntemplate_step2 = \"\"\"\næ­¥éª¤ 2:\nè¯·è¯„ä¼°ä»¥ä¸‹è§£å†³æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹ã€å®æ–½éš¾åº¦å’Œé¢„æœŸç»“æœï¼Œå¹¶ä¸ºæ¯ä¸ªæ–¹æ¡ˆåˆ†é…æˆåŠŸæ¦‚ç‡å’Œä¿¡å¿ƒæ°´å¹³ã€‚\n{solutions}\nA:\n\"\"\"\nchain2 = create_chain(template_step2, [\"solutions\"], \"review\")\n\n# ç¬¬ä¸‰æ­¥ï¼šæ·±åŒ–æ€è€ƒè¿‡ç¨‹\ntemplate_step3 = \"\"\"\næ­¥éª¤ 3:\nè¯·æ·±å…¥åˆ†ææ¯ä¸ªè§£å†³æ–¹æ¡ˆï¼Œæä¾›å®æ–½ç­–ç•¥ã€æ‰€éœ€èµ„æºå’Œæ½œåœ¨éšœç¢ï¼ŒåŒæ—¶è€ƒè™‘æ„å¤–ç»“æœåŠåº”å¯¹æªæ–½ã€‚\n{review}\nA:\n\"\"\"\nchain3 = create_chain(template_step3, [\"review\"], \"deepen_thought_process\")\n\n# ç¬¬å››æ­¥ï¼šæ’åºè§£å†³æ–¹æ¡ˆ\ntemplate_step4 = \"\"\"\næ­¥éª¤ 4:\næ ¹æ®è¯„ä¼°å’Œåˆ†æç»“æœï¼Œå¯¹è§£å†³æ–¹æ¡ˆè¿›è¡Œæ’åºï¼Œè¯´æ˜ç†ç”±ï¼Œå¹¶ç»™å‡ºæœ€ç»ˆè€ƒè™‘ã€‚\n{deepen_thought_process}\nA:\n\"\"\"\nchain4 = create_chain(template_step4, [\"deepen_thought_process\"], \"ranked_solutions\")\n\n# å°†å„ä¸ªé“¾æ¡è¿æ¥èµ·æ¥\noverall_chain = SequentialChain(\n&nbsp; &nbsp; chains=[chain1, chain2, chain3, chain4],\n&nbsp; &nbsp; input_variables=[\"input\", \"perfect_factors\"],\n&nbsp; &nbsp; output_variables=[\"ranked_solutions\"],\n&nbsp; &nbsp; verbose=True\n)\n\n# ç¤ºä¾‹è¾“å…¥\nresult = overall_chain({\n&nbsp; &nbsp; \"input\": \"äººç±»å¯¹ç«æ˜Ÿçš„æ®–æ°‘\",\n&nbsp; &nbsp; \"perfect_factors\": \"åœ°çƒä¸ç«æ˜Ÿä¹‹é—´çš„è·ç¦»éå¸¸é¥è¿œï¼Œä½¿å¾—å®šæœŸè¡¥ç»™å˜å¾—å›°éš¾\"\n})\n\nprint(result)\n\n</code></pre><p><strong>å› æ­¤ï¼ŒCoT å’Œ RAG ä¾ç„¶æ˜¯æå‡é•¿æ–‡æœ¬ç”Ÿæˆè´¨é‡çš„é‡è¦æ–¹æ³•ï¼Œä»ç„¶å…·æœ‰ä¸å¯æˆ–ç¼ºçš„ä»·å€¼</strong>ã€‚</p><h2>é¢å‘è¶…é•¿æ–‡æœ¬çš„å®šåˆ¶ä¸ä¼˜åŒ–</h2><p>éšç€å¤§æ¨¡å‹æŠ€æœ¯çš„å‘å±•ï¼Œå¤„ç†è¶…é•¿æ–‡æœ¬çš„èƒ½åŠ›ä¹Ÿåœ¨ä¸æ–­æå‡ï¼Œé™¤äº†æˆ‘ä»¬å‰é¢æåˆ°çš„æ ‡å‡†ç‰ˆæœ¬ LLaMAä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸“é—¨é’ˆå¯¹è¶…é•¿æ–‡æœ¬å¤„ç†çš„å®šåˆ¶ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œé’ˆå¯¹æ³•å¾‹æ–‡ä¹¦çš„å¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ 1Mï¼ˆç™¾ä¸‡çº§åˆ«ï¼‰ä¸Šä¸‹æ–‡é•¿åº¦çš„æ¨¡å‹æ¥å¤„ç†å¤æ‚çš„æ³•å¾‹æ–‡æœ¬ã€‚è¿™äº›è¶…é•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›å¯ä»¥æœ‰æ•ˆåœ°è§£å†³å…¨å±€ç”¨è¯ä¸€è‡´æ€§é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›é¢å‘é•¿æ–‡æœ¬çš„ä¼˜åŒ–ç‰ˆæœ¬ï¼š</p><pre><code class=\"language-javascript\">import ollama\n\n\nwith open('data/legal_document.txt', 'r', encoding='utf-8') as f:\n&nbsp; &nbsp; legal_text = f.read()\n\n# ç³»ç»Ÿæç¤ºè¯ï¼ŒæŒ‡å®šæ¨¡å‹çš„èƒŒæ™¯ä¿¡æ¯å’Œå›ç­”é£æ ¼\nSYSTEM_PROMPT = f'æ³•å¾‹æ–‡ä¹¦å†…å®¹: {legal_text}\\n\\n' + \"\"\"\nä¸Šä¸‹æ–‡: ä½ æ˜¯ä¸€ä¸ªæ³•å¾‹åŠ©æ‰‹ï¼ŒåŸºäºæä¾›çš„æ³•å¾‹æ–‡ä¹¦å†…å®¹æä¾›ç­”æ¡ˆã€‚\nä½ åªèƒ½è®¨è®ºæ–‡ä¹¦ä¸­çš„å†…å®¹ã€‚ç”¨æˆ·å°†è¯¢é—®æœ‰å…³æ–‡ä¹¦çš„å…·ä½“é—®é¢˜ï¼Œä½ éœ€è¦åŸºäºæ–‡ä¹¦å†…å®¹æä¾›è¯¦ç»†çš„å›ç­”ã€‚\nå¦‚æœä¿¡æ¯ä¸è¶³ä»¥å›ç­”é—®é¢˜ï¼Œè¯·è¦æ±‚ç”¨æˆ·æä¾›æ›´å…·ä½“çš„æ–‡ä¹¦éƒ¨åˆ†ã€‚\n\"\"\"\nQUESTION = 'æ–‡ä¸­å…³äºåˆåŒä¸­çš„ä¸»è¦ä¹‰åŠ¡çš„æè¿°æ˜¯å¦ä¸€è‡´ï¼Ÿ'\n\n# æ„é€ èŠå¤©æ¶ˆæ¯\nmessages = [\n&nbsp; &nbsp; {'role': 'system', 'content': SYSTEM_PROMPT},\n&nbsp; &nbsp; {'role': 'user', 'content': QUESTION},\n]\n\n# è°ƒç”¨Ollamaçš„LLMç”Ÿæˆç»“æœ\nresponse = ollama.chat(model='llama3-gradient', messages=messages)\n\n# è¾“å‡ºç»“æœ\nprint('\\n\\n')\nprint(f'ç³»ç»Ÿæç¤º: ...{SYSTEM_PROMPT[-500:]}')&nbsp; # æ‰“å°æœ€å500ä¸ªå­—ç¬¦çš„ç³»ç»Ÿæç¤º\nprint(f'ç”¨æˆ·æé—®:', QUESTION)\nprint('å›ç­”:')\nprint(response['message']['content'])&nbsp; # è¾“å‡ºç”Ÿæˆçš„å›ç­”\n</code></pre><h2>å°ç»“</h2><p>å¥½çš„ï¼Œæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹è¿™èŠ‚è¯¾çš„å†…å®¹å§ã€‚è¿™èŠ‚è¯¾æˆ‘ä»¬è®¨è®ºäº†é•¿æ–‡æœ¬å¤„ç†çš„å‡ ä¸ªå…³é”®ç‚¹ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬èŠåˆ°äº†é•¿æ–‡æœ¬å¤„ç†çš„ç°çŠ¶ä»¥åŠå®ƒåœ¨å¤šè½®å¯¹è¯ã€æ™ºèƒ½ä½“å’Œä¸Šä¸‹æ–‡åˆ†æä¸­çš„é‡è¦æ€§ã€‚é•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›ç°åœ¨æˆäº†å„å¤§å…¬å¸äº‰ç›¸æå‡çš„ç„¦ç‚¹ï¼Œå› ä¸ºå®ƒåœ¨å¤„ç†å¤æ‚ä¿¡æ¯æ—¶çš„ä»·å€¼éå¸¸å¤§ã€‚</p><p>ä½†è¦æ³¨æ„ï¼Œé•¿æ–‡æœ¬å¤„ç†å¹¶ä¸æ˜¯ä¸‡èƒ½çš„è§£å†³æ–¹æ¡ˆã€‚ç”±äºLLMçš„Next Token Predictionçš„ç‰¹æ€§ï¼Œå¤„ç†é•¿æ–‡æœ¬ä¼šæ¶ˆè€—å¾ˆå¤šç®—åŠ›ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—åœ¨å¿…è¦æ—¶æ‰ç”¨å®ƒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè™½ç„¶é•¿æ–‡æœ¬å¤„ç†å¾ˆé‡è¦ï¼Œä½†å®ƒçš„é«˜è®¡ç®—å¼€é”€æ„å‘³ç€æˆ‘ä»¬è¦è°¨æ…ä½¿ç”¨ã€‚</p><p>å¦å¤–ï¼Œè™½ç„¶åƒCoTè¿™æ ·çš„å¤šæ­¥æ¨ç†æŠ€æœ¯åœ¨ä¼˜åŒ–æ€§èƒ½æ–¹é¢è¡¨ç°ä¸é”™ï¼Œä½†å®ƒä»¬è¿˜ä¸èƒ½å®Œå…¨æ›¿ä»£é•¿æ–‡æœ¬å¤„ç†çš„èƒ½åŠ›ã€‚è¿™è¯´æ˜æˆ‘ä»¬éœ€è¦å­¦ä¼šåœ¨å®é™…åº”ç”¨ä¸­ï¼Œåˆ¤æ–­ä»€ä¹ˆæ—¶å€™è¯¥ç”¨é•¿æ–‡æœ¬å¤„ç†ï¼Œä»€ä¹ˆæ—¶å€™å¯ä»¥ç”¨å…¶ä»–ä¼˜åŒ–æ–¹æ³•ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬ä¸¾äº†ä¸€ä¸ªä¾‹å­ï¼Œå±•ç¤ºäº†é’ˆå¯¹é•¿æ–‡æœ¬ä¼˜åŒ–çš„LLaMA 3æ¨¡å‹ã€‚è¿™ä¸ªæ¨¡å‹èƒ½å¤„ç†ç™¾ä¸‡çº§åˆ«çš„æ•°æ®ï¼Œå¹¶åœ¨ä¸€äº›ç‰¹å®šåœºæ™¯ä¸­å±•ç°äº†å®ƒçš„ç‹¬ç‰¹ä»·å€¼ã€‚è¿™ä¸ªä¾‹å­è¯´æ˜äº†é•¿æ–‡æœ¬å¤„ç†åœ¨å®é™…åº”ç”¨ä¸­çš„æ½œåŠ›å’Œå¿…è¦æ€§ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>å…·å¤‡é•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›åï¼Œæ˜¯å¦æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰å†…å®¹ä¸€å¹¶äº¤ç»™å¤§æ¨¡å‹å¤„ç†å‘¢ï¼Ÿæ¬¢è¿ä½ æŠŠæ€è€ƒåçš„ç»“æœåˆ†äº«åˆ°ç•™è¨€åŒºï¼Œå’Œæˆ‘ä¸€èµ·è®¨è®ºï¼Œå¦‚æœä½ è§‰å¾—è¿™èŠ‚è¯¾çš„å†…å®¹å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œæ¬¢è¿ä½ åˆ†äº«ç»™å…¶ä»–æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","comments":[{"had_liked":false,"id":395933,"user_name":"å°è™å­ğŸ¯","can_delete":false,"product_type":"c1","uid":2843479,"ip_address":"åŒ—äº¬","ucode":"4C9530B3FB407B","user_header":"https://static001.geekbang.org/account/avatar/00/2b/63/57/cba4c68b.jpg","comment_is_top":true,"comment_ctime":1732500616,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100828301,"comment_content":"è¯¾ç¨‹ä»£ç åœ°å€ï¼šhttps:&#47;&#47;github.com&#47;tylerelyt&#47;LLaMa-in-Action","like_count":0},{"had_liked":false,"id":396436,"user_name":"åˆå¤œä¿®é“ƒ","can_delete":false,"product_type":"c1","uid":2413066,"ip_address":"åŒ—äº¬","ucode":"EF8DB6CD219CC1","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/iaK3hr7TO6WRFgmFkia0Q75ThkpyIOQtnXSttpI1ib8ianXxbb6LlPgPLZNOj5niaZnBt6Htps2Jia11v9l2VeL7EPibw/132","comment_is_top":false,"comment_ctime":1734447520,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":1,"score":2,"product_id":100828301,"comment_content":"Windowsæœ¬åœ°æ¨¡å‹ï¼Œä½¿ç”¨ollamaæ—¶å¦‚ä½•è°ƒç”¨æœ¬åœ°æ˜¾å¡ï¼Ÿ","like_count":0},{"had_liked":false,"id":396435,"user_name":"åˆå¤œä¿®é“ƒ","can_delete":false,"product_type":"c1","uid":2413066,"ip_address":"åŒ—äº¬","ucode":"EF8DB6CD219CC1","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/iaK3hr7TO6WRFgmFkia0Q75ThkpyIOQtnXSttpI1ib8ianXxbb6LlPgPLZNOj5niaZnBt6Htps2Jia11v9l2VeL7EPibw/132","comment_is_top":false,"comment_ctime":1734447201,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":1,"score":2,"product_id":100828301,"comment_content":"ç”Ÿæˆçš„ç»“æœï¼š æ ¹æ®ç»™å‡ºçš„æ•°æ®ï¼ŒåˆåŒä¸­çš„ä¸»è¦ä¹‰åŠ¡åŒ…æ‹¬ï¼š\n\n1. ä»˜æ¬¾ä¹‰åŠ¡\n2. å•†å“äº¤ä»˜ä¹‰åŠ¡\n3. ç›¸å…³æœåŠ¡çš„æä¾›\nException ignored in: &lt;function AbsEmbedder.__del__ at 0x00000174DDF64540&gt;\nTraceback (most recent call last):\n  File &quot;C:\\Users\\xxx\\miniconda3\\Lib\\site-packages\\FlagEmbedding\\abc\\inference\\AbsEmbedder.py&quot;, line 270, in __del__\n  File &quot;C:\\Users\\xxx\\miniconda3\\Lib\\site-packages\\FlagEmbedding\\abc\\inference\\AbsEmbedder.py&quot;, line 89, in stop_self_pool\nTypeError: &#39;NoneType&#39; object is not callable\n\nè¿™é‡ŒæŠ¥é”™äº†ã€‚\nflagembedding             1.3.3                   ","like_count":0},{"had_liked":false,"id":396079,"user_name":"æ±Ÿæ…§æ˜","can_delete":false,"product_type":"c1","uid":1008096,"ip_address":"å¹¿ä¸œ","ucode":"A6CC6836A7A085","user_header":"https://static001.geekbang.org/account/avatar/00/0f/61/e0/c20f2457.jpg","comment_is_top":false,"comment_ctime":1732976340,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":1,"score":2,"product_id":100828301,"comment_content":"å…·å¤‡é•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›ï¼Œä¹Ÿæ„å‘³ç€éœ€è¦æ›´å¤šèµ„æºï¼Œæ˜¾å­˜èµ„æºï¼ŒCPUèµ„æºï¼Œä¹Ÿæ„å‘³ç€å›ç­”ç”¨æˆ·é—®é¢˜éœ€è¦æ›´é•¿æ—¶é—´ï¼Œæ‰€ä»¥å…·å¤‡é•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›æ¨¡å‹ï¼Œåœ¨å…·ä½“å®è·µä¸­ä¹Ÿä¸èƒ½æ¯«æ— èŠ‚åˆ¶ä½¿ç”¨ï¼Œè€Œæ˜¯å……åˆ†æœ‰ç†ç”±ä½¿ç”¨ï¼Œä¸ºå–å¾—é€Ÿåº¦ã€èµ„æºã€ä¸Šä¸‹æ–‡çš„å¹³è¡¡ï¼Œæˆ‘ä»¬éœ€è¦å……åˆ†è®¾è®¡ï¼Œåˆ©ç”¨langchainå·¥å…·ï¼Œå¯ä»¥æŠŠé—®é¢˜æ‹†åˆ†å¤šä¸ªèšç„¦ç‚¹ï¼Œç„¶åç”¨LLMå¿«é€Ÿè·å¾—ç­”æ¡ˆï¼Œç„¶åå†è®²é—®é¢˜ç»„åˆ","like_count":0},{"had_liked":false,"id":395301,"user_name":"æ—…æ¢¦å¼€å‘å›¢","can_delete":false,"product_type":"c1","uid":1622373,"ip_address":"æ±Ÿè¥¿","ucode":"B8A284C955B8CD","user_header":"https://static001.geekbang.org/account/avatar/00/18/c1/65/2fb5c4ce.jpg","comment_is_top":false,"comment_ctime":1730167336,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100828301,"comment_content":"åœ¨åˆåŒRAGçš„æ¡ˆä¾‹ä¸­ æˆ‘å®‰è£…FlagEmbeddingæŠ¥é”™äº†ï¼Œå¯èƒ½æ˜¯pythonç‰ˆæœ¬çš„é—®é¢˜ã€‚ æˆ‘ä½¿ç”¨nomic-embed-text:latest åµŒå…¥æ¨¡å‹ä»£æ›¿ï¼Œ å¤§å®¶ä¹Ÿå¯ä»¥è¯•è¯•ã€‚ æˆ‘çš„å®Œæ•´ä»£ç å¦‚ä¸‹\n```python\n# å‘é‡æ•°æ®åº“\nimport chromadb\n# Settings é…ç½®\nfrom chromadb.config import Settings\n# ç”Ÿæˆå™¨åµŒå…¥ å›¾åƒå¤„ è‡ªç„¶è¯­è¨€å¤„ç†\n# from FlagEmbedding import BGEM3FlagModel\nimport ollama\n\nchroma_client = chromadb.PersistentClient(path=&quot;.&#47;chromadb&quot;)\n# document, metadata embedding\ndocuments = [\n...\n]\n\ndocumentation_collection = chroma_client.get_or_create_collection(name=&quot;legal_docs&quot;)\n\nfor doc in documents:\n  embedding = ollama.embeddings(model=&#39;nomic-embed-text:latest&#39;,prompt=doc[&#39;page_content&#39;])\n  # print(embedding.get(&#39;embedding&#39;))\n  # id, embedding, åŸå†…å®¹\n  documentation_collection.add(\n    ids=[doc[&#39;metadata&#39;][&#39;id&#39;]],\n    embeddings=embedding.get(&#39;embeddings&#39;),\n    documents=[doc[&#39;page_content&#39;]]\n  )\n\nquery = &quot;åˆåŒæ˜¯ä»€ä¹ˆï¼Ÿ&quot;\nquery_embedding = ollama.embeddings(model=&#39;nomic-embed-text:latest&#39;, prompt=query)\nquery_embedding = query_embedding.get(&#39;embedding&#39;)[:384] \n# print(query_embedding.get())\n# # # æ ¹æ®embedding æŸ¥è¯¢\nresults = documentation_collection.query(\n  query_embeddings = query_embedding,\n  n_results=1\n)\n# # # # å–å‡ºåŸå†…å®¹\ndata = results[&#39;documents&#39;][0]\ndocument_content = data\n\nprompt = f&quot;æ ¹æ®ä¸€ä¸‹ä¿¡æ¯ï¼Œ è¯·å›ç­”ï¼š{query}&quot;\n\noutput = ollama.chat(model=&#39;qwen2.5:latest&#39;, messages=[\n  {\n    &#39;role&#39;: &#39;user&#39;,\n    &#39;content&#39;: f&quot;ä½¿ç”¨ä¸€ä¸‹æ•°æ®ï¼š{document_content},å“åº”è¿™ä¸ªæç¤ºï¼š{prompt}&quot;\n  }\n])\n\nprint(&quot;ç”Ÿæˆçš„ç»“æœï¼š&quot;, output[&#39;message&#39;][&#39;content&#39;])\n```","like_count":0},{"had_liked":false,"id":395134,"user_name":"willmyc","can_delete":false,"product_type":"c1","uid":1016703,"ip_address":"å¹¿ä¸œ","ucode":"486B28F89DFBEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/83/7f/7b1f3f68.jpg","comment_is_top":false,"comment_ctime":1729568404,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100828301,"comment_content":"è¶…é•¿æ–‡æœ¬æ˜¯å¦åº”è¯¥è€ƒè™‘è·Ÿllama3å¤šè½®å¯¹è¯çš„æƒ…å†µï¼Œllama3å¦‚ä½•å¤„ç†ï¼Œå¯å¦ä»‹ç»ä¸€ä¸‹ï¼Œè°¢è°¢ï¼","like_count":0}]}