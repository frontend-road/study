{"id":175164,"title":"33 | 配置管理：成千上万的配置项要如何管理？","content":"<p>你好，我是唐扬。</p><p>相信在实际工作中，提及性能优化你会想到代码优化，但是实际上有些性能优化可能只需要调整一些配置参数就可以搞定了。为什么这么说呢？我给你举几个例子：</p><ul>\n<li>你可以调整配置的超时时间让请求快速失败，防止系统的雪崩，提升系统的可用性；</li>\n<li>你还可以调整HTTP客户端连接池的大小，来提升调用第三方HTTP服务的并行处理能力，从而提升系统的性能。</li>\n</ul><p>你可以认为配置是管理你系统的工具，在你的垂直电商系统中，一定会有非常多的配置项，比如数据库的地址、请求HTTP服务的域名、本地内存最大缓存数量等等。</p><p>那么，你要如何对这些配置项做管理呢？管理的过程中要注意哪些事情呢？</p><h2>如何对配置进行管理</h2><p>配置管理由来已久，在Linux系统中就提供了大量的配置项，你可以根据自身业务的实际情况，动态地对系统功能做调整。比如，你可以通过修改dirty_writeback_centisecs参数的数值，调整Page Cache中脏数据刷新到磁盘上的频率；你也可以通过修改tcp_max_syn_backlog参数的值，来调整未建立连接队列的长度。而你既可以通过修改配置文件并且重启服务器来让配置生效，也可以通过sysctl命令来动态地调整，让配置即时生效。</p><!-- [[[read_end]]] --><p>那么在开发应用的时候，都有哪些管理配置的方式呢？我觉得主要有两种：</p><ul>\n<li>一种是通过配置文件来管理；</li>\n<li>另一种是使用配置中心来管理。</li>\n</ul><p>以电商系统为例，你和你的团队在刚开始开发垂直电商系统时，为了加快产品的研发速度，大概率不会注意配置管理的问题，会自然而然地把配置项和代码写在一起。但是随着配置项越来越多，为了更好地对配置项进行管理，同时避免修改配置项后还要重新对代码做编译，你选择把配置项拆分成独立的文件（文件可以是properties格式、xml格式或yaml格式）。不过，这些文件还是会和工程一起打包部署，只是更改配置后不需要重新编译代码了。</p><p><strong>随后，你很快发现了一个问题：</strong>虽然把配置拆分了出来，但是由于配置还是和代码打包在一起，如果要更改一个配置还是需要重新打包，这样无疑会增加打包的时间。于是，你考虑把配置写到单独的目录中，这样，修改配置就不需要再重新打包了（不过，由于配置并不能够实时生效，所以想让配置生效，还是需要重启服务）。</p><p>我们一般使用的基础组件，比如Tomcat、Nginx，都是采用上面这种配置文件的方式来管理配置项的，而在Linux系统中，我提到的tcp_max_syn_backlog就可以配置在/etc/sysctl.conf中。</p><p><strong>这里，我需要强调一点，我们通常会把配置文件存储的目录标准化为特定的目录。</strong>比如，都配置成/data/confs目录，然后把配置项使用Git等代码仓库管理起来。这样，在增加新的机器时，在机器初始化脚本中只需要创建这个目录，再从Git中拉取配置就可以了。这是一个标准化的过程，可以避免在启动应用时忘记部署配置文件。</p><p>再进一步说，如果你的服务是多机房部署的，那么不同机房的配置项中有可能是相同的，也有可能是不同的。这时候，你需要将相同的配置项放置在一个目录中给多个机房共用，再将不同的配置项放置在以机房名为名称的目录中。在读取配置的时候应该优先读取机房的配置，再读取公共配置，这样可以减少配置文件中的配置项的数量。</p><p>我给你列了一个典型目录配置，如果你的系统也使用文件来管理配置，可以参考一下。</p><pre><code>/data/confs/common/commerce //电商业务的公共配置\n/data/confs/commerce-zw     //电商业务兆维机房配置\n/data/confs/commerce-yz     //电商业务亦庄机房配置\n\n/data/confs/common/community //社区业务的公共配置\n/data/confs/community-zw     //社区业务兆维机房配置\n/data/confs/community-yz     //社区业务亦庄机房配置\n</code></pre><p>那么，这是不是配置管理的最终形态呢？当然不是，你不要忘了把配置放在文件中的方式还存在的问题（我上面也提到过了），那就是，我们必须将服务重启后才能让配置生效。有没有一种方法可以在不重启应用的前提下也能让配置生效呢？这就需要配置中心帮助我们实现了。</p><h2>配置中心是如何实现的</h2><p>配置中心可以算是微服务架构中的一个标配组件了。业界也提供了多种开源方案供你选择，比较出名的有携程开源的Apollo、百度开源的Disconf、360开源的QConf、Spring Cloud的组件Spring Cloud Config等等。</p><p>在我看来，Apollo支持不同环境，不同集群的配置，有完善的管理功能，支持灰度发布、更改热发布等功能，<strong>在所有配置中心中功能比较齐全，推荐你使用。</strong></p><p>那么，配置中心的组件在实现上有哪些关键的点呢？如果你想对配置中心组件有更强的把控力，想要自行研发一套符合自己业务场景的组件，又要如何入手呢？</p><h4>配置信息如何存储</h4><p>其实，配置中心和注册中心非常类似，其核心的功能就是<strong>配置项的存储和读取</strong>。所以，在设计配置中心的服务端时，我们需要选择合适的存储组件来存储大量的配置信息，这里可选择的组件有很多。</p><p>事实上，不同的开源配置中心也使用了不同的组件，比如Disconf、Apollo使用的是MySQL；QConf使用的是ZooKeeper。我之前维护和使用的配置中心就会使用不同的存储组件，比如微博的配置中心使用Redis来存储信息，而美图用的是Etcd。</p><p>无论使用哪一种存储组件，你所要做的就是规范配置项在其中的存储结构。比如，我之前使用的配置中心用Etcd作为存储组件，支持存储全局配置、机房配置和节点配置。其中，节点配置优先级高于机房配置，机房配置优先级高于全局配置。也就是说，我们会优先读取节点的配置，如果节点配置不存在，再读取机房配置，最后读取全局配置。它们的存储路径如下：</p><pre><code>/confs/global/{env}/{project}/{service}/{version}/{module}/{key} //全局配置\n/confs/regions/{env}/{project}/{service}/{version}/{region}/{module}/{key}   //机房配置 \n /confs/nodes/{env}/{project}/{service}/{version}/{region}/{node}/{module}/{key}     //节点配置\n</code></pre><h4>变更推送如何实现</h4><p>配置信息存储之后，我们需要考虑如何将配置的变更推送给服务端，这样就可以实现配置的动态变更，也就是说不需要重启服务器就能让配置生效了。而我们一般会有两种思路来实现变更推送：一种是轮询查询的方式，一种是长连推送的方式。</p><p>轮询查询很简单，就是应用程序向配置中心客户端注册一个监听器，配置中心的客户端，定期地（比如1分钟）查询所需要的配置是否有变化，如果有变化则通知触发监听器，让应用程序得到变更通知。</p><p><strong>这里有一个需要注意的点，</strong>如果有很多应用服务器都去轮询拉取配置，由于返回的配置项可能会很大，那么配置中心服务的带宽就会成为瓶颈。为了解决这个问题，我们会给配置中心的每一个配置项多存储一个根据配置项计算出来的MD5值。</p><p>配置项一旦变化，这个MD5值也会随之改变。配置中心客户端在获取到配置的同时，也会获取到配置的MD5值，并且存储起来。那么在轮询查询的时候，需要先确认存储的MD5值和配置中心的MD5是不是一致的。如果不一致，这就说明配置中心里存储的配置项有变化，然后才会从配置中心拉取最新的配置。</p><p>由于配置中心里存储的配置项变化的几率不大，所以使用这种方式后，每次轮询请求就只是返回一个MD5值，可以大大地减少配置中心服务器的带宽。</p><p><img src=\"https://static001.geekbang.org/resource/image/e8/7f/e846f4c4418f8ca137a1fd2dcbbb3b7f.jpg?wh=1142*356\" alt=\"\"></p><p>另一种长连的方式，它的逻辑是在配置中心服务端保存每个连接关注的配置项列表。这样当配置中心感知到配置变化后，就可以通过这个连接把变更的配置推送给客户端。这种方式需要保持长连，也需要保存连接和配置的对应关系，实现上要比轮询的方式复杂一些，但是相比轮询方式来说，能够更加实时地获取配置变更的消息。</p><p>而在我看来，配置服务中存储的配置变更频率不高，所以对于实时性要求不高，但是期望实现上能够足够简单，<strong>那么如果选择自研配置中心的话，可以考虑使用轮询的方式。</strong></p><h4>如何保证配置中心高可用</h4><p>除了变更通知以外，在配置中心实现中另外一个比较关键的点在于如何保证它的可用性。因为对于配置中心来说，可用性的重要程度要远远大于性能。</p><p>我们一般会在服务器启动时从配置中心中获取配置，如果配置获取的性能不高，那么外在的表现也只是应用启动时间慢了，对于业务的影响不大。但是，如果获取不到配置，很可能会导致启动失败。</p><p>比如，我们把数据库的地址存储在了配置中心里，如果配置中心宕机导致我们无法获取数据库的地址，那么自然应用程序就会启动失败。<strong>因此，我们的诉求是让配置中心“旁路化”。</strong>也就是说，即使配置中心宕机，或者配置中心依赖的存储宕机，我们仍然能够保证应用程序是可以启动的。那么这是如何实现的呢？</p><p>我们一般会在配置中心的客户端上，增加两级缓存：第一级缓存是内存的缓存；另外一级缓存是文件的缓存。</p><p>配置中心客户端在获取到配置信息后，会同时把配置信息同步地写入到内存缓存，并且异步地写入到文件缓存中。内存缓存的作用是降低客户端和配置中心的交互频率，提升配置获取的性能；而文件的缓存的作用就是灾备，当应用程序重启时，一旦配置中心发生故障，那么应用程序就会优先使用文件中的配置，这样虽然无法得到配置的变更消息（因为配置中心已经宕机了），但是应用程序还是可以启动起来的，算是一种降级的方案。</p><h2>课程小结</h2><p>以上就是本节课的全部内容了。在这节课中，我带你了解了系统开发的过程中，我们是如何管理大量的配置项的，你需要了解的重点是：</p><ol>\n<li>\n<p>配置存储是分级的，有公共配置，有个性的配置，一般个性配置会覆盖公共配置，这样可以减少存储配置项的数量；</p>\n</li>\n<li>\n<p>配置中心可以提供配置变更通知的功能，可以实现配置的热更新；</p>\n</li>\n<li>\n<p>配置中心关注的性能指标中，可用性的优先级是高于性能的，一般我们会要求配置中心的可用性达到99.999%，甚至会是99.9999%。</p>\n</li>\n</ol><p>这里你需要注意的是，并不是所有的配置项都需要使用配置中心来存储，如果你的项目还是使用文件方式来管理配置，那么你只需要将类似超时时间等，需要动态调整的配置，迁移到配置中心就可以了。对于像是数据库地址，依赖第三方请求的地址，这些基本不会发生变化的配置项，可以依然使用文件的方式来管理，这样可以大大地减少配置迁移的成本。</p><h2>一课一思</h2><p>结合实际情况谈一谈，你的项目中配置管理的方式是怎样的呢？欢迎在留言区与我分享你的经验。</p><p>最后，感谢你的阅读，如果这篇文章让你有所收获，也欢迎你将它分享给更多的朋友。</p>","neighbors":{"left":{"article_title":"32 |  压力测试：怎样设计全链路压力测试平台？","id":174757},"right":{"article_title":"34 | 降级熔断：如何屏蔽非核心系统故障的影响？","id":176917}},"comments":[{"had_liked":false,"id":160058,"user_name":"台风骆骆","can_delete":false,"product_type":"c1","uid":1170748,"ip_address":"","ucode":"891D3599644ABD","user_header":"https://static001.geekbang.org/account/avatar/00/11/dd/3c/a595eb2a.jpg","comment_is_top":false,"comment_ctime":1575862026,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"91770175242","product_id":100035801,"comment_content":"学习本篇文章收获：<br>1、配置中心的配置是需要分级的，如全局，机房，个性，可以减少存储，提高复用性。<br>2、当前配置中心主要有拉和推两种，拉就是定时去轮循获取，这里为了减少带宽，一开始是拿着本地的md5去看下是否配置有变更，如果没有变更，就不用拉取，如果有变更，再去拉取新的配置项。推就是需要保持长连接了，服务端还要维护客户端那边关注的配置项，一旦有配置项变更，就通知客户端。<br>3、配置中心是可用性高于性能的，配置中心客户端除了要维护内存配置项，还要维护一个文件的配置项，这个是异步同步的，一旦配置中心服务器挂了，可以降级读取本地文件的配置项内容。","like_count":21,"discussions":[{"author":{"id":2397964,"avatar":"","nickname":"小胡","note":"","ucode":"1E0DD4138E9D0E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391576,"discussion_content":"总结得不错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630538630,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":166004,"user_name":"丁丁历险记","can_delete":false,"product_type":"c1","uid":1661704,"ip_address":"","ucode":"A43829E454C067","user_header":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","comment_is_top":false,"comment_ctime":1577361475,"is_pvip":false,"replies":[{"id":"63332","content":"是的，很常见","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1577417849,"ip_address":"","comment_id":166004,"utype":1}],"discussion_count":1,"race_medal":0,"score":"57411936323","product_id":100035801,"comment_content":"md5  值判断更新，这个套路常用。","like_count":14,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":479348,"discussion_content":"是的，很常见","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577417849,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":163536,"user_name":"👽","can_delete":false,"product_type":"c1","uid":1274117,"ip_address":"","ucode":"D313AF941B412D","user_header":"https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg","comment_is_top":false,"comment_ctime":1576738378,"is_pvip":false,"replies":[{"id":"62226","content":"赞","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1576755951,"ip_address":"","comment_id":163536,"utype":1}],"discussion_count":2,"race_medal":0,"score":"48821378634","product_id":100035801,"comment_content":"个人总结：<br><br>配置中心：就相当于云。将配置内容挂载到云上，所有服务器根据自己的情况取自己需要的配置。<br><br>配置分级：类似于面向对象编程中子类和父类的。父类已有的方法可以满足要求时，可以直接用。如果自己有额外业务，那就复写父类的方法。<br><br>配置变更通知：类似于设计模式的发布订阅模式。再有新配置内容发布的时候，要保证通知所有需要同步配置的客户端。<br><br>配置中心性能指标： 因为配置中心并发量与请求响应时间的要求并不高。因为一个客户端可能很久才需要更新一次配置，所以可用性才是最主要的指标。","like_count":11,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478436,"discussion_content":"赞","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576755951,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2397964,"avatar":"","nickname":"小胡","note":"","ucode":"1E0DD4138E9D0E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391577,"discussion_content":"总觉得好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630538726,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":162821,"user_name":"longslee","can_delete":false,"product_type":"c1","uid":1465986,"ip_address":"","ucode":"C24E32E5B1B6F5","user_header":"https://static001.geekbang.org/account/avatar/00/16/5e/82/438c8534.jpg","comment_is_top":false,"comment_ctime":1576595590,"is_pvip":false,"replies":[{"id":"62143","content":"一般就是在客户端会有一个灾备文件，有的还会在服务端做多级缓存。","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1576735794,"ip_address":"","comment_id":162821,"utype":1}],"discussion_count":3,"race_medal":0,"score":"27346399366","product_id":100035801,"comment_content":"打卡。 zk 是 满足 CP，那么那几个基于 zk 的开源配置中心是怎么做到高可用的呢？<br>呃，我们的配置，似乎是反过来的哈哈，由一个配置中心定期生成一个静态文件，客户端直接引入这个路径下的文件...","like_count":6,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478155,"discussion_content":"一般就是在客户端会有一个灾备文件，有的还会在服务端做多级缓存。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576735794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1144916,"avatar":"https://static001.geekbang.org/account/avatar/00/11/78/54/eee87a6b.jpg","nickname":"吴冬","note":"","ucode":"0ED4314231C536","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":230768,"discussion_content":"zk是AP吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586770577,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1886331,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/c8/7b/153181d7.jpg","nickname":"夜辉","note":"","ucode":"9421385F51FF9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1144916,"avatar":"https://static001.geekbang.org/account/avatar/00/11/78/54/eee87a6b.jpg","nickname":"吴冬","note":"","ucode":"0ED4314231C536","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364914,"discussion_content":"zk满足CP，C是指一致性","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617641729,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":230768,"ip_address":""},"score":364914,"extra":""}]}]},{"had_liked":false,"id":159941,"user_name":"许凯","can_delete":false,"product_type":"c1","uid":1604645,"ip_address":"","ucode":"4F11AD41CB0244","user_header":"https://static001.geekbang.org/account/avatar/00/18/7c/25/70134099.jpg","comment_is_top":false,"comment_ctime":1575849635,"is_pvip":true,"replies":[{"id":"61431","content":"一般会长连短连结合的方式，短连定期轮询，长连负责推送","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1576131362,"ip_address":"","comment_id":159941,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18755718819","product_id":100035801,"comment_content":"变更通知时，如果使用长连接，但实际没有送达怎么办呢？要对应答做个标记，再做个定时检查标记吗","like_count":4,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477212,"discussion_content":"一般会长连短连结合的方式，短连定期轮询，长连负责推送","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576131362,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":338491,"user_name":"Geek_6303de","can_delete":false,"product_type":"c1","uid":2384792,"ip_address":"","ucode":"560C6515972A08","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/cGzhtx22cdOvQibbcEYCQnOWlJ4OS3xg3IwwXBGfRzichnuiazUlC0jGnAPKP9ISgib8F2keaNQarFNJU2Lb2HOVwg/132","comment_is_top":false,"comment_ctime":1647523124,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14532425012","product_id":100035801,"comment_content":"居然没有说到nacos嘛","like_count":3,"discussions":[{"author":{"id":1138821,"avatar":"https://static001.geekbang.org/account/avatar/00/11/60/85/f72f1d94.jpg","nickname":"与路同飞","note":"","ucode":"2985F1440A1962","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580549,"discussion_content":"19年，nacos还没普及","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658242913,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":227975,"user_name":"道","can_delete":false,"product_type":"c1","uid":1324160,"ip_address":"","ucode":"851A0AD751D317","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/80/30e9ae41.jpg","comment_is_top":false,"comment_ctime":1592531444,"is_pvip":false,"replies":[{"id":"84822","content":"静态资源在cdn上，不会经过web服务器","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1593176849,"ip_address":"","comment_id":227975,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10182466036","product_id":100035801,"comment_content":"有个小疑问，像京东这类网站，通过web访问，页面这些静态资源肯定是放在类似tomact这类的web容器，用户量肯定好多亿，前端是如何负载均衡的","like_count":2,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":498866,"discussion_content":"静态资源在cdn上，不会经过web服务器","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593176849,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":159964,"user_name":"何磊","can_delete":false,"product_type":"c1","uid":1047604,"ip_address":"","ucode":"78934C3ED4A342","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fc/34/c733b116.jpg","comment_is_top":false,"comment_ctime":1575852384,"is_pvip":false,"replies":[{"id":"61430","content":"👍","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1576131321,"ip_address":"","comment_id":159964,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10165786976","product_id":100035801,"comment_content":"使用配置中心遇到的几个问题<br>1. 配置中心也是keyvalue的方式存储或者说返回，需要按照服务纬度拉取配置，所以本地还是要在配置文件中写明要拉取配置的服务名<br>2. 我们实际操作中将配置中心跟注册中心整合了，本地配置记录服务名，注册中心不仅记录服务的node还记录相关配置。比如：db的账号密码。如果是只有配置也可以用这种方式，该方式对于agent维护成本降低","like_count":2,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477220,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576131321,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1183019,"avatar":"https://static001.geekbang.org/account/avatar/00/12/0d/2b/4814d3db.jpg","nickname":"阿土","note":"","ucode":"2DBEAD80B0CA3C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":76920,"discussion_content":"这个思路很不错！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575867461,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":159928,"user_name":"被秒","can_delete":false,"product_type":"c1","uid":1684432,"ip_address":"","ucode":"712BFB465D29A9","user_header":"https://static001.geekbang.org/account/avatar/00/19/b3/d0/ac3a1227.jpg","comment_is_top":false,"comment_ctime":1575847453,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"10165782045","product_id":100035801,"comment_content":"我个人更喜欢在环境变量的方式读配置，毕竟无宕机的rolling update的实现已经是标配了。毕竟引入一个重量级的配置中心的就引入了复杂度, 尤其是那些需要侵入的方式。","like_count":2},{"had_liked":false,"id":250914,"user_name":"aoe","can_delete":false,"product_type":"c1","uid":1121758,"ip_address":"","ucode":"1C6201EDB4E954","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","comment_is_top":false,"comment_ctime":1601280103,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5896247399","product_id":100035801,"comment_content":"波波老师也推荐过Apollo","like_count":1,"discussions":[{"author":{"id":1255277,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLDVXsv6JOOficLK07867AkAb21eoG5KBgYFmwhMXKJooU5B6iaIZwyDxExicokVQSiaKEwZ4qPicqVFcg/132","nickname":"拼yin世界","note":"","ucode":"9571428A12B72A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535600,"discussion_content":"apollo是采用轮询获取配置的方式，还是长连接呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638493626,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1121758,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","nickname":"aoe","note":"","ucode":"1C6201EDB4E954","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1255277,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLDVXsv6JOOficLK07867AkAb21eoG5KBgYFmwhMXKJooU5B6iaIZwyDxExicokVQSiaKEwZ4qPicqVFcg/132","nickname":"拼yin世界","note":"","ucode":"9571428A12B72A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535618,"discussion_content":"不知道","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638498296,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":535600,"ip_address":""},"score":535618,"extra":""}]}]},{"had_liked":false,"id":192566,"user_name":"古德","can_delete":false,"product_type":"c1","uid":1037755,"ip_address":"","ucode":"E3F646BB73F60E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d5/bb/98b93862.jpg","comment_is_top":false,"comment_ctime":1584860695,"is_pvip":false,"replies":[{"id":"73891","content":"是的，也是可以的","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1585019684,"ip_address":"","comment_id":192566,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5879827991","product_id":100035801,"comment_content":"除了短连接定时轮循，和长连接的方式之外。是不是还有一种long-polling的长轮询方式，也可以用在配置中心这个场景里面","like_count":1,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488425,"discussion_content":"是的，也是可以的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585019684,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":159918,"user_name":"知行合一","can_delete":false,"product_type":"c1","uid":1521486,"ip_address":"","ucode":"2B8E634FC4CFB7","user_header":"https://static001.geekbang.org/account/avatar/00/17/37/4e/5c3153b2.jpg","comment_is_top":false,"comment_ctime":1575841481,"is_pvip":false,"replies":[{"id":"61432","content":"主要是做好容灾","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1576131382,"ip_address":"","comment_id":159918,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5870808777","product_id":100035801,"comment_content":"配置中心怎么才能实现6个9的系统呢？","like_count":1,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477207,"discussion_content":"主要是做好容灾","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576131382,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360439,"user_name":"看不到de颜色","can_delete":false,"product_type":"c1","uid":1162714,"ip_address":"北京","ucode":"88348CCAE81931","user_header":"https://static001.geekbang.org/account/avatar/00/11/bd/da/3d76ea74.jpg","comment_is_top":false,"comment_ctime":1666576511,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1666576511","product_id":100035801,"comment_content":"请教老师一个问题：用MD5判断值是否变更会不会存在极端情况下值发生了细微改变但是MD5并没有变。MD5我印象里只是摘要，是存在不同值但是相同摘要的情况。","like_count":0},{"had_liked":false,"id":351327,"user_name":"YANg","can_delete":false,"product_type":"c1","uid":2880438,"ip_address":"","ucode":"59AB3520046E53","user_header":"https://static001.geekbang.org/account/avatar/00/2b/f3/b6/59fe8406.jpg","comment_is_top":false,"comment_ctime":1657702182,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1657702182","product_id":100035801,"comment_content":"好像现在比较火的是Consul","like_count":0},{"had_liked":false,"id":348283,"user_name":"sugar","can_delete":false,"product_type":"c1","uid":2184057,"ip_address":"","ucode":"491906283FC13B","user_header":"https://static001.geekbang.org/account/avatar/00/21/53/79/327ef30e.jpg","comment_is_top":false,"comment_ctime":1654932806,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1654932806","product_id":100035801,"comment_content":"只用过nacos做过配置中心，挺方便","like_count":0},{"had_liked":false,"id":310184,"user_name":"小胡","can_delete":false,"product_type":"c1","uid":2397964,"ip_address":"","ucode":"1E0DD4138E9D0E","user_header":"","comment_is_top":false,"comment_ctime":1630538898,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630538898","product_id":100035801,"comment_content":"数据库，HTTP服务得地址等如何使用Apollo实现热更新呢","like_count":0},{"had_liked":false,"id":294599,"user_name":"Geek_441001","can_delete":false,"product_type":"c1","uid":2421724,"ip_address":"","ucode":"159C7D1965FDD9","user_header":"","comment_is_top":false,"comment_ctime":1622014387,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622014387","product_id":100035801,"comment_content":"也就是说为了读取配置中心的数据，还需要额外维护一个配置客户端，然后由应用程序调用配置客户端。请问直接用应用程序调用配置中心有什么问题呢？目前我们只是简单的将全局配置缓存到redis中，然后应用程序调用redis读取配置。","like_count":0},{"had_liked":false,"id":292630,"user_name":"William Ning","can_delete":false,"product_type":"c1","uid":1592279,"ip_address":"","ucode":"4DB8D05E69E5F3","user_header":"https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg","comment_is_top":false,"comment_ctime":1620903720,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1620903720","product_id":100035801,"comment_content":"一旦配置中心发生故障，那么应用程序就会优先使用文件中的配置，这样虽然无法得到配置的变更消息（因为配置中心已经宕机了），但是应用程序还是可以启动起来的，算是一种降级的方案。<br><br>不应该是读取应用程序内存中的配置吗？","like_count":0},{"had_liked":false,"id":223172,"user_name":"指尖以东","can_delete":false,"product_type":"c1","uid":1092218,"ip_address":"","ucode":"1DEE134FE92FD0","user_header":"https://static001.geekbang.org/account/avatar/00/10/aa/7a/ae8c247d.jpg","comment_is_top":false,"comment_ctime":1591015591,"is_pvip":false,"replies":[{"id":"82716","content":"是的","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1591538458,"ip_address":"","comment_id":223172,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1591015591","product_id":100035801,"comment_content":"在k8s里面本地文件还需要挂载，不然就丢了","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":497038,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591538458,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2053679,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/56/2f/4518f8e1.jpg","nickname":"放不下荣华富贵","note":"","ucode":"9FE29C22B9ABE3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534476,"discussion_content":"服务启动时要全量拉一次的吧，不挂载应该也无所谓","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638197313,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":215378,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1588984829,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588984829","product_id":100035801,"comment_content":"目前的公司使用的是Apollo，之前的公司是自研的UCC基于ZK实现，两者相比Apollo的使用体验比较差。当然，原理都类似把需要动态调整的配置集中管理起来，不必重启机器就能改变相关配置，这样相当于可以改变程序的运行逻辑，这种需求非常强烈。<br>配置分级：按应用维度、机房维度、分组维度、机器维度，这种方式一是节省存储空间，另外对于一次修改多台机器的配置也非常的方便，实际上按组划分是比较OK的，因为同组内配置应该一致，不同组应该有所不同<br>配置分类：这个我觉得也比较重要，根据自己的经验调整各种程序逻辑开关配置，以及日志级别配置是最常见的，也存在调整服务别名的情况，不过比较少，针对常常会动态调整的配置分类，能更加简单容易的控制配置。<br>配置中心的易用性：这个对于使用非常的重要，不过个人觉得目前公司做的并不好，使用体验比较差。这种东西最好比较傻瓜式，之上是界面化的，控制起来符合常规逻辑，清晰明了最好。","like_count":0},{"had_liked":false,"id":186845,"user_name":"马里奥的马里奥","can_delete":false,"product_type":"c1","uid":1048423,"ip_address":"","ucode":"6848D9E82B58E3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ff/67/6ffe3a52.jpg","comment_is_top":false,"comment_ctime":1583937767,"is_pvip":false,"replies":[{"id":"72200","content":"是的，zk居多","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1584019797,"ip_address":"","comment_id":186845,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1583937767","product_id":100035801,"comment_content":"我司基于zookeeper实现配置中心","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486894,"discussion_content":"是的，zk居多","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584019797,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":181668,"user_name":"大象蚂蚁","can_delete":false,"product_type":"c1","uid":1255382,"ip_address":"","ucode":"0066D9CD979C39","user_header":"https://static001.geekbang.org/account/avatar/00/13/27/d6/30456009.jpg","comment_is_top":false,"comment_ctime":1582610748,"is_pvip":false,"replies":[{"id":"71104","content":"是的，apollo应用比较广泛","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1583115301,"ip_address":"","comment_id":181668,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1582610748","product_id":100035801,"comment_content":"比较推荐携程Apollo分布式配置中心，可以部署在自己服务器中。","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485070,"discussion_content":"是的，apollo应用比较广泛","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583115301,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1255277,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLDVXsv6JOOficLK07867AkAb21eoG5KBgYFmwhMXKJooU5B6iaIZwyDxExicokVQSiaKEwZ4qPicqVFcg/132","nickname":"拼yin世界","note":"","ucode":"9571428A12B72A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535598,"discussion_content":"apollo是采用轮询获取配置的方式，还是长连接呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638493577,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":181437,"user_name":"湛.bin","can_delete":false,"product_type":"c1","uid":1320988,"ip_address":"","ucode":"1E5B7717BD37A0","user_header":"https://static001.geekbang.org/account/avatar/00/14/28/1c/adf427a5.jpg","comment_is_top":false,"comment_ctime":1582540963,"is_pvip":false,"replies":[{"id":"71107","content":"不是，虽然看起来很相近，但是两个是不同的作用。<br>注册中心对实时性要求更高","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1583115408,"ip_address":"","comment_id":181437,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1582540963","product_id":100035801,"comment_content":"注册中心和配置中心是同一个东西吗？","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485001,"discussion_content":"不是，虽然看起来很相近，但是两个是不同的作用。\n注册中心对实时性要求更高","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583115408,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":177784,"user_name":"博弈","can_delete":false,"product_type":"c1","uid":1433344,"ip_address":"","ucode":"B1A69837E41972","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/EcYNib1bnDf5dz6JcrE8AoyZYMdqic2VNmbBtCcVZTO9EoDZZxqlQDEqQKo6klCCmklOtN9m0dTd2AOXqSneJYLw/132","comment_is_top":false,"comment_ctime":1581499400,"is_pvip":false,"replies":[{"id":"69654","content":"因为公共配置只有一份，是所有机房共享的，所以就不用写多份配置了","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1582001082,"ip_address":"","comment_id":177784,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1581499400","product_id":100035801,"comment_content":"在读取配置的时候应该优先读取机房的配置，再读取公共配置，这样可以减少配置文件中的配置项的数量。<br>为什么会减少配置文件中的配置项的数量？不太理解","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483542,"discussion_content":"因为公共配置只有一份，是所有机房共享的，所以就不用写多份配置了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582001082,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":163980,"user_name":"Keith","can_delete":false,"product_type":"c1","uid":1193337,"ip_address":"","ucode":"B40774090714D1","user_header":"https://static001.geekbang.org/account/avatar/00/12/35/79/21647da2.jpg","comment_is_top":false,"comment_ctime":1576838748,"is_pvip":false,"replies":[{"id":"63076","content":"是的，长连就是这种思路~","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1577242564,"ip_address":"","comment_id":163980,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1576838748","product_id":100035801,"comment_content":"&quot;轮询查询就是告诉配置中心，我与这个配置相关&quot;, 客户端订阅后, 配置中心不就存储了订阅者的信息?","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478602,"discussion_content":"是的，长连就是这种思路~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577242564,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":161759,"user_name":"Keith","can_delete":false,"product_type":"c1","uid":1193337,"ip_address":"","ucode":"B40774090714D1","user_header":"https://static001.geekbang.org/account/avatar/00/12/35/79/21647da2.jpg","comment_is_top":false,"comment_ctime":1576318269,"is_pvip":false,"replies":[{"id":"62229","content":"是的，问题是怎么查到相关的订阅者呢？轮询查询就是告诉配置中心，我与这个配置相关","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1576756170,"ip_address":"","comment_id":161759,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1576318269","product_id":100035801,"comment_content":"配置中心中配置的变更是通过什么方式? 可以只通过配置中心客户端吗? 如果可以, 那就不需要轮询了, 只需在配置变更后, 查到改配置相关的订阅者, 发送通知即可","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477845,"discussion_content":"是的，问题是怎么查到相关的订阅者呢？轮询查询就是告诉配置中心，我与这个配置相关","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576756170,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1193337,"avatar":"https://static001.geekbang.org/account/avatar/00/12/35/79/21647da2.jpg","nickname":"Keith","note":"","ucode":"B40774090714D1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":91536,"discussion_content":"&#34;轮询查询就是告诉配置中心，我与这个配置相关&#34;, 客户端订阅后, 配置中心不就存储了订阅者的信息?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576838707,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":160051,"user_name":"吃饭饭","can_delete":false,"product_type":"c1","uid":1231549,"ip_address":"","ucode":"95CFA07CDA2957","user_header":"https://static001.geekbang.org/account/avatar/00/12/ca/bd/a51ae4b2.jpg","comment_is_top":false,"comment_ctime":1575860676,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575860676","product_id":100035801,"comment_content":"git 的钩子触发变更也是不错的选择","like_count":0}]}